KIDS Distribution saved on Jun 18, 2008@09:54:06
CPRS27 AND REQUIRED PHARMACY PATCHES - RELEASED
**KIDS**:OR PSJ PSO 27 1.0^PSJ*5.0*134^PSO*7.0*225^OR*3.0*243^

**INSTALL NAME**
OR PSJ PSO 27 1.0
"BLD",18068,0)
OR PSJ PSO 27 1.0^^1^3080618^y
"BLD",18068,1,0)
^^1^1^3061219^
"BLD",18068,1,1,0)
BUNDLE BUILD OF OR*3.0*243 AND PSJ*5.0*134
"BLD",18068,6.3)
95
"BLD",18068,10,0)
^9.63^3^3
"BLD",18068,10,1,0)
PSJ*5.0*134^1
"BLD",18068,10,2,0)
PSO*7.0*225^1
"BLD",18068,10,3,0)
OR*3.0*243^1
"BLD",18068,10,"B","OR*3.0*243",3)

"BLD",18068,10,"B","PSJ*5.0*134",1)

"BLD",18068,10,"B","PSO*7.0*225",2)

"BLD",18068,"INID")

"BLD",18068,"PRE")

"MBREQ")
0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"VER")
8.0^22.0
**INSTALL NAME**
PSJ*5.0*134
"BLD",18065,0)
PSJ*5.0*134^INPATIENT MEDICATIONS^0^3080618^y
"BLD",18065,1,0)
^^81^81^3080306^
"BLD",18065,1,1,0)
This patch contains changes in support of Computerized Patient
"BLD",18065,1,2,0)
Record System (CPRS) V. 1.0 GUI v27 release.
"BLD",18065,1,3,0)
 
"BLD",18065,1,4,0)
1.  MEDICATION ROUTE CHANGES
"BLD",18065,1,5,0)
----------------------------
"BLD",18065,1,6,0)
- Inpatient Medications V. 5.0 will use the medication route received from
"BLD",18065,1,7,0)
  CPRS V. 1.0 as the default when finishing an IV order entered via CPRS
"BLD",18065,1,8,0)
  V. 1.0. For new orders entered via Inpatient Medications V. 5.0, if all
"BLD",18065,1,9,0)
  of the orderable items associated with an order contain the same default
"BLD",18065,1,10,0)
  medication route, that route will be used as the default. If there are
"BLD",18065,1,11,0)
  any differences, there will be no default medication route.
"BLD",18065,1,12,0)
 
"BLD",18065,1,13,0)
- Inpatient Medications V. 5.0 will send to BCMA V. 3.0 the full
"BLD",18065,1,14,0)
  medication route name for display on the Virtual Due List (VDL).
"BLD",18065,1,15,0)
 
"BLD",18065,1,16,0)
2.  INFUSION RATE CHANGES
"BLD",18065,1,17,0)
-------------------------
"BLD",18065,1,18,0)
- Inpatient Medications V. 5.0 now accepts infusion rate from CPRS in both
"BLD",18065,1,19,0)
  ml/hour and as 'infuse over time'.
"BLD",18065,1,20,0)
 
"BLD",18065,1,21,0)
- In the order view screen for an order with an intermittent IV type, the
"BLD",18065,1,22,0)
  infusion rate now displays as "Infuse Over" followed by the time. For
"BLD",18065,1,23,0)
  example, "Infuse Over 30 minutes".
"BLD",18065,1,24,0)
 
"BLD",18065,1,25,0)
  The infusion rate for an intermittent IV order can be null.
"BLD",18065,1,26,0)
 
"BLD",18065,1,27,0)
3.  IV TYPE CHANGES
"BLD",18065,1,28,0)
-------------------
"BLD",18065,1,29,0)
- Inpatient Medications V. 5.0 shall accept an IV type of "I"
"BLD",18065,1,30,0)
  (Intermittent) or "C" (Continuous) from CPRS V. 1.0.  When an IV type of
"BLD",18065,1,31,0)
  CONTINUOUS is received, Inpatient Medications V. 5.0 defaults to an IV
"BLD",18065,1,32,0)
  type of Admixture.  When IV type of INTERMITTENT is received, 
"BLD",18065,1,33,0)
  Inpatient Medications V. 5.0 defaults to an IV type of Piggyback.
"BLD",18065,1,34,0)
  Inpatient Medications V. 5.0 sends to CPRS V. 1.0 updates to an order's
"BLD",18065,1,35,0)
  IV type.
"BLD",18065,1,36,0)
 
"BLD",18065,1,37,0)
- Inpatient Medications V. 5.0 now accepts schedule information from
"BLD",18065,1,38,0)
  CPRS V. 1.0 for intermittent IV orders entered via the IV Fluid
"BLD",18065,1,39,0)
  Ordering Dialog.  Inpatient Medications V. 5.0 also sends to
"BLD",18065,1,40,0)
  CPRS V. 1.0 any schedule changes for intermittent IV orders.
"BLD",18065,1,41,0)
 
"BLD",18065,1,42,0)
- A new field, IV TYPE CATEGORY (#128) is being added to the NON-
"BLD",18065,1,43,0)
  VERIFIED ORDERS file (#53.1).  The IV TYPE CATEGORY will be "C"
"BLD",18065,1,44,0)
  (Continuous) for orders with an IV TYPE of Admixture, Hyperal,
"BLD",18065,1,45,0)
  Non-Intermittent Syringe, or Chemotherapy with a CHEMOTHERAPY TYPE
"BLD",18065,1,46,0)
  of Admixture, Hyperal, or Non-Intermittent Syringe.  The IV TYPE
"BLD",18065,1,47,0)
  CATEGORY will be "I" (Intermittent) for orders with an IV TYPE of
"BLD",18065,1,48,0)
  Piggyback, Intermittent Syringe, or Chemotherapy with a CHEMOTHERAPY
"BLD",18065,1,49,0)
  TYPE of Piggyback or Intermittent Syringe.
"BLD",18065,1,50,0)
 
"BLD",18065,1,51,0)
4.  RENEWED ORDER CHANGES
"BLD",18065,1,52,0)
-------------------------
"BLD",18065,1,53,0)
- When discontinuing pending renewal orders, Inpatient Medications V. 5.0
"BLD",18065,1,54,0)
  will provide the user an option to discontinue the pending renewal
"BLD",18065,1,55,0)
  order and/or the original orders.  The pharmacist shall be given the
"BLD",18065,1,56,0)
  option to discontinue the pending order, both orders, or exit the
"BLD",18065,1,57,0)
  discontinue function.
"BLD",18065,1,58,0)
 
"BLD",18065,1,59,0)
5.  REMOVE CALLS TO OBSOLETE ROUTINE
"BLD",18065,1,60,0)
------------------------------------
"BLD",18065,1,61,0)
- At the request of CPRS V. 1.0, active calls to obsolete routine OR3CONV
"BLD",18065,1,62,0)
  have been removed from Inpatient Medications V. 5.0. 
"BLD",18065,1,63,0)
 
"BLD",18065,1,64,0)
6.  EXPECTED FIRST DOSE FOR ONE-TIME ORDERS (HD 98365)
"BLD",18065,1,65,0)
------------------------------------------------------
"BLD",18065,1,66,0)
Problem:
"BLD",18065,1,67,0)
   During testing of the CPRS V. 1.0 GUI v26 release, sites reported a
"BLD",18065,1,68,0)
   problem with an incorrect display of expected first dose for orders
"BLD",18065,1,69,0)
   with a schedule type of "ONE TIME".
"BLD",18065,1,70,0)
Resolution:
"BLD",18065,1,71,0)
   If the schedule type is "ONE TIME", do not display an Expected
"BLD",18065,1,72,0)
   First Dose for the order.
"BLD",18065,1,73,0)
 
"BLD",18065,1,74,0)
7.  CORRECT ABBREVIATION OF MILLIMOLE (HD 145562)
"BLD",18065,1,75,0)
-------------------------------------------
"BLD",18065,1,76,0)
Problem:
"BLD",18065,1,77,0)
   The correct abbreviation for the word MILLIMOLE, which is MMOL
"BLD",18065,1,78,0)
   is not available in the system.
"BLD",18065,1,79,0)
Resolution:
"BLD",18065,1,80,0)
   The abbreviation for Millimole, "MMOL", will be included in
"BLD",18065,1,81,0)
   this patch.
"BLD",18065,4,0)
^9.64PA^53.1^1
"BLD",18065,4,53.1,0)
53.1
"BLD",18065,4,53.1,2,0)
^9.641^53.1^1
"BLD",18065,4,53.1,2,53.1,0)
NON-VERIFIED ORDERS  (File-top level)
"BLD",18065,4,53.1,2,53.1,1,0)
^9.6411^128^1
"BLD",18065,4,53.1,2,53.1,1,128,0)
IV TYPE CATEGORY
"BLD",18065,4,53.1,222)
y^y^p^^^^n^^n
"BLD",18065,4,53.1,224)

"BLD",18065,4,"APDD",53.1,53.1)

"BLD",18065,4,"APDD",53.1,53.1,128)

"BLD",18065,4,"B",53.1,53.1)

"BLD",18065,6)
12^
"BLD",18065,6.3)
124
"BLD",18065,"ABPKG")
n
"BLD",18065,"INID")
^n
"BLD",18065,"INIT")

"BLD",18065,"KRN",0)
^9.67PA^8989.52^19
"BLD",18065,"KRN",.4,0)
.4
"BLD",18065,"KRN",.401,0)
.401
"BLD",18065,"KRN",.402,0)
.402
"BLD",18065,"KRN",.403,0)
.403
"BLD",18065,"KRN",.5,0)
.5
"BLD",18065,"KRN",.84,0)
.84
"BLD",18065,"KRN",3.6,0)
3.6
"BLD",18065,"KRN",3.8,0)
3.8
"BLD",18065,"KRN",9.2,0)
9.2
"BLD",18065,"KRN",9.8,0)
9.8
"BLD",18065,"KRN",9.8,"NM",0)
^9.68A^39^37
"BLD",18065,"KRN",9.8,"NM",1,0)
PSJORRE^^0^B32121973
"BLD",18065,"KRN",9.8,"NM",2,0)
PSJORRN^^0^B60756345
"BLD",18065,"KRN",9.8,"NM",3,0)
PSJORRO^^0^B61708639
"BLD",18065,"KRN",9.8,"NM",4,0)
PSJHL3^^0^B65300768
"BLD",18065,"KRN",9.8,"NM",5,0)
PSJHL4^^0^B72457593
"BLD",18065,"KRN",9.8,"NM",6,0)
PSJHL4A^^0^B56736588
"BLD",18065,"KRN",9.8,"NM",7,0)
PSJHL9^^0^B61245429
"BLD",18065,"KRN",9.8,"NM",8,0)
PSJHLU^^0^B34501644
"BLD",18065,"KRN",9.8,"NM",9,0)
PSGOE1^^0^B29072557
"BLD",18065,"KRN",9.8,"NM",10,0)
PSIVEDT^^0^B41996183
"BLD",18065,"KRN",9.8,"NM",11,0)
PSIVORA^^0^B28909914
"BLD",18065,"KRN",9.8,"NM",13,0)
PSIVORFA^^0^B24701688
"BLD",18065,"KRN",9.8,"NM",14,0)
PSJLIVMD^^0^B77166995
"BLD",18065,"KRN",9.8,"NM",16,0)
PSJUTL^^0^B65061820
"BLD",18065,"KRN",9.8,"NM",17,0)
PSGS0^^0^B51528600
"BLD",18065,"KRN",9.8,"NM",18,0)
PSJORUT2^^0^B47514615
"BLD",18065,"KRN",9.8,"NM",19,0)
PSGOEC^^0^B67210353
"BLD",18065,"KRN",9.8,"NM",20,0)
PSIVOREN^^0^B27138020
"BLD",18065,"KRN",9.8,"NM",21,0)
PSIVORC^^0^B24718262
"BLD",18065,"KRN",9.8,"NM",22,0)
PSIVORC1^^0^B43227243
"BLD",18065,"KRN",9.8,"NM",23,0)
PSGOECS^^0^B48040655
"BLD",18065,"KRN",9.8,"NM",24,0)
PSGOEF^^0^B63235308
"BLD",18065,"KRN",9.8,"NM",25,0)
PSJORRN1^^0^B54888629
"BLD",18065,"KRN",9.8,"NM",26,0)
PSIVSP^^0^B37490534
"BLD",18065,"KRN",9.8,"NM",27,0)
PSJHL2^^0^B36875797
"BLD",18065,"KRN",9.8,"NM",28,0)
PSJHL5^^0^B31480184
"BLD",18065,"KRN",9.8,"NM",29,0)
PSJOREN^^0^B15419073
"BLD",18065,"KRN",9.8,"NM",30,0)
PSJORPOE^^0^B37937868
"BLD",18065,"KRN",9.8,"NM",31,0)
PSJORREN^^0^B20851674
"BLD",18065,"KRN",9.8,"NM",32,0)
PSJORRE1^^0^B35337470
"BLD",18065,"KRN",9.8,"NM",33,0)
PSGOE6^^0^B24315055
"BLD",18065,"KRN",9.8,"NM",34,0)
PSIVCAL^^0^B65800854
"BLD",18065,"KRN",9.8,"NM",35,0)
PSIVORFB^^0^B50190472
"BLD",18065,"KRN",9.8,"NM",36,0)
PSIVUTL1^^0^B26385588
"BLD",18065,"KRN",9.8,"NM",37,0)
PSJLIACT^^0^B40055313
"BLD",18065,"KRN",9.8,"NM",38,0)
PSJLIVFD^^0^B39296093
"BLD",18065,"KRN",9.8,"NM",39,0)
PSGOT^^0^B14273547
"BLD",18065,"KRN",9.8,"NM","B","PSGOE1",9)

"BLD",18065,"KRN",9.8,"NM","B","PSGOE6",33)

"BLD",18065,"KRN",9.8,"NM","B","PSGOEC",19)

"BLD",18065,"KRN",9.8,"NM","B","PSGOECS",23)

"BLD",18065,"KRN",9.8,"NM","B","PSGOEF",24)

"BLD",18065,"KRN",9.8,"NM","B","PSGOT",39)

"BLD",18065,"KRN",9.8,"NM","B","PSGS0",17)

"BLD",18065,"KRN",9.8,"NM","B","PSIVCAL",34)

"BLD",18065,"KRN",9.8,"NM","B","PSIVEDT",10)

"BLD",18065,"KRN",9.8,"NM","B","PSIVORA",11)

"BLD",18065,"KRN",9.8,"NM","B","PSIVORC",21)

"BLD",18065,"KRN",9.8,"NM","B","PSIVORC1",22)

"BLD",18065,"KRN",9.8,"NM","B","PSIVOREN",20)

"BLD",18065,"KRN",9.8,"NM","B","PSIVORFA",13)

"BLD",18065,"KRN",9.8,"NM","B","PSIVORFB",35)

"BLD",18065,"KRN",9.8,"NM","B","PSIVSP",26)

"BLD",18065,"KRN",9.8,"NM","B","PSIVUTL1",36)

"BLD",18065,"KRN",9.8,"NM","B","PSJHL2",27)

"BLD",18065,"KRN",9.8,"NM","B","PSJHL3",4)

"BLD",18065,"KRN",9.8,"NM","B","PSJHL4",5)

"BLD",18065,"KRN",9.8,"NM","B","PSJHL4A",6)

"BLD",18065,"KRN",9.8,"NM","B","PSJHL5",28)

"BLD",18065,"KRN",9.8,"NM","B","PSJHL9",7)

"BLD",18065,"KRN",9.8,"NM","B","PSJHLU",8)

"BLD",18065,"KRN",9.8,"NM","B","PSJLIACT",37)

"BLD",18065,"KRN",9.8,"NM","B","PSJLIVFD",38)

"BLD",18065,"KRN",9.8,"NM","B","PSJLIVMD",14)

"BLD",18065,"KRN",9.8,"NM","B","PSJOREN",29)

"BLD",18065,"KRN",9.8,"NM","B","PSJORPOE",30)

"BLD",18065,"KRN",9.8,"NM","B","PSJORRE",1)

"BLD",18065,"KRN",9.8,"NM","B","PSJORRE1",32)

"BLD",18065,"KRN",9.8,"NM","B","PSJORREN",31)

"BLD",18065,"KRN",9.8,"NM","B","PSJORRN",2)

"BLD",18065,"KRN",9.8,"NM","B","PSJORRN1",25)

"BLD",18065,"KRN",9.8,"NM","B","PSJORRO",3)

"BLD",18065,"KRN",9.8,"NM","B","PSJORUT2",18)

"BLD",18065,"KRN",9.8,"NM","B","PSJUTL",16)

"BLD",18065,"KRN",19,0)
19
"BLD",18065,"KRN",19,"NM",0)
^9.68A^^
"BLD",18065,"KRN",19.1,0)
19.1
"BLD",18065,"KRN",101,0)
101
"BLD",18065,"KRN",409.61,0)
409.61
"BLD",18065,"KRN",771,0)
771
"BLD",18065,"KRN",870,0)
870
"BLD",18065,"KRN",8989.51,0)
8989.51
"BLD",18065,"KRN",8989.52,0)
8989.52
"BLD",18065,"KRN",8994,0)
8994
"BLD",18065,"KRN","B",.4,.4)

"BLD",18065,"KRN","B",.401,.401)

"BLD",18065,"KRN","B",.402,.402)

"BLD",18065,"KRN","B",.403,.403)

"BLD",18065,"KRN","B",.5,.5)

"BLD",18065,"KRN","B",.84,.84)

"BLD",18065,"KRN","B",3.6,3.6)

"BLD",18065,"KRN","B",3.8,3.8)

"BLD",18065,"KRN","B",9.2,9.2)

"BLD",18065,"KRN","B",9.8,9.8)

"BLD",18065,"KRN","B",19,19)

"BLD",18065,"KRN","B",19.1,19.1)

"BLD",18065,"KRN","B",101,101)

"BLD",18065,"KRN","B",409.61,409.61)

"BLD",18065,"KRN","B",771,771)

"BLD",18065,"KRN","B",870,870)

"BLD",18065,"KRN","B",8989.51,8989.51)

"BLD",18065,"KRN","B",8989.52,8989.52)

"BLD",18065,"KRN","B",8994,8994)

"BLD",18065,"QUES",0)
^9.62^^
"BLD",18065,"REQB",0)
^9.611^20^11
"BLD",18065,"REQB",5,0)
PSJ*5.0*152^2
"BLD",18065,"REQB",8,0)
PSJ*5.0*153^2
"BLD",18065,"REQB",10,0)
PSJ*5.0*180^2
"BLD",18065,"REQB",11,0)
PSJ*5.0*120^2
"BLD",18065,"REQB",13,0)
PSJ*5.0*174^2
"BLD",18065,"REQB",15,0)
PSJ*5.0*140^2
"BLD",18065,"REQB",16,0)
PSJ*5.0*141^2
"BLD",18065,"REQB",17,0)
PSJ*5.0*156^2
"BLD",18065,"REQB",18,0)
PSJ*5.0*157^2
"BLD",18065,"REQB",19,0)
PSJ*5.0*173^2
"BLD",18065,"REQB",20,0)
PSJ*5.0*201^2
"BLD",18065,"REQB","B","PSJ*5.0*120",11)

"BLD",18065,"REQB","B","PSJ*5.0*140",15)

"BLD",18065,"REQB","B","PSJ*5.0*141",16)

"BLD",18065,"REQB","B","PSJ*5.0*152",5)

"BLD",18065,"REQB","B","PSJ*5.0*153",8)

"BLD",18065,"REQB","B","PSJ*5.0*156",17)

"BLD",18065,"REQB","B","PSJ*5.0*157",18)

"BLD",18065,"REQB","B","PSJ*5.0*173",19)

"BLD",18065,"REQB","B","PSJ*5.0*174",13)

"BLD",18065,"REQB","B","PSJ*5.0*180",10)

"BLD",18065,"REQB","B","PSJ*5.0*201",20)

"FIA",53.1)
NON-VERIFIED ORDERS
"FIA",53.1,0)
^PS(53.1,
"FIA",53.1,0,0)
53.1I
"FIA",53.1,0,1)
y^y^p^^^^n^^n
"FIA",53.1,0,10)

"FIA",53.1,0,11)

"FIA",53.1,0,"RLRO")

"FIA",53.1,0,"VR")
5.0^PSJ
"FIA",53.1,53.1)
1
"FIA",53.1,53.1,128)

"MBREQ")
1
"PKG",60,-1)
1^1
"PKG",60,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",60,22,0)
^9.49I^1^1
"PKG",60,22,1,0)
5.0^2971215^2980204^64
"PKG",60,22,1,"PAH",1,0)
134^3080618^1392
"PKG",60,22,1,"PAH",1,1,0)
^^81^81^3080618
"PKG",60,22,1,"PAH",1,1,1,0)
This patch contains changes in support of Computerized Patient
"PKG",60,22,1,"PAH",1,1,2,0)
Record System (CPRS) V. 1.0 GUI v27 release.
"PKG",60,22,1,"PAH",1,1,3,0)
 
"PKG",60,22,1,"PAH",1,1,4,0)
1.  MEDICATION ROUTE CHANGES
"PKG",60,22,1,"PAH",1,1,5,0)
----------------------------
"PKG",60,22,1,"PAH",1,1,6,0)
- Inpatient Medications V. 5.0 will use the medication route received from
"PKG",60,22,1,"PAH",1,1,7,0)
  CPRS V. 1.0 as the default when finishing an IV order entered via CPRS
"PKG",60,22,1,"PAH",1,1,8,0)
  V. 1.0. For new orders entered via Inpatient Medications V. 5.0, if all
"PKG",60,22,1,"PAH",1,1,9,0)
  of the orderable items associated with an order contain the same default
"PKG",60,22,1,"PAH",1,1,10,0)
  medication route, that route will be used as the default. If there are
"PKG",60,22,1,"PAH",1,1,11,0)
  any differences, there will be no default medication route.
"PKG",60,22,1,"PAH",1,1,12,0)
 
"PKG",60,22,1,"PAH",1,1,13,0)
- Inpatient Medications V. 5.0 will send to BCMA V. 3.0 the full
"PKG",60,22,1,"PAH",1,1,14,0)
  medication route name for display on the Virtual Due List (VDL).
"PKG",60,22,1,"PAH",1,1,15,0)
 
"PKG",60,22,1,"PAH",1,1,16,0)
2.  INFUSION RATE CHANGES
"PKG",60,22,1,"PAH",1,1,17,0)
-------------------------
"PKG",60,22,1,"PAH",1,1,18,0)
- Inpatient Medications V. 5.0 now accepts infusion rate from CPRS in both
"PKG",60,22,1,"PAH",1,1,19,0)
  ml/hour and as 'infuse over time'.
"PKG",60,22,1,"PAH",1,1,20,0)
 
"PKG",60,22,1,"PAH",1,1,21,0)
- In the order view screen for an order with an intermittent IV type, the
"PKG",60,22,1,"PAH",1,1,22,0)
  infusion rate now displays as "Infuse Over" followed by the time. For
"PKG",60,22,1,"PAH",1,1,23,0)
  example, "Infuse Over 30 minutes".
"PKG",60,22,1,"PAH",1,1,24,0)
 
"PKG",60,22,1,"PAH",1,1,25,0)
  The infusion rate for an intermittent IV order can be null.
"PKG",60,22,1,"PAH",1,1,26,0)
 
"PKG",60,22,1,"PAH",1,1,27,0)
3.  IV TYPE CHANGES
"PKG",60,22,1,"PAH",1,1,28,0)
-------------------
"PKG",60,22,1,"PAH",1,1,29,0)
- Inpatient Medications V. 5.0 shall accept an IV type of "I"
"PKG",60,22,1,"PAH",1,1,30,0)
  (Intermittent) or "C" (Continuous) from CPRS V. 1.0.  When an IV type of
"PKG",60,22,1,"PAH",1,1,31,0)
  CONTINUOUS is received, Inpatient Medications V. 5.0 defaults to an IV
"PKG",60,22,1,"PAH",1,1,32,0)
  type of Admixture.  When IV type of INTERMITTENT is received, 
"PKG",60,22,1,"PAH",1,1,33,0)
  Inpatient Medications V. 5.0 defaults to an IV type of Piggyback.
"PKG",60,22,1,"PAH",1,1,34,0)
  Inpatient Medications V. 5.0 sends to CPRS V. 1.0 updates to an order's
"PKG",60,22,1,"PAH",1,1,35,0)
  IV type.
"PKG",60,22,1,"PAH",1,1,36,0)
 
"PKG",60,22,1,"PAH",1,1,37,0)
- Inpatient Medications V. 5.0 now accepts schedule information from
"PKG",60,22,1,"PAH",1,1,38,0)
  CPRS V. 1.0 for intermittent IV orders entered via the IV Fluid
"PKG",60,22,1,"PAH",1,1,39,0)
  Ordering Dialog.  Inpatient Medications V. 5.0 also sends to
"PKG",60,22,1,"PAH",1,1,40,0)
  CPRS V. 1.0 any schedule changes for intermittent IV orders.
"PKG",60,22,1,"PAH",1,1,41,0)
 
"PKG",60,22,1,"PAH",1,1,42,0)
- A new field, IV TYPE CATEGORY (#128) is being added to the NON-
"PKG",60,22,1,"PAH",1,1,43,0)
  VERIFIED ORDERS file (#53.1).  The IV TYPE CATEGORY will be "C"
"PKG",60,22,1,"PAH",1,1,44,0)
  (Continuous) for orders with an IV TYPE of Admixture, Hyperal,
"PKG",60,22,1,"PAH",1,1,45,0)
  Non-Intermittent Syringe, or Chemotherapy with a CHEMOTHERAPY TYPE
"PKG",60,22,1,"PAH",1,1,46,0)
  of Admixture, Hyperal, or Non-Intermittent Syringe.  The IV TYPE
"PKG",60,22,1,"PAH",1,1,47,0)
  CATEGORY will be "I" (Intermittent) for orders with an IV TYPE of
"PKG",60,22,1,"PAH",1,1,48,0)
  Piggyback, Intermittent Syringe, or Chemotherapy with a CHEMOTHERAPY
"PKG",60,22,1,"PAH",1,1,49,0)
  TYPE of Piggyback or Intermittent Syringe.
"PKG",60,22,1,"PAH",1,1,50,0)
 
"PKG",60,22,1,"PAH",1,1,51,0)
4.  RENEWED ORDER CHANGES
"PKG",60,22,1,"PAH",1,1,52,0)
-------------------------
"PKG",60,22,1,"PAH",1,1,53,0)
- When discontinuing pending renewal orders, Inpatient Medications V. 5.0
"PKG",60,22,1,"PAH",1,1,54,0)
  will provide the user an option to discontinue the pending renewal
"PKG",60,22,1,"PAH",1,1,55,0)
  order and/or the original orders.  The pharmacist shall be given the
"PKG",60,22,1,"PAH",1,1,56,0)
  option to discontinue the pending order, both orders, or exit the
"PKG",60,22,1,"PAH",1,1,57,0)
  discontinue function.
"PKG",60,22,1,"PAH",1,1,58,0)
 
"PKG",60,22,1,"PAH",1,1,59,0)
5.  REMOVE CALLS TO OBSOLETE ROUTINE
"PKG",60,22,1,"PAH",1,1,60,0)
------------------------------------
"PKG",60,22,1,"PAH",1,1,61,0)
- At the request of CPRS V. 1.0, active calls to obsolete routine OR3CONV
"PKG",60,22,1,"PAH",1,1,62,0)
  have been removed from Inpatient Medications V. 5.0. 
"PKG",60,22,1,"PAH",1,1,63,0)
 
"PKG",60,22,1,"PAH",1,1,64,0)
6.  EXPECTED FIRST DOSE FOR ONE-TIME ORDERS (HD 98365)
"PKG",60,22,1,"PAH",1,1,65,0)
------------------------------------------------------
"PKG",60,22,1,"PAH",1,1,66,0)
Problem:
"PKG",60,22,1,"PAH",1,1,67,0)
   During testing of the CPRS V. 1.0 GUI v26 release, sites reported a
"PKG",60,22,1,"PAH",1,1,68,0)
   problem with an incorrect display of expected first dose for orders
"PKG",60,22,1,"PAH",1,1,69,0)
   with a schedule type of "ONE TIME".
"PKG",60,22,1,"PAH",1,1,70,0)
Resolution:
"PKG",60,22,1,"PAH",1,1,71,0)
   If the schedule type is "ONE TIME", do not display an Expected
"PKG",60,22,1,"PAH",1,1,72,0)
   First Dose for the order.
"PKG",60,22,1,"PAH",1,1,73,0)
 
"PKG",60,22,1,"PAH",1,1,74,0)
7.  CORRECT ABBREVIATION OF MILLIMOLE (HD 145562)
"PKG",60,22,1,"PAH",1,1,75,0)
-------------------------------------------
"PKG",60,22,1,"PAH",1,1,76,0)
Problem:
"PKG",60,22,1,"PAH",1,1,77,0)
   The correct abbreviation for the word MILLIMOLE, which is MMOL
"PKG",60,22,1,"PAH",1,1,78,0)
   is not available in the system.
"PKG",60,22,1,"PAH",1,1,79,0)
Resolution:
"PKG",60,22,1,"PAH",1,1,80,0)
   The abbreviation for Millimole, "MMOL", will be included in
"PKG",60,22,1,"PAH",1,1,81,0)
   this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
37
"RTN","PSGOE1")
0^9^B29072557
"RTN","PSGOE1",1,0)
PSGOE1 ;BIR/CML3-ACTION ON INPATIENT ORDERS ;10 Mar 99 / 10:54 AM
"RTN","PSGOE1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,19,26,39,58,85,80,110,127,133,134**;16 DEC 97;Build 124
"RTN","PSGOE1",3,0)
 ;
"RTN","PSGOE1",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOE1",5,0)
 ; Reference to ^PSDRUG( is supported by DBIA #2192.
"RTN","PSGOE1",6,0)
 ; Reference to EN1^ORCFLAG is supported by DBIA #3620.
"RTN","PSGOE1",7,0)
 ; Reference to AND^ORX8 is supported by DBIA #3632.
"RTN","PSGOE1",8,0)
EN ;       
"RTN","PSGOE1",9,0)
 K PSGDFLG,PSGPFLG S PSGOEA="^",PSGACT="",(PSGDI,PSGOENG,PSGPI,PSGRRF)=0
"RTN","PSGOE1",10,0)
 Q:'$G(DUZ)
"RTN","PSGOE1",11,0)
 D @$S(PSGORD["P":"NON",1:"ACT")
"RTN","PSGOE1",12,0)
GO ;
"RTN","PSGOE1",13,0)
 K A,ND,PSGE,PSGR,ST,X,X1,X2,Y I $D(ORACTION) K PSGDI,PSGOENG,PSGPI Q
"RTN","PSGOE1",14,0)
 Q
"RTN","PSGOE1",15,0)
ENACTION(PSGP,PSGORD)        ;
"RTN","PSGOE1",16,0)
 ;Returns string identifying the actions allowed on this order.
"RTN","PSGOE1",17,0)
 D EN
"RTN","PSGOE1",18,0)
 Q PSGACT
"RTN","PSGOE1",19,0)
DONE ;
"RTN","PSGOE1",20,0)
 I PSGORD["U"!(PSGORD["O") L -^PS(55,PSGP,5,+PSGORD)
"RTN","PSGOE1",21,0)
 E  L -^PS(53.1,+PSGORD)
"RTN","PSGOE1",22,0)
 K C,PSGACT,PSGDFLG,PSGPFLG,PSGDI,PSGOENG,PSGPI,PSGRRF Q
"RTN","PSGOE1",23,0)
B ; bypass
"RTN","PSGOE1",24,0)
 S PSGCANFL=1
"RTN","PSGOE1",25,0)
 Q
"RTN","PSGOE1",26,0)
C ; copy an order (does NOT discontinue original order)
"RTN","PSGOE1",27,0)
 D ^PSGOD Q
"RTN","PSGOE1",28,0)
D ; discontinue (or delete) an order
"RTN","PSGOE1",29,0)
 I PSGOEAV,'$D(PSGODF) D ENDS^PSGPO Q
"RTN","PSGOE1",30,0)
 D ENO^PSGOEC(PSGP,PSGORD) Q
"RTN","PSGOE1",31,0)
E ; edit orders
"RTN","PSGOE1",32,0)
 D ^PSGOEE Q
"RTN","PSGOE1",33,0)
F ; finish released orders
"RTN","PSGOE1",34,0)
 D ^PSGOEF Q
"RTN","PSGOE1",35,0)
H(PSGP,PSGORD) ; hold
"RTN","PSGOE1",36,0)
 S X=$G(^PS(55,PSGP,5,+PSGORD,4)) I $P(X,U,12),$P(X,U,13) W $C(7),!!,"WARNING!  THIS ORDER HAS BEEN MARKED FOR CANCELLATION."
"RTN","PSGOE1",37,0)
 I $P($G(^PS(55,PSGP,5,+PSGORD,0)),"^",9)="H" D ^PSGOEH0 Q
"RTN","PSGOE1",38,0)
 D ^PSGOEH1 Q
"RTN","PSGOE1",39,0)
I ; mark (or unmark) a non-verified order as 'incomplete'
"RTN","PSGOE1",40,0)
 D ^PSGOEI Q
"RTN","PSGOE1",41,0)
L ; display logs
"RTN","PSGOE1",42,0)
 D ^PSGOEL Q
"RTN","PSGOE1",43,0)
N ; mark order as 'not to be given'
"RTN","PSGOE1",44,0)
 D ^PSGOENG Q
"RTN","PSGOE1",45,0)
O ; Outpatient (discharge) med
"RTN","PSGOE1",46,0)
 W !!,"UNDER DEVELOPMENT, NOT CURRENTLY AVAILABLE."
"RTN","PSGOE1",47,0)
 Q
"RTN","PSGOE1",48,0)
P ; print expanded view
"RTN","PSGOE1",49,0)
 D ^PSGVWP Q
"RTN","PSGOE1",50,0)
R ; renew an order
"RTN","PSGOE1",51,0)
 I 'PSJSYSU,$D(^PS(55,PSGP,5,+PSGORD,4)),$P(^(4),"^",15),$P(^(4),"^",16) W !!,"THIS ORDER IS ALREADY MARKED FOR RENEWAL!" Q
"RTN","PSGOE1",52,0)
 I 'PSGRRF D ^PSGOER Q
"RTN","PSGOE1",53,0)
 D ^PSGOERI Q
"RTN","PSGOE1",54,0)
S ; show the order again
"RTN","PSGOE1",55,0)
 D EN2^PSGVW Q
"RTN","PSGOE1",56,0)
V ; verify an order
"RTN","PSGOE1",57,0)
 D EN^PSGOEV Q
"RTN","PSGOE1",58,0)
ACT ;
"RTN","PSGOE1",59,0)
 S X=$G(^PS(55,PSGP,5,+PSGORD,0)),ND0=X,ND=$G(^(4)),ND2=$G(^(2)),PSGOENG=$P(X,"^",22),PSGR=$E("R",'PSGOENG),PSJCOM=$P($G(^PS(55,PSGP,5,+PSGORD,.2)),U,8)
"RTN","PSGOE1",60,0)
 I 'PSGOENG,PSJCOM S PSGR=$E("R",$$AND^ORX8(PSJCOM)) S:PSGR="R" PSGR=$E("R",$$RNEWOK^PSJUTL2(PSJCOM,PSGP))
"RTN","PSGOE1",61,0)
 S PSGR=$E("R",'$$EXPIRED^PSGOER(PSGP,PSGORD)) S PSGR=$E("R",$P(ND0,"^",7)'="O")
"RTN","PSGOE1",62,0)
 I $P(ND2,U,4)'>PSGDT D OLD Q
"RTN","PSGOE1",63,0)
 S PSGE="E" I '$D(PSGOETOF) S (PSGDFLG,PSGDI)='$$DDOK^PSGOE2("^PS(55,"_PSGP_",5,"_+PSGORD_",1,",+$G(^PS(55,PSGP,5,+PSGORD,.2))),PSGPFLG='$$OIOK^PSGOE2(+$G(^PS(55,PSGP,5,+PSGORD,.2)))
"RTN","PSGOE1",64,0)
 S:$P(X,"^",26) (PSGE,PSGR)=""
"RTN","PSGOE1",65,0)
 I '$D(PSGOETOF) S PSGPI=$P(X,"^",2) I PSGPI S PSGPI=$P($G(^VA(200,PSGPI,"PS")),"^",4) S:PSGPI PSGPI=PSGPI'>DT
"RTN","PSGOE1",66,0)
 S ST=$P(X,"^",9)="H"*4 S:ST (PSGE,PSGR)=""
"RTN","PSGOE1",67,0)
 N CMPOK S CMPOK=1 I $$COMPLEX^PSJOE(PSGP,PSGORD) S CMPOK=+$P(^PS(55,PSGP,5,+PSGORD,.2),"^",8)
"RTN","PSGOE1",68,0)
 S PSGACT="D"_$S('$G(CMPOK):"",1:PSGE)_$S($P(ND,"^",18+ST)&'$P(ND,"^",19+ST)&'$P(ND,"^",PSJSYSU):"",1:"H")_"L"_$S(ST:"",1:PSGR)
"RTN","PSGOE1",69,0)
 I PSJSYSU,'$P(ND,"^",+PSJSYSU) S PSGACT=PSGACT_"V"
"RTN","PSGOE1",70,0)
 I +PSJSYSU=3,$L($T(EN1^ORCFLAG)) S PSGACT=PSGACT_"G"
"RTN","PSGOE1",71,0)
 Q
"RTN","PSGOE1",72,0)
OLD ;
"RTN","PSGOE1",73,0)
 S A=$P(ND0,"^",9),PSGACT=$E("H",A="H")_"L" I A'["D",A'["E" Q
"RTN","PSGOE1",74,0)
 I 'PSGOENG,($D(^XUSEC("PSJU MGR",DUZ))!$D(^XUSEC("PSJ RPHARM",DUZ))) S PSGACT="LN"
"RTN","PSGOE1",75,0)
 I PSJSYSU,'$P(ND,"^",+PSJSYSU) S:(A'["D")&($G(PSGPRIO)'="DONE") PSGACT="D"_PSGACT S PSGACT=PSGACT_"V" Q
"RTN","PSGOE1",76,0)
 Q:PSGR=""!'PSJPCAF  D NOW^%DTC S (PSGDT,X1)=+$E(%,1,12),X2=-4 D C^%DTC I $S('$P(ND2,"^",4):1,1:$P(ND2,"^",4)'>X) Q
"RTN","PSGOE1",77,0)
 I A="E",$G(PSJPRI)'="D" S PSGACT=PSGACT_PSGR Q
"RTN","PSGOE1",78,0)
 I PSJSYSU,$P(ND,"^",11) S PSGACT=PSGACT_PSGR,PSGRRF=1
"RTN","PSGOE1",79,0)
 Q
"RTN","PSGOE1",80,0)
NON ;
"RTN","PSGOE1",81,0)
 N XND,DRGPT,XND2
"RTN","PSGOE1",82,0)
 S (X,XND)=$G(^PS(53.1,+PSGORD,0)) I $P(X,"^",19),$D(^PS(55,PSGP,5,$P(X,"^",19))) L -^PS(53.1,+PSGORD) S PSGORD=$P(X,"^",19)_"U" G ACT
"RTN","PSGOE1",83,0)
 I $S($P(X,"^",26):1,$P(X,"^",9)["D":1,1:$P(X,"^",9)["E") S:$P(X,U,9)="P"&($P(X,U,26)) PSGACT="D" S:(+PSJSYSU=3)&($L($T(EN1^ORCFLAG))) PSGACT=PSGACT_"G" Q
"RTN","PSGOE1",84,0)
 I PSGORD["U" S PSGACT="DE" S:(+PSJSYSU=3)&($L($T(EN1^ORCFLAG))) PSGACT=PSGACT_"G" Q
"RTN","PSGOE1",85,0)
 I '$D(PSGOETOF) S (PSGDFLG,PSGDI)='$$DDOK^PSGOE2("^PS(53.1,"_+PSGORD_",1,",+$G(^PS(53.1,+PSGORD,.2))),PSGPFLG='$$OIOK^PSGOE2(+$G(^PS(53.1,+PSGORD,.2)))
"RTN","PSGOE1",86,0)
 S DRG=$$STUFFDD^PSGOE2 S:DRG ^PS(53.1,+PSGORD,1,0)="^53.11P^1^1",^PS(53.1,+PSGORD,1,1,0)=DRG,^PS(53.1,+PSGORD,1,"B",DRG,1)=""
"RTN","PSGOE1",87,0)
 F DRG=0:0 S DRG=$O(^PS(53.1,+PSGORD,1,DRG)) Q:'DRG  S DRGPT=^(DRG,0) S INACTDT=$G(^PSDRUG(+DRGPT,"I")) I INACTDT,(INACTDT'>DT) S PSGDFLG=1
"RTN","PSGOE1",88,0)
 I $P(XND,U,9)="P" S PSGACT=$S(+PSJSYSU=3:"BDEF",$G(PSJRNF):"BDEF",1:"") S:(+PSJSYSU=3)&($L($T(EN1^ORCFLAG))) PSGACT=PSGACT_"G" Q
"RTN","PSGOE1",89,0)
 I '$D(PSGOETOF) S PSGPI=$P(XND,"^",2) I PSGPI S PSGPI=$P($G(^VA(200,PSGPI,"PS")),"^",4) S:PSGPI PSGPI=PSGPI'>DT
"RTN","PSGOE1",90,0)
 S PSGACT="DEI" I PSJSYSU,'PSGPI,$P(XND,"^",9)'="I" S PSGACT=PSGACT_"V"
"RTN","PSGOE1",91,0)
 S XND2=$G(^PS(53.1,+PSGORD,.2)) I $P(XND2,"^",8),$P(XND,"^",9)="P" S PSGACT=$TR(PSGACT,"V")
"RTN","PSGOE1",92,0)
 I +PSJSYSU=3,$L($T(EN1^ORCFLAG)) S PSGACT=PSGACT_"G"
"RTN","PSGOE1",93,0)
 I $P($G(PSGRDTX),U,2)]"",'$P($G(^PS(53.1,+PSGORD,2.5)),"^",2) S $P(^PS(53.1,+PSGORD,2.5),U,2)=$P(PSGRDTX,U,2)
"RTN","PSGOE1",94,0)
 Q
"RTN","PSGOE1",95,0)
ACTO ;
"RTN","PSGOE1",96,0)
 S PSGACTO="" I $G(PSGACT)]"" F X=1:1:$L(PSGACT) S PSGACTO=PSGACTO_$S($E(PSGACT,X)="D":"DC",1:$E(PSGACT,X))_" "
"RTN","PSGOE1",97,0)
 S:PSGACTO]"" PSGACTO=$E(PSGACTO,1,$L(PSGACTO)-1) Q
"RTN","PSGOE6")
0^33^B24315055
"RTN","PSGOE6",1,0)
PSGOE6 ;BIR/CML3-ORDER ENTRY THROUGH OE/RR ;10 Mar 98 / 2:35 PM
"RTN","PSGOE6",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,7,39,45,65,58,81,156,134**;16 DEC 97;Build 124
"RTN","PSGOE6",3,0)
 ;
"RTN","PSGOE6",4,0)
 ; Reference to ^PS(50.7 supported by DBIA #2180.
"RTN","PSGOE6",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA #2177.
"RTN","PSGOE6",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA #2178.
"RTN","PSGOE6",7,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOE6",8,0)
 ; Reference to ^DD(53.1 is supported by DBIA #2256.
"RTN","PSGOE6",9,0)
 ; Reference to ^VA(200 is supported by DBIA #10060.
"RTN","PSGOE6",10,0)
 ; Reference to ^DICN is supported by DBIA #10009.
"RTN","PSGOE6",11,0)
 ;
"RTN","PSGOE6",12,0)
 K PSGFOK S F1=53.1,PSGPR=$S($D(PSGOERR):PSJORPV,1:PSGOEPR),PSGMR=$S($P(PSGNEDFD,"^",2):$P(PSGNEDFD,"^",2),1:PSGOEDMR),PSGSCH=$P(PSGNEDFD,"^",4),(PSGOROE1,PSGSI,SDT,PSGMRN,PSGSM,PSGHSM,PSGUD,PSGSD,PSGFD,PSGSI,PSGNEFD,PSGNESD)=""
"RTN","PSGOE6",13,0)
 S:PSGMR PSGMRN=$S('$P(PSGNEDFD,"^",2):"ORAL",'$D(^PS(51.2,PSGMR,0)):PSGMR,$P(^(0),"^")]"":$P(^(0),"^"),1:PSGMR) I PSGPR S PSGPRN=$P($G(^VA(200,PSGPR,0)),"^") S:PSGPRN="" PSGPRN=PSGPR
"RTN","PSGOE6",14,0)
 S PSGST=$S($P(PSGNEDFD,"^",3)]"":$P(PSGNEDFD,"^",3),1:"C")
"RTN","PSGOE6",15,0)
 ; Naked references in line below refer to ^PS(53.45,PSJSYSP
"RTN","PSGOE6",16,0)
 K ^PS(53.45,PSJSYSP,1),^(2) I PSGDRG S ^(2,0)="^53.4502P^"_PSGDRG_"^1",^(1,0)=PSGDRG,^PS(53.45,PSJSYSP,2,"B",PSGDRG,1)=""
"RTN","PSGOE6",17,0)
 ;
"RTN","PSGOE6",18,0)
109 ; dosage ordered
"RTN","PSGOE6",19,0)
 W !,"DOSAGE ORDERED: ",$S(PSGDO]"":PSGDO_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE6",20,0)
 I X="" S X=PSGDO I X="" W $C(7),"  (Required)" G 109
"RTN","PSGOE6",21,0)
 S PSGF2=109 I X="@" W $C(7),"  (Required)" G 109
"RTN","PSGOE6",22,0)
 I X?1."?" S F1=53.1 D ENHLP^PSGOEM(53.1,109) G 109
"RTN","PSGOE6",23,0)
 I $E(X)="^" D FF G:Y>0 @Y G 109
"RTN","PSGOE6",24,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSGOE6",25,0)
 I $S(X?.E1C.E:1,$L(X)>20:1,X="":1,X["^":1,X?1.P:1,1:X=+X) W $C(7),"  ",$S(X?1.P!(X=""):"(Required)",1:"??") S X="?" D ENHLP^PSGOEM(53.1,109) G 109
"RTN","PSGOE6",26,0)
 S PSGDO=X,PSGFOK(109)=""
"RTN","PSGOE6",27,0)
 ;
"RTN","PSGOE6",28,0)
3 ; med route
"RTN","PSGOE6",29,0)
 W !,"MED ROUTE: ",$S(PSGMR:PSGMRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE6",30,0)
 I X="",PSGMR S X=PSGMRN I PSGMR'=PSGMRN,$D(^PS(51.2,PSGMR,0)) W "  "_$P(^(0),"^",3) S PSGFOK(3)="" G 26
"RTN","PSGOE6",31,0)
 S PSGF2=3 I $S(X="@":1,X]"":0,1:'PSGMR) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,3) G 3
"RTN","PSGOE6",32,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,3)
"RTN","PSGOE6",33,0)
 I $E(X)="^" D FF G:Y>0 @Y G 3
"RTN","PSGOE6",34,0)
 K DIC S DIC="^PS(51.2,",DIC(0)="EMQZ",DIC("S")="I $P(^(0),""^"",4)" D ^DIC K DIC I Y'>0 G 3
"RTN","PSGOE6",35,0)
 S PSGMR=+Y,PSGMRN=Y(0,0),PSGFOK(3)=""
"RTN","PSGOE6",36,0)
 ;
"RTN","PSGOE6",37,0)
26 ; schedule
"RTN","PSGOE6",38,0)
 W !,"SCHEDULE: ",$S(PSGSCH]"":PSGSCH_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE6",39,0)
 S:X="" X=PSGSCH S PSGF2=26 ; I "@"[X W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,26) G 26
"RTN","PSGOE6",40,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,26) G 26
"RTN","PSGOE6",41,0)
 I $E(X)="^" D FF G:Y>0 @Y G 26
"RTN","PSGOE6",42,0)
 I X="" S (PSGS0XT,PSGS0Y,PSGST)=""
"RTN","PSGOE6",43,0)
 E  D EN^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,26) G 26
"RTN","PSGOE6",44,0)
 S PSGSCH=X,(PSGFOK(26),PSGST)="",PSGOES=1 S:PSGS0XT="O" $P(PSGNEDFD,"^",3)="O",PSGST="O" D ^PSGNE3 K PSGOES
"RTN","PSGOE6",45,0)
 ;
"RTN","PSGOE6",46,0)
66 ; provider's comments
"RTN","PSGOE6",47,0)
 ;
"RTN","PSGOE6",48,0)
 ;
"RTN","PSGOE6",49,0)
DONE ;
"RTN","PSGOE6",50,0)
 I PSGOROE1 K Y W $C(7),"  ...order not entered..."
"RTN","PSGOE6",51,0)
 K F,F0,F1,PSGF2,F3,PSGFOK,SDT Q
"RTN","PSGOE6",52,0)
 ;
"RTN","PSGOE6",53,0)
FF ; up-arrow to another field
"RTN","PSGOE6",54,0)
 S Y=-1 I '$D(PSGFOK) W $C(7),"  ??" Q
"RTN","PSGOE6",55,0)
 S X=$E(X,2,99) I X=+X S Y=$S($D(PSGFOK(X)):X,1:-1) W "  " W:Y>0 $$CODES2^PSIVUTL(53.1,X) W:Y'>0 $C(7),"??" Q
"RTN","PSGOE6",56,0)
 K DIC S DIC="^DD(53.1,",DIC(0)="QEM",DIC("S")="I $D(PSGFOK(+Y))" D ^DIC K DIC S Y=+Y
"RTN","PSGOE6",57,0)
 Q
"RTN","PSGOE6",58,0)
 ;
"RTN","PSGOE6",59,0)
DEL ;
"RTN","PSGOE6",60,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W "  <NOTHING DELETED>"
"RTN","PSGOE6",61,0)
 Q
"RTN","PSGOE6",62,0)
 ;
"RTN","PSGOE6",63,0)
GTST(ON) ; Find schedule type for pending order.
"RTN","PSGOE6",64,0)
 N PD,PDAP,ST,X,ST1 S ST=""
"RTN","PSGOE6",65,0)
 S ST=$P($G(^PS(53.1,+ON,0)),"^",7)
"RTN","PSGOE6",66,0)
 I $P($G(^PS(53.1,+ON,0)),U,24)="R" D
"RTN","PSGOE6",67,0)
 .; naked ref below is from line above, ^PS(53.1,ON,0)
"RTN","PSGOE6",68,0)
 .S X=$P(^(0),U,25) S ST=$S(X["N"!(X["P"):$P($G(^PS(53.1,+X,0)),U,7),X["V":"C",1:$P($G(^PS(55,PSGP,5,+X,0)),U,7))
"RTN","PSGOE6",69,0)
 .I ST]"" S (PSGOST,PSGST)=ST,PSGSTN=$$ENSTN^PSGMI(ST) Q
"RTN","PSGOE6",70,0)
 I ST'="" D
"RTN","PSGOE6",71,0)
 . S ST1=""
"RTN","PSGOE6",72,0)
 . S PD=+$G(^PS(53.1,+ON,.2)) S X=$G(^PS(50.7,PD,0)),ST1=$P(X,U,7)
"RTN","PSGOE6",73,0)
 . I $G(ST1)="R" S ST="R"
"RTN","PSGOE6",74,0)
 . K ST1
"RTN","PSGOE6",75,0)
 I ST="" D
"RTN","PSGOE6",76,0)
 . ;PSJ*5*156 - Don't allow backdoor to override intended schedule type from CPRS unless the default
"RTN","PSGOE6",77,0)
 . ;            schedule type (if any) is "Fill on Request".
"RTN","PSGOE6",78,0)
 . S PD=+$G(^PS(53.1,+ON,.2)) S X=$G(^PS(50.7,PD,0)),ST=$P(X,U,7)  ;see if there is a default schedule type.
"RTN","PSGOE6",79,0)
 . I ST="R" Q  ;Fill on Request default schedule type will override incoming schedule type from CPRS
"RTN","PSGOE6",80,0)
 . S ST=""  ;Reset to null in case default schedule type other than Fill on Request is defined.
"RTN","PSGOE6",81,0)
 . D OTS I ST="O" Q
"RTN","PSGOE6",82,0)
 . I PSGSCH="ON CALL"!(PSGSCH="ONCALL")!(PSGSCH="ON-CALL") S ST="OC" Q
"RTN","PSGOE6",83,0)
 . I PSGSCH["PRN" S ST="P" Q
"RTN","PSGOE6",84,0)
 . S ST="C"
"RTN","PSGOE6",85,0)
 S (PSGOST,PSGST)=ST,PSGSTN=$$ENSTN^PSGMI(ST)
"RTN","PSGOE6",86,0)
 Q
"RTN","PSGOE6",87,0)
OTS I PSGSCH]"" S X=+$O(^PS(51.1,"B",PSGSCH,0)) I $P($G(^PS(51.1,X,0)),"^",5)="O" S ST="O" Q
"RTN","PSGOE6",88,0)
 I PSGSCH="TODAY"!(PSGSCH="NOW")!(PSGSCH="STAT")!(PSGSCH="ONCE")!(PSGSCH="ONE TIME")!(PSGSCH="ONE-TIME")!(PSGSCH="ONETIME")!(PSGSCH="1TIME")!(PSGSCH="1 TIME")!(PSGSCH="1-TIME") S ST="O"
"RTN","PSGOE6",89,0)
 Q
"RTN","PSGOEC")
0^19^B67210353
"RTN","PSGOEC",1,0)
PSGOEC ;BIR/CML3-CANCEL ORDERS ;02 Mar 99 / 9:29 AM
"RTN","PSGOEC",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**23,58,110,175,201,134**;16 DEC 97;Build 124
"RTN","PSGOEC",3,0)
 ;
"RTN","PSGOEC",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGOEC",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA 2789.
"RTN","PSGOEC",6,0)
 ; 
"RTN","PSGOEC",7,0)
ENA ; all orders
"RTN","PSGOEC",8,0)
 D ENCV^PSGSETU Q:$D(XQUIT)  S CF=$P(PSJSYSP0,U,5) N ND,ND1 S ND="$D(^PS(55,PSGP,5,PSGDA,4)),$P(^(4),U,12),$P(^(4),U,13)",ND1="$D(^PS(53.1,PSGDA,4)),$P(^(4),U,12),$P(^(4),U,13)"
"RTN","PSGOEC",9,0)
 F  W !!,"Do you want to ",$S(CF:"discontinue",1:"mark for discontinuation")," all of this patient's orders" S %=1 D YN^DICN Q:%  D ENCAM^PSGOEM
"RTN","PSGOEC",10,0)
 S PSGCF=0 Q:%<0  S PSGCF=1,T=$E("T",'PSJSYSU) G:%=1 ENCA F T=0:0 S T=$O(^PS(55,PSGP,5,"AUS",T)) Q:'T  F PSGDA=0:0 S PSGDA=$O(^PS(55,PSGP,5,"AUS",T,PSGDA)) Q:'PSGDA  I @ND Q
"RTN","PSGOEC",11,0)
 E  F PSGDA=0:0 S PSGDA=$O(^PS(53.1,"AC",PSGP,PSGDA)) Q:'PSGDA  I @ND1 Q
"RTN","PSGOEC",12,0)
 E  G DONE
"RTN","PSGOEC",13,0)
 W !!,"SOME OR ALL OF THESE ORDERS HAVE" D ENUMK^PSGOEM Q:%'=1
"RTN","PSGOEC",14,0)
 W !!,"...a few moments, please..." S PSGAL("C")=PSJSYSU*10+21400
"RTN","PSGOEC",15,0)
 F T=PSGDT:0 S T=$O(^PS(55,PSGP,5,"AUS",T)) Q:'T  F PSGDA=0:0 S PSGDA=$O(^PS(55,PSGP,5,"AUS",T,PSGDA)) Q:'PSGDA  I @ND W "." D RS,^PSGAL5
"RTN","PSGOEC",16,0)
 F PSGDA=0:0 S PSGDA=$O(^PS(53.1,"AC",PSGP,PSGDA)) Q:'PSGDA  I @ND1 W "." D RS
"RTN","PSGOEC",17,0)
 W " . . . DONE!" G DONE
"RTN","PSGOEC",18,0)
ENCA ;
"RTN","PSGOEC",19,0)
 D NOW^%DTC S (Q1,PSGDT)=+$E(%,1,12) F  S Q1=$O(^PS(55,PSGP,5,"AUS",Q1)) Q:'Q1  F Q2=0:0 S Q2=$O(^PS(55,PSGP,5,"AUS",Q1,Q2)) Q:'Q2  I $P($G(^PS(55,PSGP,5,Q2,0)),"^",21) Q
"RTN","PSGOEC",20,0)
 E  F Q2=0:0 S Q2=$O(^PS(53.1,"AC",PSGP,Q2)) Q:'Q2  I $P($G(^PS(53.1,Q2,0)),U,21) Q
"RTN","PSGOEC",21,0)
 I  S PSJNOO=$$ENNOO^PSJUTL5("D") I PSJNOO<0!('$$REQPROV) D  G DONE
"RTN","PSGOEC",22,0)
 .W !!,$C(7),"No changes made to this order." D PAUSE^VALM1
"RTN","PSGOEC",23,0)
 S PSGALR=$S('$D(PSGALO):20,PSGALO?4N&($E(PSGALO)=1):10,1:20) I $P(PSJSYSP0,U,5) D ENHE^PSJADT0 S PSGOP=PSGP D ASET
"RTN","PSGOEC",24,0)
 F SD=PSGDT:0 S SD=$O(^PS(55,PSGP,5,"AUS",SD)) Q:'SD  F PSGORD=0:0 S PSGORD=$O(^PS(55,PSGP,5,"AUS",SD,PSGORD)) Q:'PSGORD  S PSGORD=+PSGORD_"A" D AC
"RTN","PSGOEC",25,0)
 D NSET S CF=$P(PSJSYSP0,U,5) F PSGORD=0:0 S PSGORD=$O(^PS(53.1,"AC",PSGP,PSGORD)) Q:'PSGORD  S PSGORD=+PSGORD_"N" D NC
"RTN","PSGOEC",26,0)
 W " . . . DONE!" K PSGORD G DONE
"RTN","PSGOEC",27,0)
ENO(PSGP,PSGORD) ; single order
"RTN","PSGOEC",28,0)
 I PSGSTAT="D" W !,"This order has already been DISCONTINUED." D PAUSE^VALM1 Q
"RTN","PSGOEC",29,0)
 S CF=$S($P(PSJSYSP0,U,5):1,PSGORD["U":0,1:($P($G(^PS(53.1,+PSGORD,0)),U,25)=""&($P($G(^(4)),U,7)=DUZ)))
"RTN","PSGOEC",30,0)
 S PSJCOM=+$S(PSGORD["U":$P($G(^PS(55,PSGP,5,+PSGORD,.2)),"^",8),1:$P($G(^PS(53.1,+PSGORD,.2)),"^",8))
"RTN","PSGOEC",31,0)
 I 'CF,PSJCOM W !!,"This order is part of a complex order and CANNOT be marked for discontinuation." Q
"RTN","PSGOEC",32,0)
 I $$PNDRNOK(PSGORD) N PSJDCTYP S PSJDCTYP=$$PNDRNA(PSGORD) D:(PSJDCTYP=1!(PSJDCTYP=2)) PNDRN($G(PSJDCTYP),PSGORD) G DONE
"RTN","PSGOEC",33,0)
 I PSJCOM W !!,"This order is part of a complex order. If you discontinue this order the",!,"following orders will be discontinued too (unless the stop date has already",!,"been reached)." D CMPLX^PSJCOM1(PSGP,PSJCOM,PSGORD)
"RTN","PSGOEC",34,0)
 F  W !!,"Do you want to ",$S(PSJCOM:"discontinue this series of complex orders",CF:"discontinue this order",1:"mark this order for discontinuation") S %=1 D YN^DICN Q:%  D ENCOM^PSGOEM
"RTN","PSGOEC",35,0)
 I %<0 S VALMBCK="" Q
"RTN","PSGOEC",36,0)
 G:%=1 SOC I $S(PSGORD["U":$D(^PS(55,PSGP,5,+PSGORD,4)),1:$D(^PS(53.1,+PSGORD,4))),$P(^(4),U,12) W !!,"THIS ORDER HAS"
"RTN","PSGOEC",37,0)
 I  D ENUMK^PSGOEM I %=1 W "..." K DA S:PSGORD["A" PSGAL("C")=PSJSYSU*10+21400,DA=+PSGORD,DA(1)=PSGP D RS,^PSGAL5:PSGORD["A" W " . . . DONE!"
"RTN","PSGOEC",38,0)
 G DONE
"RTN","PSGOEC",39,0)
SOC ;
"RTN","PSGOEC",40,0)
 I 'CF,'$P($S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,0)),1:$G(^PS(53.1,+PSGORD,0))),U,21) W !!,"...one moment, please..."
"RTN","PSGOEC",41,0)
 E  I CF,'($G(PSJDCTYP)=2) S PSJNOO=$$ENNOO^PSJUTL5("D") I PSJNOO<0 D ABORT^PSGOEE G DONE
"RTN","PSGOEC",42,0)
 ; prompt for requesting provider
"RTN","PSGOEC",43,0)
 I '($G(PSJDCTYP)=2) I CF,'$$REQPROV D ABORT^PSGOEE G DONE
"RTN","PSGOEC",44,0)
 K DA D NOW^%DTC S PSGDT=%,T=$E("T",'PSJSYSU),PSGALR=20,DA=+PSGORD,DA(1)=PSGP
"RTN","PSGOEC",45,0)
 I 'PSJCOM D
"RTN","PSGOEC",46,0)
 .I PSGORD["U" D ASET:CF,AC
"RTN","PSGOEC",47,0)
 .I PSGORD'["U" D NSET:CF,NC
"RTN","PSGOEC",48,0)
 I PSJCOM N COMFLG S COMFLG=0 D
"RTN","PSGOEC",49,0)
 . I PSGORD["P" Q:('$$LOCK^PSJOEA(PSGP,PSJCOM))  D 
"RTN","PSGOEC",50,0)
 .. N O S O="" F  S O=$O(^PS(53.1,"ACX",PSJCOM,O)) Q:O=""  S (PSGORD,PSJORD)=O_"P" D NSET,NC
"RTN","PSGOEC",51,0)
 .I PSGORD["U" N O,OO S O=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  Q:COMFLG  D
"RTN","PSGOEC",52,0)
 .. Q:OO=PSGORD  I '$$LS^PSSLOCK(DFN,OO) S COMFLG=1 Q
"RTN","PSGOEC",53,0)
 I PSJCOM Q:COMFLG  N O,OO S O=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  D
"RTN","PSGOEC",54,0)
 . I OO["V" S ON55=OO D D1^PSIVOPT2 S PSIVALT=1,PSIVALCK="STOP",PSIVREA="D",ON=ON55,P(3)=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3) D
"RTN","PSGOEC",55,0)
 .. D LOG^PSIVORAL N PSJORD S PSJORD=ON55,P(3)=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3),P("NAT")=PSJNOO D HL^PSIVORA
"RTN","PSGOEC",56,0)
 . I OO["U" N PSGORD,PSJORD S (PSGORD,PSJORD)=OO D ASET^PSGOEC,AC^PSGOEC
"RTN","PSGOEC",57,0)
 Q
"RTN","PSGOEC",58,0)
D1 N %,DA,DIE,DIU,STP,NSTOP
"RTN","PSGOEC",59,0)
 D NOW^%DTC S NSTOP=+$E(%,1,12),STP=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3),NSTOP=+$S(STP>NSTOP:NSTOP,1:STP),P(17)="D"
"RTN","PSGOEC",60,0)
 S DA(1)=DFN,DA=+ON55,DIE="^PS(55,"_DFN_",""IV"",",DR="109////"_NSTOP_$S('$P($G(^PS(55,DFN,"IV",+ON55,2)),U,7):";116////"_STP,1:"")_";100///D;.03////"_NSTOP,PSIVACT=1 D ^DIE
"RTN","PSGOEC",61,0)
 I $S($G(PSIVAC)="OD":0,$G(PSIVAC)'="AD":1,$G(PSGALO)<1060:0,1:$P($G(PSJSYSW0),U,15)) S X=$S($G(PSIVAC)="AD":1,1:2) D ENLBL^PSIVOPT(X,$S(X=1:+$G(PSGUOW),1:DUZ),DFN,3,+ON55,$E("AD",1,3-X))
"RTN","PSGOEC",62,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN Q:'PSJIVORF  ;* S ORIFN=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,21) Q:'ORIFN
"RTN","PSGOEC",63,0)
 Q
"RTN","PSGOEC",64,0)
OUT ;
"RTN","PSGOEC",65,0)
 W $S(PSJCOM:"...ORDER ",1:"...ORDERS "),$S(CF:"DISCONTINUED!",1:"MARKED!") S PSGCANFL=1
"RTN","PSGOEC",66,0)
DONE ;
"RTN","PSGOEC",67,0)
 K CF,DA,DIE,DP,DR,ORIFN,ORETURN,PSGAL,PSGALR,PSGDA,SD,ST,T,UCF,Y,PSJDCTYP Q
"RTN","PSGOEC",68,0)
ASET ;
"RTN","PSGOEC",69,0)
 S DIE="^PS(55,"_PSGP_",5,",DR="28////"_$S($P($G(^PS(55,PSGP,5,+$G(PSJORD),0)),U,27)="E":"DE",$D(PSGEDIT):"DE",1:"D")_";Q;34////"_PSGDT_$S(T]"":";49////1",1:"")
"RTN","PSGOEC",70,0)
 Q
"RTN","PSGOEC",71,0)
NSET ;
"RTN","PSGOEC",72,0)
 S DIE="^PS(53.1,",DR="28////"_$S($P($G(^PS(53.1,+$G(PSJORD),0)),U,27)="E":"DE",$D(PSGEDIT):"DE",1:"D")_$S(T]"":";42////1",1:"")_";25////"_PSGDT Q
"RTN","PSGOEC",73,0)
AC ;
"RTN","PSGOEC",74,0)
 I 'CF K DA S $P(^PS(55,PSGP,5,+PSGORD,4),U,11,14)="^1^"_DUZ_U_PSGDT,PSGAL("C")=13040,DA=+PSGORD,DA(1)=PSGP D ^PSGAL5
"RTN","PSGOEC",75,0)
 I 'CF,$D(PSJSYSO) S PSGORD=+PSGORD_"A",PSGPOSA="C",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOEC",76,0)
 Q:'CF  K DA,ORIFN S PSGAL("C")=PSJSYSU*10+4000,DA=+PSGORD,DA(1)=PSGP D ^PSGAL5 S $P(^(2),U,3)=$P(^PS(55,PSGP,5,+PSGORD,2),U,4) D ^DIE S ^PS(55,"AUE",PSGP,+PSGORD)=""
"RTN","PSGOEC",77,0)
 I PSJSYSL K DA S $P(^PS(55,PSGP,5,+PSGORD,7),U,1,2)=PSGDT_U_$S($D(PSGEDIT):"DE",1:"D"),PSGTOL=2,PSGUOW=DUZ,PSGTOO=1,DA=+PSGORD,DA(1)=PSGP D ENL^PSGVDS
"RTN","PSGOEC",78,0)
 S ORIFN=$P($G(^PS(55,PSGP,5,+PSGORD,0)),U,21) D:ORIFN DCOR^PSGOECS
"RTN","PSGOEC",79,0)
 Q
"RTN","PSGOEC",80,0)
NC ;
"RTN","PSGOEC",81,0)
 I 'CF S $P(^PS(53.1,+PSGORD,4),"^",11,14)="^1^"_DUZ_U_PSGDT
"RTN","PSGOEC",82,0)
 I 'CF,$D(PSJSYSO) S PSGORD=+PSGORD_"N",PSGPOSA="C",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOEC",83,0)
 Q:'CF  S PSGSTAT=$P($G(^PS(53.1,+PSGORD,0)),U,9),PSGORIFN=$P($G(^(0)),U,21)
"RTN","PSGOEC",84,0)
 I PSGSTAT'="U" K DA,ORIFN S DA=+PSGORD D ^DIE I PSJSYSL,PSJSYSL<3,(PSGSTAT'="P") S $P(^PS(53.1,+PSGORD,7),U,1,2)=PSGDT_U_$S($D(PSGEDIT):"DE",1:"D"),PSGTOO=2,PSGUOW=DUZ,PSGTOL=2 D ENL^PSGVDS
"RTN","PSGOEC",85,0)
 I PSGSTAT="U" K DA S DA=+PSGORD,DIK="^PS(53.1," D ^DIK
"RTN","PSGOEC",86,0)
 I PSGORIFN S ORIFN=PSGORIFN D DCOR^PSGOECS
"RTN","PSGOEC",87,0)
 Q
"RTN","PSGOEC",88,0)
T ;
"RTN","PSGOEC",89,0)
 F  W !!,"Is this due to the patient being transferred" S %=2 D YN^DICN Q:%  D ENCTM^PSGOEM1
"RTN","PSGOEC",90,0)
 S T=$S(%<0:"^",1:$E("T",%=1)) Q
"RTN","PSGOEC",91,0)
RS ;
"RTN","PSGOEC",92,0)
 ; naked ref below is from variable ND1, ^PS(53.1,PSGDA,4)
"RTN","PSGOEC",93,0)
 S $P(^(4),U,11,14)="^^^" Q
"RTN","PSGOEC",94,0)
REQPROV()          ;
"RTN","PSGOEC",95,0)
 I $G(PSJDCTYP)=2 Q 1
"RTN","PSGOEC",96,0)
 K PSJDCPRV,DIC,DUOUT,DTOUT,Y
"RTN","PSGOEC",97,0)
 N PROVIDER,PROVNAME,RESULT,RSB S RESULT=0
"RTN","PSGOEC",98,0)
 S PROVIDER=+$P($G(^PS(55,DFN,5.1)),"^",2),PROVNAME=""
"RTN","PSGOEC",99,0)
 I PROVIDER>0 D
"RTN","PSGOEC",100,0)
 .S DIC=200,DR="53.1;53.4",DIQ="RSB",DIQ(0)="I",DA=PROVIDER D EN^DIQ1
"RTN","PSGOEC",101,0)
 .K DIC,DR,DA,DIQ
"RTN","PSGOEC",102,0)
 .I $G(RSB(200,PROVIDER,53.1,"I"))="1"&(($G(RSB(200,PROVIDER,53.4,"I"))="")!($G(RSB(200,PROVIDER,53.4,"I"))>DT)) D
"RTN","PSGOEC",103,0)
 ..S DIC=200,DA=PROVIDER,DR=".01",DIQ="RSB",DIQ(0)="E" D EN^DIQ1
"RTN","PSGOEC",104,0)
 ..S PROVNAME=$G(RSB(200,PROVIDER,.01,"E")) K DA,DIQ,DR
"RTN","PSGOEC",105,0)
 K DIC S DIC=200,DIC(0)="AEMQZ"
"RTN","PSGOEC",106,0)
 S:PROVNAME]"" DIC("B")=PROVNAME
"RTN","PSGOEC",107,0)
 S DIC("A")="Requesting PROVIDER: "
"RTN","PSGOEC",108,0)
 S DIC("S")="I $D(^(""PS"")),^(""PS""),$S('$P(^(""PS""),""^"",4):1,1:$P(^(""PS""),""^"",4)>DT)" D ^DIC K DIC
"RTN","PSGOEC",109,0)
 I +Y>0,'$D(DUOUT),'$D(DTOUT) S RESULT=1,PSJDCPRV=+Y
"RTN","PSGOEC",110,0)
 Q RESULT
"RTN","PSGOEC",111,0)
 ;
"RTN","PSGOEC",112,0)
PNDRNA(ORDER) ; Ask Discontinue Pending Renewal only, or both Pending Renew and Renewed Order
"RTN","PSGOEC",113,0)
 ; Perform this action only for pending renewals
"RTN","PSGOEC",114,0)
 I '$G(ORDER)!'($G(ORDER)["P") Q 3
"RTN","PSGOEC",115,0)
 ; Quit if original order is no longer active
"RTN","PSGOEC",116,0)
 N ORIGORD,ORIGSTOP S ORIGORD=$P($G(^PS(53.1,+ORDER,0)),"^",25) Q:'ORIGORD  D  I ORIGSTOP<$G(PSGDT) Q 1
"RTN","PSGOEC",117,0)
 .S ORIGSTOP=$S(ORIGORD["U":$P($G(^PS(55,PSGP,5,+ORIGORD,2)),"^",4),ORIGORD["V":$P($G(^PS(55,PSGP,"IV",+ORIGORD,0)),"^",3),1:"")
"RTN","PSGOEC",118,0)
 N NDP2
"RTN","PSGOEC",119,0)
 S NDP2=^PS(53.1,+ORDER,.2) S DRG=NDP2,DO=$P(DRG,"^",2) S DRG=$$ENPDN^PSGMI($P(DRG,"^"))
"RTN","PSGOEC",120,0)
 S ND2=^PS(53.1,+ORDER,2) S SCH=$P(ND2,"^"),START=$P(ND2,"^",2),START=$$FMTE^XLFDT(START,2)
"RTN","PSGOEC",121,0)
 W !!?5,DRG_" "_DO
"RTN","PSGOEC",122,0)
 W !?5,"This order has a pending status. If this pending order"
"RTN","PSGOEC",123,0)
 W !?5,"is discontinued, the original order may still be active."
"RTN","PSGOEC",124,0)
 S DIR("A")="Select order(s) to discontinue"
"RTN","PSGOEC",125,0)
 S DIR(0)="S^1:DC BOTH Orders;2:DC Pending Order;3:Cancel - No Action Taken"
"RTN","PSGOEC",126,0)
 S DIR("L",1)="1 - DC BOTH Orders"
"RTN","PSGOEC",127,0)
 S DIR("L",2)="2 - DC Pending Order"
"RTN","PSGOEC",128,0)
 S DIR("L",3)="3 - Cancel - No Action Taken" D ^DIR
"RTN","PSGOEC",129,0)
 ; Reverse order - Y=1 - Pending only  Y=2:BOTH
"RTN","PSGOEC",130,0)
 S Y=$S(Y=1:2,Y=2:1,1:3)
"RTN","PSGOEC",131,0)
 Q Y
"RTN","PSGOEC",132,0)
 ;
"RTN","PSGOEC",133,0)
PNDRN(PSJDCTYP,ORDER) ; Perform Discontinue action for Pending order only or both Pending and Renewed
"RTN","PSGOEC",134,0)
 ; Perform this action only for pending renewals
"RTN","PSGOEC",135,0)
 N PSGORD S PSGORD=ORDER
"RTN","PSGOEC",136,0)
 Q:'$G(PSGORD)!'($G(PSGORD)["P")
"RTN","PSGOEC",137,0)
 I PSJDCTYP=1 G SOC
"RTN","PSGOEC",138,0)
 I PSJDCTYP=2 S PSJDCTYP=1 D SOC Q:'$G(PSJDCTYP)  D
"RTN","PSGOEC",139,0)
 .I ($G(PSJNOO)<0) Q
"RTN","PSGOEC",140,0)
 .N ND5310 S ND5310=$G(^PS(53.1,+PSGORD,0))
"RTN","PSGOEC",141,0)
 .N PSGORD S PSGORD=$P(ND5310,"^",25) I PSGORD S PSJDCTYP=2 D SOC K PSJDCTYP
"RTN","PSGOEC",142,0)
 Q
"RTN","PSGOEC",143,0)
PNDRNOK(ORDER) ; Execute DC Pending Renew if 
"RTN","PSGOEC",144,0)
 ;                  1) Renewal order is pending/non-verified, and 
"RTN","PSGOEC",145,0)
 ;                  2) Original order is not DC'd or Expired
"RTN","PSGOEC",146,0)
 Q:'$G(PSGORD)!'($G(PSGORD)["P") 0
"RTN","PSGOEC",147,0)
 N ORIGORD,ORIGSTOP S ORIGORD=$P($G(^PS(53.1,+ORDER,0)),"^",25) Q:'ORIGORD 0  D  I ORIGSTOP<$G(PSGDT) Q 0
"RTN","PSGOEC",148,0)
 .S ORIGSTOP=$S(ORIGORD["U":$P($G(^PS(55,PSGP,5,+ORIGORD,2)),"^",4),ORIGORD["V":$P($G(^PS(55,PSGP,"IV",+ORIGORD,0)),"^",3),1:"")
"RTN","PSGOEC",149,0)
 Q:'($P($G(^PS(53.1,+PSGORD,0)),U,24)="R") 0
"RTN","PSGOEC",150,0)
 Q 1
"RTN","PSGOECS")
0^23^B48040655
"RTN","PSGOECS",1,0)
PSGOECS ;BIR/CML3-CANCEL SELECTED ORDERS ;02 Mar 99 / 9:29 AM
"RTN","PSGOECS",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**23,29,44,58,81,110,134**;16 DEC 97;Build 124
"RTN","PSGOECS",3,0)
 ;
"RTN","PSGOECS",4,0)
 ; Reference to FULL^VALM1 is supported by DBIA# 10116.
"RTN","PSGOECS",5,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGOECS",6,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789.
"RTN","PSGOECS",7,0)
 ;
"RTN","PSGOECS",8,0)
AM ;
"RTN","PSGOECS",9,0)
 W !,"...marking ",$P(X,U),"..." S $P(^PS(55,PSGP,5,DA,4),"^",11,14)="^1^"_DUZ_"^"_PSGDT,PSGAL("C")=13040 W "." D ^PSGAL5 W "."
"RTN","PSGOECS",10,0)
 I $D(PSJSYSO) S PSGORD=+PSGORD_"A",PSGPOSA="C",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOECS",11,0)
 Q
"RTN","PSGOECS",12,0)
 ;
"RTN","PSGOECS",13,0)
NM ;
"RTN","PSGOECS",14,0)
 W !,"...marking ",$P(X,U),"..." S $P(^PS(53.1,DA,4),"^",11,14)="^1^"_DUZ_"^"_PSGDT W "."
"RTN","PSGOECS",15,0)
 I $D(PSJSYSO) S PSGORD=+PSGORD_"N",PSGPOSD=PSGDT,PSGPOSA="C" D ENPOS^PSGVDS
"RTN","PSGOECS",16,0)
 Q
"RTN","PSGOECS",17,0)
 ;
"RTN","PSGOECS",18,0)
AC ; discontinue active order
"RTN","PSGOECS",19,0)
 K DA S DA(1)=PSGP,DA=+PSGORD
"RTN","PSGOECS",20,0)
 S X=$G(^PS(55,PSGP,5,DA,.2))
"RTN","PSGOECS",21,0)
 I $P(X,U,4)="D" W !,$P($$DRUGNAME^PSJLMUTL(DFN,PSGORD),U,1),!,"NO ACTION WAS TAKEN ON DONE ORDER",!,$C(7) HANG 1 Q 
"RTN","PSGOECS",22,0)
 NEW XX S XX=$P(^PS(55,PSGP,5,DA,0),U,9)
"RTN","PSGOECS",23,0)
 I $S(XX="E":1,XX="D":1,XX="DE":1,1:0) W !,$P($$DRUGNAME^PSJLMUTL(DFN,PSGORD),U,1),!,"NO ACTION WAS TAKEN ON "_$$CODES^PSIVUTL(XX,55.06,28)_" ORDER",!,$C(7) HANG 1 Q
"RTN","PSGOECS",24,0)
 S X=$$DRUGNAME^PSJLMUTL(PSGP,PSGORD)
"RTN","PSGOECS",25,0)
 I '$P(PSJSYSP0,"^",5) D AM Q
"RTN","PSGOECS",26,0)
 W !,"...discontinuing ",$P(X,U),"...",! S PSGAL("C")=PSJSYSU*10+4000 D ^PSGAL5
"RTN","PSGOECS",27,0)
 S PSGALR=20,DIE="^PS(55,"_PSGP_",5,",DR="28////D;Q;34////"_PSGDT_$S(PSJSYSU:"",1:";49////1"),DP=55.06,$P(^(2),"^",3)=$P(^PS(55,PSGP,5,DA,2),"^",4) D ^DIE S ^PS(55,"AUE",PSGP,DA)=""
"RTN","PSGOECS",28,0)
 D EN1^PSJHL2(PSGP,"OD",PSGORD) S DA(1)=PSGP,DA=+PSGORD
"RTN","PSGOECS",29,0)
 I PSJSYSL S $P(^PS(55,PSGP,5,DA,7),"^",1,2)=PSGDT_"^D",PSGTOL=2,PSGUOW=DUZ,PSGTOO=1 D ENL^PSGVDS
"RTN","PSGOECS",30,0)
 Q
"RTN","PSGOECS",31,0)
 ;
"RTN","PSGOECS",32,0)
NC ; discontinue non-verifed order
"RTN","PSGOECS",33,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S PSJDCTYP=$$PNDRNA^PSGOEC(PSGORD) I $G(PSJDCTYP)'=1 D PNDRN($G(PSJDCTYP)) Q
"RTN","PSGOECS",34,0)
NC2 ; Called from PNDRN to discontinue both pending renewal and original order
"RTN","PSGOECS",35,0)
 K DA S DA=+PSGORD,X=$G(^PS(53.1,DA,.2)),X=$$DRUGNAME^PSJLMUTL(PSGP,PSGORD)
"RTN","PSGOECS",36,0)
 I $S($P(PSJSYSP0,"^",5):0,'$D(^PS(53.1,DA,4)):1,1:$P(^(4),"^",7)'=DUZ) D NM Q
"RTN","PSGOECS",37,0)
 W !,"...discontinuing ",$P(X,U),"...",! S DIE="^PS(53.1,",DR="28////D"_$S(PSJSYSU:"",1:";42////1") D ^DIE
"RTN","PSGOECS",38,0)
 D EN1^PSJHL2(PSGP,"OC",PSGORD)
"RTN","PSGOECS",39,0)
 S DA=+PSGORD I PSJSYSL,PSJSYSL<3 S $P(^PS(53.1,DA,7),"^",1,2)=PSGDT_"^D",PSGTOO=2,PSGUOW=DUZ,PSGTOL=2 D ENL^PSGVDS
"RTN","PSGOECS",40,0)
 I $G(PSJDCTYP) D UNL^PSSLOCK(DFN,PSGORD)
"RTN","PSGOECS",41,0)
 Q
"RTN","PSGOECS",42,0)
 ;
"RTN","PSGOECS",43,0)
EN ; enter here
"RTN","PSGOECS",44,0)
 I $G(PSJIVPRF) D ^PSIVSPDC Q  ;Use for Speed DC in IV Order Profile
"RTN","PSGOECS",45,0)
 D FULL^VALM1
"RTN","PSGOECS",46,0)
EN1 ;
"RTN","PSGOECS",47,0)
 S (PSGONC,PSGLMT)=PSJOCNT,PSGONW="C" D ENWO^PSGON I "^"[X K X G RESET
"RTN","PSGOECS",48,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12)
"RTN","PSGOECS",49,0)
 W ! F PSGOECS=1:1:PSGODDD F PSGOECS1=1:1 S PSGOECS2=$P(PSGODDD(PSGOECS),",",PSGOECS1) Q:'PSGOECS2  D
"RTN","PSGOECS",50,0)
 .S PSGORD=^TMP("PSJON",$J,PSGOECS2) ; I $P($G(@($S((PSGORD["A")!(PSGORD["U"):"^PS(55,"_PSGP_",5,",(PSGORD["V"):"^PS(55,"_PSGP_",""IV"",",1:"^PS(53.1,")_(+PSGORD)_",0)")),"^",21) Q
"RTN","PSGOECS",51,0)
 S PSJNOO=$$ENNOO^PSJUTL5("D") G:PSJNOO<0 EN1
"RTN","PSGOECS",52,0)
 ;Prompt for requesting provider
"RTN","PSGOECS",53,0)
 W ! I '$$REQPROV^PSGOEC G EN1
"RTN","PSGOECS",54,0)
 W !
"RTN","PSGOECS",55,0)
 ;
"RTN","PSGOECS",56,0)
 ;Replaced above line with block structure below.
"RTN","PSGOECS",57,0)
 N COMFLG,PSJCOM S (EXITLOOP,PSJCOM)=0
"RTN","PSGOECS",58,0)
 F PSGOECS=1:1:PSGODDD D
"RTN","PSGOECS",59,0)
 .F PSGOECS1=1:1 D  Q:EXITLOOP=1
"RTN","PSGOECS",60,0)
 ..S PSGOECS2=$P(PSGODDD(PSGOECS),",",PSGOECS1)
"RTN","PSGOECS",61,0)
 ..I 'PSGOECS2 S EXITLOOP=1 Q
"RTN","PSGOECS",62,0)
 ..S (ON,PSGORD)=^TMP("PSJON",$J,PSGOECS2)
"RTN","PSGOECS",63,0)
 ..I PSGORD=+PSGORD D DCCOM Q
"RTN","PSGOECS",64,0)
 ..I '$$LS^PSSLOCK(DFN,PSGORD) D  Q
"RTN","PSGOECS",65,0)
 ... W:PSGORD'["V" !,$P($$DRUGNAME^PSJLMUTL(DFN,PSGORD),"^",1),!,"NO ACTION WAS TAKEN",!,$C(7) HANG 1 Q
"RTN","PSGOECS",66,0)
 ... W ! I PSGORD["V" N PSJLINE S PSJLINE=1 D DSPLORDV^PSJLMUT1(PSGP,PSGORD) D  W !,"NO ACTION WAS TAKEN",!,$C(7) HANG 1
"RTN","PSGOECS",67,0)
 ....F X=0:0 S X=$O(PSJOC(ON,X)) Q:'X  D
"RTN","PSGOECS",68,0)
 .....W !,$G(PSJOC(ON,X))
"RTN","PSGOECS",69,0)
 ..D CHKCOM I COMFLG  D
"RTN","PSGOECS",70,0)
 ... I PSGORD'["V" W !,$P($$DRUGNAME^PSJLMUTL(DFN,PSGORD),"^",1),!,"NO ACTION WAS TAKEN",!,$C(7) HANG 1 Q
"RTN","PSGOECS",71,0)
 ... W ! I PSGORD["V" N PSJLINE S PSJLINE=1 D DSPLORDV^PSJLMUT1(PSGP,PSGORD) D  W !,"NO ACTION WAS TAKEN",!,$C(7) HANG 1
"RTN","PSGOECS",72,0)
 ....F X=0:0 S X=$O(PSJOC(ON,X)) Q:'X  D
"RTN","PSGOECS",73,0)
 .....W !,$G(PSJOC(ON,X))
"RTN","PSGOECS",74,0)
 ..Q:PSJCOM
"RTN","PSGOECS",75,0)
 ..D:(PSGORD["U") AC
"RTN","PSGOECS",76,0)
 ..D:(PSGORD["P") NC
"RTN","PSGOECS",77,0)
 ..D:(PSGORD["V") SPDCIV^PSIVSPDC
"RTN","PSGOECS",78,0)
 ..; Call the unlock procedure
"RTN","PSGOECS",79,0)
 ..D UNL^PSSLOCK(DFN,PSGORD)
"RTN","PSGOECS",80,0)
 S X=""
"RTN","PSGOECS",81,0)
RESET ;
"RTN","PSGOECS",82,0)
 I $G(PSGORD)["V" D INIT^PSJLMHED(3) S VALMBK="R" G DONE
"RTN","PSGOECS",83,0)
 D INIT^PSJLMHED(1) S VALMBCK="R"
"RTN","PSGOECS",84,0)
 ;
"RTN","PSGOECS",85,0)
DONE ;
"RTN","PSGOECS",86,0)
 K DA,DIE,DP,DR,PSGAL,PSGALR,PSGLMT,PSGODDD,PSGOECS,PSGOECS1,PSGOECS2,PSGONW,PSGORD,PSGPOSA,PSGPOSD,PSGTOL,PSGTOO,PSGUOW,ORIFN,ORETURN,ORNATR
"RTN","PSGOECS",87,0)
 Q
"RTN","PSGOECS",88,0)
 ;
"RTN","PSGOECS",89,0)
DCOR ; Create DC order/update stop date in OE/RR.
"RTN","PSGOECS",90,0)
 S PSOC=$S(PSGORD["P":"OC",PSGORD["N":"OC",1:"OD")
"RTN","PSGOECS",91,0)
 D EN1^PSJHL2(PSGP,PSOC,PSGORD)
"RTN","PSGOECS",92,0)
 Q
"RTN","PSGOECS",93,0)
 ;
"RTN","PSGOECS",94,0)
ENOR ;
"RTN","PSGOECS",95,0)
 K DA S PSGEDIT=$S($D(PSGEDIT):PSGEDIT,1:"D"),CF=1,PSGALR=20,DA=+PSGORD,T="" I PSGORD'["U",(PSGORD'["O") D:CF NSET^PSGOEC D NC^PSGOEC D ENOR2 G DONE^PSGOEC
"RTN","PSGOECS",96,0)
 S DA(1)=PSGP D:CF ASET^PSGOEC D AC^PSGOEC
"RTN","PSGOECS",97,0)
 G DONE^PSGOEC
"RTN","PSGOECS",98,0)
 ;
"RTN","PSGOECS",99,0)
ENOR2 ;Check to see if order being DC'd is a Pending Renewal and is being DC'd due to edit.
"RTN","PSGOECS",100,0)
 I PSGEDIT="DE",$P(^PS(53.1,+PSGORD,0),U,25),$P(^PS(53.1,+PSGORD,0),U,24)="R",PSGSD<$P($G(^PS(55,PSGP,5,+$P(^PS(53.1,+PSGORD,0),U,25),2)),U,4) D
"RTN","PSGOECS",101,0)
 .K DA,DR S DA(1)=PSGP,DA=+$P(^PS(53.1,+PSGORD,0),U,25),DIE="^PS(55,"_PSGP_",5,",DR="34////"_PSGSD_";25////"_$P($G(^PS(55,PSGP,5,+$P(^PS(53.1,+PSGORD,0),U,25),2)),U,4)
"RTN","PSGOECS",102,0)
 .D ^DIE,EN1^PSJHL2(PSGP,"XX",$P(^PS(53.1,+PSGORD,0),U,25))
"RTN","PSGOECS",103,0)
 Q
"RTN","PSGOECS",104,0)
 ;
"RTN","PSGOECS",105,0)
CHKCOM ;Check to see if order is part of complex order series.
"RTN","PSGOECS",106,0)
 S PSJCOM=$S(PSGORD["V":$P($G(^PS(55,PSGP,"IV",+PSGORD,.2)),U,8),PSGORD["U":$P($G(^PS(55,PSGP,5,+PSGORD,.2)),U,8),1:$P($G(^PS(53.1,+PSGORD,.2)),U,8)),COMFLG=0
"RTN","PSGOECS",107,0)
 N PSJSTAT S PSJSTAT=$S(PSGORD["V":$P($G(^PS(55,PSGP,"IV",+PSGORD,0)),"^",17),PSGORD["U":$P($G(^PS(55,PSGP,5,+PSGORD,0)),"^",9),1:$P($G(^PS(53.1,+PSGORD,0)),"^",9))
"RTN","PSGOECS",108,0)
 Q:'PSJCOM  I "DE"[PSJSTAT Q
"RTN","PSGOECS",109,0)
 W ! I PSGORD["V" N PSJLINE S PSJLINE=1 D DSPLORDV^PSJLMUT1(PSGP,PSGORD) D
"RTN","PSGOECS",110,0)
 .F X=0:0 S X=$O(PSJOC(ON,X)) Q:'X  D
"RTN","PSGOECS",111,0)
 ..W !,$G(PSJOC(ON,X))
"RTN","PSGOECS",112,0)
 I PSGORD["U" W !,$P($$DRUGNAME^PSJLMUTL(PSGP,PSGORD),"^",1) D
"RTN","PSGOECS",113,0)
 .W !!,"is part of a complex order. If you discontinue this order the following orders",!,"will be discontinued too (unless the stop date has already been reached)." D CMPLX^PSJCOM1(PSGP,PSJCOM,PSGORD)
"RTN","PSGOECS",114,0)
 F  W !!,"Do you want to discontinue this series of complex orders" S %=1 D YN^DICN Q:%
"RTN","PSGOECS",115,0)
 I %'=1 S COMFLG=1 Q
"RTN","PSGOECS",116,0)
 N O,OO S O=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  D  Q:COMFLG
"RTN","PSGOECS",117,0)
 .Q:OO=PSGORD  I '$$LS^PSSLOCK(DFN,OO) S COMFLG=1 Q
"RTN","PSGOECS",118,0)
 Q:COMFLG
"RTN","PSGOECS",119,0)
 N O,OO S O=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  D
"RTN","PSGOECS",120,0)
 .I (OO["U") N PSGORD S PSGORD=OO D AC
"RTN","PSGOECS",121,0)
 .I (OO["V") N PSGORD S (ON,PSGORD)=OO D SPDCIV^PSIVSPDC
"RTN","PSGOECS",122,0)
 .D UNL^PSSLOCK(DFN,PSGORD)
"RTN","PSGOECS",123,0)
 Q
"RTN","PSGOECS",124,0)
 ;
"RTN","PSGOECS",125,0)
DCCOM ;DC pending/non-verified complex order
"RTN","PSGOECS",126,0)
 I '$$LOCK^PSJOEA(DFN,PSGORD) W !,"Order # ",PSGOECS2," could not be discontinued.",!,$C(7) HANG 1 Q
"RTN","PSGOECS",127,0)
 N PSGORD1 S PSGORD1=PSGORD
"RTN","PSGOECS",128,0)
 N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSGORD1,PSJO)) Q:'PSJO  S PSGORD=PSJO_"P" D NC
"RTN","PSGOECS",129,0)
 Q
"RTN","PSGOECS",130,0)
PNDRN(PSJDCTYP) ; Discontinue both pending renewal and original order
"RTN","PSGOECS",131,0)
 N TMPORD S TMPORD=$G(PSGORD)
"RTN","PSGOECS",132,0)
 I PSJDCTYP=2 S PSJDCTYP=1 D NC2 Q:'$G(PSJDCTYP)  D
"RTN","PSGOECS",133,0)
 .I ($G(PSJNOO)<0) Q
"RTN","PSGOECS",134,0)
 .N ND5310 S ND5310=$G(^PS(53.1,+PSGORD,0))
"RTN","PSGOECS",135,0)
 .N PSGORD S PSGORD=$P(ND5310,"^",25) I PSGORD S PSJDCTYP=2 D
"RTN","PSGOECS",136,0)
 ..I '$$LS^PSSLOCK(DFN,PSGORD) K PSJDCTYP Q
"RTN","PSGOECS",137,0)
 ..D @$S(PSGORD["U":"AC",PSGORD["V":"SPDCIV^PSIVSPDC",1:"")
"RTN","PSGOECS",138,0)
 S PSGORD=TMPORD
"RTN","PSGOECS",139,0)
 Q
"RTN","PSGOEF")
0^24^B63235308
"RTN","PSGOEF",1,0)
PSGOEF ;BIR/CML3-FINISH ORDERS ENTERED THROUGH OE/RR ;14 May 98 / 2:17 PM
"RTN","PSGOEF",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,30,29,35,39,47,50,56,80,116,110,111,133,153,134**;16 DEC 97;Build 124
"RTN","PSGOEF",3,0)
 ;
"RTN","PSGOEF",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSGOEF",5,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192
"RTN","PSGOEF",6,0)
 ; Reference to DOSE^PSSORPH is supported by DBIA 3234.
"RTN","PSGOEF",7,0)
 ;
"RTN","PSGOEF",8,0)
START ;
"RTN","PSGOEF",9,0)
 I '$D(^PS(53.1,+PSGORD)) W $C(7),!?3,"Cannot find this pending order (#",+PSGORD,")." Q
"RTN","PSGOEF",10,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12) K PSGFDX,PSGEFN,PSGOEEF,PSGOES,PSGONF,PSGRDTX S PSGOES=1,(PSGOEF,PSGOEEF)=0,PSGOEEG=3
"RTN","PSGOEF",11,0)
 I $D(PSJTUD) S PSGDO=$P($G(^PS(53.1,+PSGORD,.3)),U),(PSGPDRG,PSGPD)=PSJCOI,(PSGPDRGN,PSGPDN)=$$OINAME^PSJLMUTL(PSGPD)
"RTN","PSGOEF",12,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S X=PSGSCH D EN^PSGORS0 D
"RTN","PSGOEF",13,0)
 . S:($D(X)&($P($G(^PS(53.1,+PSGORD,2)),"^",5)="")&($P($G(^PS(53.1,+PSGORD,0)),"^",24)="N")) PSGAT=PSGS0Y
"RTN","PSGOEF",14,0)
 . NEW PSJDOX,PSJDOSE,PSJPIECE,PSJUNIT,PSJX,X
"RTN","PSGOEF",15,0)
 . S X=$G(^PS(53.1,+PSGORD,1,1,0)) Q:'+X
"RTN","PSGOEF",16,0)
 . D DOSE^PSSORPH(.PSJDOX,+X,"U")
"RTN","PSGOEF",17,0)
 . I $S('$D(PSJDOX):1,1:+PSJDOX(1)=-1) Q
"RTN","PSGOEF",18,0)
 . S PSJPIECE=$S($P(PSJDOX(1),U)="":3,1:1)
"RTN","PSGOEF",19,0)
 . S X=^PS(53.1,+PSGORD,.2)
"RTN","PSGOEF",20,0)
 . S:PSJPIECE=3 PSJDOSE=$P(X,U,2)
"RTN","PSGOEF",21,0)
 . S:PSJPIECE=1 PSJDOSE=$P(X,U,5),PSJUNIT=$P(X,U,6)
"RTN","PSGOEF",22,0)
 . F X=0:0 S X=$O(PSJDOX(X)) Q:+$G(PSJX)!'X  D
"RTN","PSGOEF",23,0)
 .. I PSJPIECE=3,($P(PSJDOX(X),U,3)'=PSJDOSE) Q
"RTN","PSGOEF",24,0)
 .. I PSJPIECE=1,($P(PSJDOX(X),U,1)_$P(PSJDOX(X),U,2)'=(PSJDOSE_PSJUNIT)) Q
"RTN","PSGOEF",25,0)
 .. S:+$P(PSJDOX(X),U,12) $P(^PS(53.45,PSJSYSP,2,1,0),U,2)=+$P(PSJDOX(X),U,12),PSJX=1
"RTN","PSGOEF",26,0)
 I PSGEB'=PSGOPR F X=7,11 S Y=$T(@(3_X)),@("PSGEFN("_X_")="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))="",PSGOEEF=PSGOEEF+1
"RTN","PSGOEF",27,0)
 D GTST^PSGOE6(+PSGORD)
"RTN","PSGOEF",28,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S PSGSD="" D:PSGS0Y]""
"RTN","PSGOEF",29,0)
 .N PSJX S PSJX=$P($G(^PS(53.1,+PSGORD,0)),U,25) I PSJX="" Q
"RTN","PSGOEF",30,0)
 .I PSJX["U" S PSGSD=$P($G(^PS(55,DFN,5,+PSJX,2)),U,2) Q
"RTN","PSGOEF",31,0)
 .I PSJX["V" S PSGSD=$P($G(^PS(55,DFN,"IV",+PSJX,0)),U,2) Q
"RTN","PSGOEF",32,0)
 .I PSJX["P" S PSGSD=$P($G(^PS(53.1,+PSJX,2)),U,2)
"RTN","PSGOEF",33,0)
 S:PSGSD="" PSGSD=PSGLI
"RTN","PSGOEF",34,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",+PSGPD)
"RTN","PSGOEF",35,0)
 S:$P($G(PSGNEDFD),U,3)="" $P(PSGNEDFD,U,3)=PSGST  ; N PSGOEA S PSGOEA="R"
"RTN","PSGOEF",36,0)
 S (PSGNESD,PSGSD)=$$ENSD^PSGNE3(PSGSCH,PSGS0Y,PSGLI,PSGSD)
"RTN","PSGOEF",37,0)
 ;if this is a renewal order, ignore any 'requested start date' received.  Use the system calculated start date.
"RTN","PSGOEF",38,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" D
"RTN","PSGOEF",39,0)
 . D REQDT^PSJLIVMD(PSGORD)
"RTN","PSGOEF",40,0)
 E  D
"RTN","PSGOEF",41,0)
 . S X=$$DSTART^PSJDCU(DFN,$P(^PS(53.1,+PSGORD,0),U,25)) I X]"" S (PSGNESD,PSGSD)=X K PSGRSD
"RTN","PSGOEF",42,0)
 D   ; Extend the Default Stop Date if needed for the first renewed order.
"RTN","PSGOEF",43,0)
 .N PSGOEAO,PSGWALLO
"RTN","PSGOEF",44,0)
 .I $P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S PSGOEAO=PSGOEA,PSGOEA="R",PSGWALLO=$P(^PS(55,DFN,5.1),U)
"RTN","PSGOEF",45,0)
 .D ENFD^PSGNE3(PSGLI) S PSGFD=$S($G(PSGRDTX(+PSGORD,"PSGFD")):PSGRDTX(+PSGORD,"PSGFD"),1:PSGNEFD)
"RTN","PSGOEF",46,0)
 .I $P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S PSGOEA=PSGOEAO,$P(^PS(55,DFN,5.1),U)=PSGWALLO
"RTN","PSGOEF",47,0)
 N DUR,PSGRNSD S PSGRNSD=+$$LASTREN^PSJLMPRI(DFN,PSGORD) I PSGRNSD S DUR=$$GETDUR^PSJLIVMD(DFN,PSGORD,"P",1) I DUR]"" D
"RTN","PSGOEF",48,0)
 . N DURMIN S DURMIN=$$DURMIN^PSJLIVMD(DUR) I DURMIN S PSGFD=$$FMADD^XLFDT(PSGRNSD,,,DURMIN)
"RTN","PSGOEF",49,0)
 S PSGOFD="",PSGSDN=$$ENDD^PSGMI(PSGSD)_U_$$ENDTC^PSGMI(PSGSD),PSGFDN=$$ENDD^PSGMI(PSGFD)_U_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOEF",50,0)
 S PSGLIN=$$ENDD^PSGMI(PSGLI)_U_$$ENDTC^PSGMI(PSGLI)
"RTN","PSGOEF",51,0)
 I '$O(^PS(53.45,PSJSYSP,2,0)) N DRG,DRGCNT S DRGCNT=0 D
"RTN","PSGOEF",52,0)
 .F X=0:0 S X=$O(^PSDRUG("ASP",+PSGPD,X)) Q:'X!(DRGCNT>1)  S:$P($G(^PSDRUG(+X,2)),U,3)["U" DRGCNT=DRGCNT+1,DRG=+X
"RTN","PSGOEF",53,0)
 .I DRGCNT=1 K ^PS(53.45,PSJSYSP,2) S ^PS(53.45,PSJSYSP,2,1,0)=DRG_U_1,^PS(53.45,PSJSYSP,2,0)="^53.4502^1^1",PS(53.45,PSJSYSP,2,"B",+DRG,1)=""
"RTN","PSGOEF",54,0)
 Q
"RTN","PSGOEF",55,0)
FINISH ;
"RTN","PSGOEF",56,0)
 ; force display of second screen if CPRS order checks exist
"RTN","PSGOEF",57,0)
 N NSFF,PSGOEF39 S NSFF=1 K PSJNSS
"RTN","PSGOEF",58,0)
 I $G(PSGORD),$D(PSGRDTX(+PSGORD)) D  K PSGRDTX
"RTN","PSGOEF",59,0)
 . S:$G(PSGRDTX(+PSGORD,"PSGRSD")) PSGSD=PSGRDTX(+PSGORD,"PSGRSD")
"RTN","PSGOEF",60,0)
 . S:$G(PSGRDTX(+PSGORD,"PSGRFD")) PSGFD=$S($G(PSGRDTX(+PSGORD,"PSGRFD")):PSGRDTX(+PSGORD,"PSGRFD"),1:$G(PSGNEFD))
"RTN","PSGOEF",61,0)
 N PSJCOM S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8)
"RTN","PSGOEF",62,0)
 I $O(^PS(53.1,+PSGORD,12,0))!$O(^PS(53.1,+PSGORD,10,0)) D
"RTN","PSGOEF",63,0)
 .Q:$G(PSJLMX)=1  ; there's no second screen to display
"RTN","PSGOEF",64,0)
 .S VALMBG=16 D RE^VALM4,PAUSE^VALM1
"RTN","PSGOEF",65,0)
 D FULL^VALM1
"RTN","PSGOEF",66,0)
 I $G(PSJPROT)=3,'$D(PSJTUD),'$$ENIVUD^PSGOEF1(PSGORD) Q
"RTN","PSGOEF",67,0)
 I $G(PSGOSCH)]"" D  S:$G(PSGS0XT)'="" $P(^PS(53.1,+PSGORD,2),"^",6)=PSGS0XT
"RTN","PSGOEF",68,0)
 .N PSGOES,PSGS0Y,PSGSCH S X=PSGOSCH K:$G(PSJTUD) NSFF D ENOS^PSGS0
"RTN","PSGOEF",69,0)
 .I '($G(PSGORD)["P"&($P($G(^PS(53.1,+PSGORD,0)),"^",24)="R")) I $G(X)]""&$G(PSGS0Y) S:$G(PSGAT)="" PSGAT=PSGS0Y
"RTN","PSGOEF",70,0)
 .I $G(PSJNSS) S PSGOSCH="" K PSJNSS
"RTN","PSGOEF",71,0)
 .I $G(PSGORD)["P",$G(PSGAT),$G(PSGS0Y),($G(PSGOSCH)]"") I PSGAT'=PSGS0Y D
"RTN","PSGOEF",72,0)
 ..S PSGNSTAT=1 W $C(7),!!,"PLEASE NOTE:  This order's admin times (",PSGAT,")"
"RTN","PSGOEF",73,0)
 ..W !?13," do not match the ward times (",PSGS0Y,")"
"RTN","PSGOEF",74,0)
 ..W !?13," for this administration schedule (",PSGOSCH,")",!
"RTN","PSGOEF",75,0)
 ..S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR K DIR  W !
"RTN","PSGOEF",76,0)
 I $G(PSGS0XT)="" S $P(^PS(53.1,+PSGORD,2),"^",6)=$S($P($G(ZZND),"^",3)'="":$P(ZZND,"^",3),1:"")
"RTN","PSGOEF",77,0)
 S CHK=0 S:$P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" PSGSI=$$ENPC^PSJUTL("U",+PSJSYSP,180,PSGSI)
"RTN","PSGOEF",78,0)
 I '$G(PSJTUD),$G(PSJNSS),($G(PSGOSCH)]"") D NSSCONT^PSGS0(PSGOSCH,PSGS0XT) K PSJNSS S PSGOSCH=""
"RTN","PSGOEF",79,0)
 S PSGOEFF=PSGOSCH=""+('$O(^PS(53.45,PSJSYSP,2,0))*10)
"RTN","PSGOEF",80,0)
 I PSGOEFF S X=$S(PSGOEFF#2:" a SCHEDULE",1:"")_$S(PSGOEFF=11:" and",1:"")_$S(PSGOEFF>9:" at least one DISPENSE DRUG",1:"")
"RTN","PSGOEF",81,0)
 I 'PSGOEFF I (($G(PSGS0XT)="D")&($G(PSGAT)="")) S X=" Admin Times",PSGOEFF=1,PSGOEF39=1
"RTN","PSGOEF",82,0)
 I PSGOEFF,X]"" S X=X_" before it can be finished."
"RTN","PSGOEF",83,0)
 I PSGOEFF S CHK=1 W $C(7),!!,"PLEASE NOTE: This order must have" F Q=1:1:$L(X," ") S Y=$P(X," ",Q) W:$L(Y)+$X>78 ! W Y," "
"RTN","PSGOEF",84,0)
 I $G(PSGOEF39) S PSGOEE=0,PSGOEFF=0 D  I 'PSGOEE D REFRESH^VALM G DONE
"RTN","PSGOEF",85,0)
 .S F1=53.1,MSG=0,Y=$T(39),@("PSGFN(39)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEEF,PSGOEE)=1 W ! D @$P($T(39),";",3) S CHK=0
"RTN","PSGOEF",86,0)
 I PSGOEFF=1 S F1=53.1,MSG=0,Y=$T(38),@("PSGFN(38)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(38),";",3) S CHK=0 G:'PSGOEE DONE
"RTN","PSGOEF",87,0)
 I PSGOEFF=11 S F1=53.1,MSG=0,Y=$T(32),@("PSGFN(32)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(32),";",3) D  G:'PSGOEE DONE
"RTN","PSGOEF",88,0)
 .S F1=53.1,MSG=0,Y=$T(38),@("PSGFN(38)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(38),";",3) S CHK=0
"RTN","PSGOEF",89,0)
 I PSGOEFF>9 S CHK=7 D ENDRG^PSGOEF1(+PSGPD,0) I CHK D ABORTACC Q
"RTN","PSGOEF",90,0)
 I 'PSGOEFF D OC531^PSGOESF ; check every dispense drug from CPRS
"RTN","PSGOEF",91,0)
 S VALMBG=1
"RTN","PSGOEF",92,0)
 I 'PSGOEFF&($D(PSGORQF)) D RE^VALM4 Q
"RTN","PSGOEF",93,0)
 I $G(MSG) K DIR S DIR(0)="E" W !! D ^DIR
"RTN","PSGOEF",94,0)
 I PSGOEFF D:PSGST="" GTST^PSGOE6(+PSGORD)
"RTN","PSGOEF",95,0)
 S PSJLMFIN=1
"RTN","PSGOEF",96,0)
 K PSJACEPT I $O(^PS(53.1,+PSGORD,12,0)) S PSJLMP2=1
"RTN","PSGOEF",97,0)
 S PSGOEENO=0,PSGSTAT=$S($P(PSJSYSP0,U,9):"ACTIVE",1:"NON-VERIFIED")
"RTN","PSGOEF",98,0)
 NEW PSJDOSE,PSJDOX,PSJDSFLG
"RTN","PSGOEF",99,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOEF",100,0)
 S:+$G(PSJDSFLG) VALMSG="Dosage Ordered & Dispense Drug are not compatible"
"RTN","PSGOEF",101,0)
 I PSGODO=PSGDO S PSGOEEF(109)=""
"RTN","PSGOEF",102,0)
 I PSGODO'=PSGDO S PSGOEENO=1,VALMSG="This change will cause a new order to be created  "
"RTN","PSGOEF",103,0)
 D EN^VALM("PSJU LM ACCEPT")
"RTN","PSGOEF",104,0)
 I $G(PSJNSS) D  S PSGOEEF(26)="" K PSJACEPT,PSJNSS
"RTN","PSGOEF",105,0)
 .K DIR S DIR(0)="FOA",DIR("A")="Invalid Schedule" D ^DIR K DIR
"RTN","PSGOEF",106,0)
 I $G(PSGS0XT)="D",'$G(PSGS0Y),'$G(PSGAT),((",P,R,")'[(","_$G(PSGST)_",")) D  S PSGOEEF(39)="" K PSJACEPT
"RTN","PSGOEF",107,0)
 .K DIR S DIR(0)="FOA",DIR("A")="   WARNING - Admin times are required for DAY OF WEEK schedules  " D ^DIR K DIR
"RTN","PSGOEF",108,0)
 I '$G(PSJACEPT) D ABORTACC Q
"RTN","PSGOEF",109,0)
 I $G(PSJRNF),$G(^PS(53.1,+PSGORD,4)) D
"RTN","PSGOEF",110,0)
 . W $C(7),!!,"ACCEPTING THIS ORDER WILL CHANGE THE STATUS TO ACTIVE."
"RTN","PSGOEF",111,0)
 . S DIR(0)="Y",DIR("A")="Do you wish to make this order Active",DIR("?",1)="Enter ""N"" if you wish to exit without Activating this order,"
"RTN","PSGOEF",112,0)
 . S DIR("?")="or ""Y"" to continue with the Activation process." D ^DIR S:'Y Y=-1 K DIR
"RTN","PSGOEF",113,0)
 I $G(PSJRNF),$G(Y)=-1 S PSJACEPT=0 D ABORTACC Q
"RTN","PSGOEF",114,0)
 I $G(PSJRNF),$G(Y)=1 S PSGOEAV=1
"RTN","PSGOEF",115,0)
 I PSGOEENO S PSJNOO=$$ENNOO^PSJUTL5("E"),PSJACEPT=$S(PSJNOO<0:0,1:1)
"RTN","PSGOEF",116,0)
ACCEPT ;
"RTN","PSGOEF",117,0)
 S VALMBCK=$S($G(PSJACEPT):"Q",1:"R")
"RTN","PSGOEF",118,0)
 I '$G(PSJACEPT) D ABORTACC Q
"RTN","PSGOEF",119,0)
 K PSGOES,PSGRSD,PSGRSDN D:PSGOEENO NEW3^PSGOEE D:'PSGOEENO UPD^PSGOEF1 I $D(PSGOEF)!PSGOEENO S PSGCANFL=-1
"RTN","PSGOEF",120,0)
 D DONE1^PSGOEE
"RTN","PSGOEF",121,0)
 D DONE
"RTN","PSGOEF",122,0)
 Q
"RTN","PSGOEF",123,0)
BYPASS ;
"RTN","PSGOEF",124,0)
 S PSGCANFL=1
"RTN","PSGOEF",125,0)
 ;
"RTN","PSGOEF",126,0)
DONE ;
"RTN","PSGOEF",127,0)
 K CHK,DA,DIE,DR,DRG,MSG,Q1,Q2,PSGNSTAT ;PSGND,PSGOEE,PSGOEEF,PSGOEEND,PSGOEEG,PSGOEF,PSGOEFF,PSGOES,PSGOPD,PSGOPDN,PSGOPR,PSGOSCH,PSGPDRG,PSGDRGN,PSG0XT,PSGS0Y,OSGSD,Q1,Q2
"RTN","PSGOEF",128,0)
 Q
"RTN","PSGOEF",129,0)
ABORTACC ; Abort Accept process.
"RTN","PSGOEF",130,0)
 D ABORT^PSGOEE K PSGOEEF D GETUD^PSJLMGUD(PSGP,PSGORD),^PSGOEF,ENSFE^PSGOEE0(PSGP,PSGORD),INIT^PSJLMUDE(PSGP,PSGORD) S VALMBCK="R",PSGSD=PSGNESD,PSGFD=PSGNEFD Q
"RTN","PSGOEF",131,0)
 ;
"RTN","PSGOEF",132,0)
 ;
"RTN","PSGOEF",133,0)
31 ;;101^PSGOE8;PSGOPD;PSGPD;101;1
"RTN","PSGOEF",134,0)
32 ;;109^PSGOE8;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEF",135,0)
33 ;;10^PSGOE81;PSGOSD;PSGSD;10;0
"RTN","PSGOEF",136,0)
34 ;;3^PSGOE8;PSGOMR;PSGMR;3;1
"RTN","PSGOEF",137,0)
35 ;;25^PSGOE81;PSGOFD;PSGFD;25;0
"RTN","PSGOEF",138,0)
36 ;;7^PSGOE8;PSGOST;PSGST;7;0
"RTN","PSGOEF",139,0)
37 ;;5^PSGOE82;PSGOSM;PSGSM;5;0
"RTN","PSGOEF",140,0)
38 ;;26^PSGOE8;PSGOSCH;PSGSCH;26;1      
"RTN","PSGOEF",141,0)
39 ;;39^PSGOE81;PSGOAT;PSGAT;39;0
"RTN","PSGOEF",142,0)
310 ;;1^PSGOE82;PSGOPR;PSGPR;1;1
"RTN","PSGOEF",143,0)
311 ;;8^PSGOE81;PSGOSI;PSGSI;8;0
"RTN","PSGOEF",144,0)
312 ;;2^PSGOE82;;;2;0
"RTN","PSGOEF",145,0)
313 ;;40^PSGOE82;;;40;0
"RTN","PSGOEF",146,0)
 ;
"RTN","PSGOEF",147,0)
AH ;
"RTN","PSGOEF",148,0)
 W !!?2,"Answer 'YES' to accept this order as a NON-VERIFIED UNIT DOSE order.  Answer",!,"'NO' to edit this order now.  Enter '^' to BYPASS this order, leaving it as",!,"a PENDING INPATIENT order."
"RTN","PSGOEF",149,0)
 Q
"RTN","PSGOT")
0^39^B14273547
"RTN","PSGOT",1,0)
PSGOT ;BIR/CML3-TRANSFERS DATA FROM 53.1 TO 55 ;24 SEP 97 / 7:54 AM
"RTN","PSGOT",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**13,68,90,110,173,134**;16 DEC 97;Build 124
"RTN","PSGOT",3,0)
 ;
"RTN","PSGOT",4,0)
 ; Reference to ^PS(55 supported by DBIA 2191.
"RTN","PSGOT",5,0)
 ;
"RTN","PSGOT",6,0)
START ; get internal record number, lock record, and write
"RTN","PSGOT",7,0)
 S ODA=+PSGORD S:$D(^PS(55,PSGP,0))[0 ^(0)=PSGP,^PS(55,"B",PSGP,PSGP)="",$P(^PS(55,0),U,3,4)=PSGP_U_($P($G(^PS(55,0)),U,4)+1) F  L +^PS(55,PSGP,5,0):1 I  Q
"RTN","PSGOT",8,0)
 S ZND=$G(^PS(55,PSGP,5,0)) S:ZND="" ZND="^55.06IA" F DA=$P(ZND,"^",3)+1:1 I '$D(^PS(55,PSGP,5,DA)),'$D(^("B",DA)) L +^PS(55,PSGP,5,DA):1 I  S $P(ZND,"^",3)=DA,$P(ZND,"^",4)=$P(ZND,"^",4)+1,^PS(55,PSGP,5,0)=ZND Q
"RTN","PSGOT",9,0)
 L -^PS(55,PSGP,5,0) S ND0=^PS(53.1,ODA,0),$P(ND0,"^",23)=PSJPWD,^PS(55,PSGP,5,DA,0)=ND0
"RTN","PSGOT",10,0)
 S (ND1,^PS(55,PSGP,5,DA,.2))=$G(^PS(53.1,ODA,.2)),^PS(55,PSGP,5,DA,.3)=$G(^PS(53.1,ODA,.3)),(ND2,^PS(55,PSGP,5,DA,2))=^PS(53.1,ODA,2),^PS(55,PSGP,5,DA,4)=$G(^PS(53.1,ODA,4)),^PS(55,"AUD",+$P(ND2,"^",4),PSGP,DA)=""
"RTN","PSGOT",11,0)
 S X=^PS(55,PSGP,0) I $P(X,"^",7)="" S $P(X,"^",7)=$P($P(ND0,"^",16),"."),$P(X,"^",8)="A",^(0)=X
"RTN","PSGOT",12,0)
 I $P($G(^PS(55,PSGP,5,DA,2)),"^",6)="" S $P(^PS(55,PSGP,5,DA,2),"^",6)=$S($G(PSGS0XT)'="":PSGS0XT,$P($G(ZZND),"^",3)'="":$P(ZZND,"^",3),1:""),$P(^PS(53.1,ODA,2),"^",6)=$P(^PS(55,PSGP,5,DA,2),"^",6)
"RTN","PSGOT",13,0)
 F X=6,7,13 I $D(^PS(53.1,ODA,X)) S ^PS(55,PSGP,5,DA,X)=^(X)
"RTN","PSGOT",14,0)
 I $D(^PS(53.1,ODA,"DSS")) S ^PS(55,PSGP,5,DA,8)=^("DSS")
"RTN","PSGOT",15,0)
 I $O(^PS(53.1,ODA,1,0)) S (C,X)=0 F  S X=$O(^PS(53.1,ODA,1,X)) Q:'X  S:$D(^(X,0)) C=C+1,^PS(55,PSGP,5,DA,1,C,0)=^(0),^PS(55,PSGP,5,DA,1,"B",+$P($G(^(0)),U),C)=""
"RTN","PSGOT",16,0)
 I $O(^PS(53.1,ODA,1,0)) S ^PS(55,PSGP,5,DA,1,0)="^55.07P^"_C_"^"_C
"RTN","PSGOT",17,0)
 F X=3,12 D  S ^PS(55,PSGP,5,DA,X,0)="^55.0"_$S(X=3:8,1:612)_U_CNT_U_CNT
"RTN","PSGOT",18,0)
 .S CNT=0 F C=0:0 S C=$O(^PS(53.1,ODA,X,C)) Q:'C  I $D(^(C,0)) S ^PS(55,PSGP,5,DA,X,C,0)=^(0),CNT=CNT+1
"RTN","PSGOT",19,0)
 S $P(^PS(53.1,ODA,0),"^",19)=DA
"RTN","PSGOT",20,0)
CR ; set x-refs
"RTN","PSGOT",21,0)
 N A
"RTN","PSGOT",22,0)
 I $D(^PS(55,PSGP,5.1)),$P(^(5.1),"^",6) S X=$P(^(5.1),"^",6) I $P(ND2,"^",3),$P(ND2,"^",6)'>X S $P(^(5.1),"^",6)=$P(ND2,"^",3)
"RTN","PSGOT",23,0)
 S ^PS(55,PSGP,5,"B",+ODA,DA)="",^PS(55,PSGP,5,"AU",$P(ND0,"^",7),+$P(ND2,"^",4),DA)=""
"RTN","PSGOT",24,0)
 S ^PS(55,PSGP,5,"AUS",+$P(ND2,"^",4),DA)=""
"RTN","PSGOT",25,0)
 S ^PS(55,PSGP,5,"C",+ND1,DA)="",^PS(55,"AUE",PSGP,DA)=""
"RTN","PSGOT",26,0)
 S ^PS(55,"AUDS",+$P(ND2,"^",2),PSGP,DA)=""
"RTN","PSGOT",27,0)
 I $D(^PS(55,PSGP,5,DA,8)) S A=^(8),^PS(55,"AUDC",+$P(ND2,"^",4),+A,PSGP,DA)=""
"RTN","PSGOT",28,0)
 I $$PATCH^XPDUTL("PXRM*1.5*12") S X(1)=+$P(ND2,"^",2),X(2)=+$P(ND2,"^",4),DA(1)=PSGP D SPSPA^PSJXRFS(.X,.DA,"UD")
"RTN","PSGOT",29,0)
 K DIK S DA(1)=PSGP S DIK="^PS(55,"_DA(1)_",5,",DIK(1)=125 D EN1^DIK K DIK
"RTN","PSGOT",30,0)
 S PSGTOL=2,PSGTOO=1 F PSGUOW=0:0 S PSGUOW=$O(^PS(53.41,2,1,PSGUOW)) Q:'PSGUOW  I $D(^(PSGUOW,1,PSGP,1,2,1,ODA)) K ^(ODA) D ENL^PSGVDS
"RTN","PSGOT",31,0)
DONE I $D(PSGOE2),PSGOE2]"",$D(^TMP("PSJON",$J,PSGOE2)) S ^(PSGOE2)=DA_"U"
"RTN","PSGOT",32,0)
 S PSGODA=ODA,PSGORD=DA_"U"
"RTN","PSGOT",33,0)
 S PSGNODE=$G(^PS(55,PSGP,5,DA,0)),PSG25=$P(PSGNODE,"^",25),PSG26=$P(PSGNODE,"^",26)
"RTN","PSGOT",34,0)
 I PSG25 S X=$S(PSG25["V":"^PS(55,"_PSGP_",""IV"",",PSG25["U"!(PSG25["A"):"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSG25_","_$E("02",PSG25["V"+1)_")" I $D(@X) S $P(@X,"^",$S(PSG25["V":6,1:26))=DA_"U"
"RTN","PSGOT",35,0)
 I $P(PSGNODE,"^",26),$P(PSGNODE,"^",26)'["V",$D(^PS(55,PSGP,5,+$P(PSGNODE,"^",26),0)) S $P(^(0),"^",25)=DA_"U"
"RTN","PSGOT",36,0)
 F Q=0:0 S Q=$O(^PS(53.44,Q)) Q:'Q  I $D(^(Q,1,PSGP,ODA,0)) S $P(^(0),"^",2)=DA
"RTN","PSGOT",37,0)
 L -^PS(53.1,ODA) L -^PS(55,DFN,5,+PSGORD) K CNT,ND,ODA,XX,ZND Q
"RTN","PSGS0")
0^17^B51528600
"RTN","PSGS0",1,0)
PSGS0 ;BIR/CML3-SCHEDULE PROCESSOR ;29 Jan 99 / 8:04 AM
"RTN","PSGS0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**12,25,26,50,63,74,83,116,110,111,133,138,174,134**;16 DEC 97;Build 124
"RTN","PSGS0",3,0)
 ;
"RTN","PSGS0",4,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSGS0",5,0)
 ; Reference to ^PS(55   is supported by DBIA 2191
"RTN","PSGS0",6,0)
 ;
"RTN","PSGS0",7,0)
ENA ; entry point for train option
"RTN","PSGS0",8,0)
 D ENCV^PSGSETU Q:$D(XQUIT)
"RTN","PSGS0",9,0)
 F  S (PSGS0Y,PSGS0XT)="" R !!,"Select STANDARD SCHEDULE: ",X:DTIME W:'$T $C(7) S:'$T X="^" Q:"^"[X  D:X?1."?" ENQ^PSGSH I X'?1."?" D EN W:$D(X)[0 $C(7),"  ??" I $D(X)#2,'PSGS0Y,PSGS0XT W "  Every ",PSGS0XT," minutes"
"RTN","PSGS0",10,0)
 K DIC,DIE,PSGS0XT,PSGS0Y,Q,X,Y,PSGDT Q
"RTN","PSGS0",11,0)
 ;
"RTN","PSGS0",12,0)
EN3 ;
"RTN","PSGS0",13,0)
 S PSGST=$P($G(^PS(53.1,DA,0)),"^",7) G EN
"RTN","PSGS0",14,0)
 ;
"RTN","PSGS0",15,0)
EN5 ;
"RTN","PSGS0",16,0)
 S PSGST=$P($G(^PS(55,DA(1),5,DA,0)),"^",7)
"RTN","PSGS0",17,0)
 ;
"RTN","PSGS0",18,0)
EN ; validate
"RTN","PSGS0",19,0)
 K PSGS0Y
"RTN","PSGS0",20,0)
 I X[""""!($A(X)=45)!(X?.E1C.E)!($L(X)>70)!($L(X)<1) K X Q
"RTN","PSGS0",21,0)
 S X=$$TRIM^XLFSTR(X,"R"," ")
"RTN","PSGS0",22,0)
 I X?.E1L.E S X=$$ENLU^PSGMI(X) I '$D(PSGOES) D EN^DDIOL("  ("_X_")")
"RTN","PSGS0",23,0)
 ;
"RTN","PSGS0",24,0)
ENOS ; order set entry
"RTN","PSGS0",25,0)
 N X0,Y0,PSJXI,PSJDIC2,TMPAT
"RTN","PSGS0",26,0)
 I $G(X)="",$G(P(2)),$G(P(3)) S X=$G(P(9))
"RTN","PSGS0",27,0)
 I $G(X)="" Q
"RTN","PSGS0",28,0)
 S PSGXT=$G(PSGS0XT),(PSGS0XT,PSGS0Y,XT,Y,PSJNSS)=""
"RTN","PSGS0",29,0)
 S X0=X I X?2.4N1"-".E!(X?2.4N) D ENCHK S:$D(X) Y=X G Q
"RTN","PSGS0",30,0)
 ; * GUI 27 CHANGES * Check for admin times to be derived from 'base' schedule
"RTN","PSGS0",31,0)
 I X["@" S TMPAT=$P(X,"@",2) I TMPAT]"" D
"RTN","PSGS0",32,0)
 .I '$D(^PS(51.1,"AC","PSJ",TMPAT)) K TMPAT Q
"RTN","PSGS0",33,0)
 .I '$$DOW^PSIVUTL($P(X,"@")) K TMPAT Q
"RTN","PSGS0",34,0)
 .N LYN,ZZND,PSGS0XT,PSGS0Y,X S (PSGS0Y,PSGS0XT,X)=""
"RTN","PSGS0",35,0)
 .S X=TMPAT D DIC I $G(Y0)>0 S TMPAT=Y0
"RTN","PSGS0",36,0)
 I $G(TMPAT) S (PSGS0Y,$P(X,"@",2))=TMPAT,PSGS0XT="D"
"RTN","PSGS0",37,0)
 ; * GUI 27 CHANGES *
"RTN","PSGS0",38,0)
 I X["PRN",$$PRNOK(X),'$D(^PS(51.1,"AC","PSJ",X)) D  G Q
"RTN","PSGS0",39,0)
 .I X["@"!$$DOW^PSIVUTL($P(X," PRN")) N DOW D  I $G(DOW) S (Y0,Y,PSGS0Y)=$P($P(X,"@",2)," ")
"RTN","PSGS0",40,0)
 ..N TMP S TMP=X N X S X=$P(TMP," PRN") D DW I $G(X)]"" S DOW=1
"RTN","PSGS0",41,0)
 ..I $G(DOW),$G(PSGST)]"" I ",P,R,"'[(","_PSGST_",") S (XT,PSGS0XT)="D"
"RTN","PSGS0",42,0)
 D DIC I $G(XT)]""!$G(Y0)!($G(X)]""&$G(PSJXI)) D  I $G(X)]"" G:$D(^PS(51.1,"AC","PSJ",X)) Q3 I $P(X,"@")]"" G:$D(^PS(51.1,"AC","PSJ",$P(X,"@"))) Q3
"RTN","PSGS0",43,0)
 .S PSGS0XT=XT S:$G(Y0) (Y,PSGS0Y)=Y0 S:'PSGS0Y&((PSGS0XT)="D")&(X["@") PSGS0Y=$P(X,"@",2)
"RTN","PSGS0",44,0)
 .S PSGS0Y=$P(PSGS0Y," ")
"RTN","PSGS0",45,0)
 N TMPSCHX S TMPSCHX=X I $L(X,"@")<3 S TMPX=X D DW I $G(X)]"" K PSJNSS S (PSGS0XT,XT)="D" D  G Q
"RTN","PSGS0",46,0)
 .S Y=$S(($G(TMPSCHX)["@"):$P(TMPSCHX,"@",2),1:"")
"RTN","PSGS0",47,0)
 .I Y,(X'["@"),(TMPSCHX["@") S X=TMPSCHX
"RTN","PSGS0",48,0)
 S X=TMPSCHX
"RTN","PSGS0",49,0)
 I X'="" I $D(^PS(51.1,"AC","PSJ",X)) K PSJNSS G Q
"RTN","PSGS0",50,0)
 ;
"RTN","PSGS0",51,0)
NS I ($G(X)="^")!($G(X)="") K X S Y="" Q
"RTN","PSGS0",52,0)
 N NS S NS=0,PSJNSS=0
"RTN","PSGS0",53,0)
 I $G(Y)'>0 S X=X0,Y="",NS=1,PSJNSS=1
"RTN","PSGS0",54,0)
Q ;
"RTN","PSGS0",55,0)
 S PSGS0XT=$S(XT]"":XT,1:$G(PSGS0XT)),PSGS0Y=$S($G(Y):Y,$G(PSGS0Y):PSGS0Y,1:"") S:PSGS0XT<0 PSGS0XT=""
"RTN","PSGS0",56,0)
 I ('$G(PSGS0Y)&'$G(PSJDIC2)&$G(PSGAT))&'$G(PSJNEWOE)&$G(PSGS0XT) I PSGS0XT<1441 I ($L($G(PSGAT),"-")=PSGS0XT/1440)!($G(X)]""&($G(PSGSCH)=$G(X))) S PSGS0Y=$G(PSGAT)
"RTN","PSGS0",57,0)
Q2 K YY
"RTN","PSGS0",58,0)
 I '$G(PSJNSS),'$G(PSGS0Y),$G(YY) S PSGS0Y=YY
"RTN","PSGS0",59,0)
 I $G(X)]"",$$SCHREQ^PSJLIVFD(.P) D
"RTN","PSGS0",60,0)
 .I $$DOW^PSIVUTL(X)!$$PRNOK(X)!$D(^PS(51.1,"AC","PSJ",X)) S PSJNSS=0 Q
"RTN","PSGS0",61,0)
 .I $G(P(2))&$G(P(3)) D NSSCONT(X,PSGS0XT) S TMPX="" K X
"RTN","PSGS0",62,0)
 I ($G(PSJNSS)&($G(VALMBCK)'="Q"))!($G(PSJNSS)&$G(PSJLIFNI))!($G(PSJNSS)&$G(PSJTUD)) D
"RTN","PSGS0",63,0)
 .I $G(P(2))&$G(P(3)) Q
"RTN","PSGS0",64,0)
 .I ($G(X)]"") I ($G(PSGS0XT)'="D") D NSSCONT(X,PSGS0XT) S TMPX="" K X
"RTN","PSGS0",65,0)
Q3 I $G(X)]"" I $D(^PS(51.1,"AC","PSJ",X)) K PSJNSS
"RTN","PSGS0",66,0)
 K QX,SDW,SWD,X0,XT,Z Q
"RTN","PSGS0",67,0)
 ;
"RTN","PSGS0",68,0)
NSSCONT(SCH,FREQ) ;
"RTN","PSGS0",69,0)
 Q:SCH=""!($G(VALMBCK)]"")!$G(PSGMARSD)!$G(PSIVFN1)
"RTN","PSGS0",70,0)
 I $G(PSGOES),'$G(NSFF) Q
"RTN","PSGS0",71,0)
 N PSGS0XT,PSGSCH,DIR,X,Y S PSGSCH=SCH,PSGS0XT=FREQ,PSJNSS=1
"RTN","PSGS0",72,0)
 D NSSMSG I ($L(PSJNSS)>2),'$G(PSJXI) W !!,PSJNSS,! S PSJNSS=1
"RTN","PSGS0",73,0)
 S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR
"RTN","PSGS0",74,0)
 K NSFF Q
"RTN","PSGS0",75,0)
 ;
"RTN","PSGS0",76,0)
NSSMSG ;
"RTN","PSGS0",77,0)
 Q:$G(PSJXI)
"RTN","PSGS0",78,0)
 I '(",O,"[(","_$G(PSGST)_",")),$G(PSJNSS),$G(PSGSCH)]"" D
"RTN","PSGS0",79,0)
 .S PSJNSS=" WARNING - "_PSGSCH_" is an invalid schedule."
"RTN","PSGS0",80,0)
 S PSGSCH="",PSGS0XT=""
"RTN","PSGS0",81,0)
 Q
"RTN","PSGS0",82,0)
 ;
"RTN","PSGS0",83,0)
NSO(FQ) ;
"RTN","PSGS0",84,0)
 Q:'FQ!(FQ<0)!(",D,O,"[(","_$G(PSGST)_",")) ""
"RTN","PSGS0",85,0)
 K FRQOUT S FRQOUT=$S(FQ<60:(FQ_"minute"),(FQ<1440)&(FQ#60):(FQ_" minute"),(FQ<1440)!(FQ#1440):(FQ/60_" hour"),1:(FQ/1440_" day")) D
"RTN","PSGS0",86,0)
 . S:(+FRQOUT'=1) FRQOUT=FRQOUT_"s"
"RTN","PSGS0",87,0)
 Q FRQOUT
"RTN","PSGS0",88,0)
 ;
"RTN","PSGS0",89,0)
ENCHK ;
"RTN","PSGS0",90,0)
 I $S($L($P(X,"-"))>4:1,$L(X)>119:1,$L(X)<2:1,X'>0:1,1:X'?.ANP) K X Q
"RTN","PSGS0",91,0)
 S X(1)=$P(X,"-") I X(1)'?2N,X(1)'?4N K X Q
"RTN","PSGS0",92,0)
 S X(1)=$L(X(1)) I X'["-"&((X>$E(2400,1,X(1))!($E(X,3,4)>59))) K X Q
"RTN","PSGS0",93,0)
 F X(2)=2:1:$L(X,"-") S X(3)=$P(X,"-",X(2)) I $S($L(X(3))'=X(1):1,X(3)>$E(2400,1,X(1)):1,$E(X(3),3,4)>59:1,1:X(3)'>$P(X,"-",X(2)-1)) K X Q
"RTN","PSGS0",94,0)
 K:$D(X) X(1),X(2),X(3) Q
"RTN","PSGS0",95,0)
 ;
"RTN","PSGS0",96,0)
DIC ; Check for schedule's existence in ADMINISTRATION SCHEDULE file (#51.1)
"RTN","PSGS0",97,0)
 ; Input:    
"RTN","PSGS0",98,0)
 ;           X = Schedule Name
"RTN","PSGS0",99,0)
 ;     PSJSLUP = If $G(PSJSLUP), perform interactive fileman lookup (optional).
"RTN","PSGS0",100,0)
 ;     PSGSFLG = If $G(PSGSFLG), return schedule IEN in PSGSCIEN variable (optional)
"RTN","PSGS0",101,0)
 ;    PSJLIFNI = Flag indicating a U/D order is being finished as an IV (optional).
"RTN","PSGS0",102,0)
 ;      PSGOES = If PSGOES=1, IX^DIC is called silently. If PSGOES=2, IX^DIC is not called (optional).
"RTN","PSGS0",103,0)
 ;      PSJPWD = IEN of Inpatient Ward associated with the patient/order/schedule combination (optional).
"RTN","PSGS0",104,0)
 ; Output:
"RTN","PSGS0",105,0)
 ;           X = Schedule Name if valid Input Schedule X, undefined if invalid Input Schedule X.
"RTN","PSGS0",106,0)
 ;     PSGS0XT = Frequency of validated schedule.
"RTN","PSGS0",107,0)
 ;     PSGS0Y  = Default Admin Times of validated schedule.
"RTN","PSGS0",108,0)
 ;    PSGSCIEN = IEN of validated schedule, if PSGSLFG is passed in and is evaluated to TRUE.
"RTN","PSGS0",109,0)
 ;     
"RTN","PSGS0",110,0)
 ;
"RTN","PSGS0",111,0)
 K Y0,PSJXI N Y
"RTN","PSGS0",112,0)
 S Z=0 F PSJXI=0:1 S Z=$O(^PS(51.1,"AC","PSJ",X,Z)) Q:'Z
"RTN","PSGS0",113,0)
 I $G(X)]"",'$G(PSJSLUP) D
"RTN","PSGS0",114,0)
 .I $D(^PS(51.1,"AC","PSJ",X)) D  Q:$G(PSGS0Y)&($G(PSGS0XT)]"")
"RTN","PSGS0",115,0)
 ..I $$DOW^PSIVUTL(X) S PSGS0XT="D",PSJNSS=0 S:X["@" (Y0,PSGS0Y)=$P(X,"@",2) Q
"RTN","PSGS0",116,0)
 ..I $G(NSFF) S Y0=$S($G(PSGS0Y):PSGS0Y,$G(PSGAT)&'$G(PSJNEWOE):PSGAT,1:"") S:Y0 PSGS0Y=Y0
"RTN","PSGS0",117,0)
 .; Check for duplicate schedules - force selection
"RTN","PSGS0",118,0)
 .Q:PSJXI>1&('$G(PSGOES))&($G(PSGS0XT)]"")
"RTN","PSGS0",119,0)
 .I $D(^PS(51.1,"AC","PSJ",X)) N FREQ,ADMATCH S FREQ=$G(PSGS0XT) D
"RTN","PSGS0",120,0)
 ..N PSGS0XT,PSGS0Y,PSGST D ADMIN^PSJORPOE S:$G(PSGS0XT) XT=PSGS0XT S:$G(PSGS0Y) (Y0,Y)=PSGS0Y
"RTN","PSGS0",121,0)
 ..;Check flag PSGSFLG to determine whether to return the schedule IEN in PSGSCIEN.
"RTN","PSGS0",122,0)
 .S:$G(XT)]"" PSGS0XT=XT S:$G(Y) PSGS0Y=Y
"RTN","PSGS0",123,0)
 .I $$DOW^PSIVUTL(X) S:PSGS0XT="" (XT,PSGS0XT)="D" S:PSGS0Y="" (Y0,PSGS0Y)=$S($P(X,"@",2):$P(X,"@",2),1:"")
"RTN","PSGS0",124,0)
 I $G(PSJLIFNI)!($G(P(4))]""&($G(P(2))]"")) I '$D(^PS(51.1,"AC","PSJ",X))!($G(PSJXI)>1) S PSJSLUP=1
"RTN","PSGS0",125,0)
 I $G(NSFF),$G(PSJXI)>1 D
"RTN","PSGS0",126,0)
 .I $G(PSGS0XT)="",$G(NSFF),$G(PSGXT)]"" S PSGS0XT=PSGXT Q
"RTN","PSGS0",127,0)
 .I $G(PSGS0XT)=""!($G(PSGS0Y)="") S PSJSLUP=1
"RTN","PSGS0",128,0)
 I '$G(PSJSLUP) Q:$G(PSGS0XT)]""&($G(PSGS0Y)]"")  Q:($G(PSGS0XT)="D"&('$D(^PS(51.1,"AC","PSJ",X))))
"RTN","PSGS0",129,0)
 Q:$G(PSGOES)=2
"RTN","PSGS0",130,0)
 Q:$G(PSGS0XT)]""&(PSJXI=1)
"RTN","PSGS0",131,0)
 K PSJSLUP
"RTN","PSGS0",132,0)
 ;
"RTN","PSGS0",133,0)
 K DIC S DIC="^PS(51.1,",DIC(0)=$E("E",'$D(PSGOES))_"ISZ",DIC("W")="W ""  "","_$S('$D(PSJPWD):"$P(^(0),""^"",2)",'PSJPWD:"$P(^(0),""^"",2)",1:"$S($D(^PS(51.1,+Y,1,+PSJPWD,0)):$P(^(0),""^"",2),1:$P(^PS(51.1,+Y,0),""^"",2))"),D="APPSJ"
"RTN","PSGS0",134,0)
 I $D(PSGST) ;S DIC("S")="I $P(^(0),""^"",5)"_$E("'",PSGST'="O")_"=""O"""
"RTN","PSGS0",135,0)
 S PSJDIC2=1
"RTN","PSGS0",136,0)
 D IX^DIC K DIC S:$D(DIE)#2 DIC=DIE I Y'>0 D  Q
"RTN","PSGS0",137,0)
 .I '$$DOW^PSIVUTL(X),'$$PRNOK(X) S X="",PSJNSS=1,XT="",PSJXI=""
"RTN","PSGS0",138,0)
 S XT=$S("C"[$P(Y(0),"^",5):$P(Y(0),"^",3),1:$P(Y(0),"^",5))
"RTN","PSGS0",139,0)
 S X=+Y,Y="" I $D(PSJPWD),$D(^PS(51.1,+X,1,+PSJPWD,0)) S Y=$P(^(0),"^",2)
"RTN","PSGS0",140,0)
 ;Check flag PSGSFLG to determine whether to return the schedule IEN in PSGSCIEN.
"RTN","PSGS0",141,0)
 I $G(PSGSFLG) S PSGSCIEN=X
"RTN","PSGS0",142,0)
 S (X,X0)=Y(0,0) S:$G(Y)="" Y=$P(Y(0),"^",2)
"RTN","PSGS0",143,0)
 S (PSGS0Y,Y0)=$G(Y),Y0(0)=Y(0) I $P(Y(0),"^",3) S XT=$P(Y(0),"^",3)
"RTN","PSGS0",144,0)
 I $G(PSGS0XT)="",$$DOW^PSIVUTL(X) S (XT,PSGS0XT)="D"
"RTN","PSGS0",145,0)
 Q
"RTN","PSGS0",146,0)
 ;
"RTN","PSGS0",147,0)
DW ;
"RTN","PSGS0",148,0)
 N Y
"RTN","PSGS0",149,0)
 Q:($L(X,"@")>2)
"RTN","PSGS0",150,0)
 N AT I X["@" S AT=$P(X,"@",2)
"RTN","PSGS0",151,0)
 S SWD="SUNDAYS^MONDAYS^TUESDAYS^WEDNESDAYS^THURSDAYS^FRIDAYS^SATURDAYS",SDW=X,X=$P(X,"@",2) N XABB S XABB=""
"RTN","PSGS0",152,0)
 I X]"" D ENCHK Q:'$D(X)
"RTN","PSGS0",153,0)
 S X=$P(SDW,"@"),X(1)="-" I X?.E1P.E,X'["-"  ;F QX=1:1:$L(X) I $E(X,QX)?1P S X(1)=$E(X,QX) Q
"RTN","PSGS0",154,0)
 F Q=1:1:$L(X,X(1)) K:SWD="" X Q:SWD=""  S Z=$P(X,X(1),Q) D DWC Q:'$D(X)
"RTN","PSGS0",155,0)
 I $D(X) F II=1:1:$L(X,X(1)) S XABB=$G(XABB)_$E($P(X,X(1),II),1,2)_"-"
"RTN","PSGS0",156,0)
 K X(1) S:$D(X) X=SDW I $G(X)]"" I $TR(XABB,"-")]"" S X=$E($G(XABB),1,$L(XABB)-1)
"RTN","PSGS0",157,0)
 I $G(AT) S PSGS0Y=AT
"RTN","PSGS0",158,0)
 Q
"RTN","PSGS0",159,0)
DWC I $L(Z)<2 K X Q
"RTN","PSGS0",160,0)
 F QX=1:1:$L(SWD,"^") S Y=$P(SWD,"^",QX) I $P(Y,Z)="" S SWD=$P(SWD,Y,2) S:$L(SWD) SWD=$E(SWD,2,50) Q
"RTN","PSGS0",161,0)
 E  K X
"RTN","PSGS0",162,0)
 Q
"RTN","PSGS0",163,0)
 ;
"RTN","PSGS0",164,0)
PRNOK(PSCH) ;
"RTN","PSGS0",165,0)
 Q:PSCH'["PRN" 0
"RTN","PSGS0",166,0)
 I $TR(PSCH," ")="PRN" Q 1
"RTN","PSGS0",167,0)
 N BASE,I,OK S OK=0 S I=$P(PSCH," PRN") I I]"",$D(^PS(51.1,"AC","PSJ",I)) S OK=1
"RTN","PSGS0",168,0)
 I 'OK D
"RTN","PSGS0",169,0)
 .I PSCH["@" I $D(^PS(51.1,"AC","PSJ",$P(PSCH,"@")))!$$DOW^PSIVUTL($P(PSCH,"@")) S OK=1 Q
"RTN","PSGS0",170,0)
 .I $$DOW^PSIVUTL($P(PSCH," PRN")) S OK=1
"RTN","PSGS0",171,0)
 Q OK
"RTN","PSGS0",172,0)
ODD(PSF) ;determine if this is an odd schedule
"RTN","PSGS0",173,0)
 I PSF>1439,PSF#1440 Q 1
"RTN","PSGS0",174,0)
 I PSF,PSF<1440,1440#PSF Q 1
"RTN","PSGS0",175,0)
 Q 0
"RTN","PSIVCAL")
0^34^B65800854
"RTN","PSIVCAL",1,0)
PSIVCAL ;BIR/RGY,PR-CALCULATES START AND STOP DATES ;12 Mar 99 / 12:42 PM
"RTN","PSIVCAL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**4,26,41,47,63,67,69,58,94,80,110,111,177,120,134**;16 DEC 97;Build 124
"RTN","PSIVCAL",3,0)
 ;
"RTN","PSIVCAL",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA #2180.
"RTN","PSIVCAL",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA #1231.
"RTN","PSIVCAL",6,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSIVCAL",7,0)
 ;
"RTN","PSIVCAL",8,0)
ENT ;NEEDS PSIVTYPE (P(4))
"RTN","PSIVCAL",9,0)
 I $G(PSJREN) D  Q:P(2)
"RTN","PSIVCAL",10,0)
 . I $G(P("OLDON")) N P2 S P2=$G(@("^PS(55,"_DFN_",""IV"","_+P("OLDON")_",0)")),P2=$P(P2,"^",2) I P2 S P(2)=P2
"RTN","PSIVCAL",11,0)
 I $G(PSJORD)["P",$G(P("APPT"))?7N1"."1.N S START=$$DATE2^PSJUTL2(P("APPT")) G Q
"RTN","PSIVCAL",12,0)
 I $G(PSJSYSW0)=""!($P(PSJSYSW0,U,5)=2) S START=+$E(P("LOG"),1,12) G Q
"RTN","PSIVCAL",13,0)
 S PSIVSN=+P("IVRM"),START="",PSIVTYPE=$G(P(4)) Q:PSIVTYPE=""
"RTN","PSIVCAL",14,0)
 N PSIV X $S($E(PSIVAC)="C":"S X=+$E(P(""LOG""),1,12) D H^%DTC S PSIV=%T",1:"S PSIV=$P($H,"","",2)") G T2:PSIVTYPE'["P"&('P(5))
"RTN","PSIVCAL",15,0)
 I P(11)']"" X $S($E(PSIVAC)="C":"S Y=+$E(P(""LOG""),1,12)",1:"D NOW^%DTC S Y=%") S Y=Y+.007\.01/100 S:'$P(Y,".",2) Y=$$MDNGHT(Y) X ^DD("DD") S START=Y G Q
"RTN","PSIVCAL",16,0)
 S X=P(11) D CHK S PX=Y,X1=PSIV\3600,X2=PSIV#3600\60,X=$E(".0",1,$L(X1)#2+1)_X1_$E("0",X2<10)_X2,START=$S($E(PSIVAC)="C":$P(P("LOG"),"."),1:"T")
"RTN","PSIVCAL",17,0)
 S X1=$P(PX,"-"),X1=$E(".0",1,$L(X1)#2+1)_X1,X2=$P(PX,"-",PSGCNT),X2=$E(".0",1,$L(X2)#2+1)_X2
"RTN","PSIVCAL",18,0)
 S NAT=+$P($G(^PS(59.6,+$O(^PS(59.6,"B",+VAIN(4),0)),0)),U,5)
"RTN","PSIVCAL",19,0)
 I '$D(PSGDT) S PSGDT=$$DATE^PSJUTL2()
"RTN","PSIVCAL",20,0)
 I X<X1,'NAT S START=$$ENSD^PSGNE3(P(9),P(11),+$E(P("LOG"),1,12),PSGDT) G Q
"RTN","PSIVCAL",21,0)
 I X>X2 S START=$$ENSD^PSGNE3(P(9),P(11),+$E(P("LOG"),1,12),PSGDT) G Q
"RTN","PSIVCAL",22,0)
T6 F I=2:1:PSGCNT S X1="."_$P(PX,"-",I-1),X2="."_$P(PX,"-",I) Q:+X1<X&(+X2>X)
"RTN","PSIVCAL",23,0)
 S X1=X-X1,X2=$S(NAT:0,1:X2-X),START=$S(X1<X2:$P(PX,"-",I-1),1:$P(PX,"-",I)) S:START="" START=$P(PX,"-") X $S($E(PSIVAC)="C":"S Y=$P(P(""LOG""),""."") X ^DD(""DD"") S PSIV=Y",1:"S PSIV=""TODAY""") S START=PSIV_"@"_$E("0",$L(START)=3)_START G Q
"RTN","PSIVCAL",24,0)
T2 S X=+("."_$E(10000+(PSIV\3600*100)+(PSIV#3600\60),2,5)),START=$O(^PS(59.5,PSIVSN,3,"AT",X)) S:'START START=$O(^(0)),PSIVTOM=1 I 'START S START=X K PSIVTOM
"RTN","PSIVCAL",25,0)
 S START=$S($E(PSIVAC)="C":$P(P("LOG"),"."),1:DT)_START I $D(PSIVTOM) S X1=$S($E(PSIVAC)="C":$P(P("LOG"),"."),1:DT),X2=1 D C^%DTC S Y=$P(X,".")_START K PSIVTOM
"RTN","PSIVCAL",26,0)
 S X=START,%DT="XRTX" D ^%DT
"RTN","PSIVCAL",27,0)
Q ;
"RTN","PSIVCAL",28,0)
 I START["@" S X=START,%DT="RTX" D ^%DT S START=+Y
"RTN","PSIVCAL",29,0)
 S P(2)=START
"RTN","PSIVCAL",30,0)
 I $G(PSJORD)["P" D:'$G(PSGRDTX(+PSJORD,"PSGSD")) REQDT^PSJLIVMD(PSJORD) S START=$G(PSGRDTX(+PSJORD,"PSGSD")) S P(2)=$S(START:START,1:P(2))
"RTN","PSIVCAL",31,0)
 K NAT,START,PSIVTYPE,PSIVSTRT,PSGCNT,X1,X2,PX
"RTN","PSIVCAL",32,0)
 Q
"RTN","PSIVCAL",33,0)
CHK F Y=1:1 Q:$L(X)>240!($P(X,"-",Y)="")  S $P(X,"-",Y)=$P(X,"-",Y)_$E("0000",1,4-$L($P(X,"-",Y)))
"RTN","PSIVCAL",34,0)
 S Y=X,PSGCNT=$L(X,"-") S:X]""&(PSGCNT<1) PSGCNT=1 Q
"RTN","PSIVCAL",35,0)
 ;
"RTN","PSIVCAL",36,0)
ENSTOP ; WILL CALCULATE STOP DATE FOR ORDER
"RTN","PSIVCAL",37,0)
 ;NEEDS (DFN) & ON
"RTN","PSIVCAL",38,0)
 N WALL,P3,ADX,DDLX,OIX,DRGT,PSIDAY,PSIMIN,LIMDAY S (WALL,P3,PSIDAY,PSIMIN)=0
"RTN","PSIVCAL",39,0)
 D:'$G(PSIVSITE) ^PSIVSET  Q:'P(2)
"RTN","PSIVCAL",40,0)
 I P(23)'="" S PSIVTYPE="C"
"RTN","PSIVCAL",41,0)
 S STOP="",X="",PSIVSTRT=P(2),PSIVTYPE=$G(P(4)) I $G(PSJREN) D
"RTN","PSIVCAL",42,0)
 . N RDT I $G(ON)["P" S RDT=+$$LASTREN^PSJLMPRI(DFN,ON)
"RTN","PSIVCAL",43,0)
 . S PSIVSTRT=$$DATE2^PSJUTL2($S($G(RDT):RDT,1:$G(PSGDT)))
"RTN","PSIVCAL",44,0)
 ;BHW - PSJ*5*177 - Begin Modifications - Reset Start date to Last Renewed date for active orders that have been renewed
"RTN","PSIVCAL",45,0)
 I ('$G(PSJREN))&($G(P(4))="A")&($G(ON)["V") D
"RTN","PSIVCAL",46,0)
 . N RDT S RDT=+$$LASTREN^PSJLMPRI(DFN,ON)
"RTN","PSIVCAL",47,0)
 . I +RDT S PSIVSTRT=RDT
"RTN","PSIVCAL",48,0)
 . Q
"RTN","PSIVCAL",49,0)
 ;BHW - PSJ*5*177 - End Modifications - Resetting PSIVSTRT will recalculate the stop date based on the Last renewed date.
"RTN","PSIVCAL",50,0)
 ;
"RTN","PSIVCAL",51,0)
 I $S("^NOW^STAT^ONCE^ONE-TIME^ONE TIME^ONETIME^1TIME^1-TIME^1 TIME^"[(U_P(9)_U):1,1:0),PSIVTYPE="P"!P(5)!(P(23)="P") S X=$$ENOSD^PSJDCU(PSJSYSW0,PSIVSTRT,DFN) I X]"" S:P(11)=""&($G(ON)["P") PSIVCAL=1 G END
"RTN","PSIVCAL",52,0)
 I '$G(P("OVRIDE")),$G(ON) N DUR,DURMIN,PSJPROV,PSJDNM,A,PSJDAY I $G(ON)["V"!(($G(ON)["P")&($P($G(^PS(53.1,+ON,0)),"^",4)="F")) D
"RTN","PSIVCAL",53,0)
 . S DUR=$$GETDUR^PSJLIVMD(DFN,+ON,"IV",1) I DUR]"" S DURMIN=$$DURMIN^PSJLIVMD(DUR) I DURMIN S PSIMIN=DURMIN
"RTN","PSIVCAL",54,0)
 I $P(PSIVSITE,"^",5) D
"RTN","PSIVCAL",55,0)
 . N Z S Y=0
"RTN","PSIVCAL",56,0)
 . F  S Y=$O(^PS(55,DFN,"IV",Y)) Q:'Y  S Z=^(Y,0) D  Q:X]""
"RTN","PSIVCAL",57,0)
 .. I $P(Z,"^",17)="A",$$ONE^PSJBCMA(DFN,Y_"V",$P(Z,"^",9))'="O" S X=$P(Z,"^",3) Q
"RTN","PSIVCAL",58,0)
 S:$G(X) WALL=X
"RTN","PSIVCAL",59,0)
 S PSIDAY=$S(PSIVTYPE="A":$P(PSIVSITE,"^",4),PSIVTYPE="H":$P(PSIVSITE,"^",17),PSIVTYPE="P":$P(PSIVSITE,"^",18),PSIVTYPE="S":$P(PSIVSITE,"^",20),1:$P(PSIVSITE,"^",21))
"RTN","PSIVCAL",60,0)
 I $G(ON)["P"!($G(ON)["V") I '$G(P("OVRIDE")) N MINS,LIM S PSIVLIM=$$GETLIM(DFN,ON) I $G(PSIVLIM)]"" S MINS=$$GETMIN(PSIVLIM,DFN,ON,.LIMDAY) D
"RTN","PSIVCAL",61,0)
 .I (MINS&(MINS<PSIMIN))!'PSIMIN S PSIMIN=MINS
"RTN","PSIVCAL",62,0)
 S PSJDAY="" D  I PSJDAY]"",PSJDAY<PSIDAY S PSIDAY=PSJDAY
"RTN","PSIVCAL",63,0)
 . N A,B,PSJCLIN
"RTN","PSIVCAL",64,0)
 . Q:'$D(PSJORD)  S A=""
"RTN","PSIVCAL",65,0)
 . I PSJORD["P" S A=$G(^PS(53.1,+PSJORD,"DSS"))
"RTN","PSIVCAL",66,0)
 . I PSJORD["U" S A=$G(^PS(55,PSGP,5,+PSJORD,8))
"RTN","PSIVCAL",67,0)
 . I PSJORD["V" S A=$G(^PS(55,PSGP,"IV",+PSJORD,"DSS"))
"RTN","PSIVCAL",68,0)
 . S (PSJCLIN,A)=$P(A,"^") Q:A=""  S PSJCLIN=$P(^SC(PSJCLIN,0),"^") I $D(^PS(53.46,"B",A)) S B=$O(^PS(53.46,"B",A,"")),PSJDAY=$P(^PS(53.46,B,0),"^",2)
"RTN","PSIVCAL",69,0)
 F X=0:0 S X=$O(DRG("AD",X)) Q:'X  I $P(^PS(52.6,+$P(DRG("AD",+X),U),0),"^",4),($P(^(0),"^",4))<+PSIDAY S PSIDAY=$P(^(0),"^",4)
"RTN","PSIVCAL",70,0)
 I WALL,($$FMADD^XLFDT(PSIVSTRT,PSIDAY,"D"))>WALL S PSIDAY=$$FMDIFF^XLFDT(WALL,PSIVSTRT,1) S:PSIDAY<1 PSIDAY=""
"RTN","PSIVCAL",71,0)
 S DRGT=$S($D(DRG("AD")):"AD",1:"SOL") F ADX=0:0 S ADX=$O(DRG(DRGT,ADX)) Q:'ADX!($G(DRGTMP)&($G(DRGTN)["AD")&(DRGT="SOL"))  D
"RTN","PSIVCAL",72,0)
 . S OIX=+$P(DRG(DRGT,ADX),"^",6),DDLX=$P(^PS(50.7,OIX,0),"^",5) Q:'DDLX  D DDLIM(.PSIDAY,.P3)
"RTN","PSIVCAL",73,0)
 I '$G(DRG("AD",0)),$G(DRGTMP),($G(DRGTN)["SOL") S OIX=$P($G(DRGTMP),"^",6) I OIX S DDLX=$P(^PS(50.7,OIX,0),"^",5) I DDLX  D DDLIM(.PSIDAY,.P3)
"RTN","PSIVCAL",74,0)
 I $G(PSIVLIM)["a",'$G(P("OVRIDE")) S DDLX=$P(PSIVLIM,"a",2)_"L" I $G(DDLX) D DDLIM(.PSIDAY,.P3)
"RTN","PSIVCAL",75,0)
 I $G(P(2)) I P3>P(2) S X=P3
"RTN","PSIVCAL",76,0)
 S:('PSIDAY&'PSIMIN) PSIDAY=1
"RTN","PSIVCAL",77,0)
TIME S X2=PSIDAY,X1=PSIVSTRT D C^%DTC S X=$P(X,"."),X=X_$S($P(PSIVSITE,"^",14)="":.2359,1:"."_$P(PSIVSITE,"^",14))
"RTN","PSIVCAL",78,0)
 I PSIMIN D
"RTN","PSIVCAL",79,0)
 . I $G(PSIDAY),((PSIDAY*1440)<PSIMIN) K PSIVLIM,P("LIMIT") S P("OVRIDE")=1 Q
"RTN","PSIVCAL",80,0)
 . I (PSIMIN<(PSIDAY*1440)!'$G(PSIDAY)) S X=$$FMADD^XLFDT(PSIVSTRT,,,PSIMIN) D
"RTN","PSIVCAL",81,0)
 .. I '(PSIMIN#1440) S X=$P(X,"."),X=X_$S($P(PSIVSITE,"^",14)="":.2359,1:"."_$P(PSIVSITE,"^",14))
"RTN","PSIVCAL",82,0)
END ;
"RTN","PSIVCAL",83,0)
 S P(3)=+X
"RTN","PSIVCAL",84,0)
 I $G(PSJORD)["P" D:'$G(PSGRDTX(+PSJORD,"PSGFD")) REQDT^PSJLIVMD(PSJORD) S P(3)=$S($G(PSGRDTX(+PSJORD,"PSGFD")):PSGRDTX(+PSJORD,"PSGFD"),1:P(3))
"RTN","PSIVCAL",85,0)
 S P(3)=$$DATE2^PSJUTL2(P(3)),P(2)=$$DATE2^PSJUTL2(P(2))
"RTN","PSIVCAL",86,0)
 Q
"RTN","PSIVCAL",87,0)
 ;
"RTN","PSIVCAL",88,0)
ENAD ;Will get last admin. time for order (needs dfn and on)
"RTN","PSIVCAL",89,0)
 N P4,PSIVX,PSIVY
"RTN","PSIVCAL",90,0)
 I $P(PSJSYSW0,U,5)=2 S PSIVADM=$$DATE^PSJUTL2() Q
"RTN","PSIVCAL",91,0)
 I $S($G(PSIVAC)["R":1,P(9)="QOD":1,1:P(9)?1"Q".N1"D") S PSIVADM=$$ENSD^PSGNE3(P(9),P(11),+$E(P("LOG"),1,12),+$P($G(^PS(55,DFN,"IV",+P("OLDON"),0)),U,2)) Q:PSIVADM
"RTN","PSIVCAL",92,0)
 S PSIVX=X,PSIVY=Y,P4=P(4) S:P(4)="C" P4=P(23) S:P4="S" P4=$S(P(5):"P",1:"A") D NOW^%DTC S Y=%,PSIVNOW=Y I (P4="P"&(P(11)="")&'P(15))!("HA"[P4&'P(15)) S Y=Y+.007\.01/100 G QAD
"RTN","PSIVCAL",93,0)
 D P:P4="P"&('P(15)),AH:P(15)
"RTN","PSIVCAL",94,0)
QAD ;
"RTN","PSIVCAL",95,0)
 S:'$D(PSGSA) PSGSA=""
"RTN","PSIVCAL",96,0)
 S PSIVSD=Y I Y S OD=$L(PSGSA," ") I OD>2 S X=+PSGSA\1 F OD1=2:1:OD-1 I $P(PSGSA," ",OD1)'>$S(OD1>2:$P(PSGSA," ",OD1-1),1:PSGSA#1) S X1=X,X2=1 D C^%DTC
"RTN","PSIVCAL",97,0)
 I PSIVSD,OD>2 S Y=X_PSIVSD
"RTN","PSIVCAL",98,0)
 S PSIVADM=+Y,X=PSIVX,Y=PSIVY K PSGSA,PSIVSD,OD,OD1,PSIVMI,PSIVNOW S:PSIVADM<P(2) PSIVADM=P(2) Q
"RTN","PSIVCAL",99,0)
 ;
"RTN","PSIVCAL",100,0)
P S CD=PSIVNOW,PSGSA="",(PSIVSD,OD)=DT_.0001,X=P(11) D CHK S P(11)=X D ENP4^PSIVWL
"RTN","PSIVCAL",101,0)
 I PSGSA="" S PSIVSD=DT_.0001,PSIVMIN=-1440 D ENT^PSIVWL S $P(Y,".",2)=$P(P(11),"-",$L(P(11),"-")) Q
"RTN","PSIVCAL",102,0)
 S Y=$P(PSGSA," ",$L(PSGSA," ")-1) Q
"RTN","PSIVCAL",103,0)
AH F PSIVADM=0:-1 S CD=PSIVNOW,(X,X1)=DT,X2=PSIVADM D:X2 C^%DTC S X=$P(X,".") S (OD1,PSIVSD,OD)=X_.0001,PSIVMIN=P(15) D ENP3^PSIVWL Q:PSIVADM<-4!(PSGSA]"")
"RTN","PSIVCAL",104,0)
 S Y=$P(PSGSA," ",$L(PSGSA," ")-1) Q
"RTN","PSIVCAL",105,0)
MDNGHT(Y)          ;Sets Start Date/Time on orders placed between midnight and 12:30
"RTN","PSIVCAL",106,0)
 S Y=$$FMADD^XLFDT(Y,-1,0,0,0),Y=$P(Y,".")_".24" Q Y
"RTN","PSIVCAL",107,0)
 ;
"RTN","PSIVCAL",108,0)
DDLIM(PSIVDUR,STPDT) ;  Day Dose Limit
"RTN","PSIVCAL",109,0)
 N P3,NEWDAYS,NEWDUR
"RTN","PSIVCAL",110,0)
 I DDLX["D" D  Q:(STPDT=0)
"RTN","PSIVCAL",111,0)
 .I +DDLX'<+PSIVDUR S STPDT=0 Q
"RTN","PSIVCAL",112,0)
 .S PSIVDUR=+DDLX,X2=PSIVDUR,X1=PSIVSTRT D C^%DTC S X=$P(X,"."),X=X_$S($P(PSIVSITE,"^",14)="":.2359,1:"."_$P(PSIVSITE,"^",14)) I X>P(2) S P(3)=X
"RTN","PSIVCAL",113,0)
 I DDLX["L",($G(P(9))]""),("AH"'[$G(PSIVTYPE)) S LASTD=$$DOSES(DDLX,.P) I LASTD D
"RTN","PSIVCAL",114,0)
 .S NEWDUR=$$FMDIFF^XLFDT(LASTD,P(2),2) I NEWDUR>0 S NEWDAYS=(NEWDUR/86400)
"RTN","PSIVCAL",115,0)
 .I $G(NEWDAYS) I NEWDAYS<PSIVDUR S PSIVDUR=NEWDAYS S P(3)=$$DATE2^PSJUTL2(LASTD)
"RTN","PSIVCAL",116,0)
 S P(3)=$$DATE2^PSJUTL2(P(3)),P(2)=$$DATE2^PSJUTL2(P(2)) S STPDT=P(3)
"RTN","PSIVCAL",117,0)
 Q
"RTN","PSIVCAL",118,0)
 ;
"RTN","PSIVCAL",119,0)
GETLIM(DFN,PSJORD) ; Convert IV Limits to minutes (only if in 'time' form).
"RTN","PSIVCAL",120,0)
 N ND2P5,F
"RTN","PSIVCAL",121,0)
 S F=$S(PSJORD["P":"^PS(53.1,+PSJORD,",PSJORD["V":"^PS(55,DFN,""IV"",+PSJORD,",1:"")
"RTN","PSIVCAL",122,0)
 S ND2P5=$G(@(F_"2.5)")) S LIM=$P(ND2P5,"^",4) Q:LIM="" 0
"RTN","PSIVCAL",123,0)
 S ND0=$G(@(F_"0)")) I PSJORD["P",$P(ND0,"^",4)="U" Q 0
"RTN","PSIVCAL",124,0)
 N MULT S MULT=$S($E(LIM)="h":60,$E(LIM)="d":1440,$E(LIM)="m":LIM,$E(LIM)="l":LIM,$E(LIM)="a":LIM,1:0) I MULT S LIM=MULT*$E(LIM,2,99)
"RTN","PSIVCAL",125,0)
 Q LIM
"RTN","PSIVCAL",126,0)
 ;
"RTN","PSIVCAL",127,0)
GETMIN(LIM,DFN,PSJORD,DAYS) ; Return the duration of the IV Limit in minutes (includes IV Limits in volume and doses format) 
"RTN","PSIVCAL",128,0)
 S LIM=$$GETMIN^PSIVUTL1(LIM,DFN,PSJORD,.DAYS)
"RTN","PSIVCAL",129,0)
 Q LIM
"RTN","PSIVCAL",130,0)
DOSES(DDLX,PRAY) ; Find stop date when 'doses' are sent as an IV Limit
"RTN","PSIVCAL",131,0)
 Q:$G(DDLX)'["L" ""
"RTN","PSIVCAL",132,0)
 I $P(DDLX,"L")["." S DDLX=($P(DDLX,".")+1)_"L"
"RTN","PSIVCAL",133,0)
 I '$G(PRAY(15)),$G(PRAY(11)) S PRAY(15)=1440/$L(PRAY(11),"-")
"RTN","PSIVCAL",134,0)
 Q:'$G(PRAY(2))!'$G(OIX) ""
"RTN","PSIVCAL",135,0)
 N FIRST,DOSAR,LAST,TMP9 S LAST="",TMP9=PRAY(9)
"RTN","PSIVCAL",136,0)
 S STRING=PRAY(2)_"^"_$S($G(STPDT):STPDT,1:$$FMADD^XLFDT(PSGDT,30))_"^"_PRAY(9)_"^C^"_OIX S FIRST=$$ENQ^PSJORP2(DFN,STRING)
"RTN","PSIVCAL",137,0)
 S P(9)=TMP9
"RTN","PSIVCAL",138,0)
 S FIRST=$S($G(FIRST):FIRST,1:PRAY(2)) Q:'FIRST  S DSTMP=FIRST,DOSAR(1)=DSTMP D
"RTN","PSIVCAL",139,0)
 .I '$G(PRAY(11)) F I=2:1:DDLX+1 S DOSAR(I)=$$FMADD^XLFDT(DSTMP,,,PRAY(15)),DSTMP=DOSAR(I) Q
"RTN","PSIVCAL",140,0)
 .I $G(PRAY(11)) N ADMS,NXT,LAST,DAY S LAST=$P(DSTMP,".",2),DAY=$P(DSTMP,".") D
"RTN","PSIVCAL",141,0)
 ..F II=1:1:$L(PRAY(11),"-") S ADMS(+$P(PRAY(11),"-",II))=$P(PRAY(11),"-",II)
"RTN","PSIVCAL",142,0)
 ..F IJ=2:1:DDLX+1 S NXT=$O(ADMS(+LAST)),LAST=NXT D
"RTN","PSIVCAL",143,0)
 ...I NXT="" S NXT=$O(ADMS(NXT)),LAST=NXT,DAY=$$FMADD^XLFDT(DAY,1)
"RTN","PSIVCAL",144,0)
 ...S DOSAR(IJ)=DAY_"."_ADMS(NXT),DSTMP=DOSAR(IJ)
"RTN","PSIVCAL",145,0)
 ..I +DDLX=1 S NXT=$O(ADMS(LAST)),LAST=NXT D
"RTN","PSIVCAL",146,0)
 ...I NXT="" S NXT=$O(ADMS(NXT)),LAST=NXT
"RTN","PSIVCAL",147,0)
 I $D(DOSAR) S LAST=$O(DOSAR(""),-1) I LAST S LAST=DOSAR(LAST)
"RTN","PSIVCAL",148,0)
 Q LAST
"RTN","PSIVEDT")
0^10^B41996183
"RTN","PSIVEDT",1,0)
PSIVEDT ;BIR/MLM-EDIT IV ORDER ;10 Feb 98 / 3:23 PM
"RTN","PSIVEDT",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**4,110,127,133,134**;16 DEC 97;Build 124
"RTN","PSIVEDT",3,0)
 ;
"RTN","PSIVEDT",4,0)
 ; Reference to ^DD(53.1 is supported by DBIA 2256.
"RTN","PSIVEDT",5,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVEDT",6,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSIVEDT",7,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSIVEDT",8,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSIVEDT",9,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVEDT",10,0)
 ;
"RTN","PSIVEDT",11,0)
EDIT ;
"RTN","PSIVEDT",12,0)
 I $G(DFN)&($G(PSJORD)["V") I $$COMPLEX^PSJOE(DFN,PSJORD) D
"RTN","PSIVEDT",13,0)
 . N X,Y,PARENT,P2ND S P2ND=$S($G(^PS(55,PSGP,"IV",+PSJORD,.2)):$G(^PS(55,PSGP,"IV",+PSJORD,.2)),1:$G(^PS(55,PSGP,5,+PSJORD,.2)))
"RTN","PSIVEDT",14,0)
 . S PARENT=$P(P2ND,"^",8)
"RTN","PSIVEDT",15,0)
 . I PARENT D FULL^VALM1 W !!?5,"This order is part of a complex order. Please review the following ",!?5,"associated orders before changing this order." D CMPLX^PSJCOM1(PSGP,PARENT,PSJORD)
"RTN","PSIVEDT",16,0)
 S DONE=0
"RTN","PSIVEDT",17,0)
 F PSIVE=1:1 S:DONE&$E(PSIVAC)="C" OREND=1 Q:PSIVE>$L(EDIT,U)!(DONE)  Q:'$L($P(EDIT,U,PSIVE))  D @($P(EDIT,U,PSIVE)) S:$E(PSIVAC,2)="N" PSIVOK=PSIVOK_U_$P(EDIT,U,PSIVE) I $E(X)=U,$L(X)>1 S:PSIVE>1 PSIVE=PSIVE-1 F  D FF Q:Y<0  D @Y Q:$E(X)'=U
"RTN","PSIVEDT",18,0)
 K EDIT,PSIVOK,PSGDI
"RTN","PSIVEDT",19,0)
 Q
"RTN","PSIVEDT",20,0)
 ;
"RTN","PSIVEDT",21,0)
1 ; Provider.
"RTN","PSIVEDT",22,0)
 I $G(P("RES"))="R" I $G(PSJORD)["P",$P($G(^PS(53.1,+$G(ON),0)),"^",24)="R" D  Q
"RTN","PSIVEDT",23,0)
 . W !!?5,"This is Renewal order. Provider may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",24,0)
 I $G(DFN)&($G(ON)["V") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT",25,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Provider may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",26,0)
 S P(6)=$S('$G(^VA(200,+P(6),"PS")):"",'$P(^("PS"),U,4):P(6),$P(^("PS"),U,4)<DT:"",1:P(6))
"RTN","PSIVEDT",27,0)
 W !,"PROVIDER: "_$S($P(P(6),U,2)]"":$P(P(6),U,2)_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $E(X)=U!(X=""&P(6)) Q
"RTN","PSIVEDT",28,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS^PSIVEDT1 G 1
"RTN","PSIVEDT",29,0)
 I X]"" K DIC S DIC=200,DIC(0)="EQMZ",DIC("S")="I $D(^(""PS"")),^(""PS""),$S('$P(^(""PS""),U,4):1,$P(^(""PS""),U,4)>DT:1,1:0)" D ^DIC K DIC I Y>0 S P(6)=+Y_U_Y(0,0) Q
"RTN","PSIVEDT",30,0)
 S F1=53.1,F2=1 D ENHLP^PSIVORC1 W $C(7),!!,"A Provider must be entered.",!! G 1
"RTN","PSIVEDT",31,0)
 Q
"RTN","PSIVEDT",32,0)
 ;
"RTN","PSIVEDT",33,0)
3 ; Med Route.
"RTN","PSIVEDT",34,0)
 I $G(P("RES"))="R" I $G(PSJORD)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT",35,0)
 . W !!?5,"Med Route may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",36,0)
 I $G(DFN)&($G(ON)["V") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT",37,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Med Route may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",38,0)
 S P(6)=$S('$G(^VA(200,+P(6),"PS")):"",'$P(^("PS"),U,4):P(6),$P(^("PS"),U,4)<DT:"",1:P(6))
"RTN","PSIVEDT",39,0)
 I P("MR")="" D
"RTN","PSIVEDT",40,0)
 .N AD,SOL,OI,RT,RTCNT
"RTN","PSIVEDT",41,0)
 .S AD=0 F  S AD=$O(DRG("AD",AD)) Q:'AD  S OI=$P(DRG("AD",AD),"^",6) I OI S OI(OI)=""
"RTN","PSIVEDT",42,0)
 .S SOL=0 F  S SOL=$O(DRG("SOL",SOL)) Q:'SOL  S OI=$P(DRG("SOL",SOL),"^",6) I OI S OI(OI)=""
"RTN","PSIVEDT",43,0)
 .S OI="" F  S OI=$O(OI(OI)) Q:'OI  S RT=$P(^PS(50.7,OI,0),"^",6) S:RT="" RT="NONE" S RT(RT)=$P($G(^PS(51.2,+RT,0)),"^",3)
"RTN","PSIVEDT",44,0)
 .S RT="" F RTCNT=0:1 S RT=$O(RT(RT)) Q:RT=""
"RTN","PSIVEDT",45,0)
 .Q:RTCNT>1
"RTN","PSIVEDT",46,0)
 .S RT=$O(RT("")) I RT]"" S P("MR")=RT_"^"_$G(RT(RT))
"RTN","PSIVEDT",47,0)
 W !,"MED ROUTE: "_$S($P(P("MR"),U,2)]"":$P(P("MR"),U,2)_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I X=U!(X=""&P("MR"))!($E(X)=U) Q
"RTN","PSIVEDT",48,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS^PSIVEDT1 G 3
"RTN","PSIVEDT",49,0)
 I X]"" K DIC S DIC=51.2,DIC(0)="EQMZ",DIC("S")="I $P(^(0),U,4)" D ^DIC K DIC I Y>0 S P("MR")=+Y_U_$P(Y(0),U,3) Q
"RTN","PSIVEDT",50,0)
 S F1=53.1,F2=3 D ENHLP^PSIVORC1 W $C(7),!!,"A Med Route must be entered." G 3
"RTN","PSIVEDT",51,0)
 Q
"RTN","PSIVEDT",52,0)
 ;
"RTN","PSIVEDT",53,0)
10 ; Start Date.
"RTN","PSIVEDT",54,0)
 D 10^PSIVEDT1
"RTN","PSIVEDT",55,0)
 Q
"RTN","PSIVEDT",56,0)
 ;
"RTN","PSIVEDT",57,0)
25 ; Stop Date.
"RTN","PSIVEDT",58,0)
 D 25^PSIVEDT1
"RTN","PSIVEDT",59,0)
 Q
"RTN","PSIVEDT",60,0)
26 ; Schedule
"RTN","PSIVEDT",61,0)
 D 26^PSIVEDT1
"RTN","PSIVEDT",62,0)
 Q
"RTN","PSIVEDT",63,0)
 ;
"RTN","PSIVEDT",64,0)
39 ; Admin Times.
"RTN","PSIVEDT",65,0)
 D 39^PSIVEDT1
"RTN","PSIVEDT",66,0)
 Q
"RTN","PSIVEDT",67,0)
 ;
"RTN","PSIVEDT",68,0)
57 ; Additive.
"RTN","PSIVEDT",69,0)
 I $G(P("RES"))="R" I $G(PSJORD)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT",70,0)
 . W !!?5,"Additive may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",71,0)
 I $G(DFN)&($G(ON)["V") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT",72,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Provider may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",73,0)
 I $E(PSIVAC)="O" W !!,"Only additives marked for use in IV Fluid Order Entry may be selected."
"RTN","PSIVEDT",74,0)
 S FIL=52.6,DRGT="AD",DRGTN="ADDITIVE" D DRG^PSIVEDRG,DKILL
"RTN","PSIVEDT",75,0)
 Q
"RTN","PSIVEDT",76,0)
 ;
"RTN","PSIVEDT",77,0)
58 ; Solution.
"RTN","PSIVEDT",78,0)
 I $G(P("RES"))="R" I $G(PSJORD)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT",79,0)
 . W !!?5,"Solution may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",80,0)
 S FIL=52.7,DRGT="SOL",DRGTN="SOLUTION" D DRG^PSIVEDRG
"RTN","PSIVEDT",81,0)
 ;
"RTN","PSIVEDT",82,0)
DKILL ; Kill for drug edit.
"RTN","PSIVEDT",83,0)
 K DRGI,DRGN,DRGT,DRGTN,FIL,PSIVSTR
"RTN","PSIVEDT",84,0)
 Q
"RTN","PSIVEDT",85,0)
 ;
"RTN","PSIVEDT",86,0)
59 ; Infusion Rate.
"RTN","PSIVEDT",87,0)
 D 59^PSIVEDT1
"RTN","PSIVEDT",88,0)
 Q
"RTN","PSIVEDT",89,0)
 ;
"RTN","PSIVEDT",90,0)
62 ; IV Room.
"RTN","PSIVEDT",91,0)
 N DIR S DIR(0)="PA^59.5",DIR("A")="IV Room: ",DIR("??")="^S F1=59.5,F2=.01 D ENHLP^PSIVORC1" S:P("IVRM") DIR("B")=$P(P("IVRM"),U,2)
"RTN","PSIVEDT",92,0)
 D ^DIR Q:$D(DIRUT)  I Y>0 S P("IVRM")=Y W $P($P(Y,U,2),X,2)
"RTN","PSIVEDT",93,0)
 Q
"RTN","PSIVEDT",94,0)
 ;
"RTN","PSIVEDT",95,0)
63 ; Remarks.
"RTN","PSIVEDT",96,0)
 D 63^PSIVEDT1
"RTN","PSIVEDT",97,0)
 Q
"RTN","PSIVEDT",98,0)
 ;
"RTN","PSIVEDT",99,0)
64 ; Other Print Info.
"RTN","PSIVEDT",100,0)
 D 64^PSIVEDT1
"RTN","PSIVEDT",101,0)
 Q
"RTN","PSIVEDT",102,0)
 ;
"RTN","PSIVEDT",103,0)
66 ; Provider's comments.
"RTN","PSIVEDT",104,0)
 N DA,DIE,DIR S DA=PSIVUP,DIE="^PS(53.45,",DR=4 D ^DIE S PSGSI=X,Y=1
"RTN","PSIVEDT",105,0)
 Q
"RTN","PSIVEDT",106,0)
 ;
"RTN","PSIVEDT",107,0)
101 ; Orderable Item.
"RTN","PSIVEDT",108,0)
 I $G(P("RES"))="R" I $G(PSJORD)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT",109,0)
 . W !!?5,"This is Renewal order. Orderable Item may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",110,0)
 I $G(DFN)&($G(ON)["V") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT",111,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Orderable Item may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",112,0)
 W !,"Orderable Item: "_$S(P("PD"):$P(P("PD"),U,2)_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $E(X)=U!(X=""&P("PD")) Q
"RTN","PSIVEDT",113,0)
 I X]"" N DIC S DIC="^PS(50.7,",DIC(0)="EMQZ",DIC("B")=$S(P("PD")]"":+$P(("PD"),U),1:""),DIC("S")="S PSJSCT=1 I $$DRGSC^PSIVUTL(Y,PSJSCT) K PSJSCT" D ^DIC K DIC I Y>0 S P("PD")=Y Q
"RTN","PSIVEDT",114,0)
 W $C(7),!!,"Orderable Item is required!",!! G 101
"RTN","PSIVEDT",115,0)
 Q
"RTN","PSIVEDT",116,0)
109 ; Dosage Ordered.
"RTN","PSIVEDT",117,0)
 W !,"DOSAGE ORDERED: "_$S(P("DO")]"":P("DO")_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $E(X)=U!(P("DO")]""&(X="")) Q
"RTN","PSIVEDT",118,0)
 I X="???" D ORFLDS^PSIVEDT1 G 109
"RTN","PSIVEDT",119,0)
 D:X]"" CHK^DIE(53.1,109,"",X,.X) I $G(X)="^" W $C(7),!!,"Enter the dosage in which the Orderable Item entered should be dispensed.",! W "Answer must be 1-20 characters in length." G 109
"RTN","PSIVEDT",120,0)
 S P("DO")=X
"RTN","PSIVEDT",121,0)
 Q
"RTN","PSIVEDT",122,0)
 ;
"RTN","PSIVEDT",123,0)
FF ; up-arrow to another field.
"RTN","PSIVEDT",124,0)
 N DIC S X=$P(X,U,2),DIC="^DD(53.1,",DIC(0)="QEM",DIC("S")="I U_PSIVOK_U[(U_+Y_U)" D ^DIC K DIC S Y=+Y
"RTN","PSIVEDT",125,0)
 Q
"RTN","PSIVEDT",126,0)
 ;
"RTN","PSIVEDT",127,0)
NEWDRG ; Ask if adding a new drug.
"RTN","PSIVEDT",128,0)
 K DIR S DIR(0)="Y",DIR("A")="Are you adding "_$P(TDRG,U,2)_" as a new "_$S(DRGT="AD":"additive",1:"solution")_" for this order",DIR("B")="NO" D ^DIR I $D(DTOUT)!$D(DUOUT) Q
"RTN","PSIVEDT",129,0)
 I Y S (DRGI,DRG(DRGT,0))=DRG(DRGT,0)+1,DRG=TDRG,DRG(DRGT,+DRGI)=+DRG_U_$P(DRG,U,2) I DRGT="SOL" S X=$G(^PS(52.7,+DRG,0)),$P(DRG(DRGT,DRG),U,3)=$P(X,U,3)
"RTN","PSIVEDT",130,0)
 Q
"RTN","PSIVORA")
0^11^B28909914
"RTN","PSIVORA",1,0)
PSIVORA ;BIR/MLM-MAIN DRIVER FOR IV FLUIDS - OE/RR INTERFACE ;08 JAN 97 / 2:47 PM
"RTN","PSIVORA",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**29,41,110,134**;16 DEC 97;Build 124
"RTN","PSIVORA",3,0)
 ;
"RTN","PSIVORA",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIVORA",5,0)
 ;
"RTN","PSIVORA",6,0)
EN ; Entry point called by IV Fluid protocol.
"RTN","PSIVORA",7,0)
 S X=ORACTION,PSIVAC="O"_$S(X=0:"N",X=1:"E",X=2:"R",X=4:"H",X=6:"D",X="8":"S",1:"") S:X'=5&(X'=7) PSIVUP=+$$GTPCI^PSIVUTL
"RTN","PSIVORA",8,0)
 S (PSGP,DFN)=+ORVP,PSJACNWP=1 D ^PSJAC I "578"[ORACTION D @ORACTION,DONE^PSIVORA1 Q
"RTN","PSIVORA",9,0)
 D ENCPP^PSIVOREN Q:'PSJIVORF!('PSJORF)  D EN1,DONE^PSIVORA1
"RTN","PSIVORA",10,0)
 Q
"RTN","PSIVORA",11,0)
 ;
"RTN","PSIVORA",12,0)
EN1 ; Take action on existing order.
"RTN","PSIVORA",13,0)
 S PSJORD=$G(ORPK) I ORGY>8 D @ORGY Q
"RTN","PSIVORA",14,0)
 I 'ORACTION D ^PSIVORFE Q
"RTN","PSIVORA",15,0)
 I '$G(ORPK) W !,"INSUFFICIENT INFORMATION, CANNOT CONTINUE." S OREND=1 Q
"RTN","PSIVORA",16,0)
 I ORPK["V",($P($G(^PS(55,DFN,"IV",+ORPK,0)),U,17)="O") D ONCALL^PSIVORV1 Q
"RTN","PSIVORA",17,0)
 I ORACTION<3 S P("FRES")=$S(ORPK["V":$P($G(^PS(55,DFN,"IV",+ORPK,2)),U,9),1:$P($G(^PS(53.1,+ORPK,0)),U,27)) I P("FRES")]"" D @$S(P("FRES")="R":"ALLREN^PSIVORV1",1:"ALLED^PSIVORV1") Q
"RTN","PSIVORA",18,0)
 S PSJORSTS=ORSTS,PSJORIFN=ORIFN L +@$S(PSJORD["V":"^PS(55,DFN,""IV"",+PSJORD)",1:"^PS(53.1,+PSJORD)"):1 E  D LOCKERR^PSIVORA1 Q
"RTN","PSIVORA",19,0)
 D @ORACTION L -@$S(PSJORD["V":"^PS(55,DFN,""IV"",+PSJORD)",1:"^PS(53.1,+PSJORD)")
"RTN","PSIVORA",20,0)
 Q
"RTN","PSIVORA",21,0)
 ;
"RTN","PSIVORA",22,0)
1 ; Edit an existing order.
"RTN","PSIVORA",23,0)
 D EDIT^PSIVORA1
"RTN","PSIVORA",24,0)
 Q
"RTN","PSIVORA",25,0)
 ;
"RTN","PSIVORA",26,0)
2 ; Renew
"RTN","PSIVORA",27,0)
 D RENEW^PSIVORA1
"RTN","PSIVORA",28,0)
 Q
"RTN","PSIVORA",29,0)
 ;
"RTN","PSIVORA",30,0)
3 ; Flag
"RTN","PSIVORA",31,0)
 Q
"RTN","PSIVORA",32,0)
 ;
"RTN","PSIVORA",33,0)
4 ; Hold
"RTN","PSIVORA",34,0)
 I ORSTS'=3,ORSTS'=6 W !,$C(7),"Only ACTIVE orders may be placed on HOLD." S OREND=1 Q
"RTN","PSIVORA",35,0)
 S PSIVREA=$S(ORSTS=6:"H",1:"U"),ON55=PSJORD,$P(^PS(55,DFN,"IV",+ON55,0),U,10)=$S(PSIVREA="H":1,1:""),Y=$G(^PS(55,DFN,"IV",+ON55,0)),P(3)=$P(Y,U,3),P(17)=$P(Y,U,17)
"RTN","PSIVORA",36,0)
 D NOW^%DTC I ORSTS=3,P(3)<% S P(17)="E" D UPSTAT^PSIVOPT S ORSTS=7 W $C(7),"  This order has expired." Q
"RTN","PSIVORA",37,0)
 S XED=0,PSIVALT=2,P(17)=$S(PSIVREA="H":"H",1:"A") D UPSTAT^PSIVOPT,LOG^PSIVORAL S ORSTS=$S(PSIVREA="H":3,1:6)
"RTN","PSIVORA",38,0)
 Q
"RTN","PSIVORA",39,0)
 ;
"RTN","PSIVORA",40,0)
5 ; Event
"RTN","PSIVORA",41,0)
 N DA,DIE,DR,ON,P,PSIVACT,X
"RTN","PSIVORA",42,0)
 S ON=ORPK I ON["V" S X=$G(^PS(55,+ORVP,"IV",+ON,0)),P(3)=$P(X,U,3),P(17)=$P(X,U,17)
"RTN","PSIVORA",43,0)
 I ON'["V" S P(3)=$P($G(^PS(53.1,+ON,2)),U,4),P(17)=$P($G(^PS(53.1,+ON,0)),U,9)
"RTN","PSIVORA",44,0)
 Q:"AR"'[P(17)  D NOW^%DTC Q:P(3)>%
"RTN","PSIVORA",45,0)
 I ON["V" S DR="100///E",DIE="^PS(55,"_+ORVP_",""IV"",",DA(1)=+ORVP
"RTN","PSIVORA",46,0)
 I ON'["V" S DR="28///E",DIE="^PS(53.1,"
"RTN","PSIVORA",47,0)
 S PSIVACT=1,DA=+ON D ^DIE S ORSTS=7
"RTN","PSIVORA",48,0)
 Q
"RTN","PSIVORA",49,0)
 ;
"RTN","PSIVORA",50,0)
6 ; Cancel - Delete pending or unreleased orders from Nonverified orders
"RTN","PSIVORA",51,0)
 ; (53.1) and Orders (100) files.
"RTN","PSIVORA",52,0)
 I ORSTS=1 W $C(7),!,"This order has already been DISCONTINUED." Q
"RTN","PSIVORA",53,0)
 I ORSTS=7 W $C(7),!,"Expired orders cannot be DISCONTINUED." Q
"RTN","PSIVORA",54,0)
 I PSJORD'["V",ORSTS=11 D  Q
"RTN","PSIVORA",55,0)
 .S P("OLDON")=$P($G(^PS(53.1,+PSJORD,0)),U,25) I P("OLDON")  D
"RTN","PSIVORA",56,0)
 ..I P("OLDON")["V",$D(^PS(55,DFN,"IV",+P("OLDON"),2)) S PSJRES=$P(^(2),U,9) S:PSJRES'="R" $P(^(2),U,6)="",$P(^(2),U,9)="" ;; D:PSJRES="R" ENBKOUT^PSJOREN(DFN,PSJORD)
"RTN","PSIVORA",57,0)
 ..I P("OLDON")'["V",$D(^PS(53.1,+P("OLDON"),0)) S PSJRES=$P(^(0),U,27) S:PSJRES'="R" $P(^(0),U,26,27)="^" I PSJRES="R" ;; D ENBKOUT^PSJOREN(DFN,PSJORD)
"RTN","PSIVORA",58,0)
 .K DA,DIK S DIK="^PS(53.1,",DA=+PSJORD D ^DIK S PSGP=DFN,X="P" D ENSK^PSGAXR K DA,DIK S ORIFN=PSJORIFN,ORSTS="K" Q
"RTN","PSIVORA",59,0)
 ;
"RTN","PSIVORA",60,0)
DC ; DC order from Pharmacy complete function.
"RTN","PSIVORA",61,0)
 I PSJORD["V",'PSJCOM N PSIVREA S ON55=PSJORD,X=$G(^PS(55,DFN,"IV",+ON55,0)),P(3)=$P(X,U,3),P(17)=$P(X,U,17),PSIVREA="D",PSIVALT=2,PSIVALCK="STOP" D D^PSIVOPT2 D HL Q
"RTN","PSIVORA",62,0)
 I PSJORD["V",PSJCOM N PSIVREA S ON55=PSJORD,X=$G(^PS(55,DFN,"IV",+ON55,0)),P(3)=$P(X,U,3),P(17)=$P(X,U,17),PSIVREA="D",PSIVALT=2,PSIVALCK="STOP" D D^PSIVOPT2 Q
"RTN","PSIVORA",63,0)
 N DA,DR,DIE,PSJND S DA=+PSJORD,PSJND=$G(^PS(53.1,DA,0)),P("OLDON")=$P(PSJND,U,25),DIE="^PS(53.1,",DR="28///"_$S($P(PSJND,U,27)="E":"DE",1:"D") D ^DIE
"RTN","PSIVORA",64,0)
 D HL
"RTN","PSIVORA",65,0)
 Q
"RTN","PSIVORA",66,0)
HL ;
"RTN","PSIVORA",67,0)
 Q:'$D(P("NAT"))
"RTN","PSIVORA",68,0)
 NEW PSJCD,PSJTX,PSJOTMP
"RTN","PSIVORA",69,0)
 I PSJORD["P" N PSJNOO S PSJCD="OC",PSJTX="ORDER CANCELED",PSJNOO=$G(P("NAT"))
"RTN","PSIVORA",70,0)
 E  S PSJCD="OD",PSJTX="ORDER DISCONTINUED"
"RTN","PSIVORA",71,0)
 S PSJOTMP=$G(P("OT")) S P("OT")="F" D EN1^PSJHL2(DFN,PSJCD,PSJORD,PSJTX)
"RTN","PSIVORA",72,0)
 Q
"RTN","PSIVORA",73,0)
 ;
"RTN","PSIVORA",74,0)
7 ; Purge
"RTN","PSIVORA",75,0)
 N ND S ND=$S(ORPK["V":$P($G(^PS(55,+ORVP,"IV",+ORPK,0)),U,17)_U_$P($G(^(0)),U,3),1:$P($G(^PS(53.1,+ORPK,0)),U,9)_U_$P($G(^(2)),U,4))
"RTN","PSIVORA",76,0)
 Q:"DE"'[$P(ND,U)  S X1=+$P(ND,U,2),X2=30 D C^%DTC S ND=X D NOW^%DTC Q:ND>%
"RTN","PSIVORA",77,0)
 I ORPK["V",$D(^PS(55,+ORVP,"IV",+ORPK,0)) S $P(^(0),U,21)=""
"RTN","PSIVORA",78,0)
 I ORPK'["V",$D(^PS(53.1,+ORPK,0)) S $P(^(0),U,21)=""
"RTN","PSIVORA",79,0)
 S ORSTS="K"
"RTN","PSIVORA",80,0)
 Q
"RTN","PSIVORA",81,0)
 ;
"RTN","PSIVORA",82,0)
8 ; Print
"RTN","PSIVORA",83,0)
 K DIR S DIR(0)="E" D ^DIR K DIR I $D(DUOUT)!'($D(ORPK)) S OREND=1 Q
"RTN","PSIVORA",84,0)
 S:'$G(PSIVUP) PSIVUP=+$$GTPCI^PSIVUTL S:'$D(PSIVAC) PSIVAC="OS" S (ON,ON55)=ORPK,DFN=+ORVP D @$S(ON["V":"GT55^PSIVORFB",1:"GT531^PSIVORFA("_DFN_","""_ON_""")"),ENDT^PSIVORV1
"RTN","PSIVORA",85,0)
 Q
"RTN","PSIVORA",86,0)
 ;
"RTN","PSIVORA",87,0)
9 ; Release order (status=incomplete in 53.1, pending in 100)
"RTN","PSIVORA",88,0)
 S X=ORACTION I X=4!(X=6) D @ORACTION Q
"RTN","PSIVORA",89,0)
 Q:"36"[ORSTS  N ON,PSJORIFN S PSJORIFN=ORIFN,ON=ORPK L +^PS(53.1,+ON):1 E  D LOCKERR^PSIVORA1 Q
"RTN","PSIVORA",90,0)
 S Y=$G(^PS(53.1,+ON,0)),P("RES")=$P(Y,U,24),P("OLDON")=$P(Y,U,25)
"RTN","PSIVORA",91,0)
 N DA,DIE,DR,OREND S DR="28////P",DIE="^PS(53.1,",DA=+ON D ^DIE
"RTN","PSIVORA",92,0)
 I P("OLDON")]"" K DA,DIE,DR S DA=P("OLDON") D
"RTN","PSIVORA",93,0)
 .I DA["V" S DA(1)=+ORPV,DIE="^PS(55,"_DA(1)_",""IV"",",DR="114////"_+ON_"P"_";123////"_P("RES")
"RTN","PSIVORA",94,0)
 .E  S DIE="^PS(53.1,",DR="105////"_ON_"P"_";107////"_P("RES") I P("RES")="E",$P($G(^PS(53.1,+P("OLDON"),0)),U,9)="D" S DR=DR_";28////DE"
"RTN","PSIVORA",95,0)
 .S DA=+DA L +@(DIE_DA_")"):1 E  D LOCKERR^PSIVORA1 Q
"RTN","PSIVORA",96,0)
 .D ^DIE L -@(DIE_DA_")")
"RTN","PSIVORA",97,0)
 L -^PS(53.1,+ON) D DONE^PSIVORA1
"RTN","PSIVORA",98,0)
 Q
"RTN","PSIVORA",99,0)
 ;
"RTN","PSIVORA",100,0)
10 ; Verify
"RTN","PSIVORA",101,0)
 Q
"RTN","PSIVORC")
0^21^B24718262
"RTN","PSIVORC",1,0)
PSIVORC ;BIR/MLM-COMPLETE IV ORDERS ENTERED THROUGH OE/RR ;02 Mar 99 / 10:16 AM
"RTN","PSIVORC",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**23,53,80,110,134**;16 DEC 97;Build 124
"RTN","PSIVORC",3,0)
 ;
"RTN","PSIVORC",4,0)
 ; Reference to ^DIC(42 is supported by DBIA 10039
"RTN","PSIVORC",5,0)
 ; Reference to ^DPT is supported by DBIA 10035
"RTN","PSIVORC",6,0)
 ; Reference to ^%DTC is supported by DBIA 10000
"RTN","PSIVORC",7,0)
 ; Reference to ^DID is supported by DBIA 2052
"RTN","PSIVORC",8,0)
 ;
"RTN","PSIVORC",9,0)
EN ; Set IV parameters.
"RTN","PSIVORC",10,0)
 D SITE^PSIVORE Q:'$G(PSIVQ)  K PSIVQ
"RTN","PSIVORC",11,0)
 ;
"RTN","PSIVORC",12,0)
SELECT ;
"RTN","PSIVORC",13,0)
 F  S PSGSSH="ORVC" D ^PSGSEL Q:U[PSGSS  D GTORDRS
"RTN","PSIVORC",14,0)
 D DONE^PSIVORC1
"RTN","PSIVORC",15,0)
 Q
"RTN","PSIVORC",16,0)
GTORDRS ;
"RTN","PSIVORC",17,0)
 K ^TMP("PSIV",$J) N DIC,Y D @PSGSS Q:+$G(Y)'>0  W:PSGSS'="P" !,"...a few moments, please..." D @("G"_PSGSS)
"RTN","PSIVORC",18,0)
 I $G(Y),'$D(^TMP("PSIV",$J)) W !,$C(7),"NO PENDING ORDERS FOR ",$S(PSGSS="P":"PATIENT",1:"WARD"),$S(PSGSS="G":" GROUP",1:"")," SELECTED." Q
"RTN","PSIVORC",19,0)
 D NOW^%DTC S HDT=$$ENDTC^PSGMI(%),PSIVAC="C",DONE=0,WDN=""
"RTN","PSIVORC",20,0)
 F  S WDN=$O(^TMP("PSIV",$J,WDN)) Q:WDN=""!DONE  S PNME="" F  S PNME=$O(^TMP("PSIV",$J,WDN,PNME)) Q:PNME=""!DONE  D
"RTN","PSIVORC",21,0)
 . I PSGSS'="P" S PSGDFN=$P(PNME,";",2)_"^"_$P(PNME,";") D CHK^PSJDPT(.PSGDFN,1,1) I PSGDFN=-1 Q
"RTN","PSIVORC",22,0)
 . D PROFILE D:PSIVHD ASK
"RTN","PSIVORC",23,0)
 D:$G(PSIVHD) ASK
"RTN","PSIVORC",24,0)
 Q
"RTN","PSIVORC",25,0)
 ;
"RTN","PSIVORC",26,0)
PROFILE ; Display profile of all incomplete orders.
"RTN","PSIVORC",27,0)
 ;
"RTN","PSIVORC",28,0)
 K PSGODDD S (DFN,PSGP)=$P(PNME,";",2) D ENBOTH^PSJAC
"RTN","PSIVORC",29,0)
 S RB=PSJPRB,PG=1,PSJORL=$$ENORL^PSJUTL($G(VAIN(4))),PSJIVOF=PSJORL,PSGLMT=0,LN2="" D ENHEAD^PSJO3
"RTN","PSIVORC",30,0)
 S (DONE1,TYP)="" F  S TYP=$O(^TMP("PSIV",$J,WDN,PNME,TYP)) Q:TYP=""!(DONE1)  D:$Y+5'>IOSL GTYP F ON1=0:0 S ON1=$O(^TMP("PSIV",$J,WDN,PNME,TYP,ON1)) Q:'ON1!(DONE1)  D DISPLAY
"RTN","PSIVORC",31,0)
 Q
"RTN","PSIVORC",32,0)
 ;
"RTN","PSIVORC",33,0)
DISPLAY ; Display order on profile.
"RTN","PSIVORC",34,0)
 I $Y+5>IOSL D ASK Q:DONE1  D ENHEAD^PSJO3,GTYP
"RTN","PSIVORC",35,0)
 S PSIVHD=1,PSGLMT=PSGLMT+1,PSIVCV(PSGLMT)=ON1,PSJC="" W !?3,PSGLMT D PIV^PSIVUTL(+ON1_"P")
"RTN","PSIVORC",36,0)
 Q
"RTN","PSIVORC",37,0)
 ;
"RTN","PSIVORC",38,0)
GTYP ; Get formatted heading for type
"RTN","PSIVORC",39,0)
 N PSJD5314 D FIELD^DID(53.1,4,"","POINTER","PSJD5314")
"RTN","PSIVORC",40,0)
 ; removed ^DD ref 3-2-99, pass ^^_set of codes value
"RTN","PSIVORC",41,0)
 ; because codes^psivutl uses the 3rd piece
"RTN","PSIVORC",42,0)
 S X=$$CODES^PSIVUTL(TYP,"^^"_PSJD5314("POINTER"),"")
"RTN","PSIVORC",43,0)
 S PSIV=$S(X]"":X,1:"UNKNOWN"),X="",$P(X,"-",40-($L(PSIV)/2))="" W !,X_PSIV_X
"RTN","PSIVORC",44,0)
 Q
"RTN","PSIVORC",45,0)
 ;
"RTN","PSIVORC",46,0)
ASK ; Ask which orders to view.
"RTN","PSIVORC",47,0)
 S PSIVHD=0,ACTION="ORDER" D RD1^PSGON I X="^" S (DONE,DONE1)=1 Q
"RTN","PSIVORC",48,0)
 Q:'$D(PSGODDD)  S DONE1=0 F PN=1:1:$L(PSGODDD(1),",")-1 S ON=+$P(PSGODDD(1),",",PN) Q:ON=""!DONE1  S ON=+$P(PSGODDD(1),",",PN) D SHOW
"RTN","PSIVORC",49,0)
 S DONE1=1,PSGOP=DFN D:$P(PSJSYSL,U,2)]"" ENQL^PSGLW
"RTN","PSIVORC",50,0)
 Q
"RTN","PSIVORC",51,0)
 ;
"RTN","PSIVORC",52,0)
SHOW ; Display selected order and prompt for action
"RTN","PSIVORC",53,0)
 S (P("PON"),ON)=PSIVCV(ON)
"RTN","PSIVORC",54,0)
 ;
"RTN","PSIVORC",55,0)
SHOW1 ; Entry point from backdoor.
"RTN","PSIVORC",56,0)
 S PSIVUP=+$$GTPCI^PSIVUTL D GT531^PSIVORFA(DFN,ON) I $G(PSIVAC)="PRO" D ENNONUM^PSIVORV2(DFN,ON) Q
"RTN","PSIVORC",57,0)
 I $G(PSJORD)["P" D REQDT^PSJLIVMD(PSJORD)
"RTN","PSIVORC",58,0)
 S PSJORD=+ON D ^PSJLIFN
"RTN","PSIVORC",59,0)
 Q
"RTN","PSIVORC",60,0)
 ;
"RTN","PSIVORC",61,0)
 ; look-ups on ward group, ward, or patient; depending on value of SS
"RTN","PSIVORC",62,0)
G S DIC="^PS(57.5,",DIC(0)="QEAMI",DIC("A")="Select WARD GROUP: " W ! D ^DIC S:+Y>0 WG=+Y Q
"RTN","PSIVORC",63,0)
W S DIC="^DIC(42,",DIC(0)="QEAMI",DIC("A")="Select WARD: " W ! D ^DIC S:+Y>0 WD=+Y Q
"RTN","PSIVORC",64,0)
P D ENGETP^PSIV Q:DFN<0  S Y=1 I $D(^PS(53.1,"AS","P",+DFN)) S PNME=$G(^DPT(+DFN,0)),PNME=$P(PNME,U)_";"_DFN,WDN=$S(VAIN(4)]"":$P(VAIN(4),U,2),1:"OUTPATIENT") D GP
"RTN","PSIVORC",65,0)
 Q
"RTN","PSIVORC",66,0)
 ;
"RTN","PSIVORC",67,0)
GG ; put patient(s) with incomplete orders into array
"RTN","PSIVORC",68,0)
 F WD=0:0 S WD=$O(^PS(57.5,"AC",WG,WD)) Q:'WD  D GW
"RTN","PSIVORC",69,0)
 Q
"RTN","PSIVORC",70,0)
GW S WDN=$G(^DIC(42,WD,0)),WDN=$P(WDN,U) I WDN]"" F DFN=0:0 S DFN=$O(^DPT("CN",WDN,DFN)) Q:'DFN  I $D(^PS(53.1,"AS","P",DFN)) S Y=$G(^DPT(+DFN,0)),PNME=$P(Y,U)_";"_DFN D:PNME]"" GP
"RTN","PSIVORC",71,0)
 Q
"RTN","PSIVORC",72,0)
GP ;
"RTN","PSIVORC",73,0)
 F ON=0:0 S ON=$O(^PS(53.1,"AS","P",DFN,ON)) Q:'ON  S Y=$G(^PS(53.1,ON,0)),TYP=$S($P(Y,U,4)]"":$P(Y,U,4),1:"Z"),^TMP("PSIV",$J,WDN,PNME,TYP,ON)=""
"RTN","PSIVORC",74,0)
 Q
"RTN","PSIVORC",75,0)
DISCONT ; Cancel incomplete order
"RTN","PSIVORC",76,0)
 N PSJDCTYP I $G(ON)["P",$P($G(^PS(53.1,+$G(ON),0)),"^",24)="R" S PSJDCTYP=$$PNDRNA^PSGOEC(ON) I $G(PSJDCTYP)'=1 D PNDRN(PSJDCTYP) Q
"RTN","PSIVORC",77,0)
D2 ; Called from PNDRN for pending order
"RTN","PSIVORC",78,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN I PSJIVORF D NATURE^PSIVOREN I '$D(P("NAT")) W !,$C(7),"Order Unchanged." Q
"RTN","PSIVORC",79,0)
 ;Prompt for requesting provider
"RTN","PSIVORC",80,0)
 W ! I '$$REQPROV^PSGOEC W !,$C(7),"Order Unchanged." K PSJDCTYP Q
"RTN","PSIVORC",81,0)
 W !
"RTN","PSIVORC",82,0)
 ;
"RTN","PSIVORC",83,0)
D3 ; called from PNDRN for original order
"RTN","PSIVORC",84,0)
 I 'PSJCOM N PSJORNAT S PSJORIFN=$P($G(^PS(53.1,+ON,0)),U,21),PSJORD=ON,PSJORNAT=P("NAT") D DC^PSIVORA ;* I PSJIVORF,PSJORIFN,(ON["V") D EN1^PSJHL2(PSGP,"OD",+ON_"V","ORDER DISCONTINUED")
"RTN","PSIVORC",85,0)
 I PSJCOM,PSJORD["P" N O S O="" F  S O=$O(^PS(53.1,"ACX",PSJCOM,O)) Q:O=""  D
"RTN","PSIVORC",86,0)
 .S ON=O_"P",PSJORIFN=$P($G(^PS(53.1,+ON,0)),U,21),PSJORD=ON,PSJORNAT=P("NAT") D DC^PSIVORA
"RTN","PSIVORC",87,0)
 W !,"Order discontinued.",!
"RTN","PSIVORC",88,0)
 Q
"RTN","PSIVORC",89,0)
 ;
"RTN","PSIVORC",90,0)
EDIT ; Edit incomplete order
"RTN","PSIVORC",91,0)
 S PSIVAC="CE" L +^PS(53.1,+ON):1 E  W !,$C(7),"This order LOCKED by another user." Q
"RTN","PSIVORC",92,0)
 D EDIT^PSIVORC2 L -^PS(53.1,+ON)
"RTN","PSIVORC",93,0)
 Q
"RTN","PSIVORC",94,0)
 ;
"RTN","PSIVORC",95,0)
FINISH ; Finish incomplete order
"RTN","PSIVORC",96,0)
 S PSIVAC="CF" L +^PS(53.1,+ON):1 E  W !,$C(7),"This order LOCKED by another user." Q
"RTN","PSIVORC",97,0)
 D FINISH^PSIVORC2 L -^PS(53.1,+ON)
"RTN","PSIVORC",98,0)
 Q
"RTN","PSIVORC",99,0)
 ;
"RTN","PSIVORC",100,0)
PNDRN(PSJDCTYP) ; Discontinue pending renewal only or both pending and original orders
"RTN","PSIVORC",101,0)
 I PSJDCTYP=2 S PSJDCTYP=1 D D2 Q:'$G(PSJDCTYP)  D
"RTN","PSIVORC",102,0)
 .N ND5310 S ND5310=$G(^PS(53.1,+ON,0))
"RTN","PSIVORC",103,0)
 .N ON S ON=$P(ND5310,"^",25) I ON S PSJDCTYP=2 D D3
"RTN","PSIVORC",104,0)
 Q
"RTN","PSIVORC1")
0^22^B43227243
"RTN","PSIVORC1",1,0)
PSIVORC1 ;BIR/MLM-PROCESS INCOMPLETE IV ORDER - CONT ;13 Jan 98 / 11:36 AM
"RTN","PSIVORC1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,37,69,110,157,134**;16 DEC 97;Build 124
"RTN","PSIVORC1",3,0)
 ;
"RTN","PSIVORC1",4,0)
 ; Reference to ^DD("DD" is supported by DBIA 10017.
"RTN","PSIVORC1",5,0)
 ; Reference to ^DD( is supported by DBIA 2255.
"RTN","PSIVORC1",6,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSIVORC1",7,0)
 ; Reference to ^%DT is supported by DBIA 10003.
"RTN","PSIVORC1",8,0)
 ; Reference to ^%DTC is supported by DBIA 10000.
"RTN","PSIVORC1",9,0)
 ; Reference to ^DID is supported by DBIA 2052.
"RTN","PSIVORC1",10,0)
 ; Reference to ^VALM is supported by DBIA 10118.
"RTN","PSIVORC1",11,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSIVORC1",12,0)
 ;
"RTN","PSIVORC1",13,0)
53 ; IV Type
"RTN","PSIVORC1",14,0)
 I $G(PSGORD)["P",$G(PSGAT),($G(P(9))]"") D
"RTN","PSIVORC1",15,0)
 .N X,PSGS0Y,ZZ,LYN,ZZND,ZZNDW S X=P(9) S PSGS0Y="",ZZ=0 D FIND^DIC(51.1,,,,X,,"APPSJ",,,"LYN")
"RTN","PSIVORC1",16,0)
 .S ZZ=$O(LYN("DILIST",2,ZZ)) I ZZ S ZZ=+LYN("DILIST",2,ZZ) I ZZ S ZZND=$G(^PS(51.1,ZZ,0)) S PSGST=$P(ZZND,U,5),PSGS0XT=$P(ZZND,U,3) I $G(PSJPWD) D
"RTN","PSIVORC1",17,0)
 ..N ZZNDW S ZZNDW=$G(^PS(51.1,ZZ,1,PSJPWD,0)) I $P(ZZNDW,"^",2)]"" S PSGS0Y=$P(ZZNDW,"^",2),$P(ZZND,"^",2)=PSGS0Y
"RTN","PSIVORC1",18,0)
 .S ZZ=0 F  S ZZ=$O(LYN("DILIST",1,ZZ)) Q:'ZZ  I $G(LYN("DILIST",1,ZZ))'=X K LYN("DILIST",1,ZZ),LYN("DILIST",2,ZZ),LYN("DILIST","ID",ZZ,1)
"RTN","PSIVORC1",19,0)
 .I $D(PSJPWD) S ZZ=0 F  S ZZ=$O(LYN("DILIST",2,ZZ)) Q:'ZZ  I $P($G(^PS(51.1,+LYN("DILIST",2,ZZ),1,+PSJPWD,0)),U,2)]"" S PSGS0Y=$P($G(^(0)),U,2)
"RTN","PSIVORC1",20,0)
 .I '$G(PSGS0Y) S ZZ=0 F  S ZZ=$O(LYN("DILIST",2,ZZ)) Q:'ZZ  Q:PSGS0Y]""  I $G(LYN("DILIST","ID",ZZ,1))]"" S PSGS0Y=$G(LYN("DILIST","ID",ZZ,1))
"RTN","PSIVORC1",21,0)
 .Q:(PSGS0Y=PSGAT)!'$G(PSGS0Y)!($G(IVCAT)="C")
"RTN","PSIVORC1",22,0)
 .S PSGNSTAT=1 W $C(7),!!,"PLEASE NOTE:  This order's admin times (",PSGAT,")"
"RTN","PSIVORC1",23,0)
 .W !?13," do not match the ward times (",PSGS0Y,")"
"RTN","PSIVORC1",24,0)
 .W !?13," for this administration schedule (",P(9),")",!
"RTN","PSIVORC1",25,0)
 .S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR K DIR  W !
"RTN","PSIVORC1",26,0)
 S DONE=0 N DIR S DIR(0)="SNA^A:ADMIXTURE;C:CHEMOTHERAPY;H:HYPERAL;P:PIGGYBACK;S:SYRINGE",DIR("A")="IV TYPE: "
"RTN","PSIVORC1",27,0)
 I $G(P("RES"))'="R",$G(PSGORD)["P" N IVCAT,IVTYPTMP S IVCAT=$P($G(^PS(53.1,+PSGORD,2.5)),"^",5) S IVTYPTMP=$S((P(9)]""):"P",$G(P(5)):"P",$G(P(23))="P":"P",1:"")
"RTN","PSIVORC1",28,0)
 S DIR("B")=$S($G(IVCAT)="C"!($G(IVTYPTMP)="A"):"ADMIXTURE",$G(IVCAT)="I"!($G(IVTYPTMP)="P"):"PIGGYBACK",1:"ADMIXTURE")
"RTN","PSIVORC1",29,0)
 D DIRQ,^DIR S:$D(DTOUT)!(X="^") DONE=1 Q:DONE  G:$E(X)="^" 53 S P(4)=Y D:"CS"[P(4) @P(4)
"RTN","PSIVORC1",30,0)
 I PSIVAC'="PN" D ENT^PSIVCAL K %DT S X=P(2),%DT="RTX" D ^%DT S P(2)=+Y D ENSTOP^PSIVCAL K %DT S X=P(3),%DT="RTX" D ^%DT S P(3)=+Y
"RTN","PSIVORC1",31,0)
OTYP ; Get order type, display type.
"RTN","PSIVORC1",32,0)
 S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3) S:PSIVAC'="CF" P("OT")=$S(P(4)="A":"F",P(4)="H":"H",1:"I")
"RTN","PSIVORC1",33,0)
 Q
"RTN","PSIVORC1",34,0)
 ;
"RTN","PSIVORC1",35,0)
C ; Edit Chemo order
"RTN","PSIVORC1",36,0)
 N DIR S DIR(0)="SA^A:ADMIXTURE;P:PIGGYBACK;S:SYRINGE",DIR("A")="CHEMOTHERAPY TYPE: " D DIRQ,^DIR S:$D(DTOUT)!(X=U) DONE=1 Q:$E(X)="^"!(DONE)  S P(23)=Y D:P(23)["S" S
"RTN","PSIVORC1",37,0)
 Q
"RTN","PSIVORC1",38,0)
 ;
"RTN","PSIVORC1",39,0)
S ; Edit Syringe order
"RTN","PSIVORC1",40,0)
56 ; Intermittent Syringe
"RTN","PSIVORC1",41,0)
 N DIR S DIR(0)="Y",DIR("??")="^S F1=53.1,F2=56 D ENHLP^PSIVORC1",DIR("A")="INTERMITTENT SYRINGE" D ^DIR Q:$D(DIRUT)  S P(5)=Y
"RTN","PSIVORC1",42,0)
 ;
"RTN","PSIVORC1",43,0)
55 ; Syringe Size
"RTN","PSIVORC1",44,0)
 N DA,DIR S DIR(0)="53.1,55" D ^DIR I $D(DTOUT)!$D(DUOUT) S DONE=1 Q
"RTN","PSIVORC1",45,0)
 S P("SYRS")=Y
"RTN","PSIVORC1",46,0)
 Q
"RTN","PSIVORC1",47,0)
 ;
"RTN","PSIVORC1",48,0)
DIRQ ; Set DIR("?") for IV Type prompt.
"RTN","PSIVORC1",49,0)
 S DIR("?")="Enter a code from the list above.",DIR("??")="^S F1=55.01,F2="_$S(DIR("A")["CHEMO":106,1:.04)_" D ENHLP^PSIVORC1"
"RTN","PSIVORC1",50,0)
 S DIR("?",1)="CHOOSE FROM:",Y=$P(DIR(0),U,2) F X=1:1:5 S DIR("?",X+1)="              "_$P($P(Y,";",X),":")_"    "_$P($P(Y,";",X),":",2)
"RTN","PSIVORC1",51,0)
 Q
"RTN","PSIVORC1",52,0)
 ;
"RTN","PSIVORC1",53,0)
CKFLDS ; Find required fields missing data.
"RTN","PSIVORC1",54,0)
 NEW PSIVASX,PSIVASY,FIL,DRGTMP
"RTN","PSIVORC1",55,0)
 S EDIT="" F PSIVASX="AD","SOL" D
"RTN","PSIVORC1",56,0)
 .I '$D(DRG(PSIVASX)) S EDIT=EDIT_U_$S(PSIVASX="AD":57,1:58) Q
"RTN","PSIVORC1",57,0)
 .S DNE=0 F PSIVASY=0:0 S PSIVASY=$O(DRG(PSIVASX,PSIVASY)) Q:'PSIVASY!DNE  D
"RTN","PSIVORC1",58,0)
 .. I $P(DRG(PSIVASX,PSIVASY),U,3)="" S EDIT=EDIT_U_$S(PSIVASX="AD":57,1:58),DNE=1
"RTN","PSIVORC1",59,0)
 S:'P("MR") EDIT=EDIT_U_3 F X=8,6,2,3 I P(X)="" S EDIT=EDIT_U_$S(X=8:59,X=6:1,X=2:10,X=3:25,1:"")
"RTN","PSIVORC1",60,0)
 I P("DTYP")=1 S:P(9)="" EDIT=EDIT_U_26 S:P(11)="" EDIT=EDIT_U_39
"RTN","PSIVORC1",61,0)
 S:$E(EDIT,1)=U EDIT=$E(EDIT,2,999)
"RTN","PSIVORC1",62,0)
 Q
"RTN","PSIVORC1",63,0)
 ;
"RTN","PSIVORC1",64,0)
DONE ; Kill variables and exit
"RTN","PSIVORC1",65,0)
 K ACTION,AD,DFN,DNE,DONE,DONE1,DRG,DRGI,DRGN,DRGT,DRGTN,EDIT,ERR,F1,F2,FIL,HDT,J,LN,LN2,ND,ON,ON1,ON55,ORIFN,P,P16,PC,PDM,PG,PN,PNME,PNOW,PSGLMT,PSGODDD
"RTN","PSIVORC1",66,0)
 K PSGSS,PSGSSH,PSIV,PSIVAC,PSIVAT,PSIVCV,PSIVE,PSIVHD,PSIVLN,PSIVOK,PSIVOLD,PSIVORUT,PSIVREA,PSIVSC1,PSIVSTR,PSIVSTRT,PSIVTYPE,PSIVUP,PSIVX,PSIVX1
"RTN","PSIVORC1",67,0)
 K PSJIVORF,PSJORF,PSJORIFN,PSJORL,PSJORNP,PSJORPF,PSJORSTS,PSJIVOF,PSJNKF,PSJORD,RB,RF,SOL,STOP,TYP,UL80,WD,WDN,WG,^TMP("PSIV",$J) D ENIVKV^PSGSETU
"RTN","PSIVORC1",68,0)
 Q
"RTN","PSIVORC1",69,0)
ENHLP ; order entry fields' help
"RTN","PSIVORC1",70,0)
 N PSJHP,PSJX,PSJD
"RTN","PSIVORC1",71,0)
 ; From within this routine, F1 and F2 will refer to file 53.1,field 56, file 55.01,field 106, or file 55.01,field .04
"RTN","PSIVORC1",72,0)
 D FIELD^DID(F1,F2,"","HELP-PROMPT","PSJHP")
"RTN","PSIVORC1",73,0)
 I X="?",$D(PSJHP("HELP-PROMPT")) S F=$G(PSJHP("HELP-PROMPT")) W !?5 F F0=1:1:$L(F," ") S F3=$P(F," ",F0) W:$L(F3)+$X>78 !?5 W F3_" "
"RTN","PSIVORC1",74,0)
 ;
"RTN","PSIVORC1",75,0)
 W:$D(^DD(F1,F2,12)) !,"("_^(12)_")" D FIELD^DID(F1,F2,"","XECUTABLE HELP","PSJX") I $D(PSJX("XECUTABLE HELP")) X PSJX("XECUTABLE HELP")
"RTN","PSIVORC1",76,0)
 ;
"RTN","PSIVORC1",77,0)
 ; new code
"RTN","PSIVORC1",78,0)
 D FIELD^DID(F1,F2,"","DESCRIPTION","PSJD")
"RTN","PSIVORC1",79,0)
 G:$S($G(X)="?":1,1:'$O(PSJD("DESCRIPTION",0))) SC F F=0:0 S F=$O(PSJD("DESCRIPTION",F)) Q:'F  I $D(PSJD("DESCRIPTION",F)) W !?2,PSJD("DESCRIPTION",F)
"RTN","PSIVORC1",80,0)
SC ;
"RTN","PSIVORC1",81,0)
 I F2=5!(F2=6) W !,"CHOOSE FROM:",!?8,0,?16,"NO",!?8,1,?16,"YES" Q
"RTN","PSIVORC1",82,0)
 Q
"RTN","PSIVORC1",83,0)
COMPLTE ;
"RTN","PSIVORC1",84,0)
 S P16=0,PSIVEXAM=1,(PSIVNOL,PSIVCT)=1 D GTOT^PSIVUTL(P(4)) D ^PSIVCHK I $D(DUOUT) W $C(7),!,"Order Unchanged.",! Q
"RTN","PSIVORC1",85,0)
 G:'$D(PSIVFN1) EDIT1
"RTN","PSIVORC1",86,0)
 I ERR=1 S Y=0 G EDIT1
"RTN","PSIVORC1",87,0)
 D CKORD^PSIVORC2 I PSIVCHG D NOW^%DTC S P("LOG")=$E(%,1,12),P("CLRK")=DUZ_U_$P($G(^VA(200,DUZ,0)),U),P("INS")=""
"RTN","PSIVORC1",88,0)
 W ! D ^PSIVORLB K PSIVEXAM S Y=P(2)
"RTN","PSIVORC1",89,0)
 W !,"Start date: " X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),?30," Stop date: " S Y=P(3) X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),!
"RTN","PSIVORC1",90,0)
EDIT ;
"RTN","PSIVORC1",91,0)
 I ERR=1 W !,"Please re-edit this order" K DIR S DIR(0)="E" D ^DIR K DIR W:'Y $C(7),"order unchanged." Q:'Y  S Y=0 G EDIT1
"RTN","PSIVORC1",92,0)
 ;PSJ*5*157 EFD FOR IV
"RTN","PSIVORC1",93,0)
 D EFDIV^PSJUTL($G(ZZND))
"RTN","PSIVORC1",94,0)
 W:$G(PSIVCHG) !,"*** This change will cause a new order to be created. ***"
"RTN","PSIVORC1",95,0)
 K DIR S DIR(0)="Y",DIR("A")="Is this O.K.",DIR("B")=$S(ERR:"NO",1:"YES"),DIR("?",1)="Enter ""Y"" to make this an active order (only allowed if no errors were"
"RTN","PSIVORC1",96,0)
 S DIR("?")="found in order), ""N"" to edit the order, or ""^"" to leave order unchanged.",DIR("??")="^S HELP=""EDIT"" D ^PSIVHLP"
"RTN","PSIVORC1",97,0)
 D ^DIR K DIR I $D(DIRUT) K DIRUT W $C(7),"Order unchanged." Q
"RTN","PSIVORC1",98,0)
 ;*  Kill Unit dose variables when calling from ^PSJLIFNI.
"RTN","PSIVORC1",99,0)
 I +Y,$G(PSJLIFNI) D
"RTN","PSIVORC1",100,0)
 . K ND,ND4,ND6,NDP2
"RTN","PSIVORC1",101,0)
 . K PSGAT,PSGCANFL,PSGDI,PSGDO,PSGDT,PSGEB,PSGEBN,PSGEFN,PSGFD,PSGFDN
"RTN","PSIVORC1",102,0)
 . K PSGHSM,PSGLI,PSGLIN,PSGLMT,PSGMR,PSGMRN,PSGNEDFD,PSGNEF,PSGNEFD
"RTN","PSIVORC1",103,0)
 . K PSGNESD,PSGOAT,PSGODO,PSGODT,PSGEA,PSGOEAV,PSGOEEF
"RTN","PSIVORC1",104,0)
 . K PSGOEEWF,PSGOEEG,PSGOEF,PSGOENG,PSGOES,PSGOFD,PSGOFDN,PSGOHSM
"RTN","PSIVORC1",105,0)
 . K PSGOINST,PSGOMR,PSGOMRN,PSGONC
"RTN","PSIVORC1",106,0)
 . K PSGOPD,PSOPDN,PSGOPR,PSGOPRN,PSGOSD,PSGOSDN,PSGOSI,PSGOSM
"RTN","PSIVORC1",107,0)
 . K PSGOST,PSGOSTN
"RTN","PSIVORC1",108,0)
 . K PSGPD,PSGPDN,PSGPDRG,PSGDRGN,PSGPFLG,PSGPI,PSGPR,PSGPRIO,PSGPRN
"RTN","PSIVORC1",109,0)
 . K PSGPTMP,PSGRRF,PSG0XT,PSGS0Y,PSGSCH,PSGSD,PSGSDN,PSGSI,PSGSM
"RTN","PSIVORC1",110,0)
 . K PSGST,PSGSTAT,PSGSTN,PSJACNWP,PSJACOK,PSJCOI
"RTN","PSIVORC1",111,0)
EDIT1 ;
"RTN","PSIVORC1",112,0)
 NEW XFLG,PSIVY S PSIVY=Y
"RTN","PSIVORC1",113,0)
 NEW X S X=^TMP("PSJI",$J,0),VALMBG=$S((X<17):1,1:(X-(X#16)))
"RTN","PSIVORC1",114,0)
 I PSIVY=0!'$G(PSIVFN1) S PSIVFN1=1 D EN^VALM("PSJ LM IV AC/EDIT") Q
"RTN","PSIVORC1",115,0)
 S PSIVCHG=0 D EDCHK^PSIVORC2 K PSIVCHG
"RTN","PSIVORC1",116,0)
 S VALMBCK="Q",PSIVACEP=1
"RTN","PSIVORC1",117,0)
 Q
"RTN","PSIVOREN")
0^20^B27138020
"RTN","PSIVOREN",1,0)
PSIVOREN ;BIR/MLM-UTILITIES FOR IV FLUIDS - OE/RR INTERFACE ; 25 Sep 98 / 2:00 PM
"RTN","PSIVOREN",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,18,69,110,127,133,140,134**;16 DEC 97;Build 124
"RTN","PSIVOREN",3,0)
 ;
"RTN","PSIVOREN",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVOREN",5,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSIVOREN",6,0)
 ; Reference to ^DIE is supported by DBIA 10018.
"RTN","PSIVOREN",7,0)
 ;
"RTN","PSIVOREN",8,0)
ENCPP ; Check Package Parameter
"RTN","PSIVOREN",9,0)
 D ORPARM I 'PSJORF W !!,"Inpatient Medications is not turned on for OE/RR.",!,"You will not be able to enter or edit IV or Unit Dose orders."
"RTN","PSIVOREN",10,0)
 I 'PSJIVORF W !!,"IV Medications is not turned on for OE/RR.",!,"You will not be able to enter or edit IV orders."
"RTN","PSIVOREN",11,0)
 I 'PSJORF!'PSJIVORF S PSJIVORF="" D DONE^PSIVORA1 Q
"RTN","PSIVOREN",12,0)
 S PSJORL=$G(VAIN(4)) I 'PSJORL,$G(DFN) D INP^VADPT S PSJORL=$G(VAIN(4))
"RTN","PSIVOREN",13,0)
 S PSJORPF=0,P("OT")="F^",PSJORNP=$S($G(PSJORNP):PSJORNP,1:+$G(DUZ))
"RTN","PSIVOREN",14,0)
 Q
"RTN","PSIVOREN",15,0)
 ;
"RTN","PSIVOREN",16,0)
PS ; Check if MD is authorized to write med. orders.
"RTN","PSIVOREN",17,0)
 S PSJORPF=0 S:PSJORNP X=$G(^VA(200,+PSJORNP,"PS")) Q:$S('PSJORNP:0,'X:0,'$P(X,U,4):1,$P(X,U,4)>DT:1,1:0)  D
"RTN","PSIVOREN",18,0)
 .W !?2,"(The selected PROVIDER is NOT qualified to write MEDICATION orders.  You must",!,"select a valid provider to be able to continue with Inpatient Medications.)"
"RTN","PSIVOREN",19,0)
 .K DIC S DIC="^VA(200,",DIC(0)="AEMQZ",DIC("A")="Select PHARMACY PROVIDER: ",DIC("S")="S PSIV=$G(^(""PS"")) I PSIV,$S($P(PSIV,""^"",4)="""":1,DT<$P(PSIV,""^"",4):1,1:0)" F  W ! D ^DIC Q:$D(DUOUT)!$D(DTOUT)!(Y>0)  W $C(7),"  (Required.)"
"RTN","PSIVOREN",20,0)
 .K DIC S:Y'>0 PSJORPF=11 S:Y>0 PSJORNP=+Y Q
"RTN","PSIVOREN",21,0)
 K DTOUT
"RTN","PSIVOREN",22,0)
 Q
"RTN","PSIVOREN",23,0)
 ;
"RTN","PSIVOREN",24,0)
RUPDATE(DFN,ON,NSTRT) ;
"RTN","PSIVOREN",25,0)
 ; Update renewal orders (called from Pharmacy options).
"RTN","PSIVOREN",26,0)
 N DA,DIE,DR,ND,NSTOP,OSTOP,NOO,ORETURN,PSIVACT,PSIVAL,PSIVALCK,PSJOSTRT,PSGOLDOE S DIE="^PS(55,"_DFN_","
"RTN","PSIVOREN",27,0)
 I ON["P" S OLDON=$P($G(^PS(53.1,+ON,0)),"^",25),NOO=$P($G(^PS(53.1,+ON,.2)),"^",3)
"RTN","PSIVOREN",28,0)
 I ON["V" S OLDON=ON,NOO=$P($G(^PS(55,DFN,"IV",+ON,.2)),"^",5)
"RTN","PSIVOREN",29,0)
 I ON["U" S OLDON=$P($G(^PS(55,DFN,5,+ON,0)),U,25)
"RTN","PSIVOREN",30,0)
 I OLDON["P" S OLDON=$P($G(^PS(53.1,+OLDON,0)),U,25)
"RTN","PSIVOREN",31,0)
 I OLDON["V" S ON55=OLDON,X=$G(^PS(55,DFN,"IV",+OLDON,2)),PSJOSTRT=$P(X,U,7),OSTOP=$S(($G(PSJOSTOP)>PSJOSTRT):PSJOSTOP,1:$P($G(^(0)),U,3)),DIE=DIE_"""IV"",",DR="100////A",PSIVACT=1
"RTN","PSIVOREN",32,0)
 I OLDON["U" S X=$G(^PS(55,DFN,5,+OLDON,2)),PSJOSTRT=$P(X,U,7),OSTOP=$P(X,U,4),DIE=DIE_"5,"
"RTN","PSIVOREN",33,0)
 S NSTOP=+$S($G(P(3)):P(3),1:0),DA=+OLDON,DA(1)=DFN I 'NSTOP W !,"CAN'T RENEW THIS ORDER!" D PAUSE^VALM1 Q
"RTN","PSIVOREN",34,0)
 ;
"RTN","PSIVOREN",35,0)
 I ON["V"!(ON["P") D EXPOE^PSGOER(DFN,ON)
"RTN","PSIVOREN",36,0)
 ;
"RTN","PSIVOREN",37,0)
 S DR=DR_";"_$S(OLDON["V":.03,OLDON["U":34,1:25)_"////"_NSTOP_";"_$S(OLDON["V":"114////@;123////@",1:"105////@;107////@") S:+$G(P(6))?1.30N DR=DR_";.06////"_+P(6) D ^DIE
"RTN","PSIVOREN",38,0)
 I ON["P" S DIE="^PS(53.1,",DR="28////A;105////@;",DA=+ON D ^DIE D
"RTN","PSIVOREN",39,0)
 .I $G(OLDON)["V" S PSGOLDOE=$P($G(^PS(55,DFN,"IV",+OLDON,0)),"^",21)
"RTN","PSIVOREN",40,0)
 .N NOEORD,VN,VNDT S NOEORD=$P(^PS(53.1,+ON,0),U,21) S VN=$P($G(^PS(53.1,+ON,4)),"^") I VN S VNDT=$P($G(^PS(53.1,+ON,4)),"^",2)
"RTN","PSIVOREN",41,0)
 .I NOEORD K DA,DR,DIE S DIE="^PS(55,"_DFN_",""IV"",",DA(1)=DFN,DA=+ON55,DR="110////"_+NOEORD D
"RTN","PSIVOREN",42,0)
 ..S DR=DR_";16////"_$S($G(VN):VN,1:"@")_";17////"_$S($G(VNDT):VNDT,1:"@")_";" D ^DIE I NOEORD[";" S $P(^PS(53.1,+ON,0),U,21)=NOEORD
"RTN","PSIVOREN",43,0)
 ..I $G(VN) D EN1^PSJHL2(DFN,"ZV",ON55)
"RTN","PSIVOREN",44,0)
 I ON["V" S DIE="^PS(55,DFN,""IV"",",DR="100////A;114////@;16////@;17////@" S DA=+ON55 D ^DIE
"RTN","PSIVOREN",45,0)
 N RDT S RDT=$P($G(@("^PS(53.1,"_+ON_",14,0)")),U,3) S:RDT RDT=+(^(RDT,0)) S RDT=$S(RDT:RDT,1:$$DATE^PSJUTL2) I RDT D UPDREN^PSIVOPT2(DFN,OLDON,RDT,+P(6),+$G(OSTOP),$G(NOO))
"RTN","PSIVOREN",46,0)
 ;
"RTN","PSIVOREN",47,0)
 I ON["V" D EN1^PSJHL2(DFN,"SN",ON,"NEW ORDER CREATED")
"RTN","PSIVOREN",48,0)
 I OLDON["V" S (ON,ON55)=OLDON,PSIVAL="",PSIVALCK="STOP",(P("FRES"),PSIVREA)="R" D LOG^PSIVORAL D
"RTN","PSIVOREN",49,0)
 .I $G(ON55),$G(OSTOP),$G(DFN) D STIX(OSTOP,OLDON,DFN)
"RTN","PSIVOREN",50,0)
 .;Add check to If statement below. If New Stop date ='s the old Stop Don't delete AIV x-ref (NSTOP'=PSJOSTOP)
"RTN","PSIVOREN",51,0)
 .I $G(PSJOSTOP),$G(NSTOP) I NSTOP=$P($G(^PS(55,DFN,"IV",+ON55,0)),"^",3),$D(^PS(55,"AIV",NSTOP,DFN,+ON55)),NSTOP'=PSJOSTOP K ^PS(55,"AIV",PSJOSTOP,DFN,+ON55)
"RTN","PSIVOREN",52,0)
 D:'$D(PSJIVORF) ORPARM Q:'PSJIVORF
"RTN","PSIVOREN",53,0)
 Q
"RTN","PSIVOREN",54,0)
 ;
"RTN","PSIVOREN",55,0)
RUPTXT(DFN,OLDON) ;
"RTN","PSIVOREN",56,0)
 ;Update ORTX( in OE/RR
"RTN","PSIVOREN",57,0)
 I OLDON'["V" ;; D ENUDTX^PSJOREN(DFN,OLDON,"OR") S ORIFN=$P($G(^PS(55,DFN,"IV",+OLDON,0)),U,21)
"RTN","PSIVOREN",58,0)
 I OLDON["V" S P("FRES")="R" D GTPC^PSIVORFB(OLDON),SORTX^PSIVORFE S ORIFN=$P($G(^PS(55,DFN,"IV",+OLDON,0)),U,21)
"RTN","PSIVOREN",59,0)
 Q
"RTN","PSIVOREN",60,0)
 ;
"RTN","PSIVOREN",61,0)
ORPARM ;Check if inpatient pkges are on.
"RTN","PSIVOREN",62,0)
 S (PSJORF,PSJIVORF)=1
"RTN","PSIVOREN",63,0)
 Q
"RTN","PSIVOREN",64,0)
 ;
"RTN","PSIVOREN",65,0)
NATURE ; Ask nature of order.
"RTN","PSIVOREN",66,0)
 Q:$G(PSJDCTYP)=2
"RTN","PSIVOREN",67,0)
 I '+$G(PSJSYSU) S P("NAT")="W" Q
"RTN","PSIVOREN",68,0)
 K P("NAT") NEW X
"RTN","PSIVOREN",69,0)
 I $D(XQORNOD(0)) S X=$E($P(XQORNOD(0),U,3),1,1) S:X="" X="E"
"RTN","PSIVOREN",70,0)
 S:'$D(X) X="N" S:"AF"[X X="E"
"RTN","PSIVOREN",71,0)
 I $G(PSIVCOPY) S X="N"
"RTN","PSIVOREN",72,0)
 S P("NAT")=$$ENNOO^PSJUTL5(X)
"RTN","PSIVOREN",73,0)
 K:P("NAT")=-1 P("NAT")
"RTN","PSIVOREN",74,0)
 Q
"RTN","PSIVOREN",75,0)
CLINIC ;Ask clinic where outpt is being seen for DSS
"RTN","PSIVOREN",76,0)
 K P("CLIN") NEW X1,X2,X,PSJDT,DIC,Y
"RTN","PSIVOREN",77,0)
 S X1=DT,X2=-7 D C^%DTC S PSJDT=X
"RTN","PSIVOREN",78,0)
 S DIC("S")="I $P($G(^SC(Y,0)),U,3)=""C"",$S('$P($G(^(""I"")),U):1,($P($G(^(""I"")),U)>PSJDT):1,(($P($G(^(""I"")),U)<PSJDT)&($P($G(^(""I"")),U,2)]"""")&(DT>$P($G(^(""I"")),U,2))):1,1:0)"
"RTN","PSIVOREN",79,0)
 S DIC=44,DIC(0)="QEAZ",DIC("A")="Select CLINIC LOCATION: " D ^DIC
"RTN","PSIVOREN",80,0)
 I $S($D(DTOUT):1,$D(DUOUT):1,1:0) Q
"RTN","PSIVOREN",81,0)
 S:+Y>0 P("CLIN")=+Y,$P(^PS(55,DFN,"IV",+ON55,"DSS"),"^")=+Y
"RTN","PSIVOREN",82,0)
 Q
"RTN","PSIVOREN",83,0)
 ;
"RTN","PSIVOREN",84,0)
STIX(OST,OON,DFN) ; Check start index, cleanup old start
"RTN","PSIVOREN",85,0)
 I $G(OST),$G(OON) S OS="" F  S OS=$O(^PS(55,DFN,"IV","AIS",OS)) Q:'OS  D
"RTN","PSIVOREN",86,0)
 . Q:'$D(^PS(55,DFN,"IV","AIS",OS,+OON))
"RTN","PSIVOREN",87,0)
 . I $P($G(^PS(55,DFN,"IV",+OON,0)),"^",3)'=OS K ^PS(55,DFN,"IV","AIS",OS,+OON)
"RTN","PSIVOREN",88,0)
 Q
"RTN","PSIVORFA")
0^13^B24701688
"RTN","PSIVORFA",1,0)
PSIVORFA ;BIR/MLM-FILE/RETRIEVE ORDERS IN 53.1 ;26 Jun 98 / 9:16 AM
"RTN","PSIVORFA",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**4,7,18,28,50,71,58,91,80,110,111,134**;16 DEC 97;Build 124
"RTN","PSIVORFA",3,0)
 ;
"RTN","PSIVORFA",4,0)
 ; Reference to ^PS(51.1 supported by DBIA 2177.
"RTN","PSIVORFA",5,0)
 ; Reference to ^PS(51.2 supported by DBIA 2178.
"RTN","PSIVORFA",6,0)
 ; Reference to ^PS(52.7 supported by DBIA 2173.
"RTN","PSIVORFA",7,0)
 ; Reference to ^PS(52.6 supported by DBIA 1231.
"RTN","PSIVORFA",8,0)
 ;
"RTN","PSIVORFA",9,0)
GT531(DFN,ON) ; Retrieve order data from 53.1 and place into local array
"RTN","PSIVORFA",10,0)
 ;
"RTN","PSIVORFA",11,0)
 NEW PSGOES S PSGOES=1
"RTN","PSIVORFA",12,0)
 F X="CUM","LF","LFA","LF","PRNTON" S P(X)=""
"RTN","PSIVORFA",13,0)
 S Y=$G(^PS(53.1,+ON,0)),P(17)=$P(Y,U,9),P("LOG")=$P(Y,U,16),(P(21),P("21FLG"),PSJORIFN)=$P(Y,U,21)
"RTN","PSIVORFA",14,0)
 S P("RES")=$P(Y,U,24),P("OLDON")=$P(Y,U,25),P("NEWON")=$P(Y,U,26),P("FRES")=$P(Y,U,27)
"RTN","PSIVORFA",15,0)
 S P("MR")=$P(Y,U,3),P(6)=+$P(Y,U,2),Y=$G(^VA(200,+P(6),0)),$P(P(6),U,2)=$P(Y,U),Y=$G(^PS(51.2,+P("MR"),0)),$P(P("MR"),U,2)=$S($P(Y,U,3)]"":$P(Y,U,3),1:$P(Y,U))
"RTN","PSIVORFA",16,0)
 S Y=$G(^PS(53.1,+ON,.2)),P("PD")=$S(+Y:$P(Y,U)_U_$$OIDF^PSJLMUT1(+Y),1:""),P("DO")=$P(Y,U,2),P("NAT")=$P(Y,U,3),P("PRY")=$P(Y,U,4),(PSJCOM,P("PRNTON"))=$P(Y,U,8)
"RTN","PSIVORFA",17,0)
 S P("INS")=$G(^PS(53.1,+ON,.3))
"RTN","PSIVORFA",18,0)
 I $G(^PS(53.1,+ON,4))]"" S P("NINIT")=$P(^(4),U),P("NINITDT")=$P(^(4),U,2)
"RTN","PSIVORFA",19,0)
 NEW NAME S NAME=""
"RTN","PSIVORFA",20,0)
 I $D(^PS(53.1,+ON,1,1)) D DD^PSJLMUT1("^PS(53.1,+ON,",.NAME)
"RTN","PSIVORFA",21,0)
 S P("INS")=P("INS")_$S(P("INS")]"":" of ",1:"")_NAME
"RTN","PSIVORFA",22,0)
 S P("APPT")=$G(^PS(53.1,+ON,"DSS")),P("CLIN")=$P(P("APPT"),"^"),P("APPT")=$P(P("APPT"),"^",2)
"RTN","PSIVORFA",23,0)
 S Y=$G(^PS(53.1,+ON,2)),P(9)=$P(Y,U),P(11)=$P(Y,U,5),P(15)=$S($P(Y,U,6)'="":$P(Y,U,6),$G(PSGS0XT)'="":PSGS0XT,$P($G(ZZND),"^",3)'="":$P(ZZND,"^",3),1:""),P(2)=$P(Y,U,2),P(3)=$P(Y,U,4)
"RTN","PSIVORFA",24,0)
 S Y=$G(^PS(53.1,+ON,4)),P("CLRK")=$P(Y,U,7)_U_$P($G(^VA(200,+$P(Y,U,7),0)),U),P("REN")=$P(Y,U,9),X=P(9)
"RTN","PSIVORFA",25,0)
 I $P($G(^PS(53.1,+ON,0)),U,7)="P",(P(9)'["PRN") S P(9)=P(9)_" PRN"
"RTN","PSIVORFA",26,0)
 K PSGST,XT
"RTN","PSIVORFA",27,0)
 I P(9)]"",(P(11)="") D  S P(15)=$S($G(XT)]""&'+$G(XT):XT,+$G(XT)>0:XT,$G(PSGS0XT):PSGS0XT,1:1440),P(11)=Y
"RTN","PSIVORFA",28,0)
 . I $O(^PS(51.1,"APPSJ",P(9),0)) D DIC^PSGORS0 Q
"RTN","PSIVORFA",29,0)
 . I '$O(^PS(51.1,"APPSJ",P(9),0)) N NOECH,PSGSCH S NOECH=1 D EN^PSIVSP
"RTN","PSIVORFA",30,0)
 S Y=$G(^PS(53.1,+ON,8)),P(4)=$P(Y,U),P(23)=$P(Y,U,2),P("SYRS")=$P(Y,U,3),P(5)=$P(Y,U,4),P(8)=$P(Y,U,5),P(7)=$P(Y,U,7),P("IVRM")=$P(Y,U,8)
"RTN","PSIVORFA",31,0)
 S P(4)=$S(P(4)'="":P(4),$G(PSIVTYPE):PSIVTYPE,1:"")
"RTN","PSIVORFA",32,0)
 S:'P("IVRM")&($D(PSIVSN)) P("IVRM")=+PSIVSN S Y=$G(^PS(59.5,+P("IVRM"),0)),$P(P("IVRM"),U,2)=$P(Y,U),Y=$G(^PS(53.1,+ON,9)),P("REM")=$P(Y,U),P("OPI")=$P(Y,U,2,3)
"RTN","PSIVORFA",33,0)
 S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSIVORFA",34,0)
 S P("PACT")=$G(^PS(53.1,+ON,"A",1,0))
"RTN","PSIVORFA",35,0)
 D GTDRG,GTOT^PSIVUTL(P(4)) D:'$D(PSJLABEL) GTPC(ON)
"RTN","PSIVORFA",36,0)
 N ND2P5 S ND2P5=$G(^PS(53.1,+ON,2.5)) D
"RTN","PSIVORFA",37,0)
 .S P("DUR")=$P(ND2P5,"^",2)
"RTN","PSIVORFA",38,0)
 .S P("LIMIT")=$P(ND2P5,"^",4)
"RTN","PSIVORFA",39,0)
 .S P("IVCAT")=$P(ND2P5,"^",5)
"RTN","PSIVORFA",40,0)
 Q
"RTN","PSIVORFA",41,0)
GTDRG ;
"RTN","PSIVORFA",42,0)
 K DRG F X="AD","SOL" S FIL=$S(X="AD":52.6,1:52.7) F Y=0:0 S Y=$O(^PS(53.1,+ON,X,Y)) Q:'Y  D
"RTN","PSIVORFA",43,0)
 .S (DRGI,DRG(X,0))=$G(DRG(X,0))+1,DRG=$G(^PS(53.1,+ON,X,Y,0)),ND=$G(^PS(FIL,+DRG,0)),DRGN=$P(ND,U),DRG(X,+DRGI)=+DRG_U_$P(ND,U)_U_$P(DRG,U,2)_U_$P(DRG,U,3)_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSIVORFA",44,0)
 Q
"RTN","PSIVORFA",45,0)
 ;
"RTN","PSIVORFA",46,0)
GTPC(ON) ; Retrieve Provider Comments and create "scratch" fields to edit
"RTN","PSIVORFA",47,0)
 Q
"RTN","PSIVORFA",48,0)
 ;
"RTN","PSIVORFA",49,0)
PUT531 ; Move data in local variables to 53.1
"RTN","PSIVORFA",50,0)
 S:'$D(P(9)) P(9)=$G(PSGSCH)
"RTN","PSIVORFA",51,0)
 S ND(0)=+ON_U_+P(6)_U_$S(+P("MR"):+P("MR"),1:"")_U_$P(P("OT"),U)_U_U_U_"C",$P(ND(0),U,9)=P(17),$P(ND(0),U,21)=$G(P(21))
"RTN","PSIVORFA",52,0)
 S $P(ND(0),U,14,16)=P("LOG")_U_DFN_U_P("LOG"),$P(ND(0),U,24,26)=$G(P("RES"))_U_$G(P("OLDON"))_U_$G(P("NEWON"))
"RTN","PSIVORFA",53,0)
 S ND(2)=P(9)_U_P(2)_U_U_P(3)_U_P(11)_U_$S($G(P(15))'="":P(15),$G(PSGS0XT)'="":PSGS0XT,$P($G(ZZND),"^",3)'="":$P(ZZND,"^",3),1:""),$P(ND(4),U,7,9)=+P("CLRK")_U_U_P("REN")
"RTN","PSIVORFA",54,0)
 S ND(8)=P(4)_U_P(23)_U_P("SYRS")_U_P(5)_U_P(8)_"^^"_P(7)_"^"_+P("IVRM"),ND(9)=$S($L(P("REM")_P("OPI")):P("REM")_U_P("OPI"),1:"") S $P(ND(4),U,1,2)=$G(P("NINIT"))_U_$G(P("NINITDT"))
"RTN","PSIVORFA",55,0)
 S:+$G(P("CLIN")) $P(^PS(53.1,+ON,"DSS"),"^")=P("CLIN")
"RTN","PSIVORFA",56,0)
 S:+$G(P("APPT")) $P(^PS(53.1,+ON,"DSS"),"^",2)=P("APPT")
"RTN","PSIVORFA",57,0)
 S:$G(P("LIMIT"))]"" $P(^PS(53.1,+ON,2.5),"^",4)=P("LIMIT")
"RTN","PSIVORFA",58,0)
 I $G(PSJORD)["V"!($G(PSJORD)["P") I $G(^PS(53.1,+ON,2.5))="" N DUR S DUR=$$GETDUR^PSJLIVMD(DFN,+PSJORD,$S((PSJORD["P"):"P",1:"IV"),1) I DUR]"" D
"RTN","PSIVORFA",59,0)
 .I $G(IVLIMIT) S $P(^PS(53.1,+ON,2.5),"^",4)=DUR K IVLIMIT Q
"RTN","PSIVORFA",60,0)
 .S $P(^PS(53.1,+ON,2.5),"^",2)=DUR
"RTN","PSIVORFA",61,0)
 F X=0,2,4,8,9 S ^PS(53.1,+ON,X)=ND(X)
"RTN","PSIVORFA",62,0)
 S PSIVCAT=$$IVCAT^PSJHLU(DFN,ON,.P) S:PSIVCAT]"" $P(^PS(53.1,+ON,2.5),"^",5)=PSIVCAT K PSIVCAT
"RTN","PSIVORFA",63,0)
 S:'+$G(^PS(53.1,+ON,.2)) $P(^(.2),U,1,3)=+P("PD")_U_P("DO")_U_$G(P("NAT"))
"RTN","PSIVORFA",64,0)
 F DRGT="AD","SOL" D:$D(DRG(DRGT)) PTD531
"RTN","PSIVORFA",65,0)
 K DA,DIK S PSGS0Y=P(11),PSGS0XT=P(15),DA=+ON,DIK="^PS(53.1," D IX^DIK K DA,DIK,PSGS0Y,PSGS0XT,ND,^PS(53.1,"AS","P",DFN,+ON)
"RTN","PSIVORFA",66,0)
 K:P(17)="A" ^PS(53.1,"AS","N",DFN,+ON)
"RTN","PSIVORFA",67,0)
 S:P(15)="D" $P(^PS(53.1,+ON,2),U,6)="D"
"RTN","PSIVORFA",68,0)
 Q
"RTN","PSIVORFA",69,0)
 ;
"RTN","PSIVORFA",70,0)
UPD100 ; Update order data in file 100
"RTN","PSIVORFA",71,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN Q:'PSJIVORF
"RTN","PSIVORFA",72,0)
 S PSJORL=$$ENORL^PSJUTL($G(VAIN(4))) D SET^PSIVORFE
"RTN","PSIVORFA",73,0)
 Q
"RTN","PSIVORFA",74,0)
 ;
"RTN","PSIVORFA",75,0)
PTD531 ; Move drug data from local array into 53.1
"RTN","PSIVORFA",76,0)
 K ^PS(53.1,+ON,DRGT) S ^PS(53.1,+ON,DRGT,0)=$S(DRGT="AD":"^53.157^0^0",1:"^53.158^0^0")
"RTN","PSIVORFA",77,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSIVORFA",78,0)
 .S X1=$P(DRG(DRGT,X),U),Y=^PS(53.1,+ON,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSIVORFA",79,0)
 .S ^PS(53.1,+ON,DRGT,0)=Y,Y=+X1_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^PS(53.1,+ON,DRGT,+DRG,0)=Y
"RTN","PSIVORFA",80,0)
 Q
"RTN","PSIVORFB")
0^35^B50190472
"RTN","PSIVORFB",1,0)
PSIVORFB ;BIR/MLM-FILE/RETRIEVE ORDERS IN ^PS(55 ;25 Sep 98 / 2:24 PM
"RTN","PSIVORFB",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,18,28,68,58,85,110,111,120,134**;16 DEC 97;Build 124
"RTN","PSIVORFB",3,0)
 ;
"RTN","PSIVORFB",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA #2180.
"RTN","PSIVORFB",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA #2178.
"RTN","PSIVORFB",6,0)
 ; Reference to ^PS(52.6 is supported by DBIA #1231.
"RTN","PSIVORFB",7,0)
 ; Reference to ^PS(52.7 is supported by DBIA #2173.
"RTN","PSIVORFB",8,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSIVORFB",9,0)
 ;
"RTN","PSIVORFB",10,0)
NEW55 ; Get new order number in 55.
"RTN","PSIVORFB",11,0)
 N DA,DD,DO,DIC,DLAYGO,X,Y,PSIVLIM,MINS,PSJDSTP1,PSJDSTP2,A,PSJCLIN,PSJDNM,PSJPROV,PSJWARD,PSJPAO,PSJALRT
"RTN","PSIVORFB",12,0)
 I $D(^PS(55,+DFN)),'$D(^PS(55,+DFN,0)) D ENSET0^PSGNE3(+DFN)
"RTN","PSIVORFB",13,0)
 I $G(PSJORD)["V"!($G(PSJORD)["P"),$G(P(2))]"" D LIMSTOP(.PSJDSTP1,.PSJDSTP2)
"RTN","PSIVORFB",14,0)
 I ($G(PSJORD)["P"!($G(PSJORD)["V"))&$G(PSIVLIM) I $$CMPLIM(PSJORD,PSJDSTP1,PSJDSTP2) D
"RTN","PSIVORFB",15,0)
 . D
"RTN","PSIVORFB",16,0)
 .. S PSJPROV=DUZ I PSJORD["P" S PSJPROV=$P($G(^PS(53.1,+PSJORD,0)),"^",2)
"RTN","PSIVORFB",17,0)
 .. I PSJORD["V" S PSJPROV=$P($G(^PS(55,DFN,"IV",+PSJORD,0)),"^",6)
"RTN","PSIVORFB",18,0)
 .. D NOW^%DTC S XQA(PSJPROV)="",XQAID="PSJ,"_DFN_";"_PSJPROV_";"_%,XQADATA=""
"RTN","PSIVORFB",19,0)
 .. D
"RTN","PSIVORFB",20,0)
 ... I PSJORD["P" S A=$G(^PS(53.1,+PSJORD,"DSS"))
"RTN","PSIVORFB",21,0)
 ... I PSJORD["V" S A=$G(^PS(55,PSGP,"IV",+PSJORD,"DSS"))
"RTN","PSIVORFB",22,0)
 ... S PSJCLIN=$P(A,"^") I PSJCLIN]"" S PSJCLIN=$P(^SC(PSJCLIN,0),"^")
"RTN","PSIVORFB",23,0)
 .. S A=$G(^DPT(DFN,0)),PSJWARD=$G(^(.1))
"RTN","PSIVORFB",24,0)
 .. S XQAMSG=$P(A,"^")_" ("_$E($P(A,"^"))_$E($P(A,"^",9),6,9)_"): ["_$S(PSJWARD]"":$E(PSJWARD,1,10),$G(PSJCLIN)]"":$E(PSJCLIN,1,10),1:"UNKNOWN")_"] "
"RTN","PSIVORFB",25,0)
 .. S A=$O(DRG("AD",0)) I A]"" S A=DRG("AD",A)
"RTN","PSIVORFB",26,0)
 .. I A="" S A=$O(DRG("SOL",0)) I A]"" S A=DRG("SOL",A)
"RTN","PSIVORFB",27,0)
 .. S PSJDNM=$P(^PS(50.7,+$P(A,"^",6),0),"^")
"RTN","PSIVORFB",28,0)
 .. S XQAMSG=XQAMSG_PSJDNM_" your DURATION not used for stop date/time"
"RTN","PSIVORFB",29,0)
 .. D SETUP^XQALERT
"RTN","PSIVORFB",30,0)
 .. S PSJALRT=$$FMTDUR^PSJLIVMD($S(PSJORD["P":$P($G(^PS(53.1,+PSJORD,2.5)),"^",4),PSJORD["IV":$P($G(^PS(55,DFN,"IV",+PSJORD,2.5)),"^",4),1:"UNK"))
"RTN","PSIVORFB",31,0)
 S DIC="^PS(55,",DIC(0)="LN",DLAYGO=55,(DINUM,X)=+DFN D ^DIC Q:Y<0
"RTN","PSIVORFB",32,0)
LOCK0 F  L +^PS(55,DFN,"IV",0):0 I  Q
"RTN","PSIVORFB",33,0)
 S ND=$S($D(^PS(55,DFN,"IV",0)):^(0),1:"^55.01") F DA=$P(ND,"^",3)+1:1 W "." I '$D(^PS(55,DFN,"IV",DA)) S $P(ND,"^",3)=DA,$P(ND,"^",4)=$P(ND,"^",4)+1,^PS(55,DFN,"IV",0)=ND Q
"RTN","PSIVORFB",34,0)
 L +^PS(55,DFN,"IV",+DA):0 E  G LOCK0
"RTN","PSIVORFB",35,0)
 S ^PS(55,DFN,"IV",+DA,0)=+DA,^PS(55,DFN,"IV","B",+DA,+DA)=""
"RTN","PSIVORFB",36,0)
 L -^PS(55,DFN,"IV",0) S ON55=+DA_"V"
"RTN","PSIVORFB",37,0)
 I $G(PSJALRT)]"" S PSIVAL="IV LIMIT OVERRIDDEN ("_$G(PSJALRT)_"): ALERT SENT",PSIVALT="",PSIVREA="E" D
"RTN","PSIVORFB",38,0)
 .D LOG^PSIVORAL S P("LIMIT")="",P("OVRIDE")=1 K IVLIM,IVLIMIT
"RTN","PSIVORFB",39,0)
 .S $P(^PS(55,DFN,"IV",+ON55,2.5),"^",4)="" S:$G(PSJORD)["P" $P(^PS(53.1,+PSJORD,2.5),"^",4)=""
"RTN","PSIVORFB",40,0)
 .K PSIVAL,PSIVREA,PSIVALT
"RTN","PSIVORFB",41,0)
 Q
"RTN","PSIVORFB",42,0)
SET55 ; Move data from local variables to 55.
"RTN","PSIVORFB",43,0)
 I '$D(ON55) W !,"*** Can't create this order at this time ***" Q
"RTN","PSIVORFB",44,0)
 N DA,DIK,ND,PSIVACT,PSIVDUR
"RTN","PSIVORFB",45,0)
 S:'$D(P(21)) (P(21),P("21FLG"))="" S ND(0)=+ON55,P(22)=$S(VAIN(4):+VAIN(4),1:.5) F X=2:1:23 I $D(P(X)) S $P(ND(0),U,X)=P(X)
"RTN","PSIVORFB",46,0)
 S ND(.3)=$G(P("INS")),ND(2.5)="" N X S X=$S($G(PSGORD):PSGORD,1:$G(ON)) I X D
"RTN","PSIVORFB",47,0)
 .N PKG S PKG=$E(X,$L(X)) S PKG=$S(PKG="V":"""IV""",PKG="U":5,PKG="P":"P",1:"") Q:PKG=""
"RTN","PSIVORFB",48,0)
 .S PSIVDUR=$$GETDUR^PSJLIVMD(DFN,+X,$E(X,$L(X)),1) Q:PSIVDUR=""
"RTN","PSIVORFB",49,0)
 .I $G(IVLIMIT) S ND(2.5)="^^^"_PSIVDUR K IVLIMIT Q
"RTN","PSIVORFB",50,0)
 S $P(ND(0),U,17)="A",ND(1)=P("REM"),ND(3)=P("OPI"),ND(.2)=$P($G(P("PD")),U)_U_$G(P("DO"))_U_+P("MR")_U_$G(P("PRY"))_U_$G(P("NAT"))_U_U_U_$G(P("PRNTON"))
"RTN","PSIVORFB",51,0)
 F X=0,1,2.5,3,.2,.3 S ^PS(55,DFN,"IV",+ON55,X)=ND(X)
"RTN","PSIVORFB",52,0)
 S $P(^PS(55,DFN,"IV",+ON55,2),U,1,4)=P("LOG")_U_+P("IVRM")_U_U_P("SYRS"),$P(^(2),U,8,10)=P("RES")_U_$G(P("FRES"))_U_$S($G(VAIN(4)):+VAIN(4),1:"")
"RTN","PSIVORFB",53,0)
 S X=^PS(55,DFN,0) I $P(X,"^",7)="" S $P(X,"^",7)=$P($P(P("LOG"),"^"),"."),$P(X,"^",8)="A",^(0)=X
"RTN","PSIVORFB",54,0)
 S $P(^PS(55,DFN,"IV",+ON55,2),U,11)=+P("CLRK")
"RTN","PSIVORFB",55,0)
 S:+$G(P("CLIN")) $P(^PS(55,DFN,"IV",+ON55,"DSS"),"^")=P("CLIN")
"RTN","PSIVORFB",56,0)
 S:+$G(P("APPT")) $P(^PS(55,DFN,"IV",+ON55,"DSS"),"^",2)=P("APPT")
"RTN","PSIVORFB",57,0)
 S:+$G(P("NINIT")) ^PS(55,DFN,"IV",+ON55,4)=P("NINIT")_U_P("NINITDT")
"RTN","PSIVORFB",58,0)
 I '$G(PSIVCHG)!($G(PSJREN)&($G(PSIVCHG)=2)) I $G(P("PON")),P("PON")'=ON55 D
"RTN","PSIVORFB",59,0)
 . N X S X=$S(P("PON")["P":"^PS(53.1,+P(""PON""),12,0)",P("PON")["V"&$G(PSJREN):"^PS(55,DFN,""IV"",+P(""PON""),5,0)",1:"") Q:X=""
"RTN","PSIVORFB",60,0)
 . I $O(@X) S %X=X,%Y="^PS(55,"_DFN_",""IV"","_+ON55_",5," D %XY^%RCR
"RTN","PSIVORFB",61,0)
 F DRGT="AD","SOL" D PUTD55
"RTN","PSIVORFB",62,0)
 K DA,DIK S DA(1)=DFN,DA=+ON55,DIK="^PS(55,"_DA(1)_",""IV"",",PSIVACT=1 D IX^DIK
"RTN","PSIVORFB",63,0)
 I $G(PSJCOM),$G(PSJCOMSI),$G(PSJORD)["V" K PSJCOMSI N PSJCHILD,PSJOEORD S PSJOEORD=0 F  S PSJOEORD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD)) Q:'PSJOEORD  D
"RTN","PSIVORFB",64,0)
 . N PSJCHILD S PSJCHILD=0 F  S PSJCHILD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD,PSJCHILD)) Q:'PSJCHILD  S PSJCHILD(+PSJCHILD)=PSJCOM
"RTN","PSIVORFB",65,0)
 . S PSJCHILD=0 F  S PSJCHILD=$O(PSJCHILD(PSJCHILD)) Q:'PSJCHILD  D
"RTN","PSIVORFB",66,0)
 .. Q:PSJCHILD=PSJORD  K DR,DA,DIE,ORD S DR="31////"_$P($G(P("OPI")),"^",1,2),DA(1)=DFN
"RTN","PSIVORFB",67,0)
 .. N ON,ON55 S (ON,ON55)=+PSJCHILD_"V" S:+$G(PSJPINIT)'>0 PSJPINIT=DUZ S PSIVALT=1,PSIVAL="COMPLEX ORDER" D ENTACT^PSIVAL D
"RTN","PSIVORFB",68,0)
 ... I $P($G(^PS(55,DFN,"IV",+ON55,3)),"^")'=$P(P("OPI"),"^") S P("FC")="OTHER PRINT INFO^"_$P($G(^(3)),"^")_U_$P(P("OPI"),"^") D GTFC^PSIVORAL
"RTN","PSIVORFB",69,0)
 ... I $D(^PS(55,DFN,"IV",+ON55,0)) S ^PS(55,DFN,"IV",+ON55,3)=P("OPI") D EN1^PSJHL2(DFN,"XX",ON55)
"RTN","PSIVORFB",70,0)
 Q
"RTN","PSIVORFB",71,0)
 ;
"RTN","PSIVORFB",72,0)
PUTD55 ; Move drug data from local array into 55
"RTN","PSIVORFB",73,0)
 K ^PS(55,DFN,"IV",+ON55,DRGT) S ^PS(55,DFN,"IV",+ON55,DRGT,0)=$S(DRGT="AD":"^55.02PA",1:"^55.11IPA")
"RTN","PSIVORFB",74,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSIVORFB",75,0)
 .S Y=^PS(55,DFN,"IV",+ON55,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSIVORFB",76,0)
 .S ^PS(55,DFN,"IV",+ON55,DRGT,0)=Y,Y=$P(DRG(DRGT,X),U)_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^PS(55,DFN,"IV",+ON55,DRGT,+DRG,0)=Y
"RTN","PSIVORFB",77,0)
 Q
"RTN","PSIVORFB",78,0)
GT55 ; Retrieve data from 55 into local array
"RTN","PSIVORFB",79,0)
 K DRG,DRGN,P S:'$D(ON55) ON55=ON S P("REN")="",Y=$G(^PS(55,DFN,"IV",+ON55,0)) F X=1:1:23 S P(X)=$P(Y,U,X)
"RTN","PSIVORFB",80,0)
 S P("21FLG")=P(21)
"RTN","PSIVORFB",81,0)
 S P("PON")=ON55,PSJORIFN=P(21),P(6)=P(6)_U_$P($G(^VA(200,+P(6),0)),U),(DRG,DRGN)="",P("REM")=$G(^PS(55,DFN,"IV",+ON55,1))
"RTN","PSIVORFB",82,0)
 S Y=$G(^PS(55,DFN,"IV",+ON55,2)),P("LOG")=$P(Y,U),P("IVRM")=$P(Y,U,2)_U_$P($G(^PS(59.5,+$P(Y,U,2),0)),U)
"RTN","PSIVORFB",83,0)
 S P("CLRK")=$P(Y,U,11)_U_$P($G(^VA(200,+$P(Y,U,11),0)),U),P("RES")=$P(Y,U,8),P("FRES")=$P(Y,U,9),P("SYRS")=$P(Y,U,4),P("OPI")=$G(^PS(55,DFN,"IV",+ON55,3))
"RTN","PSIVORFB",84,0)
 S P("INS")=$G(^PS(55,DFN,"IV",+ON55,.3))
"RTN","PSIVORFB",85,0)
 S P("CLIN")=$P($G(^PS(55,DFN,"IV",+ON55,"DSS")),"^"),P("APPT")=$P($G(^PS(55,DFN,"IV",+ON55,"DSS")),"^",2)
"RTN","PSIVORFB",86,0)
 S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSIVORFB",87,0)
 D:'$D(PSJLABEL) GTPC(ON55) S ND=$G(^PS(55,DFN,"IV",+ON55,.2)),P("PD")=$S($P(ND,U):$P(ND,U)_U_$$OIDF^PSJLMUT1(+ND)_U_$P($G(^PS(50.7,+ND,0)),U),1:""),P("DO")=$P(ND,U,2),P("PRY")=$P(ND,U,4),P("NAT")=$P(ND,U,5),(PSJCOM,P("PRNTON"))=$P(ND,U,8)
"RTN","PSIVORFB",88,0)
 I P("PRY")="D",'+P("IVRM") S P("IVRM")=+$G(PSIVSN)_U_$P($G(^PS(59.5,+$G(PSIVSN),0)),U)
"RTN","PSIVORFB",89,0)
 S P("MR")=$P(ND,U,3),ND=$G(^PS(51.2,+P("MR"),0)),P("MR")=P("MR")_U_$S($P(ND,U,3)]"":$P(ND,U,3),1:$P(ND,U)) D GTCUM
"RTN","PSIVORFB",90,0)
 D GTDRG,GTOT^PSIVUTL(P(4))
"RTN","PSIVORFB",91,0)
 N ND2P5 S ND2P5=$G(^PS(55,DFN,"IV",+ON55,2.5)) D
"RTN","PSIVORFB",92,0)
 .S P("DUR")=$P(ND2P5,"^",2)
"RTN","PSIVORFB",93,0)
 .S P("LIMIT")=$P(ND2P5,"^",4)
"RTN","PSIVORFB",94,0)
 .S P("IVCAT")=$P(ND2P5,"^",5)
"RTN","PSIVORFB",95,0)
K ; Kill and exit.
"RTN","PSIVORFB",96,0)
 K FIL,ND
"RTN","PSIVORFB",97,0)
 Q
"RTN","PSIVORFB",98,0)
GTDRG ; Get drug info and place in DRG(.
"RTN","PSIVORFB",99,0)
 F DRGT="AD","SOL" S FIL=$S(DRGT="AD":52.6,1:52.7) F Y=0:0 S Y=$O(^PS(55,DFN,"IV",+ON55,DRGT,Y)) Q:'Y  D
"RTN","PSIVORFB",100,0)
 .; naked ref below refers to line above
"RTN","PSIVORFB",101,0)
 .S DRG=$G(^(Y,0)),ND=$G(^PS(FIL,+DRG,0)),(DRGI,DRG(DRGT,0))=$G(DRG(DRGT,0))+1
"RTN","PSIVORFB",102,0)
 .S DRG(DRGT,+DRGI)=+DRG_U_$P(ND,U)_U_$P(DRG,U,2)_U_$P(DRG,U,3)_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSIVORFB",103,0)
 Q
"RTN","PSIVORFB",104,0)
 ;
"RTN","PSIVORFB",105,0)
GTCUM ; Retrieve dispensing info.
"RTN","PSIVORFB",106,0)
 S ND=$G(^PS(55,DFN,"IV",+ON55,9)),P("LF")=$P(ND,U),P("LFA")=$P(ND,U,2),P("CUM")=$P(ND,U,3)
"RTN","PSIVORFB",107,0)
 Q
"RTN","PSIVORFB",108,0)
 ;
"RTN","PSIVORFB",109,0)
GTPC(ON) ; Retrieve Provider Comments and create "scratch" fields to edit
"RTN","PSIVORFB",110,0)
 Q
"RTN","PSIVORFB",111,0)
 ;
"RTN","PSIVORFB",112,0)
SETNEW ; Create new order and set
"RTN","PSIVORFB",113,0)
 D NEW55,SET55
"RTN","PSIVORFB",114,0)
 Q
"RTN","PSIVORFB",115,0)
 ;
"RTN","PSIVORFB",116,0)
CMPLIM(PSJORD,PSJDSTP1,PSJDSTP2) ; Compare stop date of order against IV Limit
"RTN","PSIVORFB",117,0)
 I $P($G(^PS(53.1,+PSJORD,0)),"^",25)]"" D CHKD Q:PSJPAO 0
"RTN","PSIVORFB",118,0)
 I $G(PSJDSTP1),$E(+PSJDSTP1,1,11)'=$E(+P(3),1,11),+PSJDSTP2'=+P(3) Q 1
"RTN","PSIVORFB",119,0)
 Q 0
"RTN","PSIVORFB",120,0)
 ;
"RTN","PSIVORFB",121,0)
LIMSTOP(PSJDSTP1,PSJDSTP2) ; Calculate default stop date using IV Limit
"RTN","PSIVORFB",122,0)
 ;      Output: PSJDSTP1 - Default stop using duration only
"RTN","PSIVORFB",123,0)
 ;              PSJDSTP2 - Default stop using duration and IV parameters for time
"RTN","PSIVORFB",124,0)
 S PSIVLIM=$$GETLIM^PSIVCAL(DFN,PSJORD)
"RTN","PSIVORFB",125,0)
 I 'PSIVLIM,PSIVLIM]"" S PSIVLIM=$$GETMIN^PSIVCAL(PSIVLIM,DFN,PSJORD)
"RTN","PSIVORFB",126,0)
 I PSIVLIM]"" D
"RTN","PSIVORFB",127,0)
 . S MINS=$$GETMIN^PSIVCAL(PSIVLIM,DFN,PSJORD),PSJDSTP1=$$FMADD^XLFDT(P(2),,,MINS)
"RTN","PSIVORFB",128,0)
 . S X=$P(PSJDSTP1,"."),PSJDSTP2=X_$S($P(PSIVSITE,"^",14)="":.2359,1:"."_$P(PSIVSITE,"^",14))
"RTN","PSIVORFB",129,0)
 Q
"RTN","PSIVORFB",130,0)
 ;
"RTN","PSIVORFB",131,0)
CHKD ;Check for a previous active order and compare the duration
"RTN","PSIVORFB",132,0)
 N PSJPO,A,PSJDUR
"RTN","PSIVORFB",133,0)
 S PSJDUR=$$GETLIM^PSIVCAL(DFN,PSJORD)
"RTN","PSIVORFB",134,0)
 S PSJPAO=0,PSJPO=PSJORD
"RTN","PSIVORFB",135,0)
CHKDR S PSJPO=$P($G(^PS(53.1,+PSJPO,0)),"^",25) Q:PSJPO=""
"RTN","PSIVORFB",136,0)
 I PSJPO["P" G CHKDR
"RTN","PSIVORFB",137,0)
 I PSJPO["V" S PSIVLIM=$$GETLIM^PSIVCAL(DFN,PSJPO) I PSJDUR'=PSIVLIM S PSJPAO=1 Q
"RTN","PSIVORFB",138,0)
 G CHKDR
"RTN","PSIVSP")
0^26^B37490534
"RTN","PSIVSP",1,0)
PSIVSP ;BIR/RGY,PR,CML3-DOSE PROCESSOR ;09 Feb 99 / 12:30 PM
"RTN","PSIVSP",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**30,37,41,50,56,74,83,111,133,138,134**;16 DEC 97;Build 124
"RTN","PSIVSP",3,0)
 ;
"RTN","PSIVSP",4,0)
 ; Reference to ^PS(51.1 is supported by DBIA #2177
"RTN","PSIVSP",5,0)
 ;
"RTN","PSIVSP",6,0)
EN ;
"RTN","PSIVSP",7,0)
 Q:'$D(X)
"RTN","PSIVSP",8,0)
 S ATZERO=0 I X["@",$P(X,"@",2)=0 S ATZERO=1,X=$P(X,"@")
"RTN","PSIVSP",9,0)
 D EN^PSGS0 S (P(9),PSIVSC1)=$S($G(X)]"":X,1:$G(P(9))),P(11)=$S($G(PSGS0Y):PSGS0Y,1:$G(P(11))),(XT,P(15))=$S(($G(PSGS0XT)!($G(PSGS0XT)="O")!($G(PSGS0XT)="D")):$G(PSGS0XT),1:$G(P(15)))
"RTN","PSIVSP",10,0)
 I $G(ATZERO) S P(7)=1
"RTN","PSIVSP",11,0)
 K ATZERO Q
"RTN","PSIVSP",12,0)
EN1 ;
"RTN","PSIVSP",13,0)
 S (PSIVAT,PSIVWAT,Y)="",XT=-1,X0=X,X=$S(X="ON CALL":X,X="ONCALL":X,X="ON-CALL":X,X="ONETIME":X,X="ONE-TIME":X,X="ONE TIME":X,X="1TIME":X,X="1 TIME":X,X="1-TIME":X,$L(X," ")<3:$P(X," "),1:$P(X," ",1,2))
"RTN","PSIVSP",14,0)
 S:$E(X)="^" X=$E(X,2,999) G:X="" Q S:X["@0" ATZERO=1 S X=$S(X["@0":$P(X,"@"),1:X),P(7)=$S($D(ATZERO):1,1:"") K ATZERO
"RTN","PSIVSP",15,0)
 I $S($D(^PS(51.1,"AC","PSJ",X)):1,1:$E($O(^(X)),1,$L(X))=X) D DIC I Y'<0 G SH
"RTN","PSIVSP",16,0)
NS0 S Y=""
"RTN","PSIVSP",17,0)
 I $E(X,1,2)="AD" S XT=-1 Q
"RTN","PSIVSP",18,0)
 I $E(X,1,3)="BID"!($E(X,1,3)="TID")!($E(X,1,3)="QID") S XT=1440\$F("BTQ",$E(X))
"RTN","PSIVSP",19,0)
 E  S:$E(X)="Q" X=$E(X,2,99) S:'X X=$E(X)["O"+1_X S I=+X,X=$P(X,I,2),XT=I*$S(X["'":1,(X["D"&(X'["AD"))!(X["AM")!(X["PM")!(X["HS"&(X'["THS")):1440,X["H"&(X'["TH"):60,X["AC"!(X["PC"):480,X["W":10080,X["M":40320,1:0),X=X0 D 
"RTN","PSIVSP",20,0)
 . I 'XT,X'="NOW",X'="STAT",X'="ONCE",X'="ONE-TIME",X'="ONE TIME",X'="ONETIME",X'="1-TIME",X'="1 TIME",X'="1TIME",Y="" S XT=-1
"RTN","PSIVSP",21,0)
SH ;
"RTN","PSIVSP",22,0)
 I +Y<1,$E(X0)'="^" W:$G(ON)'["P" "  ",$S(XT=0&($S("^NOW^STAT^ONCE^ONE-TIME^ONETIME^1TIME^1-TIME^"[(U_$P(X," ")_U):1,X["1 TIME":1,1:X["ONE TIME")):"(ONCE ONLY)",XT>0:"Nonstandard schedule",XT<0:"",1:"(??)") W:XT>0 " (",XT," MINUTES)"
"RTN","PSIVSP",23,0)
Q Q:X="ONE TIME"
"RTN","PSIVSP",24,0)
 N I S X0=$P(X," ")_$S($L(X0," ")-1:" ",1:"")_$P(X0," ",2,99) K:XT<0!($L(X0)>22) X S:$D(X) X=X0 K X0 S:$G(P(7)) XT="" Q
"RTN","PSIVSP",25,0)
NEWQ ;N I S X0=$P(X," ")_$S($L(X0," ")-1:" ",1:"")_$P(X0," ",2,99) K:XT<0!($L(X0)>22) X S:$D(X) X=X0 S:P(7) X=X0 K X0 K:XT>0&('P(7)) X Q
"RTN","PSIVSP",26,0)
 Q
"RTN","PSIVSP",27,0)
 ;
"RTN","PSIVSP",28,0)
ENDL W "   Dose limit ....  " S PSIVMIN=P(15)*X,PSIVSD=+P(2)
"RTN","PSIVSP",29,0)
 I PSIVMIN<0 W !!," --- There is something wrong with this order !!",!,"     Call inpatient supervisor ....." S Y=-1 K PSIVMIN Q
"RTN","PSIVSP",30,0)
 I P(4)="P"!(P(5))!(P(23)="P"),PSIVMIN=0,"^NOW^STAT^ONCE^ONE-TIME^ONE TIME^ON CALL^ONETIME^1TIME^1 TIME^1-TIME^"'[(U_P(9)_U) D DLP G QDL
"RTN","PSIVSP",31,0)
 D ENT^PSIVWL
"RTN","PSIVSP",32,0)
QDL I $D(X) S X=Y X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2) S Y=X
"RTN","PSIVSP",33,0)
 Q
"RTN","PSIVSP",34,0)
DLP ;
"RTN","PSIVSP",35,0)
 S X=X+1,$P(PSIVSD,".",2)=$P(PSIVSD,".",2)_$E("0000",1,4-$L($P(PSIVSD,".",2))) D CHK S X2=0,Y=1 I X<2 S Y=+PSIVSD G QDLP
"RTN","PSIVSP",36,0)
 I $P(PSIVSD,".",2)>$P(P(11),"-",$L(P(11),"-")) S X2=1 G OV
"RTN","PSIVSP",37,0)
 G:$P(P(11),"-")>$P(PSIVSD,".",2) OV
"RTN","PSIVSP",38,0)
 F Y=1:1 S X1=$P(P(11),"-",Y) I X1=$P(PSIVSD,".",2)!($P(PSIVSD,".",2)<X1) Q
"RTN","PSIVSP",39,0)
OV I P(11)="" W $C(7)," ???",!?15,"*** You have not defined any administration times !!" K X Q
"RTN","PSIVSP",40,0)
 F Y=Y:1 S:$P(P(11),"-",Y)="" X2=X2+1,Y=0,X=X+1 S X=X-1 Q:X<1
"RTN","PSIVSP",41,0)
 S X=PSIVSD\1 I X2>0 S X1=PSIVSD D C^%DTC S X=$P(X,".") ; install with version 17.3 of fileman
"RTN","PSIVSP",42,0)
 S Y=+(X_"."_$P(P(11),"-",Y))
"RTN","PSIVSP",43,0)
QDLP K X1,X2 Q
"RTN","PSIVSP",44,0)
 ;
"RTN","PSIVSP",45,0)
ENI ;
"RTN","PSIVSP",46,0)
 K:$L(X)<1!($L(X)>30)!(X["""")!($A(X)=45) X I '$D(X)!'$D(P(4)) Q
"RTN","PSIVSP",47,0)
 I P(4)="P"!(P(5))!(P(23)="P") Q:'X  S X="INFUSE OVER "_X_" MINUTE"_$S(X>1:"S",1:"") W "   ",X Q
"RTN","PSIVSP",48,0)
 I X'=+X,($P(X,"@",2,999)'=+$P(X,"@",2,999)!(+$P(X,"@",2,999)<0)) K X Q
"RTN","PSIVSP",49,0)
 S SPSOL=$O(DRG("SOL",0)) I 'SPSOL K SPSOL,X W "  You must define at least one solution !!" Q
"RTN","PSIVSP",50,0)
 I X=+X S X=X_" ml/hr" W " ml/hr" D SPSOL S P(15)=$S('X:0,1:SPSOL\X*60+(SPSOL#X/X*60+.5)\1) K SPSOL Q
"RTN","PSIVSP",51,0)
 S SPSOL=$P(X,"@",2) S:$P(X,"@")=+X $P(X,"@")=$P(X,"@")_" ml/hr" W "   ",+SPSOL," Label",$S(SPSOL'=1:"s",1:"")," per day",!?15,"at an infusion rate of: ",$P(X,"@") S P(15)=$S('SPSOL:0,1:1440/SPSOL\1) K SPSOL
"RTN","PSIVSP",52,0)
 Q
"RTN","PSIVSP",53,0)
SPSOL S SPSOL=0 F XXX=0:0 S XXX=$O(DRG("SOL",XXX)) Q:'XXX  S SPSOL=SPSOL+$P(DRG("SOL",XXX),U,3)
"RTN","PSIVSP",54,0)
 K XXX Q
"RTN","PSIVSP",55,0)
CHK F Y=1:1 Q:$L(P(11))>240!($P(P(11),"-",Y)="")  S $P(P(11),"-",Y)=$P(P(11),"-",Y)_$E("0000",1,4-$L($P(P(11),"-",Y)))
"RTN","PSIVSP",56,0)
 Q
"RTN","PSIVSP",57,0)
 ;
"RTN","PSIVSP",58,0)
DIC ; 51.1 look-up
"RTN","PSIVSP",59,0)
 N PSJSCH S PSJSCH=X I '$D(WSCHADM) N VAIP D IN5^VADPT S WSCHADM=VAIP(5),X=PSJSCH
"RTN","PSIVSP",60,0)
 K DIC S DIC="^PS(51.1,",DIC(0)=$E("E",'$D(NOECH))_"ISZ"
"RTN","PSIVSP",61,0)
 S DIC("W")="W ""  "","_$S('$D(WSCHADM):"$P(^(0),""^"",2)",'+WSCHADM:"$P(^(0),""^"",2)",1:"$S($D(^PS(51.1,+Y,1,+WSCHADM,0)):$P(^(0),""^"",2),1:$P(^PS(51.1,+Y,0),""^"",2))"),D="APPSJ" S:$D(PSIVSPQF) DIC(0)=DIC(0)_"O"
"RTN","PSIVSP",62,0)
 D IX^DIC K DIC
"RTN","PSIVSP",63,0)
 S:$D(DIE)#2 DIC=DIE Q:Y<0
"RTN","PSIVSP",64,0)
 S X=Y(0,0),ZZY=Y,(XT,Y)="" I $D(WSCHADM),$D(^PS(51.1,+ZZY,1,+WSCHADM,0)),$P(^(0),"^",2)]"" S (PSIVWAT,Y)=$P(^(0),"^",2)
"RTN","PSIVSP",65,0)
 K ZZY,WSCHADM S:Y="" (X,PSIVSC1)=$P(Y(0),U),(PSIVAT,Y)=$P(Y(0),"^",2) S XT=$P(Y(0),"^",3) Q
"RTN","PSIVSP",66,0)
 ;
"RTN","PSIVSP",67,0)
ORINF ;  OERR input transform for Infusion Rate
"RTN","PSIVSP",68,0)
 ;  X=data
"RTN","PSIVSP",69,0)
 N INFUSE
"RTN","PSIVSP",70,0)
 K:$L(X)<1!($L(X)>30)!(X["""")!($A(X)=45) X I '$D(X) Q
"RTN","PSIVSP",71,0)
 I X?.E1L.E S INFUSE=$$ENLU^PSGMI(X) Q:(INFUSE="TITRATE")!(INFUSE="BOLUS")!($P(INFUSE," ")="INFUSE")!($P(INFUSE," ")="Infuse")
"RTN","PSIVSP",72,0)
 Q:(X="TITRATE")!(X="BOLUS")!($P(X," ")="INFUSE")!($P(X," ")="Infuse")
"RTN","PSIVSP",73,0)
 I X["=" D  Q   ; NOIS LOU-0501-42191
"RTN","PSIVSP",74,0)
 .N X2,X1 S X1=$P(X,"="),X2=$P(X,"=",2)
"RTN","PSIVSP",75,0)
 .I X1["ML/HR",(+X1=$P(X1,"ML/HR"))!(+X1=$P(X1," ML/HR")) D
"RTN","PSIVSP",76,0)
 ..S X1=$TR(X1,"ML/HR","ml/hr")
"RTN","PSIVSP",77,0)
 .I X2["ML/HR",(+X2=$P(X2,"ML/HR"))!(+X2=$P(X2," ML/HR")) D
"RTN","PSIVSP",78,0)
 ..S X2=$TR(X2,"ML/HR","ml/hr")
"RTN","PSIVSP",79,0)
 .I X1[" ml/hr",(+X1=$P(X1," ml/hr")) D
"RTN","PSIVSP",80,0)
 ..S X1=$P(X1," ml/hr")_$P(X1," ml/hr",2,9999)
"RTN","PSIVSP",81,0)
 .I X2[" ml/hr",(+X2=$P(X2," ml/hr")) D
"RTN","PSIVSP",82,0)
 ..S X2=$P(X2," ml/hr")_$P(X2," ml/hr",2,9999)
"RTN","PSIVSP",83,0)
 .I X1["ml/hr",(+X1=$P(X1,"ml/hr")) D
"RTN","PSIVSP",84,0)
 ..S X1=$P(X1,"ml/hr")_$P(X1,"ml/hr",2,9999)
"RTN","PSIVSP",85,0)
 .I X2["ml/hr",(+X2=$P(X2,"ml/hr")) D
"RTN","PSIVSP",86,0)
 ..S X2=$P(X2,"ml/hr")_$P(X2,"ml/hr",2,9999)
"RTN","PSIVSP",87,0)
 .I X2'=+X2 D
"RTN","PSIVSP",88,0)
 ..I X2>0&(X2<1) Q
"RTN","PSIVSP",89,0)
 ..I ($P(X2,"@",2,999)'=+$P(X2,"@",2,999)!(+$P(X2,"@",2,999)<0)) K X Q
"RTN","PSIVSP",90,0)
 .I X1>0&(X1<1) I +X1="."_$P(X1,".",2) S X1=X1_" ml/hr"
"RTN","PSIVSP",91,0)
 .I X2>0&(X2<1) I +X2="."_$P(X2,".",2) S X2=X2_" ml/hr"
"RTN","PSIVSP",92,0)
 .I X1=+X1 S X1=X1_" ml/hr"
"RTN","PSIVSP",93,0)
 .I X2=+X2 S X2=X2_" ml/hr"
"RTN","PSIVSP",94,0)
 .S:$P(X2,"@")=+X2 $P(X2,"@")=$P(X2,"@")_" ml/hr"
"RTN","PSIVSP",95,0)
 .S X=X1_"="_X2
"RTN","PSIVSP",96,0)
 I X["ML/HR",(+X=$P(X,"ML/HR"))!(+X=$P(X," ML/HR")) S X=$TR(X,"ML/HR","ml/hr")
"RTN","PSIVSP",97,0)
 I X[" ml/hr",+X=$P(X," ml/hr") S X=$P(X," ml/hr")_$P(X," ml/hr",2,9999)
"RTN","PSIVSP",98,0)
 I X["ml/hr",+X=$P(X,"ml/hr") S X=$P(X,"ml/hr")_$P(X,"ml/hr",2,9999)
"RTN","PSIVSP",99,0)
 I X>0,X<1 D  Q
"RTN","PSIVSP",100,0)
 .I X["ML/HR",(+X=$P($P(X,"ML/HR"),".",2))!(+X=$P($P(X," ML/HR"),".",2)) S X=$TR(X,"ML/HR","ml/hr")
"RTN","PSIVSP",101,0)
 .I X[" ml/hr",(+X=$P($P(X," ml/hr"),".",2)) S X=$P(X," ml/hr")_$P(X," ml/hr",2,9999)
"RTN","PSIVSP",102,0)
 .I X["ml/hr",+X=$P(X,"ml/hr") S X=$P(X,"ml/hr")_$P(X,"ml/hr",2,9999)
"RTN","PSIVSP",103,0)
 .I +X=X S X=X_" ml/hr"
"RTN","PSIVSP",104,0)
 .I $P(X,0,2)=+X S X=X_" ml/hr"
"RTN","PSIVSP",105,0)
 .S X=0_+X_$P(X,+X,2)
"RTN","PSIVSP",106,0)
 I '(X>0&X<1) I X'=+X,($P(X,"@",2,999)'=+$P(X,"@",2,999)!(+$P(X,"@",2,999)<0)) K X Q
"RTN","PSIVSP",107,0)
 I X=+X S X=X_" ml/hr" Q
"RTN","PSIVSP",108,0)
 S:$P(X,"@")=+X $P(X,"@")=$P(X,"@")_" ml/hr"
"RTN","PSIVSP",109,0)
 Q
"RTN","PSIVUTL1")
0^36^B26385588
"RTN","PSIVUTL1",1,0)
PSIVUTL1 ;BIR/MLM-IV UTILITIES ;21 MAY 96 / 10:37 AM
"RTN","PSIVUTL1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**58,81,111,134**;16 DEC 97;Build 124
"RTN","PSIVUTL1",3,0)
 ;
"RTN","PSIVUTL1",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180
"RTN","PSIVUTL1",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178
"RTN","PSIVUTL1",6,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231
"RTN","PSIVUTL1",7,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVUTL1",8,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIVUTL1",9,0)
 ;
"RTN","PSIVUTL1",10,0)
DRGSC(Y,PSJSCT) ; Called to set DIC("S") when selecting orderable item.
"RTN","PSIVUTL1",11,0)
 N OK,ND,NDU,NDI S OK=0 ;* I '$D(^PSDRUG("AP",+Y)) K PSJSCT Q 0
"RTN","PSIVUTL1",12,0)
 S ND=$G(^PS(50.7,+Y,0))
"RTN","PSIVUTL1",13,0)
 I $P(ND,U,3) S OK=$S('$P(ND,U,4):1,$P(ND,U,4)>DT:1,1:0)
"RTN","PSIVUTL1",14,0)
 Q OK
"RTN","PSIVUTL1",15,0)
 ;
"RTN","PSIVUTL1",16,0)
IVDRGSC(Y) ; Set DIC("S") for IV additive/solution selection.
"RTN","PSIVUTL1",17,0)
 ; Naked reference below refers to full reference in Y, which is either ^PS(52.6, or ^PS(52.7
"RTN","PSIVUTL1",18,0)
 N Y S Y="S X(1)=$G(^(0)),X(2)=$G(^(""I"")) I $S('X(2):1,X(2)>DT:1,1:0),$D(^PSDRUG(+$P(X(1),U,2),0)) S X(2)=$G(^(""I"")) I $S('X(2):1,X(2)>DT:1,1:0)"
"RTN","PSIVUTL1",19,0)
 Q Y
"RTN","PSIVUTL1",20,0)
 ;
"RTN","PSIVUTL1",21,0)
ENU(Y) ;Get IV additive strength.
"RTN","PSIVUTL1",22,0)
 N X S X=$P(^PS(52.6,+Y,0),U,3),Y=$$CODES^PSIVUTL(X,52.6,2)
"RTN","PSIVUTL1",23,0)
 Q Y
"RTN","PSIVUTL1",24,0)
 ;
"RTN","PSIVUTL1",25,0)
CODES(X,Y) ; Get name from code.
"RTN","PSIVUTL1",26,0)
 S Y=$P($P(";"_$P(Y,U,3),";"_X_":",2),";")
"RTN","PSIVUTL1",27,0)
 Q Y
"RTN","PSIVUTL1",28,0)
 ;
"RTN","PSIVUTL1",29,0)
GTPCI(Y) ; Set up "work" area for provider comments.
"RTN","PSIVUTL1",30,0)
 N DIC,DINUM,DLAYGO,X S DIC="^PS(53.45,",DIC(0)="LNZ",DLAYGO=53.45,(DINUM,X)=+DUZ D ^DIC
"RTN","PSIVUTL1",31,0)
 Q Y
"RTN","PSIVUTL1",32,0)
 ;
"RTN","PSIVUTL1",33,0)
WDTE(Y) ; Format and print date.
"RTN","PSIVUTL1",34,0)
 I 'Y S Y="******"
"RTN","PSIVUTL1",35,0)
 E  X ^DD("DD") S Y=$P(Y,"@")_" "_$P($P(Y,"@",2),":",1,2)
"RTN","PSIVUTL1",36,0)
 Q Y
"RTN","PSIVUTL1",37,0)
GTOT(DFN,ON) ; Get order type for display.
"RTN","PSIVUTL1",38,0)
 N DRGT,DRGI,Y
"RTN","PSIVUTL1",39,0)
 S X=$P($G(^PS(55,DFN,"IV",ON,0)),U,4)
"RTN","PSIVUTL1",40,0)
 S Y=$S(X="A":"F",X="H":"H",1:"I")
"RTN","PSIVUTL1",41,0)
 I Y="F" F DRGT="AD","SOL" F DRGI=0:0 S DRGI=$O(^PS(55,DFN,"IV",+ON,DRGT,DRGI)) Q:'DRGI  I '$P($G(^PS(55,DFN,"IV",+ON,DRGT,DRGI)),U,5) S Y="I" Q
"RTN","PSIVUTL1",42,0)
 Q Y
"RTN","PSIVUTL1",43,0)
 ;
"RTN","PSIVUTL1",44,0)
PIV(ON) ; Display IV orders.
"RTN","PSIVUTL1",45,0)
 N DRG,ON55,P,PSJORIFN,TYP,X,Y S TYP="?" I ON["V" D
"RTN","PSIVUTL1",46,0)
 .S Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,4,5,8,9,17,23 S P(X)=$P(Y,U,X)
"RTN","PSIVUTL1",47,0)
 .S TYP=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I TYP'="O" S TYP="C"
"RTN","PSIVUTL1",48,0)
 .S ON55=ON,P("OT")=$S(P(4)="A":"F",P(4)="H":"H",1:"I") D GTDRG^PSIVORFB,GTOT^PSIVUTL(P(4))
"RTN","PSIVUTL1",49,0)
 I ON'["V" S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+ON,0)),U,9),Y=$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U) D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4)) I $E(P("OT"))="I"  D  Q
"RTN","PSIVUTL1",50,0)
 .S P("PD")=$P($$DRUGNAME^PSJLMUTL(PSGP,ON),"^"),P("DO")=$S($P(DN,"^",2)=.2:$P($G(^PS(55,PSGP,5,+PSJO,.2)),"^",2),1:$G(^PS(55,PSGP,5,+PSJO,.3))),P("DO")=$P(P("DO"),"^")
"RTN","PSIVUTL1",51,0)
 .S Y=$G(^PS(53.1,+ON,.2)),P("MR")=$P($G(^PS(53.1,+ON,0)),U,3)_U_$P($G(^PS(51.2,+$P($G(^PS(53.1,+ON,0)),U,3),0)),U,3)
"RTN","PSIVUTL1",52,0)
 .W ?9,P("PD") D PIV1 W !?11,"Give: ",P("DO")," ",$P(P("MR"),U,2)," ",$S(P(9)]"":P(9),1:P(8))
"RTN","PSIVUTL1",53,0)
 S DRG=0 F  S DRG=$O(DRG("AD",DRG)) Q:'DRG  D PIVAD
"RTN","PSIVUTL1",54,0)
SOL ;
"RTN","PSIVUTL1",55,0)
 NEW NAME
"RTN","PSIVUTL1",56,0)
 S DRG=0 F  S DRG=$O(DRG("SOL",DRG)) Q:'DRG  D
"RTN","PSIVUTL1",57,0)
 . D NAME(DRG("SOL",DRG),39,.NAME,0)
"RTN","PSIVUTL1",58,0)
 . W ! W:DRG=1 ?9,"in "
"RTN","PSIVUTL1",59,0)
 . F X=0:0 S X=$O(NAME(X)) Q:'X  W ?12 W NAME(X) I X=1,DRG=1,'$D(DRG("AD",1)) D PIV1
"RTN","PSIVUTL1",60,0)
 Q
"RTN","PSIVUTL1",61,0)
PIVAD ; Print IV Additives.
"RTN","PSIVUTL1",62,0)
 NEW NAME
"RTN","PSIVUTL1",63,0)
 D NAME(DRG("AD",DRG),39,.NAME,1)
"RTN","PSIVUTL1",64,0)
 F X=0:0 S X=$O(NAME(X)) Q:'X  W:DRG'=1 ! W ?9,NAME(X) I X=1,DRG=1 D PIV1
"RTN","PSIVUTL1",65,0)
 Q
"RTN","PSIVUTL1",66,0)
 ;
"RTN","PSIVUTL1",67,0)
PIV1 ; Print Sched type, start/stop dates, and status.
"RTN","PSIVUTL1",68,0)
 F X=2,3 S P(X)=$E($$ENDTC^PSGMI(P(X)),1,$S($D(PSJEXTP):8,1:5))
"RTN","PSIVUTL1",69,0)
 I '$D(PSJEXTP) W ?50,TYP,?53,P(2),?60,P(3),?67,P(17) Q
"RTN","PSIVUTL1",70,0)
 W ?50,TYP,?53,P(2),?63,P(3),?73,P(17)
"RTN","PSIVUTL1",71,0)
 Q
"RTN","PSIVUTL1",72,0)
59 ; Validate the Infusion rate entered using IV Quick order code.
"RTN","PSIVUTL1",73,0)
 N I F I=2,3,5,7,8,9,11,15,23 S P(I)=""
"RTN","PSIVUTL1",74,0)
 S P(4)="A",P(8)=$P($G(^PS(57.1,PSJQO,1)),U,5)
"RTN","PSIVUTL1",75,0)
 I $G(^PS(57.1,PSJQO,4,1,0)) S DRG("SOL",1)=^(0),DRG("SOL",0)=1
"RTN","PSIVUTL1",76,0)
 I X["?" S F1=53.1,F2=59 D ENHLP^PSIVORC1 G 59
"RTN","PSIVUTL1",77,0)
 I X]"" D ENI^PSIVSP S:$D(X) P(8)=X
"RTN","PSIVUTL1",78,0)
 Q
"RTN","PSIVUTL1",79,0)
WRTDRG(X,L)       ; Format and print drug name, strength and bottle no.
"RTN","PSIVUTL1",80,0)
 N Y S Y=" "_$P(X,U,3) S:$P(X,U,4) Y=Y_" ("_$P(X,U,4)_")"
"RTN","PSIVUTL1",81,0)
 Q $E($P(X,U,2),1,(L-$L(Y)))_Y
"RTN","PSIVUTL1",82,0)
NAME(X,L,NAME,AD)        ; Format Additive display.
"RTN","PSIVUTL1",83,0)
 ;INPUT : X=DRG("AD",DRG)  L=Display length   AD=for Addtive(1/0)
"RTN","PSIVUTL1",84,0)
 ;OUTPUT: AD(X)  if X=2 that means there is a second line to display
"RTN","PSIVUTL1",85,0)
 K NAME
"RTN","PSIVUTL1",86,0)
 NEW Y S Y=$P(X,U,3) S:(AD&$P(X,U,4)) Y=Y_" ("_$P(X,U,4)_")"
"RTN","PSIVUTL1",87,0)
 S:'AD Y=Y_" "_$S(P(4)="P"!($G(P(23))="P")!$G(P(5)):P(9),1:$P(P(8),"@"))
"RTN","PSIVUTL1",88,0)
 I ($L($P(X,U,2))+$L(Y)+1)>L S NAME(1)=$P(X,U,2),NAME(2)="   "_Y Q
"RTN","PSIVUTL1",89,0)
 S NAME(1)=$P(X,U,2)_" "_Y
"RTN","PSIVUTL1",90,0)
 Q
"RTN","PSIVUTL1",91,0)
 ;
"RTN","PSIVUTL1",92,0)
CNVTOM(RATE,TVOL) ; Convert volume to minutes
"RTN","PSIVUTL1",93,0)
 ; Input:
"RTN","PSIVUTL1",94,0)
 ;   RATE - Infusion Rate
"RTN","PSIVUTL1",95,0)
 ;   TVOL - Volume being infused, EX: m100 (100 Milliliters) or l5 (5 Liters)
"RTN","PSIVUTL1",96,0)
 ; Output:
"RTN","PSIVUTL1",97,0)
 ;   MINS - Minutes required to infuse volume
"RTN","PSIVUTL1",98,0)
 N DAYS,ML,MLSHR
"RTN","PSIVUTL1",99,0)
 ; Get rate in terms of mils per hour
"RTN","PSIVUTL1",100,0)
 I 'RATE Q 0
"RTN","PSIVUTL1",101,0)
 I RATE<1 S RATE=1
"RTN","PSIVUTL1",102,0)
 S TVOL=$S($E(TVOL)="m":$E(TVOL,2,9),$E(TVOL)="l":$E(TVOL,2,9)*1000,1:0) Q:'TVOL 0
"RTN","PSIVUTL1",103,0)
 ; Find IV duration in minutes
"RTN","PSIVUTL1",104,0)
 S MINS=(TVOL/RATE)*60
"RTN","PSIVUTL1",105,0)
 Q MINS
"RTN","PSIVUTL1",106,0)
 ;
"RTN","PSIVUTL1",107,0)
GETMIN(LIM,DFN,PSJORD,DAYS) ;
"RTN","PSIVUTL1",108,0)
 N F,DDLX
"RTN","PSIVUTL1",109,0)
 I LIM!(LIM=0) Q LIM
"RTN","PSIVUTL1",110,0)
 S F=$S(PSJORD["P":"^PS(53.1,+PSJORD,",PSJORD["V":"^PS(55,DFN,""IV"",+PSJORD,",1:"")
"RTN","PSIVUTL1",111,0)
 N RATE S RATE=$S(PSJORD["P":+$P($G(@(F_"8)")),"^",5),PSJORD["V":+$P($G(@(F_"0)")),"^",8),1:0)
"RTN","PSIVUTL1",112,0)
 I (",l,m,")[(","_$E(LIM)_",") D
"RTN","PSIVUTL1",113,0)
 .I RATE D
"RTN","PSIVUTL1",114,0)
 ..I RATE<1 S RATE=1
"RTN","PSIVUTL1",115,0)
 ..S MIN=$$CNVTOM(RATE,LIM) I MIN S LIM=MIN
"RTN","PSIVUTL1",116,0)
 .I 'RATE N SOL,SOLVOL,DOSVOL,DUR,STOP,OIX,X S (SOLVOL,DOSVOL)="" D
"RTN","PSIVUTL1",117,0)
 ..S SOL=0 F  S SOL=$O(@(F_"""SOL"",SOL)")) Q:'SOL  D
"RTN","PSIVUTL1",118,0)
 ...S SOLVOL=$P(@(F_"""SOL"",SOL,0)"),"^",2) I SOLVOL S DOSVOL=DOSVOL+SOLVOL
"RTN","PSIVUTL1",119,0)
 ..S DDLX=$S($E(LIM)["l":(($E(LIM,2,99)*1000)/DOSVOL),1:($E(LIM,2,99)/DOSVOL))_"L"
"RTN","PSIVUTL1",120,0)
 I (",a,")[(","_$E(LIM)_",") S DDLX=$E(LIM,2,99)_"L"
"RTN","PSIVUTL1",121,0)
 I $G(DDLX)>0 D
"RTN","PSIVUTL1",122,0)
 .N STOP,LASTD S DAYS="",STOP=""
"RTN","PSIVUTL1",123,0)
 .S OIX=$P($G(@(F_".2)")),"^") S:(DDLX<1) DDLX="1L" S LASTD=$$DOSES^PSIVCAL(DDLX,.P)
"RTN","PSIVUTL1",124,0)
 .I LASTD,$G(P(2)) S DAYS=$$FMDIFF^XLFDT(LASTD,P(2),2) I DAYS>0 S DAYS=DAYS/86400
"RTN","PSIVUTL1",125,0)
 .I DAYS>0 S LIM=DAYS*1440
"RTN","PSIVUTL1",126,0)
 I (",h,d,")[(","_$E(LIM)_",") S LIM=$S($E(LIM)="d":(1440*$E(LIM,2,99)),1:(60*$E(LIM,2,99))) Q
"RTN","PSIVUTL1",127,0)
 Q LIM
"RTN","PSJHL2")
0^27^B36875797
"RTN","PSJHL2",1,0)
PSJHL2 ;BIR/RLW-PATIENT ID AND VISIT SEGMENTS ;22 Nov 1999  9:27 AM
"RTN","PSJHL2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,18,16,23,28,42,50,70,58,100,102,110,111,112,144,141,134**;16 DEC 97;Build 124
"RTN","PSJHL2",3,0)
 ;
"RTN","PSJHL2",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL2",5,0)
 ; Reference to ^ORERR is supported by DBIA# 2187.
"RTN","PSJHL2",6,0)
 ; Reference to ^ORHLESC IS supported by DBIA# 4922.
"RTN","PSJHL2",7,0)
 ;
"RTN","PSJHL2",8,0)
EN1(PSJHLDFN,PSOC,PSJORDER,PSREASON) ; start here
"RTN","PSJHL2",9,0)
 ; passed in are PSJHLDFN (patient ien)
"RTN","PSJHL2",10,0)
 ;               PSJORDER* (order_file (N,P,V, etc))
"RTN","PSJHL2",11,0)
 ;               PSOC* (order control code - NW for new order, OK to return filler number to OE/RR, OC for order canceled, SC for status change)
"RTN","PSJHL2",12,0)
 ;               PSREASON* (text reason)
"RTN","PSJHL2",13,0)
 ; *=optional, only required if an order segment is also to be generated
"RTN","PSJHL2",14,0)
START ;
"RTN","PSJHL2",15,0)
 K ^TMP("PSJHLS",$J,"PS")
"RTN","PSJHL2",16,0)
 N CLERK,J,LIMIT,NAME,NEXT,NODE1,NODE2,NODE4,NOO,PSJCLEAR,PSJHINST,PSJHLSDT,PROVIDER,PSJI,ROOMBED,RXORDER,STATUS,UNDO,VERIFY,WARD,PSGST,DUR
"RTN","PSJHL2",17,0)
 S RXORDER=PSJORDER,PSJORDER=$S((PSJORDER["N")!(PSJORDER["P"):"^PS(53.1,"_+PSJORDER,PSJORDER["V":"^PS(55,"_PSJHLDFN_",""IV"","_+PSJORDER,1:"^PS(55,"_PSJHLDFN_",5,"_+PSJORDER)_","
"RTN","PSJHL2",18,0)
 I RXORDER["P",$P($G(@(PSJORDER_"0)")),U,15)'=PSJHLDFN S ORDCON="Patient does not match/PSJHL2" S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(ORDCON) Q
"RTN","PSJHL2",19,0)
 S UNDO=$S("OC^CR"[PSOC:1,1:0)
"RTN","PSJHL2",20,0)
 D INIT,PID,PV1,ORC
"RTN","PSJHL2",21,0)
 D @$S("SN^SC^OC^OD^DR^CR^OH^OR^XX^ZC^XR"[PSOC:"EN1^PSJHL3(PSJHLDFN,PSOC,PSJORDER)",1:"CALL^PSJHLU(PSJI)")
"RTN","PSJHL2",22,0)
 I UNDO D UNDO
"RTN","PSJHL2",23,0)
 K ^TMP("PSJHLS",$J,"PS"),FIELD
"RTN","PSJHL2",24,0)
 Q
"RTN","PSJHL2",25,0)
 ;
"RTN","PSJHL2",26,0)
INIT ; initialize HL7 variables, set master file identification segment
"RTN","PSJHL2",27,0)
 ; PSJHLMTN = message type - ORR for messages sent as a response to an OE/RR event; ORM for "unsolicited" messages.
"RTN","PSJHL2",28,0)
 S PSJI=0,PSJHLMTN=$S($G(PSJHLMTN)]"":PSJHLMTN,1:"ORM")
"RTN","PSJHL2",29,0)
 D INIT^PSJHLU
"RTN","PSJHL2",30,0)
 S LIMIT=17 X PSJCLEAR
"RTN","PSJHL2",31,0)
 S FIELD(0)="MSH",FIELD(1)="^~\&",FIELD(2)="PHARMACY",FIELD(3)=$G(PSJHINST),FIELD(8)=PSJHLMTN
"RTN","PSJHL2",32,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY
"RTN","PSJHL2",33,0)
 Q
"RTN","PSJHL2",34,0)
 ;
"RTN","PSJHL2",35,0)
PID ; get patient data, format PID SEGMENT
"RTN","PSJHL2",36,0)
 S LIMIT=22 X PSJCLEAR
"RTN","PSJHL2",37,0)
 S FIELD(0)="PID"
"RTN","PSJHL2",38,0)
 S FIELD(3)=PSJHLDFN
"RTN","PSJHL2",39,0)
 N DFN S DFN=PSJHLDFN D DEM^VADPT S FIELD(5)=VADM(1)
"RTN","PSJHL2",40,0)
 I '$G(PSJBCBU) S FIELD(5)=$$ESC^ORHLESC(FIELD(5))
"RTN","PSJHL2",41,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY
"RTN","PSJHL2",42,0)
 Q
"RTN","PSJHL2",43,0)
 ;
"RTN","PSJHL2",44,0)
PV1 ; get patient visit information, format PV1 segment
"RTN","PSJHL2",45,0)
 N PSJAPPT
"RTN","PSJHL2",46,0)
 S LIMIT=50 X PSJCLEAR
"RTN","PSJHL2",47,0)
 S FIELD(0)="PV1"
"RTN","PSJHL2",48,0)
 I PSJHLMTN="ORR" S FIELD(3)=LOC
"RTN","PSJHL2",49,0)
 I PSJHLMTN="ORM" D
"RTN","PSJHL2",50,0)
 .S LOC="",WARD=$G(^DPT(PSJHLDFN,.1)),LOC=$S($G(WARD)]"":$O(^SC("B",WARD,LOC)),1:LOC)
"RTN","PSJHL2",51,0)
 .I $G(LOC)="" D
"RTN","PSJHL2",52,0)
 .. N A
"RTN","PSJHL2",53,0)
 .. I RXORDER["P",($G(^PS(53.1,+RXORDER,"DSS"))) S A=^("DSS"),LOC=$P(A,"^"),PSJAPPT=$P(A,"^",2)
"RTN","PSJHL2",54,0)
 .. I RXORDER["V",($G(^PS(55,PSJHLDFN,"IV",+RXORDER,"DSS"))) S A=^("DSS"),LOC=$P(A,"^"),PSJAPPT=$P(A,"^",2)
"RTN","PSJHL2",55,0)
 .. I RXORDER["U",$G(^PS(55,PSJHLDFN,5,+RXORDER,8)) S A=^(8),LOC=$P(A,"^"),PSJAPPT=$P(A,"^",2)
"RTN","PSJHL2",56,0)
 .I $G(LOC)]"" S ROOMBED=$G(^DPT(PSJHLDFN,.101)) S LOC=LOC_"^"_$S($G(PSJBCBU):ROOMBED,1:$$ESC^ORHLESC(ROOMBED))
"RTN","PSJHL2",57,0)
 .S FIELD(3)=LOC I $G(PSJAPPT)]"" S FIELD(44)=$$FMTHL7^XLFDT(PSJAPPT)
"RTN","PSJHL2",58,0)
 S FIELD(2)=$S($G(CLASS)="O":CLASS,1:"I")
"RTN","PSJHL2",59,0)
 I FIELD(2)="I" N DFN S DFN=PSJHLDFN D INP^VADPT S FIELD(19)=VAIN(1)
"RTN","PSJHL2",60,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY
"RTN","PSJHL2",61,0)
 Q
"RTN","PSJHL2",62,0)
 ;
"RTN","PSJHL2",63,0)
ORC ; order control segment
"RTN","PSJHL2",64,0)
 S LIMIT=18 X PSJCLEAR
"RTN","PSJHL2",65,0)
 Q:'$D(PSJORDER)!'$D(PSOC)
"RTN","PSJHL2",66,0)
 S NODE1=$G(@(PSJORDER_"0)")),NODE2=$G(@(PSJORDER_"2)"))
"RTN","PSJHL2",67,0)
 S NODE4=$G(@(PSJORDER_"4)"))
"RTN","PSJHL2",68,0)
 I $G(PSGST)="" N PSGST D
"RTN","PSJHL2",69,0)
 .S PSGST=$P($G(NODE1),"^",7)
"RTN","PSJHL2",70,0)
 S FIELD(0)="ORC"
"RTN","PSJHL2",71,0)
 S FIELD(1)=PSOC
"RTN","PSJHL2",72,0)
 S FIELD(2)=$S(PSOC="SN":"",1:$P(NODE1,"^",21))_"^OR" I $P(FIELD(2),"^")=0 S $P(FIELD(2),"^")="" ; IV orders are created with a zero in the oerr order number, for some reason
"RTN","PSJHL2",73,0)
 S FIELD(3)=RXORDER_"^PS"
"RTN","PSJHL2",74,0)
 ; translate Pharmacy status code to HL7 status code, set in FIELD(5)
"RTN","PSJHL2",75,0)
 S STATUS=$S($G(PSJEXPOE):"E",(($P(NODE1,"^",17)]"")&(RXORDER["V")):($P(NODE1,"^",17)),($P(NODE1,"^",9)]""):$P(NODE1,"^",9),$G(PSIVCOPY):"DE",1:"")
"RTN","PSJHL2",76,0)
 ;BHW;Remedy HD0000000086717;If the order has a pending number, send pending status even if current status is Active.
"RTN","PSJHL2",77,0)
 I STATUS="A",RXORDER["P" S STATUS="N" D @STATUS S STATUS="A"
"RTN","PSJHL2",78,0)
 E  D @STATUS
"RTN","PSJHL2",79,0)
 I STATUS="U",RXORDER["P" S FIELD(3)="^PS"
"RTN","PSJHL2",80,0)
 S FIELD(7)="^"_$S(RXORDER["V":$P(NODE1,"^",9)_"&"_$P(NODE1,"^",11),1:$P(NODE2,"^")_"&"_$P(NODE2,"^",5))_"^^^^^"_$G(PSGST)
"RTN","PSJHL2",81,0)
 S FIELD(9)=$S(RXORDER["V":$$FMTHL7^XLFDT($P(NODE2,"^")),1:$$FMTHL7^XLFDT($P(NODE1,"^",16)))
"RTN","PSJHL2",82,0)
 S CLERK=$S(RXORDER["V":$P(NODE2,"^",11),1:$P(NODE4,"^",7))
"RTN","PSJHL2",83,0)
 S NAME=$P($G(^VA(200,+CLERK,0)),"^")
"RTN","PSJHL2",84,0)
 S FIELD(10)=CLERK_"^"_$S($G(PSJBCBU):NAME,1:$$ESC^ORHLESC(NAME))
"RTN","PSJHL2",85,0)
 I PSOC="ZV"!($G(PSJBCBU)) S VERIFY=$P($G(NODE4),"^"),FIELD(11)=VERIFY_"^"_$S($G(PSJBCBU):$P($G(^VA(200,+VERIFY,0)),"^"),1:$$ESC^ORHLESC($P($G(^VA(200,+VERIFY,0)),"^"))),FIELD(9)=$$FMTHL7^XLFDT($P(NODE4,"^",2))
"RTN","PSJHL2",86,0)
 S PROVIDER=$S($G(PSJDCPRV)]"":$G(PSJDCPRV),RXORDER["V":$P(NODE1,"^",6),1:$P(NODE1,"^",2)) K PSJDCPRV
"RTN","PSJHL2",87,0)
 S NAME=$P($G(^VA(200,+PROVIDER,0)),"^")
"RTN","PSJHL2",88,0)
 S FIELD(12)=PROVIDER_"^"_NAME
"RTN","PSJHL2",89,0)
 S FIELD(15)=$S(RXORDER["V":$$FMTHL7^XLFDT($P(NODE1,"^",2)),1:$$FMTHL7^XLFDT($P(NODE2,"^",2)))
"RTN","PSJHL2",90,0)
 I $S(RXORDER["V":$P(NODE2,"^",8)="R",1:$P(NODE1,"^",24)="R")
"RTN","PSJHL2",91,0)
 ; PSJ*5*141 - If this is a renewal order, update FIELD(10) with the person who entered the renewal order.
"RTN","PSJHL2",92,0)
 N FIELD9 S FIELD9=$$FMTHL7^XLFDT($$LASTREN^PSJLMPRI(PSJHLDFN,RXORDER)) I FIELD9>FIELD(9) S FIELD(9)=FIELD9,FIELD(15)=FIELD9,FIELD(10)=$$LASTRNBY^PSJLMPRI(PSJHLDFN,RXORDER)
"RTN","PSJHL2",93,0)
 S NOO=$S(PSJORDER["IV":$G(P("NAT")),(($G(PSJNOO)="")&($G(P("NAT"))]"")):$G(P("NAT")),1:$G(PSJNOO)),PSREASON=$S(NOO="D":"",1:$G(PSREASON))
"RTN","PSJHL2",94,0)
 S FIELD(16)=NOO_U_$S(NOO="P":"Telephoned",NOO="D":"Duplicate",NOO="X":"Rejected",NOO="A":"Auto",NOO="S":"Service Correction",NOO="W":"Written",NOO="V":"Verbal",NOO="E":"Physician Entered",NOO="I":"Policy",1:"")_U_"99ORN"_U_U_$G(PSREASON)_U
"RTN","PSJHL2",95,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY
"RTN","PSJHL2",96,0)
 Q
"RTN","PSJHL2",97,0)
 ;
"RTN","PSJHL2",98,0)
DISPLAY ; just for testing
"RTN","PSJHL2",99,0)
 I $G(MSGTEST) W ! F NEXT=0:1:LIMIT W FIELD(NEXT)_"|"
"RTN","PSJHL2",100,0)
 Q
"RTN","PSJHL2",101,0)
UNDO ;Undo Renew if Pending Renewal is dc'd
"RTN","PSJHL2",102,0)
 I RXORDER["P",(STATUS="D"),($G(PSJNOO)'="A"),($P(NODE1,U,24)="R") D ENBKOUT^PSJOREN(PSJHLDFN,RXORDER)
"RTN","PSJHL2",103,0)
 Q
"RTN","PSJHL2",104,0)
 ;
"RTN","PSJHL2",105,0)
A S FIELD(5)="CM" Q  ; active
"RTN","PSJHL2",106,0)
D S FIELD(5)="DC" Q  ; discontinued
"RTN","PSJHL2",107,0)
I S FIELD(5)="IP" Q  ; incomplete
"RTN","PSJHL2",108,0)
N S FIELD(5)="IP" Q  ; non-verified
"RTN","PSJHL2",109,0)
U S FIELD(5)="ZX" Q  ; unreleased
"RTN","PSJHL2",110,0)
P S FIELD(5)="IP" Q  ; pending
"RTN","PSJHL2",111,0)
DE S FIELD(5)="RP" Q  ; discontinued (edit)
"RTN","PSJHL2",112,0)
E S FIELD(5)="ZE" Q  ; expired
"RTN","PSJHL2",113,0)
H S FIELD(5)="HD" Q  ; hold
"RTN","PSJHL2",114,0)
R S FIELD(5)="ZZ" Q  ; renewed
"RTN","PSJHL2",115,0)
RE S FIELD(5)="CM" Q  ; reinstated
"RTN","PSJHL2",116,0)
DR S FIELD(5)="DC" Q  ; discontinued (renewal)
"RTN","PSJHL2",117,0)
O S FIELD(5)="HD" Q  ; on call (is this kind of like HOLD?)
"RTN","PSJHL3")
0^4^B65300768
"RTN","PSJHL3",1,0)
PSJHL3 ;BIR/RLW-PHARMACY ORDER SEGMENTS ;04 Aug 98 / 10:10 AM
"RTN","PSJHL3",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,11,14,40,42,47,50,56,58,92,101,102,123,110,111,152,134**;16 DEC 97;Build 124
"RTN","PSJHL3",3,0)
 ;
"RTN","PSJHL3",4,0)
 ; Reference to ^PS(50.606 is supported by DBIA# 2174.
"RTN","PSJHL3",5,0)
 ; Reference to ^PS(50.607 is supported by DBIA# 2221.        
"RTN","PSJHL3",6,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJHL3",7,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJHL3",8,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJHL3",9,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJHL3",10,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL3",11,0)
 ; Reference to ^PSDRUG( is supported by DBIA# 2192.
"RTN","PSJHL3",12,0)
 ; Reference to ^PSNDF( is supported by DBIA# 2195.
"RTN","PSJHL3",13,0)
 ; Reference to ^VA(200 is supported by DBIA# 10060.
"RTN","PSJHL3",14,0)
 ; Reference to ^PSNAPIS is supported by DBIA# 2531.
"RTN","PSJHL3",15,0)
 ; Reference to ^XLFDT is supported by DBIA# 10103.
"RTN","PSJHL3",16,0)
 ; Reference to ^PSSUTIL1 is supported by DBIA# 3179.
"RTN","PSJHL3",17,0)
 ; Reference to ^ORHLESC is supported by DBIA# 4922.
"RTN","PSJHL3",18,0)
 ;
"RTN","PSJHL3",19,0)
EN1(PSJHLDFN,PSOC,PSJORDER) ; start here
"RTN","PSJHL3",20,0)
 ; passed in are PSJHLDFN (patient ien)
"RTN","PSJHL3",21,0)
 ;               PSJORDER (file root of order)
"RTN","PSJHL3",22,0)
 ;               OC (order control code - NW for new order, OK for finished order, OC for order canceled)
"RTN","PSJHL3",23,0)
 I $G(PSJHLDFN)']""!$G(PSOC)']""!$G(PSJORDER)']"" W !,"INSUFFICIENT DATA FOR ^PSJHL3" Q
"RTN","PSJHL3",24,0)
 N COMMENTS,DDIEA,DDNUM,DOSE,DOSEFORM,DOSEOR,NAME,DURATION,IVTYPE,NODE1,NODE2,NDNODE,OINODE,PSGPLS,PSGPLF,PRODNAME,SPDIEN,UNIT,UNITS,CNT,DDIEN,SCHEDULE,PSGST
"RTN","PSJHL3",25,0)
 D INIT
"RTN","PSJHL3",26,0)
 S IVTYPE=$S(RXORDER["U":"",1:$$IVTYPE^PSJHLU(PSJORDER))
"RTN","PSJHL3",27,0)
 D RXO,RXE,RXR D ZRX
"RTN","PSJHL3",28,0)
 D CALL^PSJHLU(PSJI)
"RTN","PSJHL3",29,0)
 Q
"RTN","PSJHL3",30,0)
INIT ; initialize HL7 variables
"RTN","PSJHL3",31,0)
 D INIT^PSJHLU
"RTN","PSJHL3",32,0)
 Q
"RTN","PSJHL3",33,0)
RXO ; pharmacy prescription order segment (used to send Orderable Item to OE/RR)
"RTN","PSJHL3",34,0)
 S LIMIT=17 X PSJCLEAR
"RTN","PSJHL3",35,0)
 S FIELD(0)="RXO"
"RTN","PSJHL3",36,0)
 S OINODE=$G(@(PSJORDER_".2)"))
"RTN","PSJHL3",37,0)
 S SPDIEN=+$P(OINODE,"^"),DOSEOR=$$ESC^ORHLESC($P(OINODE,"^",2)),DOSE=$P(OINODE,"^",5),UNIT=$P(OINODE,"^",6) S:'$G(PSJBCBU) UNIT=$$ESC^ORHLESC(UNIT)
"RTN","PSJHL3",38,0)
 S FIELD(1)=$S(SPDIEN=0:"^^^^",1:"^^^"_SPDIEN_"^")
"RTN","PSJHL3",39,0)
 I SPDIEN S DOSEFORM=$P($G(^PS(50.7,SPDIEN,0)),"^",2),NAME=$P($G(^PS(50.606,+DOSEFORM,0)),"^") S:'$G(PSJBCBU) NAME=$$ESC^ORHLESC(NAME) S FIELD(1)=FIELD(1)_$$ESC^ORHLESC($P($G(^PS(50.7,SPDIEN,0)),"^"))_" "_NAME
"RTN","PSJHL3",40,0)
 S FIELD(1)=FIELD(1)_"^99PSP"
"RTN","PSJHL3",41,0)
 N IVLNOD S IVLNOD=$G(@(PSJORDER_"2.5)")) D
"RTN","PSJHL3",42,0)
 .S IVLIM=$P(IVLNOD,"^",4) I IVLIM?1"a".N S IVLIM="doses"_$P(IVLIM,"a",2)
"RTN","PSJHL3",43,0)
 .S $P(FIELD(1),"^",3)=IVLIM
"RTN","PSJHL3",44,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",45,0)
 Q
"RTN","PSJHL3",46,0)
RXE ; pharmacy encoded order segment
"RTN","PSJHL3",47,0)
 S (UNITS,NDNODE,SPDIEN,PRODNAME,DDNUM,DDIEN,CNT)="",LIMIT=26 X PSJCLEAR
"RTN","PSJHL3",48,0)
 S FIELD(0)="RXE"
"RTN","PSJHL3",49,0)
 S NODE1=$G(@(PSJORDER_"0)")),NODE2=$G(@(PSJORDER_"2)")),NODEPT2=$G(@(PSJORDER_".2)"))
"RTN","PSJHL3",50,0)
  I $G(PSGST)="" N PSGST D
"RTN","PSJHL3",51,0)
 .I $G(RXORDER)["V" N X,ZZND,LYN,PSGS0XT,PSGS0Y,PSGOES S PSGOES=1 S X=$G(P(9)) I X]"" D EN^PSGS0 S:$G(ZZND)'="" PSGST=$P(ZZND,"^",5) Q
"RTN","PSJHL3",52,0)
 .S PSGST=$P($G(NODE1),"^",7)
"RTN","PSJHL3",53,0)
 I RXORDER["V" D IVRXE Q
"RTN","PSJHL3",54,0)
 I RXORDER["P",IVTYPE="F" D IVRXE Q
"RTN","PSJHL3",55,0)
 I RXORDER["P",$P(NODE1,"^",4)="H" D IVRXE Q
"RTN","PSJHL3",56,0)
 N RENEW S RENEW=$$LASTREN^PSJLMPRI(PSJHLDFN,RXORDER)
"RTN","PSJHL3",57,0)
 S PSGPLS=$S($G(PSJEXPOE):$P(NODE2,"^",2),RENEW>$P(NODE2,"^",2):RENEW,1:$P(NODE2,"^",2))
"RTN","PSJHL3",58,0)
 S PSGPLF=$S($G(PSJEXPOE):PSJEXPOE,1:$P(NODE2,"^",4))
"RTN","PSJHL3",59,0)
 S FIELD(1)="^"_$S($G(PSJBCBU):$P(NODE2,"^"),1:$$ESC^ORHLESC($P(NODE2,"^")))_"&"_$P(NODE2,"^",5)_"^^"_$$FMTHL7^XLFDT(PSGPLS)_"^"_$$FMTHL7^XLFDT(PSGPLF)_"^"_$P($G(NODEPT2),"^",4)_"^"_$G(PSGST)
"RTN","PSJHL3",60,0)
 S FIELD(21)="^"_$P(NODE2,"^",5)_"^99PSA^^^"
"RTN","PSJHL3",61,0)
 I ($G(DOSEOR)']"")!($O(@(PSJORDER_"1,"" "")"),-1)=1) D
"RTN","PSJHL3",62,0)
 .S (CNT,DDNUM)=0 F  S DDNUM=$O(@(PSJORDER_"1,"_DDNUM_")")) Q:'DDNUM  Q:CNT=1  S DDIEN=+$G(@(PSJORDER_"1,"_DDNUM_",0)")) D
"RTN","PSJHL3",63,0)
 ..S FIELD(1)=$S($P(@(PSJORDER_"1,"_DDNUM_",0)"),"^",2)="":"1",1:$P(@(PSJORDER_"1,"_DDNUM_",0)"),"^",2))_"&"_FIELD(1)
"RTN","PSJHL3",64,0)
 ..S FIELD(1)=DOSE_"&"_UNIT_"&"_FIELD(1),$P(FIELD(1),"^",8)=$S($G(DOSEOR)]"":$G(DOSEOR),1:DOSE_UNIT)
"RTN","PSJHL3",65,0)
 ..S:$P(FIELD(1),"^",8)="" $P(FIELD(1),"^",8)=$$ESC^ORHLESC($G(@(PSJORDER_".3)")))
"RTN","PSJHL3",66,0)
 ..S NDNODE=$G(^PSDRUG(DDIEN,"ND"))
"RTN","PSJHL3",67,0)
 ..;  CHANGE FOR NEW NDF CALL
"RTN","PSJHL3",68,0)
 ..S PRODNAME=$S($T(^PSNAPIS)]"":$$PROD0^PSNAPIS(+NDNODE,$P(NDNODE,"^",3)),$G(^PSNDF(+NDNODE,5,+$P(NDNODE,"^",3),0))]"":^(0),1:"N/A")
"RTN","PSJHL3",69,0)
 ..S:PRODNAME="" PRODNAME="N/A"
"RTN","PSJHL3",70,0)
 ..S FIELD(2)=$S(PRODNAME="N/A":"^^",1:+NDNODE_"."_+$P(NDNODE,"^",3)_"^"_$P(NDNODE,"^",2)_"^"_"99NDF")_"^"_DDIEN_"^"_$S($G(PSJBCBU):$P($G(^PSDRUG(DDIEN,0)),"^"),1:$$ESC^ORHLESC($P($G(^PSDRUG(DDIEN,0)),"^")))_"^"_"99PSD"
"RTN","PSJHL3",71,0)
 ..S UNITS=$S(PRODNAME="N/A":"N/A",1:$S($T(^PSNAPIS)]"":$P($$DFSU^PSNAPIS(+NDNODE,$P(NDNODE,"^",3)),"^",5),1:$P($G(^PSNDF(+NDNODE,2,+$P(PRODNAME,"^",2),3,+$P(PRODNAME,"^",3),4,+$P(PRODNAME,"^",4),0)),"^")))
"RTN","PSJHL3",72,0)
 ..S FIELD(5)="^^^"_$$ESC^ORHLESC(UNITS)_"^"_$$ESC^ORHLESC($P($G(^PS(50.607,UNITS,0)),"^"))_"^99PSU"
"RTN","PSJHL3",73,0)
 ..S FIELD(6)="^^^"_$$ESC^ORHLESC($G(DOSEFORM))_"^"_$$ESC^ORHLESC($P($G(^PS(50.606,+$G(DOSEFORM),0)),"^"))_"^99PSF"
"RTN","PSJHL3",74,0)
 ..S FIELD(25)=$$EN^PSSUTIL1(DDIEN),FIELD(26)=$P(FIELD(25),"|",2),FIELD(25)=$P(FIELD(25),"|")
"RTN","PSJHL3",75,0)
 ..I $P(FIELD(25),"^",5)]"" S $P(FIELD(25),"^",5)=$$ESC^ORHLESC($P(FIELD(25),"^",5))
"RTN","PSJHL3",76,0)
 ..S CNT=CNT+1
"RTN","PSJHL3",77,0)
 E  S $P(FIELD(1),"^",8)=$$ESC^ORHLESC(DOSEOR)
"RTN","PSJHL3",78,0)
 S NAME=$P($G(^VA(200,DUZ,0)),"^") S:'$G(PSJBCBU) NAME=$$ESC^ORHLESC(NAME) S FIELD(14)=DUZ_"^"_NAME_"^"_"99NP"
"RTN","PSJHL3",79,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",80,0)
 D SEGMENT2^PSJHLU
"RTN","PSJHL3",81,0)
 Q
"RTN","PSJHL3",82,0)
IVRXE ; RXE segment for IV orders
"RTN","PSJHL3",83,0)
 ; If an Inpatient Med IV order, send RXE w/dispense drug info.  
"RTN","PSJHL3",84,0)
 ; If an IV FLUID order, send start/stop date and duration in the RXE
"RTN","PSJHL3",85,0)
 ; and send an RXC for each additive and solution.
"RTN","PSJHL3",86,0)
 N ADSNODE
"RTN","PSJHL3",87,0)
 I RXORDER["V" S PSGPLS=$P(NODE1,"^",2),PSGPLF=$P(NODE1,"^",3)
"RTN","PSJHL3",88,0)
 E  S PSGPLS=$P(NODE2,"^",2),PSGPLF=$P(NODE2,"^",4)
"RTN","PSJHL3",89,0)
 S FIELD(1)="^"_$S(PSJORDER["IV":($P(NODE1,"^",9)_"&"_$P(NODE1,"^",11)),1:$P(NODE2,"^"))_"^^"_$$FMTHL7^XLFDT(PSGPLS)_"^"_$$FMTHL7^XLFDT(PSGPLF)_"^"_$G(P("PRY"))
"RTN","PSJHL3",90,0)
 S FIELD(21)="^"_$S(PSJORDER["IV":$P(NODE1,"^",11),1:$P(NODE2,"^",5))_"^99PSA^^^"
"RTN","PSJHL3",91,0)
 S NAME=$P($G(^VA(200,DUZ,0)),"^") S:'$G(PSJBCBU) NAME=$$ESC^ORHLESC(NAME)
"RTN","PSJHL3",92,0)
 S FIELD(14)=DUZ_"^"_NAME_"^"_"99NP"
"RTN","PSJHL3",93,0)
 N X,Y
"RTN","PSJHL3",94,0)
 I RXORDER["V" S INFUSE=$P(NODE1,"^",8)
"RTN","PSJHL3",95,0)
 E  S INFUSE=$P($G(@(PSJORDER_"8)")),"^",5)
"RTN","PSJHL3",96,0)
 I INFUSE?1N.N1" ml/hr" S FIELD(23)=+INFUSE,Y=$P(INFUSE,+INFUSE,2),Y=$$TRIM^XLFSTR(Y,"LR"," "),FIELD(24)="^^^^"_Y_"^PSU"
"RTN","PSJHL3",97,0)
 I FIELD(23)="",FIELD(24)="" S FIELD(23)=INFUSE
"RTN","PSJHL3",98,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",99,0)
 K SEGMENT I RXORDER["V" S JJ=0 F  S JJ=$O(@(PSJORDER_"5,"_JJ_")")) Q:'JJ  S SEGMENT(JJ-1)=$S($G(PSJBCBU):$G(@(PSJORDER_"5,"_JJ_",0)")),1:$$ESC^ORHLESC($G(@(PSJORDER_"5,"_JJ_",0)"))))
"RTN","PSJHL3",100,0)
 E  S JJ=0 F  S JJ=$O(@(PSJORDER_"12,"_JJ_")")) Q:'JJ  S SEGMENT(JJ-1)=$S($G(PSJBCBU):$G(@(PSJORDER_"12,"_JJ_",0)")),1:$G(@(PSJORDER_"12,"_JJ_",0)")))
"RTN","PSJHL3",101,0)
 I $D(SEGMENT(0)) S SEGMENT(0)="NTE|6|L|"_SEGMENT(0) D
"RTN","PSJHL3",102,0)
 .D SET^PSJHLU K SEGMENT,JJ
"RTN","PSJHL3",103,0)
 I RXORDER["V",$P($G(@(PSJORDER_"3)")),"^")]"" K SEGMENT D
"RTN","PSJHL3",104,0)
 .S SEGMENT(0)="NTE|21|L|"_$S($G(PSJSBCBU):$P($G(@(PSJORDER_"3)")),"^"),1:$$ESC^ORHLESC($P($G(@(PSJORDER_"3)")),"^"))) D
"RTN","PSJHL3",105,0)
 .D SET^PSJHLU K SEGMENT
"RTN","PSJHL3",106,0)
 I RXORDER["P",$P($G(@(PSJORDER_"9)")),U,2)]"" K SEGMENT D
"RTN","PSJHL3",107,0)
 .S SEGMENT(0)="NTE|21|L|"_$S($G(PSJSBCBU):$P($G(@(PSJORDER_"9)")),U,2),1:$$ESC^ORHLESC($P($G(@(PSJORDER_"9)")),U,2))) D
"RTN","PSJHL3",108,0)
 .D SET^PSJHLU K SEGMENT
"RTN","PSJHL3",109,0)
RXC ;component segments
"RTN","PSJHL3",110,0)
 N ADDITIVE,SOLUTION,SUB,TYPE,AD,SOL,PTR,NUM,UTMP,XTMP
"RTN","PSJHL3",111,0)
 S LIMIT=24 X PSJCLEAR
"RTN","PSJHL3",112,0)
 S FIELD(0)="RXC"
"RTN","PSJHL3",113,0)
 ; In the line below, the naked reference refers to the full global reference represented in PSJORDER_TYPE...
"RTN","PSJHL3",114,0)
 ; This could be a reference to either ^PS(53.1 or ^PS(55
"RTN","PSJHL3",115,0)
 S AD="AD",SOL="SOL" F TYPE="AD","SOL" S SUB=0 F  S SUB=$O(@(PSJORDER_TYPE_","_SUB_")")) Q:SUB=""  S NODE1=$G(^(SUB,0)) Q:NODE1=""  D
"RTN","PSJHL3",116,0)
 .S FIELD(1)=$S(TYPE="AD":"A",1:"B")
"RTN","PSJHL3",117,0)
 .S PTR=+$S(TYPE="AD":+$P($G(^PS(52.6,$P(NODE1,"^"),0)),"^",11),1:+$P($G(^PS(52.7,$P(NODE1,"^"),0)),"^",11))
"RTN","PSJHL3",118,0)
 .S FIELD(2)="^^^"_$S($G(PSJBCBU):+$P(NODE1,"^"),1:PTR)_"^"_$S($G(PSJBCBU):$S(TYPE="AD":$P($G(^PS(52.6,+$P(NODE1,"^"),0)),"^"),1:$P($G(^PS(52.7,+$P(NODE1,"^"),0)),"^")_" "_$P($G(^(0)),U,4)),1:$P($G(^PS(50.7,PTR,0)),"^"))
"RTN","PSJHL3",119,0)
 .S:(TYPE="AD"&$G(PSJBCBU)) FIELD(2)=FIELD(2)_$S($P(NODE1,"^",3)]"":" BOTTLE: "_$P(NODE1,"^",3),1:"")
"RTN","PSJHL3",120,0)
 .S FIELD(2)=FIELD(2)_"^99PSP"
"RTN","PSJHL3",121,0)
 .S FIELD(3)=$P($P(NODE1,"^",2)," ")
"RTN","PSJHL3",122,0)
 .S FIELD(4)=$P($P(NODE1,"^",2)," ",2)
"RTN","PSJHL3",123,0)
 .F XTMP=1:1:14 S UTMP($P("ML^LITER^MCG^MG^GM^UNITS^IU^MEQ^MM^MU^THOUU^MG-PE^NANOGRAM^MMOL","^",XTMP))="PSIV-"_XTMP
"RTN","PSJHL3",124,0)
 .S NUM="" S:FIELD(4)'="" NUM=$G(UTMP(FIELD(4)))
"RTN","PSJHL3",125,0)
 .S FIELD(4)="^^^"_NUM_"^"_FIELD(4)_"^99OTH"
"RTN","PSJHL3",126,0)
 .D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",127,0)
 Q
"RTN","PSJHL3",128,0)
RXR ; med route segment
"RTN","PSJHL3",129,0)
 S LIMIT=4 X PSJCLEAR
"RTN","PSJHL3",130,0)
 S FIELD(0)="RXR"
"RTN","PSJHL3",131,0)
 I PSJORDER["IV" S FIELD(1)="^^^"_$P($G(@(PSJORDER_".2)")),"^",3) Q:$P(FIELD(1),U,4)=""  D
"RTN","PSJHL3",132,0)
 .N PSJUNITS S PSJUNITS=$S($G(PSJBCBU):$P($G(^PS(51.2,+$P(FIELD(1),"^",4),0)),"^"),1:$$ESC^ORHLESC($P($G(^PS(51.2,+$P(FIELD(1),"^",4),0)),"^")))
"RTN","PSJHL3",133,0)
 .S FIELD(1)=FIELD(1)_"^"_PSJUNITS_"^99PSR"
"RTN","PSJHL3",134,0)
 .S:$G(PSJBCBU) FIELD(4)="^^^"_$P($G(@(PSJORDER_"0)")),"^",4)_"^"_$$CODES^PSIVUTL($P($G(@(PSJORDER_"0)")),"^",4),55.01,.04)_"^99PSR"
"RTN","PSJHL3",135,0)
 I PSJORDER[53.1 S FIELD(1)="^^^"_$P($G(@(PSJORDER_"0)")),"^",3) Q:$P(FIELD(1),U,4)=""  D
"RTN","PSJHL3",136,0)
 .N PSJUNITS S PSJUNITS=$S($G(PSJBCBU):$P($G(^PS(51.2,+$P(FIELD(1),"^",4),0)),"^"),1:$$ESC^ORHLESC($P($G(^PS(51.2,+$P(FIELD(1),"^",4),0)),"^")))
"RTN","PSJHL3",137,0)
 .S FIELD(1)=FIELD(1)_"^"_PSJUNITS_"^99PSR"
"RTN","PSJHL3",138,0)
 .S:$G(PSJBCBU) FIELD(4)="^^^"_$P($G(@(PSJORDER_"0)")),"^",4)_"^"_$$CODES^PSIVUTL($P($G(@(PSJORDER_"0)")),"^",4),53.1,4)_"^99PSR"
"RTN","PSJHL3",139,0)
 S:FIELD(1)="" FIELD(1)="^^^"_$P(NODE1,"^",3)_"^"_$S($G(PSJBCBU):$P($G(^PS(51.2,+$P(NODE1,"^",3),0)),"^"),1:$$ESC^ORHLESC($P($G(^PS(51.2,+$P(NODE1,"^",3),0)),"^")))_"^99PSR"
"RTN","PSJHL3",140,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",141,0)
 Q
"RTN","PSJHL3",142,0)
ZRX ; pharmacy Z-segment
"RTN","PSJHL3",143,0)
 D ZRX^PSJHLU
"RTN","PSJHL3",144,0)
 Q
"RTN","PSJHL3",145,0)
CNT ;Count dispense drugs for an order
"RTN","PSJHL3",146,0)
 S (CNT,DDNUM)=0 F  S DDNUM=$O(@(PSJORDER_"1,"_DDNUM_")")) Q:'DDNUM  S CNT=CNT+1
"RTN","PSJHL3",147,0)
 Q
"RTN","PSJHL4")
0^5^B72457593
"RTN","PSJHL4",1,0)
PSJHL4 ;BIR/RLW-DECODE HL7 /MESSSAGE FROM OE/RR ;16 Mar 99 / 4:55 PM
"RTN","PSJHL4",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,12,27,34,40,42,55,47,50,56,58,98,85,105,107,110,111,154,134**;16 DEC 97;Build 124
"RTN","PSJHL4",3,0)
 ; Reference to $$EN^PSOHLNEW is supported by DBIA# 2188.
"RTN","PSJHL4",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSJHL4",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJHL4",6,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJHL4",7,0)
 ; Reference to ^PS(59.7 supported by DBIA 2181.
"RTN","PSJHL4",8,0)
 ; Reference to ^ORHLESC is supported by DBIA 4922.
"RTN","PSJHL4",9,0)
 ; 
"RTN","PSJHL4",10,0)
EN(PSJMSG) ; Start
"RTN","PSJHL4",11,0)
 K ^TMP("PSJNVO",$J)
"RTN","PSJHL4",12,0)
 N ADCNT,SOLCNT,OCCNT
"RTN","PSJHL4",13,0)
 N ACKDATE,ADDITIVE,ADMINSTR,APPL,COMMENT,PSJHLDFN,DISPENSE,DOSE,DURATION,II,INSTR,J,JJ,JJJ,K,LOGIN,NEWORDER,NURSEACK,OBXFL,OCNARR,OCPROV,OCRSN,ORDER,PRIORITY,PSITEM,ORDCON,PROCOM,PSJORDER,PSREASON
"RTN","PSJHL4",14,0)
 N LOC,PROVIDER,PSPR,PSOC,PTR,QQ,REQST,ROUTE,RXON,RXORDER,SCHEDULE,SEGMENT,SOLUTION,STPDT,STRENGTH,TEXT,CLERK,INFRT,IVTYP,SCHTYP,PREON,NOO,ROC,FREQ,CLASS,PSJHLMTN,UNIT,UNITS,QFLG,VOLUME,TVOLUME,PSGP
"RTN","PSJHL4",15,0)
 N PSJASTP,FLDATE,FLCMNT,PSJFLAG,PSJYN,PRNTON,APPT,IVLIMIT,IVCAT,INTRMT
"RTN","PSJHL4",16,0)
 S (ADCNT,SOLCNT,OCCNT,II,TVOLUME)="",(OBXFL,QFLG)=0,PSJHLMTN="ORR" F  S II=$O(PSJMSG(II)) Q:'II  D DECODE Q:QFLG  D @FIELD(0) Q:$G(CLASS)="O"  Q:QFLG
"RTN","PSJHL4",17,0)
 I ($G(CLASS)'="I")!(QFLG) G END
"RTN","PSJHL4",18,0)
 I ($G(PSOC)="NW")!($G(PSOC)="XO") N DIK,DA S DIK="^PS(53.1,",DA=NEWORDER D EN1^DIK L -^PS(53.1,NEWORDER)
"RTN","PSJHL4",19,0)
 I ($G(PSOC)="NW")!($G(PSOC)="XO") D EN1^PSJHL2(PSJHLDFN,$S(PSOC="NW":"OK",1:"XR"),NEWORDER_"P")
"RTN","PSJHL4",20,0)
END ;
"RTN","PSJHL4",21,0)
 K ^TMP("PSJNVO",$J)
"RTN","PSJHL4",22,0)
 I (",S,A,")[(","_$G(PRIORITY)_",")!($G(SCHEDULE)="NOW")!($G(SCHEDULE)["STAT") D
"RTN","PSJHL4",23,0)
 . I $G(PRIORITY)="ZD",$G(PSGORD) D NOTIFY(PSGORD_$S(PSGORD["V":"V",PSGORD["U":"U",1:""),PSJHLDFN,$G(PRIORITY),$G(SCHEDULE))
"RTN","PSJHL4",24,0)
 . I $G(NEWORDER) D NOTIFY(NEWORDER_"P",PSJHLDFN,$G(PRIORITY),$G(SCHEDULE))
"RTN","PSJHL4",25,0)
 Q
"RTN","PSJHL4",26,0)
DECODE ; Parse into fields 
"RTN","PSJHL4",27,0)
 K FIELD
"RTN","PSJHL4",28,0)
 N PSJCTR1 S PSJCTR1=""
"RTN","PSJHL4",29,0)
 S SEGMENT=$G(PSJMSG(II))
"RTN","PSJHL4",30,0)
 I $D(PSJMSG(II,1)),$P(SEGMENT,"|",1)="ORC" F  S PSJCTR1=$O(PSJMSG(II,PSJCTR1)) Q:PSJCTR1=""  D
"RTN","PSJHL4",31,0)
 . S SEGMENT=SEGMENT_PSJMSG(II,PSJCTR1)  ;Handle CPRS "overflow" ORC nodes
"RTN","PSJHL4",32,0)
 S J=0
"RTN","PSJHL4",33,0)
 F  Q:$G(SEGMENT)=""  D
"RTN","PSJHL4",34,0)
 .I SEGMENT["|" S FIELD(J)=$P(SEGMENT,"|"),SEGMENT=$E(SEGMENT,$L(FIELD(J))+2,$L(SEGMENT)),J=J+1 Q
"RTN","PSJHL4",35,0)
 .I SEGMENT'["|" S FIELD(J)=SEGMENT,SEGMENT="" Q
"RTN","PSJHL4",36,0)
 K PSJCTR1
"RTN","PSJHL4",37,0)
 Q
"RTN","PSJHL4",38,0)
NOTIFY(ORDER,PSJHLDFN,PRIO,PSJSCHED) ; Send msg
"RTN","PSJHL4",39,0)
 N NTFYREAS,WARD,MGROUP,NTFSTAT,DRUG,DRIEN,PNAME,ORDATE,DO,PSG,XMY,VADPT,LASTFOUR,PSJSOK
"RTN","PSJHL4",40,0)
 Q:($G(PRIO)=""&($G(PSJSCHED)=""))
"RTN","PSJHL4",41,0)
 S DFN=PSJHLDFN D DEM^VADPT S LASTFOUR=$P($P(VADM(2),"^",2),"-",3)
"RTN","PSJHL4",42,0)
 S NTFYREAS=$S((",S,A,")[(","_PRIO_","):1,($G(PSJSCHED)="NOW"):2,($G(PSJSCHED)="STAT"):3,1:0) Q:'NTFYREAS
"RTN","PSJHL4",43,0)
 S PSJSOK=1
"RTN","PSJHL4",44,0)
 I ORDER["P" D PND
"RTN","PSJHL4",45,0)
 I ORDER["U" D UD
"RTN","PSJHL4",46,0)
 I ORDER["V" D IV
"RTN","PSJHL4",47,0)
 Q:PSJSOK=1
"RTN","PSJHL4",48,0)
 D XMD^PSJHL4A
"RTN","PSJHL4",49,0)
 Q
"RTN","PSJHL4",50,0)
PND ; Pending
"RTN","PSJHL4",51,0)
 N WARD,WDPARM,MGRP
"RTN","PSJHL4",52,0)
 Q:'$D(^PS(53.1,+ORDER,0))
"RTN","PSJHL4",53,0)
 S WARD=$G(^DPT(PSJHLDFN,.1)) I WARD]"" D
"RTN","PSJHL4",54,0)
 .N DIC,X,Y S DIC="^DIC(42,",DIC(0)="BOXZ",X=WARD D ^DIC S WARD=+Y Q:WARD=0
"RTN","PSJHL4",55,0)
 .S WARD=$O(^PS(59.6,"B",WARD,0)) Q:+WARD=0
"RTN","PSJHL4",56,0)
 .Q:$$SNDTSTW^PSJHL4A(PRIO,PSJSCHED,WARD)
"RTN","PSJHL4",57,0)
 .S WDPARM=$G(^PS(59.6,+WARD,0)),MGRP=$P(WDPARM,"^",30) Q:+MGRP=0
"RTN","PSJHL4",58,0)
 .S MGRP=$$GET1^DIQ(3.8,MGRP,.01) I MGRP]"" S XMY("G."_MGRP_"@"_$G(^XMB("NETNAME")))="",PSJSOK=0
"RTN","PSJHL4",59,0)
 S:'$$SNDTSTP^PSJHL4A(PRIO,PSJSCHED) MGROUP="G.PSJ STAT NOW PENDING ORDER@"_$G(^XMB("NETNAME")),XMY(MGROUP)="",PSJSOK=0
"RTN","PSJHL4",60,0)
 S NTFSTAT="PENDING"
"RTN","PSJHL4",61,0)
 N NDP2,ND0 S NDP2=$G(^PS(53.1,+ORDER,.2)),ND0=$G(^PS(53.1,+ORDER,0))
"RTN","PSJHL4",62,0)
 S DRIEN=+$P(NDP2,"^"),DO=$P(NDP2,"^",2),RTE=$P(ND0,"^",3),ORDATE=$P(ND0,"^",14)
"RTN","PSJHL4",63,0)
 S SCHED=$P($G(^PS(53.1,+ORDER,2)),"^")
"RTN","PSJHL4",64,0)
 Q
"RTN","PSJHL4",65,0)
UD ; UD
"RTN","PSJHL4",66,0)
 N WARD,WDPARM,MGRP
"RTN","PSJHL4",67,0)
 Q:'$D(^PS(55,PSJHLDFN,5,+ORDER,0))
"RTN","PSJHL4",68,0)
 S WARD=$P($G(^PS(55,PSJHLDFN,5,+ORDER,0)),"^",23) I +WARD D
"RTN","PSJHL4",69,0)
 .S WARD=$O(^PS(59.6,"B",WARD,0)) Q:+WARD=0
"RTN","PSJHL4",70,0)
 .Q:$$SNDTSTW^PSJHL4A(PRIO,PSJSCHED,WARD)
"RTN","PSJHL4",71,0)
 .S WDPARM=$G(^PS(59.6,+WARD,0)),MGRP=$P(WDPARM,"^",30) Q:+MGRP=0
"RTN","PSJHL4",72,0)
 .S MGRP=$$GET1^DIQ(3.8,MGRP,.01) I MGRP]"" S XMY("G."_MGRP_"@"_$G(^XMB("NETNAME")))="",PSJSOK=0
"RTN","PSJHL4",73,0)
 S:'$$SNDTSTA^PSJHL4A(PRIO,PSJSCHED) MGROUP="G.PSJ STAT NOW ACTIVE ORDER@"_$G(^XMB("NETNAME")),XMY(MGROUP)="",PSJSOK=0
"RTN","PSJHL4",74,0)
 S NTFSTAT="ACTIVE"
"RTN","PSJHL4",75,0)
 N ND2,ND0 S ND0=$G(^PS(55,PSJHLDFN,5,+ORDER,0)),ND2=$G(^PS(55,PSJHLDFN,5,+ORDER,2)),NDP2=$G(^PS(55,PSJHLDFN,5,+ORDER,.2))
"RTN","PSJHL4",76,0)
 S DRIEN=+$P(NDP2,"^"),DO=$P(NDP2,"^",2),RTE=$P(ND0,"^",3),ORDATE=$P(ND0,"^",14)
"RTN","PSJHL4",77,0)
 S SCHED=$P(ND2,"^")
"RTN","PSJHL4",78,0)
 Q
"RTN","PSJHL4",79,0)
IV ; IV
"RTN","PSJHL4",80,0)
 N WARD,WDPARM,MGRP
"RTN","PSJHL4",81,0)
 Q:'$D(^PS(55,PSJHLDFN,"IV",+ORDER,0))
"RTN","PSJHL4",82,0)
 S WARD=$P($G(^PS(55,PSJHLDFN,"IV",+ORDER,0)),"^",22) I +WARD D
"RTN","PSJHL4",83,0)
 .S WARD=$O(^PS(59.6,"B",WARD,0)) Q:+WARD=0
"RTN","PSJHL4",84,0)
 .Q:$$SNDTSTW^PSJHL4A(PRIO,PSJSCHED,WARD)
"RTN","PSJHL4",85,0)
 .S WDPARM=$G(^PS(59.6,+WARD,0)),MGRP=$P(WDPARM,"^",30) Q:+MGRP=0
"RTN","PSJHL4",86,0)
 .S MGRP=$$GET1^DIQ(3.8,MGRP,.01) I MGRP]"" S XMY("G."_MGRP_"@"_$G(^XMB("NETNAME")))="",PSJSOK=0
"RTN","PSJHL4",87,0)
 S:'$$SNDTSTA^PSJHL4A(PRIO,PSJSCHED) MGROUP="G.PSJ STAT NOW ACTIVE ORDER@"_$G(^XMB("NETNAME")),XMY(MGROUP)="",PSJSOK=0
"RTN","PSJHL4",88,0)
 S NTFSTAT="ACTIVE"
"RTN","PSJHL4",89,0)
 N ND2,NDP2,ND0 S ND0=$G(^PS(55,PSJHLDFN,"IV",+ORDER,0)),ND2=$G(^PS(55,PSJHLDFN,"IV",+ORDER,2))
"RTN","PSJHL4",90,0)
 S NDP2=$G(^PS(55,PSJHLDFN,"IV",+ORDER,.2))
"RTN","PSJHL4",91,0)
 S DRIEN=$P(NDP2,"^"),DO=$P(NDP2,"^",2),RTE=$P(NDP2,"^",3)
"RTN","PSJHL4",92,0)
 S ORDATE=$P(ND2,"^"),SCHED=$P(ND0,"^",9)
"RTN","PSJHL4",93,0)
 Q
"RTN","PSJHL4",94,0)
MSH ; Header
"RTN","PSJHL4",95,0)
 S PSOC=FIELD(8)
"RTN","PSJHL4",96,0)
 Q
"RTN","PSJHL4",97,0)
PID ; ID
"RTN","PSJHL4",98,0)
 S PSJHLDFN=$$UNESC^ORHLESC(FIELD(3))
"RTN","PSJHL4",99,0)
 Q
"RTN","PSJHL4",100,0)
PV1 ; Visit
"RTN","PSJHL4",101,0)
 N A
"RTN","PSJHL4",102,0)
 S CLASS=FIELD(2),LOC=$P(FIELD(3),"^"),APPT="" I $G(FIELD(44))]"" S APPT=+$$HL7TFM^XLFDT(FIELD(44))
"RTN","PSJHL4",103,0)
 I "IO"'[CLASS S PSREASON="Invalid patient class" Q
"RTN","PSJHL4",104,0)
 N QQ K PSJNVA S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  D  Q:$G(PSJNVA)
"RTN","PSJHL4",105,0)
 .S X=$G(PSJMSG(QQ))
"RTN","PSJHL4",106,0)
 .I $P(X,"|")="ZRN" S PSJNVA=1,CLASS="O" D EN^PSOHLNEW(.PSJMSG)
"RTN","PSJHL4",107,0)
 I $G(PSJNVA) K PSJNVA Q
"RTN","PSJHL4",108,0)
 I CLASS="O" N QQ S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  I $P(PSJMSG(QQ),"|")="OBR" D  Q:$P(PSJMSG(QQ),"|")="OBR"
"RTN","PSJHL4",109,0)
 .S RXON=$P(PSJMSG(QQ),"|",4) I RXON]"" S RXON=$P(RXON,"^") I "ABNPUV"[$E(RXON,$L(RXON)) S CLASS="I"
"RTN","PSJHL4",110,0)
 I CLASS="O" N QQ S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  I $P(PSJMSG(QQ),"|")="ORC" D  Q:$P(PSJMSG(QQ),"|")="ORC"
"RTN","PSJHL4",111,0)
 .S RXON=$P(PSJMSG(QQ),"|",4) I RXON]"" S RXON=$P(RXON,"^") I "ABNPUV"[$E(RXON,$L(RXON)) S CLASS="I"
"RTN","PSJHL4",112,0)
 I CLASS="O" N CHK,QQ S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  I $P(PSJMSG(QQ),"|")="RXO" D  Q:$P(PSJMSG(QQ),"|")="RXO"
"RTN","PSJHL4",113,0)
 .S CHK=$P(PSJMSG(QQ),"|",2),CHK=$S($P(CHK,"^",5)="IV":"IV",1:$P(CHK,"^",4))
"RTN","PSJHL4",114,0)
 .I CHK="IV" S CLASS="I" Q
"RTN","PSJHL4",115,0)
 .I 'CHK S PSREASON="Missing or Invalid Orderable Item",CLASS="I" Q
"RTN","PSJHL4",116,0)
 .I $P($G(^PS(50.7,CHK,0)),"^",3)=1 S CLASS="I" Q
"RTN","PSJHL4",117,0)
 D:CLASS="O" EN^PSOHLNEW(.PSJMSG)
"RTN","PSJHL4",118,0)
 Q
"RTN","PSJHL4",119,0)
ORC ; Order
"RTN","PSJHL4",120,0)
 S TMPAT=""
"RTN","PSJHL4",121,0)
 S PSOC=FIELD(1)
"RTN","PSJHL4",122,0)
 S ORDER=FIELD(2)
"RTN","PSJHL4",123,0)
 I $G(PSREASON)]"" D ERROR^PSJHL9 Q
"RTN","PSJHL4",124,0)
 S PSJORDER=$P(FIELD(2),"^"),RXON=$P(FIELD(3),"^"),RXORDER=$S((RXON["N")!(RXON["P"):"^PS(53.1,"_+RXON_",",RXON["V":"^PS(55,"_PSJHLDFN_",""IV"","_+RXON_",",1:"^PS(55,"_PSJHLDFN_",5,"_+RXON_",")
"RTN","PSJHL4",125,0)
 I PSOC="NA" D ASSIGN^PSJHL5 Q
"RTN","PSJHL4",126,0)
 S CLERK=+$G(FIELD(10))
"RTN","PSJHL4",127,0)
 S PROVIDER=+$G(FIELD(12)) D:PSOC="NW"
"RTN","PSJHL4",128,0)
 .I PROVIDER=0 S PSREASON="Invalid Provider" D ERROR^PSJHL9 Q 
"RTN","PSJHL4",129,0)
 .I PROVIDER>0 S PSPR=$G(^VA(200,+PROVIDER,"PS")) I '$D(PSPR)!'(PSPR)!$S($P(PSPR,"^",4)="":0,1:$P(PSPR,"^",4)'>DT) S PSREASON="Invalid Provider" D ERROR^PSJHL9 Q
"RTN","PSJHL4",130,0)
 S UNITS=$P(FIELD(7),"^"),INSTR=$$UNESC^ORHLESC($P(FIELD(7),"^",8))
"RTN","PSJHL4",131,0)
 S:UNITS["&" DOSE=$P(UNITS,"&"),UNIT=$P(UNITS,"&",2),UNITS=$P(UNITS,"&",3) S:UNITS]"" UNITS=$$UNESC^ORHLESC(UNITS) S:$G(DOSE)]"" DOSE=$$UNESC^ORHLESC(DOSE)
"RTN","PSJHL4",132,0)
 S SCHEDULE=$P(FIELD(7),"^",2),PRIORITY=$P(FIELD(7),"^",6) S:SCHEDULE["PRN" SCHTYP="P"
"RTN","PSJHL4",133,0)
 I SCHEDULE["&" S ADMINS=$P(SCHEDULE,"&",2),SCHEDULE=$P(SCHEDULE,"&") S ADMINS=$TR(ADMINS," ","") S ADMINS=$S(ADMINS:ADMINS,1:"")
"RTN","PSJHL4",134,0)
 S SCHEDULE=$$UNESC^ORHLESC(SCHEDULE)
"RTN","PSJHL4",135,0)
 I SCHEDULE["@" S TMPAT=$$TMPAT^PSJHL4A(SCHEDULE)
"RTN","PSJHL4",136,0)
 I $G(TMPAT) S $P(SCHEDULE,"@",2)=TMPAT,ADMINS=TMPAT
"RTN","PSJHL4",137,0)
 S DURATION=$P(FIELD(7),"^",3),REQST=$P(FIELD(7),"^",4) S:REQST'="" REQST=+$E(+$$HL7TFM^XLFDT(REQST),1,12) S REQST=$$DATE2^PSJUTL2(REQST)
"RTN","PSJHL4",138,0)
 S PRIORITY=$S($G(PRIORITY)]"":PRIORITY,1:"R")
"RTN","PSJHL4",139,0)
 I $E(SCHEDULE,1)=" " S:$TR(SCHEDULE," ")="PRN" SCHEDULE="PRN" I '(SCHEDULE="PRN")  S PSREASON="Invalid Schedule" D ERROR^PSJHL9 Q
"RTN","PSJHL4",140,0)
 S SCHTYP=$P(FIELD(7),"^",7)
"RTN","PSJHL4",141,0)
 I $G(SCHTYP)="D" S SCHTYP="C"  ;Makes CPRS Day of Week consistent in behavior with backdoor order of Day of Week
"RTN","PSJHL4",142,0)
 S PRNTON=$P(FIELD(8),"^")
"RTN","PSJHL4",143,0)
 S NURSEACK=$G(FIELD(11))
"RTN","PSJHL4",144,0)
 S LOGIN=$G(FIELD(15)) S:LOGIN'="" LOGIN=+$E(+$$HL7TFM^XLFDT(FIELD(15)),1,12) S LOGIN=$$DATE2^PSJUTL2(LOGIN)
"RTN","PSJHL4",145,0)
 S:$G(NURSEACK)]"" ACKDATE=LOGIN
"RTN","PSJHL4",146,0)
 S ORDCON=$P($G(FIELD(16)),U) I ORDCON="A" S PSJASTP=$G(FIELD(9)) S:$G(PSJASTP)'="" PSJASTP=+$E(+$$HL7TFM^XLFDT(PSJASTP),1,12) S PSJASTP=$$DATE2^PSJUTL2(PSJASTP)
"RTN","PSJHL4",147,0)
 I (PSOC="CA")!(PSOC="DC") D CANCEL^PSJHL6 Q
"RTN","PSJHL4",148,0)
 I PSOC="HD" D HOLD^PSJHL6 Q
"RTN","PSJHL4",149,0)
 I PSOC="RL" D UNHOLD^PSJHL6 Q
"RTN","PSJHL4",150,0)
 I PSOC="ZV" D NURSEACK^PSJHL5 Q
"RTN","PSJHL4",151,0)
 I PSOC="SS" D STATUS^PSJHL5 Q
"RTN","PSJHL4",152,0)
 I PSOC="Z@" N X S X="PSJHL8" X ^%ZOSF("TEST") I  D PURGE^PSJHL8 Q
"RTN","PSJHL4",153,0)
 I PSOC="DE" S QFLG=1 Q
"RTN","PSJHL4",154,0)
 Q
"RTN","PSJHL4",155,0)
OBR ; Flagging from CPRS.
"RTN","PSJHL4",156,0)
 S ORDER=FIELD(2)
"RTN","PSJHL4",157,0)
 S PSJORDER=$P(FIELD(2),"^"),RXON=$P(FIELD(3),"^"),RXORDER=$S((RXON["N")!(RXON["P"):"^PS(53.1,"_+RXON_",",RXON["V":"^PS(55,"_PSJHLDFN_",""IV"","_+RXON_",",1:"^PS(55,"_PSJHLDFN_",5,"_+RXON_",")
"RTN","PSJHL4",158,0)
 S PSJFLAG=FIELD(4)
"RTN","PSJHL4",159,0)
 S FLDATE=$G(FIELD(7)) S:FLDATE'="" FLDATE=+$E(+$$HL7TFM^XLFDT(FIELD(7)),1,12) S FLDATE=$$DATE2^PSJUTL2(FLDATE)
"RTN","PSJHL4",160,0)
 S CLERK=+$G(FIELD(16))
"RTN","PSJHL4",161,0)
 S PSJYN=$G(FIELD(24))
"RTN","PSJHL4",162,0)
 S FLCMNT=$$UNESC^ORHLESC($G(FIELD(13)))
"RTN","PSJHL4",163,0)
 I PSOC="ORU" D FLAG^PSJHL5
"RTN","PSJHL4",164,0)
 Q
"RTN","PSJHL4",165,0)
RXC ; IV 
"RTN","PSJHL4",166,0)
 D RXC^PSJHL4A
"RTN","PSJHL4",167,0)
 Q
"RTN","PSJHL4",168,0)
RXO ; OP
"RTN","PSJHL4",169,0)
 D RXO^PSJHL4A
"RTN","PSJHL4",170,0)
 Q
"RTN","PSJHL4",171,0)
RXR ; Route
"RTN","PSJHL4",172,0)
 S ROUTE=$P(FIELD(1),"^",4)
"RTN","PSJHL4",173,0)
 Q
"RTN","PSJHL4",174,0)
OBX ; Obs.
"RTN","PSJHL4",175,0)
 D OBX^PSJHL4A
"RTN","PSJHL4",176,0)
 Q
"RTN","PSJHL4",177,0)
NTE ; Note
"RTN","PSJHL4",178,0)
 D NTE^PSJHL4A
"RTN","PSJHL4",179,0)
 Q
"RTN","PSJHL4",180,0)
ZRX ; Custom
"RTN","PSJHL4",181,0)
 D ZRX^PSJHL4A
"RTN","PSJHL4",182,0)
 Q
"RTN","PSJHL4",183,0)
ZSC ;Service Connected - Not Used
"RTN","PSJHL4",184,0)
 Q
"RTN","PSJHL4",185,0)
ZRN ;Non-VA Med (Herbal/OTC)
"RTN","PSJHL4",186,0)
 S CLASS="O" D EN^PSOHLNEW(.PSJMSG)
"RTN","PSJHL4",187,0)
 Q
"RTN","PSJHL4",188,0)
DG1 ;Billing Awareness - Not used
"RTN","PSJHL4",189,0)
 Q
"RTN","PSJHL4A")
0^6^B56736588
"RTN","PSJHL4A",1,0)
PSJHL4A ;BIR/RLW-CONTINUE DECODE HL7 /MESSSAGE FROM OE/RR ;16 Mar 99 / 4:55 PM
"RTN","PSJHL4A",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**105,111,154,170,159,134**;16 DEC 97;Build 124
"RTN","PSJHL4A",3,0)
 ;
"RTN","PSJHL4A",4,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJHL4A",5,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJHL4A",6,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL4A",7,0)
 ; Reference to ^PS(59.7 supported by DBIA #2181.
"RTN","PSJHL4A",8,0)
 ; Reference to ^ORHLESC is supported by DBIA# 4922.
"RTN","PSJHL4A",9,0)
 ; Reference to ^SC( is supported by DBIA# 10040.
"RTN","PSJHL4A",10,0)
 ; Reference to ^PS(51.1 is supported by DBIA# 2177.
"RTN","PSJHL4A",11,0)
 ; Reference to ^PS(50.7 is supported by DBIA #2180.
"RTN","PSJHL4A",12,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJHL4A",13,0)
 ;
"RTN","PSJHL4A",14,0)
RXC ; IV order
"RTN","PSJHL4A",15,0)
 N IVFL
"RTN","PSJHL4A",16,0)
 S APPL=FIELD(1)
"RTN","PSJHL4A",17,0)
 I APPL["B" S SOLCNT=SOLCNT+1,PTR=$P(FIELD(2),"^",4) Q:'PTR  S VOLUME=+FIELD(3)_" ML" D  I '$D(^TMP("PSJNVO",$J,"SOL",SOLCNT,0)) D SOLSRCH
"RTN","PSJHL4A",18,0)
 .S SOLUTION="" F  S SOLUTION=$O(^PS(52.7,"AOI",PTR,SOLUTION)) Q:'SOLUTION  S INACT=$G(^PS(52.7,SOLUTION,"I")) I 'INACT!(INACT>DT) I VOLUME=$P(^PS(52.7,SOLUTION,0),U,3) D
"RTN","PSJHL4A",19,0)
 ..S ^TMP("PSJNVO",$J,"SOL",0)=SOLCNT
"RTN","PSJHL4A",20,0)
 ..S ^TMP("PSJNVO",$J,"SOL",SOLCNT,0)=SOLUTION_"^"_VOLUME,TVOLUME=TVOLUME+(+VOLUME)
"RTN","PSJHL4A",21,0)
 I $G(INFRT)]"" S X=INFRT D ENI^PSJHLU S INFRT=$G(X)
"RTN","PSJHL4A",22,0)
 I APPL="A" S ADCNT=ADCNT+1,PTR=$P(FIELD(2),"^",4) Q:'PTR  S STRENGTH=$G(FIELD(3))_" "_$P($G(FIELD(4)),"^",5) D  I '$D(^TMP("PSJNVO",$J,"AD",ADCNT,0)) S PSREASON="Can't find matching additive" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",23,0)
 .S ADDITIVE="" F  S ADDITIVE=$O(^PS(52.6,"AOI",PTR,ADDITIVE)) Q:'ADDITIVE  S INACT=$G(^PS(52.6,ADDITIVE,"I")),IVFL=$P($G(^(0)),"^",13) I 'INACT!(INACT>DT),IVFL'=0 Q:$G(^PS(52.6,ADDITIVE,0))']""  D  Q:ADDITIVE
"RTN","PSJHL4A",24,0)
 ..I $G(PSITEM)="" S PSITEM=PTR
"RTN","PSJHL4A",25,0)
 ..S ^TMP("PSJNVO",$J,"AD",0)=ADCNT
"RTN","PSJHL4A",26,0)
 ..S ^TMP("PSJNVO",$J,"AD",ADCNT,0)=ADDITIVE_"^"_STRENGTH
"RTN","PSJHL4A",27,0)
 Q
"RTN","PSJHL4A",28,0)
 ;
"RTN","PSJHL4A",29,0)
RXO ;
"RTN","PSJHL4A",30,0)
 I $O(PSJMSG(II,0)) D
"RTN","PSJHL4A",31,0)
 .K SEGMENT
"RTN","PSJHL4A",32,0)
 .N KK,JJ,XX
"RTN","PSJHL4A",33,0)
 .S SEGMENT(1)=$G(PSJMSG(II))
"RTN","PSJHL4A",34,0)
 .S KK=1,JJ="" F  S JJ=$O(PSJMSG(II,JJ)) Q:'JJ  S KK=KK+1,SEGMENT(KK)=$G(PSJMSG(II,JJ))
"RTN","PSJHL4A",35,0)
 .S KK=1,JJ=0
"RTN","PSJHL4A",36,0)
 .F  Q:'$D(SEGMENT(KK))  D
"RTN","PSJHL4A",37,0)
 ..I SEGMENT(KK)["|" S FIELD(JJ)=$P(SEGMENT(KK),"|"),SEGMENT(KK)=$E(SEGMENT(KK),$L(FIELD(JJ))+2,$L(SEGMENT(KK))),JJ=JJ+1 Q
"RTN","PSJHL4A",38,0)
 ..I SEGMENT(KK)'["|" S FIELD(JJ)=SEGMENT(KK),KK=KK+1 Q:'$D(SEGMENT(KK))  D
"RTN","PSJHL4A",39,0)
 ...S XX=$P(SEGMENT(KK),"|"),SEGMENT(KK)=$E(SEGMENT(KK),$L(X)+2,$L(SEGMENT(KK))),FIELD(JJ)=FIELD(JJ)_XX,JJ=JJ+1
"RTN","PSJHL4A",40,0)
 S APPL="",PSITEM=$S($P(FIELD(1),"^",5)="IV":"",1:$P(FIELD(1),"^",4))
"RTN","PSJHL4A",41,0)
 S:$P(FIELD(1),"^",6)="ORD" PSITEM=""
"RTN","PSJHL4A",42,0)
 S:$P(FIELD(1),"^",5)="IV" IVTYP="A",SCHTYP="C",INFRT=$G(FIELD(2))
"RTN","PSJHL4A",43,0)
 S DISPENSE=$P($G(FIELD(10)),"^",4)
"RTN","PSJHL4A",44,0)
 S IVLIMIT=$P($G(PSJMSG(II)),"^",3)
"RTN","PSJHL4A",45,0)
 S:IVLIMIT["doses" IVLIMIT=$TR(IVLIMIT,"doses","a")
"RTN","PSJHL4A",46,0)
 Q
"RTN","PSJHL4A",47,0)
 ;
"RTN","PSJHL4A",48,0)
OBX ;
"RTN","PSJHL4A",49,0)
 S OBXFL=1,OCNARR=FIELD(5),OCPROV=CLERK,OCCNT=OCCNT+1
"RTN","PSJHL4A",50,0)
 S ^TMP("PSJNVO",$J,10,0)=OCCNT
"RTN","PSJHL4A",51,0)
 S ^TMP("PSJNVO",$J,10,OCCNT,0)=OCNARR
"RTN","PSJHL4A",52,0)
 S ^TMP("PSJNVO",$J,10,OCCNT,1)=$$UNESC^ORHLESC($P($G(^VA(200,+OCPROV,0)),"^"))
"RTN","PSJHL4A",53,0)
 Q
"RTN","PSJHL4A",54,0)
 ;
"RTN","PSJHL4A",55,0)
NTE ;
"RTN","PSJHL4A",56,0)
 S TEXT=$S((FIELD(1)=6)&('OBXFL):"PROCOM",(FIELD(1)=7)&('OBXFL):"ADMINSTR",1:"OCRSN")
"RTN","PSJHL4A",57,0)
 S @TEXT@(1)=$$UNESC^ORHLESC($G(FIELD(3)))
"RTN","PSJHL4A",58,0)
 S K=1,J="" F  S J=$O(PSJMSG(II,J)) Q:'J  S K=K+1,@TEXT@(K)=$G(PSJMSG(II,J))
"RTN","PSJHL4A",59,0)
 D:$D(OCRSN)
"RTN","PSJHL4A",60,0)
 .S QQ=0 F  S QQ=$O(OCRSN(QQ)) Q:'QQ  S ^TMP("PSJNVO",$J,10,OCCNT,2,QQ,0)=OCRSN(QQ)
"RTN","PSJHL4A",61,0)
 S OBXFL=0
"RTN","PSJHL4A",62,0)
 Q
"RTN","PSJHL4A",63,0)
 ;
"RTN","PSJHL4A",64,0)
ZRX ;
"RTN","PSJHL4A",65,0)
 N ND,ND2,CHK,FOLOR,STDT
"RTN","PSJHL4A",66,0)
 S PREON=$G(FIELD(1)),ROC=$G(FIELD(3)),IVCAT=$G(FIELD(6))
"RTN","PSJHL4A",67,0)
 S IVCAT=$S(",I,C,"[(","_IVCAT_","):IVCAT,1:"") I 'PREON S IVTYP=$S($G(PSGS0XT):"P",1:"A") S IVTYP=$S(IVCAT="I":"P",IVCAT="C":"A",1:$G(IVTYP))
"RTN","PSJHL4A",68,0)
 S ND=$S((PREON["N")!(PREON["P"):$G(^PS(53.1,+PREON,0)),PREON["V":$G(^PS(55,PSJHLDFN,"IV",+PREON,0)),1:$G(^PS(55,PSJHLDFN,5,+PREON,0)))
"RTN","PSJHL4A",69,0)
 S ND2=$S((PREON["N")!(PREON["P"):$G(^PS(53.1,+PREON,2)),PREON["V":$G(^PS(55,PSJHLDFN,"IV",+PREON,2)),1:$G(^PS(55,PSJHLDFN,5,+PREON,2)))
"RTN","PSJHL4A",70,0)
 I 'ND I ROC'="N" S PSREASON="Invalid Pharmacy order number" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",71,0)
 I ND I ROC="R" S FOLOR=$S(PREON["V":$P(ND2,U,6),1:$P(ND,U,26)) I FOLOR S PSREASON="Duplicate Renewal Request" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",72,0)
 I ND I ROC="R" S CHK=$S(PREON["V":$P(ND,U,17),1:$P(ND,U,9)) I "AE"'[CHK S PSREASON="Pharmacy orders with a status of "_CHK_" may not be renewed" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",73,0)
 I $G(CHK)="E" I PREON'["V" D NOW^%DTC S X1=+$E(%,1,12),X2=-4 D C^%DTC S STDT=$S(PREON["V":$P(ND,U,3),1:$P(ND2,U,4)) I STDT'>X S PSREASON="Pharmacy orders expired longer than 4 days may not be renewed" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",74,0)
 I ND I ROC="E" S FOLOR=$S(PREON["V":$P(ND2,U,6),1:$P(ND,U,26)) I FOLOR S PSREASON="Pharmacy orders may only be edited ONCE" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",75,0)
 I ND I ROC="E" S CHK=$S(PREON["V":$P(ND,U,17),1:$P(ND,U,9)) I "DEHO"[CHK N CHKRTN S CHKRTN=CHK_"^PSJHL6" D @CHKRTN S PSREASON=PSREASON_" orders may not be edited" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",76,0)
 D:ROC'="R" VALID^PSJHL9 Q:QFLG
"RTN","PSJHL4A",77,0)
 I $G(PSITEM)="",$D(^TMP("PSJNVO",$J,"SOL",1,0)) S PSITEM=$P($G(^PS(52.7,+^TMP("PSJNVO",$J,"SOL",1,0),0)),"^",11)
"RTN","PSJHL4A",78,0)
 I PRIORITY="ZD" D VALID^PSJHL10 S QFLG=1 Q
"RTN","PSJHL4A",79,0)
 I (PREON]"")&(ROC="E") D EDITCK^PSJHL5 Q:QFLG
"RTN","PSJHL4A",80,0)
 D NVO^PSJHL9
"RTN","PSJHL4A",81,0)
 I (PREON]"")&(ROC="R") D RENEW^PSJHL7 Q
"RTN","PSJHL4A",82,0)
 I (PREON]"")&(ROC="E") D EDIT^PSJHL5
"RTN","PSJHL4A",83,0)
 Q
"RTN","PSJHL4A",84,0)
 ;
"RTN","PSJHL4A",85,0)
SOLSRCH ;Find solution
"RTN","PSJHL4A",86,0)
 N SSSS,SEG,ON,ROC,SOL,SOL2
"RTN","PSJHL4A",87,0)
 F SSSS=II:0 S SSSS=$O(PSJMSG(SSSS)) Q:'SSSS  I $P(PSJMSG(SSSS),"|")="ZRX" D  Q
"RTN","PSJHL4A",88,0)
 .S SEG=$G(PSJMSG(SSSS)),ON=$P(SEG,"|",2),ROC=$P(SEG,"|",4)
"RTN","PSJHL4A",89,0)
 I $G(ROC)'="N" F SOL=0:0 S SOL=$O(^PS(55,PSJHLDFN,"IV",+ON,"SOL",SOL)) Q:'SOL  S SOL2=$G(^PS(55,PSJHLDFN,"IV",+ON,"SOL",SOL,0)) I $D(^PS(52.7,"AOI",PTR,+SOL2))&($P(SOL2,U,2)=VOLUME) S SOLUTION=+SOL2 D SET Q
"RTN","PSJHL4A",90,0)
 I 'SOLUTION S SOLUTION=$O(^PS(52.7,"AOI",PTR,SOLUTION)) D SET
"RTN","PSJHL4A",91,0)
 Q
"RTN","PSJHL4A",92,0)
SET ;Set solution tmp nodes
"RTN","PSJHL4A",93,0)
 Q:'+SOLUTION
"RTN","PSJHL4A",94,0)
 S ^TMP("PSJNVO",$J,"SOL",0)=SOLCNT
"RTN","PSJHL4A",95,0)
 S ^TMP("PSJNVO",$J,"SOL",SOLCNT,0)=SOLUTION_"^"_VOLUME,TVOLUME=TVOLUME+(+VOLUME)
"RTN","PSJHL4A",96,0)
 Q
"RTN","PSJHL4A",97,0)
 ;
"RTN","PSJHL4A",98,0)
SNDTSTW(PRIO,PSJSCHED,WARD) ; Test to determine if mail message should be sent.
"RTN","PSJHL4A",99,0)
 N SNPRIO,SNSCHD,SNOPT
"RTN","PSJHL4A",100,0)
 S SNPRIO=$S(PRIO="S":"S",PRIO="A":"A",1:"R")
"RTN","PSJHL4A",101,0)
 S SNSCHD=$S(PSJSCHED="STAT":"S",PSJSCHED="NOW":"N",1:"R")
"RTN","PSJHL4A",102,0)
 S SNOPT=$P($G(^PS(59.6,WARD,0)),"^",32)
"RTN","PSJHL4A",103,0)
 S:SNOPT="" SNOPT=$P($G(^PS(59.7,1,27)),"^",1)
"RTN","PSJHL4A",104,0)
 Q:SNOPT="" 0
"RTN","PSJHL4A",105,0)
 Q:SNOPT[SNPRIO 0
"RTN","PSJHL4A",106,0)
 Q:SNOPT[SNSCHD 0
"RTN","PSJHL4A",107,0)
 Q 1
"RTN","PSJHL4A",108,0)
 ;
"RTN","PSJHL4A",109,0)
SNDTSTP(PRIO,PSJSCHED) ; Test to determine if mail message should be sent.
"RTN","PSJHL4A",110,0)
 N SNPRIO,SNSCHD,SNOPT
"RTN","PSJHL4A",111,0)
 S SNPRIO=$S(PRIO="S":"S",PRIO="A":"A",1:"R")
"RTN","PSJHL4A",112,0)
 S SNSCHD=$S(PSJSCHED="STAT":"S",PSJSCHED="NOW":"N",1:"R")
"RTN","PSJHL4A",113,0)
 S SNOPT=$P($G(^PS(59.7,1,27)),"^",1)
"RTN","PSJHL4A",114,0)
 Q:SNOPT="" 1
"RTN","PSJHL4A",115,0)
 Q:SNOPT[SNPRIO 0
"RTN","PSJHL4A",116,0)
 Q:SNOPT[SNSCHD 0
"RTN","PSJHL4A",117,0)
 Q 1
"RTN","PSJHL4A",118,0)
 ;
"RTN","PSJHL4A",119,0)
SNDTSTA(PRIO,PSJSCHED) ; Test to determine if mail message should be sent.
"RTN","PSJHL4A",120,0)
 N SNPRIO,SNSCHD,SNOPT
"RTN","PSJHL4A",121,0)
 S SNPRIO=$S(PRIO="S":"S",PRIO="A":"A",1:"R")
"RTN","PSJHL4A",122,0)
 S SNSCHD=$S(PSJSCHED="STAT":"S",PSJSCHED="NOW":"N",1:"R")
"RTN","PSJHL4A",123,0)
 S SNOPT=$P($G(^PS(59.7,1,27)),"^",2)
"RTN","PSJHL4A",124,0)
 S:SNOPT="" SNOPT=$P($G(^PS(59.7,1,27)),"^",1)
"RTN","PSJHL4A",125,0)
 Q:SNOPT="" 1
"RTN","PSJHL4A",126,0)
 Q:SNOPT[SNPRIO 0
"RTN","PSJHL4A",127,0)
 Q:SNOPT[SNSCHD 0
"RTN","PSJHL4A",128,0)
 Q 1
"RTN","PSJHL4A",129,0)
 ;
"RTN","PSJHL4A",130,0)
TMPAT(SCHEDULE) ; Extract admin times from schedule in format schedule@schedule
"RTN","PSJHL4A",131,0)
 S TMPAT="" I SCHEDULE'["@" Q TMPAT
"RTN","PSJHL4A",132,0)
 S TMPAT=$P(SCHEDULE,"@",2) I TMPAT]"" D
"RTN","PSJHL4A",133,0)
 .N WARD S WARD=$G(^DPT(PSJHLDFN,.1)) I WARD]"" D
"RTN","PSJHL4A",134,0)
 ..N DIC,X,Y S DIC="^DIC(42,",DIC(0)="BOXZ",X=WARD D ^DIC S WARD=+Y Q:WARD=0
"RTN","PSJHL4A",135,0)
 ..S WARD=$O(^PS(59.6,"B",WARD,0))
"RTN","PSJHL4A",136,0)
 .I '$D(^PS(51.1,"AC","PSJ",TMPAT)) S TMPAT="" Q
"RTN","PSJHL4A",137,0)
 .N II I '$$DOW^PSIVUTL($P(SCHEDULE,"@")) S TMPAT="" Q
"RTN","PSJHL4A",138,0)
 .N TMPIEN S TMPIEN=$O(^PS(51.1,"AC","PSJ",TMPAT,0)),TMPAT=$P($G(^PS(51.1,+TMPIEN,0)),"^",2) D
"RTN","PSJHL4A",139,0)
 ..I $P($G(^PS(51.1,+TMPIEN,1,+$G(WARD),0)),"^",2) S TMPAT=$P($G(^(0)),"^",2)
"RTN","PSJHL4A",140,0)
 Q TMPAT
"RTN","PSJHL4A",141,0)
 ;
"RTN","PSJHL4A",142,0)
XMD ; Mailman call for NOTIFY^PSJHL4
"RTN","PSJHL4A",143,0)
 ; Input - PNAME  = Patient Name
"RTN","PSJHL4A",144,0)
 ;         RTE    = Route
"RTN","PSJHL4A",145,0)
 ;         DRUG   = Drug Name
"RTN","PSJHL4A",146,0)
 ;         WARD   = Ward Name
"RTN","PSJHL4A",147,0)
 ;         PRIO   = CPRS Order Priority
"RTN","PSJHL4A",148,0)
 S PNAME=$P($G(^DPT(+PSJHLDFN,0)),"^") S:$G(RTE) RTE=$P(^PS(51.2,+RTE,0),"^",3)
"RTN","PSJHL4A",149,0)
 S DRUG=$S(DRIEN:$P($G(^PS(50.7,+DRIEN,0)),"^"),1:""),WARD=$G(^DPT(PSJHLDFN,.1))
"RTN","PSJHL4A",150,0)
 S XMDUZ="MEDICATIONS,INPATIENT",XMSUB=$G(WARD)
"RTN","PSJHL4A",151,0)
 S XMSUB=XMSUB_"-"_NTFSTAT_" "_$S($G(PRIO)="A":"ASAP",$G(PRIO)="S":"STAT",$G(NTFYREAS)=2:"NOW",$G(NTFYREAS)=3:"STAT",1:"")_"-"
"RTN","PSJHL4A",152,0)
 S XMSUB=XMSUB_$E(PNAME,1,65-$L(XMSUB))
"RTN","PSJHL4A",153,0)
 S XMTEXT="PSG("
"RTN","PSJHL4A",154,0)
 S PSG(1,0)="Inpatient Medications has received the following "_$S($G(PRIO)="A":"ASAP",$G(PRIO)="S":"STAT",$G(NTFYREAS)=2:"NOW",1:"")_" order ("_NTFSTAT_")"
"RTN","PSJHL4A",155,0)
 S PSG(2,0)=""
"RTN","PSJHL4A",156,0)
 S PSG(3,0)="          Patient:     "_PNAME I $G(LASTFOUR) S PSG(3,0)=PSG(3,0)_"  ("_LASTFOUR_")"
"RTN","PSJHL4A",157,0)
 S PSG(4,0)="Order Information:     "_DRUG_" "_DO_" "_RTE_" "_$G(PSJSCHED)
"RTN","PSJHL4A",158,0)
 S PSG(5,0)="       Order Date:     "_$$ENDTC^PSGMI(ORDATE)
"RTN","PSJHL4A",159,0)
 D ^XMD
"RTN","PSJHL4A",160,0)
 Q
"RTN","PSJHL5")
0^28^B31480184
"RTN","PSJHL5",1,0)
PSJHL5 ;BIR/LDT-ACTIONS ON HL7 MESSAGES FROM OE/RR ;28 Jan 98 / 3:34 PM
"RTN","PSJHL5",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,28,39,40,42,84,85,95,80,173,134**;16 DEC 97;Build 124
"RTN","PSJHL5",3,0)
 ;
"RTN","PSJHL5",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL5",5,0)
 ; Reference to EN^ORERR is supported by DBIA# 2187.
"RTN","PSJHL5",6,0)
 ; Reference to NURV^ALPBCBU is supported by DBIA# 4120.
"RTN","PSJHL5",7,0)
 ; Reference to UNESC^ORHLESC is supported by DBIA# 4922
"RTN","PSJHL5",8,0)
 ;
"RTN","PSJHL5",9,0)
ASSIGN ; number assigned, update ORDERS FILE ENTRY
"RTN","PSJHL5",10,0)
 S RXORDER=RXORDER_"0)"
"RTN","PSJHL5",11,0)
 I '$P($G(@RXORDER),U) S ORDCON="Invalid Pharmacy order number/Number Assign Msg" S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(ORDCON,.PSJMSG) Q
"RTN","PSJHL5",12,0)
 Q:'$P($G(@RXORDER),U)
"RTN","PSJHL5",13,0)
 I RXON["P",PSJHLDFN'=$P($G(@(RXORDER)),U,15) S ORDCON="Patient does not match/Number Assign Msg" S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(ORDCON,.PSJMSG) Q
"RTN","PSJHL5",14,0)
 I RXON["P",PSJHLDFN'=$P($G(@(RXORDER)),U,15) Q
"RTN","PSJHL5",15,0)
 S $P(@RXORDER,"^",21)=PSJORDER
"RTN","PSJHL5",16,0)
 Q
"RTN","PSJHL5",17,0)
 ;
"RTN","PSJHL5",18,0)
NURSEACK ;Nurse Acknowledgement of Pending Orders
"RTN","PSJHL5",19,0)
 I '$P($G(@(RXORDER_"0)")),U) S ORDCON="Invalid Pharmacy order number/Nurse Acknowledgement Msg" S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(ORDCON,.PSJMSG) Q
"RTN","PSJHL5",20,0)
 Q:'$P($G(@(RXORDER_"0)")),U)
"RTN","PSJHL5",21,0)
 I RXON["P",PSJHLDFN'=$P($G(@(RXORDER_"0)")),U,15) S ORDCON="Patient does not match/Nurse Acknowledgement Msg" S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(ORDCON,.PSJMSG) Q
"RTN","PSJHL5",22,0)
 I RXON["P",PSJHLDFN'=$P($G(@(RXORDER_"0)")),U,15) Q
"RTN","PSJHL5",23,0)
 I RXON["P" N STATUS S STATUS=$P($G(@(RXORDER_"0)")),U,9) D:STATUS="N" EN^PSJHLV(PSJHLDFN,RXON)
"RTN","PSJHL5",24,0)
 I RXON["P" N STATUS S STATUS=$P($G(@(RXORDER_"0)")),U,9) Q:STATUS="A"
"RTN","PSJHL5",25,0)
 N DIE,DA
"RTN","PSJHL5",26,0)
 S DIE=$S(RXON["N"!(RXON["P"):"^PS(53.1,",RXON["V":"^PS(55,"_PSJHLDFN_",""IV"",",1:"^PS(55,"_PSJHLDFN_",5,"),DA=+RXON,DA(1)=PSJHLDFN
"RTN","PSJHL5",27,0)
 S DR="16////"_NURSEACK_";17////"_ACKDATE S:RXON["U" DR=DR_";51////1" S:RXON["V" DR=DR_";143////1",PSIVACT=""
"RTN","PSJHL5",28,0)
 I RXON["U" D NEWUDAL^PSGAL5(PSJHLDFN,RXON,22010)
"RTN","PSJHL5",29,0)
 I RXON["P" D NEWNVAL^PSGAL5(RXON,22010)
"RTN","PSJHL5",30,0)
 S PSGNVF=1 D ^DIE
"RTN","PSJHL5",31,0)
 I RXON["V" NEW ON55,DFN,PSIVAL,PSIVREA,PSIVLN K PSIVACT D
"RTN","PSJHL5",32,0)
 . S ON55=RXON,DFN=PSJHLDFN,PSIVAL="ORDER VERIFIED BY NURSE",PSIVALT="",PSIVREA="V"
"RTN","PSJHL5",33,0)
 . D LOG^PSIVORAL
"RTN","PSJHL5",34,0)
 D:RXON["P" EN^PSJLOI(PSJHLDFN,RXON) D:RXON["U" EN2^PSJLOI(PSJHLDFN,RXON)
"RTN","PSJHL5",35,0)
 K:RXON["U" ^PS(55,"ANV",PSJHLDFN,+RXON)
"RTN","PSJHL5",36,0)
 I $T(NURV^ALPBCBU)'="" D NURV^ALPBCBU(PSJHLDFN,RXON)
"RTN","PSJHL5",37,0)
 Q
"RTN","PSJHL5",38,0)
 ;
"RTN","PSJHL5",39,0)
EDIT ;Edit orders thru OE/RR
"RTN","PSJHL5",40,0)
 N DA,DR,DIE,PREORDER,STPDT,PSIVACT,PSIVALT,ON55,PSIVREA,PSIVALCK,P
"RTN","PSJHL5",41,0)
 S PREORDER=$S((PREON["N")!(PREON["P"):"^PS(53.1,"_+PREON_",2)",PREON["V":"^PS(55,"_PSJHLDFN_",""IV"","_+PREON_",0)",1:"^PS(55,"_PSJHLDFN_",5,"_+PREON_",2)")
"RTN","PSJHL5",42,0)
 S STPDT=$S(PREON["V":$P($G(@PREORDER),"^",3),1:$P($G(@PREORDER),"^",4))
"RTN","PSJHL5",43,0)
 D NOW^%DTC
"RTN","PSJHL5",44,0)
 S DIE=$S(PREON["N"!(PREON["P"):"^PS(53.1,",PREON["V":"^PS(55,"_PSJHLDFN_",""IV"",",1:"^PS(55,"_PSJHLDFN_",5,"),DA=+PREON,DA(1)=+PSJHLDFN
"RTN","PSJHL5",45,0)
 S DR=$S(PREON["V":"100////D;116////^S X=STPDT;123////E;114////"_PSJORDER_";.03////"_%,((PREON["P")!(PREON["N")):"25////"_%_";28////DE;107////E;105////"_PSJORDER_";32////"_STPDT,1:"25////"_STPDT_";28////DE;107////E;105////"_PSJORDER_";34////"_%)
"RTN","PSJHL5",46,0)
 I PREON["U"!(PREON["A") S PSGAL("C")=4100 D ^PSGAL5
"RTN","PSJHL5",47,0)
 I PREON["V" S PSIVACT=1,PSIVALT=2,ON55=PREON,PSIVREA="D",PSIVALCK="STOP",P(3)=STPDT
"RTN","PSJHL5",48,0)
 D ^DIE,AUE^PSJHL6(PSJHLDFN,PREON)
"RTN","PSJHL5",49,0)
 I PREON["V" N DFN S DFN=PSJHLDFN D LOG^PSIVORAL
"RTN","PSJHL5",50,0)
 S PSJHLMTN="ORM",PSOC=$S((PREON["N")!(PREON["P"):"OC",1:"OD") D EN1^PSJHL2(PSJHLDFN,PSOC,PREON) S PSJHLMTN="ORR",PSOC="XO"
"RTN","PSJHL5",51,0)
 Q
"RTN","PSJHL5",52,0)
 ;
"RTN","PSJHL5",53,0)
EDITCK ;Check to see if PSJHLDFN passed matches PSJHLDFN in pending order.
"RTN","PSJHL5",54,0)
 I (PREON["N")!(PREON["P"),PSJHLDFN'=$P($G(^PS(53.1,+PREON,0)),U,15) D
"RTN","PSJHL5",55,0)
 . S ORDCON="Patient does not match/Edit Msg" S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(ORDCON,.PSJMSG)
"RTN","PSJHL5",56,0)
 . D EN1^PSJHLERR(PSJHLDFN,"UX",$P(ORDER,"^"),ORDCON) S QFLG=1
"RTN","PSJHL5",57,0)
 Q
"RTN","PSJHL5",58,0)
 ;        
"RTN","PSJHL5",59,0)
STATUS ;Check status of an order in response to a send order status request from CPRS.
"RTN","PSJHL5",60,0)
 N STATUS,STPDT,NODE,NODE2
"RTN","PSJHL5",61,0)
 S NODE=$G(@(RXORDER_"0)")),NODE2=$G(@(RXORDER_"2)"))
"RTN","PSJHL5",62,0)
 I 'NODE S PSREASON="Invalid Pharmacy order number" D  Q
"RTN","PSJHL5",63,0)
 .S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(PSREASON_"/Status Check",.PSJMSG)
"RTN","PSJHL5",64,0)
 .D EN1^PSJHLERR(PSJHLDFN,"DE",$P(ORDER,U),PSREASON)
"RTN","PSJHL5",65,0)
 S $P(@(RXORDER_"0)"),"^",21)=$P(ORDER,"^")
"RTN","PSJHL5",66,0)
 S STATUS=$S(RXON["V":$P(NODE,"^",17),1:$P(NODE,"^",9))
"RTN","PSJHL5",67,0)
 S STPDT=$S(RXON["V":$P(NODE,"^",3),1:$P(NODE2,"^",4))
"RTN","PSJHL5",68,0)
 D NOW^%DTC I RXON'["P" I "DEH"'[STATUS I STPDT<% D EXPIR^PSJHL6 Q
"RTN","PSJHL5",69,0)
 D EN1^PSJHL2(PSJHLDFN,"SC",RXON)
"RTN","PSJHL5",70,0)
 Q
"RTN","PSJHL5",71,0)
 ;
"RTN","PSJHL5",72,0)
FLAG ;Flag/Unflag orders
"RTN","PSJHL5",73,0)
 I '$P($G(@(RXORDER_"0)")),U) S ORDCON="Invalid Pharmacy order number/Flag Msg" S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(ORDCON,.PSJMSG) Q
"RTN","PSJHL5",74,0)
 Q:'$P($G(@(RXORDER_"0)")),U)
"RTN","PSJHL5",75,0)
 S DIE=$S(RXON["N"!(RXON["P"):"^PS(53.1,",RXON["V":"^PS(55,"_PSJHLDFN_",""IV"",",1:"^PS(55,"_PSJHLDFN_",5,"),DA=+RXON,DA(1)=PSJHLDFN
"RTN","PSJHL5",76,0)
 S DR=$S(PSJFLAG="FL":$S(RXON["V":"148////1",1:"124////1"),1:$S(RXON["V":"148////@",1:"124////@"))
"RTN","PSJHL5",77,0)
 D ^DIE
"RTN","PSJHL5",78,0)
 I $G(FLCMNT)]"" S FLCMNT=$$UNESC^ORHLESC(FLCMNT)
"RTN","PSJHL5",79,0)
 I RXON["U" D
"RTN","PSJHL5",80,0)
 . S ^PS(55,PSJHLDFN,5,+RXON,13)=FLCMNT
"RTN","PSJHL5",81,0)
 . S FLCMNT="COMMENTS: "_FLCMNT S:$L(FLCMNT)>52 FLCMNT=$E(FLCMNT,1,49)_"..."
"RTN","PSJHL5",82,0)
 . D NEWUDAL^PSGAL5(PSJHLDFN,+RXON,$S((PSJFLAG="FL")&(PSJYN="PHR"):7000,(PSJFLAG="UF")&(PSJYN="PHR"):7010,(PSJFLAG="FL")&(PSJYN=""):7020,1:7030),FLCMNT)
"RTN","PSJHL5",83,0)
 I RXON["V" N DFN,ON55,PSIVREA,PSIVAL S DFN=PSJHLDFN S PSIVALT="",ON55=RXON,PSIVREA=$S(PSJFLAG="FL":"G",1:"UG"),PSIVAL=$S(PSJYN="PHR":"FLAGGED BY PHARMACIST ",1:"FLAGGED BY CPRS ")_FLCMNT D LOG^PSIVORAL
"RTN","PSJHL5",84,0)
 I RXON["P" D
"RTN","PSJHL5",85,0)
 . S ^PS(53.1,+RXON,13)=FLCMNT
"RTN","PSJHL5",86,0)
 . S FLCMNT="COMMENTS: "_FLCMNT S:$L(FLCMNT)>52 FLCMNT=$E(FLCMNT,1,49)_"..."
"RTN","PSJHL5",87,0)
 . D NEWNVAL^PSGAL5(+RXON,$S((PSJFLAG="FL")&(PSJYN="PHR"):7000,(PSJFLAG="UF")&(PSJYN="PHR"):7010,(PSJFLAG="FL")&(PSJYN=""):7020,1:7030),FLCMNT)
"RTN","PSJHL5",88,0)
 ;The ... on Unit Dose and Pending orders is because of the limitations in the DD of 53.1.
"RTN","PSJHL5",89,0)
 Q
"RTN","PSJHL9")
0^7^B61245429
"RTN","PSJHL9",1,0)
PSJHL9 ;BIR/LDT-VALIDATE INCOMING HL7 DATA/CREATE NEW ORDER ;08 Jul 99 / 10:50 AM
"RTN","PSJHL9",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,18,31,42,47,50,63,72,75,58,80,110,111,134**;16 DEC 97;Build 124
"RTN","PSJHL9",3,0)
 ;
"RTN","PSJHL9",4,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192.
"RTN","PSJHL9",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJHL9",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJHL9",7,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL9",8,0)
 ; Reference to ^ORERR is supported by DBIA# 2187.
"RTN","PSJHL9",9,0)
 ; Reference to ^ORHLESC is supported by DBIA# 4922.
"RTN","PSJHL9",10,0)
 ;
"RTN","PSJHL9",11,0)
VALID ;
"RTN","PSJHL9",12,0)
 I APPL="",PSITEM="" S PSREASON="Missing or invalid Orderable Item" D ERROR Q
"RTN","PSJHL9",13,0)
 I PSITEM]"",'$D(^PS(50.7,+PSITEM,0)) S PSREASON="Missing or invalid Orderable Item" D ERROR Q
"RTN","PSJHL9",14,0)
 I $G(APPL)'["B",$G(APPL)'["A",+$G(ROUTE)'>0 S PSREASON="Missing or invalid Med Route" D ERROR Q
"RTN","PSJHL9",15,0)
 S APPL=$S($G(APPL)["B":"F",$G(APPL)["A":"F",$G(DISPENSE)]"":$$ORTYP(ROUTE,DISPENSE),1:$$TRYAGAIN(ROUTE,PSITEM))
"RTN","PSJHL9",16,0)
 S:APPL="" APPL="IP"
"RTN","PSJHL9",17,0)
 I APPL'="F" D
"RTN","PSJHL9",18,0)
 .I $G(SCHEDULE)]"" N X S X=SCHEDULE D  S SCHEDULE=X
"RTN","PSJHL9",19,0)
 ..I X[""""!($A(X)=45)!(X?.E1C.E)!($L(X," ")>3)!($L($P(X,"@"))>70)!($L($P(X,"@",2))>119)!($L(X)<1)!(X["P RN")!(X["PR N") S X="" Q
"RTN","PSJHL9",20,0)
 ..I X?.E1L.E S X=$$ENLU^PSGMI(X)
"RTN","PSJHL9",21,0)
 ..S X=$$TRIM^XLFSTR(X,"R"," ")
"RTN","PSJHL9",22,0)
 ..I X["Q0" S X="" Q
"RTN","PSJHL9",23,0)
 .I APPL["U",$G(SCHEDULE)="" S PSREASON="Missing or invalid schedule" D ERROR Q
"RTN","PSJHL9",24,0)
 .N DFN S DFN=PSJHLDFN D IN5^VADPT I 'VAIP(5) D:APPT=""  I APPL="UN",APPT="" S PSREASON="Cannot place Unit Dose orders for an Outpatient" D ERROR Q
"RTN","PSJHL9",25,0)
 .. I APPL="UP" S APPL="IN" Q
"RTN","PSJHL9",26,0)
 .. I APPL="IP" S APPL="IN" Q
"RTN","PSJHL9",27,0)
 .I $G(ROC)'="R",$G(ROUTE)'>0 S PSREASON="Missing or invalid Med Route" D ERROR Q
"RTN","PSJHL9",28,0)
 I APPL="F" D
"RTN","PSJHL9",29,0)
 .I '$O(^TMP("PSJNVO",$J,"SOL",0))&('$O(^TMP("PSJNVO",$J,"AD",0))) S PSREASON="IV Fluid orders must have at least one additive or solution" D ERROR Q
"RTN","PSJHL9",30,0)
 .I $G(IVCAT)="I",$G(INFRT)="" Q  ;Allow intermittent IV orders to have a null infusion rate.
"RTN","PSJHL9",31,0)
 .I $G(INFRT)="" S PSREASON="Invalid Infusion Rate" D ERROR Q
"RTN","PSJHL9",32,0)
 Q
"RTN","PSJHL9",33,0)
 ;
"RTN","PSJHL9",34,0)
ERROR ;Sends error msg to CPRS, logs error in OE/RR Errors file
"RTN","PSJHL9",35,0)
 S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(PSREASON,.PSJMSG)
"RTN","PSJHL9",36,0)
 D EN1^PSJHLERR(PSJHLDFN,$S(PSOC="XO":"UX",1:"OC"),$P(ORDER,U),PSREASON) S QFLG=1 K ^TMP("PSJNVO",$J)
"RTN","PSJHL9",37,0)
 Q
"RTN","PSJHL9",38,0)
 ;
"RTN","PSJHL9",39,0)
NVO ; put new orders in non-verified orders file
"RTN","PSJHL9",40,0)
 I '$D(ROUTE) S ROUTE=""
"RTN","PSJHL9",41,0)
 I $G(ROUTE)="" S:APPL="F" ROUTE=$O(^PS(51.2,"B","INTRAVENOUS",0))
"RTN","PSJHL9",42,0)
 N DA,DR,DIE D ENGNN^PSGOETO S DIE="^PS(53.1,"
"RTN","PSJHL9",43,0)
 S DR="1////"_PROVIDER_";3////"_$$ESC^ORHLESC(ROUTE)_";4////"_$E(APPL)_";28////P"_";108////"_PSITEM_";27.1////"_LOGIN_";27////"_LOGIN_";.5////"_PSJHLDFN_";.24////"_PRIORITY_";125////"_$G(PRNTON)
"RTN","PSJHL9",44,0)
 I $G(LOC)]"" S:$P($G(^SC(+LOC,0)),U,3)="C" DR=DR_";113////"_LOC_";126////"_$G(APPT)
"RTN","PSJHL9",45,0)
 I $G(IVCAT)]"" S DR=DR_";128////"_IVCAT S ADMINS=""
"RTN","PSJHL9",46,0)
 S:$G(SCHTYP)]"" DR=DR_";7////"_SCHTYP
"RTN","PSJHL9",47,0)
 D ^DIE K PSJHLSKP S NEWORDER=DA,PSJORDER=DA_"P"
"RTN","PSJHL9",48,0)
 S $P(^PS(55,PSJHLDFN,5.1),"^",2)=PROVIDER
"RTN","PSJHL9",49,0)
 S:$G(ORDER)]"" $P(^PS(53.1,DA,0),"^",21)=$P(ORDER,"^")
"RTN","PSJHL9",50,0)
 S:$G(APPL)["P" $P(^PS(53.1,DA,0),"^",13)=1
"RTN","PSJHL9",51,0)
 S $P(^PS(53.1,DA,0),"^",18)=DA
"RTN","PSJHL9",52,0)
 S:$G(ROC)]"" $P(^PS(53.1,DA,0),"^",24)=ROC
"RTN","PSJHL9",53,0)
 S:$G(PREON)]"" $P(^PS(53.1,DA,0),"^",25)=PREON
"RTN","PSJHL9",54,0)
 S:$G(ADMINS) $P(^PS(53.1,DA,2),"^",5)=ADMINS
"RTN","PSJHL9",55,0)
 S:$G(REQST)]"" $P(^PS(53.1,DA,2.5),"^")=REQST
"RTN","PSJHL9",56,0)
 ; Transform duration units of doses to a for administrations
"RTN","PSJHL9",57,0)
 S:$E(DURATION,1,5)="doses" DURATION=$TR(DURATION,"doses","a")
"RTN","PSJHL9",58,0)
 S:$G(DURATION)]"" $P(^PS(53.1,DA,2.5),"^",2)=DURATION
"RTN","PSJHL9",59,0)
 S:$G(IVLIMIT)]"" $P(^PS(53.1,DA,2.5),"^",4)=IVLIMIT
"RTN","PSJHL9",60,0)
 I $G(REQST)]"",$G(DURATION)]"" S $P(^PS(53.1,DA,2.5),"^",3)=$$STOP(REQST,DURATION)
"RTN","PSJHL9",61,0)
 S:$G(INSTR)]"" $P(^PS(53.1,DA,.3),"^")=INSTR
"RTN","PSJHL9",62,0)
 I $G(INFRT)]"" D
"RTN","PSJHL9",63,0)
 .I INFRT S:(INFRT["Minutes"!(INFRT["Hours")) INFRT="INFUSE OVER "_INFRT
"RTN","PSJHL9",64,0)
 .S ^PS(53.1,DA,8)=IVTYP_"^^^^"_INFRT
"RTN","PSJHL9",65,0)
 S:$G(FREQ)]"" $P(^PS(53.1,DA,2),"^",6)=FREQ
"RTN","PSJHL9",66,0)
 S:$G(SCHTYP)]"" $P(^PS(53.1,DA,0),"^",7)=SCHTYP
"RTN","PSJHL9",67,0)
 I $G(APPL)'="I" I $G(INSTR)]"" N X S X=INSTR D STRIP I $S(X?.E1C.E:0,$L(X)>60:0,X="":0,X["^":0,X?1.P:1,1:1) S $P(^PS(53.1,DA,.2),"^",2)=X,$P(^PS(53.1,DA,.2),"^",5,6)=$G(DOSE)_"^"_$$UNESC^ORHLESC($G(UNIT))
"RTN","PSJHL9",68,0)
 S $P(^PS(53.1,DA,.2),"^",3)=ORDCON
"RTN","PSJHL9",69,0)
 I $G(SCHEDULE)]"" S $P(^PS(53.1,DA,2),"^")=$$UNESC^ORHLESC(SCHEDULE)
"RTN","PSJHL9",70,0)
 I $G(APPL)="I" I $G(UNITS)]"" S $P(^PS(53.1,DA,.3),"^")=$$UNESC^ORHLESC(UNITS)
"RTN","PSJHL9",71,0)
 S ^PS(53.1,DA,4)="^^^^^^"_CLERK
"RTN","PSJHL9",72,0)
 I $G(DISPENSE) S ^PS(53.1,DA,1,0)="^53.11P^1^1",^PS(53.1,DA,1,1,0)=DISPENSE_"^"_$$UNESC^ORHLESC(UNITS),^PS(53.1,DA,1,"B",$E(DISPENSE,1,30),1)=""
"RTN","PSJHL9",73,0)
 I $D(PROCOM) D
"RTN","PSJHL9",74,0)
 .I '$D(^PS(53.1,DA,12,0)) S ^(0)="^53.1012^0^0"
"RTN","PSJHL9",75,0)
 .S JJ=0 F  S JJ=$O(PROCOM(JJ)) Q:'JJ  S $P(^PS(53.1,DA,12,0),"^",3,4)=JJ_"^"_JJ,^PS(53.1,DA,12,JJ,0)=$$UNESC^ORHLESC(PROCOM(JJ))
"RTN","PSJHL9",76,0)
 I $D(ADMINSTR) D
"RTN","PSJHL9",77,0)
 .I '$D(^PS(53.1,DA,3,0)) S ^(0)="^53.12^0^0"
"RTN","PSJHL9",78,0)
 .S JJ=0 F  S JJ=$O(ADMINSTR(JJ)) Q:'JJ  S $P(^PS(53.1,DA,3,0),"^",3,4)=JJ_"^"_JJ,^PS(53.1,DA,3,JJ,0)=ADMINSTR(JJ)
"RTN","PSJHL9",79,0)
 I $D(^TMP("PSJNVO",$J,"AD")) D
"RTN","PSJHL9",80,0)
 .S ^PS(53.1,DA,"AD",0)="^53.157PA^0^0"
"RTN","PSJHL9",81,0)
 .S JJ=0 F  S JJ=$O(^TMP("PSJNVO",$J,"AD",JJ)) Q:'JJ  S $P(^PS(53.1,DA,"AD",0),"^",3,4)=JJ_"^"_JJ,^PS(53.1,DA,"AD",JJ,0)=^TMP("PSJNVO",$J,"AD",JJ,0),^PS(53.1,DA,"AD","B",$$UNESC^ORHLESC($P(^TMP("PSJNVO",$J,"AD",JJ,0),"^")),JJ)=""
"RTN","PSJHL9",82,0)
 I $D(^TMP("PSJNVO",$J,"SOL")) D
"RTN","PSJHL9",83,0)
 .S ^PS(53.1,DA,"SOL",0)="^53.158PA^0^0"
"RTN","PSJHL9",84,0)
 .S JJ=0 F  S JJ=$O(^TMP("PSJNVO",$J,"SOL",JJ)) Q:'JJ  S $P(^PS(53.1,DA,"SOL",0),"^",3,4)=JJ_"^"_JJ,^PS(53.1,DA,"SOL",JJ,0)=^TMP("PSJNVO",$J,"SOL",JJ,0),^PS(53.1,DA,"SOL","B",$P(^TMP("PSJNVO",$J,"SOL",JJ,0),"^"),JJ)=""
"RTN","PSJHL9",85,0)
 I $O(^TMP("PSJNVO",$J,10,0)) D
"RTN","PSJHL9",86,0)
 .S ^PS(53.1,DA,10,0)="^53.1112A^0^0"
"RTN","PSJHL9",87,0)
 .S JJ=0 F  S JJ=$O(^TMP("PSJNVO",$J,10,JJ)) Q:'JJ  S $P(^PS(53.1,DA,10,0),"^",3,4)=JJ_"^"_JJ,^PS(53.1,DA,10,JJ,0)=$$UNESC^ORHLESC(^TMP("PSJNVO",$J,10,JJ,0)),^PS(53.1,DA,10,"B",$$UNESC^ORHLESC($E(^TMP("PSJNVO",$J,10,JJ,0),1,30)),JJ)="" D
"RTN","PSJHL9",88,0)
 ..S ^PS(53.1,DA,10,JJ,1)=$P($G(^VA(200,+CLERK,0)),"^")
"RTN","PSJHL9",89,0)
 ..I $O(^TMP("PSJNVO",$J,10,JJ,2,0)) S ^PS(53.1,DA,10,JJ,2,0)="^53.11122^0^0" D
"RTN","PSJHL9",90,0)
 ...S QQ=0 F  S QQ=$O(^TMP("PSJNVO",$J,10,JJ,2,QQ)) Q:'QQ  S $P(^PS(53.1,DA,10,JJ,2,0),"^",3,4)=QQ_"^"_QQ,^PS(53.1,DA,10,JJ,2,QQ,0)=$$UNESC^ORHLESC(^TMP("PSJNVO",$J,10,JJ,2,QQ,0))
"RTN","PSJHL9",91,0)
 Q
"RTN","PSJHL9",92,0)
STRIP ;Strips spaces off the end of instructions.
"RTN","PSJHL9",93,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSJHL9",94,0)
 Q
"RTN","PSJHL9",95,0)
 ;
"RTN","PSJHL9",96,0)
ORTYP(MDRT,DDRG)        ;Entry point to determine order type for 53.1
"RTN","PSJHL9",97,0)
 ;MDRT=Med Route from 51.2, DDRG=Dispense Drug
"RTN","PSJHL9",98,0)
 I '$G(DDRG) S ORTYP="" Q ORTYP
"RTN","PSJHL9",99,0)
 I '$D(^PSDRUG(+DDRG,2)) S ORTYP="" Q ORTYP
"RTN","PSJHL9",100,0)
 I $P(^PSDRUG(DDRG,2),"^",3)'["I",$P(^PSDRUG(DDRG,2),"^",3)'["U" S ORTYP="" Q ORTYP
"RTN","PSJHL9",101,0)
 I '$G(MDRT) S ORTYP="" Q ORTYP
"RTN","PSJHL9",102,0)
 I '$D(^PS(51.2,+MDRT,0)) S ORTYP="" Q ORTYP
"RTN","PSJHL9",103,0)
 I $P(^PSDRUG(DDRG,2),"^",3)["I",$P(^PSDRUG(DDRG,2),"^",3)'["U",$P(^PS(51.2,MDRT,0),"^",6)=1 S ORTYP="IN" Q ORTYP
"RTN","PSJHL9",104,0)
 I $P(^PSDRUG(DDRG,2),"^",3)'["I",$P(^PS(51.2,MDRT,0),"^",6)=1 S ORTYP="UP" Q ORTYP
"RTN","PSJHL9",105,0)
 I $P(^PSDRUG(DDRG,2),"^",3)["I",$P(^PS(51.2,MDRT,0),"^",6)=1 S ORTYP="IP" Q ORTYP
"RTN","PSJHL9",106,0)
 I $P(^PSDRUG(DDRG,2),"^",3)["I",$P(^PSDRUG(DDRG,2),"^",3)'["U",$P(^PS(51.2,MDRT,0),"^",6)'=1 S ORTYP="IP" Q ORTYP
"RTN","PSJHL9",107,0)
 I $P(^PSDRUG(DDRG,2),"^",3)["U",$P(^PSDRUG(DDRG,2),"^",3)'["I",$P(^PS(51.2,MDRT,0),"^",6)'=1 S ORTYP="UN" Q ORTYP
"RTN","PSJHL9",108,0)
 I $P(^PSDRUG(DDRG,2),"^",3)["U",$P(^PS(51.2,MDRT,0),"^",6)'=1 S ORTYP="UP" Q ORTYP
"RTN","PSJHL9",109,0)
 S ORTYP="" Q ORTYP
"RTN","PSJHL9",110,0)
 ;
"RTN","PSJHL9",111,0)
TRYAGAIN(MDRT,OI)       ;
"RTN","PSJHL9",112,0)
 ;MDRT=Med Route from 51.2, OI=Orderable Item
"RTN","PSJHL9",113,0)
 N ORTYPI,ORTYPU,ORTYPP
"RTN","PSJHL9",114,0)
 S ORTYP="",ORTYPI=0,ORTYPU=0,ORTYPP=0
"RTN","PSJHL9",115,0)
 N DDRG S DDRG=0 F  S DDRG=$O(^PSDRUG("ASP",OI,DDRG)) Q:'DDRG  D 
"RTN","PSJHL9",116,0)
 .I $G(^PSDRUG(DDRG,"I"))]"" Q:^PSDRUG(DDRG,"I")'>DT
"RTN","PSJHL9",117,0)
 .S ORTYP=$$ORTYP(MDRT,DDRG)  D
"RTN","PSJHL9",118,0)
 ..I ORTYP["I" S ORTYPI=ORTYPI+1
"RTN","PSJHL9",119,0)
 ..I ORTYP["U" S ORTYPU=ORTYPU+1
"RTN","PSJHL9",120,0)
 ..I ORTYP["P" S ORTYPP=ORTYPP+1
"RTN","PSJHL9",121,0)
 S ORTYP=$S(ORTYPU>ORTYPI:"U",1:"I") S ORTYP=ORTYP_$S(ORTYPP>0:"P",1:"N")
"RTN","PSJHL9",122,0)
 Q ORTYP
"RTN","PSJHL9",123,0)
 ;
"RTN","PSJHL9",124,0)
STOP(REQST,DURA)   ;
"RTN","PSJHL9",125,0)
 ;REQST=Requested start date, DURA=Duration from CPRS
"RTN","PSJHL9",126,0)
 I DURA["L",DURA?1A1".".N S DAYS=$$DAY($E(REQST,1,5)),DURA="H"_((DAYS*$P(DURA,"L",2))*24)
"RTN","PSJHL9",127,0)
 I DURA["L",DURA?1A.1N.N1"."1N.N D  Q STOP
"RTN","PSJHL9",128,0)
 .S NUM=$E(REQST,4,5)+$P($P(DURA,"."),"L",2),NUM=$S(NUM<10:"0"_NUM,NUM<13:NUM,1:$S((NUM-12)<10:"0"_(NUM-12),1:(NUM-12))),DATE=$E(REQST,1,3)_NUM
"RTN","PSJHL9",129,0)
 .S DAYS=$$DAY(DATE),STOP=$$SCH^XLFDT($P($P(DURA,"."),"L",2)_"M",$P(REQST,"."))_"."_$P(REQST,".",2),DEL=$P($P(DURA,"L",2),"."),STOP=$$FMADD^XLFDT(STOP,"",((DAYS*$P(DURA,DEL,2))*24))
"RTN","PSJHL9",130,0)
 I DURA["L" S STOP=$P($$SCH^XLFDT($P(DURA,"L",2)_"M",$P(REQST,".")),".")_"."_$P(REQST,".",2) Q STOP
"RTN","PSJHL9",131,0)
 I DURA["W",DURA["." S DURA="H"_(($P(DURA,"W",2)*7)*24)
"RTN","PSJHL9",132,0)
 I DURA["D",DURA["." S DURA="H"_($P(DURA,"D",2)*24)
"RTN","PSJHL9",133,0)
 I +DURA=DURA,DURA["." S DURA="H"_(DURA*24)
"RTN","PSJHL9",134,0)
 S STOP=$$FMADD^XLFDT(REQST,$S(DURA["W":$P(DURA,"W",2)*7,DURA["D":$P(DURA,"D",2),+DURA=DURA:+DURA,1:""),$S(DURA["H":$P(DURA,"H",2),1:""),$S(DURA["M":$P(DURA,"M",2),1:""),$S(DURA["S":$P(DURA,"S",2),1:""))
"RTN","PSJHL9",135,0)
 Q STOP
"RTN","PSJHL9",136,0)
ZQDATE(DATE,MONTHS)  ;BUMP DATE BY A MONTH (OR SO)
"RTN","PSJHL9",137,0)
 ;;
"RTN","PSJHL9",138,0)
 S X=$E($P(DATE,"."),1,5)+($E($P(DATE,"."),4,5)>(12-MONTHS)*88+MONTHS)_$E($P(DATE,"."),6,7) F  D ^%DT Q:Y>0  S X=X-1
"RTN","PSJHL9",139,0)
 S NEWDATE=X_"."_$P(DATE,".",2)
"RTN","PSJHL9",140,0)
 Q NEWDATE
"RTN","PSJHL9",141,0)
DAY(DATE) ;DATE=FIRST FIVE DIGITS OF FM DATE
"RTN","PSJHL9",142,0)
 N X
"RTN","PSJHL9",143,0)
 I DATE'?5N Q -1
"RTN","PSJHL9",144,0)
 S X=$E(DATE,4,5) I X<1!(X>12) Q -1
"RTN","PSJHL9",145,0)
 S X=DATE+1+(X=12*88)_"01"
"RTN","PSJHL9",146,0)
 Q $E($$FMADD^XLFDT(X,-1),6,7)
"RTN","PSJHLU")
0^8^B34501644
"RTN","PSJHLU",1,0)
PSJHLU ;BIR/RLW-UTILITIES USED IN BUILDING HL7 SEGMENTS ;20 Apr 98 / 9:58 AM
"RTN","PSJHLU",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,56,72,102,134**;16 DEC 97;Build 124
"RTN","PSJHLU",3,0)
 ;
"RTN","PSJHLU",4,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJHLU",5,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJHLU",6,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSJHLU",7,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHLU",8,0)
 ;
"RTN","PSJHLU",9,0)
INIT ; set up HL7 application variables
"RTN","PSJHLU",10,0)
 S PSJHLSDT="PS",PSJHINST=$P($$SITE^VASITE(),"^")
"RTN","PSJHLU",11,0)
 S PSJCLEAR="K FIELD F J=0:1:LIMIT S FIELD(J)="""""
"RTN","PSJHLU",12,0)
 Q
"RTN","PSJHLU",13,0)
 ;
"RTN","PSJHLU",14,0)
SEGMENT(LIMIT) ;
"RTN","PSJHLU",15,0)
 K SEGMENT
"RTN","PSJHLU",16,0)
 N SUBSEG,SEGLENGT S SUBSEG=0,SEGMENT="" F J=0:1:LIMIT D
"RTN","PSJHLU",17,0)
 .I SEGMENT']"" S SEGMENT=FIELD(J) Q
"RTN","PSJHLU",18,0)
 .S SEGMENT=SEGMENT_"|"_FIELD(J)
"RTN","PSJHLU",19,0)
 F  S SEGLENGT=$L(SEGMENT) D  Q:$L(SEGMENT)'>246
"RTN","PSJHLU",20,0)
 .I SEGLENGT'>246 S SEGMENT(SUBSEG)=SEGMENT
"RTN","PSJHLU",21,0)
 .I SEGLENGT>245 S SEGMENT(SUBSEG)=$E(SEGMENT,1,245),SUBSEG=SUBSEG+1 D
"RTN","PSJHLU",22,0)
 ..S SEGMENT=$E(SEGMENT,246,SEGLENGT),SEGMENT(SUBSEG)=$E(SEGMENT,1,245)
"RTN","PSJHLU",23,0)
SET S PSJI=PSJI+1,^TMP("PSJHLS",$J,PSJHLSDT,PSJI)=SEGMENT(0)
"RTN","PSJHLU",24,0)
 F J=1:1 Q:'$D(SEGMENT(J))  S ^TMP("PSJHLS",$J,PSJHLSDT,PSJI,J)=SEGMENT(J)
"RTN","PSJHLU",25,0)
 Q
"RTN","PSJHLU",26,0)
 ;
"RTN","PSJHLU",27,0)
SEGMENT2 ; Retrieve text fields
"RTN","PSJHLU",28,0)
 K SEGMENT S JJ=0 F  S JJ=$O(@(PSJORDER_"12,"_JJ_")")) Q:'JJ  S SEGMENT(JJ-1)=$G(@(PSJORDER_"12,"_JJ_",0)"))
"RTN","PSJHLU",29,0)
 I $D(SEGMENT(0)) S SEGMENT(0)="NTE|6|L|"_$S($G(PSJBCBU):SEGMENT(0),1:$$ESC^ORHLESC(SEGMENT(0))) D
"RTN","PSJHLU",30,0)
 .D SET^PSJHLU K SEGMENT,JJ
"RTN","PSJHLU",31,0)
 I $P($G(@(PSJORDER_"6)")),"^")]"" K SEGMENT S SEGMENT(0)="NTE|21|L|"_$S($G(PSJBCBU):$P($G(@(PSJORDER_"6)")),"^"),1:$$ESC^ORHLESC($P($G(@(PSJORDER_"6)")),"^"))) D
"RTN","PSJHLU",32,0)
 .D SET^PSJHLU K SEGMENT
"RTN","PSJHLU",33,0)
 I PSJORDER["P",$P($G(@(PSJORDER_"9)")),"^",2)]"" K SEGMENT S SEGMENT(0)="NTE|21|L|"_$S($G(PSJBCBU):$P($G(@(PSJORDER_"9)")),"^",2),1:$$ESC^ORHLESC($P($G(@(PSJORDER_"9)")),"^",2))) D
"RTN","PSJHLU",34,0)
 .D SET^PSJHLU K SEGMENT
"RTN","PSJHLU",35,0)
 Q
"RTN","PSJHLU",36,0)
 ;
"RTN","PSJHLU",37,0)
CALL(HLEVN) ; call DHCP HL7 package -or- protocol, to pass Orders
"RTN","PSJHLU",38,0)
 ; HLEVN = number of segments in message
"RTN","PSJHLU",39,0)
 K CLERK,DDIEN,DDNUM,DOSEFORM,DOSEOR,FIELD,IVTYPE,LIMIT,NAME,NDNODE,NODE1,NODE2,PRODNAME,PROVIDER,PSGS0Y,PSJHINST,PSJHLSDT,PSJI,PSJORDER,PSOC,PSREASON,ROOMBED,SPDIEN,SEGMENT
"RTN","PSJHLU",40,0)
 I $G(PSJBCBU)=1 M PSJNAME=^TMP("PSJHLS",$J,"PS") Q
"RTN","PSJHLU",41,0)
 S PSJMSG="^TMP(""PSJHLS"",$J,""PS"")"
"RTN","PSJHLU",42,0)
 D MSG^XQOR("PS EVSEND OR",.PSJMSG)
"RTN","PSJHLU",43,0)
 Q
"RTN","PSJHLU",44,0)
 ;
"RTN","PSJHLU",45,0)
IVTYPE(PSJORDER) ; check whether a back-door order is Inpatient IV or IV fluid
"RTN","PSJHLU",46,0)
 I RXORDER["V",$P($G(@(PSJORDER_"0)")),"^",4)'="A" Q "I"
"RTN","PSJHLU",47,0)
 I RXORDER["P" I $P($G(@(PSJORDER_"0)")),"^",4)'="F" S IVTYPE="" Q IVTYPE
"RTN","PSJHLU",48,0)
 N SUB,AD,SOL,IVTYPE,NODE1 S SUB=0,IVTYPE="F"
"RTN","PSJHLU",49,0)
 ;naked reference on line below refers to the full indirect reference of PSJORDER_ which is from ^PS(55,DFN,"IV",PSJORD
"RTN","PSJHLU",50,0)
 F TYPE="AD","SOL" S SUB=0 F  S SUB=$O(@(PSJORDER_""""_TYPE_""""_","_SUB_")")) Q:(SUB="")!(IVTYPE="I")  S NODE1=$G(^(SUB,0)) Q:NODE1=""  D  Q:IVTYPE="I"
"RTN","PSJHLU",51,0)
 .I TYPE="AD" D
"RTN","PSJHLU",52,0)
 ..I '$P($G(^PS(52.6,$P(NODE1,"^"),0)),"^",13) S IVTYPE="I"
"RTN","PSJHLU",53,0)
 .D:TYPE="SOL"
"RTN","PSJHLU",54,0)
 ..S:'$P($G(^PS(52.7,$P(NODE1,"^"),0)),"^",13) IVTYPE="I"
"RTN","PSJHLU",55,0)
 Q IVTYPE
"RTN","PSJHLU",56,0)
ENI ;Calculate Frequency for IV orders
"RTN","PSJHLU",57,0)
 N INFUSE
"RTN","PSJHLU",58,0)
 I X?.E1L.E S INFUSE=$$ENLU^PSGMI(X) Q:(INFUSE="TITRATE")!(INFUSE="BOLUS")!($P(INFUSE," ")="INFUSE")!($P(INFUSE," ")="Infuse")
"RTN","PSJHLU",59,0)
 Q:(X="TITRATE")!(X="BOLUS")!($P(X," ")="INFUSE")!($P(X," ")="Infuse")
"RTN","PSJHLU",60,0)
 Q:$$INTRMT(X)
"RTN","PSJHLU",61,0)
 K:$L(X)<1!($L(X)>30)!(X["""")!($A(X)=45) X I '$D(X) Q
"RTN","PSJHLU",62,0)
 I X["=" D  Q   ; NOIS LOU-0501-42191
"RTN","PSJHLU",63,0)
 .N X2,X1 S X1=$P(X,"="),X2=$P(X,"=",2)
"RTN","PSJHLU",64,0)
 .I X1["ML/HR",(+X1=$P(X1,"ML/HR"))!(+X1=$P(X1," ML/HR")) D
"RTN","PSJHLU",65,0)
 ..S X1=$TR(X1,"ML/HR","ml/hr")
"RTN","PSJHLU",66,0)
 .I X2["ML/HR",(+X2=$P(X2,"ML/HR"))!(+X2=$P(X2," ML/HR")) D
"RTN","PSJHLU",67,0)
 ..S X2=$TR(X2,"ML/HR","ml/hr")
"RTN","PSJHLU",68,0)
 .I X1[" ml/hr",(+X1=$P(X1," ml/hr")) D
"RTN","PSJHLU",69,0)
 ..S X1=$P(X1," ml/hr")_$P(X1," ml/hr",2,9999)
"RTN","PSJHLU",70,0)
 .I X2[" ml/hr",(+X2=$P(X2," ml/hr")) D
"RTN","PSJHLU",71,0)
 ..S X2=$P(X2," ml/hr")_$P(X2," ml/hr",2,9999)
"RTN","PSJHLU",72,0)
 .I X1["ml/hr",(+X1=$P(X1,"ml/hr")) D
"RTN","PSJHLU",73,0)
 ..S X1=$P(X1,"ml/hr")_$P(X1,"ml/hr",2,9999)
"RTN","PSJHLU",74,0)
 .I X2["ml/hr",(+X2=$P(X2,"ml/hr")) D
"RTN","PSJHLU",75,0)
 ..S X2=$P(X2,"ml/hr")_$P(X2,"ml/hr",2,9999)
"RTN","PSJHLU",76,0)
 .I X2'=+X2 D
"RTN","PSJHLU",77,0)
 ..I ($P(X2,"@",2,999)'=+$P(X2,"@",2,999)!(+$P(X2,"@",2,999)<0)) K X Q
"RTN","PSJHLU",78,0)
 .I X1=+X1 S X1=X1_" ml/hr"
"RTN","PSJHLU",79,0)
 .I X2=+X2 S X2=X2_" ml/hr"
"RTN","PSJHLU",80,0)
 .S:$P(X2,"@")=+X2 $P(X2,"@")=$P(X2,"@")_" ml/hr"
"RTN","PSJHLU",81,0)
 .S X=X1_"="_X2
"RTN","PSJHLU",82,0)
 I X'=+X,($P($TR(X," ml/hr",""),"@",2,999)'=+$P($TR(X," ml/hr",""),"@",2,999)!(+$P(X,"@",2,999)<0)),($P(X," ml/hr")'=+$P(X," ml/hr")!(+$P(X," ml/hr")<0)) Q:(X>0&($E(X)=0))  K X Q
"RTN","PSJHLU",83,0)
 I X=+X!(X>0&($E(X)=0)) S X=X_" ml/hr" D SPSOL S FREQ=$S('X:0,1:SPSOL\X*60+(SPSOL#X/X*60+.5)\1) K SPSOL Q
"RTN","PSJHLU",84,0)
 I X[" ml/hr" D SPSOL S FREQ=$S('X:0,1:SPSOL\X*60+(SPSOL#X/X*60+.5)\1) K SPSOL Q
"RTN","PSJHLU",85,0)
 S SPSOL=$P(X,"@",2) S:$P(X,"@")=+X $P(X,"@")=$P(X,"@")_" ml/hr" S FREQ=$S('SPSOL:0,1:1440/SPSOL\1) K SPSOL
"RTN","PSJHLU",86,0)
 Q
"RTN","PSJHLU",87,0)
SPSOL S SPSOL=+TVOLUME Q
"RTN","PSJHLU",88,0)
INTRMT(X) ;
"RTN","PSJHLU",89,0)
 Q:'$P(X," ") 0
"RTN","PSJHLU",90,0)
 Q:$P(X," ",2)="Minutes" 1
"RTN","PSJHLU",91,0)
 Q:$P(X," ",2)="Hours" 1
"RTN","PSJHLU",92,0)
 Q 0
"RTN","PSJHLU",93,0)
IVCAT(DFN,PSJORD,PARRAY) ; This returns the IV CATEGORY based on the IV TYPE and CHEMO TYPE (not what is already in the IV CATEGORY field)
"RTN","PSJHLU",94,0)
 ;  Passed in:  PSJORDER (file root of order)
"RTN","PSJHLU",95,0)
 N NODE,TYP,CHEMTYP,INTSYR,ND2P5
"RTN","PSJHLU",96,0)
 S (CHEMTYP,INTSYR)=""
"RTN","PSJHLU",97,0)
 S TYP=$G(P(4)),INTSYR=$G(P(5)),CHEMTYP=$G(P(23))
"RTN","PSJHLU",98,0)
 I TYP="",$G(PSJORD)["V" S NODE=$G(^PS(55,DFN,"IV",+PSJORD,0)) S TYP=$P(NODE,"^",4),INTSYR=$P(NODE,"^",5),CHEMTYP=$P(NODE,"^",23)
"RTN","PSJHLU",99,0)
 I TYP="",$G(PSJORD)["P" S NODE=$G(^PS(53.1,+PSJORD,8)) S TYP=$P(NODE,"^"),INTSYR=$P(NODE,"^",4),CHEMTYP=$P(NODE,"^",2)
"RTN","PSJHLU",100,0)
 I TYP="" S TYP=$G(PARRAY(4)),INTSYR=$G(PARRAY(5)),CHEMTYP=$G(PARRAY(23))
"RTN","PSJHLU",101,0)
 Q:$G(TYP)="" ""
"RTN","PSJHLU",102,0)
 S CAT=$S(",A,H,"[(","_TYP_","):"C",TYP="C"&(",A,H,S,"[(","_CHEMTYP_",")&'INTSYR):"C",TYP="C"&(CHEMTYP="P"):"I",TYP="S"&'INTSYR:"C",TYP="P":"I",$G(INTSYR):"I",1:"")
"RTN","PSJHLU",103,0)
 Q CAT
"RTN","PSJHLU",104,0)
ZRX ; Perform outbound processing
"RTN","PSJHLU",105,0)
 S LIMIT=6 X PSJCLEAR
"RTN","PSJHLU",106,0)
 S FIELD(0)="ZRX"
"RTN","PSJHLU",107,0)
 I '$G(PSJREN) N PREON,PSJREN I $G(PSJORD)["U"&($P(NODE1,"^",24)="R") S PSJREN=1
"RTN","PSJHLU",108,0)
 I $G(PSJORD)["V"&($P(NODE2,"^",8)="R") S PSJREN=1
"RTN","PSJHLU",109,0)
 S PREON=$S($G(PSJREN):$G(PSJORD),PSJORDER["IV":$P(NODE2,"^",5),1:$P(NODE1,"^",25))
"RTN","PSJHLU",110,0)
 S FIELD(1)=$S(PREON["P":$P($G(^PS(53.1,+PREON,0)),"^",21),PREON["V":$P($G(^PS(55,PSJHLDFN,"IV",+PREON,0)),"^",21),1:$P($G(^PS(55,PSJHLDFN,5,+PREON,0)),"^",21))
"RTN","PSJHLU",111,0)
 S FIELD(2)=$S(PSJORDER["IV":$G(P("NAT")),1:$G(PSJNOO))
"RTN","PSJHLU",112,0)
 S FIELD(3)=$S($G(PSJREN):"R",PSJORDER["IV":$P(NODE2,"^",8),1:$P(NODE1,"^",24))
"RTN","PSJHLU",113,0)
 I FIELD(3)="" I PSOC="SN" S FIELD(3)="N"
"RTN","PSJHLU",114,0)
 I $D(P)>1 S FIELD(6)=$$IVCAT^PSJHLU(PSJHLDFN,RXORDER,.P)
"RTN","PSJHLU",115,0)
 S NAME=$P($G(^VA(200,DUZ,0)),"^")
"RTN","PSJHLU",116,0)
 S FIELD(5)=DUZ_"^"_$S($G(PSJBCBU):NAME,1:$$ESC^ORHLESC(NAME))_"^"_"99NP"
"RTN","PSJHLU",117,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHLU",118,0)
 Q
"RTN","PSJLIACT")
0^37^B40055313
"RTN","PSJLIACT",1,0)
PSJLIACT ;BIR/MV-IV ACTION ;28 Jul 98 / 8:50 AM
"RTN","PSJLIACT",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**15,47,62,58,82,97,80,110,111,134**;16 DEC 97;Build 124
"RTN","PSJLIACT",3,0)
 ;
"RTN","PSJLIACT",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJLIACT",5,0)
 ; Reference to MAIN^TIUEDIT is supported by DBIA 2410.
"RTN","PSJLIACT",6,0)
 ;
"RTN","PSJLIACT",7,0)
DC ; Discontinue order
"RTN","PSJLIACT",8,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",9,0)
 S PSJCOM=+$S(PSJORD["V":$P($G(^PS(55,DFN,"IV",+PSJORD,.2)),"^",8),1:$P($G(^PS(53.1,+PSJORD,.2)),"^",8))
"RTN","PSJLIACT",10,0)
 I PSJCOM W !!,"This order is part of a complex order. If you discontinue this order the",!,"following orders will be discontinued too (unless the stop date has already",!,"been reached)." D CMPLX^PSJCOM1(PSGP,PSJCOM,PSJORD)
"RTN","PSJLIACT",11,0)
 I PSJCOM F  W !!,"Do you want to discontinue this order" S %=1 D YN^DICN Q:%  D ENCOM^PSGOEM
"RTN","PSJLIACT",12,0)
 I PSJCOM,%'=1 S VALMBK="" Q
"RTN","PSJLIACT",13,0)
 I PSJORD["V" D DC^PSIVORA,EN^PSJLIORD(DFN,ON) Q
"RTN","PSJLIACT",14,0)
 D:PSJORD["P" DISCONT^PSIVORC
"RTN","PSJLIACT",15,0)
 S VALMBCK="Q"
"RTN","PSJLIACT",16,0)
 Q
"RTN","PSJLIACT",17,0)
ACEDIT ; Display LM screen and AC and EDit actions
"RTN","PSJLIACT",18,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",19,0)
 S VALMBCK=$S($G(PSIVACEP):"Q",1:"R")
"RTN","PSJLIACT",20,0)
 Q
"RTN","PSJLIACT",21,0)
AEEXIT ; Call for EXIT CODE in PSJ LM IV AC/EDIT
"RTN","PSJLIACT",22,0)
 D:ON["V" GT55^PSIVORFB
"RTN","PSJLIACT",23,0)
 I ON["P" D GT531^PSIVORFA(DFN,ON) D:P("OT")'="I" GTDATA^PSJLIFN
"RTN","PSJLIACT",24,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",25,0)
 K PSIVENO
"RTN","PSJLIACT",26,0)
 Q
"RTN","PSJLIACT",27,0)
EDIT ; Edit order
"RTN","PSJLIACT",28,0)
 K PSIVFN1 NEW PSIVNBD
"RTN","PSJLIACT",29,0)
 I $D(PSGACT),PSGACT'["E" W !,"This order may not be edited." D PAUSE^VALM1 Q
"RTN","PSJLIACT",30,0)
 D EDIT1
"RTN","PSJLIACT",31,0)
 Q:$D(PSIVNBD)!($G(PSIVCOPY)&'$G(PSIVENO))
"RTN","PSJLIACT",32,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",33,0)
 S VALMBCK=$S($G(PSIVFN1):"Q",1:"R")
"RTN","PSJLIACT",34,0)
 Q
"RTN","PSJLIACT",35,0)
EDIT1 ;
"RTN","PSJLIACT",36,0)
 ;Ensure P() is defined
"RTN","PSJLIACT",37,0)
 I $D(P)<10 S XQORQUIT=1,P("PON")="",PSIVNBD=1 D  Q
"RTN","PSJLIACT",38,0)
 .W !,"WARNING: An error has occurred. Changes will not be saved"
"RTN","PSJLIACT",39,0)
 .D PAUSE^VALM1
"RTN","PSJLIACT",40,0)
 .S VALMBCK="Q"
"RTN","PSJLIACT",41,0)
 I "ANP"'[P(17) W !,"You cannot edit an inactive order" D PAUSE^VALM1 Q
"RTN","PSJLIACT",42,0)
 S:$G(ON55)="" ON55=$G(PSJORD)
"RTN","PSJLIACT",43,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",44,0)
 ;* Edit a new back door order
"RTN","PSJLIACT",45,0)
 I ($G(ON55)["V"&($G(P("21FLG"))="")) D  Q
"RTN","PSJLIACT",46,0)
 . D GSTRING^PSIVORE1,GTFLDS^PSIVORFE
"RTN","PSJLIACT",47,0)
 . I $G(ON55)["V",'$G(DONE) D OK^PSIVORE
"RTN","PSJLIACT",48,0)
 . S VALMBCK="Q",PSIVNBD=1
"RTN","PSJLIACT",49,0)
 ;* Edit an active order
"RTN","PSJLIACT",50,0)
 I $G(ON55)["V" NEW PSJEDIT1 D E^PSIVOPT1 D  Q
"RTN","PSJLIACT",51,0)
 . I $G(PSJIVBD) K PSJIVBD D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",52,0)
 I $G(ON55)["P" D EDIT^PSIVORC ;Edit incomplete order.
"RTN","PSJLIACT",53,0)
 K P("OVRIDE")
"RTN","PSJLIACT",54,0)
 Q
"RTN","PSJLIACT",55,0)
ACCEPT ; Accept order
"RTN","PSJLIACT",56,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",57,0)
 ;Accept IV from back door.
"RTN","PSJLIACT",58,0)
 I $G(PSJIVBD) K PSJIVBD D OK^PSIVORE S VALMBCK="Q" Q
"RTN","PSJLIACT",59,0)
 I ON["V" D ACCEPT^PSIVOPT1 Q
"RTN","PSJLIACT",60,0)
 S PSIVFN1=1
"RTN","PSJLIACT",61,0)
 D COMPLTE^PSIVORC1
"RTN","PSJLIACT",62,0)
 S VALMBCK="Q"
"RTN","PSJLIACT",63,0)
 Q
"RTN","PSJLIACT",64,0)
R ; Renewal
"RTN","PSJLIACT",65,0)
 S PSJREN=1
"RTN","PSJLIACT",66,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",67,0)
 NEW PSIVAC S PSIVAC="PR" K PSGFDX
"RTN","PSJLIACT",68,0)
 D R^PSIVOPT
"RTN","PSJLIACT",69,0)
 D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",70,0)
 K PSJREN
"RTN","PSJLIACT",71,0)
 Q
"RTN","PSJLIACT",72,0)
H ; Hold
"RTN","PSJLIACT",73,0)
 NEW TEX S TEX="Active order ***"
"RTN","PSJLIACT",74,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",75,0)
 D H^PSIVOPT(DFN,ON,P(17),P(3))
"RTN","PSJLIACT",76,0)
 D:P(17)="A" PAUSE^VALM1
"RTN","PSJLIACT",77,0)
 D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",78,0)
 Q
"RTN","PSJLIACT",79,0)
L ; Activity Log
"RTN","PSJLIACT",80,0)
 NEW PSIVLAB,PSIVLOG,PSJHIS S (PSIVLAB,PSIVLOG)=1
"RTN","PSJLIACT",81,0)
 D EN^PSIVVW1
"RTN","PSJLIACT",82,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",83,0)
 S VALMBCK="R"
"RTN","PSJLIACT",84,0)
 Q
"RTN","PSJLIACT",85,0)
O ; On Call
"RTN","PSJLIACT",86,0)
 NEW TEX S TEX="Active order ***"
"RTN","PSJLIACT",87,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",88,0)
 D O^PSIVOPT(DFN,ON,P(17),P(3))
"RTN","PSJLIACT",89,0)
 D:P(17)="A" PAUSE^VALM1
"RTN","PSJLIACT",90,0)
 D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",91,0)
 Q
"RTN","PSJLIACT",92,0)
VF ; Make the order active
"RTN","PSJLIACT",93,0)
 NEW PSIVCHG S PSIVCHG=0
"RTN","PSJLIACT",94,0)
 I ON["V" S ON55=ON D VF1("V","ORDER VERIFIED BY ",1) Q
"RTN","PSJLIACT",95,0)
 D ACTIVE^PSIVORC2
"RTN","PSJLIACT",96,0)
 Q
"RTN","PSJLIACT",97,0)
VF1(PSIVREA,PSIVAL,PSIVLOG) ;
"RTN","PSJLIACT",98,0)
 ;Update 4 node and set activity log.
"RTN","PSJLIACT",99,0)
 ;PSIVREA: the reason use by LOG^PSIVORAL
"RTN","PSJLIACT",100,0)
 ;PSIVAL : the description reason
"RTN","PSJLIACT",101,0)
 ;PSIVLOG: Log an activity if = 1
"RTN","PSJLIACT",102,0)
 I '+$G(OD)!($L($G(OD))>16) K OD
"RTN","PSJLIACT",103,0)
 D:+PSJSYSU=3 ^PSIVORE1
"RTN","PSJLIACT",104,0)
 NEW DIE,DA,DR,PSJX,XX,PSIVACT,PSJRQND
"RTN","PSJLIACT",105,0)
 S PSIVACT=1
"RTN","PSJLIACT",106,0)
 S PSJX=$G(^PS(55,DFN,"IV",+ON55,4)),XX=""
"RTN","PSJLIACT",107,0)
 I $P(PSJX,U)="" S XX=";143////0"
"RTN","PSJLIACT",108,0)
 I $P(PSJX,U,4)="" S XX=XX_U_";142////0"
"RTN","PSJLIACT",109,0)
 D NOW^%DTC
"RTN","PSJLIACT",110,0)
 S DIE="^PS(55,"_DFN_",""IV"",",DA=+ON55,DA(1)=DFN
"RTN","PSJLIACT",111,0)
 I +PSJSYSU=3 S DR="140////"_DUZ_";141////"_$E(%,1,12)_";142////1"_$P(XX,U)
"RTN","PSJLIACT",112,0)
 I +PSJSYSU=1 S DR="16////"_DUZ_";17////"_$E(%,1,12)_";143////1"_$P(XX,U,2)
"RTN","PSJLIACT",113,0)
 I $G(P("PRY"))="D" S DR=DR_";.22////"_+P("IVRM")
"RTN","PSJLIACT",114,0)
 D ^DIE
"RTN","PSJLIACT",115,0)
 ; If pending IV renew is edited during finish, go back and DE the original active order left in RENEWED status
"RTN","PSJLIACT",116,0)
 S PREREN=$S(ON55["V":$G(@(DIE_"+ON55,2)")),1:""),PREREN=$P(PREREN,"^",5) I PREREN D  K PREREN
"RTN","PSJLIACT",117,0)
 . I PREREN["P" S PREREN=$G(@("^PS(53.1,+PREREN,0)")),PREREN=$P(PREREN,"^",25)
"RTN","PSJLIACT",118,0)
 . I PREREN["V" N PRERENOD S PRERENOD=$G(@("^PS(55,DFN,""IV"",+PREREN,0)")) I $P(PRERENOD,"^",17)="R",($G(P("RES"))="E") D
"RTN","PSJLIACT",119,0)
 ..  S DIE="^PS(55,"_DFN_",""IV"",",DA=+PREREN,DA(1)=DFN
"RTN","PSJLIACT",120,0)
 ..  S DR="100////D;.03////"_PSGDT S ORIGSTOP=$P($G(@("^PS(55,DFN,""IV"",+PREREN,2)")),"^",3) I ORIGSTOP S DR=DR_";116////"_ORIGSTOP
"RTN","PSJLIACT",121,0)
 ..  D ^DIE D EN1^PSJHL2(DFN,"SC",PREREN)
"RTN","PSJLIACT",122,0)
 K DR,DIE,DA
"RTN","PSJLIACT",123,0)
 I (+PSJSYSU=3)&($G(P("PRY"))="D") D
"RTN","PSJLIACT",124,0)
 .N DIR W ! S DIR(0)="S^Y:Yes;N:No",DIR("A")="Do you want to enter a Progress Note",DIR("B")="No" D ^DIR
"RTN","PSJLIACT",125,0)
 .Q:Y="N"
"RTN","PSJLIACT",126,0)
 .D MAIN^TIUEDIT(3,.TIUDA,DFN,"","","","",1)
"RTN","PSJLIACT",127,0)
 Q:'$G(PSIVLOG)
"RTN","PSJLIACT",128,0)
 I $G(P("PACT"))]"",+$P(P("PACT"),U,2),+$P(P("PACT"),U,3) D
"RTN","PSJLIACT",129,0)
 . NEW DIC,DA,X,Y,XX,DO D NAME^PSJBCMA1($P(P("PACT"),U,2),.XX)
"RTN","PSJLIACT",130,0)
 . S DIC(0)="L",DA(1)=DFN,DA(2)=+ON55,X=1
"RTN","PSJLIACT",131,0)
 . S DIC="^PS(55,"_DA(1)_",""IV"","_DA(2)_",""A"","
"RTN","PSJLIACT",132,0)
 . S DIC("DR")=".02////F;.03////"_XX_";.04////"_$P($G(^PS(53.3,+$P(P("PACT"),U,3),0)),U)_";.05////"_$P(P("PACT"),U)_";.06////"_$P(P("PACT"),U,2)
"RTN","PSJLIACT",133,0)
 . D FILE^DICN
"RTN","PSJLIACT",134,0)
 NEW PSIVALCK
"RTN","PSJLIACT",135,0)
 S PSIVREA="V",PSIVALT=""
"RTN","PSJLIACT",136,0)
 S PSIVAL=PSIVAL_$S(+PSJSYSU=3:"PHARMACIST",1:"NURSE")
"RTN","PSJLIACT",137,0)
 D LOG^PSIVORAL K PSIVAL,PSIVREA,PSIVLN
"RTN","PSJLIACT",138,0)
 I $G(PSJORD)["P" S PSIVREA="V",PSIVALT="",PSGRDTX=$G(^PS(53.1,+PSJORD,2.5)) D
"RTN","PSJLIACT",139,0)
 . I $G(PSGRDTX) S PSIVAL="Requested Start Date: "_$$ENDTC^PSGMI($$DATE2^PSJUTL2($P(PSGRDTX,U))) D LOG^PSIVORAL
"RTN","PSJLIACT",140,0)
 . I $P(PSGRDTX,U,3) S PSIVREA="V",PSIVALT="" S PSIVAL="Requested Stop Date: "_$$ENDTC^PSGMI($$DATE2^PSJUTL2($P(PSGRDTX,U,3))) D LOG^PSIVORAL
"RTN","PSJLIACT",141,0)
 N DUR I $G(PSJORD) S DUR=$$GETDUR^PSJLIVMD(DFN,+PSJORD,$S(PSJORD["P":"P",1:"IV"),1) I DUR]""  D
"RTN","PSJLIACT",142,0)
 . K DR S DIE="^PS(55,"_DFN_",""IV"",",DA=+ON55,DA(1)=DFN
"RTN","PSJLIACT",143,0)
 . S DR=$S($G(IVLIMIT):"152////"_DUR,1:"151////"_DUR) K IVLIMIT
"RTN","PSJLIACT",144,0)
 . D ^DIE
"RTN","PSJLIACT",145,0)
 D EN1^PSJHL2(DFN,"SC",ON55)
"RTN","PSJLIACT",146,0)
 D:+PSJSYSU=1 EN1^PSJHL2(DFN,"ZV",ON55)
"RTN","PSJLIACT",147,0)
 D GT55^PSIVORFB S OLDON=$P($G(^PS(55,DFN,"IV",+ON55,2)),"^",5),P("OLDON")=OLDON
"RTN","PSJLIACT",148,0)
 N PSJPRIO,PSJSCH,NODE0,NODEP2 S NODE0=$G(^PS(55,DFN,"IV",+ON55,0)),NODEP2=$G(^PS(55,DFN,"IV",+ON55,.2))
"RTN","PSJLIACT",149,0)
 S PSJPRIO=$P(NODEP2,"^",4),PSJSCH=$P(NODE0,"^",9)
"RTN","PSJLIACT",150,0)
 I (",S,A,")[(","_$G(PSJPRIO)_",")!($G(PSJSCH)="NOW")!($G(PSJSCH)["STAT") D NOTIFY^PSJHL4(ON55,DFN,$G(PSJPRIO),$G(PSJSCH))
"RTN","PSJLIACT",151,0)
 Q
"RTN","PSJLIVFD")
0^38^B39296093
"RTN","PSJLIVFD",1,0)
PSJLIVFD ;BIR/MV-SETUP LM TEMPLATE FOR IV FLUID ;4 Aug 00 / 2:37 PM
"RTN","PSJLIVFD",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,50,63,64,58,81,91,80,116,110,111,180,134**;16 DEC 97;Build 124
"RTN","PSJLIVFD",3,0)
 ;
"RTN","PSJLIVFD",4,0)
 ; Reference to ^VALM0 is supported by DBIA # 2615.
"RTN","PSJLIVFD",5,0)
 ;
"RTN","PSJLIVFD",6,0)
 ;NFI changes for FR# 3@AD+4
"RTN","PSJLIVFD",7,0)
 ;
"RTN","PSJLIVFD",8,0)
EN ; Build LM template to display IV order.
"RTN","PSJLIVFD",9,0)
 K ^TMP("PSJI",$J)
"RTN","PSJLIVFD",10,0)
 S UL80="",$P(UL80,"=",80)=""
"RTN","PSJLIVFD",11,0)
 S PSJLN=1
"RTN","PSJLIVFD",12,0)
AD ;
"RTN","PSJLIVFD",13,0)
 NEW VALMEVL S VALMEVL=1
"RTN","PSJLIVFD",14,0)
 S PSJL="" D FLDNO^PSJLIUTL("(1)",1)
"RTN","PSJLIVFD",15,0)
 S PSJL=PSJL_"Additives:"
"RTN","PSJLIVFD",16,0)
 S:$G(P("PON"))["V"&(P(17)'="N") PSJL=$$SETSTR^VALM1("Order number:",PSJL,30,14)_+P("PON")
"RTN","PSJLIVFD",17,0)
 S PSJL=$$SETSTR^VALM1("Type:",PSJL,57,6)_$$TYPE^PSJLIUTL
"RTN","PSJLIVFD",18,0)
 NEW PSJVD S PSJVD=$$DINFLIV^PSJDIN(.DRG)
"RTN","PSJLIVFD",19,0)
 S PSJL=$$SETSTR^VALM1(PSJVD,PSJL,75,6)
"RTN","PSJLIVFD",20,0)
 I '$D(IORVON),$D(IOST(0)) D ENS^%ZISS,TERM^VALM0
"RTN","PSJLIVFD",21,0)
 I $D(IORVON),(PSJVD]"") D CNTRL^VALM10(1,76,5,IORVON,IORVOFF,0) K PSJVD
"RTN","PSJLIVFD",22,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",23,0)
 D:+$G(PSJLMX) CLRDSPL^PSJLIVMD
"RTN","PSJLIVFD",24,0)
 ;PSJLMX count number of lines needed to display the add/sol
"RTN","PSJLIVFD",25,0)
 S PSJLMX=0 D WRTDRG^PSJLIUTL("AD")
"RTN","PSJLIVFD",26,0)
SOL ;
"RTN","PSJLIVFD",27,0)
 S PSJL="" D FLDNO^PSJLIUTL("(2)",1)
"RTN","PSJLIVFD",28,0)
 S PSJL=PSJL_"Solutions:"
"RTN","PSJLIVFD",29,0)
 I P("SYRS")]"" D
"RTN","PSJLIVFD",30,0)
 . S PSJL=$$SETSTR^VALM1("Syr. Size:",PSJL,52,10)_$E(P("SYRS"),1,13)
"RTN","PSJLIVFD",31,0)
 . S:$L(P("SYRS"))>13 PSJL=PSJL_"..."
"RTN","PSJLIVFD",32,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",33,0)
 D WRTDRG^PSJLIUTL("SOL")
"RTN","PSJLIVFD",34,0)
DUR ;
"RTN","PSJLIVFD",35,0)
 S PSJL=""
"RTN","PSJLIVFD",36,0)
 N DUROUT,IVLIMIT S DUROUT=$$GETDUR^PSJLIVMD(PSGP,+PSJORD,$S(PSJORD["P":"P",1:"IV"))
"RTN","PSJLIVFD",37,0)
 I $G(PSJORD)["P" N ND25 S ND25=$G(^PS(53.1,+PSJORD,2.5)),IVLIMIT=$P(ND25,"^",4) D
"RTN","PSJLIVFD",38,0)
 .S IVLIMIT=$S(IVLIMIT]"":$$FMTDUR^PSJLIVMD(IVLIMIT),1:"") S:IVLIMIT]"" DUROUT=IVLIMIT
"RTN","PSJLIVFD",39,0)
 S LABEL=$S($G(IVLIMIT):"IV Limit: ",1:"Duration: ") K IVLIMIT
"RTN","PSJLIVFD",40,0)
 S PSJL=$$SETSTR^VALM1(LABEL,PSJL,12,10)
"RTN","PSJLIVFD",41,0)
 S PSJL=PSJL_DUROUT
"RTN","PSJLIVFD",42,0)
START ;
"RTN","PSJLIVFD",43,0)
 D FLDNO^PSJLIUTL("(4)",47)
"RTN","PSJLIVFD",44,0)
 S PSJL=$$SETSTR^VALM1("Start:",PSJL,56,7)_$$STARTDT^PSJLIUTL
"RTN","PSJLIVFD",45,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",46,0)
 NEW PSGRSD,PSGRSDN,PSGRFD,PSGRFDN
"RTN","PSJLIVFD",47,0)
 S PSJL="" I $G(PSJORD)["P",$G(PSGRDTX) D
"RTN","PSJLIVFD",48,0)
 . N RSDLABL,PSJRQB,PSJRQL,PSGRSD,PSGSRSDN
"RTN","PSJLIVFD",49,0)
 . S RSDLABL="     REQUESTED START: ",PSJRQB=41,PSJRQL=39,PSGRSD="",PSGRSDN=""
"RTN","PSJLIVFD",50,0)
 . I $G(PSGRDTX(+$G(PSJORD),"PSGRSD")),$G(P(2)) S PSJRQB=51,PSJRQL=29 D
"RTN","PSJLIVFD",51,0)
 .. S PSGRSD=PSGRDTX(+$G(PSJORD),"PSGRSD"),PSGRSDN=$$ENDTC^PSGMI(+PSGRSD),RSDLABL="Calc Start: "
"RTN","PSJLIVFD",52,0)
 . I '$G(P(2)),'$P(PSGRDTX,U,3) S PSGRSD=+PSGRDTX,PSGRSDN=$$ENDTC^PSGMI(PSGRSD)
"RTN","PSJLIVFD",53,0)
 . I $G(PSGRSD),($G(PSGRSDN)]"") D DSPLYDT^PSJLIVMD(PSJLMX+5,.PSGRSD,.PSGRSDN,RSDLABL,1,PSJRQB,PSJRQL),SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",54,0)
INFRATE ;
"RTN","PSJLIVFD",55,0)
 S PSJL="" D FLDNO^PSJLIUTL("(3)",1)
"RTN","PSJLIVFD",56,0)
 S PSJL=$$SETSTR^VALM1("Infusion Rate:",PSJL,7,15)
"RTN","PSJLIVFD",57,0)
 D LONG^PSJLIUTL(P(8),22,24)
"RTN","PSJLIVFD",58,0)
LASTREN ;
"RTN","PSJLIVFD",59,0)
 N PSGRNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,$S($G(PSJORD):PSJORD,1:$G(ON))) I PSGRNDT D
"RTN","PSJLIVFD",60,0)
 . S PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,54,32)
"RTN","PSJLIVFD",61,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",62,0)
MR ;
"RTN","PSJLIVFD",63,0)
 S PSJL="" D FLDNO^PSJLIUTL("(5)",1)
"RTN","PSJLIVFD",64,0)
 S PSJL=$$SETSTR^VALM1("Med Route:",PSJL,11,11)
"RTN","PSJLIVFD",65,0)
 S PSJL=PSJL_$P(P("MR"),U,2)
"RTN","PSJLIVFD",66,0)
STOP ;
"RTN","PSJLIVFD",67,0)
 D FLDNO^PSJLIUTL("(6)",47)
"RTN","PSJLIVFD",68,0)
 ;PSJ*5*180 - If Invalid Duration/Limit - Cannot Calculate Stop Date
"RTN","PSJLIVFD",69,0)
 S PSJL=$$SETSTR^VALM1("Stop:",PSJL,57,6)_$S($G(PSJBADD)=1:"CANNOT CALCULATE",1:$$STOPDT^PSJLIUTL)
"RTN","PSJLIVFD",70,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",71,0)
 S PSJL=""
"RTN","PSJLIVFD",72,0)
 N PSJBCMA S PSJBCMA=$$BCMALG^PSJUTL2(DFN,PSJORD)
"RTN","PSJLIVFD",73,0)
 I $G(PSJBCMA)]"" S PSJL=$$SETSTR^VALM1(PSJBCMA,PSJL,1,52)
"RTN","PSJLIVFD",74,0)
 I $G(PSGRDTX(+PSJORD,"PSGRFD")) S PSGRFD=PSGRDTX(+PSJORD,"PSGRFD"),PSGRFDN=$$ENDTC^PSGMI(PSGRFD) D
"RTN","PSJLIVFD",75,0)
 . D DSPLYDT^PSJLIVMD(PSJLMX+7,.PSGRFD,.PSGRFDN," Calc Stop: ",0,51,29)
"RTN","PSJLIVFD",76,0)
 D:($G(PSJBCMA)]"")!($G(PSGRFD)]"") SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",77,0)
SCH ;
"RTN","PSJLIVFD",78,0)
 S PSJL="" D FLDNO^PSJLIUTL("(7)",1)
"RTN","PSJLIVFD",79,0)
 S PSJL=$$SETSTR^VALM1("Schedule:",PSJL,12,11)
"RTN","PSJLIVFD",80,0)
 D LONG^PSJLIUTL(P(9),22,32) S PSJL=PSJL_$S(P(7):"@0 labels a day",1:"")
"RTN","PSJLIVFD",81,0)
LASTFL ;
"RTN","PSJLIVFD",82,0)
 S PSJL=$$SETSTR^VALM1("Last Fill:",PSJL,52,11)
"RTN","PSJLIVFD",83,0)
 S PSJL=PSJL_$$ENDTC^PSGMI(P("LF"))
"RTN","PSJLIVFD",84,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",85,0)
ADM ;
"RTN","PSJLIVFD",86,0)
 S PSJL="" D FLDNO^PSJLIUTL("(8)",1)
"RTN","PSJLIVFD",87,0)
 S PSJL=$$SETSTR^VALM1("Admin Times:",PSJL,9,14)
"RTN","PSJLIVFD",88,0)
 D LONG^PSJLIUTL(P(11),22,30)
"RTN","PSJLIVFD",89,0)
QTY ;
"RTN","PSJLIVFD",90,0)
 S PSJL=$$SETSTR^VALM1("Quantity:",PSJL,53,10)_+P("LFA")
"RTN","PSJLIVFD",91,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",92,0)
PROVIDER ;
"RTN","PSJLIVFD",93,0)
 S PSJL="" D FLDNO^PSJLIUTL("(9)",1)
"RTN","PSJLIVFD",94,0)
 S PSJL=$$SETSTR^VALM1("Provider:",PSJL,12,10)_$$PROVIDER^PSJLIUTL
"RTN","PSJLIVFD",95,0)
CUMDOSES ;
"RTN","PSJLIVFD",96,0)
 S PSJL=$$SETSTR^VALM1("Cum. Doses:",PSJL,51,12)_P("CUM")
"RTN","PSJLIVFD",97,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",98,0)
OPI ;
"RTN","PSJLIVFD",99,0)
 S PSJL="" D FLDNO^PSJLIUTL("(10)",1)
"RTN","PSJLIVFD",100,0)
 S PSJL=$$SETSTR^VALM1("Other Print"_$S($P(P("OPI"),"^",2)=1:"!: ",1:": "),PSJL,9,13)_$P(P("OPI"),"^")
"RTN","PSJLIVFD",101,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",102,0)
PC ;
"RTN","PSJLIVFD",103,0)
 S PSJL=""
"RTN","PSJLIVFD",104,0)
 S PSJL=$$SETSTR^VALM1("Provider Comments:",PSJL,3,18) D WTPC^PSJLIUTL
"RTN","PSJLIVFD",105,0)
REMARK ;
"RTN","PSJLIVFD",106,0)
 D SETTMP^PSJLMPRU("PSJI","")
"RTN","PSJLIVFD",107,0)
 S PSJL="" D FLDNO^PSJLIUTL("(11)",1)
"RTN","PSJLIVFD",108,0)
 S PSJL=$$SETSTR^VALM1("Remarks :",PSJL,8,10)
"RTN","PSJLIVFD",109,0)
 D LONG^PSJLIUTL(P("REM"),18,62)
"RTN","PSJLIVFD",110,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",111,0)
IVROOM ;
"RTN","PSJLIVFD",112,0)
 S PSJL=""
"RTN","PSJLIVFD",113,0)
 S PSJL=$$SETSTR^VALM1("IV Room:",PSJL,9,9)_$P(P("IVRM"),U,2)
"RTN","PSJLIVFD",114,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",115,0)
ENTRY ;
"RTN","PSJLIVFD",116,0)
 S PSJL="",PSJL=$$SETSTR^VALM1("Entry By:",PSJL,8,10)
"RTN","PSJLIVFD",117,0)
 S PSJL=PSJL_$S($P(P("CLRK"),U,2)]"":$E($P(P("CLRK"),U,2),1,18),1:"*** Undefined")
"RTN","PSJLIVFD",118,0)
 S PSJL=$$SETSTR^VALM1("Entry Date:",PSJL,51,12)_$$ENDTC^PSGMI(P("LOG"))
"RTN","PSJLIVFD",119,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",120,0)
 S PSJL="" S PSGLRN=$$LASTRNBY^PSJLMPRI(DFN,$S($G(PSJORD):PSJORD,1:$G(ON))) I PSGLRN D
"RTN","PSJLIVFD",121,0)
 . S PSJL=$$SETSTR^VALM1("Renewed By: ",PSJL,6,12)_$$ENNPN^PSGMI(PSGLRN) D SETTMP^PSJLMPRU("PSJI",PSJL) K PSGLRN
"RTN","PSJLIVFD",122,0)
 S VALM("TITLE")=$$CODES^PSIVUTL(P(17),$S($G(ON)["P":53.1,1:55.01),$S(ON["P":28,1:100))_" IV "
"RTN","PSJLIVFD",123,0)
 I $G(P("PRY"))="D"!($G(P("PON"))["P") S VALM("TITLE")=VALM("TITLE")_$S($G(P("PRY"))="":"",1:"("_$$CODES^PSIVUTL(P("PRY"),53.1,.24)_")")
"RTN","PSJLIVFD",124,0)
 I $G(P("PON"))["P" D ORDCHK
"RTN","PSJLIVFD",125,0)
 S VALMCNT=PSJLN-1,^TMP("PSJI",$J,0)=VALMCNT
"RTN","PSJLIVFD",126,0)
 Q
"RTN","PSJLIVFD",127,0)
 ;
"RTN","PSJLIVFD",128,0)
ORDCHK ;Display order check for pending order
"RTN","PSJLIVFD",129,0)
 Q:'$O(^PS(53.1,+ON,10,0))
"RTN","PSJLIVFD",130,0)
 NEW PSJIVX,PSJIVXX
"RTN","PSJLIVFD",131,0)
 F PSJIVX=0:0 S PSJIVX=$O(^PS(53.1,+ON,10,PSJIVX)) Q:'PSJIVX  D
"RTN","PSJLIVFD",132,0)
 . D SETTMP^PSJLMPRU("PSJI","")
"RTN","PSJLIVFD",133,0)
 . S PSJL="Order Checks       :" D LONG^PSJLIUTL($G(^PS(53.1,+ON,10,PSJIVX,0)),22,60)
"RTN","PSJLIVFD",134,0)
 . D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",135,0)
 . S PSJL="Overriding Provider: "_$P($G(^PS(53.1,+ON,10,PSJIVX,1)),U)
"RTN","PSJLIVFD",136,0)
 . D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",137,0)
 . S PSJL="Overriding Reason  : "
"RTN","PSJLIVFD",138,0)
 . F PSJIVXX=0:0 S PSJIVXX=$O(^PS(53.1,+ON,10,PSJIVX,2,PSJIVXX)) Q:'PSJIVXX  D
"RTN","PSJLIVFD",139,0)
 .. D LONG^PSJLIUTL($G(^PS(53.1,+ON,10,PSJIVX,2,PSJIVXX,0)),22,60)
"RTN","PSJLIVFD",140,0)
 .. D SETTMP^PSJLMPRU("PSJI",PSJL) S PSJL=""
"RTN","PSJLIVFD",141,0)
 Q
"RTN","PSJLIVFD",142,0)
 ;
"RTN","PSJLIVFD",143,0)
SCHREQ(IVAR) ;
"RTN","PSJLIVFD",144,0)
 I $G(IVAR(4))="P"!($G(IVAR(23))="P")!($G(IVAR(5))) Q 1
"RTN","PSJLIVFD",145,0)
 Q 0
"RTN","PSJLIVMD")
0^14^B77166995
"RTN","PSJLIVMD",1,0)
PSJLIVMD ;BIR/MV-SETUP LM TEMPLATE FOR INPT MED. IV ;4 Aug 00 / 4:29 PM
"RTN","PSJLIVMD",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**37,50,63,58,81,91,80,116,110,111,180,134**;16 DEC 97;Build 124
"RTN","PSJLIVMD",3,0)
 ;
"RTN","PSJLIVMD",4,0)
 ;Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJLIVMD",5,0)
 ;
"RTN","PSJLIVMD",6,0)
EN ; Build LM template to display IV order.
"RTN","PSJLIVMD",7,0)
 D GTOT^PSIVUTL(P(4))
"RTN","PSJLIVMD",8,0)
 S:'$D(PSJSTAR) PSJSTAR="" S:'$D(PSGP) PSGP=DFN
"RTN","PSJLIVMD",9,0)
 I $E(P("OT"))'="I" D EN^PSJLIVFD Q
"RTN","PSJLIVMD",10,0)
 K ^TMP("PSJI",$J)
"RTN","PSJLIVMD",11,0)
 S UL80="",$P(UL80,"=",80)=""
"RTN","PSJLIVMD",12,0)
 S PSJLN=1
"RTN","PSJLIVMD",13,0)
 I $G(PSIV531),P("PON")["P" S (P(2),P(3),P(4))=""
"RTN","PSJLIVMD",14,0)
AD ;
"RTN","PSJLIVMD",15,0)
 NEW VALMEVL S VALMEVL=1
"RTN","PSJLIVMD",16,0)
 S PSJL="" D FLDNO^PSJLIUTL("(1)",1)
"RTN","PSJLIVMD",17,0)
 S PSJL=PSJL_" Additives:"
"RTN","PSJLIVMD",18,0)
 S:$G(P("PON"))["V"&(P(17)'="N") PSJL=$$SETSTR^VALM1("Order number:",PSJL,28,14)_+P("PON")
"RTN","PSJLIVMD",19,0)
 S PSJL=$$SETSTR^VALM1("Type:",PSJL,57,6)_$$TYPE^PSJLIUTL
"RTN","PSJLIVMD",20,0)
 NEW PSJVD S PSJVD=$$DINFLIV^PSJDIN(.DRG)
"RTN","PSJLIVMD",21,0)
 S PSJL=$$SETSTR^VALM1(PSJVD,PSJL,75,6)
"RTN","PSJLIVMD",22,0)
 I $D(IORVON),(PSJVD]"") D CNTRL^VALM10(1,76,5,IORVON,IORVOFF,0) K PSJVD
"RTN","PSJLIVMD",23,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",24,0)
 D:+$G(PSJLMX) CLRDSPL
"RTN","PSJLIVMD",25,0)
 ;PSJLMX count number of lines needed to display the add/sol
"RTN","PSJLIVMD",26,0)
 S PSJLMX=0 D WRTDRG^PSJLIUTL("AD")
"RTN","PSJLIVMD",27,0)
SOL ;
"RTN","PSJLIVMD",28,0)
 S PSJL="" D FLDNO^PSJLIUTL("(2)",1)
"RTN","PSJLIVMD",29,0)
 S PSJL=PSJL_" Solutions:"
"RTN","PSJLIVMD",30,0)
 I P("SYRS")]"" D
"RTN","PSJLIVMD",31,0)
 . S PSJL=$$SETSTR^VALM1("Syr. Size:",PSJL,52,11)_$E(P("SYRS"),1,13)
"RTN","PSJLIVMD",32,0)
 . S:$L(P("SYRS"))>13 PSJL=PSJL_"..."
"RTN","PSJLIVMD",33,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",34,0)
 D WRTDRG^PSJLIUTL("SOL")
"RTN","PSJLIVMD",35,0)
 D DUR
"RTN","PSJLIVMD",36,0)
START ;
"RTN","PSJLIVMD",37,0)
 NEW PSGRSD,PSGRSDN,PSGRFD,PSGRFDN
"RTN","PSJLIVMD",38,0)
 I $G(P("OT"))="I",$G(P(4))]"" D
"RTN","PSJLIVMD",39,0)
 .Q:$G(ON)["V"  I $G(PSIVAC)="" N PSIVAC S PSIVAC="CF"
"RTN","PSJLIVMD",40,0)
 .Q:$G(P(3))
"RTN","PSJLIVMD",41,0)
 .D ENT^PSIVCAL,ENSTOP^PSIVCAL
"RTN","PSJLIVMD",42,0)
 D REQDT(ON)
"RTN","PSJLIVMD",43,0)
 D FLDNO^PSJLIUTL("(4)",47)
"RTN","PSJLIVMD",44,0)
 S PSJL=$$SETSTR^VALM1("Start:",PSJL,56,7)_$$STARTDT^PSJLIUTL
"RTN","PSJLIVMD",45,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",46,0)
INFRATE ;
"RTN","PSJLIVMD",47,0)
 S PSJL="" D FLDNO^PSJLIUTL("(3)",1)
"RTN","PSJLIVMD",48,0)
 S PSJL=$$SETSTR^VALM1("Infusion Rate:",PSJL,7,15)
"RTN","PSJLIVMD",49,0)
 D LONG^PSJLIUTL(P(8),22,23)
"RTN","PSJLIVMD",50,0)
RSTART ;
"RTN","PSJLIVMD",51,0)
 I $G(ON)["P" N PSGNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,ON) D
"RTN","PSJLIVMD",52,0)
 . I PSGRNDT S PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,54,32) Q
"RTN","PSJLIVMD",53,0)
 . Q:'$G(PSGRDTX)  N PSJRQB,PSJRQL,RSDLABL,PSGRSD,PSGRSDN
"RTN","PSJLIVMD",54,0)
 . S RSDLABL="     REQUESTED START: ",PSJRQB=41,PSJRQL=39,PSGRSD="",PSGRSDN=""
"RTN","PSJLIVMD",55,0)
 . I $G(PSGRDTX(+$G(PSJORD),"PSGRSD")),$G(P(2)) S PSJRQB=51,PSJRQL=29 D
"RTN","PSJLIVMD",56,0)
 .. S PSGRSD=PSGRDTX(+$G(PSJORD),"PSGRSD"),PSGRSDN=$$ENDTC^PSGMI(+PSGRSD),RSDLABL="Calc Start: "
"RTN","PSJLIVMD",57,0)
 . I '$G(P(2)),'$P(PSGRDTX,U,3) S PSGRSD=+PSGRDTX,PSGRSDN=$$ENDTC^PSGMI(PSGRSD)
"RTN","PSJLIVMD",58,0)
 . I $G(PSGRSD),($G(PSGRSDN)]"") D DSPLYDT(PSJLMX+5,.PSGRSD,.PSGRSDN,RSDLABL,1,PSJRQB,PSJRQL)  ;,SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",59,0)
 I $G(ON)["V" N PSGRNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,ON) I PSGRNDT S PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,54,32)
"RTN","PSJLIVMD",60,0)
 I PSJL]"" D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",61,0)
 ;
"RTN","PSJLIVMD",62,0)
MR ;
"RTN","PSJLIVMD",63,0)
 S PSJL="" D FLDNO^PSJLIUTL("(5)",1)
"RTN","PSJLIVMD",64,0)
 S PSJL=$$SETSTR^VALM1("Med Route:",PSJL,11,11)
"RTN","PSJLIVMD",65,0)
 S PSJL=PSJL_$P(P("MR"),U,2)
"RTN","PSJLIVMD",66,0)
STOP ;
"RTN","PSJLIVMD",67,0)
 S:'$D(PSGP) PSGP=DFN
"RTN","PSJLIVMD",68,0)
 D FLDNO^PSJLIUTL("(6)",47)
"RTN","PSJLIVMD",69,0)
 ;PSJ*5*180 - If CPRS sends invalid duration/limit - Cannot Calculate Stop Date.
"RTN","PSJLIVMD",70,0)
 S PSJL=$$SETSTR^VALM1("Stop:",PSJL,57,6)_$S($G(PSJBADD)=1:"CANNOT CALCULATE",1:$$STOPDT^PSJLIUTL)
"RTN","PSJLIVMD",71,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",72,0)
 S PSJL=""
"RTN","PSJLIVMD",73,0)
 N PSJBCMA S PSJBCMA=$$BCMALG^PSJUTL2(PSGP,PSJORD)
"RTN","PSJLIVMD",74,0)
 I $G(PSJBCMA)]"",$G(DFN) S PSJL=$$SETSTR^VALM1(PSJBCMA,PSJL,1,52)
"RTN","PSJLIVMD",75,0)
 I $G(PSJORD)["P",$G(PSGRDTX(+$G(PSJORD),"PSGRFD")),$G(P(3)) S PSGRFDN=$$ENDTC^PSGMI(PSGRDTX(+PSJORD,"PSGRFD")) D
"RTN","PSJLIVMD",76,0)
 . D DSPLYDT(PSJLMX+7,.PSGRFD,.PSGRFDN," Calc Stop: ",1,51,29)
"RTN","PSJLIVMD",77,0)
 I ($G(PSJBCMA)]"")!($G(PSGRDTX(+$G(PSJORD),"PSGRFD"))&$G(P(3))) D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",78,0)
SCH ;
"RTN","PSJLIVMD",79,0)
 S PSJL="" D FLDNO^PSJLIUTL("(7)",1)
"RTN","PSJLIVMD",80,0)
 S PSJL=$$SETSTR^VALM1("Schedule:",PSJL,12,11)
"RTN","PSJLIVMD",81,0)
 D LONG^PSJLIUTL(P(9)_$S(P(7):"@0 labels a day",1:"")_$G(SCHMSG),22,31)
"RTN","PSJLIVMD",82,0)
LASTFL ;
"RTN","PSJLIVMD",83,0)
 S PSJL=$$SETSTR^VALM1("Last Fill:",PSJL,52,11)
"RTN","PSJLIVMD",84,0)
 S PSJL=PSJL_$$ENDTC^PSGMI(P("LF"))
"RTN","PSJLIVMD",85,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",86,0)
ADM ;
"RTN","PSJLIVMD",87,0)
 S PSJL="" D FLDNO^PSJLIUTL("(8)",1)
"RTN","PSJLIVMD",88,0)
 S PSJL=$$SETSTR^VALM1("Admin Times:",PSJL,9,14)
"RTN","PSJLIVMD",89,0)
 NEW NOECH
"RTN","PSJLIVMD",90,0)
 D LONG^PSJLIUTL(P(11),22,29)
"RTN","PSJLIVMD",91,0)
QTY ;
"RTN","PSJLIVMD",92,0)
 S PSJL=$$SETSTR^VALM1("Quantity:",PSJL,53,10)_+P("LFA")
"RTN","PSJLIVMD",93,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",94,0)
PROVIDER ;
"RTN","PSJLIVMD",95,0)
 S PSJL="" D FLDNO^PSJLIUTL("(9)",1)
"RTN","PSJLIVMD",96,0)
 S PSJL=$$SETSTR^VALM1("Provider:",PSJL,12,10)_$$PROVIDER^PSJLIUTL
"RTN","PSJLIVMD",97,0)
CUMDOSES ;
"RTN","PSJLIVMD",98,0)
 S PSJL=$$SETSTR^VALM1("Cum. Doses:",PSJL,51,12)_P("CUM")
"RTN","PSJLIVMD",99,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",100,0)
OI ;
"RTN","PSJLIVMD",101,0)
 S PSJL="" D FLDNO^PSJLIUTL("(10)",1)
"RTN","PSJLIVMD",102,0)
 S PSJL=$$SETSTR^VALM1("Orderable Item:",PSJL,6,16)_$P(P("PD"),U,2)_$$OINF^PSJDIN(+P("PD"))
"RTN","PSJLIVMD",103,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",104,0)
INS ;
"RTN","PSJLIVMD",105,0)
 S PSJL=""
"RTN","PSJLIVMD",106,0)
 S PSJL=$$SETSTR^VALM1("Instructions:",PSJL,8,14)
"RTN","PSJLIVMD",107,0)
 D LONG^PSJLIUTL(P("INS"),22,58)
"RTN","PSJLIVMD",108,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",109,0)
OPI ;
"RTN","PSJLIVMD",110,0)
 S PSJL="" D FLDNO^PSJLIUTL("(11)",1)
"RTN","PSJLIVMD",111,0)
 S PSJL=$$SETSTR^VALM1("Other Print"_$S($P(P("OPI"),"^",2)=1:"!: ",1:": "),PSJL,9,13)_$P(P("OPI"),"^")
"RTN","PSJLIVMD",112,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",113,0)
PC ;
"RTN","PSJLIVMD",114,0)
 S PSJL=""
"RTN","PSJLIVMD",115,0)
 S PSJL=$$SETSTR^VALM1("Provider Comments:",PSJL,3,18) D WTPC^PSJLIUTL
"RTN","PSJLIVMD",116,0)
REMARK ;
"RTN","PSJLIVMD",117,0)
 D SETTMP^PSJLMPRU("PSJI","")
"RTN","PSJLIVMD",118,0)
 S PSJL="" D FLDNO^PSJLIUTL("(12)",1)
"RTN","PSJLIVMD",119,0)
 S PSJL=$$SETSTR^VALM1("Remarks :",PSJL,8,10)
"RTN","PSJLIVMD",120,0)
 D LONG^PSJLIUTL(P("REM"),18,62)
"RTN","PSJLIVMD",121,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",122,0)
IVROOM ;
"RTN","PSJLIVMD",123,0)
 S PSJL=""
"RTN","PSJLIVMD",124,0)
 S PSJL=$$SETSTR^VALM1("IV Room:",PSJL,9,9)_$P(P("IVRM"),U,2)
"RTN","PSJLIVMD",125,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",126,0)
ENTRY ;
"RTN","PSJLIVMD",127,0)
 S PSJL="",PSJL=$$SETSTR^VALM1("Entry By:",PSJL,8,10)
"RTN","PSJLIVMD",128,0)
 S PSJL=PSJL_$S($P(P("CLRK"),U,2)]"":$E($P(P("CLRK"),U,2),1,24),1:"*** Undefined")
"RTN","PSJLIVMD",129,0)
 S PSJL=$$SETSTR^VALM1("Entry Date:",PSJL,51,12)_$$ENDTC^PSGMI(P("LOG"))
"RTN","PSJLIVMD",130,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",131,0)
 S PSJL="" S PSGLRN=$$LASTRNBY^PSJLMPRI(DFN,$S($G(PSJORD):PSJORD,1:$G(ON))) I PSGLRN D
"RTN","PSJLIVMD",132,0)
 . S PSJL=$$SETSTR^VALM1("Renewed By: ",PSJL,6,12)_$$ENNPN^PSGMI(PSGLRN) D SETTMP^PSJLMPRU("PSJI",PSJL) K PSGLRN
"RTN","PSJLIVMD",133,0)
 S VALM("TITLE")=$$CODES^PSIVUTL(P(17),$S($G(ON)["P":53.1,1:55.01),$S($G(ON)["P":28,1:100))_" IV "
"RTN","PSJLIVMD",134,0)
 I $G(P("PRY"))="D"!($G(P("PON"))["P") S VALM("TITLE")=VALM("TITLE")_$S($G(P("PRY"))="":"",1:"("_$$CODES^PSIVUTL(P("PRY"),53.1,.24)_")")
"RTN","PSJLIVMD",135,0)
 I $G(P("PON"))["P" D ORDCHK^PSJLIVFD
"RTN","PSJLIVMD",136,0)
 S VALMCNT=PSJLN-1,^TMP("PSJI",$J,0)=VALMCNT
"RTN","PSJLIVMD",137,0)
 Q
"RTN","PSJLIVMD",138,0)
DSPLYDT(PSJLN,PSGRDT,PSGRDTN,TXT,PSJFSH,PSJRDBEG,PSJRDLEN)  ;
"RTN","PSJLIVMD",139,0)
 ;LINE   : Line number the Requested Start and Stop dates are display in
"RTN","PSJLIVMD",140,0)
 ;PSGRDT : Either it is the requested start or stop date in FM format
"RTN","PSJLIVMD",141,0)
 ;PSGRDTN: Either it is the requested start or stop date in IPM format
"RTN","PSJLIVMD",142,0)
 ;TXT    : The display text
"RTN","PSJLIVMD",143,0)
 ;PSJFSH     : if it is 1 then flash
"RTN","PSJLIVMD",144,0)
 ;
"RTN","PSJLIVMD",145,0)
 S:'$G(PSJRDBEG) PSJRDBEG=41,PSJRDLEN=39
"RTN","PSJLIVMD",146,0)
 S PSJL=$$SETSTR^VALM1(TXT_PSGRDTN,PSJL,PSJRDBEG,PSJRDLEN)
"RTN","PSJLIVMD",147,0)
 Q
"RTN","PSJLIVMD",148,0)
CLRDSPL ;
"RTN","PSJLIVMD",149,0)
 ;Clear the blinking after edit the pending order.
"RTN","PSJLIVMD",150,0)
 ;Without it more than the requested start and stop dates are blinking at the ac/edit screen
"RTN","PSJLIVMD",151,0)
 ;PSJLMX: # ad/sol counted in WRTDRG^PSJLIUTL
"RTN","PSJLIVMD",152,0)
 Q:'$D(IOBOFF)
"RTN","PSJLIVMD",153,0)
 NEW PSJX
"RTN","PSJLIVMD",154,0)
 F PSJX=5:1:PSJLMX+7 D CNTRL^VALM10(PSJX,36,80,IOBOFF,IOINORM)
"RTN","PSJLIVMD",155,0)
 Q
"RTN","PSJLIVMD",156,0)
REQDT(ORDER)       ;Get requested date if it is a pending order
"RTN","PSJLIVMD",157,0)
 ;ORDER  : Pending Order Number (PSJORD or PSGORD)
"RTN","PSJLIVMD",158,0)
 Q:ORDER'["P"  D REQDT^PSJLIUTL(ORDER)
"RTN","PSJLIVMD",159,0)
 Q
"RTN","PSJLIVMD",160,0)
 ;
"RTN","PSJLIVMD",161,0)
GETDUR(PAT,ORD,PKG,RAW) ;
"RTN","PSJLIVMD",162,0)
 ; PAT= Patient DFN
"RTN","PSJLIVMD",163,0)
 ; ORD= Order #
"RTN","PSJLIVMD",164,0)
 ; PKG= 5(UD), "IV"(IV), "P"(Pending)
"RTN","PSJLIVMD",165,0)
 N ACT,DUR,ND,ND25,F25,ND0,ND2,OLDORD S DUR="",ORD=+ORD K IVLIMIT
"RTN","PSJLIVMD",166,0)
 S:PKG="V" PKG="IV"
"RTN","PSJLIVMD",167,0)
 I PKG="P" S ND=$G(^PS(53.1,+ORD,0)) D  I '$G(OLDORD) Q DUR
"RTN","PSJLIVMD",168,0)
 . I $G(P("OVRIDE")) S DUR="" Q
"RTN","PSJLIVMD",169,0)
 . D PENDING(ORD) Q:DUR]""
"RTN","PSJLIVMD",170,0)
 . S ND0=$G(^PS(53.1,ORD,0)) I $P(ND0,U,24)="E" S OLDORD=$P(ND0,U,25) I OLDORD S PKG=$S(OLDORD["V":"IV",OLDORD["U":5,OLDORD["P":"P",1:"")
"RTN","PSJLIVMD",171,0)
 . Q:($G(OLDORD)'["P")
"RTN","PSJLIVMD",172,0)
 . D PENDING(OLDORD) S OLDORD=""
"RTN","PSJLIVMD",173,0)
 I PKG="IV" S ND2=$G(^PS(55,PAT,PKG,ORD,2)) I $P(ND2,U,8)="E" S OLDORD=$P(ND2,U,5) S:OLDORD'["V" OLDORD="" I OLDORD D
"RTN","PSJLIVMD",174,0)
 .N ACTND S ACTND=0 F  S ACTND=$O(^PS(55,PAT,"IV",ORD,"A",ACTND)) Q:'ACTND  D
"RTN","PSJLIVMD",175,0)
 ..I $G(^PS(55,PAT,"IV",ORD,"A",ACTND,0))["IV LIMIT OVERRIDDEN" S OLDORD=""
"RTN","PSJLIVMD",176,0)
 I $G(P("LIMIT"))]"" S DUR=P("LIMIT"),IVLIMIT=1 I '$G(RAW) S DUR=$$FMTDUR(DUR) Q DUR
"RTN","PSJLIVMD",177,0)
 I PKG=5 S ND0=$G(^PS(55,PAT,PKG,ORD,0)) I $P(ND0,U,24)="E" S OLDORD=$P(ND0,U,25) S:OLDORD'["U" OLDORD=""
"RTN","PSJLIVMD",178,0)
 S F25="^PS(55,PAT,PKG,ORD,2.5)" I '$G(OLDORD) Q:'$D(@(F25)) DUR
"RTN","PSJLIVMD",179,0)
 S ND25=$G(@(F25)) S DUR=$P(ND25,U,2) I DUR="" S DUR=$P(ND25,U,4) I DUR]"" S IVLIMIT=1
"RTN","PSJLIVMD",180,0)
 I DUR="",$G(OLDORD) S ORD=+OLDORD Q:'$D(@(F25)) DUR  D
"RTN","PSJLIVMD",181,0)
 . S ND25=$G(@(F25)) S DUR=$P(ND25,U,2) I DUR="" S DUR=$P(ND25,U,4) I DUR]"" S IVLIMIT=1
"RTN","PSJLIVMD",182,0)
 I '$G(RAW),DUR]"" S DUR=$$FMTDUR(DUR)
"RTN","PSJLIVMD",183,0)
 Q DUR
"RTN","PSJLIVMD",184,0)
 ;
"RTN","PSJLIVMD",185,0)
PENDING(PNDON) ;
"RTN","PSJLIVMD",186,0)
 S ND=$G(^PS(53.1,+ORD,0))
"RTN","PSJLIVMD",187,0)
 I ND S ND25=$S(($P(ND,U,15)=PAT):$G(^PS(53.1,+ORD,2.5)),1:"")
"RTN","PSJLIVMD",188,0)
 S DUR=$P(ND25,U,4) I DUR]"" D  Q
"RTN","PSJLIVMD",189,0)
 .S:($E(DUR)="s")!($E(DUR)="m")!($E(DUR)="l")!($E(DUR)="d")!($E(DUR)="h")!($E(DUR)="a") IVLIMIT=1 S DUR=$S($G(RAW):DUR,1:$$FMTDUR(DUR))
"RTN","PSJLIVMD",190,0)
 S DUR=$P(ND25,U,2) I DUR]"" S DUR=$S($G(RAW):DUR,1:$$FMTDUR(DUR))
"RTN","PSJLIVMD",191,0)
 Q
"RTN","PSJLIVMD",192,0)
 ;
"RTN","PSJLIVMD",193,0)
FMTDUR(DURCODE) ;
"RTN","PSJLIVMD",194,0)
 N DUNIT,DNUM,BAD S BAD=0
"RTN","PSJLIVMD",195,0)
 ;PSJ*5*180 - Add PSJBADD variable
"RTN","PSJLIVMD",196,0)
 K PSJBADD S PSJBADD=0
"RTN","PSJLIVMD",197,0)
 S DUNIT=$E(DURCODE),DNUM=$P(DURCODE,DUNIT,2) I 'DNUM S BAD=1
"RTN","PSJLIVMD",198,0)
 I DUNIT'="",DUNIT'?1(1U,1L) S PSJBADD=1
"RTN","PSJLIVMD",199,0)
 S DUNIT=$S(DUNIT="D"!(DUNIT="d"):" day",DUNIT="H"!(DUNIT="h"):" hour",DUNIT="W":" week",DUNIT="L":" month",DUNIT="M":" minute",DUNIT="S":" second",DUNIT="m":" ml",DUNIT="l":" liter",DUNIT="a":" dose",1:"")
"RTN","PSJLIVMD",200,0)
 S:DUNIT="" BAD=1 I (DNUM'=1),(DUNIT'["ml") S DUNIT=DUNIT_"s"
"RTN","PSJLIVMD",201,0)
 I PSJBADD=1 S PSGACT=$TR($G(PSGACT),"F")
"RTN","PSJLIVMD",202,0)
 Q $S(PSJBADD=1:"*INVALID DURATION/LIMIT*",BAD:"",1:DNUM_DUNIT)
"RTN","PSJLIVMD",203,0)
 ;
"RTN","PSJLIVMD",204,0)
DURMIN(DCOD) ;
"RTN","PSJLIVMD",205,0)
 N DUR,DMIN,CHR S DUR="" F I=1:1:$L(DCOD) S CHR=$E(DCOD,I) I CHR?1N S DUR=DUR_CHR
"RTN","PSJLIVMD",206,0)
 S DMIN=DUR*$S(DCOD["L":43200,DCOD["W":10080,DCOD["M":1,DCOD["S":(1/60),DCOD["D":1440,1:0) S DMIN=+$FN(DMIN,"",1)
"RTN","PSJLIVMD",207,0)
 Q DMIN
"RTN","PSJLIVMD",208,0)
 ;
"RTN","PSJLIVMD",209,0)
DUR ;
"RTN","PSJLIVMD",210,0)
 N DUROUT,LABEL,IVLIMIT
"RTN","PSJLIVMD",211,0)
 Q:'$G(PSJORD)  S PSJL=""
"RTN","PSJLIVMD",212,0)
 S DUROUT=$$GETDUR^PSJLIVMD(PSGP,+PSJORD,$S(PSJORD["P":"P",1:"IV"))
"RTN","PSJLIVMD",213,0)
 S LABEL=$S($G(IVLIMIT):"IV Limit: ",1:"Duration: ") K IVLIMIT
"RTN","PSJLIVMD",214,0)
 S PSJL=$$SETSTR^VALM1(LABEL,PSJL,12,10)
"RTN","PSJLIVMD",215,0)
 S PSJL=PSJL_DUROUT
"RTN","PSJLIVMD",216,0)
 Q
"RTN","PSJOREN")
0^29^B15419073
"RTN","PSJOREN",1,0)
PSJOREN ;BIR/CML3-INTERFACE FOR INPATIENT PHARMACY AND OE/RR ;07 AUG 97 / 3:21 PM
"RTN","PSJOREN",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**109,127,134**;16 DEC 97;Build 124
"RTN","PSJOREN",3,0)
 ;
"RTN","PSJOREN",4,0)
 ;Reference to ^ORD(100.98 supported by DBIA 873
"RTN","PSJOREN",5,0)
 ;Reference to ^PS(51.2 supported by DBIA 2178
"RTN","PSJOREN",6,0)
 ;Reference to ^PS(55 supported by DBIA 2191
"RTN","PSJOREN",7,0)
 ;
"RTN","PSJOREN",8,0)
ENTRY ;
"RTN","PSJOREN",9,0)
 K PSGOEE,PSGOES
"RTN","PSJOREN",10,0)
 I '$D(^DPT(+ORVP,.1)) W !!,"THIS PATIENT HAS NOT BEEN ADMITTED.",!,"(Any non-IV orders entered will be discontinued by the pharmacist...)"
"RTN","PSJOREN",11,0)
 ;
"RTN","PSJOREN",12,0)
GO ; get orders
"RTN","PSJOREN",13,0)
 S PSGOEORF=1,PSGOEAV=0,PSJORTOU=$O(^ORD(100.98,"B","INPATIENT MEDICATIONS",0)),PSGOEDMR=$O(^PS(51.2,"B","ORAL",0)),PSGOEPR=PSJORPV
"RTN","PSJOREN",14,0)
 F  S PSGOEOS="U" D ^PSGOE7 Q:Y<0  D:X?1"S."1.E ^PSGOES I X'?1."S."1.E D ^PSGOE6 K PSGOEE D:$D(Y) ^PSGOETO
"RTN","PSJOREN",15,0)
 ;
"RTN","PSJOREN",16,0)
DONE ;
"RTN","PSJOREN",17,0)
 ;
"RTN","PSJOREN",18,0)
OUT ;
"RTN","PSJOREN",19,0)
 Q  ;
"RTN","PSJOREN",20,0)
PS ;
"RTN","PSJOREN",21,0)
 W $C(7),!!,"The selected PROVIDER is NOT qualified to write MEDICATION orders.  You must",!,"select a valid provider to be able to continue with Inpatient Medications."
"RTN","PSJOREN",22,0)
 K DIC S DIC="^VA(200,",DIC(0)="AEMQZ",DIC("A")="Select PHARMACY PROVIDER: ",DIC("S")="S PSG=$G(^(""PS"")) I PSG,$S('$P(PSG,""^"",4):1,1:DT<$P(PSG,""^"",4))" F  W ! D ^DIC Q:$D(DUOUT)!$D(DTOUT)!(Y>0)  W $C(7),"  (Required.)"
"RTN","PSJOREN",23,0)
 K DIC S:Y'>0 PSJORPF=11 S:Y>0 PSJORPV=+Y,PSJORPVN=Y(0,0) Q
"RTN","PSJOREN",24,0)
 Q
"RTN","PSJOREN",25,0)
ENBKOUT(DFN,ON) ; Undo Renew.
"RTN","PSJOREN",26,0)
 Q:'$G(ON)
"RTN","PSJOREN",27,0)
 N PSJOLD,PSJRES,PSJOC,PSJOC2,PSIVACT,PSIVALT,PSIVREA,ON55,PSGAL,DA,PSIVAL,PSJUNDC
"RTN","PSJOREN",28,0)
 S PSJOC=PSOC,PSJOC2=PSJHLMTN,PSIVAL=24000
"RTN","PSJOREN",29,0)
 S X=$G(^PS(53.1,+ON,0)) Q:'X
"RTN","PSJOREN",30,0)
 S PSJRES=$P(X,U,24),(X,PSJOLD)=$P(X,U,25)
"RTN","PSJOREN",31,0)
 I PSJOLD["V" D
"RTN","PSJOREN",32,0)
 .I $D(^PS(55,DFN,"IV",+PSJOLD,2)) D
"RTN","PSJOREN",33,0)
 ..N PSJOSTOP,PSJNOW,PSJSTAT S PSJNOW=$$DATE^PSJUTL2(),PSJOSTOP=$P($G(^PS(55,DFN,"IV",+PSJOLD,0)),"^",3),PSJSTAT=$P(^(0),"^",17)
"RTN","PSJOREN",34,0)
 ..S $P(^PS(55,DFN,"IV",+PSJOLD,2),U,6)="",$P(^(2),U,9)="",$P(^(0),U,17)=$S(PSJNOW>PSJOSTOP:"E",PSJSTAT="R":"A",1:PSJSTAT)
"RTN","PSJOREN",35,0)
 ..S PSIVACT=1,PSIVALT=$S(PSOC="CR":2,1:1),PSJUNDC=1,PSIVAL=$P($G(^PS(53.3,+PSIVAL,0)),U),PSIVREA="PNRD",ON55=PSJOLD
"RTN","PSJOREN",36,0)
 .D LOG^PSIVORAL
"RTN","PSJOREN",37,0)
 I PSJOLD["U" D
"RTN","PSJOREN",38,0)
 .I $D(^PS(55,DFN,5,+PSJOLD,0)) N PSJSTAT S PSJSTAT=$P(^(0),"^",9) D
"RTN","PSJOREN",39,0)
 ..N PSJOSTOP,PSJNOW S PSJNOW=$$DATE^PSJUTL2(),PSJOSTOP=$P($G(^PS(55,DFN,5,+PSJOLD,2)),"^",4)
"RTN","PSJOREN",40,0)
 ..S $P(^PS(55,DFN,5,+PSJOLD,0),U,26,27)=U,PSGAL("C")=24000,DA=+PSJOLD,DA(1)=DFN S $P(^(0),U,9)=$S(PSJNOW>PSJOSTOP:"E",PSJSTAT="R":"A",1:PSJSTAT)
"RTN","PSJOREN",41,0)
 .D ^PSGAL5
"RTN","PSJOREN",42,0)
 S PSOC="SC",PSJHLMTN="ORM" D EN1^PSJHL2(DFN,PSOC,PSJOLD) S PSOC=PSJOC,PSJHLMTN=PSJOC2
"RTN","PSJOREN",43,0)
 Q
"RTN","PSJOREN",44,0)
 ;
"RTN","PSJOREN",45,0)
ENUDTX(DFN,ON,RES) ; Set up ORTX( Array for UD orders.
"RTN","PSJOREN",46,0)
 K ORTX N DO,MRN,ND0,NDP1,ND2,PD,ST,SCH
"RTN","PSJOREN",47,0)
 S Y=2 I ON["A"!(ON["O") S ND0=$G(^PS(55,DFN,5,+ON,0)),NDP1=$G(^(.1)),ND2=$G(^(2)),Y=2 F X=0:0 S X=$O(^PS(55,DFN,5,+ON,12,X)) Q:'X  S Y=Y+1,ORTX(Y)=$G(^(X,0))
"RTN","PSJOREN",48,0)
 E  S ND0=$G(^PS(53.1,+ON,0)),NDP1=$G(^(.1)),ND2=$G(^(2)),Y=2 F X=0:0 S X=$O(^PS(53.1,+ON,12,X)) Q:'X  S Y=Y+1,ORTX(Y)=$G(^(X,0))
"RTN","PSJOREN",49,0)
 S ORTX(1)=$S($G(RES)="NR":"RENEWAL -",$G(RES)="OR":"RENEWED -",1:"")_$P($G(^PS(50.3,+NDP1,0)),U)
"RTN","PSJOREN",50,0)
 S ORTX(2)=" Give: "_$S($P(NDP1,U,2)]"":$P(NDP1,U,2)_" ",1:"")_$P($G(^PS(51.2,+$P(ND0,U,3),0)),U,3)_" "_$P(ND2,U)_$S($P(ND2,U)["PRN":"",$P(ND0,U,7)="P":" PRN",1:"")
"RTN","PSJOREN",51,0)
 I $G(DFN),$G(ON) S:ON["U" ^PS(55,"AUE",DFN,+ON)=""
"RTN","PSJOREN",52,0)
 Q
"RTN","PSJORPOE")
0^30^B37937868
"RTN","PSJORPOE",1,0)
PSJORPOE ;BIR/MLM,LDT-MISC. PROCEDURE CALLS FOR OE/RR 3.0 ;24 Feb 99 / 10:43 AM
"RTN","PSJORPOE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**50,56,92,80,110,127,133,134**;16 DEC 97;Build 124
"RTN","PSJORPOE",3,0)
 ;
"RTN","PSJORPOE",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJORPOE",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJORPOE",6,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJORPOE",7,0)
 ; Reference to ^PS(51.1 is supported by DBIA# 2177.
"RTN","PSJORPOE",8,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJORPOE",9,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJORPOE",10,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192.
"RTN","PSJORPOE",11,0)
 ;
"RTN","PSJORPOE",12,0)
STARTSTP(PSGP,SCH,OI,PSJPWD,PSGORD,PSJADM) ;
"RTN","PSJORPOE",13,0)
 ; PSGP=Patient IEN
"RTN","PSJORPOE",14,0)
 ; SCH=Schedule
"RTN","PSJORPOE",15,0)
 ; OI=Orderable Item        
"RTN","PSJORPOE",16,0)
 ; PSJPWD=Ward Location (Optional)
"RTN","PSJORPOE",17,0)
 ; PSGORD=Pharmacy Order Number if the order being placed is a Renewal (Optional)
"RTN","PSJORPOE",18,0)
 ;
"RTN","PSJORPOE",19,0)
 Q:+PSGP'>0 ""
"RTN","PSJORPOE",20,0)
 Q:SCH']"" ""
"RTN","PSJORPOE",21,0)
 Q:+OI'>0 ""
"RTN","PSJORPOE",22,0)
 I SCH?.E1L.E S SCH=$$ENLU^PSGMI(SCH)
"RTN","PSJORPOE",23,0)
 K DFN,PSGNEFDO,PSGNEFD,PSGST,PSGSCH,PSGNEDFD,PSGNESD,PSJSYSW,PSJSYSW0 N RESULT
"RTN","PSJORPOE",24,0)
 S:'$D(PSGS0XT) PSGS0XT="" S:'$D(PSGS0Y) PSGSOY=""
"RTN","PSJORPOE",25,0)
 I $G(PSJPWD)']"" S DFN=PSGP D IN5^VADPT S:VAIP(5)]"" PSJPWD=+VAIP(5)
"RTN","PSJORPOE",26,0)
 S PSJSYSW0="",PSJSYSW=0 I $G(PSJPWD)]"" S PSJSYSW=+$O(^PS(59.6,"B",PSJPWD,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJORPOE",27,0)
 S RESULT=$S($P(PSJSYSW0,"^",5)=0:"CLOSEST",$P(PSJSYSW0,"^",5)=1:"NEXT",1:"NOW")
"RTN","PSJORPOE",28,0)
 I OI]"" S PSGST=$S($P($G(^PS(50.7,OI,0)),"^",7)]"":$P($G(^PS(50.7,OI,0)),"^",7),1:"C")
"RTN","PSJORPOE",29,0)
 N %,PSGXSCH D NOW^%DTC S PSGDT=%,DFN=PSGP,(PSGSCH,PSGXSCH)=SCH
"RTN","PSJORPOE",30,0)
 S X=PSGSCH,PSGS0Y="" D ADMIN
"RTN","PSJORPOE",31,0)
 I $G(PSGORD)]"" D
"RTN","PSJORPOE",32,0)
 .S PSGNESD=$$DSTART^PSJDCU(PSGP,PSGORD) I PSGNESD]"" S $P(RESULT,"^",2)=PSGNESD Q
"RTN","PSJORPOE",33,0)
 .S ND=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,2)),1:$G(^PS(55,PSGP,"IV",+PSGORD,0)))
"RTN","PSJORPOE",34,0)
 .N PSJADM,PSJSTRT S PSJADM=$S(PSGORD["U":$P(ND,"^",5),1:$P(ND,"^",11)),PSJSTRT=$P(ND,"^",2),PSJREN=1
"RTN","PSJORPOE",35,0)
 S SCH=PSGXSCH
"RTN","PSJORPOE",36,0)
 N PSJTMPW0 S PSJTMPW0=PSJSYSW0 S $P(PSJSYSW0,"^",5)=1
"RTN","PSJORPOE",37,0)
 I $G(PSGNESD)="" S RESULT=RESULT_"^"_$$ENSD^PSGNE3(PSGSCH,$S($G(PSJADM)]"":$G(PSJADM),1:PSGS0Y),PSGDT,$S($G(PSJSTRT)]"":$G(PSJSTRT),1:PSGDT))
"RTN","PSJORPOE",38,0)
 S PSJSYSW0=PSJTMPW0
"RTN","PSJORPOE",39,0)
 S PSGNESD=$P(RESULT,"^",2)
"RTN","PSJORPOE",40,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",OI)
"RTN","PSJORPOE",41,0)
 K PSGODF,PSGOES,PSJREN
"RTN","PSJORPOE",42,0)
 S SCH=PSGXSCH
"RTN","PSJORPOE",43,0)
 D ENFD^PSGNE3(PSGDT) S RESULT=RESULT_"^"_$G(PSGNEFD) ;_"^"_$G(PSGNEFDO)
"RTN","PSJORPOE",44,0)
 N DATE S DATE=$$FMDIFF^XLFDT($P(RESULT,"^",3),$P(RESULT,"^",2),3)
"RTN","PSJORPOE",45,0)
 S $P(RESULT,"^",3)=$S($G(PSGST)="O":0,+DATE>0:+DATE_"D",$P($P(DATE," ",2),":")>0:$P($P(DATE," ",2),":")_"H",1:0)
"RTN","PSJORPOE",46,0)
 N STRING S STRING=PSGNESD_U_PSGNEFD_U_$G(PSGSCH)_U_$G(PSGST)_U_$G(OI) I ($P($G(ZZND),U,2)]"")&($P($G(ZZND),"^")=$G(PSGSCH)) S STRING=STRING_U_$P(ZZND,U,2)
"RTN","PSJORPOE",47,0)
 I $G(PSGSCH)]"" I $$DOW^PSIVUTL(PSGSCH) S:$G(PSGS0Y) $P(STRING,"^",6)=PSGS0Y
"RTN","PSJORPOE",48,0)
 I $G(PSJADM) S $P(STRING,"^",6)=PSJADM
"RTN","PSJORPOE",49,0)
 S RESULT=RESULT_"^"_$$ENQ^PSJORP2(PSGP,STRING) I ($G(PSGSCH)]"") I $$DOW^PSIVUTL(PSGSCH),(PSGSCH'["@"),'$G(PSGS0Y) S $P(RESULT,"^",4)=$P(RESULT,"^",2)
"RTN","PSJORPOE",50,0)
 I ($G(PSGSCH)]"") I $$PRNOK^PSGS0(PSGSCH) S $P(RESULT,"^",4)=$P(RESULT,"^",2)
"RTN","PSJORPOE",51,0)
 D KVAR^VADPT K LYN,ND,PSGDT,PSGNEDFD,PSGNEFD,PSGNEFDO,PSGNESD,PSGS0Y,PSGSCH,PSGST,PSJSYSW,PSJSYSW0,ZZ
"RTN","PSJORPOE",52,0)
 ;RESULT=WARD PARAMETER^DEFAULT START DATE/TIME^#_D(NUMBER OF DAYS ORDER LASTS) OR #_H(NUMBER OF HOURS ORDER LASTS)^EXPECTED FIRST DOSE
"RTN","PSJORPOE",53,0)
 Q RESULT
"RTN","PSJORPOE",54,0)
 ;
"RTN","PSJORPOE",55,0)
RESOLVE(PSGP,SCH,OI,PCH,PSJPWD,PSJADM) ;
"RTN","PSJORPOE",56,0)
 ; PSGP=Patient IEN
"RTN","PSJORPOE",57,0)
 ; SCH=Schedule
"RTN","PSJORPOE",58,0)
 ; OI=Orderable Item
"RTN","PSJORPOE",59,0)
 ; PCH=Providers Choice
"RTN","PSJORPOE",60,0)
 ; PSJPWD=Ward Location (Optional)
"RTN","PSJORPOE",61,0)
 ; PSJADM=Admin Times (Optional)
"RTN","PSJORPOE",62,0)
 ;
"RTN","PSJORPOE",63,0)
 N PSJSYSW0,PSJSYSW,PSGSCH,PSGOES,PSGS0Y,DFN,RESULT1
"RTN","PSJORPOE",64,0)
 I $G(PSJPWD)']"" S DFN=PSGP D IN5^VADPT S:VAIP(5)]"" PSJPWD=+VAIP(5)
"RTN","PSJORPOE",65,0)
 S PSJSYSW0="",PSJSYSW=0 I $G(PSJPWD)]"" S PSJSYSW=+$O(^PS(59.6,"B",PSJPWD,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJORPOE",66,0)
 S $P(PSJSYSW0,"^",5)=$S($$ONE(SCH):2,PCH="NEXT":1,1:0)
"RTN","PSJORPOE",67,0)
 S RESULT1=$S($P(PSJSYSW0,"^",5)=0:"CLOSEST",$P(PSJSYSW0,"^",5)=1:"NEXT",1:"NOW")
"RTN","PSJORPOE",68,0)
 I OI]"" S PSGST=$S($P($G(^PS(50.7,OI,0)),"^",7)]"":$P($G(^PS(50.7,OI,0)),"^",7),1:"C")
"RTN","PSJORPOE",69,0)
 N % D NOW^%DTC S PSGDT=%,DFN=PSGP,PSGSCH=SCH
"RTN","PSJORPOE",70,0)
 S X=PSGSCH,PSGS0Y="" I $D(^PS(51.1,"AC","PSJ",X)) D ADMIN
"RTN","PSJORPOE",71,0)
 S:$G(PSJADM) PSGS0Y=PSJADM
"RTN","PSJORPOE",72,0)
 S RESULT1=RESULT1_"^"_$$ENSD^PSGNE3(SCH,PSGS0Y,PSGDT,PSGDT)
"RTN","PSJORPOE",73,0)
 I $G(PSGSCH)]"" I $$DOW^PSIVUTL(PSGSCH),(PSGSCH'["@"),'$G(PSGS0Y) S $P(RESULT,"^",4)=$P(RESULT,"^",2)
"RTN","PSJORPOE",74,0)
 I $G(PSGSCH)]"" I $$PRNOK^PSGS0(PSGSCH) S $P(RESULT1,"^",4)=$P(RESULT,"^",2)
"RTN","PSJORPOE",75,0)
 D KVAR^VADPT K LYN,PSGDT,PSGNEDFD,PSGNEFD,PSGNEFDO,PSGNESD,PSGS0Y,PSGSCH,PSGST,PSJSYSW,PSJSYSW0,ZZ,PSGS0XT,PSGS0Y
"RTN","PSJORPOE",76,0)
 Q RESULT1
"RTN","PSJORPOE",77,0)
 ;
"RTN","PSJORPOE",78,0)
SCHREQ(MR,OI,DD)  ;
"RTN","PSJORPOE",79,0)
 ; MR=Medication Route from 51.2 (Required)
"RTN","PSJORPOE",80,0)
 ; OI=Orderable Item from 50.7 (Optional)
"RTN","PSJORPOE",81,0)
 ; DD=Dispense Drug from 50 (Optional)
"RTN","PSJORPOE",82,0)
 N ADDITIVE,SOLUTION,REQ S REQ=0,(SOLUTION,ADDITIVE)=""
"RTN","PSJORPOE",83,0)
 I '+$G(MR) S REQ=1 Q REQ
"RTN","PSJORPOE",84,0)
 I '+$G(OI),'+$G(DD) S REQ=1 Q REQ
"RTN","PSJORPOE",85,0)
 I +$G(DD) S:$P($G(^PSDRUG(+DD,2)),U,3)["U" REQ=1 Q REQ
"RTN","PSJORPOE",86,0)
 I '$D(PS(51.2,+MR,0)) S REQ=1 Q REQ
"RTN","PSJORPOE",87,0)
 I $P($G(^PS(51.2,+MR,0)),"^",6)=1 D
"RTN","PSJORPOE",88,0)
 .I +$G(OI) D
"RTN","PSJORPOE",89,0)
 ..I '$D(^PS(50.7,+OI,0)) S REQ=1 Q
"RTN","PSJORPOE",90,0)
 ..F  S SOLUTION=$O(^PS(52.7,"AOI",+OI,SOLUTION)) Q:'SOLUTION  Q:REQ=1  S:$P(^PSDRUG(+$P(^PS(52.7,SOLUTION,0),U,2),2),U,3)["U" REQ=1
"RTN","PSJORPOE",91,0)
 ..F  S ADDITIVE=$O(^PS(52.6,"AOI",+OI,ADDITIVE)) Q:'ADDITIVE  Q:REQ=1  S:$P(^PSDRUG(+$P(^PS(52.6,ADDITIVE,0),U,2),2),U,3)["U" REQ=1
"RTN","PSJORPOE",92,0)
 Q REQ
"RTN","PSJORPOE",93,0)
 ;
"RTN","PSJORPOE",94,0)
ADMIN ; Get admin times associated with schedule
"RTN","PSJORPOE",95,0)
 S PSGS0Y="",ZZ=0
"RTN","PSJORPOE",96,0)
 I $$DOW^PSIVUTL($P(X,"@")),'$D(^PS(51.1,"AC","PSJ",X)) S PSGST="D" D  Q:$G(PSGS0Y)
"RTN","PSJORPOE",97,0)
 .I $P(X,"@",2) N PSJADBAD D  Q
"RTN","PSJORPOE",98,0)
 ..S PSGS0Y=$S($G(PSJADBAD):"",1:$P(X,"@",2))
"RTN","PSJORPOE",99,0)
 ..N ADMIN,TIME,II S ADMIN=$P(X,"@",2) F II=1:1:$L(ADMIN,"-") S TIME=$P(ADMIN,"-",II) I TIME'?2N&(TIME'?4N) S PSJADBAD=1
"RTN","PSJORPOE",100,0)
 .I $P(X,"@",2)]"",$D(^PS(51.1,"APPSJ",$P(X,"@",2))) S X=$P(X,"@",2)
"RTN","PSJORPOE",101,0)
 D FIND^DIC(51.1,,,,X,,"APPSJ",,,"LYN")
"RTN","PSJORPOE",102,0)
 S ZZ=$O(LYN("DILIST",2,ZZ)) I ZZ S ZZ=+LYN("DILIST",2,ZZ) I ZZ S ZZND=$G(^PS(51.1,ZZ,0)) S PSGST=$P(ZZND,U,5),PSGS0XT=$P(ZZND,U,3) S:$G(PSGSFLG) PSGSCIEN=$G(LYN("DILIST",2,ZZ)) I $G(PSJPWD) D
"RTN","PSJORPOE",103,0)
 . N ZZNDW S ZZNDW=$G(^PS(51.1,ZZ,1,PSJPWD,0)) I $P(ZZNDW,"^",2)]"" S PSGS0Y=$P(ZZNDW,"^",2),$P(ZZND,"^",2)=PSGS0Y I $G(PSGSFLG) S PSGSCIEN=$G(LYN("DILIST",2,ZZ))
"RTN","PSJORPOE",104,0)
 S ZZ=0 F  S ZZ=$O(LYN("DILIST",1,ZZ)) Q:'ZZ  I $G(LYN("DILIST",1,ZZ))'=X K LYN("DILIST",1,ZZ),LYN("DILIST",2,ZZ),LYN("DILIST","ID",ZZ,1)
"RTN","PSJORPOE",105,0)
 I $D(PSJPWD) S ZZ=0 F  S ZZ=$O(LYN("DILIST",2,ZZ)) Q:'ZZ!$G(PSGS0Y)  I $P($G(^PS(51.1,+LYN("DILIST",2,ZZ),1,+PSJPWD,0)),U,2)]"" S PSGS0Y=$P($G(^(0)),U,2) I $G(PSGSFLG) S PSGSCIEN=$G(LYN("DILIST",2,ZZ))
"RTN","PSJORPOE",106,0)
 Q:PSGS0Y]""  S ZZ=0 F  S ZZ=$O(LYN("DILIST",2,ZZ)) Q:'ZZ!$G(PSGS0Y)  I $G(LYN("DILIST","ID",ZZ,1))]"" S PSGS0Y=$G(LYN("DILIST","ID",ZZ,1))
"RTN","PSJORPOE",107,0)
 Q
"RTN","PSJORPOE",108,0)
 ;
"RTN","PSJORPOE",109,0)
ONE(SCH) ;
"RTN","PSJORPOE",110,0)
 ; SCH=Admin Schedule
"RTN","PSJORPOE",111,0)
 ; Returns 0 = (zero) Not a one time schedule.
"RTN","PSJORPOE",112,0)
 ;         1 =  One time schedule. 
"RTN","PSJORPOE",113,0)
 Q:$G(SCH)="" 0
"RTN","PSJORPOE",114,0)
 N X,SCHLST
"RTN","PSJORPOE",115,0)
 S SCHLST=",TODAY,ONCE,NOW,ONE TIME,ONETIME,ONE-TIME,1TIME,1 TIME,1-TIME,STAT,"
"RTN","PSJORPOE",116,0)
 I SCHLST[(","_SCH_",") Q 1
"RTN","PSJORPOE",117,0)
 I $D(^PS(51.1,"AC","PSJ",SCH)) S X=$O(^(SCH,"")) S X=$P(^PS(51.1,X,0),"^",5) Q $S(X="O":1,1:0)
"RTN","PSJORPOE",118,0)
 Q 0
"RTN","PSJORRE")
0^1^B32121973
"RTN","PSJORRE",1,0)
PSJORRE ;BIR/MV-RETURN INPATIENT ACTIVE MEDS (CONDENSED) ;28 Jan 99 / 12:56 PM
"RTN","PSJORRE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**22,51,50,58,81,110,111,112,134**;16 DEC 97;Build 124
"RTN","PSJORRE",3,0)
 ;
"RTN","PSJORRE",4,0)
 ;Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJORRE",5,0)
 ;Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJORRE",6,0)
 ;Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJORRE",7,0)
 ;Reference to ^TMP("PS" is documented in DBIA #2383.
"RTN","PSJORRE",8,0)
 ;
"RTN","PSJORRE",9,0)
OCL(DFN,BDT,EDT,TFN,MVIEW)         ; return condensed list of inpat meds
"RTN","PSJORRE",10,0)
 ; MVIEW=0   -  This returns the 'unsorted' list as it was returned prior to GUI 27 
"RTN","PSJORRE",11,0)
 ; MVIEW=1   -  This returns the old sort view of the list, pre-sorted for GUI 27
"RTN","PSJORRE",12,0)
 ; MVIEW=2   -  This returns new sort view #1 of the order profile for GUI 27 
"RTN","PSJORRE",13,0)
 ; MVIEW=3   -  This returns new sort view #2 of the order profile for GUI 27
"RTN","PSJORRE",14,0)
 D @$S($G(MVIEW)=3:"OCL^PSJORRN1(DFN,BDT,EDT,.TFN)",$G(MVIEW)=2:"OCL^PSJORRN(DFN,BDT,EDT,.TFN)",$G(MVIEW)=1:"OCL^PSJORRO(DFN,BDT,EDT,.TFN)",1:"OCL1(DFN,BDT,EDT,TFN)")
"RTN","PSJORRE",15,0)
 Q
"RTN","PSJORRE",16,0)
OCL1(DFN,BDT,EDT,TFN,MVIEW) ; Execute this section if MVIEW=0
"RTN","PSJORRE",17,0)
 N ADM,CNT,DN,DO,F,FON,INFUS,INST,MR,ND,ND0,ND2,ND6,ON,PON,PST,SCH,SIO,STAT,TYPE,UNITS,WBDT,X,Y,PSJCLIN,A
"RTN","PSJORRE",18,0)
 ; PON=placer order number (oerr), FON=filler order number
"RTN","PSJORRE",19,0)
 S:BDT="" BDT=DT S WBDT=BDT_".000001"
"RTN","PSJORRE",20,0)
 S:EDT="" EDT=9999999
"RTN","PSJORRE",21,0)
 S:EDT'["." EDT=EDT_".999999"
"RTN","PSJORRE",22,0)
 S F="^PS(55,DFN,5," F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  D UDTMP
"RTN","PSJORRE",23,0)
 S F="^PS(53.1," F PST="P","N" F ON=0:0 S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  S X=$P($G(^PS(53.1,+ON,0)),U,4) D @$S(X="U":"UDTMP",1:"IVTMP")
"RTN","PSJORRE",24,0)
 S F="^PS(55,"_DFN_",""IV"",",WBDT=BDT F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  D IVTMP
"RTN","PSJORRE",25,0)
 Q
"RTN","PSJORRE",26,0)
 ;
"RTN","PSJORRE",27,0)
UDTMP ;*** Set ^TMP for Unit dose orders.
"RTN","PSJORRE",28,0)
 N PROVIDER,RNWDT,EDTCMPLX,NDP2 S (MR,SCH,INST,PON)="",FON=+ON_$S(F["53.1":"P",1:"U")
"RTN","PSJORRE",29,0)
 D TYPE
"RTN","PSJORRE",30,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRE",31,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8)
"RTN","PSJORRE",32,0)
 S ND2=$G(@(F_ON_",2)")) I 'EDTCMPLX I F'["53.1",($P(ND2,U,2)>EDT) Q
"RTN","PSJORRE",33,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F["53.1",($P(ND0,U,16)>EDT) Q
"RTN","PSJORRE",34,0)
 S STAT=$$CODES^PSIVUTL($P(ND0,U,9),$S(FON["P":53.1,1:55.06),28)
"RTN","PSJORRE",35,0)
 S ND6=$P($G(@(F_ON_",6)")),"^"),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRE",36,0)
 S FON=+ON_$S(F["53.1":"P",1:"U"),DO=$P($G(@(F_ON_",.2)")),"^",2)
"RTN","PSJORRE",37,0)
 D DRGDISP^PSJLMUT1(DFN,FON,40,0,.DN,1)
"RTN","PSJORRE",38,0)
 S UNITS="" I '$O(@(F_+ON_",1,1)")) S UNITS=$P($G(@(F_+ON_",1,1,0)")),U,2) S:(FON["U")&(UNITS="") UNITS=1
"RTN","PSJORRE",39,0)
 S:+$P(ND0,U,3) MR=$$MR^PSJORRE1(+$P(ND0,U,3))
"RTN","PSJORRE",40,0)
 N NOTGIVEN S NOTGIVEN=$S(FON["U":$P($G(^PS(55,DFN,5,+ON,0)),"^",22),1:"")
"RTN","PSJORRE",41,0)
 S TFN=TFN+1
"RTN","PSJORRE",42,0)
 S ^TMP("PS",$J,TFN,0)=FON_";I"_U_DN(1)_"^^"_$P(ND2,U,4)_"^^"_DO_U_UNITS_U_$P(ND0,U,21)_U_STAT_U_U_U_U_NOTGIVEN_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_$P(ND2,U,2)_U_$G(RNWDT)
"RTN","PSJORRE",43,0)
 K ^TMP("PS",$J,TFN,"CLINIC",0) I PSJCLIN]"" S ^TMP("PS",$J,TFN,"CLINIC",0)=PSJCLIN
"RTN","PSJORRE",44,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",2)
"RTN","PSJORRE",45,0)
 I PROVIDER S ^TMP("PS",$J,TFN,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRE",46,0)
 S ^TMP("PS",$J,TFN,"MDR",0)=MR]"" S:MR]"" ^TMP("PS",$J,TFN,"MDR",1,0)=MR
"RTN","PSJORRE",47,0)
 S ^TMP("PS",$J,TFN,"SCH",0)=$P(ND2,U)]"" S:$P(ND2,U)]"" ^TMP("PS",$J,TFN,"SCH",1,0)=$P(ND2,U)
"RTN","PSJORRE",48,0)
 S ^TMP("PS",$J,TFN,"SIG",0)=INST]"" S:INST]"" ^TMP("PS",$J,TFN,"SIG",1,0)=INST
"RTN","PSJORRE",49,0)
 S ^TMP("PS",$J,TFN,"ADM",0)=$P(ND2,U,5)]"" S:$P(ND2,U,5)]"" ^TMP("PS",$J,TFN,"ADM",1,0)=$P(ND2,U,5)
"RTN","PSJORRE",50,0)
 S ^TMP("PS",$J,TFN,"SIO",0)=ND6]"" S:ND6]"" ^TMP("PS",$J,TFN,"SIO",1,0)=ND6
"RTN","PSJORRE",51,0)
 Q
"RTN","PSJORRE",52,0)
 ;
"RTN","PSJORRE",53,0)
IVTMP ;*** Set ^TMP for IV orders.
"RTN","PSJORRE",54,0)
 N PROVIDER,START,STOP,EDTCMPLX,NDP2,IVLIM
"RTN","PSJORRE",55,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8)
"RTN","PSJORRE",56,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F'["53.1",($P(ND0,U,2)>EDT) Q
"RTN","PSJORRE",57,0)
 D TYPE
"RTN","PSJORRE",58,0)
 S FON=+ON_$S(F["53.1":"P",1:"V"),TFN=TFN+1,CNT=0
"RTN","PSJORRE",59,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRE",60,0)
 F X=0:0 S X=$O(@(F_ON_",""AD"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""AD"","_X_",0)")),DN=$P($G(^PS(52.6,+ND,0)),U),Y=DN_U_$P(ND,U,2) S:$P(ND,U,3) Y=Y_U_$P(ND,U,3) S CNT=CNT+1,^TMP("PS",$J,TFN,"A",CNT,0)=Y
"RTN","PSJORRE",61,0)
 S ^TMP("PS",$J,TFN,"A",0)=CNT,CNT=0
"RTN","PSJORRE",62,0)
 F X=0:0 S X=$O(@(F_ON_",""SOL"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0)),CNT=CNT+1,^TMP("PS",$J,TFN,"B",CNT,0)=$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)
"RTN","PSJORRE",63,0)
 S ^TMP("PS",$J,TFN,"B",0)=CNT
"RTN","PSJORRE",64,0)
 S TYPE=$P(ND0,U,4),(MR,SCH,INST,INFUS)=""
"RTN","PSJORRE",65,0)
 I FON["P" S ND2=$G(^PS(53.1,+ON,2)),SCH=$P(ND2,U),START=$P(ND2,U,2),STOP=$P(ND2,U,4),MR=$P(ND0,U,3),INFUS=$P($G(^PS(53.1,+ON,8)),U,5),STAT=$$CODES^PSIVUTL($P(ND0,U,9),53.1,28),ADM=$P(ND2,U,5),SIO=$P($G(@(F_+ON_",6)")),"^")
"RTN","PSJORRE",66,0)
 I FON'["P" S START=$P(ND0,U,2),STOP=$P(ND0,U,3),SCH=$P(ND0,U,9),INFUS=$P(ND0,U,8),MR=$P($G(^PS(55,DFN,"IV",+ON,.2)),U,3),STAT=$$CODES^PSIVUTL($P(ND0,U,17),55.01,100),ADM=$P(ND0,U,11),SIO=$P($G(@(F_+ON_",3)")),"^")
"RTN","PSJORRE",67,0)
 S DN=$G(@(F_+ON_",.2)")),DO=$P(DN,U,2)
"RTN","PSJORRE",68,0)
 S DN=$S(+$P(DN,U):$$OIDF^PSJLMUT1($P(DN,U)),1:"")
"RTN","PSJORRE",69,0)
 S:MR MR=$$MR^PSJORRE1(+MR),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRE",70,0)
 S ^TMP("PS",$J,TFN,0)=FON_";I"_U_DN_U_INFUS_U_STOP_"^^"_DO_"^^"_$P(ND0,"^",21)_U_STAT_U_U_U_U_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_START_U_$G(RNWDT)
"RTN","PSJORRE",71,0)
 K ^TMP("PS",$J,TFN,"CLINIC",0) I PSJCLIN]"" S ^TMP("PS",$J,TFN,"CLINIC",0)=PSJCLIN
"RTN","PSJORRE",72,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",6)
"RTN","PSJORRE",73,0)
 I PROVIDER S ^TMP("PS",$J,TFN,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRE",74,0)
 S ND2P5=$G(@(F_+ON_",2.5)")) S IVLIM=$P(ND2P5,U,4) I $E(IVLIM)="a" S IVLIM="doses"_$P(IVLIM,"a",2)
"RTN","PSJORRE",75,0)
 I IVLIM="" S IVLIM=$P(ND2P5,U,2) S:(IVLIM'["d")&(IVLIM'["h") IVLIM=""
"RTN","PSJORRE",76,0)
 S ^TMP("PS",$J,TFN,"MDR",0)=MR]"" S:MR]"" ^TMP("PS",$J,TFN,"MDR",1,0)=MR
"RTN","PSJORRE",77,0)
 S ^TMP("PS",$J,TFN,"SIG",0)=INST]"" S:INST]"" ^TMP("PS",$J,TFN,"SIG",1,0)=INST
"RTN","PSJORRE",78,0)
 S ^TMP("PS",$J,TFN,"SCH",0)=SCH]"" S:SCH]"" ^TMP("PS",$J,TFN,"SCH",1,0)=SCH
"RTN","PSJORRE",79,0)
 S ^TMP("PS",$J,TFN,"ADM",0)=ADM]"" S:ADM]"" ^TMP("PS",$J,TFN,"ADM",1,0)=ADM
"RTN","PSJORRE",80,0)
 S ^TMP("PS",$J,TFN,"SIO",0)=SIO]"" S:SIO]"" ^TMP("PS",$J,TFN,"SIO",1,0)=SIO
"RTN","PSJORRE",81,0)
 I $G(IVLIM)]"" S ^TMP("PS",$J,TFN,"IVLIM",0)=IVLIM
"RTN","PSJORRE",82,0)
 Q
"RTN","PSJORRE",83,0)
STAT(Y,X) ;* Return the full status instead of just the code for U/D.
"RTN","PSJORRE",84,0)
 S X=$P($P(";"_$P(Y,U,3),";"_X_":",2),";")
"RTN","PSJORRE",85,0)
 Q X
"RTN","PSJORRE",86,0)
TYPE ;determine if this is an IMO order or not
"RTN","PSJORRE",87,0)
 S (A,PSJCLIN)="" I F["PS(53.1" S A=$G(^PS(53.1,ON,"DSS"))
"RTN","PSJORRE",88,0)
 I F["PS(55" S A=$S(F["IV":$G(^PS(55,DFN,"IV",ON,"DSS")),1:$G(^PS(55,DFN,5,ON,8)))
"RTN","PSJORRE",89,0)
 I $P(A,"^",2)'="" S PSJCLIN=+A
"RTN","PSJORRE",90,0)
 Q
"RTN","PSJORRE1")
0^32^B35337470
"RTN","PSJORRE1",1,0)
PSJORRE1 ;BIR/MV-RETURN INPATIENT ACTIVE MEDS (EXPANDED) ;29 Jan 99 / 8:49 AM
"RTN","PSJORRE1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**22,51,50,58,81,91,110,111,134**;16 DEC 97;Build 124
"RTN","PSJORRE1",3,0)
 ;
"RTN","PSJORRE1",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJORRE1",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJORRE1",6,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJORRE1",7,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJORRE1",8,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJORRE1",9,0)
 ; Reference to ^TMP("PS" is documented in DBIA #2384.
"RTN","PSJORRE1",10,0)
 ;
"RTN","PSJORRE1",11,0)
OEL(DFN,ON)         ; return list of expanded inpat meds
"RTN","PSJORRE1",12,0)
 K ^TMP("PS",$J)
"RTN","PSJORRE1",13,0)
 N ADM,CNT,DN,DO,F,INFUS,INST,MR,ND,ND0,ND2,ND2P5,ND6,NDOI,SCH,SIO,START,STAT,STOP,TYP,UNITS,X,Y
"RTN","PSJORRE1",14,0)
 S F=$S(ON["P":"^PS(53.1,",ON["U":"^PS(55,DFN,5,",1:"^PS(55,"_DFN_",""IV"",")
"RTN","PSJORRE1",15,0)
 I ON'["P",'$D(@(F_+ON_")")) Q
"RTN","PSJORRE1",16,0)
 I ON["P" S X=$G(^PS(53.1,+ON,0)) Q:$P(X,U,15)'=DFN  S TYP=$P(X,U,4) D @$S(TYP="U":"UDTMP",1:"IVTMP")
"RTN","PSJORRE1",17,0)
 D:ON'["P" @$S(ON["U":"UDTMP",1:"IVTMP")
"RTN","PSJORRE1",18,0)
 S Y=$S(ON["V":5,1:12),CNT=0
"RTN","PSJORRE1",19,0)
 I $O(@(F_+ON_","_Y_",0)")) D
"RTN","PSJORRE1",20,0)
 . F X=0:0 S X=$O(@(F_+ON_","_Y_","_X_")")) Q:'X  D
"RTN","PSJORRE1",21,0)
 ..S CNT=CNT+1,ND=$G(@(F_+ON_","_Y_","_X_",0)")),^TMP("PS",$J,"PC",CNT,0)=ND
"RTN","PSJORRE1",22,0)
 S ^TMP("PS",$J,"PC",0)=CNT
"RTN","PSJORRE1",23,0)
 Q
"RTN","PSJORRE1",24,0)
 ;
"RTN","PSJORRE1",25,0)
UDTMP ;*** Set ^TMP for Unit dose orders.
"RTN","PSJORRE1",26,0)
 N DO,DN,INST,X,Y,PROVIDER,NOTGIVEN,RNWDT
"RTN","PSJORRE1",27,0)
 S (MR,SCH,INST)=""
"RTN","PSJORRE1",28,0)
 S ND2=$G(@(F_+ON_",2)")),ND0=$G(@(F_+ON_",0)"))
"RTN","PSJORRE1",29,0)
 S ND6=$P($G(@(F_+ON_",6)")),"^")
"RTN","PSJORRE1",30,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,ON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRE1",31,0)
 S STAT=$$CODES^PSIVUTL($P(ND0,U,9),$S(ON["P":53.1,1:55.06),28)
"RTN","PSJORRE1",32,0)
 S NDOI=$G(@(F_+ON_",.2)")),DO=$P(NDOI,U,2)
"RTN","PSJORRE1",33,0)
 S DN(1)=$$OIDF^PSJLMUT1(NDOI) I DN(1)=""  K DN D DRGDISP^PSJLMUT1(DFN,ON,40,0,.DN,1)
"RTN","PSJORRE1",34,0)
 S UNITS="" I '$O(@(F_+ON_",1,1)")) S UNITS=$P($G(@(F_+ON_",1,1,0)")),U,2) S:(ON["U")&(UNITS="") UNITS=1
"RTN","PSJORRE1",35,0)
 S MR=$$MR(+$P(ND0,U,3)),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRE1",36,0)
 S NOTGIVEN=$S(ON["U":$P($G(^PS(55,DFN,5,+ON,0)),"^",22),1:"")
"RTN","PSJORRE1",37,0)
 S ^TMP("PS",$J,0)=DN(1)_"^^"_$P(ND2,U,4)_"^^"_$P(ND2,U,2)_U_STAT_"^^^"_DO_U_UNITS_U_$P(ND0,U,21)_U_U_NOTGIVEN_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_U_$G(RNWDT)
"RTN","PSJORRE1",38,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",2)
"RTN","PSJORRE1",39,0)
 I PROVIDER S ^TMP("PS",$J,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRE1",40,0)
 S ^TMP("PS",$J,"MDR",0)=MR]"" S:MR]"" ^TMP("PS",$J,"MDR",1,0)=MR
"RTN","PSJORRE1",41,0)
 S ^TMP("PS",$J,"SCH",0)=$P(ND2,U)]"" S:$P(ND2,U)]"" ^TMP("PS",$J,"SCH",1,0)=$P(ND2,U)
"RTN","PSJORRE1",42,0)
 S:$P(ND0,U,7)]"" ^TMP("PS",$J,"SCH",0)=1,$P(^TMP("PS",$J,"SCH",1,0),U,2)=$$GTSCHT($P(ND0,U,7))_"^"_$P(ND0,U,7)
"RTN","PSJORRE1",43,0)
 S ^TMP("PS",$J,"SIG",0)=INST]"" S:INST]"" ^TMP("PS",$J,"SIG",1,0)=INST
"RTN","PSJORRE1",44,0)
 S ^TMP("PS",$J,"ADM",0)=$P(ND2,U,5)]"" S:$P(ND2,U,5)]"" ^TMP("PS",$J,"ADM",1,0)=$P(ND2,U,5)
"RTN","PSJORRE1",45,0)
 S ^TMP("PS",$J,"SIO",0)=ND6]"" S:ND6]"" ^TMP("PS",$J,"SIO",1,0)=ND6
"RTN","PSJORRE1",46,0)
 NEW VERPHARM S:ON["U" VERPHARM=$P($G(@(F_+ON_",4)")),U,3)
"RTN","PSJORRE1",47,0)
 S:+$G(VERPHARM) $P(^TMP("PS",$J,"RXN",0),U,5)=VERPHARM
"RTN","PSJORRE1",48,0)
 NEW PSJDD,INACTDT,NDDD,OUTOI,PSJOUT S CNT=0
"RTN","PSJORRE1",49,0)
 F PSJDD=0:0 S PSJDD=$O(@(F_+ON_",1,PSJDD)")) Q:'PSJDD  D
"RTN","PSJORRE1",50,0)
 . S NDDD=@(F_+ON_",1,PSJDD,0)")
"RTN","PSJORRE1",51,0)
 . I $P(NDDD,U,3)]"",($P(NDDD,U,3)'>DT) Q
"RTN","PSJORRE1",52,0)
 . S PSJOUT=$P($G(^PSDRUG(+NDDD,8)),U,5)
"RTN","PSJORRE1",53,0)
 . I +PSJOUT D
"RTN","PSJORRE1",54,0)
 .. S INACTDT=$G(^PSDRUG(+PSJOUT,"I")),OUTOI=+$G(^PSDRUG(+PSJOUT,2))
"RTN","PSJORRE1",55,0)
 .. I INACTDT]"",(INACTDT'>DT) S (PSJOUT,OUTOI)=""
"RTN","PSJORRE1",56,0)
 . I '+PSJOUT,($P($G(^PSDRUG(+NDDD,2)),U,3)["O") D
"RTN","PSJORRE1",57,0)
 .. S PSJOUT=+NDDD,OUTOI=+NDOI
"RTN","PSJORRE1",58,0)
 .. S INACTDT=$G(^PSDRUG(+NDDD,"I"))
"RTN","PSJORRE1",59,0)
 .. I INACTDT]"",(INACTDT'>DT) S (PSJOUT,OUTOI)=""
"RTN","PSJORRE1",60,0)
 . S UNITS=$P(NDDD,U,2) S:(ON["U")&(UNITS="") UNITS=1
"RTN","PSJORRE1",61,0)
 . S CNT=CNT+1,^TMP("PS",$J,"DD",CNT,0)=+NDDD_U_UNITS_U_PSJOUT_U_$G(OUTOI)
"RTN","PSJORRE1",62,0)
 S ^TMP("PS",$J,"DD",0)=CNT
"RTN","PSJORRE1",63,0)
 Q
"RTN","PSJORRE1",64,0)
 ;
"RTN","PSJORRE1",65,0)
IVTMP ;*** Set ^TMP for IV orders.
"RTN","PSJORRE1",66,0)
 N PROVIDER,RNWDT,IVLIM S ND0=$G(@(F_+ON_",0)")),CNT=0
"RTN","PSJORRE1",67,0)
 F X=0:0 S X=$O(@(F_+ON_",""AD"","_X_")")) Q:'X  S ND=$G(@(F_+ON_",""AD"","_X_",0)")),DN=$P($G(^PS(52.6,+ND,0)),U),Y=DN_U_$P(ND,U,2) S:$P(ND,U,3) Y=Y_U_$P(ND,U,3) S CNT=CNT+1,^TMP("PS",$J,"A",CNT,0)=Y
"RTN","PSJORRE1",68,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,ON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRE1",69,0)
 S ^TMP("PS",$J,"A",0)=CNT,CNT=0
"RTN","PSJORRE1",70,0)
 F X=0:0 S X=$O(@(F_+ON_",""SOL"","_X_")")) Q:'X  S ND=$G(@(F_+ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0)),CNT=CNT+1,^TMP("PS",$J,"B",CNT,0)=$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)
"RTN","PSJORRE1",71,0)
 S ^TMP("PS",$J,"B",0)=CNT
"RTN","PSJORRE1",72,0)
 S INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRE1",73,0)
 I ON["P" D
"RTN","PSJORRE1",74,0)
 . S SCH=$P($G(^PS(53.1,+ON,2)),U)
"RTN","PSJORRE1",75,0)
 . S PROVIDER=$P(ND0,U,2)
"RTN","PSJORRE1",76,0)
 . S MR=$$MR(+$P(ND0,U,3)),STAT=$$CODES^PSIVUTL($P(ND0,U,9),53.1,28)
"RTN","PSJORRE1",77,0)
 . S INFUS=$P($G(^PS(53.1,+ON,8)),U,5)
"RTN","PSJORRE1",78,0)
 . S ND2=$G(@(F_+ON_",2)")),START=$P(ND2,U,2),STOP=$P(ND2,U,4)
"RTN","PSJORRE1",79,0)
 . S ADM=$P(ND2,U,5),SIO=$P($G(@(F_+ON_",6)")),"^")
"RTN","PSJORRE1",80,0)
 . S ND2P5=$G(@(F_+ON_",2.5)")) S IVLIM=$P(ND2P5,U,4) I $E(IVLIM)="a" S IVLIM="doses"_$P(IVLIM,"a",2)
"RTN","PSJORRE1",81,0)
 . I IVLIM="" S IVLIM=$P(ND2P5,U,2) S:(IVLIM'["d")&(IVLIM'["h") IVLIM=""
"RTN","PSJORRE1",82,0)
 I ON'["P"  D
"RTN","PSJORRE1",83,0)
 . S PROVIDER=$P(ND0,U,6)
"RTN","PSJORRE1",84,0)
 . S SCH=$P(ND0,U,9),INFUS=$P(ND0,U,8),STAT=$$CODES^PSIVUTL($P(ND0,U,17),55.01,100)
"RTN","PSJORRE1",85,0)
 . S MR=$$MR(+$P($G(^PS(55,DFN,"IV",+ON,.2)),U,3))
"RTN","PSJORRE1",86,0)
 . S START=$P(ND0,U,2),STOP=$P(ND0,U,3)
"RTN","PSJORRE1",87,0)
 . S ADM=$P(ND0,U,11),SIO=$P($G(@(F_+ON_",3)")),"^")
"RTN","PSJORRE1",88,0)
 . NEW VERPHARM S VERPHARM=$P($G(^PS(55,DFN,"IV",+ON,4)),U,4)
"RTN","PSJORRE1",89,0)
 . S:+VERPHARM $P(^TMP("PS",$J,"RXN",0),U,5)=VERPHARM
"RTN","PSJORRE1",90,0)
 . S ND2P5=$G(@(F_+ON_",2.5)")) S IVLIM=$P(ND2P5,U,4) I IVLIM="" S IVLIM=$P(ND2P5,U,2) S:(IVLIM'["d")&(IVLIM'["h") IVLIM=""
"RTN","PSJORRE1",91,0)
 S DN=$G(@(F_+ON_",.2)")),DO=$P(DN,U,2)
"RTN","PSJORRE1",92,0)
 S DN=$S(+$P(DN,U):$$OIDF^PSJLMUT1($P(DN,U)),1:"")
"RTN","PSJORRE1",93,0)
 S ^TMP("PS",$J,0)=DN_U_INFUS_U_STOP_"^^"_START_U_STAT_"^^^"_DO_"^^"_$P(ND0,U,21)_U_U_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_U_$G(RNWDT)
"RTN","PSJORRE1",94,0)
 I PROVIDER S ^TMP("PS",$J,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRE1",95,0)
 S ^TMP("PS",$J,"MDR",0)=MR]"" S:MR]"" ^TMP("PS",$J,"MDR",1,0)=MR
"RTN","PSJORRE1",96,0)
 S ^TMP("PS",$J,"SCH",0)=SCH]"" S:SCH]"" ^TMP("PS",$J,"SCH",1,0)=SCH
"RTN","PSJORRE1",97,0)
 I ON["P" S:$P(ND0,U,7)]"" ^TMP("PS",$J,"SCH",0)=1,$P(^TMP("PS",$J,"SCH",1,0),U,2)=$$GTSCHT($P(ND0,U,7))_"^"_$P(ND0,U,7)
"RTN","PSJORRE1",98,0)
 S ^TMP("PS",$J,"SIG",0)=INST]"" S:INST]"" ^TMP("PS",$J,"SIG",1,0)=INST
"RTN","PSJORRE1",99,0)
 S ^TMP("PS",$J,"ADM",0)=ADM]"" S:ADM]"" ^TMP("PS",$J,"ADM",1,0)=ADM
"RTN","PSJORRE1",100,0)
 S ^TMP("PS",$J,"SIO",0)=SIO]"" S:SIO]"" ^TMP("PS",$J,"SIO",1,0)=SIO
"RTN","PSJORRE1",101,0)
 I $G(IVLIM)]"" S ^TMP("PS",$J,"IVLIM",0)=$G(IVLIM)
"RTN","PSJORRE1",102,0)
 Q
"RTN","PSJORRE1",103,0)
 ;
"RTN","PSJORRE1",104,0)
MR(X) ;RETURN MED ROUTE ABBR. IF THE ABBR="" RETURN MED ROUTE'S NAME.
"RTN","PSJORRE1",105,0)
 S X=$G(^PS(51.2,X,0))
"RTN","PSJORRE1",106,0)
 Q $S($P(X,U,3)]"":$P(X,U,3),1:$P(X,U))
"RTN","PSJORRE1",107,0)
 ;
"RTN","PSJORRE1",108,0)
GTSTAT(X) ;
"RTN","PSJORRE1",109,0)
 Q $S(X="A":"ACTIVE",X="D":"DISCONTINUED",X="I":"INCOMPLETE",X="N":"NON-VERFIED",X="U":"UNRELEASED",X="P":"PENDING",X="DE":"DISCONTINUED (EDIT)",X="O":"ON CALL",1:"NOT FOUND")
"RTN","PSJORRE1",110,0)
 ;
"RTN","PSJORRE1",111,0)
VA200(X) ;Return the IEN for the user.
"RTN","PSJORRE1",112,0)
 ; X = User name
"RTN","PSJORRE1",113,0)
 NEW DIC,Y S DIC="^VA(200,",DIC(0)="NZ" D ^DIC
"RTN","PSJORRE1",114,0)
 I +Y=-1 Q ""
"RTN","PSJORRE1",115,0)
 Q $P(Y,U)
"RTN","PSJORRE1",116,0)
GTSCHT(X)       ;
"RTN","PSJORRE1",117,0)
 Q $S(X="C":"CONTINUOUS",X="O":"ONE TIME",X="P":"PRN",X="R":"FILL ON REQUEST",X="OC":"ON CALL",1:"NOT FOUND")
"RTN","PSJORREN")
0^31^B20851674
"RTN","PSJORREN",1,0)
PSJORREN ;BIR/MV-RENEWAL FLAG ;6 DEC 00 / 3:11 PM 
"RTN","PSJORREN",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**50,70,58,89,91,110,127,134**;16 DEC 97;Build 124
"RTN","PSJORREN",3,0)
 ;
"RTN","PSJORREN",4,0)
 ; Reference to ^PS(50.7 supported by DBIA #2180
"RTN","PSJORREN",5,0)
 ; References to ^PS(52.6 supported by DBIA #1231
"RTN","PSJORREN",6,0)
 ; References to ^PS(52.7 supported by DBIA #2173
"RTN","PSJORREN",7,0)
 ; References to ^PS(55 supported by DBIA #2191
"RTN","PSJORREN",8,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192
"RTN","PSJORREN",9,0)
 ;
"RTN","PSJORREN",10,0)
ACTIVE(DFN,ON) ;
"RTN","PSJORREN",11,0)
 ;DFN: Patient IEN
"RTN","PSJORREN",12,0)
 ;ON : Order number_"U/V/P"
"RTN","PSJORREN",13,0)
 ;Output: 0^reason not renewable (Can't renew)
"RTN","PSJORREN",14,0)
 ;        2^New OI (Need to create a new order as in edit)
"RTN","PSJORREN",15,0)
 ;          note: with PSJ*5*70 - instead of 2, IV order will return 0
"RTN","PSJORREN",16,0)
 ;        1 (OK to renew)
"RTN","PSJORREN",17,0)
 NEW PSJRT,PSJEXP
"RTN","PSJORREN",18,0)
 I '$D(^PS(53.1,+ON))&'$D(^PS(55,+DFN,5,+ON,0))&'$D(^PS(55,+DFN,"IV",+ON,0)) S PSJRT="0^Invalid Package Reference" Q $G(PSJRT)
"RTN","PSJORREN",19,0)
 D:ON["U" UD
"RTN","PSJORREN",20,0)
 D:ON["V" IV
"RTN","PSJORREN",21,0)
 I (+$G(PSJRT)=1) S PSJEXP=$$EXPIRED^PSGOER(DFN,ON) I PSJEXP S PSJRT="0^Expired Time Limit Exceeded"
"RTN","PSJORREN",22,0)
 Q $G(PSJRT)
"RTN","PSJORREN",23,0)
UD ;
"RTN","PSJORREN",24,0)
 ;If both PSJRT(2) & (3) existed it meant order has multiple DDs and one
"RTN","PSJORREN",25,0)
 ;is tied to a different OI. It's best to not allow renewal of the order.
"RTN","PSJORREN",26,0)
 ;
"RTN","PSJORREN",27,0)
 NEW PSJDD,PSJDDOI,PSJDDX,PSJACT,PSJOI,PSJOIACT,PSJUSE,PSJPRI,X,ND2
"RTN","PSJORREN",28,0)
 K PSJRT
"RTN","PSJORREN",29,0)
 S PSJOI=+^PS(55,DFN,5,+ON,.2)
"RTN","PSJORREN",30,0)
 S PSJPRI=$P(^PS(55,DFN,5,+ON,.2),"^",4)
"RTN","PSJORREN",31,0)
 I PSJPRI="D" S PSJRT="0^Orders with a Done priority may not be renewed" Q
"RTN","PSJORREN",32,0)
 S ND0=$G(^PS(55,DFN,5,+ON,0)) I $P(ND0,"^",7)="O" S PSJRT="0^One Time orders may not be renewed" Q
"RTN","PSJORREN",33,0)
 N PSJCANT,PSJDAD,NDP2,PSJORKID,PSJKID S NDP2=$G(^PS(55,DFN,5,+ON,.2)),PSJDAD=$P(NDP2,"^",8) I PSJDAD D
"RTN","PSJORREN",34,0)
 .S PSJORKID="" F  S PSJORKID=$O(^PS(55,"ACX",PSJDAD,PSJORKID)) Q:'PSJORKID!$G(PSJCANT)  S PSJKID="" F  S PSJKID=$O(^PS(55,"ACX",PSJDAD,PSJORKID,PSJKID)) Q:'PSJKID!$G(PSJCANT)  D
"RTN","PSJORREN",35,0)
 ..S ND0=$G(^PS(55,DFN,5,+PSJKID,2)) I $P(ND0,"^",7)="O" S PSJRT="0^Complex Orders with One-Time doses may not be renewed",PSJCANT=1
"RTN","PSJORREN",36,0)
 Q:$G(PSJCANT)
"RTN","PSJORREN",37,0)
 F PSJDD=0:0 S PSJDD=$O(^PS(55,DFN,5,+ON,1,PSJDD)) Q:('PSJDD!$D(PSJRT(1)))  D
"RTN","PSJORREN",38,0)
 . S (PSJACT,PSJOIACT)=0 S PSJDDX=^PS(55,DFN,5,+ON,1,PSJDD,0)
"RTN","PSJORREN",39,0)
 . S X=$P(PSJDDX,U,3) I X]"",(X'>DT) S PSJACT=1
"RTN","PSJORREN",40,0)
 . S X=$G(^PSDRUG(+PSJDDX,"I")) I X]"",(X'>DT) S PSJACT=1
"RTN","PSJORREN",41,0)
 . S X=$G(^PSDRUG(+PSJDDX,2)),PSJUSE=$P(X,U,3)["U",PSJDDOI=+X I '+PSJDDOI S PSJRT(3)="0^Dispense drug is not matched to an Orderable Item" Q
"RTN","PSJORREN",42,0)
 . S X=$P($G(^PS(50.7,+PSJDDOI,0)),U,4) I X]"",(X'>DT) S PSJOIACT=1
"RTN","PSJORREN",43,0)
 . I 'PSJACT,PSJUSE D  Q
"RTN","PSJORREN",44,0)
 .. I PSJOI=PSJDDOI D  Q
"RTN","PSJORREN",45,0)
 ... I 'PSJOIACT S PSJRT(1)=1 Q
"RTN","PSJORREN",46,0)
 ... S:PSJOIACT PSJRT(3)="0^Inactive Orderable Item"
"RTN","PSJORREN",47,0)
 .. I +PSJDDOI,(PSJOI'=PSJDDOI) D
"RTN","PSJORREN",48,0)
 ... S:'PSJOIACT PSJRT(2)="2"_U_PSJDDOI
"RTN","PSJORREN",49,0)
 ... S:PSJOIACT PSJRT(3)="0^Dispense drug ties to an inactive Orderable Item"
"RTN","PSJORREN",50,0)
 . I PSJACT S PSJRT(3)="0^This drug has been Inactivated"
"RTN","PSJORREN",51,0)
 . I 'PSJUSE S PSJRT(3)="0^Drug is No longer used in Inpatient Meds"
"RTN","PSJORREN",52,0)
 I $D(PSJRT(1)) S PSJRT=1 Q
"RTN","PSJORREN",53,0)
 I $D(PSJRT(2)),$D(PSJRT(3)) S PSJRT=PSJRT(3) Q
"RTN","PSJORREN",54,0)
 I '$D(PSJRT) S PSJRT="0^Order has no Dispense drug" Q
"RTN","PSJORREN",55,0)
 S X=$O(PSJRT(0)),PSJRT=$G(PSJRT(X))
"RTN","PSJORREN",56,0)
 Q
"RTN","PSJORREN",57,0)
IV ;
"RTN","PSJORREN",58,0)
 NEW FIL,PSJACT,PSJAS,PSJASNO,PSJASOI,PSJCNT,PSJIEN,PSJOI,PSJOIACT,PSJPRI,X
"RTN","PSJORREN",59,0)
 K PSJRT
"RTN","PSJORREN",60,0)
 S PSJCNT=0
"RTN","PSJORREN",61,0)
 S PSJOI=+$G(^PS(55,DFN,"IV",+ON,.2))
"RTN","PSJORREN",62,0)
 S PSJPRI=$P(^PS(55,DFN,"IV",+ON,.2),"^",4)
"RTN","PSJORREN",63,0)
 I PSJPRI="D" S PSJRT="0^Orders with a Done priority may not be renewed" Q
"RTN","PSJORREN",64,0)
 N ND2,PSBACT,IVSCHED
"RTN","PSJORREN",65,0)
 S ND0=$G(^PS(55,DFN,"IV",+ON,0)) I ($P(ND0,"^",4)="P")!($P(ND0,"^",23)="P")!$P(ND0,"^",5) D  Q:$G(PSJRT)]""
"RTN","PSJORREN",66,0)
 .N X,PSGOES,ZZND S PSGOES=2,X=$P(ND0,"^",9) D ENOS^PSGS0 Q:($G(X)="")!($P($G(ZZND),"^",5)'="O")
"RTN","PSJORREN",67,0)
 .S PSJRT="0^This One-Time order may not be renewed"
"RTN","PSJORREN",68,0)
 F FIL="AD","SOL"  F PSJAS=0:0 S PSJAS=$O(^PS(55,DFN,"IV",+ON,FIL,PSJAS)) Q:'PSJAS  D
"RTN","PSJORREN",69,0)
 . S (PSJACT,PSJOIACT)=0
"RTN","PSJORREN",70,0)
 . S PSJASNO=$S(FIL="AD":52.6,1:52.7)
"RTN","PSJORREN",71,0)
 . S PSJIEN=+^PS(55,DFN,"IV",+ON,FIL,PSJAS,0)
"RTN","PSJORREN",72,0)
 . S X=$G(^PS(PSJASNO,+PSJIEN,"I")) I X]"",(X'>DT) S PSJACT=1
"RTN","PSJORREN",73,0)
 . S PSJASOI=$P(^PS(PSJASNO,PSJIEN,0),U,11)
"RTN","PSJORREN",74,0)
 . S X=$P($G(^PS(50.7,+PSJASOI,0)),U,4) I X]"",(X'>DT) S PSJOIACT=1
"RTN","PSJORREN",75,0)
 . I PSJACT S PSJCNT=PSJCNT+1,PSJRT(3)="0^Inactive "_$S(FIL="AD":"Additive",1:"Solution") Q
"RTN","PSJORREN",76,0)
 . I PSJOI=PSJASOI D  Q
"RTN","PSJORREN",77,0)
 .. I 'PSJOIACT S PSJRT(1)="" Q
"RTN","PSJORREN",78,0)
 .. I PSJOIACT S PSJRT(3)="0^Inactive Orderable Item"
"RTN","PSJORREN",79,0)
 . I PSJOI'=PSJASOI D
"RTN","PSJORREN",80,0)
 .. I 'PSJOIACT S PSJCNT=PSJCNT+1,PSJRT(2)=2_U_PSJASOI
"RTN","PSJORREN",81,0)
 .. I PSJOIACT S PSJRT(3)="0^Inactive Orderable Item"
"RTN","PSJORREN",82,0)
 I $D(PSJRT(1)) S PSJRT=1 Q
"RTN","PSJORREN",83,0)
 I $D(PSJRT(3)) S PSJRT=PSJRT(3) Q
"RTN","PSJORREN",84,0)
 I $D(PSJRT(2)),PSJCNT=1 S PSJRT="0^New Orderable Item" Q
"RTN","PSJORREN",85,0)
 S PSJRT="0^Inactive drug"
"RTN","PSJORREN",86,0)
 Q
"RTN","PSJORRN")
0^2^B60756345
"RTN","PSJORRN",1,0)
PSJORRN ;BIR/MV-RETURN INPATIENT ACTIVE MEDS (CONDENSED) NEW SORT ;28 Jan 99 / 12:56 PM
"RTN","PSJORRN",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**134**;16 DEC 97;Build 124
"RTN","PSJORRN",3,0)
 ;
"RTN","PSJORRN",4,0)
 ;Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJORRN",5,0)
 ;Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJORRN",6,0)
 ;Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJORRN",7,0)
 ;Reference to ^PS(50.7 is supported by DBIA #2180.
"RTN","PSJORRN",8,0)
 ;Reference to ^TMP("PS" is documented in DBIA #2383.
"RTN","PSJORRN",9,0)
 ;
"RTN","PSJORRN",10,0)
OCL(DFN,BDT,EDT,TFN) ; return condensed list of inpat meds
"RTN","PSJORRN",11,0)
 ; MVIEW=2   -  This is the new sort with GUI 27
"RTN","PSJORRN",12,0)
 ; Execute this section if MVIEW=2
"RTN","PSJORRN",13,0)
 N ADM,CNT,DN,DO,F,FON,INFUS,INST,MR,ND,ND0,ND2,ND6,ON,PON,PST,SCH,SIO,STAT,TYPE,UNITS,WBDT,X,Y,PSJCLIN,A,TFN2
"RTN","PSJORRN",14,0)
 S TFN2=0
"RTN","PSJORRN",15,0)
 ; PON=placer order number (oerr), FON=filler order number
"RTN","PSJORRN",16,0)
 S:BDT="" BDT=DT S WBDT=BDT_".000001"
"RTN","PSJORRN",17,0)
 S:EDT="" EDT=9999999
"RTN","PSJORRN",18,0)
 S:EDT'["." EDT=EDT_".999999"
"RTN","PSJORRN",19,0)
 S F="^PS(55,DFN,5," F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  D UDTMP
"RTN","PSJORRN",20,0)
 S F="^PS(53.1," F PST="P","N" S ON=0 F  S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  S X=$P($G(^PS(53.1,+ON,0)),U,4) D @$S(X="U":"UDTMP",1:"IVTMP")
"RTN","PSJORRN",21,0)
 S F="^PS(55,"_DFN_",""IV"",",WBDT=BDT-1 F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  S ON=0 F  S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  D IVTMP
"RTN","PSJORRN",22,0)
 S X1="" F  S X1=$O(^TMP("PSJTMP",$J,X1)) Q:X1=""  S X2="" F  S X2=$O(^TMP("PSJTMP",$J,X1,X2)) Q:X2=""  D
"RTN","PSJORRN",23,0)
 .S X3="" F  S X3=$O(^TMP("PSJTMP",$J,X1,X2,X3)) Q:X3=""  S X4="" F  S X4=$O(^TMP("PSJTMP",$J,X1,X2,X3,X4)) Q:X4=""  D
"RTN","PSJORRN",24,0)
 ..S X5="" F  S X5=$O(^TMP("PSJTMP",$J,X1,X2,X3,X4,X5)) Q:X5=""  S TFN=$G(TFN)+1 D
"RTN","PSJORRN",25,0)
 ...; The merge below sends the proper ^TMP("PS",$J structure back to the calling
"RTN","PSJORRN",26,0)
 ...; routine PSJORRE
"RTN","PSJORRN",27,0)
 ...M ^TMP("PS",$J,TFN)=^TMP("PSJTMP",$J,X1,X2,X3,X4,X5) S ^TMP("PS",$J,"PC",0)=TFN
"RTN","PSJORRN",28,0)
 K ^TMP("PSJTMP",$J)
"RTN","PSJORRN",29,0)
 Q
"RTN","PSJORRN",30,0)
 ;
"RTN","PSJORRN",31,0)
UDTMP ;*** Set ^TMP for Unit dose orders.
"RTN","PSJORRN",32,0)
 N PROVIDER,ND8,RNWDT,EDTCMPLX,NDP2,PSJOINM,PSJOI,PSJDDNM,LOC,PRIO,NDDSS
"RTN","PSJORRN",33,0)
 S (MR,SCH,INST,PON,NDDSS)="",FON=+ON_$S(F["53.1":"P",1:"U")
"RTN","PSJORRN",34,0)
 D TYPE
"RTN","PSJORRN",35,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRN",36,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8),PRIO=$P(NDP2,"^",4)
"RTN","PSJORRN",37,0)
 S ND2=$G(@(F_ON_",2)")) I 'EDTCMPLX I F'["53.1",($P(ND2,U,2)>EDT) Q
"RTN","PSJORRN",38,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F["53.1",($P(ND0,U,16)>EDT) Q
"RTN","PSJORRN",39,0)
 S ND8=$G(@(F_ON_",8)")),NDP2=$P($G(@(F_ON_",.2)")),"^")
"RTN","PSJORRN",40,0)
 S STAT=$$CODES^PSIVUTL($P(ND0,U,9),$S(FON["P":53.1,1:55.06),28)
"RTN","PSJORRN",41,0)
 S ND6=$P($G(@(F_ON_",6)")),"^"),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRN",42,0)
 S FON=+ON_$S(F["53.1":"P",1:"U"),DO=$P($G(@(F_ON_",.2)")),"^",2)
"RTN","PSJORRN",43,0)
 D DRGDISP^PSJLMUT1(DFN,FON,40,0,.DN,1)
"RTN","PSJORRN",44,0)
 S UNITS="" I '$O(@(F_+ON_",1,1)")) S UNITS=$P($G(@(F_+ON_",1,1,0)")),U,2) S:(FON["U")&(UNITS="") UNITS=1
"RTN","PSJORRN",45,0)
 S:+$P(ND0,U,3) MR=$$MR^PSJORRE1(+$P(ND0,U,3))
"RTN","PSJORRN",46,0)
 N NOTGIVEN S NOTGIVEN=$S(FON["U":$P($G(^PS(55,DFN,5,+ON,0)),"^",22),1:"")
"RTN","PSJORRN",47,0)
 ;******** GUI 27 new sort for Meds Tab
"RTN","PSJORRN",48,0)
 I F[53.1 S NDDSS=$G(@(F_ON_",""DSS"")")),LOC=$P(NDDSS,"^")
"RTN","PSJORRN",49,0)
 S:F'[53.1 LOC=$P(ND8,"^") S LOC=$S($P($G(NDDSS),"^",2):LOC,1:"~") I LOC S LOC=$P($G(^SC(LOC,0)),"^")
"RTN","PSJORRN",50,0)
 S PSJST=$P(ND0,"^",9)
"RTN","PSJORRN",51,0)
 S GP=$S((",A,R,H,RE,")[(","_PSJST_","):1,(",P,N,")[(","_PSJST_","):2,PSJST="E":3,(",D,DE,DR,")[(","_PSJST_","):4,1:0)
"RTN","PSJORRN",52,0)
 S PSJST2=$S(PSJST="A":1,PSJST="R":2,PSJST="H":3,PSJST="S":4,PSJST="P":5,PSJST="O":6,PSJST="N":7,PSJST="I":8,PSJST="P":9,GP=4&($G(PRIO)="D"):10,PSJST="E":11,PSJST="D":12,PSJST="DE":13,PSJST="RE":14,PSJST="R":15,1:0)
"RTN","PSJORRN",53,0)
 S PSJOI=$P(NDP2,"^"),PSJOINM=$P($G(^PS(50.7,+PSJOI,0)),"^")
"RTN","PSJORRN",54,0)
 ;*******
"RTN","PSJORRN",55,0)
 S TFN2=$G(TFN2)+1
"RTN","PSJORRN",56,0)
 S CNT=0,PSJOINM=$S(PSJOINM]"":PSJOINM,1:"UNKNOWN")
"RTN","PSJORRN",57,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,0)=FON_";I"_U_DN(1)_"^^"_$P(ND2,U,4)_"^^"_DO_U_UNITS_U_$P(ND0,U,21)_U_STAT_U_U_U_U_NOTGIVEN_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_$P(ND2,U,2)_U_$G(RNWDT)
"RTN","PSJORRN",58,0)
 K ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"CLINIC",0) I PSJCLIN]"" S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"CLINIC",0)=PSJCLIN
"RTN","PSJORRN",59,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",2)
"RTN","PSJORRN",60,0)
 I PROVIDER S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRN",61,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"MDR",0)=MR]"" S:MR]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"MDR",1,0)=MR
"RTN","PSJORRN",62,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SCH",0)=$P(ND2,U)]"" S:$P(ND2,U)]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SCH",1,0)=$P(ND2,U)
"RTN","PSJORRN",63,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SIG",0)=INST]"" S:INST]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SIG",1,0)=INST
"RTN","PSJORRN",64,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"ADM",0)=$P(ND2,U,5)]"" S:$P(ND2,U,5)]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"ADM",1,0)=$P(ND2,U,5)
"RTN","PSJORRN",65,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SIO",0)=ND6]"" S:ND6]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SIO",1,0)=ND6
"RTN","PSJORRN",66,0)
 Q
"RTN","PSJORRN",67,0)
 ;
"RTN","PSJORRN",68,0)
IVTMP ;*** Set ^TMP for IV orders.
"RTN","PSJORRN",69,0)
 N PROVIDER,START,STOP,EDTCMPLX,NDP2,IVLIM,PRIO,LOC,NDDSS
"RTN","PSJORRN",70,0)
 S (PROVIDER,START,STOP,EDTCMPLX,NDP2,IVLIM,PRIO,LOC,NDDSS)=""
"RTN","PSJORRN",71,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8),PRIO=$P(NDP2,"^",4)
"RTN","PSJORRN",72,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F'["53.1",($P(ND0,U,2)>EDT) Q
"RTN","PSJORRN",73,0)
 D TYPE
"RTN","PSJORRN",74,0)
 S FON=+ON_$S(F["53.1":"P",1:"V"),TFN2=TFN2+1,CNT=0
"RTN","PSJORRN",75,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRN",76,0)
 ;******** GUI 27 new sort for Meds Tab
"RTN","PSJORRN",77,0)
 S NDDSS=$G(@(F_ON_",""DSS"")")),NDP2=$G(@(F_ON_",.2)"))
"RTN","PSJORRN",78,0)
 S PSJOI=$P(NDP2,"^")
"RTN","PSJORRN",79,0)
 I F[53.1 S PSJST=$P(ND0,"^",9)
"RTN","PSJORRN",80,0)
 I F'[53.1 S PSJST=$P(ND0,"^",17)
"RTN","PSJORRN",81,0)
 S GP=$S((",A,R,H,RE,")[(","_PSJST_","):1,(",P,N,")[(","_PSJST_","):2,PSJST="E":3,(",D,DE,DR,")[(","_PSJST_","):4,1:0)
"RTN","PSJORRN",82,0)
 S PSJST2=$S(PSJST="A":1,PSJST="R":2,PSJST="H":3,PSJST="S":4,PSJST="P":5,PSJST="O":6,PSJST="N":7,PSJST="I":8,PSJST="P":9,GP=4&($G(PRIO)="D"):10,PSJST="E":11,PSJST="D":12,PSJST="DE":13,PSJST="RE":14,PSJST="R":15,1:0)
"RTN","PSJORRN",83,0)
 S LOC=$P(NDDSS,"^") S LOC=$S($P(NDDSS,"^",2):LOC,1:"~") I LOC S LOC=$P($G(^SC(LOC,0)),"^")
"RTN","PSJORRN",84,0)
 S PSJOINM=$P(^PS(50.7,+PSJOI,0),"^")
"RTN","PSJORRN",85,0)
 ;********
"RTN","PSJORRN",86,0)
 S CNT=0,PSJOINM=$S(PSJOINM]"":PSJOINM,1:"UNKNOWN")
"RTN","PSJORRN",87,0)
 F X=0:0 S X=$O(@(F_ON_",""AD"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""AD"","_X_",0)")),DN=$P($G(^PS(52.6,+ND,0)),U),Y=DN_U_$P(ND,U,2) S:$P(ND,U,3) Y=Y_U_$P(ND,U,3) S CNT=CNT+1,^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"A",CNT,0)=Y
"RTN","PSJORRN",88,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"A",0)=CNT,CNT=0
"RTN","PSJORRN",89,0)
 F X=0:0 S X=$O(@(F_ON_",""SOL"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0)),CNT=CNT+1,^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"B",CNT,0)=$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)
"RTN","PSJORRN",90,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"B",0)=CNT
"RTN","PSJORRN",91,0)
 S TYPE=$P(ND0,U,4),(MR,SCH,INST,INFUS)=""
"RTN","PSJORRN",92,0)
 I FON["P" S ND2=$G(^PS(53.1,+ON,2)),SCH=$P(ND2,U),START=$P(ND2,U,2),STOP=$P(ND2,U,4),MR=$P(ND0,U,3),INFUS=$P($G(^PS(53.1,+ON,8)),U,5),STAT=$$CODES^PSIVUTL($P(ND0,U,9),53.1,28),ADM=$P(ND2,U,5),SIO=$P($G(@(F_+ON_",6)")),"^")
"RTN","PSJORRN",93,0)
 I FON'["P" S START=$P(ND0,U,2),STOP=$P(ND0,U,3),SCH=$P(ND0,U,9),INFUS=$P(ND0,U,8),MR=$P($G(^PS(55,DFN,"IV",+ON,.2)),U,3),STAT=$$CODES^PSIVUTL($P(ND0,U,17),55.01,100),ADM=$P(ND0,U,11),SIO=$P($G(@(F_+ON_",3)")),"^")
"RTN","PSJORRN",94,0)
 S DN=$G(@(F_+ON_",.2)")),DO=$P(DN,U,2)
"RTN","PSJORRN",95,0)
 S DN=$S(+$P(DN,U):$$OIDF^PSJLMUT1($P(DN,U)),1:"")
"RTN","PSJORRN",96,0)
 S:MR MR=$$MR^PSJORRE1(+MR),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRN",97,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,0)=FON_";I"_U_DN_U_INFUS_U_STOP_"^^"_DO_"^^"_$P(ND0,"^",21)_U_STAT_U_U_U_U_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_START_U_$G(RNWDT)
"RTN","PSJORRN",98,0)
 K ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"CLINIC",0) I PSJCLIN]"" S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"CLINIC",0)=PSJCLIN
"RTN","PSJORRN",99,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",6)
"RTN","PSJORRN",100,0)
 I PROVIDER S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRN",101,0)
 S ND2P5=$G(@(F_+ON_",2.5)")) S IVLIM=$P(ND2P5,U,4) I $E(IVLIM)="a" S IVLIM="doses"_$P(IVLIM,"a",2)
"RTN","PSJORRN",102,0)
 I IVLIM="" S IVLIM=$P(ND2P5,U,2) S:(IVLIM'["d")&(IVLIM'["h") IVLIM=""
"RTN","PSJORRN",103,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"MDR",0)=MR]"" S:MR]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"MDR",1,0)=MR
"RTN","PSJORRN",104,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SIG",0)=INST]"" S:INST]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SIG",1,0)=INST
"RTN","PSJORRN",105,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SCH",0)=SCH]"" S:SCH]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SCH",1,0)=SCH
"RTN","PSJORRN",106,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"ADM",0)=ADM]"" S:ADM]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"ADM",1,0)=ADM
"RTN","PSJORRN",107,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SIO",0)=SIO]"" S:SIO]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SIO",1,0)=SIO
"RTN","PSJORRN",108,0)
 I $G(IVLIM)]"" S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"IVLIM",0)=IVLIM
"RTN","PSJORRN",109,0)
 Q
"RTN","PSJORRN",110,0)
STAT(Y,X) ;* Return the full status instead of just the code for U/D.
"RTN","PSJORRN",111,0)
 S X=$P($P(";"_$P(Y,U,3),";"_X_":",2),";")
"RTN","PSJORRN",112,0)
 Q X
"RTN","PSJORRN",113,0)
TYPE ;determine if this is an IMO order or not
"RTN","PSJORRN",114,0)
 S (A,PSJCLIN)="" I F["PS(53.1" S A=$G(^PS(53.1,ON,"DSS"))
"RTN","PSJORRN",115,0)
 I F["PS(55" S A=$S(F["IV":$G(^PS(55,DFN,"IV",ON,"DSS")),1:$G(^PS(55,DFN,5,ON,8)))
"RTN","PSJORRN",116,0)
 I $P(A,"^",2)'="" S PSJCLIN=+A
"RTN","PSJORRN",117,0)
 Q
"RTN","PSJORRN1")
0^25^B54888629
"RTN","PSJORRN1",1,0)
PSJORRN1 ;BIR/JCH-RETURN INPATIENT MEDS (CONDENSED) SECOND 'NEW' SORT ;07 Feb 07 / 12:56 PM
"RTN","PSJORRN1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**134**;16 DEC 97;Build 124
"RTN","PSJORRN1",3,0)
 ;
"RTN","PSJORRN1",4,0)
 ;Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJORRN1",5,0)
 ;Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJORRN1",6,0)
 ;Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJORRN1",7,0)
 ;Reference to ^TMP("PS" is documented in DBIA #2383.
"RTN","PSJORRN1",8,0)
 ;Reference to ^SC is documented in DBIA #10040.
"RTN","PSJORRN1",9,0)
 ;Reference to ^PS(50.7 is supported by DBIA #2180.
"RTN","PSJORRN1",10,0)
 ;
"RTN","PSJORRN1",11,0)
 ; return condensed list of inpat meds with Alpha Primary Sort
"RTN","PSJORRN1",12,0)
OCL(DFN,BDT,EDT,TFN) ; Execute this section if MVIEW=1
"RTN","PSJORRN1",13,0)
 N ADM,CNT,DN,DO,F,FON,INFUS,INST,MR,ND,ND0,ND2,ND6,ON,PON,PST,SCH,SIO,STAT,TYPE,UNITS,WBDT,X,Y,PSJCLIN,A,TFN2,PSJOTYP,PSJNOW,PSJ30DAY
"RTN","PSJORRN1",14,0)
 S TFN2=TFN,PSJNOW=$$DATE^PSJUTL2(),PSJ30DAY=$$FMADD^XLFDT(PSJNOW,-30) S $P(PSJ30DAY,".",2)="000001"
"RTN","PSJORRN1",15,0)
 ; PON=placer order number (oerr), FON=filler order number
"RTN","PSJORRN1",16,0)
 S:BDT="" BDT=DT S WBDT=BDT_".000001" S:WBDT<PSJ30DAY WBDT=PSJ30DAY
"RTN","PSJORRN1",17,0)
 S:EDT="" EDT=9999999
"RTN","PSJORRN1",18,0)
 S:EDT'["." EDT=EDT_".999999"
"RTN","PSJORRN1",19,0)
 S F="^PS(55,DFN,5," F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  S PSJOTYP="D" D UDTMP
"RTN","PSJORRN1",20,0)
 S F="^PS(53.1," F PST="P","N" F ON=0:0 S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  S X=$P($G(^PS(53.1,+ON,0)),U,4) S PSJOTYP=$S(PST="P":"P1",1:"P2") D @$S(X="U":"UDTMP",1:"IVTMP")
"RTN","PSJORRN1",21,0)
 S F="^PS(55,"_DFN_",""IV"",",WBDT=BDT-1 F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  S PSJOTYP="V" D IVTMP
"RTN","PSJORRN1",22,0)
 S X1="" F  S X1=$O(^TMP("PSJTMP",$J,X1)) Q:X1=""  S X2="" F  S X2=$O(^TMP("PSJTMP",$J,X1,X2)) Q:X2=""  S X3="" F  S X3=$O(^TMP("PSJTMP",$J,X1,X2,X3)) Q:X3=""  D
"RTN","PSJORRN1",23,0)
 .S X4="" F  S X4=$O(^TMP("PSJTMP",$J,X1,X2,X3,X4)) Q:X4=""  D
"RTN","PSJORRN1",24,0)
 ..; The merge below sends the proper ^TMP("PS",$J structure back to the calling routine PSJORRE
"RTN","PSJORRN1",25,0)
 ..S TFN=$G(TFN)+1 M ^TMP("PS",$J,TFN)=^TMP("PSJTMP",$J,X1,X2,X3,X4) S ^TMP("PS",$J,"PC",0)=TFN
"RTN","PSJORRN1",26,0)
 K ^TMP("PSJTMP",$J)
"RTN","PSJORRN1",27,0)
 Q
"RTN","PSJORRN1",28,0)
 ;
"RTN","PSJORRN1",29,0)
UDTMP ;*** Set ^TMP for Unit dose orders.
"RTN","PSJORRN1",30,0)
 N PROVIDER,RNWDT,EDTCMPLX,NDP2,PSJSTP,PSJLOC,PSJST2,NDDSS
"RTN","PSJORRN1",31,0)
 S (MR,SCH,INST,PON,NDDSS)="",FON=+ON_$S(F["53.1":"P",1:"U")
"RTN","PSJORRN1",32,0)
 I $E($G(PSJOTYP))="P",'$G(WBDT) S WBDT=+ON
"RTN","PSJORRN1",33,0)
 D TYPE S PSJLOC=$S($G(PSJCLIN):$P($G(^SC(+PSJCLIN,0)),"^"),1:"zzz")
"RTN","PSJORRN1",34,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRN1",35,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8)
"RTN","PSJORRN1",36,0)
 S ND2=$G(@(F_ON_",2)")) I 'EDTCMPLX I F'["53.1",($P(ND2,U,2)>EDT) Q
"RTN","PSJORRN1",37,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F["53.1",($P(ND0,U,16)>EDT) Q
"RTN","PSJORRN1",38,0)
 S STAT=$$CODES^PSIVUTL($P(ND0,U,9),$S(FON["P":53.1,1:55.06),28)
"RTN","PSJORRN1",39,0)
 S ND6=$P($G(@(F_ON_",6)")),"^"),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRN1",40,0)
 S ND8=$P($G(@(F_ON_",8)")),"^")
"RTN","PSJORRN1",41,0)
 S FON=+ON_$S(F["53.1":"P",1:"U"),DO=$P($G(@(F_ON_",.2)")),"^",2)
"RTN","PSJORRN1",42,0)
 D DRGDISP^PSJLMUT1(DFN,FON,40,0,.DN,1)
"RTN","PSJORRN1",43,0)
 S UNITS="" I '$O(@(F_+ON_",1,1)")) S UNITS=$P($G(@(F_+ON_",1,1,0)")),U,2) S:(FON["U")&(UNITS="") UNITS=1
"RTN","PSJORRN1",44,0)
 S:+$P(ND0,U,3) MR=$$MR^PSJORRE1(+$P(ND0,U,3))
"RTN","PSJORRN1",45,0)
 N NOTGIVEN S NOTGIVEN=$S(FON["U":$P($G(^PS(55,DFN,5,+ON,0)),"^",22),1:"")
"RTN","PSJORRN1",46,0)
 ;******** GUI 27 New sort format #2 for Meds Tab
"RTN","PSJORRN1",47,0)
 I F[53.1 S NDDSS=$G(@(F_ON_",""DSS"")")),LOC=$P(NDDSS,"^")
"RTN","PSJORRN1",48,0)
 S:F'[53.1 LOC=$P(ND8,"^") S LOC=$S(LOC]"":LOC,1:"~") I LOC S LOC=$P($G(^SC(LOC,0)),"^")
"RTN","PSJORRN1",49,0)
 S PSJST=$P(ND0,"^",9) S PSJST2=$S(PSJST="A":1,PSJST="E":2,1:"") Q:'PSJST2
"RTN","PSJORRN1",50,0)
 S PSJOI=$P(NDP2,"^"),PSJOINM=$P($G(^PS(50.7,+PSJOI,0)),"^")
"RTN","PSJORRN1",51,0)
 S PSJSTP=+$P(ND2,"^",4)
"RTN","PSJORRN1",52,0)
 ;********
"RTN","PSJORRN1",53,0)
 S TFN2=$G(TFN2)+1
"RTN","PSJORRN1",54,0)
 S DN(1)=$S($G(DN(1))="":"UNKNOWN",1:DN(1))
"RTN","PSJORRN1",55,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,0)=FON_";I"_U_DN(1)_"^^"_$P(ND2,U,4)_"^^"_DO_U_UNITS_U_$P(ND0,U,21)_U_STAT_U_U_U_U_NOTGIVEN_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_$P(ND2,U,2)_U_$G(RNWDT)
"RTN","PSJORRN1",56,0)
 K ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"CLINIC",0) I PSJCLIN]"" S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"CLINIC",0)=PSJCLIN
"RTN","PSJORRN1",57,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",2)
"RTN","PSJORRN1",58,0)
 I PROVIDER S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRN1",59,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"MDR",0)=MR]"" S:MR]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"MDR",1,0)=MR
"RTN","PSJORRN1",60,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SCH",0)=$P(ND2,U)]"" S:$P(ND2,U)]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SCH",1,0)=$P(ND2,U)
"RTN","PSJORRN1",61,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SIG",0)=INST]"" S:INST]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SIG",1,0)=INST
"RTN","PSJORRN1",62,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"ADM",0)=$P(ND2,U,5)]"" S:$P(ND2,U,5)]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"ADM",1,0)=$P(ND2,U,5)
"RTN","PSJORRN1",63,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SIO",0)=ND6]"" S:ND6]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SIO",1,0)=ND6
"RTN","PSJORRN1",64,0)
 Q
"RTN","PSJORRN1",65,0)
 ;
"RTN","PSJORRN1",66,0)
IVTMP ;*** Set ^TMP for IV orders.
"RTN","PSJORRN1",67,0)
 N PROVIDER,START,STOP,EDTCMPLX,NDP2,IVLIM,PSJLOC,NDDSS
"RTN","PSJORRN1",68,0)
 S (PROVIDER,START,STOP,EDTCMPLX,NDP2,IVLIM,PSJLOC,NDDSS)=""
"RTN","PSJORRN1",69,0)
 I $E($G(PSJOTYP))="P",'$G(WBDT) S WBDT=+ON
"RTN","PSJORRN1",70,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8)
"RTN","PSJORRN1",71,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F'["53.1",($P(ND0,U,2)>EDT) Q
"RTN","PSJORRN1",72,0)
 D TYPE S PSJLOC=$S($G(PSJCLIN):$P($G(^SC(+PSJCLIN,0)),"^"),1:"zzz")
"RTN","PSJORRN1",73,0)
 S FON=+ON_$S(F["53.1":"P",1:"V"),CNT=0
"RTN","PSJORRN1",74,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRN1",75,0)
 ;******** GUI 27 old sort, new format for Meds Tab
"RTN","PSJORRN1",76,0)
 S NDDSS=$G(@(F_ON_",""DSS"")")),NDP2=$G(@(F_ON_",.2)"))
"RTN","PSJORRN1",77,0)
 S PSJOI=$P(NDP2,"^"),PSJST=""
"RTN","PSJORRN1",78,0)
 I F[53.1 S PSJST=$P(ND0,"^",9)
"RTN","PSJORRN1",79,0)
 I F'[53.1 S PSJST=$P(ND0,"^",17)
"RTN","PSJORRN1",80,0)
 S PSJST2=$S(PSJST="A":1,PSJST="E":2,1:"") Q:'PSJST2
"RTN","PSJORRN1",81,0)
 S LOC=$P(NDDSS,"^") S LOC=$S(LOC]"":LOC,1:"~")  I LOC S LOC=$P($G(^SC(LOC,0)),"^")
"RTN","PSJORRN1",82,0)
 S PSJOINM=$P(^PS(50.7,+PSJOI,0),"^")
"RTN","PSJORRN1",83,0)
 S PSJSTP=$P(ND0,"^",3)
"RTN","PSJORRN1",84,0)
 ;********
"RTN","PSJORRN1",85,0)
 S TFN2=$G(TFN2)+1
"RTN","PSJORRN1",86,0)
 S DN(1)=$S($G(DN(1))="":"UNKNOWN",1:DN(1)),CNT=0
"RTN","PSJORRN1",87,0)
 F X=0:0 S X=$O(@(F_ON_",""AD"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""AD"","_X_",0)")),DN=$P($G(^PS(52.6,+ND,0)),U),Y=DN_U_$P(ND,U,2) S:$P(ND,U,3) Y=Y_U_$P(ND,U,3) S CNT=CNT+1,DN(CNT)=Y S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"A",CNT,0)=Y
"RTN","PSJORRN1",88,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"A",0)=CNT,CNT=0
"RTN","PSJORRN1",89,0)
 F X=0:0 S X=$O(@(F_ON_",""SOL"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0)),CNT=CNT+1,^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"B",CNT,0)=$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)
"RTN","PSJORRN1",90,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"B",0)=CNT
"RTN","PSJORRN1",91,0)
 S TYPE=$P(ND0,U,4),(MR,SCH,INST,INFUS)=""
"RTN","PSJORRN1",92,0)
 I FON["P" S ND2=$G(^PS(53.1,+ON,2)),SCH=$P(ND2,U),START=$P(ND2,U,2),STOP=$P(ND2,U,4),MR=$P(ND0,U,3),INFUS=$P($G(^PS(53.1,+ON,8)),U,5),STAT=$$CODES^PSIVUTL($P(ND0,U,9),53.1,28),ADM=$P(ND2,U,5),SIO=$P($G(@(F_+ON_",6)")),"^")
"RTN","PSJORRN1",93,0)
 I FON'["P" S START=$P(ND0,U,2),STOP=$P(ND0,U,3),SCH=$P(ND0,U,9),INFUS=$P(ND0,U,8),MR=$P($G(^PS(55,DFN,"IV",+ON,.2)),U,3),STAT=$$CODES^PSIVUTL($P(ND0,U,17),55.01,100),ADM=$P(ND0,U,11),SIO=$P($G(@(F_+ON_",3)")),"^")
"RTN","PSJORRN1",94,0)
 S DN=$G(@(F_+ON_",.2)")),DO=$P(DN,U,2)
"RTN","PSJORRN1",95,0)
 S DN=$S(+$P(DN,U):$$OIDF^PSJLMUT1($P(DN,U)),1:"")
"RTN","PSJORRN1",96,0)
 S:MR MR=$$MR^PSJORRE1(+MR),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRN1",97,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,0)=FON_";I"_U_DN_U_INFUS_U_STOP_"^^"_DO_"^^"_$P(ND0,"^",21)_U_STAT_U_U_U_U_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_START_U_$G(RNWDT)
"RTN","PSJORRN1",98,0)
 K ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"CLINIC",0) I PSJCLIN]"" S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"CLINIC",0)=PSJCLIN
"RTN","PSJORRN1",99,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",6)
"RTN","PSJORRN1",100,0)
 I PROVIDER S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRN1",101,0)
 S ND2P5=$G(@(F_+ON_",2.5)")) S IVLIM=$P(ND2P5,U,4) I $E(IVLIM)="a" S IVLIM="doses"_$P(IVLIM,"a",2)
"RTN","PSJORRN1",102,0)
 I IVLIM="" S IVLIM=$P(ND2P5,U,2) S:(IVLIM'["d")&(IVLIM'["h") IVLIM=""
"RTN","PSJORRN1",103,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"MDR",0)=MR]"" S:MR]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"MDR",1,0)=MR
"RTN","PSJORRN1",104,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SIG",0)=INST]"" S:INST]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SIG",1,0)=INST
"RTN","PSJORRN1",105,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SCH",0)=SCH]"" S:SCH]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SCH",1,0)=SCH
"RTN","PSJORRN1",106,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"ADM",0)=ADM]"" S:ADM]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"ADM",1,0)=ADM
"RTN","PSJORRN1",107,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SIO",0)=SIO]"" S:SIO]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SIO",1,0)=SIO
"RTN","PSJORRN1",108,0)
 I $G(IVLIM)]"" S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"IVLIM",0)=IVLIM
"RTN","PSJORRN1",109,0)
 Q
"RTN","PSJORRN1",110,0)
STAT(Y,X) ;* Return the full status instead of just the code for U/D.
"RTN","PSJORRN1",111,0)
 S X=$P($P(";"_$P(Y,U,3),";"_X_":",2),";")
"RTN","PSJORRN1",112,0)
 Q X
"RTN","PSJORRN1",113,0)
TYPE ;determine if this is an IMO order or not
"RTN","PSJORRN1",114,0)
 S (A,PSJCLIN)="" I F["PS(53.1" S A=$G(^PS(53.1,ON,"DSS"))
"RTN","PSJORRN1",115,0)
 I F["PS(55" S A=$S(F["IV":$G(^PS(55,DFN,"IV",ON,"DSS")),1:$G(^PS(55,DFN,5,ON,8)))
"RTN","PSJORRN1",116,0)
 I $P(A,"^",2)'="" S PSJCLIN=+A
"RTN","PSJORRN1",117,0)
 Q
"RTN","PSJORRO")
0^3^B61708639
"RTN","PSJORRO",1,0)
PSJORRO ;BIR/MV-RETURN INPATIENT MEDS (CONDENSED) OLD SORT ;28 Jan 99 / 12:56 PM
"RTN","PSJORRO",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**134**;16 DEC 97;Build 124
"RTN","PSJORRO",3,0)
 ;
"RTN","PSJORRO",4,0)
 ;Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJORRO",5,0)
 ;Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJORRO",6,0)
 ;Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJORRO",7,0)
 ;Reference to ^TMP("PS" is documented in DBIA #2383.
"RTN","PSJORRO",8,0)
 ;Reference to ^SC is documented in DBIA #10040.
"RTN","PSJORRO",9,0)
 ;Reference to ^PS(50.7 is supported by DBIA #2180.
"RTN","PSJORRO",10,0)
 ;
"RTN","PSJORRO",11,0)
 ; return condensed list of inpat meds
"RTN","PSJORRO",12,0)
OCL(DFN,BDT,EDT,TFN) ; Execute this section if MVIEW=1
"RTN","PSJORRO",13,0)
 N ADM,CNT,DN,DO,F,FON,INFUS,INST,MR,ND,ND0,ND2,ND6,ON,PON,PST,SCH,SIO,STAT,TYPE,UNITS,WBDT,X,Y,PSJCLIN,A,TFN2,PSJOTYP
"RTN","PSJORRO",14,0)
 S TFN2=TFN
"RTN","PSJORRO",15,0)
 ; PON=placer order number (oerr), FON=filler order number
"RTN","PSJORRO",16,0)
 S:BDT="" BDT=DT S WBDT=BDT_".000001"
"RTN","PSJORRO",17,0)
 S:EDT="" EDT=9999999
"RTN","PSJORRO",18,0)
 S:EDT'["." EDT=EDT_".999999"
"RTN","PSJORRO",19,0)
 S F="^PS(55,DFN,5," F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  S PSJOTYP="D" D UDTMP
"RTN","PSJORRO",20,0)
 S F="^PS(53.1," F PST="P","N" F ON=0:0 S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  S X=$P($G(^PS(53.1,+ON,0)),U,4) S PSJOTYP=$S(PST="P":"P1",1:"P2") D @$S(X="U":"UDTMP",1:"IVTMP")
"RTN","PSJORRO",21,0)
 S F="^PS(55,"_DFN_",""IV"",",WBDT=BDT-1 F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  S PSJOTYP="V" D IVTMP
"RTN","PSJORRO",22,0)
 S X1="" F  S X1=$O(^TMP("PSJTMP",$J,X1)) Q:X1=""  S X2="" F  S X2=$O(^TMP("PSJTMP",$J,X1,X2)) Q:X2=""  S X3="" F  S X3=$O(^TMP("PSJTMP",$J,X1,X2,X3)) Q:X3=""  D
"RTN","PSJORRO",23,0)
 .S X4="" F  S X4=$O(^TMP("PSJTMP",$J,X1,X2,X3,X4)) Q:X4=""  S X5="" F  S X5=$O(^TMP("PSJTMP",$J,X1,X2,X3,X4,X5)) Q:X5=""  D
"RTN","PSJORRO",24,0)
 ..; The merge below sends the proper ^TMP("PS",$J structure back to the calling routine PSJORRE
"RTN","PSJORRO",25,0)
 ..S TFN=$G(TFN)+1 M ^TMP("PS",$J,TFN)=^TMP("PSJTMP",$J,X1,X2,X3,X4,X5) S ^TMP("PS",$J,"PC",0)=TFN
"RTN","PSJORRO",26,0)
 K ^TMP("PSJTMP",$J)
"RTN","PSJORRO",27,0)
 Q
"RTN","PSJORRO",28,0)
 ;
"RTN","PSJORRO",29,0)
UDTMP ;*** Set ^TMP for Unit dose orders.
"RTN","PSJORRO",30,0)
 N PROVIDER,RNWDT,EDTCMPLX,NDP2,PSJSTP,PSJLOC,NDDSS
"RTN","PSJORRO",31,0)
 S (PROVIDER,RNWDT,EDTCMPLX,NDP2,PSJSTP,PSJLOC,NDDSS)=""
"RTN","PSJORRO",32,0)
 S (MR,SCH,INST,PON)="",FON=+ON_$S(F["53.1":"P",1:"U")
"RTN","PSJORRO",33,0)
 I $E($G(PSJOTYP))="P",'$G(WBDT) S WBDT=+ON
"RTN","PSJORRO",34,0)
 D TYPE S PSJLOC=$S($G(PSJCLIN):$P($G(^SC(+PSJCLIN,0)),"^"),1:"zzz")
"RTN","PSJORRO",35,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRO",36,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8)
"RTN","PSJORRO",37,0)
 S ND2=$G(@(F_ON_",2)")) I 'EDTCMPLX I F'["53.1",($P(ND2,U,2)>EDT) Q
"RTN","PSJORRO",38,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F["53.1",($P(ND0,U,16)>EDT) Q
"RTN","PSJORRO",39,0)
 S STAT=$$CODES^PSIVUTL($P(ND0,U,9),$S(FON["P":53.1,1:55.06),28)
"RTN","PSJORRO",40,0)
 S ND6=$P($G(@(F_ON_",6)")),"^"),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRO",41,0)
 S ND8=$P($G(@(F_ON_",8)")),"^")
"RTN","PSJORRO",42,0)
 S FON=+ON_$S(F["53.1":"P",1:"U"),DO=$P($G(@(F_ON_",.2)")),"^",2)
"RTN","PSJORRO",43,0)
 D DRGDISP^PSJLMUT1(DFN,FON,40,0,.DN,1)
"RTN","PSJORRO",44,0)
 S UNITS="" I '$O(@(F_+ON_",1,1)")) S UNITS=$P($G(@(F_+ON_",1,1,0)")),U,2) S:(FON["U")&(UNITS="") UNITS=1
"RTN","PSJORRO",45,0)
 S:+$P(ND0,U,3) MR=$$MR^PSJORRE1(+$P(ND0,U,3))
"RTN","PSJORRO",46,0)
 N NOTGIVEN S NOTGIVEN=$S(FON["U":$P($G(^PS(55,DFN,5,+ON,0)),"^",22),1:"")
"RTN","PSJORRO",47,0)
 ;******** GUI 27 old sort, new format for Meds Tab
"RTN","PSJORRO",48,0)
 I F[53.1 S NDDSS=$G(@(F_ON_",""DSS"")")),LOC=$P(NDDSS,"^")
"RTN","PSJORRO",49,0)
 S:F'[53.1 LOC=$P(ND8,"^") S LOC=$S(LOC]"":LOC,1:"~") I LOC S LOC=$P($G(^SC(LOC,0)),"^")
"RTN","PSJORRO",50,0)
 S PSJST=$P(ND0,"^",9)
"RTN","PSJORRO",51,0)
 S GP=$S((",A,H,")[(","_PSJST_","):2,(",P,N,")[(","_PSJST_","):1,PSJST="E":3,(",DE,DR,D,RE,R,")[(","_PSJST_","):4,1:0)
"RTN","PSJORRO",52,0)
 S PSJST2=$S(PSJST="A":1,PSJST="R":2,PSJST="H":3,PSJST="S":4,PSJST="P":5,PSJST="O":6,PSJST="N":7,PSJST="I":8,PSJST="P":9,GP=4&($G(PRIO)="D"):10,PSJST="E":11,PSJST="D":12,PSJST="DE":13,PSJST="RE":14,PSJST="R":15,1:0)
"RTN","PSJORRO",53,0)
 S PSJOI=$P(NDP2,"^"),PSJOINM=$P($G(^PS(50.7,+PSJOI,0)),"^")
"RTN","PSJORRO",54,0)
 S PSJSTP=+$P(ND2,"^",4)
"RTN","PSJORRO",55,0)
 ;********
"RTN","PSJORRO",56,0)
 S TFN2=$G(TFN2)+1
"RTN","PSJORRO",57,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,0)=FON_";I"_U_DN(1)_"^^"_$P(ND2,U,4)_"^^"_DO_U_UNITS_U_$P(ND0,U,21)_U_STAT_U_U_U_U_NOTGIVEN_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_$P(ND2,U,2)_U_$G(RNWDT)
"RTN","PSJORRO",58,0)
 K ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"CLINIC",0) I PSJCLIN]"" S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"CLINIC",0)=PSJCLIN
"RTN","PSJORRO",59,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",2)
"RTN","PSJORRO",60,0)
 I PROVIDER S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRO",61,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"MDR",0)=MR]"" S:MR]"" ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"MDR",1,0)=MR
"RTN","PSJORRO",62,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"SCH",0)=$P(ND2,U)]"" S:$P(ND2,U)]"" ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"SCH",1,0)=$P(ND2,U)
"RTN","PSJORRO",63,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"SIG",0)=INST]"" S:INST]"" ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"SIG",1,0)=INST
"RTN","PSJORRO",64,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"ADM",0)=$P(ND2,U,5)]"" S:$P(ND2,U,5)]"" ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"ADM",1,0)=$P(ND2,U,5)
"RTN","PSJORRO",65,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"SIO",0)=ND6]"" S:ND6]"" ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"SIO",1,0)=ND6
"RTN","PSJORRO",66,0)
 Q
"RTN","PSJORRO",67,0)
 ;
"RTN","PSJORRO",68,0)
IVTMP ;*** Set ^TMP for IV orders.
"RTN","PSJORRO",69,0)
 N PROVIDER,START,STOP,EDTCMPLX,NDP2,IVLIM,PSJLOC
"RTN","PSJORRO",70,0)
 I $E($G(PSJOTYP))="P",'$G(WBDT) S WBDT=+ON
"RTN","PSJORRO",71,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8)
"RTN","PSJORRO",72,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F'["53.1",($P(ND0,U,2)>EDT) Q
"RTN","PSJORRO",73,0)
 D TYPE S PSJLOC=$S($G(PSJCLIN):$P($G(^SC(+PSJCLIN,0)),"^"),1:"zzz")
"RTN","PSJORRO",74,0)
 S FON=+ON_$S(F["53.1":"P",1:"V"),CNT=0
"RTN","PSJORRO",75,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRO",76,0)
 ;******** GUI 27 old sort, new format for Meds Tab
"RTN","PSJORRO",77,0)
 S NDDSS=$G(@(F_ON_",""DSS"")")),NDP2=$G(@(F_ON_",.2)"))
"RTN","PSJORRO",78,0)
 S PSJOI=$P(NDP2,"^")
"RTN","PSJORRO",79,0)
 I F[53.1 S PSJST=$P(ND0,"^",9)
"RTN","PSJORRO",80,0)
 I F'[53.1 S PSJST=$P(ND0,"^",17)
"RTN","PSJORRO",81,0)
 S GP=$S((",A,H,")[(","_PSJST_","):2,(",P,N,")[(","_PSJST_","):1,PSJST="E":3,(",DE,DR,D,RE,R,")[(","_PSJST_","):4,1:0)
"RTN","PSJORRO",82,0)
 S PSJST2=$S(PSJST="A":1,PSJST="R":2,PSJST="H":3,PSJST="S":4,PSJST="P":5,PSJST="O":6,PSJST="N":7,PSJST="I":8,PSJST="P":9,GP=4&($G(PRIO)="D"):10,PSJST="E":11,PSJST="D":12,PSJST="DE":13,PSJST="RE":14,PSJST="R":15,1:0)
"RTN","PSJORRO",83,0)
 S LOC=$P(NDDSS,"^") S LOC=$S(LOC]"":LOC,1:"~")  I LOC S LOC=$P($G(^SC(LOC,0)),"^")
"RTN","PSJORRO",84,0)
 S PSJOINM=$P(^PS(50.7,+PSJOI,0),"^")
"RTN","PSJORRO",85,0)
 S PSJSTP=$P(ND0,"^",3)
"RTN","PSJORRO",86,0)
 ;********
"RTN","PSJORRO",87,0)
 S TFN2=$G(TFN2)+1
"RTN","PSJORRO",88,0)
 F X=0:0 S X=$O(@(F_ON_",""AD"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""AD"","_X_",0)")),DN=$P($G(^PS(52.6,+ND,0)),U),Y=DN_U_$P(ND,U,2) S:$P(ND,U,3) Y=Y_U_$P(ND,U,3) S CNT=CNT+1,^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"A",CNT,0)=Y
"RTN","PSJORRO",89,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"A",0)=CNT,CNT=0
"RTN","PSJORRO",90,0)
 F X=0:0 S X=$O(@(F_ON_",""SOL"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0)),CNT=CNT+1,^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"B",CNT,0)=$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)
"RTN","PSJORRO",91,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"B",0)=CNT
"RTN","PSJORRO",92,0)
 S TYPE=$P(ND0,U,4),(MR,SCH,INST,INFUS)=""
"RTN","PSJORRO",93,0)
 I FON["P" S ND2=$G(^PS(53.1,+ON,2)),SCH=$P(ND2,U),START=$P(ND2,U,2),STOP=$P(ND2,U,4),MR=$P(ND0,U,3),INFUS=$P($G(^PS(53.1,+ON,8)),U,5),STAT=$$CODES^PSIVUTL($P(ND0,U,9),53.1,28),ADM=$P(ND2,U,5),SIO=$P($G(@(F_+ON_",6)")),"^")
"RTN","PSJORRO",94,0)
 I FON'["P" S START=$P(ND0,U,2),STOP=$P(ND0,U,3),SCH=$P(ND0,U,9),INFUS=$P(ND0,U,8),MR=$P($G(^PS(55,DFN,"IV",+ON,.2)),U,3),STAT=$$CODES^PSIVUTL($P(ND0,U,17),55.01,100),ADM=$P(ND0,U,11),SIO=$P($G(@(F_+ON_",3)")),"^")
"RTN","PSJORRO",95,0)
 S DN=$G(@(F_+ON_",.2)")),DO=$P(DN,U,2)
"RTN","PSJORRO",96,0)
 S DN=$S(+$P(DN,U):$$OIDF^PSJLMUT1($P(DN,U)),1:"")
"RTN","PSJORRO",97,0)
 S:MR MR=$$MR^PSJORRE1(+MR),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRO",98,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,0)=FON_";I"_U_DN_U_INFUS_U_STOP_"^^"_DO_"^^"_$P(ND0,"^",21)_U_STAT_U_U_U_U_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_START_U_$G(RNWDT)
"RTN","PSJORRO",99,0)
 K ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"CLINIC",0) I PSJCLIN]"" S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"CLINIC",0)=PSJCLIN
"RTN","PSJORRO",100,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",6)
"RTN","PSJORRO",101,0)
 I PROVIDER S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRO",102,0)
 S ND2P5=$G(@(F_+ON_",2.5)")) S IVLIM=$P(ND2P5,U,4) I $E(IVLIM)="a" S IVLIM="doses"_$P(IVLIM,"a",2)
"RTN","PSJORRO",103,0)
 I IVLIM="" S IVLIM=$P(ND2P5,U,2) S:(IVLIM'["d")&(IVLIM'["h") IVLIM=""
"RTN","PSJORRO",104,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"MDR",0)=MR]"" S:MR]"" ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"MDR",1,0)=MR
"RTN","PSJORRO",105,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"SIG",0)=INST]"" S:INST]"" ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"SIG",1,0)=INST
"RTN","PSJORRO",106,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"SCH",0)=SCH]"" S:SCH]"" ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"SCH",1,0)=SCH
"RTN","PSJORRO",107,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"ADM",0)=ADM]"" S:ADM]"" ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"ADM",1,0)=ADM
"RTN","PSJORRO",108,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"SIO",0)=SIO]"" S:SIO]"" ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"SIO",1,0)=SIO
"RTN","PSJORRO",109,0)
 I $G(IVLIM)]"" S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"IVLIM",0)=IVLIM
"RTN","PSJORRO",110,0)
 Q
"RTN","PSJORRO",111,0)
STAT(Y,X) ;* Return the full status instead of just the code for U/D.
"RTN","PSJORRO",112,0)
 S X=$P($P(";"_$P(Y,U,3),";"_X_":",2),";")
"RTN","PSJORRO",113,0)
 Q X
"RTN","PSJORRO",114,0)
TYPE ;determine if this is an IMO order or not
"RTN","PSJORRO",115,0)
 S (A,PSJCLIN)="" I F["PS(53.1" S A=$G(^PS(53.1,ON,"DSS"))
"RTN","PSJORRO",116,0)
 I F["PS(55" S A=$S(F["IV":$G(^PS(55,DFN,"IV",ON,"DSS")),1:$G(^PS(55,DFN,5,ON,8)))
"RTN","PSJORRO",117,0)
 I $P(A,"^",2)'="" S PSJCLIN=+A
"RTN","PSJORRO",118,0)
 Q
"RTN","PSJORUT2")
0^18^B47514615
"RTN","PSJORUT2",1,0)
PSJORUT2 ;BIR/MLM-MISC. PROCEDURE CALLS FOR OE/RR 3.0 (CONT.) ;03 Aug 98 / 8:42 AM
"RTN","PSJORUT2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**14,29,50,56,58,107,152,134**;16 DEC 97;Build 124
"RTN","PSJORUT2",3,0)
 ;
"RTN","PSJORUT2",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSJORUT2",5,0)
 ; Reference to ^PS(50.605 is supported by DBIA 2138,696.
"RTN","PSJORUT2",6,0)
 ; References to ^PS(52.6 supported by DBIA 1231
"RTN","PSJORUT2",7,0)
 ; Reference to ^PS(52.7 supported by DBIA 2173.
"RTN","PSJORUT2",8,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192
"RTN","PSJORUT2",9,0)
 ; Reference to ^PSNDF( is supported by DBIA 2195
"RTN","PSJORUT2",10,0)
 ; Reference to ^PSRX( is supported by DBIA 824
"RTN","PSJORUT2",11,0)
 ; Reference to ^PSNAPIS is supported by DBIA 2531
"RTN","PSJORUT2",12,0)
 ;
"RTN","PSJORUT2",13,0)
ENVAC(PN) ; Find VA CLASS of VA Product Name
"RTN","PSJORUT2",14,0)
 ;Input: PN - See above
"RTN","PSJORUT2",15,0)
 ;Output: VA Drug Class^Classification
"RTN","PSJORUT2",16,0)
 ;
"RTN","PSJORUT2",17,0)
 ; NEW NDF CALL 
"RTN","PSJORUT2",18,0)
 N X S X="PSNAPIS" X ^%ZOSF("TEST") I  N PSJC,X1,X2 S X1=+$P(PN,"."),X2=+$P(PN,".",2),PSJC=$$DCLASS^PSNAPIS(X1,X2) Q PSJC
"RTN","PSJORUT2",19,0)
 ;
"RTN","PSJORUT2",20,0)
 N GDP,PNP S GDP=$P(PN,"."),PNP=$P(PN,".",2)
"RTN","PSJORUT2",21,0)
 S X=+$P($G(^PSNDF(+GDP,5,+PNP,0)),U,2),X=+$P($G(^PSNDF(GDP,2,X,0)),U,3),PSJC=$P($G(^PS(50.605,X,0)),U,2)
"RTN","PSJORUT2",22,0)
 Q $S('X:0,PSJC="":0,1:X_U_PSJC)
"RTN","PSJORUT2",23,0)
 ;
"RTN","PSJORUT2",24,0)
ENVAGN(PN) ; Return VA Generic Name for specified VA Product Name.
"RTN","PSJORUT2",25,0)
 ;Input:  PN - VA Product Name IEN
"RTN","PSJORUT2",26,0)
 ;Output: VA Generic Name IEN^VA Generic Name
"RTN","PSJORUT2",27,0)
 ;
"RTN","PSJORUT2",28,0)
 ; NEW NDF CALL 
"RTN","PSJORUT2",29,0)
 N X S X="PSNAPIS" X ^%ZOSF("TEST") I  N GDP,X1,X2 S X1=+$P(PN,"."),X2=+$P(PN,".",2),GDP=$$VAGN^PSNAPIS(X1) Q $S(GDP=0:0,1:X1_U_GDP)
"RTN","PSJORUT2",30,0)
 ;
"RTN","PSJORUT2",31,0)
 N GDP,PNP S GDP=+$P(PN,"."),PNP=+$P(PN,".",2)
"RTN","PSJORUT2",32,0)
 S X=$P($G(^PSNDF(GDP,0)),U)
"RTN","PSJORUT2",33,0)
 Q $S('GDP:0,X="":0,1:GDP_U_X)
"RTN","PSJORUT2",34,0)
ENVOL(PN,ARRAY) ;
"RTN","PSJORUT2",35,0)
 I (PN'["A")&(PN'["B") S ARRAY="0" Q
"RTN","PSJORUT2",36,0)
 N X,XX,F,INACT,IVFL
"RTN","PSJORUT2",37,0)
 S X(1)="ML",X(2)="LITER",X(3)="MCG",X(4)="MG",X(5)="GM",X(6)="UNITS",X(7)="IU",X(8)="MEQ",X(9)="MM",X(10)="MU",X(11)="THOUU",X(12)="MG-PE",X(13)="NANOGRAM",X(14)="MMOL"
"RTN","PSJORUT2",38,0)
 I PN["A" N ADD S (ADD,X,XX)=0 F  S ADD=$O(^PS(52.6,"AOI",+PN,ADD))  Q:ADD=""  D
"RTN","PSJORUT2",39,0)
 .S INACT=$G(^PS(52.6,ADD,"I")) I INACT']""!(INACT>DT) S IVFL=$P($G(^(0)),"^",13) Q:'IVFL  S XX=XX+1,ARRAY(ADD)="^"_X($P($G(^PS(52.6,ADD,0)),U,3)) Q
"RTN","PSJORUT2",40,0)
 I PN["B" N SOL S SOL=0,XX=0 F  S SOL=$O(^PS(52.7,"AOI",+PN,SOL)) Q:SOL=""  D
"RTN","PSJORUT2",41,0)
 .S INACT=$G(^PS(52.7,SOL,"I")) I INACT']""!(INACT>DT) S IVFL=$P($G(^(0)),"^",13) Q:'IVFL  S XX=XX+1,ARRAY(SOL)=$P($G(^PS(52.7,SOL,0)),"^",3)
"RTN","PSJORUT2",42,0)
 S ARRAY=XX>0
"RTN","PSJORUT2",43,0)
 Q
"RTN","PSJORUT2",44,0)
 ;
"RTN","PSJORUT2",45,0)
ENVOL2(PN,ARRAY) ;Only for Med Button IV orders.
"RTN","PSJORUT2",46,0)
 I (PN'["A")&(PN'["B") S ARRAY="0" Q
"RTN","PSJORUT2",47,0)
 N X,XX,F,INACT
"RTN","PSJORUT2",48,0)
 S X(1)="ML",X(2)="LITER",X(3)="MCG",X(4)="MG",X(5)="GM",X(6)="UNITS",X(7)="IU",X(8)="MEQ",X(9)="MM",X(10)="MU",X(11)="THOUU",X(12)="MG-PE",X(13)="NANOGRAM",X(14)="MMOL"
"RTN","PSJORUT2",49,0)
 I PN["A" N ADD S (ADD,X,XX)=0 F  S ADD=$O(^PS(52.6,"AOI",+PN,ADD))  Q:ADD=""  D
"RTN","PSJORUT2",50,0)
 .S INACT=$G(^PS(52.6,ADD,"I")) I INACT']""!(INACT>DT) S XX=XX+1,ARRAY(ADD)="^"_X($P($G(^PS(52.6,ADD,0)),U,3)) Q
"RTN","PSJORUT2",51,0)
 I PN["B" N SOL S SOL=0,XX=0 F  S SOL=$O(^PS(52.7,"AOI",+PN,SOL)) Q:SOL=""  D
"RTN","PSJORUT2",52,0)
 .S INACT=$G(^PS(52.7,SOL,"I")) I INACT']""!(INACT>DT) S XX=XX+1,ARRAY(SOL)=$P($G(^PS(52.7,SOL,0)),"^",3)
"RTN","PSJORUT2",53,0)
 S ARRAY=XX>0
"RTN","PSJORUT2",54,0)
 Q
"RTN","PSJORUT2",55,0)
 ;
"RTN","PSJORUT2",56,0)
 ;
"RTN","PSJORUT2",57,0)
SENVOL(PN,PSJ) ;Return array listing volume (base only) and volume units for the specified additive or solution.
"RTN","PSJORUT2",58,0)
 ;Input:  PN - IEN_B (Base) or A (Additive)
"RTN","PSJORUT2",59,0)
 ;Output: ARRAY(IEN,A:additive or B:Base)=volume^volume units
"RTN","PSJORUT2",60,0)
 ;        If no volume or units found PSJ=0; If found PSJ=1.
"RTN","PSJORUT2",61,0)
 ;
"RTN","PSJORUT2",62,0)
 N X S PSJ=1
"RTN","PSJORUT2",63,0)
 S X(1)="ML",X(2)="LITER",X(3)="MCG",X(4)="MG",X(5)="GM",X(6)="UNITS",X(7)="IU",X(8)="MEQ",X(9)="MM",X(10)="MU",X(11)="THOUU",X(12)="MG-PE",X(13)="NANOGRAM",X(14)="MMOL"
"RTN","PSJORUT2",64,0)
 I PN'["A",PN'["B" S PSJ=0 Q
"RTN","PSJORUT2",65,0)
 S PSJ=PSJ+1
"RTN","PSJORUT2",66,0)
 I PN["A" S PSJ(+PN,"A")=U_X(+$P($G(^PS(52.6,+PN,0)),U,3)) Q
"RTN","PSJORUT2",67,0)
 I PN["B" S PSJ(+PN,"B")=+$P($G(^PS(52.7,+PN,0)),U,3)_U_X(1) Q
"RTN","PSJORUT2",68,0)
 Q
"RTN","PSJORUT2",69,0)
 ;
"RTN","PSJORUT2",70,0)
ENREF(PRX) ; Return number of refills remaining.
"RTN","PSJORUT2",71,0)
 ;Input: PRX - Internal prescription number from File #52.
"RTN","PSJORUT2",72,0)
 ;Output: Number of refills remaining.
"RTN","PSJORUT2",73,0)
 ;
"RTN","PSJORUT2",74,0)
 N X,COUNT,CNT S PRX=$P(PRX,"^"),COUNT=0,X=$P(^PSRX(PRX,0),"^",9)
"RTN","PSJORUT2",75,0)
 D:$O(^PSRX(PRX,1,0))
"RTN","PSJORUT2",76,0)
 .F CNT=0:0 S CNT=$O(^PSRX(PRX,1,CNT)) Q:'CNT  S COUNT=COUNT+1
"RTN","PSJORUT2",77,0)
 S:$G(COUNT) X=X-COUNT
"RTN","PSJORUT2",78,0)
 Q X
"RTN","PSJORUT2",79,0)
 ;
"RTN","PSJORUT2",80,0)
ENCHK(DFN,PSJINX)     ; Return dispense drug check array.
"RTN","PSJORUT2",81,0)
 ;Input: DFN      - Patient internal entry number
"RTN","PSJORUT2",82,0)
 ;       PSJINX   - Index number so duplicate drugs will be returned.
"RTN","PSJORUT2",83,0)
 ;       PSGOCHK  - Check should include dispense drugs in 53.45
"RTN","PSJORUT2",84,0)
 ;       PSIVOCHK - Check should include entries in DRG array
"RTN","PSJORUT2",85,0)
 ;Output: ^TMP($J,"ORDERS",PSJINX)=DRUG CLASS^NATIONAL DRUG FILE ENTRY
"RTN","PSJORUT2",86,0)
 ;        _"A"_PSNDFA PRODUCT NAME ENTRY_DISPENSE DRUG NAME^OE/RR #
"RTN","PSJORUT2",87,0)
 ;        _ORDER NUMBER(P/I/V)_";I"
"RTN","PSJORUT2",88,0)
 ;
"RTN","PSJORUT2",89,0)
 NEW BDT,DDRUG,DDRUG0,DDRUGND,EDT,F,ON,ON1,PST,WBDT,X,PSJORIEN
"RTN","PSJORUT2",90,0)
 D NOW^%DTC S (BDT,WBDT)=%,EDT=9999999
"RTN","PSJORUT2",91,0)
 S F="^PS(55,DFN,5," F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  D UD
"RTN","PSJORUT2",92,0)
 S F="^PS(53.1," F PST="P","N" F ON=0:0 S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  D
"RTN","PSJORUT2",93,0)
 . I $O(^PS(53.1,+ON,"AD",0))!$O(^PS(53.1,+ON,"SOL",0)) D PIV Q
"RTN","PSJORUT2",94,0)
 . D UD
"RTN","PSJORUT2",95,0)
 S WBDT=BDT F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  D IV
"RTN","PSJORUT2",96,0)
 I '$G(PSIVOCON) D NEWIV ; Don't do this when Finishing orders (FN)
"RTN","PSJORUT2",97,0)
 Q
"RTN","PSJORUT2",98,0)
UD ;*** Get the dispense drugs for the Unit Dose orders.
"RTN","PSJORUT2",99,0)
 S PSJORIEN=$P(@(F_ON_",0)"),U,21),DDRUG=0
"RTN","PSJORUT2",100,0)
 I F="^PS(53.1,",($P(@(F_ON_",0)"),U,4)="I") D  Q
"RTN","PSJORUT2",101,0)
 . NEW PSJPD S COD=ON_"P"
"RTN","PSJORUT2",102,0)
 . S PSJPD=+$G(^PS(53.1,ON,.2)) D:$D(^PS(52.6,"AOI",PSJPD)) ENDDIV^PSJORUTL(PSJPD,"A","",.DDRUG) S DDRUG=+DDRUG D:DDRUG DDRUG
"RTN","PSJORUT2",103,0)
 S ON1=0 F  S ON1=$O(@(F_ON_",1,"_ON1_")")) Q:'ON1  S DDRUG=@(F_ON_",1,"_ON1_",0)") I $P(DDRUG,U,3)=""!($P(DDRUG,U,3)>BDT) S COD=ON_$S(F["^PS(53.1":"P",1:"U") D DDRUG
"RTN","PSJORUT2",104,0)
 I $D(PSGOCHK) F ON1=0:0 S ON1=$O(^PS(53.45,+PSJSYSP,1,ON1)) Q:'ON1  S DDRUG=$G(^PS(53.45,+PSJSYSP,1,ON1,0)) I $P(DDRUG,U,3)=""!@($P(DDRUG,U,3)>BDT) S (COD,PSJORIEN)="" D DDRUG
"RTN","PSJORUT2",105,0)
 I '$O(@(F_ON_",1,"_0_")")) N OI S OI=+$G(@(F_ON_",.2)")) I OI D
"RTN","PSJORUT2",106,0)
 .S DDRUG="" F  S DDRUG=$O(^PSDRUG("ASP",OI,DDRUG)) Q:'DDRUG  D
"RTN","PSJORUT2",107,0)
 ..I ($P(DDRUG,U,3)=""!($P(DDRUG,U,3)>BDT)) S COD=ON_$S(F["^PS(53.1":"P",1:"U") D DDRUG
"RTN","PSJORUT2",108,0)
 Q
"RTN","PSJORUT2",109,0)
PIV ;*** Get the dispense drugs for the Pending IV orders.
"RTN","PSJORUT2",110,0)
 S X=^PS(53.1,+ON,0),PSJORIEN=$P(X,U,21) Q:$P(X,U,27)="R"
"RTN","PSJORUT2",111,0)
 S ON1=0 F  S ON1=$O(^PS(53.1,+ON,"AD",ON1)) Q:'ON1  S X=+^PS(53.1,+ON,"AD",ON1,0),DDRUG=$P($G(^PS(52.6,X,0)),U,2) S COD=+ON_"P" D DDRUG
"RTN","PSJORUT2",112,0)
 S ON1=0 F  S ON1=$O(^PS(53.1,+ON,"SOL",ON1)) Q:'ON1  S X=+^PS(53.1,+ON,"SOL",ON1,0),DDRUG=$P($G(^PS(52.7,X,0)),U,2) S COD=+ON_"P" D DDRUG
"RTN","PSJORUT2",113,0)
 Q
"RTN","PSJORUT2",114,0)
IV ;*** Get the dispense drugs for the IV orders.
"RTN","PSJORUT2",115,0)
 NEW X S X=^PS(55,DFN,"IV",ON,0),PSJORIEN=$P(X,U,21) Q:$P(X,U,17)="R"
"RTN","PSJORUT2",116,0)
 S ON1=0 F  S ON1=$O(^PS(55,DFN,"IV",ON,"AD",ON1)) Q:'ON1  S X=+^PS(55,DFN,"IV",ON,"AD",ON1,0),DDRUG=$P($G(^PS(52.6,X,0)),U,2) S COD=ON_"V" D DDRUG
"RTN","PSJORUT2",117,0)
 S ON1=0 F  S ON1=$O(^PS(55,DFN,"IV",ON,"SOL",ON1)) Q:'ON1  S X=+^PS(55,DFN,"IV",ON,"SOL",ON1,0),DDRUG=$P($G(^PS(52.7,X,0)),U,2) S COD=ON_"V" D DDRUG
"RTN","PSJORUT2",118,0)
 Q
"RTN","PSJORUT2",119,0)
NEWIV ;*** Get the dispense drugs for the newly entered IV order.
"RTN","PSJORUT2",120,0)
 NEW PSIVX,ON
"RTN","PSJORUT2",121,0)
 S ON=$O(DRGOC(0)),PSJORIEN="" Q:'+ON
"RTN","PSJORUT2",122,0)
 F PSIVX=0:0 S PSIVX=$O(DRGOC(ON,"AD",PSIVX)) Q:'PSIVX  S DDRUG=$P(^PS(52.6,+DRGOC(ON,"AD",PSIVX),0),U,2),COD=ON55 D DDRUG
"RTN","PSJORUT2",123,0)
 F PSIVX=0:0 S PSIVX=$O(DRGOC(ON,"SOL",PSIVX)) Q:'PSIVX  S DDRUG=$P(^PS(52.7,+DRGOC(ON,"SOL",PSIVX),0),U,2),COD=ON D DDRUG
"RTN","PSJORUT2",124,0)
 Q
"RTN","PSJORUT2",125,0)
DDRUG ;*** Set PSJ(DDRUG NAME) arrays.
"RTN","PSJORUT2",126,0)
 Q:'DDRUG  S DDRUG0=$G(^PSDRUG(+DDRUG,0)),DDRUGND=$G(^PSDRUG(+DDRUG,"ND"))
"RTN","PSJORUT2",127,0)
 S PSJINX=+$G(PSJINX)+1 ;* ^PSOORDRG calls this entry point.
"RTN","PSJORUT2",128,0)
 I $D(DDRUG)=11,DDRUG[";" D  Q   ; if called from ^PSOORDRG
"RTN","PSJORUT2",129,0)
 .N IPOROP S IPOROP=$P(DDRUG,";",2)
"RTN","PSJORUT2",130,0)
 .S IPOROP=$S(IPOROP="PSO":";O",IPOROP="PSH":"N;O",1:";I")
"RTN","PSJORUT2",131,0)
 .S ^TMP($J,"ORDERS",PSJINX)=$P(DDRUG0,U,2)_U_$P(DDRUGND,U)_"A"_$P(DDRUGND,U,3)_U_$P(DDRUG0,U)_U_$S($G(DDRUG(DDRUG)):DDRUG(DDRUG),1:$G(PSJORIEN))_U_$G(COD)_IPOROP
"RTN","PSJORUT2",132,0)
 S ^TMP($J,"ORDERS",PSJINX)=$P(DDRUG0,U,2)_U_$P(DDRUGND,U)_"A"_$P(DDRUGND,U,3)_U_$P(DDRUG0,U)_U_$G(PSJORIEN)_U_$G(COD)_";I"
"RTN","PSJORUT2",133,0)
 Q
"RTN","PSJORUT2",134,0)
 ;
"RTN","PSJORUT2",135,0)
PRCHK(PSJ) ; Check if authorized to write med orders.
"RTN","PSJORUT2",136,0)
 N %,X
"RTN","PSJORUT2",137,0)
 D NOW^%DTC S X=$G(^VA(200,PSJ,"PS")) I $S('X:1,'$P(%,"^",4):0,1:$P(X,"^",4)'>%) Q 0
"RTN","PSJORUT2",138,0)
 Q PSJ
"RTN","PSJORUT2",139,0)
 ;
"RTN","PSJORUT2",140,0)
ENNG(PSJDPT,PSJNUM)          ; returns 1 if order marked "Not To Be Given"
"RTN","PSJORUT2",141,0)
 ;                                  0 if not marked
"RTN","PSJORUT2",142,0)
 I '$D(^PS(55,PSJDPT,5,+PSJNUM,0)) Q 0
"RTN","PSJORUT2",143,0)
 I $P($G(^PS(55,PSJDPT,5,+PSJNUM,0)),"^",22)=1 Q 1
"RTN","PSJORUT2",144,0)
 Q 0
"RTN","PSJUTL")
0^16^B65061820
"RTN","PSJUTL",1,0)
PSJUTL ;BIR/MLM-MISC. INPATIENT UTILITIES ;17 Mar 98 / 11:05 AM
"RTN","PSJUTL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**9,47,58,80,110,136,157,177,134**;16 DEC 97;Build 124
"RTN","PSJUTL",3,0)
 ;
"RTN","PSJUTL",4,0)
 ; Reference to ^DIC(42 is supported by DBIA 10039.
"RTN","PSJUTL",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSJUTL",6,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSJUTL",7,0)
 ; Reference to ^DIC is supported by DBIA 10006.
"RTN","PSJUTL",8,0)
 ; Reference to ^DIC1 is supported by DBIA 10007.
"RTN","PSJUTL",9,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJUTL",10,0)
 ; Reference to ^VALM1 is supported by DBIA 10116.
"RTN","PSJUTL",11,0)
 ;
"RTN","PSJUTL",12,0)
ENDL ; device look-up
"RTN","PSJUTL",13,0)
 N DA,DIC,DIE,DIX,DO,DR
"RTN","PSJUTL",14,0)
 S DIC="^%ZIS(1,",DIC(0)="EIMZ" D DO^DIC1,^DIC I Y'>0 K X Q
"RTN","PSJUTL",15,0)
 S X=Y(0,0)
"RTN","PSJUTL",16,0)
 Q
"RTN","PSJUTL",17,0)
 ;
"RTN","PSJUTL",18,0)
ENDH(X) ; device help
"RTN","PSJUTL",19,0)
 N D,XQH,DA,DIC,DIE,DO,DR,DZ
"RTN","PSJUTL",20,0)
 S DIC="^%ZIS(1,",DIC(0)="EIM" D DO^DIC1,^DIC
"RTN","PSJUTL",21,0)
 Q
"RTN","PSJUTL",22,0)
 ;
"RTN","PSJUTL",23,0)
READ ; hold screen
"RTN","PSJUTL",24,0)
 I $D(IOST) Q:$E(IOST)'="C"
"RTN","PSJUTL",25,0)
 W ! I $D(IOSL),$Y<(IOSL-4) G READ
"RTN","PSJUTL",26,0)
 W !?5,"Press return to continue  " R X:$S($D(DTIME):DTIME,1:300)
"RTN","PSJUTL",27,0)
 Q
"RTN","PSJUTL",28,0)
 ;
"RTN","PSJUTL",29,0)
ENOISC(PSJOI,USAGE)          ;Set DIC("S") so that only Orderable Items with at 
"RTN","PSJUTL",30,0)
 ;least 1 active dispense drug for the specified usage.
"RTN","PSJUTL",31,0)
 ;Input:  PSJOI IEN of Orderable Item selected
"RTN","PSJUTL",32,0)
 ;        USAGE - Type of drugs (UD,IV,etc) to be selected
"RTN","PSJUTL",33,0)
 ;Output: 1-At least one dispense drug found
"RTN","PSJUTL",34,0)
 ;        0-None found
"RTN","PSJUTL",35,0)
 N FOUND,PSJ
"RTN","PSJUTL",36,0)
 S PSJ=$P($G(^PS(50.7,+PSJOI,0)),U,4),FOUND=$S('PSJ:1,PSJ>DT:1,1:0)
"RTN","PSJUTL",37,0)
 I FOUND S FOUND=0 F PSJ=0:0 S PSJ=$O(^PSDRUG("ASP",PSJOI,PSJ)) Q:FOUND!'PSJ  I $P($G(^PSDRUG(PSJ,2)),U,3)[USAGE,'$G(^("I"))!($G(^("I"))'<DT) S FOUND=1
"RTN","PSJUTL",38,0)
 Q FOUND
"RTN","PSJUTL",39,0)
 ;
"RTN","PSJUTL",40,0)
AADR ; display allergies and adverse reactions
"RTN","PSJUTL",41,0)
 D ATS^PSJMUTL(60,50,1) N A,B
"RTN","PSJUTL",42,0)
 I (PSGALG=0)&(PSGADR=0) W !!,"No allergies or ADRs on file."
"RTN","PSJUTL",43,0)
 I PSGALG'=0 W !!,"Allergies: " S B="PSGALG" F  S A=$Q(@B) Q:A=""  W ?12,$G(@A),! S B=A
"RTN","PSJUTL",44,0)
 I PSGADR'=0 W !,"      ADR: " S B="PSGADR" F  S A=$Q(@B) Q:A=""  W ?12,$G(@A),! S B=A
"RTN","PSJUTL",45,0)
 D READ K PSGALG,PSGADR Q
"RTN","PSJUTL",46,0)
 ;
"RTN","PSJUTL",47,0)
ENALU ; application look-up
"RTN","PSJUTL",48,0)
 N PSJ S PSJ=DA(1) N DA,DIC,DIE,DIX,DO,DR S DIC="^PS(50.35,",DIC(0)="EIMZ" D DO^DIC1,^DIC I Y'>0 K X Q
"RTN","PSJUTL",49,0)
 S X=$P(Y(0),"^",2) K:$S(X="":1,1:$D(^PS(50.3,PSJ,1,"B",X))) X
"RTN","PSJUTL",50,0)
 Q
"RTN","PSJUTL",51,0)
 ;
"RTN","PSJUTL",52,0)
ENAQ ; application query
"RTN","PSJUTL",53,0)
 S X=DZ N D,DA,DIC,DIE,DO,DR,DZ,XQH S DIC="^PS(50.35,",DIC(0)="EIMQ" D DO^DIC1,^DIC
"RTN","PSJUTL",54,0)
 Q
"RTN","PSJUTL",55,0)
 ;
"RTN","PSJUTL",56,0)
ENPC(PSJTYP,PSJSYSP,LEN,TEXT) ; Copy Provider Comments -> Special Instructions.
"RTN","PSJUTL",57,0)
 Q:'$D(^PS(53.1,+$G(PSJORD),12,1,0)) ""
"RTN","PSJUTL",58,0)
 N DIR,PSGSI,PSGOEE,X,Y
"RTN","PSJUTL",59,0)
 S Y="" F X=0:0 S X=$O(^PS(53.1,+$G(PSJORD),12,X)) Q:'X  S Y=Y_^(X,0)_" " Q:$L(Y)>LEN
"RTN","PSJUTL",60,0)
 S:$G(PSJTYP)'="V" Y=$$ENSET^PSGSICHK(Y) S:$G(PSJTYP)="V" Y=$E(Y,1,$L(Y)-1)
"RTN","PSJUTL",61,0)
 I $L(Y)'<LEN S PSGOEE=0 D REDISP Q PSGSI
"RTN","PSJUTL",62,0)
 ;Display Provider Comments Prior to Asking the Copy Provider Comments Question;BHW;PSJ*5*136
"RTN","PSJUTL",63,0)
 N PSJTMP S PSJTMP=0
"RTN","PSJUTL",64,0)
 W !,"PROVIDER COMMENTS:"
"RTN","PSJUTL",65,0)
 F  S PSJTMP=$O(^PS(53.1,+$G(PSJORD),12,PSJTMP)) Q:'PSJTMP  W !,^PS(53.1,+$G(PSJORD),12,PSJTMP,0)
"RTN","PSJUTL",66,0)
 S PSGSI=Y W ! S DIR(0)="S^Y:Yes;N:No;!:Copy and flag for display in a BCMA Message Box",DIR("A")="Copy the Provider Comments into "_$$ENFIELD(PSJTYP)_" (Yes/No/!)",DIR("??")="^D ENPCHLP1^PSJUTL(PSJTYP)" D ^DIR
"RTN","PSJUTL",67,0)
 Q:Y="Y" PSGSI
"RTN","PSJUTL",68,0)
 Q:Y="!" PSGSI_"^1"
"RTN","PSJUTL",69,0)
 Q ""
"RTN","PSJUTL",70,0)
 ;
"RTN","PSJUTL",71,0)
REDISP ; Redisplay Provider Comments and allow entry of Spec. Instructions.
"RTN","PSJUTL",72,0)
 D CLEAR^VALM1 F X=0:0 S X=$O(^PS(53.1,+$G(PSJORD),12,X)) Q:'X  W ^(X,0),!
"RTN","PSJUTL",73,0)
 W !! S PSGSI=""
"RTN","PSJUTL",74,0)
 D:PSJTYP'="V" 8^PSGOE81
"RTN","PSJUTL",75,0)
 I PSJTYP="V" D 64^PSIVEDT1 S PSGSI=P("OPI")
"RTN","PSJUTL",76,0)
 Q
"RTN","PSJUTL",77,0)
 ;
"RTN","PSJUTL",78,0)
ENPCHLP1(Y) ; Display help messages for Provider Comment copy.
"RTN","PSJUTL",79,0)
 W !,"Enter ""YES"" to copy Provider Comments into the ",$$ENFIELD(Y)," field",!,"or ""NO"" to bypass",!,"or ""!"" to copy the Provider Comments into the ",$$ENFIELD(PSJTYP)," field",!,"and flag them for display in a BCMA Message Box",!!
"RTN","PSJUTL",80,0)
 Q
"RTN","PSJUTL",81,0)
ENPCHLP2(Y,X) ;
"RTN","PSJUTL",82,0)
 W !,"The Provider Comments entered for this order are longer than the space available",!,"in the ",$$ENFIELD(Y)," field.",!!,"Enter ""YES"" to copy the first ",X-3," characters into the ",$$ENFIELD(Y),!,"field, or ""NO"" to continue.",!!
"RTN","PSJUTL",83,0)
 Q
"RTN","PSJUTL",84,0)
ENBCMA(PSJTYP)  ;
"RTN","PSJUTL",85,0)
 N DIR,X,Y
"RTN","PSJUTL",86,0)
 W !!,"Would you like to flag the ",$$ENFIELD(PSJTYP)," field for display in a BCMA",!,"Message box?"
"RTN","PSJUTL",87,0)
 W ! S DIR(0)="S^Y:Yes;N:No",DIR("A")="Flag the "_$$ENFIELD(PSJTYP)_" (Yes/No)" D ^DIR
"RTN","PSJUTL",88,0)
 K PSJCOMSI I $G(PSJCOM),$G(PSJORD)'["P" N TEXT S TEXT=$S(PSJTYP="U":$G(PSGSI),1:$G(P("OPI"))) S PSJCOMSI=$$COMSI(PSJCOM,TEXT)
"RTN","PSJUTL",89,0)
 Q:Y="Y" $S($G(PSJTYP)="U":$P(PSGSI,"^")_"^1",1:$P(P("OPI"),"^")_"^1")
"RTN","PSJUTL",90,0)
 Q $S(PSJTYP="U":$P(PSGSI,"^"),1:$P($G(P("OPI")),"^"))
"RTN","PSJUTL",91,0)
ENFIELD(Y) ;
"RTN","PSJUTL",92,0)
 Q $S(Y="V":"Other Print Info",1:"Special Instructions")
"RTN","PSJUTL",93,0)
 ;
"RTN","PSJUTL",94,0)
COMSI(PARENT,INSTR) ;
"RTN","PSJUTL",95,0)
 N DIR,X,Y
"RTN","PSJUTL",96,0)
 W !!!!?15,"** WARNING **",!?5,"This order is part of a complex order."
"RTN","PSJUTL",97,0)
 W !!,"Would you like to copy the ",$$ENFIELD(PSJTYP)
"RTN","PSJUTL",98,0)
 W !,"to the other orders in the complex order?"
"RTN","PSJUTL",99,0)
 S DIR(0)="S^Y:Yes;N:No",DIR("A")="     Copy the "_$$ENFIELD(PSJTYP)_" (Yes/No)" D ^DIR
"RTN","PSJUTL",100,0)
 Q:Y="Y" 1
"RTN","PSJUTL",101,0)
 Q 0
"RTN","PSJUTL",102,0)
 ;
"RTN","PSJUTL",103,0)
ENORL(X) ; Return patient's location as variable ptr.
"RTN","PSJUTL",104,0)
 Q $S(+$G(^DIC(42,+X,44)):+$G(^(44))_";SC(",$D(^DIC(42,+X,0)):+X_";DIC(42,",1:"")
"RTN","PSJUTL",105,0)
 ;
"RTN","PSJUTL",106,0)
ENMARD() ; validate MAR SELECTION DEFAULT string in WARD PARMS file.
"RTN","PSJUTL",107,0)
 N PSJANS,PSJX1,PSJX2,RANGE,Q
"RTN","PSJUTL",108,0)
 S RANGE="1:6" F PSJX1=1:1:6 S RANGE(PSJX1)=""
"RTN","PSJUTL",109,0)
 S:$E(X)="-" X=+RANGE_X S:$E($L(X))="-" X=X_$P(RANGE,":",2)
"RTN","PSJUTL",110,0)
 S PSJANS="" F Q=1:1:$L(X,",") S PSJX1=$P(X,",",Q) D FS Q:'$D(PSJANS)
"RTN","PSJUTL",111,0)
 Q:'$G(PSJANS) 0
"RTN","PSJUTL",112,0)
 S PSJANS=$E(PSJANS,1,$L(PSJANS)-1) F Q=1:1:$L(PSJANS,",") D  Q:'$D(PSJANS)
"RTN","PSJUTL",113,0)
 .I $P(PSJANS,",",Q)=1,$L(PSJANS,",")>1 W !!,"All Medications (1) may not be selected in combination with other types." K PSJANS Q
"RTN","PSJUTL",114,0)
 .W ?47,$P(PSJANS,",",Q)," - ",$P($T(@$P(PSJANS,",",Q)),";;",2),!
"RTN","PSJUTL",115,0)
 S:$G(PSJANS) X=PSJANS Q $G(PSJANS)
"RTN","PSJUTL",116,0)
 ;
"RTN","PSJUTL",117,0)
FS ;
"RTN","PSJUTL",118,0)
 I $S(PSJX1?1.N1"-"1.N:0,PSJX1'?1.N:1,'$D(RANGE(PSJX1)):1,1:","_PSJANS[PSJX1) K PSJANS Q
"RTN","PSJUTL",119,0)
 I PSJX1'["-" S PSJANS=PSJANS_PSJX1_"," Q
"RTN","PSJUTL",120,0)
 S PSJX2=+PSJX1,PSJANS=PSJANS_PSJX2_","
"RTN","PSJUTL",121,0)
 F  S PSJX2=$O(RANGE(PSJX2)) K:$S(X="":1,","_PSJANS[PSJX2:1,1:PSJX2>$P(PSJX1,"-",2)) PSJANS Q:'$D(PSJANS)  S PSJANS=PSJANS_PSJX2_"," Q:PSJX2=$P(PSJX1,"-",2)
"RTN","PSJUTL",122,0)
 Q
"RTN","PSJUTL",123,0)
 ;
"RTN","PSJUTL",124,0)
ENMARDH ;Help text for MAR default answer.
"RTN","PSJUTL",125,0)
 W !!?2,"Enter the number corresponding to the type of orders to be included on MARs",!,"printed for this ward. Multiple types (except 1) may be selected using ""-""",!,"or "","" as delimiters.",!!,"Choose from: ",!
"RTN","PSJUTL",126,0)
 N X F X=1:1:6 W !?13,X," - ",$P($T(@X),";;",2)
"RTN","PSJUTL",127,0)
 W !
"RTN","PSJUTL",128,0)
 Q
"RTN","PSJUTL",129,0)
1 ;;All Medications
"RTN","PSJUTL",130,0)
2 ;;Non-IV Medications only
"RTN","PSJUTL",131,0)
3 ;;IV Piggybacks
"RTN","PSJUTL",132,0)
4 ;;LVPs
"RTN","PSJUTL",133,0)
5 ;;TPNs
"RTN","PSJUTL",134,0)
6 ;;Chemotherapy Medications (IV)
"RTN","PSJUTL",135,0)
 ;
"RTN","PSJUTL",136,0)
EFD ;The following EFD Tags are used to Calculate the Expected First Dose for backdoor
"RTN","PSJUTL",137,0)
 ;orders.  The call to $$ENQ^PSJORP2 is used to actually perform the calculation.
"RTN","PSJUTL",138,0)
 ;The program $$ENQ^PSJORP2 requires the variable INFO to equal the following:
"RTN","PSJUTL",139,0)
 ;BHW;PSJ*5*136
"RTN","PSJUTL",140,0)
 ; INFO (piece 1) = START DATE/TIME      ;PSGNESD (NEW ORDER)
"RTN","PSJUTL",141,0)
 ; INFO (piece 2) = STOP DATE/TIME       ;PSGNEFD (NEW ORDER)
"RTN","PSJUTL",142,0)
 ; INFO (piece 3) = SCHEDULE             ;PSGSCH  (NEW ORDER)
"RTN","PSJUTL",143,0)
 ; INFO (piece 4) = SCHEDULE TYPE        ;PSGST   (NEW ORDER)
"RTN","PSJUTL",144,0)
 ; INFO (piece 5) = ORDERABLE ITEM       ;PSGDRG  (NEW ORDER)
"RTN","PSJUTL",145,0)
 ; INFO (piece 6) = ADMIN TIMES          ;PSGS0Y  (NEW ORDER)
"RTN","PSJUTL",146,0)
 ; 
"RTN","PSJUTL",147,0)
EFDNEW ;Call Here if NEW or RENEWED Order
"RTN","PSJUTL",148,0)
 N INFO
"RTN","PSJUTL",149,0)
 S INFO=($G(PSGNESD))_U_($G(PSGNEFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGDRG))_U_($G(PSGS0Y))
"RTN","PSJUTL",150,0)
 D EFDDISP
"RTN","PSJUTL",151,0)
 QUIT
"RTN","PSJUTL",152,0)
EFDACT ;Call here if Editing Fields for an ACTIVE order
"RTN","PSJUTL",153,0)
 ; Field 10 = Start Date
"RTN","PSJUTL",154,0)
 ; Field 34 = Stop Date
"RTN","PSJUTL",155,0)
 ; Field 41 = Admin Times
"RTN","PSJUTL",156,0)
 N INFO,KEY,ORDER,LAST
"RTN","PSJUTL",157,0)
 ;Loop Fields to be edited, in order, and determine when to Display expected first dose message
"RTN","PSJUTL",158,0)
 F KEY=1:1 S ORDER=$P(PSGOEER,";",KEY) Q:'$L(ORDER)  I "10^34^41"[$P(ORDER,U,1) S ORDER(KEY)=$P(ORDER,U,1)
"RTN","PSJUTL",159,0)
 ;If there are no entries in ORDER, then were Not Editing Start/Stop or Admin Times
"RTN","PSJUTL",160,0)
 S LAST=$O(ORDER(99),-1) Q:'LAST
"RTN","PSJUTL",161,0)
 ;Only display EFD once, so Quit if this call is not for the Last field in the Edit
"RTN","PSJUTL",162,0)
 S LAST=ORDER(LAST)
"RTN","PSJUTL",163,0)
 I LAST'=PSGF2 Q
"RTN","PSJUTL",164,0)
 S INFO=($G(PSGSD))_U_($G(PSGFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGPDRG))_U_($G(PSGS0Y))
"RTN","PSJUTL",165,0)
 D EFDDISP
"RTN","PSJUTL",166,0)
 QUIT
"RTN","PSJUTL",167,0)
EFDNV ;Call here if Editing Fields for a NON-VERIFIED order
"RTN","PSJUTL",168,0)
 ; Field 10 = Start Date
"RTN","PSJUTL",169,0)
 ; Field 25 = Stop Date
"RTN","PSJUTL",170,0)
 ; Field 39 = Admin Times
"RTN","PSJUTL",171,0)
 N INFO,KEY,ORDER,LAST
"RTN","PSJUTL",172,0)
 ;Check if called during finish process
"RTN","PSJUTL",173,0)
 I '$D(PSGOEER) D  D EFDDISP Q
"RTN","PSJUTL",174,0)
 . S INFO=($G(PSGNESD))_U_($G(PSGNEFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGPDRG))_U_($G(PSGS0Y))
"RTN","PSJUTL",175,0)
 . Q
"RTN","PSJUTL",176,0)
 ;Loop Fields to be edited, in order, and determine when to Display expected first dose message
"RTN","PSJUTL",177,0)
 F KEY=1:1 S ORDER=$P(PSGOEER,";",KEY) Q:'$L(ORDER)  I "10^25^39"[$P(ORDER,U,1) S ORDER(KEY)=$P(ORDER,U,1)
"RTN","PSJUTL",178,0)
 ;If there are no entries in ORDER, then were Not Editing Start/Stop or Admin Times
"RTN","PSJUTL",179,0)
 S LAST=$O(ORDER(99),-1) Q:'LAST
"RTN","PSJUTL",180,0)
 ;Only display EFD once, so Quit if this call is not for the Last field in the Edit
"RTN","PSJUTL",181,0)
 S LAST=ORDER(LAST)
"RTN","PSJUTL",182,0)
 I LAST'=PSGF2 Q
"RTN","PSJUTL",183,0)
 S INFO=($G(PSGSD))_U_($G(PSGFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGPDRG))_U_($G(PSGS0Y))
"RTN","PSJUTL",184,0)
 D EFDDISP
"RTN","PSJUTL",185,0)
 QUIT
"RTN","PSJUTL",186,0)
EFDIV(PSGZZND) ;Set variables for EFD on IV orders.
"RTN","PSJUTL",187,0)
 I $G(PSGZZND)="" D
"RTN","PSJUTL",188,0)
 .N X,ZZND,LYN,PSGS0XT,PSGS0Y,PSGOES S PSGOES=1 S X=P(9) D EN^PSGS0 S:$G(ZZND)'="" PSGZZND=ZZND
"RTN","PSJUTL",189,0)
 S PSGNESD=P(2),PSGNEFD=P(3),PSGSCH=P(9),PSGST=$P($G(PSGZZND),"^",5),PSGDRG=$P($G(P("PD")),"^"),PSGS0Y=P(11)
"RTN","PSJUTL",190,0)
 ;BHW - PSJ*5*177 Add call to check stop date.  If it's in the past, Display Message
"RTN","PSJUTL",191,0)
 D CHKSTOP
"RTN","PSJUTL",192,0)
 D EFDNEW
"RTN","PSJUTL",193,0)
 W !
"RTN","PSJUTL",194,0)
 Q
"RTN","PSJUTL",195,0)
EFDDISP ;Display Expected First Dose
"RTN","PSJUTL",196,0)
 N Y,Z
"RTN","PSJUTL",197,0)
 Q:$G(PSGST)="OC"!($G(PSGST)="P")!($G(PSGST)="O")
"RTN","PSJUTL",198,0)
 Q:$G(PSGSCH)["ON CALL"!($G(PSGSCH)["ON-CALL")!($G(PSGSCH)["ONCALL")
"RTN","PSJUTL",199,0)
 Q:$G(PSGSCH)["PRN"
"RTN","PSJUTL",200,0)
 I '$L($G(PSGP)) N PSGP S PSGP=""
"RTN","PSJUTL",201,0)
 S Y=$$ENQ^PSJORP2(PSGP,INFO)
"RTN","PSJUTL",202,0)
 I 'Y S Y="Unable to Calculate"
"RTN","PSJUTL",203,0)
 X ^DD("DD")
"RTN","PSJUTL",204,0)
 W !,"Expected First Dose: ",Y H 2
"RTN","PSJUTL",205,0)
 Q
"RTN","PSJUTL",206,0)
CHKSTOP ;BHW - PSJ*5*177 Warn user if the Stop Date is < now.
"RTN","PSJUTL",207,0)
 I '+$G(P(3)) Q
"RTN","PSJUTL",208,0)
 N PSNOW,%,%H,%I,X D NOW^%DTC S PSNOW=%
"RTN","PSJUTL",209,0)
 I +P(3)<PSNOW D  Q
"RTN","PSJUTL",210,0)
 . W !,$C(7),"The Stop Date/Time is in the Past!!!  This order will",!,"automatically EXPIRE upon Verification!!",!
"RTN","PSJUTL",211,0)
 . Q
"RTN","PSJUTL",212,0)
 Q
"VER")
8.0^22.0
"^DD",53.1,53.1,128,0)
IV TYPE CATEGORY^S^I:INTERMITTENT;C:CONTINUOUS;^2.5;5^Q
"^DD",53.1,53.1,128,21,0)
^^9^9^3071020^
"^DD",53.1,53.1,128,21,1,0)
This field contains the category of the order's IV TYPE. 
"^DD",53.1,53.1,128,21,2,0)
 
"^DD",53.1,53.1,128,21,3,0)
The IV TYPE CATEGORY will be "C" (Continuous) for orders with an IV TYPE
"^DD",53.1,53.1,128,21,4,0)
of Admixture, Hyperal, Non-Intermittent Syringe, or Chemotherapy with a 
"^DD",53.1,53.1,128,21,5,0)
CHEMOTHERAPY TYPE of Admixture, Hyperal, or Non-Intermittent Syringe.
"^DD",53.1,53.1,128,21,6,0)
 
"^DD",53.1,53.1,128,21,7,0)
The IV TYPE CATEGORY will be "I" (Intermittent) for orders with an IV 
"^DD",53.1,53.1,128,21,8,0)
TYPE of Piggyback, Intermittent Syringe, or Chemotherapy with a 
"^DD",53.1,53.1,128,21,9,0)
CHEMOTHERAPY TYPE of Piggyback or Intermittent Syringe.
"^DD",53.1,53.1,128,"DT")
3071020
**INSTALL NAME**
PSO*7.0*225
"BLD",17840,0)
PSO*7.0*225^OUTPATIENT PHARMACY^0^3080618^y
"BLD",17840,1,0)
^^156^156^3080222^
"BLD",17840,1,1,0)
The Enrollment VistA Changes (EVC) project is being undertaken to support
"BLD",17840,1,2,0)
technology and business changes that are occurring with the implementation
"BLD",17840,1,3,0)
of the Health Eligibility Center (HEC) Enrollment System Redesign (ESR)
"BLD",17840,1,4,0)
project. Some modified and new business functionality is being included in
"BLD",17840,1,5,0)
the new system and corresponding changes are necessary in VistA for
"BLD",17840,1,6,0)
preliminary determination of veterans Enrollment and Eligibility status.
"BLD",17840,1,7,0)
The EVC project has been rolled out in three phases. This release
"BLD",17840,1,8,0)
represents the third and last phase called EVC Release 2.
"BLD",17840,1,9,0)
 
"BLD",17840,1,10,0)
This patch provides the functionality changes to determine, process and
"BLD",17840,1,11,0)
disseminate the newly added Environmental Indicator (EI) called Project
"BLD",17840,1,12,0)
112/SHAD Exposure (a.k.a SHAD), where applicable.
"BLD",17840,1,13,0)
 
"BLD",17840,1,14,0)
This patch also changed the EI, "Environmental Contaminant" to read
"BLD",17840,1,15,0)
as "Southwest Asia Conditions".
"BLD",17840,1,16,0)
 
"BLD",17840,1,17,0)
 1. For the following options, when creating a new order, renewing an
"BLD",17840,1,18,0)
    existing order, copying an existing order to a new order, or editing
"BLD",17840,1,19,0)
    an existing order that results in a new order, the copay status of the
"BLD",17840,1,20,0)
    prescription needs to be determined for billing purposes.
"BLD",17840,1,21,0)
 
"BLD",17840,1,22,0)
    a. Patient Prescription Processing [PSO LM BACKDOOR ORDERS]
"BLD",17840,1,23,0)
    b. Barcode Batch Prescription Entry [PSO BATCH BARCODE]
"BLD",17840,1,24,0)
    c. Complete Orders from OERR [PSO LMOE FINISH]
"BLD",17840,1,25,0)
 
"BLD",17840,1,26,0)
   If a patient is found eligible for SHAD then the prompt
"BLD",17840,1,27,0)
   "Was treatment related to PROJ 112/SHAD?" will be presented to the
"BLD",17840,1,28,0)
   pharmacist.
"BLD",17840,1,29,0)
 
"BLD",17840,1,30,0)
   A "YES" or "NO" response will be stored in the new fields, PROJ
"BLD",17840,1,31,0)
   112/SHAD field (#122.01) of the PRESCRIPTION file (#52) and in the PROJ
"BLD",17840,1,32,0)
   112/SHAD field (#8) of the ICD DIAGNOSIS sub-file (#52.052311) of the
"BLD",17840,1,33,0)
   PRESCRIPTION file (#52).
"BLD",17840,1,34,0)
 
"BLD",17840,1,35,0)
 2. The Integration Control Registration (ICR) #2534, provides
"BLD",17840,1,36,0)
    Computerized Patient Record System V. 3.0 (CPRS) with all the eligible
"BLD",17840,1,37,0)
    EI questions that will be prompted during the pharmacy order entry
"BLD",17840,1,38,0)
    process. This ICR is modified to include the SHAD prompt.
"BLD",17840,1,39,0)
 
"BLD",17840,1,40,0)
 3. When a verbal or telephone order is placed in backdoor pharmacy, it
"BLD",17840,1,41,0)
    requires an electronic signature from the provider. During the
"BLD",17840,1,42,0)
    signature entry process in CPRS, the provider may update the SC, EI,
"BLD",17840,1,43,0)
    or the ICD diagnosis information. This updated information is passed
"BLD",17840,1,44,0)
    back to pharmacy via the ICR #4666, which is modified to include the
"BLD",17840,1,45,0)
    SHAD changes.
"BLD",17840,1,46,0)
 
"BLD",17840,1,47,0)
 4. The PENDING OUTPATIENT ORDERS file (#52.41) that stores the pharmacy
"BLD",17840,1,48,0)
    orders entered via CPRS is modified to include the provider's response
"BLD",17840,1,49,0)
    to the SHAD question. The provider's response will be stored in the
"BLD",17840,1,50,0)
    new fields, PROJ 112/SHAD field (#110.2) of the PENDING OUTPATIENT
"BLD",17840,1,51,0)
    ORDERS file (#52.41) and the PROJ 112/SHAD field (#8) of the DIAGNOSIS
"BLD",17840,1,52,0)
    sub-file (#52.41311) of the PENDING OUTPATIENT ORDERS file (#52.41).
"BLD",17840,1,53,0)
 
"BLD",17840,1,54,0)
 5. During the release of a prescription, if the SHAD question applies and
"BLD",17840,1,55,0)
    is unanswered, the MailMan message that is sent to the finishing
"BLD",17840,1,56,0)
    pharmacist, ordering provider, and holders of the PSO COPAY key, to
"BLD",17840,1,57,0)
    get answers to the EI questions will have the SHAD question if
"BLD",17840,1,58,0)
    applicable.
"BLD",17840,1,59,0)
 
"BLD",17840,1,60,0)
 6. The Reset Copay Status/Cancel Charges [PSOCP RESET COPAY STATUS]
"BLD",17840,1,61,0)
    option is modified to include the SHAD question wherever applicable.
"BLD",17840,1,62,0)
 
"BLD",17840,1,63,0)
 7. During label printing, if the prescription is flagged as SHAD then the
"BLD",17840,1,64,0)
    text "NO COPAY" will be printed in the label.
"BLD",17840,1,65,0)
 
"BLD",17840,1,66,0)
Unrelated to the Enrollment VistA Changes (EVC) features, this patch also
"BLD",17840,1,67,0)
provides the following changes to support CPRS v27.
"BLD",17840,1,68,0)
 
"BLD",17840,1,69,0)
 a. To add the proper escape sequences to the standard HEALTH LEVEL
"BLD",17840,1,70,0)
    SEVEN (HL7) encoding characters to messages sent to CPRS / remove
"BLD",17840,1,71,0)
    escape sequences received from CPRS and replace them with standard HL7
"BLD",17840,1,72,0)
    encoding characters. This will help avoid errors that can occur if
"BLD",17840,1,73,0)
    special delimiting characters are encountered during parsing of the
"BLD",17840,1,74,0)
    HL7 messages.
"BLD",17840,1,75,0)
 
"BLD",17840,1,76,0)
 b. Integration Control Registration (ICR) #2400, will be modified to
"BLD",17840,1,77,0)
    provide new sorting sequences of the patient medication profile that
"BLD",17840,1,78,0)
    is viewed under the CPRS-Meds Tab including the Non-VA medications.
"BLD",17840,1,79,0)
 
"BLD",17840,1,80,0)
    VIEW 0 or null - This provides the medication list as it was prior to
"BLD",17840,1,81,0)
             GUI 27 so that other applications calling this API will not
"BLD",17840,1,82,0)
             see any changes.
"BLD",17840,1,83,0)
    VIEW 1 - This provides the medication list sorted by prescription
"BLD",17840,1,84,0)
             Status Group and Stop Date/Expiration Date. Following is the
"BLD",17840,1,85,0)
             order:
"BLD",17840,1,86,0)
            Pending group
"BLD",17840,1,87,0)
              Non-Verified
"BLD",17840,1,88,0)
              Pending
"BLD",17840,1,89,0)
            Active group:
"BLD",17840,1,90,0)
              Active
"BLD",17840,1,91,0)
              Hold
"BLD",17840,1,92,0)
              Suspended (Active/Susp)
"BLD",17840,1,93,0)
              Provider Hold
"BLD",17840,1,94,0)
            Expired group
"BLD",17840,1,95,0)
              Expired
"BLD",17840,1,96,0)
            Discontinued/Deleted group
"BLD",17840,1,97,0)
              Discontinued by Provider
"BLD",17840,1,98,0)
              Discontinued (Edit)
"BLD",17840,1,99,0)
 
"BLD",17840,1,100,0)
    VIEW 2 - This provides the medication list sorted by prescription
"BLD",17840,1,101,0)
             Status Group, Status, and Drug Name.
"BLD",17840,1,102,0)
            Active group:
"BLD",17840,1,103,0)
              Active
"BLD",17840,1,104,0)
              Hold
"BLD",17840,1,105,0)
            Pending group
"BLD",17840,1,106,0)
              Non-Verified
"BLD",17840,1,107,0)
              Pending
"BLD",17840,1,108,0)
            Discontinued
"BLD",17840,1,109,0)
              Discontinued by Provider
"BLD",17840,1,110,0)
              Discontinued (Edit)
"BLD",17840,1,111,0)
 
"BLD",17840,1,112,0)
    VIEW 3 - This provides the medication list sorted by Drug Name,
"BLD",17840,1,113,0)
           active/suspended and Stop Date/Expiration Date.
"BLD",17840,1,114,0)
 
"BLD",17840,1,115,0)
 c. Flag/Un-Flag functionality (PSI-06-041)
"BLD",17840,1,116,0)
    It was requested in the Remedy ticket #133716 that the flagging
"BLD",17840,1,117,0)
    capability that is available in CPRS be made available for
"BLD",17840,1,118,0)
    Outpatient Pharmacy use. This patch provides the flagging
"BLD",17840,1,119,0)
    functionality for Pending orders only.
"BLD",17840,1,120,0)
 
"BLD",17840,1,121,0)
 d. As per the E3R numbers 19973 and 19876, to improve communication
"BLD",17840,1,122,0)
    between the provider and the pharmacist, Outpatient Pharmacy will now
"BLD",17840,1,123,0)
    send the actual comments made by the pharmacist to CPRS when a
"BLD",17840,1,124,0)
    prescription is put on Hold, Discontinued, and Returned to Stock
"BLD",17840,1,125,0)
    replacing the generic "per pharmacy request" text.
"BLD",17840,1,126,0)
 
"BLD",17840,1,127,0)
 e. When the DC-Discontinue ListMan option is used to discontinue a
"BLD",17840,1,128,0)
    pending "renewal" order, the software will now check for an active
"BLD",17840,1,129,0)
    prescription for the same drug. If found it will prompt the following:
"BLD",17840,1,130,0)
    "There is an active Rx for this pending order, Discontinue both
"BLD",17840,1,131,0)
    (Y/N)".
"BLD",17840,1,132,0)
    This will provide the user with the option to discontinue both pending
"BLD",17840,1,133,0)
    and the active order.
"BLD",17840,1,134,0)
 
"BLD",17840,1,135,0)
 f. A problem was reported in one of the error messages displayed on CPRS
"BLD",17840,1,136,0)
    side when a provider tries to discontinue an Outpatient Pharmacy
"BLD",17840,1,137,0)
    order from the Orders Tab and that order for some reason is
"BLD",17840,1,138,0)
    not found in the PRESCRIPTION file (#52). The solution provided is to
"BLD",17840,1,139,0)
    replace the error message "Unable to locate order" with "Invalid
"BLD",17840,1,140,0)
    Pharmacy order number" to be in consistent with the Inpatient
"BLD",17840,1,141,0)
    Medications V. 5.0 error messages.
"BLD",17840,1,142,0)
 
"BLD",17840,1,143,0)
 g. At the request of CPRS active calls to obsolete routine OR3CONV have
"BLD",17840,1,144,0)
    been removed from Outpatient Pharmacy V. 7.0.
"BLD",17840,1,145,0)
 
"BLD",17840,1,146,0)
 h. When finishing a pending order placed in CPRS, it was reported that
"BLD",17840,1,147,0)
    the patient instructions sent across to CPRS was getting truncated.
"BLD",17840,1,148,0)
    This patch fixes the problem.
"BLD",17840,1,149,0)
 
"BLD",17840,1,150,0)
 i. PSI-07-057 - Potential of inappropriate or misleading provider
"BLD",17840,1,151,0)
    comments to be automatically included on new medication orders.
"BLD",17840,1,152,0)
    To fix this problem CPRS is dropping (will not carry over) the
"BLD",17840,1,153,0)
    original provider comments during renewals of Outpatient Pharmacy
"BLD",17840,1,154,0)
    medications.
"BLD",17840,1,155,0)
    To follow suit with CPRS, Outpatient Pharmacy is also dropping the
"BLD",17840,1,156,0)
    original provider comments from all backdoor renewals.
"BLD",17840,4,0)
^9.64PA^52.41^2
"BLD",17840,4,52,0)
52
"BLD",17840,4,52,2,0)
^9.641^52.052311^2
"BLD",17840,4,52,2,52,0)
PRESCRIPTION  (File-top level)
"BLD",17840,4,52,2,52,1,0)
^9.6411^120^2
"BLD",17840,4,52,2,52,1,120,0)
SOUTHWEST ASIA CONDITIONS
"BLD",17840,4,52,2,52,1,122.01,0)
PROJ 112/SHAD
"BLD",17840,4,52,2,52.052311,0)
ICD DIAGNOSIS  (sub-file)
"BLD",17840,4,52,2,52.052311,1,0)
^9.6411^4^2
"BLD",17840,4,52,2,52.052311,1,4,0)
SOUTHWEST ASIA CONDITIONS
"BLD",17840,4,52,2,52.052311,1,8,0)
PROJ 112/SHAD
"BLD",17840,4,52,222)
y^y^p^^^^n^^n
"BLD",17840,4,52,224)

"BLD",17840,4,52.41,0)
52.41
"BLD",17840,4,52.41,2,0)
^9.641^52.41311^2
"BLD",17840,4,52.41,2,52.41,0)
PENDING OUTPATIENT ORDERS  (File-top level)
"BLD",17840,4,52.41,2,52.41,1,0)
^9.6411^38^8
"BLD",17840,4,52.41,2,52.41,1,33,0)
DATE/TIME FLAGGED
"BLD",17840,4,52.41,2,52.41,1,34,0)
FLAGGED BY
"BLD",17840,4,52.41,2,52.41,1,35,0)
REASON FOR FLAG
"BLD",17840,4,52.41,2,52.41,1,36,0)
DATE/TIME UNFLAGGED
"BLD",17840,4,52.41,2,52.41,1,37,0)
UNFLAGGED BY
"BLD",17840,4,52.41,2,52.41,1,38,0)
REASON FOR UNFLAG
"BLD",17840,4,52.41,2,52.41,1,109,0)
SOUTHWEST ASIA CONDITIONS
"BLD",17840,4,52.41,2,52.41,1,110.2,0)
PROJ 112/SHAD
"BLD",17840,4,52.41,2,52.41311,0)
DIAGNOSIS  (sub-file)
"BLD",17840,4,52.41,2,52.41311,1,0)
^9.6411^4^2
"BLD",17840,4,52.41,2,52.41311,1,4,0)
SOUTHWEST ASIA CONDITIONS
"BLD",17840,4,52.41,2,52.41311,1,8,0)
PROJ 112/SHAD
"BLD",17840,4,52.41,222)
y^y^p^^^^n^^n
"BLD",17840,4,52.41,224)

"BLD",17840,4,"APDD",52,52)

"BLD",17840,4,"APDD",52,52,120)

"BLD",17840,4,"APDD",52,52,122.01)

"BLD",17840,4,"APDD",52,52.052311)

"BLD",17840,4,"APDD",52,52.052311,4)

"BLD",17840,4,"APDD",52,52.052311,8)

"BLD",17840,4,"APDD",52.41,52.41)

"BLD",17840,4,"APDD",52.41,52.41,33)

"BLD",17840,4,"APDD",52.41,52.41,34)

"BLD",17840,4,"APDD",52.41,52.41,35)

"BLD",17840,4,"APDD",52.41,52.41,36)

"BLD",17840,4,"APDD",52.41,52.41,37)

"BLD",17840,4,"APDD",52.41,52.41,38)

"BLD",17840,4,"APDD",52.41,52.41,109)

"BLD",17840,4,"APDD",52.41,52.41,110.2)

"BLD",17840,4,"APDD",52.41,52.41311)

"BLD",17840,4,"APDD",52.41,52.41311,4)

"BLD",17840,4,"APDD",52.41,52.41311,8)

"BLD",17840,4,"B",52,52)

"BLD",17840,4,"B",52.41,52.41)

"BLD",17840,6.3)
29
"BLD",17840,"KRN",0)
^9.67PA^8989.52^19
"BLD",17840,"KRN",.4,0)
.4
"BLD",17840,"KRN",.401,0)
.401
"BLD",17840,"KRN",.402,0)
.402
"BLD",17840,"KRN",.403,0)
.403
"BLD",17840,"KRN",.5,0)
.5
"BLD",17840,"KRN",.84,0)
.84
"BLD",17840,"KRN",3.6,0)
3.6
"BLD",17840,"KRN",3.8,0)
3.8
"BLD",17840,"KRN",9.2,0)
9.2
"BLD",17840,"KRN",9.8,0)
9.8
"BLD",17840,"KRN",9.8,"NM",0)
^9.68A^71^65
"BLD",17840,"KRN",9.8,"NM",1,0)
PSOCP^^0^B67321239
"BLD",17840,"KRN",9.8,"NM",2,0)
PSOCPC^^0^B74796456
"BLD",17840,"KRN",9.8,"NM",3,0)
PSOCPE^^0^B80668529
"BLD",17840,"KRN",9.8,"NM",4,0)
PSOHLNE1^^0^B73330251
"BLD",17840,"KRN",9.8,"NM",6,0)
PSOHLSNC^^0^B54704997
"BLD",17840,"KRN",9.8,"NM",7,0)
PSOLBL^^0^B63143813
"BLD",17840,"KRN",9.8,"NM",8,0)
PSOLLLI^^0^B66409595
"BLD",17840,"KRN",9.8,"NM",10,0)
PSON52^^0^B62785056
"BLD",17840,"KRN",9.8,"NM",14,0)
PSOPTPST^^0^B27932490
"BLD",17840,"KRN",9.8,"NM",15,0)
PSORENW1^^0^B60533620
"BLD",17840,"KRN",9.8,"NM",16,0)
PSORN52^^0^B46207711
"BLD",17840,"KRN",9.8,"NM",17,0)
PSORN52A^^0^B18565756
"BLD",17840,"KRN",9.8,"NM",18,0)
PSORN52D^^0^B41922848
"BLD",17840,"KRN",9.8,"NM",19,0)
PSOHLSN2^^0^B7919233
"BLD",17840,"KRN",9.8,"NM",20,0)
PSODIAG^^0^B63590551
"BLD",17840,"KRN",9.8,"NM",21,0)
PSOHLNE3^^0^B61361284
"BLD",17840,"KRN",9.8,"NM",22,0)
PSOCP1^^0^B5367762
"BLD",17840,"KRN",9.8,"NM",23,0)
PSOLBL1^^0^B29469598
"BLD",17840,"KRN",9.8,"NM",24,0)
PSOMLLD2^^0^B28319271
"BLD",17840,"KRN",9.8,"NM",25,0)
PSOMLLDT^^0^B86446402
"BLD",17840,"KRN",9.8,"NM",26,0)
PSOPFSU0^^0^B16719729
"BLD",17840,"KRN",9.8,"NM",27,0)
PSOPFSU1^^0^B33416502
"BLD",17840,"KRN",9.8,"NM",28,0)
PSOHLNEW^^0^B80329211
"BLD",17840,"KRN",9.8,"NM",29,0)
PSOHLSN1^^0^B71972158
"BLD",17840,"KRN",9.8,"NM",30,0)
PSOHLNE2^^0^B60250922
"BLD",17840,"KRN",9.8,"NM",31,0)
PSOHLPII^^0^B53884421
"BLD",17840,"KRN",9.8,"NM",32,0)
PSOHLPIS^^0^B64280169
"BLD",17840,"KRN",9.8,"NM",33,0)
PSOHLSN3^^0^B4822097
"BLD",17840,"KRN",9.8,"NM",34,0)
PSOORRL^^0^B64370128
"BLD",17840,"KRN",9.8,"NM",35,0)
PSOORRLN^^0^B43625961
"BLD",17840,"KRN",9.8,"NM",36,0)
PSOORRLO^^0^B39129717
"BLD",17840,"KRN",9.8,"NM",37,0)
PSOCAN3^^0^B70221168
"BLD",17840,"KRN",9.8,"NM",38,0)
PSOCAN4^^0^B42375050
"BLD",17840,"KRN",9.8,"NM",39,0)
PSOHLDA^^0^B10014334
"BLD",17840,"KRN",9.8,"NM",40,0)
PSOHLNE4^^0^B17206219
"BLD",17840,"KRN",9.8,"NM",41,0)
PSOLMAO^^0^B247627
"BLD",17840,"KRN",9.8,"NM",43,0)
PSOLMUTL^^0^B10572703
"BLD",17840,"KRN",9.8,"NM",44,0)
PSOORFI1^^0^B74027837
"BLD",17840,"KRN",9.8,"NM",45,0)
PSOORFI3^^0^B74814603
"BLD",17840,"KRN",9.8,"NM",46,0)
PSOORFI5^^0^B18224487
"BLD",17840,"KRN",9.8,"NM",47,0)
PSOORFIN^^0^B59563720
"BLD",17840,"KRN",9.8,"NM",48,0)
PSOORFL^^0^B917206
"BLD",17840,"KRN",9.8,"NM",49,0)
PSOORNE5^^0^B60780567
"BLD",17840,"KRN",9.8,"NM",50,0)
PSOORUT1^^0^B67437810
"BLD",17840,"KRN",9.8,"NM",51,0)
PSONEW^^0^B28292272
"BLD",17840,"KRN",9.8,"NM",52,0)
PSONEW2^^0^B32398190
"BLD",17840,"KRN",9.8,"NM",53,0)
PSONEWF^^0^B38013501
"BLD",17840,"KRN",9.8,"NM",54,0)
PSONEWG^^0^B25309370
"BLD",17840,"KRN",9.8,"NM",55,0)
PSOORFI2^^0^B90909677
"BLD",17840,"KRN",9.8,"NM",56,0)
PSOORFI6^^0^B23497771
"BLD",17840,"KRN",9.8,"NM",57,0)
PSOLMPO^^0^B1183408
"BLD",17840,"KRN",9.8,"NM",58,0)
PSOLMPO1^^0^B1200387
"BLD",17840,"KRN",9.8,"NM",59,0)
PSOORRL3^^0^B23985690
"BLD",17840,"KRN",9.8,"NM",60,0)
PSOORUTL^^0^B42932698
"BLD",17840,"KRN",9.8,"NM",61,0)
PSOHLUP^^0^B20030650
"BLD",17840,"KRN",9.8,"NM",62,0)
PSOCAN3N^^0^B656532
"BLD",17840,"KRN",9.8,"NM",63,0)
PSOORNEW^^0^B72157265
"BLD",17840,"KRN",9.8,"NM",64,0)
PSOCIDC2^^0^B71704423
"BLD",17840,"KRN",9.8,"NM",65,0)
PSOORNE4^^0^B68513696
"BLD",17840,"KRN",9.8,"NM",66,0)
PSOORRNW^^0^B24091362
"BLD",17840,"KRN",9.8,"NM",67,0)
PSORENW4^^0^B56219403
"BLD",17840,"KRN",9.8,"NM",68,0)
PSORN52C^^0^B49927643
"BLD",17840,"KRN",9.8,"NM",69,0)
PSONFI^^0^B9036524
"BLD",17840,"KRN",9.8,"NM",70,0)
PSOLMRN^^0^B567748
"BLD",17840,"KRN",9.8,"NM",71,0)
PSOLMPO2^^0^B590140
"BLD",17840,"KRN",9.8,"NM","B","PSOCAN3",37)

"BLD",17840,"KRN",9.8,"NM","B","PSOCAN3N",62)

"BLD",17840,"KRN",9.8,"NM","B","PSOCAN4",38)

"BLD",17840,"KRN",9.8,"NM","B","PSOCIDC2",64)

"BLD",17840,"KRN",9.8,"NM","B","PSOCP",1)

"BLD",17840,"KRN",9.8,"NM","B","PSOCP1",22)

"BLD",17840,"KRN",9.8,"NM","B","PSOCPC",2)

"BLD",17840,"KRN",9.8,"NM","B","PSOCPE",3)

"BLD",17840,"KRN",9.8,"NM","B","PSODIAG",20)

"BLD",17840,"KRN",9.8,"NM","B","PSOHLDA",39)

"BLD",17840,"KRN",9.8,"NM","B","PSOHLNE1",4)

"BLD",17840,"KRN",9.8,"NM","B","PSOHLNE2",30)

"BLD",17840,"KRN",9.8,"NM","B","PSOHLNE3",21)

"BLD",17840,"KRN",9.8,"NM","B","PSOHLNE4",40)

"BLD",17840,"KRN",9.8,"NM","B","PSOHLNEW",28)

"BLD",17840,"KRN",9.8,"NM","B","PSOHLPII",31)

"BLD",17840,"KRN",9.8,"NM","B","PSOHLPIS",32)

"BLD",17840,"KRN",9.8,"NM","B","PSOHLSN1",29)

"BLD",17840,"KRN",9.8,"NM","B","PSOHLSN2",19)

"BLD",17840,"KRN",9.8,"NM","B","PSOHLSN3",33)

"BLD",17840,"KRN",9.8,"NM","B","PSOHLSNC",6)

"BLD",17840,"KRN",9.8,"NM","B","PSOHLUP",61)

"BLD",17840,"KRN",9.8,"NM","B","PSOLBL",7)

"BLD",17840,"KRN",9.8,"NM","B","PSOLBL1",23)

"BLD",17840,"KRN",9.8,"NM","B","PSOLLLI",8)

"BLD",17840,"KRN",9.8,"NM","B","PSOLMAO",41)

"BLD",17840,"KRN",9.8,"NM","B","PSOLMPO",57)

"BLD",17840,"KRN",9.8,"NM","B","PSOLMPO1",58)

"BLD",17840,"KRN",9.8,"NM","B","PSOLMPO2",71)

"BLD",17840,"KRN",9.8,"NM","B","PSOLMRN",70)

"BLD",17840,"KRN",9.8,"NM","B","PSOLMUTL",43)

"BLD",17840,"KRN",9.8,"NM","B","PSOMLLD2",24)

"BLD",17840,"KRN",9.8,"NM","B","PSOMLLDT",25)

"BLD",17840,"KRN",9.8,"NM","B","PSON52",10)

"BLD",17840,"KRN",9.8,"NM","B","PSONEW",51)

"BLD",17840,"KRN",9.8,"NM","B","PSONEW2",52)

"BLD",17840,"KRN",9.8,"NM","B","PSONEWF",53)

"BLD",17840,"KRN",9.8,"NM","B","PSONEWG",54)

"BLD",17840,"KRN",9.8,"NM","B","PSONFI",69)

"BLD",17840,"KRN",9.8,"NM","B","PSOORFI1",44)

"BLD",17840,"KRN",9.8,"NM","B","PSOORFI2",55)

"BLD",17840,"KRN",9.8,"NM","B","PSOORFI3",45)

"BLD",17840,"KRN",9.8,"NM","B","PSOORFI5",46)

"BLD",17840,"KRN",9.8,"NM","B","PSOORFI6",56)

"BLD",17840,"KRN",9.8,"NM","B","PSOORFIN",47)

"BLD",17840,"KRN",9.8,"NM","B","PSOORFL",48)

"BLD",17840,"KRN",9.8,"NM","B","PSOORNE4",65)

"BLD",17840,"KRN",9.8,"NM","B","PSOORNE5",49)

"BLD",17840,"KRN",9.8,"NM","B","PSOORNEW",63)

"BLD",17840,"KRN",9.8,"NM","B","PSOORRL",34)

"BLD",17840,"KRN",9.8,"NM","B","PSOORRL3",59)

"BLD",17840,"KRN",9.8,"NM","B","PSOORRLN",35)

"BLD",17840,"KRN",9.8,"NM","B","PSOORRLO",36)

"BLD",17840,"KRN",9.8,"NM","B","PSOORRNW",66)

"BLD",17840,"KRN",9.8,"NM","B","PSOORUT1",50)

"BLD",17840,"KRN",9.8,"NM","B","PSOORUTL",60)

"BLD",17840,"KRN",9.8,"NM","B","PSOPFSU0",26)

"BLD",17840,"KRN",9.8,"NM","B","PSOPFSU1",27)

"BLD",17840,"KRN",9.8,"NM","B","PSOPTPST",14)

"BLD",17840,"KRN",9.8,"NM","B","PSORENW1",15)

"BLD",17840,"KRN",9.8,"NM","B","PSORENW4",67)

"BLD",17840,"KRN",9.8,"NM","B","PSORN52",16)

"BLD",17840,"KRN",9.8,"NM","B","PSORN52A",17)

"BLD",17840,"KRN",9.8,"NM","B","PSORN52C",68)

"BLD",17840,"KRN",9.8,"NM","B","PSORN52D",18)

"BLD",17840,"KRN",19,0)
19
"BLD",17840,"KRN",19,"NM",0)
^9.68A^^
"BLD",17840,"KRN",19.1,0)
19.1
"BLD",17840,"KRN",101,0)
101
"BLD",17840,"KRN",101,"NM",0)
^9.68A^4^4
"BLD",17840,"KRN",101,"NM",1,0)
PSO LM BACKDOOR SELECT ORDER^^0
"BLD",17840,"KRN",101,"NM",2,0)
PSO LM FLAG^^0
"BLD",17840,"KRN",101,"NM",3,0)
PSO LM NEW SELECT ORDER^^0
"BLD",17840,"KRN",101,"NM",4,0)
PSO PENDING ORDER MENU^^3
"BLD",17840,"KRN",101,"NM","B","PSO LM BACKDOOR SELECT ORDER",1)

"BLD",17840,"KRN",101,"NM","B","PSO LM FLAG",2)

"BLD",17840,"KRN",101,"NM","B","PSO LM NEW SELECT ORDER",3)

"BLD",17840,"KRN",101,"NM","B","PSO PENDING ORDER MENU",4)

"BLD",17840,"KRN",409.61,0)
409.61
"BLD",17840,"KRN",409.61,"NM",0)
^9.68A^1^1
"BLD",17840,"KRN",409.61,"NM",1,0)
PSO LM PENDING ORDER^^0
"BLD",17840,"KRN",409.61,"NM","B","PSO LM PENDING ORDER",1)

"BLD",17840,"KRN",771,0)
771
"BLD",17840,"KRN",870,0)
870
"BLD",17840,"KRN",8989.51,0)
8989.51
"BLD",17840,"KRN",8989.52,0)
8989.52
"BLD",17840,"KRN",8994,0)
8994
"BLD",17840,"KRN","B",.4,.4)

"BLD",17840,"KRN","B",.401,.401)

"BLD",17840,"KRN","B",.402,.402)

"BLD",17840,"KRN","B",.403,.403)

"BLD",17840,"KRN","B",.5,.5)

"BLD",17840,"KRN","B",.84,.84)

"BLD",17840,"KRN","B",3.6,3.6)

"BLD",17840,"KRN","B",3.8,3.8)

"BLD",17840,"KRN","B",9.2,9.2)

"BLD",17840,"KRN","B",9.8,9.8)

"BLD",17840,"KRN","B",19,19)

"BLD",17840,"KRN","B",19.1,19.1)

"BLD",17840,"KRN","B",101,101)

"BLD",17840,"KRN","B",409.61,409.61)

"BLD",17840,"KRN","B",771,771)

"BLD",17840,"KRN","B",870,870)

"BLD",17840,"KRN","B",8989.51,8989.51)

"BLD",17840,"KRN","B",8989.52,8989.52)

"BLD",17840,"KRN","B",8994,8994)

"BLD",17840,"QUES",0)
^9.62^^
"BLD",17840,"REQB",0)
^9.611^8^6
"BLD",17840,"REQB",2,0)
PSO*7.0*278^2
"BLD",17840,"REQB",4,0)
PSO*7.0*292^2
"BLD",17840,"REQB",5,0)
PSO*7.0*264^2
"BLD",17840,"REQB",6,0)
PSO*7.0*206^2
"BLD",17840,"REQB",7,0)
PSO*7.0*274^2
"BLD",17840,"REQB",8,0)
PSO*7.0*275^2
"BLD",17840,"REQB","B","PSO*7.0*206",6)

"BLD",17840,"REQB","B","PSO*7.0*264",5)

"BLD",17840,"REQB","B","PSO*7.0*274",7)

"BLD",17840,"REQB","B","PSO*7.0*275",8)

"BLD",17840,"REQB","B","PSO*7.0*278",2)

"BLD",17840,"REQB","B","PSO*7.0*292",4)

"FIA",52)
PRESCRIPTION
"FIA",52,0)
^PSRX(
"FIA",52,0,0)
52Is
"FIA",52,0,1)
y^y^p^^^^n^^n
"FIA",52,0,10)

"FIA",52,0,11)

"FIA",52,0,"RLRO")

"FIA",52,0,"VR")
7.0^PSO
"FIA",52,52)
1
"FIA",52,52,120)

"FIA",52,52,122.01)

"FIA",52,52.052311)
1
"FIA",52,52.052311,4)

"FIA",52,52.052311,8)

"FIA",52.41)
PENDING OUTPATIENT ORDERS
"FIA",52.41,0)
^PS(52.41,
"FIA",52.41,0,0)
52.41I
"FIA",52.41,0,1)
y^y^p^^^^n^^n
"FIA",52.41,0,10)

"FIA",52.41,0,11)

"FIA",52.41,0,"RLRO")

"FIA",52.41,0,"VR")
7.0^PSO
"FIA",52.41,52.41)
1
"FIA",52.41,52.41,33)

"FIA",52.41,52.41,34)

"FIA",52.41,52.41,35)

"FIA",52.41,52.41,36)

"FIA",52.41,52.41,37)

"FIA",52.41,52.41,38)

"FIA",52.41,52.41,109)

"FIA",52.41,52.41,110.2)

"FIA",52.41,52.41311)
1
"FIA",52.41,52.41311,4)

"FIA",52.41,52.41311,8)

"KRN",101,4125,-1)
0^1
"KRN",101,4125,0)
PSO LM BACKDOOR SELECT ORDER^Select Order^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,4125,15)
D BLD^PSOORUT1,RV^PSOORFL
"KRN",101,4125,20)
D SEL^PSOORNE2
"KRN",101,4125,99)
61129,52792
"KRN",101,4133,-1)
3^4
"KRN",101,4133,0)
PSO PENDING ORDER MENU^PENDING ORDER MENU^^M^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,4133,4)
25^4
"KRN",101,4133,10,0)
^101.01PA^5^5
"KRN",101,4133,10,5,0)
5947^FL^31^
"KRN",101,4133,10,5,"^")
PSO LM FLAG
"KRN",101,4133,15)

"KRN",101,4133,24)
I $$ACTIONS1^PSOLMUTL
"KRN",101,4133,26)
D A^PSOORUT3,SHOW^VALM S:$G(PSOACT)["E" XQORM("#")=$O(^ORD(101,"B","PSO LM PENDING EDIT",0))_"^1:15"
"KRN",101,4133,28)

"KRN",101,4133,99)
61129,52792
"KRN",101,4153,-1)
0^3
"KRN",101,4153,0)
PSO LM NEW SELECT ORDER^SELECT ORDER BY NUMBER^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,4153,15)
D BLD^PSOORUT1,RV^PSOORFL
"KRN",101,4153,20)
D NEWSEL^PSOLMUTL
"KRN",101,4153,99)
61129,52792
"KRN",101,5947,-1)
0^2
"KRN",101,5947,0)
PSO LM FLAG^Flag/Unflag^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,5947,1,0)
^101.06^2^2^3080228^^^^
"KRN",101,5947,1,1,0)
This option allows the user to flag/unflag an Outpatient Pharmacy 
"KRN",101,5947,1,2,0)
prescription.
"KRN",101,5947,2,0)
^101.02A^1^1
"KRN",101,5947,2,1,0)
FL
"KRN",101,5947,2,"B","FL",1)

"KRN",101,5947,15)

"KRN",101,5947,20)
D FLAG^PSOORFL
"KRN",101,5947,99)
61129,52792
"KRN",409.61,389,-1)
0^1
"KRN",409.61,389,0)
PSO LM PENDING ORDER^1^^80^6^20^1^1^^PSO PENDING ORDER MENU^Pending Orders^1^^1
"KRN",409.61,389,1)
^PSO HIDDEN ACTIONS #3
"KRN",409.61,389,"ARRAY")
 ^TMP("PSOPO",$J)
"KRN",409.61,389,"FNL")
D EXIT^PSOLMPO
"KRN",409.61,389,"HDR")
D HDR^PSOLMPO
"KRN",409.61,389,"HLP")
D HELP^PSOLMPO
"KRN",409.61,389,"INIT")
D INIT^PSOLMPO
"MBREQ")
1
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"PKG",15,-1)
1^1
"PKG",15,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",15,22,0)
^9.49I^1^1
"PKG",15,22,1,0)
7.0^2971216^2980204^64
"PKG",15,22,1,"PAH",1,0)
225^3080618^1392
"PKG",15,22,1,"PAH",1,1,0)
^^156^156^3080618
"PKG",15,22,1,"PAH",1,1,1,0)
The Enrollment VistA Changes (EVC) project is being undertaken to support
"PKG",15,22,1,"PAH",1,1,2,0)
technology and business changes that are occurring with the implementation
"PKG",15,22,1,"PAH",1,1,3,0)
of the Health Eligibility Center (HEC) Enrollment System Redesign (ESR)
"PKG",15,22,1,"PAH",1,1,4,0)
project. Some modified and new business functionality is being included in
"PKG",15,22,1,"PAH",1,1,5,0)
the new system and corresponding changes are necessary in VistA for
"PKG",15,22,1,"PAH",1,1,6,0)
preliminary determination of veterans Enrollment and Eligibility status.
"PKG",15,22,1,"PAH",1,1,7,0)
The EVC project has been rolled out in three phases. This release
"PKG",15,22,1,"PAH",1,1,8,0)
represents the third and last phase called EVC Release 2.
"PKG",15,22,1,"PAH",1,1,9,0)
 
"PKG",15,22,1,"PAH",1,1,10,0)
This patch provides the functionality changes to determine, process and
"PKG",15,22,1,"PAH",1,1,11,0)
disseminate the newly added Environmental Indicator (EI) called Project
"PKG",15,22,1,"PAH",1,1,12,0)
112/SHAD Exposure (a.k.a SHAD), where applicable.
"PKG",15,22,1,"PAH",1,1,13,0)
 
"PKG",15,22,1,"PAH",1,1,14,0)
This patch also changed the EI, "Environmental Contaminant" to read
"PKG",15,22,1,"PAH",1,1,15,0)
as "Southwest Asia Conditions".
"PKG",15,22,1,"PAH",1,1,16,0)
 
"PKG",15,22,1,"PAH",1,1,17,0)
 1. For the following options, when creating a new order, renewing an
"PKG",15,22,1,"PAH",1,1,18,0)
    existing order, copying an existing order to a new order, or editing
"PKG",15,22,1,"PAH",1,1,19,0)
    an existing order that results in a new order, the copay status of the
"PKG",15,22,1,"PAH",1,1,20,0)
    prescription needs to be determined for billing purposes.
"PKG",15,22,1,"PAH",1,1,21,0)
 
"PKG",15,22,1,"PAH",1,1,22,0)
    a. Patient Prescription Processing [PSO LM BACKDOOR ORDERS]
"PKG",15,22,1,"PAH",1,1,23,0)
    b. Barcode Batch Prescription Entry [PSO BATCH BARCODE]
"PKG",15,22,1,"PAH",1,1,24,0)
    c. Complete Orders from OERR [PSO LMOE FINISH]
"PKG",15,22,1,"PAH",1,1,25,0)
 
"PKG",15,22,1,"PAH",1,1,26,0)
   If a patient is found eligible for SHAD then the prompt
"PKG",15,22,1,"PAH",1,1,27,0)
   "Was treatment related to PROJ 112/SHAD?" will be presented to the
"PKG",15,22,1,"PAH",1,1,28,0)
   pharmacist.
"PKG",15,22,1,"PAH",1,1,29,0)
 
"PKG",15,22,1,"PAH",1,1,30,0)
   A "YES" or "NO" response will be stored in the new fields, PROJ
"PKG",15,22,1,"PAH",1,1,31,0)
   112/SHAD field (#122.01) of the PRESCRIPTION file (#52) and in the PROJ
"PKG",15,22,1,"PAH",1,1,32,0)
   112/SHAD field (#8) of the ICD DIAGNOSIS sub-file (#52.052311) of the
"PKG",15,22,1,"PAH",1,1,33,0)
   PRESCRIPTION file (#52).
"PKG",15,22,1,"PAH",1,1,34,0)
 
"PKG",15,22,1,"PAH",1,1,35,0)
 2. The Integration Control Registration (ICR) #2534, provides
"PKG",15,22,1,"PAH",1,1,36,0)
    Computerized Patient Record System V. 3.0 (CPRS) with all the eligible
"PKG",15,22,1,"PAH",1,1,37,0)
    EI questions that will be prompted during the pharmacy order entry
"PKG",15,22,1,"PAH",1,1,38,0)
    process. This ICR is modified to include the SHAD prompt.
"PKG",15,22,1,"PAH",1,1,39,0)
 
"PKG",15,22,1,"PAH",1,1,40,0)
 3. When a verbal or telephone order is placed in backdoor pharmacy, it
"PKG",15,22,1,"PAH",1,1,41,0)
    requires an electronic signature from the provider. During the
"PKG",15,22,1,"PAH",1,1,42,0)
    signature entry process in CPRS, the provider may update the SC, EI,
"PKG",15,22,1,"PAH",1,1,43,0)
    or the ICD diagnosis information. This updated information is passed
"PKG",15,22,1,"PAH",1,1,44,0)
    back to pharmacy via the ICR #4666, which is modified to include the
"PKG",15,22,1,"PAH",1,1,45,0)
    SHAD changes.
"PKG",15,22,1,"PAH",1,1,46,0)
 
"PKG",15,22,1,"PAH",1,1,47,0)
 4. The PENDING OUTPATIENT ORDERS file (#52.41) that stores the pharmacy
"PKG",15,22,1,"PAH",1,1,48,0)
    orders entered via CPRS is modified to include the provider's response
"PKG",15,22,1,"PAH",1,1,49,0)
    to the SHAD question. The provider's response will be stored in the
"PKG",15,22,1,"PAH",1,1,50,0)
    new fields, PROJ 112/SHAD field (#110.2) of the PENDING OUTPATIENT
"PKG",15,22,1,"PAH",1,1,51,0)
    ORDERS file (#52.41) and the PROJ 112/SHAD field (#8) of the DIAGNOSIS
"PKG",15,22,1,"PAH",1,1,52,0)
    sub-file (#52.41311) of the PENDING OUTPATIENT ORDERS file (#52.41).
"PKG",15,22,1,"PAH",1,1,53,0)
 
"PKG",15,22,1,"PAH",1,1,54,0)
 5. During the release of a prescription, if the SHAD question applies and
"PKG",15,22,1,"PAH",1,1,55,0)
    is unanswered, the MailMan message that is sent to the finishing
"PKG",15,22,1,"PAH",1,1,56,0)
    pharmacist, ordering provider, and holders of the PSO COPAY key, to
"PKG",15,22,1,"PAH",1,1,57,0)
    get answers to the EI questions will have the SHAD question if
"PKG",15,22,1,"PAH",1,1,58,0)
    applicable.
"PKG",15,22,1,"PAH",1,1,59,0)
 
"PKG",15,22,1,"PAH",1,1,60,0)
 6. The Reset Copay Status/Cancel Charges [PSOCP RESET COPAY STATUS]
"PKG",15,22,1,"PAH",1,1,61,0)
    option is modified to include the SHAD question wherever applicable.
"PKG",15,22,1,"PAH",1,1,62,0)
 
"PKG",15,22,1,"PAH",1,1,63,0)
 7. During label printing, if the prescription is flagged as SHAD then the
"PKG",15,22,1,"PAH",1,1,64,0)
    text "NO COPAY" will be printed in the label.
"PKG",15,22,1,"PAH",1,1,65,0)
 
"PKG",15,22,1,"PAH",1,1,66,0)
Unrelated to the Enrollment VistA Changes (EVC) features, this patch also
"PKG",15,22,1,"PAH",1,1,67,0)
provides the following changes to support CPRS v27.
"PKG",15,22,1,"PAH",1,1,68,0)
 
"PKG",15,22,1,"PAH",1,1,69,0)
 a. To add the proper escape sequences to the standard HEALTH LEVEL
"PKG",15,22,1,"PAH",1,1,70,0)
    SEVEN (HL7) encoding characters to messages sent to CPRS / remove
"PKG",15,22,1,"PAH",1,1,71,0)
    escape sequences received from CPRS and replace them with standard HL7
"PKG",15,22,1,"PAH",1,1,72,0)
    encoding characters. This will help avoid errors that can occur if
"PKG",15,22,1,"PAH",1,1,73,0)
    special delimiting characters are encountered during parsing of the
"PKG",15,22,1,"PAH",1,1,74,0)
    HL7 messages.
"PKG",15,22,1,"PAH",1,1,75,0)
 
"PKG",15,22,1,"PAH",1,1,76,0)
 b. Integration Control Registration (ICR) #2400, will be modified to
"PKG",15,22,1,"PAH",1,1,77,0)
    provide new sorting sequences of the patient medication profile that
"PKG",15,22,1,"PAH",1,1,78,0)
    is viewed under the CPRS-Meds Tab including the Non-VA medications.
"PKG",15,22,1,"PAH",1,1,79,0)
 
"PKG",15,22,1,"PAH",1,1,80,0)
    VIEW 0 or null - This provides the medication list as it was prior to
"PKG",15,22,1,"PAH",1,1,81,0)
             GUI 27 so that other applications calling this API will not
"PKG",15,22,1,"PAH",1,1,82,0)
             see any changes.
"PKG",15,22,1,"PAH",1,1,83,0)
    VIEW 1 - This provides the medication list sorted by prescription
"PKG",15,22,1,"PAH",1,1,84,0)
             Status Group and Stop Date/Expiration Date. Following is the
"PKG",15,22,1,"PAH",1,1,85,0)
             order:
"PKG",15,22,1,"PAH",1,1,86,0)
            Pending group
"PKG",15,22,1,"PAH",1,1,87,0)
              Non-Verified
"PKG",15,22,1,"PAH",1,1,88,0)
              Pending
"PKG",15,22,1,"PAH",1,1,89,0)
            Active group:
"PKG",15,22,1,"PAH",1,1,90,0)
              Active
"PKG",15,22,1,"PAH",1,1,91,0)
              Hold
"PKG",15,22,1,"PAH",1,1,92,0)
              Suspended (Active/Susp)
"PKG",15,22,1,"PAH",1,1,93,0)
              Provider Hold
"PKG",15,22,1,"PAH",1,1,94,0)
            Expired group
"PKG",15,22,1,"PAH",1,1,95,0)
              Expired
"PKG",15,22,1,"PAH",1,1,96,0)
            Discontinued/Deleted group
"PKG",15,22,1,"PAH",1,1,97,0)
              Discontinued by Provider
"PKG",15,22,1,"PAH",1,1,98,0)
              Discontinued (Edit)
"PKG",15,22,1,"PAH",1,1,99,0)
 
"PKG",15,22,1,"PAH",1,1,100,0)
    VIEW 2 - This provides the medication list sorted by prescription
"PKG",15,22,1,"PAH",1,1,101,0)
             Status Group, Status, and Drug Name.
"PKG",15,22,1,"PAH",1,1,102,0)
            Active group:
"PKG",15,22,1,"PAH",1,1,103,0)
              Active
"PKG",15,22,1,"PAH",1,1,104,0)
              Hold
"PKG",15,22,1,"PAH",1,1,105,0)
            Pending group
"PKG",15,22,1,"PAH",1,1,106,0)
              Non-Verified
"PKG",15,22,1,"PAH",1,1,107,0)
              Pending
"PKG",15,22,1,"PAH",1,1,108,0)
            Discontinued
"PKG",15,22,1,"PAH",1,1,109,0)
              Discontinued by Provider
"PKG",15,22,1,"PAH",1,1,110,0)
              Discontinued (Edit)
"PKG",15,22,1,"PAH",1,1,111,0)
 
"PKG",15,22,1,"PAH",1,1,112,0)
    VIEW 3 - This provides the medication list sorted by Drug Name,
"PKG",15,22,1,"PAH",1,1,113,0)
           active/suspended and Stop Date/Expiration Date.
"PKG",15,22,1,"PAH",1,1,114,0)
 
"PKG",15,22,1,"PAH",1,1,115,0)
 c. Flag/Un-Flag functionality (PSI-06-041)
"PKG",15,22,1,"PAH",1,1,116,0)
    It was requested in the Remedy ticket #133716 that the flagging
"PKG",15,22,1,"PAH",1,1,117,0)
    capability that is available in CPRS be made available for
"PKG",15,22,1,"PAH",1,1,118,0)
    Outpatient Pharmacy use. This patch provides the flagging
"PKG",15,22,1,"PAH",1,1,119,0)
    functionality for Pending orders only.
"PKG",15,22,1,"PAH",1,1,120,0)
 
"PKG",15,22,1,"PAH",1,1,121,0)
 d. As per the E3R numbers 19973 and 19876, to improve communication
"PKG",15,22,1,"PAH",1,1,122,0)
    between the provider and the pharmacist, Outpatient Pharmacy will now
"PKG",15,22,1,"PAH",1,1,123,0)
    send the actual comments made by the pharmacist to CPRS when a
"PKG",15,22,1,"PAH",1,1,124,0)
    prescription is put on Hold, Discontinued, and Returned to Stock
"PKG",15,22,1,"PAH",1,1,125,0)
    replacing the generic "per pharmacy request" text.
"PKG",15,22,1,"PAH",1,1,126,0)
 
"PKG",15,22,1,"PAH",1,1,127,0)
 e. When the DC-Discontinue ListMan option is used to discontinue a
"PKG",15,22,1,"PAH",1,1,128,0)
    pending "renewal" order, the software will now check for an active
"PKG",15,22,1,"PAH",1,1,129,0)
    prescription for the same drug. If found it will prompt the following:
"PKG",15,22,1,"PAH",1,1,130,0)
    "There is an active Rx for this pending order, Discontinue both
"PKG",15,22,1,"PAH",1,1,131,0)
    (Y/N)".
"PKG",15,22,1,"PAH",1,1,132,0)
    This will provide the user with the option to discontinue both pending
"PKG",15,22,1,"PAH",1,1,133,0)
    and the active order.
"PKG",15,22,1,"PAH",1,1,134,0)
 
"PKG",15,22,1,"PAH",1,1,135,0)
 f. A problem was reported in one of the error messages displayed on CPRS
"PKG",15,22,1,"PAH",1,1,136,0)
    side when a provider tries to discontinue an Outpatient Pharmacy
"PKG",15,22,1,"PAH",1,1,137,0)
    order from the Orders Tab and that order for some reason is
"PKG",15,22,1,"PAH",1,1,138,0)
    not found in the PRESCRIPTION file (#52). The solution provided is to
"PKG",15,22,1,"PAH",1,1,139,0)
    replace the error message "Unable to locate order" with "Invalid
"PKG",15,22,1,"PAH",1,1,140,0)
    Pharmacy order number" to be in consistent with the Inpatient
"PKG",15,22,1,"PAH",1,1,141,0)
    Medications V. 5.0 error messages.
"PKG",15,22,1,"PAH",1,1,142,0)
 
"PKG",15,22,1,"PAH",1,1,143,0)
 g. At the request of CPRS active calls to obsolete routine OR3CONV have
"PKG",15,22,1,"PAH",1,1,144,0)
    been removed from Outpatient Pharmacy V. 7.0.
"PKG",15,22,1,"PAH",1,1,145,0)
 
"PKG",15,22,1,"PAH",1,1,146,0)
 h. When finishing a pending order placed in CPRS, it was reported that
"PKG",15,22,1,"PAH",1,1,147,0)
    the patient instructions sent across to CPRS was getting truncated.
"PKG",15,22,1,"PAH",1,1,148,0)
    This patch fixes the problem.
"PKG",15,22,1,"PAH",1,1,149,0)
 
"PKG",15,22,1,"PAH",1,1,150,0)
 i. PSI-07-057 - Potential of inappropriate or misleading provider
"PKG",15,22,1,"PAH",1,1,151,0)
    comments to be automatically included on new medication orders.
"PKG",15,22,1,"PAH",1,1,152,0)
    To fix this problem CPRS is dropping (will not carry over) the
"PKG",15,22,1,"PAH",1,1,153,0)
    original provider comments during renewals of Outpatient Pharmacy
"PKG",15,22,1,"PAH",1,1,154,0)
    medications.
"PKG",15,22,1,"PAH",1,1,155,0)
    To follow suit with CPRS, Outpatient Pharmacy is also dropping the
"PKG",15,22,1,"PAH",1,1,156,0)
    original provider comments from all backdoor renewals.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
65
"RTN","PSOCAN3")
0^37^B70221168
"RTN","PSOCAN3",1,0)
PSOCAN3 ;BIR/RTR/SAB - auto dc rxs due to death ;9/18/06 2:59pm
"RTN","PSOCAN3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**15,24,27,32,36,94,88,117,131,146,139,132,223,235,148,249,225**;DEC 1997;Build 29
"RTN","PSOCAN3",3,0)
 ;External reference to File #55 supported by DBIA 2228
"RTN","PSOCAN3",4,0)
 ;External references to L, UL, PSOL, and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOCAN3",5,0)
 Q
"RTN","PSOCAN3",6,0)
APSOD(PSODFN) ;called from file #2 date of death xref 'APOSD'
"RTN","PSOCAN3",7,0)
 N D,DA,DB,DC,DE,DG,DH,DI,DIC,DIE,DIG,DIH,DIK,DIR,DIQ,DIU,DIV,DIW,DK,DL,DM,DP,DQ,DU,DV,DW,DR
"RTN","PSOCAN3",8,0)
 S PSODEATH=1 D CAN K PSODEATH
"RTN","PSOCAN3",9,0)
 Q
"RTN","PSOCAN3",10,0)
CAN ;discontinued rxs due to death
"RTN","PSOCAN3",11,0)
 I $G(PSODFN),$D(^PS(52.91,PSODFN,0)) D
"RTN","PSOCAN3",12,0)
 .I '$P($G(^PS(52.91,PSODFN,0)),"^",3)!($P($G(^(0)),"^",3)>DT) S $P(^PS(52.91,PSODFN,0),"^",3)=DT,$P(^PS(52.91,PSODFN,0),"^",4)=5,^PS(52.91,"AX",DT,PSODFN)="" D SET^PSOTPCAN(PSODFN)
"RTN","PSOCAN3",13,0)
 F PSORXJ=0:0 S PSORXJ=$O(^PS(55,PSODFN,"P",PSORXJ)) Q:'PSORXJ  I $D(^(PSORXJ,0)) S PSORX=^(0) S STA=$S($P($G(^PSRX(PSORX,"STA")),"^")<11:1,$P($G(^("STA")),"^")=16:1,1:0) D:STA
"RTN","PSOCAN3",14,0)
 .I $D(^PSRX(PSORX,0)),$P($G(^PSRX(PSORX,"STA")),"^")="" D SETC
"RTN","PSOCAN3",15,0)
 .D REVERSE^PSOBPSU1(PSORX,,"DC",7)
"RTN","PSOCAN3",16,0)
 .I $D(^PSRX(PSORX,0)),$P($G(^PSRX(PSORX,2)),"^",6)'<DT S PSO0=^(0),PSO2=$G(^(2)) D
"RTN","PSOCAN3",17,0)
 ..S ^PSRX(PSORX,"DDSTA")="52;"_$P(^PSRX(PSORX,"STA"),"^")
"RTN","PSOCAN3",18,0)
 ..;remove from hold
"RTN","PSOCAN3",19,0)
 ..I $G(^PSRX(PSORX,"H"))]"" D
"RTN","PSOCAN3",20,0)
 ...S ^PSRX(PSORX,"DDSTA")="52;"_$P(^PSRX(PSORX,"STA"),"^")_"^"_^PSRX(PSORX,"H")
"RTN","PSOCAN3",21,0)
 ...K:$P(^PSRX(PSORX,"H"),"^") ^PSRX("AH",$P(^PSRX(PSORX,"H"),"^"),PSORX) S ^PSRX(PSORX,"H")=""
"RTN","PSOCAN3",22,0)
 ...I '$P($G(^PSRX(PSORX,2)),"^",2),$P($G(^(3)),"^") S $P(^PSRX(PSORX,2),"^",2)=$P(^(3),"^")
"RTN","PSOCAN3",23,0)
 ...I $G(PSODEATH),$P(^PSRX(PSORX,0),"^",2) S ^PSRX("APSOD",$P(^PSRX(PSORX,0),"^",2),PSORX)=""
"RTN","PSOCAN3",24,0)
 ..;delete from non-verified file
"RTN","PSOCAN3",25,0)
 ..I $G(^PS(52.4,PSORX,0))]"" S ^PSRX(PSORX,"DDSTA")="52.4;"_$P(^PSRX(PSORX,"STA"),"^")_"^"_^PS(52.4,PSORX,0),DIK="^PS(52.4,",DA=PSORX D ^DIK K DIK
"RTN","PSOCAN3",26,0)
 ..I $G(PSODEATH),$P(^PSRX(PSORX,0),"^",2) S ^PSRX("APSOD",$P(^PSRX(PSORX,0),"^",2),PSORX)=""
"RTN","PSOCAN3",27,0)
 ..;delete from suspense
"RTN","PSOCAN3",28,0)
 ..D:$O(^PS(52.5,"B",PSORX,0))
"RTN","PSOCAN3",29,0)
 ...S DA=$O(^PS(52.5,"B",PSORX,0)) I '$G(^PS(52.5,DA,"P")),$G(PSODEATH) S ^PSRX(PSORX,"DDSTA")="52.5;5^"_^PS(52.5,DA,0),^PSRX("APSOD",$P(^PSRX(PSORX,0),"^",2),PSORX)=""
"RTN","PSOCAN3",30,0)
 ...I $O(^PSRX(PSORX,1,0)),'$G(PSODEATH) S DA=PSORX,SUSD=$P($G(^PS(52.5,$O(^PS(52.5,"B",PSORX,0)),0)),"^",2) D:'$G(^PS(52.5,$O(^PS(52.5,"B",PSORX,0)),"P")) REF^PSOCAN2
"RTN","PSOCAN3",31,0)
 ...S DA=$O(^PS(52.5,"B",PSORX,0)),DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOCAN3",32,0)
 ..D SETC
"RTN","PSOCAN3",33,0)
 ..;activity record
"RTN","PSOCAN3",34,0)
 ..S (COM,ACOM)=$S($G(PSODEATH):"Date of Death Entered by MAS",1:"Discontinued by Pharmacy")_"."
"RTN","PSOCAN3",35,0)
 ..S ACNT=0 F SUB=0:0 S SUB=$O(^PSRX(PSORX,"A",SUB)) Q:'SUB  S ACNT=SUB
"RTN","PSOCAN3",36,0)
 ..S RFCNT=0 F RF=0:0 S RF=$O(^PSRX(PSORX,1,RF)) Q:'RF  S RFCNT=RF
"RTN","PSOCAN3",37,0)
 ..D NOW^%DTC S ACNT=ACNT+1,^PSRX(PSORX,"A",0)="^52.3DA^"_ACNT_"^"_ACNT
"RTN","PSOCAN3",38,0)
 ..S ^PSRX(PSORX,"A",ACNT,0)=%_"^"_"C"_"^^"_RFCNT_"^"_"Auto Discontinued Due to Death. "_ACOM
"RTN","PSOCAN3",39,0)
 ..;check for label/release/pending release
"RTN","PSOCAN3",40,0)
 ..D FIL
"RTN","PSOCAN3",41,0)
 ..S STAT="OD",PHARMST="" D EN^PSOHLSN1(PSORX,STAT,PHARMST,COM,"A") K COMM,PHARMST,STAT
"RTN","PSOCAN3",42,0)
 ;dc pending orders
"RTN","PSOCAN3",43,0)
 F PDA=0:0 S PDA=$O(^PS(52.41,"P",PSODFN,PDA)) Q:'PDA  I $P(^PS(52.41,PDA,0),"^",3)'="DC"&($P(^(0),"^",3)'="DE") D
"RTN","PSOCAN3",44,0)
 .I $G(PSODEATH) D
"RTN","PSOCAN3",45,0)
 ..S ^PS(52.41,PDA,"DDSTA")=$P(^PS(52.41,PDA,0),"^",3)_";"_+$P($G(^PS(52.41,PDA,"INI")),"^"),^PS(52.41,"APSOD",PSODFN,PDA)=""
"RTN","PSOCAN3",46,0)
 ..S $P(^PS(52.41,PDA,4),"^")="Date of Death Entered by MAS."
"RTN","PSOCAN3",47,0)
 .S $P(^PS(52.41,PDA,0),"^",3)="DC"
"RTN","PSOCAN3",48,0)
 .K ^PS(52.41,"AOR",PSODFN,+$P($G(^PS(52.41,PDA,"INI")),"^"),PDA)
"RTN","PSOCAN3",49,0)
 .S COM=$S($G(PSODEATH):"Date of Death Entered by MAS.",1:""),PL=$P(^PS(52.41,PDA,0),"^"),$P(^(0),"^",3)="DC"
"RTN","PSOCAN3",50,0)
 .D EN^PSOHLSN(PL,"OC",COM,"A") K COM,PL
"RTN","PSOCAN3",51,0)
 ;dc non-va meds
"RTN","PSOCAN3",52,0)
 D APSOD^PSONVNEW
"RTN","PSOCAN3",53,0)
KILL K %,%H,%T,ACNT,DA,PDA,DIRUT,DTOUT,PSO,PSO0,PSO2,PSOD,PSOD0,PSODFN,PSODL,PSORX,PSORXJ,PSOSD,RF,RFCNT,SUB,TM,TSKDT,X,X1,X2,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","PSOCAN3",54,0)
 D KVAR^VADPT S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOCAN3",55,0)
 Q
"RTN","PSOCAN3",56,0)
CAN1 Q:$G(DODR)
"RTN","PSOCAN3",57,0)
 S PSOMGDFN=$G(PSODFN) ; SAVE IN CASE CANCELING RX THAT WAS MERGED TO ANOTHER DFN
"RTN","PSOCAN3",58,0)
 I $G(^PSRX(DA,"H"))]"" D HLD^PSOCAN2
"RTN","PSOCAN3",59,0)
 D REVERSE^PSOBPSU1(DA,,"DC",7)
"RTN","PSOCAN3",60,0)
 S PSCANVAR=0,RXDA=DA,DA=$O(^PS(52.5,"B",DA,0)) I DA,'$G(^PS(52.5,DA,"P")) S PSCANVAR=1 D
"RTN","PSOCAN3",61,0)
 .S SUSD=$P($G(^PS(52.5,DA,0)),"^",2)
"RTN","PSOCAN3",62,0)
 .S:+$G(^PS(52.5,DA,"P"))'=1 ACOM=$S(REA="C":"Discontinued",1:"Reinstated")_" while suspended. "_$G(COM)
"RTN","PSOCAN3",63,0)
 .S DIK="^PS(52.5," D ^DIK K DIK S DA=RXDA,RXREF=0,PSODFN=+$P(^PSRX(DA,0),"^",2)
"RTN","PSOCAN3",64,0)
 .D AREC^PSOCAN1 S DA=RXDA I $O(^PSRX(DA,1,0)) D REF^PSOCAN2
"RTN","PSOCAN3",65,0)
 I $G(REA)="C" S DA=$O(^PS(52.5,"B",RXDA,0)) I DA S DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOCAN3",66,0)
 I 'PSCANVAR S:$D(SPCANC) ACOM=$S(REA="C":"Discontinued",1:"Reinstated")_" during Rx cancel.  "
"RTN","PSOCAN3",67,0)
ADD S DA=RXDA,RXREF=0,PSODFN=+$P(^PSRX(DA,0),"^",2) S:$G(PSOOPT)=3 REA="L"
"RTN","PSOCAN3",68,0)
 D:'$G(PSCANVAR) AREC^PSOCAN1 S:REA="L" REA="C" S:REA'="C" $P(^PSRX(DA,"STA"),"^")=0
"RTN","PSOCAN3",69,0)
 N PSOTPCNZ S PSOTPCNZ=0 I $P(^PSRX(DA,"STA"),"^")'=12 S PSOTPCNZ=1
"RTN","PSOCAN3",70,0)
 S:REA="C"&($P(^PSRX(DA,"STA"),"^")<12)!($P(^("STA"),"^")=16) $P(^PSRX(DA,"STA"),"^")=12 I $P($G(^PSRX(DA,"STA")),"^")=12,$G(PSOTPCNZ) D CAN^PSOTPCAN(DA)
"RTN","PSOCAN3",71,0)
 K PSOTPCNZ
"RTN","PSOCAN3",72,0)
 I REA="R" D
"RTN","PSOCAN3",73,0)
 .I $P(^PSRX(DA,3),"^",8) S $P(^PSRX(DA,3),"^",2)=$P(^PSRX(DA,3),"^",8),$P(^(3),"^",8)=""
"RTN","PSOCAN3",74,0)
 .S $P(^PSRX(DA,3),"^")=$S($P(^PSRX(DA,3),"^",10):$P(^(3),"^",10),$G(PSOCANHD):PSOCANHD,$P(^(3),"^",5):$P(^(3),"^",5),1:$P(^(3),"^")),$P(^(3),"^",5)="",$P(^(3),"^",10)=""
"RTN","PSOCAN3",75,0)
 I REA="C" D
"RTN","PSOCAN3",76,0)
 .S $P(^PSRX(DA,3),"^",10)=$P(^PSRX(DA,3),"^")
"RTN","PSOCAN3",77,0)
 .S:'$P(^PSRX(DA,3),"^",5) $P(^PSRX(DA,3),"^",5)=DT
"RTN","PSOCAN3",78,0)
 .I $O(^PS(52.41,"ARF",DA,0)),'$O(^PS(52.41,"APSOD",PSODFN,0)) S HLDDA=DA,DA=$O(^PS(52.41,"ARF",DA,0)),DIK="^PS(52.41," D ^DIK S DA=HLDDA K HLDDA
"RTN","PSOCAN3",79,0)
 .;check for label/release/pending release
"RTN","PSOCAN3",80,0)
 .I $G(PSOOPT)'=3 D FILX
"RTN","PSOCAN3",81,0)
 S PSONOOR=$S($D(PSONOOR):PSONOOR,1:"D"),STAT=$S(REA="C":"OD",1:"SC"),PHARMST=$S(REA="C":"",1:"CM")
"RTN","PSOCAN3",82,0)
 S COM=$S(REA="C":$S($G(PSOOPT)=3&('$G(DUP)):"Renewed",1:"Discontinued")_" by Pharmacy",1:"Reinstated by Pharmacy")
"RTN","PSOCAN3",83,0)
 D EN^PSOHLSN1(DA,STAT,PHARMST,$S(COM["Discontinued"&($D(INCOM)):INCOM,1:COM),$S($G(PSOOPT)=3&('$G(DUP)):"",1:PSONOOR)) K COM,STAT,PHARMST,PSCANVAR
"RTN","PSOCAN3",84,0)
 I REA="C" D
"RTN","PSOCAN3",85,0)
 .I $G(^PS(52.4,DA,0))]"" S PSCDA=DA,DIK="^PS(52.4," D ^DIK S DA=PSCDA K DIK,PSCDA
"RTN","PSOCAN3",86,0)
 I $G(PSOMGDFN)'="" S PSODFN=PSOMGDFN K PSOMGDFN
"RTN","PSOCAN3",87,0)
 Q:(REA="C")!('$P($G(PSOPAR),"^",2))!($P(^PSRX(DA,2),"^",10)]"")
"RTN","PSOCAN3",88,0)
 Q:$D(^XUSEC("PSORPH",DUZ))  S PSVC=$P(^PSRX(DA,0),"^",16) F JJ=0:0 S JJ=$O(^PS(55,PSODFN,"P",JJ)) Q:'JJ  I $D(^(JJ,0)),+^(0)=DA Q
"RTN","PSOCAN3",89,0)
 Q:'JJ  S PSRXIN=DA,DIC="^PS(52.4,",DLAYGO=52.4,(X,DINUM)=PSRXIN,DIC(0)="ML"
"RTN","PSOCAN3",90,0)
 S DIC("DR")="1////"_$G(PSODFN)_";2////"_DUZ_";4////"_DT
"RTN","PSOCAN3",91,0)
 K DD,DO D FILE^DICN K DD,DO,DIC,DLAYGO,DINUM
"RTN","PSOCAN3",92,0)
 K DA,DIK S DA=PSRXIN K PSRXIN S $P(^PSRX(DA,"STA"),"^")=1 D NVER^PSOCAN2
"RTN","PSOCAN3",93,0)
 W !,"Rx # "_$P(^PSRX(DA,0),"^")_" is still non-verified!"
"RTN","PSOCAN3",94,0)
 Q
"RTN","PSOCAN3",95,0)
OERR I '$D(^XUSEC("PSORPH",DUZ)),'$P($G(PSOPAR),"^",2) S VALMSG="Invalid Action Selection!",VALMBCK="" Q
"RTN","PSOCAN3",96,0)
 S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient.") K PSOPLCK S VALMBCK="" Q
"RTN","PSOCAN3",97,0)
 K PSOPLCK S PSOCANRD=+$P($G(^PSRX($P(PSOLST(ORN),"^",2),0)),"^",4),PSOCANRA=1
"RTN","PSOCAN3",98,0)
 I $P(^PSRX($P(PSOLST(ORN),"^",2),"STA"),"^"),$P(^("STA"),"^")=1!($P(^("STA"),"^")=4) S:$G(SPEED) PSONOORS=$G(PSONOOR) D DEL^PSOCAN4 S:$G(PSONOORS)'="" PSONOOR=$G(PSONOORS) K PSONOORS D KCAN D ULP Q
"RTN","PSOCAN3",99,0)
 D PSOL^PSSLOCK($P(PSOLST(ORN),"^",2)) I '$G(PSOMSG) S VALMSG=$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order."),VALMBCK="" K PSOMSG D KCAN D ULP Q
"RTN","PSOCAN3",100,0)
 I '+^PSRX($P(PSOLST(ORN),"^",2),"OR1"),$P(^("STA"),"^")=12 S VALMSG="Rx Cannot be Reinstated.  No Orderable Item." D KCAN D ULP D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) Q
"RTN","PSOCAN3",101,0)
 I $P($G(^PSRX($P(PSOLST(ORN),"^",2),"STA")),"^")=12,$P($G(^("PKI")),"^") S VALMSG="Cannot be Reinstated - Digitally Signed" D KCAN D ULP D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) Q
"RTN","PSOCAN3",102,0)
 I $P($G(^PSRX($P(PSOLST(ORN),"^",2),"STA")),"^")=12 S PSOCANRZ=1
"RTN","PSOCAN3",103,0)
 D HLDHDR^PSOLMUTL S X=$P(^PSRX($P(PSOLST(ORN),"^",2),0),"^"),PS=$S($P(^PSRX($P(PSOLST(ORN),"^",2),"STA"),"^")=12:"Reinstate: ",1:"Discontinue: ")
"RTN","PSOCAN3",104,0)
 S POERR=1,DFNHLD=PSODFN,DA=$P(PSOLST(ORN),"^",2)
"RTN","PSOCAN3",105,0)
 I $P(^PSRX(DA,3),"^",5) S PSOCANHD=$P(^PSRX(DA,3),"^",5)
"RTN","PSOCAN3",106,0)
 D LMNO D:$P($G(^PSRX($P(PSOLST(ORN),"^",2),"STA")),"^")=12 RMP
"RTN","PSOCAN3",107,0)
 D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2))
"RTN","PSOCAN3",108,0)
 K POERR,PSCAN,PSI,PSL S PSODFN=DFNHLD K DFNHLD D ULP
"RTN","PSOCAN3",109,0)
 D KCAN
"RTN","PSOCAN3",110,0)
 Q
"RTN","PSOCAN3",111,0)
 Q
"RTN","PSOCAN3",112,0)
ULP D UL^PSSLOCK(+$G(PSODFN))
"RTN","PSOCAN3",113,0)
 Q
"RTN","PSOCAN3",114,0)
 ;
"RTN","PSOCAN3",115,0)
LMNO ; Calls LMNO^PSOCAN
"RTN","PSOCAN3",116,0)
 N PSODFN,PSORX,RXN,RX0
"RTN","PSOCAN3",117,0)
 S PSPOP=0,RXNUM=X S PSODFN=+$P(^PSRX(DA,0),"^",2) D LMNO^PSOCAN
"RTN","PSOCAN3",118,0)
 Q
"RTN","PSOCAN3",119,0)
 ;
"RTN","PSOCAN3",120,0)
KCAN ;
"RTN","PSOCAN3",121,0)
 K PSOCANRA,PSOCANRC,PSOCANRD,PSOCANRN,PSOCANRP,PSOCANRZ,PSOMSG,PSOCANHD
"RTN","PSOCAN3",122,0)
 Q
"RTN","PSOCAN3",123,0)
 ;
"RTN","PSOCAN3",124,0)
KCAN1 ;
"RTN","PSOCAN3",125,0)
 K PSOCANRC,PSOCANRD,PSOCANRN,PSOCANRP,PSOCANRZ
"RTN","PSOCAN3",126,0)
 Q
"RTN","PSOCAN3",127,0)
 ;
"RTN","PSOCAN3",128,0)
RMP D RMP^PSOCAN3N
"RTN","PSOCAN3",129,0)
 Q
"RTN","PSOCAN3",130,0)
 ;
"RTN","PSOCAN3",131,0)
FIL Q:'$G(PSORX)
"RTN","PSOCAN3",132,0)
 S PSOFC=PSORX G FILC
"RTN","PSOCAN3",133,0)
FILX Q:'$G(DA)
"RTN","PSOCAN3",134,0)
 S PSOFC=DA
"RTN","PSOCAN3",135,0)
FILC ;
"RTN","PSOCAN3",136,0)
 N PFC,PSOFFLAG
"RTN","PSOCAN3",137,0)
 I $P($G(^PSRX(PSOFC,2)),"^",13) G FILQ
"RTN","PSOCAN3",138,0)
 S PSOFFLAG=0 F PFC=0:0 S PFC=$O(^PSRX(PSOFC,1,PFC)) Q:'PFC!(PSOFFLAG)  I $P($G(^PSRX(PSOFC,1,PFC,0)),"^",18) S PSOFFLAG=1
"RTN","PSOCAN3",139,0)
 I PSOFFLAG G FILQ
"RTN","PSOCAN3",140,0)
 F PFC=0:0 S PFC=$O(^PSRX(PSOFC,"L",PFC)) Q:'PFC!(PSOFFLAG)  I $D(^PSRX(PSOFC,"L",PFC,0)),'$P($G(^(0)),"^",5) S PSOFFLAG=1
"RTN","PSOCAN3",141,0)
 I PSOFFLAG G FILQ
"RTN","PSOCAN3",142,0)
 S PSOFCSUS=$O(^PS(52.5,"B",PSOFC,0))
"RTN","PSOCAN3",143,0)
 I $G(PSOFCSUS),$P($G(^PS(52.5,PSOFCSUS,0)),"^",7)="L"!($P($G(^(0)),"^",7)="X") G FILQ
"RTN","PSOCAN3",144,0)
 S $P(^PSRX(PSOFC,3),"^",8)=$P($G(^PSRX(PSOFC,3)),"^",2)
"RTN","PSOCAN3",145,0)
 S $P(^PSRX(PSOFC,3),"^",2)=$P($G(^PSRX(PSOFC,2)),"^",2)
"RTN","PSOCAN3",146,0)
 I $P($G(^PSRX(PSOFC,"OR1")),"^",3) S $P(^PSRX(PSOFC,3),"^")=$P($G(^PSRX($P(^PSRX(PSOFC,"OR1"),"^",3),3)),"^")
"RTN","PSOCAN3",147,0)
FILQ K PSOFC,PSOFCSUS
"RTN","PSOCAN3",148,0)
 Q
"RTN","PSOCAN3",149,0)
 ;
"RTN","PSOCAN3",150,0)
SETC ;Called from Date of Death
"RTN","PSOCAN3",151,0)
 S $P(^PSRX(PSORX,"STA"),"^")=12,$P(^PSRX(PSORX,3),"^",5)=DT,$P(^PSRX(PSORX,3),"^",10)=$P(^PSRX(PSORX,3),"^") D CAN^PSOTPCAN(PSORX)
"RTN","PSOCAN3",152,0)
 Q
"RTN","PSOCAN3N")
0^62^B656532
"RTN","PSOCAN3N",1,0)
PSOCAN3N ;BIR/RTR/SAB/SJA - auto dc rxs due to death ;06/29/07 11:45am
"RTN","PSOCAN3N",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**225**;DEC 1997;Build 29
"RTN","PSOCAN3N",3,0)
 Q
"RTN","PSOCAN3N",4,0)
RMP ;remove Rx if found in array PSORX("PSOL") (Label Queue)
"RTN","PSOCAN3N",5,0)
 Q:'$D(PSORX("PSOL"))  S:'$G(DA) DA=$P(PSOLST(ORN),"^",2)
"RTN","PSOCAN3N",6,0)
 N I,J,FND,ST1,ST2,ST3 S I=0
"RTN","PSOCAN3N",7,0)
 F  S I=$O(PSORX("PSOL",I)) Q:'I  D
"RTN","PSOCAN3N",8,0)
 . S ST1=PSORX("PSOL",I) Q:ST1'[(DA_",")
"RTN","PSOCAN3N",9,0)
 . S ST3="",FND=0
"RTN","PSOCAN3N",10,0)
 . F J=1:1 S ST2=$P(ST1,",",J) Q:'ST2  D
"RTN","PSOCAN3N",11,0)
 . . I ST2=DA S FND=1 Q
"RTN","PSOCAN3N",12,0)
 . . S ST3=ST3_$S('ST3:"",1:",")_ST2
"RTN","PSOCAN3N",13,0)
 . I FND D
"RTN","PSOCAN3N",14,0)
 . . S:ST3]"" PSORX("PSOL",I)=ST3_","
"RTN","PSOCAN3N",15,0)
 . . K:ST3="" PSORX("PSOL",I)
"RTN","PSOCAN3N",16,0)
 . . D:$D(BBRX(I)) RMB^PSOCAN2(I)
"RTN","PSOCAN3N",17,0)
 Q
"RTN","PSOCAN4")
0^38^B42375050
"RTN","PSOCAN4",1,0)
PSOCAN4 ;BIR/SAB-rx speed dc listman ;10/23/06 11:50am
"RTN","PSOCAN4",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**20,24,27,63,88,117,131,259,268,225**;DEC 1997;Build 29
"RTN","PSOCAN4",3,0)
 ;External reference to File #200 supported by DBIA 224
"RTN","PSOCAN4",4,0)
 ;External reference NA^ORX1 supported by DBIA 2186
"RTN","PSOCAN4",5,0)
 ;External references to L, UL, PSOL, and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOCAN4",6,0)
 ;External reference to PSDRUG supported by DBIA 221
"RTN","PSOCAN4",7,0)
 ;External reference to PS(50.7 supported by DBIA 2223
"RTN","PSOCAN4",8,0)
 ;External reference to PS(50.606 supported by DBIA 2174
"RTN","PSOCAN4",9,0)
SEL I '$D(^XUSEC("PSORPH",DUZ)) S VALMSG="Unauthorized Action Selection.",VALMBCK="" Q
"RTN","PSOCAN4",10,0)
 N VALMCNT I '$G(PSOCNT) S VALMSG="This patient has no Prescriptions!" S VALMBCK="" Q
"RTN","PSOCAN4",11,0)
 S DFNHLD=PSODFN
"RTN","PSOCAN4",12,0)
 S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient.") K PSOPLCK S VALMBCK="" Q
"RTN","PSOCAN4",13,0)
 K PSOPLCK S RXCNT=0 K PSOFDR,DIR,DUOUT,DIRUT S DIR("A")="Select Orders by number",DIR(0)="LO^1:"_PSOCNT D ^DIR S LST=Y I $D(DTOUT)!($D(DUOUT)) K DIR,DIRUT,DTOUT,DUOUT S VALMBCK="" D ULP Q
"RTN","PSOCAN4",14,0)
 K DIR,DIRUT,DTOUT,PSOOELSE,DTOUT I +LST S (SPEED,PSOOELSE)=1 D  D KCAN^PSOCAN3
"RTN","PSOCAN4",15,0)
 .S PSOCANRA=1 D RQTEST
"RTN","PSOCAN4",16,0)
 .D FULL^VALM1,COM^PSOCAN1 I '$D(INCOM)!($D(DIRUT)) K SPEED S VALMBCK="R" Q
"RTN","PSOCAN4",17,0)
 .D FULL^VALM1 F ORD=1:1:$L(LST,",") Q:$P(LST,",",ORD)']""  S ORN=$P(LST,",",ORD) D @$S(+PSOLST(ORN)=52:"RX",1:"PEN")
"RTN","PSOCAN4",18,0)
 .S VALMBCK="R"
"RTN","PSOCAN4",19,0)
 I '$G(PSOOELSE) S VALMBCK=""
"RTN","PSOCAN4",20,0)
 D ^PSOBUILD,BLD^PSOORUT1,RV^PSOORFL K PSOMSG,RXCNT,DIR,DIRUT,DTOUT,DUOUT,LST,ORD,IEN,ORN,RPH,ST,REFL,REF,PSOACT,ORSV,PSORNW,PSORENW,PSONO,PSOCO,PSOCU,PSODIR,DSMSG,SAVORD,SAVORN,SPEED,DIRUT,PSONOOR
"RTN","PSOCAN4",21,0)
 D INVALD^PSOCAN1 K PSINV,PSOOELSE,INCOM,COM S PSODFN=DFNHLD K DFNHLD D ULP
"RTN","PSOCAN4",22,0)
 Q
"RTN","PSOCAN4",23,0)
ULP D UL^PSSLOCK(+$G(PSODFN)) Q
"RTN","PSOCAN4",24,0)
 ;
"RTN","PSOCAN4",25,0)
RX Q:'$D(^XUSEC("PSORPH",DUZ))
"RTN","PSOCAN4",26,0)
 D PSOL^PSSLOCK($P(PSOLST(ORN),"^",2)) I '$G(PSOMSG) D  D PAUSE^VALM1 K PSOMSG Q
"RTN","PSOCAN4",27,0)
 .I $P($G(PSOMSG),"^",2)'="" W $C(7),!!,$P($G(PSOMSG),"^",2),!,"Rx "_$P(^PSRX($P(PSOLST(ORN),"^",2),0),"^"),! Q
"RTN","PSOCAN4",28,0)
 .W $C(7),!!,"Another person is editing Rx "_$P(^PSRX($P(PSOLST(ORN),"^",2),0),"^"),!
"RTN","PSOCAN4",29,0)
 S RXSP=1 K PSCAN S (EN,X)=$P(^PSRX($P(PSOLST(ORN),"^",2),0),"^") S Y=$P(PSOLST(ORN),"^",2)_"^"_X,Y(0,0)=X,Y(0)=$G(^PSRX($P(PSOLST(ORN),"^",2),0)) D
"RTN","PSOCAN4",30,0)
 .I $P(^PSRX(+Y,"STA"),"^")=1!($P(^("STA"),"^")=4) D  Q
"RTN","PSOCAN4",31,0)
 ..I $P($G(^PSRX(+Y,"PKI")),"^") N PKI,PKI1,PKIR,PKIE,DA S DA=+Y D CER^PSOPKIV1
"RTN","PSOCAN4",32,0)
 ..S:$G(PSONOOR)'="" PSONOORA=$G(PSONOOR) D DEL S:$G(PSONOORA)'="" PSONOOR=$G(PSONOORA) K PSONOORA Q
"RTN","PSOCAN4",33,0)
 .S YY=Y,YY(0,0)=Y(0,0),(PSODFN,DFN)=$P(Y(0),"^",2) D:$G(DFN) CHK^PSOCAN I DEAD!($P(^PSRX(+YY,"STA"),"^")>11),$P(^("STA"),"^")<16 S PSINV(EN)="" Q
"RTN","PSOCAN4",34,0)
 .S DA=+YY I $P($G(^PSRX(DA,"STA")),"^")=11!($P($G(^(2)),"^",6)<DT) D EXP^PSOCAN
"RTN","PSOCAN4",35,0)
 .S RX=YY(0,0) D:$D(^PSRX(DA,0)) SPEED1^PSOCAN1
"RTN","PSOCAN4",36,0)
 K YY I '$D(PSCAN) D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) Q
"RTN","PSOCAN4",37,0)
 S RX="",RXCNT=0 F  S RX=$O(PSCAN(RX)) Q:RX=""  S DA=+PSCAN(RX),REA=$P(PSCAN(RX),"^",2),RXCNT=RXCNT+1 D SHOW^PSOCAN1
"RTN","PSOCAN4",38,0)
 S RX="" F  S RX=$O(PSCAN(RX)) Q:RX=""  D ACT
"RTN","PSOCAN4",39,0)
 D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2))
"RTN","PSOCAN4",40,0)
 Q
"RTN","PSOCAN4",41,0)
ACT S DA=+PSCAN(RX),REA=$P(PSCAN(RX),"^",2),II=RX,PSODFN=$P(^PSRX(DA,0),"^",2) I REA="R" D REINS^PSOCAN2 Q
"RTN","PSOCAN4",42,0)
 D CAN1^PSOCAN3 Q
"RTN","PSOCAN4",43,0)
PEN ;discontinue pending orders
"RTN","PSOCAN4",44,0)
 S SAVORD=ORD,SAVORN=ORN
"RTN","PSOCAN4",45,0)
 S ORD=$P(PSOLST(ORN),"^",2) D PSOL^PSSLOCK(+ORD_"S") I '$G(PSOMSG) D  D MEDDIS K PSOMSG G OK
"RTN","PSOCAN4",46,0)
 .I $P($G(PSOMSG),"^",2)'="" W $C(7),!!,$P($G(PSOMSG),"^",2)_"  (Pending order)",! Q
"RTN","PSOCAN4",47,0)
 .W $C(7),!!,"Another person is editing this Pending order.",!
"RTN","PSOCAN4",48,0)
 I $P(^PS(52.41,ORD,0),"^",3)="RF" S DA=ORD,DIK="^PS(52.41," D ^DIK K DA,DIK D PSOUL^PSSLOCK(ORD_"S") Q
"RTN","PSOCAN4",49,0)
 K ^PS(52.41,"AOR",$P(^PS(52.41,ORD,0),"^",2),+$P($G(^PS(52.41,ORD,"INI")),"^"),ORD) S $P(^PS(52.41,ORD,0),"^",3)="DC"
"RTN","PSOCAN4",50,0)
 D EN^PSOHLSN(+^PS(52.41,ORD,0),"OC",INCOM,PSONOOR)
"RTN","PSOCAN4",51,0)
 D PSOUL^PSSLOCK(ORD_"S")
"RTN","PSOCAN4",52,0)
OK S ORD=SAVORD,ORN=SAVORN Q
"RTN","PSOCAN4",53,0)
NOOR ;ask nature of order
"RTN","PSOCAN4",54,0)
 D FULL^VALM1
"RTN","PSOCAN4",55,0)
 K DIR,DTOUT,DTOUT,DIRUT I $T(NA^ORX1)]"" D  Q:$D(DIRUT)  G NOORXP
"RTN","PSOCAN4",56,0)
 .S PSONOOR=$$NA^ORX1("S",0,"B","Nature of Order",0,"WPSDIVR"_$S(+$G(^VA(200,DUZ,"PS")):"E",1:""))
"RTN","PSOCAN4",57,0)
 .I +PSONOOR S PSONOOR=$P(PSONOOR,"^",3) Q
"RTN","PSOCAN4",58,0)
 .S DIRUT=1 K PSONOOR
"RTN","PSOCAN4",59,0)
 S DIR("A")="Nature of Order: ",DIR("B")=$S($G(DODR):"SERVICE CORRECTED",1:"WRITTEN")
"RTN","PSOCAN4",60,0)
 S DIR(0)="SA^W:WRITTEN;V:VERBAL;P:TELEPHONE;S:SERVICE CORRECTED;D:DUPLICATE;I:POLICY;R:SERVICE REJECTED"_$S(+$G(^VA(200,DUZ,"PS")):";E:PROVIDER ENTERED",1:"")
"RTN","PSOCAN4",61,0)
 D ^DIR K DIR,DTOUT,DTOUT Q:$D(DIRUT)  S PSONOOR=Y
"RTN","PSOCAN4",62,0)
NOORXP I $G(PSOCANRA),'$G(PSOCANRZ) D REQ
"RTN","PSOCAN4",63,0)
NOORX S:$D(DIRUT)&($G(SPEED)) VALMBCK="Q"
"RTN","PSOCAN4",64,0)
 Q
"RTN","PSOCAN4",65,0)
DEL ;deletes non-verified Rxs
"RTN","PSOCAN4",66,0)
 D FULL^VALM1
"RTN","PSOCAN4",67,0)
 W ! K DIR,DIRUT,DUOUT S DIR(0)="Y",DIR("B")="No",DIR("A",1)="Rx # "_$P(^PSRX($P(PSOLST(ORN),"^",2),0),"^")_" is in a Non-Verified Status.",DIR("A")="Are sure you want to mark the Rx as deleted" D ^DIR I 'Y!($D(DIRUT)) S VALMBCK="R" G EX
"RTN","PSOCAN4",68,0)
 I '$G(SPEED) D  I $D(DIRUT) G EX
"RTN","PSOCAN4",69,0)
 .D NOOR^PSOCAN4 I $D(DIRUT) S VALMSG="No Action Taken!",VALMBCK="R" Q
"RTN","PSOCAN4",70,0)
 .K DIR S DIR("A")="Comments",DIR("B")="Per Pharmacy Request",DIR(0)="F^5:100" D ^DIR K DIR I $D(DIRUT) S VALMSG="No Action Taken!" Q
"RTN","PSOCAN4",71,0)
 K PSDEL,PSORX("INTERVENE") S PSOZVER=1,DA=$P(PSOLST(ORN),"^",2)
"RTN","PSOCAN4",72,0)
 I $G(PKI1) N INCOM S INCOM=Y D DCV^PSOPKIV1 Q
"RTN","PSOCAN4",73,0)
 D ENQ^PSORXDL
"RTN","PSOCAN4",74,0)
EX Q
"RTN","PSOCAN4",75,0)
REQ ;prompt for requesting provider
"RTN","PSOCAN4",76,0)
 I '$G(PSOCANRD),$G(PSOCANRP),$G(ORD),$D(^PS(52.41,ORD,0)) S PSOCANRD=+$P($G(^PS(52.41,ORD,0)),"^",5)
"RTN","PSOCAN4",77,0)
 I $G(PSOCANRD) D
"RTN","PSOCAN4",78,0)
 .I $D(^VA(200,PSOCANRD,"PS")),$P($G(^("PS")),"^"),$S('$P(^("PS"),"^",4):1,1:$P(^("PS"),"^",4)'<DT) Q
"RTN","PSOCAN4",79,0)
 .K PSOCANRD
"RTN","PSOCAN4",80,0)
 W ! K DIC S DIC=200,DIC(0)="AEQMZ",DIC("A")="Requesting PROVIDER: ",DIC("S")="I $D(^(""PS"")),$P(^(""PS""),""^""),$S('$P(^(""PS""),""^"",4):1,1:$P(^(""PS""),""^"",4)'<DT)" I $G(PSOCANRD) S DIC("B")=PSOCANRD
"RTN","PSOCAN4",81,0)
 D ^DIC K DIC S:$G(Y)<0!($D(DTOUT))!($D(DUOUT)) DIRUT=1 I $G(Y) S PSOCANRC=+$G(Y),PSOCANRN=$P($G(Y),"^",2),PSOCANRZ=1
"RTN","PSOCAN4",82,0)
 Q
"RTN","PSOCAN4",83,0)
RQTEST ;
"RTN","PSOCAN4",84,0)
 N PMIN,PMINZ,PMINFLAG
"RTN","PSOCAN4",85,0)
 S PMINFLAG=0 F PMIN=1:1:$L(LST,",") Q:$P(LST,",",PMIN)']""  S PMINZ=$P(LST,",",PMIN) D
"RTN","PSOCAN4",86,0)
 .I $P($G(PSOLST(PMINZ)),"^")=52 I $P($G(^PSRX(+$P($G(PSOLST(PMINZ)),"^",2),"STA")),"^")'=12,'$G(PMINFLAG) S PSOCANRD=+$P($G(^PSRX(+$P($G(PSOLST(PMINZ)),"^",2),0)),"^",4) S PMINFLAG=1
"RTN","PSOCAN4",87,0)
 .I $P($G(PSOLST(PMINZ)),"^")=52.41,'$G(PMINFLAG) S PSOCANRD=$P($G(^PS(52.41,+$P($G(PSOLST(PMINZ)),"^",2),0)),"^",5) S PMINFLAG=1
"RTN","PSOCAN4",88,0)
 I '$G(PMINFLAG) S PSOCANRZ=1
"RTN","PSOCAN4",89,0)
 Q
"RTN","PSOCAN4",90,0)
MEDDIS ;
"RTN","PSOCAN4",91,0)
 N PSOFMMD
"RTN","PSOCAN4",92,0)
 Q:'$G(ORD)
"RTN","PSOCAN4",93,0)
 Q:'$D(^PS(52.41,ORD,0))
"RTN","PSOCAN4",94,0)
 I $P(^PS(52.41,ORD,0),"^",9) W "Drug: "_$P($G(^PSDRUG(+$P(^PS(52.41,ORD,0),"^",9),0)),"^") D PAUSE^VALM1 Q
"RTN","PSOCAN4",95,0)
 I $P(^PS(52.41,ORD,0),"^",8) S PSOFMMD=$P(^(0),"^",8) W "Orderable Item: "_$P($G(^PS(50.7,PSOFMMD,0)),"^")_"  "_$P($G(^PS(50.606,+$P($G(^PS(50.7,PSOFMMD,0)),"^",2),0)),"^") D PAUSE^VALM1
"RTN","PSOCAN4",96,0)
 Q
"RTN","PSOCAN4",97,0)
 ;
"RTN","PSOCAN4",98,0)
REF ;CONT. FROM REF^PSOCAN2; PSO*7*259
"RTN","PSOCAN4",99,0)
 N PSOSIEN S PSOSIEN=0
"RTN","PSOCAN4",100,0)
 F  S PSOSIEN=$O(^PS(52.5,"B",DA,PSOSIEN)) Q:'PSOSIEN  D  Q:PSONODEL
"RTN","PSOCAN4",101,0)
 .I $P($G(^PS(52.5,PSOSIEN,0)),"^",13)'=IFN Q  ;NOT SAME REFILL
"RTN","PSOCAN4",102,0)
 .I '$P($G(^PS(52.5,PSOSIEN,"P")),"^") Q  ;SUSPENSE LABEL PRINT
"RTN","PSOCAN4",103,0)
 .S PSONODEL=1   ;REFILL NODE SHOULD NOT BE DELETED
"RTN","PSOCAN4",104,0)
 Q
"RTN","PSOCIDC2")
0^64^B71704423
"RTN","PSOCIDC2",1,0)
PSOCIDC2 ;BIR/LE-continuation of Copay Correction of erroneous billed copays ;11/8/05 12:50pm
"RTN","PSOCIDC2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**226,225**;DEC 1997;Build 29
"RTN","PSOCIDC2",3,0)
 ;External reference to ^XUSEC supported by DBIA 10076
"RTN","PSOCIDC2",4,0)
 ;External reference to IBARX supported by DBIA 125
"RTN","PSOCIDC2",5,0)
 ;External reference to $$PROD^XUPROD(1) supported by DBIA 4440
"RTN","PSOCIDC2",6,0)
 ;
"RTN","PSOCIDC2",7,0)
TOTAL ;
"RTN","PSOCIDC2",8,0)
 N COUNT,COUNTED,UCOUNT,UCOUNTED,CCOUNT,CCOUNTED
"RTN","PSOCIDC2",9,0)
 I '$D(PSOVETS) S PSOVETS=0
"RTN","PSOCIDC2",10,0)
 N I,J
"RTN","PSOCIDC2",11,0)
 F I=1:1:3 S (PSOCNT("YR2004",I),PSOCNT("YR2005",I),PSOCNT("YR2006",I))=0
"RTN","PSOCIDC2",12,0)
 S PSODFN=0 F  S PSODFN=$O(^XTMP(NAMSP,"TOT REL",PSODFN)) Q:'PSODFN  D
"RTN","PSOCIDC2",13,0)
 .S COUNTED=0
"RTN","PSOCIDC2",14,0)
 .F J="YR2004","YR2005","YR2006" F I=1:1:3 S COUNT=$G(^XTMP(NAMSP,"TOT REL",PSODFN,J,I)) I COUNT>0 S:'$G(COUNTED) COUNTED=1,PSOVETS=PSOVETS+1 S PSOCNT(J,I)=PSOCNT(J,I)+COUNT
"RTN","PSOCIDC2",15,0)
 F I=1:1:3 S PSOCNT=PSOCNT+$G(PSOCNT("YR2004",I))+$G(PSOCNT("YR2005",I))+$G(PSOCNT("YR2006",I))
"RTN","PSOCIDC2",16,0)
 ;
"RTN","PSOCIDC2",17,0)
 S (I,J)=-""
"RTN","PSOCIDC2",18,0)
 I '$D(PSOCVETS) S PSOCVETS=0
"RTN","PSOCIDC2",19,0)
 F I=1:1:3 S (PSOCCNT("YR2004",I),PSOCCNT("YR2005",I),PSOCCNT("YR2006",I))=0
"RTN","PSOCIDC2",20,0)
 S PSODFN=0 F  S PSODFN=$O(^XTMP(NAMSP,"TOT CAN",PSODFN)) Q:'PSODFN  D
"RTN","PSOCIDC2",21,0)
 .S CCOUNTED=0
"RTN","PSOCIDC2",22,0)
 .F J="YR2004","YR2005","YR2006" F I=1:1:3 S CCOUNT=$G(^XTMP(NAMSP,"TOT CAN",PSODFN,J,I)) I CCOUNT>0 S:'$G(CCOUNTED) CCOUNTED=1,PSOCVETS=PSOCVETS+1 S PSOCCNT(J,I)=PSOCCNT(J,I)+CCOUNT
"RTN","PSOCIDC2",23,0)
 F I=1:1:3 S PSOCCNT=PSOCCNT+$G(PSOCCNT("YR2004",I))+$G(PSOCCNT("YR2005",I))+$G(PSOCCNT("YR2006",I))
"RTN","PSOCIDC2",24,0)
 ;
"RTN","PSOCIDC2",25,0)
 S (I,J)=""
"RTN","PSOCIDC2",26,0)
 I '$D(PSOUVETS) S PSOUVETS=0
"RTN","PSOCIDC2",27,0)
 F I=1:1:3 S (PSOUCNT("YR2004",I),PSOUCNT("YR2005",I),PSOUCNT("YR2006",I))=0
"RTN","PSOCIDC2",28,0)
 S PSOUDFN=0 F  S PSOUDFN=$O(^XTMP(NAMSP,"TOT UNREL",PSOUDFN)) Q:'PSOUDFN  D
"RTN","PSOCIDC2",29,0)
 .S UCOUNTED=0
"RTN","PSOCIDC2",30,0)
 .F J="YR2004","YR2005","YR2006" F I=1:1:3 S UCOUNT=$G(^XTMP(NAMSP,"TOT UNREL",PSOUDFN,J,I)) I UCOUNT>0 S:'$G(UCOUNTED) UCOUNTED=1,PSOUVETS=PSOUVETS+1 S PSOUCNT(J,I)=PSOUCNT(J,I)+UCOUNT
"RTN","PSOCIDC2",31,0)
 F I=1:1:3 S PSOUCNT=PSOUCNT+$G(PSOUCNT("YR2004",I))+$G(PSOUCNT("YR2005",I))+$G(PSOUCNT("YR2006",I))
"RTN","PSOCIDC2",32,0)
 ;
"RTN","PSOCIDC2",33,0)
 Q
"RTN","PSOCIDC2",34,0)
 ;
"RTN","PSOCIDC2",35,0)
CHECK ;check for ICD and IB nodes
"RTN","PSOCIDC2",36,0)
 ;
"RTN","PSOCIDC2",37,0)
 N PSOREF,PSOIB,PSOOICD,PSOBILLD
"RTN","PSOCIDC2",38,0)
 S PSOREF=YY
"RTN","PSOCIDC2",39,0)
 S PSOOICD=$P($G(^PSRX(RXP,"ICD",1,0)),"^",2,8)
"RTN","PSOCIDC2",40,0)
 ; see if bill already exists
"RTN","PSOCIDC2",41,0)
 I PSOREF=0 D
"RTN","PSOCIDC2",42,0)
 . I +$P($G(^PSRX(RXP,"IB")),"^",2)>0 D CHKIB^PSOCP1
"RTN","PSOCIDC2",43,0)
 . S PSOREL=$P($G(^PSRX(RXP,2)),"^",13)
"RTN","PSOCIDC2",44,0)
 I PSOREF>0 D
"RTN","PSOCIDC2",45,0)
 . I +$G(^PSRX(RXP,1,PSOREF,"IB")) D CHKIB^PSOCP1
"RTN","PSOCIDC2",46,0)
 . S PSOREL=$P($G(^PSRX(RXP,1,YY,0)),"^",18)
"RTN","PSOCIDC2",47,0)
 I $G(PSOIB)=1!($G(PSOIB)=3) S PSOBILLD=1
"RTN","PSOCIDC2",48,0)
 ;    if billed/RELEASED and no IBQ node for both sc<50 and nsc
"RTN","PSOCIDC2",49,0)
 I $G(PSOBILLD)&('$D(^PSRX(RXP,"IBQ"))) D
"RTN","PSOCIDC2",50,0)
 . I $TR(PSOOICD,"^")[1  S ^XTMP(NAMSP,"CANCEL",PSODFN,RXP,YY)=$P(PSOREL,".")_"^"_PSODT_"^"_PSOSCP
"RTN","PSOCIDC2",51,0)
 . I $TR(PSOOICD,"^")[0 S ^XTMP(NAMSP,"NOIBQ",PSODFN,RXP,YY)=$P(PSOREL,".")_"^"_PSODT_"^"_PSOSCP
"RTN","PSOCIDC2",52,0)
 ;           find unbilled ones with an ICD node and no IBQ node.
"RTN","PSOCIDC2",53,0)
 I '$G(PSOBILLD)&('$D(^PSRX(RXP,"IBQ"))) D
"RTN","PSOCIDC2",54,0)
 . Q:$TR(PSOOICD,"^")=""
"RTN","PSOCIDC2",55,0)
 . S ^XTMP(NAMSP,"NOIBQ",PSODFN,RXP,YY)=$P(PSOREL,".")_"^"_PSODT_"^"_PSOSCP
"RTN","PSOCIDC2",56,0)
 I YY S PSOTRF=PSOTRF+1
"RTN","PSOCIDC2",57,0)
 Q
"RTN","PSOCIDC2",58,0)
 ;
"RTN","PSOCIDC2",59,0)
CANCEL ;Cancel erroneous copays/set IBQ node if not there
"RTN","PSOCIDC2",60,0)
 ;released rx's
"RTN","PSOCIDC2",61,0)
 N PSOCAP,PSODIV,PSODV,PSOFILL,PSOLOG,PSONAM,PSOOUT,PSOPAR,PSOPAR7,PSOSITE
"RTN","PSOCIDC2",62,0)
 N PSOSITE7,PSOSQ,PSOTOT,PSOYEAR,PSOYR,SSN,SAVCPUN,SAVREF,PSOIB,PSOOIBQ,PSONIBQ,PSOOICD,PSOOIB
"RTN","PSOCIDC2",63,0)
 N I,IFN,PSOANSQ,PSOTYP,COM,CC,PREA,PSONW,PSOOLD,PSOREL,PSO,PSOCPUN,PSOFLD,PSOTYPE,CANCEL
"RTN","PSOCIDC2",64,0)
 S PSOTYPE="CAN"
"RTN","PSOCIDC2",65,0)
 S PSODFN=0 F CC=1:1 S PSODFN=$O(^XTMP(NAMSP,"CANCEL",PSODFN)) Q:'PSODFN  D  Q:STOP
"RTN","PSOCIDC2",66,0)
 .I CC#100=0,$D(^XTMP(NAMSP,0,"STOP")) D  Q
"RTN","PSOCIDC2",67,0)
 .. S $P(^XTMP(NAMSP,0,"LAST"),"^",1,2)="STOP^"_$$NOW^XLFDT,STOP=1
"RTN","PSOCIDC2",68,0)
 .S (PSOCAP(304),PSOCAP(305),PSOCAP(306))=0 ; INITIAL ANNUAL CAP FOR 2004 & 2005
"RTN","PSOCIDC2",69,0)
 .F RXP=0:0 S RXP=$O(^XTMP(NAMSP,"CANCEL",PSODFN,RXP)) Q:'RXP  D
"RTN","PSOCIDC2",70,0)
 ..S (SAVCPUN,PSOCPUN)=($P(^PSRX(RXP,0),"^",8)+29)\30
"RTN","PSOCIDC2",71,0)
 ..S YY="" F  S YY=$O(^XTMP(NAMSP,"CANCEL",PSODFN,RXP,YY)) Q:YY=""  D
"RTN","PSOCIDC2",72,0)
 ...S (SAVREF,PSOREF)=YY
"RTN","PSOCIDC2",73,0)
 ...;  verify again that it was billed and not already cancelled
"RTN","PSOCIDC2",74,0)
 ...S PSOBILLD=0
"RTN","PSOCIDC2",75,0)
 ...I YY=0,+$P($G(^PSRX(RXP,"IB")),"^",2)>0 D CHKIB^PSOCP1 I $G(PSOIB)=1!($G(PSOIB)=3) S PSOBILLD=1
"RTN","PSOCIDC2",76,0)
 ...I YY>0,+$P($G(^PSRX(RXP,1,PSOREF,"IB")),"^")>0 D CHKIB^PSOCP1 I $G(PSOIB)=1!($G(PSOIB)=3) S PSOBILLD=1
"RTN","PSOCIDC2",77,0)
 ...Q:'PSOBILLD
"RTN","PSOCIDC2",78,0)
 ...S PSOREL=$P($G(^XTMP(NAMSP,"CANCEL",PSODFN,RXP,YY)),"^"),PSOFLD=$P($G(^XTMP(NAMSP,"CANCEL",PSODFN,RXP,YY)),"^",2),PSOSCP=$P($G(^XTMP(NAMSP,"CANCEL",PSODFN,RXP,YY)),"^",3)
"RTN","PSOCIDC2",79,0)
 ...S PSO=3 D NOW^%DTC S PSODT=%,PSODA=RXP,PSOCOMM="-BKGD CIDC COPAY CANCEL",PSOOLD="",PSONW="",PREA=""
"RTN","PSOCIDC2",80,0)
 ...D CHKACT
"RTN","PSOCIDC2",81,0)
 ...S PSOIB="",PSOIB=$S(PSOREF>0:$G(^PSRX(RXP,1,YY,"IB")),'PSOREF:$G(^PSRX(PSODA,"IB")),1:"")
"RTN","PSOCIDC2",82,0)
 ...S (PSOOIBQ,PSOOICD,PSOOIB)=""
"RTN","PSOCIDC2",83,0)
 ...S PSOOICD=$P($G(^PSRX(RXP,"ICD",1,0)),"^",2,8),PSOOIB=$G(^PSRX(RXP,"IB")),PSOOIBQ=$G(^PSRX(RXP,"IBQ"))
"RTN","PSOCIDC2",84,0)
 ...I PSOOIBQ=""&($TR(PSOOICD,"^")[0!($TR(PSOOICD,"^")[1)) D SETIBQ
"RTN","PSOCIDC2",85,0)
 ...D SITE S PSOCOMM="-BKGD CIDC COPAY CANCEL" D RXED^PSOCPA S:PSOOICD[1&($D(^PSRX(RXP,"IB"))) $P(^PSRX(RXP,"IB"),"^")=""
"RTN","PSOCIDC2",86,0)
 ...S PSOCPUN=SAVCPUN,PSOREF=SAVREF
"RTN","PSOCIDC2",87,0)
 ...D ACCUM
"RTN","PSOCIDC2",88,0)
 ;
"RTN","PSOCIDC2",89,0)
 ;ICD NODES WITHOUT IBQ NODE; set IBQ node but only set 1st piece of IB node if unreleased.
"RTN","PSOCIDC2",90,0)
 S PSOTYP="IBQ"
"RTN","PSOCIDC2",91,0)
 S PSODFN=0 F CC=1:1 S PSODFN=$O(^XTMP(NAMSP,"NOIBQ",PSODFN)) Q:'PSODFN  D  Q:STOP
"RTN","PSOCIDC2",92,0)
 .I CC#100=0,$D(^XTMP(NAMSP,0,"STOP")) D  Q
"RTN","PSOCIDC2",93,0)
 .. S $P(^XTMP(NAMSP,0,"LAST"),"^",1,2)="STOP^"_$$NOW^XLFDT,STOP=1
"RTN","PSOCIDC2",94,0)
 .S (PSOCAP(304),PSOCAP(305),PSOCAP(306))=0 ; INITIAL ANNUAL CAP FOR 2004 & 2005
"RTN","PSOCIDC2",95,0)
 .F RXP=0:0 S RXP=$O(^XTMP(NAMSP,"NOIBQ",PSODFN,RXP)) Q:'RXP  D
"RTN","PSOCIDC2",96,0)
 ..S (SAVCPUN,PSOCPUN)=($P(^PSRX(RXP,0),"^",8)+29)\30
"RTN","PSOCIDC2",97,0)
 ..S YY="" F  S YY=$O(^XTMP(NAMSP,"NOIBQ",PSODFN,RXP,YY)) Q:YY=""  D
"RTN","PSOCIDC2",98,0)
 ...S (SAVREF,PSOREF)=YY
"RTN","PSOCIDC2",99,0)
 ...D SITE
"RTN","PSOCIDC2",100,0)
 ...S PSOREL=$P($G(^XTMP(NAMSP,"NOIBQ",PSODFN,RXP,YY)),"^"),PSOFLD=$P($G(^XTMP(NAMSP,"NOIBQ",PSODFN,RXP,YY)),"^",2),PSOSCP=$P($G(^XTMP(NAMSP,"NOIBQ",PSODFN,RXP,YY)),"^",3)
"RTN","PSOCIDC2",101,0)
 ...S (PSOOIBQ,PSOOICD,PSOOIB)=""
"RTN","PSOCIDC2",102,0)
 ...S PSOOICD=$P($G(^PSRX(RXP,"ICD",1,0)),"^",2,8),PSOOIB=$G(^PSRX(RXP,"IB")),PSOOIBQ=$G(^PSRX(RXP,"IBQ"))
"RTN","PSOCIDC2",103,0)
 ...I PSOOIBQ=""&($TR(PSOOICD,"^")[0!($TR(PSOOICD,"^")[1)) D SETIBQ D   ;don't want to set again if already did it as part of copay cancel
"RTN","PSOCIDC2",104,0)
 ....S I="",IFN=0 F I=0:0 S I=$O(^PSRX(RXP,"A",I)) Q:'I  S IFN=I
"RTN","PSOCIDC2",105,0)
 ....S COM=" BKGD CIDC UPDATE"
"RTN","PSOCIDC2",106,0)
 ....D NOW^%DTC S IFN=IFN+1,^PSRX(RXP,"A",0)="^52.3DA^"_IFN_"^"_IFN,^PSRX(RXP,"A",IFN,0)=%_"^I^.5^"_YY_"^"_COM
"RTN","PSOCIDC2",107,0)
 ....K DA
"RTN","PSOCIDC2",108,0)
 ....S:PSOOICD[1&($D(^PSRX(RXP,"IB"))) $P(^PSRX(RXP,"IB"),"^")=""
"RTN","PSOCIDC2",109,0)
 ...D:'$G(^XTMP(NAMSP,"CANCEL",PSODFN,RXP,YY)) ACCUM
"RTN","PSOCIDC2",110,0)
 ...S PSOCPUN=SAVCPUN,PSOREF=SAVREF
"RTN","PSOCIDC2",111,0)
 Q
"RTN","PSOCIDC2",112,0)
 ;
"RTN","PSOCIDC2",113,0)
CHKACT ;check activity log for prev entry
"RTN","PSOCIDC2",114,0)
 N ZACT,ZPSI,ZACTI
"RTN","PSOCIDC2",115,0)
 S ZPSI=0 F  S ZPSI=$O(^PSRX(PSODA,"COPAY",ZPSI)) Q:ZPSI=""  S ZACTI="",ZACTI=$G(^PSRX(PSODA,"COPAY",ZPSI,0)) D  Q:$G(ZACT)
"RTN","PSOCIDC2",116,0)
 . I ZACTI["BKGD CIDC COPAY CANCEL"&($P(ZACTI,"^",2)="R") S PSOOLD="",PSONW="",PREA="C",ZACT=1 Q
"RTN","PSOCIDC2",117,0)
 I '$G(ZACT) S PSOOLD="Copay",PSONW="No Copay",PREA="R" K PSOREF D ACTLOG^PSOCPA S PSOREF=YY,PSOOLD="",PSONW="",PREA="C"
"RTN","PSOCIDC2",118,0)
 Q
"RTN","PSOCIDC2",119,0)
 ;
"RTN","PSOCIDC2",120,0)
SETIBQ ; get data from IBQ node, set IBQ node, and 1st piece of IB node
"RTN","PSOCIDC2",121,0)
 K PSOANSQ
"RTN","PSOCIDC2",122,0)
 N PSONIBQ
"RTN","PSOCIDC2",123,0)
 F PSOTYP=1:1:8 D
"RTN","PSOCIDC2",124,0)
 . I PSOTYP=1 S PSOANSQ("VEH")=$P(PSOOICD,"^",PSOTYP)
"RTN","PSOCIDC2",125,0)
 . I PSOTYP=2 S PSOANSQ("RAD")=$P(PSOOICD,"^",PSOTYP)
"RTN","PSOCIDC2",126,0)
 . I PSOTYP=3 S PSOANSQ("SC")=$P(PSOOICD,"^",PSOTYP)
"RTN","PSOCIDC2",127,0)
 . I PSOTYP=4 S PSOANSQ("PGW")=$P(PSOOICD,"^",PSOTYP)
"RTN","PSOCIDC2",128,0)
 . I PSOTYP=5 S PSOANSQ("MST")=$P(PSOOICD,"^",PSOTYP)
"RTN","PSOCIDC2",129,0)
 . I PSOTYP=6 S PSOANSQ("HNC")=$P(PSOOICD,"^",PSOTYP)
"RTN","PSOCIDC2",130,0)
 . I PSOTYP=7 S PSOANSQ("CV")=$P(PSOOICD,"^",PSOTYP)
"RTN","PSOCIDC2",131,0)
 . I PSOTYP=8 S PSOANSQ("SHAD")=$P(PSOOICD,"^",PSOTYP)
"RTN","PSOCIDC2",132,0)
 S ^PSRX(RXP,"IBQ")=PSOANSQ("SC")_"^"_PSOANSQ("MST")_"^"_PSOANSQ("VEH")_"^"_PSOANSQ("RAD")_"^"_PSOANSQ("PGW")_"^"_PSOANSQ("HNC")_"^"_PSOANSQ("CV")_"^"_PSOANSQ("SHAD")
"RTN","PSOCIDC2",133,0)
 Q
"RTN","PSOCIDC2",134,0)
 ;
"RTN","PSOCIDC2",135,0)
ACCUM ; ACCUMULATE TOTALS
"RTN","PSOCIDC2",136,0)
 S (PSOTOT,PSOYR,PSOYEAR,PSOLOG,PSONAM,PSOCHRG)=""
"RTN","PSOCIDC2",137,0)
 ; get finished, but unreleased totals
"RTN","PSOCIDC2",138,0)
 I PSOREL="" S PSOYR=$E(PSOFLD,1,3) Q:PSOYR=""  D  S PSOYEAR="" Q
"RTN","PSOCIDC2",139,0)
 .S PSOYEAR=$S(PSOYR="304":"YR2004",PSOYR="305":"YR2005",PSOYR="306":"YR2006",1:"") Q:PSOYEAR=""
"RTN","PSOCIDC2",140,0)
 .S PSOCHRG=7
"RTN","PSOCIDC2",141,0)
 .I PSOYEAR="YR2006" S PSOCHRG=8
"RTN","PSOCIDC2",142,0)
 .S PSOTOT=$G(^XTMP(NAMSP,"TOT UNREL",PSODFN,PSOYEAR))
"RTN","PSOCIDC2",143,0)
 .S ^XTMP(NAMSP,"TOT UNREL",PSODFN,PSOYEAR)=PSOTOT+(PSOCPUN*PSOCHRG)
"RTN","PSOCIDC2",144,0)
 .S ^XTMP(NAMSP,"TOT UNREL",PSODFN,PSOYEAR,PSOCPUN)=$G(^XTMP(NAMSP,"TOT UNREL",PSODFN,PSOYEAR,PSOCPUN))+1
"RTN","PSOCIDC2",145,0)
 .S PSONAM=$P($G(^DPT(PSODFN,0)),"^"),PSONAM=$P(PSONAM,",")
"RTN","PSOCIDC2",146,0)
 .S PSONAM=$E(PSONAM,1,6)
"RTN","PSOCIDC2",147,0)
 .S ^XTMP(NAMSP,"IBQ UPD",PSONAM,PSODFN,RXP,PSOREF)=PSOFLD
"RTN","PSOCIDC2",148,0)
 ;for released ones
"RTN","PSOCIDC2",149,0)
 S PSOYR=$E(PSOREL,1,3)
"RTN","PSOCIDC2",150,0)
 S:PSOYR'="" PSOYEAR=$S(PSOYR="304":"YR2004",PSOYR="305":"YR2005",PSOYR="306":"YR2006",1:"")
"RTN","PSOCIDC2",151,0)
 Q:PSOYEAR=""
"RTN","PSOCIDC2",152,0)
 S PSOCHRG=7
"RTN","PSOCIDC2",153,0)
 I PSOYEAR="YR2006" S PSOCHRG=8
"RTN","PSOCIDC2",154,0)
 ;
"RTN","PSOCIDC2",155,0)
 ;get Xtmp billing amt which would be IBAM tot + any previous refills
"RTN","PSOCIDC2",156,0)
 S PSOTOT=$G(^XTMP(NAMSP,"TOT REL",PSODFN,PSOYEAR))
"RTN","PSOCIDC2",157,0)
 ;
"RTN","PSOCIDC2",158,0)
 ;if none yet then init to the IBAM total for the year
"RTN","PSOCIDC2",159,0)
 I 'PSOTOT D
"RTN","PSOCIDC2",160,0)
 .F PSOSQ=0:0 S PSOSQ=$O(^IBAM(354.7,PSODFN,1,PSOSQ)) Q:'PSOSQ  D
"RTN","PSOCIDC2",161,0)
 ..S PSOLOG=$G(^IBAM(354.7,PSODFN,1,PSOSQ,0))
"RTN","PSOCIDC2",162,0)
 ..I $E(PSOLOG,1,3)=PSOYR S PSOTOT=PSOTOT+$P(PSOLOG,"^",2)
"RTN","PSOCIDC2",163,0)
 ;
"RTN","PSOCIDC2",164,0)
 ;update Xtmp tot nodes with current fill amounts
"RTN","PSOCIDC2",165,0)
 ;  note:  cancel copays and updated IBQ node released prescription are collected under TOT REL for the RPT^PSOCIDC3
"RTN","PSOCIDC2",166,0)
 ;             routine.  Cancelled copays are denoted with an asterisk.
"RTN","PSOCIDC2",167,0)
 S ^XTMP(NAMSP,"TOT REL",PSODFN,PSOYEAR)=PSOTOT+(PSOCPUN*PSOCHRG)
"RTN","PSOCIDC2",168,0)
 S ^XTMP(NAMSP,"TOT REL",PSODFN,PSOYEAR,PSOCPUN)=$G(^XTMP(NAMSP,"TOT REL",PSODFN,PSOYEAR,PSOCPUN))+1
"RTN","PSOCIDC2",169,0)
 ;
"RTN","PSOCIDC2",170,0)
 ;indicate COPAY CANCEL for this fill 
"RTN","PSOCIDC2",171,0)
 ;       ;by adding to Xtmp "BILLED"
"RTN","PSOCIDC2",172,0)
 S PSONAM=$P($G(^DPT(PSODFN,0)),"^"),PSONAM=$P(PSONAM,",")
"RTN","PSOCIDC2",173,0)
 S PSONAM=$E(PSONAM,1,6)
"RTN","PSOCIDC2",174,0)
 S ^XTMP(NAMSP,"REL",PSONAM,PSODFN,RXP,PSOREF)=PSOREL
"RTN","PSOCIDC2",175,0)
 ;
"RTN","PSOCIDC2",176,0)
CAN I PSOTYPE="CAN"&($G(^XTMP(NAMSP,"CANCEL",PSODFN,RXP,YY))) N PSOFILL S CANCEL="" S PSOFILL=YY D CHK^PSOCIDC3 I CANCEL D
"RTN","PSOCIDC2",177,0)
 . S ^XTMP(NAMSP,"TOT CAN",PSODFN,PSOYEAR)=PSOTOT+(PSOCPUN*PSOCHRG)
"RTN","PSOCIDC2",178,0)
 . S ^XTMP(NAMSP,"TOT CAN",PSODFN,PSOYEAR,PSOCPUN)=$G(^XTMP(NAMSP,"TOT CAN",PSODFN,PSOYEAR,PSOCPUN))+1
"RTN","PSOCIDC2",179,0)
 Q
"RTN","PSOCIDC2",180,0)
 ;
"RTN","PSOCIDC2",181,0)
SITE ; SET UP VARIABLES NEEDED BY BILLING
"RTN","PSOCIDC2",182,0)
 S PSOSITE=$S(YY=0:$P(^PSRX(RXP,2),"^",9),1:$P($G(^PSRX(RXP,1,YY,0)),"^",9))
"RTN","PSOCIDC2",183,0)
 Q:PSOSITE=""
"RTN","PSOCIDC2",184,0)
 S PSOPAR=$G(^PS(59,PSOSITE,1))
"RTN","PSOCIDC2",185,0)
 S PSOPAR7=$G(^PS(59,PSOSITE,"IB"))
"RTN","PSOCIDC2",186,0)
 S PSOSITE7=$P($G(^PS(59,PSOSITE,"IB")),"^")
"RTN","PSOCIDC2",187,0)
 Q
"RTN","PSOCIDC2",188,0)
 ;
"RTN","PSOCP")
0^1^B67321239
"RTN","PSOCP",1,0)
PSOCP ;BIR/BAB - Pharmacy CO-PAY Application Utilities for IB ;02/06/92
"RTN","PSOCP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**20,46,71,85,137,157,143,219,239,201,225**;DEC 1997;Build 29
"RTN","PSOCP",3,0)
 ;
"RTN","PSOCP",4,0)
 ;REF/IA - IBARX/125, SDCO22/1579, PS(55/2228, PSDRUG(/221, DGMSTAPI/2716, $$GETSHAD^DGUTL3/4462 
"RTN","PSOCP",5,0)
CP ;Check if COPAY-Requires RXP,PSOSITE7
"RTN","PSOCP",6,0)
 I '$D(PSOPAR) D ^PSOLSET G CP
"RTN","PSOCP",7,0)
 K PSOCP
"RTN","PSOCP",8,0)
 S PSOCPN=$P(^PSRX(RXP,0),"^",2) ; Set COPAY dfn PTR TO PATIENT
"RTN","PSOCP",9,0)
 S PSOCP=$P($G(^PSRX(RXP,"IB")),"^") ; IB action type
"RTN","PSOCP",10,0)
 S PSOSAVE=$S(PSOCP:1,1:"") ; save current copay status
"RTN","PSOCP",11,0)
 ; Set x=service^dfn^actiontype^user duz
"RTN","PSOCP",12,0)
 I +$G(PSOSITE7)'>0 S PSOSITE7=$P(^PS(59,PSOSITE,"IB"),"^")
"RTN","PSOCP",13,0)
 S X=PSOSITE7_"^"_PSOCPN_"^"_PSOCP_"^"_$P(^PSRX(RXP,0),"^",16)
"RTN","PSOCP",14,0)
 ;
"RTN","PSOCP",15,0)
RX ;Determine Orig or Refill for RX
"RTN","PSOCP",16,0)
 N PSOIB,PSOPFS S (PSOIB,PSOREF)=0
"RTN","PSOCP",17,0)
 I $G(^PSRX(RXP,1,+$G(YY),0))]"" S PSOREF=YY
"RTN","PSOCP",18,0)
 D PFSA^PSOPFSU1(RXP,PSOREF,2) G PFS:+PSOPFS
"RTN","PSOCP",19,0)
 ; Check if bill exists
"RTN","PSOCP",20,0)
 I 'PSOREF,+$P($G(^PSRX(RXP,"IB")),"^",2)>0 D CHKIB^PSOCP1 I PSOIB G QUIT
"RTN","PSOCP",21,0)
 I 'PSOREF,+$P($G(^PSRX(RXP,"IB")),"^",4)>0 G QUIT ; 'POTENTIAL BILL' - ALREADY ATTEMPTED TO BILL, BUT EXCEEDED ANNUAL COPAY CAP
"RTN","PSOCP",22,0)
 I PSOREF,+$G(^PSRX(RXP,1,PSOREF,"IB")) D CHKIB^PSOCP1 I PSOIB G QUIT
"RTN","PSOCP",23,0)
 I PSOREF,+$P($G(^PSRX(RXP,1,PSOREF,"IB")),"^",2) G QUIT ; POTENTIAL BILL
"RTN","PSOCP",24,0)
PFS ;
"RTN","PSOCP",25,0)
 S PSOCHG=1 ; set tem var to copay and check exception
"RTN","PSOCP",26,0)
 N MAILMSG
"RTN","PSOCP",27,0)
 D COPAYREL
"RTN","PSOCP",28,0)
 I 'PSOCHG D  D:PSOPFS CHRG^PSOPFSU1(RXP,PSOREF,"CG",PSOPFS) G QUIT
"RTN","PSOCP",29,0)
 . I PSOSAVE S PSODA=RXP,PREA="R" D ACTLOG^PSOCPA S $P(^PSRX(RXP,"IB"),"^",1)=""
"RTN","PSOCP",30,0)
 I PSOCHG=2 D  I 'PSOCP D:PSOPFS CHRG^PSOPFSU1(RXP,PSOREF,"CG",PSOPFS) G QUIT ; IF 'SC' QUESTION APPLIES, BUT HAS NOT BEEN ANSWERED, SEND MAIL MSG AND KEEP COPAY STATUS AS IT WAS
"RTN","PSOCP",31,0)
 . D MAIL2^PSOCPE ; SEND MAIL TO PHARMACIST, PROVIDER, AND HOLDERS OF THE PSO COPAY KEY
"RTN","PSOCP",32,0)
 I PSOCHG=1,PSOSAVE="" D  I PSOREF S PSOCOMM="",PSOOLD="No Copay",PSONW="Copay" S PSODA=RXP,PREA="R" D ACTLOG^PSOCPA
"RTN","PSOCP",33,0)
 . I '$D(^PSRX(RXP,"IB")),'PSOREF S $P(^PSRX(RXP,"IB"),"^",1)=1 Q
"RTN","PSOCP",34,0)
 . S $P(^PSRX(RXP,"IB"),"^",1)=1
"RTN","PSOCP",35,0)
 . S PSOCP=1,$P(X,"^",3)=PSOCP
"RTN","PSOCP",36,0)
 I PSOCHG'=2 I $G(MAILMSG) D MAIL2^PSOCPE ; SEND MAIL TO PHARM, PROV, AND HOLDERS OF PSO COPAY KEY HOLDERS
"RTN","PSOCP",37,0)
 ; Units for COPAY
"RTN","PSOCP",38,0)
 S PSOCPUN=$P(($P(^PSRX(RXP,0),"^",8)+29)/30,".",1)
"RTN","PSOCP",39,0)
 ; Build softlink for x(n)=softlink^units
"RTN","PSOCP",40,0)
 S X(1)="52:"_RXP S:PSOREF>0 X(1)=X(1)_";1:"_PSOREF S X(1)=X(1)_"^"_PSOCPUN
"RTN","PSOCP",41,0)
 ; Set correct user duz if refill
"RTN","PSOCP",42,0)
 I PSOREF S:+$P(^PSRX(RXP,1,PSOREF,0),"^",7)>0 $P(X,"^",4)=$P(^PSRX(RXP,1,PSOREF,0),"^",7)
"RTN","PSOCP",43,0)
 ;
"RTN","PSOCP",44,0)
IBNEW ;  Load ^TMP global for IB call
"RTN","PSOCP",45,0)
 Q:$G(RXP)'>0
"RTN","PSOCP",46,0)
 I PSOPFS D CHRG^PSOPFSU1(RXP,PSOREF,"CG",PSOPFS)
"RTN","PSOCP",47,0)
 G QUIT:PSOPFS
"RTN","PSOCP",48,0)
 N D0
"RTN","PSOCP",49,0)
 G QUIT:'$D(X)
"RTN","PSOCP",50,0)
 S XTMP=X,XTMP(1)=X(1)
"RTN","PSOCP",51,0)
 ;
"RTN","PSOCP",52,0)
 ; Requires x=service^dfn^action type^user duz
"RTN","PSOCP",53,0)
 ;   x(n)=softlink^units 
"RTN","PSOCP",54,0)
 I $P(X,"^",3)="" S $P(X,"^",3)=$P(^PSRX(RXP,"IB"),"^",1)
"RTN","PSOCP",55,0)
 D NEW^IBARX
"RTN","PSOCP",56,0)
 ; Returns y=1^total charges for this group or Y=-1^error code
"RTN","PSOCP",57,0)
 ;         y(n)=IB number^charge for this Rx^AR bill #^Cap met^Partial or Full charge^Copay Exempt^Number from file 354.71
"RTN","PSOCP",58,0)
 ;         Cap met ('1' - If patient has met cap amount or reached cap with this charge or '0' if not)
"RTN","PSOCP",59,0)
 ;         Partial or Full ('P' for partial billing, 'F' for full billing, null for no billing)
"RTN","PSOCP",60,0)
 ;         Copay Exempt - ('1' for exempt, '0' for non-exempt, '-1' for copay off (manila)),
"RTN","PSOCP",61,0)
 ;            ('1' - If patient has met cap amount or reach cap with this charge
"RTN","PSOCP",62,0)
 ; Entry from file 354.71 will only be saved for fills that met the annual cap and could not be fully billed
"RTN","PSOCP",63,0)
 ;
"RTN","PSOCP",64,0)
 G QUIT:+Y=-1
"RTN","PSOCP",65,0)
 S XTMP=XTMP_"^"_Y,XTMP(1)=XTMP(1)_"^"_Y(1)
"RTN","PSOCP",66,0)
 ;
"RTN","PSOCP",67,0)
 ; see if exempt or copay cap was met
"RTN","PSOCP",68,0)
 I $P(Y(1),"^",6) D  G QUIT
"RTN","PSOCP",69,0)
 . S PREA="R",PSOOLD="Copay",PSONW="No Copay"
"RTN","PSOCP",70,0)
 . S PSOCOMM="RX COPAY INCOME EXEMPTION" S PSODA=RXP D ACTLOG^PSOCPA
"RTN","PSOCP",71,0)
 . S $P(^PSRX(RXP,"IB"),"^",1)=""
"RTN","PSOCP",72,0)
 I $P(Y(1),"^",4) D
"RTN","PSOCP",73,0)
 . S PSOCOMM=$S($P(Y(1),"^",5)="F":" FULL BILLING FOR THIS FILL",$P(Y(1),"^",5)="P":" PARTIAL BILLING FOR THIS FILL ",1:" NO BILLING FOR THIS FILL")
"RTN","PSOCP",74,0)
 . S PREA="A"
"RTN","PSOCP",75,0)
 . S PSODA=RXP D ACTLOG^PSOCPA
"RTN","PSOCP",76,0)
 . I $P(Y(1),"^",5)'="F" D
"RTN","PSOCP",77,0)
 . . I PSOREF S $P(^PSRX(RXP,1,PSOREF,"IB"),"^",2)=$P(Y(1),"^",7) Q
"RTN","PSOCP",78,0)
 . . S $P(^PSRX(RXP,"IB"),"^",4)=$P(Y(1),"^",7)
"RTN","PSOCP",79,0)
 I $P(Y(1),"^",1)="" G QUIT
"RTN","PSOCP",80,0)
 ;
"RTN","PSOCP",81,0)
FILE ;File IB number in ^PSRX
"RTN","PSOCP",82,0)
 S PSOCP2=0
"RTN","PSOCP",83,0)
 S PSOCP2=+$P(XTMP(1),":",3)
"RTN","PSOCP",84,0)
 S:PSOCP2>0 ^PSRX(RXP,1,PSOCP2,"IB")=$P(XTMP(1),U,3) ;  Filing in refill node
"RTN","PSOCP",85,0)
 I PSOCP2>0,'$D(^PSRX(RXP,"IB")) S ^PSRX(RXP,"IB")="1^^" ;  If refill "IB" exists, need "IB" entry on original fill node
"RTN","PSOCP",86,0)
 S:PSOCP2=0 $P(^PSRX(RXP,"IB"),"^",2)=$P(XTMP(1),U,3) ;Filing in original fill (zero node)
"RTN","PSOCP",87,0)
QUIT ;
"RTN","PSOCP",88,0)
 K Y,PSOCP1,PSOCP2,QQ,PSOCPN,X,X2,XTMP,PSOCPUN,PSOREF,PSOCHG,PSOSAVE,PSOCOMM,PSOOLD,PSONW,PREA,PSORSN
"RTN","PSOCP",89,0)
 Q
"RTN","PSOCP",90,0)
EN D ^PSOLSET
"RTN","PSOCP",91,0)
EN1 S DIR(0)="NO",DIR("A")="Enter PRESCRIPTION number" D ^DIR K DIR G:$D(DIRUT) EXIT S RXP=X I +$G(^PSRX(RXP,0))'>0!+$P($G(^PSRX(RXP,"IB")),"^",0)>0 W !,?10,"RE-CHECK PRESCRIPTION NUMBER AND RE-ENTER " G EN1
"RTN","PSOCP",92,0)
 S PSOSITE7=$P(^PS(59,PSOSITE,"IB"),"^")
"RTN","PSOCP",93,0)
 S PSODFN=$P(^PSRX(RXP,0),"^",2)
"RTN","PSOCP",94,0)
 D CP G EN1
"RTN","PSOCP",95,0)
EXIT K RXP D FINAL^PSOLSET Q
"RTN","PSOCP",96,0)
 ;
"RTN","PSOCP",97,0)
SC(PSODFN,PSODD) ;sup ref for CPRS, Pre-Copay enhancement
"RTN","PSOCP",98,0)
 N PSOSC
"RTN","PSOCP",99,0)
 I $$DT^PSOMLLDT S PSOSC="" G SCQ
"RTN","PSOCP",100,0)
 I $G(PSODD),($P($G(^PSDRUG(PSODD,0)),"^",3)["S")!($P($G(^(0)),"^",3)["I") S PSOSC=1 G SCQ
"RTN","PSOCP",101,0)
 I $P($G(^PS(55,+$G(PSODFN),"PS")),"^"),$P($G(^PS(53,+$P(^("PS"),"^"),0)),"^",7) S PSOSC=1 G SCQ
"RTN","PSOCP",102,0)
 N I,J,X S (X,PSOSC)=""
"RTN","PSOCP",103,0)
 S J=0 F  S J=$O(^PS(59,J)) Q:'J  I +$G(^(J,"IB")) S X=+^("IB") Q
"RTN","PSOCP",104,0)
 G:'X SCQ
"RTN","PSOCP",105,0)
 S X=X_"^"_PSODFN D XTYPE^IBARX
"RTN","PSOCP",106,0)
 S J="" F  S J=$O(Y(J)) Q:'J  S I="" F  S I=$O(Y(J,I)) Q:I=""  S:I>0 PSOSC=I
"RTN","PSOCP",107,0)
SCQ Q $S($G(PSOSC)=2:0,1:1)
"RTN","PSOCP",108,0)
 ;
"RTN","PSOCP",109,0)
COPAYREL ; Recheck copay status at release
"RTN","PSOCP",110,0)
 ; check Rx patient status
"RTN","PSOCP",111,0)
 I $P(^PSRX(RXP,0),"^",3)'="",$P($G(^PS(53,$P(^PSRX(RXP,0),"^",3),0)),"^",7)=1 S PSOCHG=0,PSOCOMM="Rx Patient Status Change",PSOOLD="Copay",PSONW="No Copay" Q
"RTN","PSOCP",112,0)
 ; see if drug is investigational or supply
"RTN","PSOCP",113,0)
 N DRG,DRGTYP,X
"RTN","PSOCP",114,0)
 S DRG=+$P(^PSRX(RXP,0),"^",6),DRGTYP=$P($G(^PSDRUG(DRG,0)),"^",3)
"RTN","PSOCP",115,0)
 I DRGTYP["I" S PSOCOMM="Investigational Drug",PSOCHG=0,PSOOLD="Copay",PSONW="No Copay",PSOCHG=0
"RTN","PSOCP",116,0)
 I DRGTYP["S" S PSOCOMM="Supply Item",PSOCHG=0,PSOOLD="Copay",PSONW="No Copay",PSOCHG=0
"RTN","PSOCP",117,0)
 K PSOTG,CHKXTYPE
"RTN","PSOCP",118,0)
 I +$G(^PSRX(RXP,"IBQ")) D XTYPE1^PSOCP1
"RTN","PSOCP",119,0)
 I $G(^PSRX(RXP,"IBQ"))["1" D  S PSOCHG=0,PSOOLD="Copay",PSONW="No Copay" Q  ; COPAY EXEMPT
"RTN","PSOCP",120,0)
 . N EXMT,II,PSOCIBQ
"RTN","PSOCP",121,0)
 . S PSOCIBQ=$G(^PSRX(RXP,"IBQ"))
"RTN","PSOCP",122,0)
 . F II=1,7,3,4,5,6,2,8 I $P(PSOCIBQ,"^",II)=1 S EXMT=$S(II=1:"SC",II=7:"CV",II=3:"AO",II=4:"IR",II=5:"EC",II=8:"SHAD",II=2:"MST",II=6:"HNC",1:"") D:EXMT'="" SETCOMM Q
"RTN","PSOCP",123,0)
 D SCNEW(.PSOTG,PSOCPN,DRG,RXP)
"RTN","PSOCP",124,0)
 N EXMT
"RTN","PSOCP",125,0)
 I '$D(CHKXTYPE) D XTYPE
"RTN","PSOCP",126,0)
 F EXMT="SC","CV","AO","IR","EC","SHAD","MST","HNC" I $D(PSOTG(EXMT)) D  I 'PSOCHG Q
"RTN","PSOCP",127,0)
 . I PSOTG(EXMT)=1 S PSOCHG=0 D SETCOMM
"RTN","PSOCP",128,0)
 I 'PSOCHG S PSOOLD="Copay",PSONW="No Copay" Q
"RTN","PSOCP",129,0)
 ;
"RTN","PSOCP",130,0)
 ; If any of the applicable exemption quest have never been answered, send a mail msg with all of the quest
"RTN","PSOCP",131,0)
 S EXMT="",MAILMSG=0 F  S EXMT=$O(PSOTG(EXMT)) Q:EXMT=""  I PSOTG(EXMT)="" S MAILMSG=1 Q
"RTN","PSOCP",132,0)
 I MAILMSG,$D(PSOTG("SC")) I $G(PSOTG("SC"))="" S PSOCHG=2 ; 'SC' quest not answered, don't reset copay status to 'copay'
"RTN","PSOCP",133,0)
 Q
"RTN","PSOCP",134,0)
 ;
"RTN","PSOCP",135,0)
SCNEW(PSOTG,PSOPT,PSODR,PSORN) ;CPRS supported ref
"RTN","PSOCP",136,0)
 I '$$DT^PSOMLLDT Q
"RTN","PSOCP",137,0)
 I '$G(PSOPT) Q
"RTN","PSOCP",138,0)
 ;I $G(PSODR),($P($G(^PSDRUG(PSODR,0)),"^",3)["S")!($P($G(^(0)),"^",3)["I") Q ;CIDC ALWAYS ASK
"RTN","PSOCP",139,0)
 N PSOCIBQ,PSOQMSH,PSOQVEH,PSOQRQD,PSOQHNC,PSOQPGW,DFN,PSOSCA,ZXX
"RTN","PSOCP",140,0)
 K PSOANSQ("SC>50")
"RTN","PSOCP",141,0)
 S DFN=PSOPT
"RTN","PSOCP",142,0)
 D SCP^PSORN52D S:PSOSCP>49&(PSOSCA) PSOANSQ("SC>50")=1
"RTN","PSOCP",143,0)
 I $G(PSORN) D
"RTN","PSOCP",144,0)
 . S PSOCIBQ=$G(^PSRX(PSORN,"IBQ"))
"RTN","PSOCP",145,0)
 . I $TR(PSOCIBQ,"^")="" S ZXX=$G(^PSRX(PSORN,"ICD",1,0)) D ICD:ZXX'=""
"RTN","PSOCP",146,0)
 I '$G(PSORN) S PSOCIBQ=""
"RTN","PSOCP",147,0)
 ;Rx Patient Status check is not being done here
"RTN","PSOCP",148,0)
 N PSOSCMX,Y,I,J,X S (X,PSOSCMX)=""
"RTN","PSOCP",149,0)
 S J=0 F  S J=$O(^PS(59,J)) Q:'J  I +$G(^(J,"IB")) S X=+^("IB") Q
"RTN","PSOCP",150,0)
 G:'X SKIP
"RTN","PSOCP",151,0)
 S X=X_"^"_PSOPT D XTYPE^IBARX
"RTN","PSOCP",152,0)
 S J="" F  S J=$O(Y(J)) Q:'J  S I="" F  S I=$O(Y(J,I)) Q:I=""  S:I>0 PSOSCMX=I
"RTN","PSOCP",153,0)
SKIP ;
"RTN","PSOCP",154,0)
 I $G(PSOSCA)!($G(PSOSCMX)=2) S PSOTG("SC")=$S($P(PSOCIBQ,"^")=1:1,$P(PSOCIBQ,"^")=0:0,$G(PSORN)&($P($G(^PSRX(+$G(PSORN),"IB")),"^")):0,1:"")
"RTN","PSOCP",155,0)
 S:$$AO^SDCO22(PSOPT) PSOTG("AO")=$S($P(PSOCIBQ,"^",3)=1:1,$P(PSOCIBQ,"^",3)=0:0,1:"")
"RTN","PSOCP",156,0)
 S:$$IR^SDCO22(PSOPT) PSOTG("IR")=$S($P(PSOCIBQ,"^",4)=1:1,$P(PSOCIBQ,"^",4)=0:0,1:"")
"RTN","PSOCP",157,0)
 S:$$EC^SDCO22(PSOPT) PSOTG("EC")=$S($P(PSOCIBQ,"^",5)=1:1,$P(PSOCIBQ,"^",5)=0:0,1:"")
"RTN","PSOCP",158,0)
 S:$P($$GETSTAT^DGMSTAPI(PSOPT),"^",2)="Y" PSOTG("MST")=$S($P(PSOCIBQ,"^",2)=1:1,$P(PSOCIBQ,"^",2)=0:0,1:"")
"RTN","PSOCP",159,0)
 I $T(GETCUR^DGNTAPI)]"" N PSONC,PSONCX S PSONCX=$$GETCUR^DGNTAPI(PSOPT,"PSONC") I $P($G(PSONC("IND")),"^")="Y" S PSOTG("HNC")=$S($P(PSOCIBQ,"^",6)=1:1,$P(PSOCIBQ,"^",6)=0:0,1:"")
"RTN","PSOCP",160,0)
 S:$P($$CVEDT^DGCV(PSOPT),"^",3) PSOTG("CV")=$S($P(PSOCIBQ,"^",7)=1:1,$P(PSOCIBQ,"^",7)=0:0,1:"")
"RTN","PSOCP",161,0)
 I $L($T(GETSHAD^DGUTL3)) S:$$GETSHAD^DGUTL3(PSOPT)=1 PSOTG("SHAD")=$S($P(PSOCIBQ,"^",8)=1:1,$P(PSOCIBQ,"^",8)=0:0,1:"")
"RTN","PSOCP",162,0)
 Q
"RTN","PSOCP",163,0)
 ;
"RTN","PSOCP",164,0)
ICD ;
"RTN","PSOCP",165,0)
 D ICD^PSOCP1
"RTN","PSOCP",166,0)
 Q
"RTN","PSOCP",167,0)
XTYPE ;
"RTN","PSOCP",168,0)
 N PSOCIBQ,PSOSCMX,Y,I,J,X,SAVY,ZXX
"RTN","PSOCP",169,0)
 S (X,PSOSCMX,SAVY)=""
"RTN","PSOCP",170,0)
 S PSOCIBQ=$G(^PSRX(RXP,"IBQ")) I $TR(PSOCIBQ,"^")="" S ZXX=$G(^PSRX(RXP,"ICD",1,0)) D ICD:ZXX'=""
"RTN","PSOCP",171,0)
 I $P(PSOCIBQ,"^",1)'="" S PSOTG("SC")=$P(PSOCIBQ,"^",1)
"RTN","PSOCP",172,0)
 I $D(PSOTG("SC")),$P(PSOCIBQ,"^",1)="" S PSOTG("SC")="" ; USE "CURRENT" SETTING AS ANS TO SC QUEST IF IT APPLIES
"RTN","PSOCP",173,0)
 S J=0 F  S J=$O(^PS(59,J)) Q:'J  I +$G(^(J,"IB")) S X=+^("IB") Q
"RTN","PSOCP",174,0)
 I 'X Q
"RTN","PSOCP",175,0)
 S X=X_"^"_PSOCPN D XTYPE^IBARX
"RTN","PSOCP",176,0)
 I $G(Y)'=1 Q
"RTN","PSOCP",177,0)
 S J="" F  S J=$O(Y(J)) Q:'J  S I="" F  S SAVY=I,I=$O(Y(J,I)) Q:I=""  S:I>0 PSOSCMX=I
"RTN","PSOCP",178,0)
 I PSOSCMX="",SAVY=0 S PSOCHG=0 S PSOCOMM="Exempt from copayment" Q  ; INCOME EXEMPT OR SC
"RTN","PSOCP",179,0)
 I PSOSCMX=2,'$D(PSOTG("SC")) S PSOTG("SC")=$S(($G(RXP)&($P($G(^PSRX(+$G(RXP),"IB")),"^")))!($P(PSOCIBQ,"^")=0):0,$P(PSOCIBQ,"^")=1:1,1:"") Q
"RTN","PSOCP",180,0)
 Q
"RTN","PSOCP",181,0)
 ;
"RTN","PSOCP",182,0)
SETCOMM ;
"RTN","PSOCP",183,0)
 D SETCOMM^PSOCP1
"RTN","PSOCP",184,0)
 Q
"RTN","PSOCP",185,0)
 ;
"RTN","PSOCP1")
0^22^B5367762
"RTN","PSOCP1",1,0)
PSOCP1 ;BHAM ISC/EJW-PHARMACY CO-PAY APPLICATION UTILITIES FOR IB (CONT'D) ;12/12/02
"RTN","PSOCP1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**137,239,225**;DEC 1997;Build 29
"RTN","PSOCP1",3,0)
 ;
"RTN","PSOCP1",4,0)
 ;REF/IA
"RTN","PSOCP1",5,0)
 ;IBARX/125
"RTN","PSOCP1",6,0)
CHKIB ; SEE IF BILL # IS A CHARGE OR CANCELLATION #
"RTN","PSOCP1",7,0)
 N IBN,XX
"RTN","PSOCP1",8,0)
 I PSOREF=0 S XX=$G(^PSRX(RXP,"IB")) I $P(XX,"^",4)'="" S PSOIB=1 Q  ;ALREADY BILLED
"RTN","PSOCP1",9,0)
 I PSOREF=0 S IBN=$P(XX,"^",2)
"RTN","PSOCP1",10,0)
 I PSOREF'=0 S XX=$G(^PSRX(RXP,1,PSOREF,"IB")) I $P(XX,"^",2)'="" S PSOIB=1 Q  ;ALREADY BILLED
"RTN","PSOCP1",11,0)
 I PSOREF'=0 S IBN=$P(XX,"^",1)
"RTN","PSOCP1",12,0)
 I IBN'="" D STATUS
"RTN","PSOCP1",13,0)
 Q
"RTN","PSOCP1",14,0)
 ;
"RTN","PSOCP1",15,0)
STATUS ;
"RTN","PSOCP1",16,0)
 N XX
"RTN","PSOCP1",17,0)
 S XX=$$STATUS^IBARX(IBN)
"RTN","PSOCP1",18,0)
 I XX'=1,XX'=3 Q
"RTN","PSOCP1",19,0)
 S PSOIB=1 ; ALREADY BILLED
"RTN","PSOCP1",20,0)
 Q
"RTN","PSOCP1",21,0)
 ;
"RTN","PSOCP1",22,0)
XTYPE1 ;
"RTN","PSOCP1",23,0)
 N PSOCIBQ,PSOSCMX,Y,I,J,X,SAVY
"RTN","PSOCP1",24,0)
 S (X,PSOSCMX,SAVY)=""
"RTN","PSOCP1",25,0)
 S PSOCIBQ=$G(^PSRX(RXP,"IBQ"))
"RTN","PSOCP1",26,0)
 I $P(PSOCIBQ,"^",1)'=1 Q
"RTN","PSOCP1",27,0)
 S J=0 F  S J=$O(^PS(59,J)) Q:'J  I +$G(^(J,"IB")) S X=+^("IB") Q
"RTN","PSOCP1",28,0)
 I 'X Q
"RTN","PSOCP1",29,0)
 S X=X_"^"_PSOCPN D XTYPE^IBARX
"RTN","PSOCP1",30,0)
 I $G(Y)'=1 Q
"RTN","PSOCP1",31,0)
 S J="" F  S J=$O(Y(J)) Q:'J  S I="" F  S SAVY=I,I=$O(Y(J,I)) Q:I=""  S:I>0 PSOSCMX=I
"RTN","PSOCP1",32,0)
 I PSOSCMX="",SAVY=0 Q  ; INCOME EXEMPT OR SERVICE-CONNECTED
"RTN","PSOCP1",33,0)
 I PSOSCMX=2 Q  ; NEED TO ASK SC QUESTION
"RTN","PSOCP1",34,0)
 ; If get to here, service-connected question does not apply for this patient anymore.  Update "IBQ" and CPRS
"RTN","PSOCP1",35,0)
 S $P(^PSRX(RXP,"IBQ"),"^",1)="",CHKXTYPE=1
"RTN","PSOCP1",36,0)
 D EN^PSOHLSN1(RXP,"XX","","Order edited")
"RTN","PSOCP1",37,0)
 Q
"RTN","PSOCP1",38,0)
 ;
"RTN","PSOCP1",39,0)
SETCOMM ;
"RTN","PSOCP1",40,0)
 I EXMT="SC" S PSOCOMM="Service Connected" Q
"RTN","PSOCP1",41,0)
 I EXMT="CV" S PSOCOMM="COMBAT VETERAN" Q
"RTN","PSOCP1",42,0)
 I EXMT="AO" S PSOCOMM="AGENT ORANGE RELATED" Q
"RTN","PSOCP1",43,0)
 I EXMT="IR" S PSOCOMM="IONIZING RAD RELATED" Q
"RTN","PSOCP1",44,0)
 I EXMT="EC" S PSOCOMM="SW ASIA COND. RELATED" Q
"RTN","PSOCP1",45,0)
 I EXMT="SHAD" S PSOCOMM="PROJ 112/SHAD" Q
"RTN","PSOCP1",46,0)
 I EXMT="MST" S PSOCOMM="MILITARY SEXUAL TRAUMA" Q
"RTN","PSOCP1",47,0)
 I EXMT="HNC" S PSOCOMM="Head and/or Neck Cancer" Q
"RTN","PSOCP1",48,0)
 Q
"RTN","PSOCP1",49,0)
 ;
"RTN","PSOCP1",50,0)
ICD ;
"RTN","PSOCP1",51,0)
 S PSOCIBQ=$P(ZXX,U,4)_"^"_$P(ZXX,U,6)_"^"_$P(ZXX,U,2)_"^"_$P(ZXX,U,3)_"^"_$P(ZXX,U,5)_"^"_$P(ZXX,U,7)_"^"_$P(ZXX,U,8)_"^"_$P(ZXX,U,9)
"RTN","PSOCP1",52,0)
 Q
"RTN","PSOCP1",53,0)
 ;
"RTN","PSOCPC")
0^2^B74796456
"RTN","PSOCPC",1,0)
PSOCPC ;BHAM ISC/BAB - PHARMACY CO-PAY APPLICATION ;06/09/92
"RTN","PSOCPC",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**10,9,71,85,114,157,143,239,201,275,225**;DEC 1997;Build 29
"RTN","PSOCPC",3,0)
 ;
"RTN","PSOCPC",4,0)
 ;REF/IA
"RTN","PSOCPC",5,0)
 ;piece 9 of zero node of File 350 and APDT cross reference of File 350/2215
"RTN","PSOCPC",6,0)
 ;$$STATUS^IBARX/125
"RTN","PSOCPC",7,0)
 ;File 350.1/592 (DBIA125-B)
"RTN","PSOCPC",8,0)
WARN ; Message when attempt is made to delete a refill date on COPAY
"RTN","PSOCPC",9,0)
 N PSOIB,PSOIBST
"RTN","PSOCPC",10,0)
 S PSOFLG=0
"RTN","PSOCPC",11,0)
 G:'$D(^PSRX(DA(1),1,DA,"IB")) ENDW
"RTN","PSOCPC",12,0)
 S PSOIB=^PSRX(DA(1),1,DA,"IB")
"RTN","PSOCPC",13,0)
 I +PSOIB'>0 G ENDW
"RTN","PSOCPC",14,0)
 S PSOIBST=$$STATUS^IBARX(+PSOIB) I PSOIBST=2!(PSOIBST=0) G ENDW
"RTN","PSOCPC",15,0)
 I +PSOIB>0 D CANCEL G ENDW:PSOFLG=0
"RTN","PSOCPC",16,0)
 I '$G(PSOXXDEL) D EN^DDIOL("This REFILL has COPAY charges, which MUST be removed","","$C(7),!!"),EN^DDIOL("BEFORE the refill date is deleted.","","!")
"RTN","PSOCPC",17,0)
 I '$G(PSOXXDEL) D EN^DDIOL("Use option RESET COPAY STATUS/CANCEL CHARGES, return to EDIT A PRESCRIPTION,","","!!"),EN^DDIOL("and delete the refill date.","","!"),EN^DDIOL(" ","","!!")
"RTN","PSOCPC",18,0)
 S PSOFLG=1
"RTN","PSOCPC",19,0)
ENDW ;
"RTN","PSOCPC",20,0)
 I PSOFLG
"RTN","PSOCPC",21,0)
 K PSOFLG
"RTN","PSOCPC",22,0)
 Q
"RTN","PSOCPC",23,0)
CANCEL ;Check if charge is cancelled for this Refill date
"RTN","PSOCPC",24,0)
 S PSOFLG=1 ;indicates a charge not cancelled
"RTN","PSOCPC",25,0)
 S PSOX=+^PSRX(DA(1),1,DA,"IB")
"RTN","PSOCPC",26,0)
 D LAST I PSOLAST'=PSOPARNT,$D(^IB(PSOLAST,0)),$P(^IBE(350.1,$P(^IB(PSOLAST,0),"^",3),0),"^",5)=2 S PSOFLG=0
"RTN","PSOCPC",27,0)
 K PSOLAST,PSOPARNT,PSOX,PSOL,PSOLDT
"RTN","PSOCPC",28,0)
 Q
"RTN","PSOCPC",29,0)
LAST ;find last entry
"RTN","PSOCPC",30,0)
 S PSOLAST=""
"RTN","PSOCPC",31,0)
 S PSOPARNT=$P(^IB(+PSOX,0),"^",9) I 'PSOPARNT S PSOPARNT=+PSOX
"RTN","PSOCPC",32,0)
 S PSOLDT=$O(^IB("APDT",PSOPARNT,"")) I +PSOLDT F PSOL=0:0 S PSOL=$O(^IB("APDT",PSOPARNT,PSOLDT,PSOL)) Q:'PSOL  S PSOLAST=PSOL
"RTN","PSOCPC",33,0)
 I PSOLAST="" S PSOLAST=PSOPARNT
"RTN","PSOCPC",34,0)
 Q
"RTN","PSOCPC",35,0)
 ;
"RTN","PSOCPC",36,0)
EXEMCHK ; Allow reset of exemption answers
"RTN","PSOCPC",37,0)
 N PSOTG,PSOCPN,PSOEXMT,PSOANS,OLDIBQ,PSOSCP,PSOSCA
"RTN","PSOCPC",38,0)
 S PSOANS=0 D SCP^PSORN52D
"RTN","PSOCPC",39,0)
 S OLDIBQ=$G(^PSRX(PSODA,"IBQ"))
"RTN","PSOCPC",40,0)
 I OLDIBQ[0!(OLDIBQ)[1 D
"RTN","PSOCPC",41,0)
 . S PSOANS=1
"RTN","PSOCPC",42,0)
 . I $P(OLDIBQ,"^",1)'="" S PSOTG("SC")=$P(OLDIBQ,"^",1)
"RTN","PSOCPC",43,0)
 . I $P(OLDIBQ,"^",2)'="" S PSOTG("MST")=$P(OLDIBQ,"^",2)
"RTN","PSOCPC",44,0)
 . I $P(OLDIBQ,"^",3)'="" S PSOTG("AO")=$P(OLDIBQ,"^",3)
"RTN","PSOCPC",45,0)
 . I $P(OLDIBQ,"^",4)'="" S PSOTG("IR")=$P(OLDIBQ,"^",4)
"RTN","PSOCPC",46,0)
 . I $P(OLDIBQ,"^",5)'="" S PSOTG("EC")=$P(OLDIBQ,"^",5)
"RTN","PSOCPC",47,0)
 . I $P(OLDIBQ,"^",6)'="" S PSOTG("HNC")=$P(OLDIBQ,"^",6)
"RTN","PSOCPC",48,0)
 . I $P(OLDIBQ,"^",7)'="" S PSOTG("CV")=$P(OLDIBQ,"^",7)
"RTN","PSOCPC",49,0)
 . I $P(OLDIBQ,"^",8)'="" S PSOTG("SHAD")=$P(OLDIBQ,"^",8)
"RTN","PSOCPC",50,0)
 S PSOCPN=$P(^PSRX(PSODA,0),"^",2)
"RTN","PSOCPC",51,0)
 S RXP=PSODA
"RTN","PSOCPC",52,0)
 D SCNEW^PSOCP(.PSOTG,PSOCPN,"",PSODA)
"RTN","PSOCPC",53,0)
 N EXMT
"RTN","PSOCPC",54,0)
 D XTYPE^PSOCP ; KEEP THIS CALL IN HERE TO SEE IF SC QUESTION APPLIES
"RTN","PSOCPC",55,0)
 ;I $D(PSOTG("SC")) S PSOTG("SC")=$P(OLDIBQ,"^",1) ; CHANGED TO JUST USE IBQ SETTING IF SC QUESTION APPLIES - DON'T RE-CALCULATE SERVICE-CONNECTED
"RTN","PSOCPC",56,0)
 S EXMT="" F  S EXMT=$O(PSOTG(EXMT)) Q:EXMT=""  I PSOTG(EXMT)'="" S PSOANS=1 Q
"RTN","PSOCPC",57,0)
 I $O(PSOTG(""))="" Q
"RTN","PSOCPC",58,0)
 I PSOANS W !!,"The following exemption flags have been set:"
"RTN","PSOCPC",59,0)
 F EXMT="SC","CV","AO","IR","EC","SHAD","MST","HNC" I $G(PSOTG(EXMT))'="" W !,$S(EXMT="EC":"SWAC",1:EXMT),": ",?6,$S(PSOTG(EXMT)=1:"Yes",PSOTG(EXMT)=0:"No",1:"")
"RTN","PSOCPC",60,0)
 W !
"RTN","PSOCPC",61,0)
 W ! K DIR S DIR(0)="Y",DIR("B")="N" D  S DIR("A")="Do you want to enter/edit any copay exemption flags"
"RTN","PSOCPC",62,0)
 . S EXMT="" F  S EXMT=$O(PSOTG(EXMT)) Q:EXMT=""  I PSOTG(EXMT)="" S DIR("B")="Y" Q
"RTN","PSOCPC",63,0)
 S DIR("?")="Enter 'Y' for Yes if you want to edit any applicable medication exemption flags."
"RTN","PSOCPC",64,0)
 S DIR("??")="^D HELPEXEM^PSOCPC"
"RTN","PSOCPC",65,0)
 D ^DIR K DIR S PSOEXMT=Y I Y'=1 Q
"RTN","PSOCPC",66,0)
 ; PRESENT ALL APPLICABLE EXEMPTIONS AND SAVE NEW ANSWERS
"RTN","PSOCPC",67,0)
 N PSOIBQ,PSOSUBS,PSOQUES,PSOLTAG,OLDIBQ,II,PSOCHG,PSOPATST
"RTN","PSOCPC",68,0)
 S PSOPATST=$$GET1^DIQ(52,PSODA_",",3,"I")
"RTN","PSOCPC",69,0)
 S PSOIBQ=""
"RTN","PSOCPC",70,0)
 S OLDIBQ=$G(^PSRX(PSODA,"IBQ"))
"RTN","PSOCPC",71,0)
 I '$D(^PSRX(PSODA,"IBQ")),+($G(^PSRX(PSODA,"IB")))=2 S $P(OLDIBQ,"^",1)=0 ; SC QUESTION WAS PREVIOUSLY ANSWERED AS N
"RTN","PSOCPC",72,0)
 S PSOCOMM="",PSOOLD="",PSONW=""
"RTN","PSOCPC",73,0)
 S II=0
"RTN","PSOCPC",74,0)
 F EXMT="SC","CV","AO","IR","EC","SHAD","MST","HNC" I $D(PSOTG(EXMT)) D
"RTN","PSOCPC",75,0)
 . S PSOLTAG="REL"_EXMT_"^PSOCPE"
"RTN","PSOCPC",76,0)
 . S HELPTAG="HELP"_EXMT
"RTN","PSOCPC",77,0)
 . S PSOQUES=$P($T(@PSOLTAG),";",2) I PSOQUES="" Q
"RTN","PSOCPC",78,0)
 . S PSOQUES=$P(PSOQUES,"?")
"RTN","PSOCPC",79,0)
 . S PSOSUBS=$P($T(@PSOLTAG),";",3) I PSOSUBS="" Q
"RTN","PSOCPC",80,0)
 . D ASKEXEM
"RTN","PSOCPC",81,0)
 I $D(PSOCHG) D
"RTN","PSOCPC",82,0)
 . ;PSO*7*275 IBQ node should not be present in some cases.
"RTN","PSOCPC",83,0)
 . K ^PSRX(PSODA,"IBQ")
"RTN","PSOCPC",84,0)
 . S:PSOSCP<50&($TR(PSOIBQ,"^")'="")&($P($G(^PS(53,+$G(PSOPATST),0)),"^",7)'=1) ^PSRX(PSODA,"IBQ")=PSOIBQ
"RTN","PSOCPC",85,0)
 . D RESET^PSORN52D  ;set SC/EI on ICD node
"RTN","PSOCPC",86,0)
 . S PSOPFSA=1 ;PFSS-denotes to calling routine that outpatient classifications changed.
"RTN","PSOCPC",87,0)
 . D EN^PSOHLSN1(PSODA,"XX","","Order edited")
"RTN","PSOCPC",88,0)
 . I PCOPAY,PSOIBQ["1" D  ; RESET TO NO COPAY
"RTN","PSOCPC",89,0)
 . . W !,"Editing of exemption flag(s) has resulted in a copay status change.",!,"The status for this Rx will be reset to NO COPAY."
"RTN","PSOCPC",90,0)
 . . S $P(^PSRX(PSODA,"IB"),"^",1)=""
"RTN","PSOCPC",91,0)
 . . S PSOREF="",PSOOLD="Copay",PSONW="No Copay",PREA="R" D ACTLOG^PSOCPA
"RTN","PSOCPC",92,0)
 . . S PSOCOMM="Copay status reset due to exemption flag(s)"
"RTN","PSOCPC",93,0)
 . . S PSI=0 D SETSUMM
"RTN","PSOCPC",94,0)
 . I $G(II)>0 D
"RTN","PSOCPC",95,0)
 . . S PSOCOMM="The following exemption flags have been changed: ",PSI=0 D SETSUMM
"RTN","PSOCPC",96,0)
 . . S II="" F  S II=$O(PSOCHG(II)) Q:II=""  S PSOCOMM=PSOCHG(II),PSI=0 D SETSUMM
"RTN","PSOCPC",97,0)
 Q
"RTN","PSOCPC",98,0)
 ;
"RTN","PSOCPC",99,0)
ASKEXEM ; ASK THE EXEMPTION QUESTIONS
"RTN","PSOCPC",100,0)
 K DIR S DIR("A")=PSOQUES,DIR(0)="YO" S:PSOTG(EXMT)=1 DIR("B")="Y" S:PSOTG(EXMT)=0 DIR("B")="N" D @HELPTAG
"RTN","PSOCPC",101,0)
ASKEXEM1 D ^DIR I X="@" R !,"  Are you sure you want to delete this answer? ",X:DTIME I $E(X)'="Y",$E(X)'="y" G ASKEXEM1
"RTN","PSOCPC",102,0)
 I X="^" S X=$G(DIR("B")) S Y=$S(X="Y":1,X="N":0,1:"")
"RTN","PSOCPC",103,0)
 S $P(PSOIBQ,"^",PSOSUBS)=$S(Y=1:1,Y=0:0,1:"")
"RTN","PSOCPC",104,0)
 I $P(PSOIBQ,"^",PSOSUBS)'=$P(OLDIBQ,"^",PSOSUBS) S II=II+1,PSOCHG(II)=$S(EXMT="EC":"SWAC",1:EXMT)_": "_$S($P(PSOIBQ,"^",PSOSUBS)=1:"Yes",$P(PSOIBQ,"^",PSOSUBS)=0:"No",1:"")
"RTN","PSOCPC",105,0)
 I Y=1 D
"RTN","PSOCPC",106,0)
 . I PSOCOMM'="" Q
"RTN","PSOCPC",107,0)
 . D SETCOMM^PSOCP
"RTN","PSOCPC",108,0)
 Q
"RTN","PSOCPC",109,0)
 ;
"RTN","PSOCPC",110,0)
HELPEXEM ; help text for exemption edit question
"RTN","PSOCPC",111,0)
 W !,"Enter 'Y' for Yes if you want to edit any applicable exemption flags such as"
"RTN","PSOCPC",112,0)
 W !,"Service Connected (SC), Combat Veteran(CV), Agent Orange (AO), Ionizing"
"RTN","PSOCPC",113,0)
 W !,"Radiation (IR), Southwest Asia Conditions (SWAC), PROJ 112/SHAD,"
"RTN","PSOCPC",114,0)
 W !,"Military Sexual Trauma (MST), or Head and/or Neck Cancer (HNC)."
"RTN","PSOCPC",115,0)
 Q
"RTN","PSOCPC",116,0)
 ;
"RTN","PSOCPC",117,0)
HELPSC ;
"RTN","PSOCPC",118,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is for a Service Connected condition."
"RTN","PSOCPC",119,0)
 S DIR("?",2)="This response will be used to determine whether or not a copay should be"
"RTN","PSOCPC",120,0)
 S DIR("?",3)="applied to the prescription."
"RTN","PSOCPC",121,0)
 Q
"RTN","PSOCPC",122,0)
 ;
"RTN","PSOCPC",123,0)
HELPAO ;
"RTN","PSOCPC",124,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition due to",DIR("?",2)="Vietnam-Era Herbicide (Agent Orange) exposure. This response will be used to"
"RTN","PSOCPC",125,0)
 S DIR("?",3)="determine whether or not a copay should be applied to the prescription."
"RTN","PSOCPC",126,0)
 Q
"RTN","PSOCPC",127,0)
 ;
"RTN","PSOCPC",128,0)
HELPIR ;
"RTN","PSOCPC",129,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition due to",DIR("?",2)="ionizing radiation exposure during military service. This response will be used"
"RTN","PSOCPC",130,0)
 S DIR("?",3)="to determine whether or not a copay should be applied to the prescription."
"RTN","PSOCPC",131,0)
 Q
"RTN","PSOCPC",132,0)
 ;
"RTN","PSOCPC",133,0)
HELPEC ;
"RTN","PSOCPC",134,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition related to",DIR("?",2)="service in Southwest Asia. This response will be used to determine whether"
"RTN","PSOCPC",135,0)
 S DIR("?",3)="or not a copay should be applied to the prescription."
"RTN","PSOCPC",136,0)
 Q
"RTN","PSOCPC",137,0)
 ;
"RTN","PSOCPC",138,0)
HELPMST ;
"RTN","PSOCPC",139,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition related",DIR("?",2)="to Military Sexual Trauma. This response will be used to determine whether or"
"RTN","PSOCPC",140,0)
 S DIR("?",3)="not a copay should be applied to the prescription."
"RTN","PSOCPC",141,0)
 Q
"RTN","PSOCPC",142,0)
 ;
"RTN","PSOCPC",143,0)
HELPHNC ;
"RTN","PSOCPC",144,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat Head and/or Neck Cancer",DIR("?",2)="due to nose or throat radium treatments while in the military. This response"
"RTN","PSOCPC",145,0)
 S DIR("?",3)="will be used to determine whether or not a copay should be applied to the",DIR("?",4)="prescription."
"RTN","PSOCPC",146,0)
 Q
"RTN","PSOCPC",147,0)
 ;
"RTN","PSOCPC",148,0)
HELPCV ;
"RTN","PSOCPC",149,0)
 S DIR("?")=" "
"RTN","PSOCPC",150,0)
 S DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition related"
"RTN","PSOCPC",151,0)
 S DIR("?",2)="to Combat Services. This response will be used to determine whether or"
"RTN","PSOCPC",152,0)
 S DIR("?",3)="not a copay should be applied to the prescription."
"RTN","PSOCPC",153,0)
 Q
"RTN","PSOCPC",154,0)
 ;
"RTN","PSOCPC",155,0)
HELPSHAD ;
"RTN","PSOCPC",156,0)
 S DIR("?")=" "
"RTN","PSOCPC",157,0)
 S DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition related"
"RTN","PSOCPC",158,0)
 S DIR("?",2)="to PROJ 112/SHAD. This response will be used to determine whether or"
"RTN","PSOCPC",159,0)
 S DIR("?",3)="not a copay should be applied to the prescription."
"RTN","PSOCPC",160,0)
 Q
"RTN","PSOCPC",161,0)
SETSUMM ; SET MESSAGE INTO SUMMARY
"RTN","PSOCPC",162,0)
 S PSI=$O(PSOSUMM(PSI)) G:$O(PSOSUMM(PSI)) SETSUMM
"RTN","PSOCPC",163,0)
 S PSI=PSI+1,PSOSUMM(PSI)=PSOCOMM
"RTN","PSOCPC",164,0)
 K PSOCOMM
"RTN","PSOCPC",165,0)
 Q
"RTN","PSOCPC",166,0)
 ;
"RTN","PSOCPE")
0^3^B80668529
"RTN","PSOCPE",1,0)
PSOCPE ;BIR/BAB - PHARMACY COPAY APPLICATION UTILITIES FOR IB ;10/26/92
"RTN","PSOCPE",2,0)
 ;;7.0;OUTPATPSOCT PHARMACY;**26,71,85,114,157,219,268,225**;DEC 1997;Build 29
"RTN","PSOCPE",3,0)
 ;
"RTN","PSOCPE",4,0)
 ;REF/IA
"RTN","PSOCPE",5,0)
 ;^XUSEC/10076
"RTN","PSOCPE",6,0)
 ;^PSDRUG(/221
"RTN","PSOCPE",7,0)
 ;Routine initially released as part of the copayment enhancement.
"RTN","PSOCPE",8,0)
 ;called from PSOLBL
"RTN","PSOCPE",9,0)
INV ;         Entry point from PSOCP - Prints one copay invoice
"RTN","PSOCPE",10,0)
 I '$D(PSOCPN)!($G(RXP)) Q
"RTN","PSOCPE",11,0)
 S PSOCPBAR=0
"RTN","PSOCPE",12,0)
 I $D(PSOBARS),PSOBARS S PSOCPBAR=1
"RTN","PSOCPE",13,0)
 D DEM^VADPT S Y=DT X ^DD("DD") S EDT=Y
"RTN","PSOCPE",14,0)
 W ?54,"PRESCRIPTION COPAYMENT INFORMATION"
"RTN","PSOCPE",15,0)
 W !!,?54,VADM(1)," ",VA("PID")," ",EDT
"RTN","PSOCPE",16,0)
 S PSZ1=0,PSZ2="",PSOCPBN=$P(VADM(2),"^"),PSOCPBN=$S(PSOCPBN]"":PSOCPBN,1:"Unavailable")
"RTN","PSOCPE",17,0)
 ;I '$G(PSOCPN) S PSOCPN=$P(^PSRX(RX,0),U,2)
"RTN","PSOCPE",18,0)
 I PSOCPBAR,(PSOCPBN]"") S X="S",X2=PSOCPBN W !,?54,@PSOBAR1,PSOCPBN,@PSOBAR0
"RTN","PSOCPE",19,0)
 E  W !
"RTN","PSOCPE",20,0)
 W !,?54,"The following prescriptions are"
"RTN","PSOCPE",21,0)
 W !,?54,"eligible for prescription copayment.",!!
"RTN","PSOCPE",22,0)
DRUG S PSZ2="" F  S PSZ2=$O(^TMP($J,"PSOCP",PSOCPN,PSZ2)) Q:PSZ2']""  S PSZ=^(PSZ2) D PRT
"RTN","PSOCPE",23,0)
NAR ; Print narrative from site parameter file
"RTN","PSOCPE",24,0)
 K ^UTILITY($J,"W") S DIWL=55,DIWR=99,DIWF="" W !
"RTN","PSOCPE",25,0)
 G:'$D(^PS(59,PSOSITE,4,0)) END
"RTN","PSOCPE",26,0)
 G:$P(^PS(59,PSOSITE,4,0),"^",3)'>0 END
"RTN","PSOCPE",27,0)
 F PSO9=0:0 S PSO9=$O(^PS(59,PSOSITE,4,PSO9)) G:'PSO9 P1 I $D(^PS(59,PSOSITE,4,PSO9,0)) S X=^(0) D ^DIWP
"RTN","PSOCPE",28,0)
P1 D ^DIWW
"RTN","PSOCPE",29,0)
 K DIWF,DIWL,DIWR,PSO9
"RTN","PSOCPE",30,0)
END ;
"RTN","PSOCPE",31,0)
 W @IOF
"RTN","PSOCPE",32,0)
 K ^TMP($J,"PSOCP",PSOCPN),PSOCPBAR,PSOCPBN,PSZ1,PSZ2,PSOCPN,DIWF,DIWL,DIWR,PSO9
"RTN","PSOCPE",33,0)
 Q
"RTN","PSOCPE",34,0)
PRT ;
"RTN","PSOCPE",35,0)
 W ?54,PSZ2
"RTN","PSOCPE",36,0)
 W ?72," ",$P(^TMP($J,"PSOCP",PSOCPN,PSZ2),"^",3)," ","Days Supply",!
"RTN","PSOCPE",37,0)
 W ?56,$E($P(^TMP($J,"PSOCP",PSOCPN,PSZ2),U,2),1,45),!
"RTN","PSOCPE",38,0)
 Q
"RTN","PSOCPE",39,0)
XMPT ;   Entry point for menu option to select copay exemption
"RTN","PSOCPE",40,0)
 N PSORXPNM,PSORXPRE,PSOCPEDA
"RTN","PSOCPE",41,0)
 I '$D(PSOPAR) D ^PSOLSET G XMPT
"RTN","PSOCPE",42,0)
 W ! S (DIC,DIE)="^PS(53,",DIC(0)="AEQMZ" D ^DIC K DIC G:Y<0 QUIT
"RTN","PSOCPE",43,0)
 G:$D(DTOUT) QUIT
"RTN","PSOCPE",44,0)
 S PSORXPRE=$P($G(^PS(53,+$G(Y),0)),"^",7)
"RTN","PSOCPE",45,0)
 S PSORXPNM=$P($G(^PS(53,+$G(Y),0)),"^")
"RTN","PSOCPE",46,0)
 S DA=+Y,DR="15" L +^PS(53,DA):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3) I '$T W !!,PSORXPNM_" is locked by another user. Try Later!" W ! D PAGE G QUIT
"RTN","PSOCPE",47,0)
 W ! D ^DIE
"RTN","PSOCPE",48,0)
 I PSORXPRE,$P($G(^PS(53,DA,0)),"^",7) W !!,"All Rx's entered with this Rx Patient Status will be EXEMPT from Copayment.",! D PAGE L -^PS(53,DA) G QUIT
"RTN","PSOCPE",49,0)
 I 'PSORXPRE,'$P($G(^PS(53,DA,0)),"^",7) W !!,"All Rx's entered with this Rx Patient Status will NOT be exempt from Copayment.",! D PAGE L -^PS(53,DA) G QUIT
"RTN","PSOCPE",50,0)
 D WARN L -^PS(53,DA)
"RTN","PSOCPE",51,0)
QUIT K PSORXPRE,DIE,DIC,DA,DR,X,C,Y
"RTN","PSOCPE",52,0)
 Q
"RTN","PSOCPE",53,0)
PAGE ;
"RTN","PSOCPE",54,0)
 I '$G(DUZ("AUTO")) K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOCPE",55,0)
 Q
"RTN","PSOCPE",56,0)
WARN ;
"RTN","PSOCPE",57,0)
 S PSOCPEDA=$G(DA)
"RTN","PSOCPE",58,0)
 W !!?28,"**** WARNING ****",!
"RTN","PSOCPE",59,0)
 I 'PSORXPRE W !,"By setting the Exempt from Copayment for the Rx Patient Status of",!,PSORXPNM," to 'YES', every prescription entered",!,"with this Rx Patient Status will NOT be charged a Copayment.",!
"RTN","PSOCPE",60,0)
 I PSORXPRE W !,"By setting the EXEMPT FROM COPAYMENT for the Rx Patient Status of ",!,PSORXPNM," to 'NO', prescriptions entered with this Rx",!,"Patient Status from this point on will NOT be exempt from Copayment.",!
"RTN","PSOCPE",61,0)
 W !,"A mail message will be sent to PSORPH and PSO COPAY Key holders informing",!,"them of your change."
"RTN","PSOCPE",62,0)
 W ! K DIR S DIR(0)="Y",DIR("A")="Are you sure you want to do this",DIR("B")="Y" D ^DIR K DIR
"RTN","PSOCPE",63,0)
 I $G(Y) D  D MAIL G WARNX
"RTN","PSOCPE",64,0)
 .I 'PSORXPRE W !!,"Setting ",PSORXPNM," Rx Patient Status to Exempt from Copayment." Q
"RTN","PSOCPE",65,0)
 .W !!,"Setting Exempt from Copayment to 'NO' for the ",PSORXPNM,!,"Rx Patient Status."
"RTN","PSOCPE",66,0)
 I 'PSORXPRE W !!,"No action taken." S $P(^PS(53,PSOCPEDA,0),"^",7)=0 H 1
"RTN","PSOCPE",67,0)
 I PSORXPRE W !!,"No action taken." S $P(^PS(53,PSOCPEDA,0),"^",7)=1 H 1
"RTN","PSOCPE",68,0)
WARNX W ! D PAGE
"RTN","PSOCPE",69,0)
 S DA=$G(PSOCPEDA) K PSOCPEDA
"RTN","PSOCPE",70,0)
 Q
"RTN","PSOCPE",71,0)
MAIL ;
"RTN","PSOCPE",72,0)
 K PSOTXT,PSOCFN,PSODCPA
"RTN","PSOCPE",73,0)
 I $G(DUZ) S DIC=200,DR=".01",DA=DUZ,DIQ(0)="E",DIQ="PSODCPA(" D EN^DIQ1 S PSOCFN=$G(PSODCPA(200,DA,.01,"E")) K PSODCPA,DIC,DIQ,DR
"RTN","PSOCPE",74,0)
 I 'PSORXPRE S PSOTXT(1,0)="The "_PSORXPNM_" Rx Patient Status has been marked as",PSOTXT(2,0)="Exempt from Copayment by "_$G(PSOCFN)_".",PSOTXT(3,0)="Every prescription with this Rx Patient Status will not be charged a Copayment."
"RTN","PSOCPE",75,0)
 I PSORXPRE S PSOTXT(1,0)="The Exempt from Copayment status has been removed from the",PSOTXT(2,0)=PSORXPNM_" Rx Patient Status by "_$G(PSOCFN)_".",PSOTXT(3,0)="Prescriptions entered with this Rx Patient Status will not be exempt from"
"RTN","PSOCPE",76,0)
 I PSORXPRE S PSOTXT(4,0)="Copayment."
"RTN","PSOCPE",77,0)
 F PSOCXPDA=0:0 S PSOCXPDA=$O(^XUSEC("PSORPH",PSOCXPDA)) Q:'PSOCXPDA  S XMY(PSOCXPDA)=""
"RTN","PSOCPE",78,0)
 F PSOCXPDA=0:0 S PSOCXPDA=$O(^XUSEC("PSO COPAY",PSOCXPDA)) Q:'PSOCXPDA  S XMY(PSOCXPDA)=""
"RTN","PSOCPE",79,0)
 I $G(DUZ) S XMY(DUZ)=""
"RTN","PSOCPE",80,0)
 S XMSUB="Exempt from Copayment",XMTEXT="PSOTXT(",XMDUZ="Outpatient Pharmacy" D ^XMD
"RTN","PSOCPE",81,0)
 K PSOTXT,PSOCXPDA,XMDUZ,PSOCFN,XMTEXT,XMSUB,XMY
"RTN","PSOCPE",82,0)
 Q
"RTN","PSOCPE",83,0)
 ;
"RTN","PSOCPE",84,0)
MAIL2 ; SEND MAIL TO PHARMACIST, PROVIDER, AND HOLDERS OF PSO COPAY KEY
"RTN","PSOCPE",85,0)
 N PSOC,PSOTXT,X
"RTN","PSOCPE",86,0)
 K XMY
"RTN","PSOCPE",87,0)
 S XMSUB="PRESCRIPTION QUESTIONS REVIEW NEEDED"
"RTN","PSOCPE",88,0)
 S XMDUZ="Outpatient Pharmacy Package"
"RTN","PSOCPE",89,0)
 S PSOTXT(1)=" "
"RTN","PSOCPE",90,0)
 S DFN=+$P($G(^PSRX(RXP,0)),"^",2) D PID^VADPT
"RTN","PSOCPE",91,0)
 S PSODIV=$P($G(^PSRX(RXP,2)),"^",9) S:PSODIV'="" XMSUB=XMSUB_" ("_$P($G(^PS(59,PSODIV,0)),"^",6)_")",PSODIV=$P($G(^PS(59,PSODIV,0)),"^",1) ; ADDED DIVISION NUMBER TO SUBJECT LINE - PATCH 85
"RTN","PSOCPE",92,0)
 S PSOTXT(2)=$P($G(^DPT($P(^PSRX(RXP,0),"^",2),0)),"^",1)_"  ("_$G(VA("BID"))_")"_"    "_PSODIV
"RTN","PSOCPE",93,0)
 D ELIG
"RTN","PSOCPE",94,0)
 S PSOTXT(PSOC)="Rx# "_$P(^PSRX(RXP,0),"^",1)_" ("_PSOREF_")    "_$S('$G(^PSRX(RXP,"IB")):"NO COPAY",1:"COPAY")
"RTN","PSOCPE",95,0)
 S PSOC=PSOC+1
"RTN","PSOCPE",96,0)
 S DRG=+$P(^PSRX(RXP,0),"^",6)
"RTN","PSOCPE",97,0)
 S PSOC=PSOC+1
"RTN","PSOCPE",98,0)
 S PSOTXT(PSOC)=$P($G(^PSDRUG(DRG,0)),"^",1)
"RTN","PSOCPE",99,0)
 S PSOC=PSOC+1
"RTN","PSOCPE",100,0)
 S PSOTXT(PSOC)=" "
"RTN","PSOCPE",101,0)
 S PSOC=PSOC+1
"RTN","PSOCPE",102,0)
 S PSOTXT(PSOC)="Due to a change in criteria, additional information listed below is needed"
"RTN","PSOCPE",103,0)
 S PSOC=PSOC+1
"RTN","PSOCPE",104,0)
 S PSOTXT(PSOC)="to determine the final VA copay and/or insurance billable status for this Rx"
"RTN","PSOCPE",105,0)
 S PSOC=PSOC+1
"RTN","PSOCPE",106,0)
 S PSOTXT(PSOC)="so that appropriate action can be taken by pharmacy personnel."
"RTN","PSOCPE",107,0)
 S PSOC=PSOC+1
"RTN","PSOCPE",108,0)
 S PSOTXT(PSOC)=" "
"RTN","PSOCPE",109,0)
 S PSOC=PSOC+1
"RTN","PSOCPE",110,0)
 F EXMT="SC","CV","AO","IR","EC","SHAD","MST","HNC" I $D(PSOTG(EXMT)) D
"RTN","PSOCPE",111,0)
 . I PSOTG(EXMT)'="" Q
"RTN","PSOCPE",112,0)
 . S PSOLTAG="REL"_EXMT
"RTN","PSOCPE",113,0)
 . S PSOQUES=$P($T(@PSOLTAG),";",2) I PSOQUES="" Q
"RTN","PSOCPE",114,0)
 . S PSOC=PSOC+1,PSOTXT(PSOC)=PSOQUES
"RTN","PSOCPE",115,0)
 . S PSOQUES=$P($T(@PSOLTAG),";",2) I PSOQUES="" Q
"RTN","PSOCPE",116,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)=" "
"RTN","PSOCPE",117,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="This message has been sent to the provider of record, the pharmacist who"
"RTN","PSOCPE",118,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="finished the prescription order, and all holders of the PSO COPAY key."
"RTN","PSOCPE",119,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)=" "
"RTN","PSOCPE",120,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="Providers:"
"RTN","PSOCPE",121,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="Please respond with your answer to the question(s) as a reply to this"
"RTN","PSOCPE",122,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="message. The prescription will be updated by the appropriate staff."
"RTN","PSOCPE",123,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)=" "
"RTN","PSOCPE",124,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="Staff assigned to update the Prescription responses:"
"RTN","PSOCPE",125,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="Please use the RESET COPAY STATUS/CANCEL CHARGES option to enter the responses"
"RTN","PSOCPE",126,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="to the questions above, which may result in a Rx copay status change and/or"
"RTN","PSOCPE",127,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="the need to remove VA copay charges or may result in a charge to the patient's"
"RTN","PSOCPE",128,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="insurance carrier."
"RTN","PSOCPE",129,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)=" "
"RTN","PSOCPE",130,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="Note: The SC question is now asked for Veterans who are SC>49% in order to"
"RTN","PSOCPE",131,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="determine if the Rx can be billed to a third party insurance. These Veterans"
"RTN","PSOCPE",132,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="will NOT be charged a VA copay."
"RTN","PSOCPE",133,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)=" "
"RTN","PSOCPE",134,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="Supply and investigational drugs are not charged a VA copay but could be"
"RTN","PSOCPE",135,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="reimbursable by third party insurance."
"RTN","PSOCPE",136,0)
 ; S XMY() TO ALL THE RECIPIENTS
"RTN","PSOCPE",137,0)
 I '$G(PSOREF) S XMY(+$P(^PSRX(RXP,0),"^",4))="" ; ORIGINAL
"RTN","PSOCPE",138,0)
 I $G(PSOREF) S XMY(+$P(^PSRX(RXP,1,PSOREF,0),"^",17))="" ; REFILL
"RTN","PSOCPE",139,0)
 I $G(^PSRX(RXP,"OR1")) I $P(^PSRX(RXP,"OR1"),"^",5)'="" S XMY($P(^PSRX(RXP,"OR1"),"^",5))=""
"RTN","PSOCPE",140,0)
 F PSOCXPDA=0:0 S PSOCXPDA=$O(^XUSEC("PSO COPAY",PSOCXPDA)) Q:'PSOCXPDA  S XMY(PSOCXPDA)=""
"RTN","PSOCPE",141,0)
 S XMTEXT="PSOTXT("
"RTN","PSOCPE",142,0)
 D ^XMD K XMSUB,XMY,XMDUZ,XMTEXT,PSODIV,PSOCXPDA,PSOLTAG,PSOC,PSOQUES,PSOTG
"RTN","PSOCPE",143,0)
 Q
"RTN","PSOCPE",144,0)
 ;
"RTN","PSOCPE",145,0)
ELIG D ELIG^VADPT S PSOC=3,PSOTXT(PSOC)="Eligibility: "_$P(VAEL(1),"^",2)_$S(+VAEL(3):"     SC%: "_$P(VAEL(3),"^",2),1:""),PSOC=PSOC+1
"RTN","PSOCPE",146,0)
 N N,I,I1,PSDIS,PSCNT
"RTN","PSOCPE",147,0)
 S N=0 F  S N=$O(VAEL(1,N)) Q:'N  S $P(PSOTXT(PSOC)," ",14)=$P(VAEL(1,N),"^",2),PSOC=PSOC+1
"RTN","PSOCPE",148,0)
 S PSOTXT(PSOC)=" ",PSOC=PSOC+1,PSOTXT(PSOC)="Disabilities: "
"RTN","PSOCPE",149,0)
 F I=0:0 S I=$O(^DPT(DFN,.372,I)) Q:'I  S I1=$S($D(^DPT(DFN,.372,I,0)):^(0),1:"") D:+I1
"RTN","PSOCPE",150,0)
 .S PSDIS=$S($P($G(^DIC(31,+I1,0)),"^")]""&($P($G(^(0)),"^",4)']""):$P(^(0),"^"),$P($G(^DIC(31,+I1,0)),"^",4)]"":$P(^(0),"^",4),1:""),PSCNT=$P(I1,"^",2)
"RTN","PSOCPE",151,0)
 .S:$L(PSOTXT(PSOC)_PSDIS_"-"_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), ")>80 PSOC=PSOC+1,$P(PSOTXT(PSOC)," ",14)=" "
"RTN","PSOCPE",152,0)
 .S PSOTXT(PSOC)=$G(PSOTXT(PSOC))_PSDIS_"-"_PSCNT_"%("_$S($P(I1,"^",3):"SC",1:"NSC")_"), "
"RTN","PSOCPE",153,0)
 S PSOC=PSOC+1 S PSOTXT(PSOC)=" ",PSOC=PSOC+1
"RTN","PSOCPE",154,0)
 Q
"RTN","PSOCPE",155,0)
 ;
"RTN","PSOCPE",156,0)
 ;EXEMPTION QUESTIONS - MAIL MESSAGE POSITION;SUBSCRIPT IN "IBQ" NODE
"RTN","PSOCPE",157,0)
RELSC ;Is this Rx for a Service Connected Condition?;1
"RTN","PSOCPE",158,0)
RELMST ;Is this Rx related to the treatment of Military Sexual Trauma?;2
"RTN","PSOCPE",159,0)
RELAO ;Is this Rx for treatment of Vietnam-Era Herbicide (Agent Orange) exposure?;3
"RTN","PSOCPE",160,0)
RELIR ;Is this Rx for treatment of Ionizing Radiation exposure?;4
"RTN","PSOCPE",161,0)
RELEC ;Is this Rx for treatment related to service in SW Asia?;5
"RTN","PSOCPE",162,0)
RELHNC ;Is this Rx related to treatment of Head and/or Neck Cancer?;6
"RTN","PSOCPE",163,0)
RELCV ;Is this Rx potentially for treatment related to Combat?;7
"RTN","PSOCPE",164,0)
RELSHAD ;Is this Rx related to treatment of PROJ 112/SHAD?;8
"RTN","PSOCPE",165,0)
 ;
"RTN","PSODIAG")
0^20^B63590551
"RTN","PSODIAG",1,0)
PSODIAG ;BIR/LE - Diagnosis code prompts ;02/27/04
"RTN","PSODIAG",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**143,219,239,268,225**;DEC 1997;Build 29
"RTN","PSODIAG",3,0)
 ;Ext ref to ^XUSEC sup by DBIA 10076
"RTN","PSODIAG",4,0)
 ;Ext ref to $$ICDDX^ICDCODE sup DBIA 3990
"RTN","PSODIAG",5,0)
 ;Ext ref to $$STATCHK^ICDAPIU sup DBIA 3991
"RTN","PSODIAG",6,0)
EN ;
"RTN","PSODIAG",7,0)
 ;don't ask icd's if user doesn't hold provider key
"RTN","PSODIAG",8,0)
 Q:$T(CIDC^IBBAPI)']""
"RTN","PSODIAG",9,0)
 Q:'$D(^XUSEC("PROVIDER",DUZ))
"RTN","PSODIAG",10,0)
 N PSODDFN S PSODDFN=$S($D(DFN):DFN,$D(PSODFN):PSODFN,1:"")  ;need to do this since PU patient update deletes DFN and in case some other function does
"RTN","PSODIAG",11,0)
 I PSODDFN'="" I '$$CIDC^IBBAPI(PSODDFN) S:(+$G(PSONEW("DFLG")))&(+$G(PSOEDIT)=1)&('$D(DA)) PSONEW("DFLG")=0 Q  ;is CIDC activated; does patient have insurance
"RTN","PSODIAG",12,0)
 ;new variables and initialize variables based on CPRS or backdoor order.
"RTN","PSODIAG",13,0)
 N DX,POP,I,J,X,Y,Z,OLD,OLDI,SOLDI,NEW,TNEW,RAR,CPRS,FILDAT,STATCHK,STATCHK2
"RTN","PSODIAG",14,0)
 I '$G(PSOX("IRXN")) N PSOX S:$G(PSORXED("IRXN")) PSOX("IRXN")=PSORXED("IRXN")
"RTN","PSODIAG",15,0)
 K DIC
"RTN","PSODIAG",16,0)
 S CPRS=0
"RTN","PSODIAG",17,0)
 I $G(PSORXED) S RAR="PSORXED",@RAR@("DFLG")=0,PSORXED("FLD",39.3)=""
"RTN","PSODIAG",18,0)
 E  S RAR="PSONEW",@RAR@("DFLG")=0 I $G(ORD) D
"RTN","PSODIAG",19,0)
 . I $D(^PS(52.41,ORD)) S CPRS=1 M PSONEW("ICD")=PSORXED("ICD") K PSORXED("ICD"),PSORXED("FLD",39.3)
"RTN","PSODIAG",20,0)
 ;
"RTN","PSODIAG",21,0)
 S FILDAT="",FILDAT=DT I $G(PSOX("IRXN")) S FILDAT=$$GET1^DIQ(52,PSOX("IRXN")_",","22","I")
"RTN","PSODIAG",22,0)
 ;display any previously entered ICD's
"RTN","PSODIAG",23,0)
 W !!,"Previously entered ICD-9 diagnosis codes: "
"RTN","PSODIAG",24,0)
 I 'CPRS D  ;&(RAR="PSORXED"!(RAR="PSONEW")) D
"RTN","PSODIAG",25,0)
 . I $D(PSOX("IRXN")) I '$D(PSORXED("ICD")) I $D(^PSRX(PSOX("IRXN"),"ICD")) F I=1:1:8 Q:'$D(^PSRX(PSOX("IRXN"),"ICD",I,0))  D
"RTN","PSODIAG",26,0)
 .. S OLD(I)=$$GET1^DIQ(52.052311,I_","_PSOX("IRXN")_",",".01")
"RTN","PSODIAG",27,0)
 .. S OLDI(I)=$$GET1^DIQ(52.052311,I_","_PSOX("IRXN")_",",".01","I")
"RTN","PSODIAG",28,0)
 . I ($D(@RAR@("ICD"))&('$D(OLD)))!($G(PSOCOPY)) D
"RTN","PSODIAG",29,0)
 .. F I=1:1:8 Q:'$D(@RAR@("ICD",I))  I @RAR@("ICD",I)'="" S OLDI(I)=@RAR@("ICD",I) D
"RTN","PSODIAG",30,0)
 ... S OLD(I)=$P(^ICD9(OLDI(I),0),"^",1)
"RTN","PSODIAG",31,0)
 ... S J=I-1 I I=1 W OLD(I) Q
"RTN","PSODIAG",32,0)
 . F I=1:1:8 Q:'$D(OLD(I))  D WRITE
"RTN","PSODIAG",33,0)
 E  I CPRS D
"RTN","PSODIAG",34,0)
 . I '$G(PSONEW("ICD")) F I=1:1:8 Q:'$D(^PS(52.41,ORD,"ICD",I,0))  D
"RTN","PSODIAG",35,0)
 .. S OLD(I)=$$GET1^DIQ(52.41311,I_","_ORD_",",".01")
"RTN","PSODIAG",36,0)
 .. S OLDI(I)=$$GET1^DIQ(52.41311,I_","_ORD_",",".01","I")
"RTN","PSODIAG",37,0)
 . I $D(PSONEW("ICD")) K OLD,OLDI D
"RTN","PSODIAG",38,0)
 .. F I=1:1:8 Q:'$D(PSONEW("ICD",I))  S OLDI(I)=PSONEW("ICD",I) D
"RTN","PSODIAG",39,0)
 ... S OLD(I)=$P(^ICD9(OLDI(I),0),"^",1)
"RTN","PSODIAG",40,0)
 . F I=1:1:8 Q:'$D(OLD(I))  D WRITE
"RTN","PSODIAG",41,0)
 M SOLDI=OLDI
"RTN","PSODIAG",42,0)
 ;
"RTN","PSODIAG",43,0)
EN2 ;ask for ICD's or display previously entered ones for editing
"RTN","PSODIAG",44,0)
 ;note: because ICD's are not longer required, could not use standard
"RTN","PSODIAG",45,0)
 ;       FileMan calls everywhere because of need to control deleted
"RTN","PSODIAG",46,0)
 ;       entries and cross-references.
"RTN","PSODIAG",47,0)
 W !
"RTN","PSODIAG",48,0)
 F I=1:1:8 D  Q:+$G(Y)=-1!(@RAR@("DFLG")) 
"RTN","PSODIAG",49,0)
 . I '$G(PSORXED)&('$G(CPRS)) S RAR="PSONEW"
"RTN","PSODIAG",50,0)
 .K DIC S DIC("A")=$S(I=1:"Select Primary ICD-9 Code: ",1:"Select Secondary ICD-9 Code: ")
"RTN","PSODIAG",51,0)
 . I $D(OLD(I)),(OLD(I)'="") S DIC("B")=OLD(I)
"RTN","PSODIAG",52,0)
 . S X="" W !,DIC("A") D  R X:60   ;did this so that I have control of the deletes
"RTN","PSODIAG",53,0)
 .. I $D(OLD(I)),(OLD(I)'="") W OLD(I)_"// "
"RTN","PSODIAG",54,0)
 . I $D(OLD(I)) S:X="" X=OLD(I)
"RTN","PSODIAG",55,0)
 . I X="" S Y=-1 Q
"RTN","PSODIAG",56,0)
 . I X["?" W !,"Enter a valid ICD-9 diagnosis code." S I=1-1 Q
"RTN","PSODIAG",57,0)
 . I X="@" D DELETE Q
"RTN","PSODIAG",58,0)
 . I X="^" S Y=-1 Q
"RTN","PSODIAG",59,0)
 . K DIC S DIC=80,DIC(0)="EMZQ"
"RTN","PSODIAG",60,0)
 . ;S DIC("S")="I $P($$ICDDX^ICDCODE(Y,FILDAT),U,10)&($P($$ICDDX^ICDCODE(Y,FILDAT),U,17)>$P($$ICDDX^ICDCODE(Y,FILDAT),U,12))"
"RTN","PSODIAG",61,0)
 . S DIC("S")="I $$STATCHK^PSODIAG(Y,FILDAT)"
"RTN","PSODIAG",62,0)
 . K DTOUT,DUOUT D ^DIC K DIC
"RTN","PSODIAG",63,0)
 . I X="^" S I=I-1,Y="" Q
"RTN","PSODIAG",64,0)
 . I $G(DUOUT)!($G(DTOUT)) S Y=-1,X="^" Q
"RTN","PSODIAG",65,0)
 . I +Y=-1&(X'=""!(X'="^")) I $D(^ICD9("BA",X)) S I=I-1,(X,Y)="" Q  ;user said No to are you sure ?.
"RTN","PSODIAG",66,0)
 . I Y=-1&(X?1A.A) S I=I-1,Y="" Q  ;user said not to Yes? question.
"RTN","PSODIAG",67,0)
 . I Y'=-1 D  I STATCHK2=1 S I=I-1,Y="" Q
"RTN","PSODIAG",68,0)
 .. S (STATCHK,STATCHK2)="",STATCHK=$$STATCHK^ICDAPIU($P(Y,U,2),FILDAT) D
"RTN","PSODIAG",69,0)
 ... I $P(STATCHK,"^",2)=-1 W !!,"Invalid ICD-9 diagnosis code.  Please choose another.",! S STATCHK2=1 Q
"RTN","PSODIAG",70,0)
 ... I +STATCHK=0 W !!,"Inactivated ICD-9 Diagnosis Code.  Please choose another.",! S STATCHK2=1 Q
"RTN","PSODIAG",71,0)
 . I +Y=-1 S I=I-1,Y="" W !!,"Invalid or inactivated ICD-9 diagnosis code.  Please choose another.",! Q
"RTN","PSODIAG",72,0)
 . S (POP,J)=0 F J=1:1:I D
"RTN","PSODIAG",73,0)
 ..I $G(DX(J))=+Y W $C(7),!," Duplicate entry.  Please select a different ICD-9 diagnosis code.",! S I=I-1,(Y,X)="",POP=1
"RTN","PSODIAG",74,0)
 . Q:POP
"RTN","PSODIAG",75,0)
 . S NEW("ICD",I)=$P(Y,U,1),DX(I)=+Y
"RTN","PSODIAG",76,0)
 ;
"RTN","PSODIAG",77,0)
 ;resequence entered ICD's and removed deleted ones from file
"RTN","PSODIAG",78,0)
 ;I X="^"&(RAR="PSONEW")&('CPRS) S @RAR@("DFLG")=0 K DUOUT,DTOUT,Y,X Q
"RTN","PSODIAG",79,0)
 ;
"RTN","PSODIAG",80,0)
 I '$D(NEW("ICD")) I $D(OLDI) M NEW("ICD")=OLDI ;if user ^ out on first icd
"RTN","PSODIAG",81,0)
 K PSOICDD I '$D(NEW("ICD"))&($G(PSOCOPY)) S PSOICDD=1
"RTN","PSODIAG",82,0)
 ;
"RTN","PSODIAG",83,0)
 S J=0 F I=1:1:8 Q:'$D(NEW("ICD",I))  I NEW("ICD",I)'="" S J=J+1,@RAR@("ICD",J)=NEW("ICD",I)
"RTN","PSODIAG",84,0)
 S TNEW=I
"RTN","PSODIAG",85,0)
 I X="^" D  ;if up arrow out, set all icd's past ^ point into array
"RTN","PSODIAG",86,0)
 . ;S Y=TNEW-1 F  S Y=$O(OLDI(Y)) Q:Y=""  S J=J+1,@RAR@("ICD",J)=OLDI(Y)
"RTN","PSODIAG",87,0)
 . K @RAR@("ICD") S Y="" F  S Y=$O(SOLDI(Y)) Q:Y=""  S @RAR@("ICD",Y)=SOLDI(Y)
"RTN","PSODIAG",88,0)
 . K PSORXED("FLD",39.3)  ;7/12/04
"RTN","PSODIAG",89,0)
 I $G(CPRS) K PSORX("ICD") M PSORXED("ICD")=@RAR@("ICD"),PSORX("ICD")=@RAR@("ICD")
"RTN","PSODIAG",90,0)
 I $G(PSORXED) K PSORX("ICD") M PSORX("ICD")=@RAR@("ICD")
"RTN","PSODIAG",91,0)
 I '$D(@RAR@("ICD"))&(CPRS) S PSONEW("IDFLG")=1 ;user deleted all in finish/complete order
"RTN","PSODIAG",92,0)
 Q:(RAR="PSONEW")
"RTN","PSODIAG",93,0)
 I '$D(@RAR@("ICD"))&('CPRS)&($D(^PSRX(PSOX("IRXN"),"ICD",1,0))) S PSORXED("IDFLG")=1  ;user deleted all
"RTN","PSODIAG",94,0)
 Q
"RTN","PSODIAG",95,0)
 ;
"RTN","PSODIAG",96,0)
 ;called from above to write previously entered ICD's to screen.
"RTN","PSODIAG",97,0)
WRITE S J=I-1 I I=1 W !,?10,"Primary: ",OLD(I),?30,$P($$ICDDX^ICDCODE(OLD(I),FILDAT),U,4) Q
"RTN","PSODIAG",98,0)
WRITE2 I I=2 W !,?3,"Secondaries #"_J_": ",OLD(I),?30,$P($$ICDDX^ICDCODE(OLD(I),FILDAT),U,4) Q
"RTN","PSODIAG",99,0)
 I I>2 W !,?15,"#"_J_": ",OLD(I),?30,$P($$ICDDX^ICDCODE(OLD(I),FILDAT),U,4)
"RTN","PSODIAG",100,0)
 Q
"RTN","PSODIAG",101,0)
STATCHK(ICDIEN,FILDAT) ;called from above to check active/inactive date during FileMan call.
"RTN","PSODIAG",102,0)
 N X S X=""
"RTN","PSODIAG",103,0)
 S ICDIEN=$P(^ICD9(ICDIEN,0),"^",1) S X=$$STATCHK^ICDAPIU(ICDIEN,FILDAT)
"RTN","PSODIAG",104,0)
 Q +X
"RTN","PSODIAG",105,0)
DELETE ;called from above to verify delete with user and to delete said entries
"RTN","PSODIAG",106,0)
 W !,"SURE YOU WANT TO DELETE? " S X="" R X:30 S X=$TR(X,"yn","YN")
"RTN","PSODIAG",107,0)
 I X'="Y"&(X'="N") W !,"Enter Y or N" G DELETE
"RTN","PSODIAG",108,0)
 I X="N" S I=I-1 Q
"RTN","PSODIAG",109,0)
 F J=I:1:8 Q:'$D(OLDI(J))  D
"RTN","PSODIAG",110,0)
 . I $D(OLDI(J+1)) S OLDI(J)=OLDI(J+1),OLD(J)=OLD(J+1) D
"RTN","PSODIAG",111,0)
 .. I CPRS&($D(PSONEW("ICD",J+1))) S PSONEW("ICD",J)=PSONEW("ICD",J+1)
"RTN","PSODIAG",112,0)
 .. E  I CPRS&('$D(PSONEW("ICD",J+1))) S PSONEW("ICD",J)=OLDI(J+1)
"RTN","PSODIAG",113,0)
 .. I $G(PSOCOPY) D
"RTN","PSODIAG",114,0)
 ... I ($D(PSONEW("ICD",J+1))) S PSONEW("ICD",J)=PSONEW("ICD",J+1)
"RTN","PSODIAG",115,0)
 ... I ($D(PSORXED("ICD",J+1))) S PSORXED("ICD",J)=PSORXED("ICD",J+1)
"RTN","PSODIAG",116,0)
 . E  K OLD(J),OLDI(J),PSONEW("ICD",J),PSORXED("ICD",J)
"RTN","PSODIAG",117,0)
 . ;I CPRS!($G(PSOCOPY)) K PSONEW("ICD",J),PSORXED("ICD",J)
"RTN","PSODIAG",118,0)
 S I=I-1,(X,Y)=""
"RTN","PSODIAG",119,0)
 Q
"RTN","PSODIAG",120,0)
 ;
"RTN","PSODIAG",121,0)
ICD ;called from PSON52 cause PSON52'S too large.  Stores ICD info for new Rx's (CPRS and backdoor) using variables from copy function and new order functions.
"RTN","PSODIAG",122,0)
 N D,DDATA,ICD,II
"RTN","PSODIAG",123,0)
 I $G(PSOCOPY)&('$D(PSOX("ICD")))&('$G(PSOICDD)) D
"RTN","PSODIAG",124,0)
 . S D=0 F D=1:1 Q:'$D(PSOX("ICD",D))
"RTN","PSODIAG",125,0)
 . F D=D:1:8 K ^PSRX(PSOX("IRXN"),"ICD",D,0)  ;remove any icd's del
"RTN","PSODIAG",126,0)
 . I $D(^PSRX(PSOX("OIRXN"),"ICD",0)) F D=1:1:8 Q:'$D(^PSRX(PSOX("OIRXN"),"ICD",D,0))  S PSOX("ICD",D)=$P(^PSRX(PSOX("OIRXN"),"ICD",D,0),U,1)
"RTN","PSODIAG",127,0)
 I $G(ORD) I $D(^PS(52.41,ORD,0))&($D(PSORX("ICD"))) M PSOX("ICD")=PSONEW("ICD")
"RTN","PSODIAG",128,0)
 I $D(PSOX("ICD")) F D=1:1:8 Q:'$D(PSOX("ICD",D))  S ICD=$G(PSOX("ICD",D)) D
"RTN","PSODIAG",129,0)
 . S DDATA=ICD_"^"_$G(PSOANSQ("VEH"))_"^"_$G(PSOANSQ("RAD"))_"^"_$S(PSOSCP>49:$G(PSOANSQ("SC>50")),PSOSCP<50&(PSOSCP'=""):$G(PSOANSQ("SC")),1:"")_"^"_$G(PSOANSQ("PGW"))_"^"_$G(PSOANSQ("MST"))_"^"_$G(PSOANSQ("HNC"))_"^"_$G(PSOANSQ("CV"))
"RTN","PSODIAG",130,0)
 . S DDATA=DDATA_"^"_$G(PSOANSQ("SHAD"))
"RTN","PSODIAG",131,0)
 . I $P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1 I PSOSCP<50&($D(PSOANSQ("SC>50"))) S $P(DDATA,"^",4)=PSOANSQ("SC>50")  ;for times when sc has no % defined.
"RTN","PSODIAG",132,0)
 . S ^PSRX(PSOX("IRXN"),"ICD",D,0)=DDATA,II=D
"RTN","PSODIAG",133,0)
 E  S D=1 D
"RTN","PSODIAG",134,0)
 . S DDATA="^"_$G(PSOANSQ("VEH"))_"^"_$G(PSOANSQ("RAD"))_"^"_$S(PSOSCP>49:$G(PSOANSQ("SC>50")),PSOSCP<50&(PSOSCP'=""):$G(PSOANSQ("SC")),1:"")
"RTN","PSODIAG",135,0)
 . S DDATA=DDATA_"^"_$G(PSOANSQ("PGW"))_"^"_$G(PSOANSQ("MST"))_"^"_$G(PSOANSQ("HNC"))_"^"_$G(PSOANSQ("CV"))_"^"_$G(PSOANSQ("SHAD"))
"RTN","PSODIAG",136,0)
 . S ^PSRX(PSOX("IRXN"),"ICD",D,0)=DDATA,II=D
"RTN","PSODIAG",137,0)
 . I $P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1 I PSOSCP<50&($D(PSOANSQ("SC>50"))) S $P(^PSRX(PSOX("IRXN"),"ICD",D,0),"^",4)=PSOANSQ("SC>50")
"RTN","PSODIAG",138,0)
 S ^PSRX(PSOX("IRXN"),"ICD",0)="^52.052311P^"_II_"^"_II
"RTN","PSODIAG",139,0)
 K PSOX("ICD"),PSORXED("ICD"),PSONEW("ICD"),PSORX("ICD")
"RTN","PSODIAG",140,0)
 Q
"RTN","PSODIAG",141,0)
 ;
"RTN","PSODIAG",142,0)
UPDATE ;was in PSOORED6; now called from PSOORED6; removes deletes for edits and stores data.
"RTN","PSODIAG",143,0)
 ;
"RTN","PSODIAG",144,0)
 N TNEW,DA,DIK,SCEI,I,II
"RTN","PSODIAG",145,0)
 S DA=PSORXED("IRXN")
"RTN","PSODIAG",146,0)
 I '$D(PSORXED("ICD"))&($G(PSORXED("IDFLG"))) D  K PSORXED("IDFLG") Q
"RTN","PSODIAG",147,0)
 . I $D(^PSRX(PSORXED("IRXN"),"ICD",1,0)) D
"RTN","PSODIAG",148,0)
 .. S TNEW=2 K ^PSRX(PSORXED("IRXN"),"ICD","B") S $P(^PSRX(PSORXED("IRXN"),"ICD",1,0),U,1)=""
"RTN","PSODIAG",149,0)
 .. F I=TNEW:1:8 Q:'$D(^PSRX(PSORXED("IRXN"),"ICD",I,0))  S DIK="^PSRX("_PSORXED("IRXN")_","_$C(34)_"ICD"_$C(34)_",",DA=I,DA(1)=PSORXED("IRXN") D ^DIK K DA,DIK
"RTN","PSODIAG",150,0)
 ;
"RTN","PSODIAG",151,0)
 I $D(PSORXED("ICD")) D
"RTN","PSODIAG",152,0)
 . S SCEI=$G(^PSRX(DA,"ICD",1,0)),$P(SCEI,"^")=""
"RTN","PSODIAG",153,0)
 . K ^PSRX(DA,"ICD")
"RTN","PSODIAG",154,0)
 . F I=1:1:8 Q:'$D(PSORXED("ICD",I))  S $P(SCEI,"^")=PSORXED("ICD",I),^PSRX(DA,"ICD",I,0)=SCEI,^PSRX(DA,"ICD","B",$P(SCEI,"^"),I)="",II=I
"RTN","PSODIAG",155,0)
 . S ^PSRX(DA,"ICD",0)="^52.052311P^"_II_U_II
"RTN","PSODIAG",156,0)
 Q
"RTN","PSODIAG",157,0)
 ;
"RTN","PSODIAG",158,0)
CSET ;Called from PSOHLNEW due to it's routine size.  Requires PSOICD & PENDING variable.  Sets ICD node for orders passed from CPRS.
"RTN","PSODIAG",159,0)
 N EE,EEE
"RTN","PSODIAG",160,0)
 S (EE,EEE)=0 F  S EE=$O(PSOICD(EE)) Q:EE=""  D
"RTN","PSODIAG",161,0)
 .S EEE=EEE+1,^PS(52.41,PENDING,"ICD",EEE,0)=PSOICD(EE) S:$P(PSOICD(EE),"^")'="" ^PS(52.41,PENDING,"ICD","B",$P(PSOICD(EE),"^"),EEE)=""
"RTN","PSODIAG",162,0)
 .S ^PS(52.41,PENDING,"ICD",0)="^52.41311PA"_U_EEE_U_EEE
"RTN","PSODIAG",163,0)
 Q
"RTN","PSOHLDA")
0^39^B10014334
"RTN","PSOHLDA",1,0)
PSOHLDA ;BIR/MFR - HOLD/UNHOLD functionality (cont.) ;07/15/96
"RTN","PSOHLDA",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148,225**;DEC 1997;Build 29
"RTN","PSOHLDA",3,0)
 ;
"RTN","PSOHLDA",4,0)
HOLD ;hold function
"RTN","PSOHLDA",5,0)
 I $P($G(^PSRX(DA,"STA")),"^")=3 Q
"RTN","PSOHLDA",6,0)
 S RSDT=$S($P(^PSRX(DA,2),"^",13):$P(^PSRX(DA,3),"^"),1:"@"),(PSUS,ACT,RXF,RFN,I)=0 F  S I=$O(^PSRX(DA,1,I)) Q:'I  D
"RTN","PSOHLDA",7,0)
 .S RXF=I,RFN=RFN+1 S:RFN=1 RSDT=$S('$P(^PSRX(DA,1,I,0),"^",18):$P(^PSRX(DA,2),"^",2),1:$P(^PSRX(DA,1,I,0),"^"))
"RTN","PSOHLDA",8,0)
 .I RFN>1,'$P(^PSRX(DA,1,I,0),"^",18) S RSDT=$P(^PSRX(DA,1,RXF-1,0),"^") Q
"RTN","PSOHLDA",9,0)
 .S:RFN>1 RSDT=$P(^PSRX(DA,1,RXF,0),"^")
"RTN","PSOHLDA",10,0)
 I RXF D
"RTN","PSOHLDA",11,0)
 .S (PSDA,DA(1))=DA,DA=RXF,DIE="^PSRX("_DA(1)_",1,",DR="4" D ^DIE
"RTN","PSOHLDA",12,0)
 .S $P(^PSRX(DA(1),1,DA,0),"^",3)=$S($G(FLD(99.1))]"":$E(FLD(99.1),1,60),1:"")
"RTN","PSOHLDA",13,0)
 .S DA=PSDA K DA(1)
"RTN","PSOHLDA",14,0)
 S DIE="^PSRX(",DR=$S('RXF&('$P(^PSRX(DA,2),"^",13)):"22///@;",1:"")_"99///"_FLD(99)_";99.1///^S X=FLD(99.1);99.2///"_DT_";100///3;101///"_RSDT D ^DIE Q:$D(Y)
"RTN","PSOHLDA",15,0)
 S:$G(PSOHD) VALMSG="RX# "_$P(^PSRX(DA,0),"^")_" has been placed in a hold status."
"RTN","PSOHLDA",16,0)
 K RXRS(DA)
"RTN","PSOHLDA",17,0)
 I +$G(PSDA) S DA=$O(^PS(52.5,"B",PSDA,0)) I DA S:$P($G(^PS(52.5,DA,"P")),"^")=0 PSUS=1 S DIK="^PS(52.5," D ^DIK K DA,DIK
"RTN","PSOHLDA",18,0)
 S:+$G(PSDA) DA=PSDA D ACT
"RTN","PSOHLDA",19,0)
 S PSOHNX=+$P($G(^PSRX(+$G(DA),"H")),"^") D
"RTN","PSOHLDA",20,0)
 .I $G(PSOHNX),$P($G(^PSRX(DA,"H")),"^",2)'="" S COMM=$P($G(^("H")),"^",2) Q
"RTN","PSOHLDA",21,0)
 .S COMM="Medication placed on Hold "_$E(DT,4,5)_"-"_$E(DT,6,7)_"-"_$E(DT,2,3)
"RTN","PSOHLDA",22,0)
 D EN^PSOHLSN1(DA,"OH","",COMM,PSONOOR) K COMM,PSOHNX
"RTN","PSOHLDA",23,0)
 ;
"RTN","PSOHLDA",24,0)
 ; - Closes any OPEN/UNRESOLVED REJECTs and Reverses ECME Claim
"RTN","PSOHLDA",25,0)
 D REVERSE^PSOBPSU1(DA,+$G(RXF),"HLD",2)
"RTN","PSOHLDA",26,0)
 Q
"RTN","PSOHLDA",27,0)
 ;
"RTN","PSOHLDA",28,0)
ACT ;adds activity info for rx removed or placed on hold
"RTN","PSOHLDA",29,0)
 D NOW^%DTC S NOW=%
"RTN","PSOHLDA",30,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(DA,"A",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOHLDA",31,0)
 S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSOHLDA",32,0)
 S ^PSRX(DA,"A",IR,0)=NOW_"^"_$S(ACT:"U",1:"H")_"^"_DUZ_"^"_$S(RXF>5:RXF+1,1:RXF)_"^"_"RX "_$S('ACT:"placed in a",1:"removed from")_" HOLD status "_$S(+$G(PSUS):"and removed from SUSPENSE ",1:"")_"("_$E(DT,4,5)_"-"_$E(DT,6,7)_"-"_$E(DT,2,3)_")"
"RTN","PSOHLDA",33,0)
 K PSUS,RXF,I,FDA,DIC,DIE,DR,Y,X,%,%I,%H,RSDT
"RTN","PSOHLDA",34,0)
 Q
"RTN","PSOHLDA",35,0)
 ;
"RTN","PSOHLDA",36,0)
RMP ;remove Rx if found in array PSORX("PSOL")
"RTN","PSOHLDA",37,0)
 Q:'$G(DA)
"RTN","PSOHLDA",38,0)
 N I,J,K,PSOX2,PSOX3,PSOX9 S I=0
"RTN","PSOHLDA",39,0)
 F  S I=$O(PSORX("PSOL",I)) Q:'I  S PSOX2=PSORX("PSOL",I) D:PSOX2[(DA_",")
"RTN","PSOHLDA",40,0)
 .S PSOX9="",K=0 F J=1:1 S PSOX3=$P(PSOX2,",",J) Q:'PSOX3  D
"RTN","PSOHLDA",41,0)
 ..I PSOX3=DA,$P($G(^PSRX(DA,"STA")),"^")=3 S K=1 Q
"RTN","PSOHLDA",42,0)
 ..S PSOX9=PSOX9_$S('PSOX9:"",1:",")_PSOX3
"RTN","PSOHLDA",43,0)
 .I K S:PSOX9]"" PSORX("PSOL",I)=PSOX9_"," K:PSOX9="" PSORX("PSOL",I) D:$D(BBRX(I)) RMB
"RTN","PSOHLDA",44,0)
 Q
"RTN","PSOHLDA",45,0)
RMB ;remove Rx if found in array BBRX()
"RTN","PSOHLDA",46,0)
 S PSOX2=BBRX(I) D:PSOX2[(DA_",")
"RTN","PSOHLDA",47,0)
 .S PSOX9="" F J=1:1 S PSOX3=$P(PSOX2,",",J) Q:'PSOX3  S:PSOX3'=DA PSOX9=PSOX9_$S('PSOX9:"",1:",")_PSOX3
"RTN","PSOHLDA",48,0)
 .S:PSOX9]"" BBRX(I)=PSOX9_"," K:PSOX9="" BBRX(I)
"RTN","PSOHLDA",49,0)
 Q
"RTN","PSOHLNE1")
0^4^B73330251
"RTN","PSOHLNE1",1,0)
PSOHLNE1 ;BIR/RTR-Parsing out segments from OERR ;01/20/95
"RTN","PSOHLNE1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,9,46,71,98,111,117,131,157,181,143,235,239,225**;DEC 1997;Build 29
"RTN","PSOHLNE1",3,0)
 ;External reference to EN^ORERR supported by DBIA 2187
"RTN","PSOHLNE1",4,0)
 ;External reference to PS(50.607 supported by DBIA 2221
"RTN","PSOHLNE1",5,0)
 ;External reference to OR(100 supported by DBIA 2219
"RTN","PSOHLNE1",6,0)
 ;External reference to PSDRUG( supported by DBIA 221
"RTN","PSOHLNE1",7,0)
 ;External reference VADPT supported by DBIA 10061
"RTN","PSOHLNE1",8,0)
 ;
"RTN","PSOHLNE1",9,0)
EN ;ORC segment
"RTN","PSOHLNE1",10,0)
 N Q1,Q2,Q3,Q4,Q5,Q6,Q7,PSOPOSSD
"RTN","PSOHLNE1",11,0)
 K PSOLQ1I,PSOLQ1II,PSOLQ1IX
"RTN","PSOHLNE1",12,0)
 I '$O(MSG(ZZ,0)) D
"RTN","PSOHLNE1",13,0)
 .S PSOOC="NW",PLACER=+$P(PSOSEG,"|",2),PLACERXX=+$P($P(PSOSEG,"|",2),";",2),ENTERED=$P(PSOSEG,"|",10),PROV=$P(PSOSEG,"|",12)
"RTN","PSOHLNE1",14,0)
 .S X=$P(PSOSEG,"|",15) S EFFECT=$$HL7TFM^XLFDT(X) K X
"RTN","PSOHLNE1",15,0)
 .D NOW^%DTC S PSOLOG=% K %
"RTN","PSOHLNE1",16,0)
 .;S RSN=$P(PSOSEG,"|",16)
"RTN","PSOHLNE1",17,0)
 .S ORCSEG=$P(PSOSEG,"|",7),QCOUNT=1 Q:$G(ORCSEG)'["~"
"RTN","PSOHLNE1",18,0)
 .F JJ=1:1:$L(ORCSEG) S:$E(ORCSEG,JJ)="~" QCOUNT=QCOUNT+1
"RTN","PSOHLNE1",19,0)
 I '$O(MSG(ZZ,0)) D  Q
"RTN","PSOHLNE1",20,0)
 .F JJJ=1:1:QCOUNT S QQQ=$P(ORCSEG,"~",JJJ) D:QQQ'=""
"RTN","PSOHLNE1",21,0)
 ..S PSOPOSSD=$S($P($P(QQQ,"^"),"&"):1,1:0) ;PSOPOSSD=1 if possible dose
"RTN","PSOHLNE1",22,0)
 ..S Q1I(JJJ)=$S(PSOPOSSD:$P(QQQ,"^"),1:$P(QQQ,"^",8)),PSOLQ1IX(JJJ)=$P($P(QQQ,"^"),"&",5) S PSOLQ1I(JJJ)=$P(QQQ,"^",8),PSOLQ1II(JJJ)=PSOPOSSD ;ORC piece 1 if Possible Dosage, ORC piece 8 if Local Possible Dosage
"RTN","PSOHLNE1",23,0)
 ..S Q1(JJJ)=$P(QQQ,"^",2) ;schedule
"RTN","PSOHLNE1",24,0)
 ..S Q2(JJJ)=$P(QQQ,"^",3) ;duration
"RTN","PSOHLNE1",25,0)
 ..S Q3(JJJ)=$P(QQQ,"^",4) I Q3(JJJ) S X=Q3(JJJ) S Q3(JJJ)=$$HL7TFM^XLFDT(X) K X ;start date
"RTN","PSOHLNE1",26,0)
 ..S Q4(JJJ)=$P(QQQ,"^",5) ;end date
"RTN","PSOHLNE1",27,0)
 ..S:$G(PRIOR)="" PRIOR=$P(QQQ,"^",6)
"RTN","PSOHLNE1",28,0)
 ..S Q6(JJJ)=$P(QQQ,"^",9) ;conjunction
"RTN","PSOHLNE1",29,0)
 ..S Q7(JJJ)=$P(QQQ,"^",10) ;sequencing
"RTN","PSOHLNE1",30,0)
 ..S QTARRAY(JJJ)=Q1(JJJ)_"^"_Q2(JJJ)_"^"_Q3(JJJ)_"^"_Q4(JJJ)_"^^"_Q6(JJJ)_"^"_Q7(JJJ)
"RTN","PSOHLNE1",31,0)
 ..S QTARRAY2(JJJ)=$S(PSOPOSSD:$P(Q1I(JJJ),"&"),1:Q1I(JJJ))_"^"_$S(PSOPOSSD:$P(Q1I(JJJ),"&",3),1:"")
"RTN","PSOHLNE1",32,0)
 ..I PSOPOSSD S $P(QTARRAY(JJJ),"^",5)=$P(Q1I(JJJ),"&",4)
"RTN","PSOHLNE1",33,0)
 ..I PSOPOSSD S PSOUNN=$P(Q1I(JJJ),"&",2) I PSOUNN'="" S PSOUNN=$O(^PS(50.607,"B",PSOUNN,0)) S $P(QTARRAY(JJJ),"^",9)=$G(PSOUNN)
"RTN","PSOHLNE1",34,0)
 ..K PSOUNN
"RTN","PSOHLNE1",35,0)
 ;For multiple ORC subscripts
"RTN","PSOHLNE1",36,0)
 S (POVAR,POVAR1)="",(NNCK,NNN,NNNN)=0,PSOIII=1,MSG(ZZ,0)=$E(MSG(ZZ),5,$L(MSG(ZZ)))
"RTN","PSOHLNE1",37,0)
 S AAA="" F  S AAA=$O(MSG(ZZ,AAA)) Q:AAA=""  S NNN=0 F OOO=1:1:$L(MSG(ZZ,AAA)) S NNN=NNN+1 D  D:$G(POVAR1)="~"&(NNNN=6) PARSE D:$G(POVAR1)="|" PARSE
"RTN","PSOHLNE1",38,0)
 .I $E(MSG(ZZ,AAA),OOO)="|" S NNNN=NNNN+1
"RTN","PSOHLNE1",39,0)
 .S POVAR1=$E(MSG(ZZ,AAA),OOO)
"RTN","PSOHLNE1",40,0)
 .S POLIM=POVAR
"RTN","PSOHLNE1",41,0)
 .S POVAR=$S(POVAR="":POVAR1,1:POVAR_POVAR1)
"RTN","PSOHLNE1",42,0)
 .;I NNNN=6 I $G(POVAR1)="~"!($G(POVAR1)="|")
"RTN","PSOHLNE1",43,0)
END ;16 OF ORC?
"RTN","PSOHLNE1",44,0)
 ;I $G(POVAR)'="" I NNNN=14!(NNNN=15) S EFFECT=$G(POVAR)
"RTN","PSOHLNE1",45,0)
 S QCOUNT=0 F JJJ=0:0 S JJJ=$O(QTVAR(JJJ)) Q:'JJJ  I $L($G(QTVAR(JJJ))) S QCOUNT=QCOUNT+1 D
"RTN","PSOHLNE1",46,0)
 .S PSOPOSSD=$S($P($P(QTVAR(JJJ),"^"),"&"):1,1:0) ;PSOPOSSD =1 if possible dose
"RTN","PSOHLNE1",47,0)
 .S Q1I(JJJ)=$S(PSOPOSSD:$P(QTVAR(JJJ),"^"),1:$P(QTVAR(JJJ),"^",8)),PSOLQ1IX(JJJ)=$P($P(QTVAR(JJJ),"^"),"&",5) S PSOLQ1I(JJJ)=$P(QTVAR(JJJ),"^",8),PSOLQ1II(JJJ)=PSOPOSSD ;piece 1 if possible dose, piece 8 if not
"RTN","PSOHLNE1",48,0)
 .S Q1(JJJ)=$P(QTVAR(JJJ),"^",2)
"RTN","PSOHLNE1",49,0)
 .S Q2(JJJ)=$P(QTVAR(JJJ),"^",3)
"RTN","PSOHLNE1",50,0)
 .;S Q2(JJJ)=$S($E($P(QTVAR(JJJ),"^",3)):"D"_$P(QTVAR(JJJ),"^",3),$E($P(QTVAR(JJJ),"^",3))=0:"D"_$P(QTVAR(JJJ),"^",3),1:$P(QTVAR(JJJ),"^",3))
"RTN","PSOHLNE1",51,0)
 .S Q3(JJJ)=$P(QTVAR(JJJ),"^",4) I Q3(JJJ) S X=Q3(JJJ) S Q3(JJJ)=$$HL7TFM^XLFDT(X) K X
"RTN","PSOHLNE1",52,0)
 .S Q4(JJJ)=$P(QTVAR(JJJ),"^",5)
"RTN","PSOHLNE1",53,0)
 .S:$G(PRIOR)="" PRIOR=$P(QTVAR(JJJ),"^",6)
"RTN","PSOHLNE1",54,0)
 .S Q6(JJJ)=$P(QTVAR(JJJ),"^",9)
"RTN","PSOHLNE1",55,0)
 .S Q7(JJJ)=$P(QTVAR(JJJ),"^",10)
"RTN","PSOHLNE1",56,0)
 .S QTARRAY(JJJ)=Q1(JJJ)_"^"_Q2(JJJ)_"^"_Q3(JJJ)_"^"_Q4(JJJ)_"^^"_Q6(JJJ)_"^"_Q7(JJJ)
"RTN","PSOHLNE1",57,0)
 .S QTARRAY2(JJJ)=$S(PSOPOSSD:$P(Q1I(JJJ),"&"),1:Q1I(JJJ))_"^"_$S(PSOPOSSD:$P(Q1I(JJJ),"&",3),1:"")
"RTN","PSOHLNE1",58,0)
 .I PSOPOSSD S $P(QTARRAY(JJJ),"^",5)=$P(Q1I(JJJ),"&",4)
"RTN","PSOHLNE1",59,0)
 .I PSOPOSSD S PSOUNN=$P(Q1I(JJJ),"&",2) I PSOUNN'="" S PSOUNN=$O(^PS(50.607,"B",PSOUNN,0)) S $P(QTARRAY(JJJ),"^",9)=$G(PSOUNN)
"RTN","PSOHLNE1",60,0)
 .K PSOUNN
"RTN","PSOHLNE1",61,0)
 I $G(EFFECT) S X=EFFECT S EFFECT=$$HL7TFM^XLFDT(X) K X
"RTN","PSOHLNE1",62,0)
 D NOW^%DTC S PSOLOG=% S:'$G(EFFECT) EFFECT=% K %
"RTN","PSOHLNE1",63,0)
 K MSG(ZZ,0)
"RTN","PSOHLNE1",64,0)
 Q
"RTN","PSOHLNE1",65,0)
PARSE I NNNN=1 S PSOOC="NW" G SET
"RTN","PSOHLNE1",66,0)
 I NNNN=2 S PLACER=+$G(POLIM),PLACERXX=+$P($G(POLIM),";",2) G SET
"RTN","PSOHLNE1",67,0)
 I NNNN=3!(NNNN=4)!(NNNN=5) G SET
"RTN","PSOHLNE1",68,0)
 I NNNN=6,$G(POVAR1)="~" S NNCK=NNCK+1,QTVAR(NNCK)=$G(POLIM) G SET
"RTN","PSOHLNE1",69,0)
 I NNNN=7 S NNCK=NNCK+1 S QTVAR(NNCK)=$G(POLIM) G SET
"RTN","PSOHLNE1",70,0)
 I NNNN=8!(NNNN=9) G SET
"RTN","PSOHLNE1",71,0)
 I NNNN=10 S ENTERED=$G(POLIM) G SET
"RTN","PSOHLNE1",72,0)
 I NNNN=11 G SET
"RTN","PSOHLNE1",73,0)
 I NNNN=12 S PROV=$G(POLIM) G SET
"RTN","PSOHLNE1",74,0)
 I NNNN=13!(NNNN=14) G SET
"RTN","PSOHLNE1",75,0)
 I NNNN=15 S EFFECT=$G(POLIM)
"RTN","PSOHLNE1",76,0)
SET S (POVAR,POLIM)="" Q
"RTN","PSOHLNE1",77,0)
 ;
"RTN","PSOHLNE1",78,0)
EXP ;
"RTN","PSOHLNE1",79,0)
 ;Q:'$G(OR("PLACE"))
"RTN","PSOHLNE1",80,0)
 Q:'$G(PSOFILNM)
"RTN","PSOHLNE1",81,0)
 S PSOMSORR=1
"RTN","PSOHLNE1",82,0)
 N PSOSSMES S PSOSSMES="CPRSUP"
"RTN","PSOHLNE1",83,0)
 I $G(PSOFILNM),$G(PSOFILNM)["S" S LL=+$G(PSOFILNM) I $D(^PS(52.41,LL,0)),$P($G(^(0)),"^",3)'="RF" G EXPEN
"RTN","PSOHLNE1",84,0)
 S LL=$G(PSOFILNM) I 'LL!('$D(^PSRX(+$G(LL),0))) S COMM="Order was not located by Pharmacy" D EN^ORERR(COMM,.MSG) D  G EXPQ
"RTN","PSOHLNE1",85,0)
 .F EER=0:0 S EER=$O(MSG(EER)) Q:'EER  S:$P(MSG(EER),"|")="PV1" PSERRPV1=MSG(EER) S:$P(MSG(EER),"|")="PID" PSERRPID=MSG(EER) S:$P(MSG(EER),"|")="ORC"&($G(PSERRORC)="") PSERRORC=MSG(EER)
"RTN","PSOHLNE1",86,0)
 .N MSG,PSOHINST D INIT^PSOHLSN S MSG(2)=$G(PSERRPID),MSG(3)=$G(PSERRPV1),MSG(4)="ORC|DE|"_$G(OR("PLACE"))_$S($G(PLACERXX):";"_PLACERXX,1:"")_"^OR"_"|"_$S($P($G(PSERRORC),"|",4)'="":$P(PSERRORC,"|",4),1:"") S:$G(COMM)'="" MSG(5)="NTE|16||"_COMM
"RTN","PSOHLNE1",87,0)
 .D SEND^PSOHLSN
"RTN","PSOHLNE1",88,0)
 Q:'$D(^PSRX(LL,0))
"RTN","PSOHLNE1",89,0)
 I +$P($G(^PSRX(LL,2)),"^",6)<DT D
"RTN","PSOHLNE1",90,0)
 .;Reset PSOSSMES if status changes, so HDR gets updated in PSOHLSN1
"RTN","PSOHLNE1",91,0)
 .I +$P($G(^PSRX(LL,"STA")),"^")<12!($P($G(^("STA")),"^")=16) S $P(^PSRX(LL,"STA"),"^")=11 D ECAN^PSOUTL(LL) S PSOSSMES="CPRSVDEF"
"RTN","PSOHLNE1",92,0)
 S GG=+$P($G(^PSRX(LL,"STA")),"^")
"RTN","PSOHLNE1",93,0)
 ;S AA=$S(GG=3:"OH",GG=12:"OD",GG=13:"OC",GG=14:"OD",GG=15:"OD",GG=16:"OH",1:"SC"),AAA=$S(GG=0:"CM",GG=1:"IP",GG=4:"IP",GG=5:"ZS",GG=11:"ZE",1:"")
"RTN","PSOHLNE1",94,0)
 S AA="SC",AAA=$S(GG=0:"CM",GG=2:"CM",GG=1:"IP",GG=4:"IP",GG=5:"ZS",GG=3:"HD",GG=16:"HD",GG=11:"ZE",1:"DC")
"RTN","PSOHLNE1",95,0)
 D EN^PSOHLSN1(LL,AA,AAA,"")
"RTN","PSOHLNE1",96,0)
 K PSOSSMES
"RTN","PSOHLNE1",97,0)
EXPQ K LL,GG,AA,AAA,PSOMSORR Q
"RTN","PSOHLNE1",98,0)
EXPEN ;SS on Pending orders
"RTN","PSOHLNE1",99,0)
 S AA=$P($G(^PS(52.41,LL,0)),"^",3)
"RTN","PSOHLNE1",100,0)
 S AAA=$S(AA="DC"!(AA="DE"):"DC",AA="HD":"HD",1:"IP")
"RTN","PSOHLNE1",101,0)
 D EN^PSOHLSN(OR("PLACE"),"SC",AAA)
"RTN","PSOHLNE1",102,0)
 G EXPQ
"RTN","PSOHLNE1",103,0)
 ;
"RTN","PSOHLNE1",104,0)
OID ;Check for 1 to 1 match from Dispense Drug to Orderable Item
"RTN","PSOHLNE1",105,0)
 N PSOCDD,PSOCDDI,PSOCDDIZ
"RTN","PSOHLNE1",106,0)
 Q:'$G(PSORDITE)
"RTN","PSOHLNE1",107,0)
 K PSOCDDIZ
"RTN","PSOHLNE1",108,0)
 S (PSOCDD,PSOCDDI)=0
"RTN","PSOHLNE1",109,0)
 F  S PSOCDD=$O(^PSDRUG("ASP",PSORDITE,PSOCDD)) Q:'PSOCDD  I $S('$P($G(^PSDRUG(PSOCDD,"I")),"^"):1,DT'>$P($G(^("I")),"^"):1,1:0),$P($G(^PSDRUG(PSOCDD,2)),"^",3)["O" S PSOCDDI=PSOCDDI+1,PSOCDDIZ=PSOCDD
"RTN","PSOHLNE1",110,0)
 I PSOCDDI'=1 Q
"RTN","PSOHLNE1",111,0)
 S PSOQWX=$G(PSOCDDIZ)
"RTN","PSOHLNE1",112,0)
 Q
"RTN","PSOHLNE1",113,0)
CP ;ZSC segment (replaced by ZCL segment)
"RTN","PSOHLNE1",114,0)
 S SERV=$S($P(PSOSEG,"|")=1:"SC",$P(PSOSEG,"|")=0:"NSC",1:$P(PSOSEG,"|"))
"RTN","PSOHLNE1",115,0)
 S PSOIBY=$P(PSOSEG,"|",2)_"^"_$P(PSOSEG,"|",3)_"^"_$P(PSOSEG,"|",4)_"^"_$P(PSOSEG,"|",5)_"^"_$P(PSOSEG,"|",6)_"^"_$P(PSOSEG,"|",7)_"^"_$P(PSOSEG,"|",8)
"RTN","PSOHLNE1",116,0)
 Q
"RTN","PSOHLNE1",117,0)
 ;
"RTN","PSOHLNE1",118,0)
ZCL ;ZCL segment - SC/EI related to ICDs
"RTN","PSOHLNE1",119,0)
 N SEQ,SEQ2,SEQ3 S SEQ3=$P(PSOSEG,"|",2),SEQ2=$P(PSOSEG,"|",1)
"RTN","PSOHLNE1",120,0)
 S:'$D(PSOICD(SEQ2)) PSOICD(SEQ2)=""
"RTN","PSOHLNE1",121,0)
 S $P(PSOICD(SEQ2),"^",(SEQ3+1))=$P(PSOSEG,"|",3)  ;set sc/ei for ICD node
"RTN","PSOHLNE1",122,0)
 D SCP^PSORN52D K PSOSCA
"RTN","PSOHLNE1",123,0)
 S:'$D(PSOIBY) PSOIBY=""
"RTN","PSOHLNE1",124,0)
 I PSOSCP<50 D  ;set IBQ node variables if <50% SC
"RTN","PSOHLNE1",125,0)
 . Q:$P(PSOIBY,U,$S(SEQ3=1:2,SEQ3=2:3,SEQ3=4:4,SEQ3=5:1,SEQ3=6:5,SEQ3=7:6,SEQ3=8:7,1:""))>0
"RTN","PSOHLNE1",126,0)
 . S:SEQ3=1 $P(PSOIBY,U,2)=$P(PSOSEG,"|",3) ;AO
"RTN","PSOHLNE1",127,0)
 . S:SEQ3=2 $P(PSOIBY,U,3)=$P(PSOSEG,"|",3) ;IR
"RTN","PSOHLNE1",128,0)
 . S:SEQ3=3 SERV=$S($P(PSOSEG,"|",3)=1:"SC",$P(PSOSEG,"|",3)=0:"NSC",1:$P(PSOSEG,"|",3))           ;SC
"RTN","PSOHLNE1",129,0)
 . S:SEQ3=4 $P(PSOIBY,U,4)=$P(PSOSEG,"|",3) ;EC
"RTN","PSOHLNE1",130,0)
 . S:SEQ3=5 $P(PSOIBY,U,1)=$P(PSOSEG,"|",3) ;MST
"RTN","PSOHLNE1",131,0)
 . S:SEQ3=6 $P(PSOIBY,U,5)=$P(PSOSEG,"|",3) ;HNC
"RTN","PSOHLNE1",132,0)
 . S:SEQ3=7 $P(PSOIBY,U,6)=$P(PSOSEG,"|",3) ;CV
"RTN","PSOHLNE1",133,0)
 . S:SEQ3=8 $P(PSOIBY,U,7)=$P(PSOSEG,"|",3) ;SHAD
"RTN","PSOHLNE1",134,0)
 Q
"RTN","PSOHLNE1",135,0)
MISX ;Mismatch patient on CPRS New Order
"RTN","PSOHLNE1",136,0)
 S RCOMM="Patient mismatch on New Order from CPRS." D EN^ORERR(RCOMM,.MSG) S NWFLAG=1 D RERROR^PSOHLSN D KL^PSOHLSIH
"RTN","PSOHLNE1",137,0)
 Q
"RTN","PSOHLNE1",138,0)
MISRN ;Mismatch on CPRS renewal
"RTN","PSOHLNE1",139,0)
 N PSOCINV
"RTN","PSOHLNE1",140,0)
 I $G(PDFN)'=$P($G(^PSRX(+$G(PREV),0)),"^",2) D  S PSOMO=1 Q
"RTN","PSOHLNE1",141,0)
 .S RCOMM="Patient mismatch on CPRS Renewal." D EN^ORERR(RCOMM,.MSG) S PSOXRP=1 D RERROR^PSOHLSN D KL^PSOHLSIH
"RTN","PSOHLNE1",142,0)
 S PSOCINV=+$P($G(^OR(100,+$G(PLACER),3)),"^",5)
"RTN","PSOHLNE1",143,0)
 I PSOCINV'=$P($G(^PSRX(+$G(PREV),"OR1")),"^",2) D  S PSOMO=1 Q
"RTN","PSOHLNE1",144,0)
 .S RCOMM="Order mismatch on CPRS Renewal." D EN^ORERR(RCOMM,.MSG) S PSOCVI=1 D RERROR^PSOHLSN D KL^PSOHLSIH
"RTN","PSOHLNE1",145,0)
 Q
"RTN","PSOHLNE1",146,0)
ZRX ;Process ZRX segment
"RTN","PSOHLNE1",147,0)
 I $P(PSOSEG,"|",3)="R" S PSOOC="RNW",PSRNFLAG=1
"RTN","PSOHLNE1",148,0)
 S PREV=$S(+$P(PSOSEG,"|"):+$P(PSOSEG,"|"),1:"")
"RTN","PSOHLNE1",149,0)
 I $P(PSOSEG,"|")["P"!($P(PSOSEG,"|")["S") S PFLAG=1
"RTN","PSOHLNE1",150,0)
 S NATURE=$P(PSOSEG,"|",2)
"RTN","PSOHLNE1",151,0)
 S PSORSO=$P(PSOSEG,"|",3)
"RTN","PSOHLNE1",152,0)
 S ROUTING=$P(PSOSEG,"|",4)
"RTN","PSOHLNE1",153,0)
 I ROUTING="" S ROUTING="M"
"RTN","PSOHLNE1",154,0)
 I $P(PSOSEG,"|",7) S DSIG=1
"RTN","PSOHLNE1",155,0)
 Q
"RTN","PSOHLNE1",156,0)
CHCS ;Replace CHCS number with CPRS number in .01 field
"RTN","PSOHLNE1",157,0)
 N PSOHTMP
"RTN","PSOHLNE1",158,0)
 I $G(PDFN),PDFN'=+$P($G(^PS(52.41,+$G(PSOCHFFL),0)),"^",2) S COMM="Patient does not match" D EN^ORERR(COMM,.MSG) K PSOPLC,PSOFFL,PSOSND Q
"RTN","PSOHLNE1",159,0)
 I '$D(^PS(52.41,+$G(PSOCHFFL),0)) S COMM="Order was not located by Pharmacy" D EN^ORERR(COMM,.MSG) K PSOPLC,PSOFFL,PSOSND Q
"RTN","PSOHLNE1",160,0)
 S PSOHTMP=$P($G(^PS(52.41,+$G(PSOCHFFL),0)),"^")
"RTN","PSOHLNE1",161,0)
 I PSOHTMP'="" K ^PS(52.41,"B",PSOHTMP,+$G(PSOCHFFL))
"RTN","PSOHLNE1",162,0)
 S $P(^PS(52.41,+$G(PSOCHFFL),0),"^")=PSOPLC,^PS(52.41,"B",PSOPLC,+$G(PSOCHFFL))=""
"RTN","PSOHLNE1",163,0)
 S $P(^PS(52.41,+$G(PSOCHFFL),"EXT"),"^",2)=1
"RTN","PSOHLNE1",164,0)
 Q
"RTN","PSOHLNE1",165,0)
CNT ;
"RTN","PSOHLNE1",166,0)
 S TAC=0 F TACA=0:0 S TACA=$O(^PSRX(PREV,"A",TACA)) Q:'TACA  S TAC=TACA
"RTN","PSOHLNE1",167,0)
 S PAC=0 F PACA=0:0 S PACA=$O(^PSRX(PREV,1,PACA)) Q:'PACA  S PAC=PACA
"RTN","PSOHLNE1",168,0)
 D NOW^%DTC S TAC=TAC+1,^PSRX(PREV,"A",0)="^52.3DA^"_TAC_"^"_TAC,^PSRX(PREV,"A",TAC,0)=%_"^"_"C"_"^"_$S(+$G(PROV):$G(PROV),1:+$G(ENTERED))_"^"_PAC_"^"_"Discontinued due to CPRS edit"
"RTN","PSOHLNE1",169,0)
 K TAC,PAC,TACA,PACA
"RTN","PSOHLNE1",170,0)
 Q
"RTN","PSOHLNE1",171,0)
NTE ;
"RTN","PSOHLNE1",172,0)
 S WPCT=1,WORDP=$S($P(MSG(LL),"|",2):$P(MSG(LL),"|",2),1:$P(MSG(LL),"|",3)) S:$P(MSG(LL),"|",4)'="" WPARRAY(WORDP,WPCT)=$P(MSG(LL),"|",4) S:$P(MSG(LL),"|",4)'="" WPCT=WPCT+1 F LLL=0:0 S LLL=$O(MSG(LL,LLL)) Q:'LLL  D
"RTN","PSOHLNE1",173,0)
 .I $G(MSG(LL,LLL))'="" S WPARRAY(WORDP,WPCT)=$G(MSG(LL,LLL)),WPCT=WPCT+1
"RTN","PSOHLNE1",174,0)
 Q
"RTN","PSOHLNE2")
0^30^B60250922
"RTN","PSOHLNE2",1,0)
PSOHLNE2 ;BIR/RTR-Parsing out more OERR segments ;1/20/95
"RTN","PSOHLNE2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,7,59,46,225**;DEC 1997;Build 29
"RTN","PSOHLNE2",3,0)
 ;External reference to DG(40.8 supported by DBIA 728
"RTN","PSOHLNE2",4,0)
 ;External reference to PS(50.606 supported by DBIA 2174
"RTN","PSOHLNE2",5,0)
 ;External reference to PS(50.7 supported by DBIA 2223
"RTN","PSOHLNE2",6,0)
 ;External reference to PSDRUG( supported by DBIA 221
"RTN","PSOHLNE2",7,0)
 ;External reference to PS(55 supported by DBIA 2228
"RTN","PSOHLNE2",8,0)
 ;External reference to SC( supported by DBIA 2675
"RTN","PSOHLNE2",9,0)
 ;
"RTN","PSOHLNE2",10,0)
EN ;RXO segment on new orders with multiple subscripts
"RTN","PSOHLNE2",11,0)
 S (POVAR,POVAR1)="",(NNN,NNNN)=0,PSOIII=1,MSG(ZZ,0)=$E(MSG(ZZ),5,$L(MSG(ZZ)))
"RTN","PSOHLNE2",12,0)
 S AAA="" F  S AAA=$O(MSG(ZZ,AAA)) Q:AAA=""  S NNN=0 F OOO=1:1:$L(MSG(ZZ,AAA)) S NNN=NNN+1 D  D:$G(POVAR1)="|" PARSE
"RTN","PSOHLNE2",13,0)
 .I $E(MSG(ZZ,AAA),OOO)="|" S NNNN=NNNN+1
"RTN","PSOHLNE2",14,0)
 .S POVAR1=$E(MSG(ZZ,AAA),OOO)
"RTN","PSOHLNE2",15,0)
 .S POLIM=POVAR
"RTN","PSOHLNE2",16,0)
 .S POVAR=$S(POVAR="":POVAR1,1:POVAR_POVAR1)
"RTN","PSOHLNE2",17,0)
 I $G(POVAR)'="" I NNNN=13!(NNNN=12) S PSOREFIL=POVAR
"RTN","PSOHLNE2",18,0)
 K MSG(ZZ,0)
"RTN","PSOHLNE2",19,0)
 Q
"RTN","PSOHLNE2",20,0)
PARSE ;
"RTN","PSOHLNE2",21,0)
 I NNNN=1 S PSORDITE=$P(POLIM,"^",4) G SET
"RTN","PSOHLNE2",22,0)
 I NNNN=10 S PSODDRUG=$P(POLIM,"^",4) I $G(PSODDRUG),('$D(^PSDRUG(PSODDRUG,0))) S PSODDRUG="" G SET
"RTN","PSOHLNE2",23,0)
 I NNNN=10 G SET
"RTN","PSOHLNE2",24,0)
 I NNNN=11 S PSOXQTY=POLIM G SET
"RTN","PSOHLNE2",25,0)
 I NNNN=13 S PSOREFIL=POLIM G SET
"RTN","PSOHLNE2",26,0)
 I NNNN=17 S PSODYSPL=POLIM
"RTN","PSOHLNE2",27,0)
SET S (POVAR,POLIM)="" Q
"RTN","PSOHLNE2",28,0)
 ;
"RTN","PSOHLNE2",29,0)
OBXX ;Parse out OBX segments
"RTN","PSOHLNE2",30,0)
 S OCOUNT=OCOUNT+1
"RTN","PSOHLNE2",31,0)
 S (POVAR,POVAR)="",(NNCK,NNN,NNNN)=0,PSOIII=1,MSG(ZZ,0)=$E(MSG(ZZ),5,$L(MSG(ZZ)))
"RTN","PSOHLNE2",32,0)
 S AAA="" F  S AAA=$O(MSG(ZZ,AAA)) Q:AAA=""  S NNN=0 F OOO=1:1:$L(MSG(ZZ,AAA)) S NNN=NNN+1 D  D:$G(POVAR1)="&"&(NNNN=4) OPARSE D:$G(POVAR1)="|" OPARSE
"RTN","PSOHLNE2",33,0)
 .I $E(MSG(ZZ,AAA),OOO)="|" S NNNN=NNNN+1
"RTN","PSOHLNE2",34,0)
 .S POVAR1=$E(MSG(ZZ,AAA),OOO)
"RTN","PSOHLNE2",35,0)
 .S POLIM=POVAR
"RTN","PSOHLNE2",36,0)
 .S POVAR=$S(POVAR="":POVAR1,1:POVAR_POVAR1)
"RTN","PSOHLNE2",37,0)
 I $G(POVAR)'="" I NNNN=4!(NNNN=5) S NNCK=NNCK+1 S OBXAR(OCOUNT,NNCK)=POVAR
"RTN","PSOHLNE2",38,0)
 K MSG(ZZ,0)
"RTN","PSOHLNE2",39,0)
 F OOO=2:1 Q:'$D(OBXAR(OCOUNT,OOO))  S OBXAR(OCOUNT,1)=OBXAR(OCOUNT,1)_"&"_OBXAR(OCOUNT,OOO) K OBXAR(OCOUNT,OOO)
"RTN","PSOHLNE2",40,0)
 Q
"RTN","PSOHLNE2",41,0)
OPARSE ;
"RTN","PSOHLNE2",42,0)
 I NNNN=4,$G(POVAR1)="&" S NNCK=NNCK+1,OBXAR(OCOUNT,NNCK)=$G(POLIM) G OSET
"RTN","PSOHLNE2",43,0)
 I NNNN=5 S NNCK=NNCK+1 S OBXAR(OCOUNT,NNCK)=$G(POLIM)
"RTN","PSOHLNE2",44,0)
OSET S (POVAR,POLIM)="" Q
"RTN","PSOHLNE2",45,0)
 ;
"RTN","PSOHLNE2",46,0)
PURGE ;Purge order initiated by CPRS
"RTN","PSOHLNE2",47,0)
 N DA,PREER,PRG,PPG,PND,PRGFLAG,PURGCOMM,PEER,PURGPV1,PURGPID,PURGORC,PURGRX,PURGPLC,PRGSTAT,PSCC,PSARC,PSCA,PSACOUNT,PURGEXRX,PLAST,PURGLTH,PURGNODE
"RTN","PSOHLNE2",48,0)
 S PSOMSORR=1
"RTN","PSOHLNE2",49,0)
 S PRGFLAG=0
"RTN","PSOHLNE2",50,0)
 ;S PURGRX=$O(^PSRX("APL",OR("PLACE"),0)) I PURGRX G PRX
"RTN","PSOHLNE2",51,0)
 I $G(PSOFILNM),$G(PSOFILNM)'["S" S PURGRX=PSOFILNM G PRX
"RTN","PSOHLNE2",52,0)
 S PND=+$G(PSOFILNM) I PND D  G PDNO
"RTN","PSOHLNE2",53,0)
 .I '$D(^PS(52.41,PND,0)) Q
"RTN","PSOHLNE2",54,0)
 .I $G(PDFN),$G(PDFN)'=$P($G(^PS(52.41,PND,0)),"^",2) S PURGCOMM="Patient does not match" D PDERR Q
"RTN","PSOHLNE2",55,0)
 .S PRGSTAT=$P($G(^PS(52.41,PND,0)),"^",3) I PRGSTAT="NW"!(PRGSTAT="RNW")!(PRGSTAT="HD") S PRGFLAG=1 Q
"RTN","PSOHLNE2",56,0)
 .K DIK S DA=PND,DIK="^PS(52.41," D ^DIK K DIK Q
"RTN","PSOHLNE2",57,0)
 S PURGCOMM="Order was not located by Pharmacy."
"RTN","PSOHLNE2",58,0)
 D PDERR G PDNO
"RTN","PSOHLNE2",59,0)
PDERR D EN^ORERR(PURGCOMM,.MSG)
"RTN","PSOHLNE2",60,0)
 Q
"RTN","PSOHLNE2",61,0)
PDNO F PEER=0:0 S PEER=$O(MSG(PEER)) Q:'PEER  S:$P(MSG(PEER),"|")="PV1" PURGPV1=MSG(PEER) S:$P(MSG(PEER),"|")="PID" PURGPID=MSG(PEER) S:$P(MSG(PEER),"|")="ORC"&($G(PURGORC)="") PURGORC=MSG(PEER)
"RTN","PSOHLNE2",62,0)
 N MSG,PSOHINST D INIT^PSOHLSN S MSG(2)=$G(PURGPID),MSG(3)=$G(PURGPV1),MSG(4)="ORC|"_$S($G(PRGFLAG):"ZU",1:"ZR")_"|"_$G(OR("PLACE"))_$S($G(PLACERXX):";"_PLACERXX,1:"")_"^OR"_"|"_$S($P($G(PURGORC),"|",4)'="":$P(PURGORC,"|",4),1:"")
"RTN","PSOHLNE2",63,0)
 F PREER=11,13 I $P($G(PURGORC),"|",PREER)'="" S $P(MSG(4),"|",PREER)=$P($G(PURGORC),"|",PREER)
"RTN","PSOHLNE2",64,0)
 S $P(MSG(4),"|",17)="^^^^"_$S($G(PRGFLAG):"Unable to Purge order.",1:"OK to Purge order.")_"^"
"RTN","PSOHLNE2",65,0)
 D SEND^PSOHLSN
"RTN","PSOHLNE2",66,0)
PURGEX K PSOMSORR Q
"RTN","PSOHLNE2",67,0)
PRX ;Purge from PSRX here
"RTN","PSOHLNE2",68,0)
 I '$D(^PSRX(PURGRX,0)) G PDNO
"RTN","PSOHLNE2",69,0)
 I $G(PDFN),$G(PDFN)'=$P($G(^PSRX(PURGRX,0)),"^",2) S PURGCOMM="Patient does not match" D PDERR G PDNO
"RTN","PSOHLNE2",70,0)
 I '$P($G(^PSRX(PURGRX,"ARC")),"^") S PRGFLAG=1 G PDNO
"RTN","PSOHLNE2",71,0)
 ;purge from PSRX
"RTN","PSOHLNE2",72,0)
 S PURGEXRX=$P(^PSRX(PURGRX,0),"^")
"RTN","PSOHLNE2",73,0)
 S PSOSUSPA=1 K DIK S DA=PURGRX,PSCC=$P($G(^PSRX(PURGRX,0)),"^",2),DIK="^PSRX(" D ^DIK K DIK,PSOSUSPA
"RTN","PSOHLNE2",74,0)
 I $D(^PS(55,+$G(PSCC),0)) S DA(1)=PSCC,DIK="^PS(55,"_DA(1)_",""P""," F PSCA=0:0 S PSCA=$O(^PS(55,+$G(PSCC),"P",PSCA)) Q:'PSCA  I ^PS(55,+$G(PSCC),"P",PSCA,0)=PURGRX S DA=PSCA D ^DIK K DA,DIK
"RTN","PSOHLNE2",75,0)
 I $D(^PS(52.4,PURGRX,0)) S DA=PURGRX,DIK="^PS(52.4," D ^DIK K DA,DIK
"RTN","PSOHLNE2",76,0)
 S DA=$O(^PS(52.5,"B",PURGRX,"")) I DA S DIK="^PS(52.5," D ^DIK K DIK,DA
"RTN","PSOHLNE2",77,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSOHLNE2",78,0)
 I '$G(PSCC) G PUQUIT
"RTN","PSOHLNE2",79,0)
 I '$D(^PS(55,PSCC,"ARC",DT)) S DA=PSCC,DIE=55,DR="101///"_DT,DR(2,55.13)="1///"_$G(PURGEXRX) D ^DIE K DIE G PUQUIT
"RTN","PSOHLNE2",80,0)
 S PLAST=0 F PSARC=0:0 S PSARC=$O(^PS(55,PSCC,"ARC",DT,1,PSARC)) Q:'PSARC  S PLAST=PSARC
"RTN","PSOHLNE2",81,0)
 I $G(PLAST),$D(^PS(55,PSCC,"ARC",DT,1,PLAST,0)) S PURGNODE=^PS(55,PSCC,"ARC",DT,1,PLAST,0) S PURGLTH=$L(PURGNODE) I $G(PURGLTH),PURGLTH<220 S ^PS(55,PSCC,"ARC",DT,1,PLAST,0)=PURGNODE_$S($E(PURGNODE,PURGLTH)'="*":"*",1:"")_PURGEXRX G PUQUIT
"RTN","PSOHLNE2",82,0)
 S DA=PSCC,DIE=55,DR="101///"_DT,DR(2,55.13)="1///"_$G(PURGEXRX) D ^DIE K DIE
"RTN","PSOHLNE2",83,0)
PUQUIT G PDNO
"RTN","PSOHLNE2",84,0)
 ;
"RTN","PSOHLNE2",85,0)
REF ;Refill request from CPRS
"RTN","PSOHLNE2",86,0)
 N PSORXFL,PSORFX,REFXXX,REFCOM,REFCOMXX,REFEER,REFPV1,REFPID,REFORC,RREER,RFLOOP,REFSEG,RFTYPE,REFILLER,REFVR
"RTN","PSOHLNE2",87,0)
 ;S PSOMSORR=1
"RTN","PSOHLNE2",88,0)
 ;S PSORXFL=$O(^PSRX("APL",OR("PLACE"),0)) I PSORXFL G REFRX
"RTN","PSOHLNE2",89,0)
 I $G(PSOFILNM),$G(PSOFILNM)'["S" S PSORXFL=PSOFILNM G REFRX
"RTN","PSOHLNE2",90,0)
 I $G(PSOFILNM) S PSORFX=+$G(PSOFILNM) D  S REFXXX=1 G REFSND
"RTN","PSOHLNE2",91,0)
 .I '$D(^PS(52.41,PSORFX,0)) S (REFCOMXX,REFCOM)="Order was not located by Pharmacy." D REFERR Q
"RTN","PSOHLNE2",92,0)
 .I $G(PDFN),$G(PDFN)'=$P($G(^PS(52.41,PSORFX,0)),"^",2) S (REFCOMXX,REFCOM)="Patient does not match." D REFERR Q
"RTN","PSOHLNE2",93,0)
 .I $P($G(^PS(52.41,PSORFX,0)),"^",3)="RF" S REFCOM="Refill has already been requested." Q
"RTN","PSOHLNE2",94,0)
 .S REFCOM="Refill request not allowed on Pending order."
"RTN","PSOHLNE2",95,0)
 S (REFCOMXX,REFCOM)="Order was not located by Pharmacy." D REFERR S REFXXX=1 G REFSND
"RTN","PSOHLNE2",96,0)
REFERR D EN^ORERR(REFCOMXX,.MSG)
"RTN","PSOHLNE2",97,0)
 Q
"RTN","PSOHLNE2",98,0)
REFSND ;REBUILD AND SEND MESSAGE  REFXXX IS VARIABL, REFCOM IS COMMENT
"RTN","PSOHLNE2",99,0)
 ;F REFEER=0:0 S REFEER=$O(MSG(REFEER)) Q:'REFEER  S:$P(MSG(REFEER),"|")="PV1" REFPV1=MSG(REFEER) S:$P(MSG(REFEER),"|")="PID" REFPID=MSG(REFEER) S:$P(MSG(REFEER),"|")="ORC"&($G(REFORC)="") REFORC=MSG(REFEER)
"RTN","PSOHLNE2",100,0)
 ;N MSG,PSOHINST D INIT^PSOHLSN S MSG(2)=$G(REFPID),MSG(3)=$G(REFPV1),MSG(4)="ORC|"_$S($G(REFXXX):"UF",1:"FL")_"|"_$G(OR("PLACE"))_$S($G(PLACERXX):";"_PLACERXX,1:"")_"^OR"_"|"_$S($P($G(REFORC),"|",4)'="":$P(REFORC,"|",4),1:"")
"RTN","PSOHLNE2",101,0)
 ;use commented out code if response message is ever required
"RTN","PSOHLNE2",102,0)
 ;F RREER=11,13 I $P($G(REFORC),"|",RREER)'="" S $P(MSG(4),"|",RREER)=$P($G(REFORC),"|",RREER)
"RTN","PSOHLNE2",103,0)
 ;S $P(MSG(4),"|",17)="^^^^"_$S($G(REFXXX):$G(REFCOM),1:"Refill request sent to Pharmacy.")_"^"
"RTN","PSOHLNE2",104,0)
 ;D SEND^PSOHLSN
"RTN","PSOHLNE2",105,0)
REFSNDX ;K PSOMSORR
"RTN","PSOHLNE2",106,0)
 Q
"RTN","PSOHLNE2",107,0)
REFRX ;
"RTN","PSOHLNE2",108,0)
 I $O(^PS(52.41,"ARF",PSORXFL,0)) S REFXXX=1,REFCOM="Refill request already exists." G REFSND
"RTN","PSOHLNE2",109,0)
 I '$D(^PSRX(PSORXFL,0)) S (REFCOMXX,REFCOM)="Order was not located by Pharmacy." D REFERR S REFXXX=1 G REFSND
"RTN","PSOHLNE2",110,0)
 I $G(PDFN),$G(PDFN)'=$P($G(^PSRX(PSORXFL,0)),"^",2) S (REFCOMXX,REFCOM)="Patient does not match." D REFERR S REFXXX=1 G REFSND
"RTN","PSOHLNE2",111,0)
 ;S REFVR=$$REFILL^PSOREF(OR("PLACE")) I $P($G(REFVR),"^")'=1 S REFXXX=1,REFCOM=$P($G(REFVR),"^",2) G REFSND
"RTN","PSOHLNE2",112,0)
 F RFLOOP=0:0 S RFLOOP=$O(MSG(RFLOOP)) Q:'RFLOOP  S REFSEG=$G(MSG(RFLOOP)),RFTYPE=$P(REFSEG,"|")_"Z" S REFSEG=$E(REFSEG,5,$L(REFSEG)) I RFTYPE="PIDZ"!(RFTYPE="PV1Z")!(RFTYPE="ORCZ")!(RFTYPE="ZRXZ") D @RFTYPE
"RTN","PSOHLNE2",113,0)
 I '$G(PLACER) S REFXXX=1,REFCOM="Unable to process refill request." G REFSND
"RTN","PSOHLNE2",114,0)
 I $G(REFILLER),$G(REFILLER)'=$G(PSORXFL) S REFCOMXX="Filler number mismatch" D REFERR S REFXXX=1,REFCOM="Unable to process refill request." G REFSND
"RTN","PSOHLNE2",115,0)
 K DD,DO S DIC="^PS(52.41,",DIC(0)="L",X=PLACER,DIC("DR")="1////"_$G(DFN)_";2////"_"RF"_";4////"_$G(ENTERED)_";5////"_$G(PROV) D FILE^DICN K DIC,DR I Y<0 S REFXXX=1,REFCOM="Unable to process refill request." G REFSND
"RTN","PSOHLNE2",116,0)
 S PENDING=+Y S $P(^PS(52.41,PENDING,0),"^",13)=$G(LOCATION),$P(^(0),"^",17)=$S($G(ROUTING)'="":$G(ROUTING),1:"W"),$P(^(0),"^",19)=$G(PSORXFL),$P(^(0),"^",20)="F",$P(^(0),"^",14)="R"
"RTN","PSOHLNE2",117,0)
 S $P(^PS(52.41,PENDING,0),"^",8)=$P($G(^PSRX(PSORXFL,"OR1")),"^"),$P(^PS(52.41,PENDING,0),"^",9)=$P($G(^PSRX(PSORXFL,0)),"^",6)
"RTN","PSOHLNE2",118,0)
 S $P(^PS(52.41,PENDING,"INI"),"^")=$G(PSINPTR) D NOW^%DTC S $P(^PS(52.41,PENDING,0),"^",12)=% K %
"RTN","PSOHLNE2",119,0)
 K DIK S DA=PENDING,DIK="^PS(52.41," D IX1^DIK K DIK
"RTN","PSOHLNE2",120,0)
 G REFSND
"RTN","PSOHLNE2",121,0)
PIDZ ;
"RTN","PSOHLNE2",122,0)
 S DFN=+$P(REFSEG,"|",3)
"RTN","PSOHLNE2",123,0)
 Q
"RTN","PSOHLNE2",124,0)
PV1Z ;
"RTN","PSOHLNE2",125,0)
 S LOCATION=+$P(+$P(REFSEG,"|",3),"^")
"RTN","PSOHLNE2",126,0)
 S:'$D(^SC(LOCATION,0)) LOCATION=""
"RTN","PSOHLNE2",127,0)
 S INPTRX=0 I $G(LOCATION) S PSINPTR=$P($G(^SC(LOCATION,0)),"^",4) I PSINPTR Q
"RTN","PSOHLNE2",128,0)
 I $G(LOCATION) S INPTRX=$P($G(^SC(LOCATION,0)),"^",15)
"RTN","PSOHLNE2",129,0)
 I '$G(INPTRX) S INPTRX=$O(^DG(40.8,0))
"RTN","PSOHLNE2",130,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSOHLNE2",131,0)
 S PSINPTR=+$$SITE^VASITE(DT,INPTRX)
"RTN","PSOHLNE2",132,0)
 Q
"RTN","PSOHLNE2",133,0)
ORCZ ;
"RTN","PSOHLNE2",134,0)
 S PLACER=+$P(REFSEG,"|",2),REFILLER=+$P(REFSEG,"|",3),ENTERED=+$P(REFSEG,"|",10),PROV=+$P(REFSEG,"|",12)
"RTN","PSOHLNE2",135,0)
 Q
"RTN","PSOHLNE2",136,0)
ZRXZ ;
"RTN","PSOHLNE2",137,0)
 S ROUTING=$P(REFSEG,"|",4)
"RTN","PSOHLNE2",138,0)
 Q
"RTN","PSOHLNE2",139,0)
STUFF ;
"RTN","PSOHLNE2",140,0)
 S PSOVRBD=$P($G(^PS(50.7,+$G(PSORDITE),0)),"^",2)
"RTN","PSOHLNE2",141,0)
 I '$G(PSOVRBD) K PSOVRBD Q
"RTN","PSOHLNE2",142,0)
 ;K PSONUNN F PSONUN=0:0 S PSONUN=$O(^PS(50.606,PSOVRBD,"NOUN",PSONUN)) Q:'PSONUN!($D(PSONUNN))  S:$P($G(^(PSONUN,0)),"^")'="" PSONUNN=$P($G(^(0)),"^")
"RTN","PSOHLNE2",143,0)
 S PSOVRB=$P($G(^PS(50.606,PSOVRBD,"MISC")),"^")
"RTN","PSOHLNE2",144,0)
 F EE=0:0 S EE=$O(^PS(52.41,PENDING,1,EE)) Q:'EE  S $P(^PS(52.41,PENDING,1,EE,1),"^",10)=$$UNESC^ORHLESC($G(PSOVRB))
"RTN","PSOHLNE2",145,0)
 K PSOVRBD,PSONUNN,PSONUN,PSOVRB
"RTN","PSOHLNE2",146,0)
 Q
"RTN","PSOHLNE3")
0^21^B61361284
"RTN","PSOHLNE3",1,0)
PSOHLNE3 ;BIR/LE - Process Edit Information from CPRS ;02/27/04
"RTN","PSOHLNE3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**143,239,201,225**;DEC 1997;Build 29
"RTN","PSOHLNE3",3,0)
 ;External reference to ^OR(100 private DBIA 2219
"RTN","PSOHLNE3",4,0)
 ;External reference VADPT supported by DBIA 10061
"RTN","PSOHLNE3",5,0)
 ;
"RTN","PSOHLNE3",6,0)
 ;This API is used to update the prescription file when ICD-9 diagnosis and SC/EI's are updated as a result of an e-sig in CPRS.  
"RTN","PSOHLNE3",7,0)
 ;
"RTN","PSOHLNE3",8,0)
EN(DFN,ORITEM,ORIEN,ORDX,ORSCEI) ;ENTRY POINT
"RTN","PSOHLNE3",9,0)
 ;     Used to import edit information from CPRS 
"RTN","PSOHLNE3",10,0)
 ;Where Input:
"RTN","PSOHLNE3",11,0)
 ;DFN = Patient IEN
"RTN","PSOHLNE3",12,0)
 ;ORITEM = Package reference number from file 100
"RTN","PSOHLNE3",13,0)
 ;ORIEN = ien from file 100
"RTN","PSOHLNE3",14,0)
 ;ORDX(1)= (pointer to file 80) up to 8 accepted and first is primary ICD
"RTN","PSOHLNE3",15,0)
 ;ORDX(2)= (pointer to file 80)
"RTN","PSOHLNE3",16,0)
 ;ORSCEI=  seven pieces - where 1=yes, 0=no, null or ? =not asked
"RTN","PSOHLNE3",17,0)
 ;  ORSCEI=AO^IR^SC^EC^MST^HNC^CV^SHAD
"RTN","PSOHLNE3",18,0)
 N %,DX,DX2,DX3,RXN,PSOSCP,PSOX,ORDPROV,PSOSCP2,DA,RET,PSOANSQ,PSORX,PTSTATUS,ARRAY,PSOOI,ORITEM2,ORID,OICHK,PSORENW
"RTN","PSOHLNE3",19,0)
 N PSODCPY,PSONEW,PSOOIBQ,PSOFLD,PSODCZ,PSOSTAZ,PREA,PSOPIBQ,PSOIBQC,PSOSCA,PSOPICD,PSODGUP,PSOOICD,PSOPFS,TYPE,PSONW,PSOOLD,PSODA
"RTN","PSOHLNE3",20,0)
 N PSODD,PSOSI,X,PSOSITE,PSOBILL,PSOCPAY,PSOCICD
"RTN","PSOHLNE3",21,0)
 S:'$D(ORIEN) ORIEN="" S:'$D(ORSCEI) ORSCEI="" S:'$D(ORITEM) ORITEM=""
"RTN","PSOHLNE3",22,0)
 ;
"RTN","PSOHLNE3",23,0)
 ;validate prescription IEN with DFN, ord item, and placer#
"RTN","PSOHLNE3",24,0)
 S RET=1,PSODCZ=",12,14,15,"
"RTN","PSOHLNE3",25,0)
 S RXN=ORITEM I '$D(^PSRX(RXN)) S RET="0^1" Q RET  ;invalid RX ien
"RTN","PSOHLNE3",26,0)
 I $D(^PSRX(RXN,"STA")) S PSOSTAZ=^PSRX(RXN,"STA")
"RTN","PSOHLNE3",27,0)
 ; get prescription file patient ien, drug, and placer order #
"RTN","PSOHLNE3",28,0)
 D GETS^DIQ(52,RXN_",","2;6;39.3","I","ARRAY")
"RTN","PSOHLNE3",29,0)
 I '$D(ARRAY(52,RXN_",",2,"I")) S RET="0^3" Q RET  ;quit if you don't have a patient ien
"RTN","PSOHLNE3",30,0)
 I ARRAY(52,RXN_",",2,"I")'=DFN S RET="0^3" Q RET  ;quit if patient dfn is different
"RTN","PSOHLNE3",31,0)
 I '$D(ARRAY(52,RXN_",",39.3,"I")) S ARRAY(52,RXN_",",39.3,"I")=""  ;if don't have it; treat is as null
"RTN","PSOHLNE3",32,0)
 I ARRAY(52,RXN_",",39.3,"I")'="" I ARRAY(52,RXN_",",39.3,"I")'=ORIEN S RET="0^5" Q RET  ;placer # is different
"RTN","PSOHLNE3",33,0)
 I ARRAY(52,RXN_",",39.3,"I")="" S OICHK=0 D CHKOI I OICHK S RET="0^4" Q RET  ;quit if placer # is null and orderable item is different or null.
"RTN","PSOHLNE3",34,0)
 ;end of validation process
"RTN","PSOHLNE3",35,0)
 ;
"RTN","PSOHLNE3",36,0)
 S PSODD=$$GET1^DIQ(52,RXN_",",6,"I") S:($P($G(^PSDRUG(PSODD,0)),"^",3)["S")!($P($G(^(0)),"^",3)["I") PSOSI=1
"RTN","PSOHLNE3",37,0)
 S PSOPIBQ=$G(^PSRX(RXN,"IBQ")),PSOPICD=$P($G(^PSRX(RXN,"ICD",1,0)),"^",2,8)
"RTN","PSOHLNE3",38,0)
 S PSOX("IRXN")=RXN,PSORENW("IRXN")=RXN
"RTN","PSOHLNE3",39,0)
 S (PSONEW("PATIENT STATUS"),PTSTATUS)=$$GET1^DIQ(52,RXN_",","3","I")
"RTN","PSOHLNE3",40,0)
 I '$D(PTSTATUS) S (PSONEW("PATIENT STATUS"),PTSTATUS)=""
"RTN","PSOHLNE3",41,0)
 ;if patient status is null, treat same as PSONEW2, PSORN52, PSONEWG, AND PSONEWF.  If piece 7 of ^PS(53 doesn't equal 1, it's not exempt from copay.
"RTN","PSOHLNE3",42,0)
 I ORSCEI["?" S ORSCEI=$TR(ORSCEI,"?","")
"RTN","PSOHLNE3",43,0)
 D SCP^PSORN52D
"RTN","PSOHLNE3",44,0)
 S PSOANSQ(PSOX("IRXN"),"VEH")=$P(ORSCEI,U,1)
"RTN","PSOHLNE3",45,0)
 S PSOANSQ(PSOX("IRXN"),"RAD")=$P(ORSCEI,U,2)
"RTN","PSOHLNE3",46,0)
 I PSOSCP<50&($P($G(^PS(53,+$G(PTSTATUS),0)),"^",7)'=1) S PSOANSQ(PSOX("IRXN"),"SC")=$P(ORSCEI,U,3),PSOANSQ("SC")=$P(ORSCEI,U,3)
"RTN","PSOHLNE3",47,0)
 I PSOSCP>49!($P($G(^PS(53,+$G(PTSTATUS),0)),"^",7)=1) S PSOANSQ(PSOX("IRXN"),"SC>50")=$P(ORSCEI,U,3),PSOANSQ("SC>50")=$P(ORSCEI,U,3)
"RTN","PSOHLNE3",48,0)
 I PSOSCP=""&('$D(PSOANSQ("SC")))&($D(^PSRX(RXN,"ICD",1))) S PSOANSQ("SC")=$P(^PSRX(RXN,"ICD",1,0),"^",4),PSOANSQ(PSOX("IRXN"),"SC")=PSOANSQ("SC")  ;for SC with no percentage defined/ legacy
"RTN","PSOHLNE3",49,0)
 S PSOANSQ(PSOX("IRXN"),"PGW")=$P(ORSCEI,U,4)
"RTN","PSOHLNE3",50,0)
 S PSOANSQ(PSOX("IRXN"),"MST")=$P(ORSCEI,U,5)
"RTN","PSOHLNE3",51,0)
 S PSOANSQ(PSOX("IRXN"),"HNC")=$P(ORSCEI,U,6)
"RTN","PSOHLNE3",52,0)
 S PSOANSQ(PSOX("IRXN"),"CV")=$P(ORSCEI,U,7)
"RTN","PSOHLNE3",53,0)
 S PSOANSQ(PSOX("IRXN"),"SHAD")=$P(ORSCEI,U,8)
"RTN","PSOHLNE3",54,0)
 D:'$$PATCH^XPDUTL("OR*3.0*243") SHAD^PSORN52D
"RTN","PSOHLNE3",55,0)
 S DX="",DX2=0 F  S DX=$O(ORDX(DX)) Q:DX=""  S DX2=DX2+1,PSORX("ICD",DX2)=ORDX(DX)  ;Multi signed Rx's come in consecutively and the diagnosis subscript doesn't start with 1 for each Rx
"RTN","PSOHLNE3",56,0)
 S PSOSCP2=1  ;used in PSORN52D
"RTN","PSOHLNE3",57,0)
 ;
"RTN","PSOHLNE3",58,0)
ICD2 ;Check to see if SC/EI changed during CPRS sign order
"RTN","PSOHLNE3",59,0)
 D GETS^DIQ(52,PSOX("IRXN")_",","52311*","I","PSOOICD")
"RTN","PSOHLNE3",60,0)
 S PSODCPY=0,PSOFLD=""
"RTN","PSOHLNE3",61,0)
 F TYPE="VEH","RAD","SC>50","PGW","MST","HNC","CV","SHAD" Q:PSODCPY  F PSOFLD=1:1:8 D  Q:PSODCPY
"RTN","PSOHLNE3",62,0)
 . I TYPE="VEH"&(PSOFLD=1) D CHOC
"RTN","PSOHLNE3",63,0)
 . I TYPE="RAD"&(PSOFLD=2) D CHOC
"RTN","PSOHLNE3",64,0)
 . I TYPE="SC>50"&(PSOFLD=3)&($D(PSOANSQ(PSOX("IRXN"),TYPE))) D CHOC
"RTN","PSOHLNE3",65,0)
 . I TYPE="PGW"&(PSOFLD=4) D CHOC
"RTN","PSOHLNE3",66,0)
 . I TYPE="MST"&(PSOFLD=5) D CHOC
"RTN","PSOHLNE3",67,0)
 . I TYPE="HNC"&(PSOFLD=6) D CHOC
"RTN","PSOHLNE3",68,0)
 . I TYPE="CV"&(PSOFLD=7) D CHOC
"RTN","PSOHLNE3",69,0)
 . I TYPE="SHAD"&(PSOFLD=8) D:$$PATCH^XPDUTL("OR*3.0*243") CHOC
"RTN","PSOHLNE3",70,0)
 I $D(PSOANSQ("SC")) S PSOFLD=3 S:PSOANSQ("SC")'=PSOOICD(52.052311,1_","_PSOX("IRXN")_",",PSOFLD,"I") PSODCPY=1,PSOFLD=""
"RTN","PSOHLNE3",71,0)
 ; IF NO SC/EI DIFFERENCES, CHECK FOR ICD CHANGES.  If there were SC/EI difference, don't need to check ICD because they are sent anyway when copay update is done.
"RTN","PSOHLNE3",72,0)
 I '$G(PSODCPY) D
"RTN","PSOHLNE3",73,0)
 .I '$D(PSORX("ICD"))&($G(PSOOICD(52.052311,1_","_RXN_",",.01,"I"))) S PSODGUP=1 Q  ;if no ICD's passed and ICD's defined in 52, CPRS overrides OP
"RTN","PSOHLNE3",74,0)
 .S (DX3,DX2,DX)="" F  S DX=$O(PSOOICD(52.052311,DX)) Q:DX=""  S DX2=+DX  ;get last entry for file 52
"RTN","PSOHLNE3",75,0)
 .S DX="" F  S DX=$O(PSORX("ICD",DX)) Q:DX=""  S DX3=DX D  ;get last entry for new ICD's from CPRS
"RTN","PSOHLNE3",76,0)
 .. I $G(PSOOICD(52.052311,DX_","_PSOX("IRXN")_",",.01,"I"))'=PSORX("ICD",DX) S PSODGUP=1  ;if ICD'S changed or more new ICD's than old ones.
"RTN","PSOHLNE3",77,0)
 .I DX2>DX3 S PSODGUP=1  ;if more old ICD's than new ones
"RTN","PSOHLNE3",78,0)
 Q:'$G(PSODCPY)&('$G(PSODGUP)) 1
"RTN","PSOHLNE3",79,0)
 D FILE2^PSORN52D  ;file SC/EI/ICD'S into Rx file
"RTN","PSOHLNE3",80,0)
 ;S PSOCIDC=$P($G(^PSRX(RXN,"ICD",1,0)),"^",2,8)
"RTN","PSOHLNE3",81,0)
 ;only do copay if SC/EI changed and SC is less than 50%.
"RTN","PSOHLNE3",82,0)
 I PSODCZ[(","_$G(PSOSTAZ)_",") S RET="0^6" Q RET  ;discontinue's no copay changes allowed.
"RTN","PSOHLNE3",83,0)
 ;
"RTN","PSOHLNE3",84,0)
 ;Get last fill number
"RTN","PSOHLNE3",85,0)
 N PSOLFIL S PSOLFIL=$$LF^PSOPFSU1(RXN)
"RTN","PSOHLNE3",86,0)
 S PSOPFS=$P($S('PSOLFIL:$G(^PSRX(RXN,"PFS")),1:$G(^PSRX(RXN,1,PSOLFIL,"PFS"))),"^",1,2)
"RTN","PSOHLNE3",87,0)
 ; No-copay to copay updates
"RTN","PSOHLNE3",88,0)
 S PSOIBQC=$G(^PSRX(RXN,"IBQ")),PSOCICD=$P($G(^PSRX(RXN,"ICD",1,0)),"^",2,8)
"RTN","PSOHLNE3",89,0)
 D CPAY
"RTN","PSOHLNE3",90,0)
 ; must check IBQ node in case it's a pre-CIDC rx/copay, ICD node for exempt/supply items, and for diagnosis updates for NSC Rx's
"RTN","PSOHLNE3",91,0)
 I (PSOPIBQ[1&(PSOIBQC'[1))!(PSOIBQC=""&(PSOPICD[1&(PSOCICD'[1)))!($G(PSODGUP)) D  Q RET  ;don't do no copay to copay bills, but update status
"RTN","PSOHLNE3",92,0)
 . D ALOG
"RTN","PSOHLNE3",93,0)
 . I (PSOSCP<50)&($G(PSODCPY)) D
"RTN","PSOHLNE3",94,0)
 .. I $P($G(^PS(53,+$G(PTSTATUS),0)),"^",7)'=1&('$G(PSOSI)) D
"RTN","PSOHLNE3",95,0)
 ... S:+$G(PSOCPAY)<1&($D(^PSRX(RXN,"IB"))) $P(^PSRX(RXN,"IB"),"^",1)=""
"RTN","PSOHLNE3",96,0)
 ... I +$G(PSOCPAY)>0 S $P(^PSRX(RXN,"IB"),"^",1)=+$G(PSOCPAY),PSOOLD="No Copay",PSONW="Copay",PREA="R",PSODA=RXN D:'$G(PSOSI) ACTLOG^PSOCPA
"RTN","PSOHLNE3",97,0)
 . I +$G(PSOPFS)>0&('$P($G(PSOPFS),"^",2)) K PSOPFS Q   ;don't send unreleased charge msg
"RTN","PSOHLNE3",98,0)
 . I +$G(PSOPFS)<1 K PSOPFS  ;invalid PFSS ACCT REF/ SEND TO IB
"RTN","PSOHLNE3",99,0)
 . I +$G(PSOPFS)>0 S PSOPFS="1^"_PSOPFS
"RTN","PSOHLNE3",100,0)
 . ;
"RTN","PSOHLNE3",101,0)
 . I +$G(PSOPFS) D CHRG^PSOPFSU1(RXN,PSOLFIL,"CG",PSOPFS) ;always send to external bill sys
"RTN","PSOHLNE3",102,0)
 ;
"RTN","PSOHLNE3",103,0)
 ; Copay to no-copay updates
"RTN","PSOHLNE3",104,0)
 I $G(PSODCPY) D COPAY^PSOHLNE4
"RTN","PSOHLNE3",105,0)
 ;ICD UPDATE ONLY FOR COPAYS
"RTN","PSOHLNE3",106,0)
 I ('$G(PSODCPY)&($G(PSODGUP)))&($P($G(PSOPFS),"^",2)) D CHRG^PSOPFSU1(RXN,PSOLFIL,"CG",PSOPFS) ;DIAGNOSIS UPDATE ONLY
"RTN","PSOHLNE3",107,0)
 I ($G(PSODCPY)!($G(PSODGUP))) D ALOG
"RTN","PSOHLNE3",108,0)
 Q RET
"RTN","PSOHLNE3",109,0)
 ;
"RTN","PSOHLNE3",110,0)
CPAY ;
"RTN","PSOHLNE3",111,0)
 N X,Y,III,ACTYP,BL
"RTN","PSOHLNE3",112,0)
 S PSOSITE=$P(^PSRX(RXN,2),"^",9)
"RTN","PSOHLNE3",113,0)
 S X=$P($G(^PS(59,+PSOSITE,"IB")),"^")_"^"_DFN D XTYPE^IBARX
"RTN","PSOHLNE3",114,0)
 S (ACTYP,BL)="",(PSOBILL,PSOCPAY)=0
"RTN","PSOHLNE3",115,0)
CPAY1 ;
"RTN","PSOHLNE3",116,0)
 S ACTYP=$O(Y(ACTYP)) G:'ACTYP CSKP F III=0:0 S BL=$O(Y(ACTYP,BL)) Q:BL=""  I BL>0 S PSOBILL=BL,PSOCPAY=BL_"^"_Y(ACTYP,BL)
"RTN","PSOHLNE3",117,0)
 G CPAY1
"RTN","PSOHLNE3",118,0)
CSKP ;
"RTN","PSOHLNE3",119,0)
 S:$G(PSOSI) PSOCPAY=0  ;Supply item/investigational drug
"RTN","PSOHLNE3",120,0)
 S:$P($G(^PS(53,+$G(PTSTATUS),0)),"^",7)=1 PSOCPAY=0  ;Rx Patient Status exempt
"RTN","PSOHLNE3",121,0)
 I PSOIBQC'="" S:PSOIBQC'[1 PSOCPAY=1  ;Yes SC/EI from CPRS
"RTN","PSOHLNE3",122,0)
 I (PSOBILL'>0)!(PSOCPAY=0) S PSOCPAY=0  ;INELIGIBLE
"RTN","PSOHLNE3",123,0)
 Q
"RTN","PSOHLNE3",124,0)
 ;
"RTN","PSOHLNE3",125,0)
CHOC ;check outpatient classifications
"RTN","PSOHLNE3",126,0)
 S:PSOANSQ(PSOX("IRXN"),TYPE)'=PSOOICD(52.052311,1_","_PSOX("IRXN")_",",PSOFLD,"I") PSODCPY=1
"RTN","PSOHLNE3",127,0)
 Q
"RTN","PSOHLNE3",128,0)
 ;
"RTN","PSOHLNE3",129,0)
ALOG ;set activity log with edit info from cprs
"RTN","PSOHLNE3",130,0)
 N ACNT,SUB,RF,RFCNT
"RTN","PSOHLNE3",131,0)
 S ACNT=0 F SUB=0:0 S SUB=$O(^PSRX(RXN,"A",SUB)) Q:'SUB  S ACNT=SUB
"RTN","PSOHLNE3",132,0)
 S RFCNT=0 F RF=0:0 S RF=$O(^PSRX(RXN,1,RF)) Q:'RF  S RFCNT=RF S:RF>5 RFCNT=RF+1
"RTN","PSOHLNE3",133,0)
 D NOW^%DTC S ACNT=ACNT+1
"RTN","PSOHLNE3",134,0)
 S ^PSRX(RXN,"A",0)="^52.3DA^"_ACNT_"^"_ACNT S ^PSRX(RXN,"A",ACNT,0)=%_"^"_"E"_"^^"_RFCNT_"^Clinical Indicators and SC/EI's were updated from a CPRS e-sig edit at "_$E($P(%,".",2),1,2)_":"_$E($P(%,".",2),3,4)_"."
"RTN","PSOHLNE3",135,0)
 Q
"RTN","PSOHLNE3",136,0)
 ;
"RTN","PSOHLNE3",137,0)
CHKOI ;get and compare orderable items in file #100 and #52; don't process
"RTN","PSOHLNE3",138,0)
 ;  if it's different and the placer # is null.
"RTN","PSOHLNE3",139,0)
 I '$D(ARRAY(52,RXN_",",6,"I")) S OICHK=1 Q
"RTN","PSOHLNE3",140,0)
 D GETS^DIQ(50,ARRAY(52,RXN_",",6,"I")_",","2.1","I","PSOOI")
"RTN","PSOHLNE3",141,0)
 S ORITEM2=$$GET1^DIQ(100.001,"1,"_ORIEN_",",".01","I")
"RTN","PSOHLNE3",142,0)
 S ORID=$$GET1^DIQ(101.43,ORITEM2_",","2","I") S ORID=$P(ORID,";",1)
"RTN","PSOHLNE3",143,0)
 I PSOOI(50,ARRAY(52,RXN_",",6,"I")_",",2.1,"I")'="" I PSOOI(50,ARRAY(52,RXN_",",6,"I")_",",2.1,"I")'=ORID S OICHK=1
"RTN","PSOHLNE3",144,0)
 Q
"RTN","PSOHLNE3",145,0)
TEST(ORIEN) ;manually test an individual order record
"RTN","PSOHLNE3",146,0)
 N I,X,ORSCEIS,ORSCEI,ORDX,EDFLG,ORITEM,DFN,JJ
"RTN","PSOHLNE3",147,0)
 S (JJ,I)=0 F  S I=$O(^OR(100,ORIEN,5.1,I)) Q:I=""!(I'?1N.NN)  S JJ=JJ+1,ORDX(JJ)=$G(^OR(100,ORIEN,5.1,I,0))
"RTN","PSOHLNE3",148,0)
 S ORSCEIS=^OR(100,ORIEN,5.2),ORITEM=$P($G(^OR(100,ORIEN,4)),"^",1)
"RTN","PSOHLNE3",149,0)
 S ORSCEI="" F I=3,4,1,5,2,6,7 S ORSCEI=ORSCEI_"^"_$P(ORSCEIS,"^",I)
"RTN","PSOHLNE3",150,0)
 S:$$PATCH^XPDUTL("OR*3.0*243") ORSCEI=ORSCEI_"^"_$P(ORSCEIS,"^",8)
"RTN","PSOHLNE3",151,0)
 S ORSCEI=$E(ORSCEI,2,99)
"RTN","PSOHLNE3",152,0)
 S RXN=ORITEM,DFN=$P($P(^OR(100,ORIEN,0),"^",2),";",1)
"RTN","PSOHLNE3",153,0)
 D EN^PSOHLNE3(DFN,ORITEM,ORIEN,.ORDX,ORSCEI)
"RTN","PSOHLNE3",154,0)
 Q
"RTN","PSOHLNE3",155,0)
OBXNTE ; Called from PSOHLNEW due to it's routine size.
"RTN","PSOHLNE3",156,0)
 S LL=ZZ+1,PSOBCT=2
"RTN","PSOHLNE3",157,0)
 I $P($G(MSG(LL)),"|")="NTE" D
"RTN","PSOHLNE3",158,0)
 .I $P(MSG(LL),"|",4)'="" S PSOBCT=3,OBXAR(OCOUNT,2)=$P(MSG(LL),"|",4)
"RTN","PSOHLNE3",159,0)
 .F LLL=0:0 S LLL=$O(MSG(LL,LLL)) Q:'LLL  D
"RTN","PSOHLNE3",160,0)
 ..I $P($G(MSG(LL,LLL)),"|",4)'="" S OBXAR(OCOUNT,PSOBCT)=$P(MSG(LL,LLL),"|",4),PSOBCT=PSOBCT+1
"RTN","PSOHLNE3",161,0)
 Q
"RTN","PSOHLNE4")
0^40^B17206219
"RTN","PSOHLNE4",1,0)
PSOHLNE4 ;BIR/LE - Process Edit Information from CPRS - CONTINUED FROM PSOHLNE3 ;02/27/04
"RTN","PSOHLNE4",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**201,225**;DEC 1997;Build 29
"RTN","PSOHLNE4",3,0)
 ;
"RTN","PSOHLNE4",4,0)
 ;This API is used to update the prescription file when ICD-9 diagnosis
"RTN","PSOHLNE4",5,0)
 ; and SC/EI's are updated as a result of an e-sig in CPRS.
"RTN","PSOHLNE4",6,0)
 Q
"RTN","PSOHLNE4",7,0)
COPAY ;For IB, cancel copay charges if SC<50% and SC/EI changed and released; For PFS, send charge update msgs for SC 0-100%
"RTN","PSOHLNE4",8,0)
 ;  must have PSODA,PSO,PSODAYS,PSOFLAG,PSOREF,PSOIB,PSOPAR7,PSOOLD,PSONW before call to PSOCPA
"RTN","PSOHLNE4",9,0)
 N PSODA,PSO,PSODAYS,PSOFLAG,PSOREF,PSOIB,PSZ,PSOPAR7,PSOCSEQ,PSZ1,PSZ2,RELDAT,PSOOLD,PSONW,PSOSITE,PREA,PSOFLD,PSOPFS
"RTN","PSOHLNE4",10,0)
 S PSODA=RXN,PSO=3,PSODAYS=$$GET1^DIQ(52,PSODA_",","8")
"RTN","PSOHLNE4",11,0)
 S PSOOLD="Copay"
"RTN","PSOHLNE4",12,0)
 S PSONW="No Copay"
"RTN","PSOHLNE4",13,0)
 S PSOSITE=$P(^PSRX(PSODA,2),"^",9)
"RTN","PSOHLNE4",14,0)
 S PSOPAR7=$G(^PS(59,PSOSITE,"IB"))
"RTN","PSOHLNE4",15,0)
 S PSOFLAG=1  ;1 used here to eliminate display/print of messages.
"RTN","PSOHLNE4",16,0)
CSORT ; get orig fill copay info if released.
"RTN","PSOHLNE4",17,0)
 S RELDAT=$$GET1^DIQ(52,PSODA_",","31","I")
"RTN","PSOHLNE4",18,0)
 I RELDAT'="" S PSOCSEQ("A",0)=$G(^PSRX(PSODA,"IB"))
"RTN","PSOHLNE4",19,0)
 ;I RELDAT="" S PREA="R" D:'$G(PSOSI)&(PSOSCP<50)&($P($G(^PS(53,+$G(PTSTATUS),0)),"^",7)'=1) ACTLOG^PSOCPA G SET ;set act log when unreleased, but SC/EI changed copay
"RTN","PSOHLNE4",20,0)
 I RELDAT="" S PREA="R" D:+$G(PSOCPAY)>0&(PSOIBQC[1&(PSOPIBQ'[1)) ACTLOG^PSOCPA G SET ;set act log when unreleased, but SC/EI changed copay
"RTN","PSOHLNE4",21,0)
 ; get copay info for all released refills; if any
"RTN","PSOHLNE4",22,0)
 F PSZ=0:0 S PSZ=$O(^PSRX(PSODA,1,PSZ)) Q:PSZ'>0  D
"RTN","PSOHLNE4",23,0)
 . S RELDAT="",RELDAT=$$GET1^DIQ(52.1,PSZ_","_PSODA_",","17","I")
"RTN","PSOHLNE4",24,0)
 . Q:RELDAT=""
"RTN","PSOHLNE4",25,0)
 . S PSOCSEQ("A",PSZ)=$G(^PSRX(PSODA,1,PSZ,"IB"))
"RTN","PSOHLNE4",26,0)
 ; Sort potential refills to be cancelled first starting with last fill
"RTN","PSOHLNE4",27,0)
 ;    then orig fill then the rest of the entries.
"RTN","PSOHLNE4",28,0)
 S (PSZ1,PSZ2,PSZ)="" F  S PSZ=$O(PSOCSEQ("A",PSZ),-1) Q:PSZ=""  D
"RTN","PSOHLNE4",29,0)
 . I PSZ>0&($P(PSOCSEQ("A",PSZ),"^",2)'="") S PSZ1=PSZ1+1,PSOCSEQ("B",PSZ1,PSZ)="" Q
"RTN","PSOHLNE4",30,0)
 . I PSZ>0&($P(PSOCSEQ("A",PSZ),"^",2)="") S PSZ2=PSZ2+1000,PSOCSEQ("B",PSZ2,PSZ)="" Q
"RTN","PSOHLNE4",31,0)
 . I PSZ=0&($P(PSOCSEQ("A",PSZ),"^",4)'="") S PSZ1=PSZ1+1,PSOCSEQ("B",PSZ1,PSZ)="" Q
"RTN","PSOHLNE4",32,0)
 . I PSZ=0&($P(PSOCSEQ("A",PSZ),"^",4)="") S PSZ2=PSZ2+1000,PSOCSEQ("B",PSZ2,PSZ)="" Q
"RTN","PSOHLNE4",33,0)
 ;
"RTN","PSOHLNE4",34,0)
 ;S (PSZ,PSZ1)="",PSOFLD=0,PREA="R" D:'$G(PSOSI)&(PSOSCP<50)&($P($G(^PS(53,+$G(PTSTATUS),0)),"^",7)'=1) ACTLOG^PSOCPA F  S PSZ1=$O(PSOCSEQ("B",PSZ1)) Q:PSZ1=""  D
"RTN","PSOHLNE4",35,0)
 S (PSZ,PSZ1)="",PSOFLD=0,PREA="R" D:+$G(PSOCPAY)>0&(PSOIBQC[1&(PSOPIBQ'[1)) ACTLOG^PSOCPA F  S PSZ1=$O(PSOCSEQ("B",PSZ1)) Q:PSZ1=""  D
"RTN","PSOHLNE4",36,0)
 . F  S PSZ=$O(PSOCSEQ("B",PSZ1,PSZ)) Q:PSZ=""  D
"RTN","PSOHLNE4",37,0)
 .. S (PSOREF,PSOIB)="",PSOFLD=PSOFLD+1 S PREA="C" ;$S(PSOFLD=1:"R",1:"C")
"RTN","PSOHLNE4",38,0)
 .. ;I PSOFLD>1
"RTN","PSOHLNE4",39,0)
 .. S (PSOOLD,PSONW)=""
"RTN","PSOHLNE4",40,0)
 .. S PSOREF=PSZ
"RTN","PSOHLNE4",41,0)
 .. ;
"RTN","PSOHLNE4",42,0)
 .. S PSOPFS="",PSOPFS=$P($S('PSOREF:$G(^PSRX(PSODA,"PFS")),1:$G(^PSRX(PSODA,1,PSOREF,"PFS"))),"^",1,2)
"RTN","PSOHLNE4",43,0)
 .. I +$G(PSOPFS)>0&('$P($G(PSOPFS),"^",2)) K PSOPFS Q   ;don't send unreleased charge msg
"RTN","PSOHLNE4",44,0)
 .. I +$G(PSOPFS)<1 K PSOPFS  ;invalid PFSS ACCT REF/ SEND TO IB
"RTN","PSOHLNE4",45,0)
 .. I +$G(PSOPFS)>0 S PSOPFS="1^"_PSOPFS
"RTN","PSOHLNE4",46,0)
 .. ;
"RTN","PSOHLNE4",47,0)
 .. N TYPE S PSOIB=PSOCSEQ("A",PSOREF),TYPE=PSOREF
"RTN","PSOHLNE4",48,0)
 .. I +$G(PSOPFS) D CHRG^PSOPFSU1(PSODA,PSOREF,"CG",PSOPFS) D:+$G(PSOCPAY)>0&(PSOIBQC[1&(PSOPIBQ'[1)) ACTLOG^PSOCPA Q  ;PFSS charge update only
"RTN","PSOHLNE4",49,0)
 .. I PSOSCP<50 D RXED^PSOCPA  ;IB - if SC<50 and not billed via PFSS
"RTN","PSOHLNE4",50,0)
SET S:$D(^PSRX(RXN,"IB"))&(PSOSCP<50)&('$G(PSOSI)) $P(^PSRX(RXN,"IB"),"^",1)=""
"RTN","PSOHLNE4",51,0)
 K PSOSCP
"RTN","PSOHLNE4",52,0)
 Q
"RTN","PSOHLNE4",53,0)
 ;
"RTN","PSOHLNE4",54,0)
OBR ;Flag/Unflag orders
"RTN","PSOHLNE4",55,0)
 I PSOTYPE'="OBR"!($G(PSOSEG)="") Q
"RTN","PSOHLNE4",56,0)
 N PSOFLAG,PSORDER,PSOPEN,DR,PSOREA,PSOBY,PSONOW
"RTN","PSOHLNE4",57,0)
 S PSORDER=+$P($P(PSOSEG,"|",2),"^")           ; Pointer to ORDER file (#100)
"RTN","PSOHLNE4",58,0)
 S PSOPEN=+$O(^PS(52.41,"B",PSORDER,0))        ; Pointer to PENDING OUTPATIENT ORDERS file (#52.41)
"RTN","PSOHLNE4",59,0)
 S PSOFLAG=$P(PSOSEG,"|",4)                    ; "FL" for Flag and "UF" for Unflag action
"RTN","PSOHLNE4",60,0)
 S PSOREA=$P(PSOSEG,"|",13)                    ; Reason for Flag/Unflag (Freetext up to 80chars)
"RTN","PSOHLNE4",61,0)
 S PSOBY=$P(PSOSEG,"|",16)                     ; Flagged/Unflagged By - Pointer to NEW PERSON file (#200)
"RTN","PSOHLNE4",62,0)
 S PSONOW=$E($$NOW^XLFDT(),1,12)               ; CURRENT DATE/TIME wihtout seconds
"RTN","PSOHLNE4",63,0)
 ;
"RTN","PSOHLNE4",64,0)
 I 'PSOPEN!'$P($G(^PS(52.41,PSOPEN,0)),"^") D EN^ORERR("Invalid Pending Order/Flag Msg",.MSG) Q
"RTN","PSOHLNE4",65,0)
 ;
"RTN","PSOHLNE4",66,0)
 I PSOFLAG="FL" D
"RTN","PSOHLNE4",67,0)
 . S $P(^PS(52.41,PSOPEN,"FLG"),"^",1,3)=PSONOW_"^"_PSOBY_"^"_$E(PSOREA,1,80)
"RTN","PSOHLNE4",68,0)
 . S $P(^PS(52.41,PSOPEN,"FLG"),"^",4,6)="^^"
"RTN","PSOHLNE4",69,0)
 . S $P(^PS(52.41,PSOPEN,0),"^",23)=1
"RTN","PSOHLNE4",70,0)
 E  D
"RTN","PSOHLNE4",71,0)
 . S $P(^PS(52.41,PSOPEN,"FLG"),"^",4,6)=PSONOW_"^"_PSOBY_"^"_$E(PSOREA,1,80)
"RTN","PSOHLNE4",72,0)
 . S $P(^PS(52.41,PSOPEN,0),"^",23)=""
"RTN","PSOHLNE4",73,0)
 ;
"RTN","PSOHLNE4",74,0)
 Q
"RTN","PSOHLNEW")
0^28^B80329211
"RTN","PSOHLNEW",1,0)
PSOHLNEW ;BIR/RTR - CPRS orders ;11/30/06 11:49am
"RTN","PSOHLNEW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,7,15,46,71,98,111,124,117,131,146,132,143,223,235,148,239,249,225**;DEC 1997;Build 29
"RTN","PSOHLNEW",3,0)
 ;40.8-728,50-221,SC-2675,100-2219,50.7-2223,EN^ORERR-2187
"RTN","PSOHLNEW",4,0)
EN(MSG) ;
"RTN","PSOHLNEW",5,0)
 N PSODDRUG,ENTERED,LOCATION,PLACER,PSOOC,ROUTE,NATURE,PREV,ROUTING,OO,OR,STAT,ZZ,DFN,COMM,QCOUNT,OCOUNT,Q1I,QTARRAY,QTARRAY2,EE,PP,XOFLAG,PSODYSPL,PSOFILNM
"RTN","PSOHLNEW",6,0)
 N ONEFLAG,SERV,WPCT,EFFECT,PROV,PENDING,RRX,PSOLQ1I,PSOLQ1II,PSOQWX,PSOLQ1IX,PSONVA,PSOICD,PSOSCP,EEE
"RTN","PSOHLNEW",7,0)
 N OBXAR,AA,II,SIG1,FILLER,COMM,GG,FF,JJ,JJJ,CT,LIM,VAR,VAR1,QQQ,PSRNFLAG,PSRNQFLG,RCOMM,XOFLAGZ,NWFLAG,PFLAG,PSINPTR,INPTRX,PSOIBN,PSOIBY
"RTN","PSOHLNEW",8,0)
 N DSIG,PSOCHFFL,PSOCVI,PSOMO,PSOXRP,NN,LL,LLL,WPARRAY,QTVAR,POVAR,POVAR1,ORCSEG,NNN,OOO,AAA,NNNN,POLIM,NNCK,PRIOR,IPPLACER,PLACERXX,EER,PSERRPID,PSERRPV1,PSERRORC,PSOEXFLG,PSOMSORR,PDFN,VAL
"RTN","PSOHLNEW",9,0)
 S (SEND,PSOSND,OCOUNT)=0 K PSOPLC,PSOFFL,PSORSO,PSOSUSZ
"RTN","PSOHLNEW",10,0)
 F OO=0:0 S OO=$O(MSG(OO)) Q:'OO!(SEND)!(PSOSND)  D:$P(MSG(OO),"|")="PID" SPDFN I $P(MSG(OO),"|")="ORC",$P(MSG(OO),"|",2)'="NW",$P(MSG(OO),"|",2)'="XO" D
"RTN","PSOHLNEW",11,0)
 .S OR("STAT")=$P(MSG(OO),"|",2),OR("PLACE")=+$P(MSG(OO),"|",3),PLACERXX=+$P($P(MSG(OO),"|",3),";",2),OR("COMM")=$P(MSG(OO),"|",17),OR("USER")=$P(MSG(OO),"|",11) I $P(MSG(OO),"|",2)'="DE",$P(MSG(OO),"|",2)'="NA" S SEND=1 D FILL Q
"RTN","PSOHLNEW",12,0)
 .S PSOPLC=+$P(MSG(OO),"|",3),PSOFFL=+$P(MSG(OO),"|",4),PSOSND=1,PSOCHFFL=$P($P(MSG(OO),"|",4),"^")
"RTN","PSOHLNEW",13,0)
 I $G(OR("COMM"))["^" S OR("COMM")=$P(OR("COMM"),"^",5)
"RTN","PSOHLNEW",14,0)
 I PSOSND,$G(PSOCHFFL)["S",$G(OR("STAT"))="NA" D CHCS^PSOHLNE1 Q
"RTN","PSOHLNEW",15,0)
 I PSOSND,'$D(^PSRX(+$G(PSOFFL),0)) S COMM="Order was not located by Pharmacy" D EN^ORERR(COMM,.MSG) D KL Q
"RTN","PSOHLNEW",16,0)
 I PSOSND,$G(PDFN),PDFN'=+$P($G(^PSRX(+$G(PSOFFL),0)),"^",2) S COMM="Patient does not match" D EN^ORERR(COMM,.MSG) D KL Q
"RTN","PSOHLNEW",17,0)
 I PSOSND,$G(OR("STAT"))'="DE" N PSONAS S PSONAS=$S($P($G(^PSRX(PSOFFL,"OR1")),"^",2)="":1,1:0) S $P(^PSRX(PSOFFL,"OR1"),"^",2)=PSOPLC,^PSRX("APL",PSOPLC,PSOFFL)="" D:PSONAS EN^PSOHDR("PRES",PSOFFL) D KL Q
"RTN","PSOHLNEW",18,0)
 D KL
"RTN","PSOHLNEW",19,0)
 I SEND,$G(OR("STAT"))="Z@" G PURGE^PSOHLNE2
"RTN","PSOHLNEW",20,0)
 I SEND,$G(OR("STAT"))="ZF" G REF^PSOHLNE2
"RTN","PSOHLNEW",21,0)
 I SEND,$G(OR("STAT"))'="CA",$G(OR("STAT"))'="DC",$G(OR("STAT"))'="HD",$G(OR("STAT"))'="RL",$G(OR("STAT"))'="SS" S RCOMM="Invalid Order Control Code" D EN^ORERR(RCOMM,.MSG) Q
"RTN","PSOHLNEW",22,0)
 I SEND K SEND G:$G(OR("STAT"))="SS" ESTAT D EN^PSOORUTL(.OR) S PLACER=OR("PLACE"),STAT=OR("STAT"),COMM=OR("COMM") S PSOMSORR=1 D  K PSOMSORR Q
"RTN","PSOHLNEW",23,0)
 .I $G(OR("FILLER"))="" D  D ERROR^PSOHLSN Q
"RTN","PSOHLNEW",24,0)
 ..F EER=0:0 S EER=$O(MSG(EER)) Q:'EER  S:$P(MSG(EER),"|")="PV1" PSERRPV1=MSG(EER) S:$P(MSG(EER),"|")="PID" PSERRPID=MSG(EER) S:$P(MSG(EER),"|")="ORC"&($G(PSERRORC)="") PSERRORC=MSG(EER)
"RTN","PSOHLNEW",25,0)
 .I $P(OR("FILLER"),"^",2)="R" S FILLER=$P(OR("FILLER"),"^") D EN^PSOHLSN1(FILLER,STAT,$G(OR("PHARMST")),COMM) K:$G(PSOEXFLG) PSOMSORR,PLACERXX D:$G(PSOEXFLG) EN^PSOHLSN1(FILLER,"SC","ZE","") D:$G(PSOSUSZ) SUS^PSOORUT1 K PSOSUSZ Q
"RTN","PSOHLNEW",26,0)
 .D EN^PSOHLSN(PLACER,STAT,COMM) Q
"RTN","PSOHLNEW",27,0)
 D KL^PSOHLSIH S RRX=1 F ZZ=0:0 S ZZ=$O(MSG(ZZ)) Q:'ZZ  S PSOSEG=$G(MSG(ZZ)),PSOTYPE=$P(PSOSEG,"|") S PSOSEG=$E(PSOSEG,5,$L(PSOSEG)) I PSOTYPE'="NTE" D @PSOTYPE
"RTN","PSOHLNEW",28,0)
 I $G(PSRNFLAG) S PSOMO=0 D MISRN^PSOHLNE1 I $G(PSOMO) Q
"RTN","PSOHLNEW",29,0)
 S PSRNQFLG=0 I $G(PSRNFLAG),$G(PREV) D  I $G(PSRNQFLG) S RCOMM="Duplicate Renewal Request. Order rejected by Pharmacy." D EN^ORERR(RCOMM,.MSG) D RERROR^PSOHLSN D KL^PSOHLSIH Q
"RTN","PSOHLNEW",30,0)
 .I $P($G(^PSRX(PREV,"OR1")),"^",4) S PSRNQFLG=1 Q
"RTN","PSOHLNEW",31,0)
 .I $O(^PS(52.41,"AQ",PREV,0)) S PSRNQFLG=1
"RTN","PSOHLNEW",32,0)
 .I $G(XOFLAG),$G(DFN)'=$S($G(PFLAG):$P($G(^PS(52.41,+$G(PREV),0)),"^",2),1:$P($G(^PSRX(+$G(PREV),0)),"^",2)) S RCOMM="Patient mismatch on previous order." D EN^ORERR(RCOMM,.MSG) S XOFLAGZ=1 D RERROR^PSOHLSN D KL^PSOHLSIH Q
"RTN","PSOHLNEW",33,0)
 I $G(PLACER) I $G(DFN)'=+$P($G(^OR(100,+PLACER,0)),"^",2) G MISX^PSOHLNE1
"RTN","PSOHLNEW",34,0)
 I $G(PLACER) D NFILE
"RTN","PSOHLNEW",35,0)
 D KL^PSOHLSIH
"RTN","PSOHLNEW",36,0)
 Q
"RTN","PSOHLNEW",37,0)
ESTAT ;
"RTN","PSOHLNEW",38,0)
 D EXP^PSOHLNE1
"RTN","PSOHLNEW",39,0)
 Q
"RTN","PSOHLNEW",40,0)
MSH Q
"RTN","PSOHLNEW",41,0)
PID S DFN=+$P(PSOSEG,"|",3)
"RTN","PSOHLNEW",42,0)
 Q
"RTN","PSOHLNEW",43,0)
PV1 S LOCATION=+$P(+$P(PSOSEG,"|",3),"^")
"RTN","PSOHLNEW",44,0)
 S:'$D(^SC(LOCATION,0)) LOCATION=""
"RTN","PSOHLNEW",45,0)
 S INPTRX=0 I $G(LOCATION) S PSINPTR=$P($G(^SC(LOCATION,0)),"^",4) I PSINPTR Q
"RTN","PSOHLNEW",46,0)
 I $G(LOCATION) S INPTRX=$P($G(^SC(LOCATION,0)),"^",15)
"RTN","PSOHLNEW",47,0)
 I '$G(INPTRX) S INPTRX=$O(^DG(40.8,0))
"RTN","PSOHLNEW",48,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSOHLNEW",49,0)
 S PSINPTR=+$$SITE^VASITE(DT,INPTRX)
"RTN","PSOHLNEW",50,0)
 Q
"RTN","PSOHLNEW",51,0)
OBR ;This segment is used to pass flagging information from CPRS.
"RTN","PSOHLNEW",52,0)
 D OBR^PSOHLNE4
"RTN","PSOHLNEW",53,0)
 Q
"RTN","PSOHLNEW",54,0)
DG1 S $P(PSOICD($P(PSOSEG,"|",1)),"^")=$P($P(PSOSEG,"|",3),"^")
"RTN","PSOHLNEW",55,0)
 Q
"RTN","PSOHLNEW",56,0)
ORC ;
"RTN","PSOHLNEW",57,0)
 Q:$P(PSOSEG,"|")="DE"
"RTN","PSOHLNEW",58,0)
 S:$P(PSOSEG,"|")="XO" XOFLAG=1 D ^PSOHLNE1 S:$G(PRIOR)="A" PRIOR="E" S:$G(PRIOR)="" PRIOR="R"
"RTN","PSOHLNEW",59,0)
 Q
"RTN","PSOHLNEW",60,0)
 ;
"RTN","PSOHLNEW",61,0)
RXO I $O(MSG(ZZ,0)) D ^PSOHLNE2 G RXOPS
"RTN","PSOHLNEW",62,0)
 S PSORDITE=$P($P(PSOSEG,"|"),"^",4)
"RTN","PSOHLNEW",63,0)
 S PSODDRUG=$P($P(PSOSEG,"|",10),"^",4) I $G(PSODDRUG) S:'$D(^PSDRUG(PSODDRUG,0)) PSODDRUG=""
"RTN","PSOHLNEW",64,0)
 S PSOXQTY=$P(PSOSEG,"|",11)
"RTN","PSOHLNEW",65,0)
 S PSOREFIL=$P(PSOSEG,"|",13)
"RTN","PSOHLNEW",66,0)
 S PSODYSPL=$P(PSOSEG,"|",17)
"RTN","PSOHLNEW",67,0)
RXOPS S ONEFLAG=0,WPCT=1,LL=ZZ+1
"RTN","PSOHLNEW",68,0)
 I $P($G(MSG(LL)),"|")="NTE" D
"RTN","PSOHLNEW",69,0)
 .S ONEFLAG=1,WORDP=$S($P(MSG(LL),"|",2):$P(MSG(LL),"|",2),1:$P(MSG(LL),"|",3)) S:$P(MSG(LL),"|",4)'="" WPARRAY(WORDP,WPCT)=$P(MSG(LL),"|",4) S:$P(MSG(LL),"|",4)'="" WPCT=WPCT+1 F LLL=0:0 S LLL=$O(MSG(LL,LLL)) Q:'LLL  D
"RTN","PSOHLNEW",70,0)
 ..I $G(MSG(LL,LLL))'="" S WPARRAY(WORDP,WPCT)=$G(MSG(LL,LLL)),WPCT=WPCT+1
"RTN","PSOHLNEW",71,0)
 I ONEFLAG S LL=LL+1 I $P($G(MSG(LL)),"|")="NTE" D NTE^PSOHLNE1
"RTN","PSOHLNEW",72,0)
 K WORDP
"RTN","PSOHLNEW",73,0)
 Q
"RTN","PSOHLNEW",74,0)
RXR I $P($P(PSOSEG,"|"),"^",4) S ROUTE(RRX)=$P($P(PSOSEG,"|"),"^",4) S RRX=RRX+1
"RTN","PSOHLNEW",75,0)
 Q
"RTN","PSOHLNEW",76,0)
OBX I $O(MSG(ZZ,0)) D OBXX^PSOHLNE2 G OBXNTE
"RTN","PSOHLNEW",77,0)
 S OCOUNT=OCOUNT+1
"RTN","PSOHLNEW",78,0)
 S OBXAR(OCOUNT,1)=$P(PSOSEG,"|",5)
"RTN","PSOHLNEW",79,0)
OBXNTE ;
"RTN","PSOHLNEW",80,0)
 D OBXNTE^PSOHLNE3
"RTN","PSOHLNEW",81,0)
 Q
"RTN","PSOHLNEW",82,0)
ZRN S PSODSC=1_"^"_$P(PSOSEG,"|",2)
"RTN","PSOHLNEW",83,0)
 I $O(MSG(ZZ,0)) F T=0:0 S T=$O(MSG(ZZ,T)) Q:'T  S PSODSC(T)=MSG(ZZ,T)
"RTN","PSOHLNEW",84,0)
 K T
"RTN","PSOHLNEW",85,0)
 Q
"RTN","PSOHLNEW",86,0)
 ;
"RTN","PSOHLNEW",87,0)
ZRX D ZRX^PSOHLNE1
"RTN","PSOHLNEW",88,0)
 Q
"RTN","PSOHLNEW",89,0)
 ;
"RTN","PSOHLNEW",90,0)
ZCL D ZCL^PSOHLNE1
"RTN","PSOHLNEW",91,0)
 Q
"RTN","PSOHLNEW",92,0)
ZSC D CP^PSOHLNE1
"RTN","PSOHLNEW",93,0)
 Q
"RTN","PSOHLNEW",94,0)
NFILE ;
"RTN","PSOHLNEW",95,0)
 I $G(PSODSC) D ^PSONVNEW Q  ;adds non-va med to #55
"RTN","PSOHLNEW",96,0)
 ;
"RTN","PSOHLNEW",97,0)
 K DD,DO,DIC S DLAYGO="52.41",DIC="^PS(52.41,",DIC(0)="L",X=PLACER,DIC("DR")="1////"_DFN_";2////"_PSOOC_";6////"_$G(EFFECT)_";12////"_$G(PSOXQTY)_";25////"_$G(PRIOR)
"RTN","PSOHLNEW",98,0)
 S DIC("DR")=DIC("DR")_";22////"_$G(PSORSO)_";22.1////"_$G(PREV)_";19////"_$G(ROUTING)_";17////"_$$UNESC^ORHLESC($G(SERV))_";7////"_$G(NATURE)_";13////"_$G(PSOREFIL)_";1.1////"_$G(LOCATION)_";117////"_$G(DSIG)
"RTN","PSOHLNEW",99,0)
 D FILE^DICN K DIC,DR I Y<0 Q
"RTN","PSOHLNEW",100,0)
 S PENDING=+Y
"RTN","PSOHLNEW",101,0)
 S $P(^PS(52.41,PENDING,0),"^",4)=$S($G(ENTERED):+$G(ENTERED),1:""),$P(^(0),"^",5)=$S($G(PROV):+$G(PROV),1:""),$P(^(0),"^",8)=$S($G(PSORDITE):+$G(PSORDITE),1:""),$P(^(0),"^",9)=$S($G(PSODDRUG):+$G(PSODDRUG),1:""),$P(^(0),"^",15)=$G(ROUTE)
"RTN","PSOHLNEW",102,0)
 S ^PS(52.41,PENDING,"IBQ")=$G(PSOIBY)
"RTN","PSOHLNEW",103,0)
 I $G(PSODYSPL)'="",$E(PSODYSPL)?1A S PSODYSPL=$E(PSODYSPL,2,$L(PSODYSPL))
"RTN","PSOHLNEW",104,0)
 S $P(^PS(52.41,PENDING,"INI"),"^")=$G(PSINPTR),$P(^(0),"^",12)=$G(PSOLOG),$P(^(0),"^",22)=$G(PSODYSPL)
"RTN","PSOHLNEW",105,0)
 I $G(QCOUNT) S ^PS(52.41,PENDING,1,0)="^52.413^"_QCOUNT_"^"_QCOUNT
"RTN","PSOHLNEW",106,0)
 S PSOQWX=$G(PSODDRUG) D:'$G(PSOQWX) OID^PSOHLNE1
"RTN","PSOHLNEW",107,0)
 F PP=0:0 S PP=$O(Q1I(PP)) Q:'PP  S VAL=$S($G(PSOQWX)&($G(PSOLQ1II(PP))):Q1I(PP),$G(PSOQWX)&($G(PSOLQ1IX(PP))'="")&('$G(PSOLQ1II(PP))):PSOLQ1IX(PP),1:PSOLQ1I(PP)) S ^PS(52.41,PENDING,1,PP,0)=$$UNESC^ORHLESC(VAL)
"RTN","PSOHLNEW",108,0)
 F EE=0:0 S EE=$O(QTARRAY(EE)) Q:'EE  S ^PS(52.41,PENDING,1,EE,1)=$$UNESC^ORHLESC(QTARRAY(EE)) S VAL=$S($G(PSOQWX)&($G(PSOLQ1II(EE))):$G(QTARRAY2(EE)),$G(PSOQWX)&($G(PSOLQ1IX(EE))'="")&('$G(PSOLQ1II(EE))):PSOLQ1IX(EE),1:$G(PSOLQ1I(EE))) D
"RTN","PSOHLNEW",109,0)
 .S ^PS(52.41,PENDING,1,EE,2)=$$UNESC^ORHLESC(VAL) S $P(^PS(52.41,PENDING,1,EE,1),"^",8)=+$G(ROUTE(EE))
"RTN","PSOHLNEW",110,0)
 S:$P($G(^PS(52.41,PENDING,1,1,1)),"^",3) $P(^PS(52.41,PENDING,0),"^",18)=$E($P($G(^PS(52.41,PENDING,1,1,1)),"^",3),1,7)
"RTN","PSOHLNEW",111,0)
 D STUFF^PSOHLNE2
"RTN","PSOHLNEW",112,0)
 D ^PSOHLPII
"RTN","PSOHLNEW",113,0)
 S LL=0 I $O(WPARRAY(6,0)) F LLL=0:0 S LLL=$O(WPARRAY(6,LLL)) Q:'LLL  S LL=LL+1 S ^PS(52.41,PENDING,3,LL,0)=$$UNESC^ORHLESC($G(WPARRAY(6,LLL)))
"RTN","PSOHLNEW",114,0)
 I LL S ^PS(52.41,PENDING,3,0)="^52.42^"_LL_"^"_LL
"RTN","PSOHLNEW",115,0)
 S LL=0 I $O(WPARRAY(7,0)) F LLL=0:0 S LLL=$O(WPARRAY(7,LLL)) Q:'LLL  S LL=LL+1 S ^PS(52.41,PENDING,"INS1",LL,0)=$$UNESC^ORHLESC($G(WPARRAY(7,LLL)))
"RTN","PSOHLNEW",116,0)
 I LL S ^PS(52.41,PENDING,"INS1",0)="^^"_LL_"^"_LL_"^"_$G(DT)_"^"
"RTN","PSOHLNEW",117,0)
 I $P($G(^PS(50.7,+$G(PSORDITE),"INS")),"^")'="" S $P(^PS(52.41,PENDING,"INS"),"^",2)=$S($O(^PS(52.41,PENDING,"INS1",0)):1,1:0)
"RTN","PSOHLNEW",118,0)
 I $G(OCOUNT) S ^PS(52.41,PENDING,"OBX",0)="^52.4118A^"_OCOUNT_"^"_OCOUNT F OCOUNT=1:1:OCOUNT D
"RTN","PSOHLNEW",119,0)
 .S ^PS(52.41,PENDING,"OBX",OCOUNT,0)=$$UNESC^ORHLESC($G(OBXAR(OCOUNT,1)))
"RTN","PSOHLNEW",120,0)
 .D USER^PSOORFI2(+$G(PROV)) S ^PS(52.41,PENDING,"OBX",OCOUNT,1)=$$UNESC^ORHLESC(USER1) K USER1
"RTN","PSOHLNEW",121,0)
 .S PSOBCT=1 F LLL=2:1 Q:'$D(OBXAR(OCOUNT,LLL))  S ^PS(52.41,PENDING,"OBX",OCOUNT,2,PSOBCT,0)=$$UNESC^ORHLESC(OBXAR(OCOUNT,LLL)),^PS(52.41,PENDING,"OBX",OCOUNT,2,0)="^^"_PSOBCT_"^"_PSOBCT_"^"_$G(DT)_"^"
"RTN","PSOHLNEW",122,0)
 D ^PSOHLPIS
"RTN","PSOHLNEW",123,0)
 K DIK S DIK="^PS(52.41,",DA=PENDING D IX^DIK
"RTN","PSOHLNEW",124,0)
 I $G(PSOOC)="RNW",$G(PREV),$D(^PSRX(+$G(PREV),0)) D EN^PSOHLSN1(PREV,"SC","ZZ","")
"RTN","PSOHLNEW",125,0)
 S PSOMSORR=1,IPPLACER=$P($G(^PS(52.41,PENDING,0)),"^") I IPPLACER D
"RTN","PSOHLNEW",126,0)
 .I '$G(XOFLAG) D EN^PSOHLSN(IPPLACER,"OK","IP") Q
"RTN","PSOHLNEW",127,0)
 .D EN^PSOHLSN(IPPLACER,"XR","IP") I $G(PFLAG) D DCP^PSOHLSN Q
"RTN","PSOHLNEW",128,0)
 .K PSOMSORR I $D(^PSRX(+$G(PREV),0)) D  D EN^PSOHLSN1(PREV,"RP","","","A")
"RTN","PSOHLNEW",129,0)
 ..S $P(^PSRX(PREV,"STA"),"^")=15,$P(^PSRX(PREV,3),"^",5)=DT,$P(^PSRX(PREV,3),"^",10)=$P(^PSRX(PREV,3),"^")  ;;PSO*7*249
"RTN","PSOHLNEW",130,0)
 ..D REVERSE^PSOBPSU1(PREV,,"DC",7),CAN^PSOTPCAN(PREV),CAN^PSOUTL(PREV)
"RTN","PSOHLNEW",131,0)
 ..D CNT^PSOHLNE1
"RTN","PSOHLNEW",132,0)
 ..D:$G(^PS(52.41,PENDING,1,1,0))=""&($P($G(^PS(52.41,PENDING,1,1,1)),"^")="")&($G(^PS(52.41,PENDING,"SIG",1,0))="")
"RTN","PSOHLNEW",133,0)
 ...N FSIG,BSIG
"RTN","PSOHLNEW",134,0)
 ...I '$P($G(^PSRX(PREV,"SIG")),"^",2),$P($G(^("SIG")),"^")'="" D
"RTN","PSOHLNEW",135,0)
 ....D EN3^PSOUTLA1(PREV,70)
"RTN","PSOHLNEW",136,0)
 ....I $G(BSIG(1))'="" S ^PS(52.41,PENDING,"SIG",1,0)=$$UNESC^ORHLESC($G(BSIG(1))) I $O(BSIG(1)) F EE=1:0 S EE=$O(BSIG(EE)) Q:'EE  S ^PS(52.41,PENDING,"SIG",EE,0)=$$UNESC^ORHLESC($G(BSIG(EE)))
"RTN","PSOHLNEW",137,0)
 ...I $P($G(^PSRX(PREV,"SIG")),"^",2),$G(^PSRX(PREV,"SIG1",1,0))'="" D
"RTN","PSOHLNEW",138,0)
 ....D FSIG^PSOUTLA("R",PREV,70)
"RTN","PSOHLNEW",139,0)
 ....I $G(FSIG(1))'="" S ^PS(52.41,PENDING,"SIG",1,0)=$$UNESC^ORHLESC($G(FSIG(1))) I $O(FSIG(1)) F EE=1:0 S EE=$O(FSIG(EE)) Q:'EE  S ^PS(52.41,PENDING,"SIG",EE,0)=$$UNESC^ORHLESC($G(FSIG(EE)))
"RTN","PSOHLNEW",140,0)
 ...F EE=0:0 S EE=$O(^PS(52.41,PENDING,"SIG",EE)) Q:'EE  S ^PS(52.41,PENDING,"SIG",0)="^52.4124A^"_EE_"^"_EE
"RTN","PSOHLNEW",141,0)
 D CSET^PSODIAG
"RTN","PSOHLNEW",142,0)
 Q
"RTN","PSOHLNEW",143,0)
SPDFN S PDFN=$P($G(MSG(OO)),"|",4) Q
"RTN","PSOHLNEW",144,0)
KL K PSOPLC,PSOFFL,PSOSND
"RTN","PSOHLNEW",145,0)
 Q
"RTN","PSOHLNEW",146,0)
FILL ;
"RTN","PSOHLNEW",147,0)
 S (PSOFILNM,OR("PSOFILNM"))=$P($P(MSG(OO),"|",4),"^")
"RTN","PSOHLNEW",148,0)
 Q
"RTN","PSOHLPII")
0^31^B53884421
"RTN","PSOHLPII",1,0)
PSOHLPII ;BIR/RTR-Parse out and create CPRS Instructions ;7/21/96
"RTN","PSOHLPII",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**46,225**;DEC 1997;Build 29
"RTN","PSOHLPII",3,0)
 ;External reference to File #50.7 supported by DBIA 2223
"RTN","PSOHLPII",4,0)
 ;External reference to File #51 supported by DBIA 2224
"RTN","PSOHLPII",5,0)
 ;External reference to File #51.1 supported by DBIA 2225
"RTN","PSOHLPII",6,0)
 ;External reference to File #51.2 supported by DBIA 2226
"RTN","PSOHLPII",7,0)
 ;External reference to File #50.606 supported by DBIA 2174
"RTN","PSOHLPII",8,0)
EN ;
"RTN","PSOHLPII",9,0)
 Q:'$D(^PS(52.41,PENDING,1,0))
"RTN","PSOHLPII",10,0)
 N PISI,PSOFX,SDF,SZZ,ZZS,ZZSB,SSZZ,SCHHOLD,GGGZ,SGLFLAG,SGLOOP,ZSCHED,SPFG,PSNOUN,MEDEXP,PSDUR,NOUN,SCHED,INTERVAL,SIG0,SIG2,SIG3,SDL,WW,TODOSE,PDAYS,WWFL,PSOCJI
"RTN","PSOHLPII",11,0)
 N SSS,TT,DCOUNT,PREP,VERB,FFF,GGG,SIGDS,SIGRT,PSOROUTE,PSOSG1,PSOSG2
"RTN","PSOHLPII",12,0)
 N SIG
"RTN","PSOHLPII",13,0)
 F PISI=0:0 S PISI=$O(^PS(52.41,PENDING,1,PISI)) Q:'PISI  D:$D(^(PISI,0))
"RTN","PSOHLPII",14,0)
 .S PSOFX("DOSE",PISI)=$P($G(^PS(52.41,PENDING,1,PISI,2)),"^") I $P($G(^(2)),"^",2)'="" S PSOFX("DOSE ORDERED",PISI)=$P($G(^(2)),"^",2)
"RTN","PSOHLPII",15,0)
 .S PSOFX("SCHEDULE",PISI)=$P($G(^PS(52.41,PENDING,1,PISI,1)),"^"),PSOFX("ROUTE",PISI)=$P($G(^(1)),"^",8),PSOFX("DURATION",PISI)=$P($G(^(1)),"^",2),PSOFX("NOUN",PISI)=$P($G(^(1)),"^",5),PSOFX("CONJUNCTION",PISI)=$P($G(^(1)),"^",6)
"RTN","PSOHLPII",16,0)
 .I $G(PSOFX("DURATION",PISI)) S PSOFX("DURATION",PISI)="D"_$G(PSOFX("DURATION",PISI))
"RTN","PSOHLPII",17,0)
 .I $G(PSOFX("DURATION",PISI))'="" S PSOFX("DURATION",PISI)=$E(PSOFX("DURATION",PISI),2,999)_$E(PSOFX("DURATION",PISI))
"RTN","PSOHLPII",18,0)
 S TODOSE=0 F WW=0:0 S WW=$O(PSOFX("DOSE",WW)) Q:'WW  S TODOSE=WW
"RTN","PSOHLPII",19,0)
 Q:'TODOSE
"RTN","PSOHLPII",20,0)
 S SIGDS=+$P($G(^PS(50.7,+$G(PSORDITE),0)),"^",2),VERB=$P($G(^PS(50.606,SIGDS,"MISC")),"^"),PREP=$P($G(^("MISC")),"^",3)
"RTN","PSOHLPII",21,0)
 F SSS=1:1:TODOSE D
"RTN","PSOHLPII",22,0)
 .S SIG0(SSS)=$S($G(PSOFX("DOSE ORDERED",SSS))'="":$G(PSOFX("DOSE ORDERED",SSS)),1:$G(PSOFX("DOSE",SSS)))
"RTN","PSOHLPII",23,0)
 .S PSNOUN(SSS)=$G(PSOFX("NOUN",SSS))
"RTN","PSOHLPII",24,0)
 .;S PSOROUTE(SSS)=$S($P($G(^PS(51.2,+$G(PSOFX("ROUTE",SSS)),0)),"^",2)'="":$P(^(0),"^",2),$P($G(^(0)),"^",3)'="":$P(^(0),"^",3),1:$P($G(^(0)),"^")) S MEDEXP(SSS)=$S($P($G(^PS(51.2,+$G(PSOFX("ROUTE",SSS)),0)),"^",2)="":0,1:1)
"RTN","PSOHLPII",25,0)
 .S PSOROUTE(SSS)=$S($P($G(^PS(51.2,+$G(PSOFX("ROUTE",SSS)),0)),"^",3)'="":$P($G(^(0)),"^",3),1:$P($G(^(0)),"^"))
"RTN","PSOHLPII",26,0)
 .S PDAYS(SSS)=$G(PSOFX("DURATION",SSS))
"RTN","PSOHLPII",27,0)
 .I $G(PSOFX("DURATION",SSS))'="",($E(PSOFX("DURATION",SSS),$L(PSOFX("DURATION",SSS)))'?1A) S PDAYS(SSS)=PDAYS(SSS)_"D"
"RTN","PSOHLPII",28,0)
 .S PSDUR(SSS)=$S($G(PDAYS(SSS))="":"NULL",1:"FOR "_$E($G(PDAYS(SSS)),1,($L($G(PDAYS(SSS)))-1))) D  I PSDUR(SSS)'="NULL" S PSDUR(SSS)=PSDUR(SSS)_" "_INTERVAL
"RTN","PSOHLPII",29,0)
 ..I PSDUR(SSS)'="NULL" S INTERVAL=$E(PDAYS(SSS),$L(PDAYS(SSS))),INTERVAL=$S(INTERVAL="D":"DAYS",INTERVAL="W":"WEEKS",INTERVAL="H":"HOURS",INTERVAL="L":"MONTHS",INTERVAL="M":"MINUTES",INTERVAL="S":"SECONDS",1:"") D
"RTN","PSOHLPII",30,0)
 ...I $G(INTERVAL)'="",$G(PSOFX("DURATION",SSS)),$G(PSOFX("DURATION",SSS))'>1 S INTERVAL=$E(INTERVAL,1,($L(INTERVAL)-1))
"RTN","PSOHLPII",31,0)
 F GGG=1:1:TODOSE S ZSCHED(GGG)=$G(PSOFX("SCHEDULE",GGG))
"RTN","PSOHLPII",32,0)
 ;.I $G(ZSCHED(GGG))="" S SCHED(GGG)="" Q
"RTN","PSOHLPII",33,0)
 ;.S SGLFLAG=0 F WW=0:0 S WW=$O(^PS(51.1,"B",ZSCHED(GGG),WW)) Q:'WW!($G(SGLFLAG))  I $P($G(^PS(51.1,WW,0)),"^",8)'="" S SCHED(GGG)=$P($G(^(0)),"^",8),SGLFLAG=1
"RTN","PSOHLPII",34,0)
 ;.Q:$G(SGLFLAG)
"RTN","PSOHLPII",35,0)
 ;.I $G(^PS(51,"A",ZSCHED(GGG)))'="" S SCHED(GGG)=$P(^(ZSCHED(GGG)),"^") Q
"RTN","PSOHLPII",36,0)
 ;.S ZZSB=0 F ZZS=1:1:$L(ZSCHED(GGG)) S SZZ=$E(ZSCHED(GGG),ZZS) I SZZ=" " S ZZSB=ZZSB+1
"RTN","PSOHLPII",37,0)
 ;.S ZZSB=ZZSB+1
"RTN","PSOHLPII",38,0)
 ;.K SCHHOLD F GGGZ=1:1:ZZSB S (SDL,SCHHOLD(GGGZ))=$P(ZSCHED(GGG)," ",GGGZ) D
"RTN","PSOHLPII",39,0)
 ;..Q:$G(SDL)=""
"RTN","PSOHLPII",40,0)
 ;..S SGLFLAG=0 F WW=0:0 S WW=$O(^PS(51.1,"B",SDL,WW)) Q:'WW!($G(SGLFLAG))  I $P($G(^PS(51.1,WW,0)),"^",8)'="" S SCHHOLD(GGGZ)=$P($G(^(0)),"^",8),SGLFLAG=1
"RTN","PSOHLPII",41,0)
 ;..Q:$G(SGLFLAG)
"RTN","PSOHLPII",42,0)
 ;..I $G(^PS(51,"A",SDL))'="" S SCHHOLD(GGGZ)=$P(^(SDL),"^")
"RTN","PSOHLPII",43,0)
 ;.S SCHED(GGG)="",SGLFLAG=0 F WW=1:1:ZZSB S SCHED(GGG)=SCHED(GGG)_$S($G(SGLFLAG):" ",1:"")_$G(SCHHOLD(WW)),SGLFLAG=1
"RTN","PSOHLPII",44,0)
 S PREP=""
"RTN","PSOHLPII",45,0)
 F FFF=0:0 S FFF=$O(SIG0(FFF)) Q:'FFF  D
"RTN","PSOHLPII",46,0)
 .K PSOSG1,PSOSG2 D VERB D:$G(PSNOUN(FFF))'=""&('$G(PSOSG1)) SSS
"RTN","PSOHLPII",47,0)
 .D FRAC
"RTN","PSOHLPII",48,0)
 .S SIG2(FFF)=$S(VERB'=""&('$G(PSOSG1)):VERB_" ",1:"")_$S($G(PSOFX("DOSE ORDERED",FFF))'="":$S($G(PSOFRAC)'="":$G(PSOFRAC),1:$G(PSOFX("DOSE ORDERED",FFF)))_" ",1:$G(PSOFX("DOSE",FFF))_" ")
"RTN","PSOHLPII",49,0)
 .K PSOFRAC,PSOFRACX
"RTN","PSOHLPII",50,0)
 .S SIG2(FFF)=SIG2(FFF)_$S($G(PSNOUN(FFF))'=""&('$G(PSOSG2)):$G(PSNOUN(FFF))_" ",1:"")_$S(PREP'=""&($G(MEDEXP(FFF))):PREP_" ",1:"")
"RTN","PSOHLPII",51,0)
 .S SIG2(FFF)=SIG2(FFF)_$S(PSOROUTE(FFF)'="":PSOROUTE(FFF)_" ",1:"")
"RTN","PSOHLPII",52,0)
 .;S SIG2(FFF)=SIG2(FFF)_$S(SCHED(FFF)'="":SCHED(FFF)_" ",1:"")_$S(PSDUR(FFF)'="NULL":PSDUR(FFF)_" ",1:"")_$S($G(PSOFX("CONJUNCTION",FFF))="A":"AND",$G(PSOFX("CONJUNCTION",FFF))="T":"THEN",$G(PSOFX("CONJUNCTION",FFF))="S":"THEN",1:"")
"RTN","PSOHLPII",53,0)
 .S SIG2(FFF)=SIG2(FFF)_$S(ZSCHED(FFF)'="":ZSCHED(FFF)_$S($G(PSDUR(FFF))="NULL"&($G(PSOFX("CONJUNCTION",FFF))="")&('$O(SIG0(FFF))):"",1:" "),1:"")
"RTN","PSOHLPII",54,0)
 .S PSOCJI=$G(PSOFX("CONJUNCTION",FFF))
"RTN","PSOHLPII",55,0)
 .S SIG2(FFF)=SIG2(FFF)_$S(PSDUR(FFF)'="NULL":PSDUR(FFF)_$S($G(PSOFX("CONJUNCTION",FFF))=""&('$O(SIG0(FFF))):"",1:", "),1:"")_$S($G(PSOCJI)="A":"AND",$G(PSOCJI)="T":"THEN",$G(PSOCJI)="S":"THEN",$G(PSOCJI)="X":"EXCEPT",1:"")
"RTN","PSOHLPII",56,0)
 .K PSOSG1,PSOSG2
"RTN","PSOHLPII",57,0)
 .K PSOUCS S SIG2(FFF)=$$UPPER(SIG2(FFF)) K PSOUCS
"RTN","PSOHLPII",58,0)
 ;I $G(PSOFX("INS"))'="" S TODOSE=TODOSE+1,SIG2(TODOSE)=$G(PSOFX("INS"))
"RTN","PSOHLPII",59,0)
STUFF ;
"RTN","PSOHLPII",60,0)
 S DCOUNT=0
"RTN","PSOHLPII",61,0)
 I '$D(SIG2(1)) G QUIT
"RTN","PSOHLPII",62,0)
 ;I '$O(SIG2(1)),$L(SIG2(1))<71 S ^PS(52.41,PENDING,"SIG",0)="^52.4124A^"_1_"^"_1 S ^PS(52.41,PENDING,"SIG",1,0)=SIG2(1) G QUIT
"RTN","PSOHLPII",63,0)
 S (VAR,VAR1)="",II=1
"RTN","PSOHLPII",64,0)
 F FF=0:0 S FF=$O(SIG2(FF)) Q:'FF  S CT=0 F NN=1:1:$L(SIG2(FF)) I $E(SIG2(FF),NN)=" "!($L(SIG2(FF))=NN) S CT=CT+1 D  I $L(VAR)>200 S SIG(II)=LIM_" ",II=II+1,VAR=VAR1
"RTN","PSOHLPII",65,0)
 .S VAR1=$P(SIG2(FF)," ",(CT))
"RTN","PSOHLPII",66,0)
 .S LIM=VAR
"RTN","PSOHLPII",67,0)
 .S VAR=$S(VAR="":VAR1,1:VAR_" "_VAR1)
"RTN","PSOHLPII",68,0)
 I $G(VAR)'="" S SIG(II)=VAR
"RTN","PSOHLPII",69,0)
 F II=0:0 S II=$O(SIG(II)) Q:'II  S DCOUNT=DCOUNT+1 S ^PS(52.41,PENDING,2,DCOUNT,0)=$$UNESC^ORHLESC(SIG(II))
"RTN","PSOHLPII",70,0)
 I DCOUNT S ^PS(52.41,PENDING,2,0)="^52.419A^"_DCOUNT_"^"_DCOUNT
"RTN","PSOHLPII",71,0)
QUIT K SSS,TT,DCOUNT,PREP,VERB,FFF,GGG,SIGDS,SIGRT,PSOROUTE,PSOSG1,PSOSG2 Q
"RTN","PSOHLPII",72,0)
SIG1 ;
"RTN","PSOHLPII",73,0)
 F FFF=0:0 S FFF=$O(SIG0(FFF)) Q:'FFF  S SIG2(FFF)=SIG0(FFF)
"RTN","PSOHLPII",74,0)
 Q
"RTN","PSOHLPII",75,0)
DAYS I +$E($P(SIG1(TT),"^",2))!($E($P(SIG1(TT),"^",2))=0) S $P(SIG1(TT),"^",2)="D"_$P(SIG1(TT),"^",2)
"RTN","PSOHLPII",76,0)
 Q
"RTN","PSOHLPII",77,0)
NON ;
"RTN","PSOHLPII",78,0)
 I $P($G(SIG0(SSS)),"&",2)'="" S PSNOUN(SSS)=$P($G(SIG0(SSS)),"&",2) Q
"RTN","PSOHLPII",79,0)
 Q
"RTN","PSOHLPII",80,0)
 F NOUN=0:0 S NOUN=$O(^PS(50.606,SIGDS,"NOUN",NOUN)) Q:'NOUN!($G(PSNOUN(SSS))'="")  I $P($G(^PS(50.606,SIGDS,"NOUN",NOUN,0)),"^")'="" S PSNOUN(SSS)=$P(^(0),"^")
"RTN","PSOHLPII",81,0)
 Q
"RTN","PSOHLPII",82,0)
VERB ;Check if verb and noun need to be added to SIG
"RTN","PSOHLPII",83,0)
 K PSOLCS,PSOUCS,PSOISL,PSOVL
"RTN","PSOHLPII",84,0)
 I $G(VERB)'="" S PSOVL=$L(VERB),PSOISL=$E($G(SIG0(FFF)),1,$G(PSOVL)) I $G(PSOISL)'="" D
"RTN","PSOHLPII",85,0)
 .S PSOUCS=VERB
"RTN","PSOHLPII",86,0)
 .S PSOUCS=$$UPPER(PSOUCS) I PSOUCS=PSOISL S PSOSG1=1 Q
"RTN","PSOHLPII",87,0)
 .S PSOUCS=$$LOWER(PSOUCS) I PSOUCS=PSOISL S PSOSG1=1 Q
"RTN","PSOHLPII",88,0)
 .S PSOUCS=$$UPPER($E(PSOUCS,1))_$$LOWER($E(PSOUCS,2,99)) I PSOUCS=PSOISL S PSOSG1=1 Q
"RTN","PSOHLPII",89,0)
 I $G(PSNOUN(FFF))="" G VERBEX
"RTN","PSOHLPII",90,0)
 S PSOISL=$G(SIG0(FFF)) I $G(PSOISL)="" G VERBEX
"RTN","PSOHLPII",91,0)
 S PSOVL=$F(PSNOUN(FFF),"(")
"RTN","PSOHLPII",92,0)
 I $G(PSOVL)>2 S PSOUCS=$E(PSNOUN(FFF),1,(PSOVL-2))
"RTN","PSOHLPII",93,0)
 I $G(PSOVL)'>2 S PSOUCS=PSNOUN(FFF)
"RTN","PSOHLPII",94,0)
 I $G(PSOISL)'="" D
"RTN","PSOHLPII",95,0)
 .S PSOUCS=$$UPPER(PSOUCS) I PSOISL[PSOUCS S PSOSG2=1 Q
"RTN","PSOHLPII",96,0)
 .S PSOUCS=$$LOWER(PSOUCS) I PSOISL[PSOUCS S PSOSG2=1 Q
"RTN","PSOHLPII",97,0)
 .S PSOUCS=$$UPPER($E(PSOUCS,1))_$$LOWER($E(PSOUCS,2,99)) I PSOISL[PSOUCS S PSOSG2=1
"RTN","PSOHLPII",98,0)
VERBEX K PSOLCS,PSOUCS,PSOISL,PSOVL Q
"RTN","PSOHLPII",99,0)
 ;
"RTN","PSOHLPII",100,0)
UPPER(PSOUCS) ;
"RTN","PSOHLPII",101,0)
 Q $TR(PSOUCS,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","PSOHLPII",102,0)
 ;
"RTN","PSOHLPII",103,0)
LOWER(PSOLCS) ;
"RTN","PSOHLPII",104,0)
 Q $TR(PSOLCS,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","PSOHLPII",105,0)
 Q
"RTN","PSOHLPII",106,0)
 ;
"RTN","PSOHLPII",107,0)
SSS ;
"RTN","PSOHLPII",108,0)
 K PSOFNL,PSOFNLF,PSOFNLX
"RTN","PSOHLPII",109,0)
 Q:$G(PSNOUN(FFF))=""
"RTN","PSOHLPII",110,0)
 Q:$L(PSNOUN(FFF))'>3
"RTN","PSOHLPII",111,0)
 Q:'$G(PSOFX("DOSE ORDERED",FFF))
"RTN","PSOHLPII",112,0)
 ;Q:$G(PSOFX("DOSE ORDERED",FFF))>1
"RTN","PSOHLPII",113,0)
 S PSOFNL=$E(PSNOUN(FFF),($L(PSNOUN(FFF))-2),$L(PSNOUN(FFF)))
"RTN","PSOHLPII",114,0)
 I $G(PSOFNL)="(S)"!($G(PSOFNL)="(s)") D
"RTN","PSOHLPII",115,0)
 .I $G(PSOFX("DOSE ORDERED",FFF))'>1 S PSNOUN(FFF)=$E(PSNOUN(FFF),1,($L(PSNOUN(FFF))-3))
"RTN","PSOHLPII",116,0)
 .I $G(PSOFX("DOSE ORDERED",FFF))>1 S PSNOUN(FFF)=$E(PSNOUN(FFF),1,($L(PSNOUN(FFF))-3))_$E(PSOFNL,2)
"RTN","PSOHLPII",117,0)
 Q
"RTN","PSOHLPII",118,0)
FRAC ;
"RTN","PSOHLPII",119,0)
 K PSOFRAC,PSOFRACX,PSOFRAC1,PSOFRAC2
"RTN","PSOHLPII",120,0)
 I $G(PSOFX("DOSE ORDERED",FFF))="" Q
"RTN","PSOHLPII",121,0)
 I $G(PSOFX("DOSE ORDERED",FFF))'["." S (PSOFRAC1,PSOFRAC)=$G(PSOFX("DOSE ORDERED",FFF)) D NUM D  G FRACQ
"RTN","PSOHLPII",122,0)
 .I $G(PSOFRAC1)=$G(PSOFRAC) K PSOFRAC,PSOFRAC1 Q
"RTN","PSOHLPII",123,0)
 .S PSOFRAC=$G(PSOFRAC1)
"RTN","PSOHLPII",124,0)
 S PSOFRAC1=$P(PSOFX("DOSE ORDERED",FFF),"."),PSOFRAC2=$P(PSOFX("DOSE ORDERED",FFF),".",2)
"RTN","PSOHLPII",125,0)
 S PSOFRACX="."_$G(PSOFRAC2)
"RTN","PSOHLPII",126,0)
 S PSOFRAC=$S(PSOFRACX=".5":"ONE-HALF",PSOFRACX=".25":"ONE-FOURTH",PSOFRACX=".33":"ONE-THIRD",PSOFRACX=".34":"ONE-THIRD",PSOFRACX=".50":"ONE-HALF",PSOFRACX=".66":"TWO-THIRDS",PSOFRACX=".67":"TWO-THIRDS",PSOFRACX=".75":"THREE-FOURTHS",1:"")
"RTN","PSOHLPII",127,0)
 I $G(PSOFRAC)="" K PSOFRAC G FRACQ
"RTN","PSOHLPII",128,0)
 I $G(PSOFRAC1)'="",+$G(PSOFRAC1) D NUM S PSOFRAC=$G(PSOFRAC1)_" AND "_$G(PSOFRAC)
"RTN","PSOHLPII",129,0)
FRACQ K PSOFRAC1,PSOFRAC2
"RTN","PSOHLPII",130,0)
 Q
"RTN","PSOHLPII",131,0)
NUM ;
"RTN","PSOHLPII",132,0)
 Q:$G(PSOFRAC1)=""
"RTN","PSOHLPII",133,0)
 S PSOFRAC1=$S(PSOFRAC1="1":"ONE",PSOFRAC1="2":"TWO",PSOFRAC1="3":"THREE",PSOFRAC1="4":"FOUR",PSOFRAC1="5":"FIVE",PSOFRAC1="6":"SIX",PSOFRAC1="7":"SEVEN",PSOFRAC1="8":"EIGHT",PSOFRAC1="9":"NINE",PSOFRAC1="10":"TEN",1:PSOFRAC1)
"RTN","PSOHLPII",134,0)
 Q
"RTN","PSOHLPIS")
0^32^B64280169
"RTN","PSOHLPIS",1,0)
PSOHLPIS ;BIR/RTR-Parse out and create CPRS Sig ;7/21/96
"RTN","PSOHLPIS",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**46,225**;DEC 1997;Build 29
"RTN","PSOHLPIS",3,0)
 ;External reference to File #50.7 supported by DBIA 2223
"RTN","PSOHLPIS",4,0)
 ;External reference to File #51 supported by DBIA 2224
"RTN","PSOHLPIS",5,0)
 ;External reference to File #51.1 supported by DBIA 2225
"RTN","PSOHLPIS",6,0)
 ;External reference to File #51.2 supported by DBIA 2226
"RTN","PSOHLPIS",7,0)
 ;External reference to File #50.606 supported by DBIA 2174
"RTN","PSOHLPIS",8,0)
EN ;
"RTN","PSOHLPIS",9,0)
 Q:'$D(^PS(52.41,PENDING,1,0))
"RTN","PSOHLPIS",10,0)
 N PISI,PSOFX,SDF,SZZ,ZZS,ZZSB,SSZZ,SCHHOLD,GGGZ,SGLFLAG,SGLOOP,ZSCHED,SPFG,PSNOUN,MEDEXP,PSDUR,NOUN,SCHED,INTERVAL,SIG0,SIG2,SIG3,SDL,WW,TODOSE,PDAYS,WWFL,PSOCJS,PSOFDCT,PSODCT
"RTN","PSOHLPIS",11,0)
 N SSS,TT,DCOUNT,PREP,VERB,FFF,GGG,SIGDS,SIGRT,PSOROUTE,PSOSG1,PSOSG2,FTC,FTCA,FTCF,FTCNT
"RTN","PSOHLPIS",12,0)
 N SIG
"RTN","PSOHLPIS",13,0)
 F PISI=0:0 S PISI=$O(^PS(52.41,PENDING,1,PISI)) Q:'PISI  D:$D(^(PISI,0))
"RTN","PSOHLPIS",14,0)
 .S PSOFX("DOSE",PISI)=$P($G(^PS(52.41,PENDING,1,PISI,2)),"^") I $P($G(^(2)),"^",2)'="" S PSOFX("DOSE ORDERED",PISI)=$P($G(^(2)),"^",2)
"RTN","PSOHLPIS",15,0)
 .S PSOFX("SCHEDULE",PISI)=$P($G(^PS(52.41,PENDING,1,PISI,1)),"^"),PSOFX("ROUTE",PISI)=$P($G(^(1)),"^",8),PSOFX("DURATION",PISI)=$P($G(^(1)),"^",2),PSOFX("NOUN",PISI)=$P($G(^(1)),"^",5),PSOFX("CONJUNCTION",PISI)=$P($G(^(1)),"^",6)
"RTN","PSOHLPIS",16,0)
 .I $G(PSOFX("DURATION",PISI)) S PSOFX("DURATION",PISI)="D"_$G(PSOFX("DURATION",PISI))
"RTN","PSOHLPIS",17,0)
 .I $G(PSOFX("DURATION",PISI))'="" S PSOFX("DURATION",PISI)=$E(PSOFX("DURATION",PISI),2,999)_$E(PSOFX("DURATION",PISI))
"RTN","PSOHLPIS",18,0)
 S TODOSE=0 F WW=0:0 S WW=$O(PSOFX("DOSE",WW)) Q:'WW  S TODOSE=WW
"RTN","PSOHLPIS",19,0)
 Q:'TODOSE
"RTN","PSOHLPIS",20,0)
 S SIGDS=+$P($G(^PS(50.7,+$G(PSORDITE),0)),"^",2),VERB=$P($G(^PS(50.606,SIGDS,"MISC")),"^"),PREP=$P($G(^("MISC")),"^",3)
"RTN","PSOHLPIS",21,0)
 S FTCNT=0 K FTC,FTCA,FTCF F SSS=1:1:TODOSE D
"RTN","PSOHLPIS",22,0)
 .S SIG0(SSS)=$S($G(PSOFX("DOSE ORDERED",SSS))'="":$G(PSOFX("DOSE ORDERED",SSS)),1:$G(PSOFX("DOSE",SSS)))
"RTN","PSOHLPIS",23,0)
 .S PSNOUN(SSS)=$G(PSOFX("NOUN",SSS))
"RTN","PSOHLPIS",24,0)
 .S FTC=+$G(PSOFX("ROUTE",SSS)) I FTC S:'FTCNT FTCA=FTC S FTCNT=FTCNT+1
"RTN","PSOHLPIS",25,0)
 .I FTCNT>1,$G(FTC),$G(FTC)'=$G(FTCA) S FTCF=1
"RTN","PSOHLPIS",26,0)
 .S PSOROUTE(SSS)=$S($P($G(^PS(51.2,+$G(PSOFX("ROUTE",SSS)),0)),"^",2)'="":$P(^(0),"^",2),$P($G(^(0)),"^",3)'="":$P(^(0),"^",3),1:$P($G(^(0)),"^")) S MEDEXP(SSS)=$S($P($G(^PS(51.2,+$G(PSOFX("ROUTE",SSS)),0)),"^",2)="":0,1:1)
"RTN","PSOHLPIS",27,0)
 .S PDAYS(SSS)=$G(PSOFX("DURATION",SSS))
"RTN","PSOHLPIS",28,0)
 .I $G(PSOFX("DURATION",SSS))'="",($E(PSOFX("DURATION",SSS),$L(PSOFX("DURATION",SSS)))'?1A) S PDAYS(SSS)=PDAYS(SSS)_"D"
"RTN","PSOHLPIS",29,0)
 .S PSDUR(SSS)=$S($G(PDAYS(SSS))="":"NULL",1:"FOR "_$E($G(PDAYS(SSS)),1,($L($G(PDAYS(SSS)))-1))) D  I PSDUR(SSS)'="NULL" S PSDUR(SSS)=PSDUR(SSS)_" "_INTERVAL
"RTN","PSOHLPIS",30,0)
 ..I PSDUR(SSS)'="NULL" S INTERVAL=$E(PDAYS(SSS),$L(PDAYS(SSS))),INTERVAL=$S(INTERVAL="D":"DAYS",INTERVAL="W":"WEEKS",INTERVAL="H":"HOURS",INTERVAL="L":"MONTHS",INTERVAL="M":"MINUTES",INTERVAL="S":"SECONDS",1:"") D
"RTN","PSOHLPIS",31,0)
 ...I $G(INTERVAL)'="",$G(PSOFX("DURATION",SSS)),$G(PSOFX("DURATION",SSS))'>1 S INTERVAL=$E(INTERVAL,1,($L(INTERVAL)-1))
"RTN","PSOHLPIS",32,0)
 F GGG=1:1:TODOSE S ZSCHED(GGG)=$G(PSOFX("SCHEDULE",GGG)) D
"RTN","PSOHLPIS",33,0)
 .I $G(ZSCHED(GGG))="" S SCHED(GGG)="" Q
"RTN","PSOHLPIS",34,0)
 .S SGLFLAG=0 F WW=0:0 S WW=$O(^PS(51.1,"B",ZSCHED(GGG),WW)) Q:'WW!($G(SGLFLAG))  I $P($G(^PS(51.1,WW,0)),"^",8)'="" S SCHED(GGG)=$P($G(^(0)),"^",8),SGLFLAG=1
"RTN","PSOHLPIS",35,0)
 .Q:$G(SGLFLAG)
"RTN","PSOHLPIS",36,0)
 .I $G(^PS(51,"A",ZSCHED(GGG)))'="" S SCHED(GGG)=$P(^(ZSCHED(GGG)),"^") Q
"RTN","PSOHLPIS",37,0)
 .S ZZSB=0 F ZZS=1:1:$L(ZSCHED(GGG)) S SZZ=$E(ZSCHED(GGG),ZZS) I SZZ=" " S ZZSB=ZZSB+1
"RTN","PSOHLPIS",38,0)
 .S ZZSB=ZZSB+1
"RTN","PSOHLPIS",39,0)
 .K SCHHOLD F GGGZ=1:1:ZZSB S (SDL,SCHHOLD(GGGZ))=$P(ZSCHED(GGG)," ",GGGZ) D
"RTN","PSOHLPIS",40,0)
 ..Q:$G(SDL)=""
"RTN","PSOHLPIS",41,0)
 ..S SGLFLAG=0 F WW=0:0 S WW=$O(^PS(51.1,"B",SDL,WW)) Q:'WW!($G(SGLFLAG))  I $P($G(^PS(51.1,WW,0)),"^",8)'="" S SCHHOLD(GGGZ)=$P($G(^(0)),"^",8),SGLFLAG=1
"RTN","PSOHLPIS",42,0)
 ..Q:$G(SGLFLAG)
"RTN","PSOHLPIS",43,0)
 ..I $G(^PS(51,"A",SDL))'="" S SCHHOLD(GGGZ)=$P(^(SDL),"^")
"RTN","PSOHLPIS",44,0)
 .S SCHED(GGG)="",SGLFLAG=0 F WW=1:1:ZZSB S SCHED(GGG)=SCHED(GGG)_$S($G(SGLFLAG):" ",1:"")_$G(SCHHOLD(WW)),SGLFLAG=1
"RTN","PSOHLPIS",45,0)
 S (FTC,FTCA,PSOFDCT)=0 F FFF=0:0 S FFF=$O(SIG0(FFF)) Q:'FFF  D
"RTN","PSOHLPIS",46,0)
 .K PSOSG1,PSOSG2 D VERB D:$G(PSNOUN(FFF))'=""&('$G(PSOSG1)) SSS
"RTN","PSOHLPIS",47,0)
 .D FRAC
"RTN","PSOHLPIS",48,0)
 .S SIG2(FFF)=$S(VERB'=""&('$G(PSOSG1)):VERB_" ",1:"")_$S($G(PSOFX("DOSE ORDERED",FFF))'="":$S($G(PSOFRAC)'="":$G(PSOFRAC),1:$G(PSOFX("DOSE ORDERED",FFF)))_" ",1:$G(PSOFX("DOSE",FFF))_" ")
"RTN","PSOHLPIS",49,0)
 .S PSOFDCT=PSOFDCT+1
"RTN","PSOHLPIS",50,0)
 .K PSOFRAC,PSOFRACX
"RTN","PSOHLPIS",51,0)
 .I FTC>0,$G(PSOROUTE(FFF))'="",'$G(FTCF) S FTCA=1
"RTN","PSOHLPIS",52,0)
 .I $G(PSOROUTE(FFF))'="" S FTC=FTC+1
"RTN","PSOHLPIS",53,0)
 .S SIG2(FFF)=SIG2(FFF)_$S($G(PSNOUN(FFF))'=""&('$G(PSOSG2)):$G(PSNOUN(FFF))_" ",1:"")_$S(PREP'=""&($G(MEDEXP(FFF)))&('FTCA):PREP_" ",1:"")
"RTN","PSOHLPIS",54,0)
 .S SIG2(FFF)=SIG2(FFF)_$S(PSOROUTE(FFF)'=""&('FTCA):PSOROUTE(FFF)_" ",1:"")
"RTN","PSOHLPIS",55,0)
 .;S SIG2(FFF)=SIG2(FFF)_$S(SCHED(FFF)'="":SCHED(FFF)_" ",1:"")_$S(PSDUR(FFF)'="NULL":PSDUR(FFF)_" ",1:"")_$S($G(PSOFX("CONJUNCTION",FFF))="A":"AND",$G(PSOFX("CONJUNCTION",FFF))="T":"THEN",$G(PSOFX("CONJUNCTION",FFF))="S":"THEN",1:"")
"RTN","PSOHLPIS",56,0)
 .S SIG2(FFF)=SIG2(FFF)_$S(SCHED(FFF)'="":SCHED(FFF)_$S($G(PSDUR(FFF))="NULL"&($G(PSOFX("CONJUNCTION",FFF))="")&('$O(SIG0(FFF))):"",1:" "),1:"")
"RTN","PSOHLPIS",57,0)
 .S PSOCJS=$G(PSOFX("CONJUNCTION",FFF))
"RTN","PSOHLPIS",58,0)
 .S SIG2(FFF)=SIG2(FFF)_$S(PSDUR(FFF)'="NULL":PSDUR(FFF)_$S($G(PSOFX("CONJUNCTION",FFF))=""&('$O(SIG0(FFF))):"",1:", "),1:"")_$S($G(PSOCJS)="A":"AND",$G(PSOCJS)="T":"THEN",$G(PSOCJS)="S":"THEN",$G(PSOCJS)="X":"EXCEPT",1:"")
"RTN","PSOHLPIS",59,0)
 .K PSOSG1,PSOSG2
"RTN","PSOHLPIS",60,0)
 .K PSOUCS S SIG2(FFF)=$$UPPER(SIG2(FFF)) K PSOUCS
"RTN","PSOHLPIS",61,0)
 ;I $G(PSOFX("INS"))'="" S TODOSE=TODOSE+1,SIG2(TODOSE)=$G(PSOFX("INS"))
"RTN","PSOHLPIS",62,0)
 S PSODCT="" F  S PSODCT=$O(^PS(52.41,PENDING,"INS1",PSODCT)) Q:PSODCT=""  I $D(^(PSODCT,0)) S PSOFDCT=PSOFDCT+1 S SIG2(PSOFDCT)=$G(^(0)) K PSOUCS S SIG2(PSOFDCT)=$$UPPER(SIG2(PSOFDCT)) K PSOUCS
"RTN","PSOHLPIS",63,0)
STUFF ;
"RTN","PSOHLPIS",64,0)
 S DCOUNT=0
"RTN","PSOHLPIS",65,0)
 I '$D(SIG2(1)) G QUIT
"RTN","PSOHLPIS",66,0)
 I '$O(SIG2(1)),$L(SIG2(1))<71 S ^PS(52.41,PENDING,"SIG",0)="^52.4124A^"_1_"^"_1 S ^PS(52.41,PENDING,"SIG",1,0)=$$UNESC^ORHLESC(SIG2(1)) S DCOUNT=1 G QUITIN
"RTN","PSOHLPIS",67,0)
 S (VAR,VAR1)="",II=1
"RTN","PSOHLPIS",68,0)
 F FF=0:0 S FF=$O(SIG2(FF)) Q:'FF  S CT=0 F NN=1:1:$L(SIG2(FF)) I $E(SIG2(FF),NN)=" "!($L(SIG2(FF))=NN) S CT=CT+1 D  I $L(VAR)>70 S SIG(II)=LIM_" ",II=II+1,VAR=VAR1
"RTN","PSOHLPIS",69,0)
 .S VAR1=$P(SIG2(FF)," ",(CT))
"RTN","PSOHLPIS",70,0)
 .S LIM=VAR
"RTN","PSOHLPIS",71,0)
 .S VAR=$S(VAR="":VAR1,1:VAR_" "_VAR1)
"RTN","PSOHLPIS",72,0)
 I $G(VAR)'="" S SIG(II)=VAR
"RTN","PSOHLPIS",73,0)
 F II=0:0 S II=$O(SIG(II)) Q:'II  S DCOUNT=DCOUNT+1 S ^PS(52.41,PENDING,"SIG",DCOUNT,0)=$$UNESC^ORHLESC(SIG(II))
"RTN","PSOHLPIS",74,0)
 I DCOUNT S ^PS(52.41,PENDING,"SIG",0)="^52.4124A^"_DCOUNT_"^"_DCOUNT
"RTN","PSOHLPIS",75,0)
QUITIN ;I $P($G(^PS(50.7,+$G(PSORDITE),"INS")),"^")'="",DCOUNT S DCOUNT=DCOUNT+1,^PS(52.41,PENDING,"SIG",0)="^52.4124A^"_DCOUNT_"^"_DCOUNT,^PS(52.41,PENDING,"SIG",DCOUNT,0)=$P($G(^PS(50.7,+$G(PSORDITE),"INS")),"^")
"RTN","PSOHLPIS",76,0)
 ;I $P($G(^PS(50.7,+$G(PSORDITE),"INS")),"^")'="" S $P(^PS(52.41,PENDING,"INS"),"^")=$P(^PS(50.7,+$G(PSORDITE),"INS"),"^")
"RTN","PSOHLPIS",77,0)
QUIT K SSS,TT,DCOUNT,PREP,VERB,FFF,GGG,SIGDS,SIGRT,PSOROUTE,PSOSG1,PSOSG2 Q
"RTN","PSOHLPIS",78,0)
SIG1 ;
"RTN","PSOHLPIS",79,0)
 F FFF=0:0 S FFF=$O(SIG0(FFF)) Q:'FFF  S SIG2(FFF)=SIG0(FFF)
"RTN","PSOHLPIS",80,0)
 Q
"RTN","PSOHLPIS",81,0)
DAYS I +$E($P(SIG1(TT),"^",2))!($E($P(SIG1(TT),"^",2))=0) S $P(SIG1(TT),"^",2)="D"_$P(SIG1(TT),"^",2)
"RTN","PSOHLPIS",82,0)
 Q
"RTN","PSOHLPIS",83,0)
NON ;
"RTN","PSOHLPIS",84,0)
 I $P($G(SIG0(SSS)),"&",2)'="" S PSNOUN(SSS)=$P($G(SIG0(SSS)),"&",2) Q
"RTN","PSOHLPIS",85,0)
 Q
"RTN","PSOHLPIS",86,0)
 F NOUN=0:0 S NOUN=$O(^PS(50.606,SIGDS,"NOUN",NOUN)) Q:'NOUN!($G(PSNOUN(SSS))'="")  I $P($G(^PS(50.606,SIGDS,"NOUN",NOUN,0)),"^")'="" S PSNOUN(SSS)=$P(^(0),"^")
"RTN","PSOHLPIS",87,0)
 Q
"RTN","PSOHLPIS",88,0)
VERB ;Check if verb and noun need to be added to SIG
"RTN","PSOHLPIS",89,0)
 K PSOLCS,PSOUCS,PSOISL,PSOVL
"RTN","PSOHLPIS",90,0)
 I $G(VERB)'="" S PSOVL=$L(VERB),PSOISL=$E($G(SIG0(FFF)),1,$G(PSOVL)) I $G(PSOISL)'="" D
"RTN","PSOHLPIS",91,0)
 .S PSOUCS=VERB
"RTN","PSOHLPIS",92,0)
 .S PSOUCS=$$UPPER(PSOUCS) I PSOUCS=PSOISL S PSOSG1=1 Q
"RTN","PSOHLPIS",93,0)
 .S PSOUCS=$$LOWER(PSOUCS) I PSOUCS=PSOISL S PSOSG1=1 Q
"RTN","PSOHLPIS",94,0)
 .S PSOUCS=$$UPPER($E(PSOUCS,1))_$$LOWER($E(PSOUCS,2,99)) I PSOUCS=PSOISL S PSOSG1=1 Q
"RTN","PSOHLPIS",95,0)
 I $G(PSNOUN(FFF))="" G VERBEX
"RTN","PSOHLPIS",96,0)
 S PSOISL=$G(SIG0(FFF)) I $G(PSOISL)="" G VERBEX
"RTN","PSOHLPIS",97,0)
 S PSOVL=$F(PSNOUN(FFF),"(")
"RTN","PSOHLPIS",98,0)
 I $G(PSOVL)>2 S PSOUCS=$E(PSNOUN(FFF),1,(PSOVL-2))
"RTN","PSOHLPIS",99,0)
 I $G(PSOVL)'>2 S PSOUCS=PSNOUN(FFF)
"RTN","PSOHLPIS",100,0)
 I $G(PSOISL)'="" D
"RTN","PSOHLPIS",101,0)
 .S PSOUCS=$$UPPER(PSOUCS) I PSOISL[PSOUCS S PSOSG2=1 Q
"RTN","PSOHLPIS",102,0)
 .S PSOUCS=$$LOWER(PSOUCS) I PSOISL[PSOUCS S PSOSG2=1 Q
"RTN","PSOHLPIS",103,0)
 .S PSOUCS=$$UPPER($E(PSOUCS,1))_$$LOWER($E(PSOUCS,2,99)) I PSOISL[PSOUCS S PSOSG2=1
"RTN","PSOHLPIS",104,0)
VERBEX K PSOLCS,PSOUCS,PSOISL,PSOVL Q
"RTN","PSOHLPIS",105,0)
 ;
"RTN","PSOHLPIS",106,0)
UPPER(PSOUCS) ;
"RTN","PSOHLPIS",107,0)
 Q $TR(PSOUCS,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","PSOHLPIS",108,0)
 ;
"RTN","PSOHLPIS",109,0)
LOWER(PSOLCS) ;
"RTN","PSOHLPIS",110,0)
 Q $TR(PSOLCS,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","PSOHLPIS",111,0)
 Q
"RTN","PSOHLPIS",112,0)
 ;
"RTN","PSOHLPIS",113,0)
SSS ;
"RTN","PSOHLPIS",114,0)
 K PSOFNL,PSOFNLF,PSOFNLX
"RTN","PSOHLPIS",115,0)
 Q:$G(PSNOUN(FFF))=""
"RTN","PSOHLPIS",116,0)
 Q:$L(PSNOUN(FFF))'>3
"RTN","PSOHLPIS",117,0)
 Q:'$G(PSOFX("DOSE ORDERED",FFF))
"RTN","PSOHLPIS",118,0)
 ;Q:$G(PSOFX("DOSE ORDERED",FFF))>1
"RTN","PSOHLPIS",119,0)
 S PSOFNL=$E(PSNOUN(FFF),($L(PSNOUN(FFF))-2),$L(PSNOUN(FFF)))
"RTN","PSOHLPIS",120,0)
 I $G(PSOFNL)="(S)"!($G(PSOFNL)="(s)") D
"RTN","PSOHLPIS",121,0)
 .I $G(PSOFX("DOSE ORDERED",FFF))'>1 S PSNOUN(FFF)=$E(PSNOUN(FFF),1,($L(PSNOUN(FFF))-3))
"RTN","PSOHLPIS",122,0)
 .I $G(PSOFX("DOSE ORDERED",FFF))>1 S PSNOUN(FFF)=$E(PSNOUN(FFF),1,($L(PSNOUN(FFF))-3))_$E(PSOFNL,2)
"RTN","PSOHLPIS",123,0)
 Q
"RTN","PSOHLPIS",124,0)
FRAC ;
"RTN","PSOHLPIS",125,0)
 K PSOFRAC,PSOFRACX,PSOFRAC1,PSOFRAC2
"RTN","PSOHLPIS",126,0)
 I $G(PSOFX("DOSE ORDERED",FFF))="" Q
"RTN","PSOHLPIS",127,0)
 I $G(PSOFX("DOSE ORDERED",FFF))'["." S (PSOFRAC1,PSOFRAC)=$G(PSOFX("DOSE ORDERED",FFF)) D NUM D  G FRACQ
"RTN","PSOHLPIS",128,0)
 .I $G(PSOFRAC1)=$G(PSOFRAC) K PSOFRAC,PSOFRAC1 Q
"RTN","PSOHLPIS",129,0)
 .S PSOFRAC=$G(PSOFRAC1)
"RTN","PSOHLPIS",130,0)
 S PSOFRAC1=$P(PSOFX("DOSE ORDERED",FFF),"."),PSOFRAC2=$P(PSOFX("DOSE ORDERED",FFF),".",2)
"RTN","PSOHLPIS",131,0)
 S PSOFRACX="."_$G(PSOFRAC2)
"RTN","PSOHLPIS",132,0)
 S PSOFRAC=$S(PSOFRACX=".5":"ONE-HALF",PSOFRACX=".25":"ONE-FOURTH",PSOFRACX=".33":"ONE-THIRD",PSOFRACX=".34":"ONE-THIRD",PSOFRACX=".50":"ONE-HALF",PSOFRACX=".66":"TWO-THIRDS",PSOFRACX=".67":"TWO-THIRDS",PSOFRACX=".75":"THREE-FOURTHS",1:"")
"RTN","PSOHLPIS",133,0)
 I $G(PSOFRAC)="" K PSOFRAC G FRACQ
"RTN","PSOHLPIS",134,0)
 I $G(PSOFRAC1)'="",+$G(PSOFRAC1) D NUM S PSOFRAC=$G(PSOFRAC1)_" AND "_$G(PSOFRAC)
"RTN","PSOHLPIS",135,0)
FRACQ K PSOFRAC1,PSOFRAC2
"RTN","PSOHLPIS",136,0)
 Q
"RTN","PSOHLPIS",137,0)
NUM ;
"RTN","PSOHLPIS",138,0)
 Q:$G(PSOFRAC1)=""
"RTN","PSOHLPIS",139,0)
 S PSOFRAC1=$S(PSOFRAC1="1":"ONE",PSOFRAC1="2":"TWO",PSOFRAC1="3":"THREE",PSOFRAC1="4":"FOUR",PSOFRAC1="5":"FIVE",PSOFRAC1="6":"SIX",PSOFRAC1="7":"SEVEN",PSOFRAC1="8":"EIGHT",PSOFRAC1="9":"NINE",PSOFRAC1="10":"TEN",1:PSOFRAC1)
"RTN","PSOHLPIS",140,0)
 Q
"RTN","PSOHLSN1")
0^29^B71972158
"RTN","PSOHLSN1",1,0)
PSOHLSN1 ;BIR/RTR - Send order info to OERR from file 52 ;10/10/94
"RTN","PSOHLSN1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,10,24,27,55,46,71,101,99,121,139,157,181,143,235,239,292,225**;DEC 1997;Build 29
"RTN","PSOHLSN1",3,0)
 ;Ref #50.606-DBIA 2174
"RTN","PSOHLSN1",4,0)
 ;#50.607-2221
"RTN","PSOHLSN1",5,0)
 ;#50.7-2223
"RTN","PSOHLSN1",6,0)
 ;#51.2-2226
"RTN","PSOHLSN1",7,0)
 ;#50-221
"RTN","PSOHLSN1",8,0)
 ;PSNDF-2195
"RTN","PSOHLSN1",9,0)
 ;EN^PSSUTIL1-3179
"RTN","PSOHLSN1",10,0)
 ;
"RTN","PSOHLSN1",11,0)
EN(PSRXIEN,STAT,PSSTAT,COMM,PSNOO) ;
"RTN","PSOHLSN1",12,0)
 N COUNT,DFN,J,LIMIT,NAME,NULLFLDS,PSDIEN,PSFLAG,PSND1,PSND2,PSND3,PRODUCT,UNIT,POIPTR,PSOHINST,PODOSE,PODOSENM,PSROUTE,RTNAME,SEGMENT,CCC,BBB,CSCOUNT,PPTR,MSG,PSOHSTRT,PSOHSTOP,PSOHISSD,PSORTLP,ZRXFLAG,RXE2FLAG,RXE2ONLY,PSODFN,EDUZ
"RTN","PSOHLSN1",13,0)
 N PSOCDDUZ,DA,FSIG,BSIG,PSHRX,PSHORX,PSNOOTX,ZPRE,PSOZSTAT,CCCX,PSOCPS,PSOICD
"RTN","PSOHLSN1",14,0)
 K FIELD
"RTN","PSOHLSN1",15,0)
 I $G(STAT)="" Q
"RTN","PSOHLSN1",16,0)
 I STAT="CR"!(STAT="DR")!(STAT="HR")!(STAT="OC")!(STAT="OD")!(STAT="OH")!(STAT="Z@")!(STAT="RP") S PSOZSTAT=STAT D DELP^PSOHLSN S STAT=PSOZSTAT G SKIP
"RTN","PSOHLSN1",17,0)
 I STAT="SC" I $G(PSSTAT)="ZE"!($G(PSSTAT)="HD")!($G(PSSTAT)="DC") S PSOZSTAT=STAT D DELP^PSOHLSN S STAT=PSOZSTAT
"RTN","PSOHLSN1",18,0)
SKIP ;
"RTN","PSOHLSN1",19,0)
 I $G(STAT)="SC",$G(PSSTAT)="ZE",$P($G(^PSRX(+$G(PSRXIEN),0)),"^",19)=2 Q
"RTN","PSOHLSN1",20,0)
 I $G(STAT)="RP" S STAT="OD",PSSTAT="RP"
"RTN","PSOHLSN1",21,0)
 S COUNT=0,NULLFLDS="F JJ=0:1:LIMIT S FIELD(JJ)="""""
"RTN","PSOHLSN1",22,0)
 I '$D(^PSRX(PSRXIEN,0)) Q
"RTN","PSOHLSN1",23,0)
 I ($G(STAT)="SC"&($G(PSSTAT)="ZE"))!($G(STAT)="OC")!($G(STAT)="OD") I $D(^PS(52.41,"AQ",PSRXIEN)) D EN^PSOHDR("PRES",PSRXIEN) Q
"RTN","PSOHLSN1",24,0)
 I STAT'="SN",STAT'="ZC",'$P($G(^PSRX(PSRXIEN,"OR1")),"^",2) Q
"RTN","PSOHLSN1",25,0)
 I $G(STAT)="SC",$G(PSSTAT)="ZE" S $P(^PSRX(PSRXIEN,0),"^",19)=2
"RTN","PSOHLSN1",26,0)
 D INIT
"RTN","PSOHLSN1",27,0)
 S COUNT=1,(ZRXFLAG,RXE2FLAG,RXE2ONLY)=0 D PID,PV1,ORC
"RTN","PSOHLSN1",28,0)
 I $G(STAT)="Z@" G NCM
"RTN","PSOHLSN1",29,0)
 I $G(STAT)="OK"!($G(STAT)="SN")!($G(STAT)="ZC")!($G(STAT)="XX")!($G(STAT)="SC")!($G(STAT)="RO") D RXO,RXE,RXR,ZRX,DG1,ZSC,ZCL G NCM
"RTN","PSOHLSN1",30,0)
 I $G(STAT)="SC",$G(PSSTAT)="CM" D RXO,RXE,RXR,ZRX,DG1,ZSC,ZCL
"RTN","PSOHLSN1",31,0)
 I '$G(RXE2FLAG) S RXE2ONLY=1 D RXE,SEGPARX^PSOHLSN
"RTN","PSOHLSN1",32,0)
 I '$G(ZRXFLAG) D ZRX
"RTN","PSOHLSN1",33,0)
NCM D SEND
"RTN","PSOHLSN1",34,0)
 K PSRXIEN Q
"RTN","PSOHLSN1",35,0)
INIT K ^UTILITY("DIQ1",$J),DIQ S DA=$P($$SITE^VASITE(),"^") I $G(DA) S DIC=4,DIQ(0)="I",DR="99" D EN^DIQ1 S PSOHINST=$G(^UTILITY("DIQ1",$J,4,DA,99,"I")) K ^UTILITY("DIQ1",$J),DA,DR,DIQ,DIC
"RTN","PSOHLSN1",36,0)
 S MSG(1)="MSH|^~\&|PHARMACY|"_$G(PSOHINST)_"|||||"_$S($G(PSOMSORR):"ORR",1:"ORM")
"RTN","PSOHLSN1",37,0)
 Q
"RTN","PSOHLSN1",38,0)
PID S LIMIT=5 X NULLFLDS
"RTN","PSOHLSN1",39,0)
 S DFN=+$P(^PSRX(PSRXIEN,0),"^",2) D DEM^VADPT S NAME=$G(VADM(1)) K VADM
"RTN","PSOHLSN1",40,0)
 S FIELD(0)="PID"
"RTN","PSOHLSN1",41,0)
 S FIELD(3)=DFN
"RTN","PSOHLSN1",42,0)
 S FIELD(5)=NAME
"RTN","PSOHLSN1",43,0)
 D SEG Q
"RTN","PSOHLSN1",44,0)
DG1 D DG1^PSOHLSN2
"RTN","PSOHLSN1",45,0)
 Q
"RTN","PSOHLSN1",46,0)
PV1 ;
"RTN","PSOHLSN1",47,0)
 S LIMIT=19 X NULLFLDS
"RTN","PSOHLSN1",48,0)
 S FIELD(0)="PV1"
"RTN","PSOHLSN1",49,0)
 S FIELD(2)="O"
"RTN","PSOHLSN1",50,0)
 S:$P(^PSRX(PSRXIEN,0),"^",5) FIELD(3)=$P(^(0),"^",5)
"RTN","PSOHLSN1",51,0)
 D SEG Q
"RTN","PSOHLSN1",52,0)
ORC ;
"RTN","PSOHLSN1",53,0)
 D ORC^PSOHLSN3
"RTN","PSOHLSN1",54,0)
 Q
"RTN","PSOHLSN1",55,0)
 ;
"RTN","PSOHLSN1",56,0)
RXO ;
"RTN","PSOHLSN1",57,0)
 S LIMIT=1 X NULLFLDS
"RTN","PSOHLSN1",58,0)
 S FIELD(0)="RXO"
"RTN","PSOHLSN1",59,0)
 S PPTR=+$P($G(^PSRX(PSRXIEN,"OR1")),"^")
"RTN","PSOHLSN1",60,0)
 S FIELD(1)=$S('PPTR:"^^^^^",1:"^^^"_PPTR_"^"_$P($G(^PS(50.7,PPTR,0)),"^")_" "_$P($G(^PS(50.606,+$P($G(^(0)),"^",2),0)),"^")_"^99PSP")
"RTN","PSOHLSN1",61,0)
 D SEG Q
"RTN","PSOHLSN1",62,0)
 ;
"RTN","PSOHLSN1",63,0)
RXE ;
"RTN","PSOHLSN1",64,0)
 S RXE2FLAG=1
"RTN","PSOHLSN1",65,0)
 S LIMIT=$S('$G(RXE2ONLY):26,1:2) X NULLFLDS
"RTN","PSOHLSN1",66,0)
 S FIELD(0)="RXE"
"RTN","PSOHLSN1",67,0)
 S (PSOHSTRT,PSOHSTOP)="" S X=$P($G(^PSRX(PSRXIEN,2)),"^",2) I X S PSOHSTRT=$$FMTHL7^XLFDT(X)
"RTN","PSOHLSN1",68,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSOHLSN1",69,0)
 S X=$S($P($G(^PSRX(PSRXIEN,3)),"^",5):$P($G(^(3)),"^",5),$G(STAT)="OD"!($G(STAT)="OC"):$G(DT),$P($G(^(2)),"^",6):$P($G(^(2)),"^",6),1:$G(DT)) I X S PSOHSTOP=$$FMTHL7^XLFDT(X)
"RTN","PSOHLSN1",70,0)
 K X N PSOMZT,MMZZ,MMZZT S MMZZT=1 F MMZZ=0:0 S MMZZ=$O(^PSRX(PSRXIEN,6,MMZZ)) Q:'MMZZ  D:$D(^(MMZZ,0))
"RTN","PSOHLSN1",71,0)
 .S FIELD(1,MMZZT)=$S($P($G(^PSRX(PSRXIEN,6,MMZZ,0)),"^",2):$$ESC^ORHLESC($P($G(^(0)),"^"))_"\T\"_$P($G(^PS(50.607,+$P($G(^(0)),"^",3),0)),"^")_"\T\"_$P($G(^PSRX(PSRXIEN,6,MMZZ,0)),"^",2)_"\T\"_$P($G(^(0)),"^",4),1:"")
"RTN","PSOHLSN1",72,0)
 .S FIELD(1,MMZZT)=FIELD(1,MMZZT)_"^"_$$ESC^ORHLESC($P($G(^PSRX(PSRXIEN,6,MMZZ,0)),"^",8))
"RTN","PSOHLSN1",73,0)
 .I $P($G(FIELD(1,MMZZT)),"^")'="" F PSOMZT=1,3 I $E($P(FIELD(1,MMZZT),"\T\",PSOMZT),1)="." S $P(FIELD(1,MMZZT),"\T\",PSOMZT)="0"_$P(FIELD(1,MMZZT),"\T\",PSOMZT)
"RTN","PSOHLSN1",74,0)
 .S FIELD(1,MMZZT)=$G(FIELD(1,MMZZT))_"^"_$$DUR(PSRXIEN,MMZZ)_"^^^^^"_$S($P($G(FIELD(1,MMZZT)),"^")'="":$P($G(FIELD(1,MMZZT)),"\T\")_$P($G(FIELD(1,MMZZT)),"\T\",2),1:$P($G(^PSRX(PSRXIEN,6,MMZZ,0)),"^"))
"RTN","PSOHLSN1",75,0)
 .S FIELD(1,MMZZT)=$G(FIELD(1,MMZZT))_"^"_$P($G(^PSRX(PSRXIEN,6,MMZZ,0)),"^",6)
"RTN","PSOHLSN1",76,0)
 .I $O(^PSRX(PSRXIEN,6,MMZZ)) S FIELD(1,MMZZT)=$G(FIELD(1,MMZZT))_"~"
"RTN","PSOHLSN1",77,0)
 .S MMZZT=MMZZT+1
"RTN","PSOHLSN1",78,0)
 S $P(FIELD(1,1),"^",4)=$G(PSOHSTRT),$P(FIELD(1,1),"^",5)=$G(PSOHSTOP)
"RTN","PSOHLSN1",79,0)
 S PSFLAG=0,PSDIEN=+$P(^PSRX(PSRXIEN,0),"^",6),PSND1=$P($G(^PSDRUG(PSDIEN,"ND")),"^"),PSND2=$P($G(^("ND")),"^",2),PSND3=$P($G(^("ND")),"^",3) I PSND1,PSND3 S PSFLAG=1
"RTN","PSOHLSN1",80,0)
 S FIELD(2)=$S(PSFLAG:PSND1_"."_PSND3_"^"_$$ESC^ORHLESC(PSND2)_"^"_"99NDF",1:"^^")_"^"_PSDIEN_"^"_$$ESC^ORHLESC($P($G(^PSDRUG(PSDIEN,0)),"^"))_"^"_"99PSD"
"RTN","PSOHLSN1",81,0)
 Q:$G(RXE2ONLY)
"RTN","PSOHLSN1",82,0)
 I PSFLAG D
"RTN","PSOHLSN1",83,0)
 .I $T(^PSNAPIS)]"" S PSOXN=$$DFSU^PSNAPIS(PSND1,PSND3) S FIELD(5)="^^^"_$P($G(PSOXN),"^",5)_"^"_$$ESC^ORHLESC($P($G(PSOXN),"^",6))_"^"_"99PSU" K PSOXN Q
"RTN","PSOHLSN1",84,0)
 .S PRODUCT=$G(^PSNDF(PSND1,5,PSND3,0)) S UNIT=$P($G(^PSNDF(PSND1,2,+$P(PRODUCT,"^",2),3,+$P(PRODUCT,"^",3),4,+$P(PRODUCT,"^",4),0)),"^")
"RTN","PSOHLSN1",85,0)
 .S FIELD(5)="^^^"_UNIT_"^"_$$ESC^ORHLESC($P($G(^PS(50.607,+UNIT,0)),"^"))_"^"_"99PSU"
"RTN","PSOHLSN1",86,0)
 S POIPTR=$P($G(^PSRX(PSRXIEN,"OR1")),"^") I POIPTR S PODOSE=$P($G(^PS(50.7,POIPTR,0)),"^",2),PODOSENM=$P($G(^PS(50.606,+PODOSE,0)),"^")
"RTN","PSOHLSN1",87,0)
 I POIPTR S FIELD(6)="^^^"_$G(PODOSE)_"^"_$$ESC^ORHLESC($G(PODOSENM))_"^"_"99PSF"
"RTN","PSOHLSN1",88,0)
 S FIELD(10)=$P(^PSRX(PSRXIEN,0),"^",7)
"RTN","PSOHLSN1",89,0)
 S FIELD(12)=$P(^PSRX(PSRXIEN,0),"^",9)
"RTN","PSOHLSN1",90,0)
 S FIELD(14)=$P(^PSRX(PSRXIEN,0),"^",4)
"RTN","PSOHLSN1",91,0)
 S FIELD(15)=$P(^PSRX(PSRXIEN,0),"^")
"RTN","PSOHLSN1",92,0)
 S FIELD(22)=$P(^PSRX(PSRXIEN,0),"^",8)
"RTN","PSOHLSN1",93,0)
 K MMZZ S MMZZ=$$EN^PSSUTIL1(PSDIEN) S FIELD(25)=$S($E($P(MMZZ,"|"),1)=".":"0",1:"")_$P(MMZZ,"|"),FIELD(26)=$P(MMZZ,"|",2)
"RTN","PSOHLSN1",94,0)
 N PLIM,PVAR,PVAR1,SUBCOUNT D SEGPARX^PSOHLSN
"RTN","PSOHLSN1",95,0)
 ;
"RTN","PSOHLSN1",96,0)
 I $O(^PSRX(PSRXIEN,"PRC",0)) D
"RTN","PSOHLSN1",97,0)
 .S COUNT=COUNT+1,CCC=$O(^PSRX(PSRXIEN,"PRC",0))
"RTN","PSOHLSN1",98,0)
 .S MSG(COUNT)="NTE|6||"_$$ESC^ORHLESC($G(^PSRX(PSRXIEN,"PRC",CCC,0)))
"RTN","PSOHLSN1",99,0)
 .S CSCOUNT=1 F CCC=CCC:0 S CCC=$O(^PSRX(PSRXIEN,"PRC",CCC)) Q:'CCC  S MSG(COUNT,CSCOUNT)=$$ESC^ORHLESC($G(^PSRX(PSRXIEN,"PRC",CCC,0))),CSCOUNT=CSCOUNT+1
"RTN","PSOHLSN1",100,0)
 I $O(^PSRX(PSRXIEN,"INS1",0)) D
"RTN","PSOHLSN1",101,0)
 .S COUNT=COUNT+1,CCC=$O(^PSRX(PSRXIEN,"INS1",0))
"RTN","PSOHLSN1",102,0)
 .S MSG(COUNT)="NTE|7|L|"_$$ESC^ORHLESC($G(^PSRX(PSRXIEN,"INS1",CCC,0)))
"RTN","PSOHLSN1",103,0)
 .S CCCX=1 F  S CCC=$O(^PSRX(PSRXIEN,"INS1",CCC)) Q:'CCC  I $D(^PSRX(PSRXIEN,"INS1",CCC,0)) S MSG(COUNT,CCCX)=$$ESC^ORHLESC($G(^(0))) S CCCX=CCCX+1
"RTN","PSOHLSN1",104,0)
 S COUNT=COUNT+1
"RTN","PSOHLSN1",105,0)
 I $P($G(^PSRX(PSRXIEN,"SIG")),"^",2) D  Q
"RTN","PSOHLSN1",106,0)
 .D FSIG^PSOUTLA("R",PSRXIEN,238) S MSG(COUNT)="NTE|21||"_$S($G(FSIG(1))'="":$$ESC^ORHLESC($G(FSIG(1))),1:"No SIG available") I $O(FSIG(1)) F CCC=1:0 S CCC=$O(FSIG(CCC)) Q:'CCC  S MSG(COUNT,(CCC-1))=$$ESC^ORHLESC($G(FSIG(CCC)))
"RTN","PSOHLSN1",107,0)
 I '$P($G(^PSRX(PSRXIEN,"SIG")),"^",2) D  Q
"RTN","PSOHLSN1",108,0)
 .D EN3^PSOUTLA1(PSRXIEN,238) S MSG(COUNT)="NTE|21||"_$S($G(BSIG(1))'="":$$ESC^ORHLESC($G(BSIG(1))),1:"No SIG available") I $O(BSIG(1)) F CCC=1:0 S CCC=$O(BSIG(CCC)) Q:'CCC  S MSG(COUNT,(CCC-1))=$$ESC^ORHLESC($G(BSIG(CCC)))
"RTN","PSOHLSN1",109,0)
 Q
"RTN","PSOHLSN1",110,0)
 ;
"RTN","PSOHLSN1",111,0)
RXR ;
"RTN","PSOHLSN1",112,0)
 F PSORTLP=0:0 S PSORTLP=$O(^PSRX(PSRXIEN,6,PSORTLP)) Q:'PSORTLP  D
"RTN","PSOHLSN1",113,0)
 .S LIMIT=1 X NULLFLDS
"RTN","PSOHLSN1",114,0)
 .S FIELD(0)="RXR"
"RTN","PSOHLSN1",115,0)
 .S PSROUTE=$P($G(^PSRX(PSRXIEN,6,PSORTLP,0)),"^",7) I PSROUTE,$D(^PS(51.2,PSROUTE,0))  S RTNAME=$P(^PS(51.2,PSROUTE,0),"^")
"RTN","PSOHLSN1",116,0)
 .S FIELD(1)="^^^"_$G(PSROUTE)_"^"_$G(RTNAME)_"^"_"99PSR"
"RTN","PSOHLSN1",117,0)
 .D SEG
"RTN","PSOHLSN1",118,0)
 Q
"RTN","PSOHLSN1",119,0)
 ;
"RTN","PSOHLSN1",120,0)
ZCL D ZCL^PSOHLSN2
"RTN","PSOHLSN1",121,0)
 Q
"RTN","PSOHLSN1",122,0)
ZSC D ZSC^PSOHLSN2
"RTN","PSOHLSN1",123,0)
 Q
"RTN","PSOHLSN1",124,0)
 ;
"RTN","PSOHLSN1",125,0)
ZRX ;
"RTN","PSOHLSN1",126,0)
 S ZRXFLAG=1
"RTN","PSOHLSN1",127,0)
 S LIMIT=6 X NULLFLDS
"RTN","PSOHLSN1",128,0)
 S FIELD(0)="ZRX"
"RTN","PSOHLSN1",129,0)
 S ZPRE=$P($G(^PSRX(PSRXIEN,"OR1")),"^",3) I ZPRE S FIELD(1)=$P($G(^PSRX(ZPRE,"OR1")),"^",2)
"RTN","PSOHLSN1",130,0)
 I '$G(FIELD(1)),$G(PSORDEDT) S FIELD(1)=$P($G(^PS(52.41,$G(PSORDEDT),0)),"^")
"RTN","PSOHLSN1",131,0)
 S FIELD(2)=$G(PSNOO)
"RTN","PSOHLSN1",132,0)
 I $G(STAT)="SN"!($G(STAT)="RO") S FIELD(3)=$S($G(STAT)="RO"!($G(PSOEDIT)):"E",$G(PSOOPT)=3:"R",1:"N")
"RTN","PSOHLSN1",133,0)
 S FIELD(4)=$P(^PSRX(PSRXIEN,0),"^",11)
"RTN","PSOHLSN1",134,0)
 S PSOCDDUZ=$S($G(PSOROPCH)="PATCH":$P($G(^PSRX(PSRXIEN,"OR1")),"^",5),$G(PSOHUIOR)&($P($G(^PSRX(PSRXIEN,"EXT")),"^")'=""):+$G(PSOCANRC),1:$G(DUZ))
"RTN","PSOHLSN1",135,0)
 I $G(PSOCDDUZ) S FIELD(5)=PSOCDDUZ_"^"_$P($G(^VA(200,PSOCDDUZ,0)),"^")_"^"_"99NP"
"RTN","PSOHLSN1",136,0)
 I $G(STAT)="ZD",$G(PSODISPP) S FIELD(6)="P"
"RTN","PSOHLSN1",137,0)
 D SEG Q
"RTN","PSOHLSN1",138,0)
SEG S SEGMENT="" F J=0:1:LIMIT S SEGMENT=$S(SEGMENT="":FIELD(J),1:SEGMENT_"|"_FIELD(J))
"RTN","PSOHLSN1",139,0)
 S COUNT=COUNT+1,MSG(COUNT)=SEGMENT
"RTN","PSOHLSN1",140,0)
 Q
"RTN","PSOHLSN1",141,0)
SEND D:$G(PSRXIEN)&($T(EN^PSOHDR)]"")&($G(PSOSSMES)'="CPRSUP")  K FIELD D MSG^XQOR("PS EVSEND OR",.MSG) Q
"RTN","PSOHLSN1",142,0)
 .I $G(STAT)="ZC"!($G(STAT)="UC")!($G(STAT)="UD")!($G(STAT)="UH")!($G(STAT)="UR")!($G(STAT)="DE")!($G(STAT)="ZD")!($G(STAT)="SN")!($G(STAT)="Z@") Q
"RTN","PSOHLSN1",143,0)
 .I $G(STAT)="SC",$G(PSSTAT)="ZZ" Q
"RTN","PSOHLSN1",144,0)
 .D EN^PSOHDR("PRES",PSRXIEN)
"RTN","PSOHLSN1",145,0)
 ;
"RTN","PSOHLSN1",146,0)
NOO ;
"RTN","PSOHLSN1",147,0)
 I $G(PSNOO)="" S PSNOOTX="" Q
"RTN","PSOHLSN1",148,0)
 S PSNOOTX=$S(PSNOO="W":"Written",PSNOO="V":"Verbal",PSNOO="P":"Telephoned",PSNOO="S":"Service Correction",PSNOO="X":"Rejected",PSNOO="D":"Duplicate",PSNOO="I":"Policy",PSNOO="E":"Physician Entered",PSNOO="A":"Auto DC",1:"") Q
"RTN","PSOHLSN1",149,0)
 Q
"RTN","PSOHLSN1",150,0)
 ;
"RTN","PSOHLSN1",151,0)
DUR(PSODX1,PSODX2) ;
"RTN","PSOHLSN1",152,0)
 N PSODX,PSODX4,PSODX5,PSODX6,PSODX7 S PSODX=$P($G(^PSRX(PSODX1,6,PSODX2,0)),"^",5)
"RTN","PSOHLSN1",153,0)
 I 'PSODX Q PSODX
"RTN","PSOHLSN1",154,0)
 S PSODX4=$L(PSODX),PSODX5=$E(PSODX,PSODX4)
"RTN","PSOHLSN1",155,0)
 S PSODX=$S(PSODX5?1A:PSODX,1:PSODX_"D")
"RTN","PSOHLSN1",156,0)
 S PSODX6=$L(PSODX)
"RTN","PSOHLSN1",157,0)
 S PSODX7=$E(PSODX,PSODX6)_$E(PSODX,1,(PSODX6-1))
"RTN","PSOHLSN1",158,0)
 Q PSODX7
"RTN","PSOHLSN1",159,0)
 Q
"RTN","PSOHLSN2")
0^19^B7919233
"RTN","PSOHLSN2",1,0)
PSOHLSN2 ;BIR/LE - Utilities for PSOHLSN1 ;02/27/04
"RTN","PSOHLSN2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**143,226,239,225**;DEC 1997;Build 29
"RTN","PSOHLSN2",3,0)
 ;
"RTN","PSOHLSN2",4,0)
DG1 ;this section builds both DG1 segments 
"RTN","PSOHLSN2",5,0)
 Q:'$D(^PSRX(PSRXIEN,"ICD",1,0))
"RTN","PSOHLSN2",6,0)
 N LP,DG,DXDESC,I
"RTN","PSOHLSN2",7,0)
 S LIMIT=4,FIELD(0)="DG1",FIELD(4)=""
"RTN","PSOHLSN2",8,0)
 ;I '$D(^PSRX(PSRXIEN,"ICD",1,0)) S FIELD(1)=1,FIELD(2)="",FIELD(3)="^^^^^" D SEG^PSOHLSN1 Q
"RTN","PSOHLSN2",9,0)
 I $P(^PSRX(PSRXIEN,"ICD",1,0),"^",1)="" Q  ;S FIELD(1)=1,FIELD(2)="",FIELD(3)="^^^^^" D SEG^PSOHLSN1 Q
"RTN","PSOHLSN2",10,0)
 F I=1:1:8 D
"RTN","PSOHLSN2",11,0)
 . Q:'$D(^PSRX(PSRXIEN,"ICD",I,0))
"RTN","PSOHLSN2",12,0)
 . S PSOICD="",PSOICD=^PSRX(PSRXIEN,"ICD",I,0) Q:$P(PSOICD,U,1)=""
"RTN","PSOHLSN2",13,0)
 . S (DG,DXDESC)=""
"RTN","PSOHLSN2",14,0)
 . I $P(PSOICD,U,1)'="" D
"RTN","PSOHLSN2",15,0)
 .. S DXDESC=$$GET1^DIQ(80,$P(PSOICD,U,1)_",",10),FIELD(1)=I,FIELD(2)=""
"RTN","PSOHLSN2",16,0)
 .. S FIELD(3)=$P(PSOICD,U,1)_U_DXDESC_U_"80"_U_$$GET1^DIQ(80,$P(PSOICD,U,1)_",",.01)_U_DXDESC_U_"ICD9"
"RTN","PSOHLSN2",17,0)
 .. D SEG^PSOHLSN1
"RTN","PSOHLSN2",18,0)
 K PSOICD("K")
"RTN","PSOHLSN2",19,0)
 Q
"RTN","PSOHLSN2",20,0)
ZCL N STOP,IBQ,ICD,I,JJJ,EI
"RTN","PSOHLSN2",21,0)
 S LIMIT=3,FIELD(0)="ZCL"
"RTN","PSOHLSN2",22,0)
 I '$D(^PSRX(PSRXIEN,"ICD"))&($D(^PSRX(PSRXIEN,"IBQ"))) D    ;For edits; currently CPRS doesn't update SC/EI for edits, but just in case they start
"RTN","PSOHLSN2",23,0)
 . S FIELD(1)=1,FIELD(2)=3
"RTN","PSOHLSN2",24,0)
 . S EI="",EI=^PSRX(PSRXIEN,"IBQ")
"RTN","PSOHLSN2",25,0)
 . S JJJ=0 F I=3,4,1,5,2,6,7,8 S JJJ=JJJ+1,FIELD(3)=$P(EI,U,I) S FIELD(1)=1,FIELD(2)=JJJ D SEG^PSOHLSN1
"RTN","PSOHLSN2",26,0)
 E  F I=1:1:8 D
"RTN","PSOHLSN2",27,0)
 . Q:'$D(^PSRX(PSRXIEN,"ICD",I,0))
"RTN","PSOHLSN2",28,0)
 . S PSOICD=^PSRX(PSRXIEN,"ICD",I,0),ICD=$P(PSOICD,"^",1)
"RTN","PSOHLSN2",29,0)
 . Q:ICD=""&(I>1)
"RTN","PSOHLSN2",30,0)
 . F JJJ=2:1:9 S EI=$P(PSOICD,U,JJJ),FIELD(2)=JJJ-1 D
"RTN","PSOHLSN2",31,0)
 .. S FIELD(1)=$S(ICD="":1,1:I)
"RTN","PSOHLSN2",32,0)
 .. ;S FIELD(3)=$S(EI=1:EI,1:0)
"RTN","PSOHLSN2",33,0)
 .. S FIELD(3)=$S(EI=1:EI,EI=0:EI,1:"")
"RTN","PSOHLSN2",34,0)
 .. D SEG^PSOHLSN1
"RTN","PSOHLSN2",35,0)
 K PSOICD
"RTN","PSOHLSN2",36,0)
 Q
"RTN","PSOHLSN2",37,0)
 ;CPRS doesn't look at the ZCL segment when their CIDC switch is off.  Always send both ZCL and ZSC for consistency
"RTN","PSOHLSN2",38,0)
ZSC S PSOCPS=$$DT^PSOMLLDT S LIMIT=$S($G(PSOCPS):8,1:1) X NULLFLDS
"RTN","PSOHLSN2",39,0)
 S FIELD(0)="ZSC" N JJJ,PSOICD
"RTN","PSOHLSN2",40,0)
 I '$D(^PSRX(PSRXIEN,"ICD",1,0)) D
"RTN","PSOHLSN2",41,0)
 . I '$G(PSOCPS) S FIELD(1)=$S($P($G(^PSRX(PSRXIEN,"IB")),"^"):"NSC",1:"SC")
"RTN","PSOHLSN2",42,0)
 . I $G(PSOCPS) D
"RTN","PSOHLSN2",43,0)
 .. S FIELD(1)=$P($G(^PSRX(PSRXIEN,"IBQ")),"^")
"RTN","PSOHLSN2",44,0)
 .. F JJJ=2:1:8 S FIELD(JJJ)=$P($G(^PSRX(PSRXIEN,"IBQ")),"^",JJJ)
"RTN","PSOHLSN2",45,0)
 .D SEG^PSOHLSN1
"RTN","PSOHLSN2",46,0)
 I $D(^PSRX(PSRXIEN,"ICD",1,0)) D
"RTN","PSOHLSN2",47,0)
 . S PSOICD=$G(^PSRX(PSRXIEN,"ICD",1,0))
"RTN","PSOHLSN2",48,0)
 . F JJJ=2:1:9 D
"RTN","PSOHLSN2",49,0)
 .. I JJJ=2 S FIELD(3)=$P(PSOICD,"^",JJJ)  ;AO
"RTN","PSOHLSN2",50,0)
 .. I JJJ=3 S FIELD(4)=$P(PSOICD,"^",JJJ)  ;IR
"RTN","PSOHLSN2",51,0)
 .. I JJJ=4 S FIELD(1)=$P(PSOICD,"^",JJJ)  ;SC
"RTN","PSOHLSN2",52,0)
 .. I JJJ=5 S FIELD(5)=$P(PSOICD,"^",JJJ)  ;EC
"RTN","PSOHLSN2",53,0)
 .. I JJJ=6 S FIELD(2)=$P(PSOICD,"^",JJJ)  ;MST
"RTN","PSOHLSN2",54,0)
 .. I JJJ=7 S FIELD(6)=$P(PSOICD,"^",JJJ)  ;HNC
"RTN","PSOHLSN2",55,0)
 .. I JJJ=8 S FIELD(7)=$P(PSOICD,"^",JJJ)  ;CV
"RTN","PSOHLSN2",56,0)
 .. I JJJ=9 S FIELD(8)=$P(PSOICD,"^",JJJ)  ;SHAD
"RTN","PSOHLSN2",57,0)
 . D SEG^PSOHLSN1
"RTN","PSOHLSN2",58,0)
 Q
"RTN","PSOHLSN3")
0^33^B4822097
"RTN","PSOHLSN3",1,0)
PSOHLSN3 ;BIR/SJA - Send order info to OERR from file 52 ;10/05/06
"RTN","PSOHLSN3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**225**;DEC 1997;Build 29
"RTN","PSOHLSN3",3,0)
 ;
"RTN","PSOHLSN3",4,0)
ORC ; Called from PSOHLSN1 due to it's routine size.
"RTN","PSOHLSN3",5,0)
 S LIMIT=15 X NULLFLDS
"RTN","PSOHLSN3",6,0)
 S FIELD(0)="ORC"
"RTN","PSOHLSN3",7,0)
 S FIELD(1)=$G(STAT)
"RTN","PSOHLSN3",8,0)
 I $G(STAT)'="SN",$G(STAT)'="ZC" S FIELD(2)=$P($G(^PSRX(PSRXIEN,"OR1")),"^",2)
"RTN","PSOHLSN3",9,0)
 S:FIELD(2)'="" FIELD(2)=FIELD(2)_$S($G(PLACERXX):";"_PLACERXX,1:"")_"^OR"
"RTN","PSOHLSN3",10,0)
 S FIELD(3)=PSRXIEN_"^PS"
"RTN","PSOHLSN3",11,0)
 S FIELD(5)=$G(PSSTAT)
"RTN","PSOHLSN3",12,0)
 I $G(STAT)="RO",$G(PSOROPCH)'="PATCH" S FIELD(5)="CM"
"RTN","PSOHLSN3",13,0)
 I $G(FIELD(5))="" I $G(STAT)="OR"!($G(STAT)="OE") S FIELD(5)="CM"
"RTN","PSOHLSN3",14,0)
 S X=$P($G(^PSRX(PSRXIEN,2)),"^") I X S FIELD(9)=$$FMTHL7^XLFDT(X)
"RTN","PSOHLSN3",15,0)
 S EDUZ=$P($G(^PSRX(PSRXIEN,0)),"^",16) I EDUZ S FIELD(10)=EDUZ_"^"_$P($G(^VA(200,EDUZ,0)),"^")
"RTN","PSOHLSN3",16,0)
 I $G(PSOCANRC),$G(PSOCANRN)'="" I $G(STAT)="OD"!($G(STAT)="OC") S FIELD(12)=$G(PSOCANRC)_"^"_$G(PSOCANRN)
"RTN","PSOHLSN3",17,0)
 I '$G(FIELD(12)) S FIELD(12)=$P($G(^PSRX(PSRXIEN,0)),"^",4)_"^"_$P($G(^VA(200,+$P($G(^PSRX(PSRXIEN,0)),"^",4),0)),"^")
"RTN","PSOHLSN3",18,0)
 S PSOHISSD="",X=$P($G(^PSRX(PSRXIEN,0)),"^",13) I X S PSOHISSD=$$FMTHL7^XLFDT(X)
"RTN","PSOHLSN3",19,0)
 S FIELD(15)=$G(PSOHISSD) K X
"RTN","PSOHLSN3",20,0)
 D SEG^PSOHLSN1
"RTN","PSOHLSN3",21,0)
 I $G(COMM)'=""!($G(PSNOO)'="") D
"RTN","PSOHLSN3",22,0)
 .I $G(PSNOO)'="" D NOO^PSOHLSN1
"RTN","PSOHLSN3",23,0)
 .I $L($G(COMM))+($L(MSG(COUNT)))+($L($G(PSNOOTX)))+($S($G(PSNOO)'="":11,1:5))<245 S MSG(COUNT)=MSG(COUNT)_"|"_$G(PSNOO)_"^"_$G(PSNOOTX)_"^"_$S($G(PSNOO)'="":"99ORN",1:"")_"^^"_$G(COMM)_"^" Q
"RTN","PSOHLSN3",24,0)
 .S MSG(COUNT,1)="|"_$G(PSNOO)_"^"_$G(PSNOOTX)_"^"_$S($G(PSNOO)'="":"99ORN",1:"")_"^^"_$G(COMM)_"^"
"RTN","PSOHLSN3",25,0)
 Q
"RTN","PSOHLSNC")
0^6^B54704997
"RTN","PSOHLSNC",1,0)
PSOHLSNC ;BIR/RTR - Send CHCS message to CPRS ;07/03/02
"RTN","PSOHLSNC",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**111,157,143,225**;DEC 1997;Build 29
"RTN","PSOHLSNC",3,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSOHLSNC",4,0)
 ;External reference to ^PS(51.2 supported by DBIA 2226
"RTN","PSOHLSNC",5,0)
 ;External reference to ^PSDRUG( supported by DBIA 221
"RTN","PSOHLSNC",6,0)
 ;External reference to ^PS(50.607 supported by DBIA 2221
"RTN","PSOHLSNC",7,0)
 ;External reference to ^PS(50.606 supported by DBIA 2174
"RTN","PSOHLSNC",8,0)
 ;External reference to EN^PSSUTIL1 supported by DBIA 3179
"RTN","PSOHLSNC",9,0)
 ;
"RTN","PSOHLSNC",10,0)
 ;PSOPND=Internal number from 52.41
"RTN","PSOHLSNC",11,0)
 ;PSOPNDST=Order Control Code Status
"RTN","PSOHLSNC",12,0)
 ;PSOPNDPT=Pharmacy Status
"RTN","PSOHLSNC",13,0)
 ;
"RTN","PSOHLSNC",14,0)
EN(PSOPND,PSOPNDST,PSOPNDPT) ;
"RTN","PSOHLSNC",15,0)
 N MSG,PSOHLIP,PSOHLIPX,PSOHLIPC,PSOHLTTL,PSOHUTL,PSOHND,PSOHNDD,PSOHNDU,PSONFLD,PSOXFLD,PSOLIMIT,PSONJJ,PSOHJJ,PSOHCT,PSOSEGMT,PSOHENT,PSOHPRO,PSOHIM,PSOHPC,PSOHPCTX,PSOHRT,PSOHRTE,PSOHRTEN,PSOHRTX,Y,DA,DIQ,DR
"RTN","PSOHLSNC",16,0)
 I $G(PSOPND)=""!($G(PSOPNDST)="") Q
"RTN","PSOHLSNC",17,0)
 I '$D(^PS(52.41,+$G(PSOPND),0)) Q
"RTN","PSOHLSNC",18,0)
 S PSONFLD="F PSONJJ=0:1:PSOLIMIT S PSOXFLD(PSONJJ)="""""
"RTN","PSOHLSNC",19,0)
 S PSOHCT=1
"RTN","PSOHLSNC",20,0)
 D INIT^PSOHLSN
"RTN","PSOHLSNC",21,0)
 D PID,PV1,ORC,RXO,RXE,RXR,ZRX,DG1,ZCL
"RTN","PSOHLSNC",22,0)
 D MSG^XQOR("PS EVSEND OR",.MSG)
"RTN","PSOHLSNC",23,0)
 Q
"RTN","PSOHLSNC",24,0)
PID ;Build PID segment
"RTN","PSOHLSNC",25,0)
 S PSOLIMIT=5 X PSONFLD
"RTN","PSOHLSNC",26,0)
 ;What about this ICN number?
"RTN","PSOHLSNC",27,0)
 S PSOXFLD(0)="PID"
"RTN","PSOHLSNC",28,0)
 S PSOXFLD(3)=$P($G(^PS(52.41,PSOPND,0)),"^",2)
"RTN","PSOHLSNC",29,0)
 D SEG
"RTN","PSOHLSNC",30,0)
 Q
"RTN","PSOHLSNC",31,0)
PV1 ;Build PV1 segment
"RTN","PSOHLSNC",32,0)
 S PSOLIMIT=19 X PSONFLD
"RTN","PSOHLSNC",33,0)
 S PSOXFLD(0)="PV1"
"RTN","PSOHLSNC",34,0)
 S PSOXFLD(2)="O"
"RTN","PSOHLSNC",35,0)
 I $P($G(^PS(52.41,PSOPND,0)),"^",13) S PSOXFLD(3)=$P(^(0),"^",13)
"RTN","PSOHLSNC",36,0)
 D SEG
"RTN","PSOHLSNC",37,0)
 Q
"RTN","PSOHLSNC",38,0)
DG1 ;Build DG1 segment
"RTN","PSOHLSNC",39,0)
 ;future use; chcs does not send ICD-9 codes.
"RTN","PSOHLSNC",40,0)
 Q:'$D(^PS(52.41,PSOPND,"ICD"))
"RTN","PSOHLSNC",41,0)
 S PSOLIMIT=4 X PSONFLD
"RTN","PSOHLSNC",42,0)
 S PSOXFLD(0)="DG1"
"RTN","PSOHLSNC",43,0)
 N LP,VDG,FLAG,DXDESC,DG
"RTN","PSOHLSNC",44,0)
 S FLAG="",PSOXFLD(4)="",PSOXFLD(2)=""
"RTN","PSOHLSNC",45,0)
 F LP=1:1:8 Q:'$D(^PS(52.41,PSOPND,"ICD",LP,0))  D
"RTN","PSOHLSNC",46,0)
 . S VDG="",VDG=^PS(52.41,PSOPND,"ICD",LP,0) Q:$P(VDG,U,1)=""
"RTN","PSOHLSNC",47,0)
 . S (DG,DXDESC)=""
"RTN","PSOHLSNC",48,0)
 . S DXDESC=$$GET1^DIQ(80,$P(VDG,U,1)_",",10),PSOXFLD(1)=LP
"RTN","PSOHLSNC",49,0)
 . S PSOXFLD(3)=$P(VDG,U,1)_U_DXDESC_U_"80"_U_$$GET1^DIQ(80,$P(VDG,U,1)_",",.01)_U_DXDESC_U_"ICD9"
"RTN","PSOHLSNC",50,0)
 . D SEG
"RTN","PSOHLSNC",51,0)
 Q
"RTN","PSOHLSNC",52,0)
ORC ;Build ORC segment
"RTN","PSOHLSNC",53,0)
 S PSOLIMIT=15 X PSONFLD
"RTN","PSOHLSNC",54,0)
 S PSOXFLD(0)="ORC"
"RTN","PSOHLSNC",55,0)
 S PSOXFLD(1)=$G(PSOPNDST)
"RTN","PSOHLSNC",56,0)
 S PSOXFLD(3)=PSOPND_"S^PS"
"RTN","PSOHLSNC",57,0)
 S PSOXFLD(5)=$G(PSOPNDPT)
"RTN","PSOHLSNC",58,0)
 S X=$P($G(^PS(52.41,PSOPND,0)),"^",6) I X S PSOXFLD(9)=$$FMTHL7^XLFDT(X)
"RTN","PSOHLSNC",59,0)
 S PSOHENT=$P($G(^PS(52.41,PSOPND,0)),"^",4) I PSOHENT K ^UTILITY("DIQ1",$J) S DIC=200,DR=.01,DA=PSOHENT,DIQ(0)="E" D EN^DIQ1 S PSOXFLD(10)=PSOHENT_"^"_$P($G(^UTILITY("DIQ1",$J,200,PSOHENT,.01,"E")),"^")
"RTN","PSOHLSNC",60,0)
 S PSOHPRO=$P($G(^PS(52.41,PSOPND,0)),"^",5) I PSOHPRO K ^UTILITY("DIQ1",$J) S DIC=200,DR=.01,DA=PSOHPRO,DIQ(0)="E" D EN^DIQ1 S PSOXFLD(12)=PSOHPRO_"^"_$P($G(^UTILITY("DIQ1",$J,200,PSOHPRO,.01,"E")),"^")
"RTN","PSOHLSNC",61,0)
 K ^UTILITY("DIQ1",$J)
"RTN","PSOHLSNC",62,0)
 S X=$P($G(^PS(52.41,PSOPND,0)),"^",12) I X S PSOXFLD(15)=$$FMTHL7^XLFDT(X)
"RTN","PSOHLSNC",63,0)
 D SEG
"RTN","PSOHLSNC",64,0)
 Q
"RTN","PSOHLSNC",65,0)
RXO ;Build RXO segment
"RTN","PSOHLSNC",66,0)
 S PSOLIMIT=1 X PSONFLD
"RTN","PSOHLSNC",67,0)
 S PSOXFLD(0)="RXO"
"RTN","PSOHLSNC",68,0)
 S PSOHITM=$P($G(^PS(52.41,PSOPND,0)),"^",8)
"RTN","PSOHLSNC",69,0)
 S PSOXFLD(1)=$S($G(PSOHITM):"^^^"_PSOHITM_"^"_$P($G(^PS(50.7,+$G(PSOHITM),0)),"^")_" "_$P($G(^PS(50.606,+$P($G(^(0)),"^",2),0)),"^")_"^99PSP",1:"^^^^^")
"RTN","PSOHLSNC",70,0)
 D SEG
"RTN","PSOHLSNC",71,0)
 Q
"RTN","PSOHLSNC",72,0)
RXE ;Build RXE segment
"RTN","PSOHLSNC",73,0)
 K PSOXFLD S PSOLIMIT=26 X PSONFLD
"RTN","PSOHLSNC",74,0)
 S PSOXFLD(0)="RXE"
"RTN","PSOHLSNC",75,0)
 ;No Quantity Timing, since the Sig is entered as free text
"RTN","PSOHLSNC",76,0)
 S PSOHNDD=$P($G(^PS(52.41,PSOPND,0)),"^",9)
"RTN","PSOHLSNC",77,0)
 S PSOHND="" I PSOHNDD S PSOHND=$G(^PSDRUG(PSOHNDD,"ND"))
"RTN","PSOHLSNC",78,0)
 S PSOXFLD(2)=$S($P(PSOHND,"^")&($P(PSOHND,"^",3)):$P(PSOHND,"^")_"."_$P(PSOHND,"^",3)_"^"_$P(PSOHND,"^",2)_"^"_"99NDF",1:"^^")_"^"_$G(PSOHNDD)_"^"_$S($G(PSOHNDD):$P($G(^PSDRUG(PSOHNDD,0)),"^"),1:"")_"^"_"99PSD"
"RTN","PSOHLSNC",79,0)
 I $P(PSOHND,"^"),$P(PSOHND,"^",3) D
"RTN","PSOHLSNC",80,0)
 .I $T(^PSNAPIS)]"" S PSOHNDU=$$DFSU^PSNAPIS($P(PSOHND,"^"),$P(PSOHND,"^",3)) S PSOXFLD(5)="^^^"_$P($G(PSOHNDU),"^",5)_"^"_$P($G(PSOHNDU),"^",6)_"^"_"99PSU"
"RTN","PSOHLSNC",81,0)
 I $G(PSOHITM) S PSOXFLD(6)="^^^"_$P($G(^PS(50.7,$G(PSOHITM),0)),"^",2)_"^"_$P($G(^PS(50.606,+$P($G(^PS(50.7,$G(PSOHITM),0)),"^",2),0)),"^")_"^"_"99PSF"
"RTN","PSOHLSNC",82,0)
 S PSOXFLD(10)=$P(^PS(52.41,PSOPND,0),"^",10)
"RTN","PSOHLSNC",83,0)
 S PSOXFLD(12)=$P(^PS(52.41,PSOPND,0),"^",11)
"RTN","PSOHLSNC",84,0)
 S PSOXFLD(22)=$P(^PS(52.41,PSOPND,0),"^",22)
"RTN","PSOHLSNC",85,0)
 I $G(PSOHNDD) S PSOHUTL=$$EN^PSSUTIL1(PSOHNDD) S PSOXFLD(25)=$S($E($P(PSOHUTL,"|"),1)=".":"0",1:"")_$P(PSOHUTL,"|"),PSOXFLD(26)=$P(PSOHUTL,"|",2)
"RTN","PSOHLSNC",86,0)
 ;Create RXE segment, can possibly go over 245 in length
"RTN","PSOHLSNC",87,0)
 S PSOHCT=PSOHCT+1
"RTN","PSOHLSNC",88,0)
 S (PSOHLIPX,PSOHLIPC,PSOHLTTL)=0,PSOHLIP="" F  S PSOHLIP=$O(PSOXFLD(PSOHLIP)) Q:PSOHLIP=""  D
"RTN","PSOHLSNC",89,0)
 .I PSOHLIP S PSOXFLD(PSOHLIP)="|"_PSOXFLD(PSOHLIP)
"RTN","PSOHLSNC",90,0)
 .I PSOHLTTL+$L(PSOXFLD(PSOHLIP))<246 D  S PSOHLTTL=PSOHLTTL+$L(PSOXFLD(PSOHLIP)) Q
"RTN","PSOHLSNC",91,0)
 ..I 'PSOHLIPX S MSG(PSOHCT)=$G(MSG(PSOHCT))_PSOXFLD(PSOHLIP) Q
"RTN","PSOHLSNC",92,0)
 ..S MSG(PSOHCT,PSOHLIPX)=$G(MSG(PSOHCT,PSOHLIPX))_PSOXFLD(PSOHLIP)
"RTN","PSOHLSNC",93,0)
 .S PSOHLICP=245-PSOHLTTL
"RTN","PSOHLSNC",94,0)
 .I 'PSOHLIPX D  S PSOHLTTL=$L(MSG(PSOHCT,PSOHLIPX)) Q
"RTN","PSOHLSNC",95,0)
 ..S MSG(PSOHCT)=$G(MSG(PSOHCT))_$E(PSOXFLD(PSOHLIP),1,PSOHLICP)
"RTN","PSOHLSNC",96,0)
 ..S PSOHLIPX=1,MSG(PSOHCT,PSOHLIPX)=$E(PSOXFLD(PSOHLIP),(PSOHLICP+1),999)
"RTN","PSOHLSNC",97,0)
 .S MSG(PSOHCT,PSOHLIPX)=$G(MSG(PSOHCT,PSOHLIPX))_$E(PSOXFLD(PSOHLIP),1,PSOHLICP)
"RTN","PSOHLSNC",98,0)
 .S PSOHLIPX=PSOHLIPX+1,MSG(PSOHCT,PSOHLIPX)=$E(PSOXFLD(PSOHLIP),(PSOHLICP+1),999)
"RTN","PSOHLSNC",99,0)
 .S PSOHLTTL=$L(MSG(PSOHCT,PSOHLIPX))
"RTN","PSOHLSNC",100,0)
 ;Set NTE segments
"RTN","PSOHLSNC",101,0)
 S PSOHPCT=0,PSOHCT=PSOHCT+1 I $O(^PS(52.41,PSOPND,3,0)) F PSOHPC=0:0 S PSOHPC=$O(^PS(52.41,PSOPND,3,PSOHPC)) Q:'PSOHPC  D
"RTN","PSOHLSNC",102,0)
 .I $G(^PS(52.41,PSOPND,3,PSOHPC,0))="" Q
"RTN","PSOHLSNC",103,0)
 .I 'PSOHPCT S MSG(PSOHCT)="NTE|6||"_$G(^PS(52.41,PSOPND,3,PSOHPC,0)) S PSOHPCT=1 Q
"RTN","PSOHLSNC",104,0)
 .S MSG(PSOHCT,PSOHPCT)=$G(^PS(52.41,PSOPND,3,PSOHPC,0)),PSOHPCT=PSOHPCT+1
"RTN","PSOHLSNC",105,0)
 I 'PSOHPCT S PSOHCT=PSOHCT-1
"RTN","PSOHLSNC",106,0)
 S PSOHCT=PSOHCT+1,PSOHPCT=0 I $O(^PS(52.41,PSOPND,"SIG",0)) F PSOHPC=0:0 S PSOHPC=$O(^PS(52.41,PSOPND,"SIG",PSOHPC)) Q:'PSOHPC  D
"RTN","PSOHLSNC",107,0)
 .I $G(^PS(52.41,PSOPND,"SIG",PSOHPC,0))="" Q
"RTN","PSOHLSNC",108,0)
 .I 'PSOHPCT S MSG(PSOHCT)="NTE|21||"_$G(^PS(52.41,PSOPND,"SIG",PSOHPC,0)) S PSOHPCT=1 Q
"RTN","PSOHLSNC",109,0)
 .S MSG(PSOHCT,PSOHPCT)=$G(^PS(52.41,PSOPND,"SIG",PSOHPC,0)),PSOHPCT=PSOHPCT+1
"RTN","PSOHLSNC",110,0)
 I 'PSOHPCT S MSG(PSOHCT)="NTE|21||"_"No SIG available"
"RTN","PSOHLSNC",111,0)
 Q
"RTN","PSOHLSNC",112,0)
RXR ;Build RXR segment
"RTN","PSOHLSNC",113,0)
 S PSOHRTX="" F PSOHRT=0:0 S PSOHRT=$O(^PS(52.41,PSOPND,1,PSOHRT)) Q:'PSOHRT  D
"RTN","PSOHLSNC",114,0)
 .S PSOHRTX=1
"RTN","PSOHLSNC",115,0)
 .S PSOLIMIT=1 X PSONFLD
"RTN","PSOHLSNC",116,0)
 .S PSOXFLD(0)="RXR"
"RTN","PSOHLSNC",117,0)
 .S PSOHRTEN=""
"RTN","PSOHLSNC",118,0)
 .S PSOHRTE=$P($G(^PS(52.41,PSOPND,1,PSOHRT,1)),"^",8) I PSOHRTE,$D(^PS(51.2,PSOHRTE,0)) S PSOHRTEN=$P($G(^(0)),"^")
"RTN","PSOHLSNC",119,0)
 .S PSOXFLD(1)="^^^"_$G(PSOHRTE)_"^"_$G(PSOHRTEN)_"^"_"99PSR"
"RTN","PSOHLSNC",120,0)
 .D SEG
"RTN","PSOHLSNC",121,0)
 I '$G(PSOHRTX) S PSOLIMIT=1 X PSONFLD S PSOXFLD(0)="RXR",PSOXFLD(1)="^^^^^99PSR" D SEG
"RTN","PSOHLSNC",122,0)
 Q
"RTN","PSOHLSNC",123,0)
ZRX ;Build ZRX segment
"RTN","PSOHLSNC",124,0)
 S PSOLIMIT=6 X PSONFLD
"RTN","PSOHLSNC",125,0)
 S PSOXFLD(0)="ZRX"
"RTN","PSOHLSNC",126,0)
 S PSOXFLD(3)="N"
"RTN","PSOHLSNC",127,0)
 S PSOXFLD(4)=$P($G(^PS(52.41,PSOPND,0)),"^",17)
"RTN","PSOHLSNC",128,0)
 D SEG
"RTN","PSOHLSNC",129,0)
 Q
"RTN","PSOHLSNC",130,0)
ZCL ;Build ZCL segment
"RTN","PSOHLSNC",131,0)
 N I,JJJ,INODE,EI
"RTN","PSOHLSNC",132,0)
 S PSOXFLD(0)="ZCL",PSOLIMIT=3 X PSONFLD
"RTN","PSOHLSNC",133,0)
 I $D(^PS(52.41,PSOPND,"ICD")) D
"RTN","PSOHLSNC",134,0)
 .F I=1:1:8 D
"RTN","PSOHLSNC",135,0)
 ..Q:'$D(^PS(52.41,PSOPND,"ICD",I,0))
"RTN","PSOHLSNC",136,0)
 ..S INODE="",INODE=^PS(52.41,PSOPND,"ICD",I,0)
"RTN","PSOHLSNC",137,0)
 ..F JJJ=2:1:9 S EI=$P(INODE,U,JJJ) D
"RTN","PSOHLSNC",138,0)
 ...S PSOXFLD(1)=I,PSOXFLD(2)=JJJ-1,PSOXFLD(3)=EI
"RTN","PSOHLSNC",139,0)
 ...;I JJJ=4 S EI=$S(EI=1:"SC",EI=0:"NSC",1:"") S PSOXFLD(3)=EI
"RTN","PSOHLSNC",140,0)
 ...D SEG
"RTN","PSOHLSNC",141,0)
 E  D  ;if no ICD node, send one ZCL segment
"RTN","PSOHLSNC",142,0)
 .S PSOXFLD(0)="ZCL",PSOXFLD(1)=1,PSOXFLD(2)=3
"RTN","PSOHLSNC",143,0)
 .S PSOXFLD(3)=$S($P(^PS(52.41,PSOPND,0),"^",16)="SC":1,$P(^(0),"^",16)="NSC":0,1:"")
"RTN","PSOHLSNC",144,0)
 .D SEG
"RTN","PSOHLSNC",145,0)
 .Q:'$D(^PS(52.41,PSOPND,"IBQ"))
"RTN","PSOHLSNC",146,0)
 .S EI=^PS(52.41,PSOPND,"IBQ")
"RTN","PSOHLSNC",147,0)
 .F I=2,3,4,1,5,6,7 S PSOXFLD(3)=$P(EI,U,I) D
"RTN","PSOHLSNC",148,0)
 .. S PSOXFLD(2)=$S(I=2:1,I=3:2,I=4:4,I=1:5,I=5:6,I=6:7,I=7:8,1:"") D SEG
"RTN","PSOHLSNC",149,0)
 Q
"RTN","PSOHLSNC",150,0)
ZSC ;Build ZSC segment
"RTN","PSOHLSNC",151,0)
 S PSOLIMIT=6 X PSONFLD
"RTN","PSOHLSNC",152,0)
 S PSOXFLD(0)="ZSC"
"RTN","PSOHLSNC",153,0)
 S PSOXFLD(1)=$S($P(^PS(52.41,PSOPND,0),"^",16)="SC":1,$P(^(0),"^",16)="NSC":0,1:"")
"RTN","PSOHLSNC",154,0)
 S PSOXFLD(2)=$P($G(^PS(52.41,PSOPND,"IBQ")),"^"),PSOXFLD(3)=$P($G(^("IBQ")),"^",2),PSOXFLD(4)=$P($G(^("IBQ")),"^",3),PSOXFLD(5)=$P($G(^("IBQ")),"^",4),PSOXFLD(6)=$P($G(^("IBQ")),"^",5),PSOXFLD(7)=$P($G(^("IBQ")),"^",6)
"RTN","PSOHLSNC",155,0)
 D SEG
"RTN","PSOHLSNC",156,0)
 Q
"RTN","PSOHLSNC",157,0)
SEG ;
"RTN","PSOHLSNC",158,0)
 S PSOSEGMT="" F PSOHJJ=0:1:PSOLIMIT S PSOSEGMT=$S(PSOSEGMT="":PSOXFLD(PSOHJJ),1:PSOSEGMT_"|"_PSOXFLD(PSOHJJ))
"RTN","PSOHLSNC",159,0)
 S PSOHCT=PSOHCT+1,MSG(PSOHCT)=PSOSEGMT
"RTN","PSOHLSNC",160,0)
 Q
"RTN","PSOHLUP")
0^61^B20030650
"RTN","PSOHLUP",1,0)
PSOHLUP ;BIR/RTR-Backfill OERR from Pharmacy ;7/20/96
"RTN","PSOHLUP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**5,225**;DEC 1997;Build 29
"RTN","PSOHLUP",3,0)
 ;
"RTN","PSOHLUP",4,0)
 ;Pass in patient DFN
"RTN","PSOHLUP",5,0)
EN(PSOEDFN) ;
"RTN","PSOHLUP",6,0)
INPT N PSOC
"RTN","PSOHLUP",7,0)
 ;S PSOSHH=$$OTF^OR3CONV(PSOEDFN,$S($G(PSOLOUD):0,1:1))
"RTN","PSOHLUP",8,0)
 Q
"RTN","PSOHLUP",9,0)
EN2 ;
"RTN","PSOHLUP",10,0)
 I '$P($G(^PS(55,PSOEDFN,0)),"^",6) D UPD S $P(^PS(55,PSOEDFN,0),"^",6)=1
"RTN","PSOHLUP",11,0)
 Q:'$D(^PS(55,+PSOEDFN,0))!('$G(PSOEDFN))
"RTN","PSOHLUP",12,0)
 Q:$P($G(^PS(55,PSOEDFN,0)),"^",6)=2
"RTN","PSOHLUP",13,0)
 N C,Y,DA,IFN,RXP,DFN,PAT,PSODFN,PSOPPQ,PSOPPQR,PSOYEAR,PSOEST,PSOERSTA,PSOPHSTA,X,T,PRU,PSOCV,PTFLAG,III
"RTN","PSOHLUP",14,0)
 ;W:$G(PSOEWRT) !!,"Please wait. Updating CPRS with patient's Outpatient Meds."
"RTN","PSOHLUP",15,0)
 ;F PSOCV=0:0 S PSOCV=$O(^PS(55,PSOEDFN,"P","A",PSOCV)) Q:'PSOCV  F PSOPPQR=0:0 S PSOPPQR=$O(^PS(55,PSOEDFN,"P","A",PSOCV,PSOPPQR)) Q:'PSOPPQR  D UPD
"RTN","PSOHLUP",16,0)
 S X1=DT,X2=-121 D C^%DTC S PSOYEAR=X
"RTN","PSOHLUP",17,0)
 F PSOPPQ=PSOYEAR:0 S PSOPPQ=$O(^PS(55,PSOEDFN,"P","A",PSOPPQ)) Q:'PSOPPQ  F PSOPPQR=0:0 S PSOPPQR=$O(^PS(55,PSOEDFN,"P","A",PSOPPQ,PSOPPQR)) Q:'PSOPPQR  D PAT D:$D(^PSRX(PSOPPQR,0))&('$P($G(^PSRX(PSOPPQR,"OR1")),"^",2))&('$G(PTFLAG))
"RTN","PSOHLUP",18,0)
 .Q:'$P($G(^PSRX(PSOPPQR,0)),"^",2)
"RTN","PSOHLUP",19,0)
 .S PSOEST=$S($D(^PSRX(PSOPPQR,"STA")):$P($G(^PSRX(PSOPPQR,"STA")),"^"),1:$P($G(^PSRX(PSOPPQR,0)),"^",15)) Q:PSOEST=10!(PSOEST=13)!(PSOEST=16)!(PSOEST=14)
"RTN","PSOHLUP",20,0)
 .D:'$P($G(^PSRX(PSOPPQR,0)),"^",19)
"RTN","PSOHLUP",21,0)
 ..D:'$P($G(^PSRX(PSOPPQR,"SIG")),"^",2) POP^PSOSIGNO(PSOPPQR)
"RTN","PSOHLUP",22,0)
 ..I $P($G(^PSRX(PSOPPQR,"OR1")),"^")']"",+$G(^PSDRUG(+$P(^PSRX(PSOPPQR,0),"^",6),2)) S $P(^PSRX(PSOPPQR,"OR1"),"^")=+$G(^PSDRUG($P(^PSRX(PSOPPQR,0),"^",6),2))
"RTN","PSOHLUP",23,0)
 ..I $G(^PSRX(PSOPPQR,"SIG"))']"" S ^PSRX(PSOPPQR,"SIG")=$P($G(^PSRX(PSOPPQR,0)),"^",10)_"^"_0 S $P(^PSRX(PSOPPQR,0),"^",10)=""
"RTN","PSOHLUP",24,0)
 ..S ^PSRX(PSOPPQR,"STA")=$P($G(^PSRX(PSOPPQR,0)),"^",15) S $P(^PSRX(PSOPPQR,0),"^",15)=""
"RTN","PSOHLUP",25,0)
 ..S PR=0 F  S PR=$O(^PSRX(PSOPPQR,"P",PR)) Q:'PR  D
"RTN","PSOHLUP",26,0)
 ...I '$P($G(^PSRX(PSOPPQR,"P",PR,0)),"^") K ^PSRX(PSOPPQR,"P",PR,0) Q
"RTN","PSOHLUP",27,0)
 ...S ^PSRX("ADP",$E($P(^PSRX(PSOPPQR,"P",PR,0),"^"),1,7),PSOPPQR,PR)=""
"RTN","PSOHLUP",28,0)
 ..S $P(^PSRX(PSOPPQR,0),"^",19)=1
"RTN","PSOHLUP",29,0)
 .W:$G(PSOEWRT) "." D EN^PSOHLSN1(PSOPPQR,"ZC","")
"RTN","PSOHLUP",30,0)
 .Q:'$P($G(^PSRX(PSOPPQR,"OR1")),"^",2)
"RTN","PSOHLUP",31,0)
 .S PSOEST=$P($G(^PSRX(PSOPPQR,"STA")),"^")
"RTN","PSOHLUP",32,0)
 .I +$P($G(^PSRX(PSOPPQR,2)),"^",6),$P($G(^(2)),"^",6)<DT S $P(^PSRX(PSOPPQR,"STA"),"^")=11 D ECAN^PSOUTL(PSOPPQR) S PSOEST=11
"RTN","PSOHLUP",33,0)
 .S PSOERSTA=$S(PSOEST=3:"OH",PSOEST=12:"OD",PSOEST=15:"OD",1:"SC"),PSOPHSTA=$S(PSOEST=0:"CM",PSOEST=1:"IP",PSOEST=4:"IP",PSOEST=5:"ZS",PSOEST=11:"ZE",1:"")
"RTN","PSOHLUP",34,0)
 .D EN^PSOHLSN1(PSOPPQR,PSOERSTA,PSOPHSTA,"")
"RTN","PSOHLUP",35,0)
 S $P(^PS(55,PSOEDFN,0),"^",6)=2
"RTN","PSOHLUP",36,0)
 ;W !,"Finished backfilling!",!
"RTN","PSOHLUP",37,0)
 Q
"RTN","PSOHLUP",38,0)
EN1(PSOEDFN,PSOEWRT) N PSOBCK
"RTN","PSOHLUP",39,0)
 Q:'$G(PSOEDFN)
"RTN","PSOHLUP",40,0)
 S X1=DT,X2=-121 D C^%DTC S PSOYEAR=X
"RTN","PSOHLUP",41,0)
 I $O(^PS(55,PSOEDFN,"P","A",PSOYEAR)) D:'$D(^PS(55,PSOEDFN,0)) ADD(PSOEDFN) D EN2 G INPAT
"RTN","PSOHLUP",42,0)
 D:'$D(^PS(55,PSOEDFN,0))&($D(^PS(55,PSOEDFN))) ADD(PSOEDFN) S:$D(^PS(55,PSOEDFN,0)) $P(^PS(55,PSOEDFN,0),"^",6)=2
"RTN","PSOHLUP",43,0)
INPAT S X="PSJUTL1" X ^%ZOSF("TEST") I $T D CONVERT^PSJUTL1(PSOEDFN,PSOEWRT)
"RTN","PSOHLUP",44,0)
 Q
"RTN","PSOHLUP",45,0)
UPD ;Update OERR if not done yet
"RTN","PSOHLUP",46,0)
 N PSLOOP,PSOPPQR
"RTN","PSOHLUP",47,0)
 F PSLOOP=0:0 S PSLOOP=$O(^PS(55,PSOEDFN,"P","A",PSLOOP)) Q:'PSLOOP  F PSOPPQR=0:0 S PSOPPQR=$O(^PS(55,PSOEDFN,"P","A",PSLOOP,PSOPPQR)) Q:'PSOPPQR  D
"RTN","PSOHLUP",48,0)
 .Q:$G(^PSRX(PSOPPQR,0))=""!('$P($G(^PSRX(PSOPPQR,0)),"^",2))
"RTN","PSOHLUP",49,0)
 .Q:$P(^PSRX(PSOPPQR,0),"^",19)
"RTN","PSOHLUP",50,0)
 .D:'$P($G(^PSRX(PSOPPQR,"SIG")),"^",2) POP^PSOSIGNO(PSOPPQR)
"RTN","PSOHLUP",51,0)
 .I $P($G(^PSRX(PSOPPQR,"OR1")),"^")']"",+$G(^PSDRUG(+$P(^PSRX(PSOPPQR,0),"^",6),2)) S $P(^PSRX(PSOPPQR,"OR1"),"^")=+$G(^PSDRUG($P(^PSRX(PSOPPQR,0),"^",6),2))
"RTN","PSOHLUP",52,0)
 .I $G(^PSRX(PSOPPQR,"SIG"))']"" S ^PSRX(PSOPPQR,"SIG")=$P($G(^PSRX(PSOPPQR,0)),"^",10)_"^"_0 S $P(^PSRX(PSOPPQR,0),"^",10)=""
"RTN","PSOHLUP",53,0)
 .I $G(^PSRX(PSOPPQR,"STA"))']"" S ^PSRX(PSOPPQR,"STA")=$P($G(^PSRX(PSOPPQR,0)),"^",15) S $P(^PSRX(PSOPPQR,0),"^",15)=""
"RTN","PSOHLUP",54,0)
 .S PRU=0 F  S PRU=$O(^PSRX(PSOPPQR,"P",PRU)) Q:'PRU  D
"RTN","PSOHLUP",55,0)
 ..I '$P($G(^PSRX(PSOPPQR,"P",PRU,0)),"^") K ^PSRX(PSOPPQR,"P",PRU,0) Q
"RTN","PSOHLUP",56,0)
 ..S ^PSRX("ADP",$E($P(^PSRX(PSOPPQR,"P",PRU,0),"^"),1,7),PSOPPQR,PRU)=""
"RTN","PSOHLUP",57,0)
 .S $P(^PSRX(PSOPPQR,0),"^",19)=1
"RTN","PSOHLUP",58,0)
 Q
"RTN","PSOHLUP",59,0)
PAT ;Check for correct patient
"RTN","PSOHLUP",60,0)
 S PTFLAG=0
"RTN","PSOHLUP",61,0)
 Q:PSOEDFN=$P($G(^PSRX(PSOPPQR,0)),"^",2)
"RTN","PSOHLUP",62,0)
 S PTFLAG=1
"RTN","PSOHLUP",63,0)
 K ^PS(55,PSOEDFN,"P","A",PSOPPQ,PSOPPQR)
"RTN","PSOHLUP",64,0)
 F III=0:0 S III=$O(^PS(55,PSOEDFN,"P",III)) Q:'III  I $G(^PS(55,PSOEDFN,"P",III,0))=PSOPPQR K ^PS(55,PSOEDFN,"P",III,0)
"RTN","PSOHLUP",65,0)
 Q
"RTN","PSOHLUP",66,0)
ADD(PATIEN) ;Add patient to 55 (0 node)
"RTN","PSOHLUP",67,0)
 Q:$D(^PS(55,PATIEN,0))
"RTN","PSOHLUP",68,0)
 N X,Y,DA,DIK
"RTN","PSOHLUP",69,0)
 S ^PS(55,PATIEN,0)=PATIEN K DIK S DA=PATIEN,DIK="^PS(55,",DIK(1)=.01 D EN^DIK
"RTN","PSOHLUP",70,0)
 Q
"RTN","PSOLBL")
0^7^B63143813
"RTN","PSOLBL",1,0)
PSOLBL ;BIR/SAB/RTR-BOTTLE LABEL ;5/9/07 8:57am
"RTN","PSOLBL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**8,19,30,36,47,71,92,120,157,244,206,225**;DEC 1997;Build 29
"RTN","PSOLBL",3,0)
 ;DBIAs PSDRUG-221, PS(55-2228, IBARX-125, PSXSRP-2201, %ZIS-3435, DPT-3097
"RTN","PSOLBL",4,0)
 ;
"RTN","PSOLBL",5,0)
 ;*244 rem test for part fill when testing status > 11
"RTN","PSOLBL",6,0)
 ;
"RTN","PSOLBL",7,0)
DQ I $D(PSOIOS),PSOIOS]"" D DEVBAR^PSOBMST
"RTN","PSOLBL",8,0)
 I $G(PSOBAR0)]"",$G(PSOBAR1)]"",$D(^PS(59,PSOSITE,1)) S PSOBARS=1
"RTN","PSOLBL",9,0)
DQ1 D ^PSOLBL4
"RTN","PSOLBL",10,0)
 I $G(IOST(0)),$D(^%ZIS(2,IOST(0),55,"B","LL")) G ^PSOLLLI
"RTN","PSOLBL",11,0)
 G:'$D(PPL) HLEX G:($P($G(PSOPAR),"^",30)=2)&('$G(PSOEXREP)) HLEX K RXFLX S PSOCKHN=","_$G(PPL) S PSRESOLV=+PPL D CHECK F PI=1:1  D  S RX=$P(PPL,",",PI) D C Q:$G(PSOLAPPL)  D:$G(PSDFNFLG) TRAIL^PSOLBL2 K RXP,REPRINT
"RTN","PSOLBL",12,0)
 .S (PSDFNFLG,PSOLAPPL)=0 S NEXTRX=$P(PPL,",",(PI+1)) I NEXTRX=""!(NEXTRX=",") S PSOLAPPL=1 Q
"RTN","PSOLBL",13,0)
 .I PSOPDFN'=$P(^PSRX(NEXTRX,0),"^",2) S PSDFNFLG=1,PSOPDFN=$P(^PSRX(NEXTRX,0),"^",2) Q
"RTN","PSOLBL",14,0)
 I $P(^PS(59,PSOSITE,1),"^",28) D ^PSOLBLN2
"RTN","PSOLBL",15,0)
 D:'$P(^PS(59,PSOSITE,1),"^",28) ^PSOLBLS
"RTN","PSOLBL",16,0)
DQ5 I $D(^TMP($J,"PSOCP",DFN)),'$P(^PS(59,PSOSITE,1),"^",28) D INV^PSOCPE
"RTN","PSOLBL",17,0)
HLEX K RXPI,PSORX,RXP,PSOIOS,PSOLAPPL,XXX,COPAYVAR,TECH,PHYS,MFG,NURSE,STATE,SIDE,COPIES,EXDT,ISD,PSOINST,RXN,RXY,VADT,DEA,WARN,FDT,QTY,PATST,PDA,PS,PS1,PS2,PSL,PSNP,INRX,RR,XTYPE,SSNP,SSNPN,PNM,ADDR,PSODBQ,PSOLASTF,PSRESOLV,PSOEXREP,PSOSXQ
"RTN","PSOLBL",18,0)
 K ^TMP($J,"PSOCP",+$G(PSOCPN)),PSOCPN,PSOLBLDR,PSOLBLPS,PSOLBLCP,RXPR,RXRP,RXRS,PSOCKHN,RXFLX,PSOLAPPL,PSOPDFN,PSDFNFLG,PSOZERO,NEXTRX,PSOBLALL,STA S:'$G(PSOSUREP)&('$G(PSOSUSPR)) ZTREQ="@" Q
"RTN","PSOLBL",19,0)
C I $G(IOST(0)),$D(^%ZIS(2,IOST(0),55,"B","LL")) G C^PSOLLLI
"RTN","PSOLBL",20,0)
 U IO S X=$S('$P(^PS(59,PSOSITE,1),"^",28):132,1:158) X ^%ZOSF("RM") Q:'$D(^PSRX(RX,0))
"RTN","PSOLBL",21,0)
 S:$G(PSOBLALL) PSOBLRX=RX
"RTN","PSOLBL",22,0)
 S:$D(RXRP(RX)) REPRINT=1 S:$D(RXPR(RX)) RXP=RXPR(RX)
"RTN","PSOLBL",23,0)
 I $G(PSOSUREP)!($G(PSOEXREP)) S REPRINT=1 S:'$G(RXRP(RX)) RXRP(RX)=1
"RTN","PSOLBL",24,0)
 S RXY=^PSRX(RX,0),RXSTA=$P(^PSRX(RX,"STA"),"^") I RXSTA>11 D AL("QT") K RXY,RXP,REPRINT Q         ;*244
"RTN","PSOLBL",25,0)
 I RXSTA=3 D AL("QT") K RXY,RXP,REPRINT Q
"RTN","PSOLBL",26,0)
 I $G(RXPR(RX)),'$D(^PSRX(RX,"P",RXP,0)) K RXY,RXP,REPRINT Q
"RTN","PSOLBL",27,0)
 I $P($G(RXFL(RX)),"^"),'$D(^PSRX(RX,1,$P($G(RXFL(RX)),"^"),0)) K RXY,RXP,REPRINT Q
"RTN","PSOLBL",28,0)
 I $G(PSODBQ)!($G(RXRS(RX))) S RR=$O(^PS(52.5,"B",RX,0)) Q:'RR  I $G(^PS(52.5,RR,"P"))=1 K RXY,RXP,REPRINT Q
"RTN","PSOLBL",29,0)
 I $G(RXRS(RX))!($G(PSOPULL)) S PSOSXQ=0 N DR,DA,DIE D  I $G(PSOSXQ) K RXY,RXP,REPRINT Q
"RTN","PSOLBL",30,0)
 .S DA=$O(^PS(52.5,"B",RX,0)) Q:'DA  S A=$P($G(^PS(52.5,DA,0)),"^",7) Q:A=""
"RTN","PSOLBL",31,0)
 .I A="Q" S DIE="^PS(52.5,",DR="3////P" D ^DIE Q
"RTN","PSOLBL",32,0)
 .K RXRS(RX) S PSOSXQ=1
"RTN","PSOLBL",33,0)
 I $G(PSRESOLV)=RX D ENLBL^PSOBSET K PSRESOLV
"RTN","PSOLBL",34,0)
 I RXSTA'=4 D:$G(PSOSUSPR) AREC^PSOSUTL D:$G(PSOPULL)!($G(RXRS(RX))) AREC1^PSOSUTL D:$G(PSOSUREP) AREC^PSOSUSRP D:$G(PSXREP) AREC^PSXSRP
"RTN","PSOLBL",35,0)
 K ^UTILITY("DIQ1",$J) S DA=$P($$SITE^VASITE(),"^") I $G(DA) S DIC=4,DIQ(0)="I",DR="99" D EN^DIQ1 S PSOINST=$G(^UTILITY("DIQ1",$J,4,DA,99,"I")) K ^UTILITY("DIQ1",$J),DA,DR,DIC
"RTN","PSOLBL",36,0)
 S RXN=$P(RXY,"^"),ISD=$P(RXY,"^",13),RXF=0,DFN=+$P(RXY,"^",2),SIG=$P($G(^PSRX(RX,"SIG")),"^"),ISD=$E(ISD,4,5)_"/"_$E(ISD,6,7)_"/"_($E(ISD,1,3)+1700),ZY=0,$P(LINE,"_",28)="_"
"RTN","PSOLBL",37,0)
 S PSOLBLPS=+$P(RXY,"^",3),PSOLBLDR=+$P(RXY,"^",6)
"RTN","PSOLBL",38,0)
 S NURSE=$S($P($G(^DPT(DFN,"NHC")),"^")="Y":1,$P($G(^PS(55,DFN,40)),"^"):1,1:0) S FDT=$P(^PSRX(RX,2),"^",2),PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:""),PS1=$S($D(^(1)):^(1),1:""),PSOSITE7=$P(^("IB"),"^")
"RTN","PSOLBL",39,0)
 S PS2=$P(PS,"^")_"^"_$P(PS,"^",6)
"RTN","PSOLBL",40,0)
 S (EXPDT,EXDT)=$P(^PSRX(RX,2),"^",6),EXDT=$S('EXDT:"",1:$E(EXDT,4,5)_"/"_$E(EXDT,6,7)_"/"_($E(EXDT,1,3)+1700))
"RTN","PSOLBL",41,0)
 S COPIES=$S($P($G(RXRP(RX)),"^",2):$P($G(RXRP(RX)),"^",2),$P(RXY,"^",18)]"":$P(RXY,"^",18),1:1)
"RTN","PSOLBL",42,0)
 K PSOCKHNX S PSOCKHL=$L(RX),PSOCKHN=$E($G(PSOCKHN),(PSOCKHL+2),999) D  K PSOCKHNX,PSOCKHL,PSOCKHA
"RTN","PSOLBL",43,0)
 .S PSOCKHA=","_RX_","
"RTN","PSOLBL",44,0)
 .I PSOCKHN'[PSOCKHA Q
"RTN","PSOLBL",45,0)
 .S PSOCKHA=$E(PSOCKHA,1,($L(PSOCKHA)-1))
"RTN","PSOLBL",46,0)
 .S PSOCKHNX=$L(PSOCKHN,PSOCKHA)-1
"RTN","PSOLBL",47,0)
 .I +$G(PSOCKHNX)>0 D DOUB
"RTN","PSOLBL",48,0)
 I $O(^PSRX(RX,1,0)),$G(RXFL(RX))'=0 S $P(^PSRX(RX,3),"^",6)="" K ^PSRX(RX,"DAI"),^PSRX(RX,"DRI")
"RTN","PSOLBL",49,0)
 I '$G(RXP),'$O(^PSRX(RX,1,0)) S RXFL(RX)=0
"RTN","PSOLBL",50,0)
 I '$G(RXP) D OSET I '$O(^PSRX(RX,1,0))!($G(RXFL(RX))=0) G ORIG
"RTN","PSOLBL",51,0)
 I $O(^PSRX(RX,1,0)),'$G(RXP),'$G(RXFL(RX)) S XTYPE=1 D REF G STA
"RTN","PSOLBL",52,0)
 I $O(^PSRX(RX,1,0)),'$G(RXP),$G(RXFL(RX)) G STA
"RTN","PSOLBL",53,0)
 I $G(RXP) S XTYPE="P" D REF G STA
"RTN","PSOLBL",54,0)
ORIG S TECH=$P($G(^VA(200,+$P(^PSRX(RX,0),"^",16),0)),"^"),QTY=$P(^PSRX(RX,0),"^",7),PHYS=$S($D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UKN") D 6^VADPT,PID^VADPT S SSNPN=$E($G(VA("PID")),5,12)
"RTN","PSOLBL",55,0)
 S DAYS=$P(^PSRX(RX,0),"^",8),MFG="________",LOT="________"
"RTN","PSOLBL",56,0)
STA S STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UKN")
"RTN","PSOLBL",57,0)
 S DRUG=$$ZZ^PSOSUTL(RX),DEA=$P($G(^PSDRUG(+$P(RXY,"^",6),0)),"^",3),WARN=$P($G(^(0)),"^",8)
"RTN","PSOLBL",58,0)
 S SIDE=$S($P($G(RXRP(RX)),"^",3):1,1:0)
"RTN","PSOLBL",59,0)
 I $G(^PSRX(RX,"P",+$G(RXP),0))]"" S RXPI=RXP D
"RTN","PSOLBL",60,0)
 .S RXP=^PSRX(RX,"P",RXP,0)
"RTN","PSOLBL",61,0)
 .S RXY=$P(RXP,"^")_"^"_$P(RXY,"^",2,6)_"^"_$P(RXP,"^",4)_"^"_$P(RXP,"^",10)_"^"_$P(RXY,"^",9)_"^"_$P($G(^PSRX(RX,"SIG")),"^",2)_"^"_$P(RXP,"^",2)_"^"_$P(RXY,"^",12,14)_"^"_$P(^PSRX(RX,"STA"),"^")_"^"_$P(RXP,"^",7)_"^"_$P(RXY,"^",17,99)
"RTN","PSOLBL",62,0)
 .S FDT=$P(RXP,"^")
"RTN","PSOLBL",63,0)
 S MW=$P(RXY,"^",11) I $G(RXFL(RX))'=0 D:$G(RXFL(RX))  I '$G(RXFL(RX)) F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  S RXF=RXF+1 S:'$G(RXP) MW=$P(^PSRX(RX,1,I,0),"^",2) I +^PSRX(RX,1,I,0)'<FDT S FDT=+^(0)
"RTN","PSOLBL",64,0)
 .I $G(RXFL(RX)),'$D(^PSRX(RX,1,RXFL(RX),0)) K RXFL(RX) Q
"RTN","PSOLBL",65,0)
 .S RXF=RXFL(RX) S:'$G(RXP) MW=$P($G(^PSRX(RX,1,RXF,0)),"^",2) I +^PSRX(RX,1,RXF,0)'<FDT S FDT=+^(0)
"RTN","PSOLBL",66,0)
 I MW="W" S PSMP=$G(^PSRX(RX,"MP")) I PSMP]"" D
"RTN","PSOLBL",67,0)
 .S PSJ=0 F PSI=1:1:$L(PSMP) S PSMP(PSI)="",PSJ=PSJ+1 F PSJ=PSJ:1 S PSMP(PSI)=PSMP(PSI)_$P(PSMP," ",PSJ)_" " Q:($L(PSMP(PSI))+$L($P(PSMP," ",PSJ+1))>30)
"RTN","PSOLBL",68,0)
 .K PSMP(PSI)
"RTN","PSOLBL",69,0)
 S X=$S($D(^PS(55,DFN,0)):^(0),1:""),PSCAP=$P(X,"^",2),PS55=$P($G(X),"^",3),PS55X=$P($G(X),"^",5)
"RTN","PSOLBL",70,0)
 I (($G(PS55X)]"")&(PS55>1)&(PS55X<DT)) S PS55=0
"RTN","PSOLBL",71,0)
 S:MW="M" MW=$S((PS55=1!(PS55=4)):"R",1:MW)
"RTN","PSOLBL",72,0)
 S MW=$S(MW="M":"REGULAR",MW="R":"CERTIFIED",1:"WINDOW")
"RTN","PSOLBL",73,0)
 I ($G(PSMP(1))']""&($G(PS55)=2)) S PSMP(1)=$G(SSNPN)
"RTN","PSOLBL",74,0)
 ;S X=$S($D(^PS(55,DFN,0)):^(0),1:""),PSCAP=$P(X,"^",2) S:MW="M" MW=$S(+$P(X,"^",3):"R",1:MW) S MW=$S(MW="M":"REGULAR",MW="R":"CERTIFIED",1:"WINDOW")
"RTN","PSOLBL",75,0)
 S DATE=$E(FDT,1,7),REF=$P(RXY,"^",9)-RXF S:'$G(RXP) $P(^PSRX(RX,3),"^")=FDT S:REF<1 REF=0 D ^PSOLBL2 S II=RX D ^PSORFL,RFLDT^PSORFL
"RTN","PSOLBL",76,0)
 S PATST=$G(^PS(53,+$P(RXY,"^",3),0)) S PRTFL=1 I REF=0 S:('$P(PATST,"^",5))!(DEA["W")!(DEA[1)!(DEA[2) PRTFL=0
"RTN","PSOLBL",77,0)
 S VRPH=$P(^PSRX(RX,2),"^",10),PSCLN=+$P(RXY,"^",5),PSCLN=$S($D(^SC(PSCLN,0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLBL",78,0)
 S PATST=$P(PATST,"^",2),X1=DT,X2=$P(RXY,"^",8)-10 D C^%DTC:REF I $D(^PSRX(RX,2)),$P(^(2),"^",6),REF,X'<$P(^(2),"^",6) S REF=0,VRPH=$P(^(2),"^",10)
"RTN","PSOLBL",79,0)
 I $G(PSOCHAMP),$G(PSOTRAMT) S COPAYVAR="CHAMPUS" G LBL
"RTN","PSOLBL",80,0)
 I $G(RXP) S COPAYVAR="" G LBL
"RTN","PSOLBL",81,0)
 I $P($G(^PS(53,+$G(PSOLBLPS),0)),"^",7) D SNO G LBL
"RTN","PSOLBL",82,0)
 I $P($G(^PSDRUG(+$G(PSOLBLDR),0)),"^",3)["I"!($P($G(^(0)),"^",3)["S") D SNO G LBL
"RTN","PSOLBL",83,0)
 I $P(^PSRX(RX,"STA"),"^")>0,$P(^("STA"),"^")'=2,'$G(PSODBQ) D SNO G LBL
"RTN","PSOLBL",84,0)
 I $G(PSOLBLCP)="" D IBCP
"RTN","PSOLBL",85,0)
 N PSOQI S PSOQI=$G(^PSRX(RX,"IBQ")) I $G(PSOLBLCP)=0 D SNO G LBL
"RTN","PSOLBL",86,0)
 I $G(PSOLBLCP)=1 I $P(PSOQI,"^",2)!($P(PSOQI,"^",3))!($P(PSOQI,"^",4))!($P(PSOQI,"^",5))!($P(PSOQI,"^",6))!($P(PSOQI,"^",7))!($P(PSOQI,"^",8)) D SNO G LBL
"RTN","PSOLBL",87,0)
 I $G(PSOLBLCP)=2 I $P(PSOQI,"^")!($P(PSOQI,"^",2))!($P(PSOQI,"^",3))!($P(PSOQI,"^",4))!($P(PSOQI,"^",5))!($P(PSOQI,"^",6))!($P(PSOQI,"^",7))!($P(PSOQI,"^",8)) D SNO G LBL
"RTN","PSOLBL",88,0)
 I $G(PSOLBLCP)=2,'$P($G(^PSRX(RX,"IB")),"^") D SNO G LBL
"RTN","PSOLBL",89,0)
 S PSOCPN=$P(^PSRX(RX,0),"^",2),INRX=$P(^(0),"^") I $G(^TMP($J,"PSOCP",PSOCPN))="" S ^(PSOCPN)=PSOCPN
"RTN","PSOLBL",90,0)
 S ^TMP($J,"PSOCP",PSOCPN,INRX)=INRX_"^"_$$ZZ^PSOSUTL(RX)_"^"_+$G(DAYS) S COPAYVAR="COPAY" K ZDRUG
"RTN","PSOLBL",91,0)
LBL G ^PSOLBLD:$P(^PSRX(RX,"STA"),"^")=4 D ^PSOLBLD:$D(^PSRX(RX,"DRI"))&('$G(RXF))&('$G(RXP)) D:$P($G(^PSRX(RX,3)),"^",6)&('$G(RXF))&('$G(RXP)) ^PSOLBLD1 G ^PSOLBL1:'$P(^PS(59,PSOSITE,1),"^",28)
"RTN","PSOLBL",92,0)
 G ^PSOLBLN
"RTN","PSOLBL",93,0)
REF F XXX=0:0 S XXX=$O(^PSRX(RX,XTYPE,XXX)) Q:+XXX'>0  D
"RTN","PSOLBL",94,0)
 .S TECH=$S($D(^VA(200,+$P(^PSRX(RX,XTYPE,XXX,0),"^",7),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSOLBL",95,0)
 .S QTY=$P(^PSRX(RX,XTYPE,XXX,0),"^",4),PHYS=$S($D(^VA(200,+$P(^PSRX(RX,XTYPE,XXX,0),"^",17),0)):$P(^(0),"^"),$D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UNKNOWN") D 6^VADPT,PID^VADPT S SSNPN=$E($G(VA("PID")),5,12)
"RTN","PSOLBL",96,0)
 .S DAYS=$P(^PSRX(RX,XTYPE,XXX,0),"^",10),LOT="________",MFG="________"
"RTN","PSOLBL",97,0)
 Q
"RTN","PSOLBL",98,0)
CHECK S PSDFNFLG=0,PSOZERO=$P(PPL,","),PSOPDFN=$P(^PSRX(PSOZERO,0),"^",2)
"RTN","PSOLBL",99,0)
 Q
"RTN","PSOLBL",100,0)
OSET D OSET^PSOLBL1
"RTN","PSOLBL",101,0)
 Q
"RTN","PSOLBL",102,0)
DOUB Q:'$D(RXFL(RX))  I +$G(RXFL(RX))-PSOCKHNX<0 Q
"RTN","PSOLBL",103,0)
 S RXFLX(RX)=$G(RXFL(RX)),RXFL(RX)=$G(RXFL(RX))-PSOCKHNX
"RTN","PSOLBL",104,0)
 Q
"RTN","PSOLBL",105,0)
AL(T) N I,IR,RF,USR,TY,DES S USR=""
"RTN","PSOLBL",106,0)
 I T="UT" D
"RTN","PSOLBL",107,0)
 .N J,RX S USR=$G(DUZ),TY="B",DES="Label never queued to print by User"
"RTN","PSOLBL",108,0)
 .F J=1:1  S RX=+$P(PPL,",",J) Q:'RX  D AL1
"RTN","PSOLBL",109,0)
 I T="QT" D
"RTN","PSOLBL",110,0)
 .S I=+$P(^PSRX(RX,"STA"),"^"),TY=$S((I=3)!(I=16):"H",I=13:"D",1:"C")
"RTN","PSOLBL",111,0)
 .S DES=I_" "_$S((I=3)!(I=16):"HOLD"_$S(I=16:"(PROVIDER)",1:""),(I=12)!(I=14)!(I=15):"DISCONTINUED"_$S(I=14:"(PROVIDER)",I=15:"(EDIT)",1:""),I=13:"DELETED",1:"")
"RTN","PSOLBL",112,0)
 .S DES="Queued label terminated - "_DES D AL1
"RTN","PSOLBL",113,0)
 K %,%H,%I Q
"RTN","PSOLBL",114,0)
AL1 S (IR,I,RF)=0 F  S I=$O(^PSRX(RX,1,I)) Q:'I  S RF=I S:I>5 RF=I+1
"RTN","PSOLBL",115,0)
 S I=0 F  S I=$O(^PSRX(RX,"A",I)) Q:'I  S IR=I
"RTN","PSOLBL",116,0)
 S IR=IR+1,^PSRX(RX,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSOLBL",117,0)
 D NOW^%DTC S ^PSRX(RX,"A",IR,0)=%_"^"_TY_"^"_USR_"^"_$S($G(RXPR(RX)):6,1:RF)_"^"_DES
"RTN","PSOLBL",118,0)
 Q
"RTN","PSOLBL",119,0)
IBCP N X,Y,PSOJJ,PSOLL
"RTN","PSOLBL",120,0)
 S PSOLBLCP="",X=$P($G(^PS(59,+$G(PSOSITE),"IB")),"^")_"^"_$G(DFN) D XTYPE^IBARX
"RTN","PSOLBL",121,0)
 S PSOJJ="" F  S PSOJJ=$O(Y(PSOJJ)) Q:'PSOJJ  S PSOLL="" F  S PSOLL=$O(Y(PSOJJ,PSOLL)) Q:PSOLL=""  S:PSOLL>0 PSOLBLCP=PSOLL
"RTN","PSOLBL",122,0)
 I '$G(PSOLBLCP) S PSOLBLCP=0
"RTN","PSOLBL",123,0)
 Q
"RTN","PSOLBL",124,0)
SNO S COPAYVAR="NO COPAY" Q
"RTN","PSOLBL1")
0^23^B29469598
"RTN","PSOLBL1",1,0)
PSOLBL1 ;BHAM ISC/SAB - PRINTS LABEL ;1/20/93 14:25
"RTN","PSOLBL1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**107,110,225**;DEC 1997;Build 29
"RTN","PSOLBL1",3,0)
START S COPIES=COPIES-1
"RTN","PSOLBL1",4,0)
 W $C(13) S $X=0 W "VA (119)",?10,$E(DT,4,5),"/",$E(DT,6,7),"/",$E(DT,2,3) W:('SIDE)&(PRTFL) ?40,"PLEASE REFER ONLY TO '",$S(REF:"1. REFILL REQUEST",1:"2. RENEWAL ORDER"),"'" W:+$G(RXP) ?100,"(PARTIAL)" W:$D(REPRINT) ?110,"(REPRINT)"
"RTN","PSOLBL1",5,0)
 W !,$P(PS,"^",2) W:('SIDE)&(PRTFL) ?40,"INSTRUCTION ON REVERSE SIDE OF THIS FORM" W:'SIDE ?102,"(Filled at ",$P(PS2,"^",2),")"
"RTN","PSOLBL1",6,0)
 W !,$P(PS,"^",7),", ",STATE,"  ",$P(PS,"^",5) W:'SIDE ?83,"*** ",$P(PS2,"^")," ***"
"RTN","PSOLBL1",7,0)
 W !,?22,$S(MW["C":"CERTIFIED MAIL",1:"") W:'SIDE ?38,SSNP,?69,"RX: ",RXN
"RTN","PSOLBL1",8,0)
 W !,?2,PNM W:'SIDE ?38,PNM,?64,"EXPIRES: ",EXDT W:('SIDE)&(PRTFL) ?83,"INDICATE ANY ADDRESS CHANGES"
"RTN","PSOLBL1",9,0)
 W !,?2,$S($D(PSMP(1)):PSMP(1),1:VAPA(1)) W:'SIDE ?38,$E(VAPA(1),1,25),?64,"REFILLS: ",REF ;W:('SIDE)&(PRTFL) ?83,LINE 
"RTN","PSOLBL1",10,0)
 W:('SIDE)&(PRTFL) ?83,"_____PERM.   _____TEMP." W:'PRTFL ?83,"* A 'NEW' RX IS REQUIRED.        *"
"RTN","PSOLBL1",11,0)
 S ADDR(3)=VAPA(4)_", "_$P($G(^DIC(5,+$P(VAPA(5),"^"),0)),"^",2)_"  "_VAPA(6),ADDR(2)="" S:VAPA(2)]"" ADDR(2)=VAPA(2)_" "_VAPA(3)
"RTN","PSOLBL1",12,0)
 I ADDR(2)="" S ADDR(2)=ADDR(3),ADDR(3)=""
"RTN","PSOLBL1",13,0)
 S ADDR(5)=$E(VAPA(4),1,13)_", "_$P($G(^DIC(5,+$P(VAPA(5),"^"),0)),"^",2)_"  "_VAPA(6)
"RTN","PSOLBL1",14,0)
 W !,?2,$S($D(PSMP(2)):PSMP(2),$D(PSMP(1)):"",1:$E(ADDR(2),1,35)) W:'SIDE ?38,$S($G(ADDR(3))="":ADDR(5),1:$E(ADDR(2),1,24)),?62,$S(RFLMSG]"":"*",1:" "),"LST FILL: "
"RTN","PSOLBL1",15,0)
 W:'SIDE $G(PSOLASTF)
"RTN","PSOLBL1",16,0)
 I 'SIDE W:PRTFL ?83,"ADDRESS: ",$E(LINE,1,23) W:'PRTFL ?83,"********** PLEASE NOTE ***********"
"RTN","PSOLBL1",17,0)
 W !,?2,$S($D(PSMP(3)):PSMP(3),$D(PSMP(1)):"",1:ADDR(3)) I 'SIDE W ?38,$S(ADDR(3)'="":ADDR(5),1:""),?64,"ROUTING: ",$S(MW="REGULAR":"MAIL",1:MW) W:PRTFL ?83,"CITY/STATE/ZIP: ",$E(LINE,1,16) W:'PRTFL ?83,"* THIS RX CAN NOT BE 'RENEWED'.  *"
"RTN","PSOLBL1",18,0)
 ;NEW LABEL WHITE SPACE
"RTN","PSOLBL1",19,0)
 I +$G(PSOBARS),'SIDE,$P(PSOPAR,"^",19)'=1 S X="S",X2=PSOINST_"-"_RX W !,?40 S X1=$X W @PSOBAR1,X2,@PSOBAR0,$C(13),!,$S($G(PS55)=2:"***DO NOT MAIL***",1:"**CRITICAL MEDICAL SHIPMENT**"),!
"RTN","PSOLBL1",20,0)
 E  F NLWS=1:1:6 W ! W:NLWS=5 $S($G(PS55)=2:"***DO NOT MAIL***",1:"**CRITICAL MEDICAL SHIPMENT**")
"RTN","PSOLBL1",21,0)
 W !,?8,"VA Medical Center" I 'SIDE W ?38,INT(1)
"RTN","PSOLBL1",22,0)
 W !,$P(PS,"^"),"  ",$P(PS,"^",3),"-",$P(PS,"^",4) W:'SIDE ?38,INT(2) I 'SIDE W:PRTFL ?83 W:'PRTFL ?83,"* PLEASE CONTACT YOUR PHYSICIAN. *"
"RTN","PSOLBL1",23,0)
 W !,?4,RXN,?15,$E(DATE,4,5),"/",$E(DATE,6,7),"/",$E(DATE,2,3),"   (",RXF+1," OF ",1+$P(RXY,"^",9),")" I 'SIDE W ?38,INT(3) W:(PRTFL)&('REF) ?83,"***** FOR PHYSICIAN USE ONLY *****" W:'PRTFL ?83,"**********************************"
"RTN","PSOLBL1",24,0)
 W !,PNM,?29,"#",$P(RXY,"^",7)
"RTN","PSOLBL1",25,0)
 W:'SIDE ?38,"CAP: ",$S(PSCAP:"**NON-SFTY**",1:"SAFETY")," WARN:",WARN,?68,$E(DATE,4,5),"/",$E(DATE,6,7),"/",$E(DATE,2,3)," " S I1=$P($H,",",2)\60 W:'SIDE I1\60,":",(I1#60\10)_(I1#10) W:('SIDE)&(PRTFL) ?83,"SIGNATURE : ",$E(LINE,1,20)
"RTN","PSOLBL1",26,0)
SIG F DR=1:1:$S(SGC<5:4,1:6) D SIG1
"RTN","PSOLBL1",27,0)
 I SGC>4 F I=1:1:22 W ! I I>22-SGC S DR=DR+1,X=$S($D(SGY(DR)):SGY(DR),1:"") W X W:'SIDE ?38,X
"RTN","PSOLBL1",28,0)
 ;I SGC>4 F I=1:1:$S($P($G(PSOPAR),"^",10):22,1:16) W ! I I>($S($P($G(PSOPAR),"^",10):28,1:22)-SGC) S DR=DR+1,X=$S($D(SGY(DR)):SGY(DR),1:"") W X W:'SIDE ?38,X
"RTN","PSOLBL1",29,0)
 W !?3,$E(PHYS,1,14),?25,"(",$P(RXY,"^",16),"/",$S($D(VRPH):VRPH,1:" "),")" W:'SIDE ?38,DRUG,?38+$L(DRUG)," (QTY:",$P(RXY,"^",7)," DAYS:",$P(RXY,"^",8)," FILL: ",RXF+1," OF ",1+$P(RXY,"^",9)," ISD:",ISD,")"
"RTN","PSOLBL1",30,0)
 W !,DRUG W:'SIDE ?38,PHYS,?62,RFLMSG,?100,PATST,"  ",PSCLN
"RTN","PSOLBL1",31,0)
 I $D(PSOBARS),PSOBARS W $C(13),# S $X=0
"RTN","PSOLBL1",32,0)
 E  W !
"RTN","PSOLBL1",33,0)
 I COPIES>0 S SIDE=1 G START
"RTN","PSOLBL1",34,0)
 ;STORE LABEL PRINT NODE
"RTN","PSOLBL1",35,0)
 D NOW^%DTC S NOW=% K %,%H,%I S RXF=0 F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  S RXF=I
"RTN","PSOLBL1",36,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(RX,"L",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOLBL1",37,0)
 S IR=IR+1,^PSRX(RX,"L",0)="^52.032DA^"_IR_"^"_IR
"RTN","PSOLBL1",38,0)
 S ^PSRX(RX,"L",IR,0)=NOW_"^"_$S($G(RXP):99-RXPI,1:RXF)_"^"_$S($G(PCOMX)]"":$G(PCOMX),1:"From RX number "_$P(^PSRX(RX,0),"^"))_$S($G(RXP):" (Partial)",1:"")_$S($D(REPRINT):" (Reprint)",1:"")_"^"_PDUZ
"RTN","PSOLBL1",39,0)
 S ^PSRX(RX,"TYPE")=0 K RXF,IR,FDA,NOW,I
"RTN","PSOLBL1",40,0)
 I '$D(PSSPND),$P(PSOPAR,"^",18) D CHCK2^PSOTRLBL
"RTN","PSOLBL1",41,0)
END K PSCLN,%DT,ADDR,DATE,DEA,DR,DR1,DRX,DRUG,FDT,SGY,RXY,RXZ,RYY,RFLMSG,RFL,%H,COPIES,DOB,DRUG,LIM,LMI,LINE,PS,PS1,PS2,INT,ISD,I1,MW,MAIL,STATE,SIDE,SSNP,SS,ST,ST1,PATST,PRTFL,PHYS,PNM,S,SL,SGC,PSMP,PSI,PSJ,VRPH,REPRINT,PS55,PS55X Q
"RTN","PSOLBL1",42,0)
 Q
"RTN","PSOLBL1",43,0)
 ;
"RTN","PSOLBL1",44,0)
SIG1 S X=$S($D(SGY(DR)):SGY(DR),1:"") W !,X
"RTN","PSOLBL1",45,0)
 I 'SIDE W ?38,X I PRTFL W ?83 W:DR=1 ?83,$S('REF:"PRINT NAME: "_$E(LINE,1,25),1:"") W:DR=2 "DATE: ",$E(LINE,1,10) W:(DR=2)&('REF) " DEA# ",$E(LINE,1,6) W:(DR=3)&('REF) "Refills: 0 1 2 3 4 5 6 7 8 9 10 11"
"RTN","PSOLBL1",46,0)
 Q
"RTN","PSOLBL1",47,0)
 ;
"RTN","PSOLBL1",48,0)
OSET I $G(RXFL(RX))']""!($G(RXFL(RX))=0) D  Q
"RTN","PSOLBL1",49,0)
 .S TECH=$P($G(^VA(200,+$P(^PSRX(RX,0),"^",16),0)),"^"),QTY=$P(^PSRX(RX,0),"^",7),PHYS=$S($D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UKN") D 6^VADPT,PID^VADPT S SSNPN=$E($G(VA("PID")),5,12)
"RTN","PSOLBL1",50,0)
 .S DAYS=$P(^PSRX(RX,0),"^",8),MFG="________",LOT="________"
"RTN","PSOLBL1",51,0)
 I '$D(^PSRX(RX,1,RXFL(RX),0)) K RXFL(RX) Q
"RTN","PSOLBL1",52,0)
 S TECH=$S($D(^VA(200,+$P(^PSRX(RX,1,RXFL(RX),0),"^",7),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSOLBL1",53,0)
 S QTY=$P(^PSRX(RX,1,RXFL(RX),0),"^",4),PHYS=$S($D(^VA(200,+$P(^PSRX(RX,1,RXFL(RX),0),"^",17),0)):$P(^(0),"^"),$D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UNKNOWN") D 6^VADPT,PID^VADPT S SSNPN=$E($G(VA("PID")),5,12)
"RTN","PSOLBL1",54,0)
 S DAYS=$P(^PSRX(RX,1,RXFL(RX),0),"^",10),LOT="________",MFG="________"
"RTN","PSOLBL1",55,0)
 Q
"RTN","PSOLLLI")
0^8^B66409595
"RTN","PSOLLLI",1,0)
PSOLLLI ;BIR/JLC - LASER LABELS INITIALIZATION ;4/25/07 9:00am
"RTN","PSOLLLI",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,157,189,161,244,200,206,225**;DEC 1997;Build 29
"RTN","PSOLLLI",3,0)
 ;
"RTN","PSOLLLI",4,0)
 ;DBIAs PSDRUG-221, PS(55-2228, SC-10040, IBARX-125, PSXSRP-2201, %ZIS-3435, DPT-3097, ^TMP($J,"PSNPPIO"-3794
"RTN","PSOLLLI",5,0)
 ;External reference to DRUG^PSSWRNA supported by DBIA 4449
"RTN","PSOLLLI",6,0)
 ;
"RTN","PSOLLLI",7,0)
 ;*244 remove test for partial fill when testing status > 11
"RTN","PSOLLLI",8,0)
 ;
"RTN","PSOLLLI",9,0)
DQ N PSOBIO S (I,PSOIO)=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSOIO($P(X0,"^"))=^(1),PSOIO=1
"RTN","PSOLLLI",10,0)
DQ1 I '$D(PPL) G HLEX
"RTN","PSOLLLI",11,0)
 I $P($G(PSOPAR),"^",30)=2,'$G(PSOEXREP) G HLEX
"RTN","PSOLLLI",12,0)
 K RXFLX S PSOCKHN=","_$G(PPL),PSRESOLV=+PPL D CHECK
"RTN","PSOLLLI",13,0)
 S PSOINT=1 F PI=1:1 S RX=$P(PPL,",",PI) Q:RX=""  D
"RTN","PSOLLLI",14,0)
 . S RXY=$G(^PSRX(RX,0)) Q:RXY=""  I PSOPDFN'=$P(RXY,"^",2),'PSOINT D TRAIL^PSOLLL1 S PSOPDFN=$P(RXY,"^",2)
"RTN","PSOLLLI",15,0)
 . K RXP,REPRINT D C
"RTN","PSOLLLI",16,0)
 I 'PSOINT D TRAIL^PSOLLL1
"RTN","PSOLLLI",17,0)
HLEX K RXPI,PSORX,RXP,PSOIOS,PSOLAPPL,XXX,COPAYVAR,TECH,PHYS,MFG,NURSE,STATE,SIDE,COPIES,EXDT,ISD,PSOINST,RXN,RXY,VADT,DEA,WARN,FDT,QTY,PATST,PDA,PS,PS1,RXP,REPRINT
"RTN","PSOLLLI",18,0)
 K SGY,OSGY,PS2,PSL,PSNP,INRX,RR,XTYPE,SSNP,SSNPN,PNM,ADDR,PSODBQ,PSOLASTF,PSRESOLV,PSOEXREP,PSOSXQ
"RTN","PSOLLLI",19,0)
 K DATE,DR,DRUG,LINE,MW,PRTFL,VRPH,EXPDT,X2,DIFF,DAYS,PSZIP,PSOHZIP,PS55,PS55X
"RTN","PSOLLLI",20,0)
 K ^TMP($J,"PSNPMI"),^TMP($J,"PSOCP",+$G(PSOCPN)),PSOCPN,PSOLBLDR,PSOLBLPS,PSOLBLCP,RXPR,RXRP,RXRS,PSOCKHN,RXFLX,PSOLAPPL,PSOPDFN,PSDFNFLG,PSOZERO,NEXTRX,PSOBLALL,STA
"RTN","PSOLLLI",21,0)
 I '$G(PSOSUREP),'$G(PSOSUSPR) S ZTREQ="@"
"RTN","PSOLLLI",22,0)
 Q
"RTN","PSOLLLI",23,0)
C N PSOBIO S (I,PSOIO)=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSOIO($P(X0,"^"))=^(1),PSOIO=1
"RTN","PSOLLLI",24,0)
 U IO Q:'$D(^PSRX(RX,0))  S RXY=^(0),RX2=^(2),RXSTA=^("STA") K SGY,OSGY
"RTN","PSOLLLI",25,0)
 S (SIGM,PFM,PMIM,L2,L3,L4,L5,FILLCONT,BOTTLBL)=0
"RTN","PSOLLLI",26,0)
 K SIGF,PFF,PMIF S (SIGF,PFF,PMIF)=0 F I="DR","T" S (SIGF(I),PFF(I))=1
"RTN","PSOLLLI",27,0)
 F I="A","B","I" S PMIF(I)=1
"RTN","PSOLLLI",28,0)
 D NOW^%DTC S Y=$P(%,"."),PSOFNOW=% X ^DD("DD") S PSONOW=Y,Y=PSOFNOW X ^DD("DD") S PSONOWT=Y
"RTN","PSOLLLI",29,0)
 S:$G(PSOBLALL) PSOBLRX=RX S:$D(RXRP(RX)) REPRINT=1 S:$D(RXPR(RX)) RXP=RXPR(RX)
"RTN","PSOLLLI",30,0)
 I $G(PSOSUREP)!($G(PSOEXREP)) S REPRINT=1 I '$G(RXRP(RX)) S RXRP(RX)=1
"RTN","PSOLLLI",31,0)
 S A=$P(RXSTA,"^") I A>11 D AL^PSOLBL("QT") K RXP,REPRINT Q      ;*244
"RTN","PSOLLLI",32,0)
 I A=3 D AL^PSOLBL("QT") K RXP,REPRINT Q
"RTN","PSOLLLI",33,0)
 I $G(RXPR(RX)),'$D(^PSRX(RX,"P",RXP,0)) K RXP,REPRINT Q
"RTN","PSOLLLI",34,0)
 I $P($G(RXFL(RX)),"^"),'$D(^PSRX(RX,1,$P($G(RXFL(RX)),"^"),0)) K RXP,REPRINT Q
"RTN","PSOLLLI",35,0)
 I $G(PSODBQ)!($G(RXRS(RX))) S RR=$O(^PS(52.5,"B",RX,0)) Q:'RR  I $G(^PS(52.5,RR,"P"))=1 K RXP,REPRINT Q
"RTN","PSOLLLI",36,0)
 I $G(RXRS(RX))!($G(PSOPULL)) S PSOSXQ=0 N DR,DA,DIE D  I $G(PSOSXQ) K RXP,REPRINT Q
"RTN","PSOLLLI",37,0)
 . S DA=$O(^PS(52.5,"B",RX,0)) Q:'DA
"RTN","PSOLLLI",38,0)
 . S A=$P($G(^PS(52.5,DA,0)),"^",7) I A="" Q
"RTN","PSOLLLI",39,0)
 . I A="Q" S DIE="^PS(52.5,",DR="3////P" D ^DIE Q
"RTN","PSOLLLI",40,0)
 . K RXRS(RX) S PSOSXQ=1
"RTN","PSOLLLI",41,0)
 I $G(PSRESOLV)=RX D ENLBL^PSOBSET K PSRESOLV
"RTN","PSOLLLI",42,0)
 I $P(RXSTA,"^")'=4 D
"RTN","PSOLLLI",43,0)
 . I $G(PSOSUSPR) D AREC^PSOSUTL
"RTN","PSOLLLI",44,0)
 . I $G(PSOPULL)!($G(RXRS(RX))) D AREC1^PSOSUTL
"RTN","PSOLLLI",45,0)
 . I $G(PSOSUREP) D AREC^PSOSUSRP
"RTN","PSOLLLI",46,0)
 . I $G(PSXREP) D AREC^PSXSRP
"RTN","PSOLLLI",47,0)
 S RXY=^PSRX(RX,0),RX2=^(2),RXSTA=^("STA")
"RTN","PSOLLLI",48,0)
 K ^UTILITY("DIQ1",$J) S DA=$P($$SITE^VASITE(),"^")
"RTN","PSOLLLI",49,0)
 I $G(DA) S DIC=4,DIQ(0)="I",DR="99" D EN^DIQ1 S PSOINST=$G(^UTILITY("DIQ1",$J,4,DA,99,"I")) K ^UTILITY("DIQ1",$J),DA,DR,DIC
"RTN","PSOLLLI",50,0)
 S RXN=$P(RXY,"^"),DFN=+$P(RXY,"^",2),PSOLBLPS=+$P(RXY,"^",3),PSOLBLDR=+$P(RXY,"^",6)
"RTN","PSOLLLI",51,0)
 S ISD=$P(RXY,"^",13),RXF=0,SIG=$P($G(^PSRX(RX,"SIG")),"^"),ISD=$E(ISD,4,5)_"/"_$E(ISD,6,7)_"/"_($E(ISD,1,3)+1700),ZY=0,$P(LINE,"_",28)="_"
"RTN","PSOLLLI",52,0)
 S NURSE=$S($P($G(^DPT(DFN,"NHC")),"^")="Y":1,$P($G(^PS(55,DFN,40)),"^"):1,1:0)
"RTN","PSOLLLI",53,0)
 S FDT=$P(RX2,"^",2),PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:""),PS1=$S($D(^(1)):^(1),1:""),PSOSITE7=$P(^("IB"),"^")
"RTN","PSOLLLI",54,0)
 S PS2=$P(PS,"^")_"^"_$P(PS,"^",6)
"RTN","PSOLLLI",55,0)
 S EXPDT=$P(RX2,"^",6),EXDT=$S('EXPDT:"",1:$E(EXPDT,4,5)_"/"_$E(EXPDT,6,7)_"/"_($E(EXPDT,1,3)+1700))
"RTN","PSOLLLI",56,0)
 S COPIES=$S($P($G(RXRP(RX)),"^",2):$P($G(RXRP(RX)),"^",2),$P(RXY,"^",18)]"":$P(RXY,"^",18),1:1)
"RTN","PSOLLLI",57,0)
 K PSOCKHNX S PSOCKHL=$L(RX),PSOCKHN=$E($G(PSOCKHN),(PSOCKHL+2),999) D  K PSOCKHNX,PSOCKHL,PSOCKHA
"RTN","PSOLLLI",58,0)
 .S PSOCKHA=","_RX_","
"RTN","PSOLLLI",59,0)
 .I PSOCKHN'[PSOCKHA Q
"RTN","PSOLLLI",60,0)
 .S PSOCKHA=$E(PSOCKHA,1,($L(PSOCKHA)-1))
"RTN","PSOLLLI",61,0)
 .S PSOCKHNX=$L(PSOCKHN,PSOCKHA)-1
"RTN","PSOLLLI",62,0)
 .I +$G(PSOCKHNX)>0 D DOUB
"RTN","PSOLLLI",63,0)
 I $O(^PSRX(RX,1,0)),$G(RXFL(RX))'=0 S $P(^PSRX(RX,3),"^",6)="" K ^PSRX(RX,"DAI"),^PSRX(RX,"DRI")
"RTN","PSOLLLI",64,0)
 I '$G(RXP),'$O(^PSRX(RX,1,0)) S RXFL(RX)=0
"RTN","PSOLLLI",65,0)
 I '$G(RXP) D OSET I '$O(^PSRX(RX,1,0))!($G(RXFL(RX))=0) G ORIG
"RTN","PSOLLLI",66,0)
 I $O(^PSRX(RX,1,0)),'$G(RXP) D  G STA
"RTN","PSOLLLI",67,0)
 . I '$G(RXFL(RX)) S XTYPE=1 D REF
"RTN","PSOLLLI",68,0)
 I $G(RXP) S XTYPE="P" D REF G STA
"RTN","PSOLLLI",69,0)
ORIG S TECH=$P($G(^VA(200,+$P(RXY,"^",16),0)),"^"),PHYS=$S($D(^VA(200,+$P(RXY,"^",4),0)):$P(^(0),"^"),1:"UKN")
"RTN","PSOLLLI",70,0)
 S DAYS=$P(RXY,"^",8),QTY=$P(RXY,"^",7)
"RTN","PSOLLLI",71,0)
 D 6^VADPT,PID^VADPT6 S SSNPN=$G(VA("BID"))
"RTN","PSOLLLI",72,0)
STA S STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UKN")
"RTN","PSOLLLI",73,0)
 S DRUG=$$ZZ^PSOSUTL(RX),DEA=$P($G(^PSDRUG(+$P(RXY,"^",6),0)),"^",3),WARN=$P($G(^(0)),"^",8)
"RTN","PSOLLLI",74,0)
 S WARN=$$DRUG^PSSWRNA(+$P(RXY,"^",6),+$P(RXY,"^",2))
"RTN","PSOLLLI",75,0)
 S SIDE=$S($P($G(RXRP(RX)),"^",3):1,1:0)
"RTN","PSOLLLI",76,0)
 I $G(^PSRX(RX,"P",+$G(RXP),0))]"" S RXPI=RXP D
"RTN","PSOLLLI",77,0)
 .S RXP=^PSRX(RX,"P",RXP,0)
"RTN","PSOLLLI",78,0)
 .S RXY=$P(RXP,"^")_"^"_$P(RXY,"^",2,6)_"^"_$P(RXP,"^",4)_"^"_$P(RXP,"^",10)_"^"_$P(RXY,"^",9)_"^"_$P($G(^PSRX(RX,"SIG")),"^",2)_"^"_$P(RXP,"^",2)_"^"_$P(RXY,"^",12,14)_"^"_$P(^PSRX(RX,"STA"),"^")_"^"_$P(RXP,"^",7)_"^"_$P(RXY,"^",17,99)
"RTN","PSOLLLI",79,0)
 .S FDT=$P(RXP,"^")
"RTN","PSOLLLI",80,0)
 S MW=$P(RXY,"^",11) I $G(RXFL(RX))'=0 D:$G(RXFL(RX))  I '$G(RXFL(RX)) F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  S RXF=RXF+1 S:'$G(RXP) MW=$P(^PSRX(RX,1,I,0),"^",2) I +^PSRX(RX,1,I,0)'<FDT S FDT=+^(0)
"RTN","PSOLLLI",81,0)
 .I $G(RXFL(RX)),'$D(^PSRX(RX,1,RXFL(RX),0)) K RXFL(RX) Q
"RTN","PSOLLLI",82,0)
 .S RXF=RXFL(RX) S:'$G(RXP) MW=$P($G(^PSRX(RX,1,RXF,0)),"^",2) I +^PSRX(RX,1,RXF,0)'<FDT S FDT=+^(0)
"RTN","PSOLLLI",83,0)
 I MW="W",$G(^PSRX(RX,"MP"))]"" D
"RTN","PSOLLLI",84,0)
 .S PSMP=^PSRX(RX,"MP"),PSJ=0 F PSI=1:1:$L(PSMP) S PSMP(PSI)="",PSJ=PSJ+1 F PSJ=PSJ:1 S PSMP(PSI)=PSMP(PSI)_$P(PSMP," ",PSJ)_" " Q:($L(PSMP(PSI))+$L($P(PSMP," ",PSJ+1))>30)
"RTN","PSOLLLI",85,0)
 .K PSMP(PSI)
"RTN","PSOLLLI",86,0)
 ;New mail codes for CMOP
"RTN","PSOLLLI",87,0)
 S MAILCOM=""
"RTN","PSOLLLI",88,0)
 S X=$G(^PS(55,DFN,0)),PSCAP=$P(X,"^",2),PS55=$P(X,"^",3),PS55X=$P(X,"^",5)
"RTN","PSOLLLI",89,0)
 I PS55X]"",PS55>1,PS55X<DT S PS55=0
"RTN","PSOLLLI",90,0)
 S:MW="M" MW=$S((PS55=1!(PS55=4)):"R",1:MW)
"RTN","PSOLLLI",91,0)
 S MAILCOM=$P($G(^PS(59,PSOSITE,9)),"^")
"RTN","PSOLLLI",92,0)
 S MW=$S(MW="M":"REGULAR",MW="R":"CERTIFIED",1:"WINDOW")
"RTN","PSOLLLI",93,0)
 I $G(PSMP(1))="",$G(PS55)=2 S PSMP(1)=$G(SSNPN)
"RTN","PSOLLLI",94,0)
 S DATE=$E(FDT,1,7),REF=$P(RXY,"^",9)-RXF S:'$G(RXP) $P(^PSRX(RX,3),"^")=FDT S:REF<1 REF=0 D ^PSOLBL2 S II=RX D ^PSORFL,RFLDT^PSORFL
"RTN","PSOLLLI",95,0)
 S (X,PSOFLAST)=$G(PSOLASTF) I X?1N.E D ^%DT X ^DD("DD") S PSOFLAST=Y
"RTN","PSOLLLI",96,0)
 S PATST=$G(^PS(53,+$P(RXY,"^",3),0)) S PRTFL=1 I REF=0 S:('$P(PATST,"^",5))!(DEA["W")!(DEA[1)!(DEA[2) PRTFL=0
"RTN","PSOLLLI",97,0)
 S VRPH=$P(RX2,"^",10),PSCLN=+$P(RXY,"^",5),PSCLN=$G(^SC(PSCLN,0)),PSCLN=$S($P(PSCLN,"^",2)'="":$P(PSCLN,"^",2),1:$E($P(PSCLN,"^"),1,7)) I PSCLN="" S PSCLN="UNKNOWN"
"RTN","PSOLLLI",98,0)
 S PATST=$P(PATST,"^",2),X1=DT,X2=$P(RXY,"^",8)-10 D C^%DTC:REF I $D(^PSRX(RX,2)),$P(^(2),"^",6),REF,X'<$P(^(2),"^",6) S REF=0,VRPH=$P(^(2),"^",10)
"RTN","PSOLLLI",99,0)
 I $G(PSOCHAMP),$G(PSOTRAMT) S COPAYVAR="CHAMPUS" G LBL
"RTN","PSOLLLI",100,0)
 I $G(RXP) S COPAYVAR="" G LBL
"RTN","PSOLLLI",101,0)
 I $P($G(^PS(53,+$G(PSOLBLPS),0)),"^",7) D SNO G LBL
"RTN","PSOLLLI",102,0)
 I DEA["I"!(DEA["S") D SNO G LBL
"RTN","PSOLLLI",103,0)
 I $P(^PSRX(RX,"STA"),"^")>0,$P(^("STA"),"^")'=2,'$G(PSODBQ) D SNO G LBL
"RTN","PSOLLLI",104,0)
 I $G(PSOLBLCP)="" D IBCP
"RTN","PSOLLLI",105,0)
 N PSOQI S PSOQI=$G(^PSRX(RX,"IBQ"))
"RTN","PSOLLLI",106,0)
 I $G(PSOLBLCP)=0 D SNO G LBL
"RTN","PSOLLLI",107,0)
 I $G(PSOLBLCP)=1 I $P(PSOQI,"^",2)!($P(PSOQI,"^",3))!($P(PSOQI,"^",4))!($P(PSOQI,"^",5))!($P(PSOQI,"^",6))!($P(PSOQI,"^",7))!($P(PSOQI,"^",8)) D SNO G LBL
"RTN","PSOLLLI",108,0)
 I $G(PSOLBLCP)=2 I $P(PSOQI,"^")!($P(PSOQI,"^",2))!($P(PSOQI,"^",3))!($P(PSOQI,"^",4))!($P(PSOQI,"^",5))!($P(PSOQI,"^",6))!($P(PSOQI,"^",7))!($P(PSOQI,"^",8)) D SNO G LBL
"RTN","PSOLLLI",109,0)
 I $G(PSOLBLCP)=2,'$P($G(^PSRX(RX,"IB")),"^") D SNO G LBL
"RTN","PSOLLLI",110,0)
 S PSOCPN=$P(RXY,"^",2),INRX=$P(RXY,"^")
"RTN","PSOLLLI",111,0)
 I $G(^TMP($J,"PSOCP",PSOCPN))="" S ^(PSOCPN)=PSOCPN
"RTN","PSOLLLI",112,0)
 S ^TMP($J,"PSOCP",PSOCPN,INRX)=INRX_"^"_$$ZZ^PSOSUTL(RX)_"^"_+$G(DAYS),COPAYVAR="COPAY" K ZDRUG
"RTN","PSOLLLI",113,0)
LBL I $G(PSOIO("LLI"))]"" X PSOIO("LLI")
"RTN","PSOLLLI",114,0)
 I $P(RXSTA,"^")=4 D ^PSOLLL8 Q  ;for a critical interaction entered by a tech - don't allow a label to be printed
"RTN","PSOLLLI",115,0)
 I $D(^PSRX(RX,"DRI")),'$G(RXF),'$G(RXP) D ^PSOLLL8
"RTN","PSOLLLI",116,0)
 I $P($G(^PSRX(RX,3)),"^",6),'$G(RXF),'$G(RXP) D ^PSOLLL9
"RTN","PSOLLLI",117,0)
 S PSOINT=0 G ^PSOLLL1
"RTN","PSOLLLI",118,0)
REF F XXX=0:0 S XXX=$O(^PSRX(RX,XTYPE,XXX)) Q:+XXX'>0  D
"RTN","PSOLLLI",119,0)
 .S TECH=$S($D(^VA(200,+$P(^PSRX(RX,XTYPE,XXX,0),"^",7),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSOLLLI",120,0)
 .S QTY=$P(^PSRX(RX,XTYPE,XXX,0),"^",4),PHYS=$S($D(^VA(200,+$P(^PSRX(RX,XTYPE,XXX,0),"^",17),0)):$P(^(0),"^"),$D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UNKNOWN") D 6^VADPT,PID^VADPT6 S SSNPN=$G(VA("BID"))
"RTN","PSOLLLI",121,0)
 .S DAYS=$P(^PSRX(RX,XTYPE,XXX,0),"^",10)
"RTN","PSOLLLI",122,0)
 Q
"RTN","PSOLLLI",123,0)
CHECK S PSDFNFLG=0,PSOZERO=$P(PPL,","),PSOPDFN=$P(^PSRX(PSOZERO,0),"^",2)
"RTN","PSOLLLI",124,0)
 Q
"RTN","PSOLLLI",125,0)
OSET ;
"RTN","PSOLLLI",126,0)
 N A
"RTN","PSOLLLI",127,0)
 I $G(RXFL(RX))']""!($G(RXFL(RX))=0) D  Q
"RTN","PSOLLLI",128,0)
 .S A=^PSRX(RX,0)
"RTN","PSOLLLI",129,0)
 .S TECH=$P($G(^VA(200,+$P(A,"^",16),0)),"^"),QTY=$P(A,"^",7),PHYS=$S($D(^VA(200,+$P(A,"^",4),0)):$P(^(0),"^"),1:"UKN") D 6^VADPT,PID^VADPT6 S SSNPN=$G(VA("BID"))
"RTN","PSOLLLI",130,0)
 .S DAYS=$P(A,"^",8)
"RTN","PSOLLLI",131,0)
 I '$D(^PSRX(RX,1,RXFL(RX),0)) K RXFL(RX) Q
"RTN","PSOLLLI",132,0)
 S A=^PSRX(RX,1,RXFL(RX),0)
"RTN","PSOLLLI",133,0)
 S TECH=$S($D(^VA(200,+$P(A,"^",7),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSOLLLI",134,0)
 S QTY=$P(A,"^",4),PHYS=$S($D(^VA(200,+$P(A,"^",17),0)):$P(^(0),"^"),$D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UNKNOWN") D 6^VADPT,PID^VADPT6 S SSNPN=$G(VA("BID"))
"RTN","PSOLLLI",135,0)
 S DAYS=$P(A,"^",10)
"RTN","PSOLLLI",136,0)
 Q
"RTN","PSOLLLI",137,0)
DOUB ;
"RTN","PSOLLLI",138,0)
 Q:'$D(RXFL(RX))
"RTN","PSOLLLI",139,0)
 I +$G(RXFL(RX))-PSOCKHNX<0 Q
"RTN","PSOLLLI",140,0)
 S RXFLX(RX)=$G(RXFL(RX))
"RTN","PSOLLLI",141,0)
 S RXFL(RX)=$G(RXFL(RX))-PSOCKHNX
"RTN","PSOLLLI",142,0)
 Q
"RTN","PSOLLLI",143,0)
IBCP ;
"RTN","PSOLLLI",144,0)
 N X,Y,PSOJJ,PSOLL
"RTN","PSOLLLI",145,0)
 S PSOLBLCP=""
"RTN","PSOLLLI",146,0)
 S X=$P($G(^PS(59,+$G(PSOSITE),"IB")),"^")_"^"_$G(DFN) D XTYPE^IBARX
"RTN","PSOLLLI",147,0)
 S PSOJJ="" F  S PSOJJ=$O(Y(PSOJJ)) Q:'PSOJJ  S PSOLL="" F  S PSOLL=$O(Y(PSOJJ,PSOLL)) Q:PSOLL=""  S:PSOLL>0 PSOLBLCP=PSOLL
"RTN","PSOLLLI",148,0)
 I '$G(PSOLBLCP) S PSOLBLCP=0
"RTN","PSOLLLI",149,0)
 Q
"RTN","PSOLLLI",150,0)
SNO ;
"RTN","PSOLLLI",151,0)
 S COPAYVAR="NO COPAY"
"RTN","PSOLLLI",152,0)
 Q
"RTN","PSOLMAO")
0^41^B247627
"RTN","PSOLMAO",1,0)
PSOLMAO ;BHAM ISC/LC - ACTIVE ORDERS ;03/14/1995
"RTN","PSOLMAO",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**225**;DEC 1997;Build 29
"RTN","PSOLMAO",3,0)
EN ; -- main entry point for PSO LM ACTION ORDER
"RTN","PSOLMAO",4,0)
 D EN^VALM("PSO LM ACTIVE ORDERS")
"RTN","PSOLMAO",5,0)
 Q
"RTN","PSOLMAO",6,0)
 ;
"RTN","PSOLMAO",7,0)
HDR ; -- header code
"RTN","PSOLMAO",8,0)
 ;S VALMHDR(1)="This is a test header for PSO LM ACTION ORDER."
"RTN","PSOLMAO",9,0)
 ;S VALMHDR(2)="This is the second line"
"RTN","PSOLMAO",10,0)
 D HDR^PSOLMUTL
"RTN","PSOLMAO",11,0)
 Q
"RTN","PSOLMAO",12,0)
 ;
"RTN","PSOLMAO",13,0)
INIT ; -- init variables and list array
"RTN","PSOLMAO",14,0)
 ;F LINE=1:1:30 D SET^VALM10(LINE,LINE_"     Line number "_LINE)
"RTN","PSOLMAO",15,0)
 S VALMCNT=PSOPF
"RTN","PSOLMAO",16,0)
 D RV^PSOORFL
"RTN","PSOLMAO",17,0)
 Q
"RTN","PSOLMAO",18,0)
 ;
"RTN","PSOLMAO",19,0)
HELP ; -- help code
"RTN","PSOLMAO",20,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","PSOLMAO",21,0)
 Q
"RTN","PSOLMAO",22,0)
 ;
"RTN","PSOLMAO",23,0)
EXIT ; -- exit code
"RTN","PSOLMAO",24,0)
 S PSOQFLG=1 Q
"RTN","PSOLMAO",25,0)
 ;
"RTN","PSOLMAO",26,0)
EXPND ; -- expand code
"RTN","PSOLMAO",27,0)
 Q
"RTN","PSOLMAO",28,0)
 ;
"RTN","PSOLMPO")
0^57^B1183408
"RTN","PSOLMPO",1,0)
PSOLMPO ;ISC-BHAM/LC - pending orders ;03/13/95
"RTN","PSOLMPO",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**46,225**;DEC 1997;Build 29
"RTN","PSOLMPO",3,0)
EN ; -- main entry point for PSO LM PENDING ORDER
"RTN","PSOLMPO",4,0)
 S PSOLMC=0 D EN^VALM("PSO LM PENDING ORDER") K PSOLMC
"RTN","PSOLMPO",5,0)
 Q
"RTN","PSOLMPO",6,0)
 ;
"RTN","PSOLMPO",7,0)
HDR ; -- header code
"RTN","PSOLMPO",8,0)
 D HDR^PSOLMUTL
"RTN","PSOLMPO",9,0)
 Q
"RTN","PSOLMPO",10,0)
 ;
"RTN","PSOLMPO",11,0)
INIT ; -- init variables and list array
"RTN","PSOLMPO",12,0)
 ;F LINE=1:1:30 D SET^VALM10(LINE,LINE_"     Line number "_LINE)
"RTN","PSOLMPO",13,0)
 S VALMCNT=IEN,VALM("TITLE")=$S($P(OR0,"^",23):"FL-",1:"")_"Pending OP Orders ("_$S($P(OR0,"^",14)="S":"STAT",$P(OR0,"^",14)="E":"EMERGENCY",1:"ROUTINE")_")"
"RTN","PSOLMPO",14,0)
 D RV^PSONFI
"RTN","PSOLMPO",15,0)
 Q
"RTN","PSOLMPO",16,0)
 ;
"RTN","PSOLMPO",17,0)
HELP ; -- help code
"RTN","PSOLMPO",18,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","PSOLMPO",19,0)
 Q
"RTN","PSOLMPO",20,0)
 ;
"RTN","PSOLMPO",21,0)
EXIT ; -- exit code
"RTN","PSOLMPO",22,0)
 K FLAGLINE D CLEAN^VALM10
"RTN","PSOLMPO",23,0)
 Q
"RTN","PSOLMPO",24,0)
 ;
"RTN","PSOLMPO",25,0)
EXPND ; -- expand code
"RTN","PSOLMPO",26,0)
 Q
"RTN","PSOLMPO",27,0)
 ;
"RTN","PSOLMPO1")
0^58^B1200387
"RTN","PSOLMPO1",1,0)
PSOLMPO1 ;ISC-BHAM/SAB - complete pending orders ;03/13/1995
"RTN","PSOLMPO1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**46,71,225**;DEC 1997;Build 29
"RTN","PSOLMPO1",3,0)
EN ; -- main entry point for PSO LM COMPLETE ORDER
"RTN","PSOLMPO1",4,0)
 D EN^VALM("PSO LM COMPLETE ORDER")
"RTN","PSOLMPO1",5,0)
 K PSOANSQD
"RTN","PSOLMPO1",6,0)
 Q
"RTN","PSOLMPO1",7,0)
 ;
"RTN","PSOLMPO1",8,0)
HDR ; -- header code
"RTN","PSOLMPO1",9,0)
 D HDR^PSOLMUTL
"RTN","PSOLMPO1",10,0)
 Q
"RTN","PSOLMPO1",11,0)
 ;
"RTN","PSOLMPO1",12,0)
INIT ; -- init variables and list array
"RTN","PSOLMPO1",13,0)
 S VALMCNT=IEN,VALM("TITLE")=$S($P(OR0,"^",23):"FL-",1:"")_"Pending OP Orders ("_$S($P($G(OR0),"^",14)="S":"STAT",$P($G(OR0),"^",14)="E":"EMERGENCY",1:"ROUTINE")_")"
"RTN","PSOLMPO1",14,0)
 D RV^PSONFI Q
"RTN","PSOLMPO1",15,0)
 ;
"RTN","PSOLMPO1",16,0)
HELP ; -- help code
"RTN","PSOLMPO1",17,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","PSOLMPO1",18,0)
 Q
"RTN","PSOLMPO1",19,0)
 ;
"RTN","PSOLMPO1",20,0)
EXIT ; -- exit code
"RTN","PSOLMPO1",21,0)
 K FLAGLINE D CLEAN^VALM10
"RTN","PSOLMPO1",22,0)
 Q
"RTN","PSOLMPO1",23,0)
 ;
"RTN","PSOLMPO1",24,0)
EXPND ; -- expand code
"RTN","PSOLMPO1",25,0)
 Q
"RTN","PSOLMPO1",26,0)
 ;
"RTN","PSOLMPO2")
0^71^B590140
"RTN","PSOLMPO2",1,0)
PSOLMPO2 ;ISC-BHAM/SAB - list template to complete backdoor orders ;03/13/1995
"RTN","PSOLMPO2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**46,71,225**;DEC 1997;Build 29
"RTN","PSOLMPO2",3,0)
EN ; -- main entry point for PSO LM BACKDOOR ORDER
"RTN","PSOLMPO2",4,0)
 D EN^VALM("PSO LM BACKDOOR ORDER")
"RTN","PSOLMPO2",5,0)
 Q
"RTN","PSOLMPO2",6,0)
 ;
"RTN","PSOLMPO2",7,0)
HDR ; -- header code
"RTN","PSOLMPO2",8,0)
 D HDR^PSOLMUTL
"RTN","PSOLMPO2",9,0)
 Q
"RTN","PSOLMPO2",10,0)
 ;
"RTN","PSOLMPO2",11,0)
INIT ; -- init variables and list array
"RTN","PSOLMPO2",12,0)
 S VALMCNT=IEN,VALM("TITLE")="New OP Order ("_$S($G(COPY):"COPY",1:"ROUTINE")_")"
"RTN","PSOLMPO2",13,0)
 S VALMCNT=PSOPF
"RTN","PSOLMPO2",14,0)
 D RV^PSONFI Q
"RTN","PSOLMPO2",15,0)
 ;
"RTN","PSOLMPO2",16,0)
HELP ; -- help code
"RTN","PSOLMPO2",17,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","PSOLMPO2",18,0)
 Q
"RTN","PSOLMPO2",19,0)
 ;
"RTN","PSOLMPO2",20,0)
EXIT ; -- exit code
"RTN","PSOLMPO2",21,0)
 K PSOANSQD
"RTN","PSOLMPO2",22,0)
 S PSOQFLG=1
"RTN","PSOLMPO2",23,0)
 K FLAGLINE D CLEAN^VALM10
"RTN","PSOLMPO2",24,0)
 Q
"RTN","PSOLMPO2",25,0)
 ;
"RTN","PSOLMPO2",26,0)
EXPND ; -- expand code
"RTN","PSOLMPO2",27,0)
 Q
"RTN","PSOLMPO2",28,0)
 ;
"RTN","PSOLMRN")
0^70^B567748
"RTN","PSOLMRN",1,0)
PSOLMRN ;ISC-BHAM/SAB - displays renewal rxs ;04/21/1995
"RTN","PSOLMRN",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,46,84,225**;DEC 1997;Build 29
"RTN","PSOLMRN",3,0)
EN ; -- main entry point for PSO LM RENEW LIST
"RTN","PSOLMRN",4,0)
 S VALMCNT=PSOPF,PSOLM=1
"RTN","PSOLMRN",5,0)
 D EN^VALM("PSO LM RENEW LIST")
"RTN","PSOLMRN",6,0)
 Q
"RTN","PSOLMRN",7,0)
 ;
"RTN","PSOLMRN",8,0)
HDR ; -- header code
"RTN","PSOLMRN",9,0)
 K ^TMP("PSOHDR",$J) D HDR^PSOLMUTL
"RTN","PSOLMRN",10,0)
 Q
"RTN","PSOLMRN",11,0)
 ;
"RTN","PSOLMRN",12,0)
INIT ; -- init variables and list array
"RTN","PSOLMRN",13,0)
 ;F LINE=1:1:30 D SET^VALM10(LINE,LINE_"     Line number "_LINE)
"RTN","PSOLMRN",14,0)
 S VALMCNT=PSOPF,PSOLM=1
"RTN","PSOLMRN",15,0)
 D RV^PSONFI Q
"RTN","PSOLMRN",16,0)
 ;
"RTN","PSOLMRN",17,0)
HELP ; -- help code
"RTN","PSOLMRN",18,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","PSOLMRN",19,0)
 Q
"RTN","PSOLMRN",20,0)
 ;
"RTN","PSOLMRN",21,0)
EXIT ; -- exit code
"RTN","PSOLMRN",22,0)
 I $G(Y)=-1!($G(Y)="Q") S PSOQUIT=1
"RTN","PSOLMRN",23,0)
 I $G(Y)="Q",$P($G(Y(1)),"^",3)="QU" S PSOQQ=1
"RTN","PSOLMRN",24,0)
 K FLAGLINE D CLEAN^VALM10
"RTN","PSOLMRN",25,0)
 Q
"RTN","PSOLMRN",26,0)
 ;
"RTN","PSOLMRN",27,0)
EXPND ; -- expand code
"RTN","PSOLMRN",28,0)
 Q
"RTN","PSOLMRN",29,0)
 ;
"RTN","PSOLMUTL")
0^43^B10572703
"RTN","PSOLMUTL",1,0)
PSOLMUTL ;BIR/SAB - listman utilities ;03/07/95
"RTN","PSOLMUTL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**19,46,84,99,131,132,148,268,225**;DEC 1997;Build 29
"RTN","PSOLMUTL",3,0)
 ;External reference FULL^VALM1 supported by dbia 10116
"RTN","PSOLMUTL",4,0)
 ;External reference $$SETSTR^VALM1 supported by dbia 10116
"RTN","PSOLMUTL",5,0)
 ;External reference EN2^GMRAPEMO supported by dbia 190
"RTN","PSOLMUTL",6,0)
 ;External reference to ^ORD(101 supported by DBIA 872
"RTN","PSOLMUTL",7,0)
 ;
"RTN","PSOLMUTL",8,0)
EN W @IOF S VALMCNT=0
"RTN","PSOLMUTL",9,0)
 D:'$D(PSOPAR) ^PSOLSET I '$D(PSOPAR) W $C(7),!!?5,"Site parameter must be defined!",! G INITQ
"RTN","PSOLMUTL",10,0)
 D EN^PSOLMPI
"RTN","PSOLMUTL",11,0)
INITQ Q
"RTN","PSOLMUTL",12,0)
HDR ;patient med profile display
"RTN","PSOLMUTL",13,0)
 K VALMHDR S HDR=^TMP("PSOHDR",$J,1,0)
"RTN","PSOLMUTL",14,0)
 S:^TMP("PSOHDR",$J,8,0) X=IORVON_"<A>"_IORVOFF,HDR=$$SETSTR^VALM1(X,HDR,80-$L(X),80) S VALMHDR(1)=HDR
"RTN","PSOLMUTL",15,0)
 I '(^TMP("PSOHDR",$J,8,0)) S PSONOAL="" D ALLERGY^PSOORUT2 I PSONOAL'="" D  K PSONOAL
"RTN","PSOLMUTL",16,0)
 .S X=IORVON_"<NO ALLERGY ASSESSMENT>"_IORVOFF,HDR=$$SETSTR^VALM1(X,HDR,80-$L(X),80) S VALMHDR(1)=HDR
"RTN","PSOLMUTL",17,0)
 S HDR="  PID: "_^TMP("PSOHDR",$J,2,0)
"RTN","PSOLMUTL",18,0)
 S VALMHDR(2)=$$SETSTR^VALM1("Ht(cm): "_^TMP("PSOHDR",$J,7,0),HDR,52,27)
"RTN","PSOLMUTL",19,0)
 S HDR="  DOB: "_^TMP("PSOHDR",$J,3,0)_" ("_^TMP("PSOHDR",$J,4,0)_")"
"RTN","PSOLMUTL",20,0)
 S VALMHDR(3)=$$SETSTR^VALM1(" Wt(kg): "_^TMP("PSOHDR",$J,6,0),HDR,51,28)
"RTN","PSOLMUTL",21,0)
 S HDR="  SEX: "_$E(^TMP("PSOHDR",$J,5,0),1,44)
"RTN","PSOLMUTL",22,0)
 S VALMHDR(4)=HDR
"RTN","PSOLMUTL",23,0)
 S $P(VALMHDR(4)," ",30)="  "_$E(^TMP("PSOHDR",$J,5,0),48,80)
"RTN","PSOLMUTL",24,0)
 Q:$G(PS)="VIEW"!($G(PS)="DELETE")
"RTN","PSOLMUTL",25,0)
 S VALMHDR(5)=$G(^TMP("PSOHDR",$J,9,0))
"RTN","PSOLMUTL",26,0)
 S VALMHDR(6)=$G(^TMP("PSOHDR",$J,10,0))
"RTN","PSOLMUTL",27,0)
 Q
"RTN","PSOLMUTL",28,0)
 ;
"RTN","PSOLMUTL",29,0)
NEWALL(DFN) ; Enter Allergy info.
"RTN","PSOLMUTL",30,0)
 N PSOID D FULL^VALM1,EN2^GMRAPEM0,^PSOORUT2 S VALMBCK="R"
"RTN","PSOLMUTL",31,0)
 Q
"RTN","PSOLMUTL",32,0)
NEWSEL ;allows order selection by number instead of action
"RTN","PSOLMUTL",33,0)
 S Y=$P(XQORNOD(0),"=",2) N VALMCNT D NEWSEL^PSOORNE2
"RTN","PSOLMUTL",34,0)
 Q
"RTN","PSOLMUTL",35,0)
EDTSEL ;allows edit selection by number instead of action - active orders
"RTN","PSOLMUTL",36,0)
 N VALMCNT S Y=$P(XQORNOD(0),"=",2) D EDTSEL^PSOOREDT
"RTN","PSOLMUTL",37,0)
 Q
"RTN","PSOLMUTL",38,0)
SELAL ;selection of allergy by number instead of action - select allergy
"RTN","PSOLMUTL",39,0)
 N VALMCNT S Y=$P(XQORNOD(0),"=",2) D SELAL^PSOORDA
"RTN","PSOLMUTL",40,0)
 Q
"RTN","PSOLMUTL",41,0)
EDTNEW ;allows edit selection by number instead of action - new orders
"RTN","PSOLMUTL",42,0)
 N VALMCNT S Y=$P(XQORNOD(0),"=",2) D EDTSEL^PSOORNE1
"RTN","PSOLMUTL",43,0)
 Q
"RTN","PSOLMUTL",44,0)
EDTRNEW ;allows edit selection by number instead of action - renew orders
"RTN","PSOLMUTL",45,0)
 N VALMCNT S Y=$P(XQORNOD(0),"=",2) D EDTSEL^PSOORNE4
"RTN","PSOLMUTL",46,0)
 Q
"RTN","PSOLMUTL",47,0)
EDTPEN ;allows edit selection by number instead of action - pending orders
"RTN","PSOLMUTL",48,0)
 N VALMCNT S Y=$P(XQORNOD(0),"=",2),SEDT=1 G EDTSEL^PSOORNEW
"RTN","PSOLMUTL",49,0)
 Q
"RTN","PSOLMUTL",50,0)
HLDHDR ;keeps patient's header info
"RTN","PSOLMUTL",51,0)
 S IOTM=VALM("TM"),IOBM=IOSL W IOSC W @IOSTBM W IORC
"RTN","PSOLMUTL",52,0)
 Q
"RTN","PSOLMUTL",53,0)
 ;
"RTN","PSOLMUTL",54,0)
BYPASS S:$G(PSOFDR) SIGOK=1 S Y=-1,VALMBCK="Q"
"RTN","PSOLMUTL",55,0)
 Q
"RTN","PSOLMUTL",56,0)
ACTIONS() ;screen actions on active orders
"RTN","PSOLMUTL",57,0)
 Q:$G(PKI1)=2 0
"RTN","PSOLMUTL",58,0)
 N DIC,X,Y K DIC,Y S DIC="^ORD(101,"_DA(1)_",10,",X=DA,DIC(0)="ZN" D ^DIC Q:Y<0 0
"RTN","PSOLMUTL",59,0)
 S Y=Y(0,0)
"RTN","PSOLMUTL",60,0)
 I Y="PSO REFILL" Q $S(PSOACT["R":1,1:0)
"RTN","PSOLMUTL",61,0)
 I Y="PSO RENEW" Q $S(PSOACT["N":1,1:0)
"RTN","PSOLMUTL",62,0)
 I Y="PSO REPRINT" Q $S(PSOACT["P":1,1:0)
"RTN","PSOLMUTL",63,0)
 I Y="PSO EDIT ORDERS" Q $S(PSOACT["E":1,1:0)
"RTN","PSOLMUTL",64,0)
 I Y="PSO RELEASE" Q $S(PSOACT["L":1,1:0)
"RTN","PSOLMUTL",65,0)
 I Y="PSO PARTIAL" Q $S(PSOACT["T":1,1:0)
"RTN","PSOLMUTL",66,0)
 I Y="PSO CANCEL" Q $S(PSOACT["D":1,1:0)
"RTN","PSOLMUTL",67,0)
 I Y="PSO HOLD" Q $S(PSOACT["H":1,1:0)
"RTN","PSOLMUTL",68,0)
 I Y="PSO UNHOLD" Q $S(PSOACT["U":1,1:0)
"RTN","PSOLMUTL",69,0)
 I Y="PSO LM BACKDOOR COPY" Q $S(PSOACT["C":1,1:0)
"RTN","PSOLMUTL",70,0)
 I Y="PSO VERIFY" Q $S(PSOACT["V":1,1:0)
"RTN","PSOLMUTL",71,0)
 I Y="PSO ACTIVITY LOGS" Q 1
"RTN","PSOLMUTL",72,0)
 Q 1
"RTN","PSOLMUTL",73,0)
ACTIONS1() ;screen actions on pending orders
"RTN","PSOLMUTL",74,0)
 Q:$G(PKI1)=2 0
"RTN","PSOLMUTL",75,0)
 N DIC,X,Y K DIC,Y S DIC="^ORD(101,"_DA(1)_",10,",X=DA,DIC(0)="ZN" D ^DIC Q:Y<0 0
"RTN","PSOLMUTL",76,0)
 S Y=Y(0,0)
"RTN","PSOLMUTL",77,0)
 I Y="PSO LM DISCONTINUE" Q $S(PSOACT["D":1,1:0)
"RTN","PSOLMUTL",78,0)
 I Y="PSO LM EDIT" Q $S(PSOACT["E":1,1:0)
"RTN","PSOLMUTL",79,0)
 I Y="PSO LM FINISH" Q $S(PSOACT["F":1,1:0)
"RTN","PSOLMUTL",80,0)
 I Y="PSO LM FLAG" Q $S(PSOACT["X":1,1:0)
"RTN","PSOLMUTL",81,0)
 Q 1
"RTN","PSOLMUTL",82,0)
PKIACT() ;screen actions on pending orders DEA/PKI proj.
"RTN","PSOLMUTL",83,0)
 Q:$G(PKI1)=2 0
"RTN","PSOLMUTL",84,0)
 Q 1
"RTN","PSOMLLD2")
0^24^B28319271
"RTN","PSOMLLD2",1,0)
PSOMLLD2 ;BIR/LE - Service Connection Check for SC>50% ;02/27/04
"RTN","PSOMLLD2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**143,219,239,225**;DEC 1997;Build 29
"RTN","PSOMLLD2",3,0)
 ;External reference SDC022 supported by DBIA 1579
"RTN","PSOMLLD2",4,0)
 ;External reference DIS^SDROUT2 private by DBIA 112
"RTN","PSOMLLD2",5,0)
 ;External reference $$GETSHAD^DGUTL3 supported by DBIA 4462
"RTN","PSOMLLD2",6,0)
SC ;This routine is used for SC>50% - OUTSIDE OF COPAY - DFN AND PSOSCP VARIABLES ARE EXPECTED TO BE PRESENT WHEN CALLED
"RTN","PSOMLLD2",7,0)
 ; Requires: DFN, PSOSCP, PSOSCA 
"RTN","PSOMLLD2",8,0)
 I '$G(DFN) N DFN S DFN=+$G(PSODFN)
"RTN","PSOMLLD2",9,0)
 ;I $G(DFN) I '$$SC^SDCO22(DFN) D  Q  ;if SC>49 don't ask if api says not to
"RTN","PSOMLLD2",10,0)
 ;. K PSOANSQ("SC>50"),PSOANSQD("SC>50") I $G(PSOX("IRXN")) K PSOANSQ(PSOX("IRXN"),"SC>50")
"RTN","PSOMLLD2",11,0)
SC2 I $G(PSOMESOI)=1,$G(PSORXED) W !!,"The Pharmacy Orderable Item has changed for this order. Please review any",!,"existing SC or Environmental Indicator defaults carefully for appropriateness.",! S PSOMESOI=2
"RTN","PSOMLLD2",12,0)
 I $G(PSOMESFI)=1 W !!,"The Pharmacy Orderable Item has changed for this order. Please review any",!,"existing SC or Environmental Indicator defaults carefully for appropriateness.",! S PSOMESFI=2
"RTN","PSOMLLD2",13,0)
 D DIS^SDROUT2
"RTN","PSOMLLD2",14,0)
 N PSOUFLAG S PSOUFLAG=0 K DIR S DIR(0)="Y"
"RTN","PSOMLLD2",15,0)
 S DIR("A")="Was treatment for a Service Connected condition"
"RTN","PSOMLLD2",16,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition related",DIR("?",2)="to Service Connected."
"RTN","PSOMLLD2",17,0)
 I '$G(PSOFLAG) D
"RTN","PSOMLLD2",18,0)
 . I PSOSCP<50 S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"SC"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"SC"))=1:"YES",1:"") I DIR("B")="" K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLD2",19,0)
 . I PSOSCP<50&($D(PSORX(+$G(PSORENW("OIRXN")),"SC>50"))) S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"SC>50"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"SC>50"))=1:"YES",1:"") I DIR("B")=""  K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLD2",20,0)
 . I PSOSCP>49 S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"SC>50"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"SC>50"))=1:"YES",1:"") I DIR("B")=""  K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLD2",21,0)
 . I '$D(DIR("B"))&($D(PSOANSQD("SC>50"))!($D(PSOANSQD("SC")))) D  I '$D(DIR("B")) K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLD2",22,0)
 .. I $D(PSOANSQD("SC>50")) I $G(PSOANSQD("SC>50"))=0!($G(PSOANSQD("SC>50"))=1) S (PSOUFLAG,DIR("B"))=$S($G(PSOANSQD("SC>50"))=1:"YES",1:"NO")
"RTN","PSOMLLD2",23,0)
 .. I $D(PSOANSQD("SC")) I $G(PSOANSQD("SC"))=0!($G(PSOANSQD("SC"))=1) S (PSOUFLAG,DIR("B"))=$S($G(PSOANSQD("SC"))=1:"YES",1:"NO")
"RTN","PSOMLLD2",24,0)
 I $G(PSORX("SC"))]""!($G(PSORX(+$G(PSORENW("OIRXN")),"SC"))'="") S DIR("B")=$S($G(PSORX("SC"))="SC":"YES",$G(PSORX("SC"))="NSC":"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"SC"))=1:"YES",$G(PSORX(+$G(PSORENW("OIRXN")),"SC"))=0:"NO",1:"")
"RTN","PSOMLLD2",25,0)
 ;
"RTN","PSOMLLD2",26,0)
 I $G(PSOFLAG),$G(PSONEWFF) I $G(PSOANSQD("SC>50"))=0!($G(PSOANSQD("SC>50"))=1) S DIR("B")=$S($G(PSOANSQD("SC>50"))=1:"YES",1:"NO")
"RTN","PSOMLLD2",27,0)
 I $G(DIR("B"))="YES"!($G(DIR("B"))="NO") S PSOUFLAG=$G(DIR("B"))
"RTN","PSOMLLD2",28,0)
 I $G(DIR("B"))="" K DIR("B")
"RTN","PSOMLLD2",29,0)
 W ! D ^DIR K DIR
"RTN","PSOMLLD2",30,0)
 I $G(Y)=1!($G(Y)=0) D  I $G(PSONEWFF),$G(PSOFLAG) S PSOANSQD("SC>50")=$G(Y)
"RTN","PSOMLLD2",31,0)
 . I $G(PSOX("IRXN")) S PSOANSQ(PSOX("IRXN"),"SC>50")=+Y
"RTN","PSOMLLD2",32,0)
 . S PSOANSQ("SC>50")=+Y
"RTN","PSOMLLD2",33,0)
 I PSOFLAG I Y["^"!($D(DTOUT))!($D(DUOUT)) S PSOCPZ("DFLG")=1
"RTN","PSOMLLD2",34,0)
 S:Y=0 Y=2
"RTN","PSOMLLD2",35,0)
 S PSOANSR=+Y I 'PSOANSR,'PSOFLAG D  S $P(PSOCPAY,"^")=$S($G(PSOUFLAG)="NO":1,1:0) W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR Q
"RTN","PSOMLLD2",36,0)
 .W !!,"This Renewal has been designated as "_$S($G(PSOUFLAG)="YES":"SERVICE CONNECTED",1:"NON-SERVICE CONNECTED.")
"RTN","PSOMLLD2",37,0)
 .;W !,"Please use the 'Reset Copay Status/Cancel Charges' option to make  corrections."
"RTN","PSOMLLD2",38,0)
 .S PSOANSQ("SC>50")=$S($G(PSOUFLAG)="YES":1,1:0)
"RTN","PSOMLLD2",39,0)
 I $G(PSOFLAG),$G(PSOCPZ("DFLG")) G EXIT
"RTN","PSOMLLD2",40,0)
 S:PSOANSR=1 PSOCPAY=0 S:PSOANSR=2 $P(PSOCPAY,"^")=1
"RTN","PSOMLLD2",41,0)
EXIT ;
"RTN","PSOMLLD2",42,0)
 K PSOANSR,DIR,DUOUT,DIRUT,DTOUT,Y,X,PSOSCA
"RTN","PSOMLLD2",43,0)
 Q
"RTN","PSOMLLD2",44,0)
 ;
"RTN","PSOMLLD2",45,0)
PAUSE K DIR W ! S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOMLLD2",46,0)
 Q
"RTN","PSOMLLD2",47,0)
 ;
"RTN","PSOMLLD2",48,0)
SHAD ; PROJ 112/SHAD Question
"RTN","PSOMLLD2",49,0)
 I $G(PSODFN),$L($T(GETSHAD^DGUTL3)) I $$GETSHAD^DGUTL3(PSODFN)'=1 D  Q
"RTN","PSOMLLD2",50,0)
 . K PSOANSQ("SHAD"),PSOANSQD("SHAD") I $G(PSOX("IRXN")) K PSOANSQ(PSOX("IRXN"),"SHAD")
"RTN","PSOMLLD2",51,0)
 N PSOUFLAG S PSOUFLAG=0
"RTN","PSOMLLD2",52,0)
 K DIR S DIR(0)="Y"
"RTN","PSOMLLD2",53,0)
 S DIR("A")="Was treatment related to PROJ 112/SHAD"
"RTN","PSOMLLD2",54,0)
 S DIR("?")=" "
"RTN","PSOMLLD2",55,0)
 S DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition due to"
"RTN","PSOMLLD2",56,0)
 S DIR("?",2)="Shipboard Hazard and Defense (SHAD) exposure."
"RTN","PSOMLLD2",57,0)
 S DIR("?",3)="This response will be used to determine whether or not a copay should"
"RTN","PSOMLLD2",58,0)
 S DIR("?",4)="be applied to the prescription."
"RTN","PSOMLLD2",59,0)
 I '$G(PSOFLAG) D
"RTN","PSOMLLD2",60,0)
 . S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"SHAD"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"SHAD"))=1:"YES",1:"")
"RTN","PSOMLLD2",61,0)
 . I DIR("B")="" K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLD2",62,0)
 I $G(PSOFLAG),$G(PSONEWFF) D
"RTN","PSOMLLD2",63,0)
 . I $G(PSOANSQD("SHAD"))=0!($G(PSOANSQD("SHAD"))=1) D
"RTN","PSOMLLD2",64,0)
 . . S DIR("B")=$S($G(PSOANSQD("SHAD"))=1:"YES",1:"NO")
"RTN","PSOMLLD2",65,0)
 W ! D ^DIR K DIR
"RTN","PSOMLLD2",66,0)
 I $G(PSOFLAG) W ! D  Q
"RTN","PSOMLLD2",67,0)
 . I Y["^"!($D(DUOUT))!($G(DTOUT)) S PSOCPZ("DFLG")=1 Q
"RTN","PSOMLLD2",68,0)
 . S PSOANSQ("SHAD")=Y
"RTN","PSOMLLD2",69,0)
 . I $G(PSONEWFF) S PSOANSQD("SHAD")=Y
"RTN","PSOMLLD2",70,0)
 I Y["^"!($D(DUOUT))!($D(DTOUT)) D  Q
"RTN","PSOMLLD2",71,0)
 . W !!,"This Renewal has been designated as"_$S($G(PSOUFLAG)="YES":"",1:" NOT")_" being used for treatment of "
"RTN","PSOMLLD2",72,0)
 . W !,"Shipboard Hazard and Defense (SHAD) exposure." D:$G(PSOSCP)<50 MESS^PSOMLLDT D PAUSE
"RTN","PSOMLLD2",73,0)
 . S PSOANSQ(PSOX("IRXN"),"SHAD")=$S($G(PSOUFLAG)="YES":1,1:0)
"RTN","PSOMLLD2",74,0)
 I $G(PSOX("IRXN")) S PSOANSQ(PSOX("IRXN"),"SHAD")=Y
"RTN","PSOMLLD2",75,0)
 E  S PSOANSQ("SHAD")=Y
"RTN","PSOMLLD2",76,0)
 Q
"RTN","PSOMLLD2",77,0)
 ;
"RTN","PSOMLLDT")
0^25^B86446402
"RTN","PSOMLLDT",1,0)
PSOMLLDT ;BIR/RTR - Copay date routine ;08/24/01
"RTN","PSOMLLDT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**71,157,143,219,278,225**;DEC 1997;Build 29
"RTN","PSOMLLDT",3,0)
 ;External reference SDC022 supported by DBIA 1579
"RTN","PSOMLLDT",4,0)
 ;External reference DGMSTAPI supported by DBIA2716
"RTN","PSOMLLDT",5,0)
 ;CIDC: Before doing EI question, check to see if should ask ei question 
"RTN","PSOMLLDT",6,0)
 ; because the flag could have changed in enrollment and we shouldn't
"RTN","PSOMLLDT",7,0)
 ; ask if not flagged and should set nulls for answer if Rx is renewed
"RTN","PSOMLLDT",8,0)
 ; or copied when flags changed.  Also, CPRS sometimes sends zeros for
"RTN","PSOMLLDT",9,0)
 ; null answers. 5/12/04
"RTN","PSOMLLDT",10,0)
DT() ;function for Copay date
"RTN","PSOMLLDT",11,0)
 ;0 means Copay not in effect, 1 means Copay in effect
"RTN","PSOMLLDT",12,0)
 N PSOMILDT
"RTN","PSOMLLDT",13,0)
 S PSOMILDT=3020101
"RTN","PSOMLLDT",14,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSOMLLDT",15,0)
 Q $S(DT<PSOMILDT:0,1:1)
"RTN","PSOMLLDT",16,0)
 ;
"RTN","PSOMLLDT",17,0)
 Q
"RTN","PSOMLLDT",18,0)
 ;New Copay questions, require if a Renewal
"RTN","PSOMLLDT",19,0)
 ;PSOFLAG=1 for New, PSOFLAG=0 for Renewal
"RTN","PSOMLLDT",20,0)
MST ;Military Sexual Trauma Question
"RTN","PSOMLLDT",21,0)
 I $G(PSODFN) I $P($$GETSTAT^DGMSTAPI(PSODFN),"^",2)'="Y" D  Q
"RTN","PSOMLLDT",22,0)
 . K PSOANSQ("MST"),PSOANSQD("MST") I $G(PSOX("IRXN")) K PSOANSQ(PSOX("IRXN"),"MST")
"RTN","PSOMLLDT",23,0)
 N PSOUFLAG S PSOUFLAG=0
"RTN","PSOMLLDT",24,0)
 K DIR S DIR(0)="Y"
"RTN","PSOMLLDT",25,0)
 S DIR("A")="Was treatment related to Military Sexual Trauma"
"RTN","PSOMLLDT",26,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition related",DIR("?",2)="to Military Sexual Trauma. This response will be used to determine whether or"
"RTN","PSOMLLDT",27,0)
 S DIR("?",3)="not a copay should be applied to the prescription."
"RTN","PSOMLLDT",28,0)
 I '$G(PSOFLAG) S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"MST"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"MST"))=1:"YES",1:"") I DIR("B")="" K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLDT",29,0)
 I $G(PSOFLAG),$G(PSONEWFF) I $G(PSOANSQD("MST"))=0!($G(PSOANSQD("MST"))=1) S DIR("B")=$S($G(PSOANSQD("MST"))=1:"YES",1:"NO")
"RTN","PSOMLLDT",30,0)
 W ! D ^DIR K DIR
"RTN","PSOMLLDT",31,0)
 I $G(PSOFLAG) W ! D  Q
"RTN","PSOMLLDT",32,0)
 .I Y["^"!($D(DUOUT))!($D(DTOUT)) S PSOCPZ("DFLG")=1 Q
"RTN","PSOMLLDT",33,0)
 .S PSOANSQ("MST")=Y
"RTN","PSOMLLDT",34,0)
 .I $G(PSONEWFF) S PSOANSQD("MST")=Y
"RTN","PSOMLLDT",35,0)
 I Y["^"!($D(DUOUT))!($D(DTOUT)) D  W !!,"This Renewal has been designated as"_$S($G(PSOUFLAG)="YES":"",1:" NOT")_" being used for treatment of Military",!,"Sexual Trauma." D:$G(PSOSCP)<50 MESSM D PAUSE Q
"RTN","PSOMLLDT",36,0)
 .S PSOANSQ(PSOX("IRXN"),"MST")=$S($G(PSOUFLAG)="YES":1,1:0)
"RTN","PSOMLLDT",37,0)
 I $G(PSOX("IRXN")) S PSOANSQ(PSOX("IRXN"),"MST")=Y
"RTN","PSOMLLDT",38,0)
 E  S PSOANSQ("MST")=Y
"RTN","PSOMLLDT",39,0)
 Q
"RTN","PSOMLLDT",40,0)
VEH ;Vietnam-Era Herbicide Question
"RTN","PSOMLLDT",41,0)
 I $G(PSODFN) I '$$AO^SDCO22(PSODFN) D  Q
"RTN","PSOMLLDT",42,0)
 . K PSOANSQ("VEH"),PSOANSQD("VEH") I $G(PSOX("IRXN")) K PSOANSQ(PSOX("IRXN"),"VEH")
"RTN","PSOMLLDT",43,0)
 N PSOUFLAG S PSOUFLAG=0
"RTN","PSOMLLDT",44,0)
 K DIR S DIR(0)="Y"
"RTN","PSOMLLDT",45,0)
 S DIR("A")="Was treatment related to Agent Orange exposure"
"RTN","PSOMLLDT",46,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition due to",DIR("?",2)="Vietnam-Era Herbicide (Agent Orange) exposure. This response will be used to"
"RTN","PSOMLLDT",47,0)
 S DIR("?",3)="determine whether or not a copay should be applied to the prescription."
"RTN","PSOMLLDT",48,0)
 I '$G(PSOFLAG) S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"VEH"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"VEH"))=1:"YES",1:"") I DIR("B")="" K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLDT",49,0)
 I $G(PSOFLAG),$G(PSONEWFF) I $G(PSOANSQD("VEH"))=0!($G(PSOANSQD("VEH"))=1) S DIR("B")=$S($G(PSOANSQD("VEH"))=1:"YES",1:"NO")
"RTN","PSOMLLDT",50,0)
 W ! D ^DIR K DIR
"RTN","PSOMLLDT",51,0)
 I $G(PSOFLAG) W ! D  Q
"RTN","PSOMLLDT",52,0)
 .I Y["^"!($D(DUOUT))!($D(DTOUT)) S PSOCPZ("DFLG")=1 Q
"RTN","PSOMLLDT",53,0)
 .S PSOANSQ("VEH")=Y
"RTN","PSOMLLDT",54,0)
 .I $G(PSONEWFF) S PSOANSQD("VEH")=Y
"RTN","PSOMLLDT",55,0)
 I Y["^"!($D(DUOUT))!($D(DTOUT)) D  W !!,"This Renewal has been designated as"_$S($G(PSOUFLAG)="YES":"",1:" NOT")_" being used for treatment of Vietnam-Era",!,"Herbicide (Agent Orange) exposure." D:$G(PSOSCP)<50 MESSV D PAUSE Q
"RTN","PSOMLLDT",56,0)
 .S PSOANSQ(PSOX("IRXN"),"VEH")=$S($G(PSOUFLAG)="YES":1,1:0)
"RTN","PSOMLLDT",57,0)
 I $G(PSOX("IRXN")) S PSOANSQ(PSOX("IRXN"),"VEH")=Y
"RTN","PSOMLLDT",58,0)
 E  S PSOANSQ("VEH")=Y
"RTN","PSOMLLDT",59,0)
 Q
"RTN","PSOMLLDT",60,0)
RAD ;Radiation question
"RTN","PSOMLLDT",61,0)
 I $G(PSODFN) I '$$IR^SDCO22(PSODFN) D  Q
"RTN","PSOMLLDT",62,0)
 . K PSOANSQ("RAD"),PSOANSQD("RAD") I $G(PSOX("IRXN")) K PSOANSQ(PSOX("IRXN"),"RAD")
"RTN","PSOMLLDT",63,0)
 N PSOUFLAG S PSOUFLAG=0
"RTN","PSOMLLDT",64,0)
 K DIR S DIR(0)="Y"
"RTN","PSOMLLDT",65,0)
 S DIR("A")="Was treatment related to Ionizing Radiation exposure"
"RTN","PSOMLLDT",66,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition due to",DIR("?",2)="ionizing radiation exposure during military service. This response will be used"
"RTN","PSOMLLDT",67,0)
 S DIR("?",3)="to determine whether or not a copay should be applied to the prescription."
"RTN","PSOMLLDT",68,0)
 I '$G(PSOFLAG) S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"RAD"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"RAD"))=1:"YES",1:"") I DIR("B")="" K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLDT",69,0)
 I $G(PSOFLAG),$G(PSONEWFF) I $G(PSOANSQD("RAD"))=0!($G(PSOANSQD("RAD"))=1) S DIR("B")=$S($G(PSOANSQD("RAD"))=1:"YES",1:"NO")
"RTN","PSOMLLDT",70,0)
 W ! D ^DIR K DIR
"RTN","PSOMLLDT",71,0)
 I $G(PSOFLAG) W ! D  Q
"RTN","PSOMLLDT",72,0)
 .I Y["^"!($D(DUOUT))!($G(DTOUT)) S PSOCPZ("DFLG")=1 Q
"RTN","PSOMLLDT",73,0)
 .S PSOANSQ("RAD")=Y
"RTN","PSOMLLDT",74,0)
 .I $G(PSONEWFF) S PSOANSQD("RAD")=Y
"RTN","PSOMLLDT",75,0)
 I Y["^"!($D(DUOUT))!($D(DTOUT)) D  W !!,"This Renewal has been designated as"_$S($G(PSOUFLAG)="YES":"",1:" NOT")_" being used for treatment of ionizing",!,"radiation exposure." D:$G(PSOSCP)<50 MESSM D PAUSE Q
"RTN","PSOMLLDT",76,0)
 .S PSOANSQ(PSOX("IRXN"),"RAD")=$S($G(PSOUFLAG)="YES":1,1:0)
"RTN","PSOMLLDT",77,0)
 I $G(PSOX("IRXN")) S PSOANSQ(PSOX("IRXN"),"RAD")=Y
"RTN","PSOMLLDT",78,0)
 E  S PSOANSQ("RAD")=Y
"RTN","PSOMLLDT",79,0)
 Q
"RTN","PSOMLLDT",80,0)
PGW ;Persian Gulf War question
"RTN","PSOMLLDT",81,0)
 I $G(PSODFN) I '$$EC^SDCO22(PSODFN) D  Q
"RTN","PSOMLLDT",82,0)
 . K PSOANSQ("PGW"),PSOANSQD("PGW") I $G(PSOX("IRXN")) K PSOANSQ(PSOX("IRXN"),"PGW")
"RTN","PSOMLLDT",83,0)
 N PSOUFLAG S PSOUFLAG=0
"RTN","PSOMLLDT",84,0)
 K DIR S DIR(0)="Y"
"RTN","PSOMLLDT",85,0)
 S DIR("A")="Was treatment related to service in SW Asia"
"RTN","PSOMLLDT",86,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition related to"
"RTN","PSOMLLDT",87,0)
 S DIR("?",2)="service in Southwest Asia. This response will be used to determine whether or"
"RTN","PSOMLLDT",88,0)
 S DIR("?",3)="not a copay should be applied to the prescription."
"RTN","PSOMLLDT",89,0)
 I '$G(PSOFLAG) S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"PGW"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"PGW"))=1:"YES",1:"") I DIR("B")="" K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLDT",90,0)
 I $G(PSOFLAG),$G(PSONEWFF) I $G(PSOANSQD("PGW"))=0!($G(PSOANSQD("PGW"))=1) S DIR("B")=$S($G(PSOANSQD("PGW"))=1:"YES",1:"NO")
"RTN","PSOMLLDT",91,0)
 W ! D ^DIR K DIR
"RTN","PSOMLLDT",92,0)
 I $G(PSOFLAG) W ! D  Q
"RTN","PSOMLLDT",93,0)
 .I Y["^"!($D(DUOUT))!($D(DTOUT)) S PSOCPZ("DFLG")=1 Q
"RTN","PSOMLLDT",94,0)
 .S PSOANSQ("PGW")=Y
"RTN","PSOMLLDT",95,0)
 .I $G(PSONEWFF) S PSOANSQD("PGW")=Y
"RTN","PSOMLLDT",96,0)
 I Y["^"!($D(DUOUT))!($D(DTOUT)) D  W !!,"This Renewal has been designated as"_$S($G(PSOUFLAG)="YES":"",1:" NOT")_" being used for treatment of",!,"Southwest Asia Conditions exposure." D:$G(PSOSCP)<50 MESS D PAUSE Q
"RTN","PSOMLLDT",97,0)
 .S PSOANSQ(PSOX("IRXN"),"PGW")=$S($G(PSOUFLAG)="YES":1,1:0)
"RTN","PSOMLLDT",98,0)
 I $G(PSOX("IRXN")) S PSOANSQ(PSOX("IRXN"),"PGW")=Y
"RTN","PSOMLLDT",99,0)
 E  S PSOANSQ("PGW")=Y
"RTN","PSOMLLDT",100,0)
 Q
"RTN","PSOMLLDT",101,0)
HNC ;Head or Neck Cancer question
"RTN","PSOMLLDT",102,0)
 I $G(PSODFN) I $T(GETCUR^DGNTAPI)]"" N PSONCP,PSONCPX S PSONCPX=$$GETCUR^DGNTAPI(PSODFN,"PSONCP") I $P($G(PSONCP("IND")),"^")'="Y" D  Q
"RTN","PSOMLLDT",103,0)
 . K PSOANSQ("HNC"),PSOANSQD("HNC") I $G(PSOX("IRXN")) K PSOANSQ(PSOX("IRXN"),"HNC")
"RTN","PSOMLLDT",104,0)
 N PSOUFLAG S PSOUFLAG=0
"RTN","PSOMLLDT",105,0)
 K DIR S DIR(0)="Y"
"RTN","PSOMLLDT",106,0)
 S DIR("A")="Was treatment related to Head and/or Neck Cancer"
"RTN","PSOMLLDT",107,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat Head and/or Neck Cancer",DIR("?",2)="due to nose or throat radium treatments while in the military. This response"
"RTN","PSOMLLDT",108,0)
 S DIR("?",3)="will be used to determine whether or not a copay should be applied to the",DIR("?",4)="prescription."
"RTN","PSOMLLDT",109,0)
 I '$G(PSOFLAG) S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"HNC"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"HNC"))=1:"YES",1:"") I DIR("B")="" K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLDT",110,0)
 I $G(PSOFLAG),$G(PSONEWFF) I $G(PSOANSQD("HNC"))=0!($G(PSOANSQD("HNC"))=1) S DIR("B")=$S($G(PSOANSQD("HNC"))=1:"YES",1:"NO")
"RTN","PSOMLLDT",111,0)
 W ! D ^DIR K DIR
"RTN","PSOMLLDT",112,0)
 I $G(PSOFLAG) W ! D  Q
"RTN","PSOMLLDT",113,0)
 .I Y["^"!($D(DUOUT))!($D(DTOUT)) S PSOCPZ("DFLG")=1 Q
"RTN","PSOMLLDT",114,0)
 .S PSOANSQ("HNC")=Y
"RTN","PSOMLLDT",115,0)
 .I $G(PSONEWFF) S PSOANSQD("HNC")=Y
"RTN","PSOMLLDT",116,0)
 I Y["^"!($D(DUOUT))!($D(DTOUT)) D  W !!,"This Renewal has been designated as"_$S($G(PSOUFLAG)="YES":"",1:" NOT")_" being used for treatment related to",!,"Head and/or Neck Cancer." D:$G(PSOSCP)<50 MESSV D PAUSE Q
"RTN","PSOMLLDT",117,0)
 .S PSOANSQ(PSOX("IRXN"),"HNC")=$S($G(PSOUFLAG)="YES":1,1:0)
"RTN","PSOMLLDT",118,0)
 I $G(PSOX("IRXN")) S PSOANSQ(PSOX("IRXN"),"HNC")=Y
"RTN","PSOMLLDT",119,0)
 E  S PSOANSQ("HNC")=Y
"RTN","PSOMLLDT",120,0)
 Q
"RTN","PSOMLLDT",121,0)
CV ; Combat Veteran Question
"RTN","PSOMLLDT",122,0)
 I $G(PSODFN) I '(+$P($$CVEDT^DGCV(PSODFN),"^",3)) D  Q
"RTN","PSOMLLDT",123,0)
 . K PSOANSQ("CV"),PSOANSQD("CV") I $G(PSOX("IRXN")) K PSOANSQ(PSOX("IRXN"),"CV")
"RTN","PSOMLLDT",124,0)
 N PSOUFLAG S PSOUFLAG=0
"RTN","PSOMLLDT",125,0)
 K DIR S DIR(0)="Y"
"RTN","PSOMLLDT",126,0)
 S DIR("A")="Was treatment related to Combat"
"RTN","PSOMLLDT",127,0)
 S DIR("?")=" "
"RTN","PSOMLLDT",128,0)
 S DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition due to"
"RTN","PSOMLLDT",129,0)
 S DIR("?",2)="active duty in a theater of combat operations during a period of war after the"
"RTN","PSOMLLDT",130,0)
 S DIR("?",3)="Gulf War. This response will be used to determine whether or not a copay should"
"RTN","PSOMLLDT",131,0)
 S DIR("?",4)="be applied to the prescription."
"RTN","PSOMLLDT",132,0)
 S DIR("B")="YES"
"RTN","PSOMLLDT",133,0)
 I '$G(PSOFLAG) D
"RTN","PSOMLLDT",134,0)
 .  S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"CV"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"CV"))=1:"YES",1:"")
"RTN","PSOMLLDT",135,0)
 .  I DIR("B")="" S (PSOUFLAG,DIR("B"))="YES"
"RTN","PSOMLLDT",136,0)
 I $G(PSOFLAG),$G(PSONEWFF) D
"RTN","PSOMLLDT",137,0)
 .  I $G(PSOANSQD("CV"))=0!($G(PSOANSQD("CV"))=1) D
"RTN","PSOMLLDT",138,0)
 .  .  S DIR("B")=$S($G(PSOANSQD("CV"))=1:"YES",1:"NO")
"RTN","PSOMLLDT",139,0)
 W ! D ^DIR K DIR
"RTN","PSOMLLDT",140,0)
 I $G(PSOFLAG) W ! D  Q
"RTN","PSOMLLDT",141,0)
 .  I Y["^"!($D(DUOUT))!($G(DTOUT)) S PSOCPZ("DFLG")=1 Q
"RTN","PSOMLLDT",142,0)
 .  S PSOANSQ("CV")=Y
"RTN","PSOMLLDT",143,0)
 .  I $G(PSONEWFF) S PSOANSQD("CV")=Y
"RTN","PSOMLLDT",144,0)
 I Y["^"!($D(DUOUT))!($D(DTOUT)) D  Q
"RTN","PSOMLLDT",145,0)
 .  W !!,"This Renewal has been designated as"_$S($G(PSOUFLAG)="YES":"",1:" NOT")_" being used for treatment of military"
"RTN","PSOMLLDT",146,0)
 .  W !,"combat service." D:$G(PSOSCP)<50 MESSM D PAUSE
"RTN","PSOMLLDT",147,0)
 .  S PSOANSQ(PSOX("IRXN"),"CV")=$S($G(PSOUFLAG)="YES":1,1:0)
"RTN","PSOMLLDT",148,0)
 I $G(PSOX("IRXN")) S PSOANSQ(PSOX("IRXN"),"CV")=Y
"RTN","PSOMLLDT",149,0)
 E  S PSOANSQ("CV")=Y
"RTN","PSOMLLDT",150,0)
 Q
"RTN","PSOMLLDT",151,0)
PAUSE ;
"RTN","PSOMLLDT",152,0)
 K DIR W ! S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOMLLDT",153,0)
 Q
"RTN","PSOMLLDT",154,0)
MESS ;
"RTN","PSOMLLDT",155,0)
 Q:$G(PSODRUG("DEA"))["S"!($G(PSODRUG("DEA"))["I")
"RTN","PSOMLLDT",156,0)
 W !,"Please use the 'Reset Copay Status/Cancel Charges' option to make corrections.",!
"RTN","PSOMLLDT",157,0)
 Q
"RTN","PSOMLLDT",158,0)
MESSM ;
"RTN","PSOMLLDT",159,0)
 Q:$G(PSODRUG("DEA"))["S"!($G(PSODRUG("DEA"))["I")
"RTN","PSOMLLDT",160,0)
 W " Please use the 'Reset Copay Status/Cancel Charges' option",!,"to make corrections.",!
"RTN","PSOMLLDT",161,0)
 Q
"RTN","PSOMLLDT",162,0)
MESSV ;
"RTN","PSOMLLDT",163,0)
 Q:$G(PSODRUG("DEA"))["S"!($G(PSODRUG("DEA"))["I")
"RTN","PSOMLLDT",164,0)
 W " Please use the 'Reset Copay Status/Cancel",!,"Charges' option to make corrections.",!
"RTN","PSON52")
0^10^B62785056
"RTN","PSON52",1,0)
PSON52 ;BIR/DSD - files new entries in prescription file ;08/09/93
"RTN","PSON52",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,16,23,27,32,46,71,111,124,117,131,139,157,143,219,148,239,201,268,260,225**;DEC 1997;Build 29
"RTN","PSON52",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSON52",4,0)
 ;External reference to PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSON52",5,0)
 ;External reference to ^XUSEC supported by DBIA 10076
"RTN","PSON52",6,0)
 ;External reference SWSTAT^IBBAPI supported by DBIA 4663
"RTN","PSON52",7,0)
 ;External reference SAVNDC^PSSNDCUT supported by DBIA 4707
"RTN","PSON52",8,0)
EN(PSOX) ;Entry Point
"RTN","PSON52",9,0)
START ;
"RTN","PSON52",10,0)
 D:$D(XRTL) T0^%ZOSV ; Start RT Monitor
"RTN","PSON52",11,0)
 D INIT G:PSON52("QFLG") END D NFILE Q:$G(PSONEW("DFLG"))  D PS55,DIK
"RTN","PSON52",12,0)
 S:$D(XRT0) XRTN=$T(+0) D:$D(XRT0) T1^%ZOSV ; Stop RT Monitor
"RTN","PSON52",13,0)
 D FINISH
"RTN","PSON52",14,0)
 I $P(^PSRX(PSOX("IRXN"),0),"^",11)="W",$G(^("IB")) S ^PSRX("ACP",$P(^PSRX(PSOX("IRXN"),0),"^",2),$P(^(2),"^",2),0,PSOX("IRXN"))=""
"RTN","PSON52",15,0)
END D EOJ
"RTN","PSON52",16,0)
 Q
"RTN","PSON52",17,0)
INIT ;
"RTN","PSON52",18,0)
 K X,%DT S:$G(PSOID) PSOX("ISSUE DATE")=PSOID
"RTN","PSON52",19,0)
 S PSOX("CS")=0
"RTN","PSON52",20,0)
 F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S $P(PSOX("CS"),"^")=1 S:$E(+PSODRUG("DEA"),DEA)=2 $P(PSOX("CS"),"^",2)=1
"RTN","PSON52",21,0)
 S PSON52("QFLG")=0,X1=PSOX("ISSUE DATE"),X2=PSOX("DAYS SUPPLY")*(PSOX("# OF REFILLS")+1)\1
"RTN","PSON52",22,0)
 I $D(CLOZPAT) S X2=$S(X2=14:14,X2=7:7,1:X2) G DT
"RTN","PSON52",23,0)
 S X2=$S(PSOX("DAYS SUPPLY")=X2:X2,+$G(PSOX("CS")):184,+$G(DEA("CS")):184,1:366)
"RTN","PSON52",24,0)
 I X2<30 D
"RTN","PSON52",25,0)
 . N % S %=$P($G(PSORX("PATIENT STATUS")),"^"),X2=30
"RTN","PSON52",26,0)
 . S:%?.N %=$P($G(^PS(53,+%,0)),"^") I %["AUTH ABS" S X2=5
"RTN","PSON52",27,0)
DT D C^%DTC S PSOX("STOP DATE")=$P(X,".") K X
"RTN","PSON52",28,0)
 I PSOX("# OF REFILLS")>0 S X1=PSOX("FILL DATE"),X2=$S((PSOX("DAYS SUPPLY")-10\1)<1:1,1:PSOX("DAYS SUPPLY")-10\1) D C^%DTC S PSOX("NEXT POSSIBLE REFILL")=$P(X,".") K X
"RTN","PSON52",29,0)
 S PSOX("TYPE OF RX")=0,PSOX("DISPENSED DATE")=PSOX("FILL DATE") D NOW^%DTC S PSOX("LOGIN DATE")=$S($P($G(OR0),"^",12):$P($G(OR0),"^",12),1:%) K %,X
"RTN","PSON52",30,0)
 S PSOX("STATUS")=$S($G(PSOX("STATUS"))]"":PSOX("STATUS"),$D(PSORX("VERIFY")):1,1:0)
"RTN","PSON52",31,0)
 S PSOX("COPIES")=$S($G(PSOX("COPIES"))]"":PSOX("COPIES"),1:1)
"RTN","PSON52",32,0)
 I $G(PSORX("PHARM"))]"" S PSOX("PHARMACIST")=PSORX("PHARM") K PSORX("PHARM")
"RTN","PSON52",33,0)
INITX Q
"RTN","PSON52",34,0)
 ;
"RTN","PSON52",35,0)
NFILE I $G(OR0) D  Q:$G(PSONEW("DFLG"))
"RTN","PSON52",36,0)
 .D NOOR^PSONEW Q:$G(PSONEW("DFLG"))
"RTN","PSON52",37,0)
 .I $G(PSOSIGFL)!($G(PSODRUG("OI"))'=$P(OR0,"^",8)) S PSONEW("CLERK CODE")=DUZ,PSONEW("REMARKS")=$G(PSONEW("REMARKS"))_" CPRS Order #"_$P(OR0,"^")_" Edited."
"RTN","PSON52",38,0)
 S DIC="^PSRX(",DLAYGO=52,DIC(0)="L",X=PSOX("RX #") K DD,DO D FILE^DICN S PSOX("IRXN")=+Y K DLAYGO,X,Y,DIC,DD,DO D:+$G(DGI) TECH^PSODGDGI
"RTN","PSON52",39,0)
 F PSOX1=0:1 S PSON52=$P($T(DD+PSOX1),";;",2,4) Q:PSON52=""  K PSOY S PSOY=$P(PSON52,";;") I $G(@PSOY)]"" S $P(PSON52(PSOX("IRXN"),$P(PSON52,";;",2)),"^",$P(PSON52,";;",3))=@PSOY
"RTN","PSON52",40,0)
 F I=1:1:PSOX("ENT") S ^PSRX(PSOX("IRXN"),6,I,0)=PSOX("DOSE",I)_"^"_$G(PSOX("DOSE ORDERED",I))_"^"_$G(PSOX("UNITS",I))_"^"_$G(PSOX("NOUN",I))_"^" D
"RTN","PSON52",41,0)
 .S ^PSRX(PSOX("IRXN"),6,I,0)=^PSRX(PSOX("IRXN"),6,I,0)_$G(PSOX("DURATION",I))_"^"_$G(PSOX("CONJUNCTION",I))_"^"_$G(PSOX("ROUTE",I))_"^"_$G(PSOX("SCHEDULE",I))_"^"_$G(PSOX("VERB",I))
"RTN","PSON52",42,0)
 .I $G(PSOX("ODOSE",I))]"" S ^PSRX(PSOX("IRXN"),6,I,1)=PSOX("ODOSE",I)
"RTN","PSON52",43,0)
 S ^PSRX(PSOX("IRXN"),6,0)="^52.0113^"_PSOX("ENT")_"^"_PSOX("ENT")
"RTN","PSON52",44,0)
 K PSOX1,PSOY
"RTN","PSON52",45,0)
 S PSOX1="" F  S PSOX1=$O(PSON52(PSOX("IRXN"),PSOX1)) Q:PSOX1=""  S ^PSRX(PSOX("IRXN"),PSOX1)=$G(PSON52(PSOX("IRXN"),PSOX1))
"RTN","PSON52",46,0)
 I $O(PSOX("SIG",0)) D
"RTN","PSON52",47,0)
 .S D=0 F  S D=$O(PSOX("SIG",D)) Q:'D  S ^PSRX(PSOX("IRXN"),"INS1",D,0)=PSOX("SIG",D),TP=$G(TP)+1
"RTN","PSON52",48,0)
 .S ^PSRX(PSOX("IRXN"),"INS1",0)="^52.0115^"_TP_"^"_TP_"^"_DT_"^^" K TP,D
"RTN","PSON52",49,0)
 I $G(PSOX("SINS"))]"" S ^PSRX(PSOX("IRXN"),"INSS")=PSOX("SINS")
"RTN","PSON52",50,0)
 I $G(SIGOK) D
"RTN","PSON52",51,0)
 .S $P(^PSRX(PSOX("IRXN"),"SIG"),"^",2)=1,^PSRX(PSOX("IRXN"),"SIG1",0)="^52.04A^^"
"RTN","PSON52",52,0)
 .S D=0 F  S D=$O(SIG(D)) Q:'D  S ^PSRX(PSOX("IRXN"),"SIG1",D,0)=SIG(D),$P(^PSRX(PSOX("IRXN"),"SIG1",0),"^",3)=+$P(^PSRX(PSOX("IRXN"),"SIG1",0),"^",3)+1,$P(^(0),"^",4)=+$P(^(0),"^",4)+1 Q:'$O(SIG(D))
"RTN","PSON52",53,0)
 .K SIG
"RTN","PSON52",54,0)
 I $D(PSOINSFL) S ^PSRX(PSOX("IRXN"),"A",0)="^52.3DA^1^1",^PSRX(PSOX("IRXN"),"A",1,0)=DT_"^G^^0^Patient Instructions "_$S(PSOINSFL=1:"",1:"Not ")_"Sent By Provider."
"RTN","PSON52",55,0)
 I $G(OR0) S:$P(OR0,"^",24) ^PSRX(PSOX("IRXN"),"PKI")=1
"RTN","PSON52",56,0)
 K PSOX1,PSOFINFL,HLDSIG,D,PSOINSFL,D
"RTN","PSON52",57,0)
 D:$G(^TMP("PSODAI",$J,0))
"RTN","PSON52",58,0)
 .S $P(^PSRX(PSOX("IRXN"),3),"^",6)=1
"RTN","PSON52",59,0)
 .I $O(^TMP("PSODAI",$J,0)) S DAI=0 F  S DAI=$O(^TMP("PSODAI",$J,DAI)) Q:'DAI  D
"RTN","PSON52",60,0)
 ..S:'$D(^PSRX(PSOX("IRXN"),"DAI",0)) ^PSRX(PSOX("IRXN"),"DAI",0)="^52.03^^" S ^PSRX(PSOX("IRXN"),"DAI",DAI,0)=^TMP("PSODAI",$J,DAI,0)
"RTN","PSON52",61,0)
 ..S $P(^PSRX(PSOX("IRXN"),"DAI",0),"^",3)=+$P(^PSRX(PSOX("IRXN"),"DAI",0),"^",3)+1,$P(^(0),"^",4)=+$P(^(0),"^",4)+1
"RTN","PSON52",62,0)
 .K ^TMP("PSODAI",$J),DAI
"RTN","PSON52",63,0)
 I $G(PSOX("CHCS NUMBER"))'="" S $P(^PSRX(PSOX("IRXN"),"EXT"),"^")=$G(PSOX("CHCS NUMBER"))
"RTN","PSON52",64,0)
 I $G(PSOX("EXTERNAL SYSTEM"))'="" S $P(^PSRX(PSOX("IRXN"),"EXT"),"^",2)=$G(PSOX("EXTERNAL SYSTEM"))
"RTN","PSON52",65,0)
 I $G(PSOX("NEWCOPAY")) S ^PSRX(PSOX("IRXN"),"IB")=$G(PSOX("NEWCOPAY"))
"RTN","PSON52",66,0)
 ;Next line, set SC question based on Copay status?
"RTN","PSON52",67,0)
IBQ ;I $G(PSOBILL)=2 S ^PSRX(PSOX("IRXN"),"IBQ")=$S($G(PSOX("NEWCOPAY")):0,1:1)
"RTN","PSON52",68,0)
 N PSOSCFLD S PSOSCFLD=$S(PSOSCP'="":$G(PSOANSQ("SC")),1:"")_"^"_$G(PSOANSQ("MST"))_"^"_$G(PSOANSQ("VEH"))_"^"_$G(PSOANSQ("RAD"))_"^"_$G(PSOANSQ("PGW"))_"^"_$G(PSOANSQ("HNC"))_"^"_$G(PSOANSQ("CV"))_"^"_$G(PSOANSQ("SHAD"))
"RTN","PSON52",69,0)
 I PSOSCP<50&($TR(PSOSCFLD,"^")'="")&($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)'=1) D
"RTN","PSON52",70,0)
 . S ^PSRX(PSOX("IRXN"),"IBQ")=PSOSCFLD K PSOSCFLD  ;don't set if SC % is null or 0, just set it in ICD node
"RTN","PSON52",71,0)
 D ICD^PSODIAG
"RTN","PSON52",72,0)
 D:$$SWSTAT^IBBAPI() GACT^PSOPFSU0(PSOX("IRXN"),0)
"RTN","PSON52",73,0)
 K PSOANSQ,PSOANSQD,PSOX("NEWCOPAY")
"RTN","PSON52",74,0)
 L -^PSRX("B",PSOX("IRXN"))
"RTN","PSON52",75,0)
 Q
"RTN","PSON52",76,0)
 ;
"RTN","PSON52",77,0)
PS55 ;
"RTN","PSON52",78,0)
 L +^PS(55,PSODFN,"P"):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3)
"RTN","PSON52",79,0)
 S:'$D(^PS(55,PSODFN,"P",0)) ^(0)="^55.03PA^^"
"RTN","PSON52",80,0)
 F PSOX1=$P(^PS(55,PSODFN,"P",0),"^",3):1 Q:'$D(^PS(55,PSODFN,"P",PSOX1))
"RTN","PSON52",81,0)
 S PSOX("55 IEN")=PSOX1
"RTN","PSON52",82,0)
 S ^PS(55,PSODFN,"P",PSOX1,0)=PSOX("IRXN"),$P(^PS(55,PSODFN,"P",0),"^",3,4)=PSOX1_"^"_($P(^PS(55,PSODFN,"P",0),"^",4)+1)
"RTN","PSON52",83,0)
 S ^PS(55,PSODFN,"P","A",PSONEW("STOP DATE"),PSOX("IRXN"))=""
"RTN","PSON52",84,0)
PS55X L -^PS(55,PSODFN,"P")
"RTN","PSON52",85,0)
 K PSOX1
"RTN","PSON52",86,0)
 Q
"RTN","PSON52",87,0)
DIK ;
"RTN","PSON52",88,0)
 I $D(^XUSEC("PSORPH",DUZ)) S DA=PSOX("IRXN"),DIE=52,DR="41////"_PSOCOU_";S:'X Y=""@1"";42////"_PSOCOUU_";@1" D ^DIE K DIE,DR
"RTN","PSON52",89,0)
 K DIK,DA S DIK="^PSRX(",DA=PSOX("IRXN") D IX1^DIK K DIK
"RTN","PSON52",90,0)
 S DA=PSOX("IRXN") D ORC^PSORN52C
"RTN","PSON52",91,0)
 Q
"RTN","PSON52",92,0)
FINISH ;
"RTN","PSON52",93,0)
ANQ I $G(ANQDATA)]"" D NOW^%DTC G:$D(^PS(52.52,"B",%)) ANQ D
"RTN","PSON52",94,0)
 .K DD,DO S DIC="^PS(52.52,",DIC(0)="L",DLAYGO=52.52,X=% D FILE^DICN K DIC,DLAYGO,DD,DO
"RTN","PSON52",95,0)
 .S ^PS(52.52,+Y,0)=$P(Y,"^",2)_"^"_PSOX("IRXN")_"^"_ANQDATA,^PS(52.52,"A",PSOX("IRXN"),+Y)="" K ANQDATA,X,Y,%,ANQREM
"RTN","PSON52",96,0)
 G:PSOX("STATUS")=4 FINISHP
"RTN","PSON52",97,0)
 I $D(PSORX("VERIFY")) D  G FINISHX
"RTN","PSON52",98,0)
 .K DIC,DLAYGO,DINUM,DIADD,X,DD,DO S DIC="^PS(52.4,",DLAYGO=52.4,DINUM=PSOX("IRXN"),DIC(0)="ML",X=PSOX("IRXN")
"RTN","PSON52",99,0)
 .D FILE^DICN K DD,DO,DIC,DLAYGO,DINUM S ^PS(52.4,PSOX("IRXN"),0)=PSOX("IRXN")_"^"_PSODFN_"^"_DUZ_"^"_"^"_$E(PSOX("LOGIN DATE"),1,7)_"^"_PSOX("IRXN")_"^"_PSOX("STOP DATE")
"RTN","PSON52",100,0)
 .K DIK,DA S DIK="^PS(52.4,",DA=PSOX("IRXN") D IX^DIK K DIK,DA
"RTN","PSON52",101,0)
 ;
"RTN","PSON52",102,0)
 I PSOX("FILL DATE")>DT,$P(PSOPAR,"^",6) S DA=PSOX("IRXN"),RXFL(PSOX("IRXN"))=0 D SUS^PSORXL K DA G FINISHX
"RTN","PSON52",103,0)
 ;
"RTN","PSON52",104,0)
 ; - Calling ECME for claims generation and transmission / REJECT handling
"RTN","PSON52",105,0)
 N ACTION,PSOERX
"RTN","PSON52",106,0)
 S PSOERX=PSOX("IRXN")
"RTN","PSON52",107,0)
 I $$SUBMIT^PSOBPSUT(PSOERX,0) D  I ACTION="Q"!(ACTION="^") Q
"RTN","PSON52",108,0)
 . S ACTION="" D ECMESND^PSOBPSU1(PSOERX,0,PSOX("FILL DATE"),"OF")
"RTN","PSON52",109,0)
 . I $$FIND^PSOREJUT(PSOERX,0) D
"RTN","PSON52",110,0)
 . . S ACTION=$$HDLG^PSOREJU1(PSOERX,0,"79,88","OF","IOQ","I")
"RTN","PSON52",111,0)
 . I $$STATUS^PSOBPSUT(PSOERX,0)="E PAYABLE" D
"RTN","PSON52",112,0)
 . . D SAVNDC^PSSNDCUT(+$$GET1^DIQ(52,PSOERX,6,"I"),$G(PSOSITE),$$GETNDC^PSONDCUT(PSOERX,0))
"RTN","PSON52",113,0)
 ;
"RTN","PSON52",114,0)
FINISHP ;
"RTN","PSON52",115,0)
 I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=PSOX("IRXN")_",",RXFL(PSOX("IRXN"))=0 G FINISHX
"RTN","PSON52",116,0)
 F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSON52",117,0)
 I $L(PSORX("PSOL",PSOX2))+$L(PSOX("IRXN"))<220 S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_PSOX("IRXN")_","
"RTN","PSON52",118,0)
 E  S PSORX("PSOL",PSOX2+1)=PSOX("IRXN")_","
"RTN","PSON52",119,0)
 S RXFL(PSOX("IRXN"))=0
"RTN","PSON52",120,0)
FINISHX ;call to build Rx array for bingo board
"RTN","PSON52",121,0)
 I $G(PSORX("MAIL/WINDOW"))["W" S BINGCRT=1,BINGRTE="W",BBFLG=1 D BBRX^PSORN52C
"RTN","PSON52",122,0)
 K PSOX1,PSOX2
"RTN","PSON52",123,0)
 Q
"RTN","PSON52",124,0)
EOJ ;
"RTN","PSON52",125,0)
 ;B xref locked in routine PSONRXN
"RTN","PSON52",126,0)
 L -^PSRX("B",PSOX("IRXN")) K OTHDOS,DA,PSON52,PSOPRC,RTE,SCH,PSOX("INS"),PSONEW("INS"),PSORXED("INS"),PSONEW("ENT"),PSORXED("ENT"),OLENT
"RTN","PSON52",127,0)
 D PSOUL^PSSLOCK(PSOX("IRXN"))
"RTN","PSON52",128,0)
 Q
"RTN","PSON52",129,0)
 ;
"RTN","PSON52",130,0)
 ;;PSOX("SIG");;SIG;;1
"RTN","PSON52",131,0)
DD ;;PSOX("RX #");;0;;1
"RTN","PSON52",132,0)
 ;;PSOX("ISSUE DATE");;0;;13
"RTN","PSON52",133,0)
 ;;PSODFN;;0;;2
"RTN","PSON52",134,0)
 ;;PSOX("PATIENT STATUS");;0;;3
"RTN","PSON52",135,0)
 ;;PSOX("PROVIDER");;0;;4
"RTN","PSON52",136,0)
 ;;PSOX("CLINIC");;0;;5
"RTN","PSON52",137,0)
 ;;PSODRUG("IEN");;0;;6
"RTN","PSON52",138,0)
 ;;PSODRUG("TRADE NAME");;TN;;1
"RTN","PSON52",139,0)
 ;;PSOX("QTY");;0;;7
"RTN","PSON52",140,0)
 ;;PSOX("DAYS SUPPLY");;0;;8
"RTN","PSON52",141,0)
 ;;PSOX("# OF REFILLS");;0;;9
"RTN","PSON52",142,0)
 ;;PSOX("COPIES");;0;;18
"RTN","PSON52",143,0)
 ;;PSOX("MAIL/WINDOW");;0;;11
"RTN","PSON52",144,0)
 ;;PSOX("REMARKS");;3;;7
"RTN","PSON52",145,0)
 ;;PSOX("CLERK CODE");;0;;16
"RTN","PSON52",146,0)
 ;;PSODRUG("COST");;0;;17
"RTN","PSON52",147,0)
 ;;PSOSITE;;2;;9
"RTN","PSON52",148,0)
 ;;PSOX("LOGIN DATE");;2;;1
"RTN","PSON52",149,0)
 ;;PSOX("FILL DATE");;2;;2
"RTN","PSON52",150,0)
 ;;PSOX("PHARMACIST");;2;;3
"RTN","PSON52",151,0)
 ;;PSOX("LOT #");;2;;4
"RTN","PSON52",152,0)
 ;;PSOX("DISPENSED DATE");;2;;5
"RTN","PSON52",153,0)
 ;;PSOX("STOP DATE");;2;;6
"RTN","PSON52",154,0)
 ;;PSODRUG("NDC");;2;;7
"RTN","PSON52",155,0)
 ;;PSODRUG("DAW");;EPH;;1
"RTN","PSON52",156,0)
 ;;PSODRUG("MANUFACTURER");;2;;8
"RTN","PSON52",157,0)
 ;;PSOX("EXPIRATION DATE");;2;;11
"RTN","PSON52",158,0)
 ;;PSOX("GENERIC PROVIDER");;2;;12
"RTN","PSON52",159,0)
 ;;PSOX("RELEASED DATE/TIME");;2;;13
"RTN","PSON52",160,0)
 ;;PSOX("METHOD OF PICK-UP");;MP;;1
"RTN","PSON52",161,0)
 ;;PSOX("STATUS");;STA;;1
"RTN","PSON52",162,0)
 ;;PSOX("LAST DISPENSED DATE");;3;;1
"RTN","PSON52",163,0)
 ;;PSOX("NEXT POSSIBLE REFILL");;3;;2
"RTN","PSON52",164,0)
 ;;PSOX("COSIGNING PROVIDER");;3;;3
"RTN","PSON52",165,0)
 ;;PSOX("TYPE OF RX");;TYPE;;1
"RTN","PSON52",166,0)
 ;;PSOX("SAND");;SAND;;1
"RTN","PSON52",167,0)
 ;;PSOX("POE");;POE;;1
"RTN","PSON52",168,0)
 ;;PSOX("INS");;INS;;1
"RTN","PSONEW")
0^51^B28292272
"RTN","PSONEW",1,0)
PSONEW ;BIR/SAB-new rx order main driver ;07/26/96
"RTN","PSONEW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,27,32,46,94,130,268,225**;DEC 1997;Build 29
"RTN","PSONEW",3,0)
 ;External references L and UL^PSSLOCK supported by DBIA 2789
"RTN","PSONEW",4,0)
 ;External reference to ^VA(200 supported by DBIA 224
"RTN","PSONEW",5,0)
 ;External reference to ^XUSEC supported by DBIA 10076
"RTN","PSONEW",6,0)
 ;External reference to ^ORX1 supported by DBIA 2186
"RTN","PSONEW",7,0)
 ;External reference to ^ORX2 supported by DBIA 867
"RTN","PSONEW",8,0)
 ;External reference to ^TIUEDIT supported by DBIA 2410
"RTN","PSONEW",9,0)
 ;---------------------------------------------------------------
"RTN","PSONEW",10,0)
OERR ;backdoor new rx for v7
"RTN","PSONEW",11,0)
 K PSOREEDT,COPY,SPEED,PSOEDIT,DUR,DRET
"RTN","PSONEW",12,0)
 S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient.") K PSOPLCK S VALMBCK="" Q
"RTN","PSONEW",13,0)
 K PSOPLCK S X=PSODFN_";DPT(" D LK^ORX2 I 'Y S VALMSG="Another person is entering orders for this patient.",VALMBCK="" D UL^PSSLOCK(PSODFN) Q
"RTN","PSONEW",14,0)
AGAIN N VALMCNT K PSODRUG,PSOCOU,PSOCOUU,PSONOOR,PSORX("FN") W ! D HLDHDR^PSOLMUTL S (PSONEW("QFLG"),PSONEW("DFLG"))=0,PSOFROM="NEW",PSONOEDT=1
"RTN","PSONEW",15,0)
 K ORD D FULL^VALM1,^PSONEW1 ; Continue order entry
"RTN","PSONEW",16,0)
 I PSONEW("QFLG") G END
"RTN","PSONEW",17,0)
 I PSONEW("DFLG") W !,$C(7),"RX DELETED",! S:$G(POERR) POERR("DFLG")=1,VALMBCK="Q" G END
"RTN","PSONEW",18,0)
 D:$P($G(PSOPAR),"^",7)=1 AUTO^PSONRXN I $P($G(PSOPAR),"^",7)'=1 S PSOX=PSONEW("RX #") D CHECK^PSONRXN
"RTN","PSONEW",19,0)
 I PSONEW("DFLG")!PSONEW("QFLG") D DEL S:$G(POERR) POERR("DFLG")=1,VALMBCK="R" G END
"RTN","PSONEW",20,0)
 D NOOR I PSONEW("DFLG") D DEL G END
"RTN","PSONEW",21,0)
 D ^PSONEW2 I PSONEW("DFLG") D DEL S:$G(POERR) POERR("DFLG")=1,VALMBCK="R" G END ; Asks if correct
"RTN","PSONEW",22,0)
 G:$G(PSORX("FN")) END
"RTN","PSONEW",23,0)
 D EN^PSON52(.PSONEW) ; Files entry in File 52
"RTN","PSONEW",24,0)
 D NPSOSD^PSOUTIL(.PSONEW) ; Adds newly added rx to PSOSD array
"RTN","PSONEW",25,0)
 S VALMBCK="R"
"RTN","PSONEW",26,0)
END D EOJ ; Clean up          
"RTN","PSONEW",27,0)
 I '$G(PSORX("FN")) W ! K DIR,DIRUT,DUOUT,DTOUT S DIR(0)="Y",DIR("B")="YES",DIR("A")="Another New Order for "_PSORX("NAME") D ^DIR K DIR,DIRUT,DUOUT,DTOUT I Y K PSONEW,PSDRUG,ORD G AGAIN
"RTN","PSONEW",28,0)
 D ^PSOBUILD,BLD^PSOORUT1 S X=PSODFN_";DPT(" D ULK^ORX2 D UL^PSSLOCK(PSODFN)
"RTN","PSONEW",29,0)
 D RV^PSOORFL
"RTN","PSONEW",30,0)
 S VALMBCK="R" K PSORX("FN") Q
"RTN","PSONEW",31,0)
 ;----------------------------------------------------------------
"RTN","PSONEW",32,0)
DEL ;
"RTN","PSONEW",33,0)
 W !,$C(7),"RX DELETED",!
"RTN","PSONEW",34,0)
 I $P($G(PSOPAR),"^",7)=1 D
"RTN","PSONEW",35,0)
 . S DIE="^PS(59,",DA=PSOSITE,PSOY=$O(PSONEW("OLD LAST RX#",""))
"RTN","PSONEW",36,0)
 . S PSOX=PSONEW("OLD LAST RX#",PSOY)
"RTN","PSONEW",37,0)
 . L +^PS(59,+PSOSITE,PSOY):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3)
"RTN","PSONEW",38,0)
 . S DR=$S(PSOY=8:"2003////"_PSOX,PSOY=3:"1002.1////"_PSOX,1:"2003////"_PSOX)
"RTN","PSONEW",39,0)
 . D:PSOX<$P(^PS(59,+PSOSITE,PSOY),"^",3) ^DIE K DIE,X,Y
"RTN","PSONEW",40,0)
 . L -^PS(59,+PSOSITE,PSOY)
"RTN","PSONEW",41,0)
 . K PSOX,PSOY Q
"RTN","PSONEW",42,0)
EOJ ;
"RTN","PSONEW",43,0)
 I $D(PSONEW("RX #")) L -^PSRX("B",PSONEW("RX #")) ; +Lock set in PSONRXN
"RTN","PSONEW",44,0)
 K PSONOEDT,PSONEW,PSODRUG,ANQDATA,LSI,C,MAX,MIN,NDF,REF,SIG,SER,PSOFLAG,PSOHI,PSOLO,PSONOOR,PSOCOUU,PSOCOU,PSORX("EDIT")
"RTN","PSONEW",45,0)
 D CLEAN^PSOVER1
"RTN","PSONEW",46,0)
 K ^TMP("PSORXDC",$J),RORD,ACOM,ACNT,CRIT,DEF,F1,GG,I1,IEN,INDT,LAST,MSG,NIEN,STA,DUR,DRET,PSOPRC
"RTN","PSONEW",47,0)
 S RXN=$O(^TMP("PSORXN",$J,0)) I RXN D
"RTN","PSONEW",48,0)
 .S RXN1=^TMP("PSORXN",$J,RXN) D EN^PSOHLSN1(RXN,$P(RXN1,"^"),$P(RXN1,"^",2),"",$P(RXN1,"^",3))
"RTN","PSONEW",49,0)
 .I $P(^PSRX(RXN,"STA"),"^")=5 D EN^PSOHLSN1(RXN,"SC","ZS","")
"RTN","PSONEW",50,0)
 K RXN,RXN1,^TMP("PSORXN",$J)
"RTN","PSONEW",51,0)
 I $G(PSONOTE) D FULL^VALM1,MAIN^TIUEDIT(3,.TIUDA,PSODFN,"","","","",1)
"RTN","PSONEW",52,0)
 K PSONOTE
"RTN","PSONEW",53,0)
 Q
"RTN","PSONEW",54,0)
NOOR ;asks nature of order
"RTN","PSONEW",55,0)
 N PSONOODF
"RTN","PSONEW",56,0)
 S PSONOODF=0
"RTN","PSONEW",57,0)
 I $G(OR0) D  G NOORX ;front door
"RTN","PSONEW",58,0)
 .S PSOI=$S($G(PSOSIGFL):1,$G(PSODRUG("OI"))'=$P(OR0,"^",8):1,1:0) I 'PSOI S PSONOOR="" D:$D(^XUSEC("PSORPH",DUZ)) COUN Q  ;NoO $P(OR0,"^",7)
"RTN","PSONEW",59,0)
 .S PSONOODF=1
"RTN","PSONEW",60,0)
 .D DIR I $D(DIRUT) S PSONEW("DFLG")=1 Q
"RTN","PSONEW",61,0)
 .S PSONOOR=Y D:$D(^XUSEC("PSORPH",DUZ)) COUN K DIR,DTOUT,DTOUT,DIRUT
"RTN","PSONEW",62,0)
 ;backdoor order
"RTN","PSONEW",63,0)
 D DIR I $D(DIRUT) S PSONEW("DFLG")=1 Q
"RTN","PSONEW",64,0)
 S PSONOOR=Y K DIK,DA,DIE,DR,PSOI,DIR,DUOUT,DTOUT,DIRUT
"RTN","PSONEW",65,0)
 G:'$D(^XUSEC("PSORPH",DUZ)) NOORX
"RTN","PSONEW",66,0)
COUN ;patient counseling
"RTN","PSONEW",67,0)
 G:$G(PSORX("EDIT"))&('$G(PSOSIGFL)) NOORX K DIR,DUOUT,DTOUT,DIRUT
"RTN","PSONEW",68,0)
 S DIR("B")="NO",DIR(0)="52,41" D ^DIR S PSOCOU=$S(Y:Y,1:0)
"RTN","PSONEW",69,0)
 I $D(DIRUT)!('PSOCOU) S PSOCOUU=0 D:'$G(SPEED) PRONTE Q
"RTN","PSONEW",70,0)
 K:'$G(PSOCOU) PSOCOUU K DIR,DUOUT,DTOUT,DIRUT I Y S DIR(0)="52,42",DIR("B")="NO" D ^DIR S PSOCOUU=$S(Y:Y,1:0)
"RTN","PSONEW",71,0)
PRONTE K PSONOTE,DIR,DIRUT,DUOUT
"RTN","PSONEW",72,0)
 I $T(MAIN^TIUEDIT)]"",'$G(SPEED) D  K DIR,DIRUT,DUOUT
"RTN","PSONEW",73,0)
 .S DIR(0)="Y",DIR("B")="No",DIR("A")="Do you want to enter a Progress Note",DIR("A",1)="" D ^DIR K DIR
"RTN","PSONEW",74,0)
 .S PSONOTE=+Y Q  ;I 'Y!($D(DIRUT)) Q
"RTN","PSONEW",75,0)
NOORX K X,Y,DIR,DUOUT,DTOUT,DIRUT
"RTN","PSONEW",76,0)
 Q
"RTN","PSONEW",77,0)
DIR ;ask nature of order
"RTN","PSONEW",78,0)
 K DIR,DTOUT,DTOUT,DIRUT I $T(NA^ORX1)]""  D  Q
"RTN","PSONEW",79,0)
 .S PSONOOR=$$NA^ORX1($S($G(PSONOODF)!($G(PSONOBCK)):"S",1:"W"),0,"B","Nature of Order",0,"WPSDIVR"_$S(+$G(^VA(200,DUZ,"PS")):"E",1:""))
"RTN","PSONEW",80,0)
 .I +PSONOOR S (Y,PSONOOR)=$P(PSONOOR,"^",3) Q
"RTN","PSONEW",81,0)
 .S DIRUT=1 K PSONOOR
"RTN","PSONEW",82,0)
 I $D(PSONOOR) S DF=PSONOOR,PSONODF=$S(DF="E":"PROVIDER ENTERED",DF="V":"VERBAL",DF="P":"TELEPHONE",DF="D":"DUPLICATE",DF="S":"SERVICE CORRECTED",DF="I":"POLICY",DF="R":"SERVICE REJECTED",1:"WRITTEN")
"RTN","PSONEW",83,0)
 K DIR,DTOUT,DTOUT,DIRUT S DIR("A")="Nature of Order: ",DIR("B")=$S($D(PSONOOR):PSONODF,1:"WRITTEN")
"RTN","PSONEW",84,0)
 S DIR(0)="SA^W:WRITTEN;V:VERBAL;P:TELEPHONE;S:SERVICE CORRECTED;D:DUPLICATE;I:POLICY;R:SERVICE REJECTED"_$S(+$G(^VA(200,DUZ,"PS")):";E:PROVIDER ENTERED",1:"")
"RTN","PSONEW",85,0)
 D ^DIR K DF,PSONODF Q:$D(DIRUT)  S PSONOOR=Y
"RTN","PSONEW",86,0)
DIRX Q
"RTN","PSONEW",87,0)
 ;
"RTN","PSONEW",88,0)
NOORE(PSONEW) ;entry point for renew
"RTN","PSONEW",89,0)
 D NOOR I $D(DIRUT) S PSONEW("DFLG")=1 Q
"RTN","PSONEW",90,0)
 S PSONEW("NOO")=PSONOOR
"RTN","PSONEW",91,0)
 Q
"RTN","PSONEW2")
0^52^B32398190
"RTN","PSONEW2",1,0)
PSONEW2 ;BIR/DSD - displays new rx information for edit ;7/17/06 6:59pm
"RTN","PSONEW2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**32,37,46,71,94,124,139,157,143,226,237,239,225**;DEC 1997;Build 29
"RTN","PSONEW2",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSONEW2",4,0)
 ;External reference to ^DPT supported by DBIA 10035
"RTN","PSONEW2",5,0)
 ;External reference to PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSONEW2",6,0)
 ;External reference VADPT supported by DBIA 10061
"RTN","PSONEW2",7,0)
 ; This routine displays the entered new rx information and
"RTN","PSONEW2",8,0)
 ; asks if correct, if not allows editing of the data.
"RTN","PSONEW2",9,0)
 ;------------------------------------------------------------
"RTN","PSONEW2",10,0)
 ;PSO*237 issue expired error message
"RTN","PSONEW2",11,0)
 ;
"RTN","PSONEW2",12,0)
START ;
"RTN","PSONEW2",13,0)
 S (PSONEW("DFLG"),PSONEW2("QFLG"))=0
"RTN","PSONEW2",14,0)
 D STOP
"RTN","PSONEW2",15,0)
 D DISPLAY ; Displays information
"RTN","PSONEW2",16,0)
 ;Copay exemption checks
"RTN","PSONEW2",17,0)
 D SCP^PSORN52D
"RTN","PSONEW2",18,0)
 S PSONEWFF=1,PSOFLAG=1 K PSOANSQ,PSOANSQD S PSOCPZ("DFLG")=0,PSONEW("NEWCOPAY")=0
"RTN","PSONEW2",19,0)
 ;can't check PSOSCA for <50 here because of PSOBILL check in PSOCPB
"RTN","PSONEW2",20,0)
 I (PSOSCP<50&($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)'=1)),$G(DUZ("AG"))="V" D COPAY^PSOCPB W !
"RTN","PSONEW2",21,0)
 I PSOSCA&(PSOSCP>49)!((PSOSCA!(PSOBILL=2))&($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1))!(PSOSCP>49&(PSOBILL=2)) D SC^PSOMLLD2
"RTN","PSONEW2",22,0)
 I $G(PSOCPZ("DFLG")) K PSONEWFF,PSOANSQD,PSOCPZ("DFLG"),PSONEW("NEWCOPAY") S DIRUT="",PSONEW("DFLG")=1 D ASKX G END
"RTN","PSONEW2",23,0)
 ;IF MILL BILL, AND COPAY (*******TEST THE COPAY CHECK)
"RTN","PSONEW2",24,0)
 I $$DT^PSOMLLDT D  I $G(PSOCPZ("DFLG")) K PSONEWFF,PSOANSQD,PSOANSQ,PSOCPZ("DFLG"),PSONEW("NEWCOPAY") S DIRUT="",PSONEW("DFLG")=1 D ASKX G END
"RTN","PSONEW2",25,0)
 .;New prompts Quit after first '^'
"RTN","PSONEW2",26,0)
 .I $D(PSOIBQS(PSODFN,"CV")) D CV^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("CV"))) K PSONEW("NEWCOPAY")
"RTN","PSONEW2",27,0)
 .I $D(PSOIBQS(PSODFN,"VEH")) D VEH^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("VEH"))) K PSONEW("NEWCOPAY")
"RTN","PSONEW2",28,0)
 .I $D(PSOIBQS(PSODFN,"RAD")) D RAD^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("RAD"))) K PSONEW("NEWCOPAY")
"RTN","PSONEW2",29,0)
 .I $D(PSOIBQS(PSODFN,"PGW")) D PGW^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("PGW"))) K PSONEW("NEWCOPAY")
"RTN","PSONEW2",30,0)
 .I $D(PSOIBQS(PSODFN,"SHAD")) D SHAD^PSOMLLD2 I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("SHAD"))) K PSONEW("NEWCOPAY")
"RTN","PSONEW2",31,0)
 .I $D(PSOIBQS(PSODFN,"MST")) D MST^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("MST"))) K PSONEW("NEWCOPAY")
"RTN","PSONEW2",32,0)
 .I $D(PSOIBQS(PSODFN,"HNC")) D HNC^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("HNC"))) K PSONEW("NEWCOPAY")
"RTN","PSONEW2",33,0)
 K PSOCPZ("DFLG"),PSONEWFF
"RTN","PSONEW2",34,0)
 D ASK K:$G(PSONEW("DFLG")) PSOANSQ G:PSONEW2("QFLG")!PSONEW("DFLG") END
"RTN","PSONEW2",35,0)
 S PSORX("EDIT")=1 D EN^PSOORNE1(.PSONEW),FULL^VALM1 G:$G(PSORX("FN")) END  I '$G(PSORX("FN")) S PSONEW("DFLG")=1 K PSOANSQ G END ;D EDIT
"RTN","PSONEW2",36,0)
 G:'$G(PSONEW("DFLG")) START
"RTN","PSONEW2",37,0)
 S PSONEW("QFLG")=1,PSONEW("DFLG")=0
"RTN","PSONEW2",38,0)
END D EOJ
"RTN","PSONEW2",39,0)
 Q
"RTN","PSONEW2",40,0)
 ;------------------------------------------------------------
"RTN","PSONEW2",41,0)
STOP K PSEXDT,X,%DT S PSON52("QFLG")=0
"RTN","PSONEW2",42,0)
 S X1=PSOID,X2=PSONEW("DAYS SUPPLY")*(PSONEW("# OF REFILLS")+1)\1
"RTN","PSONEW2",43,0)
 S X2=$S(PSONEW("DAYS SUPPLY")=X2:X2,+$G(PSONEW("CS")):184,1:366)
"RTN","PSONEW2",44,0)
 I X2<30 D
"RTN","PSONEW2",45,0)
 . N % S %=$P($G(PSORX("PATIENT STATUS")),"^"),X2=30
"RTN","PSONEW2",46,0)
 . S:%?.N %=$P($G(^PS(53,+%,0)),"^") I %["AUTH ABS" S X2=5
"RTN","PSONEW2",47,0)
 D C^%DTC I PSONEW("FILL DATE")>$P(X,".") S PSEXDT=1_"^"_$P(X,".")
"RTN","PSONEW2",48,0)
 K X1,X2,X,%DT
"RTN","PSONEW2",49,0)
 Q
"RTN","PSONEW2",50,0)
DISPLAY ;
"RTN","PSONEW2",51,0)
 W !!,"Rx # ",PSONEW("RX #")
"RTN","PSONEW2",52,0)
 W ?23,$E(PSONEW("FILL DATE"),4,5),"/",$E(PSONEW("FILL DATE"),6,7),"/",$E(PSONEW("FILL DATE"),2,3),!,$G(PSORX("NAME")),?30,"#",PSONEW("QTY")
"RTN","PSONEW2",53,0)
 I $G(SIGOK),$O(SIG(0)) D  K D G TRN
"RTN","PSONEW2",54,0)
 .F D=0:0 S D=$O(SIG(D)) W !,SIG(D) Q:'$O(SIG(D))
"RTN","PSONEW2",55,0)
 E  S X=PSONEW("SIG") D SIGONE^PSOHELP W !,$G(INS1)
"RTN","PSONEW2",56,0)
TRN ;I $G(PSOPRC) F I=0:0 S I=$O(PRC(I)) Q:'I  W !,PRC(I)
"RTN","PSONEW2",57,0)
 W !!,$S($G(PSODRUG("TRADE NAME"))]"":PSODRUG("TRADE NAME"),1:PSODRUG("NAME"))
"RTN","PSONEW2",58,0)
 W !,PSONEW("PROVIDER NAME"),?25,PSORX("CLERK CODE"),!,"# of Refills: ",PSONEW("# OF REFILLS"),!
"RTN","PSONEW2",59,0)
 Q
"RTN","PSONEW2",60,0)
 ;
"RTN","PSONEW2",61,0)
ASK ;
"RTN","PSONEW2",62,0)
 K DIR,X,Y S DIR("A")="Is this correct"
"RTN","PSONEW2",63,0)
 S DIR(0)="Y",DIR("B")="YES" D ^DIR K DIR I $D(DIRUT) S PSONEW("DFLG")=1 G ASKX
"RTN","PSONEW2",64,0)
ASK1 I Y D  S PSONEW2("QFLG")=1
"RTN","PSONEW2",65,0)
 .S:$G(PSONEW("MAIL/WINDOW"))["W" BINGCRT=Y,BINGRTE="W"
"RTN","PSONEW2",66,0)
 .D:+$G(PSEXDT)
"RTN","PSONEW2",67,0)
 ..S Y=PSONEW("FILL DATE") X ^DD("DD") W !!,$C(7),Y_" fill date is greater than possible expiration date of " S Y=$P(PSEXDT,"^",2) X ^DD("DD") W Y_"."
"RTN","PSONEW2",68,0)
 .D DCORD K RORD,^TMP("PSORXDC",$J)
"RTN","PSONEW2",69,0)
ASKX I $D(DIRUT) D
"RTN","PSONEW2",70,0)
 .I +$G(PSEXDT) K DIRUT S (PSONEW2("QFLG"),PSONEW2("DFLG"),PSONEW("DFLG"),Y)=1
"RTN","PSONEW2",71,0)
 K X,Y,DIRUT,DTOUT,DUOUT
"RTN","PSONEW2",72,0)
 D:+$G(PSEXDT) PAUSE^VALM1
"RTN","PSONEW2",73,0)
 Q
"RTN","PSONEW2",74,0)
DCORD ;dc rxs and pending orders after new order is entered
"RTN","PSONEW2",75,0)
 F RORD=0:0 S RORD=$O(^TMP("PSORXDC",$J,RORD)) Q:'RORD  D @$S($P(^TMP("PSORXDC",$J,RORD,0),"^")="P":"PEN",1:"RX52")
"RTN","PSONEW2",76,0)
 K RORD
"RTN","PSONEW2",77,0)
 Q
"RTN","PSONEW2",78,0)
PEN ;pending ^tmp("psorxdc",$j,rord,0)="p^"_rord_"^"_msg
"RTN","PSONEW2",79,0)
 S $P(^PS(52.41,RORD,0),"^",3)="DC",^PS(52.41,RORD,4)=$P(^TMP("PSORXDC",$J,RORD,0),"^",3)
"RTN","PSONEW2",80,0)
 K ^PS(52.41,"AOR",PSODFN,+$P($G(^PS(52.41,RORD,"INI")),"^"),RORD)
"RTN","PSONEW2",81,0)
 D EN^PSOHLSN($P(^PS(52.41,RORD,0),"^"),"OC",$P(^TMP("PSORXDC",$J,RORD,0),"^",3),"D") W $C(7),!," -Pending Order was discontinued..."
"RTN","PSONEW2",82,0)
 D PSOUL^PSSLOCK(RORD_"S") K ^TMP("PSORXDC",$J,RORD,0)
"RTN","PSONEW2",83,0)
 Q
"RTN","PSONEW2",84,0)
RX52 ;rxs in file 52 ^tmp("psorxdc",$j,rord,0)=52^rord^msg^rea^act^sta^dnm
"RTN","PSONEW2",85,0)
 S PSCAN($P(^PSRX(RORD,0),"^"))=RORD_"^"_$P(^TMP("PSORXDC",$J,RORD,0),"^",4)
"RTN","PSONEW2",86,0)
 S MSG=$P(^TMP("PSORXDC",$J,RORD,0),"^",3),REA=$P(^(0),"^",4),ACT=$P(^(0),"^",5)
"RTN","PSONEW2",87,0)
 N PSONOOR S PSONOOR="D",DUP=1,DA=RORD D CAN^PSOCAN K PSONOOR
"RTN","PSONEW2",88,0)
 W !," -Rx "_$P(^PSRX(RORD,0),"^")_" has been discontinued...",!
"RTN","PSONEW2",89,0)
 K PSOSD($P(^TMP("PSORXDC",$J,RORD,0),"^",6),$P(^TMP("PSORXDC",$J,RORD,0),"^",7))
"RTN","PSONEW2",90,0)
 D PSOUL^PSSLOCK(RORD) K ^TMP("PSORXDC",$J,RORD,0)
"RTN","PSONEW2",91,0)
 Q
"RTN","PSONEW2",92,0)
 ;
"RTN","PSONEW2",93,0)
EDIT ;
"RTN","PSONEW2",94,0)
 S PSORX("EDIT")=1
"RTN","PSONEW2",95,0)
 D ^PSONEW3
"RTN","PSONEW2",96,0)
 S PSONEW("DFLG")=$S($G(PSORX("DFLG")):1,1:0)
"RTN","PSONEW2",97,0)
 Q
"RTN","PSONEW2",98,0)
 ;
"RTN","PSONEW2",99,0)
EOJ ;
"RTN","PSONEW2",100,0)
 K PSONEW2,PSORX("EDIT"),PSORX("DFLG"),PSOEDIT,PSOSCA
"RTN","PSONEW2",101,0)
 Q
"RTN","PSONEW2",102,0)
 ;
"RTN","PSONEW2",103,0)
EN1(PSONEW2) ; Entry point to just display and ask if okay
"RTN","PSONEW2",104,0)
 S PSONEW("DFLG")=0
"RTN","PSONEW2",105,0)
 I $G(^PSRX(PSONEW2("IRXN"),0))']"" S PSONEW("DFLG")=1 G EN1X
"RTN","PSONEW2",106,0)
 S PSOX=^PSRX(PSONEW2("IRXN"),0),PSONEW("TRADE NAME")=$G(^("TN")),PSONEW("FILL DATE")=$P($G(^(2)),"^",2)
"RTN","PSONEW2",107,0)
 S PSONEW("RX #")=$P(PSOX,"^"),PSORX("NAME")=$P(^DPT($P(PSOX,"^",2),0),"^")
"RTN","PSONEW2",108,0)
 S PSONEW("QTY")=$P(PSOX,"^",7),PSODRUG("NAME")=$P(^PSDRUG($P(PSOX,"^",6),0),"^"),PSONEW("# OF REFILLS")=$P(PSOX,"^",9)
"RTN","PSONEW2",109,0)
 S PSORX("CLERK CODE")=$P(^VA(200,$P(PSOX,"^",16),0),"^")
"RTN","PSONEW2",110,0)
 S:$G(PSONEW("PROVIDER NAME"))="" PSONEW("PROVIDER NAME")=$P(^VA(200,$P(PSOX,"^",4),0),"^")
"RTN","PSONEW2",111,0)
 S PSONEW("SIG")=$P($G(^PSRX(PSONEW2("IRXN"),"SIG")),"^")
"RTN","PSONEW2",112,0)
 D DISPLAY
"RTN","PSONEW2",113,0)
 D ASK
"RTN","PSONEW2",114,0)
 I PSONEW("DFLG")=1 S PSONEW2("DFLG")=1
"RTN","PSONEW2",115,0)
EN1X ;
"RTN","PSONEW2",116,0)
 Q
"RTN","PSONEW2",117,0)
 ;
"RTN","PSONEW2",118,0)
EXPR ;Display Expired error message                               ;PSO*237
"RTN","PSONEW2",119,0)
 S PSONEW("DFLG")=1
"RTN","PSONEW2",120,0)
 W $C(7)
"RTN","PSONEW2",121,0)
 S VALMSG="Order is older than 365 days and can't be finished"
"RTN","PSONEW2",122,0)
 S XQORM("B")="DC"
"RTN","PSONEW2",123,0)
 Q
"RTN","PSONEWF")
0^53^B38013501
"RTN","PSONEWF",1,0)
PSONEWF ;BIR/RTR - Copay finish questions ;07/26/96
"RTN","PSONEWF",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**71,157,143,219,226,239,225**;DEC 1997;Build 29
"RTN","PSONEWF",3,0)
 ;External reference VADPT supported by DBIA 10061
"RTN","PSONEWF",4,0)
START ;
"RTN","PSONEWF",5,0)
 N PSOPENIB,PSOSCOTH,PSOSCOTX,PSOMESFI
"RTN","PSONEWF",6,0)
 S PSOPENIB=$S($G(ORD):$G(^PS(52.41,+$G(ORD),"IBQ")),1:"")
"RTN","PSONEWF",7,0)
 ;set PSOSCOTH for display of Provider Copay intent, used with PSORX(SC)
"RTN","PSONEWF",8,0)
 S PSOSCOTH=0 I $P(PSOPENIB,"^")=1!($P(PSOPENIB,"^",2)=1)!($P(PSOPENIB,"^",3)=1)!($P(PSOPENIB,"^",4)=1)!($P(PSOPENIB,"^",5)=1)!($P(PSOPENIB,"^",6)=1)!($P(PSOPENIB,"^",7)=1) S PSOSCOTH=1
"RTN","PSONEWF",9,0)
 S PSOSCOTX=0 I $G(PSOSCOTH)!($G(PSORX("SC"))="SC")!($G(PSORX("SC"))="NSC") S PSOSCOTX=1
"RTN","PSONEWF",10,0)
 ;Check for Orderable Item change to display message
"RTN","PSONEWF",11,0)
 S PSOMESFI=0 I $G(OR0),$G(PSODRUG("OI")) D
"RTN","PSONEWF",12,0)
 .I $G(PSODRUG("OI"))'=$P($G(OR0),"^",8) S PSOMESFI=1
"RTN","PSONEWF",13,0)
 S PSONEWFF=1,PSOFLAG=1
"RTN","PSONEWF",14,0)
 ;Copay exemption checks
"RTN","PSONEWF",15,0)
 D SCP^PSORN52D
"RTN","PSONEWF",16,0)
 K PSOANSQ D SET S PSOCPZ("DFLG")=0,PSONEW("NEWCOPAY")=0
"RTN","PSONEWF",17,0)
 I (PSOSCP<50)&($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)'=1),$G(DUZ("AG"))="V" D COPAY^PSOCPB W !
"RTN","PSONEWF",18,0)
 I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY"),PSONEWFF,PSOSCOTH,PSOSCOTX,PSOMESFI Q
"RTN","PSONEWF",19,0)
 I PSOSCA&(PSOSCP>49)!((PSOSCA!(PSOBILL=2))&($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1))!(PSOSCP>49&(PSOBILL=2)) D  I $G(PSOCPZ("DFLG")) K PSOANSQ,PSONEW("NEWCOPAY"),PSONEWFF,PSOSCOTH,PSOSCOTX,PSOMESFI Q
"RTN","PSONEWF",20,0)
 . I PSOSCP<50 D MESS S:PSOSCP<50 PSOANSQD("SC>50")=$G(PSOANSQD("SC"))
"RTN","PSONEWF",21,0)
 . D SC^PSOMLLD2
"RTN","PSONEWF",22,0)
 . I PSOSCP<50&($D(PSOANSQD("SC"))) S PSOANSQD("SC")=PSOANSQD("SC>50") K PSOANSQD("SC")
"RTN","PSONEWF",23,0)
 ;IF MILL BILL, AND COPAY (*******TEST THE COPAY CHECK)
"RTN","PSONEWF",24,0)
 I $$DT^PSOMLLDT D  I $G(PSOCPZ("DFLG")) K PSOANSQ,PSONEW("NEWCOPAY"),PSONEWFF,PSOSCOTH,PSOSCOTX,PSOMESFI Q
"RTN","PSONEWF",25,0)
 .;New prompts Quit after first '^'
"RTN","PSONEWF",26,0)
 .I $D(PSOIBQS(PSODFN,"CV")) D  D MESSOI,MESS D CV^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("CV"))) K PSONEW("NEWCOPAY")
"RTN","PSONEWF",27,0)
 ..I '$D(PSOANSQD("CV")),($P(PSOPENIB,"^",6)=0!($P(PSOPENIB,"^",6)=1)) S PSOANSQD("CV")=$P(PSOPENIB,"^",6)
"RTN","PSONEWF",28,0)
 .I $D(PSOIBQS(PSODFN,"VEH")) D  D MESSOI,MESS D VEH^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("VEH"))) K PSONEW("NEWCOPAY")
"RTN","PSONEWF",29,0)
 ..I '$D(PSOANSQD("VEH")),($P(PSOPENIB,"^",2)=0!($P(PSOPENIB,"^",2)=1)) S PSOANSQD("VEH")=$P(PSOPENIB,"^",2)
"RTN","PSONEWF",30,0)
 .I $D(PSOIBQS(PSODFN,"RAD")) D  D MESSOI,MESS D RAD^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("RAD"))) K PSONEW("NEWCOPAY")
"RTN","PSONEWF",31,0)
 ..I '$D(PSOANSQD("RAD")),($P(PSOPENIB,"^",3)=0!($P(PSOPENIB,"^",3)=1)) S PSOANSQD("RAD")=$P(PSOPENIB,"^",3)
"RTN","PSONEWF",32,0)
 .I $D(PSOIBQS(PSODFN,"PGW")) D  D MESSOI,MESS D PGW^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("PGW"))) K PSONEW("NEWCOPAY")
"RTN","PSONEWF",33,0)
 ..I '$D(PSOANSQD("PGW")),($P(PSOPENIB,"^",4)=0!($P(PSOPENIB,"^",4)=1)) S PSOANSQD("PGW")=$P(PSOPENIB,"^",4)
"RTN","PSONEWF",34,0)
 .I $D(PSOIBQS(PSODFN,"SHAD")) D  D MESSOI,MESS D SHAD^PSOMLLD2 I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("SHAD"))) K PSONEW("NEWCOPAY")
"RTN","PSONEWF",35,0)
 ..I '$D(PSOANSQD("SHAD")),($P(PSOPENIB,"^",7)=0!($P(PSOPENIB,"^",7)=1)) S PSOANSQD("SHAD")=$P(PSOPENIB,"^",7)
"RTN","PSONEWF",36,0)
 .I $D(PSOIBQS(PSODFN,"MST")) D  D MESSOI,MESS D MST^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("MST"))) K PSONEW("NEWCOPAY")
"RTN","PSONEWF",37,0)
 ..I '$D(PSOANSQD("MST")),($P(PSOPENIB,"^")=0!($P(PSOPENIB,"^")=1)) S PSOANSQD("MST")=$P(PSOPENIB,"^")
"RTN","PSONEWF",38,0)
 .I $D(PSOIBQS(PSODFN,"HNC")) D  D MESSOI,MESS D HNC^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("HNC"))) K PSONEW("NEWCOPAY")
"RTN","PSONEWF",39,0)
 ..I '$D(PSOANSQD("HNC")),($P(PSOPENIB,"^",5)=0!($P(PSOPENIB,"^",5)=1)) S PSOANSQD("HNC")=$P(PSOPENIB,"^",5)
"RTN","PSONEWF",40,0)
 K PSONEWFF,PSOSCOTH,PSOSCOTX,PSOMESFI,PSOSCA
"RTN","PSONEWF",41,0)
 Q
"RTN","PSONEWF",42,0)
SET ;Set original answers that were passed from CPRS
"RTN","PSONEWF",43,0)
 Q:'$G(ORD)
"RTN","PSONEWF",44,0)
 Q:'$G(PSOFDR)
"RTN","PSONEWF",45,0)
 I $P($G(^PS(52.41,ORD,0)),"^",16)="SC"!($P($G(^(0)),"^",16)="NSC") D
"RTN","PSONEWF",46,0)
 . I PSOSCP<50 S PSOANSQ("SC")=$S($P($G(^(0)),"^",16)="SC":1,1:0),PSOANSQD("SC")=PSOANSQ("SC") S:PSOANSQ("SC")'="" PSOIBQS(PSODFN,"SC")=PSOANSQ("SC")
"RTN","PSONEWF",47,0)
 . I PSOSCP>49 S PSOANSQ("SC>50")=$S($P($G(^(0)),"^",16)="SC":1,1:0),PSOANSQD("SC>50")=PSOANSQ("SC>50") S:PSOANSQ("SC>50")'="" PSOIBQS(PSODFN,"SC>50")=PSOANSQ("SC>50")
"RTN","PSONEWF",48,0)
 I $G(PSOPENIB)="" G SET2
"RTN","PSONEWF",49,0)
 I '$$DT^PSOMLLDT Q
"RTN","PSONEWF",50,0)
 I $P(PSOPENIB,"^")=0!($P(PSOPENIB,"^")=1) S PSOANSQ("MST")=$P(PSOPENIB,"^")
"RTN","PSONEWF",51,0)
 I $P(PSOPENIB,"^",2)=0!($P(PSOPENIB,"^",2)=1) S PSOANSQ("VEH")=$P(PSOPENIB,"^",2)
"RTN","PSONEWF",52,0)
 I $P(PSOPENIB,"^",3)=0!($P(PSOPENIB,"^",3)=1) S PSOANSQ("RAD")=$P(PSOPENIB,"^",3)
"RTN","PSONEWF",53,0)
 I $P(PSOPENIB,"^",4)=0!($P(PSOPENIB,"^",4)=1) S PSOANSQ("PGW")=$P(PSOPENIB,"^",4)
"RTN","PSONEWF",54,0)
 I $P(PSOPENIB,"^",5)=0!($P(PSOPENIB,"^",5)=1) S PSOANSQ("HNC")=$P(PSOPENIB,"^",5)
"RTN","PSONEWF",55,0)
 I $P(PSOPENIB,"^",6)=0!($P(PSOPENIB,"^",6)=1) S PSOANSQ("CV")=$P(PSOPENIB,"^",6)
"RTN","PSONEWF",56,0)
 I $P(PSOPENIB,"^",7)=0!($P(PSOPENIB,"^",7)=1) S PSOANSQ("SHAD")=$P(PSOPENIB,"^",7)
"RTN","PSONEWF",57,0)
 ;
"RTN","PSONEWF",58,0)
SET2 ;for when patient status is exempt, null IBQ node was set for exempts or SC>50 - data is in ICD node
"RTN","PSONEWF",59,0)
 N PSOOICD
"RTN","PSONEWF",60,0)
 I $TR($G(^PS(52.41,+$G(ORD),"IBQ")),"^")="" S PSOOICD=$G(^PS(52.41,ORD,"ICD",1,0)) D SET3:PSOOICD'=""
"RTN","PSONEWF",61,0)
 ;
"RTN","PSONEWF",62,0)
ICD1 ;
"RTN","PSONEWF",63,0)
 N PSONOCHG S PSONOCHG=0
"RTN","PSONEWF",64,0)
 I ('$D(PSORXED("ICD"))) S PSONOCHG=1
"RTN","PSONEWF",65,0)
 I $D(^PS(52.41,ORD,"ICD",0)) D
"RTN","PSONEWF",66,0)
 . N JJ,ICD,II,FLD,RXN S RXN=ORD
"RTN","PSONEWF",67,0)
 . S II=0 F  S II=$O(^PS(52.41,ORD,"ICD",II)) Q:II=""!(II'?1N.N)  D
"RTN","PSONEWF",68,0)
 .. S ICD=^PS(52.41,ORD,"ICD",II,0),FLD=$P(ICD,U) S:$G(PSONEW("IDFLG")) FLD=""  D ICD
"RTN","PSONEWF",69,0)
 Q
"RTN","PSONEWF",70,0)
 ;
"RTN","PSONEWF",71,0)
SET3 ; called from PSONEWF and PSONEWG; must have PSOOICD.  For SC>50, exempt patient status, etc.
"RTN","PSONEWF",72,0)
 N JJJ
"RTN","PSONEWF",73,0)
 F JJJ=2:1:9 I $P(PSOOICD,"^",JJJ)=0!($P(PSOOICD,"^",JJJ)=1) D
"RTN","PSONEWF",74,0)
 . I JJJ=2 S (PSOANSQD("VEH"),PSOANSQ("VEH"))=$P(PSOOICD,"^",JJJ)
"RTN","PSONEWF",75,0)
 . I JJJ=3 S (PSOANSQD("RAD"),PSOANSQ("RAD"))=$P(PSOOICD,"^",JJJ)
"RTN","PSONEWF",76,0)
 . I JJJ=4 D
"RTN","PSONEWF",77,0)
 .. S:PSOSCP<50 (PSOANSQD("SC"),PSOANSQ("SC"))=$P(PSOOICD,"^",JJJ)
"RTN","PSONEWF",78,0)
 .. S:PSOSCP>49!($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1) (PSOANSQD("SC>50"),PSOANSQ("SC>50"))=$P(PSOOICD,"^",JJJ)
"RTN","PSONEWF",79,0)
 . I JJJ=5 S (PSOANSQD("PGW"),PSOANSQ("PGW"))=$P(PSOOICD,"^",JJJ)
"RTN","PSONEWF",80,0)
 . I JJJ=6 S (PSOANSQD("MST"),PSOANSQ("MST"))=$P(PSOOICD,"^",JJJ)
"RTN","PSONEWF",81,0)
 . I JJJ=7 S (PSOANSQD("HNC"),PSOANSQ("HNC"))=$P(PSOOICD,"^",JJJ)
"RTN","PSONEWF",82,0)
 . I JJJ=8 S (PSOANSQD("CV"),PSOANSQ("CV"))=$P(PSOOICD,"^",JJJ)
"RTN","PSONEWF",83,0)
 . I JJJ=9 S (PSOANSQD("SHAD"),PSOANSQ("SHAD"))=$P(PSOOICD,"^",JJJ)
"RTN","PSONEWF",84,0)
 K PSOOICD
"RTN","PSONEWF",85,0)
 Q
"RTN","PSONEWF",86,0)
MESS ;
"RTN","PSONEWF",87,0)
 I $G(PSOSCOTX)=1&(PSOSCP<50) W:$G(PSODRUG("DEA"))'["S"&($G(PSODRUG("DEA"))'["I") !,"This Rx has been flagged by the provider as: "_$S($G(PSOSCOTH):"NO COPAY",$G(PSORX("SC"))="SC":"NO COPAY",1:"COPAY"),! S PSOSCOTX=2
"RTN","PSONEWF",88,0)
 Q
"RTN","PSONEWF",89,0)
MESSOI ;
"RTN","PSONEWF",90,0)
 I $G(PSOMESFI)=1 W !!,"The Pharmacy Orderable Item has changed for this order. Please review any",!,"existing SC or Environmental Indicator defaults carefully for appropriateness.",! S PSOMESFI=2
"RTN","PSONEWF",91,0)
 Q
"RTN","PSONEWF",92,0)
 ;
"RTN","PSONEWF",93,0)
ICD ;called from PSONEWG,PSORENW1 and used by PSONEWF
"RTN","PSONEWF",94,0)
 I $G(PSOCOPY)&($D(PSORXED("ICD")))&($D(PSONEW("IDFLG"))) Q:'$D(PSORXED("ICD",II))
"RTN","PSONEWF",95,0)
 I $G(PSOCOPY)&($D(PSORXED("ICD",II))) S PSONEW("ICD",II)=PSORXED("ICD",II) Q
"RTN","PSONEWF",96,0)
 Q:'$G(PSOCOPY)&('$D(PSORXED("ICD",II)))&('$G(PSONOCHG))  ;don't set deleted ones
"RTN","PSONEWF",97,0)
 Q:$G(PSONEW("IDFLG"))
"RTN","PSONEWF",98,0)
 I $D(PSORX("ICD",II)) S PSONEW("ICD",II)=PSORX("ICD",II) Q
"RTN","PSONEWF",99,0)
 S PSONEW("ICD",II)=FLD
"RTN","PSONEWF",100,0)
 Q
"RTN","PSONEWF",101,0)
 ;
"RTN","PSONEWG")
0^54^B25309370
"RTN","PSONEWG",1,0)
PSONEWG ;BIR/RTR - Copay copy and edit questions ;07/26/96
"RTN","PSONEWG",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**71,157,143,219,226,239,225**;DEC 1997;Build 29
"RTN","PSONEWG",3,0)
 ;External reference ^PSDRUG( supported by DBIA 221
"RTN","PSONEWG",4,0)
 ;External reference VADPT supported by DBIA 10061
"RTN","PSONEWG",5,0)
START ;
"RTN","PSONEWG",6,0)
 N PSOPENIB,PSOMESOI
"RTN","PSONEWG",7,0)
 S PSOPENIB="" I $G(PSORXED)!($G(PSOCOPY)) I $G(PSORXED("IRXN")) S PSOPENIB=$G(^PSRX(PSORXED("IRXN"),"IBQ"))
"RTN","PSONEWG",8,0)
 S PSOMESOI=0 I $G(PSORXED) D
"RTN","PSONEWG",9,0)
 .I $G(PSODRUG("OI")),$P($G(PSORXED("RX0")),"^",6) D
"RTN","PSONEWG",10,0)
 ..I $G(PSODRUG("OI"))'=$P($G(^PSDRUG(+$P($G(PSORXED("RX0")),"^",6),2)),"^") S PSOMESOI=1
"RTN","PSONEWG",11,0)
 S PSONEWFF=1,PSOFLAG=1
"RTN","PSONEWG",12,0)
 ;Copay exemption checks
"RTN","PSONEWG",13,0)
 D SCP^PSORN52D
"RTN","PSONEWG",14,0)
 K PSOANSQ D SET S PSOCPZ("DFLG")=0,PSONEW("NEWCOPAY")=0
"RTN","PSONEWG",15,0)
 I PSOSCP<50&($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)'=1),$G(DUZ("AG"))="V" D  D COPAY^PSOCPB W !
"RTN","PSONEWG",16,0)
 .;I $G(PSOANSQD("SC"))=0!($G(PSOANSQD("SC"))=1) Q
"RTN","PSONEWG",17,0)
 .I $G(PSOANSQ("SC"))=0!($G(PSOANSQ("SC"))=1) S PSOANSQD("SC")=$G(PSOANSQ("SC"))
"RTN","PSONEWG",18,0)
 I PSOSCA&(PSOSCP>49)!((PSOSCA!(PSOBILL=2))&($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1))!(PSOSCP>49&(PSOBILL=2)) D SC^PSOMLLD2 I $G(PSOCPZ("DFLG")) K PSOANSQ,PSONEW("NEWCOPAY"),PSONEWFF,PSOMESOI Q
"RTN","PSONEWG",19,0)
 I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY"),PSONEWFF,PSOMESOI Q
"RTN","PSONEWG",20,0)
 ;IF MILL BILL, AND COPAY (*******TEST THE COPAY CHECK)
"RTN","PSONEWG",21,0)
 I $$DT^PSOMLLDT D  I $G(PSOCPZ("DFLG")) K PSOANSQ,PSONEW("NEWCOPAY"),PSONEWFF,PSOMESOI Q
"RTN","PSONEWG",22,0)
 .;New prompts Quit after first '^'
"RTN","PSONEWG",23,0)
 .I $D(PSOIBQS(PSODFN,"CV")) D  D MESS D CV^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("CV"))) K PSONEW("NEWCOPAY")
"RTN","PSONEWG",24,0)
 ..I '$D(PSOANSQD("CV")),($P(PSOPENIB,"^",7)=0!($P(PSOPENIB,"^",7)=1)) S PSOANSQD("CV")=$P(PSOPENIB,"^",7)
"RTN","PSONEWG",25,0)
 .I $D(PSOIBQS(PSODFN,"VEH")) D  D MESS D VEH^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("VEH"))) K PSONEW("NEWCOPAY")
"RTN","PSONEWG",26,0)
 ..I '$D(PSOANSQD("VEH")),($P(PSOPENIB,"^",3)=0!($P(PSOPENIB,"^",3)=1)) S PSOANSQD("VEH")=$P(PSOPENIB,"^",3)
"RTN","PSONEWG",27,0)
 .I $D(PSOIBQS(PSODFN,"RAD")) D  D MESS D RAD^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("RAD"))) K PSONEW("NEWCOPAY")
"RTN","PSONEWG",28,0)
 ..I '$D(PSOANSQD("RAD")),($P(PSOPENIB,"^",4)=0!($P(PSOPENIB,"^",4)=1)) S PSOANSQD("RAD")=$P(PSOPENIB,"^",4)
"RTN","PSONEWG",29,0)
 .I $D(PSOIBQS(PSODFN,"PGW")) D  D MESS D PGW^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("PGW"))) K PSONEW("NEWCOPAY")
"RTN","PSONEWG",30,0)
 ..I '$D(PSOANSQD("PGW")),($P(PSOPENIB,"^",5)=0!($P(PSOPENIB,"^",5)=1)) S PSOANSQD("PGW")=$P(PSOPENIB,"^",5)
"RTN","PSONEWG",31,0)
 .I $D(PSOIBQS(PSODFN,"SHAD")) D  D MESS D SHAD^PSOMLLD2 I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("SHAD"))) K PSONEW("NEWCOPAY")
"RTN","PSONEWG",32,0)
 ..I '$D(PSOANSQD("SHAD")),($P(PSOPENIB,"^",8)=0!($P(PSOPENIB,"^",8)=1)) S PSOANSQD("SHAD")=$P(PSOPENIB,"^",8)
"RTN","PSONEWG",33,0)
 .I $D(PSOIBQS(PSODFN,"MST")) D  D MESS D MST^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("MST"))) K PSONEW("NEWCOPAY")
"RTN","PSONEWG",34,0)
 ..I '$D(PSOANSQD("MST")),($P(PSOPENIB,"^",2)=0!($P(PSOPENIB,"^",2)=1)) S PSOANSQD("MST")=$P(PSOPENIB,"^",2)
"RTN","PSONEWG",35,0)
 .I $D(PSOIBQS(PSODFN,"HNC")) D  D MESS D HNC^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("HNC"))) K PSONEW("NEWCOPAY")
"RTN","PSONEWG",36,0)
 ..I '$D(PSOANSQD("HNC")),($P(PSOPENIB,"^",6)=0!($P(PSOPENIB,"^",6)=1)) S PSOANSQD("HNC")=$P(PSOPENIB,"^",6)
"RTN","PSONEWG",37,0)
 K PSONEWFF,PSOMESOI,PSOSCA
"RTN","PSONEWG",38,0)
 Q
"RTN","PSONEWG",39,0)
SET ;Set original answers that were passed from CPRS
"RTN","PSONEWG",40,0)
 Q:'$G(PSORXED("IRXN"))
"RTN","PSONEWG",41,0)
 S PSOANSQ("SC")=$S($P($G(^PSRX(PSORXED("IRXN"),"IBQ")),"^")'="":$P($G(^("IBQ")),"^"),$P($G(^PSRX(PSORXED("IRXN"),"IB")),"^"):0,1:"")
"RTN","PSONEWG",42,0)
 I $G(PSOANSQ("SC"))="" K PSOANSQ("SC")
"RTN","PSONEWG",43,0)
 I $G(PSOPENIB)="" G SET2
"RTN","PSONEWG",44,0)
 I '$$DT^PSOMLLDT Q
"RTN","PSONEWG",45,0)
 I $P(PSOPENIB,"^",2)=0!($P(PSOPENIB,"^",2)=1) S PSOANSQ("MST")=$P(PSOPENIB,"^",2)
"RTN","PSONEWG",46,0)
 I $P(PSOPENIB,"^",3)=0!($P(PSOPENIB,"^",3)=1) S PSOANSQ("VEH")=$P(PSOPENIB,"^",3)
"RTN","PSONEWG",47,0)
 I $P(PSOPENIB,"^",4)=0!($P(PSOPENIB,"^",4)=1) S PSOANSQ("RAD")=$P(PSOPENIB,"^",4)
"RTN","PSONEWG",48,0)
 I $P(PSOPENIB,"^",5)=0!($P(PSOPENIB,"^",5)=1) S PSOANSQ("PGW")=$P(PSOPENIB,"^",5)
"RTN","PSONEWG",49,0)
 I $P(PSOPENIB,"^",6)=0!($P(PSOPENIB,"^",6)=1) S PSOANSQ("HNC")=$P(PSOPENIB,"^",6)
"RTN","PSONEWG",50,0)
 I $P(PSOPENIB,"^",7)=0!($P(PSOPENIB,"^",7)=1) S PSOANSQ("CV")=$P(PSOPENIB,"^",7)
"RTN","PSONEWG",51,0)
 I $P(PSOPENIB,"^",8)=0!($P(PSOPENIB,"^",8)=1) S PSOANSQ("SHAD")=$P(PSOPENIB,"^",8)
"RTN","PSONEWG",52,0)
 ;
"RTN","PSONEWG",53,0)
SET2 ;for when patient status is exempt, null IBQ node was set for exempts or SC>50 - data is in ICD node
"RTN","PSONEWG",54,0)
 N PSOOICD,JJJ
"RTN","PSONEWG",55,0)
 I $TR($G(^PSRX(PSODFN,"IBQ")),"^")="" S PSOOICD=$G(^PSRX(PSORXED("IRXN"),"ICD",1,0)) D SET3^PSONEWF:PSOOICD'=""
"RTN","PSONEWG",56,0)
 ;
"RTN","PSONEWG",57,0)
ICD ;
"RTN","PSONEWG",58,0)
 N JJ,ICD,II,FLD,RXN,TNEW,PSONOCHG S PSONOCHG=0
"RTN","PSONEWG",59,0)
 S RXN=PSORXED("IRXN")
"RTN","PSONEWG",60,0)
 I '$D(PSONEW("ICD"))&('$D(PSORXED("ICD"))) S PSONOCHG=1
"RTN","PSONEWG",61,0)
 I $D(^PSRX(RXN,"ICD",0)) D
"RTN","PSONEWG",62,0)
 . S II=0 F  S II=$O(^PSRX(RXN,"ICD",II)) Q:II=""!(II'?1N.N)!($G(PSOCOPY)&(II>1)&('PSONOCHG))  D
"RTN","PSONEWG",63,0)
 .. S ICD=^PSRX(RXN,"ICD",II,0),FLD=$P(ICD,U) S:$G(PSONEW("IDFLG")) FLD="" D ICD^PSONEWF
"RTN","PSONEWG",64,0)
 E  I $G(PSONEW("IDFLG")) K ^PSRX(RXN,"ICD","B") S $P(^PSRX(RXN,"ICD",1,0),"^",1)="",TNEW=2 D
"RTN","PSONEWG",65,0)
 . F TNEW=TNEW:1:8 Q:'$D(^PSRX(RXN,"ICD",TNEW,0))  S DIK="^PSRX("_RXN_","_$C(34)_"ICD"_$C(34)_",",DA=TNEW,DA(1)=RXN D ^DIK K DA,DIK ;user deleted all
"RTN","PSONEWG",66,0)
 K PSONEW("IDFLG"),PSORXED("IDFLG")
"RTN","PSONEWG",67,0)
 Q
"RTN","PSONEWG",68,0)
MESS ;
"RTN","PSONEWG",69,0)
 I $G(PSOMESOI)=1,$G(PSORXED) W !!,"The Pharmacy Orderable Item has changed for this order. Please review any",!,"existing SC or Environmental Indicator defaults carefully for appropriateness.",! S PSOMESOI=2
"RTN","PSONEWG",70,0)
 Q
"RTN","PSONFI")
0^69^B9036524
"RTN","PSONFI",1,0)
PSONFI ;BIR/MHA - dispense drug/orderable item text display ;09/13/00
"RTN","PSONFI",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**46,94,131,225**;DEC 1997;Build 29
"RTN","PSONFI",3,0)
 ;External reference to PSSDIN is supported by DBIA 3166
"RTN","PSONFI",4,0)
 ;External reference to ^PS(50.606 is supported by DBIA 2174
"RTN","PSONFI",5,0)
 ;External reference to ^PS(50.7 is supported by DBIA 2223
"RTN","PSONFI",6,0)
 ;External reference to ^PSDRUG( is supported by DBIA 221
"RTN","PSONFI",7,0)
 ;
"RTN","PSONFI",8,0)
NFI ;display restriction/guidelines
"RTN","PSONFI",9,0)
 D EN^PSSDIN(PSODRUG("OI"),PSODRUG("IEN")) S NFI=$$PROMPT^PSSDIN
"RTN","PSONFI",10,0)
 I NFI]"","ODY"[NFI D TD^PSONFI S DIR(0)="E" D ^DIR K DIR
"RTN","PSONFI",11,0)
 K NFI Q
"RTN","PSONFI",12,0)
DDTX ;Display drug text for the hidden action DIN
"RTN","PSONFI",13,0)
 N OI,DD
"RTN","PSONFI",14,0)
 S:$D(PSODRUG("OI")) OI=PSODRUG("OI") S:$D(PSODRUG("IEN")) DD=PSODRUG("IEN")
"RTN","PSONFI",15,0)
 I $G(OI),$G(DD) G 1
"RTN","PSONFI",16,0)
 I $D(PSORNSV),$G(PSORNSV)]"" S OI=+$P(OR0,"^",8),DD=+$P(OR0,"^",9) G 1
"RTN","PSONFI",17,0)
 S OI=+RXOR,DD=+$P(RX0,"^",6)
"RTN","PSONFI",18,0)
1 S OI=$S($G(OI):OI,1:""),DD=$S($G(DD):DD,1:"")
"RTN","PSONFI",19,0)
 D EN^PSSDIN(OI,DD)
"RTN","PSONFI",20,0)
 N N1,N2,N3,N4,TX,NX S NX="PSSDIN"
"RTN","PSONFI",21,0)
 W @IOF,!!,"Drug restriction/guideline info:",!!
"RTN","PSONFI",22,0)
 W !,"Orderable Item: "_$P(^PS(50.7,OI,0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")_$S($P(^PS(50.7,OI,0),"^",12):" ***(N/F)***",1:""),!!
"RTN","PSONFI",23,0)
 I $O(^TMP("PSSDIN",$J,"OI",0)) S N1="OI" D TXD
"RTN","PSONFI",24,0)
 W:'$O(^TMP("PSSDIN",$J,"OI",0)) ?5,"No information available ",!!
"RTN","PSONFI",25,0)
 I $G(DD),$D(^PSDRUG(DD,0)) W !,"Drug: "_$P(^PSDRUG(DD,0),"^")_$S($P(^PSDRUG(DD,0),"^",9):" ***(N/F)***",1:""),!! D
"RTN","PSONFI",26,0)
 .I $O(^TMP("PSSDIN",$J,"DD",0)) S N1="DD" D TXD
"RTN","PSONFI",27,0)
 .W:'$O(^TMP("PSSDIN",$J,"DD",0)) ?5,"No information available ",!!
"RTN","PSONFI",28,0)
HLD K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSONFI",29,0)
 Q
"RTN","PSONFI",30,0)
DIN(OI,DD) ;Setup DIN indicator
"RTN","PSONFI",31,0)
 S (NFIO,NFID)=""
"RTN","PSONFI",32,0)
 I $D(OI),$G(OI) S:$P($G(^PS(50.7,OI,0)),"^",12) NFIO=" ***(N/F)***"
"RTN","PSONFI",33,0)
 I $D(DD),$G(DD) S:$P($G(^PSDRUG(DD,0)),"^",9) NFID=" ***(N/F)***"
"RTN","PSONFI",34,0)
 D EN^PSSDIN(OI,DD)
"RTN","PSONFI",35,0)
 S:$O(^TMP("PSSDIN",$J,"OI",0)) NFIO=NFIO_" <DIN>"
"RTN","PSONFI",36,0)
 S:$O(^TMP("PSSDIN",$J,"DD",0)) NFID=NFID_" <DIN>"
"RTN","PSONFI",37,0)
 K ^TMP("PSSDIN",$J) Q
"RTN","PSONFI",38,0)
 Q
"RTN","PSONFI",39,0)
RV ;reverse video
"RTN","PSONFI",40,0)
 I $G(PKID),$G(PKIE)]"" D
"RTN","PSONFI",41,0)
 .I $O(^PS(52.41,ORD,"OBX",0)) D CNTRL^VALM10(1,1,13,IORVON,IORVOFF,0),RV^PSOPKIV1 Q
"RTN","PSONFI",42,0)
 .D CNTRL^VALM10(1,1,$L(PKIE),IORVON,IORVOFF,0)
"RTN","PSONFI",43,0)
 D:$G(NFIO) CNTRL^VALM10(+NFIO,$P(NFIO,",",2),5,IORVON,IORVOFF,0)
"RTN","PSONFI",44,0)
 D:$G(NFID) CNTRL^VALM10(+NFID,$P(NFID,",",2),5,IORVON,IORVOFF,0)
"RTN","PSONFI",45,0)
 K NFIO,NFID,PKID
"RTN","PSONFI",46,0)
 ;- Reverses video for the words "Flagged" and "Unflagged"
"RTN","PSONFI",47,0)
 N L
"RTN","PSONFI",48,0)
 F L=1:1:VALMCNT D
"RTN","PSONFI",49,0)
 . D:$D(FLAGLINE(L)) CNTRL^VALM10(L,1,FLAGLINE(L),IORVON,IORVOFF,0)
"RTN","PSONFI",50,0)
 Q
"RTN","PSONFI",51,0)
 ;
"RTN","PSONFI",52,0)
TD N N1,N2,N3,N4,TX,NX S NX="PSSDIN"
"RTN","PSONFI",53,0)
 W @IOF
"RTN","PSONFI",54,0)
 I NFI="O" D OIT
"RTN","PSONFI",55,0)
 I NFI="D" D DDT
"RTN","PSONFI",56,0)
 I NFI="Y" D DDT,OIT
"RTN","PSONFI",57,0)
 Q
"RTN","PSONFI",58,0)
OIT ;
"RTN","PSONFI",59,0)
 S N1="OI",TX="Orderable Item Text:" D TXT
"RTN","PSONFI",60,0)
 Q
"RTN","PSONFI",61,0)
DDT ;
"RTN","PSONFI",62,0)
 S N1="DD",TX="Dispense Drug Text:" D TXT
"RTN","PSONFI",63,0)
 Q
"RTN","PSONFI",64,0)
TXT ;
"RTN","PSONFI",65,0)
 W !,TX
"RTN","PSONFI",66,0)
TXD K ^UTILITY($J,"W")
"RTN","PSONFI",67,0)
 S N2="" F  S N2=$O(^TMP(NX,$J,N1,N2)) Q:'N2!($D(DIRUT))  D
"RTN","PSONFI",68,0)
 .S N3="" F  S N3=$O(^TMP(NX,$J,N1,N2,N3)) Q:'N3!($D(DIRUT))  D
"RTN","PSONFI",69,0)
 ..S N4="" F  S N4=$O(^TMP(NX,$J,N1,N2,N3,N4)) Q:'N4!($D(DIRUT))  D
"RTN","PSONFI",70,0)
 ...W !?5,^TMP(NX,$J,N1,N2,N3,N4) I $Y>20 W ! D HLD Q:$D(DIRUT)  W @IOF
"RTN","PSONFI",71,0)
 W ! K ^UTILITY($J,"W")
"RTN","PSONFI",72,0)
 Q
"RTN","PSOORFI1")
0^44^B74027837
"RTN","PSOORFI1",1,0)
PSOORFI1 ;BIR/SAB - finish OP orders from OE/RR continued ;5/23/05 2:11pm
"RTN","PSOORFI1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**7,15,23,27,32,44,51,46,71,90,108,131,152,186,210,222,258,260,225**;DEC 1997;Build 29
"RTN","PSOORFI1",3,0)
 ;Ref. ^PS(50.7 supp. DBIA 2223
"RTN","PSOORFI1",4,0)
 ;Ref. ^PSDRUG( supp. DBIA 221
"RTN","PSOORFI1",5,0)
 ;Ref. L^PSSLOCK supp. DBIA 2789
"RTN","PSOORFI1",6,0)
 ;Ref. ^PS(50.606 supp. DBIA 2174
"RTN","PSOORFI1",7,0)
 ;Ref. ^PS(55 supp. DBIA 2228
"RTN","PSOORFI1",8,0)
 ;Ref. ULK^ORX2 supp. DBIA 867
"RTN","PSOORFI1",9,0)
 ;
"RTN","PSOORFI1",10,0)
 ;PSO*186 add call to function $$DEACHK
"RTN","PSOORFI1",11,0)
 ;PSO*210 add call to WORDWRAP api
"RTN","PSOORFI1",12,0)
 ;
"RTN","PSOORFI1",13,0)
 S SIGOK=1
"RTN","PSOORFI1",14,0)
DSPL K ^TMP("PSOPO",$J),CLOZPAT,PSOPRC,PSODSPL
"RTN","PSOORFI1",15,0)
 S (OI,PSODRUG("OI"))=$P(OR0,"^",8),PSODRUG("OIN")=$P(^PS(50.7,$P(OR0,"^",8),0),"^"),OID=$P(OR0,"^",9)
"RTN","PSOORFI1",16,0)
 I $P($G(OR0),"^",9) S POERR=1,DREN=$P(OR0,"^",9) D DRG^PSOORDRG K POERR G DRG
"RTN","PSOORFI1",17,0)
 I '$P(OR0,"^",9) D DREN^PSOORNW2
"RTN","PSOORFI1",18,0)
DRG I $P($G(^PSDRUG(+$G(PSODRUG("IEN")),"CLOZ1")),"^")="PSOCLO1" D CLOZ^PSOORFI2
"RTN","PSOORFI1",19,0)
 ;PSO*186 modify If/Else below to use DEACHK
"RTN","PSOORFI1",20,0)
 I $G(PSODRUG("DEA"))]"" D
"RTN","PSOORFI1",21,0)
 .S PSOCS=0 K DIR,DIC,PSOX
"RTN","PSOORFI1",22,0)
 .N PSDEA,PSDAYS S PSDEA=PSODRUG("DEA"),PSDAYS=+$P(OR0,"^",22)
"RTN","PSOORFI1",23,0)
 .I $$DEACHK^PSOUTLA1("*",PSDEA,PSDAYS,$G(CLOZPAT),.PSOCS,.PSOMAX)
"RTN","PSOORFI1",24,0)
 E  D
"RTN","PSOORFI1",25,0)
 .S PSOMAX=$S($G(CLOZPAT)=2:3,$G(CLOZPAT)=1:1,1:$P(OR0,"^",11))
"RTN","PSOORFI1",26,0)
ISSDT S (PSOID,Y,PSONEW("ISSUE DATE"))=$S($G(PSONEW("ISSUE DATE")):PSONEW("ISSUE DATE"),$P($G(OR0),"^",6):$E($P(OR0,"^",6),1,7),1:DT)
"RTN","PSOORFI1",27,0)
 X ^DD("DD") S PSONEW("ISSUE DATE")=Y
"RTN","PSOORFI1",28,0)
 D USER^PSOORFI2($P(OR0,"^",4)) S PSONEW("CLERK CODE")=$P(OR0,"^",4),PSORX("CLERK CODE")=USER1
"RTN","PSOORFI1",29,0)
 S (PSONEW("DFLG"),PSONEW("QFLG"))=0,PSODFN=$P(OR0,"^",2),PSONEW("QTY")=$P(OR0,"^",10),PSONEW("MAIL/WINDOW")=$S($P(OR0,"^",17)="M":"M",1:"W")
"RTN","PSOORFI1",30,0)
 S:$G(PSONEW("CLINIC"))']"" PSONEW("CLINIC")=+$P(OR0,"^",13),PSORX("CLINIC")=$S($D(^SC(PSONEW("CLINIC"),0)):$P(^SC(PSONEW("CLINIC"),0),"^"),1:"")
"RTN","PSOORFI1",31,0)
 S:$G(PSORX("CLINIC"))']"" PSORX("CLINIC")=$S($D(^SC(+$P(OR0,"^",13),0)):$P(^SC($P(OR0,"^",13),0),"^"),1:"")
"RTN","PSOORFI1",32,0)
 D USER^PSOORFI2($P(OR0,"^",5))
"RTN","PSOORFI1",33,0)
 S PSONEW("CLERK CODE")=$P(OR0,"^",4),PSONEW("PROVIDER")=$P(OR0,"^",5),PSONEW("PROVIDER NAME")=USER1
"RTN","PSOORFI1",34,0)
 S PSONEW("PATIENT STATUS")=$S(+$G(^PS(55,PSODFN,"PS")):+$G(^PS(55,PSODFN,"PS")),1:"")
"RTN","PSOORFI1",35,0)
 S PSONEW("CHCS NUMBER")=$S($P($G(^PS(52.41,+$G(ORD),"EXT")),"^")'="":$P($G(^("EXT")),"^"),1:"")
"RTN","PSOORFI1",36,0)
 S PSONEW("EXTERNAL SYSTEM")=$S($P($G(^PS(52.41,+$G(ORD),"EXT")),"^",3)'="":$P($G(^("EXT")),"^",3),1:"")
"RTN","PSOORFI1",37,0)
 I $P(OR0,"^",22)>0 S PSONEW("DAYS SUPPLY")=$P(OR0,"^",22) G DS
"RTN","PSOORFI1",38,0)
 S PSONEW("DAYS SUPPLY")=$S(+$G(^PS(55,PSODFN,"PS"))&($P($G(^PS(53,+$G(^PS(55,PSODFN,"PS")),0)),"^",3)):$P(^PS(53,+$G(^PS(55,PSODFN,"PS")),0),"^",3),1:30)
"RTN","PSOORFI1",39,0)
DS S:$D(CLOZPAT) PSONEW("DAYS SUPPLY")=$S(CLOZPAT=2&(PSONEW("DAYS SUPPLY")>28):28,CLOZPAT=1&(PSONEW("DAYS SUPPLY")>14):14,'CLOZPAT&(PSONEW("DAYS SUPPLY")>7):7,1:PSONEW("DAYS SUPPLY"))
"RTN","PSOORFI1",40,0)
 S IEN=0 D OBX                ; Display Order Checks Information
"RTN","PSOORFI1",41,0)
 D LMDISP^PSOORFI5(+$G(ORD))  ; Display Flag/Unflag Information
"RTN","PSOORFI1",42,0)
 D DIN^PSONFI(PSODRUG("OI"),$S($D(PSODRUG("IEN")):PSODRUG("IEN"),1:"")) ;Setup for N/F & DIN indicator
"RTN","PSOORFI1",43,0)
 I $G(PKI1)!($G(PKI)=1) D L1^PSOPKIV1 K:$G(PKI)=1 PKI
"RTN","PSOORFI1",44,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="*(1) Orderable Item: "_$P(^PS(50.7,PSODRUG("OI"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")_NFIO
"RTN","PSOORFI1",45,0)
 S:NFIO["<DIN>" NFIO=IEN_","_($L(^TMP("PSOPO",$J,IEN,0))-4)
"RTN","PSOORFI1",46,0)
 D FULL^VALM1 K LST I $G(PSODRUG("NAME"))]"" D  G PST
"RTN","PSOORFI1",47,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (2)"_$S($D(^PSDRUG("AQ",PSODRUG("IEN"))):"      CMOP ",1:"           ")_"Drug: "_PSODRUG("NAME")_NFID
"RTN","PSOORFI1",48,0)
 .S:NFID["<DIN>" NFID=IEN_","_($L(^TMP("PSOPO",$J,IEN,0))-4)
"RTN","PSOORFI1",49,0)
 .I $P(^PSDRUG(PSODRUG("IEN"),0),"^",10)]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="       Drug Message:" D DRGMSG^PSOORNEW
"RTN","PSOORFI1",50,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (2)           Drug: No Dispense Drug Selected"
"RTN","PSOORFI1",51,0)
PST D DOSE^PSOORFI4 K PSOINSFL
"RTN","PSOORFI1",52,0)
 S PSOINSFL=$P($G(^PS(52.41,ORD,"INS")),"^",2)
"RTN","PSOORFI1",53,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (4)   Pat Instruct:" D INST^PSOORFI4
"RTN","PSOORFI1",54,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  Provider Comments:" S TY=3 D INST
"RTN","PSOORFI1",55,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="       Instructions:" S TY=2 D INST
"RTN","PSOORFI1",56,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="                SIG:" D SIG
"RTN","PSOORFI1",57,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (5) Patient Status: "_$P($G(^PS(53,+PSONEW("PATIENT STATUS"),0)),"^")
"RTN","PSOORFI1",58,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (6)     Issue Date: "_PSONEW("ISSUE DATE")
"RTN","PSOORFI1",59,0)
 S (Y,PSONEW("FILL DATE"))=$S($E($P(OR0,"^",6),1,7)<DT:DT,1:$E($P(OR0,"^",6),1,7)) X ^DD("DD") S PSORX("FILL DATE")=Y,^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"        (7) Fill Date: "_Y
"RTN","PSOORFI1",60,0)
 I $P(OR0,"^",18) D
"RTN","PSOORFI1",61,0)
 .S IEN=IEN+1,Y=$P(OR0,"^",18) X ^DD("DD") S $P(^TMP("PSOPO",$J,IEN,0)," ",39)="Effective Date: "_Y
"RTN","PSOORFI1",62,0)
 D:$D(CLOZPAT) ELIG^PSOORFI2,CLQTY^PSOORFI4
"RTN","PSOORFI1",63,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (8)    Days Supply: "_$S($G(PSONEW("DAYS SUPPLY")):PSONEW("DAYS SUPPLY"),+$G(^PS(55,PSODFN,"PS"))&($P(^PS(53,+$G(^PS(55,PSODFN,"PS")),0),"^",3)):$P(^PS(53,+$G(^PS(55,PSODFN,"PS")),0),"^",3),1:"")
"RTN","PSOORFI1",64,0)
 I +$G(^PS(55,PSODFN,"PS")) S RXPT=+^("PS") I $G(^PS(53,RXPT,0))]"" D
"RTN","PSOORFI1",65,0)
 .S PSONEW("# OF REFILLS")=$S(+$P(OR0,"^",11)>+$P(^PS(53,RXPT,0),"^",4):+$P(^PS(53,RXPT,0),"^",4),1:+$P(OR0,"^",11)),PSOX=+$P(^PS(53,RXPT,0),"^",4)
"RTN","PSOORFI1",66,0)
 .S PSONEW("# OF REFILLS")=$S(PSONEW("# OF REFILLS")>PSOMAX:PSOMAX,1:PSONEW("# OF REFILLS"))
"RTN","PSOORFI1",67,0)
 .S PSOMAX=$S(PSOMAX>+$P(^PS(53,RXPT,0),"^",4):+$P(^PS(53,RXPT,0),"^",4),1:PSOMAX) K RXPT
"RTN","PSOORFI1",68,0)
 .S MPSDY=PSONEW("DAYS SUPPLY")
"RTN","PSOORFI1",69,0)
 .;I PSOMAX=5 S MAXRF=$S(MPSDY<60:5,MPSDY'<60&(MPSDY'>89):2,1:1) I PSONEW("# OF REFILLS")>MAXRF S PSONEW("# OF REFILLS")=MAXRF K MAXRF,MPSDY Q
"RTN","PSOORFI1",70,0)
 .S MAXRF=$S(MPSDY<60:11,MPSDY'<60&(MPSDY'>89):5,MPSDY=90:3,1:0)
"RTN","PSOORFI1",71,0)
 .I PSONEW("# OF REFILLS")>MAXRF S PSONEW("# OF REFILLS")=MAXRF K MAXRF,MPSDY
"RTN","PSOORFI1",72,0)
 E  D
"RTN","PSOORFI1",73,0)
 . I $G(PSOMAX) S PSONEW("# OF REFILLS")=$S(+$P(OR0,"^",11)>PSOMAX:PSOMAX,1:+$P(OR0,"^",11)) Q
"RTN","PSOORFI1",74,0)
 .S PSONEW("# OF REFILLS")=+$P(OR0,"^",11)
"RTN","PSOORFI1",75,0)
 S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"                (9)   QTY"_$S($P($G(^PSDRUG(+$G(PSODRUG("IEN")),660)),"^",8)]"":" ("_$P($G(^PSDRUG(+$G(PSODRUG("IEN")),660)),"^",8)_")",1:" (  )")_": "
"RTN","PSOORFI1",76,0)
 S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_$S($D(CLOZPAT):+$G(PSONEW("QTY")),1:$P(OR0,"^",10))
"RTN","PSOORFI1",77,0)
 I $P($G(^PSDRUG(+$G(PSODRUG("IEN")),5)),"^")]"" D
"RTN","PSOORFI1",78,0)
 .S $P(RN," ",79)=" ",IEN=IEN+1
"RTN","PSOORFI1",79,0)
 .S ^TMP("PSOPO",$J,IEN,0)=$E(RN,$L("QTY DSP MSG: "_$P(^PSDRUG(PSODRUG("IEN"),5),"^"))+1,79)_"QTY DSP MSG: "_$P(^PSDRUG(PSODRUG("IEN"),5),"^") K RN
"RTN","PSOORFI1",80,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="       Provider ordered "_+$P(OR0,"^",11)_" refills"
"RTN","PSOORFI1",81,0)
 D:$D(CLOZPAT) PQTY^PSOORFI4
"RTN","PSOORFI1",82,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(10)   # of Refills: "_PSONEW("# OF REFILLS")_$E("  ",$L(PSONEW("# OF REFILLS"))+1,2)_"               (11)   Routing: "_$S($G(PSONEW("MAIL/WINDOW"))="M":"MAIL",1:"WINDOW")
"RTN","PSOORFI1",83,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(12)         Clinic: "_PSORX("CLINIC")
"RTN","PSOORFI1",84,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(13)       Provider: "_PSONEW("PROVIDER NAME")
"RTN","PSOORFI1",85,0)
 I $P($G(^VA(200,$S($G(PSONEW("PROVIDER")):PSONEW("PROVIDER"),1:$P(OR0,"^",5)),"PS")),"^",7)&($P($G(^("PS")),"^",8)) S PSONEW("COSIGNING PROVIDER")=$P(^("PS"),"^",8) D
"RTN","PSOORFI1",86,0)
 .D USER^PSOORFI2(PSONEW("COSIGNING PROVIDER"))
"RTN","PSOORFI1",87,0)
 .S IEN=IEN+1 S ^TMP("PSOPO",$J,IEN,0)="        Cos-Provider: "_USER1
"RTN","PSOORFI1",88,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(14)         Copies: 1"
"RTN","PSOORFI1",89,0)
 S PSONEW("REMARKS")=$S($P(OR0,"^",17)="C":"Administered in Clinic.",1:"")
"RTN","PSOORFI1",90,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(15)        Remarks: "_$S($G(PSONEW("REMARKS"))]"":PSONEW("REMARKS"),1:"")
"RTN","PSOORFI1",91,0)
 D USER^PSOORFI2($P(OR0,"^",4))
"RTN","PSOORFI1",92,0)
 S $P(RN," ",35)=" ",IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="   Entry By: "_USER1_$E(RN,$L(USER1)+1,35)
"RTN","PSOORFI1",93,0)
 S Y=$P(OR0,"^",12) X ^DD("DD") S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"Entry Date: "_$E($P(OR0,"^",12),4,5)_"/"_$E($P(OR0,"^",12),6,7)_"/"_$E($P(OR0,"^",12),2,3)_" "_$P(Y,"@",2) K RN
"RTN","PSOORFI1",94,0)
 S PSOACT=$S($D(^XUSEC("PSORPH",DUZ)):"DEFX",'$D(^XUSEC("PSORPH",DUZ))&($P($G(PSOPAR),"^",2)):"F",1:"")
"RTN","PSOORFI1",95,0)
 ; - PSOACTOV is used to force the Pending Order to be Read-Only (no updates) even if invoked by a Pharmacist
"RTN","PSOORFI1",96,0)
 I $G(PSOACTOV) S PSOACT=""
"RTN","PSOORFI1",97,0)
 D:'$G(ACP) EN^PSOLMPO S:$G(ACP) VALMBCK="Q" D:$G(PKI1)=2 DCP^PSOPKIV1
"RTN","PSOORFI1",98,0)
 Q
"RTN","PSOORFI1",99,0)
POST ;post patient selection
"RTN","PSOORFI1",100,0)
 D POST^PSOORFI2 Q
"RTN","PSOORFI1",101,0)
SIG ;displays possible sig
"RTN","PSOORFI1",102,0)
 D SIG^PSOORFI2 Q
"RTN","PSOORFI1",103,0)
INST ;displays provider comments and pharmacy instructions
"RTN","PSOORFI1",104,0)
 S INST=0 F  S INST=$O(^PS(52.41,ORD,TY,INST)) Q:'INST  D     ;PSO*210
"RTN","PSOORFI1",105,0)
 . S (MIG,INST(INST))=^PS(52.41,ORD,TY,INST,0)
"RTN","PSOORFI1",106,0)
 . D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOPO",$J)),20)
"RTN","PSOORFI1",107,0)
 K INST,TY,MIG,SG
"RTN","PSOORFI1",108,0)
 Q
"RTN","PSOORFI1",109,0)
OBX ;formats obx section
"RTN","PSOORFI1",110,0)
 D OBX^PSOORFI4
"RTN","PSOORFI1",111,0)
 Q
"RTN","PSOORFI1",112,0)
ST ;sort by route or patient
"RTN","PSOORFI1",113,0)
 W !!,"Enter 'PA' to process orders by patients",!,"      'RT' to process orders by route (mail/window)",!,"      'PR' to process orders by priority",!,"      'CL' to process orders by clinic"
"RTN","PSOORFI1",114,0)
 W !,"      'FL' to process flagged orders",!,"   or 'E' or '^' to exit" W ! Q
"RTN","PSOORFI1",115,0)
RT ;which route to sort by
"RTN","PSOORFI1",116,0)
 W !!,"Enter 'W' to process window orders first",!,"      'M' to process mail orders first",!,"      'C' to process orders administered in clinic first",!,"   or 'E' or '^' to exit" Q
"RTN","PSOORFI1",117,0)
PT ;process for all or one patient
"RTN","PSOORFI1",118,0)
 W !!,"Enter 'A' to process all patient orders",!,"      'S' to process orders for a patient",!,"      or 'E' or '^' to exit" Q
"RTN","PSOORFI1",119,0)
EP ;continue processing or not
"RTN","PSOORFI1",120,0)
 W !,"If you want to continue processing orders Press RETURN or enter '^' to exit" Q
"RTN","PSOORFI1",121,0)
LOCK S PSOPLCK=$$L^PSSLOCK(PAT,0) I '$G(PSOPLCK) D LOCK^PSOORCPY S POERR("QFLG")=1
"RTN","PSOORFI1",122,0)
 K PSOPLCK
"RTN","PSOORFI1",123,0)
 Q
"RTN","PSOORFI1",124,0)
ULK S X=PAT_";DPT(" D ULK^ORX2 S:$G(PSOQUIT) POERR("QFLG")=1 ; not called anymore
"RTN","PSOORFI1",125,0)
 Q
"RTN","PSOORFI1",126,0)
LOCK1 S PSOACT=$S($D(^XUSEC("PSORPH",DUZ)):"DEFX",'$D(^XUSEC("PSORPH",DUZ))&($P($G(PSOPAR),"^",2)):"F",1:"")
"RTN","PSOORFI1",127,0)
 Q
"RTN","PSOORFI1",128,0)
EX K DRET,SIG,PSODRUG,PRC,PHI
"RTN","PSOORFI1",129,0)
 K DIR,DIRUT,DUOUT,DIRUT,X,Y,DIC,POERR,PSONEW,PSOSD,MAIL,CLI,WIN,OR0,OR1,OR2,ORD,SRT,PSRT,PSODFN,PSOFROM,T,OR3,PAT,%,%T,%Y,DI,DQ,DR,DRG,STA,I,T1,PSOSORT
"RTN","PSOORFI1",130,0)
 K TO,TC,TZ,PSOCPAY,PSOBILL,PSOIBQS,GROUPCNT,AGROUP,AGROUP1,OBX,%,%I,%H,D0,DFN,PSORX,PSOPTPST,PSOQFLG,PT,RTN,TM,TM1,DIPGM,PSOID,PSOCNT,PSOLK,PSZFIN,PSZFZZ D KVA^VADPT
"RTN","PSOORFI1",131,0)
 K PSOFDR,PSOQUIT,PSOFIN,^TMP("PSOAO",$J),^TMP("PSODA",$J),^TMP("PSOPO",$J),^TMP("PSOPF",$J),^TMP("PSOPI",$J),^TMP("PSOHDR",$J),MEDA,MEDP
"RTN","PSOORFI1",132,0)
 K C,CC,CNT,CRIT,D,DGI,DGS,DREN,IT,JJ,LG,MM,NIEN,PSOD,PATA,PSDAYS,PSOACT,PSOBM,PSOCOU,PSOCOUU,PSOFLAG,PSON,PSONOOR,PSOOPT,PSOPF,PSOPI,PSRF,RXFL,SDA,SEG1,SER,SERS,SLPPL,STAT,Z,Z4,ZDA
"RTN","PSOORFI1",133,0)
 D FULL^VALM1
"RTN","PSOORFI1",134,0)
 Q
"RTN","PSOORFI2")
0^55^B90909677
"RTN","PSOORFI2",1,0)
PSOORFI2 ;BIR/BHW-finish cprs orders cont. ;07/29/96
"RTN","PSOORFI2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**7,15,23,27,46,130,146,177,222,225**;DEC 1997;Build 29
"RTN","PSOORFI2",3,0)
 ;External reference ^YSCL(603.01 supported by DBIA 2697
"RTN","PSOORFI2",4,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOORFI2",5,0)
HLP W !,"Enter 'S' to process orders with a priority of STAT",!,"      'E' to process orders with an Emergency priority,",!,"      'R' to process Routine orders.",! Q
"RTN","PSOORFI2",6,0)
HELP ;
"RTN","PSOORFI2",7,0)
 W !,"Please enter a minimum of two (2) characters.",!,"Enter Patient's name whose med orders are to be completed.",!
"RTN","PSOORFI2",8,0)
 S (PATN,DPT)=0 F  S DPT=$O(^PS(52.41,"AOR",DPT)) Q:'DPT  I $D(^PS(52.41,"AOR",DPT,PSOPINST)) W !,$P(^DPT(DPT,0),"^") S PATN=PATN+1 I PATN=20 D  I $D(DUOUT)!($D(DTOUT)) G HELPX
"RTN","PSOORFI2",9,0)
 .K DIR,DUOUT,DTOUT,DIRUT S DIR(0)="E" D ^DIR S PATN=0 K DIR
"RTN","PSOORFI2",10,0)
HELPX K DTOUT,DUOUT,DIRUT,PAINST S DIR(0)="FO^2:30",DIR("A")="Select Patient",DIR("?")="^D HELP^PSOORFIN"
"RTN","PSOORFI2",11,0)
 K PATN,DPT Q
"RTN","PSOORFI2",12,0)
RTE ;
"RTN","PSOORFI2",13,0)
 S PSZFIN=1
"RTN","PSOORFI2",14,0)
 F PSZFZZ=0:0 S PSZFZZ=$O(^PS(52.41,"AC",PAT,$E(PSRT),PSZFZZ)) Q:'PSZFZZ!('PSZFIN)  D
"RTN","PSOORFI2",15,0)
 .I $P($G(^PS(52.41,PSZFZZ,0)),"^",3)="NW"!($P($G(^(0)),"^",3)="RNW")!($P($G(^(0)),"^",3)="RF") I $P($G(^PS(52.41,PSZFZZ,"INI")),"^")=$G(PSOPINST) S PSZFIN=0
"RTN","PSOORFI2",16,0)
 Q
"RTN","PSOORFI2",17,0)
PRI ;
"RTN","PSOORFI2",18,0)
 S PSZFIN=1
"RTN","PSOORFI2",19,0)
 F PSZFZZ=0:0 S PSZFZZ=$O(^PS(52.41,"AP",PAT,$E(PSRT),PSZFZZ)) Q:'PSZFZZ!('PSZFIN)  D
"RTN","PSOORFI2",20,0)
 .I $P($G(^PS(52.41,PSZFZZ,0)),"^",3)="NW"!($P($G(^(0)),"^",3)="RNW")!($P($G(^(0)),"^",3)="RF") I $P($G(^PS(52.41,PSZFZZ,"INI")),"^")=$G(PSOPINST) S PSZFIN=0
"RTN","PSOORFI2",21,0)
 Q
"RTN","PSOORFI2",22,0)
PROFILE ;display med profile
"RTN","PSOORFI2",23,0)
 S MEDA=3 ;3=question asked already
"RTN","PSOORFI2",24,0)
 W !!! K MEDP,DIR,DUOUT,DIRUT,DTOUT S DIR(0)="Y",DIR("B")="Yes",DIR("A")="Do you want to see Medication Profile" D ^DIR K DIR Q:$D(DIRUT)!('Y)
"RTN","PSOORFI2",25,0)
 I Y S MEDP=1
"RTN","PSOORFI2",26,0)
 K DIR,DUOUT,DIRUT,DTOUT
"RTN","PSOORFI2",27,0)
 Q
"RTN","PSOORFI2",28,0)
DC I '$G(PSOORRNW),$G(PSOOPT)=3 S PSORENW("DFLG")=1 S:'$D(PSOBBC1("FROM")) VALMBCK="Q",VALMSG="Renew Rx Request Canceled.",Y=-1 Q
"RTN","PSOORFI2",29,0)
 G DC^PSOORFI6
"RTN","PSOORFI2",30,0)
 Q
"RTN","PSOORFI2",31,0)
DE Q:'$D(^PS(52.41,ORD,0))
"RTN","PSOORFI2",32,0)
 K ^PS(52.41,"AOR",$P(^PS(52.41,ORD,0),"^",2),+$P($G(^PS(52.41,ORD,"INI")),"^"),ORD),^PS(52.41,"AD",$P(^PS(52.41,ORD,0),"^",12),+$P($G(^PS(52.41,ORD,"INI")),"^"),ORD)
"RTN","PSOORFI2",33,0)
 S $P(^PS(52.41,ORD,0),"^",3)="DC",POERR("PLACER")=$P(^(0),"^"),POERR("STAT")="OC"
"RTN","PSOORFI2",34,0)
 S POERR("COMM")=$S($G(POERR("DEAD")):"Patient died on "_$G(PSOPTPST(2,PSODFN,.351))_".",1:ACOM),$P(^PS(52.41,ORD,4),"^")=POERR("COMM")
"RTN","PSOORFI2",35,0)
 D EN^PSOHLSN(POERR("PLACER"),POERR("STAT"),POERR("COMM"),PSONOOR)
"RTN","PSOORFI2",36,0)
 I '$G(POERR("DEAD")) S DIR("A")="Press Return to Continue" D PAUSE^VALM1
"RTN","PSOORFI2",37,0)
 K PSONOOR,PDORUG,ACOM,CMOP,DEA,DEF,DREN,FDR,HDR,PHI,PRC,SIGOK,DIR,DTOUT,DUOUT,DIRUT
"RTN","PSOORFI2",38,0)
 S Y=-1 Q
"RTN","PSOORFI2",39,0)
 ;
"RTN","PSOORFI2",40,0)
RF ;process refill request from CPRS
"RTN","PSOORFI2",41,0)
 S PSOREF("IRXN")=$P(OR0,"^",19) D PSOL^PSSLOCK($P(OR0,"^",19)) I '$G(PSOMSG) D  D PAUSE^VALM1 K PSOREF,PSOMSG Q
"RTN","PSOORFI2",42,0)
 .I $P($G(PSOMSG),"^",2)'="" W $C(7),!!,$P(PSOMSG,"^",2),! Q
"RTN","PSOORFI2",43,0)
 .W $C(7),!!,"Another person is editing Rx "_$P(^PSRX($P(OR0,"^",19),0),"^"),!
"RTN","PSOORFI2",44,0)
 ;
"RTN","PSOORFI2",45,0)
 D FULL^VALM1
"RTN","PSOORFI2",46,0)
 I '$P($G(^PS(52.41,ORD,0)),"^",23),+$G(^PS(52.41,ORD,"FLG")) D  I $D(DIRUT)!'Y S VALMBCK="B" Q
"RTN","PSOORFI2",47,0)
 . K DIRUT,DUOUT,DTOUT,DIR
"RTN","PSOORFI2",48,0)
 . S DIR("A",1)="Flagged by "_$$GET1^DIQ(52.41,ORD,34)_" on "_$$GET1^DIQ(52.41,ORD,33)_": "_$$GET1^DIQ(52.41,ORD,35)
"RTN","PSOORFI2",49,0)
 . S DIR("A",2)=""
"RTN","PSOORFI2",50,0)
 . S DIR("A",3)="Unflagged by "_$$GET1^DIQ(52.41,ORD,37)_" on "_$$GET1^DIQ(52.41,ORD,36)_": "_$$GET1^DIQ(52.41,ORD,38)
"RTN","PSOORFI2",51,0)
 . S DIR("A",4)=""
"RTN","PSOORFI2",52,0)
 . S DIR(0)="Y",DIR("B")="YES",DIR("A")="Continue"
"RTN","PSOORFI2",53,0)
 . W ! D ^DIR
"RTN","PSOORFI2",54,0)
 ;
"RTN","PSOORFI2",55,0)
 I $G(ORD),+$P($G(^PS(52.41,+ORD,0)),"^",23)=1 D  Q:$D(DIRUT)!'Y  D EN1^ORCFLAG(+$P($G(^PS(52.41,ORD,0)),"^")) H 1
"RTN","PSOORFI2",56,0)
 . K DIRUT,DUOUT,DTOUT,DIR
"RTN","PSOORFI2",57,0)
 . S DIR("A",1)="This Refill Request is flagged. In order to process it"
"RTN","PSOORFI2",58,0)
 . S DIR("A",2)="you must unflag it first."
"RTN","PSOORFI2",59,0)
 . S DIR("A",3)=""
"RTN","PSOORFI2",60,0)
 . S DIR(0)="Y",DIR("A")="Unflag Refill Request",DIR("B")="NO"
"RTN","PSOORFI2",61,0)
 . W ! D ^DIR I $D(DIRUT)!'Y S VALMBCK="B"
"RTN","PSOORFI2",62,0)
 I $G(ORD),+$P($G(^PS(52.41,+ORD,0)),"^",23)=1 Q
"RTN","PSOORFI2",63,0)
 ;
"RTN","PSOORFI2",64,0)
 K PSOMSG S (PSOREF("DFLG"),PSOREF("FIELD"),PSOREF1)=0,X="T-6M",%DT="X" D ^%DT
"RTN","PSOORFI2",65,0)
 S (PSOID,PSOREF("ISSUE DATE"))=$S($P(^PSRX(PSOREF("IRXN"),0),"^",13)<Y:Y,1:$P(^PSRX(PSOREF("IRXN"),0),"^",13))
"RTN","PSOORFI2",66,0)
 S:$G(PSORX("BAR CODE"))&($G(PSOBBC1("FROM"))="NEW") PSOREF("ISSUE DATE")=DT K X,X1,X2
"RTN","PSOORFI2",67,0)
 ;
"RTN","PSOORFI2",68,0)
 S PSONEW("DAYS SUPPLY")=$P(^PSRX(PSOREF("IRXN"),0),"^",8),PSONEW("# OF REFILLS")=$P(^(0),"^",9)
"RTN","PSOORFI2",69,0)
 W !!,"Processing Refill Request for Rx "_$P(^PSRX(PSOREF("IRXN"),0),"^")
"RTN","PSOORFI2",70,0)
 ;S:$G(PSOREQFD)]"" PSORX("FILL DATE")=PSOREQFD
"RTN","PSOORFI2",71,0)
 D FILLDT^PSODIR2(.PSOREF) I PSOREF("DFLG") S VALMBCK="R" G END
"RTN","PSOORFI2",72,0)
 ;S:$G(PSORX("FILL DATE"))]"" PSOREQFD=PSORX("FILL DATE")
"RTN","PSOORFI2",73,0)
 ;
"RTN","PSOORFI2",74,0)
 ;S:$G(PSOREQMP)]"" PSORX(" METHOD OF PICK-UP")=PSOREQMP
"RTN","PSOORFI2",75,0)
 S PSORX("MAIL/WINDOW")=$S($P(OR0,"^",17)="M":"MAIL",1:"WINDOW") D MW^PSODIR2(.PSOREF) I PSOREF("DFLG") S VALMBCK="R" G END
"RTN","PSOORFI2",76,0)
 ;S:$G(PSORX("METHOD OF PICK-UP"))]"" PSOREQMP=PSORX("METHOD OF PICK-UP")
"RTN","PSOORFI2",77,0)
 S:'$G(PSOFROM)'="NEW" PSOFROM="REFILL" S PSOREF("DFLG")=0
"RTN","PSOORFI2",78,0)
 D ^PSOREF0
"RTN","PSOORFI2",79,0)
END D PSOUL^PSSLOCK(PSOREF("IRXN")) K PSOREF,NODE,PSOREF1,PSL,PSOERR,PSORX("QFLG")
"RTN","PSOORFI2",80,0)
 Q
"RTN","PSOORFI2",81,0)
S D KPRI,KPRIZ F  S ORD=$O(^PS(52.41,"AP",PAT,"S",ORD)) Q:'ORD!($G(POERR("QFLG")))  I $P(^PS(52.41,ORD,0),"^",3)'="DC",$P(^(0),"^",3)'="DE" D LOCK1^PSOORFI1,ORD^PSOORFIN S PSOSTATZ=1
"RTN","PSOORFI2",82,0)
 D:$G(POERR("QFLG")) KPRI Q:$G(POERR("QFLG"))  I $G(PSOSTATZ) S ORD=0 D
"RTN","PSOORFI2",83,0)
 .D KPRIZ F  S ORD=$O(^PS(52.41,"AP",PAT,"E",ORD)) Q:'ORD!($G(POERR("QFLG")))  I $P(^PS(52.41,ORD,0),"^",3)'="DC",$P(^(0),"^",3)'="DE" D LOCK1^PSOORFI1,ORD^PSOORFIN
"RTN","PSOORFI2",84,0)
 .Q:$G(POERR("QFLG"))
"RTN","PSOORFI2",85,0)
 .D KPRIZ S ORD=0 F  S ORD=$O(^PS(52.41,"AP",PAT,"R",ORD)) Q:'ORD!($G(POERR("QFLG")))  I $P(^PS(52.41,ORD,0),"^",3)'="DC",$P(^(0),"^",3)'="DE" D LOCK1^PSOORFI1,ORD^PSOORFIN
"RTN","PSOORFI2",86,0)
 D KPRI
"RTN","PSOORFI2",87,0)
 Q
"RTN","PSOORFI2",88,0)
E D KPRI,KPRIZ F  S ORD=$O(^PS(52.41,"AP",PAT,"E",ORD)) Q:'ORD!($G(POERR("QFLG")))  I $P(^PS(52.41,ORD,0),"^",3)'="DC",$P(^(0),"^",3)'="DE" D LOCK1^PSOORFI1,ORD^PSOORFIN S PSOEMERZ=1
"RTN","PSOORFI2",89,0)
 D:$G(POERR("QFLG")) KPRI Q:$G(POERR("QFLG"))  I $G(PSOEMERZ) S ORD=0 D
"RTN","PSOORFI2",90,0)
 .D KPRIZ F  S ORD=$O(^PS(52.41,"AP",PAT,"S",ORD)) Q:'ORD!($G(POERR("QFLG")))  I $P(^PS(52.41,ORD,0),"^",3)'="DC",$P(^(0),"^",3)'="DE" D LOCK1^PSOORFI1,ORD^PSOORFIN
"RTN","PSOORFI2",91,0)
 .Q:$G(POERR("QFLG"))
"RTN","PSOORFI2",92,0)
 .D KPRIZ S ORD=0 F  S ORD=$O(^PS(52.41,"AP",PAT,"R",ORD)) Q:'ORD!($G(POERR("QFLG")))  I $P(^PS(52.41,ORD,0),"^",3)'="DC",$P(^(0),"^",3)'="DE" D LOCK1^PSOORFI1,ORD^PSOORFIN
"RTN","PSOORFI2",93,0)
 D KPRI
"RTN","PSOORFI2",94,0)
 Q
"RTN","PSOORFI2",95,0)
R D KPRI,KPRIZ F  S ORD=$O(^PS(52.41,"AP",PAT,"R",ORD)) Q:'ORD!($G(POERR("QFLG")))  I $P(^PS(52.41,ORD,0),"^",3)'="DC",$P(^(0),"^",3)'="DE" D LOCK1^PSOORFI1,ORD^PSOORFIN S PSOROUTZ=1
"RTN","PSOORFI2",96,0)
 D:$G(POERR("QFLG")) KPRI Q:$G(POERR("QFLG"))  I $G(PSOROUTZ) S ORD=0 D
"RTN","PSOORFI2",97,0)
 .D KPRIZ F  S ORD=$O(^PS(52.41,"AP",PAT,"E",ORD)) Q:'ORD!($G(POERR("QFLG")))  I $P(^PS(52.41,ORD,0),"^",3)'="DC",$P(^(0),"^",3)'="DE" D LOCK1^PSOORFI1,ORD^PSOORFIN
"RTN","PSOORFI2",98,0)
 .Q:$G(POERR("QFLG"))
"RTN","PSOORFI2",99,0)
 .D KPRIZ S ORD=0 F  S ORD=$O(^PS(52.41,"AP",PAT,"S",ORD)) Q:'ORD!($G(POERR("QFLG")))  I $P(^PS(52.41,ORD,0),"^",3)'="DC",$P(^(0),"^",3)'="DE" D LOCK1^PSOORFI1,ORD^PSOORFIN
"RTN","PSOORFI2",100,0)
 D KPRI
"RTN","PSOORFI2",101,0)
 Q
"RTN","PSOORFI2",102,0)
KPRI K PSOSTATZ,PSOROUTZ,PSOEMERZ
"RTN","PSOORFI2",103,0)
 Q
"RTN","PSOORFI2",104,0)
KPRIZ K PSOQUIT,POERR("QFLG")
"RTN","PSOORFI2",105,0)
 Q
"RTN","PSOORFI2",106,0)
INST ;Select Institution
"RTN","PSOORFI2",107,0)
 N PSOCNT
"RTN","PSOORFI2",108,0)
 I '$G(PSOSITE) D ^PSOLSET I '$G(PSOSITE) S PSOIQUIT=1 Q
"RTN","PSOORFI2",109,0)
 N PSIR,PSCT,PSINST K PSOPINST
"RTN","PSOORFI2",110,0)
 S PSCT=0 F PSIR=0:0 S PSIR=$O(^PS(59,PSOSITE,"INI1",PSIR)) Q:'PSIR  I $P($G(^PS(59,PSOSITE,"INI1",PSIR,0)),"^") S PSCT=PSCT+1 I PSCT=1 S PSOPINST=$P($G(^(0)),"^")
"RTN","PSOORFI2",111,0)
 I PSCT=0 W !!,"There are no CPRS Ordering Institutions associated with this Outpatient site!",!,"Use the Site Parameter enter/edit option to enter CPRS Ordering Institutions!",! S PSOIQUIT=1 Q
"RTN","PSOORFI2",112,0)
 I PSCT=1 Q
"RTN","PSOORFI2",113,0)
 W !!!,"There are multiple Institutions associated with this Outpatient Site for",!,"finishing orders entered through CPRS. Select the Institution for which to",!,"finish orders from.  Enter '?' to see all choices.",!
"RTN","PSOORFI2",114,0)
 K PSOPNAME D:$G(PSOPINST)  K DIC S DIC(0)="AEQMZ",DIC="^PS(59,"_PSOSITE_",""INI1""," S:$G(PSOPNAME)'="" DIC("B")=$G(PSOPNAME) D ^DIC K DIC,PSOPNAME I Y<1 W !!,"No Institution selected",! S PSOIQUIT=1 Q
"RTN","PSOORFI2",115,0)
 .K ^UTILITY("DIQ1",$J),DIQ S DA=$G(PSOPINST),DIC=4,DIQ(0)="E",DR=".01" D EN^DIQ1 S PSOPNAME=$G(^UTILITY("DIQ1",$J,4,DA,.01,"E")) K ^UTILITY("DIQ1",$J),DA,DR,DIC,DIQ
"RTN","PSOORFI2",116,0)
 W ! S PSOPINST=$P(Y,"^",2) K Y
"RTN","PSOORFI2",117,0)
 D INSTNM W !,"You have selected "_$G(PSODINST)_"."
"RTN","PSOORFI2",118,0)
 W !,"After completing these orders, you may re-enter this option and select again.",!
"RTN","PSOORFI2",119,0)
 S PSOCNT=$$CNT(PSOPINST)
"RTN","PSOORFI2",120,0)
 W !,"      <There ",$S(PSOCNT=1:"is ",1:"are "),$S(PSOCNT>0:PSOCNT,1:"no")," flagged order",$S(PSOCNT=1:"",1:"s")," for ",PSODINST,">",!
"RTN","PSOORFI2",121,0)
 K PSODINST
"RTN","PSOORFI2",122,0)
 Q
"RTN","PSOORFI2",123,0)
 ;
"RTN","PSOORFI2",124,0)
CNT(SITE)  ; - Counter for flagged pending orders by Site
"RTN","PSOORFI2",125,0)
 N CNT,ORD
"RTN","PSOORFI2",126,0)
 S (CNT,LOGIN,ORD)=0
"RTN","PSOORFI2",127,0)
 F  S LOGIN=$O(^PS(52.41,"AD",LOGIN)) Q:'LOGIN  D
"RTN","PSOORFI2",128,0)
 . F  S ORD=$O(^PS(52.41,"AD",LOGIN,SITE,ORD)) Q:'ORD  D
"RTN","PSOORFI2",129,0)
 . . I $P(^PS(52.41,ORD,0),"^",3)="DC"!($P(^PS(52.41,ORD,0),"^",3)="DE") Q
"RTN","PSOORFI2",130,0)
 . . I $P($G(^PS(52.41,ORD,0)),"^",23) S CNT=CNT+1
"RTN","PSOORFI2",131,0)
 Q CNT
"RTN","PSOORFI2",132,0)
 ;
"RTN","PSOORFI2",133,0)
INST1 ;
"RTN","PSOORFI2",134,0)
 K PSOPINST N PSIR
"RTN","PSOORFI2",135,0)
 F PSIR=0:0 S PSIR=$O(^PS(59,PSOSITE,"INI1",PSIR)) Q:'PSIR!($G(PSOPINST))  I $P($G(^PS(59,PSOSITE,"INI1",PSIR,0)),"^") S PSOPINST=$P($G(^(0)),"^")
"RTN","PSOORFI2",136,0)
 Q
"RTN","PSOORFI2",137,0)
CLOZ ;checks clozapine status of patient 
"RTN","PSOORFI2",138,0)
 S CLOZPAT=$O(^YSCL(603.01,"C",PSODFN,0))
"RTN","PSOORFI2",139,0)
 S CLOZPAT=$P($G(^YSCL(603.01,+CLOZPAT,0)),"^",3)
"RTN","PSOORFI2",140,0)
 S CLOZPAT=$S(CLOZPAT="M":2,CLOZPAT="B":1,1:0)
"RTN","PSOORFI2",141,0)
 S:'$D(PSONEW("# OF REFILLS")) (PSONEW("# OF REFILLS"),PSONEW("N# REF"))=0
"RTN","PSOORFI2",142,0)
 Q
"RTN","PSOORFI2",143,0)
ELIG I $G(CLOZPAT)=1 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="   Patient Eligible for 14 Day Supply or 7 Day Supply with 1 refill"
"RTN","PSOORFI2",144,0)
 I $G(CLOZPAT)=2 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="   Patient Eligible for 28 Day Supply or 14 Day Supply with 1 refill or 7 Day Supply with 3 refill"
"RTN","PSOORFI2",145,0)
 Q
"RTN","PSOORFI2",146,0)
USER(USER) ;returns .01 of 200
"RTN","PSOORFI2",147,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="M",X="`"_USER D ^DIC S USER1=$S(+Y:$P(Y,"^",2),1:"Unknown") K DIC,X,Y
"RTN","PSOORFI2",148,0)
 Q
"RTN","PSOORFI2",149,0)
INSTNM ;
"RTN","PSOORFI2",150,0)
 K PSOFINDA,PSODINST I $G(DA) S PSOFINDA=$G(DA)
"RTN","PSOORFI2",151,0)
 K PSODNM S DA=$G(PSOPINST) I DA S DIC=4,DIQ(0)="E",DR=".01",DIQ="PSODNM" D EN^DIQ1 S PSODINST=$G(PSODNM(4,DA,.01,"E")) K PSODNM,DIC,DR,DA
"RTN","PSOORFI2",152,0)
 I $G(PSOFINDA) S DA=$G(PSOFINDA) K PSOFINDA
"RTN","PSOORFI2",153,0)
 Q
"RTN","PSOORFI2",154,0)
POST S PSOFINY=$G(Y) D ^PSOBUILD S Y=$G(PSOFINY) K PSOFINY D OERR^PSORX1 I $G(PSOQUIT) Q
"RTN","PSOORFI2",155,0)
 K PSOQFLG F PT="GET","DEAD","INP","CNH","TPB","ADDRESS","COPAY" S RTN=PT_"^PSOPTPST" D @RTN K PSOXFLG Q:$G(POERR("DEAD"))!($G(PSOQFLG))
"RTN","PSOORFI2",156,0)
 I $G(POERR("DEAD")) S POERR("QFLG")=1 Q
"RTN","PSOORFI2",157,0)
 K PSOERR("DEAD") I $G(PSOQFLG) Q
"RTN","PSOORFI2",158,0)
 D ^PSOORUT2,BLD^PSOORUT1,EN^PSOLMUTL
"RTN","PSOORFI2",159,0)
 Q
"RTN","PSOORFI2",160,0)
SIG ;
"RTN","PSOORFI2",161,0)
 S SIG=0,PSOFINFL=1 F  S SIG=$O(^PS(52.41,ORD,"SIG",SIG)) Q:'SIG  D
"RTN","PSOORFI2",162,0)
 .S (MIG,SIG(SIG))=^PS(52.41,ORD,"SIG",SIG,0)
"RTN","PSOORFI2",163,0)
 .F SG=1:1:$L(MIG," ") S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P(MIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",20)=" " S ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P(MIG," ",SG) D
"RTN","PSOORFI2",164,0)
 ..I $E(^TMP("PSOPO",$J,IEN,0),$L(^TMP("PSOPO",$J,IEN,0)))=" " S ^TMP("PSOPO",$J,IEN,0)=$E(^TMP("PSOPO",$J,IEN,0),1,($L(^TMP("PSOPO",$J,IEN,0))-1))
"RTN","PSOORFI2",165,0)
 S:$O(SIG(0)) SIGOK=1 K MIG
"RTN","PSOORFI2",166,0)
 F D=0:0 S D=$O(^PS(52.41,ORD,"INS1",D)) Q:'D  S PSONEW("INS",D)=^PS(52.41,ORD,"INS1",D,0)
"RTN","PSOORFI2",167,0)
 ;I PSONEW("INS")]"" S X=PSONEW("INS") D SIG^PSOHELP I $G(INS1)]"" S PSONEW("SIG")=$E(INS1,2,9999999)
"RTN","PSOORFI2",168,0)
 Q
"RTN","PSOORFI3")
0^45^B74814603
"RTN","PSOORFI3",1,0)
PSOORFI3 ;BIR/RTR-finish CPRS orders by Clinic ;11/09/98
"RTN","PSOORFI3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**15,27,32,46,84,99,130,117,139,172,225**;DEC 1997;Build 29
"RTN","PSOORFI3",3,0)
 ;PPPPDA1-1374,SC(-2675,40.8-728,51.2-2226,50.607-2221,55-2228,PSSLOCK-2789,DPT-10035,ORX2-867
"RTN","PSOORFI3",4,0)
 ;
"RTN","PSOORFI3",5,0)
 K ^TMP($J,"PSOCL"),^TMP($J,"PSOCLX"),PSOCLIN,PSOCLINF,PSOXINST
"RTN","PSOORFI3",6,0)
 N PSOCFLAG,PSONPTRX,PSOINPTR,PSCLP,PSOCLINS,PSOSTC,PSOLGD,PSODIEN,PSOCTMP
"RTN","PSOORFI3",7,0)
 K DIR S DIR(0)="SMB^C:CLINIC;S:SORT GROUP;E:EXIT",DIR("A")="Select By",DIR("B")="Clinic",DIR("?",1)="Enter 'C' to process orders for one individual Clinic,"
"RTN","PSOORFI3",8,0)
 S DIR("?",2)="      'S' to process orders for all Clinics associated with a Sort Group,",DIR("?",3)="      '^' or 'E' to exit" S DIR("?")=" "
"RTN","PSOORFI3",9,0)
 W ! D ^DIR K DIR I $D(DTOUT)!($D(DUOUT))!(Y="E") W ! G EXIT
"RTN","PSOORFI3",10,0)
 I Y="S" G SORT
"RTN","PSOORFI3",11,0)
CLIN W ! K DIC S DIC="^SC(",DIC(0)="QEAMZ",DIC("A")="Select CLINIC: " D ^DIC K DIC I Y<1!($D(DTOUT))!($D(DUOUT)) G EXIT
"RTN","PSOORFI3",12,0)
 S PSOCLIN=+Y,PSOCLINF=1 D CHECK I $G(PSOCFLAG) D INSTNM^PSOORFI2 W !!,"You are signed in under the "_$G(PSODINST)_" CPRS Ordering",!,"Institution, which does not match the Institution for this Clinic!",! K PSODINST G CLIN
"RTN","PSOORFI3",13,0)
 S ^TMP($J,"PSOCL",PSOCLIN)=PSOCLIN K PSOCLIN G START
"RTN","PSOORFI3",14,0)
SORT W ! K DIC S DIC="^PS(59.8,",DIC(0)="QEAMZ",DIC("A")="Select CLINIC SORT GROUP: " D ^DIC K DIC I Y<1!($D(DTOUT))!($D(DUOUT)) G EXIT
"RTN","PSOORFI3",15,0)
 S PSOCLINS=+Y
"RTN","PSOORFI3",16,0)
 K ^TMP($J,"PSOCL"),^TMP($J,"PSOCLX") F PSCLP=0:0 S PSCLP=$O(^PS(59.8,PSOCLINS,1,PSCLP)) Q:'PSCLP  S PSOSTC=+$P($G(^PS(59.8,PSOCLINS,1,PSCLP,0)),"^") S:$G(PSOSTC)&($D(^SC(PSOSTC,0))) ^TMP($J,"PSOCL",PSOSTC)=PSOSTC
"RTN","PSOORFI3",17,0)
 I '$O(^TMP($J,"PSOCL",0)) W !!,"There are no Clinics associated with this Sort Group!",! K ^TMP($J,"PSOCL") G SORT
"RTN","PSOORFI3",18,0)
 F PSCLP=0:0 S PSCLP=$O(^TMP($J,"PSOCL",PSCLP)) Q:'PSCLP  S PSOCLIN=PSCLP D CHECK I $G(PSOCFLAG) S ^TMP($J,"PSOCLX",PSCLP)=PSCLP K ^TMP($J,"PSOCL",PSCLP)
"RTN","PSOORFI3",19,0)
 I $O(^TMP($J,"PSOCLX",0)) H 1 W @IOF W !,"Orders for these Clinics in the Sort Group will not be displayed for Finishing",!,"because the CPRS Ordering Institution does not match the Institution that is",!,"associated with the Clinic:",! D
"RTN","PSOORFI3",20,0)
 .F PSCLP=0:0 S PSCLP=$O(^TMP($J,"PSOCLX",PSCLP)) Q:'PSCLP  D:($Y+4)>IOSL  W !,$P($G(^SC(PSCLP,0)),"^")
"RTN","PSOORFI3",21,0)
 ..W ! K DIR S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR W @IOF
"RTN","PSOORFI3",22,0)
 I $O(^TMP($J,"PSOCLX",0)) D EOP
"RTN","PSOORFI3",23,0)
 K ^TMP($J,"PSOCLX") I '$O(^TMP($J,"PSOCL",0)) W !!,"There are no Clinics that have a matching Institution!",! D EOP G SORT
"RTN","PSOORFI3",24,0)
 ;
"RTN","PSOORFI3",25,0)
 S PSOCLINF=2
"RTN","PSOORFI3",26,0)
START K MEDP,MEDA,PSOQUIT,POERR("QFLG"),POERR("DFLG"),DIR
"RTN","PSOORFI3",27,0)
 G:'$O(^TMP($J,"PSOCL",0)) EXIT
"RTN","PSOORFI3",28,0)
 S PATA=0 F PSOCLIN=0:0 S PSOCLIN=$O(^TMP($J,"PSOCL",PSOCLIN)) Q:'PSOCLIN!($G(POERR("QFLG")))  F PSOLGD=0:0 S PSOLGD=$O(^PS(52.41,"ACL",PSOCLIN,PSOLGD)) Q:'PSOLGD!($G(POERR("QFLG")))  D
"RTN","PSOORFI3",29,0)
 .F PSODIEN=0:0 S PSODIEN=$O(^PS(52.41,"ACL",PSOCLIN,PSOLGD,PSODIEN)) Q:'PSODIEN!($G(POERR("QFLG")))  D
"RTN","PSOORFI3",30,0)
 ..I $P($G(^PS(52.41,PSODIEN,0)),"^",3)'="NW",$P($G(^(0)),"^",3)'="RNW",$P($G(^(0)),"^",3)'="RF" Q
"RTN","PSOORFI3",31,0)
 ..I $G(PSOPINST)'=$P($G(^PS(52.41,PSODIEN,"INI")),"^") Q
"RTN","PSOORFI3",32,0)
 ..Q:$G(PAT($P(^PS(52.41,PSODIEN,0),"^",2)))=$P(^PS(52.41,PSODIEN,0),"^",2)  S PAT=$P(^PS(52.41,PSODIEN,0),"^",2)
"RTN","PSOORFI3",33,0)
 ..I PAT'=PATA,$O(PSORX("PSOL",0))!($D(RXRS)) D LBL^PSOORFIN
"RTN","PSOORFI3",34,0)
 ..D LK^PSOORFIN I $G(POERR("QFLG")) K POERR("QFLG") S PSOLK=1,PAT(PAT)=PAT Q
"RTN","PSOORFI3",35,0)
 ..I $$CHK^PSODPT(PAT_"^"_$P($G(^DPT(PAT,0)),"^"),1,1)<0 S PSOLK=1,PAT(PAT)=PAT S X=PAT D ULP^PSOORFIN Q
"RTN","PSOORFI3",36,0)
 ..S (PSODFN,Y)=PAT_"^"_$P($G(^DPT(+$G(PAT),0)),"^"),PATA=PAT
"RTN","PSOORFI3",37,0)
 ..D:'$G(MEDA) PROFILE^PSOORFI2 S Y=PSODFN I $G(MEDP) K PSOFIN S POERR("QFLG")=0 S PSONOLCK=1,PSOPTLOK=PAT D OERR^PSORX1 S PSOFIN=1 D QU^PSOORFIN S X=PSOPTLOK D KLLP^PSOORFIN,ULP^PSOORFIN,KLL^PSOORFIN Q
"RTN","PSOORFI3",38,0)
 ..D SDFN^PSOORFIN D POST^PSOORFI1 I $G(PSOQFLG)!($G(PSOQUIT)) S:$G(PSOQUIT) POERR("QFLG")=1 S:$G(PSOQFLG) PAT(PAT)=PAT S X=PAT D ULP^PSOORFIN K PSOQFLG Q
"RTN","PSOORFI3",39,0)
 ..S PAT(PAT)=PAT
"RTN","PSOORFI3",40,0)
 ..F ORD=0:0 S ORD=$O(^PS(52.41,"AOR",PAT,PSOPINST,ORD)) Q:'ORD!($G(POERR("QFLG")))  I '$P($G(^PS(52.41,ORD,0)),"^",23) D
"RTN","PSOORFI3",41,0)
 ...S PSODFN=PAT D NOW^%DTC S TM=$E(%,1,12),TM1=$P(TM,".",2),X="PPPPDA1" X ^%ZOSF("TEST") S:$T X=$$PDA^PPPPDA1(PSODFN)
"RTN","PSOORFI3",42,0)
 ...D LK1^PSOORFIN,ORD^PSOORFIN S X=PAT D ULP^PSOORFIN
"RTN","PSOORFI3",43,0)
 I $O(PSORX("PSOL",0))!($D(RXRS)) D LBL^PSOORFIN
"RTN","PSOORFI3",44,0)
 ;
"RTN","PSOORFI3",45,0)
EXIT K ^TMP($J,"PSOCL"),^TMP($J,"PSOCLX"),PSOCLIN,PSOCLINF,PSOXINST G EX^PSOORFIN
"RTN","PSOORFI3",46,0)
 Q
"RTN","PSOORFI3",47,0)
CHECK ; check Institution
"RTN","PSOORFI3",48,0)
 K PSOXINST,PSOCFLAG
"RTN","PSOORFI3",49,0)
 I $P($G(^SC(PSOCLIN,0)),"^",4),$P($G(^(0)),"^",4)'=$G(PSOPINST) S PSOCFLAG=1 Q
"RTN","PSOORFI3",50,0)
 I $P($G(^SC(PSOCLIN,0)),"^",4) Q
"RTN","PSOORFI3",51,0)
 S PSONPTRX=$P($G(^SC(PSOCLIN,0)),"^",15)
"RTN","PSOORFI3",52,0)
 I '$G(PSONPTRX) S PSONPTRX=$O(^DG(40.8,0))
"RTN","PSOORFI3",53,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSOORFI3",54,0)
 S PSOINPTR=+$$SITE^VASITE(DT,PSONPTRX) I PSOINPTR'=$G(PSOPINST) S PSOCFLAG=1
"RTN","PSOORFI3",55,0)
 Q
"RTN","PSOORFI3",56,0)
EOP W ! K DIR S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR
"RTN","PSOORFI3",57,0)
 Q
"RTN","PSOORFI3",58,0)
L1 ;Lock single order
"RTN","PSOORFI3",59,0)
 I '$G(ORD) Q
"RTN","PSOORFI3",60,0)
 K PSOMSG D PSOL^PSSLOCK(+ORD_"S") I '$G(PSOMSG) W !!,$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"This Order is being edited by another person."),! K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR
"RTN","PSOORFI3",61,0)
 Q
"RTN","PSOORFI3",62,0)
UL1 ;Unlock single order
"RTN","PSOORFI3",63,0)
 I '$G(ORD) Q
"RTN","PSOORFI3",64,0)
 I '$D(^PS(52.41,ORD,0)) D  Q
"RTN","PSOORFI3",65,0)
 . D UNLK1^ORX2(+$G(OR0))
"RTN","PSOORFI3",66,0)
 . Q
"RTN","PSOORFI3",67,0)
 D PSOUL^PSSLOCK(+ORD_"S")
"RTN","PSOORFI3",68,0)
 Q
"RTN","PSOORFI3",69,0)
DOSE ;pending orders
"RTN","PSOORFI3",70,0)
 K DOENT S DS=1
"RTN","PSOORFI3",71,0)
 F I=0:0 S I=$O(^PS(52.41,ORD,1,I)) Q:'I  S DOSE=$G(^PS(52.41,ORD,1,I,1)),DOSE1=$G(^(2)) D  D DOSE1
"RTN","PSOORFI3",72,0)
 .S PSONEW("DOSE",I)=$P(DOSE1,"^"),PSONEW("DOSE ORDERED",I)=$P(DOSE1,"^",2),PSONEW("UNITS",I)=$P(DOSE,"^",9),PSONEW("NOUN",I)=$P(DOSE,"^",5)
"RTN","PSOORFI3",73,0)
 .S:$P(DOSE,"^",9) UNITS=$P(^PS(50.607,$P(DOSE,"^",9),0),"^")
"RTN","PSOORFI3",74,0)
 .S PSONEW("VERB",I)=$P(DOSE,"^",10),PSONEW("ROUTE",I)=$P(DOSE,"^",8)
"RTN","PSOORFI3",75,0)
 .S:$P(DOSE,"^",8) ROUTE=$P(^PS(51.2,$P(DOSE,"^",8),0),"^")
"RTN","PSOORFI3",76,0)
 .S PSONEW("SCHEDULE",I)=$P(DOSE,"^"),PSONEW("DURATION",I)=$P(DOSE,"^",2)
"RTN","PSOORFI3",77,0)
 .S DOENT=$G(DOENT)+1 S PSONEW("CONJUNCTION",I)=$S($P(DOSE,"^",6)="A":"AND",$P(DOSE,"^",6)="S":"THEN",$P(DOSE,"^",6)="X":"EXCEPT",1:"")
"RTN","PSOORFI3",78,0)
 .I 'PSONEW("DOSE ORDERED",I),$G(PSONEW("VERB",I))]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="               Verb: "_$G(PSONEW("VERB",I))
"RTN","PSOORFI3",79,0)
 .S:$G(DS) IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (3)"
"RTN","PSOORFI3",80,0)
 S PSONEW("ENT")=DOENT K DOSE,DOSE1,I,UNITS,ROUTE,DOENT
"RTN","PSOORFI3",81,0)
 Q
"RTN","PSOORFI3",82,0)
DOSE1 I $G(DS)=1 S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"        *Dosage:" D FMD G DU
"RTN","PSOORFI3",83,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="            *Dosage:" D FMD
"RTN","PSOORFI3",84,0)
DU I 'PSONEW("DOSE ORDERED",I),$P($G(^PS(55,PSODFN,"LAN")),"^") S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  Oth. Lang. Dosage: "_$G(PSONEW("ODOSE",I))
"RTN","PSOORFI3",85,0)
 I PSONEW("DOSE ORDERED",I),$G(PSONEW("VERB",I))]"" D
"RTN","PSOORFI3",86,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="               Verb: "_$G(PSONEW("VERB",I))
"RTN","PSOORFI3",87,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="     Dispense Units: "_$S($E(PSONEW("DOSE ORDERED",I),1)=".":"0",1:"")_PSONEW("DOSE ORDERED",I)
"RTN","PSOORFI3",88,0)
 I PSONEW("NOUN",I) S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="               Noun: "_PSONEW("NOUN",I)
"RTN","PSOORFI3",89,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="             *Route: "_$G(ROUTE)
"RTN","PSOORFI3",90,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="          *Schedule: "_PSONEW("SCHEDULE",I)
"RTN","PSOORFI3",91,0)
 I $P(DOSE,"^",2)]"" D
"RTN","PSOORFI3",92,0)
 .S DUR=$S($E($P(DOSE,"^",2),1)'?.N:$E($P(DOSE,"^",2),2,99)_$E($P(DOSE,"^",2),1),1:$P(DOSE,"^",2))
"RTN","PSOORFI3",93,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="          *Duration: "_DUR_" ("_$S($P(DOSE,"^",2)["M":"MINUTES",$P(DOSE,"^",2)["H":"HOURS",$P(DOSE,"^",2)["L":"MONTHS",$P(DOSE,"^",2)["W":"WEEKS",1:"DAYS")_")"
"RTN","PSOORFI3",94,0)
 I $P(DOSE,"^",6)]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="       *Conjunction: "_$S($P(DOSE,"^",6)="A":"AND",$P(DOSE,"^",6)="S":"THEN",$P(DOSE,"^",6)="X":"EXCEPT",1:"")
"RTN","PSOORFI3",95,0)
 Q
"RTN","PSOORFI3",96,0)
DOSE2 ;displays pending order after edits
"RTN","PSOORFI3",97,0)
 S DS=1
"RTN","PSOORFI3",98,0)
 F I=1:1:PSONEW("ENT") Q:'I  D  D DOSE3 K COJ
"RTN","PSOORFI3",99,0)
 .S:$G(PSONEW("UNITS",I))]"" UNITS=$P(^PS(50.607,PSONEW("UNITS",I),0),"^") S:$G(PSONEW("ROUTE",I))]"" ROUTE=$P(^PS(51.2,PSONEW("ROUTE",I),0),"^")
"RTN","PSOORFI3",100,0)
 .S DUR=$G(PSONEW("DURATION",I)) S:$G(PSONEW("CONJUNCTION",I))]"" COJ=PSONEW("CONJUNCTION",I)
"RTN","PSOORFI3",101,0)
 .S NOUN=PSONEW("NOUN",I),VERB=$G(PSONEW("VERB",I))
"RTN","PSOORFI3",102,0)
 .I 'PSONEW("DOSE ORDERED",I),$P($G(^PS(55,PSODFN,"LAN")),"^") S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  Oth. Lang. Dosage: "_$G(PSONEW("ODOSE",I))
"RTN","PSOORFI3",103,0)
 .I '$G(PSONEW("DOSE ORDERED",I)),$G(PSONEW("VERB",I))]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="               Verb: "_$G(PSONEW("VERB",I))
"RTN","PSOORFI3",104,0)
 .S:$G(DS) IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (3)"
"RTN","PSOORFI3",105,0)
 K I,UNITS,ROUTE,DUR,COJ,VERB,NOUN
"RTN","PSOORFI3",106,0)
 Q
"RTN","PSOORFI3",107,0)
DOSE3 I $G(DS)=1 S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"        *Dosage:" D FMD G DO
"RTN","PSOORFI3",108,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="            *Dosage:" D FMD
"RTN","PSOORFI3",109,0)
DO I 'PSONEW("DOSE ORDERED",I),$P($G(^PS(55,PSODFN,"LAN")),"^") S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  Oth. Lang. Dosage: "_$G(PSONEW("ODOSE",I))
"RTN","PSOORFI3",110,0)
 I $G(PSONEW("DOSE ORDERED",I)),$G(PSONEW("VERB",I))]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="               Verb: "_$G(PSONEW("VERB",I))
"RTN","PSOORFI3",111,0)
 I $G(PSONEW("DOSE ORDERED",I)) S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="     Dispense Units: "_$S($E(PSONEW("DOSE ORDERED",I),1)=".":"0",1:"")_PSONEW("DOSE ORDERED",I)
"RTN","PSOORFI3",112,0)
 I $G(PSONEW("DOSE ORDERED",I)) S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="               NOUN: "_PSONEW("NOUN",I)
"RTN","PSOORFI3",113,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="             *Route: "_$G(ROUTE)
"RTN","PSOORFI3",114,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="          *Schedule: "_PSONEW("SCHEDULE",I)
"RTN","PSOORFI3",115,0)
 I $G(DUR)]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="          *Duration: "_DUR_" ("_$S(DUR["M":"MINUTES",DUR["H":"HOURS",DUR["L":"MONTHS",DUR["W":"WEEKS",1:"DAYS")_")"
"RTN","PSOORFI3",116,0)
 I $G(COJ)]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="       *Conjunction: "_$S(COJ="A":"AND",COJ="T":"THEN",COJ="X":"EXCEPT",1:"")
"RTN","PSOORFI3",117,0)
 Q
"RTN","PSOORFI3",118,0)
FMD Q:$G(PSONEW("DOSE",II))']""  S MIG=PSONEW("DOSE",II)
"RTN","PSOORFI3",119,0)
 I $E(MIG,1)=".",$G(PSONEW("DOSE ORDERED",II)) S MIG="0"_MIG
"RTN","PSOORFI3",120,0)
 F SG=1:1:$L(MIG," ") S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P(MIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",20)=" " S ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P(MIG," ",SG)
"RTN","PSOORFI3",121,0)
 I $G(UNITS)]"" S:$L(^TMP("PSOPO",$J,IEN,0)_" ("_UNITS_")")>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",20)=" " S ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" ("_UNITS_")"
"RTN","PSOORFI3",122,0)
 K DS,MIG,SG
"RTN","PSOORFI3",123,0)
 I '$G(PSONEW("DOSE ORDERED",II)),$P($G(^PS(55,PSODFN,"LAN")),"^") D LAN^PSOORED5
"RTN","PSOORFI3",124,0)
 Q
"RTN","PSOORFI3",125,0)
SQR ;
"RTN","PSOORFI3",126,0)
 D SQR^PSOORFIN
"RTN","PSOORFI3",127,0)
 Q
"RTN","PSOORFI3",128,0)
SQN ;
"RTN","PSOORFI3",129,0)
 K MAXRF,PSOSIG,MPSDY,PSOMAX,STA,PSORX0,ORCHK,ORDRG
"RTN","PSOORFI3",130,0)
 I $G(PSOQUIT) S PSOQQ=1 K PSOQUIT
"RTN","PSOORFI3",131,0)
 Q
"RTN","PSOORFI5")
0^46^B18224487
"RTN","PSOORFI5",1,0)
PSOORFI5 ;BIR/SJA-finish cprs orders ;11/06/06 10:49am
"RTN","PSOORFI5",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**225**;DEC 1997;Build 29
"RTN","PSOORFI5",3,0)
 ;External references UL^PSSLOCK supported by DBIA 2789
"RTN","PSOORFI5",4,0)
 ;External reference to ^DPT supported by DBIA 10035
"RTN","PSOORFI5",5,0)
 ;
"RTN","PSOORFI5",6,0)
FLG W ! K MEDP,MEDA,POERR("DFLG"),DIR D KQ S PSOSORT="FLAGGED^FLAGGED"
"RTN","PSOORFI5",7,0)
 S LG=0,PATA=0 F  S LG=$O(^PS(52.41,"AD",LG)) Q:'LG!($G(POERR("QFLG")))  F PSOD=0:0 S PSOD=$O(^PS(52.41,"AD",LG,PSOPINST,PSOD)) Q:'PSOD!($G(POERR("QFLG")))  D
"RTN","PSOORFI5",8,0)
 .Q:'$D(^PS(52.41,PSOD,0))!('$P($G(^PS(52.41,PSOD,0)),"^",23))
"RTN","PSOORFI5",9,0)
 .Q:$G(PAT($P(^PS(52.41,PSOD,0),"^",2)))=$P(^PS(52.41,PSOD,0),"^",2)  S PAT=$P(^PS(52.41,PSOD,0),"^",2)
"RTN","PSOORFI5",10,0)
 .I PAT'=PATA,$O(PSORX("PSOL",0))!($D(RXRS)) D LBL^PSOORFIN
"RTN","PSOORFI5",11,0)
 .D LK I $G(POERR("QFLG")) K POERR("QFLG") S PSOLK=1,PAT(PAT)=PAT Q
"RTN","PSOORFI5",12,0)
 .I $$CHK^PSODPT(PAT_"^"_$P($G(^DPT(PAT,0)),"^"),1,1)<0 S PSOLK=1,PAT(PAT)=PAT S X=PAT D ULP K PSOQFLG,PSOQQ Q
"RTN","PSOORFI5",13,0)
 .S (PSODFN,Y)=PAT_"^"_$P($G(^DPT(PAT,0)),"^"),PATA=PAT
"RTN","PSOORFI5",14,0)
 .D:'$G(MEDA) PROFILE^PSOORFI2 S Y=PSODFN I $G(MEDP) D SPL D OERR^PSORX1 S PSOFIN=1 D QU S X=PSOPTLOK D KLLP,ULP,KLL Q
"RTN","PSOORFI5",15,0)
 .D SDFN D POST^PSOORFI1 I $G(PSOQFLG)!($G(PSOQUIT)) S:$G(PSOQUIT) POERR("QFLG")=1 S:$G(PSOQFLG) PAT(PAT)=PAT S X=PAT D ULP K PSOQFLG Q
"RTN","PSOORFI5",16,0)
 .S PAT(PAT)=PAT
"RTN","PSOORFI5",17,0)
 .F ORD=0:0 S ORD=$O(^PS(52.41,"AOR",PAT,PSOPINST,ORD)) Q:'ORD!($G(POERR("QFLG")))!($G(PSOQQ))  D
"RTN","PSOORFI5",18,0)
 ..I $P($G(^PS(52.41,ORD,0)),"^",23) D PP,LK1,ORD^PSOORFIN
"RTN","PSOORFI5",19,0)
 .S X=PAT D ULP K PSOQQ
"RTN","PSOORFI5",20,0)
 I $O(PSORX("PSOL",0))!($D(RXRS)) D LBL^PSOORFIN
"RTN","PSOORFI5",21,0)
 I $G(PSOQUIT) K PSOQUIT D EX G ^PSOORFIN
"RTN","PSOORFI5",22,0)
 G EX
"RTN","PSOORFI5",23,0)
 ;
"RTN","PSOORFI5",24,0)
PRI ; Called from PSOORFIN due to it's routine size.
"RTN","PSOORFI5",25,0)
 K DIR S PSOSORT="PRIORITY"
"RTN","PSOORFI5",26,0)
 S DIR("A")="Select Priority",DIR(0)="SBM^S:STAT;E:EMERGENCY;R:ROUTINE",DIR("B")="ROUTINE"
"RTN","PSOORFI5",27,0)
 D ^DIR G:$D(DIRUT) EX S PSOSORT=PSOSORT_"^"_Y,PSRT=Y
"RTN","PSOORFI5",28,0)
 S LG=0,PATA=0 F  S LG=$O(^PS(52.41,"AD",LG)) Q:'LG!($G(POERR("QFLG")))  F PSOD=0:0 S PSOD=$O(^PS(52.41,"AD",LG,PSOPINST,PSOD)) Q:'PSOD!($G(POERR("QFLG")))  D
"RTN","PSOORFI5",29,0)
 .Q:$P($G(^PS(52.41,PSOD,0)),"^",23)
"RTN","PSOORFI5",30,0)
 .Q:$G(PAT($P(^PS(52.41,PSOD,0),"^",2)))=$P(^PS(52.41,PSOD,0),"^",2)  S PAT=$P(^PS(52.41,PSOD,0),"^",2)
"RTN","PSOORFI5",31,0)
 .I PAT'=PATA,$O(PSORX("PSOL",0))!($D(RXRS)) D LBL^PSOORFIN
"RTN","PSOORFI5",32,0)
 .I '$O(^PS(52.41,"AP",PAT,PSRT,0)) S PSOLK=1,PAT(PAT)=PAT Q
"RTN","PSOORFI5",33,0)
 .D PRI^PSOORFI2 I $G(PSZFIN) S PSOLK=1,PAT(PAT)=PAT Q
"RTN","PSOORFI5",34,0)
 .D LK I $G(POERR("QFLG")) K POERR("QFLG") S PSOLK=1,PAT(PAT)=PAT Q
"RTN","PSOORFI5",35,0)
 .I $$CHK^PSODPT(PAT_"^"_$P($G(^DPT(PAT,0)),"^"),1,1)<0 S PSOLK=1,PAT(PAT)=PAT S X=PAT D ULP Q
"RTN","PSOORFI5",36,0)
 .S (PSODFN,Y)=PAT_"^"_$P($G(^DPT(PAT,0)),"^"),PATA=PAT
"RTN","PSOORFI5",37,0)
 .D:'$G(MEDA) PROFILE^PSOORFI2 S Y=PSODFN I $G(MEDP) D SPL D OERR^PSORX1 S PSOFIN=1 D QU S X=PSOPTLOK D KLLP,ULP,KLL Q
"RTN","PSOORFI5",38,0)
 .D SDFN D POST^PSOORFI1 I $G(PSOQFLG)!($G(PSOQUIT)) S:$G(PSOQUIT) POERR("QFLG")=1 S:$G(PSOQFLG) PAT(PAT)=PAT S X=PAT D ULP K PSOQFLG Q
"RTN","PSOORFI5",39,0)
 .D PP S ORD=0 D @PSRT S PAT(PAT)=PAT
"RTN","PSOORFI5",40,0)
 .S X=PAT D ULP
"RTN","PSOORFI5",41,0)
 I $O(PSORX("PSOL",0))!($D(RXRS)) D LBL^PSOORFIN
"RTN","PSOORFI5",42,0)
 I $G(PSOQUIT) K PSOQUIT D EX G ^PSOORFIN
"RTN","PSOORFI5",43,0)
EX D EX^PSOORFI1
"RTN","PSOORFI5",44,0)
 Q
"RTN","PSOORFI5",45,0)
LK D LOCK^PSOORFI1
"RTN","PSOORFI5",46,0)
 Q
"RTN","PSOORFI5",47,0)
LK1 D LOCK1^PSOORFI1 Q
"RTN","PSOORFI5",48,0)
QU I $G(PSOQUIT) S POERR("QFLG")=1 K PSOQUIT
"RTN","PSOORFI5",49,0)
 S:$G(PSOQFLG) PAT(PAT)=PAT
"RTN","PSOORFI5",50,0)
 Q
"RTN","PSOORFI5",51,0)
ULP K PSORX("MAIL/WINDOW"),PSORX("METHOD OF PICK-UP")
"RTN","PSOORFI5",52,0)
 D CLEAN^PSOVER1
"RTN","PSOORFI5",53,0)
 I '$G(X) Q
"RTN","PSOORFI5",54,0)
 D UL^PSSLOCK(X) Q
"RTN","PSOORFI5",55,0)
KLL K PSOPTLOK
"RTN","PSOORFI5",56,0)
 Q
"RTN","PSOORFI5",57,0)
KLLP K PSONOLCK
"RTN","PSOORFI5",58,0)
 Q
"RTN","PSOORFI5",59,0)
SPL D SPL^PSOORFI4
"RTN","PSOORFI5",60,0)
 Q
"RTN","PSOORFI5",61,0)
SDFN S PSODFN=+$G(PSODFN)
"RTN","PSOORFI5",62,0)
 Q
"RTN","PSOORFI5",63,0)
PP D PP^PSOORFI4
"RTN","PSOORFI5",64,0)
 Q
"RTN","PSOORFI5",65,0)
KQ K PSOQUIT,POERR("QFLG")
"RTN","PSOORFI5",66,0)
 Q
"RTN","PSOORFI5",67,0)
 ;
"RTN","PSOORFI5",68,0)
LMDISP(ORD) ; Backdoor ListManager Display of Flag/Unflag Informaiton
"RTN","PSOORFI5",69,0)
 N FLAG
"RTN","PSOORFI5",70,0)
 K FLAGLINE S ORD=+$G(ORD) I 'ORD Q
"RTN","PSOORFI5",71,0)
 ;
"RTN","PSOORFI5",72,0)
 I '$G(^PS(52.41,ORD,"FLG")) Q
"RTN","PSOORFI5",73,0)
 ; S X=IORVON_"Flagged"_IORVOFF
"RTN","PSOORFI5",74,0)
 D GETS^DIQ(52.41,ORD,"33;34;35;36;37;38","IE","FLAG")
"RTN","PSOORFI5",75,0)
 S L1="Flagged by "_$E(FLAG(52.41,ORD_",",34,"E"),1,30)_" on "_$$FMTE^XLFDT(FLAG(52.41,ORD_",",33,"I"),2)_": "
"RTN","PSOORFI5",76,0)
 S LEN=80-$L(L1),L1=L1_$E(FLAG(52.41,ORD_",",35,"E"),1,LEN),L2=$E(FLAG(52.41,ORD_",",35,"E"),LEN+1,999)
"RTN","PSOORFI5",77,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=L1,FLAGLINE(IEN)=7
"RTN","PSOORFI5",78,0)
 I L2'="" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=L2
"RTN","PSOORFI5",79,0)
 I FLAG(52.41,ORD_",",36,"I")'="" D
"RTN","PSOORFI5",80,0)
 . S L1="Unflagged by "_$E(FLAG(52.41,ORD_",",37,"E"),1,30)_" on "_$$FMTE^XLFDT(FLAG(52.41,ORD_",",36,"I"),2)_": "
"RTN","PSOORFI5",81,0)
 . S LEN=80-$L(L1),L1=L1_$E(FLAG(52.41,ORD_",",38,"E"),1,LEN),L2=$E(FLAG(52.41,ORD_",",38,"E"),LEN+1,999)
"RTN","PSOORFI5",82,0)
 . S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=L1,FLAGLINE(IEN)=9
"RTN","PSOORFI5",83,0)
 . I L2'="" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=L2
"RTN","PSOORFI5",84,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" "
"RTN","PSOORFI5",85,0)
 Q
"RTN","PSOORFI6")
0^56^B23497771
"RTN","PSOORFI6",1,0)
PSOORFI6 ;BIR/SJA-finish cprs orders cont. ;01/05/07
"RTN","PSOORFI6",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**225**;DEC 1997;Build 29
"RTN","PSOORFI6",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORFI6",4,0)
 ;External references PSOL, and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOORFI6",5,0)
 ;External reference to ^DPT supported by DBIA 10035
"RTN","PSOORFI6",6,0)
 ;
"RTN","PSOORFI6",7,0)
DC N ACTION,LST,PSI,PSODFLG,PSONOORS,PSOOPT
"RTN","PSOORFI6",8,0)
 N VALMCNT W ! K DIR,DUOUT,DIROUT,DTOUT,PSOELSE
"RTN","PSOORFI6",9,0)
 I '$G(PSOERR("DEAD")) S PSOELSE=1 D PDATA Q:$D(DUOUT)!$D(DTOUT)  D  Q:$D(DIRUT)
"RTN","PSOORFI6",10,0)
 .D NOOR^PSOCAN4 Q:$D(DIRUT)
"RTN","PSOORFI6",11,0)
 .S DIR("A")="Comments",DIR(0)="F^10:75",DIR("B")="Per Pharmacy Request" D ^DIR K DIR
"RTN","PSOORFI6",12,0)
 I '$G(PSOELSE) K PSOELSE S PSONOOR="A" D DE^PSOORFI2 I '$G(ACTION)!('$D(PSODFLG)) S VALMBCK="R" Q
"RTN","PSOORFI6",13,0)
 K PSOELSE I $D(DIRUT) K DIRUT,DUOUT,DTOUT,Y Q
"RTN","PSOORFI6",14,0)
 S ACOM=Y
"RTN","PSOORFI6",15,0)
 S INCOM=ACOM,PSONOORS=PSONOOR D DE^PSOORFI2
"RTN","PSOORFI6",16,0)
 I '$G(ACTION)!('$D(PSODFLG)) Q
"RTN","PSOORFI6",17,0)
 S PSONOOR=PSONOORS D RTEST D SPEED D ULP^PSOCAN
"RTN","PSOORFI6",18,0)
 K PSOCAN,ACOM,INCOM,ACTION,LINE,PSONOOR,PSOSDXY,PSONOORS,PSOOPT,RXCNT,REA,RX,PSODA,DRG
"RTN","PSOORFI6",19,0)
 S Y=-1
"RTN","PSOORFI6",20,0)
 Q
"RTN","PSOORFI6",21,0)
PSPEED S (YY,PSODA)=$P(PSOSD(STA,DRG),"^"),RX=$P($G(^PSRX(PSODA,0)),"^") D SPEED1 Q:PSPOP!($D(PSINV(RX)))
"RTN","PSOORFI6",22,0)
 Q:$G(SPEED)&(REA="R")
"RTN","PSOORFI6",23,0)
SHOW S DRG=+$P(^PSRX(PSODA,0),"^",6),DRG=$S($D(^PSDRUG(DRG,0)):$P(^(0),"^"),1:"")
"RTN","PSOORFI6",24,0)
 S LC=0 W !,$P(^PSRX(PSODA,0),"^"),"  ",DRG,?52,$S($D(^DPT(+$P(^PSRX(PSODA,0),"^",2),0)):$P(^(0),"^"),1:"PATIENT UNKNOWN")
"RTN","PSOORFI6",25,0)
 I REA="C" W !?25,"Rx to be Discontinued",! Q
"RTN","PSOORFI6",26,0)
 W !?21,"*** Rx to be Reinstated ***",!
"RTN","PSOORFI6",27,0)
 Q
"RTN","PSOORFI6",28,0)
SPEED1 S PSPOP=0 I $G(PSODIV),+$P($G(^PSRX(PSODA,2)),"^",9)'=$G(PSOSITE) D:'$G(SPEED) DIV^PSOCAN
"RTN","PSOORFI6",29,0)
 K STAT S STAT=+$P(^PSRX(PSODA,"STA"),"^"),REA=$E("C00CCCCCCCCCR000C",STAT+1)
"RTN","PSOORFI6",30,0)
 Q:$G(SPEED)&(REA="R")
"RTN","PSOORFI6",31,0)
 I REA="R",$P($G(^PSRX(PSODA,"PKI")),"^") S PKI=1 S PSINV(RX)="" Q
"RTN","PSOORFI6",32,0)
 I REA=0!(PSPOP)!($P(^PSRX(+YY,"STA"),"^")>12),$P(^("STA"),"^")<16 S PSINV(RX)="" Q
"RTN","PSOORFI6",33,0)
 S:REA'=0&('PSPOP) PSCAN(RX)=PSODA_"^"_REA,RXCNT=$G(RXCNT)+1
"RTN","PSOORFI6",34,0)
 Q
"RTN","PSOORFI6",35,0)
SPEED N PKI K PSINV,PSCAN S PSODA=IN I $D(^PSRX(PSODA,0)) S YY=PSODA,RX=$P(^(0),"^") S:PSODA<0 PSINV(RX)="" D:PSODA>0 SPEED1
"RTN","PSOORFI6",36,0)
 G:'$D(PSCAN) INVALD S II="",RXCNT=0 F  S II=$O(PSCAN(II)) Q:II=""  S PSODA=+PSCAN(II),REA=$P(PSCAN(II),"^",2),RXCNT=RXCNT+1 D SHOW
"RTN","PSOORFI6",37,0)
 ;
"RTN","PSOORFI6",38,0)
ASK G:'$D(PSCAN) INVALD W ! S DIR("A")="OK to "_$S($G(RXCNT)>1:"Change Status",REA="C":"Discontinue the active order",1:"Reinstate"),DIR(0)="Y",DIR("B")="N"
"RTN","PSOORFI6",39,0)
 D ^DIR K DIR I $D(DIRUT) S:$O(PSOSDX(0)) PSOSDXY=1 Q
"RTN","PSOORFI6",40,0)
 I 'Y S:$O(PSOSDX(0)) PSOSDXY=1 K PSCAN D INVALD Q
"RTN","PSOORFI6",41,0)
 S RX="" F  S RX=$O(PSCAN(RX)) Q:RX=""  D PSOL^PSSLOCK(+PSCAN(RX)) I $G(PSOMSG) D ACT D PSOUL^PSSLOCK(+PSCAN(RX))
"RTN","PSOORFI6",42,0)
 D INVALD
"RTN","PSOORFI6",43,0)
 Q
"RTN","PSOORFI6",44,0)
ACT S DA=+PSCAN(RX),REA=$P(PSCAN(RX),"^",2),II=RX,PSODFN=$P(^PSRX(DA,0),"^",2) I REA="R" D REINS^PSOCAN2 Q
"RTN","PSOORFI6",45,0)
 S PSOOPT=-1 D CAN^PSOCAN
"RTN","PSOORFI6",46,0)
 Q
"RTN","PSOORFI6",47,0)
INVALD K PSCAN Q:'$D(PSINV)  W !! F I=1:1:80 W "="
"RTN","PSOORFI6",48,0)
 W $C(7),!!,"The Following Rx Number(s) Are Invalid Choices, Expired, "_$S($G(PKI):"Digitally Signed",1:""),!,"Discontinued by Provider, or Marked As Deleted:" S II="" F  S II=$O(PSINV(II)) Q:II=""  W !?10,II
"RTN","PSOORFI6",49,0)
 K PSINV I $G(PSOERR)!($G(SPEED)) K DIR,DUOUT,DTOUT,DIRUT S DIR(0)="E",DIR("A")="Press Return to Continue"
"RTN","PSOORFI6",50,0)
 D ^DIR K DIR,DTOUT,DIRUT,DUOUT
"RTN","PSOORFI6",51,0)
KILL D KILL^PSOCAN2
"RTN","PSOORFI6",52,0)
 K PSOMSG,PSOPLCK,PSOWUN,PSOULRX
"RTN","PSOORFI6",53,0)
 Q
"RTN","PSOORFI6",54,0)
RTEST ;
"RTN","PSOORFI6",55,0)
 Q:'$G(LINE)
"RTN","PSOORFI6",56,0)
 N PCIN,PCINFLAG,PCINX
"RTN","PSOORFI6",57,0)
 S PCINFLAG=0 F PCIN=1:1 S PCINX=$P(LINE,",",PCIN) Q:$P(LINE,",",PCIN)']""  D
"RTN","PSOORFI6",58,0)
 .Q:'$G(PCINX)
"RTN","PSOORFI6",59,0)
 .Q:'$G(PSOCAN(PCINX))
"RTN","PSOORFI6",60,0)
 .I $P($G(^PSRX(+$G(PSOCAN(PCINX)),"STA")),"^")'=12,'$G(PCINFLAG) S PSOCANRD=+$P($G(^PSRX($G(PSOCAN(PCINX)),0)),"^",4) S PCINFLAG=1
"RTN","PSOORFI6",61,0)
 I '$G(PCINFLAG) S PSOCANRZ=1
"RTN","PSOORFI6",62,0)
 Q
"RTN","PSOORFI6",63,0)
RTESTA ;
"RTN","PSOORFI6",64,0)
 N PFIN,PFINZ,PFINFLAG
"RTN","PSOORFI6",65,0)
 S PFINFLAG=0 S PFIN="" F  S PFIN=$O(PSOSD(PFIN)) Q:PFIN=""  S PFINZ="" F  S PFINZ=$O(PSOSD(PFIN,PFINZ)) Q:PFINZ=""  D
"RTN","PSOORFI6",66,0)
 .I $G(PFIN)'="PENDING" I $P($G(^PSRX(+$P($G(PSOSD(PFIN,PFINZ)),"^"),"STA")),"^")'=12,'$G(PFINFLAG) S PSOCANRD=+$P($G(^(0)),"^",4),PFINFLAG=1
"RTN","PSOORFI6",67,0)
 I '$G(PFINFLAG) S PSOCANRZ=1
"RTN","PSOORFI6",68,0)
 Q
"RTN","PSOORFI6",69,0)
PDATA Q:$P(^PS(52.41,ORD,0),"^",3)'="RNW"!('$P(^PS(52.41,ORD,0),"^",21))
"RTN","PSOORFI6",70,0)
 S PSI=0,IN=0 F  S PSI=$O(PSOLST(PSI)) Q:'PSI!(IN)  I $P(PSOLST(PSI),"^",2)=$P(^PS(52.41,ORD,0),"^",21) S LINE=PSI,(PSOCAN(PSI),IN)=$P(PSOLST(PSI),"^",2)
"RTN","PSOORFI6",71,0)
 Q:'$G(LINE)
"RTN","PSOORFI6",72,0)
 S:(+$G(^PSRX($P(^PS(52.41,ORD,0),"^",21),"STA"))<9) PSODFLG=1 Q:'$G(PSODFLG)
"RTN","PSOORFI6",73,0)
 D ASKDC S ACTION=Y
"RTN","PSOORFI6",74,0)
 Q
"RTN","PSOORFI6",75,0)
ASKDC W ! K DIR,DUOUT,DIRUT,DTOUT
"RTN","PSOORFI6",76,0)
 S DIR("A")="There is an active Rx for this pending order, Discontinue both (Y/N)",DIR("B")="NO",DIR(0)="Y"
"RTN","PSOORFI6",77,0)
 S DIR("?",1)="Y - Discontinue both pending and active Rx",DIR("?",2)="N - Discontinue pending order only"
"RTN","PSOORFI6",78,0)
 S DIR("?")="'^' - Quit (no action taken)" D ^DIR K DIR Q
"RTN","PSOORFIN")
0^47^B59563720
"RTN","PSOORFIN",1,0)
PSOORFIN ;BIR/SAB-finish cprs orders ;12/21/04 3:24pm
"RTN","PSOORFIN",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**7,15,27,32,44,46,84,106,111,117,131,146,139,195,225**;DEC 1997;Build 29
"RTN","PSOORFIN",3,0)
 ;PSSLOCK-2789,PSDRUG-221,50.7-2223,55-2228,50.606-2174
"RTN","PSOORFIN",4,0)
 D:'$D(PSOPAR) ^PSOLSET I '$D(PSOPAR) D MSG^PSODPT G EX
"RTN","PSOORFIN",5,0)
 D INST^PSOORFI2 I $G(PSOIQUIT) K PSOIQUIT G EX
"RTN","PSOORFIN",6,0)
 I $P($G(PSOPAR),"^",2),'$D(^XUSEC("PSORPH",DUZ)) S PSORX("VERIFY")=1
"RTN","PSOORFIN",7,0)
 S (PSOFIN,POERR)=1
"RTN","PSOORFIN",8,0)
 K PSOBCK,MEDA,MEDP,SRT,DIR D KQ
"RTN","PSOORFIN",9,0)
 S DIR("?")="^D ST^PSOORFI1",DIR("A")="Select By",DIR("B")="PATIENT",DIR(0)="SMB^PA:PATIENT;RT:ROUTE;PR:PRIORITY;CL:CLINIC;FL:FLAG;E:EXIT"
"RTN","PSOORFIN",10,0)
 D ^DIR I $D(DIRUT)!(Y="E") G EX
"RTN","PSOORFIN",11,0)
 G:Y="PA" PAT G:Y="PR" PRI^PSOORFI5 G:Y="CL" ^PSOORFI3 G:Y="FL" FLG^PSOORFI5
"RTN","PSOORFIN",12,0)
 K DIR S PSOSORT="ROUTE"
"RTN","PSOORFIN",13,0)
 S DIR("?")="^D RT^PSOORFI1",DIR("A")="Route",DIR(0)="SBM^W:WINDOW;M:MAIL;C:CLINIC;E:EXIT",DIR("B")="WINDOW"
"RTN","PSOORFIN",14,0)
 D ^DIR G:$D(DIRUT)!(Y="E") EX S PSOSORT=PSOSORT_"^"_Y,PSRT=Y
"RTN","PSOORFIN",15,0)
 S LG=0,PATA=0 F  S LG=$O(^PS(52.41,"AD",LG)) Q:'LG!($G(POERR("QFLG")))  F PSOD=0:0 S PSOD=$O(^PS(52.41,"AD",LG,PSOPINST,PSOD)) Q:'PSOD!($G(POERR("QFLG")))  D
"RTN","PSOORFIN",16,0)
 .Q:$P($G(^PS(52.41,PSOD,0)),"^",23)
"RTN","PSOORFIN",17,0)
 .Q:$G(PAT($P(^PS(52.41,PSOD,0),"^",2)))=$P(^PS(52.41,PSOD,0),"^",2)  S PAT=$P(^PS(52.41,PSOD,0),"^",2)
"RTN","PSOORFIN",18,0)
 .I PAT'=PATA,$O(PSORX("PSOL",0))!($D(RXRS)) D LBL
"RTN","PSOORFIN",19,0)
 .I '$O(^PS(52.41,"AC",PAT,PSRT,0)) S PSOLK=1,PAT(PAT)=PAT Q
"RTN","PSOORFIN",20,0)
 .D RTE^PSOORFI2 I $G(PSZFIN) S PSOLK=1,PAT(PAT)=PAT Q
"RTN","PSOORFIN",21,0)
 .D LK I $G(POERR("QFLG")) K POERR("QFLG") S PSOLK=1,PAT(PAT)=PAT Q
"RTN","PSOORFIN",22,0)
 .I $$CHK^PSODPT(PAT_"^"_$P($G(^DPT(PAT,0)),"^"),1,1)<0 S PSOLK=1,PAT(PAT)=PAT S X=PAT D ULP Q
"RTN","PSOORFIN",23,0)
 .S (PSODFN,Y)=PAT_"^"_$P($G(^DPT(PAT,0)),"^"),PATA=PAT
"RTN","PSOORFIN",24,0)
 .D:'$G(MEDA) PROFILE^PSOORFI2 S Y=PSODFN I $G(MEDP) D SPL D OERR^PSORX1 S PSOFIN=1 D QU S X=PSOPTLOK D KLLP,ULP,KLL Q
"RTN","PSOORFIN",25,0)
 .D SDFN D POST^PSOORFI1 I $G(PSOQFLG)!($G(PSOQUIT)) S:$G(PSOQUIT) POERR("QFLG")=1 S:$G(PSOQFLG) PAT(PAT)=PAT S X=PAT D ULP K PSOQFLG Q
"RTN","PSOORFIN",26,0)
 .D PP S ORD=0 D @PSRT S PAT(PAT)=PAT
"RTN","PSOORFIN",27,0)
 .S X=PAT D ULP
"RTN","PSOORFIN",28,0)
 K POERR("QFLG"),PSOQFLG,PSOPTPST,MAIL,WIN,CLI I $O(PSORX("PSOL",0))!($D(RXRS)) D LBL
"RTN","PSOORFIN",29,0)
 I $G(PSOQUIT) K PSOQUIT D EX G PSOORFIN
"RTN","PSOORFIN",30,0)
EX D EX^PSOORFI1
"RTN","PSOORFIN",31,0)
 Q
"RTN","PSOORFIN",32,0)
W D KQ F  S ORD=$O(^PS(52.41,"AC",PAT,"W",ORD)) Q:'ORD!($G(POERR("QFLG")))  I $P(^PS(52.41,ORD,0),"^",3)'="DC",$P(^(0),"^",3)'="DE" D LK1,ORD S MAIL=1
"RTN","PSOORFIN",33,0)
 Q:$G(POERR("QFLG"))  I $G(MAIL) S ORD=0 D
"RTN","PSOORFIN",34,0)
 .D KQ F  S ORD=$O(^PS(52.41,"AC",PAT,"M",ORD)) Q:'ORD!($G(POERR("QFLG")))  D:$P(^PS(52.41,ORD,0),"^",3)'="DC"&($P(^(0),"^",3)'="DE") LK1,ORD
"RTN","PSOORFIN",35,0)
 .Q:$G(POERR("QFLG"))
"RTN","PSOORFIN",36,0)
 .D KQ F  S ORD=$O(^PS(52.41,"AC",PAT,"C",ORD)) Q:'ORD!($G(POERR("QFLG")))  D:$P(^PS(52.41,ORD,0),"^",3)'="DC"&($P(^(0),"^",3)'="DE") LK1,ORD
"RTN","PSOORFIN",37,0)
 Q
"RTN","PSOORFIN",38,0)
M D KQ F  S ORD=$O(^PS(52.41,"AC",PAT,"M",ORD)) Q:'ORD!($G(POERR("QFLG")))  I $P(^PS(52.41,ORD,0),"^",3)'="DC",$P(^(0),"^",3)'="DE" D LK1,ORD S WIN=1
"RTN","PSOORFIN",39,0)
 Q:$G(POERR("QFLG"))  I $G(WIN) S ORD=0 D
"RTN","PSOORFIN",40,0)
 .D KQ F  S ORD=$O(^PS(52.41,"AC",PAT,"W",ORD)) Q:'ORD!($G(POERR("QFLG")))  I $P(^PS(52.41,ORD,0),"^",3)'="DC",$P(^(0),"^",3)'="DE" D LK1,ORD
"RTN","PSOORFIN",41,0)
 .Q:$G(POERR("QFLG"))
"RTN","PSOORFIN",42,0)
 .D KQ F  S ORD=$O(^PS(52.41,"AC",PAT,"C",ORD)) Q:'ORD!($G(POERR("QFLG")))  D:$P(^PS(52.41,ORD,0),"^",3)'="DC"&($P(^(0),"^",3)'="DE") LK1,ORD
"RTN","PSOORFIN",43,0)
 Q
"RTN","PSOORFIN",44,0)
C D KQ F  S ORD=$O(^PS(52.41,"AC",PAT,"C",ORD)) Q:'ORD!($G(POERR("QFLG")))  I $P(^PS(52.41,ORD,0),"^",3)'="DC",$P(^(0),"^",3)'="DE" D LK1,ORD S CLI=1
"RTN","PSOORFIN",45,0)
 Q:$G(POERR("QFLG"))  I $G(CLI) S ORD=0 D
"RTN","PSOORFIN",46,0)
 .D KQ F  S ORD=$O(^PS(52.41,"AC",PAT,"M",ORD)) Q:'ORD!($G(POERR("QFLG")))  I $P(^PS(52.41,ORD,0),"^",3)'="DC",$P(^(0),"^",3)'="DE" D LK1,ORD
"RTN","PSOORFIN",47,0)
 .Q:$G(POERR("QFLG"))
"RTN","PSOORFIN",48,0)
 .D KQ F  S ORD=$O(^PS(52.41,"AC",PAT,"W",ORD)) Q:'ORD!($G(POERR("QFLG")))  D:$P(^PS(52.41,ORD,0),"^",3)'="DC"&($P(^(0),"^",3)'="DE") LK1,ORD
"RTN","PSOORFIN",49,0)
 Q
"RTN","PSOORFIN",50,0)
PAT W ! K MEDP,MEDA,POERR("DFLG"),DIR D KQ S PSOSORT="PATIENT"
"RTN","PSOORFIN",51,0)
 S DIR("?")="^D PT^PSOORFI1",DIR("A")="All Patients or Single Patient",DIR(0)="SBM^A:ALL;S:SINGLE;E:EXIT",DIR("B")="SINGLE"
"RTN","PSOORFIN",52,0)
 D ^DIR K DIR G:$D(DIRUT)!(Y="E") EX I Y="S" S PSOSORT=PSOSORT_"^"_"SINGLE" G SPAT
"RTN","PSOORFIN",53,0)
 S PSOSORT=PSOSORT_"^ALL"
"RTN","PSOORFIN",54,0)
 S LG=0,PATA=0 F  S LG=$O(^PS(52.41,"AD",LG)) Q:'LG!($G(POERR("QFLG")))  F PSOD=0:0 S PSOD=$O(^PS(52.41,"AD",LG,PSOPINST,PSOD)) Q:'PSOD!($G(POERR("QFLG")))  D
"RTN","PSOORFIN",55,0)
 .Q:'$D(^PS(52.41,PSOD,0))!($P($G(^PS(52.41,PSOD,0)),"^",23))
"RTN","PSOORFIN",56,0)
 .Q:$G(PAT($P(^PS(52.41,PSOD,0),"^",2)))=$P(^PS(52.41,PSOD,0),"^",2)  S PAT=$P(^PS(52.41,PSOD,0),"^",2)
"RTN","PSOORFIN",57,0)
 .I PAT'=PATA,$O(PSORX("PSOL",0))!($D(RXRS)) D LBL
"RTN","PSOORFIN",58,0)
 .D LK I $G(POERR("QFLG")) K POERR("QFLG") S PSOLK=1,PAT(PAT)=PAT Q
"RTN","PSOORFIN",59,0)
 .I $$CHK^PSODPT(PAT_"^"_$P($G(^DPT(PAT,0)),"^"),1,1)<0 S PSOLK=1,PAT(PAT)=PAT S X=PAT D ULP K PSOQFLG,PSOQQ Q
"RTN","PSOORFIN",60,0)
 .S (PSODFN,Y)=PAT_"^"_$P($G(^DPT(PAT,0)),"^"),PATA=PAT
"RTN","PSOORFIN",61,0)
 .D:'$G(MEDA) PROFILE^PSOORFI2 S Y=PSODFN I $G(MEDP) D SPL D OERR^PSORX1 S PSOFIN=1 D QU S X=PSOPTLOK D KLLP,ULP,KLL Q
"RTN","PSOORFIN",62,0)
 .D SDFN D POST^PSOORFI1 I $G(PSOQFLG)!($G(PSOQUIT)) S:$G(PSOQUIT) POERR("QFLG")=1 S:$G(PSOQFLG) PAT(PAT)=PAT S X=PAT D ULP K PSOQFLG Q
"RTN","PSOORFIN",63,0)
 .S PAT(PAT)=PAT
"RTN","PSOORFIN",64,0)
 .F ORD=0:0 S ORD=$O(^PS(52.41,"AOR",PAT,PSOPINST,ORD)) Q:'ORD!($G(POERR("QFLG")))!($G(PSOQQ))  D
"RTN","PSOORFIN",65,0)
 ..I '$P($G(^PS(52.41,ORD,0)),"^",23) D PP,LK1,ORD
"RTN","PSOORFIN",66,0)
 .S X=PAT D ULP K PSOQQ
"RTN","PSOORFIN",67,0)
 I $O(PSORX("PSOL",0))!($D(RXRS)) D LBL
"RTN","PSOORFIN",68,0)
 I $G(PSOQUIT) K PSOQUIT D EX G PSOORFIN
"RTN","PSOORFIN",69,0)
 G EX
"RTN","PSOORFIN",70,0)
SPAT K MEDA,MEDP,PSOQFLG,PSORX("FN") D KQ,KV^PSOVER1
"RTN","PSOORFIN",71,0)
 S DIR(0)="FO^2:30",DIR("A")="Select Patient",DIR("?")="^D HELP^PSOORFI2" D ^DIR I $E(X)="?" G SPAT
"RTN","PSOORFIN",72,0)
 G:$D(DIRUT) EX D KV^PSOVER1
"RTN","PSOORFIN",73,0)
 S DIC(0)="EQM",DIC=2,DIC("S")="I $D(^PS(52.41,""AOR"",+Y,PSOPINST))"
"RTN","PSOORFIN",74,0)
 D ^DIC K DIC G:"^"[X EX G:Y=-1 SPAT S (PSODFN,PAT)=+Y,PSOFINY=Y
"RTN","PSOORFIN",75,0)
 D LK I $G(POERR("QFLG")) G SPAT
"RTN","PSOORFIN",76,0)
 N SNGLPAT S SNGLPAT=1
"RTN","PSOORFIN",77,0)
 D:'$G(MEDA) PROFILE^PSOORFI2 S Y=PSOFINY I $G(MEDP) D SPL D OERR^PSORX1 D:$O(PSORX("PSOL",0))!($D(RXRS)) LBL S PSOFIN=1,X=PSOPTLOK D KLLP,ULP,KLL G SPAT
"RTN","PSOORFIN",78,0)
 D PP,SDFN,POST^PSOORFI1 D:$G(PSOQFLG)  G:$G(PSOQFLG) EX I $G(PSOQUIT) S:$G(PSOQUIT) POERR("QFLG")=1 S X=PAT D ULP G SPAT
"RTN","PSOORFIN",79,0)
 .S X=PAT D ULP
"RTN","PSOORFIN",80,0)
 S ORD=0 F  S ORD=$O(^PS(52.41,"P",PAT,ORD)) Q:'ORD!($G(POERR("QFLG")))  D:'$P($G(^PS(52.41,ORD,0)),"^",23)
"RTN","PSOORFIN",81,0)
 .D:$P(^PS(52.41,ORD,0),"^",3)'="DC"&($P(^(0),"^",3)'="DE")&($P(^(0),"^",3)'="HD") LK1,ORD
"RTN","PSOORFIN",82,0)
 I $O(PSORX("PSOL",0))!($D(RXRS)) D LBL
"RTN","PSOORFIN",83,0)
 S PSOFIN=1,X=PAT D ULP G SPAT
"RTN","PSOORFIN",84,0)
ORD I $G(PSOBCK) N LST,ORN
"RTN","PSOORFIN",85,0)
 E  S PSOLOUD=1 D:$P($G(^PS(55,PAT,0)),"^",6)'=2 EN^PSOHLUP(PAT) K PSOLOUD
"RTN","PSOORFIN",86,0)
 K DRET,SIG,^TMP("PSORXDC",$J) Q:'$D(^PS(52.41,ORD,0))
"RTN","PSOORFIN",87,0)
 I $G(PSOFIN),$P($G(^PS(52.41,ORD,"INI")),"^")'=$G(PSOPINST) Q
"RTN","PSOORFIN",88,0)
 D L1^PSOORFI3 I '$G(PSOMSG) K PSOMSG Q
"RTN","PSOORFIN",89,0)
 I '$D(^PS(52.41,ORD,0)) K PSOMSG Q
"RTN","PSOORFIN",90,0)
 K DRET,SIG,PSOPRC,PHI,PRC,PSOSIGFL,OBX,PSOMSG S PSOFDR=1,OR0=^PS(52.41,ORD,0),OI=$P(OR0,"^",8),PSORX("SC")=$P(OR0,"^",16)
"RTN","PSOORFIN",91,0)
 I $O(^PS(52.41,ORD,2,0)) S PHI=^PS(52.41,ORD,2,0),T=0 F  S T=$O(^PS(52.41,ORD,2,T)) Q:'T  S PHI(T)=^PS(52.41,ORD,2,T,0)
"RTN","PSOORFIN",92,0)
 I $P($G(^PS(52.41,ORD,"EXT")),"^")'="" K PHI I $O(^PS(52.41,ORD,"SIG",0)) S PHI=$G(^PS(52.41,ORD,"SIG",0)),T=0 F  S T=$O(^PS(52.41,ORD,"SIG",T)) Q:'T  S PHI(T)=$G(^PS(52.41,ORD,"SIG",T,0))
"RTN","PSOORFIN",93,0)
 I $O(^PS(52.41,ORD,3,0)) S PRC=^PS(52.41,ORD,3,0),T=0 F  S T=$O(^PS(52.41,ORD,3,T)) Q:'T  S PRC(T)=^PS(52.41,ORD,3,T,0)
"RTN","PSOORFIN",94,0)
 I $P(OR0,"^",24),($P(OR0,"^",3)="RNW"!($P(OR0,"^",3)="NW")) N PKI,PKI1,PKIR,PKIE S PKI=0 D CER^PSOPKIV1 Q:PKI<1
"RTN","PSOORFIN",95,0)
 I $P(OR0,"^",3)="RNW",$D(^PSRX(+$P(OR0,"^",21),0)) D  G SUCC ;process renews
"RTN","PSOORFIN",96,0)
 .K PSOREEDT S (PSOORRNW,PSOFDR)=1,PSORENW("OIRXN")=$P(OR0,"^",21),PSOOPT=3,(PSORENW("DFLG"),PSORENW("QFLG"))=0 D ^PSOORRNW,SQR
"RTN","PSOORFIN",97,0)
 I $P(OR0,"^",3)="RF",$D(^PSRX(+$P(OR0,"^",19),0)) D RF^PSOORFI2 G SUCC
"RTN","PSOORFIN",98,0)
 N PSODRUG,PSONEW S PSOFROM="PENDING" D:'$G(PSOTPBFG) DSPL^PSOTPCAN(ORD) D DSPL^PSOORFI1,SQN^PSOORFI3
"RTN","PSOORFIN",99,0)
SUCC ;
"RTN","PSOORFIN",100,0)
 D UL1^PSOORFI3,FULL^VALM1
"RTN","PSOORFIN",101,0)
 D:$P($G(^PS(52.41,+$G(ORD),0)),"^",3)'="NW"&($P($G(^(0)),"^",3)'="RNW")&($P($G(^(0)),"^",3)'="HD")&($P($G(^(0)),"^",3)'="RF")
"RTN","PSOORFIN",102,0)
 .K PSOSD("PENDING",$S('$G(OID):$P(^PS(50.7,$P(OR0,"^",8),0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,$P(OR0,"^",8),0),"^",2),0),"^"),1:$P(^PSDRUG($P(OR0,"^",9),0),"^")))
"RTN","PSOORFIN",103,0)
 S:$G(POERR("DFLG")) POERR("QFLG")=1 K POERR("DFLG"),PSONEW,ACP,OR0,DRET,SIG,OID,OI,PSORX("SC"),PSORX("CLINIC"),PSODRUG
"RTN","PSOORFIN",104,0)
 Q
"RTN","PSOORFIN",105,0)
LBL S PSOFROM="NEW" D ^PSORXL K PSORX("PSOL"),PPL,RXRS
"RTN","PSOORFIN",106,0)
 D:$D(BINGCRT)&($D(BINGRTE)&($D(DISGROUP))) ^PSOBING1 K BINGCRT,BINGRTE,PSONEW,BBFLG,BBRX
"RTN","PSOORFIN",107,0)
 Q
"RTN","PSOORFIN",108,0)
CHK ;
"RTN","PSOORFIN",109,0)
 D:'$D(PSOPAR) ^PSOLSET I '$D(PSOPAR) W !,$C(7),"Outpatient Division MUST be selected!",! G EX
"RTN","PSOORFIN",110,0)
 D INST1^PSOORFI2
"RTN","PSOORFIN",111,0)
 S PSZCNT=0 F PSZZI=0:0 S PSZZI=$O(^PS(59,PSZZI)) Q:'PSZZI  S PSZCNT=PSZCNT+1
"RTN","PSOORFIN",112,0)
 S TC=0 F TO=0:0 S TO=$O(^PS(52.41,"AOR",TO)) Q:'TO  F TZ=0:0 S TZ=$O(^PS(52.41,"AOR",TO,TZ)) Q:'TZ  F PSTZ=0:0 S PSTZ=$O(^PS(52.41,"AOR",TO,TZ,PSTZ)) Q:'PSTZ  S TC=TC+1
"RTN","PSOORFIN",113,0)
 W !!?10,$C(7),"Orders to be completed"_$S(PSZCNT=1:": ",1:" for all divisions: ")_TC,! Q:'TC
"RTN","PSOORFIN",114,0)
 D SUMM^PSOORNE1 K PSZZI,PSZCNT,PSTZ
"RTN","PSOORFIN",115,0)
 Q
"RTN","PSOORFIN",116,0)
S D S^PSOORFI2 Q
"RTN","PSOORFIN",117,0)
 ;
"RTN","PSOORFIN",118,0)
E D E^PSOORFI2 Q
"RTN","PSOORFIN",119,0)
 ;
"RTN","PSOORFIN",120,0)
R D R^PSOORFI2 Q
"RTN","PSOORFIN",121,0)
 ;
"RTN","PSOORFIN",122,0)
LK D LOCK^PSOORFI1
"RTN","PSOORFIN",123,0)
 Q
"RTN","PSOORFIN",124,0)
LK1 D LOCK1^PSOORFI1 Q
"RTN","PSOORFIN",125,0)
QU I $G(PSOQUIT) S POERR("QFLG")=1 K PSOQUIT
"RTN","PSOORFIN",126,0)
 S:$G(PSOQFLG) PAT(PAT)=PAT
"RTN","PSOORFIN",127,0)
 Q
"RTN","PSOORFIN",128,0)
ULP K PSORX("MAIL/WINDOW"),PSORX("METHOD OF PICK-UP")
"RTN","PSOORFIN",129,0)
 D CLEAN^PSOVER1
"RTN","PSOORFIN",130,0)
 I '$G(X) Q
"RTN","PSOORFIN",131,0)
 D UL^PSSLOCK(X) Q
"RTN","PSOORFIN",132,0)
KLL K PSOPTLOK Q
"RTN","PSOORFIN",133,0)
KLLP K PSONOLCK Q
"RTN","PSOORFIN",134,0)
SPL D SPL^PSOORFI4 Q
"RTN","PSOORFIN",135,0)
SDFN S PSODFN=+$G(PSODFN) Q
"RTN","PSOORFIN",136,0)
PP D PP^PSOORFI4 Q
"RTN","PSOORFIN",137,0)
KQ K PSOQUIT,POERR("QFLG") Q
"RTN","PSOORFIN",138,0)
SQR ;
"RTN","PSOORFIN",139,0)
 K PSOORRNW,PSOOPT,PSOREEDT,PSOQUIT S POERR("DFLG")=0
"RTN","PSOORFIN",140,0)
 Q
"RTN","PSOORFL")
0^48^B917206
"RTN","PSOORFL",1,0)
PSOORFL ;BIR/SJA - Flag order through CPRS entry point ;10/24/06 2:27pm
"RTN","PSOORFL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**225**;DEC 1997;Build 29
"RTN","PSOORFL",3,0)
 ;
"RTN","PSOORFL",4,0)
 ; Reference to EN1^ORCFLAG is supported by DBIA #3620
"RTN","PSOORFL",5,0)
 ;
"RTN","PSOORFL",6,0)
FLAG ;Flag order through CPRS entry point.
"RTN","PSOORFL",7,0)
 N ORIFN
"RTN","PSOORFL",8,0)
 S ORIFN=+$P($G(^PS(52.41,ORD,0)),"^")
"RTN","PSOORFL",9,0)
 D FULL^VALM1 W ! D EN1^ORCFLAG(ORIFN),BLD^PSOORUT1
"RTN","PSOORFL",10,0)
 Q
"RTN","PSOORFL",11,0)
RV ;reverse video
"RTN","PSOORFL",12,0)
 Q:'$G(VALMCNT)
"RTN","PSOORFL",13,0)
 N PSLIST S PSLIST=0 F PSLIST=1:1:VALMCNT D
"RTN","PSOORFL",14,0)
 .I $D(^TMP("PSOPF",$J,PSLIST,"RV")) D CNTRL^VALM10(PSLIST,1,3,IORVON,IORVOFF,0) Q
"RTN","PSOORFL",15,0)
 .I '$D(^TMP("PSOPF",$J,PSLIST,"RV")) D CNTRL^VALM10(PSLIST,1,3,IOINORM,IOINORM,0)
"RTN","PSOORFL",16,0)
 ;S VALMBCK="R" Q
"RTN","PSOORNE4")
0^65^B68513696
"RTN","PSOORNE4",1,0)
PSOORNE4 ;BIR/SAB-display renew RXs from backdoor ;07/29/96
"RTN","PSOORNE4",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,27,32,36,46,75,96,103,99,117,131,225**;DEC 1997;Build 29
"RTN","PSOORNE4",3,0)
 ;^SC DBIA-10040;^PS(50.7-2223;^PS(50.606-2174;^PS(50.607-2221;^PS(51.2-2226;^PSDRUG-221;^PS(55-2228
"RTN","PSOORNE4",4,0)
EN(PSONEW) N FLD,LST,VALMCNT
"RTN","PSOORNE4",5,0)
EN1 K PSOQUIT D:$G(PSONEW("ENT"))'>0  I $G(PSORENW("POE"))=1 S PSOREEDT=1 D SV
"RTN","PSOORNE4",6,0)
 .S PSOREEDT=1 D SV
"RTN","PSOORNE4",7,0)
 .K PSONEW("DOSE"),PSONEW("UNITS"),PSONEW("DOSE ORDERED"),PSONEW("ROUTE")
"RTN","PSOORNE4",8,0)
 .K PSONEW("SCHEDULE"),PSONEW("DURATION"),PSONEW("CONJUNCTION"),PSONEW("NOUN"),PSONEW("VERB"),PSOPRC,PSONEW("ODOSE")
"RTN","PSOORNE4",9,0)
RDD D DSPL,^PSOLMRN D:$G(PKI1)=2 DCP^PSOPKIV1 I $G(PSORX("FN")) S VALMBCK="Q" K PSOREEDT Q
"RTN","PSOORNE4",10,0)
 G:'$G(PSOQUIT) RDD
"RTN","PSOORNE4",11,0)
 Q
"RTN","PSOORNE4",12,0)
EDT D KV^PSOVER1 S DIR("A")="Select Field to Edit by number",DIR(0)="LO^1:"_$S($G(PSOREEDT):10,1:8)
"RTN","PSOORNE4",13,0)
 D ^DIR I $D(DTOUT)!($D(DUOUT)) D KV^PSOVER1 S VALMBCK="" Q
"RTN","PSOORNE4",14,0)
EDTSEL S PSOLM=1,(PSONEW("DFLG"),PSONEW("FIELD"),PSONEW3)=0
"RTN","PSOORNE4",15,0)
 I +Y S LST=Y D HLDHDR^PSOLMUTL S PSOEDT=1 D  Q:$G(PSODIR("DFLG"))!($G(PSODIR("QFLG")))
"RTN","PSOORNE4",16,0)
 .F FLD=1:1:$L(LST,",") Q:$P(LST,",",FLD)']""  D @(+$P(LST,",",FLD)) Q:$G(PSODIR("DFLG"))!($G(PSODIR("QFLG")))
"RTN","PSOORNE4",17,0)
 E  S VALMBCK="" D FULL^VALM1
"RTN","PSOORNE4",18,0)
 Q
"RTN","PSOORNE4",19,0)
ACP I $G(PKI1)=1 D REA^PSOPKIV1 G:$G(PSONEW("QFLG"))=1 PKI
"RTN","PSOORNE4",20,0)
 D INST2^PSORENW S PSOFROM1=1 D:$D(^XUSEC("PSORPH",DUZ))!('$P(PSOPAR,"^",2)) VER
"RTN","PSOORNE4",21,0)
 K PSOFROM1
"RTN","PSOORNE4",22,0)
PKI I $G(PSONEW("QFLG")) S POERR("DFLG")=1,VALMBCK="R" K PSONEW2 Q
"RTN","PSOORNE4",23,0)
 I PSONEW("ENT")>0,$G(NEWDOSE) K NEWDOSE G EN1 Q
"RTN","PSOORNE4",24,0)
 S PSORX("FN")=1 D EN^PSORN52(.PSONEW)
"RTN","PSOORNE4",25,0)
 D RNPSOSD^PSOUTIL,ACP1^PSOORNE6,^PSOBUILD S VALMBCK="Q"
"RTN","PSOORNE4",26,0)
 Q
"RTN","PSOORNE4",27,0)
VER1(PSONEW) ;
"RTN","PSOORNE4",28,0)
VER S (PSONEW("DFLG"),PSONEW("QFLG"))=0 I PSONEW("ENT")=0 D  K PSOORRNW,PSOFROM1 I PSONEW("DFLG")=1 S (PSONEW("QFLG"),POERR("DFLG"))=1 Q
"RTN","PSOORNE4",29,0)
 .S (PSOREEDT,PSOORRNW)=1 W !!,"Dosing Instruction Missing!!",!
"RTN","PSOORNE4",30,0)
 .S PSONEW("IRXN")=PSONEW("OIRXN") K VALMSG D FULL^VALM1 W !,"Drug: "_PSODRUG("NAME") D
"RTN","PSOORNE4",31,0)
 ..I $O(SIG(0)) D  Q
"RTN","PSOORNE4",32,0)
 ...F I=1:1 Q:$G(SIG(I))']""  W !,SIG(I)
"RTN","PSOORNE4",33,0)
 ..I $P($G(^PSRX(PSONEW("OIRXN"),"SIG")),"^")]"" S X=$P(^PSRX(PSONEW("OIRXN"),"SIG"),"^") D SIGONE^PSOHELP W !,$E($G(INS1),2,250)
"RTN","PSOORNE4",34,0)
 .K DIRUT W ! D DOSE^PSODIR(.PSONEW) Q:$G(PSONEW("DFLG"))  D EN^PSOFSIG(.PSONEW)
"RTN","PSOORNE4",35,0)
 .I PSONEW("ENT")>0,$O(SIG(0)) S (SIGOK,NEWDOSE)=1
"RTN","PSOORNE4",36,0)
 .I '$G(SPEED),PSONEW("DFLG")=1 S VALMSG="Renewal Request Cancelled!" W:$G(SPEED) !,"Renewal Request Cancelled!" Q:$G(PSONEW("DFLG"))
"RTN","PSOORNE4",37,0)
 .I +$G(PSONEW("ENT"))'>0 K DIRUT Q
"RTN","PSOORNE4",38,0)
 .D INS^PSODIR(.PSONEW),EN^PSOFSIG(.PSONEW),SINS^PSODIR(.PSONEW):$G(^PS(55,PSODFN,"LAN"))
"RTN","PSOORNE4",39,0)
 .S:'$G(SPEED)&(PSONEW("DFLG")=1) VALMSG="Renewal Request Cancelled!" W:$G(SPEED)&(PSONEW("DFLG")=1) !,"Renewal Request Cancelled!"
"RTN","PSOORNE4",40,0)
 .I $G(SPEED),'$G(PSONEW("DFLG")) D KV^PSOVER1 S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR,KV^PSOVER1 K X,Y
"RTN","PSOORNE4",41,0)
 I +$G(PSONEW("ENT"))'>0 G VER
"RTN","PSOORNE4",42,0)
 D STOP^PSORENW1 I +$G(PSEXDT) D  S PSORENW("QFLG")=1
"RTN","PSOORNE4",43,0)
 .S Y=PSORENW("FILL DATE") X ^DD("DD") S VALMSG=Y_" fill date is past expiration date "
"RTN","PSOORNE4",44,0)
 .S Y=$P(PSEXDT,"^",2) X ^DD("DD") S VALMSG=VALMSG_Y_"."
"RTN","PSOORNE4",45,0)
 Q
"RTN","PSOORNE4",46,0)
DSPL G:$G(PSONEW("ENT"))>0 DSP
"RTN","PSOORNE4",47,0)
 S PSONEW("ENT")=0 F I=0:0 S I=$O(^PSRX(PSONEW("OIRXN"),6,I)) Q:'I  S DOSE=^PSRX(PSONEW("OIRXN"),6,I,0) D
"RTN","PSOORNE4",48,0)
 .S PSONEW("ENT")=PSONEW("ENT")+1,PSONEW("DOSE",PSONEW("ENT"))=$P(DOSE,"^")
"RTN","PSOORNE4",49,0)
 .S PSONEW("UNITS",PSONEW("ENT"))=$P(DOSE,"^",3),PSONEW("DOSE ORDERED",PSONEW("ENT"))=$P(DOSE,"^",2),PSONEW("ROUTE",PSONEW("ENT"))=$P(DOSE,"^",7)
"RTN","PSOORNE4",50,0)
 .S PSONEW("SCHEDULE",PSONEW("ENT"))=$P(DOSE,"^",8),PSONEW("DURATION",PSONEW("ENT"))=$P(DOSE,"^",5),PSONEW("CONJUNCTION",PSONEW("ENT"))=$P(DOSE,"^",6)
"RTN","PSOORNE4",51,0)
 .S PSONEW("NOUN",PSONEW("ENT"))=$P(DOSE,"^",4),PSONEW("VERB",PSONEW("ENT"))=$P(DOSE,"^",9)
"RTN","PSOORNE4",52,0)
 .I $G(^PSRX(PSONEW("OIRXN"),6,I,1))]"" S PSONEW("ODOSE",PSONEW("ENT"))=^PSRX(PSONEW("OIRXN"),6,I,1)
"RTN","PSOORNE4",53,0)
 .K DOSE
"RTN","PSOORNE4",54,0)
DSP D ^PSOORUT2 K ^TMP("PSOPO",$J) S IEN=0
"RTN","PSOORNE4",55,0)
 D:$G(PSONEW("PENDING ORDER")) LMDISP^PSOORFI5(+PSONEW("PENDING ORDER"))
"RTN","PSOORNE4",56,0)
 D:$G(PKI1) L1^PSOPKIV1
"RTN","PSOORNE4",57,0)
 D DIN^PSONFI(PSODRUG("OI"),$S($G(PSODRUG("IEN")):PSODRUG("IEN"),1:""))
"RTN","PSOORNE4",58,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="                 Rx#: "_PSONEW("NRX #")
"RTN","PSOORNE4",59,0)
 I +$G(PSODRUG("OI")) D
"RTN","PSOORNE4",60,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="      Orderable Item: "_$P(^PS(50.7,+$G(PSODRUG("OI")),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")_NFIO
"RTN","PSOORNE4",61,0)
 .S:NFIO["<DIN>" NFIO=IEN_","_($L(^TMP("PSOPO",$J,IEN,0))-4)
"RTN","PSOORNE4",62,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="     "_$S($D(^PSDRUG("AQ",PSODRUG("IEN"))):"      CMOP ",1:"           ")_"Drug: "_PSODRUG("NAME")_NFID
"RTN","PSOORNE4",63,0)
 S:NFID["<DIN>" NFID=IEN_","_($L(^TMP("PSOPO",$J,IEN,0))-4)
"RTN","PSOORNE4",64,0)
 S:$G(PSONEW("TN"))]"" IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="          Trade Name: "_$G(PSONEW("TN"))
"RTN","PSOORNE4",65,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="      Patient Status: "_$P(PSONEW("PTST NODE"),"^"),PSONEW("PATIENT STATUS")=$P(PSONEW("PTST NODE"),"^")
"RTN","PSOORNE4",66,0)
 S (PSOID,Y)=PSONEW("ISSUE DATE") X ^DD("DD") S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  (1)     Issue Date: "_Y
"RTN","PSOORNE4",67,0)
 S Y=PSONEW("FILL DATE") X ^DD("DD") S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  (2)      Fill Date: "_Y
"RTN","PSOORNE4",68,0)
 I PSONEW("ENT")=0 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=$S($G(PSOREEDT):"  (9)",1:"     ")_"         Dosage:" G PAT
"RTN","PSOORNE4",69,0)
 F I=1:1:PSONEW("ENT") D
"RTN","PSOORNE4",70,0)
 .I '$G(PSONEW("DOSE ORDERED",I)),$G(PSONEW("VERB",I))]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="                Verb: "_$G(PSONEW("VERB",I))
"RTN","PSOORNE4",71,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=$S($G(PSOREEDT)&(I'>1):"  (9)",1:"     ")_"         Dosage: "_$S($E(PSONEW("DOSE",I),1)="."&($G(PSONEW("DOSE ORDERED",I))):"0",1:"")_PSONEW("DOSE",I)
"RTN","PSOORNE4",72,0)
 .S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_$S($G(PSONEW("UNITS",I))]"":" ("_$P(^PS(50.607,PSONEW("UNITS",I),0),"^")_")",1:"")
"RTN","PSOORNE4",73,0)
 .I $P($G(^PS(55,PSODFN,"LAN")),"^"),'$G(PSONEW("DOSE ORDERED",I)) D
"RTN","PSOORNE4",74,0)
 ..S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="   Oth. Lang. Dosage: "_$G(PSONEW("ODOSE",I))
"RTN","PSOORNE4",75,0)
 .I $G(PSONEW("DOSE ORDERED",I)),$G(PSONEW("VERB",I))]"" D
"RTN","PSOORNE4",76,0)
 ..S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="                Verb: "_$G(PSONEW("VERB",I))
"RTN","PSOORNE4",77,0)
 ..S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="      Dispense Units: "_$S($E($G(PSONEW("DOSE ORDERED",I)),1)=".":"0",1:"")_$G(PSONEW("DOSE ORDERED",I))
"RTN","PSOORNE4",78,0)
 ..S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="                Noun: "_$G(PSONEW("NOUN",I))
"RTN","PSOORNE4",79,0)
 .I $G(PSONEW("ROUTE",I)) S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="               Route: "_$P(^PS(51.2,PSONEW("ROUTE",I),0),"^")
"RTN","PSOORNE4",80,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="            Schedule: "_PSONEW("SCHEDULE",I)
"RTN","PSOORNE4",81,0)
 .I $G(PSONEW("DURATION",I))]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="           *Duration: "_$G(PSONEW("DURATION",I))
"RTN","PSOORNE4",82,0)
 .I $G(PSONEW("CONJUNCTION",I))]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="         Conjunction: "_$S($G(PSONEW("CONJUNCTION",I))="A":"AND",$G(PSONEW("CONJUNCTION",I))="T":"THEN",$G(PSONEW("CONJUNCTION",I))="X":"EXCEPT",1:"")
"RTN","PSOORNE4",83,0)
PAT S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=$S($G(PSOREEDT):" (10)",1:"     ")_"Pat Instruction:" D INS2^PSOBKDED
"RTN","PSOORNE4",84,0)
 S RXN=PSONEW("OIRXN") D INST1^PSORENW
"RTN","PSOORNE4",85,0)
 ;I $O(PRC(0)) D PC1^PSOORNE5
"RTN","PSOORNE4",86,0)
 K RXN S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="                 SIG:"
"RTN","PSOORNE4",87,0)
 I $G(SIGOK),$O(SIG(0)) D  K SG,MIG
"RTN","PSOORNE4",88,0)
 .F I=0:0 S I=$O(SIG(I)) Q:'I  F SG=1:1:$L(SIG(I)) D
"RTN","PSOORNE4",89,0)
 ..S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P(SIG(I)," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",21)=" "
"RTN","PSOORNE4",90,0)
 ..S:$P(SIG(I)," ",SG)'="" ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P(SIG(I)," ",SG)
"RTN","PSOORNE4",91,0)
 E  D
"RTN","PSOORNE4",92,0)
 .S X=$S($G(PSONEW("SIG"))]"":PSONEW("SIG"),1:$P($G(^PSRX(PSONEW("OIRXN"),"SIG")),"^")) D SIGONE^PSOHELP S SIG=$E($G(INS1),2,250)
"RTN","PSOORNE4",93,0)
 .F SG=1:1:$L(SIG) S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P(SIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",21)=" " S:$P(SIG," ",SG)'="" ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P(SIG," ",SG)
"RTN","PSOORNE4",94,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="         Days Supply: "_PSONEW("DAYS SUPPLY")_$S($L(PSONEW("DAYS SUPPLY"))=1:" ",1:"")
"RTN","PSOORNE4",95,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="                 QTY"_$S($G(PSODRUG("UNIT"))]"":" ("_PSODRUG("UNIT")_")",1:" (  )")_": "_PSONEW("QTY")
"RTN","PSOORNE4",96,0)
 I $D(^PSDRUG("AQ",PSODRUG("IEN"))),$P($G(^PSDRUG(PSODRUG("IEN"),5)),"^")]"" D
"RTN","PSOORNE4",97,0)
 .S $P(RN," ",79)=" ",IEN=IEN+1
"RTN","PSOORNE4",98,0)
 .S ^TMP("PSOPO",$J,IEN,0)="            QTY DSP MSG: "_$P(^PSDRUG(PSODRUG("IEN"),5),"^")
"RTN","PSOORNE4",99,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  (3)   # of Refills: "_PSONEW("# OF REFILLS")_$S($L(PSONEW("# OF REFILLS"))=1:" ",1:"")
"RTN","PSOORNE4",100,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  (4)        Routing: "_$S($G(PSORENW("MAIL/WINDOW"))["W":"WINDOW",1:"MAIL")
"RTN","PSOORNE4",101,0)
 S:$G(PSONEW("METHOD OF PICK-UP"))]""&($P(PSOPAR,"^",12)) IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="    Method of Pickup: "_PSONEW("METHOD OF PICK-UP")
"RTN","PSOORNE4",102,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  (5)         Clinic: "_$S($G(PSONEW("CLINIC")):$P(^SC(PSONEW("CLINIC"),0),"^"),1:"")
"RTN","PSOORNE4",103,0)
 S $P(RN," ",31)=" ",IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  (6)       Provider: "_PSONEW("PROVIDER NAME")_$E(RN,$L(PSONEW("PROVIDER NAME"))+1,31) K RN
"RTN","PSOORNE4",104,0)
 I $G(PSONEW("COSIGNING PROVIDER"))]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="        Cos-Provider: "_$P(^VA(200,PSONEW("COSIGNING PROVIDER"),0),"^")
"RTN","PSOORNE4",105,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  (7)         Copies: "_$S($G(PSONEW("COPIES")):PSONEW("COPIES"),1:1)
"RTN","PSOORNE4",106,0)
RMK S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  (8)        Remarks: "_$S($G(PSONEW("REMARKS"))]"":PSONEW("REMARKS"),1:"")
"RTN","PSOORNE4",107,0)
 S $P(RN," ",35)=" ",IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="   Entry By: "_$P(^VA(200,DUZ,0),"^")_$E(RN,$L($P(^VA(200,DUZ,0),"^"))+1,35)
"RTN","PSOORNE4",108,0)
 I $G(PSOFDR) S ^TMP("PSOPO",$J,IEN,0)="   Entry By: "_$P(^VA(200,$P(OR0,"^",4),0),"^")_$E(RN,$L($P(^VA(200,$P(OR0,"^",4),0),"^"))+1,35)
"RTN","PSOORNE4",109,0)
 D NOW^%DTC S PSONEW("LOGIN DATE")=$S($P($G(OR0),"^",6):$P($G(OR0),"^",6),1:%) K %,X S Y=PSONEW("LOGIN DATE") X ^DD("DD")
"RTN","PSOORNE4",110,0)
 S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"Entry Date: "_$P(Y,"@")_" "_$P(Y,"@",2) K RN
"RTN","PSOORNE4",111,0)
 S (VALMCNT,PSOPF)=IEN
"RTN","PSOORNE4",112,0)
 Q
"RTN","PSOORNE4",113,0)
1 D 1^PSOBKDED Q
"RTN","PSOORNE4",114,0)
2 D 2^PSOBKDED Q
"RTN","PSOORNE4",115,0)
3 D 9^PSOBKDED Q
"RTN","PSOORNE4",116,0)
4 D 12^PSOBKDED Q
"RTN","PSOORNE4",117,0)
5 D 5^PSOBKDED Q
"RTN","PSOORNE4",118,0)
6 D 4^PSOBKDED Q
"RTN","PSOORNE4",119,0)
7 D 11^PSOBKDED Q
"RTN","PSOORNE4",120,0)
8 D 13^PSOBKDED Q
"RTN","PSOORNE4",121,0)
9 W !!,"Drug: "_PSODRUG("NAME") S PSOORRNW=1 D DOSE1^PSOORED5(.PSONEW)
"RTN","PSOORNE4",122,0)
 I $G(PSONEW("DFLG")) S PSODIR("DFLG")=1,VALMBCK="Q" Q
"RTN","PSOORNE4",123,0)
 D SV Q
"RTN","PSOORNE4",124,0)
10 D INS^PSODIR(.PSONEW),SINS^PSODIR(.PSONEW) D SV Q
"RTN","PSOORNE4",125,0)
SV D SV^PSOORNE5 Q
"RTN","PSOORNE5")
0^49^B60780567
"RTN","PSOORNE5",1,0)
PSOORNE5 ;BIR/SAB - display orders from backdoor con't ;5/10/07 8:29am
"RTN","PSOORNE5",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,27,32,46,78,99,117,131,146,171,180,210,222,268,206,225**;DEC 1997;Build 29
"RTN","PSOORNE5",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORNE5",4,0)
 ;External references L and UL^PSSLOCK supported by DBIA 2789
"RTN","PSOORNE5",5,0)
 ;External reference to ^PS(51.2 supported by DBIA 2226
"RTN","PSOORNE5",6,0)
 ;External reference to ^PS(50.607 supported by DBIA 2221
"RTN","PSOORNE5",7,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOORNE5",8,0)
 ;called from PSOORNE2
"RTN","PSOORNE5",9,0)
 ;PSO*210 add call to WORDWRAP api
"RTN","PSOORNE5",10,0)
 ;
"RTN","PSOORNE5",11,0)
PEN ;pending orders
"RTN","PSOORNE5",12,0)
 K ^TMP("PSOPO",$J),PSORX("ISSUE DATE"),PSORX("FILL DATE") S ORSV=ORD,ORD=$P(PSOLST(ORN),"^",2)
"RTN","PSOORNE5",13,0)
 I $P($G(^PS(52.41,ORD,0)),"^",3)="DC"!($P($G(^(0)),"^",3)="DE") S VALMBCK="R" Q
"RTN","PSOORNE5",14,0)
 I $G(PSODFN)'=$P($G(^PS(52.41,ORD,0)),"^",2) S VALMBCK="" Q
"RTN","PSOORNE5",15,0)
 I $G(PSOTPBFG) N PSOTPPEN,PSOTPPEX S PSOTPPEN=ORD,PSOTPPEX=0 D VOPNR^PSOTPCAN I PSOTPPEX K PSOTPPEX,PSOTPPEN S VALMBCK="R" Q
"RTN","PSOORNE5",16,0)
 K PSOTPPEX,PSOTPPEN
"RTN","PSOORNE5",17,0)
 ;I '$G(PSOTPBFG) D DSPL^PSOTPCAN(ORD)
"RTN","PSOORNE5",18,0)
 ;S X=PSODFN_";DPT(" D LK^ORX2 I 'Y S VALMSG="Another person is entering orders for this patient.",VALMBCK="" Q
"RTN","PSOORNE5",19,0)
 I '$G(PSOFIN) S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient."),VALMBCK="" K PSOPLCK Q
"RTN","PSOORNE5",20,0)
 K PSOPLCK ; D PSOL^PSSLOCK($P(PSOLST(ORN),"^",2)_"S") I '$G(PSOMSG) S VAMLSG=$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order."),PSOACT="" K PSOMSG G OK ;VALMBCK="" Q
"RTN","PSOORNE5",21,0)
 S PSODRG=+$P($G(^PS(52.41,ORD,0)),"^",9) I $G(^PSDRUG(PSODRG,"I"))]"",DT>$G(^("I")) S VALMSG="This Drug has been Inactivated."
"RTN","PSOORNE5",22,0)
 K PSOMSG S PSOACT=$S($D(^XUSEC("PSORPH",DUZ)):"DEFX",'$D(^XUSEC("PSORPH",DUZ))&($P($G(PSOPAR),"^",2)):"F",1:"")
"RTN","PSOORNE5",23,0)
OK S PAT=PSODFN,PSORNSV=ORN,PSORNLT=PSLST D ORD^PSOORFIN S PSLST=PSORNLT,ORD=ORSV,ORN=PSORNSV K ORSV,PSORNSV,PSORNLT,PSODRUG S VALMBCK="R"
"RTN","PSOORNE5",24,0)
 K ORCHK,ORDRG,PSOFDR,SIGOK,PSONEW,PSORX("ISSUE DATE"),PSORX("FILL DATE"),PSORX("FN")
"RTN","PSOORNE5",25,0)
 K:'$G(MEDP) PAT
"RTN","PSOORNE5",26,0)
 D CLEAN^PSOVER1 ;S X=PSODFN_";DPT(" D ULK^ORX2
"RTN","PSOORNE5",27,0)
 I '$G(PSOFIN) D UL^PSSLOCK(PSODFN)
"RTN","PSOORNE5",28,0)
 Q
"RTN","PSOORNE5",29,0)
RXNCHK S PSOY=$O(PSONEW("OLD LAST RX#","")) I PSOY="" D AUTO^PSONRXN Q
"RTN","PSOORNE5",30,0)
 S PSONRXN("TYPE")=$S('+$G(^PS(59,+PSOSITE,2)):8,PSODRUG("DEA")["A"&(+$G(^PS(59,+PSOSITE,2))):3,1:8)
"RTN","PSOORNE5",31,0)
 S PSONEW("QFLG")=0 I PSOY'=PSONRXN("TYPE"),$P($G(PSOPAR),"^",7)=1 D
"RTN","PSOORNE5",32,0)
 .S DIE="^PS(59,",DA=PSOSITE,PSOX=PSONEW("OLD LAST RX#",PSOY)
"RTN","PSOORNE5",33,0)
 .L +^PS(59,+PSOSITE,PSOY):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3)
"RTN","PSOORNE5",34,0)
 .S DR=$S(PSOY=8:"2003////"_PSOX,PSOY=3:"1002.1////"_PSOX,1:"2003////"_PSOX)
"RTN","PSOORNE5",35,0)
 .D:PSOX<$P(^PS(59,+PSOSITE,PSOY),"^",3) ^DIE K DIE,X,Y L -^PS(59,+PSOSITE,PSOY)
"RTN","PSOORNE5",36,0)
 .L +^PS(59,+PSOSITE,PSONRXN("TYPE")):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3)
"RTN","PSOORNE5",37,0)
 .S PSOX1=^PS(59,+PSOSITE,PSONRXN("TYPE")),PSONRXN("LO")=$P(PSOX1,"^")
"RTN","PSOORNE5",38,0)
 .S PSONRXN("HI")=$P(PSOX1,"^",2),PSOI=$P(PSOX1,"^",3),PSONEW("OLD LAST RX#",PSONRXN("TYPE"))=PSOI
"RTN","PSOORNE5",39,0)
 .S:PSOI<PSONRXN("LO") PSOI=PSONRXN("LO")
"RTN","PSOORNE5",40,0)
 .D LOOP2 I PSONEW("QFLG") L -^PS(59,+PSOSITE,PSONRXN("TYPE")),-^PSRX("B",PSOI) Q
"RTN","PSOORNE5",41,0)
 .K DIC,DIE,DA S DIE=59,DA=PSOSITE
"RTN","PSOORNE5",42,0)
 .S DR=$S(PSONRXN("TYPE")=8:"2003////"_PSOI,PSONRXN("TYPE")=3:"1002.1////"_PSOI,1:"2003////"_PSOI)
"RTN","PSOORNE5",43,0)
 .S PSONEW("RX #")=PSOI D ^DIE K DIE,DIC,DR,DA L -^PS(59,+PSOSITE,PSONRXN("TYPE"))
"RTN","PSOORNE5",44,0)
 .K PSOX1,PSONRXN,PSOI,X,Y
"RTN","PSOORNE5",45,0)
 Q
"RTN","PSOORNE5",46,0)
LOOP2 F  S PSOI=PSOI+1 D:PSOI>PSONRXN("HI") FATAL^PSONRXN Q:'$D(^PSRX("B",PSOI))!PSONEW("QFLG")
"RTN","PSOORNE5",47,0)
 L +^PSRX("B",PSOI):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3) I $D(^PSRX("B",PSOI))!'$T G LOOP2
"RTN","PSOORNE5",48,0)
 L -^PSRX("B",PSOI)
"RTN","PSOORNE5",49,0)
 Q
"RTN","PSOORNE5",50,0)
RDSPL S PSODIR("CS")=0
"RTN","PSOORNE5",51,0)
 F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S $P(PSODIR("CS"),"^")=1 S:$E(+PSODRUG("DEA"),DEA)=2 $P(PSODIR("CS"),"^",2)=1
"RTN","PSOORNE5",52,0)
 I $P($G(PSODIR("CS")),"^",2)=1 S (PSONEW("# OF REFILLS"),PSONEW("N# REF"))=0 Q
"RTN","PSOORNE5",53,0)
 I '$D(CLOZPAT) I PSODRUG("DEA")["A"&(PSODRUG("DEA")'["B")!(PSODRUG("DEA")["F")!(PSODRUG("DEA")[1)!(PSODRUG("DEA")[2) S (PSONEW("# OF REFILLS"),PSONEW("N# REF"))=0 Q
"RTN","PSOORNE5",54,0)
 I $D(CLOZPAT) S (PSONEW("# OF REFILLS"),PSONEW("N# REF"))=$S($G(CLOZPAT)=2&(PSONEW("DAYS SUPPLY")=14):1,$G(CLOZPAT)=2&(PSONEW("DAYS SUPPLY")=7):3,$G(CLOZPAT)=1&(PSONEW("DAYS SUPPLY")=7):1,1:0) Q
"RTN","PSOORNE5",55,0)
 I PSODIR("CS") D
"RTN","PSOORNE5",56,0)
 .S PSOX=5,PSOX1=$S($P($G(PSONEW("PTST NODE")),"^",4)>PSOX:PSOX,1:$P($G(PSONEW("PTST NODE")),"^",4)),PSOX=$S(PSOX1=5:PSOX,1:PSOX1)
"RTN","PSOORNE5",57,0)
 .S PSOX=$S('PSOX:0,PSONEW("DAYS SUPPLY")=90:1,1:PSOX),PSDY=PSONEW("DAYS SUPPLY"),PSDY1=$S(PSDY<60:5,PSDY'<60&(PSDY'>89):2,PSDY=90:1,1:0) S PSOX=$S(PSOX'>PSDY1:PSOX,1:PSDY1)
"RTN","PSOORNE5",58,0)
 .I PSONEW("# OF REFILLS")>PSOX S (PSONEW("# OF REFILLS"),PSONEW("N# REF"))=PSOX
"RTN","PSOORNE5",59,0)
 E  D
"RTN","PSOORNE5",60,0)
 .S PSOX=11,PSOX1=$S($P($G(PSONEW("PTST NODE")),"^",4)>PSOX:PSOX,1:$P($G(PSONEW("PTST NODE")),"^",4)),PSOX=$S(PSOX1=11:PSOX,1:PSOX1)
"RTN","PSOORNE5",61,0)
 .S PSDY=PSONEW("DAYS SUPPLY"),PSDY1=$S(PSDY<60:11,PSDY'<60&(PSDY'>89):5,PSDY=90:3,1:0) S PSOX=$S(PSOX'>PSDY1:PSOX,1:PSDY1)
"RTN","PSOORNE5",62,0)
 .I PSONEW("# OF REFILLS")>PSOX S (PSONEW("# OF REFILLS"),PSONEW("N# REF"))=PSOX
"RTN","PSOORNE5",63,0)
 Q
"RTN","PSOORNE5",64,0)
GET ;
"RTN","PSOORNE5",65,0)
 I $P(PSODRUG0,"^",3)["2" S (ACTREF,ACTREN)=0 Q
"RTN","PSOORNE5",66,0)
 S (ACTREF,ACTREN)=1
"RTN","PSOORNE5",67,0)
 ;refills
"RTN","PSOORNE5",68,0)
 I ST S ACTREF=0
"RTN","PSOORNE5",69,0)
 I '$P(PSOPAR,"^",11),$G(^PSDRUG(PSODRG,"I"))]"",DT>$G(^("I")) S ACTREF=0,VALMSG="Inactive Drug, Non Refillable!"
"RTN","PSOORNE5",70,0)
 ;I $P($G(^PSDRUG(PSODRG,2)),"^",3)'["O" S ACTREF=0
"RTN","PSOORNE5",71,0)
 S PSORFRM=$P(RX0,"^",9) F PSOJ=0:0 S PSOJ=$O(^PSRX(RXN,1,PSOJ)) Q:'PSOJ  S PSORFRM=PSORFRM-1
"RTN","PSOORNE5",72,0)
 S:PSORFRM<0 PSORFRM=0 S:PSORFRM=0 ACTREF=0
"RTN","PSOORNE5",73,0)
 I $G(RXFL(RXN))]"",'$P(PSOPAR,"^",6) S ACTREF=0
"RTN","PSOORNE5",74,0)
 I $P(PSODRUG0,"^",3)["A"&($P(PSODRUG0,"^",3)'["B")!($P(PSODRUG0,"^",3)["F")!($P(PSODRUG0,"^",3)[1)!($P(PSODRUG0,"^",3)[2) S ACTREF=0
"RTN","PSOORNE5",75,0)
 ;renews
"RTN","PSOORNE5",76,0)
 I $P(PSOPAR,"^",4)=0 S ACTREN=0 Q
"RTN","PSOORNE5",77,0)
 I $P($G(^PSDRUG(PSODRG,2)),"^",3)'["O" S ACTREN=0
"RTN","PSOORNE5",78,0)
 I $G(^PSDRUG(PSODRG,"I"))]"",DT>$G(^("I")) S ACTREN=0,VALMSG="This Drug has been Inactivated."
"RTN","PSOORNE5",79,0)
 I '$P($G(^PSDRUG(PSODRG,2)),"^"),'$P($G(^PSRX(RXN,"OR1")),"^") S ACTREN=0,VALMSG="Drug must be Matched to an Orderable Item!"
"RTN","PSOORNE5",80,0)
 I ($P(PSODRUG0,"^",3)["W")!($P(PSODRUG0,"^",3)[1)!($P(PSODRUG0,"^",3)[2) S ACTREN=0
"RTN","PSOORNE5",81,0)
 I $D(^PS(53,+$P(RX0,"^",3),0)),'$P(^(0),"^",5) S ACTREN=0
"RTN","PSOORNE5",82,0)
 S PSOLC=$P(RX0,"^"),PSOLC=$E(PSOLC,$L(PSOLC)) I $A(PSOLC)'<90 S ACTREN=0
"RTN","PSOORNE5",83,0)
 I ST,ST'=2,ST'=5,ST'=6,ST'=11,ST'=12 S ACTREN=0
"RTN","PSOORNE5",84,0)
 K PSORFRM,PSOLC,PSODRG,PSODRUG0
"RTN","PSOORNE5",85,0)
 Q
"RTN","PSOORNE5",86,0)
INST ;formats instruction from front door
"RTN","PSOORNE5",87,0)
 D INST^PSOORNE6 Q
"RTN","PSOORNE5",88,0)
PC ;displays provider comments
"RTN","PSOORNE5",89,0)
 D PC^PSOORNE6 Q
"RTN","PSOORNE5",90,0)
INST1 ;formats instruction from front door
"RTN","PSOORNE5",91,0)
 D INST1^PSOORNE6 Q
"RTN","PSOORNE5",92,0)
PC1 ;displays provider comments
"RTN","PSOORNE5",93,0)
 D PC1^PSOORNE6 Q
"RTN","PSOORNE5",94,0)
DOSE ;displays dosing instruction for both simple and complex backdoor Rxs.
"RTN","PSOORNE5",95,0)
 I '$O(^PSRX(RXN,6,0))  S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" (3)          Dosage: " Q
"RTN","PSOORNE5",96,0)
 S DS=1 F I=0:0 S I=$O(^PSRX(RXN,6,I)) Q:'I  S DOSE=^PSRX(RXN,6,I,0) D
"RTN","PSOORNE5",97,0)
 .I '$P(DOSE,"^",2),$P(DOSE,"^",9)]"" S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="                Verb: "_$P(DOSE,"^",9)
"RTN","PSOORNE5",98,0)
 .I $G(DS)=1 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" (3)"
"RTN","PSOORNE5",99,0)
 .D DOSE1 S PSORXED("ENT")=$G(PSORXED("ENT"))+1
"RTN","PSOORNE5",100,0)
 K DOSE,I
"RTN","PSOORNE5",101,0)
 Q
"RTN","PSOORNE5",102,0)
DOSE1 ;
"RTN","PSOORNE5",103,0)
 I $G(DS)=1 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_"         *Dosage: "_$S($E($P(DOSE,"^"),1)="."&($P(DOSE,"^",2)):"0",1:"")_$P(DOSE,"^")_$S($P(DOSE,"^",3)]"":" ("_$P(^PS(50.607,$P(DOSE,"^",3),0),"^")_")",1:"") K DS G DU
"RTN","PSOORNE5",104,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="             *Dosage: "_$S($E($P(DOSE,"^"),1)="."&($P(DOSE,"^",2)):"0",1:"")_$P(DOSE,"^")_$S($P(DOSE,"^",3)]"":" ("_$P(^PS(50.607,$P(DOSE,"^",3),0),"^")_")",1:"")
"RTN","PSOORNE5",105,0)
DU I '$P(DOSE,"^",2),$P($G(^PS(55,PSODFN,"LAN")),"^") S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="   Oth. Lang. Dosage: "_$G(^PSRX(RXN,6,I,1))
"RTN","PSOORNE5",106,0)
 I $P(DOSE,"^",2),$P(DOSE,"^",9)]"" D
"RTN","PSOORNE5",107,0)
 .S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="                Verb: "_$P(DOSE,"^",9)
"RTN","PSOORNE5",108,0)
 .S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="      Dispense Units: "_$S($E($P(DOSE,"^",2),1)=".":"0",1:"")_$P(DOSE,"^",2)
"RTN","PSOORNE5",109,0)
 .S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="                Noun: "_$P(DOSE,"^",4)
"RTN","PSOORNE5",110,0)
 I $P(DOSE,"^",7) S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="              *Route: "_$P(^PS(51.2,$P(DOSE,"^",7),0),"^")
"RTN","PSOORNE5",111,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="           *Schedule: "_$P(DOSE,"^",8)
"RTN","PSOORNE5",112,0)
 I $P(DOSE,"^",5)]"" D
"RTN","PSOORNE5",113,0)
 .S DUR=$S($E($P(DOSE,"^",5),1)'?.N:$E($P(DOSE,"^",5),2,99)_$E($P(DOSE,"^",5),1),1:$P(DOSE,"^",5))
"RTN","PSOORNE5",114,0)
 .S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="           *Duration: "_DUR_" ("_$S($P(DOSE,"^",5)["M":"MINUTES",$P(DOSE,"^",5)["H":"HOURS",$P(DOSE,"^",5)["L":"MONTHS",$P(DOSE,"^",5)["W":"WEEKS",1:"DAYS")_")" K DUR
"RTN","PSOORNE5",115,0)
 I $P(DOSE,"^",6)]"" S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="        *Conjunction: "_$S($P(DOSE,"^",6)="A":"AND",$P(DOSE,"^",6)="T":"THEN",$P(DOSE,"^",6)="X":"EXCEPT",1:"")
"RTN","PSOORNE5",116,0)
 Q
"RTN","PSOORNE5",117,0)
INS ;patient instructions                                        ;PSO*210
"RTN","PSOORNE5",118,0)
 I $G(^PSRX(RXN,"INS"))]"",'$O(^PSRX(RXN,"INS1",0)) D  K SG G SPINS
"RTN","PSOORNE5",119,0)
 .S PSORXED("SIG",1)=^PSRX(RXN,"INS")
"RTN","PSOORNE5",120,0)
 .D WORDWRAP^PSOUTLA2(^PSRX(RXN,"INS"),.IEN,$NA(^TMP("PSOAO",$J)),21)
"RTN","PSOORNE5",121,0)
 ;
"RTN","PSOORNE5",122,0)
 I $O(^PSRX(RXN,"INS1",0)) D
"RTN","PSOORNE5",123,0)
 .S T=0 F  S T=$O(^PSRX(RXN,"INS1",T)) Q:'T  D
"RTN","PSOORNE5",124,0)
 .. S (PSORXED("SIG",T),MIG)=^PSRX(RXN,"INS1",T,0)
"RTN","PSOORNE5",125,0)
 .. D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOAO",$J)),21)
"RTN","PSOORNE5",126,0)
SPINS K T,SG,MIG
"RTN","PSOORNE5",127,0)
 I $P($G(^PS(55,PSODFN,"LAN")),"^") S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="  Other Pat. Instruc: "_$S($G(^PSRX(RXN,"INSS"))]"":^PSRX(RXN,"INSS"),1:"")
"RTN","PSOORNE5",128,0)
 Q
"RTN","PSOORNE5",129,0)
SV S VALMSG="Pre-POE Rx. Please Compare Dosing Fields with SIG!"
"RTN","PSOORNE5",130,0)
 Q
"RTN","PSOORNEW")
0^63^B72157265
"RTN","PSOORNEW",1,0)
PSOORNEW ;BIR/SAB - display orders from oerr ;4/25/07 8:50am
"RTN","PSOORNEW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,23,27,32,55,46,71,90,94,106,131,133,143,237,222,258,206,225**;DEC 1997;Build 29
"RTN","PSOORNEW",3,0)
 ;^PS(50.7 -2223
"RTN","PSOORNEW",4,0)
 ;^PSDRUG -221
"RTN","PSOORNEW",5,0)
 ;^PS(50.606 -2174
"RTN","PSOORNEW",6,0)
 ;^PS(55 -2228
"RTN","PSOORNEW",7,0)
 ;EN1^ORCFLAG -3620
"RTN","PSOORNEW",8,0)
 ;
"RTN","PSOORNEW",9,0)
 ;PSO*237 quit Finish if Today > Issue date + 365
"RTN","PSOORNEW",10,0)
 ;
"RTN","PSOORNEW",11,0)
DSPL I $G(PSODSPL) S VALMBCK="Q" K PSODSPL,PSOANSQD Q
"RTN","PSOORNEW",12,0)
 Q:'$D(PSOLMC)  K ^TMP("PSOPO",$J) S PSOLMC=PSOLMC+1
"RTN","PSOORNEW",13,0)
 I $D(CLOZPAT) S PSONEW("DAYS SUPPLY")=$S($G(PSONEW("DAYS SUPPLY")):PSONEW("DAYS SUPPLY"),1:7) G OI
"RTN","PSOORNEW",14,0)
 S PSONEW("DAYS SUPPLY")=$S($G(PSONEW("DAYS SUPPLY")):PSONEW("DAYS SUPPLY"),+$G(^PS(55,PSODFN,"PS"))&($P(^PS(53,+$G(^PS(55,PSODFN,"PS")),0),"^",3))&('$G(PSONEW("DAYS SUPPLY"))):$P(^PS(53,+$G(^PS(55,PSODFN,"PS")),0),"^",3),1:30)
"RTN","PSOORNEW",15,0)
OI I '$G(PSODRUG("OI")) D
"RTN","PSOORNEW",16,0)
 .S (OI,PSODRUG("OI"))=$P(OR0,"^",8),PSODRUG("OIN")=$P(^PS(50.7,$P(OR0,"^",8),0),"^"),OID=$P(OR0,"^",9)
"RTN","PSOORNEW",17,0)
 .I $P($G(OR0),"^",9) S POERR=1,DREN=$P(OR0,"^",9) D DRG^PSOORDRG K POERR
"RTN","PSOORNEW",18,0)
 I '$D(CLOZPAT) I $G(PSODRUG("DEA"))["A",$G(PSODRUG("DEA"))'["B"!($G(PSODRUG("DEA"))["F")!($G(PSODRUG("DEA"))[1)!($G(PSODRUG("DEA"))[2) S PSONEW("# OF REFILLS")=0
"RTN","PSOORNEW",19,0)
 I $D(CLOZPAT) S PSONEW("# OF REFILLS")=$S($D(PSONEW("# OF REFILLS")):PSONEW("# OF REFILLS"),$G(CLOZPAT)=2&($P(OR0,"^",11)>2):3,$G(CLOZPAT)&($P(OR0,"^",11)>1):1,1:0)
"RTN","PSOORNEW",20,0)
 S IEN=0 D OBX^PSOORFI1,LMDISP^PSOORFI5(ORD),DIN^PSONFI(PSODRUG("OI"),$S($G(PSODRUG("IEN")):PSODRUG("IEN"),1:""))
"RTN","PSOORNEW",21,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="*(1) Orderable Item: "_$P(^PS(50.7,PSODRUG("OI"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")_NFIO
"RTN","PSOORNEW",22,0)
 S:NFIO["<DIN>" NFIO=IEN_","_($L(^TMP("PSOPO",$J,IEN,0))-4)
"RTN","PSOORNEW",23,0)
 K LST I $G(PSODRUG("NAME"))]"" D  G PT
"RTN","PSOORNEW",24,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (2)"_$S($D(^PSDRUG("AQ",PSODRUG("IEN"))):"      CMOP ",1:"           ")_"Drug: "_PSODRUG("NAME")_NFID
"RTN","PSOORNEW",25,0)
 .S:NFID["<DIN>" NFID=IEN_","_($L(^TMP("PSOPO",$J,IEN,0))-4)
"RTN","PSOORNEW",26,0)
 .I $P($G(^PSDRUG(PSODRUG("IEN"),0)),"^",10)]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="       Drug Message:" D DRGMSG
"RTN","PSOORNEW",27,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (2)           Drug: No Dispense Drug Selected"
"RTN","PSOORNEW",28,0)
PT D DOSE2^PSOORFI4
"RTN","PSOORNEW",29,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (4)   Pat Instruct:" D:$O(PSONEW("SIG",0)) INST^PSOORFI4
"RTN","PSOORNEW",30,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  Provider Comments:" S TY=3 D INST^PSOORFI1
"RTN","PSOORNEW",31,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="       Instructions:" S TY=2 D INST^PSOORFI1
"RTN","PSOORNEW",32,0)
 K PSOELSE S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="                SIG:"
"RTN","PSOORNEW",33,0)
 F I=0:0 S I=$O(SIG(I)) Q:'I  S SIG=SIG(I) D
"RTN","PSOORNEW",34,0)
 .F SG=1:1:$L(SIG) S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P(SIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",20)=" " S:$P(SIG," ",SG)'="" ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P(SIG," ",SG)
"RTN","PSOORNEW",35,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (5) Patient Status: "_$P($G(^PS(53,+PSONEW("PATIENT STATUS"),0)),"^")
"RTN","PSOORNEW",36,0)
 K PSOELSE I $G(PSONEW("ISSUE DATE"))']"" S PSOELSE=1 S IEN=IEN+1,(PSOID,Y)=$E($P(OR0,"^",6),1,7) X ^DD("DD") S PSONEW("ISSUE DATE")=Y,^TMP("PSOPO",$J,IEN,0)=" (4)     Issue Date: "_Y
"RTN","PSOORNEW",37,0)
 I '$G(PSOELSE) S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (6)     Issue Date: "_PSONEW("ISSUE DATE")
"RTN","PSOORNEW",38,0)
 K PSOELSE I $G(PSORX("FILL DATE"))']"" S PSOELSE=1 D
"RTN","PSOORNEW",39,0)
 .S (Y,PSORX("FILL DATE"))=$S($E($P(OR0,"^",6),1,7)<DT:DT,1:$E($P(OR0,"^",6),1,7)) X ^DD("DD") S PSONEW("FILL DATE")=Y,^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"                  (5) Fill Date: "_Y
"RTN","PSOORNEW",40,0)
 I '$G(PSOELSE) S Y=PSORX("FILL DATE") X ^DD("DD") S PSORX("FILL DATE")=Y,^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"       (7) Fill Date: "_PSORX("FILL DATE")
"RTN","PSOORNEW",41,0)
 I $P(OR0,"^",18) S IEN=IEN+1,Y=$P(OR0,"^",18) X ^DD("DD") S $P(^TMP("PSOPO",$J,IEN,0)," ",39)="Effective Date: "_Y
"RTN","PSOORNEW",42,0)
 I $D(CLOZPAT) D ELIG^PSOORFI2 S:'$D(PSONEW("QTY")) PSONEW("QTY")=0
"RTN","PSOORNEW",43,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (8)    Days Supply: "_PSONEW("DAYS SUPPLY")
"RTN","PSOORNEW",44,0)
 S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"               (9)   QTY"_$S($P($G(^PSDRUG(+$G(PSODRUG("IEN")),660)),"^",8)]"":" ("_$P($G(^PSDRUG(+PSODRUG("IEN"),660)),"^",8)_")",1:" (  )")
"RTN","PSOORNEW",45,0)
 S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_": "_$S($G(PSONEW("QTY"))]"":PSONEW("QTY"),1:$P(OR0,"^",10))
"RTN","PSOORNEW",46,0)
 I $P($G(^PSDRUG(+$G(PSODRUG("IEN")),5)),"^")]"" D
"RTN","PSOORNEW",47,0)
 .S $P(RN," ",79)=" ",IEN=IEN+1
"RTN","PSOORNEW",48,0)
 .S ^TMP("PSOPO",$J,IEN,0)=$E(RN,$L("QTY DSP MSG: "_$P(^PSDRUG(PSODRUG("IEN"),5),"^"))+1,79)_"QTY DSP MSG: "_$P(^PSDRUG(PSODRUG("IEN"),5),"^") K RN
"RTN","PSOORNEW",49,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="       Provider ordered "_+$P(OR0,"^",11)_" refills"
"RTN","PSOORNEW",50,0)
 D:$D(CLOZPAT) PQTY^PSOORFI4
"RTN","PSOORNEW",51,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(10)   # of Refills: "_$S($G(PSONEW("# OF REFILLS"))]"":PSONEW("# OF REFILLS"),1:$P(OR0,"^",11))_"               (11)   Routing: "_$S($G(PSONEW("MAIL/WINDOW"))="M":"MAIL",1:"WINDOW")
"RTN","PSOORNEW",52,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(12)         Clinic: "_PSORX("CLINIC")
"RTN","PSOORNEW",53,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(13)       Provider: "_PSONEW("PROVIDER NAME")
"RTN","PSOORNEW",54,0)
 I $P($G(^VA(200,$S($G(PSONEW("PROVIDER")):PSONEW("PROVIDER"),1:$P(OR0,"^",5)),"PS")),"^",7)&($P($G(^("PS")),"^",8)) D
"RTN","PSOORNEW",55,0)
 .S IEN=IEN+1,PSONEW("COSIGNING PROVIDER")=$S($G(PSONEW("COSIGNING PROVIDER")):PSONEW("COSIGNING PROVIDER"),1:$P(^("PS"),"^",8))
"RTN","PSOORNEW",56,0)
 .S ^TMP("PSOPO",$J,IEN,0)="       Cos-Provider: "_$P(^VA(200,PSONEW("COSIGNING PROVIDER"),0),"^")
"RTN","PSOORNEW",57,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(14)         Copies: "_$S($G(PSONEW("COPIES")):PSONEW("COPIES"),1:1)
"RTN","PSOORNEW",58,0)
 S PSONEW("REMARKS")=$S($G(PSONEW("REMARKS"))]"":PSONEW("REMARKS"),$P(OR0,"^",17)="C":"Administered in Clinic.",1:"")
"RTN","PSOORNEW",59,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(15)        Remarks:"
"RTN","PSOORNEW",60,0)
 I $G(PSONEW("REMARKS"))]"" D
"RTN","PSOORNEW",61,0)
 .F SG=1:1:$L(PSONEW("REMARKS")) S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P(PSONEW("REMARKS")," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",20)=" " D
"RTN","PSOORNEW",62,0)
 ..S:$P(PSONEW("REMARKS")," ",SG)'="" ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P(PSONEW("REMARKS")," ",SG)
"RTN","PSOORNEW",63,0)
 I $G(PSOSIGFL)!(PSODRUG("OI")'=$P(OR0,"^",8)) S PSONEW("CLERK CODE")=DUZ,PSORX("CLERK CODE")=$P(^VA(200,DUZ,0),"^"),VALMSG="This change will create a new prescription!"
"RTN","PSOORNEW",64,0)
 S $P(RN," ",35)=" ",IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="   Entry By: "_$P(^VA(200,PSONEW("CLERK CODE"),0),"^")_$E(RN,$L($P(^VA(200,PSONEW("CLERK CODE"),0),"^"))+1,35)
"RTN","PSOORNEW",65,0)
 S Y=$P(OR0,"^",12) X ^DD("DD") S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"Entry Date: "_$E($P(OR0,"^",12),4,5)_"/"_$E($P(OR0,"^",12),6,7)_"/"_$E($P(OR0,"^",12),2,3)_" "_$P(Y,"@",2) K RN
"RTN","PSOORNEW",66,0)
 I PSOLMC<2 D ^PSOLMPO1 S VALMBCK="Q",PSOLMC=0
"RTN","PSOORNEW",67,0)
 S:PSOLMC>1 VALMBCK="R"
"RTN","PSOORNEW",68,0)
 Q
"RTN","PSOORNEW",69,0)
ORCHK D PROVCOM^PSOORFI4,ORCHK^PSOORFI4
"RTN","PSOORNEW",70,0)
 Q
"RTN","PSOORNEW",71,0)
EDT D KV S DIR("A",1)="* Indicates which fields will create an new Order",DIR("A")="Select Field to Edit by number",DIR(0)="LO^1:15" D ^DIR Q:$D(DTOUT)!($D(DUOUT))
"RTN","PSOORNEW",72,0)
EDTSEL N LST,FLD,OUT D KV S OUT=0
"RTN","PSOORNEW",73,0)
 I +Y S LST=Y D FULL^VALM1 N PSODOSE M PSODOSE=PSONEW D  G DSPL
"RTN","PSOORNEW",74,0)
 .F FLD=1:1:$L(LST,",") Q:$P(LST,",",FLD)']""!(OUT)  D @(+$P(LST,",",FLD)) D:$P(LST,",",FLD)=8 REF D KV
"RTN","PSOORNEW",75,0)
 E  S VALMBCK="" Q
"RTN","PSOORNEW",76,0)
 Q
"RTN","PSOORNEW",77,0)
ACP ;
"RTN","PSOORNEW",78,0)
 I $G(ORD),+$P($G(^PS(52.41,+ORD,0)),"^",23)=1 D  Q:$D(DIRUT)!'Y  D EN1^ORCFLAG(+$P($G(^PS(52.41,ORD,0)),"^")) H 1
"RTN","PSOORNEW",79,0)
 . D FULL^VALM1 D KV
"RTN","PSOORNEW",80,0)
 . S DIR("A",1)="This Order is flagged. In order to finish it"
"RTN","PSOORNEW",81,0)
 . S DIR("A",2)="you must unflag it first."
"RTN","PSOORNEW",82,0)
 . S DIR("A",3)=""
"RTN","PSOORNEW",83,0)
 . S DIR(0)="Y",DIR("A")="Unflag Order",DIR("B")="NO"
"RTN","PSOORNEW",84,0)
 . W ! D ^DIR I $D(DIRUT)!'Y S VALMBCK="Q"
"RTN","PSOORNEW",85,0)
 I $G(ORD),+$P($G(^PS(52.41,+ORD,0)),"^",23)=1 Q
"RTN","PSOORNEW",86,0)
 ;
"RTN","PSOORNEW",87,0)
 I $D(CLOZPAT),+$G(PSONEW("QTY"))=0 S VALMSG="Unable to calculate the quantity, enter a quantity" G DSPL
"RTN","PSOORNEW",88,0)
 S (PSODIR("DFLG"),PSORX("DFLG"),PSODIR("QFLD"))=0,ACP=1 D ORCHK
"RTN","PSOORNEW",89,0)
 G:$G(PSONEW("QFLG")) DSPL
"RTN","PSOORNEW",90,0)
 I $G(PSODIR("DFLG"))!$G(PSORX("DFLG")) Q
"RTN","PSOORNEW",91,0)
 I $G(PSONEW("FLD"))!($G(PSODRUG("NAME"))']"")!('$O(SIG(0))) G DSPL
"RTN","PSOORNEW",92,0)
 I $G(PSODRUG("NAME"))]"",'$G(ORCHK)!($G(ORDRG)'=PSODRUG("NAME")) D  I $G(PSORX("DFLG")) D CLEAN^PSOVER1 G DSPL
"RTN","PSOORNEW",93,0)
 .D POST^PSODRG S:'$G(PSORX("DFLG")) ORCHK=1,ORDRG=PSODRUG("NAME")
"RTN","PSOORNEW",94,0)
 I '$D(PSONEW("RX #")) S PSOFROM="NEW",RTN=$S($P($G(PSOPAR),"^",7):"AUTO^PSONRXN",1:"MANUAL^PSONRXN") D @RTN Q:PSONEW("QFLG")  I '$P($G(PSOPAR),"^",7) S PSOX=PSONEW("RX #") D CHECK^PSONRXN
"RTN","PSOORNEW",95,0)
 D RXNCHK^PSOORNE1 I $G(PSONEW("QFLG")) S PSONEW("DFLG")=1 Q
"RTN","PSOORNEW",96,0)
 I DT>$$FMADD^XLFDT($P(OR0,"^",6),365) D EXPR^PSONEW2 G DSPL
"RTN","PSOORNEW",97,0)
 D STOP^PSONEW2,DISPLAY^PSONEW2,^PSONEWF
"RTN","PSOORNEW",98,0)
 I $G(PSOCPZ("DFLG")) W !!,"No action taken!",! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR,KV K PSOCPZ("DFLG"),DRET,PSOANSQD S VALMBCK="Q" Q
"RTN","PSOORNEW",99,0)
 ;
"RTN","PSOORNEW",100,0)
 K PSOCPZ("DFLG") D KV S DIR(0)="Y",DIR("A")="Are you sure you want to Accept this Order",DIR("B")="NO" D ^DIR I $D(DIRUT) D KV K DRET,PSOANSQ,PSOANSQD S VALMBCK="Q" Q
"RTN","PSOORNEW",101,0)
 D KV I 'Y K PSOANSQ G DSPL
"RTN","PSOORNEW",102,0)
 I $G(PSONEW("MAIL/WINDOW"))["W" D:$P($G(PSOPAR),"^",12)  S BINGCRT="Y",BINGRTE="W",PSORX("MAIL/WINDOW")="WINDOW" K RTN
"RTN","PSOORNEW",103,0)
 .W ! K DIR,DIRUT S DIR(0)="52,35O"
"RTN","PSOORNEW",104,0)
 .S:$G(PSORX("METHOD OF PICK-UP"))]"" DIR("B")=PSORX("METHOD OF PICK-UP") D ^DIR I $D(DIRUT) K DIR,DIRUT Q
"RTN","PSOORNEW",105,0)
 .S (PSONEW("METHOD OF PICK-UP"),PSORX("METHOD OF PICK-UP"))=Y K X,Y
"RTN","PSOORNEW",106,0)
 S PSONEW("POE")=1 D EN^PSON52(.PSONEW) G:$G(PSONEW("DFLG")) ABORT D DCORD^PSONEW2
"RTN","PSOORNEW",107,0)
 D NPSOSD^PSOUTIL(.PSONEW),FULL^VALM1 K PSORX("MAIL/WINDOW")
"RTN","PSOORNEW",108,0)
 D EOJ^PSONEW
"RTN","PSOORNEW",109,0)
ABORT S VALMBCK="Q",DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR,CLEAN^PSOVER1,KV
"RTN","PSOORNEW",110,0)
 Q
"RTN","PSOORNEW",111,0)
KV K DIRUT,DUOUT,DTOUT,DIR
"RTN","PSOORNEW",112,0)
 Q
"RTN","PSOORNEW",113,0)
REF D REF^PSOORFI4
"RTN","PSOORNEW",114,0)
 Q
"RTN","PSOORNEW",115,0)
1 N PSOBDR,PSOBDRG S PSOBDRG=1 D 1^PSOORNW2 Q  ;oi
"RTN","PSOORNEW",116,0)
 ;
"RTN","PSOORNEW",117,0)
4 D INS^PSOORNW2 Q
"RTN","PSOORNEW",118,0)
 ;
"RTN","PSOORNEW",119,0)
3 D DOSE^PSOORED4(.PSONEW) Q
"RTN","PSOORNEW",120,0)
 ;
"RTN","PSOORNEW",121,0)
6 D 4^PSOORNW2 Q  ;idt
"RTN","PSOORNEW",122,0)
 ;
"RTN","PSOORNEW",123,0)
7 D 5^PSOORNW2 Q  ;fdt
"RTN","PSOORNEW",124,0)
 ;
"RTN","PSOORNEW",125,0)
5 D 3^PSOORNW2 Q  ;pstat
"RTN","PSOORNEW",126,0)
 ;
"RTN","PSOORNEW",127,0)
13 D 12^PSOORNW2 Q  ;doc
"RTN","PSOORNEW",128,0)
 ;
"RTN","PSOORNEW",129,0)
12 D 11^PSOORNW2 Q  ;cli
"RTN","PSOORNEW",130,0)
 ;
"RTN","PSOORNEW",131,0)
2 N PSOCSIG I '$G(PSOBDRG) N PSOBDR,PSOBDRG S PSOBDRG=1
"RTN","PSOORNEW",132,0)
 D 2^PSOORNW1 Q:$G(PSOQFLG)  D EN^PSODIAG  ;drg/ICD
"RTN","PSOORNEW",133,0)
 I $G(PSOCSIG) K PSOCSIG G 3
"RTN","PSOORNEW",134,0)
 Q
"RTN","PSOORNEW",135,0)
 ;
"RTN","PSOORNEW",136,0)
9 D 8^PSOORNW2 Q  ;qty
"RTN","PSOORNEW",137,0)
 ;
"RTN","PSOORNEW",138,0)
8 D 7^PSOORNW2 Q  ;ds
"RTN","PSOORNEW",139,0)
 ;
"RTN","PSOORNEW",140,0)
10 D 9^PSOORNW2 Q  ;#rfs
"RTN","PSOORNEW",141,0)
 ;
"RTN","PSOORNEW",142,0)
14 D 13^PSOORNW2 Q  ;cop
"RTN","PSOORNEW",143,0)
 ;
"RTN","PSOORNEW",144,0)
11 D 10^PSOORNW2 Q  ;m/w
"RTN","PSOORNEW",145,0)
 ;
"RTN","PSOORNEW",146,0)
15 D 14^PSOORNW2 Q  ;rem
"RTN","PSOORNEW",147,0)
 ;
"RTN","PSOORNEW",148,0)
DRGMSG ;
"RTN","PSOORNEW",149,0)
 F SG=1:1:$L($P(^PSDRUG(PSODRUG("IEN"),0),"^",10)) S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P($P(^PSDRUG(PSODRUG("IEN"),0),"^",10)," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",20)=" " D
"RTN","PSOORNEW",150,0)
 .S:$P($P(^PSDRUG(PSODRUG("IEN"),0),"^",10)," ",SG)'="" ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P($P(^PSDRUG(PSODRUG("IEN"),0),"^",10)," ",SG)
"RTN","PSOORNEW",151,0)
 K SG Q
"RTN","PSOORRL")
0^34^B64370128
"RTN","PSOORRL",1,0)
PSOORRL ;BHAM ISC/SAB - returns patient's outpatient meds ;07/21/96
"RTN","PSOORRL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**4,20,9,34,54,82,124,132,159,214,225**;DEC 1997;Build 29
"RTN","PSOORRL",3,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOORRL",4,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORRL",5,0)
 ;External reference to ^VA(200 supported by DBIA 10060
"RTN","PSOORRL",6,0)
 ;External reference to ^PS(51.2 supported by DBIA 2226
"RTN","PSOORRL",7,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSOORRL",8,0)
 ;External reference to ^PS(50.606 supported by DBIA 2174
"RTN","PSOORRL",9,0)
 ;External reference to OCL^PSJORRE supported by DBIA 2383
"RTN","PSOORRL",10,0)
 ;External reference to OEL^PSJORRE1 supported by DBIA 2384
"RTN","PSOORRL",11,0)
OCL(DFN,BDT,EDT,VIEW) ;entry point to return condensed list
"RTN","PSOORRL",12,0)
 ; VIEW=0   -  This returns the list as it was returned prior to GUI 27
"RTN","PSOORRL",13,0)
 ; VIEW=1   -  This returns the list in original view GUI 27
"RTN","PSOORRL",14,0)
 ; VIEW=2   -  This is the new sort with GUI 27
"RTN","PSOORRL",15,0)
 ; VIEW=3   -  New sort by Sort by Drug Name/status with GUI 27
"RTN","PSOORRL",16,0)
 D @$S($G(VIEW)=3:"OCL^PSOORRL3",$G(VIEW)=1:"OCL^PSOORRLO",$G(VIEW)=2:"OCL^PSOORRLN",1:"ST")
"RTN","PSOORRL",17,0)
 Q
"RTN","PSOORRL",18,0)
 ;BHW;PSO*7*159;New SD* Variables
"RTN","PSOORRL",19,0)
ST N SD,SDT,SDT1
"RTN","PSOORRL",20,0)
 D:$P($G(^PS(55,DFN,0)),"^",6)'=2 EN^PSOHLUP(DFN)
"RTN","PSOORRL",21,0)
 K ^TMP("PS",$J) S TFN=0,PSBDT=$G(BDT),PSEDT=$G(EDT) I +$G(PSBDT)<1 S X1=DT,X2=-120 D C^%DTC S PSBDT=X
"RTN","PSOORRL",22,0)
 S EXDT=PSBDT-1,IFN=0
"RTN","PSOORRL",23,0)
 F  S EXDT=$O(^PS(55,DFN,"P","A",EXDT)) Q:'EXDT  F  S IFN=$O(^PS(55,DFN,"P","A",EXDT,IFN)) Q:'IFN  D:$D(^PSRX(IFN,0))
"RTN","PSOORRL",24,0)
 .Q:$P($G(^PSRX(IFN,"STA")),"^")=13
"RTN","PSOORRL",25,0)
 .S TFN=TFN+1,RX0=^PSRX(IFN,0),RX2=$G(^(2)),RX3=$G(^(3)),STA=+$G(^("STA")),TRM=0,LSTFD=$P(RX2,"^",2),LSTRD=$P(RX2,"^",13),LSTDS=$P(RX0,"^",8)
"RTN","PSOORRL",26,0)
 .F I=0:0 S I=$O(^PSRX(IFN,1,I)) Q:'I  S TRM=TRM+1,LSTFD=$P(^PSRX(IFN,1,I,0),"^"),LSTDS=$P(^(0),"^",10) S:$P(^(0),"^",18)]"" LSTRD=$P(^(0),"^",18)
"RTN","PSOORRL",27,0)
 .S ^TMP("PS",$J,TFN,0)=IFN_"R;O"_"^"_$P($G(^PSDRUG(+$P(RX0,"^",6),0)),"^")_"^^"_$P(RX2,"^",6)_"^"_($P(RX0,"^",9)-TRM)_"^^^"_$P($G(^PSRX(IFN,"OR1")),"^",2)
"RTN","PSOORRL",28,0)
 .S ^TMP("PS",$J,TFN,"P",0)=$P(RX0,"^",4)_"^"_$P($G(^VA(200,+$P(RX0,"^",4),0)),"^")
"RTN","PSOORRL",29,0)
 .S ST0=$S(STA<12&($P(RX2,"^",6)<DT):11,1:STA)
"RTN","PSOORRL",30,0)
 .S ST=$P("ERROR^ACTIVE^NON-VERIFIED^REFILL FILL^HOLD^NON-VERIFIED^ACTIVE/SUSP^^^^^DONE^EXPIRED^DISCONTINUED^DISCONTINUED^DISCONTINUED^DISCONTINUED (EDIT)^HOLD^","^",ST0+2)
"RTN","PSOORRL",31,0)
 .S ^TMP("PS",$J,TFN,0)=^TMP("PS",$J,TFN,0)_"^"_ST_"^"_LSTFD_"^"_$P(RX0,"^",8)_"^"_$P(RX0,"^",7)_"^^^"_$P(RX0,"^",13)_"^"_LSTRD_"^"_LSTDS
"RTN","PSOORRL",32,0)
 .S ^TMP("PS",$J,TFN,"SCH",0)=0
"RTN","PSOORRL",33,0)
 .S (SCH,SC)=0 F  S SC=$O(^PSRX(IFN,"SCH",SC)) Q:'SC  S SCH=SCH+1,^TMP("PS",$J,TFN,"SCH",SCH,0)=$P(^PSRX(IFN,"SCH",SC,0),"^"),^TMP("PS",$J,TFN,"SCH",0)=^TMP("PS",$J,TFN,"SCH",0)+1
"RTN","PSOORRL",34,0)
 .S ^TMP("PS",$J,TFN,"MDR",0)=0,(MDR,MR)=0 F  S MR=$O(^PSRX(IFN,"MEDR",MR)) Q:'MR  D
"RTN","PSOORRL",35,0)
 ..Q:'$D(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0))  S MDR=MDR+1
"RTN","PSOORRL",36,0)
 ..I $P($G(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0)),"^",3)]"" S ^TMP("PS",$J,TFN,"MDR",MDR,0)=$P(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0),"^",3)
"RTN","PSOORRL",37,0)
 ..I $D(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0)),$P($G(^(0)),"^",3)']"" S ^TMP("PS",$J,TFN,"MDR",MDR,0)=$P(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0),"^")
"RTN","PSOORRL",38,0)
 ..S ^TMP("PS",$J,TFN,"MDR",0)=^TMP("PS",$J,TFN,"MDR",0)+1
"RTN","PSOORRL",39,0)
 .S PSOELSE=0 I $D(^PSRX(IFN,"SIG")),'$P(^PSRX(IFN,"SIG"),"^",2) S PSOELSE=1 S X=$P(^PSRX(IFN,"SIG"),"^") D SIG1^PSOORRL1
"RTN","PSOORRL",40,0)
 .I '$G(PSOELSE) S ITFN=1 D
"RTN","PSOORRL",41,0)
 ..S ^TMP("PS",$J,TFN,"SIG",ITFN,0)=$G(^PSRX(IFN,"SIG1",1,0)),^TMP("PS",$J,TFN,"SIG",0)=+$G(^TMP("PS",$J,TFN,"SIG",0))+1
"RTN","PSOORRL",42,0)
 ..F I=1:0 S I=$O(^PSRX(IFN,"SIG1",I)) Q:'I  S ITFN=ITFN+1,^TMP("PS",$J,TFN,"SIG",ITFN,0)=^PSRX(IFN,"SIG1",I,0),^TMP("PS",$J,TFN,"SIG",0)=+$G(^TMP("PS",$J,TFN,"SIG",0))+1
"RTN","PSOORRL",43,0)
 K PSOELSE
"RTN","PSOORRL",44,0)
 S IFN=0 F  S IFN=$O(^PS(52.41,"P",DFN,IFN)) Q:'IFN  S PSOR=^PS(52.41,IFN,0) D:$P(PSOR,"^",3)="" WAIT D:$P(PSOR,"^",3)'="DC"&($P(PSOR,"^",3)'="DE")&($P(PSOR,"^",3)'="")
"RTN","PSOORRL",45,0)
 .Q:$P(PSOR,"^",3)="RF"
"RTN","PSOORRL",46,0)
 .I $P(PSOR,"^",8)="",$P(PSOR,"^",9)="" D WAIT
"RTN","PSOORRL",47,0)
 .I $P(PSOR,"^",8)="",$P(PSOR,"^",9)="" Q  ; QUIT IF STILL NULL AFTER WAITING
"RTN","PSOORRL",48,0)
 .S TFN=TFN+1,^TMP("PS",$J,TFN,0)=IFN_"P;O^"_$S($P(PSOR,"^",9):$P($G(^PSDRUG($P(PSOR,"^",9),0)),"^"),1:$P(^PS(50.7,$P(PSOR,"^",8),0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,$P(PSOR,"^",8),0),"^",2),0),"^"))
"RTN","PSOORRL",49,0)
 .S ^TMP("PS",$J,TFN,0)=^TMP("PS",$J,TFN,0)_"^^^^^^"_$P(PSOR,"^")_"^"_"PENDING^^^"_$P(PSOR,"^",10)_"^"
"RTN","PSOORRL",50,0)
 .S ^TMP("PS",$J,TFN,0)=^TMP("PS",$J,TFN,0)_"^"_$S($P(PSOR,"^",3)="RNW":1,1:0)
"RTN","PSOORRL",51,0)
 .S SD=0 F SCH=0:0 S SCH=$O(^PS(52.41,IFN,1,SCH)) Q:'SCH  S SD=SD+1,^TMP("PS",$J,TFN,"SCH",SD,0)=$P(^PS(52.41,IFN,1,SCH,1),"^"),^TMP("PS",$J,TFN,"SCH",0)=SD
"RTN","PSOORRL",52,0)
 .S SD=0 F SCH=0:0 S SCH=$O(^PS(52.41,IFN,"SIG",SCH)) Q:'SCH  S SD=SD+1,^TMP("PS",$J,TFN,"SIG",SD,0)=$P(^PS(52.41,IFN,"SIG",SCH,0),"^"),^TMP("PS",$J,TFN,"SIG",0)=SD
"RTN","PSOORRL",53,0)
 .S (IEN,SD)=1,INST=0 F  S INST=$O(^PS(52.41,IFN,2,INST)) Q:'INST  S (MIG,INST(INST))=^PS(52.41,IFN,2,INST,0),^TMP("PS",$J,TFN,"SIO",0)=SD D
"RTN","PSOORRL",54,0)
 ..F SG=1:1:$L(MIG," ") S:$L($G(^TMP("PS",$J,TFN,"SIO",IEN,0))_" "_$P(MIG," ",SG))>80 IEN=IEN+1,SD=SD+1,^TMP("PS",$J,TFN,"SIO",0)=SD S ^TMP("PS",$J,TFN,"SIO",IEN,0)=$G(^TMP("PS",$J,TFN,"SIO",IEN,0))_" "_$P(MIG," ",SG)
"RTN","PSOORRL",55,0)
 D NVA,OCL^PSJORRE(DFN,BDT,EDT,.TFN,+$G(VIEW)),END^PSOORRL1
"RTN","PSOORRL",56,0)
 K SDT,SDT1,EDT,EDT1,BDT,DBT1,X
"RTN","PSOORRL",57,0)
 Q
"RTN","PSOORRL",58,0)
OEL(DFN,RXNUM) ;returns expanded list on specific order
"RTN","PSOORRL",59,0)
 I $P(RXNUM,";",2)="I" D OEL^PSJORRE1(DFN,$P(RXNUM,";")) Q
"RTN","PSOORRL",60,0)
 D:$P($G(^PS(55,DFN,0)),"^",6)'=2 EN^PSOHLUP(DFN) Q:RXNUM=""
"RTN","PSOORRL",61,0)
 ;BHW;PSO*7*159;New SD
"RTN","PSOORRL",62,0)
 N SD
"RTN","PSOORRL",63,0)
 K INST,IFN,^TMP("PS",$J) S FL=$P(RXNUM,";"),IFN=+FL,RXNUM=$P(RXNUM,";",2)
"RTN","PSOORRL",64,0)
 I $G(FL)["P"!($G(FL)["S") D PEN^PSOORRL1 Q
"RTN","PSOORRL",65,0)
 I $G(FL)["N" D NVA^PSOORRL1 Q
"RTN","PSOORRL",66,0)
 Q:'$D(^PSRX(IFN,0))
"RTN","PSOORRL",67,0)
 S RX0=^PSRX(IFN,0),RX2=$G(^(2)),RX3=$G(^(3)),STA=+$G(^("STA")),TRM=0,LSTFD=$P(RX2,"^",2)
"RTN","PSOORRL",68,0)
 S ^TMP("PS",$J,"RXN",0)=$P(RX0,"^")_"^"_$E($P(RX2,"^",13),1,7)_"^"_$S($P(RX0,"^",11)="W":"W",1:"M")_"^"_$P(RX3,"^",7)_"^"_$S($P($G(^PSRX(IFN,"OR1")),"^",5):$P(^PSRX(IFN,"OR1"),"^",5),1:"")_"^"_$E($P(RX2,"^",2),1,7)_"^"_$E($P(RX2,"^",13),1,7)
"RTN","PSOORRL",69,0)
 D RSTC(0) ;set return to stock node for original
"RTN","PSOORRL",70,0)
 F I=0:0 S I=$O(^PSRX(IFN,1,I)) Q:'I  S TRM=TRM+1,LSTFD=$P(^PSRX(IFN,1,I,0),"^") D
"RTN","PSOORRL",71,0)
 .S ^TMP("PS",$J,"REF",I,0)=$P(^PSRX(IFN,1,I,0),"^")_"^"_$P(^(0),"^",10)_"^"_$P(^(0),"^",4)_"^"_$E($P(^(0),"^",18),1,7)_"^"_$S($P(^(0),"^",2)="W":"W",1:"M")_"^"_$P(^(0),"^",3)
"RTN","PSOORRL",72,0)
 .I $P(^PSRX(IFN,1,I,0),"^",18) S $P(^TMP("PS",$J,"RXN",0),"^",2)=$E($P(^PSRX(IFN,1,I,0),"^",18),1,7)
"RTN","PSOORRL",73,0)
 .S ^TMP("PS",$J,"REF",0)=$G(^TMP("PS",$J,"REF",0))+1
"RTN","PSOORRL",74,0)
 .D RSTC(I) ;set return to stock node for refills
"RTN","PSOORRL",75,0)
 F I=0:0 S I=$O(^PSRX(IFN,"P",I)) Q:'I  D
"RTN","PSOORRL",76,0)
 .S ^TMP("PS",$J,"PAR",I,0)=$P(^PSRX(IFN,"P",I,0),"^")_"^"_$P(^(0),"^",10)_"^"_$P(^(0),"^",4)_"^"_$E($P(^(0),"^",19),1,7)_"^"_$S($P(^(0),"^",2)="W":"W",1:"M")_"^"_$P(^(0),"^",3)
"RTN","PSOORRL",77,0)
 .S ^TMP("PS",$J,"PAR",0)=$G(^TMP("PS",$J,"PAR",0))+1
"RTN","PSOORRL",78,0)
 S ^TMP("PS",$J,0)=$P($G(^PSDRUG(+$P(RX0,"^",6),0)),"^")_"^^"_$P(RX2,"^",6)
"RTN","PSOORRL",79,0)
 S ^TMP("PS",$J,"P",0)=$P(RX0,"^",4)_"^"_$P($G(^VA(200,+$P(RX0,"^",4),0)),"^")
"RTN","PSOORRL",80,0)
 S ST0=$S(STA<12&($P(RX2,"^",6)<DT):11,1:STA)
"RTN","PSOORRL",81,0)
 S ST=$P("ERROR^ACTIVE^NON-VERIFIED^REFILL FILL^HOLD^NON-VERIFIED^ACTIVE/SUSP^^^^^DONE^EXPIRED^DISCONTINUE^DISCONTINUED^DISCONTINUED^DISCONTINUED (EDIT)^HOLD^","^",ST0+2)
"RTN","PSOORRL",82,0)
 S ^TMP("PS",$J,0)=^TMP("PS",$J,0)_"^"_($P(RX0,"^",9)-TRM)_"^"_$P(RX0,"^",13)_"^"_ST_"^"_$P(RX0,"^",8)_"^"_$P(RX0,"^",7)_"^^^"_$P($G(^PSRX(IFN,"OR1")),"^",2)_"^"_LSTFD_"^^"
"RTN","PSOORRL",83,0)
 S ^TMP("PS",$J,"DD",0)=1,^TMP("PS",$J,"DD",1,0)=$P(RX0,"^",6)_"^^"
"RTN","PSOORRL",84,0)
 S COD=$S('$G(^PSDRUG(+$P(RX0,"^",6),"I")):1,+$G(^PSDRUG(+$P(RX0,"^",6),"I"))>DT:1,1:0)
"RTN","PSOORRL",85,0)
 S ^TMP("PS",$J,"DD",1,0)=^TMP("PS",$J,"DD",1,0)_$S($P($G(^PSDRUG(+$P(RX0,"^",6),2)),"^",3)["U"&(COD):$P(RX0,"^",6),1:"") K COD
"RTN","PSOORRL",86,0)
 S ^TMP("PS",$J,"SCH",0)=0,(SCH,SC)=0
"RTN","PSOORRL",87,0)
 F  S SC=$O(^PSRX(IFN,"SCH",SC)) Q:'SC  S SCH=SCH+1,^TMP("PS",$J,"SCH",SCH,0)=$P(^PSRX(IFN,"SCH",SC,0),"^") D
"RTN","PSOORRL",88,0)
 .S ^TMP("PS",$J,"SCH",0)=^TMP("PS",$J,"SCH",0)+1
"RTN","PSOORRL",89,0)
 D MDR^PSOORRL1
"RTN","PSOORRL",90,0)
 S PSOELSE=0 I $D(^PSRX(IFN,"SIG")),'$P(^PSRX(IFN,"SIG"),"^",2) S PSOELSE=1 S X=$P(^PSRX(IFN,"SIG"),"^") D SIG^PSOORRL1
"RTN","PSOORRL",91,0)
 I '$G(PSOELSE) S ITFN=1 D
"RTN","PSOORRL",92,0)
 .S ^TMP("PS",$J,"SIG",ITFN,0)=$G(^PSRX(IFN,"SIG1",1,0)),^TMP("PS",$J,"SIG",0)=+$G(^TMP("PS",$J,"SIG",0))+1
"RTN","PSOORRL",93,0)
 .F I=1:0 S I=$O(^PSRX(IFN,"SIG1",I)) Q:'I  S ITFN=ITFN+1,^TMP("PS",$J,"SIG",ITFN,0)=^PSRX(IFN,"SIG1",I,0),^TMP("PS",$J,"SIG",0)=+$G(^TMP("PS",$J,"SIG",0))+1
"RTN","PSOORRL",94,0)
 K PSOELSE
"RTN","PSOORRL",95,0)
 S ^TMP("PS",$J,"PC",0)=0,ITFN=0
"RTN","PSOORRL",96,0)
 F I=0:0 S I=$O(^PSRX(IFN,"PRC",I)) Q:'I  S ITFN=ITFN+1,^TMP("PS",$J,"PC",ITFN,0)=^PSRX(IFN,"PRC",I,0),^TMP("PS",$J,"PC",0)=^TMP("PS",$J,"PC",0)+1
"RTN","PSOORRL",97,0)
 Q
"RTN","PSOORRL",98,0)
 ;
"RTN","PSOORRL",99,0)
WAIT ; IF PENDING ENTRY STILL BEING BUILT SEE IF IT COMPLETES WITHIN ANOTHER SECOND
"RTN","PSOORRL",100,0)
 H 1 S PSOR=$G(^PS(52.41,IFN,0))
"RTN","PSOORRL",101,0)
 Q
"RTN","PSOORRL",102,0)
 ;
"RTN","PSOORRL",103,0)
NVA ; Set Non-VA Med Orders in the ^TMP Global
"RTN","PSOORRL",104,0)
 ;BHW;PSO*7*159;New SDT,SDT1 Variables
"RTN","PSOORRL",105,0)
 N SDT,SDT1
"RTN","PSOORRL",106,0)
 F I=0:0 S I=$O(^PS(55,DFN,"NVA",I)) Q:'I  S X=$G(^PS(55,DFN,"NVA",I,0)) D
"RTN","PSOORRL",107,0)
 .Q:'$P(X,"^")
"RTN","PSOORRL",108,0)
 .S DRG=$S($P(X,"^",2):$P($G(^PSDRUG($P(X,"^",2),0)),"^"),1:$P(^PS(50.7,$P(X,"^"),0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,$P(X,"^"),0),"^",2),0),"^"))
"RTN","PSOORRL",109,0)
 .S SDT=$P(X,"^",9) I 'SDT D TMPBLD Q
"RTN","PSOORRL",110,0)
 .I $E(SDT,4,5),$E(SDT,6,7) D
"RTN","PSOORRL",111,0)
 ..;I $P(X,"^",9) D  Q
"RTN","PSOORRL",112,0)
 ..I $G(BDT),SDT<BDT Q
"RTN","PSOORRL",113,0)
 ..I $G(EDT),SDT>EDT Q
"RTN","PSOORRL",114,0)
 ..I $G(BDT),$P(X,"^",7),$P(X,"^",7)<BDT Q
"RTN","PSOORRL",115,0)
 ..D TMPBLD
"RTN","PSOORRL",116,0)
 .I $E(SDT,4,5),'$E(SDT,6,7) D
"RTN","PSOORRL",117,0)
 ..S SDT1=$E(SDT,1,5),BDT1=$E(+$G(BDT),1,5),EDT1=$E(+$G(EDT),1,5)
"RTN","PSOORRL",118,0)
 ..I $G(BDT1),SDT1<BDT1 Q
"RTN","PSOORRL",119,0)
 ..I $G(EDT1),SDT1>EDT1 Q
"RTN","PSOORRL",120,0)
 ..I $G(BDT1),$P(X,"^",7),$E($P(X,"^",7),1,5)<BDT1 Q
"RTN","PSOORRL",121,0)
 ..D TMPBLD
"RTN","PSOORRL",122,0)
 .I '$E(SDT,4,5),'$E($P(X,"^",9),6,7) D
"RTN","PSOORRL",123,0)
 ..;I $P(X,"^",9) D  Q
"RTN","PSOORRL",124,0)
 ..S SDT1=$E(SDT,1,3),BDT1=$E(+$G(BDT),1,3),EDT1=$E(+$G(EDT),1,3)
"RTN","PSOORRL",125,0)
 ..I $G(BDT1),SDT1<BDT1 Q
"RTN","PSOORRL",126,0)
 ..I $G(EDT1),SDT1>EDT1 Q
"RTN","PSOORRL",127,0)
 ..I $G(BDT1),$P(X,"^",7),$E($P(X,"^",7),1,3)<BDT1 Q
"RTN","PSOORRL",128,0)
 ..D TMPBLD
"RTN","PSOORRL",129,0)
 Q
"RTN","PSOORRL",130,0)
TMPBLD S TFN=$G(TFN)+1,^TMP("PS",$J,TFN,0)=I_"N;O^"_DRG
"RTN","PSOORRL",131,0)
 S $P(^TMP("PS",$J,TFN,0),"^",8)=$P(X,"^",8)_"^"_$S($P(X,"^",7):"DISCONTINUED",1:"ACTIVE")
"RTN","PSOORRL",132,0)
 S ^TMP("PS",$J,TFN,"SCH",0)=1,^TMP("PS",$J,TFN,"SCH",1,0)=$P(X,"^",5)
"RTN","PSOORRL",133,0)
 S ^TMP("PS",$J,TFN,"SIG",0)=1,^TMP("PS",$J,TFN,"SIG",1,0)=$P(X,"^",3)_" "_$P(X,"^",4)_" "_$P(X,"^",5)
"RTN","PSOORRL",134,0)
 Q
"RTN","PSOORRL",135,0)
RSTC(REF) ; return to stock
"RTN","PSOORRL",136,0)
 F J=0:0 S J=$O(^PSRX(IFN,"A",J)) Q:'J  S II=$G(^(J,0)) I $P(II,"^",2)="I",$P(II,"^",4)=REF D
"RTN","PSOORRL",137,0)
 .I REF=0,'$$RXRLDT^PSOBPSUT(IFN,0) S ^TMP("PS",$J,"RXN","RSTC")=$P(II,"^")_"^"_$P(II,"^",3)_"^"_$P(II,"^",5) Q
"RTN","PSOORRL",138,0)
 .I REF>0,'$$RXRLDT^PSOBPSUT(IFN,REF) S ^TMP("PS",$J,"REF",REF,"RSTC")=$P(II,"^")_"^"_$P(II,"^",3)_"^"_$P(II,"^",5)
"RTN","PSOORRL",139,0)
 Q
"RTN","PSOORRL3")
0^59^B23985690
"RTN","PSOORRL3",1,0)
PSOORRL3 ;BHAM ISC/SJA - returns patient's outpatient meds-new sort ;02/02/07
"RTN","PSOORRL3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**225**;DEC 1997;Build 29
"RTN","PSOORRL3",3,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOORRL3",4,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORRL3",5,0)
 ;External reference to ^VA(200 supported by DBIA 10060
"RTN","PSOORRL3",6,0)
 ;External reference to ^PS(51.2 supported by DBIA 2226
"RTN","PSOORRL3",7,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSOORRL3",8,0)
 ;External reference to ^PS(50.606 supported by DBIA 2174
"RTN","PSOORRL3",9,0)
 ;External reference to OCL^PSJORRE supported by DBIA 2383
"RTN","PSOORRL3",10,0)
OCL ;entry point to return condensed list
"RTN","PSOORRL3",11,0)
 ;BHW;PSO*7*159;New SD* Variables
"RTN","PSOORRL3",12,0)
 N SD,SDT,SDT1,PSG,PST,PSD,DRUG,PSOSTA
"RTN","PSOORRL3",13,0)
 D:$P($G(^PS(55,DFN,0)),"^",6)'=2 EN^PSOHLUP(DFN)
"RTN","PSOORRL3",14,0)
 K ^TMP("PS",$J),^TMP("PSO",$J),^TMP("PS1",$J)
"RTN","PSOORRL3",15,0)
 S TFN=0,PSBDT=$G(BDT),PSEDT=$G(EDT) I +$G(PSBDT)<1 S X1=DT,X2=-120 D C^%DTC S PSBDT=X
"RTN","PSOORRL3",16,0)
 S EXDT=PSBDT-1,IFN=0
"RTN","PSOORRL3",17,0)
 F  S EXDT=$O(^PS(55,DFN,"P","A",EXDT)) Q:'EXDT  F  S IFN=$O(^PS(55,DFN,"P","A",EXDT,IFN)) Q:'IFN  D:$D(^PSRX(IFN,0))
"RTN","PSOORRL3",18,0)
 .S PSOSTA=$P($G(^PSRX(IFN,"STA")),"^") Q:'(PSOSTA=0!(PSOSTA=11)!(PSOSTA=5))
"RTN","PSOORRL3",19,0)
 .S TFN=TFN+1,RX0=^PSRX(IFN,0),RX2=$G(^(2)),RX3=$G(^(3)),STA=+$G(^("STA")),TRM=0,LSTFD=$P(RX2,"^",2),LSTRD=$P(RX2,"^",13),LSTDS=$P(RX0,"^",8)
"RTN","PSOORRL3",20,0)
 .F I=0:0 S I=$O(^PSRX(IFN,1,I)) Q:'I  S TRM=TRM+1,LSTFD=$P(^PSRX(IFN,1,I,0),"^"),LSTDS=$P(^(0),"^",10) S:$P(^(0),"^",18)]"" LSTRD=$P(^(0),"^",18)
"RTN","PSOORRL3",21,0)
 .S ST0=STA,ST=$P("ERROR^ACTIVE^^^^^ACTIVE/SUSP^^^^^^EXPIRED^^^^^^","^",ST0+2)
"RTN","PSOORRL3",22,0)
 .S DRUG=$P($G(^PSDRUG(+$P(RX0,"^",6),0)),"^")
"RTN","PSOORRL3",23,0)
 .S ^TMP("PSO",$J,DRUG,ST,TFN,0)=IFN_"R;O"_"^"_DRUG_"^^"_$P(RX2,"^",6)_"^"_($P(RX0,"^",9)-TRM)_"^^^"_$P($G(^PSRX(IFN,"OR1")),"^",2)
"RTN","PSOORRL3",24,0)
 .S ^TMP("PSO",$J,DRUG,ST,TFN,"P",0)=$P(RX0,"^",4)_"^"_$P($G(^VA(200,+$P(RX0,"^",4),0)),"^")
"RTN","PSOORRL3",25,0)
 .S ^TMP("PSO",$J,DRUG,ST,TFN,0)=^TMP("PSO",$J,DRUG,ST,TFN,0)_"^"_ST_"^"_LSTFD_"^"_$P(RX0,"^",8)_"^"_$P(RX0,"^",7)_"^^^"_$P(RX0,"^",13)_"^"_LSTRD_"^"_LSTDS
"RTN","PSOORRL3",26,0)
 .S ^TMP("PSO",$J,DRUG,ST,TFN,"SCH",0)=0
"RTN","PSOORRL3",27,0)
 .S (SCH,SC)=0 F  S SC=$O(^PSRX(IFN,"SCH",SC)) Q:'SC  S SCH=SCH+1,^TMP("PSO",$J,DRUG,ST,TFN,"SCH",SCH,0)=$P(^PSRX(IFN,"SCH",SC,0),"^"),^TMP("PSO",$J,DRUG,ST,TFN,"SCH",0)=^TMP("PSO",$J,DRUG,ST,TFN,"SCH",0)+1
"RTN","PSOORRL3",28,0)
 .S ^TMP("PSO",$J,DRUG,ST,TFN,"MDR",0)=0,(MDR,MR)=0 F  S MR=$O(^PSRX(IFN,"MEDR",MR)) Q:'MR  D
"RTN","PSOORRL3",29,0)
 ..Q:'$D(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0))  S MDR=MDR+1
"RTN","PSOORRL3",30,0)
 ..I $P($G(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0)),"^",3)]"" S ^TMP("PSO",$J,DRUG,ST,TFN,"MDR",MDR,0)=$P(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0),"^",3)
"RTN","PSOORRL3",31,0)
 ..I $D(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0)),$P($G(^(0)),"^",3)']"" S ^TMP("PSO",$J,DRUG,ST,TFN,"MDR",MDR,0)=$P(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0),"^")
"RTN","PSOORRL3",32,0)
 ..S ^TMP("PSO",$J,DRUG,ST,TFN,"MDR",0)=^TMP("PSO",$J,DRUG,ST,TFN,"MDR",0)+1
"RTN","PSOORRL3",33,0)
 .S PSOELSE=0 I $D(^PSRX(IFN,"SIG")),'$P(^PSRX(IFN,"SIG"),"^",2) S PSOELSE=1 S X=$P(^PSRX(IFN,"SIG"),"^") D SIG1^PSOORRL1
"RTN","PSOORRL3",34,0)
 .I '$G(PSOELSE) S ITFN=1 D
"RTN","PSOORRL3",35,0)
 ..S ^TMP("PSO",$J,DRUG,ST,TFN,"SIG",ITFN,0)=$G(^PSRX(IFN,"SIG1",1,0)),^TMP("PSO",$J,DRUG,ST,TFN,"SIG",0)=+$G(^TMP("PSO",$J,DRUG,ST,TFN,"SIG",0))+1
"RTN","PSOORRL3",36,0)
 ..F I=1:0 S I=$O(^PSRX(IFN,"SIG1",I)) Q:'I  S ITFN=ITFN+1,^TMP("PSO",$J,DRUG,ST,TFN,"SIG",ITFN,0)=^PSRX(IFN,"SIG1",I,0),^TMP("PSO",$J,DRUG,ST,TFN,"SIG",0)=+$G(^TMP("PSO",$J,DRUG,ST,TFN,"SIG",0))+1
"RTN","PSOORRL3",37,0)
 K PSOELSE D NVA
"RTN","PSOORRL3",38,0)
 S PSG="",J=1 F  S PSG=$O(^TMP("PSO",$J,PSG)) Q:PSG=""  S PST="" F  S PST=$O(^TMP("PSO",$J,PSG,PST)) Q:PST=""  S I=0 F  S I=$O(^TMP("PSO",$J,PSG,PST,I)) Q:'I  D
"RTN","PSOORRL3",39,0)
 .M ^TMP("PS",$J,J)=^TMP("PSO",$J,PSG,PST,I) S J=J+1
"RTN","PSOORRL3",40,0)
 S PSG="" F  S PSG=$O(^TMP("PS1",$J,PSG)) Q:PSG=""  S PST="" F  S PST=$O(^TMP("PS1",$J,PSG,PST)) Q:PST=""  S I=0 F  S I=$O(^TMP("PS1",$J,PSG,PST,I)) Q:I=""  D
"RTN","PSOORRL3",41,0)
 .M ^TMP("PS",$J,J)=^TMP("PS1",$J,PSG,PST,I) S J=J+1
"RTN","PSOORRL3",42,0)
 K ^TMP("PSO",$J),^TMP("PS1",$J)
"RTN","PSOORRL3",43,0)
 D OCL^PSJORRE(DFN,BDT,EDT,.TFN,+$G(VIEW)) D END^PSOORRL1
"RTN","PSOORRL3",44,0)
 K SDT,SDT1,ST,DRUG,PSG,PST,PSD,EDT,EDT1,BDT,DBT1,X
"RTN","PSOORRL3",45,0)
 Q
"RTN","PSOORRL3",46,0)
NVA ; Set Non-VA Med Orders in the ^TMP Global
"RTN","PSOORRL3",47,0)
 ;BHW;PSO*7*159;New SDT,SDT1 Variables
"RTN","PSOORRL3",48,0)
 N SDT,SDT1
"RTN","PSOORRL3",49,0)
 F I=0:0 S I=$O(^PS(55,DFN,"NVA",I)) Q:'I  S X=$G(^PS(55,DFN,"NVA",I,0)) D
"RTN","PSOORRL3",50,0)
 .Q:'$P(X,"^")!($P(X,"^",7))
"RTN","PSOORRL3",51,0)
 .S DRG=$S($P(X,"^",2):$P($G(^PSDRUG($P(X,"^",2),0)),"^"),1:$P(^PS(50.7,$P(X,"^"),0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,$P(X,"^"),0),"^",2),0),"^"))
"RTN","PSOORRL3",52,0)
 .S SDT=$P(X,"^",9) I 'SDT D TMPBLD Q
"RTN","PSOORRL3",53,0)
 .I $E(SDT,4,5),$E(SDT,6,7) D
"RTN","PSOORRL3",54,0)
 ..;I $P(X,"^",9) D  Q
"RTN","PSOORRL3",55,0)
 ..I $G(BDT),SDT<BDT Q
"RTN","PSOORRL3",56,0)
 ..I $G(EDT),SDT>EDT Q
"RTN","PSOORRL3",57,0)
 ..I $G(BDT),$P(X,"^",7),$P(X,"^",7)<BDT Q
"RTN","PSOORRL3",58,0)
 ..D TMPBLD
"RTN","PSOORRL3",59,0)
 .I $E(SDT,4,5),'$E(SDT,6,7) D
"RTN","PSOORRL3",60,0)
 ..S SDT1=$E(SDT,1,5),BDT1=$E(+$G(BDT),1,5),EDT1=$E(+$G(EDT),1,5)
"RTN","PSOORRL3",61,0)
 ..I $G(BDT1),SDT1<BDT1 Q
"RTN","PSOORRL3",62,0)
 ..I $G(EDT1),SDT1>EDT1 Q
"RTN","PSOORRL3",63,0)
 ..I $G(BDT1),$P(X,"^",7),$E($P(X,"^",7),1,5)<BDT1 Q
"RTN","PSOORRL3",64,0)
 ..D TMPBLD
"RTN","PSOORRL3",65,0)
 .I '$E(SDT,4,5),'$E($P(X,"^",9),6,7) D
"RTN","PSOORRL3",66,0)
 ..;I $P(X,"^",9) D  Q
"RTN","PSOORRL3",67,0)
 ..S SDT1=$E(SDT,1,3),BDT1=$E(+$G(BDT),1,3),EDT1=$E(+$G(EDT),1,3)
"RTN","PSOORRL3",68,0)
 ..I $G(BDT1),SDT1<BDT1 Q
"RTN","PSOORRL3",69,0)
 ..I $G(EDT1),SDT1>EDT1 Q
"RTN","PSOORRL3",70,0)
 ..I $G(BDT1),$P(X,"^",7),$E($P(X,"^",7),1,3)<BDT1 Q
"RTN","PSOORRL3",71,0)
 ..D TMPBLD
"RTN","PSOORRL3",72,0)
 Q
"RTN","PSOORRL3",73,0)
TMPBLD S TFN=$G(TFN)+1,ST="ACTIVE"
"RTN","PSOORRL3",74,0)
 S ^TMP("PS1",$J,DRG,ST,TFN,0)=I_"N;O^"_DRG
"RTN","PSOORRL3",75,0)
 S $P(^TMP("PS1",$J,DRG,ST,TFN,0),"^",8)=$P(X,"^",8)_"^"_$S($P(X,"^",7):"DISCONTINUED",1:"ACTIVE")
"RTN","PSOORRL3",76,0)
 S ^TMP("PS1",$J,DRG,ST,TFN,"SCH",0)=1,^TMP("PS1",$J,DRG,ST,TFN,"SCH",1,0)=$P(X,"^",5)
"RTN","PSOORRL3",77,0)
 S ^TMP("PS1",$J,DRG,ST,TFN,"SIG",0)=1,^TMP("PS1",$J,DRG,ST,TFN,"SIG",1,0)=$P(X,"^",3)_" "_$P(X,"^",4)_" "_$P(X,"^",5)
"RTN","PSOORRL3",78,0)
 Q
"RTN","PSOORRLN")
0^35^B43625961
"RTN","PSOORRLN",1,0)
PSOORRLN ;BHAM ISC/SJA - returns patient's outpatient meds-new sort ;10/12/06
"RTN","PSOORRLN",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**225**;DEC 1997;Build 29
"RTN","PSOORRLN",3,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOORRLN",4,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORRLN",5,0)
 ;External reference to ^VA(200 supported by DBIA 10060
"RTN","PSOORRLN",6,0)
 ;External reference to ^PS(51.2 supported by DBIA 2226
"RTN","PSOORRLN",7,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSOORRLN",8,0)
 ;External reference to ^PS(50.606 supported by DBIA 2174
"RTN","PSOORRLN",9,0)
 ;External reference to OCL^PSJORRE supported by DBIA 2383
"RTN","PSOORRLN",10,0)
OCL ;entry point to return condensed list
"RTN","PSOORRLN",11,0)
 ;BHW;PSO*7*159;New SD* Variables
"RTN","PSOORRLN",12,0)
 N SD,SDT,SDT1,ST,STT,PSG,PST,PSD,GP,DRUG
"RTN","PSOORRLN",13,0)
 D:$P($G(^PS(55,DFN,0)),"^",6)'=2 EN^PSOHLUP(DFN)
"RTN","PSOORRLN",14,0)
 K ^TMP("PS",$J),^TMP("PSO",$J),^TMP("PS1",$J)
"RTN","PSOORRLN",15,0)
 S TFN=0,PSBDT=$G(BDT),PSEDT=$G(EDT) I +$G(PSBDT)<1 S X1=DT,X2=-120 D C^%DTC S PSBDT=X
"RTN","PSOORRLN",16,0)
 S EXDT=PSBDT-1,IFN=0
"RTN","PSOORRLN",17,0)
 F  S EXDT=$O(^PS(55,DFN,"P","A",EXDT)) Q:'EXDT  F  S IFN=$O(^PS(55,DFN,"P","A",EXDT,IFN)) Q:'IFN  D:$D(^PSRX(IFN,0))
"RTN","PSOORRLN",18,0)
 .Q:$P($G(^PSRX(IFN,"STA")),"^")=13
"RTN","PSOORRLN",19,0)
 .S TFN=TFN+1,RX0=^PSRX(IFN,0),RX2=$G(^(2)),RX3=$G(^(3)),STA=+$G(^("STA")),TRM=0,LSTFD=$P(RX2,"^",2),LSTRD=$P(RX2,"^",13),LSTDS=$P(RX0,"^",8)
"RTN","PSOORRLN",20,0)
 .F I=0:0 S I=$O(^PSRX(IFN,1,I)) Q:'I  S TRM=TRM+1,LSTFD=$P(^PSRX(IFN,1,I,0),"^"),LSTDS=$P(^(0),"^",10) S:$P(^(0),"^",18)]"" LSTRD=$P(^(0),"^",18)
"RTN","PSOORRLN",21,0)
 .S ST0=$S(STA<12&($P(RX2,"^",6)<DT):11,1:STA)
"RTN","PSOORRLN",22,0)
 .S STT=$P("ERROR^ACTIVE;1:1^NON-VERIFIED;2:1^REFILL FILL;1:2^HOLD;1:3^NON-VERIFIED;2:1^ACTIVE/SUSP;1:1^^^^^DONE;3:1^EXPIRED;3:2^DISCONTINUED;3:3^DISCONTINUED;3:3^DISCONTINUED;3:3^DISCONTINUED (EDIT);3:6^HOLD;1:3^","^",ST0+2)
"RTN","PSOORRLN",23,0)
 .S ST=$P(STT,";"),GP=$P(STT,";",2)
"RTN","PSOORRLN",24,0)
 .;Status Groups: 1-ACTIVE, 2-PENDING, , 3-DISCONTINUED 
"RTN","PSOORRLN",25,0)
 .S DRUG=$P($G(^PSDRUG(+$P(RX0,"^",6),0)),"^")
"RTN","PSOORRLN",26,0)
 .S ^TMP("PSO",$J,GP,ST,DRUG,TFN,0)=IFN_"R;O"_"^"_DRUG_"^^"_$P(RX2,"^",6)_"^"_($P(RX0,"^",9)-TRM)_"^^^"_$P($G(^PSRX(IFN,"OR1")),"^",2)
"RTN","PSOORRLN",27,0)
 .S ^TMP("PSO",$J,GP,ST,DRUG,TFN,"P",0)=$P(RX0,"^",4)_"^"_$P($G(^VA(200,+$P(RX0,"^",4),0)),"^")
"RTN","PSOORRLN",28,0)
 .S ^TMP("PSO",$J,GP,ST,DRUG,TFN,0)=^TMP("PSO",$J,GP,ST,DRUG,TFN,0)_"^"_ST_"^"_LSTFD_"^"_$P(RX0,"^",8)_"^"_$P(RX0,"^",7)_"^^^"_$P(RX0,"^",13)_"^"_LSTRD_"^"_LSTDS
"RTN","PSOORRLN",29,0)
 .S ^TMP("PSO",$J,GP,ST,DRUG,TFN,"SCH",0)=0
"RTN","PSOORRLN",30,0)
 .S (SCH,SC)=0 F  S SC=$O(^PSRX(IFN,"SCH",SC)) Q:'SC  S SCH=SCH+1,^TMP("PSO",$J,GP,ST,DRUG,TFN,"SCH",SCH,0)=$P(^PSRX(IFN,"SCH",SC,0),"^"),^TMP("PSO",$J,GP,ST,DRUG,TFN,"SCH",0)=^TMP("PSO",$J,GP,ST,DRUG,TFN,"SCH",0)+1
"RTN","PSOORRLN",31,0)
 .S ^TMP("PSO",$J,GP,ST,DRUG,TFN,"MDR",0)=0,(MDR,MR)=0 F  S MR=$O(^PSRX(IFN,"MEDR",MR)) Q:'MR  D
"RTN","PSOORRLN",32,0)
 ..Q:'$D(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0))  S MDR=MDR+1
"RTN","PSOORRLN",33,0)
 ..I $P($G(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0)),"^",3)]"" S ^TMP("PSO",$J,GP,ST,DRUG,TFN,"MDR",MDR,0)=$P(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0),"^",3)
"RTN","PSOORRLN",34,0)
 ..I $D(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0)),$P($G(^(0)),"^",3)']"" S ^TMP("PSO",$J,GP,ST,DRUG,TFN,"MDR",MDR,0)=$P(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0),"^")
"RTN","PSOORRLN",35,0)
 ..S ^TMP("PSO",$J,GP,ST,DRUG,TFN,"MDR",0)=^TMP("PSO",$J,GP,ST,DRUG,TFN,"MDR",0)+1
"RTN","PSOORRLN",36,0)
 .S PSOELSE=0 I $D(^PSRX(IFN,"SIG")),'$P(^PSRX(IFN,"SIG"),"^",2) S PSOELSE=1 S X=$P(^PSRX(IFN,"SIG"),"^") D SIG1^PSOORRL1
"RTN","PSOORRLN",37,0)
 .I '$G(PSOELSE) S ITFN=1 D
"RTN","PSOORRLN",38,0)
 ..S ^TMP("PSO",$J,GP,ST,DRUG,TFN,"SIG",ITFN,0)=$G(^PSRX(IFN,"SIG1",1,0)),^TMP("PSO",$J,GP,ST,DRUG,TFN,"SIG",0)=+$G(^TMP("PSO",$J,GP,ST,DRUG,TFN,"SIG",0))+1
"RTN","PSOORRLN",39,0)
 ..F I=1:0 S I=$O(^PSRX(IFN,"SIG1",I)) Q:'I  S ITFN=ITFN+1,^TMP("PSO",$J,GP,ST,DRUG,TFN,"SIG",ITFN,0)=^PSRX(IFN,"SIG1",I,0),^TMP("PSO",$J,GP,ST,DRUG,TFN,"SIG",0)=+$G(^TMP("PSO",$J,GP,ST,DRUG,TFN,"SIG",0))+1
"RTN","PSOORRLN",40,0)
 K PSOELSE
"RTN","PSOORRLN",41,0)
 S IFN=0 F  S IFN=$O(^PS(52.41,"P",DFN,IFN)) Q:'IFN  S PSOR=^PS(52.41,IFN,0) D:$P(PSOR,"^",3)="" WAIT D:$P(PSOR,"^",3)'="DC"&($P(PSOR,"^",3)'="DE")&($P(PSOR,"^",3)'="")
"RTN","PSOORRLN",42,0)
 .S ST="PENDING",GP="2:4"
"RTN","PSOORRLN",43,0)
 .Q:$P(PSOR,"^",3)="RF"
"RTN","PSOORRLN",44,0)
 .I $P(PSOR,"^",8)="",$P(PSOR,"^",9)="" D WAIT
"RTN","PSOORRLN",45,0)
 .I $P(PSOR,"^",8)="",$P(PSOR,"^",9)="" Q  ; QUIT IF STILL NULL AFTER WAITING
"RTN","PSOORRLN",46,0)
 .S DRUG=$S($P(PSOR,"^",9):$P($G(^PSDRUG($P(PSOR,"^",9),0)),"^"),1:$P(^PS(50.7,$P(PSOR,"^",8),0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,$P(PSOR,"^",8),0),"^",2),0),"^")),TFN=TFN+1,^TMP("PSO",$J,GP,ST,DRUG,TFN,0)=IFN_"P;O^"_DRUG
"RTN","PSOORRLN",47,0)
 .S ^TMP("PSO",$J,GP,ST,DRUG,TFN,0)=^TMP("PSO",$J,GP,ST,DRUG,TFN,0)_"^^^^^^"_$P(PSOR,"^")_"^"_"PENDING^^^"_$P(PSOR,"^",10)_"^"
"RTN","PSOORRLN",48,0)
 .S ^TMP("PSO",$J,GP,ST,DRUG,TFN,0)=^TMP("PSO",$J,GP,ST,DRUG,TFN,0)_"^"_$S($P(PSOR,"^",3)="RNW":1,1:0)
"RTN","PSOORRLN",49,0)
 .S SD=0 F SCH=0:0 S SCH=$O(^PS(52.41,IFN,1,SCH)) Q:'SCH  S SD=SD+1,^TMP("PSO",$J,GP,ST,DRUG,TFN,"SCH",SD,0)=$P(^PS(52.41,IFN,1,SCH,1),"^"),^TMP("PSO",$J,GP,ST,DRUG,TFN,"SCH",0)=SD
"RTN","PSOORRLN",50,0)
 .S SD=0 F SCH=0:0 S SCH=$O(^PS(52.41,IFN,"SIG",SCH)) Q:'SCH  S SD=SD+1,^TMP("PSO",$J,GP,ST,DRUG,TFN,"SIG",SD,0)=$P(^PS(52.41,IFN,"SIG",SCH,0),"^"),^TMP("PSO",$J,GP,ST,DRUG,TFN,"SIG",0)=SD
"RTN","PSOORRLN",51,0)
 .S (IEN,SD)=1,INST=0 F  S INST=$O(^PS(52.41,IFN,2,INST)) Q:'INST  S (MIG,INST(INST))=^PS(52.41,IFN,2,INST,0),^TMP("PSO",$J,GP,ST,DRUG,TFN,"SIO",0)=SD D
"RTN","PSOORRLN",52,0)
 ..F SG=1:1:$L(MIG," ") S:$L($G(^TMP("PSO",$J,GP,ST,DRUG,TFN,"SIO",IEN,0))_" "_$P(MIG," ",SG))>80 IEN=IEN+1,SD=SD+1,^TMP("PSO",$J,GP,ST,DRUG,TFN,"SIO",0)=SD D
"RTN","PSOORRLN",53,0)
 ...S ^TMP("PSO",$J,GP,ST,DRUG,TFN,"SIO",IEN,0)=$G(^TMP("PSO",$J,GP,ST,DRUG,TFN,"SIO",IEN,0))_" "_$P(MIG," ",SG)
"RTN","PSOORRLN",54,0)
 D NVA
"RTN","PSOORRLN",55,0)
 S PSG=0,J=1 F  S PSG=$O(^TMP("PSO",$J,PSG)) Q:'PSG  S PST="" F  S PST=$O(^TMP("PSO",$J,PSG,PST)) Q:PST=""  S PSD="" F  S PSD=$O(^TMP("PSO",$J,PSG,PST,PSD)) Q:PSD=""  S I=0 F  S I=$O(^TMP("PSO",$J,PSG,PST,PSD,I)) Q:'I  D
"RTN","PSOORRLN",56,0)
 .M ^TMP("PS",$J,J)=^TMP("PSO",$J,PSG,PST,PSD,I) S J=J+1
"RTN","PSOORRLN",57,0)
 S PSG=0 F  S PSG=$O(^TMP("PS1",$J,PSG)) Q:'PSG  S PST="" F  S PST=$O(^TMP("PS1",$J,PSG,PST)) Q:PST=""  S PSD="" F  S PSD=$O(^TMP("PS1",$J,PSG,PST,PSD)) Q:PSD=""  S I=0 F  S I=$O(^TMP("PS1",$J,PSG,PST,PSD,I)) Q:'I  D
"RTN","PSOORRLN",58,0)
 .M ^TMP("PS",$J,J)=^TMP("PS1",$J,PSG,PST,PSD,I) S J=J+1
"RTN","PSOORRLN",59,0)
 K ^TMP("PSO",$J),^TMP("PS1",$J)
"RTN","PSOORRLN",60,0)
 D OCL^PSJORRE(DFN,BDT,EDT,.TFN,+$G(VIEW)) D END^PSOORRL1
"RTN","PSOORRLN",61,0)
 K SDT,SDT1,GP,ST,DRUG,PSG,PST,PSD,EDT,EDT1,BDT,DBT1,X
"RTN","PSOORRLN",62,0)
 Q
"RTN","PSOORRLN",63,0)
WAIT ; IF PENDING ENTRY STILL BEING BUILT SEE IF IT COMPLETES WITHIN ANOTHER SECOND
"RTN","PSOORRLN",64,0)
 H 1 S PSOR=$G(^PS(52.41,IFN,0))
"RTN","PSOORRLN",65,0)
 Q
"RTN","PSOORRLN",66,0)
 ;
"RTN","PSOORRLN",67,0)
NVA ; Set Non-VA Med Orders in the ^TMP Global
"RTN","PSOORRLN",68,0)
 ;BHW;PSO*7*159;New SDT,SDT1 Variables
"RTN","PSOORRLN",69,0)
 N SDT,SDT1
"RTN","PSOORRLN",70,0)
 F I=0:0 S I=$O(^PS(55,DFN,"NVA",I)) Q:'I  S X=$G(^PS(55,DFN,"NVA",I,0)) D
"RTN","PSOORRLN",71,0)
 .Q:'$P(X,"^")
"RTN","PSOORRLN",72,0)
 .S DRG=$S($P(X,"^",2):$P($G(^PSDRUG($P(X,"^",2),0)),"^"),1:$P(^PS(50.7,$P(X,"^"),0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,$P(X,"^"),0),"^",2),0),"^"))
"RTN","PSOORRLN",73,0)
 .S SDT=$P(X,"^",9) I 'SDT D TMPBLD Q
"RTN","PSOORRLN",74,0)
 .I $E(SDT,4,5),$E(SDT,6,7) D
"RTN","PSOORRLN",75,0)
 ..;I $P(X,"^",9) D  Q
"RTN","PSOORRLN",76,0)
 ..I $G(BDT),SDT<BDT Q
"RTN","PSOORRLN",77,0)
 ..I $G(EDT),SDT>EDT Q
"RTN","PSOORRLN",78,0)
 ..I $G(BDT),$P(X,"^",7),$P(X,"^",7)<BDT Q
"RTN","PSOORRLN",79,0)
 ..D TMPBLD
"RTN","PSOORRLN",80,0)
 .I $E(SDT,4,5),'$E(SDT,6,7) D
"RTN","PSOORRLN",81,0)
 ..S SDT1=$E(SDT,1,5),BDT1=$E(+$G(BDT),1,5),EDT1=$E(+$G(EDT),1,5)
"RTN","PSOORRLN",82,0)
 ..I $G(BDT1),SDT1<BDT1 Q
"RTN","PSOORRLN",83,0)
 ..I $G(EDT1),SDT1>EDT1 Q
"RTN","PSOORRLN",84,0)
 ..I $G(BDT1),$P(X,"^",7),$E($P(X,"^",7),1,5)<BDT1 Q
"RTN","PSOORRLN",85,0)
 ..D TMPBLD
"RTN","PSOORRLN",86,0)
 .I '$E(SDT,4,5),'$E($P(X,"^",9),6,7) D
"RTN","PSOORRLN",87,0)
 ..;I $P(X,"^",9) D  Q
"RTN","PSOORRLN",88,0)
 ..S SDT1=$E(SDT,1,3),BDT1=$E(+$G(BDT),1,3),EDT1=$E(+$G(EDT),1,3)
"RTN","PSOORRLN",89,0)
 ..I $G(BDT1),SDT1<BDT1 Q
"RTN","PSOORRLN",90,0)
 ..I $G(EDT1),SDT1>EDT1 Q
"RTN","PSOORRLN",91,0)
 ..I $G(BDT1),$P(X,"^",7),$E($P(X,"^",7),1,3)<BDT1 Q
"RTN","PSOORRLN",92,0)
 ..D TMPBLD
"RTN","PSOORRLN",93,0)
 Q
"RTN","PSOORRLN",94,0)
TMPBLD S TFN=$G(TFN)+1
"RTN","PSOORRLN",95,0)
 S ST=$S($P(X,"^",7):"DISCONTINUED",1:"ACTIVE"),GP=$S(ST="ACTIVE":1,1:3)
"RTN","PSOORRLN",96,0)
 S ^TMP("PS1",$J,GP,ST,DRG,TFN,0)=I_"N;O^"_DRG
"RTN","PSOORRLN",97,0)
 S $P(^TMP("PS1",$J,GP,ST,DRG,TFN,0),"^",8)=$P(X,"^",8)_"^"_$S($P(X,"^",7):"DISCONTINUED",1:"ACTIVE")
"RTN","PSOORRLN",98,0)
 S ^TMP("PS1",$J,GP,ST,DRG,TFN,"SCH",0)=1,^TMP("PS1",$J,GP,ST,DRG,TFN,"SCH",1,0)=$P(X,"^",5)
"RTN","PSOORRLN",99,0)
 S ^TMP("PS1",$J,GP,ST,DRG,TFN,"SIG",0)=1,^TMP("PS1",$J,GP,ST,DRG,TFN,"SIG",1,0)=$P(X,"^",3)_" "_$P(X,"^",4)_" "_$P(X,"^",5)
"RTN","PSOORRLN",100,0)
 Q
"RTN","PSOORRLO")
0^36^B39129717
"RTN","PSOORRLO",1,0)
PSOORRLO ;BHAM ISC/SJA - returns patient's outpatient meds-original sort ;10/12/06
"RTN","PSOORRLO",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**225**;DEC 1997;Build 29
"RTN","PSOORRLO",3,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOORRLO",4,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORRLO",5,0)
 ;External reference to ^VA(200 supported by DBIA 10060
"RTN","PSOORRLO",6,0)
 ;External reference to(51.2 supported by DBIA 2226
"RTN","PSOORRLO",7,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSOORRLO",8,0)
 ;External reference to ^PS(50.606 supported by DBIA 2174
"RTN","PSOORRLO",9,0)
 ;External reference to OCL^PSJORRE supported by DBIA 2383
"RTN","PSOORRLO",10,0)
OCL ;entry point to return condensed list
"RTN","PSOORRLO",11,0)
 ;BHW;PSO*7*159;New SD* Variables
"RTN","PSOORRLO",12,0)
 N SD,SDT,SDT1,ST,STT,PSEX,PSG,PST,GP,EXDT1
"RTN","PSOORRLO",13,0)
 D:$P($G(^PS(55,DFN,0)),"^",6)'=2 EN^PSOHLUP(DFN)
"RTN","PSOORRLO",14,0)
 K ^TMP("PS",$J),^TMP("PSO",$J),^TMP("PS1",$J)
"RTN","PSOORRLO",15,0)
 S TFN=0,PSBDT=$G(BDT),PSEDT=$G(EDT) I +$G(PSBDT)<1 S X1=DT,X2=-120 D C^%DTC S PSBDT=X
"RTN","PSOORRLO",16,0)
 S EXDT=PSBDT-1,IFN=0
"RTN","PSOORRLO",17,0)
 F  S EXDT=$O(^PS(55,DFN,"P","A",EXDT)) Q:'EXDT  F  S IFN=$O(^PS(55,DFN,"P","A",EXDT,IFN)) Q:'IFN  D:$D(^PSRX(IFN,0))
"RTN","PSOORRLO",18,0)
 .S EXDT1=9999999-EXDT
"RTN","PSOORRLO",19,0)
 .Q:$P($G(^PSRX(IFN,"STA")),"^")=13
"RTN","PSOORRLO",20,0)
 .S TFN=TFN+1,RX0=^PSRX(IFN,0),RX2=$G(^(2)),RX3=$G(^(3)),STA=+$G(^("STA")),TRM=0,LSTFD=$P(RX2,"^",2),LSTRD=$P(RX2,"^",13),LSTDS=$P(RX0,"^",8)
"RTN","PSOORRLO",21,0)
 .F I=0:0 S I=$O(^PSRX(IFN,1,I)) Q:'I  S TRM=TRM+1,LSTFD=$P(^PSRX(IFN,1,I,0),"^"),LSTDS=$P(^(0),"^",10) S:$P(^(0),"^",18)]"" LSTRD=$P(^(0),"^",18)
"RTN","PSOORRLO",22,0)
 .S ST0=$S(STA<12&($P(RX2,"^",6)<DT):11,1:STA)
"RTN","PSOORRLO",23,0)
 .S STT=$P("ERROR^ACTIVE;2:1^NON-VERIFIED;1:1^REFILL FILL;2:3^HOLD;2:7^NON-VERIFIED;1:1^ACTIVE/SUSP;2:6^^^^^DONE;2:9^EXPIRED;3:1^DISCONTINUED;4:3^DISCONTINUED;4:3^DISCONTINUED;4:3^DISCONTINUED (EDIT);4:4^HOLD;2:7^","^",ST0+2)
"RTN","PSOORRLO",24,0)
 .S ST=$P(STT,";"),GP=$P(STT,";",2)
"RTN","PSOORRLO",25,0)
 .;Status Groups: 1-PENDING, 2-ACTIVE, 3-Expired, 4-DISCONTINUED 
"RTN","PSOORRLO",26,0)
 .S ^TMP("PSO",$J,GP,EXDT1,TFN,0)=IFN_"R;O"_"^"_$P($G(^PSDRUG(+$P(RX0,"^",6),0)),"^")_"^^"_$P(RX2,"^",6)_"^"_($P(RX0,"^",9)-TRM)_"^^^"_$P($G(^PSRX(IFN,"OR1")),"^",2)
"RTN","PSOORRLO",27,0)
 .S ^TMP("PSO",$J,GP,EXDT1,TFN,"P",0)=$P(RX0,"^",4)_"^"_$P($G(^VA(200,+$P(RX0,"^",4),0)),"^")
"RTN","PSOORRLO",28,0)
 .S ^TMP("PSO",$J,GP,EXDT1,TFN,0)=^TMP("PSO",$J,GP,EXDT1,TFN,0)_"^"_ST_"^"_LSTFD_"^"_$P(RX0,"^",8)_"^"_$P(RX0,"^",7)_"^^^"_$P(RX0,"^",13)_"^"_LSTRD_"^"_LSTDS
"RTN","PSOORRLO",29,0)
 .S ^TMP("PSO",$J,GP,EXDT1,TFN,"SCH",0)=0
"RTN","PSOORRLO",30,0)
 .S (SCH,SC)=0 F  S SC=$O(^PSRX(IFN,"SCH",SC)) Q:'SC  S SCH=SCH+1,^TMP("PSO",$J,GP,EXDT1,TFN,"SCH",SCH,0)=$P(^PSRX(IFN,"SCH",SC,0),"^"),^TMP("PSO",$J,GP,EXDT1,TFN,"SCH",0)=^TMP("PSO",$J,GP,EXDT1,TFN,"SCH",0)+1
"RTN","PSOORRLO",31,0)
 .S ^TMP("PSO",$J,GP,EXDT1,TFN,"MDR",0)=0,(MDR,MR)=0 F  S MR=$O(^PSRX(IFN,"MEDR",MR)) Q:'MR  D
"RTN","PSOORRLO",32,0)
 ..Q:'$D(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0))  S MDR=MDR+1
"RTN","PSOORRLO",33,0)
 ..I $P($G(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0)),"^",3)]"" S ^TMP("PSO",$J,GP,EXDT1,TFN,"MDR",MDR,0)=$P(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0),"^",3)
"RTN","PSOORRLO",34,0)
 ..I $D(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0)),$P($G(^(0)),"^",3)']"" S ^TMP("PSO",$J,GP,EXDT1,TFN,"MDR",MDR,0)=$P(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0),"^")
"RTN","PSOORRLO",35,0)
 ..S ^TMP("PSO",$J,GP,EXDT1,TFN,"MDR",0)=^TMP("PSO",$J,GP,EXDT1,TFN,"MDR",0)+1
"RTN","PSOORRLO",36,0)
 .S PSOELSE=0 I $D(^PSRX(IFN,"SIG")),'$P(^PSRX(IFN,"SIG"),"^",2) S PSOELSE=1 S X=$P(^PSRX(IFN,"SIG"),"^") D SIG1^PSOORRL1
"RTN","PSOORRLO",37,0)
 .I '$G(PSOELSE) S ITFN=1 D
"RTN","PSOORRLO",38,0)
 ..S ^TMP("PSO",$J,GP,EXDT1,TFN,"SIG",ITFN,0)=$G(^PSRX(IFN,"SIG1",1,0)),^TMP("PSO",$J,GP,EXDT1,TFN,"SIG",0)=+$G(^TMP("PSO",$J,GP,EXDT1,TFN,"SIG",0))+1
"RTN","PSOORRLO",39,0)
 ..F I=1:0 S I=$O(^PSRX(IFN,"SIG1",I)) Q:'I  S ITFN=ITFN+1,^TMP("PSO",$J,GP,EXDT1,TFN,"SIG",ITFN,0)=^PSRX(IFN,"SIG1",I,0),^TMP("PSO",$J,GP,EXDT1,TFN,"SIG",0)=+$G(^TMP("PSO",$J,GP,EXDT1,TFN,"SIG",0))+1
"RTN","PSOORRLO",40,0)
 K PSOELSE
"RTN","PSOORRLO",41,0)
 S IFN=0 F  S IFN=$O(^PS(52.41,"P",DFN,IFN)) Q:'IFN  S PSOR=^PS(52.41,IFN,0) D:$P(PSOR,"^",3)="" WAIT D:$P(PSOR,"^",3)'="DC"&($P(PSOR,"^",3)'="DE")&($P(PSOR,"^",3)'="")
"RTN","PSOORRLO",42,0)
 .S GP="1:3",PSEX="9999999"
"RTN","PSOORRLO",43,0)
 .Q:$P(PSOR,"^",3)="RF"
"RTN","PSOORRLO",44,0)
 .I $P(PSOR,"^",8)="",$P(PSOR,"^",9)="" D WAIT
"RTN","PSOORRLO",45,0)
 .I $P(PSOR,"^",8)="",$P(PSOR,"^",9)="" Q  ; QUIT IF STILL NULL AFTER WAITING
"RTN","PSOORRLO",46,0)
 .S TFN=TFN+1,^TMP("PSO",$J,GP,PSEX,TFN,0)=IFN_"P;O^"_$S($P(PSOR,"^",9):$P($G(^PSDRUG($P(PSOR,"^",9),0)),"^"),1:$P(^PS(50.7,$P(PSOR,"^",8),0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,$P(PSOR,"^",8),0),"^",2),0),"^"))
"RTN","PSOORRLO",47,0)
 .S ^TMP("PSO",$J,GP,PSEX,TFN,0)=^TMP("PSO",$J,GP,PSEX,TFN,0)_"^^^^^^"_$P(PSOR,"^")_"^"_"PENDING^^^"_$P(PSOR,"^",10)_"^"
"RTN","PSOORRLO",48,0)
 .S ^TMP("PSO",$J,GP,PSEX,TFN,0)=^TMP("PSO",$J,GP,PSEX,TFN,0)_"^"_$S($P(PSOR,"^",3)="RNW":1,1:0)
"RTN","PSOORRLO",49,0)
 .S SD=0 F SCH=0:0 S SCH=$O(^PS(52.41,IFN,1,SCH)) Q:'SCH  S SD=SD+1,^TMP("PSO",$J,GP,PSEX,TFN,"SCH",SD,0)=$P(^PS(52.41,IFN,1,SCH,1),"^"),^TMP("PSO",$J,GP,PSEX,TFN,"SCH",0)=SD
"RTN","PSOORRLO",50,0)
 .S SD=0 F SCH=0:0 S SCH=$O(^PS(52.41,IFN,"SIG",SCH)) Q:'SCH  S SD=SD+1,^TMP("PSO",$J,GP,PSEX,TFN,"SIG",SD,0)=$P(^PS(52.41,IFN,"SIG",SCH,0),"^"),^TMP("PSO",$J,GP,PSEX,TFN,"SIG",0)=SD
"RTN","PSOORRLO",51,0)
 .S (IEN,SD)=1,INST=0 F  S INST=$O(^PS(52.41,IFN,2,INST)) Q:'INST  S (MIG,INST(INST))=^PS(52.41,IFN,2,INST,0),^TMP("PSO",$J,GP,PSEX,TFN,"SIO",0)=SD D
"RTN","PSOORRLO",52,0)
 ..F SG=1:1:$L(MIG," ") S:$L($G(^TMP("PSO",$J,GP,PSEX,TFN,"SIO",IEN,0))_" "_$P(MIG," ",SG))>80 IEN=IEN+1,SD=SD+1,^TMP("PSO",$J,GP,PSEX,TFN,"SIO",0)=SD D
"RTN","PSOORRLO",53,0)
 ...S ^TMP("PSO",$J,GP,PSEX,TFN,"SIO",IEN,0)=$G(^TMP("PSO",$J,GP,PSEX,TFN,"SIO",IEN,0))_" "_$P(MIG," ",SG)
"RTN","PSOORRLO",54,0)
 D NVA
"RTN","PSOORRLO",55,0)
 S PSG=0,J=1 F  S PSG=$O(^TMP("PSO",$J,PSG)) Q:'PSG  S PST="" F  S PST=$O(^TMP("PSO",$J,PSG,PST)) Q:PST=""  S I=0 F  S I=$O(^TMP("PSO",$J,PSG,PST,I)) Q:'I  D
"RTN","PSOORRLO",56,0)
 .M ^TMP("PS",$J,J)=^TMP("PSO",$J,PSG,PST,I) S J=J+1
"RTN","PSOORRLO",57,0)
 S PSG=0 F  S PSG=$O(^TMP("PS1",$J,PSG)) Q:'PSG  S I=0 F  S I=$O(^TMP("PS1",$J,PSG,I)) Q:'I  D
"RTN","PSOORRLO",58,0)
 .M ^TMP("PS",$J,J)=^TMP("PS1",$J,PSG,I) S J=J+1
"RTN","PSOORRLO",59,0)
 K ^TMP("PSO",$J),^TMP("PS1",$J)
"RTN","PSOORRLO",60,0)
 D OCL^PSJORRE(DFN,BDT,EDT,.TFN,+$G(VIEW)) D END^PSOORRL1
"RTN","PSOORRLO",61,0)
 K SDT,SDT1,GP,PSEX,PSG,PST,EDT,EDT1,BDT,DBT1,X
"RTN","PSOORRLO",62,0)
 Q
"RTN","PSOORRLO",63,0)
WAIT ; IF PENDING ENTRY STILL BEING BUILT SEE IF IT COMPLETES WITHIN ANOTHER SECOND
"RTN","PSOORRLO",64,0)
 H 1 S PSOR=$G(^PS(52.41,IFN,0))
"RTN","PSOORRLO",65,0)
 Q
"RTN","PSOORRLO",66,0)
 ;
"RTN","PSOORRLO",67,0)
NVA ; Set Non-VA Med Orders in the ^TMP Global
"RTN","PSOORRLO",68,0)
 ;BHW;PSO*7*159;New SDT,SDT1 Variables
"RTN","PSOORRLO",69,0)
 N SDT,SDT1
"RTN","PSOORRLO",70,0)
 F I=0:0 S I=$O(^PS(55,DFN,"NVA",I)) Q:'I  S X=$G(^PS(55,DFN,"NVA",I,0)) D
"RTN","PSOORRLO",71,0)
 .Q:'$P(X,"^")
"RTN","PSOORRLO",72,0)
 .S DRG=$S($P(X,"^",2):$P($G(^PSDRUG($P(X,"^",2),0)),"^"),1:$P(^PS(50.7,$P(X,"^"),0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,$P(X,"^"),0),"^",2),0),"^"))
"RTN","PSOORRLO",73,0)
 .S SDT=$P(X,"^",9) I 'SDT D TMPBLD Q
"RTN","PSOORRLO",74,0)
 .I $E(SDT,4,5),$E(SDT,6,7) D
"RTN","PSOORRLO",75,0)
 ..;I $P(X,"^",9) D  Q
"RTN","PSOORRLO",76,0)
 ..I $G(BDT),SDT<BDT Q
"RTN","PSOORRLO",77,0)
 ..I $G(EDT),SDT>EDT Q
"RTN","PSOORRLO",78,0)
 ..I $G(BDT),$P(X,"^",7),$P(X,"^",7)<BDT Q
"RTN","PSOORRLO",79,0)
 ..D TMPBLD
"RTN","PSOORRLO",80,0)
 .I $E(SDT,4,5),'$E(SDT,6,7) D
"RTN","PSOORRLO",81,0)
 ..S SDT1=$E(SDT,1,5),BDT1=$E(+$G(BDT),1,5),EDT1=$E(+$G(EDT),1,5)
"RTN","PSOORRLO",82,0)
 ..I $G(BDT1),SDT1<BDT1 Q
"RTN","PSOORRLO",83,0)
 ..I $G(EDT1),SDT1>EDT1 Q
"RTN","PSOORRLO",84,0)
 ..I $G(BDT1),$P(X,"^",7),$E($P(X,"^",7),1,5)<BDT1 Q
"RTN","PSOORRLO",85,0)
 ..D TMPBLD
"RTN","PSOORRLO",86,0)
 .I '$E(SDT,4,5),'$E($P(X,"^",9),6,7) D
"RTN","PSOORRLO",87,0)
 ..;I $P(X,"^",9) D  Q
"RTN","PSOORRLO",88,0)
 ..S SDT1=$E(SDT,1,3),BDT1=$E(+$G(BDT),1,3),EDT1=$E(+$G(EDT),1,3)
"RTN","PSOORRLO",89,0)
 ..I $G(BDT1),SDT1<BDT1 Q
"RTN","PSOORRLO",90,0)
 ..I $G(EDT1),SDT1>EDT1 Q
"RTN","PSOORRLO",91,0)
 ..I $G(BDT1),$P(X,"^",7),$E($P(X,"^",7),1,3)<BDT1 Q
"RTN","PSOORRLO",92,0)
 ..D TMPBLD
"RTN","PSOORRLO",93,0)
 Q
"RTN","PSOORRLO",94,0)
TMPBLD S TFN=$G(TFN)+1,GP=$S($P(X,"^",7):3,1:2)
"RTN","PSOORRLO",95,0)
 S ^TMP("PS1",$J,GP,TFN,0)=I_"N;O^"_DRG
"RTN","PSOORRLO",96,0)
 S $P(^TMP("PS1",$J,GP,TFN,0),"^",8)=$P(X,"^",8)_"^"_$S($P(X,"^",7):"DISCONTINUED",1:"ACTIVE")
"RTN","PSOORRLO",97,0)
 S ^TMP("PS1",$J,GP,TFN,"SCH",0)=1,^TMP("PS1",$J,GP,TFN,"SCH",1,0)=$P(X,"^",5)
"RTN","PSOORRLO",98,0)
 S ^TMP("PS1",$J,GP,TFN,"SIG",0)=1,^TMP("PS1",$J,GP,TFN,"SIG",1,0)=$P(X,"^",3)_" "_$P(X,"^",4)_" "_$P(X,"^",5)
"RTN","PSOORRLO",99,0)
 Q
"RTN","PSOORRNW")
0^66^B24091362
"RTN","PSOORRNW",1,0)
PSOORRNW ;BIR/SAB-finish OP renew orders from OE/RR ;4/25/07 8:46am
"RTN","PSOORRNW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,27,51,46,71,94,130,131,146,206,225**;DEC 1997;Build 29
"RTN","PSOORRNW",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORRNW",4,0)
 ;External reference to ^PS(50.607 supported by DBIA 2221
"RTN","PSOORRNW",5,0)
 ;External reference to ^PS(51.2 supported by DBIA 2226
"RTN","PSOORRNW",6,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOORRNW",7,0)
 S PSORENXX=$P($G(OR0),"^",21),PSOFROM="NEW" K PRC,PHI
"RTN","PSOORRNW",8,0)
 I $G(PSORENXX) D PSOL^PSSLOCK(PSORENXX) I '$G(PSOMSG) D  K DIR,PSOMSG W ! S DIR("A")="Press Return to continue",DIR(0)="E" D ^DIR K DIR W ! Q
"RTN","PSOORRNW",9,0)
 .I $P($G(PSOMSG),"^",2)'="" W $C(7),!!,$P(PSOMSG,"^",2) Q
"RTN","PSOORRNW",10,0)
 .W $C(7),!!,"Another person is editing Rx "_$P($G(^PSRX(PSORENXX,0)),"^")
"RTN","PSOORRNW",11,0)
 K PSOMSG N OI,VALMCNT K POERR("DFLG") D FULL^VALM1 S (PSORX("DFLG"),PSORENW("DFLG"))=0,(PSORNW("FILL DATE"),PSORENW("FILL DATE"))=DT
"RTN","PSOORRNW",12,0)
 S Y=DT X ^DD("DD") S PSORX("FILL DATE")=Y K Y
"RTN","PSOORRNW",13,0)
 ;
"RTN","PSOORRNW",14,0)
 I $G(ORD),+$P($G(^PS(52.41,+ORD,0)),"^",23)=1 D  Q:$D(DIRUT)!'Y  D EN1^ORCFLAG(+$P($G(^PS(52.41,ORD,0)),"^")) H 1
"RTN","PSOORRNW",15,0)
 . K DIRUT,DUOUT,DTOUT,DIR
"RTN","PSOORRNW",16,0)
 . S DIR("A",1)="This Renewal Request is flagged. In order to process it"
"RTN","PSOORRNW",17,0)
 . S DIR("A",2)="you must unflag it first."
"RTN","PSOORRNW",18,0)
 . S DIR("A",3)=""
"RTN","PSOORRNW",19,0)
 . S DIR(0)="Y",DIR("A")="Unflag Renewal Request",DIR("B")="NO"
"RTN","PSOORRNW",20,0)
 . W ! D ^DIR I $D(DIRUT)!'Y S VALMBCK="Q"
"RTN","PSOORRNW",21,0)
 I $G(ORD),+$P($G(^PS(52.41,+ORD,0)),"^",23)=1 Q
"RTN","PSOORRNW",22,0)
 ;
"RTN","PSOORRNW",23,0)
 W !!,"Now Renewing Rx # "_$P(^PSRX($P(OR0,"^",21),0),"^")_"   Drug: "_$P($G(^PSDRUG($P(^PSRX($P(OR0,"^",21),0),"^",6),0)),"^"),! H 2
"RTN","PSOORRNW",24,0)
 I $P($G(^PSRX($P(OR0,"^",21),"OR1")),"^",4) D  D PROCESSX^PSORENW0 D UL Q
"RTN","PSOORRNW",25,0)
 .W !!,"Cannot Renew Rx # "_$P(^PSRX($P(OR0,"^",21),0),"^"),!," Drug: "_$P($G(^PSDRUG($P(^PSRX($P(OR0,"^",21),0),"^",6),0)),"^")_"."
"RTN","PSOORRNW",26,0)
 .W !,"This Rx has already been RENEWED ("_$P(^PSRX($P(^PSRX($P(OR0,"^",21),"OR1"),"^",4),0),"^")_").",!
"RTN","PSOORRNW",27,0)
 .S ACOM="Duplicate Renewal Request. Order rejected by Pharmacy.",PSONOOR="D" D DE^PSOORFI2 K ACOM,POERR("COMM"),POERR("PLACER"),POERR("STAT")
"RTN","PSOORRNW",28,0)
 I '$G(PSOTPBFG) D DSPL^PSOTPCAN(ORD)
"RTN","PSOORRNW",29,0)
 S (PSORX("PROVIDER NAME"),PSORENW("PROVIDER NAME"))=$P(^VA(200,$P(OR0,"^",5),0),"^"),PSORENW("NOO")=$P(OR0,"^",7)
"RTN","PSOORRNW",30,0)
 S PSORENW("PROVIDER")=$P(OR0,"^",5),PSORENW("MAIL/WINDOW")=$S($P(OR0,"^",17)="M":"M",1:"W")
"RTN","PSOORRNW",31,0)
 ;I $O(^PSRX($P(OR0,"^",21),"PRC",0)) F I=0:0 S I=$O(^PSRX($P(OR0,"^",21),"PRC",I)) Q:'I  S PRC(I)=^PSRX($P(OR0,"^",21),"PRC",I,0)
"RTN","PSOORRNW",32,0)
 K II F I=0:0 S I=$O(^PS(52.41,ORD,1,I)) Q:'I  S DOSE=$G(^PS(52.41,ORD,1,I,1)),DOSE1=$G(^(2)) D 
"RTN","PSOORRNW",33,0)
 .S II=$G(II)+1
"RTN","PSOORRNW",34,0)
 .S PSORENW("DOSE",II)=$P(DOSE1,"^"),PSORENW("DOSE ORDERED",II)=$P(DOSE1,"^",2),PSORENW("UNITS",II)=$P(DOSE,"^",9),PSORENW("NOUN",II)=$P(DOSE,"^",5)
"RTN","PSOORRNW",35,0)
 .S:$P(DOSE,"^",9) UNITS=$P(^PS(50.607,$P(DOSE,"^",9),0),"^")
"RTN","PSOORRNW",36,0)
 .S PSORENW("VERB",II)=$P(DOSE,"^",10),PSORENW("ROUTE",II)=$P(DOSE,"^",8)
"RTN","PSOORRNW",37,0)
 .S:$P(DOSE,"^",8) ROUTE=$P(^PS(51.2,$P(DOSE,"^",8),0),"^")
"RTN","PSOORRNW",38,0)
 .S PSORENW("SCHEDULE",II)=$P(DOSE,"^"),PSORENW("DURATION",II)=$P(DOSE,"^",2)
"RTN","PSOORRNW",39,0)
 .I $P(DOSE,"^",6)]"" S PSORENW("CONJUNCTION",II)=$S($P(DOSE,"^",6)="S":"T",$P(DOSE,"^",6)="X":"X",1:"A")
"RTN","PSOORRNW",40,0)
 S PSORENW("ENT")=+$G(II) K II,I
"RTN","PSOORRNW",41,0)
 F DR=1:1:PSORENW("ENT") I $G(PSORENW("DURATION",DR))]"" D
"RTN","PSOORRNW",42,0)
 .S DUR1=PSORENW("DURATION",DR)
"RTN","PSOORRNW",43,0)
 .S PSORENW("DURATION",DR)=$S($E(DUR1,1)'?.N:$E(DUR1,2,99)_$E(DUR1,1),1:DUR1)
"RTN","PSOORRNW",44,0)
 D ^PSORENW1,CHECK^PSORENW0 I PSORENW("DFLG") D KLIB^PSORENW1 D PROCESSX^PSORENW0 D UL Q
"RTN","PSOORRNW",45,0)
 D FILDATE^PSORENW0,DRUG^PSORENW0 I PSORENW("DFLG")!$G(PSORX("DFLG")) D KLIB^PSORENW1 D PROCESSX^PSORENW0 D UL Q
"RTN","PSOORRNW",46,0)
 D RXN^PSORENW0 I PSORENW("DFLG") D KLIB^PSORENW1 D PROCESSX^PSORENW0 D UL Q
"RTN","PSOORRNW",47,0)
 D STOP^PSORENW1,INIT^PSORENW3
"RTN","PSOORRNW",48,0)
 I $G(PSOORRNW) D
"RTN","PSOORRNW",49,0)
 .S PSORENW("ISSUE DATE")=$S(PSORENW("FILL DATE")>DT:DT,PSORENW("FILL DATE")<$E($P(OR0,"^",6),1,7):PSORENW("FILL DATE"),1:$E($P(OR0,"^",6),1,7))
"RTN","PSOORRNW",50,0)
 .S PSORENW("# OF REFILLS")=+$P(OR0,"^",11),PSOFDR=1
"RTN","PSOORRNW",51,0)
 .S PSORENW("CLERK CODE")=$P(OR0,"^",4),PSORX("CLERK CODE")=$P(^VA(200,$P(OR0,"^",4),0),"^")
"RTN","PSOORRNW",52,0)
 ;D CHK
"RTN","PSOORRNW",53,0)
 S PSOFXRN=0,PSOFXRNX=1
"RTN","PSOORRNW",54,0)
 S PSORENW("POE")=$S($G(^PS(52.41,ORD,"POE"))=1:1,'$O(^PSRX($P(OR0,"^",21),6,0)):1,1:"")
"RTN","PSOORRNW",55,0)
 S PSORENW("PENDING ORDER")=ORD
"RTN","PSOORRNW",56,0)
 D EN^PSOORNE4(.PSORENW) K PSORENW,PSORX("FILL DATE")
"RTN","PSOORRNW",57,0)
 I '$G(PSOFXRN) D UL
"RTN","PSOORRNW",58,0)
 D KLIB^PSORENW1
"RTN","PSOORRNW",59,0)
 K PSOFXRN,PSOFXRNX
"RTN","PSOORRNW",60,0)
 Q
"RTN","PSOORRNW",61,0)
CHK ;check for valid # of refills
"RTN","PSOORRNW",62,0)
 I $G(PSODRUG("DEA"))]"" D
"RTN","PSOORRNW",63,0)
 .S PSOCS=0 K DIR,DIC,PSOX
"RTN","PSOORRNW",64,0)
 .F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S $P(PSOCS,"^")=1 S:$E(+PSODRUG("DEA"),DEA)=2 $P(PSOCS,"^",2)=1
"RTN","PSOORRNW",65,0)
 .;PSO*7*206
"RTN","PSOORRNW",66,0)
 .S PSOMAX=$S(PSOCS:5,1:11) I PSODRUG("DEA")["A"&(PSODRUG("DEA")'["B")!(PSODRUG("DEA")["F")!(PSODRUG("DEA")[1)!(PSODRUG("DEA")[2) S PSOMAX=0
"RTN","PSOORRNW",67,0)
 E  S PSOMAX=$P(OR0,"^",11)
"RTN","PSOORRNW",68,0)
 S RXPT=+$P(PSORENW("RX0"),"^",3) I $G(^PS(53,RXPT,0))]"" D
"RTN","PSOORRNW",69,0)
 .S PSORENW("# OF REFILLS")=$S(+$P(OR0,"^",11)>+$P(^PS(53,RXPT,0),"^",4):+$P(^PS(53,RXPT,0),"^",4),1:+$P(OR0,"^",11)),PSOX=+$P(^PS(53,RXPT,0),"^",4)
"RTN","PSOORRNW",70,0)
 .S PSORENW("# OF REFILLS")=$S(PSORENW("# OF REFILLS")>PSOMAX:PSOMAX,1:PSORENW("# OF REFILLS"))
"RTN","PSOORRNW",71,0)
 .S PSOMAX=$S(PSOMAX>+$P(^PS(53,RXPT,0),"^",4):+$P(^PS(53,RXPT,0),"^",4),1:PSOMAX) K RXPT
"RTN","PSOORRNW",72,0)
 E  D
"RTN","PSOORRNW",73,0)
 . I $G(PSOMAX) S PSORENW("# OF REFILLS")=$S(+$P(OR0,"^",11)>PSOMAX:PSOMAX,1:+$P(OR0,"^",11))
"RTN","PSOORRNW",74,0)
 Q
"RTN","PSOORRNW",75,0)
 ;
"RTN","PSOORRNW",76,0)
EDTPEN ;edit front door renews
"RTN","PSOORRNW",77,0)
 N VALMCNT S Y=$P(XQORNOD(0),"=",2) D EDTSEL^PSOORNE4
"RTN","PSOORRNW",78,0)
 Q
"RTN","PSOORRNW",79,0)
UL I $G(PSORENXX) D PSOUL^PSSLOCK(PSORENXX)
"RTN","PSOORRNW",80,0)
 K PSORENXX
"RTN","PSOORRNW",81,0)
 Q
"RTN","PSOORUT1")
0^50^B67437810
"RTN","PSOORUT1",1,0)
PSOORUT1 ;BIR/SAB - Utility routine for oerr interface ;6/28/07 7:36am
"RTN","PSOORUT1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,14,30,46,132,148,233,274,225**;DEC 1997;Build 29
"RTN","PSOORUT1",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORUT1",4,0)
 ;External reference to ^PSXOPUTL supported by DBIA 2203
"RTN","PSOORUT1",5,0)
 ;called from HD^PSOORUTL
"RTN","PSOORUT1",6,0)
REL ;removed order from hold
"RTN","PSOORUT1",7,0)
 S ACT=1,ORS=0
"RTN","PSOORUT1",8,0)
 I POERR("PSOFILNM")["S" S DA=+POERR("PSOFILNM") D  G EXIT^PSOORUTL
"RTN","PSOORUT1",9,0)
 .Q:'$D(^PS(52.41,DA,0))  Q:$P(^PS(52.41,DA,0),"^",3)="RF"
"RTN","PSOORUT1",10,0)
 .S $P(^PS(52.41,DA,0),"^",3)="NW",POERR("STAT")="OR",POERR("FILLER")=DA_"^P"
"RTN","PSOORUT1",11,0)
 .S:$G(POERR("COMM"))']"" POERR("COMM")="Order RELEASED from HOLD by OE/RR before finished." S $P(^PS(52.41,DA,4),"^")=POERR("COMM"),ORS=1
"RTN","PSOORUT1",12,0)
 S DA=POERR("PSOFILNM") I $D(^PSRX(DA,0)) S ORS=1,PSDA=DA D  G EXIT^PSOORUTL
"RTN","PSOORUT1",13,0)
 .S POERR("FILLER")=DA_"^R",POERR("STAT")="OR"
"RTN","PSOORUT1",14,0)
 .S:'$D(POERR("COMM")) POERR("COMM")="Prescription Released from HOLD by OE/RR"
"RTN","PSOORUT1",15,0)
 .I DT>$P(^PSRX(DA,2),"^",6) D
"RTN","PSOORUT1",16,0)
 ..S EXP=$P(^PSRX(DA,2),"^",6) S:$P(^PSRX(DA,"STA"),"^")<12 $P(^PSRX(DA,"STA"),"^")=11,PSOEXFLG=1 S POERR("STAT")="UR",POERR("COMM")="Medication Expired on "_$E(EXP,4,5)_"/"_$E(EXP,6,7)_"/"_$E(EXP,2,3)_".",POERR("PHARMST")="" D ECAN^PSOUTL(DA) Q
"RTN","PSOORUT1",17,0)
 .I $P(^PSRX(DA,"STA"),"^")'=16 S POERR("STAT")="UR",POERR("COMM")="Unable to Release from Hold" Q
"RTN","PSOORUT1",18,0)
 .S RXFL(DA)=0,FDT=$P(^PSRX(DA,2),"^",2)
"RTN","PSOORUT1",19,0)
 .I $O(^PSRX(DA,1,0)) F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S FDT=$P(^PSRX(DA,1,I,0),"^"),RXFL(DA)=I
"RTN","PSOORUT1",20,0)
 .I FDT>DT N PSOSITEZ,ZPSOPAR6 S PSOSITEZ=$S($P($G(^PSRX(DA,2)),"^",9):$P(^(2),"^",9),1:$O(^PS(59,0))),ZPSOPAR6=$P($G(^PS(59,PSOSITEZ,1)),"^",6) I ZPSOPAR6 D  Q
"RTN","PSOORUT1",21,0)
 ..S RXXDA=DA,DA=$O(^PS(52.5,"B",RXXDA,0)) I DA S DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOORUT1",22,0)
 ..S DA=RXXDA
"RTN","PSOORUT1",23,0)
 ..S DIC="^PS(52.5,",DIC(0)="L",DLAYGO=52.5,X=RXXDA,DIC("DR")=".02///"_FDT_";.03////"_$P(^PSRX(DA,0),"^",2)_";.04///M;.05///0;.06////"_PSOSITEZ_";2///0;9///"_RXFL(DA) K DD,DO D FILE^DICN K RXFL,DD,DO
"RTN","PSOORUT1",24,0)
 ..S DA=RXXDA K RXXDA S $P(^PSRX(DA,"STA"),"^")=5,LFD=$E(FDT,4,5)_"-"_$E(FDT,6,7)_"-"_$E(FDT,2,3) D ACT1
"RTN","PSOORUT1",25,0)
 ..S PSOSUSZ=1
"RTN","PSOORUT1",26,0)
 .E  S $P(^PSRX(DA,"STA"),"^")=0
"RTN","PSOORUT1",27,0)
 .S RXF=0 F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RXF=I S:I>5 RXF=I+1
"RTN","PSOORUT1",28,0)
 .D ACT^PSOORUTL
"RTN","PSOORUT1",29,0)
 .I $$SUBMIT^PSOBPSUT(DA) D ECMESND^PSOBPSU1(DA,,$$RXFLDT^PSOBPSUT(DA),$S('$O(^PSRX(DA,1,0)):"OF",1:"RF"))
"RTN","PSOORUT1",30,0)
 G EXIT^PSOORUTL
"RTN","PSOORUT1",31,0)
ACT1 S RXF=0 F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RXF=I S:I>5 RXF=I+1
"RTN","PSOORUT1",32,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(DA,"A",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOORUT1",33,0)
 S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSOORUT1",34,0)
 D NOW^%DTC S ^PSRX(DA,"A",IR,0)=%_"^S^"_POERR("USER")_"^"_RXF_"^"_"RX Placed on Suspense until "_LFD
"RTN","PSOORUT1",35,0)
 Q
"RTN","PSOORUT1",36,0)
SUS ;
"RTN","PSOORUT1",37,0)
 I $P($G(^PSRX(+$G(FILLER),"STA")),"^")=5 N PSOMSORR,PLACERXX D EN^PSOHLSN1(+$G(FILLER),"SC","ZS","")
"RTN","PSOORUT1",38,0)
 Q
"RTN","PSOORUT1",39,0)
BLD ;builds med profile for Listman
"RTN","PSOORUT1",40,0)
 K ^TMP("PSOPF",$J),PSOLST S:$G(PSOOPT)'=3 PSOOPT=0 I '$G(PSOSD) S ^TMP("PSOPF",$J,1,0)="This patient has no prescriptions" S PSOCNT=0,PSOPF=1 Q
"RTN","PSOORUT1",41,0)
 D EOJ,SHOW
"RTN","PSOORUT1",42,0)
EOJ ;
"RTN","PSOORUT1",43,0)
 K PSOQFLG,PSODRG,PSODATA,PSOLF
"RTN","PSOORUT1",44,0)
 Q
"RTN","PSOORUT1",45,0)
 ;-----------------------------------------------------------------
"RTN","PSOORUT1",46,0)
SHOW ;
"RTN","PSOORUT1",47,0)
 ; - ePharmacy modification to create a section for Rx with REJECTs
"RTN","PSOORUT1",48,0)
 N PSOTMP,PSOSTS,PSODRNM,I,PSORX
"RTN","PSOORUT1",49,0)
 S (PSOSTS,PSODRNM)=""
"RTN","PSOORUT1",50,0)
 F  S PSOSTS=$O(PSOSD(PSOSTS)) Q:PSOSTS=""  D
"RTN","PSOORUT1",51,0)
 . F  S PSODRNM=$O(PSOSD(PSOSTS,PSODRNM)) Q:PSODRNM=""  D
"RTN","PSOORUT1",52,0)
 . . S PSORX=+$G(PSOSD(PSOSTS,PSODRNM))
"RTN","PSOORUT1",53,0)
 . . I PSOSTS="ACTIVE",$$FIND^PSOREJUT(PSORX) D  Q
"RTN","PSOORUT1",54,0)
 . . . S PSOTMP(" REJECT",PSODRNM)=PSOSTS
"RTN","PSOORUT1",55,0)
 . . S PSOTMP(PSOSTS,PSODRNM)=PSOSTS
"RTN","PSOORUT1",56,0)
 ;
"RTN","PSOORUT1",57,0)
 S (PSOSTS,PSODRG)="",(PSOCNT,PSOQFLG,IEN)=0
"RTN","PSOORUT1",58,0)
 K RN,DL S $P(RN," ",12)=" ",$P(DL," ",40)=" "
"RTN","PSOORUT1",59,0)
 F PSCNT=0:0 S PSOSTS=$O(PSOTMP(PSOSTS)) Q:PSOSTS=""  D
"RTN","PSOORUT1",60,0)
 . D STA
"RTN","PSOORUT1",61,0)
 . F PSOCT=0:0 S PSODRG=$O(PSOTMP(PSOSTS,PSODRG)) Q:PSODRG=""  Q:PSOCNT>1000!PSOQFLG  D
"RTN","PSOORUT1",62,0)
 . . S PSOSTA=PSOTMP(PSOSTS,PSODRG)
"RTN","PSOORUT1",63,0)
 . . S PSODATA=PSOSD(PSOSTA,PSODRG) I PSOSTA="ZNONVA" D NVA Q
"RTN","PSOORUT1",64,0)
 . . S PSOCNT=PSOCNT+1 I PSOSTA="PENDING" D PEN Q
"RTN","PSOORUT1",65,0)
 . . S:'$D(^PSRX(+PSODATA,0)) PSOCNT=PSOCNT-1 D:$D(^(0)) DISPL
"RTN","PSOORUT1",66,0)
 S (VALMCNT,PSOPF)=IEN
"RTN","PSOORUT1",67,0)
SHOWX K DIRUT,DTOUT,DUOUT,DIROUT,PSODRG
"RTN","PSOORUT1",68,0)
 Q
"RTN","PSOORUT1",69,0)
 ;
"RTN","PSOORUT1",70,0)
DISPL S IEN=IEN+1 N PSOID,PSOCMOP,STATLTH,ECME
"RTN","PSOORUT1",71,0)
 K PSOLNT,PSOQTL,PSOLSP S PSOLRX=$S($G(^PSRX(+PSODATA,"IB")):13,1:14)-$L($P(^PSRX(+PSODATA,0),"^")),$P(PSOLNT," ",PSOLRX)=" ",PSODQL=$L($P(PSODRG,"^"))+$L($P(^PSRX(+PSODATA,0),"^",7))
"RTN","PSOORUT1",72,0)
 I PSODQL<39 S $P(PSOQTL," ",(40-PSODQL))=" "
"RTN","PSOORUT1",73,0)
 E  S $P(PSOQTL," ",(52-$L($P(^PSRX(+PSODATA,0),"^",7))))=" ",$P(PSOLSP," ",(41-$L($P(PSODRG,"^"))))=" "
"RTN","PSOORUT1",74,0)
 S ECME=$$ECME^PSOBPSUT(+PSODATA) I ECME'="" S PSOLNT=$E(PSOLNT,1,$L(PSOLNT)-1)
"RTN","PSOORUT1",75,0)
 S ^TMP("PSOPF",$J,IEN,0)=$J(PSOCNT,2)_$S($L(PSOCNT)<3:" ",1:"")_$P(^PSRX(+PSODATA,0),"^")_$S($G(^PSRX(+PSODATA,"IB")):"$",1:"")_ECME_PSOLNT_$P(PSODRG,"^")_$S(PSODQL<39:PSOQTL_$P(^PSRX(+PSODATA,0),"^",7)_" ",1:$G(PSOLSP))
"RTN","PSOORUT1",76,0)
 S STA="A^N^R^H^N^S^^^^^^E^DC^^DC^DE^H^P^"
"RTN","PSOORUT1",77,0)
 S PSOCMOP=""
"RTN","PSOORUT1",78,0)
 I $D(^PSDRUG("AQ",$P(^PSRX(+PSODATA,0),"^",6))) S PSOCMOP=">"
"RTN","PSOORUT1",79,0)
 N X S X="PSXOPUTL" X ^%ZOSF("TEST") K X I $T D
"RTN","PSOORUT1",80,0)
 .N DA S DA=+PSODATA D ^PSXOPUTL K DA
"RTN","PSOORUT1",81,0)
 .I $G(PSXZ(PSXZ("L")))=0!($G(PSXZ(PSXZ("L")))=2) S PSOCMOP="T"
"RTN","PSOORUT1",82,0)
 .K PSXZ
"RTN","PSOORUT1",83,0)
 N PSOBADR
"RTN","PSOORUT1",84,0)
 S PSOBADR=$O(^PSRX(+PSODATA,"L",9999),-1)
"RTN","PSOORUT1",85,0)
 I PSOBADR'="" S PSOBADR=$G(^PSRX(+PSODATA,"L",PSOBADR,0)) I PSOBADR["(BAD ADDRESS)" S PSOBADR="B"
"RTN","PSOORUT1",86,0)
 I PSOBADR'="B" S PSOBADR=""
"RTN","PSOORUT1",87,0)
 S STAPRT=$P(STA,"^",$P(PSODATA,"^",2)+1)_PSOCMOP_PSOBADR
"RTN","PSOORUT1",88,0)
 S STATLTH=$L(STAPRT)
"RTN","PSOORUT1",89,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_STAPRT_$S(STATLTH=0:"   ",STATLTH=1:"  ",STATLTH=2:" ",1:"")
"RTN","PSOORUT1",90,0)
 S PSOID=$P(^PSRX(+PSODATA,0),"^",13),PSOLF=+$G(^(3)),^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$E(PSOID,4,5)_"-"_$E(PSOID,6,7)_" "
"RTN","PSOORUT1",91,0)
 F PSOX=0:0 S PSOX=$O(^PSRX(+PSODATA,1,PSOX)) Q:'PSOX  D
"RTN","PSOORUT1",92,0)
 . I +$G(^PSRX(+PSODATA,1,PSOX,0))=PSOLF,$P($G(^PSRX(+PSODATA,1,PSOX,0)),"^",16) S PSOLF=PSOLF_"^R"
"RTN","PSOORUT1",93,0)
 K PSOX
"RTN","PSOORUT1",94,0)
 I '$O(^PSRX(+PSODATA,1,0)),$P(^PSRX(+PSODATA,2),"^",15) S PSOLF=PSOLF_"^R"
"RTN","PSOORUT1",95,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$S($G(PSOLF):$E(PSOLF,4,5),1:"  ")_"-"_$S($G(PSOLF):$E(PSOLF,6,7),1:"  ")_$S($P(PSOLF,"^",2)="R":"R ",1:"  ")
"RTN","PSOORUT1",96,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$J($P(PSODATA,"^",6),2)_" "_$J($P(PSODATA,"^",8),3)
"RTN","PSOORUT1",97,0)
 I PSODQL>38 S IEN=IEN+1 S ^TMP("PSOPF",$J,IEN,0)=PSOQTL_"Qty: "_$P(^PSRX(+PSODATA,0),"^",7)
"RTN","PSOORUT1",98,0)
 K PSOLNT,PSOQTL,PSOLSP,PSOLRX,PSODQL
"RTN","PSOORUT1",99,0)
 S PSOLST(PSOCNT)="52^"_+PSODATA_"^"_PSOSTA
"RTN","PSOORUT1",100,0)
 K PSODATA,PSOLF S PSOPF=IEN
"RTN","PSOORUT1",101,0)
 Q
"RTN","PSOORUT1",102,0)
 ;
"RTN","PSOORUT1",103,0)
STA N LABEL,LINE,POS
"RTN","PSOORUT1",104,0)
 S LABEL=PSOSTS,IEN=IEN+1
"RTN","PSOORUT1",105,0)
 I PSOSTS="ZNONVA" S LABEL="Non-VA MEDS (Not dispensed by VA)"
"RTN","PSOORUT1",106,0)
 I PSOSTS=" REJECT" S LABEL="REFILL TOO SOON/DUR REJECTS (Third Party)"
"RTN","PSOORUT1",107,0)
 S POS=80-$L(LABEL)/2,$P(LINE,"-",81)="",$E(LINE,POS+1,POS+$L(LABEL))=LABEL
"RTN","PSOORUT1",108,0)
 S ^TMP("PSOPF",$J,IEN,0)=LINE
"RTN","PSOORUT1",109,0)
 Q
"RTN","PSOORUT1",110,0)
PENX S PSOLST(PSOCNT)="52.41^"_$P(PSODATA,"^",10)_"^"_PSOSTA
"RTN","PSOORUT1",111,0)
 K PSODATA,PSOLF,RN,PSOLSP,PSOQTL,PSOLNT
"RTN","PSOORUT1",112,0)
 Q
"RTN","PSOORUT1",113,0)
PEN ;
"RTN","PSOORUT1",114,0)
 N PSOQTL,PSOLNT,PSOLNTZ,PSOQTLX,PSCMOPF,SPACEZ
"RTN","PSOORUT1",115,0)
 Q:'$D(^PS(52.41,$P(PSODATA,"^",10),0))
"RTN","PSOORUT1",116,0)
 S PSCMOPF=0 I $P($G(PSODATA),"^",11),$D(^PSDRUG("AQ",$P(PSODATA,"^",11))) S PSCMOPF=1
"RTN","PSOORUT1",117,0)
 S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)=$J(PSOCNT,2)_$S($L(PSOCNT)<3:" ",1:"")_$P(PSODRG,"^")
"RTN","PSOORUT1",118,0)
 I $P($G(^PS(52.41,+$P(PSODATA,"^",10),0)),"^",23)=1 S ^TMP("PSOPF",$J,IEN,"RV")=""
"RTN","PSOORUT1",119,0)
 S PSOLNT=$L($P(PSODRG,"^")),PSOLNTZ=$L($P(PSODATA,"^",8))
"RTN","PSOORUT1",120,0)
 S $P(PSOQTLX," ",(11-PSOLNTZ))=" "
"RTN","PSOORUT1",121,0)
 S:PSOLNT<37 $P(PSOQTL," ",(37-PSOLNT))=" "
"RTN","PSOORUT1",122,0)
 I PSOLNT<38 D  G PENX
"RTN","PSOORUT1",123,0)
 .I PSOLNT=37 S PSOQTL=""
"RTN","PSOORUT1",124,0)
 .I $P(^PS(52.41,$P(PSODATA,"^",10),0),"^",3)="RF" S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$G(PSOQTL)_"  Refill Request   Rx #: "_$P(^PSRX($P(^PS(52.41,$P(PSODATA,"^",10),0),"^",19),0),"^") Q
"RTN","PSOORUT1",125,0)
 .S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$G(PSOQTL)_"  "_"QTY: "_$P(PSODATA,"^",8)_$G(PSOQTLX)_" ISDT: "_$S('$P(PSODATA,"^",9):"     ",1:$E($P(PSODATA,"^",9),4,5)_"-"_$E($P(PSODATA,"^",9),6,7))_$S($G(PSCMOPF):"> ",1:"  ")
"RTN","PSOORUT1",126,0)
 .S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_"REF: "_$S($L($P(PSODATA,"^",6))>1:"",1:" ")_$P(PSODATA,"^",6)
"RTN","PSOORUT1",127,0)
 S IEN=IEN+1,$P(SPACEZ," ",42)=" "
"RTN","PSOORUT1",128,0)
 I $P(^PS(52.41,$P(PSODATA,"^",10),0),"^",3)="RF" S ^TMP("PSOPF",$J,IEN,0)=SPACEZ_"Refill Request   Rx #: "_$P(^PSRX($P(^PS(52.41,$P(PSODATA,"^",10),0),"^",19),0),"^") G PENX
"RTN","PSOORUT1",129,0)
 S ^TMP("PSOPF",$J,IEN,0)=SPACEZ_"QTY: "_$P(PSODATA,"^",8)_$G(PSOQTLX)_" ISDT: "_$S('$P(PSODATA,"^",9):"     ",1:$E($P(PSODATA,"^",9),4,5)_"-"_$E($P(PSODATA,"^",9),6,7))_$S($G(PSCMOPF):"> ",1:"  ")_"REF: "_$S($L($P(PSODATA,"^",6))>1:"",1:" ")
"RTN","PSOORUT1",130,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$P(PSODATA,"^",6)
"RTN","PSOORUT1",131,0)
 G PENX
"RTN","PSOORUT1",132,0)
 ;
"RTN","PSOORUT1",133,0)
NVA ; Setting the Non-VA Meds on the Medication Profile Screen (ListMan)
"RTN","PSOORUT1",134,0)
 S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)="  "_$P(PSODRG,"^")_" "
"RTN","PSOORUT1",135,0)
 I ($L(^TMP("PSOPF",$J,IEN,0))+$L($P(PSODATA,"^",6))>70) S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)="    "
"RTN","PSOORUT1",136,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$P(PSODATA,"^",6)_" "
"RTN","PSOORUT1",137,0)
 I ($L(^TMP("PSOPF",$J,IEN,0))+$L($P(PSODATA,"^",8))>70) S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)="    "
"RTN","PSOORUT1",138,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$P(PSODATA,"^",8)
"RTN","PSOORUT1",139,0)
 I ($L(^TMP("PSOPF",$J,IEN,0))+20)>70 D  Q
"RTN","PSOORUT1",140,0)
 . S IEN=IEN+1,$P(^TMP("PSOPF",$J,IEN,0)," ",51)="Date Documented: "_$E($P(PSODATA,"^",9),4,5)_"/"_$E($P(PSODATA,"^",9),6,7)_"/"_$E($P(PSODATA,"^",9),2,3)
"RTN","PSOORUT1",141,0)
 F I=0:0 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_" " Q:$L(^TMP("PSOPF",$J,IEN,0))>49
"RTN","PSOORUT1",142,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_"Date Documented: "_$E($P(PSODATA,"^",9),4,5)_"/"_$E($P(PSODATA,"^",9),6,7)_"/"_$E($P(PSODATA,"^",9),2,3)
"RTN","PSOORUT1",143,0)
 Q
"RTN","PSOORUTL")
0^60^B42932698
"RTN","PSOORUTL",1,0)
PSOORUTL ;ISC BHAM/SAB  - updates order status from oerr ;6/28/07 7:36am
"RTN","PSOORUTL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**14,46,146,132,118,199,223,148,249,274,225**;DEC 1997;Build 29
"RTN","PSOORUTL",3,0)
 ;External reference to EN^ORERR - 2187
"RTN","PSOORUTL",4,0)
 ;External reference to ^PS(55 - 2228
"RTN","PSOORUTL",5,0)
 ;Input variables, poerr("psofilnm")=pharmacy pointer # from OE/RR, poerr("stat")=Order Control status
"RTN","PSOORUTL",6,0)
 ;poerr("pharmst")=will contain 'ZE'if rx has expired, poerr("comm")=Comments, poerr("user")=Person placing request
"RTN","PSOORUTL",7,0)
EN(POERR) ;
"RTN","PSOORUTL",8,0)
 N PSZORS,III
"RTN","PSOORUTL",9,0)
 F OO=0:0 S OO=$O(MSG(OO)) Q:'OO  I $P(MSG(OO),"|")="ZRN" S NVA=1
"RTN","PSOORUTL",10,0)
 I $G(NVA) G NVA
"RTN","PSOORUTL",11,0)
 G:POERR("PSOFILNM")'["S" RXO S III=+POERR("PSOFILNM")
"RTN","PSOORUTL",12,0)
 S ORS=0 I $D(^PS(52.41,III,0)) D  G PEXIT
"RTN","PSOORUTL",13,0)
 .Q:$P($G(^PS(52.41,III,0)),"^",3)="RF"
"RTN","PSOORUTL",14,0)
 .I $G(PDFN),$P($G(^PS(52.41,III,0)),"^",2),PDFN'=$P(^PS(52.41,III,0),"^",2) S ORS=1
"RTN","PSOORUTL",15,0)
RXO S III=POERR("PSOFILNM") I $D(^PSRX(III,0)) D  G PEXIT
"RTN","PSOORUTL",16,0)
 .I $G(PDFN),$P($G(^PSRX(III,0)),"^",2),PDFN'=$P(^PSRX(III,0),"^",2) S ORS=1
"RTN","PSOORUTL",17,0)
 S (ORS,PSZORS)=1
"RTN","PSOORUTL",18,0)
PEXIT I $G(ORS) S POERR("STAT")=$S(POERR("STAT")="CA":"UC",POERR("STAT")="DC":"UD",POERR("STAT")="HD":"UH",1:"UR"),POERR("FILLER")="",POERR("COMM")=$S($G(PSZORS):"Invalid Pharmacy order number",1:"Patient does not match.") K ORS,PSZORS,III Q
"RTN","PSOORUTL",19,0)
 S POERR("PHARMST")="" G:POERR("STAT")="HD"!(POERR("STAT")="RL") HD
"RTN","PSOORUTL",20,0)
 S ORS=0 I POERR("PSOFILNM")["S" S DA=+POERR("PSOFILNM") I $D(^PS(52.41,DA,0)) D  G EXIT
"RTN","PSOORUTL",21,0)
 .Q:$P($G(^PS(52.41,DA,0)),"^",3)="RF"
"RTN","PSOORUTL",22,0)
 .S $P(^PS(52.41,DA,0),"^",3)="DC",POERR("PLACE")=$P(^(0),"^"),POERR("STAT")="CR",POERR("FILLER")=DA_"^P"
"RTN","PSOORUTL",23,0)
 .K ^PS(52.41,"AOR",+$P($G(^PS(52.41,DA,0)),"^",2),+$P($G(^PS(52.41,DA,"INI")),"^"),DA)
"RTN","PSOORUTL",24,0)
 .S:$G(POERR("COMM"))']"" POERR("COMM")="Order Canceled by OE/RR before finishing." S ORS=1,$P(^PS(52.41,DA,4),"^")=$G(POERR("COMM"))
"RTN","PSOORUTL",25,0)
 S DA=POERR("PSOFILNM") D:$D(^PSRX(DA,0)) REVERSE^PSOBPSU1(DA,,"DC",7)
"RTN","PSOORUTL",26,0)
 I $D(^PSRX(DA,0)) D  S $P(^PSRX(DA,"STA"),"^")=14,$P(^PSRX(DA,3),"^",5)=DT,$P(^PSRX(DA,3),"^",10)=$P(^PSRX(DA,3),"^") D CAN^PSOTPCAN(DA) G EXIT
"RTN","PSOORUTL",27,0)
 .;cancel/discontinue action
"RTN","PSOORUTL",28,0)
 .S POERR("PLACE")=+$P($G(^PSRX(DA,"OR1")),"^",2),POERR("STAT")=$S(POERR("STAT")="CA":"CR",1:"DR"),POERR("FILLER")=DA_"^R"
"RTN","PSOORUTL",29,0)
 .S:'$D(POERR("COMM")) POERR("COMM")="Prescription DISCONTINUED by OERR"
"RTN","PSOORUTL",30,0)
 .S ORS=1 D CAN
"RTN","PSOORUTL",31,0)
EXIT I '$G(ORS) D
"RTN","PSOORUTL",32,0)
 .S POERR("STAT")=$S(POERR("STAT")="CA":"UC",POERR("STAT")="DC":"UD",POERR("STAT")="HD":"UH",1:"UR"),POERR("FILLER")="",POERR("COMM")="Order was not located by Pharmacy"
"RTN","PSOORUTL",33,0)
 K EXP,ORS,DA,ACOM,RXDA,SUSD,PSUS,RXF,I,FDA,DIC,DIE,DR,Y,X,%,%I,%H,RSDT,ACNT,ACT,DIK,FDT,IR,LFD,NOW,ORD,PSDA,PSCDA,PSODFN,PSUS,RF,RFCNT,RXN,RXP,RXREF,SD,SUB
"RTN","PSOORUTL",34,0)
 Q
"RTN","PSOORUTL",35,0)
CAN S ACOM="Discontinued by OE/RR." I $P(^PSRX(DA,"STA"),"^")=3!($P(^("STA"),"^")=16) D
"RTN","PSOORUTL",36,0)
 .S ACOM="Discontinued by OE/RR while on hold. " K:$P(^PSRX(DA,"H"),"^") ^PSRX("AH",$P(^PSRX(DA,"H"),"^"),DA) S ^PSRX(DA,"H")=""
"RTN","PSOORUTL",37,0)
 .I $P(^PSRX(DA,0),"^",13),'$O(^PSRX(DA,1,0)) S DIE=52,DR="22///"_$E($P(^PSRX(DA,0),"^",13),1,7) D ^DIE K DIE,DR Q
"RTN","PSOORUTL",38,0)
 .S (IFN,SUSD)=0 F  S IFN=$O(^PSRX(DA,1,IFN)) Q:'IFN  S SUSD=IFN,RFDT=$P(^PSRX(DA,1,IFN,0),"^")
"RTN","PSOORUTL",39,0)
 .Q:'$G(SUSD)  I '$P(^PSRX(DA,1,SUSD,0),"^",18) S PSDTEST=0 D  I 'PSDTEST K ^PSRX(DA,1,SUSD),^PSRX("AD",RFDT,DA,SUSD),^PSRX(DA,1,"B",RFDT,SUSD),IFN,SUSD,RFDT
"RTN","PSOORUTL",40,0)
 ..F PDA=0:0 S PDA=$O(^PSRX(DA,"L",PDA)) Q:'PDA  I $P($G(^PSRX(DA,"L",PDA,0)),"^",2)=SUSD S PSDTEST=1
"RTN","PSOORUTL",41,0)
 ..K CMOP D ^PSOCMOPA I $G(CMOP(CMOP("L")))="",$G(CMOP("S"))'="L" Q
"RTN","PSOORUTL",42,0)
 ..S PSDTEST=1
"RTN","PSOORUTL",43,0)
 S RXDA=DA,(DA,SUSDA)=$O(^PS(52.5,"B",DA,0)) D:DA
"RTN","PSOORUTL",44,0)
 .S SUSD=$P($G(^PS(52.5,DA,0)),"^",2)
"RTN","PSOORUTL",45,0)
 .S:+$G(^PS(52.5,DA,"P"))'=1 ACOM="Discontinued by OE/RR while suspended."
"RTN","PSOORUTL",46,0)
 .I $O(^PSRX(RXDA,1,0)) S DA=RXDA D:'$G(^PS(52.5,+SUSDA,"P")) REF^PSOCAN2
"RTN","PSOORUTL",47,0)
 .S DA=SUSDA,DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOORUTL",48,0)
 K SUSD,SUSDA S DA=RXDA,RXREF=0,PSODFN=+$P(^PSRX(DA,0),"^",2) D
"RTN","PSOORUTL",49,0)
 .S ACNT=0 F SUB=0:0 S SUB=$O(^PSRX(DA,"A",SUB)) Q:'SUB  S ACNT=SUB
"RTN","PSOORUTL",50,0)
 .S RFCNT=0 F RF=0:0 S RF=$O(^PSRX(DA,1,RF)) Q:'RF  S RFCNT=RF S:RF>5 RFCNT=RF+1
"RTN","PSOORUTL",51,0)
 .D NOW^%DTC S ^PSRX(DA,"A",0)="^52.3DA^"_(ACNT+1)_"^"_(ACNT+1),^PSRX(DA,"A",ACNT+1,0)=%_"^C^"_POERR("USER")_"^"_RFCNT_"^"_$G(ACOM)
"RTN","PSOORUTL",52,0)
 .S REA="C" D EXP^PSOHELP1
"RTN","PSOORUTL",53,0)
 I $G(^PS(52.4,DA,0))]"" S PSCDA=DA,DIK="^PS(52.4," D ^DIK S DA=PSCDA K DIK,PSCDA
"RTN","PSOORUTL",54,0)
 Q
"RTN","PSOORUTL",55,0)
HD ;place order on hold
"RTN","PSOORUTL",56,0)
 G:POERR("STAT")="RL" REL^PSOORUT1 S (ACT,ORS)=0 I POERR("PSOFILNM")["S" D  G EXIT
"RTN","PSOORUTL",57,0)
 .S DA=+POERR("PSOFILNM")
"RTN","PSOORUTL",58,0)
 .Q:'$D(^PS(52.41,DA,0))  Q:$P(^PS(52.41,DA,0),"^",3)="RF"
"RTN","PSOORUTL",59,0)
 .S $P(^PS(52.41,DA,0),"^",3)="HD",POERR("STAT")="HR",POERR("FILLER")=DA_"^P"
"RTN","PSOORUTL",60,0)
 .S:$G(POERR("COMM"))']"" POERR("COMM")="Order PLACED on HOLD by OERR before finished." S $P(^PS(52.41,DA,4),"^")=POERR("COMM"),ORS=1
"RTN","PSOORUTL",61,0)
 S DA=POERR("PSOFILNM") I $D(^PSRX(DA,0)) S ORS=1,PSDA=DA D  G EXIT
"RTN","PSOORUTL",62,0)
 .S POERR("FILLER")=DA_"^R"
"RTN","PSOORUTL",63,0)
 .S:'$D(POERR("COMM")) POERR("COMM")="Prescription Placed on HOLD by OERR"
"RTN","PSOORUTL",64,0)
 .I DT>$P(^PSRX(DA,2),"^",6) S EXP=$P(^(2),"^",6) S:$P(^PSRX(DA,"STA"),"^")<12 $P(^PSRX(DA,"STA"),"^")=11,PSOEXFLG=1 S POERR("STAT")="UH",POERR("COMM")="Prescription EXPIRED on "_$E(EXP,4,5)_"/"_$E(EXP,6,7)_"/"_$E(EXP,2,3)_"." D  Q
"RTN","PSOORUTL",65,0)
 ..D ECAN^PSOUTL(DA)
"RTN","PSOORUTL",66,0)
 .I $P(^PSRX(DA,"STA"),"^")=3!($P(^("STA"),"^")>11) S POERR("STAT")="UH",POERR("COMM")="Unable to place on HOLD" Q
"RTN","PSOORUTL",67,0)
 .S $P(^PSRX(DA,"STA"),"^")=16,POERR("STAT")="HR",^PSRX(DA,"H")=99_"^"_POERR("COMM")_"^"_DT
"RTN","PSOORUTL",68,0)
 .S (PSUS,RXF)=0 F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RXF=I S:RXF>1 RSDT=$P(^(RXF-1,0),"^")
"RTN","PSOORUTL",69,0)
 .S DA=PSDA D ACT D REVERSE^PSOBPSU1(DA,,"HLD",2)
"RTN","PSOORUTL",70,0)
 .S DA=$O(^PS(52.5,"B",PSDA,0)) I DA S DIK="^PS(52.5,",PSUS=1 D ^DIK K DA,DIK
"RTN","PSOORUTL",71,0)
 I 'ORS S POERR("COMM")="Unable to place order on HOLD" G EXIT
"RTN","PSOORUTL",72,0)
 Q
"RTN","PSOORUTL",73,0)
NVA ;non-va med action
"RTN","PSOORUTL",74,0)
 N DIE,DR,DA K NVA
"RTN","PSOORUTL",75,0)
 I POERR("PSOFILNM")'["N"!('$D(^PS(55,PDFN,"NVA",+POERR("PSOFILNM"),0))) D EN^ORERR("Order was not located by Pharmacy",.MSG) Q
"RTN","PSOORUTL",76,0)
 I $G(OR("STAT"))'="CA",$G(OR("STAT"))'="DC" D EN^ORERR("Invalid Order Control Code",.MSG) Q
"RTN","PSOORUTL",77,0)
XO S ORD=+POERR("PSOFILNM")
"RTN","PSOORUTL",78,0)
 N TMP
"RTN","PSOORUTL",79,0)
 D NOW^%DTC
"RTN","PSOORUTL",80,0)
 K TMP S TMP(55.05,ORD_","_PDFN_",",5)=$S($G(PSODEATH):2,1:1)
"RTN","PSOORUTL",81,0)
 S TMP(55.05,ORD_","_PDFN_",",6)=%
"RTN","PSOORUTL",82,0)
 D FILE^DIE("","TMP")
"RTN","PSOORUTL",83,0)
 S PLACER=$P(^PS(55,PDFN,"NVA",ORD,0),"^",8)
"RTN","PSOORUTL",84,0)
 K MSG S NULLFLDS="F JJ=0:1:LIMIT S FIELD(JJ)="""""
"RTN","PSOORUTL",85,0)
 K ^UTILITY("DIQ1",$J),DIQ S DA=$P($$SITE^VASITE(),"^")
"RTN","PSOORUTL",86,0)
 I $G(DA) S DIC=4,DIQ(0)="I",DR="99" D EN^DIQ1 S PSOHINST=$G(^UTILITY("DIQ1",$J,4,DA,99,"I")) K ^UTILITY("DIQ1",$J),DA,DR,DIQ,DIC
"RTN","PSOORUTL",87,0)
 S MSG(1)="MSH|^~\&|PHARMACY|"_$G(PSOHINST)_"|||||ORR"
"RTN","PSOORUTL",88,0)
 ;
"RTN","PSOORUTL",89,0)
 S DFN=PDFN,COUNT=1,LIMIT=5 X NULLFLDS D DEM^VADPT S NAME=$G(VADM(1)) K VADM
"RTN","PSOORUTL",90,0)
 S FIELD(0)="PID",FIELD(3)=DFN,FIELD(5)=NAME
"RTN","PSOORUTL",91,0)
 D SEG^PSOHLSN1
"RTN","PSOORUTL",92,0)
 ;
"RTN","PSOORUTL",93,0)
 S LIMIT=15 X NULLFLDS
"RTN","PSOORUTL",94,0)
 S FIELD(0)="ORC",FIELD(2)=PLACER_"^OR",FIELD(3)=+POERR("PSOFILNM")_"N^PS"
"RTN","PSOORUTL",95,0)
 S FIELD(1)="SC",FIELD(5)="DC"
"RTN","PSOORUTL",96,0)
 D SEG^PSOHLSN1
"RTN","PSOORUTL",97,0)
 I $G(PSODEATH) S MSG(COUNT)=MSG(COUNT)_"|^^^^DATE OF DEATH ENTERED BY MAS.^"
"RTN","PSOORUTL",98,0)
 ;
"RTN","PSOORUTL",99,0)
 D SEND^PSOHLSN1 K FIELDS,LIMIT,PSODSC,PSONVA,OI
"RTN","PSOORUTL",100,0)
 Q
"RTN","PSOORUTL",101,0)
 ;
"RTN","PSOORUTL",102,0)
ACT ;activity log
"RTN","PSOORUTL",103,0)
 D NOW^%DTC S NOW=%
"RTN","PSOORUTL",104,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(DA,"A",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOORUTL",105,0)
 S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSOORUTL",106,0)
 S RXF=$S(RXF>5:RXF+1,1:RXF)
"RTN","PSOORUTL",107,0)
 S ^PSRX(DA,"A",IR,0)=NOW_"^"_$S(ACT:"U",1:"H")_"^"_POERR("USER")_"^"_RXF_"^"_"RX "_$S('ACT:"placed in a",1:"removed from")_" HOLD status "_$S(+$G(PSUS):"and removed from SUSPENSE ",1:"")_"("_$E(DT,4,5)_"-"_$E(DT,6,7)_"-"_$E(DT,2,3)_") by OERR."
"RTN","PSOORUTL",108,0)
 Q
"RTN","PSOPFSU0")
0^26^B16719729
"RTN","PSOPFSU0",1,0)
PSOPFSU0 ;BIR/LE,AM - PFSS Get Account & Utilities ;08/09/93
"RTN","PSOPFSU0",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**201,225**;DEC 1997;Build 29
"RTN","PSOPFSU0",3,0)
 ;External reference SWSTAT^IBBAPI supported by DBIA 4663
"RTN","PSOPFSU0",4,0)
 ;External reference GETACCT^IBBAPI supported by DBIA 4664
"RTN","PSOPFSU0",5,0)
 ;External reference ^DG(40.8,"AD" supported by DBIA 2817
"RTN","PSOPFSU0",6,0)
 Q
"RTN","PSOPFSU0",7,0)
 ;
"RTN","PSOPFSU0",8,0)
GACT(PSORXN,PSOREF) ;ENTRY POINT: Called from PSON52; PSOR52, PSORN52.  Get a PFSS acct ref
"RTN","PSOPFSU0",9,0)
 ; This routine is only called when the PFSS Switch is on.   
"RTN","PSOPFSU0",10,0)
 ;
"RTN","PSOPFSU0",11,0)
 N I,J,PSOPFSAC,PSOPV1,PSODG,PSOZCL,PSODFN,PSORX,PSOPV2,PSODIV
"RTN","PSOPFSU0",12,0)
 ;for sending to an external billing system, get data from file 52, build arrays for IBB API call
"RTN","PSOPFSU0",13,0)
 I PSOREF=0 D GACTOF
"RTN","PSOPFSU0",14,0)
 I PSOREF>0 D GACTRF
"RTN","PSOPFSU0",15,0)
 ;Get general Rx data fields
"RTN","PSOPFSU0",16,0)
 S PSODIV=$$MCDIV(PSORXN,PSOREF)
"RTN","PSOPFSU0",17,0)
 S PSODFN=$$GET1^DIQ(52,PSORXN,"2","I")
"RTN","PSOPFSU0",18,0)
 S PSOPV1(2)="O",PSOPV1(50)=PSORXN
"RTN","PSOPFSU0",19,0)
 S PSOPV1(3)=$$CHLOC()
"RTN","PSOPFSU0",20,0)
 Q:PSOPV1(3)="" 0  ;can't do GETACCT if CHARGE LOCATION is null; this is to be address in subsequent PFSS project phase
"RTN","PSOPFSU0",21,0)
 ;request the PFSS Acct Rev
"RTN","PSOPFSU0",22,0)
 S PSOPFSAC=$$GETACCT^IBBAPI(PSODFN,"","A04","GACT;PSOPFSU0",.PSOPV1,"","",.PSODG,.PSOZCL,PSODIV,"")
"RTN","PSOPFSU0",23,0)
 ;Store the PFS Acct Ref with speed in mind
"RTN","PSOPFSU0",24,0)
 Q:PSOPFSAC<1 ""
"RTN","PSOPFSU0",25,0)
 I PSOREF=0 S $P(^PSRX(PSORXN,"PFS"),"^")=PSOPFSAC
"RTN","PSOPFSU0",26,0)
 I PSOREF>0 S $P(^PSRX(PSORXN,1,PSOREF,"PFS"),"^")=PSOPFSAC
"RTN","PSOPFSU0",27,0)
 Q PSOPFSAC
"RTN","PSOPFSU0",28,0)
 ;
"RTN","PSOPFSU0",29,0)
GACTOF ;Get orig fill data
"RTN","PSOPFSU0",30,0)
 D GETS^DIQ(52,PSORXN,"4;22","I","PSORX")
"RTN","PSOPFSU0",31,0)
 S PSOPV1(7)=$G(PSORX(52,PSORXN_",",4,"I")),PSOPV1(44)=$G(PSORX(52,PSORXN_",",22,"I"))
"RTN","PSOPFSU0",32,0)
 D GOC
"RTN","PSOPFSU0",33,0)
 Q
"RTN","PSOPFSU0",34,0)
 ;
"RTN","PSOPFSU0",35,0)
GACTRF ;Called from GACT. Get refill data
"RTN","PSOPFSU0",36,0)
 D GETS^DIQ(52.1,PSOREF_","_PSORXN,".01;15","I","PSORX")
"RTN","PSOPFSU0",37,0)
 S PSOPV1(7)=$G(PSORX(52.1,PSOREF_","_PSORXN_",","15","I"))
"RTN","PSOPFSU0",38,0)
 S PSOPV1(44)=$G(PSORX(52.1,PSOREF_","_PSORXN_",",".01","I"))
"RTN","PSOPFSU0",39,0)
 D GOC
"RTN","PSOPFSU0",40,0)
 Q
"RTN","PSOPFSU0",41,0)
 ;
"RTN","PSOPFSU0",42,0)
CHLOC() ;FIND CHARGE LOCATION
"RTN","PSOPFSU0",43,0)
 N CHLOC,CL,PDIV
"RTN","PSOPFSU0",44,0)
 I PSOREF=0 S PDIV=$$GET1^DIQ(52,PSORXN,"20","I")   ;DIVISION
"RTN","PSOPFSU0",45,0)
 I PSOREF>0 S PDIV=$$GET1^DIQ(52.1,PSOREF_","_PSORXN_",","8","I")
"RTN","PSOPFSU0",46,0)
 S CHLOC=$$GET1^DIQ(59,PDIV,1007,"I") ;Charge location pointer
"RTN","PSOPFSU0",47,0)
 I CHLOC="" S CL="" D CLOK S:CL>0 CHLOC=CL
"RTN","PSOPFSU0",48,0)
 Q CHLOC
"RTN","PSOPFSU0",49,0)
 ;
"RTN","PSOPFSU0",50,0)
GOC ;Called from GACTOF and GACTRF.  Parse OP classifications and ICD's.  Don't send null values.
"RTN","PSOPFSU0",51,0)
 D GETS^DIQ(52,PSORXN,"52311*","I","PSORX")
"RTN","PSOPFSU0",52,0)
 F I=1:1 Q:'$D(PSORX(52.052311,I_","_PSORXN_","))  D
"RTN","PSOPFSU0",53,0)
 . S:PSORX(52.052311,I_","_PSORXN_",",".01","I")'="" PSODG(I,3)=PSORX(52.052311,I_","_PSORXN_",",".01","I"),PSODG(I,6)="W"
"RTN","PSOPFSU0",54,0)
 . I I=1 F J=1:1:8 Q:'$D(PSORX(52.052311,I_","_PSORXN_",",J,"I"))  D
"RTN","PSOPFSU0",55,0)
 . . S:PSORX(52.052311,I_","_PSORXN_",",J,"I")'="" PSOZCL(J,2)=J,PSOZCL(J,3)=PSORX(52.052311,I_","_PSORXN_",",J,"I")
"RTN","PSOPFSU0",56,0)
 S:'$D(PSOZCL) PSOZCL="" S:'$D(PSODG) PSODG=""
"RTN","PSOPFSU0",57,0)
 Q
"RTN","PSOPFSU0",58,0)
 ;
"RTN","PSOPFSU0",59,0)
RPH(PSORXN,PSOREF) ;API entry point
"RTN","PSOPFSU0",60,0)
 ;       Inputs:  PSORXN = prescription IEN, PSOREF = fill number
"RTN","PSOPFSU0",61,0)
 ;       Outputs: PSORPH = rel pharm IEN ^ user IEN who performed last activity or rel pharm iF no activity entries^
"RTN","PSOPFSU0",62,0)
 ;                   IB Service Section pointer from file 59
"RTN","PSOPFSU0",63,0)
 ;       Returns null values when the Rx is not released or the input values are invalid (i.e. "^^").
"RTN","PSOPFSU0",64,0)
 N I,II,IBSS,DIV,PSORPH,PSOEDPH,PSOA,PSORDT,PSOOK,PSOA,DATA
"RTN","PSOPFSU0",65,0)
 S PSOOK=$$CHKRX(PSORXN,PSOREF) Q:PSOOK'=1 "^^"
"RTN","PSOPFSU0",66,0)
 I 'PSOREF D GETS^DIQ(52,PSORXN,"20;23;31","I","DATA")
"RTN","PSOPFSU0",67,0)
 E  D GETS^DIQ(52.1,PSOREF_","_PSORXN,"4;8;17","I","DATA")
"RTN","PSOPFSU0",68,0)
 I PSOREF=0 D
"RTN","PSOPFSU0",69,0)
 . S PSORPH=+$G(DATA(52,PSORXN_",",23,"I")) S:PSORPH=0 PSORPH=""
"RTN","PSOPFSU0",70,0)
 . S DIV=+$G(DATA(52,PSORXN_",",20,"I"))
"RTN","PSOPFSU0",71,0)
 . S PSORDT=+$G(DATA(52,PSORXN_",",31,"I"))
"RTN","PSOPFSU0",72,0)
 I PSOREF>0 D
"RTN","PSOPFSU0",73,0)
 . S PSORPH=+$G(DATA(52.1,PSOREF_","_PSORXN_",",4,"I")) S:PSORPH=0 PSORPH=""
"RTN","PSOPFSU0",74,0)
 . S DIV=+$G(DATA(52.1,PSOREF_","_PSORXN_",",8,"I"))
"RTN","PSOPFSU0",75,0)
 . S PSORDT=+$G(DATA(52.1,PSOREF_","_PSORXN_",",17,"I"))
"RTN","PSOPFSU0",76,0)
 Q:PSORDT=0 "^^"
"RTN","PSOPFSU0",77,0)
 ;last activity - get last one with a user
"RTN","PSOPFSU0",78,0)
 I $D(^PSRX(PSORXN,"A",0)) S PSOA=$P(^PSRX(PSORXN,"A",0),"^",3) D
"RTN","PSOPFSU0",79,0)
 . F II=PSOA:-1:1 S PSOEDPH=$$GET1^DIQ(52.3,II_","_PSORXN_",",".03","I") Q:PSOEDPH'=""
"RTN","PSOPFSU0",80,0)
 ;get IB Service Section (requested by Ed Z. on 6/29/05)
"RTN","PSOPFSU0",81,0)
 S IBSS=$P($G(^PS(59,DIV,"IB")),"^")
"RTN","PSOPFSU0",82,0)
 S:'$G(PSOEDPH) PSOEDPH=PSORPH
"RTN","PSOPFSU0",83,0)
 S PSORPH=$G(PSORPH)_"^"_$G(PSOEDPH)_"^"_$G(IBSS)
"RTN","PSOPFSU0",84,0)
 Q PSORPH
"RTN","PSOPFSU0",85,0)
 ;
"RTN","PSOPFSU0",86,0)
CHKRX(PSORX,PSOF) ;validates Rx & fill. 0=not valid, 1=valid, 2=refill not valid
"RTN","PSOPFSU0",87,0)
 Q:PSORX=""!(PSOF="") 0
"RTN","PSOPFSU0",88,0)
 Q:'$D(^PSRX(PSORX)) 0
"RTN","PSOPFSU0",89,0)
 Q:PSOF>0&('$D(^PSRX(PSORX,1,PSOF))) 2
"RTN","PSOPFSU0",90,0)
 Q 1
"RTN","PSOPFSU0",91,0)
 ;
"RTN","PSOPFSU0",92,0)
MCDIV(RX,FILL) ;Get MC DIVISION from the Rx/Fill
"RTN","PSOPFSU0",93,0)
 N DIV,INST
"RTN","PSOPFSU0",94,0)
 ; outpatient division
"RTN","PSOPFSU0",95,0)
 I 'FILL S DIV=$$GET1^DIQ(52,RX,20,"I")
"RTN","PSOPFSU0",96,0)
 E  S DIV=$$GET1^DIQ(52.1,FILL_","_RX,8,"I")
"RTN","PSOPFSU0",97,0)
 Q:'DIV ""
"RTN","PSOPFSU0",98,0)
 ; related institution
"RTN","PSOPFSU0",99,0)
 S INST=$$GET1^DIQ(59,DIV,100,"I") Q:'INST ""
"RTN","PSOPFSU0",100,0)
 S DIV=$O(^DG(40.8,"AD",INST,0)) ; pointer to medical center division
"RTN","PSOPFSU0",101,0)
 Q DIV
"RTN","PSOPFSU0",102,0)
 ;
"RTN","PSOPFSU0",103,0)
CLOK ;
"RTN","PSOPFSU0",104,0)
 N I S I=0 F  S I=$O(^PS(59,I)) Q:'I!(CL>0)  D
"RTN","PSOPFSU0",105,0)
 . I $S('$D(^PS(59,I,"I")):1,'+$P(^("I"),"^"):1,DT'>+$P(^("I"),"^"):1,1:0) S CL=$P($G(^PS(59,I,"PFS")),"^")
"RTN","PSOPFSU0",106,0)
 Q
"RTN","PSOPFSU0",107,0)
 ;
"RTN","PSOPFSU1")
0^27^B33416502
"RTN","PSOPFSU1",1,0)
PSOPFSU1 ;BIR/LE,AM - PFSS Charge Message & Utilities ;08/09/93
"RTN","PSOPFSU1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**201,225**;DEC 1997;Build 29
"RTN","PSOPFSU1",3,0)
 ;External reference CHARGE^IBBAPI and GETCHGID^IBBAPI supported by DBIA 4665
"RTN","PSOPFSU1",4,0)
 Q
"RTN","PSOPFSU1",5,0)
 ;
"RTN","PSOPFSU1",6,0)
CHRG(PSORXN,PSOREF,PSOCHTYP,PSOPFS) ;ENTRY POINT:  
"RTN","PSOPFSU1",7,0)
 ;Used to pass charge msg info to an external billing system via IBB API's   
"RTN","PSOPFSU1",8,0)
 ;       Inputs:  PSORXN = RX IEN, PSOREF = fill number, PSOCHTYP = "CG" for Charge or "CD" for Credit transaction,
"RTN","PSOPFSU1",9,0)
 ;                PSOPFS = switch status (0 or 1) ^ PFSS Account Reference for the fill ^ PFSS Charge ID for the fill
"RTN","PSOPFSU1",10,0)
 ;       Outputs:  none
"RTN","PSOPFSU1",11,0)
 ;       
"RTN","PSOPFSU1",12,0)
 N I,CLDIV,IFN,J,PSODG,PSOZCL,PSOCHID,PSOPFSA,PSODFN,PSORX,PSOFT1,PSODRG,PSODRUG,PSORXE,PSOCHG,PSOFD,PSOFT,PSOFLD
"RTN","PSOPFSU1",13,0)
 ; quit if PFSS switch is off or not defined
"RTN","PSOPFSU1",14,0)
 Q:'+$G(PSOPFS)
"RTN","PSOPFSU1",15,0)
 ;
"RTN","PSOPFSU1",16,0)
 ; check for CHARGE LOCATION before processing charge message.
"RTN","PSOPFSU1",17,0)
 S CLDIV=$$CHLOC^PSOPFSU0()
"RTN","PSOPFSU1",18,0)
 Q:CLDIV<1  ;if no CHARGE LOCATION, don't send charge message to either IB or external billing system.
"RTN","PSOPFSU1",19,0)
 ;
"RTN","PSOPFSU1",20,0)
 ; check for PFSS Acct Reference; if not one define, request one
"RTN","PSOPFSU1",21,0)
 S PSOPFSA=$P(PSOPFS,"^",2)
"RTN","PSOPFSU1",22,0)
 I PSOPFSA<1 D PFSI(PSORXN,PSOREF) S PSOPFSA=$P(PSOPFS,"^",2) I PSOPFSA<1 D  ;because PSOCP is too large, need to check for/get them here
"RTN","PSOPFSU1",23,0)
 .S PSOPFSA=$$GACT^PSOPFSU0(PSORXN,PSOREF)
"RTN","PSOPFSU1",24,0)
 Q:PSOPFSA<1  ;Normally IB returns an acct ref or zero for unsuccessful if a problem is encountered.  
"RTN","PSOPFSU1",25,0)
 ; If IBB didn't return a value, don't send charge message because IBB will produce a hard error.  Subsequent phase of PFSS will provide further error handling.
"RTN","PSOPFSU1",26,0)
 ;
"RTN","PSOPFSU1",27,0)
 ; check for PFSS Charge ID. If no charge ID, means Rx never sent to external bill sys or there was a problem retrieve one.
"RTN","PSOPFSU1",28,0)
 S PSOCHID=$P(PSOPFS,"^",3)
"RTN","PSOPFSU1",29,0)
 ;If no Charge ID is  defined, request a Unique Charge ID and store it in file 52
"RTN","PSOPFSU1",30,0)
 I PSOCHID<1 S PSOCHID=$$GETCHGID^IBBAPI() I PSOCHID>0 D
"RTN","PSOPFSU1",31,0)
 . I PSOREF=0 S $P(^PSRX(PSORXN,"PFS"),"^",2)=PSOCHID  ;set directly for speed (CMOPs, etc.)
"RTN","PSOPFSU1",32,0)
 . I PSOREF>0 S $P(^PSRX(PSORXN,1,PSOREF,"PFS"),"^",2)=PSOCHID
"RTN","PSOPFSU1",33,0)
 Q:PSOCHID<1  ;no charge message will be sent if can't get a PFSS CHARGE ID from IB.  Subsequent phase of PFSS will provide error handling for this type problem.
"RTN","PSOPFSU1",34,0)
 ;Retrieve all fields to pass for the charge message
"RTN","PSOPFSU1",35,0)
 S PSOFT="4,10,21" I PSOREF=0 D CHRGOF
"RTN","PSOPFSU1",36,0)
 I PSOREF>0 D CHRGRF
"RTN","PSOPFSU1",37,0)
 ;Get general Rx data fields
"RTN","PSOPFSU1",38,0)
 D GETS^DIQ(52,PSORXN,"2;3;6;105","I","PSORX")
"RTN","PSOPFSU1",39,0)
 S PSOFT1(29)=$$NDC^PSOHDR(PSORXN,PSOREF,$S(PSOREF>0:"R",1:""))
"RTN","PSOPFSU1",40,0)
 S PSODFN=$G(PSORX(52,PSORXN_",",2,"I")),PSODRG=$G(PSORX(52,PSORXN_",",6,"I")),PSOFT1(31)=$G(PSORX(52,PSORXN_",",105,"I"))
"RTN","PSOPFSU1",41,0)
 D DATA^PSS50(PSODRG,,,,,"PSOSC")
"RTN","PSOPFSU1",42,0)
 ;S PSOFT1(2)="PSO"_PSORXN_"F"_PSOREF  ;12/6/05; DECISION MADE TO NOT SEND clinicial event indicator FOR OP
"RTN","PSOPFSU1",43,0)
 S PSOFT1(7)=$G(^TMP($J,"PSOSC",PSODRG,400)),PSOFT1(6)=PSOCHTYP,PSOFT1(13)=160
"RTN","PSOPFSU1",44,0)
 S PSOFT1(18)=$G(PSORX(52,PSORXN_",",3,"I")),PSOFT1(18)=$$GET1^DIQ(53,PSOFT1(18)_",",15,"I")
"RTN","PSOPFSU1",45,0)
 S PSOFT1(22)=$FN($G(^TMP($J,"PSOSC",PSODRG,16)),"",2),PSOFT1(29)=PSOFT1(29)_";"_$G(^TMP($J,"PSOSC",PSODRG,.01))
"RTN","PSOPFSU1",46,0)
 S PSORXE(31)=$G(^TMP($J,"PSOSC",PSODRG,3)),PSORXE(17)=PSOREF
"RTN","PSOPFSU1",47,0)
 S:(PSORXE(18)="") PSORXE(18)=$G(RELDT)  ;CMOP
"RTN","PSOPFSU1",48,0)
 S PSORXE(15)=PSORXN
"RTN","PSOPFSU1",49,0)
 S PSOCHG=$$CHARGE^IBBAPI(PSODFN,PSOPFSA,PSOCHTYP,PSOCHID,.PSOFT1,"",.PSODG,.PSOZCL,.PSORXE,"","")
"RTN","PSOPFSU1",50,0)
 ;errors to be handled in subsequent phase
"RTN","PSOPFSU1",51,0)
 K ^TMP($J,"PSOSC")
"RTN","PSOPFSU1",52,0)
 Q
"RTN","PSOPFSU1",53,0)
 ;
"RTN","PSOPFSU1",54,0)
CHRGOF ;Retrieve charge fields for orig fills
"RTN","PSOPFSU1",55,0)
 D GETS^DIQ(52,PSORXN,"4;7;8;22;31;125","I","PSORX")
"RTN","PSOPFSU1",56,0)
 S PSOFD="22,7,4"
"RTN","PSOPFSU1",57,0)
 F I=1:1 S PSOFLD=$P(PSOFD,",",I) Q:PSOFLD=""  S PSOFT1($P(PSOFT,",",I))=$G(PSORX(52,PSORXN_",",$P(PSOFD,",",I),"I"))
"RTN","PSOPFSU1",58,0)
 S PSOPFSA=$G(PSORX(52,PSORXN_",",125,"I")),PSORXE(18)=$G(PSORX(52,PSORXN_",",31,"I"))
"RTN","PSOPFSU1",59,0)
 S PSORXE(1)=PSOFT1(10)_";;"_$G(PSORX(52,PSORXN_",",8,"I"))
"RTN","PSOPFSU1",60,0)
 D GOC
"RTN","PSOPFSU1",61,0)
 Q
"RTN","PSOPFSU1",62,0)
 ;
"RTN","PSOPFSU1",63,0)
CHRGRF ;Retrieve charge fields for refills
"RTN","PSOPFSU1",64,0)
 D GETS^DIQ(52.1,PSOREF_","_PSORXN,".01;1;1.1;15;17;21","I","PSORX")
"RTN","PSOPFSU1",65,0)
 S PSOFD=".01,1,15"
"RTN","PSOPFSU1",66,0)
 F I=1:1 S PSOFLD=$P(PSOFD,",",I) Q:PSOFLD=""  S PSOFT1($P(PSOFT,",",I))=$G(PSORX(52.1,PSOREF_","_PSORXN_",",$P(PSOFD,",",I),"I"))
"RTN","PSOPFSU1",67,0)
 S PSOPFSA=$G(PSORX(52.1,PSOREF_","_PSORXN_",",21,"I")),PSORXE(18)=$G(PSORX(52.1,PSOREF_","_PSORXN_",",17,"I"))
"RTN","PSOPFSU1",68,0)
 S PSORXE(1)=PSOFT1(10)_";;"_$G(PSORX(52.1,PSOREF_","_PSORXN_",",1.1,"I"))
"RTN","PSOPFSU1",69,0)
 D GOC
"RTN","PSOPFSU1",70,0)
 Q
"RTN","PSOPFSU1",71,0)
 ;
"RTN","PSOPFSU1",72,0)
GOC ;Called from CHRGOF, CHRGRF.  Parse OP classifications and ICD's.  Don't send null values.
"RTN","PSOPFSU1",73,0)
 D GETS^DIQ(52,PSORXN,"52311*","I","PSORX")
"RTN","PSOPFSU1",74,0)
 F I=1:1 Q:'$D(PSORX(52.052311,I_","_PSORXN_","))  D
"RTN","PSOPFSU1",75,0)
 . S:PSORX(52.052311,I_","_PSORXN_",",".01","I")'="" PSODG(I,3)=PSORX(52.052311,I_","_PSORXN_",",".01","I"),PSODG(I,6)="F"
"RTN","PSOPFSU1",76,0)
 . I I=1 F J=1:1:8 Q:'$D(PSORX(52.052311,I_","_PSORXN_",",J,"I"))  D
"RTN","PSOPFSU1",77,0)
 . . S:PSORX(52.052311,I_","_PSORXN_",",J,"I")'="" PSOZCL(J,2)=J,PSOZCL(J,3)=PSORX(52.052311,I_","_PSORXN_",",J,"I")
"RTN","PSOPFSU1",78,0)
 S:'$D(PSOZCL) PSOZCL="" S:'$D(PSODG) PSODG=""
"RTN","PSOPFSU1",79,0)
 Q
"RTN","PSOPFSU1",80,0)
 ;
"RTN","PSOPFSU1",81,0)
CG ;Called from PSOCPB; for the last fill, send chrg message if released; PSOCPB too large for more code.
"RTN","PSOPFSU1",82,0)
 ; this is used for SC/EI changes when no charges are cancelled.  Expects to have PSODA = RXIEN and PSOLFIL= fill#
"RTN","PSOPFSU1",83,0)
 ;N REL,PFS
"RTN","PSOPFSU1",84,0)
 ;I 'PSOLFIL S REL=$$GET1^DIQ(52,PSODA_",","31","I")
"RTN","PSOPFSU1",85,0)
 ;I PSOLFIL>0 S REL=$$GET1^DIQ(52.1,PSOLFIL_","_PSODA_",","17","I")  ;REFILL
"RTN","PSOPFSU1",86,0)
 ;I REL'=""&(PSOPFS)&(+$G(PSOPFSA)) D CHRG(PSODA,PSOLFIL,"CG",PSOPFS)
"RTN","PSOPFSU1",87,0)
 Q
"RTN","PSOPFSU1",88,0)
 ;
"RTN","PSOPFSU1",89,0)
LF(PSODA) ;return last fill number;CALLED from PSOCPB
"RTN","PSOPFSU1",90,0)
 N LF
"RTN","PSOPFSU1",91,0)
 I $D(^PSRX(PSODA,1,0)) S LF="A",LF=$O(^PSRX(PSODA,1,LF),-1) Q LF
"RTN","PSOPFSU1",92,0)
 Q 0  ;ORIG FILL
"RTN","PSOPFSU1",93,0)
 ;
"RTN","PSOPFSU1",94,0)
PFSI(PSODA,PSOREF) ;get PFSS Acct Ref and Charge ID and store in PSOPFS; Called from multiple places in this routine
"RTN","PSOPFSU1",95,0)
 I PSOREF=0&($D(^PSRX(PSODA,"PFS"))) S PSOPFS=PSOPFS_"^"_$P(^PSRX(PSODA,"PFS"),"^",1,2) Q
"RTN","PSOPFSU1",96,0)
 I PSOREF>0&($D(^PSRX(PSODA,1,PSOREF,"PFS"))) S PSOPFS=PSOPFS_"^"_$P(^PSRX(PSODA,1,PSOREF,"PFS"),"^",1,2)
"RTN","PSOPFSU1",97,0)
 Q
"RTN","PSOPFSU1",98,0)
 ;
"RTN","PSOPFSU1",99,0)
PFSA(PSODA,PSOREF,WR) ;called from PSOCP (WR=2) and PSOCPB (WR=3)
"RTN","PSOPFSU1",100,0)
 ;get switch status, acct ref, and charge ID, then validate switch vs availability of PFSS acct ref
"RTN","PSOPFSU1",101,0)
 Q:'$G(WR)
"RTN","PSOPFSU1",102,0)
 S PSOPFS=+$$SWSTAT^IBBAPI()
"RTN","PSOPFSU1",103,0)
 D PFSI(PSODA,PSOREF)
"RTN","PSOPFSU1",104,0)
 ; if switch is off, but have an PFSS Acct Ref for new orders, send charge to IDX
"RTN","PSOPFSU1",105,0)
 ; if switch is off, but have a Charge ID, send cancel charge to IDX
"RTN","PSOPFSU1",106,0)
 I '+PSOPFS,$P(PSOPFS,"^",WR)>0 S $P(PSOPFS,"^")=1
"RTN","PSOPFSU1",107,0)
 Q
"RTN","PSOPFSU1",108,0)
 ;
"RTN","PSOPFSU1",109,0)
PFS ;;Called from PSOCPB; PSOCPB is too large to hold more code.  Processes copay cancels for PFS only.
"RTN","PSOPFSU1",110,0)
 ;find any fills being cancelled for PFSS, cancel them, and remove them from PSOCAN, then return to PSOCP to process any IB cancels
"RTN","PSOPFSU1",111,0)
 ;
"RTN","PSOPFSU1",112,0)
 N X,I,PSOREF,PSOOLD,PREA,PSONW
"RTN","PSOPFSU1",113,0)
 ;If it's a PFS fill, if released, and not previously cancelled, set the X array, then kill it out of PSOCAN array.
"RTN","PSOPFSU1",114,0)
 ;Killed out of PSOCAN because don't want the IB processing to look at PFSS billed fills.
"RTN","PSOPFSU1",115,0)
 ;Note that in PSOCPD, PFS entries are not stored in PSOCAN array if a charge ID is not defined.  So, don't have to check for release date. 
"RTN","PSOPFSU1",116,0)
 ;If prev cancelled and PFS, kill it from PSOCAN array
"RTN","PSOPFSU1",117,0)
 S I="" F  S I=$O(PSOCAN(I)) Q:I=""  S PSOREF=+PSOCAN(I) D
"RTN","PSOPFSU1",118,0)
 . I PSOREF=PSODA&($P(PSOCAN(I),"^",10)="PFS") D  Q
"RTN","PSOPFSU1",119,0)
 . . I $P(PSOCAN(I),"^",5)["CANCEL" K PSOCAN(I) Q
"RTN","PSOPFSU1",120,0)
 . . S X(0)=$P(PSOCAN(I),"^",2)_"^"_PSORSN K PSOCAN(I)
"RTN","PSOPFSU1",121,0)
 . I PSOREF'=PSODA&($P(PSOCAN(I),"^",10)="PFS") D
"RTN","PSOPFSU1",122,0)
 . . I $P(PSOCAN(I),"^",5)["CANCEL" K PSOCAN(I) Q
"RTN","PSOPFSU1",123,0)
 . . S X(PSOREF)=$P(PSOCAN(I),"^",2)_"^"_PSORSN K PSOCAN(I)
"RTN","PSOPFSU1",124,0)
 I $G(CANTYPE)&('$D(X)) D MSGNOCAN^PSOCPB Q  ;CANTYPE=1 means trying cancelling all fills;can't cancel twice
"RTN","PSOPFSU1",125,0)
 ;
"RTN","PSOPFSU1",126,0)
 ;send charge messages, set activity log, display message
"RTN","PSOPFSU1",127,0)
 S PREA="C",PSOREF=""
"RTN","PSOPFSU1",128,0)
 F  S PSOREF=$O(X(PSOREF)) Q:PSOREF=""  S PSOPFS=1 D PFSI(PSODA,PSOREF) D CHRG(PSODA,PSOREF,"CD",PSOPFS) D ACTLOG^PSOCPA D:'$G(CANTYPE) MSG^PSOCPB
"RTN","PSOPFSU1",129,0)
 I $G(CANTYPE)&('$D(PSOCAN)) D MSG^PSOCPB  ;if cancelling all and no legacy IB bills to cancel, write msg
"RTN","PSOPFSU1",130,0)
 S PSOPFSA=0  ;reset variable so charge isn't sent twice if SC/EI's were also changed.
"RTN","PSOPFSU1",131,0)
 Q
"RTN","PSOPFSU1",132,0)
 ;
"RTN","PSOPTPST")
0^14^B27932490
"RTN","PSOPTPST",1,0)
PSOPTPST ;BIR/DSD - Post Patient Selection Action ;07/25/96
"RTN","PSOPTPST",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**7,71,88,146,157,143,225**;DEC 1997;Build 29
"RTN","PSOPTPST",3,0)
 ;External reference to SDCO22 supported by DBIA 1579
"RTN","PSOPTPST",4,0)
 ;External reference to IBE(350.1,"ANEW" supported by DBIA 592
"RTN","PSOPTPST",5,0)
 ;External reference to PS(55 supported by DBIA 2228
"RTN","PSOPTPST",6,0)
 ;External reference to IBARX supported by DBIA 125
"RTN","PSOPTPST",7,0)
 ;External reference to $$GETSHAD^DGUTL3 supported by DBIA 4462
"RTN","PSOPTPST",8,0)
START S PSOQFLG=0
"RTN","PSOPTPST",9,0)
 D GET ; Gets data from Patient file
"RTN","PSOPTPST",10,0)
 D DEAD G:PSOQFLG END ; Checks to see if patient still alive
"RTN","PSOPTPST",11,0)
 G:$G(PSOFROM("PTLKUP"))']"" END ; skips questions if not called by RX data entry
"RTN","PSOPTPST",12,0)
 D INP G:PSOQFLG END ;Checks to see if inpatient and whether to continue
"RTN","PSOPTPST",13,0)
 D CNH G:PSOQFLG END ; Checks to see if nursing home patient
"RTN","PSOPTPST",14,0)
 D ELIG ; Checks eligibility
"RTN","PSOPTPST",15,0)
 D:$G(DUZ("AG"))="V" COPAY ; Deals with copay
"RTN","PSOPTPST",16,0)
 D ADDRESS ; Display address information
"RTN","PSOPTPST",17,0)
 D:$G(^PS(55,PSODFN,1))]"" REMARKS ; Displays narrative about patient
"RTN","PSOPTPST",18,0)
END D EOJ
"RTN","PSOPTPST",19,0)
 Q
"RTN","PSOPTPST",20,0)
 ;----------------------------------------------------------
"RTN","PSOPTPST",21,0)
GET K DIC,DR,DIQ S DIC=2,DA=PSODFN,DR=".1;.172;.351;.361;148",DIQ="PSOPTPST"
"RTN","PSOPTPST",22,0)
 D EN^DIQ1 K DIC,DA,DR,DIQ
"RTN","PSOPTPST",23,0)
 Q
"RTN","PSOPTPST",24,0)
 ;
"RTN","PSOPTPST",25,0)
DEAD ;
"RTN","PSOPTPST",26,0)
 I $G(PSOPTPST(2,PSODFN,.351))]"" S (PSODEATH,PSOQFLG)=1 S SSN=$P(^DPT(PSODFN,0),"^",9) W !?10,$C(7),PSORX("NAME")_" ("_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)_") DIED "_PSOPTPST(2,PSODFN,.351),! S:$G(POERR) POERR("DEAD")=1 D
"RTN","PSOPTPST",27,0)
 .;I '$O(^PS(55,PSODFN,"P","A",DT)) Q
"RTN","PSOPTPST",28,0)
 .S ACOM="Date of Death "_PSOPTPST(2,PSODFN,.351)_".",ZTRTN="CAN^PSOCAN3",ZTDESC="Outpatient Pharmacy Autocancel Due to Death of Patient",ZTSAVE("ACOM")="",ZTSAVE("PSODFN")="",ZTSAVE("PSODEATH")=""
"RTN","PSOPTPST",29,0)
 .S ZTIO="",PSOCLC=DUZ,ZTSAVE("PSOCLC")="",ZTDTH=$H D ^%ZTLOAD K ACOM,ZTSK,PSODEATH
"RTN","PSOPTPST",30,0)
 Q
"RTN","PSOPTPST",31,0)
 ;
"RTN","PSOPTPST",32,0)
INP I '$G(PSOXFLG),'$G(PSOFIN),$G(PSOPTPST(2,PSODFN,.1))]"" S PSOXFLG=1,SSN=$P(^DPT(PSODFN,0),"^",9) W !!?10,$C(7),PSORX("NAME")_" ("_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)_")" K SSN
"RTN","PSOPTPST",33,0)
 I $G(PSOPTPST(2,PSODFN,.1))]"" W !?10,$C(7),"Patient is an Inpatient on Ward "_PSOPTPST(2,PSODFN,.1)_" !!" D DIR
"RTN","PSOPTPST",34,0)
 Q
"RTN","PSOPTPST",35,0)
TPB ;
"RTN","PSOPTPST",36,0)
 N PSOTPSSN
"RTN","PSOPTPST",37,0)
 I '$G(PSODFN) Q
"RTN","PSOPTPST",38,0)
 I $D(^PS(52.91,PSODFN,0)) I '$P(^PS(52.91,PSODFN,0),"^",3)!($P(^(0),"^",3)>DT) D
"RTN","PSOPTPST",39,0)
 .S PSOTPSSN=$P($G(^DPT(PSODFN,0)),"^",9)
"RTN","PSOPTPST",40,0)
 .I $G(PSOFIN)!($G(MEDP)) D
"RTN","PSOPTPST",41,0)
 ..I $G(MEDP) W !!?10,$C(7),$P($G(^DPT(PSODFN,0)),"^")_" ("_$E(PSOTPSSN,1,3)_"-"_$E(PSOTPSSN,4,5)_"-"_$E(PSOTPSSN,6,9)_")" Q
"RTN","PSOPTPST",42,0)
 ..I $G(PSOFIN) I $G(PSOPTPST(2,PSODFN,148))="YES"!($G(PSOPTPST(2,PSODFN,.1))]"") W !!?10,$C(7),$P($G(^DPT(PSODFN,0)),"^")_" ("_$E(PSOTPSSN,1,3)_"-"_$E(PSOTPSSN,4,5)_"-"_$E(PSOTPSSN,6,9)_")"
"RTN","PSOPTPST",43,0)
 .I '$G(PSOFIN),'$G(MEDP) W !
"RTN","PSOPTPST",44,0)
 .W !?10,"Patient is eligible for the Transitional Pharmacy Benefit!!" D DIR
"RTN","PSOPTPST",45,0)
 Q
"RTN","PSOPTPST",46,0)
 ;
"RTN","PSOPTPST",47,0)
CNH I $G(MEDP),$G(PSOPTPST(2,PSODFN,148))="YES",$G(PSOPTPST(2,PSODFN,.1))']"" D
"RTN","PSOPTPST",48,0)
 .S SSN=$P(^DPT(PSODFN,0),"^",9) W !!?10,$C(7),PSORX("NAME")_" ("_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)_")" K SSN
"RTN","PSOPTPST",49,0)
 K PSORX("CNH") I $G(PSOPTPST(2,PSODFN,148))="YES" W !?10,$C(7),"Patient is in a Contract Nursing Home !!" D DIR S:'$G(PSOQFLG) PSORX("CNH")=1
"RTN","PSOPTPST",50,0)
 Q
"RTN","PSOPTPST",51,0)
 ;
"RTN","PSOPTPST",52,0)
ELIG I $G(PSOPTPST(2,PSODFN,.361))]"",$G(PSOPTPST(2,PSODFN,.172))'="I" W !,"MAS Eligibility: "_PSOPTPST(2,PSODFN,.361)
"RTN","PSOPTPST",53,0)
 S DFN=PSODFN D RE^PSODEM
"RTN","PSOPTPST",54,0)
 Q
"RTN","PSOPTPST",55,0)
 ;
"RTN","PSOPTPST",56,0)
COPAY K PSOBILL,PSOCPAY S DFN=PSODFN,(X,PSOPTIB)=$P($G(^PS(59,+PSOSITE,"IB")),"^")_"^"_PSODFN D XTYPE^IBARX
"RTN","PSOPTPST",57,0)
 I '$D(^IBE(350.1,"ANEW",+PSOPTIB,1,1)) S PSOQFLG=1 D  K PSOPTIB Q
"RTN","PSOPTPST",58,0)
 .W $C(7),!!,"There is a problem with the IB SERVICE/SECTION entry in your Pharmacy Site File."
"RTN","PSOPTPST",59,0)
 .W !,"You will not be able to enter any new prescriptions until this is corrected!",!
"RTN","PSOPTPST",60,0)
 S (ACTYP,BL)="",(PSOBILL,PSOCPAY)=0 I +Y=-1 W !,"ERROR IN COPAY ELIGIBILITY ENCOUNTERED." G COPAYX
"RTN","PSOPTPST",61,0)
COPAY1 S ACTYP=$O(Y(ACTYP)) G:'ACTYP COPAYX F III=0:0 S BL=$O(Y(ACTYP,BL)) Q:BL=""  I BL>0 S PSOBILL=BL,PSOCPAY=BL_"^"_Y(ACTYP,BL)
"RTN","PSOPTPST",62,0)
 G COPAY1
"RTN","PSOPTPST",63,0)
COPAYX K X,Y,ACTYP,BL,III,PSOPTIB
"RTN","PSOPTPST",64,0)
 ;I $G(PSOBILL) 
"RTN","PSOPTPST",65,0)
 D QST
"RTN","PSOPTPST",66,0)
 Q
"RTN","PSOPTPST",67,0)
 ;
"RTN","PSOPTPST",68,0)
ADDRESS N DFN S (DA,DFN)=PSODFN D ADD^VADPT K DFN,PSOI,DA,DR
"RTN","PSOPTPST",69,0)
 Q
"RTN","PSOPTPST",70,0)
 ;
"RTN","PSOPTPST",71,0)
REMARKS S PSOX=$G(^PS(55,PSODFN,1)) W !!,?5
"RTN","PSOPTPST",72,0)
 F PSOI=1:1 Q:$P(PSOX," ",PSOI,900)=""  W:$X+$L($P(PSOX," ",PSOI))+$L(" ")>IOM !?5 W $P(PSOX," ",PSOI)_" "
"RTN","PSOPTPST",73,0)
 K PSOX,PSOI
"RTN","PSOPTPST",74,0)
 Q
"RTN","PSOPTPST",75,0)
 ;
"RTN","PSOPTPST",76,0)
DIR K DIR W !
"RTN","PSOPTPST",77,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="Do You Want To Continue" D ^DIR K DIR
"RTN","PSOPTPST",78,0)
 S:'Y PSOQFLG=1 K X,Y,DIRUT,DTOUT,DUOUT
"RTN","PSOPTPST",79,0)
 Q
"RTN","PSOPTPST",80,0)
 ;
"RTN","PSOPTPST",81,0)
EOJ K:PSOQFLG PSORX("CNH") K PSOPTPST,VAPA
"RTN","PSOPTPST",82,0)
 Q
"RTN","PSOPTPST",83,0)
QST ;Ask new questions for Copay
"RTN","PSOPTPST",84,0)
 I '$$DT^PSOMLLDT Q
"RTN","PSOPTPST",85,0)
 K PSOIBQS
"RTN","PSOPTPST",86,0)
 I $G(PSOBILL) S PSOIBQS(PSODFN,"SC")=""
"RTN","PSOPTPST",87,0)
 S PSOIBQS(PSODFN,"SC>50")=""
"RTN","PSOPTPST",88,0)
 I +$P($$CVEDT^DGCV(PSODFN),"^",3) S PSOIBQS(PSODFN,"CV")=""
"RTN","PSOPTPST",89,0)
 I $$AO^SDCO22(PSODFN) S PSOIBQS(PSODFN,"VEH")=""
"RTN","PSOPTPST",90,0)
 I $$IR^SDCO22(PSODFN) S PSOIBQS(PSODFN,"RAD")=""
"RTN","PSOPTPST",91,0)
 I $$EC^SDCO22(PSODFN) S PSOIBQS(PSODFN,"PGW")=""
"RTN","PSOPTPST",92,0)
 I $L($T(GETSHAD^DGUTL3)) S:$$GETSHAD^DGUTL3(PSODFN)=1 PSOIBQS(PSODFN,"SHAD")=""
"RTN","PSOPTPST",93,0)
 I $P($$GETSTAT^DGMSTAPI(PSODFN),"^",2)="Y" S PSOIBQS(PSODFN,"MST")=""
"RTN","PSOPTPST",94,0)
 I $T(GETCUR^DGNTAPI)]"" N PSONCP,PSONCPX S PSONCPX=$$GETCUR^DGNTAPI(PSODFN,"PSONCP") I $P($G(PSONCP("IND")),"^")="Y" S PSOIBQS(PSODFN,"HNC")=""
"RTN","PSOPTPST",95,0)
 Q
"RTN","PSORENW1")
0^15^B60533620
"RTN","PSORENW1",1,0)
PSORENW1 ;BIR/DSD - Renew Main Driver Continuation ;03/29/93
"RTN","PSORENW1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**20,37,51,46,71,117,157,143,219,239,225**;DEC 1997;Build 29
"RTN","PSORENW1",3,0)
 ;External reference ^VA(200 supported by DBIA 10060
"RTN","PSORENW1",4,0)
 ;
"RTN","PSORENW1",5,0)
START ;
"RTN","PSORENW1",6,0)
 S PSORENW("RX0")=^PSRX(PSORENW("OIRXN"),0),PSORENW("RX2")=^(2),PSORENW("RX3")=^(3),PSORENW("STA")=^("STA"),PSORENW("TN")=$G(^("TN")),SIGOK=+$P($G(^("SIG")),"^",2)
"RTN","PSORENW1",7,0)
 S PSOIBOLD=$G(PSORENW("OIRXN"))
"RTN","PSORENW1",8,0)
 D SETIB
"RTN","PSORENW1",9,0)
 S PSORENW("PROVIDER")=$P(PSORENW("RX0"),"^",4)
"RTN","PSORENW1",10,0)
 S PSORX("PROVIDER NAME")=$P($G(^VA(200,PSORENW("PROVIDER"),0)),"^")
"RTN","PSORENW1",11,0)
 S PSORENW("CLINIC")=$P(PSORENW("RX0"),"^",5),PSORENW("COPIES")=$P(PSORENW("RX0"),"^",18)
"RTN","PSORENW1",12,0)
 I $G(PSOFDR),$P($G(OR0),"^",13) S PSORENW("CLINIC")=$P($G(OR0),"^",13)
"RTN","PSORENW1",13,0)
 S PSORENW("REMARKS")="RENEWED FROM RX # "_$P(PSORENW("RX0"),"^")
"RTN","PSORENW1",14,0)
 S PSORENW("SIG")=$P($G(^PSRX(PSORENW("OIRXN"),"SIG")),"^")
"RTN","PSORENW1",15,0)
 S:$P(PSORENW("RX3"),"^",3) PSORENW("COSIGNING PROVIDER")=$P(PSORENW("RX3"),"^",3)
"RTN","PSORENW1",16,0)
 S (PSODFN,PSORENW("PSODFN"))=$P(PSORENW("RX0"),"^",2)
"RTN","PSORENW1",17,0)
 S PSORENW("ORX #")=$P(PSORENW("RX0"),"^")
"RTN","PSORENW1",18,0)
 S PSORENW("DRUG IEN")=$P(PSORENW("RX0"),"^",6)
"RTN","PSORENW1",19,0)
 S PSORENW("INS")=$S($G(PSORENW("INS"))]"":PSORENW("INS"),1:$G(^PSRX(PSORENW("OIRXN"),"INS")))
"RTN","PSORENW1",20,0)
 S D=0 F  S D=$O(^PSRX(PSORENW("OIRXN"),"INS1",D)) Q:'D  S PSORENW("SIG",D)=^PSRX(PSORENW("OIRXN"),"INS1",D,0)
"RTN","PSORENW1",21,0)
 I '$O(PSORENW("SIG",0)),$G(PSORENW("INS"))]"" S PSORENW("SIG",1)=PSORENW("INS")
"RTN","PSORENW1",22,0)
 G:$G(PSORENW("ENT")) FDR
"RTN","PSORENW1",23,0)
 I $G(PSORENW("ENT"))'>0,'$O(^PSRX(PSORENW("OIRXN"),6,0)) S PSORENW("ENT")=0 G FDR
"RTN","PSORENW1",24,0)
 F I=0:0 S I=$O(^PSRX(PSORENW("OIRXN"),6,I)) Q:'I  S DOSE=^PSRX(PSORENW("OIRXN"),6,I,0) D
"RTN","PSORENW1",25,0)
 .S PSORENW("ENT")=$G(PSORENW("ENT"))+1,PSORENW("DOSE",PSORENW("ENT"))=$P(DOSE,"^")
"RTN","PSORENW1",26,0)
 .S PSORENW("UNITS",PSORENW("ENT"))=$P(DOSE,"^",3),PSORENW("DOSE ORDERED",PSORENW("ENT"))=$P(DOSE,"^",2),PSORENW("ROUTE",PSORENW("ENT"))=$P(DOSE,"^",7)
"RTN","PSORENW1",27,0)
 .S PSORENW("SCHEDULE",PSORENW("ENT"))=$P(DOSE,"^",8),PSORENW("DURATION",PSORENW("ENT"))=$P(DOSE,"^",5),PSORENW("CONJUNCTION",PSORENW("ENT"))=$P(DOSE,"^",6)
"RTN","PSORENW1",28,0)
 .S PSORENW("NOUN",PSORENW("ENT"))=$P(DOSE,"^",4),PSORENW("VERB",PSORENW("ENT"))=$P(DOSE,"^",9)
"RTN","PSORENW1",29,0)
 .I $G(^PSRX(PSORENW("OIRXN"),6,I,1))]"" S PSORENW("ODOSE",PSORENW("ENT"))=^PSRX(PSORENW("OIRXN"),6,I,1)
"RTN","PSORENW1",30,0)
 .K DOSE
"RTN","PSORENW1",31,0)
FDR I $G(PSOFDR) D
"RTN","PSORENW1",32,0)
 .F I=0:0 S I=$O(^PSRX(PSORENW("OIRXN"),6,I)) Q:'I  I $G(^PSRX(PSORENW("OIRXN"),6,I,1))]"" S PSORENW("ODOSE",I)=^PSRX(PSORENW("OIRXN"),6,I,1)
"RTN","PSORENW1",33,0)
 .S $P(PSORENW("RX0"),"^",7)=$P(OR0,"^",10),$P(PSORENW("RX0"),"^",11)=$P(OR0,"^",17)
"RTN","PSORENW1",34,0)
 .S (PSORX("PROVIDER NAME"),PSORENW("PROVIDER NAME"))=$P(^VA(200,$P(OR0,"^",5),0),"^"),PSORENW("PROVIDER")=$P(OR0,"^",5)
"RTN","PSORENW1",35,0)
 .K PSORENW("COSIGNING PROVIDER")
"RTN","PSORENW1",36,0)
 .I $G(PSORENW("PROVIDER")),$P($G(^VA(200,PSORENW("PROVIDER"),"PS")),"^",7),$P($G(^("PS")),"^",8) S PSORENW("COSIGNING PROVIDER")=$P($G(^("PS")),"^",8)
"RTN","PSORENW1",37,0)
 .S (PSDY,PSORENW("DAYS SUPPLY"))=$P(PSORENW("RX0"),"^",8)
"RTN","PSORENW1",38,0)
 .S POERR=1,DREN=$P(PSORENW("RX0"),"^",6) D DRG^PSOORDRG K POERR S PSODIR("CS")=0
"RTN","PSORENW1",39,0)
 .F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S PSODIR("CS")=1
"RTN","PSORENW1",40,0)
 .I PSODIR("CS") S RFMX=$S(PSDY<60:5,PSDY'<60&(PSDY'>89):2,PSDY=90:1,1:0)
"RTN","PSORENW1",41,0)
 .E  S RFMX=$S(PSDY<60:11,PSDY'<60&(PSDY'>89):5,PSDY=90:3,1:0)
"RTN","PSORENW1",42,0)
 .S $P(PSORENW("RX0"),"^",9)=$S($P(OR0,"^",11)'>RFMX:$P(OR0,"^",11),1:RFMX),$P(OR0,"^",11)=$P(PSORENW("RX0"),"^",9)
"RTN","PSORENW1",43,0)
 .K RFMX,PSODIR("CS"),PSDY
"RTN","PSORENW1",44,0)
END Q
"RTN","PSORENW1",45,0)
STOP K PSEXDT,X,%DT S PSON52("QFLG")=0,DAYS=$S($G(PSORENW("DAYS SUPPLY")):PSORENW("DAYS SUPPLY"),1:$P(PSORENW("RX0"),"^",8))
"RTN","PSORENW1",46,0)
 S DEA("CS")=0 K DIR,DIC
"RTN","PSORENW1",47,0)
 F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S DEA("CS")=1
"RTN","PSORENW1",48,0)
 S X1=$S($G(PSORENW("ISSUE DATE")):$G(PSORENW("ISSUE DATE")),1:DT),X2=DAYS*($P(PSORENW("RX0"),"^",9)+1)\1
"RTN","PSORENW1",49,0)
 S X2=$S(DAYS=X2&('DEA("CS")):X2,DEA("CS"):184,1:366) D C^%DTC
"RTN","PSORENW1",50,0)
 I PSORENW("FILL DATE")>$P(X,".") S PSEXDT=1_"^"_$P(X,".")
"RTN","PSORENW1",51,0)
 K X1,X2,X,%DT
"RTN","PSORENW1",52,0)
 Q
"RTN","PSORENW1",53,0)
OERR ;renewal finish from oe/rr
"RTN","PSORENW1",54,0)
 S PSORENW("RX0")=^PSRX(PSORENW("OIRXN"),0),PSORENW("RX2")=^(2),PSORENW("RX3")=^(3),PSORENW("STA")=^("STA"),PSORENW("TN")=$G(^("TN"))
"RTN","PSORENW1",55,0)
 S $P(PSORENW("RX0"),"^",4)=$P(OR0,"^",5)
"RTN","PSORENW1",56,0)
 S PSORENW("PROVIDER")=$P(OR0,"^",5)
"RTN","PSORENW1",57,0)
 S PSORX("PROVIDER NAME")=$P($G(^VA(200,PSORENW("PROVIDER"),0)),"^")
"RTN","PSORENW1",58,0)
 S $P(PSORENW("RX0"),"^",5)=$P(OR0,"^",13)
"RTN","PSORENW1",59,0)
 S PSORENW("CLINIC")=$P(OR0,"^",13)
"RTN","PSORENW1",60,0)
 S PSORENW("REMARKS")="RENEWED FROM RX # "_$P(PSORENW("RX0"),"^")_"."_$S($P(OR0,"^",17)="C":" Administered in Clinic.",1:"")
"RTN","PSORENW1",61,0)
 S PSORENW("SIG")=$P($G(^PSRX(PSORENW("OIRXN"),"SIG")),"^"),SIGOK=$P(^("SIG"),"^",2) I SIGOK D
"RTN","PSORENW1",62,0)
 .F I=0:0 S I=$O(^PSRX(PSORENW("OIRXN"),"SIG1",I)) Q:'I  S SIG(I)=^PSRX(PSORENW("OIRXN"),"SIG1",I,0)
"RTN","PSORENW1",63,0)
 S:$P(PSORENW("RX3"),"^",3) PSORENW("COSIGNING PROVIDER")=$P(PSORENW("RX3"),"^",3)
"RTN","PSORENW1",64,0)
 S PSORENW("PSODFN")=$P(PSORENW("RX0"),"^",2)
"RTN","PSORENW1",65,0)
 S PSORENW("ORX #")=$P(PSORENW("RX0"),"^")
"RTN","PSORENW1",66,0)
 S PSORENW("DRUG IEN")=$P(PSORENW("RX0"),"^",6),$P(PSORENW("RX0"),"^",11)=$P(OR0,"^",17)
"RTN","PSORENW1",67,0)
 S PSORENW("INS")=$S($G(PSORENW("INS"))]"":PSORENW("INS"),1:$G(^PSRX(PSORENW("OIRXN"),"INS")))
"RTN","PSORENW1",68,0)
 Q:$G(PSORENW("ENT"))>0
"RTN","PSORENW1",69,0)
 F I=0:0 S I=$O(^PSRX(PSORENW("OIRXN"),6,I)) Q:'I  S DOSE=^PSRX(PSORENW("OIRXN"),6,I,0) D
"RTN","PSORENW1",70,0)
 .S PSORENW("ENT")=PSORENW("ENT")+1,PSORENW("DOSE",PSORENW("ENT"))=$P(DOSE,"^")
"RTN","PSORENW1",71,0)
 .S PSORENW("UNITS",PSORENW("ENT"))=$P(DOSE,"^",3),PSORENW("DOSE ORDERED",PSORENW("ENT"))=$P(DOSE,"^",2),PSORENW("ROUTE",PSORENW("ENT"))=$P(DOSE,"^",7)
"RTN","PSORENW1",72,0)
 .S PSORENW("SCHEDULE",PSORENW("ENT"))=$P(DOSE,"^",8),PSORENW("DURATION",PSORENW("ENT"))=$P(DOSE,"^",5),PSORENW("CONJUNCTION",PSORENW("ENT"))=$P(DOSE,"^",6)
"RTN","PSORENW1",73,0)
 .S PSORENW("NOUN",PSORENW("ENT"))=$P(DOSE,"^",4),PSORENW("VERB",PSORENW("ENT"))=$P(DOSE,"^",9)
"RTN","PSORENW1",74,0)
 .I $G(^PSRX(PSORENW("OIRXN"),6,I,1))]"" S PSORENW("ODOSE",PSORENW("ENT"))=^PSRX(PSORENW("OIRXN"),6,I,1)
"RTN","PSORENW1",75,0)
 .K DOSE
"RTN","PSORENW1",76,0)
 Q
"RTN","PSORENW1",77,0)
 ;
"RTN","PSORENW1",78,0)
SETIB ;Set defaults on Renewals with Copay information
"RTN","PSORENW1",79,0)
 ;If answer is in Pending File, use that, else look in Prescription file
"RTN","PSORENW1",80,0)
 N PSOOICD,JJJ
"RTN","PSORENW1",81,0)
 K PSOSCP,PSOANSQ("SC>50") D SCP^PSORN52D S PSOANSQ("SC>50")="" K PSOSCA
"RTN","PSORENW1",82,0)
 I '$G(PSOIBOLD) Q
"RTN","PSORENW1",83,0)
 I $G(PSOFDR),$G(ORD) D SETIBP Q
"RTN","PSORENW1",84,0)
 ;I '$$DT^PSOMLLDT Q
"RTN","PSORENW1",85,0)
 I $G(PSORX(PSOIBOLD,"SC"))'=0,$G(PSORX(PSOIBOLD,"SC"))'=1 S PSORX(PSOIBOLD,"SC")=$S($P($G(^PSRX(PSOIBOLD,"IBQ")),"^")'="":$P($G(^("IBQ")),"^"),$P($G(^PSRX(PSOIBOLD,"IB")),"^"):0,1:"")
"RTN","PSORENW1",86,0)
 I $G(PSORX(PSOIBOLD,"SC"))="" K PSORX(PSOIBOLD,"SC")
"RTN","PSORENW1",87,0)
 I '$$DT^PSOMLLDT Q
"RTN","PSORENW1",88,0)
 I $G(PSORX(PSOIBOLD,"MST"))'=0,$G(PSORX(PSOIBOLD,"MST"))'=1,$P($G(^PSRX(PSOIBOLD,"IBQ")),"^",2)'="" S PSORX(PSOIBOLD,"MST")=$P($G(^("IBQ")),"^",2)
"RTN","PSORENW1",89,0)
 I $G(PSORX(PSOIBOLD,"VEH"))'=0,$G(PSORX(PSOIBOLD,"VEH"))'=1,$P($G(^PSRX(PSOIBOLD,"IBQ")),"^",3)'="" S PSORX(PSOIBOLD,"VEH")=$P($G(^("IBQ")),"^",3)
"RTN","PSORENW1",90,0)
 I $G(PSORX(PSOIBOLD,"RAD"))'=0,$G(PSORX(PSOIBOLD,"RAD"))'=1,$P($G(^PSRX(PSOIBOLD,"IBQ")),"^",4)'="" S PSORX(PSOIBOLD,"RAD")=$P($G(^("IBQ")),"^",4)
"RTN","PSORENW1",91,0)
 I $G(PSORX(PSOIBOLD,"PGW"))'=0,$G(PSORX(PSOIBOLD,"PGW"))'=1,$P($G(^PSRX(PSOIBOLD,"IBQ")),"^",5)'="" S PSORX(PSOIBOLD,"PGW")=$P($G(^("IBQ")),"^",5)
"RTN","PSORENW1",92,0)
 I $G(PSORX(PSOIBOLD,"HNC"))'=0,$G(PSORX(PSOIBOLD,"HNC"))'=1,$P($G(^PSRX(PSOIBOLD,"IBQ")),"^",6)'="" S PSORX(PSOIBOLD,"HNC")=$P($G(^("IBQ")),"^",6)
"RTN","PSORENW1",93,0)
 I $G(PSORX(PSOIBOLD,"CV"))'=0,$G(PSORX(PSOIBOLD,"CV"))'=1,$P($G(^PSRX(PSOIBOLD,"IBQ")),"^",7)'="" S PSORX(PSOIBOLD,"CV")=$P($G(^("IBQ")),"^",7)
"RTN","PSORENW1",94,0)
 I $G(PSORX(PSOIBOLD,"SHAD"))'=0,$G(PSORX(PSOIBOLD,"SHAD"))'=1,$P($G(^PSRX(PSOIBOLD,"IBQ")),"^",8)'="" S PSORX(PSOIBOLD,"SHAD")=$P($G(^("IBQ")),"^",8)
"RTN","PSORENW1",95,0)
 ;
"RTN","PSORENW1",96,0)
SET2 ;for when patient status is exempt or SC>50
"RTN","PSORENW1",97,0)
 I $TR($G(^PSRX(PSOIBOLD,"IBQ")),"^")="" S PSOOICD=$G(^PSRX(PSOIBOLD,"ICD",1,0)) D SET3:PSOOICD'=""
"RTN","PSORENW1",98,0)
 ;
"RTN","PSORENW1",99,0)
ICD I $D(^PSRX(PSORENW("OIRXN"),"ICD",0)) D
"RTN","PSORENW1",100,0)
 . N JJ,ICD,II,FLD,RXN S RXN=PSOIBOLD
"RTN","PSORENW1",101,0)
 . S II=0 F  S II=$O(^PSRX(PSORENW("OIRXN"),"ICD",II)) Q:II=""!(II'?1N.N)  D
"RTN","PSORENW1",102,0)
 .. S ICD=^PSRX(PSORENW("OIRXN"),"ICD",II,0),FLD=$P(ICD,U) D ICD^PSONEWF
"RTN","PSORENW1",103,0)
 Q
"RTN","PSORENW1",104,0)
SET3 ;for when patient status is exempt or SC>50
"RTN","PSORENW1",105,0)
 D SET3^PSORN52D
"RTN","PSORENW1",106,0)
 Q
"RTN","PSORENW1",107,0)
 ;
"RTN","PSORENW1",108,0)
SETIBP ;
"RTN","PSORENW1",109,0)
 I $P($G(^PS(52.41,ORD,0)),"^",16)="SC"!($P($G(^(0)),"^",16)="NSC") S PSORX(PSOIBOLD,"SC")=$S($P($G(^(0)),"^",16)="SC":1,1:0)
"RTN","PSORENW1",110,0)
 I $G(PSORX(PSOIBOLD,"SC"))="" K PSORX(PSOIBOLD,"SC")
"RTN","PSORENW1",111,0)
 I '$$DT^PSOMLLDT Q
"RTN","PSORENW1",112,0)
 N PSOIBQFN S PSOIBQFN=$G(^PS(52.41,ORD,"IBQ"))
"RTN","PSORENW1",113,0)
 I $P(PSOIBQFN,"^",1)=0!($P(PSOIBQFN,"^",1)=1) S PSORX(PSOIBOLD,"MST")=$P(PSOIBQFN,"^")
"RTN","PSORENW1",114,0)
 I $P(PSOIBQFN,"^",2)=0!($P(PSOIBQFN,"^",2)=1) S PSORX(PSOIBOLD,"VEH")=$P(PSOIBQFN,"^",2)
"RTN","PSORENW1",115,0)
 I $P(PSOIBQFN,"^",3)=0!($P(PSOIBQFN,"^",3)=1) S PSORX(PSOIBOLD,"RAD")=$P(PSOIBQFN,"^",3)
"RTN","PSORENW1",116,0)
 I $P(PSOIBQFN,"^",4)=0!($P(PSOIBQFN,"^",4)=1) S PSORX(PSOIBOLD,"PGW")=$P(PSOIBQFN,"^",4)
"RTN","PSORENW1",117,0)
 I $P(PSOIBQFN,"^",5)=0!($P(PSOIBQFN,"^",5)=1) S PSORX(PSOIBOLD,"HNC")=$P(PSOIBQFN,"^",5)
"RTN","PSORENW1",118,0)
 I $P(PSOIBQFN,"^",6)=0!($P(PSOIBQFN,"^",6)=1) S PSORX(PSOIBOLD,"CV")=$P(PSOIBQFN,"^",6)
"RTN","PSORENW1",119,0)
 I $P(PSOIBQFN,"^",7)=0!($P(PSOIBQFN,"^",7)=1) S PSORX(PSOIBOLD,"SHAD")=$P(PSOIBQFN,"^",7)
"RTN","PSORENW1",120,0)
 ;for when patient status is exempt, null IBQ node was set for exempts or SC>50 - data is in ICD node
"RTN","PSORENW1",121,0)
 I $TR($G(^PS(52.41,ORD,"IBQ")),"^")="" S PSOOICD=$G(^PS(52.41,ORD,"ICD",1,0)) D SET3:PSOOICD'=""
"RTN","PSORENW1",122,0)
 ;
"RTN","PSORENW1",123,0)
ICD2 ;
"RTN","PSORENW1",124,0)
 I $D(^PS(52.41,ORD,"ICD",0)) D
"RTN","PSORENW1",125,0)
 . N JJ,ICD,II,FLD,RXN S RXN=ORD
"RTN","PSORENW1",126,0)
 . S II=0 F  S II=$O(^PS(52.41,ORD,"ICD",II)) Q:II=""!(II'?1N.N)  D
"RTN","PSORENW1",127,0)
 .. S ICD="",ICD=^PS(52.41,ORD,"ICD",II,0)
"RTN","PSORENW1",128,0)
 .. I $G(PSOSCP)>49&(II=1) S PSORX(PSOIBOLD,"SC>50")=$P(ICD,"^",4)
"RTN","PSORENW1",129,0)
 .. S JJ="" F JJ=1:1:9 S FLD=$P(ICD,U,JJ) D ICD^PSONEWF
"RTN","PSORENW1",130,0)
 K PSOIBQFN
"RTN","PSORENW1",131,0)
 Q
"RTN","PSORENW1",132,0)
KLIB ;Kill renewal IB array
"RTN","PSORENW1",133,0)
 I '$G(PSOIBOLD) Q
"RTN","PSORENW1",134,0)
 K PSORX(PSOIBOLD,"SC"),PSORX(PSOIBOLD,"MST"),PSORX(PSOIBOLD,"VEH"),PSORX(PSOIBOLD,"RAD"),PSORX(PSOIBOLD,"PGW"),PSORX(PSOIBOLD,"HNC"),PSORX(PSOIBOLD,"CV"),PSORX(PSOIBOLD,"SHAD")
"RTN","PSORENW1",135,0)
 K PSOIBOLD
"RTN","PSORENW1",136,0)
 Q
"RTN","PSORENW4")
0^67^B56219403
"RTN","PSORENW4",1,0)
PSORENW4 ;BIR/SAB - rx speed renew ;03/06/95
"RTN","PSORENW4",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,23,27,32,37,64,46,75,71,100,130,117,152,148,264,225**;DEC 1997;Build 29
"RTN","PSORENW4",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSORENW4",4,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSORENW4",5,0)
 ;External references L, UL, PSOL, and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSORENW4",6,0)
 ;External reference to LK^ORX2 and ULK^ORX2 supported by DBIA 867
"RTN","PSORENW4",7,0)
SEL I $P(PSOPAR,"^",4)=0 S VALMSG="Renewing is NOT Allowed. Check Site Parameters!",VALMBCK="" Q
"RTN","PSORENW4",8,0)
 N VALMCNT I '$G(PSOCNT) S VALMSG="This patient has no Prescriptions!",VALMBCK="" Q
"RTN","PSORENW4",9,0)
 S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient.") K PSOPLCK S VALMBCK="" Q
"RTN","PSORENW4",10,0)
 K PSOPLCK S X=PSODFN_";DPT(" D LK^ORX2 I 'Y S VALMSG="Another person is entering orders for this patient.",VALMBCK="" D UL^PSSLOCK(PSODFN) Q
"RTN","PSORENW4",11,0)
 K PRC,PHI,PSORX("EDIT"),PSOFDR,DIR,DUOUT,DIRUT,PSORNSPD S DIR("A")="Select Orders by number",DIR(0)="LO^1:"_PSOCNT D ^DIR I $D(DTOUT)!($D(DUOUT)) K DIR,DIRUT,DTOUT,DUOUT S VALMBCK="" G SELQ
"RTN","PSORENW4",12,0)
 K DIR,DIRUT,DTOUT,PSOOELSE,DTOUT I +Y S (SPEED,PSOOELSE,PSORNSPD)=1 D FULL^VALM1 S LST=Y D
"RTN","PSORENW4",13,0)
 .S (PSODIR("DFLG"),PSODIR("FIELD"))=0,PSOOPT=3,(PSORENW("DFLG"),PSORENW("QFLG"),PSORX("DFLG"))=0 D INIT Q:PSORENW("DFLG")
"RTN","PSORENW4",14,0)
 .F ORD=1:1:$L(LST,",") Q:$P(LST,",",ORD)']""  S ORN=$P(LST,",",ORD) D:+PSOLST(ORN)=52 PROCESS S PSORENW("DFLG")=0
"RTN","PSORENW4",15,0)
 I '$G(PSOOELSE) S VALMBCK="" G SELQ
"RTN","PSORENW4",16,0)
 S VALMBCK="R"
"RTN","PSORENW4",17,0)
 D ^PSOBUILD,BLD^PSOORUT1 K DIR,DIRUT,DTOUT,DUOUT,LST,ORD,IEN,ORN,RPH,ST,REFL,REF,PSOACT,ORSV,PSORNW,PSORENW,PSONO,PSOCO,PSOCU,PSODIR,DSMSG,SPEED,PSORENW,PSOOELSE,PSOOPT,PSORX("FILL DATE"),PSORX("ISSUE DATE"),PSOID,PSOMSG,PSORX("DFLG"),PSOQTY
"RTN","PSORENW4",18,0)
SELQ K PSORNSPD,RTE,DRET,PRC,PHI S X=PSODFN_";DPT(" D ULK^ORX2,UL^PSSLOCK(PSODFN),CLEAN^PSOVER1
"RTN","PSORENW4",19,0)
 Q
"RTN","PSORENW4",20,0)
 ;
"RTN","PSORENW4",21,0)
PROCESS ; Process one order at a time
"RTN","PSORENW4",22,0)
 I $$LMREJ^PSOREJU1($P(PSOLST(ORN),"^",2)) W $C(7),!!,"Rx "_$$GET1^DIQ(52,$P(PSOLST(ORN),"^",2),.01)_" has OPEN/UNRESOLVED 3rd Party Payer Rejects!" K DIR,PSOMSG D PAUSE^VALM1 Q
"RTN","PSORENW4",23,0)
 D PSOL^PSSLOCK($P(PSOLST(ORN),"^",2)) I '$G(PSOMSG) W $C(7),!!,$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing Rx "_$P(^PSRX($P(PSOLST(ORN),"^",2),0),"^")),! K DIR,PSOMSG D PAUSE^VALM1 Q
"RTN","PSORENW4",24,0)
 K RET,DRET,PRC,PHI S PSORENW("OIRXN")=$P(PSOLST(ORN),"^",2),PSOFROM="NEW"
"RTN","PSORENW4",25,0)
 S PSORENW("RX0")=^PSRX(PSORENW("OIRXN"),0),PSORENW("RX2")=^(2),PSORENW("RX3")=^(3),PSORENW("STA")=^("STA"),PSORENW("TN")=$G(^("TN")),SIGOK=$P($G(^PSRX(PSORENW("OIRXN"),"SIG")),"^",2)
"RTN","PSORENW4",26,0)
 I SIGOK F I=0:0 S I=$O(^PSRX(PSORENW("OIRXN"),"SIG1",I)) Q:'I  S SIG(I)=^PSRX(PSORENW("OIRXN"),"SIG1",I,0)
"RTN","PSORENW4",27,0)
 S PSOIBOLD=$G(PSORENW("OIRXN")) D SETIB^PSORENW1
"RTN","PSORENW4",28,0)
 I '$G(PSORENW("PROVIDER")) D
"RTN","PSORENW4",29,0)
 .S PSORENW("PROVIDER")=$P(PSORENW("RX0"),"^",4)
"RTN","PSORENW4",30,0)
 .S:$P(PSORENW("RX3"),"^",3) PSORENW("COSIGNING PROVIDER")=$P(PSORENW("RX3"),"^",3)
"RTN","PSORENW4",31,0)
 S PSORX("PROVIDER NAME")=$P($G(^VA(200,PSORENW("PROVIDER"),0)),"^")
"RTN","PSORENW4",32,0)
 I '$G(PSORENW("CLINIC")) S PSORENW("CLINIC")=$P(PSORENW("RX0"),"^",5)
"RTN","PSORENW4",33,0)
 S PSORENW("REMARKS")="RENEWED FROM RX # "_$P(PSORENW("RX0"),"^")
"RTN","PSORENW4",34,0)
 S PSORENW("SIG")=$P($G(^PSRX(PSORENW("OIRXN"),"SIG")),"^")
"RTN","PSORENW4",35,0)
 S PSORENW("PSODFN")=$P(PSORENW("RX0"),"^",2)
"RTN","PSORENW4",36,0)
 S PSORENW("ORX #")=$P(PSORENW("RX0"),"^")
"RTN","PSORENW4",37,0)
 S PSORENW("DRUG IEN")=$P(PSORENW("RX0"),"^",6)
"RTN","PSORENW4",38,0)
 S PSORENW("QTY")=$P(PSORENW("RX0"),"^",7)
"RTN","PSORENW4",39,0)
 ;S PSORENW("DAYS SUPPLY")=$P(PSORENW("RX0"),"^",8)
"RTN","PSORENW4",40,0)
 ;S PSORENW("# OF REFILLS")=$P(PSORENW("RX0"),"^",9)
"RTN","PSORENW4",41,0)
 S PSORENW("INS")=$S($G(PSORENW("ENT"))]"":PSORENW("ENT"),1:$G(^PSRX(PSORENW("OIRXN"),"INS")))
"RTN","PSORENW4",42,0)
 S:$G(PSORENW("ENT"))']"" PSORENW("ENT")=0
"RTN","PSORENW4",43,0)
 F I=0:0 S I=$O(^PSRX(PSORENW("OIRXN"),6,I)) Q:'I  S DOSE=^PSRX(PSORENW("OIRXN"),6,I,0) D
"RTN","PSORENW4",44,0)
 .S PSORENW("ENT")=PSORENW("ENT")+1,PSORENW("DOSE",PSORENW("ENT"))=$P(DOSE,"^")
"RTN","PSORENW4",45,0)
 .S PSORENW("UNITS",PSORENW("ENT"))=$P(DOSE,"^",3),PSORENW("DOSE ORDERED",PSORENW("ENT"))=$P(DOSE,"^",2),PSORENW("ROUTE",PSORENW("ENT"))=$P(DOSE,"^",7)
"RTN","PSORENW4",46,0)
 .S PSORENW("SCHEDULE",PSORENW("ENT"))=$P(DOSE,"^",8),PSORENW("DURATION",PSORENW("ENT"))=$P(DOSE,"^",5),PSORENW("CONJUNCTION",PSORENW("ENT"))=$P(DOSE,"^",6)
"RTN","PSORENW4",47,0)
 .S PSORENW("NOUN",PSORENW("ENT"))=$P(DOSE,"^",4),PSORENW("VERB",PSORENW("ENT"))=$P(DOSE,"^",9)
"RTN","PSORENW4",48,0)
 .I $G(^PSRX(PSORENW("OIRXN"),6,I,1))]"" S PSORENW("ODOSE",PSORENW("ENT"))=^PSRX(PSORENW("OIRXN"),6,I,1)
"RTN","PSORENW4",49,0)
 .K DOSE
"RTN","PSORENW4",50,0)
 I $P($G(^PSDRUG(PSORENW("DRUG IEN"),"CLOZ1")),"^")="PSOCLO1" N PSON S PSON=0 D  I PSON K PSON D POZ,KLIB^PSORENW1 D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) Q
"RTN","PSORENW4",51,0)
 . I '$L($P(^VA(200,PSORENW("PROVIDER"),"PS"),"^",2)),'$L($P(^VA(200,PSORENW("PROVIDER"),"PS"),"^",3)) D  Q
"RTN","PSORENW4",52,0)
 . . S PSON=1 W $C(7),!!,"Only providers with DEA# or a VA# can write prescriptions for clozapine.",!
"RTN","PSORENW4",53,0)
 . I '$D(^XUSEC("YSCL AUTHORIZED",PSORENW("PROVIDER"))) D 
"RTN","PSORENW4",54,0)
 . . S PSON=1 W $C(7),!!,"Provider must hold YSCL AUTHORIZED key to write prescriptions for clozapine.",!
"RTN","PSORENW4",55,0)
 I $G(PSORNW("MAIL/WINDOW"))]"" S PSORENW("MAIL/WINDOW")=PSORNW("MAIL/WINDOW")
"RTN","PSORENW4",56,0)
 I $O(^PSRX(PSORENW("OIRXN"),"PI",0)) D  K T
"RTN","PSORENW4",57,0)
 .S PHI=^PSRX(PSORENW("OIRXN"),"PI",0),T=0
"RTN","PSORENW4",58,0)
 .F  S T=$O(^PSRX(PSORENW("OIRXN"),"PI",T)) Q:'T  S PHI(T)=^PSRX(PSORENW("OIRXN"),"PI",T,0)
"RTN","PSORENW4",59,0)
 ;I $O(^PSRX(PSORENW("OIRXN"),"PRC",0)) D  K T
"RTN","PSORENW4",60,0)
 ;.S PRC=^PSRX(PSORENW("OIRXN"),"PRC",0),T=0
"RTN","PSORENW4",61,0)
 ;.F  S T=$O(^PSRX(PSORENW("OIRXN"),"PRC",T)) Q:'T  S PRC(T)=^PSRX(PSORENW("OIRXN"),"PRC",T,0)
"RTN","PSORENW4",62,0)
 W !!,"Now Renewing Rx # "_PSORENW("ORX #")_"   Drug: "_$P($G(^PSDRUG(+$G(PSORENW("DRUG IEN")),0)),"^"),!
"RTN","PSORENW4",63,0)
 I '$P($G(^PSDRUG($P(PSORENW("RX0"),"^",6),2)),"^") D  G:$G(PSORENW("DFLG")) PROCESSX
"RTN","PSORENW4",64,0)
 .I $P($G(^PSRX(PSORENW("OIRXN"),"OR1")),"^") S PSODRUG("OI")=$P(^PSRX(PSORENW("OIRXN"),"OR1"),"^"),PSODRUG("OIN")=$P(^PS(50.7,+^("OR1"),0),"^") Q
"RTN","PSORENW4",65,0)
 .W !!,"Cannot Renew!!  No Pharmacy Orderable Item!" S VALMSG="Cannot Renew!!  No Pharmacy Orderable Item!",PSORX("DFLG")=1
"RTN","PSORENW4",66,0)
 D CHECK^PSORENW0 G:PSORENW("DFLG") PROCESSX
"RTN","PSORENW4",67,0)
 D FILDATE^PSORENW0
"RTN","PSORENW4",68,0)
 D DRUG^PSORENW0 G:PSORENW("DFLG") PROCESSX
"RTN","PSORENW4",69,0)
 D RXN^PSORENW0 G:PSORENW("DFLG") PROCESSX
"RTN","PSORENW4",70,0)
 D STOP^PSORENW1
"RTN","PSORENW4",71,0)
DSPL K PSOEDT,PSOLM S PSDY=PSORENW("DAYS SUPPLY"),PSRF=PSORENW("# OF REFILLS")
"RTN","PSORENW4",72,0)
 F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S PSODIR("CS")=1
"RTN","PSORENW4",73,0)
 I $G(PSODIR("CS")) D
"RTN","PSORENW4",74,0)
 .S PSORENW("# OF REFILLS")=$S(PSDY<60:5,PSDY'<60&(PSDY'>89):2,PSDY=90:1,1:0)
"RTN","PSORENW4",75,0)
 .I PSORENW("# OF REFILLS")>PSRF S PSORENW("# OF REFILLS")=PSRF
"RTN","PSORENW4",76,0)
 D DSPLY^PSORENW3 G:PSORENW("DFLG") PROCESSX
"RTN","PSORENW4",77,0)
 D:$D(^XUSEC("PSORPH",DUZ))!('$P(PSOPAR,"^",2)) VER1^PSOORNE4(.PSORENW) G:PSORENW("DFLG")=1 PROCESSX
"RTN","PSORENW4",78,0)
 I $G(PSOQTY) D QTY^PSODIR1(.PSORENW) G:PSORENW("DFLG")=1 PROCESSX
"RTN","PSORENW4",79,0)
 D EN^PSORN52(.PSORENW)
"RTN","PSORENW4",80,0)
 D RNPSOSD^PSOUTIL
"RTN","PSORENW4",81,0)
 D CAN^PSORENW0,DCORD^PSONEW2
"RTN","PSORENW4",82,0)
 S PSORENW("# OF REFILLS")=PSRF K PSDY,PSRF,PSODIR("CS"),DEA,PSORENW("ENT")
"RTN","PSORENW4",83,0)
 S BBRN="",BBRN1=$O(^PSRX("B",PSORENW("NRX #"),BBRN)) I $P($G(^PSRX(BBRN1,0)),"^",11)["W" S BINGCRT="Y",BINGRTE="W",BBFLG=1,BBRX(1)=$G(BBRX(1))_BBRN1_","
"RTN","PSORENW4",84,0)
PROCESSX I PSORENW("DFLG") D  W:'$G(POERR) !,$C(7),"Rx NOT RENEWED. RENEWED RX DELETED",! S POERR("DFLG")=1 D CLEAN^PSOVER1
"RTN","PSORENW4",85,0)
 .K PHI,PRC,PSODRUG,SIG,PSORXED,SIGOK
"RTN","PSORENW4",86,0)
 .K PSORENW("DOSE"),PSORENW("DURATION"),PSORENW("DRUG IEN"),PSORENW("ENT"),PSORENW("INS"),PSORENW("NOUN"),PSORENW("ROUTE"),PSORENW("SCHEDULE"),PSORENW("SIG"),PSORENW("VERB"),PSORENW("UNITS")
"RTN","PSORENW4",87,0)
 .D POZ
"RTN","PSORENW4",88,0)
 K PSORDLOK I PSORENW("DFLG") S PSORDLOK=1
"RTN","PSORENW4",89,0)
 D:$G(PSORENW("OLD FILL DATE"))]"" SUSDATEK^PSOUTIL(.PSORENW)
"RTN","PSORENW4",90,0)
 K BBRN,BBRN1,PSODRUG,PSORX("PROVIDER NAME"),PSORX("CLINIC")
"RTN","PSORENW4",91,0)
 K PSOEDT,PSOLM S:$G(PSORENW("FROM"))="" (PSORENW("DFLG"),PSORENW("QFLG"))=0
"RTN","PSORENW4",92,0)
 I $G(PSORDLOK) D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2))
"RTN","PSORENW4",93,0)
 D KLIB^PSORENW1
"RTN","PSORENW4",94,0)
 K PSORDLOK
"RTN","PSORENW4",95,0)
 S RXN=$O(^TMP("PSORXN",$J,0)) I RXN D
"RTN","PSORENW4",96,0)
 .S RXN1=^TMP("PSORXN",$J,RXN) D EN^PSOHLSN1(RXN,$P(RXN1,"^"),$P(RXN1,"^",2),"",$P(RXN1,"^",3))
"RTN","PSORENW4",97,0)
 .I $P(^PSRX(RXN,"STA"),"^")=5 D EN^PSOHLSN1(RXN,"SC","ZS",$P(RXN1,"^",4))
"RTN","PSORENW4",98,0)
 K RXN,RXN1,^TMP("PSORXN",$J)
"RTN","PSORENW4",99,0)
 Q
"RTN","PSORENW4",100,0)
INIT ;
"RTN","PSORENW4",101,0)
 D ASK Q:PSORENW("DFLG")
"RTN","PSORENW4",102,0)
 D NOORE^PSONEW(.PSORENW) Q:PSORENW("DFLG")
"RTN","PSORENW4",103,0)
 Q
"RTN","PSORENW4",104,0)
ASK ;upfront questions
"RTN","PSORENW4",105,0)
 W !! D ISSDT^PSODIR2(.PSORENW) Q:PSORENW("DFLG")  S PSORENW("ISSUE DATE")=PSOID
"RTN","PSORENW4",106,0)
 D FILLDT^PSODIR2(.PSORENW) K PSONEW("DAYS SUPPLY"),PSONEW("# OF REFILLS") Q:PSORENW("DFLG")
"RTN","PSORENW4",107,0)
 S PSORNW("FILL DATE")=PSORENW("FILL DATE")
"RTN","PSORENW4",108,0)
 D MW^PSODIR2(.PSORENW) Q:PSORENW("DFLG")
"RTN","PSORENW4",109,0)
 D PTSTAT^PSODIR1(.PSORENW) Q:PSORENW("DFLG")
"RTN","PSORENW4",110,0)
 D DAYS^PSODIR1(.PSORENW) Q:PSORENW("DFLG")
"RTN","PSORENW4",111,0)
 S PSODRUG("DEA")=0 D REFILL^PSODIR1(.PSORENW) K PSODRUG("DEA") Q:PSORENW("DFLG")
"RTN","PSORENW4",112,0)
 K DIR,DIRUT S DIR(0)="Y",DIR("B")="No",DIR("A")="Do you want to edit Renewed Rx(s) QTY " D ^DIR I $D(DIRUT) S PSORENW("DFLG")=1 K DIR,DIRUT Q
"RTN","PSORENW4",113,0)
 S PSOQTY=Y K DIR,DIRUT
"RTN","PSORENW4",114,0)
 D CLINIC^PSODIR2(.PSORENW) Q:PSORENW("DFLG")
"RTN","PSORENW4",115,0)
 D PROV^PSODIR(.PSORENW) S:PSORENW("DFLG") PSORENW("DFLG")=0
"RTN","PSORENW4",116,0)
 Q
"RTN","PSORENW4",117,0)
 ;
"RTN","PSORENW4",118,0)
POZ ;
"RTN","PSORENW4",119,0)
 K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR,DIRUT,DTOUT
"RTN","PSORENW4",120,0)
 Q
"RTN","PSORN52")
0^16^B46207711
"RTN","PSORN52",1,0)
PSORN52 ;BIR/DSD - files renewal entries in prescription file ;08/09/93
"RTN","PSORN52",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,11,27,37,46,79,71,100,117,157,143,219,148,239,201,225**;DEC 1997;Build 29
"RTN","PSORN52",3,0)
 ;Ext ref to ^PS(55 sup by DBIA 2228
"RTN","PSORN52",4,0)
 ;Ext ref to PSOUL^PSSLOCK sup by DBIA 2789
"RTN","PSORN52",5,0)
 ;Ext ref to ^VA(200 sup by DBIA 10060
"RTN","PSORN52",6,0)
 ;Ext ref to SWSTAT^IBBAPI sup by DBIA 4663
"RTN","PSORN52",7,0)
EN(PSOX) ;EP
"RTN","PSORN52",8,0)
START ;
"RTN","PSORN52",9,0)
 D:$D(XRTL) T0^%ZOSV ; Start RT Mon
"RTN","PSORN52",10,0)
 N PSOIBHLD,PSOSCOTH,PSOSCOTX S (PSOSCOTH,PSOSCOTX)=0 S PSOIBHLD="" I $G(PSOFDR),$G(ORD) D
"RTN","PSORN52",11,0)
 .S PSOIBHLD=$S($P($G(^PS(52.41,ORD,0)),"^",16)="SC":1,$P($G(^(0)),"^",16)="NSC":0,1:"")
"RTN","PSORN52",12,0)
 .I '$$DT^PSOMLLDT Q
"RTN","PSORN52",13,0)
 .N PSOIBHLX S PSOIBHLX=$G(^PS(52.41,ORD,"IBQ"))
"RTN","PSORN52",14,0)
 .S PSOIBHLD=PSOIBHLD_"^"_$S($P(PSOIBHLX,"^")=1:1,$P(PSOIBHLX,"^")=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",2)=1:1,$P(PSOIBHLX,"^",2)=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",3)=1:1,$P(PSOIBHLX,"^",3)=0:0,1:"")
"RTN","PSORN52",15,0)
 .S PSOIBHLD=PSOIBHLD_"^"_$S($P(PSOIBHLX,"^",4)=1:1,$P(PSOIBHLX,"^",4)=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",5)=1:1,$P(PSOIBHLX,"^",5)=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",6)=1:1,$P(PSOIBHLX,"^",6)=0:0,1:"")
"RTN","PSORN52",16,0)
 .S PSOIBHLD=PSOIBHLD_"^"_$S($P(PSOIBHLX,"^",7)=1:1,$P(PSOIBHLX,"^",7)=0:0,1:"")
"RTN","PSORN52",17,0)
 .I $P(PSOIBHLX,"^")=1!($P(PSOIBHLX,"^",2)=1)!($P(PSOIBHLX,"^",3)=1)!($P(PSOIBHLX,"^",4)=1)!($P(PSOIBHLX,"^",5)=1)!($P(PSOIBHLX,"^",6)=1)!($P(PSOIBHLX,"^",7)=1) S PSOSCOTH=1
"RTN","PSORN52",18,0)
 I $G(PSOSCOTH)!($G(PSORX("SC"))="SC")!($G(PSORX("SC"))="NSC") S PSOSCOTX=1
"RTN","PSORN52",19,0)
 S PSOANSQ("SC>50")="" D SCP^PSORN52D
"RTN","PSORN52",20,0)
 I $G(PSOFDR),$G(ORD) I $D(^PS(52.41,ORD,"ICD")) S FILE=52.41 D GET^PSORN52D
"RTN","PSORN52",21,0)
 ;Set ans to renew from Rx, only if no ans from Pend file
"RTN","PSORN52",22,0)
 I $G(PSORENW("OIRXN")) D
"RTN","PSORN52",23,0)
 .N PSOLDIBQ S PSOLDIBQ=$G(^PSRX(PSORENW("OIRXN"),"IBQ"))
"RTN","PSORN52",24,0)
 .I $P(PSOIBHLD,"^")="" D
"RTN","PSORN52",25,0)
 ..I $P($G(^PSRX(PSORENW("OIRXN"),"IB")),"^")=2 S $P(PSOIBHLD,"^")=0
"RTN","PSORN52",26,0)
 .I '$$DT^PSOMLLDT Q
"RTN","PSORN52",27,0)
 .I PSOLDIBQ="" Q
"RTN","PSORN52",28,0)
 .D IBHLD^PSORN52A
"RTN","PSORN52",29,0)
 D INIT G:PSORN52("QFLG") END D FILE^PSORN52A
"RTN","PSORN52",30,0)
 S:$D(XRT0) XRTN=$T(+0) D:$D(XRT0) T1^%ZOSV ; Stop RT Mon
"RTN","PSORN52",31,0)
 K PSOANSQ,PSOANSQD,PSONEWFF
"RTN","PSORN52",32,0)
 I $G(PSOIBHLD)'="" D
"RTN","PSORN52",33,0)
 .;Set answers based on Pend Renew, prior to Phar call
"RTN","PSORN52",34,0)
 .Q:'$G(PSOX("IRXN"))
"RTN","PSORN52",35,0)
 .I $P(PSOIBHLD,"^")=1!($P(PSOIBHLD,"^")=0) S PSOANSQ("SC")=$P(PSOIBHLD,"^")
"RTN","PSORN52",36,0)
 .I '$$DT^PSOMLLDT Q
"RTN","PSORN52",37,0)
 .I $P(PSOIBHLD,"^",2)=1!($P(PSOIBHLD,"^",2)=0) S PSOANSQ(PSOX("IRXN"),"MST")=$P(PSOIBHLD,"^",2)
"RTN","PSORN52",38,0)
 .I $P(PSOIBHLD,"^",3)=1!($P(PSOIBHLD,"^",3)=0) S PSOANSQ(PSOX("IRXN"),"VEH")=$P(PSOIBHLD,"^",3)
"RTN","PSORN52",39,0)
 .I $P(PSOIBHLD,"^",4)=1!($P(PSOIBHLD,"^",4)=0) S PSOANSQ(PSOX("IRXN"),"RAD")=$P(PSOIBHLD,"^",4)
"RTN","PSORN52",40,0)
 .I $P(PSOIBHLD,"^",5)=1!($P(PSOIBHLD,"^",5)=0) S PSOANSQ(PSOX("IRXN"),"PGW")=$P(PSOIBHLD,"^",5)
"RTN","PSORN52",41,0)
 .I $P(PSOIBHLD,"^",6)=1!($P(PSOIBHLD,"^",6)=0) S PSOANSQ(PSOX("IRXN"),"HNC")=$P(PSOIBHLD,"^",6)
"RTN","PSORN52",42,0)
 .I $P(PSOIBHLD,"^",7)=1!($P(PSOIBHLD,"^",7)=0) S PSOANSQ(PSOX("IRXN"),"CV")=$P(PSOIBHLD,"^",7)
"RTN","PSORN52",43,0)
 .I $P(PSOIBHLD,"^",8)=1!($P(PSOIBHLD,"^",8)=0) S PSOANSQ(PSOX("IRXN"),"SHAD")=$P(PSOIBHLD,"^",8)
"RTN","PSORN52",44,0)
 K PSOIBHLD
"RTN","PSORN52",45,0)
 I '$G(PSOFDR) I $G(PSORENW("OIRXN")) S FILE=52 D GET^PSORN52D
"RTN","PSORN52",46,0)
 S PSONEW("NEWCOPAY")=""
"RTN","PSORN52",47,0)
 I (PSOSCP<50&('$P($G(^PS(53,+$P(^PSRX(PSOX("IRXN"),0),"^",3),0)),"^",7))),$G(DUZ("AG"))="V" S PSOFLAG=0 D COPAY^PSOCPB
"RTN","PSORN52",48,0)
 ;I PSOSCP>49!($P($G(^PS(53,+$P(^PSRX(PSOX("IRXN"),0),"^",3),0)),"^",7)=1) S PSOFLAG=0 D SC^PSOMLLD2
"RTN","PSORN52",49,0)
 I PSOSCA&(PSOSCP>49)!((PSOSCA!(PSOBILL=2))&($P($G(^PS(53,+$P(^PSRX(PSOX("IRXN"),0),"^",3),0)),"^",7)=1)) S PSOFLAG=0 D SC^PSOMLLD2
"RTN","PSORN52",50,0)
 I $$DT^PSOMLLDT D
"RTN","PSORN52",51,0)
 .I $D(PSOIBQS(PSODFN,"CV")) D MESS D CV^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"CV")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",52,0)
 .I $D(PSOIBQS(PSODFN,"VEH")) D MESS D VEH^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"VEH")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",53,0)
 .I $D(PSOIBQS(PSODFN,"RAD")) D MESS D RAD^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"RAD")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",54,0)
 .I $D(PSOIBQS(PSODFN,"PGW")) D MESS D PGW^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"PGW")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",55,0)
 .I $D(PSOIBQS(PSODFN,"SHAD")) D MESS D SHAD^PSOMLLD2 I $G(PSOANSQ(PSOX("IRXN"),"SHAD")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",56,0)
 .I $D(PSOIBQS(PSODFN,"MST")) D MESS D MST^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"MST")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",57,0)
 .I $D(PSOIBQS(PSODFN,"HNC")) D MESS D HNC^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"HNC")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",58,0)
 K PSOSCOTH,PSOSCOTX
"RTN","PSORN52",59,0)
 I $G(PSONEW("NEWCOPAY")) S ^PSRX(PSOX("IRXN"),"IB")=PSONEW("NEWCOPAY")
"RTN","PSORN52",60,0)
 ;
"RTN","PSORN52",61,0)
 D FINISH,ACP^PSOUTIL
"RTN","PSORN52",62,0)
 ;
"RTN","PSORN52",63,0)
 N PSOSCFLD S PSOSCFLD=$S(PSOSCP'="":$G(PSOANSQ("SC")),1:"")_"^"_$G(PSOANSQ(PSOX("IRXN"),"MST"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"VEH"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"RAD"))
"RTN","PSORN52",64,0)
 S PSOSCFLD=PSOSCFLD_"^"_$G(PSOANSQ(PSOX("IRXN"),"PGW"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"HNC"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"CV"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"SHAD"))
"RTN","PSORN52",65,0)
 I PSOSCP<50&($TR(PSOSCFLD,"^")'="")&('$P($G(^PS(53,+$P(^PSRX(PSOX("IRXN"),0),"^",3),0)),"^",7)) S ^PSRX(PSOX("IRXN"),"IBQ")=PSOSCFLD K PSOSCFLD
"RTN","PSORN52",66,0)
 ;
"RTN","PSORN52",67,0)
 D FILE2^PSORN52D
"RTN","PSORN52",68,0)
 D:$$SWSTAT^IBBAPI() GACT^PSOPFSU0(PSOX("IRXN"),0)
"RTN","PSORN52",69,0)
 K PSONEW("NEWCOPAY"),PSOANSQ
"RTN","PSORN52",70,0)
END D EOJ
"RTN","PSORN52",71,0)
 Q
"RTN","PSORN52",72,0)
INIT S PSORN52("QFLG")=0 S:'$D(PSOX("DAYS SUPPLY")) PSOX("DAYS SUPPLY")=$P(PSOX("RX0"),"^",8)
"RTN","PSORN52",73,0)
 S:'$D(PSOX("# OF REFILLS")) PSOX("# OF REFILLS")=$P(PSOX("RX0"),"^",9) S:'$D(PSOX("ISSUE DATE")) PSOX("ISSUE DATE")=DT
"RTN","PSORN52",74,0)
 D INIT^PSON52 K PSON52
"RTN","PSORN52",75,0)
 Q
"RTN","PSORN52",76,0)
 ;
"RTN","PSORN52",77,0)
FINISH ;
"RTN","PSORN52",78,0)
 G:PSOX("STATUS")=4 FINISHP
"RTN","PSORN52",79,0)
 I $D(PSORX("VERIFY")) D  G FINISHX
"RTN","PSORN52",80,0)
 .K DIC,DLAYGO,DINUM,DIADD,X,DD,DO S DIC="^PS(52.4,",DLAYGO=52.4,DINUM=PSOX("IRXN"),DIC(0)="ML"
"RTN","PSORN52",81,0)
 .S X=PSOX("IRXN") D FILE^DICN K DD,DO,DIC,DLAYGO,DINUM,X
"RTN","PSORN52",82,0)
 .S ^PS(52.4,PSOX("IRXN"),0)=PSOX("IRXN")_"^"_$P(PSOX("NRX0"),"^",2)_"^"_DUZ_"^"_$G(PSOX("OIRXN"))_"^"_$E(PSOX("LOGIN DATE"),1,7)_"^"_PSOX("IRXN")_"^"_PSOX("STOP DATE")
"RTN","PSORN52",83,0)
 .K DIK,DA S DIK="^PS(52.4,",DA=PSOX("IRXN") D IX^DIK K DIK,DA
"RTN","PSORN52",84,0)
 ;
"RTN","PSORN52",85,0)
 I $G(PSOX("QS"))="S",$G(PSOBARCD) S DA=PSOX("IRXN"),RXFL(PSOX("IRXN"))=0 D SUS^PSORXL K DA G FINISHX
"RTN","PSORN52",86,0)
 ;
"RTN","PSORN52",87,0)
 I PSOX("FILL DATE")>DT,$P(PSOPAR,"^",6) S DA=PSOX("IRXN"),RXFL(PSOX("IRXN"))=0 D SUS^PSORXL K DA G FINISHX
"RTN","PSORN52",88,0)
 ;
"RTN","PSORN52",89,0)
 ; - Submitting Rx to ECME for 3rd Party Billing
"RTN","PSORN52",90,0)
 N ACTION
"RTN","PSORN52",91,0)
 I $$SUBMIT^PSOBPSUT(PSOX("IRXN"),0) D  I ACTION="Q"!(ACTION="^") Q
"RTN","PSORN52",92,0)
 . S ACTION="" D ECMESND^PSOBPSU1(PSOX("IRXN"),0,PSOX("FILL DATE"),"RN")
"RTN","PSORN52",93,0)
 . I $$FIND^PSOREJUT(PSOX("IRXN"),0) D
"RTN","PSORN52",94,0)
 . . S ACTION=$$HDLG^PSOREJU1(PSOX("IRXN"),0,"79,88","RN","IOQ","I")
"RTN","PSORN52",95,0)
 ;
"RTN","PSORN52",96,0)
 I $G(PSOX("QS"))="Q",$G(PSOBARCD) D  G FINISHX
"RTN","PSORN52",97,0)
 . N PSOFROM S PSOFROM="BATCH" I $G(PPL),$L(PPL_PSOX("IRXN")_",")>240 D TRI^PSOBBC D Q^PSORXL K PPL,RXFL
"RTN","PSORN52",98,0)
 .S RXFL(PSOX("IRXN"))=0
"RTN","PSORN52",99,0)
 . I $G(PPL) S PPL=PPL_PSOX("IRXN")_","
"RTN","PSORN52",100,0)
 . E  S PPL=PSOX("IRXN")_","
"RTN","PSORN52",101,0)
 . Q
"RTN","PSORN52",102,0)
FINISHP I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=PSOX("IRXN")_",",RXFL(PSOX("IRXN"))=0 G FINISHX
"RTN","PSORN52",103,0)
 F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSORN52",104,0)
 I $L(PSORX("PSOL",PSOX2))+$L(PSOX("IRXN"))<220 S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_PSOX("IRXN")_","
"RTN","PSORN52",105,0)
 E  S PSORX("PSOL",PSOX2+1)=PSOX("IRXN")_","
"RTN","PSORN52",106,0)
 S RXFL(PSOX("IRXN"))=0
"RTN","PSORN52",107,0)
FINISHX ;
"RTN","PSORN52",108,0)
 ;call to build bingo board Rx array
"RTN","PSORN52",109,0)
 S:'$G(PSORX("MAIL/WINDOW")) PSORX("MAIL/WINDOW")=$P(PSORENW("NRX0"),"^",11)
"RTN","PSORN52",110,0)
 I $G(PSORX("MAIL/WINDOW"))["W" S BINGCRT=1,BINGRTE="W",BBFLG=1 D BBRX^PSORN52C
"RTN","PSORN52",111,0)
 K PSOX1,PSOX2
"RTN","PSORN52",112,0)
 Q
"RTN","PSORN52",113,0)
EOJ ;
"RTN","PSORN52",114,0)
 L -^PSRX("B",PSOX("IRXN")) K PSORN52,PSOX("INS"),PSORENW("INS"),PSORXED("INS"),PSONEW("ENT"),PSORXED("ENT"),OLENT,PSOIBHLD,PSOX("SINS"),PSORENW("SINS"),PSORXED("SINS"),FILE
"RTN","PSORN52",115,0)
 D PSOUL^PSSLOCK(PSOX("IRXN")) D PSOUL^PSSLOCK(PSOX("OIRXN"))
"RTN","PSORN52",116,0)
 Q
"RTN","PSORN52",117,0)
MESS ;
"RTN","PSORN52",118,0)
 I $G(PSOSCOTX)=1&(PSOSCP<50) W:$G(PSODRUG("DEA"))'["S"&($G(PSODRUG("DEA"))'["I") !!,"This Rx has been flagged by the provider as: "_$S($G(PSOSCOTH):"NO COPAY",$G(PSORX("SC"))="SC":"NO COPAY",1:"COPAY"),! S PSOSCOTX=2
"RTN","PSORN52",119,0)
 Q
"RTN","PSORN52A")
0^17^B18565756
"RTN","PSORN52A",1,0)
PSORN52A ;IHS/DSD/JCM/SAB/FLS-Break up of PSORN52 ;08/09/93
"RTN","PSORN52A",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**157,148,268,225**;DEC 1997;Build 29
"RTN","PSORN52A",3,0)
 Q  ; Call from tag
"RTN","PSORN52A",4,0)
 ;
"RTN","PSORN52A",5,0)
IBHLD ;
"RTN","PSORN52A",6,0)
 I $P(PSOIBHLD,"^",2)="" S $P(PSOIBHLD,"^",2)=$S($P(PSOLDIBQ,"^",2)=1:1,$P(PSOLDIBQ,"^",2)=0:0,1:"")
"RTN","PSORN52A",7,0)
 I $P(PSOIBHLD,"^",3)="" S $P(PSOIBHLD,"^",3)=$S($P(PSOLDIBQ,"^",3)=1:1,$P(PSOLDIBQ,"^",3)=0:0,1:"")
"RTN","PSORN52A",8,0)
 I $P(PSOIBHLD,"^",4)="" S $P(PSOIBHLD,"^",4)=$S($P(PSOLDIBQ,"^",4)=1:1,$P(PSOLDIBQ,"^",4)=0:0,1:"")
"RTN","PSORN52A",9,0)
 I $P(PSOIBHLD,"^",5)="" S $P(PSOIBHLD,"^",5)=$S($P(PSOLDIBQ,"^",5)=1:1,$P(PSOLDIBQ,"^",5)=0:0,1:"")
"RTN","PSORN52A",10,0)
 I $P(PSOIBHLD,"^",6)="" S $P(PSOIBHLD,"^",6)=$S($P(PSOLDIBQ,"^",6)=1:1,$P(PSOLDIBQ,"^",6)=0:0,1:"")
"RTN","PSORN52A",11,0)
 I $P(PSOIBHLD,"^",7)="" S $P(PSOIBHLD,"^",7)=$S($P(PSOLDIBQ,"^",7)=1:1,$P(PSOLDIBQ,"^",7)=0:0,1:"")
"RTN","PSORN52A",12,0)
 I $P(PSOIBHLD,"^",8)="" S $P(PSOIBHLD,"^",8)=$S($P(PSOLDIBQ,"^",8)=1:1,$P(PSOLDIBQ,"^",8)=0:0,1:"")
"RTN","PSORN52A",13,0)
 Q
"RTN","PSORN52A",14,0)
 ;
"RTN","PSORN52A",15,0)
FILE ; - Filling ^PSRX and ^PS(55 entries
"RTN","PSORN52A",16,0)
 S PSOX("NRX0")=PSORENW("RX0"),PSOX("NRX2")=PSORENW("RX2"),PSOX("NRX3")=PSORENW("RX3"),$P(PSOX("NRX3"),"^",5)=""
"RTN","PSORN52A",17,0)
 S $P(PSOX("NRX0"),"^")=PSOX("NRX #") S:$G(PSOX("PROVIDER"))]"" $P(PSOX("NRX0"),"^",4)=PSOX("PROVIDER")
"RTN","PSORN52A",18,0)
 I $G(PSORNSPD),$G(PSOX("PATIENT STATUS")),$G(PSOX("PATIENT STATUS"))?.N S $P(PSOX("NRX0"),"^",3)=PSOX("PATIENT STATUS")
"RTN","PSORN52A",19,0)
 S:$G(PSOX("COSIGNING PROVIDER"))]"" $P(PSOX("NRX3"),"^",3)=PSOX("COSIGNING PROVIDER")
"RTN","PSORN52A",20,0)
 S $P(PSOX("NRX0"),"^",5)=PSOX("CLINIC"),$P(PSOX("NRX0"),"^",9)=PSOX("# OF REFILLS")
"RTN","PSORN52A",21,0)
 I $G(PSOX("DAYS SUPPLY")) S $P(PSOX("NRX0"),"^",8)=PSOX("DAYS SUPPLY")
"RTN","PSORN52A",22,0)
 I $G(PSOX("QTY")) S $P(PSOX("NRX0"),"^",7)=PSOX("QTY")
"RTN","PSORN52A",23,0)
 S $P(PSOX("NRX0"),"^",11)=$S(PSOX("FILL DATE")>DT&($P(PSOPAR,"^",6)):"M",$D(PSOX("MAIL/WINDOW")):PSOX("MAIL/WINDOW"),1:$P(PSOX("NRX0"),"^",11))
"RTN","PSORN52A",24,0)
 S $P(PSOX("NRX0"),"^",13)=PSOX("ISSUE DATE"),$P(PSOX("STA"),"^")=PSOX("STATUS"),$P(PSOX("NRX0"),"^",16)=$S($G(PSOX("CLERK CODE"))]"":PSOX("CLERK CODE"),1:DUZ)
"RTN","PSORN52A",25,0)
 S $P(PSOX("NRX0"),"^",17)=$G(PSODRUG("COST"))
"RTN","PSORN52A",26,0)
 S $P(PSOX("NRX2"),"^")=PSOX("LOGIN DATE"),$P(PSOX("NRX2"),"^",2)=PSOX("FILL DATE"),$P(PSOX("NRX2"),"^",3)="",$P(PSOX("NRX2"),"^",5)=PSOX("DISPENSED DATE")
"RTN","PSORN52A",27,0)
 S $P(PSOX("NRX2"),"^",6)=PSOX("STOP DATE"),$P(PSOX("NRX2"),"^",7)=$S($G(PSOX("NDC"))]"":PSOX("NDC"),1:$G(PSODRUG("NDC")))
"RTN","PSORN52A",28,0)
 S $P(PSOX("NRX2"),"^",8)=$S($G(PSOX("MANUFACTURER"))]"":PSOX("MANUFACTURER"),1:$G(PSODRUG("MANUFACTURER")))
"RTN","PSORN52A",29,0)
 S $P(PSOX("NRX2"),"^",9)=+PSOSITE,$P(PSOX("NRX2"),"^",10)=""
"RTN","PSORN52A",30,0)
 S $P(PSOX("NRX2"),"^",11)=$S($G(PSOX("EXPIRATION DATE"))]"":PSOX("EXPIRATION DATE"),1:$G(PSODRUG("EXPIRATION DATE")))
"RTN","PSORN52A",31,0)
 S:$G(PSOX("GENERIC PROVIDER"))]"" $P(PSOX("NRX2"),"^",12)=PSOX("GENERIC PROVIDER")
"RTN","PSORN52A",32,0)
 S $P(PSOX("NRX2"),"^",13)="",$P(PSOX("NRX2"),"^",15)="",$P(PSOX("NRX3"),"^",4)=$P(PSOX("NRX3"),"^")
"RTN","PSORN52A",33,0)
 S $P(PSOX("EPH"),"^")=$S($G(PSOX("DAW"))]"":PSOX("DAW"),1:$G(PSODRUG("DAW")))
"RTN","PSORN52A",34,0)
 ;S PSOX("LAST DISPENSED DATE")=$P(PSOX("NRX3"),"^")
"RTN","PSORN52A",35,0)
 S PSOX("LAST DISPENSED DATE")=PSOX("DISPENSED DATE")
"RTN","PSORN52A",36,0)
 S $P(PSOX("NRX3"),"^")=PSOX("LAST DISPENSED DATE")
"RTN","PSORN52A",37,0)
 S:$G(PSOX("NEXT POSSIBLE REFILL"))]"" $P(PSOX("NRX3"),"^",2)=PSOX("NEXT POSSIBLE REFILL")
"RTN","PSORN52A",38,0)
 S:'$P(^VA(200,$P(PSOX("NRX0"),"^",4),"PS"),"^",7) $P(PSOX("NRX3"),"^",3)=""
"RTN","PSORN52A",39,0)
 S:$G(PSOX("REMARKS"))']"" PSOX("REMARKS")="RENEWED FROM RX # "_$P(PSOX("RX0"),"^")
"RTN","PSORN52A",40,0)
 S $P(PSOX("NRX3"),"^",7)=PSOX("REMARKS"),$P(PSOX("NRX3"),"^",8)=""
"RTN","PSORN52A",41,0)
 ;
"RTN","PSORN52A",42,0)
 ; - File OTHER PATIENT INSTRUCTIONS into ^PSRX
"RTN","PSORN52A",43,0)
 I $G(PSOFXRNX) S PSOFXRN=1
"RTN","PSORN52A",44,0)
 D ^PSORN52C,FILE^PSORN52D
"RTN","PSORN52A",45,0)
 I $G(^PSRX(PSOX("OIRXN"),"INSS"))]"" S ^PSRX(PSOX("IRXN"),"INSS")=^PSRX(PSOX("OIRXN"),"INSS") K PSOX1 G F55
"RTN","PSORN52A",46,0)
 I $G(PSOX("SINS"))]"" S ^PSRX(PSOX("IRXN"),"INSS")=PSOX("SINS")
"RTN","PSORN52A",47,0)
 K PSOX1
"RTN","PSORN52A",48,0)
 ;
"RTN","PSORN52A",49,0)
 ; - File data into ^PS(55)
"RTN","PSORN52A",50,0)
F55 L +^PS(55,PSODFN,"P"):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3) S:'$D(^PS(55,PSODFN,"P",0)) ^(0)="^55.03PA^^"
"RTN","PSORN52A",51,0)
 F PSOX1=$P(^PS(55,PSODFN,"P",0),"^",3):1 Q:'$D(^PS(55,PSODFN,"P",PSOX1))
"RTN","PSORN52A",52,0)
 S PSOX("55 IEN")=PSOX1
"RTN","PSORN52A",53,0)
 S ^PS(55,PSODFN,"P",PSOX1,0)=PSOX("IRXN"),$P(^PS(55,PSODFN,"P",0),"^",3,4)=PSOX1_"^"_($P(^PS(55,PSODFN,"P",0),"^",4)+1)
"RTN","PSORN52A",54,0)
 S ^PS(55,PSODFN,"P","A",PSOX("STOP DATE"),PSOX("IRXN"))=""
"RTN","PSORN52A",55,0)
 L -^PS(55,PSODFN,"P")
"RTN","PSORN52A",56,0)
 K PSOX1
"RTN","PSORN52A",57,0)
 ;
"RTN","PSORN52A",58,0)
 ; - Patient Counseling questions
"RTN","PSORN52A",59,0)
 I $G(OR0) D FULL^VALM1,COUN^PSONEW S PSONOOR=""
"RTN","PSORN52A",60,0)
 I $D(^XUSEC("PSORPH",DUZ)) S DA=PSOX("IRXN"),DIE=52,DR="41////"_PSOCOU_";S:'X Y=""@1"";42////"_PSOCOUU_";@1" D ^DIE K DIE,DR
"RTN","PSORN52A",61,0)
 ;
"RTN","PSORN52A",62,0)
 ; - Re-indexing file 52 entry
"RTN","PSORN52A",63,0)
 K DIK,DA S DIK="^PSRX(",DA=PSOX("IRXN") D IX1^DIK K DIK
"RTN","PSORN52A",64,0)
 S DA=PSOX("IRXN") D ORC^PSORN52C
"RTN","PSORN52A",65,0)
 Q
"RTN","PSORN52C")
0^68^B49927643
"RTN","PSORN52C",1,0)
PSORN52C ;BIR/SAB-files renewal entries con't ;08/09/93
"RTN","PSORN52C",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,7,11,27,46,75,87,100,111,124,117,131,146,148,200,225**;DEC 1997;Build 29
"RTN","PSORN52C",3,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSORN52C",4,0)
 S DIC="^PSRX(",DLAYGO=52,DIC(0)="L",X=PSOX("NRX #") K DD,DO
"RTN","PSORN52C",5,0)
 D FILE^DICN S PSOX("IRXN")=+Y K DLAYGO,X,Y,DIC,DD,DO
"RTN","PSORN52C",6,0)
 D:+$G(DGI) TECH^PSODGDGI ; L +^PSRX(PSOX("IRXN")):0
"RTN","PSORN52C",7,0)
 D:$G(^TMP("PSODAI",$J,0))
"RTN","PSORN52C",8,0)
 .S $P(^PSRX(PSOX("IRXN"),3),"^",6)=1
"RTN","PSORN52C",9,0)
 .I $O(^TMP("PSODAI",$J,0)) S DAI=0 F  S DAI=$O(^TMP("PSODAI",$J,DAI)) Q:'DAI  D
"RTN","PSORN52C",10,0)
 ..S:'$D(^PSRX(PSOX("IRXN"),"DAI",0)) ^PSRX(PSOX("IRXN"),"DAI",0)="^52.03^^" S ^PSRX(PSOX("IRXN"),"DAI",DAI,0)=^TMP("PSODAI",$J,DAI,0)
"RTN","PSORN52C",11,0)
 ..S $P(^PSRX(PSOX("IRXN"),"DAI",0),"^",3)=+$P(^PSRX(PSOX("IRXN"),"DAI",0),"^",3)+1,$P(^(0),"^",4)=+$P(^(0),"^",4)+1
"RTN","PSORN52C",12,0)
 .K ^TMP("PSODAI",$J),DAI
"RTN","PSORN52C",13,0)
 S PSORN52(PSOX("IRXN"),0)=PSOX("NRX0"),PSORN52(PSOX("IRXN"),2)=PSOX("NRX2"),PSORN52(PSOX("IRXN"),3)=PSOX("NRX3")
"RTN","PSORN52C",14,0)
 S PSORN52(PSOX("IRXN"),"EPH")=PSOX("EPH")
"RTN","PSORN52C",15,0)
 S:'$G(PSOX("ENT")) PSORN52(PSOX("IRXN"),"SIG")=PSOX("SIG")
"RTN","PSORN52C",16,0)
 S PSORN52(PSOX("IRXN"),"STA")=PSOX("STA")
"RTN","PSORN52C",17,0)
 S:$G(PSOX("TN"))]"" PSORN52(PSOX("IRXN"),"TN")=PSOX("TN")
"RTN","PSORN52C",18,0)
 I $G(PSOX("METHOD OF PICK-UP"))]"",PSOX("FILL DATE")'>DT S PSORN52(PSOX("IRXN"),"MP")=PSOX("METHOD OF PICK-UP")
"RTN","PSORN52C",19,0)
 S PSORN52(PSOX("IRXN"),"TYPE")=0
"RTN","PSORN52C",20,0)
 S PSOX1="" F  S PSOX1=$O(PSORN52(PSOX("IRXN"),PSOX1)) Q:PSOX1=""  S ^PSRX(PSOX("IRXN"),PSOX1)=$G(PSORN52(PSOX("IRXN"),PSOX1))
"RTN","PSORN52C",21,0)
 I $O(SIG(0)) D  G ENT
"RTN","PSORN52C",22,0)
 .S II=0 F I=0:0 S I=$O(SIG(I)) Q:'I  S ^PSRX(PSOX("IRXN"),"SIG1",I,0)=SIG(I),II=II+1
"RTN","PSORN52C",23,0)
 .S ^PSRX(PSOX("IRXN"),"SIG1",0)="^52.04A^"_II_"^"_II,$P(^PSRX(PSOX("IRXN"),"SIG"),"^",2)=1 K I,II
"RTN","PSORN52C",24,0)
 .S $P(^PSRX(PSOX("IRXN"),"SIG"),"^",2)=1
"RTN","PSORN52C",25,0)
ENT S ^PSRX(PSOX("IRXN"),"POE")=1,^PSRX(PSOX("IRXN"),"INS")=$G(PSOX("INS"))
"RTN","PSORN52C",26,0)
 I $G(OR0) S:$P(OR0,"^",24) ^PSRX(PSOX("IRXN"),"PKI")=1
"RTN","PSORN52C",27,0)
 I $G(PSOX("SIG",1))]"",'$O(PSOX("SIG",1)) S ^PSRX(PSOX("IRXN"),"INS1",1,0)=PSOX("SIG",1),^PSRX(PSOX("IRXN"),"INS1",0)="^52.0115^1^1^"_DT_"^^"
"RTN","PSORN52C",28,0)
 I $O(^PSRX(PSOX("OIRXN"),"INS1",0)) D
"RTN","PSORN52C",29,0)
 .F D=0:0 S D=$O(^PSRX(PSOX("OIRXN"),"INS1",D)) Q:'D  S ^PSRX(PSOX("IRXN"),"INS1",D,0)=^PSRX(PSOX("OIRXN"),"INS1",D,0)
"RTN","PSORN52C",30,0)
 .S ^PSRX(PSOX("IRXN"),"INS1",0)=^PSRX(PSOX("OIRXN"),"INS1",0)
"RTN","PSORN52C",31,0)
TNT F I=1:1:PSOX("ENT") S ^PSRX(PSOX("IRXN"),6,I,0)=PSOX("DOSE",I)_"^"_$G(PSOX("DOSE ORDERED",I))_"^"_$G(PSOX("UNITS",I))_"^"_$G(PSOX("NOUN",I))_"^" D
"RTN","PSORN52C",32,0)
 .S ^PSRX(PSOX("IRXN"),6,I,0)=^PSRX(PSOX("IRXN"),6,I,0)_$G(PSOX("DURATION",I))_"^"_$G(PSOX("CONJUNCTION",I))_"^"_$G(PSOX("ROUTE",I))_"^"_$G(PSOX("SCHEDULE",I))_"^"_$G(PSOX("VERB",I))
"RTN","PSORN52C",33,0)
 .I $G(PSOX("ODOSE",I))]"" S ^PSRX(PSOX("IRXN"),6,I,1)=PSOX("ODOSE",I)
"RTN","PSORN52C",34,0)
 S:$G(PSOX("ENT")) ^PSRX(PSOX("IRXN"),6,0)="^52.0113^"_PSOX("ENT")_"^"_PSOX("ENT")
"RTN","PSORN52C",35,0)
 Q
"RTN","PSORN52C",36,0)
ORC ;
"RTN","PSORN52C",37,0)
 D MARK^PSOTPCAN
"RTN","PSORN52C",38,0)
 K PSORDEDT,GG,PSOHD,PSOID,PTST,PTDY,PTRF,RFCNT,RN,SEG1,SIG,SIGOK,DIC
"RTN","PSORN52C",39,0)
 K ST0,STA,STP,STR,JJ,LSI,MM,ORDG,ORIG,PHARMST,PSCAN,PSCNT,PSOI,GMRAL,DIC,DIE,HDR,IEN,NAME D KVA^VADPT
"RTN","PSORN52C",40,0)
 I $G(PSOFDR) D 
"RTN","PSORN52C",41,0)
 .I $G(PKI1)=1,$G(PKIR)]"" D ACT^PSOPKIV1(PSOX("IRXN"))
"RTN","PSORN52C",42,0)
 .S $P(^PSRX(PSOX("IRXN"),"OR1"),"^",2)=$P(OR0,"^"),^PSRX("APL",$P(OR0,"^"),PSOX("IRXN"))=""
"RTN","PSORN52C",43,0)
 .I $P($G(^PS(52.41,+$G(ORD),"EXT")),"^")="" I $G(PSOSIGFL)!($G(PSODRUG("OI"))'=$P(OR0,"^",8)) K:'$G(PSOPRC) PRC K PHI
"RTN","PSORN52C",44,0)
 .I $O(PRC(0)) S T=0 F  S T=$O(PRC(T)) Q:'T  S ^PSRX(PSOX("IRXN"),"PRC",T,0)=PRC(T),^PSRX(PSOX("IRXN"),"PRC",0)="^^"_T_"^"_T_"^"_DT_"^"
"RTN","PSORN52C",45,0)
 .I $O(PHI(0)) S T=0 F  S T=$O(PHI(T)) Q:'T  S ^PSRX(PSOX("IRXN"),"PI",T,0)=PHI(T),^PSRX(PSOX("IRXN"),"PI",0)="^^"_T_"^"_T_"^"_DT_"^"
"RTN","PSORN52C",46,0)
 .I $G(PSOSIGFL)!($G(PSODRUG("OI"))'=$P(OR0,"^",8)) D  S PSOI=1 Q
"RTN","PSORN52C",47,0)
 ..S POERR("PLACER")=$P(^PS(52.41,ORD,0),"^"),PSORDEDT=ORD
"RTN","PSORN52C",48,0)
 ..K ^PS(52.41,"AOR",PSODFN,+$P($G(^PS(52.41,ORD,"INI")),"^"),ORD)
"RTN","PSORN52C",49,0)
 ..S DA=ORD,DIK="^PS(52.41," D ^DIK
"RTN","PSORN52C",50,0)
 ..S $P(^PSRX(PSOX("IRXN"),"OR1"),"^")=$G(PSODRUG("OI"))
"RTN","PSORN52C",51,0)
 .E  S $P(^PSRX(PSOX("IRXN"),"OR1"),"^")=$P(OR0,"^",8)
"RTN","PSORN52C",52,0)
 .D PSOUL^PSSLOCK(ORD_"S") S DIK="^PS(52.41,",DA=ORD D ^DIK K DIK,DA
"RTN","PSORN52C",53,0)
 I $G(PSOX("OIRXN")),'$G(COPY) S $P(^PSRX(PSOX("IRXN"),"OR1"),"^",3)=PSOX("OIRXN"),$P(^PSRX(PSOX("OIRXN"),"OR1"),"^",4)=PSOX("IRXN"),^PSRX("AQ",PSOX("IRXN"),PSOX("OIRXN"))="" K PRC
"RTN","PSORN52C",54,0)
 I $O(PRC(0)) S T=0 F  S T=$O(PRC(T)) Q:'T  S ^PSRX(PSOX("IRXN"),"PRC",T,0)=PRC(T),^PSRX(PSOX("IRXN"),"PRC",0)="^^"_T_"^"_T_"^"_DT_"^"
"RTN","PSORN52C",55,0)
 I $O(PHI(0)) S T=0 F  S T=$O(PHI(T)) Q:'T  S ^PSRX(PSOX("IRXN"),"PI",T,0)=PHI(T),^PSRX(PSOX("IRXN"),"PI",0)="^^"_T_"^"_T_"^"_DT_"^"
"RTN","PSORN52C",56,0)
 S $P(^PSRX(PSOX("IRXN"),"OR1"),"^",5)=DUZ
"RTN","PSORN52C",57,0)
 S $P(^PSRX(PSOX("IRXN"),"OR1"),"^",8)=$$NOW^XLFDT D
"RTN","PSORN52C",58,0)
 . N DA,DIK S DA=PSOX("IRXN"),DIK="^PSRX(",DIK(1)=38.3 D EN1^DIK K DIK,DA
"RTN","PSORN52C",59,0)
 S PHARMST="",$P(^PSRX(PSOX("IRXN"),"OR1"),"^")=$G(PSODRUG("OI"))
"RTN","PSORN52C",60,0)
 S RXN=PSOX("IRXN") D SAVE
"RTN","PSORN52C",61,0)
 S STAT=$S($G(OR0)]""&('$G(PSOI)):"SC",$G(PSOI):"RO",1:"SN") S PHARMST=$S('$G(PSORX("VERIFY")):"CM",1:"IP") ;D EN^PSOHLSN1(RXN,STAT,PHARMST,"",PSONOOR)
"RTN","PSORN52C",62,0)
 S ^TMP("PSORXN",$J,RXN)=STAT_"^"_PHARMST_"^"_PSONOOR D PSOL^PSSLOCK(RXN)
"RTN","PSORN52C",63,0)
 D RESTORE K PSORDEDT,PHI,PRC,STAT,COMM,PSOI,OR2,OR1,PHARMST,RXN,DRG,STA,ACT,OCXR,OCXD1,OCXDT,OCXI
"RTN","PSORN52C",64,0)
 Q
"RTN","PSORN52C",65,0)
BBRX ;build bingo board Rx array; called by PSON52,PSOR52,PSORN52
"RTN","PSORN52C",66,0)
 I $G(BBRX(1))']"" S BBRX(1)=PSOX("IRXN")_"," Q
"RTN","PSORN52C",67,0)
 F PSOX1=0:0 S PSOX1=$O(BBRX(PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSORN52C",68,0)
 I $L(BBRX(PSOX2))+$L(PSOX("IRXN"))<220 S BBRX(PSOX2)=BBRX(PSOX2)_PSOX("IRXN")_","
"RTN","PSORN52C",69,0)
 E  S BBRX(PSOX2+1)=PSOX("IRXN")_","
"RTN","PSORN52C",70,0)
 Q
"RTN","PSORN52C",71,0)
SAVE ;this module will be used to save PSO arrays
"RTN","PSORN52C",72,0)
 K ^TMP("PSOLST",$J) F I=0:0 S I=$O(PSOLST(I)) Q:'I  S ^TMP("PSOLST",$J,I,0)=PSOLST(I)
"RTN","PSORN52C",73,0)
 K ^TMP("PSOSD",$J) S (STA,DRG)="" F  S STA=$O(PSOSD(STA)) Q:STA=""  F  S DRG=$O(PSOSD(STA,DRG)) Q:DRG=""  S ^TMP("PSOSD",$J,STA,DRG)=PSOSD(STA,DRG)
"RTN","PSORN52C",74,0)
 I $G(PSOSD) S ^TMP("PSOSD",$J,0)=PSOSD
"RTN","PSORN52C",75,0)
 I $G(PSODRUG("NAME"))]"" K ^TMP("PSODRUG",$J) S STA=""  F  S STA=$O(PSODRUG(STA)) Q:STA=""  S ^TMP("PSODRUG",$J,STA)=PSODRUG(STA)
"RTN","PSORN52C",76,0)
 I $G(PSOX("# OF REFILLS"))]"" K ^TMP("PSOX",$J),^TMP("PSORENW",$J),^TMP("PSONEW",$J),^TMP("PSORXED",$J) D
"RTN","PSORN52C",77,0)
 .S STA="" F  S STA=$O(PSOX(STA)) Q:STA=""  S ^TMP("PSOX",$J,STA)=$G(PSOX(STA)) D
"RTN","PSORN52C",78,0)
 ..I STA="OLD LAST RX#",$O(PSOX(STA,"")) K ^TMP("PSOX",$J,STA) S ^TMP("PSOX",$J,STA,$O(PSOX(STA,"")))=PSOX(STA,$O(PSOX(STA,""))) D  Q
"RTN","PSORN52C",79,0)
 ...I $O(PSONEW(STA,"")) S ^TMP("PSONEW",$J,STA,$O(PSONEW(STA,"")))=PSONEW(STA,$O(PSONEW(STA,"")))
"RTN","PSORN52C",80,0)
 ...I $O(PSORENW(STA,"")) S ^TMP("PSORENW",$J,STA,$O(PSORENW(STA,"")))=PSORENW(STA,$O(PSORENW(STA,"")))
"RTN","PSORN52C",81,0)
 ...I $O(PSORXED(STA,"")) S ^TMP("PSORXED",$J,STA,$O(PSORXED(STA,"")))=PSORXED(STA,$O(PSORXED(STA,"")))
"RTN","PSORN52C",82,0)
 ..F ACT="PSORENW","PSONEW","PSORXED" I $G(@(ACT_"("""_STA_""")"))]"" S ^TMP(ACT,$J,STA)=@(ACT_"("""_STA_""")")
"RTN","PSORN52C",83,0)
 K PSOPTPST,PSOSD,PSONEW,PSOLST,PSORENW,PSORXED,PSODRUG
"RTN","PSORN52C",84,0)
 Q
"RTN","PSORN52C",85,0)
RESTORE ;this module restore saved arrays
"RTN","PSORN52C",86,0)
 S STA=0 F  S STA=$O(^TMP("PSOLST",$J,STA)) Q:'STA  S PSOLST(STA)=^TMP("PSOLST",$J,STA,0)
"RTN","PSORN52C",87,0)
 I $G(^TMP("PSOSD",$J,0)) S PSOSD=$G(^TMP("PSOSD",$J,0))
"RTN","PSORN52C",88,0)
 S (STA,DRG)="" F  S STA=$O(^TMP("PSOSD",$J,STA)) Q:STA=""  F  S DRG=$O(^TMP("PSOSD",$J,STA,DRG)) Q:DRG=""  S PSOSD(STA,DRG)=^TMP("PSOSD",$J,STA,DRG)
"RTN","PSORN52C",89,0)
 S STA="" F  S STA=$O(^TMP("PSODRUG",$J,STA)) Q:STA=""  S PSODRUG(STA)=^TMP("PSODRUG",$J,STA)
"RTN","PSORN52C",90,0)
 S STA="" F ACT="PSOX","PSORENW","PSONEW","PSORXED" D:$O(^TMP(ACT,$J,STA))]""
"RTN","PSORN52C",91,0)
 .F  S STA=$O(^TMP(ACT,$J,STA)) Q:STA=""  I STA'="OLD LAST RX#" S @(ACT_"("""_STA_""")")=^TMP(ACT,$J,STA)
"RTN","PSORN52C",92,0)
 I $O(^TMP("PSOX",$J,"OLD LAST RX#","")) S PSOX("OLD LAST RX#",$O(^TMP("PSOX",$J,"OLD LAST RX#","")))=^TMP("PSOX",$J,"OLD LAST RX#",$O(^TMP("PSOX",$J,"OLD LAST RX#","")))
"RTN","PSORN52C",93,0)
 I $O(^TMP("PSONEW",$J,"OLD LAST RX#","")) S PSONEW("OLD LAST RX#",$O(^TMP("PSONEW",$J,"OLD LAST RX#","")))=^TMP("PSONEW",$J,"OLD LAST RX#",$O(^TMP("PSONEW",$J,"OLD LAST RX#","")))
"RTN","PSORN52C",94,0)
 I $O(^TMP("PSORENW",$J,"OLD LAST RX#","")) S PSORENW("OLD LAST RX#",$O(^TMP("PSORENW",$J,"OLD LAST RX#","")))=^TMP("PSORENW",$J,"OLD LAST RX#",$O(^TMP("PSORENW",$J,"OLD LAST RX#","")))
"RTN","PSORN52C",95,0)
 I $O(^TMP("PSORXED",$J,"OLD LAST RX#","")) S PSORXED("OLD LAST RX#",$O(^TMP("PSORXED",$J,"OLD LAST RX#","")))=^TMP("PSORXED",$J,"OLD LAST RX#",$O(^TMP("PSORXED",$J,"OLD LAST RX#","")))
"RTN","PSORN52C",96,0)
 K ^TMP("PSOSD",$J),^TMP("PSODRUG",$J),^TMP("PSOX",$J),^TMP("PSORENW",$J),^TMP("PSONEW",$J),^TMP("PSORXED",$J),^TMP("PSOLST",$J)
"RTN","PSORN52C",97,0)
 Q
"RTN","PSORN52D")
0^18^B41922848
"RTN","PSORN52D",1,0)
PSORN52D ;BIR/LE - files new and renewal entries con't ;02/27/04
"RTN","PSORN52D",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**143,219,239,225**;DEC 1997;Build 29
"RTN","PSORN52D",3,0)
 ;External reference VADPT supported by DBIA 10061
"RTN","PSORN52D",4,0)
 Q
"RTN","PSORN52D",5,0)
GET ;must have FILE and PSORENW variables to pull default data for ICD and SC/EI for SC>50% Rx's from file 52
"RTN","PSORN52D",6,0)
 N ARRAY,ERR,SUBF,RXN,II,JJ,ORXN,SUBFLD,PENDSC,PSOPATST,PSOIBQF
"RTN","PSORN52D",7,0)
 I FILE=52 S SUBF=52.052311,SUBFLD=52311,RXN=PSORENW("IRXN"),(SRXN,ORXN)=PSORENW("OIRXN") S:($TR($G(^PSRX(SRXN,"IBQ")),"^")'="") PSOIBQF=1
"RTN","PSORN52D",8,0)
 ;$TR checks for when patient status is exempt, null IBQ node was set for exempts, or SC>50 - data is in ICD node
"RTN","PSORN52D",9,0)
 I FILE=52.41 S SUBF=52.41311,SUBFLD=311,(SRXN,RXN)=ORD,ORXN=PSORENW("OIRXN") S:($TR($G(^PS(52.41,SRXN,"IBQ")),"^")'="") PSOIBQF=1
"RTN","PSORN52D",10,0)
 D GETS^DIQ(FILE,SRXN,SUBFLD_"*","I","ARRAY","ERR")
"RTN","PSORN52D",11,0)
 K PSORX("ICD"),PSOX("ICD")
"RTN","PSORN52D",12,0)
 Q:'$D(ARRAY)
"RTN","PSORN52D",13,0)
 I FILE=52.41 S PENDSC=$$GET1^DIQ(52.41,ORD,"17"),PENDSC=$S(PENDSC="SC":1,PENDSC="NSC":0,1:"")
"RTN","PSORN52D",14,0)
 S PSOPATST=$$GET1^DIQ(52,RXN_",",3,"I")
"RTN","PSORN52D",15,0)
 ;
"RTN","PSORN52D",16,0)
G1 ;get ICD, if no IBQ node get SC/EI's
"RTN","PSORN52D",17,0)
 F II=1:1:8 Q:'$D(ARRAY(SUBF,(II_","_SRXN_",")))  D
"RTN","PSORN52D",18,0)
 . S PSORX("ICD",II)=ARRAY(SUBF,(II_","_SRXN_","),.01,"I") S:FILE=52.41 PSONEW("ICD",II)=PSORX("ICD",II)
"RTN","PSORN52D",19,0)
 . Q:II>1!($G(PSOIBQF))  ;only need ei's from 1st node; all nodes same for SC/EI
"RTN","PSORN52D",20,0)
 . F JJ=1:1:8 I ARRAY(SUBF,(II_","_SRXN_","),JJ,"I")=1!(ARRAY(SUBF,(II_","_SRXN_","),JJ,"I")=0) D
"RTN","PSORN52D",21,0)
 .. I JJ=1 S (PSOANSQ(RXN,"VEH"),PSORX(ORXN,"VEH"))=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I") Q
"RTN","PSORN52D",22,0)
 .. I JJ=2 S (PSOANSQ(RXN,"RAD"),PSORX(ORXN,"RAD"))=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I") Q
"RTN","PSORN52D",23,0)
 .. I JJ=4 S (PSOANSQ(RXN,"PGW"),PSORX(ORXN,"PGW"))=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I") Q
"RTN","PSORN52D",24,0)
 .. I JJ=5 S (PSOANSQ(RXN,"MST"),PSORX(ORXN,"MST"))=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I") Q
"RTN","PSORN52D",25,0)
 .. I JJ=6 S (PSOANSQ(RXN,"HNC"),PSORX(ORXN,"HNC"))=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I") Q
"RTN","PSORN52D",26,0)
 .. I JJ=7 S (PSOANSQ(RXN,"CV"),PSORX(ORXN,"CV"))=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I") Q
"RTN","PSORN52D",27,0)
 .. I JJ=8 S (PSOANSQ(RXN,"SHAD"),PSORX(ORXN,"SHAD"))=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I") Q
"RTN","PSORN52D",28,0)
 I '$G(PSOIBQF) S II=1,JJ=3 D
"RTN","PSORN52D",29,0)
 . I PSOSCP>49&(FILE=52.41) S (PSOANSQ(RXN,"SC>50"),PSORX(ORXN,"SC>50"),PSOANSQ("SC>50"))=PENDSC Q
"RTN","PSORN52D",30,0)
 . I PSOSCP>49&(FILE'=52.41) S:$D(ARRAY(SUBF,(II_","_SRXN_","),JJ,"I")) (PSOANSQ(RXN,"SC>50"),PSOANSQ("SC>50"),PSORX(ORXN,"SC>50"))=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I") Q
"RTN","PSORN52D",31,0)
 . ; when patient status is exempt use SC>50 variable to differenciate regular SC<50 and exempt SC<50
"RTN","PSORN52D",32,0)
 . I PSOSCP<50&($P($G(^PS(53,+$G(PSOPATST),0)),"^",7)=1) D
"RTN","PSORN52D",33,0)
 .. I FILE=52.41 S (PSOANSQ(RXN,"SC>50"),PSORX(ORXN,"SC>50"),PSOANSQ("SC>50"))=PENDSC Q
"RTN","PSORN52D",34,0)
 .. S:$G(ARRAY(SUBF,(II_","_SRXN_","),JJ,"I")) (PSOANSQ(RXN,"SC>50"),PSORX(ORXN,"SC>50"),PSOANSQ("SC>50"))=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I")
"RTN","PSORN52D",35,0)
 . I PSOSCP<50&($P($G(^PS(53,+$G(PSOPATST),0)),"^",7)'=1) D
"RTN","PSORN52D",36,0)
 .. I FILE=52.41 S (PSOANSQ(RXN,"SC"),PSORX(ORXN,"SC"),PSOANSQ("SC"))=PENDSC Q
"RTN","PSORN52D",37,0)
 .. S:$D(ARRAY(SUBF,(II_","_SRXN_","),JJ,"I")) (PSOANSQ(RXN,"SC"),PSORX(ORXN,"SC"),PSOANSQ("SC"))=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I")
"RTN","PSORN52D",38,0)
 Q
"RTN","PSORN52D",39,0)
 ;
"RTN","PSORN52D",40,0)
FILE ;
"RTN","PSORN52D",41,0)
 Q:'$D(^PSRX(PSOX("OIRXN"),"ICD"))
"RTN","PSORN52D",42,0)
 N II F II=1:1:8 Q:$G(^PSRX(PSOX("OIRXN"),"ICD",II,0))=""  D
"RTN","PSORN52D",43,0)
 . S ^PSRX(PSOX("IRXN"),"ICD",II,0)=$G(^PSRX(PSOX("OIRXN"),"ICD",II,0))
"RTN","PSORN52D",44,0)
 . S:$P(^PSRX(PSOX("IRXN"),"ICD",II,0),"^",1)'="" ^PSRX(PSOX("IRXN"),"ICD","B",$P(^PSRX(PSOX("IRXN"),"ICD",II,0),"^",1),II)=""
"RTN","PSORN52D",45,0)
 I II>1 S ^PSRX(PSOX("IRXN"),"ICD",0)="^52.052311^"_(II-1)_"^"_(II-1)
"RTN","PSORN52D",46,0)
 Q
"RTN","PSORN52D",47,0)
FILE2 ;file ICD's on existing node or build new nodes
"RTN","PSORN52D",48,0)
 ;note: variable PSOSCP2 is only available from CPRS Edit API and MISS
"RTN","PSORN52D",49,0)
 ;        sub-routine below.
"RTN","PSORN52D",50,0)
 N D,RXN,II,TYPE,DATA,DATA1,PSOPATST
"RTN","PSORN52D",51,0)
 I $G(PSOX("IRXN")) S PSOPATST=$$GET1^DIQ(52,PSOX("IRXN")_",",3,"I")
"RTN","PSORN52D",52,0)
 ;I '$G(PSONEW("PATIENT STATUS")) I $G(PSOX("IRXN")) S PSONEW("PATIENT STATUS")=$$GET1^DIQ(52,PSOX("IRXN")_",",3,"I")
"RTN","PSORN52D",53,0)
 I $G(PSOSCP2)!($G(PSOFDR)&($G(ORD))) D
"RTN","PSORN52D",54,0)
 .;if RX edited in CPRS delete all but what is sent from CPRS
"RTN","PSORN52D",55,0)
 . K ^PSRX(PSOX("IRXN"),"ICD"),^PSRX(PSOX("IRXN"),"IBQ")
"RTN","PSORN52D",56,0)
 S DATA="^^^^^^^^",(DATA1,TYPE)=""
"RTN","PSORN52D",57,0)
 S $P(DATA,U,4)=$S(PSOSCP>49:$G(PSOANSQ("SC>50")),PSOSCP<50&($P($G(^PS(53,+$G(PSOPATST),0)),"^",7)=1):$G(PSOANSQ("SC>50")),PSOSCP<50&(PSOSCP'=""):$G(PSOANSQ("SC")),1:"")
"RTN","PSORN52D",58,0)
 F  S TYPE=$O(PSOANSQ(PSOX("IRXN"),TYPE)) Q:TYPE=""  D
"RTN","PSORN52D",59,0)
 . I TYPE="VEH" S $P(DATA,U,2)=PSOANSQ(PSOX("IRXN"),"VEH")
"RTN","PSORN52D",60,0)
 . I TYPE="RAD" S $P(DATA,U,3)=PSOANSQ(PSOX("IRXN"),"RAD")
"RTN","PSORN52D",61,0)
 . I TYPE="PGW" S $P(DATA,U,5)=PSOANSQ(PSOX("IRXN"),"PGW")
"RTN","PSORN52D",62,0)
 . I TYPE="MST" S $P(DATA,U,6)=PSOANSQ(PSOX("IRXN"),"MST")
"RTN","PSORN52D",63,0)
 . I TYPE="HNC" S $P(DATA,U,7)=PSOANSQ(PSOX("IRXN"),"HNC")
"RTN","PSORN52D",64,0)
 . I TYPE="CV" S $P(DATA,U,8)=PSOANSQ(PSOX("IRXN"),"CV")
"RTN","PSORN52D",65,0)
 . I TYPE="SHAD" S $P(DATA,U,9)=PSOANSQ(PSOX("IRXN"),"SHAD")
"RTN","PSORN52D",66,0)
 I $O(PSORX("ICD","")) F D=1:1:8 Q:'$D(PSORX("ICD",D))  S $P(DATA,"^")=PSORX("ICD",D) D
"RTN","PSORN52D",67,0)
 . S ^PSRX(PSOX("IRXN"),"ICD",D,0)=DATA,$P(DATA,"^")="",^PSRX(PSOX("IRXN"),"ICD",0)="^52.052311P^"_D_"^"_D
"RTN","PSORN52D",68,0)
 . S:PSORX("ICD",D)'="" ^PSRX(PSOX("IRXN"),"ICD","B",PSORX("ICD",D),D)=""
"RTN","PSORN52D",69,0)
 E  S ^PSRX(PSOX("IRXN"),"ICD",0)="^52.052311P^1^1",^PSRX(PSOX("IRXN"),"ICD",1,0)=$G(DATA)
"RTN","PSORN52D",70,0)
 I PSOSCP<50&(($TR(DATA,"^")'=""))&(($P($G(^PS(53,+$G(PSOPATST),0)),"^",7)'=1)) D
"RTN","PSORN52D",71,0)
 .S DATA1=$G(PSOANSQ("SC"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"MST"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"VEH"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"RAD"))
"RTN","PSORN52D",72,0)
 .S DATA1=DATA1_"^"_$G(PSOANSQ(PSOX("IRXN"),"PGW"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"HNC"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"CV"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"SHAD"))
"RTN","PSORN52D",73,0)
 .S:($TR(DATA1,"^")'="") ^PSRX(PSOX("IRXN"),"IBQ")=DATA1
"RTN","PSORN52D",74,0)
 K PSORX("ICD")
"RTN","PSORN52D",75,0)
 Q
"RTN","PSORN52D",76,0)
 ;
"RTN","PSORN52D",77,0)
RESET ;called from reset copay status PSOCPC
"RTN","PSORN52D",78,0)
 ;Must be available at this point:  PSODA, PSOIBQ=SC^MST^AO^IR^EC^HNC^CV^SHAD
"RTN","PSORN52D",79,0)
 Q:'$D(PSODA)!('$D(PSOIBQ))
"RTN","PSORN52D",80,0)
 Q:'$D(^PSRX(PSODA))
"RTN","PSORN52D",81,0)
 ;Q:'$D(^PSRX(PSODA,"ICD"))  ;if old Rx and no ICD's defined; don't set
"RTN","PSORN52D",82,0)
 N I,DATA,PSOICD
"RTN","PSORN52D",83,0)
 S:$D(^PSRX(PSODA,"ICD")) PSOICD=1
"RTN","PSORN52D",84,0)
 I '$G(DFN) S DFN=$$GET1^DIQ(52,PSODA_",",2,"I")
"RTN","PSORN52D",85,0)
 S DATA="^^^^^^^^"
"RTN","PSORN52D",86,0)
 F I=1:1:8 D
"RTN","PSORN52D",87,0)
 . I I=1 S $P(DATA,"^",4)=$P(PSOIBQ,"^",I)
"RTN","PSORN52D",88,0)
 . I I=2 S $P(DATA,"^",6)=$P(PSOIBQ,"^",I)
"RTN","PSORN52D",89,0)
 . I I=3 S $P(DATA,"^",2)=$P(PSOIBQ,"^",I)
"RTN","PSORN52D",90,0)
 . I I=4 S $P(DATA,"^",3)=$P(PSOIBQ,"^",I)
"RTN","PSORN52D",91,0)
 . I I=5 S $P(DATA,"^",5)=$P(PSOIBQ,"^",I)
"RTN","PSORN52D",92,0)
 . I I=6 S $P(DATA,"^",7)=$P(PSOIBQ,"^",I)
"RTN","PSORN52D",93,0)
 . I I=7 S $P(DATA,"^",8)=$P(PSOIBQ,"^",I)
"RTN","PSORN52D",94,0)
 . I I=8 S $P(DATA,"^",9)=$P(PSOIBQ,"^",I)
"RTN","PSORN52D",95,0)
 I $G(PSOICD) S I=0 F  S I=$O(^PSRX(PSODA,"ICD",I)) Q:I=""!(I'?1N.NN)  D
"RTN","PSORN52D",96,0)
 . Q:'$D(^PSRX(PSODA,"ICD",I,0))
"RTN","PSORN52D",97,0)
 . S $P(^PSRX(PSODA,"ICD",I,0),"^",2,9)=$P(DATA,"^",2,9)
"RTN","PSORN52D",98,0)
 ; for pre-cidc RX
"RTN","PSORN52D",99,0)
 I '$G(PSOICD) S ^PSRX(PSODA,"ICD",1,0)="^"_$P(DATA,"^",2,9),^PSRX(PSODA,"ICD",0)="^52.052311P^1^1"
"RTN","PSORN52D",100,0)
 Q
"RTN","PSORN52D",101,0)
 ;
"RTN","PSORN52D",102,0)
SCP ;Called from multiple routines - DFN or PSODFN variable must be available to call this subroutine.
"RTN","PSORN52D",103,0)
 I '$G(DFN) S DFN=+$G(PSODFN)
"RTN","PSORN52D",104,0)
 D ELIG^VADPT S PSOANSQ("SC>50")="",(PSOSCA,PSOSCP)="",PSOSCP=$P(VAEL(3),U,2)
"RTN","PSORN52D",105,0)
 S:PSOSCP=""&($P(VAEL(3),U)=1) PSOSCP=0
"RTN","PSORN52D",106,0)
 S PSOSCA=$$SC^SDCO22(DFN)
"RTN","PSORN52D",107,0)
 K VAEL
"RTN","PSORN52D",108,0)
 Q
"RTN","PSORN52D",109,0)
SHAD ;
"RTN","PSORN52D",110,0)
 N XX
"RTN","PSORN52D",111,0)
 I $P($G(PSOPIBQ),U,8)]"" S XX=$P(PSOPIBQ,U,8) I XX=0!(XX=1) S PSOANSQ(PSOX("IRXN"),"SHAD")=XX Q
"RTN","PSORN52D",112,0)
 I $P($G(^PSRX(RXN,"ICD",1,0)),U,9)]"" S XX=$P($G(^PSRX(PSOX("IRXN"),"ICD",1,0)),U,9) S:XX=0!(XX=1) PSOANSQ(PSOX("IRXN"),"SHAD")=XX
"RTN","PSORN52D",113,0)
 Q
"RTN","PSORN52D",114,0)
 ;
"RTN","PSORN52D",115,0)
SET3 ;for when patient status is exempt or SC>50
"RTN","PSORN52D",116,0)
 N PSOPATST S PSOPATST=PSORX("PATIENT STATUS")
"RTN","PSORN52D",117,0)
 I PSORX("PATIENT STATUS")'?1N.N S PSOPATST="",PSOPATST=$O(^PS(53,"B",PSORX("PATIENT STATUS"),PSOPATST))
"RTN","PSORN52D",118,0)
 F JJJ=2:1:9 I $P(PSOOICD,"^",JJJ)=0!($P(PSOOICD,"^",JJJ)=1) D
"RTN","PSORN52D",119,0)
 . I JJJ=2 S PSORX(PSOIBOLD,"VEH")=$P(PSOOICD,"^",JJJ)
"RTN","PSORN52D",120,0)
 . I JJJ=3 S PSORX(PSOIBOLD,"RAD")=$P(PSOOICD,"^",JJJ)
"RTN","PSORN52D",121,0)
 . I JJJ=4 D
"RTN","PSORN52D",122,0)
 .. S:PSOSCP<50 PSORX(PSOIBOLD,"SC")=$P(PSOOICD,"^",JJJ)
"RTN","PSORN52D",123,0)
 .. S:PSOSCP>49!($P($G(^PS(53,+$G(PSOPATST),0)),"^",7)=1) PSORX(PSOIBOLD,"SC>50")=$P(PSOOICD,"^",JJJ)
"RTN","PSORN52D",124,0)
 . I JJJ=5 S PSORX(PSOIBOLD,"PGW")=$P(PSOOICD,"^",JJJ)
"RTN","PSORN52D",125,0)
 . I JJJ=6 S PSORX(PSOIBOLD,"MST")=$P(PSOOICD,"^",JJJ)
"RTN","PSORN52D",126,0)
 . I JJJ=7 S PSORX(PSOIBOLD,"HNC")=$P(PSOOICD,"^",JJJ)
"RTN","PSORN52D",127,0)
 . I JJJ=8 S PSORX(PSOIBOLD,"CV")=$P(PSOOICD,"^",JJJ)
"RTN","PSORN52D",128,0)
 . I JJJ=9 S PSORX(PSOIBOLD,"SHAD")=$P(PSOOICD,"^",JJJ)
"RTN","PSORN52D",129,0)
 K JJJ,PSOOICD
"RTN","PSORN52D",130,0)
 Q
"UP",52,52.052311,-1)
52^ICD
"UP",52,52.052311,0)
52.052311
"UP",52.41,52.41311,-1)
52.41^ICD
"UP",52.41,52.41311,0)
52.41311
"VER")
8.0^22.0
"^DD",52,52,120,0)
SOUTHWEST ASIA CONDITIONS^S^0:NO;1:YES;^IBQ;5^Q
"^DD",52,52,120,3)
Enter 'Yes' if this prescription is being used to treat a condition related to service in Southwest Asia.
"^DD",52,52,120,21,0)
^^11^11^3060627^
"^DD",52,52,120,21,1,0)
During Outpatient Pharmacy order entry, if a veteran has been identified
"^DD",52,52,120,21,2,0)
as having been exposed to Southwest Asia Conditions (formerly referred to
"^DD",52,52,120,21,3,0)
as Environmental Contaminants), the pharmacist may be asked to identify
"^DD",52,52,120,21,4,0)
whether or not the medication prescribed is being used to treat a
"^DD",52,52,120,21,5,0)
condition due to this exposure. This field will store the pharmacist's
"^DD",52,52,120,21,6,0)
response to this question. The value in this field will be used to
"^DD",52,52,120,21,7,0)
evaluate whether or not a copay should be applied to the prescription.
"^DD",52,52,120,21,8,0)
This value will also be used as a default should this question be raised
"^DD",52,52,120,21,9,0)
again during the life of the prescription when a prescription fill is
"^DD",52,52,120,21,10,0)
being released, or as the default for the question upon renewal of the
"^DD",52,52,120,21,11,0)
prescription through CPRS or Outpatient Pharmacy.
"^DD",52,52,120,"DT")
3060627
"^DD",52,52,122.01,0)
PROJ 112/SHAD^S^0:NO;1:YES;^IBQ;8^Q
"^DD",52,52,122.01,3)
Enter 'Yes' if this prescription is being used to treat a condition related to PROJ 112/SHAD
"^DD",52,52,122.01,21,0)
^^7^7^3060117^
"^DD",52,52,122.01,21,1,0)
During Outpatient Pharmacy order entry, a pharmacist may be asked if the
"^DD",52,52,122.01,21,2,0)
medication being prescribed is for a condition related to PROJ 112/SHAD
"^DD",52,52,122.01,21,3,0)
while in the military. This field will store the pharmacist's response to
"^DD",52,52,122.01,21,4,0)
this question. The value in this field will be used to evaluate whether or
"^DD",52,52,122.01,21,5,0)
not a copay should be applied to the prescription. This value will also be
"^DD",52,52,122.01,21,6,0)
used as a default should this question be raised again during the life of
"^DD",52,52,122.01,21,7,0)
the prescription.
"^DD",52,52,122.01,"DT")
3060117
"^DD",52,52.052311,4,0)
SOUTHWEST ASIA CONDITIONS^S^0:NO;1:YES;^0;5^Q
"^DD",52,52.052311,4,3)
ENTER YES OR NO.
"^DD",52,52.052311,4,21,0)
^^2^2^3060626^
"^DD",52,52.052311,4,21,1,0)
This field is used to directly identify the corresponding ICD-9 code in the
"^DD",52,52.052311,4,21,2,0)
.01 field as related to Southwest Asia Conditions for 3rd Party Billing.
"^DD",52,52.052311,4,"DT")
3060626
"^DD",52,52.052311,8,0)
PROJ 112/SHAD^S^0:NO;1:YES;^0;9^Q
"^DD",52,52.052311,8,3)
ENTER YES OR NO.
"^DD",52,52.052311,8,21,0)
^^2^2^3060117^
"^DD",52,52.052311,8,21,1,0)
This field is used to directly identify the corresponding ICD-9 code in
"^DD",52,52.052311,8,21,2,0)
the .01 field as related to PROJ 112/SHAD for 3rd Party Billing.
"^DD",52,52.052311,8,"DT")
3060117
"^DD",52.41,52.41,33,0)
DATE/TIME FLAGGED^D^^FLG;1^S %DT="ETX" D ^%DT S X=Y K:X<1 X
"^DD",52.41,52.41,33,3)
Enter the date/time this order was flagged.
"^DD",52.41,52.41,33,21,0)
^^1^1^3080226^
"^DD",52.41,52.41,33,21,1,0)
This is the date/time when this order was flagged.
"^DD",52.41,52.41,33,"DT")
3080226
"^DD",52.41,52.41,34,0)
FLAGGED BY^P200'^VA(200,^FLG;2^Q
"^DD",52.41,52.41,34,3)
Enter the name of the person who flagged this order
"^DD",52.41,52.41,34,21,0)
^^1^1^3080226^
"^DD",52.41,52.41,34,21,1,0)
This is the user who flagged this order.
"^DD",52.41,52.41,34,"DT")
3080226
"^DD",52.41,52.41,35,0)
REASON FOR FLAG^F^^FLG;3^K:$L(X)>80!($L(X)<1) X
"^DD",52.41,52.41,35,3)
Answer must be 1-80 characters in length
"^DD",52.41,52.41,35,"DT")
3080226
"^DD",52.41,52.41,36,0)
DATE/TIME UNFLAGGED^D^^FLG;4^S %DT="ETX" D ^%DT S X=Y K:X<1 X
"^DD",52.41,52.41,36,3)
Enter the date/time this order was unflagged
"^DD",52.41,52.41,36,21,0)
^^1^1^3080226^
"^DD",52.41,52.41,36,21,1,0)
This is the date/time this order was unflagged.
"^DD",52.41,52.41,36,"DT")
3080226
"^DD",52.41,52.41,37,0)
UNFLAGGED BY^P200'^VA(200,^FLG;5^Q
"^DD",52.41,52.41,37,3)
Enter the name of the person who unflagged this order
"^DD",52.41,52.41,37,21,0)
^^1^1^3080226^
"^DD",52.41,52.41,37,21,1,0)
This is the user who unflagged this order.
"^DD",52.41,52.41,37,"DT")
3080226
"^DD",52.41,52.41,38,0)
REASON FOR UNFLAG^F^^FLG;6^K:$L(X)>80!($L(X)<1) X
"^DD",52.41,52.41,38,3)
Answer must be 1-80 characters in length
"^DD",52.41,52.41,38,21,0)
^^1^1^3080226^
"^DD",52.41,52.41,38,21,1,0)
This is the reason for unflagging this order, usually a response to the reason for flag.
"^DD",52.41,52.41,38,"DT")
3080226
"^DD",52.41,52.41,109,0)
SOUTHWEST ASIA CONDITIONS^S^0:NO;1:YES;^IBQ;4^Q
"^DD",52.41,52.41,109,3)
Enter 'Yes' if this prescription is being used to treat a condition related to service in Southwest Asia.
"^DD",52.41,52.41,109,21,0)
^^8^8^3060626^
"^DD",52.41,52.41,109,21,1,0)
During CPRS order entry, if a veteran has been identified as having been
"^DD",52.41,52.41,109,21,2,0)
exposed to Southwest Asia Conditions during the Persian Gulf War, the
"^DD",52.41,52.41,109,21,3,0)
clinician will be asked to identify whether or not the outpatient
"^DD",52.41,52.41,109,21,4,0)
medication order prescribed is being used to treat a condition due to this
"^DD",52.41,52.41,109,21,5,0)
exposure. This field will store the response that was entered for this
"^DD",52.41,52.41,109,21,6,0)
question. This value will be used as the default value for the same prompt
"^DD",52.41,52.41,109,21,7,0)
presented to the pharmacist when finishing the medication order that was
"^DD",52.41,52.41,109,21,8,0)
entered through CPRS.
"^DD",52.41,52.41,109,"DT")
3060626
"^DD",52.41,52.41,110.2,0)
PROJ 112/SHAD^S^0:NO;1:YES;^IBQ;7^Q
"^DD",52.41,52.41,110.2,3)
Enter 'Yes' if this prescription is being used to treat a condition related to PROJ 112/SHAD.
"^DD",52.41,52.41,110.2,21,0)
^^8^8^3060117^
"^DD",52.41,52.41,110.2,21,1,0)
During CPRS order entry, if a veteran has been identified as having been
"^DD",52.41,52.41,110.2,21,2,0)
treated for a condition related to PROJ 112/SHAD, the clinician will be 
"^DD",52.41,52.41,110.2,21,3,0)
asked to identify whether or not the outpatient medication order being 
"^DD",52.41,52.41,110.2,21,4,0)
prescribed is being used to treat a condition related to PROJ 112/SHAD. 
"^DD",52.41,52.41,110.2,21,5,0)
This field will store the response that was entered for this question.  
"^DD",52.41,52.41,110.2,21,6,0)
This value will be used as the default value for the same prompt presented
"^DD",52.41,52.41,110.2,21,7,0)
to the pharmacist when finishing the medication order that was entered
"^DD",52.41,52.41,110.2,21,8,0)
through CPRS.
"^DD",52.41,52.41,110.2,"DT")
3060117
"^DD",52.41,52.41311,4,0)
SOUTHWEST ASIA CONDITIONS^S^0:NO;1:YES;^0;5^Q
"^DD",52.41,52.41311,4,3)
ENTER YES OR NO.
"^DD",52.41,52.41311,4,21,0)
^^2^2^3060628^
"^DD",52.41,52.41311,4,21,1,0)
This field is used to directly identify the corresponding ICD-9 code in the
"^DD",52.41,52.41311,4,21,2,0)
.01 field as related to Southwest Asia Conditions for 3rd Party Billing.
"^DD",52.41,52.41311,4,"DT")
3060628
"^DD",52.41,52.41311,8,0)
PROJ 112/SHAD^S^0:NO;1:YES;^0;9^Q
"^DD",52.41,52.41311,8,3)
ENTER YES OR NO.
"^DD",52.41,52.41311,8,21,0)
^^2^2^3060117^
"^DD",52.41,52.41311,8,21,1,0)
This field is used directly to identify the corresponding ICD-9 code in
"^DD",52.41,52.41311,8,21,2,0)
the .01 field as related to PROJ 112/SHAD for 3rd Party Billing.
"^DD",52.41,52.41311,8,"DT")
3060117
**INSTALL NAME**
OR*3.0*243
"BLD",17574,0)
OR*3.0*243^ORDER ENTRY/RESULTS REPORTING^0^3080618^y
"BLD",17574,4,0)
^9.64PA^101.43^6
"BLD",17574,4,100,0)
100
"BLD",17574,4,100,2,0)
^9.641^100.008^2
"BLD",17574,4,100,2,100,0)
ORDER  (File-top level)
"BLD",17574,4,100,2,100,1,0)
^9.6411^39^6
"BLD",17574,4,100,2,100,1,39,0)
LAPSED DATE/TIME
"BLD",17574,4,100,2,100,1,55,0)
SOUTHWEST ASIA CONDITIONS
"BLD",17574,4,100,2,100,1,58,0)
SHIPBOARD HAZARD
"BLD",17574,4,100,2,100,1,94,0)
BA SOUTHWEST ASIA CONDITIONS
"BLD",17574,4,100,2,100,1,97,0)
PFSS ACCOUNT REFERENCE
"BLD",17574,4,100,2,100,1,98,0)
BA SHIPBOARD HAZARD
"BLD",17574,4,100,2,100.008,0)
ORDER ACTIONS  (sub-file)
"BLD",17574,4,100,2,100.008,1,0)
^9.6411^15^2
"BLD",17574,4,100,2,100.008,1,4,0)
SIGNATURE STATUS
"BLD",17574,4,100,2,100.008,1,15,0)
RELEASE STATUS
"BLD",17574,4,100,222)
y^y^p^^^^n^^n
"BLD",17574,4,100,224)

"BLD",17574,4,100.2,0)
100.2
"BLD",17574,4,100.2,2,0)
^9.641^100.2^2
"BLD",17574,4,100.2,2,100.2,0)
OE/RR PATIENT EVENT  (File-top level)
"BLD",17574,4,100.2,2,100.2,1,0)
^9.6411^14^1
"BLD",17574,4,100.2,2,100.2,1,14,0)
SURGERY
"BLD",17574,4,100.2,2,100.25,0)
ACTIVITY  (sub-file)
"BLD",17574,4,100.2,2,100.25,1,0)
^9.6411^4^1
"BLD",17574,4,100.2,2,100.25,1,4,0)
EVENT TYPE
"BLD",17574,4,100.2,222)
y^y^p^^^^n^^n
"BLD",17574,4,100.2,224)

"BLD",17574,4,100.21,0)
100.21
"BLD",17574,4,100.21,222)
y^y^f^^^^n^^n
"BLD",17574,4,100.21,224)

"BLD",17574,4,101.24,0)
101.24
"BLD",17574,4,101.24,222)
y^n^f^^y^^y^r^n
"BLD",17574,4,101.24,224)
I (Y=3)!((Y>17)&(Y<28))!(Y>999)!(Y=48)
"BLD",17574,4,101.41,0)
101.41
"BLD",17574,4,101.41,222)
n^n^f^^y^^y^r^n
"BLD",17574,4,101.41,224)
I $$SENDDLG^ORY243($P(^(0),U))
"BLD",17574,4,101.43,0)
101.43
"BLD",17574,4,101.43,222)
y^y^f^^^^n
"BLD",17574,4,"APDD",100,100)

"BLD",17574,4,"APDD",100,100,39)

"BLD",17574,4,"APDD",100,100,55)

"BLD",17574,4,"APDD",100,100,58)

"BLD",17574,4,"APDD",100,100,94)

"BLD",17574,4,"APDD",100,100,97)

"BLD",17574,4,"APDD",100,100,98)

"BLD",17574,4,"APDD",100,100.008)

"BLD",17574,4,"APDD",100,100.008,4)

"BLD",17574,4,"APDD",100,100.008,15)

"BLD",17574,4,"APDD",100.2,100.2)

"BLD",17574,4,"APDD",100.2,100.2,14)

"BLD",17574,4,"APDD",100.2,100.25)

"BLD",17574,4,"APDD",100.2,100.25,4)

"BLD",17574,4,"B",100,100)

"BLD",17574,4,"B",100.2,100.2)

"BLD",17574,4,"B",100.21,100.21)

"BLD",17574,4,"B",101.24,101.24)

"BLD",17574,4,"B",101.41,101.41)

"BLD",17574,4,"B",101.43,101.43)

"BLD",17574,6.3)
242
"BLD",17574,"ABPKG")
n
"BLD",17574,"INI")
PRE^ORY243
"BLD",17574,"INID")
^n^n
"BLD",17574,"INIT")
POST^ORY243
"BLD",17574,"KRN",0)
^9.67PA^8989.52^19
"BLD",17574,"KRN",.4,0)
.4
"BLD",17574,"KRN",.401,0)
.401
"BLD",17574,"KRN",.402,0)
.402
"BLD",17574,"KRN",.403,0)
.403
"BLD",17574,"KRN",.5,0)
.5
"BLD",17574,"KRN",.84,0)
.84
"BLD",17574,"KRN",.84,"NM",0)
^9.68A^^
"BLD",17574,"KRN",3.6,0)
3.6
"BLD",17574,"KRN",3.8,0)
3.8
"BLD",17574,"KRN",9.2,0)
9.2
"BLD",17574,"KRN",9.2,"NM",0)
^9.68A^8^8
"BLD",17574,"KRN",9.2,"NM",1,0)
ORBA-SHD^^0
"BLD",17574,"KRN",9.2,"NM",2,0)
ORBA-SC^^0
"BLD",17574,"KRN",9.2,"NM",3,0)
ORBA-MST^^0
"BLD",17574,"KRN",9.2,"NM",4,0)
ORBA-IR^^0
"BLD",17574,"KRN",9.2,"NM",5,0)
ORBA-HNC^^0
"BLD",17574,"KRN",9.2,"NM",6,0)
ORBA-EC^^0
"BLD",17574,"KRN",9.2,"NM",7,0)
ORBA-CV^^0
"BLD",17574,"KRN",9.2,"NM",8,0)
ORBA-AO^^0
"BLD",17574,"KRN",9.2,"NM","B","ORBA-AO",8)

"BLD",17574,"KRN",9.2,"NM","B","ORBA-CV",7)

"BLD",17574,"KRN",9.2,"NM","B","ORBA-EC",6)

"BLD",17574,"KRN",9.2,"NM","B","ORBA-HNC",5)

"BLD",17574,"KRN",9.2,"NM","B","ORBA-IR",4)

"BLD",17574,"KRN",9.2,"NM","B","ORBA-MST",3)

"BLD",17574,"KRN",9.2,"NM","B","ORBA-SC",2)

"BLD",17574,"KRN",9.2,"NM","B","ORBA-SHD",1)

"BLD",17574,"KRN",9.8,0)
9.8
"BLD",17574,"KRN",9.8,"NM",0)
^9.68A^218^210
"BLD",17574,"KRN",9.8,"NM",1,0)
ORBCMA32^^0^B85583831
"BLD",17574,"KRN",9.8,"NM",2,0)
ORWDPS32^^0^B70700114
"BLD",17574,"KRN",9.8,"NM",3,0)
ORWDGX^^0^B5976236
"BLD",17574,"KRN",9.8,"NM",4,0)
ORWDOR^^0^B8588372
"BLD",17574,"KRN",9.8,"NM",5,0)
ORWDLR^^0^B25735868
"BLD",17574,"KRN",9.8,"NM",6,0)
ORWDLR32^^0^B60083103
"BLD",17574,"KRN",9.8,"NM",7,0)
ORWDLR33^^0^B20970855
"BLD",17574,"KRN",9.8,"NM",8,0)
ORWDPS1^^0^B49131928
"BLD",17574,"KRN",9.8,"NM",9,0)
ORCDLR^^0^B57494194
"BLD",17574,"KRN",9.8,"NM",10,0)
ORCDPS3^^0^B43323695
"BLD",17574,"KRN",9.8,"NM",11,0)
ORBCMA1^^0^B16067541
"BLD",17574,"KRN",9.8,"NM",12,0)
ORCDPS2^^0^B67090529
"BLD",17574,"KRN",9.8,"NM",13,0)
ORPRPM^^0^B62635453
"BLD",17574,"KRN",9.8,"NM",14,0)
ORWDXR^^0^B48540055
"BLD",17574,"KRN",9.8,"NM",15,0)
ORWDXA^^0^B73502300
"BLD",17574,"KRN",9.8,"NM",16,0)
ORCXPND1^^0^B72217223
"BLD",17574,"KRN",9.8,"NM",17,0)
ORCSEND^^0^B63497942
"BLD",17574,"KRN",9.8,"NM",18,0)
ORCACT2^^0^B61910854
"BLD",17574,"KRN",9.8,"NM",19,0)
ORWDX1^^0^B51089138
"BLD",17574,"KRN",9.8,"NM",21,0)
ORWPS^^0^B62358507
"BLD",17574,"KRN",9.8,"NM",22,0)
ORCSEND1^^0^B61198784
"BLD",17574,"KRN",9.8,"NM",23,0)
ORDDPAPI^^0^B1521511
"BLD",17574,"KRN",9.8,"NM",24,0)
ORCDLR2^^0^B13639155
"BLD",17574,"KRN",9.8,"NM",25,0)
ORPEAPI^^0^B385487
"BLD",17574,"KRN",9.8,"NM",26,0)
ORCHECK^^0^B47055177
"BLD",17574,"KRN",9.8,"NM",27,0)
ORQQAL^^0^B28169891
"BLD",17574,"KRN",9.8,"NM",28,0)
ORWDAL32^^0^B40874191
"BLD",17574,"KRN",9.8,"NM",29,0)
ORWDXC^^0^B22991536
"BLD",17574,"KRN",9.8,"NM",30,0)
ORWDVAL^^0^B2573377
"BLD",17574,"KRN",9.8,"NM",31,0)
ORY243^^0^B79494059
"BLD",17574,"KRN",9.8,"NM",32,0)
ORMBLDRA^^0^B9959617
"BLD",17574,"KRN",9.8,"NM",33,0)
ORMRA^^0^B62066557
"BLD",17574,"KRN",9.8,"NM",34,0)
ORPRF^^0^B13135968
"BLD",17574,"KRN",9.8,"NM",36,0)
ORCDPSIV^^0^B96443893
"BLD",17574,"KRN",9.8,"NM",37,0)
ORQ12^^0^B36656064
"BLD",17574,"KRN",9.8,"NM",39,0)
ORWDBA1^^0^B58828931
"BLD",17574,"KRN",9.8,"NM",40,0)
ORWDBA3^^0^B40638555
"BLD",17574,"KRN",9.8,"NM",41,0)
ORWDBA4^^0^B10113870
"BLD",17574,"KRN",9.8,"NM",42,0)
ORWDBA7^^0^B17868873
"BLD",17574,"KRN",9.8,"NM",44,0)
ORWDPS4^^0^B20050046
"BLD",17574,"KRN",9.8,"NM",45,0)
ORCSAVE2^^0^B68713994
"BLD",17574,"KRN",9.8,"NM",46,0)
ORQ21^^0^B35097340
"BLD",17574,"KRN",9.8,"NM",47,0)
ORWOR^^0^B35518390
"BLD",17574,"KRN",9.8,"NM",48,0)
ORYDLG^^0^B14515305
"BLD",17574,"KRN",9.8,"NM",49,0)
ORQQPL1^^0^B62886431
"BLD",17574,"KRN",9.8,"NM",50,0)
ORWPCE^^0^B56892321
"BLD",17574,"KRN",9.8,"NM",51,0)
ORWPCE1^^0^B63376274
"BLD",17574,"KRN",9.8,"NM",52,0)
ORWTIU^^0^B10078381
"BLD",17574,"KRN",9.8,"NM",53,0)
ORMPS^^0^B79586894
"BLD",17574,"KRN",9.8,"NM",54,0)
ORMPS2^^0^B46355925
"BLD",17574,"KRN",9.8,"NM",55,0)
ORQQPL3^^0^B55317795
"BLD",17574,"KRN",9.8,"NM",56,0)
ORWDXVB^^0^B43771926
"BLD",17574,"KRN",9.8,"NM",57,0)
ORWTPT^^0^B20925260
"BLD",17574,"KRN",9.8,"NM",58,0)
ORQPTQ1^^0^B54791820
"BLD",17574,"KRN",9.8,"NM",59,0)
ORWTPL^^0^B25081990
"BLD",17574,"KRN",9.8,"NM",60,0)
ORWTPP^^0^B19368874
"BLD",17574,"KRN",9.8,"NM",61,0)
ORCSAVE^^0^B70416179
"BLD",17574,"KRN",9.8,"NM",62,0)
ORWDX^^0^B62342605
"BLD",17574,"KRN",9.8,"NM",63,0)
ORWDX2^^0^B12248764
"BLD",17574,"KRN",9.8,"NM",64,0)
ORLSTVIZ^^0^B5546292
"BLD",17574,"KRN",9.8,"NM",65,0)
ORWU^^0^B60173136
"BLD",17574,"KRN",9.8,"NM",66,0)
ORALWORD^^0^B47499175
"BLD",17574,"KRN",9.8,"NM",67,0)
ORQ2^^0^B39956511
"BLD",17574,"KRN",9.8,"NM",68,0)
ORWORR1^^0^B7659282
"BLD",17574,"KRN",9.8,"NM",69,0)
ORBPRCHK^^0^B30311169
"BLD",17574,"KRN",9.8,"NM",70,0)
ORWORR^^0^B66127235
"BLD",17574,"KRN",9.8,"NM",71,0)
ORCDLR1^^0^B81262557
"BLD",17574,"KRN",9.8,"NM",72,0)
ORDV08^^0^B20597537
"BLD",17574,"KRN",9.8,"NM",73,0)
ORMBLDPS^^0^B74740266
"BLD",17574,"KRN",9.8,"NM",74,0)
ORHLESC^^0^B6778413
"BLD",17574,"KRN",9.8,"NM",75,0)
ORMLR^^0^B55346176
"BLD",17574,"KRN",9.8,"NM",76,0)
ORMFH^^0^B63062271
"BLD",17574,"KRN",9.8,"NM",77,0)
ORMGMRC^^0^B44058430
"BLD",17574,"KRN",9.8,"NM",78,0)
ORMPS1^^0^B68866316
"BLD",17574,"KRN",9.8,"NM",79,0)
ORY24301^^0^B71550908
"BLD",17574,"KRN",9.8,"NM",80,0)
ORY24302^^0^B79020665
"BLD",17574,"KRN",9.8,"NM",81,0)
ORY24303^^0^B78469831
"BLD",17574,"KRN",9.8,"NM",82,0)
ORY24304^^0^B86792017
"BLD",17574,"KRN",9.8,"NM",83,0)
ORY24305^^0^B58679499
"BLD",17574,"KRN",9.8,"NM",84,0)
ORY24306^^0^B66782929
"BLD",17574,"KRN",9.8,"NM",85,0)
ORY24307^^0^B70006769
"BLD",17574,"KRN",9.8,"NM",86,0)
ORY24308^^0^B66749787
"BLD",17574,"KRN",9.8,"NM",87,0)
ORY24309^^0^B8754768
"BLD",17574,"KRN",9.8,"NM",88,0)
ORY243ES^^0^B12630447
"BLD",17574,"KRN",9.8,"NM",89,0)
ORY2430^^0^B15644892
"BLD",17574,"KRN",9.8,"NM",90,0)
ORY2431^^0^B40550963
"BLD",17574,"KRN",9.8,"NM",91,0)
ORY2432^^0^B26766774
"BLD",17574,"KRN",9.8,"NM",92,0)
ORY2433^^0^B12996416
"BLD",17574,"KRN",9.8,"NM",93,0)
ORY2434^^0^B13526318
"BLD",17574,"KRN",9.8,"NM",94,0)
ORCSEND3^^0^B25727603
"BLD",17574,"KRN",9.8,"NM",96,0)
ORTSKLPS^^0^B5805034
"BLD",17574,"KRN",9.8,"NM",97,0)
ORWD^^0^B42948340
"BLD",17574,"KRN",9.8,"NM",98,0)
ORQ20^^0^B49432908
"BLD",17574,"KRN",9.8,"NM",99,0)
ORMTIME^^0^B9294457
"BLD",17574,"KRN",9.8,"NM",100,0)
OROVRRPT^^0^B40771295
"BLD",17574,"KRN",9.8,"NM",101,0)
ORMFN^^0^B33381686
"BLD",17574,"KRN",9.8,"NM",102,0)
ORSRCHOR^^0^B77451785
"BLD",17574,"KRN",9.8,"NM",103,0)
ORWDPS33^^0^B31468284
"BLD",17574,"KRN",9.8,"NM",104,0)
ORWNSS^^0^B4680257
"BLD",17574,"KRN",9.8,"NM",105,0)
ORCACT01^^0^B66127888
"BLD",17574,"KRN",9.8,"NM",106,0)
ORCDLG1^^0^B72953104
"BLD",17574,"KRN",9.8,"NM",107,0)
ORCDLG2^^0^B64872872
"BLD",17574,"KRN",9.8,"NM",108,0)
ORCD^^0^B53571666
"BLD",17574,"KRN",9.8,"NM",109,0)
ORCFLAG^^0^B21880963
"BLD",17574,"KRN",9.8,"NM",110,0)
ORKLR^^0^B31162442
"BLD",17574,"KRN",9.8,"NM",111,0)
ORWGRPC^^0^B13989770
"BLD",17574,"KRN",9.8,"NM",112,0)
ORWGTASK^^0^B79728825
"BLD",17574,"KRN",9.8,"NM",113,0)
ORWGAPI^^0^B23670784
"BLD",17574,"KRN",9.8,"NM",114,0)
ORWGAPI1^^0^B30659117
"BLD",17574,"KRN",9.8,"NM",115,0)
ORWGAPI2^^0^B18274252
"BLD",17574,"KRN",9.8,"NM",116,0)
ORWGAPI3^^0^B30105389
"BLD",17574,"KRN",9.8,"NM",117,0)
ORWGAPI4^^0^B60283342
"BLD",17574,"KRN",9.8,"NM",118,0)
ORWGAPI5^^0^B9504422
"BLD",17574,"KRN",9.8,"NM",119,0)
ORWGAPI6^^0^B16567335
"BLD",17574,"KRN",9.8,"NM",120,0)
ORWGAPI7^^0^B6370115
"BLD",17574,"KRN",9.8,"NM",121,0)
ORWGAPI8^^0^B7954497
"BLD",17574,"KRN",9.8,"NM",122,0)
ORWGAPIA^^0^B34887063
"BLD",17574,"KRN",9.8,"NM",123,0)
ORWGAPIB^^0^B3779452
"BLD",17574,"KRN",9.8,"NM",124,0)
ORWGAPIC^^0^B34311571
"BLD",17574,"KRN",9.8,"NM",125,0)
ORWGAPID^^0^B59091643
"BLD",17574,"KRN",9.8,"NM",126,0)
ORWGAPIE^^0^B14227801
"BLD",17574,"KRN",9.8,"NM",127,0)
ORWGAPIF^^0^B5028214
"BLD",17574,"KRN",9.8,"NM",128,0)
ORWGAPIP^^0^B70762744
"BLD",17574,"KRN",9.8,"NM",129,0)
ORWGAPIR^^0^B41364234
"BLD",17574,"KRN",9.8,"NM",130,0)
ORWGAPIT^^0^B57224397
"BLD",17574,"KRN",9.8,"NM",131,0)
ORWGAPIU^^0^B23844957
"BLD",17574,"KRN",9.8,"NM",132,0)
ORWGAPIW^^0^B11947849
"BLD",17574,"KRN",9.8,"NM",133,0)
ORWGAPIX^^0^B23118742
"BLD",17574,"KRN",9.8,"NM",134,0)
ORCDPS1^^0^B74826833
"BLD",17574,"KRN",9.8,"NM",135,0)
ORCDPSH^^0^B17713696
"BLD",17574,"KRN",9.8,"NM",136,0)
ORMTIM02^^0^B17248840
"BLD",17574,"KRN",9.8,"NM",137,0)
ORLPSR^^0^B54297693
"BLD",17574,"KRN",9.8,"NM",138,0)
ORLPSRA^^0^B62257534
"BLD",17574,"KRN",9.8,"NM",139,0)
ORLPSRB^^0^B38794452
"BLD",17574,"KRN",9.8,"NM",140,0)
ORQ11^^0^B63884857
"BLD",17574,"KRN",9.8,"NM",141,0)
ORCACT0^^0^B52518165
"BLD",17574,"KRN",9.8,"NM",142,0)
ORWDXM2^^0^B75208802
"BLD",17574,"KRN",9.8,"NM",143,0)
ORMBLDP1^^0^B3663295
"BLD",17574,"KRN",9.8,"NM",144,0)
ORCACT03^^0^B8066015
"BLD",17574,"KRN",9.8,"NM",145,0)
ORMPS3^^0^B25338633
"BLD",17574,"KRN",9.8,"NM",146,0)
ORWORB^^0^B67054061
"BLD",17574,"KRN",9.8,"NM",147,0)
ORCB^^0^B51269339
"BLD",17574,"KRN",9.8,"NM",148,0)
ORWRP3^^0^B10390812
"BLD",17574,"KRN",9.8,"NM",149,0)
ORIMO^^0^B2288142
"BLD",17574,"KRN",9.8,"NM",150,0)
ORDV04^^0^B57992153
"BLD",17574,"KRN",9.8,"NM",151,0)
ORWRP4V^^0^B25785819
"BLD",17574,"KRN",9.8,"NM",152,0)
ORWRP4P^^0^B6881393
"BLD",17574,"KRN",9.8,"NM",153,0)
ORDV04A^^0^B41731567
"BLD",17574,"KRN",9.8,"NM",154,0)
ORCSAVE1^^0^B30031657
"BLD",17574,"KRN",9.8,"NM",155,0)
ORDV03^^0^B47046777
"BLD",17574,"KRN",9.8,"NM",156,0)
ORCHANGE^^0^B41306460
"BLD",17574,"KRN",9.8,"NM",157,0)
ORCHANG2^^0^B30221469
"BLD",17574,"KRN",9.8,"NM",161,0)
ORQPT^^0^B73861080
"BLD",17574,"KRN",9.8,"NM",162,0)
ORUDPA^^0^B4870592
"BLD",17574,"KRN",9.8,"NM",163,0)
ORWPT^^0^B59655732
"BLD",17574,"KRN",9.8,"NM",164,0)
ORWPT16^^0^B11809182
"BLD",17574,"KRN",9.8,"NM",165,0)
ORWTPUA^^0^B2193311
"BLD",17574,"KRN",9.8,"NM",166,0)
ORWTPR^^0^B16242046
"BLD",17574,"KRN",9.8,"NM",167,0)
ORWGTEST^^0^B8668416
"BLD",17574,"KRN",9.8,"NM",168,0)
ORWDXM1^^0^B76690189
"BLD",17574,"KRN",9.8,"NM",169,0)
OREVNTX^^0^B73719059
"BLD",17574,"KRN",9.8,"NM",170,0)
ORWRP^^0^B77665061
"BLD",17574,"KRN",9.8,"NM",171,0)
ORDVX1^^0^B5290851
"BLD",17574,"KRN",9.8,"NM",172,0)
ORDV02A^^0^B11152192
"BLD",17574,"KRN",9.8,"NM",173,0)
ORWDPS2^^0^B57106070
"BLD",17574,"KRN",9.8,"NM",174,0)
ORWDXVB1^^0^B34643378
"BLD",17574,"KRN",9.8,"NM",175,0)
ORWDFH^^0^B51608431
"BLD",17574,"KRN",9.8,"NM",176,0)
ORDV06^^0^B40307303
"BLD",17574,"KRN",9.8,"NM",177,0)
ORB3FUP1^^0^B64991738
"BLD",17574,"KRN",9.8,"NM",178,0)
ORMEVNT^^0^B75252404
"BLD",17574,"KRN",9.8,"NM",179,0)
ORUTL1^^0^B5293035
"BLD",17574,"KRN",9.8,"NM",180,0)
ORQQPXRM^^0^B18382115
"BLD",17574,"KRN",9.8,"NM",181,0)
ORWTPD^^0^B13966510
"BLD",17574,"KRN",9.8,"NM",182,0)
OR3CONV^^1^
"BLD",17574,"KRN",9.8,"NM",183,0)
OR3CONV1^^1^
"BLD",17574,"KRN",9.8,"NM",184,0)
OR3POST^^1^
"BLD",17574,"KRN",9.8,"NM",185,0)
OREVNTX1^^0^B72373665
"BLD",17574,"KRN",9.8,"NM",186,0)
ORCDFH1^^0^B22101872
"BLD",17574,"KRN",9.8,"NM",187,0)
ORWOD^^0^B64537880
"BLD",17574,"KRN",9.8,"NM",188,0)
ORCMEDT0^^0^B17512805
"BLD",17574,"KRN",9.8,"NM",189,0)
ORWDXM3^^0^B65753115
"BLD",17574,"KRN",9.8,"NM",190,0)
ORB3FUP2^^0^B68246237
"BLD",17574,"KRN",9.8,"NM",191,0)
ORB3LAB^^0^B3813832
"BLD",17574,"KRN",9.8,"NM",192,0)
ORCXPND3^^0^B44348323
"BLD",17574,"KRN",9.8,"NM",193,0)
OCXOCMPV^^0^B62658161
"BLD",17574,"KRN",9.8,"NM",194,0)
OCXOCMP8^^0^B14209872
"BLD",17574,"KRN",9.8,"NM",195,0)
OCXOCMP6^^0^B40637033
"BLD",17574,"KRN",9.8,"NM",196,0)
OCXOCMP^^0^B41613467
"BLD",17574,"KRN",9.8,"NM",197,0)
ORWU2^^0^B22524024
"BLD",17574,"KRN",9.8,"NM",198,0)
OCXSEND^^0^B23135487
"BLD",17574,"KRN",9.8,"NM",199,0)
OCXSEND3^^0^B11211964
"BLD",17574,"KRN",9.8,"NM",200,0)
OCXSEND4^^0^B21759136
"BLD",17574,"KRN",9.8,"NM",201,0)
OCXSEND5^^0^B52984975
"BLD",17574,"KRN",9.8,"NM",202,0)
OCXSEND6^^0^B36540955
"BLD",17574,"KRN",9.8,"NM",203,0)
OCXSEND7^^0^B19892897
"BLD",17574,"KRN",9.8,"NM",204,0)
OCXSEND8^^0^B20772543
"BLD",17574,"KRN",9.8,"NM",205,0)
OCXSENDA^^0^B19003008
"BLD",17574,"KRN",9.8,"NM",206,0)
ORLP^^0^B76319972
"BLD",17574,"KRN",9.8,"NM",207,0)
ORKCHK^^0^B41864853
"BLD",17574,"KRN",9.8,"NM",208,0)
ORY243A^^0^B4754803
"BLD",17574,"KRN",9.8,"NM",209,0)
ORY243R^^0^B5847434
"BLD",17574,"KRN",9.8,"NM",210,0)
ORCMEDT8^^0^B77783054
"BLD",17574,"KRN",9.8,"NM",211,0)
ORWPCE2^^0^B49058348
"BLD",17574,"KRN",9.8,"NM",212,0)
ORWOD1^^0^B30304637
"BLD",17574,"KRN",9.8,"NM",213,0)
ORCMED^^0^B41444759
"BLD",17574,"KRN",9.8,"NM",214,0)
ORDV06A^^0^B7403444
"BLD",17574,"KRN",9.8,"NM",215,0)
ORCMEDT1^^0^B44493328
"BLD",17574,"KRN",9.8,"NM",216,0)
ORWCV^^0^B73405381
"BLD",17574,"KRN",9.8,"NM",217,0)
ORWDXVB2^^0^B24066583
"BLD",17574,"KRN",9.8,"NM",218,0)
ORWCIRN^^0^B9046507
"BLD",17574,"KRN",9.8,"NM","B","OCXOCMP",196)

"BLD",17574,"KRN",9.8,"NM","B","OCXOCMP6",195)

"BLD",17574,"KRN",9.8,"NM","B","OCXOCMP8",194)

"BLD",17574,"KRN",9.8,"NM","B","OCXOCMPV",193)

"BLD",17574,"KRN",9.8,"NM","B","OCXSEND",198)

"BLD",17574,"KRN",9.8,"NM","B","OCXSEND3",199)

"BLD",17574,"KRN",9.8,"NM","B","OCXSEND4",200)

"BLD",17574,"KRN",9.8,"NM","B","OCXSEND5",201)

"BLD",17574,"KRN",9.8,"NM","B","OCXSEND6",202)

"BLD",17574,"KRN",9.8,"NM","B","OCXSEND7",203)

"BLD",17574,"KRN",9.8,"NM","B","OCXSEND8",204)

"BLD",17574,"KRN",9.8,"NM","B","OCXSENDA",205)

"BLD",17574,"KRN",9.8,"NM","B","OR3CONV",182)

"BLD",17574,"KRN",9.8,"NM","B","OR3CONV1",183)

"BLD",17574,"KRN",9.8,"NM","B","OR3POST",184)

"BLD",17574,"KRN",9.8,"NM","B","ORALWORD",66)

"BLD",17574,"KRN",9.8,"NM","B","ORB3FUP1",177)

"BLD",17574,"KRN",9.8,"NM","B","ORB3FUP2",190)

"BLD",17574,"KRN",9.8,"NM","B","ORB3LAB",191)

"BLD",17574,"KRN",9.8,"NM","B","ORBCMA1",11)

"BLD",17574,"KRN",9.8,"NM","B","ORBCMA32",1)

"BLD",17574,"KRN",9.8,"NM","B","ORBPRCHK",69)

"BLD",17574,"KRN",9.8,"NM","B","ORCACT0",141)

"BLD",17574,"KRN",9.8,"NM","B","ORCACT01",105)

"BLD",17574,"KRN",9.8,"NM","B","ORCACT03",144)

"BLD",17574,"KRN",9.8,"NM","B","ORCACT2",18)

"BLD",17574,"KRN",9.8,"NM","B","ORCB",147)

"BLD",17574,"KRN",9.8,"NM","B","ORCD",108)

"BLD",17574,"KRN",9.8,"NM","B","ORCDFH1",186)

"BLD",17574,"KRN",9.8,"NM","B","ORCDLG1",106)

"BLD",17574,"KRN",9.8,"NM","B","ORCDLG2",107)

"BLD",17574,"KRN",9.8,"NM","B","ORCDLR",9)

"BLD",17574,"KRN",9.8,"NM","B","ORCDLR1",71)

"BLD",17574,"KRN",9.8,"NM","B","ORCDLR2",24)

"BLD",17574,"KRN",9.8,"NM","B","ORCDPS1",134)

"BLD",17574,"KRN",9.8,"NM","B","ORCDPS2",12)

"BLD",17574,"KRN",9.8,"NM","B","ORCDPS3",10)

"BLD",17574,"KRN",9.8,"NM","B","ORCDPSH",135)

"BLD",17574,"KRN",9.8,"NM","B","ORCDPSIV",36)

"BLD",17574,"KRN",9.8,"NM","B","ORCFLAG",109)

"BLD",17574,"KRN",9.8,"NM","B","ORCHANG2",157)

"BLD",17574,"KRN",9.8,"NM","B","ORCHANGE",156)

"BLD",17574,"KRN",9.8,"NM","B","ORCHECK",26)

"BLD",17574,"KRN",9.8,"NM","B","ORCMED",213)

"BLD",17574,"KRN",9.8,"NM","B","ORCMEDT0",188)

"BLD",17574,"KRN",9.8,"NM","B","ORCMEDT1",215)

"BLD",17574,"KRN",9.8,"NM","B","ORCMEDT8",210)

"BLD",17574,"KRN",9.8,"NM","B","ORCSAVE",61)

"BLD",17574,"KRN",9.8,"NM","B","ORCSAVE1",154)

"BLD",17574,"KRN",9.8,"NM","B","ORCSAVE2",45)

"BLD",17574,"KRN",9.8,"NM","B","ORCSEND",17)

"BLD",17574,"KRN",9.8,"NM","B","ORCSEND1",22)

"BLD",17574,"KRN",9.8,"NM","B","ORCSEND3",94)

"BLD",17574,"KRN",9.8,"NM","B","ORCXPND1",16)

"BLD",17574,"KRN",9.8,"NM","B","ORCXPND3",192)

"BLD",17574,"KRN",9.8,"NM","B","ORDDPAPI",23)

"BLD",17574,"KRN",9.8,"NM","B","ORDV02A",172)

"BLD",17574,"KRN",9.8,"NM","B","ORDV03",155)

"BLD",17574,"KRN",9.8,"NM","B","ORDV04",150)

"BLD",17574,"KRN",9.8,"NM","B","ORDV04A",153)

"BLD",17574,"KRN",9.8,"NM","B","ORDV06",176)

"BLD",17574,"KRN",9.8,"NM","B","ORDV06A",214)

"BLD",17574,"KRN",9.8,"NM","B","ORDV08",72)

"BLD",17574,"KRN",9.8,"NM","B","ORDVX1",171)

"BLD",17574,"KRN",9.8,"NM","B","OREVNTX",169)

"BLD",17574,"KRN",9.8,"NM","B","OREVNTX1",185)

"BLD",17574,"KRN",9.8,"NM","B","ORHLESC",74)

"BLD",17574,"KRN",9.8,"NM","B","ORIMO",149)

"BLD",17574,"KRN",9.8,"NM","B","ORKCHK",207)

"BLD",17574,"KRN",9.8,"NM","B","ORKLR",110)

"BLD",17574,"KRN",9.8,"NM","B","ORLP",206)

"BLD",17574,"KRN",9.8,"NM","B","ORLPSR",137)

"BLD",17574,"KRN",9.8,"NM","B","ORLPSRA",138)

"BLD",17574,"KRN",9.8,"NM","B","ORLPSRB",139)

"BLD",17574,"KRN",9.8,"NM","B","ORLSTVIZ",64)

"BLD",17574,"KRN",9.8,"NM","B","ORMBLDP1",143)

"BLD",17574,"KRN",9.8,"NM","B","ORMBLDPS",73)

"BLD",17574,"KRN",9.8,"NM","B","ORMBLDRA",32)

"BLD",17574,"KRN",9.8,"NM","B","ORMEVNT",178)

"BLD",17574,"KRN",9.8,"NM","B","ORMFH",76)

"BLD",17574,"KRN",9.8,"NM","B","ORMFN",101)

"BLD",17574,"KRN",9.8,"NM","B","ORMGMRC",77)

"BLD",17574,"KRN",9.8,"NM","B","ORMLR",75)

"BLD",17574,"KRN",9.8,"NM","B","ORMPS",53)

"BLD",17574,"KRN",9.8,"NM","B","ORMPS1",78)

"BLD",17574,"KRN",9.8,"NM","B","ORMPS2",54)

"BLD",17574,"KRN",9.8,"NM","B","ORMPS3",145)

"BLD",17574,"KRN",9.8,"NM","B","ORMRA",33)

"BLD",17574,"KRN",9.8,"NM","B","ORMTIM02",136)

"BLD",17574,"KRN",9.8,"NM","B","ORMTIME",99)

"BLD",17574,"KRN",9.8,"NM","B","OROVRRPT",100)

"BLD",17574,"KRN",9.8,"NM","B","ORPEAPI",25)

"BLD",17574,"KRN",9.8,"NM","B","ORPRF",34)

"BLD",17574,"KRN",9.8,"NM","B","ORPRPM",13)

"BLD",17574,"KRN",9.8,"NM","B","ORQ11",140)

"BLD",17574,"KRN",9.8,"NM","B","ORQ12",37)

"BLD",17574,"KRN",9.8,"NM","B","ORQ2",67)

"BLD",17574,"KRN",9.8,"NM","B","ORQ20",98)

"BLD",17574,"KRN",9.8,"NM","B","ORQ21",46)

"BLD",17574,"KRN",9.8,"NM","B","ORQPT",161)

"BLD",17574,"KRN",9.8,"NM","B","ORQPTQ1",58)

"BLD",17574,"KRN",9.8,"NM","B","ORQQAL",27)

"BLD",17574,"KRN",9.8,"NM","B","ORQQPL1",49)

"BLD",17574,"KRN",9.8,"NM","B","ORQQPL3",55)

"BLD",17574,"KRN",9.8,"NM","B","ORQQPXRM",180)

"BLD",17574,"KRN",9.8,"NM","B","ORSRCHOR",102)

"BLD",17574,"KRN",9.8,"NM","B","ORTSKLPS",96)

"BLD",17574,"KRN",9.8,"NM","B","ORUDPA",162)

"BLD",17574,"KRN",9.8,"NM","B","ORUTL1",179)

"BLD",17574,"KRN",9.8,"NM","B","ORWCIRN",218)

"BLD",17574,"KRN",9.8,"NM","B","ORWCV",216)

"BLD",17574,"KRN",9.8,"NM","B","ORWD",97)

"BLD",17574,"KRN",9.8,"NM","B","ORWDAL32",28)

"BLD",17574,"KRN",9.8,"NM","B","ORWDBA1",39)

"BLD",17574,"KRN",9.8,"NM","B","ORWDBA3",40)

"BLD",17574,"KRN",9.8,"NM","B","ORWDBA4",41)

"BLD",17574,"KRN",9.8,"NM","B","ORWDBA7",42)

"BLD",17574,"KRN",9.8,"NM","B","ORWDFH",175)

"BLD",17574,"KRN",9.8,"NM","B","ORWDGX",3)

"BLD",17574,"KRN",9.8,"NM","B","ORWDLR",5)

"BLD",17574,"KRN",9.8,"NM","B","ORWDLR32",6)

"BLD",17574,"KRN",9.8,"NM","B","ORWDLR33",7)

"BLD",17574,"KRN",9.8,"NM","B","ORWDOR",4)

"BLD",17574,"KRN",9.8,"NM","B","ORWDPS1",8)

"BLD",17574,"KRN",9.8,"NM","B","ORWDPS2",173)

"BLD",17574,"KRN",9.8,"NM","B","ORWDPS32",2)

"BLD",17574,"KRN",9.8,"NM","B","ORWDPS33",103)

"BLD",17574,"KRN",9.8,"NM","B","ORWDPS4",44)

"BLD",17574,"KRN",9.8,"NM","B","ORWDVAL",30)

"BLD",17574,"KRN",9.8,"NM","B","ORWDX",62)

"BLD",17574,"KRN",9.8,"NM","B","ORWDX1",19)

"BLD",17574,"KRN",9.8,"NM","B","ORWDX2",63)

"BLD",17574,"KRN",9.8,"NM","B","ORWDXA",15)

"BLD",17574,"KRN",9.8,"NM","B","ORWDXC",29)

"BLD",17574,"KRN",9.8,"NM","B","ORWDXM1",168)

"BLD",17574,"KRN",9.8,"NM","B","ORWDXM2",142)

"BLD",17574,"KRN",9.8,"NM","B","ORWDXM3",189)

"BLD",17574,"KRN",9.8,"NM","B","ORWDXR",14)

"BLD",17574,"KRN",9.8,"NM","B","ORWDXVB",56)

"BLD",17574,"KRN",9.8,"NM","B","ORWDXVB1",174)

"BLD",17574,"KRN",9.8,"NM","B","ORWDXVB2",217)

"BLD",17574,"KRN",9.8,"NM","B","ORWGAPI",113)

"BLD",17574,"KRN",9.8,"NM","B","ORWGAPI1",114)

"BLD",17574,"KRN",9.8,"NM","B","ORWGAPI2",115)

"BLD",17574,"KRN",9.8,"NM","B","ORWGAPI3",116)

"BLD",17574,"KRN",9.8,"NM","B","ORWGAPI4",117)

"BLD",17574,"KRN",9.8,"NM","B","ORWGAPI5",118)

"BLD",17574,"KRN",9.8,"NM","B","ORWGAPI6",119)

"BLD",17574,"KRN",9.8,"NM","B","ORWGAPI7",120)

"BLD",17574,"KRN",9.8,"NM","B","ORWGAPI8",121)

"BLD",17574,"KRN",9.8,"NM","B","ORWGAPIA",122)

"BLD",17574,"KRN",9.8,"NM","B","ORWGAPIB",123)

"BLD",17574,"KRN",9.8,"NM","B","ORWGAPIC",124)

"BLD",17574,"KRN",9.8,"NM","B","ORWGAPID",125)

"BLD",17574,"KRN",9.8,"NM","B","ORWGAPIE",126)

"BLD",17574,"KRN",9.8,"NM","B","ORWGAPIF",127)

"BLD",17574,"KRN",9.8,"NM","B","ORWGAPIP",128)

"BLD",17574,"KRN",9.8,"NM","B","ORWGAPIR",129)

"BLD",17574,"KRN",9.8,"NM","B","ORWGAPIT",130)

"BLD",17574,"KRN",9.8,"NM","B","ORWGAPIU",131)

"BLD",17574,"KRN",9.8,"NM","B","ORWGAPIW",132)

"BLD",17574,"KRN",9.8,"NM","B","ORWGAPIX",133)

"BLD",17574,"KRN",9.8,"NM","B","ORWGRPC",111)

"BLD",17574,"KRN",9.8,"NM","B","ORWGTASK",112)

"BLD",17574,"KRN",9.8,"NM","B","ORWGTEST",167)

"BLD",17574,"KRN",9.8,"NM","B","ORWNSS",104)

"BLD",17574,"KRN",9.8,"NM","B","ORWOD",187)

"BLD",17574,"KRN",9.8,"NM","B","ORWOD1",212)

"BLD",17574,"KRN",9.8,"NM","B","ORWOR",47)

"BLD",17574,"KRN",9.8,"NM","B","ORWORB",146)

"BLD",17574,"KRN",9.8,"NM","B","ORWORR",70)

"BLD",17574,"KRN",9.8,"NM","B","ORWORR1",68)

"BLD",17574,"KRN",9.8,"NM","B","ORWPCE",50)

"BLD",17574,"KRN",9.8,"NM","B","ORWPCE1",51)

"BLD",17574,"KRN",9.8,"NM","B","ORWPCE2",211)

"BLD",17574,"KRN",9.8,"NM","B","ORWPS",21)

"BLD",17574,"KRN",9.8,"NM","B","ORWPT",163)

"BLD",17574,"KRN",9.8,"NM","B","ORWPT16",164)

"BLD",17574,"KRN",9.8,"NM","B","ORWRP",170)

"BLD",17574,"KRN",9.8,"NM","B","ORWRP3",148)

"BLD",17574,"KRN",9.8,"NM","B","ORWRP4P",152)

"BLD",17574,"KRN",9.8,"NM","B","ORWRP4V",151)

"BLD",17574,"KRN",9.8,"NM","B","ORWTIU",52)

"BLD",17574,"KRN",9.8,"NM","B","ORWTPD",181)

"BLD",17574,"KRN",9.8,"NM","B","ORWTPL",59)

"BLD",17574,"KRN",9.8,"NM","B","ORWTPP",60)

"BLD",17574,"KRN",9.8,"NM","B","ORWTPR",166)

"BLD",17574,"KRN",9.8,"NM","B","ORWTPT",57)

"BLD",17574,"KRN",9.8,"NM","B","ORWTPUA",165)

"BLD",17574,"KRN",9.8,"NM","B","ORWU",65)

"BLD",17574,"KRN",9.8,"NM","B","ORWU2",197)

"BLD",17574,"KRN",9.8,"NM","B","ORY243",31)

"BLD",17574,"KRN",9.8,"NM","B","ORY2430",89)

"BLD",17574,"KRN",9.8,"NM","B","ORY24301",79)

"BLD",17574,"KRN",9.8,"NM","B","ORY24302",80)

"BLD",17574,"KRN",9.8,"NM","B","ORY24303",81)

"BLD",17574,"KRN",9.8,"NM","B","ORY24304",82)

"BLD",17574,"KRN",9.8,"NM","B","ORY24305",83)

"BLD",17574,"KRN",9.8,"NM","B","ORY24306",84)

"BLD",17574,"KRN",9.8,"NM","B","ORY24307",85)

"BLD",17574,"KRN",9.8,"NM","B","ORY24308",86)

"BLD",17574,"KRN",9.8,"NM","B","ORY24309",87)

"BLD",17574,"KRN",9.8,"NM","B","ORY2431",90)

"BLD",17574,"KRN",9.8,"NM","B","ORY2432",91)

"BLD",17574,"KRN",9.8,"NM","B","ORY2433",92)

"BLD",17574,"KRN",9.8,"NM","B","ORY2434",93)

"BLD",17574,"KRN",9.8,"NM","B","ORY243A",208)

"BLD",17574,"KRN",9.8,"NM","B","ORY243ES",88)

"BLD",17574,"KRN",9.8,"NM","B","ORY243R",209)

"BLD",17574,"KRN",9.8,"NM","B","ORYDLG",48)

"BLD",17574,"KRN",19,0)
19
"BLD",17574,"KRN",19,"NM",0)
^9.68A^12^12
"BLD",17574,"KRN",19,"NM",1,0)
OR CPRS GUI CHART^^0
"BLD",17574,"KRN",19,"NM",2,0)
ORLP TEAM LIST VISIBILITY^^0
"BLD",17574,"KRN",19,"NM",3,0)
ORLP TEAM MENU^^2
"BLD",17574,"KRN",19,"NM",4,0)
ORK ORD CHK OVERRIDE REPORT^^0
"BLD",17574,"KRN",19,"NM",5,0)
ORK ORDER CHK MGMT MENU^^2
"BLD",17574,"KRN",19,"NM",6,0)
OR PARAM COORDINATOR MENU^^2
"BLD",17574,"KRN",19,"NM",7,0)
OR LAPSED ORDERS^^0
"BLD",17574,"KRN",19,"NM",8,0)
OR MEDICATION QO CHECKER^^0
"BLD",17574,"KRN",19,"NM",9,0)
ORCM MGMT^^2
"BLD",17574,"KRN",19,"NM",10,0)
OR INPT CLOZAPINE MESSAGE^^0
"BLD",17574,"KRN",19,"NM",11,0)
ORW PARAM GUI^^2
"BLD",17574,"KRN",19,"NM",12,0)
ORB3 ARCHIVE PERIOD^^0
"BLD",17574,"KRN",19,"NM","B","OR CPRS GUI CHART",1)

"BLD",17574,"KRN",19,"NM","B","OR INPT CLOZAPINE MESSAGE",10)

"BLD",17574,"KRN",19,"NM","B","OR LAPSED ORDERS",7)

"BLD",17574,"KRN",19,"NM","B","OR MEDICATION QO CHECKER",8)

"BLD",17574,"KRN",19,"NM","B","OR PARAM COORDINATOR MENU",6)

"BLD",17574,"KRN",19,"NM","B","ORB3 ARCHIVE PERIOD",12)

"BLD",17574,"KRN",19,"NM","B","ORCM MGMT",9)

"BLD",17574,"KRN",19,"NM","B","ORK ORD CHK OVERRIDE REPORT",4)

"BLD",17574,"KRN",19,"NM","B","ORK ORDER CHK MGMT MENU",5)

"BLD",17574,"KRN",19,"NM","B","ORLP TEAM LIST VISIBILITY",2)

"BLD",17574,"KRN",19,"NM","B","ORLP TEAM MENU",3)

"BLD",17574,"KRN",19,"NM","B","ORW PARAM GUI",11)

"BLD",17574,"KRN",19.1,0)
19.1
"BLD",17574,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",17574,"KRN",101,0)
101
"BLD",17574,"KRN",409.61,0)
409.61
"BLD",17574,"KRN",771,0)
771
"BLD",17574,"KRN",870,0)
870
"BLD",17574,"KRN",8989.51,0)
8989.51
"BLD",17574,"KRN",8989.51,"NM",0)
^9.68A^17^17
"BLD",17574,"KRN",8989.51,"NM",1,0)
OR DC REASON LIST^^0
"BLD",17574,"KRN",8989.51,"NM",2,0)
OR MEDS TAB SORT^^0
"BLD",17574,"KRN",8989.51,"NM",3,0)
OR ADMIN TIME HELP TEXT^^0
"BLD",17574,"KRN",8989.51,"NM",4,0)
OR FLAGGED ORD REASONS^^0
"BLD",17574,"KRN",8989.51,"NM",5,0)
OR LAPSE ORDERS^^0
"BLD",17574,"KRN",8989.51,"NM",6,0)
OR LAPSE ORDERS DFLT^^0
"BLD",17574,"KRN",8989.51,"NM",7,0)
OR CLOZ INPT MSG^^0
"BLD",17574,"KRN",8989.51,"NM",8,0)
ORCH CONTEXT MEDS^^0
"BLD",17574,"KRN",8989.51,"NM",9,0)
ORWOR EXPIRED ORDERS^^0
"BLD",17574,"KRN",8989.51,"NM",10,0)
ORWOR WRITE ORDERS LIST^^0
"BLD",17574,"KRN",8989.51,"NM",11,0)
ORWLR LC CHANGED TO WC^^0
"BLD",17574,"KRN",8989.51,"NM",12,0)
OR VBECS SUPPRESS NURS ADMIN^^0
"BLD",17574,"KRN",8989.51,"NM",13,0)
OR USE MH DLL^^0
"BLD",17574,"KRN",8989.51,"NM",14,0)
OR RA RFS CARRY ON^^0
"BLD",17574,"KRN",8989.51,"NM",15,0)
ORWDXVB VBECS TNS CHECK^^0
"BLD",17574,"KRN",8989.51,"NM",16,0)
OR VBECS ON^^0
"BLD",17574,"KRN",8989.51,"NM",17,0)
ORWRP VISTAWEB^^1^
"BLD",17574,"KRN",8989.51,"NM","B","OR ADMIN TIME HELP TEXT",3)

"BLD",17574,"KRN",8989.51,"NM","B","OR CLOZ INPT MSG",7)

"BLD",17574,"KRN",8989.51,"NM","B","OR DC REASON LIST",1)

"BLD",17574,"KRN",8989.51,"NM","B","OR FLAGGED ORD REASONS",4)

"BLD",17574,"KRN",8989.51,"NM","B","OR LAPSE ORDERS",5)

"BLD",17574,"KRN",8989.51,"NM","B","OR LAPSE ORDERS DFLT",6)

"BLD",17574,"KRN",8989.51,"NM","B","OR MEDS TAB SORT",2)

"BLD",17574,"KRN",8989.51,"NM","B","OR RA RFS CARRY ON",14)

"BLD",17574,"KRN",8989.51,"NM","B","OR USE MH DLL",13)

"BLD",17574,"KRN",8989.51,"NM","B","OR VBECS ON",16)

"BLD",17574,"KRN",8989.51,"NM","B","OR VBECS SUPPRESS NURS ADMIN",12)

"BLD",17574,"KRN",8989.51,"NM","B","ORCH CONTEXT MEDS",8)

"BLD",17574,"KRN",8989.51,"NM","B","ORWDXVB VBECS TNS CHECK",15)

"BLD",17574,"KRN",8989.51,"NM","B","ORWLR LC CHANGED TO WC",11)

"BLD",17574,"KRN",8989.51,"NM","B","ORWOR EXPIRED ORDERS",9)

"BLD",17574,"KRN",8989.51,"NM","B","ORWOR WRITE ORDERS LIST",10)

"BLD",17574,"KRN",8989.51,"NM","B","ORWRP VISTAWEB",17)

"BLD",17574,"KRN",8989.52,0)
8989.52
"BLD",17574,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",17574,"KRN",8994,0)
8994
"BLD",17574,"KRN",8994,"NM",0)
^9.68A^71^70
"BLD",17574,"KRN",8994,"NM",1,0)
ORWDX1 DCORIG^^0
"BLD",17574,"KRN",8994,"NM",2,0)
ORWDX1 UNDCORIG^^0
"BLD",17574,"KRN",8994,"NM",3,0)
ORWPS ACTIVE^^0
"BLD",17574,"KRN",8994,"NM",4,0)
ORCDLR2 CHECK ONE LC TO WC^^0
"BLD",17574,"KRN",8994,"NM",5,0)
ORCDLR2 CHECK ALL LC TO WC^^0
"BLD",17574,"KRN",8994,"NM",7,0)
ORWDX1 ORDMATCH^^0
"BLD",17574,"KRN",8994,"NM",8,0)
ORWDPS1 SCHALL^^0
"BLD",17574,"KRN",8994,"NM",9,0)
ORWTIU GET SAVED CP FIELDS^^0
"BLD",17574,"KRN",8994,"NM",10,0)
ORWDXVB SUBCHK^^0
"BLD",17574,"KRN",8994,"NM",11,0)
ORDDPAPI ADMTIME^^0
"BLD",17574,"KRN",8994,"NM",12,0)
ORWDX2 DCREASON^^0
"BLD",17574,"KRN",8994,"NM",13,0)
ORWDPS32 DLGSLCT^^0
"BLD",17574,"KRN",8994,"NM",14,0)
ORWU PARAMS^^0
"BLD",17574,"KRN",8994,"NM",15,0)
ORALWORD ALLWORD^^0
"BLD",17574,"KRN",8994,"NM",16,0)
ORWDPS1 DOWSCH^^0
"BLD",17574,"KRN",8994,"NM",17,0)
ORWDPS32 DOSES^^0
"BLD",17574,"KRN",8994,"NM",18,0)
ORWDPS32 DRUGMSG^^0
"BLD",17574,"KRN",8994,"NM",19,0)
ORWDPS32 FORMALT^^0
"BLD",17574,"KRN",8994,"NM",20,0)
ORWDPS32 ISSPLY^^0
"BLD",17574,"KRN",8994,"NM",21,0)
ORWDPS32 IVAMT^^0
"BLD",17574,"KRN",8994,"NM",22,0)
ORWDPS32 MEDISIV^^0
"BLD",17574,"KRN",8994,"NM",23,0)
ORWDPS32 SCSTS^^0
"BLD",17574,"KRN",8994,"NM",24,0)
ORWDPS32 VALQTY^^0
"BLD",17574,"KRN",8994,"NM",25,0)
ORWDPS32 VALRATE^^0
"BLD",17574,"KRN",8994,"NM",26,0)
ORWDPS32 VALSCH^^0
"BLD",17574,"KRN",8994,"NM",27,0)
ORDDPAPI CLOZMSG^^0
"BLD",17574,"KRN",8994,"NM",28,0)
ORWDPS33 COMPLOC^^0
"BLD",17574,"KRN",8994,"NM",29,0)
ORWGRPC ALLITEMS^^0
"BLD",17574,"KRN",8994,"NM",30,0)
ORWGRPC CLASS^^0
"BLD",17574,"KRN",8994,"NM",31,0)
ORWGRPC DATEITEM^^0
"BLD",17574,"KRN",8994,"NM",32,0)
ORWGRPC DELVIEWS^^0
"BLD",17574,"KRN",8994,"NM",33,0)
ORWGRPC DETAIL^^0
"BLD",17574,"KRN",8994,"NM",34,0)
ORWGRPC DETAILS^^0
"BLD",17574,"KRN",8994,"NM",35,0)
ORWGRPC FASTDATA^^0
"BLD",17574,"KRN",8994,"NM",36,0)
ORWGRPC FASTITEM^^0
"BLD",17574,"KRN",8994,"NM",37,0)
ORWGRPC FASTLABS^^0
"BLD",17574,"KRN",8994,"NM",38,0)
ORWGRPC FASTTASK^^0
"BLD",17574,"KRN",8994,"NM",39,0)
ORWGRPC GETDATES^^0
"BLD",17574,"KRN",8994,"NM",40,0)
ORWGRPC GETPREF^^0
"BLD",17574,"KRN",8994,"NM",41,0)
ORWGRPC GETSIZE^^0
"BLD",17574,"KRN",8994,"NM",42,0)
ORWGRPC GETVIEWS^^0
"BLD",17574,"KRN",8994,"NM",43,0)
ORWGRPC ITEMDATA^^0
"BLD",17574,"KRN",8994,"NM",44,0)
ORWGRPC ITEMS^^0
"BLD",17574,"KRN",8994,"NM",45,0)
ORWGRPC LOOKUP^^0
"BLD",17574,"KRN",8994,"NM",46,0)
ORWGRPC PUBLIC^^0
"BLD",17574,"KRN",8994,"NM",47,0)
ORWGRPC RPTPARAM^^0
"BLD",17574,"KRN",8994,"NM",48,0)
ORWGRPC SETPREF^^0
"BLD",17574,"KRN",8994,"NM",49,0)
ORWGRPC SETSIZE^^0
"BLD",17574,"KRN",8994,"NM",50,0)
ORWGRPC SETVIEWS^^0
"BLD",17574,"KRN",8994,"NM",51,0)
ORWGRPC TAX^^0
"BLD",17574,"KRN",8994,"NM",52,0)
ORWGRPC TESTSPEC^^0
"BLD",17574,"KRN",8994,"NM",53,0)
ORWGRPC TYPES^^0
"BLD",17574,"KRN",8994,"NM",54,0)
ORWDPS1 QOMEDALT^^0
"BLD",17574,"KRN",8994,"NM",55,0)
ORWGRPC ALLVIEWS^^0
"BLD",17574,"KRN",8994,"NM",56,0)
ORWTPP SAVESURR^^0
"BLD",17574,"KRN",8994,"NM",57,0)
ORWDXM1 BLDQRSP^^0
"BLD",17574,"KRN",8994,"NM",58,0)
ORWGRPC TESTING^^0
"BLD",17574,"KRN",8994,"NM",59,0)
ORQQPXRM MHDLL^^0
"BLD",17574,"KRN",8994,"NM",60,0)
ORWDLR33 LC TO WC^^0
"BLD",17574,"KRN",8994,"NM",61,0)
ORWU2 COSIGNER^^0
"BLD",17574,"KRN",8994,"NM",62,0)
ORWDXVB NURSADMN^^0
"BLD",17574,"KRN",8994,"NM",63,0)
ORQQPXRM MHDLLDMS^^0
"BLD",17574,"KRN",8994,"NM",64,0)
ORWDPS33 IVDOSFRM^^0
"BLD",17574,"KRN",8994,"NM",65,0)
ORWDPS32 ALLIVRTE^^0
"BLD",17574,"KRN",8994,"NM",66,0)
ORWDX LOADRSP^^0
"BLD",17574,"KRN",8994,"NM",67,0)
ORWORB AUTOUNFLAG ORDERS^^0
"BLD",17574,"KRN",8994,"NM",68,0)
ORWDXM1 SVRPC^^0
"BLD",17574,"KRN",8994,"NM",69,0)
ORWDXVB VBTNS^^0
"BLD",17574,"KRN",8994,"NM",70,0)
ORWCIRN VISTAWEB^^1^
"BLD",17574,"KRN",8994,"NM",71,0)
ORWCIRN WEBCH^^1^
"BLD",17574,"KRN",8994,"NM","B","ORALWORD ALLWORD",15)

"BLD",17574,"KRN",8994,"NM","B","ORCDLR2 CHECK ALL LC TO WC",5)

"BLD",17574,"KRN",8994,"NM","B","ORCDLR2 CHECK ONE LC TO WC",4)

"BLD",17574,"KRN",8994,"NM","B","ORDDPAPI ADMTIME",11)

"BLD",17574,"KRN",8994,"NM","B","ORDDPAPI CLOZMSG",27)

"BLD",17574,"KRN",8994,"NM","B","ORQQPXRM MHDLL",59)

"BLD",17574,"KRN",8994,"NM","B","ORQQPXRM MHDLLDMS",63)

"BLD",17574,"KRN",8994,"NM","B","ORWCIRN VISTAWEB",70)

"BLD",17574,"KRN",8994,"NM","B","ORWCIRN WEBCH",71)

"BLD",17574,"KRN",8994,"NM","B","ORWDLR33 LC TO WC",60)

"BLD",17574,"KRN",8994,"NM","B","ORWDPS1 DOWSCH",16)

"BLD",17574,"KRN",8994,"NM","B","ORWDPS1 QOMEDALT",54)

"BLD",17574,"KRN",8994,"NM","B","ORWDPS1 SCHALL",8)

"BLD",17574,"KRN",8994,"NM","B","ORWDPS32 ALLIVRTE",65)

"BLD",17574,"KRN",8994,"NM","B","ORWDPS32 DLGSLCT",13)

"BLD",17574,"KRN",8994,"NM","B","ORWDPS32 DOSES",17)

"BLD",17574,"KRN",8994,"NM","B","ORWDPS32 DRUGMSG",18)

"BLD",17574,"KRN",8994,"NM","B","ORWDPS32 FORMALT",19)

"BLD",17574,"KRN",8994,"NM","B","ORWDPS32 ISSPLY",20)

"BLD",17574,"KRN",8994,"NM","B","ORWDPS32 IVAMT",21)

"BLD",17574,"KRN",8994,"NM","B","ORWDPS32 MEDISIV",22)

"BLD",17574,"KRN",8994,"NM","B","ORWDPS32 SCSTS",23)

"BLD",17574,"KRN",8994,"NM","B","ORWDPS32 VALQTY",24)

"BLD",17574,"KRN",8994,"NM","B","ORWDPS32 VALRATE",25)

"BLD",17574,"KRN",8994,"NM","B","ORWDPS32 VALSCH",26)

"BLD",17574,"KRN",8994,"NM","B","ORWDPS33 COMPLOC",28)

"BLD",17574,"KRN",8994,"NM","B","ORWDPS33 IVDOSFRM",64)

"BLD",17574,"KRN",8994,"NM","B","ORWDX LOADRSP",66)

"BLD",17574,"KRN",8994,"NM","B","ORWDX1 DCORIG",1)

"BLD",17574,"KRN",8994,"NM","B","ORWDX1 ORDMATCH",7)

"BLD",17574,"KRN",8994,"NM","B","ORWDX1 UNDCORIG",2)

"BLD",17574,"KRN",8994,"NM","B","ORWDX2 DCREASON",12)

"BLD",17574,"KRN",8994,"NM","B","ORWDXM1 BLDQRSP",57)

"BLD",17574,"KRN",8994,"NM","B","ORWDXM1 SVRPC",68)

"BLD",17574,"KRN",8994,"NM","B","ORWDXVB NURSADMN",62)

"BLD",17574,"KRN",8994,"NM","B","ORWDXVB SUBCHK",10)

"BLD",17574,"KRN",8994,"NM","B","ORWDXVB VBTNS",69)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC ALLITEMS",29)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC ALLVIEWS",55)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC CLASS",30)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC DATEITEM",31)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC DELVIEWS",32)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC DETAIL",33)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC DETAILS",34)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC FASTDATA",35)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC FASTITEM",36)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC FASTLABS",37)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC FASTTASK",38)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC GETDATES",39)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC GETPREF",40)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC GETSIZE",41)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC GETVIEWS",42)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC ITEMDATA",43)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC ITEMS",44)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC LOOKUP",45)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC PUBLIC",46)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC RPTPARAM",47)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC SETPREF",48)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC SETSIZE",49)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC SETVIEWS",50)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC TAX",51)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC TESTING",58)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC TESTSPEC",52)

"BLD",17574,"KRN",8994,"NM","B","ORWGRPC TYPES",53)

"BLD",17574,"KRN",8994,"NM","B","ORWORB AUTOUNFLAG ORDERS",67)

"BLD",17574,"KRN",8994,"NM","B","ORWPS ACTIVE",3)

"BLD",17574,"KRN",8994,"NM","B","ORWTIU GET SAVED CP FIELDS",9)

"BLD",17574,"KRN",8994,"NM","B","ORWTPP SAVESURR",56)

"BLD",17574,"KRN",8994,"NM","B","ORWU PARAMS",14)

"BLD",17574,"KRN",8994,"NM","B","ORWU2 COSIGNER",61)

"BLD",17574,"KRN","B",.4,.4)

"BLD",17574,"KRN","B",.401,.401)

"BLD",17574,"KRN","B",.402,.402)

"BLD",17574,"KRN","B",.403,.403)

"BLD",17574,"KRN","B",.5,.5)

"BLD",17574,"KRN","B",.84,.84)

"BLD",17574,"KRN","B",3.6,3.6)

"BLD",17574,"KRN","B",3.8,3.8)

"BLD",17574,"KRN","B",9.2,9.2)

"BLD",17574,"KRN","B",9.8,9.8)

"BLD",17574,"KRN","B",19,19)

"BLD",17574,"KRN","B",19.1,19.1)

"BLD",17574,"KRN","B",101,101)

"BLD",17574,"KRN","B",409.61,409.61)

"BLD",17574,"KRN","B",771,771)

"BLD",17574,"KRN","B",870,870)

"BLD",17574,"KRN","B",8989.51,8989.51)

"BLD",17574,"KRN","B",8989.52,8989.52)

"BLD",17574,"KRN","B",8994,8994)

"BLD",17574,"PRE")

"BLD",17574,"PRET")

"BLD",17574,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",17574,"QUES",0)
^9.62^^
"BLD",17574,"REQB",0)
^9.611^35^21
"BLD",17574,"REQB",2,0)
TIU*1.0*219^2
"BLD",17574,"REQB",13,0)
GMPL*2.0*35^2
"BLD",17574,"REQB",14,0)
PSS*1.0*112^2
"BLD",17574,"REQB",16,0)
OR*3.0*246^2
"BLD",17574,"REQB",17,0)
PSS*1.0*118^2
"BLD",17574,"REQB",19,0)
OR*3.0*255^2
"BLD",17574,"REQB",20,0)
OR*3.0*265^2
"BLD",17574,"REQB",21,0)
OR*3.0*254^2
"BLD",17574,"REQB",23,0)
OR*3.0*258^2
"BLD",17574,"REQB",24,0)
PSO*7.0*225^2
"BLD",17574,"REQB",25,0)
PSJ*5.0*134^2
"BLD",17574,"REQB",26,0)
PSS*1.0*94^2
"BLD",17574,"REQB",27,0)
YS*5.01*92^2
"BLD",17574,"REQB",28,0)
OR*3.0*232^2
"BLD",17574,"REQB",29,0)
LR*5.2*365^2
"BLD",17574,"REQB",30,0)
OR*3.0*275^2
"BLD",17574,"REQB",31,0)
WV*1.0*23^2
"BLD",17574,"REQB",32,0)
OR*3.0*256^2
"BLD",17574,"REQB",33,0)
OR*3.0*277^2
"BLD",17574,"REQB",34,0)
OR*3.0*245^2
"BLD",17574,"REQB",35,0)
XU*8.0*498^2
"BLD",17574,"REQB","B","GMPL*2.0*35",13)

"BLD",17574,"REQB","B","LR*5.2*365",29)

"BLD",17574,"REQB","B","OR*3.0*232",28)

"BLD",17574,"REQB","B","OR*3.0*245",34)

"BLD",17574,"REQB","B","OR*3.0*246",16)

"BLD",17574,"REQB","B","OR*3.0*254",21)

"BLD",17574,"REQB","B","OR*3.0*255",19)

"BLD",17574,"REQB","B","OR*3.0*256",32)

"BLD",17574,"REQB","B","OR*3.0*258",23)

"BLD",17574,"REQB","B","OR*3.0*265",20)

"BLD",17574,"REQB","B","OR*3.0*275",30)

"BLD",17574,"REQB","B","OR*3.0*277",33)

"BLD",17574,"REQB","B","PSJ*5.0*134",25)

"BLD",17574,"REQB","B","PSO*7.0*225",24)

"BLD",17574,"REQB","B","PSS*1.0*112",14)

"BLD",17574,"REQB","B","PSS*1.0*118",17)

"BLD",17574,"REQB","B","PSS*1.0*94",26)

"BLD",17574,"REQB","B","TIU*1.0*219",2)

"BLD",17574,"REQB","B","WV*1.0*23",31)

"BLD",17574,"REQB","B","XU*8.0*498",35)

"BLD",17574,"REQB","B","YS*5.01*92",27)

"DATA",101.24,3,0)
ORRP AP ALL^OR_APR^1^6^ORDV01^HSQUERY^0^R^^^^V^203^^^^^^SP^ORDV02A
"DATA",101.24,3,2)
^^Anatomic Pathology^Anatomic Pathology^^^^ALL^ORDVX1
"DATA",101.24,3,3,0)
^101.243^7^7
"DATA",101.24,3,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,3,3,2,0)
ID^1^2
"DATA",101.24,3,3,3,0)
Collection Date^^3^^0^18^0^^2
"DATA",101.24,3,3,4,0)
Specimen^^4^1^0^10^0^Specimen
"DATA",101.24,3,3,5,0)
Accession #^^5^^^10^1^Accession #
"DATA",101.24,3,3,6,0)
Report^1^6^1^1^^1^    
"DATA",101.24,3,3,7,0)
[+]^^7
"DATA",101.24,3,4)
3:4^^^^^^^
"DATA",101.24,3,10,0)
^101.241P^4^4
"DATA",101.24,3,10,1,0)
1603
"DATA",101.24,3,10,2,0)
1059
"DATA",101.24,3,10,3,0)
1056
"DATA",101.24,3,10,4,0)
1058
"DATA",101.24,18,0)
ORL MOST RECENT^1^^^^^5^L
"DATA",101.24,18,2)
^^Most Recent^Most Recent
"DATA",101.24,19,0)
ORL CUMULATIVE^21^1^^^^3^L^^^^R^146
"DATA",101.24,19,2)
^^Cumulative^Cumulative
"DATA",101.24,20,0)
ORL ALL TESTS BY DATE^3^1^^^^1^L^^^^R^248
"DATA",101.24,20,2)
^^All Tests by Date^All Tests by Date
"DATA",101.24,21,0)
ORL WORKSHEET^5^^^^^5^L
"DATA",101.24,21,2)
^^Worksheet^Worksheet
"DATA",101.24,22,0)
ORL GRAPH^6^^^^^5^L
"DATA",101.24,22,2)
^^Graph^Graph
"DATA",101.24,23,0)
ORL MICROBIOLOGY^OR_MICL^1^6^ORDV01^HSQUERY^6^L^^^^V^203^^^^^^MI^ORDV05^38
"DATA",101.24,23,2)
^^Microbiology^Microbiology^^^^GET^ORDV05E
"DATA",101.24,23,3,0)
^101.243^10^9
"DATA",101.24,23,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,23,3,2,0)
ID^1^2
"DATA",101.24,23,3,3,0)
Collection Date/Time^^3^^0^18^1^^2
"DATA",101.24,23,3,4,0)
Specimen^^6^^^10^1
"DATA",101.24,23,3,5,0)
Microbiology Test Name     ^^4^^0^15^1^Test
"DATA",101.24,23,3,7,0)
Accession #   ^^7^^^10^1^Accession #
"DATA",101.24,23,3,8,0)
Collection Sample^^5^^0^12^1^Sample
"DATA",101.24,23,3,9,0)
Report^1^8^1^1^^1
"DATA",101.24,23,3,10,0)
[+]^^9
"DATA",101.24,23,4)
3:4^^^^^^^1
"DATA",101.24,24,0)
ORL ANATOMIC PATHOLOGY^OR_APL^1^6^ORDV01^HSQUERY^0^L^^^^V^203^^^^^^SP^ORDV02A
"DATA",101.24,24,2)
^^Anatomic Pathology - All Reports^Anatomic Pathology - All Reports^^^^ALL^ORDVX1
"DATA",101.24,24,3,0)
^101.243^7^7
"DATA",101.24,24,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,24,3,2,0)
ID^1^2
"DATA",101.24,24,3,3,0)
Collection Date^^3^^0^18^0^^2
"DATA",101.24,24,3,4,0)
Specimen               ^^4^1^0^10^0^Specimen^^30
"DATA",101.24,24,3,5,0)
Accession #^^5^^^10^1^Accession #
"DATA",101.24,24,3,6,0)
Report^1^6^1^1^^1^    
"DATA",101.24,24,3,7,0)
[+]^^7
"DATA",101.24,24,4)
3:4^^^^^^^
"DATA",101.24,24,10,0)
^101.241P^4^4
"DATA",101.24,24,10,1,0)
1097
"DATA",101.24,24,10,2,0)
1600
"DATA",101.24,24,10,3,0)
1601
"DATA",101.24,24,10,4,0)
1602
"DATA",101.24,25,0)
ORL BLOOD BANK^2^1^^ORWRP1^BLR^0^L^^^^R^203
"DATA",101.24,25,2)
^^Blood Bank^Blood Bank
"DATA",101.24,26,0)
ORL LAB STATUS^10^1^^ORWRP1^STAT^1^L^^^^R^203
"DATA",101.24,26,2)
^^Lab Status^Lab Status
"DATA",101.24,27,0)
ORL SELECTED TESTS BY DATE^4^^^^^4^L
"DATA",101.24,27,2)
^^Selected Tests by Date^Selected Tests by Date
"DATA",101.24,48,0)
ORRP SURGERIES^28^^28^ORWSR^RPTTEXT^4^R^^^^V^203
"DATA",101.24,48,2)
^^Surgery (local only)^Surgery (local only)
"DATA",101.24,48,3,0)
^101.243^11^11
"DATA",101.24,48,3,1,0)
Facility^^1
"DATA",101.24,48,3,2,0)
Procedure Date/Time^^3^^^^^^2
"DATA",101.24,48,3,3,0)
Surgical Procedure^^4
"DATA",101.24,48,3,4,0)
Surgeon^^6
"DATA",101.24,48,3,5,0)
[+]^^7
"DATA",101.24,48,3,6,0)
ID^1^2
"DATA",101.24,48,3,7,0)
Lab Work^1^7^0^0^^0^^0
"DATA",101.24,48,3,8,0)
Status^1^8^0^0^^0^^0
"DATA",101.24,48,3,9,0)
Surgical Specialty^1^9^0^0^^0^^0
"DATA",101.24,48,3,10,0)
Dictation Time^1^10^0^0^^0^^0
"DATA",101.24,48,3,11,0)
Transcription Time^1^11^0^0^^0^^0
"DATA",101.24,48,4)
3:4
"DATA",101.24,1004,0)
ORRPW DISCHARGE SUMMARY^OR_DS^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^TIUDCS^ORDV04^57
"DATA",101.24,1004,2)
^^Discharge Summary^Discharge Summary^^HSTYPEB^ORWRPP1^TDCS^ORDV04
"DATA",101.24,1004,3,0)
^101.243^11^9
"DATA",101.24,1004,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1004,3,2,0)
Admitted Date/Time^^3^^^18^1^Admitted^2
"DATA",101.24,1004,3,3,0)
Discharged Date/Time^^4^^^18^1^Discharged^2
"DATA",101.24,1004,3,4,0)
Author / Dictated By^^5^^^10^1
"DATA",101.24,1004,3,5,0)
Approved By        ^^6^^^12^1^Approved By
"DATA",101.24,1004,3,6,0)
Current Status^^7^^^10^1^Status
"DATA",101.24,1004,3,9,0)
ID^1^2
"DATA",101.24,1004,3,10,0)
Summary^1^8^1^1^^1
"DATA",101.24,1004,3,11,0)
[+]^0^9
"DATA",101.24,1004,4)
3:5^^^^^^^1
"DATA",101.24,1006,0)
ORRPW RADIOLOGY IMAGING^OR_R18^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^RIM^ORDV08
"DATA",101.24,1006,2)
^^Imaging^Imaging^^^^IGET^ORDV08
"DATA",101.24,1006,3,0)
^101.243^11^10
"DATA",101.24,1006,3,1,0)
Facility^^1
"DATA",101.24,1006,3,3,0)
Procedure Date/Time     ^^3^^^^^^2
"DATA",101.24,1006,3,4,0)
Procedure Name^^4
"DATA",101.24,1006,3,5,0)
Case #^^6^^^^^^1
"DATA",101.24,1006,3,6,0)
ID^1^2
"DATA",101.24,1006,3,7,0)
Report Status^^5
"DATA",101.24,1006,3,8,0)
[+]^^8
"DATA",101.24,1006,3,9,0)
Detailed Report^1^7^1^1^^1
"DATA",101.24,1006,3,10,0)
Images available?^1^9
"DATA",101.24,1006,3,11,0)
Identifier^1^10^0^0^^0^^0
"DATA",101.24,1006,4)
3:4
"DATA",101.24,1007,0)
ORRPW PROCEDURES^OR_MEDP^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^MPRO^ORDV08
"DATA",101.24,1007,2)
^^Procedures^Procedures^^^^MGET^ORDV08
"DATA",101.24,1007,3,0)
^101.243^7^7
"DATA",101.24,1007,3,1,0)
Facility^^1
"DATA",101.24,1007,3,2,0)
Procedure Date/Time^^3^^1^20^1^^2
"DATA",101.24,1007,3,3,0)
Medicine Procedure Name     ^^4^^1^20^1^Procedure Name
"DATA",101.24,1007,3,4,0)
ID^1^2
"DATA",101.24,1007,3,5,0)
Summary^^5^^1^^1
"DATA",101.24,1007,3,6,0)
[+]^^7
"DATA",101.24,1007,3,7,0)
Detailed Report^1^6^1^1^^1
"DATA",101.24,1018,0)
ORRPW ADT DEMO^OR_DEM^1^^^^^R^^^^M^^^^^^^^^6
"DATA",101.24,1018,2)
^^Patient Information^Patient Information^^HSTYPEB^ORWRPP1
"DATA",101.24,1018,10,0)
^101.241P^3^3
"DATA",101.24,1018,10,1,0)
1033
"DATA",101.24,1018,10,2,0)
1034
"DATA",101.24,1018,10,3,0)
1035
"DATA",101.24,1020,0)
ORRPW DIET^OR_DIET^1^^^^^R^^^^M
"DATA",101.24,1020,2)
^^Dietetics^Dietetics^^HSTYPEB^ORWRPP1
"DATA",101.24,1020,10,0)
^101.241P^7^7
"DATA",101.24,1020,10,1,0)
1046
"DATA",101.24,1020,10,2,0)
1047
"DATA",101.24,1020,10,3,0)
1048
"DATA",101.24,1020,10,4,0)
1049
"DATA",101.24,1020,10,5,0)
1050
"DATA",101.24,1020,10,6,0)
4
"DATA",101.24,1020,10,7,0)
8
"DATA",101.24,1021,0)
ORRPW LAB^OR_LAB^1^^^^^R^^^^M
"DATA",101.24,1021,2)
^^Laboratory^Laboratory
"DATA",101.24,1021,10,0)
^101.241P^8^7
"DATA",101.24,1021,10,1,0)
1051
"DATA",101.24,1021,10,2,0)
1052
"DATA",101.24,1021,10,3,0)
2
"DATA",101.24,1021,10,4,0)
3
"DATA",101.24,1021,10,6,0)
1057
"DATA",101.24,1021,10,7,0)
1055
"DATA",101.24,1021,10,8,0)
1054
"DATA",101.24,1022,0)
ORRPW MEDICINE/CP^OR_MED^1^^^^^R^^^^M
"DATA",101.24,1022,2)
^^Medicine/CP^Medicine/CP^^HSTYPEB^ORWRPP1
"DATA",101.24,1022,10,0)
^101.241P^6^6
"DATA",101.24,1022,10,1,0)
1061
"DATA",101.24,1022,10,2,0)
1062
"DATA",101.24,1022,10,3,0)
1063
"DATA",101.24,1022,10,4,0)
1064
"DATA",101.24,1022,10,5,0)
9
"DATA",101.24,1022,10,6,0)
1007
"DATA",101.24,1023,0)
ORRPW ORDERS MENU^OR_MENU^^^^^^R^^^^M
"DATA",101.24,1023,2)
^^Orders^Orders
"DATA",101.24,1023,10,0)
^101.241P^4^4
"DATA",101.24,1023,10,1,0)
1100
"DATA",101.24,1023,10,2,0)
10
"DATA",101.24,1023,10,3,0)
11
"DATA",101.24,1023,10,4,0)
12
"DATA",101.24,1024,0)
ORRPW PCE^OR_PCE^1^^^^^R^^^^M
"DATA",101.24,1024,2)
^^Outpatient Encounters / GAF Scores ^Outpatient Encounters / GAF Scores ^^HSTYPEB^ORWRPP1
"DATA",101.24,1024,10,0)
^101.241P^11^10
"DATA",101.24,1024,10,1,0)
1066
"DATA",101.24,1024,10,2,0)
1067
"DATA",101.24,1024,10,3,0)
1076
"DATA",101.24,1024,10,4,0)
1068
"DATA",101.24,1024,10,5,0)
1069
"DATA",101.24,1024,10,6,0)
1070
"DATA",101.24,1024,10,8,0)
1072
"DATA",101.24,1024,10,9,0)
1073
"DATA",101.24,1024,10,10,0)
1074
"DATA",101.24,1024,10,11,0)
1077
"DATA",101.24,1025,0)
ORRPW PHARMACY^OR_PH^1^^^^^R^^^^M
"DATA",101.24,1025,2)
^^Pharmacy^Pharmacy
"DATA",101.24,1025,10,0)
^101.241P^9^9
"DATA",101.24,1025,10,1,0)
1078
"DATA",101.24,1025,10,2,0)
1079
"DATA",101.24,1025,10,3,0)
13
"DATA",101.24,1025,10,4,0)
1080
"DATA",101.24,1025,10,5,0)
1081
"DATA",101.24,1025,10,6,0)
1082
"DATA",101.24,1025,10,7,0)
44
"DATA",101.24,1025,10,8,0)
43
"DATA",101.24,1025,10,9,0)
1555
"DATA",101.24,1026,0)
ORRPW PROBLEM LIST^OR_PL^1^^^^^R^^^^M
"DATA",101.24,1026,2)
^^Problem List^Problem List^^HSTYPEB^ORWRPP1
"DATA",101.24,1026,10,0)
^101.241P^3^3
"DATA",101.24,1026,10,1,0)
1083
"DATA",101.24,1026,10,2,0)
1557
"DATA",101.24,1026,10,3,0)
1085
"DATA",101.24,1027,0)
ORRPW RADIOLOGY^OR_RAD^1^^^^^R^^^^M
"DATA",101.24,1027,2)
^^Radiology^Radiology
"DATA",101.24,1027,10,0)
^101.241P^4^4
"DATA",101.24,1027,10,1,0)
1091
"DATA",101.24,1027,10,2,0)
1092
"DATA",101.24,1027,10,3,0)
6
"DATA",101.24,1027,10,4,0)
1006
"DATA",101.24,1028,0)
ORRPW SURGERY^OR_SR^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^SR^ORDV04^23
"DATA",101.24,1028,2)
^^Surgery Reports^Surgery Reports
"DATA",101.24,1028,3,0)
^101.243^14^14
"DATA",101.24,1028,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1028,3,2,0)
Date of Operation^^3^^1^18^1^^2
"DATA",101.24,1028,3,3,0)
Surgical Specialty^^5^^^12^1
"DATA",101.24,1028,3,4,0)
Surgeon^^6^^0^12^1
"DATA",101.24,1028,3,5,0)
Status^^7^^0^8^1
"DATA",101.24,1028,3,6,0)
Pre-op Diag(s)^^8^^1^12^1
"DATA",101.24,1028,3,7,0)
Post-op Diag(s)^^9^^1^12^1
"DATA",101.24,1028,3,8,0)
Operative Procedure(s)^^4^^1^18^1
"DATA",101.24,1028,3,9,0)
Lab Work^^10^^^8^1
"DATA",101.24,1028,3,10,0)
Dictation Time^^11^^^18^1
"DATA",101.24,1028,3,11,0)
Transcription Time^^12^^^18^1
"DATA",101.24,1028,3,12,0)
Surgeon's Dictation^^13^1^1^^1
"DATA",101.24,1028,3,13,0)
ID^1^2
"DATA",101.24,1028,3,14,0)
[+]^^14
"DATA",101.24,1028,4)
3:4
"DATA",101.24,1029,0)
ORRPW VITALS^OR_VS^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^VS^ORDV04^47
"DATA",101.24,1029,2)
^^Vital Signs^Vital Signs^^^^EN1^GMVHS
"DATA",101.24,1029,3,0)
^101.243^18^18
"DATA",101.24,1029,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1029,3,2,0)
Measurement Date/Time^^3^^^18^1^^2
"DATA",101.24,1029,3,3,0)
TEMP^^4^^^5^1^^1
"DATA",101.24,1029,3,4,0)
PULSE^^5^^^5^1^^1
"DATA",101.24,1029,3,5,0)
RESP^^6^^^5^1^^1
"DATA",101.24,1029,3,6,0)
Blood Pressure^^7^^^12^1^Pressure
"DATA",101.24,1029,3,7,0)
Height^^8^^^6^1^^1
"DATA",101.24,1029,3,8,0)
Weight^^9^^^6^1^^1
"DATA",101.24,1029,3,9,0)
ID^1^2
"DATA",101.24,1029,3,10,0)
Pain^^10^^^6
"DATA",101.24,1029,3,11,0)
POx^^11^^^6
"DATA",101.24,1029,3,12,0)
CVP^^12^^^6
"DATA",101.24,1029,3,13,0)
C/G^^13^^^6
"DATA",101.24,1029,3,14,0)
Flow Rate (l/min)^1^14^^1^6^1^Rate l/min
"DATA",101.24,1029,3,15,0)
O2 Concentration (%)^1^15^^1^6^1^O2 %
"DATA",101.24,1029,3,16,0)
Qualifiers^1^16^^1^20^1^Qualif
"DATA",101.24,1029,3,17,0)
BMI^1^17^^1^6^1^BMI
"DATA",101.24,1029,3,18,0)
Units^1^18^^1^20^1^Units
"DATA",101.24,1029,4)
3:0
"DATA",101.24,1030,0)
ORRPW PN^OR_PNMN^1^^^^^R^^^^M
"DATA",101.24,1030,2)
^^Progress Notes^Progress Notes
"DATA",101.24,1030,10,0)
^101.241P^4^4
"DATA",101.24,1030,10,1,0)
1086
"DATA",101.24,1030,10,2,0)
1087
"DATA",101.24,1030,10,3,0)
1088
"DATA",101.24,1030,10,4,0)
1089
"DATA",101.24,1031,0)
ORRPW REPORT CATEGORIES^OR_RPT^^^^^^R^^^^M
"DATA",101.24,1031,2)
^^Clinical Reports^Clinical Reports
"DATA",101.24,1031,10,0)
^101.241P^17^16
"DATA",101.24,1031,10,1,0)
1032
"DATA",101.24,1031,10,2,0)
1018
"DATA",101.24,1031,10,3,0)
1101
"DATA",101.24,1031,10,4,0)
1045
"DATA",101.24,1031,10,6,0)
1020
"DATA",101.24,1031,10,7,0)
1004
"DATA",101.24,1031,10,8,0)
1021
"DATA",101.24,1031,10,9,0)
1022
"DATA",101.24,1031,10,10,0)
1023
"DATA",101.24,1031,10,11,0)
1024
"DATA",101.24,1031,10,12,0)
1025
"DATA",101.24,1031,10,13,0)
1026
"DATA",101.24,1031,10,14,0)
1030
"DATA",101.24,1031,10,15,0)
1027
"DATA",101.24,1031,10,16,0)
1028
"DATA",101.24,1031,10,17,0)
1029
"DATA",101.24,1032,0)
ORRPW ALLERGIES ADV^OR_BADR^1^6^ORDV01^HSQUERY^0^R^^^^V^203^^^^^^ADR^ORDV01^73
"DATA",101.24,1032,2)
^^Allergies^Allergies^^^^^GMRADPT
"DATA",101.24,1032,3,0)
^101.243^8^8
"DATA",101.24,1032,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1032,3,2,0)
Allergy Type^^4^^0^10^1
"DATA",101.24,1032,3,3,0)
Allergy Reactant^^3^^0^20^1^Reactant
"DATA",101.24,1032,3,4,0)
Verification Date/Time^^5^^0^18^1^^2
"DATA",101.24,1032,3,5,0)
Observed/Historical^^6^^^13^1^Observed/Hist
"DATA",101.24,1032,3,6,0)
ID^1^2
"DATA",101.24,1032,3,7,0)
Comments^1^7^1^1^^1
"DATA",101.24,1032,3,8,0)
Allergy IEN^1^8^0^0^^0^^0
"DATA",101.24,1032,4)
5:3^^^^^^^1
"DATA",101.24,1033,0)
ORRPW ADT DEMOG^OR_DEMG^1^6^ORDV01^HSQUERY^0^R^^^^V^203^^^^^^DEM^ORDV07^6
"DATA",101.24,1033,2)
^^Demographics^Demographics^^HSTYPEB^ORWRPP1
"DATA",101.24,1033,3,0)
^101.243^26^16
"DATA",101.24,1033,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1033,3,2,0)
Patient Name     ^^3^^^20^1^Name
"DATA",101.24,1033,3,3,0)
Social Security #^^4^^^11^1^SSN
"DATA",101.24,1033,3,4,0)
Gender^^5^^^4^1^SEX
"DATA",101.24,1033,3,5,0)
Date of Birth^^6^^^12^1^DOB
"DATA",101.24,1033,3,6,0)
Religion^^7
"DATA",101.24,1033,3,9,0)
Marital status^^8
"DATA",101.24,1033,3,10,0)
Home phone^^9
"DATA",101.24,1033,3,11,0)
Home Address^^10^1^1^^1
"DATA",101.24,1033,3,12,0)
Race^^11^1^1
"DATA",101.24,1033,3,13,0)
Ethnicity^^12^1^1
"DATA",101.24,1033,3,17,0)
Next of kin^^13
"DATA",101.24,1033,3,18,0)
Relationship^^14
"DATA",101.24,1033,3,19,0)
NOK Address^^15^1^1
"DATA",101.24,1033,3,25,0)
Sensitive^^16
"DATA",101.24,1033,3,26,0)
ID^1^2
"DATA",101.24,1034,0)
ORRPW ADT INS^OR_INS^1^6^ORDV01^HSQUERY^0^R^^^^V^203^^^^^^INS^ORDV07
"DATA",101.24,1034,2)
^^Insurance^Insurance^^HSTYPEB^ORWRPP1
"DATA",101.24,1034,3,0)
^101.243^8^8
"DATA",101.24,1034,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1034,3,2,0)
Insurance Company^^3^^^^1
"DATA",101.24,1034,3,3,0)
Policy Type^^4^^^^1
"DATA",101.24,1034,3,4,0)
Group #^^5^^^10^1
"DATA",101.24,1034,3,5,0)
Holder^^6^^^10^1
"DATA",101.24,1034,3,6,0)
ID^1^2
"DATA",101.24,1034,3,7,0)
Effective Date^^7^^^18^1^^2
"DATA",101.24,1034,3,8,0)
Expiration Date^^8^^^18^1^^2
"DATA",101.24,1034,4)
7:3
"DATA",101.24,1035,0)
ORRPW ADT DISAB^OR_ADS^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^24
"DATA",101.24,1035,2)
^^Disabilities^Disabilities^^HSTYPEB^ORWRPP1
"DATA",101.24,1036,0)
ORRPW ADT ADM DC^OR_ADC^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^10
"DATA",101.24,1036,2)
^^Adm./Discharge^Adm./Discharge^^HSTYPEB^ORWRPP1
"DATA",101.24,1037,0)
ORRPW ADT EXP^OR_EADT^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^64
"DATA",101.24,1037,2)
^^Expanded ADT^Expanded ADT^^HSTYPEB^ORWRPP1
"DATA",101.24,1037,4)
^^ADT^^^^^1
"DATA",101.24,1038,0)
ORRPW ADT DC DIAG^OR_DD^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^11
"DATA",101.24,1038,2)
^^Discharge Diagnosis^Discharge Diagnosis^^HSTYPEB^ORWRPP1
"DATA",101.24,1039,0)
ORRPW ADT DISC^OR_DC^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^8
"DATA",101.24,1039,2)
^^Discharges^Discharges^^HSTYPEB^ORWRPP1
"DATA",101.24,1040,0)
ORRPW ADT FUTURE CLINIC^OR_CVF^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^9
"DATA",101.24,1040,2)
^^Future Clinic Visits^Future Clinic Visits^^HSTYPEB^ORWRPP1
"DATA",101.24,1041,0)
ORRPW ADT ICD PROC^OR_PRC^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^PRC^ORDV07^50
"DATA",101.24,1041,2)
^^ICD Procedures^ICD Procedures^^HSTYPEB^ORWRPP1
"DATA",101.24,1041,3,0)
^101.243^5^5
"DATA",101.24,1041,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1041,3,2,0)
Procedure Date^^3^^^18^1^^2
"DATA",101.24,1041,3,3,0)
ICD Procedure^^4^^^15^1
"DATA",101.24,1041,3,4,0)
Code^^5^^^10^1
"DATA",101.24,1041,3,5,0)
ID^1^2
"DATA",101.24,1041,4)
3:4
"DATA",101.24,1042,0)
ORRPW ADT ICD SURG^OR_OPC^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^ICDSUR^ORDV07^12
"DATA",101.24,1042,2)
^^ICD Surgeries^ICD Surgeries^^HSTYPEB^ORWRPP1
"DATA",101.24,1042,3,0)
^101.243^5^5
"DATA",101.24,1042,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1042,3,2,0)
Surgery Date^^3^^^18^1^^2
"DATA",101.24,1042,3,3,0)
ICD Surgery^^4^^^15^1
"DATA",101.24,1042,3,4,0)
ICD Code^^5^^^10^1
"DATA",101.24,1042,3,5,0)
ID^1^2
"DATA",101.24,1042,4)
3:4
"DATA",101.24,1043,0)
ORRPW ADT TRANSFERS^OR_TR^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^16
"DATA",101.24,1043,2)
^^Transfers^Transfers^^HSTYPEB^ORWRPP1
"DATA",101.24,1044,0)
ORRPW ADT TREATING SPEC^OR_TS^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^17
"DATA",101.24,1044,2)
^^Treating Specialty^Treating Specialty^^HSTYPEB^ORWRPP1
"DATA",101.24,1045,0)
ORRPW COMP^OR_CP^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^65
"DATA",101.24,1045,2)
^^Comp & Pen Exams^Comp & Pen Exams^^HSTYPEB^ORWRPP1
"DATA",101.24,1046,0)
ORRPW DIET GEN^OR_DI1^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^7
"DATA",101.24,1046,2)
^^Generic^Diet Generic^^HSTYPEB^ORWRPP1
"DATA",101.24,1047,0)
ORRPW DIET DIET^OR_DI^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^DIETA^ORDV07^7
"DATA",101.24,1047,2)
^^Diet^Diet^^HSTYPEB^ORWRPP1
"DATA",101.24,1047,3,0)
^101.243^7^7
"DATA",101.24,1047,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1047,3,2,0)
Beginning Date/Time^^3^^0^18^1^^2
"DATA",101.24,1047,3,3,0)
Ending Date/Time^^4^^^18^1^^2
"DATA",101.24,1047,3,4,0)
Diet               ^^5^^0^12^1^Diet
"DATA",101.24,1047,3,5,0)
Comment                       ^0^6^^0^^1^Comment
"DATA",101.24,1047,3,6,0)
Tray^^7^^^5^1
"DATA",101.24,1047,3,7,0)
ID^1^2
"DATA",101.24,1047,4)
3:5
"DATA",101.24,1048,0)
ORRPW DIET NUTR^OR_DI2^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^DIETN^ORDV07
"DATA",101.24,1048,2)
^^Nutritional Status^Diet Nutritional Status^^HSTYPEB^ORWRPP1
"DATA",101.24,1048,3,0)
^101.243^4^4
"DATA",101.24,1048,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1048,3,2,0)
Status Date/time^^3^^^18^1^^2
"DATA",101.24,1048,3,3,0)
Status^^4^^^10^1
"DATA",101.24,1048,3,4,0)
ID^1^2
"DATA",101.24,1048,4)
3:0
"DATA",101.24,1049,0)
ORRPW DIET SUPP^OR_DI3^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^DIETS^ORDV07
"DATA",101.24,1049,2)
^^Supp. Feedings^Diet Supp. Feedings^^HSTYPEB^ORWRPP1
"DATA",101.24,1049,3,0)
^101.243^7^7
"DATA",101.24,1049,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1049,3,2,0)
Date/time Ordered^^3^^^^1^^2
"DATA",101.24,1049,3,3,0)
Date/time Cancelled^^5^^^^1^^2
"DATA",101.24,1049,3,4,0)
10 am Feeding^^4^^^15^1
"DATA",101.24,1049,3,5,0)
2 pm Feeding^^6^^^^1
"DATA",101.24,1049,3,6,0)
8 pm Feeding^^8^^^^1
"DATA",101.24,1049,3,7,0)
ID^1^2
"DATA",101.24,1049,4)
3:0
"DATA",101.24,1050,0)
ORRPW DIET TUBE^OR_DI4^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^DIETT^ORDV07
"DATA",101.24,1050,2)
^^Tube Feeding^Diet Tube Feeding^^HSTYPEB^ORWRPP1
"DATA",101.24,1050,3,0)
^101.243^10^10
"DATA",101.24,1050,3,1,0)
Facility^^1^^^^1
"DATA",101.24,1050,3,2,0)
Date/Time Ordered^^3^^0^18^1^Ordered^2
"DATA",101.24,1050,3,3,0)
Date/Time Cancelled^^4^^0^18^1^Cancelled^2
"DATA",101.24,1050,3,4,0)
Product            ^^5^^0^^1^Product
"DATA",101.24,1050,3,5,0)
Strength^^6^^0^^1
"DATA",101.24,1050,3,6,0)
Quantity^^7^^0^^1
"DATA",101.24,1050,3,7,0)
Daily CC's^^8^^0^12^1
"DATA",101.24,1050,3,8,0)
Daily KCal's^^9^^0^12^1
"DATA",101.24,1050,3,9,0)
Comment^^10^^0^^1
"DATA",101.24,1050,3,10,0)
ID^1^2
"DATA",101.24,1050,4)
3:5
"DATA",101.24,1051,0)
ORRPW LAB BLOOD AV^OR_BA^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^45
"DATA",101.24,1051,2)
^^Blood Availability^Blood Availability^^HSTYPEB^ORWRPP1
"DATA",101.24,1052,0)
ORRPW LAB BLOOD TR^OR_BT^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^36
"DATA",101.24,1052,2)
^^Blood Transfusion^Blood Transfusion^^HSTYPEB^ORWRPP1
"DATA",101.24,1052,3,0)
^101.243^5^5
"DATA",101.24,1052,3,1,0)
Facility^^1
"DATA",101.24,1052,3,2,0)
Date of Transfusion^^3^^^^^^2
"DATA",101.24,1052,3,3,0)
No of Unit(s)^^4
"DATA",101.24,1052,3,4,0)
Blood Product^^5^^^20^1
"DATA",101.24,1052,3,5,0)
ID^1^2
"DATA",101.24,1052,4)
3:5
"DATA",101.24,1054,0)
ORRPW LAB MICRO^OR_MIC^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^MI^ORDV05^38
"DATA",101.24,1054,2)
^^Microbiology^Microbiology^^^^GET^ORDV05E
"DATA",101.24,1054,3,0)
^101.243^10^9
"DATA",101.24,1054,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1054,3,2,0)
ID^1^2
"DATA",101.24,1054,3,3,0)
Collection Date/Time^^3^^0^18^1^^2
"DATA",101.24,1054,3,4,0)
Specimen^^6^^^10^1
"DATA",101.24,1054,3,5,0)
Microbiology Test Name     ^^4^^0^15^1^Test
"DATA",101.24,1054,3,7,0)
Accession #   ^^7^^^10^1^Accession #
"DATA",101.24,1054,3,8,0)
Collection Sample^^5^^0^12^1^Sample
"DATA",101.24,1054,3,9,0)
Report^1^8^1^1^^1
"DATA",101.24,1054,3,10,0)
[+]^^9
"DATA",101.24,1054,4)
3:4^^^^^^^1
"DATA",101.24,1055,0)
ORRPW LAB CHEM^OR_CH^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^CH^ORDV02^3
"DATA",101.24,1055,2)
^^Chem & Hematology^Chem & Hematology^^^^^GMTSLRCE
"DATA",101.24,1055,3,0)
^101.243^13^12
"DATA",101.24,1055,3,1,0)
Facility^^1
"DATA",101.24,1055,3,2,0)
Collection Date/Time^^3^^1^17^1^^2
"DATA",101.24,1055,3,3,0)
Specimen^^5^^1^8^1
"DATA",101.24,1055,3,5,0)
Result     ^^6^^1^7^1^Result^1
"DATA",101.24,1055,3,6,0)
Flag^^7^^^4^1
"DATA",101.24,1055,3,7,0)
Units^^8^^^7^1
"DATA",101.24,1055,3,8,0)
Ref Low^^9^^^7^1^Low^1
"DATA",101.24,1055,3,9,0)
Ref High^^10^^^7^1^High^1
"DATA",101.24,1055,3,10,0)
ID^1^2
"DATA",101.24,1055,3,11,0)
Comments^0^11^1^1^^1
"DATA",101.24,1055,3,12,0)
Test Name              ^^4^^1^7^1^Test
"DATA",101.24,1055,3,13,0)
[+]^^12
"DATA",101.24,1055,4)
3:4^^^^^^^1
"DATA",101.24,1056,0)
ORRPW LAB EM^OR_EM^1^6^ORDV01^HSQUERY^0^R^^^^V^203^^^^^^EM^ORDV02A^
"DATA",101.24,1056,2)
^^Electron Microscopy^Electron Microscopy^^^^XEM^ORDVX1
"DATA",101.24,1056,3,0)
^101.243^7^7
"DATA",101.24,1056,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1056,3,2,0)
ID^1^2
"DATA",101.24,1056,3,3,0)
Collection Date^^3^^0^18^0^^2
"DATA",101.24,1056,3,4,0)
Specimen^^4^1^0^10^0^Specimen
"DATA",101.24,1056,3,5,0)
Accession #^^5^^^10^1^Accession #
"DATA",101.24,1056,3,6,0)
Report^1^6^1^1^^1^    
"DATA",101.24,1056,3,7,0)
[+]^^7
"DATA",101.24,1057,0)
ORRPW LAB ORDERS^OR_LO^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^LO^ORDV02^32
"DATA",101.24,1057,2)
^^Lab Orders^Lab Orders^^^^^GMTSLROE
"DATA",101.24,1057,3,0)
^101.243^14^14
"DATA",101.24,1057,3,1,0)
Collection Date/Time^^3^^^18^1^^2
"DATA",101.24,1057,3,2,0)
Test Name               ^^4^^^12^1^Test
"DATA",101.24,1057,3,3,0)
Test ien^1^5
"DATA",101.24,1057,3,4,0)
Specimen^^6^^^3^1^Spec
"DATA",101.24,1057,3,5,0)
Specimen ien^1^7
"DATA",101.24,1057,3,6,0)
Urgency^^8^^^4^1^Urg
"DATA",101.24,1057,3,7,0)
Provider^^9^^^10^1
"DATA",101.24,1057,3,8,0)
Provider ien^1^10
"DATA",101.24,1057,3,9,0)
Ordered Date/Time^^11^^^18^1^^2
"DATA",101.24,1057,3,10,0)
Accession #^^12^^^10^1^Accession
"DATA",101.24,1057,3,11,0)
Available Date/Time^^13^^^18^1^^2
"DATA",101.24,1057,3,12,0)
Facility^^1^^^10^1
"DATA",101.24,1057,3,13,0)
ID^1^2
"DATA",101.24,1057,3,14,0)
Status^^14^^^6^1
"DATA",101.24,1057,4)
3:4^^^^^^^1
"DATA",101.24,1058,0)
ORRPW LAB SP^OR_SP^1^6^ORDV01^HSQUERY^0^R^^^^V^203^^^^^^SP^ORDV02A^
"DATA",101.24,1058,2)
^^Surgical Pathology^Surgical Pathology^^^^XSP^ORDVX1
"DATA",101.24,1058,3,0)
^101.243^7^7
"DATA",101.24,1058,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1058,3,2,0)
ID^1^2
"DATA",101.24,1058,3,3,0)
Collection Date^^3^^0^18^0^^2
"DATA",101.24,1058,3,4,0)
Specimen^^4^1^0^10^0^Specimen
"DATA",101.24,1058,3,5,0)
Accession #^^5^^^10^1^Accession #
"DATA",101.24,1058,3,6,0)
Report^1^6^1^1^^1^    
"DATA",101.24,1058,3,7,0)
[+]^^7
"DATA",101.24,1058,4)
3:4^^^^^^^1
"DATA",101.24,1059,0)
ORRPW LAB CY^OR_CY^1^6^ORDV01^HSQUERY^0^R^^^^V^203^^^^^^CY^ORDV02A
"DATA",101.24,1059,2)
^^Cytology^Cytology^^^^XCY^ORDVX1
"DATA",101.24,1059,3,0)
^101.243^7^7
"DATA",101.24,1059,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1059,3,2,0)
ID^1^2
"DATA",101.24,1059,3,3,0)
Collection Date^^3^^0^18^0^^2
"DATA",101.24,1059,3,4,0)
Specimen^^4^1^0^10^0^Specimen
"DATA",101.24,1059,3,5,0)
Accession #^^5^^^10^1^Accession #
"DATA",101.24,1059,3,6,0)
Report^1^6^1^1^^1^    
"DATA",101.24,1059,3,7,0)
[+]^^7
"DATA",101.24,1059,4)
3:4^^^^^^^1
"DATA",101.24,1060,0)
ORRPW ADT HISTORY^OR_ADT^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^55
"DATA",101.24,1060,2)
^^ADT History^ADT History^^HSTYPEB^ORWRPP1
"DATA",101.24,1061,0)
ORRPW MED AB^OR_MEDA^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^66
"DATA",101.24,1061,2)
^^Abnormal^Medicine abnormal brief^^HSTYPEB^ORWRPP1
"DATA",101.24,1062,0)
ORRPW MED BRIEF^OR_MEDB^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^67
"DATA",101.24,1062,2)
^^Brief Report^Medicine brief report^^HSTYPEB^ORWRPP1
"DATA",101.24,1063,0)
ORRPW MED FULL^OR_MEDC^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^68
"DATA",101.24,1063,2)
^^Full Captioned^Medicine full captioned^^HSTYPEB^ORWRPP1
"DATA",101.24,1064,0)
ORRPW MED FUL REP^OR_MEDF^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^69
"DATA",101.24,1064,2)
^^Full Report^Medicine full report^^HSTYPEB^ORWRPP1
"DATA",101.24,1064,3,0)
^101.243^6^6
"DATA",101.24,1064,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1064,3,2,0)
Date^^3^^^18^1^^2
"DATA",101.24,1064,3,3,0)
Procedure^^4^^^15^1
"DATA",101.24,1064,3,4,0)
Location^^5^^^10^1
"DATA",101.24,1064,3,5,0)
Summary^^7^^^15^1
"DATA",101.24,1064,3,6,0)
ID^1^2
"DATA",101.24,1064,4)
3:4
"DATA",101.24,1065,0)
ORRPW ADT PAST CLINIC^OR_CVP^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^14
"DATA",101.24,1065,2)
^^Past Clinic Visits^Past Clinic Visits^^HSTYPEB^ORWRPP1
"DATA",101.24,1066,0)
ORRPW PCE EDUCATION^OR_ED^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^212
"DATA",101.24,1066,2)
^^Education^PCE Education^^HSTYPEB^ORWRPP1
"DATA",101.24,1067,0)
ORRPW PCE EDUCATION LAT^OR_EDL^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^213
"DATA",101.24,1067,2)
^^Education Latest^PCE Education Latest^^HSTYPEB^ORWRPP1
"DATA",101.24,1068,0)
ORRPW PCE GAF SCORES^OR_PCEG^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^238
"DATA",101.24,1068,2)
^^GAF Scores^PCE GAF Scores^^HSTYPEB^ORWRPP1
"DATA",101.24,1069,0)
ORRPW PCE HEALTH FACT^OR_HF^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^204
"DATA",101.24,1069,2)
^^Health Factors^PCE Health factors all^^HSTYPEB^ORWRPP1
"DATA",101.24,1070,0)
ORRPW PCE IMMUNIZATION^OR_IM^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^207
"DATA",101.24,1070,2)
^^Immunizations^PCE Immunizations^^HSTYPEB^ORWRPP1
"DATA",101.24,1071,0)
ORRPW PCE LOCATION HOME^OR_LH^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^201
"DATA",101.24,1071,2)
^^Location of Home^PCE Location of Home^^HSTYPEB^ORWRPP1
"DATA",101.24,1072,0)
ORRPW PCE OUPT DX^OR_OD^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^220
"DATA",101.24,1072,2)
^^Outpatient Diagnosis^PCE Outpatient Diagnosis^^HSTYPEB^ORWRPP1
"DATA",101.24,1072,4)
^^SADR
"DATA",101.24,1073,0)
ORRPW PCE OUTPT ENCOUNTER^OR_OE^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^205
"DATA",101.24,1073,2)
^^Outpatient Encounter^PCE Outpatient Encounter^^HSTYPEB^ORWRPP1
"DATA",101.24,1073,4)
^^SADR^^^^^1
"DATA",101.24,1074,0)
ORRPW PCE SKIN TEST^OR_ST^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^208
"DATA",101.24,1074,2)
^^Skin Tests^PCE Skin Tests^^HSTYPEB^ORWRPP1
"DATA",101.24,1076,0)
ORRPW PCE EXAM LATEST^OR_EXAM^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^230
"DATA",101.24,1076,2)
^^Exam Latest^PCE Exam Latest^^HSTYPEB^ORWRPP1
"DATA",101.24,1077,0)
ORRPW PCE TREATMENTS PROVIDED^OR_TP^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^231
"DATA",101.24,1077,2)
^^Treatments Provided^PCE Treatments Provided^^HSTYPEB^ORWRPP1
"DATA",101.24,1078,0)
ORRPW PHARMACY ACT OUT^OR_RXA^1^6^ORDV01^HSQUERY^0^R^^^^V^203^^^^^^RXA^ORDV06
"DATA",101.24,1078,2)
^^Active Outpatient^RX Active Outpatient^^^^ACS^PSOHCSUM
"DATA",101.24,1078,3,0)
^101.243^17^17
"DATA",101.24,1078,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1078,3,2,0)
Drug Name                  ^^3^^1^19^1^Drug
"DATA",101.24,1078,3,3,0)
Drug ien^1^4
"DATA",101.24,1078,3,4,0)
RX #     ^^5^^0^10^1^RX #^1
"DATA",101.24,1078,3,5,0)
Status^^6^^^10^0
"DATA",101.24,1078,3,6,0)
Qty^^7^^^5^1^^1
"DATA",101.24,1078,3,7,0)
Exp/Canc Date^^8^^^18^0^^2
"DATA",101.24,1078,3,8,0)
Issue Date    ^^9^^1^18^0^Issue Date^2
"DATA",101.24,1078,3,9,0)
Last Fill Date^^10^^^18^0^^2
"DATA",101.24,1078,3,10,0)
Rem^^11^^^5^1^^1
"DATA",101.24,1078,3,11,0)
Provider^^12^^^12^0
"DATA",101.24,1078,3,12,0)
Cost/Fill^^13^^^10^0^^1
"DATA",101.24,1078,3,13,0)
SIG^^15^^1^10^1
"DATA",101.24,1078,3,14,0)
ID^1^2
"DATA",101.24,1078,3,15,0)
[+]^^14
"DATA",101.24,1078,3,16,0)
Pharmacy ID^1^16^0^0^^0^^0
"DATA",101.24,1078,3,17,0)
Order Number^1^17^0^0^^0^^0
"DATA",101.24,1078,4)
9:3
"DATA",101.24,1079,0)
ORRPW PHARMACY ALL OUT^OR_RXOP^1^6^ORDV01^HSQUERY^0^R^^^^V^203^^^^^^RXOP^ORDV06^28
"DATA",101.24,1079,2)
^^All Outpatient^RX All Outpatient^^^^ACS^PSOHCSUM
"DATA",101.24,1079,3,0)
^101.243^17^17
"DATA",101.24,1079,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1079,3,2,0)
Drug Name               ^^3^^1^19^1^Drug
"DATA",101.24,1079,3,3,0)
Drug ien^1^4
"DATA",101.24,1079,3,4,0)
RX #     ^^5^^0^10^1^RX #^1
"DATA",101.24,1079,3,5,0)
Status^^6^^^8^0
"DATA",101.24,1079,3,6,0)
Qty^^7^^^5^1^^1
"DATA",101.24,1079,3,7,0)
Exp/Canc Date^^8^^^18^0^^2
"DATA",101.24,1079,3,8,0)
Issue Date    ^^9^^1^18^0^Issue Date^2
"DATA",101.24,1079,3,9,0)
Last Fill Date^^10^^^18^0^^2
"DATA",101.24,1079,3,10,0)
Rem^^11^^^5^1^^1
"DATA",101.24,1079,3,11,0)
Provider^^12^^^12^0
"DATA",101.24,1079,3,12,0)
Cost/Fill^^13^^^10^0^^1
"DATA",101.24,1079,3,13,0)
SIG^^15^^1^12^1
"DATA",101.24,1079,3,14,0)
ID^1^2
"DATA",101.24,1079,3,15,0)
[+]^^14
"DATA",101.24,1079,3,16,0)
Pharmacy ID^1^16^0^0^^0
"DATA",101.24,1079,3,17,0)
Order Number^1^17^0^0
"DATA",101.24,1079,4)
9:3^^^^^^^1
"DATA",101.24,1080,0)
ORRPW PHARMACY ACTIVE IV^OR_IVA^1^6^ORDV01^HSQUERY^0^R^^^^V^203^^^^^^RXAV^ORDV06
"DATA",101.24,1080,2)
^^Active IV^RX Active IV^^HSTYPEB^ORWRPP1^ENHS^PSJEEU0
"DATA",101.24,1080,3,0)
^101.243^13^9
"DATA",101.24,1080,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1080,3,2,0)
Additives         ^^3^1^1^^1^Additives
"DATA",101.24,1080,3,3,0)
Solutions         ^0^4^1^1^^1^Solutions
"DATA",101.24,1080,3,7,0)
Rate        ^^5^^^10^1^Rate^1
"DATA",101.24,1080,3,9,0)
Start Date/Time^^7^^1^18^1^^2
"DATA",101.24,1080,3,10,0)
Stop Date/Time^^8^^0^18^1^^2
"DATA",101.24,1080,3,11,0)
ID^1^2
"DATA",101.24,1080,3,12,0)
[+]^^9
"DATA",101.24,1080,3,13,0)
Schedule^0^6^1^1^10^1^Schedule^0
"DATA",101.24,1080,4)
3:6
"DATA",101.24,1081,0)
ORRPW PHARMACY IV^OR_RXIV^1^6^ORDV01^HSQUERY^0^R^^^^V^203^^^^^^RXIV^ORDV06^30
"DATA",101.24,1081,2)
^^All IV^RX All IV^^HSTYPEB^ORWRPP1^ENHS^PSJEEU0
"DATA",101.24,1081,3,0)
^101.243^13^9
"DATA",101.24,1081,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1081,3,2,0)
Solutions^^4^1^1^12^1^Solutions
"DATA",101.24,1081,3,3,0)
Additives         ^0^3^1^1^^1^Additives
"DATA",101.24,1081,3,7,0)
Rate        ^^5^^^7^1^Rate^1
"DATA",101.24,1081,3,9,0)
Start Date/Time^^7^^1^18^1^^2
"DATA",101.24,1081,3,10,0)
Stop Date/Time^^8^^0^18^1^^2
"DATA",101.24,1081,3,11,0)
ID^1^2
"DATA",101.24,1081,3,12,0)
[+]^^9
"DATA",101.24,1081,3,13,0)
Schedule^0^6^1^1^10^1^Schedule^0
"DATA",101.24,1081,4)
3:6
"DATA",101.24,1082,0)
ORRPW PHARMACY UNIT DOSE^OR_RXUD^1^6^ORDV01^HSQUERY^0^R^^^^V^203^^^^^^RXUD^ORDV06^29
"DATA",101.24,1082,2)
^^Unit Dose^RX Unit Dose^^HSTYPEB^ORWRPP1^ENHS^PSJEEU0
"DATA",101.24,1082,3,0)
^101.243^10^10
"DATA",101.24,1082,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1082,3,2,0)
Drug Name                        ^^4^^1^19^1^Drug
"DATA",101.24,1082,3,3,0)
Drug ien^1^3
"DATA",101.24,1082,3,4,0)
Status      ^^6^^^8^1^Status
"DATA",101.24,1082,3,5,0)
Start Date/Time  ^^7^^1^18^1^Start Date/Time^2
"DATA",101.24,1082,3,6,0)
Stop Date/Time  ^^8^^^18^1^Stop Date/Time^2
"DATA",101.24,1082,3,7,0)
Route^^9^^^7^1
"DATA",101.24,1082,3,8,0)
SIG^^10^0^1^12^1
"DATA",101.24,1082,3,9,0)
ID^1^2
"DATA",101.24,1082,3,10,0)
Dose        ^^5^^1^8^1^Dose^1
"DATA",101.24,1082,4)
7:4
"DATA",101.24,1083,0)
ORRPW PROBLEM ACTIVE^OR_PLA^1^6^ORDV01^HSQUERY^0^R^^^^V^203^^^^^^PLAILA^ORDV04^59
"DATA",101.24,1083,2)
^^Active Problems^Active Problems^^^^PLA^ORDV04
"DATA",101.24,1083,3,0)
^101.243^10^10
"DATA",101.24,1083,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1083,3,2,0)
Status^^3^^^4^1^Stat
"DATA",101.24,1083,3,3,0)
Provider Narrative                  ^^4^^1^20^1^Provider Narrative
"DATA",101.24,1083,3,4,0)
Date of Onset^^5^^1^12^1^Date Onset^2
"DATA",101.24,1083,3,5,0)
Date Modified^^6^^^12^1^^2
"DATA",101.24,1083,3,6,0)
Provider Name    ^^7^^0^12^1^Provider
"DATA",101.24,1083,3,7,0)
Note Narrative^1^8^^1^12^1
"DATA",101.24,1083,3,8,0)
ID^1^2
"DATA",101.24,1083,3,9,0)
[+]^^10
"DATA",101.24,1083,3,10,0)
Exposures^0^9^^1^18^0^Exposures
"DATA",101.24,1083,4)
5:4
"DATA",101.24,1084,0)
ORRPW PROBLEM ALL^OR_PLL^1^6^ORDV01^HSQUERY^0^R^^^^V^203^^^^^^PLAILALL^ORDV04^61
"DATA",101.24,1084,2)
^^All Problems^All Problems^^^^PLALL^ORDV04
"DATA",101.24,1084,3,0)
^101.243^10^10
"DATA",101.24,1084,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1084,3,2,0)
Status^^3^^^8^1
"DATA",101.24,1084,3,3,0)
Provider Narrative                  ^^4^^1^15^1^Provider Narrative
"DATA",101.24,1084,3,4,0)
Date of Onset^^5^^1^18^1^^2
"DATA",101.24,1084,3,5,0)
Date Modified^^6^^1^18^1^^2
"DATA",101.24,1084,3,6,0)
Provider Name    ^^7^^0^12^1^Provider
"DATA",101.24,1084,3,7,0)
Note Narrative^1^8^^1^15^1
"DATA",101.24,1084,3,8,0)
ID^1^2
"DATA",101.24,1084,3,9,0)
[+]^^10
"DATA",101.24,1084,3,10,0)
Exposures^0^9^^1^18^0^Exposures
"DATA",101.24,1084,4)
5:4
"DATA",101.24,1085,0)
ORRPW PROBLEM INACTIVE^OR_PLI^1^6^ORDV01^HSQUERY^0^R^^^^V^203^^^^^^PLAILI^ORDV04^60
"DATA",101.24,1085,2)
^^Inactive Problems^Inactive Problems^^^^PLI^ORDV04
"DATA",101.24,1085,3,0)
^101.243^10^10
"DATA",101.24,1085,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1085,3,2,0)
Status^^3^^^8^1
"DATA",101.24,1085,3,3,0)
Provider Narrative                  ^^4^^1^15^1^Provider Narrative
"DATA",101.24,1085,3,4,0)
Date of Onset^^5^^1^18^1^^2
"DATA",101.24,1085,3,5,0)
Date Modified^^6^^^18^1^^2
"DATA",101.24,1085,3,6,0)
Provider Name    ^^7^^0^12^1^Provider
"DATA",101.24,1085,3,7,0)
Note Narrative^1^8^^1^15^1
"DATA",101.24,1085,3,8,0)
ID^1^2
"DATA",101.24,1085,3,9,0)
[+]^^10
"DATA",101.24,1085,3,10,0)
Exposures^0^9^^1^18^0^Exposures
"DATA",101.24,1085,4)
5:4
"DATA",101.24,1086,0)
ORRPW PN PROGRESS NOTES^OR_PN^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^TIUPRG^ORDV04^15
"DATA",101.24,1086,2)
^^Progress Notes^Progress Notes^^^^TPRG^ORDV04
"DATA",101.24,1086,3,0)
^101.243^10^9
"DATA",101.24,1086,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1086,3,3,0)
Date/Time of Note^^4^^0^18^1^Date/Time^2
"DATA",101.24,1086,3,4,0)
Type of Note          ^^5^^0^12^1^Type of Note
"DATA",101.24,1086,3,5,0)
Author of Note       ^^6^^0^12^1^Author
"DATA",101.24,1086,3,6,0)
ID^1^2
"DATA",101.24,1086,3,7,0)
IEN^1^3
"DATA",101.24,1086,3,8,0)
Note Text^1^7^1^1^^1
"DATA",101.24,1086,3,9,0)
[+]^^8
"DATA",101.24,1086,3,10,0)
Identifier^1^9^0^0^^0^^0
"DATA",101.24,1086,4)
4:5^^^^^^^1
"DATA",101.24,1087,0)
ORRPW PN ADV DIRECTIVE^OR_CD^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^25
"DATA",101.24,1087,2)
^^Advance Directive^Advance Directive^^HSTYPEB^ORWRPP1
"DATA",101.24,1088,0)
ORRPW PN CLINICAL WARN^OR_CW^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^4
"DATA",101.24,1088,2)
^^Clinical Warnings^Clinical Warnings^^HSTYPEB^ORWRPP1
"DATA",101.24,1089,0)
ORRPW PN CRISIS NOTES^OR_CN^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^5
"DATA",101.24,1089,2)
^^Crisis Notes^Crisis Notes^^HSTYPEB^ORWRPP1
"DATA",101.24,1090,0)
ORRPW RADIOLOGY IMPRESSION^OR_RI^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^RI^ORDV03^52
"DATA",101.24,1090,2)
^^Impression^Radiology Impression^^^^RAD1^ORDV03
"DATA",101.24,1090,3,0)
^101.243^8^8
"DATA",101.24,1090,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1090,3,2,0)
Exam Date/Time   ^^3^^1^18^1^^2
"DATA",101.24,1090,3,3,0)
Procedure Name              ^^4^^1^15^1^Procedure
"DATA",101.24,1090,3,4,0)
Report Status^^5^^^8^1^Status
"DATA",101.24,1090,3,5,0)
CPT Code^^6^^^7^1
"DATA",101.24,1090,3,6,0)
Impression^1^7^1^1^10^1
"DATA",101.24,1090,3,7,0)
ID^1^2
"DATA",101.24,1090,3,8,0)
[+]^^8
"DATA",101.24,1090,4)
3:4
"DATA",101.24,1091,0)
ORRPW RADIOLOGY REPORT^OR_RP^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^RR^ORDV03^35
"DATA",101.24,1091,2)
^^Report^Radiology Report^^^^RAD2^ORDV03
"DATA",101.24,1091,3,0)
^101.243^11^11
"DATA",101.24,1091,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1091,3,2,0)
Exam Date/Time   ^^3^^1^18^1^^2
"DATA",101.24,1091,3,3,0)
Procedure Name                                 ^^4^^1^15^1^Procedure
"DATA",101.24,1091,3,4,0)
Report Status^^5^^^8^1^Status
"DATA",101.24,1091,3,5,0)
CPT Code^^6^^^7^1
"DATA",101.24,1091,3,6,0)
Report^1^10^1^1^12^1
"DATA",101.24,1091,3,7,0)
ID^1^2
"DATA",101.24,1091,3,8,0)
Clinical History^1^8^1^1^12^1
"DATA",101.24,1091,3,9,0)
Impression^1^9^1^1^12^1
"DATA",101.24,1091,3,10,0)
[+]^^11
"DATA",101.24,1091,3,11,0)
Reason for Study^1^7^1^1^12^1
"DATA",101.24,1091,4)
3:4^^^^^^^1
"DATA",101.24,1092,0)
ORRPW RADIOLOGY STATUS^OR_RS^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^RS^ORDV03^34
"DATA",101.24,1092,2)
^^Status^Radiology Status^^HSTYPEB^ORWRPP1^GET^GMTSRAD
"DATA",101.24,1092,3,0)
^101.243^7^7
"DATA",101.24,1092,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1092,3,2,0)
Request Date/Time^^3^^0^18^1^^2
"DATA",101.24,1092,3,3,0)
Status^^4^^^8^1
"DATA",101.24,1092,3,4,0)
Procedure Name                                  ^^5^^0^15^1^Procedure
"DATA",101.24,1092,3,5,0)
Scheduled Date^^6^^^18^1^^2
"DATA",101.24,1092,3,6,0)
Provider Name     ^^7^^^12^1^Provider
"DATA",101.24,1092,3,7,0)
ID^1^2
"DATA",101.24,1092,4)
3:5
"DATA",101.24,1093,0)
ORRP ANATOMIC PATHOLOGY^20^1^^ORWRP1^AP^2^R^^^^R^203
"DATA",101.24,1093,2)
^^Anatomic Pathology - All Reports^Anatomic Pathology - All Reports
"DATA",101.24,1093,10,0)
^101.241P
"DATA",101.24,1094,0)
ORRP AP EM^24^1^^ORWRP1A^EM^0^R^^^^R^203
"DATA",101.24,1094,2)
^^Electron Microscopy^Electron Microscopy
"DATA",101.24,1095,0)
ORRP AP CY^26^1^^ORWRP1A^CY^0^R^^^^R^203
"DATA",101.24,1095,2)
^^Cytopathology^Cytopathology
"DATA",101.24,1096,0)
ORRP AP SP^25^1^^ORWRP1A^SP^0^R^^^^R^203
"DATA",101.24,1096,2)
^^Surgical Pathology^Surgical Pathology
"DATA",101.24,1097,0)
ORRP AP AU^27^1^^ORWRP1A^AU^0^L^^^^R^203
"DATA",101.24,1097,2)
^^Autopsy^Autopsy
"DATA",101.24,1098,0)
ORRP PROBLEM LIST^21^^^ORWRP1^PROB^0^R^^^^R^203
"DATA",101.24,1098,2)
^^Problem List^Problem List^^PROBB^ORWRPP1
"DATA",101.24,1100,0)
ORRPW ORDERS CURRENT^OR_ORC^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^ORC^ORDV04^54
"DATA",101.24,1100,2)
^^Orders Current^Orders Current^^^^ORCVA^ORDV04
"DATA",101.24,1100,3,0)
^101.243^8^8
"DATA",101.24,1100,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1100,3,2,0)
Item Ordered                                           ^^3^1^1^^1^Item Ordered
"DATA",101.24,1100,3,3,0)
Current Status^^4^^0^10^1^Status
"DATA",101.24,1100,3,4,0)
Start Date/Time    ^^5^^1^18^1^Start Date/Time^2
"DATA",101.24,1100,3,5,0)
Stop Date/Time     ^^6^^^18^1^Stop Date/Time^2
"DATA",101.24,1100,3,6,0)
ID^1^2
"DATA",101.24,1100,3,7,0)
[+]^^7
"DATA",101.24,1100,3,8,0)
Order Number^1^8^0^0^^0^N^0
"DATA",101.24,1100,4)
5:3
"DATA",101.24,1101,0)
ORRPW ADT VISITS^OR_VISITS^1^^^^^R^^^^M^^^^^^^^^6
"DATA",101.24,1101,2)
^^Visits / Admissions^Visits / Admissions^^HSTYPEB^ORWRPP1
"DATA",101.24,1101,10,0)
^101.241P^14^10
"DATA",101.24,1101,10,4,0)
1036
"DATA",101.24,1101,10,6,0)
1037
"DATA",101.24,1101,10,7,0)
1038
"DATA",101.24,1101,10,8,0)
1039
"DATA",101.24,1101,10,9,0)
1040
"DATA",101.24,1101,10,10,0)
1065
"DATA",101.24,1101,10,11,0)
1041
"DATA",101.24,1101,10,12,0)
1042
"DATA",101.24,1101,10,13,0)
1043
"DATA",101.24,1101,10,14,0)
1044
"DATA",101.24,1102,0)
ORRPW DOD^OR_DOD^^^^^^R^^^^M
"DATA",101.24,1102,2)
^^Dept. of Defense Reports^Dept. of Defense Reports
"DATA",101.24,1102,10,0)
^101.241P^11^11
"DATA",101.24,1102,10,1,0)
1137
"DATA",101.24,1102,10,2,0)
1131
"DATA",101.24,1102,10,3,0)
1139
"DATA",101.24,1102,10,4,0)
1130
"DATA",101.24,1102,10,5,0)
1104
"DATA",101.24,1102,10,6,0)
1140
"DATA",101.24,1102,10,7,0)
1105
"DATA",101.24,1102,10,8,0)
1554
"DATA",101.24,1102,10,9,0)
1557
"DATA",101.24,1102,10,10,0)
1106
"DATA",101.24,1102,10,11,0)
1141
"DATA",101.24,1104,0)
ORRPW DOD LAB^OR_DODLAB^^^^^^R^^^^M
"DATA",101.24,1104,2)
^^Laboratory^Laboratory
"DATA",101.24,1104,4)
^^^^^^^
"DATA",101.24,1104,10,0)
^101.241P^5^5
"DATA",101.24,1104,10,1,0)
1134
"DATA",101.24,1104,10,2,0)
1132
"DATA",101.24,1104,10,3,0)
1135
"DATA",101.24,1104,10,4,0)
1136
"DATA",101.24,1104,10,5,0)
1133
"DATA",101.24,1105,0)
ORRPW DOD PHARM ALL OUT^OR_DODRXOP^1^6^ORDV01^HSQUERY^0^R^^^^V^203^^^^^^RXOP^ORDV06^28
"DATA",101.24,1105,2)
^^Pharmacy All Outpatient^DOD Pharmacy All Outpatient^^^^^PSOHCSUM
"DATA",101.24,1105,3,0)
^101.243^17^17
"DATA",101.24,1105,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1105,3,2,0)
Drug Name               ^^3^^1^19^1^Drug
"DATA",101.24,1105,3,3,0)
Drug ien^1^4
"DATA",101.24,1105,3,4,0)
RX #     ^^5^^0^10^1^RX #^1
"DATA",101.24,1105,3,5,0)
Status^^6^^^8^1
"DATA",101.24,1105,3,6,0)
Qty^^7^^^5^1^^1
"DATA",101.24,1105,3,7,0)
Exp/Canc Date^^8^^^18^1^^2
"DATA",101.24,1105,3,8,0)
Issue Date    ^^9^^1^18^1^Issue Date^2
"DATA",101.24,1105,3,9,0)
Last Fill Date^^10^^^18^1^^2
"DATA",101.24,1105,3,10,0)
Rem^^11^^^5^1^^1
"DATA",101.24,1105,3,11,0)
Provider^^12^^^12^1
"DATA",101.24,1105,3,12,0)
Cost/Fill^^13^^^10^1^^1
"DATA",101.24,1105,3,13,0)
SIG^^15^^1^12^1
"DATA",101.24,1105,3,14,0)
ID^1^2
"DATA",101.24,1105,3,15,0)
[+]^^14
"DATA",101.24,1105,3,16,0)
Pharmacy ID^1^16^0^0^^0^^0
"DATA",101.24,1105,3,17,0)
Order Number^1^17^0^0^^0^^0
"DATA",101.24,1105,4)
9:3^^^^^^^1
"DATA",101.24,1106,0)
ORRPW DOD RAD REPORT^OR_DODRP^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^RRDOD^ORDV03^35
"DATA",101.24,1106,2)
^^Radiology Report^DOD Radiology Report^^^^RAD2^ORDV03
"DATA",101.24,1106,3,0)
^101.243^10^10
"DATA",101.24,1106,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1106,3,2,0)
Exam Date/Time   ^^3^^1^18^1^^2
"DATA",101.24,1106,3,3,0)
Procedure Name                                 ^^4^^1^15^1^Procedure
"DATA",101.24,1106,3,4,0)
Report Status^^5^^^8^1^Status
"DATA",101.24,1106,3,5,0)
CPT Code^^6^^^7^1
"DATA",101.24,1106,3,6,0)
Report^1^9^1^1^12^1
"DATA",101.24,1106,3,7,0)
ID^1^2
"DATA",101.24,1106,3,8,0)
Clinical History^1^7^1^1^12^1
"DATA",101.24,1106,3,9,0)
Impression^1^8^1^1^12^1
"DATA",101.24,1106,3,10,0)
[+]^^10
"DATA",101.24,1106,4)
3:4^^^^^^^1
"DATA",101.24,1107,0)
ORRP ECS PCE SUMMARY^OR_ECS1^^2^^^1^R^1^^^R
"DATA",101.24,1107,2)
^^Patient PCE Summary^Report from Event Capture
"DATA",101.24,1108,0)
ORRP ECS PT SUMMARY^OR_ECS2^^2^^^1^R^1^^^R
"DATA",101.24,1108,2)
^^Patient Data Summary^Report from Event Capture
"DATA",101.24,1109,0)
ORRP ECS^OR_ECS^^^^^^R^1^^^M
"DATA",101.24,1109,2)
^^Event Capture^Event Capture Report
"DATA",101.24,1109,10,0)
^101.241P^2^2
"DATA",101.24,1109,10,1,0)
1107^^1
"DATA",101.24,1109,10,2,0)
1108^^2
"DATA",101.24,1130,0)
ORRPW DOD DISCHARGE SUMMARY^OR_DODDS^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^TIUDCS^ORDV04^57
"DATA",101.24,1130,2)
^^Discharge Summary^DOD Discharge Summary^^HSTYPEB^ORWRPP1^TDCS^ORDV04
"DATA",101.24,1130,3,0)
^101.243^11^9
"DATA",101.24,1130,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1130,3,2,0)
Admitted Date/Time^^3^^^18^1^Admitted^2
"DATA",101.24,1130,3,3,0)
Discharged Date/Time^^4^^^18^1^Discharged^2
"DATA",101.24,1130,3,4,0)
Author / Dictated By^^5^^^10^1
"DATA",101.24,1130,3,5,0)
Approved By        ^^6^^^12^1^Approved By
"DATA",101.24,1130,3,6,0)
Current Status^^7^^^10^1^Status
"DATA",101.24,1130,3,9,0)
ID^1^2
"DATA",101.24,1130,3,10,0)
Summary^1^8^1^1^^1
"DATA",101.24,1130,3,11,0)
[+]^0^9
"DATA",101.24,1130,4)
3:5^^^^^^^1
"DATA",101.24,1131,0)
ORRPW DOD ADT EXP^OR_DODEADT^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^64
"DATA",101.24,1131,2)
^^Expanded ADT^DOD Expanded ADT^^HSTYPEB^ORWRPP1
"DATA",101.24,1131,4)
^^ADT^^^^^1
"DATA",101.24,1132,0)
ORRPW DOD LAB CHEM^OR_DODCH^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^CH^ORDV02^3
"DATA",101.24,1132,2)
^^Chem & Hematology^DOD Chem & Hematology^^^^^GMTSLRCE
"DATA",101.24,1132,3,0)
^101.243^13^12
"DATA",101.24,1132,3,1,0)
Facility^^1
"DATA",101.24,1132,3,2,0)
Collection Date/Time^^3^^1^17^1^^2
"DATA",101.24,1132,3,3,0)
Specimen^^5^^1^8^1
"DATA",101.24,1132,3,5,0)
Result     ^^6^^1^7^1^Result^1
"DATA",101.24,1132,3,6,0)
Flag^^7^^^4^1
"DATA",101.24,1132,3,7,0)
Units^^8^^^7^1
"DATA",101.24,1132,3,8,0)
Ref Low^^9^^^7^1^Low^1
"DATA",101.24,1132,3,9,0)
Ref High^^10^^^7^1^High^1
"DATA",101.24,1132,3,10,0)
ID^1^2
"DATA",101.24,1132,3,11,0)
Comments^0^11^1^1^^1
"DATA",101.24,1132,3,12,0)
Test Name              ^^4^^1^7^1^Test
"DATA",101.24,1132,3,13,0)
[+]^^12
"DATA",101.24,1132,4)
3:4^^^^^^^1
"DATA",101.24,1133,0)
ORRPW DOD LAB MICRO^OR_DODMIC^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^MI^ORDV05^38
"DATA",101.24,1133,2)
^^Microbiology^DOD Microbiology^^^^GET^ORDV05E
"DATA",101.24,1133,3,0)
^101.243^10^9
"DATA",101.24,1133,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1133,3,2,0)
ID^1^2
"DATA",101.24,1133,3,3,0)
Collection Date/Time^^3^^0^18^1^^2
"DATA",101.24,1133,3,4,0)
Specimen^^6^^^10^1
"DATA",101.24,1133,3,5,0)
Microbiology Test Name     ^^4^^0^15^1^Test
"DATA",101.24,1133,3,7,0)
Accession #   ^^7^^^10^1^Accession #
"DATA",101.24,1133,3,8,0)
Collection Sample^^5^^0^12^1^Sample
"DATA",101.24,1133,3,9,0)
Report^1^8^1^1^^1
"DATA",101.24,1133,3,10,0)
[+]^^9
"DATA",101.24,1133,4)
3:4^^^^^^^1
"DATA",101.24,1134,0)
ORRPW DOD LAB ORDERS^OR_DODLO^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^LO^ORDV02^32
"DATA",101.24,1134,2)
^^Lab Orders^DOD Lab Orders^^^^^GMTSLROE
"DATA",101.24,1134,3,0)
^101.243^14^14
"DATA",101.24,1134,3,1,0)
Collection Date/Time^^3^^^18^1^^2
"DATA",101.24,1134,3,2,0)
Test Name               ^^4^^^12^1^Test
"DATA",101.24,1134,3,3,0)
Test ien^1^5
"DATA",101.24,1134,3,4,0)
Specimen^^6^^^3^1^Spec
"DATA",101.24,1134,3,5,0)
Specimen ien^1^7
"DATA",101.24,1134,3,6,0)
Urgency^^8^^^4^1^Urg
"DATA",101.24,1134,3,7,0)
Provider^^9^^^10^1
"DATA",101.24,1134,3,8,0)
Provider ien^1^10
"DATA",101.24,1134,3,9,0)
Ordered Date/Time^^11^^^18^1^^2
"DATA",101.24,1134,3,10,0)
Accession #^^12^^^10^1^Accession
"DATA",101.24,1134,3,11,0)
Available Date/Time^^13^^^18^1^^2
"DATA",101.24,1134,3,12,0)
Facility^^1^^^10^1
"DATA",101.24,1134,3,13,0)
ID^1^2
"DATA",101.24,1134,3,14,0)
Status^^14^^^6^1
"DATA",101.24,1134,4)
3:4^^^^^^^1
"DATA",101.24,1135,0)
ORRPW DOD LAB SP^OR_DODSP^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^SP^ORDV02^46
"DATA",101.24,1135,2)
^^Surgical Pathology (DOD Remote data only)^DOD Surgical Pathology^^^^^GMTSLRAE
"DATA",101.24,1135,3,0)
^101.243^12^12
"DATA",101.24,1135,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1135,3,2,0)
Collection Date^^3^^1^18^1^^2
"DATA",101.24,1135,3,3,0)
Accession #   ^^5^^^10^1^Accession #
"DATA",101.24,1135,3,4,0)
Specimen                   ^0^4^1^1^10^1^Specimen
"DATA",101.24,1135,3,5,0)
Brief Clin. Hx.^1^6^1^1^^1
"DATA",101.24,1135,3,6,0)
Gross Desc.^1^7^1^1^^1
"DATA",101.24,1135,3,7,0)
Microscopic Exam^1^8^1^1^^1
"DATA",101.24,1135,3,8,0)
Supplementary Rpt^1^9^1^1^^1
"DATA",101.24,1135,3,9,0)
Frozen Section^1^10^1^1^^1
"DATA",101.24,1135,3,10,0)
Surgical Path Dx^1^11^1^1^^1
"DATA",101.24,1135,3,11,0)
ID^1^2
"DATA",101.24,1135,3,12,0)
[+]^^12
"DATA",101.24,1135,4)
3:4^^^^^^^1^1
"DATA",101.24,1136,0)
ORRPW DOD LAB CY^OR_DODCY^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^CY^ORDV02^48
"DATA",101.24,1136,2)
^^Cytology (DOD Remote data only)^DOD Cytology^^^^^GMTSLRPE
"DATA",101.24,1136,3,0)
^101.243^12^12
"DATA",101.24,1136,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1136,3,2,0)
Collection Date^^3^^1^18^1^^2
"DATA",101.24,1136,3,3,0)
Accession #   ^^6^^^10^1^Accession #
"DATA",101.24,1136,3,4,0)
Report Release Date^^5^^^18^1^^2
"DATA",101.24,1136,3,5,0)
Specimen                    ^^4^1^1^10^1^Specimen
"DATA",101.24,1136,3,6,0)
Brief Clin. Hx^1^7^1^1^^1
"DATA",101.24,1136,3,7,0)
Gross Desc.^1^8^1^1^^1
"DATA",101.24,1136,3,8,0)
Microscopic Exam^1^9^1^1^^1
"DATA",101.24,1136,3,9,0)
Cytopathology Dx^1^10^1^1^12^1^Cytopath DX
"DATA",101.24,1136,3,10,0)
Supplementary Rpt^1^11^1^1^^1
"DATA",101.24,1136,3,11,0)
ID^1^2
"DATA",101.24,1136,3,12,0)
[+]^^12
"DATA",101.24,1136,4)
3:4^^^^^^^1^1
"DATA",101.24,1137,0)
ORRPW DOD ALLERGIES ADV^OR_DODBADR^1^6^ORDV01^HSQUERY^0^R^^^^V^203^^^^^^ADR^ORDV01^73
"DATA",101.24,1137,2)
^^Allergies^DOD Allergies^^^^^GMRADPT
"DATA",101.24,1137,3,0)
^101.243^8^8
"DATA",101.24,1137,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1137,3,2,0)
Allergy Type^^4^^0^10^1
"DATA",101.24,1137,3,3,0)
Allergy Reactant^^3^^0^20^1^Reactant
"DATA",101.24,1137,3,4,0)
Verification Date/Time^^5^^0^18^1^^2
"DATA",101.24,1137,3,5,0)
Observed/Historical^^6^^^13^1^Observed/Hist
"DATA",101.24,1137,3,6,0)
ID^1^2
"DATA",101.24,1137,3,7,0)
Comments^1^7^1^1^^1
"DATA",101.24,1137,3,8,0)
Allergy IEN^1^8^0^0^^0^^0
"DATA",101.24,1137,4)
5:3^^^^^^^1
"DATA",101.24,1138,0)
ORCV IMMUNIZATIONS^90^^^ORQQPX^IMMLIST^^C^1^^Purple^S^150^T^3^15,35^2,4,3^41
"DATA",101.24,1138,2)
^^Recent Immunizations^Recent Immunizations^IMM
"DATA",101.24,1139,0)
ORRPW DOD CONSULTS^OR CN^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^CONSLT^ORDV09
"DATA",101.24,1139,2)
^^Consults (DOD Remote data only)^DOD Consults^^^^CONX^ORDV09
"DATA",101.24,1139,3,0)
^101.243^14^9
"DATA",101.24,1139,3,1,0)
Facility^^1^^^^1
"DATA",101.24,1139,3,2,0)
Request Date/Time^^3^^^18^1^Requested^2
"DATA",101.24,1139,3,3,0)
Completion Date/Time^^4^^^18^1^Completed^2
"DATA",101.24,1139,3,4,0)
Status^^6^^^9^1
"DATA",101.24,1139,3,6,0)
Consult Service^^5^^^12^1
"DATA",101.24,1139,3,7,0)
Procedure Type^^7^^^15^1
"DATA",101.24,1139,3,11,0)
Report Text^1^8^1^1^^1
"DATA",101.24,1139,3,13,0)
[+]^^9
"DATA",101.24,1139,3,14,0)
ID^1^2
"DATA",101.24,1139,4)
^^^^^^^1^1
"DATA",101.24,1140,0)
ORRPW DOD PCE OUTPT ENCOUNTER^OR_DODOE^1^5^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^^^205
"DATA",101.24,1140,2)
^^Outpatient Encounter^DOD PCE Outpatient Encounter^^HSTYPEB^ORWRPP1
"DATA",101.24,1140,4)
^^SADR^^^^^1
"DATA",101.24,1141,0)
ORRPW DOD VITALS^OR_DODVS^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^VS^ORDV04^47
"DATA",101.24,1141,2)
^^Vital Signs^Vital Signs^^^^EN1^GMVHS
"DATA",101.24,1141,3,0)
^101.243^18^18
"DATA",101.24,1141,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1141,3,2,0)
Measurement Date/Time^^3^^^18^1^^2
"DATA",101.24,1141,3,3,0)
TEMP^^4^^^5^1^^1
"DATA",101.24,1141,3,4,0)
PULSE^^5^^^5^1^^1
"DATA",101.24,1141,3,5,0)
RESP^^6^^^5^1^^1
"DATA",101.24,1141,3,6,0)
Blood Pressure^^7^^^12^1^Pressure
"DATA",101.24,1141,3,7,0)
Height^^8^^^6^1^^1
"DATA",101.24,1141,3,8,0)
Weight^^9^^^6^1^^1
"DATA",101.24,1141,3,9,0)
ID^1^2
"DATA",101.24,1141,3,10,0)
Pain^^10^^^6
"DATA",101.24,1141,3,11,0)
POx^^11^^^6
"DATA",101.24,1141,3,12,0)
CVP^^12^^^6
"DATA",101.24,1141,3,13,0)
C/G^^13^^^6
"DATA",101.24,1141,3,14,0)
Flow Rate (l/min)^1^14^^1^6^1^Rate l/min
"DATA",101.24,1141,3,15,0)
O2 Concentration (%)^1^15^^1^6^1^O2 %
"DATA",101.24,1141,3,16,0)
Qualifiers^1^16^^1^20^1^Qualif
"DATA",101.24,1141,3,17,0)
BMI^1^17^^1^6^1^BMI
"DATA",101.24,1141,3,18,0)
Units^1^18^^1^20^1^Units
"DATA",101.24,1141,4)
3:0^^^^^^^1
"DATA",101.24,1150,0)
ORWG GRAPHING^OR_GRAPHS^^2^^^1^R^^^^G^^T
"DATA",101.24,1150,2)
^^Graphing (local only)^Graphing
"DATA",101.24,1550,0)
ORRPW HDR^OR_HDR_IMS^^^^^^R^^^^M
"DATA",101.24,1550,2)
^^HDR Reports^HDR Reports
"DATA",101.24,1550,10,0)
^101.241P^4^4
"DATA",101.24,1550,10,1,0)
1551^^1
"DATA",101.24,1550,10,2,0)
1556^^2
"DATA",101.24,1550,10,3,0)
1553^^3
"DATA",101.24,1550,10,4,0)
1552^^4
"DATA",101.24,1551,0)
ORRPW HDR ALLERGIES^OR_VWAL^2^6^ORDV01^HSQUERY^0^R^^^^V^203^^^^^^ADR^ORDV01^73
"DATA",101.24,1551,2)
^^Allergies^Allergies HDR^^^^^GMRADPT
"DATA",101.24,1551,3,0)
^101.243^8^8
"DATA",101.24,1551,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1551,3,2,0)
Allergy Type^^4^^0^10^1
"DATA",101.24,1551,3,3,0)
Allergy Reactant^^3^^0^20^1^Reactant
"DATA",101.24,1551,3,4,0)
Verification Date/Time^^5^^0^18^1^^2
"DATA",101.24,1551,3,5,0)
Observed/Historical^^6^^^13^1^Observed/Hist
"DATA",101.24,1551,3,6,0)
ID^1^2
"DATA",101.24,1551,3,7,0)
Comments^1^7^1^1^^1
"DATA",101.24,1551,3,8,0)
Allergy IEN^1^8^0^0^^0^^0
"DATA",101.24,1551,4)
5:3^^^^1^ORWRP4A^ADR
"DATA",101.24,1552,0)
ORRPW HDR VITALS^OR_VWVS^2^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^VS^ORDV04^47
"DATA",101.24,1552,2)
^^Vital Signs^Vital Signs HDR^^^^EN1^GMVHS
"DATA",101.24,1552,3,0)
^101.243^18^18
"DATA",101.24,1552,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1552,3,2,0)
Measurement Date/Time^^3^^^18^1^^2
"DATA",101.24,1552,3,3,0)
TEMP^^4^^^5^1^^1
"DATA",101.24,1552,3,4,0)
PULSE^^5^^^5^1^^1
"DATA",101.24,1552,3,5,0)
RESP^^6^^^5^1^^1
"DATA",101.24,1552,3,6,0)
Blood Pressure^^7^^^12^1^Pressure
"DATA",101.24,1552,3,7,0)
Height^^8^^^6^1^^1
"DATA",101.24,1552,3,8,0)
Weight^^9^^^6^1^^1
"DATA",101.24,1552,3,9,0)
ID^1^2
"DATA",101.24,1552,3,10,0)
Pain^^10^^^6
"DATA",101.24,1552,3,11,0)
POx^^11^^^6
"DATA",101.24,1552,3,12,0)
CVP^^12^^^6
"DATA",101.24,1552,3,13,0)
C/G^^13^^^6
"DATA",101.24,1552,3,14,0)
Flow Rate (l/min)^1^14^^1^6^1^Rate l/min
"DATA",101.24,1552,3,15,0)
O2 Concentration (%)^1^15^^1^6^1^O2 %
"DATA",101.24,1552,3,16,0)
Qualifiers^1^16^^1^20^1^Qualif
"DATA",101.24,1552,3,17,0)
Methods^1^17^^1^20^1^Methods
"DATA",101.24,1552,3,18,0)
Units^1^18^^1^20^1^Units
"DATA",101.24,1552,4)
3:0^^^^1^ORWRP4V^VS
"DATA",101.24,1553,0)
ORRPW HDR PHARMACY OUT^OR_VWRX^2^6^ORDV01^HSQUERY^0^R^^^^V^203^^^^^^RXOP^ORDV06^28
"DATA",101.24,1553,2)
^^Pharmacy All Outpatient^Pharmacy All Outpatient HDR^^^^^PSOHCSUM
"DATA",101.24,1553,3,0)
^101.243^17^17
"DATA",101.24,1553,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1553,3,2,0)
Drug Name               ^^3^^1^19^1^Drug
"DATA",101.24,1553,3,3,0)
Drug ien^1^4
"DATA",101.24,1553,3,4,0)
RX #     ^^5^^0^10^1^RX #^1
"DATA",101.24,1553,3,5,0)
Status^^6^^^8^1
"DATA",101.24,1553,3,6,0)
Qty^^7^^^5^1^^1
"DATA",101.24,1553,3,7,0)
Exp/Canc Date^^8^^^18^1^^2
"DATA",101.24,1553,3,8,0)
Issue Date    ^^9^^1^18^1^Issue Date^2
"DATA",101.24,1553,3,9,0)
Last Fill Date^^10^^^18^1^^2
"DATA",101.24,1553,3,10,0)
Rem^^11^^^5^1^^1
"DATA",101.24,1553,3,11,0)
Provider^^12^^^12^1
"DATA",101.24,1553,3,12,0)
Cost/Fill^^13^^^10^1^^1
"DATA",101.24,1553,3,13,0)
SIG^^15^^1^12^1
"DATA",101.24,1553,3,14,0)
ID^1^2
"DATA",101.24,1553,3,15,0)
[+]^^14
"DATA",101.24,1553,3,16,0)
Pharmacy ID^1^16^0^0^^0^^0
"DATA",101.24,1553,3,17,0)
Order Number^1^17^0^0^^0^^0
"DATA",101.24,1553,4)
9:3^^^^1^ORWRP4P^PSO
"DATA",101.24,1554,0)
ORRPW DOD PN PROGRESS NOTES^OR_DODPN^1^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^TIUPRG^ORDV04^15
"DATA",101.24,1554,2)
^^Progress Notes^DOD Progress Notes^^^^TPRG^ORDV04
"DATA",101.24,1554,3,0)
^101.243^10^9
"DATA",101.24,1554,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1554,3,3,0)
Date/Time of Note^^4^^0^18^1^Date/Time^2
"DATA",101.24,1554,3,4,0)
Type of Note          ^^5^^0^12^1^Type of Note
"DATA",101.24,1554,3,5,0)
Author of Note       ^^6^^0^12^1^Author
"DATA",101.24,1554,3,6,0)
ID^1^2
"DATA",101.24,1554,3,7,0)
IEN^1^3
"DATA",101.24,1554,3,8,0)
Note Text^1^7^1^1^^1
"DATA",101.24,1554,3,9,0)
[+]^^8
"DATA",101.24,1554,3,10,0)
Identifier^1^9^0^0^^0^^0
"DATA",101.24,1554,4)
4:5^^PN^^^^^1
"DATA",101.24,1555,0)
ORRPW PHARMACY NON-VA MEDS^OR_RXN^1^6^ORDV01^HSQUERY^0^R^^^^V^203^^^^^^NVA^ORDV06A
"DATA",101.24,1555,2)
^^Herbal/OTC/Non-VA Meds^Herbal/OTC/Non-VA Meds^^^^ACS^PSOHCSUM
"DATA",101.24,1555,3,0)
^101.243^11^11
"DATA",101.24,1555,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1555,3,2,0)
Herbal/OTC/Non VA Med^^3^^1^20^1^Item
"DATA",101.24,1555,3,3,0)
Status^^4^^^^1^Status
"DATA",101.24,1555,3,4,0)
Start Date^^5^^^^1^Start Date^2
"DATA",101.24,1555,3,5,0)
Date Documented^^6^^^^1^DC'd^2
"DATA",101.24,1555,3,6,0)
Documented By^^7^^^^1^Doc By
"DATA",101.24,1555,3,7,0)
Date DC'd^^8^^^^1^Date DC'd^2
"DATA",101.24,1555,3,8,0)
Comments^^11^1^1^^1^Comments
"DATA",101.24,1555,3,9,0)
ID^1^2
"DATA",101.24,1555,3,10,0)
[+]^^10
"DATA",101.24,1555,3,11,0)
SIG^^9^^1^^1^SIG
"DATA",101.24,1556,0)
ORRPW HDR LAB CHEM^OR_LRC^2^6^ORDV01^HSQUERY^6^R^^^^V^203^^^^^^CH^ORDV02^3
"DATA",101.24,1556,2)
^^Chem & Hematology^Chem & Hematology HDR^^^^^GMTSLRCE
"DATA",101.24,1556,3,0)
^101.243^15^13
"DATA",101.24,1556,3,1,0)
Facility^^1
"DATA",101.24,1556,3,2,0)
Collection Date/Time^^3^^1^17^1^^2
"DATA",101.24,1556,3,3,0)
Specimen^^5^^1^8^1
"DATA",101.24,1556,3,5,0)
Result     ^^6^^1^7^1^Result^1
"DATA",101.24,1556,3,6,0)
Flag^^7^^^4^1
"DATA",101.24,1556,3,7,0)
Units^^8^^^7^1
"DATA",101.24,1556,3,8,0)
Ref Range^^9^^^12^1^RefRange^0
"DATA",101.24,1556,3,10,0)
ID^1^2
"DATA",101.24,1556,3,11,0)
Comments^0^11^1^1^^1
"DATA",101.24,1556,3,12,0)
Test Name              ^^4^^1^7^1^Test
"DATA",101.24,1556,3,13,0)
[+]^^12
"DATA",101.24,1556,3,14,0)
Order Comments^1^13^^1^20^1^Ord Com
"DATA",101.24,1556,3,15,0)
Result Interpretation^1^14^^1^20^1^Interp
"DATA",101.24,1556,4)
3:4^^^^1^ORWRP4L^CH
"DATA",101.24,1557,0)
ORRPW DOD PROBLEM LIST ALL^OR_DODPLL^1^6^ORDV01^HSQUERY^0^R^^^^V^203^^^^^^PLAILALL^ORDV04^61
"DATA",101.24,1557,2)
^^All Problem List^All Problem List^^^^PLALL^ORDV04
"DATA",101.24,1557,3,0)
^101.243^10^10
"DATA",101.24,1557,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1557,3,2,0)
Status^^3^^^8^1
"DATA",101.24,1557,3,3,0)
Provider Narrative                  ^^4^^1^15^1^Provider Narrative
"DATA",101.24,1557,3,4,0)
Date of Onset^^5^^1^18^1^^2
"DATA",101.24,1557,3,5,0)
Date Modified^^6^^1^18^1^^2
"DATA",101.24,1557,3,6,0)
Provider Name    ^^7^^0^12^1^Provider
"DATA",101.24,1557,3,7,0)
Note Narrative^1^8^^1^15^1
"DATA",101.24,1557,3,8,0)
ID^1^2
"DATA",101.24,1557,3,9,0)
[+]^^10
"DATA",101.24,1557,3,10,0)
Exposures^0^9^^1^18^0^Exposures
"DATA",101.24,1557,4)
5:4^^PLL^^^^^1
"DATA",101.24,1600,0)
ORRPL LAB CY^OR_CYL^1^6^ORDV01^HSQUERY^0^L^^^^V^203^^^^^^CY^ORDV02A
"DATA",101.24,1600,2)
^^Cytology^Cytology^^^^XCY^ORDVX1
"DATA",101.24,1600,3,0)
^101.243^7^7
"DATA",101.24,1600,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1600,3,2,0)
ID^1^2
"DATA",101.24,1600,3,3,0)
Collection Date^^3^^0^18^0^^2
"DATA",101.24,1600,3,4,0)
Specimen               ^^4^1^0^10^0^Specimen
"DATA",101.24,1600,3,5,0)
Accession #^^5^^^10^1^Accession #
"DATA",101.24,1600,3,6,0)
Report^1^6^1^1^^1^    
"DATA",101.24,1600,3,7,0)
[+]^^7
"DATA",101.24,1600,4)
3:4^^^^^^^1
"DATA",101.24,1601,0)
ORRPL LAB EM^OR_EML^1^6^ORDV01^HSQUERY^0^L^^^^V^203^^^^^^EM^ORDV02A
"DATA",101.24,1601,2)
^^Electron Microscopy^Electron Microscopy^^HSTYPEB^ORWRPP1^XEM^ORDVX1
"DATA",101.24,1601,3,0)
^101.243^7^7
"DATA",101.24,1601,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1601,3,2,0)
ID^1^2
"DATA",101.24,1601,3,3,0)
Collection Date^^3^^0^18^0^^2
"DATA",101.24,1601,3,4,0)
Specimen^^4^1^0^10^0^Specimen
"DATA",101.24,1601,3,5,0)
Accession #^^5^^^10^1^Accession #
"DATA",101.24,1601,3,6,0)
Report^1^6^1^1^^1^    
"DATA",101.24,1601,3,7,0)
[+]^^7
"DATA",101.24,1602,0)
ORRPL LAB SP^OR_SPL^1^6^ORDV01^HSQUERY^0^L^^^^V^203^^^^^^SP^ORDV02A
"DATA",101.24,1602,2)
^^Surgical Pathology^Surgical Pathology^^^^XSP^ORDVX1
"DATA",101.24,1602,3,0)
^101.243^7^7
"DATA",101.24,1602,3,1,0)
Facility^^1^^^10^1
"DATA",101.24,1602,3,2,0)
ID^1^2
"DATA",101.24,1602,3,3,0)
Collection Date^^3^^0^18^0^^2
"DATA",101.24,1602,3,4,0)
Specimen^^4^1^0^10^0^Specimen
"DATA",101.24,1602,3,5,0)
Accession #^^5^^^10^1^Accession #
"DATA",101.24,1602,3,6,0)
Report^1^6^1^1^^1^    
"DATA",101.24,1602,3,7,0)
[+]^^7
"DATA",101.24,1602,4)
3:4^^^^^^^1
"DATA",101.24,1602,10,0)
^101.241P
"DATA",101.24,1603,0)
ORRPW LAB AU^OR_AU^1^^ORWRP1A^AU^0^R^^^^R^203
"DATA",101.24,1603,2)
^^Autopsy^Autopsy
"DATA",101.41,1,0)
RA OERR EXAM^Imaging^^D^31^2^18^1^2
"DATA",101.41,1,3)
D EN^ORCDRA
"DATA",101.41,1,3.1)
D ENA^ORCDRA
"DATA",101.41,1,4)
D EX^ORCDRA
"DATA",101.41,1,5)
^^^Imaging^160^^^
"DATA",101.41,1,10,0)
^101.412IA^17^17
"DATA",101.41,1,10,1,0)
1^4^^Procedure: ^^1^^^^S.XRAY;C.XRAY
"DATA",101.41,1,10,1,1)
Enter the imaging procedure to be ordered for this patient.^LKP;ORCDRA
"DATA",101.41,1,10,1,2)
1
"DATA",101.41,1,10,1,4)
I $$ACTIVE^ORDD43(Y),'(ORBROAD&($P($G(^("RA")),U,2)="B"))
"DATA",101.41,1,10,1,5)
D BROAD^ORCDRA(+Y)
"DATA",101.41,1,10,1,6)
N SCR,IDX S SCR=ORDIALOG(PROMPT,"S"),IDX="S."_$P(ORDG,U,4) D XHELP^ORDD43(IDX,SCR),LIST^ORCDRA:$G(ORDIALOG(PROMPT,"LIST"))
"DATA",101.41,1,10,1,9)
D NEXTPROC^ORCDRA Q:$G(ORQUIT)  I '$G(ORDIALOG(PROMPT,INST)) D COMMON^ORCDRA,LIST^ORCDRA:$G(ORDIALOG(PROMPT,"LIST"))
"DATA",101.41,1,10,1,10)
N OI S OI=+$G(ORDIALOG(PROMPT,INST)) D:OI ORDMSG^ORCD(OI)
"DATA",101.41,1,10,1,"W")
cboProcedure^131^S.RAD
"DATA",101.41,1,10,2,0)
2^5^^Procedure Modifier: ^^0^1^^^^^^Procedure Modifiers: 
"DATA",101.41,1,10,2,1)
Select the procedure modifiers necessary to further define the procedure ordered.
"DATA",101.41,1,10,2,2)
2
"DATA",101.41,1,10,2,3)
I $D(^RAMIS(71.2,"AB",ORIMTYPE))
"DATA",101.41,1,10,2,5)
D CKPTYPE^ORCDRA1 Q:'$G(DONE)  I $$DUP^ORCD(PROMPT,ORI) K DONE W $C(7),!,"This procedure modifier has already been selected!",!
"DATA",101.41,1,10,2,"W")
lstSelectMod^^MOD
"DATA",101.41,1,10,3,0)
7^6^^Date Desired: ^^1^^^W
"DATA",101.41,1,10,3,1)
Enter the date desired for this procedure to be performed.
"DATA",101.41,1,10,3,"W")
calRequestDate
"DATA",101.41,1,10,4,0)
10^7^^^^^^1^^S.RA
"DATA",101.41,1,10,4,1)
Enter the urgency for this request.
"DATA",101.41,1,10,4,2)
3^^ROUTINE
"DATA",101.41,1,10,4,7)
S Y=9
"DATA",101.41,1,10,4,"W")
cboUrgency^^URG
"DATA",101.41,1,10,4,"W7")
S Y="Routine"
"DATA",101.41,1,10,5,0)
11^8^^Submit request to: ^^1
"DATA",101.41,1,10,5,1)
Enter the imaging location this request should be sent to.
"DATA",101.41,1,10,5,3)
I $$GET^XPAR("ALL^DIV.`"_$G(ORDIV),"RA SUBMIT PROMPT",1,"Q"),+$G(ORDIALOG(PROMPT,"LIST"))>1
"DATA",101.41,1,10,5,6)
D LIST^ORCD
"DATA",101.41,1,10,5,7)
S:+$G(ORDIALOG(PROMPT,"LIST"))=1 Y=+$G(ORDIALOG(PROMPT,"LIST",1))
"DATA",101.41,1,10,5,9)
I $G(ORIMLOC) M ORDIALOG(PROMPT,"LIST")=ORIMLOC
"DATA",101.41,1,10,5,"W")
cboSubmit^^SUB
"DATA",101.41,1,10,6,0)
8^9^^^^^^1
"DATA",101.41,1,10,6,1)
Enter the transportation mode of the patient for this exam.
"DATA",101.41,1,10,6,6)
D SETLIST^ORCD
"DATA",101.41,1,10,6,7)
S Y=$$MODE^ORCDRA1 K:'$L(Y) Y
"DATA",101.41,1,10,6,"W")
cboTransport^^TRANS
"DATA",101.41,1,10,7,0)
4^10^^^^^^1
"DATA",101.41,1,10,7,1)
Enter the category of the patient for this exam.
"DATA",101.41,1,10,7,5)
I $D(ORESET),ORESET'=ORDIALOG(PROMPT,ORI) D CHNGCAT^ORCDRA1
"DATA",101.41,1,10,7,6)
D SETLIST^ORCD
"DATA",101.41,1,10,7,7)
S:$G(ORTYPE)'="Z" Y=$S($$INPT^ORCD:"I",1:"O")
"DATA",101.41,1,10,7,"W")
cboCategory^^CAT
"DATA",101.41,1,10,7,"W7")
S Y=$S($G(ORWARD):"Inpatient",1:"Outpatient")
"DATA",101.41,1,10,8,0)
4.2^11^^^^1
"DATA",101.41,1,10,8,1)
Enter the contract or sharing agreement responsible for this exam.
"DATA",101.41,1,10,8,3)
N X S X=$$VAL^ORCD("CATEGORY") I $L(X),"CS"[X
"DATA",101.41,1,10,8,"W")
^^SHARE
"DATA",101.41,1,10,8,"W3")
I "CS"[$$VAL^ORGGDRA("CATEGORY")
"DATA",101.41,1,10,9,0)
4.3^12^^^^1
"DATA",101.41,1,10,9,1)
Enter the name of the research project responsible for this exam.
"DATA",101.41,1,10,9,3)
I $$VAL^ORCD("CATEGORY")="R"
"DATA",101.41,1,10,9,"W")
^^SOURCE
"DATA",101.41,1,10,9,"W3")
I $$VAL^ORGGDRA("CATEGORY")="R"
"DATA",101.41,1,10,10,0)
5^13^^^^^^1
"DATA",101.41,1,10,10,1)
Enter the date/time this patient is scheduled for pre-op.
"DATA",101.41,1,10,10,3)
I $$SCHEDULD^ORCDRA1
"DATA",101.41,1,10,11,0)
6^14
"DATA",101.41,1,10,11,1)
Answer if this patient is pregnant at this time, as precisely as known.
"DATA",101.41,1,10,11,3)
I $G(ORSEX)="F",'FIRST!((ORAGE'<12)&(ORAGE'>55))
"DATA",101.41,1,10,11,6)
D SETLIST^ORCD
"DATA",101.41,1,10,11,7)
I $G(ORSEX)="F",((ORAGE<12)!(ORAGE>55)) S Y="N"
"DATA",101.41,1,10,11,9)
I $G(ORSEX)="F",$G(ORTYPE)'="Z" S REQD=1
"DATA",101.41,1,10,11,"W")
chkPregnant^^YN
"DATA",101.41,1,10,11,"W3")
I $G(ORSEX)="F"
"DATA",101.41,1,10,11,"W7")
S Y="No"
"DATA",101.41,1,10,12,0)
3^15^^Clinical History:^^0
"DATA",101.41,1,10,12,1)
Enter the clinical history of this patient, as it relates to this order.
"DATA",101.41,1,10,12,5)
;N ROOT S ROOT=$TR(ORDIALOG(PROMPT,INST),")",",") I '$$VALIDWP^ORCDRA1(ROOT) K DONE W $C(7),!!,"A valid clinical history is required!" S:$$DONE^ORCDLG2 ORQUIT=1
"DATA",101.41,1,10,12,7)
I $D(^TMP("ORECALL",$J,ORDIALOG)) M ^TMP("ORWORD",$J,PROMPT,INST)=^TMP("ORECALL",$J,ORDIALOG,PROMPT,INST) S Y="^TMP(""ORWORD"",$J,"_PROMPT_","_INST_")"
"DATA",101.41,1,10,12,"W")
memHistory
"DATA",101.41,1,10,13,0)
9^177^^Is patient on isolation procedures? ^^^^^^^^^Isolation Procedures: 
"DATA",101.41,1,10,13,1)
Enter YES if this patient is currently on some type of isolation procedures.
"DATA",101.41,1,10,13,7)
S:$G(ORTYPE)'="Z" Y=$S($$IP^ORMBLD:1,1:0)
"DATA",101.41,1,10,14,0)
4.1^183^^Ordering Location: ^^1
"DATA",101.41,1,10,14,1)
Enter the ordering location for this exam.
"DATA",101.41,1,10,14,3)
N X S X=$$VAL^ORCD("CATEGORY") I "IO"[X,'$$MATCH^ORCDRA1(X)
"DATA",101.41,1,10,15,0)
12^17^^Approving Rad/Nuc Med Phys: ^^1^^^W
"DATA",101.41,1,10,15,1)
Enter the name of the approving imaging service physician; personnel must be classified as Interpreting Staff Physician.
"DATA",101.41,1,10,15,3)
N OI S OI=+$G(ORDIALOG($$PTR^ORCD("OR GTX ORDERABLE ITEM"),1)) I OI,$P($G(^ORD(101.43,OI,0)),U,7)=2
"DATA",101.41,1,10,15,4)
I $D(^VA(200,"ARC","S",+Y)),'$P($G(^VA(200,+Y,"RA")),U,3)!($P($G(^("RA")),U,3)>DT)
"DATA",101.41,1,10,16,0)
13^15676^^^^1^^^*^^^^^VISITSTR
"DATA",101.41,1,10,16,3)
I 0 ;populated from patient data
"DATA",101.41,1,10,17,0)
2.5^15794^^Reason for Study:^^1
"DATA",101.41,1,10,17,1)
Enter the reason this study is being requested, up to 64 characters.
"DATA",101.41,1,10,17,5)
I $L($G(ORDIALOG(PROMPT,INST)))=0 K DONE W $C(7),11,"A valid reason for study is required!" S:$$DONE^ORCDLG2 ORQUIT=1
"DATA",101.41,1,10,17,7)
I $D(^TMP("ORECALL",$J,ORDIALOG)),$$SITEVAL^ORWDXM1 S Y=^TMP("ORECALL",$J,ORDIALOG,PROMPT,INST)
"DATA",101.41,1,10,17,"W")
txtReason
"DATA",101.41,1,99)
61031,45825
"DATA",101.41,2,0)
LR OTHER LAB TESTS^Laboratory^^D^5^2^6^1^2
"DATA",101.41,2,3)
D EN^ORCDLR1
"DATA",101.41,2,3.1)
D EN^ORCDLR1
"DATA",101.41,2,4)
D EX^ORCDLR1
"DATA",101.41,2,5)
^^^Lab Tests^120
"DATA",101.41,2,7)
I '$$VALID^ORCDLR1(ORIFN) S ORQUIT=1 W !!,"Order will not be signed/released." H 2
"DATA",101.41,2,9)
I '$$LB^ORCDLR(ORIFN),$G(^OR(100,ORIFN,4)) S Y="LB #"_$P(^(4),";")
"DATA",101.41,2,10,0)
^101.412IA^11^10
"DATA",101.41,2,10,1,0)
1^4^^Lab Test: ^^1^^^^S.LAB
"DATA",101.41,2,10,1,1)
Enter a lab test to be ordered for this patient.
"DATA",101.41,2,10,1,2)
1
"DATA",101.41,2,10,1,4)
I $$ACTIVE^ORDD43(Y)
"DATA",101.41,2,10,1,5)
I $G(ORESET),ORESET'=+Y D CHANGED^ORCDLR("OI") K ORTEST
"DATA",101.41,2,10,1,6)
N IDX,SCR S IDX=$G(ORDIALOG(PROMPT,"D")),SCR=$G(ORDIALOG(PROMPT,"S")) D XHELP^ORDD43(IDX,SCR)
"DATA",101.41,2,10,1,9)
K:FIRST ORTEST
"DATA",101.41,2,10,1,10)
D CKTYP^ORCDLR Q:$G(ORQUIT)  D TEST^ORCDLR ;Setup test parameters
"DATA",101.41,2,10,1,"W")
lstSelectTest
"DATA",101.41,2,10,3,0)
2^28^^Collected By: ^^1^^^C
"DATA",101.41,2,10,3,1)
Enter the method of collection for this sample.
"DATA",101.41,2,10,3,2)
6^1~1
"DATA",101.41,2,10,3,5)
D CKTYPE^ORCDLR1
"DATA",101.41,2,10,3,6)
D HELPTYPE^ORCDLR1
"DATA",101.41,2,10,3,7)
S Y=$$COLLTYPE^ORCDLR1 K:'$L(Y) Y
"DATA",101.41,2,10,3,10)
S ORCOLLCT=$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,2,10,3,"W")
cboCollType
"DATA",101.41,2,10,4,0)
5^6^^Collection Date/Time: ^^1^^^W
"DATA",101.41,2,10,4,.1)
I ORCOLLCT="LC",X'?1.N,"AMNEXT"'[$$UP^XLFSTR(X),$L(X,".")'>1,$L(X,"@")'>1 S X=X_"@"_$S($$DATE^ORCDLR(X)=DT:$G(ORTIME("NEXT")),1:$G(ORTIME("AM")))
"DATA",101.41,2,10,4,1)
Enter the date/time the sample(s) should be collected.
"DATA",101.41,2,10,4,5)
I $G(ORESET)'=$P(Y,U) N OK S OK=$S(ORCOLLCT="LC":$$LABCOLL^ORCDLR1($P(Y,U)),ORCOLLCT="I":$$IMMCOLL^ORCDLR1($P(Y,U)),1:$$CKDATE^ORCDLR1($P(Y,U))) I 'OK W $C(7),!,$P(OK,U,2) K DONE
"DATA",101.41,2,10,4,6)
D FTDHELP^ORCD D:ORCOLLCT="LC" LISTCOLL^ORCDLR1,LIST^ORCD:$G(ORDIALOG(PROMPT,"LIST")) D:ORCOLLCT="I" IMMTIMES^ORCDLR1
"DATA",101.41,2,10,4,7)
I $G(ORTYPE)'="Z" S Y=$$DEFTIME^ORCDLR1 K:'$L(Y) Y
"DATA",101.41,2,10,4,9)
D COLLTIME^ORCDLR1 ;,LIST^ORCD:ORCOLLCT="LC"&$G(ORDIALOG(PROMPT,"LIST"))
"DATA",101.41,2,10,4,"W")
cboCollTime
"DATA",101.41,2,10,5,0)
8^29^^How often: ^^^^^^APLR
"DATA",101.41,2,10,5,1)
Enter an administration schedule for how often this test is to be done.
"DATA",101.41,2,10,5,2)
8^^ONE TIME
"DATA",101.41,2,10,5,3)
I $G(ORTYPE)="Z"!ORMAX
"DATA",101.41,2,10,5,4)
I "CDO"[$P(^(0),U,5)
"DATA",101.41,2,10,5,5)
I $G(ORESET),ORESET'=ORDIALOG(PROMPT,ORI) K ORDIALOG($$PTR^ORCD("OR GTX DURATION"),ORI)
"DATA",101.41,2,10,5,6)
D XSCH^ORCDLR
"DATA",101.41,2,10,5,7)
I $G(ORTYPE)'="Z",$D(LRFSCH)!ORMAX S Y=$$LRD1^ORDDPAPI S:$D(LRFSCH)&Y EDITONLY=1 K:Y'>0 Y
"DATA",101.41,2,10,5,9)
I $G(ORTYPE)'="Z",ORMAX'>0 K ORDIALOG(PROMPT,INST)
"DATA",101.41,2,10,5,10)
S ORSCH=+$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,2,10,5,"W")
cboFrequency
"DATA",101.41,2,10,6,0)
6^180^^^^^^^C
"DATA",101.41,2,10,6,1)
Enter the urgency of this test.
"DATA",101.41,2,10,6,2)
4^^ROUTINE
"DATA",101.41,2,10,6,3)
I $$ASKURG^ORCDLR
"DATA",101.41,2,10,6,6)
D LIST^ORCD
"DATA",101.41,2,10,6,7)
I $G(ORTYPE)'="Z" S Y=+$G(ORTEST("Default Urgency")) I 'Y S Y=$S($L($G(LRFURG)):LRFURG,1:$$DEFURG^LR7OR3) S:$G(LRFURG) EDITONLY=1
"DATA",101.41,2,10,6,9)
D URGENCY^ORCDLR
"DATA",101.41,2,10,6,"W")
cboUrgency
"DATA",101.41,2,10,7,0)
3^126^^^^1^^^C^B;D
"DATA",101.41,2,10,7,1)
Enter the sample to be collected for this test.
"DATA",101.41,2,10,7,2)
2
"DATA",101.41,2,10,7,3)
I $$ASKSAMP^ORCDLR
"DATA",101.41,2,10,7,5)
I $G(ORESET),ORESET'=+Y N PTR S PTR=$$PTR^ORCD("OR GTX SPECIMEN") K ORDIALOG(PTR,1),ORDIALOG(PTR,"LIST")
"DATA",101.41,2,10,7,6)
D XHELP^ORCDLR(PROMPT)
"DATA",101.41,2,10,7,7)
S Y=$$SAMPLE^ORCDLR K:Y'>0 Y
"DATA",101.41,2,10,7,9)
D ENSAMP^ORCDLR
"DATA",101.41,2,10,7,10)
N ORS S ORS=+$G(ORDIALOG(PROMPT,INST)) D SHOWCOMM^ORCDLR(ORS)
"DATA",101.41,2,10,7,"W")
cboCollSamp
"DATA",101.41,2,10,8,0)
4^127^^^^1^^^C^B;D
"DATA",101.41,2,10,8,1)
Enter the specimen on which this test is to be performed.
"DATA",101.41,2,10,8,2)
3^=126
"DATA",101.41,2,10,8,3)
I '$$SPECIMEN^ORCDLR
"DATA",101.41,2,10,8,6)
D SPECHELP^ORCDLR
"DATA",101.41,2,10,8,7)
S Y=$$SPECIMEN^ORCDLR K:Y'>0 Y
"DATA",101.41,2,10,8,"W")
cboSpecimen
"DATA",101.41,2,10,9,0)
7^15^^^^^^^C
"DATA",101.41,2,10,9,1)
Enter any additional comments or instructions for this test and specimen.
"DATA",101.41,2,10,9,2)
9^^^^^1
"DATA",101.41,2,10,9,3)
I '$$REQDCOMM^ORCDLR
"DATA",101.41,2,10,9,"W")
txtComment
"DATA",101.41,2,10,10,0)
9^153^^How long: ^^1
"DATA",101.41,2,10,10,1)
Enter the number of days or X_number of times to execute this order.
"DATA",101.41,2,10,10,3)
I $G(ORSCH),"CD"[$$LRD2^ORDDPAPI(ORSCH) ;cont or day of week only
"DATA",101.41,2,10,10,5)
N OK S OK=$$CKMAX^ORCDLR(Y) I 'OK K DONE W $C(7),!,$P(OK,U,2),!
"DATA",101.41,2,10,10,9)
D SHOWMAX^ORCDLR
"DATA",101.41,2,10,10,"W")
txtDays
"DATA",101.41,2,10,11,0)
10^15676^^^^1^^^*^^^^^VISITSTR
"DATA",101.41,2,10,11,3)
I 0 ; populated from patient data
"DATA",101.41,2,99)
61031,45824
"DATA",101.41,23,0)
FHW1^Diet Order^^D^18^2^29^1
"DATA",101.41,23,3)
D EN^ORCDFH W:$G(ORWARD) !!,"Current Diet: "_$$DIET^ORCDFH(+ORVP),! D CKFUTURE^ORCDFH
"DATA",101.41,23,3.1)
D:$G(ORVP) EN^ORCDFH I '$G(ORVP) S ORPARAM(3)="TCD",ORDIALOG($$PTR^ORCD("OR GTX DELIVERY"),"LIST")=3
"DATA",101.41,23,4)
D:'($G(ORNPO)!$G(ORQUIT)) CANCEL^ORCDFHTF D EX^ORCDFH K ORSTRT
"DATA",101.41,23,5)
^^^Diet^117
"DATA",101.41,23,7)
D LATETRAY^ORCDFH
"DATA",101.41,23,10,0)
^101.412IA^6^6
"DATA",101.41,23,10,1,0)
1^4^^Diet: ^^1^1^^^S.DO^^5^Diet: 
"DATA",101.41,23,10,1,1)
Enter a diet to be ordered for this patient; a maximum of 5 modifications are allowed.^LKUP;ORCDFH1
"DATA",101.41,23,10,1,2)
1^^^^@ORTRAIL
"DATA",101.41,23,10,1,4)
I $$ACTIVE^ORDD43(Y)
"DATA",101.41,23,10,1,5)
K:'$$VALID^ORCDFH1 DONE I $G(DONE) D ORDMSG^ORCD(+Y)
"DATA",101.41,23,10,1,6)
N IDX,SCR S IDX=$G(ORDIALOG(PROMPT,"D")),SCR=$G(ORDIALOG(PROMPT,"S")) D XHELP^ORDD43(IDX,SCR)
"DATA",101.41,23,10,1,9)
I FIRST,'$O(ORDIALOG(PROMPT,0)) D RECENT^ORCDFH1 I $G(ORDIALOG(PROMPT,"LIST")) W !,"Choose a diet this patient has previously received (top is most recent),",!,"or enter another: " D LIST1^ORCD
"DATA",101.41,23,10,1,10)
N OI S OI=+$G(ORDIALOG(PROMPT,INST)),ORNPO=($P($G(^ORD(101.43,OI,0)),U)="NPO"),ORTRAIL=$S('ORNPO:"Diet",1:"") D PREV^ORCDFH1
"DATA",101.41,23,10,2,0)
2^6^^Effective date/time: ^^1^^^W
"DATA",101.41,23,10,2,.1)
D:$L(X) CNV^ORCDFH1
"DATA",101.41,23,10,2,1)
Enter the date/time for this order to take effect.
"DATA",101.41,23,10,2,7)
S:$G(ORTYPE)'="Z" Y=$S($D(ORSTRT):ORSTRT,1:"NOW")
"DATA",101.41,23,10,2,9)
N X S X=$P(ORDIALOG(PROMPT,0),U,2),$P(X,":",3)="ETRX",$P(ORDIALOG(PROMPT,0),U,2)=X I $G(ORTYPE)="Q",FIRST S X=$G(ORDIALOG(PROMPT,INST)) I $L(X) D CNV^ORCDFH1 S ORDIALOG(PROMPT,INST)=$G(X)
"DATA",101.41,23,10,2,10)
I $G(ORNPO) N X S X=$G(ORDIALOG(PROMPT,INST)),X=$$FMTIME^ORCDFH(X),ORTRAIL=$S(X=.24:"at MIDNIGHT",1:"")
"DATA",101.41,23,10,3,0)
3^24^^Expiration date/time: ^^^^^W
"DATA",101.41,23,10,3,1)
Enter the date/time for this order to expire.
"DATA",101.41,23,10,3,3)
I $$ASKSTOP^ORCDFH!$G(ORNPO)!('FIRST)
"DATA",101.41,23,10,3,5)
I '$$FTDCOMP^ORCD("EFFECTIVE DATE/TIME","EXPIRATION DATE/TIME","<") K DONE W $C(7),!,"Cannot end before effective date/time!",!
"DATA",101.41,23,10,3,10)
Q  S ORSTRT=$G(ORDIALOG(PROMPT,INST)),ASK=$S($L(ORSTRT):2,1:0) K:'ASK ORSTRT
"DATA",101.41,23,10,4,0)
4^18^^Delivery: ^^1^^^W
"DATA",101.41,23,10,4,1)
Enter the method of delivery of this diet.
"DATA",101.41,23,10,4,3)
I $G(ORDIALOG(PROMPT,"LIST"))>1,'$G(ORNPO)
"DATA",101.41,23,10,4,6)
D SETLIST^ORCD
"DATA",101.41,23,10,4,7)
S:$G(ORTYPE)'="Z" ORDIALOG(PROMPT,INST)=$E($G(ORPARAM(3)))
"DATA",101.41,23,10,4,9)
D DELIVERY^ORCDFH
"DATA",101.41,23,10,4,10)
K:$G(ORNPO) ORDIALOG(PROMPT,INST)
"DATA",101.41,23,10,5,0)
5^19^^Special Instructions: 
"DATA",101.41,23,10,5,1)
Enter any special instructions for this order, up to 80 characters.
"DATA",101.41,23,10,5,2)
2
"DATA",101.41,23,10,5,9)
S $P(ORDIALOG(PROMPT,0),U,2)="1:80"
"DATA",101.41,23,10,6,0)
6^175^^Cancel the current tubefeeding order? ^^^^^W^^^^Cancel Tubefeeding order: 
"DATA",101.41,23,10,6,1)
Enter NO to continue the current tubefeeding order along with this diet order, or YES to cancel it.
"DATA",101.41,23,10,6,3)
I 0 ;'$G(ORNPO),$$CURRENT^ORCDFH("TF"),'$$FUTURE^ORCDFH("EFFECTIVE DATE/TIME")
"DATA",101.41,23,10,6,10)
K:$G(ORNPO) ORDIALOG(PROMPT,INST)
"DATA",101.41,23,99)
61031,45822
"DATA",101.41,30,0)
OR GTX UNITS^Units: ^^P^^^22
"DATA",101.41,30,1)
S^ML:ML;LITER:LITER;MCG:MCG;MG:MG;GM:GM;UNITS:UNITS;IU:IU;MEQ:MEQ;MM:MM;MU:MU;THOUU:THOUU;MG-PE:MG-PE;NANOGRAM:NANOGRAM;MMOL:MMOL;^UNITS
"DATA",101.41,30,99)
61031,45822
"DATA",101.41,31,0)
FHW7^Additional Orders^^D^21^0^29
"DATA",101.41,31,3)
D EN^ORCDFH
"DATA",101.41,31,3.1)
S ORCAT=""
"DATA",101.41,31,4)
D EX^ORCDFH
"DATA",101.41,31,5)
^^^^117
"DATA",101.41,31,10,0)
^101.412IA^2^2
"DATA",101.41,31,10,1,0)
1^19^^Additional Orders: ^^1
"DATA",101.41,31,10,1,.1)
K:X?1." " X W:'$D(X) !,"Use of spaces only not allowed!"
"DATA",101.41,31,10,1,1)
Enter the text of this diet order, up to 80 characters.
"DATA",101.41,31,10,1,2)
1^^^Additional Diet Order:
"DATA",101.41,31,10,1,9)
S $P(ORDIALOG(PROMPT,0),"^",2)="1:80"
"DATA",101.41,31,10,2,0)
2^1647^^Start Time: ^^1^^^CW
"DATA",101.41,31,10,2,1)
Enter the date/time for this order to take effect.
"DATA",101.41,31,10,2,3)
I ORCAT="O",$G(ORDIALOG(PROMPT,"LIST"))
"DATA",101.41,31,10,2,6)
D LIST^ORCD
"DATA",101.41,31,10,2,9)
D DATES^ORCDFHTF I FIRST,$G(ORDIALOG(PROMPT,"LIST")) D LIST^ORCD
"DATA",101.41,31,99)
61031,45824
"DATA",101.41,32,0)
FHW2^Early/Late Tray^^D^22^0^29^1
"DATA",101.41,32,3)
D EN^ORCDFH,EN2^ORCDFH
"DATA",101.41,32,3.1)
S ORCAT=""
"DATA",101.41,32,4)
D EX^ORCDFH K ORMEAL,ORTRAY,ORDATE
"DATA",101.41,32,5)
^^^^117
"DATA",101.41,32,10,0)
^101.412IA^7^7
"DATA",101.41,32,10,1,0)
1^139^^^^1^^^W
"DATA",101.41,32,10,1,1)
Enter the date to begin delivery of this tray, up to 30 days ahead.
"DATA",101.41,32,10,1,9)
S $P(ORDIALOG(PROMPT,0),":",2)="T+30" D:ORCAT="O" ENDT^ORCDFHO
"DATA",101.41,32,10,1,10)
N X,Y,%DT S X=$G(ORDIALOG(PROMPT,INST)),%DT="X" I $L(X) D ^%DT S:Y>0 ORDATE=$P(Y,".") D:ORCAT="O" EXDT^ORCDFHO(X)
"DATA",101.41,32,10,2,0)
2^164^^End Date: ^^1^^^W
"DATA",101.41,32,10,2,1)
Enter the date to end delivery of this tray, up to 30 days ahead.
"DATA",101.41,32,10,2,3)
I ORCAT'="O"
"DATA",101.41,32,10,2,5)
I $$FTDCOMP^ORCD("START DATE","END DATE",">") K DONE W $C(7),!,"Cannot end before start date!",!
"DATA",101.41,32,10,2,7)
S Y=$$VAL^ORCD("START DATE")
"DATA",101.41,32,10,2,9)
S $P(ORDIALOG(PROMPT,0),":",2)="T+30"
"DATA",101.41,32,10,3,0)
4^21^^^^1
"DATA",101.41,32,10,3,1)
Enter the meal for delivery of this tray.
"DATA",101.41,32,10,3,2)
2^^^for^meal
"DATA",101.41,32,10,3,3)
I ORCAT'="O"
"DATA",101.41,32,10,3,5)
I $G(ORESET),ORESET'=ORDIALOG(PROMPT,ORI) K ORDIALOG($$PTR^ORCD("OR GTX ORDERABLE ITEM"),1),ORDIALOG($$PTR^ORCD("OR GTX MEAL TIME"),1)
"DATA",101.41,32,10,3,6)
D SETLIST^ORCD
"DATA",101.41,32,10,3,10)
S ORMEAL=$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,32,10,4,0)
5^4^^Early or Late: ^^1^^^^S.E/L T
"DATA",101.41,32,10,4,1)
Select the type of tray to be delivered, either EARLY or LATE.
"DATA",101.41,32,10,4,2)
1
"DATA",101.41,32,10,4,4)
I $$ACTIVE^ORDD43(Y)
"DATA",101.41,32,10,4,5)
Q:$$NOTIMES^ORCDFH(ORMEAL,+Y)  I $G(ORESET),ORESET'=ORDIALOG(PROMPT,ORI) K ORDIALOG($$PTR^ORCD("OR GTX MEAL TIME"),1)
"DATA",101.41,32,10,4,6)
N IDX,SCR S IDX=$G(ORDIALOG(PROMPT,"D")),SCR=$G(ORDIALOG(PROMPT,"S")) D XHELP^ORDD43(IDX,SCR)
"DATA",101.41,32,10,4,10)
S ORTRAY=+$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,32,10,5,0)
6^176^^^^1
"DATA",101.41,32,10,5,1)
Enter the desired delivery time for this tray.
"DATA",101.41,32,10,5,3)
I $G(ORDIALOG(PROMPT,"LIST"))>1
"DATA",101.41,32,10,5,5)
D CKTIME^ORCDFH I '$G(DONE) W !,ORDIALOG(PROMPT,"?") D LIST^ORCD
"DATA",101.41,32,10,5,6)
D LIST^ORCD
"DATA",101.41,32,10,5,7)
D MEALS^ORCDFH N TOT S TOT=+$G(ORDIALOG(PROMPT,"LIST")) S:TOT=1 Y=$P(ORDIALOG(PROMPT,"LIST",$O(ORDIALOG(PROMPT,"LIST",""))),U,2) D:TOT>1 LIST^ORCD
"DATA",101.41,32,10,6,0)
3^170^^Days of Week: ^^1
"DATA",101.41,32,10,6,.1)
S X=$$UP^XLFSTR(X)
"DATA",101.41,32,10,6,1)
Enter the days of the week to deliver this tray, e.g. MWF; choose from (M)onday, (T)uesday, (W)ednesday, Thu(R)sday, (F)riday, (S)aturday, and Sunday(X).
"DATA",101.41,32,10,6,2)
4^^^every
"DATA",101.41,32,10,6,3)
I ORCAT'="O",$$FTDCOMP^ORCD("END DATE","START DATE",">")
"DATA",101.41,32,10,6,5)
I '$$SCHEDOK^ORCDFH(ORDIALOG(PROMPT,ORI)) K DONE W $C(7),!,ORDIALOG(PROMPT,"?"),!
"DATA",101.41,32,10,7,0)
7^177^^Bagged Meal: 
"DATA",101.41,32,10,7,1)
Enter YES if this meal is to be bagged.
"DATA",101.41,32,10,7,3)
I $P($G(ORPARAM(2)),U,10)="Y"
"DATA",101.41,32,99)
61031,45822
"DATA",101.41,129,0)
PSJ OR PAT OE^Inpatient Medications^^D^23^2^60^1^2
"DATA",101.41,129,3)
D PROVIDER^ORCDPSIV Q:$G(ORQUIT)  D EN^ORCDPS1("I")
"DATA",101.41,129,3.1)
D EN1^ORCDPS1
"DATA",101.41,129,4)
D EXIT^ORCDPS1
"DATA",101.41,129,5)
^^^Meds, Inpatient^130
"DATA",101.41,129,6,0)
^101.416
"DATA",101.41,129,7)
D SC^ORCDPS3
"DATA",101.41,129,10,0)
^101.412IA^23^23
"DATA",101.41,129,10,1,0)
1^4^^Medication: ^^1^^^^S.UD RX
"DATA",101.41,129,10,1,1)
Enter the medication you wish to order for this patient.
"DATA",101.41,129,10,1,2)
1^@618
"DATA",101.41,129,10,1,4)
I '$G(^(.1))!($G(^(.1))>$$NOW^XLFDT)
"DATA",101.41,129,10,1,5)
D DEA^ORCDPS1 Q:'$G(DONE)  I $G(ORESET)'=+Y D CHANGED^ORCDPS1("OI")
"DATA",101.41,129,10,1,6)
N IDX,SCR S IDX=$G(ORDIALOG(PROMPT,"D")),SCR=$G(ORDIALOG(PROMPT,"S")) D XHELP^ORDD43(IDX,SCR)
"DATA",101.41,129,10,1,9)
D ENOI^ORCDPS1
"DATA",101.41,129,10,1,10)
S OROI=+$G(ORDIALOG(PROMPT,INST)) D ORDITM^ORCDPS1(OROI),NFI^ORCDPS1(OROI)
"DATA",101.41,129,10,2,0)
2^136^^Dose: ^^1^1^^C^^^^Instructions: 
"DATA",101.41,129,10,2,1)
Enter the dosage instructions for this order, as an amount and units.
"DATA",101.41,129,10,2,5)
D CHDOSE^ORCDPS2 Q:'$G(DONE)  D DEFCONJ^ORCDPS1
"DATA",101.41,129,10,2,6)
D LIST^ORCD:$G(ORDIALOG(PROMPT,"LIST")),F^ORCDLGH:'$G(ORDIALOG(PROMPT,"LIST"))
"DATA",101.41,129,10,2,9)
D DOSES^ORCDPS2 I $G(ORDIALOG(PROMPT,"LIST")),'$O(ORDIALOG(PROMPT,0)),'$G(ORENEW) D LIST^ORCD
"DATA",101.41,129,10,2,10)
D EXDOSE^ORCDPS2
"DATA",101.41,129,10,3,0)
2.1^137^^^^1^^^C^^136
"DATA",101.41,129,10,3,1)
Enter the route of administration for this drug.
"DATA",101.41,129,10,3,2)
^1~3
"DATA",101.41,129,10,3,4)
I $P(^(0),U,4)
"DATA",101.41,129,10,3,6)
D LIST^ORCD:$G(ORDIALOG(PROMPT,"LIST"))&(X="?"),P^ORCDLGH:'$G(ORDIALOG(PROMPT,"LIST"))!(X'="?")
"DATA",101.41,129,10,3,7)
D DEFRTE^ORCDPS1
"DATA",101.41,129,10,3,9)
D ROUTES^ORCDPS1
"DATA",101.41,129,10,3,10)
S OROUTE=+$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,129,10,4,0)
2.2^170^^^^1^^^C^^136
"DATA",101.41,129,10,4,1)
Enter a standard schedule for administering this medication.
"DATA",101.41,129,10,4,5)
D CKSCH^ORCDPS1
"DATA",101.41,129,10,4,6)
N DIC,D,X S DIC="^PS(51.1,",DIC(0)="EQS",D="APPSJ",X="??" D MIX^PSSDI(51.1,"PSJ",.DIC,D,.X)
"DATA",101.41,129,10,4,7)
S:$L($G(^TMP("PSJSCH",$J))) Y=^($J)
"DATA",101.41,129,10,4,9)
S:ORCAT="I" REQD=$$SCHREQ^PSJORPOE(OROUTE,OROI,$G(ORDRUG))
"DATA",101.41,129,10,4,10)
S ORSCH=$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,129,10,5,0)
8^7^^Priority: ^^1^^^C^S.PSO
"DATA",101.41,129,10,5,1)
Enter the urgency of this order.
"DATA",101.41,129,10,5,2)
6^^ROUTINE DONE
"DATA",101.41,129,10,5,7)
S Y=+$$RECALL^ORCD(PROMPT) S:Y EDITONLY=1 S:'Y Y=9
"DATA",101.41,129,10,5,9)
S ORDIALOG(PROMPT,"D")=$S(ORCAT="I":"S.PSJ",1:"S.PSO")
"DATA",101.41,129,10,6,0)
10^15^^Comments: ^^^^^C
"DATA",101.41,129,10,6,1)
Enter any additional instructions for this order.
"DATA",101.41,129,10,6,2)
7
"DATA",101.41,129,10,6,3)
I '$G(PSJNOPC)!($G(ORTYPE)="Z")
"DATA",101.41,129,10,7,0)
1.1^613^^^^^^^^^4
"DATA",101.41,129,10,7,2)
^@618
"DATA",101.41,129,10,7,3)
I 0 ;stuffed in via Instructions
"DATA",101.41,129,10,8,0)
5.5^149^^^^^^^C
"DATA",101.41,129,10,8,1)
Enter the amount (number of tablets, e.g.) to be dispensed.
"DATA",101.41,129,10,8,2)
8^^^Quantity:^^1
"DATA",101.41,129,10,8,3)
I ORCAT="O"
"DATA",101.41,129,10,8,7)
I $G(ORCAT)="O",$G(ORTYPE)'="Z" S Y=$$QTY^ORCDPS1 K:Y'>0 Y
"DATA",101.41,129,10,8,9)
I ORCAT="O" W:$L($G(ORQTY)) !,ORQTY S ORDIALOG(PROMPT,"A")="Quantity"_$S($L($G(ORQTYUNT)):" ("_ORQTYUNT_"): ",1:": ")
"DATA",101.41,129,10,9,0)
7^148^^Pick Up: ^^1^^^RC
"DATA",101.41,129,10,9,1)
Enter if the patient is to receive this medication by mail, at the window, or in the clinic.
"DATA",101.41,129,10,9,3)
I ORCAT="O"
"DATA",101.41,129,10,9,6)
D SETLIST^ORCD
"DATA",101.41,129,10,9,7)
I ORCAT="O",$G(ORTYPE)'="Z" S Y=$S($G(OREVENT):"W",$D(^PSX(550,"C")):"M",1:"W") I $D(^TMP("ORECALL",$J,ORDIALOG,PROMPT,INST)) S Y=^(INST),EDITONLY=1
"DATA",101.41,129,10,10,0)
6^150^^Refills: ^^1^^^RC
"DATA",101.41,129,10,10,1)
Enter the number of refills to allow for this order.
"DATA",101.41,129,10,10,2)
9^^^Refills:
"DATA",101.41,129,10,10,3)
I ORCAT="O",$G(OREFILLS)>0
"DATA",101.41,129,10,10,9)
I ORCAT="O",'$G(OREFILLS) D MAXREFS^ORCDPS1
"DATA",101.41,129,10,11,0)
9^151^^Is this medication for a SC condition? ^^^^^CW^^^^SC: 
"DATA",101.41,129,10,11,1)
If this medication is for treatment of a service-connected condition, enter YES.
"DATA",101.41,129,10,11,3)
I ORCAT="O",$G(ORCOPAY),$G(ORSC)
"DATA",101.41,129,10,11,6)
N DFN S DFN=+ORVP D DIS^DGRPDB
"DATA",101.41,129,10,11,7)
I $G(ORTYPE)'="Z",ORCAT="O",$G(ORCOPAY),$G(ORSC) S Y=$S($P(ORSC,U,2)>50:1,1:0)
"DATA",101.41,129,10,11,9)
I ORCAT="O" S ORCOPAY=$$ASKSC^ORCDPS1 I ORCOPAY,$G(ORSC),'$D(ORDIALOG(PROMPT,INST)) N DFN S DFN=+ORVP D:$P(ORSC,U,2)'>50 DIS^DGRPDB S:$P(ORSC,U,2)>50 $P(ORDIALOG(PROMPT,0),U)="YA",EDITONLY=1 ; Req'd
"DATA",101.41,129,10,12,0)
2.3^153^^How long: ^^^^^C^^136
"DATA",101.41,129,10,12,1)
Enter the length of time over which this dose is to be administered as '4 HOURS', '7 DAYS', '2 WEEKS', or '1 MONTH'.
"DATA",101.41,129,10,12,2)
^^^FOR
"DATA",101.41,129,10,12,3)
I $$ASKDUR^ORCDPS3
"DATA",101.41,129,10,12,5)
D DUR^ORCDPS3
"DATA",101.41,129,10,12,7)
Q  I $G(ORTYPE)'="Z",$G(ORCAT)="I",$G(ORCOMPLX),$P($G(ORSD),U,3) S Y=+$P(ORSD,U,3)_" DAYS"
"DATA",101.41,129,10,13,0)
4^6^^Start: ^^^^1^C
"DATA",101.41,129,10,13,1)
Enter the date this order should begin.
"DATA",101.41,129,10,13,3)
I $G(ORCAT)="O",$G(OREVENT) ;discharge orders only
"DATA",101.41,129,10,13,7)
Q  I $G(ORTYPE)'="Z",ORCAT'="O" S Y=$P($G(ORSD),U) K:'$L(Y) Y
"DATA",101.41,129,10,13,9)
D START^ORCDPS3 ;I 'FIRST,$G(ORDIALOG(PROMPT,"LIST")),'$O(ORDIALOG(PROMPT,0)) D LIST^ORCD ;editonly
"DATA",101.41,129,10,14,0)
3^614^^Text: 
"DATA",101.41,129,10,14,2)
2^^^^^1^0
"DATA",101.41,129,10,14,3)
I 0 ;created by Instructions, if Outpt order
"DATA",101.41,129,10,15,0)
2.5^615^^^^^^^*^^136
"DATA",101.41,129,10,15,2)
^@
"DATA",101.41,129,10,15,3)
I 0 ;created by Instructions
"DATA",101.41,129,10,15,7)
S Y=$$ID^ORCDPS K:'$L(Y) Y
"DATA",101.41,129,10,16,0)
2.6^138^^^^^^^*
"DATA",101.41,129,10,16,3)
I 0 ;created by Instructions
"DATA",101.41,129,10,17,0)
5^616^^^^1^^^C
"DATA",101.41,129,10,17,1)
Enter the number of days for which the patient needs this medication.
"DATA",101.41,129,10,17,3)
I $G(ORCAT)="O"
"DATA",101.41,129,10,17,5)
I $G(ORESET),+ORESET'=+Y D CHANGED^ORCDPS1("DS")
"DATA",101.41,129,10,17,9)
I $G(ORCAT)="O" D DSUP^ORCDPS1
"DATA",101.41,129,10,17,10)
S:$G(ORCAT)="O" ORDSUP=+$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,129,10,18,0)
1.5^618
"DATA",101.41,129,10,18,2)
1.5
"DATA",101.41,129,10,18,3)
I 0 ;stuffed in via Instructions
"DATA",101.41,129,10,19,0)
2.4^617^^^^^^^C^^136
"DATA",101.41,129,10,19,1)
Enter AND if the next dose is to be administered concurrently with this one, or THEN if it is to follow after.
"DATA",101.41,129,10,19,3)
I $G(ORCOMPLX)
"DATA",101.41,129,10,19,5)
I $G(ORESET)'=$P(Y,U) D CHANGED^ORCDPS1("QUANTITY")
"DATA",101.41,129,10,19,9)
D ENCONJ^ORCDPS1
"DATA",101.41,129,10,19,10)
I $G(ORCOMPLX),'$L($G(ORDIALOG(PROMPT,INST))),FIRST S MAX=1 ;stop prompting dose multiple
"DATA",101.41,129,10,20,0)
3.5^1358^^^^^^^C
"DATA",101.41,129,10,20,2)
3
"DATA",101.41,129,10,20,3)
I 0 ;text stuffed via Entry Action
"DATA",101.41,129,10,20,9)
D PI^ORCDPS2
"DATA",101.41,129,10,21,0)
4.5^1359
"DATA",101.41,129,10,21,2)
10^^^First Dose^^1
"DATA",101.41,129,10,21,3)
I 0 ;set via Entry Action
"DATA",101.41,129,10,21,9)
D NOW^ORCDPS3
"DATA",101.41,129,10,22,0)
2.7^15813^^^^^^^*^^136
"DATA",101.41,129,10,22,2)
^@
"DATA",101.41,129,10,22,3)
I 0 ;from Schedule
"DATA",101.41,129,10,23,0)
2.8^716^^^^^^^*^^136
"DATA",101.41,129,10,23,2)
^@
"DATA",101.41,129,10,23,3)
I 0 ;from Schedule
"DATA",101.41,129,99)
61031,45825
"DATA",101.41,130,0)
PSJI OR PAT FLUID OE^Infusion^^D^24^2^60^1^2
"DATA",101.41,130,3)
D PROVIDER^ORCDPSIV
"DATA",101.41,130,3.1)
D:$G(ORNP) PROVIDER^ORCDPSIV
"DATA",101.41,130,4)
S:$G(ORXNP) ORNP=ORXNP K PSJNOPC,ORXNP,ORIVTYPE,ORLEAD,ORTRAIL,OROTSCH
"DATA",101.41,130,5)
^^^IV Fluids^180
"DATA",101.41,130,6,0)
^101.416
"DATA",101.41,130,10,0)
^101.412IA^17^14
"DATA",101.41,130,10,1,0)
2^4^^Solution: ^^1^1^^C^S.IVB RX^^^Solutions: 
"DATA",101.41,130,10,1,1)
Enter a base solution for this order.
"DATA",101.41,130,10,1,2)
2^^^^^1
"DATA",101.41,130,10,1,4)
I $$ACTIVE^ORDD43(Y)
"DATA",101.41,130,10,1,5)
I $G(ORESET),ORESET'=+Y D CHANGED^ORCDPSIV("B")
"DATA",101.41,130,10,1,6)
N IDX,SCR S IDX=$G(ORDIALOG(PROMPT,"D")),SCR=$G(ORDIALOG(PROMPT,"S")) D XHELP^ORDD43(IDX,SCR)
"DATA",101.41,130,10,1,9)
S:FIRST MULT=0 S REQD=$S($G(ORIVTYPE)="I":0,1:1)
"DATA",101.41,130,10,1,10)
D INACTIVE^ORCDPSIV("B")
"DATA",101.41,130,10,2,0)
3^131^^Additive: ^^^1^^C^S.IVA RX^^^Additives: 
"DATA",101.41,130,10,2,1)
Enter an additive for these IV solutions.
"DATA",101.41,130,10,2,2)
1^^^^in^1
"DATA",101.41,130,10,2,3)
I '($$PREMIX^ORCDPSIV&FIRST)
"DATA",101.41,130,10,2,4)
I $$ACTIVE^ORDD43(Y)
"DATA",101.41,130,10,2,5)
I $G(ORESET),ORESET'=ORDIALOG(PROMPT,ORI) D CHANGED^ORCDPSIV("A")
"DATA",101.41,130,10,2,6)
N IDX,SCR S IDX=$G(ORDIALOG(PROMPT,"D")),SCR=$G(ORDIALOG(PROMPT,"S")) D XHELP^ORDD43(IDX,SCR)
"DATA",101.41,130,10,2,10)
D INACTIVE^ORCDPSIV("A")
"DATA",101.41,130,10,3,0)
3.1^152^^^^1^^^C^^131
"DATA",101.41,130,10,3,1)
Enter the strength of this additive, as a number.
"DATA",101.41,130,10,3,9)
D UNITS^ORCDPSIV
"DATA",101.41,130,10,5,0)
5^128^^Infusion Rate: ^^1^^^C
"DATA",101.41,130,10,5,.1)
D INF^ORCDPSIV
"DATA",101.41,130,10,5,1)
Enter the rate at which the IV is to be administered, as the number of ml/hr or Text@Number of Labels per day.
"DATA",101.41,130,10,5,2)
4^^^@ORLEAD^@ORTRAIL
"DATA",101.41,130,10,5,9)
D ENRATE^ORCDPSIV
"DATA",101.41,130,10,5,10)
S (ORLEAD,ORTRAIL)="" S:$G(ORIVTYPE)="I" ORLEAD="Infuse over",ORTRAIL="minutes"
"DATA",101.41,130,10,7,0)
9^15^^Provider Comments: ^^^^^C
"DATA",101.41,130,10,7,.1)

"DATA",101.41,130,10,7,1)
Enter any additional comments or instructions for this order.
"DATA",101.41,130,10,7,2)
8^^^^^1
"DATA",101.41,130,10,7,3)
I '$G(PSJNOPC)!($G(ORTYPE)="Z")
"DATA",101.41,130,10,7,5)

"DATA",101.41,130,10,9,0)
3.2^30^^^^^^^C^^131
"DATA",101.41,130,10,9,1)
Enter the units of measurement for this additive.
"DATA",101.41,130,10,9,3)
I '$D(ORDIALOG(PROMPT,INST))
"DATA",101.41,130,10,9,6)
D SETLIST^ORCD
"DATA",101.41,130,10,10,0)
2.1^172^^Volume (in ml): ^^1^^^C^^4
"DATA",101.41,130,10,10,1)
Enter the volume to be administered, as the number of milliliters.
"DATA",101.41,130,10,10,2)
^^^^ml
"DATA",101.41,130,10,10,3)
I $G(ORDIALOG(PROMPT,"LIST"))>1
"DATA",101.41,130,10,10,6)
D LIST^ORCD
"DATA",101.41,130,10,10,7)
S Y=$O(ORDIALOG(PROMPT,"LIST",""),-1) K:'Y Y D:$G(ORDIALOG(PROMPT,"LIST"))>1 LIST^ORCD
"DATA",101.41,130,10,10,9)
D VOLUME^ORCDPSIV
"DATA",101.41,130,10,11,0)
8^7^^Priority: ^^^^^C^S.PSJ
"DATA",101.41,130,10,11,1)
Enter the urgency of this order.
"DATA",101.41,130,10,11,2)
7^^ROUTINE
"DATA",101.41,130,10,11,7)
S Y=+$$RECALL^ORCD(PROMPT) S:Y EDITONLY=1 S:'Y Y=9
"DATA",101.41,130,10,12,0)
6^170^^^^^^^C
"DATA",101.41,130,10,12,1)
Enter a standard schedule for administering this medication.
"DATA",101.41,130,10,12,2)
5
"DATA",101.41,130,10,12,3)
I $G(ORIVTYPE)="I" ;intermittent only
"DATA",101.41,130,10,12,5)
D CKSCH^ORCDPSIV
"DATA",101.41,130,10,12,6)
N DIC,D,X S DIC="^PS(51.1,",DIC(0)="EQS",D="APPSJ",X="??" D MIX^PSSDI(51.1,"PSJ",.DIC,D,.X)
"DATA",101.41,130,10,12,10)
S OROTSCH=$$ISONETIM^ORCDPSIV($G(ORDIALOG(PROMPT,INST)))
"DATA",101.41,130,10,13,0)
7^153^^Limitation:^^^^^C
"DATA",101.41,130,10,13,.1)
D IVPSI^ORCDPSIV
"DATA",101.41,130,10,13,1)
Enter the length of administrative time or total volume for IV fluid order followed by ML for milliliters, L for liters, H for hours, D for days, or DOSES.
"DATA",101.41,130,10,13,2)
6
"DATA",101.41,130,10,13,3)
I +$G(OROTSCH)=0 D IVPSI1^ORCDPSIV
"DATA",101.41,130,10,14,0)
1^15809^^^^1^^^C
"DATA",101.41,130,10,14,1)
Enter the infusion type for this order.
"DATA",101.41,130,10,14,5)
I $G(ORESET),ORESET'=ORDIALOG(PROMPT,ORI) D CHANGED^ORCDPSIV("T")
"DATA",101.41,130,10,14,10)
S ORIVTYPE=$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,130,10,15,0)
4^137^^^^1^^^C
"DATA",101.41,130,10,15,.1)

"DATA",101.41,130,10,15,1)
Enter the route of administration for this infusion.
"DATA",101.41,130,10,15,2)
3^1~3
"DATA",101.41,130,10,15,4)
I $$IVRTESCR^ORCDPSIV(Y)
"DATA",101.41,130,10,15,5)

"DATA",101.41,130,10,15,6)
D LVROUTES^ORCDPSIV
"DATA",101.41,130,10,15,9)
D IVRTEENT^ORCDPSIV
"DATA",101.41,130,10,16,0)
6.5^15813^^^^^^^^^
"DATA",101.41,130,10,16,2)
^@
"DATA",101.41,130,10,16,3)
I 0 ;from Schedule
"DATA",101.41,130,10,17,0)
10^1359
"DATA",101.41,130,10,17,2)
15^^^First Dose^^1
"DATA",101.41,130,10,17,3)
I 0 ;set via Entry Action
"DATA",101.41,130,10,17,9)
D NOW^ORCDPS3
"DATA",101.41,130,99)
61137,36349
"DATA",101.41,147,0)
PSO OERR^Outpatient Medications^^D^4^2^15^1^2
"DATA",101.41,147,3)
D PROVIDER^ORCDPSIV Q:$G(ORQUIT)  D EN^ORCDPS1("O")
"DATA",101.41,147,3.1)
D EN1^ORCDPS1
"DATA",101.41,147,4)
D EXIT^ORCDPS1
"DATA",101.41,147,5)
^^^Meds, Outpatient^140
"DATA",101.41,147,7)
D SC^ORCDPS3
"DATA",101.41,147,10,0)
^101.412IA^21^21
"DATA",101.41,147,10,1,0)
1^4^^Medication: ^^1^^^^S.O RX
"DATA",101.41,147,10,1,1)
Enter the medication you wish to order for this patient.
"DATA",101.41,147,10,1,2)
1^@618
"DATA",101.41,147,10,1,4)
I '$G(^(.1))!($G(^(.1))>$$NOW^XLFDT)
"DATA",101.41,147,10,1,5)
D DEA^ORCDPS1 Q:'$G(DONE)  I $G(ORESET)'=+Y D CHANGED^ORCDPS1("OI")
"DATA",101.41,147,10,1,6)
N IDX,SCR S IDX=$G(ORDIALOG(PROMPT,"D")),SCR=$G(ORDIALOG(PROMPT,"S")) D XHELP^ORDD43(IDX,SCR)
"DATA",101.41,147,10,1,9)
D ENOI^ORCDPS1
"DATA",101.41,147,10,1,10)
S OROI=+$G(ORDIALOG(PROMPT,INST)) D ORDITM^ORCDPS1(OROI),NFI^ORCDPS1(OROI)
"DATA",101.41,147,10,2,0)
2^136^^Dose: ^^1^1^^C^^^^Instructions: 
"DATA",101.41,147,10,2,1)
Enter the dosage instructions for this order, as an amount and units.
"DATA",101.41,147,10,2,5)
D CHDOSE^ORCDPS2 Q:'$G(DONE)  D DEFCONJ^ORCDPS1
"DATA",101.41,147,10,2,6)
D LIST^ORCD:$G(ORDIALOG(PROMPT,"LIST")),F^ORCDLGH:'$G(ORDIALOG(PROMPT,"LIST"))
"DATA",101.41,147,10,2,9)
D DOSES^ORCDPS2 I $G(ORDIALOG(PROMPT,"LIST")),'$O(ORDIALOG(PROMPT,0)),'$G(ORENEW) D LIST^ORCD
"DATA",101.41,147,10,2,10)
D EXDOSE^ORCDPS2
"DATA",101.41,147,10,3,0)
2.1^137^^^^1^^^C^^136
"DATA",101.41,147,10,3,1)
Enter the route of administration for this drug.
"DATA",101.41,147,10,3,2)
^1~3
"DATA",101.41,147,10,3,4)
I $P(^(0),U,4)
"DATA",101.41,147,10,3,6)
D LIST^ORCD:$G(ORDIALOG(PROMPT,"LIST"))&(X="?"),P^ORCDLGH:'$G(ORDIALOG(PROMPT,"LIST"))!(X'="?")
"DATA",101.41,147,10,3,7)
D DEFRTE^ORCDPS1
"DATA",101.41,147,10,3,9)
D ROUTES^ORCDPS1
"DATA",101.41,147,10,3,10)
S OROUTE=+$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,147,10,4,0)
2.2^170^^^^1^^^C^^136
"DATA",101.41,147,10,4,1)
Enter a standard schedule for administering this medication.
"DATA",101.41,147,10,4,5)
D CKSCH^ORCDPS1
"DATA",101.41,147,10,4,6)
N DIC,D,DZ S DIC="^PS(51.1,",DIC(0)="EQS",D="APPSJ",DZ="??" D MIX^PSSDI(51.1,"PSJ",.DIC,D,.X)
"DATA",101.41,147,10,4,7)
S:$L($G(^TMP("PSJSCH",$J))) Y=^($J)
"DATA",101.41,147,10,4,9)
S:ORCAT="I" REQD=$$SCHREQ^PSJORPOE(OROUTE,OROI,$G(ORDRUG))
"DATA",101.41,147,10,4,10)
S ORSCH=$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,147,10,5,0)
8^7^^Priority: ^^1^^^C^S.PSO
"DATA",101.41,147,10,5,1)
Enter the urgency of this order.
"DATA",101.41,147,10,5,2)
6^^ROUTINE DONE
"DATA",101.41,147,10,5,7)
S Y=+$$RECALL^ORCD(PROMPT) S:Y EDITONLY=1 S:'Y Y=9
"DATA",101.41,147,10,5,9)
S ORDIALOG(PROMPT,"D")=$S(ORCAT="I":"S.PSJ",1:"S.PSO")
"DATA",101.41,147,10,6,0)
10^15^^Comments: ^^^^^C
"DATA",101.41,147,10,6,1)
Enter any additional instructions for this order.
"DATA",101.41,147,10,6,2)
7
"DATA",101.41,147,10,6,3)
I '$G(PSJNOPC)!($G(ORTYPE)="Z")
"DATA",101.41,147,10,7,0)
1.1^613^^^^^^^^^4
"DATA",101.41,147,10,7,2)
^@618
"DATA",101.41,147,10,7,3)
I 0 ;stuffed in via Instructions
"DATA",101.41,147,10,8,0)
5.5^149^^^^^^^C
"DATA",101.41,147,10,8,1)
Enter the amount (number of tablets, e.g.) to be dispensed.
"DATA",101.41,147,10,8,2)
8^^^Quantity:^^1
"DATA",101.41,147,10,8,3)
I ORCAT="O"
"DATA",101.41,147,10,8,7)
I $G(ORCAT)="O",$G(ORTYPE)'="Z" S Y=$$QTY^ORCDPS1 K:Y'>0 Y
"DATA",101.41,147,10,8,9)
I ORCAT="O" W:$L($G(ORQTY)) !,ORQTY S ORDIALOG(PROMPT,"A")="Quantity"_$S($L($G(ORQTYUNT)):" ("_ORQTYUNT_"): ",1:": ")
"DATA",101.41,147,10,9,0)
7^148^^Pick Up: ^^1^^^RC
"DATA",101.41,147,10,9,1)
Enter if the patient is to receive this medication by mail, at the window, or in the clinic.
"DATA",101.41,147,10,9,3)
I ORCAT="O"
"DATA",101.41,147,10,9,6)
D SETLIST^ORCD
"DATA",101.41,147,10,9,7)
I ORCAT="O",$G(ORTYPE)'="Z" S Y=$S($G(OREVENT):"W",$D(^PSX(550,"C")):"M",1:"W") I $D(^TMP("ORECALL",$J,ORDIALOG,PROMPT,INST)) S Y=^(INST),EDITONLY=1
"DATA",101.41,147,10,10,0)
6^150^^Refills: ^^1^^^RC
"DATA",101.41,147,10,10,1)
Enter the number of refills to allow for this order.
"DATA",101.41,147,10,10,2)
9^^^Refills:
"DATA",101.41,147,10,10,3)
I ORCAT="O",$G(OREFILLS)>0
"DATA",101.41,147,10,10,9)
I ORCAT="O",'$G(OREFILLS) D MAXREFS^ORCDPS1
"DATA",101.41,147,10,11,0)
9^151^^Is this medication for a SC condition? ^^^^^CW^^^^SC: 
"DATA",101.41,147,10,11,1)
If this medication is for treatment of a service-connected condition, enter YES.
"DATA",101.41,147,10,11,3)
I ORCAT="O",$G(ORCOPAY),$G(ORSC)
"DATA",101.41,147,10,11,6)
N DFN S DFN=+ORVP D DIS^DGRPDB
"DATA",101.41,147,10,11,7)
I $G(ORTYPE)'="Z",ORCAT="O",$G(ORCOPAY),$G(ORSC) S Y=$S($P(ORSC,U,2)>50:1,1:0)
"DATA",101.41,147,10,11,9)
I ORCAT="O" S ORCOPAY=$$ASKSC^ORCDPS1 I ORCOPAY,$G(ORSC),'$D(ORDIALOG(PROMPT,INST)) N DFN S DFN=+ORVP D:$P(ORSC,U,2)'>50 DIS^DGRPDB S:$P(ORSC,U,2)>50 $P(ORDIALOG(PROMPT,0),U)="YA",EDITONLY=1 ; Req'd
"DATA",101.41,147,10,12,0)
2.3^153^^How long: ^^^^^C^^136
"DATA",101.41,147,10,12,1)
Enter the length of time over which this dose is to be administered as '4 HOURS', '7 DAYS', '2 WEEKS', or '1 MONTH'.
"DATA",101.41,147,10,12,2)
^^^FOR
"DATA",101.41,147,10,12,3)
I $$ASKDUR^ORCDPS3
"DATA",101.41,147,10,12,5)
D DUR^ORCDPS3
"DATA",101.41,147,10,12,7)
Q  I $G(ORTYPE)'="Z",$G(ORCAT)="I",$G(ORCOMPLX),$P($G(ORSD),U,3) S Y=+$P(ORSD,U,3)_" DAYS"
"DATA",101.41,147,10,13,0)
4^6^^Start: ^^^^1^C
"DATA",101.41,147,10,13,1)
Enter the date this order should begin.
"DATA",101.41,147,10,13,3)
I $G(ORCAT)="O",$G(OREVENT) ;discharge orders only
"DATA",101.41,147,10,13,7)
Q  I $G(ORTYPE)'="Z",ORCAT'="O" S Y=$P($G(ORSD),U) K:'$L(Y) Y
"DATA",101.41,147,10,13,9)
D START^ORCDPS3 ;I 'FIRST,$G(ORDIALOG(PROMPT,"LIST")),'$O(ORDIALOG(PROMPT,0)) D LIST^ORCD ;editonly
"DATA",101.41,147,10,14,0)
3^614
"DATA",101.41,147,10,14,2)
2^^^^^1^0
"DATA",101.41,147,10,14,3)
I 0 ;created by Instructions, if Outpt order
"DATA",101.41,147,10,15,0)
2.5^615^^^^^^^*^^136
"DATA",101.41,147,10,15,2)
^@
"DATA",101.41,147,10,15,3)
I 0 ;created by Instructions
"DATA",101.41,147,10,15,7)
S Y=$$ID^ORCDPS K:'$L(Y) Y
"DATA",101.41,147,10,16,0)
2.6^138^^^^^^^*
"DATA",101.41,147,10,16,3)
I 0 ;created by Instructions
"DATA",101.41,147,10,17,0)
5^616^^^^1^^^C
"DATA",101.41,147,10,17,1)
Enter the number of days for which the patient needs this medication.
"DATA",101.41,147,10,17,3)
I $G(ORCAT)="O"
"DATA",101.41,147,10,17,5)
I $G(ORESET),+ORESET'=+Y D CHANGED^ORCDPS1("DS")
"DATA",101.41,147,10,17,9)
I $G(ORCAT)="O" D DSUP^ORCDPS1
"DATA",101.41,147,10,17,10)
S:$G(ORCAT)="O" ORDSUP=+$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,147,10,18,0)
1.5^618
"DATA",101.41,147,10,18,2)
1.5
"DATA",101.41,147,10,18,3)
I 0 ;stuffed in via Instructions
"DATA",101.41,147,10,19,0)
2.4^617^^^^^^^C^^136
"DATA",101.41,147,10,19,1)
Enter AND if the next dose is to be administered concurrently with this one, or THEN if it is to follow after.
"DATA",101.41,147,10,19,3)
I $G(ORCOMPLX)
"DATA",101.41,147,10,19,5)
I $G(ORESET)'=$P(Y,U) D CHANGED^ORCDPS1("QUANTITY")
"DATA",101.41,147,10,19,9)
D ENCONJ^ORCDPS1
"DATA",101.41,147,10,19,10)
I $G(ORCOMPLX),'$L($G(ORDIALOG(PROMPT,INST))),FIRST S MAX=1 ;stop prompting dose multiple
"DATA",101.41,147,10,20,0)
3.5^1358^^^^^^^C
"DATA",101.41,147,10,20,2)
3
"DATA",101.41,147,10,20,3)
I 0 ;text stuffed via Entry Action
"DATA",101.41,147,10,20,9)
D PI^ORCDPS2
"DATA",101.41,147,10,21,0)
4.5^1359
"DATA",101.41,147,10,21,2)
10^^^First Dose^^1
"DATA",101.41,147,10,21,3)
I 0 ;set via Entry Action
"DATA",101.41,147,10,21,9)
D NOW^ORCDPS3
"DATA",101.41,147,99)
61031,45824
"DATA",101.41,171,0)
PSO SUPPLY^Supplies^^D^28^2^15^1^2
"DATA",101.41,171,3)
D PROVIDER^ORCDPSIV Q:$G(ORQUIT)  D EN^ORCDPS1("O")
"DATA",101.41,171,3.1)
D EN1^ORCDPS1
"DATA",101.41,171,4)
D EXIT^ORCDPS1
"DATA",101.41,171,5)
^^^Meds, Supplies^140
"DATA",101.41,171,7)
D SC^ORCDPS3
"DATA",101.41,171,10,0)
^101.412IA^21^21
"DATA",101.41,171,10,1,0)
1^4^^Medication: ^^1^^^^S.SPLY
"DATA",101.41,171,10,1,1)
Enter the item or device you wish to order for this patient.
"DATA",101.41,171,10,1,2)
1^@618
"DATA",101.41,171,10,1,4)
I '$G(^(.1))!($G(^(.1))>$$NOW^XLFDT)
"DATA",101.41,171,10,1,5)
D DEA^ORCDPS1 Q:'$G(DONE)  I $G(ORESET)'=+Y D CHANGED^ORCDPS1("OI")
"DATA",101.41,171,10,1,6)
N IDX,SCR S IDX=$G(ORDIALOG(PROMPT,"D")),SCR=$G(ORDIALOG(PROMPT,"S")) D XHELP^ORDD43(IDX,SCR)
"DATA",101.41,171,10,1,9)
D ENOI^ORCDPS1
"DATA",101.41,171,10,1,10)
S OROI=+$G(ORDIALOG(PROMPT,INST)) D ORDITM^ORCDPS1(OROI),NFI^ORCDPS1(OROI)
"DATA",101.41,171,10,2,0)
2^136^^Dose: ^^1^1^^C^^^^Instructions: 
"DATA",101.41,171,10,2,1)
Enter the dosage instructions for this order, as an amount and units.
"DATA",101.41,171,10,2,5)
D CHDOSE^ORCDPS2 Q:'$G(DONE)  D DEFCONJ^ORCDPS1
"DATA",101.41,171,10,2,6)
D LIST^ORCD:$G(ORDIALOG(PROMPT,"LIST")),F^ORCDLGH:'$G(ORDIALOG(PROMPT,"LIST"))
"DATA",101.41,171,10,2,9)
D DOSES^ORCDPS2 I $G(ORDIALOG(PROMPT,"LIST")),'$O(ORDIALOG(PROMPT,0)),'$G(ORENEW) D LIST^ORCD
"DATA",101.41,171,10,2,10)
D EXDOSE^ORCDPS2
"DATA",101.41,171,10,3,0)
2.1^137^^^^0^^^C^^136
"DATA",101.41,171,10,3,1)
Enter the route of administration for this drug.
"DATA",101.41,171,10,3,2)
^1~3
"DATA",101.41,171,10,3,4)
I $P(^(0),U,4)
"DATA",101.41,171,10,3,6)
D LIST^ORCD:$G(ORDIALOG(PROMPT,"LIST"))&(X="?"),P^ORCDLGH:'$G(ORDIALOG(PROMPT,"LIST"))!(X'="?")
"DATA",101.41,171,10,3,7)
D DEFRTE^ORCDPS1
"DATA",101.41,171,10,3,9)
D ROUTES^ORCDPS1
"DATA",101.41,171,10,3,10)
S OROUTE=+$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,171,10,4,0)
2.2^170^^^^1^^^C^^136
"DATA",101.41,171,10,4,1)
Enter a standard schedule for administering this medication.
"DATA",101.41,171,10,4,5)
D CKSCH^ORCDPS1
"DATA",101.41,171,10,4,6)
N DIC,D,DZ S DIC="^PS(51.1,",DIC(0)="EQS",D="APPSJ",DZ="??" D MIX^PSSDI(51.1,"PSJ",.DIC,D,.X)
"DATA",101.41,171,10,4,7)
S:$L($G(^TMP("PSJSCH",$J))) Y=^($J)
"DATA",101.41,171,10,4,9)
S:ORCAT="I" REQD=$$SCHREQ^PSJORPOE(OROUTE,OROI,$G(ORDRUG))
"DATA",101.41,171,10,4,10)
S ORSCH=$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,171,10,5,0)
8^7^^Priority: ^^1^^^C^S.PSO
"DATA",101.41,171,10,5,1)
Enter the urgency of this order.
"DATA",101.41,171,10,5,2)
6^^ROUTINE DONE
"DATA",101.41,171,10,5,7)
S Y=+$$RECALL^ORCD(PROMPT) S:Y EDITONLY=1 S:'Y Y=9
"DATA",101.41,171,10,5,9)
S ORDIALOG(PROMPT,"D")=$S(ORCAT="I":"S.PSJ",1:"S.PSO")
"DATA",101.41,171,10,6,0)
10^15^^Comments: ^^^^^C
"DATA",101.41,171,10,6,1)
Enter any additional instructions for this order.
"DATA",101.41,171,10,6,2)
7
"DATA",101.41,171,10,6,3)
I '$G(PSJNOPC)!($G(ORTYPE)="Z")
"DATA",101.41,171,10,7,0)
1.1^613^^^^^^^^^4
"DATA",101.41,171,10,7,2)
^@618
"DATA",101.41,171,10,7,3)
I 0 ;stuffed in via Instructions
"DATA",101.41,171,10,8,0)
5.5^149^^^^^^^C
"DATA",101.41,171,10,8,1)
Enter the amount (number of tablets, e.g.) to be dispensed.
"DATA",101.41,171,10,8,2)
8^^^Quantity:^^1
"DATA",101.41,171,10,8,3)
I ORCAT="O"
"DATA",101.41,171,10,8,7)
I $G(ORCAT)="O",$G(ORTYPE)'="Z" S Y=$$QTY^ORCDPS1 K:Y'>0 Y
"DATA",101.41,171,10,8,9)
I ORCAT="O" W:$L($G(ORQTY)) !,ORQTY S ORDIALOG(PROMPT,"A")="Quantity"_$S($L($G(ORQTYUNT)):" ("_ORQTYUNT_"): ",1:": ")
"DATA",101.41,171,10,9,0)
7^148^^Pick Up: ^^1^^^RC
"DATA",101.41,171,10,9,1)
Enter if the patient is to receive this medication by mail, at the window, or in the clinic.
"DATA",101.41,171,10,9,3)
I ORCAT="O"
"DATA",101.41,171,10,9,6)
D SETLIST^ORCD
"DATA",101.41,171,10,9,7)
I ORCAT="O",$G(ORTYPE)'="Z" S Y=$S($G(OREVENT):"W",$D(^PSX(550,"C")):"M",1:"W") I $D(^TMP("ORECALL",$J,ORDIALOG,PROMPT,INST)) S Y=^(INST),EDITONLY=1
"DATA",101.41,171,10,10,0)
6^150^^Refills: ^^1^^^RC
"DATA",101.41,171,10,10,1)
Enter the number of refills to allow for this order.
"DATA",101.41,171,10,10,2)
9^^^Refills:
"DATA",101.41,171,10,10,3)
I ORCAT="O",$G(OREFILLS)>0
"DATA",101.41,171,10,10,9)
I ORCAT="O",'$G(OREFILLS) D MAXREFS^ORCDPS1
"DATA",101.41,171,10,11,0)
9^151^^Is this medication for a SC condition? ^^^^^CW^^^^SC: 
"DATA",101.41,171,10,11,1)
If this medication is for treatment of a service-connected condition, enter YES.
"DATA",101.41,171,10,11,3)
I ORCAT="O",$G(ORCOPAY),$G(ORSC)
"DATA",101.41,171,10,11,6)
N DFN S DFN=+ORVP D DIS^DGRPDB
"DATA",101.41,171,10,11,7)
I $G(ORTYPE)'="Z",ORCAT="O",$G(ORCOPAY),$G(ORSC) S Y=$S($P(ORSC,U,2)>50:1,1:0)
"DATA",101.41,171,10,11,9)
I ORCAT="O" S ORCOPAY=$$ASKSC^ORCDPS1 I ORCOPAY,$G(ORSC),'$D(ORDIALOG(PROMPT,INST)) N DFN S DFN=+ORVP D:$P(ORSC,U,2)'>50 DIS^DGRPDB S:$P(ORSC,U,2)>50 $P(ORDIALOG(PROMPT,0),U)="YA",EDITONLY=1 ; Req'd
"DATA",101.41,171,10,12,0)
2.3^153^^How long: ^^^^^C^^136
"DATA",101.41,171,10,12,1)
Enter the length of time over which this dose is to be administered as '4 HOURS', '7 DAYS', '2 WEEKS', or '1 MONTH'.
"DATA",101.41,171,10,12,2)
^^^FOR
"DATA",101.41,171,10,12,3)
I $$ASKDUR^ORCDPS3
"DATA",101.41,171,10,12,5)
D DUR^ORCDPS3
"DATA",101.41,171,10,12,7)
Q  I $G(ORTYPE)'="Z",$G(ORCAT)="I",$G(ORCOMPLX),$P($G(ORSD),U,3) S Y=+$P(ORSD,U,3)_" DAYS"
"DATA",101.41,171,10,13,0)
4^6^^Start: ^^^^1^C
"DATA",101.41,171,10,13,1)
Enter the date this order should begin.
"DATA",101.41,171,10,13,3)
I $G(ORCAT)="O",$G(OREVENT) ;discharge orders only
"DATA",101.41,171,10,13,7)
Q  I $G(ORTYPE)'="Z",ORCAT'="O" S Y=$P($G(ORSD),U) K:'$L(Y) Y
"DATA",101.41,171,10,13,9)
D START^ORCDPS3 ;I 'FIRST,$G(ORDIALOG(PROMPT,"LIST")),'$O(ORDIALOG(PROMPT,0)) D LIST^ORCD ;editonly
"DATA",101.41,171,10,14,0)
3^614
"DATA",101.41,171,10,14,2)
2^^^^^1^0
"DATA",101.41,171,10,14,3)
I 0 ;created by Instructions, if Outpt order
"DATA",101.41,171,10,15,0)
2.5^615^^^^^^^*^^136
"DATA",101.41,171,10,15,2)
^@
"DATA",101.41,171,10,15,3)
I 0 ;created by Instructions
"DATA",101.41,171,10,15,7)
S Y=$$ID^ORCDPS K:'$L(Y) Y
"DATA",101.41,171,10,16,0)
2.6^138^^^^^^^*
"DATA",101.41,171,10,16,3)
I 0 ;created by Instructions
"DATA",101.41,171,10,17,0)
5^616^^^^1^^^C
"DATA",101.41,171,10,17,1)
Enter the number of days for which the patient needs this medication.
"DATA",101.41,171,10,17,3)
I $G(ORCAT)="O"
"DATA",101.41,171,10,17,5)
I $G(ORESET),+ORESET'=+Y D CHANGED^ORCDPS1("DS")
"DATA",101.41,171,10,17,9)
I $G(ORCAT)="O" D DSUP^ORCDPS1
"DATA",101.41,171,10,17,10)
S:$G(ORCAT)="O" ORDSUP=+$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,171,10,18,0)
1.5^618
"DATA",101.41,171,10,18,2)
1.5
"DATA",101.41,171,10,18,3)
I 0 ;stuffed in via Instructions
"DATA",101.41,171,10,19,0)
2.4^617^^^^^^^C^^136
"DATA",101.41,171,10,19,1)
Enter AND if the next dose is to be administered concurrently with this one, or THEN if it is to follow after.
"DATA",101.41,171,10,19,3)
I $G(ORCOMPLX)
"DATA",101.41,171,10,19,5)
I $G(ORESET)'=$P(Y,U) D CHANGED^ORCDPS1("QUANTITY")
"DATA",101.41,171,10,19,9)
D ENCONJ^ORCDPS1
"DATA",101.41,171,10,19,10)
I $G(ORCOMPLX),'$L($G(ORDIALOG(PROMPT,INST))),FIRST S MAX=1 ;stop prompting dose multiple
"DATA",101.41,171,10,20,0)
3.5^1358^^^^^^^C
"DATA",101.41,171,10,20,2)
3
"DATA",101.41,171,10,20,3)
I 0 ;text stuffed via Entry Action
"DATA",101.41,171,10,20,9)
D PI^ORCDPS2
"DATA",101.41,171,10,21,0)
4.5^1359
"DATA",101.41,171,10,21,2)
10^^^First Dose^^1
"DATA",101.41,171,10,21,3)
I 0 ;set via Entry Action
"DATA",101.41,171,10,21,9)
D NOW^ORCDPS3
"DATA",101.41,171,99)
61031,45824
"DATA",101.41,612,0)
PS MEDS^Medications^^D^2^2^360^1^2
"DATA",101.41,612,3)
D PROVIDER^ORCDPSIV Q:$G(ORQUIT)  D EN^ORCDPS1("")
"DATA",101.41,612,3.1)
D EN1^ORCDPS1
"DATA",101.41,612,4)
D EXIT^ORCDPS1
"DATA",101.41,612,5)
^^^Medications^135
"DATA",101.41,612,7)
D SC^ORCDPS3
"DATA",101.41,612,10,0)
^101.412IA^24^24
"DATA",101.41,612,10,1,0)
1^4^^Medication: ^^1^^^^S.RX
"DATA",101.41,612,10,1,1)
Enter the medication you wish to order for this patient.
"DATA",101.41,612,10,1,2)
1^@618
"DATA",101.41,612,10,1,4)
I $$ACTIVE^ORDD43(Y)
"DATA",101.41,612,10,1,5)
D DEA^ORCDPS1 Q:'$G(DONE)  I $G(ORESET)'=+Y D CHANGED^ORCDPS1("OI")
"DATA",101.41,612,10,1,6)
N IDX,SCR S IDX=$G(ORDIALOG(PROMPT,"D")),SCR=$G(ORDIALOG(PROMPT,"S")) D XHELP^ORDD43(IDX,SCR)
"DATA",101.41,612,10,1,9)
D ENOI^ORCDPS1
"DATA",101.41,612,10,1,10)
S OROI=+$G(ORDIALOG(PROMPT,INST)) D ORDITM^ORCDPS1(OROI),NFI^ORCDPS1(OROI) S ORPKG=+$O(^DIC(9.4,"C",$S(ORCAT="I":"PSJ",1:"PSO"),0))
"DATA",101.41,612,10,2,0)
2^136^^Dose: ^^1^1^^C^^^^Instructions: 
"DATA",101.41,612,10,2,1)
Enter the dosage instructions for this order, as an amount and units.
"DATA",101.41,612,10,2,5)
D CHDOSE^ORCDPS2 Q:'$G(DONE)  D DEFCONJ^ORCDPS1
"DATA",101.41,612,10,2,6)
D LIST^ORCD:$G(ORDIALOG(PROMPT,"LIST")),F^ORCDLGH:'$G(ORDIALOG(PROMPT,"LIST"))
"DATA",101.41,612,10,2,9)
D DOSES^ORCDPS2 I $G(ORDIALOG(PROMPT,"LIST")),'$O(ORDIALOG(PROMPT,0)),'$G(ORENEW) D LIST^ORCD
"DATA",101.41,612,10,2,10)
D EXDOSE^ORCDPS2
"DATA",101.41,612,10,3,0)
2.1^137^^^^1^^^C^^136
"DATA",101.41,612,10,3,1)
Enter the route of administration for this drug.
"DATA",101.41,612,10,3,2)
^1~3
"DATA",101.41,612,10,3,4)
I $P(^(0),U,4)
"DATA",101.41,612,10,3,6)
D LIST^ORCD:$G(ORDIALOG(PROMPT,"LIST"))&(X="?"),P^ORCDLGH:'$G(ORDIALOG(PROMPT,"LIST"))!(X'="?")
"DATA",101.41,612,10,3,7)
D DEFRTE^ORCDPS1
"DATA",101.41,612,10,3,9)
D ROUTES^ORCDPS1
"DATA",101.41,612,10,3,10)
S OROUTE=+$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,612,10,4,0)
2.2^170^^^^1^^^C^^136
"DATA",101.41,612,10,4,1)
Enter a standard schedule for administering this medication.
"DATA",101.41,612,10,4,5)
D CKSCH^ORCDPS1
"DATA",101.41,612,10,4,6)
N DIC,D,DZ S DIC="^PS(51.1,",DIC(0)="EQS",D="APPSJ",DZ="??" D MIX^PSSDI(51.1,"PSJ",.DIC,D,.X)
"DATA",101.41,612,10,4,7)
S:$L($G(^TMP("PSJSCH",$J))) Y=^($J)
"DATA",101.41,612,10,4,9)
S:ORCAT="I" REQD=$$SCHREQ^PSJORPOE(OROUTE,OROI,$G(ORDRUG))
"DATA",101.41,612,10,4,10)
S ORSCH=$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,612,10,5,0)
8^7^^Priority: ^^1^^^C^S.PSO
"DATA",101.41,612,10,5,1)
Enter the urgency of this order.
"DATA",101.41,612,10,5,2)
6^^ROUTINE DONE
"DATA",101.41,612,10,5,7)
S Y=+$$RECALL^ORCD(PROMPT) S:Y EDITONLY=1 S:'Y Y=9
"DATA",101.41,612,10,5,9)
S ORDIALOG(PROMPT,"D")=$S(ORCAT="I":"S.PSJ",1:"S.PSO")
"DATA",101.41,612,10,6,0)
10^15^^Comments: ^^^^^C
"DATA",101.41,612,10,6,1)
Enter any additional instructions for this order.
"DATA",101.41,612,10,6,2)
7
"DATA",101.41,612,10,6,3)
I '$G(PSJNOPC)!($G(ORTYPE)="Z")
"DATA",101.41,612,10,7,0)
1.1^613^^^^^^^^^4
"DATA",101.41,612,10,7,2)
^@618
"DATA",101.41,612,10,7,3)
I 0 ;stuffed in via Instructions
"DATA",101.41,612,10,8,0)
5.5^149^^^^^^^C
"DATA",101.41,612,10,8,1)
Enter the amount (number of tablets, e.g.) to be dispensed.
"DATA",101.41,612,10,8,2)
8^^^Quantity:^^1
"DATA",101.41,612,10,8,3)
I ORCAT="O"
"DATA",101.41,612,10,8,7)
I $G(ORCAT)="O",$G(ORTYPE)'="Z" S Y=$$QTY^ORCDPS1 K:Y'>0 Y
"DATA",101.41,612,10,8,9)
I ORCAT="O" W:$L($G(ORQTY)) !,ORQTY S ORDIALOG(PROMPT,"A")="Quantity"_$S($L($G(ORQTYUNT)):" ("_ORQTYUNT_"): ",1:": ")
"DATA",101.41,612,10,9,0)
7^148^^Pick Up: ^^1^^^RC
"DATA",101.41,612,10,9,1)
Enter if the patient is to receive this medication by mail, at the window, or in the clinic.
"DATA",101.41,612,10,9,3)
I ORCAT="O"
"DATA",101.41,612,10,9,6)
D SETLIST^ORCD
"DATA",101.41,612,10,9,7)
I ORCAT="O",$G(ORTYPE)'="Z" S Y=$S($G(OREVENT):"W",$D(^PSX(550,"C")):"M",1:"W") I $D(^TMP("ORECALL",$J,ORDIALOG,PROMPT,INST)) S Y=^(INST),EDITONLY=1
"DATA",101.41,612,10,10,0)
6^150^^Refills: ^^1^^^RC
"DATA",101.41,612,10,10,1)
Enter the number of refills to allow for this order.
"DATA",101.41,612,10,10,2)
9^^^Refills:
"DATA",101.41,612,10,10,3)
I ORCAT="O",$G(OREFILLS)>0
"DATA",101.41,612,10,10,9)
I ORCAT="O",'$G(OREFILLS) D MAXREFS^ORCDPS1
"DATA",101.41,612,10,11,0)
9^151^^Is this medication for a SC condition? ^^^^^CW^^^^SC: 
"DATA",101.41,612,10,11,1)
If this medication is for treatment of a service-connected condition, enter YES.
"DATA",101.41,612,10,11,3)
I ORCAT="O",$G(ORCOPAY),$G(ORSC)
"DATA",101.41,612,10,11,6)
N DFN S DFN=+ORVP D DIS^DGRPDB
"DATA",101.41,612,10,11,7)
I $G(ORTYPE)'="Z",ORCAT="O",$G(ORCOPAY),$G(ORSC) S Y=$S($P(ORSC,U,2)>50:1,1:0)
"DATA",101.41,612,10,11,9)
I ORCAT="O" S ORCOPAY=$$ASKSC^ORCDPS1 I ORCOPAY,$G(ORSC),'$D(ORDIALOG(PROMPT,INST)) N DFN S DFN=+ORVP D:$P(ORSC,U,2)'>50 DIS^DGRPDB S:$P(ORSC,U,2)>50 $P(ORDIALOG(PROMPT,0),U)="YA",EDITONLY=1 ; Req'd
"DATA",101.41,612,10,12,0)
2.3^153^^How long: ^^^^^C^^136
"DATA",101.41,612,10,12,1)
Enter the length of time over which this dose is to be administered as '4 HOURS', '7 DAYS', '2 WEEKS', or '1 MONTH'.
"DATA",101.41,612,10,12,2)
^^^FOR
"DATA",101.41,612,10,12,3)
I $$ASKDUR^ORCDPS3
"DATA",101.41,612,10,12,5)
D DUR^ORCDPS3
"DATA",101.41,612,10,12,7)
Q  I $G(ORTYPE)'="Z",$G(ORCAT)="I",$G(ORCOMPLX),$P($G(ORSD),U,3) S Y=+$P(ORSD,U,3)_" DAYS"
"DATA",101.41,612,10,13,0)
4^6^^Start: ^^^^1^C
"DATA",101.41,612,10,13,1)
Enter the date this order should begin.
"DATA",101.41,612,10,13,3)
I $G(ORCAT)="O",$G(OREVENT) ;discharge orders only
"DATA",101.41,612,10,13,7)
Q  I $G(ORTYPE)'="Z",ORCAT'="O" S Y=$P($G(ORSD),U) K:'$L(Y) Y
"DATA",101.41,612,10,13,9)
D START^ORCDPS3 ;I 'FIRST,$G(ORDIALOG(PROMPT,"LIST")),'$O(ORDIALOG(PROMPT,0)) D LIST^ORCD ;editonly
"DATA",101.41,612,10,14,0)
3^614^^Text: 
"DATA",101.41,612,10,14,2)
2^^^^^1^0
"DATA",101.41,612,10,14,3)
I 0 ;created by Instructions, if Outpt order
"DATA",101.41,612,10,15,0)
2.5^615^^^^^^^*^^136
"DATA",101.41,612,10,15,2)
^@
"DATA",101.41,612,10,15,3)
I 0 ;created by Instructions
"DATA",101.41,612,10,15,7)
S Y=$$ID^ORCDPS K:'$L(Y) Y
"DATA",101.41,612,10,16,0)
2.6^138^^^^^^^*^^
"DATA",101.41,612,10,16,2)
^
"DATA",101.41,612,10,16,3)
I 0 ;created by Instructions
"DATA",101.41,612,10,17,0)
5^616^^^^1^^^C
"DATA",101.41,612,10,17,1)
Enter the number of days for which the patient needs this medication.
"DATA",101.41,612,10,17,3)
I $G(ORCAT)="O"
"DATA",101.41,612,10,17,5)
I $G(ORESET),+ORESET'=+Y D CHANGED^ORCDPS1("DS")
"DATA",101.41,612,10,17,9)
I $G(ORCAT)="O" D DSUP^ORCDPS1
"DATA",101.41,612,10,17,10)
S:$G(ORCAT)="O" ORDSUP=+$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,612,10,18,0)
1.5^618
"DATA",101.41,612,10,18,2)
1.5
"DATA",101.41,612,10,18,3)
I 0 ;stuffed in via Instructions
"DATA",101.41,612,10,19,0)
2.4^617^^^^^^^C^^136
"DATA",101.41,612,10,19,1)
Enter AND if the next dose is to be administered concurrently with this one, or THEN if it is to follow after.
"DATA",101.41,612,10,19,3)
I $G(ORCOMPLX)
"DATA",101.41,612,10,19,5)
I $G(ORESET)'=$P(Y,U) D CHANGED^ORCDPS1("QUANTITY")
"DATA",101.41,612,10,19,9)
D ENCONJ^ORCDPS1
"DATA",101.41,612,10,19,10)
I $G(ORCOMPLX),'$L($G(ORDIALOG(PROMPT,INST))),FIRST S MAX=1 ;stop prompting dose multiple
"DATA",101.41,612,10,20,0)
3.5^1358^^^^^^^C
"DATA",101.41,612,10,20,2)
3
"DATA",101.41,612,10,20,3)
I 0 ;text stuffed via Entry Action
"DATA",101.41,612,10,20,9)
D PI^ORCDPS2
"DATA",101.41,612,10,21,0)
4.5^1359
"DATA",101.41,612,10,21,2)
10^^^First Dose^^1
"DATA",101.41,612,10,21,3)
I 0 ;set via Entry Action
"DATA",101.41,612,10,21,9)
D NOW^ORCDPS3
"DATA",101.41,612,10,22,0)
11^1615
"DATA",101.41,612,10,22,2)
6.5
"DATA",101.41,612,10,23,0)
2.7^15813^^^^^^^*^^136
"DATA",101.41,612,10,23,2)
^@
"DATA",101.41,612,10,23,3)
I 0 ;from Schedule
"DATA",101.41,612,10,24,0)
2.8^716^^^^^^^*^^136
"DATA",101.41,612,10,24,3)
I 0
"DATA",101.41,612,99)
61031,45825
"DATA",101.41,621,0)
PSH OERR^Non VA Medications^^D^47^0^391^0^2
"DATA",101.41,621,3)
D EN^ORCDPSH("H")
"DATA",101.41,621,3.1)
D EN1^ORCDPSH
"DATA",101.41,621,4)
D EXIT^ORCDPSH
"DATA",101.41,621,5)
^^^Meds, Non-VA^145
"DATA",101.41,621,10,0)
^101.412IA^21^13
"DATA",101.41,621,10,1,0)
1^4^^Herbal/OTC/Non VA Medication:^^1^^^^S.NV RX
"DATA",101.41,621,10,1,1)
Enter the herbal/OTC/non-VA medication you wish to order for this patient.
"DATA",101.41,621,10,1,2)
1^@618
"DATA",101.41,621,10,1,4)
I $$ACTIVE^ORDD43(Y)
"DATA",101.41,621,10,1,5)
Q:'$G(DONE)  I $G(ORESET)'=+Y D CHANGED^ORCDPSH("OI")
"DATA",101.41,621,10,1,6)
N IDX,SCR S IDX=$G(ORDIALOG(PROMPT,"D")),SCR=$G(ORDIALOG(PROMPT,"S")) D XHELP^ORDD43(IDX,SCR)
"DATA",101.41,621,10,1,9)
D ENOI^ORCDPSH
"DATA",101.41,621,10,1,10)
S OROI=+$G(ORDIALOG(PROMPT,INST)) D ORDITM^ORCDPSH(OROI),NFI^ORCDPSH(OROI)
"DATA",101.41,621,10,2,0)
2^136^^Dose: ^^0^1^^C^^^^Instructions: 
"DATA",101.41,621,10,2,1)
Enter the dosage instructions for this order, as an amount and units.
"DATA",101.41,621,10,2,5)
D CHDOSE^ORCDPS2 Q:'$G(DONE)
"DATA",101.41,621,10,2,6)
D LIST^ORCD:$G(ORDIALOG(PROMPT,"LIST")),F^ORCDLGH:'$G(ORDIALOG(PROMPT,"LIST"))
"DATA",101.41,621,10,2,9)
D DOSES^ORCDPS2 I $G(ORDIALOG(PROMPT,"LIST")),'$O(ORDIALOG(PROMPT,0)),'$G(ORENEW) D LIST^ORCD
"DATA",101.41,621,10,2,10)
D EXDOSE^ORCDPS2
"DATA",101.41,621,10,3,0)
2.1^137^^^^0^^^C^^136
"DATA",101.41,621,10,3,1)
Enter the route of administration for this drug.
"DATA",101.41,621,10,3,2)
^1~3
"DATA",101.41,621,10,3,4)
I $P(^(0),U,4)
"DATA",101.41,621,10,3,6)
D LIST^ORCD:$G(ORDIALOG(PROMPT,"LIST"))&(X="?"),P^ORCDLGH:'$G(ORDIALOG(PROMPT,"LIST"))!(X'="?")
"DATA",101.41,621,10,3,7)
D DEFRTE^ORCDPSH
"DATA",101.41,621,10,3,9)
D ROUTES^ORCDPSH
"DATA",101.41,621,10,3,10)
S OROUTE=+$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,621,10,4,0)
2.2^170^^^^0^^^C^^136
"DATA",101.41,621,10,4,1)
Enter a standard schedule for administering this medication.
"DATA",101.41,621,10,4,2)

"DATA",101.41,621,10,4,5)
D CKSCH^ORCDPSH
"DATA",101.41,621,10,4,6)
N DIC,D,DZ S DIC="^PS(51.1,",DIC(0)="EQS",D="APPSJ",DZ="??" D MIX^PSSDI(51.1,"PSJ",.DIC,D,.X)
"DATA",101.41,621,10,4,7)
S:$L($G(^TMP("PSJSCH",$J))) Y=^($J)
"DATA",101.41,621,10,4,9)
S:ORCAT="I" REQD=$$SCHREQ^PSJORPOE(OROUTE,OROI,$G(ORDRUG))
"DATA",101.41,621,10,4,10)
S ORSCH=$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,621,10,6,0)
10^15^^Comments: ^^0^^^C
"DATA",101.41,621,10,6,1)
Enter any additional instructions for this order.
"DATA",101.41,621,10,6,2)
7
"DATA",101.41,621,10,6,3)
I '$G(PSJNOPC)!($G(ORTYPE)="Z")
"DATA",101.41,621,10,7,0)
1.1^613^^^^0^^^^^4
"DATA",101.41,621,10,7,2)
^@618
"DATA",101.41,621,10,7,3)
I 0 ;stuffed in via Instructions
"DATA",101.41,621,10,13,0)
4^6^^^^0^^^RCW
"DATA",101.41,621,10,13,1)
Enter the date the patient began using this herbal/OTC/Non-VA medication.
"DATA",101.41,621,10,13,2)
2.5
"DATA",101.41,621,10,14,0)
3^614
"DATA",101.41,621,10,14,2)
2^^^^^1^0
"DATA",101.41,621,10,14,3)
I 0 ;created by Instructions, if Outpt order
"DATA",101.41,621,10,15,0)
2.5^615^^^^0^^^*^^136
"DATA",101.41,621,10,15,2)
^@
"DATA",101.41,621,10,15,3)
I 0 ;created by Instructions
"DATA",101.41,621,10,15,7)
S Y=$$ID^ORCDPS K:'$L(Y) Y
"DATA",101.41,621,10,16,0)
2.6^138^^^^^^^*
"DATA",101.41,621,10,16,3)
I 0 ;created by Instructions
"DATA",101.41,621,10,18,0)
1.5^618
"DATA",101.41,621,10,18,2)
1.5
"DATA",101.41,621,10,18,3)
I 0 ;stuffed in via Instructions
"DATA",101.41,621,10,20,0)
3.5^1358^^^^^^^C
"DATA",101.41,621,10,20,2)
3
"DATA",101.41,621,10,20,3)
I 0 ;text stuffed via Entry Action
"DATA",101.41,621,10,20,9)
D PI^ORCDPS2
"DATA",101.41,621,10,21,0)
11^1615^^^^0
"DATA",101.41,621,10,21,2)
6.5
"DATA",101.41,621,99)
61031,45824
"DATA",101.41,716,0)
OR GTX SCHEDULE TYPE^Schedule Type:^^P
"DATA",101.41,716,1)
F^2:119^SCHTYPE
"DATA",101.41,716,99)
61031,45823
"DATA",101.41,15794,0)
OR GTX STUDY REASON^Reason for Study: ^^P
"DATA",101.41,15794,1)
F^3:64^REASON
"DATA",101.41,15794,2,0)
^^1^1^3060530^
"DATA",101.41,15794,2,1,0)
This prompts for a free text reason why this study is being ordered.
"DATA",101.41,15794,99)
61031,45825
"DATA",101.41,15809,0)
OR GTX IV TYPE^Type: ^^P
"DATA",101.41,15809,1)
S^C:Continuous;I:Intermittent;^TYPE
"DATA",101.41,15809,99)
61031,45825
"DATA",101.41,15813,0)
OR GTX ADMIN TIMES^Administration Times: ^^P
"DATA",101.41,15813,1)
F^2:119^ADMIN
"DATA",101.41,15813,99)
61031,45825
"FIA",100)
ORDER
"FIA",100,0)
^OR(100,
"FIA",100,0,0)
100I
"FIA",100,0,1)
y^y^p^^^^n^^n
"FIA",100,0,10)

"FIA",100,0,11)

"FIA",100,0,"RLRO")

"FIA",100,0,"VR")
3.0^OR
"FIA",100,100)
1
"FIA",100,100,39)

"FIA",100,100,55)

"FIA",100,100,58)

"FIA",100,100,94)

"FIA",100,100,97)

"FIA",100,100,98)

"FIA",100,100.008)
1
"FIA",100,100.008,4)

"FIA",100,100.008,15)

"FIA",100.2)
OE/RR PATIENT EVENT
"FIA",100.2,0)
^ORE(100.2,
"FIA",100.2,0,0)
100.2IP
"FIA",100.2,0,1)
y^y^p^^^^n^^n
"FIA",100.2,0,10)

"FIA",100.2,0,11)

"FIA",100.2,0,"RLRO")

"FIA",100.2,0,"VR")
3.0^OR
"FIA",100.2,100.2)
1
"FIA",100.2,100.2,14)

"FIA",100.2,100.25)
1
"FIA",100.2,100.25,4)

"FIA",100.21)
OE/RR LIST
"FIA",100.21,0)
^OR(100.21,
"FIA",100.21,0,0)
100.21
"FIA",100.21,0,1)
y^y^f^^^^n^^n
"FIA",100.21,0,10)

"FIA",100.21,0,11)

"FIA",100.21,0,"RLRO")

"FIA",100.21,0,"VR")
3.0^OR
"FIA",100.21,100.21)
0
"FIA",100.21,100.2101)
0
"FIA",100.21,100.21019)
0
"FIA",100.21,100.212)
0
"FIA",100.21,100.213)
0
"FIA",101.24)
OE/RR REPORT
"FIA",101.24,0)
^ORD(101.24,
"FIA",101.24,0,0)
101.24I
"FIA",101.24,0,1)
y^n^f^^y^^y^r^n
"FIA",101.24,0,10)

"FIA",101.24,0,11)
I (Y=3)!((Y>17)&(Y<28))!(Y>999)!(Y=48)
"FIA",101.24,0,"RLRO")

"FIA",101.24,0,"VR")
3.0^OR
"FIA",101.24,101.24)
0
"FIA",101.24,101.241)
0
"FIA",101.24,101.243)
0
"FIA",101.41)
ORDER DIALOG
"FIA",101.41,0)
^ORD(101.41,
"FIA",101.41,0,0)
101.41I
"FIA",101.41,0,1)
n^n^f^^y^^y^r^n
"FIA",101.41,0,10)

"FIA",101.41,0,11)
I $$SENDDLG^ORY243($P(^(0),U))
"FIA",101.41,0,"RLRO")

"FIA",101.41,0,"VR")
3.0^OR
"FIA",101.41,101.41)
0
"FIA",101.41,101.411)
0
"FIA",101.41,101.412)
0
"FIA",101.41,101.41218)
0
"FIA",101.41,101.415)
0
"FIA",101.41,101.416)
0
"FIA",101.41,101.4162)
0
"FIA",101.43)
ORDERABLE ITEMS
"FIA",101.43,0)
^ORD(101.43,
"FIA",101.43,0,0)
101.43
"FIA",101.43,0,1)
y^y^f^^^^n
"FIA",101.43,0,10)

"FIA",101.43,0,11)

"FIA",101.43,0,"RLRO")

"FIA",101.43,0,"VR")
3.0^OR
"FIA",101.43,101.43)
0
"FIA",101.43,101.431)
0
"FIA",101.43,101.432)
0
"FIA",101.43,101.438)
0
"FIA",101.43,101.439)
0
"FRV1",101.24,"1004,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1004,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1004,0",21)
DISCHARGE SUMMARY
"FRV1",101.24,"1004,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1006,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1006,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1007,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1007,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1018,0",21)
MAS DEMOGRAPHICS
"FRV1",101.24,"1018,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1028,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1028,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1028,0",21)
SURGERY REPORTS
"FRV1",101.24,"1028,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1029,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1029,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1029,0",21)
VITAL SIGNS
"FRV1",101.24,"1029,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1032,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1032,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1032,0",21)
ADVERSE REACTIONS/ALLERG BRIEF
"FRV1",101.24,"1032,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1033,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1033,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1033,0",21)
MAS DEMOGRAPHICS
"FRV1",101.24,"1033,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1034,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1034,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1035,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1035,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1035,0",21)
MAS DISABILITIES
"FRV1",101.24,"1035,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1036,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1036,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1036,0",21)
MAS ADMISSIONS/DISCHARGES
"FRV1",101.24,"1036,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1037,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1037,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1037,0",21)
MAS ADT HISTORY EXPANDED
"FRV1",101.24,"1037,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1038,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1038,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1038,0",21)
MAS DISCHARGE DIAGNOSIS
"FRV1",101.24,"1038,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1039,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1039,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1039,0",21)
MAS DISCHARGES
"FRV1",101.24,"1039,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1040,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1040,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1040,0",21)
MAS CLINIC VISITS FUTURE
"FRV1",101.24,"1040,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1041,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1041,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1041,0",21)
MAS PROCEDURES ICD CODES
"FRV1",101.24,"1041,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1042,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1042,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1042,0",21)
MAS SURGERIES ICD CODES
"FRV1",101.24,"1042,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1043,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1043,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1043,0",21)
MAS TRANSFERS
"FRV1",101.24,"1043,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1044,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1044,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1044,0",21)
MAS TREATING SPECIALTY
"FRV1",101.24,"1044,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1045,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1045,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1045,0",21)
COMPENSATION AND PENSION EXAMS
"FRV1",101.24,"1045,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1046,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1046,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1046,0",21)
DIETETICS
"FRV1",101.24,"1046,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1047,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1047,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1047,0",21)
DIETETICS
"FRV1",101.24,"1047,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1048,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1048,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1049,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1049,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1050,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1050,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1051,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1051,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1051,0",21)
LAB BLOOD AVAILABILITY
"FRV1",101.24,"1051,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1052,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1052,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1052,0",21)
LAB BLOOD TRANSFUSIONS
"FRV1",101.24,"1052,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1054,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1054,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1054,0",21)
LAB MICROBIOLOGY
"FRV1",101.24,"1054,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1055,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1055,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1055,0",21)
LAB CHEMISTRY & HEMATOLOGY
"FRV1",101.24,"1055,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1056,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1056,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1057,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1057,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1057,0",21)
LAB ORDERS
"FRV1",101.24,"1057,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1058,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1058,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1059,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1059,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1060,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1060,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1060,0",21)
MAS ADT HISTORY
"FRV1",101.24,"1060,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1061,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1061,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1061,0",21)
MEDICINE ABNORMAL BRIEF
"FRV1",101.24,"1061,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1062,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1062,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1062,0",21)
MEDICINE BRIEF REPORT
"FRV1",101.24,"1062,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1063,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1063,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1063,0",21)
MEDICINE FULL CAPTIONED
"FRV1",101.24,"1063,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1064,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1064,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1064,0",21)
MEDICINE FULL REPORT
"FRV1",101.24,"1064,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1065,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1065,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1065,0",21)
MAS CLINIC VISITS PAST
"FRV1",101.24,"1065,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1066,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1066,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1066,0",21)
PCE EDUCATION
"FRV1",101.24,"1066,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1067,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1067,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1067,0",21)
PCE EDUCATION LATEST
"FRV1",101.24,"1067,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1068,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1068,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1068,0",21)
GLOBAL ASSESSMENT FUNCTIONING
"FRV1",101.24,"1068,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1069,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1069,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1069,0",21)
PCE HEALTH FACTORS ALL
"FRV1",101.24,"1069,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1070,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1070,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1070,0",21)
PCE IMMUNIZATIONS
"FRV1",101.24,"1070,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1071,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1071,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1071,0",21)
PCE LOCATION OF HOME
"FRV1",101.24,"1071,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1072,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1072,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1072,0",21)
PCE OUTPATIENT DIAGNOSIS
"FRV1",101.24,"1072,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1073,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1073,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1073,0",21)
PCE OUTPATIENT ENCOUNTERS
"FRV1",101.24,"1073,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1074,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1074,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1074,0",21)
PCE SKIN TESTS
"FRV1",101.24,"1074,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1076,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1076,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1076,0",21)
PCE EXAMS LATEST
"FRV1",101.24,"1076,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1077,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1077,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1077,0",21)
PCE TREATMENTS PROVIDED
"FRV1",101.24,"1077,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1078,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1078,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1079,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1079,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1079,0",21)
PHARMACY OUTPATIENT
"FRV1",101.24,"1079,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1080,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1080,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1081,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1081,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1081,0",21)
PHARMACY INTRAVENOUS
"FRV1",101.24,"1081,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1082,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1082,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1082,0",21)
PHARMACY UNIT DOSE
"FRV1",101.24,"1082,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1083,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1083,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1083,0",21)
PROBLEM LIST ACTIVE
"FRV1",101.24,"1083,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1084,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1084,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1084,0",21)
PROBLEM LIST ALL
"FRV1",101.24,"1084,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1085,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1085,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1085,0",21)
PROBLEM LIST INACTIVE
"FRV1",101.24,"1085,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1086,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1086,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1086,0",21)
PROGRESS NOTES
"FRV1",101.24,"1086,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1087,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1087,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1087,0",21)
ADVANCE DIRECTIVE
"FRV1",101.24,"1087,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1088,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1088,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1088,0",21)
CLINICAL WARNINGS
"FRV1",101.24,"1088,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1089,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1089,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1089,0",21)
CRISIS NOTES
"FRV1",101.24,"1089,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1090,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1090,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1090,0",21)
IMAGING IMPRESSION
"FRV1",101.24,"1090,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1091,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1091,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1091,0",21)
IMAGING PROFILE
"FRV1",101.24,"1091,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1092,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1092,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1092,0",21)
IMAGING STATUS
"FRV1",101.24,"1092,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1093,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1093,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1094,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1094,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1095,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1095,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1096,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1096,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1097,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1097,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1098,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1098,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1100,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1100,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1100,0",21)
ORDERS CURRENT
"FRV1",101.24,"1100,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1101,0",21)
MAS DEMOGRAPHICS
"FRV1",101.24,"1101,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1105,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1105,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1105,0",21)
PHARMACY OUTPATIENT
"FRV1",101.24,"1105,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1106,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1106,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1106,0",21)
IMAGING PROFILE
"FRV1",101.24,"1106,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1130,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1130,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1130,0",21)
DISCHARGE SUMMARY
"FRV1",101.24,"1130,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1131,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1131,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1131,0",21)
MAS ADT HISTORY EXPANDED
"FRV1",101.24,"1131,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1132,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1132,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1132,0",21)
LAB CHEMISTRY & HEMATOLOGY
"FRV1",101.24,"1132,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1133,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1133,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1133,0",21)
LAB MICROBIOLOGY
"FRV1",101.24,"1133,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1134,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1134,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1134,0",21)
LAB ORDERS
"FRV1",101.24,"1134,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1135,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1135,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1135,0",21)
LAB SURGICAL PATHOLOGY
"FRV1",101.24,"1135,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1136,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1136,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1136,0",21)
LAB CYTOPATHOLOGY
"FRV1",101.24,"1136,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1137,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1137,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1137,0",21)
ADVERSE REACTIONS/ALLERG BRIEF
"FRV1",101.24,"1137,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1138,0",13)
ORQQPX IMMUN LIST
"FRV1",101.24,"1138,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1138,0",18)
ORCV VISIT DETAILS
"FRV1",101.24,"1138,0",18,"F")
;ORD(101.24,
"FRV1",101.24,"1139,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1139,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1140,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1140,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1140,0",21)
PCE OUTPATIENT ENCOUNTERS
"FRV1",101.24,"1140,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1141,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1141,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1141,0",21)
VITAL SIGNS
"FRV1",101.24,"1141,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1551,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1551,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1551,0",21)
ADVERSE REACTIONS/ALLERG BRIEF
"FRV1",101.24,"1551,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1552,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1552,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1552,0",21)
VITAL SIGNS
"FRV1",101.24,"1552,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1553,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1553,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1553,0",21)
PHARMACY OUTPATIENT
"FRV1",101.24,"1553,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1554,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1554,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1554,0",21)
PROGRESS NOTES
"FRV1",101.24,"1554,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1555,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1555,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1556,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1556,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1556,0",21)
LAB CHEMISTRY & HEMATOLOGY
"FRV1",101.24,"1556,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1557,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1557,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1557,0",21)
PROBLEM LIST ALL
"FRV1",101.24,"1557,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"1600,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1600,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1601,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1601,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1602,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1602,0",13,"F")
;XWB(8994,
"FRV1",101.24,"1603,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"1603,0",13,"F")
;XWB(8994,
"FRV1",101.24,"19,0",13)
ORWLR CUMULATIVE REPORT
"FRV1",101.24,"19,0",13,"F")
;XWB(8994,
"FRV1",101.24,"20,0",13)
ORWLRR INTERIM
"FRV1",101.24,"20,0",13,"F")
;XWB(8994,
"FRV1",101.24,"23,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"23,0",13,"F")
;XWB(8994,
"FRV1",101.24,"23,0",21)
LAB MICROBIOLOGY
"FRV1",101.24,"23,0",21,"F")
;GMT(142.1,
"FRV1",101.24,"24,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"24,0",13,"F")
;XWB(8994,
"FRV1",101.24,"25,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"25,0",13,"F")
;XWB(8994,
"FRV1",101.24,"26,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"26,0",13,"F")
;XWB(8994,
"FRV1",101.24,"3,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"3,0",13,"F")
;XWB(8994,
"FRV1",101.24,"48,0",13)
ORWRP REPORT TEXT
"FRV1",101.24,"48,0",13,"F")
;XWB(8994,
"FRV1",101.41,"1,0",5)
IMAGING
"FRV1",101.41,"1,0",5,"F")
;ORD(100.98,
"FRV1",101.41,"1,0",7)
RADIOLOGY/NUCLEAR MEDICINE
"FRV1",101.41,"1,0",7,"F")
;DIC(9.4,
"FRV1",101.41,"1,10,1,0",2)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"1,10,1,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,10,0",2)
OR GTX PRE-OP SCHEDULED DATE/TIME
"FRV1",101.41,"1,10,10,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,11,0",2)
OR GTX PREGNANT
"FRV1",101.41,"1,10,11,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,12,0",2)
OR GTX WORD PROCESSING 1
"FRV1",101.41,"1,10,12,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,13,0",2)
OR GTX YES/NO
"FRV1",101.41,"1,10,13,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,14,0",2)
OR GTX LOCATION
"FRV1",101.41,"1,10,14,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,15,0",2)
OR GTX PROVIDER
"FRV1",101.41,"1,10,15,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,16,0",2)
OR GTX VISITSTR
"FRV1",101.41,"1,10,16,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,17,0",2)
OR GTX STUDY REASON
"FRV1",101.41,"1,10,17,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,2,0",2)
OR GTX MODIFIERS
"FRV1",101.41,"1,10,2,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,3,0",2)
OR GTX START DATE/TIME
"FRV1",101.41,"1,10,3,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,4,0",2)
OR GTX URGENCY
"FRV1",101.41,"1,10,4,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,5,0",2)
OR GTX IMAGING LOCATION
"FRV1",101.41,"1,10,5,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,6,0",2)
OR GTX MODE OF TRANSPORT
"FRV1",101.41,"1,10,6,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,7,0",2)
OR GTX CATEGORY
"FRV1",101.41,"1,10,7,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,8,0",2)
OR GTX CONTRACT/SHARING SOURCE
"FRV1",101.41,"1,10,8,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,9,0",2)
OR GTX RESEARCH SOURCE
"FRV1",101.41,"1,10,9,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,0",5)
UNIT DOSE MEDICATIONS
"FRV1",101.41,"129,0",5,"F")
;ORD(100.98,
"FRV1",101.41,"129,0",7)
INPATIENT MEDICATIONS
"FRV1",101.41,"129,0",7,"F")
;DIC(9.4,
"FRV1",101.41,"129,10,1,0",2)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"129,10,1,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,10,0",2)
OR GTX REFILLS
"FRV1",101.41,"129,10,10,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,11,0",2)
OR GTX SERVICE CONNECTED
"FRV1",101.41,"129,10,11,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,12,0",2)
OR GTX DURATION
"FRV1",101.41,"129,10,12,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,12,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"129,10,12,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,13,0",2)
OR GTX START DATE/TIME
"FRV1",101.41,"129,10,13,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,14,0",2)
OR GTX SIG
"FRV1",101.41,"129,10,14,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,15,0",2)
OR GTX DOSE
"FRV1",101.41,"129,10,15,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,15,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"129,10,15,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,16,0",2)
OR GTX DISPENSE DRUG
"FRV1",101.41,"129,10,16,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,17,0",2)
OR GTX DAYS SUPPLY
"FRV1",101.41,"129,10,17,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,18,0",2)
OR GTX DRUG NAME
"FRV1",101.41,"129,10,18,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,19,0",2)
OR GTX AND/THEN
"FRV1",101.41,"129,10,19,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,19,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"129,10,19,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,2,0",2)
OR GTX INSTRUCTIONS
"FRV1",101.41,"129,10,2,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,20,0",2)
OR GTX PATIENT INSTRUCTIONS
"FRV1",101.41,"129,10,20,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,21,0",2)
OR GTX NOW
"FRV1",101.41,"129,10,21,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,22,0",2)
OR GTX ADMIN TIMES
"FRV1",101.41,"129,10,22,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,22,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"129,10,22,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,23,0",2)
OR GTX SCHEDULE TYPE
"FRV1",101.41,"129,10,23,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,23,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"129,10,23,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,3,0",2)
OR GTX ROUTE
"FRV1",101.41,"129,10,3,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,3,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"129,10,3,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,4,0",2)
OR GTX SCHEDULE
"FRV1",101.41,"129,10,4,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,4,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"129,10,4,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,5,0",2)
OR GTX URGENCY
"FRV1",101.41,"129,10,5,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,6,0",2)
OR GTX WORD PROCESSING 1
"FRV1",101.41,"129,10,6,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,7,0",2)
OR GTX STRENGTH
"FRV1",101.41,"129,10,7,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,7,0",11)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"129,10,7,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,8,0",2)
OR GTX QUANTITY
"FRV1",101.41,"129,10,8,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,9,0",2)
OR GTX ROUTING
"FRV1",101.41,"129,10,9,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"130,0",5)
IV MEDICATIONS
"FRV1",101.41,"130,0",5,"F")
;ORD(100.98,
"FRV1",101.41,"130,0",7)
INPATIENT MEDICATIONS
"FRV1",101.41,"130,0",7,"F")
;DIC(9.4,
"FRV1",101.41,"130,10,1,0",2)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"130,10,1,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,10,0",2)
OR GTX VOLUME
"FRV1",101.41,"130,10,10,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,10,0",11)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"130,10,10,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,11,0",2)
OR GTX URGENCY
"FRV1",101.41,"130,10,11,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,12,0",2)
OR GTX SCHEDULE
"FRV1",101.41,"130,10,12,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,13,0",2)
OR GTX DURATION
"FRV1",101.41,"130,10,13,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,14,0",2)
OR GTX IV TYPE
"FRV1",101.41,"130,10,14,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,15,0",2)
OR GTX ROUTE
"FRV1",101.41,"130,10,15,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,16,0",2)
OR GTX ADMIN TIMES
"FRV1",101.41,"130,10,16,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,17,0",2)
OR GTX NOW
"FRV1",101.41,"130,10,17,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,2,0",2)
OR GTX ADDITIVE
"FRV1",101.41,"130,10,2,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,3,0",2)
OR GTX STRENGTH PSIV
"FRV1",101.41,"130,10,3,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,3,0",11)
OR GTX ADDITIVE
"FRV1",101.41,"130,10,3,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,5,0",2)
OR GTX INFUSION RATE
"FRV1",101.41,"130,10,5,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,7,0",2)
OR GTX WORD PROCESSING 1
"FRV1",101.41,"130,10,7,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,9,0",2)
OR GTX UNITS
"FRV1",101.41,"130,10,9,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"130,10,9,0",11)
OR GTX ADDITIVE
"FRV1",101.41,"130,10,9,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"147,0",5)
OUTPATIENT MEDICATIONS
"FRV1",101.41,"147,0",5,"F")
;ORD(100.98,
"FRV1",101.41,"147,0",7)
OUTPATIENT PHARMACY
"FRV1",101.41,"147,0",7,"F")
;DIC(9.4,
"FRV1",101.41,"147,10,1,0",2)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"147,10,1,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,10,0",2)
OR GTX REFILLS
"FRV1",101.41,"147,10,10,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,11,0",2)
OR GTX SERVICE CONNECTED
"FRV1",101.41,"147,10,11,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,12,0",2)
OR GTX DURATION
"FRV1",101.41,"147,10,12,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,12,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"147,10,12,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,13,0",2)
OR GTX START DATE/TIME
"FRV1",101.41,"147,10,13,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,14,0",2)
OR GTX SIG
"FRV1",101.41,"147,10,14,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,15,0",2)
OR GTX DOSE
"FRV1",101.41,"147,10,15,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,15,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"147,10,15,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,16,0",2)
OR GTX DISPENSE DRUG
"FRV1",101.41,"147,10,16,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,17,0",2)
OR GTX DAYS SUPPLY
"FRV1",101.41,"147,10,17,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,18,0",2)
OR GTX DRUG NAME
"FRV1",101.41,"147,10,18,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,19,0",2)
OR GTX AND/THEN
"FRV1",101.41,"147,10,19,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,19,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"147,10,19,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,2,0",2)
OR GTX INSTRUCTIONS
"FRV1",101.41,"147,10,2,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,20,0",2)
OR GTX PATIENT INSTRUCTIONS
"FRV1",101.41,"147,10,20,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,21,0",2)
OR GTX NOW
"FRV1",101.41,"147,10,21,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,3,0",2)
OR GTX ROUTE
"FRV1",101.41,"147,10,3,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,3,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"147,10,3,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,4,0",2)
OR GTX SCHEDULE
"FRV1",101.41,"147,10,4,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,4,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"147,10,4,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,5,0",2)
OR GTX URGENCY
"FRV1",101.41,"147,10,5,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,6,0",2)
OR GTX WORD PROCESSING 1
"FRV1",101.41,"147,10,6,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,7,0",2)
OR GTX STRENGTH
"FRV1",101.41,"147,10,7,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,7,0",11)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"147,10,7,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,8,0",2)
OR GTX QUANTITY
"FRV1",101.41,"147,10,8,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,9,0",2)
OR GTX ROUTING
"FRV1",101.41,"147,10,9,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,0",5)
SUPPLIES/DEVICES
"FRV1",101.41,"171,0",5,"F")
;ORD(100.98,
"FRV1",101.41,"171,0",7)
OUTPATIENT PHARMACY
"FRV1",101.41,"171,0",7,"F")
;DIC(9.4,
"FRV1",101.41,"171,10,1,0",2)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"171,10,1,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,10,0",2)
OR GTX REFILLS
"FRV1",101.41,"171,10,10,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,11,0",2)
OR GTX SERVICE CONNECTED
"FRV1",101.41,"171,10,11,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,12,0",2)
OR GTX DURATION
"FRV1",101.41,"171,10,12,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,12,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"171,10,12,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,13,0",2)
OR GTX START DATE/TIME
"FRV1",101.41,"171,10,13,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,14,0",2)
OR GTX SIG
"FRV1",101.41,"171,10,14,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,15,0",2)
OR GTX DOSE
"FRV1",101.41,"171,10,15,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,15,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"171,10,15,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,16,0",2)
OR GTX DISPENSE DRUG
"FRV1",101.41,"171,10,16,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,17,0",2)
OR GTX DAYS SUPPLY
"FRV1",101.41,"171,10,17,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,18,0",2)
OR GTX DRUG NAME
"FRV1",101.41,"171,10,18,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,19,0",2)
OR GTX AND/THEN
"FRV1",101.41,"171,10,19,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,19,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"171,10,19,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,2,0",2)
OR GTX INSTRUCTIONS
"FRV1",101.41,"171,10,2,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,20,0",2)
OR GTX PATIENT INSTRUCTIONS
"FRV1",101.41,"171,10,20,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,21,0",2)
OR GTX NOW
"FRV1",101.41,"171,10,21,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,3,0",2)
OR GTX ROUTE
"FRV1",101.41,"171,10,3,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,3,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"171,10,3,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,4,0",2)
OR GTX SCHEDULE
"FRV1",101.41,"171,10,4,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,4,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"171,10,4,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,5,0",2)
OR GTX URGENCY
"FRV1",101.41,"171,10,5,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,6,0",2)
OR GTX WORD PROCESSING 1
"FRV1",101.41,"171,10,6,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,7,0",2)
OR GTX STRENGTH
"FRV1",101.41,"171,10,7,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,7,0",11)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"171,10,7,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,8,0",2)
OR GTX QUANTITY
"FRV1",101.41,"171,10,8,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,9,0",2)
OR GTX ROUTING
"FRV1",101.41,"171,10,9,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"2,0",5)
LABORATORY
"FRV1",101.41,"2,0",5,"F")
;ORD(100.98,
"FRV1",101.41,"2,0",7)
LAB SERVICE
"FRV1",101.41,"2,0",7,"F")
;DIC(9.4,
"FRV1",101.41,"2,10,1,0",2)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"2,10,1,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"2,10,10,0",2)
OR GTX DURATION
"FRV1",101.41,"2,10,10,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"2,10,11,0",2)
OR GTX VISITSTR
"FRV1",101.41,"2,10,11,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"2,10,3,0",2)
OR GTX COLLECTION TYPE
"FRV1",101.41,"2,10,3,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"2,10,4,0",2)
OR GTX START DATE/TIME
"FRV1",101.41,"2,10,4,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"2,10,5,0",2)
OR GTX ADMIN SCHEDULE
"FRV1",101.41,"2,10,5,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"2,10,6,0",2)
OR GTX LAB URGENCY
"FRV1",101.41,"2,10,6,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"2,10,7,0",2)
OR GTX COLLECTION SAMPLE
"FRV1",101.41,"2,10,7,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"2,10,8,0",2)
OR GTX SPECIMEN
"FRV1",101.41,"2,10,8,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"2,10,9,0",2)
OR GTX WORD PROCESSING 1
"FRV1",101.41,"2,10,9,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"23,0",5)
DIET ORDERS
"FRV1",101.41,"23,0",5,"F")
;ORD(100.98,
"FRV1",101.41,"23,0",7)
DIETETICS
"FRV1",101.41,"23,0",7,"F")
;DIC(9.4,
"FRV1",101.41,"23,10,1,0",2)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"23,10,1,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"23,10,2,0",2)
OR GTX START DATE/TIME
"FRV1",101.41,"23,10,2,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"23,10,3,0",2)
OR GTX STOP DATE/TIME
"FRV1",101.41,"23,10,3,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"23,10,4,0",2)
OR GTX DELIVERY
"FRV1",101.41,"23,10,4,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"23,10,5,0",2)
OR GTX FREE TEXT 1
"FRV1",101.41,"23,10,5,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"23,10,6,0",2)
OR GTX CANCEL FUTURE ORDERS
"FRV1",101.41,"23,10,6,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"30,0",7)
ORDER ENTRY/RESULTS REPORTING
"FRV1",101.41,"30,0",7,"F")
;DIC(9.4,
"FRV1",101.41,"31,0",5)
DIET ADDITIONAL ORDERS
"FRV1",101.41,"31,0",5,"F")
;ORD(100.98,
"FRV1",101.41,"31,0",7)
DIETETICS
"FRV1",101.41,"31,0",7,"F")
;DIC(9.4,
"FRV1",101.41,"31,10,1,0",2)
OR GTX FREE TEXT 1
"FRV1",101.41,"31,10,1,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"31,10,2,0",2)
OR GTX DATE/TIME
"FRV1",101.41,"31,10,2,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"32,0",5)
EARLY/LATE TRAYS
"FRV1",101.41,"32,0",5,"F")
;ORD(100.98,
"FRV1",101.41,"32,0",7)
DIETETICS
"FRV1",101.41,"32,0",7,"F")
;DIC(9.4,
"FRV1",101.41,"32,10,1,0",2)
OR GTX START DATE
"FRV1",101.41,"32,10,1,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"32,10,2,0",2)
OR GTX STOP DATE
"FRV1",101.41,"32,10,2,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"32,10,3,0",2)
OR GTX MEAL
"FRV1",101.41,"32,10,3,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"32,10,4,0",2)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"32,10,4,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"32,10,5,0",2)
OR GTX MEAL TIME
"FRV1",101.41,"32,10,5,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"32,10,6,0",2)
OR GTX SCHEDULE
"FRV1",101.41,"32,10,6,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"32,10,7,0",2)
OR GTX YES/NO
"FRV1",101.41,"32,10,7,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,0",5)
PHARMACY
"FRV1",101.41,"612,0",5,"F")
;ORD(100.98,
"FRV1",101.41,"612,0",7)
PHARMACY DATA MANAGEMENT
"FRV1",101.41,"612,0",7,"F")
;DIC(9.4,
"FRV1",101.41,"612,10,1,0",2)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"612,10,1,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,10,0",2)
OR GTX REFILLS
"FRV1",101.41,"612,10,10,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,11,0",2)
OR GTX SERVICE CONNECTED
"FRV1",101.41,"612,10,11,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,12,0",2)
OR GTX DURATION
"FRV1",101.41,"612,10,12,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,12,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"612,10,12,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,13,0",2)
OR GTX START DATE/TIME
"FRV1",101.41,"612,10,13,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,14,0",2)
OR GTX SIG
"FRV1",101.41,"612,10,14,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,15,0",2)
OR GTX DOSE
"FRV1",101.41,"612,10,15,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,15,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"612,10,15,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,16,0",2)
OR GTX DISPENSE DRUG
"FRV1",101.41,"612,10,16,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,17,0",2)
OR GTX DAYS SUPPLY
"FRV1",101.41,"612,10,17,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,18,0",2)
OR GTX DRUG NAME
"FRV1",101.41,"612,10,18,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,19,0",2)
OR GTX AND/THEN
"FRV1",101.41,"612,10,19,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,19,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"612,10,19,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,2,0",2)
OR GTX INSTRUCTIONS
"FRV1",101.41,"612,10,2,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,20,0",2)
OR GTX PATIENT INSTRUCTIONS
"FRV1",101.41,"612,10,20,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,21,0",2)
OR GTX NOW
"FRV1",101.41,"612,10,21,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,22,0",2)
OR GTX STATEMENTS
"FRV1",101.41,"612,10,22,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,23,0",2)
OR GTX ADMIN TIMES
"FRV1",101.41,"612,10,23,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,23,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"612,10,23,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,24,0",2)
OR GTX SCHEDULE TYPE
"FRV1",101.41,"612,10,24,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,24,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"612,10,24,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,3,0",2)
OR GTX ROUTE
"FRV1",101.41,"612,10,3,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,3,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"612,10,3,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,4,0",2)
OR GTX SCHEDULE
"FRV1",101.41,"612,10,4,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,4,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"612,10,4,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,5,0",2)
OR GTX URGENCY
"FRV1",101.41,"612,10,5,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,6,0",2)
OR GTX WORD PROCESSING 1
"FRV1",101.41,"612,10,6,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,7,0",2)
OR GTX STRENGTH
"FRV1",101.41,"612,10,7,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,7,0",11)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"612,10,7,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,8,0",2)
OR GTX QUANTITY
"FRV1",101.41,"612,10,8,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,9,0",2)
OR GTX ROUTING
"FRV1",101.41,"612,10,9,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"621,0",5)
NON-VA MEDICATIONS
"FRV1",101.41,"621,0",5,"F")
;ORD(100.98,
"FRV1",101.41,"621,0",7)
HERBAL/OTC/NON-VA MEDS
"FRV1",101.41,"621,0",7,"F")
;DIC(9.4,
"FRV1",101.41,"621,10,1,0",2)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"621,10,1,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"621,10,13,0",2)
OR GTX START DATE/TIME
"FRV1",101.41,"621,10,13,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"621,10,14,0",2)
OR GTX SIG
"FRV1",101.41,"621,10,14,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"621,10,15,0",2)
OR GTX DOSE
"FRV1",101.41,"621,10,15,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"621,10,15,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"621,10,15,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"621,10,16,0",2)
OR GTX DISPENSE DRUG
"FRV1",101.41,"621,10,16,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"621,10,18,0",2)
OR GTX DRUG NAME
"FRV1",101.41,"621,10,18,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"621,10,2,0",2)
OR GTX INSTRUCTIONS
"FRV1",101.41,"621,10,2,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"621,10,20,0",2)
OR GTX PATIENT INSTRUCTIONS
"FRV1",101.41,"621,10,20,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"621,10,21,0",2)
OR GTX STATEMENTS
"FRV1",101.41,"621,10,21,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"621,10,3,0",2)
OR GTX ROUTE
"FRV1",101.41,"621,10,3,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"621,10,3,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"621,10,3,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"621,10,4,0",2)
OR GTX SCHEDULE
"FRV1",101.41,"621,10,4,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"621,10,4,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"621,10,4,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"621,10,6,0",2)
OR GTX WORD PROCESSING 1
"FRV1",101.41,"621,10,6,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"621,10,7,0",2)
OR GTX STRENGTH
"FRV1",101.41,"621,10,7,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"621,10,7,0",11)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"621,10,7,0",11,"F")
;ORD(101.41,
"INI")
PRE^ORY243
"INIT")
POST^ORY243
"IX",101.41,101.41,"B",0)
101.41^B^Regular B index using full field length^R^^F^IR^I^101.41^^^^^LS
"IX",101.41,101.41,"B",1)
S ^ORD(101.41,"B",$E(X,1,63),DA)=""
"IX",101.41,101.41,"B",2)
K ^ORD(101.41,"B",$E(X,1,63),DA)
"IX",101.41,101.41,"B",2.5)
K ^ORD(101.41,"B")
"IX",101.41,101.41,"B",11.1,0)
^.114IA^1^1
"IX",101.41,101.41,"B",11.1,1,0)
1^F^101.41^.01^63^1^F
"KRN",9.2,1406,-1)
0^2
"KRN",9.2,1406,0)
ORBA-SC^ORBA-SC^3040209.132819^
"KRN",9.2,1406,1,0)
^^5^5^3060815^
"KRN",9.2,1406,1,1,0)
Service-Connected (SC):
"KRN",9.2,1406,1,2,0)
Veterans are eligible for medical care for treatment
"KRN",9.2,1406,1,3,0)
of service-connected (SC) conditions without
"KRN",9.2,1406,1,4,0)
incurring copayment charges or claims against their
"KRN",9.2,1406,1,5,0)
insurance.  See 'Help' for additional information.
"KRN",9.2,1406,3,0)
^9.23A^1^1
"KRN",9.2,1406,3,1,0)
ORWDBA3
"KRN",9.2,1407,-1)
0^3
"KRN",9.2,1407,0)
ORBA-MST^ORBA-MST^3040209.133003^
"KRN",9.2,1407,1,0)
^^7^7^3060815^
"KRN",9.2,1407,1,1,0)
Military Sexual Trauma (MST):
"KRN",9.2,1407,1,2,0)
Veterans who experienced sexual trauma while serving
"KRN",9.2,1407,1,3,0)
on active duty in the military are eligible to
"KRN",9.2,1407,1,4,0)
receive treatment and counseling services for the
"KRN",9.2,1407,1,5,0)
sexual trauma without incurring copayment charges or
"KRN",9.2,1407,1,6,0)
claims against their insurance.  See 'Help' for
"KRN",9.2,1407,1,7,0)
additional information.
"KRN",9.2,1407,3,0)
^9.23A^1^1
"KRN",9.2,1407,3,1,0)
ORWDBA3
"KRN",9.2,1408,-1)
0^8
"KRN",9.2,1408,0)
ORBA-AO^ORBA-AO^3040209.133218^
"KRN",9.2,1408,1,0)
^^11^11^3060815^
"KRN",9.2,1408,1,1,0)
Agent Orange (AO): herbicide used in Vietnam.
"KRN",9.2,1408,1,2,0)
Veterans who were present within the borders of the
"KRN",9.2,1408,1,3,0)
Republic of Vietnam from January 1962 through May
"KRN",9.2,1408,1,4,0)
1975 are presumed to have been exposed to Agent
"KRN",9.2,1408,1,5,0)
Orange and are eligible to receive care of conditions
"KRN",9.2,1408,1,6,0)
possibly for AO exposure without incurring copayment
"KRN",9.2,1408,1,7,0)
charges or claims against their insurance. Some
"KRN",9.2,1408,1,8,0)
conditions associated with AO exposure: diabetes
"KRN",9.2,1408,1,9,0)
(type 2), chloracne, porphyria cutanea tarda,
"KRN",9.2,1408,1,10,0)
peripheral neuropathy and some cancers.  See 'Help'
"KRN",9.2,1408,1,11,0)
for additional information.
"KRN",9.2,1408,3,0)
^9.23A^1^1
"KRN",9.2,1408,3,1,0)
ORWDBA3
"KRN",9.2,1409,-1)
0^4
"KRN",9.2,1409,0)
ORBA-IR^ORBA-IR^3040209.133624^
"KRN",9.2,1409,1,0)
^^10^10^3060815^
"KRN",9.2,1409,1,1,0)
Ionizing Radiation (IR):
"KRN",9.2,1409,1,2,0)
Veterans exposed to ionizing radiation (IR) as a
"KRN",9.2,1409,1,3,0)
POW or while on active duty in Hiroshima and/or
"KRN",9.2,1409,1,4,0)
Nagasaki, Japan, or who served at a nuclear device
"KRN",9.2,1409,1,5,0)
atmospheric testing site are eligible to receive
"KRN",9.2,1409,1,6,0)
care of any malignant condition and certain other
"KRN",9.2,1409,1,7,0)
non-malignant conditions for IR exposure without
"KRN",9.2,1409,1,8,0)
incurring copayment charges or claims against
"KRN",9.2,1409,1,9,0)
their insurance.  See 'Help' for additional
"KRN",9.2,1409,1,10,0)
information.
"KRN",9.2,1409,3,0)
^9.23A^1^1
"KRN",9.2,1409,3,1,0)
ORWDBA3
"KRN",9.2,1410,-1)
0^6
"KRN",9.2,1410,0)
ORBA-EC^ORBA-EC^3040209.134014^
"KRN",9.2,1410,1,0)
^^10^10^3060815^
"KRN",9.2,1410,1,1,0)
Southwest Asia Conditions (SWAC):
"KRN",9.2,1410,1,2,0)
Veterans who served in Southwest Asia during the
"KRN",9.2,1410,1,3,0)
Gulf War are eligible to receive treatment for
"KRN",9.2,1410,1,4,0)
conditions relating to this service, including
"KRN",9.2,1410,1,5,0)
exposure to depleted uranium, pesticides, anti-
"KRN",9.2,1410,1,6,0)
nerve gas pill, pyridostigmine bromide, infectious
"KRN",9.2,1410,1,7,0)
diseases, chemical and biological warfare agents,
"KRN",9.2,1410,1,8,0)
etc. without incurring copayment charges or claims
"KRN",9.2,1410,1,9,0)
against their insurance.  See 'Help' for additional
"KRN",9.2,1410,1,10,0)
information.
"KRN",9.2,1410,3,0)
^9.23A^1^1
"KRN",9.2,1410,3,1,0)
ORWDBA3
"KRN",9.2,1411,-1)
0^5
"KRN",9.2,1411,0)
ORBA-HNC^ORBA-HNC^3040209.13432^
"KRN",9.2,1411,1,0)
^^8^8^3060815^
"KRN",9.2,1411,1,1,0)
Head and Neck Cancer (HNC):
"KRN",9.2,1411,1,2,0)
Veterans with cancer of the head or neck and a
"KRN",9.2,1411,1,3,0)
history of receipt of Nasopharyngeal (NP) radium
"KRN",9.2,1411,1,4,0)
therapy while in the military are eligible to
"KRN",9.2,1411,1,5,0)
receive treatment for the head or neck cancer
"KRN",9.2,1411,1,6,0)
without incurring copayment charges or claims
"KRN",9.2,1411,1,7,0)
against their insurance.  See 'Help' for additional
"KRN",9.2,1411,1,8,0)
information.
"KRN",9.2,1411,3,0)
^9.23A^1^1
"KRN",9.2,1411,3,1,0)
ORWDBA3
"KRN",9.2,1412,-1)
0^7
"KRN",9.2,1412,0)
ORBA-CV^ORBA-CV^3040209.134525^
"KRN",9.2,1412,1,0)
^^11^11^3060815^
"KRN",9.2,1412,1,1,0)
Combat Veteran (CV): to receive CV exemption the veteran
"KRN",9.2,1412,1,2,0)
must have served in combat operations after the Gulf
"KRN",9.2,1412,1,3,0)
War or in combat against a hostile force after
"KRN",9.2,1412,1,4,0)
November 11, 1998.  In addition, the condition for which
"KRN",9.2,1412,1,5,0)
the veteran is treated must be related to that combat,
"KRN",9.2,1412,1,6,0)
the veteran must have registered as a combat veteran,
"KRN",9.2,1412,1,7,0)
and be within two years of separation from active
"KRN",9.2,1412,1,8,0)
military service.  Finally, the condition must not be
"KRN",9.2,1412,1,9,0)
already considered to be service related or that
"KRN",9.2,1412,1,10,0)
exemption should apply.  See 'Help' for additional
"KRN",9.2,1412,1,11,0)
information.
"KRN",9.2,1412,3,0)
^9.23A^1^1
"KRN",9.2,1412,3,1,0)
ORWDBA3
"KRN",9.2,1417,-1)
0^1
"KRN",9.2,1417,0)
ORBA-SHD^ORBA-SHD^3060726.0946^^
"KRN",9.2,1417,1,0)
^^11^11^3060824^
"KRN",9.2,1417,1,1,0)
Shipboard Hazard and Defense (SHD):
"KRN",9.2,1417,1,2,0)
Veterans with conditions
"KRN",9.2,1417,1,3,0)
recognized by VA as associated with Project 112/
"KRN",9.2,1417,1,4,0)
SHAD, shipboard and land-based biological and
"KRN",9.2,1417,1,5,0)
chemical testing conducted by the United States
"KRN",9.2,1417,1,6,0)
(U.S.) military between 1962 and 1973 are
"KRN",9.2,1417,1,7,0)
eligible for enrollment in priority group 6,
"KRN",9.2,1417,1,8,0)
unless eligible for enrollment in a higher
"KRN",9.2,1417,1,9,0)
priority. In addition, veterans receive care at
"KRN",9.2,1417,1,10,0)
no charge for care and medications provided for
"KRN",9.2,1417,1,11,0)
treatment of conditions related to exposure.
"KRN",9.2,1417,3,0)
^9.23A^1^1
"KRN",9.2,1417,3,1,0)
ORWDBA3
"KRN",19,5220,-1)
2^3
"KRN",19,5220,0)
ORLP TEAM MENU^Team List Mgmt Menu^^M^64^^^^^^^^^^1
"KRN",19,5220,10,0)
^19.01IP^9^8
"KRN",19,5220,10,9,0)
12415^TV
"KRN",19,5220,10,9,"^")
ORLP TEAM LIST VISIBILITY
"KRN",19,5220,"U")
TEAM LIST MGMT MENU
"KRN",19,9988,-1)
2^9
"KRN",19,9988,0)
ORCM MGMT^Order Menu Management^^M^4550^^^^^^^22
"KRN",19,9988,10,0)
^19.01IP^15^15
"KRN",19,9988,10,15,0)
12092^MR^55
"KRN",19,9988,10,15,"^")
OR MEDICATION QO CHECKER
"KRN",19,9988,"U")
ORDER MENU MANAGEMENT
"KRN",19,10062,-1)
0^12
"KRN",19,10062,0)
ORB3 ARCHIVE PERIOD^Archive(delete) after <x> Days^^R^^^^^^^^
"KRN",19,10062,1,0)
^^10^10^3080410^
"KRN",19,10062,1,1,0)
Enter the number of days to archive this notification before deletion.
"KRN",19,10062,1,2,0)
The number of days to archive a notification for a site.  If not indicated,
"KRN",19,10062,1,3,0)
the default period of 30 days is used.  The maximum number of 100,000 is
"KRN",19,10062,1,4,0)
about 220 years.  This value is passed to the Kernal Alert Utility where
"KRN",19,10062,1,5,0)
the actual archiving and deletion of alerts/notifications occurs.
"KRN",19,10062,1,6,0)
The effect of this option is that entries in the Alert Tracking file will 
"KRN",19,10062,1,7,0)
be removed which is a log of Alert activity, not the alets themselves.  
"KRN",19,10062,1,8,0)
However, if the Kernel option XQALERT DELETE OLD is set to a time that is 
"KRN",19,10062,1,9,0)
greater than 30 days (or whatever the value is for the ORB3 ARCHIVE 
"KRN",19,10062,1,10,0)
PERIOD) then this option will also delete old alerts.
"KRN",19,10062,25)
ARC^ORB3MGR1
"KRN",19,10062,"U")
ARCHIVE(DELETE) AFTER <X> DAYS
"KRN",19,10073,-1)
2^5
"KRN",19,10073,0)
ORK ORDER CHK MGMT MENU^Order Checking Mgmt Menu^^M^64^^^^^^^^^^
"KRN",19,10073,10,0)
^19.01IP^20^20
"KRN",19,10073,10,20,0)
12414^18
"KRN",19,10073,10,20,"^")
ORK ORD CHK OVERRIDE REPORT
"KRN",19,10073,"U")
ORDER CHECKING MGMT MENU
"KRN",19,10082,-1)
0^1
"KRN",19,10082,0)
OR CPRS GUI CHART^CPRSChart version 1.0.27.77^^B^^^^^^^^
"KRN",19,10082,1,0)
^19.06^2^2^3071018^^^^
"KRN",19,10082,1,1,0)
This option is required by the Kernel Broker to give access to the
"KRN",19,10082,1,2,0)
RPCs used by the CPRS GUI (CPRSChart.EXE).
"KRN",19,10082,99)
60921,44613
"KRN",19,10082,99.1)
61082,28666
"KRN",19,10082,"RPC",0)
^19.05P^2079^2079
"KRN",19,10082,"RPC",1,0)
GMRC LIST CONSULT REQUESTS
"KRN",19,10082,"RPC",218,0)
XWB GET VARIABLE VALUE
"KRN",19,10082,"RPC",219,0)
TIU AUTHORIZATION
"KRN",19,10082,"RPC",220,0)
TIU CAN CHANGE COSIGNER?
"KRN",19,10082,"RPC",221,0)
TIU CREATE ADDENDUM RECORD
"KRN",19,10082,"RPC",222,0)
TIU CREATE RECORD
"KRN",19,10082,"RPC",223,0)
TIU DELETE RECORD
"KRN",19,10082,"RPC",224,0)
TIU DETAILED DISPLAY
"KRN",19,10082,"RPC",225,0)
TIU DOCUMENTS BY CONTEXT
"KRN",19,10082,"RPC",226,0)
TIU GET ADDITIONAL SIGNERS
"KRN",19,10082,"RPC",227,0)
TIU GET ALERT INFO
"KRN",19,10082,"RPC",228,0)
TIU GET DOCUMENT PARAMETERS
"KRN",19,10082,"RPC",229,0)
TIU GET DS TITLES
"KRN",19,10082,"RPC",230,0)
TIU GET DS URGENCIES
"KRN",19,10082,"RPC",231,0)
TIU GET PERSONAL PREFERENCES
"KRN",19,10082,"RPC",232,0)
TIU GET PN TITLES
"KRN",19,10082,"RPC",233,0)
TIU GET RECORD TEXT
"KRN",19,10082,"RPC",234,0)
TIU IDENTIFY CONSULTS CLASS
"KRN",19,10082,"RPC",235,0)
TIU IS THIS A CONSULT?
"KRN",19,10082,"RPC",236,0)
TIU JUSTIFY DELETE?
"KRN",19,10082,"RPC",237,0)
TIU LOAD BOILERPLATE TEXT
"KRN",19,10082,"RPC",238,0)
TIU LOAD RECORD FOR EDIT
"KRN",19,10082,"RPC",239,0)
TIU LOCK RECORD
"KRN",19,10082,"RPC",240,0)
TIU LONG LIST CONSULT TITLES
"KRN",19,10082,"RPC",241,0)
TIU LONG LIST OF TITLES
"KRN",19,10082,"RPC",242,0)
TIU NOTES
"KRN",19,10082,"RPC",243,0)
TIU NOTES 16 BIT
"KRN",19,10082,"RPC",244,0)
TIU NOTES BY VISIT
"KRN",19,10082,"RPC",245,0)
TIU PERSONAL TITLE LIST
"KRN",19,10082,"RPC",246,0)
TIU PRINT RECORD
"KRN",19,10082,"RPC",247,0)
TIU REQUIRES COSIGNATURE
"KRN",19,10082,"RPC",248,0)
TIU SIGN RECORD
"KRN",19,10082,"RPC",249,0)
TIU SUMMARIES
"KRN",19,10082,"RPC",250,0)
TIU SUMMARIES BY VISIT
"KRN",19,10082,"RPC",251,0)
TIU UNLOCK RECORD
"KRN",19,10082,"RPC",252,0)
TIU UPDATE ADDITIONAL SIGNERS
"KRN",19,10082,"RPC",253,0)
TIU UPDATE RECORD
"KRN",19,10082,"RPC",254,0)
TIU WHICH SIGNATURE ACTION
"KRN",19,10082,"RPC",1032,0)
ORB DELETE ALERT
"KRN",19,10082,"RPC",1033,0)
ORB FOLLOW-UP ARRAY
"KRN",19,10082,"RPC",1034,0)
ORB FOLLOW-UP STRING
"KRN",19,10082,"RPC",1035,0)
ORB FOLLOW-UP TYPE
"KRN",19,10082,"RPC",1036,0)
ORB SORT METHOD
"KRN",19,10082,"RPC",1037,0)
ORK TRIGGER
"KRN",19,10082,"RPC",1038,0)
ORQ NULL LIST
"KRN",19,10082,"RPC",1039,0)
ORQOR DETAIL
"KRN",19,10082,"RPC",1040,0)
TIU TEMPLATE CHECK BOILERPLATE
"KRN",19,10082,"RPC",1041,0)
TIU TEMPLATE CREATE/MODIFY
"KRN",19,10082,"RPC",1042,0)
TIU TEMPLATE DELETE
"KRN",19,10082,"RPC",1045,0)
TIU TEMPLATE GETPROOT
"KRN",19,10082,"RPC",1049,0)
TIU TEMPLATE LISTOWNR
"KRN",19,10082,"RPC",1050,0)
TIU TEMPLATE SET ITEMS
"KRN",19,10082,"RPC",1051,0)
TIU GET LIST OF OBJECTS
"KRN",19,10082,"RPC",1052,0)
ORQOR LIST
"KRN",19,10082,"RPC",1053,0)
ORQORB SORT
"KRN",19,10082,"RPC",1054,0)
ORQPT ATTENDING/PRIMARY
"KRN",19,10082,"RPC",1055,0)
ORQPT CLINIC PATIENTS
"KRN",19,10082,"RPC",1056,0)
ORQPT CLINICS
"KRN",19,10082,"RPC",1057,0)
ORQPT DEFAULT LIST SOURCE
"KRN",19,10082,"RPC",1058,0)
ORQPT DEFAULT PATIENT LIST
"KRN",19,10082,"RPC",1059,0)
ORQPT PATIENT TEAM PROVIDERS
"KRN",19,10082,"RPC",1060,0)
ORQPT PROVIDER PATIENTS
"KRN",19,10082,"RPC",1061,0)
ORQPT PROVIDERS
"KRN",19,10082,"RPC",1062,0)
ORQPT SPECIALTIES
"KRN",19,10082,"RPC",1063,0)
ORQPT SPECIALTY PATIENTS
"KRN",19,10082,"RPC",1064,0)
ORQPT TEAM PATIENTS
"KRN",19,10082,"RPC",1065,0)
ORQPT TEAMS
"KRN",19,10082,"RPC",1066,0)
ORQPT WARD PATIENTS
"KRN",19,10082,"RPC",1067,0)
ORQPT WARDRMBED
"KRN",19,10082,"RPC",1068,0)
ORQPT WARDS
"KRN",19,10082,"RPC",1069,0)
ORQQAL DETAIL
"KRN",19,10082,"RPC",1070,0)
ORQQAL LIST
"KRN",19,10082,"RPC",1071,0)
ORQQAL LIST REPORT
"KRN",19,10082,"RPC",1072,0)
ORQQCN ADDCMT
"KRN",19,10082,"RPC",1073,0)
ORQQCN ADMIN COMPLETE
"KRN",19,10082,"RPC",1074,0)
ORQQCN DETAIL
"KRN",19,10082,"RPC",1075,0)
ORQQCN DISCONTINUE
"KRN",19,10082,"RPC",1076,0)
ORQQCN FIND CONSULT
"KRN",19,10082,"RPC",1077,0)
ORQQCN FORWARD
"KRN",19,10082,"RPC",1078,0)
ORQQCN GET CONSULT
"KRN",19,10082,"RPC",1079,0)
ORQQCN GET ORDER NUMBER
"KRN",19,10082,"RPC",1080,0)
ORQQCN GET PROC SVCS
"KRN",19,10082,"RPC",1081,0)
ORQQCN LIST
"KRN",19,10082,"RPC",1082,0)
ORQQCN LOAD FOR EDIT
"KRN",19,10082,"RPC",1083,0)
ORQQCN MED RESULTS
"KRN",19,10082,"RPC",1084,0)
ORQQCN PRINT SF513
"KRN",19,10082,"RPC",1085,0)
ORQQCN RECEIVE
"KRN",19,10082,"RPC",1086,0)
ORQQCN RESUBMIT
"KRN",19,10082,"RPC",1087,0)
ORQQCN SET ACT MENUS
"KRN",19,10082,"RPC",1088,0)
ORQQCN SHOW SF513
"KRN",19,10082,"RPC",1089,0)
ORQQCN SIGFIND
"KRN",19,10082,"RPC",1090,0)
ORQQCN STATUS
"KRN",19,10082,"RPC",1091,0)
ORQQCN SVCLIST
"KRN",19,10082,"RPC",1092,0)
ORQQCN SVCTREE
"KRN",19,10082,"RPC",1093,0)
ORQQCN URGENCIES
"KRN",19,10082,"RPC",1094,0)
ORQQCN2 GET CONTEXT
"KRN",19,10082,"RPC",1095,0)
ORQQCN2 SAVE CONTEXT
"KRN",19,10082,"RPC",1096,0)
ORQQLR DETAIL
"KRN",19,10082,"RPC",1097,0)
ORQQLR SEARCH RANGE INPT
"KRN",19,10082,"RPC",1098,0)
ORQQLR SEARCH RANGE OUTPT
"KRN",19,10082,"RPC",1099,0)
ORQQPL ADD SAVE
"KRN",19,10082,"RPC",1100,0)
ORQQPL AUDIT HIST
"KRN",19,10082,"RPC",1101,0)
ORQQPL CHECK DUP
"KRN",19,10082,"RPC",1102,0)
ORQQPL CLIN FILTER LIST
"KRN",19,10082,"RPC",1103,0)
ORQQPL CLIN SRCH
"KRN",19,10082,"RPC",1104,0)
ORQQPL DELETE
"KRN",19,10082,"RPC",1105,0)
ORQQPL DETAIL
"KRN",19,10082,"RPC",1106,0)
ORQQPL EDIT LOAD
"KRN",19,10082,"RPC",1107,0)
ORQQPL EDIT SAVE
"KRN",19,10082,"RPC",1108,0)
ORQQPL INACTIVATE
"KRN",19,10082,"RPC",1109,0)
ORQQPL INIT PT
"KRN",19,10082,"RPC",1110,0)
ORQQPL INIT USER
"KRN",19,10082,"RPC",1111,0)
ORQQPL LIST
"KRN",19,10082,"RPC",1112,0)
ORQQPL PROB COMMENTS
"KRN",19,10082,"RPC",1113,0)
ORQQPL PROBLEM LEX SEARCH
"KRN",19,10082,"RPC",1114,0)
ORQQPL PROBLEM LIST
"KRN",19,10082,"RPC",1115,0)
ORQQPL PROV FILTER LIST
"KRN",19,10082,"RPC",1116,0)
ORQQPL PROVIDER LIST
"KRN",19,10082,"RPC",1117,0)
ORQQPL REPLACE
"KRN",19,10082,"RPC",1118,0)
ORQQPL SAVEVIEW
"KRN",19,10082,"RPC",1119,0)
ORQQPL SERV FILTER LIST
"KRN",19,10082,"RPC",1120,0)
ORQQPL SRVC SRCH
"KRN",19,10082,"RPC",1121,0)
ORQQPL UPDATE
"KRN",19,10082,"RPC",1122,0)
ORQQPL USER PROB CATS
"KRN",19,10082,"RPC",1123,0)
ORQQPL USER PROB LIST
"KRN",19,10082,"RPC",1124,0)
ORQQPL VERIFY
"KRN",19,10082,"RPC",1125,0)
ORQQPP LIST
"KRN",19,10082,"RPC",1126,0)
ORQQPS DETAIL
"KRN",19,10082,"RPC",1127,0)
ORQQPS LIST
"KRN",19,10082,"RPC",1133,0)
ORQQPX REMINDER DETAIL
"KRN",19,10082,"RPC",1135,0)
ORQQPX REMINDERS LIST
"KRN",19,10082,"RPC",1136,0)
ORQQVI NOTEVIT
"KRN",19,10082,"RPC",1137,0)
ORQQVI VITALS
"KRN",19,10082,"RPC",1138,0)
ORQQVI VITALS FOR DATE RANGE
"KRN",19,10082,"RPC",1139,0)
ORQQVI1 DETAIL
"KRN",19,10082,"RPC",1140,0)
ORQQVI1 GRID
"KRN",19,10082,"RPC",1141,0)
ORQQVI2 VITALS HELP
"KRN",19,10082,"RPC",1142,0)
ORQQVI2 VITALS RATE CHECK
"KRN",19,10082,"RPC",1144,0)
ORQQVI2 VITALS VAL & STORE
"KRN",19,10082,"RPC",1145,0)
ORQQVI2 VITALS VALIDATE
"KRN",19,10082,"RPC",1146,0)
ORQQVI2 VITALS VALIDATE TYPE
"KRN",19,10082,"RPC",1147,0)
ORQQVS DETAIL NOTES
"KRN",19,10082,"RPC",1148,0)
ORQQVS DETAIL SUMMARY
"KRN",19,10082,"RPC",1149,0)
ORQQVS VISITS/APPTS
"KRN",19,10082,"RPC",1150,0)
ORQQXMB MAIL GROUPS
"KRN",19,10082,"RPC",1151,0)
ORQQXQA PATIENT
"KRN",19,10082,"RPC",1152,0)
ORQQXQA USER
"KRN",19,10082,"RPC",1153,0)
ORWCH LOADALL
"KRN",19,10082,"RPC",1154,0)
ORWCH LOADSIZ
"KRN",19,10082,"RPC",1155,0)
ORWCH SAVEALL
"KRN",19,10082,"RPC",1156,0)
ORWCH SAVESIZ
"KRN",19,10082,"RPC",1157,0)
ORWCS LIST OF CONSULT REPORTS
"KRN",19,10082,"RPC",1158,0)
ORWCS PRINT REPORT
"KRN",19,10082,"RPC",1159,0)
ORWCS REPORT TEXT
"KRN",19,10082,"RPC",1160,0)
ORWCV DTLVST
"KRN",19,10082,"RPC",1161,0)
ORWCV LAB
"KRN",19,10082,"RPC",1162,0)
ORWCV POLL
"KRN",19,10082,"RPC",1163,0)
ORWCV START
"KRN",19,10082,"RPC",1164,0)
ORWCV STOP
"KRN",19,10082,"RPC",1165,0)
ORWCV VST
"KRN",19,10082,"RPC",1166,0)
ORWD DEF
"KRN",19,10082,"RPC",1167,0)
ORWD DT
"KRN",19,10082,"RPC",1168,0)
ORWD FORMID
"KRN",19,10082,"RPC",1169,0)
ORWD GET4EDIT
"KRN",19,10082,"RPC",1170,0)
ORWD KEY
"KRN",19,10082,"RPC",1171,0)
ORWD OI
"KRN",19,10082,"RPC",1172,0)
ORWD PROVKEY
"KRN",19,10082,"RPC",1173,0)
ORWD SAVE
"KRN",19,10082,"RPC",1174,0)
ORWD SAVEACT
"KRN",19,10082,"RPC",1175,0)
ORWD SIGN
"KRN",19,10082,"RPC",1176,0)
ORWD VALIDACT
"KRN",19,10082,"RPC",1177,0)
ORWD1 PARAM
"KRN",19,10082,"RPC",1178,0)
ORWD1 PRINTGUI
"KRN",19,10082,"RPC",1179,0)
ORWD1 RVPRINT
"KRN",19,10082,"RPC",1180,0)
ORWD2 DEVINFO
"KRN",19,10082,"RPC",1181,0)
ORWD2 MANUAL
"KRN",19,10082,"RPC",1182,0)
ORWDAL32 ALLERGY MATCH
"KRN",19,10082,"RPC",1183,0)
ORWDAL32 DEF
"KRN",19,10082,"RPC",1184,0)
ORWDAL32 SYMPTOMS
"KRN",19,10082,"RPC",1185,0)
ORWDCN32 DEF
"KRN",19,10082,"RPC",1186,0)
ORWDCN32 ORDRMSG
"KRN",19,10082,"RPC",1187,0)
ORWDCN32 PROCEDURES
"KRN",19,10082,"RPC",1188,0)
ORWDCSLT DEF
"KRN",19,10082,"RPC",1189,0)
ORWDCSLT LOOK200
"KRN",19,10082,"RPC",1190,0)
ORWDFH ADDLATE
"KRN",19,10082,"RPC",1191,0)
ORWDFH ATTR
"KRN",19,10082,"RPC",1192,0)
ORWDFH CURISO
"KRN",19,10082,"RPC",1193,0)
ORWDFH DIETS
"KRN",19,10082,"RPC",1194,0)
ORWDFH FINDTYP
"KRN",19,10082,"RPC",1195,0)
ORWDFH ISOIEN
"KRN",19,10082,"RPC",1196,0)
ORWDFH ISOLIST
"KRN",19,10082,"RPC",1197,0)
ORWDFH PARAM
"KRN",19,10082,"RPC",1198,0)
ORWDFH QTY2CC
"KRN",19,10082,"RPC",1199,0)
ORWDFH TFPROD
"KRN",19,10082,"RPC",1200,0)
ORWDFH TXT
"KRN",19,10082,"RPC",1201,0)
ORWDGX LOAD
"KRN",19,10082,"RPC",1202,0)
ORWDGX VMDEF
"KRN",19,10082,"RPC",1203,0)
ORWDLR ABBSPEC
"KRN",19,10082,"RPC",1204,0)
ORWDLR ALLSAMP
"KRN",19,10082,"RPC",1205,0)
ORWDLR DEF
"KRN",19,10082,"RPC",1206,0)
ORWDLR LOAD
"KRN",19,10082,"RPC",1207,0)
ORWDLR OIPARAM
"KRN",19,10082,"RPC",1208,0)
ORWDLR STOP
"KRN",19,10082,"RPC",1209,0)
ORWDLR32 ABBSPEC
"KRN",19,10082,"RPC",1210,0)
ORWDLR32 ALLSAMP
"KRN",19,10082,"RPC",1211,0)
ORWDLR32 ALLSPEC
"KRN",19,10082,"RPC",1212,0)
ORWDLR32 DEF
"KRN",19,10082,"RPC",1213,0)
ORWDLR32 IC DEFAULT
"KRN",19,10082,"RPC",1214,0)
ORWDLR32 IC VALID
"KRN",19,10082,"RPC",1215,0)
ORWDLR32 IMMED COLLECT
"KRN",19,10082,"RPC",1216,0)
ORWDLR32 LAB COLL TIME
"KRN",19,10082,"RPC",1217,0)
ORWDLR32 LOAD
"KRN",19,10082,"RPC",1218,0)
ORWDLR32 MAXDAYS
"KRN",19,10082,"RPC",1219,0)
ORWDLR32 ONE SAMPLE
"KRN",19,10082,"RPC",1220,0)
ORWDLR32 ONE SPECIMEN
"KRN",19,10082,"RPC",1221,0)
ORWDLR32 STOP
"KRN",19,10082,"RPC",1222,0)
ORWDOR VMSLCT
"KRN",19,10082,"RPC",1227,0)
ORWDPS32 ALLROUTE
"KRN",19,10082,"RPC",1228,0)
ORWDPS32 AUTH
"KRN",19,10082,"RPC",1229,0)
ORWDPS32 DLGSLCT
"KRN",19,10082,"RPC",1230,0)
ORWDPS32 DOSES
"KRN",19,10082,"RPC",1231,0)
ORWDPS32 DRUGMSG
"KRN",19,10082,"RPC",1232,0)
ORWDPS32 FORMALT
"KRN",19,10082,"RPC",1233,0)
ORWDPS32 ISSPLY
"KRN",19,10082,"RPC",1234,0)
ORWDPS32 IVAMT
"KRN",19,10082,"RPC",1235,0)
ORWDPS32 MEDISIV
"KRN",19,10082,"RPC",1236,0)
ORWDPS32 OISLCT
"KRN",19,10082,"RPC",1237,0)
ORWDPS32 SCSTS
"KRN",19,10082,"RPC",1238,0)
ORWDPS32 VALQTY
"KRN",19,10082,"RPC",1239,0)
ORWDPS32 VALRATE
"KRN",19,10082,"RPC",1240,0)
ORWDPS32 VALSCH
"KRN",19,10082,"RPC",1241,0)
ORWDRA DEF
"KRN",19,10082,"RPC",1242,0)
ORWDRA32 APPROVAL
"KRN",19,10082,"RPC",1243,0)
ORWDRA32 DEF
"KRN",19,10082,"RPC",1244,0)
ORWDRA32 IMTYPSEL
"KRN",19,10082,"RPC",1245,0)
ORWDRA32 ISOLATN
"KRN",19,10082,"RPC",1246,0)
ORWDRA32 LOCTYPE
"KRN",19,10082,"RPC",1247,0)
ORWDRA32 PROCMSG
"KRN",19,10082,"RPC",1248,0)
ORWDRA32 RADSRC
"KRN",19,10082,"RPC",1249,0)
ORWDRA32 RAORDITM
"KRN",19,10082,"RPC",1250,0)
ORWDX AGAIN
"KRN",19,10082,"RPC",1251,0)
ORWDX DGRP
"KRN",19,10082,"RPC",1252,0)
ORWDX DISMSG
"KRN",19,10082,"RPC",1253,0)
ORWDX DLGDEF
"KRN",19,10082,"RPC",1254,0)
ORWDX DLGID
"KRN",19,10082,"RPC",1255,0)
ORWDX DLGQUIK
"KRN",19,10082,"RPC",1256,0)
ORWDX FORMID
"KRN",19,10082,"RPC",1257,0)
ORWDX LOADRSP
"KRN",19,10082,"RPC",1258,0)
ORWDX LOCK
"KRN",19,10082,"RPC",1259,0)
ORWDX MSG
"KRN",19,10082,"RPC",1260,0)
ORWDX ORDITM
"KRN",19,10082,"RPC",1261,0)
ORWDX SAVE
"KRN",19,10082,"RPC",1262,0)
ORWDX SEND
"KRN",19,10082,"RPC",1263,0)
ORWDX SENDP
"KRN",19,10082,"RPC",1264,0)
ORWDX UNLOCK
"KRN",19,10082,"RPC",1265,0)
ORWDX WRLST
"KRN",19,10082,"RPC",1266,0)
ORWDXA ALERT
"KRN",19,10082,"RPC",1267,0)
ORWDXA COMPLETE
"KRN",19,10082,"RPC",1268,0)
ORWDXA DC
"KRN",19,10082,"RPC",1269,0)
ORWDX2 DCREASON
"KRN",19,10082,"RPC",1270,0)
ORWDXA DCREQIEN
"KRN",19,10082,"RPC",1271,0)
ORWDXA FLAG
"KRN",19,10082,"RPC",1272,0)
ORWDXA FLAGTXT
"KRN",19,10082,"RPC",1273,0)
ORWDXA HOLD
"KRN",19,10082,"RPC",1274,0)
ORWDXA UNFLAG
"KRN",19,10082,"RPC",1275,0)
ORWDXA UNHOLD
"KRN",19,10082,"RPC",1276,0)
ORWDXA VALID
"KRN",19,10082,"RPC",1277,0)
ORWDXA VERIFY
"KRN",19,10082,"RPC",1278,0)
ORWDXA WCGET
"KRN",19,10082,"RPC",1279,0)
ORWDXA WCPUT
"KRN",19,10082,"RPC",1280,0)
ORWDXC ACCEPT
"KRN",19,10082,"RPC",1281,0)
ORWDXC DELAY
"KRN",19,10082,"RPC",1282,0)
ORWDXC DELORD
"KRN",19,10082,"RPC",1283,0)
ORWDXC DISPLAY
"KRN",19,10082,"RPC",1284,0)
ORWDXC FILLID
"KRN",19,10082,"RPC",1285,0)
ORWDXC ON
"KRN",19,10082,"RPC",1286,0)
ORWDXC SAVECHK
"KRN",19,10082,"RPC",1287,0)
ORWDXC SESSION
"KRN",19,10082,"RPC",1288,0)
ORWDXM AUTOACK
"KRN",19,10082,"RPC",1289,0)
ORWDXM DLGNAME
"KRN",19,10082,"RPC",1290,0)
ORWDXM FORMID
"KRN",19,10082,"RPC",1291,0)
ORWDXM LOADSET
"KRN",19,10082,"RPC",1292,0)
ORWDXM MENU
"KRN",19,10082,"RPC",1293,0)
ORWDXM MSTYLE
"KRN",19,10082,"RPC",1294,0)
ORWDXM PROMPTS
"KRN",19,10082,"RPC",1295,0)
ORWDXM1 BLDQRSP
"KRN",19,10082,"RPC",1296,0)
ORWDXM2 CLRRCL
"KRN",19,10082,"RPC",1297,0)
ORWDXQ DLGNAME
"KRN",19,10082,"RPC",1298,0)
ORWDXQ DLGSAVE
"KRN",19,10082,"RPC",1299,0)
ORWDXQ GETQLST
"KRN",19,10082,"RPC",1300,0)
ORWDXQ GETQNAM
"KRN",19,10082,"RPC",1301,0)
ORWDXQ PUTQLST
"KRN",19,10082,"RPC",1302,0)
ORWDXQ PUTQNAM
"KRN",19,10082,"RPC",1303,0)
ORWDXR ISREL
"KRN",19,10082,"RPC",1304,0)
ORWDXR RENEW
"KRN",19,10082,"RPC",1305,0)
ORWDXR RNWFLDS
"KRN",19,10082,"RPC",1306,0)
ORWGEPT CLINRNG
"KRN",19,10082,"RPC",1307,0)
ORWLR CUMULATIVE REPORT
"KRN",19,10082,"RPC",1308,0)
ORWLR CUMULATIVE SECTION
"KRN",19,10082,"RPC",1309,0)
ORWLR REPORT LISTS
"KRN",19,10082,"RPC",1310,0)
ORWLRR ALLTESTS
"KRN",19,10082,"RPC",1311,0)
ORWLRR ATESTS
"KRN",19,10082,"RPC",1312,0)
ORWLRR ATG
"KRN",19,10082,"RPC",1313,0)
ORWLRR ATOMICS
"KRN",19,10082,"RPC",1314,0)
ORWLRR CHART
"KRN",19,10082,"RPC",1315,0)
ORWLRR CHEMTEST
"KRN",19,10082,"RPC",1316,0)
ORWLRR GRID
"KRN",19,10082,"RPC",1317,0)
ORWLRR INTERIM
"KRN",19,10082,"RPC",1318,0)
ORWLRR INTERIMG
"KRN",19,10082,"RPC",1319,0)
ORWLRR INTERIMS
"KRN",19,10082,"RPC",1320,0)
ORWLRR MICRO
"KRN",19,10082,"RPC",1321,0)
ORWLRR NEWOLD
"KRN",19,10082,"RPC",1322,0)
ORWLRR PARAM
"KRN",19,10082,"RPC",1323,0)
ORWLRR SPEC
"KRN",19,10082,"RPC",1324,0)
ORWLRR TG
"KRN",19,10082,"RPC",1325,0)
ORWLRR USERS
"KRN",19,10082,"RPC",1326,0)
ORWLRR UTGA
"KRN",19,10082,"RPC",1327,0)
ORWLRR UTGD
"KRN",19,10082,"RPC",1328,0)
ORWLRR UTGR
"KRN",19,10082,"RPC",1329,0)
ORWMC PATIENT PROCEDURES
"KRN",19,10082,"RPC",1330,0)
ORWOR RESULT
"KRN",19,10082,"RPC",1331,0)
ORWOR SHEETS
"KRN",19,10082,"RPC",1332,0)
ORWOR TSALL
"KRN",19,10082,"RPC",1333,0)
ORWORB AUTOUNFLAG ORDERS
"KRN",19,10082,"RPC",1334,0)
ORWORB FASTUSER
"KRN",19,10082,"RPC",1335,0)
ORWORB GET TIU ALERT INFO
"KRN",19,10082,"RPC",1336,0)
ORWORB GETDATA
"KRN",19,10082,"RPC",1337,0)
ORWORB KILL UNSIG ORDERS ALERT
"KRN",19,10082,"RPC",1339,0)
ORWORDG ALLTREE
"KRN",19,10082,"RPC",1340,0)
ORWORDG GRPSEQB
"KRN",19,10082,"RPC",1341,0)
ORWORDG IEN
"KRN",19,10082,"RPC",1342,0)
ORWORDG MAPSEQ
"KRN",19,10082,"RPC",1343,0)
ORWORDG REVSTS
"KRN",19,10082,"RPC",1344,0)
ORWORR AGET
"KRN",19,10082,"RPC",1345,0)
ORWORR GET
"KRN",19,10082,"RPC",1346,0)
ORWORR GET4LST
"KRN",19,10082,"RPC",1347,0)
ORWORR GETBYIFN
"KRN",19,10082,"RPC",1348,0)
ORWORR GETTXT
"KRN",19,10082,"RPC",1349,0)
ORWPCE ACTIVE PROV
"KRN",19,10082,"RPC",1350,0)
ORWPCE ACTPROB
"KRN",19,10082,"RPC",1351,0)
ORWPCE CPTREQD
"KRN",19,10082,"RPC",1352,0)
ORWPCE DELETE
"KRN",19,10082,"RPC",1353,0)
ORWPCE DIAG
"KRN",19,10082,"RPC",1354,0)
ORWPCE GET EDUCATION TOPICS
"KRN",19,10082,"RPC",1355,0)
ORWPCE GET EXAM TYPE
"KRN",19,10082,"RPC",1356,0)
ORWPCE GET HEALTH FACTORS TY
"KRN",19,10082,"RPC",1357,0)
ORWPCE GET IMMUNIZATION TYPE
"KRN",19,10082,"RPC",1358,0)
ORWPCE GET SET OF CODES
"KRN",19,10082,"RPC",1359,0)
ORWPCE GET SKIN TEST TYPE
"KRN",19,10082,"RPC",1360,0)
ORWPCE GET TREATMENT TYPE
"KRN",19,10082,"RPC",1361,0)
ORWPCE HF
"KRN",19,10082,"RPC",1362,0)
ORWPCE IMM
"KRN",19,10082,"RPC",1363,0)
ORWPCE LEX
"KRN",19,10082,"RPC",1364,0)
ORWPCE LEXCODE
"KRN",19,10082,"RPC",1366,0)
ORWPCE NOTEVSTR
"KRN",19,10082,"RPC",1367,0)
ORWPCE PCE4NOTE
"KRN",19,10082,"RPC",1368,0)
ORWPCE PED
"KRN",19,10082,"RPC",1369,0)
ORWPCE PROC
"KRN",19,10082,"RPC",1370,0)
ORWPCE SAVE
"KRN",19,10082,"RPC",1371,0)
ORWPCE SCDIS
"KRN",19,10082,"RPC",1372,0)
ORWPCE SCSEL
"KRN",19,10082,"RPC",1373,0)
ORWPCE SK
"KRN",19,10082,"RPC",1374,0)
ORWPCE TRT
"KRN",19,10082,"RPC",1375,0)
ORWPCE VISIT
"KRN",19,10082,"RPC",1376,0)
ORWPCE XAM
"KRN",19,10082,"RPC",1377,0)
ORWPS ACTIVE
"KRN",19,10082,"RPC",1378,0)
ORWPS COVER
"KRN",19,10082,"RPC",1379,0)
ORWPS DETAIL
"KRN",19,10082,"RPC",1380,0)
ORWPS1 NEWDLG
"KRN",19,10082,"RPC",1381,0)
ORWPS1 PICKUP
"KRN",19,10082,"RPC",1382,0)
ORWPS1 REFILL
"KRN",19,10082,"RPC",1383,0)
ORWPT ADMITLST
"KRN",19,10082,"RPC",1384,0)
ORWPT APPTLST
"KRN",19,10082,"RPC",1385,0)
ORWPT CLINRNG
"KRN",19,10082,"RPC",1386,0)
ORWPT CWAD
"KRN",19,10082,"RPC",1387,0)
ORWPT DFLTSRC
"KRN",19,10082,"RPC",1388,0)
ORWPT DIEDON
"KRN",19,10082,"RPC",1389,0)
ORWPT DISCHARGE
"KRN",19,10082,"RPC",1390,0)
ORWPT ENCTITL
"KRN",19,10082,"RPC",1391,0)
ORWPT FULLSSN
"KRN",19,10082,"RPC",1392,0)
ORWPT ID INFO
"KRN",19,10082,"RPC",1393,0)
ORWPT LAST5
"KRN",19,10082,"RPC",1394,0)
ORWPT LIST ALL
"KRN",19,10082,"RPC",1395,0)
ORWPT PTINQ
"KRN",19,10082,"RPC",1396,0)
ORWPT SAVDFLT
"KRN",19,10082,"RPC",1397,0)
ORWPT SELCHK
"KRN",19,10082,"RPC",1398,0)
ORWPT SELECT
"KRN",19,10082,"RPC",1399,0)
ORWPT SHARE
"KRN",19,10082,"RPC",1400,0)
ORWPT TOP
"KRN",19,10082,"RPC",1401,0)
ORWPT1 PCDETAIL
"KRN",19,10082,"RPC",1402,0)
ORWPT1 PRCARE
"KRN",19,10082,"RPC",1403,0)
ORWPT16 ADMITLST
"KRN",19,10082,"RPC",1404,0)
ORWPT16 APPTLST
"KRN",19,10082,"RPC",1405,0)
ORWPT16 DEMOG
"KRN",19,10082,"RPC",1406,0)
ORWPT16 GETVSIT
"KRN",19,10082,"RPC",1407,0)
ORWPT16 ID INFO
"KRN",19,10082,"RPC",1408,0)
ORWPT16 LIST ALL
"KRN",19,10082,"RPC",1409,0)
ORWPT16 LOOKUP
"KRN",19,10082,"RPC",1410,0)
ORWPT16 PSCNVT
"KRN",19,10082,"RPC",1411,0)
ORWRA DEFAULT EXAM SETTINGS
"KRN",19,10082,"RPC",1412,0)
ORWRA IMAGING EXAMS
"KRN",19,10082,"RPC",1413,0)
ORWRA PRINT REPORT
"KRN",19,10082,"RPC",1414,0)
ORWRA REPORT TEXT
"KRN",19,10082,"RPC",1415,0)
ORWRP PRINT LAB REPORTS
"KRN",19,10082,"RPC",1416,0)
ORWRP PRINT REPORT
"KRN",19,10082,"RPC",1417,0)
ORWRP REPORT LISTS
"KRN",19,10082,"RPC",1418,0)
ORWRP REPORT TEXT
"KRN",19,10082,"RPC",1419,0)
ORWRP1 LISTNUTR
"KRN",19,10082,"RPC",1420,0)
ORWRP16 REPORT LISTS
"KRN",19,10082,"RPC",1421,0)
ORWRP16 REPORT TEXT
"KRN",19,10082,"RPC",1422,0)
ORWTIU GET DCSUMM CONTEXT
"KRN",19,10082,"RPC",1423,0)
ORWTIU GET TIU CONTEXT
"KRN",19,10082,"RPC",1424,0)
ORWTIU SAVE DCSUMM CONTEXT
"KRN",19,10082,"RPC",1425,0)
ORWTIU SAVE TIU CONTEXT
"KRN",19,10082,"RPC",1426,0)
ORWU CLINLOC
"KRN",19,10082,"RPC",1427,0)
ORWU DEVICE
"KRN",19,10082,"RPC",1428,0)
ORWU DT
"KRN",19,10082,"RPC",1429,0)
ORWU EXTNAME
"KRN",19,10082,"RPC",1430,0)
ORWU GBLREF
"KRN",19,10082,"RPC",1431,0)
ORWU GENERIC
"KRN",19,10082,"RPC",1432,0)
ORWU HASKEY
"KRN",19,10082,"RPC",1433,0)
ORWU HOSPLOC
"KRN",19,10082,"RPC",1434,0)
ORWU INPLOC
"KRN",19,10082,"RPC",1435,0)
ORWU NEWPERS
"KRN",19,10082,"RPC",1436,0)
ORWU NPHASKEY
"KRN",19,10082,"RPC",1437,0)
ORWU PATCH
"KRN",19,10082,"RPC",1438,0)
ORWU TOOLMENU
"KRN",19,10082,"RPC",1439,0)
ORWU USERINFO
"KRN",19,10082,"RPC",1440,0)
ORWU VALDT
"KRN",19,10082,"RPC",1441,0)
ORWU VALIDSIG
"KRN",19,10082,"RPC",1442,0)
ORWU VERSRV
"KRN",19,10082,"RPC",1443,0)
ORWU16 DEVICE
"KRN",19,10082,"RPC",1444,0)
ORWU16 HOSPLOC
"KRN",19,10082,"RPC",1445,0)
ORWU16 NEWPERS
"KRN",19,10082,"RPC",1446,0)
ORWU16 USERINFO
"KRN",19,10082,"RPC",1447,0)
ORWU16 VALDT
"KRN",19,10082,"RPC",1448,0)
ORWU16 VALIDSIG
"KRN",19,10082,"RPC",1449,0)
ORWUH POPUP
"KRN",19,10082,"RPC",1450,0)
ORWUX SYMTAB
"KRN",19,10082,"RPC",1451,0)
ORWUXT LST
"KRN",19,10082,"RPC",1452,0)
ORWUXT REF
"KRN",19,10082,"RPC",1453,0)
ORWUXT VAL
"KRN",19,10082,"RPC",1454,0)
ORQQCN DEFAULT REQUEST REASON
"KRN",19,10082,"RPC",1455,0)
ORWDX LOCK ORDER
"KRN",19,10082,"RPC",1456,0)
ORWDX UNLOCK ORDER
"KRN",19,10082,"RPC",1457,0)
ORWDCN32 NEWDLG
"KRN",19,10082,"RPC",1458,0)
ORQQCN GET SERVICE IEN
"KRN",19,10082,"RPC",1459,0)
ORQQCN PROVDX
"KRN",19,10082,"RPC",1460,0)
TIU TEMPLATE ACCESS LEVEL
"KRN",19,10082,"RPC",1461,0)
TIU GET DOCUMENT TITLE
"KRN",19,10082,"RPC",1462,0)
ORWPT BYWARD
"KRN",19,10082,"RPC",1463,0)
ORQQPX GET HIST LOCATIONS
"KRN",19,10082,"RPC",1464,0)
ORQQPX NEW REMINDERS ACTIVE
"KRN",19,10082,"RPC",1465,0)
ORWPCE GET VISIT
"KRN",19,10082,"RPC",1480,0)
TIU GET REQUEST
"KRN",19,10082,"RPC",1481,0)
ORWORB KILL EXPIR MED ALERT
"KRN",19,10082,"RPC",1482,0)
DG CHK BS5 XREF ARRAY
"KRN",19,10082,"RPC",1483,0)
DG CHK BS5 XREF Y/N
"KRN",19,10082,"RPC",1484,0)
DG CHK PAT/DIV MEANS TEST
"KRN",19,10082,"RPC",1485,0)
DG SENSITIVE RECORD ACCESS
"KRN",19,10082,"RPC",1486,0)
DG SENSITIVE RECORD BULLETIN
"KRN",19,10082,"RPC",1487,0)
ORQQCN CANEDIT
"KRN",19,10082,"RPC",1488,0)
ORQQCN EDIT DEFAULT REASON
"KRN",19,10082,"RPC",1489,0)
ORQQCN SF513 WINDOWS PRINT
"KRN",19,10082,"RPC",1490,0)
ORWCIRN FACLIST
"KRN",19,10082,"RPC",1491,0)
ORWDLR32 GET LAB TIMES
"KRN",19,10082,"RPC",1492,0)
ORWPT LEGACY
"KRN",19,10082,"RPC",1493,0)
ORWRP GET DEFAULT PRINTER
"KRN",19,10082,"RPC",1494,0)
ORWRP PRINT WINDOWS REPORT
"KRN",19,10082,"RPC",1495,0)
ORWRP SAVE DEFAULT PRINTER
"KRN",19,10082,"RPC",1496,0)
ORWRP WINPRINT DEFAULT
"KRN",19,10082,"RPC",1497,0)
ORWRP WINPRINT LAB REPORTS
"KRN",19,10082,"RPC",1498,0)
ORWTIU WINPRINT NOTE
"KRN",19,10082,"RPC",1500,0)
ORWPCE GAFOK
"KRN",19,10082,"RPC",1501,0)
ORWPCE MHCLINIC
"KRN",19,10082,"RPC",1502,0)
ORWPCE LOADGAF
"KRN",19,10082,"RPC",1503,0)
ORWPCE SAVEGAF
"KRN",19,10082,"RPC",1504,0)
ORWPCE FORCE
"KRN",19,10082,"RPC",1505,0)
TIU GET DEFAULT PROVIDER
"KRN",19,10082,"RPC",1506,0)
TIU GET SITE PARAMETERS
"KRN",19,10082,"RPC",1507,0)
TIU IS USER A PROVIDER?
"KRN",19,10082,"RPC",1508,0)
ORWOR VWGET
"KRN",19,10082,"RPC",1509,0)
ORWOR VWSET
"KRN",19,10082,"RPC",1510,0)
ORWU PARAM
"KRN",19,10082,"RPC",1511,0)
ORWDOR LKSCRN
"KRN",19,10082,"RPC",1512,0)
ORWDOR VALNUM
"KRN",19,10082,"RPC",1513,0)
ORWDPS32 VALROUTE
"KRN",19,10082,"RPC",1515,0)
ORWORB UNSIG ORDERS FOLLOWUP
"KRN",19,10082,"RPC",1516,0)
ORWTIU GET LISTBOX ITEM
"KRN",19,10082,"RPC",1517,0)
ORWRP2 HS COMP FILES
"KRN",19,10082,"RPC",1518,0)
ORWRP2 HS COMPONENTS
"KRN",19,10082,"RPC",1519,0)
ORWRP2 HS FILE LOOKUP
"KRN",19,10082,"RPC",1520,0)
ORWRP2 HS REPORT TEXT
"KRN",19,10082,"RPC",1521,0)
ORWRP2 HS SUBITEMS
"KRN",19,10082,"RPC",1522,0)
ORWPCE HASCPT
"KRN",19,10082,"RPC",1523,0)
ORWPCE ASKPCE
"KRN",19,10082,"RPC",1524,0)
ORWPCE MHTESTOK
"KRN",19,10082,"RPC",1525,0)
ORWPCE GAFURL
"KRN",19,10082,"RPC",1526,0)
ORQQPXRM DIALOG PROMPTS
"KRN",19,10082,"RPC",1527,0)
ORQQPXRM EDUCATION SUBTOPICS
"KRN",19,10082,"RPC",1528,0)
ORQQPXRM EDUCATION SUMMARY
"KRN",19,10082,"RPC",1529,0)
ORQQPXRM EDUCATION TOPIC
"KRN",19,10082,"RPC",1530,0)
ORQQPXRM MENTAL HEALTH
"KRN",19,10082,"RPC",1531,0)
ORQQPXRM MENTAL HEALTH RESULTS
"KRN",19,10082,"RPC",1532,0)
ORQQPXRM MENTAL HEALTH SAVE
"KRN",19,10082,"RPC",1533,0)
ORQQPXRM PROGRESS NOTE HEADER
"KRN",19,10082,"RPC",1534,0)
ORQQPXRM REMINDER CATEGORIES
"KRN",19,10082,"RPC",1535,0)
ORQQPXRM REMINDER DETAIL
"KRN",19,10082,"RPC",1536,0)
ORQQPXRM REMINDER DIALOG
"KRN",19,10082,"RPC",1537,0)
ORQQPXRM REMINDER EVALUATION
"KRN",19,10082,"RPC",1538,0)
ORQQPXRM REMINDER INQUIRY
"KRN",19,10082,"RPC",1539,0)
ORQQPXRM REMINDER WEB
"KRN",19,10082,"RPC",1540,0)
ORQQPXRM REMINDERS APPLICABLE
"KRN",19,10082,"RPC",1541,0)
ORQQPXRM REMINDERS UNEVALUATED
"KRN",19,10082,"RPC",1542,0)
ORWLRR INFO
"KRN",19,10082,"RPC",1543,0)
TIU GET PRINT NAME
"KRN",19,10082,"RPC",1544,0)
TIU WAS THIS SAVED?
"KRN",19,10082,"RPC",1545,0)
ORWD1 COMLOC
"KRN",19,10082,"RPC",1546,0)
ORWD1 SIG4ANY
"KRN",19,10082,"RPC",1547,0)
ORWD1 SIG4ONE
"KRN",19,10082,"RPC",1548,0)
ORWOR UNSIGN
"KRN",19,10082,"RPC",1549,0)
ORWPT INPLOC
"KRN",19,10082,"RPC",1553,0)
ORQQCN2 GET PREREQUISITE
"KRN",19,10082,"RPC",1554,0)
ORQQCN2 SCHEDULE CONSULT
"KRN",19,10082,"RPC",1555,0)
YS GAF API
"KRN",19,10082,"RPC",1556,0)
TIU LONG LIST BOILERPLATED
"KRN",19,10082,"RPC",1557,0)
ORWDLR33 FUTURE LAB COLLECTS
"KRN",19,10082,"RPC",1558,0)
ORWRP PRINT REMOTE REPORT
"KRN",19,10082,"RPC",1559,0)
ORWRP PRINT WINDOWS REMOTE
"KRN",19,10082,"RPC",1560,0)
ORWRP PRINT LAB REMOTE
"KRN",19,10082,"RPC",1561,0)
ORWRP PRINT WINDOWS LAB REMOTE
"KRN",19,10082,"RPC",1562,0)
ORQQPXRM DIALOG ACTIVE
"KRN",19,10082,"RPC",1563,0)
ORWPCE MH TEST AUTHORIZED
"KRN",19,10082,"RPC",1564,0)
TIU GET BOILERPLATE
"KRN",19,10082,"RPC",1565,0)
ORWRP2 HS COMPONENT SUBS
"KRN",19,10082,"RPC",1566,0)
ORWCH SAVFONT
"KRN",19,10082,"RPC",1567,0)
ORWDLR33 LASTTIME
"KRN",19,10082,"RPC",1568,0)
ORWD1 SVONLY
"KRN",19,10082,"RPC",1569,0)
ORWPCE HASVISIT
"KRN",19,10082,"RPC",1570,0)
ORWPCE GETMOD
"KRN",19,10082,"RPC",1571,0)
ORWPCE CPTMODS
"KRN",19,10082,"RPC",1572,0)
XWB REMOTE CLEAR
"KRN",19,10082,"RPC",1573,0)
XWB REMOTE GETDATA
"KRN",19,10082,"RPC",1574,0)
XWB REMOTE RPC
"KRN",19,10082,"RPC",1575,0)
XWB REMOTE STATUS CHECK
"KRN",19,10082,"RPC",1576,0)
ORQQCN ASSIGNABLE MED RESULTS
"KRN",19,10082,"RPC",1577,0)
ORQQCN ATTACH MED RESULTS
"KRN",19,10082,"RPC",1578,0)
ORQQCN GET MED RESULT DETAILS
"KRN",19,10082,"RPC",1579,0)
ORQQCN REMOVABLE MED RESULTS
"KRN",19,10082,"RPC",1580,0)
ORQQCN REMOVE MED RESULTS
"KRN",19,10082,"RPC",1581,0)
ORQQCN SVC W/SYNONYMS
"KRN",19,10082,"RPC",1582,0)
ORWCV1 COVERSHEET LIST
"KRN",19,10082,"RPC",1583,0)
ORWORB KILL EXPIR OI ALERT
"KRN",19,10082,"RPC",1584,0)
ORWPCE GETSVC
"KRN",19,10082,"RPC",1585,0)
ORWRP LAB REPORT LISTS
"KRN",19,10082,"RPC",1587,0)
ORWTPN GETCLASS
"KRN",19,10082,"RPC",1588,0)
ORWTPN GETTC
"KRN",19,10082,"RPC",1589,0)
ORWTPO CSARNGD
"KRN",19,10082,"RPC",1590,0)
ORWTPO CSLABD
"KRN",19,10082,"RPC",1591,0)
ORWTPO GETTABS
"KRN",19,10082,"RPC",1592,0)
ORWTPP ADDLIST
"KRN",19,10082,"RPC",1593,0)
ORWTPP CHKSURR
"KRN",19,10082,"RPC",1594,0)
ORWTPP CLDAYS
"KRN",19,10082,"RPC",1595,0)
ORWTPP CLEARNOT
"KRN",19,10082,"RPC",1596,0)
ORWTPP CLRANGE
"KRN",19,10082,"RPC",1597,0)
ORWTPP CSARNG
"KRN",19,10082,"RPC",1598,0)
ORWTPP CSLAB
"KRN",19,10082,"RPC",1599,0)
ORWTPP DELLIST
"KRN",19,10082,"RPC",1600,0)
ORWTPP GETCOMBO
"KRN",19,10082,"RPC",1601,0)
ORWTPP GETCOS
"KRN",19,10082,"RPC",1602,0)
ORWTPP GETDCOS
"KRN",19,10082,"RPC",1603,0)
ORWTPP GETNOT
"KRN",19,10082,"RPC",1604,0)
ORWTPP GETNOTO
"KRN",19,10082,"RPC",1605,0)
ORWTPP GETOC
"KRN",19,10082,"RPC",1606,0)
ORWTPP GETOTHER
"KRN",19,10082,"RPC",1607,0)
ORWTPP GETREM
"KRN",19,10082,"RPC",1608,0)
ORWTPP GETSUB
"KRN",19,10082,"RPC",1609,0)
ORWTPP GETSURR
"KRN",19,10082,"RPC",1610,0)
ORWTPP GETTD
"KRN",19,10082,"RPC",1611,0)
ORWTPP GETTU
"KRN",19,10082,"RPC",1612,0)
ORWTPP LSDEF
"KRN",19,10082,"RPC",1613,0)
ORWTPP NEWLIST
"KRN",19,10082,"RPC",1614,0)
ORWTPP PLISTS
"KRN",19,10082,"RPC",1615,0)
ORWTPP PLTEAMS
"KRN",19,10082,"RPC",1616,0)
ORWTPP REMLIST
"KRN",19,10082,"RPC",1617,0)
ORWTPP SAVECD
"KRN",19,10082,"RPC",1618,0)
ORWTPP SAVECS
"KRN",19,10082,"RPC",1619,0)
ORWTPP SAVELIST
"KRN",19,10082,"RPC",1620,0)
ORWTPP SAVENOT
"KRN",19,10082,"RPC",1621,0)
ORWTPP SAVENOTO
"KRN",19,10082,"RPC",1622,0)
ORWTPP SAVEOC
"KRN",19,10082,"RPC",1623,0)
ORWTPP SAVEPLD
"KRN",19,10082,"RPC",1624,0)
ORWTPP SAVESURR
"KRN",19,10082,"RPC",1625,0)
ORWTPP SAVET
"KRN",19,10082,"RPC",1626,0)
ORWTPP SETCOMBO
"KRN",19,10082,"RPC",1627,0)
ORWTPP SETDCOS
"KRN",19,10082,"RPC",1628,0)
ORWTPP SETOTHER
"KRN",19,10082,"RPC",1629,0)
ORWTPP SETREM
"KRN",19,10082,"RPC",1630,0)
ORWTPP SETSUB
"KRN",19,10082,"RPC",1631,0)
ORWTPP SORTDEF
"KRN",19,10082,"RPC",1632,0)
ORWTPP TEAMS
"KRN",19,10082,"RPC",1633,0)
ORWTPT ATEAMS
"KRN",19,10082,"RPC",1634,0)
ORWTPT GETTEAM
"KRN",19,10082,"RPC",1635,0)
TIU TEMPLATE GET DEFAULTS
"KRN",19,10082,"RPC",1636,0)
TIU TEMPLATE GET DESCRIPTION
"KRN",19,10082,"RPC",1637,0)
TIU TEMPLATE SET DEFAULTS
"KRN",19,10082,"RPC",1638,0)
ORWTIU IDNOTES INSTALLED
"KRN",19,10082,"RPC",1639,0)
ORQQPX GET FOLDERS
"KRN",19,10082,"RPC",1640,0)
ORQQPX SET FOLDERS
"KRN",19,10082,"RPC",1641,0)
TIU FIELD CAN EDIT
"KRN",19,10082,"RPC",1642,0)
TIU FIELD DELETE
"KRN",19,10082,"RPC",1643,0)
TIU FIELD EXPORT
"KRN",19,10082,"RPC",1644,0)
TIU FIELD IMPORT
"KRN",19,10082,"RPC",1645,0)
TIU FIELD LIST
"KRN",19,10082,"RPC",1646,0)
TIU FIELD LOAD
"KRN",19,10082,"RPC",1647,0)
TIU FIELD LOAD BY IEN
"KRN",19,10082,"RPC",1648,0)
TIU FIELD LOCK
"KRN",19,10082,"RPC",1649,0)
TIU FIELD NAME IS UNIQUE
"KRN",19,10082,"RPC",1650,0)
TIU FIELD SAVE
"KRN",19,10082,"RPC",1651,0)
TIU FIELD UNLOCK
"KRN",19,10082,"RPC",1652,0)
ORWDPS1 CHK94
"KRN",19,10082,"RPC",1653,0)
ORWDPS1 ODSLCT
"KRN",19,10082,"RPC",1654,0)
ORWDPS1 SCHALL
"KRN",19,10082,"RPC",1655,0)
ORWDPS2 ADMIN
"KRN",19,10082,"RPC",1656,0)
ORWDPS2 DAY2QTY
"KRN",19,10082,"RPC",1657,0)
ORWDPS2 OISLCT
"KRN",19,10082,"RPC",1658,0)
ORWDPS2 REQST
"KRN",19,10082,"RPC",1659,0)
ORWDX DGNM
"KRN",19,10082,"RPC",1660,0)
ORWUL FV4DG
"KRN",19,10082,"RPC",1661,0)
ORWUL FVIDX
"KRN",19,10082,"RPC",1662,0)
ORWUL FVSUB
"KRN",19,10082,"RPC",1663,0)
ORWUL QV4DG
"KRN",19,10082,"RPC",1664,0)
ORWUL QVIDX
"KRN",19,10082,"RPC",1665,0)
ORWUL QVSUB
"KRN",19,10082,"RPC",1666,0)
ORWDPS1 DFLTSPLY
"KRN",19,10082,"RPC",1668,0)
PXRM REMINDER DIALOG (TIU)
"KRN",19,10082,"RPC",1669,0)
ORWPCE ANYTIME
"KRN",19,10082,"RPC",1670,0)
ORQQPX GET DEF LOCATIONS
"KRN",19,10082,"RPC",1671,0)
ORWTPP GETIMG
"KRN",19,10082,"RPC",1672,0)
ORWTPP SETIMG
"KRN",19,10082,"RPC",1673,0)
ORWTPO GETIMGD
"KRN",19,10082,"RPC",1674,0)
ORQQPX REM INSERT AT CURSOR
"KRN",19,10082,"RPC",1675,0)
TIU REMINDER DIALOGS
"KRN",19,10082,"RPC",1676,0)
TIU REM DLG OK AS TEMPLATE
"KRN",19,10082,"RPC",1677,0)
ORWDPS2 MAXREF
"KRN",19,10082,"RPC",1678,0)
ORWDPS2 SCHREQ
"KRN",19,10082,"RPC",1679,0)
ORWRP COLUMN HEADERS
"KRN",19,10082,"RPC",1680,0)
TIU FIELD DOLMTEXT
"KRN",19,10082,"RPC",1681,0)
TIU TEMPLATE PERSONAL OBJECTS
"KRN",19,10082,"RPC",1682,0)
ORWPCE AUTO VISIT TYPE SELECT
"KRN",19,10082,"RPC",1683,0)
ORWDPS2 QTY2DAY
"KRN",19,10082,"RPC",1684,0)
ORWU HAS OPTION ACCESS
"KRN",19,10082,"RPC",1685,0)
TIU TEMPLATE LOCK
"KRN",19,10082,"RPC",1686,0)
ORQQPX LVREMLST
"KRN",19,10082,"RPC",1687,0)
ORQQPX NEW COVER SHEET ACTIVE
"KRN",19,10082,"RPC",1688,0)
ORQQPX NEW COVER SHEET REMS
"KRN",19,10082,"RPC",1689,0)
ORQQPX SAVELVL
"KRN",19,10082,"RPC",1690,0)
PXRM REMINDER CATEGORY
"KRN",19,10082,"RPC",1691,0)
PXRM REMINDERS AND CATEGORIES
"KRN",19,10082,"RPC",1692,0)
TIU DIV AND CLASS INFO
"KRN",19,10082,"RPC",1693,0)
TIU TEMPLATE GETBOIL
"KRN",19,10082,"RPC",1694,0)
TIU TEMPLATE GETITEMS
"KRN",19,10082,"RPC",1695,0)
TIU TEMPLATE GETROOTS
"KRN",19,10082,"RPC",1696,0)
TIU TEMPLATE GETTEXT
"KRN",19,10082,"RPC",1697,0)
TIU TEMPLATE ISEDITOR
"KRN",19,10082,"RPC",1698,0)
TIU TEMPLATE UNLOCK
"KRN",19,10082,"RPC",1699,0)
TIU USER CLASS LONG LIST
"KRN",19,10082,"RPC",1700,0)
ORWPCE ALWAYS CHECKOUT
"KRN",19,10082,"RPC",1701,0)
ORWPCE GET EXCLUDED
"KRN",19,10082,"RPC",1702,0)
ORWDPS1 FORMALT
"KRN",19,10082,"RPC",1703,0)
ORQPT DEFAULT LIST SORT
"KRN",19,10082,"RPC",1704,0)
ORWDPS1 DOSEALT
"KRN",19,10082,"RPC",1705,0)
ORWTPR OCDESC
"KRN",19,10082,"RPC",1706,0)
ORWTPR NOTDESC
"KRN",19,10082,"RPC",1707,0)
ORWDPS1 FAILDEA
"KRN",19,10082,"RPC",1708,0)
ORQPT DEFAULT CLINIC DATE RANG
"KRN",19,10082,"RPC",1709,0)
ORWTIU CANLINK
"KRN",19,10082,"RPC",1710,0)
TIU ID ATTACH ENTRY
"KRN",19,10082,"RPC",1711,0)
TIU ID CAN ATTACH
"KRN",19,10082,"RPC",1712,0)
TIU ID CAN RECEIVE
"KRN",19,10082,"RPC",1713,0)
TIU ID DETACH ENTRY
"KRN",19,10082,"RPC",1714,0)
ORWCOM GETOBJS
"KRN",19,10082,"RPC",1715,0)
ORWCOM DETAILS
"KRN",19,10082,"RPC",1716,0)
ORWCOM PTOBJ
"KRN",19,10082,"RPC",1718,0)
TIU TEMPLATE GETLINK
"KRN",19,10082,"RPC",1719,0)
TIU TEMPLATE ALL TITLES
"KRN",19,10082,"RPC",1720,0)
ORWSR LIST
"KRN",19,10082,"RPC",1721,0)
ORWSR SHOW SURG TAB
"KRN",19,10082,"RPC",1722,0)
ORWSR GET SURG CONTEXT
"KRN",19,10082,"RPC",1723,0)
ORWSR SAVE SURG CONTEXT
"KRN",19,10082,"RPC",1724,0)
ORWSR ONECASE
"KRN",19,10082,"RPC",1727,0)
ORWSR SHOW OPTOP WHEN SIGNING
"KRN",19,10082,"RPC",1728,0)
ORWSR IS NON-OR PROCEDURE
"KRN",19,10082,"RPC",1729,0)
ORWSR CASELIST
"KRN",19,10082,"RPC",1730,0)
ORQQCN GET PROC IEN
"KRN",19,10082,"RPC",1731,0)
ORWRP PRINT V REPORT
"KRN",19,10082,"RPC",1732,0)
ORWRP3 EXPAND COLUMNS
"KRN",19,10082,"RPC",1733,0)
ORWTPD ACTDF
"KRN",19,10082,"RPC",1734,0)
ORWTPD DELDFLT
"KRN",19,10082,"RPC",1735,0)
ORWTPD GETDFLT
"KRN",19,10082,"RPC",1736,0)
ORWTPD RSDFLT
"KRN",19,10082,"RPC",1737,0)
ORWTPD SUDF
"KRN",19,10082,"RPC",1738,0)
ORWTPD SUINDV
"KRN",19,10082,"RPC",1739,0)
ORWTPD GETSETS
"KRN",19,10082,"RPC",1740,0)
ORWCOM ORDEROBJ
"KRN",19,10082,"RPC",1741,0)
ORWRP2 COMPABV
"KRN",19,10082,"RPC",1742,0)
ORWRP2 GETLKUP
"KRN",19,10082,"RPC",1743,0)
ORWRP2 SAVLKUP
"KRN",19,10082,"RPC",1744,0)
ORWRP2 COMPDISP
"KRN",19,10082,"RPC",1745,0)
ORWPCE ISCLINIC
"KRN",19,10082,"RPC",1746,0)
ORWCH SAVECOL
"KRN",19,10082,"RPC",1747,0)
ORWSR RPTLIST
"KRN",19,10082,"RPC",1748,0)
ORQQPXRM MST UPDATE
"KRN",19,10082,"RPC",1749,0)
ORWMC PATIENT PROCEDURES1
"KRN",19,10082,"RPC",1750,0)
ORWRA IMAGING EXAMS1
"KRN",19,10082,"RPC",1751,0)
ORWRA REPORT TEXT1
"KRN",19,10082,"RPC",1752,0)
ORWDPS4 CPINFO
"KRN",19,10082,"RPC",1753,0)
ORWDPS4 CPLST
"KRN",19,10082,"RPC",1754,0)
ORWORB KILL UNVER MEDS ALERT
"KRN",19,10082,"RPC",1755,0)
ORWORB KILL UNVER ORDERS ALERT
"KRN",19,10082,"RPC",1756,0)
ORWPCE HNCOK
"KRN",19,10082,"RPC",1757,0)
ORWPS MEDHIST
"KRN",19,10082,"RPC",1758,0)
TIU FIELD CHECK
"KRN",19,10082,"RPC",1759,0)
TIU FIELD LIST ADD
"KRN",19,10082,"RPC",1760,0)
TIU FIELD LIST IMPORT
"KRN",19,10082,"RPC",1761,0)
TIU SET DOCUMENT TEXT
"KRN",19,10082,"RPC",1762,0)
ORWDPS2 CHKPI
"KRN",19,10082,"RPC",1763,0)
ORWDXR GTORITM
"KRN",19,10082,"RPC",1764,0)
ORWDPS2 CHKGRP
"KRN",19,10082,"RPC",1765,0)
ORWDPS2 QOGRP
"KRN",19,10082,"RPC",1766,0)
ORWDXR GETPKG
"KRN",19,10082,"RPC",1767,0)
ORQPT MAKE RPL
"KRN",19,10082,"RPC",1768,0)
ORQPT READ RPL
"KRN",19,10082,"RPC",1769,0)
ORQPT KILL RPL
"KRN",19,10082,"RPC",1770,0)
ORWTIU GET SAVED CP FIELDS
"KRN",19,10082,"RPC",1771,0)
ORWDPS1 LOCPICK
"KRN",19,10082,"RPC",1772,0)
ORWPT LAST5 RPL
"KRN",19,10082,"RPC",1773,0)
ORWPT FULLSSN RPL
"KRN",19,10082,"RPC",1774,0)
ORWOR PKIUSE
"KRN",19,10082,"RPC",1775,0)
ORWOR1 SIG
"KRN",19,10082,"RPC",1776,0)
ORWOR1 CHKDIG
"KRN",19,10082,"RPC",1777,0)
ORWOR1 GETDTEXT
"KRN",19,10082,"RPC",1778,0)
ORWOR1 GETDSIG
"KRN",19,10082,"RPC",1779,0)
ORWTPD GETIMG
"KRN",19,10082,"RPC",1780,0)
OREVNTX1 PRMPTID
"KRN",19,10082,"RPC",1781,0)
ORECS01 CHKESSO
"KRN",19,10082,"RPC",1782,0)
ORECS01 VSITID
"KRN",19,10082,"RPC",1784,0)
OREVNTX LIST
"KRN",19,10082,"RPC",1785,0)
OREVNTX PAT
"KRN",19,10082,"RPC",1786,0)
OREVNTX1 GTEVT
"KRN",19,10082,"RPC",1787,0)
OREVNTX1 CPACT
"KRN",19,10082,"RPC",1788,0)
OREVNTX1 CURSPE
"KRN",19,10082,"RPC",1789,0)
OREVNTX1 CHGEVT
"KRN",19,10082,"RPC",1790,0)
OREVNTX1 DELPTEVT
"KRN",19,10082,"RPC",1791,0)
OREVNTX1 DFLTEVT
"KRN",19,10082,"RPC",1792,0)
OREVNTX ACTIVE
"KRN",19,10082,"RPC",1793,0)
OREVNTX1 PUTEVNT
"KRN",19,10082,"RPC",1794,0)
OREVNTX1 WRLSTED
"KRN",19,10082,"RPC",1795,0)
OREVNTX1 EVT
"KRN",19,10082,"RPC",1796,0)
OREVNTX1 NAME
"KRN",19,10082,"RPC",1797,0)
OREVNTX1 MATCH
"KRN",19,10082,"RPC",1798,0)
OREVNTX1 EMPTY
"KRN",19,10082,"RPC",1799,0)
OREVNTX1 EXISTS
"KRN",19,10082,"RPC",1800,0)
OREVNTX1 GTEVT1
"KRN",19,10082,"RPC",1801,0)
OREVNTX1 DIV
"KRN",19,10082,"RPC",1802,0)
OREVNTX1 DIV1
"KRN",19,10082,"RPC",1803,0)
OREVNTX1 LOC
"KRN",19,10082,"RPC",1804,0)
OREVNTX1 LOC1
"KRN",19,10082,"RPC",1805,0)
ORWDX SENDED
"KRN",19,10082,"RPC",1806,0)
OREVNTX1 GETDLG
"KRN",19,10082,"RPC",1807,0)
ORECS01 ECPRINT
"KRN",19,10082,"RPC",1811,0)
ORECS01 ECRPT
"KRN",19,10082,"RPC",1812,0)
OREVNTX1 ISDCOD
"KRN",19,10082,"RPC",1813,0)
OREVNTX1 SETDFLT
"KRN",19,10082,"RPC",1815,0)
TIU IS THIS A CLINPROC?
"KRN",19,10082,"RPC",1816,0)
TIU IDENTIFY CLINPROC CLASS
"KRN",19,10082,"RPC",1817,0)
TIU LONG LIST CLINPROC TITLES
"KRN",19,10082,"RPC",1819,0)
ORWDPS1 HASOIPI
"KRN",19,10082,"RPC",1821,0)
OREVNTX1 DEFLTS
"KRN",19,10082,"RPC",1822,0)
OREVNTX1 MULTS
"KRN",19,10082,"RPC",1823,0)
OREVNTX1 DONE
"KRN",19,10082,"RPC",1824,0)
OREVNTX1 PROMPT IDS
"KRN",19,10082,"RPC",1825,0)
ORWCIRN CHECKLINK
"KRN",19,10082,"RPC",1826,0)
XWB DIRECT RPC
"KRN",19,10082,"RPC",1827,0)
ORWDPS1 HASROUTE
"KRN",19,10082,"RPC",1828,0)
ORQQCN UNRESOLVED
"KRN",19,10082,"RPC",1829,0)
OREVNTX1 DELDFLT
"KRN",19,10082,"RPC",1830,0)
ORWCH LDFONT
"KRN",19,10082,"RPC",1831,0)
ORWU1 NAMECVT
"KRN",19,10082,"RPC",1832,0)
OREVNTX1 DFLTDLG
"KRN",19,10082,"RPC",1833,0)
ORWDPS5 LESAPI
"KRN",19,10082,"RPC",1834,0)
ORWDPS5 LESGRP
"KRN",19,10082,"RPC",1839,0)
OREVNTX1 TYPEXT
"KRN",19,10082,"RPC",1840,0)
ORWORR RGET
"KRN",19,10082,"RPC",1841,0)
OREVNTX1 AUTHMREL
"KRN",19,10082,"RPC",1842,0)
OREVNTX1 HAVEPRT
"KRN",19,10082,"RPC",1843,0)
OREVNTX1 CMEVTS
"KRN",19,10082,"RPC",1844,0)
OREVNTX1 ODPTEVID
"KRN",19,10082,"RPC",1845,0)
ORWOR PKISITE
"KRN",19,10082,"RPC",1846,0)
OREVNTX1 COMP
"KRN",19,10082,"RPC",1847,0)
OREVNTX1 ISHDORD
"KRN",19,10082,"RPC",1848,0)
ORWDXR ORCPLX
"KRN",19,10082,"RPC",1849,0)
OREVNTX1 ISPASS
"KRN",19,10082,"RPC",1850,0)
OREVNTX1 ISPASS1
"KRN",19,10082,"RPC",1851,0)
OREVNTX1 DLGIEN
"KRN",19,10082,"RPC",1852,0)
ORWDXR CANRN
"KRN",19,10082,"RPC",1853,0)
ORWDXR ISCPLX
"KRN",19,10082,"RPC",1854,0)
ORWDXA OFCPLX
"KRN",19,10082,"RPC",1855,0)
ORQQPX GET NOT PURPOSE
"KRN",19,10082,"RPC",1856,0)
ORWDPS1 IVDEA
"KRN",19,10082,"RPC",1857,0)
ORWDXR ISNOW
"KRN",19,10082,"RPC",1858,0)
ORRHCQ QRYITR
"KRN",19,10082,"RPC",1859,0)
OREVNTX1 GETSTS
"KRN",19,10082,"RPC",1860,0)
ORWU DEFAULT DIVISION
"KRN",19,10082,"RPC",1861,0)
ORWDXA ISACTOI
"KRN",19,10082,"RPC",1862,0)
ORECS01 SAVPATH
"KRN",19,10082,"RPC",1863,0)
ORWOR RESULT HISTORY
"KRN",19,10082,"RPC",1864,0)
XUS GET TOKEN
"KRN",19,10082,"RPC",1865,0)
ORQQPX IMMUN LIST
"KRN",19,10082,"RPC",1866,0)
XWB DEFERRED CLEARALL
"KRN",19,10082,"RPC",1867,0)
ORWOR1 SETDTEXT
"KRN",19,10082,"RPC",1868,0)
ORWOR1 GETDEA
"KRN",19,10082,"RPC",1869,0)
ORWOR1 GETDSCH
"KRN",19,10082,"RPC",1870,0)
ORWORB TEXT FOLLOWUP
"KRN",19,10082,"RPC",1871,0)
ORWU1 NEWLOC
"KRN",19,10082,"RPC",1872,0)
ORWPCE ACTIVE CODE
"KRN",19,10082,"RPC",1873,0)
ORQQPXRM GET WH LETTER TEXT
"KRN",19,10082,"RPC",1874,0)
ORQQPXRM GET WH LETTER TYPE
"KRN",19,10082,"RPC",1875,0)
ORQQPXRM GET WH PROC RESULT
"KRN",19,10082,"RPC",1876,0)
ORQQPXRM WOMEN HEALTH SAVE
"KRN",19,10082,"RPC",1877,0)
ORB FORWARD ALERT
"KRN",19,10082,"RPC",1878,0)
ORB RENEW ALERT
"KRN",19,10082,"RPC",1879,0)
ORPRF CLEAR
"KRN",19,10082,"RPC",1880,0)
ORPRF GETFLG
"KRN",19,10082,"RPC",1881,0)
ORPRF HASFLG
"KRN",19,10082,"RPC",1882,0)
ORWTPD GETOCM
"KRN",19,10082,"RPC",1883,0)
TIU ONE VISIT NOTE?
"KRN",19,10082,"RPC",1884,0)
VAFCTFU CONVERT ICN TO DFN
"KRN",19,10082,"RPC",1885,0)
ORIMO IMOLOC
"KRN",19,10082,"RPC",1886,0)
ORIMO IMOOD
"KRN",19,10082,"RPC",1887,0)
ORWDPS4 IPOD4OP
"KRN",19,10082,"RPC",1888,0)
ORWDPS4 UPDTDG
"KRN",19,10082,"RPC",1889,0)
TIU USER INACTIVE?
"KRN",19,10082,"RPC",1890,0)
ORWTPD PUTOCM
"KRN",19,10082,"RPC",1891,0)
ORWOR ACTION TEXT
"KRN",19,10082,"RPC",1892,0)
ORQQPXRM GEC DIALOG
"KRN",19,10082,"RPC",1893,0)
ORQQPXRM GET WH REPORT TEXT
"KRN",19,10082,"RPC",1894,0)
ORWDXR01 CANCHG
"KRN",19,10082,"RPC",1895,0)
ORWDXR01 SAVCHG
"KRN",19,10082,"RPC",1896,0)
TIU HAS AUTHOR SIGNED?
"KRN",19,10082,"RPC",1897,0)
ORQQPXRM CHECK REM VERSION
"KRN",19,10082,"RPC",1898,0)
ORQQPXRM GEC STATUS PROMPT
"KRN",19,10082,"RPC",1899,0)
ORQQPXRM GEC STATUS PROMPT
"KRN",19,10082,"RPC",1900,0)
ORWDAL32 SEND BULLETIN
"KRN",19,10082,"RPC",1901,0)
ORWDBA1 ORPKGTYP
"KRN",19,10082,"RPC",1902,0)
ORWDXR01 ISSPLY
"KRN",19,10082,"RPC",1903,0)
ORWDBA1 RCVORCI
"KRN",19,10082,"RPC",1904,0)
ORWPS REASON
"KRN",19,10082,"RPC",1905,0)
ORQQPXRM GEC FINISHED?
"KRN",19,10082,"RPC",1906,0)
ORWDXM3 ISUDQO
"KRN",19,10082,"RPC",1908,0)
ORWDBA1 SCLST
"KRN",19,10082,"RPC",1909,0)
ORWDXR01 OXDATA
"KRN",19,10082,"RPC",1914,0)
ORWDBA1 BASTATUS
"KRN",19,10082,"RPC",1920,0)
ORWORB SETSORT
"KRN",19,10082,"RPC",1921,0)
ORWORB GETSORT
"KRN",19,10082,"RPC",1922,0)
ORWOR EXPIRED
"KRN",19,10082,"RPC",1928,0)
ORECS01 GETDIV
"KRN",19,10082,"RPC",1933,0)
ORWTPD1 GETEFDAT
"KRN",19,10082,"RPC",1934,0)
ORWTPD1 GETEDATS
"KRN",19,10082,"RPC",1935,0)
ORWTPD1 PUTEDATS
"KRN",19,10082,"RPC",1936,0)
ORWTPD1 GETCSDEF
"KRN",19,10082,"RPC",1937,0)
ORWTPD1 GETCSRNG
"KRN",19,10082,"RPC",1938,0)
ORWTPD1 PUTCSRNG
"KRN",19,10082,"RPC",1939,0)
ORWTPD1 GETEAFL
"KRN",19,10082,"RPC",1940,0)
ORWDBA1 GETORDX
"KRN",19,10082,"RPC",1941,0)
ORWDBA3 HINTS
"KRN",19,10082,"RPC",1942,0)
ORWDAL32 LOAD FOR EDIT
"KRN",19,10082,"RPC",1943,0)
ORWDAL32 SAVE ALLERGY
"KRN",19,10082,"RPC",1944,0)
ORWDAL32 SITE PARAMS
"KRN",19,10082,"RPC",1945,0)
ORWPCE CXNOSHOW
"KRN",19,10082,"RPC",1946,0)
ORWDBA2 ADDPDL
"KRN",19,10082,"RPC",1947,0)
ORWDBA2 DELPDL
"KRN",19,10082,"RPC",1948,0)
ORWDBA2 GETDUDC
"KRN",19,10082,"RPC",1949,0)
ORWDBA2 GETPDL
"KRN",19,10082,"RPC",1950,0)
ORWDBA4 GETBAUSR
"KRN",19,10082,"RPC",1951,0)
ORWDBA4 GETTFCI
"KRN",19,10082,"RPC",1952,0)
ORWNSS NSSMSG
"KRN",19,10082,"RPC",1953,0)
ORWNSS QOSCH
"KRN",19,10082,"RPC",1954,0)
ORWNSS VALSCH
"KRN",19,10082,"RPC",1955,0)
ORWNSS CHKSCH
"KRN",19,10082,"RPC",1956,0)
ORWDPS4 ISUDIV
"KRN",19,10082,"RPC",1957,0)
ORWDPS32 AUTHNVA
"KRN",19,10082,"RPC",1962,0)
ORWTIU CHKTXT
"KRN",19,10082,"RPC",1964,0)
ORWDPS5 ISVTP
"KRN",19,10082,"RPC",1965,0)
TIU IS THIS A SURGERY?
"KRN",19,10082,"RPC",1966,0)
TIU IDENTIFY SURGERY CLASS
"KRN",19,10082,"RPC",1967,0)
TIU LONG LIST SURGERY TITLES
"KRN",19,10082,"RPC",1968,0)
TIU GET DOCUMENTS FOR REQUEST
"KRN",19,10082,"RPC",1969,0)
TIU SET ADMINISTRATIVE CLOSURE
"KRN",19,10082,"RPC",1970,0)
ORBCMA5 GETUDID
"KRN",19,10082,"RPC",1973,0)
ORIMO ISCLOC
"KRN",19,10082,"RPC",1974,0)
ORIMO ISIVQO
"KRN",19,10082,"RPC",1975,0)
ORWDBA7 GETIEN9
"KRN",19,10082,"RPC",1976,0)
ORWGN GNLOC
"KRN",19,10082,"RPC",1977,0)
ORWGN AUTHUSR
"KRN",19,10082,"RPC",1978,0)
ORVAA VAA
"KRN",19,10082,"RPC",1981,0)
ORWDAL32 CLINUSER
"KRN",19,10082,"RPC",1982,0)
ORWDBA7 ISWITCH
"KRN",19,10082,"RPC",1983,0)
ORWDFH CURRENT MEALS
"KRN",19,10082,"RPC",1984,0)
ORWDFH NFSLOC READY
"KRN",19,10082,"RPC",1985,0)
ORWDFH OPDIETS
"KRN",19,10082,"RPC",1986,0)
ORWMHV MHV
"KRN",19,10082,"RPC",1987,0)
ORWPCE1 NONCOUNT
"KRN",19,10082,"RPC",1988,0)
ORWPFSS IS PFSS ACTIVE?
"KRN",19,10082,"RPC",1989,0)
GMV EXTRACT REC
"KRN",19,10082,"RPC",1990,0)
GMV MARK ERROR
"KRN",19,10082,"RPC",1991,0)
ORWDXVB COMPORD
"KRN",19,10082,"RPC",1992,0)
ORWDXVB GETALL
"KRN",19,10082,"RPC",1993,0)
ORWDXVB RAW
"KRN",19,10082,"RPC",1994,0)
ORWDXVB RESULTS
"KRN",19,10082,"RPC",1995,0)
ORWDXVB STATALOW
"KRN",19,10082,"RPC",1996,0)
ORWGRPC ALLITEMS
"KRN",19,10082,"RPC",1997,0)
ORWGRPC CLASS
"KRN",19,10082,"RPC",1998,0)
ORWGRPC DATEITEM
"KRN",19,10082,"RPC",1999,0)
ORWGRPC DELVIEWS
"KRN",19,10082,"RPC",2000,0)
ORWGRPC DETAILS
"KRN",19,10082,"RPC",2001,0)
ORWGRPC GETDATES
"KRN",19,10082,"RPC",2002,0)
ORWGRPC GETPREF
"KRN",19,10082,"RPC",2003,0)
ORWGRPC GETVIEWS
"KRN",19,10082,"RPC",2004,0)
ORWGRPC ITEMDATA
"KRN",19,10082,"RPC",2005,0)
ORWGRPC ITEMS
"KRN",19,10082,"RPC",2006,0)
ORWGRPC LOOKUP
"KRN",19,10082,"RPC",2007,0)
ORWGRPC PUBLIC
"KRN",19,10082,"RPC",2008,0)
ORWGRPC RPTPARAM
"KRN",19,10082,"RPC",2009,0)
ORWGRPC SETPREF
"KRN",19,10082,"RPC",2010,0)
ORWGRPC SETVIEWS
"KRN",19,10082,"RPC",2011,0)
ORWGRPC TESTSPEC
"KRN",19,10082,"RPC",2012,0)
ORWGRPC TYPES
"KRN",19,10082,"RPC",2013,0)
TIU GET DOCUMENT STATUS
"KRN",19,10082,"RPC",2014,0)
TIU GET PRF ACTIONS
"KRN",19,10082,"RPC",2015,0)
TIU ISPRF
"KRN",19,10082,"RPC",2016,0)
TIU LINK TO FLAG
"KRN",19,10082,"RPC",2017,0)
ORWGRPC DETAIL
"KRN",19,10082,"RPC",2018,0)
ORWU VERSION
"KRN",19,10082,"RPC",2019,0)
GMV ALLERGY
"KRN",19,10082,"RPC",2020,0)
ORWCIRN WEBADDR
"KRN",19,10082,"RPC",2023,0)
ORWGRPC TAX
"KRN",19,10082,"RPC",2024,0)
GMV DLL VERSION
"KRN",19,10082,"RPC",2025,0)
ORWDX CHANGE
"KRN",19,10082,"RPC",2026,0)
GMV ADD VM
"KRN",19,10082,"RPC",2027,0)
GMV CONVERT DATE
"KRN",19,10082,"RPC",2028,0)
GMV GET CATEGORY IEN
"KRN",19,10082,"RPC",2029,0)
GMV GET CURRENT TIME
"KRN",19,10082,"RPC",2030,0)
GMV GET VITAL TYPE IEN
"KRN",19,10082,"RPC",2031,0)
GMV LATEST VM
"KRN",19,10082,"RPC",2032,0)
GMV MANAGER
"KRN",19,10082,"RPC",2033,0)
GMV PARAMETER
"KRN",19,10082,"RPC",2034,0)
GMV USER
"KRN",19,10082,"RPC",2035,0)
GMV VITALS/CAT/QUAL
"KRN",19,10082,"RPC",2036,0)
GMV V/M ALLDATA
"KRN",19,10082,"RPC",2037,0)
TIU GET LINKED PRF NOTES
"KRN",19,10082,"RPC",2038,0)
TIU GET PRF TITLE
"KRN",19,10082,"RPC",2039,0)
ORWDX1 PATWARD
"KRN",19,10082,"RPC",2040,0)
ORWRP4 HDR MODIFY
"KRN",19,10082,"RPC",2041,0)
ORWDX1 STCHANGE
"KRN",19,10082,"RPC",2042,0)
ORWDX1 DCREN
"KRN",19,10082,"RPC",2043,0)
ORQQPXRM MHV
"KRN",19,10082,"RPC",2044,0)
ORWGRPC GETSIZE
"KRN",19,10082,"RPC",2045,0)
ORWGRPC SETSIZE
"KRN",19,10082,"RPC",2046,0)
GMV LOCATION SELECT
"KRN",19,10082,"RPC",2047,0)
ORWCIRN AUTORDV
"KRN",19,10082,"RPC",2048,0)
ORPRF TRIGGER POPUP
"KRN",19,10082,"RPC",2049,0)
ORWCIRN HDRON
"KRN",19,10082,"RPC",2051,0)
ORCDLR2 CHECK ALL LC TO WC
"KRN",19,10082,"RPC",2052,0)
ORCDLR2 CHECK ONE LC TO WC
"KRN",19,10082,"RPC",2053,0)
ORALWORD ALLWORD
"KRN",19,10082,"RPC",2054,0)
ORWDX1 ORDMATCH
"KRN",19,10082,"RPC",2055,0)
ORWDX1 DCORIG
"KRN",19,10082,"RPC",2056,0)
ORWDX1 UNDCORIG
"KRN",19,10082,"RPC",2057,0)
ORWDXVB SUBCHK
"KRN",19,10082,"RPC",2058,0)
ORDDPAPI ADMTIME
"KRN",19,10082,"RPC",2059,0)
ORWU PARAMS
"KRN",19,10082,"RPC",2060,0)
ORWDPS1 DOWSCH
"KRN",19,10082,"RPC",2061,0)
ORWDPS33 COMPLOC
"KRN",19,10082,"RPC",2062,0)
ORWGRPC FASTDATA
"KRN",19,10082,"RPC",2063,0)
ORWGRPC FASTITEM
"KRN",19,10082,"RPC",2064,0)
ORWGRPC FASTTASK
"KRN",19,10082,"RPC",2065,0)
ORWGRPC FASTLABS
"KRN",19,10082,"RPC",2066,0)
ORWDPS1 QOMEDALT
"KRN",19,10082,"RPC",2067,0)
ORWGRPC ALLVIEWS
"KRN",19,10082,"RPC",2068,0)
ORDDPAPI CLOZMSG
"KRN",19,10082,"RPC",2069,0)
ORWGRPC TESTING
"KRN",19,10082,"RPC",2070,0)
ORQQPXRM MHDLL
"KRN",19,10082,"RPC",2071,0)
ORWDLR33 LC TO WC
"KRN",19,10082,"RPC",2072,0)
ORWU2 COSIGNER
"KRN",19,10082,"RPC",2073,0)
ORWDXVB NURSADMN
"KRN",19,10082,"RPC",2074,0)
ORQQPXRM MHDLLDMS
"KRN",19,10082,"RPC",2075,0)
TIU IS USER A USR PROVIDER
"KRN",19,10082,"RPC",2076,0)
ORWDPS33 IVDOSFRM
"KRN",19,10082,"RPC",2077,0)
ORWDPS32 ALLIVRTE
"KRN",19,10082,"RPC",2078,0)
ORWDXM1 SVRPC
"KRN",19,10082,"RPC",2079,0)
ORWDXVB VBTNS
"KRN",19,10082,"U")
CPRSCHART VERSION 1.0.27.77
"KRN",19,10150,-1)
2^6
"KRN",19,10150,0)
OR PARAM COORDINATOR MENU^CPRS Configuration (Clin Coord)^^M^64^^^^^^^^^
"KRN",19,10150,10,0)
^19.01IP^24^24
"KRN",19,10150,10,3,0)
10162^GP^15
"KRN",19,10150,10,3,"^")
ORW PARAM GUI
"KRN",19,10150,10,7,0)
9988^MM^35
"KRN",19,10150,10,7,"^")
ORCM MGMT
"KRN",19,10150,10,11,0)
10073^OC^30
"KRN",19,10150,10,11,"^")
ORK ORDER CHK MGMT MENU
"KRN",19,10150,10,24,0)
12480^LO
"KRN",19,10150,10,24,"^")
OR LAPSED ORDERS
"KRN",19,10150,"U")
CPRS CONFIGURATION (CLIN COORD
"KRN",19,10162,-1)
2^11
"KRN",19,10162,0)
ORW PARAM GUI^GUI Parameters^^M^64^^^^^^^22
"KRN",19,10162,10,0)
^19.01IP^12^12
"KRN",19,10162,10,12,0)
12622^CLOZ^99
"KRN",19,10162,10,12,"^")
OR INPT CLOZAPINE MESSAGE
"KRN",19,10162,"U")
GUI PARAMETERS
"KRN",19,12092,-1)
0^8
"KRN",19,12092,0)
OR MEDICATION QO CHECKER^Medication Quick Order Report^^A^^^^^^^^ORDER ENTRY/RESULTS REPORTING^^1
"KRN",19,12092,20)
D ATWILL^ORWOD
"KRN",19,12092,"U")
MEDICATION QUICK ORDER REPORT
"KRN",19,12414,-1)
0^4
"KRN",19,12414,0)
ORK ORD CHK OVERRIDE REPORT^Order Check Override Reason Report^^R^^^^^^^^ORDER ENTRY/RESULTS REPORTING
"KRN",19,12414,1,0)
^^4^4^3061114^
"KRN",19,12414,1,1,0)
Provides a reporting utility that enables facilities to review critical 
"KRN",19,12414,1,2,0)
order check override reasons. Allow for reports to be extracted, 
"KRN",19,12414,1,3,0)
filtered, and sorted by DATE/TIME ORDERED, DIVISION, DISPLAY GROUP, ORDER 
"KRN",19,12414,1,4,0)
CHECK, and ORDER# or any combination of these.
"KRN",19,12414,25)
EN^OROVRRPT
"KRN",19,12414,"U")
ORDER CHECK OVERRIDE REASON RE
"KRN",19,12415,-1)
0^2
"KRN",19,12415,0)
ORLP TEAM LIST VISIBILITY^Set                List Visibility^^R^^^^^^^^ORDER ENTRY/RESULTS REPORTING^y
"KRN",19,12415,1,0)
^19.06^7^7^3071116^^
"KRN",19,12415,1,1,0)
Allow team lists to be designated to be used by GUI applications for:
"KRN",19,12415,1,2,0)
 
"KRN",19,12415,1,3,0)
  0 = OWNER - only viewable by the owner 
"KRN",19,12415,1,4,0)
  1 = ALLUSERS - viewable by anyone
"KRN",19,12415,1,5,0)
 
"KRN",19,12415,1,6,0)
This allows for exclusion of teams from these GUI applications and 
"KRN",19,12415,1,7,0)
would prevent users from viewing some information that is not appropriate.
"KRN",19,12415,25)
ORLSTVIZ
"KRN",19,12415,"U")
SET                LIST VISIBI
"KRN",19,12480,-1)
0^7
"KRN",19,12480,0)
OR LAPSED ORDERS^Lapsed Orders search^^R^^^^^^^^ORDER ENTRY/RESULTS REPORTING
"KRN",19,12480,1,0)
^^10^10^3070119^
"KRN",19,12480,1,1,0)
This option will allow the user to search for LAPSED orders and sort them 
"KRN",19,12480,1,2,0)
by Service/Section, Provider, Patient, or Location.
"KRN",19,12480,1,3,0)
 
"KRN",19,12480,1,4,0)
A start date entry will allow the site to ignore lapsed orders that 
"KRN",19,12480,1,5,0)
fall within their allowed grace period. For example: the site allows the 
"KRN",19,12480,1,6,0)
clinician 48 hours to sign unsigned orders, you would enter T-2 for a 
"KRN",19,12480,1,7,0)
start date.  A stop date entry will allow the site to ignore orders older 
"KRN",19,12480,1,8,0)
than the date entered. An example of this would be, if you wanted to 
"KRN",19,12480,1,9,0)
ignore lapsed orders that were placed prior to CPRS and you installed 
"KRN",19,12480,1,10,0)
CPRS on Jan 1, 1999, you would enter 010199.
"KRN",19,12480,25)
EN^ORLPSR
"KRN",19,12480,"U")
LAPSED ORDERS SEARCH
"KRN",19,12622,-1)
0^10
"KRN",19,12622,0)
OR INPT CLOZAPINE MESSAGE^GUI Edit Inpatient Clozapine Message^^A^^^^^^^^ORDER ENTRY/RESULTS REPORTING^^1
"KRN",19,12622,20)
D EDITPAR^XPAREDIT("OR CLOZ INPT MSG")
"KRN",19,12622,"U")
GUI EDIT INPATIENT CLOZAPINE M
"KRN",8989.5,3907,0)
22;DIC(9.4,^ORWOR WRITE ORDERS LIST^52
"KRN",8989.5,3907,1)
PSJ OR PAT OE
"KRN",8989.5,3908,0)
22;DIC(9.4,^ORWOR WRITE ORDERS LIST^99
"KRN",8989.5,3908,1)
OR GXTEXT WORD PROCESSING ORDER
"KRN",8989.5,3909,0)
22;DIC(9.4,^ORWOR WRITE ORDERS LIST^80
"KRN",8989.5,3909,1)
GMRCOR CONSULT
"KRN",8989.5,3910,0)
22;DIC(9.4,^ORWOR WRITE ORDERS LIST^85
"KRN",8989.5,3910,1)
GMRCOR REQUEST
"KRN",8989.5,3911,0)
22;DIC(9.4,^ORWOR WRITE ORDERS LIST^55
"KRN",8989.5,3911,1)
PSO OERR
"KRN",8989.5,3912,0)
22;DIC(9.4,^ORWOR WRITE ORDERS LIST^60
"KRN",8989.5,3912,1)
LR OTHER LAB TESTS
"KRN",8989.5,3913,0)
22;DIC(9.4,^ORWOR WRITE ORDERS LIST^70
"KRN",8989.5,3913,1)
RA OERR EXAM
"KRN",8989.5,3914,0)
22;DIC(9.4,^ORWOR WRITE ORDERS LIST^58
"KRN",8989.5,3914,1)
PSJI OR PAT FLUID OE
"KRN",8989.5,3915,0)
22;DIC(9.4,^ORWOR WRITE ORDERS LIST^90
"KRN",8989.5,3915,1)
GMRVOR
"KRN",8989.5,3916,0)
22;DIC(9.4,^ORWOR WRITE ORDERS LIST^30
"KRN",8989.5,3916,1)
FHW1
"KRN",8989.5,3917,0)
22;DIC(9.4,^ORWOR WRITE ORDERS LIST^20
"KRN",8989.5,3917,1)
GMRAOR ALLERGY ENTER/EDIT
"KRN",8989.5,5853,0)
22;DIC(9.4,^ORWOR WRITE ORDERS LIST^53
"KRN",8989.5,5853,1)
PSH OERR
"KRN",8989.5,6064,0)
22;DIC(9.4,^ORWOR EXPIRED ORDERS^1
"KRN",8989.5,6064,1)
72
"KRN",8989.5,9809,0)
22;DIC(9.4,^ORWOR WRITE ORDERS LIST^10
"KRN",8989.5,9809,1)
OR ADD MENU CLINICIAN
"KRN",8989.5,11559,0)
22;DIC(9.4,^ORWLR LC CHANGED TO WC^1
"KRN",8989.5,11559,1)
Please contact the ward staff to insure the specimen is collected. 
"KRN",8989.51,227,-1)
0^10
"KRN",8989.51,227,0)
ORWOR WRITE ORDERS LIST^Write Orders (Inpatient)^1^Sequence^Order Dialog
"KRN",8989.51,227,1)
P^101.41^Enter the entry from the dialog file that should be used in the list box.
"KRN",8989.51,227,3)
I "DMOQA"[$P(^(0),U,4)
"KRN",8989.51,227,6)
N^1:999:2^Enter the relative sequence for this order in the list box.
"KRN",8989.51,227,20,0)
^8989.512^3^3^3070507^^^^
"KRN",8989.51,227,20,1,0)
This parameter is used do list the order dialog names that should appear in
"KRN",8989.51,227,20,2,0)
the Write Orders list box of the CPRS GUI.  This is the list of dialogs that
"KRN",8989.51,227,20,3,0)
should be used in the inpatient setting.
"KRN",8989.51,227,30,0)
^8989.513I^6^6
"KRN",8989.51,227,30,1,0)
1^200
"KRN",8989.51,227,30,2,0)
2^44
"KRN",8989.51,227,30,3,0)
3^4.2
"KRN",8989.51,227,30,4,0)
4^9.4
"KRN",8989.51,227,30,5,0)
2.3^49
"KRN",8989.51,227,30,6,0)
2.7^4
"KRN",8989.51,248,-1)
0^8
"KRN",8989.51,248,0)
ORCH CONTEXT MEDS^Meds Tab Context
"KRN",8989.51,248,1)
F
"KRN",8989.51,248,20,0)
^8989.512^10^10^3070306^^
"KRN",8989.51,248,20,1,0)
Specifies a date range (in days) for Meds tab display that dictates the 
"KRN",8989.51,248,20,2,0)
length of time orders are displayed.  The parameter provides strings of 
"KRN",8989.51,248,20,3,0)
delimited ("; ) pieces, the first two of which are always a relative date 
"KRN",8989.51,248,20,4,0)
range.  Users can determine the date range of medications that display on 
"KRN",8989.51,248,20,5,0)
the Medications tab through the Tools|Options pull-down menu in CPRS.
"KRN",8989.51,248,20,6,0)
 
"KRN",8989.51,248,20,7,0)
This parameter functions independently of display settings for the 
"KRN",8989.51,248,20,8,0)
Orders tab.  If you need to alter the display range for expired 
"KRN",8989.51,248,20,9,0)
medication orders on the Orders tab, please adjust the ORWOR EXPIRED 
"KRN",8989.51,248,20,10,0)
ORDERS parameter accordingly.
"KRN",8989.51,248,30,0)
^8989.513I^3^3
"KRN",8989.51,248,30,1,0)
1^200
"KRN",8989.51,248,30,2,0)
5^4.2
"KRN",8989.51,248,30,3,0)
9^9.4
"KRN",8989.51,332,-1)
0^9
"KRN",8989.51,332,0)
ORWOR EXPIRED ORDERS^Hours to find recently expired orders^0^^Hours
"KRN",8989.51,332,1)
N^0:100000:0^Enter the number of hours back in time to search for expired orders.
"KRN",8989.51,332,20,0)
^8989.512^6^6^3070306^^
"KRN",8989.51,332,20,1,0)
Number of hours back in time to search for expired orders.  Also used to 
"KRN",8989.51,332,20,2,0)
determine number of hours back in time to search for expired med orders if
"KRN",8989.51,332,20,3,0)
the follow-up action for the Expiring Meds alert does not find expiring
"KRN",8989.51,332,20,4,0)
meds.
"KRN",8989.51,332,20,5,0)
This parameter does NOT affect Meds tab display.  To alter Meds tab 
"KRN",8989.51,332,20,6,0)
display, please adjust the ORCH CONTEXT MEDS parameter accordingly.
"KRN",8989.51,332,30,0)
^8989.513I^2^2
"KRN",8989.51,332,30,1,0)
3^4.2
"KRN",8989.51,332,30,2,0)
4^9.4
"KRN",8989.51,403,-1)
0^1
"KRN",8989.51,403,0)
OR DC REASON LIST^DC REASON SEQUENCE^1^Display Sequence^Order DC Reason
"KRN",8989.51,403,1)
P^100.03^Enter the sequence you want the order DC reason to appear.
"KRN",8989.51,403,3)
I $$ACTDCREA^ORWDXR(Y)
"KRN",8989.51,403,6)
N
"KRN",8989.51,403,20,0)
^^6^6^3080110^
"KRN",8989.51,403,20,1,0)
This parameter determines the sequence sites want the order DC reasons 
"KRN",8989.51,403,20,2,0)
to  appear. Sites do not need to set a sequence for every DC Reasons.
"KRN",8989.51,403,20,3,0)
For example if a site wants to set the "Requesting Physician Cancelled" 
"KRN",8989.51,403,20,4,0)
DC Reasons to the top of the list. Sites will set a value  of 1 for that
"KRN",8989.51,403,20,5,0)
entry and CPRS will display the rest of the DC Reasons after the
"KRN",8989.51,403,20,6,0)
"Requesting Physician Cancelled"  DC reason.
"KRN",8989.51,403,30,0)
^8989.513I^1^1
"KRN",8989.51,403,30,1,0)
1^4.2
"KRN",8989.51,404,-1)
0^2
"KRN",8989.51,404,0)
OR MEDS TAB SORT^CPRS Medication Tab Sort Order^0^SET OF CODES^CPRS MEDS TAB SORT BY
"KRN",8989.51,404,1)
S^1:Status/Exp. Date;2:Status Group/Status/Loc./Drug name;3:Drug, status active, status recent expired
"KRN",8989.51,404,6)
S
"KRN",8989.51,404,30,0)
^8989.513I^1^1
"KRN",8989.51,404,30,1,0)
6^200
"KRN",8989.51,433,-1)
0^3
"KRN",8989.51,433,0)
OR ADMIN TIME HELP TEXT^CPRS ADMINISTRATION TIMES HELP TEXT^0^FREE TEXT^CPRS ADMINISTRATION TIMES HELP TEXT
"KRN",8989.51,433,1)
W
"KRN",8989.51,433,6)
F
"KRN",8989.51,433,20,0)
^8989.512^4^4^3080110^^
"KRN",8989.51,433,20,1,0)
This parameter determines the information that is displayed in the 
"KRN",8989.51,433,20,2,0)
Administration Time Information pop-up or Hover Hint that is displayed 
"KRN",8989.51,433,20,3,0)
to the user. The pop-up includes the administration times for the dose 
"KRN",8989.51,433,20,4,0)
and the help text defined in this parameter.
"KRN",8989.51,433,30,0)
^8989.513I^1^1
"KRN",8989.51,433,30,1,0)
6^4.2
"KRN",8989.51,434,-1)
0^4
"KRN",8989.51,434,0)
OR FLAGGED ORD REASONS^List of generic Flag reasons^1^sequence^Reason
"KRN",8989.51,434,1)
F^0:80^Enter a generic reason for flagging an order (1-80 characters)
"KRN",8989.51,434,4,0)
^8989.514^1^1
"KRN",8989.51,434,4,1,0)
flag
"KRN",8989.51,434,4,"B","flag",1)

"KRN",8989.51,434,6)
N^0:999:0^Enter the sequence in which the reason should appear in the displayed list
"KRN",8989.51,434,20,0)
^8989.512^2^2^3061020^^^
"KRN",8989.51,434,20,1,0)
This parameter allows sites to enter generic reason's for flagging 
"KRN",8989.51,434,20,2,0)
orders that the users can choose in the CPRS GUI.
"KRN",8989.51,434,30,0)
^8989.513I^1^1
"KRN",8989.51,434,30,1,0)
1^4.2
"KRN",8989.51,435,-1)
0^5
"KRN",8989.51,435,0)
OR LAPSE ORDERS^LAPSE UNSIGNED/UNRELEASED ORDER BY GROUP^1^ENTER A DISPLAY GROUP^NUMBER OF DAYS
"KRN",8989.51,435,1)
N^1:999^ENTER THE NUMBER OF DAYS TO KEEP UNSIGNED/UNRELEASED ORDERS BEFORE LAPSING THEM
"KRN",8989.51,435,4,0)
^8989.514^1^1
"KRN",8989.51,435,4,1,0)
LAPSE
"KRN",8989.51,435,4,"B","LAPSE",1)

"KRN",8989.51,435,6)
P^100.98^ENTER A DISPLAY GROUP
"KRN",8989.51,435,20,0)
^8989.512^12^12^3080404^^^^
"KRN",8989.51,435,20,1,0)
The purpose of this parameter is to store the number of days that old 
"KRN",8989.51,435,20,2,0)
orders will be lapsed.  This parameter is multi valued with an instance 
"KRN",8989.51,435,20,3,0)
term of DISPLAY GROUPS.  Thus the way it works is that you can set 
"KRN",8989.51,435,20,4,0)
"Display Group A" so that old orders from this display group will lapse 
"KRN",8989.51,435,20,5,0)
in 10 days for instance.  Then you could have "Display Group B" set so 
"KRN",8989.51,435,20,6,0)
that those orders would lapse when they are 20 days old. Display groups
"KRN",8989.51,435,20,7,0)
not individually set by this parameter are affected by the OR LAPSE 
"KRN",8989.51,435,20,8,0)
ORDERS DFLT parameter.
"KRN",8989.51,435,20,9,0)
 
"KRN",8989.51,435,20,10,0)
 
"KRN",8989.51,435,20,11,0)
By lapsing, it is meant that the order is placed in a LAPSED status.
"KRN",8989.51,435,20,12,0)
Also see the description for parameter OR LAPSE ORDERS DFLT.
"KRN",8989.51,435,30,0)
^8989.513I^2^2
"KRN",8989.51,435,30,1,0)
5^4
"KRN",8989.51,435,30,2,0)
10^4.2
"KRN",8989.51,436,-1)
0^6
"KRN",8989.51,436,0)
OR LAPSE ORDERS DFLT^LAPSE UNSIGNED/UNRELEASED ORDER DEFAULT^0^^NUMBER OF DAYS
"KRN",8989.51,436,1)
N^1:999^ENTER THE NUMBER OF DAYS TO KEEP UNSIGNED/UNRELEASED ORDERS BEFORE LAPSING THEM
"KRN",8989.51,436,20,0)
^8989.512^8^8^3080404^^^
"KRN",8989.51,436,20,1,0)
The purpose of this parameter is to store the number of days that old 
"KRN",8989.51,436,20,2,0)
orders will be lapsed when those orders are from a DISPLAY GROUP that 
"KRN",8989.51,436,20,3,0)
does not have parameter OR LAPSE ORDERS set.  The default value that is 
"KRN",8989.51,436,20,4,0)
set in this parameter will affect all orders that do not have a specific 
"KRN",8989.51,436,20,5,0)
DISPLAY GROUP value.  Thus if both "Display Group A" and "Display Group 
"KRN",8989.51,436,20,6,0)
B" have parameter OR LAPSE ORDERS set for them but "Display Group C" does 
"KRN",8989.51,436,20,7,0)
not, then orders from "Display Group C" will get lapsed in the number of 
"KRN",8989.51,436,20,8,0)
days specified in OR LAPSE ORDERS DFLT.
"KRN",8989.51,436,30,0)
^8989.513I^2^2
"KRN",8989.51,436,30,1,0)
10^4.2
"KRN",8989.51,436,30,2,0)
5^4
"KRN",8989.51,438,-1)
0^7
"KRN",8989.51,438,0)
OR CLOZ INPT MSG^MSG TO DISPLAY ON INPT ORD OF CLOZAPINE^0^FREE TEXT^MSG TO DISPLAY ON INPT ORD OF CLOZAPINE
"KRN",8989.51,438,1)
W^^Enter a message to display when an Inpat. Order of Clozapine is made
"KRN",8989.51,438,6)
F
"KRN",8989.51,438,20,0)
^8989.512^6^6^3080110^^
"KRN",8989.51,438,20,1,0)
This parameter allows sites to set what text they would like for users to 
"KRN",8989.51,438,20,2,0)
see when an inpatient order of Clozapine is made.  This drug is generally 
"KRN",8989.51,438,20,3,0)
ordered in an outpatient setting and thus is subject to the special order 
"KRN",8989.51,438,20,4,0)
appropriateness checks.  However, when ordered in an inpatient setting 
"KRN",8989.51,438,20,5,0)
these checks are not done.  Thus sites should determine a policy to 
"KRN",8989.51,438,20,6,0)
handle this and provide instructions to users based on that policy.
"KRN",8989.51,438,30,0)
^8989.513I^1^1
"KRN",8989.51,438,30,1,0)
6^4.2
"KRN",8989.51,450,-1)
0^11
"KRN",8989.51,450,0)
ORWLR LC CHANGED TO WC^MESSAGE FOR LC CHANGED TO WC^0
"KRN",8989.51,450,1)
F^^Enter up to 80 characters of instructions to the user.
"KRN",8989.51,450,2)
K:($L(X)>80) X
"KRN",8989.51,450,6)
F
"KRN",8989.51,450,20,0)
^^3^3^3070703^
"KRN",8989.51,450,20,1,0)
When the system automatically changes lab collect orders to ward collect, 
"KRN",8989.51,450,20,2,0)
provides instructions to the user regarding specimen collection for those 
"KRN",8989.51,450,20,3,0)
changed orders.
"KRN",8989.51,450,30,0)
^8989.513I^5^5
"KRN",8989.51,450,30,1,0)
5^44
"KRN",8989.51,450,30,2,0)
10^49
"KRN",8989.51,450,30,3,0)
15^4
"KRN",8989.51,450,30,4,0)
20^4.2
"KRN",8989.51,450,30,5,0)
25^9.4
"KRN",8989.51,451,-1)
0^12
"KRN",8989.51,451,0)
OR VBECS SUPPRESS NURS ADMIN^Suppress Nursing Admin Prompt^^^Suppress Nursing Admin Prompt
"KRN",8989.51,451,1)
Y^^Enter 'Yes' if you wish to suppress the Nursing Admin Order Prompt
"KRN",8989.51,451,20,0)
^^4^4^3070906^
"KRN",8989.51,451,20,1,0)
This parameter disables the prompt/pop-up that tells the user they must
"KRN",8989.51,451,20,2,0)
enter a Nursing Administration Order manually after entering a VBECS
"KRN",8989.51,451,20,3,0)
Blood order.  Disabling this feature is usually done when a Nursing
"KRN",8989.51,451,20,4,0)
Administration order has been created and added to a VBECS order set.
"KRN",8989.51,451,30,0)
^8989.513I^3^3
"KRN",8989.51,451,30,1,0)
10^9.4
"KRN",8989.51,451,30,2,0)
5^4.2
"KRN",8989.51,451,30,3,0)
3^4
"KRN",8989.51,453,-1)
0^13
"KRN",8989.51,453,0)
OR USE MH DLL^Use MH DLL?^0^SET OF CODES^Use MH DLL?
"KRN",8989.51,453,1)
S^0:NO;1:YES^Enter No to not use the MH DLL in a Reminder Dialog.
"KRN",8989.51,453,20,0)
^^5^5^3080201^
"KRN",8989.51,453,20,1,0)
This parameter allows sites to stop CPRS from using the MH DLL when 
"KRN",8989.51,453,20,2,0)
processing a MH test in a Reminder Dialog.
"KRN",8989.51,453,20,3,0)
 
"KRN",8989.51,453,20,4,0)
The default for this parameter is Y. This parameter should only be set to 
"KRN",8989.51,453,20,5,0)
N if the site is having problems with CPRS and the MH DLL.
"KRN",8989.51,453,30,0)
^8989.513I^1^1
"KRN",8989.51,453,30,1,0)
6^4.2
"KRN",8989.51,465,-1)
0^14
"KRN",8989.51,465,0)
OR RA RFS CARRY ON^OR RA RFS CARRY ON^0
"KRN",8989.51,465,1)
Y^^Enter yes or no for whether to carry on the value of Reason for Study
"KRN",8989.51,465,20,0)
^^5^5^3080410^
"KRN",8989.51,465,20,1,0)
This value will determine if CPRS will carry on the text entered in the 
"KRN",8989.51,465,20,2,0)
Reason for Study field of the Radiology (Imaging) order dialog.  By carry 
"KRN",8989.51,465,20,3,0)
on, it is meant that when one order is entered the value entered in the 
"KRN",8989.51,465,20,4,0)
Reason for Study field will be held and used again in subsequent 
"KRN",8989.51,465,20,5,0)
Radiology orders.
"KRN",8989.51,465,30,0)
^8989.513I^1^1
"KRN",8989.51,465,30,1,0)
10^4.2
"KRN",8989.51,466,-1)
0^15
"KRN",8989.51,466,0)
ORWDXVB VBECS TNS CHECK^Days to check for Type & Screen^^^# of Days
"KRN",8989.51,466,1)
N^^Enter the number of days to check for a Type & Screen Order
"KRN",8989.51,466,20,0)
^^3^3^3080507^
"KRN",8989.51,466,20,1,0)
This is used in the VBECS Order Dialog to check for recent orders for a
"KRN",8989.51,466,20,2,0)
Type & Screen order.  The default is 3 days, but a site can override this
"KRN",8989.51,466,20,3,0)
number by setting this parameter to something different.
"KRN",8989.51,466,30,0)
^8989.513I^2^2
"KRN",8989.51,466,30,1,0)
7^4
"KRN",8989.51,466,30,2,0)
8^4.2
"KRN",8989.51,471,-1)
0^16
"KRN",8989.51,471,0)
OR VBECS ON^VBECS Functionality Site Enabled^^^Yes/No
"KRN",8989.51,471,1)
Y^Y:yes;N:no^Enter 'yes' to turn on VBECS at site.
"KRN",8989.51,471,20,0)
^8989.512^1^1^3080606^^^^
"KRN",8989.51,471,20,1,0)
'Yes' indicates that VBECS functionality is enabled.
"KRN",8989.51,471,30,0)
^8989.513I^4^3
"KRN",8989.51,471,30,2,0)
2^4
"KRN",8989.51,471,30,3,0)
3^4.2
"KRN",8989.51,471,30,4,0)
1^9.4
"KRN",8989.51,4767,-1)
1^17
"KRN",8989.51,4767,0)
ORWRP VISTAWEB
"KRN",8994,300,-1)
0^3
"KRN",8994,300,0)
ORWPS ACTIVE^ACTIVE^ORWPS^2
"KRN",8994,300,1,0)
^8994.01^2^2^3080211^^^^
"KRN",8994,300,1,1,0)
Returns listing of a patient's active inpatient and outpatient
"KRN",8994,300,1,2,0)
medications.
"KRN",8994,300,2,0)
^8994.02A^4^4
"KRN",8994,300,2,1,0)
DFN^1^^1^1
"KRN",8994,300,2,2,0)
USER^1^^1^2
"KRN",8994,300,2,3,0)
VIEW^1^^1^3
"KRN",8994,300,2,4,0)
UPDATE^1^^0^4
"KRN",8994,300,2,4,1,0)
^^3^3^3080211^
"KRN",8994,300,2,4,1,1,0)
This parameter is use to determine if the parameter that stored the user 
"KRN",8994,300,2,4,1,2,0)
view preference is updated. This should be set to 1 if called from CPRS 
"KRN",8994,300,2,4,1,3,0)
and set to 0 if called from another application.
"KRN",8994,300,2,"B","DFN",1)

"KRN",8994,300,2,"B","UPDATE",4)

"KRN",8994,300,2,"B","USER",2)

"KRN",8994,300,2,"B","VIEW",3)

"KRN",8994,300,2,"PARAMSEQ",1,1)

"KRN",8994,300,2,"PARAMSEQ",2,2)

"KRN",8994,300,2,"PARAMSEQ",3,3)

"KRN",8994,300,2,"PARAMSEQ",4,4)

"KRN",8994,326,-1)
0^13
"KRN",8994,326,0)
ORWDPS32 DLGSLCT^DLGSLCT^ORWDPS32^2
"KRN",8994,326,1,0)
^8994.01^1^1^3060928^^
"KRN",8994,326,1,1,0)
Returns default lists for order dialogs in CPRS GUI.
"KRN",8994,326,2,0)
^8994.02A^3^3
"KRN",8994,326,2,1,0)
PSTYPE^1^^1^1
"KRN",8994,326,2,1,1,0)
^^1^1^3060928^
"KRN",8994,326,2,1,1,1,0)
Code to determine the Dialog Type
"KRN",8994,326,2,2,0)
DFN^1^^1^2
"KRN",8994,326,2,3,0)
LOCIEN^1^^1^3
"KRN",8994,326,2,3,1,0)
^^1^1^3060928^
"KRN",8994,326,2,3,1,1,0)
This will be set to the patient inpatient location IEN from file 44.
"KRN",8994,326,2,"B","DFN",2)

"KRN",8994,326,2,"B","LOCIEN",3)

"KRN",8994,326,2,"B","PSTYPE",1)

"KRN",8994,326,2,"PARAMSEQ",1,1)

"KRN",8994,326,2,"PARAMSEQ",2,2)

"KRN",8994,326,2,"PARAMSEQ",3,3)

"KRN",8994,336,-1)
0^18
"KRN",8994,336,0)
ORWDPS32 DRUGMSG^DRUGMSG^ORWDPS33^1
"KRN",8994,336,1,0)
^^1^1^3000104^
"KRN",8994,336,1,1,0)
Return message text that is associated with a dispense drug.
"KRN",8994,337,-1)
0^22
"KRN",8994,337,0)
ORWDPS32 MEDISIV^MEDISIV^ORWDPS33^1
"KRN",8994,337,1,0)
^^1^1^3000104^
"KRN",8994,337,1,1,0)
Return 1 if orderable item is an IV medication, otherwise return 0.
"KRN",8994,338,-1)
0^19
"KRN",8994,338,0)
ORWDPS32 FORMALT^FORMALT^ORWDPS33^2
"KRN",8994,338,1,0)
^^1^1^3000104^
"KRN",8994,338,1,1,0)
Return a list of formulary alternatives.
"KRN",8994,371,-1)
0^12
"KRN",8994,371,0)
ORWDX2 DCREASON^DCREASON^ORWDX2^2
"KRN",8994,371,1,0)
^8994.01^1^1^3060926^^
"KRN",8994,371,1,1,0)
RPC to return a list of valid discontinuation reasons.
"KRN",8994,378,-1)
0^23
"KRN",8994,378,0)
ORWDPS32 SCSTS^SCSTS^ORWDPS33^1
"KRN",8994,378,1,0)
^^1^1^3000104^
"KRN",8994,378,1,1,0)
Return pharmacy-related service connected eligibility for a patient.
"KRN",8994,391,-1)
0^66
"KRN",8994,391,0)
ORWDX LOADRSP^LOADRSP^ORWDX^2
"KRN",8994,391,2,0)
^8994.02A^2^2
"KRN",8994,391,2,1,0)
RSPID^1^^^1
"KRN",8994,391,2,2,0)
TRANS^1^^^2
"KRN",8994,391,2,"B","RSPID",1)

"KRN",8994,391,2,"B","TRANS",2)

"KRN",8994,391,2,"PARAMSEQ",1,1)

"KRN",8994,391,2,"PARAMSEQ",2,2)

"KRN",8994,494,-1)
0^21
"KRN",8994,494,0)
ORWDPS32 IVAMT^IVAMT^ORWDPS33^1
"KRN",8994,494,1,0)
^^1^1^3000104^
"KRN",8994,494,1,1,0)
Returns return UNITS^AMOUNT |^AMOUNT^AMOUNT...| for IV solutions.
"KRN",8994,495,-1)
0^25
"KRN",8994,495,0)
ORWDPS32 VALRATE^VALRATE^ORWDPS33^1
"KRN",8994,495,1,0)
^^1^1^3000104^
"KRN",8994,495,1,1,0)
Return a 1 if IV rate text is valid, otherwise return 0.
"KRN",8994,517,-1)
0^20
"KRN",8994,517,0)
ORWDPS32 ISSPLY^ISSPLY^ORWDPS33^1
"KRN",8994,517,1,0)
^^1^1^3000104^
"KRN",8994,517,1,1,0)
Return 1 if orderable item is a supply, otherwise return 0.
"KRN",8994,537,-1)
0^26
"KRN",8994,537,0)
ORWDPS32 VALSCH^VALSCH^ORWDPS33^1
"KRN",8994,537,1,0)
^^1^1^3000104^
"KRN",8994,537,1,1,0)
Validate a schedule and return a 1 if it is valid, otherwise return 0.
"KRN",8994,538,-1)
0^24
"KRN",8994,538,0)
ORWDPS32 VALQTY^VALQTY^ORWDPS33^1
"KRN",8994,538,1,0)
^^2^2^3000104^
"KRN",8994,538,1,1,0)
Validate a medication quantity and return a 1 if it is valid, otherwise
"KRN",8994,538,1,2,0)
return 0.
"KRN",8994,576,-1)
0^57
"KRN",8994,576,0)
ORWDXM1 BLDQRSP^BLDQRSP^ORWDXM1^2
"KRN",8994,576,1,0)
^8994.01^10^10^3070426^^
"KRN",8994,576,1,1,0)
Build responses for an order
"KRN",8994,576,1,2,0)
 
"KRN",8994,576,1,3,0)
Input:
"KRN",8994,576,1,4,0)
      1   2    3    4   5   6    7    8        11-20
"KRN",8994,576,1,5,0)
FLDS=DFN^LOC^ORNP^INPT^SEX^AGE^EVENT^SC%^^^Key Variables...
"KRN",8994,576,1,6,0)
ORIT=+ORIT: ptr to 101.41, $E(ORIT)=C: copy $E(ORIT)=X: change
"KRN",8994,576,1,7,0)
 
"KRN",8994,576,1,8,0)
Output:
"KRN",8994,576,1,9,0)
LST=QuickLevel^ResponseID(ORIT;$H)^Dialog^Type^FormID^DGrp
"KRN",8994,576,1,10,0)
LST(n)=verify text or rejection text
"KRN",8994,576,2,0)
^8994.02A^2^2
"KRN",8994,576,2,1,0)
ISIMO^1^^1^3
"KRN",8994,576,2,1,1,0)
^^1^1^3070426^
"KRN",8994,576,2,1,1,1,0)
This determine if the order is an IMO order.
"KRN",8994,576,2,2,0)
ENCLOC^1^^1^4
"KRN",8994,576,2,2,1,0)
^^2^2^3070426^
"KRN",8994,576,2,2,1,1,0)
This passes the encounter location to the API. This is used for Admin 
"KRN",8994,576,2,2,1,2,0)
Times.
"KRN",8994,576,2,"B","ENCLOC",2)

"KRN",8994,576,2,"B","ISIMO",1)

"KRN",8994,576,2,"PARAMSEQ",3,1)

"KRN",8994,576,2,"PARAMSEQ",4,2)

"KRN",8994,612,-1)
0^17
"KRN",8994,612,0)
ORWDPS32 DOSES^DOSES^ORWDPS33^2
"KRN",8994,612,1,0)
^^1^1^3000104^
"KRN",8994,612,1,1,0)
Return doses for an orderable item.
"KRN",8994,620,-1)
0^67
"KRN",8994,620,0)
ORWORB AUTOUNFLAG ORDERS^UNFLORD^ORWORB^1
"KRN",8994,620,1,0)
^^1^1^3000105^
"KRN",8994,620,1,1,0)
Auto unflag orders/delete alert.
"KRN",8994,824,-1)
0^56
"KRN",8994,824,0)
ORWTPP SAVESURR^SAVESURR^ORWTPP^1^^^^1
"KRN",8994,885,-1)
0^8
"KRN",8994,885,0)
ORWDPS1 SCHALL^SCHALL^ORWDPS1^2
"KRN",8994,885,2,0)
^8994.02A^2^2
"KRN",8994,885,2,1,0)
DFN^1^^1^1
"KRN",8994,885,2,1,1,0)
^^1^1^3060908^
"KRN",8994,885,2,1,1,1,0)
Patient DFN
"KRN",8994,885,2,2,0)
LOCIEN^1^^1^2
"KRN",8994,885,2,2,1,0)
^^2^2^3060908^
"KRN",8994,885,2,2,1,1,0)
This is the inpatient location IEN from file 44, if a location is not 
"KRN",8994,885,2,2,1,2,0)
defined for the patient the value will be zero.
"KRN",8994,885,2,"B","DFN",1)

"KRN",8994,885,2,"B","LOCIEN",2)

"KRN",8994,885,2,"PARAMSEQ",1,1)

"KRN",8994,885,2,"PARAMSEQ",2,2)

"KRN",8994,1123,-1)
0^9
"KRN",8994,1123,0)
ORWTIU GET SAVED CP FIELDS^GETCP^ORWTIU^1
"KRN",8994,1123,1,0)
^^3^3^3060911^
"KRN",8994,1123,1,1,0)
Given a TIU document of the clinical procedures class, return the author, 
"KRN",8994,1123,1,2,0)
title, cosigner, procedure summary code, date/time of procedure, and 
"KRN",8994,1123,1,3,0)
reference date, as stored on the server.
"KRN",8994,1123,2,0)
^8994.02A^1^1
"KRN",8994,1123,2,1,0)
TIUDA^1^32^1
"KRN",8994,1123,2,1,1,0)
^8994.021^1^1^3060911^^
"KRN",8994,1123,2,1,1,1,0)
Pointer to file 8925 for the document.
"KRN",8994,1123,2,"B","TIUDA",1)

"KRN",8994,1123,3,0)
^^1^1^3060911^
"KRN",8994,1123,3,1,0)
AUTHOR^COSIGNER^PROCSUMMCODE^PROCDATE^DOCTITLE^REFDATE
"KRN",8994,2405,-1)
0^29
"KRN",8994,2405,0)
ORWGRPC ALLITEMS^ALLITEMS^ORWGRPC^4^^^^1
"KRN",8994,2406,-1)
0^53
"KRN",8994,2406,0)
ORWGRPC TYPES^TYPES^ORWGRPC^4^^^^1
"KRN",8994,2407,-1)
0^44
"KRN",8994,2407,0)
ORWGRPC ITEMS^ITEMS^ORWGRPC^4^^^^1
"KRN",8994,2408,-1)
0^30
"KRN",8994,2408,0)
ORWGRPC CLASS^CLASS^ORWGRPC^4^^^^1
"KRN",8994,2409,-1)
0^43
"KRN",8994,2409,0)
ORWGRPC ITEMDATA^ITEMDATA^ORWGRPC^4^^^^1
"KRN",8994,2410,-1)
0^40
"KRN",8994,2410,0)
ORWGRPC GETPREF^GETPREF^ORWGRPC^4^^^^1
"KRN",8994,2411,-1)
0^48
"KRN",8994,2411,0)
ORWGRPC SETPREF^SETPREF^ORWGRPC^4^^^^1
"KRN",8994,2412,-1)
0^42
"KRN",8994,2412,0)
ORWGRPC GETVIEWS^GETVIEWS^ORWGRPC^4^^^^1
"KRN",8994,2413,-1)
0^50
"KRN",8994,2413,0)
ORWGRPC SETVIEWS^SETVIEWS^ORWGRPC^4^^^^1
"KRN",8994,2414,-1)
0^32
"KRN",8994,2414,0)
ORWGRPC DELVIEWS^DELVIEWS^ORWGRPC^4^^^^1
"KRN",8994,2415,-1)
0^52
"KRN",8994,2415,0)
ORWGRPC TESTSPEC^TESTSPEC^ORWGRPC^4^^^^1
"KRN",8994,2416,-1)
0^45
"KRN",8994,2416,0)
ORWGRPC LOOKUP^LOOKUP^ORWGRPC^2^^^^1
"KRN",8994,2510,-1)
0^31
"KRN",8994,2510,0)
ORWGRPC DATEITEM^DATEITEM^ORWGRPC^4^^^^1
"KRN",8994,2543,-1)
0^39
"KRN",8994,2543,0)
ORWGRPC GETDATES^GETDATES^ORWGRPC^4^^^^1
"KRN",8994,2545,-1)
0^33
"KRN",8994,2545,0)
ORWGRPC DETAIL^DETAIL^ORWGRPC^4^^^^1
"KRN",8994,2546,-1)
0^34
"KRN",8994,2546,0)
ORWGRPC DETAILS^DETAILS^ORWGRPC^4^^^^1
"KRN",8994,2562,-1)
0^46
"KRN",8994,2562,0)
ORWGRPC PUBLIC^PUBLIC^ORWGRPC^1^^^^1
"KRN",8994,2572,-1)
0^47
"KRN",8994,2572,0)
ORWGRPC RPTPARAM^RPTPARAM^ORWGRPC^1^^^^1
"KRN",8994,2582,-1)
0^51
"KRN",8994,2582,0)
ORWGRPC TAX^TAX^ORWGRPC^4^^^^1
"KRN",8994,2865,-1)
0^41
"KRN",8994,2865,0)
ORWGRPC GETSIZE^GETSIZE^ORWGRPC^4^^^^1
"KRN",8994,2866,-1)
0^49
"KRN",8994,2866,0)
ORWGRPC SETSIZE^SETSIZE^ORWGRPC^4^^^^1
"KRN",8994,2881,-1)
0^1
"KRN",8994,2881,0)
ORWDX1 DCORIG^DCORIG^ORWDX1^1
"KRN",8994,2881,2,0)
^8994.02A^1^1
"KRN",8994,2881,2,1,0)
ORIEN^1^^1^1
"KRN",8994,2881,2,"B","ORIEN",1)

"KRN",8994,2881,2,"PARAMSEQ",1,1)

"KRN",8994,2882,-1)
0^2
"KRN",8994,2882,0)
ORWDX1 UNDCORIG^UNDCORIG^ORWDX1^2
"KRN",8994,2882,2,0)
^8994.02A^1^1
"KRN",8994,2882,2,1,0)
ORYARR^2
"KRN",8994,2882,2,"B","ORYARR",1)

"KRN",8994,2883,-1)
0^4
"KRN",8994,2883,0)
ORCDLR2 CHECK ONE LC TO WC^KIDS^ORCDLR2^2
"KRN",8994,2896,-1)
0^5
"KRN",8994,2896,0)
ORCDLR2 CHECK ALL LC TO WC^GUI^ORCDLR2^2
"KRN",8994,2920,-1)
0^15
"KRN",8994,2920,0)
ORALWORD ALLWORD^ALLWORD^ORALWORD^2
"KRN",8994,2920,2,0)
^8994.02A^4^4
"KRN",8994,2920,2,1,0)
DFN^1^^1^1
"KRN",8994,2920,2,2,0)
OROI^1^^1^2
"KRN",8994,2920,2,3,0)
ORX^1^^1^3
"KRN",8994,2920,2,4,0)
ORTYPE^1^^1^4
"KRN",8994,2920,2,"B","DFN",1)

"KRN",8994,2920,2,"B","OROI",2)

"KRN",8994,2920,2,"B","ORTYPE",4)

"KRN",8994,2920,2,"B","ORX",3)

"KRN",8994,2920,2,"PARAMSEQ",1,1)

"KRN",8994,2920,2,"PARAMSEQ",2,2)

"KRN",8994,2920,2,"PARAMSEQ",3,3)

"KRN",8994,2920,2,"PARAMSEQ",4,4)

"KRN",8994,2926,-1)
0^7
"KRN",8994,2926,0)
ORWDX1 ORDMATCH^ORDMATCH^ORWDX1^1
"KRN",8994,2926,1,0)
^^2^2^3060629^
"KRN",8994,2926,1,1,0)
This RPC will accept a list of orders and each order status, if one of 
"KRN",8994,2926,1,2,0)
the order does not have a status it will return a false value.
"KRN",8994,2926,2,0)
^8994.02A^2^2
"KRN",8994,2926,2,1,0)
DFN^1^^1^1
"KRN",8994,2926,2,2,0)
ORYARR^2^^1
"KRN",8994,2926,2,"B","DFN",1)

"KRN",8994,2926,2,"B","ORYARR",2)

"KRN",8994,2926,2,"PARAMSEQ",1,1)

"KRN",8994,2941,-1)
0^10
"KRN",8994,2941,0)
ORWDXVB SUBCHK^SUBCHK^ORWDXVB^1
"KRN",8994,2941,1,0)
^^1^1^3060914^
"KRN",8994,2941,1,1,0)
Check to see if selected test is a Blood Component or a Diagnostic Test.
"KRN",8994,2955,-1)
0^11
"KRN",8994,2955,0)
ORDDPAPI ADMTIME^ADMTIME^ORDDPAPI^3^^^^1
"KRN",8994,2955,2,0)
^8994.02A^^0
"KRN",8994,2955,3,0)
^8994.03^1^1^3060919^^^^
"KRN",8994,2955,3,1,0)
Returns the text of the OR ADMIN TIME HELP TEXT parameter.
"KRN",8994,2958,-1)
0^14
"KRN",8994,2958,0)
ORWU PARAMS^PARAMS^ORWU^2
"KRN",8994,2958,1,0)
^^9^9^3061002^
"KRN",8994,2958,1,1,0)
Simple call to return a list of parameter values such as:
"KRN",8994,2958,1,2,0)
 
"KRN",8994,2958,1,3,0)
        INST1^VALUE1
"KRN",8994,2958,1,4,0)
        INST2^VALUE2
"KRN",8994,2958,1,5,0)
        ...
"KRN",8994,2958,1,6,0)
        INSTN^VALUEN
"KRN",8994,2958,1,7,0)
 
"KRN",8994,2958,1,8,0)
The call assumes the current user, 'defaultable' entities and multiple 
"KRN",8994,2958,1,9,0)
instances.
"KRN",8994,2979,-1)
0^16
"KRN",8994,2979,0)
ORWDPS1 DOWSCH^DOWSCH^ORWDPS1^2
"KRN",8994,2979,1,0)
^8994.01^2^2^3070424^^^
"KRN",8994,2979,1,1,0)
This RPC returns a list of schedule that have a frequency defined and the 
"KRN",8994,2979,1,2,0)
frequency is less then or equal to 1440 minutes
"KRN",8994,2979,2,0)
^8994.02A^2^2
"KRN",8994,2979,2,1,0)
DFN^1^^1^1
"KRN",8994,2979,2,2,0)
LOCIEN^1^^1^2
"KRN",8994,2979,2,2,1,0)
^8994.021^1^1^3070424^^
"KRN",8994,2979,2,2,1,1,0)
This is the Location IEN from file 44
"KRN",8994,2979,2,"B","DFN",1)

"KRN",8994,2979,2,"B","LOCIEN",2)

"KRN",8994,2979,2,"PARAMSEQ",1,1)

"KRN",8994,2979,2,"PARAMSEQ",2,2)

"KRN",8994,2986,-1)
0^27
"KRN",8994,2986,0)
ORDDPAPI CLOZMSG^CLOZMSG^ORDDPAPI^3^^^^1
"KRN",8994,2986,3,0)
^^2^2^3061211^
"KRN",8994,2986,3,1,0)
Returns the text of the OR CLOZ INPT MSG parameter used to display to the 
"KRN",8994,2986,3,2,0)
user if it is set when entering an inpatient clozapine order.
"KRN",8994,2999,-1)
0^28
"KRN",8994,2999,0)
ORWDPS33 COMPLOC^COMPLOC^ORWDPS33^1
"KRN",8994,2999,1,0)
^^2^2^3061229^
"KRN",8994,2999,1,1,0)
This RPC will return a 0 if the patient location is the same location as 
"KRN",8994,2999,1,2,0)
the original order. It will return a 1 if the location is different.
"KRN",8994,2999,2,0)
^8994.02A^2^2
"KRN",8994,2999,2,1,0)
ORID^1^^1^1
"KRN",8994,2999,2,1,1,0)
^^1^1^3061229^
"KRN",8994,2999,2,1,1,1,0)
This is the IEN of the original order from file 100
"KRN",8994,2999,2,2,0)
LOC^1^^1^2
"KRN",8994,2999,2,2,1,0)
^^1^1^3061229^
"KRN",8994,2999,2,2,1,1,0)
This is the encounter location the order is being written for.
"KRN",8994,2999,2,"B","LOC",2)

"KRN",8994,2999,2,"B","ORID",1)

"KRN",8994,2999,2,"PARAMSEQ",1,1)

"KRN",8994,2999,2,"PARAMSEQ",2,2)

"KRN",8994,3000,-1)
0^36
"KRN",8994,3000,0)
ORWGRPC FASTITEM^FASTITEM^ORWGRPC^4^^^^1
"KRN",8994,3001,-1)
0^35
"KRN",8994,3001,0)
ORWGRPC FASTDATA^FASTDATA^ORWGRPC^4^^^^1
"KRN",8994,3002,-1)
0^38
"KRN",8994,3002,0)
ORWGRPC FASTTASK^FASTTASK^ORWGRPC^1^^^^1
"KRN",8994,3003,-1)
0^37
"KRN",8994,3003,0)
ORWGRPC FASTLABS^FASTLABS^ORWGRPC^4^^^^1
"KRN",8994,3004,-1)
0^54
"KRN",8994,3004,0)
ORWDPS1 QOMEDALT^QOMEDALT^ORWDPS1^1
"KRN",8994,3004,2,0)
^8994.02A^1^1
"KRN",8994,3004,2,1,0)
ODIEN^1^^1^1
"KRN",8994,3004,2,"B","ODIEN",1)

"KRN",8994,3004,2,"PARAMSEQ",1,1)

"KRN",8994,3005,-1)
0^55
"KRN",8994,3005,0)
ORWGRPC ALLVIEWS^ALLVIEWS^ORWGRPC^4^^^^1
"KRN",8994,3012,-1)
0^58
"KRN",8994,3012,0)
ORWGRPC TESTING^TESTING^ORWGRPC^4^^^^1
"KRN",8994,3030,-1)
0^59
"KRN",8994,3030,0)
ORQQPXRM MHDLL^MHDLL^ORQQPXRM^2
"KRN",8994,3030,2,0)
^8994.02A^4^2
"KRN",8994,3030,2,3,0)
DFN^1^^1^1
"KRN",8994,3030,2,4,0)
INPUTS^1^^1^2
"KRN",8994,3030,2,"B","DFN",3)

"KRN",8994,3030,2,"B","INPUTS",4)

"KRN",8994,3030,2,"PARAMSEQ",1,3)

"KRN",8994,3030,2,"PARAMSEQ",2,4)

"KRN",8994,3034,-1)
0^60
"KRN",8994,3034,0)
ORWDLR33 LC TO WC^LCTOWC^ORWDLR33^1
"KRN",8994,3034,2,0)
^8994.02A^1^1
"KRN",8994,3034,2,1,0)
LOCATION^1^32^1^1
"KRN",8994,3034,2,"B","LOCATION",1)

"KRN",8994,3034,2,"PARAMSEQ",1,1)

"KRN",8994,3036,-1)
0^61
"KRN",8994,3036,0)
ORWU2 COSIGNER^COSIGNER^ORWU2^2^^^^1
"KRN",8994,3036,1,0)
^8994.01^2^2^3070827^^^
"KRN",8994,3036,1,1,0)
Returns a set of New Person file entries for use in a long list box.
"KRN",8994,3036,1,2,0)
The set is limited to USR PROVIDERS who do not require cosignature.
"KRN",8994,3036,2,0)
^8994.02A^5^5
"KRN",8994,3036,2,1,0)
ORDATE^1^^^1
"KRN",8994,3036,2,1,1,0)
^^1^1^3070821^
"KRN",8994,3036,2,1,1,1,0)
Fileman date that the user will be required to be active on. (optional)
"KRN",8994,3036,2,2,0)
ORDIR^1^^1^2
"KRN",8994,3036,2,2,1,0)
^^1^1^3070821^
"KRN",8994,3036,2,2,1,1,0)
Direction to move through the #200 x-ref with $O.
"KRN",8994,3036,2,3,0)
ORFROM^1^^^3
"KRN",8994,3036,2,3,1,0)
^8994.021^1^1^3070821^^
"KRN",8994,3036,2,3,1,1,0)
Starting name for this set.
"KRN",8994,3036,2,4,0)
ORTIUTYP^1^^1^4
"KRN",8994,3036,2,4,1,0)
^8994.021^1^1^3070821^^
"KRN",8994,3036,2,4,1,1,0)
is + of the 0 node of the 8925 docmt
"KRN",8994,3036,2,5,0)
ORTIUDA^1^^1^5
"KRN",8994,3036,2,5,1,0)
^8994.021^1^1^3070821^^
"KRN",8994,3036,2,5,1,1,0)
This is the record # of the TIU Document in file 8925.
"KRN",8994,3036,2,"B","ORDATE",1)

"KRN",8994,3036,2,"B","ORDIR",2)

"KRN",8994,3036,2,"B","ORFROM",3)

"KRN",8994,3036,2,"B","ORTIUDA",5)

"KRN",8994,3036,2,"B","ORTIUTYP",4)

"KRN",8994,3036,2,"PARAMSEQ",1,1)

"KRN",8994,3036,2,"PARAMSEQ",2,2)

"KRN",8994,3036,2,"PARAMSEQ",3,3)

"KRN",8994,3036,2,"PARAMSEQ",4,4)

"KRN",8994,3036,2,"PARAMSEQ",5,5)

"KRN",8994,3036,3,0)
^8994.03^1^1^3070827^^^
"KRN",8994,3036,3,1,0)
ORY is a an array or list to user names 
"KRN",8994,3039,-1)
0^62
"KRN",8994,3039,0)
ORWDXVB NURSADMN^NURSADMN^ORWDXVB^1
"KRN",8994,3039,1,0)
^^3^3^3070906^
"KRN",8994,3039,1,1,0)
This procedure checks the parameter OR VBECS SUPPRESS NURS ADMIN to see
"KRN",8994,3039,1,2,0)
if the Nursing Administration Order prompt/pop-up should be supressed
"KRN",8994,3039,1,3,0)
after a VBECS Blood Bank order has been created.
"KRN",8994,3042,-1)
0^63
"KRN",8994,3042,0)
ORQQPXRM MHDLLDMS^MHDLLDMS^ORQQPXRM^1
"KRN",8994,3042,3,0)
^^2^2^3070913^
"KRN",8994,3042,3,1,0)
This RPC returns a value to determine if the MH dll is missing from the 
"KRN",8994,3042,3,2,0)
system. This is based off patches being installed and a parameter.
"KRN",8994,3043,-1)
0^65
"KRN",8994,3043,0)
ORWDPS32 ALLIVRTE^ALLIVRTE^ORWDPS32^2
"KRN",8994,3044,-1)
0^64
"KRN",8994,3044,0)
ORWDPS33 IVDOSFRM^IVDOSFRM^ORWDPS33^2
"KRN",8994,3044,2,0)
^8994.02A^3^3
"KRN",8994,3044,2,1,0)
ORDERIDS^2^^1^1
"KRN",8994,3044,2,2,0)
DEFAULTS^1^^1^2
"KRN",8994,3044,2,3,0)
ALLIV^1^^1^3
"KRN",8994,3044,2,"B","ALLIV",3)

"KRN",8994,3044,2,"B","DEFAULTS",2)

"KRN",8994,3044,2,"B","ORDERIDS",1)

"KRN",8994,3044,2,"PARAMSEQ",1,1)

"KRN",8994,3044,2,"PARAMSEQ",2,2)

"KRN",8994,3044,2,"PARAMSEQ",3,3)

"KRN",8994,3121,-1)
0^68
"KRN",8994,3121,0)
ORWDXM1 SVRPC^SVRPC^ORWDXM1^1
"KRN",8994,3124,-1)
0^69
"KRN",8994,3124,0)
ORWDXVB VBTNS^VBTNS^ORWDXVB^1
"KRN",8994,3128,-1)
1^70
"KRN",8994,3128,0)
ORWCIRN VISTAWEB
"KRN",8994,3129,-1)
1^71
"KRN",8994,3129,0)
ORWCIRN WEBCH
"MBREQ")
1
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"ORD",1,9.2)
9.2;1;;;HELP^XPDTA1;HLPF1^XPDIA1;HLPE1^XPDIA1;HLPF2^XPDIA1;;HLPDEL^XPDIA1
"ORD",1,9.2,0)
HELP FRAME
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PGL",101.24,0,13,.13)
RPC^P8994'^XWB(8994,^0;13^Q
"PGL",101.24,0,18,.18)
DETAIL REPORT^*P101.24'^ORD(101.24,^0;18^S DIC("S")="I $P(^(0),""^"",8)=""CD""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"PGL",101.24,0,21,.192)
REPORT COMPONENT^P142.1'^GMT(142.1,^0;21^Q
"PGL",101.41,0,5,5)
DISPLAY GROUP^P100.98'^ORD(100.98,^0;5^Q
"PGL",101.41,0,7,7)
PACKAGE^P9.4'^DIC(9.4,^0;7^Q
"PGL",101.41,5,9,59)
URL^P101.14^ORD(101.14,^5;9^Q
"PGL",101.412,0,2,2)
ITEM^P101.41'X^ORD(101.41,^0;2^D TREE^ORDD41
"PGL",101.412,0,11,1)
PARENT^P101.41'^ORD(101.41,^0;11^Q
"PGL",101.415,0,2,2)
ITEM^P101.41'^ORD(101.41,^0;2^Q
"PGL",101.416,0,2,.02)
DIALOG^P101.41'^ORD(101.41,^0;2^Q
"PKG",22,-1)
1^1
"PKG",22,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",22,20,0)
^9.402P^^
"PKG",22,22,0)
^9.49I^1^1
"PKG",22,22,1,0)
3.0^2971217^2980204^64
"PKG",22,22,1,"PAH",1,0)
243^3080618^4600
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
210
"RTN","OCXOCMP")
0^196^B41613467
"RTN","OCXOCMP",1,0)
OCXOCMP ;SLC/RJS,CLA - ORDER CHECK CODE COMPILER (Main Entry point - All Rules) ;3/21/01  08:50
"RTN","OCXOCMP",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**32,105,243**;Dec 17,1997;Build 242
"RTN","OCXOCMP",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","OCXOCMP",4,0)
 ;
"RTN","OCXOCMP",5,0)
EN ;
"RTN","OCXOCMP",6,0)
 ;
"RTN","OCXOCMP",7,0)
 N OCXQ
"RTN","OCXOCMP",8,0)
 ;
"RTN","OCXOCMP",9,0)
 S OCXQ=$$READ("Y","Do you want to queue the compiler to run ","NO") Q:(OCXQ[U)  I OCXQ D  Q
"RTN","OCXOCMP",10,0)
 .D QUE^OCXOCMPV(10)
"RTN","OCXOCMP",11,0)
 .W !!,"Expert system compiler queued to run in 10 seconds."
"RTN","OCXOCMP",12,0)
 .W !,"You will be sent a Mailman bulletin when it has finished.",!!
"RTN","OCXOCMP",13,0)
 .H 2
"RTN","OCXOCMP",14,0)
 ;
"RTN","OCXOCMP",15,0)
MAN K ZTSK D MAN^OCXOCMPV Q  ;  Run the compiler (interactive/manual mode)
"RTN","OCXOCMP",16,0)
 ;                        ;  Ask for option settings.
"RTN","OCXOCMP",17,0)
 ;
"RTN","OCXOCMP",18,0)
AUTO D AUTO^OCXOCMPV Q  ; Run the compiler (Automatic mode)
"RTN","OCXOCMP",19,0)
 ;                  ; Program Execution Trace Mode OFF
"RTN","OCXOCMP",20,0)
 ;                  ; Elapsed time logging OFF
"RTN","OCXOCMP",21,0)
 ;                  ; Raw Data Logging OFF
"RTN","OCXOCMP",22,0)
 ;
"RTN","OCXOCMP",23,0)
QUE D QUE^OCXOCMPV(10) Q  ; Queue the compiler to run in the background
"RTN","OCXOCMP",24,0)
 ;                     ;  Uses option setting from last compile.
"RTN","OCXOCMP",25,0)
 ;                     ;   If no last compile then all options are
"RTN","OCXOCMP",26,0)
 ;                     ;    turned OFF as in Automatic mode.
"RTN","OCXOCMP",27,0)
RUN ;
"RTN","OCXOCMP",28,0)
 ;
"RTN","OCXOCMP",29,0)
 N OCX1,OCX2,OCX3,OCX4
"RTN","OCXOCMP",30,0)
 ;
"RTN","OCXOCMP",31,0)
 D:($G(OCXAUTO)<2) STATUS^OCXOPOST(1,20)
"RTN","OCXOCMP",32,0)
 ;
"RTN","OCXOCMP",33,0)
 D MESG("Build list of Active Rules, Elements and Datafields...")
"RTN","OCXOCMP",34,0)
 D SETFLAG^OCXOCMPV ; H 1
"RTN","OCXOCMP",35,0)
 I $$EN^OCXOCMP9 D ERMESG("Compiler Aborted while building list of Rules, Elements and Datafields...") Q
"RTN","OCXOCMP",36,0)
 Q:$G(OCXWARN)
"RTN","OCXOCMP",37,0)
 ;
"RTN","OCXOCMP",38,0)
 D:($G(OCXAUTO)<2) STATUS^OCXOPOST(2,20)
"RTN","OCXOCMP",39,0)
 ;
"RTN","OCXOCMP",40,0)
 S OCX1="" F  S OCX1=$O(^TMP("OCXCMP",$J,OCX1)) Q:'$L(OCX1)  D
"RTN","OCXOCMP",41,0)
 .S OCX2=0 F OCX3=0:1 S OCX2=$O(^TMP("OCXCMP",$J,OCX1,OCX2)) Q:'OCX2
"RTN","OCXOCMP",42,0)
 .D MESG("  "_$J(OCX3,5)_" "_OCX1_$S(OCX3=1:"",1:"S"))
"RTN","OCXOCMP",43,0)
 ;
"RTN","OCXOCMP",44,0)
 D:($G(OCXAUTO)<2) STATUS^OCXOPOST(3,20)
"RTN","OCXOCMP",45,0)
 ;
"RTN","OCXOCMP",46,0)
 D MESG("Compile DataField Navigation code...")
"RTN","OCXOCMP",47,0)
 D SETFLAG^OCXOCMPV ; H 1
"RTN","OCXOCMP",48,0)
 I $$EN^OCXOCMP1 D ERMESG("Compiler Aborted due to Datafield syntax errors...") Q
"RTN","OCXOCMP",49,0)
 Q:$G(OCXWARN)
"RTN","OCXOCMP",50,0)
 ;
"RTN","OCXOCMP",51,0)
 D:($G(OCXAUTO)<2) STATUS^OCXOPOST(4,20)
"RTN","OCXOCMP",52,0)
 ;
"RTN","OCXOCMP",53,0)
 S (OCX3,OCX1)=0 F  S OCX1=$O(^TMP("OCXCMP",$J,"DATA FIELD",OCX1)) Q:'OCX1  D
"RTN","OCXOCMP",54,0)
 .S OCX2=0 F  S OCX2=$O(^TMP("OCXCMP",$J,"DATA FIELD",OCX1,OCX2)) Q:'OCX2  S OCX3=OCX3+1
"RTN","OCXOCMP",55,0)
 D MESG("  "_$J(OCX3,5)_" DataField Navigation Code Array"_$S(OCX3=1:"",1:"s"))
"RTN","OCXOCMP",56,0)
 ;
"RTN","OCXOCMP",57,0)
 D:($G(OCXAUTO)<2) STATUS^OCXOPOST(5,20)
"RTN","OCXOCMP",58,0)
 ;
"RTN","OCXOCMP",59,0)
 D MESG("Compile Element Evaluation code...")
"RTN","OCXOCMP",60,0)
 D SETFLAG^OCXOCMPV ; H 1
"RTN","OCXOCMP",61,0)
 I $$EN^OCXOCMP2 D ERMESG("Compiler Aborted due to Rule Element syntax errors...") Q
"RTN","OCXOCMP",62,0)
 Q:$G(OCXWARN)
"RTN","OCXOCMP",63,0)
 ;
"RTN","OCXOCMP",64,0)
 D:($G(OCXAUTO)<2) STATUS^OCXOPOST(6,20)
"RTN","OCXOCMP",65,0)
 ;
"RTN","OCXOCMP",66,0)
 S (OCX1,OCX2)=0 F  S OCX1=$O(^TMP("OCXCMP",$J,"A CODE",OCX1)) Q:'OCX1  S OCX2=OCX2+1
"RTN","OCXOCMP",67,0)
 D MESG("  "_$J(OCX2,5)_" Event Evaluation Code Array"_$S(OCX2=1:"",1:"s"))
"RTN","OCXOCMP",68,0)
 ;
"RTN","OCXOCMP",69,0)
 D:($G(OCXAUTO)<2) STATUS^OCXOPOST(7,20)
"RTN","OCXOCMP",70,0)
 ;
"RTN","OCXOCMP",71,0)
 D MESG("Compile Element MetaCode...")
"RTN","OCXOCMP",72,0)
 D SETFLAG^OCXOCMPV ; H 1
"RTN","OCXOCMP",73,0)
 I $$EN^OCXOCMPM D ERMESG("Compiler Aborted due to Element metacode errors...") Q
"RTN","OCXOCMP",74,0)
 Q:$G(OCXWARN)
"RTN","OCXOCMP",75,0)
 ;
"RTN","OCXOCMP",76,0)
 D:($G(OCXAUTO)<2) STATUS^OCXOPOST(8,20)
"RTN","OCXOCMP",77,0)
 ;
"RTN","OCXOCMP",78,0)
 S OCX1="",OCX2=0 F  S OCX1=$O(^TMP("OCXCMP",$J,"INCLUDE",OCX1)) Q:'$L(OCX1)  S:($E(OCX1,1,3)="MCE") OCX2=OCX2+1
"RTN","OCXOCMP",79,0)
 D MESG("  "_$J(OCX2,5)_" Element Metacode Array"_$S(OCX2=1:"",1:"s"))
"RTN","OCXOCMP",80,0)
 ;
"RTN","OCXOCMP",81,0)
 D:($G(OCXAUTO)<2) STATUS^OCXOPOST(9,20)
"RTN","OCXOCMP",82,0)
 ;
"RTN","OCXOCMP",83,0)
 D MESG("Get Compiler Function Code...")
"RTN","OCXOCMP",84,0)
 D SETFLAG^OCXOCMPV ; H 1
"RTN","OCXOCMP",85,0)
 I $$EN^OCXOCMPO D ERMESG("Compiler Aborted due to Compiler Function code errors...") Q
"RTN","OCXOCMP",86,0)
 Q:$G(OCXWARN)
"RTN","OCXOCMP",87,0)
 ;
"RTN","OCXOCMP",88,0)
 D:($G(OCXAUTO)<2) STATUS^OCXOPOST(10,20)
"RTN","OCXOCMP",89,0)
 ;
"RTN","OCXOCMP",90,0)
 S OCX1="",OCX2=0 F  S OCX1=$O(^TMP("OCXCMP",$J,"INCLUDE",OCX1)) Q:'$L(OCX1)  S:'($E(OCX1,1,3)="MCE") OCX2=OCX2+1
"RTN","OCXOCMP",91,0)
 D MESG("  "_$J(OCX2,5)_" Compiler Include Function"_$S(OCX2=1:"",1:"s"))
"RTN","OCXOCMP",92,0)
 ;
"RTN","OCXOCMP",93,0)
 D:($G(OCXAUTO)<2) STATUS^OCXOPOST(12,20)
"RTN","OCXOCMP",94,0)
 ;
"RTN","OCXOCMP",95,0)
 D MESG("Compile Rule Element Relation code...")
"RTN","OCXOCMP",96,0)
 D SETFLAG^OCXOCMPV ; H 1
"RTN","OCXOCMP",97,0)
 I $$EN^OCXOCMP3 D ERMESG("Compiler Aborted due to Rule syntax errors...") Q
"RTN","OCXOCMP",98,0)
 Q:$G(OCXWARN)
"RTN","OCXOCMP",99,0)
 ;
"RTN","OCXOCMP",100,0)
 D:($G(OCXAUTO)<2) STATUS^OCXOPOST(13,20)
"RTN","OCXOCMP",101,0)
 ;
"RTN","OCXOCMP",102,0)
 S (OCX1,OCX2)=0 F  S OCX1=$O(^TMP("OCXCMP",$J,"RULE",OCX1)) Q:'OCX1  D
"RTN","OCXOCMP",103,0)
 .S OCX3=0 F  S OCX3=$O(^TMP("OCXCMP",$J,"RULE",OCX1,OCX3)) Q:'OCX3  S:$O(^(OCX3,"CODE",0)) OCX2=OCX2+1
"RTN","OCXOCMP",104,0)
 D MESG("  "_$J(OCX2,5)_" Rule Element Relation Code Array"_$S(OCX2=1:"",1:"s"))
"RTN","OCXOCMP",105,0)
 ;
"RTN","OCXOCMP",106,0)
 D:($G(OCXAUTO)<2) STATUS^OCXOPOST(14,20)
"RTN","OCXOCMP",107,0)
 ;
"RTN","OCXOCMP",108,0)
 D MESG("Construct Decision Tree...")
"RTN","OCXOCMP",109,0)
 D SETFLAG^OCXOCMPV ; H 1
"RTN","OCXOCMP",110,0)
 I $$EN^OCXOCMP4 D ERMESG("Compiler Aborted due to Compiler errors...") Q
"RTN","OCXOCMP",111,0)
 Q:$G(OCXWARN)
"RTN","OCXOCMP",112,0)
 ;
"RTN","OCXOCMP",113,0)
 D:($G(OCXAUTO)<2) STATUS^OCXOPOST(15,20)
"RTN","OCXOCMP",114,0)
 ;
"RTN","OCXOCMP",115,0)
 S OCX1=0 F OCX2=0:1 S OCX1=$O(^TMP("OCXCMP",$J,"C CODE",OCX1)) Q:'OCX1
"RTN","OCXOCMP",116,0)
 D MESG("  "_$J(OCX2,5)_" Sub-Routine"_$S(OCX2=1:"",1:"s"))
"RTN","OCXOCMP",117,0)
 ;
"RTN","OCXOCMP",118,0)
 D:($G(OCXAUTO)<2) STATUS^OCXOPOST(16,20)
"RTN","OCXOCMP",119,0)
 ;
"RTN","OCXOCMP",120,0)
 D MESG("Optimize Sub-Routines...")
"RTN","OCXOCMP",121,0)
 D SETFLAG^OCXOCMPV ; H 1
"RTN","OCXOCMP",122,0)
 I $$EN^OCXOCMP5 D ERMESG("Compiler Aborted due to Compiler errors...") Q
"RTN","OCXOCMP",123,0)
 Q:$G(OCXWARN)
"RTN","OCXOCMP",124,0)
 ;
"RTN","OCXOCMP",125,0)
 D:($G(OCXAUTO)<2) STATUS^OCXOPOST(17,20)
"RTN","OCXOCMP",126,0)
 ;
"RTN","OCXOCMP",127,0)
 S OCX1=0 F OCX3=0:1 S OCX1=$O(^TMP("OCXCMP",$J,"C CODE",OCX1)) Q:'OCX1
"RTN","OCXOCMP",128,0)
 D MESG("  "_$J(OCX3,5)_" Sub-Routine"_$S(OCX3=1:"",1:"s"))
"RTN","OCXOCMP",129,0)
 D MESG("  "_(100-(((OCX3/OCX2)*1000)\1/10))_"% Optimization")
"RTN","OCXOCMP",130,0)
 ;
"RTN","OCXOCMP",131,0)
 D:($G(OCXAUTO)<2) STATUS^OCXOPOST(18,20)
"RTN","OCXOCMP",132,0)
 ;
"RTN","OCXOCMP",133,0)
 D MESG("Assemble Routines...")
"RTN","OCXOCMP",134,0)
 D SETFLAG^OCXOCMPV ; H 1
"RTN","OCXOCMP",135,0)
 I $$EN^OCXOCMP6 D ERMESG("Compiler Aborted due to Compiler errors...") Q
"RTN","OCXOCMP",136,0)
 Q:$G(OCXWARN)
"RTN","OCXOCMP",137,0)
 ;
"RTN","OCXOCMP",138,0)
 D:($G(OCXAUTO)<2) STATUS^OCXOPOST(19,20)
"RTN","OCXOCMP",139,0)
 ;
"RTN","OCXOCMP",140,0)
 S OCX1=0 F OCX2=0:1 S OCX1=$O(^TMP("OCXCMP",$J,"D CODE",OCX1)) Q:'OCX1
"RTN","OCXOCMP",141,0)
 D MESG("  "_$J(OCX2,5)_" OCXOZ* Routine"_$S(OCX2=1:"",1:"s"))
"RTN","OCXOCMP",142,0)
 ;
"RTN","OCXOCMP",143,0)
 D:($G(OCXAUTO)<2) STATUS^OCXOPOST(20,20)
"RTN","OCXOCMP",144,0)
 ;
"RTN","OCXOCMP",145,0)
 L -^OCXD(861,1)
"RTN","OCXOCMP",146,0)
 ;
"RTN","OCXOCMP",147,0)
 Q
"RTN","OCXOCMP",148,0)
 ;
"RTN","OCXOCMP",149,0)
MESG(OCXX) ;
"RTN","OCXOCMP",150,0)
 I '$G(OCXAUTO) W !!,OCXX
"RTN","OCXOCMP",151,0)
 I ($G(OCXAUTO)=1) D BMES^XPDUTL(.OCXX)
"RTN","OCXOCMP",152,0)
 Q
"RTN","OCXOCMP",153,0)
 ;
"RTN","OCXOCMP",154,0)
ERMESG(OCXX) ;
"RTN","OCXOCMP",155,0)
 N OCXY S OCXY=OCXX
"RTN","OCXOCMP",156,0)
 I '$G(OCXAUTO) W !!,OCXX
"RTN","OCXOCMP",157,0)
 I ($G(OCXAUTO)=1) D BMES^XPDUTL(.OCXX)
"RTN","OCXOCMP",158,0)
 S OCXERRM=OCXY
"RTN","OCXOCMP",159,0)
 Q
"RTN","OCXOCMP",160,0)
 ;
"RTN","OCXOCMP",161,0)
READ(OCXZ0,OCXZA,OCXZB,OCXZL) ;
"RTN","OCXOCMP",162,0)
 N OCXLINE,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","OCXOCMP",163,0)
 Q:'$L($G(OCXZ0)) U
"RTN","OCXOCMP",164,0)
 S DIR(0)=OCXZ0
"RTN","OCXOCMP",165,0)
 S:$L($G(OCXZA)) DIR("A")=OCXZA
"RTN","OCXOCMP",166,0)
 S:$L($G(OCXZB)) DIR("B")=OCXZB
"RTN","OCXOCMP",167,0)
 F OCXLINE=1:1:($G(OCXZL)-1) W !
"RTN","OCXOCMP",168,0)
 D ^DIR
"RTN","OCXOCMP",169,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","OCXOCMP",170,0)
 Q Y
"RTN","OCXOCMP",171,0)
 ;
"RTN","OCXOCMP",172,0)
 Q
"RTN","OCXOCMP",173,0)
 ;
"RTN","OCXOCMP",174,0)
DT(X,D) N Y,%DT S %DT=D D ^%DT Q Y
"RTN","OCXOCMP",175,0)
 Q
"RTN","OCXOCMP",176,0)
 ;
"RTN","OCXOCMP",177,0)
CNT(X) ;
"RTN","OCXOCMP",178,0)
 ;
"RTN","OCXOCMP",179,0)
 N CNT,D0
"RTN","OCXOCMP",180,0)
 S D0=0 F CNT=1:1 S D0=$O(@X@(D0)) Q:'D0
"RTN","OCXOCMP",181,0)
 W !!,?10,X,"  ",CNT
"RTN","OCXOCMP",182,0)
 Q CNT
"RTN","OCXOCMP",183,0)
 ;
"RTN","OCXOCMP",184,0)
DATE() N X,Y,%DT S X="N",%DT="T" D ^%DT X ^DD("DD") Q Y
"RTN","OCXOCMP",185,0)
 ;
"RTN","OCXOCMP",186,0)
CONV(Y) Q:'(Y["@") Y Q $P(Y,"@",1)_" at "_$P(Y,"@",2,99)
"RTN","OCXOCMP",187,0)
 ;
"RTN","OCXOCMP",188,0)
 ;
"RTN","OCXOCMP",189,0)
VERSION() Q $P($T(+3),";;",3)
"RTN","OCXOCMP",190,0)
 ;
"RTN","OCXOCMP6")
0^195^B40637033
"RTN","OCXOCMP6",1,0)
OCXOCMP6 ;SLC/RJS,CLA - ORDER CHECK CODE COMPILER (Assemble Order Check Routines) ;1/05/04  14:33
"RTN","OCXOCMP6",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**32,221,243**;Dec 17,1997;Build 242
"RTN","OCXOCMP6",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","OCXOCMP6",4,0)
 ;
"RTN","OCXOCMP6",5,0)
EN() ;
"RTN","OCXOCMP6",6,0)
 ;
"RTN","OCXOCMP6",7,0)
 Q:$G(OCXWARN) 1
"RTN","OCXOCMP6",8,0)
 N OCXD0,OCXD1,OCXRN,OCXSCNT,OCXOFF
"RTN","OCXOCMP6",9,0)
 ;
"RTN","OCXOCMP6",10,0)
 W:'$G(OCXAUTO) !,?5,"Generate Extrinsic Function and Variables documentation..."
"RTN","OCXOCMP6",11,0)
 S OCXD0=0 F  S OCXD0=$O(^TMP("OCXCMP",$J,"C CODE",OCXD0)) Q:'OCXD0  D DOC^OCXOCMPT(OCXD0)
"RTN","OCXOCMP6",12,0)
 ;
"RTN","OCXOCMP6",13,0)
 K ^OCXS(860.3,"APGM")
"RTN","OCXOCMP6",14,0)
 S OCXD0=0 F  S OCXD0=$O(^OCXS(860.3,OCXD0)) Q:'OCXD0  D
"RTN","OCXOCMP6",15,0)
 .K ^OCXS(860.3,OCXD0,"RTN") I '$G(OCXAUTO) W:($X>60) ! W "."
"RTN","OCXOCMP6",16,0)
 ;
"RTN","OCXOCMP6",17,0)
 K ^TMP("OCXCMP",$J,"D CODE")
"RTN","OCXOCMP6",18,0)
 ;
"RTN","OCXOCMP6",19,0)
 W:'$G(OCXAUTO) !,?5,"Assign Subroutines to Routines..."
"RTN","OCXOCMP6",20,0)
 S OCXRN=1,OCXD0=0
"RTN","OCXOCMP6",21,0)
 D GETHDR(1)
"RTN","OCXOCMP6",22,0)
 F  S OCXD0=$O(^TMP("OCXCMP",$J,"C CODE",OCXD0)) Q:'OCXD0  D  Q:OCXWARN
"RTN","OCXOCMP6",23,0)
 .N OCXLLAB,OCXSKIP,OCXEXF,OCXSUB,OCXSIZE,OCXFILE,OCXCCODE,OCXDCODE,OCXLAST
"RTN","OCXOCMP6",24,0)
 .I '$G(OCXAUTO) W:($X>60) ! W "."
"RTN","OCXOCMP6",25,0)
 .S OCXLLAB=^TMP("OCXCMP",$J,"LINE",OCXD0)
"RTN","OCXOCMP6",26,0)
 .S OCXSKIP=((OCXLLAB="UPDATE")!(OCXLLAB="LOG"))
"RTN","OCXOCMP6",27,0)
 .S OCXSIZE=$$SIZE^OCXOCMP8(OCXRN,OCXD0)
"RTN","OCXOCMP6",28,0)
 .S OCXLAST='$O(^TMP("OCXCMP",$J,"C CODE",OCXD0))
"RTN","OCXOCMP6",29,0)
 .S OCXFILE=(OCXSIZE>OCXCRS)!(OCXLAST) S:OCXSKIP OCXFILE=0
"RTN","OCXOCMP6",30,0)
 .I OCXFILE D
"RTN","OCXOCMP6",31,0)
 ..K OCXEXF S OCXEXF=""
"RTN","OCXOCMP6",32,0)
 ..I $D(^TMP("OCXCMP",$J,"D CODE",OCXRN,"CALLS")) M OCXEXF=^("CALLS")
"RTN","OCXOCMP6",33,0)
 ..S OCXSUB="" F  S OCXSUB=$O(OCXEXF(OCXSUB)) Q:'$L(OCXSUB)  I 'OCXEXF(OCXSUB) D
"RTN","OCXOCMP6",34,0)
 ...S OCXEXF(OCXSUB)=1,OCXEXF=OCXSUB
"RTN","OCXOCMP6",35,0)
 ...S OCXSUB="" F  S OCXSUB=$O(^TMP("OCXCMP",$J,"INCLUDE",OCXEXF,"CALLS",OCXSUB)) Q:'$L(OCXSUB)  D
"RTN","OCXOCMP6",36,0)
 ....S OCXEXF(OCXSUB)=$G(OCXEXF(OCXSUB))
"RTN","OCXOCMP6",37,0)
 ..S OCXSUB="" F  S OCXSUB=$O(OCXEXF(OCXSUB)) Q:'$L(OCXSUB)  D
"RTN","OCXOCMP6",38,0)
 ...D APPEND^OCXOCMP8(OCXRN,OCXSUB,"F")
"RTN","OCXOCMP6",39,0)
 ..D APPEND^OCXOCMP8(OCXRN,"$")
"RTN","OCXOCMP6",40,0)
 ..S OCXRN=OCXRN+1 D GETHDR(OCXRN)
"RTN","OCXOCMP6",41,0)
 ..;
"RTN","OCXOCMP6",42,0)
 .D APPEND^OCXOCMP8(OCXRN,OCXD0,"C",OCXLLAB)
"RTN","OCXOCMP6",43,0)
 .I ($E(OCXLLAB,1,2)="EL") D
"RTN","OCXOCMP6",44,0)
 ..S ^OCXS(860.3,"APGM",(+$E(OCXLLAB,3,$L(OCXLLAB))),(OCXLLAB_U_$$RNAM(OCXRN)))=""
"RTN","OCXOCMP6",45,0)
 .S $P(^TMP("OCXCMP",$J,"LINE",OCXD0),U,2)=$$RNAM(OCXRN)
"RTN","OCXOCMP6",46,0)
 .Q:'OCXLAST
"RTN","OCXOCMP6",47,0)
 .K OCXEXF S OCXEXF=""
"RTN","OCXOCMP6",48,0)
 .I $D(^TMP("OCXCMP",$J,"D CODE",OCXRN,"CALLS")) M OCXEXF=^("CALLS")
"RTN","OCXOCMP6",49,0)
 .S OCXSUB="" F  S OCXSUB=$O(OCXEXF(OCXSUB)) Q:'$L(OCXSUB)  I 'OCXEXF(OCXSUB) D
"RTN","OCXOCMP6",50,0)
 ..S OCXEXF(OCXSUB)=1,OCXEXF=OCXSUB
"RTN","OCXOCMP6",51,0)
 ..S OCXSUB="" F  S OCXSUB=$O(^TMP("OCXCMP",$J,"INCLUDE",OCXEXF,"CALLS",OCXSUB)) Q:'$L(OCXSUB)  D
"RTN","OCXOCMP6",52,0)
 ...S OCXEXF(OCXSUB)=$G(OCXEXF(OCXSUB))
"RTN","OCXOCMP6",53,0)
 .S OCXSUB="" F  S OCXSUB=$O(OCXEXF(OCXSUB)) Q:'$L(OCXSUB)  D
"RTN","OCXOCMP6",54,0)
 ..D APPEND^OCXOCMP8(OCXRN,OCXSUB,"F")
"RTN","OCXOCMP6",55,0)
 .D APPEND^OCXOCMP8(OCXRN,"$")
"RTN","OCXOCMP6",56,0)
 ;
"RTN","OCXOCMP6",57,0)
 W:'$G(OCXAUTO) !,?5,"Resolve Routine Line Tags..."
"RTN","OCXOCMP6",58,0)
 S OCXD0=0 F  S OCXD0=$O(^TMP("OCXCMP",$J,"D CODE",OCXD0)) Q:'OCXD0  D  Q:OCXWARN
"RTN","OCXOCMP6",59,0)
 .I '$G(OCXAUTO) W:($X>60) ! W "."
"RTN","OCXOCMP6",60,0)
 .N TEXT,RTN,TEMP,ALT,LABL,OBJ,PIEC
"RTN","OCXOCMP6",61,0)
 .S RTN=$$RNAM(OCXD0)
"RTN","OCXOCMP6",62,0)
 .K TEMP M TEMP=^TMP("OCXCMP",$J,"D CODE",OCXD0)
"RTN","OCXOCMP6",63,0)
 .S OCXD1=0 F OCXOFF=0:1 S OCXD1=$O(TEMP(OCXD1)) Q:'OCXD1  D  Q:OCXWARN
"RTN","OCXOCMP6",64,0)
 ..N TEXT,PIEC
"RTN","OCXOCMP6",65,0)
 ..S TEXT=TEMP(OCXD1,0) Q:'(TEXT["||")
"RTN","OCXOCMP6",66,0)
 ..;
"RTN","OCXOCMP6",67,0)
 ..F PIEC=2:2:$L(TEXT,"||") D  Q:OCXWARN
"RTN","OCXOCMP6",68,0)
 ...S LABL=$P(TEXT,"||",PIEC)
"RTN","OCXOCMP6",69,0)
 ...I ($E(LABL,1,5)="LINE:") D  I 1
"RTN","OCXOCMP6",70,0)
 ....S LABL=$G(^TMP("OCXCMP",$J,"LINE",+$P(LABL,":",2)))
"RTN","OCXOCMP6",71,0)
 ....I '$L(LABL) D WARN^OCXOCMPV("Line Label not found: "_$P(TEXT,"|",2),$P($T(+1)," ",1)) Q
"RTN","OCXOCMP6",72,0)
 ....S:($P(LABL,"^",2)=RTN) LABL=$P(LABL,"^",1)
"RTN","OCXOCMP6",73,0)
 ...;
"RTN","OCXOCMP6",74,0)
 ...E  I ($E(LABL,1,5)="LNTAG") D  I 1
"RTN","OCXOCMP6",75,0)
 ....N D0,CNT
"RTN","OCXOCMP6",76,0)
 ....S D0=OCXD1 F CNT=1:1 S D0=$O(TEMP(D0),-1)  Q:$L($P(TEMP(D0,0)," ",1))
"RTN","OCXOCMP6",77,0)
 ....S LABL=$P(TEMP(D0,0)," ",1) S:(LABL["(") LABL=$P(LABL,"(",1)
"RTN","OCXOCMP6",78,0)
 ....S LABL="(+$P($H,"","",2))_""<"_LABL_"+"_CNT_U_RTN_">"""
"RTN","OCXOCMP6",79,0)
 ...;
"RTN","OCXOCMP6",80,0)
 ...E  D WARN^OCXOCMPV("Unknown Compiler directive: "_LABL,$P($T(+1)," ",1)) Q
"RTN","OCXOCMP6",81,0)
 ...;
"RTN","OCXOCMP6",82,0)
 ...S $P(TEXT,"||",PIEC)=LABL
"RTN","OCXOCMP6",83,0)
 ..;
"RTN","OCXOCMP6",84,0)
 ..F  Q:'(TEXT["||")  S TEXT=$P(TEXT,"||",1)_$P(TEXT,"||",2,999)
"RTN","OCXOCMP6",85,0)
 ..S TEMP(OCXD1,0)=TEXT
"RTN","OCXOCMP6",86,0)
 .;
"RTN","OCXOCMP6",87,0)
 .K ^TMP("OCXCMP",$J,"D CODE",OCXD0)
"RTN","OCXOCMP6",88,0)
 .M ^TMP("OCXCMP",$J,"D CODE",OCXD0)=TEMP
"RTN","OCXOCMP6",89,0)
 ;
"RTN","OCXOCMP6",90,0)
 Q:OCXWARN 1
"RTN","OCXOCMP6",91,0)
 W:'$G(OCXAUTO) !,?5,"Generate Subroutine and Call documentation..."
"RTN","OCXOCMP6",92,0)
 S OCXD0=0 F  S OCXD0=$O(^TMP("OCXCMP",$J,"C CODE",OCXD0)) Q:'OCXD0  D CALL^OCXOCMPT(OCXD0)
"RTN","OCXOCMP6",93,0)
 ;
"RTN","OCXOCMP6",94,0)
 W:'$G(OCXAUTO) !!,?5,"Delete Old OCXOZ* Routines..."
"RTN","OCXOCMP6",95,0)
 S OCXRTEST=^%ZOSF("TEST"),OCXSAVE=^%ZOSF("SAVE"),OCXDEL=^%ZOSF("DEL")
"RTN","OCXOCMP6",96,0)
 F OCXRN=1:1:1290 D
"RTN","OCXOCMP6",97,0)
 .I '$G(OCXAUTO) W:($X>60) ! W:'(OCXRN#100) "."
"RTN","OCXOCMP6",98,0)
 .S X=$$RNAM(OCXRN) X OCXRTEST I  X OCXDEL W:'$G(OCXAUTO) "!"
"RTN","OCXOCMP6",99,0)
 ;
"RTN","OCXOCMP6",100,0)
 W:'$G(OCXAUTO) !,?5,"File New OCXOZ* routines..."
"RTN","OCXOCMP6",101,0)
 S OCXD0=$O(^TMP("OCXCMP",$J,"D CODE",0)) Q:'OCXD0 1
"RTN","OCXOCMP6",102,0)
 F  S OCXD0=$O(^TMP("OCXCMP",$J,"D CODE",OCXD0)) Q:'OCXD0  D  Q:OCXWARN
"RTN","OCXOCMP6",103,0)
 .I '$G(OCXAUTO) W:($X>60) ! W "."
"RTN","OCXOCMP6",104,0)
 .D FILE^OCXOCMP8(OCXD0)
"RTN","OCXOCMP6",105,0)
 S OCXD0=$O(^TMP("OCXCMP",$J,"D CODE",0)) Q:'OCXD0 1  D FILE^OCXOCMP8(OCXD0)
"RTN","OCXOCMP6",106,0)
 ;
"RTN","OCXOCMP6",107,0)
 Q OCXWARN
"RTN","OCXOCMP6",108,0)
 ;
"RTN","OCXOCMP6",109,0)
GETHDR(RNUM) ;
"RTN","OCXOCMP6",110,0)
 ;
"RTN","OCXOCMP6",111,0)
 N OCXREC,D0,EFC,OCXEFF,PIEC,TEXT
"RTN","OCXOCMP6",112,0)
 S OCXREC(1,0)=$$RNAM(RNUM)_" ;SLC/RJS,CLA - Order Check Scan ;"_$$NOW
"RTN","OCXOCMP6",113,0)
 S OCXREC(2,0)=$T(+2)
"RTN","OCXOCMP6",114,0)
 S OCXREC(3,0)=$T(+3)
"RTN","OCXOCMP6",115,0)
 S OCXREC(4,0)=" ;"
"RTN","OCXOCMP6",116,0)
 S OCXREC(5,0)=" ; ***************************************************************"
"RTN","OCXOCMP6",117,0)
 S OCXREC(6,0)=" ; ** Warning: This routine is automatically generated by the   **"
"RTN","OCXOCMP6",118,0)
 S OCXREC(7,0)=" ; ** Rule Compiler (^OCXOCMP) and ANY changes to this routine  **"
"RTN","OCXOCMP6",119,0)
 S OCXREC(8,0)=" ; ** will be lost the next time the rule compiler executes.    **"
"RTN","OCXOCMP6",120,0)
 S OCXREC(9,0)=" ; ***************************************************************"
"RTN","OCXOCMP6",121,0)
 S OCXREC(10,0)=" ;"
"RTN","OCXOCMP6",122,0)
 I (RNUM=1) D
"RTN","OCXOCMP6",123,0)
 .S OCXREC(11,0)=" ;    compiled code line length: "_OCXCLL
"RTN","OCXOCMP6",124,0)
 .S OCXREC(12,0)=" ;        compiled routine size: "_OCXCRS
"RTN","OCXOCMP6",125,0)
 .S OCXREC(13,0)=" ; triggered rule ignore period: "_OCXTSPI
"RTN","OCXOCMP6",126,0)
 .S OCXREC(14,0)=" ;"
"RTN","OCXOCMP6",127,0)
 .S OCXREC(15,0)=" ;   Program Execution Trace Mode: "_$S($G(OCXTRACE):" ON",1:"OFF")
"RTN","OCXOCMP6",128,0)
 .S OCXREC(16,0)=" ;" ; " ;    Elapsed time logging: "_$S($G(OCXTLOG):" ON",1:"OFF")
"RTN","OCXOCMP6",129,0)
 .S OCXREC(17,0)=" ;               Raw Data Logging: "_$S($G(OCXDLOG):(" ON  Keep data for "_OCXDLOG_" day"_$S(OCXDLOG=1:"",1:"s")_" then purge."),1:"OFF")
"RTN","OCXOCMP6",130,0)
 .S OCXREC(18,0)=" ; Compiler mode: "_$S(($G(OCXAUTO)>1):"Queued",$G(OCXAUTO):" ON",1:"OFF")
"RTN","OCXOCMP6",131,0)
 .S OCXREC(19,0)=" ;   Compiled by: "_$P($G(^VA(200,+$G(DUZ),0)),U,1)_"  (DUZ="_(+$G(DUZ))_")"
"RTN","OCXOCMP6",132,0)
 .S OCXREC(20,0)=" Q"
"RTN","OCXOCMP6",133,0)
 .S OCXREC(21,0)=" ;"
"RTN","OCXOCMP6",134,0)
 ;
"RTN","OCXOCMP6",135,0)
 E  D
"RTN","OCXOCMP6",136,0)
 .S OCXREC(11,0)=" Q"
"RTN","OCXOCMP6",137,0)
 .S OCXREC(12,0)=" ;"
"RTN","OCXOCMP6",138,0)
 ;
"RTN","OCXOCMP6",139,0)
 M ^TMP("OCXCMP",$J,"D CODE",RNUM)=OCXREC
"RTN","OCXOCMP6",140,0)
 Q
"RTN","OCXOCMP6",141,0)
 ;
"RTN","OCXOCMP6",142,0)
RNAM(X) ;
"RTN","OCXOCMP6",143,0)
 N CHAR
"RTN","OCXOCMP6",144,0)
 S CHAR="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"
"RTN","OCXOCMP6",145,0)
 Q "OCXOZ"_$E(CHAR,(X\36+1))_$E(CHAR,(X#36+1))
"RTN","OCXOCMP6",146,0)
 ;
"RTN","OCXOCMP6",147,0)
TODAY() N X,Y,%DT S X="T",%DT="" D ^%DT X ^DD("DD") Q Y
"RTN","OCXOCMP6",148,0)
 ;
"RTN","OCXOCMP6",149,0)
NOW() N X,Y,%DT S X="N",%DT="T" D ^%DT X ^DD("DD") S:(Y["@") Y=$P(Y,"@",1)_" at "_$P(Y,"@",2,99) Q Y
"RTN","OCXOCMP6",150,0)
 ;
"RTN","OCXOCMP8")
0^194^B14209872
"RTN","OCXOCMP8",1,0)
OCXOCMP8 ;SLC/RJS,CLA - ORDER CHECK CODE COMPILER (Assemble Order Check Routines utilities) ;10/29/98  12:37
"RTN","OCXOCMP8",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**32,243**;Dec 17,1997;Build 242
"RTN","OCXOCMP8",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","OCXOCMP8",4,0)
 ;
"RTN","OCXOCMP8",5,0)
 Q
"RTN","OCXOCMP8",6,0)
FILE(RNUM) ;
"RTN","OCXOCMP8",7,0)
 ;
"RTN","OCXOCMP8",8,0)
 W:'$G(OCXAUTO) !,$$RNAM(RNUM)
"RTN","OCXOCMP8",9,0)
 N DIE,XCN,X
"RTN","OCXOCMP8",10,0)
 S DIE="^TMP(""OCXCMP"",$J,""D CODE"","_RNUM_",",XCN=0,X=$$RNAM(RNUM)
"RTN","OCXOCMP8",11,0)
 X ^%ZOSF("SAVE")
"RTN","OCXOCMP8",12,0)
 Q
"RTN","OCXOCMP8",13,0)
 ;
"RTN","OCXOCMP8",14,0)
APPEND(DSUB,CSUB,SRC,LABEL) ;
"RTN","OCXOCMP8",15,0)
 ;
"RTN","OCXOCMP8",16,0)
 N OCXSRC,OCXNDX,OCXNEXT,GLD,GLC
"RTN","OCXOCMP8",17,0)
 S GLD="^TMP(""OCXCMP"",$J,""D CODE"","_(+DSUB)_")"
"RTN","OCXOCMP8",18,0)
 I (CSUB="$") D  Q
"RTN","OCXOCMP8",19,0)
 .S OCXNEXT=$O(@GLD@(" "),-1)+1
"RTN","OCXOCMP8",20,0)
 .S @GLD@(OCXNEXT,0)="$"
"RTN","OCXOCMP8",21,0)
 .S OCXNEXT=$O(@GLD@(" "),-1)+1
"RTN","OCXOCMP8",22,0)
 .S @GLD@(OCXNEXT,0)=""
"RTN","OCXOCMP8",23,0)
 ;
"RTN","OCXOCMP8",24,0)
 I (SRC="C") M GLC=^TMP("OCXCMP",$J,"C CODE",+CSUB) S ^TMP("OCXCMP",$J,"D CODE","LINE",LABEL)=DSUB_","_($O(@GLD@(" "),-1)+1)
"RTN","OCXOCMP8",25,0)
 I (SRC="F") M GLC=^TMP("OCXCMP",$J,"INCLUDE",CSUB)
"RTN","OCXOCMP8",26,0)
 S OCXNDX=0 F  S OCXNDX=$O(GLC(OCXNDX)) Q:'OCXNDX  D
"RTN","OCXOCMP8",27,0)
 .S OCXNEXT=$O(@GLD@(" "),-1)+1
"RTN","OCXOCMP8",28,0)
 .S @GLD@(OCXNEXT,0)=GLC(OCXNDX,0)
"RTN","OCXOCMP8",29,0)
 M @GLD@("CALLS")=GLC("CALLS")
"RTN","OCXOCMP8",30,0)
 S @GLD@("SIZE")=$G(@GLD@("SIZE"))+$G(GLC("SIZE"))
"RTN","OCXOCMP8",31,0)
 Q
"RTN","OCXOCMP8",32,0)
 ;
"RTN","OCXOCMP8",33,0)
SIZE(DSUB,CSUB) ;
"RTN","OCXOCMP8",34,0)
 ;
"RTN","OCXOCMP8",35,0)
 N D0,EFC,OCXEFC,OCXEFD,OCXEFF,OCXREC
"RTN","OCXOCMP8",36,0)
 N OCXTEMP,PIEC,SIZEC,SIZED,SIZEF,TEXT
"RTN","OCXOCMP8",37,0)
 ;
"RTN","OCXOCMP8",38,0)
 S (SIZEC,SIZED,SIZEF)=0
"RTN","OCXOCMP8",39,0)
 K OCXEFF,OCXEFC,OCXEFD
"RTN","OCXOCMP8",40,0)
 S (OCXEFF,OCXEFC,OCXEFD)=""
"RTN","OCXOCMP8",41,0)
 ;
"RTN","OCXOCMP8",42,0)
 I $G(CSUB),$D(^TMP("OCXCMP",$J,"C CODE",+CSUB)) D
"RTN","OCXOCMP8",43,0)
 .I $D(^TMP("OCXCMP",$J,"C CODE",+CSUB,"SIZE")) D  Q
"RTN","OCXOCMP8",44,0)
 ..S SIZEC=^TMP("OCXCMP",$J,"C CODE",+CSUB,"SIZE")
"RTN","OCXOCMP8",45,0)
 ..I $D(^TMP("OCXCMP",$J,"C CODE",+CSUB,"CALLS")) D
"RTN","OCXOCMP8",46,0)
 ...K OCXEFC M OCXEFC=^TMP("OCXCMP",$J,"C CODE",+CSUB,"CALLS")
"RTN","OCXOCMP8",47,0)
 .K OCXREC M OCXREC=^TMP("OCXCMP",$J,"C CODE",+CSUB)
"RTN","OCXOCMP8",48,0)
 .S D0=0 F  S D0=$O(OCXREC(D0)) Q:'D0  D
"RTN","OCXOCMP8",49,0)
 ..S TEXT=OCXREC(D0,0),SIZEC=SIZEC+$L(TEXT)
"RTN","OCXOCMP8",50,0)
 ..Q:'(TEXT["$$")
"RTN","OCXOCMP8",51,0)
 ..F PIEC=2:1:$L(TEXT,"$$") D
"RTN","OCXOCMP8",52,0)
 ...S EFC=$P($P(TEXT,"$$",PIEC),"(",1)
"RTN","OCXOCMP8",53,0)
 ...S:(EFC[" ") EFC=$P(EFC," ",1) Q:(EFC["^")  Q:'$L(EFC)
"RTN","OCXOCMP8",54,0)
 ...I '$D(^TMP("OCXCMP",$J,"INCLUDE",EFC)) D  Q
"RTN","OCXOCMP8",55,0)
 ....D WARN^OCXOCMPV("Unknown Local Extrinsic Function: "_EFC,$P($T(+1)," ",1)) Q
"RTN","OCXOCMP8",56,0)
 ...S OCXEFC(EFC)=""
"RTN","OCXOCMP8",57,0)
 .S SIZEC=SIZEC+100 ; ADJUST FOR SUBROUTINE DOCUMENTATION
"RTN","OCXOCMP8",58,0)
 .S ^TMP("OCXCMP",$J,"C CODE",+CSUB,"SIZE")=SIZEC
"RTN","OCXOCMP8",59,0)
 .M ^TMP("OCXCMP",$J,"C CODE",+CSUB,"CALLS")=OCXEFC
"RTN","OCXOCMP8",60,0)
 ;
"RTN","OCXOCMP8",61,0)
 I $G(DSUB),$D(^TMP("OCXCMP",$J,"D CODE",+DSUB)) D
"RTN","OCXOCMP8",62,0)
 .I $G(^TMP("OCXCMP",$J,"D CODE",+DSUB,"SIZE")) D  Q
"RTN","OCXOCMP8",63,0)
 ..S SIZED=^TMP("OCXCMP",$J,"D CODE",+DSUB,"SIZE")
"RTN","OCXOCMP8",64,0)
 ..I $D(^TMP("OCXCMP",$J,"D CODE",+DSUB,"CALLS")) D
"RTN","OCXOCMP8",65,0)
 ...K OCXEFD M OCXEFD=^TMP("OCXCMP",$J,"D CODE",+DSUB,"CALLS")
"RTN","OCXOCMP8",66,0)
 ;
"RTN","OCXOCMP8",67,0)
 K OCXEFF M OCXEFF=OCXEFC,OCXEFF=OCXEFD
"RTN","OCXOCMP8",68,0)
 ;
"RTN","OCXOCMP8",69,0)
 I $D(OCXEFF) S EFC="" F  S EFC=$O(OCXEFF(EFC)) Q:'$L(EFC)  I 'OCXEFF(EFC) D
"RTN","OCXOCMP8",70,0)
 .K OCXTEMP
"RTN","OCXOCMP8",71,0)
 .I $D(^TMP("OCXCMP",$J,"INCLUDE",EFC,"SIZE")) M OCXTEMP("SIZE")=^TMP("OCXCMP",$J,"INCLUDE",EFC,"SIZE")
"RTN","OCXOCMP8",72,0)
 .I $D(^TMP("OCXCMP",$J,"INCLUDE",EFC,"CALLS")) M OCXTEMP("CALLS")=^TMP("OCXCMP",$J,"INCLUDE",EFC,"CALLS")
"RTN","OCXOCMP8",73,0)
 .S OCXEFF(EFC)=OCXTEMP("SIZE")
"RTN","OCXOCMP8",74,0)
 .Q:'$D(OCXTEMP("CALLS"))
"RTN","OCXOCMP8",75,0)
 .S EFC="" F  S EFC=$O(OCXTEMP("CALLS",EFC)) Q:'$L(EFC)  S OCXEFF(EFC)=+$G(OCXEFF(EFC))
"RTN","OCXOCMP8",76,0)
 ;
"RTN","OCXOCMP8",77,0)
 I $D(OCXEFF) S EFC="" F  S EFC=$O(OCXEFF(EFC)) Q:'$L(EFC)  S SIZEF=SIZEF+OCXEFF(EFC)
"RTN","OCXOCMP8",78,0)
 ;
"RTN","OCXOCMP8",79,0)
 Q $G(SIZEC)+$G(SIZED)+$G(SIZEF)
"RTN","OCXOCMP8",80,0)
 ;
"RTN","OCXOCMP8",81,0)
RNAM(X) ;
"RTN","OCXOCMP8",82,0)
 N CHAR
"RTN","OCXOCMP8",83,0)
 S CHAR="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"
"RTN","OCXOCMP8",84,0)
 Q "OCXOZ"_$E(CHAR,(X\36+1))_$E(CHAR,(X#36+1))
"RTN","OCXOCMP8",85,0)
 ;
"RTN","OCXOCMP8",86,0)
TODAY() N X,Y,%DT S X="T",%DT="" D ^%DT X ^DD("DD") Q Y
"RTN","OCXOCMP8",87,0)
 ;
"RTN","OCXOCMP8",88,0)
NOW() N X,Y,%DT S X="N",%DT="T" D ^%DT X ^DD("DD") S:(Y["@") Y=$P(Y,"@",1)_" at "_$P(Y,"@",2,99) Q Y
"RTN","OCXOCMP8",89,0)
 ;
"RTN","OCXOCMPV")
0^193^B62658161
"RTN","OCXOCMPV",1,0)
OCXOCMPV ;SLC/RJS,CLA - ORDER CHECK CODE COMPILER (Main Entry point - All Rules  cont...) ;1/05/04  14:09
"RTN","OCXOCMPV",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**32,105,221,243**;Dec 17,1997;Build 242
"RTN","OCXOCMPV",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","OCXOCMPV",4,0)
 ;
"RTN","OCXOCMPV",5,0)
MAN ;
"RTN","OCXOCMPV",6,0)
 I '$D(DUZ) W !!,"DUZ not defined." Q
"RTN","OCXOCMPV",7,0)
 N OCXD0,OCXD1,OCXWARN,OCXNAM,OCXTRACE,OCXOETIM,OCXAUTO,OCXERRM,OCXTSPI
"RTN","OCXOCMPV",8,0)
 S OCXWARN=0,OCXOETIM=$H
"RTN","OCXOCMPV",9,0)
 K ^TMP("OCXCMP",$J)
"RTN","OCXOCMPV",10,0)
 S ^TMP("OCXCMP",$J)=($P($H,",",2)+($H*86400)+(2*60*60))_" <- ^TMP ENTRY EXPIRATION DATE FOR ^OCXOPURG"
"RTN","OCXOCMPV",11,0)
 ;
"RTN","OCXOCMPV",12,0)
 ;  Compiler Constants
"RTN","OCXOCMPV",13,0)
 ;
"RTN","OCXOCMPV",14,0)
 S OCXCLL=200      ; compiled code line length
"RTN","OCXOCMPV",15,0)
 S OCXCRS=4000     ; compiled routine size
"RTN","OCXOCMPV",16,0)
 S OCXTSPI=300     ; Duplicate triggered Rule message "ignore period" in seconds
"RTN","OCXOCMPV",17,0)
 ;
"RTN","OCXOCMPV",18,0)
 S OCXTRACE=0,OCXTLOG=0,OCXDLOG=0,OCXAUTO=0,OCXERRM=""
"RTN","OCXOCMPV",19,0)
 ;
"RTN","OCXOCMPV",20,0)
 S OCXTRACE=$$READ("Y","Want to enable Compiled Routine Execution Display ","NO") Q:(OCXTRACE[U)
"RTN","OCXOCMPV",21,0)
 S OCXDLOG=$$READ("Y","Want to enable Logging of incoming raw data ","NO") Q:(OCXDLOG[U)
"RTN","OCXOCMPV",22,0)
 I OCXDLOG S OCXDLOG=$$READ("N^1:20","Number of days to keep raw data ","3") Q:(OCXDLOG[U)
"RTN","OCXOCMPV",23,0)
 I OCXDLOG W !!,"*** Note: The raw data log will only hold 200,000 entries. *****",!
"RTN","OCXOCMPV",24,0)
 I 0 I OCXDLOG S OCXTLOG=$$READ("Y","Want to enable Elapsed Time Logging ","YES") Q:(OCXTLOG[U)
"RTN","OCXOCMPV",25,0)
 ;
"RTN","OCXOCMPV",26,0)
 Q:'$$READ("Y","Are you sure you want to recompile the Expert System routines ","NO")
"RTN","OCXOCMPV",27,0)
 ;
"RTN","OCXOCMPV",28,0)
 D SETFLAG
"RTN","OCXOCMPV",29,0)
 L +^OCXD(861,1):5 E  D ERMESG("Run aborted. Another compiler run has ^OCXD(861,1) locked.") Q
"RTN","OCXOCMPV",30,0)
 D RUN^OCXOCMP,BULL(DUZ),KILLFLAG
"RTN","OCXOCMPV",31,0)
 L -^OCXD(861,1)
"RTN","OCXOCMPV",32,0)
 ;
"RTN","OCXOCMPV",33,0)
 ;K ^TMP("OCXCMP",$J)
"RTN","OCXOCMPV",34,0)
 ;
"RTN","OCXOCMPV",35,0)
 Q
"RTN","OCXOCMPV",36,0)
 ;
"RTN","OCXOCMPV",37,0)
MESG(OCXX) ;
"RTN","OCXOCMPV",38,0)
 I '$G(OCXAUTO) W !!,OCXX
"RTN","OCXOCMPV",39,0)
 I ($G(OCXAUTO)=1) D BMES^XPDUTL(.OCXX)
"RTN","OCXOCMPV",40,0)
 Q
"RTN","OCXOCMPV",41,0)
 ;
"RTN","OCXOCMPV",42,0)
ERMESG(OCXX) ;
"RTN","OCXOCMPV",43,0)
 N OCXY S OCXY=OCXX
"RTN","OCXOCMPV",44,0)
 I '$G(OCXAUTO) W !!,OCXX
"RTN","OCXOCMPV",45,0)
 I ($G(OCXAUTO)=1) D BMES^XPDUTL(.OCXX)
"RTN","OCXOCMPV",46,0)
 S OCXERRM=OCXY
"RTN","OCXOCMPV",47,0)
 Q
"RTN","OCXOCMPV",48,0)
 ;
"RTN","OCXOCMPV",49,0)
WARN(X,FILE,D0,RLINE) ;
"RTN","OCXOCMPV",50,0)
 ;
"RTN","OCXOCMPV",51,0)
 Q:$G(OCXWARN)
"RTN","OCXOCMPV",52,0)
 ;
"RTN","OCXOCMPV",53,0)
 S OCXWARN=1
"RTN","OCXOCMPV",54,0)
 ;
"RTN","OCXOCMPV",55,0)
 I $G(OCXAUTO) D  Q
"RTN","OCXOCMPV",56,0)
 .D MESG(" Error... "_X)
"RTN","OCXOCMPV",57,0)
 .D MESG(" Error...  File:"_(+$G(FILE)))
"RTN","OCXOCMPV",58,0)
 .D MESG(" Error... Index:"_(+$G(D0)))
"RTN","OCXOCMPV",59,0)
 .D MESG(" Error... Order Check Routine Compile Aborted.")
"RTN","OCXOCMPV",60,0)
 ;
"RTN","OCXOCMPV",61,0)
 S OCXWARN=$G(OCXWARN)+1
"RTN","OCXOCMPV",62,0)
 N OCXSP,OCXST,OCXTXT,OCXLEN,OCXZZZ,OCXCNT
"RTN","OCXOCMPV",63,0)
 S OCXLEN=60,OCXTXT="Compiler Warning # "_OCXWARN
"RTN","OCXOCMPV",64,0)
 I ($D(X)>2) S OCXCNT=0 F  S OCXCNT=$O(X(OCXCNT)) Q:'OCXCNT  D
"RTN","OCXOCMPV",65,0)
 .I ($L(X(OCXCNT))>OCXLEN),($L(X(OCXCNT))<80) S OCXLEN=$L(X(OCXCNT))
"RTN","OCXOCMPV",66,0)
 S (OCXSP,OCXST)="",$P(OCXST,"*",150)="*",$P(OCXSP," ",150)=" "
"RTN","OCXOCMPV",67,0)
 W !!
"RTN","OCXOCMPV",68,0)
 W !,$E(OCXST,1,OCXLEN+6)
"RTN","OCXOCMPV",69,0)
 W !,"**",$E(OCXSP,1,OCXLEN+2),"**"
"RTN","OCXOCMPV",70,0)
 W !,"** ",OCXTXT,$E(OCXSP,$L(OCXTXT),OCXLEN-1)," **"
"RTN","OCXOCMPV",71,0)
 W:$L($G(RLINE)) !,"** ",RLINE,$E(OCXSP,$L(RLINE),OCXLEN-1)," **"
"RTN","OCXOCMPV",72,0)
 W !,"**",$E(OCXSP,1,OCXLEN+2),"**"
"RTN","OCXOCMPV",73,0)
 S OCXGL="^OCXS" S:(FILE=1) OCXGL="^OCXD" S:(FILE=7) OCXGL="^OCXD" S:(FILE=10) OCXGL="^OCXD" S FILE=FILE/10+860
"RTN","OCXOCMPV",74,0)
 I $G(FILE),$G(D0),$D(@OCXGL@(FILE,D0,0)) D
"RTN","OCXOCMPV",75,0)
 .S OCXTXT=$P(@OCXGL@(FILE,0),U,1)
"RTN","OCXOCMPV",76,0)
 .W !,"** ",OCXTXT,$E(OCXSP,$L(OCXTXT),OCXLEN-1)," **"
"RTN","OCXOCMPV",77,0)
 .S OCXTXT="   "_$P(@OCXGL@(FILE,D0,0),U,1)
"RTN","OCXOCMPV",78,0)
 .W !,"** ",OCXTXT,$E(OCXSP,$L(OCXTXT),OCXLEN-1)," **"
"RTN","OCXOCMPV",79,0)
 W !,"**",$E(OCXSP,1,OCXLEN+2),"**"
"RTN","OCXOCMPV",80,0)
 I ($D(X)#2) D
"RTN","OCXOCMPV",81,0)
 .W !,"** " F OCXCNT=1:1:$L(X," ") D
"RTN","OCXOCMPV",82,0)
 ..I (($X+$L($P(X," ",OCXCNT)))>OCXLEN) W $E(OCXSP,$X,OCXLEN+2)," **",!,"** "
"RTN","OCXOCMPV",83,0)
 ..W $P(X," ",OCXCNT)," "
"RTN","OCXOCMPV",84,0)
 .W $E(OCXSP,$X,OCXLEN+2)," **"
"RTN","OCXOCMPV",85,0)
 I ($D(X)>2) S OCXCNT=0 F  S OCXCNT=$O(X(OCXCNT)) Q:'OCXCNT  D
"RTN","OCXOCMPV",86,0)
 .W !,"** ",X(OCXCNT),$E(OCXSP,$X,OCXLEN+2)," **"
"RTN","OCXOCMPV",87,0)
 W !,$E(OCXST,1,OCXLEN+6)
"RTN","OCXOCMPV",88,0)
 W !!!,"Press <Return> to continue... " R OCXZZZ:DTIME
"RTN","OCXOCMPV",89,0)
 Q
"RTN","OCXOCMPV",90,0)
 K D0
"RTN","OCXOCMPV",91,0)
 ;
"RTN","OCXOCMPV",92,0)
READ(OCXZ0,OCXZA,OCXZB,OCXZL) ;
"RTN","OCXOCMPV",93,0)
 N OCXLINE,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","OCXOCMPV",94,0)
 Q:'$L($G(OCXZ0)) U
"RTN","OCXOCMPV",95,0)
 S DIR(0)=OCXZ0
"RTN","OCXOCMPV",96,0)
 S:$L($G(OCXZA)) DIR("A")=OCXZA
"RTN","OCXOCMPV",97,0)
 S:$L($G(OCXZB)) DIR("B")=OCXZB
"RTN","OCXOCMPV",98,0)
 F OCXLINE=1:1:($G(OCXZL)-1) W !
"RTN","OCXOCMPV",99,0)
 D ^DIR
"RTN","OCXOCMPV",100,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","OCXOCMPV",101,0)
 Q Y
"RTN","OCXOCMPV",102,0)
 ;
"RTN","OCXOCMPV",103,0)
 Q
"RTN","OCXOCMPV",104,0)
 ;
"RTN","OCXOCMPV",105,0)
DT(X,D) N Y,%DT S %DT=D D ^%DT Q Y
"RTN","OCXOCMPV",106,0)
 Q
"RTN","OCXOCMPV",107,0)
 ;
"RTN","OCXOCMPV",108,0)
CNT(X) ;
"RTN","OCXOCMPV",109,0)
 ;
"RTN","OCXOCMPV",110,0)
 N CNT,D0
"RTN","OCXOCMPV",111,0)
 S D0=0 F CNT=1:1 S D0=$O(@X@(D0)) Q:'D0
"RTN","OCXOCMPV",112,0)
 W !!,?10,X,"  ",CNT
"RTN","OCXOCMPV",113,0)
 Q CNT
"RTN","OCXOCMPV",114,0)
 ;
"RTN","OCXOCMPV",115,0)
AUTO ;
"RTN","OCXOCMPV",116,0)
 N OCXD0,OCXD1,OCXWARN,OCXNAM,OCXTRACE,OCXAUTO,OCXOETIM,OCXTSPI
"RTN","OCXOCMPV",117,0)
 S OCXWARN=0,OCXOETIM=$H
"RTN","OCXOCMPV",118,0)
 K ^TMP("OCXCMP",$J)
"RTN","OCXOCMPV",119,0)
 S ^TMP("OCXCMP",$J)=($P($H,",",2)+($H*86400)+(2*60*60))_" <- ^TMP ENTRY EXPIRATION DATE FOR ^OCXOPURG"
"RTN","OCXOCMPV",120,0)
 ;
"RTN","OCXOCMPV",121,0)
 ;  Compiler Constants
"RTN","OCXOCMPV",122,0)
 ;
"RTN","OCXOCMPV",123,0)
 S OCXCLL=200      ; compiled code line length
"RTN","OCXOCMPV",124,0)
 S OCXCRS=8000     ; compiled routine size
"RTN","OCXOCMPV",125,0)
 S OCXTSPI=300     ; Duplicate triggered Rule message "ignore period" in seconds
"RTN","OCXOCMPV",126,0)
 ;
"RTN","OCXOCMPV",127,0)
 S OCXTRACE=0      ; Program Execution Trace Mode (OFF)
"RTN","OCXOCMPV",128,0)
 S OCXTLOG=0       ; Elapsed time logging (OFF)
"RTN","OCXOCMPV",129,0)
 S OCXDLOG=0       ; Raw Data Logging (OFF)
"RTN","OCXOCMPV",130,0)
 S OCXAUTO=1       ; Compile in the Background Mode (ON)
"RTN","OCXOCMPV",131,0)
 ;
"RTN","OCXOCMPV",132,0)
 D SETFLAG
"RTN","OCXOCMPV",133,0)
 L +^OCXD(861,1):5 E  D ERMESG("Run aborted. Another compiler run has ^OCXD(861,1) locked."),BULL(DUZ),KILLFLAG Q
"RTN","OCXOCMPV",134,0)
 D RUN^OCXOCMP,BULL(DUZ),KILLFLAG
"RTN","OCXOCMPV",135,0)
 L -^OCXD(861,1)
"RTN","OCXOCMPV",136,0)
 ;
"RTN","OCXOCMPV",137,0)
 K ^TMP("OCXCMP",$J)
"RTN","OCXOCMPV",138,0)
 ;
"RTN","OCXOCMPV",139,0)
 Q
"RTN","OCXOCMPV",140,0)
 ;
"RTN","OCXOCMPV",141,0)
BULL(OCXDUZ) ;
"RTN","OCXOCMPV",142,0)
 I $L($T(^XMB)) D
"RTN","OCXOCMPV",143,0)
 .;
"RTN","OCXOCMPV",144,0)
 .N XMB,XMDUZ,XMY,OCXTIME
"RTN","OCXOCMPV",145,0)
 .S OCXTIME=$H-OCXOETIM*86400
"RTN","OCXOCMPV",146,0)
 .S OCXTIME=OCXTIME+($P($H,",",2)-$P(OCXOETIM,",",2))
"RTN","OCXOCMPV",147,0)
 .S XMB="OCX COMPILER RUN"
"RTN","OCXOCMPV",148,0)
 .S XMB(1)=$P($T(+3),";;",3)
"RTN","OCXOCMPV",149,0)
 .S XMB(2)=$$CONV($$DATE)
"RTN","OCXOCMPV",150,0)
 .S XMB(3)=""
"RTN","OCXOCMPV",151,0)
 .S:$G(OCXDUZ) XMB(3)="["_OCXDUZ_"]  "_$P($G(^VA(200,OCXDUZ,0)),U,1)
"RTN","OCXOCMPV",152,0)
 .S XMB(4)=(OCXTIME\60)_" minutes "_(OCXTIME#60)_" seconds "
"RTN","OCXOCMPV",153,0)
 .S XMB(5)=$S(($G(OCXAUTO)>1):"Queued",$G(OCXAUTO):"Automatic Mode",1:"Interactive Mode")
"RTN","OCXOCMPV",154,0)
 .S XMB(6)=$S($G(OCXTRACE):" ON",1:"OFF")
"RTN","OCXOCMPV",155,0)
 .S XMB(7)=" " ; $S($G(OCXTLOG):" ON",1:"OFF")
"RTN","OCXOCMPV",156,0)
 .S XMB(8)=$S($G(OCXDLOG):(" ON  Keep data for "_OCXDLOG_" day"_$S(OCXDLOG=1:"",1:"s")_" then purge."),1:"OFF")
"RTN","OCXOCMPV",157,0)
 .S XMB(9)="No longer tracked" ; $S($G(OCXLCNT):OCXLCNT,1:"Zero")
"RTN","OCXOCMPV",158,0)
 .S XMB(10)=$G(OCXERRM)
"RTN","OCXOCMPV",159,0)
 .S XMB(11)=$S($L($G(OCXERRM)):"ABORTED",1:"has completed normally")
"RTN","OCXOCMPV",160,0)
 .S XMY("G.OCX DEVELOPERS@ISC-SLC.VA.GOV")=""
"RTN","OCXOCMPV",161,0)
 .S XMY("G.OCX DEVELOPERS")=""
"RTN","OCXOCMPV",162,0)
 .S XMY(OCXDUZ)=""
"RTN","OCXOCMPV",163,0)
 .S XMDUZ=.5
"RTN","OCXOCMPV",164,0)
 .S XMDT="N"
"RTN","OCXOCMPV",165,0)
 .D ^XMB
"RTN","OCXOCMPV",166,0)
 ;
"RTN","OCXOCMPV",167,0)
 Q
"RTN","OCXOCMPV",168,0)
 ;
"RTN","OCXOCMPV",169,0)
DATE() N X,Y,%DT S X="N",%DT="T" D ^%DT X ^DD("DD") Q Y
"RTN","OCXOCMPV",170,0)
 ;
"RTN","OCXOCMPV",171,0)
CONV(Y) Q:'(Y["@") Y Q $P(Y,"@",1)_" at "_$P(Y,"@",2,99)
"RTN","OCXOCMPV",172,0)
 ;
"RTN","OCXOCMPV",173,0)
SETFLAG ;
"RTN","OCXOCMPV",174,0)
 I '($P($G(^OCXD(861,1,0)),U,1)="SITE PREFERENCES") K ^OCXD(861,1) S ^OCXD(861,1,0)="SITE PREFERENCES"
"RTN","OCXOCMPV",175,0)
 S $P(^OCXD(861,1,0),U,3)=$H
"RTN","OCXOCMPV",176,0)
 Q
"RTN","OCXOCMPV",177,0)
 ;
"RTN","OCXOCMPV",178,0)
KILLFLAG ;
"RTN","OCXOCMPV",179,0)
 ;
"RTN","OCXOCMPV",180,0)
 I '($P($G(^OCXD(861,1,0)),U,1)="SITE PREFERENCES") K ^OCXD(861,1) S ^OCXD(861,1,0)="SITE PREFERENCES"
"RTN","OCXOCMPV",181,0)
 S $P(^OCXD(861,1,0),U,3)=""
"RTN","OCXOCMPV",182,0)
 Q
"RTN","OCXOCMPV",183,0)
 ;
"RTN","OCXOCMPV",184,0)
QUE(OCXADD) ;
"RTN","OCXOCMPV",185,0)
 ;
"RTN","OCXOCMPV",186,0)
 N ZTCPU,ZTDESC,ZTDTH,ZTIO,ZTPAR,ZTPRE,ZTPRI,ZTRTN,ZTSAVE,ZTSK,ZTUCI
"RTN","OCXOCMPV",187,0)
 N OCXDUZ
"RTN","OCXOCMPV",188,0)
 ;
"RTN","OCXOCMPV",189,0)
 S ZTDTH=$P($H,",",2)+OCXADD,OCXADD=0
"RTN","OCXOCMPV",190,0)
 I (ZTDTH>86400) S ZTDTH=(86400-ZTDTH),OCXADD=1
"RTN","OCXOCMPV",191,0)
 S ZTDTH=($H+OCXADD)_","_ZTDTH
"RTN","OCXOCMPV",192,0)
 S OCXDUZ=$G(DUZ)
"RTN","OCXOCMPV",193,0)
 S ZTIO="",ZTRTN="TASK^OCXOCMPV",ZTDESC="Queued Compiler: "_$P($T(+3),";;",2)
"RTN","OCXOCMPV",194,0)
 K ZTSAVE,ZTCPU,ZTUCI,ZTPRI,ZTPAR,ZTPRE
"RTN","OCXOCMPV",195,0)
 S ZTSAVE("OCXDUZ")=""
"RTN","OCXOCMPV",196,0)
 ;
"RTN","OCXOCMPV",197,0)
 D ^%ZTLOAD
"RTN","OCXOCMPV",198,0)
 ;
"RTN","OCXOCMPV",199,0)
 Q
"RTN","OCXOCMPV",200,0)
 ;
"RTN","OCXOCMPV",201,0)
TASK ;
"RTN","OCXOCMPV",202,0)
 ;
"RTN","OCXOCMPV",203,0)
 N OCXD0,OCXD1,OCXWARN,OCXNAM,OCXTRACE,OCXAUTO,OCXOETIM,OCXTSPI
"RTN","OCXOCMPV",204,0)
 S OCXWARN=0,OCXOETIM=$H
"RTN","OCXOCMPV",205,0)
 K ^TMP("OCXCMP",$J)
"RTN","OCXOCMPV",206,0)
 S ^TMP("OCXCMP",$J)=($P($H,",",2)+($H*86400)+(2*60*60))_" <- ^TMP ENTRY EXPIRATION DATE FOR ^OCXOPURG"
"RTN","OCXOCMPV",207,0)
 ;
"RTN","OCXOCMPV",208,0)
 ;  Compiler Constants
"RTN","OCXOCMPV",209,0)
 ;
"RTN","OCXOCMPV",210,0)
 S OCXCLL=200      ; compiled code line length
"RTN","OCXOCMPV",211,0)
 S OCXCRS=8000     ; compiled routine size
"RTN","OCXOCMPV",212,0)
 S OCXTSPI=300     ; Duplicate triggered Rule message "ignore period" in seconds
"RTN","OCXOCMPV",213,0)
 ;
"RTN","OCXOCMPV",214,0)
 S OCXDATA="0^0^0"
"RTN","OCXOCMPV",215,0)
 I $L($T(CDATA^OCXOZ01)) S OCXDATA=$$CDATA^OCXOZ01
"RTN","OCXOCMPV",216,0)
 ;
"RTN","OCXOCMPV",217,0)
 S OCXTRACE=$P(OCXDATA,U,1),OCXTLOG=$P(OCXDATA,U,2),OCXDLOG=$P(OCXDATA,U,3)
"RTN","OCXOCMPV",218,0)
 ;
"RTN","OCXOCMPV",219,0)
 S OCXAUTO=2       ; Compile in the Background Mode (ON QUEUED)
"RTN","OCXOCMPV",220,0)
 ;
"RTN","OCXOCMPV",221,0)
 D SETFLAG
"RTN","OCXOCMPV",222,0)
 L +^OCXD(861,1):5 E  D QUE^OCXOCMPV(300),ERMESG("Run rescheduled. Another compiler run has ^OCXD(861,1) locked."),BULL(OCXDUZ),KILLFLAG Q
"RTN","OCXOCMPV",223,0)
 D RUN^OCXOCMP,BULL(OCXDUZ),KILLFLAG
"RTN","OCXOCMPV",224,0)
 L -^OCXD(861,1)
"RTN","OCXOCMPV",225,0)
 ;
"RTN","OCXOCMPV",226,0)
 K ^TMP("OCXCMP",$J)
"RTN","OCXOCMPV",227,0)
 ;
"RTN","OCXOCMPV",228,0)
 I $G(ZTSK) D KILL^%ZTLOAD
"RTN","OCXOCMPV",229,0)
 ;
"RTN","OCXOCMPV",230,0)
 Q
"RTN","OCXOCMPV",231,0)
 ;
"RTN","OCXSEND")
0^198^B23135487
"RTN","OCXSEND",1,0)
OCXSEND ;SLC/RJS,CLA - BUILD RULE TRANSPORTER ROUTINES ;2/22/08  12:30
"RTN","OCXSEND",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**32,74,96,105,243**;Dec 17,1997;Build 242
"RTN","OCXSEND",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","OCXSEND",4,0)
 ;
"RTN","OCXSEND",5,0)
S ;
"RTN","OCXSEND",6,0)
 N X,IOP,TOTL S TOTL=0
"RTN","OCXSEND",7,0)
 N CVER,RCNT,RSIZE,LASTFILE,HEADER1,HEADER2,HEADER3,HEADER4,HEADER5
"RTN","OCXSEND",8,0)
 N OCXASK,OCXID,OCXLIN2,OCXLIN3,OCXPATCH,OCXSCR,PARM,PARMV,DIE,DIERR,DIQ2,FCPARM,TEXT
"RTN","OCXSEND",9,0)
 I '$D(IOM) S IOP=0 D ^%ZIS K IOP
"RTN","OCXSEND",10,0)
 K ^TMP("OCXSEND",$J),^UTILITY($J),OCXPATH
"RTN","OCXSEND",11,0)
 K ^UTILITY($J),OCXPATH
"RTN","OCXSEND",12,0)
 S ^TMP("OCXSEND",$J)=($P($H,",",2)+($H*86400)+(4*60*60))_" <- ^TMP ENTRY EXPIRATION DATE FOR ^OCXOPURG"
"RTN","OCXSEND",13,0)
 S OCXLIN2=$T(+2)
"RTN","OCXSEND",14,0)
 S OCXLIN3=$T(+3)
"RTN","OCXSEND",15,0)
 ;
"RTN","OCXSEND",16,0)
 D ^OCXSEND1 ; Get List of Objects to Transport
"RTN","OCXSEND",17,0)
 ;
"RTN","OCXSEND",18,0)
 I '$O(^TMP("OCXSEND",$J,"LIST",0)) K ^TMP("OCXSEND",$J) Q  ; Nothing selected so Quit
"RTN","OCXSEND",19,0)
 ;
"RTN","OCXSEND",20,0)
 S OCXASK="" F  D  Q:$L(OCXASK)
"RTN","OCXSEND",21,0)
 .W !
"RTN","OCXSEND",22,0)
 .W !,"When the transport routine encounters locally"
"RTN","OCXSEND",23,0)
 .W !,"altered rule data at a site, do you want to:"
"RTN","OCXSEND",24,0)
 .;
"RTN","OCXSEND",25,0)
 .S OCXASK=$$READ("S^O:Overwrite local data;D:Display locally altered data only;A:Ask the site what to do","(O)verwrite, (D)isplay, or (A)sk the site ? ","Ask")
"RTN","OCXSEND",26,0)
 ;
"RTN","OCXSEND",27,0)
 Q:(OCXASK[U)
"RTN","OCXSEND",28,0)
 I (OCXASK="O") W !!,"Locally altered data will be overwritten without asking.",!!
"RTN","OCXSEND",29,0)
 I (OCXASK="D") W !!,"Locally altered data will be displayed only.",!!
"RTN","OCXSEND",30,0)
 I (OCXASK="A") W !!,"Sites will be asked before locally altered data is overwritten.",!!
"RTN","OCXSEND",31,0)
 ;
"RTN","OCXSEND",32,0)
 S OCXPATCH="" F  D  Q:$L(OCXPATCH)
"RTN","OCXSEND",33,0)
 .W !!,"Enter Patch ID (ex. OR*3*96): " R OCXPATCH:DTIME E  S OCXPATCH="^" Q
"RTN","OCXSEND",34,0)
 .Q:(OCXPATCH="^")
"RTN","OCXSEND",35,0)
 .I '$L(OCXPATCH) S OCXPATCH="^^" Q
"RTN","OCXSEND",36,0)
 .I $L(OCXPATCH),'(OCXPATCH?1"OR*"1N1"*"1.4N) D  S OCXPATCH="" Q
"RTN","OCXSEND",37,0)
 ..W !!
"RTN","OCXSEND",38,0)
 ..W:'(OCXPATCH["?") "Invalid"
"RTN","OCXSEND",39,0)
 ..W " Format -> OR*v*ppp"
"RTN","OCXSEND",40,0)
 ..W !,"   v = Package Version."
"RTN","OCXSEND",41,0)
 ..W !," ppp = Patch Number."
"RTN","OCXSEND",42,0)
 ..W !
"RTN","OCXSEND",43,0)
 Q:(OCXPATCH="^")
"RTN","OCXSEND",44,0)
 S:(OCXPATCH="^^") OCXPATCH=""
"RTN","OCXSEND",45,0)
 I $P(OCXPATCH,"*",3) S $P(OCXLIN2,";",5)="**"_$P(OCXPATCH,"*",3)_"**"
"RTN","OCXSEND",46,0)
 I $L(OCXPATCH) S OCXPATCH="(Delete after Install of "_OCXPATCH_")"
"RTN","OCXSEND",47,0)
 ;
"RTN","OCXSEND",48,0)
 Q:'$$RSDEL
"RTN","OCXSEND",49,0)
 ;
"RTN","OCXSEND",50,0)
 D ^OCXSEND2 ; Get File Data
"RTN","OCXSEND",51,0)
 ;
"RTN","OCXSEND",52,0)
 S TOTL=$$EN^OCXSEND3 ; File Routines
"RTN","OCXSEND",53,0)
 ;
"RTN","OCXSEND",54,0)
 S TOTL=TOTL+$$EN^OCXSENDA ; File Main Runtime Library Routine
"RTN","OCXSEND",55,0)
 ;
"RTN","OCXSEND",56,0)
 S TOTL=TOTL+$$EN^OCXSEND4 ; File Utility Runtime Library Routine 0
"RTN","OCXSEND",57,0)
 ;
"RTN","OCXSEND",58,0)
 S TOTL=TOTL+$$EN^OCXSEND5 ; File Utility Runtime Library Routine 1
"RTN","OCXSEND",59,0)
 ;
"RTN","OCXSEND",60,0)
 S TOTL=TOTL+$$EN^OCXSEND6 ; File Utility Runtime Library Routine 2
"RTN","OCXSEND",61,0)
 ;
"RTN","OCXSEND",62,0)
 S TOTL=TOTL+$$EN^OCXSEND7 ; File Utility Runtime Library Routine 3
"RTN","OCXSEND",63,0)
 ;
"RTN","OCXSEND",64,0)
 S TOTL=TOTL+$$EN^OCXSEND8 ; File Utility Runtime Library Routine 4
"RTN","OCXSEND",65,0)
 ;
"RTN","OCXSEND",66,0)
EXIT K ^TMP("OCXSEND",$J),^UTILITY($J)
"RTN","OCXSEND",67,0)
 ;
"RTN","OCXSEND",68,0)
 W !!,"Routines filed.",!!
"RTN","OCXSEND",69,0)
 ;
"RTN","OCXSEND",70,0)
 Q
"RTN","OCXSEND",71,0)
 ;
"RTN","OCXSEND",72,0)
READ(OCX0,OCXA,OCXB,OCXL) ;
"RTN","OCXSEND",73,0)
 N X,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","OCXSEND",74,0)
 Q:'$L($G(OCX0)) U
"RTN","OCXSEND",75,0)
 S DIR(0)=OCX0
"RTN","OCXSEND",76,0)
 S:$L($G(OCXA)) DIR("A")=OCXA
"RTN","OCXSEND",77,0)
 S:$L($G(OCXB)) DIR("B")=OCXB
"RTN","OCXSEND",78,0)
 F X=1:1:($G(OCXL)-1) W !
"RTN","OCXSEND",79,0)
 D ^DIR
"RTN","OCXSEND",80,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","OCXSEND",81,0)
 Q Y
"RTN","OCXSEND",82,0)
 ;
"RTN","OCXSEND",83,0)
CUCI() Q:'$D(^%ZOSF("UCI")) "" N Y X ^%ZOSF("UCI") Q Y
"RTN","OCXSEND",84,0)
 ;
"RTN","OCXSEND",85,0)
NETNAME() ;
"RTN","OCXSEND",86,0)
 N NETNAME
"RTN","OCXSEND",87,0)
 S NETNAME=$P($$NETNAME^XMXUTIL(DUZ),"@",2)
"RTN","OCXSEND",88,0)
 I $L(NETNAME) Q NETNAME
"RTN","OCXSEND",89,0)
 ; Q:$L($G(^XMB("NETNAME"))) ^XMB("NETNAME")
"RTN","OCXSEND",90,0)
 ; Q:$L($G(^XMB("NAME"))) ^XMB("NAME")
"RTN","OCXSEND",91,0)
 Q $$CUCI
"RTN","OCXSEND",92,0)
 ;
"RTN","OCXSEND",93,0)
RSDEL() ;
"RTN","OCXSEND",94,0)
 ;
"RTN","OCXSEND",95,0)
 W !!,"Scanning for old rule transport routines..."
"RTN","OCXSEND",96,0)
 N X,CNT,RCNT,RLIST,RNAME
"RTN","OCXSEND",97,0)
 S RCNT=0
"RTN","OCXSEND",98,0)
 ;
"RTN","OCXSEND",99,0)
 ;  Scan for Routines To Delete
"RTN","OCXSEND",100,0)
 ;
"RTN","OCXSEND",101,0)
 ; Main Routine
"RTN","OCXSEND",102,0)
 S RNAME=$$RNAME^OCXSEND3(0,0) I $$RFIND(RNAME,100) S RLIST(RNAME)=""
"RTN","OCXSEND",103,0)
 ;
"RTN","OCXSEND",104,0)
 ; Runtime Library routines
"RTN","OCXSEND",105,0)
 F CNT=0:1:35 S RNAME=$$RNAME^OCXSEND3(CNT,1) I $$RFIND(RNAME,CNT) S RLIST(RNAME)=""
"RTN","OCXSEND",106,0)
 ;
"RTN","OCXSEND",107,0)
 ; Data Routines
"RTN","OCXSEND",108,0)
 F CNT=0:1:46655 S RNAME=$$RNAME^OCXSEND3(CNT,2) I $$RFIND(RNAME,CNT) S RLIST(RNAME)=""
"RTN","OCXSEND",109,0)
 ;
"RTN","OCXSEND",110,0)
 I '$L($O(RLIST(""))) W !,"No old rule transport routines found..." H 2 Q 1
"RTN","OCXSEND",111,0)
 ;
"RTN","OCXSEND",112,0)
 W !!,"These routines will be deleted and overwritten."
"RTN","OCXSEND",113,0)
 Q:'$$READ("Y"," Do you want to proceed?","NO") 0
"RTN","OCXSEND",114,0)
 ;
"RTN","OCXSEND",115,0)
 ;    Delete The routines
"RTN","OCXSEND",116,0)
 ;
"RTN","OCXSEND",117,0)
 I '$D(^%ZOSF("DEL")) W !!,"Old rule transport routines not deleted (^%ZOSF(""DEL"") undefined)" Q 0
"RTN","OCXSEND",118,0)
 ;
"RTN","OCXSEND",119,0)
 S RNAME="" F RCNT=1:1 S RNAME=$O(RLIST(RNAME)) Q:'$L(RNAME)  D
"RTN","OCXSEND",120,0)
 .W !,RNAME
"RTN","OCXSEND",121,0)
 .I $$RDEL(RNAME) W "   Deleted..." Q
"RTN","OCXSEND",122,0)
 .W "   Not Deleted..."
"RTN","OCXSEND",123,0)
 ;
"RTN","OCXSEND",124,0)
 W !!,RCNT," routine",$S((RCNT=1):"",1:"s")," deleted."
"RTN","OCXSEND",125,0)
 ;
"RTN","OCXSEND",126,0)
 H 2 Q 1
"RTN","OCXSEND",127,0)
 ;
"RTN","OCXSEND",128,0)
RFIND(X,C) ;
"RTN","OCXSEND",129,0)
 W:($X>70) ! W:'(C#100) "."
"RTN","OCXSEND",130,0)
 Q:'$L(X) 0 X "S TEXT=$T(+1^"_X_")" Q:'$L(TEXT) 0
"RTN","OCXSEND",131,0)
 W !,X Q 1
"RTN","OCXSEND",132,0)
 Q
"RTN","OCXSEND",133,0)
 ;
"RTN","OCXSEND",134,0)
RDEL(X) ;
"RTN","OCXSEND",135,0)
 ;
"RTN","OCXSEND",136,0)
 Q:'$L(X) 0 X "S TEXT=$T(+1^"_X_")" Q:'$L(TEXT) 0
"RTN","OCXSEND",137,0)
 X ^%ZOSF("DEL") Q 1
"RTN","OCXSEND",138,0)
 ;
"RTN","OCXSEND3")
0^199^B11211964
"RTN","OCXSEND3",1,0)
OCXSEND3 ;SLC/RJS,CLA - BUILD RULE TRANSPORTER ROUTINES (Build Routines) ;1/31/01  08:51
"RTN","OCXSEND3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**32,74,96,105,243**;Dec 17,1997;Build 242
"RTN","OCXSEND3",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","OCXSEND3",4,0)
 ;
"RTN","OCXSEND3",5,0)
EN() ;
"RTN","OCXSEND3",6,0)
 ;
"RTN","OCXSEND3",7,0)
 N LAST,RLINE,RNUM,RTEXT,TOTLINE
"RTN","OCXSEND3",8,0)
 K ^TMP("OCXSEND",$J,"RTN") S ^TMP("OCXSEND",$J,"RTN",100,0)=" ;"
"RTN","OCXSEND3",9,0)
 S (TOTLINE,RSIZE,RLINE,RCNT)=0,RNUM=1 F  S RLINE=$O(^TMP("OCXSEND",$J,"DATA",RLINE)) Q:'RLINE  D
"RTN","OCXSEND3",10,0)
 .S RTEXT=$G(^TMP("OCXSEND",$J,"DATA",RLINE)) Q:'$L(RTEXT)
"RTN","OCXSEND3",11,0)
 .S LAST=$O(^TMP("OCXSEND",$J,"RTN",""),-1)+1,RCNT=RCNT+1,RSIZE=RSIZE+$L(RTEXT)
"RTN","OCXSEND3",12,0)
 .S ^TMP("OCXSEND",$J,"RTN",LAST,0)=" ;;"_RTEXT
"RTN","OCXSEND3",13,0)
 .I (RSIZE>6000) S TOTLINE=TOTLINE+$$RFILE($O(^TMP("OCXSEND",$J,"DATA",RLINE)),.RNUM) S (RSIZE,RCNT)=0
"RTN","OCXSEND3",14,0)
 I $O(^TMP("OCXSEND",$J,"RTN",100)) S TOTLINE=TOTLINE+$$RFILE(0,.RNUM)
"RTN","OCXSEND3",15,0)
 ;
"RTN","OCXSEND3",16,0)
 Q TOTLINE
"RTN","OCXSEND3",17,0)
 ;
"RTN","OCXSEND3",18,0)
RFILE(LINK,RNUM) ;
"RTN","OCXSEND3",19,0)
 ;
"RTN","OCXSEND3",20,0)
 N DIE,LAST,X,XCN
"RTN","OCXSEND3",21,0)
 D HDR(LINK,RNUM)
"RTN","OCXSEND3",22,0)
 S LAST=$O(^TMP("OCXSEND",$J,"RTN",""),-1)+1
"RTN","OCXSEND3",23,0)
 S ^TMP("OCXSEND",$J,"RTN",LAST,0)=" ;1;"
"RTN","OCXSEND3",24,0)
 S ^TMP("OCXSEND",$J,"RTN",LAST+1,0)=" ;"
"RTN","OCXSEND3",25,0)
 S ^TMP("OCXSEND",$J,"RTN",LAST+2,0)="$"
"RTN","OCXSEND3",26,0)
 S DIE="^TMP(""OCXSEND"","_$J_",""RTN"",",XCN=0
"RTN","OCXSEND3",27,0)
 S X=$$RNAME(RNUM,2)
"RTN","OCXSEND3",28,0)
 W !,X
"RTN","OCXSEND3",29,0)
 X ^%ZOSF("SAVE")
"RTN","OCXSEND3",30,0)
 S RNUM=RNUM+1
"RTN","OCXSEND3",31,0)
 K ^TMP("OCXSEND",$J,"RTN") S ^TMP("OCXSEND",$J,"RTN",100,0)=" ;"
"RTN","OCXSEND3",32,0)
 Q ""
"RTN","OCXSEND3",33,0)
 ;
"RTN","OCXSEND3",34,0)
NOW() ;
"RTN","OCXSEND3",35,0)
 N X,Y,%DT
"RTN","OCXSEND3",36,0)
 S X="N",%DT="T" D ^%DT S Y=$$DATE^OCXSENDD(Y)
"RTN","OCXSEND3",37,0)
 I (Y["@") S Y=$P(Y,"@",1)_" at "_$P(Y,"@",2)
"RTN","OCXSEND3",38,0)
 Q Y
"RTN","OCXSEND3",39,0)
 ;
"RTN","OCXSEND3",40,0)
HDR(LINK,RNUM) ;
"RTN","OCXSEND3",41,0)
 ;
"RTN","OCXSEND3",42,0)
 N R,LINE,TEXT,RNAME,RLINK,NOW
"RTN","OCXSEND3",43,0)
 S NOW=$$NOW
"RTN","OCXSEND3",44,0)
 I 'LINK S RLINK=";"
"RTN","OCXSEND3",45,0)
 E  S RLINK="G ^"_$$RNAME(RNUM+1,2)
"RTN","OCXSEND3",46,0)
 S RNAME=$$RNAME(RNUM,2),(HEADER1,HEADER2,HEADER3,HEADER4,HEADER5)=";"
"RTN","OCXSEND3",47,0)
 ;
"RTN","OCXSEND3",48,0)
 F LINE=1:1:999 S TEXT=$P($T(TEXT+LINE),";",2,999) Q:TEXT  S TEXT=$P(TEXT,";",2,999) S R(LINE,0)=$$CONV(TEXT)
"RTN","OCXSEND3",49,0)
 ;
"RTN","OCXSEND3",50,0)
 M ^TMP("OCXSEND",$J,"RTN")=R
"RTN","OCXSEND3",51,0)
 ;
"RTN","OCXSEND3",52,0)
 Q
"RTN","OCXSEND3",53,0)
 ;
"RTN","OCXSEND3",54,0)
HEX(X) Q:'X "" Q $$HEX(X\36)_$E("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",((X#36)+1))
"RTN","OCXSEND3",55,0)
 ;
"RTN","OCXSEND3",56,0)
RNAME(X,Y) ;
"RTN","OCXSEND3",57,0)
 ; Y=0  -> Main Routine
"RTN","OCXSEND3",58,0)
 ; Y=1  -> Runtime Library Routine
"RTN","OCXSEND3",59,0)
 ; Y=2  -> Data Routine for ORYppp
"RTN","OCXSEND3",60,0)
 ; Y=3  -> Data Routine for OCXRU
"RTN","OCXSEND3",61,0)
 ;
"RTN","OCXSEND3",62,0)
 N OCXRN1,OCXRN2,OCXSEQ
"RTN","OCXSEND3",63,0)
 ;
"RTN","OCXSEND3",64,0)
 S OCXRN1="OCXRULE",OCXRN2="OCXRU"
"RTN","OCXSEND3",65,0)
 S:$L($G(OCXPATCH)) OCXRN2="ORY"_$E((1000+$P(OCXPATCH,"*",3)),2,4),OCXRN1=OCXRN2_"ES"
"RTN","OCXSEND3",66,0)
 ;
"RTN","OCXSEND3",67,0)
 Q:'Y OCXRN1
"RTN","OCXSEND3",68,0)
 ;
"RTN","OCXSEND3",69,0)
 I (Y=1),(X>35) Q ""
"RTN","OCXSEND3",70,0)
 I (Y=2),'$L($G(OCXPATCH)) S Y=3
"RTN","OCXSEND3",71,0)
 I (Y=2),(X>1295) Q ""
"RTN","OCXSEND3",72,0)
 I (Y=3),(X>46655) Q ""
"RTN","OCXSEND3",73,0)
 ;
"RTN","OCXSEND3",74,0)
 S OCXSEQ=0 S:X OCXSEQ=$$HEX(X)
"RTN","OCXSEND3",75,0)
 S OCXSEQ="00000"_OCXSEQ
"RTN","OCXSEND3",76,0)
 S OCXSEQ=$E(OCXSEQ,($L(OCXSEQ)-Y+1),$L(OCXSEQ))
"RTN","OCXSEND3",77,0)
 ;
"RTN","OCXSEND3",78,0)
 Q OCXRN2_OCXSEQ
"RTN","OCXSEND3",79,0)
 ;
"RTN","OCXSEND3",80,0)
CONV(X) ;
"RTN","OCXSEND3",81,0)
 N VAL
"RTN","OCXSEND3",82,0)
 F  Q:'(X["|")  D
"RTN","OCXSEND3",83,0)
 .S VAL=$P(X,"|",2)
"RTN","OCXSEND3",84,0)
 .X "S VAL="_VAL
"RTN","OCXSEND3",85,0)
 .S X=$P(X,"|",1)_VAL_$P(X,"|",3,999)
"RTN","OCXSEND3",86,0)
 I '(X="$"),'$L($P(X," ",2)) S X=X_" ;"
"RTN","OCXSEND3",87,0)
 Q X
"RTN","OCXSEND3",88,0)
 ;
"RTN","OCXSEND3",89,0)
TEXT ;
"RTN","OCXSEND3",90,0)
 ;;|RNAME| ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE |OCXPATCH| ;|NOW|
"RTN","OCXSEND3",91,0)
 ;;|OCXLIN2|
"RTN","OCXSEND3",92,0)
 ;;|OCXLIN3|
"RTN","OCXSEND3",93,0)
 ;; ;
"RTN","OCXSEND3",94,0)
 ;;S ;
"RTN","OCXSEND3",95,0)
 ;; ;
"RTN","OCXSEND3",96,0)
 ;; D DOT^|$$RNAME^OCXSEND3(0,0)|
"RTN","OCXSEND3",97,0)
 ;; ;
"RTN","OCXSEND3",98,0)
 ;; ;
"RTN","OCXSEND3",99,0)
 ;; K REMOTE,LOCAL,OPCODE,REF
"RTN","OCXSEND3",100,0)
 ;; F LINE=1:1:500 S TEXT=$P($T(DATA+LINE),";",2,999) Q:TEXT  I $L(TEXT) D  Q:QUIT
"RTN","OCXSEND3",101,0)
 ;; .S ^TMP("OCXRULE",$J,$O(^TMP("OCXRULE",$J,"A"),-1)+1)=TEXT
"RTN","OCXSEND3",102,0)
 ;; ;
"RTN","OCXSEND3",103,0)
 ;; |RLINK|
"RTN","OCXSEND3",104,0)
 ;; ;
"RTN","OCXSEND3",105,0)
 ;; Q
"RTN","OCXSEND3",106,0)
 ;; ;
"RTN","OCXSEND3",107,0)
 ;;DATA ;
"RTN","OCXSEND3",108,0)
 ;1;
"RTN","OCXSEND3",109,0)
 ;
"RTN","OCXSEND4")
0^200^B21759136
"RTN","OCXSEND4",1,0)
OCXSEND4 ;SLC/RJS,CLA - BUILD RULE TRANSPORTER ROUTINES (Build Library Routine 0) ;2/01/01  09:56
"RTN","OCXSEND4",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**32,96,105,243**;Dec 17,1997;Build 242
"RTN","OCXSEND4",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","OCXSEND4",4,0)
 ;
"RTN","OCXSEND4",5,0)
EN() ;
"RTN","OCXSEND4",6,0)
 ;
"RTN","OCXSEND4",7,0)
 N R,LINE,TEXT,NOW,RUCI
"RTN","OCXSEND4",8,0)
 S NOW=$$NOW^OCXSEND3,RUCI=$$NETNAME^OCXSEND
"RTN","OCXSEND4",9,0)
 F LINE=1:1:999 S TEXT=$P($T(TEXT+LINE),";",2,999) Q:TEXT  S TEXT=$P(TEXT,";",2,999) S R(LINE,0)=$$CONV^OCXSEND3(TEXT)
"RTN","OCXSEND4",10,0)
 ;
"RTN","OCXSEND4",11,0)
 M ^TMP("OCXSEND",$J,"RTN")=R
"RTN","OCXSEND4",12,0)
 ;
"RTN","OCXSEND4",13,0)
 S DIE="^TMP(""OCXSEND"","_$J_",""RTN"",",XCN=0,X=$$RNAME^OCXSEND3(0,1)
"RTN","OCXSEND4",14,0)
 W !,X X ^%ZOSF("SAVE") K ^TMP("OCXSEND",$J,"RTN")
"RTN","OCXSEND4",15,0)
 ;
"RTN","OCXSEND4",16,0)
 Q " "
"RTN","OCXSEND4",17,0)
 ;
"RTN","OCXSEND4",18,0)
TEXT ;
"RTN","OCXSEND4",19,0)
 ;;|$$RNAME^OCXSEND3(0,1)| ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE |OCXPATCH| ;|NOW|
"RTN","OCXSEND4",20,0)
 ;;|OCXLIN2|
"RTN","OCXSEND4",21,0)
 ;;|OCXLIN3|
"RTN","OCXSEND4",22,0)
 ;; ;
"RTN","OCXSEND4",23,0)
 ;;S ;
"RTN","OCXSEND4",24,0)
 ;; ;
"RTN","OCXSEND4",25,0)
 ;; Q
"RTN","OCXSEND4",26,0)
 ;; ;
"RTN","OCXSEND4",27,0)
 ;;WARN(RTN,MSG,LINES) ;
"RTN","OCXSEND4",28,0)
 ;; ;
"RTN","OCXSEND4",29,0)
 ;; Q:$G(OCXAUTO)
"RTN","OCXSEND4",30,0)
 ;; ;
"RTN","OCXSEND4",31,0)
 ;; N DASH,LINE,NLINE,PLINE
"RTN","OCXSEND4",32,0)
 ;; ;
"RTN","OCXSEND4",33,0)
 ;; S DASH="",$P(DASH,"-",(55-$L(MSG)-2))="-"
"RTN","OCXSEND4",34,0)
 ;; W !!,"--------------",MSG,DASH
"RTN","OCXSEND4",35,0)
 ;; ;
"RTN","OCXSEND4",36,0)
 ;; W !,RTN,?10,"[|RUCI|] -> [",$$NETNAME^OCXSEND,"] Line"
"RTN","OCXSEND4",37,0)
 ;; ;
"RTN","OCXSEND4",38,0)
 ;; I $O(LINES($O(LINES(0)))) W "s: "
"RTN","OCXSEND4",39,0)
 ;; E  W ": "
"RTN","OCXSEND4",40,0)
 ;; ;
"RTN","OCXSEND4",41,0)
 ;; S LINE=0 F  S LINE=$O(LINES(LINE)) Q:'LINE  D
"RTN","OCXSEND4",42,0)
 ;; .W:($X>60) !,?40
"RTN","OCXSEND4",43,0)
 ;; .S NLINE=LINE F  S PLINE=NLINE,NLINE=$O(LINES(NLINE)) Q:(NLINE-PLINE-1)
"RTN","OCXSEND4",44,0)
 ;; .I (PLINE=LINE) W " ",LINE
"RTN","OCXSEND4",45,0)
 ;; .E  W " ",LINE,"-",PLINE S LINE=PLINE
"RTN","OCXSEND4",46,0)
 ;; ;
"RTN","OCXSEND4",47,0)
 ;; W ! Q
"RTN","OCXSEND4",48,0)
 ;; ;
"RTN","OCXSEND4",49,0)
 ;;TEXT(RTN,LINE) ;
"RTN","OCXSEND4",50,0)
 ;; ;
"RTN","OCXSEND4",51,0)
 ;; N TEXT X "S TEXT=$T(+"_(+LINE)_"^"_RTN_")" Q TEXT
"RTN","OCXSEND4",52,0)
 ;; ;
"RTN","OCXSEND4",53,0)
 ;;HEADER ;
"RTN","OCXSEND4",54,0)
 ;; ;
"RTN","OCXSEND4",55,0)
 ;; W !," Created: |NOW|  at  |RUCI|"
"RTN","OCXSEND4",56,0)
 ;; W !," Current Date: ",$$NOW,"  at  ",$$NETNAME^OCXSEND,!!
"RTN","OCXSEND4",57,0)
 ;; S LASTFILE=0 K ^TMP("OCXRULE",$J)
"RTN","OCXSEND4",58,0)
 ;; S ^TMP("OCXRULE",$J)=($P($H,",",2)+($H*86400)+(1*60*60))_" <- ^TMP ENTRY EXPIRATION DATE FOR ^OCXOPURG"
"RTN","OCXSEND4",59,0)
 ;; Q
"RTN","OCXSEND4",60,0)
 ;; ;
"RTN","OCXSEND4",61,0)
 ;;GETFILE(FILE,RECNAME,ARRAY) ;
"RTN","OCXSEND4",62,0)
 ;; ;
"RTN","OCXSEND4",63,0)
 ;; N CHECK,GLNEXT,GLREF,LINES,REC,DD,FLD
"RTN","OCXSEND4",64,0)
 ;; S REC=$$LOOKUP(FILE,RECNAME)
"RTN","OCXSEND4",65,0)
 ;; I 'REC W !!,$$FILENAME^OCXSENDD(FILE),": ",RECNAME Q 0
"RTN","OCXSEND4",66,0)
 ;; I (REC=-1) W !!,$$FILENAME^OCXSENDD(FILE),": ",RECNAME,"  duplicate local entries.",! Q 0
"RTN","OCXSEND4",67,0)
 ;; I (REC=-2) W !!,$$FILENAME^OCXSENDD(FILE)," (",FILE,") local file not found." W ! Q:$$PAUSE -10 Q REC
"RTN","OCXSEND4",68,0)
 ;; I (REC<0) W !!,$$FILENAME^OCXSENDD(FILE),": ",RECNAME,"  unknown lookup error." W ! Q:$$PAUSE -10 Q REC
"RTN","OCXSEND4",69,0)
 ;; I (REC>0) D
"RTN","OCXSEND4",70,0)
 ;; .S CHECK=0,LINES=0
"RTN","OCXSEND4",71,0)
 ;; .D GETREC($$FILE^OCXSENDD(FILE,"GLOBAL NAME"),"ARRAY(",REC,.ARRAY)
"RTN","OCXSEND4",72,0)
 ;; .S GLREF="ARRAY" F  S GLREF=$Q(@GLREF) Q:'$L(GLREF)  Q:'($E(GLREF,1,6)="ARRAY(")  K:'$L(@GLREF) @GLREF
"RTN","OCXSEND4",73,0)
 ;; ;
"RTN","OCXSEND4",74,0)
 ;; Q REC
"RTN","OCXSEND4",75,0)
 ;; ;
"RTN","OCXSEND4",76,0)
 ;;LKUPARRY(DD,KEY,ARRAY) ;
"RTN","OCXSEND4",77,0)
 ;; ;
"RTN","OCXSEND4",78,0)
 ;; N D0 S D0=0 F  S D0=$O(ARRAY(DD,D0)) Q:'D0  Q:($G(ARRAY(DD,D0,.01,"E"))=KEY)
"RTN","OCXSEND4",79,0)
 ;; Q D0
"RTN","OCXSEND4",80,0)
 ;; ;
"RTN","OCXSEND4",81,0)
 ;;LOOKUP(FILE,KEY) ;
"RTN","OCXSEND4",82,0)
 ;; I $O(^TMP("OCXRULE",$J,"B",FILE,KEY,0)) Q 0
"RTN","OCXSEND4",83,0)
 ;; N RECNAM,REC,D0,CNT,SHORT S (REC,CNT)=0
"RTN","OCXSEND4",84,0)
 ;; S GL=$$FILE^OCXSENDD(FILE,"GLOBAL NAME") Q:'$L(GL) -2 S GL=$E(GL,1,$L(GL)-1)_")"
"RTN","OCXSEND4",85,0)
 ;; S SHORT=$E(KEY,1,30),RECNAM=SHORT D  F  S RECNAM=$O(@GL@("B",RECNAM)) Q:'$L(RECNAM)  Q:'($E(RECNAM,1,$L(SHORT))=SHORT)  D
"RTN","OCXSEND4",86,0)
 ;; .S D0=0 F  S D0=$O(@GL@("B",RECNAM,D0)) Q:'D0  I ($P($G(@GL@(D0,0)),U,1)=KEY) S CNT=CNT+1,REC=D0_U_RECNAME
"RTN","OCXSEND4",87,0)
 ;; Q:(CNT>1) -1
"RTN","OCXSEND4",88,0)
 ;; S:$L($P(REC,U,2)) ^TMP("OCXRULE",$J,"A",FILE,$P(REC,U,2))=""
"RTN","OCXSEND4",89,0)
 ;; Q +REC
"RTN","OCXSEND4",90,0)
 ;; ;
"RTN","OCXSEND4",91,0)
 ;;GETREC(GL,PATH,D0,REM) ;
"RTN","OCXSEND4",92,0)
 ;; ;
"RTN","OCXSEND4",93,0)
 ;; Q:'($P($G(@(GL_"0)")),U,2))
"RTN","OCXSEND4",94,0)
 ;; N S1,DATA,DD
"RTN","OCXSEND4",95,0)
 ;; S DATA="" D DIQ(GL,D0,.DATA)
"RTN","OCXSEND4",96,0)
 ;; S DD=$O(DATA(0)) Q:'DD
"RTN","OCXSEND4",97,0)
 ;; ;
"RTN","OCXSEND4",98,0)
 ;; I $L($$FILE^OCXSENDD(DD,"NAME")) S PATH=PATH_""""_DD_":"_D0_""""
"RTN","OCXSEND4",99,0)
 ;; I '$L($$FILE^OCXSENDD(DD,"NAME")) S PATH=PATH_","""_DD_":"_D0_""""
"RTN","OCXSEND4",100,0)
 ;; M @(PATH_")")=DATA(DD,D0)
"RTN","OCXSEND4",101,0)
 ;; ;
"RTN","OCXSEND4",102,0)
 ;; S S1="" F  S S1=$O(@(GL_D0_","_$$SUB(S1)_")")) Q:'$L(S1)  I ($D(@(GL_D0_","_$$SUB(S1)_")"))>3) D
"RTN","OCXSEND4",103,0)
 ;; .N D1,GLREF S GLREF=GL_D0_","_$$SUB(S1)_","
"RTN","OCXSEND4",104,0)
 ;; .S D1=0 F  S D1=$O(@(GLREF_D1_")")) Q:'D1  D GETREC(GLREF,PATH,D1,.REM)
"RTN","OCXSEND4",105,0)
 ;; ;
"RTN","OCXSEND4",106,0)
 ;; Q
"RTN","OCXSEND4",107,0)
 ;; ;
"RTN","OCXSEND4",108,0)
 ;;SUB(X) Q:'(X=+X) """"_X_"""" Q X
"RTN","OCXSEND4",109,0)
 ;; ;
"RTN","OCXSEND4",110,0)
 ;;DIQ(DIC,DA,OCXARY) ;
"RTN","OCXSEND4",111,0)
 ;; N DR,DIQ S DR=".01:99999",DIQ="OCXARY(",DIQ(0)="EN" D EN^DIQ1
"RTN","OCXSEND4",112,0)
 ;; Q
"RTN","OCXSEND4",113,0)
 ;; ;
"RTN","OCXSEND4",114,0)
 ;;PAUSE() W "  Press Enter " R X:DTIME W ! Q (X[U)
"RTN","OCXSEND4",115,0)
 ;; ;
"RTN","OCXSEND4",116,0)
 ;;NOW() N X,Y,%DT S X="N",%DT="T" D ^%DT S Y=$$DATE^OCXSENDD(Y) S:(Y["@") Y=$P(Y,"@",1)_" at "_$P(Y,"@",2) Q Y
"RTN","OCXSEND4",117,0)
 ;; ;
"RTN","OCXSEND4",118,0)
 ;;$
"RTN","OCXSEND4",119,0)
 ;1;
"RTN","OCXSEND4",120,0)
 ;
"RTN","OCXSEND5")
0^201^B52984975
"RTN","OCXSEND5",1,0)
OCXSEND5 ;SLC/RJS,CLA - BUILD RULE TRANSPORTER ROUTINES (Build Library Routine 1) ;2/01/01  09:56
"RTN","OCXSEND5",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**32,96,105,243**;Dec 17,1997;Build 242
"RTN","OCXSEND5",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","OCXSEND5",4,0)
 ;
"RTN","OCXSEND5",5,0)
EN() ;
"RTN","OCXSEND5",6,0)
 ;
"RTN","OCXSEND5",7,0)
 N R,LINE,TEXT,NOW,RUCI
"RTN","OCXSEND5",8,0)
 S NOW=$$NOW^OCXSEND3,RUCI=$$NETNAME^OCXSEND
"RTN","OCXSEND5",9,0)
 F LINE=1:1:999 S TEXT=$P($T(TEXT+LINE),";",2,999) Q:TEXT  S TEXT=$P(TEXT,";",2,999) S R(LINE,0)=$$CONV^OCXSEND3(TEXT)
"RTN","OCXSEND5",10,0)
 ;
"RTN","OCXSEND5",11,0)
 M ^TMP("OCXSEND",$J,"RTN")=R
"RTN","OCXSEND5",12,0)
 ;
"RTN","OCXSEND5",13,0)
 S DIE="^TMP(""OCXSEND"","_$J_",""RTN"",",XCN=0,X=$$RNAME^OCXSEND3(1,1)
"RTN","OCXSEND5",14,0)
 W !,X X ^%ZOSF("SAVE") K ^TMP("OCXSEND",$J,"RTN")
"RTN","OCXSEND5",15,0)
 ;
"RTN","OCXSEND5",16,0)
 Q " "
"RTN","OCXSEND5",17,0)
 ;
"RTN","OCXSEND5",18,0)
TEXT ;
"RTN","OCXSEND5",19,0)
 ;;|$$RNAME^OCXSEND3(1,1)| ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE |OCXPATCH| ;|NOW|
"RTN","OCXSEND5",20,0)
 ;;|OCXLIN2|
"RTN","OCXSEND5",21,0)
 ;;|OCXLIN3|
"RTN","OCXSEND5",22,0)
 ;; ;
"RTN","OCXSEND5",23,0)
 ;;S ;
"RTN","OCXSEND5",24,0)
 ;; ;
"RTN","OCXSEND5",25,0)
 ;; Q
"RTN","OCXSEND5",26,0)
 ;; ;
"RTN","OCXSEND5",27,0)
 ;; ;
"RTN","OCXSEND5",28,0)
 ;;COMPARE(L,R) ;
"RTN","OCXSEND5",29,0)
 ;; ;
"RTN","OCXSEND5",30,0)
 ;; Q:$$RES("R") 1
"RTN","OCXSEND5",31,0)
 ;; ;
"RTN","OCXSEND5",32,0)
 ;; Q:'$L($O(L(""))) $$ADDREC^|$$RNAME^OCXSEND3(2,1)|("R")
"RTN","OCXSEND5",33,0)
 ;; ;
"RTN","OCXSEND5",34,0)
 ;; N C,OCXDD M C=L,C=R S OCXDD=$O(C("")) Q $$MULT("C",OCXDD)
"RTN","OCXSEND5",35,0)
 ;; ;
"RTN","OCXSEND5",36,0)
 ;; Q 0
"RTN","OCXSEND5",37,0)
 ;; ;
"RTN","OCXSEND5",38,0)
 ;;RES(REF) ;
"RTN","OCXSEND5",39,0)
 ;; ;
"RTN","OCXSEND5",40,0)
 ;; N QUIT,SUB
"RTN","OCXSEND5",41,0)
 ;; S QUIT=0
"RTN","OCXSEND5",42,0)
 ;; S SUB="" F  S SUB=$O(@REF@(SUB)) Q:'$L(SUB)  I (SUB[":") D  Q:QUIT
"RTN","OCXSEND5",43,0)
 ;; .N DD,DA
"RTN","OCXSEND5",44,0)
 ;; .S DD=$P(SUB,":",1),DA=$P(SUB,":",2)
"RTN","OCXSEND5",45,0)
 ;; .I $L(DA),'(DA=+DA) D  Q:QUIT
"RTN","OCXSEND5",46,0)
 ;; ..N DANEW,SUBNEW
"RTN","OCXSEND5",47,0)
 ;; ..S DANEW=$O(^OCXS($P(DA,U,2),"B",$P(DA,U,1),0))
"RTN","OCXSEND5",48,0)
 ;; ..I 'DANEW W !!,$P($G(^OCXS(+$P(DA,U,2),0)),U,1),": ",$P(DA,U,1),"  could not resolve name.",!!,"    End Transport." S QUIT=1 Q
"RTN","OCXSEND5",49,0)
 ;; ..S SUBNEW=DD_":"_DANEW
"RTN","OCXSEND5",50,0)
 ;; ..I $D(@REF@(SUBNEW)) W !!," multiple #",DANEW," already existed." S QUIT=1 Q
"RTN","OCXSEND5",51,0)
 ;; ..M @REF@(SUBNEW)=@REF@(SUB)
"RTN","OCXSEND5",52,0)
 ;; ..K @REF@(SUB)
"RTN","OCXSEND5",53,0)
 ;; ..S SUB=""
"RTN","OCXSEND5",54,0)
 ;; .I $L(SUB),($D(@REF@(SUB))>9) S QUIT=$$RES($NA(@REF@(SUB)))
"RTN","OCXSEND5",55,0)
 ;; ;
"RTN","OCXSEND5",56,0)
 ;; Q QUIT
"RTN","OCXSEND5",57,0)
 ;; ;
"RTN","OCXSEND5",58,0)
 ;;MULT(CREF,OCXDD) ;
"RTN","OCXSEND5",59,0)
 ;; ;
"RTN","OCXSEND5",60,0)
 ;; N OCXSUB,LREF,RREF,QUIT,OCXFLD
"RTN","OCXSEND5",61,0)
 ;; S LREF="L"_$E(CREF,2,$L(CREF)),RREF="R"_$E(CREF,2,$L(CREF))
"RTN","OCXSEND5",62,0)
 ;; ;
"RTN","OCXSEND5",63,0)
 ;; S QUIT=0,OCXFLD="" F  S OCXFLD=$O(@CREF@(OCXDD,OCXFLD)) Q:'$L(OCXFLD)  D  Q:QUIT
"RTN","OCXSEND5",64,0)
 ;; .I (OCXFLD[":") D  Q:QUIT
"RTN","OCXSEND5",65,0)
 ;; ..Q:$$EXFLD(+OCXFLD,0)
"RTN","OCXSEND5",66,0)
 ;; ..I '$D(@LREF@(OCXDD,OCXFLD,.01,"E")) D  M @LREF@(OCXDD,OCXFLD)=@RREF@(OCXDD,OCXFLD)
"RTN","OCXSEND5",67,0)
 ;; ...D WARN("Missing multiple:",CREF,OCXDD,OCXFLD)
"RTN","OCXSEND5",68,0)
 ;; ...S QUIT=$$ADDMULT^|$$RNAME^OCXSEND3(3,1)|(CREF,OCXDD,OCXFLD)
"RTN","OCXSEND5",69,0)
 ;; ..I '$D(@RREF@(OCXDD,OCXFLD,.01,"E")) D  M @RREF@(OCXDD,OCXFLD)=@LREF@(OCXDD,OCXFLD)
"RTN","OCXSEND5",70,0)
 ;; ...D WARN("Extra multiple:",CREF,OCXDD,OCXFLD)
"RTN","OCXSEND5",71,0)
 ;; ...S QUIT=$$DELMULT^|$$RNAME^OCXSEND3(3,1)|($$APPEND(CREF,OCXDD),OCXFLD)
"RTN","OCXSEND5",72,0)
 ;; .;
"RTN","OCXSEND5",73,0)
 ;; .I (OCXFLD=+OCXFLD),'$$EXFLD(+OCXDD,OCXFLD) D
"RTN","OCXSEND5",74,0)
 ;; ..I ($O(@CREF@(OCXDD,OCXFLD,""))="E") D  Q
"RTN","OCXSEND5",75,0)
 ;; ...I $L($G(@RREF@(OCXDD,OCXFLD,"E"))),'$L($G(@LREF@(OCXDD,OCXFLD,"E"))) D  Q
"RTN","OCXSEND5",76,0)
 ;; ....D WARN("Data Value Missing in "_$$NETNAME^OCXSEND,CREF,OCXDD,OCXFLD,"E")
"RTN","OCXSEND5",77,0)
 ;; ....S QUIT=$$EDITFLD^|$$RNAME^OCXSEND3(4,1)|(CREF,OCXDD,OCXFLD,"E")
"RTN","OCXSEND5",78,0)
 ;; ...I $L($G(@LREF@(OCXDD,OCXFLD,"E"))),'$L($G(@RREF@(OCXDD,OCXFLD,"E"))) D  Q
"RTN","OCXSEND5",79,0)
 ;; ....D WARN("Extra Data Value in "_$$NETNAME^OCXSEND,CREF,OCXDD,OCXFLD,"E")
"RTN","OCXSEND5",80,0)
 ;; ....S QUIT=$$DELFLD^|$$RNAME^OCXSEND3(4,1)|(CREF,OCXDD,OCXFLD,"E")
"RTN","OCXSEND5",81,0)
 ;; ...I '(@LREF@(OCXDD,OCXFLD,"E")=@RREF@(OCXDD,OCXFLD,"E")) D
"RTN","OCXSEND5",82,0)
 ;; ....D WARN("Inconsistent Data",CREF,OCXDD,OCXFLD,"E")
"RTN","OCXSEND5",83,0)
 ;; ....S QUIT=$$EDITFLD^|$$RNAME^OCXSEND3(4,1)|(CREF,OCXDD,OCXFLD,"E")
"RTN","OCXSEND5",84,0)
 ;; ..S OCXSUB=0 F  Q:QUIT  S OCXSUB=$O(@CREF@(OCXDD,OCXFLD,OCXSUB)) Q:'OCXSUB  I '($G(@RREF@(OCXDD,OCXFLD,OCXSUB))=$G(@LREF@(OCXDD,OCXFLD,OCXSUB))) D  Q
"RTN","OCXSEND5",85,0)
 ;; ...D WARN("Inconsistent word Data",CREF,OCXDD,OCXFLD,OCXSUB)
"RTN","OCXSEND5",86,0)
 ;; ...S QUIT=$$LOADWORD^|$$RNAME^OCXSEND3(2,1)|(RREF,OCXDD,OCXFLD,OCXSUB)
"RTN","OCXSEND5",87,0)
 ;; .;
"RTN","OCXSEND5",88,0)
 ;; .I 'QUIT,(OCXFLD[":") S QUIT=$$MULT($$APPEND(CREF,OCXDD),OCXFLD)
"RTN","OCXSEND5",89,0)
 ;; Q QUIT
"RTN","OCXSEND5",90,0)
 ;; ;
"RTN","OCXSEND5",91,0)
 ;;APPEND(ARRAY,OCXSUB) ;
"RTN","OCXSEND5",92,0)
 ;; S:'(OCXSUB=+OCXSUB) OCXSUB=""""_OCXSUB_""""
"RTN","OCXSEND5",93,0)
 ;; Q:'(ARRAY["(") ARRAY_"("_OCXSUB_")"
"RTN","OCXSEND5",94,0)
 ;; Q $E(ARRAY,1,$L(ARRAY)-1)_","_OCXSUB_")"
"RTN","OCXSEND5",95,0)
 ;; ;
"RTN","OCXSEND5",96,0)
 ;;EXFLD(FILE,OCXFLD) ;
"RTN","OCXSEND5",97,0)
 ;; N OCXFNAM
"RTN","OCXSEND5",98,0)
 ;; S OCXFNAM=$$FIELD^OCXSENDD(FILE,OCXFLD,"LABEL")
"RTN","OCXSEND5",99,0)
 ;; I (OCXFNAM["UNIQUE OBJECT IDENTIFIER") Q 1
"RTN","OCXSEND5",100,0)
 ;; I (FILE=860.2),(OCXFLD=.02) Q 1
"RTN","OCXSEND5",101,0)
 ;; I (FILE=860.22),(OCXFLD=4) Q 1
"RTN","OCXSEND5",102,0)
 ;; I (FILE=860.3),(OCXFLD=3) Q 1
"RTN","OCXSEND5",103,0)
 ;; I (FILE=860.9),(OCXFLD=1) Q 1
"RTN","OCXSEND5",104,0)
 ;; I (FILE=860.91) Q 1
"RTN","OCXSEND5",105,0)
 ;; I (FILE=860.801) Q 1
"RTN","OCXSEND5",106,0)
 ;; I (FILE=860.81) Q 1
"RTN","OCXSEND5",107,0)
 ;; I (FILE=861.01) Q 1
"RTN","OCXSEND5",108,0)
 ;; I (FILE=863.02) Q 1
"RTN","OCXSEND5",109,0)
 ;; I (FILE=863.54) Q 1
"RTN","OCXSEND5",110,0)
 ;; I (FILE=863.61) Q 1
"RTN","OCXSEND5",111,0)
 ;; I (FILE=863.72) Q 1
"RTN","OCXSEND5",112,0)
 ;; I (FILE=863.81) Q 1
"RTN","OCXSEND5",113,0)
 ;; I ($E(OCXFNAM,1)="*") Q 1
"RTN","OCXSEND5",114,0)
 ;; Q 0
"RTN","OCXSEND5",115,0)
 ;; ;
"RTN","OCXSEND5",116,0)
 ;;WARN(MSG,CREF,OCXDD,OCXFLD,OCXSUB) ;
"RTN","OCXSEND5",117,0)
 ;; ;
"RTN","OCXSEND5",118,0)
 ;; Q:$G(OCXAUTO)
"RTN","OCXSEND5",119,0)
 ;; ;
"RTN","OCXSEND5",120,0)
 ;; N D0,DASH,OCXDDPTH,OCXDPTR,FILE,FILEID,LREF,OCXPTR,RREF
"RTN","OCXSEND5",121,0)
 ;; ;
"RTN","OCXSEND5",122,0)
 ;; S DASH="",$P(DASH,"-",(55-$L(MSG)))="-"
"RTN","OCXSEND5",123,0)
 ;; W !!,"------------",MSG,DASH
"RTN","OCXSEND5",124,0)
 ;; D DSPHDR(CREF,OCXDD,OCXFLD)
"RTN","OCXSEND5",125,0)
 ;; I $D(OCXSUB) D DSPFLD(CREF,OCXDD,OCXFLD,OCXSUB)
"RTN","OCXSEND5",126,0)
 ;; I '$D(OCXSUB) D DSPREC(CREF,OCXDD,OCXFLD)
"RTN","OCXSEND5",127,0)
 ;; ;
"RTN","OCXSEND5",128,0)
 ;; W ! Q
"RTN","OCXSEND5",129,0)
 ;; ;
"RTN","OCXSEND5",130,0)
 ;;DSPREC(CREF,OCXDD,OCXFLD) ;
"RTN","OCXSEND5",131,0)
 ;; ;
"RTN","OCXSEND5",132,0)
 ;; N OCXDPTR,OCXDDPTH,LEVL,OCXCREF,OCXSUB
"RTN","OCXSEND5",133,0)
 ;; S OCXCREF=$$APPEND($$APPEND(CREF,OCXDD),OCXFLD)
"RTN","OCXSEND5",134,0)
 ;; S OCXDDPTH=$P($P(OCXCREF,"(",2),")",1),LEVL=$L(OCXDDPTH,",")
"RTN","OCXSEND5",135,0)
 ;; S OCXSUB="" F  S OCXSUB=$O(@OCXCREF@(OCXSUB)) Q:'$L(OCXSUB)  D
"RTN","OCXSEND5",136,0)
 ;; .;
"RTN","OCXSEND5",137,0)
 ;; .I '(OCXSUB[":"),'((OCXSUB=.01)&$O(@OCXCREF@(OCXSUB))) D
"RTN","OCXSEND5",138,0)
 ;; ..N LINE
"RTN","OCXSEND5",139,0)
 ;; ..Q:$$EXFLD(+OCXFLD,OCXSUB)
"RTN","OCXSEND5",140,0)
 ;; ..I OCXFLD W !,?(5+((LEVL)*4)),$$FIELD^OCXSENDD(+OCXFLD,OCXSUB,"LABEL"),": ",$G(@OCXCREF@(OCXSUB,"E"))
"RTN","OCXSEND5",141,0)
 ;; ..S LINE=0 F  S LINE=$O(@OCXCREF@(OCXSUB,LINE)) Q:'LINE  D
"RTN","OCXSEND5",142,0)
 ;; ...W !,?(5+(LEVL*4)),$J(LINE,3),">",@OCXCREF@(OCXSUB,LINE)
"RTN","OCXSEND5",143,0)
 ;; .;
"RTN","OCXSEND5",144,0)
 ;; .I (OCXSUB[":") D
"RTN","OCXSEND5",145,0)
 ;; ..N D0,OCXDD,FILENAME
"RTN","OCXSEND5",146,0)
 ;; ..S D0=+$P(OCXSUB,":",2),OCXDD=+OCXSUB
"RTN","OCXSEND5",147,0)
 ;; ..S FILENAME=$$FILENAME^OCXSENDD(OCXDD)
"RTN","OCXSEND5",148,0)
 ;; ..I $L(FILENAME) W !,?(5+($L(LEVL)*4)),FILENAME
"RTN","OCXSEND5",149,0)
 ;; ..E  W !!,?(5+(LEVL*4)),FILENAME
"RTN","OCXSEND5",150,0)
 ;; ..W " ",D0,": ",$G(@OCXCREF@(OCXSUB,.01,"E"))
"RTN","OCXSEND5",151,0)
 ;; ..D DSPREC($$APPEND(CREF,OCXDD),OCXFLD,OCXSUB)
"RTN","OCXSEND5",152,0)
 ;; ;
"RTN","OCXSEND5",153,0)
 ;; Q
"RTN","OCXSEND5",154,0)
 ;; ;
"RTN","OCXSEND5",155,0)
 ;;DSPHDR(CREF,OCXDD,OCXFLD) ;
"RTN","OCXSEND5",156,0)
 ;; ;
"RTN","OCXSEND5",157,0)
 ;; N D0,FILE,FILEID,OCXPTR,OCXDDPTH
"RTN","OCXSEND5",158,0)
 ;; S OCXDDPTH=$P($P($$APPEND($$APPEND(CREF,OCXDD),OCXFLD),"(",2),")",1)
"RTN","OCXSEND5",159,0)
 ;; S FILE="" F OCXPTR=1:1:$L(OCXDDPTH,",") D
"RTN","OCXSEND5",160,0)
 ;; .N OCXDD,D0,FILEID
"RTN","OCXSEND5",161,0)
 ;; .S FILEID=$P(OCXDDPTH,",",OCXPTR)
"RTN","OCXSEND5",162,0)
 ;; .I (FILEID[":") D
"RTN","OCXSEND5",163,0)
 ;; ..S D0=+$P(FILEID,":",2),OCXDD=+$E(FILEID,2,$L(FILEID))
"RTN","OCXSEND5",164,0)
 ;; ..W !,?(5+(OCXPTR*4)),$$FILENAME^OCXSENDD(OCXDD)
"RTN","OCXSEND5",165,0)
 ;; ..S:$L(FILE) FILE=FILE_"," S FILE=FILE_FILEID
"RTN","OCXSEND5",166,0)
 ;; ..I $D(@("L("_FILE_",.01,""E"")")) W ": ",@("L("_FILE_",.01,""E"")") W:D0 " [",D0,"]"
"RTN","OCXSEND5",167,0)
 ;; ..E  I $D(@("R("_FILE_",.01,""E"")")) W ": ",@("R("_FILE_",.01,""E"")") W:D0 " [",D0,"]"
"RTN","OCXSEND5",168,0)
 ;; ;
"RTN","OCXSEND5",169,0)
 ;; Q
"RTN","OCXSEND5",170,0)
 ;; ;
"RTN","OCXSEND5",171,0)
 ;;DSPFLD(CREF,OCXDD,OCXFLD,OCXSUB) ;
"RTN","OCXSEND5",172,0)
 ;; ;
"RTN","OCXSEND5",173,0)
 ;; N OCXDPTR,LREF,RREF,OCXDDPTH
"RTN","OCXSEND5",174,0)
 ;; ;
"RTN","OCXSEND5",175,0)
 ;; S OCXDDPTH=$P($P($$APPEND(CREF,OCXDD),"(",2),")",1)
"RTN","OCXSEND5",176,0)
 ;; S LREF="L("_OCXDDPTH_")",RREF="R("_OCXDDPTH_")"
"RTN","OCXSEND5",177,0)
 ;; W !,?(5+(($L(OCXDDPTH,",")+1)*4)),$$FIELD^OCXSENDD(OCXDD,OCXFLD,"LABEL")," field [",OCXFLD,"]"
"RTN","OCXSEND5",178,0)
 ;; I OCXSUB W " Line #",OCXSUB
"RTN","OCXSEND5",179,0)
 ;; ;
"RTN","OCXSEND5",180,0)
 ;; W:($D(@RREF@(OCXFLD,OCXSUB))) !,?(5+(($L(OCXDDPTH,",")+2)*4)),"(R) |RUCI|: ",@RREF@(OCXFLD,OCXSUB)
"RTN","OCXSEND5",181,0)
 ;; W:($D(@LREF@(OCXFLD,OCXSUB))) !,?(5+(($L(OCXDDPTH,",")+2)*4)),"(L) ",$$NETNAME^OCXSEND,": ",@LREF@(OCXFLD,OCXSUB)
"RTN","OCXSEND5",182,0)
 ;; ;
"RTN","OCXSEND5",183,0)
 ;; Q
"RTN","OCXSEND5",184,0)
 ;; ;
"RTN","OCXSEND5",185,0)
 ;; W !,?10 Q 0 Q $$PAUSE
"RTN","OCXSEND5",186,0)
 ;; ;
"RTN","OCXSEND5",187,0)
 ;;PAUSE() W "  Press Enter " R X:DTIME W ! Q (X[U)
"RTN","OCXSEND5",188,0)
 ;; ;
"RTN","OCXSEND5",189,0)
 ;;NOW() N X,Y,%DT S X="N",%DT="T" D ^%DT S Y=$$DATE^OCXSENDD(Y) S:(Y["@") Y=$P(Y,"@",1)_" at "_$P(Y,"@",2) Q Y
"RTN","OCXSEND5",190,0)
 ;; ;
"RTN","OCXSEND5",191,0)
 ;;$
"RTN","OCXSEND5",192,0)
 ;1;
"RTN","OCXSEND5",193,0)
 ;
"RTN","OCXSEND6")
0^202^B36540955
"RTN","OCXSEND6",1,0)
OCXSEND6 ;SLC/RJS,CLA - BUILD RULE TRANSPORTER ROUTINES (Build Library Routine 2) ;2/01/01  10:03
"RTN","OCXSEND6",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**32,76,74,96,105,243**;Dec 17,1997;Build 242
"RTN","OCXSEND6",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","OCXSEND6",4,0)
 ;
"RTN","OCXSEND6",5,0)
EN() ;
"RTN","OCXSEND6",6,0)
 ;
"RTN","OCXSEND6",7,0)
 N R,LINE,TEXT,NOW,RUCI
"RTN","OCXSEND6",8,0)
 S NOW=$$NOW^OCXSEND3,RUCI=$$NETNAME^OCXSEND
"RTN","OCXSEND6",9,0)
 F LINE=1:1:999 S TEXT=$P($T(TEXT+LINE),";",2,999) Q:TEXT  S TEXT=$P(TEXT,";",2,999) S R(LINE,0)=$$CONV^OCXSEND3(TEXT)
"RTN","OCXSEND6",10,0)
 ;
"RTN","OCXSEND6",11,0)
 M ^TMP("OCXSEND",$J,"RTN")=R
"RTN","OCXSEND6",12,0)
 ;
"RTN","OCXSEND6",13,0)
 S DIE="^TMP(""OCXSEND"","_$J_",""RTN"",",XCN=0,X=$$RNAME^OCXSEND3(2,1)
"RTN","OCXSEND6",14,0)
 W !,X X ^%ZOSF("SAVE") K ^TMP("OCXSEND",$J,"RTN")
"RTN","OCXSEND6",15,0)
 ;
"RTN","OCXSEND6",16,0)
 Q " "
"RTN","OCXSEND6",17,0)
 ;
"RTN","OCXSEND6",18,0)
TEXT ;
"RTN","OCXSEND6",19,0)
 ;;|$$RNAME^OCXSEND3(2,1)| ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE |OCXPATCH| ;|NOW|
"RTN","OCXSEND6",20,0)
 ;;|OCXLIN2|
"RTN","OCXSEND6",21,0)
 ;;|OCXLIN3|
"RTN","OCXSEND6",22,0)
 ;; ;
"RTN","OCXSEND6",23,0)
 ;;S ;
"RTN","OCXSEND6",24,0)
 ;; ;  Record Utilities
"RTN","OCXSEND6",25,0)
 ;; Q
"RTN","OCXSEND6",26,0)
 ;; ;
"RTN","OCXSEND6",27,0)
 ;;ADDREC(OCXCREF) ;
"RTN","OCXSEND6",28,0)
 ;; ;
"RTN","OCXSEND6",29,0)
 ;; N QUIT,OCXDD,OCXDA,OCXGREF,OCXNAME
"RTN","OCXSEND6",30,0)
 ;; S OCXDD=$O(@OCXCREF@("")) Q:'OCXDD 0
"RTN","OCXSEND6",31,0)
 ;; S OCXNAME=$G(@OCXCREF@(OCXDD,.01,"E"))
"RTN","OCXSEND6",32,0)
 ;; ;
"RTN","OCXSEND6",33,0)
 ;; W "   record missing..."
"RTN","OCXSEND6",34,0)
 ;; I (OCXFLAG["D") Q 0
"RTN","OCXSEND6",35,0)
 ;; ;
"RTN","OCXSEND6",36,0)
 ;; S OCXDA=0 D CREATE(OCXCREF,OCXDD,.OCXDA,0)
"RTN","OCXSEND6",37,0)
 ;; S:$L(OCXNAME) ^TMP("OCXRULE",$J,"A",+OCXDD,OCXNAME)=""
"RTN","OCXSEND6",38,0)
 ;; ;
"RTN","OCXSEND6",39,0)
 ;; Q 0
"RTN","OCXSEND6",40,0)
 ;; ;
"RTN","OCXSEND6",41,0)
 ;;CREATE(OCXCREF,OCXDD,OCXDA,OCXLVL) ;
"RTN","OCXSEND6",42,0)
 ;; ;
"RTN","OCXSEND6",43,0)
 ;; N OCXFLD,OCXGREF,OCXKEY
"RTN","OCXSEND6",44,0)
 ;; ;
"RTN","OCXSEND6",45,0)
 ;; I $L(OCXDA),'(OCXDA=+OCXDA) W !!,"Unresolved subscript." Q
"RTN","OCXSEND6",46,0)
 ;; ;
"RTN","OCXSEND6",47,0)
 ;; S OCXKEY=@OCXCREF@(OCXDD,.01,"E")
"RTN","OCXSEND6",48,0)
 ;; S OCXGREF=$$GETREF(+OCXDD,.OCXDA,OCXLVL) Q:'$L(OCXGREF)
"RTN","OCXSEND6",49,0)
 ;; I 'OCXDA D
"RTN","OCXSEND6",50,0)
 ;; .S OCXDA=$O(^TMP("OCXRULE",$J,"B",+OCXDD,OCXKEY,0)) Q:OCXDA
"RTN","OCXSEND6",51,0)
 ;; .S OCXDA=$O(@(OCXGREF_""" "")"),-1)+1
"RTN","OCXSEND6",52,0)
 ;; .F OCXDA=OCXDA:1 Q:'$D(@(OCXGREF_OCXDA_",0)"))
"RTN","OCXSEND6",53,0)
 ;; .I $D(@(OCXGREF_OCXDA_",0)")) S OCXDA=0
"RTN","OCXSEND6",54,0)
 ;; ;
"RTN","OCXSEND6",55,0)
 ;; I 'OCXDA W !!,"Error adding record..." Q
"RTN","OCXSEND6",56,0)
 ;; ;
"RTN","OCXSEND6",57,0)
 ;; I '$D(@(OCXGREF_"0)")) S @(OCXGREF_"0)")=U_$$FILEHDR^OCXSENDD(+OCXDD)_U_U
"RTN","OCXSEND6",58,0)
 ;; ;
"RTN","OCXSEND6",59,0)
 ;; S OCXFLD=0 F  S OCXFLD=$O(@OCXCREF@(OCXDD,OCXFLD)) Q:'OCXFLD  Q:(OCXFLD[":")  I '$$EXFLD^|$$RNAME^OCXSEND3(1,1)|(+OCXDD,OCXFLD) D
"RTN","OCXSEND6",60,0)
 ;; .I $L($G(@OCXCREF@(OCXDD,OCXFLD,"E"))) D DIE(OCXDD,OCXGREF,OCXFLD,@OCXCREF@(OCXDD,OCXFLD,"E"),.OCXDA,OCXLVL)
"RTN","OCXSEND6",61,0)
 ;; .I $O(@OCXCREF@(OCXDD,OCXFLD,0)) D WORD(OCXDD,OCXGREF,OCXFLD,.OCXDA,OCXCREF)
"RTN","OCXSEND6",62,0)
 ;; ;
"RTN","OCXSEND6",63,0)
 ;; D PUSH(.OCXDA)
"RTN","OCXSEND6",64,0)
 ;; S OCXFLD="" F  S OCXFLD=$O(@OCXCREF@(OCXDD,OCXFLD)) Q:'$L(OCXFLD)  I (OCXFLD[":") D
"RTN","OCXSEND6",65,0)
 ;; .S OCXDA=$P(OCXFLD,":",2) W ! D CREATE($$APPEND(OCXCREF,OCXDD),OCXFLD,.OCXDA,OCXLVL+1)
"RTN","OCXSEND6",66,0)
 ;; D POP(.OCXDA)
"RTN","OCXSEND6",67,0)
 ;; Q
"RTN","OCXSEND6",68,0)
 ;; ;
"RTN","OCXSEND6",69,0)
 ;;LOADWORD(RREF,OCXDD,OCXFLD,OCXSUB) ;
"RTN","OCXSEND6",70,0)
 ;; ;
"RTN","OCXSEND6",71,0)
 ;; N QUIT,DDPATH,INDEX,OCXDA,OCXGREF
"RTN","OCXSEND6",72,0)
 ;; S DDPATH=$P($P($$APPEND(RREF,OCXDD),"(",2),")",1)
"RTN","OCXSEND6",73,0)
 ;; F INDEX=1:1:$L(DDPATH,",") S OCXDA($L(DDPATH,",")-INDEX)=+$P($P(DDPATH,",",INDEX),":",2)
"RTN","OCXSEND6",74,0)
 ;; S OCXDA=$G(OCXDA(0)) K OCXDA(0)
"RTN","OCXSEND6",75,0)
 ;; Q:(OCXFLAG["D") 0
"RTN","OCXSEND6",76,0)
 ;; I (OCXFLAG["A") S QUIT=$$READ("Y"," Do you want to reload the local '"_$$FIELD^OCXSENDD(+OCXDD,+OCXFLD,"LABEL")_"' field ?","YES") Q:'QUIT (QUIT[U)
"RTN","OCXSEND6",77,0)
 ;; S OCXGREF=$$GETREF(+OCXDD,.OCXDA,$L(DDPATH,",")-1) Q:'$L(OCXGREF)
"RTN","OCXSEND6",78,0)
 ;; D WORD(OCXDD,OCXGREF,OCXFLD,.OCXDA,RREF)
"RTN","OCXSEND6",79,0)
 ;; Q 0
"RTN","OCXSEND6",80,0)
 ;; ;
"RTN","OCXSEND6",81,0)
 ;;GETREF(OCXDD,OCXDA,OCXLVL) ;
"RTN","OCXSEND6",82,0)
 ;; ;
"RTN","OCXSEND6",83,0)
 ;; Q:'OCXDD ""
"RTN","OCXSEND6",84,0)
 ;; ;
"RTN","OCXSEND6",85,0)
 ;; N OCXIENS,OCXERR,OCXX
"RTN","OCXSEND6",86,0)
 ;; S OCXIENS=$$IENS^DILF(.OCXDA),OCXERR=""
"RTN","OCXSEND6",87,0)
 ;; S OCXX=$$ROOT^DILFD(OCXDD,OCXIENS,0,OCXERR)
"RTN","OCXSEND6",88,0)
 ;; Q OCXX
"RTN","OCXSEND6",89,0)
 ;; ;
"RTN","OCXSEND6",90,0)
 ;;WORD(DD,GREF,FLD,DA,RREF) ;
"RTN","OCXSEND6",91,0)
 ;; ;
"RTN","OCXSEND6",92,0)
 ;; N SUB,GLROOT,LINE
"RTN","OCXSEND6",93,0)
 ;; S SUB=$P($$FIELD^OCXSENDD(+DD,FLD,"GLOBAL SUBSCRIPT LOCATION"),";",1) S:'(SUB=+SUB) SUB=""""_SUB_""""
"RTN","OCXSEND6",94,0)
 ;; S GLROOT=GREF_DA_","_SUB_")" K @GLROOT
"RTN","OCXSEND6",95,0)
 ;; S LINE=0 F  S LINE=$O(@RREF@(DD,FLD,LINE)) Q:'LINE  D
"RTN","OCXSEND6",96,0)
 ;; .S @GLROOT@($O(@GLROOT@(""),-1)+1,0)=@RREF@(DD,FLD,LINE)
"RTN","OCXSEND6",97,0)
 ;; S LINE=$O(@GLROOT@(""),-1),@GLROOT@(0)=U_U_LINE_U_LINE_U_$$DATE("T")_U
"RTN","OCXSEND6",98,0)
 ;; ;
"RTN","OCXSEND6",99,0)
 ;; Q
"RTN","OCXSEND6",100,0)
 ;; ;
"RTN","OCXSEND6",101,0)
 ;;DATE(X) N %DT,Y S %DT="" D ^%DT Q +Y
"RTN","OCXSEND6",102,0)
 ;; ;
"RTN","OCXSEND6",103,0)
 ;;DIE(OCXDD,OCXDIC,OCXFLD,OCXVAL,OCXDA,OCXLVL) ;
"RTN","OCXSEND6",104,0)
 ;; ;
"RTN","OCXSEND6",105,0)
 ;; N DIC,DIE,X,Y,DR,DA,OCXDVAL,OCXPTR,OCXGREF,D0,OCXSCR
"RTN","OCXSEND6",106,0)
 ;; S (D0,DA)=OCXDA,(DIC,DIE)=OCXDIC,DR=""
"RTN","OCXSEND6",107,0)
 ;; S:OCXLVL D0=OCXDA(1),DR="S DA(1)="_(+D0)_",D0="_(+D0)_";"
"RTN","OCXSEND6",108,0)
 ;; S:OCXVAL="?" OCXVAL="? " S DR=DR_OCXFLD_"///^S X=OCXVAL"
"RTN","OCXSEND6",109,0)
 ;; I '(OCXVAL="@") W !,?(OCXLVL*5),$$FIELD^OCXSENDD(+OCXDD,OCXFLD,"LABEL"),": ",OCXVAL
"RTN","OCXSEND6",110,0)
 ;; ;
"RTN","OCXSEND6",111,0)
 ;; I '(OCXVAL="@") D
"RTN","OCXSEND6",112,0)
 ;; .N OCXIEN,SHORT
"RTN","OCXSEND6",113,0)
 ;; .S OCXPTR=+$P($$FIELD^OCXSENDD(+OCXDD,OCXFLD,"SPECIFIER"),"P",2)
"RTN","OCXSEND6",114,0)
 ;; .Q:'OCXPTR
"RTN","OCXSEND6",115,0)
 ;; .S OCXGREF="^"_$$FIELD^OCXSENDD(+OCXDD,OCXFLD,"POINTER")
"RTN","OCXSEND6",116,0)
 ;; .I '($E(OCXGREF,1,4)="^OCX"),'(OCXGREF="^ORD(100.9,"),'(OCXGREF="^ORD(100.8,") Q
"RTN","OCXSEND6",117,0)
 ;; .Q:$$DIC(OCXGREF,OCXVAL,0)
"RTN","OCXSEND6",118,0)
 ;; .S OCXIEN=$$DIC(OCXGREF,OCXVAL,1)
"RTN","OCXSEND6",119,0)
 ;; .S ^TMP("OCXRULE",$J,"B",OCXPTR,OCXVAL,OCXIEN)=""
"RTN","OCXSEND6",120,0)
 ;; ;
"RTN","OCXSEND6",121,0)
 ;; S OCXSCR=1
"RTN","OCXSEND6",122,0)
 ;; D ^DIE
"RTN","OCXSEND6",123,0)
 ;; ;
"RTN","OCXSEND6",124,0)
 ;; ; I $D(Y) -> DIE FILER ERROR
"RTN","OCXSEND6",125,0)
 ;; I $D(Y) W "   ^DIE filer data error..." S OCXDIER=$G(OCXDIER)+1
"RTN","OCXSEND6",126,0)
 ;; I '$D(Y) W "    ...Correct data Filed"
"RTN","OCXSEND6",127,0)
 ;; ;
"RTN","OCXSEND6",128,0)
 ;; Q
"RTN","OCXSEND6",129,0)
 ;; ;
"RTN","OCXSEND6",130,0)
 ;;DIC(DIC,X,OCXADD) N OCXSCR S DIC(0)="",OCXSCR=1 S:OCXADD DIC(0)="L" D ^DIC Q:(+Y>0) +Y Q 0
"RTN","OCXSEND6",131,0)
 ;; ;
"RTN","OCXSEND6",132,0)
 ;;PUSH(OCXDA) ;
"RTN","OCXSEND6",133,0)
 ;; N OCXSUB S OCXSUB="" F  S OCXSUB=$O(OCXDA(OCXSUB),-1) Q:'OCXSUB  S OCXDA(OCXSUB+1)=OCXDA(OCXSUB)
"RTN","OCXSEND6",134,0)
 ;; S OCXDA(1)=OCXDA,OCXDA=0
"RTN","OCXSEND6",135,0)
 ;; Q
"RTN","OCXSEND6",136,0)
 ;; ;
"RTN","OCXSEND6",137,0)
 ;;POP(OCXDA) ;
"RTN","OCXSEND6",138,0)
 ;; N OCXSUB S OCXSUB="" F  S OCXSUB=$O(OCXDA(OCXSUB)) Q:'OCXSUB  S OCXDA(OCXSUB)=$G(OCXDA(OCXSUB+1))
"RTN","OCXSEND6",139,0)
 ;; S OCXDA=OCXDA(1) K OCXDA($O(OCXDA(""),-1))
"RTN","OCXSEND6",140,0)
 ;; Q
"RTN","OCXSEND6",141,0)
 ;; ;
"RTN","OCXSEND6",142,0)
 ;;APPEND(ARRAY,OCXSUB) ;
"RTN","OCXSEND6",143,0)
 ;; S:'(OCXSUB=+OCXSUB) OCXSUB=""""_OCXSUB_""""
"RTN","OCXSEND6",144,0)
 ;; Q:'(ARRAY["(") ARRAY_"("_OCXSUB_")"
"RTN","OCXSEND6",145,0)
 ;; Q $E(ARRAY,1,$L(ARRAY)-1)_","_OCXSUB_")"
"RTN","OCXSEND6",146,0)
 ;; ;
"RTN","OCXSEND6",147,0)
 ;;READ(OCXZ0,OCXZA,OCXZB,OCXZL) ;
"RTN","OCXSEND6",148,0)
 ;; N OCXLINE,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","OCXSEND6",149,0)
 ;; Q:'$L($G(OCXZ0)) U
"RTN","OCXSEND6",150,0)
 ;; S DIR(0)=OCXZ0
"RTN","OCXSEND6",151,0)
 ;; S:$L($G(OCXZA)) DIR("A")=OCXZA
"RTN","OCXSEND6",152,0)
 ;; S:$L($G(OCXZB)) DIR("B")=OCXZB
"RTN","OCXSEND6",153,0)
 ;; F OCXLINE=1:1:($G(OCXZL)-1) W !
"RTN","OCXSEND6",154,0)
 ;; D ^DIR
"RTN","OCXSEND6",155,0)
 ;; I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","OCXSEND6",156,0)
 ;; Q Y
"RTN","OCXSEND6",157,0)
 ;; ;
"RTN","OCXSEND6",158,0)
 ;;PAUSE() W "  Press Enter " R X:DTIME W ! Q (X[U)
"RTN","OCXSEND6",159,0)
 ;; ;
"RTN","OCXSEND6",160,0)
 ;;$
"RTN","OCXSEND6",161,0)
 ;1;
"RTN","OCXSEND6",162,0)
 ;
"RTN","OCXSEND7")
0^203^B19892897
"RTN","OCXSEND7",1,0)
OCXSEND7 ;SLC/RJS,CLA - BUILD RULE TRANSPORTER ROUTINES (Build Library Routine 3) ;1/31/01  11:07
"RTN","OCXSEND7",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**32,96,105,243**;Dec 17,1997;Build 242
"RTN","OCXSEND7",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","OCXSEND7",4,0)
 ;
"RTN","OCXSEND7",5,0)
EN() ;
"RTN","OCXSEND7",6,0)
 ;
"RTN","OCXSEND7",7,0)
 N R,LINE,TEXT,NOW,RUCI
"RTN","OCXSEND7",8,0)
 S NOW=$$NOW^OCXSEND3,RUCI=$$NETNAME^OCXSEND
"RTN","OCXSEND7",9,0)
 F LINE=1:1:999 S TEXT=$P($T(TEXT+LINE),";",2,999) Q:TEXT  S TEXT=$P(TEXT,";",2,999) S R(LINE,0)=$$CONV^OCXSEND3(TEXT)
"RTN","OCXSEND7",10,0)
 ;
"RTN","OCXSEND7",11,0)
 M ^TMP("OCXSEND",$J,"RTN")=R
"RTN","OCXSEND7",12,0)
 ;
"RTN","OCXSEND7",13,0)
 S DIE="^TMP(""OCXSEND"","_$J_",""RTN"",",XCN=0,X=$$RNAME^OCXSEND3(3,1)
"RTN","OCXSEND7",14,0)
 W !,X X ^%ZOSF("SAVE") K ^TMP("OCXSEND",$J,"RTN")
"RTN","OCXSEND7",15,0)
 ;
"RTN","OCXSEND7",16,0)
 Q " "
"RTN","OCXSEND7",17,0)
 ;
"RTN","OCXSEND7",18,0)
TEXT ;
"RTN","OCXSEND7",19,0)
 ;;|$$RNAME^OCXSEND3(3,1)| ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE |OCXPATCH| ;|NOW|
"RTN","OCXSEND7",20,0)
 ;;|OCXLIN2|
"RTN","OCXSEND7",21,0)
 ;;|OCXLIN3|
"RTN","OCXSEND7",22,0)
 ;; ;
"RTN","OCXSEND7",23,0)
 ;;S ;
"RTN","OCXSEND7",24,0)
 ;; ;  Multiple Utilities
"RTN","OCXSEND7",25,0)
 ;; Q
"RTN","OCXSEND7",26,0)
 ;; ;
"RTN","OCXSEND7",27,0)
 ;;ADDMULT(OCXCREF,OCXDD,OCXFLD) ;
"RTN","OCXSEND7",28,0)
 ;; ;
"RTN","OCXSEND7",29,0)
 ;; ;
"RTN","OCXSEND7",30,0)
 ;; N QUIT,OCXDA,OCXGREF,OCXNAME,DDPATH,INDEX
"RTN","OCXSEND7",31,0)
 ;; ;
"RTN","OCXSEND7",32,0)
 ;; S DDPATH=$P($P($$APPEND($$APPEND(OCXCREF,OCXDD),OCXFLD),"(",2),")",1)
"RTN","OCXSEND7",33,0)
 ;; F INDEX=1:1:$L(DDPATH,",") S OCXDA($L(DDPATH,",")-INDEX)=+$P($P(DDPATH,",",INDEX),":",2)
"RTN","OCXSEND7",34,0)
 ;; S OCXDA=$G(OCXDA(0)) K OCXDA(0)
"RTN","OCXSEND7",35,0)
 ;; ;
"RTN","OCXSEND7",36,0)
 ;; Q:(OCXFLAG["D") 0
"RTN","OCXSEND7",37,0)
 ;; I (OCXFLAG["A") S QUIT=$$READ("Y"," Do you want to add a local '"_$$FILENAME^OCXSENDD(+OCXFLD)_"' multiple ?","YES") Q:'QUIT (QUIT[U)
"RTN","OCXSEND7",38,0)
 ;; ;
"RTN","OCXSEND7",39,0)
 ;; S OCXGREF=$$GETREF^|$$RNAME^OCXSEND3(2,1)|(+OCXFLD,.OCXDA,1)
"RTN","OCXSEND7",40,0)
 ;; D CREATE($$APPEND(OCXCREF,OCXDD),OCXFLD,.OCXDA,1)
"RTN","OCXSEND7",41,0)
 ;; ;
"RTN","OCXSEND7",42,0)
 ;; Q 0
"RTN","OCXSEND7",43,0)
 ;; ;
"RTN","OCXSEND7",44,0)
 ;;DELMULT(OCXCREF,OCXDD) ;
"RTN","OCXSEND7",45,0)
 ;; ;
"RTN","OCXSEND7",46,0)
 ;; N QUIT,OCXGREF,DA,INDEX,DDPATH
"RTN","OCXSEND7",47,0)
 ;; ;
"RTN","OCXSEND7",48,0)
 ;; Q:(OCXFLAG["D") 0
"RTN","OCXSEND7",49,0)
 ;; I (OCXFLAG["A") S QUIT=$$READ("Y"," Do you want to delete the local '"_$$FILENAME^OCXSENDD(+OCXDD)_"' multiple ?","YES") Q:'QUIT (QUIT[U)
"RTN","OCXSEND7",50,0)
 ;; ;
"RTN","OCXSEND7",51,0)
 ;; S DDPATH=$P($P($$APPEND(OCXCREF,OCXDD),"(",2),")",1)
"RTN","OCXSEND7",52,0)
 ;; F INDEX=1:1:$L(DDPATH,",") S DA($L(DDPATH,",")-INDEX)=+$P($P(DDPATH,",",INDEX),":",2)
"RTN","OCXSEND7",53,0)
 ;; S DA=$G(DA(0)) K DA(0)
"RTN","OCXSEND7",54,0)
 ;; S OCXGREF=$$GETREF^|$$RNAME^OCXSEND3(2,1)|(+OCXDD,.DA,1)
"RTN","OCXSEND7",55,0)
 ;; ;
"RTN","OCXSEND7",56,0)
 ;; D DIE^|$$RNAME^OCXSEND3(2,1)|(+OCXDD,OCXGREF,.01,"@",.DA,$L(DDPATH,",")-1)
"RTN","OCXSEND7",57,0)
 ;; K @OCXCREF@(OCXDD) W !!,"  deleted..."
"RTN","OCXSEND7",58,0)
 ;; ;
"RTN","OCXSEND7",59,0)
 ;; Q 0
"RTN","OCXSEND7",60,0)
 ;; ;
"RTN","OCXSEND7",61,0)
 ;;CREATE(OCXCREF,OCXDD,OCXDA,OCXLVL) ;
"RTN","OCXSEND7",62,0)
 ;; ;
"RTN","OCXSEND7",63,0)
 ;; N OCXFLD,OCXGREF
"RTN","OCXSEND7",64,0)
 ;; ;
"RTN","OCXSEND7",65,0)
 ;; S OCXGREF=$$GETREF^|$$RNAME^OCXSEND3(2,1)|(+OCXDD,.OCXDA,OCXLVL) Q:'$L(OCXGREF)  S:'OCXDA OCXDA=$O(@(OCXGREF_"""@"")"),-1)+1
"RTN","OCXSEND7",66,0)
 ;; ;
"RTN","OCXSEND7",67,0)
 ;; I '$D(@(OCXGREF_"0)")) S @(OCXGREF_"0)")=U_$$FILEHDR^OCXSENDD(+OCXDD)_U_U
"RTN","OCXSEND7",68,0)
 ;; ;
"RTN","OCXSEND7",69,0)
 ;; S OCXFLD=0 F  S OCXFLD=$O(@OCXCREF@(OCXDD,OCXFLD)) Q:'OCXFLD  Q:(OCXFLD[":")  I '$$EXFLD^|$$RNAME^OCXSEND3(1,1)|(+OCXDD,OCXFLD) D
"RTN","OCXSEND7",70,0)
 ;; .I $L($G(@OCXCREF@(OCXDD,OCXFLD,"E"))) D DIE^|$$RNAME^OCXSEND3(2,1)|(OCXDD,OCXGREF,OCXFLD,@OCXCREF@(OCXDD,OCXFLD,"E"),.OCXDA,OCXLVL)
"RTN","OCXSEND7",71,0)
 ;; ;
"RTN","OCXSEND7",72,0)
 ;; D PUSH(.OCXDA)
"RTN","OCXSEND7",73,0)
 ;; S OCXFLD="" F  S OCXFLD=$O(@OCXCREF@(OCXDD,OCXFLD)) Q:'$L(OCXFLD)  I (OCXFLD[":") D
"RTN","OCXSEND7",74,0)
 ;; .S OCXDA=$P(OCXFLD,":",2) W ! D CREATE($$APPEND(OCXCREF,OCXDD),OCXFLD,.OCXDA,OCXLVL+1)
"RTN","OCXSEND7",75,0)
 ;; D POP(.OCXDA)
"RTN","OCXSEND7",76,0)
 ;; Q
"RTN","OCXSEND7",77,0)
 ;; ;
"RTN","OCXSEND7",78,0)
 ;;PUSH(OCXDA) ;
"RTN","OCXSEND7",79,0)
 ;; N OCXSUB S OCXSUB="" F  S OCXSUB=$O(OCXDA(OCXSUB),-1) Q:'OCXSUB  S OCXDA(OCXSUB+1)=OCXDA(OCXSUB)
"RTN","OCXSEND7",80,0)
 ;; S OCXDA(1)=OCXDA,OCXDA=0
"RTN","OCXSEND7",81,0)
 ;; Q
"RTN","OCXSEND7",82,0)
 ;; ;
"RTN","OCXSEND7",83,0)
 ;;POP(OCXDA) ;
"RTN","OCXSEND7",84,0)
 ;; N OCXSUB S OCXSUB="" F  S OCXSUB=$O(OCXDA(OCXSUB)) Q:'OCXSUB  S OCXDA(OCXSUB)=$G(OCXDA(OCXSUB+1))
"RTN","OCXSEND7",85,0)
 ;; S OCXDA=OCXDA(1) K OCXDA($O(OCXDA(""),-1))
"RTN","OCXSEND7",86,0)
 ;; Q
"RTN","OCXSEND7",87,0)
 ;; ;
"RTN","OCXSEND7",88,0)
 ;;APPEND(ARRAY,OCXSUB) ;
"RTN","OCXSEND7",89,0)
 ;; S:'(OCXSUB=+OCXSUB) OCXSUB=""""_OCXSUB_""""
"RTN","OCXSEND7",90,0)
 ;; Q:'(ARRAY["(") ARRAY_"("_OCXSUB_")"
"RTN","OCXSEND7",91,0)
 ;; Q $E(ARRAY,1,$L(ARRAY)-1)_","_OCXSUB_")"
"RTN","OCXSEND7",92,0)
 ;; ;
"RTN","OCXSEND7",93,0)
 ;;READ(OCXZ0,OCXZA,OCXZB,OCXZL) ;
"RTN","OCXSEND7",94,0)
 ;; N OCXLINE,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","OCXSEND7",95,0)
 ;; Q:'$L($G(OCXZ0)) U
"RTN","OCXSEND7",96,0)
 ;; S DIR(0)=OCXZ0
"RTN","OCXSEND7",97,0)
 ;; S:$L($G(OCXZA)) DIR("A")=OCXZA
"RTN","OCXSEND7",98,0)
 ;; S:$L($G(OCXZB)) DIR("B")=OCXZB
"RTN","OCXSEND7",99,0)
 ;; F OCXLINE=1:1:($G(OCXZL)-1) W !
"RTN","OCXSEND7",100,0)
 ;; D ^DIR
"RTN","OCXSEND7",101,0)
 ;; I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","OCXSEND7",102,0)
 ;; Q Y
"RTN","OCXSEND7",103,0)
 ;; ;
"RTN","OCXSEND7",104,0)
 ;;PAUSE() W "  Press Enter " R X:DTIME W ! Q (X[U)
"RTN","OCXSEND7",105,0)
 ;; ;
"RTN","OCXSEND7",106,0)
 ;;$
"RTN","OCXSEND7",107,0)
 ;1;
"RTN","OCXSEND7",108,0)
 ;
"RTN","OCXSEND8")
0^204^B20772543
"RTN","OCXSEND8",1,0)
OCXSEND8 ;SLC/RJS,CLA - BUILD RULE TRANSPORTER ROUTINES (Build Library Routine 4) ;1/31/01  08:44
"RTN","OCXSEND8",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**32,96,105,243**;Dec 17,1997;Build 242
"RTN","OCXSEND8",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","OCXSEND8",4,0)
 ;
"RTN","OCXSEND8",5,0)
EN() ;
"RTN","OCXSEND8",6,0)
 ;
"RTN","OCXSEND8",7,0)
 N R,LINE,TEXT,NOW,RUCI
"RTN","OCXSEND8",8,0)
 S NOW=$$NOW^OCXSEND3,RUCI=$$NETNAME^OCXSEND
"RTN","OCXSEND8",9,0)
 F LINE=1:1:999 S TEXT=$P($T(TEXT+LINE),";",2,999) Q:TEXT  S TEXT=$P(TEXT,";",2,999) S R(LINE,0)=$$CONV^OCXSEND3(TEXT)
"RTN","OCXSEND8",10,0)
 ;
"RTN","OCXSEND8",11,0)
 M ^TMP("OCXSEND",$J,"RTN")=R
"RTN","OCXSEND8",12,0)
 ;
"RTN","OCXSEND8",13,0)
 S DIE="^TMP(""OCXSEND"","_$J_",""RTN"",",XCN=0,X=$$RNAME^OCXSEND3(4,1)
"RTN","OCXSEND8",14,0)
 W !,X X ^%ZOSF("SAVE") K ^TMP("OCXSEND",$J,"RTN")
"RTN","OCXSEND8",15,0)
 ;
"RTN","OCXSEND8",16,0)
 Q " "
"RTN","OCXSEND8",17,0)
 ;
"RTN","OCXSEND8",18,0)
TEXT ;
"RTN","OCXSEND8",19,0)
 ;;|$$RNAME^OCXSEND3(4,1)| ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE |OCXPATCH| ;|NOW|
"RTN","OCXSEND8",20,0)
 ;;|OCXLIN2|
"RTN","OCXSEND8",21,0)
 ;;|OCXLIN3|
"RTN","OCXSEND8",22,0)
 ;; ;
"RTN","OCXSEND8",23,0)
 ;;S ;
"RTN","OCXSEND8",24,0)
 ;; ;  Field Utilities
"RTN","OCXSEND8",25,0)
 ;; Q
"RTN","OCXSEND8",26,0)
 ;; ;
"RTN","OCXSEND8",27,0)
 ;;EDITFLD(OCXCREF,OCXDD,OCXFLD,OCXSUB) ;
"RTN","OCXSEND8",28,0)
 ;; ;
"RTN","OCXSEND8",29,0)
 ;; N DDPATH,OCXDA,OCXPC,OCXLVL,QUIT
"RTN","OCXSEND8",30,0)
 ;; ;
"RTN","OCXSEND8",31,0)
 ;; S QUIT=0,DDPATH=$P($P($$APPEND(OCXCREF,OCXDD),"(",2),")",1)
"RTN","OCXSEND8",32,0)
 ;; S OCXLVL=$L(DDPATH,",")
"RTN","OCXSEND8",33,0)
 ;; F OCXPC=1:1:OCXLVL S OCXDA(OCXLVL-OCXPC)=+$P($P(DDPATH,",",OCXPC),":",2)
"RTN","OCXSEND8",34,0)
 ;; S OCXDA=OCXDA(0) K OCXDA(0)
"RTN","OCXSEND8",35,0)
 ;; I $L($G(@OCXCREF@(OCXDD,OCXFLD,"E"))) D
"RTN","OCXSEND8",36,0)
 ;; .N RESP
"RTN","OCXSEND8",37,0)
 ;; .Q:(OCXFLAG["D")
"RTN","OCXSEND8",38,0)
 ;; .I (OCXFLAG["A") S RESP=$$READ("Y"," Do you want to change the local '"_$$FILENAME^OCXSENDD(+OCXDD)_"' field ?","YES") I 'RESP S QUIT=(RESP[U) Q
"RTN","OCXSEND8",39,0)
 ;; .S OCXGREF=$$GETREF^|$$RNAME^OCXSEND3(2,1)|(+OCXDD,.OCXDA,OCXLVL-1) Q:'$L(OCXGREF)
"RTN","OCXSEND8",40,0)
 ;; .D DIE^|$$RNAME^OCXSEND3(2,1)|(OCXDD,OCXGREF,OCXFLD,@OCXCREF@(OCXDD,OCXFLD,"E"),.OCXDA,OCXLVL-1)
"RTN","OCXSEND8",41,0)
 ;; ;
"RTN","OCXSEND8",42,0)
 ;; Q QUIT
"RTN","OCXSEND8",43,0)
 ;; ;
"RTN","OCXSEND8",44,0)
 ;;DELFLD(OCXCREF,OCXDD,OCXFLD,OCXSUB) ;
"RTN","OCXSEND8",45,0)
 ;; ;
"RTN","OCXSEND8",46,0)
 ;; N DDPATH,OCXDA,OCXPC,OCXLVL,QUIT,RESP
"RTN","OCXSEND8",47,0)
 ;; ;
"RTN","OCXSEND8",48,0)
 ;; S QUIT=0,DDPATH=$P($P($$APPEND(OCXCREF,OCXDD),"(",2),")",1)
"RTN","OCXSEND8",49,0)
 ;; S OCXLVL=$L(DDPATH,",")
"RTN","OCXSEND8",50,0)
 ;; F OCXPC=1:1:OCXLVL S OCXDA(OCXLVL-OCXPC)=+$P($P(DDPATH,",",OCXPC),":",2)
"RTN","OCXSEND8",51,0)
 ;; S OCXDA=OCXDA(0) K OCXDA(0)
"RTN","OCXSEND8",52,0)
 ;; Q:(OCXFLAG["D") 0
"RTN","OCXSEND8",53,0)
 ;; I (OCXFLAG["A") S RESP=$$READ("Y"," Do you want to Delete the local '"_$$FILENAME^OCXSENDD(+OCXDD)_"' value ?","YES") I 'RESP S QUIT=(RESP[U) Q QUIT
"RTN","OCXSEND8",54,0)
 ;; S OCXGREF=$$GETREF^|$$RNAME^OCXSEND3(2,1)|(+OCXDD,.OCXDA,OCXLVL-1) Q:'$L(OCXGREF)
"RTN","OCXSEND8",55,0)
 ;; D DIE^|$$RNAME^OCXSEND3(2,1)|(OCXDD,OCXGREF,OCXFLD,"@",.OCXDA,OCXLVL-1)
"RTN","OCXSEND8",56,0)
 ;; ;
"RTN","OCXSEND8",57,0)
 ;; Q QUIT
"RTN","OCXSEND8",58,0)
 ;; ;
"RTN","OCXSEND8",59,0)
 ;;CREATE(OCXCREF,OCXDD,OCXDA,OCXLVL) ;
"RTN","OCXSEND8",60,0)
 ;; ;
"RTN","OCXSEND8",61,0)
 ;; N OCXFLD,OCXGREF
"RTN","OCXSEND8",62,0)
 ;; ;
"RTN","OCXSEND8",63,0)
 ;; S OCXGREF=$$GETREF^|$$RNAME^OCXSEND3(2,1)|(+OCXDD,.OCXDA,OCXLVL) Q:'$L(OCXGREF)  S:'OCXDA OCXDA=$O(@(OCXGREF_"""@"")"),-1)+1
"RTN","OCXSEND8",64,0)
 ;; ;
"RTN","OCXSEND8",65,0)
 ;; I '$D(@(OCXGREF_"0)")) S @(OCXGREF_"0)")=U_$$FILEHDR^OCXSENDD(+OCXDD)_U_U
"RTN","OCXSEND8",66,0)
 ;; ;
"RTN","OCXSEND8",67,0)
 ;; S OCXFLD=0 F  S OCXFLD=$O(@OCXCREF@(OCXDD,OCXFLD)) Q:'OCXFLD  Q:(OCXFLD[":")  I '$$EXFLD^|$$RNAME^OCXSEND3(1,1)|(+OCXDD,OCXFLD) D
"RTN","OCXSEND8",68,0)
 ;; .I $L($G(@OCXCREF@(OCXDD,OCXFLD,"E"))) D DIE^|$$RNAME^OCXSEND3(2,1)|(OCXDD,OCXGREF,OCXFLD,@OCXCREF@(OCXDD,OCXFLD,"E"),.OCXDA,OCXLVL)
"RTN","OCXSEND8",69,0)
 ;; ;
"RTN","OCXSEND8",70,0)
 ;; D PUSH(.OCXDA)
"RTN","OCXSEND8",71,0)
 ;; S OCXFLD="" F  S OCXFLD=$O(@OCXCREF@(OCXDD,OCXFLD)) Q:'$L(OCXFLD)  I (OCXFLD[":") D
"RTN","OCXSEND8",72,0)
 ;; .S OCXDA=$P(OCXFLD,":",2) W ! D CREATE($$APPEND(OCXCREF,OCXDD),OCXFLD,.OCXDA,OCXLVL+1)
"RTN","OCXSEND8",73,0)
 ;; D POP(.OCXDA)
"RTN","OCXSEND8",74,0)
 ;; Q
"RTN","OCXSEND8",75,0)
 ;; ;
"RTN","OCXSEND8",76,0)
 ;;PUSH(OCXDA) ;
"RTN","OCXSEND8",77,0)
 ;; N OCXSUB S OCXSUB="" F  S OCXSUB=$O(OCXDA(OCXSUB),-1) Q:'OCXSUB  S OCXDA(OCXSUB+1)=OCXDA(OCXSUB)
"RTN","OCXSEND8",78,0)
 ;; S OCXDA(1)=OCXDA,OCXDA=0
"RTN","OCXSEND8",79,0)
 ;; Q
"RTN","OCXSEND8",80,0)
 ;; ;
"RTN","OCXSEND8",81,0)
 ;;POP(OCXDA) ;
"RTN","OCXSEND8",82,0)
 ;; N OCXSUB S OCXSUB="" F  S OCXSUB=$O(OCXDA(OCXSUB)) Q:'OCXSUB  S OCXDA(OCXSUB)=$G(OCXDA(OCXSUB+1))
"RTN","OCXSEND8",83,0)
 ;; S OCXDA=OCXDA(1) K OCXDA($O(OCXDA(""),-1))
"RTN","OCXSEND8",84,0)
 ;; Q
"RTN","OCXSEND8",85,0)
 ;; ;
"RTN","OCXSEND8",86,0)
 ;;APPEND(ARRAY,OCXSUB) ;
"RTN","OCXSEND8",87,0)
 ;; S:'(OCXSUB=+OCXSUB) OCXSUB=""""_OCXSUB_""""
"RTN","OCXSEND8",88,0)
 ;; Q:'(ARRAY["(") ARRAY_"("_OCXSUB_")"
"RTN","OCXSEND8",89,0)
 ;; Q $E(ARRAY,1,$L(ARRAY)-1)_","_OCXSUB_")"
"RTN","OCXSEND8",90,0)
 ;; ;
"RTN","OCXSEND8",91,0)
 ;;READ(OCXZ0,OCXZA,OCXZB,OCXZL) ;
"RTN","OCXSEND8",92,0)
 ;; N OCXLINE,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","OCXSEND8",93,0)
 ;; Q:'$L($G(OCXZ0)) U
"RTN","OCXSEND8",94,0)
 ;; S DIR(0)=OCXZ0
"RTN","OCXSEND8",95,0)
 ;; S:$L($G(OCXZA)) DIR("A")=OCXZA
"RTN","OCXSEND8",96,0)
 ;; S:$L($G(OCXZB)) DIR("B")=OCXZB
"RTN","OCXSEND8",97,0)
 ;; F OCXLINE=1:1:($G(OCXZL)-1) W !
"RTN","OCXSEND8",98,0)
 ;; D ^DIR
"RTN","OCXSEND8",99,0)
 ;; I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","OCXSEND8",100,0)
 ;; Q Y
"RTN","OCXSEND8",101,0)
 ;; ;
"RTN","OCXSEND8",102,0)
 ;;PAUSE() W "  Press Enter " R X:DTIME W ! Q (X[U)
"RTN","OCXSEND8",103,0)
 ;; ;
"RTN","OCXSEND8",104,0)
 ;;$
"RTN","OCXSEND8",105,0)
 ;1;
"RTN","OCXSEND8",106,0)
 ;
"RTN","OCXSENDA")
0^205^B19003008
"RTN","OCXSENDA",1,0)
OCXSENDA ;SLC/RJS,CLA - BUILD RULE TRANSPORTER ROUTINES (Build Main Routine) ;6/12/02  12:03
"RTN","OCXSENDA",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**32,74,96,105,143,243**;Dec 17,1997;Build 242
"RTN","OCXSENDA",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","OCXSENDA",4,0)
 ;
"RTN","OCXSENDA",5,0)
EN() ;
"RTN","OCXSENDA",6,0)
 ;
"RTN","OCXSENDA",7,0)
 N R,LINE,TEXT,NOW,RUCI
"RTN","OCXSENDA",8,0)
 S NOW=$$NOW^OCXSEND3,RUCI=$$NETNAME^OCXSEND,CVER=$$VERSION^OCXOCMP
"RTN","OCXSENDA",9,0)
 F LINE=1:1:999 S TEXT=$P($T(TEXT+LINE),";",2,999) Q:TEXT  S TEXT=$P(TEXT,";",2,999) S R(LINE,0)=$$CONV^OCXSEND3(TEXT)
"RTN","OCXSENDA",10,0)
 ;
"RTN","OCXSENDA",11,0)
 M ^TMP("OCXSEND",$J,"RTN")=R
"RTN","OCXSENDA",12,0)
 ;
"RTN","OCXSENDA",13,0)
 S DIE="^TMP(""OCXSEND"","_$J_",""RTN"",",XCN=0,X=$$RNAME^OCXSEND3(0,0)
"RTN","OCXSENDA",14,0)
 W !,X X ^%ZOSF("SAVE") K ^TMP("OCXSEND",$J,"RTN")
"RTN","OCXSENDA",15,0)
 ;
"RTN","OCXSENDA",16,0)
 Q " "
"RTN","OCXSENDA",17,0)
 ;
"RTN","OCXSENDA",18,0)
 ;
"RTN","OCXSENDA",19,0)
TEXT ;
"RTN","OCXSENDA",20,0)
 ;;|$$RNAME^OCXSEND3(0,0)| ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE |OCXPATCH| ;|NOW|
"RTN","OCXSENDA",21,0)
 ;;|OCXLIN2|
"RTN","OCXSENDA",22,0)
 ;;|OCXLIN3|
"RTN","OCXSENDA",23,0)
 ;; ;
"RTN","OCXSENDA",24,0)
 ;;S ;
"RTN","OCXSENDA",25,0)
 ;; ;
"RTN","OCXSENDA",26,0)
 ;; N OCXDIER,QUIT,LINE,TEXT,REMOTE,LOCAL,D0,OPCODE,REF,OCXFLAG S QUIT=0
"RTN","OCXSENDA",27,0)
 ;; N OCXAUTO,OCZSCR
"RTN","OCXSENDA",28,0)
 ;; ;
"RTN","OCXSENDA",29,0)
 ;; D DOT
"RTN","OCXSENDA",30,0)
 ;; I $L($T(VERSION^OCXOCMP)),($$VERSION^OCXOCMP="|CVER|"),1
"RTN","OCXSENDA",31,0)
 ;; E  D  Q
"RTN","OCXSENDA",32,0)
 ;; .W !
"RTN","OCXSENDA",33,0)
 ;; .W !,"Rule Transport aborted, version mismatch."
"RTN","OCXSENDA",34,0)
 ;; .W !,"Current Local version: ",$$VERSION^OCXOCMP
"RTN","OCXSENDA",35,0)
 ;; .W !,"   Rule Transport Version: |CVER|"
"RTN","OCXSENDA",36,0)
 ;; I '$D(DTIME) W !!,"DTIME not defined !!",!! Q
"RTN","OCXSENDA",37,0)
 ;; W !!,"Order Check Expert System Rule Transporter"
"RTN","OCXSENDA",38,0)
 ;; W !," Created: |NOW|  at  |RUCI|"
"RTN","OCXSENDA",39,0)
 ;; W !," Current Date: ",$$NOW^|$$RNAME^OCXSEND3(0,1)|,"  at  ",$$NETNAME^OCXSEND,!!
"RTN","OCXSENDA",40,0)
 ;; S LASTFILE=0 K ^TMP("OCXRULE",$J)
"RTN","OCXSENDA",41,0)
 ;; S ^TMP("OCXRULE",$J)=($P($H,",",2)+($H*86400)+(1*60*60))_" <- ^TMP ENTRY EXPIRATION DATE FOR ^OCXOPURG"
"RTN","OCXSENDA",42,0)
 ;; S OCXFLAG="|OCXASK|"
"RTN","OCXSENDA",43,0)
 ;; ;
"RTN","OCXSENDA",44,0)
 ;;RUN ;
"RTN","OCXSENDA",45,0)
 ;; ;
"RTN","OCXSENDA",46,0)
 ;; W !,"Loading Data " D ^|$$RNAME^OCXSEND3(1,2)|
"RTN","OCXSENDA",47,0)
 ;; ;
"RTN","OCXSENDA",48,0)
 ;; S LINE=0 F  S LINE=$O(^TMP("OCXRULE",$J,LINE)) Q:'LINE   D  Q:QUIT
"RTN","OCXSENDA",49,0)
 ;; .D:'(LINE#50) STATUS^OCXOPOST(LINE,$O(^TMP("OCXRULE",$J," "),-1))
"RTN","OCXSENDA",50,0)
 ;; .S TEXT=$G(^TMP("OCXRULE",$J,LINE)) I $L(TEXT) D  Q:QUIT
"RTN","OCXSENDA",51,0)
 ;; ..S TEXT=$P(TEXT,";",2,999),OPCODE=$P(TEXT,U,1),TEXT=$P(TEXT,U,2,999)
"RTN","OCXSENDA",52,0)
 ;; ..;
"RTN","OCXSENDA",53,0)
 ;; ..I OPCODE="KEY" D DOT S LOCAL="",D0=$$GETFILE^|$$RNAME^OCXSEND3(0,1)|(+$P(TEXT,U,1),$P(TEXT,U,2),.LOCAL) S QUIT=(D0=(-10)) Q
"RTN","OCXSENDA",54,0)
 ;; ..I OPCODE="R" S REF="REMOTE("_$P(TEXT,":",1)_":"_D0_$P(TEXT,":",2,99)_")" Q
"RTN","OCXSENDA",55,0)
 ;; ..I OPCODE="D",$D(REF) S @REF=$P(TEXT,U,1,999) K REF Q
"RTN","OCXSENDA",56,0)
 ;; ..;
"RTN","OCXSENDA",57,0)
 ;; ..I OPCODE="EOR" S QUIT=$$COMPARE^|$$RNAME^OCXSEND3(1,1)|(.LOCAL,.REMOTE) K LOCAL,REMOTE Q
"RTN","OCXSENDA",58,0)
 ;; ..I OPCODE="EOF" K LOCAL,REMOTE Q
"RTN","OCXSENDA",59,0)
 ;; ..I OPCODE="SOF" W !,"  Installing '",TEXT,"' records... " Q
"RTN","OCXSENDA",60,0)
 ;; ..I OPCODE="ROOT" D  Q
"RTN","OCXSENDA",61,0)
 ;; ...N FILE,DATA
"RTN","OCXSENDA",62,0)
 ;; ...S FILE=U_$P(TEXT,U,1),DATA=$P(TEXT,U,2,3)
"RTN","OCXSENDA",63,0)
 ;; ...I ($P($G(@FILE),U,1,2)=DATA) Q
"RTN","OCXSENDA",64,0)
 ;; ...S $P(@FILE,U,1,2)=DATA
"RTN","OCXSENDA",65,0)
 ;; ...W !,"  Restoring file #",(+$P(DATA,U,2))," zero node"
"RTN","OCXSENDA",66,0)
 ;; ..;
"RTN","OCXSENDA",67,0)
 ;; ..W !,"Unknown OpCode: ",OPCODE,"  in: ",TEXT S QUIT=$$PAUSE^|$$RNAME^OCXSEND3(0,1)| W !
"RTN","OCXSENDA",68,0)
 ;; ;
"RTN","OCXSENDA",69,0)
 ;; K ^TMP("OCXRULE",$J)
"RTN","OCXSENDA",70,0)
 ;; ;
"RTN","OCXSENDA",71,0)
 ;; I $D(^OCXS) D
"RTN","OCXSENDA",72,0)
 ;; .N FILE,DO,PD0,CNT
"RTN","OCXSENDA",73,0)
 ;; .S FILE=0 F  S FILE=$O(^OCXS(FILE)) Q:'FILE  D
"RTN","OCXSENDA",74,0)
 ;; ..S D0=0 F CNT=0:1 S PD0=D0,D0=$O(^OCXS(FILE,D0)) Q:'D0
"RTN","OCXSENDA",75,0)
 ;; ..S $P(^OCXS(FILE,0),U,3,4)=CNT_U_PD0
"RTN","OCXSENDA",76,0)
 ;; ;
"RTN","OCXSENDA",77,0)
 ;; I $G(OCXDIER) D
"RTN","OCXSENDA",78,0)
 ;; .W !!!!!!!
"RTN","OCXSENDA",79,0)
 ;; .W !,?5,"******************** Warning ******************** "
"RTN","OCXSENDA",80,0)
 ;; .W !,?7,+$G(OCXDIER)," data filing error",$S(($G(OCXDIER)=1):"",1:"s"),"."
"RTN","OCXSENDA",81,0)
 ;; .W !,?7,"Some expert system rules may be incomplete."
"RTN","OCXSENDA",82,0)
 ;; .W !,?5,"******************** Warning ******************** "
"RTN","OCXSENDA",83,0)
 ;; I '$G(OCXDIER) W !!,?5," No data filing errors."
"RTN","OCXSENDA",84,0)
 ;; W !!,"Transport Finished..."
"RTN","OCXSENDA",85,0)
 ;; ;
"RTN","OCXSENDA",86,0)
 ;; D
"RTN","OCXSENDA",87,0)
 ;; .N OCXOETIM
"RTN","OCXSENDA",88,0)
 ;; .D BMES^XPDUTL("---Creating Order Check Routines-----------------------------------")
"RTN","OCXSENDA",89,0)
 ;; .D AUTO^OCXOCMP
"RTN","OCXSENDA",90,0)
 ;; ;
"RTN","OCXSENDA",91,0)
 ;; Q
"RTN","OCXSENDA",92,0)
 ;; ;
"RTN","OCXSENDA",93,0)
 ;;DOT Q:$G(OCXAUTO)  W:($X>70) ! W " ." Q
"RTN","OCXSENDA",94,0)
 ;; ;
"RTN","OCXSENDA",95,0)
 ;;READ(OCXZ0,OCXZA,OCXZB,OCXZL) ;
"RTN","OCXSENDA",96,0)
 ;; N OCXLINE,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","OCXSENDA",97,0)
 ;; Q:'$L($G(OCXZ0)) U
"RTN","OCXSENDA",98,0)
 ;; S DIR(0)=OCXZ0
"RTN","OCXSENDA",99,0)
 ;; S:$L($G(OCXZA)) DIR("A")=OCXZA
"RTN","OCXSENDA",100,0)
 ;; S:$L($G(OCXZB)) DIR("B")=OCXZB
"RTN","OCXSENDA",101,0)
 ;; F OCXLINE=1:1:($G(OCXZL)-1) W !
"RTN","OCXSENDA",102,0)
 ;; D ^DIR
"RTN","OCXSENDA",103,0)
 ;; I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","OCXSENDA",104,0)
 ;; Q Y
"RTN","OCXSENDA",105,0)
 ;; ;
"RTN","OCXSENDA",106,0)
 ;;$
"RTN","OCXSENDA",107,0)
 ;1;
"RTN","OR3CONV")
1^182
"RTN","OR3CONV1")
1^183
"RTN","OR3POST")
1^184
"RTN","ORALWORD")
0^66^B47499175
"RTN","ORALWORD",1,0)
ORALWORD ; SLC/JMH - Utilities for Checking if an order can be ordered ; 5/10/07 5:55am
"RTN","ORALWORD",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORALWORD",3,0)
 ;
"RTN","ORALWORD",4,0)
ALLWORD(ORY,DFN,ORX,ORTYPE,PROV) ;
"RTN","ORALWORD",5,0)
 N OROI,ORYS,QOIEN,QPIEN,ORCLOZ,QOAA
"RTN","ORALWORD",6,0)
 S OROI=0
"RTN","ORALWORD",7,0)
 ;
"RTN","ORALWORD",8,0)
 ;ORTYPE used to determine the type of data coming into the call
"RTN","ORALWORD",9,0)
 ;ORYTPE="E" existing order, ORX equal the IEN from file 100 (used with
"RTN","ORALWORD",10,0)
 ;copy,edit functionality)
"RTN","ORALWORD",11,0)
 ;ORTYPE="Q" Quick Order, ORX equal the IEN from file 101.43
"RTN","ORALWORD",12,0)
 ;ORTYPE="N" New order, ORX equal the IEN from file 101.41
"RTN","ORALWORD",13,0)
 ;
"RTN","ORALWORD",14,0)
 I ORTYPE="E" S OROI=$G(^OR(100,ORX,.1,1,0))
"RTN","ORALWORD",15,0)
 I ORTYPE="Q" D
"RTN","ORALWORD",16,0)
 .S QPIEN=$O(^ORD(101.41,"AB","OR GTX ORDERABLE ITEM","")) Q:QPIEN'>0
"RTN","ORALWORD",17,0)
 .S QOIEN=$O(^ORD(101.41,ORX,6,"D",QPIEN,"")) Q:QOIEN'>0
"RTN","ORALWORD",18,0)
 .S OROI=$G(^ORD(101.41,ORX,6,QOIEN,1))
"RTN","ORALWORD",19,0)
 .S QOAA=$P($G(^ORD(101.41,ORX,5)),U,8)
"RTN","ORALWORD",20,0)
 I ORTYPE="N" S OROI=ORX
"RTN","ORALWORD",21,0)
 Q:OROI'>0
"RTN","ORALWORD",22,0)
 S ORY=0
"RTN","ORALWORD",23,0)
 ;checks if the orderable item (OROI) is a clozapine med
"RTN","ORALWORD",24,0)
 ;  if not returns ORY=0
"RTN","ORALWORD",25,0)
 S ORCLOZ=$$ISCLOZ(OROI),ORY=ORY_U_ORCLOZ,ORY(0)=U_ORCLOZ
"RTN","ORALWORD",26,0)
 Q:'ORCLOZ
"RTN","ORALWORD",27,0)
 N ORQUIT
"RTN","ORALWORD",28,0)
 S ORQUIT=0
"RTN","ORALWORD",29,0)
 I '$G(PROV) S PROV=DUZ
"RTN","ORALWORD",30,0)
 I $G(PROV) D
"RTN","ORALWORD",31,0)
 .I '$L($$DEA^XUSER(,PROV)) D
"RTN","ORALWORD",32,0)
 ..S ORQUIT=1,ORY=1
"RTN","ORALWORD",33,0)
 ..S ORQUIT=1,ORY=1
"RTN","ORALWORD",34,0)
 ..S ORY(1)="*** You are not authorized to place Clozapine orders."
"RTN","ORALWORD",35,0)
 ..S ORY(2)="You must have a DEA#.  Please contact your"
"RTN","ORALWORD",36,0)
 ..S ORY(3)="CAC or IRM for more information. ***"
"RTN","ORALWORD",37,0)
 .Q:ORQUIT
"RTN","ORALWORD",38,0)
 .I '$D(^XUSEC("YSCL AUTHORIZED",PROV)) D
"RTN","ORALWORD",39,0)
 ..S ORQUIT=1,ORY=1
"RTN","ORALWORD",40,0)
 ..S ORY(1)="*** You are not authorized to place Clozapine orders."
"RTN","ORALWORD",41,0)
 ..S ORY(2)="You must hold key YSCL AUTHORIZED.  Please contact your"
"RTN","ORALWORD",42,0)
 ..S ORY(3)="CAC or IRM for more information on this key. ***"
"RTN","ORALWORD",43,0)
 Q:ORQUIT
"RTN","ORALWORD",44,0)
 ;  if is a cloz med , check if patient (DFN) can have a clozapine med
"RTN","ORALWORD",45,0)
 S ORYS=$$CL^YSCLTST2(DFN)
"RTN","ORALWORD",46,0)
 ;    if yes returns ORY=0
"RTN","ORALWORD",47,0)
 I +ORYS>0 D BEFQUIT  Q
"RTN","ORALWORD",48,0)
 ;    if no 
"RTN","ORALWORD",49,0)
 ;      returns 
"RTN","ORALWORD",50,0)
 ;    ORY=1
"RTN","ORALWORD",51,0)
 ;    ORY(0)=CAPTION FOR DIALOG BOX
"RTN","ORALWORD",52,0)
 ;    ORY(1-N)=MESSAGE TO DISPLAY
"RTN","ORALWORD",53,0)
 S ORY=1_U_ORCLOZ,ORY(0)="Problem Ordering Clozapine Related Medication"_U_ORCLOZ
"RTN","ORALWORD",54,0)
 ;patient not in clozapine patient program
"RTN","ORALWORD",55,0)
 I +ORYS<0 D  Q
"RTN","ORALWORD",56,0)
 .S ORY(1)="*** This patient is not registered in the clozapine treatment "
"RTN","ORALWORD",57,0)
 .S ORY(2)="program or has been discontinued from the program and must "
"RTN","ORALWORD",58,0)
 .S ORY(3)="have a new registration number assigned.  Contact the NCCC to "
"RTN","ORALWORD",59,0)
 .S ORY(4)="get this patient registered in the program. ***"
"RTN","ORALWORD",60,0)
 ;problem with lab tests
"RTN","ORALWORD",61,0)
 I +ORYS=0 D  Q
"RTN","ORALWORD",62,0)
 .I $$OVERRIDE^YSCLTST2(DFN) S ORY=0_U_ORCLOZ,ORY(0)=U_ORCLOZ D BEFQUIT  Q  ;override allowed
"RTN","ORALWORD",63,0)
 .N COUNT S COUNT=0
"RTN","ORALWORD",64,0)
 .S COUNT=COUNT+1,ORY(COUNT)="*** This clozapine drug may not be dispensed to the patient at this "
"RTN","ORALWORD",65,0)
 .S COUNT=COUNT+1,ORY(COUNT)="time based on the available lab tests related to the clozapine "
"RTN","ORALWORD",66,0)
 .S COUNT=COUNT+1,ORY(COUNT)="treatment program. Please contact the NCCC to request an override in"
"RTN","ORALWORD",67,0)
 .S COUNT=COUNT+1,ORY(COUNT)="order to proceed with dispensing this drug. ***"
"RTN","ORALWORD",68,0)
 .Q:'$L($P(ORYS,U,3))!('$L($P(ORYS,U,5)))
"RTN","ORALWORD",69,0)
 .S COUNT=COUNT+1,ORY(COUNT)="Related Lab Test(s)"
"RTN","ORALWORD",70,0)
 .S COUNT=COUNT+1,ORY(COUNT)="==================="
"RTN","ORALWORD",71,0)
 .;the lab values returned by Mental Health are given in 4 digit numbers to be standard with 
"RTN","ORALWORD",72,0)
 .;reporting formats to the NCCC, we are dividing by 1000 to align it with the display of the
"RTN","ORALWORD",73,0)
 .;labs on the lab tab
"RTN","ORALWORD",74,0)
 .;S:$L($P(ORYS,U,3)) COUNT=COUNT+1,ORY(COUNT)=$P(ORYS,U,3)_":  "_($P(ORYS,U,2)/1000)_" K/cmm"
"RTN","ORALWORD",75,0)
 .;S:$L($P(ORYS,U,5)) COUNT=COUNT+1,ORY(COUNT)=$P(ORYS,U,5)_":  "_($P(ORYS,U,4)/1000)_" K/cmm"
"RTN","ORALWORD",76,0)
 .S:$L($P(ORYS,U,3)) COUNT=COUNT+1,ORY(COUNT)="WBC:  "_($P(ORYS,U,2)/1000)_" K/cmm"
"RTN","ORALWORD",77,0)
 .S:$L($P(ORYS,U,5)) COUNT=COUNT+1,ORY(COUNT)="ANC:  "_($P(ORYS,U,4)/1000)_" K/cmm"
"RTN","ORALWORD",78,0)
 .S COUNT=COUNT+1,ORY(COUNT)="Date/Time of last tests: "_$$DATE^ORU($P(ORYS,U,6))
"RTN","ORALWORD",79,0)
 Q
"RTN","ORALWORD",80,0)
BEFQUIT ;
"RTN","ORALWORD",81,0)
 Q:'$G(QOAA)
"RTN","ORALWORD",82,0)
 N QODS,QORF,ORMAX,ORCLPAT
"RTN","ORALWORD",83,0)
 S QODS=$O(^ORD(101.41,"AB","OR GTX DAYS SUPPLY","")) Q:QODS'>0
"RTN","ORALWORD",84,0)
 S QODS=$O(^ORD(101.41,ORX,6,"D",QODS,"")) Q:QOIEN'>0
"RTN","ORALWORD",85,0)
 S QODS=$G(^ORD(101.41,ORX,6,QODS,1))
"RTN","ORALWORD",86,0)
 S QORF=$O(^ORD(101.41,"AB","OR GTX REFILLS","")) Q:QORF'>0
"RTN","ORALWORD",87,0)
 S QORF=$O(^ORD(101.41,ORX,6,"D",QORF,"")) Q:QOIEN'>0
"RTN","ORALWORD",88,0)
 S QORF=$G(^ORD(101.41,ORX,6,QORF,1))
"RTN","ORALWORD",89,0)
 S QORF=QORF+1
"RTN","ORALWORD",90,0)
 S ORCLPAT=$P(ORYS,U,7)
"RTN","ORALWORD",91,0)
 S ORMAX=$S(ORYS="M":28,ORYS="B":14,ORYS="W":7,1:90)
"RTN","ORALWORD",92,0)
 I QORF*QODS>ORMAX D
"RTN","ORALWORD",93,0)
 .K ORY
"RTN","ORALWORD",94,0)
 .S ORY=1_U_ORCLOZ,ORY(0)="Problem Ordering Clozapine Related Medication"_U_ORCLOZ
"RTN","ORALWORD",95,0)
 .S ORY(1)="*** This patient is only allowed an order with a maximum Days Supply of "_ORMAX_"."
"RTN","ORALWORD",96,0)
 .S ORY(2)="This includes the amounts added by any refills entered in with the order also."
"RTN","ORALWORD",97,0)
 Q
"RTN","ORALWORD",98,0)
ISCLOZ(OROI) ;
"RTN","ORALWORD",99,0)
 N ORPSOI,ORPSDRUG
"RTN","ORALWORD",100,0)
 S ORPSOI=$P(^ORD(101.43,OROI,0),U,2)
"RTN","ORALWORD",101,0)
 I $P(ORPSOI,";",2)'="99PSP" Q 0
"RTN","ORALWORD",102,0)
 K ^TMP($J,"ORCLOZ")
"RTN","ORALWORD",103,0)
 D ASP^PSS50(+ORPSOI,,,"ORCLOZ")
"RTN","ORALWORD",104,0)
 S ORPSDRUG=$O(^TMP($J,"ORCLOZ",0))
"RTN","ORALWORD",105,0)
 I 'ORPSDRUG K ^TMP($J,"ORCLOZ") Q 0
"RTN","ORALWORD",106,0)
 K ^TMP($J,"ORCLOZ")
"RTN","ORALWORD",107,0)
 D CLOZ^PSS50(ORPSDRUG,,,,,"ORCLOZ")
"RTN","ORALWORD",108,0)
 I $G(^TMP($J,"ORCLOZ",ORPSDRUG,"CLOZ",0))>0 K ^TMP($J,"ORCLOZ") Q 1
"RTN","ORALWORD",109,0)
 K ^TMP($J,"ORCLOZ")
"RTN","ORALWORD",110,0)
 Q 0
"RTN","ORALWORD",111,0)
ALLWRN(ORY,ORN,REFILLS) ;allow order to be renewed
"RTN","ORALWORD",112,0)
 ;ORN is the order number
"RTN","ORALWORD",113,0)
 ;REFILLS is the number of refills to be included with the renewed order
"RTN","ORALWORD",114,0)
 N ORDS,ORQT,ORUPD,ORSCH,ORDUR,ORDFN,ORDRG,OROI,ORMAXDS,ORMAXQT,ORCLOZ,ORREF,ORMAXREF
"RTN","ORALWORD",115,0)
 ;default return 1 (ORY=1 means allow renew)
"RTN","ORALWORD",116,0)
 S ORY=1
"RTN","ORALWORD",117,0)
 ;get DFN (ORDFN)
"RTN","ORALWORD",118,0)
 S ORDFN=+$P(^OR(100,ORN,0),U,2)
"RTN","ORALWORD",119,0)
 Q:'ORDFN
"RTN","ORALWORD",120,0)
 ;get if order is a clozapine order (ORCLOZ)
"RTN","ORALWORD",121,0)
 S OROI=$G(^OR(100,ORN,.1,1,0)) Q:'OROI
"RTN","ORALWORD",122,0)
 S ORCLOZ=$$ISCLOZ(OROI)
"RTN","ORALWORD",123,0)
 ;quit if order is not clozapine
"RTN","ORALWORD",124,0)
 I 'ORCLOZ Q
"RTN","ORALWORD",125,0)
 ;get schedule from order (ORSCH)
"RTN","ORALWORD",126,0)
 S ORSCH=$G(^OR(100,ORN,4.5,$O(^OR(100,ORN,4.5,"ID","SCHEDULE",0)),1))
"RTN","ORALWORD",127,0)
 ;get units per dose from order (ORUPD)
"RTN","ORALWORD",128,0)
 S ORSCH=$G(^OR(100,ORN,4.5,$O(^OR(100,ORN,4.5,"ID","DOSE",0)),1))
"RTN","ORALWORD",129,0)
 S ORSCH=$P(ORSCH,"&",3)
"RTN","ORALWORD",130,0)
 ;get duration from order (ORDUR)
"RTN","ORALWORD",131,0)
 I '$O(^OR(100,ORN,4.5,"ID","DURATION",0)) S ORDUR="~^"
"RTN","ORALWORD",132,0)
 E  S ORSCH=$G(^OR(100,ORN,4.5,$O(^OR(100,ORN,4.5,"ID","DURATION",0)),1))
"RTN","ORALWORD",133,0)
 ;get days supply from order (ORDS)
"RTN","ORALWORD",134,0)
 S ORSCH=$G(^OR(100,ORN,4.5,$O(^OR(100,ORN,4.5,"ID","SUPPLY",0)),1))
"RTN","ORALWORD",135,0)
 ;get drug (ptr50) from order (ORDRG)
"RTN","ORALWORD",136,0)
 S ORSCH=$G(^OR(100,ORN,4.5,$O(^OR(100,ORN,4.5,"ID","DRUG",0)),1))
"RTN","ORALWORD",137,0)
 ;get refills from order (ORREF)
"RTN","ORALWORD",138,0)
 S ORSCH=$G(^OR(100,ORN,4.5,$O(^OR(100,ORN,4.5,"ID","REFILLS",0)),1))
"RTN","ORALWORD",139,0)
 ;get quantity from order (ORQT)
"RTN","ORALWORD",140,0)
 S ORSCH=$G(^OR(100,ORN,4.5,$O(^OR(100,ORN,4.5,"ID","QTY",0)),1))
"RTN","ORALWORD",141,0)
 ;get max days supply for order (ORMAXDS)
"RTN","ORALWORD",142,0)
 S ORMAXDS=$$DEFSPLY^ORWDPS1(ORDFN)
"RTN","ORALWORD",143,0)
 ;if ds from order is > max ds return 0 (ORY=0)
"RTN","ORALWORD",144,0)
 I ORDS>ORMAXDS D  Q
"RTN","ORALWORD",145,0)
 .S ORY=0
"RTN","ORALWORD",146,0)
 .S ORY(0)="Problem Renewing Clozapine Related Medication"_U_ORCLOZ
"RTN","ORALWORD",147,0)
 .S ORY(1)="The Days Supply set for this order is greater than the Max Days Supply"
"RTN","ORALWORD",148,0)
 .S ORY(2)="    allowed for this patient."
"RTN","ORALWORD",149,0)
 ;get max quantity for order (ORMAXQT)
"RTN","ORALWORD",150,0)
 D DAY2QTY^ORWDPS2(.ORMAXQT,ORDS,ORUPD,ORSCH,ORDUR,ORDFN,ORDRG)
"RTN","ORALWORD",151,0)
 ;if qt from order is > max qt return 0 (ORY=0)
"RTN","ORALWORD",152,0)
 I ORQT>ORMAXQT D  Q
"RTN","ORALWORD",153,0)
 .S ORY=0
"RTN","ORALWORD",154,0)
 .S ORY(0)="Problem Renewing Clozapine Related Medication"_U_ORCLOZ
"RTN","ORALWORD",155,0)
 .S ORY(1)="The Quantity set for this order is greater than the Max Quantity"
"RTN","ORALWORD",156,0)
 .S ORY(2)="    allowed for this patient."
"RTN","ORALWORD",157,0)
 ;get max refills for order (ORMAXREF)
"RTN","ORALWORD",158,0)
 D MAXREF^ORWDPS2(.ORMAXREF,ORDFN,ORDRG,ORDS,OROI,1)
"RTN","ORALWORD",159,0)
 ;if refill from order is > max refills return 0 (ORY=0)
"RTN","ORALWORD",160,0)
 I ORREF>ORMAXREF D  Q
"RTN","ORALWORD",161,0)
 .S ORY=0
"RTN","ORALWORD",162,0)
 .S ORY(0)="Problem Renewing Clozapine Related Medication"_U_ORCLOZ
"RTN","ORALWORD",163,0)
 .S ORY(1)="The Refills field set for this order is greater than the Refills"
"RTN","ORALWORD",164,0)
 .S ORY(2)="    allowed for this patient with the order having a Days Supply "
"RTN","ORALWORD",165,0)
 .S ORY(3)="    of "_ORDS_"."
"RTN","ORALWORD",166,0)
 Q
"RTN","ORB3FUP1")
0^177^B64991738
"RTN","ORB3FUP1",1,0)
ORB3FUP1 ; slc/CLA - Routine to support notification follow-up actions ; 4/8/08 9:32am
"RTN","ORB3FUP1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**9,64,74,105,139,243**;Dec 17, 1997;Build 242
"RTN","ORB3FUP1",3,0)
 Q
"RTN","ORB3FUP1",4,0)
TYPE(ORBY,ORXQAID) ; return notif follow-up action type
"RTN","ORB3FUP1",5,0)
 N NIEN
"RTN","ORB3FUP1",6,0)
 S NIEN=$P($P(ORXQAID,";"),",",3)
"RTN","ORB3FUP1",7,0)
 S ORBY=$G(^ORD(100.9,NIEN,3))
"RTN","ORB3FUP1",8,0)
 I ORBY="" S ORBY="INFO^"
"RTN","ORB3FUP1",9,0)
 E  S ORBY=$P(ORBY,U,2)
"RTN","ORB3FUP1",10,0)
 Q
"RTN","ORB3FUP1",11,0)
GUI(ORBY,ORXQAID) ; Notification follow-up for GUI called via API: ORB FOLLOW-UP
"RTN","ORB3FUP1",12,0)
 ; called by ORB FOLLOW-UP api:
"RTN","ORB3FUP1",13,0)
 S ORENVIR="GUI"
"RTN","ORB3FUP1",14,0)
 D PROCESS
"RTN","ORB3FUP1",15,0)
 Q
"RTN","ORB3FUP1",16,0)
PROCESS ; main process for notification follow-up
"RTN","ORB3FUP1",17,0)
 ;ORXQAID = OR,dfn,nien;
"RTN","ORB3FUP1",18,0)
 ;XQADATA = placer num^placer id;filler num^filler id
"RTN","ORB3FUP1",19,0)
 ;XQAKILL = value of parameter ORB DELETE MECHANISM for notif in 100.9
"RTN","ORB3FUP1",20,0)
 N ORPDIEN,ORN,ORDFN,ORSITE,ORFID,ORFIEN,ORKILL
"RTN","ORB3FUP1",21,0)
 D GETACT^XQALERT(ORXQAID)  ;return follow-up action info
"RTN","ORB3FUP1",22,0)
 ;Q:'($D(XQADATA))  Q:'($D(XQAID))
"RTN","ORB3FUP1",23,0)
 ;Q:($P(XQAID,",")'="OR")
"RTN","ORB3FUP1",24,0)
 ;call function rpc stored in xqarou with params from xqadata
"RTN","ORB3FUP1",25,0)
 D @XQAROU
"RTN","ORB3FUP1",26,0)
 K ORENVIR
"RTN","ORB3FUP1",27,0)
 Q
"RTN","ORB3FUP1",28,0)
MSG ; display msg re: alert being processed for non-GUI follow-up actions
"RTN","ORB3FUP1",29,0)
 I $G(ORENVIR)'="GUI" D
"RTN","ORB3FUP1",30,0)
 .I $L($G(XQX)) W !!,"Processing alert: ",$P(XQX,U,3) H 1.5
"RTN","ORB3FUP1",31,0)
 Q
"RTN","ORB3FUP1",32,0)
DEL(ORBY,XQAID,ORKILL) ; delete an alert
"RTN","ORB3FUP1",33,0)
 N ORN
"RTN","ORB3FUP1",34,0)
 S ORN=$P($P(XQAID,";"),",",3)
"RTN","ORB3FUP1",35,0)
 I $G(ORKILL)=1!($G(ORKILL)=0) S XQAKILL=ORKILL
"RTN","ORB3FUP1",36,0)
 I $G(XQAKILL)="" S XQAKILL=$$XQAKILL^ORB3F1(ORN)
"RTN","ORB3FUP1",37,0)
 I $G(XQAKILL)="" S XQAKILL=1
"RTN","ORB3FUP1",38,0)
 S ORBY="FALSE"
"RTN","ORB3FUP1",39,0)
 I $L($G(XQAID)) D DELETE^XQALERT S ORBY="TRUE"
"RTN","ORB3FUP1",40,0)
 K XQAKILL
"RTN","ORB3FUP1",41,0)
 Q
"RTN","ORB3FUP1",42,0)
CSORD ;co-sign order(s) follow-up
"RTN","ORB3FUP1",43,0)
 K XQAKILL
"RTN","ORB3FUP1",44,0)
 N ORPT,ORDG,ORBXQAID,ORY S ORBXQAID=XQAID
"RTN","ORB3FUP1",45,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP1",46,0)
 ;the FLG code for orders requiring CO-SIGNATURE in ORQ1 is 'to be determined when ASU is available'
"RTN","ORB3FUP1",47,0)
 D DEL(.ORY,XQAID)  ;until ASU is implemented, delete the alert and quit
"RTN","ORB3FUP1",48,0)
 Q  ;quit until ASU is implemented
"RTN","ORB3FUP1",49,0)
 ;I $G(ORENVIR)="GUI" D LIST^ORQOR1(.ORBY,ORPT,"ALL",???,"","")
"RTN","ORB3FUP1",50,0)
 ;I $G(ORENVIR)'="GUI" D 
"RTN","ORB3FUP1",51,0)
 ;.D MSG
"RTN","ORB3FUP1",52,0)
 ;.S ORDG=$$DG^ORQOR1("ALL")  ;get Display Group ien
"RTN","ORB3FUP1",53,0)
 ;.D EN^ORCB(ORPT,???,ORDG,???)
"RTN","ORB3FUP1",54,0)
 ;.K ^TMP("ORR",$J)
"RTN","ORB3FUP1",55,0)
 ;.D EN^ORQ1(ORPT_";DPT(",ORDG,???,"","","",0,0)
"RTN","ORB3FUP1",56,0)
 ;.S X="",X=$O(^TMP("ORR",$J,X)) Q:X=""  I +$G(^TMP("ORR",$J,X,"TOT"))<1 D
"RTN","ORB3FUP1",57,0)
 ;..D DEL(.ORY,ORBXQAID)  ;if no more orders req. co-sign, delete the alert
"RTN","ORB3FUP1",58,0)
 ;.K ^TMP("ORR",$J)
"RTN","ORB3FUP1",59,0)
 Q
"RTN","ORB3FUP1",60,0)
EXDNR ;expiring dnr follow-up
"RTN","ORB3FUP1",61,0)
 K XQAKILL
"RTN","ORB3FUP1",62,0)
 N ORPT,ORBXQAID,ORY S ORBXQAID=XQAID
"RTN","ORB3FUP1",63,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP1",64,0)
 N DNRORD,DNRY S DNRORD=$P(XQADATA,"@")
"RTN","ORB3FUP1",65,0)
 I $G(ORENVIR)="GUI" D
"RTN","ORB3FUP1",66,0)
 .S ORBY(1)=DNRY
"RTN","ORB3FUP1",67,0)
 I $G(ORENVIR)'="GUI" D
"RTN","ORB3FUP1",68,0)
 .D MSG
"RTN","ORB3FUP1",69,0)
 .D EN1^ORCB(DNRORD,"RENEW")  ;display order, allow renewing, then delete
"RTN","ORB3FUP1",70,0)
 .D DEL(.ORY,ORBXQAID)
"RTN","ORB3FUP1",71,0)
 Q
"RTN","ORB3FUP1",72,0)
UNLINKED ;unlinked provider follow-up
"RTN","ORB3FUP1",73,0)
 K XQAKILL
"RTN","ORB3FUP1",74,0)
 N ORPT,ORBXQAID,ORY S ORBXQAID=XQAID
"RTN","ORB3FUP1",75,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP1",76,0)
 N ORNUM,ORUNY S ORNUM=$P(XQADATA,"@")
"RTN","ORB3FUP1",77,0)
 I $G(ORENVIR)="GUI" D 
"RTN","ORB3FUP1",78,0)
 .S ORBY(1)=ORUNY
"RTN","ORB3FUP1",79,0)
 I $G(ORENVIR)'="GUI" D
"RTN","ORB3FUP1",80,0)
 .D MSG
"RTN","ORB3FUP1",81,0)
 .D EN1^ORCB(ORNUM,"REPLACE")  ;display order, allow replace, then delete
"RTN","ORB3FUP1",82,0)
 .D DEL(.ORY,ORBXQAID)
"RTN","ORB3FUP1",83,0)
 Q
"RTN","ORB3FUP1",84,0)
FLORD ;flagged order(s) follow-up
"RTN","ORB3FUP1",85,0)
 K XQAKILL
"RTN","ORB3FUP1",86,0)
 N ORPT,ORDG,X,ORBXQAID,ORY,ORBLMDEL
"RTN","ORB3FUP1",87,0)
 S ORBXQAID=XQAID
"RTN","ORB3FUP1",88,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP1",89,0)
 ;the FLG code for "FLAGGED" in ORQ1 is '12'
"RTN","ORB3FUP1",90,0)
 I $G(ORENVIR)="GUI" D LIST^ORQOR1(.ORBY,ORPT,"ALL",12,"","")
"RTN","ORB3FUP1",91,0)
 I $G(ORENVIR)'="GUI" D 
"RTN","ORB3FUP1",92,0)
 .D MSG
"RTN","ORB3FUP1",93,0)
 .S ORDG=$$DG^ORQOR1("ALL")  ;get Display Group ien
"RTN","ORB3FUP1",94,0)
 .D EN^ORCB(ORPT,12,ORDG,.ORBLMDEL)
"RTN","ORB3FUP1",95,0)
 .K ^TMP("ORR",$J)
"RTN","ORB3FUP1",96,0)
 .Q:$G(ORBLMDEL)=1  ;if EN^ORCB rtns ORBLMDEL=1, alert was removed in LM
"RTN","ORB3FUP1",97,0)
 .D EN^ORQ1(ORPT_";DPT(",ORDG,12,"","","",0,0)
"RTN","ORB3FUP1",98,0)
 .S X="",X=$O(^TMP("ORR",$J,X)) Q:X=""  I +$G(^TMP("ORR",$J,X,"TOT"))<1 D
"RTN","ORB3FUP1",99,0)
 ..D DEL(.ORY,ORBXQAID)  ;if no more flagged orders found, delete alert
"RTN","ORB3FUP1",100,0)
 .K ^TMP("ORR",$J)
"RTN","ORB3FUP1",101,0)
 Q
"RTN","ORB3FUP1",102,0)
NEWORD ;new order(s) follow-up
"RTN","ORB3FUP1",103,0)
 K XQAKILL
"RTN","ORB3FUP1",104,0)
 N ORPT,ORDG,ORSDT,OREDT,ENT,X,ORBXQAID,ORY,ORBLMDEL
"RTN","ORB3FUP1",105,0)
 S ORSDT="",OREDT="",ENT="USR",ORBXQAID=XQAID
"RTN","ORB3FUP1",106,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP1",107,0)
 ;the FLG code for NEW orders since last reviewed orders in ORQ1 is '6'
"RTN","ORB3FUP1",108,0)
 I $G(ORENVIR)="GUI" D LIST^ORQOR1(.ORBY,ORPT,"ALL",6,"","")
"RTN","ORB3FUP1",109,0)
 I $G(ORENVIR)'="GUI" D 
"RTN","ORB3FUP1",110,0)
 .D MSG
"RTN","ORB3FUP1",111,0)
 .S ORDG=$$DG^ORQOR1("ALL")  ;get Display Group ien
"RTN","ORB3FUP1",112,0)
 .D EN^ORCB(ORPT,6,ORDG,.ORBLMDEL)
"RTN","ORB3FUP1",113,0)
 .Q:$G(ORBLMDEL)=1  ;if EN^ORCB rtns ORBLMDEL=1, alert was removed in LM
"RTN","ORB3FUP1",114,0)
 .D DEL(.ORY,ORBXQAID) ;delete the alert
"RTN","ORB3FUP1",115,0)
 Q
"RTN","ORB3FUP1",116,0)
DCORD ;DC order(s) follow-up
"RTN","ORB3FUP1",117,0)
 K XQAKILL
"RTN","ORB3FUP1",118,0)
 N ORPT,ORDG,ORSDT,OREDT,ENT,X,ORBXQAID,ORY,ORBLMDEL
"RTN","ORB3FUP1",119,0)
 S ORSDT="",OREDT="",ENT="USR",ORBXQAID=XQAID
"RTN","ORB3FUP1",120,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP1",121,0)
 ;the FLG code for DC orders is '3'
"RTN","ORB3FUP1",122,0)
 I $G(ORENVIR)="GUI" D LIST^ORQOR1(.ORBY,ORPT,"ALL",6,"","")
"RTN","ORB3FUP1",123,0)
 I $G(ORENVIR)'="GUI" D 
"RTN","ORB3FUP1",124,0)
 .D MSG
"RTN","ORB3FUP1",125,0)
 .S ORDG=$$DG^ORQOR1("ALL")  ;get Display Group ien
"RTN","ORB3FUP1",126,0)
 .D EN^ORCB(ORPT,6,ORDG,.ORBLMDEL)
"RTN","ORB3FUP1",127,0)
 .Q:$G(ORBLMDEL)=1  ;if EN^ORCB rtns ORBLMDEL=1, alert was removed in LM
"RTN","ORB3FUP1",128,0)
 .D DEL(.ORY,ORBXQAID) ;delete the alert
"RTN","ORB3FUP1",129,0)
 Q
"RTN","ORB3FUP1",130,0)
NUMORD ;detailed order display follow-up - return order number
"RTN","ORB3FUP1",131,0)
 K XQAKILL
"RTN","ORB3FUP1",132,0)
 N ORBXQAID,ORY S ORBXQAID=XQAID
"RTN","ORB3FUP1",133,0)
 S ORNUM=$P(XQADATA,"@")
"RTN","ORB3FUP1",134,0)
 I $G(ORENVIR)="GUI" D
"RTN","ORB3FUP1",135,0)
 .Q
"RTN","ORB3FUP1",136,0)
 I $G(ORENVIR)'="GUI" D
"RTN","ORB3FUP1",137,0)
 .D MSG
"RTN","ORB3FUP1",138,0)
 .D EN1^ORCB(+ORNUM,"NEW")  ;display order, allow new order then delete
"RTN","ORB3FUP1",139,0)
 .D DEL(.ORY,ORBXQAID)
"RTN","ORB3FUP1",140,0)
 Q
"RTN","ORB3FUP1",141,0)
ESORD ;order(s) requiring electronic signature follow-up
"RTN","ORB3FUP1",142,0)
 K XQAKILL
"RTN","ORB3FUP1",143,0)
 N ORPT,ORDG,ORBXQAID,ORY,ORX,ORZ,ORDERS,ORDNUM,ORQUIT,ORBLMDEL
"RTN","ORB3FUP1",144,0)
 S ORBXQAID=XQAID,ORDERS=0,ORQUIT=0
"RTN","ORB3FUP1",145,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP1",146,0)
 ;the FLG code for UNSIGNED orders in ORQ1 is '11'
"RTN","ORB3FUP1",147,0)
 I $G(ORENVIR)="GUI" D LIST^ORQOR1(.ORBY,ORPT,"ALL",11,"","")
"RTN","ORB3FUP1",148,0)
 I $G(ORENVIR)'="GUI" D 
"RTN","ORB3FUP1",149,0)
 .D MSG
"RTN","ORB3FUP1",150,0)
 .S ORDG=$$DG^ORQOR1("ALL")  ;get Display Group ien
"RTN","ORB3FUP1",151,0)
 .D EN^ORCB(ORPT,11,ORDG,.ORBLMDEL)
"RTN","ORB3FUP1",152,0)
 .K ^TMP("ORR",$J)  ;clean up array
"RTN","ORB3FUP1",153,0)
 .Q:$G(ORBLMDEL)=1  ;if EN^ORCB rtns ORBLMDEL=1, alert was removed in LM
"RTN","ORB3FUP1",154,0)
 .I $L($G(XQAID)) D  ;EN^ORCB may kill XQAID in its follow-up
"RTN","ORB3FUP1",155,0)
 ..;
"RTN","ORB3FUP1",156,0)
 ..;get unsigned orders - if none exist, delete alert then quit:
"RTN","ORB3FUP1",157,0)
 ..D EN^ORQ1(ORPT_";DPT(",ORDG,11,"","","",0,0)
"RTN","ORB3FUP1",158,0)
 ..S ORX="",ORX=$O(^TMP("ORR",$J,ORX)) Q:ORX=""  I +$G(^TMP("ORR",$J,ORX,"TOT"))<1 D DEL(.ORY,ORBXQAID) K ^TMP("ORR",$J) Q
"RTN","ORB3FUP1",159,0)
 ..;
"RTN","ORB3FUP1",160,0)
 ..;user does not have ORES key, delete user's alert:
"RTN","ORB3FUP1",161,0)
 ..I '$D(^XUSEC("ORES",DUZ)) S XQAKILL=1 D DEL(.ORY,ORBXQAID) K ^TMP("ORR",$J) Q
"RTN","ORB3FUP1",162,0)
 ..;
"RTN","ORB3FUP1",163,0)
 ..;if prov is NOT linked to pt via attending, primary, teams or PCMM:
"RTN","ORB3FUP1",164,0)
 ..I $$PPLINK^ORQPTQ1(DUZ,ORPT)=0 D
"RTN","ORB3FUP1",165,0)
 ...S ORX="" F  S ORX=$O(^TMP("ORR",$J,ORX)) Q:ORX=""!(ORDERS=1)  D
"RTN","ORB3FUP1",166,0)
 ....S ORZ="" F  S ORZ=$O(^TMP("ORR",$J,ORX,ORZ)) Q:ORZ=""!(ORDERS=1)  D
"RTN","ORB3FUP1",167,0)
 .....S ORDNUM=^TMP("ORR",$J,ORX,ORZ)
"RTN","ORB3FUP1",168,0)
 .....;quit if this unsigned order's last action was made by the user
"RTN","ORB3FUP1",169,0)
 .....I DUZ=+$$UNSIGNOR^ORQOR2(ORDNUM) S ORDERS=1
"RTN","ORB3FUP1",170,0)
 ...I ORDERS'=1 D  ;provider has no outstanding unsiged orders for pt
"RTN","ORB3FUP1",171,0)
 ....S XQAKILL=1 D DEL(.ORY,ORBXQAID) ;delete alert for this user
"RTN","ORB3FUP1",172,0)
 ..K ^TMP("ORR",$J)
"RTN","ORB3FUP1",173,0)
 Q
"RTN","ORB3FUP1",174,0)
UNFLAG(ORPT) ;order unflagged - delete alert if no more flagged orders
"RTN","ORB3FUP1",175,0)
 N ORDG,ORDOIT,ORQUIT,X,XQAID,XQAKILL,XQAUSER
"RTN","ORB3FUP1",176,0)
 S ORDOIT=1,ORQUIT=0
"RTN","ORB3FUP1",177,0)
 S ORDG=$$DG^ORQOR1("ALL")  ;get Display Group ien
"RTN","ORB3FUP1",178,0)
 K ^TMP("ORR",$J)
"RTN","ORB3FUP1",179,0)
 D EN^ORQ1(ORPT_";DPT(",ORDG,12,"","","",0,0)
"RTN","ORB3FUP1",180,0)
 ;========DELETE ALERT (FOR ALL USERS) IF NO FLAGGED ORDERS AT ALL=====
"RTN","ORB3FUP1",181,0)
 S X="",X=$O(^TMP("ORR",$J,X)) Q:X=""  I +$G(^TMP("ORR",$J,X,"TOT"))<1 D
"RTN","ORB3FUP1",182,0)
 .;if no more flagged orders found, delete alert:
"RTN","ORB3FUP1",183,0)
 .S XQAKILL=$$XQAKILL^ORB3F1(6)
"RTN","ORB3FUP1",184,0)
 .I $G(XQAKILL)="" S XQAKILL=1
"RTN","ORB3FUP1",185,0)
 .S XQAID="OR,"_ORPT_",6" D DELETEA^XQALERT K XQAID,XQAKILL S ORQUIT=1
"RTN","ORB3FUP1",186,0)
 Q:ORQUIT
"RTN","ORB3FUP1",187,0)
 ;========DELETE ALERT IF NO FLAGGED ORDERS LEFT RELATED TO THE USER THAT IS UNFLAGGING=====
"RTN","ORB3FUP1",188,0)
 S X="",X=$O(^TMP("ORR",$J,X)) Q:X=""  D
"RTN","ORB3FUP1",189,0)
 .N Y S Y="" F  S Y=$O(^TMP("ORR",$J,X,Y)) Q:'Y  D
"RTN","ORB3FUP1",190,0)
 ..N ORDER S ORDER=$G(^TMP("ORR",$J,X,Y))
"RTN","ORB3FUP1",191,0)
 ..I $$FLAGRULE^ORWORR1(+ORDER)=0 S ORDOIT=0 ; FOUND A FLAGGED ORDER THAT THE USER SHOULD GET
"RTN","ORB3FUP1",192,0)
 I ORDOIT D
"RTN","ORB3FUP1",193,0)
 .;if no more flagged orders found for this user, delete alert only for this user:
"RTN","ORB3FUP1",194,0)
 .S XQAKILL=1
"RTN","ORB3FUP1",195,0)
 .S XQAID="OR,"_ORPT_",6" D DELETEA^XQALERT K XQAID,XQAKILL
"RTN","ORB3FUP1",196,0)
 ;========DELETE ALERT IF NO FLAGGED ORDERS LEFT RELATED TO THE USER THAT WAS THE ALERTED PROVIDER OF THE CURRENT ORDER=====
"RTN","ORB3FUP1",197,0)
 S ORDOIT=1
"RTN","ORB3FUP1",198,0)
 ;get the alerted provider
"RTN","ORB3FUP1",199,0)
 I $G(ORIFN) D
"RTN","ORB3FUP1",200,0)
 .N ORD,ORACT S ORD=+$G(ORIFN),ORACT=$P($G(ORIFN),";",2)
"RTN","ORB3FUP1",201,0)
 .N ORUSR S ORUSR=$P($G(^OR(100,ORD,8,ORACT,3)),U,9)
"RTN","ORB3FUP1",202,0)
 .I ORUSR D
"RTN","ORB3FUP1",203,0)
 ..S X="",X=$O(^TMP("ORR",$J,X)) Q:X=""  D
"RTN","ORB3FUP1",204,0)
 ...N Y S Y="" F  S Y=$O(^TMP("ORR",$J,X,Y)) Q:'Y  D
"RTN","ORB3FUP1",205,0)
 ....N ORDER S ORDER=$G(^TMP("ORR",$J,X,Y))
"RTN","ORB3FUP1",206,0)
 ....I $$FLAGRULE^ORWORR1(+ORDER,ORUSR)=0 S ORDOIT=0 ; FOUND A FLAGGED ORDER THAT THE USER SHOULD GET
"RTN","ORB3FUP1",207,0)
 ..I ORDOIT D
"RTN","ORB3FUP1",208,0)
 ...;if no more flagged orders found for this user, delete alert only for this user:
"RTN","ORB3FUP1",209,0)
 ...S XQAKILL=1,XQAUSER=ORUSR
"RTN","ORB3FUP1",210,0)
 ...S XQAID="OR,"_ORPT_",6" D DELETEA^XQALERT K XQAID,XQAKILL,XQAUSER
"RTN","ORB3FUP1",211,0)
 K ^TMP("ORR",$J)
"RTN","ORB3FUP1",212,0)
 Q
"RTN","ORB3FUP2")
0^190^B68246237
"RTN","ORB3FUP2",1,0)
ORB3FUP2 ; slc/CLA - Routine to support notification follow-up actions ;6/28/00  12:00
"RTN","ORB3FUP2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**31,64,88,112,243**;Dec 17, 1997;Build 242
"RTN","ORB3FUP2",3,0)
RESULT ;STAT, orderer-flagged and site-flagged result follow-up
"RTN","ORB3FUP2",4,0)
 ;determine what pkg to get report/results from then do RPTLAB or RPTRAD
"RTN","ORB3FUP2",5,0)
 N ORBFILL S ORBFILL=$P($P(XQADATA,"|",2),"@",2)
"RTN","ORB3FUP2",6,0)
 I ORBFILL["LR" D RPTLAB
"RTN","ORB3FUP2",7,0)
 I ORBFILL["RA" D RPTRAD
"RTN","ORB3FUP2",8,0)
 I ORBFILL["GMRC" D RPTCON
"RTN","ORB3FUP2",9,0)
 Q
"RTN","ORB3FUP2",10,0)
CSPN ;co-sign progress note(s) follow-up
"RTN","ORB3FUP2",11,0)
 K XQAKILL
"RTN","ORB3FUP2",12,0)
 N ORPT,ORBXQAID,ORY S ORBXQAID=XQAID
"RTN","ORB3FUP2",13,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP2",14,0)
 I $G(ORENVIR)="GUI" ;entry pt to get notes req co-sign then quit
"RTN","ORB3FUP2",15,0)
 ;joel rtn to display notes req co-signature and allow co-sign on vt
"RTN","ORB3FUP2",16,0)
 ;if lm fup action completed D DEL^ORB3FUP1(.ORY,ORBXQAID)
"RTN","ORB3FUP2",17,0)
 Q
"RTN","ORB3FUP2",18,0)
USPN ;unsigned progress note(s) follow-up
"RTN","ORB3FUP2",19,0)
 K XQAKILL
"RTN","ORB3FUP2",20,0)
 N ORPT,ORBXQAID,ORY S ORBXQAID=XQAID
"RTN","ORB3FUP2",21,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP2",22,0)
 I $G(ORENVIR)="GUI" ;entry pt to get unsigned notes then quit
"RTN","ORB3FUP2",23,0)
 ;joel rtn to display notes req signature and allow signature on vt
"RTN","ORB3FUP2",24,0)
 ;if lm fup action completed D DEL^ORB3FUP1(.ORY,ORBXQAID)
"RTN","ORB3FUP2",25,0)
 Q
"RTN","ORB3FUP2",26,0)
EXMED ;expiring med(s) follow-up
"RTN","ORB3FUP2",27,0)
 K XQAKILL
"RTN","ORB3FUP2",28,0)
 N ORPT,ORDG,ORBXQAID,ORY,ORBLMDEL
"RTN","ORB3FUP2",29,0)
 S ORBXQAID=XQAID
"RTN","ORB3FUP2",30,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP2",31,0)
 ;the FLG code for EXPIRING orders in ORQ1 is '5'
"RTN","ORB3FUP2",32,0)
 I $G(ORENVIR)="GUI" D LIST^ORQOR1(.ORBY,ORPT,"RX",5,"","")
"RTN","ORB3FUP2",33,0)
 I $G(ORENVIR)'="GUI" D
"RTN","ORB3FUP2",34,0)
 .D MSG^ORB3FUP1
"RTN","ORB3FUP2",35,0)
 .S ORDG=$$DG^ORQOR1("RX")  ;get Display Group ien
"RTN","ORB3FUP2",36,0)
 .D EN^ORCB(ORPT,5,ORDG,.ORBLMDEL)
"RTN","ORB3FUP2",37,0)
 .K ^TMP("ORR",$J)
"RTN","ORB3FUP2",38,0)
 .Q:$G(ORBLMDEL)=1  ;if EN^ORCB rtns ORBLMDEL=1, alert was removed in LM
"RTN","ORB3FUP2",39,0)
 .D EN^ORQ1(ORPT_";DPT(",ORDG,5,"","","",0,0)
"RTN","ORB3FUP2",40,0)
 .S X="",X=$O(^TMP("ORR",$J,X)) Q:X=""  I +$G(^TMP("ORR",$J,X,"TOT"))<1 D
"RTN","ORB3FUP2",41,0)
 ..D DEL^ORB3FUP1(.ORY,ORBXQAID)  ;if no more EXPIRING orders found, delete the alert
"RTN","ORB3FUP2",42,0)
 .K X,^TMP("ORR",$J)
"RTN","ORB3FUP2",43,0)
 Q
"RTN","ORB3FUP2",44,0)
UVMED ;unverified med(s) follow-up
"RTN","ORB3FUP2",45,0)
 K XQAKILL
"RTN","ORB3FUP2",46,0)
 N ORPT,ORDG,ORBXQAID,ORY,ORBLMDEL,ORADT
"RTN","ORB3FUP2",47,0)
 S ORBXQAID=XQAID
"RTN","ORB3FUP2",48,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP2",49,0)
 ;the FLG code for UNVERIFIED (NURSE) orders in ORQ1 is '9'
"RTN","ORB3FUP2",50,0)
 I $G(ORENVIR)="GUI" D LIST^ORQOR1(.ORBY,ORPT,"RX",9,"","")
"RTN","ORB3FUP2",51,0)
 I $G(ORENVIR)'="GUI" D
"RTN","ORB3FUP2",52,0)
 .D MSG^ORB3FUP1
"RTN","ORB3FUP2",53,0)
 .S ORDG=$$DG^ORQOR1("RX")  ;get Display Group ien
"RTN","ORB3FUP2",54,0)
 .D EN^ORCB(ORPT,9,ORDG,.ORBLMDEL)
"RTN","ORB3FUP2",55,0)
 .K ^TMP("ORR",$J)
"RTN","ORB3FUP2",56,0)
 .Q:$G(ORBLMDEL)=1  ;if EN^ORCB rtns ORBLMDEL=1, alert was removed in LM
"RTN","ORB3FUP2",57,0)
 .;
"RTN","ORB3FUP2",58,0)
 .;if user doesn't have ORELSE or ORMAS keys (can't verify),
"RTN","ORB3FUP2",59,0)
 .;   delete user's alert after display:
"RTN","ORB3FUP2",60,0)
 .I '$D(^XUSEC("ORELSE",DUZ)),('$D(^XUSEC("OREMAS",DUZ))) S XQAKILL=1 D DEL^ORB3FUP1(.ORY,ORBXQAID) Q
"RTN","ORB3FUP2",61,0)
 .;
"RTN","ORB3FUP2",62,0)
 .;get current admission date/time:
"RTN","ORB3FUP2",63,0)
 .N DFN S DFN=ORPT,VA200="" D INP^VADPT
"RTN","ORB3FUP2",64,0)
 .S ORADT=$P($G(VAIN(7)),U)
"RTN","ORB3FUP2",65,0)
 .S ORADT=$S('$L($G(ORADT)):$$FMADD^XLFDT($$NOW^XLFDT,"-30"),1:ORADT)
"RTN","ORB3FUP2",66,0)
 .;
"RTN","ORB3FUP2",67,0)
 .;if no more UNVERIFIED MED orders found (within current admission or
"RTN","ORB3FUP2",68,0)
 .; past 30 days), delete the alert:
"RTN","ORB3FUP2",69,0)
 .D EN^ORQ1(ORPT_";DPT(",ORDG,9,"",ORADT,$$NOW^XLFDT,0,0)
"RTN","ORB3FUP2",70,0)
 .S X="",X=$O(^TMP("ORR",$J,X)) Q:X=""  I +$G(^TMP("ORR",$J,X,"TOT"))<1 D
"RTN","ORB3FUP2",71,0)
 ..D DEL^ORB3FUP1(.ORY,ORBXQAID)
"RTN","ORB3FUP2",72,0)
 .K X,^TMP("ORR",$J),VA200,VAIN
"RTN","ORB3FUP2",73,0)
 Q
"RTN","ORB3FUP2",74,0)
UNVER ;unverified order(s) follow-up
"RTN","ORB3FUP2",75,0)
 K XQAKILL
"RTN","ORB3FUP2",76,0)
 N ORPT,ORDG,ORBXQAID,ORY,ORBLMDEL,ORADT
"RTN","ORB3FUP2",77,0)
 S ORBXQAID=XQAID
"RTN","ORB3FUP2",78,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP2",79,0)
 ;the FLG code for UNVERIFIED (NURSE) orders in ORQ1 is '9'
"RTN","ORB3FUP2",80,0)
 I $G(ORENVIR)="GUI" D LIST^ORQOR1(.ORBY,ORPT,"ALL",9,"","")
"RTN","ORB3FUP2",81,0)
 I $G(ORENVIR)'="GUI" D
"RTN","ORB3FUP2",82,0)
 .D MSG^ORB3FUP1
"RTN","ORB3FUP2",83,0)
 .S ORDG=$$DG^ORQOR1("ALL")  ;get Display Group ien
"RTN","ORB3FUP2",84,0)
 .D EN^ORCB(ORPT,9,ORDG,.ORBLMDEL)
"RTN","ORB3FUP2",85,0)
 .K ^TMP("ORR",$J)
"RTN","ORB3FUP2",86,0)
 .Q:$G(ORBLMDEL)=1  ;if EN^ORCB rtns ORBLMDEL=1, alert was removed in LM
"RTN","ORB3FUP2",87,0)
 .;
"RTN","ORB3FUP2",88,0)
 .;if user doesn't have ORELSE or ORMAS keys (can't verify),
"RTN","ORB3FUP2",89,0)
 .;   delete user's alert after display:
"RTN","ORB3FUP2",90,0)
 .I '$D(^XUSEC("ORELSE",DUZ)),('$D(^XUSEC("OREMAS",DUZ))) S XQAKILL=1 D DEL^ORB3FUP1(.ORY,ORBXQAID) Q
"RTN","ORB3FUP2",91,0)
 .;
"RTN","ORB3FUP2",92,0)
 .;get current admission date/time:
"RTN","ORB3FUP2",93,0)
 .N DFN S DFN=ORPT,VA200="" D INP^VADPT
"RTN","ORB3FUP2",94,0)
 .S ORADT=$P($G(VAIN(7)),U)
"RTN","ORB3FUP2",95,0)
 .S ORADT=$S('$L($G(ORADT)):$$FMADD^XLFDT($$NOW^XLFDT,"-30"),1:ORADT)
"RTN","ORB3FUP2",96,0)
 .;
"RTN","ORB3FUP2",97,0)
 .;if no more UNVERIFIED orders found (within current admission or past
"RTN","ORB3FUP2",98,0)
 .; 30 days), delete the alert:
"RTN","ORB3FUP2",99,0)
 .D EN^ORQ1(ORPT_";DPT(",ORDG,9,"",ORADT,$$NOW^XLFDT,0,0)
"RTN","ORB3FUP2",100,0)
 .S X="",X=$O(^TMP("ORR",$J,X)) Q:X=""  I +$G(^TMP("ORR",$J,X,"TOT"))<1 D
"RTN","ORB3FUP2",101,0)
 ..D DEL^ORB3FUP1(.ORY,ORBXQAID)
"RTN","ORB3FUP2",102,0)
 .K X,^TMP("ORR",$J),VA200,VAIN
"RTN","ORB3FUP2",103,0)
 Q
"RTN","ORB3FUP2",104,0)
NEWCON ;new consult/request follow-up
"RTN","ORB3FUP2",105,0)
 K XQAKILL
"RTN","ORB3FUP2",106,0)
 N ORPT,ORBXQAID,ORY S ORBXQAID=XQAID
"RTN","ORB3FUP2",107,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP2",108,0)
 ;I $G(ORENVIR)="GUI" D  ;comment out until GUI follow-up
"RTN","ORB3FUP2",109,0)
 ;.entry pt to get new consults then quit
"RTN","ORB3FUP2",110,0)
 I $G(ORENVIR)'="GUI" D
"RTN","ORB3FUP2",111,0)
 .D MSG^ORB3FUP1
"RTN","ORB3FUP2",112,0)
 .D EN^GMRCALRT(XQADATA,XQAID) ;display new c/r and allow action
"RTN","ORB3FUP2",113,0)
 .;D DEL^ORB3FUP1(.ORY,ORBXQAID) ;Dwight does the delete in GMRC
"RTN","ORB3FUP2",114,0)
 Q
"RTN","ORB3FUP2",115,0)
UPCON ;updated consult/request follow-up
"RTN","ORB3FUP2",116,0)
 K XQAKILL
"RTN","ORB3FUP2",117,0)
 N ORPT,ORBXQAID,ORY S ORBXQAID=XQAID
"RTN","ORB3FUP2",118,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP2",119,0)
 I $G(ORENVIR)'="GUI" D
"RTN","ORB3FUP2",120,0)
 .D MSG^ORB3FUP1
"RTN","ORB3FUP2",121,0)
 .D EN^GMRCALRT(XQADATA,XQAID) ;display updated c/r and allow action
"RTN","ORB3FUP2",122,0)
 Q
"RTN","ORB3FUP2",123,0)
DCCON ;cancelled, held or DCed consult/request follow-up
"RTN","ORB3FUP2",124,0)
 K XQAKILL
"RTN","ORB3FUP2",125,0)
 N ORPT,NXQADATA
"RTN","ORB3FUP2",126,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP2",127,0)
 ;I $G(ORENVIR)="GUI" D  ;comment out until GUI follow-up
"RTN","ORB3FUP2",128,0)
 ;.entry pt to get new consults then quit
"RTN","ORB3FUP2",129,0)
 I $G(ORENVIR)'="GUI" D
"RTN","ORB3FUP2",130,0)
 .D MSG^ORB3FUP1
"RTN","ORB3FUP2",131,0)
 .I XQADATA["GMRC" S NXQADATA=$P($P(XQADATA,"|",2),"@") D EN^GMRCEDIT(NXQADATA,XQAID)
"RTN","ORB3FUP2",132,0)
 .I +$G(NXQADATA)<1 D EN^GMRCEDIT(XQADATA,XQAID)
"RTN","ORB3FUP2",133,0)
 Q
"RTN","ORB3FUP2",134,0)
RPTCON ;consult result follow-up
"RTN","ORB3FUP2",135,0)
 K XQAKILL
"RTN","ORB3FUP2",136,0)
 N NXQADATA
"RTN","ORB3FUP2",137,0)
 ;N ORPT,ORBXQAID,ORY S ORBXQAID=XQAID
"RTN","ORB3FUP2",138,0)
 ;S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP2",139,0)
 I $G(ORENVIR)="GUI" D DETAIL^ORQQCN(.ORBY,XQADATA)
"RTN","ORB3FUP2",140,0)
 I $G(ORENVIR)'="GUI" D
"RTN","ORB3FUP2",141,0)
 .D MSG^ORB3FUP1
"RTN","ORB3FUP2",142,0)
 .D EN^GMRCALRT(XQADATA,XQAID)
"RTN","ORB3FUP2",143,0)
 .;I XQADATA["GMRC" S NXQADATA=$P($P(XQADATA,"|",2),"@") D EN^GMRCALRT(NXQADATA,XQAID)
"RTN","ORB3FUP2",144,0)
 .;I +$G(NXQADATA)<1 D EN^GMRCALRT(XQADATA,XQAID)
"RTN","ORB3FUP2",145,0)
 .;D DEL^ORB3FUP1(.ORY,ORBXQAID) ;Dwight does the delete in GMRC
"RTN","ORB3FUP2",146,0)
 Q
"RTN","ORB3FUP2",147,0)
RPTAP ; AP lab result follow-up
"RTN","ORB3FUP2",148,0)
 K XQAKILL
"RTN","ORB3FUP2",149,0)
 N ORPT,ORBXQAID,ORY S ORBXQAID=XQAID
"RTN","ORB3FUP2",150,0)
 S ORPT=$P($P(ORBXQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP2",151,0)
 N ORACCNUM,ORDTSTKN S ORACCNUM=$P(XQADATA,U,2),ORDTSTKN=$P(XQADATA,U,3)
"RTN","ORB3FUP2",152,0)
 I $G(ORENVIR)'="GUI" D
"RTN","ORB3FUP2",153,0)
 .D MSG^ORB3FUP1
"RTN","ORB3FUP2",154,0)
 .D EN1^ORCXPND(ORPT,ORACCNUM_"-"_ORDTSTKN,"LABS")
"RTN","ORB3FUP2",155,0)
 .D DEL^ORB3FUP1(.ORY,ORBXQAID)
"RTN","ORB3FUP2",156,0)
 Q
"RTN","ORB3FUP2",157,0)
RPTLAB ;lab result follow-up
"RTN","ORB3FUP2",158,0)
 K XQAKILL
"RTN","ORB3FUP2",159,0)
 N ORPT,ORBXQAID,ORY S ORBXQAID=XQAID
"RTN","ORB3FUP2",160,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP2",161,0)
 N ORDER,ORLAB S ORDER=$P(XQADATA,"@")
"RTN","ORB3FUP2",162,0)
 I $G(ORENVIR)="GUI" D DETAIL^ORQQLR(.ORBY,ORPT,ORDER)
"RTN","ORB3FUP2",163,0)
 I $G(ORENVIR)'="GUI" D
"RTN","ORB3FUP2",164,0)
 .D MSG^ORB3FUP1
"RTN","ORB3FUP2",165,0)
 .;S ORLAB=$$OETOLAB^ORQQLR1(ORDER)
"RTN","ORB3FUP2",166,0)
 .;Q:'$L($G(ORLAB))
"RTN","ORB3FUP2",167,0)
 .;D EN1^ORCXPND(ORPT,ORLAB,"LABS")  ;api used lab # pre-6/97
"RTN","ORB3FUP2",168,0)
 .D EN1^ORCXPND(ORPT,ORDER,"LABS")
"RTN","ORB3FUP2",169,0)
 .D DEL^ORB3FUP1(.ORY,ORBXQAID)
"RTN","ORB3FUP2",170,0)
 Q
"RTN","ORB3FUP2",171,0)
RPTRAD ;radiology result follow-up for HL7-triggered notifications
"RTN","ORB3FUP2",172,0)
 K XQAKILL
"RTN","ORB3FUP2",173,0)
 N ORPT,ORBXQAID,ORY S ORBXQAID=XQAID
"RTN","ORB3FUP2",174,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP2",175,0)
 N INVDT,CASE S INVDT="",CASE=""
"RTN","ORB3FUP2",176,0)
 ;XQADATA is different for HL7-triggered vs. radiology pkg triggered
"RTN","ORB3FUP2",177,0)
 S INVDT=$P(XQADATA,"~",2),CASE=$P($P(XQADATA,"~",3),"@")
"RTN","ORB3FUP2",178,0)
 I $G(ORENVIR)="GUI" D DETAIL^ORQQRA(.ORBY,ORPT,INVDT,CASE)
"RTN","ORB3FUP2",179,0)
 I $G(ORENVIR)'="GUI" D
"RTN","ORB3FUP2",180,0)
 .D MSG^ORB3FUP1
"RTN","ORB3FUP2",181,0)
 .D EN1^ORCXPND(ORPT,INVDT_"-"_CASE,"XRAYS")
"RTN","ORB3FUP2",182,0)
 .D DEL^ORB3FUP1(.ORY,ORBXQAID)
"RTN","ORB3FUP2",183,0)
 Q
"RTN","ORB3FUP2",184,0)
RPTRAD2 ;radiology result follow-up for radiology pkg-triggered notifications
"RTN","ORB3FUP2",185,0)
 K XQAKILL
"RTN","ORB3FUP2",186,0)
 N ORPT,ORBXQAID,ORY S ORBXQAID=XQAID
"RTN","ORB3FUP2",187,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP2",188,0)
 N INVDT,CASE S INVDT="",CASE=""
"RTN","ORB3FUP2",189,0)
 ;XQADATA is different for HL7-triggered vs. radiology pkg triggered
"RTN","ORB3FUP2",190,0)
 S INVDT=$P(XQADATA,"~",1),CASE=$P(XQADATA,"~",2)
"RTN","ORB3FUP2",191,0)
 I $G(ORENVIR)="GUI" D DETAIL^ORQQRA(.ORBY,ORPT,INVDT,CASE)
"RTN","ORB3FUP2",192,0)
 I $G(ORENVIR)'="GUI" D
"RTN","ORB3FUP2",193,0)
 .D MSG^ORB3FUP1
"RTN","ORB3FUP2",194,0)
 .D EN1^ORCXPND(ORPT,INVDT_"-"_CASE,"XRAYS")
"RTN","ORB3FUP2",195,0)
 .D DEL^ORB3FUP1(.ORY,ORBXQAID)
"RTN","ORB3FUP2",196,0)
 Q
"RTN","ORB3FUP2",197,0)
EXOI ;expiring flagged orderable items follow-up
"RTN","ORB3FUP2",198,0)
 K XQAKILL
"RTN","ORB3FUP2",199,0)
 N ORPT,ORDG,ORBXQAID,ORY,ORBLMDEL
"RTN","ORB3FUP2",200,0)
 S ORBXQAID=XQAID
"RTN","ORB3FUP2",201,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP2",202,0)
 ;the FLG code for EXPIRING orders in ORQ1 is '5'
"RTN","ORB3FUP2",203,0)
 I $G(ORENVIR)="GUI" D LIST^ORQOR1(.ORBY,ORPT,"ALL",5,"","")
"RTN","ORB3FUP2",204,0)
 I $G(ORENVIR)'="GUI" D
"RTN","ORB3FUP2",205,0)
 .D MSG^ORB3FUP1
"RTN","ORB3FUP2",206,0)
 .S ORDG=$$DG^ORQOR1("ALL")  ;get Display Group ien
"RTN","ORB3FUP2",207,0)
 .D EN^ORCB(ORPT,5,ORDG,.ORBLMDEL)
"RTN","ORB3FUP2",208,0)
 .K ^TMP("ORR",$J)
"RTN","ORB3FUP2",209,0)
 .Q:$G(ORBLMDEL)=1  ;if EN^ORCB rtns ORBLMDEL=1, alert was removed in LM
"RTN","ORB3FUP2",210,0)
 .D EN^ORQ1(ORPT_";DPT(",ORDG,5,"","","",0,0)
"RTN","ORB3FUP2",211,0)
 .S X="",X=$O(^TMP("ORR",$J,X)) Q:X=""  I +$G(^TMP("ORR",$J,X,"TOT"))<1 D
"RTN","ORB3FUP2",212,0)
 ..D DEL^ORB3FUP1(.ORY,ORBXQAID)  ;if no more EXPIRING orders found, delete the alert
"RTN","ORB3FUP2",213,0)
 .K X,^TMP("ORR",$J)
"RTN","ORB3FUP2",214,0)
 Q
"RTN","ORB3FUP2",215,0)
INTCON ;consult interpretation follow-up
"RTN","ORB3FUP2",216,0)
 K XQAKILL
"RTN","ORB3FUP2",217,0)
 N NXQADATA
"RTN","ORB3FUP2",218,0)
 I $G(ORENVIR)'="GUI" D
"RTN","ORB3FUP2",219,0)
 .D MSG^ORB3FUP1
"RTN","ORB3FUP2",220,0)
 .R !!?5,"This alert must be processed in the CPRS GUI.",X:10
"RTN","ORB3FUP2",221,0)
 .K X
"RTN","ORB3FUP2",222,0)
 Q
"RTN","ORB3FUP2",223,0)
CHGRAD ;radiology follow-up for #67 Imaging Request Changed
"RTN","ORB3FUP2",224,0)
 K XQAKILL
"RTN","ORB3FUP2",225,0)
 N ORPT,ORBXQAID,ORY S ORBXQAID=XQAID
"RTN","ORB3FUP2",226,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP2",227,0)
 I $G(ORENVIR)'="GUI" D
"RTN","ORB3FUP2",228,0)
 .D MSG^ORB3FUP1
"RTN","ORB3FUP2",229,0)
 .I $L($T(EN1^RAO7PC4))>0 D
"RTN","ORB3FUP2",230,0)
 ..D EN1^RAO7PC4  ;display before and after change(s)
"RTN","ORB3FUP2",231,0)
 ..D DEL^ORB3FUP1(.ORY,ORBXQAID)
"RTN","ORB3FUP2",232,0)
 Q
"RTN","ORB3FUP2",233,0)
INFODEL ;follow-up action to delete "informational" alerts
"RTN","ORB3FUP2",234,0)
 K XQAKILL
"RTN","ORB3FUP2",235,0)
 N ORY,ORBXQAID
"RTN","ORB3FUP2",236,0)
 S ORBXQAID=XQAID
"RTN","ORB3FUP2",237,0)
 D MSG^ORB3FUP1
"RTN","ORB3FUP2",238,0)
 D DEL^ORB3FUP1(.ORY,ORBXQAID)
"RTN","ORB3FUP2",239,0)
 Q
"RTN","ORB3LAB")
0^191^B3813832
"RTN","ORB3LAB",1,0)
ORB3LAB ; slc/CLA/TC - Routine to trigger Lab-related notifications ;10/14/03
"RTN","ORB3LAB",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**210,243**;Dec 17, 1997;Build 242
"RTN","ORB3LAB",3,0)
 ;
"RTN","ORB3LAB",4,0)
LAB(ORDFN,ORLRDFN,ORLRI,ORLRA,ORLRSS,ORXQA) ;trigger Lab Anatomic Path notifs
"RTN","ORB3LAB",5,0)
 ; called by SEND^LRAPRES1 (DBIA #4287)
"RTN","ORB3LAB",6,0)
 ;
"RTN","ORB3LAB",7,0)
 N ORBMSG,ORAPMD,ORBADUZ,ORSRPT,ORACCNO
"RTN","ORB3LAB",8,0)
 I '$D(ORXQA) D
"RTN","ORB3LAB",9,0)
 . S ORAPMD=$S(ORLRSS="AU":$P(ORLRA,U,12),1:$P(ORLRA,U,7))  ;provider/physician "ordering" the ap test
"RTN","ORB3LAB",10,0)
 . I $L(ORAPMD) S ORBADUZ(ORAPMD)=""
"RTN","ORB3LAB",11,0)
 I $D(ORXQA) M ORBADUZ=ORXQA
"RTN","ORB3LAB",12,0)
 S ORSRPT=$S($D(^LR(ORLRDFN,84,0))!($D(^LR(ORLRDFN,ORLRSS,ORLRI,1.2,0))):" supplmntl rpt",1:"") ; AP supplmntl rpt - DBIA #5157
"RTN","ORB3LAB",13,0)
 S ORBMSG=$S(ORLRSS="AU":"Autopsy",ORLRSS="CY":"Cytology",ORLRSS="SP":"Surgical Pathology",ORLRSS="EM":"Electron Microscopy",1:"Anatomic Pathology")
"RTN","ORB3LAB",14,0)
 S ORBMSG=ORBMSG_ORSRPT_" results available."
"RTN","ORB3LAB",15,0)
 S ORACCNO=$P(ORLRA,U,6)  ;accession # of lab section
"RTN","ORB3LAB",16,0)
 D EN^ORB3(71,ORDFN,"",.ORBADUZ,ORBMSG,ORLRSS_U_ORACCNO_U_ORLRI)  ;XQADATA="Lab section^Accession#^DT specimen taken (inverse format)"
"RTN","ORB3LAB",17,0)
 Q
"RTN","ORBCMA1")
0^11^B16067541
"RTN","ORBCMA1",1,0)
ORBCMA1 ; SLC/JLI - Pharmacy Calls for Windows Dialog [ 3/7/2006 ]
"RTN","ORBCMA1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**133,243**;Dec 17, 1997;Build 242
"RTN","ORBCMA1",3,0)
 ;;OR BCMA ORDER COM V1.0 ;**133**; Jan 19, 2002
"RTN","ORBCMA1",4,0)
 ;
"RTN","ORBCMA1",5,0)
ODSLCT(LST,PSTYPE,DFN,LOC) ; return default lists for dialog
"RTN","ORBCMA1",6,0)
 ; PSTYPE: pharmacy type (U=unit dose, F=IV fluids, O=outpatient)
"RTN","ORBCMA1",7,0)
 N ILST S ILST=0
"RTN","ORBCMA1",8,0)
 S ILST=ILST+1,LST(ILST)="~Priority" D PRIOR
"RTN","ORBCMA1",9,0)
 S ILST=ILST+1,LST(ILST)="~DispMsg"
"RTN","ORBCMA1",10,0)
 S ILST=ILST+1,LST(ILST)="d"_$$DISPMSG
"RTN","ORBCMA1",11,0)
 ;
"RTN","ORBCMA1",12,0)
 ; I PSTYPE="F" D  Q                           ; IV Fluids
"RTN","ORBCMA1",13,0)
 ; . S ILST=ILST+1,LST(ILST)="~ShortList" D SHORT
"RTN","ORBCMA1",14,0)
 ;
"RTN","ORBCMA1",15,0)
 I PSTYPE="O" D                                ; Outpatient
"RTN","ORBCMA1",16,0)
 . S ILST=ILST+1,LST(ILST)="~Refills"
"RTN","ORBCMA1",17,0)
 . S ILST=ILST+1,LST(ILST)="d0^0"
"RTN","ORBCMA1",18,0)
 . S ILST=ILST+1,LST(ILST)="~Pickup"
"RTN","ORBCMA1",19,0)
 . S ILST=ILST+1,LST(ILST)="d"_$$DEFPICK($G(LOC))
"RTN","ORBCMA1",20,0)
 . ; S ILST=ILST+1,LST(ILST)="~Supply"
"RTN","ORBCMA1",21,0)
 . ; S ILST=ILST+1,LST(ILST)="d^"_$$DEFSPLY(DFN)
"RTN","ORBCMA1",22,0)
 Q
"RTN","ORBCMA1",23,0)
PRIOR ; from DLGSLCT, get list of allowed priorities
"RTN","ORBCMA1",24,0)
 N X,XREF
"RTN","ORBCMA1",25,0)
 S X=0
"RTN","ORBCMA1",26,0)
 S X=$O(^ORD(101.42,"B","DONE",X))
"RTN","ORBCMA1",27,0)
 S ILST=ILST+1,LST(ILST)="d"_X_U_$P(^ORD(101.42,X,0),U,2)
"RTN","ORBCMA1",28,0)
 Q
"RTN","ORBCMA1",29,0)
DEFPICK(LOC)       ; return default routing
"RTN","ORBCMA1",30,0)
 N X,DLG,PRMT
"RTN","ORBCMA1",31,0)
 S DLG=$O(^ORD(101.41,"AB","PSO OERR",0)),X=""
"RTN","ORBCMA1",32,0)
 S PRMT=$O(^ORD(101.41,"AB","OR GTX ROUTING",0))
"RTN","ORBCMA1",33,0)
 I $D(^TMP("ORECALL",$J,+DLG,+PRMT,1)) S X=^(1)
"RTN","ORBCMA1",34,0)
 I X'="" S EDITONLY=1 Q X  ; EDITONLY used by default action
"RTN","ORBCMA1",35,0)
 ;
"RTN","ORBCMA1",36,0)
 S X=$$GET^XPAR("ALL^"_"LOC.`"_LOC,"ORWDPS ROUTING DEFAULT",1,"I")
"RTN","ORBCMA1",37,0)
 I X="C" S X="C^in Clinic" G XPICK
"RTN","ORBCMA1",38,0)
 I X="M" S X="M^by Mail"   G XPICK
"RTN","ORBCMA1",39,0)
 I X="W" S X="W^at Window" G XPICK
"RTN","ORBCMA1",40,0)
 I X="N" S X=""            G XPICK
"RTN","ORBCMA1",41,0)
 I X=""  S X=$S($D(^PSX(550,"C")):"M^by Mail",1:"W^at Window")
"RTN","ORBCMA1",42,0)
XPICK Q X
"RTN","ORBCMA1",43,0)
 ;
"RTN","ORBCMA1",44,0)
DEFSPLY(DFN)    ; return default days supply for this patient
"RTN","ORBCMA1",45,0)
 N ORWX
"RTN","ORBCMA1",46,0)
 S ORWX("PATIENT")=DFN
"RTN","ORBCMA1",47,0)
 D DSUP^PSOSIGDS(.ORWX)
"RTN","ORBCMA1",48,0)
 Q $G(ORWX("DAYS SUPPLY"))
"RTN","ORBCMA1",49,0)
 ;
"RTN","ORBCMA1",50,0)
DFLTSPLY(VAL,UPD,SCH,PAT,DRG)        ; return days supply given quantity
"RTN","ORBCMA1",51,0)
 ; VAL: default days supply
"RTN","ORBCMA1",52,0)
 N ORWX,I
"RTN","ORBCMA1",53,0)
 S ORWX("PATIENT")=PAT
"RTN","ORBCMA1",54,0)
 I DRG S ORWX("DRUG")=DRG
"RTN","ORBCMA1",55,0)
 F I=1:1:$L(UPD,U)-1 D
"RTN","ORBCMA1",56,0)
 . S ORWX("DOSE ORDERED",I)=$P(UPD,U,I)
"RTN","ORBCMA1",57,0)
 . S ORWX("SCHEDULE",I)=$P(SCH,U,I)
"RTN","ORBCMA1",58,0)
 D DSUP^PSOSIGDS(.ORWX)
"RTN","ORBCMA1",59,0)
 S VAL=$G(ORWX("DAYS SUPPLY"))
"RTN","ORBCMA1",60,0)
 Q
"RTN","ORBCMA1",61,0)
DISPMSG()       ; return 1 to suppress dispense message
"RTN","ORBCMA1",62,0)
 Q +$$GET^XPAR("ALL","ORWDPS SUPPRESS DISPENSE MSG",1,"I")
"RTN","ORBCMA1",63,0)
 ;
"RTN","ORBCMA1",64,0)
SCHALL(LST) ; return all schedules
"RTN","ORBCMA1",65,0)
 N ILST,SCH,IEN,EXP,TYP,X0
"RTN","ORBCMA1",66,0)
 K ^TMP($J,"ORBCMA1 SCHALL")
"RTN","ORBCMA1",67,0)
 D AP^PSS51P1("PSJ",,,,"ORBCMA1 SCHALL")
"RTN","ORBCMA1",68,0)
 S ILST=0,SCH=""
"RTN","ORBCMA1",69,0)
 F  S SCH=$O(^TMP($J,"ORBCMA1 SCHALL","APPSJ",SCH)) Q:SCH=""  D
"RTN","ORBCMA1",70,0)
 . I (SCH="STAT")!(SCH="NOW") D
"RTN","ORBCMA1",71,0)
 .. S IEN=$O(^TMP($J,"ORBCMA1 SCHALL","APPSJ",SCH,""))
"RTN","ORBCMA1",72,0)
 .. S EXP=$G(^TMP($J,"ORBCMA1 SCHALL",SCH,8))
"RTN","ORBCMA1",73,0)
 .. S TYP=$P($G(^TMP($J,"ORBCMA1 SCHALL",SCH,5)),U)
"RTN","ORBCMA1",74,0)
 .. S ILST=ILST+1,LST(ILST)=SCH_U_EXP_U_TYP
"RTN","ORBCMA1",75,0)
 K ^TMP($J,"ORBCMA1 SCHALL")
"RTN","ORBCMA1",76,0)
 Q
"RTN","ORBCMA1",77,0)
FORMALT(ORLST,IEN,PSTYPE) ; return a list of formulary alternatives
"RTN","ORBCMA1",78,0)
 N PSID,I
"RTN","ORBCMA1",79,0)
 S IEN=+$P(^ORD(101.43,IEN,0),U,2)
"RTN","ORBCMA1",80,0)
 D EN1^PSSUTIL1(.IEN,PSTYPE)
"RTN","ORBCMA1",81,0)
 S PSID=0,I=0
"RTN","ORBCMA1",82,0)
 F  S PSID=$O(IEN(PSID)) Q:'PSID  D
"RTN","ORBCMA1",83,0)
 . S OI=+$O(^ORD(101.43,"ID",PSID_";99PSP",0))
"RTN","ORBCMA1",84,0)
 . I OI S I=I+1,ORLST(I)=OI,$P(ORLST(I),U,2)=$P(^ORD(101.43,OI,0),U)
"RTN","ORBCMA1",85,0)
 Q
"RTN","ORBCMA1",86,0)
DOSEALT(LST,DDRUG,CUROI,PSTYPE) ; return a list of formulary alternatives for dose
"RTN","ORBCMA1",87,0)
 N I,OI,ORWLST,ILST S ILST=0
"RTN","ORBCMA1",88,0)
 D ENRFA^PSJORUTL(DDRUG,PSTYPE,.ORWLST)
"RTN","ORBCMA1",89,0)
 S I=0 F  S I=$O(ORWLST(I)) Q:'I  D
"RTN","ORBCMA1",90,0)
 . S OI=+$O(^ORD(101.43,"ID",+$P(ORWLST(I),U,4)_";99PSP",0))
"RTN","ORBCMA1",91,0)
 . I OI,OI'=CUROI S ILST=ILST+1,LST(ILST)=OI_U_$P(^ORD(101.43,OI,0),U)
"RTN","ORBCMA1",92,0)
 Q
"RTN","ORBCMA1",93,0)
FAILDEA(FAIL,OI,ORNP,PSTYPE)    ; return 1 if DEA check fails for this provider
"RTN","ORBCMA1",94,0)
 N DEAFLG,PSOI
"RTN","ORBCMA1",95,0)
 S FAIL=0,PSOI=+$P($G(^ORD(101.43,+$G(OI),0)),U,2) Q:PSOI'>0
"RTN","ORBCMA1",96,0)
 I '$L($T(OIDEA^PSSUTLA1)) Q
"RTN","ORBCMA1",97,0)
 S DEAFLG=$$OIDEA^PSSUTLA1(PSOI,PSTYPE) Q:DEAFLG'>0
"RTN","ORBCMA1",98,0)
 I '$L($P($G(^VA(200,+$G(ORNP),"PS")),U,2)),'$L($P($G(^("PS")),U,3)) S FAIL=1
"RTN","ORBCMA1",99,0)
 Q
"RTN","ORBCMA1",100,0)
CHK94(VAL)      ; return 1 if patch 94 has been installed
"RTN","ORBCMA1",101,0)
 S VAL=0
"RTN","ORBCMA1",102,0)
 I $O(^ORD(101.41,"B","PS MEDS",0)) S VAL=1
"RTN","ORBCMA1",103,0)
 Q
"RTN","ORBCMA32")
0^1^B85583831
"RTN","ORBCMA32",1,0)
ORBCMA32 ; SLC/JLI - Pharmacy Calls for GUI Dialog 02/11/2008
"RTN","ORBCMA32",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**133,243**;Dec 17, 1997;Build 242
"RTN","ORBCMA32",3,0)
 ;;BCMA ORDER V1.0 ;**133,243**;Jan 17, 2002
"RTN","ORBCMA32",4,0)
 ;
"RTN","ORBCMA32",5,0)
NXT() ; -- returns next available index in return data array
"RTN","ORBCMA32",6,0)
 S ILST=ILST+1
"RTN","ORBCMA32",7,0)
 Q ILST
"RTN","ORBCMA32",8,0)
 ;
"RTN","ORBCMA32",9,0)
DLGSLCT(LST,PSTYPE) ; return default lists for dialog
"RTN","ORBCMA32",10,0)
 ; PSTYPE: pharmacy type (U=unit dose, F=IV fluids, O=outpatient)
"RTN","ORBCMA32",11,0)
 N ILST S ILST=0
"RTN","ORBCMA32",12,0)
 I PSTYPE="F" D  Q                       ; IV Fluids
"RTN","ORBCMA32",13,0)
 . S LST($$NXT)="~ShortList"  D SHORT
"RTN","ORBCMA32",14,0)
 . S LST($$NXT)="~Priorities" D PRIOR
"RTN","ORBCMA32",15,0)
 ;
"RTN","ORBCMA32",16,0)
 S LST($$NXT)="~ShortList"  D SHORT      ; Unit Dose & Outpatient
"RTN","ORBCMA32",17,0)
 S LST($$NXT)="~Schedules"  D SCHED
"RTN","ORBCMA32",18,0)
 S LST($$NXT)="~Priorities" D PRIOR
"RTN","ORBCMA32",19,0)
 I PSTYPE="O" D                          ; Outpatient
"RTN","ORBCMA32",20,0)
 . S LST($$NXT)="~Pickup"   D PICKUP
"RTN","ORBCMA32",21,0)
 . S LST($$NXT)="~SCStatus" D SCLIST
"RTN","ORBCMA32",22,0)
 Q
"RTN","ORBCMA32",23,0)
SHORT ; from DLGSLCT, get short list of med quick orders
"RTN","ORBCMA32",24,0)
 N I,X,TMP
"RTN","ORBCMA32",25,0)
 I PSTYPE="U" S X="UD RX"
"RTN","ORBCMA32",26,0)
 I PSTYPE="F" S X="IV RX"
"RTN","ORBCMA32",27,0)
 I PSTYPE="O" S X="O RX"
"RTN","ORBCMA32",28,0)
 D GETQLST^ORWDXQ(.TMP,X,"iQ")
"RTN","ORBCMA32",29,0)
 S I=0 F  S I=$O(TMP(I)) Q:'I  S LST($$NXT)=TMP(I)
"RTN","ORBCMA32",30,0)
 Q
"RTN","ORBCMA32",31,0)
SCHED ; from DLGSLCT, get all pharmacy administration schedules
"RTN","ORBCMA32",32,0)
 N X
"RTN","ORBCMA32",33,0)
 K ^TMP($J,"ORBCMA32 SCHED")
"RTN","ORBCMA32",34,0)
 D AP^PSS51P1("PSJ",,,,"ORBCMA32 SCHED")
"RTN","ORBCMA32",35,0)
 S X="" F  S X=$O(^TMP($J,"ORBCMA32 SCHED","APPSJ",X)) Q:X=""  S LST($$NXT)="i"_X
"RTN","ORBCMA32",36,0)
 K ^TMP($J,"ORBCMA32 SCHED")
"RTN","ORBCMA32",37,0)
 Q
"RTN","ORBCMA32",38,0)
SCHEDA ; (similar to SCHED, but also returns administration times)
"RTN","ORBCMA32",39,0)
 N X,IEN,SCH
"RTN","ORBCMA32",40,0)
 K ^TMP($J,"ORBCMA32 SCHEDA")
"RTN","ORBCMA32",41,0)
 D AP^PSS51P1("PSJ",,,,"ORBCMA32 SCHEDA")
"RTN","ORBCMA32",42,0)
 S SCH="" F  S SCH=$O(^TMP($J,"ORBCMA32 SCHEDA","APPSJ",SCH)) Q:SCH=""  D
"RTN","ORBCMA32",43,0)
 . S IEN=0 F  S IEN=$O(^TMP($J,"ORBCMA32 SCHEDA","APPSJ",SCH,IEN)) Q:IEN'>0  D
"RTN","ORBCMA32",44,0)
 . . S X=$S($L(^TMP($J,"ORBCMA32 SCHEDA",IEN,2)):"  ("_^TMP($J,"ORBCMA32 SCHEDA",IEN,2)_")",1:"")
"RTN","ORBCMA32",45,0)
 . . S LST($$NXT)="i"_IEN_U_SCH_X
"RTN","ORBCMA32",46,0)
 Q
"RTN","ORBCMA32",47,0)
PRIOR ; from DLGSLCT, get list of allowed priorities
"RTN","ORBCMA32",48,0)
 N X,XREF
"RTN","ORBCMA32",49,0)
 S X=0
"RTN","ORBCMA32",50,0)
 S X=$O(^ORD(101.42,"B","DONE",X))
"RTN","ORBCMA32",51,0)
 S LST($$NXT)="i"_X_U_$P(^ORD(101.42,X,0),U,2)
"RTN","ORBCMA32",52,0)
 Q
"RTN","ORBCMA32",53,0)
PICKUP ; from DLGSLCT, get prescription routing
"RTN","ORBCMA32",54,0)
 N X,EDITONLY
"RTN","ORBCMA32",55,0)
 F X="W^at Window","M^by Mail","C^in Clinic" S LST($$NXT)="i"_X
"RTN","ORBCMA32",56,0)
 S X=$$DEFPICK I $L(X) S LST($$NXT)="d"_X
"RTN","ORBCMA32",57,0)
 Q
"RTN","ORBCMA32",58,0)
DEFPICK()       ; return default routing
"RTN","ORBCMA32",59,0)
 N X,DLG,PRMT
"RTN","ORBCMA32",60,0)
 S DLG=$O(^ORD(101.41,"AB","PSO OERR",0)),X=""
"RTN","ORBCMA32",61,0)
 S PRMT=$O(^ORD(101.41,"AB","OR GTX ROUTING",0))
"RTN","ORBCMA32",62,0)
 I $D(^TMP("ORECALL",$J,+DLG,+PRMT,1)) S X=^(1)
"RTN","ORBCMA32",63,0)
 I X'="" S EDITONLY=1 Q X  ; EDITONLY used by default action
"RTN","ORBCMA32",64,0)
 ;
"RTN","ORBCMA32",65,0)
 S X=$$GET^XPAR("ALL","ORWDPS ROUTING DEFAULT",1,"I")
"RTN","ORBCMA32",66,0)
 I X="C" S X="C^in Clinic" G XPICK
"RTN","ORBCMA32",67,0)
 I X="M" S X="M^by Mail"   G XPICK
"RTN","ORBCMA32",68,0)
 I X="W" S X="W^at Window" G XPICK
"RTN","ORBCMA32",69,0)
 I X="N" S X=""             G XPICK
"RTN","ORBCMA32",70,0)
 I X=""  S X=$S($D(^PSX(550,"C")):"M^by Mail",1:"W^at Window")
"RTN","ORBCMA32",71,0)
XPICK Q X
"RTN","ORBCMA32",72,0)
 ;
"RTN","ORBCMA32",73,0)
SCLIST ; from DLGSLCT, get options for service connected
"RTN","ORBCMA32",74,0)
 F X="0^No","1^Yes" S LST($$NXT)="i"_X
"RTN","ORBCMA32",75,0)
 Q
"RTN","ORBCMA32",76,0)
 ;
"RTN","ORBCMA32",77,0)
OISLCT(LST,OI,PSTYPE,ORVP) ; return for defaults for pharmacy orderable item
"RTN","ORBCMA32",78,0)
 N ILST S ILST=0
"RTN","ORBCMA32",79,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORBCMA32",80,0)
 S LST($$NXT)="~Dispense" D DISPDRG
"RTN","ORBCMA32",81,0)
 S LST($$NXT)="~Instruct" D INSTRCT
"RTN","ORBCMA32",82,0)
 S LST($$NXT)="~Route"    D ROUTE
"RTN","ORBCMA32",83,0)
 S LST($$NXT)="~Message"  D MESSAGE
"RTN","ORBCMA32",84,0)
 I $L($G(^TMP("PSJSCH",$J))) S LST($$NXT)="~DefSched",LST($$NXT)="d"_^($J)
"RTN","ORBCMA32",85,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORBCMA32",86,0)
 Q
"RTN","ORBCMA32",87,0)
 ;
"RTN","ORBCMA32",88,0)
DISPDRUG(LST,OI) ; list dispense drugs for an orderable item
"RTN","ORBCMA32",89,0)
 N ILST,PSTYPE S ILST=0,PSTYPE="U" D DISPDRG
"RTN","ORBCMA32",90,0)
 Q
"RTN","ORBCMA32",91,0)
 ;
"RTN","ORBCMA32",92,0)
DISPDRG ; from OISLCT, get dispense drugs for this pharmacy orderable item
"RTN","ORBCMA32",93,0)
 N I,ORTMP,ORX
"RTN","ORBCMA32",94,0)
 S ORX=$T(ENDD^PSJORUTL),ORX=$L($P(ORX,";"),",")
"RTN","ORBCMA32",95,0)
 I ORX>3 D ENDD^PSJORUTL("^^^"_+$P($G(^ORD(101.43,OI,0)),"^",2),PSTYPE,.ORTMP,+ORVP)
"RTN","ORBCMA32",96,0)
 I ORX'>3 D ENDD^PSJORUTL("^^^"_+$P($G(^ORD(101.43,OI,0)),"^",2),PSTYPE,.ORTMP)
"RTN","ORBCMA32",97,0)
 S I="" F  S I=$O(ORTMP(I)) Q:I=""  D
"RTN","ORBCMA32",98,0)
 . I $P(ORTMP(I),U,4)="1" S $P(ORTMP(I),U,4)="NF"
"RTN","ORBCMA32",99,0)
 . S $P(ORTMP(I),U,3)="$"_$P(ORTMP(I),U,3)_" per "_$P(ORTMP(I),U,5)
"RTN","ORBCMA32",100,0)
 . S LST($$NXT)="i"_ORTMP(I)
"RTN","ORBCMA32",101,0)
 Q
"RTN","ORBCMA32",102,0)
INSTRCT ; from OISLCT, get list of potential instructions (based on drug form)
"RTN","ORBCMA32",103,0)
 N INOUN,NOUN,IINS,INS,VERB,INSREC
"RTN","ORBCMA32",104,0)
 D START^PSSJORDF(+$P(^ORD(101.43,OI,0),U,2))
"RTN","ORBCMA32",105,0)
 I PSTYPE="U" Q  ; don't use the instructions list for inpatients
"RTN","ORBCMA32",106,0)
 S IINS=0 F  S IINS=$O(^TMP("PSJINS",$J,IINS)) Q:'IINS  D
"RTN","ORBCMA32",107,0)
 . S INSREC=$G(^TMP("PSJINS",$J,IINS))
"RTN","ORBCMA32",108,0)
 . I '$D(VERB) S VERB=$P(INSREC,U)
"RTN","ORBCMA32",109,0)
 . I $L($P(INSREC,U,2)) S LST($$NXT)="i"_$P(INSREC,U,2)
"RTN","ORBCMA32",110,0)
 S LST($$NXT)="~Nouns"
"RTN","ORBCMA32",111,0)
 S INOUN=0 F  S INOUN=$O(^TMP("PSJNOUN",$J,INOUN)) Q:'INOUN  D
"RTN","ORBCMA32",112,0)
 . S LST($$NXT)="i"_$P(^TMP("PSJNOUN",$J,INOUN),U)
"RTN","ORBCMA32",113,0)
 I $D(VERB) S LST($$NXT)="~Verb",LST($$NXT)="d"_VERB
"RTN","ORBCMA32",114,0)
 ;
"RTN","ORBCMA32",115,0)
 Q
"RTN","ORBCMA32",116,0)
MIXED(X)   ; Return mixed case
"RTN","ORBCMA32",117,0)
 Q X  ;$E(X)_$TR($E(X,2,$L(X)),"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","ORBCMA32",118,0)
 ;
"RTN","ORBCMA32",119,0)
ROUTE ; from OISLCT, get list of routes for the drug form
"RTN","ORBCMA32",120,0)
 ; ** NEED BOTH ABBREVIATION & NAME IN LIST BOX
"RTN","ORBCMA32",121,0)
 N I,CNT,ABBR,IEN,ROUT,X
"RTN","ORBCMA32",122,0)
 S I="" F  S I=$O(^TMP("PSJMR",$J,I)) Q:I=""  D
"RTN","ORBCMA32",123,0)
 . S ROUT=$P(^TMP("PSJMR",$J,I),U),ABBR=$P(^(I),U,2),IEN=$P(^(I),U,3)
"RTN","ORBCMA32",124,0)
 . S LST($$NXT)="i"_IEN_U_ROUT_U_ABBR
"RTN","ORBCMA32",125,0)
 . I I=1,IEN S LST($$NXT)="d"_IEN_U_ROUT ;_U_ABBR ; assume first always default
"RTN","ORBCMA32",126,0)
 S I="" F  S I=$O(^TMP("PSJMR",$J,I)) Q:I=""  D
"RTN","ORBCMA32",127,0)
 . S ROUT=$P(^TMP("PSJMR",$J,I),U),ABBR=$P(^(I),U,2),IEN=$P(^(I),U,3)
"RTN","ORBCMA32",128,0)
 . I $L(ABBR),(ABBR'=ROUT) S LST($$NXT)="i"_IEN_U_ABBR_" ("_ROUT_")"_U_ABBR
"RTN","ORBCMA32",129,0)
 Q
"RTN","ORBCMA32",130,0)
MESSAGE ; message
"RTN","ORBCMA32",131,0)
 S I=0 F  S I=$O(^ORD(101.43,OI,8,I)) Q:I'>0  S LST($$NXT)="t"_^(I,0)
"RTN","ORBCMA32",132,0)
 Q
"RTN","ORBCMA32",133,0)
ALLROUTE(LST) ; returns a list of all available med routes
"RTN","ORBCMA32",134,0)
 N I,X,ILST
"RTN","ORBCMA32",135,0)
 S ILST=0
"RTN","ORBCMA32",136,0)
 K ^TMP($J,"ORWDPS32 ALLROUTE")
"RTN","ORBCMA32",137,0)
 D ALL^PSS51P2(,"??",,,"ORWDPS32 ALLROUTE")
"RTN","ORBCMA32",138,0)
 S I=0 F  S I=$O(^TMP($J,"ORWDPS32 ALLROUTE",I)) Q:'I  D
"RTN","ORBCMA32",139,0)
 . I +$P(^TMP($J,"ORWDPS32 ALLROUTE",I,3),U)>0 S LST($$NXT)=I_U_^TMP($J,"ORWDPS32 ALLROUTE",I,.01)_U_^TMP($J,"ORWDPS32 ALLROUTE",I,1)
"RTN","ORBCMA32",140,0)
 Q
"RTN","ORBCMA32",141,0)
VALROUTE(REC,X)        ; validates route name & returns IEN + abbreviation
"RTN","ORBCMA32",142,0)
 N ABBR,NAME,IEN
"RTN","ORBCMA32",143,0)
 K ^TMP($J,"ORBCMA32 VALROUTE")
"RTN","ORBCMA32",144,0)
 S X=$$UPPER(X)
"RTN","ORBCMA32",145,0)
 D ALL^PSS51P2(,X,,1,"ORBCMA32 VALROUTE")
"RTN","ORBCMA32",146,0)
 I $P(^TMP($J,"ORBCMA32 VALROUTE",0),U)=-1 K ^TMP($J,"ORBCMA32 VALROUTE") S REC=0 Q
"RTN","ORBCMA32",147,0)
 S IEN=$O(^TMP($J,"ORBCMA32 VALROUTE","B",X,""))
"RTN","ORBCMA32",148,0)
 I IEN'>0 S IEN=$O(^TMP($J,"ORBCMA32 VALROUTE","C",X,""))
"RTN","ORBCMA32",149,0)
 I IEN'>0 S REC=0 Q
"RTN","ORBCMA32",150,0)
 S NAME=$G(^TMP($J,"ORBCMA32 VALROUTE",IEN,.01))
"RTN","ORBCMA32",151,0)
 S ABBR=$G(^TMP($J,"ORBCMA32 VALROUTE",IEN,1))
"RTN","ORBCMA32",152,0)
 I '$L(ABBR) S ABBR=NAME
"RTN","ORBCMA32",153,0)
 I ($$UPPER(NAME)'=X),($$UPPER(ABBR)'=X) S REC=0 K ^TMP($J,"ORBCMA32 VALROUTE") Q
"RTN","ORBCMA32",154,0)
 S REC=IEN_U_ABBR
"RTN","ORBCMA32",155,0)
 K ^TMP($J,"ORBCMA32 VALROUTE")
"RTN","ORBCMA32",156,0)
 Q
"RTN","ORBCMA32",157,0)
AUTH(VAL,PRV) ; For inpatient meds, check restrictions
"RTN","ORBCMA32",158,0)
 N NAME,AUTH,INACT,X S VAL=0
"RTN","ORBCMA32",159,0)
 S NAME=$P($G(^VA(200,PRV,20)),U,2) S:'$L(NAME) NAME=$P(^(0),U)
"RTN","ORBCMA32",160,0)
 S X=$G(^VA(200,PRV,"PS")),AUTH=$P(X,U),INACT=$P(X,U,4)
"RTN","ORBCMA32",161,0)
 I 'AUTH!(INACT&(DT>INACT)) D  Q
"RTN","ORBCMA32",162,0)
 . S VAL="1^"_NAME_" is not authorized to write medication orders."
"RTN","ORBCMA32",163,0)
 I $D(^XUSEC("OREMAS",DUZ)),'$$GET^XPAR("ALL","OR OREMAS MED ORDERS") D  Q
"RTN","ORBCMA32",164,0)
 . S VAL="1^OREMAS key holders may not enter medication orders."
"RTN","ORBCMA32",165,0)
 Q
"RTN","ORBCMA32",166,0)
DRUGMSG(VAL,IEN)        ; return any message associated with a dispense drug
"RTN","ORBCMA32",167,0)
 N X S X=$$ENDCM^PSJORUTL(IEN)
"RTN","ORBCMA32",168,0)
 S VAL=$P(X,U,2)_U_$P(X,U,4)
"RTN","ORBCMA32",169,0)
 Q
"RTN","ORBCMA32",170,0)
MEDISIV(VAL,IEN)        ; return true if orderable item is IV medication
"RTN","ORBCMA32",171,0)
 S VAL=0
"RTN","ORBCMA32",172,0)
 I $P($G(^ORD(101.43,IEN,"PS")),U)=2 S VAL=1
"RTN","ORBCMA32",173,0)
 Q
"RTN","ORBCMA32",174,0)
ISSPLY(VAL,IEN) ; return true if orderable item is a supply
"RTN","ORBCMA32",175,0)
 S VAL=0
"RTN","ORBCMA32",176,0)
 I $P($G(^ORD(101.43,IEN,"PS")),U,5)=1 S VAL=1
"RTN","ORBCMA32",177,0)
 Q
"RTN","ORBCMA32",178,0)
IVAMT(VAL,OI,ORWTYP)     ; return UNITS^AMOUNT |^AMOUNT^AMOUNT...| for IV soln
"RTN","ORBCMA32",179,0)
 N I,PSOI,ORWY,AMT,IVFLAG
"RTN","ORBCMA32",180,0)
 S IVFLAG=$P(OI,U,2)
"RTN","ORBCMA32",181,0)
 S PSOI=+$P($G(^ORD(101.43,+OI,0)),U,2)_ORWTYP,VAL=""
"RTN","ORBCMA32",182,0)
 I IVFLAG="NF" D ENVOL2^PSJORUT2(PSOI,.ORWY)
"RTN","ORBCMA32",183,0)
 I IVFLAG="" D ENVOL^PSJORUT2(PSOI,.ORWY)
"RTN","ORBCMA32",184,0)
 I ORWTYP="B" D
"RTN","ORBCMA32",185,0)
 . S I=0 F  S I=$O(ORWY(I)) Q:I'>0  S AMT(+ORWY(I))=""
"RTN","ORBCMA32",186,0)
 . S AMT=0,VAL="ML" F  S AMT=$O(AMT(AMT)) Q:AMT'>0  S VAL=VAL_U_AMT
"RTN","ORBCMA32",187,0)
 I ORWTYP="A" D
"RTN","ORBCMA32",188,0)
 . S I=+$O(ORWY(0)) S VAL=$P($G(ORWY(I)),U,2)
"RTN","ORBCMA32",189,0)
 . I '$L(VAL) S VAL="ML^LITER^MCG^MG^GM^UNITS^IU^MEQ^MM^MU^THOUU^MG-PE^NANOGRAM^MMOL"
"RTN","ORBCMA32",190,0)
 Q
"RTN","ORBCMA32",191,0)
VALRATE(VAL,X)   ; return "1" (true) if IV rate text is valid
"RTN","ORBCMA32",192,0)
 I $E($RE($$UPPER(X)),1,5)="RH/LM"  S X=$E(X,1,$L(X)-5)
"RTN","ORBCMA32",193,0)
 S X=$$TRIM(X)
"RTN","ORBCMA32",194,0)
 D ORINF^PSIVSP S VAL=$G(X) ;S OK=$S($D(X):1,1:0)
"RTN","ORBCMA32",195,0)
 Q
"RTN","ORBCMA32",196,0)
UPPER(X) ; return uppercase
"RTN","ORBCMA32",197,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","ORBCMA32",198,0)
 ;
"RTN","ORBCMA32",199,0)
TRIM(X) ; trim leading and trailing spaces
"RTN","ORBCMA32",200,0)
 S X=$RE(X) F  S:$E(X)=" " X=$E(X,2,999) Q:$E(X)'=" "  Q:'$L(X)  ;trail
"RTN","ORBCMA32",201,0)
 S X=$RE(X) F  S:$E(X)=" " X=$E(X,2,999) Q:$E(X)'=" "  Q:'$L(X)  ;lead
"RTN","ORBCMA32",202,0)
 Q X
"RTN","ORBCMA32",203,0)
SCSTS(VAL,ORVP,ORDRUG)  ; return service connected eligibility for patient
"RTN","ORBCMA32",204,0)
 N ORWP94 S ORWP94=$O(^ORD(101.41,"AB","PS MEDS",0))>0
"RTN","ORBCMA32",205,0)
 I $L($T(SC^PSOCP)),$$SC^PSOCP(+ORVP,+$G(ORDRUG)) S VAL=0 G XSCSTS
"RTN","ORBCMA32",206,0)
 I 'ORWP94,(+$$RXST^IBARXEU(+ORVP)>0) S VAL=0 G XSCSTS
"RTN","ORBCMA32",207,0)
 S VAL=1
"RTN","ORBCMA32",208,0)
XSCSTS Q
"RTN","ORBCMA32",209,0)
FORMALT(ORLST,IEN,PSTYPE) ; return a list of formulary alternatives
"RTN","ORBCMA32",210,0)
 D ENRFA^PSJORUTL(IEN,PSTYPE,.ORLST)
"RTN","ORBCMA32",211,0)
 S I=0 F  S I=$O(ORLST(I)) Q:'I  D
"RTN","ORBCMA32",212,0)
 . S OI=+$O(^ORD(101.43,"ID",+$P(ORLST(I),U,4)_";99PSP",0))
"RTN","ORBCMA32",213,0)
 . S $P(ORLST(I),U,4)=OI I OI S $P(ORLST(I),U,5)=$P(^ORD(101.43,OI,0),U)
"RTN","ORBCMA32",214,0)
 Q
"RTN","ORBCMA32",215,0)
VALSCH(OK,X,PSTYPE)    ; validate a schedule, return 1 if valid, 0 if not
"RTN","ORBCMA32",216,0)
 I '$L($T(EN^PSSGSGUI)) S OK=-1 Q
"RTN","ORBCMA32",217,0)
 I $E($T(EN^PSSGSGUI),1,4)="EN(X" D
"RTN","ORBCMA32",218,0)
 . N ORX S ORX=$G(X) D EN^PSSGSGUI(.ORX,$G(PSTYPE,"I"))
"RTN","ORBCMA32",219,0)
 . K X S:$D(ORX) X=ORX
"RTN","ORBCMA32",220,0)
 E  D
"RTN","ORBCMA32",221,0)
 . D EN^PSSGSGUI
"RTN","ORBCMA32",222,0)
 S OK=$S($D(X):1,1:0)
"RTN","ORBCMA32",223,0)
 Q
"RTN","ORBCMA32",224,0)
VALQTY(OK,X)    ; validate a quantity, return 1 if valid, 0 if not
"RTN","ORBCMA32",225,0)
 ; to be compatible with LM, make sure X is integer from 1 to 240
"RTN","ORBCMA32",226,0)
 ; this is based on the input transform from 52,7
"RTN","ORBCMA32",227,0)
 K:(+X'>0)!(+X>99999999)!(X'?.8N.1".".2N)!($L(X)>12) X
"RTN","ORBCMA32",228,0)
 S OK=$S($D(X):1,1:0)
"RTN","ORBCMA32",229,0)
 Q
"RTN","ORBCMA32",230,0)
DOSES(LST,OI) ; return doses for an orderable item  -  TEST ONLY
"RTN","ORBCMA32",231,0)
 N ORTMP,ORI,ORJ,ILST,NDF,VAPN,X,PSTYPE S PSTYPE="O"
"RTN","ORBCMA32",232,0)
 D ENDD^PSJORUTL("^^^"_+$P($G(^ORD(101.43,OI,0)),"^",2),PSTYPE,.ORTMP)
"RTN","ORBCMA32",233,0)
 S ORI=0 F  S ORI=$O(ORTMP(ORI)) Q:'ORI  S ORWDRG=+ORTMP(ORI) D
"RTN","ORBCMA32",234,0)
 . K ^TMP($J,"ORBCMA32 DRUG")
"RTN","ORBCMA32",235,0)
 . D NDF^PSS50(+ORWDRG,,,,,"ORBCMA32 DRUG")
"RTN","ORBCMA32",236,0)
 . S VAPN=$P($G(^TMP($J,"ORBCMA32 DRUG",+ORWDRG,22)),U),NDF=$P($G(^TMP($J,"ORBCMA32 DRUG",+ORWDRG,20)),U)
"RTN","ORBCMA32",237,0)
 . S X=$$DFSU^PSNAPIS(NDF,VAPN)
"RTN","ORBCMA32",238,0)
 . S LSTA($P(X,U,4),$P(X,U,6))=""
"RTN","ORBCMA32",239,0)
 . I +$P(X,U,4)=$P(X,U,4) S LSTA($P(X,U,4)*2,$P(X,U,6))=""
"RTN","ORBCMA32",240,0)
 K ^TMP($J,"ORBCMA32 DRUG")
"RTN","ORBCMA32",241,0)
 S ORI="",ILST=0 F  S ORI=$O(LSTA(ORI)) Q:ORI=""  D
"RTN","ORBCMA32",242,0)
 . S ORJ="" F  S ORJ=$O(LSTA(ORI,ORJ)) Q:ORJ=""  D
"RTN","ORBCMA32",243,0)
 . . S ILST=ILST+1,LST(ILST)=ORI_" "_ORJ
"RTN","ORBCMA32",244,0)
 Q
"RTN","ORBPRCHK")
0^69^B30311169
"RTN","ORBPRCHK",1,0)
ORBPRCHK ; SLC/JMH - API to return who gets notifications TAKEN FROM ORB3;
"RTN","ORBPRCHK",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORBPRCHK",3,0)
CHECK(ORPERS,ORNUM,ORN,ORBDFN) ; returns 1 if ORPERS should get the alert
"RTN","ORBPRCHK",4,0)
 N ORRET,ORY
"RTN","ORBPRCHK",5,0)
 D START(.ORRET,ORNUM,ORN,ORBDFN)
"RTN","ORBPRCHK",6,0)
 S ORY=$S($D(ORRET(ORPERS)):1,1:0)
"RTN","ORBPRCHK",7,0)
 Q ORY
"RTN","ORBPRCHK",8,0)
START(ORRET,ORNUM,ORN,ORBDFN) ;
"RTN","ORBPRCHK",9,0)
 Q:$G(ORN)=""!($G(ORBDFN)="")
"RTN","ORBPRCHK",10,0)
 Q:'$L($G(^ORD(100.9,ORN,0)))
"RTN","ORBPRCHK",11,0)
 N ORBNOW,ORBID,ORBLOCK,ORBDESC
"RTN","ORBPRCHK",12,0)
 S ORBNOW=$$NOW^XLFDT
"RTN","ORBPRCHK",13,0)
 N ORBDUZ,ORBN,ORBXQAID,ORPTNAM,ORBPRIM,ORBATTD,ORBDEV,ORBENT
"RTN","ORBPRCHK",14,0)
 N XQA,VAIN,VADM,DIC,ORBPDATA,ORBPMSG,VA,VA200,VAERR,X,Y
"RTN","ORBPRCHK",15,0)
 N ORBUI,ORBASPEC,ORBSMSG,ORBADT,ORBSDEV,ORBDEL,ORBDI,ORBTDEV,ORY
"RTN","ORBPRCHK",16,0)
 S ORBUI=1,ORBADT=0
"RTN","ORBPRCHK",17,0)
 S:'$L($G(ORBPMSG)) ORBPMSG=""
"RTN","ORBPRCHK",18,0)
 S ORBPDATA=+$G(ORNUM)_"@"
"RTN","ORBPRCHK",19,0)
 S ORBN=^ORD(100.9,ORN,0)
"RTN","ORBPRCHK",20,0)
 ;
"RTN","ORBPRCHK",21,0)
 S ORBENT=$$ENTITY^ORB31(ORNUM)
"RTN","ORBPRCHK",22,0)
 D REGULAR^ORB3REG(ORN,.XQA,.ORBU,.ORBUI,.ORBDEV,ORBDFN)
"RTN","ORBPRCHK",23,0)
 D SPECIAL^ORB3SPEC(ORN,.ORBASPEC,.ORBU,.ORBUI,$G(ORNUM),ORBDFN,$G(ORBPDATA),.ORBSMSG,$G(ORBPMSG),.ORBSDEV,$G(ORBPRIM),$G(ORBATTD))
"RTN","ORBPRCHK",24,0)
 I $D(ORBASPEC)>1 D SPECDUZS ;special recips
"RTN","ORBPRCHK",25,0)
 I $D(ORBADUZ)>1 D PKGDUZS ;pkg-supplied recips
"RTN","ORBPRCHK",26,0)
 D TITLE ;provider recips
"RTN","ORBPRCHK",27,0)
 M ORRET=XQA
"RTN","ORBPRCHK",28,0)
 Q
"RTN","ORBPRCHK",29,0)
PKGDUZS ;get DUZs from pkg-passed ORBADUZ() array
"RTN","ORBPRCHK",30,0)
 N ORBPDUZ
"RTN","ORBPRCHK",31,0)
 S ORBPDUZ=""
"RTN","ORBPRCHK",32,0)
 F  S ORBPDUZ=$O(ORBADUZ(ORBPDUZ)) Q:ORBPDUZ=""  S ORBDUZ=ORBPDUZ D USER
"RTN","ORBPRCHK",33,0)
 Q
"RTN","ORBPRCHK",34,0)
SPECDUZS ;get DUZs rtn by SPECIAL^ORB3SPEC
"RTN","ORBPRCHK",35,0)
 N ORBSDUZ
"RTN","ORBPRCHK",36,0)
 S ORBSDUZ=""
"RTN","ORBPRCHK",37,0)
 F  S ORBSDUZ=$O(ORBASPEC(ORBSDUZ)) Q:ORBSDUZ=""  S ORBDUZ=ORBSDUZ D USER
"RTN","ORBPRCHK",38,0)
 Q
"RTN","ORBPRCHK",39,0)
TITLE ;get provider recips
"RTN","ORBPRCHK",40,0)
 N TITLES
"RTN","ORBPRCHK",41,0)
 S TITLES=$$GET^XPAR(ORBENT,"ORB PROVIDER RECIPIENTS",ORN,"I")
"RTN","ORBPRCHK",42,0)
 I TITLES["P" D PRIMARY
"RTN","ORBPRCHK",43,0)
 I TITLES["A" D ATTEND
"RTN","ORBPRCHK",44,0)
 I TITLES["T" D TEAMS
"RTN","ORBPRCHK",45,0)
 I TITLES["O" D ORDERER
"RTN","ORBPRCHK",46,0)
 I TITLES["E" D ENTERBY
"RTN","ORBPRCHK",47,0)
 I TITLES["R" D PCMMPRIM
"RTN","ORBPRCHK",48,0)
 I TITLES["S" D PCMMASSC
"RTN","ORBPRCHK",49,0)
 I TITLES["M" D PCMMTEAM
"RTN","ORBPRCHK",50,0)
 Q
"RTN","ORBPRCHK",51,0)
PRIMARY ;
"RTN","ORBPRCHK",52,0)
 I +$G(ORBPRIM)>0 S ORBDUZ=ORBPRIM D USER
"RTN","ORBPRCHK",53,0)
 Q
"RTN","ORBPRCHK",54,0)
ATTEND ;
"RTN","ORBPRCHK",55,0)
 I +$G(ORBATTD)>0 S ORBDUZ=ORBATTD D USER
"RTN","ORBPRCHK",56,0)
 Q
"RTN","ORBPRCHK",57,0)
TEAMS ;
"RTN","ORBPRCHK",58,0)
 N ORBLST,ORBI,ORBJ,ORBTM,ORBTNAME,ORBTTYPE,ORBTD
"RTN","ORBPRCHK",59,0)
 D TMSPT^ORQPTQ1(.ORBLST,ORBDFN)
"RTN","ORBPRCHK",60,0)
 Q:+$G(ORBLST(1))<1
"RTN","ORBPRCHK",61,0)
 S ORBI="" F  S ORBI=$O(ORBLST(ORBI)) Q:ORBI=""  D
"RTN","ORBPRCHK",62,0)
 .S ORBTM=$P(ORBLST(ORBI),U),ORBTNAME=$P(ORBLST(ORBI),U,2)
"RTN","ORBPRCHK",63,0)
 .S ORBTTYPE=$P(ORBLST(ORBI),U,3)
"RTN","ORBPRCHK",64,0)
 .I $D(ORBU) D
"RTN","ORBPRCHK",65,0)
 ..S ORBU(ORBUI)="  Patient list "_ORBTNAME_" ["_ORBTTYPE_"]:",ORBUI=ORBUI+1
"RTN","ORBPRCHK",66,0)
 .N ORBLST2 D TEAMPROV^ORQPTQ1(.ORBLST2,ORBTM)
"RTN","ORBPRCHK",67,0)
 .Q:+$G(ORBLST2(1))<1
"RTN","ORBPRCHK",68,0)
 .S ORBJ="" F  S ORBJ=$O(ORBLST2(ORBJ)) Q:ORBJ=""  D
"RTN","ORBPRCHK",69,0)
 ..S ORBDUZ=$P(ORBLST2(ORBJ),U)_U_ORBTM I +$G(ORBDUZ)>0 D USER
"RTN","ORBPRCHK",70,0)
 .;
"RTN","ORBPRCHK",71,0)
 .S ORBTD=$P($$TMDEV^ORB31(ORBTM),U,2)  ;Team's device
"RTN","ORBPRCHK",72,0)
 .I $L(ORBTD) D
"RTN","ORBPRCHK",73,0)
 ..S ORBTDEV(ORBTD)=""
"RTN","ORBPRCHK",74,0)
 ..I $D(ORBU) D
"RTN","ORBPRCHK",75,0)
 ...S ORBU(ORBUI)="   Team's Device "_ORBTD_" is a recipient",ORBUI=ORBUI+1
"RTN","ORBPRCHK",76,0)
 Q
"RTN","ORBPRCHK",77,0)
ORDERER ;
"RTN","ORBPRCHK",78,0)
 Q:+$G(ORNUM)<1
"RTN","ORBPRCHK",79,0)
 I $D(ORBU) S ORBU(ORBUI)=" Ordering provider:",ORBUI=ORBUI+1
"RTN","ORBPRCHK",80,0)
 N ORBLST,ORBI,ORBTM,ORBJ,ORBTNAME,ORBPLST,ORBPI,ORBPTM,ORBTTYPE
"RTN","ORBPRCHK",81,0)
 S ORBDUZ=$S(ORN=12:+$$UNSIGNOR^ORQOR2(ORNUM),1:$$ORDERER^ORQOR2(ORNUM))
"RTN","ORBPRCHK",82,0)
 I +$G(ORBDUZ)>0 D
"RTN","ORBPRCHK",83,0)
 .D USER
"RTN","ORBPRCHK",84,0)
 .;if notif = Order Req E/S (#12) or Order Req Co-sign (#37) and
"RTN","ORBPRCHK",85,0)
 .;user doesn't have ES authority, send to fellow team members w/ES:
"RTN","ORBPRCHK",86,0)
 .I ((ORN=12)!(ORN=37)),('$D(^XUSEC("ORES",ORBDUZ))) D
"RTN","ORBPRCHK",87,0)
 ..I $D(ORBU) S ORBU(ORBUI)=" Orderer can't elec sign, getting teams orderer belongs to:",ORBUI=ORBUI+1
"RTN","ORBPRCHK",88,0)
 ..D TEAMPR^ORQPTQ1(.ORBLST,ORBDUZ)  ;get orderer's tms
"RTN","ORBPRCHK",89,0)
 ..Q:+$G(ORBLST(1))<1
"RTN","ORBPRCHK",90,0)
 ..D TMSPT^ORQPTQ1(.ORBPLST,ORBDFN)  ;get pt's tms
"RTN","ORBPRCHK",91,0)
 ..Q:+$G(ORBPLST(1))<1
"RTN","ORBPRCHK",92,0)
 ..S ORBI="" F  S ORBI=$O(ORBLST(ORBI)) Q:ORBI=""  D
"RTN","ORBPRCHK",93,0)
 ...S ORBPI="" F  S ORBPI=$O(ORBPLST(ORBPI)) Q:ORBPI=""  D
"RTN","ORBPRCHK",94,0)
 ....S ORBTM=$P(ORBLST(ORBI),U),ORBPTM=$P(ORBPLST(ORBPI),U)
"RTN","ORBPRCHK",95,0)
 ....I ORBTM=ORBPTM D  ;if pt is on provider's team
"RTN","ORBPRCHK",96,0)
 .....I +$G(ORBPTM)>0 D
"RTN","ORBPRCHK",97,0)
 ......S ORBTNAME=$P(ORBPLST(ORBPI),U,2)
"RTN","ORBPRCHK",98,0)
 ......S ORBTTYPE=$P(ORBPLST(ORBPI),U,3)
"RTN","ORBPRCHK",99,0)
 ......I $D(ORBU) S ORBU(ORBUI)="  Orderer's pt list "_ORBTNAME_" ["_ORBTTYPE_"] recipients: ",ORBUI=ORBUI+1
"RTN","ORBPRCHK",100,0)
 ......N ORBLST2 D TEAMPROV^ORQPTQ1(.ORBLST2,ORBPTM)
"RTN","ORBPRCHK",101,0)
 ......Q:+$G(ORBLST2(1))<1
"RTN","ORBPRCHK",102,0)
 ......S ORBJ="" F  S ORBJ=$O(ORBLST2(ORBJ)) Q:ORBJ=""  D
"RTN","ORBPRCHK",103,0)
 .......S ORBDUZ=$P(ORBLST2(ORBJ),U)_U_ORBPTM I +$G(ORBDUZ)>0,($D(^XUSEC("ORES",+ORBDUZ))) D USER
"RTN","ORBPRCHK",104,0)
 Q
"RTN","ORBPRCHK",105,0)
ENTERBY ;
"RTN","ORBPRCHK",106,0)
 I $D(ORBU) S ORBU(ORBUI)=" User entering order's most recent activity:",ORBUI=ORBUI+1
"RTN","ORBPRCHK",107,0)
 Q:+$G(ORNUM)<1
"RTN","ORBPRCHK",108,0)
 I $D(^OR(100,ORNUM,8,0)) D
"RTN","ORBPRCHK",109,0)
 .S ORBDUZ=$P(^OR(100,ORNUM,8,$P(^OR(100,ORNUM,8,0),U,3),0),U,13)
"RTN","ORBPRCHK",110,0)
 I +$G(ORBDUZ)>0 D USER
"RTN","ORBPRCHK",111,0)
 Q
"RTN","ORBPRCHK",112,0)
PCMMPRIM ;
"RTN","ORBPRCHK",113,0)
 I $D(ORBU) S ORBU(ORBUI)=" PCMM Primary Care Practitioner:",ORBUI=ORBUI+1
"RTN","ORBPRCHK",114,0)
 S ORBDUZ=+$$OUTPTPR^SDUTL3(ORBDFN,$$NOW^XLFDT,1)  ;DBIA #1252
"RTN","ORBPRCHK",115,0)
 I +$G(ORBDUZ)>0 D USER
"RTN","ORBPRCHK",116,0)
 Q
"RTN","ORBPRCHK",117,0)
PCMMASSC ;
"RTN","ORBPRCHK",118,0)
 I $D(ORBU) S ORBU(ORBUI)=" PCMM Associate Provider:",ORBUI=ORBUI+1
"RTN","ORBPRCHK",119,0)
 S ORBDUZ=+$$OUTPTAP^SDUTL3(ORBDFN,$$NOW^XLFDT)  ;DBIA #1252
"RTN","ORBPRCHK",120,0)
 I +$G(ORBDUZ)>0 D USER
"RTN","ORBPRCHK",121,0)
 Q
"RTN","ORBPRCHK",122,0)
PCMMTEAM ;
"RTN","ORBPRCHK",123,0)
 N ORPCMM,ORPCMMDZ
"RTN","ORBPRCHK",124,0)
 I $D(ORBU) S ORBU(ORBUI)=" PCMM Team Position Assignments:",ORBUI=ORBUI+1
"RTN","ORBPRCHK",125,0)
 S ORPCMM=$$PRPT^SCAPMC(ORBDFN,,,,,,"^TMP(""ORPCMM"",$J)",)  ;DBIA #1916
"RTN","ORBPRCHK",126,0)
 S ORPCMMDZ=0
"RTN","ORBPRCHK",127,0)
 F  S ORPCMMDZ=$O(^TMP("ORPCMM",$J,"SCPR",ORPCMMDZ)) Q:'ORPCMMDZ  D
"RTN","ORBPRCHK",128,0)
 .S ORBDUZ=ORPCMMDZ D USER
"RTN","ORBPRCHK",129,0)
 K ^TMP("ORPCMM",$J)
"RTN","ORBPRCHK",130,0)
 Q
"RTN","ORBPRCHK",131,0)
USER ;should USER (ORBDUZ) be a recip
"RTN","ORBPRCHK",132,0)
 I $P($$ONOFF^ORB3USER(ORN,+ORBDUZ,ORBDFN,,ORNUM),U)="ON" S XQA(+ORBDUZ)=""
"RTN","ORBPRCHK",133,0)
 Q
"RTN","ORCACT0")
0^141^B52518165
"RTN","ORCACT0",1,0)
ORCACT0 ;SLC/MKB-Validate order action ;5/19/08
"RTN","ORCACT0",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,27,48,72,86,92,94,141,165,177,173,190,215,243**;Dec 17, 1997;Build 242
"RTN","ORCACT0",3,0)
 ;
"RTN","ORCACT0",4,0)
VALID(IFN,ACTION,ERROR,NATR) ; -- Determines if action is valid for order IFN
"RTN","ORCACT0",5,0)
 N OR0,OR3,ORA0,AIFN,PKG,DG,ORDSTS,ACTSTS,VER,X,Y,MEDPARM K ERROR
"RTN","ORCACT0",6,0)
 S OR0=$G(^OR(100,+IFN,0)),OR3=$G(^(3)),PKG=$$NMSP^ORCD($P(OR0,U,14))
"RTN","ORCACT0",7,0)
 S DG=$P($G(^ORD(100.98,+$P(OR0,U,11),0)),U,3)
"RTN","ORCACT0",8,0)
 S MEDPARM=$S($G(NATR)="A":2,PKG'="PS":2,'$D(^XUSEC("OREMAS",DUZ)):2,DG="NV RX":$$GET^XPAR("ALL","OR OREMAS NON-VA MED ORDERS"),1:$$GET^XPAR("ALL","OR OREMAS MED ORDERS"))
"RTN","ORCACT0",9,0)
 S AIFN=$P(IFN,";",2) S:'AIFN AIFN=+$P(OR3,U,7)
"RTN","ORCACT0",10,0)
 S ORA0=$G(^OR(100,+IFN,8,AIFN,0)),ACTSTS=$P(ORA0,U,15)
"RTN","ORCACT0",11,0)
 S ORDSTS=$P(OR3,U,3),VER=$S($P(OR0,U,5)["101.41":3,1:2)
"RTN","ORCACT0",12,0)
CM I ACTION="CM" S ERROR="This action is no longer available!" G VQ ; ward comments - no restrictions
"RTN","ORCACT0",13,0)
FL I ACTION="FL" D  G VQ ; flag
"RTN","ORCACT0",14,0)
 . I +$G(^OR(100,+IFN,8,AIFN,3)) S ERROR="This order is already flagged!" Q
"RTN","ORCACT0",15,0)
UF I ACTION="UF" D  G VQ ; unflag
"RTN","ORCACT0",16,0)
 . I '+$G(^OR(100,+IFN,8,AIFN,3)) S ERROR="This order is not flagged!" Q
"RTN","ORCACT0",17,0)
DC1 I ACTION="DC",ACTSTS D  G VQ ; discontinue/cancel unrel or canc order
"RTN","ORCACT0",18,0)
 . I (ACTSTS=11)!(ACTSTS=10) D  Q  ; unreleased
"RTN","ORCACT0",19,0)
 .. I 'MEDPARM S ERROR="You are not authorized to cancel med orders!" Q
"RTN","ORCACT0",20,0)
 .. I $G(NATR)="A" S X=$O(^ORE(100.2,"AO",+IFN,0)) I X,'$G(^ORE(100.2,X,1)) S ERROR="Future event orders may not be auto-discontinued!" Q
"RTN","ORCACT0",21,0)
 . I ACTSTS=12 S ERROR="This order has been dc'd due to edit!" Q
"RTN","ORCACT0",22,0)
 . I ACTSTS=13 S ERROR="This order has been cancelled!" Q
"RTN","ORCACT0",23,0)
ES I (ACTION="ES")!(ACTION="OC")!(ACTION="RS")!(ACTION="DS") D ES^ORCACT01 G VQ ; sign
"RTN","ORCACT0",24,0)
VR I ACTION="VR" D  G VQ ; verify
"RTN","ORCACT0",25,0)
 . I $G(ORVER)="N",$P(ORA0,U,9) S ERROR="This order has been verified!" Q
"RTN","ORCACT0",26,0)
 . I $G(ORVER)="C",$P(ORA0,U,11) S ERROR="This order has been verified!" Q
"RTN","ORCACT0",27,0)
 . I $G(ORVER)="R",$P(ORA0,U,19) S ERROR="This order has been reviewed!" Q
"RTN","ORCACT0",28,0)
 . I (ACTSTS=11)!(ACTSTS=10) S ERROR="This order has not been released to the service." Q
"RTN","ORCACT0",29,0)
 . I AIFN=1,ORDSTS=5,PKG="PS" S X=$$DISABLED I X S ERROR=$P(X,U,2) Q
"RTN","ORCACT0",30,0)
DIS S X=$$DISABLED I X S ERROR=$P(X,U,2) G VQ
"RTN","ORCACT0",31,0)
MN I ACTION="MN" D  G VQ ; manually release (delayed)
"RTN","ORCACT0",32,0)
 . I ACTSTS'=10,ACTSTS'=11 S ERROR="This order has already been released!" Q
"RTN","ORCACT0",33,0)
 . I $P(OR0,U,12)="I",'$G(^DPT(+ORVP,.105)) S ERROR="This patient is not currently admitted!"
"RTN","ORCACT0",34,0)
GMRA I PKG="GMRA" S ERROR="This action is not allowed on an allergy/adverse reaction!" G VQ ; no actions allowed on Allergies
"RTN","ORCACT0",35,0)
MEDS I PKG="PS",'MEDPARM S ERROR="You are not authorized to enter med orders!" G VQ
"RTN","ORCACT0",36,0)
RW I ACTION="RW" D RW^ORCACT01 G VQ ; rewrite/copy
"RTN","ORCACT0",37,0)
XFR I ACTION="XFR" D XFR^ORCACT01 G VQ ; transfer to in/outpt
"RTN","ORCACT0",38,0)
RN I ACTION="RN" D RN^ORCACT01 G VQ ; renew
"RTN","ORCACT0",39,0)
TRM I $$DONE G VQ ; ORDSTS=1,2,7,12,13
"RTN","ORCACT0",40,0)
EV I ACTION="EV" D  G VQ ; change delay event
"RTN","ORCACT0",41,0)
 . I ORDSTS'=10,ORDSTS'=11 S ERROR="This order has been released!" Q
"RTN","ORCACT0",42,0)
 . I DG="NV RX" S ERROR="Non-VA Med orders do not support this action!" Q
"RTN","ORCACT0",43,0)
 . I $$EVTORDER^OREVNTX(IFN) S ERROR="The release event for this order may not be changed!" Q
"RTN","ORCACT0",44,0)
 . S X=$P(ORA0,U,4) I X'=2,X'=3 S ERROR="Signed orders may not be delayed to another event!" Q
"RTN","ORCACT0",45,0)
DC2 I ACTION="DC",ACTSTS="" D  G VQ ; DC released order
"RTN","ORCACT0",46,0)
 . I $G(NATR)="A" D  Q:$D(ERROR)
"RTN","ORCACT0",47,0)
 .. S X=$O(^ORE(100.2,"AO",+IFN,0)) I X S:'$G(^ORE(100.2,X,1)) ERROR="Future event orders may not be auto-discontinued!" Q
"RTN","ORCACT0",48,0)
 .. I $$GET1^DIQ(9.4,+$P(OR0,U,14)_",",1)="PSO",$G(DGPMT)=1 Q  ;177 If admission auto-dc and order is outpt med then no further checking needed
"RTN","ORCACT0",49,0)
 .. I $G(DGPMT)=1,$P($G(^SC(+$P(OR0,U,10),0)),U,3)'="C" S ERROR="Only outpatient orders may be auto-discontinued!" Q
"RTN","ORCACT0",50,0)
 .. I $G(DGPMT)'=1,$P($G(^SC(+$P(OR0,U,10),0)),U,3)="C",PKG'="PS" S ERROR="Only inpatient orders may be auto-discontinued!" Q
"RTN","ORCACT0",51,0)
 . I PKG="RA",ORDSTS=6 S ERROR="Active Radiology orders cannot be discontinued!" Q
"RTN","ORCACT0",52,0)
 . I PKG="VBEC",ORDSTS=6 S ERROR="Active Blood Product orders cannot be discontinued!" Q
"RTN","ORCACT0",53,0)
 . I PKG="LR" D  Q
"RTN","ORCACT0",54,0)
 .. I $$COLLECTD S ERROR="Lab orders that have been collected may not be discontinued!" Q
"RTN","ORCACT0",55,0)
 .. I $G(NATR)="A","^12^38^"'[(U_$P($G(DGPMA),U,18)_U),$$VALUE^ORX8(+IFN,"COLLECT")="SP",$P(OR0,U,8)'<DT S ERROR="Future Send Patient orders may not be auto-discontinued!" Q
"RTN","ORCACT0",56,0)
 . I PKG="GMRC",ORDSTS=9 S ERROR="Consults orders with partial results cannot be discontinued!" Q
"RTN","ORCACT0",57,0)
 . I DG="DO",$G(DGPMT)'=3,ORDSTS=6,'$$NPO(+IFN) S ERROR="Active Diets cannot be discontinued; please order a new diet!" Q
"RTN","ORCACT0",58,0)
RL I ACTION="RL" D  G VQ  ; release hold
"RTN","ORCACT0",59,0)
 . I ORDSTS'=3 D  Q
"RTN","ORCACT0",60,0)
 ..I $P(ORA0,U,4)=2 S ERROR="Providers has not yet signed the hold order and therefor it cannot yet be released" Q
"RTN","ORCACT0",61,0)
 ..S ERROR="Orders not on hold cannot be released!" Q
"RTN","ORCACT0",62,0)
 . I ACTSTS S ERROR=$$ACTION($P(ORA0,U,2))_" orders cannot be released from hold!" Q
"RTN","ORCACT0",63,0)
 . N NATR,ACT S ACT=$S($P(ORA0,U,2)="HD":AIFN,1:+$P(OR3,U,7))
"RTN","ORCACT0",64,0)
 . S NATR=+$P($G(^OR(100,+IFN,8,ACT,0)),U,12),ACT=$P($G(^(0)),U,2)
"RTN","ORCACT0",65,0)
 . I PKG="RA"!(ACT'="HD")!($P($G(^ORD(100.02,NATR,0)),U,2)="S") S ERROR="Orders held by a service must be released from hold through the service!" Q
"RTN","ORCACT0",66,0)
AIFN S X=$P(ORA0,U,2) I AIFN>1,ACTSTS S ERROR="This action is not allowed on a "_$$ACTION(X)_" order!" G VQ
"RTN","ORCACT0",67,0)
RF I ACTION="RF" D  G VQ
"RTN","ORCACT0",68,0)
 . I DG'="O RX" S ERROR="Only Outpatient Med orders may be refilled!" Q
"RTN","ORCACT0",69,0)
 . I ORDSTS=5 S ERROR="Pending orders may not be refilled!" Q
"RTN","ORCACT0",70,0)
 . I ORDSTS=7 S ERROR="Expired orders may not be refilled!" Q
"RTN","ORCACT0",71,0)
 . N X,PSIFN S PSIFN=$G(^OR(100,+IFN,4))
"RTN","ORCACT0",72,0)
 . S X=$$REFILL^PSOREF(PSIFN) I X'>0 S ERROR=$P(X,U,2) Q
"RTN","ORCACT0",73,0)
CP I ACTION="CP" D  G VQ ; complete
"RTN","ORCACT0",74,0)
 . I PKG'="OR" S ERROR="Only generic text orders may be completed through this option!" Q
"RTN","ORCACT0",75,0)
 . I ORDSTS=11!(ORDSTS=10) S ERROR="This order has not been released!" Q
"RTN","ORCACT0",76,0)
AL I ACTION="AL" D  G VQ
"RTN","ORCACT0",77,0)
 . I PKG'="LR",PKG'="RA",PKG'="GMRC" S ERROR="This order does not generate results!" Q
"RTN","ORCACT0",78,0)
 . I $P(OR3,U,10) S ERROR="This order is already flagged to alert the provider when resulted!" Q
"RTN","ORCACT0",79,0)
XX I ACTION="XX" D  G VQ ; edit/change
"RTN","ORCACT0",80,0)
 . I ORDSTS=7 S ERROR="Expired orders may not be changed!" Q
"RTN","ORCACT0",81,0)
 . D XX^ORCACT01
"RTN","ORCACT0",82,0)
HD I ACTION="HD" D  G VQ ; hold
"RTN","ORCACT0",83,0)
 . I PKG="FH" S ERROR="Diet orders cannot be held!" Q
"RTN","ORCACT0",84,0)
 . I PKG="LR" S ERROR="Lab orders cannot be held!" Q
"RTN","ORCACT0",85,0)
 . I PKG="RA" S ERROR="Radiology orders cannot be held!" Q
"RTN","ORCACT0",86,0)
 . I PKG="GMRC" S ERROR="Consult orders cannot be held!" Q
"RTN","ORCACT0",87,0)
 . I DG="NV RX" S ERROR="Non-VA Med orders cannot be held!" Q
"RTN","ORCACT0",88,0)
 . I ORDSTS=3 S ERROR="This order is already on hold!" Q
"RTN","ORCACT0",89,0)
 . I ORDSTS'=6,PKG="PS" S ERROR="Only active Pharmacy orders may be held!" Q
"RTN","ORCACT0",90,0)
 . I (ORDSTS=11)!(ORDSTS=10) S ERROR="This order has not been released to the service." Q
"RTN","ORCACT0",91,0)
VQ S Y=$S($D(ERROR):0,1:1)
"RTN","ORCACT0",92,0)
 Q Y
"RTN","ORCACT0",93,0)
 ;
"RTN","ORCACT0",94,0)
ACTION(X) ; -- Return text of action X
"RTN","ORCACT0",95,0)
 N Y S Y=$S(X="NW":"New",X="DC":"Discontinue",X="HD":"Hold",X="RL":"Release Hold",X="RN":"Renew",1:X)
"RTN","ORCACT0",96,0)
 Q Y
"RTN","ORCACT0",97,0)
 ;
"RTN","ORCACT0",98,0)
NPO(ORIFN) ; -- Returns 1 or 0, if order ORIFN is for NPO
"RTN","ORCACT0",99,0)
 N X,Y S X=$$VALUE^ORX8(+ORIFN,"ORDERABLE",1,"E")
"RTN","ORCACT0",100,0)
 S Y=$S($E(X,1,3)="NPO":1,1:0)
"RTN","ORCACT0",101,0)
 Q Y
"RTN","ORCACT0",102,0)
 ;
"RTN","ORCACT0",103,0)
COLLECTD() ; -- Lab order collected/active (incl all children)?
"RTN","ORCACT0",104,0)
 I (ORDSTS=11)!(ORDSTS=10) Q 0 ; unreleased
"RTN","ORCACT0",105,0)
 I '$O(^OR(100,+IFN,2,0)) Q (ORDSTS'=5)
"RTN","ORCACT0",106,0)
 ;I ORDSTS'=6 Q 1 ; Parent -> active instead of pending
"RTN","ORCACT0",107,0)
 N Y,Z S Y=1,Z=0
"RTN","ORCACT0",108,0)
 F  S Z=$O(^OR(100,+IFN,2,Z)) Q:Z'>0  I $P($G(^OR(100,Z,3)),U,3)=5 S Y=0 Q
"RTN","ORCACT0",109,0)
 Q Y
"RTN","ORCACT0",110,0)
 ;
"RTN","ORCACT0",111,0)
DONE() ; -- sets ERROR if terminal status
"RTN","ORCACT0",112,0)
 I ORDSTS=1 S ERROR="This order has been discontinued!" Q 1
"RTN","ORCACT0",113,0)
 I ORDSTS=2 S ERROR="This order has been completed!" Q 1
"RTN","ORCACT0",114,0)
 I ORDSTS=7,DG'="O RX" S ERROR="This order has expired!" Q 1
"RTN","ORCACT0",115,0)
 I ORDSTS=12 S ERROR="This order has been changed!" Q 1
"RTN","ORCACT0",116,0)
 I ORDSTS=13 S ERROR="This order has been cancelled!" Q 1
"RTN","ORCACT0",117,0)
 I ORDSTS=14 S ERROR="This order has lapsed!" Q 1
"RTN","ORCACT0",118,0)
 I ORDSTS=15 S ERROR="This order has been renewed!" Q 1
"RTN","ORCACT0",119,0)
 Q 0
"RTN","ORCACT0",120,0)
 ;
"RTN","ORCACT0",121,0)
DISABLED() ; -- Order dialog [or protocol] disabled?
"RTN","ORCACT0",122,0)
 N X,DLG S DLG=$P(OR0,U,5),X=0 I +DLG'>0 Q X
"RTN","ORCACT0",123,0)
 I VER'<3,DLG?1.N1";ORD(101.41," S X=$$MSG^ORXD(+DLG) Q X
"RTN","ORCACT0",124,0)
 S DLG=$S(PKG="RA":"RA OERR EXAM",PKG="GMRC":"GMRCOR CONSULT",1:"")
"RTN","ORCACT0",125,0)
 I $L(DLG) S DLG=+$O(^ORD(101.41,"AB",DLG,0)),X=$$MSG^ORXD(DLG)
"RTN","ORCACT0",126,0)
 Q X
"RTN","ORCACT01")
0^105^B66127888
"RTN","ORCACT01",1,0)
ORCACT01 ;SLC/MKB-Validate order actions cont ;03/28/2008
"RTN","ORCACT01",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**94,116,134,141,163,187,190,213,243**;Dec 17, 1997;Build 242
"RTN","ORCACT01",3,0)
 ;
"RTN","ORCACT01",4,0)
ES ; -- sign [on chart]
"RTN","ORCACT01",5,0)
 I ORDSTS=11,VER<3,PKG'="OR" S ERROR="This order cannot be released and must be discontinued!" Q
"RTN","ORCACT01",6,0)
 N X I ACTSTS=11!(ACTSTS=10) D  Q:$L($G(ERROR))
"RTN","ORCACT01",7,0)
 . I $P(ORA0,U,2)="DC",$$DONE^ORCACT0 D CANCEL^ORCSEND(+IFN),UNOTIF^ORCSIGN S OREBUILD=1 Q
"RTN","ORCACT01",8,0)
 . S X=$$DISABLED^ORCACT0 I X S ERROR=$P(X,U,2) Q
"RTN","ORCACT01",9,0)
 I ACTION="OC",$G(DG)="NV RX" S:MEDPARM<2 ERROR="You are not authorized to release non-VA med orders!" Q
"RTN","ORCACT01",10,0)
 S X=$P(ORA0,U,4) I X=3 S:ACTSTS'=11&(ACTSTS'=10) ERROR="This order does not require a signature!" Q
"RTN","ORCACT01",11,0)
 I X'=2 S ERROR="This order has been signed!" Q
"RTN","ORCACT01",12,0)
 I DG="O RX",ACTION'="ES",ACTION'="DS",$G(NATR)'="I" S ERROR="Outpatient meds may not be released without a clinician's signature!" Q
"RTN","ORCACT01",13,0)
 I (ACTION="ES"!(ACTION="DS")),$D(^XUSEC("ORELSE",DUZ)),$P(OR0,U,16)'<2 S ERROR="You are not privileged to sign this order!" Q
"RTN","ORCACT01",14,0)
 I ACTION="OC" S:MEDPARM<2 ERROR="You are not authorized to release med orders!" Q
"RTN","ORCACT01",15,0)
 I ACTION="RS" D  Q:$D(ERROR)  Q:$G(NATR)'="I"
"RTN","ORCACT01",16,0)
 . Q:ACTSTS=11  Q:ACTSTS=10  ;unreleased - ok
"RTN","ORCACT01",17,0)
 . S ERROR="This order has already been released!"
"RTN","ORCACT01",18,0)
ES1 I PKG="PS" D  ;authorized to write meds?
"RTN","ORCACT01",19,0)
 . N TYPE,OI,PSOI,DEAFLG,PKI,IVERROR
"RTN","ORCACT01",20,0)
 . S X=$G(^VA(200,DUZ,"PS"))
"RTN","ORCACT01",21,0)
 . I '$P(X,U) S ERROR="You are not authorized to sign med orders!" Q
"RTN","ORCACT01",22,0)
 . I $P(X,U,4),$$NOW^XLFDT>$P(X,U,4) S ERROR="You are no longer authorized to sign med orders!" Q
"RTN","ORCACT01",23,0)
 . ;Q:DG="IV RX"  Q:$P(ORA0,U,2)="DC"  ;don't need to ck DEA#
"RTN","ORCACT01",24,0)
 . Q:$P(ORA0,U,2)="DC"
"RTN","ORCACT01",25,0)
 . I DG="IV RX" D  Q
"RTN","ORCACT01",26,0)
 . .I $$IVDEACHK(+IFN)=1 S ERROR="You must have a valid DEA# or VA# to sign this order!"
"RTN","ORCACT01",27,0)
 . S OI=+$$VALUE^ORX8(+IFN,"ORDERABLE")
"RTN","ORCACT01",28,0)
 . S PSOI=+$P($G(^ORD(101.43,OI,0)),U,2) Q:PSOI'>0
"RTN","ORCACT01",29,0)
 . S TYPE=$S($P(DG," ")="O":"O",1:"I"),DEAFLG=$$OIDEA^PSSUTLA1(PSOI,TYPE)
"RTN","ORCACT01",30,0)
 . I (DEAFLG>0||$$ISCLOZ^ORALWORD(OI)),'$L($$DEA^XUSER()) S ERROR="You must have a valid DEA# or VA# to sign this order!" Q
"RTN","ORCACT01",31,0)
 . D PKISITE^ORWOR(.PKI)
"RTN","ORCACT01",32,0)
 . I $G(PKI),ACTION="RS",DEAFLG=1 S ERROR="This order cannot be released without a Digital Signature" Q
"RTN","ORCACT01",33,0)
 Q
"RTN","ORCACT01",34,0)
 ;
"RTN","ORCACT01",35,0)
IVDEACHK(IFN) ; -- Returns value of prompt by ID
"RTN","ORCACT01",36,0)
 I '$G(IFN)!('$D(^OR(100,+$G(IFN),0))) Q ""
"RTN","ORCACT01",37,0)
 N I,DIAL,DIALTYP,FAIL,PATCLASS,RESULT,Y
"RTN","ORCACT01",38,0)
 S PATCLASS=$P(^OR(100,+IFN,0),U,12)
"RTN","ORCACT01",39,0)
 S RESULT=0
"RTN","ORCACT01",40,0)
 ;if ORNP is not set then assume this is called from VistA not CPRS
"RTN","ORCACT01",41,0)
 I $G(ORNP)="" S ORNP=DUZ
"RTN","ORCACT01",42,0)
 S I=0,Y="" S:'$G(INST) INST=1
"RTN","ORCACT01",43,0)
 F  S I=$O(^OR(100,+IFN,4.5,"ID","ORDERABLE",I)) Q:I'>0!(RESULT=1)  D
"RTN","ORCACT01",44,0)
 .S Y=$G(^OR(100,+IFN,4.5,I,1)) Q:Y'>0
"RTN","ORCACT01",45,0)
 .;S PSOI=+$P($G(^ORD(101.43,Y,0)),U,2) Q:PSOI'>0
"RTN","ORCACT01",46,0)
 .I PATCLASS="I" D  Q
"RTN","ORCACT01",47,0)
 ..D FAILDEA^ORWDPS1(.FAIL,Y,ORNP,"I") I FAIL=1 S RESULT=1
"RTN","ORCACT01",48,0)
 .S DIAL=+$P(^OR(100,+IFN,4.5,I,0),U,2)
"RTN","ORCACT01",49,0)
 .S DIALTYP=$S($P(^ORD(101.41,DIAL,0),U)["ADDITIVE":"A",1:"S")
"RTN","ORCACT01",50,0)
 .D FDEA1^ORWDPS1(.FAIL,Y,DIALTYP,ORNP)
"RTN","ORCACT01",51,0)
 .I FAIL=1 S RESULT=1
"RTN","ORCACT01",52,0)
 .;I $$OIDEA^PSSUTLA1(PSOI,"I")>0 S RESULT=1 Q
"RTN","ORCACT01",53,0)
 Q RESULT
"RTN","ORCACT01",54,0)
 ;
"RTN","ORCACT01",55,0)
XFR ; -- transfer to inpt/outpt [IFN=order to be transferred]
"RTN","ORCACT01",56,0)
 N OI,PS I DG="TPN" S ERROR="TPN orders may not be copied!" Q
"RTN","ORCACT01",57,0)
 I $$INACTIVE^ORCACT03 S ERROR="Orders for inactive orderables may not be transferred; please enter a new order!" Q
"RTN","ORCACT01",58,0)
 S OI=+$O(^OR(100,+IFN,.1,"B",0)),ORPS=$G(^ORD(101.43,OI,"PS"))
"RTN","ORCACT01",59,0)
 I DG="UD RX",'$P(ORPS,U,2) S ERROR="This drug may not be ordered for an outpatient!" Q
"RTN","ORCACT01",60,0)
 I DG="O RX" D  Q:$L($G(ERROR))
"RTN","ORCACT01",61,0)
 . I '$P(ORPS,U) S ERROR="This drug may not be ordered for an inpatient!" Q
"RTN","ORCACT01",62,0)
 . D:$O(^OR(100,+IFN,4.5,"ID","MISC",0)) DOSES^ORCACT02(+IFN)
"RTN","ORCACT01",63,0)
 Q
"RTN","ORCACT01",64,0)
 ;
"RTN","ORCACT01",65,0)
RW ; -- rewrite/copy
"RTN","ORCACT01",66,0)
 I ACTSTS=12 S ERROR="Orders that have been dc'd due to editing may not be copied!" Q
"RTN","ORCACT01",67,0)
 I DG="NV RX" S ERROR="Non-VA Med orders cannot be copied!" Q
"RTN","ORCACT01",68,0)
 I DG="TPN" S ERROR="TPN orders may not be rewritten!" Q
"RTN","ORCACT01",69,0)
 I DG="UD RX",$$NTBG^ORCACT03(+IFN) S ERROR="This order has been marked 'Not to be Given' and may not be rewritten!" Q
"RTN","ORCACT01",70,0)
 I $$INACTIVE^ORCACT03 S ERROR="Orders for inactive orderables may not be copied; please enter a new order!" Q
"RTN","ORCACT01",71,0)
 I PKG="PS",'$$MEDOK^ORCACT03 S ERROR="This drug may not be ordered!" Q
"RTN","ORCACT01",72,0)
 I DG="O RX",$O(^OR(100,+IFN,4.5,"ID","MISC",0)) D DOSES^ORCACT02(+IFN) ;old form
"RTN","ORCACT01",73,0)
 Q
"RTN","ORCACT01",74,0)
 ;
"RTN","ORCACT01",75,0)
RN ; -- renew
"RTN","ORCACT01",76,0)
 I PKG'="PS",PKG'="OR" S ERROR="This order may not be renewed!" Q
"RTN","ORCACT01",77,0)
 I (ORDSTS=11)!(ORDSTS=10) S ERROR="This order has not been released to the service." Q
"RTN","ORCACT01",78,0)
 I ACTSTS=12 S ERROR="Orders that have been dc'd due to editing may not be renewed!" Q
"RTN","ORCACT01",79,0)
 I $P(OR3,U,6) S ERROR="This order has already been "_$S($P($G(^OR(100,+$P(OR3,U,6),3)),U,11)=1:"changed!",1:"renewed!") Q
"RTN","ORCACT01",80,0)
 I PKG="OR" D  Q  ;Generic orders
"RTN","ORCACT01",81,0)
 . I $$INACTIVE^ORCACT03 S ERROR="Orders for inactive orderables may not be renewed!" Q
"RTN","ORCACT01",82,0)
 . I DG="ADT" S ERROR="M.A.S. orders may not be renewed!" Q
"RTN","ORCACT01",83,0)
 . I "^1^2^6^7^"[(U_ORDSTS_U) Q  ;ok
"RTN","ORCACT01",84,0)
 . S ERROR="This order may not be renewed!"
"RTN","ORCACT01",85,0)
 I (PKG="PS"),$$INACTIVE^ORCACT03 S ERROR="Orders for inactive orderables may not be renewed!" Q
"RTN","ORCACT01",86,0)
 I '$$MEDOK^ORCACT03 S ERROR="This drug may not be ordered!" Q
"RTN","ORCACT01",87,0)
RN1 N PSIFN S PSIFN=$G(^OR(100,+IFN,4))
"RTN","ORCACT01",88,0)
 I PSIFN<1,'$O(^OR(100,+IFN,2,0)) S ERROR="Missing or invalid order number!" Q
"RTN","ORCACT01",89,0)
 I DG="O RX" D  Q  ;Outpt Meds
"RTN","ORCACT01",90,0)
 . N ORZ,ORD S ORZ=$L($T(RENEW^PSORENW),",")
"RTN","ORCACT01",91,0)
 . I ORZ>1 S ORD=+$$VALUE^ORX8(+IFN,"DRUG"),X=$$RENEW^PSORENW(PSIFN,ORD)
"RTN","ORCACT01",92,0)
 . S:ORZ'>1 X=$$RENEW^PSORENW(PSIFN) I X<1 S ERROR=$P(X,U,2) Q
"RTN","ORCACT01",93,0)
 . S X=+$P(X,U,2) D:X RESET^ORCACT03(+IFN,X)
"RTN","ORCACT01",94,0)
 . I $O(^OR(100,+IFN,4.5,"ID","MISC",0)) D DOSES^ORCACT02(+IFN) ;old format
"RTN","ORCACT01",95,0)
 I DG="UD RX",$$NTBG^ORCACT03(+IFN) S ERROR="This order has been marked 'Not to be Given' and may not be renewed!" Q
"RTN","ORCACT01",96,0)
 I ORDSTS=7,'$$IV^ORCACT03,$P(OR0,U,9)<$$FMADD^XLFDT(DT,-4)  S ERROR="Inpatient med orders may not be renewed more than 4 days after expiration!" Q
"RTN","ORCACT01",97,0)
 I ORDSTS'=6,ORDSTS'=7 S ERROR="This order may not be renewed!" Q
"RTN","ORCACT01",98,0)
RN2 I $O(^OR(100,+IFN,2,0))!$P(OR3,U,9) D  Q:$D(ERROR)!'PSIFN
"RTN","ORCACT01",99,0)
 . I $P(OR3,U,9),$$VALUE^ORX8(+IFN,"SCHEDULE",1,"E")="NOW" S ERROR="One-time NOW orders may not be renewed!" Q
"RTN","ORCACT01",100,0)
 . N DAD,ORD3,I,Y S DAD=$S($P(OR3,U,9):+$P(OR3,U,9),1:+IFN),Y=0
"RTN","ORCACT01",101,0)
 . S ORD3=$G(^OR(100,DAD,3)) I $P(ORD3,U,6) S ERROR="This complex order has already been renewed!" Q
"RTN","ORCACT01",102,0)
 . I $P(ORD3,U,3)'=6 S ERROR="This complex order is not active and may not be renewed!" Q
"RTN","ORCACT01",103,0)
 . I '$$AND^ORX8(DAD) S ERROR="Complex orders with sequential doses may not be renewed!" Q
"RTN","ORCACT01",104,0)
 . S I=0 F  S I=+$O(^OR(100,DAD,2,I)) Q:I<1  D  Q:Y
"RTN","ORCACT01",105,0)
 .. I I=+$O(^OR(100,DAD,2,0)),$$VALUE^ORX8(I,"SCHEDULE",1,"E")="NOW",$$VALUE^ORX8(DAD,"NOW") Q  ;ignore NOW orders
"RTN","ORCACT01",106,0)
 .. I $P($G(^OR(100,I,3)),U,3)'=6 S Y=1,ERROR="Complex orders with terminated doses may not be renewed!" Q
"RTN","ORCACT01",107,0)
 .. I PSIFN<1 S X=$$ACTIVE^PSJORREN(+ORVP,$G(^OR(100,I,4))) I +X'=1 S ERROR="This order may not be renewed: "_$S(+X>1:"Inactive orderable item",1:$P(X,U,2)) Q
"RTN","ORCACT01",108,0)
 ;I DG="TPN" S ERROR="TPN orders may not be renewed!" Q
"RTN","ORCACT01",109,0)
 S X=$$ACTIVE^PSJORREN(+ORVP,PSIFN) Q:+X=1  ;Ok
"RTN","ORCACT01",110,0)
 I +X>1,$P(X,U,2) D RESET^ORCACT03(+IFN,+$P(X,U,2)) Q  ;replace OI
"RTN","ORCACT01",111,0)
 S ERROR="This order may not be renewed: "_$P(X,U,2)
"RTN","ORCACT01",112,0)
 Q
"RTN","ORCACT01",113,0)
 ;
"RTN","ORCACT01",114,0)
XX ; -- edit/change--
"RTN","ORCACT01",115,0)
 I PKG="RA",ORDSTS'=11,ORDSTS'=10 S ERROR="Orders released to Radiology cannot be changed!" Q
"RTN","ORCACT01",116,0)
 I PKG="LR",ORDSTS'=11,ORDSTS'=10 S ERROR="Orders released to Lab cannot be changed!" Q
"RTN","ORCACT01",117,0)
 I PKG="FH",ORDSTS'=11,ORDSTS'=10 S ERROR="Orders released to Dietetics cannot be changed!" Q
"RTN","ORCACT01",118,0)
 I PKG="GMRC",ORDSTS'=11,ORDSTS'=10 S ERROR="Orders released to Consults cannot be changed!" Q
"RTN","ORCACT01",119,0)
 I DG="TPN" S ERROR="TPN orders may not be changed!" Q
"RTN","ORCACT01",120,0)
 I ORDSTS=3 S ERROR="Orders on hold may not be changed!" Q
"RTN","ORCACT01",121,0)
 I DG="UD RX",$$NTBG^ORCACT03(+IFN) S ERROR="This order has been marked 'Not to be Given' and may not be changed!" Q
"RTN","ORCACT01",122,0)
 I $O(^OR(100,+IFN,2,0)) S ERROR="Complex orders may not be changed!" Q
"RTN","ORCACT01",123,0)
 I $P(OR3,U,9) D  Q:$D(ERROR)
"RTN","ORCACT01",124,0)
 . Q:$$VALUE^ORX8(+IFN,"SCHEDULE",1,"E")="NOW"  ;NOW ok
"RTN","ORCACT01",125,0)
 . Q:'$O(^OR(100,+$P(OR3,U,9),4.5,"ID","CONJ",0))  ;no conj=1dose/ok
"RTN","ORCACT01",126,0)
 . S ERROR="Complex orders may not be changed!" Q
"RTN","ORCACT01",127,0)
 I $P(OR3,U,6) S ERROR="This order may not be changed - a "_$S($P($G(^OR(100,+$P(OR3,U,6),3)),U,11)=1:"change",1:"renewal")_" order already exists!" Q
"RTN","ORCACT01",128,0)
 I $P(OR3,U,11)=2 D  Q:$D(ERROR)
"RTN","ORCACT01",129,0)
 . I (ORDSTS=10!(ORDSTS=11)),DG'="O RX" S ERROR="Unreleased renewals may not be changed!" Q
"RTN","ORCACT01",130,0)
 . I PKG="PS",ORDSTS=5 S ERROR="Pending renewals may not be changed!" Q
"RTN","ORCACT01",131,0)
 I $$INACTIVE^ORCACT03 S ERROR="Orders for inactive orderables may not be changed; please enter a new order!" Q
"RTN","ORCACT01",132,0)
 I PKG="PS",'$$MEDOK^ORCACT03 S ERROR="This drug may not be ordered!" Q
"RTN","ORCACT01",133,0)
 I DG="O RX",$O(^OR(100,+IFN,4.5,"ID","MISC",0)) D DOSES^ORCACT02(+IFN) ;old form
"RTN","ORCACT01",134,0)
 Q
"RTN","ORCACT01",135,0)
 ;
"RTN","ORCACT03")
0^144^B8066015
"RTN","ORCACT03",1,0)
ORCACT03 ;SLC/MKB-Validate order actions cont ;02/06/2007
"RTN","ORCACT03",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORCACT03",3,0)
 ;
"RTN","ORCACT03",4,0)
INACTIVE() ; -- Returns 1 or 0, if OI is now inactive
"RTN","ORCACT03",5,0)
 N I,OI,PREOI,PREOIX,X,Y,ORNOW,DD,PSOI S Y=0,ORNOW=$$NOW^XLFDT
"RTN","ORCACT03",6,0)
 S I=0 F  S I=+$O(^OR(100,+IFN,4.5,"ID","ORDERABLE",I)) Q:I'>0  D  Q:Y
"RTN","ORCACT03",7,0)
 . S OI=+$G(^OR(100,+IFN,4.5,I,1))
"RTN","ORCACT03",8,0)
 . I OI S X=$G(^ORD(101.43,OI,.1)) I X,X<ORNOW S Y=1
"RTN","ORCACT03",9,0)
 I Y,PKG="PS",DG'="IV RX" D  ;replacement OI?
"RTN","ORCACT03",10,0)
 . S I=+$O(^OR(100,+IFN,4.5,"ID","DRUG",0)) Q:I'>0  ;first
"RTN","ORCACT03",11,0)
 . S DD=+$G(^OR(100,+IFN,4.5,I,1)) Q:DD'>0  Q:$G(OI)'>0
"RTN","ORCACT03",12,0)
 . S PSOI=+$P($G(^ORD(101.43,OI,0)),U,2),X=$$ITEM^PSSUTIL1(PSOI,DD)
"RTN","ORCACT03",13,0)
 . Q:X'>0  S X=+$O(^ORD(101.43,"ID",+$P(X,U,2)_";99PSP",0)) Q:X'>0
"RTN","ORCACT03",14,0)
 . I $G(^ORD(101.43,X,.1)),$G(^(.1))<ORNOW Q  ;make sure new OI is active
"RTN","ORCACT03",15,0)
 . S I=+$O(^OR(100,+IFN,4.5,"ID","ORDERABLE",0))
"RTN","ORCACT03",16,0)
 . IF I D
"RTN","ORCACT03",17,0)
 . . S PREOI=$G(^OR(100,+IFN,4.5,I,1))
"RTN","ORCACT03",18,0)
 . . S PREOIX=$O(^OR(100,+IFN,.1,"B",PREOI,0))
"RTN","ORCACT03",19,0)
 . . K ^OR(100,+IFN,.1,"B",PREOI,PREOIX)
"RTN","ORCACT03",20,0)
 . . S ^OR(100,+IFN,.1,"B",X,PREOIX)=""
"RTN","ORCACT03",21,0)
 . . S ^OR(100,+IFN,.1,PREOIX,0)=X
"RTN","ORCACT03",22,0)
 . . S ^OR(100,+IFN,4.5,I,1)=X
"RTN","ORCACT03",23,0)
 . . S Y=0 ;reset
"RTN","ORCACT03",24,0)
 Q Y
"RTN","ORCACT03",25,0)
 ;
"RTN","ORCACT03",26,0)
MEDOK() ; -- Returns 1 or 0, if med OI usage=Y
"RTN","ORCACT03",27,0)
 N Y,OI,ORPS,X S Y=1,X=$P(OR0,U,12)
"RTN","ORCACT03",28,0)
 I (DG="SPLY")!(DG="O RX")!(DG="I RX")!(DG="UD RX") D
"RTN","ORCACT03",29,0)
 . S OI=+$O(^OR(100,+IFN,4.5,"ID","ORDERABLE",0))
"RTN","ORCACT03",30,0)
 . S OI=+$G(^OR(100,+IFN,4.5,OI,1))
"RTN","ORCACT03",31,0)
 . S ORPS=$G(^ORD(101.43,OI,"PS"))
"RTN","ORCACT03",32,0)
 I DG="SPLY",'$P(ORPS,U,5) S Y=0
"RTN","ORCACT03",33,0)
 I DG="O RX",'(X="O"&$P(ORPS,U,2)),'(X="I"&($P(ORPS,U)=2)) S Y=0
"RTN","ORCACT03",34,0)
 I DG="I RX"!(DG="UD RX"),'$P(ORPS,U) S Y=0
"RTN","ORCACT03",35,0)
 I DG="IV RX" D
"RTN","ORCACT03",36,0)
 . N I,X0,X1 S I=0
"RTN","ORCACT03",37,0)
 . F  S I=+$O(^OR(100,+IFN,4.5,"ID","ORDERABLE",I)) Q:I<1  D  Q:Y<1
"RTN","ORCACT03",38,0)
 .. S X0=$G(^OR(100,+IFN,4.5,I,0)),X1=+$G(^(1))
"RTN","ORCACT03",39,0)
 .. I $P($G(^ORD(101.41,+$P(X0,U,2),0)),U)["ADDITIVE" S:'$P($G(^ORD(101.43,X1,"PS")),U,4) Y=0 Q
"RTN","ORCACT03",40,0)
 .. S:'$P($G(^ORD(101.43,X1,"PS")),U,3) Y=0
"RTN","ORCACT03",41,0)
 Q Y
"RTN","ORCACT03",42,0)
 ;
"RTN","ORCACT03",43,0)
IV() ; -- IV order, either Inpt or Fluid?
"RTN","ORCACT03",44,0)
 I DG="IV RX" Q 1
"RTN","ORCACT03",45,0)
 N I,OI,X S I=+$O(^OR(100,IFN,4.5,"ID","ORDERABLE",0))
"RTN","ORCACT03",46,0)
 S OI=+$G(^OR(100,IFN,4.5,+I,1)),X=$P($G(^ORD(101.43,+OI,"PS")),U)
"RTN","ORCACT03",47,0)
 Q (X>1)
"RTN","ORCACT03",48,0)
 ;
"RTN","ORCACT03",49,0)
NTBG(ORIFN) ; -- Inpt order marked as 'Not to be Given'?
"RTN","ORCACT03",50,0)
 N PSIFN,Y,ORI,ORCH S Y=""
"RTN","ORCACT03",51,0)
 S PSIFN=$G(^OR(100,+ORIFN,4)) I PSIFN>0 Q $$ENNG^PSJORUT2(+ORVP,PSIFN)
"RTN","ORCACT03",52,0)
 S ORI=0 F  S ORI=$O(^OR(100,+ORIFN,2,ORI)) Q:ORI'>0  S ORCH=+$G(^(ORI,0)),PSIFN=$G(^OR(100,ORCH,4)) I PSIFN>0 S Y=$$ENNG^PSJORUT2(+ORVP,PSIFN) Q:Y
"RTN","ORCACT03",53,0)
 Q Y
"RTN","ORCACT03",54,0)
 ;
"RTN","ORCACT03",55,0)
RESET(IFN,NEWOI)   ; -- Update OI if changed before renewing
"RTN","ORCACT03",56,0)
 Q:'$G(IFN)  Q:'$D(^OR(100,+IFN,0))  Q:'$G(NEWOI)
"RTN","ORCACT03",57,0)
 N I,ORIT S ORIT=+$O(^ORD(101.43,"ID",NEWOI_";99PSP",0)) Q:ORIT'>0
"RTN","ORCACT03",58,0)
 S I=$O(^OR(100,+IFN,4.5,"ID","ORDERABLE",0))
"RTN","ORCACT03",59,0)
 S:I ^OR(100,+IFN,4.5,I,1)=ORIT
"RTN","ORCACT03",60,0)
 Q
"RTN","ORCACT2")
0^18^B61910854
"RTN","ORCACT2",1,0)
ORCACT2 ;SLC/MKB-DC orders ; 03/27/2007
"RTN","ORCACT2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,48,79,92,108,94,141,149,265,243**;Dec 17, 1997;Build 242
"RTN","ORCACT2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ORCACT2",4,0)
DC ; -- start here with:
"RTN","ORCACT2",5,0)
 ;    ORNMBR = #,#,...,# of selected orders
"RTN","ORCACT2",6,0)
 ;
"RTN","ORCACT2",7,0)
 ;    OREBUILD defined on return if Orders tab needs to be rebuilt
"RTN","ORCACT2",8,0)
 ;
"RTN","ORCACT2",9,0)
 N ORACT,ORI,NMBR,ORQUIT,ORIFN,ORDC,OREVT,ORNATR,ORPTLK,ORLK,IDX,ORDITM,ORPRINT,ORERR,ORSTS,ORPRNT,ORCLNUP,ORDA,ORCREATE,OR0,OR3,OREASON,ORXNP,ORX S VALMBCK=""
"RTN","ORCACT2",10,0)
 S ORPTLK=$$LOCK^ORX2(+ORVP) I 'ORPTLK W !!,$C(7),$P(ORPTLK,U,2) H 2 Q
"RTN","ORCACT2",11,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("") G:'ORNMBR DCQ
"RTN","ORCACT2",12,0)
 D FREEZE^ORCMENU S ORACT="DC",VALMBCK="R" K OREBUILD
"RTN","ORCACT2",13,0)
DC1 F ORI=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",ORI) D:NMBR  Q:$D(ORQUIT)
"RTN","ORCACT2",14,0)
 . S IDX=$G(^TMP("OR",$J,ORTAB,"IDX",NMBR))
"RTN","ORCACT2",15,0)
 . S ORIFN=$S(ORTAB="MEDS":$P(IDX,U,4),1:$P(IDX,U)) Q:'ORIFN
"RTN","ORCACT2",16,0)
 . I '$D(^OR(100,+ORIFN,0)) W !,"This order has been deleted!" H 1 Q
"RTN","ORCACT2",17,0)
 . S:'$P(ORIFN,";",2) ORIFN=+ORIFN_";"_+$P($G(^OR(100,+ORIFN,3)),U,7)
"RTN","ORCACT2",18,0)
 . S ORDITM=$$ORDITEM(ORIFN) D SUBHDR(ORDITM)
"RTN","ORCACT2",19,0)
 . I '$$VALID^ORCACT0(ORIFN,ORACT,.ORERR) W !,ORERR H 1 Q
"RTN","ORCACT2",20,0)
 . S ORLK=$$LOCK1^ORX2(+ORIFN) I 'ORLK W !,$P(ORLK,U,2) H 1 Q
"RTN","ORCACT2",21,0)
 . S OR0=$G(^OR(100,+ORIFN,0)),OR3=$G(^(3)),ORSTS=$P($G(^(8,+$P(ORIFN,";",2),0)),U,15)
"RTN","ORCACT2",22,0)
 . S:$P(OR0,U,17) OREVT(+$P(OR0,U,17))="" ;ck event when done
"RTN","ORCACT2",23,0)
 . I (ORSTS=10)!(ORSTS=11) D UNREL Q  ;delete unreleased orders
"RTN","ORCACT2",24,0)
 . I $P(OR0,U,11)=$O(^ORD(100.98,"B","TF",0)),$P(OR3,U,3)=6 D RESUME(ORIFN) Q:$G(ORQUIT)
"RTN","ORCACT2",25,0)
DC2 . S ORDC(ORI)=ORIFN I $$NMSP^ORCD(+$P(OR0,U,14))="PS" S ORX=1 D  ;meds
"RTN","ORCACT2",26,0)
 .. I $P(OR3,U,9),$$VALUE^ORX8(+ORIFN,"SCHEDULE")'="NOW",$$DOSES^ORCACT4($P(OR3,U,9))>1 D
"RTN","ORCACT2",27,0)
 ... N I,X S ORDC("DAD",+$P(OR3,U,9),+ORIFN)=""
"RTN","ORCACT2",28,0)
 ... W !,$C(7),"This is part of a complex order, which will be discontinued in its entirety:"
"RTN","ORCACT2",29,0)
 ... S I=0 F  S I=$O(^OR(100,+$P(OR3,U,9),8,1,.1,I)) Q:I<1  S X=$G(^(I,0)) W:$$UP^XLFSTR(X)'=" FIRST DOSE NOW" !,X
"RTN","ORCACT2",30,0)
 .. N ORY,ORJ,ORV,ORTX,DA,DIK D DELAYED^ORX8(.ORY,+ORIFN) Q:ORY'>0
"RTN","ORCACT2",31,0)
 .. W !,+ORY_" delayed order(s) for the same medication were found:"
"RTN","ORCACT2",32,0)
 .. S ORJ=0 F  S ORJ=$O(ORY(ORJ)) Q:ORJ'>0  S ORV=ORY(ORJ) D TEXT^ORQ12(.ORTX,ORJ) W !,$E(ORTX(1),1,75)_$S($L(ORTX(1))>75:"...",1:""),!,"  >> delayed until "_$P(ORV,U,2)
"RTN","ORCACT2",33,0)
 .. I '$$OK(+ORY) W ! Q
"RTN","ORCACT2",34,0)
 .. W !,"Orders not signed or released to the service will be deleted.",!
"RTN","ORCACT2",35,0)
 .. S DIK="^OR(100,",DA=0 F  S DA=$O(ORY(DA)) Q:DA'>0  D
"RTN","ORCACT2",36,0)
 ... N ORJ,ORSIG,STS,ORLKD
"RTN","ORCACT2",37,0)
 ... S ORLKD=$$LOCK1^ORX2(+DA) I 'ORLKD W !,$P(ORLKD,U,2) H 1 Q
"RTN","ORCACT2",38,0)
 ... S STS=$P($G(^OR(100,DA,3)),U,3),ORSIG=$S($P($G(^(8,1,0)),U,4)=2:0,1:1)
"RTN","ORCACT2",39,0)
 ... I STS'=10 S ORDC($$NXT)=DA Q  ;released - add to list
"RTN","ORCACT2",40,0)
 ... D CLRDLY(DA):ORSIG,^DIK:'ORSIG S OREVT(+ORY(DA))=""
"RTN","ORCACT2",41,0)
 ... I $D(^TMP("ORNEW",$J,DA,1)) K ^(1) D UNLK1^ORX2(DA) ;unlock again
"RTN","ORCACT2",42,0)
 G:'$O(ORDC(0)) DCQ D:$D(ORDC("DAD")) COMPLX
"RTN","ORCACT2",43,0)
DC3 S OREASON=$$DCREASON I OREASON'>0 D UNLOCK G DCQ
"RTN","ORCACT2",44,0)
 S ORNATR=$P(OREASON,U,3),ORCREATE=1 ; CHGD $$CREATE^ORX1(ORNATR)
"RTN","ORCACT2",45,0)
 I 'ORCREATE,$G(ORX),$D(^XUSEC("OREMAS",DUZ)),$$GET^XPAR("ALL","OR OREMAS MED ORDERS")<2 W $C(7),!,"You are not authorized to release med orders.",! G DC3
"RTN","ORCACT2",46,0)
 I ORCREATE D  I (ORNP="^")!($G(ORL)="^") D UNLOCK G DCQ
"RTN","ORCACT2",47,0)
 . S ORNP=$$PROVIDER^ORCMENU1 Q:ORNP="^"  ;S:ORNP=DUZ ORNATR="E"
"RTN","ORCACT2",48,0)
 . I $G(ORX) D PROVIDER^ORCDPSIV I $G(ORQUIT) S ORNP="^" Q
"RTN","ORCACT2",49,0)
 . S:'$G(ORL) ORL=$$LOCATION^ORCMENU1
"RTN","ORCACT2",50,0)
 W ! W:'ORCREATE "Discontinuing orders ..."
"RTN","ORCACT2",51,0)
 S ORPRNT=$$PRINT(ORNATR),ORCLNUP=$S(ORNATR="D":1,ORNATR="M":1,1:0)
"RTN","ORCACT2",52,0)
 S (ORI,ORPRINT)=0 F  S ORI=$O(ORDC(ORI)) Q:ORI'>0  S ORIFN=ORDC(ORI) D
"RTN","ORCACT2",53,0)
 . I ORCREATE S ORDA=$$ACTION^ORCSAVE("DC",+ORIFN,ORNP) Q:'ORDA  D SET(+ORIFN,ORNATR,+OREASON,$P(OREASON,U,2)) S ^TMP("ORNEW",$J,+ORIFN,ORDA)="" W "." Q
"RTN","ORCACT2",54,0)
 . ; release -> no order or ES req'd
"RTN","ORCACT2",55,0)
 . D EN^ORCSEND(+ORIFN,ORACT,3,1,ORNATR,+OREASON,.ORERR),UNLK1^ORX2(+ORIFN)
"RTN","ORCACT2",56,0)
 . I '$G(ORERR) S:$P(ORPRNT,U)!$P(ORPRNT,U,5) ORPRINT=ORPRINT+1,ORPRINT(ORPRINT)=+ORIFN_";" W "." Q
"RTN","ORCACT2",57,0)
 . W !,$$ORDITEM(+ORIFN)_" not discontinued."
"RTN","ORCACT2",58,0)
 . W:$L($P($G(ORERR),U,2)) !,"  >> "_$P(ORERR,U,2) W ! H 1
"RTN","ORCACT2",59,0)
 W:ORCREATE "... discontinue order(s) placed." H 1
"RTN","ORCACT2",60,0)
 I $O(ORPRINT(0)) D PRINT^ORPR02(ORVP,.ORPRINT,,ORL,ORPRNT)
"RTN","ORCACT2",61,0)
 S OREBUILD=1 ; rebuild orders list
"RTN","ORCACT2",62,0)
DCQ D:$G(OREBUILD) UNOTIF^ORCSIGN ; undo notif?
"RTN","ORCACT2",63,0)
 D:'$D(^TMP("ORNEW",$J)) UNLOCK^ORX2(+ORVP) ;unlock if no new orders
"RTN","ORCACT2",64,0)
 S:$G(ORXNP) ORNP=ORXNP ;reset provider if needed
"RTN","ORCACT2",65,0)
 D:$D(OREVT) EVENT ;cancel any events?
"RTN","ORCACT2",66,0)
 Q
"RTN","ORCACT2",67,0)
 ;
"RTN","ORCACT2",68,0)
UNLOCK ; -- Unlock orders in ORDC(ORI)=ORIFN
"RTN","ORCACT2",69,0)
 N ORI,ORIFN S ORI=0
"RTN","ORCACT2",70,0)
 F  S ORI=$O(ORDC(ORI)) Q:ORI'>0  S ORIFN=+ORDC(ORI) D UNLK1^ORX2(ORIFN)
"RTN","ORCACT2",71,0)
 Q
"RTN","ORCACT2",72,0)
 ;
"RTN","ORCACT2",73,0)
OK(NUM) ; -- Ok to DC delayed order(s) too?
"RTN","ORCACT2",74,0)
 N X,Y,DIR S DIR(0)="YA",DIR("B")="NO"
"RTN","ORCACT2",75,0)
 S DIR("A")="Do you want to discontinue "_$S(NUM>1:"these orders",1:"this order")_" too? "
"RTN","ORCACT2",76,0)
 S DIR("?")="Enter YES to also cancel the delayed order(s), or NO to allow the order(s) to be activated when the designated event occurs."
"RTN","ORCACT2",77,0)
 W ! D ^DIR
"RTN","ORCACT2",78,0)
 Q +Y
"RTN","ORCACT2",79,0)
 ;
"RTN","ORCACT2",80,0)
NXT() ; -- Return next available subscript in ORDC()
"RTN","ORCACT2",81,0)
 N Y S Y=$L(ORNMBR,",")+1 S:Y'>$O(ORDC(""),-1) Y=$O(ORDC(""),-1)+1
"RTN","ORCACT2",82,0)
 Q Y
"RTN","ORCACT2",83,0)
 ;
"RTN","ORCACT2",84,0)
PRINT(NATR) ; -- Ok to print order?
"RTN","ORCACT2",85,0)
 N I,OR1,Y S I=$O(^ORD(100.02,"C",NATR,0)),OR1=$G(^ORD(100.02,I,1))
"RTN","ORCACT2",86,0)
 S Y=$P(OR1,U,2)_"^^^^"_$P(OR1,U,5)
"RTN","ORCACT2",87,0)
 Q Y
"RTN","ORCACT2",88,0)
 ;
"RTN","ORCACT2",89,0)
ORDITEM(ID) ; -- Returns order text
"RTN","ORCACT2",90,0)
 ;N X,I,MORE S X=""
"RTN","ORCACT2",91,0)
 ;I $P(ID,";",2)>1 S I=$P($G(^OR(100,+ID,8,+$P(ID,";",2),0)),U,2),X=$S(I="DC":"Discontinue ",I="HD":"Hold ",1:"")
"RTN","ORCACT2",92,0)
 ;S I=$O(^OR(100,+ID,1,0)) Q:'I "" S MORE=$O(^(I)),X=X_$G(^(I,0))
"RTN","ORCACT2",93,0)
 ;I $L(X)>68 S X=$E(X,1,68),MORE=1
"RTN","ORCACT2",94,0)
 ;S:MORE X=X_" ..."
"RTN","ORCACT2",95,0)
 N X,ORX D TEXT^ORQ12(.ORX,ID,68) S X=ORX(1)_$S(ORX>1:" ...",1:"")
"RTN","ORCACT2",96,0)
 Q X
"RTN","ORCACT2",97,0)
 ;
"RTN","ORCACT2",98,0)
SUBHDR(X) ; -- Display subheader of order being acted on
"RTN","ORCACT2",99,0)
 W !!,?(36-($L(X)\2)),"-- "_X_" --",!
"RTN","ORCACT2",100,0)
 Q
"RTN","ORCACT2",101,0)
 ;
"RTN","ORCACT2",102,0)
COMPLX ; -- Ck for other child orders to be dc'd at same time
"RTN","ORCACT2",103,0)
 N DAD,CHLD
"RTN","ORCACT2",104,0)
 S DAD=0 F  S DAD=$O(ORDC("DAD",DAD)) Q:DAD<1  D
"RTN","ORCACT2",105,0)
 . S CHLD=0 F  S CHLD=$O(^OR(100,DAD,2,CHLD)) Q:CHLD<1  D
"RTN","ORCACT2",106,0)
 .. Q:"^1^2^7^12^13^14^15^"[(U_$P($G(^OR(100,CHLD,3)),U,3)_U)
"RTN","ORCACT2",107,0)
 .. Q:$D(ORDC("DAD",DAD,CHLD))  S ORDC($$NXT)=CHLD
"RTN","ORCACT2",108,0)
 Q
"RTN","ORCACT2",109,0)
 ;
"RTN","ORCACT2",110,0)
DCREASON() ; -- Returns Reason for DC
"RTN","ORCACT2",111,0)
 N X,Y,DIC
"RTN","ORCACT2",112,0)
 ;I $D(^XUSEC("ORES",DUZ)) S Y=+$O(^ORD(100.03,"C","ORREQ",0)) I Y S Y(0)=$G(^ORD(100.03,Y,0)),Y=Y_U_$P(Y(0),U) G DCRQ ; silent
"RTN","ORCACT2",113,0)
 S DIC="^ORD(100.03,",DIC(0)="AEMQZ",DIC("B")=+$O(^ORD(100.03,"C","ORREQ",0)),DIC("W")="W:$L($P(^(0),U))>30 $E($P(^(0),U),31,999)" K:DIC("B")'>0 DIC("B")
"RTN","ORCACT2",114,0)
 S DIC("S")="I '$P(^(0),U,4),$P(^(0),U,5)="_+$O(^DIC(9.4,"C","OR",0))_",$P(^(0),U,7)'="_+$O(^ORD(100.02,"C","A",0)),DIC("A")="REASON FOR DC: "
"RTN","ORCACT2",115,0)
 D ^DIC
"RTN","ORCACT2",116,0)
DCRQ S:Y>0 Y=Y_U_$S($P(Y(0),U,7):$P($G(^ORD(100.02,+$P(Y(0),U,7),0)),U,2),1:"W") ; ^nature
"RTN","ORCACT2",117,0)
 Q Y
"RTN","ORCACT2",118,0)
 ;
"RTN","ORCACT2",119,0)
SET(ORDER,NATURE,REASON,TEXT,DCORIG) ; -- Set DC Reason into 6-node
"RTN","ORCACT2",120,0)
 Q:'$G(ORDER)  Q:'$D(^OR(100,+ORDER,0))  S ORDER=+ORDER
"RTN","ORCACT2",121,0)
 I $L($G(NATURE)),NATURE'>0 S NATURE=$O(^ORD(100.02,"C",NATURE,0))
"RTN","ORCACT2",122,0)
 S $P(^OR(100,ORDER,6),U,1,5)=$G(NATURE)_U_DUZ_U_$E($$NOW^XLFDT,1,12)_U_$G(REASON)_U_$G(TEXT),$P(^(6),U,9)=$G(DCORIG)
"RTN","ORCACT2",123,0)
 Q
"RTN","ORCACT2",124,0)
 ;
"RTN","ORCACT2",125,0)
RESUME(ORDER) ; -- Resume tray service when dc'ing tubefeeding ORDER?
"RTN","ORCACT2",126,0)
 N X,Y,DIR,DIC,DA S X=$$RESUME^FHWORR(+ORVP)
"RTN","ORCACT2",127,0)
 I '$L(X) W !,"NOTE: NO current diet order exists for this patient!" Q
"RTN","ORCACT2",128,0)
 Q:'X  I X=2 W !,"Note: Patient is on a WITHHOLD SERVICE order!"
"RTN","ORCACT2",129,0)
 S DIR(0)="YA",DIR("A")="Do you wish to resume tray service? "
"RTN","ORCACT2",130,0)
 S DIR("?")="Enter YES to resume the previous diet order",DIR("B")="NO"
"RTN","ORCACT2",131,0)
 D ^DIR I Y'=1 S:$D(DTOUT)!(X["^") ORQUIT=1
"RTN","ORCACT2",132,0)
 D:Y=1 RESUME^ORCSAVE(+ORDER)
"RTN","ORCACT2",133,0)
 Q
"RTN","ORCACT2",134,0)
 ;
"RTN","ORCACT2",135,0)
UNREL ; -- Process unreleased/delayed order
"RTN","ORCACT2",136,0)
 N ORA,ORA0,DA,DR,DIE
"RTN","ORCACT2",137,0)
 S ORA=+$P(ORIFN,";",2),ORA0=$G(^OR(100,+ORIFN,8,ORA,0))
"RTN","ORCACT2",138,0)
 ;S ORDEL=$S(ORSTS=11:1,$P(ORA0,U,4)=2:1,1:0)
"RTN","ORCACT2",139,0)
 ;W !,"This order was not released "_$S(ORDEL:"to the service and will be deleted.",1:"but signed and will be cancelled.")
"RTN","ORCACT2",140,0)
 K:$P(ORA0,U,2)="DC" ^OR(100,+ORIFN,6) I $P(ORA0,U,2)="NW" D
"RTN","ORCACT2",141,0)
 . S:$P(OR3,U,5) $P(^OR(100,+$P(OR3,U,5),3),U,6)=""
"RTN","ORCACT2",142,0)
 . I $P(OR0,U,17) S DA=+$O(^ORE(100.2,"AO",+ORIFN,0)) I DA S DR="4///@",DIE=100.2 D ^DIE
"RTN","ORCACT2",143,0)
 D UNLK1^ORX2(+ORIFN) S OREBUILD=1
"RTN","ORCACT2",144,0)
 I $D(^TMP("ORNEW",$J,+ORIFN,ORA)) K ^(ORA) D  Q  ;new this session
"RTN","ORCACT2",145,0)
 . W !,"This order will be deleted." H 1
"RTN","ORCACT2",146,0)
 . D DELETE^ORCSAVE2(ORIFN),UNLK1^ORX2(+ORIFN) ;decrement lock again
"RTN","ORCACT2",147,0)
 W !,"This order was not released and will be cancelled." H 1
"RTN","ORCACT2",148,0)
 D CANCEL^ORCSAVE2(ORIFN):ORSTS=11,CLRDLY(+ORIFN):ORSTS=10
"RTN","ORCACT2",149,0)
 Q
"RTN","ORCACT2",150,0)
 ;
"RTN","ORCACT2",151,0)
CLRDLY(IFN) ; -- [old Clear delayed fields] Cancel delayed [event]order
"RTN","ORCACT2",152,0)
 N STS,ORX S IFN=+$G(IFN) Q:IFN'>0
"RTN","ORCACT2",153,0)
 Q:'$D(^OR(100,IFN,0))  S STS=$P($G(^(3)),U,3)
"RTN","ORCACT2",154,0)
 S ORX="Delayed "_$S(STS=10:"Order",1:"Release Event")_" Cancelled"
"RTN","ORCACT2",155,0)
 S ^OR(100,IFN,6)=$O(^ORD(100.02,"C","M",0))_U_DUZ_U_+$E($$NOW^XLFDT,1,12)_U_U_ORX
"RTN","ORCACT2",156,0)
 D STATUS^ORCSAVE2(IFN,13) S $P(^OR(100,IFN,8,1,0),U,15)=13
"RTN","ORCACT2",157,0)
 Q
"RTN","ORCACT2",158,0)
 ;
"RTN","ORCACT2",159,0)
EVENT ; -- Cancel event too?
"RTN","ORCACT2",160,0)
 N EVT,X
"RTN","ORCACT2",161,0)
 S EVT=0 F  S EVT=$O(OREVT(EVT)) Q:EVT<1  D  Q:$G(ORQUIT)
"RTN","ORCACT2",162,0)
 . Q:$G(^ORE(100.2,EVT,1))  Q:'$$EMPTY^OREVNTX(EVT)  ;done or has orders
"RTN","ORCACT2",163,0)
 . ;W !!,$P($$NAME^OREVNTX(EVT)," ",2,99)_" has no more delayed orders."
"RTN","ORCACT2",164,0)
 . ;S DIR(0)="YA",DIR("A")="Do you want to cancel this event? "
"RTN","ORCACT2",165,0)
 . ;S DIR("?")="Enter NO if you wish to enter new delayed orders for this event, otherwise enter YES to terminate it."
"RTN","ORCACT2",166,0)
 . ;S DIR("B")="YES" D ^DIR I $D(DTOUT)!$D(DUOUT) S ORQUIT=1 Q
"RTN","ORCACT2",167,0)
 . D CANCEL^OREVNTX(EVT) S X=$P($$NAME^OREVNTX(EVT)," ",2,99)
"RTN","ORCACT2",168,0)
 . W !,"   ... "_X_" event cancelled." H 1
"RTN","ORCACT2",169,0)
 . I $G(OREVENT),OREVENT=EVT D EX^OREVNT ;Return to Active Orders
"RTN","ORCACT2",170,0)
 Q
"RTN","ORCACT2",171,0)
 ;
"RTN","ORCACT2",172,0)
DCD(IFN) ; -- order discontinued already?
"RTN","ORCACT2",173,0)
 N STS,Y,I S Y=0 I '$G(IFN) Q 1
"RTN","ORCACT2",174,0)
 S STS=+$P($G(^OR(100,+IFN,3)),U,3)
"RTN","ORCACT2",175,0)
 I "^1^2^7^12^13^14^"[(U_STS_U) S Y=1 G DQ ;terminal sts
"RTN","ORCACT2",176,0)
 ;look for existing DC action awaiting ES:
"RTN","ORCACT2",177,0)
 S I=0 F  S I=+$O(^OR(100,+IFN,8,"C","DC",I)) Q:I<1  I $P($G(^OR(100,+IFN,8,I,0)),U,15)=11 S Y=1 Q
"RTN","ORCACT2",178,0)
DQ Q Y
"RTN","ORCB")
0^147^B51269339
"RTN","ORCB",1,0)
ORCB ;SLC/MKB-Notifications followup for LMgr chart ;4/5/01  21:32
"RTN","ORCB",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,36,48,70,108,116,243**;Dec 17, 1997;Build 242
"RTN","ORCB",3,0)
EN(DFN,ORFLG,DGRP,DEL) ; -- main entry point
"RTN","ORCB",4,0)
 Q:'$G(DFN)  Q:'$G(ORFLG)
"RTN","ORCB",5,0)
 N BEG,END D SLCT1^ORQPT
"RTN","ORCB",6,0)
 S DGRP=$P($G(^ORD(100.98,+$G(DGRP),0)),U,3) S:'$L(DGRP) DGRP="ALL"
"RTN","ORCB",7,0)
 S (BEG,END)="" I ORFLG=6 D  ;get BEG from XQAID for New Orders
"RTN","ORCB",8,0)
 . S BEG=$P(XQAID,";",3) I BEG'?7N1".".6N!(BEG'<DT) S BEG="" Q
"RTN","ORCB",9,0)
 . S BEG=$$FMADD^XLFDT(BEG,,,-5),END=$$NOW^XLFDT
"RTN","ORCB",10,0)
 I ORFLG=9 D  ;get BEG from Current Admission
"RTN","ORCB",11,0)
 . N ADM S ADM=+$G(^DPT(DFN,.105)) S:ADM ADM=+$P($G(^DGPM(ADM,0)),U)
"RTN","ORCB",12,0)
 . S END=$$NOW^XLFDT,BEG=$S(ADM:ADM,1:$$FMADD^XLFDT(END,-30))
"RTN","ORCB",13,0)
 S ^TMP("OR",$J,"ORDERS",0)="^^"_BEG_";"_END_";"_ORFLG_";"_DGRP_";L"
"RTN","ORCB",14,0)
 D EN^VALM("ORCB NOTIFICATIONS")
"RTN","ORCB",15,0)
 Q
"RTN","ORCB",16,0)
 ;
"RTN","ORCB",17,0)
INIT ; -- init variables and list array
"RTN","ORCB",18,0)
 S ORTAB="ORDERS" D TAB^ORCHART("ORDERS",1)
"RTN","ORCB",19,0)
 I VALMCNT=1,$G(^TMP("OR",$J,ORTAB,1,0))["No data available" D
"RTN","ORCB",20,0)
 . N X,I S X="     No "_$S(ORFLG=5:"expiring",ORFLG=11:"unsigned",ORFLG=12:"flagged",9:"unverified",1:"new")_" orders found."
"RTN","ORCB",21,0)
 . F I="ORDERS","CURRENT" S ^TMP("OR",$J,I,1,0)=$$LJ^XLFSTR(X,45)_"|"
"RTN","ORCB",22,0)
 Q
"RTN","ORCB",23,0)
 ;
"RTN","ORCB",24,0)
HELP ; -- help code
"RTN","ORCB",25,0)
 N X S VALMBCK=""
"RTN","ORCB",26,0)
 W !!,"Enter the display numbers of the orders you wish to act on;"
"RTN","ORCB",27,0)
 W !,"select either DT for a detailed listing of information about each"
"RTN","ORCB",28,0)
 W !,"order, or the desired action.  Enter Q to exit."
"RTN","ORCB",29,0)
 W !!,"Press <return> to continue ..." R X:DTIME
"RTN","ORCB",30,0)
 Q
"RTN","ORCB",31,0)
 ;
"RTN","ORCB",32,0)
PHDR ; -- protocol menu header code
"RTN","ORCB",33,0)
 N NUM,ORI,ORDEF,I,X K ORNMBR,OREBUILD
"RTN","ORCB",34,0)
 S VALMSG=$$MSG^ORCHART D SHOW^VALM
"RTN","ORCB",35,0)
 S NUM=+$P($G(^TMP("OR",$J,"CURRENT",0)),U,2)
"RTN","ORCB",36,0)
 S XQORM("#")=$O(^ORD(101,"B","ORCB ACTIONS",0))_"^1:"_NUM
"RTN","ORCB",37,0)
 S ORI=$S(ORFLG=5:1,ORFLG=11:"2,3,4",ORFLG=12:"3,4,5,6,7",1:8)
"RTN","ORCB",38,0)
 S ORDEF=$S(ORFLG=5:1,ORFLG=11:9,ORFLG=12:5,1:10)
"RTN","ORCB",39,0)
 F I=1:1:$L(ORI,",") S X=$T(ACTIONS+$P(ORI,",",I)),XQORM("KEY",$P(X,";",3))=$O(^ORD(101,"B","ORC "_$P(X,";",4)_" ORDERS",0))_"^1"
"RTN","ORCB",40,0)
 S XQORM("KEY","DT")=$O(^ORD(101,"B","ORC DETAILED DISPLAY",0))_"^1"
"RTN","ORCB",41,0)
 I +$P($G(^TMP("OR",$J,"CURRENT",0)),U,2)>0,XQORM("B")="Quit" S X=$T(ACTIONS+ORDEF),X=$P(X,";",4),XQORM("KEY",$P(X," "))=$O(^ORD(101,"B","ORC "_X_" ORDERS",0))_"^1",XQORM("B")=$$LOWER^VALM1(X)_" Orders" ; default action
"RTN","ORCB",42,0)
 S:'$G(ORL) ORL=$$FINDLOC ; attempt to determine location from orders
"RTN","ORCB",43,0)
 Q
"RTN","ORCB",44,0)
 ;
"RTN","ORCB",45,0)
SELECT ; -- process selected order(s)
"RTN","ORCB",46,0)
 N MENU,XQORM,Y,ORNMBR,OREBUILD,ORY S VALMBCK=""
"RTN","ORCB",47,0)
 S ORNMBR=$P(XQORNOD(0),"=",2) D SELECT^ORCHART(ORNMBR)
"RTN","ORCB",48,0)
 S:'$G(ORFLG) ORFLG=$P($P(^TMP("OR",$J,"CURRENT",0),U,3),";",3)
"RTN","ORCB",49,0)
 S MENU=$S(ORFLG=5:"EXPIRING",ORFLG=11:"UNSIGNED",ORFLG=12:"FLAGGED",1:"NEW")
"RTN","ORCB",50,0)
 S XQORM=$O(^ORD(101,"B","ORCB "_MENU_" MENU",0))_";ORD(101,"
"RTN","ORCB",51,0)
 I 'XQORM W !!,"ERROR" H 2 G SQ
"RTN","ORCB",52,0)
 S XQORM(0)="1AD",XQORM("A")="Select action: "
"RTN","ORCB",53,0)
 W ! D EN^XQORM G:Y'>0 SQ M ORY=Y
"RTN","ORCB",54,0)
 I $D(^ORD(101,+$P(ORY(1),U,2),20)) X ^(20) S VALMBCK="R"
"RTN","ORCB",55,0)
 I $G(OREBUILD) D:ORFLG=12 UNFLAG D TAB^ORCHART(ORTAB,1) Q
"RTN","ORCB",56,0)
SQ D DESELECT^ORCHART(ORNMBR)
"RTN","ORCB",57,0)
 Q
"RTN","ORCB",58,0)
 ;
"RTN","ORCB",59,0)
UNFLAG ; -- Unflag orders
"RTN","ORCB",60,0)
 N ORX,ORI,NUM,ORIFN,ORA,X
"RTN","ORCB",61,0)
 S ORX=$P(ORY(1),U,3) Q:(ORX="Unflag")!(ORX="Detailed Display")
"RTN","ORCB",62,0)
 F ORI=1:1:$L(ORNMBR,",") S NUM=$P(ORNMBR,",",ORI) I NUM D
"RTN","ORCB",63,0)
 . S ORIFN=$P(^TMP("OR",$J,"CURRENT","IDX",NUM),U) Q:'ORIFN
"RTN","ORCB",64,0)
 . S ORA=+$P(ORIFN,";",2),ORIFN=+ORIFN Q:'ORA
"RTN","ORCB",65,0)
 . Q:'$D(^OR(100,ORIFN))  Q:(ORX="Edit")&($P(^(ORIFN,3),U,3)'=12)
"RTN","ORCB",66,0)
 . S X=+$G(^OR(100,ORIFN,8,ORA,0)),$P(^(3),U)=0,$P(^(3),U,6,8)=X_U_DUZ_"^Unflagged by action" ; Unflag
"RTN","ORCB",67,0)
 . S X=ORIFN_";"_ORA D MSG^ORCFLAG(X)
"RTN","ORCB",68,0)
 Q
"RTN","ORCB",69,0)
 ;
"RTN","ORCB",70,0)
EN1(ORIFN,ACTION) ; -- entry point to display single order
"RTN","ORCB",71,0)
 Q:'ORIFN  Q:'$D(^OR(100,ORIFN))
"RTN","ORCB",72,0)
 Q:"^^NEW^RENEW^REPLACE^"'[(U_$G(ACTION)_U)
"RTN","ORCB",73,0)
 S DFN=+$P(^OR(100,ORIFN,0),U,2) Q:'DFN
"RTN","ORCB",74,0)
 S ^TMP("ORXPND",$J,0)=ORIFN_U_$G(ACTION)
"RTN","ORCB",75,0)
 D EN1^ORCXPND(DFN,ORIFN)
"RTN","ORCB",76,0)
 K ^TMP("ORXPND",$J),^TMP("OR",$J)
"RTN","ORCB",77,0)
 Q
"RTN","ORCB",78,0)
 ;
"RTN","ORCB",79,0)
NEW ; -- Add new order as follow-up action
"RTN","ORCB",80,0)
 N IFN,TYPE,ORIG,ORNP,ORPTLK S VALMBCK="" K ^TMP("ORNEW",$J)
"RTN","ORCB",81,0)
 S ORPTLK=$$LOCK^ORX2(+ORVP) I 'ORPTLK W !!,$C(7),$P(ORPTLK,U,2) H 2 Q
"RTN","ORCB",82,0)
 S ORNP=$$PROVIDER^ORCMENU1,VALMBCK="R" G:ORNP="^" NWQ
"RTN","ORCB",83,0)
 I '$G(ORL) S ORL=$$LOCATION^ORCMENU1 G:ORL["^" NWQ
"RTN","ORCB",84,0)
 S ORIG=+$P($G(^TMP("ORXPND",$J,0)),U),IFN=+$P($G(^OR(100,+ORIG,0)),U,5)
"RTN","ORCB",85,0)
 G:'IFN NWQ S TYPE=$P($G(^ORD(101.41,IFN,0)),U,4)
"RTN","ORCB",86,0)
 ; If 2.5 order, use DG or PKG to get dlg
"RTN","ORCB",87,0)
 D FULL^VALM1,ORDER^ORCMENU
"RTN","ORCB",88,0)
 I $O(^TMP("ORNEW",$J,0)) D SIGN,NOTIF^ORCMENU2
"RTN","ORCB",89,0)
 K ^TMP("ORNEW",$J) S VALMBCK="R"
"RTN","ORCB",90,0)
NWQ D UNLOCK^ORX2(+ORVP)
"RTN","ORCB",91,0)
 Q
"RTN","ORCB",92,0)
 ;
"RTN","ORCB",93,0)
EDIT ; -- Edit order as follow-up action
"RTN","ORCB",94,0)
 N OREBUILD K ^TMP("ORNEW",$J)
"RTN","ORCB",95,0)
 D EDIT^ORCACT I $G(OREBUILD) D
"RTN","ORCB",96,0)
 . D SIGN,NOTIF^ORCMENU2
"RTN","ORCB",97,0)
 . S $P(^TMP("ORXPND",$J,0),U,2)=""
"RTN","ORCB",98,0)
 K ^TMP("ORNEW",$J) S VALMBCK="R"
"RTN","ORCB",99,0)
 D UNLOCK^ORX2(+ORVP)
"RTN","ORCB",100,0)
 Q
"RTN","ORCB",101,0)
 ;
"RTN","ORCB",102,0)
RENEW ; --Renew order as follow-up action
"RTN","ORCB",103,0)
 N OREBUILD K ^TMP("ORNEW",$J)
"RTN","ORCB",104,0)
 D RENEW^ORCACT I $G(OREBUILD) D
"RTN","ORCB",105,0)
 . D SIGN,NOTIF^ORCMENU2
"RTN","ORCB",106,0)
 . S $P(^TMP("ORXPND",$J,0),U,2)=""
"RTN","ORCB",107,0)
 . K ^TMP("ORXPND",$J) D INIT^ORCXPND
"RTN","ORCB",108,0)
 K ^TMP("ORNEW",$J) S VALMBCK="R"
"RTN","ORCB",109,0)
 D UNLOCK^ORX2(+ORVP)
"RTN","ORCB",110,0)
 Q
"RTN","ORCB",111,0)
 ;
"RTN","ORCB",112,0)
SIGN ; -- Sign new order
"RTN","ORCB",113,0)
 N ORIFN,ORTAB,ORNMBR,CNT
"RTN","ORCB",114,0)
 S ORTAB="NEW",(ORIFN,CNT)=0,ORNMBR=""
"RTN","ORCB",115,0)
 F  S ORIFN=+$O(^TMP("ORNEW",$J,ORIFN)) Q:ORIFN'>0  S CNT=CNT+1,^TMP("OR",$J,"NEW","IDX",CNT)=ORIFN,ORNMBR=ORNMBR_CNT_","
"RTN","ORCB",116,0)
 I CNT D EN^ORCSIGN K ^TMP("OR",$J,"NEW","IDX")
"RTN","ORCB",117,0)
 Q
"RTN","ORCB",118,0)
 ;
"RTN","ORCB",119,0)
EXIT ; -- exit action
"RTN","ORCB",120,0)
 I $P($P(^TMP("OR",$J,"CURRENT",0),U,3),";",3)=12 D  ; flagged orders
"RTN","ORCB",121,0)
 . Q:'$$GET^XPAR("ALL","ORPF AUTO UNFLAG")
"RTN","ORCB",122,0)
 . N ORI,ORIFN,ORA,XQAKILL,ORN,ORUNF
"RTN","ORCB",123,0)
 . S ORUNF=+$E($$NOW^XLFDT,1,12)_U_DUZ_"^Auto-Unflagged"
"RTN","ORCB",124,0)
 . S ORI=0 F  S ORI=$O(^TMP("OR",$J,"CURRENT","IDX",ORI)) Q:ORI'>0  S ORIFN=$P(^(ORI),U),ORA=+$P(ORIFN,";",2) I ORIFN,$D(^OR(100,+ORIFN,0)) S $P(^(8,ORA,3),U)=0,$P(^(3),U,6,8)=ORUNF D MSG^ORCFLAG(ORIFN) ; unflag
"RTN","ORCB",125,0)
 . S ORN=+$O(^ORD(100.9,"B","FLAGGED ORDERS",0))
"RTN","ORCB",126,0)
 . S XQAKILL=$$XQAKILL^ORB3F1(ORN) D:$D(XQAID) DELETE^XQALERT
"RTN","ORCB",127,0)
 D EXIT^ORCHART
"RTN","ORCB",128,0)
 Q
"RTN","ORCB",129,0)
 ;
"RTN","ORCB",130,0)
ACTIONS ;;KEY;NAME
"RTN","ORCB",131,0)
 ;;RN;RENEW
"RTN","ORCB",132,0)
 ;;$;SIGN
"RTN","ORCB",133,0)
 ;;DC;DISCONTINUE
"RTN","ORCB",134,0)
 ;;ED;CHANGE
"RTN","ORCB",135,0)
 ;;UF;UNFLAG
"RTN","ORCB",136,0)
 ;;HD;HOLD
"RTN","ORCB",137,0)
 ;;RL;UNHOLD
"RTN","ORCB",138,0)
 ;;VF;VERIFY
"RTN","ORCB",139,0)
 ;;;SIGN ALL
"RTN","ORCB",140,0)
 ;;;VERIFY ALL
"RTN","ORCB",141,0)
 ;
"RTN","ORCB",142,0)
ALL ; -- Select ALL orders
"RTN","ORCB",143,0)
 N X,Y,DIR,MAX
"RTN","ORCB",144,0)
 S MAX=+$P($G(^TMP("OR",$J,"CURRENT",0)),U,2),X="1-"_MAX,Y=""
"RTN","ORCB",145,0)
 S DIR(0)="L^1:"_MAX,DIR("V")="" D:MAX ^DIR
"RTN","ORCB",146,0)
 S ORNMBR=Y
"RTN","ORCB",147,0)
 Q
"RTN","ORCB",148,0)
 ;
"RTN","ORCB",149,0)
FINDLOC() ; -- Loop through orders in alert to find assigned location
"RTN","ORCB",150,0)
 N ORI,ORIFN,ORY S ORI=0,ORY=""
"RTN","ORCB",151,0)
 F  S ORI=$O(^TMP("OR",$J,"CURRENT","IDX",ORI)) Q:ORI'>0  S ORIFN=+^(ORI),ORX=$P($G(^OR(100,ORIFN,0)),U,10) S:ORY="" ORY=ORX I ORY'="",ORX'=ORY S ORY="" Q  ; ORY=location for all orders, or "" if different
"RTN","ORCB",152,0)
 Q ORY
"RTN","ORCB",153,0)
 ;
"RTN","ORCB",154,0)
DELETE ; -- Delete current alert
"RTN","ORCB",155,0)
 N %,%Y,X,Y,PRMT,XQAKILL S VALMBCK="",XQAKILL=1
"RTN","ORCB",156,0)
 S PRMT="Your "_$S(ORFLG=5:"Expiring",ORFLG=11:"Unsigned",ORFLG=12:"Flagged",ORFLG=9:"Unverified",1:"New")_" Orders alert for "_$G(ORPNM)_" will be deleted!"
"RTN","ORCB",157,0)
D1 W !!,PRMT,!,"Are you sure" S %=2 D YN^DICN
"RTN","ORCB",158,0)
 I (%<0)!(%=2) W !,"Nothing deleted." H 2 Q
"RTN","ORCB",159,0)
 I %=0 D  G D1
"RTN","ORCB",160,0)
 . W !!,"This action will delete the alert you are currently processing; the alert will",!,"disappear automatically when all orders have been acted on, but this action may",!,"be used to remove the alert if some orders are to be left unchanged."
"RTN","ORCB",161,0)
 . W !,"Press <return> to continue ..." R X:DTIME
"RTN","ORCB",162,0)
 W !,"Removing alert ..." D:$D(XQAID) DEL^ORB3FUP1(.Y,XQAID)
"RTN","ORCB",163,0)
 I $G(Y)="TRUE" W " done." S VALMBCK="Q",DEL=1 H 2
"RTN","ORCB",164,0)
 E  W " unable to delete alert." H 2
"RTN","ORCB",165,0)
 Q
"RTN","ORCD")
0^108^B53571666
"RTN","ORCD",1,0)
ORCD ; SLC/MKB - Order Dialog utilities ;12/15/2006
"RTN","ORCD",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**8,38,68,94,161,141,195,215,243**;Dec 17,1997;Build 242
"RTN","ORCD",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ORCD",4,0)
INPT() ; -- Return 1 or 0, if patient/order sheet = inpatient
"RTN","ORCD",5,0)
 N Y S Y=$S($G(ORWARD):1,$G(^DPT(+ORVP,.105)):1,1:0)
"RTN","ORCD",6,0)
 I $G(OREVENT) D  ;override if delayed order
"RTN","ORCD",7,0)
 . N X,X0 S X=$$EVT^OREVNTX(+OREVENT),X0=$G(^ORD(100.5,+X,0))
"RTN","ORCD",8,0)
 . I $P(X0,U,12) S X0=$G(^ORD(100.5,$P(X0,U,12),0)) ;use parent
"RTN","ORCD",9,0)
 . S X=$P(X0,U,2) Q:X="M"  Q:X="O"  ;M/O keep current inpt status
"RTN","ORCD",10,0)
 . S Y=$S(X="A":1,X="T":1,1:0)
"RTN","ORCD",11,0)
 . I X="D",$P(X0,U,7)=41 S Y=1 ;From ASIH = Inpt
"RTN","ORCD",12,0)
 . I X="T",$P(X0,U,7),$P(X0,U,7)<4 S Y=0 ;pass = Outpt
"RTN","ORCD",13,0)
 Q Y
"RTN","ORCD",14,0)
 ;
"RTN","ORCD",15,0)
EXT(P,I,F) ; -- Returns external value of ORDIALOG(Prompt,Instance)
"RTN","ORCD",16,0)
 N TYPE,PARAM,FNUM,IENS,X,Y,J,Z
"RTN","ORCD",17,0)
 S TYPE=$E($G(ORDIALOG(P,0))),PARAM=$P($G(ORDIALOG(P,0)),U,2)
"RTN","ORCD",18,0)
 S X=$G(ORDIALOG(P,I)) I X="" Q ""
"RTN","ORCD",19,0)
 I TYPE="N",X<1 S X=0_+X I X="00" S X=0
"RTN","ORCD",20,0)
 I "FNW"[TYPE Q X
"RTN","ORCD",21,0)
 I TYPE="Y" Q $S(X:"YES",X=0:"NO",1:"")
"RTN","ORCD",22,0)
 I TYPE="D" S:'$L($G(F)) F=1 Q $$FMTE^XLFDT(X,F)
"RTN","ORCD",23,0)
 I TYPE="R" Q $$FTDATE(X,$G(F)) ; DAY@TIME
"RTN","ORCD",24,0)
 I TYPE="P" D  Q Y
"RTN","ORCD",25,0)
 . S PARAM=$P(PARAM,":"),FNUM=$S(PARAM:+PARAM,1:+$P(@(U_PARAM_"0)"),U,2))
"RTN","ORCD",26,0)
 . S IENS=+X_",",J=$L(PARAM,",") I J>2 F  S J=J-2 Q:J'>0  S Z=$P(PARAM,",",J),IENS=IENS_$S(Z:Z,1:+$P(Z,"(",2))_","
"RTN","ORCD",27,0)
 . S:'+$G(F) F=.01 S Y=$$GET1^DIQ(FNUM,IENS,+F)
"RTN","ORCD",28,0)
 . I Y="",F'=.01 S Y=$$GET1^DIQ(FNUM,IENS,.01)
"RTN","ORCD",29,0)
 I TYPE="S" F J=1:1:$L(PARAM,";") S Z=$P(PARAM,";",J) I $P(Z,":")=X S Y=$S(+$G(F):X,1:$P(Z,":",2)) Q
"RTN","ORCD",30,0)
 Q $G(Y)
"RTN","ORCD",31,0)
 ;
"RTN","ORCD",32,0)
FTDATE(X,F) ; -- Returns free text form of date (i.e. TODAY)
"RTN","ORCD",33,0)
 N D,T,P,Y I X="" Q ""
"RTN","ORCD",34,0)
 S X=$$UP^XLFSTR(X),D=$P(X,"@"),T=$P(X,"@",2) ; D=date,T=time parts
"RTN","ORCD",35,0)
 I "NOW"[X Q "NOW"
"RTN","ORCD",36,0)
 I "NOON"[X Q "NOON"
"RTN","ORCD",37,0)
 I $E("MIDNIGHT",1,$L(X))=X Q "MIDNIGHT"
"RTN","ORCD",38,0)
 I (X="AM")!(X="NEXT") Q X_" Lab collection"
"RTN","ORCD",39,0)
 I (X="NEXTA")!(X="CLOSEST") Q $S(X="NEXTA":"NEXT",1:X)_" administration time"
"RTN","ORCD",40,0)
 I $E(D)'="T",$E(D)'="V",($E(D)'="N"!($E(D,1,3)="NOV")) D  Q $$FMTE^XLFDT(X,F)
"RTN","ORCD",41,0)
 . N %DT S %DT="TX" D ^%DT S:Y>0 X=Y S:'$G(F) F=1
"RTN","ORCD",42,0)
 S P=$S(D["+":"+",D["-":"-",1:"")
"RTN","ORCD",43,0)
 I P="" S Y=$S($E(D)="T":"TODAY",$E(D)="V":"NEXT VISIT",1:"NOW")
"RTN","ORCD",44,0)
FTD1 E  D
"RTN","ORCD",45,0)
 . N OFFSET,NUM,UNIT
"RTN","ORCD",46,0)
 . S OFFSET=$P(D,P,2),NUM=+OFFSET,UNIT=$E($P(OFFSET,NUM,2)) ; +/-#D
"RTN","ORCD",47,0)
 . I $E(D)="T",NUM=1,UNIT=""!(UNIT="D") S Y=$S(P="+":"TOMORROW",1:"YESTERDAY") Q
"RTN","ORCD",48,0)
 . S Y=NUM_" "_$S(UNIT="'":"MINUTE",UNIT="H":"HOUR",UNIT="W":"WEEK",UNIT="M":"MONTH",1:"DAY")
"RTN","ORCD",49,0)
 . S:NUM>1 Y=Y_"S" ; plural
"RTN","ORCD",50,0)
 . S:$E(D)="N" Y=Y_" "_$S(P="+":"FROM NOW",1:"AGO")
"RTN","ORCD",51,0)
 . S:$E(D)="T" Y=Y_" "_$S(P="+":"FROM TODAY",1:"AGO")
"RTN","ORCD",52,0)
 . S:$E(D)="V" Y=Y_" "_$S(P="+":"AFTER",1:"BEFORE")_" NEXT VISIT"
"RTN","ORCD",53,0)
 I $L(T) S Y=Y_"@"_$$TIME(T)
"RTN","ORCD",54,0)
 Q Y
"RTN","ORCD",55,0)
 ;
"RTN","ORCD",56,0)
FTDHELP ; -- Displays ??-help for R-type prompts
"RTN","ORCD",57,0)
 G R^ORCDLGH
"RTN","ORCD",58,0)
 Q
"RTN","ORCD",59,0)
 ;
"RTN","ORCD",60,0)
FTDCOMP(X1,X2,OPER) ; -- Compares free text dates from prompts X1 & X2
"RTN","ORCD",61,0)
 ;    Returns 1 or 0, IF $$VAL(X1)<OPER>$$VAL(X2) is true
"RTN","ORCD",62,0)
 N X,Y,Y1,Y2,Z,%DT
"RTN","ORCD",63,0)
 S X=$$VAL(X1),%DT="TX" D ^%DT S Y1=Y ; Y'>0 ??
"RTN","ORCD",64,0)
 S X=$$VAL(X2),%DT="TX" D ^%DT S Y2=Y ; Y'>0 ??
"RTN","ORCD",65,0)
 S Z="I "_Y1_OPER_Y2 X Z
"RTN","ORCD",66,0)
 Q $T
"RTN","ORCD",67,0)
 ;
"RTN","ORCD",68,0)
TIME(X) ; -- Returns 00:00 PM formatted time
"RTN","ORCD",69,0)
 N Y,Z,%DT
"RTN","ORCD",70,0)
 I X?1U,"BNE"[X Q $S(X="B":"BREAKFAST",X="N":"NOON",X="E":"EVENING",1:"")
"RTN","ORCD",71,0)
 I "NOON"[X Q X
"RTN","ORCD",72,0)
 I "MIDNIGHT"[X Q "MIDNIGHT"
"RTN","ORCD",73,0)
 S X="T@"_X,%DT="TX" D ^%DT I Y'>0 Q ""
"RTN","ORCD",74,0)
 S Z=$$FMTE^XLFDT(Y,"2P"),Z=$P(Z," ",2)_$$UP^XLFSTR($P(Z," ",3))
"RTN","ORCD",75,0)
 Q Z
"RTN","ORCD",76,0)
 ;
"RTN","ORCD",77,0)
VAL(TEXT,INST) ; -- Returns internal form of TEXT's current value
"RTN","ORCD",78,0)
 N I,X S X="" S:'$G(INST) INST=1
"RTN","ORCD",79,0)
 I '$D(ORDIALOG("B",TEXT)) S I=$O(ORDIALOG("B",TEXT)) Q:$E(I,1,$L(TEXT))'=TEXT X S TEXT=I ; partial match
"RTN","ORCD",80,0)
 S X=$P($G(ORDIALOG("B",TEXT)),U,2) ; ptr
"RTN","ORCD",81,0)
 Q $G(ORDIALOG(X,INST))
"RTN","ORCD",82,0)
 ;
"RTN","ORCD",83,0)
ORDMSG(OI) ; -- Display order message for orderable OI
"RTN","ORCD",84,0)
 Q:'$O(^ORD(101.43,OI,8,0))  ; no order message
"RTN","ORCD",85,0)
 N I S I=0 W !
"RTN","ORCD",86,0)
 F  S I=$O(^ORD(101.43,OI,8,I)) Q:I'>0  W !,$G(^(I,0))
"RTN","ORCD",87,0)
 W ! Q
"RTN","ORCD",88,0)
 ;
"RTN","ORCD",89,0)
PTR(NAME) ; -- Returns pointer to Dialog file for prompt NAME
"RTN","ORCD",90,0)
 Q +$O(^ORD(101.41,"AB",$E(NAME,1,63),0))
"RTN","ORCD",91,0)
 ;
"RTN","ORCD",92,0)
NMSP(PKG) ; -- Returns package namespace from pointer
"RTN","ORCD",93,0)
 N Y S Y=$$GET1^DIQ(9.4,+PKG_",",1)
"RTN","ORCD",94,0)
 S:$E(Y,1,2)="PS" Y="PS" S:Y="GMRV" Y="OR"
"RTN","ORCD",95,0)
 Q Y
"RTN","ORCD",96,0)
 ;
"RTN","ORCD",97,0)
GETQDLG(QIFN) ; -- define ORDIALOG(PROMPT) for quick order QIFN
"RTN","ORCD",98,0)
 S ORDIALOG=$$DEFDLG(QIFN) Q:'ORDIALOG
"RTN","ORCD",99,0)
 D GETDLG(ORDIALOG),GETORDER("^ORD(101.41,"_QIFN_",6)")
"RTN","ORCD",100,0)
 X:$D(^ORD(101.41,QIFN,3)) ^(3) ; entry action for quick order
"RTN","ORCD",101,0)
 Q
"RTN","ORCD",102,0)
 ;
"RTN","ORCD",103,0)
DEFDLG(QDLG) ; -- Returns default dialog for QDLG
"RTN","ORCD",104,0)
 N DG,DLG,TOP S DG=+$P($G(^ORD(101.41,+QDLG,0)),U,5)
"RTN","ORCD",105,0)
 S DLG=+$P($G(^ORD(100.98,DG,0)),U,4) ; default dialog
"RTN","ORCD",106,0)
 I 'DLG S TOP=+$O(^ORD(100.98,"AD",DG,0)),DLG=+$P($G(^ORD(100.98,TOP,0)),U,4)
"RTN","ORCD",107,0)
 Q DLG
"RTN","ORCD",108,0)
 ;
"RTN","ORCD",109,0)
GETDLG(IFN) ; -- define ORDIALOG(PROMPT) for dialog IFN
"RTN","ORCD",110,0)
 N SEQ,DA,ITEM,PTR,PROMPT,TEXT,INDEX,HELP,XHELP,SCREEN,ORD,INPUTXFM,LKP
"RTN","ORCD",111,0)
 S SEQ=0 K ^TMP("ORWORD",$J)
"RTN","ORCD",112,0)
 F  S SEQ=$O(^ORD(101.41,IFN,10,"B",SEQ)) Q:SEQ'>0  S DA=0 F  S DA=$O(^ORD(101.41,IFN,10,"B",SEQ,DA)) Q:'DA  D
"RTN","ORCD",113,0)
 . S ITEM=$G(^ORD(101.41,IFN,10,DA,0)),INPUTXFM=$G(^(.1)),HELP=$G(^(1)),SCREEN=$G(^(4)),XHELP=$G(^(6))
"RTN","ORCD",114,0)
 . S PTR=$P(ITEM,U,2),TEXT=$P(ITEM,U,4),INDEX=$P(ITEM,U,10) Q:'PTR
"RTN","ORCD",115,0)
 . S:'$L(TEXT) TEXT=$P(^ORD(101.41,PTR,0),U,2) K ORD
"RTN","ORCD",116,0)
 . S PROMPT=$G(^ORD(101.41,PTR,1)),ORD=DA_U_$P(PROMPT,U,3)
"RTN","ORCD",117,0)
 . S ORD(0)=$P(PROMPT,U)_$S($P(PROMPT,U)="S":"M",1:"")_U_$P(PROMPT,U,2)_$S($L(INPUTXFM):U_INPUTXFM,1:"")
"RTN","ORCD",118,0)
 . S ORD("A")=TEXT S:$L($P(ITEM,U,13)) ORD("TTL")=$P(ITEM,U,13)
"RTN","ORCD",119,0)
 . I $P(ITEM,U,7) S ORD("MAX")=$P(ITEM,U,12),ORD("MORE")=$P(ITEM,U,14) ; fields for multiples
"RTN","ORCD",120,0)
 . I $L(HELP) S LKP=$P(HELP,U,2),HELP=$P(HELP,U) S:$L(HELP) ORD("?")=HELP S:$L(LKP) ORD("LKP")=$S($L(LKP,";")>1:$TR(LKP,";","^"),1:U_LKP)
"RTN","ORCD",121,0)
 . S:$L(XHELP) ORD("??")=U_XHELP
"RTN","ORCD",122,0)
 . S:$L(INDEX) ORD("D")=INDEX
"RTN","ORCD",123,0)
 . S:$L(SCREEN) ORD("S")=SCREEN
"RTN","ORCD",124,0)
 . S ORDIALOG("B",$$UP^XLFSTR($P(TEXT,":")))=SEQ_U_PTR
"RTN","ORCD",125,0)
 . M ORDIALOG(PTR)=ORD
"RTN","ORCD",126,0)
 Q
"RTN","ORCD",127,0)
 ;
"RTN","ORCD",128,0)
GETDLG1(IFN) ; -- basic ORDIALOG(PROMPT) for dialog IFN
"RTN","ORCD",129,0)
 N SEQ,DA,PROMPT,PTR,WINCTRL
"RTN","ORCD",130,0)
 K ^TMP("ORWORD",$J) S SEQ=0
"RTN","ORCD",131,0)
 F  S SEQ=$O(^ORD(101.41,IFN,10,"B",SEQ)) Q:SEQ'>0  S DA=0 F  S DA=$O(^ORD(101.41,IFN,10,"B",SEQ,DA)) Q:'DA  D
"RTN","ORCD",132,0)
 . S PTR=$P($G(^ORD(101.41,IFN,10,DA,0)),U,2) Q:'PTR
"RTN","ORCD",133,0)
 . S WINCTRL=$P($G(^ORD(101.41,IFN,10,DA,"W")),U)
"RTN","ORCD",134,0)
 . S PROMPT=$G(^ORD(101.41,PTR,1)) Q:'$L(PROMPT)
"RTN","ORCD",135,0)
 . S ORDIALOG(PTR)=DA_U_$P(PROMPT,U,3)_U_WINCTRL
"RTN","ORCD",136,0)
 . S ORDIALOG(PTR,0)=$P(PROMPT,U,1,2)
"RTN","ORCD",137,0)
 Q
"RTN","ORCD",138,0)
 ;
"RTN","ORCD",139,0)
GETORDER(ROOT,ARRAY) ; -- retrieve order values from RESPONSES in ARRAY()
"RTN","ORCD",140,0)
 N ORI,ID,PTR,INST,TYPE,DA,X,ORTXT S:'$L($G(ARRAY)) ARRAY="ORDIALOG"
"RTN","ORCD",141,0)
 I +ROOT=ROOT S ROOT="^OR(100,"_ROOT_",4.5)" ; assume Orders file IFN
"RTN","ORCD",142,0)
 S ORI=0 F  S ORI=$O(@ROOT@(ORI)) Q:ORI'>0  S ID=$G(@ROOT@(ORI,0)) D
"RTN","ORCD",143,0)
 . S DA=$P(ID,U),PTR=$P(ID,U,2),INST=$P(ID,U,3) S:'INST INST=1
"RTN","ORCD",144,0)
 . S:'PTR PTR=$P($G(^ORD(101.41,+ORDIALOG,10,DA,0)),U,2) Q:'PTR
"RTN","ORCD",145,0)
 . Q:'$D(ORDIALOG(PTR))  S TYPE=$E($G(ORDIALOG(PTR,0))) Q:'$L(TYPE)
"RTN","ORCD",146,0)
 . I TYPE'="W" S X=$G(@ROOT@(ORI,1)) S:$L(X) @ARRAY@(PTR,INST)=X Q
"RTN","ORCD",147,0)
 . D RESTXT ;resolve objects
"RTN","ORCD",148,0)
 . I ARRAY="ORDIALOG" M ^TMP("ORWORD",$J,PTR,INST)=@ORTXT S @ARRAY@(PTR,INST)="^TMP(""ORWORD"","_$J_","_PTR_","_INST_")"
"RTN","ORCD",149,0)
 . I ARRAY'="ORDIALOG" M @ARRAY@(PTR,INST)=@ORTXT S @ARRAY@(PTR,INST)=$NA(@ARRAY@(PTR,INST))
"RTN","ORCD",150,0)
 . K @ORTXT
"RTN","ORCD",151,0)
 Q
"RTN","ORCD",152,0)
 ;
"RTN","ORCD",153,0)
RESTXT ; -- resolve objects in text [from GETORDER+8]
"RTN","ORCD",154,0)
 I $$BROKER^XWBLIB!($G(ORTYPE)="Z") M ^TMP("ORX",$J)=@ROOT@(ORI,2) S ORTXT=$NA(^TMP("ORX",$J)) Q  ;return text unresolved
"RTN","ORCD",155,0)
 N ARRAY,PTR,INST
"RTN","ORCD",156,0)
 D BLRPLT^TIUSRVD(.ORTXT,,+$G(ORVP),,$NA(@ROOT@(ORI,2)))
"RTN","ORCD",157,0)
 Q
"RTN","ORCD",158,0)
 ;
"RTN","ORCD",159,0)
DUP(PROMPT,CURRENT) ; -- Compare CURRENT instance of PROMPT for duplicates
"RTN","ORCD",160,0)
 N X,Y,I
"RTN","ORCD",161,0)
 S X=ORDIALOG(PROMPT,CURRENT),Y=0
"RTN","ORCD",162,0)
 S I=0 F  S I=$O(ORDIALOG(PROMPT,I)) Q:I'>0  I I'=CURRENT,$P(ORDIALOG(PROMPT,I),U)=$P(ORDIALOG(PROMPT,CURRENT),U) S Y=1 Q
"RTN","ORCD",163,0)
 Q Y
"RTN","ORCD",164,0)
 ;
"RTN","ORCD",165,0)
LIST ; -- Show contents of ORDIALOG(PROMPT,"LIST")
"RTN","ORCD",166,0)
 N NUM S NUM=$G(ORDIALOG(PROMPT,"LIST")) Q:'NUM
"RTN","ORCD",167,0)
 W !,"Choose from"_$S('$P(NUM,U,2):" (or enter another):",1:":")
"RTN","ORCD",168,0)
LIST1 N I,DONE,CNT S (I,CNT,DONE)=0
"RTN","ORCD",169,0)
 F  S I=$O(ORDIALOG(PROMPT,"LIST",I)) Q:I'>0  D  Q:DONE
"RTN","ORCD",170,0)
 . S CNT=CNT+1 I CNT>(IOSL-2) S CNT=0 I '$$MORE S DONE=1 Q
"RTN","ORCD",171,0)
 . W !,$J(I,6)_"   "_$P(ORDIALOG(PROMPT,"LIST",I),U,2)
"RTN","ORCD",172,0)
 Q
"RTN","ORCD",173,0)
 ;
"RTN","ORCD",174,0)
SETLIST ; -- Show allowable set of codes
"RTN","ORCD",175,0)
 W !,"Choose from:"
"RTN","ORCD",176,0)
SETLST1 N I,X F I=1:1:$L(DOMAIN,";") S X=$P(DOMAIN,";",I) I $L(X) D
"RTN","ORCD",177,0)
 . W !,?5,$P(X,":"),?15,$P(X,":",2)
"RTN","ORCD",178,0)
 Q
"RTN","ORCD",179,0)
 ;
"RTN","ORCD",180,0)
MORE() ; -- show more?
"RTN","ORCD",181,0)
 N X,Y,DIR
"RTN","ORCD",182,0)
 S DIR(0)="EA",DIR("A")="    press <return> to continue or ^ to exit ..."
"RTN","ORCD",183,0)
 D ^DIR
"RTN","ORCD",184,0)
 Q +Y
"RTN","ORCD",185,0)
 ;
"RTN","ORCD",186,0)
FIRST(P,I) ; -- Returns 1 or 0, if current instance I is first of multiple
"RTN","ORCD",187,0)
 Q '$O(ORDIALOG(P,I),-1)
"RTN","ORCD",188,0)
 ;
"RTN","ORCD",189,0)
RECALL(P,I) ; -- Returns first value for prompt P, instance I
"RTN","ORCD",190,0)
 N Y S:'$G(I) I=1 S Y=$G(^TMP("ORECALL",$J,+ORDIALOG,P,I))
"RTN","ORCD",191,0)
 Q Y
"RTN","ORCDFH1")
0^186^B22101872
"RTN","ORCDFH1",1,0)
ORCDFH1 ;SLC/MKB,DKM - Utility functions for FH dialogs cont ;8/24/01  10:22
"RTN","ORCDFH1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**73,95,243**;Dec 17, 1997;Build 242
"RTN","ORCDFH1",3,0)
 ;
"RTN","ORCDFH1",4,0)
RECENT ; -- get 5 most recent diet orders
"RTN","ORCDFH1",5,0)
 N ORDT,ORIFN,ORIT,ORTXT,ORCURR,I,X,CNT,INDT S ORDT=$$NOW^XLFDT,CNT=0
"RTN","ORCDFH1",6,0)
 F  S ORDT=$O(^OR(100,"AW",ORVP,ORDG,ORDT),-1) Q:ORDT'>0  S ORIFN=0 D  Q:CNT'<5
"RTN","ORCDFH1",7,0)
 . F  S ORIFN=$O(^OR(100,"AW",ORVP,ORDG,ORDT,ORIFN)) Q:ORIFN'>0  D  Q:CNT'<5
"RTN","ORCDFH1",8,0)
 .. S (ORIT,ORTXT)="" K ORCURR
"RTN","ORCDFH1",9,0)
 .. S:$P($G(^OR(100,+ORIFN,3)),U,3)=6 ORCURR=1 Q:'$O(^(.1,0))
"RTN","ORCDFH1",10,0)
 .. S I=0 F  S I=$O(^OR(100,ORIFN,.1,I)) Q:I'>0  S X=+$G(^(I,0)) I X D  ;**95
"RTN","ORCDFH1",11,0)
 ... S INDT=$G(^ORD(101.43,X,.1)) S ORIT=ORIT_$S($L(ORIT):";",1:"")_X,ORTXT=ORTXT_$S($L(ORTXT):", ",1:"")_$P($G(^ORD(101.43,X,0)),U)_$S(INDT&(INDT<$$NOW^XLFDT):" (*INACTIVE*)",1:"") ;**95
"RTN","ORCDFH1",12,0)
 .. Q:'ORIT  Q:'$L(ORTXT)  Q:ORTXT="NPO"
"RTN","ORCDFH1",13,0)
 .. S ORDIALOG(PROMPT,"LIST","D",ORIT)=ORIFN ;link oi string to order#
"RTN","ORCDFH1",14,0)
 .. Q:$G(ORCURR)  Q:+$G(ORDIALOG(PROMPT,"LIST","B",ORTXT))
"RTN","ORCDFH1",15,0)
 .. S CNT=CNT+1,ORDIALOG(PROMPT,"LIST",CNT)=ORIT_U_ORTXT
"RTN","ORCDFH1",16,0)
 .. S ORDIALOG(PROMPT,"LIST","B",ORTXT)=ORIT
"RTN","ORCDFH1",17,0)
 S ORDIALOG(PROMPT,"LIST")=CNT,ORDIALOG(PROMPT,"TOT")=0
"RTN","ORCDFH1",18,0)
 Q
"RTN","ORCDFH1",19,0)
 ;
"RTN","ORCDFH1",20,0)
PTR(X) ; -- Return ptr to Order Dialog file #101.41 for prompt X
"RTN","ORCDFH1",21,0)
 Q +$O(^ORD(101.41,"B","OR GTX "_X,0))
"RTN","ORCDFH1",22,0)
 ;
"RTN","ORCDFH1",23,0)
EXP ; -- Expand old order into instances
"RTN","ORCDFH1",24,0)
 N X,I,P,D S X=$G(ORDIALOG(PROMPT,ORI)) Q:'$L(X)  Q:X'[";"
"RTN","ORCDFH1",25,0)
 S ORDIALOG(PROMPT,ORI)=+X,I=ORI ;1st mod only
"RTN","ORCDFH1",26,0)
 F P=2:1:$L(X,";") S D=$P(X,";",P),I=I+1,ORDIALOG(PROMPT,I)=D,ORDIALOG(PROMPT,"TOT")=+$G(ORDIALOG(PROMPT,"TOT"))+1
"RTN","ORCDFH1",27,0)
 ;S:FIRST MAX=$L(X,";")
"RTN","ORCDFH1",28,0)
 Q
"RTN","ORCDFH1",29,0)
 ;
"RTN","ORCDFH1",30,0)
VALID() ; -- Returns 1 or 0, if selected diet modification is valid
"RTN","ORCDFH1",31,0)
 N Y,NUM,I,TOTAL,OI
"RTN","ORCDFH1",32,0)
 S OI=$G(ORDIALOG(PROMPT,ORI)) I OI[";" D  Q Y
"RTN","ORCDFH1",33,0)
 .S Y=1 D EXP
"RTN","ORCDFH1",34,0)
 .I $$INACTIVE S Y=0 S ORDIALOG(PROMPT,"TOT")=ORDIALOG(PROMPT,"TOT")-($L(OI,";")-1) F I=0:1:($L(OI,";")-1) K ORDIALOG(PROMPT,(I+ORI)) ;**95
"RTN","ORCDFH1",35,0)
 S Y=1,TOTAL=+$G(ORDIALOG(PROMPT,"TOT")),ORDIALOG(PROMPT,"MAX")=5,MAX=5
"RTN","ORCDFH1",36,0)
 I $$INACTIVE Q 0  ;**95
"RTN","ORCDFH1",37,0)
 ;S:FIRST MAX=$S($G(ORDIALOG(PROMPT,"LIST","D",OI)):1,1:5)
"RTN","ORCDFH1",38,0)
 S OI=$P($G(^ORD(101.43,+OI,0)),U)
"RTN","ORCDFH1",39,0)
 I (OI="REGULAR")!(OI="NPO") D  Q Y
"RTN","ORCDFH1",40,0)
 . I '$D(ORESET),TOTAL=0 S ORDIALOG(PROMPT,"MAX")=1,MAX=1 Q  ; add first
"RTN","ORCDFH1",41,0)
 . I $G(ORESET),TOTAL'>1 S ORDIALOG(PROMPT,"MAX")=1,MAX=1 Q  ; edit first
"RTN","ORCDFH1",42,0)
 . S Y=0 W $C(7),!,OI_" may not be ordered with other diets!"
"RTN","ORCDFH1",43,0)
 ;I $$DUP^ORCD(PROMPT,ORI) W $C(7),"This diet has already been selected!" Q 0  ;may delete after testing patch 95
"RTN","ORCDFH1",44,0)
 S NUM=$P($G(^ORD(101.43,+ORDIALOG(PROMPT,ORI),"FH")),U,2) ; precedence #
"RTN","ORCDFH1",45,0)
 S I=0 F  S I=$O(ORDIALOG(PROMPT,I)) Q:I'>0  D  Q:Y'>0
"RTN","ORCDFH1",46,0)
 . Q:I=ORI  Q:$P($G(^ORD(101.43,+ORDIALOG(PROMPT,I),"FH")),U,2)'=NUM  ;ok
"RTN","ORCDFH1",47,0)
 . S Y=0 W $C(7),!,"This diet is not orderable with those already selected!",!
"RTN","ORCDFH1",48,0)
 Q Y
"RTN","ORCDFH1",49,0)
 ;
"RTN","ORCDFH1",50,0)
PREV ; -- Ck if previous diet being reordered
"RTN","ORCDFH1",51,0)
 N I,OI,IFN S OI="",I=0
"RTN","ORCDFH1",52,0)
 F  S I=$O(ORDIALOG(PROMPT,I)) Q:I'>0  S OI=OI_$S(OI:";",1:"")_ORDIALOG(PROMPT,I)
"RTN","ORCDFH1",53,0)
 S IFN=$S(OI:$G(ORDIALOG(PROMPT,"LIST","D",OI)),1:"")
"RTN","ORCDFH1",54,0)
 S:IFN ORDIALOG("PREV")=IFN K:'IFN ORDIALOG("PREV")
"RTN","ORCDFH1",55,0)
 Q
"RTN","ORCDFH1",56,0)
 ;
"RTN","ORCDFH1",57,0)
CNV ; -- Convert meal abbreviation to time in X [Input Xform]
"RTN","ORCDFH1",58,0)
 ; Expects X,PROMPT [also called from Entry Action, DO^ORWDXM2]
"RTN","ORCDFH1",59,0)
 N A1 S X=$$UP^XLFSTR(X),A1=$P(X,"@",2)
"RTN","ORCDFH1",60,0)
 I A1?1U,"BNE"[A1 D
"RTN","ORCDFH1",61,0)
 . I $G(ORTYPE)="Z" S DATATYPE="",Y=X Q  ;editor - ok
"RTN","ORCDFH1",62,0)
 . N TIMES S TIMES=$S($D(ORPARAM(2)):$P(ORPARAM(2),U,7,9),1:"6:00A^12:00P^6:00P")
"RTN","ORCDFH1",63,0)
 . S A1=$S(A1="B":$P(TIMES,U),A1="N":$P(TIMES,U,2),A1="E":$P(TIMES,U,3),1:A1)
"RTN","ORCDFH1",64,0)
 . S $P(X,"@",2)=A1
"RTN","ORCDFH1",65,0)
 Q
"RTN","ORCDFH1",66,0)
 ;
"RTN","ORCDFH1",67,0)
LKUP ; -- special lookup routine for diet modifications
"RTN","ORCDFH1",68,0)
 G:'$G(ORDIALOG(PROMPT,"LIST")) LKQ N OROOT,Z
"RTN","ORCDFH1",69,0)
 S:X=" " X=$$SPACE^ORCDLG2(DOMAIN) S OROOT=$NA(ORDIALOG(PROMPT,"LIST"))
"RTN","ORCDFH1",70,0)
 S Y=$$FIND^ORCDLG2(OROOT,X)
"RTN","ORCDFH1",71,0)
 I Y Q:X?1N  Q:'$$MORE(X,Y)  S Z=$$OK Q:Z  I Z="^" S Y="^" Q
"RTN","ORCDFH1",72,0)
LKQ D DIC^ORCDLG2
"RTN","ORCDFH1",73,0)
 Q
"RTN","ORCDFH1",74,0)
 ;
"RTN","ORCDFH1",75,0)
MORE(XX,YY) ; -- Returns 1 or 0, if more matches exist
"RTN","ORCDFH1",76,0)
 Q:$P(YY,U)[";" 1 ;multiple mods
"RTN","ORCDFH1",77,0)
 N CNT,XP,NOW S CNT=0,XP=XX,NOW=+$$NOW^XLFDT
"RTN","ORCDFH1",78,0)
 F  S XP=$O(^ORD(101.43,"S.DO",XP)) Q:$E(XP,1,$L(XX))'=XX  D  Q:CNT
"RTN","ORCDFH1",79,0)
 . N IFN S IFN=$O(^ORD(101.43,"S.DO",XP,0)) Q:IFN=+YY  ;same mod
"RTN","ORCDFH1",80,0)
 . I $G(^ORD(101.43,IFN,.1)),$G(^(.1))'>NOW Q  ;inactive
"RTN","ORCDFH1",81,0)
 . S CNT=CNT+1
"RTN","ORCDFH1",82,0)
 Q CNT
"RTN","ORCDFH1",83,0)
 ;
"RTN","ORCDFH1",84,0)
OK() ; -- Verify multiple diet mod selection
"RTN","ORCDFH1",85,0)
 N X,Y,DIR S DIR(0)="YA",DIR("A")="   ... OK? ",DIR("B")="Yes"
"RTN","ORCDFH1",86,0)
 S DIR("?")="Enter YES if you wish to re-order this entire diet, or NO to search for another single diet modification"
"RTN","ORCDFH1",87,0)
 D ^DIR S:$D(DUOUT)!$D(DTOUT) Y="^"
"RTN","ORCDFH1",88,0)
 Q Y
"RTN","ORCDFH1",89,0)
INACTIVE() ;Check for inactive/duplicate diets in single or multiple modifications ;**95
"RTN","ORCDFH1",90,0)
 N I,Y
"RTN","ORCDFH1",91,0)
 S Y=0
"RTN","ORCDFH1",92,0)
 S I=0 F  S I=$O(ORDIALOG(PROMPT,I)) Q:'+I  D
"RTN","ORCDFH1",93,0)
 .I $G(^ORD(101.43,ORDIALOG(PROMPT,I),.1)),^(.1)<$$NOW^XLFDT S Y=1 W !,"The ",$P(^ORD(101.43,ORDIALOG(PROMPT,I),0),U)," diet is INACTIVE." Q  ;Quit if inactive diet found in order
"RTN","ORCDFH1",94,0)
 F I=0:1:($L(OI,";")-1) I $$DUP^ORCD(PROMPT,(I+ORI)) S Y=1 W !,"The ",$P(^ORD(101.43,ORDIALOG(PROMPT,(I+ORI)),0),U)," diet has already been selected." ;check for duplicate orders
"RTN","ORCDFH1",95,0)
 Q Y
"RTN","ORCDLG1")
0^106^B72953104
"RTN","ORCDLG1",1,0)
ORCDLG1 ; SLC/MKB - Order dialogs cont ;12/15/2006
"RTN","ORCDLG1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**60,71,95,110,243**;Dec 17, 1997;Build 242
"RTN","ORCDLG1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ORCDLG1",4,0)
EN(ITM,INST) ; -- ask each ITM prompt where
"RTN","ORCDLG1",5,0)
 ;    ORDIALOG(PROMPT,#) = internal form of each response
"RTN","ORCDLG1",6,0)
 ;
"RTN","ORCDLG1",7,0)
 N ITEM,COND,MULT,REQD,EDITONLY,DATATYPE,DOMAIN,DIR,Y,ACTION,PROMPT,ORX,VALIDEF
"RTN","ORCDLG1",8,0)
 S ITEM=$G(^ORD(101.41,+ORDIALOG,10,ITM,0)),COND=$G(^(3))
"RTN","ORCDLG1",9,0)
 S PROMPT=$P(ITEM,U,2) Q:'PROMPT  S:'$G(INST) INST=1
"RTN","ORCDLG1",10,0)
 S MULT=$P(ITEM,U,7),ACTION=$P(ITEM,U,9)
"RTN","ORCDLG1",11,0)
 S REQD=$P(ITEM,U,6),EDITONLY=$P(ITEM,U,8) S:$G(ORTYPE)="Z" (REQD,EDITONLY)=0
"RTN","ORCDLG1",12,0)
 I $D(^ORD(101.41,+ORDIALOG,10,ITM,9)) X ^(9) G:$G(ORQUIT) ENQ ;Entry
"RTN","ORCDLG1",13,0)
 I $G(ORTYPE)="Q",$D(ORDIALOG(PROMPT,INST)),$E(ORDIALOG(PROMPT,0))'="W" S EDITONLY=1
"RTN","ORCDLG1",14,0)
 I '$D(ORDIALOG(PROMPT,INST)) D  ; get default value
"RTN","ORCDLG1",15,0)
 . I $E(ORDIALOG(PROMPT,0))="W",$D(^ORD(101.41,+ORDIALOG,10,ITM,8))>9 M ^TMP("ORWORD",$J,PROMPT,INST)=^(8) S ORDIALOG(PROMPT,INST)="^TMP(""ORWORD"","_$J_","_PROMPT_","_INST_")" Q
"RTN","ORCDLG1",16,0)
 . K Y X:$D(^ORD(101.41,+ORDIALOG,10,ITM,7)) ^(7)
"RTN","ORCDLG1",17,0)
 . I $D(Y) S VALIDEF=$$VALID S:VALIDEF ORDIALOG(PROMPT,INST)=Y ;**95
"RTN","ORCDLG1",18,0)
 . I $G(VALIDEF)=0 W !,"The DEFAULT value for the ",$G(ORDIALOG(PROMPT,"A"))," prompt is invalid." S EDITONLY=0 ;**95
"RTN","ORCDLG1",19,0)
 . K VALIDEF ;**95
"RTN","ORCDLG1",20,0)
 I $G(AUTO),'REQD!($E(ORDIALOG(PROMPT,0))="W"&$D(ORDIALOG(PROMPT,INST))) S EDITONLY=1 ;Auto-accept
"RTN","ORCDLG1",21,0)
EN0 I FIRST&EDITONLY D:$D(ORDIALOG(PROMPT,INST))  G ENQ  ;ck child prompts
"RTN","ORCDLG1",22,0)
 . Q:'$D(^ORD(101.41,+ORDIALOG,10,"DAD",PROMPT))  N SEQ,DA,ITEM,PRMT,X,Y,VALIDEF ;**95
"RTN","ORCDLG1",23,0)
 . S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"DAD",PROMPT,SEQ)) Q:SEQ'>0  S DA=$O(^(SEQ,0)) D  Q:$G(ORQUIT)
"RTN","ORCDLG1",24,0)
 . . K VALIDEF ;110
"RTN","ORCDLG1",25,0)
 . . S ITEM=$G(^ORD(101.41,+ORDIALOG,10,DA,0)),PRMT=$P(ITEM,U,2)
"RTN","ORCDLG1",26,0)
 . . Q:$D(ORDIALOG(PRMT,INST))  ; already has a value
"RTN","ORCDLG1",27,0)
 . . K Y X:$D(^ORD(101.41,+ORDIALOG,10,DA,7)) ^(7)
"RTN","ORCDLG1",28,0)
 . . I $D(Y) S VALIDEF=$$VALID ;**95
"RTN","ORCDLG1",29,0)
 . . I $G(VALIDEF)!('$P(ITEM,U,6)) S:$G(VALIDEF) ORDIALOG(PRMT,INST)=Y Q  ;**95
"RTN","ORCDLG1",30,0)
 . . D EN(DA,INST) ; ask
"RTN","ORCDLG1",31,0)
 I ($G(OREDIT)&(ACTION'["C"))!($G(ORENEW)&(ACTION'["R")) G ENQ ;ask?
"RTN","ORCDLG1",32,0)
 I $G(OREWRITE),ACTION'["W",FIRST,'REQD!$D(ORDIALOG(PROMPT,INST)) G ENQ
"RTN","ORCDLG1",33,0)
 I $L(COND) X COND G:'$T ENQ ; failed condition
"RTN","ORCDLG1",34,0)
 M DIR=ORDIALOG(PROMPT) S DATATYPE=$E(DIR(0)),DOMAIN=$P(DIR(0),U,2)
"RTN","ORCDLG1",35,0)
 I 'MULT D WP^ORCDLG2:DATATYPE="W",ONE(INST,REQD):DATATYPE'="W" G ENQ
"RTN","ORCDLG1",36,0)
EN1 ; -- loop for multiples
"RTN","ORCDLG1",37,0)
 I '$O(ORDIALOG(PROMPT,0)) D  G:$G(ORQUIT)!('$O(ORDIALOG(PROMPT,0)))!FIRST ENQ
"RTN","ORCDLG1",38,0)
M1 . D ADDMULT Q:$G(ORQUIT)
"RTN","ORCDLG1",39,0)
 . Q:'REQD!$O(ORDIALOG(PROMPT,0))  I FIRST,$G(SEQ)=1 S ORQUIT=1 Q
"RTN","ORCDLG1",40,0)
 . W $C(7),!!,$$REQUIRED,! G M1
"RTN","ORCDLG1",41,0)
 F  S ORX=$$SELECT Q:ORX=""  S:ORX="^" ORQUIT=1 Q:$G(ORQUIT)  D  Q:$G(DIROUT)
"RTN","ORCDLG1",42,0)
 . S DIR("A")=ORDIALOG(PROMPT,"A"),X=$S('REQD:0,$$ONLY(ORX):1,1:0)
"RTN","ORCDLG1",43,0)
 . D ADDMULT:ORX="A",ONE(ORX,X):ORX Q:$G(DIROUT)  K ORQUIT,DIR("B")
"RTN","ORCDLG1",44,0)
 . I REQD,'$O(ORDIALOG(PROMPT,0)) W $C(7),!!,$$REQUIRED,!
"RTN","ORCDLG1",45,0)
ENQ X:$D(^ORD(101.41,+ORDIALOG,10,ITM,10)) ^(10) ; exit action
"RTN","ORCDLG1",46,0)
 Q
"RTN","ORCDLG1",47,0)
 ;
"RTN","ORCDLG1",48,0)
REQUIRED() ; -- Required response message
"RTN","ORCDLG1",49,0)
 Q "A response is required!  Enter '^' to quit."
"RTN","ORCDLG1",50,0)
 ;
"RTN","ORCDLG1",51,0)
SELECT() ; -- select instance of multiple to edit
"RTN","ORCDLG1",52,0)
 N DIR,X,Y,CNT,I,MAX,TOTAL,DONE
"RTN","ORCDLG1",53,0)
 S MAX=+$G(ORDIALOG(PROMPT,"MAX")),TOTAL=+$G(ORDIALOG(PROMPT,"TOT"))
"RTN","ORCDLG1",54,0)
 S DIR("A",1)=$S($L($G(ORDIALOG(PROMPT,"TTL"))):ORDIALOG(PROMPT,"TTL"),1:ORDIALOG(PROMPT,"A"))
"RTN","ORCDLG1",55,0)
 S (I,CNT)=0 F  S I=$O(ORDIALOG(PROMPT,I)) Q:I'>0  S CNT=CNT+1,CNT(CNT)=I,DIR("A",CNT+1)=$J(CNT,3)_": "_$$ITEM^ORCDLG(PROMPT,I) ; parent+children
"RTN","ORCDLG1",56,0)
 I 'MAX!(MAX&(MAX>TOTAL)) S CNT=CNT+1,CNT(CNT)="A",DIR("A",CNT+1)=$J(CNT,3)_": <enter more>"
"RTN","ORCDLG1",57,0)
 S DIR("A")="Select "_$S(CNT>1:"(1-"_CNT_")",1:1)_" or <return> to continue: "
"RTN","ORCDLG1",58,0)
 S DIR(0)="NAO^1:"_CNT,DIR("?")="Select the instance you wish to change"
"RTN","ORCDLG1",59,0)
S1 D ^DIR I $D(DTOUT)!(Y="^") Q "^"
"RTN","ORCDLG1",60,0)
 I Y?1"^".E D UJUMP Q:$G(ORQUIT)!($G(DONE)) "" G S1
"RTN","ORCDLG1",61,0)
 I Y="" Q Y
"RTN","ORCDLG1",62,0)
 Q CNT(Y)
"RTN","ORCDLG1",63,0)
 ;
"RTN","ORCDLG1",64,0)
ONLY(I) ; -- I the only instance?
"RTN","ORCDLG1",65,0)
 N J,Z S J=0,Z=1
"RTN","ORCDLG1",66,0)
 F  S J=$O(ORDIALOG(PROMPT,J)) Q:J'>0  I J'=I S Z=0 Q
"RTN","ORCDLG1",67,0)
 Q Z
"RTN","ORCDLG1",68,0)
 ;
"RTN","ORCDLG1",69,0)
ADDMULT ; -- add new instances of multiple
"RTN","ORCDLG1",70,0)
 N DONE,LAST,INST,MAX,ANOTHER
"RTN","ORCDLG1",71,0)
 S MAX=+$G(ORDIALOG(PROMPT,"MAX")) I MAX,MAX'>$G(ORDIALOG(PROMPT,"TOT")) W $C(7),!,"Only "_MAX_" items may be selected!",! Q
"RTN","ORCDLG1",72,0)
 S ANOTHER=$G(ORDIALOG(PROMPT,"MORE")) S:'$L(ANOTHER) ANOTHER="Another "
"RTN","ORCDLG1",73,0)
 S DIR("A")=$S($O(ORDIALOG(PROMPT,0)):ANOTHER,1:"")_ORDIALOG(PROMPT,"A")
"RTN","ORCDLG1",74,0)
 F  D  Q:$G(ORQUIT)!($G(DONE))  I MAX Q:MAX'>$G(ORDIALOG(PROMPT,"TOT"))
"RTN","ORCDLG1",75,0)
 . S INST=$O(ORDIALOG(PROMPT,"?"),-1)+1
"RTN","ORCDLG1",76,0)
 . D ONE(INST,0) I '$D(ORDIALOG(PROMPT,INST)) S DONE=1 Q
"RTN","ORCDLG1",77,0)
 . S ORDIALOG(PROMPT,"TOT")=+$G(ORDIALOG(PROMPT,"TOT"))+1,DIR("A")=ANOTHER_ORDIALOG(PROMPT,"A")
"RTN","ORCDLG1",78,0)
 Q
"RTN","ORCDLG1",79,0)
 ;
"RTN","ORCDLG1",80,0)
ONE(ORI,REQD) ; -- ask single-valued prompt
"RTN","ORCDLG1",81,0)
 N DONE,ORESET
"RTN","ORCDLG1",82,0)
 S:$D(ORDIALOG(PROMPT,ORI)) DIR("B")=$$EXT^ORCD(PROMPT,ORI),ORESET=ORDIALOG(PROMPT,ORI)
"RTN","ORCDLG1",83,0)
 F  D  Q:$G(DONE)  I $G(ORQUIT) Q:FIRST  Q:'REQD!$D(ORDIALOG(PROMPT,ORI))  S FIRST=$$DONE^ORCDLG2 Q:FIRST  K ORQUIT
"RTN","ORCDLG1",84,0)
 . D DIR^ORCDLG2 I $D(DTOUT)!$D(DIROUT)!(X=U) S ORQUIT=1 Q
"RTN","ORCDLG1",85,0)
 . I X="" S DONE=1 Q
"RTN","ORCDLG1",86,0)
 . I X?1"^".E D UJUMP Q
"RTN","ORCDLG1",87,0)
 . I X="@" D DELETE Q
"RTN","ORCDLG1",88,0)
 . I $E(DIR(0))="N",Y<1,$E(Y,1,2)'="0." S Y=0_Y
"RTN","ORCDLG1",89,0)
 . S ORDIALOG(PROMPT,ORI)=$P(Y,U),DONE=1
"RTN","ORCDLG1",90,0)
 . X:$L($G(^ORD(101.41,+ORDIALOG,10,ITM,5))) ^(5) I '$G(DONE) D RESET Q  ; validate - if failed, K DONE to reask
"RTN","ORCDLG1",91,0)
 . D:$D(^ORD(101.41,+ORDIALOG,10,"DAD",PROMPT)) CHILDREN(PROMPT,ORI) I '$G(DONE),'FIRST D DELCHILD(PROMPT,ORI),RESET Q
"RTN","ORCDLG1",92,0)
 Q
"RTN","ORCDLG1",93,0)
 ;
"RTN","ORCDLG1",94,0)
CHILDREN(PARENT,INST) ; -- ask child prompts
"RTN","ORCDLG1",95,0)
 N SEQ,DA,ORQUIT S SEQ=0
"RTN","ORCDLG1",96,0)
 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"DAD",PARENT,SEQ)) Q:SEQ'>0  S DA=$O(^(SEQ,0)) D EN(DA,INST) Q:$G(ORQUIT)
"RTN","ORCDLG1",97,0)
 K:$G(ORQUIT) DONE ; reask parent
"RTN","ORCDLG1",98,0)
 Q
"RTN","ORCDLG1",99,0)
 ;
"RTN","ORCDLG1",100,0)
RESET ; -- Reset original prompt value
"RTN","ORCDLG1",101,0)
 K ORDIALOG(PROMPT,ORI)
"RTN","ORCDLG1",102,0)
 S:$D(ORESET) ORDIALOG(PROMPT,ORI)=ORESET
"RTN","ORCDLG1",103,0)
 Q
"RTN","ORCDLG1",104,0)
 ;
"RTN","ORCDLG1",105,0)
UJUMP ; -- ^-jump
"RTN","ORCDLG1",106,0)
 N XP,P,CNT,MATCH,I,DIR,NEWSEQ ; XP=$$UP(X),P=PROMPT
"RTN","ORCDLG1",107,0)
 I $G(NOJUMP) W $C(7),"  ^-jumping not allowed!" Q
"RTN","ORCDLG1",108,0)
 S XP=$$UP^XLFSTR($P(X,U,2)) I "^"[XP S ORQUIT=1 Q
"RTN","ORCDLG1",109,0)
 I $G(ORDIALOG("B",XP)) S NEWSEQ=+ORDIALOG("B",XP) G UJQ
"RTN","ORCDLG1",110,0)
 S CNT=0,P=XP F  S P=$O(ORDIALOG("B",P)) Q:P=""  Q:$E(P,1,$L(XP))'=XP  Q:FIRST&(+ORDIALOG("B",P)'<SEQ)  S CNT=CNT+1,MATCH(CNT)=+ORDIALOG("B",P)_U_P ; =SEQ^TEXT
"RTN","ORCDLG1",111,0)
 I 'CNT W $C(7),"  ??" Q
"RTN","ORCDLG1",112,0)
 I CNT=1 S P=$P(MATCH(1),U,2) W $E(P,$L(XP)+1,$L(P)) S NEWSEQ=+MATCH(1) G UJQ
"RTN","ORCDLG1",113,0)
 F I=1:1:CNT S DIR("A",I)=I_"  "_$P(MATCH(I),U,2)
"RTN","ORCDLG1",114,0)
 S DIR("A")="Select 1-"_CNT_": ",DIR(0)="NAO^1:"_CNT
"RTN","ORCDLG1",115,0)
 S DIR("?")="Select the field you wish to jump to, by number"
"RTN","ORCDLG1",116,0)
 D ^DIR I $D(DTOUT)!($D(DUOUT))!(Y="") Q
"RTN","ORCDLG1",117,0)
 S NEWSEQ=+MATCH(Y)
"RTN","ORCDLG1",118,0)
UJQ I FIRST,NEWSEQ'<SEQ W $C(7),"  ^-jumping ahead not allowed now!" Q
"RTN","ORCDLG1",119,0)
 S SEQ=NEWSEQ-.01,DONE=1
"RTN","ORCDLG1",120,0)
 Q
"RTN","ORCDLG1",121,0)
 ;
"RTN","ORCDLG1",122,0)
DELETE ; -- delete response
"RTN","ORCDLG1",123,0)
 I '$D(DIR("B")) W $C(7),"  ??" Q
"RTN","ORCDLG1",124,0)
 Q:'$$SURE  S DONE=1
"RTN","ORCDLG1",125,0)
 K ORDIALOG(PROMPT,ORI),DIR("B")
"RTN","ORCDLG1",126,0)
 S:$G(ORDIALOG(PROMPT,"TOT")) ORDIALOG(PROMPT,"TOT")=ORDIALOG(PROMPT,"TOT")-1
"RTN","ORCDLG1",127,0)
 I $D(^ORD(101.41,+ORDIALOG,10,"DAD",PROMPT)) D DELCHILD(PROMPT,ORI)
"RTN","ORCDLG1",128,0)
 Q
"RTN","ORCDLG1",129,0)
 ;
"RTN","ORCDLG1",130,0)
DELCHILD(PARENT,INST) ; -- delete child prompts
"RTN","ORCDLG1",131,0)
 N SEQ,DA,PTR S:'$G(INST) INST=1
"RTN","ORCDLG1",132,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"DAD",PARENT,SEQ)) Q:SEQ'>0  S DA=$O(^(SEQ,0)),PTR=+$P($G(^ORD(101.41,+ORDIALOG,10,DA,0)),U,2) K:PTR ORDIALOG(PTR,INST)
"RTN","ORCDLG1",133,0)
 Q
"RTN","ORCDLG1",134,0)
 ;
"RTN","ORCDLG1",135,0)
SURE() ; -- sure you want to delete?
"RTN","ORCDLG1",136,0)
 N X,Y,DIR
"RTN","ORCDLG1",137,0)
 S DIR(0)="YA",DIR("A")="  Are you sure you want to delete this value? "
"RTN","ORCDLG1",138,0)
 S DIR("B")="NO" W $C(7) D ^DIR
"RTN","ORCDLG1",139,0)
 S:$D(DTOUT) Y="^"
"RTN","ORCDLG1",140,0)
 Q Y
"RTN","ORCDLG1",141,0)
 ;
"RTN","ORCDLG1",142,0)
VALID() ;Check to see if default value is valid.  Returns 0 or 1
"RTN","ORCDLG1",143,0)
 ;Entire section added in patch 95
"RTN","ORCDLG1",144,0)
 N TYPE,RANGE,MIN,MAX,DIR,X,ORDIC,DDS,RTYPE,ORIG
"RTN","ORCDLG1",145,0)
 I Y="" Q 1 ;If default is null allow to pass ;110
"RTN","ORCDLG1",146,0)
 S DIR(0)=$G(ORDIALOG(PROMPT,0)),(ORIG,X)=Y,DIR("V")="" ;Set reader type, default input, silent call
"RTN","ORCDLG1",147,0)
 S TYPE=$E($P(DIR(0),"^")) ;Get type of look-up being done
"RTN","ORCDLG1",148,0)
 I TYPE="W" Q 1 ;If word processing assume value is valid, may be referencing a global location
"RTN","ORCDLG1",149,0)
 I TYPE="R" S $P(DIR(0),"^")="D"_$E($P(DIR(0),"^"),2,999),TYPE="D",RTYPE=1 ;If type is R then change to date look up
"RTN","ORCDLG1",150,0)
 I TYPE="D" I X="AM"!(X="NEXT")!(X="NEXTA")!(X="CLOSEST") Q 1 ;If date/time prompt default is AM, NEXT, NEXTA, or CLOSEST then accept without checking
"RTN","ORCDLG1",151,0)
 S:TYPE="P"&(X=+X) X="`"_X ;If pointer type add ` to IEN for DIR call
"RTN","ORCDLG1",152,0)
 I TYPE="P" S ORDIC=$P(DIR(0),"^",2) S $P(ORDIC,":",2)=$TR($P(ORDIC,":",2),"QE","") S $P(DIR(0),"^",2)=ORDIC ;If pointer type remove Q&E from DIC(0) so no echo and no ?? on erroneous input
"RTN","ORCDLG1",153,0)
 I TYPE="D" S ORDIC=$P(DIR(0),"^",2) S $P(ORDIC,":",3)=$TR($P(ORDIC,":",3),"E",""),$P(ORDIC,":")=$TR($P(ORDIC,":"),"DTNOW",""),$P(DIR(0),"^",2)=ORDIC ;Remove "E" so no echo, remove DT and NOW so DIR call works correctly
"RTN","ORCDLG1",154,0)
 I TYPE="Y" S:"^Y^YE^YES^"[("^"_$TR(X,"yes","YES")_"^")!(X=1) X="YES" S:"^N^NO^"[("^"_$TR(X,"no","NO")_"^")!(X=0) X="NO" ;If yes/no type convert input to uppercase full entry to avoid echo
"RTN","ORCDLG1",155,0)
 I TYPE="S" S DDS=1 ;Stops DIR call from echoing rest of entry for set of codes
"RTN","ORCDLG1",156,0)
 D ^DIR
"RTN","ORCDLG1",157,0)
 I TYPE="D"&('$D(Y(0))) Q 0 ;Date not valid
"RTN","ORCDLG1",158,0)
 I TYPE="L"&($G(Y)="") Q 0 ;List/Range not valid
"RTN","ORCDLG1",159,0)
 I TYPE="N"&('$D(Y)) Q 0 ;Numeric not valid
"RTN","ORCDLG1",160,0)
 I TYPE="P"&($G(Y)=-1) Q 0 ;Pointer not valid
"RTN","ORCDLG1",161,0)
 I TYPE="S"&($G(Y(0))="") Q 0 ;Set of codes not valid
"RTN","ORCDLG1",162,0)
 I TYPE="Y"&($G(Y(0))="") Q 0 ;Yes/No not valid
"RTN","ORCDLG1",163,0)
 I TYPE="F" S RANGE=$P(DIR(0),"^",2),MIN=$S($P(RANGE,":"):$P(RANGE,":"),1:1),MAX=$S($P(RANGE,":",2):$P(RANGE,":",2),1:240) I $L(Y)<MIN!($L(Y)>MAX) Q 0 ;Free text and not within valid limit
"RTN","ORCDLG1",164,0)
 I $G(RTYPE) S Y=ORIG ;Set y back to relative date
"RTN","ORCDLG1",165,0)
 I TYPE="P" S Y=$P(Y,"^") ;only store IEN ;110
"RTN","ORCDLG1",166,0)
 Q 1 ;Must be valid
"RTN","ORCDLG2")
0^107^B64872872
"RTN","ORCDLG2",1,0)
ORCDLG2 ;SLC/MKB-Order dialogs cont ;10/12/2007
"RTN","ORCDLG2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,60,79,94,243**;Dec 17, 1997;Build 242
"RTN","ORCDLG2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ORCDLG2",4,0)
DIR ; -- ^DIR read of X, returns Y
"RTN","ORCDLG2",5,0)
 N INPUTXFM,LKUP,REPL K DTOUT,DUOUT,DIRUT,DIROUT,DDER,Y
"RTN","ORCDLG2",6,0)
 S (X,Y)="",INPUTXFM=$P(DIR(0),U,3,99)
"RTN","ORCDLG2",7,0)
 S LKUP=$G(ORDIALOG(PROMPT,"LKP")) ; special lookup rtn
"RTN","ORCDLG2",8,0)
 S REPL=$S(DATATYPE'="F":0,$L($G(DIR("B")))>20:1,1:0) S:REPL DIR(0)=$E(DIR(0))_"AO^"_$P(DIR(0),U,2,99)
"RTN","ORCDLG2",9,0)
DIR1 I 'REPL W !,DIR("A")_$S($D(DIR("B")):DIR("B")_"// ",1:"") R X:DTIME I '$T S DTOUT=1 Q
"RTN","ORCDLG2",10,0)
 I REPL D ^DIR Q:$D(DTOUT)!$D(DUOUT)
"RTN","ORCDLG2",11,0)
 I X="" S:$D(DIR("B")) X=DIR("B"),Y=ORDIALOG(PROMPT,ORI) S:'$L(X)&(SEQ=1)&('MULT) X="^" Q:'REQD!$L(X)  W $C(7),!!,$$REQUIRED^ORCDLG1,! G DIR1
"RTN","ORCDLG2",12,0)
 I X="@" Q:'REQD  W $C(7),!!,$$REQUIRED^ORCDLG1,! G DIR1
"RTN","ORCDLG2",13,0)
 I X?1"^".E S (DUOUT,DIRUT)=1,Y=X S:X="^^" DIROUT=1 Q
"RTN","ORCDLG2",14,0)
 I X?1"?".E D  G DIR1
"RTN","ORCDLG2",15,0)
 . N XHELP
"RTN","ORCDLG2",16,0)
 . S XHELP=$S($D(DIR("??")):$P(DIR("??"),U,2,99),1:("D "_DATATYPE_"^ORCDLGH"))
"RTN","ORCDLG2",17,0)
 . I (DATATYPE="P")!(DATATYPE="S")!(X?1"??".E) X XHELP
"RTN","ORCDLG2",18,0)
 . S:'$D(DIR("?")) DIR("?")=$$HELP(DATATYPE)
"RTN","ORCDLG2",19,0)
 . I $L(DIR("?"))<80 W !,DIR("?"),!
"RTN","ORCDLG2",20,0)
 . E  D  W !
"RTN","ORCDLG2",21,0)
 . . N X,DIWL,DIWR,I S X=DIR("?"),DIWL=1,DIWR=80 K ^UTILITY($J,"W")
"RTN","ORCDLG2",22,0)
 . . D ^DIWP F I=1:1:^UTILITY($J,"W",DIWL) W !,$G(^UTILITY($J,"W",DIWL,I,0))
"RTN","ORCDLG2",23,0)
 I $L(INPUTXFM) X INPUTXFM I '$D(X) D ERR G DIR1
"RTN","ORCDLG2",24,0)
 I $L(LKUP),$L($T(@LKUP)) D @LKUP Q:Y>0  D ERR G DIR1
"RTN","ORCDLG2",25,0)
 I $G(ORDIALOG(PROMPT,"LIST")) D  Q:$L(Y)  I $P(ORDIALOG(PROMPT,"LIST"),U,2) W $C(7) D LIST^ORCD G DIR1
"RTN","ORCDLG2",26,0)
 . N OROOT S OROOT="ORDIALOG("_PROMPT_",""LIST"")"
"RTN","ORCDLG2",27,0)
 . S:(X=" ")&(DATATYPE="P") X=$$SPACE(DOMAIN)
"RTN","ORCDLG2",28,0)
 . S Y=$$FIND(OROOT,X) ; I X'[",",X'["-" S Y=$$FIND Q
"RTN","ORCDLG2",29,0)
 . ; S ORX=$$EXPLIST(X) F  S Y(Y+1)=$$FIND
"RTN","ORCDLG2",30,0)
 I DATATYPE="P" D DIC I Y'>0 D ERR G DIR1
"RTN","ORCDLG2",31,0)
 I (DATATYPE="R")!(DATATYPE="D") D DT I Y<0 D ERR G DIR1
"RTN","ORCDLG2",32,0)
 I "^F^N^S^Y^"[(U_DATATYPE_U) D  I $G(DDER) D ERR G DIR1 ;JEH 'REPL was  checked 
"RTN","ORCDLG2",33,0)
 . N I F I=1:1:31 S X=$TR(X,$C(I)) ; strip out control char's
"RTN","ORCDLG2",34,0)
 . S DIR("V")="" D ^DIR ; silent
"RTN","ORCDLG2",35,0)
 Q
"RTN","ORCDLG2",36,0)
 ;
"RTN","ORCDLG2",37,0)
ERR ; -- show help msg on error
"RTN","ORCDLG2",38,0)
 W:$D(DIR("?")) $C(7),!,DIR("?"),!
"RTN","ORCDLG2",39,0)
 Q
"RTN","ORCDLG2",40,0)
 ;
"RTN","ORCDLG2",41,0)
FIND(LIST,X) ; -- find value X in LIST(#) or LIST("B",name)
"RTN","ORCDLG2",42,0)
 N Y,XP,CNT,MATCH,I,DIR
"RTN","ORCDLG2",43,0)
 S:$L(X)>63 X=$E(X,1,63) S X=$$UP^XLFSTR(X)
"RTN","ORCDLG2",44,0)
 S CNT=0,XP="" F  S XP=$O(@LIST@("B",XP)) Q:XP=""  I $S(X=+X:+XP=+X,1:$E(XP,1,$L(X))=X) S CNT=CNT+1,MATCH(CNT)=@LIST@("B",XP)_U_XP,DIR("A",CNT)=$J(CNT,3)_" "_XP
"RTN","ORCDLG2",45,0)
 I X=+X!(X?1"0."1.N) S Y=$G(@LIST@(X)) I $L(Y) W "   "_$P(Y,U,2) G:$$OK FQ S X="" W "   " ;force entire text to echo if CNT=1
"RTN","ORCDLG2",46,0)
 I 'CNT S Y="" G FQ
"RTN","ORCDLG2",47,0)
 I CNT=1 S Y=MATCH(1),XP=$P(Y,U,2) W $E(XP,$L(X)+1,$L(XP)) G FQ
"RTN","ORCDLG2",48,0)
 S DIR("A")="Select 1-"_CNT_": ",DIR(0)="NAO^1:"_CNT
"RTN","ORCDLG2",49,0)
 S DIR("?")="Select the desired value, by number"
"RTN","ORCDLG2",50,0)
 D ^DIR I $D(DTOUT)!($D(DUOUT))!(Y="") S Y="" G FQ
"RTN","ORCDLG2",51,0)
 S Y=MATCH(Y) W "  "_$P(Y,U,2)
"RTN","ORCDLG2",52,0)
FQ D:Y&((+DOMAIN=101.43)!(DOMAIN?1"ORD(101.43,:".E)) SETDISV
"RTN","ORCDLG2",53,0)
 Q Y
"RTN","ORCDLG2",54,0)
 ;
"RTN","ORCDLG2",55,0)
OK() ; -- Return 1 or 0, if selected item is correct
"RTN","ORCDLG2",56,0)
 N X,Y,DIR I CNT'>0 Q 1 ;no other matches
"RTN","ORCDLG2",57,0)
 S DIR(0)="YA",DIR("A")="   ...OK? ",DIR("B")="YES"
"RTN","ORCDLG2",58,0)
 S DIR("?")="Enter YES if this is the item you wish to select, or NO to continue searching the list"
"RTN","ORCDLG2",59,0)
 D ^DIR S:$D(DUOUT)!$D(DTOUT) Y=""
"RTN","ORCDLG2",60,0)
 Q +Y
"RTN","ORCDLG2",61,0)
 ;
"RTN","ORCDLG2",62,0)
DIC ; -- ^DIC lookup on X, return Y
"RTN","ORCDLG2",63,0)
 N ORDMN,ORDITM,DIC,D,ORDIC,TYPE S Y=-1,ORDMN=$P(ORDIALOG(PROMPT,0),U,2)
"RTN","ORCDLG2",64,0)
 S ORDITM=$S(+ORDMN=101.43:1,ORDMN?1"ORD(101.43,:".E:1,1:0) ; OI file?
"RTN","ORCDLG2",65,0)
 I X=" ",ORDITM D SPBAR W $S(Y>0:"   "_X,1:$C(7)_"  ??") Q
"RTN","ORCDLG2",66,0)
 I ORDITM,X?1"`"1.N W $C(7),!,"Lookup by internal entry number not allowed!",! Q
"RTN","ORCDLG2",67,0)
 I X=$G(DIR("B")) S Y=ORDIALOG(PROMPT,ORI) Q  ; default
"RTN","ORCDLG2",68,0)
 S DIC=$P(ORDMN,":"),DIC(0)=$P(ORDMN,":",2),ORDIC="^DIC" S:'DIC DIC=U_DIC
"RTN","ORCDLG2",69,0)
 S:$D(ORDIALOG(PROMPT,"S")) DIC("S")=ORDIALOG(PROMPT,"S")
"RTN","ORCDLG2",70,0)
 S TYPE=$P($G(^ORD(100.98,+$G(ORDG),0)),U,3)
"RTN","ORCDLG2",71,0)
 S:ORDITM DIC("W")="W:$S('$D(%):0,'$D(DIY):0,%=DIY:0,1:1) $G(DIY)"_$S(TYPE["RX":" W:$P($G(^(""PS"")),U,6) ""   (non-formulary)"" ",1:"") ;W NAME if OI/synm, or NF
"RTN","ORCDLG2",72,0)
 S D=$G(ORDIALOG(PROMPT,"D")),D=$TR(D,";","^")
"RTN","ORCDLG2",73,0)
 I $L(D) S ORDIC="IX^DIC" S:$L(D,U)>1 ORDIC="MIX^DIC1",DIC(0)=DIC(0)_"M"
"RTN","ORCDLG2",74,0)
 D @ORDIC,SETDISV:Y&ORDITM
"RTN","ORCDLG2",75,0)
 I DIC(0)["S",X'=$P(Y,"^",2) W "  ",$P(Y,"^",2)
"RTN","ORCDLG2",76,0)
 Q
"RTN","ORCDLG2",77,0)
 ;
"RTN","ORCDLG2",78,0)
SPACE(FILE) ; -- Resolve spbar-return for ptrs
"RTN","ORCDLG2",79,0)
 N X,Y,DIC,ROOT S X=" ",FILE=$P(FILE,":")
"RTN","ORCDLG2",80,0)
 I (+FILE=101.43)!(FILE="ORD(101.43,") D SPBAR Q X
"RTN","ORCDLG2",81,0)
 S ROOT=$S(+FILE:$$ROOT^DILFD(+FILE),1:U_FILE),Y=$G(^DISV(DUZ,ROOT))
"RTN","ORCDLG2",82,0)
 S:Y X=$P(@(ROOT_Y_",0)"),U)
"RTN","ORCDLG2",83,0)
 Q X
"RTN","ORCDLG2",84,0)
 ;
"RTN","ORCDLG2",85,0)
SPBAR ; -- Resolve spbar-return for #101.43
"RTN","ORCDLG2",86,0)
 N SDX,I,X1,D S SDX="",D=$G(ORDIALOG(PROMPT,"D")),D=$TR(D,";","^")
"RTN","ORCDLG2",87,0)
 F I=1:1:$L(D,"^") I $P(D,U,I)?1"S."1.E S SDX=$P(D,U,I) Q
"RTN","ORCDLG2",88,0)
 Q:'$L(SDX)  S X1=$G(^DISV(DUZ,"ORDITM",SDX,1)) Q:'$L(X1)
"RTN","ORCDLG2",89,0)
 S Y=$O(^ORD(101.43,SDX,X1,0)) S:Y X=X1,Y=Y_U_X1
"RTN","ORCDLG2",90,0)
 Q
"RTN","ORCDLG2",91,0)
 ;
"RTN","ORCDLG2",92,0)
SETDISV ; -- Save entry Y=ifn^name in ^DISV for #101.43
"RTN","ORCDLG2",93,0)
 N SDX,I Q:'$L($P(Y,U,2))
"RTN","ORCDLG2",94,0)
 S SDX="",D=$G(ORDIALOG(PROMPT,"D")) Q:D'["S."
"RTN","ORCDLG2",95,0)
 F I=1:1:$L(D,";") I $P(D,";",I)?1"S."1.E S SDX=$P(D,";",I) Q
"RTN","ORCDLG2",96,0)
 Q:'$L(SDX)  S ^DISV(DUZ,"ORDITM",SDX,1)=$P(Y,U,2)
"RTN","ORCDLG2",97,0)
 Q
"RTN","ORCDLG2",98,0)
 ;
"RTN","ORCDLG2",99,0)
DT ; -- %DT validation on X, return Y
"RTN","ORCDLG2",100,0)
 N %DT,BEG,END S %DT=$P(DOMAIN,":",3),X=$$UP^XLFSTR(X)
"RTN","ORCDLG2",101,0)
 I $L($P(DOMAIN,":")) S BEG=$$FMDT($P(DOMAIN,":")) ;earliest date allowed
"RTN","ORCDLG2",102,0)
 I $L($P(DOMAIN,":",2)) S END=$$FMDT($P(DOMAIN,":",2)) ;latest allowed
"RTN","ORCDLG2",103,0)
 D ^%DT Q:Y'>0
"RTN","ORCDLG2",104,0)
 I $G(BEG) D  Q:Y<0
"RTN","ORCDLG2",105,0)
 . I $L(Y,".")'=$L(BEG,".") S BEG=$P(BEG,".") ; date only
"RTN","ORCDLG2",106,0)
 . I Y<BEG W $C(7),!,"Date may not be before "_$$FMTE^XLFDT(BEG) S Y=-1 Q
"RTN","ORCDLG2",107,0)
 I $G(END) D  Q:Y<0
"RTN","ORCDLG2",108,0)
 . I $L(Y,".")'=$L(END,".") S END=$P(END,".") ; date only
"RTN","ORCDLG2",109,0)
 . I Y>END W $C(7),!,"Date may not be after "_$$FMTE^XLFDT(END) S Y=-1 Q
"RTN","ORCDLG2",110,0)
 I DATATYPE="R",$$RELDT(X) S:(%DT'["T")&("NOW"[X) X="TODAY" S Y=X ;text
"RTN","ORCDLG2",111,0)
 Q
"RTN","ORCDLG2",112,0)
DT1 S:X="NOON" X="T@NOON" S:$E("MIDNIGHT",1,$L(X))=X X="T@MIDNIGHT"
"RTN","ORCDLG2",113,0)
 I X'?1"V".E,X'?1"T".E D ^%DT S:Y>0&("NOW"[X) Y="NOW" Q
"RTN","ORCDLG2",114,0)
 S D=$$UP^XLFSTR($P(X,"@")),T=$P(X,"@",2)
"RTN","ORCDLG2",115,0)
 S Y=$E(D) I "VT"'[Y S Y=-1 Q
"RTN","ORCDLG2",116,0)
 I (D["+")!(D["-") D  Q:Y<0
"RTN","ORCDLG2",117,0)
 . N SIGN,OFFSET,X1,X2
"RTN","ORCDLG2",118,0)
 . S SIGN=$S(D["+":"+",1:"-"),OFFSET=$P(D,SIGN,2) I 'OFFSET S Y=-1 Q
"RTN","ORCDLG2",119,0)
 . S X1=+OFFSET,X2=$P(OFFSET,X1,2) I "DWM"'[$E(X2) S Y=-1 Q
"RTN","ORCDLG2",120,0)
 . S Y=Y_SIGN_X1_$E(X2) ; T+3W, e.g.
"RTN","ORCDLG2",121,0)
 I '$L(T)&(DOMAIN["R") S Y=-1 Q  ; time missing, required
"RTN","ORCDLG2",122,0)
 I $L(T) D  I '$D(T) S Y=-1 Q
"RTN","ORCDLG2",123,0)
 . I '(DOMAIN["T"!(DOMAIN["R")) K T Q  ; time prohibited
"RTN","ORCDLG2",124,0)
 . N X,Y S X="T@"_T,%DT=$TR(DOMAIN,"E") D ^%DT I Y<0 K T Q
"RTN","ORCDLG2",125,0)
 . S T=$E($P(Y,".",2),1,4) S:$L(T)<4 T=T_$E("0000",1,4-$L(T))
"RTN","ORCDLG2",126,0)
 S:$L(T) Y=Y_"@"_T ; Y=date text, or -1 if error
"RTN","ORCDLG2",127,0)
 Q
"RTN","ORCDLG2",128,0)
 ;
"RTN","ORCDLG2",129,0)
RELDT(X) ; -- Returns 1 or 0, if X is relative date
"RTN","ORCDLG2",130,0)
 N Y S X=$G(X)
"RTN","ORCDLG2",131,0)
 I ("NOON"[X)!("MIDNIGHT"[X)!($E(X)="T")!($E(X)="N") S Y=1
"RTN","ORCDLG2",132,0)
 E  S Y=0
"RTN","ORCDLG2",133,0)
 Q Y
"RTN","ORCDLG2",134,0)
 ;
"RTN","ORCDLG2",135,0)
FMDT(X) ; -- Return FM form of date X
"RTN","ORCDLG2",136,0)
 N Y,%DT S %DT="T" D ^%DT
"RTN","ORCDLG2",137,0)
 Q Y
"RTN","ORCDLG2",138,0)
 ;
"RTN","ORCDLG2",139,0)
WP ; -- edit WP field
"RTN","ORCDLG2",140,0)
 N DIC,DWLW,DWPK,DIWESUB,DONE,ORLINEDT,LCNT,UPCARR
"RTN","ORCDLG2",141,0)
 S DIC="^TMP(""ORWORD"",$J,"_PROMPT_","_INST_",",DWLW=80,DWPK=1
"RTN","ORCDLG2",142,0)
 S DIWESUB=$P(DIR("A"),":"),ORLINEDT=$$LINEDTR(DUZ)
"RTN","ORCDLG2",143,0)
 I '$D(^TMP("ORWORD",$J,PROMPT,INST)) M:$D(^ORD(101.41,+ORDIALOG,10,ITM,8))>9 ^TMP("ORWORD",$J,PROMPT,INST)=^(8)
"RTN","ORCDLG2",144,0)
 I 'ORLINEDT,'REQD,'$$EDITWP Q  ;94
"RTN","ORCDLG2",145,0)
WP1 W:ORLINEDT !,DIR("A") S DIWESUB=$P(DIR("A"),":")
"RTN","ORCDLG2",146,0)
 D EN^DIWE I $D(DTOUT)!($D(DUOUT)) S ORQUIT=1 Q
"RTN","ORCDLG2",147,0)
 I REQD,'$O(^TMP("ORWORD",$J,PROMPT,INST,0)) W $C(7),!!,"A response is required!" G:'$$DONE WP1 S ORQUIT=1 Q
"RTN","ORCDLG2",148,0)
 I '$O(^TMP("ORWORD",$J,PROMPT,INST,0)) K ^TMP("ORWORD",$J,PROMPT,INST),ORDIALOG(PROMPT,INST) Q  ;empty
"RTN","ORCDLG2",149,0)
 S LCNT="",UPCARR=0
"RTN","ORCDLG2",150,0)
 F  S LCNT=$O(^TMP("ORWORD",$J,PROMPT,INST,LCNT)) Q:LCNT=""!(UPCARR=1)  D
"RTN","ORCDLG2",151,0)
 .I LCNT>0,$G(^TMP("ORWORD",$J,PROMPT,INST,LCNT,0))[U S UPCARR=1
"RTN","ORCDLG2",152,0)
 I UPCARR=1 W !!,"An ""^"" is not allowed in a word processing field." G:'$$DONE WP1 S ORQUIT=1 Q
"RTN","ORCDLG2",153,0)
 S ORDIALOG(PROMPT,INST)="^TMP(""ORWORD"","_$J_","_PROMPT_","_INST_")",DONE=1
"RTN","ORCDLG2",154,0)
 I $D(^ORD(101.41,+ORDIALOG,10,ITM,5)) X ^(5) Q:$G(ORQUIT)!($G(DONE))  G WP1
"RTN","ORCDLG2",155,0)
 Q
"RTN","ORCDLG2",156,0)
 ;
"RTN","ORCDLG2",157,0)
EDITWP() ; -- Want to edit WP field?
"RTN","ORCDLG2",158,0)
 N X,Y,%,%Y
"RTN","ORCDLG2",159,0)
 W !,ORDIALOG(PROMPT,"A") S Y=$D(ORDIALOG(PROMPT,INST))
"RTN","ORCDLG2",160,0)
 I 'Y,REQD Q 1 ; no data, req'd
"RTN","ORCDLG2",161,0)
 W:'Y !,"  No existing text",! I Y D  ; show comments
"RTN","ORCDLG2",162,0)
 . N X,DIWL,DIWR,DIWF,ORI
"RTN","ORCDLG2",163,0)
 . S DIWL=3,DIWR=79,DIWF="W" K ^UTILITY($J,"W")
"RTN","ORCDLG2",164,0)
 . S ORI=0 F  S ORI=$O(^TMP("ORWORD",$J,PROMPT,INST,ORI)) Q:ORI'>0  S X=$G(^(ORI,0)) D:$L(X) ^DIWP
"RTN","ORCDLG2",165,0)
 . D ^DIWW
"RTN","ORCDLG2",166,0)
ED1 S %=$S($D(OREDIT):1,1:2) W "  Edit" D YN^DICN
"RTN","ORCDLG2",167,0)
 I %=0 W !,"  Enter 'YES' if you wish to go into the editor.",!,"  Enter 'NO' if you do not wish to edit at this time.",! G ED1
"RTN","ORCDLG2",168,0)
 S Y=$S(%<0:"^",%=2:0,1:1)
"RTN","ORCDLG2",169,0)
 Q Y
"RTN","ORCDLG2",170,0)
 ;
"RTN","ORCDLG2",171,0)
LINEDTR(USER) ; -- Returns 1 or 0, if user's editor will be LineEd
"RTN","ORCDLG2",172,0)
 N X,Y
"RTN","ORCDLG2",173,0)
 S X=+$P($G(^VA(200,USER,1)),U,5),Y=0 I 'X S Y=1
"RTN","ORCDLG2",174,0)
 E  S:$$GET1^DIQ(1.2,+X_",",.01)="LINE EDITOR - VA FILEMAN" Y=1
"RTN","ORCDLG2",175,0)
 Q Y
"RTN","ORCDLG2",176,0)
 ;
"RTN","ORCDLG2",177,0)
RETURN() ; -- press return to cont
"RTN","ORCDLG2",178,0)
 N X W !,"Press <return> to continue ..." R X:DTIME
"RTN","ORCDLG2",179,0)
 Q ""
"RTN","ORCDLG2",180,0)
 ;
"RTN","ORCDLG2",181,0)
DONE() ; -- Done editing?
"RTN","ORCDLG2",182,0)
 N DIR,X,Y
"RTN","ORCDLG2",183,0)
 S DIR(0)="YA",DIR("A")="Do you want to quit? ",DIR("B")="NO"
"RTN","ORCDLG2",184,0)
 S DIR("?")="Enter YES to exit this order, or NO to continue editing"
"RTN","ORCDLG2",185,0)
 D ^DIR
"RTN","ORCDLG2",186,0)
 Q +Y
"RTN","ORCDLG2",187,0)
 ;
"RTN","ORCDLG2",188,0)
HELP(TYPE) ; -- Returns default help msg for TYPE prompt
"RTN","ORCDLG2",189,0)
 N Y S Y=""
"RTN","ORCDLG2",190,0)
 I TYPE="D" S Y="Enter a date[/time]."
"RTN","ORCDLG2",191,0)
 I TYPE="R" S Y="Enter a date[/time] as T for TODAY or T+1 for TOMORROW."
"RTN","ORCDLG2",192,0)
 I TYPE="F" S Y="Enter a string of text."
"RTN","ORCDLG2",193,0)
 I TYPE="N" S Y="Enter a number."
"RTN","ORCDLG2",194,0)
 I TYPE="S" S Y="Enter an item from the list."
"RTN","ORCDLG2",195,0)
 I TYPE="Y" S Y="Enter YES or NO."
"RTN","ORCDLG2",196,0)
 I TYPE="P" S Y="Enter an item from the file."
"RTN","ORCDLG2",197,0)
 I TYPE="W" S Y=""
"RTN","ORCDLG2",198,0)
 Q Y
"RTN","ORCDLR")
0^9^B57494194
"RTN","ORCDLR",1,0)
ORCDLR ;SLC/MKB-Utility functions for LR dialogs ;11/22/06
"RTN","ORCDLR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,29,49,61,71,79,175,243**;Dec 17, 1997;Build 242
"RTN","ORCDLR",3,0)
TEST ; -- Setup ORTEST() array of ordering parameters
"RTN","ORCDLR",4,0)
 N OI,TST,WRD,I,DG
"RTN","ORCDLR",5,0)
 S OI=+$G(ORDIALOG(PROMPT,INST)) Q:'OI
"RTN","ORCDLR",6,0)
 I '$D(ORTEST) S TST=+$P($G(^ORD(101.43,OI,0)),U,2) D TEST^LR7OR3(TST,.ORTEST) S ORTEST=TST
"RTN","ORCDLR",7,0)
 S WRD="GenWardInstructions" I $O(ORTEST(WRD,0)) D  W !
"RTN","ORCDLR",8,0)
 . W ! S I=0 F  S I=$O(ORTEST(WRD,I)) Q:I'>0  W !,ORTEST(WRD,I,0)
"RTN","ORCDLR",9,0)
 S DG=$P($G(^ORD(101.43,+OI,"LR")),U,6) S:'$L(DG) DG="LAB"
"RTN","ORCDLR",10,0)
 S DG=$O(^ORD(100.98,"B",DG,0)) S:DG ORDG=DG
"RTN","ORCDLR",11,0)
 Q
"RTN","ORCDLR",12,0)
 ;
"RTN","ORCDLR",13,0)
CKTYP ; -- ck type of test [Exit Action]
"RTN","ORCDLR",14,0)
 N X,Y S X=$G(ORDIALOG(PROMPT,INST)) Q:'X
"RTN","ORCDLR",15,0)
 S Y=$P($G(^ORD(101.43,+X,"LR")),U,7)
"RTN","ORCDLR",16,0)
 I (Y="O")!(Y="N") W $C(7),!,"This test may not be ordered anymore.  Please select another test." S ORQUIT=1 D WAIT Q
"RTN","ORCDLR",17,0)
 Q
"RTN","ORCDLR",18,0)
 ;
"RTN","ORCDLR",19,0)
WAIT ; -- Wait for user
"RTN","ORCDLR",20,0)
 N X W !,"Press <return> to continue ..." R X:DTIME
"RTN","ORCDLR",21,0)
 Q
"RTN","ORCDLR",22,0)
 ;
"RTN","ORCDLR",23,0)
SHOWMAX ; -- Setup max days allowed for cont orders
"RTN","ORCDLR",24,0)
 K ^TMP($J,"ORCDLR SHOWMAX")
"RTN","ORCDLR",25,0)
 D ZERO^PSS51P1(+ORSCH,,,,"ORCDLR SHOWMAX")
"RTN","ORCDLR",26,0)
 I $S('$G(ORSCH):1,"CD"'[$P($G(^TMP($J,"ORCDLR SHOWMAX",+ORSCH,5)),U):1,1:0) K ORDIALOG(PROMPT,INST) Q  ;just in case
"RTN","ORCDLR",27,0)
 ;I $S('$G(ORSCH):1,"CD"'[$P($G(^PS(51.1,+ORSCH,0)),U,5):1,1:0) K ORDIALOG(PROMPT,INST) Q  ;just in case
"RTN","ORCDLR",28,0)
 N Y,OK S ORSMAX=$G(^TMP($J,"ORCDLR SHOWMAX",+ORSCH,2.5)),ORSTMS=$P($G(^(0)),U,3)
"RTN","ORCDLR",29,0)
 ;N Y,OK S ORSMAX=$P($G(^PS(51.1,ORSCH,0)),U,7),ORSTMS=$P($G(^(0)),U,3)
"RTN","ORCDLR",30,0)
 S ORSMAX=$S('$G(ORSMAX):ORMAX,$G(ORTYPE)="Z":ORSMAX,ORMAX<ORSMAX:ORMAX,1:ORSMAX),ORSTMS=$S(ORSMAX&ORSTMS:ORSMAX*1440\ORSTMS,1:"") ;set max days, times
"RTN","ORCDLR",31,0)
 I FIRST,$G(ORTYPE)="Q" S Y=$G(ORDIALOG(PROMPT,INST)) I $L(Y) S OK=$$CKMAX(Y) Q:OK  K ORDIALOG(PROMPT,INST) ;Q if valid, else fall thru and prompt
"RTN","ORCDLR",32,0)
 W !!,"Maximum number of days for continuous orders is "_ORSMAX_"; enter a duration",!,"as either a number of days (3) or Xnumber of times (X3).",!
"RTN","ORCDLR",33,0)
 K ^TMP($J,"ORCDLR SHOWMAX")
"RTN","ORCDLR",34,0)
 Q
"RTN","ORCDLR",35,0)
 ;
"RTN","ORCDLR",36,0)
CKMAX(X) ; -- Ck duration X against max allowed
"RTN","ORCDLR",37,0)
 N Y S Y=1
"RTN","ORCDLR",38,0)
 I +X=X S Y=$S(X<0:"0^Cannot order in the past.",'ORSMAX:1,X'>ORSMAX:1,1:"0^Cannot order more than "_ORSMAX_" days in advance.") G CKQ
"RTN","ORCDLR",39,0)
 I (X'?1"X"1.N),(X'?1"x"1.N) S Y="0^Enter either a number of days or X_number of times." G CKQ
"RTN","ORCDLR",40,0)
 I ORSTMS,+$E(X,2,9)>ORSTMS S Y="0^Cannot order more than "_ORSTMS_" time* s." G CKQ
"RTN","ORCDLR",41,0)
 I 'ORSTMS,+$E(X,2,9)>ORSMAX S Y="0^Cannot order for more than "_ORSMAX_" days." G CKQ ; day of week schedule
"RTN","ORCDLR",42,0)
 S Y=1
"RTN","ORCDLR",43,0)
CKQ Q Y
"RTN","ORCDLR",44,0)
 ;
"RTN","ORCDLR",45,0)
SAMPLE() ; -- Get default sample from Test for INST
"RTN","ORCDLR",46,0)
 N X,Y I $L($G(LRFSAMP)) Q LRFSAMP
"RTN","ORCDLR",47,0)
 I (ORCOLLCT="LC")!(ORCOLLCT="I") S X=$G(ORTEST("Lab CollSamp")) G SAMPQ
"RTN","ORCDLR",48,0)
 S X=$G(ORTEST("Unique CollSamp")) G:X SAMPQ
"RTN","ORCDLR",49,0)
 S X=$G(ORTEST("Default CollSamp"))
"RTN","ORCDLR",50,0)
SAMPQ S Y=+$G(ORTEST("CollSamp",+X))
"RTN","ORCDLR",51,0)
 Q Y
"RTN","ORCDLR",52,0)
 ;
"RTN","ORCDLR",53,0)
ENSAMP ; -- Get list of samples to pick from
"RTN","ORCDLR",54,0)
 Q:$G(ORDIALOG(PROMPT,"LIST"))  N I,CNT,X,Y S (I,CNT)=0
"RTN","ORCDLR",55,0)
 F  S I=$O(ORTEST("CollSamp",I)) Q:I'>0  S X=$G(ORTEST("CollSamp",I)) D
"RTN","ORCDLR",56,0)
 . S Y=$P(X,U,1,2)_"   "_$$GET1^DIQ(61,+$P(X,U,3)_",",.01)_"  "_$P(X,U,4)
"RTN","ORCDLR",57,0)
 . S CNT=CNT+1,ORDIALOG(PROMPT,"LIST",CNT)=Y
"RTN","ORCDLR",58,0)
 . S ORDIALOG(PROMPT,"LIST","B",$P(X,U,2))=+X
"RTN","ORCDLR",59,0)
 S:CNT ORDIALOG(PROMPT,"LIST")=CNT_$S($$SECTION'="MI":"^1",1:"")
"RTN","ORCDLR",60,0)
 Q
"RTN","ORCDLR",61,0)
 ;
"RTN","ORCDLR",62,0)
ASKSAMP() ; -- Ask for Collection Sample?
"RTN","ORCDLR",63,0)
 N X,Y,DIR,DEFSAMP,SAMP0
"RTN","ORCDLR",64,0)
 S DEFSAMP=$G(ORDIALOG(PROMPT,INST)),SAMP0=$G(^LAB(62,+DEFSAMP,0))
"RTN","ORCDLR",65,0)
 I $G(ORTYPE)="Z",DEFSAMP Q 1
"RTN","ORCDLR",66,0)
 I (ORCOLLCT="LC")!(ORCOLLCT="I"),$G(ORTEST("Lab CollSamp")) W !!,"Lab will collect "_$P(SAMP0,U)_" "_$P(SAMP0,U,3)_".",! Q 0
"RTN","ORCDLR",67,0)
 I $G(ORTEST("Unique CollSamp")),DEFSAMP Q 0 ; unique -> don't ask
"RTN","ORCDLR",68,0)
 I 'DEFSAMP!('FIRST) Q 1 ; no default or edit -> ask
"RTN","ORCDLR",69,0)
 I $G(ORDIALOG(PROMPT,"LIST"))="1^1" Q 0 ; only one choice
"RTN","ORCDLR",70,0)
 S DIR(0)="YA",DIR("A")="Is "_$P(SAMP0,U)_" "_$P(SAMP0,U,3)_" the correct sample to collect? ",DIR("B")="Yes"
"RTN","ORCDLR",71,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT) S ORQUIT=1 Q 0
"RTN","ORCDLR",72,0)
 D:'Y LIST^ORCD
"RTN","ORCDLR",73,0)
 Q 'Y
"RTN","ORCDLR",74,0)
 ;
"RTN","ORCDLR",75,0)
SECTION() ; -- Returns Lab section of Orderable Item
"RTN","ORCDLR",76,0)
 N PTR,X
"RTN","ORCDLR",77,0)
 S PTR=$O(^ORD(101.41,"AB","OR GTX ORDERABLE ITEM",0))
"RTN","ORCDLR",78,0)
 S X=$P($G(^ORD(101.43,+$G(ORDIALOG(PTR,1)),"LR")),U,6)
"RTN","ORCDLR",79,0)
 Q X
"RTN","ORCDLR",80,0)
 ;
"RTN","ORCDLR",81,0)
SHOWCOMM(SAMP) ; -- Show comments for sample
"RTN","ORCDLR",82,0)
 Q:'$G(SAMP)  Q:'$G(ORTEST)  N ORCOMM,I
"RTN","ORCDLR",83,0)
 D SCOM^LR7OR3(+ORTEST,SAMP,.ORCOMM)
"RTN","ORCDLR",84,0)
 S I=0 F  S I=$O(ORCOMM(I)) Q:I'>0  W !,ORCOMM(I,0)
"RTN","ORCDLR",85,0)
 Q
"RTN","ORCDLR",86,0)
 ;
"RTN","ORCDLR",87,0)
SPECIMEN() ; -- Get default specimen from Sample for INST
"RTN","ORCDLR",88,0)
 N X,Y I $L($G(LRFSPEC)) S Y=LRFSPEC
"RTN","ORCDLR",89,0)
 E  S X=$$VAL^ORCD("COLLECTION SAMPLE"),Y=+$P($G(^LAB(62,+X,0)),U,2)
"RTN","ORCDLR",90,0)
 Q Y
"RTN","ORCDLR",91,0)
 ;
"RTN","ORCDLR",92,0)
SPECHELP ; -- Xecutable help for Specimen prompt
"RTN","ORCDLR",93,0)
 I '$D(^LAB(61,"E")) D P^ORCDLGH Q
"RTN","ORCDLR",94,0)
 W !,"Choose from: "
"RTN","ORCDLR",95,0)
 N SP,I,DONE,CNT S (CNT,DONE)=0,SP=""
"RTN","ORCDLR",96,0)
 F  S SP=$O(^LAB(61,"E",SP)) Q:SP=""  S I=+$O(^(SP,0)) I I D
"RTN","ORCDLR",97,0)
 . S CNT=CNT+1 I CNT>(IOSL-2) S CNT=0 I '$$MORE^ORCD S DONE=1 Q
"RTN","ORCDLR",98,0)
 . W !,"     "_$P($G(^LAB(61,I,0)),U)
"RTN","ORCDLR",99,0)
 Q
"RTN","ORCDLR",100,0)
 ;
"RTN","ORCDLR",101,0)
URGENCY ; -- Get list of urgencies to pick from
"RTN","ORCDLR",102,0)
 Q:$D(ORDIALOG(PROMPT,"LIST"))  N I,J,X
"RTN","ORCDLR",103,0)
 I $G(ORTEST("Default Urgency")) S ORDIALOG(PROMPT,"LIST")="1^1",ORDIALOG(PROMPT,"LIST",1)=ORTEST("Default Urgency") Q  ; Forced Urgency
"RTN","ORCDLR",104,0)
 I '$D(ORTEST("Urgencies")) S ORDIALOG(PROMPT,"LIST")="0^1" Q
"RTN","ORCDLR",105,0)
 S (I,J)=0 F  S I=$O(ORTEST("Urgencies",I)) Q:I'>0  D
"RTN","ORCDLR",106,0)
 . S X=ORTEST("Urgencies",I) I $G(ORCOLLCT)="LC",'$P($G(^LAB(62.05,+X,0)),U,2) Q  ; Lab cannot collect
"RTN","ORCDLR",107,0)
 . S J=J+1,ORDIALOG(PROMPT,"LIST",J)=X,ORDIALOG(PROMPT,"LIST","B",$P(X,U,2))=+X
"RTN","ORCDLR",108,0)
 S ORDIALOG(PROMPT,"LIST")=J_"^1"
"RTN","ORCDLR",109,0)
 Q
"RTN","ORCDLR",110,0)
 ;
"RTN","ORCDLR",111,0)
ASKURG() ; -- Ask urgency prompt?
"RTN","ORCDLR",112,0)
 I $G(ORTEST("Default Urgency")) Q 0 ; Forced Urgency
"RTN","ORCDLR",113,0)
 I FIRST,$G(ORL) Q $$GET^XPAR("ALL^"_ORL,"LR ASK URGENCY")
"RTN","ORCDLR",114,0)
 Q (+$G(ORDIALOG(PROMPT,"LIST"))>1)
"RTN","ORCDLR",115,0)
 ;
"RTN","ORCDLR",116,0)
REQDCOMM() ; -- Process required comments
"RTN","ORCDLR",117,0)
 I $O(^TMP("ORWORD",$J,PROMPT,INST,0)) Q 0 ;edit as WP
"RTN","ORCDLR",118,0)
 N LRTEST,LRSAMP,LRSPEC,LRTSTN,LRTCOM,LRCCOM,DA,CNT,I,REQDCOMM
"RTN","ORCDLR",119,0)
 S LRSAMP=$$VAL^ORCD("COLLECTION SAMPLE"),LRSPEC=$$VAL^ORCD("SPECIMEN")
"RTN","ORCDLR",120,0)
 S LRTSTN=1,LRTEST(1)=+ORTEST,DA=$O(^LAB(60,LRTEST(1),3,"B",+LRSAMP,0))
"RTN","ORCDLR",121,0)
 S REQDCOMM=$P($G(^LAB(60,LRTEST(1),3,+DA,0)),U,6)
"RTN","ORCDLR",122,0)
 S:'REQDCOMM REQDCOMM=+$P($G(^LAB(60,LRTEST(1),0)),U,19) Q:'REQDCOMM 1
"RTN","ORCDLR",123,0)
 I $G(ORTYPE)="Z",$P($G(^LAB(62.07,+REQDCOMM,0)),U)'="ORDER COMMENT" Q 1
"RTN","ORCDLR",124,0)
 X:$D(^LAB(62.07,REQDCOMM,.1)) ^(.1)
"RTN","ORCDLR",125,0)
 S (CNT,I)=0 K REQDCOMM
"RTN","ORCDLR",126,0)
 F  S I=$O(LRTCOM(LRTEST(1),I)) Q:I'>0  S CNT=CNT+1,REQDCOMM(CNT,0)=LRTCOM(LRTEST(1),I)
"RTN","ORCDLR",127,0)
 S:$L($G(LRCCOM)) CNT=CNT+1,REQDCOMM(CNT,0)=LRCCOM
"RTN","ORCDLR",128,0)
 I CNT S REQDCOMM(0)="^^"_CNT_U_CNT_U_DT_U_U,ORDIALOG(PROMPT,INST)="^TMP(""ORWORD"",$J,"_PROMPT_","_INST_")" M ^TMP("ORWORD",$J,PROMPT,INST)=REQDCOMM
"RTN","ORCDLR",129,0)
RQ Q 1
"RTN","ORCDLR",130,0)
 ;
"RTN","ORCDLR",131,0)
XHELP(PTR) ; -- Xecutable help
"RTN","ORCDLR",132,0)
 I $D(ORDIALOG(PTR,"LIST")),X="?"!$P(ORDIALOG(PTR,"LIST"),U,2) D LIST^ORCD Q
"RTN","ORCDLR",133,0)
 D P^ORCDLGH ; ??-help
"RTN","ORCDLR",134,0)
 Q
"RTN","ORCDLR",135,0)
 ;
"RTN","ORCDLR",136,0)
CHANGED(FLD) ; -- Kill dependent values when FLD changes
"RTN","ORCDLR",137,0)
 N PROMPTS,P,NAME,PTR K ORCOLLCT
"RTN","ORCDLR",138,0)
 S PROMPTS="COLLECTION SAMPLE^SPECIMEN^WORD PROCESSING 1^START DATE/TIME"
"RTN","ORCDLR",139,0)
 S:FLD="OI" PROMPTS="COLLECTION TYPE^"_PROMPTS_"^LAB URGENCY"
"RTN","ORCDLR",140,0)
 F P=1:1:$L(PROMPTS,U) S NAME=$P(PROMPTS,U,P),PTR=$O(^ORD(101.41,"AB","OR GTX "_NAME,0)) I PTR K ORDIALOG(PTR,ORI),ORDIALOG(PTR,"LIST")
"RTN","ORCDLR",141,0)
 Q
"RTN","ORCDLR",142,0)
 ;
"RTN","ORCDLR",143,0)
LB(ORDER) ; -- Returns 1 or 0, if "LB #" is already in text
"RTN","ORCDLR",144,0)
 N I,Y S I=0,Y=0
"RTN","ORCDLR",145,0)
 F  S I=$O(^OR(100,+ORDER,1,I)) Q:I'>0  I $G(^(I,0))["LB #" S Y=1 Q
"RTN","ORCDLR",146,0)
 Q Y
"RTN","ORCDLR",147,0)
 ;
"RTN","ORCDLR",148,0)
DATE(X) ; Free text input to FM time
"RTN","ORCDLR",149,0)
 N %DT,Y
"RTN","ORCDLR",150,0)
 D ^%DT
"RTN","ORCDLR",151,0)
 Q Y
"RTN","ORCDLR",152,0)
 ;
"RTN","ORCDLR",153,0)
XSCH ; -- xecutable help for schedule prompt
"RTN","ORCDLR",154,0)
 N X,IFN,CNT,Z,DONE
"RTN","ORCDLR",155,0)
 K ^TMP($J,"ORSCLR XSCH")
"RTN","ORCDLR",156,0)
 D AP^PSS51P1("LR",,,,"ORSCLR XSCH")
"RTN","ORCDLR",157,0)
 W !!,"Choose from:" S CNT=1
"RTN","ORCDLR",158,0)
 S X="" F  S X=$O(^TMP($J,"ORSCLR XSCH","APLR",X)) Q:X=""  S IFN=0 D  Q:$G(DONE)
"RTN","ORCDLR",159,0)
 .;S X="" F  S X=$O(^PS(51.1,"APLR",X)) Q:X=""  S IFN=0 D  Q:$G(DONE)
"RTN","ORCDLR",160,0)
 . F  S IFN=$O(^TMP($J,"ORSCLR XSCH","APLR",X,IFN)) Q:IFN'>0  D  Q:$G(DONE)
"RTN","ORCDLR",161,0)
 . .;F  S IFN=$O(^PS(51.1,"APLR",X,IFN)) Q:IFN'>0  D  Q:$G(DONE)
"RTN","ORCDLR",162,0)
 .. W !,"   "_X S CNT=CNT+1 Q:CNT'>(IOSL-5)  S CNT=0
"RTN","ORCDLR",163,0)
 .. W !,"   '^' TO STOP: " R Z:DTIME S:'$T!(Z["^") DONE=1
"RTN","ORCDLR",164,0)
 W !
"RTN","ORCDLR",165,0)
 K ^TMP($J,"ORSCLR XSCH")
"RTN","ORCDLR",166,0)
 Q
"RTN","ORCDLR",167,0)
 ;
"RTN","ORCDLR",168,0)
MULT(ORIFN,CTYPE,CDATE) ;check multiple orders from VALID^ORCDLR1
"RTN","ORCDLR",169,0)
 N KID,OREVENT,ORSTRT,OK,X,Y,%DT
"RTN","ORCDLR",170,0)
 I '$D(CTYPE) S CTYPE=$$VALUE^ORCSAVE2(ORIFN,"COLLECT")
"RTN","ORCDLR",171,0)
 Q:"SPWC"[CTYPE 0  ; only check LC and I
"RTN","ORCDLR",172,0)
 I '$D(CDATE) S CDATE=$$VALUE^ORCSAVE2(ORIFN,"START")
"RTN","ORCDLR",173,0)
 D AM^ORCSAVE2:CDATE="AM",NEXT^ORCSAVE2:CDATE="NEXT" ; returns X
"RTN","ORCDLR",174,0)
 S %DT="T" S:'$D(X) X=CDATE  D ^%DT I Y<1 Q 0
"RTN","ORCDLR",175,0)
 D SCHEDULE^ORCSEND1(ORIFN,"LR",.ORSTRT,Y) Q:ORSTRT'>1 0 ; get all starts
"RTN","ORCDLR",176,0)
 S KID=0,OK=1 F  S KID=$O(ORSTRT(KID)) Q:'KID!('OK)  D
"RTN","ORCDLR",177,0)
 . I CTYPE="LC" S OK=$$LABCOLL^ORCDLR1(KID) Q
"RTN","ORCDLR",178,0)
 . S OK=$$IMMCOLL^ORCDLR1(KID)
"RTN","ORCDLR",179,0)
 I OK Q 0
"RTN","ORCDLR",180,0)
 Q "1^One or more of the multiple orders will be changed to Ward Collect"
"RTN","ORCDLR1")
0^71^B81262557
"RTN","ORCDLR1",1,0)
ORCDLR1 ;SLC/MKB,JFR - Utility fcns for LR dialogs cont ;8/29/02  14:45
"RTN","ORCDLR1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,29,49,61,79,141,143,243**;Dec 17, 1997;Build 242
"RTN","ORCDLR1",3,0)
 ;
"RTN","ORCDLR1",4,0)
EN ; -- Entry Action for LR OTHER LAB TESTS order dialog
"RTN","ORCDLR1",5,0)
 D GETIMES S ORMAX=0
"RTN","ORCDLR1",6,0)
 S:$G(ORL) ORMAX=$$GET^XPAR("LOC.`"_+ORL,"LR MAX DAYS CONTINUOUS",1,"Q")
"RTN","ORCDLR1",7,0)
 Q
"RTN","ORCDLR1",8,0)
 ;
"RTN","ORCDLR1",9,0)
EX ; -- Exit Action for order dialog
"RTN","ORCDLR1",10,0)
 K ORTIME,ORCOLLCT,ORMAX,ORTEST,ORDIV,ORIMTIME,ORSMAX,ORSTMS,ORSCH,ORCAT
"RTN","ORCDLR1",11,0)
 I $G(ORXL) S ORL=ORXL K ORXL
"RTN","ORCDLR1",12,0)
 Q
"RTN","ORCDLR1",13,0)
 ;
"RTN","ORCDLR1",14,0)
GETIMES ; -- Set list of routine collections into ORTIME($H)=FMtime
"RTN","ORCDLR1",15,0)
 N I,X,CNT,ON K ORTIME
"RTN","ORCDLR1",16,0)
 I '$D(VALIDT) D
"RTN","ORCDLR1",17,0)
 . S I=$$PTR^ORCD("OR GTX START DATE/TIME"),X=$P(ORDIALOG(I,0),U,2)
"RTN","ORCDLR1",18,0)
 . S X="T::ETX",$P(ORDIALOG(I,0),U,2)=X ; reset lower bound
"RTN","ORCDLR1",19,0)
 S ORDIV=+$P($G(^SC(+$G(ORL),0)),U,4) S:'ORDIV ORDIV=+$G(DUZ(2))
"RTN","ORCDLR1",20,0)
 I $G(OREVENT) S ORDIV=+$$DIV^OREVNTX(OREVENT),ORXL=$G(ORL),ORL=$$LOC^OREVNTX(OREVENT)
"RTN","ORCDLR1",21,0)
 D GETLST^XPAR(.ORTIME,ORDIV_";DIC(4,","LR PHLEBOTOMY COLLECTION","N")
"RTN","ORCDLR1",22,0)
 S (I,CNT)=0 F  S I=$O(ORTIME(I)) Q:I'>0  S CNT=CNT+1,X=$P(ORTIME(I),U),ORTIME(I)=X,ORTIME("B",+("."_X))=I ; ORTIME($H time)=0000 FM time, ORTIME("B",.0000)=$H time of cut-off
"RTN","ORCDLR1",23,0)
 S ORTIME=CNT,I=$O(ORTIME(0)) S:I ORTIME("AM")=ORTIME(I) ; 1st collection
"RTN","ORCDLR1",24,0)
 S I=$O(ORTIME($P($H,",",2))) S:I ORTIME("NEXT")=ORTIME(I) ;NEXT coll
"RTN","ORCDLR1",25,0)
 S ON=$$ON^LR7OV4(ORDIV) D:ON SHOW^LR7OV4(ORDIV,.ORIMTIME)
"RTN","ORCDLR1",26,0)
 I 'ON,'$D(VALIDT) S I=$$PTR^ORCD("OR GTX COLLECTION TYPE"),X=$P(ORDIALOG(I,0),U,2),$P(ORDIALOG(I,0),U,2)=$P(X,";",1,3) ;Remove Immed if '$$ON
"RTN","ORCDLR1",27,0)
 Q
"RTN","ORCDLR1",28,0)
 ;
"RTN","ORCDLR1",29,0)
DEFTIME() ; -- Returns default collection time
"RTN","ORCDLR1",30,0)
 I $L($G(LRFDATE)) S EDITONLY=1 Q LRFDATE
"RTN","ORCDLR1",31,0)
 I '$D(ORCOLLCT) Q ""
"RTN","ORCDLR1",32,0)
 N Y S Y="" I $D(^TMP("ORECALL",$J,ORDIALOG,PROMPT)) D  Q:$L(Y) Y
"RTN","ORCDLR1",33,0)
 . S Y=$$RECALL^ORCD(PROMPT)
"RTN","ORCDLR1",34,0)
 . I '$S(ORCOLLCT="LC":$$LABCOLL(Y),ORCOLLCT="I":$$IMMCOLL(Y),1:$$CKDATE(Y)) S Y="" Q
"RTN","ORCDLR1",35,0)
 . S EDITONLY=1
"RTN","ORCDLR1",36,0)
 ;I $G(ORTYPE)="Q" Q $S(ORCOLLCT="LC":"AM",1:"")
"RTN","ORCDLR1",37,0)
 D LIST^ORCD:ORCOLLCT="LC"&$G(ORDIALOG(PROMPT,"LIST"))
"RTN","ORCDLR1",38,0)
 D IMMTIMES:ORCOLLCT="I"&$O(ORIMTIME(0))
"RTN","ORCDLR1",39,0)
 Q $S(ORCOLLCT="LC":"NEXT",ORCOLLCT="I":$$IMMDEF,ORCOLLCT="WC":"NOW",1:"TODAY")
"RTN","ORCDLR1",40,0)
 ;
"RTN","ORCDLR1",41,0)
IMMDEF() ; -- Returns immediate collect default
"RTN","ORCDLR1",42,0)
 N X,Y S X=$$DEFTIME^LR7OV4(ORDIV)
"RTN","ORCDLR1",43,0)
 S Y=$S($P(X,U,3):"NOW+"_$P(X,U,3)_"'",1:$P(X,U))
"RTN","ORCDLR1",44,0)
 Q Y
"RTN","ORCDLR1",45,0)
 ;
"RTN","ORCDLR1",46,0)
COLLTIME ; -- Get list of common collection times
"RTN","ORCDLR1",47,0)
 I ORCOLLCT="I" D:'$D(ORIMTIME) SHOW^LR7OV4(ORDIV,.ORIMTIME)
"RTN","ORCDLR1",48,0)
 I ORCOLLCT'="LC" K ORDIALOG(PROMPT,"LIST") Q
"RTN","ORCDLR1",49,0)
 Q:$G(ORDIALOG(PROMPT,"LIST"))  Q:'$O(ORTIME(0))
"RTN","ORCDLR1",50,0)
 N I,X,CNT,NEXT,DAY,NOW S NOW=$P($H,",",2)
"RTN","ORCDLR1",51,0)
 S NEXT=$O(ORTIME(NOW)),DAY=$$NEXTCOLL($S(NEXT:"T",1:"T+1")) Q:DAY=""
"RTN","ORCDLR1",52,0)
 S:'NEXT!(DAY["+") NEXT=$O(ORTIME(0))
"RTN","ORCDLR1",53,0)
 S CNT=1,ORDIALOG(PROMPT,"LIST",1)="NEXT^NEXT Lab collection ("_DAY_"@"_$$TIME(ORTIME(NEXT))_")",ORDIALOG(PROMPT,"LIST","B","NEXT LAB COLLECTION")="NEXT"
"RTN","ORCDLR1",54,0)
 S ORDIALOG(PROMPT,"LIST","B","AM LAB COLLECTION")="AM"
"RTN","ORCDLR1",55,0)
 G:ORTIME'>1 CTMQ ; only NEXT
"RTN","ORCDLR1",56,0)
 S I=NEXT F  S I=$O(ORTIME(I)) Q:I'>0  S X=DAY_"@"_$$TIME(ORTIME(I)),CNT=CNT+1,ORDIALOG(PROMPT,"LIST",CNT)=X_"^Routine Lab collection ("_X_")",ORDIALOG(PROMPT,"LIST","B","ROUTINE LAB COLLECTION")=X
"RTN","ORCDLR1",57,0)
 I NEXT>$O(ORTIME(0)) D  ;add morning times before NEXT to T+1
"RTN","ORCDLR1",58,0)
 . S DAY="T+"_(+$P(DAY,"+",2)+1),DAY=$$NEXTCOLL(DAY),I=$O(ORTIME(0))
"RTN","ORCDLR1",59,0)
 . S X=DAY_"@"_$$TIME(ORTIME("AM")),CNT=CNT+1,ORDIALOG(PROMPT,"LIST",CNT)="AM^AM Lab collection ("_X_")"
"RTN","ORCDLR1",60,0)
 . F  S I=$O(ORTIME(I)) Q:(I'>0)!(I'<NEXT)  S X=DAY_"@"_$$TIME(ORTIME(I)),CNT=CNT+1,ORDIALOG(PROMPT,"LIST",CNT)=X_"^Routine Lab collection ("_X_")",ORDIALOG(PROMPT,"LIST","B","ROUTINE LAB COLLECTION")=X
"RTN","ORCDLR1",61,0)
CTMQ S ORDIALOG(PROMPT,"LIST")=CNT
"RTN","ORCDLR1",62,0)
 Q
"RTN","ORCDLR1",63,0)
 ;
"RTN","ORCDLR1",64,0)
NEXTCOLL(START) ; -- Returns the next day that routine lab collects are done
"RTN","ORCDLR1",65,0)
 N X,Y,%DT,OFFSET,ORDAYS,PARAM I '$O(ORTIME(0)) Q "" ; no Lab collect
"RTN","ORCDLR1",66,0)
 S:'$D(START) START="T" S OFFSET=+$P(START,"+",2),START=$P(START,"+")
"RTN","ORCDLR1",67,0)
 F ORDAYS=1:1:7 D  Q:$D(X)  S OFFSET=OFFSET+1 ; ck up to a week
"RTN","ORCDLR1",68,0)
 . S %DT="X",X=START_$S(OFFSET:"+"_OFFSET,1:"")
"RTN","ORCDLR1",69,0)
 . D ^%DT I Y'>0 K X Q
"RTN","ORCDLR1",70,0)
 . I $G(ORL),$$GET^XPAR("ALL^LOC.`"_+ORL,"LR EXCEPTED LOCATIONS") Q
"RTN","ORCDLR1",71,0)
 . S PARAM="LR COLLECT "_$$UP^XLFSTR($$DOW^XLFDT(Y))
"RTN","ORCDLR1",72,0)
 . I '$$GET^XPAR("ALL",PARAM) K X Q
"RTN","ORCDLR1",73,0)
 . I '$$GET^XPAR("ALL","LR IGNORE HOLIDAYS"),$D(^HOLIDAY($P(Y,"."))) K X Q
"RTN","ORCDLR1",74,0)
 S Y=$S($D(X):X,1:"")
"RTN","ORCDLR1",75,0)
 Q Y
"RTN","ORCDLR1",76,0)
 ;
"RTN","ORCDLR1",77,0)
TIME(X) ; -- Returns 00:00AM from 0000 FileMan time
"RTN","ORCDLR1",78,0)
 N HOUR,MIN,XM,Y
"RTN","ORCDLR1",79,0)
 S HOUR=$E(X,1,2),MIN=$E(X,3,4),XM="AM"
"RTN","ORCDLR1",80,0)
 I HOUR'<12 S XM="PM" S:HOUR>12 HOUR=HOUR-12
"RTN","ORCDLR1",81,0)
 S:$E(HOUR)="0" HOUR=$E(HOUR,2) ; strip leading 0
"RTN","ORCDLR1",82,0)
 S Y=HOUR_":"_MIN_XM
"RTN","ORCDLR1",83,0)
 Q Y
"RTN","ORCDLR1",84,0)
 ;
"RTN","ORCDLR1",85,0)
LISTCOLL ; -- Lists the routine collection times for ??-help
"RTN","ORCDLR1",86,0)
 I '$O(ORTIME(0)) W !,"No routine lab collection times defined." Q
"RTN","ORCDLR1",87,0)
 N I,X S I=0,X=""
"RTN","ORCDLR1",88,0)
 F  S I=$O(ORTIME(I)) Q:I'>0  S X=X_$S($L(X):", ",1:"")_$$TIME(ORTIME(I))
"RTN","ORCDLR1",89,0)
 W !,"Routine collection times are "_X_"."
"RTN","ORCDLR1",90,0)
 W !,"You may also enter AM for the morning collection, or NEXT for the next",!,"routine collection time."
"RTN","ORCDLR1",91,0)
 Q
"RTN","ORCDLR1",92,0)
 ;
"RTN","ORCDLR1",93,0)
IMMTIMES ; -- Show the valid date/times for immediate collect
"RTN","ORCDLR1",94,0)
 N I S I=0
"RTN","ORCDLR1",95,0)
 F  S I=$O(ORIMTIME(I)) Q:I'>0  W !,ORIMTIME(I)
"RTN","ORCDLR1",96,0)
 Q
"RTN","ORCDLR1",97,0)
 ;
"RTN","ORCDLR1",98,0)
CKDATE(X) ; -- Valid coll time for SP or WC?
"RTN","ORCDLR1",99,0)
 S X=$$UP^XLFSTR(X) I ("NOW"[X)!("TODAY"[X) Q 1
"RTN","ORCDLR1",100,0)
 I X?1"T+"1.3N,+$P(X,"+",2)'>370 Q 1
"RTN","ORCDLR1",101,0)
 N Y,%DT,D
"RTN","ORCDLR1",102,0)
 I X'?7N.1".".6N S %DT="TX" D ^%DT S:Y>0 X=Y I Y'>0 Q "0^Invalid date/time"
"RTN","ORCDLR1",103,0)
 S D=$P(X,".") I D<DT Q "0^Cannot order for past days"
"RTN","ORCDLR1",104,0)
 I $P(X,".",2),X<$$NOW^XLFDT,'$G(OREVENT),$G(ORTYPE)'="Z" Q "0^The requested collection time has passed"
"RTN","ORCDLR1",105,0)
 I D>$$FMADD^XLFDT(DT,370) Q "0^Cannot order more than 370 days in advance"
"RTN","ORCDLR1",106,0)
 Q 1
"RTN","ORCDLR1",107,0)
 ;
"RTN","ORCDLR1",108,0)
IMMCOLL(X) ; -- Valid immediate collection date/time?
"RTN","ORCDLR1",109,0)
 I X?1"NOW+"1.N1"'" Q 1
"RTN","ORCDLR1",110,0)
 I X'?7N.1".".6N N Y,%DT S %DT="T" D ^%DT S:Y>0 X=Y I Y'>0 Q "0^Invalid date/time"
"RTN","ORCDLR1",111,0)
 Q $$VALID^LR7OV4(ORDIV,X)
"RTN","ORCDLR1",112,0)
 ;
"RTN","ORCDLR1",113,0)
LABCOLL(ORXTIM) ; -- Valid lab collection date/time?
"RTN","ORCDLR1",114,0)
 ;    Returns valid flag of 1 or 0^message
"RTN","ORCDLR1",115,0)
 N I,X,Y,%DT,ORD,ORT,PARAM,ORDY
"RTN","ORCDLR1",116,0)
 I '$O(ORTIME(0)) Q "0^There are no lab collection times defined!"
"RTN","ORCDLR1",117,0)
 I (ORXTIM="AM")!(ORXTIM="NEXT") Q 1
"RTN","ORCDLR1",118,0)
 I ORXTIM'?7N.1".".6N S %DT="T",X=ORXTIM D ^%DT S:Y>0 ORXTIM=Y I Y'>0 Q "0^Invalid date/time"
"RTN","ORCDLR1",119,0)
 ;I ORXTIM?1"V".E S T="."_$P(ORXTIM,"@",2) G D1 ; Visit - ignore day (D ^%DT ??)
"RTN","ORCDLR1",120,0)
 S ORD=$P(ORXTIM,"."),ORT="."_$P(ORXTIM,".",2)
"RTN","ORCDLR1",121,0)
 S:ORT="." ORT=+("."_$G(ORTIME("AM")))
"RTN","ORCDLR1",122,0)
 I '$D(ORTIME("B",ORT)) Q "0^Invalid lab collection time"
"RTN","ORCDLR1",123,0)
LC1 ; -- check date
"RTN","ORCDLR1",124,0)
 I ORD<DT Q "0^Can not order for past days."
"RTN","ORCDLR1",125,0)
 I ORXTIM<$$NOW^XLFDT,'$G(OREVENT) Q "0^Cannot order in the past"
"RTN","ORCDLR1",126,0)
 I $G(ORTYPE)'="Z",'$G(OREVENT),ORD=DT,$P($H,",",2)>ORTIME("B",ORT) Q "0^The cut-off time for this collection has passed"
"RTN","ORCDLR1",127,0)
 S ORDY=7 I $D(^XTV(8989.51,"B","LR LAB COLLECT FUTURE")),$G(ORL) S ORDY=+$$GET^XPAR("ALL^DIV.`"_ORDIV_"^LOC.`"_+ORL,"LR LAB COLLECT FUTURE",1,"I")
"RTN","ORCDLR1",128,0)
 I ORXTIM>$$FMADD^XLFDT($$NOW^XLFDT,ORDY) Q "0^Cannot order a lab collection more than "_ORDY_" days in advance"
"RTN","ORCDLR1",129,0)
 I $G(ORL),$$GET^XPAR("ALL^LOC.`"_+ORL,"LR EXCEPTED LOCATIONS") Q 1
"RTN","ORCDLR1",130,0)
 S PARAM="LR COLLECT "_$$UP^XLFSTR($$DOW^XLFDT(ORD))
"RTN","ORCDLR1",131,0)
 I $G(ORTYPE)'="Z",'$$GET^XPAR("ALL",PARAM) Q "0^There are no lab collections that day"
"RTN","ORCDLR1",132,0)
 I $G(ORTYPE)'="Z",'$$GET^XPAR("ALL","LR IGNORE HOLIDAYS"),$D(^HOLIDAY(ORD)) Q "0^There are no lab collections on holidays"
"RTN","ORCDLR1",133,0)
 Q 1
"RTN","ORCDLR1",134,0)
 ;
"RTN","ORCDLR1",135,0)
LABSAMP() ; -- Lab Collect sample?
"RTN","ORCDLR1",136,0)
 N X,Y S X=+$$VAL^ORCD("COLLECTION SAMPLE"),Y=$P($G(^LAB(62,X,0)),U,7)
"RTN","ORCDLR1",137,0)
 Q Y
"RTN","ORCDLR1",138,0)
 ;
"RTN","ORCDLR1",139,0)
COLLTYPE() ; -- Returns default collection type
"RTN","ORCDLR1",140,0)
 N Y I $G(ORTYPE)="Z" S Y="" G CTQ
"RTN","ORCDLR1",141,0)
 I $L($G(LRFZX)) S Y=LRFZX,EDITONLY=1 G CTQ
"RTN","ORCDLR1",142,0)
 I $D(^TMP("ORECALL",$J,+ORDIALOG,PROMPT)) D  G CTQ
"RTN","ORCDLR1",143,0)
 . S Y=$$RECALL^ORCD(PROMPT),EDITONLY=1
"RTN","ORCDLR1",144,0)
 S:$G(ORL) Y=$$GET^XPAR("ALL^"_ORL,"LR DEFAULT TYPE QUICK")
"RTN","ORCDLR1",145,0)
 I '$L($G(Y)) S Y=$S('$$INPT^ORCD:"SP",$G(ORTYPE)="Q":"LC",1:"WC")
"RTN","ORCDLR1",146,0)
CTQ I Y="I",'$O(ORIMTIME(0))!('$G(ORTEST("Lab CollSamp"))) S Y="WC"
"RTN","ORCDLR1",147,0)
 I Y="LC",'$O(ORTIME(0))!('$G(ORTEST("Lab CollSamp"))) S Y="WC"
"RTN","ORCDLR1",148,0)
 ;S:$G(ORTYPE)="Q" EDITONLY=1
"RTN","ORCDLR1",149,0)
 I '(FIRST&EDITONLY) D HELPTYPE
"RTN","ORCDLR1",150,0)
 Q Y
"RTN","ORCDLR1",151,0)
 ;
"RTN","ORCDLR1",152,0)
CKTYPE ; -- Valid type for time, sample?
"RTN","ORCDLR1",153,0)
 I Y="LC",'$O(ORTIME(0)) W $C(7),!,"There are no lab collection times defined!" K DONE Q
"RTN","ORCDLR1",154,0)
 I Y="I",'$O(ORIMTIME(0)) W $C(7),!,"There are no immediate collection times defined!" K DONE Q
"RTN","ORCDLR1",155,0)
 I (Y="LC"!(Y="I")),'$G(ORTEST("Lab CollSamp")) W $C(7),!,"There is no lab collection sample defined for this test!",! K DONE Q
"RTN","ORCDLR1",156,0)
 I $D(ORESET),ORESET'=Y,("ILC"[ORESET)!("ILC"[Y) D CHANGED^ORCDLR("TYPE") K ORDIALOG($$PTR^ORCD("OR GTX LAB URGENCY"),"LIST")
"RTN","ORCDLR1",157,0)
 Q
"RTN","ORCDLR1",158,0)
 ;
"RTN","ORCDLR1",159,0)
HELPTYPE ; -- Xecutable help for Coll Type
"RTN","ORCDLR1",160,0)
 W !!,"SEND TO LAB - Means the patient is ambulatory and will be sent to the",!,"Laboratory draw room to have blood drawn."
"RTN","ORCDLR1",161,0)
 W !,"WARD COLLECT - Means that either the physician or a nurse will be collecting",!,"the sample on the ward."
"RTN","ORCDLR1",162,0)
 W !,"LAB BLOOD TEAM - Means the phlebotomist from Lab will draw the blood on the",!,"ward.  This method is limited to laboratory defined collection times."
"RTN","ORCDLR1",163,0)
 W:$$ON^LR7OV4(ORDIV) !,"IMMEDIATE COLLECT BY BLOOD TEAM - Means the phlebotomist from Lab is on",!,"call to draw blood on the ward.  This method is available during times",!,"defined by Laboratory." W !
"RTN","ORCDLR1",164,0)
 N DOMAIN S DOMAIN=$P(ORDIALOG(PROMPT,0),U,2) D SETLST1^ORCD
"RTN","ORCDLR1",165,0)
 Q
"RTN","ORCDLR1",166,0)
VALID(ORDER) ;check collection time on release
"RTN","ORCDLR1",167,0)
 N VALIDT,OREVENT,COLLTYPE,COLLDT,OK,ORDIV,ORTXT,ORPTLK,ORTIME,ORIMTIME,ORACT
"RTN","ORCDLR1",168,0)
 S VALIDT="" D GETIMES
"RTN","ORCDLR1",169,0)
 S COLLDT=$$VALUE^ORCSAVE2(ORDER,"START")
"RTN","ORCDLR1",170,0)
 S COLLTYPE=$$VALUE^ORCSAVE2(ORDER,"COLLECT")
"RTN","ORCDLR1",171,0)
 I $L($P(^OR(100,+ORIFN,0),U,17)) S OREVENT=$P(^(0),U,17)
"RTN","ORCDLR1",172,0)
 I "NOWAMNEXT"[COLLDT D:'$G(OREVENT) MULT Q 1 ;OK
"RTN","ORCDLR1",173,0)
 S OK=$S(COLLTYPE="LC":$$LABCOLL(COLLDT),COLLTYPE="I":$$IMMCOLL(COLLDT),1:$$CKDATE(COLLDT))
"RTN","ORCDLR1",174,0)
 I OK D:'$G(OREVENT) MULT Q 1 ;COLLDT passed checks
"RTN","ORCDLR1",175,0)
 W !!,$C(7),$P(OK,U,2)
"RTN","ORCDLR1",176,0)
 D TEXT^ORQ12(.ORTXT,ORDER) W !,$G(ORTXT(1)) K ORTXT
"RTN","ORCDLR1",177,0)
 W !,"must be edited before signing/release." K VALIDT D
"RTN","ORCDLR1",178,0)
 . N ORDIV,ORIMTIME,ORTIME,ORNP
"RTN","ORCDLR1",179,0)
 . S ORNP=$P(^OR(100,ORDER,0),U,4)
"RTN","ORCDLR1",180,0)
 . S ORACT="XX" D XX^ORCACT4 ;edit order
"RTN","ORCDLR1",181,0)
 I $$VALUE^ORCSAVE2(ORDER,"START")'=COLLDT D:'$G(OREVENT) MULT Q 1 ;OK
"RTN","ORCDLR1",182,0)
 Q 0
"RTN","ORCDLR1",183,0)
 ;
"RTN","ORCDLR1",184,0)
MULT ; -- ck child orders
"RTN","ORCDLR1",185,0)
 N CHGD S CHGD=$$MULT^ORCDLR(ORDER,COLLTYPE,COLLDT) Q:'CHGD
"RTN","ORCDLR1",186,0)
 W !!,$P(CHGD,U,2) H 2
"RTN","ORCDLR1",187,0)
 Q
"RTN","ORCDLR2")
0^24^B13639155
"RTN","ORCDLR2",1,0)
ORCDLR2 ;SLC/MKB - Silent utilities for LR dialogs
"RTN","ORCDLR2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORCDLR2",3,0)
 ;
"RTN","ORCDLR2",4,0)
GUI(ORY,ORL,ORDERS)  ; -- ck list of ORDERS for labs w/invalid coll times
"RTN","ORCDLR2",5,0)
 N ORI,ORIFN,ORCNT,RES,I,N,DAD,X
"RTN","ORCDLR2",6,0)
 K ^TMP($J,"ORLR") S ORCNT=0
"RTN","ORCDLR2",7,0)
 S ORI="" F  S ORI=$O(ORDERS(ORI)) Q:ORI=""  D
"RTN","ORCDLR2",8,0)
 . S ORIFN=+ORDERS(ORI) Q:'$$LC(ORIFN)  ;only ck Lab, LC/I orders
"RTN","ORCDLR2",9,0)
 . K RES D KIDS(.RES,$G(ORL),ORIFN)
"RTN","ORCDLR2",10,0)
 . S I=0 F  S I=$O(RES(I)) Q:I<1  I $P(RES(I),U,2) K RES(I)
"RTN","ORCDLR2",11,0)
 . Q:'$O(RES(0))  ;no invalid times found
"RTN","ORCDLR2",12,0)
 . S ORCNT=ORCNT+1,^TMP($J,"ORLR",ORCNT)=ORIFN
"RTN","ORCDLR2",13,0)
 . S I=0 F  S I=$O(RES(I)) Q:I<1  S ^TMP($J,"ORLR",ORCNT,I)=RES(I)
"RTN","ORCDLR2",14,0)
 S ORY(1)="~COUNT",ORY(2)="d"_ORCNT,N=2
"RTN","ORCDLR2",15,0)
 F DAD=1:1:ORCNT S ORIFN=$G(^TMP($J,"ORLR",DAD)) D
"RTN","ORCDLR2",16,0)
 . S N=N+1,ORY(N)="~ORDER_"_DAD
"RTN","ORCDLR2",17,0)
 . S N=N+1,ORY(N)="t#"_ORIFN_"  "_$G(^OR(100,ORIFN,8,1,.1,1,0)) ;1st line order text
"RTN","ORCDLR2",18,0)
 . S ORI=0 F  S ORI=$O(^TMP($J,"ORLR",DAD,ORI)) Q:ORI<1  S X=^(ORI) D
"RTN","ORCDLR2",19,0)
 .. S N=N+1,ORY(N)="i"_X
"RTN","ORCDLR2",20,0)
 Q
"RTN","ORCDLR2",21,0)
 ;
"RTN","ORCDLR2",22,0)
KIDS(ORY,ORL,ORIFN,DATE,TYPE,SCH,DUR) ; -- get child times, validate LC/IC
"RTN","ORCDLR2",23,0)
 ; ORL   = Hospital Location file #44 vptr
"RTN","ORCDLR2",24,0)
 ; ORIFN = Orders file #100 ien
"RTN","ORCDLR2",25,0)
 ;   or
"RTN","ORCDLR2",26,0)
 ; DATE  = Start date.time or "AM" or "NEXT"
"RTN","ORCDLR2",27,0)
 ; TYPE  = LC or I
"RTN","ORCDLR2",28,0)
 ; SCH   = Administration Schedule file #51.1 ien
"RTN","ORCDLR2",29,0)
 ; DUR   = # or "X"_#
"RTN","ORCDLR2",30,0)
 ; Will quit if OREVENT exists <can't check delayed orders>
"RTN","ORCDLR2",31,0)
 ; 
"RTN","ORCDLR2",32,0)
 ; Returns ORY(n) = child start.time ^ 1 or 0 ^ [error message]
"RTN","ORCDLR2",33,0)
 ; 
"RTN","ORCDLR2",34,0)
 N OR0,VALIDT,ORTIME,ORIMTIME,ORDIV,X,Y,%DT,ORSTRT,ORI,ORN,OK
"RTN","ORCDLR2",35,0)
 S OR0=$G(^OR(100,+$G(ORIFN),0)) Q:$P(OR0,U,17)  Q:$G(OREVENT)  ;delayed orders
"RTN","ORCDLR2",36,0)
 I $G(ORIFN),'$L($G(DATE))!'$L($G(TYPE))!'$G(SCH)!'$L($G(DUR)) D  ;get values
"RTN","ORCDLR2",37,0)
 . S DATE=$$VALUE^ORX8(ORIFN,"START")
"RTN","ORCDLR2",38,0)
 . S TYPE=$$VALUE^ORX8(ORIFN,"COLLECT")
"RTN","ORCDLR2",39,0)
 . S SCH=$$VALUE^ORX8(ORIFN,"SCHEDULE")
"RTN","ORCDLR2",40,0)
 . S DUR=$$VALUE^ORX8(ORIFN,"DAYS")
"RTN","ORCDLR2",41,0)
 Q:'$L($G(DATE))  Q:'$G(SCH)  Q:"SPWC"[$G(TYPE)  Q:'$L($G(DUR))
"RTN","ORCDLR2",42,0)
 S VALIDT="" D GETIMES^ORCDLR1
"RTN","ORCDLR2",43,0)
 D AM^ORCSAVE2:DATE="AM",NEXT^ORCSAVE2:DATE="NEXT" ; returns X
"RTN","ORCDLR2",44,0)
 S %DT="T" S:'$D(X) X=DATE  D ^%DT I Y<1 Q
"RTN","ORCDLR2",45,0)
 D SCHEDULE(.ORSTRT,Y,SCH,DUR) Q:ORSTRT'>1 0 ; get all starts
"RTN","ORCDLR2",46,0)
 K ORY S ORY=ORSTRT
"RTN","ORCDLR2",47,0)
 S (ORI,ORN)=0 F  S ORI=$O(ORSTRT(ORI)) Q:'ORI  S OK="" D
"RTN","ORCDLR2",48,0)
 . I TYPE="LC" S OK=$$LABCOLL^ORCDLR1(ORI)
"RTN","ORCDLR2",49,0)
 . I TYPE="I" S OK=$$IMMCOLL^ORCDLR1(ORI)
"RTN","ORCDLR2",50,0)
 . S ORN=ORN+1,ORY(ORN)=ORI_U_OK
"RTN","ORCDLR2",51,0)
 Q
"RTN","ORCDLR2",52,0)
 ;
"RTN","ORCDLR2",53,0)
SCHEDULE(ORY,PSJSD,SCH,ORDUR) ; Returns list of start time(s) from schedule
"RTN","ORCDLR2",54,0)
 ; PSJEEU  - DBIA #2417
"RTN","ORCDLR2",55,0)
 ; PSS51P1 - DBIA #4546
"RTN","ORCDLR2",56,0)
 N I,X,ORSCH,PSJFD,PSJW,PSJNE,PSJPP,PSJX,PSJAT,PSJM,PSJTS,PSJY,PSJAX,PSJSCH,PSJOSD,PSJOFD,PSJC,NXT
"RTN","ORCDLR2",57,0)
 Q:'$G(PSJSD)  S ORY=1,ORY(PSJSD)="",SCH=$G(SCH) ;1st occurrance
"RTN","ORCDLR2",58,0)
 S I="",X=SCH S:+SCH I=+SCH,X="" ;I=ien or X=name
"RTN","ORCDLR2",59,0)
 D ZERO^PSS51P1(I,X,"LR",,"ORLR") S ORSCH=+$O(^TMP($J,"ORLR",0)) ;ien
"RTN","ORCDLR2",60,0)
 S PSJX=$G(^TMP($J,"ORLR",ORSCH,.01))
"RTN","ORCDLR2",61,0)
 S PSJW=+$G(ORL),PSJNE="",PSJPP="LR" D ENSV^PSJEEU Q:'$L($G(PSJX))
"RTN","ORCDLR2",62,0)
 I $G(PSJTS)'="C",$G(PSJTS)'="D" Q  ;not continuous or day-of-week
"RTN","ORCDLR2",63,0)
 S PSJSCH=PSJX
"RTN","ORCDLR2",64,0)
 S:ORDUR PSJFD=$$FMADD^XLFDT(PSJSD,+ORDUR,,-1)
"RTN","ORCDLR2",65,0)
 I 'ORDUR S X=+$E(ORDUR,2,9) D
"RTN","ORCDLR2",66,0)
 . I PSJM S PSJFD=$$FMADD^XLFDT(PSJSD,,,(PSJM*X)-1) ;X_#times
"RTN","ORCDLR2",67,0)
 . E  D  ;no freq in minutes --> day of week
"RTN","ORCDLR2",68,0)
 .. N DAYS,LOCMX,SCHMX
"RTN","ORCDLR2",69,0)
 .. S LOCMX=$$GET^XPAR("ALL^LOC.`"_+$G(ORL),"LR MAX DAYS CONTINUOUS",1,"Q")
"RTN","ORCDLR2",70,0)
 .. S SCHMX=$G(^TMP($J,"ORLR",ORSCH,2.5))
"RTN","ORCDLR2",71,0)
 .. S DAYS=$S('SCHMX:LOCMX,LOCMX<SCHMX:LOCMX,1:SCHMX)
"RTN","ORCDLR2",72,0)
 .. S PSJFD=$$FMADD^XLFDT(PSJSD,DAYS,,-1)
"RTN","ORCDLR2",73,0)
 D ENSPU^PSJEEU K ORY
"RTN","ORCDLR2",74,0)
 I ORDUR M ORY=PSJC Q
"RTN","ORCDLR2",75,0)
 S ORY=$S(PSJC<$E(ORDUR,2,9):PSJC,1:$E(ORDUR,2,9))
"RTN","ORCDLR2",76,0)
 S NXT=0 F I=1:1:ORY S NXT=$O(PSJC(NXT)) Q:'NXT  S ORY(NXT)=PSJC(NXT)
"RTN","ORCDLR2",77,0)
 Q
"RTN","ORCDLR2",78,0)
 ;
"RTN","ORCDLR2",79,0)
LC(IEN) ; -- Return 1 or 0, if order IEN is to Lab for LC or I
"RTN","ORCDLR2",80,0)
 N Y,X0,PKG S Y=0
"RTN","ORCDLR2",81,0)
 S X0=$G(^OR(100,+$G(IEN),0)),PKG=$$NMSP^ORCD(+$P(X0,U,14))
"RTN","ORCDLR2",82,0)
 I PKG="LR" D
"RTN","ORCDLR2",83,0)
 . N X S X=$$VALUE^ORX8(IEN,"COLLECT")
"RTN","ORCDLR2",84,0)
 . I X="LC"!(X="I") S Y=1
"RTN","ORCDLR2",85,0)
 Q Y
"RTN","ORCDPS1")
0^134^B74826833
"RTN","ORCDPS1",1,0)
ORCDPS1 ;SLC/MKB-Pharmacy dialog utilities ; 08 May 2002  2:12 PM
"RTN","ORCDPS1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**94,117,141,149,195,215,243**;Dec 17, 1997;Build 242
"RTN","ORCDPS1",3,0)
 ;
"RTN","ORCDPS1",4,0)
 ; DBIA 2418   START^PSSJORDF   ^TMP("PSJMR",$J)
"RTN","ORCDPS1",5,0)
 ; DBIA 3166   EN^PSSDIN        ^TMP("PSSDIN",$J)
"RTN","ORCDPS1",6,0)
 ; 
"RTN","ORCDPS1",7,0)
EN(TYPE) ; -- entry action for Meds dialogs
"RTN","ORCDPS1",8,0)
 S ORINPT=$$INPT^ORCD,ORCAT=$G(TYPE)
"RTN","ORCDPS1",9,0)
 I 'ORINPT,ORCAT="I" D IMOLOC^ORIMO(.ORINPT,+ORL,+ORVP) S:ORINPT<0 ORINPT=0 ;allow inpt meds at this location?
"RTN","ORCDPS1",10,0)
 I ORCAT="" D
"RTN","ORCDPS1",11,0)
 . I $G(ORENEW)!$G(OREWRITE)!$D(OREDIT),$L($P($G(OR0),U,12)) S ORCAT=$P(OR0,U,12) Q  ;use value from order, via ORCACT4
"RTN","ORCDPS1",12,0)
 . S ORCAT=$S(ORINPT:"I",1:"O")
"RTN","ORCDPS1",13,0)
 S ORDG=+$O(^ORD(100.98,"B",$S(ORCAT="I":"UD RX",1:"O RX"),0))
"RTN","ORCDPS1",14,0)
 K ^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORCDPS1",15,0)
 I $G(ORENEW)!$G(OREWRITE)!$G(OREDIT)!$G(ORXFER) D  Q:$G(ORQUIT)
"RTN","ORCDPS1",16,0)
 . I 'ORINPT,ORCAT="I" D  Q:$G(ORQUIT)
"RTN","ORCDPS1",17,0)
 .. N OI S OI=+$O(^OR(100,+$G(ORIFN),.1,"B",0)) Q:OI<1
"RTN","ORCDPS1",18,0)
 .. I '$O(^ORD(101.43,OI,9,"B","IVM RX",0)) S ORQUIT=1 W $C(7),!!,"This order may not be placed at this location!" Q
"RTN","ORCDPS1",19,0)
 . K ORDIALOG($$PTR("START DATE/TIME"),1)
"RTN","ORCDPS1",20,0)
 . K ORDIALOG($$PTR("NOW"),1) Q:ORCAT'="O"
"RTN","ORCDPS1",21,0)
 . N WP S WP=$$PTR("WORD PROCESSING 1")
"RTN","ORCDPS1",22,0)
 . I '$G(ORXFER),'$$DRAFT^ORWDX2($G(ORIFN)) K ORDIALOG(WP,1),^TMP("ORWORD",$J,WP)
"RTN","ORCDPS1",23,0)
 . I $G(OREDIT),'$O(ORDIALOG($$PTR^ORCD("OR GTX INSTRUCTIONS"),0)) K ^TMP("ORWORD",$J)
"RTN","ORCDPS1",24,0)
 I ORINPT,ORCAT="O" W $C(7),!!,"NOTE: This will create an outpatient prescription for an inpatient!",!
"RTN","ORCDPS1",25,0)
 Q
"RTN","ORCDPS1",26,0)
 ;
"RTN","ORCDPS1",27,0)
EN1 ; -- setup Meds dialog for quick order editor using ORDG
"RTN","ORCDPS1",28,0)
 N DG S DG=$P($G(^ORD(100.98,+$G(ORDG),0)),U,3)
"RTN","ORCDPS1",29,0)
 I $P(DG," ")="O"!(DG="SPLY") S ORINPT=0,ORCAT="O"
"RTN","ORCDPS1",30,0)
 E  S ORINPT=1,ORCAT="I"
"RTN","ORCDPS1",31,0)
 K ^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORCDPS1",32,0)
 Q
"RTN","ORCDPS1",33,0)
 ;
"RTN","ORCDPS1",34,0)
ENOI ; -- setup OI prompt
"RTN","ORCDPS1",35,0)
 N D S D=$G(ORDIALOG(PROMPT,"D"))
"RTN","ORCDPS1",36,0)
 S:D="S.RX" ORDIALOG(PROMPT,"D")=$S(ORCAT="I":"S.UD RX",1:"S.O RX")
"RTN","ORCDPS1",37,0)
 I ORCAT="I",'ORINPT,D="S.UD RX" D  ;limit to IV meds for outpt's
"RTN","ORCDPS1",38,0)
 . S ORDIALOG(PROMPT,"D")="S.IVM RX" ;ORDG=+$O(^ORD(100.98,"B","O RX",0))
"RTN","ORCDPS1",39,0)
 . S ORDIALOG(PROMPT,"?")="Enter the IV medication you wish to order for this patient."
"RTN","ORCDPS1",40,0)
 Q
"RTN","ORCDPS1",41,0)
 ;
"RTN","ORCDPS1",42,0)
DEA ; -- ck DEA# of ordering provider if SchedII drug
"RTN","ORCDPS1",43,0)
 Q:$G(ORTYPE)="Z"  N DEAFLG,PSOI
"RTN","ORCDPS1",44,0)
 S PSOI=+$P($G(^ORD(101.43,+$G(Y),0)),U,2) Q:PSOI'>0
"RTN","ORCDPS1",45,0)
 S DEAFLG=$$OIDEA^PSSUTLA1(PSOI,ORCAT) Q:DEAFLG'>0  ;ok
"RTN","ORCDPS1",46,0)
 I $G(ORNP),'$L($P($G(^VA(200,+ORNP,"PS")),U,2)),'$L($P($G(^("PS")),U,3)) W $C(7),!,$P($G(^(0)),U)_" must have a DEA# or VA# to order this drug!" K DONE Q
"RTN","ORCDPS1",47,0)
 I DEAFLG=1 W $C(7),!,"This order will require a wet signature!"
"RTN","ORCDPS1",48,0)
 Q
"RTN","ORCDPS1",49,0)
 ;
"RTN","ORCDPS1",50,0)
CHANGED(X) ; -- Kill dependent values when prompt X changes
"RTN","ORCDPS1",51,0)
 N PROMPTS,NAME,PTR,P,I
"RTN","ORCDPS1",52,0)
 S PROMPTS=X I X="OI" D
"RTN","ORCDPS1",53,0)
 . S PROMPTS="INSTRUCTIONS^ROUTE^SCHEDULE^START DATE/TIME^DURATION^AND/THEN^DOSE^DISPENSE DRUG^SIG^PATIENT INSTRUCTIONS^DAYS SUPPLY^QUANTITY^REFILLS^SERVICE CONNECTED"
"RTN","ORCDPS1",54,0)
 . K ORDRUG,ORDOSE,OROUTE,ORSCH,ORSD,ORDSUP,ORQTY,ORQTYUNT,OREFILLS,ORCOPAY
"RTN","ORCDPS1",55,0)
 . K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORCDPS1",56,0)
 I X="DS" S PROMPTS="QUANTITY^REFILLS" K OREFILLS
"RTN","ORCDPS1",57,0)
 F P=1:1:$L(PROMPTS,U) S NAME=$P(PROMPTS,U,P) D
"RTN","ORCDPS1",58,0)
 . S PTR=$$PTR(NAME) Q:'PTR
"RTN","ORCDPS1",59,0)
 . S I=0 F  S I=$O(ORDIALOG(PTR,I)) Q:I'>0  K ORDIALOG(PTR,I)
"RTN","ORCDPS1",60,0)
 . K ORDIALOG(PTR,"LIST"),^TMP("ORWORD",$J,PTR)
"RTN","ORCDPS1",61,0)
 Q
"RTN","ORCDPS1",62,0)
 ;
"RTN","ORCDPS1",63,0)
ORDITM(OI) ; -- Check OI, get dependent info
"RTN","ORCDPS1",64,0)
 Q:OI'>0  ;quit - no value
"RTN","ORCDPS1",65,0)
 N ORPS,ORPSOI S ORPS=$G(^ORD(101.43,+OI,"PS")),ORPSOI=+$P($G(^(0)),U,2)
"RTN","ORCDPS1",66,0)
 S ORIV=$S($P(ORPS,U)=2:1,1:0)
"RTN","ORCDPS1",67,0)
 I $G(ORCAT)="O",'$P(ORPS,U,2) W $C(7),!,"This drug may not be used in an outpatient order." S ORQUIT=1 D WAIT Q
"RTN","ORCDPS1",68,0)
 I $G(ORCAT)="I" D  Q:$G(ORQUIT)
"RTN","ORCDPS1",69,0)
 . I $G(ORINPT),'$P(ORPS,U) W $C(7),!,"This drug may not be used in an inpatient order." S ORQUIT=1 D WAIT Q
"RTN","ORCDPS1",70,0)
 . I '$G(ORINPT),'ORIV W $C(7),!,"This drug may not be ordered for an outpatient." S ORQUIT=1 D WAIT Q
"RTN","ORCDPS1",71,0)
 I $G(ORTYPE)="Q" D  I $G(ORQUIT) D WAIT Q
"RTN","ORCDPS1",72,0)
 . N DEAFLG S DEAFLG=$$OIDEA^PSSUTLA1(ORPSOI,ORCAT) Q:DEAFLG'>0  ;ok
"RTN","ORCDPS1",73,0)
 . I $G(ORNP),'$L($P($G(^VA(200,+ORNP,"PS")),U,2)),'$L($P($G(^("PS")),U,3)) W $C(7),!,$P($G(^(0)),U)_" must have a DEA# or VA# to order this drug!" S ORQUIT=1 Q
"RTN","ORCDPS1",74,0)
 . I DEAFLG=1 W $C(7),!,"This order will require a wet signature!"
"RTN","ORCDPS1",75,0)
OI1 ; -ck NF status
"RTN","ORCDPS1",76,0)
 I $P(ORPS,U,6),'$G(ORENEW) D  ;alternative
"RTN","ORCDPS1",77,0)
 . W !!,"*** This medication is not in the formulary! ***"
"RTN","ORCDPS1",78,0)
 . N PSX,CNT,ORX,DIR,X,Y,DTOUT,DUOUT
"RTN","ORCDPS1",79,0)
 . D EN1^PSSUTIL1(.ORPSOI,ORCAT) I '$O(ORPSOI(0)) D  Q
"RTN","ORCDPS1",80,0)
 .. W !,"    There are no formulary alternatives entered for this item."
"RTN","ORCDPS1",81,0)
 .. W !,"    Please consult with your pharmacy before ordering it."
"RTN","ORCDPS1",82,0)
 . S PSX=0,CNT=0 F  S PSX=$O(ORPSOI(PSX)) Q:PSX'>0  D
"RTN","ORCDPS1",83,0)
 .. S ORX=+$O(^ORD(101.43,"ID",PSX_";99PSP",0)) Q:ORX'>0
"RTN","ORCDPS1",84,0)
 .. S CNT=CNT+1,ORPSOI("OI",CNT)=ORX_U_PSX
"RTN","ORCDPS1",85,0)
 .. S DIR("A",CNT)=$J(CNT,3)_" "_$P($G(^ORD(101.43,ORX,0)),U)
"RTN","ORCDPS1",86,0)
 . S DIR(0)="NAO^1:"_CNT,DIR("A")="Select alternative (or <return> to continue): "
"RTN","ORCDPS1",87,0)
 . S DIR("?")="The medication selected is not in the formulary; you may select one of the above listed alternatives instead, or press <return> to continue processing this order."
"RTN","ORCDPS1",88,0)
 . Q:CNT'>0  W !,"    Formulary alternatives:" D ^DIR
"RTN","ORCDPS1",89,0)
 . I Y'>0 S:$D(DTOUT)!$D(DUOUT) ORQUIT=1 Q
"RTN","ORCDPS1",90,0)
 . D:OI'=+ORPSOI("OI",+Y) CHANGED("OI") ;reset parameters if different
"RTN","ORCDPS1",91,0)
 . S OI=+ORPSOI("OI",+Y),ORDIALOG(PROMPT,INST)=OI,OROI=OI
"RTN","ORCDPS1",92,0)
 . S ORPSOI=+$P(ORPSOI("OI",+Y),U,2)
"RTN","ORCDPS1",93,0)
OI2 ; -get routes, doses [also called from NF^ORCDPS]
"RTN","ORCDPS1",94,0)
 D:'$D(^TMP("PSJMR",$J)) START^PSSJORDF(ORPSOI,$G(ORCAT))  ;DBIA 2418
"RTN","ORCDPS1",95,0)
 I '$D(ORDOSE) D
"RTN","ORCDPS1",96,0)
 . D DOSE^PSSORUTL(.ORDOSE,ORPSOI,$S($G(ORCAT)="I":"U",1:"O"),+ORVP)
"RTN","ORCDPS1",97,0)
 . K:$G(ORDOSE(1))=-1 ORDOSE
"RTN","ORCDPS1",98,0)
 Q
"RTN","ORCDPS1",99,0)
 ;
"RTN","ORCDPS1",100,0)
NFI(OI) ; -- Show NFI restrictions, if exist
"RTN","ORCDPS1",101,0)
 N PSOI,I,J,LCNT,MAX,X,STOP
"RTN","ORCDPS1",102,0)
 S PSOI=+$P($G(^ORD(101.43,+$G(OI),0)),U,2)
"RTN","ORCDPS1",103,0)
 D EN^PSSDIN(PSOI,"") Q:'$D(^TMP("PSSDIN",$J,"OI",PSOI))  ;DBIA 3166
"RTN","ORCDPS1",104,0)
 S I=0,LCNT=0,MAX=$S($G(IOBM)&$G(IOTM):IOBM-IOTM+1,1:24) W !
"RTN","ORCDPS1",105,0)
 F  S I=$O(^TMP("PSSDIN",$J,"OI",PSOI,I)) Q:I'>0  D
"RTN","ORCDPS1",106,0)
 . S J=0 F  S J=$O(^TMP("PSSDIN",$J,"OI",PSOI,I,J)) Q:J'>0  S X=$G(^(J)) D  Q:$G(STOP)
"RTN","ORCDPS1",107,0)
 .. S LCNT=LCNT+1 I LCNT'<MAX S:'$$CONT STOP=1 Q:$G(STOP)  S LCNT=1
"RTN","ORCDPS1",108,0)
 .. W !,X
"RTN","ORCDPS1",109,0)
 W ! K ^TMP("PSSDIN",$J,"OI",PSOI)
"RTN","ORCDPS1",110,0)
 Q
"RTN","ORCDPS1",111,0)
 ;
"RTN","ORCDPS1",112,0)
CONT() ; -- Cont or stop?
"RTN","ORCDPS1",113,0)
 N X,Y,DIR,DUOUT,DTOUT,DIRUT,DIROUT S DIR(0)="EA"
"RTN","ORCDPS1",114,0)
 S DIR("A")="Press <return> to continue or ^ to stop ..."
"RTN","ORCDPS1",115,0)
 D ^DIR S:$D(DUOUT)!$D(DTOUT) Y=""
"RTN","ORCDPS1",116,0)
 Q +Y
"RTN","ORCDPS1",117,0)
 ;
"RTN","ORCDPS1",118,0)
WAIT ; -- Wait for user
"RTN","ORCDPS1",119,0)
 N X W !,"Press <return> to continue ..." R X:DTIME
"RTN","ORCDPS1",120,0)
 Q
"RTN","ORCDPS1",121,0)
 ;
"RTN","ORCDPS1",122,0)
ROUTES ; -- Get med routes
"RTN","ORCDPS1",123,0)
 Q:$G(ORDIALOG(PROMPT,"LIST"))  N I,X,CNT S (I,CNT)=0
"RTN","ORCDPS1",124,0)
 F  S I=$O(^TMP("PSJMR",$J,I)) Q:I'>0  S X=^(I),CNT=CNT+1,ORDIALOG(PROMPT,"LIST",CNT)=$P(X,U,3)_U_$P(X,U,1,2),ORDIALOG(PROMPT,"LIST","B",$P(X,U))=$P(X,U,3)
"RTN","ORCDPS1",125,0)
 S:$G(CNT) ORDIALOG(PROMPT,"LIST")=CNT
"RTN","ORCDPS1",126,0)
 S:$G(ORTYPE)'="Z" REQD=$S(ORCAT="I":1,$P($G(^ORD(101.43,+$G(OROI),"PS")),U,5):0,1:1)
"RTN","ORCDPS1",127,0)
 Q
"RTN","ORCDPS1",128,0)
 ;
"RTN","ORCDPS1",129,0)
DEFRTE ; -- Get default route
"RTN","ORCDPS1",130,0)
 N INST1 S INST1=$O(ORDIALOG(PROMPT,0)) S:INST1'>0 INST1=INST
"RTN","ORCDPS1",131,0)
 I INST1=INST S Y=+$P($G(^TMP("PSJMR",$J,1)),U,3) K:Y'>0 Y Q
"RTN","ORCDPS1",132,0)
 S Y=+$G(ORDIALOG(PROMPT,INST1)) K:Y'>0 Y S:$G(Y) EDITONLY=1
"RTN","ORCDPS1",133,0)
 Q
"RTN","ORCDPS1",134,0)
 ;
"RTN","ORCDPS1",135,0)
CKSCH ; -- validate schedule [Called from P-S Action]
"RTN","ORCDPS1",136,0)
 N ORX S ORX=ORDIALOG(PROMPT,ORI) Q:ORX=$G(ORESET)  K ORSD
"RTN","ORCDPS1",137,0)
 D EN^PSSGS0(.ORX,$G(ORCAT))
"RTN","ORCDPS1",138,0)
 I $D(ORX) S ORDIALOG(PROMPT,ORI)=ORX D CHANGED("QUANTITY") Q  ;ok
"RTN","ORCDPS1",139,0)
 W $C(7),!,"Enter a standard schedule for administering this medication"
"RTN","ORCDPS1",140,0)
 K DONE I $G(ORCAT)="I" W ".",! Q
"RTN","ORCDPS1",141,0)
 W " or one of your own,",!,"up to 20 characters.",!
"RTN","ORCDPS1",142,0)
 Q
"RTN","ORCDPS1",143,0)
 ;
"RTN","ORCDPS1",144,0)
DEFCONJ ; -- Set default conjuction for previous instance [P-S Action]
"RTN","ORCDPS1",145,0)
 N LAST,DUR,CONJ
"RTN","ORCDPS1",146,0)
 S LAST=$O(ORDIALOG(PROMPT,ORI),-1) Q:LAST'>0  ;first instance
"RTN","ORCDPS1",147,0)
 S CONJ=$$PTR("AND/THEN") Q:$L($G(ORDIALOG(CONJ,LAST)))
"RTN","ORCDPS1",148,0)
 S DUR=$G(ORDIALOG($$PTR("DURATION"),LAST))
"RTN","ORCDPS1",149,0)
 S ORDIALOG(CONJ,LAST)=$S(+DUR'>0:"A",1:"T")
"RTN","ORCDPS1",150,0)
 Q
"RTN","ORCDPS1",151,0)
 ;
"RTN","ORCDPS1",152,0)
ENCONJ ; -- Get allowable values, if req'd for INST
"RTN","ORCDPS1",153,0)
 N P S P=$$PTR("INSTRUCTIONS")
"RTN","ORCDPS1",154,0)
 S REQD=$S($O(ORDIALOG(P,INST)):1,1:0)
"RTN","ORCDPS1",155,0)
 S ORDIALOG(PROMPT,"A")="And/then"_$S(ORCAT="O":"/except: ",1:": ")
"RTN","ORCDPS1",156,0)
 S $P(ORDIALOG(PROMPT,0),U,2)="A:AND;T:THEN;"_$S(ORCAT="O":"X:EXCEPT;",1:"")
"RTN","ORCDPS1",157,0)
 Q
"RTN","ORCDPS1",158,0)
 ;
"RTN","ORCDPS1",159,0)
DSUP ; -- Get max/default days supply
"RTN","ORCDPS1",160,0)
 N ORX,Y
"RTN","ORCDPS1",161,0)
 S ORX("PATIENT")=+$G(ORVP),ORX("DRUG")=+$G(ORDRUG)
"RTN","ORCDPS1",162,0)
 D DSUP^PSOSIGDS(.ORX) S Y=+$G(ORX("DAYS SUPPLY")) S:Y'>0 Y=90
"RTN","ORCDPS1",163,0)
 ;S $P(ORDIALOG(PROMPT,0),U,2)="1:"_Y ;max allowed
"RTN","ORCDPS1",164,0)
 I '$G(ORDIALOG(PROMPT,1)),$G(ORTYPE)'="Z" S ORDIALOG(PROMPT,1)=Y
"RTN","ORCDPS1",165,0)
 Q
"RTN","ORCDPS1",166,0)
 ;
"RTN","ORCDPS1",167,0)
QTY() ; -- Return default quantity [Expects ORDSUP]
"RTN","ORCDPS1",168,0)
 N INSTR,DOSE,DUR,SCH,I,ORX,X,Y
"RTN","ORCDPS1",169,0)
 S Y="" I $G(ORDSUP)'>0!'$G(ORDRUG) G QTYQ ;need days supply, disp drug
"RTN","ORCDPS1",170,0)
 S INSTR=$$PTR("INSTRUCTIONS")
"RTN","ORCDPS1",171,0)
 S DOSE=$$PTR("DOSE"),CONJ=$$PTR("AND/THEN")
"RTN","ORCDPS1",172,0)
 S DUR=$$PTR("DURATION"),SCH=$$PTR("SCHEDULE")
"RTN","ORCDPS1",173,0)
 S I=0 F  S I=$O(ORDIALOG(INSTR,I)) Q:I'>0  D  Q:'$D(ORX)
"RTN","ORCDPS1",174,0)
 . S X=$P($G(ORDIALOG(DOSE,I)),"&",3) I X'>0 K ORX Q
"RTN","ORCDPS1",175,0)
 . S ORX("DOSE ORDERED",I)=X,ORX("SCHEDULE",I)=$G(ORDIALOG(SCH,I))
"RTN","ORCDPS1",176,0)
 . S X=$G(ORDIALOG(DUR,I)),ORX("DURATION",I)=$$HL7DUR^ORMBLDPS
"RTN","ORCDPS1",177,0)
 . S ORX("CONJUNCTION",I)=$G(ORDIALOG(CONJ,I))
"RTN","ORCDPS1",178,0)
 G:'$D(ORX) QTYQ ;no doses
"RTN","ORCDPS1",179,0)
 S ORX("PATIENT")=+$G(ORVP),ORX("DRUG")=+$G(ORDRUG)
"RTN","ORCDPS1",180,0)
 S ORX("DAYS SUPPLY")=+$G(ORDSUP)
"RTN","ORCDPS1",181,0)
 D QTYX^PSOSIG(.ORX) S Y=$G(ORX("QTY"))
"RTN","ORCDPS1",182,0)
QTYQ Q Y
"RTN","ORCDPS1",183,0)
 ;
"RTN","ORCDPS1",184,0)
MAXREFS ; -- Get max refills allowed [Entry Action]
"RTN","ORCDPS1",185,0)
 Q:$G(ORCAT)'="O"  N ORX,X
"RTN","ORCDPS1",186,0)
 S ORX("ITEM")=+$P($G(^ORD(101.43,+$G(OROI),0)),U,2)
"RTN","ORCDPS1",187,0)
 S ORX("DRUG")=+$G(ORDRUG),ORX("PATIENT")=+$G(ORVP)
"RTN","ORCDPS1",188,0)
 I $G(OREVENT),$$TYPE^OREVNTX(OREVENT)="D" S ORX("DISCHARGE")=1
"RTN","ORCDPS1",189,0)
 S ORX("DAYS SUPPLY")=$G(ORDSUP) D MAX^PSOSIGDS(.ORX)
"RTN","ORCDPS1",190,0)
 S OREFILLS=$G(ORX("MAX")),X=$G(ORDIALOG(PROMPT,INST))
"RTN","ORCDPS1",191,0)
 I OREFILLS'>0 S ORDIALOG(PROMPT,INST)=0 W !,"No refills allowed." Q
"RTN","ORCDPS1",192,0)
 S $P(ORDIALOG(PROMPT,0),U,2)="0:"_OREFILLS
"RTN","ORCDPS1",193,0)
 S ORDIALOG(PROMPT,"A")="Refills (0-"_OREFILLS_"): "
"RTN","ORCDPS1",194,0)
 I X,X>OREFILLS S ORDIALOG(PROMPT,INST)=OREFILLS
"RTN","ORCDPS1",195,0)
 Q
"RTN","ORCDPS1",196,0)
 ;
"RTN","ORCDPS1",197,0)
ASKSC() ; -- Return 1 or 0, if SC prompt should be asked
"RTN","ORCDPS1",198,0)
 I $$SC^PSOCP(+ORVP,+$G(ORDRUG)) Q 0
"RTN","ORCDPS1",199,0)
 ;I $$RXST^IBARXEU(+ORVP)>0 Q 0 ;exempt from copay
"RTN","ORCDPS1",200,0)
 Q 1
"RTN","ORCDPS1",201,0)
 ;
"RTN","ORCDPS1",202,0)
PTR(X) ; -- Return ptr to prompt OR GTX X
"RTN","ORCDPS1",203,0)
 Q +$O(^ORD(101.41,"AB","OR GTX "_X,0))
"RTN","ORCDPS1",204,0)
 ;
"RTN","ORCDPS1",205,0)
EXIT ; -- exit action for Meds
"RTN","ORCDPS1",206,0)
 S:$G(ORXNP) ORNP=ORXNP
"RTN","ORCDPS1",207,0)
 K ORXNP,ORINPT,ORCAT,ORPKG,OROI,ORIV,ORDRUG,ORDOSE,OROUTE,ORSCH,ORSD,ORDSUP,OREFILLS,ORQTY,ORQTYUNT,ORCOPAY,PSJNOPC,ORCOMPLX
"RTN","ORCDPS1",208,0)
 K ^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORCDPS1",209,0)
 Q
"RTN","ORCDPS2")
0^12^B67090529
"RTN","ORCDPS2",1,0)
ORCDPS2 ;SLC/MKB-Pharmacy dialog utilities ;12/14/2006
"RTN","ORCDPS2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**94,116,125,131,243**;Dec 17, 1997;Build 242
"RTN","ORCDPS2",3,0)
 ;
"RTN","ORCDPS2",4,0)
COMPLEX() ; -- Single or complex?
"RTN","ORCDPS2",5,0)
 N X,Y,DIR,DUOUT,DTOUT,COMPLX
"RTN","ORCDPS2",6,0)
 S COMPLX=$S($O(ORDIALOG(PROMPT,"?"),-1)>1:1,$L($G(ORDIALOG($$PTR("DURATION"),1))):1,1:0)
"RTN","ORCDPS2",7,0)
 I $G(ORTYPE)="Q",$O(ORDIALOG(PROMPT,0)),FIRST Q COMPLX
"RTN","ORCDPS2",8,0)
 I $D(ORENEW)!$D(OREWRITE)!$D(ORXFER)!COMPLX Q COMPLX
"RTN","ORCDPS2",9,0)
 I $D(OREDIT) Q:$D(ORCOMPLX)!COMPLX COMPLX G CP1 ;Q if complex or 'first, else ask
"RTN","ORCDPS2",10,0)
 I 'FIRST S Y=$S($D(ORCOMPLX):ORCOMPLX,1:COMPLX) Q Y
"RTN","ORCDPS2",11,0)
CP1 S DIR(0)="YA",DIR("A")="Complex dose? ",DIR("B")="NO"
"RTN","ORCDPS2",12,0)
 S DIR("?")="Enter YES if you wish to enter multiple sets of dosage instructions, a tapering dose, or to limit the duration of a single dose."
"RTN","ORCDPS2",13,0)
 D ^DIR S:$D(DTOUT) Y="^"
"RTN","ORCDPS2",14,0)
 Q Y
"RTN","ORCDPS2",15,0)
 ;
"RTN","ORCDPS2",16,0)
DOSES ; -- Available common doses
"RTN","ORCDPS2",17,0)
 ;S $P(ORDIALOG(PROMPT,0),U,2)=$S(ORCAT="I":"1:20",1:"1:80")
"RTN","ORCDPS2",18,0)
 S ORDIALOG(PROMPT,"A")="Dose"_$S(ORCAT="I"&$G(ORIV):" or Rate: ",1:": ")
"RTN","ORCDPS2",19,0)
 S $P(ORDIALOG(PROMPT,"?"),",",2)=$S($G(ORIV):" as either a dose amount or infusion rate.",1:" as a dose or amount.")
"RTN","ORCDPS2",20,0)
 I FIRST,'$O(ORDIALOG(PROMPT,0)),$G(ORXFER) D SHOWSIG^ORCMED
"RTN","ORCDPS2",21,0)
 S ORCOMPLX=$$COMPLEX,MULT=+ORCOMPLX I ORCOMPLX="^" S ORQUIT=1 Q
"RTN","ORCDPS2",22,0)
 Q:$G(ORDIALOG(PROMPT,"LIST"))  Q:'$D(ORDOSE)
"RTN","ORCDPS2",23,0)
D1 ; -- Entry from ORCMED,NF^ORCDPS to build list
"RTN","ORCDPS2",24,0)
 N I,J,X,DD,DRUG,DOSE,CONJ,CNT,UD,COST,TEXT
"RTN","ORCDPS2",25,0)
 S (I,CNT)=0,CONJ=$P($G(ORDOSE("MISC")),U,3) S:$L(CONJ) CONJ=" "_CONJ
"RTN","ORCDPS2",26,0)
 F  S I=$O(ORDOSE(I)) Q:I'>0  D
"RTN","ORCDPS2",27,0)
 . S X=ORDOSE(I),DD=+$P(X,U,6),DRUG=ORDOSE("DD",DD)
"RTN","ORCDPS2",28,0)
 . ;  =TotalDose^Units^U/D^Noun^LocalDose^DispDrugIEN^Cost
"RTN","ORCDPS2",29,0)
 . ;DD=Name^Cost^NF^DispUnit^Strength^Units^DoseForm^MaxRefills?
"RTN","ORCDPS2",30,0)
 . S DOSE=$P(X,U,5),UD=$P(X,U,3),COST=$P(X,U,7) Q:'$L(DOSE)
"RTN","ORCDPS2",31,0)
 . I '$P(X,U) S DOSE=DOSE_CONJ_" "_$S($L($P(DRUG,U,5)):$P(DRUG,U,5)_$P(DRUG,U,6),1:$P(DRUG,U))
"RTN","ORCDPS2",32,0)
 . ;I UD S COST="$"_$J(UD*$P(DRUG,U,2),1,3) ;_" per "_UD_" "_$P(X,U,4)
"RTN","ORCDPS2",33,0)
 . S TEXT=DOSE_$S($L(COST):"     $"_COST,1:"")_$S($P(DRUG,U,3):"   (non-formulary)",1:"")
"RTN","ORCDPS2",34,0)
 . S CNT=CNT+1,ORDIALOG(PROMPT,"LIST",CNT)=DOSE_U_TEXT
"RTN","ORCDPS2",35,0)
 . S ORDIALOG(PROMPT,"LIST","B",TEXT)=DOSE
"RTN","ORCDPS2",36,0)
 . S ORDIALOG(PROMPT,"LIST","D",DOSE)=DD ;default DispDrug
"RTN","ORCDPS2",37,0)
 . S ORDOSE("DD",DD,DOSE)=$P(ORDOSE(I),U,1,6)_U_$P(DRUG,U,5,6)
"RTN","ORCDPS2",38,0)
 . S J=0 F  S J=$O(ORDOSE(I,J)) Q:J'>0  D  ;xref alt forms of dose
"RTN","ORCDPS2",39,0)
 .. S DD=+$P(ORDOSE(I,J),U,6),DRUG=$G(ORDOSE("DD",DD))
"RTN","ORCDPS2",40,0)
 .. S ORDOSE("DD",DD,DOSE)=$P(ORDOSE(I,J),U,1,6)_U_$P(DRUG,U,5,6)
"RTN","ORCDPS2",41,0)
 S:CNT ORDIALOG(PROMPT,"LIST")=CNT
"RTN","ORCDPS2",42,0)
 Q
"RTN","ORCDPS2",43,0)
 ;
"RTN","ORCDPS2",44,0)
CHDOSE ; -- Kill dependent values if inst ORI of dose changes
"RTN","ORCDPS2",45,0)
 N X,PROMPTS,P,NAME,DOSE,DD S X=$G(ORDIALOG(PROMPT,ORI))
"RTN","ORCDPS2",46,0)
 S X=$$UP^XLFSTR(X),ORDIALOG(PROMPT,ORI)=X ;force uppercase
"RTN","ORCDPS2",47,0)
 I X,X'?1.N.E1.A.E K DONE W $C(7),!,"Enter the amount of this drug that the patient is to receive as a dose,",!,"NOT as the number of units per dose." Q
"RTN","ORCDPS2",48,0)
 I $L(X)>60,'$D(ORDIALOG(PROMPT,"LIST","B",X)) K DONE W $C(7),!,"Instructions may not be longer than 60 characters." Q
"RTN","ORCDPS2",49,0)
 I $G(ORESET)'=X D  ;kill dependent values if new/changed dose
"RTN","ORCDPS2",50,0)
 . S PROMPTS="STRENGTH^DRUG NAME^DOSE^DISPENSE DRUG^DAYS SUPPLY^QUANTITY^REFILLS"
"RTN","ORCDPS2",51,0)
 . F P=1:1:$L(PROMPTS,U) S NAME=$P(PROMPTS,U,P) K ORDIALOG($$PTR(NAME),ORI)
"RTN","ORCDPS2",52,0)
 . K ORQTY,ORQTYUNT,ORDRUG,ORDIALOG($$PTR("DISPENSE DRUG"),1)
"RTN","ORCDPS2",53,0)
 . K ^TMP("ORWORD",$J,$$PTR("SIG"))
"RTN","ORCDPS2",54,0)
 S DOSE=$$PTR("DOSE") I $L(X),'$L($G(ORDIALOG(DOSE,ORI))) D  ;set ID
"RTN","ORCDPS2",55,0)
 . S DD=+$G(ORDIALOG(PROMPT,"LIST","D",X))
"RTN","ORCDPS2",56,0)
 . S:DD ORDIALOG(DOSE,ORI)=$TR($G(ORDOSE("DD",DD,X)),"^","&")
"RTN","ORCDPS2",57,0)
 S DD=+$P($G(ORDIALOG(DOSE,ORI)),"&",6)
"RTN","ORCDPS2",58,0)
 I DD,$P($G(ORDOSE("DD",DD)),U,3) D NF^ORCDPS(DD) ;look for FormAlt
"RTN","ORCDPS2",59,0)
 Q
"RTN","ORCDPS2",60,0)
 ;
"RTN","ORCDPS2",61,0)
EXDOSE ; -- Exit Action
"RTN","ORCDPS2",62,0)
 Q:'$O(ORDIALOG(PROMPT,0))  N DRUG,MISC,QUIT,LAST
"RTN","ORCDPS2",63,0)
 S ORDRUG=$$DISPDRUG^ORCDPS,DRUG=$G(ORDOSE("DD",+ORDRUG))
"RTN","ORCDPS2",64,0)
 I ORDRUG D  I $G(QUIT) S ORQUIT=1 Q
"RTN","ORCDPS2",65,0)
 . ;I $P(DRUG,U,10),'$L($P($G(^VA(200,+$G(ORNP),"PS")),U,2)),'$L($P($G(^("PS")),U,3)) W $C(7),!,$P($G(^(0)),U)_" must have a DEA# or VA# to order this drug!" S QUIT=1 Q
"RTN","ORCDPS2",66,0)
 . ;I $P(DRUG,U,10)=1 W $C(7),!,"This order will require a wet signature!"
"RTN","ORCDPS2",67,0)
 . S ORDIALOG($$PTR("DISPENSE DRUG"),1)=ORDRUG
"RTN","ORCDPS2",68,0)
 . D:$G(ORCAT)="O" RESETID^ORCDPS
"RTN","ORCDPS2",69,0)
 . N STR,MED S STR=$P(DRUG,U,5)_$P(DRUG,U,6)
"RTN","ORCDPS2",70,0)
 . I STR'>0 S:'$G(ORDOSE(1)) ORDIALOG($$PTR("DRUG NAME"),1)=$P(DRUG,U) Q
"RTN","ORCDPS2",71,0)
 . S MED=$P($G(^ORD(101.43,+$G(OROI),0)),U)
"RTN","ORCDPS2",72,0)
 . I MED'[STR,ORCAT="O"!'$G(ORDOSE(1)) S ORDIALOG($$PTR("STRENGTH"),1)=STR
"RTN","ORCDPS2",73,0)
 I +ORDRUG'>0,ORCAT="O" W $C(7),!,"Cannot determine dispense drug - some defaults and order checks may not occur!"
"RTN","ORCDPS2",74,0)
EXD1 ; -- Kill dangling conjunction, [re]build Sig, get Qty info
"RTN","ORCDPS2",75,0)
 S LAST=$O(ORDIALOG(PROMPT,"?"),-1) K ORDIALOG($$PTR("AND/THEN"),LAST)
"RTN","ORCDPS2",76,0)
 D ADMIN^ORCDPS3 D:$G(ORTYPE)'="Z" SIG ;[re]build Sig/Text
"RTN","ORCDPS2",77,0)
 I ORDRUG,ORCAT="O" D  ;set Qty info
"RTN","ORCDPS2",78,0)
 . S:$L($P(DRUG,U,4)) ORQTYUNT=$P(DRUG,U,4)
"RTN","ORCDPS2",79,0)
 . S MISC=$$ENDCM^PSJORUTL(+ORDRUG),ORQTY=$P(MISC,U,4)
"RTN","ORCDPS2",80,0)
 . W:$L($P(MISC,U,2)) !!,$P(MISC,U,2),!
"RTN","ORCDPS2",81,0)
 Q
"RTN","ORCDPS2",82,0)
 ;
"RTN","ORCDPS2",83,0)
SIG ; -- Create ORDIALOG(SIG) from Instructions PROMPT,ORDOSE,ORDRUG,ORCAT
"RTN","ORCDPS2",84,0)
 ;    Return text in ^TMP("ORWORD",$J,SIG,INST)
"RTN","ORCDPS2",85,0)
 ;   [also called from PSJ^ORCSEND1 to build child orders]
"RTN","ORCDPS2",86,0)
 ;
"RTN","ORCDPS2",87,0)
 N ORT,ORSCH,ORDUR,ORID,ORDD,ORCNJ,ORMISC,ORPREP,ORX,ORI,CNT,ORSIG,ORS,DOSE
"RTN","ORCDPS2",88,0)
 S ORT=$$PTR("ROUTE"),ORSCH=$$PTR("SCHEDULE"),ORDUR=$$PTR("DURATION")
"RTN","ORCDPS2",89,0)
 S ORID=$$PTR("DOSE"),ORCNJ=$$PTR("AND/THEN"),ORS=$$PTR("SIG")
"RTN","ORCDPS2",90,0)
 S ORMISC=$G(ORDOSE("MISC")),ORPREP=$P(ORMISC,U,2)
"RTN","ORCDPS2",91,0)
 S ORX=$S(ORCAT="I":"",ORCAT="O"&(+$G(ISIMO)=1):"",$L($P(ORMISC,U)):$P(ORMISC,U)_" ",1:"") ;"TAKE "
"RTN","ORCDPS2",92,0)
 S (CNT,ORI)=0 F  S ORI=$O(ORDIALOG(PROMPT,ORI)) Q:ORI'>0  D
"RTN","ORCDPS2",93,0)
 . S DOSE=$G(ORDIALOG(PROMPT,ORI)) Q:'$L(DOSE)
"RTN","ORCDPS2",94,0)
 . S ORX=ORX_$$DOSE_$$RTE_$$SCH_$$DUR_$$CONJ
"RTN","ORCDPS2",95,0)
 . S CNT=CNT+1,ORSIG(CNT,0)=ORX,ORX=""
"RTN","ORCDPS2",96,0)
 Q:CNT'>0  S ORSIG(0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORCDPS2",97,0)
 K ^TMP("ORWORD",$J,ORS,1) M ^(1)=ORSIG S ORDIALOG(PROMPT,"FORMAT")="@"
"RTN","ORCDPS2",98,0)
 S ORDIALOG(ORS,1)=$NA(^TMP("ORWORD",$J,ORS,1))
"RTN","ORCDPS2",99,0)
 Q
"RTN","ORCDPS2",100,0)
 ;
"RTN","ORCDPS2",101,0)
PTR(X) ; -- Ptr to prompt OR GTX X
"RTN","ORCDPS2",102,0)
 Q +$O(^ORD(101.41,"AB","OR GTX "_X,0))
"RTN","ORCDPS2",103,0)
 ;
"RTN","ORCDPS2",104,0)
DOSE() ; -- Dosage
"RTN","ORCDPS2",105,0)
 N X0,Y S X0=$G(ORDIALOG(ORID,ORI)) ;ID string
"RTN","ORCDPS2",106,0)
 S Y=DOSE I ORDRUG,$L(X0) D  ;use local dose if common DispDrug
"RTN","ORCDPS2",107,0)
 . S:$L($P(X0,"&",5)) Y=$P(X0,"&",5) ;unless Outpt w/total dose
"RTN","ORCDPS2",108,0)
 . I ORCAT="O",X0 S Y=$$WORD($P(X0,"&",3))_" "_$P(X0,"&",4) ;u/d
"RTN","ORCDPS2",109,0)
 Q Y
"RTN","ORCDPS2",110,0)
 ;
"RTN","ORCDPS2",111,0)
WORD(X) ; -- Words for number X
"RTN","ORCDPS2",112,0)
 N X1,X2,Y S X1=$P(+X,"."),X2=$P(+X,".",2)
"RTN","ORCDPS2",113,0)
 S Y="" I X1 S Y=$S(X1=1:"ONE",X1=2:"TWO",X1=3:"THREE",X1=4:"FOUR",X1=5:"FIVE",X1=6:"SIX",X1=7:"SEVEN",X1=8:"EIGHT",X1=9:"NINE",X1=10:"TEN",1:X1)
"RTN","ORCDPS2",114,0)
 I X2 S Y=Y_$S($L(Y):" AND ",1:"")_$S(X2=5:"ONE-HALF",X2=33!(X2=34):"ONE-THIRD",X2=25:"ONE-FOURTH",X2=66!(X2=67):"TWO-THIRDS",X2=75:"THREE-FOURTHS",1:"."_X2)
"RTN","ORCDPS2",115,0)
 Q Y
"RTN","ORCDPS2",116,0)
 ;
"RTN","ORCDPS2",117,0)
RTE() ; -- Expansion of route
"RTN","ORCDPS2",118,0)
 N X,X0,Y S X=+$G(ORDIALOG(ORT,ORI)) Q:X'>0 ""
"RTN","ORCDPS2",119,0)
 K ^TMP($J,"ORCDPS2 RTE")
"RTN","ORCDPS2",120,0)
 D ALL^PSS51P2(+X,,,,"ORCDPS2 RTE")
"RTN","ORCDPS2",121,0)
 ;S X0=$G(^PS(51.2,+X,0)),Y=""
"RTN","ORCDPS2",122,0)
 I ORCAT="I"!(+$G(ISIMO)=1) S Y=" "_$S($L(^TMP($J,"ORCDPS2 RTE",+X,1)):^TMP($J,"ORCDPS2 RTE",+X,1),1:^TMP($J,"ORCDPS2 RTE",+X,.01))
"RTN","ORCDPS2",123,0)
 ;I ORCAT="I" S Y=" "_$S($L($P(X0,U,3)):$P(X0,U,3),1:$P(X0,U))
"RTN","ORCDPS2",124,0)
 I ORCAT="O",'+$G(ISIMO) S Y=" "_$S($L(ORPREP):ORPREP_" ",1:"")_$S($L(^TMP($J,"ORCDPS2 RTE",+X,4)):^TMP($J,"ORCDPS2 RTE",+X,4),1:^TMP($J,"ORCDPS2 RTE",+X,.01))
"RTN","ORCDPS2",125,0)
 Q Y
"RTN","ORCDPS2",126,0)
 ;
"RTN","ORCDPS2",127,0)
SCH() ; -- [outpatient] expansion of schedule
"RTN","ORCDPS2",128,0)
 N X,Y S X=$G(ORDIALOG(ORSCH,ORI))
"RTN","ORCDPS2",129,0)
 I $L(X),ORCAT="O",'+$G(ISIMO) D SCH^PSSUTIL1(.X)
"RTN","ORCDPS2",130,0)
 S Y=$S($L(X):" "_X,1:"")
"RTN","ORCDPS2",131,0)
 Q Y
"RTN","ORCDPS2",132,0)
 ;
"RTN","ORCDPS2",133,0)
DUR() ; -- Duration
"RTN","ORCDPS2",134,0)
 N X,Y S X=$G(ORDIALOG(ORDUR,ORI)),Y=""
"RTN","ORCDPS2",135,0)
 I X S Y=" FOR "_$$UP^XLFSTR(X)_$S(+X=X:" DAYS",1:"")
"RTN","ORCDPS2",136,0)
 Q Y
"RTN","ORCDPS2",137,0)
 ;
"RTN","ORCDPS2",138,0)
CONJ() ; -- Conjunction
"RTN","ORCDPS2",139,0)
 N X,Y S X=$G(ORDIALOG(ORCNJ,ORI))
"RTN","ORCDPS2",140,0)
 S:$L(X)>1 X=$E(X) S:X="E" S="X"
"RTN","ORCDPS2",141,0)
 S Y=$S(X="T":", THEN",X="X":" EXCEPT",X="A":" AND",1:"")
"RTN","ORCDPS2",142,0)
 Q Y
"RTN","ORCDPS2",143,0)
 ;
"RTN","ORCDPS2",144,0)
DOSETEXT        ; -- Reset dose text in ORDIALOG(INSTR) for backdoor orders
"RTN","ORCDPS2",145,0)
 ;    [Called from ORMPS1 - uses ORCAT,PSOI,ORVP,DRUG,INSTR,DOSE]
"RTN","ORCDPS2",146,0)
 ;
"RTN","ORCDPS2",147,0)
 N ORTYPE,ORDOSE,CONJ,ORDRUG,DRUG0,STRG,ORI,LDOSE,X,PROMPT
"RTN","ORCDPS2",148,0)
 S ORTYPE=$S($G(ORCAT)="I":"U",1:"O")
"RTN","ORCDPS2",149,0)
 D DOSE^PSSORUTL(.ORDOSE,+PSOI,ORTYPE,+ORVP)
"RTN","ORCDPS2",150,0)
 S CONJ=$P($G(ORDOSE("MISC")),U,3) S:$L(CONJ) CONJ=" "_CONJ
"RTN","ORCDPS2",151,0)
 S ORDRUG=+$G(ORDIALOG(DRUG,1)),DRUG0=$G(ORDOSE("DD",ORDRUG))
"RTN","ORCDPS2",152,0)
 S STRG=$P(DRUG0,U,5)_$P(DRUG0,U,6)
"RTN","ORCDPS2",153,0)
 I '$G(ORDOSE(1)) S ORI=0 F  S ORI=$O(ORDIALOG(INSTR,ORI)) Q:ORI'>0  D
"RTN","ORCDPS2",154,0)
 . S LDOSE=$G(ORDIALOG(INSTR,ORI)),X=$G(ORDIALOG(DOSE,ORI)) Q:'$L(X)
"RTN","ORCDPS2",155,0)
 . S:'X ORDIALOG(INSTR,ORI)=LDOSE_CONJ_" "_$S(STRG:STRG,1:$P(DRUG0,U))
"RTN","ORCDPS2",156,0)
 ; -build Sig/Text if not defined
"RTN","ORCDPS2",157,0)
 I '$D(ORDIALOG(+$$PTR("SIG"),1)) S PROMPT=INSTR D SIG
"RTN","ORCDPS2",158,0)
 Q
"RTN","ORCDPS2",159,0)
 ;
"RTN","ORCDPS2",160,0)
PI ; -- Include Pt Instructions w/Sig in Outpt order?
"RTN","ORCDPS2",161,0)
 N X,Y,DIR,DUOUT,DTOUT,DIRUT,ORTX,ORMAX,I,CNT
"RTN","ORCDPS2",162,0)
 I $G(ORCAT)'="O" D CLEARWP Q  ;!'$O(ORDOSE("PI",0))
"RTN","ORCDPS2",163,0)
 Q:$G(ORENEW)  S I=0,ORMAX=57
"RTN","ORCDPS2",164,0)
 I $G(OREDIT)!$G(OREWRITE),$O(^TMP("ORWORD",$J,PROMPT,INST,0)) K ORDOSE("PI") S I=0 F  S I=$O(^TMP("ORWORD",$J,PROMPT,INST,I)) Q:I<1  S ORDOSE("PI",I)=$G(^(I,0))
"RTN","ORCDPS2",165,0)
 I '$O(ORDOSE("PI",0)) D CLEARWP Q
"RTN","ORCDPS2",166,0)
 F  S I=$O(ORDOSE("PI",I)) Q:I'>0  S X=ORDOSE("PI",I) D TXT^ORCHTAB
"RTN","ORCDPS2",167,0)
 S DIR(0)="YA",DIR("A")="Include Patient Instructions in Sig? "
"RTN","ORCDPS2",168,0)
 S DIR("?")="Enter NO if you do not want these instructions included in the sig for this order",DIR("B")=$S($D(^TMP("ORWORD",$J,PROMPT)):"YES",1:"NO")
"RTN","ORCDPS2",169,0)
 W ! S I=0 F  S I=$O(ORTX(I)) Q:I'>0  W !,$S(I=1:"Patient Instructions: ",1:"                      ")_ORTX(I)
"RTN","ORCDPS2",170,0)
 D ^DIR I $D(DUOUT)!$D(DTOUT) S ORQUIT=1 Q
"RTN","ORCDPS2",171,0)
 I Y D  Q  ;save text
"RTN","ORCDPS2",172,0)
 . K ^TMP("ORWORD",$J,PROMPT,INST) S CNT=0
"RTN","ORCDPS2",173,0)
 . S I=0 F  S I=$O(ORDOSE("PI",I)) Q:I'>0  S ^TMP("ORWORD",$J,PROMPT,INST,I,0)=ORDOSE("PI",I),CNT=CNT+1
"RTN","ORCDPS2",174,0)
 . S ^TMP("ORWORD",$J,PROMPT,INST,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORCDPS2",175,0)
 . S ORDIALOG(PROMPT,INST)="^TMP(""ORWORD"","_$J_","_PROMPT_","_INST_")"
"RTN","ORCDPS2",176,0)
 I Y'>0 K ORDIALOG(PROMPT,INST),^TMP("ORWORD",$J,PROMPT,INST)
"RTN","ORCDPS2",177,0)
 Q
"RTN","ORCDPS2",178,0)
 ;
"RTN","ORCDPS2",179,0)
CLEARWP ; -- Clear INST of wp field PROMPT
"RTN","ORCDPS2",180,0)
 K ORDIALOG(PROMPT,INST),^TMP("ORWORD",$J,PROMPT,INST)
"RTN","ORCDPS2",181,0)
 Q
"RTN","ORCDPS3")
0^10^B43323695
"RTN","ORCDPS3",1,0)
ORCDPS3 ;SLC/MKB-Pharmacy dialog utilities ;09/11/07
"RTN","ORCDPS3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**94,116,134,158,149,190,277,243**;Dec 17, 1997;Build 242
"RTN","ORCDPS3",3,0)
 ;
"RTN","ORCDPS3",4,0)
START ; -- Start Date entry action
"RTN","ORCDPS3",5,0)
 S $P(ORDIALOG(PROMPT,0),":",3)=$S($G(ORCAT)="I":"ETRX",1:"EX")
"RTN","ORCDPS3",6,0)
 I $G(ORCAT)'="I" K ORSD K:$G(ORENEW)!$G(OREWRITE)!$D(OREDIT) ORDIALOG(PROMPT,INST) ;Inpt only
"RTN","ORCDPS3",7,0)
 Q
"RTN","ORCDPS3",8,0)
 ;
"RTN","ORCDPS3",9,0)
ADMIN ; -- Return default admin time for order in ORSD
"RTN","ORCDPS3",10,0)
 ;    Called from EXDOSE^ORCDPS2
"RTN","ORCDPS3",11,0)
 Q:$D(ORSD)  Q:$G(ORCAT)'="I"  ;inpt only
"RTN","ORCDPS3",12,0)
 N PSOI,PSIFN,SCH,CNJ,ORI,ORX
"RTN","ORCDPS3",13,0)
 S PSOI=+$P($G(^ORD(101.43,+$G(OROI),0)),U,2)
"RTN","ORCDPS3",14,0)
 S PSIFN=$S($G(ORENEW):$G(^OR(100,+$G(ORIFN),4)),1:"")
"RTN","ORCDPS3",15,0)
 S SCH=$$PTR^ORCD("OR GTX SCHEDULE"),CNJ=$$PTR^ORCD("OR GTX AND/THEN"),ORX=""
"RTN","ORCDPS3",16,0)
 S ORI=0 F  S ORI=$O(ORDIALOG(PROMPT,ORI)) Q:ORI<1  S ORX=ORX_$S($L(ORX):U,1:"")_$G(ORDIALOG(CNJ,ORI))_";"_$G(ORDIALOG(SCH,ORI))
"RTN","ORCDPS3",17,0)
 S ORSD=$$FIRST(+ORVP,+$G(ORWARD),PSOI,ORX,PSIFN,"")
"RTN","ORCDPS3",18,0)
 S:$P(ORSD,U)="NEXT" ORSD="NEXTA^"_$P(ORSD,U,2,99)
"RTN","ORCDPS3",19,0)
 Q
"RTN","ORCDPS3",20,0)
 ;
"RTN","ORCDPS3",21,0)
FIRST(DFN,WARD,OI,DATA,ORDER,ADMIN)   ; -- Return expected first admin time of order
"RTN","ORCDPS3",22,0)
 N CNT,ORCNT,ORI,J,ORZ,Y,SCH,ORX,TNUM
"RTN","ORCDPS3",23,0)
 I '$G(DFN)!'$G(OI) Q ""
"RTN","ORCDPS3",24,0)
 S ORCNT=0 F ORI=1:1:$L(DATA,"^") S ORZ=$P(DATA,U,ORI) D  Q:$E(ORZ)="T"
"RTN","ORCDPS3",25,0)
 .S TNUM=$$NUMCHAR(ORZ,";") Q:TNUM=0
"RTN","ORCDPS3",26,0)
 .F CNT=1:1:TNUM D
"RTN","ORCDPS3",27,0)
 .. S SCH=$P(ORZ,";",CNT+1) Q:'$L(SCH)  S ORCNT=ORCNT+1
"RTN","ORCDPS3",28,0)
 .. I ORCNT>1 S ADMIN=""
"RTN","ORCDPS3",29,0)
 .. S ORX(ORCNT)=$$STARTSTP^PSJORPOE(DFN,SCH,OI,WARD,$G(ORDER),$G(ADMIN))
"RTN","ORCDPS3",30,0)
 S Y=9999999,J=0
"RTN","ORCDPS3",31,0)
 F ORI=1:1:ORCNT S ORZ=$P(ORX(ORI),U,4) I ORZ<Y S Y=ORZ,J=ORI ;earliest
"RTN","ORCDPS3",32,0)
 S Y=$S(J:ORX(J),1:"")
"RTN","ORCDPS3",33,0)
 Q Y
"RTN","ORCDPS3",34,0)
 ;
"RTN","ORCDPS3",35,0)
NUMCHAR(STRING,SUB) ;
"RTN","ORCDPS3",36,0)
 N CNT,RESULT
"RTN","ORCDPS3",37,0)
 S RESULT=0
"RTN","ORCDPS3",38,0)
 F CNT=1:1:$L(STRING) I $E(STRING,CNT)=SUB S RESULT=RESULT+1
"RTN","ORCDPS3",39,0)
 Q RESULT
"RTN","ORCDPS3",40,0)
 ;
"RTN","ORCDPS3",41,0)
NOW ; -- First dose now?
"RTN","ORCDPS3",42,0)
 N X,Y,DIR,SCH
"RTN","ORCDPS3",43,0)
 K ^TMP($J,"ORCDPS3 NOW")
"RTN","ORCDPS3",44,0)
 I $G(ORCAT)="O"!'$D(ORSD)!$L($G(OREVENT))!$G(ORENEW) K ORDIALOG(PROMPT,INST),^TMP($J,"ORCDPS3 NOW") Q
"RTN","ORCDPS3",45,0)
 D AP^PSS51P1("PSJ",,,,"ORCDPS3 NOW")
"RTN","ORCDPS3",46,0)
 ; ask on Copy? Change?
"RTN","ORCDPS3",47,0)
 S X=$$PTR^ORCD("OR GTX SCHEDULE"),Y=+$O(ORDIALOG(X,0))
"RTN","ORCDPS3",48,0)
 S SCH=$G(ORDIALOG(X,Y)),Y=+$O(^TMP($J,"ORCDPS3 NOW","APPSJ",SCH,0)) ;1st one
"RTN","ORCDPS3",49,0)
 ;S SCH=$G(ORDIALOG(X,Y)),Y=+$O(^PS(51.1,"APPSJ",SCH,0)) ;1st one
"RTN","ORCDPS3",50,0)
 I $G(^TMP($J,"ORCDPS3 NOW",SCH,5))=""!(Y<1) K ORDIALOG(PROMPT,INST),^TMP($J,"ORCDPS3 NOW") Q
"RTN","ORCDPS3",51,0)
 ;I $P($G(^PS(51.1,Y,0)),U,5)="O"!(Y<1) K ORDIALOG(PROMPT,INST),^TMP($J,"ORCDPS3 NOW") Q
"RTN","ORCDPS3",52,0)
 ; other conditions?
"RTN","ORCDPS3",53,0)
 S DIR(0)="YA",DIR("A")="Give additional dose NOW? "
"RTN","ORCDPS3",54,0)
 S DIR("B")=$S($G(ORDIALOG(PROMPT,INST)):"YES",1:"NO")
"RTN","ORCDPS3",55,0)
 I ORINPT,$P(ORSD,U,4) S DIR("A",1)="Next scheduled administration time: "_$$FMTE^XLFDT($P(ORSD,U,4))
"RTN","ORCDPS3",56,0)
 S DIR("?")="Enter YES if you want a dose given now in addition to the regular administration times for this schedule and ward."
"RTN","ORCDPS3",57,0)
 D ^DIR S:$D(DTOUT)!$D(DUOUT) ORQUIT=1
"RTN","ORCDPS3",58,0)
 I $G(ORQUIT)!(Y'>0) K ORDIALOG(PROMPT,INST),^TMP($J,"ORCDPS3 NOW") Q
"RTN","ORCDPS3",59,0)
 S ORDIALOG(PROMPT,INST)=1 I $G(ORCOMPLX) D
"RTN","ORCDPS3",60,0)
 . W $C(7),!,"  >> First Dose NOW is in addition to those already entered.    <<"
"RTN","ORCDPS3",61,0)
 . W !,"  >> Please adjust the duration of the first one, if necessary. <<"
"RTN","ORCDPS3",62,0)
 K ^TMP($J,"ORCDPS3 NOW")
"RTN","ORCDPS3",63,0)
 Q
"RTN","ORCDPS3",64,0)
 ;
"RTN","ORCDPS3",65,0)
DEFSTRT ; -- Returns default start date/time in Y
"RTN","ORCDPS3",66,0)
 ;    Expects PROMPT,INST,ORDIALOG,ORSD to be defined
"RTN","ORCDPS3",67,0)
 ;
"RTN","ORCDPS3",68,0)
 Q:$G(ORCAT)="O"  Q:$G(ORTYPE)="Z"  ;skip if outpt or editor
"RTN","ORCDPS3",69,0)
 N LAST,STRT,DUR,D1,D2,OFF,F1,F2,UNT,Y1,Y2,I,J K Y
"RTN","ORCDPS3",70,0)
 S LAST=+$O(ORDIALOG(+$$PTR^ORCD("OR GTX INSTRUCTIONS"),INST),-1)
"RTN","ORCDPS3",71,0)
 S STRT=$G(ORDIALOG(PROMPT,LAST))
"RTN","ORCDPS3",72,0)
 I LAST'>0!'$L(STRT) S:$L($P($G(ORSD),U)) Y=$P(ORSD,U) Q  ;first inst
"RTN","ORCDPS3",73,0)
 S DUR=$G(ORDIALOG(+$$PTR^ORCD("OR GTX DURATION"),LAST))
"RTN","ORCDPS3",74,0)
 I +DUR'>0 S Y=STRT Q  ;no duration = same start
"RTN","ORCDPS3",75,0)
 S DUR=$$FMDUR(DUR) I STRT D  Q  ;FM date/time, so just add
"RTN","ORCDPS3",76,0)
 . N X,%DT S %DT="TX",X=STRT_"+"_DUR D ^%DT
"RTN","ORCDPS3",77,0)
 . I Y'>0 S Y=STRT ;error
"RTN","ORCDPS3",78,0)
 S D1=+DUR,D2=$P(DUR,D1,2) S:(STRT="NEXTA")!(STRT="CLOSEST") STRT="NOW"
"RTN","ORCDPS3",79,0)
 S OFF=$P(STRT,"+",2) I '$L(OFF) S Y=STRT_"+"_DUR Q  ;no prev offset
"RTN","ORCDPS3",80,0)
 S F1=+OFF,F2=$P(OFF,F1,2),UNT=F2,Y=STRT
"RTN","ORCDPS3",81,0)
 I D2=F2 S Y=$P(STRT,"+")_"+"_(D1+F1)_UNT Q  ;same units
"RTN","ORCDPS3",82,0)
 F I="S","'","H","D","W","M" I (F2=I)!(D2=I) S UNT=I D  Q
"RTN","ORCDPS3",83,0)
 . S:D2=UNT Y1=D1,X1=F1,X2=F2 ; Y1=# in UNT
"RTN","ORCDPS3",84,0)
 . S:F2=UNT Y1=F1,X1=D1,X2=D2 ; X1=# in other units X2
"RTN","ORCDPS3",85,0)
 . F J=1:1 S Z=$T(CONV+J) Q:Z["ZZZZ"  I $P(Z,";",3,4)=(X2_";"_UNT) S Y2=+$P(Z,";",5) Q
"RTN","ORCDPS3",86,0)
 . S Y=$P(STRT,"+")_"+"_(Y1+$S(Y2:Y2*X1,1:0))_UNT
"RTN","ORCDPS3",87,0)
 Q
"RTN","ORCDPS3",88,0)
 ;
"RTN","ORCDPS3",89,0)
FMDUR(X)        ; -- convert '# DAYS' to #D
"RTN","ORCDPS3",90,0)
 N X1,X2,Y I +X'>0 Q ""
"RTN","ORCDPS3",91,0)
 S X1=+X,X2=$P(X," ",2) S:'$L(X2) X2="DAYS"
"RTN","ORCDPS3",92,0)
 S Y=X1_$S("MINUTES"[X2:"'",1:$E(X2))
"RTN","ORCDPS3",93,0)
 Q Y
"RTN","ORCDPS3",94,0)
 ;
"RTN","ORCDPS3",95,0)
CONV ;;unit;unit;factor
"RTN","ORCDPS3",96,0)
 ;;';S;60
"RTN","ORCDPS3",97,0)
 ;;H;';60
"RTN","ORCDPS3",98,0)
 ;;H;S;3600
"RTN","ORCDPS3",99,0)
 ;;D;H;24
"RTN","ORCDPS3",100,0)
 ;;D;';1440
"RTN","ORCDPS3",101,0)
 ;;D;S;86400
"RTN","ORCDPS3",102,0)
 ;;W;D;7
"RTN","ORCDPS3",103,0)
 ;;W;H;168
"RTN","ORCDPS3",104,0)
 ;;W;';10080
"RTN","ORCDPS3",105,0)
 ;;W;S;604800
"RTN","ORCDPS3",106,0)
 ;;M;W;4
"RTN","ORCDPS3",107,0)
 ;;M;D;30
"RTN","ORCDPS3",108,0)
 ;;M;H;720
"RTN","ORCDPS3",109,0)
 ;;M;';43200
"RTN","ORCDPS3",110,0)
 ;;M;S;2592000
"RTN","ORCDPS3",111,0)
 ;;ZZZZ
"RTN","ORCDPS3",112,0)
 ;
"RTN","ORCDPS3",113,0)
ASKDUR()        ; -- Returns 1 or 0, if Duration prompt should be asked
"RTN","ORCDPS3",114,0)
 K ^TMP($J,"ORCDPS3 ASKDUR")
"RTN","ORCDPS3",115,0)
 N X,Y I '$G(ORCOMPLX) K ORDIALOG(PROMPT,INST) Q 0
"RTN","ORCDPS3",116,0)
 S Y=1 G:'$L($G(ORSCH)) ADQ ;no schedule
"RTN","ORCDPS3",117,0)
 D AP^PSS51P1("PSJ",,,,"ORCDPS3 ASKDUR")
"RTN","ORCDPS3",118,0)
 S X=+$O(^TMP($J,"ORCDPS3 ASKDUR","APPSJ",ORSCH,"")) G:X'>0 ADQ
"RTN","ORCDPS3",119,0)
 ;S X=+$O(^PS(51.1,"APPSJ",ORSCH,0)) G:X'>0 ADQ
"RTN","ORCDPS3",120,0)
 S:^TMP($J,"ORCDPS3 ASKDUR",X,5)="O" Y=0
"RTN","ORCDPS3",121,0)
 ;S:$P($G(^PS(51.1,X,0)),U,5)="O" Y=0
"RTN","ORCDPS3",122,0)
ADQ ;
"RTN","ORCDPS3",123,0)
 K ^TMP($J,"ORCDPS3 ASKDUR")
"RTN","ORCDPS3",124,0)
 Q Y
"RTN","ORCDPS3",125,0)
 ;
"RTN","ORCDPS3",126,0)
CKDUR(X) ; -- Returns validated form of duration X, or null if invalid
"RTN","ORCDPS3",127,0)
 N X1,X2,Y,Z S Y=""
"RTN","ORCDPS3",128,0)
 S X1=+$G(X),X2=$P($G(X),X1,2) I X1'>0 Q ""
"RTN","ORCDPS3",129,0)
 S X2=$$UP^XLFSTR(X2),X2=$$STRIP^XLFSTR(X2," ") S:'$L(X2) X2="DAYS"
"RTN","ORCDPS3",130,0)
 F Z="MONTHS^&MONTHS&MONS","WEEKS^&WEEKS&WKS","DAYS^&DAYS&DYS","HOURS^&HOURS&HRS","MINUTES^&MINUTES&MINS'","SECONDS^&SECONDS&SECS" I $P(Z,U,2)[("&"_X2) S Y=$P(Z,U) Q
"RTN","ORCDPS3",131,0)
 S:$L(Y) Y=X1_" "_$S(X1=1:$E(Y,1,$L(Y)-1),1:Y) ;strip trailing 's'
"RTN","ORCDPS3",132,0)
 Q Y
"RTN","ORCDPS3",133,0)
 ;
"RTN","ORCDPS3",134,0)
DUR ; -- Process duration [from P-S Action]
"RTN","ORCDPS3",135,0)
 N X S X=$G(ORDIALOG(PROMPT,ORI)),X=$$CKDUR(X)
"RTN","ORCDPS3",136,0)
 I '$L(X) K DONE W $C(7),!,ORDIALOG(PROMPT,"?"),! Q
"RTN","ORCDPS3",137,0)
 S ORDIALOG(PROMPT,ORI)=X D:$G(ORESET)'=X CHANGED^ORCDPS1("QUANTITY")
"RTN","ORCDPS3",138,0)
 Q
"RTN","ORCDPS3",139,0)
 ;
"RTN","ORCDPS3",140,0)
TEST(START,DURTN)       ; -- test DEFSTRT
"RTN","ORCDPS3",141,0)
 N INST,ORSD,ORDIALOG,PROMPT
"RTN","ORCDPS3",142,0)
 S ORDIALOG(136,1)="",INST=2,ORSD="NOW",PROMPT=6
"RTN","ORCDPS3",143,0)
 S:$L($G(START)) ORDIALOG(6,1)=START S:$G(DURTN) ORDIALOG(153,1)=DURTN
"RTN","ORCDPS3",144,0)
 D DEFSTRT W !,Y
"RTN","ORCDPS3",145,0)
 Q
"RTN","ORCDPS3",146,0)
 ;
"RTN","ORCDPS3",147,0)
SC ; -- Dialog validation, to ask SC questions
"RTN","ORCDPS3",148,0)
 ;    Expects ORIFN, ORDA, and ORDER
"RTN","ORCDPS3",149,0)
 ;
"RTN","ORCDPS3",150,0)
 Q:'$L($T(SCNEW^PSOCP))  Q:'$G(ORIFN)  Q:'$G(ORDA)
"RTN","ORCDPS3",151,0)
 Q:$P($G(^OR(100,ORIFN,0)),U,12)'="O"  Q:$P($G(^(8,ORDA,0)),U,2)'="NW"  Q:$P($G(^(0)),U,15)=""
"RTN","ORCDPS3",152,0)
 ;
"RTN","ORCDPS3",153,0)
 N OR3,ORDRUG,PSIFN,ORX,I,J,DIE,DR,DA,X,Y,DTOUT,ORIGVIEW,DFN
"RTN","ORCDPS3",154,0)
 S OR3=$G(^OR(100,ORIFN,3)),X=$P(OR3,U,11) I X>2 Q  ;new, edit, or renew
"RTN","ORCDPS3",155,0)
 I X S Y=$P(OR3,U,5),PSIFN=$G(^OR(100,Y,4)) ;get PS# if edit/renewal
"RTN","ORCDPS3",156,0)
 S ORDRUG=$$VALUE^ORCSAVE2(ORIFN,"DRUG")
"RTN","ORCDPS3",157,0)
 D SCNEW^PSOCP(.ORX,+ORVP,ORDRUG,$G(PSIFN)) Q:'$D(ORX)
"RTN","ORCDPS3",158,0)
 S DIE="^OR(100,",DA=ORIFN,DR="",J=0
"RTN","ORCDPS3",159,0)
 F I="SC","MST","AO","IR","EC","HNC","CV" S J=J+1 I $D(ORX(I)) S X=ORX(I) S:I="CV"&(X="") X=1 S DR=DR_";5"_J_"R"_$S($L(X):"//"_$S(X:"YES",1:"NO"),1:"")
"RTN","ORCDPS3",160,0)
 S:$E(DR)=";" DR=$E(DR,2,999) Q:'$L(DR)  S ORIGVIEW=1
"RTN","ORCDPS3",161,0)
 I $D(ORX("SC")) S DFN=+ORVP D DIS^DGRPDB ;show current SC data
"RTN","ORCDPS3",162,0)
 W !!,"Is "_$$ORDITEM^ORCACT(ORDER)_" for treatment related to:"
"RTN","ORCDPS3",163,0)
 D ^DIE S:$D(DTOUT)!$D(Y) ORQUIT=1
"RTN","ORCDPS3",164,0)
 Q
"RTN","ORCDPSH")
0^135^B17713696
"RTN","ORCDPSH",1,0)
ORCDPSH ;SLC/CLA-Pharmacy dialog utilities-Non-VA Meds ; 09 April 2003 11:00 AM
"RTN","ORCDPSH",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**190,215,243**;Dec 17, 1997;Build 242
"RTN","ORCDPSH",3,0)
 ;
"RTN","ORCDPSH",4,0)
 ; DBIA 2418   START^PSSJORDF   ^TMP("PSJMR",$J)
"RTN","ORCDPSH",5,0)
 ; DBIA 3166   EN^PSSDIN        ^TMP("PSSDIN",$J)
"RTN","ORCDPSH",6,0)
 ; 
"RTN","ORCDPSH",7,0)
EN(TYPE) ; -- entry action for Meds dialogs
"RTN","ORCDPSH",8,0)
 S ORDG=+$O(^ORD(100.98,"B","NV RX",0)),ORCAT="O"
"RTN","ORCDPSH",9,0)
 K ^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORCDPSH",10,0)
 I $G(ORENEW)!$G(OREWRITE)!$D(OREDIT)!$G(ORXFER) D
"RTN","ORCDPSH",11,0)
 . K ORDIALOG($$PTR("START DATE/TIME"),1)
"RTN","ORCDPSH",12,0)
 . K ORDIALOG($$PTR("NOW"),1)
"RTN","ORCDPSH",13,0)
 . I $D(OREDIT),'$O(ORDIALOG($$PTR^ORCD("OR GTX INSTRUCTIONS"),0)) K ^TMP("ORWORD",$J)
"RTN","ORCDPSH",14,0)
 Q
"RTN","ORCDPSH",15,0)
 ;
"RTN","ORCDPSH",16,0)
EN1 ; -- setup Non-VA Meds dialog for quick order editor using ORDG
"RTN","ORCDPSH",17,0)
 N DG S DG=$P($G(^ORD(100.98,+$G(ORDG),0)),U,3)
"RTN","ORCDPSH",18,0)
 S ORINPT=0,ORCAT="O"
"RTN","ORCDPSH",19,0)
 K ^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORCDPSH",20,0)
 Q
"RTN","ORCDPSH",21,0)
 ;
"RTN","ORCDPSH",22,0)
ENOI ; -- setup OI prompt
"RTN","ORCDPSH",23,0)
 S ORDIALOG(PROMPT,"D")="S.NV RX"
"RTN","ORCDPSH",24,0)
 Q
"RTN","ORCDPSH",25,0)
 ;
"RTN","ORCDPSH",26,0)
CHANGED(X) ; -- Kill dependent values when prompt X changes
"RTN","ORCDPSH",27,0)
 N PROMPTS,NAME,PTR,P,I
"RTN","ORCDPSH",28,0)
 S PROMPTS=X I X="OI" D
"RTN","ORCDPSH",29,0)
 . S PROMPTS="INSTRUCTIONS^ROUTE^SCHEDULE^START DATE/TIME^DOSE^DISPENSE DRUG^SIG^PATIENT INSTRUCTIONS"
"RTN","ORCDPSH",30,0)
 . K ORDRUG,ORDOSE,OROUTE,ORSCH,ORSD,ORDSUP,ORQTY,ORQTYUNT,OREFILLS,ORCOPAY
"RTN","ORCDPSH",31,0)
 . K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORCDPSH",32,0)
 F P=1:1:$L(PROMPTS,U) S NAME=$P(PROMPTS,U,P) D
"RTN","ORCDPSH",33,0)
 . S PTR=$$PTR(NAME) Q:'PTR
"RTN","ORCDPSH",34,0)
 . S I=0 F  S I=$O(ORDIALOG(PTR,I)) Q:I'>0  K ORDIALOG(PTR,I)
"RTN","ORCDPSH",35,0)
 . K ORDIALOG(PTR,"LIST"),^TMP("ORWORD",$J,PTR)
"RTN","ORCDPSH",36,0)
 Q
"RTN","ORCDPSH",37,0)
 ;
"RTN","ORCDPSH",38,0)
ORDITM(OI) ; -- Check OI inactive date & type, get dependent info
"RTN","ORCDPSH",39,0)
 Q:OI'>0  ;quit - no value
"RTN","ORCDPSH",40,0)
 N ORPS,PSOI S ORPS=$G(^ORD(101.43,+OI,"PS")),PSOI=+$P($G(^(0)),U,2)
"RTN","ORCDPSH",41,0)
 S ORIV=$S($P(ORPS,U)=2:1,1:0)
"RTN","ORCDPSH",42,0)
 I '$P(ORPS,U,7) W $C(7),!,"This drug may not be used in a non-VA med order." S ORQUIT=1 D WAIT Q
"RTN","ORCDPSH",43,0)
OI1 ; ck NF status (don't care if Non-VA Meds are formulary or not)
"RTN","ORCDPSH",44,0)
OI2 ; -get selectable routes, doses [also called from NF^ORCDPS]
"RTN","ORCDPSH",45,0)
 D:'$D(^TMP("PSJMR",$J)) START^PSSJORDF(PSOI,$G(ORCAT))  ;DBIA 2418
"RTN","ORCDPSH",46,0)
 I '$D(ORDOSE) D
"RTN","ORCDPSH",47,0)
 . D DOSE^PSSORUTL(.ORDOSE,PSOI,"X",+ORVP)
"RTN","ORCDPSH",48,0)
 . K:$G(ORDOSE(1))=-1 ORDOSE
"RTN","ORCDPSH",49,0)
 Q
"RTN","ORCDPSH",50,0)
 ;
"RTN","ORCDPSH",51,0)
NFI(OI) ; -- Show NFI restrictions, if exist
"RTN","ORCDPSH",52,0)
 N PSOI,I,J,LCNT,MAX,X,STOP
"RTN","ORCDPSH",53,0)
 S PSOI=+$P($G(^ORD(101.43,+$G(OI),0)),U,2)
"RTN","ORCDPSH",54,0)
 D EN^PSSDIN(PSOI,"") Q:'$D(^TMP("PSSDIN",$J,"OI",PSOI))  ;DBIA 3166
"RTN","ORCDPSH",55,0)
 S I=0,LCNT=0,MAX=$S($G(IOBM)&$G(IOTM):IOBM-IOTM+1,1:24) W !
"RTN","ORCDPSH",56,0)
 F  S I=$O(^TMP("PSSDIN",$J,"OI",PSOI,I)) Q:I'>0  D
"RTN","ORCDPSH",57,0)
 . S J=0 F  S J=$O(^TMP("PSSDIN",$J,"OI",PSOI,I,J)) Q:J'>0  S X=$G(^(J)) D  Q:$G(STOP)
"RTN","ORCDPSH",58,0)
 .. S LCNT=LCNT+1 I LCNT'<MAX S:'$$CONT STOP=1 Q:$G(STOP)  S LCNT=1
"RTN","ORCDPSH",59,0)
 .. W !,X
"RTN","ORCDPSH",60,0)
 W ! K ^TMP("PSSDIN",$J,"OI",PSOI)
"RTN","ORCDPSH",61,0)
 Q
"RTN","ORCDPSH",62,0)
 ;
"RTN","ORCDPSH",63,0)
CONT() ; -- Press return to cont or ^ to stop
"RTN","ORCDPSH",64,0)
 N X,Y,DIR,DUOUT,DTOUT,DIRUT,DIROUT S DIR(0)="EA"
"RTN","ORCDPSH",65,0)
 S DIR("A")="Press <return> to continue or ^ to stop ..."
"RTN","ORCDPSH",66,0)
 D ^DIR S:$D(DUOUT)!$D(DTOUT) Y=""
"RTN","ORCDPSH",67,0)
 Q +Y
"RTN","ORCDPSH",68,0)
 ;
"RTN","ORCDPSH",69,0)
WAIT ; -- Wait for user
"RTN","ORCDPSH",70,0)
 N X W !,"Press <return> to continue ..." R X:DTIME
"RTN","ORCDPSH",71,0)
 Q
"RTN","ORCDPSH",72,0)
 ;
"RTN","ORCDPSH",73,0)
ROUTES ; -- Get allowable med routes
"RTN","ORCDPSH",74,0)
 Q:$G(ORDIALOG(PROMPT,"LIST"))  N I,X,CNT S (I,CNT)=0
"RTN","ORCDPSH",75,0)
 F  S I=$O(^TMP("PSJMR",$J,I)) Q:I'>0  S X=^(I),CNT=CNT+1,ORDIALOG(PROMPT,"LIST",CNT)=$P(X,U,3)_U_$P(X,U,1,2),ORDIALOG(PROMPT,"LIST","B",$P(X,U))=$P(X,U,3)
"RTN","ORCDPSH",76,0)
 S:$G(CNT) ORDIALOG(PROMPT,"LIST")=CNT
"RTN","ORCDPSH",77,0)
 S REQD=0
"RTN","ORCDPSH",78,0)
 Q
"RTN","ORCDPSH",79,0)
 ;
"RTN","ORCDPSH",80,0)
DEFRTE ; -- Get default route
"RTN","ORCDPSH",81,0)
 N INST1 S INST1=$O(ORDIALOG(PROMPT,0)) S:INST1'>0 INST1=INST ;1st inst
"RTN","ORCDPSH",82,0)
 I INST1=INST S Y=+$P($G(^TMP("PSJMR",$J,1)),U,3) K:Y'>0 Y Q
"RTN","ORCDPSH",83,0)
 S Y=+$G(ORDIALOG(PROMPT,INST1)) K:Y'>0 Y S:$G(Y) EDITONLY=1
"RTN","ORCDPSH",84,0)
 Q
"RTN","ORCDPSH",85,0)
 ;
"RTN","ORCDPSH",86,0)
CKSCH ; -- validate schedule [Called from P-S Action]
"RTN","ORCDPSH",87,0)
 N ORX S ORX=ORDIALOG(PROMPT,ORI) Q:ORX=$G(ORESET)  K ORSD ;reset
"RTN","ORCDPSH",88,0)
 D EN^PSSGS0(.ORX,"X")
"RTN","ORCDPSH",89,0)
 I $D(ORX) S ORDIALOG(PROMPT,ORI)=ORX D CHANGED("QUANTITY") Q  ;ok
"RTN","ORCDPSH",90,0)
 W $C(7),!,"Enter a standard schedule for administering this medication or one of your own,",!,"up to 20 characters.",!
"RTN","ORCDPSH",91,0)
 K DONE
"RTN","ORCDPSH",92,0)
 Q
"RTN","ORCDPSH",93,0)
 ;
"RTN","ORCDPSH",94,0)
PTR(X) ; -- Return ptr to prompt OR GTX X
"RTN","ORCDPSH",95,0)
 Q +$O(^ORD(101.41,"AB","OR GTX "_X,0))
"RTN","ORCDPSH",96,0)
 ;
"RTN","ORCDPSH",97,0)
EXIT ; -- exit action for Meds dialogs
"RTN","ORCDPSH",98,0)
 S:$G(ORXNP) ORNP=ORXNP
"RTN","ORCDPSH",99,0)
 K ORXNP,ORINPT,ORCAT,ORPKG,OROI,ORIV,ORDRUG,ORDOSE,OROUTE,ORSCH,ORSD,ORDSUP,OREFILLS,ORQTY,ORQTYUNT,ORCOPAY,PSJNOPC,ORCOMPLX
"RTN","ORCDPSH",100,0)
 K ^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORCDPSH",101,0)
 Q
"RTN","ORCDPSIV")
0^36^B96443893
"RTN","ORCDPSIV",1,0)
ORCDPSIV ;SLC/MKB-Pharmacy IV dialog utilities ;5/07/08
"RTN","ORCDPSIV",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,38,48,158,195,243**;Dec 17, 1997;Build 242
"RTN","ORCDPSIV",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ORCDPSIV",4,0)
CKSCH ; -- validate schedule [Called from P-S Action]
"RTN","ORCDPSIV",5,0)
 N ORX S ORX=ORDIALOG(PROMPT,ORI) Q:ORX=$G(ORESET)  K ORSD
"RTN","ORCDPSIV",6,0)
 D EN^PSSGS0(.ORX,"I")
"RTN","ORCDPSIV",7,0)
 I $D(ORX) S ORDIALOG(PROMPT,ORI)=ORX Q
"RTN","ORCDPSIV",8,0)
 W $C(7),!,"Enter a standard schedule for administering this medication."
"RTN","ORCDPSIV",9,0)
 Q
"RTN","ORCDPSIV",10,0)
ISONETIM(SCH) ;
"RTN","ORCDPSIV",11,0)
 N DUR
"RTN","ORCDPSIV",12,0)
 I SCH="" Q 0
"RTN","ORCDPSIV",13,0)
 K ^TMP($J,"ORCDPSIV GETSCHTYP")
"RTN","ORCDPSIV",14,0)
 D ZERO^PSS51P1(,SCH,"PSJ","O","ORCDPSIV GETSCHTYP")
"RTN","ORCDPSIV",15,0)
 I +^TMP($J,"ORCDPSIV GETSCHTYP",0)>0 D  Q 1
"RTN","ORCDPSIV",16,0)
 .S DUR=$$PTR^ORCD("OR GTX DURATION")
"RTN","ORCDPSIV",17,0)
 .I $G(ORDIALOG(DUR,1))="" Q
"RTN","ORCDPSIV",18,0)
 .S ORDIALOG(DUR,1)=""
"RTN","ORCDPSIV",19,0)
 .W !,"IV Orders with a schedule type of one-time cannot have a duration."
"RTN","ORCDPSIV",20,0)
 .W !,"The duration has been deleted from this quick order." H 1
"RTN","ORCDPSIV",21,0)
 K ^TMP($J,"ORCDPSIV GETSCHTYP")
"RTN","ORCDPSIV",22,0)
 Q 0
"RTN","ORCDPSIV",23,0)
 ;
"RTN","ORCDPSIV",24,0)
PROVIDER ; -- Check provider, if authorized to write med orders
"RTN","ORCDPSIV",25,0)
 I $D(^XUSEC("OREMAS",DUZ)),'$$GET^XPAR("ALL","OR OREMAS MED ORDERS") W $C(7),!!,"OREMAS key holders may not enter medication orders." S ORQUIT=1 Q
"RTN","ORCDPSIV",26,0)
 N PS,NAME S PS=$G(^VA(200,+$G(ORNP),"PS")),NAME=$P($G(^(20)),U,2)
"RTN","ORCDPSIV",27,0)
 I '$L(NAME) S NAME=$P(^VA(200,+$G(ORNP),0),U)
"RTN","ORCDPSIV",28,0)
 I '$P(PS,U) W $C(7),!!,NAME_" is not authorized to write medication orders!" S ORQUIT=1
"RTN","ORCDPSIV",29,0)
 I $P(PS,U,4),$$NOW^XLFDT>$P(PS,U,4) W $C(7),!!,NAME_" is no longer authorized to write medication orders!" S ORQUIT=1
"RTN","ORCDPSIV",30,0)
 I $G(ORQUIT) W !,"You must select another provider to continue.",! S PS=$$MEDPROV I PS S ORXNP=ORNP,ORNP=PS K ORQUIT
"RTN","ORCDPSIV",31,0)
 Q
"RTN","ORCDPSIV",32,0)
 ;
"RTN","ORCDPSIV",33,0)
MEDPROV() ; -- Return ordering med provider
"RTN","ORCDPSIV",34,0)
 N X,Y,D,DIC
"RTN","ORCDPSIV",35,0)
 S DIC=200,DIC(0)="AEQ",DIC("A")="Select PROVIDER: ",D="AK.PROVIDER"
"RTN","ORCDPSIV",36,0)
 S DIC("S")="I $P($G(^(""PS"")),U),'$P(^(""PS""),U,4)!($P(^(""PS""),U,4)>$$NOW^XLFDT)"
"RTN","ORCDPSIV",37,0)
 D IX^DIC S:Y>0 Y=+Y I Y'>0 S Y="^"
"RTN","ORCDPSIV",38,0)
 Q Y
"RTN","ORCDPSIV",39,0)
 ;
"RTN","ORCDPSIV",40,0)
CHANGED(TYPE) ; -- Kill dependent values when OI changes
"RTN","ORCDPSIV",41,0)
 N PROMPTS,NAME,PTR,P,I
"RTN","ORCDPSIV",42,0)
 Q:'$L($G(TYPE))  S PROMPTS=""
"RTN","ORCDPSIV",43,0)
 S:TYPE="B" PROMPTS="VOLUME"
"RTN","ORCDPSIV",44,0)
 S:TYPE="A" PROMPTS="STRENGTH PSIV^UNITS"
"RTN","ORCDPSIV",45,0)
 S:TYPE="T" PROMPTS="INFUSION RATE^SCHEDULE"
"RTN","ORCDPSIV",46,0)
 F P=1:1:$L(PROMPTS,U) S NAME=$P(PROMPTS,U,P) D
"RTN","ORCDPSIV",47,0)
 . S PTR=$O(^ORD(101.41,"AB","OR GTX "_NAME,0)) Q:'PTR
"RTN","ORCDPSIV",48,0)
 . S I=0 F  S I=$O(ORDIALOG(PTR,I)) Q:I'>0  K ORDIALOG(PTR,I)
"RTN","ORCDPSIV",49,0)
 . K ORDIALOG(PTR,"LIST")
"RTN","ORCDPSIV",50,0)
 Q
"RTN","ORCDPSIV",51,0)
 ;
"RTN","ORCDPSIV",52,0)
INACTIVE(TYPE) ; -- Check OI inactive date
"RTN","ORCDPSIV",53,0)
 N OI,X,I,PSOI,DEA,EXIT S:$G(TYPE)'="A" TYPE="S"
"RTN","ORCDPSIV",54,0)
 S OI=+$G(ORDIALOG(PROMPT,INST)) Q:OI'>0
"RTN","ORCDPSIV",55,0)
 I $G(^ORD(101.43,OI,.1)),^(.1)'>$$NOW^XLFDT D  Q  ;inactive
"RTN","ORCDPSIV",56,0)
 . S X=$S(TYPE="A":"additive",1:"solution"),ORQUIT=1
"RTN","ORCDPSIV",57,0)
 . W $C(7),!,"This "_X_" may not be ordered anymore.  Please select another."
"RTN","ORCDPSIV",58,0)
 S I=$S(TYPE="A":4,1:3) I '$P($G(^ORD(101.43,OI,"PS")),U,I) D  Q
"RTN","ORCDPSIV",59,0)
 . S X=$S(TYPE="A":"an additive",1:"a solution"),ORQUIT=1
"RTN","ORCDPSIV",60,0)
 . W $C(7),!,"This item may not be ordered as "_X_"."
"RTN","ORCDPSIV",61,0)
 S EXIT=$$INPT^ORCD I EXIT=0 D ROUTECHK Q
"RTN","ORCDPSIV",62,0)
 Q:'$L($T(IVDEA^PSSUTIL1))  ;DBIA #3784
"RTN","ORCDPSIV",63,0)
 S PSOI=+$P($G(^ORD(101.43,OI,0)),U,2)
"RTN","ORCDPSIV",64,0)
 S DEA=$$IVDEA^PSSUTIL1(PSOI,TYPE) I DEA>0 D  Q:$G(ORQUIT)
"RTN","ORCDPSIV",65,0)
 . I $G(ORNP),'$L($P($G(^VA(200,+ORNP,"PS")),U,2)),'$L($P($G(^("PS")),U,3)) W $C(7),!,$P($G(^(0)),U)_" must have a DEA# or VA# to order this drug!" S ORQUIT=1 Q
"RTN","ORCDPSIV",66,0)
 . I DEA=1 W $C(7),!,"This order will require a wet signature!"
"RTN","ORCDPSIV",67,0)
 D ROUTECHK
"RTN","ORCDPSIV",68,0)
 Q
"RTN","ORCDPSIV",69,0)
 ;
"RTN","ORCDPSIV",70,0)
VOLUME ; -- get allowable volumes for solution
"RTN","ORCDPSIV",71,0)
 N PSOI,ORY,CNT,I,XORY K ORDIALOG(PROMPT,"LIST")
"RTN","ORCDPSIV",72,0)
 S PSOI=+$P($G(^ORD(101.43,+$$VAL^ORCD("SOLUTION",INST),0)),U,2)_"B"
"RTN","ORCDPSIV",73,0)
 D ENVOL^PSJORUT2(PSOI,.ORY) Q:'ORY
"RTN","ORCDPSIV",74,0)
 ;S (I,CNT)=0 F  S I=$O(ORY(I)) Q:I'>0  S CNT=CNT+1,ORDIALOG(PROMPT,"LIST",+ORY(I))=+ORY(I)
"RTN","ORCDPSIV",75,0)
 S (I,CNT)=0 F  S I=$O(ORY(I)) Q:I'>0  D
"RTN","ORCDPSIV",76,0)
 . S CNT=CNT+1
"RTN","ORCDPSIV",77,0)
 . S XORY(I)=+ORY(I) I XORY(I)<1,$E(XORY(I),1,2)'="0." S XORY(I)=0_XORY(I)
"RTN","ORCDPSIV",78,0)
 . S ORDIALOG(PROMPT,"LIST",XORY(I))=XORY(I)
"RTN","ORCDPSIV",79,0)
 S ORDIALOG(PROMPT,"LIST")=CNT_"^1"
"RTN","ORCDPSIV",80,0)
 Q
"RTN","ORCDPSIV",81,0)
 ;
"RTN","ORCDPSIV",82,0)
UNITS ; -- get allowable units for current additive
"RTN","ORCDPSIV",83,0)
 N PSOI,ORY,I,UNITS
"RTN","ORCDPSIV",84,0)
 S PSOI=+$P(^ORD(101.43,+ORDIALOG($$PTR^ORCD("OR GTX ADDITIVE"),INST),0),U,2)_"A"
"RTN","ORCDPSIV",85,0)
 D ENVOL^PSJORUT2(PSOI,.ORY)
"RTN","ORCDPSIV",86,0)
 S I=$O(ORY(0)) Q:'I  S UNITS=$P($G(ORY(I)),U,2)
"RTN","ORCDPSIV",87,0)
 S ORDIALOG($$PTR^ORCD("OR GTX UNITS"),INST)=UNITS
"RTN","ORCDPSIV",88,0)
 W !," (Units for this additive are "_UNITS_")"
"RTN","ORCDPSIV",89,0)
 Q
"RTN","ORCDPSIV",90,0)
 ;
"RTN","ORCDPSIV",91,0)
PREMIX() ; -- Returns 1 or 0, if IV base is a premix solution
"RTN","ORCDPSIV",92,0)
 N BASE,PS,I,Y
"RTN","ORCDPSIV",93,0)
 S BASE=$$PTR^ORCD("OR GTX ORDERABLE ITEM"),Y=0
"RTN","ORCDPSIV",94,0)
 S I=0 F  S I=$O(ORDIALOG(BASE,I)) Q:I'>0  D  Q:Y
"RTN","ORCDPSIV",95,0)
 . S PS=$G(^ORD(101.43,+$G(ORDIALOG(BASE,I)),"PS"))
"RTN","ORCDPSIV",96,0)
 . I $P(PS,U,3)&($P(PS,U,4)) S Y=1
"RTN","ORCDPSIV",97,0)
 Q Y
"RTN","ORCDPSIV",98,0)
 ;
"RTN","ORCDPSIV",99,0)
IVRTEENT ;
"RTN","ORCDPSIV",100,0)
 N ARRAY,DIR,RIEN,TROUTE
"RTN","ORCDPSIV",101,0)
 I ORTYPE'="Z" Q
"RTN","ORCDPSIV",102,0)
 S RIEN=$P($G(ORDIALOG("B","ROUTE")),U,2) Q:RIEN'>0
"RTN","ORCDPSIV",103,0)
 S EXIT=0,TROUTE=$G(ORDIALOG(RIEN,1)) Q:TROUTE'>0
"RTN","ORCDPSIV",104,0)
 I $$IVRTESCR(TROUTE)=1 Q
"RTN","ORCDPSIV",105,0)
 S ORDIALOG(RIEN,1)=""
"RTN","ORCDPSIV",106,0)
 W !!,"The selected route is not a valid route for this order."
"RTN","ORCDPSIV",107,0)
 W !,"Select a new route for this order from the list of routes below."
"RTN","ORCDPSIV",108,0)
 D RTEDISP(.ARRAY)
"RTN","ORCDPSIV",109,0)
 Q
"RTN","ORCDPSIV",110,0)
 ;
"RTN","ORCDPSIV",111,0)
BIVOI(ARRAY) ;
"RTN","ORCDPSIV",112,0)
 N CNT,NUM,OIIEN,OTYPE
"RTN","ORCDPSIV",113,0)
 S CNT=0
"RTN","ORCDPSIV",114,0)
 F OTYPE="SOLUTION","ADDITIVE" D
"RTN","ORCDPSIV",115,0)
 .S OIIEN=+$P($G(ORDIALOG("B",OTYPE)),U,2) I OIIEN>0 D
"RTN","ORCDPSIV",116,0)
 ..S NUM=0 F  S NUM=$O(ORDIALOG(OIIEN,NUM)) Q:NUM'>0  I +$G(ORDIALOG(OIIEN,NUM))>0 D
"RTN","ORCDPSIV",117,0)
 ...S CNT=CNT+1,ARRAY(CNT)=ORDIALOG(OIIEN,NUM)
"RTN","ORCDPSIV",118,0)
 Q
"RTN","ORCDPSIV",119,0)
 ;
"RTN","ORCDPSIV",120,0)
LVROUTES ;
"RTN","ORCDPSIV",121,0)
 N ARRAY,ROUTES
"RTN","ORCDPSIV",122,0)
 D BIVOI(.ARRAY)
"RTN","ORCDPSIV",123,0)
 D IVDOSFRM^ORWDPS33(.ROUTES,.ARRAY,0,1)
"RTN","ORCDPSIV",124,0)
 D RTEDISP(.ROUTES)
"RTN","ORCDPSIV",125,0)
 Q
"RTN","ORCDPSIV",126,0)
 ;
"RTN","ORCDPSIV",127,0)
RTEDISP(ROUTES) ;
"RTN","ORCDPSIV",128,0)
 N CNT
"RTN","ORCDPSIV",129,0)
 S CNT="" F  S CNT=$O(ROUTES(CNT)) Q:CNT'>0  D
"RTN","ORCDPSIV",130,0)
 .W !,$P($G(ROUTES(CNT)),U,2)
"RTN","ORCDPSIV",131,0)
 Q
"RTN","ORCDPSIV",132,0)
 ;
"RTN","ORCDPSIV",133,0)
IVRTESCR(Y) ;
"RTN","ORCDPSIV",134,0)
 N ARRAY,ROUTES,VALUE
"RTN","ORCDPSIV",135,0)
 D BIVOI(.ARRAY)
"RTN","ORCDPSIV",136,0)
 S VALUE=$$IVQOVAL^ORWDPS33(.ARRAY,Y) I VALUE'="" Q 1
"RTN","ORCDPSIV",137,0)
 Q 0
"RTN","ORCDPSIV",138,0)
 ;
"RTN","ORCDPSIV",139,0)
ROUTECHK ;
"RTN","ORCDPSIV",140,0)
 N CNT,IEN,ROUTE,VALUE
"RTN","ORCDPSIV",141,0)
 S RIEN=$P($G(ORDIALOG("B","ROUTE")),U,2) Q:RIEN'>0
"RTN","ORCDPSIV",142,0)
 S TROUTE=$G(ORDIALOG(RIEN,1)) Q:TROUTE'>0
"RTN","ORCDPSIV",143,0)
 I $$IVRTESCR(TROUTE)=1 Q
"RTN","ORCDPSIV",144,0)
 S ORDIALOG(RIEN,1)=""
"RTN","ORCDPSIV",145,0)
 W !!,"The route defined for this order is an invalid route."
"RTN","ORCDPSIV",146,0)
 W !,"You will need to define a new route for this order."
"RTN","ORCDPSIV",147,0)
 Q
"RTN","ORCDPSIV",148,0)
 ;
"RTN","ORCDPSIV",149,0)
ENRATE ; -- set display text, help based on IV TYPE
"RTN","ORCDPSIV",150,0)
 N X,MSG S X=$G(ORIVTYPE),MSG=""
"RTN","ORCDPSIV",151,0)
 S ORDIALOG(PROMPT,"A")=$S(X="I":"Infuse over time (min): ",1:"Infusion Rate (ml/hr): ")
"RTN","ORCDPSIV",152,0)
 S MSG="Enter the "_$S(X="I":"number of minutes over which to infuse this medication.",1:"infusion rate, as the number of ml/hr or Text@Number of Labels per day. ")
"RTN","ORCDPSIV",153,0)
 S ORDIALOG(PROMPT,"?")=MSG
"RTN","ORCDPSIV",154,0)
 I X="I" D
"RTN","ORCDPSIV",155,0)
 .N RATEI,RATEV,TIME,UNIT
"RTN","ORCDPSIV",156,0)
 .S RATEI=$P($G(ORDIALOG("B","INFUSION RATE")),U,2) Q:RATEI'>0
"RTN","ORCDPSIV",157,0)
 .S RATEV=$G(ORDIALOG(RATEI,1)) Q:'$L(RATEV)
"RTN","ORCDPSIV",158,0)
 .I RATEV'["INFUSE OVER" Q
"RTN","ORCDPSIV",159,0)
 .S TIME=$P(RATEV," ",3)
"RTN","ORCDPSIV",160,0)
 .S UNIT=$P(RATEV," ",4)
"RTN","ORCDPSIV",161,0)
 .I TIME["." Q
"RTN","ORCDPSIV",162,0)
 .I UNIT="Hours" S TIME=TIME*60
"RTN","ORCDPSIV",163,0)
 .S ORDIALOG(RATEI,1)=TIME
"RTN","ORCDPSIV",164,0)
 Q
"RTN","ORCDPSIV",165,0)
 ;
"RTN","ORCDPSIV",166,0)
INF ; -- input transform for INFUSION RATE
"RTN","ORCDPSIV",167,0)
 N ALPHA,CNT,EXIT,FAIL,LDEC,RDEC,TEMP
"RTN","ORCDPSIV",168,0)
 I $G(ORIVTYPE)="I" D  Q
"RTN","ORCDPSIV",169,0)
 .I X["." W !,"Infuse Over Time must be a whole number." K X Q
"RTN","ORCDPSIV",170,0)
 .I $L(X)>4 W !,"Infuse Over Time cannot exceed 4 spaces for minutes." K X
"RTN","ORCDPSIV",171,0)
 .S FAIL=0
"RTN","ORCDPSIV",172,0)
 .F CNT=1:1:$L(X) D  I FAIL=1 Q
"RTN","ORCDPSIV",173,0)
 ..I ($A($E(X,CNT))<48)!($A($E(X,CNT))>58) S FAIL=1
"RTN","ORCDPSIV",174,0)
 .I FAIL=1 W !,"Infuse Over Time must be a whole number." K X Q
"RTN","ORCDPSIV",175,0)
 K:$L(X)<1!($L(X)>30)!(X["""")!($A(X)=45) X I '$D(X) Q
"RTN","ORCDPSIV",176,0)
 I $G(ORIVTYPE)="C" D  Q
"RTN","ORCDPSIV",177,0)
 .S TEMP=$E(X,($L(X)-5),$L(X))
"RTN","ORCDPSIV",178,0)
 .I X["@",$$UP^XLFSTR(TEMP)=" ML/HR" Q
"RTN","ORCDPSIV",179,0)
 .S ALPHA=0
"RTN","ORCDPSIV",180,0)
 .I X'["@" D  I ALPHA=1 K X Q
"RTN","ORCDPSIV",181,0)
 ..F CNT=1:1:$L(X) D  I ALPHA=1 Q
"RTN","ORCDPSIV",182,0)
 ...I ($A($E(X,CNT))<48)!($A($E(X,CNT))>58) S ALPHA=1
"RTN","ORCDPSIV",183,0)
 .S EXIT=0
"RTN","ORCDPSIV",184,0)
 .I X[".",X'["@" D  I EXIT=1 K X Q
"RTN","ORCDPSIV",185,0)
 ..S LDEC=$P(X,"."),RDEC=$P(X,".",2)
"RTN","ORCDPSIV",186,0)
 ..I LDEC="" W !,"Infusion Rate required a leading numeric value." S EXIT=1
"RTN","ORCDPSIV",187,0)
 ..I $L(RDEC)>1 W !,"Infusion Rate cannot exceed one decimal place." S EXIT=1
"RTN","ORCDPSIV",188,0)
 ..S ALPHA=0
"RTN","ORCDPSIV",189,0)
 ..F CNT=1:1:$L(LDEC) D  I ALPHA=1 S EXIT=1 Q
"RTN","ORCDPSIV",190,0)
 ...I ($A($E(LDEC,CNT))<48)!($A($E(LDEC,CNT))>58) S ALPHA=1
"RTN","ORCDPSIV",191,0)
 ..I $L(RDEC)=0 Q
"RTN","ORCDPSIV",192,0)
 ..F CNT=1:1:$L(RDEC) D  I ALPHA=1 S EXIT=1 Q
"RTN","ORCDPSIV",193,0)
 ...I ($A($E(RDEC,CNT))<48)!($A($E(RDEC,CNT))>58) S ALPHA=1
"RTN","ORCDPSIV",194,0)
 .D ORINF^PSIVSP Q
"RTN","ORCDPSIV",195,0)
 ; -- assume #minutes for now
"RTN","ORCDPSIV",196,0)
 K:(X'=+X)!(X<1)!(X>999) X ;range?
"RTN","ORCDPSIV",197,0)
 Q
"RTN","ORCDPSIV",198,0)
 ;
"RTN","ORCDPSIV",199,0)
VALIDAYS(X) ; -- Validate IV duration
"RTN","ORCDPSIV",200,0)
 N UNITS,X1,X2,Y,I
"RTN","ORCDPSIV",201,0)
 I X'?1.N." "1.A Q 0
"RTN","ORCDPSIV",202,0)
 S UNITS="^MIN^HOURS^DAYS^M^H^D^",(X1,X2)=""
"RTN","ORCDPSIV",203,0)
 F I=1:1:$L(X) S Y=$E(X,I) S:Y?1N X1=X1_Y S:Y?1A X2=X2_$$UP^XLFSTR(Y)
"RTN","ORCDPSIV",204,0)
 I 'X1 Q 0
"RTN","ORCDPSIV",205,0)
 I UNITS'[(U_X2_U) Q 0
"RTN","ORCDPSIV",206,0)
 Q 1
"RTN","ORCDPSIV",207,0)
 ;
"RTN","ORCDPSIV",208,0)
VALDURA(X) ;-- Validate IV duration/limitation
"RTN","ORCDPSIV",209,0)
 K:$L(X)<1!($L(X)>30)!(X["""")!($A(X)=45) X I '$D(X) Q
"RTN","ORCDPSIV",210,0)
 ;
"RTN","ORCDPSIV",211,0)
IVPSI ;INPUT-TRANSFORM
"RTN","ORCDPSIV",212,0)
 I $L(X)<1!($L(X)>30)!(X["""")!($A(X)=45) S X="" Q
"RTN","ORCDPSIV",213,0)
 I $L(X)>1,X[" " W !,"Spaces are not allow in the duration." K X Q
"RTN","ORCDPSIV",214,0)
 I $E(X)=0 W !,!,"Duration cannot start with a zero." K X Q
"RTN","ORCDPSIV",215,0)
 I X["." W !,!,"Invalid duration or total volume.",!,"Duration has to be integer value!" S X="" Q
"RTN","ORCDPSIV",216,0)
 S X=$$UP^XLFSTR(X)
"RTN","ORCDPSIV",217,0)
 I X["DOSES" D  Q
"RTN","ORCDPSIV",218,0)
 .I $G(ORIVTYPE)'="I" K X W !,"Continuous IV Orders cannot have DOSES as a duration." Q
"RTN","ORCDPSIV",219,0)
 .I +$P(X,"DOSES")<1,+$P(X,"DOSES")>200000 W !,"Invalid number of Doses.",! K X Q
"RTN","ORCDPSIV",220,0)
 I (X'?.N1.2A),(X'?.N1".".N1.2A) W !,!,"Invalid duration or total volume.",! S X="" Q
"RTN","ORCDPSIV",221,0)
 I (X?.N1A) D
"RTN","ORCDPSIV",222,0)
 . I (X["L")!(X["H")!(X["D") Q
"RTN","ORCDPSIV",223,0)
 . E  W !,!,"Invalid duration or total volume.",! S X="" Q
"RTN","ORCDPSIV",224,0)
 I (X?.N1".".N1A) D
"RTN","ORCDPSIV",225,0)
 . I X["L" Q
"RTN","ORCDPSIV",226,0)
 . E  W !,!,"Invalid duration or total volume.",!,"Duration has to be integer value!",! S X="" Q
"RTN","ORCDPSIV",227,0)
 I (X?.N2A)!(X?.N1".".N2A) D
"RTN","ORCDPSIV",228,0)
 . I (X["ML")!(X["CC") Q
"RTN","ORCDPSIV",229,0)
 . E  W !,!,"Invalid duration or total volume",! S X="" Q
"RTN","ORCDPSIV",230,0)
 I X="" K X
"RTN","ORCDPSIV",231,0)
 Q
"RTN","ORCDPSIV",232,0)
 ;
"RTN","ORCDPSIV",233,0)
IVPSI1 ; ASK ON CONDITION
"RTN","ORCDPSIV",234,0)
 N DURI,DURV
"RTN","ORCDPSIV",235,0)
 I $G(OROTSCH)=1 Q
"RTN","ORCDPSIV",236,0)
 S DURI=$P($G(ORDIALOG("B","LIMITATION")),U,2)
"RTN","ORCDPSIV",237,0)
 I DURI>0 S DURV=$G(ORDIALOG(DURI,1))
"RTN","ORCDPSIV",238,0)
 I $L(DURV)>1,$E(DURV)="f",DURV["doses" D
"RTN","ORCDPSIV",239,0)
 .S TEMPX=$P(DURV," ",5)_"DOSES"
"RTN","ORCDPSIV",240,0)
 .I TEMPX'="",TEMPX'=DURV S ORDIALOG(DURI,1)=TEMPX
"RTN","ORCDPSIV",241,0)
 N INT,IVTYPE,ONETIME,TYPE,SCH,SCHNAME
"RTN","ORCDPSIV",242,0)
 I $G(ORIVTYPE)'="I" D  G IVPS1X
"RTN","ORCDPSIV",243,0)
 .W !,!,"Enter the length of administrative time or total volume for IV fluid order followed by ML or CC for milliliters, L for liters, D for days, H for hours to set limitation."
"RTN","ORCDPSIV",244,0)
 .W !,"(Examples: 1500ML, 1000CC, 1L, 3D, or 72H)",!
"RTN","ORCDPSIV",245,0)
 W !,"This field is optional a value does not need to be entered."
"RTN","ORCDPSIV",246,0)
 W !,!,"Enter the length of administrative time or total volume for IV fluid order followed by ML or CC for milliliters, L for liters, D for days, H for hours or DOSES to set limitation."
"RTN","ORCDPSIV",247,0)
 W !,"(Examples: 1500ML, 1000CC, 1L, 3D, 72H, or 10DOSES)",!
"RTN","ORCDPSIV",248,0)
IVPS1X ;
"RTN","ORCDPSIV",249,0)
 W !,"This field is optional a value does not need to be entered."
"RTN","ORCDPSIV",250,0)
 I 1
"RTN","ORCDPSIV",251,0)
 Q
"RTN","ORCFLAG")
0^109^B21880963
"RTN","ORCFLAG",1,0)
ORCFLAG ; SLC/MKB - Flag orders ;12/26/2006
"RTN","ORCFLAG",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141,243**;Dec 17, 1997;Build 242
"RTN","ORCFLAG",3,0)
 ;
"RTN","ORCFLAG",4,0)
EN1(ORIFN) ; -- standalone entry point to un/flag order ORIFN
"RTN","ORCFLAG",5,0)
 N ORLK,ORERR,VA,VADM,VAERR,DFN,ORVP,ORPNM,ORSSN,ORAGE,ORACTN,ORPS
"RTN","ORCFLAG",6,0)
 Q:'$G(ORIFN)  S:'$P(ORIFN,";",2) ORIFN=+ORIFN_";1"
"RTN","ORCFLAG",7,0)
 S ORVP=$P($G(^OR(100,+ORIFN,0)),U,2),DFN=+ORVP I 'ORVP!'$D(^(8,+$P(ORIFN,";",2),0)) W !,"Missing or invalid order!" H 1 Q
"RTN","ORCFLAG",8,0)
 D DEM^VADPT S ORPNM=VADM(1),ORSSN=$P(VADM(2),U,2),ORAGE=VADM(4)
"RTN","ORCFLAG",9,0)
 S ORACTN=$S($G(^OR(100,+ORIFN,8,+$P(ORIFN,";",2),3)):"UF",1:"FL")
"RTN","ORCFLAG",10,0)
 I '$$VALID^ORCACT0(ORIFN,ORACTN,.ORERR) W !,ORERR H 1 Q
"RTN","ORCFLAG",11,0)
 S ORLK=$$LOCK1^ORX2(+ORIFN) I 'ORLK W !,$P(ORLK,U,2) H 1 Q
"RTN","ORCFLAG",12,0)
 S ORACTN=$S(ORACTN="UF":"UN",1:"EN"),ORPS=1
"RTN","ORCFLAG",13,0)
 D @ORACTN,UNLK1^ORX2(+ORIFN)
"RTN","ORCFLAG",14,0)
 Q
"RTN","ORCFLAG",15,0)
 ;
"RTN","ORCFLAG",16,0)
EN ; -- Flag order ORIFN
"RTN","ORCFLAG",17,0)
 N OREASON,DA,ORB,ORNP,ORNOW S ORNOW=+$E($$NOW^XLFDT,1,12)
"RTN","ORCFLAG",18,0)
 S DA=$P(ORIFN,";",2) I 'DA W !,"Unable to flag!" H 1 Q
"RTN","ORCFLAG",19,0)
 S OREASON=$$REASON Q:OREASON="^"
"RTN","ORCFLAG",20,0)
 S ORNP=+$P($G(^OR(100,+ORIFN,8,DA,0)),U,3),ORNP=$$PROV(ORNP) Q:ORNP="^"
"RTN","ORCFLAG",21,0)
 D BULLETIN ;use ORNP?
"RTN","ORCFLAG",22,0)
 K ^OR(100,+ORIFN,8,DA,3) S ^(3)="1^"_$G(XMZ)_U_ORNOW_U_DUZ_U_OREASON_"^^^^"_ORNP
"RTN","ORCFLAG",23,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT,OREBUILD=1 ; Last Activity
"RTN","ORCFLAG",24,0)
 S ORB=+ORVP_U_+ORIFN_U_ORNP_"^1" D EN^OCXOERR(ORB) ; notification
"RTN","ORCFLAG",25,0)
 W !?10,"... order flagged." H 1 D KILL^XM,MSG(ORIFN)
"RTN","ORCFLAG",26,0)
 Q
"RTN","ORCFLAG",27,0)
 ;
"RTN","ORCFLAG",28,0)
UN ; -- Unflag order ORIFN
"RTN","ORCFLAG",29,0)
 N OREASON,DA,ORB,ORNP,ORNOW S ORNOW=+$E($$NOW^XLFDT,1,12)
"RTN","ORCFLAG",30,0)
 S DA=$P(ORIFN,";",2) I 'DA W !,"Unable to unflag order!" H 1 Q
"RTN","ORCFLAG",31,0)
 D SHOWFLAG S OREASON=$$COMMENT Q:OREASON="^"
"RTN","ORCFLAG",32,0)
 S $P(^OR(100,+ORIFN,8,DA,3),U)=0,$P(^(3),U,6,8)=ORNOW_U_DUZ_U_OREASON
"RTN","ORCFLAG",33,0)
 S ORNP=+$P(^OR(100,+ORIFN,8,DA,3),U,9) S:'ORNP ORNP=+$P($G(^(0)),U,3)
"RTN","ORCFLAG",34,0)
 S ORB=+ORVP_U_+ORIFN_U_ORNP_"^0" D EN^OCXOERR(ORB) ; notification
"RTN","ORCFLAG",35,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT,OREBUILD=1 ; Last Activity
"RTN","ORCFLAG",36,0)
 W !?10,"... order unflagged." H 1 D MSG(ORIFN)
"RTN","ORCFLAG",37,0)
 Q
"RTN","ORCFLAG",38,0)
 ;
"RTN","ORCFLAG",39,0)
SHOWFLAG ; -- Display [last] flag for order ORIFN
"RTN","ORCFLAG",40,0)
 N FLAG
"RTN","ORCFLAG",41,0)
 S FLAG=$G(^OR(100,+ORIFN,8,DA,3))
"RTN","ORCFLAG",42,0)
 W !," FLAGGED: "_$$LTIM($P(FLAG,U,3))_" by "_$P($G(^VA(200,+$P(FLAG,U,4),0)),U)
"RTN","ORCFLAG",43,0)
 W !?10,$P(FLAG,U,5) ; reason
"RTN","ORCFLAG",44,0)
 Q
"RTN","ORCFLAG",45,0)
 ;
"RTN","ORCFLAG",46,0)
REASON() ; -- Reason for flag
"RTN","ORCFLAG",47,0)
 N X,Y,DIR
"RTN","ORCFLAG",48,0)
 S DIR(0)="FA^1:80",DIR("A")="REASON FOR FLAG: " ; ck E3R
"RTN","ORCFLAG",49,0)
 S DIR("?")="A reason must be entered to flag this order."
"RTN","ORCFLAG",50,0)
 D ^DIR
"RTN","ORCFLAG",51,0)
 Q Y
"RTN","ORCFLAG",52,0)
 ;
"RTN","ORCFLAG",53,0)
COMMENT() ; -- Comments on unflag
"RTN","ORCFLAG",54,0)
 N X,Y,DIR
"RTN","ORCFLAG",55,0)
 S DIR(0)="FAO^1:80",DIR("A")="COMMENTS: "
"RTN","ORCFLAG",56,0)
 S DIR("?")="A comment may be entered to clarify this order."
"RTN","ORCFLAG",57,0)
 D ^DIR S:$D(DTOUT) Y="^"
"RTN","ORCFLAG",58,0)
 Q Y
"RTN","ORCFLAG",59,0)
 ;
"RTN","ORCFLAG",60,0)
PROV(ORDR) ; -- Get provider to alert
"RTN","ORCFLAG",61,0)
 N X,Y,DIC
"RTN","ORCFLAG",62,0)
 S DIC=200,DIC(0)="AEQM",DIC("A")="Send alert to: "
"RTN","ORCFLAG",63,0)
 I $G(ORDR) S ORDR=$P($G(^VA(200,+ORDR,0)),U) S:$L(ORDR) DIC("B")=ORDR
"RTN","ORCFLAG",64,0)
 S DIC("S")="N ORT S ORT=$P(^(0),U,11) I 'ORT!(ORT>DT)"
"RTN","ORCFLAG",65,0)
 D ^DIC S:Y>0 Y=+Y I Y'>0 S Y="^"
"RTN","ORCFLAG",66,0)
 Q Y
"RTN","ORCFLAG",67,0)
 ;
"RTN","ORCFLAG",68,0)
BULLETIN ; -- Send bulletin re: flag
"RTN","ORCFLAG",69,0)
 N OR0,OR3,ORDTXT,XMB,XMY,XMDUZ,ORENT,BULL,ORSRV,ORUSR
"RTN","ORCFLAG",70,0)
 S OR0=$G(^OR(100,+ORIFN,0)),OR3=$G(^(3)) ;ORUSR=+$P(OR0,U,4)
"RTN","ORCFLAG",71,0)
 S ORUSR=+$G(ORNP),ORSRV=+$P($G(^VA(200,ORUSR,5)),U)
"RTN","ORCFLAG",72,0)
 S ORENT="USR.`"_ORUSR_"^SRV.`"_ORSRV_"^DIV^SYS^PKG"
"RTN","ORCFLAG",73,0)
 S BULL=$$GET^XPAR(ORENT,"ORB FLAGGED ORDERS BULLETIN",1,"Q")
"RTN","ORCFLAG",74,0)
 Q:$G(BULL)'="Y"   ;quit if parameter value is not 'Y'es
"RTN","ORCFLAG",75,0)
 ;
"RTN","ORCFLAG",76,0)
 W !,"Sending bulletin to "_$P($G(^VA(200,ORUSR,0)),U)_"..."
"RTN","ORCFLAG",77,0)
 S XMB="OR FLAGGED ORDER",XMDUZ=DUZ,XMY(ORUSR)=""
"RTN","ORCFLAG",78,0)
 S XMB(1)=ORPNM,XMB(2)=ORSSN,XMB(3)=ORAGE,XMB(4)=$$LTIM($P(OR0,U,7))
"RTN","ORCFLAG",79,0)
 D TEXT^ORQ12(.ORDTXT,+ORIFN,80)
"RTN","ORCFLAG",80,0)
 S XMB(5)=$G(ORDTXT(1)),XMB(6)=$G(ORDTXT(2)),XMB(7)=$G(ORDTXT(3))
"RTN","ORCFLAG",81,0)
 S XMB(8)=$$LTIM($P(OR0,U,8)),XMB(9)=$$LTIM($P(OR0,U,9)),XMB(10)=OREASON
"RTN","ORCFLAG",82,0)
 S XMB(11)=$P($G(^ORD(100.01,+$P(OR3,U,3),0)),U)
"RTN","ORCFLAG",83,0)
 D EN^XMB
"RTN","ORCFLAG",84,0)
 Q
"RTN","ORCFLAG",85,0)
 ;
"RTN","ORCFLAG",86,0)
LTIM(X) ; -- format FM date/time into MM/DD HH:MM
"RTN","ORCFLAG",87,0)
 N Y S Y=""
"RTN","ORCFLAG",88,0)
 S:X Y=$E(X,4,5)_"/"_$E(X,6,7)
"RTN","ORCFLAG",89,0)
 S:X["." Y=Y_" "_$E(X_"0",9,10)_":"_$E(X_"000",11,12)
"RTN","ORCFLAG",90,0)
 Q Y
"RTN","ORCFLAG",91,0)
 ;
"RTN","ORCFLAG",92,0)
MSG(ORDER)      ; -- Sends HL7 message to Pharmacy when order is un/flagged
"RTN","ORCFLAG",93,0)
 Q:'$L($T(OBR^PSJHL4))  ;needs PSJ*5*85
"RTN","ORCFLAG",94,0)
 Q:'$G(ORDER)  Q:'$D(^OR(100,+ORDER,0))  Q:'$P(ORDER,";",2)
"RTN","ORCFLAG",95,0)
 N OR0,OR3,ORMSG,ORVP,ORX,ORFLAG
"RTN","ORCFLAG",96,0)
 S OR0=$G(^OR(100,+ORDER,0)),OR3=$G(^(8,+$P(ORDER,";",2),3))
"RTN","ORCFLAG",97,0)
 Q:"^PSJ^PSIV^PSO^"'[(U_$$GET1^DIQ(9.4,+$P(OR0,U,14)_",",1)_U)  ;Inpt or IV
"RTN","ORCFLAG",98,0)
 S ORMSG(1)=$$MSH^ORMBLD("ORU","PS")
"RTN","ORCFLAG",99,0)
 S ORVP=$P(OR0,U,2),ORMSG(2)=$$PID^ORMBLD(ORVP)
"RTN","ORCFLAG",100,0)
 S ORMSG(3)=$$PV1^ORMBLD(ORVP,$P(OR0,U,12),+$P(OR0,U,10))
"RTN","ORCFLAG",101,0)
 S ORX=$S(OR3:$P(OR3,U,3,5),1:$P(OR3,U,6,8))
"RTN","ORCFLAG",102,0)
 S ORFLAG=$S(OR3:"FL",1:"UF")_"|||"_$$HL7DATE^ORMBLD($P(ORX,U))_"||||||"_$P(ORX,U,3)_"|||"_+$P(ORX,U,2)
"RTN","ORCFLAG",103,0)
 S:$G(ORPS) ORFLAG=ORFLAG_"||||||||PHR" ;action taken by pharmacist
"RTN","ORCFLAG",104,0)
 S ORMSG(4)="OBR|1|"_ORDER_"^OR|"_$G(^OR(100,+ORDER,4))_"^PS|"_ORFLAG
"RTN","ORCFLAG",105,0)
 D MSG^XQOR("OR EVSEND PS",.ORMSG)
"RTN","ORCFLAG",106,0)
 Q
"RTN","ORCHANG2")
0^157^B30221469
"RTN","ORCHANG2",1,0)
ORCHANG2 ;SLC/MKB-Change View status ; 08 May 2002  2:12 PM
"RTN","ORCHANG2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**27,72,68,141,215,243**;Dec 17, 1997;Build 242
"RTN","ORCHANG2",3,0)
ORDERS ; -- Select new order status
"RTN","ORCHANG2",4,0)
 N X,Y,HDR,I,DOMAIN,DEFAULT,PROMPT,HELP,STS
"RTN","ORCHANG2",5,0)
 S HDR=$P($G(^TMP("OR",$J,ORTAB,0)),U,3),DEFAULT=""
"RTN","ORCHANG2",6,0)
 F I=1:1 S X=$T(ORDSTS+I) Q:$P(X,";",4)="ZZZZ"  D SET
"RTN","ORCHANG2",7,0)
 S DOMAIN(0)=I-1,PROMPT="Select Order Status: "
"RTN","ORCHANG2",8,0)
 S HELP="Enter the status of orders you wish to see listed here."
"RTN","ORCHANG2",9,0)
 D EN Q:Y="^"  S STS=+$G(DOMAIN(Y))
"RTN","ORCHANG2",10,0)
 I "^8^9^10^20^"[(U_STS_U) D  Q:Y="^"
"RTN","ORCHANG2",11,0)
 . N STRT,STOP,Z
"RTN","ORCHANG2",12,0)
 . S STRT=$$START^ORCHANGE("NOW-24H") I STRT="^" S Y="^" Q
"RTN","ORCHANG2",13,0)
 . S STOP=$$STOP^ORCHANGE("NOW") I STOP="^" S Y="^" Q
"RTN","ORCHANG2",14,0)
 . I STOP<STRT S Z=STRT,STRT=STOP,STOP=Z
"RTN","ORCHANG2",15,0)
 . S $P(HDR,";",1,2)=$P(STRT,U,2)_";"_$P(STOP,U,2)
"RTN","ORCHANG2",16,0)
 S $P(HDR,";",3)=STS,$P(HDR,";",8)=""
"RTN","ORCHANG2",17,0)
 I (STS=2)!(STS=5) D
"RTN","ORCHANG2",18,0)
 . I $P(HDR,";")'="" D
"RTN","ORCHANG2",19,0)
 . . N THISTS,DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","ORCHANG2",20,0)
 . . S THISTS=" only active "
"RTN","ORCHANG2",21,0)
 . . S:STS=5 THISTS=" expiring "
"RTN","ORCHANG2",22,0)
 . . W !,"Date range can not be selected when viewing"_THISTS_"orders"
"RTN","ORCHANG2",23,0)
 . . W !,"and will be cleared."
"RTN","ORCHANG2",24,0)
 . . S DIR(0)="E" D ^DIR
"RTN","ORCHANG2",25,0)
 . S $P(HDR,";",1,2)=";"
"RTN","ORCHANG2",26,0)
 I STS=6,$P(HDR,";")="" S $P(HDR,";",1,2)="T;T@23:59"
"RTN","ORCHANG2",27,0)
 S $P(^TMP("OR",$J,ORTAB,0),U,3,4)=HDR_U
"RTN","ORCHANG2",28,0)
 Q
"RTN","ORCHANG2",29,0)
 ;
"RTN","ORCHANG2",30,0)
STSLST(ORY)     ; -- Returns array of order views as 
"RTN","ORCHANG2",31,0)
 ;            ORY(n) = id ^ name ^ parent id [^+ if has members]
"RTN","ORCHANG2",32,0)
 N I,X,CNT S CNT=0
"RTN","ORCHANG2",33,0)
 F I=1:1 S X=$T(ORDSTS+I) Q:$P(X,";",4)="ZZZZ"  S CNT=CNT+1,ORY(CNT)=$TR($P(X,";",3,6),";","^")
"RTN","ORCHANG2",34,0)
 ; include specific patient events??
"RTN","ORCHANG2",35,0)
 Q
"RTN","ORCHANG2",36,0)
 ;
"RTN","ORCHANG2",37,0)
ORDSTS ;;#;Name of Order Context
"RTN","ORCHANG2",38,0)
 ;;1;All;0;+
"RTN","ORCHANG2",39,0)
 ;;2;Active (includes pending, recent activity);1
"RTN","ORCHANG2",40,0)
 ;;23;Current (Active & Pending status only);1
"RTN","ORCHANG2",41,0)
 ;;3;Discontinued;1
"RTN","ORCHANG2",42,0)
 ;;28;Discontinued/Entered in Error;1
"RTN","ORCHANG2",43,0)
 ;;4;Completed/Expired;1
"RTN","ORCHANG2",44,0)
 ;;5;Expiring;1
"RTN","ORCHANG2",45,0)
 ;;7;Pending;1
"RTN","ORCHANG2",46,0)
 ;;18;On Hold;1
"RTN","ORCHANG2",47,0)
 ;;19;New Orders;1
"RTN","ORCHANG2",48,0)
 ;;11;Unsigned;1
"RTN","ORCHANG2",49,0)
 ;;8;Unverified by anyone;1;+
"RTN","ORCHANG2",50,0)
 ;;9;Unverified by Nursing;8
"RTN","ORCHANG2",51,0)
 ;;10;Unverified by Clerk;8
"RTN","ORCHANG2",52,0)
 ;;20;Unverified/Chart Review;8
"RTN","ORCHANG2",53,0)
 ;;13;Verbal/Phoned;1;+
"RTN","ORCHANG2",54,0)
 ;;14;Verbal/Phoned unsigned;13
"RTN","ORCHANG2",55,0)
 ;;12;Flagged;1
"RTN","ORCHANG2",56,0)
 ;;6;Recent Activity (defaults to today's orders);1
"RTN","ORCHANG2",57,0)
 ;;24;Delayed (all events);1;+
"RTN","ORCHANG2",58,0)
 ;;15;Delayed Admission;24
"RTN","ORCHANG2",59,0)
 ;;17;Delayed Transfer;24
"RTN","ORCHANG2",60,0)
 ;;16;Delayed Discharge;24
"RTN","ORCHANG2",61,0)
 ;;25;Delayed Return from O.R.;24
"RTN","ORCHANG2",62,0)
 ;;26;Delayed for Manual Release;24
"RTN","ORCHANG2",63,0)
 ;;22;Lapsed (never processed);1
"RTN","ORCHANG2",64,0)
 ;;;ZZZZ
"RTN","ORCHANG2",65,0)
 ;
"RTN","ORCHANG2",66,0)
STS ; -- Select new [order or consult] status
"RTN","ORCHANG2",67,0)
 N HDR,DEFAULT,DOMAIN,PROMPT,HELP,X,Y,I
"RTN","ORCHANG2",68,0)
 S HDR=$P($G(^TMP("OR",$J,ORTAB,0)),U,3),DEFAULT=""
"RTN","ORCHANG2",69,0)
 S (I,Y)=0 F  S I=$O(^ORD(100.01,I)) Q:I'>0  Q:I=99  S X=$G(^(I,0)) D
"RTN","ORCHANG2",70,0)
 . Q:"^1^2^5^6^8^9^13^"'[(U_I_U)  S Y=Y+1
"RTN","ORCHANG2",71,0)
 . S DOMAIN(Y)=I_U_$$LOWER^VALM1($P(X,U)),DOMAIN("B",$P(X,U))=Y
"RTN","ORCHANG2",72,0)
 . S:I=$P(HDR,";",3) DEFAULT=$P(DOMAIN(Y),U,2)
"RTN","ORCHANG2",73,0)
 S Y=Y+1,DOMAIN(Y)="^All Statuses",DOMAIN("B","ALL STATUSES")=Y
"RTN","ORCHANG2",74,0)
 S DOMAIN(0)=Y,PROMPT="Select Consult Status: "
"RTN","ORCHANG2",75,0)
 S HELP="Enter the status of consults you wish to see listed here."
"RTN","ORCHANG2",76,0)
 D EN Q:Y="^"
"RTN","ORCHANG2",77,0)
 S $P(HDR,";",3)=$P(DOMAIN(Y),U),$P(^TMP("OR",$J,ORTAB,0),U,3,4)=HDR_U
"RTN","ORCHANG2",78,0)
 Q
"RTN","ORCHANG2",79,0)
 ;
"RTN","ORCHANG2",80,0)
TIU ; -- Select new document status
"RTN","ORCHANG2",81,0)
 N X,Y,ORY,I,CNT,HDR,DOMAIN,DEFAULT,PROMPT,HELP
"RTN","ORCHANG2",82,0)
 S HDR=$P($G(^TMP("OR",$J,ORTAB,0)),U,3),DEFAULT=$P(HDR,";",3)
"RTN","ORCHANG2",83,0)
 D STATUS^TIUSRVL(.ORY)
"RTN","ORCHANG2",84,0)
 S (I,CNT)=0 F  S I=$O(ORY(I)) Q:I'>0  S CNT=CNT+1,DOMAIN(CNT)=ORY(I),DOMAIN("B",$$UP^XLFSTR($P(ORY(I),U,2)))=CNT
"RTN","ORCHANG2",85,0)
 S DOMAIN(0)=CNT,PROMPT="Select Signature Status: "
"RTN","ORCHANG2",86,0)
 S HELP="Enter the signature status you would like to screen on"
"RTN","ORCHANG2",87,0)
 D EN Q:Y="^"
"RTN","ORCHANG2",88,0)
 S $P(HDR,";",3)=$P(DOMAIN(Y),U,2),$P(^TMP("OR",$J,ORTAB,0),U,3,4)=HDR_U
"RTN","ORCHANG2",89,0)
 Q
"RTN","ORCHANG2",90,0)
 ;
"RTN","ORCHANG2",91,0)
PLIST ; -- Select problem status
"RTN","ORCHANG2",92,0)
 N X,Y,HDR,I,ID,NAME,DOMAIN,DEFAULT,PROMPT,HELP
"RTN","ORCHANG2",93,0)
 S HDR=$P($G(^TMP("OR",$J,ORTAB,0)),U,3)
"RTN","ORCHANG2",94,0)
 F I=1:1 S X=$T(PLSTS+I) Q:$P(X,";",4)="ZZZZ"  D SET
"RTN","ORCHANG2",95,0)
 S DOMAIN(0)=I-1,PROMPT="Select Problem Status: "
"RTN","ORCHANG2",96,0)
 S HELP="Enter the status of the problems you wish to see listed here."
"RTN","ORCHANG2",97,0)
 D EN Q:Y="^"
"RTN","ORCHANG2",98,0)
 S $P(HDR,";",3)=$P(DOMAIN(Y),U),$P(^TMP("OR",$J,ORTAB,0),U,3,4)=HDR_U
"RTN","ORCHANG2",99,0)
 Q
"RTN","ORCHANG2",100,0)
 ;
"RTN","ORCHANG2",101,0)
PLSTS ;;I;name
"RTN","ORCHANG2",102,0)
 ;;A;active
"RTN","ORCHANG2",103,0)
 ;;I;inactive
"RTN","ORCHANG2",104,0)
 ;;B;both active & inactive
"RTN","ORCHANG2",105,0)
 ;;;ZZZZ
"RTN","ORCHANG2",106,0)
 ;
"RTN","ORCHANG2",107,0)
SET ; -- set DOMAIN(I)=ID^NAME, DEFAULT from X=";;ID;NAME"
"RTN","ORCHANG2",108,0)
 N ID,NAME
"RTN","ORCHANG2",109,0)
 S ID=$P(X,";",3),NAME=$P(X,";",4)
"RTN","ORCHANG2",110,0)
 S DOMAIN(I)=ID_U_NAME,DOMAIN("B",$$UP^XLFSTR(NAME))=I
"RTN","ORCHANG2",111,0)
 S:ID=$P(HDR,";",3) DEFAULT=NAME
"RTN","ORCHANG2",112,0)
 Q
"RTN","ORCHANG2",113,0)
 ;
"RTN","ORCHANG2",114,0)
EN ; -- Select new status via DOMAIN(), PROMPT, DEFAULT, HELP
"RTN","ORCHANG2",115,0)
 N DONE S DONE=0,Y="" F  D  Q:DONE
"RTN","ORCHANG2",116,0)
 . W !,PROMPT_$S($L(DEFAULT):DEFAULT_"//",1:"")
"RTN","ORCHANG2",117,0)
 . R X:DTIME S:'$T X="^" I X["^" S Y="^",DONE=1 Q
"RTN","ORCHANG2",118,0)
 . S:X="" X=DEFAULT I X="" S Y="^",DONE=1 Q
"RTN","ORCHANG2",119,0)
 . I X["?" W !!,HELP D LIST Q
"RTN","ORCHANG2",120,0)
 . D  I 'Y W $C(7),!,HELP Q
"RTN","ORCHANG2",121,0)
 . . N XP,XY,CNT,MATCH,DIR,I
"RTN","ORCHANG2",122,0)
 . . S X=$$UP^XLFSTR(X),Y=+$G(DOMAIN("B",X)) Q:Y  ; done
"RTN","ORCHANG2",123,0)
 . . S CNT=0,XP=X F  S XP=$O(DOMAIN("B",XP)) Q:XP=""  Q:$E(XP,1,$L(X))'=X  S CNT=CNT+1,XY=+DOMAIN("B",XP),MATCH(CNT)=XY_U_$P(DOMAIN(XY),U,2)
"RTN","ORCHANG2",124,0)
 . . Q:'CNT
"RTN","ORCHANG2",125,0)
 . . I CNT=1 S Y=+MATCH(1),XP=$P(MATCH(1),U,2) W $E(XP,$L(X)+1,$L(XP)) Q
"RTN","ORCHANG2",126,0)
 . . S DIR(0)="NAO^1:"_CNT,DIR("A")="Select 1-"_CNT_": "
"RTN","ORCHANG2",127,0)
 . . F I=1:1:CNT S DIR("A",I)=$J(I,3)_" "_$P(MATCH(I),U,2)
"RTN","ORCHANG2",128,0)
 . . S DIR("?")="Select the desired value, by number"
"RTN","ORCHANG2",129,0)
 . . I CNT>3 D FULL^VALM1 S VALMBCK="R" ;need to scroll
"RTN","ORCHANG2",130,0)
 . . D ^DIR I $D(DIRUT) S Y="" Q
"RTN","ORCHANG2",131,0)
 . . S Y=+MATCH(Y) W "  "_$P(DOMAIN(Y),U,2)
"RTN","ORCHANG2",132,0)
 . S DONE=1
"RTN","ORCHANG2",133,0)
 Q
"RTN","ORCHANG2",134,0)
 ;
"RTN","ORCHANG2",135,0)
LIST ; -- List order statuses in DOMAIN
"RTN","ORCHANG2",136,0)
 N I,Z,CNT,DONE D FULL^VALM1 S VALMBCK="R"
"RTN","ORCHANG2",137,0)
 S CNT=0 W !,"Choose from:"
"RTN","ORCHANG2",138,0)
 F I=1:1:DOMAIN(0) D  Q:$G(DONE)
"RTN","ORCHANG2",139,0)
 . S CNT=CNT+1 W ! I CNT>(IOSL-3) D  Q:$G(DONE)
"RTN","ORCHANG2",140,0)
 .. W ?3,"'^' TO STOP: " R Z:DTIME S:'$T!(Z["^") DONE=1 S CNT=1
"RTN","ORCHANG2",141,0)
 . W $C(13),"  "_$P(DOMAIN(I),U,2)
"RTN","ORCHANG2",142,0)
 Q
"RTN","ORCHANGE")
0^156^B41306460
"RTN","ORCHANGE",1,0)
ORCHANGE ;SLC/MKB-Change View utilities ; 08 May 2002  2:12 PM
"RTN","ORCHANGE",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**27,72,141,243**;Dec 17, 1997;Build 242
"RTN","ORCHANGE",3,0)
EN ; -- Change view of current list
"RTN","ORCHANGE",4,0)
 N XQORM,Y,ORI
"RTN","ORCHANGE",5,0)
 S XQORM=$G(^TMP("OR",$J,"CURRENT","CHANGE")),VALMBCK=""
"RTN","ORCHANGE",6,0)
 I 'XQORM W !!,"No other views of this list currently available" H 2 Q
"RTN","ORCHANGE",7,0)
 S Y=$S(ORTAB="NOTES"!(ORTAB="SUMMRIES"):"1\",ORTAB="ORDERS":"\",1:"")
"RTN","ORCHANGE",8,0)
 S XQORM(0)=Y_"AD" K Y
"RTN","ORCHANGE",9,0)
 S XQORM("A")=$S($L($G(^ORD(101,+XQORM,28))):^(28),1:"Select attribute(s) to change: ")
"RTN","ORCHANGE",10,0)
 D EN^XQORM S ORI=0
"RTN","ORCHANGE",11,0)
 F  S ORI=$O(Y(ORI)) Q:ORI'>0  X:$D(^ORD(101,+$P(Y(ORI),U,2),20)) ^(20)
"RTN","ORCHANGE",12,0)
 I $G(^TMP("OR",$J,"CURRENT",0))'=$G(^TMP("OR",$J,ORTAB,0)) K VALMBG D TAB^ORCHART(ORTAB,1)
"RTN","ORCHANGE",13,0)
 Q
"RTN","ORCHANGE",14,0)
 ;
"RTN","ORCHANGE",15,0)
RANGE ; -- Get new date range for list
"RTN","ORCHANGE",16,0)
 N HDR,OLD,NEW,REQ,BEG,END
"RTN","ORCHANGE",17,0)
 S HDR=$P($G(^TMP("OR",$J,ORTAB,0)),U,3)
"RTN","ORCHANGE",18,0)
 S REQ=$S(ORTAB="XRAYS":1,ORTAB="REPORTS":1,1:0)
"RTN","ORCHANGE",19,0)
 I ($P(HDR,";",3)=2)!($P(HDR,";",3)=5) D  Q
"RTN","ORCHANGE",20,0)
 . N DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y,THISTS
"RTN","ORCHANGE",21,0)
 . S THISTS=" only active "
"RTN","ORCHANGE",22,0)
 . I $P(HDR,";",3)=5 S THISTS=" expiring "
"RTN","ORCHANGE",23,0)
 . W !,"Date range can not be selected when viewing"_THISTS_"orders."
"RTN","ORCHANGE",24,0)
 . S DIR(0)="E" D ^DIR
"RTN","ORCHANGE",25,0)
 S OLD=$P(HDR,";"),NEW=$$START(OLD,REQ) Q:NEW="^"  S BEG=NEW
"RTN","ORCHANGE",26,0)
 I BEG="" S END="" G RQ
"RTN","ORCHANGE",27,0)
 S OLD=$P(HDR,";",2),NEW=$$STOP(OLD,REQ) Q:NEW="^"  S END=NEW
"RTN","ORCHANGE",28,0)
 I END<BEG S NEW=END,END=BEG,BEG=NEW ; switch
"RTN","ORCHANGE",29,0)
RQ S $P(HDR,";",1,2)=$P(BEG,U,2)_";"_$P(END,U,2)
"RTN","ORCHANGE",30,0)
 S $P(^TMP("OR",$J,ORTAB,0),U,3,4)=HDR_U
"RTN","ORCHANGE",31,0)
 Q
"RTN","ORCHANGE",32,0)
 ;
"RTN","ORCHANGE",33,0)
START(CURRENT,REQD) ; -- Return new beginning date
"RTN","ORCHANGE",34,0)
 N X,Y,DIR
"RTN","ORCHANGE",35,0)
 S DIR(0)="DA"_$S('$G(REQD):"O",1:"")_"^::ETX",DIR("A")="Beginning Date[/time]: "
"RTN","ORCHANGE",36,0)
 S:$L($G(CURRENT)) DIR("B")=$S(CURRENT?7N.1".".6N:$$FMTE^XLFDT(CURRENT),1:CURRENT)
"RTN","ORCHANGE",37,0)
 S DIR("?")="Enter the earliest date [and time] from which you want to see data; a null response will return all data on this patient"
"RTN","ORCHANGE",38,0)
 D ^DIR S:$D(DTOUT) Y="^" S:X="@" Y="" S:Y Y=Y_U_X
"RTN","ORCHANGE",39,0)
 Q Y
"RTN","ORCHANGE",40,0)
 ;
"RTN","ORCHANGE",41,0)
STOP(CURRENT,REQD) ; -- Return new ending date
"RTN","ORCHANGE",42,0)
 N X,Y,DIR
"RTN","ORCHANGE",43,0)
 S DIR(0)="DA"_$S('$G(REQD):"O",1:"")_"^::ETX",DIR("A")="Ending Date[/time]: "
"RTN","ORCHANGE",44,0)
 S:$L($G(CURRENT)) DIR("B")=$S(CURRENT?7N.1".".6N:$$FMTE^XLFDT(CURRENT),1:CURRENT)
"RTN","ORCHANGE",45,0)
 S DIR("?")="Enter the latest date [and time] for which you want to see data; a null response will assume TODAY"
"RTN","ORCHANGE",46,0)
 D ^DIR S:$D(DTOUT) Y="^" S:X="@" Y="" S:Y Y=Y_U_X
"RTN","ORCHANGE",47,0)
 Q Y
"RTN","ORCHANGE",48,0)
 ;
"RTN","ORCHANGE",49,0)
MAX ; -- Get new max # of items to list
"RTN","ORCHANGE",50,0)
 N X,Y,DIR
"RTN","ORCHANGE",51,0)
 S HDR=$P($G(^TMP("OR",$J,ORTAB,0)),U,3),X=$P(HDR,";",5)
"RTN","ORCHANGE",52,0)
 S DIR(0)="NAO^1:999" S:X DIR("B")=X
"RTN","ORCHANGE",53,0)
 S DIR("A")="Maximum # of items to display: "
"RTN","ORCHANGE",54,0)
 S DIR("?")="Enter the total number of items you wish to be displayed here"
"RTN","ORCHANGE",55,0)
 D ^DIR Q:'Y
"RTN","ORCHANGE",56,0)
 S $P(HDR,";",5)=Y,$P(^TMP("OR",$J,ORTAB,0),U,3,4)=HDR_U
"RTN","ORCHANGE",57,0)
 Q
"RTN","ORCHANGE",58,0)
 ;
"RTN","ORCHANGE",59,0)
AUTHOR(USER) ; -- Select new author of note
"RTN","ORCHANGE",60,0)
 N X,Y,DIC D FULL^VALM1 S VALMBCK="R"
"RTN","ORCHANGE",61,0)
 S DIC=200,DIC(0)="AEQM",DIC("A")="Select AUTHOR: "
"RTN","ORCHANGE",62,0)
 S:$G(USER) DIC("B")=$P($G(^VA(200,+USER,0)),U)
"RTN","ORCHANGE",63,0)
 D ^DIC S:Y'>0 Y=""
"RTN","ORCHANGE",64,0)
 Q +Y
"RTN","ORCHANGE",65,0)
 ;
"RTN","ORCHANGE",66,0)
LISTHDR ; -- List available subhdrs
"RTN","ORCHANGE",67,0)
 N HDR,DONE,CNT D FULL^VALM1
"RTN","ORCHANGE",68,0)
 W !!,"Choose from:" S HDR="",(CNT,DONE)=0,VALMBCK="R"
"RTN","ORCHANGE",69,0)
 F  S HDR=$O(^TMP("OR",$J,"CURRENT","HDR",HDR)) Q:HDR=""  D  Q:DONE
"RTN","ORCHANGE",70,0)
 . S CNT=CNT+1 I CNT>(IOSL-2) S CNT=0 I '$$MORE^ORCD S DONE=1 Q
"RTN","ORCHANGE",71,0)
 . W !,"  "_HDR
"RTN","ORCHANGE",72,0)
 Q
"RTN","ORCHANGE",73,0)
 ;
"RTN","ORCHANGE",74,0)
LRSUB ; -- Return lab subscript to jump to in list
"RTN","ORCHANGE",75,0)
 ;    Available subscripts in ^TMP("OR",$J,"IDX",name)=line #
"RTN","ORCHANGE",76,0)
 I '$D(^TMP("OR",$J,"CURRENT","HDR")) W !!,"There are no section headers defined for this report." H 3 Q
"RTN","ORCHANGE",77,0)
 N X,Y,DIR,XP,P,CNT,MATCH D FULL^VALM1 S VALMBCK="R"
"RTN","ORCHANGE",78,0)
LRS S DIR(0)="FAO^1:30",DIR("A")="Select Lab Section: "
"RTN","ORCHANGE",79,0)
 S DIR("A",1)="Available sections in this report:",X=""
"RTN","ORCHANGE",80,0)
 F I=2:1 S X=$O(^TMP("OR",$J,"CURRENT","HDR",X)) Q:X=""  S DIR("A",I)="   "_X
"RTN","ORCHANGE",81,0)
 S DIR("?")="Enter the lab section from which to wish to see results; the display will scroll to the top of the selected section" ;,DIR("??")="^D LISTHDR^ORCHANGE"
"RTN","ORCHANGE",82,0)
 D ^DIR Q:"^"[Y
"RTN","ORCHANGE",83,0)
 S XP=$$UP^XLFSTR(X)
"RTN","ORCHANGE",84,0)
 I $G(^TMP("OR",$J,"CURRENT","HDR",XP)) S VALMBG=^(XP),VALMBCK="R" Q
"RTN","ORCHANGE",85,0)
 S CNT=0,P=XP F  S P=$O(^TMP("OR",$J,"CURRENT","HDR",P)) Q:$E(P,1,$L(XP))'=XP  S CNT=CNT+1,MATCH(CNT)=+$G(^(P))_U_P ; line# ^ hdr name
"RTN","ORCHANGE",86,0)
 I 'CNT W $C(7),"  ??" G LRS
"RTN","ORCHANGE",87,0)
 I CNT=1 S VALMBG=+MATCH(CNT),VALMBCK="R",P=$P(MATCH(1),U,2) W $E(P,$L(X)+1,$L(P)) Q
"RTN","ORCHANGE",88,0)
LRS1 K DIR S DIR(0)="NAO^1:"_CNT,DIR("A")="Select 1-"_CNT_": "
"RTN","ORCHANGE",89,0)
 F I=1:1:CNT S DIR("A",I)=I_"  "_$P(MATCH(I),U,2)
"RTN","ORCHANGE",90,0)
 S DIR("?")="Select the lab section you want to go to, by number"
"RTN","ORCHANGE",91,0)
 D ^DIR Q:$D(DTOUT)!($D(DUOUT))  I 'Y K DIR G LRS
"RTN","ORCHANGE",92,0)
 S VALMBG=+MATCH(Y),VALMBCK="R"
"RTN","ORCHANGE",93,0)
 Q
"RTN","ORCHANGE",94,0)
 ;
"RTN","ORCHANGE",95,0)
DGROUP ; -- Select new service (display group)
"RTN","ORCHANGE",96,0)
 N X,Y,Z,ZZ,DIC,HDR,DONE,HELP
"RTN","ORCHANGE",97,0)
 D FULL^VALM1 S VALMBCK="R"
"RTN","ORCHANGE",98,0)
 S HDR=$P($G(^TMP("OR",$J,ORTAB,0)),U,3),Z=$P(HDR,";",4),ZZ=+$O(^ORD(100.98,"B",$S($L(Z):Z,1:"ALL"),0))
"RTN","ORCHANGE",99,0)
 S HELP="Enter the service or section from which you wish to see orders for this patient."
"RTN","ORCHANGE",100,0)
 S DONE=0 F  D  Q:DONE
"RTN","ORCHANGE",101,0)
 . W !!,"Select Service/Section: "_$P(^ORD(100.98,+ZZ,0),U)_"//"
"RTN","ORCHANGE",102,0)
 . R X:DTIME S:'$T X="^" I X["^" S DONE=1 Q
"RTN","ORCHANGE",103,0)
 . I X="" S DONE=1 Q  ; no change
"RTN","ORCHANGE",104,0)
 . I X["?" W !!,HELP,!,"Choose from:" D DG^ORCHANG1(1,"DISP") Q
"RTN","ORCHANGE",105,0)
 . S DIC=100.98,DIC(0)="NEQZ" D ^DIC S:Y>0 Z=$P(Y(0),U,3),ZZ=+Y,DONE=1
"RTN","ORCHANGE",106,0)
 S $P(HDR,";",4)=Z,$P(^TMP("OR",$J,ORTAB,0),U,3,4)=HDR_U
"RTN","ORCHANGE",107,0)
 Q
"RTN","ORCHANGE",108,0)
 ;
"RTN","ORCHANGE",109,0)
CS ; -- Select new consult service
"RTN","ORCHANGE",110,0)
 N GMRCDG,GMRCBUF,GMRCACT,GMRCQUT,GMRCGRP,HDR
"RTN","ORCHANGE",111,0)
 D FULL^VALM1,ASRV^GMRCASV S VALMBCK="R" Q:$D(GMRCQUT)
"RTN","ORCHANGE",112,0)
 S:$G(GMRCDG) HDR=$P($G(^TMP("OR",$J,ORTAB,0)),U,3),$P(HDR,";",4)=GMRCDG,$P(^(0),U,3,4)=HDR_U
"RTN","ORCHANGE",113,0)
 K ^TMP("GMRCS",$J),^TMP("GMRCSLIST",$J)
"RTN","ORCHANGE",114,0)
 Q
"RTN","ORCHANGE",115,0)
 ;
"RTN","ORCHANGE",116,0)
REMOVE ; -- Remove preferred view
"RTN","ORCHANGE",117,0)
 N ORDEL S ORDEL=1
"RTN","ORCHANGE",118,0)
SAVE ; -- Save current view as preferred
"RTN","ORCHANGE",119,0)
 Q:'$$OK($G(ORDEL))  N X,Y,PARAM
"RTN","ORCHANGE",120,0)
 S X=$S($G(ORDEL):"@",1:$P($G(^TMP("OR",$J,ORTAB,0)),U,3)),Y=""
"RTN","ORCHANGE",121,0)
 ;S:$G(ORTAB)="MEDS" Y=$S($P(X,";",3):"IN",1:"OUT")_"PT "
"RTN","ORCHANGE",122,0)
 S:$G(ORTAB)="LABS" Y=$S($G(ORWARD):"IN",1:"OUT")_"PT "
"RTN","ORCHANGE",123,0)
 S PARAM="ORCH CONTEXT "_Y_$G(ORTAB)
"RTN","ORCHANGE",124,0)
 D EN^XPAR("USR",PARAM,1,X) W " ...done." H 1
"RTN","ORCHANGE",125,0)
 Q
"RTN","ORCHANGE",126,0)
 ;
"RTN","ORCHANGE",127,0)
OK(DEL) ; -- Are you sure you want to save/remove view of ORTAB?
"RTN","ORCHANGE",128,0)
 N X,Y,DIR S DIR(0)="YA"
"RTN","ORCHANGE",129,0)
 S DIR("A")="Are you sure you want to "_$S($G(DEL):"remove",1:"save the current view as")_" your preference? "
"RTN","ORCHANGE",130,0)
 S:$G(DEL) DIR("?",1)="Enter YES if you wish to remove your preferred view of this chart tab and use",DIR("?")="the default view next time, or NO to quit without changing anything."
"RTN","ORCHANGE",131,0)
 S:'$G(DEL) DIR("?",1)="Enter YES if you wish to use these same parameters again the next time the ",DIR("?")=$$LOWER^VALM1(ORTAB)_" tab is created for you, or NO to quit without saving anything."
"RTN","ORCHANGE",132,0)
 D ^DIR
"RTN","ORCHANGE",133,0)
 Q +Y
"RTN","ORCHANGE",134,0)
 ;
"RTN","ORCHANGE",135,0)
RETURN ; -- Return to preferred view of ORTAB
"RTN","ORCHANGE",136,0)
 S $P(^TMP("OR",$J,ORTAB,0),U,4)=1
"RTN","ORCHANGE",137,0)
 Q
"RTN","ORCHECK")
0^26^B47055177
"RTN","ORCHECK",1,0)
ORCHECK ;SLC/MKB-Order checking calls ; 08 May 2002  2:12 PM [8/16/05 5:28am]
"RTN","ORCHECK",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,56,70,94,141,215,243**;Dec 17, 1997;Build 242
"RTN","ORCHECK",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ORCHECK",4,0)
DISPLAY ; -- DISPLAY event [called from ORCDLG,ORCACT4,ORCMED]
"RTN","ORCHECK",5,0)
 ;    Expects ORVP, ORNMSP, ORTAB, [ORWARD]
"RTN","ORCHECK",6,0)
 Q:$$GET^XPAR("DIV^SYS^PKG","ORK SYSTEM ENABLE/DISABLE")'="E"
"RTN","ORCHECK",7,0)
 N ORX,ORY,I
"RTN","ORCHECK",8,0)
 I ORNMSP="PS" D  ;reset to PSJ, PSJI, or PSO
"RTN","ORCHECK",9,0)
 . I $G(ORDG) S I=$P($G(^ORD(100.98,+ORDG,0)),U,3),I=$P(I," ") Q:'$L(I)  S ORNMSP="PS"_$S(I="UD":"I",1:I) Q
"RTN","ORCHECK",10,0)
 . I $G(ORXFER) S I=$P($P(^TMP("OR",$J,ORTAB,0),U,3),";",3) S:I="" I=$G(ORWARD) S ORNMSP="PS"_$S(I:"O",1:"I") ;opposite of list
"RTN","ORCHECK",11,0)
 S ORX(1)="|"_ORNMSP,ORX=1
"RTN","ORCHECK",12,0)
 D EN^ORKCHK(.ORY,+ORVP,.ORX,"DISPLAY") Q:'$D(ORY)
"RTN","ORCHECK",13,0)
 S I=0 F  S I=$O(ORY(I)) Q:I'>0  W !,$P(ORY(I),U,4) ; display only
"RTN","ORCHECK",14,0)
 Q
"RTN","ORCHECK",15,0)
 ;
"RTN","ORCHECK",16,0)
SELECT ; -- SELECT event
"RTN","ORCHECK",17,0)
 ;    Expects ORVP, ORDAILOG(PROMPT,ORI), ORNMSP
"RTN","ORCHECK",18,0)
 Q:$$GET^XPAR("DIV^SYS^PKG","ORK SYSTEM ENABLE/DISABLE")'="E"
"RTN","ORCHECK",19,0)
 N ORX,ORY,OI
"RTN","ORCHECK",20,0)
 S OI=+$G(ORDIALOG(PROMPT,ORI))
"RTN","ORCHECK",21,0)
 S ORX=1,ORX(1)=OI_"|"_ORNMSP_"|"_$$USID^ORMBLD(OI)
"RTN","ORCHECK",22,0)
 D EN^ORKCHK(.ORY,+ORVP,.ORX,"SELECT"),RETURN:$D(ORY)
"RTN","ORCHECK",23,0)
 Q
"RTN","ORCHECK",24,0)
 ;
"RTN","ORCHECK",25,0)
ACCEPT(MODE) ; -- ACCEPT event [called from ORCDLG,ORCACT4,ORCMED]
"RTN","ORCHECK",26,0)
 ;    Expects ORVP, ORDIALOG(), ORNMSP
"RTN","ORCHECK",27,0)
 Q:$$GET^XPAR("DIV^SYS^PKG","ORK SYSTEM ENABLE/DISABLE")'="E"
"RTN","ORCHECK",28,0)
 N ORX,ORY,ORZ,OI,ORSTRT,ORI,ORIT,ORID,ORSP
"RTN","ORCHECK",29,0)
 S:'$L($G(MODE)) MODE="ACCEPT"
"RTN","ORCHECK",30,0)
 S OI=$$PTR^ORCD("OR GTX ORDERABLE ITEM"),ORSTRT=$$START,ORX=0
"RTN","ORCHECK",31,0)
 S ORI=0 F  S ORI=$O(ORDIALOG(OI,ORI)) Q:ORI'>0  D STUF
"RTN","ORCHECK",32,0)
 I $G(ORDG)=+$O(^ORD(100.98,"B","IV RX",0)) S OI=$$PTR^ORCD("OR GTX ADDITIVE"),ORI=0 F  S ORI=$O(ORDIALOG(OI,ORI)) Q:ORI'>0  D STUF
"RTN","ORCHECK",33,0)
 D EN^ORKCHK(.ORY,+ORVP,.ORX,MODE),RETURN:$D(ORY)
"RTN","ORCHECK",34,0)
 Q
"RTN","ORCHECK",35,0)
STUF S ORIT=ORDIALOG(OI,ORI),ORSP=""
"RTN","ORCHECK",36,0)
 S:ORNMSP="LR" ORSP=+$G(ORDIALOG($$PTR^ORCD("OR GTX SPECIMEN"),ORI))
"RTN","ORCHECK",37,0)
 S ORID=$S($E(ORNMSP,1,2)="PS":$$DRUG(ORIT,OI),1:$$USID^ORMBLD(ORIT))
"RTN","ORCHECK",38,0)
 S ORZ=1,ORZ(1)=ORIT_"|"_ORNMSP_"|"_ORID
"RTN","ORCHECK",39,0)
 I MODE'="ALL" D EN^ORKCHK(.ORY,+ORVP,.ORZ,"SELECT"),RETURN:$D(ORY)
"RTN","ORCHECK",40,0)
 S ORX=ORX+1,ORX(ORX)=ORZ(1)_"|"_ORSTRT_"||"_ORSP K ORY,ORZ
"RTN","ORCHECK",41,0)
 Q
"RTN","ORCHECK",42,0)
 ;
"RTN","ORCHECK",43,0)
DELAY(MODE) ; -- Delayed ACCEPT event [called from ORMEVNT]
"RTN","ORCHECK",44,0)
 ;    Expects ORVP, ORIFN
"RTN","ORCHECK",45,0)
 Q:$$GET^XPAR("DIV^SYS^PKG","ORK SYSTEM ENABLE/DISABLE")'="E"
"RTN","ORCHECK",46,0)
 N ORX,ORY,ORCHECK S:'$L($G(MODE)) MODE="NOTIF"
"RTN","ORCHECK",47,0)
 D BLD(+ORIFN),EN^ORKCHK(.ORY,+ORVP,.ORX,MODE) Q:'$D(ORY)
"RTN","ORCHECK",48,0)
 D RETURN I MODE="NOTIF" S ORCHECK("OK")="Notification sent to provider" D OC^ORCSAVE2 Q  ; silent
"RTN","ORCHECK",49,0)
 Q
"RTN","ORCHECK",50,0)
 ;
"RTN","ORCHECK",51,0)
SESSION ; -- SESSION event [called from ORCSIGN]
"RTN","ORCHECK",52,0)
 ;    Expects ORVP, ORES()
"RTN","ORCHECK",53,0)
 Q:$$GET^XPAR("DIV^SYS^PKG","ORK SYSTEM ENABLE/DISABLE")'="E"
"RTN","ORCHECK",54,0)
 N ORX,ORY,ORIFN,I,X,Y
"RTN","ORCHECK",55,0)
 S ORIFN=0 F  S ORIFN=$O(ORES(ORIFN)) Q:ORIFN'>0  I +$P(ORIFN,";",2)'>1 D
"RTN","ORCHECK",56,0)
 . I "^5^6^10^11^"'[(U_$P($G(^OR(100,+ORIFN,3)),U,3)_U) Q  ;unreleased
"RTN","ORCHECK",57,0)
 . D BLD(+ORIFN) Q:'$D(^OR(100,+ORIFN,9))
"RTN","ORCHECK",58,0)
 . S ORCHECK("IFN")=+$G(ORCHECK("IFN"))+1
"RTN","ORCHECK",59,0)
 . S I=0 F  S I=$O(^OR(100,+ORIFN,9,I)) Q:I'>0  S X=$G(^(I,0)),Y=$G(^(1)),ORCHECK=+$G(ORCHECK)+1,ORCHECK(+ORIFN,$S($P(X,U,2):$P(X,U,2),1:99),ORCHECK)=$P(X,U,1,2)_U_Y
"RTN","ORCHECK",60,0)
 I $D(ORX) D EN^ORKCHK(.ORY,+ORVP,.ORX,"SESSION"),RETURN:$D(ORY),REMDUPS
"RTN","ORCHECK",61,0)
 Q
"RTN","ORCHECK",62,0)
 ;
"RTN","ORCHECK",63,0)
BLD(ORDER) ; -- Build new ORX(#) for ORDER
"RTN","ORCHECK",64,0)
 Q:'$G(ORDER)  Q:'$D(^OR(100,ORDER,0))  ;Q:$P($G(^(3)),U,11)  ;edit/renew
"RTN","ORCHECK",65,0)
 N PKG,START,ORI,ITEM,USID,SPEC,ORDG,PTR,INST
"RTN","ORCHECK",66,0)
 S ORDG=$P(^OR(100,ORDER,0),U,11),PKG=$$GET1^DIQ(9.4,$P(^(0),U,14)_",",1)
"RTN","ORCHECK",67,0)
 I PKG="PS",$G(ORDG) S ORI=$P($G(^ORD(100.98,+ORDG,0)),U,3),ORI=$P(ORI," "),PKG=PKG_$S(ORI="UD":"I",1:ORI)
"RTN","ORCHECK",68,0)
 S START=$$START(ORDER),ORI=0
"RTN","ORCHECK",69,0)
 F  S ORI=$O(^OR(100,ORDER,4.5,"ID","ORDERABLE",ORI)) Q:ORI'>0  D
"RTN","ORCHECK",70,0)
 . S INST=$P($G(^OR(100,ORDER,4.5,ORI,0)),U,3),PTR=$P($G(^(0)),U,2),ITEM=+$G(^(1))
"RTN","ORCHECK",71,0)
 . S USID=$S(PKG?1"PS".E:$$DRUG(ITEM,PTR,ORDER),1:$$USID^ORMBLD(ITEM))
"RTN","ORCHECK",72,0)
 . S SPEC=$S(PKG="LR":$$VALUE^ORCSAVE2(ORDER,"SPECIMEN",INST),1:"")
"RTN","ORCHECK",73,0)
 . S ORX=+$G(ORX)+1,ORX(ORX)=ITEM_"|"_PKG_"|"_USID_"|"_START_"|"_ORDER_"|"_SPEC
"RTN","ORCHECK",74,0)
 Q
"RTN","ORCHECK",75,0)
 ;
"RTN","ORCHECK",76,0)
RETURN ; -- Return checks in ORCHECK(ORIFN,CDL,#)
"RTN","ORCHECK",77,0)
 N I,IFN,CDL S I=0 F  S I=$O(ORY(I)) Q:I'>0  D
"RTN","ORCHECK",78,0)
 . S IFN=+$P(ORY(I),U) S:'IFN IFN="NEW"
"RTN","ORCHECK",79,0)
 . S CDL=+$P(ORY(I),U,3) S:'CDL CDL=99
"RTN","ORCHECK",80,0)
 . S:'$D(ORCHECK(IFN)) ORCHECK("IFN")=+$G(ORCHECK("IFN"))+1 ; count
"RTN","ORCHECK",81,0)
 . S ORCHECK=+$G(ORCHECK)+1,ORCHECK(IFN,CDL,ORCHECK)=$P(ORY(I),U,2,4)
"RTN","ORCHECK",82,0)
 Q
"RTN","ORCHECK",83,0)
 ;
"RTN","ORCHECK",84,0)
REMDUPS ;
"RTN","ORCHECK",85,0)
 N IFN,CDL,I
"RTN","ORCHECK",86,0)
 S IFN=0 F  S IFN=$O(ORCHECK(IFN)) Q:'IFN  D
"RTN","ORCHECK",87,0)
 . S CDL=0 F  S CDL=$O(ORCHECK(IFN,CDL)) Q:'CDL  D
"RTN","ORCHECK",88,0)
 . . S I=0 F  S I=$O(ORCHECK(IFN,CDL,I)) Q:'I  D
"RTN","ORCHECK",89,0)
 . . . S J=I F  S J=$O(ORCHECK(IFN,CDL,J)) Q:'J  I $G(ORCHECK(IFN,CDL,I))=$G(ORCHECK(IFN,CDL,J)) K ORCHECK(IFN,CDL,J) S ORCHECK=$G(ORCHECK)-1
"RTN","ORCHECK",90,0)
 Q
"RTN","ORCHECK",91,0)
START(DA) ; -- Returns start date/time
"RTN","ORCHECK",92,0)
 N I,X,Y,%DT S Y=""
"RTN","ORCHECK",93,0)
 I $G(DA) S X=$O(^OR(100,DA,4.5,"ID","START",0)),X=$G(^OR(100,DA,4.5,+X,1))
"RTN","ORCHECK",94,0)
 E  D  ; look in ORDIALOG instead
"RTN","ORCHECK",95,0)
 . S I=0 F  S I=$O(ORDIALOG(I)) Q:I'>0  Q:$P(ORDIALOG(I),U,2)="START"
"RTN","ORCHECK",96,0)
 . S X=$S(I:$G(ORDIALOG(I,1)),1:"")
"RTN","ORCHECK",97,0)
 D AM^ORCSAVE2:X="AM",NEXT^ORCSAVE2:X="NEXT"
"RTN","ORCHECK",98,0)
 D ADMIN^ORCSAVE2("NEXT"):X="NEXTA",ADMIN^ORCSAVE2("CLOSEST"):X="CLOSEST"
"RTN","ORCHECK",99,0)
 I $L(X) S %DT="TX" D ^%DT S:Y'>0 Y=""
"RTN","ORCHECK",100,0)
 Q Y
"RTN","ORCHECK",101,0)
 ;
"RTN","ORCHECK",102,0)
DRUG(OI,PTR,IFN) ; -- Returns 6 ^-piece identifier for Dispense Drug
"RTN","ORCHECK",103,0)
 N ORDD,ORNDF,Y
"RTN","ORCHECK",104,0)
 I ORDG=+$O(^ORD(100.98,"B","IV RX",0)) S ORDD=$$IV G D1
"RTN","ORCHECK",105,0)
 I $G(IFN) S ORDD=$O(^OR(100,IFN,4.5,"ID","DRUG",0)),ORDD=+$G(^OR(100,IFN,4.5,+ORDD,1))
"RTN","ORCHECK",106,0)
 E  S ORDD=+$G(ORDIALOG($$PTR^ORCD("OR GTX DISPENSE DRUG"),1))
"RTN","ORCHECK",107,0)
D1 Q:'ORDD "" S ORNDF=$$ENDCM^PSJORUTL(ORDD)
"RTN","ORCHECK",108,0)
 S Y=$P(ORNDF,U,3)_"^^99NDF^"_ORDD_U_$$NAME50^ORPEAPI(ORDD)_"^99PSD"
"RTN","ORCHECK",109,0)
 Q Y
"RTN","ORCHECK",110,0)
 ;
"RTN","ORCHECK",111,0)
IV() ; -- Get Dispense Drug for IV orderable
"RTN","ORCHECK",112,0)
 N PSOI,TYPE,VOL,ORY
"RTN","ORCHECK",113,0)
 S PSOI=+$P($G(^ORD(101.43,+OI,0)),U,2),VOL=""
"RTN","ORCHECK",114,0)
 S TYPE=$S(PTR=$$PTR^ORCD("OR GTX ADDITIVE"):"A",1:"B")
"RTN","ORCHECK",115,0)
 S:TYPE="B" VOL=$S($G(IFN):$$VALUE^ORCSAVE2(IFN,"VOLUME"),1:+$G(ORDIALOG($$PTR^ORCD("OR GTX VOLUME"),1)))
"RTN","ORCHECK",116,0)
 D ENDDIV^PSJORUTL(PSOI,TYPE,VOL,.ORY)
"RTN","ORCHECK",117,0)
 Q +$G(ORY)
"RTN","ORCHECK",118,0)
 ;
"RTN","ORCHECK",119,0)
LIST(IFN) ; -- Displays list of ORCHECK(IFN) checks
"RTN","ORCHECK",120,0)
 N ORI,ORJ,ORZ,ORMAX,ORTX,ON,OFF
"RTN","ORCHECK",121,0)
 S ORZ=0 F  S ORZ=$O(ORCHECK(IFN,ORZ)) Q:ORZ'>0  D
"RTN","ORCHECK",122,0)
 . S:ORZ=1 ON=IOINHI,OFF=IOINORM S:ORZ'=1 (ON,OFF)="" ; use bold if High
"RTN","ORCHECK",123,0)
 . S ORI=0 F  S ORI=$O(ORCHECK(IFN,ORZ,ORI)) Q:ORI'>0  D
"RTN","ORCHECK",124,0)
 . . S X=$P(ORCHECK(IFN,ORZ,ORI),U,3) I $L(X)<75 W !,ON_">>>  "_X_OFF Q
"RTN","ORCHECK",125,0)
 . . S ORMAX=74 K ORTX D TXT^ORCHTAB Q:'$G(ORTX)  ; wrap
"RTN","ORCHECK",126,0)
 . . F ORJ=1:1:ORTX W !,ON_$S(ORJ=1:">>>  ",1:"      ")_ORTX(ORJ)_OFF
"RTN","ORCHECK",127,0)
 W !
"RTN","ORCHECK",128,0)
 Q
"RTN","ORCHECK",129,0)
 ;
"RTN","ORCHECK",130,0)
CANCEL() ; -- Returns 1 or 0: Cancel order(s)?
"RTN","ORCHECK",131,0)
 N X,Y,DIR,NUM
"RTN","ORCHECK",132,0)
 S NUM=+$G(ORCHECK("IFN")),DIR(0)="YA"
"RTN","ORCHECK",133,0)
 S DIR("A")="Do you want to cancel "_$S(NUM>1:"any of the new orders? ",1:"the new order? ")
"RTN","ORCHECK",134,0)
 S DIR("?",1)="Enter YES to cancel "_$S(NUM>1:"an",1:"the")_" order.  If you wish to override these order checks"
"RTN","ORCHECK",135,0)
 S DIR("?",2)="and release "_$S(NUM>1:"these orders",1:"this order")_", enter NO; you will be prompted for a justification",DIR("?")="if there are any highlighted critical order checks."
"RTN","ORCHECK",136,0)
 D ^DIR
"RTN","ORCHECK",137,0)
 Q +Y
"RTN","ORCHECK",138,0)
 ;
"RTN","ORCHECK",139,0)
REASON() ; -- Reason for overriding order checks
"RTN","ORCHECK",140,0)
 ; I '$D(^XUSEC("ORES",DUZ)),'$D(^XUSEC("ORELSE",DUZ)) Q  ??
"RTN","ORCHECK",141,0)
 N X,Y,DIR
"RTN","ORCHECK",142,0)
 S DIR(0)="FA^2:80^K:X?1."" "" X",DIR("A")="REASON FOR OVERRIDE: "
"RTN","ORCHECK",143,0)
 S DIR("?")="Enter a justification for overriding these order checks, up to 80 characters"
"RTN","ORCHECK",144,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT) S Y="^"
"RTN","ORCHECK",145,0)
 Q Y
"RTN","ORCHECK",146,0)
OCAPI(IFN,ORPLACE) ;IA #4859
"RTN","ORCHECK",147,0)
 ;API to get the order checking info for a specific order (IFN)
"RTN","ORCHECK",148,0)
 ;info is stored in ^TMP($J,ORPLACE)
"RTN","ORCHECK",149,0)
 ;               ^TMP($J,ORPLACE,D0,"OC LEVEL")="order check level"
"RTN","ORCHECK",150,0)
 ;                                                 ,"OC TEXT")="order check text"
"RTN","ORCHECK",151,0)
 ;                                                 ,"OR REASON")="over ride reason text"
"RTN","ORCHECK",152,0)
 ;                                                 ,"OR PROVIDER")="provider DUZ who entered over ride reason"
"RTN","ORCHECK",153,0)
 ;                                                 ,"OR DT")="date/time over ride reason was entered"
"RTN","ORCHECK",154,0)
 ; NOTE on OC LEVEL: 1 is HIGH, 2 is MODERATE, 3 is LOW
"RTN","ORCHECK",155,0)
 I '$D(^OR(100,IFN,9)) Q
"RTN","ORCHECK",156,0)
 N I
"RTN","ORCHECK",157,0)
 S I=0 F  S I=$O(^OR(100,IFN,9,I)) Q:'I  D
"RTN","ORCHECK",158,0)
 .S ^TMP($J,ORPLACE,I,"OC LEVEL")=$P($G(^OR(100,IFN,9,I,0)),U,2)
"RTN","ORCHECK",159,0)
 .S ^TMP($J,ORPLACE,I,"OC TEXT")=$G(^OR(100,IFN,9,I,1))
"RTN","ORCHECK",160,0)
 .S ^TMP($J,ORPLACE,I,"OR REASON")=$P($G(^OR(100,IFN,9,I,0)),U,4)
"RTN","ORCHECK",161,0)
 .S ^TMP($J,ORPLACE,I,"OR PROVIDER")=$P($G(^OR(100,IFN,9,I,0)),U,5)
"RTN","ORCHECK",162,0)
 .S ^TMP($J,ORPLACE,I,"OR DT")=$P($G(^OR(100,IFN,9,I,0)),U,6)
"RTN","ORCHECK",163,0)
 Q
"RTN","ORCMED")
0^213^B41444759
"RTN","ORCMED",1,0)
ORCMED ;SLC/MKB-Medication actions ;03/19/07
"RTN","ORCMED",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,7,38,48,94,141,178,190,195,243**;Dec 17, 1997;Build 242
"RTN","ORCMED",3,0)
XFER ; -- transfer to in/outpt meds
"RTN","ORCMED",4,0)
 N ORPTLK,ORTYPE,ORXFER,ORSRC,ORCAT,OREVENT,X,ORINPT,ORIDLG,ORODLG,ORIVDLG,ORNMSP,ORCNT,ORI,NMBR,ORIFN,OLDIFN,ORDIALOG,ORDG,ORCHECK,ORQUIT,ORDUZ,ORLOG,FIRST,ORDITM,ORD,ORERR
"RTN","ORCMED",5,0)
 S ORPTLK=$$LOCK^ORX2(+ORVP) I 'ORPTLK D  G XFQ ; lock pt chart
"RTN","ORCMED",6,0)
 . W !!,$C(7),$P(ORPTLK,U,2) H 2
"RTN","ORCMED",7,0)
 . S:'$D(VALMBCK) VALMBCK=""
"RTN","ORCMED",8,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("transfer") G:'ORNMBR XFQ
"RTN","ORCMED",9,0)
 D FULL^VALM1 S VALMBCK="R",ORTYPE="Q",ORXFER=1,ORDUZ=DUZ,ORSRC="X"
"RTN","ORCMED",10,0)
 S X=$P($P($G(^TMP("OR",$J,"CURRENT",0)),U,3),";",3) S:X="" X=$G(ORWARD)
"RTN","ORCMED",11,0)
 S ORCAT=$S(X:"O",1:"I") I ORCAT="I"!$G(ORWARD) D  Q:$G(OREVENT)="^"
"RTN","ORCMED",12,0)
 . W !!,$$CURRENT^OREVNT
"RTN","ORCMED",13,0)
 . S X=$$DELAY^ORCACT I X="^" S OREVENT="^" Q
"RTN","ORCMED",14,0)
 . S:X OREVENT=+$$PTEVENT^OREVNT(+ORVP,1)
"RTN","ORCMED",15,0)
 I '$G(ORL) S ORL=$S($G(OREVENT):$$LOC^OREVNTX(OREVENT),1:$$LOCATION^ORCMENU1) G:ORL="^" XFQ
"RTN","ORCMED",16,0)
 S ORINPT=$$INPT^ORCD,ORNP=$$PROVIDER^ORCMENU1 G:ORNP="^" XFQ
"RTN","ORCMED",17,0)
 I 'ORINPT,ORCAT="I" D IMOLOC^ORIMO(.ORINPT,+ORL,+ORVP) S:ORINPT<0 ORINPT=0 ;allow inpt meds at this location?
"RTN","ORCMED",18,0)
 S ORIDLG=+$O(^ORD(101.41,"AB","PSJ OR PAT OE",0))
"RTN","ORCMED",19,0)
 S ORODLG=+$O(^ORD(101.41,"AB","PSO OERR",0))
"RTN","ORCMED",20,0)
 S ORIVDLG=+$O(^ORD(101.41,"AB","PSJI OR PAT FLUID OE",0))
"RTN","ORCMED",21,0)
 D PROVIDER^ORCDPSIV G:$G(ORQUIT) XFQ ;X:$D(^ORD(101.41,ORDIALOG,3)) ^(3)
"RTN","ORCMED",22,0)
 S ORNMSP="PS" D DISPLAY^ORCHECK
"RTN","ORCMED",23,0)
 S ORCNT=$L(ORNMBR,",") S:$P(ORNMBR,",",ORCNT)'>0 ORCNT=ORCNT-1
"RTN","ORCMED",24,0)
XF1 F ORI=1:1:ORCNT S NMBR=$P(ORNMBR,",",ORI) D:NMBR  I $D(ORQUIT),ORI<ORCNT Q:'$$CONT  ;if not last one, ask
"RTN","ORCMED",25,0)
 . K ORIFN,ORDIALOG,ORDG,ORDOSE,ORCHECK,ORQUIT,ORERR
"RTN","ORCMED",26,0)
 . K ^TMP("PSJMR",$J),^TMP("ORWORD",$J),^TMP("ORSIG",$J)
"RTN","ORCMED",27,0)
 . S OLDIFN=+$P($G(^TMP("OR",$J,ORTAB,"IDX",NMBR)),U,4)
"RTN","ORCMED",28,0)
 . S ORDITM=$$ORDITEM^ORCACT(OLDIFN) D SUBHDR^ORCACT(ORDITM)
"RTN","ORCMED",29,0)
 . I '$$VALID^ORCACT0(OLDIFN,"XFR",.ORERR) W !,ORERR H 2 Q
"RTN","ORCMED",30,0)
 . S ORD=$P($G(^OR(100,OLDIFN,0)),U,5) Q:ORD'["101.41"  ;error msg?
"RTN","ORCMED",31,0)
 . S ORDIALOG=$S(+ORD=ORIVDLG:ORIVDLG,ORCAT="I":ORIDLG,1:ORODLG)
"RTN","ORCMED",32,0)
 . S ORDG=+$P($G(^ORD(101.41,ORDIALOG,0)),U,5)
"RTN","ORCMED",33,0)
 . D GETDLG^ORCD(ORDIALOG),GETORDER^ORCD(OLDIFN)
"RTN","ORCMED",34,0)
 . I ORDIALOG'=ORIVDLG D OUT:ORCAT="I",IN:ORCAT="O" ;convert data
"RTN","ORCMED",35,0)
 . K ORDIALOG($$PTR^ORCD("OR GTX START DATE/TIME"),1)
"RTN","ORCMED",36,0)
 . K ORDIALOG($$PTR^ORCD("OR GTX NOW"),1)
"RTN","ORCMED",37,0)
 . S ORLOG=+$E($$NOW^XLFDT,1,12),FIRST=1
"RTN","ORCMED",38,0)
XF2 . D DIALOG^ORCDLG Q:$G(ORQUIT)&FIRST  K ORQUIT
"RTN","ORCMED",39,0)
 . D ACCEPT^ORCHECK(),DISPLAY^ORCDLG S X=$$OK^ORCDLG I X="^" S ORQUIT=1 Q
"RTN","ORCMED",40,0)
 . I X="E" K ORCHECK S FIRST=0 G XF2
"RTN","ORCMED",41,0)
 . I X="C" W !?10,"... order cancelled.",! Q
"RTN","ORCMED",42,0)
 . I X="P" D
"RTN","ORCMED",43,0)
 . . D EN^ORCSAVE W !?10,$S(ORIFN:"... order placed.",1:"ERROR"),!
"RTN","ORCMED",44,0)
 . . S:$G(ORIFN) ^TMP("ORNEW",$J,ORIFN,1)=""
"RTN","ORCMED",45,0)
 . . I '$D(^TMP("ORECALL",$J,ORDIALOG)) M ^(ORDIALOG)=ORDIALOG M:$D(^TMP("ORWORD",$J)) ^TMP("ORECALL",$J,ORDIALOG)=^TMP("ORWORD",$J) ;save 1st values
"RTN","ORCMED",46,0)
XFQ D EXIT^ORCDPS1 ;X:$D(^ORD(101.41,ORDIALOG,4)) ^(4)
"RTN","ORCMED",47,0)
 K ^TMP("ORWORD",$J),^TMP("ORSIG",$J)
"RTN","ORCMED",48,0)
 D:'$D(^TMP("ORNEW",$J)) UNLOCK^ORX2(+ORVP) ;unlock if no new orders
"RTN","ORCMED",49,0)
 Q
"RTN","ORCMED",50,0)
 ;
"RTN","ORCMED",51,0)
IN ; -- Kill extra values, Reset ID's/DD from Inpt dialog
"RTN","ORCMED",52,0)
 N P F P="START DATE/TIME","NOW" K ORDIALOG($$PTR(P),1)
"RTN","ORCMED",53,0)
 D DOSES("O")
"RTN","ORCMED",54,0)
 Q
"RTN","ORCMED",55,0)
 ;
"RTN","ORCMED",56,0)
OUT ; -- Kill extra values, Reset ID's/DD from Outpt dialog
"RTN","ORCMED",57,0)
 N P I '$O(ORDIALOG($$PTR("INSTRUCTIONS"),0)) D  ;old sig in comments
"RTN","ORCMED",58,0)
 . N WP S WP=$$PTR("WORD PROCESSING 1") K ^TMP("ORSIG",$J)
"RTN","ORCMED",59,0)
 . M ^TMP("ORSIG",$J)=^TMP("ORWORD",$J,WP,1)
"RTN","ORCMED",60,0)
 . K ORDIALOG(WP,1),^TMP("ORWORD",$J,WP,1)
"RTN","ORCMED",61,0)
 F P="PATIENT INSTRUCTIONS","START DATE/TIME","DAYS SUPPLY","QUANTITY","REFILLS","ROUTING","SERVICE CONNECTED" K ORDIALOG($$PTR(P),1)
"RTN","ORCMED",62,0)
 I $G(ORDIALOG($$PTR("URGENCY"),1))=99 K ORDIALOG($$PTR("URGENCY"),1)
"RTN","ORCMED",63,0)
 D DOSES("I")
"RTN","ORCMED",64,0)
 Q
"RTN","ORCMED",65,0)
 ;
"RTN","ORCMED",66,0)
DOSES(TYPE)     ; -- Convert doses to new TYPE, reset ID strings
"RTN","ORCMED",67,0)
 N PSOI,ORMED,PROMPT,DOSE,DRUG,I,X,DD,DRUG0,STR
"RTN","ORCMED",68,0)
 F I="DISPENSE DRUG","STRENGTH","DRUG NAME","SIG" K ORDIALOG($$PTR(I),1)
"RTN","ORCMED",69,0)
 S PSOI=+$P($G(^ORD(101.43,+$G(ORDIALOG($$PTR("ORDERABLE ITEM"),1)),0)),U,2),ORMED=$P($G(^(0)),U)
"RTN","ORCMED",70,0)
 D DOSE^PSSORUTL(.ORDOSE,PSOI,TYPE,+ORVP) I $G(ORDOSE(1))=-1 K ORDOSE
"RTN","ORCMED",71,0)
 S PROMPT=$$PTR("INSTRUCTIONS"),DOSE=$$PTR("DOSE")
"RTN","ORCMED",72,0)
 S DRUG=$$PTR("DISPENSE DRUG") D D1^ORCDPS2
"RTN","ORCMED",73,0)
 S I=0 F  S I=$O(ORDIALOG(PROMPT,I)) Q:I'>0  D
"RTN","ORCMED",74,0)
 . K ORDIALOG(DOSE,I) S X=$G(ORDIALOG(PROMPT,I)) Q:'$L(X)
"RTN","ORCMED",75,0)
 . S X=$$UP^XLFSTR(X),DD=+$G(ORDIALOG(PROMPT,"LIST","D",X)) Q:'DD
"RTN","ORCMED",76,0)
 . S ORDIALOG(DOSE,I)=$TR($G(ORDOSE("DD",DD,X)),"^","&")
"RTN","ORCMED",77,0)
 . S ORDIALOG(DRUG,I)=DD,DRUG0=$G(ORDOSE("DD",DD))
"RTN","ORCMED",78,0)
 . S STR=$P(DRUG0,U,5)_$P(DRUG0,U,6)
"RTN","ORCMED",79,0)
 . I STR'>0 S:'$G(ORDOSE(1)) ORDIALOG($$PTR("DRUG NAME"),1)=$P(DRUG0,U) Q
"RTN","ORCMED",80,0)
 . I ORMED'[STR,TYPE="O"!'$G(ORDOSE(1)) S ORDIALOG($$PTR("STRENGTH"),1)=STR
"RTN","ORCMED",81,0)
 Q
"RTN","ORCMED",82,0)
 ;
"RTN","ORCMED",83,0)
CONT() ; -- Want to continue processing orders?
"RTN","ORCMED",84,0)
 N X,Y,DIR
"RTN","ORCMED",85,0)
 S DIR(0)="YA",DIR("A")="Do you want to continue transferring orders? ",DIR("B")="YES"
"RTN","ORCMED",86,0)
 S DIR("?")="Enter YES to continue transferring the remaining orders selected, or NO to quit this option."
"RTN","ORCMED",87,0)
 D ^DIR
"RTN","ORCMED",88,0)
 Q +Y
"RTN","ORCMED",89,0)
 ;
"RTN","ORCMED",90,0)
SHOWSIG ; -- Show old sig for transfer in ^TMP("ORSIG",$J)
"RTN","ORCMED",91,0)
 N ORTX,I,X,ORMAX S ORMAX=72
"RTN","ORCMED",92,0)
 S I=0 F  S I=$O(^TMP("ORSIG",$J,I)) Q:I'>0  S X=$G(^(I,0)) D:$L(X) TXT^ORCHTAB
"RTN","ORCMED",93,0)
 S I=0 F  S I=$O(ORTX(I)) Q:I'>0  W !,$S(I=1:"(Sig: ",1:"      ")_ORTX(I)
"RTN","ORCMED",94,0)
 W ")"
"RTN","ORCMED",95,0)
 Q
"RTN","ORCMED",96,0)
 ;
"RTN","ORCMED",97,0)
PTR(NAME) ; -- Returns pointer to OR GTX NAME
"RTN","ORCMED",98,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_NAME,1,63),0))
"RTN","ORCMED",99,0)
 ;
"RTN","ORCMED",100,0)
REFILLS ; -- Request a refill for med orders
"RTN","ORCMED",101,0)
 ;    ORNMBR = #,#,...,# of selected orders
"RTN","ORCMED",102,0)
 ;
"RTN","ORCMED",103,0)
 N ORLK,ORI,NMBR,IDX,ORIFN,ORDITM,ORERR,ORQUIT,OROUT
"RTN","ORCMED",104,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("") G:'ORNMBR RFQ
"RTN","ORCMED",105,0)
 D FREEZE^ORCMENU S VALMBCK="R"
"RTN","ORCMED",106,0)
 S ORNP=$$PROVIDER^ORCMENU1 G:ORNP="^" RFQ
"RTN","ORCMED",107,0)
 S:'$G(ORL) ORL=$$LOCATION^ORCMENU1 G:ORL="^" RFQ
"RTN","ORCMED",108,0)
 S OROUT=$$ROUTING G:OROUT="^" RFQ
"RTN","ORCMED",109,0)
 F ORI=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",ORI) D:NMBR  Q:$D(ORQUIT)
"RTN","ORCMED",110,0)
 . S IDX=$G(^TMP("OR",$J,"CURRENT","IDX",NMBR)),ORIFN=+$P(IDX,U,4)
"RTN","ORCMED",111,0)
 . Q:'ORIFN  I '$D(^OR(100,ORIFN,0)) W !,"Invalid order number!" H 2 Q
"RTN","ORCMED",112,0)
 . S ORDITM=$$ORDITEM^ORCACT(ORIFN) D SUBHDR^ORCACT(ORDITM)
"RTN","ORCMED",113,0)
 . I '$$VALID^ORCACT0(ORIFN,"RF",.ORERR) W !,ORERR H 2 Q
"RTN","ORCMED",114,0)
 . S ORLK=$$LOCK1^ORX2(+ORIFN) I 'ORLK W !,$P(ORLK,U,2) H 2 Q
"RTN","ORCMED",115,0)
 . D REF^ORMBLDPS(ORIFN,OROUT),UNLK1^ORX2(+ORIFN)
"RTN","ORCMED",116,0)
 . W !?10,"... refill requested.",$$RETURN
"RTN","ORCMED",117,0)
RFQ Q
"RTN","ORCMED",118,0)
 ;
"RTN","ORCMED",119,0)
RETURN() ; -- press return to cont
"RTN","ORCMED",120,0)
 N X W !,"Press <return> to continue ..." R X:DTIME
"RTN","ORCMED",121,0)
 Q ""
"RTN","ORCMED",122,0)
 ;
"RTN","ORCMED",123,0)
ROUTING() ; -- Routing for refill
"RTN","ORCMED",124,0)
 N X,Y,DIR S DIR(0)="SAM^W:WINDOW;M:MAIL;C:ADMINISTERED IN CLINIC;"
"RTN","ORCMED",125,0)
 S DIR("A")="Routing: ",DIR("B")=$S($D(^PSX(550,"C")):"MAIL",1:"WINDOW")
"RTN","ORCMED",126,0)
 S DIR("?")="Select how the patient is to receive this refill, by mail or at the window or in the clinic"
"RTN","ORCMED",127,0)
 D ^DIR S:$D(DTOUT)!(X["^") Y="^"
"RTN","ORCMED",128,0)
 Q Y
"RTN","ORCMED",129,0)
 ;
"RTN","ORCMED",130,0)
NW ; -- Order New Medication from Meds tab
"RTN","ORCMED",131,0)
 ;    Requires ORDIALOG      = name of pkg dialog
"RTN","ORCMED",132,0)
 ;             OREVENT       = event, if delaying orders
"RTN","ORCMED",133,0)
 ;             OREVENT("TS") = treating spec, if admission or transfer
"RTN","ORCMED",134,0)
 N ORPTLK G:'$L($G(ORDIALOG)) NWQ
"RTN","ORCMED",135,0)
 S ORPTLK=$$LOCK^ORX2(+ORVP) I 'ORPTLK W !!,$C(7),$P(ORPTLK,U,2) H 2 Q
"RTN","ORCMED",136,0)
 D FREEZE^ORCMENU S VALMBCK="R"
"RTN","ORCMED",137,0)
 S ORNP=$$PROVIDER^ORCMENU1 G:ORNP="^" NWQ
"RTN","ORCMED",138,0)
 I '$G(ORL) S ORL=$S($G(OREVENT):$$LOC^OREVNTX(OREVENT),1:$$LOCATION^ORCMENU1) G:ORL["^" NWQ
"RTN","ORCMED",139,0)
 S ORDIALOG=$O(^ORD(101.41,"AB",$E(ORDIALOG,1,63),0)) G:'ORDIALOG NWQ
"RTN","ORCMED",140,0)
 D ADD^ORCDLG,REBLD^ORCMENU:$D(^TMP("ORNEW",$J))
"RTN","ORCMED",141,0)
 K ORDIALOG,^TMP("ORWORD",$J),^TMP("ORECALL",$J) S VALMBCK="R"
"RTN","ORCMED",142,0)
NWQ D:'$D(^TMP("ORNEW",$J)) UNLOCK^ORX2(+ORVP) ;unlock if no new orders
"RTN","ORCMED",143,0)
 Q
"RTN","ORCMEDT0")
0^188^B17512805
"RTN","ORCMEDT0",1,0)
ORCMEDT0 ;SLC/MKB-Dialog Utilities ;08/06/2007
"RTN","ORCMEDT0",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**46,60,190,215,243**;Dec 17, 1997;Build 242
"RTN","ORCMEDT0",3,0)
DIALOG(TYPE) ; -- Get Dialog file entry
"RTN","ORCMEDT0",4,0)
 N X,Y,Z,D,DIC,DIE,DIK,DA,DR,DLAYGO,ORPKG,ORDLG,ORIT,OROI,I,IDX
"RTN","ORCMEDT0",5,0)
 S ORPKG="ORDER ENTRY/RESULTS REPORTING",DIC="^ORD(101.41,",DIC(0)="AEQLZ"
"RTN","ORCMEDT0",6,0)
 S DIC("S")="I $P(^(0),U,4)="""_TYPE_"""",DLAYGO=101.41
"RTN","ORCMEDT0",7,0)
 S DIC("A")="Select "_$S(TYPE="Q":"QUICK ORDER",TYPE="O":"ORDER SET",TYPE="A":"ACTION",1:"ORDER DIALOG")_" NAME: "
"RTN","ORCMEDT0",8,0)
 S DIC("DR")="4///"_TYPE_$S(TYPE="D":";7///^S X=ORPKG",1:"")
"RTN","ORCMEDT0",9,0)
D0 S D="AB" D IX^DIC I Y'>0 S ORDLG="^" G DQ
"RTN","ORCMEDT0",10,0)
 S ORDLG=+Y,ORDG=$P(Y(0),U,5) G:'$P(Y,U,3) DQ ; not a new entry
"RTN","ORCMEDT0",11,0)
 I $O(^ORD(101.41,"AB",$P(Y,U,2),0))'=+Y W $C(7),!,"Another entry already exists by this name!",! D DEL(+Y) G D0
"RTN","ORCMEDT0",12,0)
 I TYPE="D" D  G:ORDLG="^" DQ ;new dialog
"RTN","ORCMEDT0",13,0)
 . S DA=ORDLG,DR="5R",DIE=DIC,ORIT=$P(Y,U,2) D ^DIE
"RTN","ORCMEDT0",14,0)
 . S ORDG=+$P($G(^ORD(101.41,ORDLG,0)),U,5)
"RTN","ORCMEDT0",15,0)
 . I 'ORDG W $C(7),!,"Deleting <"_ORIT_"> ..." S DA=ORDLG,DIK=DIC D ^DIK S ORDLG="^" Q
"RTN","ORCMEDT0",16,0)
 . S ORIT=$$OI^ORCMEDT3(+ORDG) S:ORIT="^" ORDLG="^"
"RTN","ORCMEDT0",17,0)
 I TYPE="Q" D  G DQ ;new quick order
"RTN","ORCMEDT0",18,0)
 . S DIC="^ORD(100.98,",DIC(0)="AEQM",DIC("S")="I $P(^(0),U,4)"
"RTN","ORCMEDT0",19,0)
 . S DIC("A")="TYPE OF QUICK ORDER: " D ^DIC
"RTN","ORCMEDT0",20,0)
 . I Y>0 S ORDG=+Y,$P(^ORD(101.41,ORDLG,0),U,5)=+Y Q
"RTN","ORCMEDT0",21,0)
 . W !,$P(^ORD(101.41,ORDLG,0),U)_" quick order dialog DELETED!",!
"RTN","ORCMEDT0",22,0)
 . S DA=ORDLG,DIK="^ORD(101.41,",ORDLG="^" D ^DIK
"RTN","ORCMEDT0",23,0)
D1 I $$COPY^ORCMEDIT(TYPE) D  ;copy an existing dialog?
"RTN","ORCMEDT0",24,0)
 . K DLAYGO,DIC("B") S DIC(0)="AEQZ",DIC("A")="Select "_$S(TYPE="Q":"QUICK ORDER",TYPE="O":"ORDER SET",1:"ORDER DIALOG")_" TO COPY: "
"RTN","ORCMEDT0",25,0)
 . D ^DIC Q:Y'>0  W !,"Copying ..."
"RTN","ORCMEDT0",26,0)
 . F I=2,6,8,9 S $P(^ORD(101.41,ORDLG,0),U,I)=$P(Y(0),U,I)
"RTN","ORCMEDT0",27,0)
 . S:TYPE'="D" $P(^ORD(101.41,ORDLG,0),U,5)=$P(Y(0),U,5) ;skip DG if Dlg
"RTN","ORCMEDT0",28,0)
 . S:$L($P(Y(0),U,2)) ^ORD(101.41,"C",$$UP^XLFSTR($P(Y(0),U,2)),ORDLG)="" ;disp text
"RTN","ORCMEDT0",29,0)
 . F I=2,3,3.1,4,5,6,7,9,10 I $D(^ORD(101.41,+Y,I)) M ^ORD(101.41,ORDLG,I)=^ORD(101.41,+Y,I)
"RTN","ORCMEDT0",30,0)
 . I $P(Y(0),U,7) S DA=ORDLG,DIE=DIC,DR="7///"_$P(Y(0),U,7) D ^DIE
"RTN","ORCMEDT0",31,0)
 . K DA S DA(1)=ORDLG,DIK="^ORD(101.41,"_ORDLG_",10,",DIK(1)="2^AD" D ENALL^DIK
"RTN","ORCMEDT0",32,0)
D2 I TYPE="D",$G(ORIT) D  ;stuff in default OI
"RTN","ORCMEDT0",33,0)
 . S DA=ORDLG,DR="2///"_$P(ORIT,U,2),DIE="^ORD(101.41," D ^DIE
"RTN","ORCMEDT0",34,0)
 . S OROI=$$PTR^ORCD("OR GTX ORDERABLE ITEM"),DA=$O(^ORD(101.41,ORDLG,10,"D",OROI,0)) I 'DA D  Q:'DA  ;create OI prompt
"RTN","ORCMEDT0",35,0)
 .. S X=+$O(^ORD(101.41,ORDLG,10,"B",0)),X=$S(X=0:1,1:X-.1) ;get Seq#
"RTN","ORCMEDT0",36,0)
 .. K DA,DIC S DIC="^ORD(101.41,"_ORDLG_",10,",DIC(0)="L",DA(1)=ORDLG
"RTN","ORCMEDT0",37,0)
 .. D ^DIC Q:Y'>0  S DA=+Y ;S DIC("P")=$P(^DD(101.41,10,0),U,2)
"RTN","ORCMEDT0",38,0)
 .. S Z=+$O(^ORD(101.41,ORDLG,10,"ATXT",0)),Z=$S(Z=0:1,1:Z-.1) ;TxtSeq#
"RTN","ORCMEDT0",39,0)
 .. S ^ORD(101.41,ORDLG,10,DA,0)=X_U_OROI_"^^Order: ^^1",^(2)=Z
"RTN","ORCMEDT0",40,0)
 .. S ^ORD(101.41,"AD",OROI,ORDLG,DA)="",^ORD(101.41,ORDLG,10,"B",X,DA)="",^ORD(101.41,ORDLG,10,"D",OROI,DA)="",^ORD(101.41,ORDLG,10,"ATXT",X,DA)=""
"RTN","ORCMEDT0",41,0)
 . S IDX="S."_$P($G(^ORD(100.98,+ORDG,0)),U,3)
"RTN","ORCMEDT0",42,0)
 . S $P(^ORD(101.41,ORDLG,10,DA,0),U,8)=1,$P(^(0),U,10)=IDX,^(3)="I 0 ;uneditable",^(7)="S Y="_+ORIT
"RTN","ORCMEDT0",43,0)
DQ Q ORDLG
"RTN","ORCMEDT0",44,0)
 ;
"RTN","ORCMEDT0",45,0)
DEL(DA) ; -- delete bad entry in Order Dialog file
"RTN","ORCMEDT0",46,0)
 N DIK S DIK="^ORD(101.41," D:$G(DA) ^DIK
"RTN","ORCMEDT0",47,0)
 Q
"RTN","ORCMEDT0",48,0)
 ;
"RTN","ORCMEDT0",49,0)
SAVE ; -- Save ORDG, responses in ORDIALOG to dialog ORQDLG
"RTN","ORCMEDT0",50,0)
 N PROMPT,CNT,ITM,TYPE,INST,VALUE,INP,UD K ^ORD(101.41,ORQDLG,6)
"RTN","ORCMEDT0",51,0)
 S (PROMPT,CNT)=0 F  S PROMPT=$O(ORDIALOG(PROMPT)) Q:PROMPT'>0  D
"RTN","ORCMEDT0",52,0)
 . S ITM=ORDIALOG(PROMPT),TYPE=$E(ORDIALOG(PROMPT,0))
"RTN","ORCMEDT0",53,0)
 . S INST=0 F  S INST=$O(ORDIALOG(PROMPT,INST)) Q:INST'>0  D
"RTN","ORCMEDT0",54,0)
 . . S VALUE=$G(ORDIALOG(PROMPT,INST)),CNT=CNT+1
"RTN","ORCMEDT0",55,0)
 . . S ^ORD(101.41,ORQDLG,6,CNT,0)=+ITM_U_PROMPT_U_INST
"RTN","ORCMEDT0",56,0)
 . . S:TYPE'="W" ^ORD(101.41,ORQDLG,6,CNT,1)=VALUE
"RTN","ORCMEDT0",57,0)
 . . M:TYPE="W" ^ORD(101.41,ORQDLG,6,CNT,2)=@VALUE
"RTN","ORCMEDT0",58,0)
 . . S ^ORD(101.41,ORQDLG,6,"D",PROMPT,CNT)=""
"RTN","ORCMEDT0",59,0)
 S ^ORD(101.41,ORQDLG,6,0)="^101.416^"_CNT_U_CNT
"RTN","ORCMEDT0",60,0)
 S INP=+$O(^ORD(100.98,"B","INPATIENT MEDICATIONS",""))
"RTN","ORCMEDT0",61,0)
 S UD=+$O(^ORD(100.98,"B","UNIT DOSE MEDICATIONS",""))
"RTN","ORCMEDT0",62,0)
 I +$G(ORDG)>0,ORDG=INP,UD>0 S ORDG=UD
"RTN","ORCMEDT0",63,0)
 S:$G(ORDG) $P(^ORD(101.41,ORQDLG,0),U,5)=+ORDG
"RTN","ORCMEDT0",64,0)
 Q
"RTN","ORCMEDT0",65,0)
 ;
"RTN","ORCMEDT0",66,0)
ITEM(Z) ; -- Select new item to add
"RTN","ORCMEDT0",67,0)
 N X,Y,DIC,ORDDF,ORERR,I
"RTN","ORCMEDT0",68,0)
 S DIC=101.41,DIC(0)="AEQM",DIC("A")="ITEM: "
"RTN","ORCMEDT0",69,0)
 I $G(Z) S Z=$P($G(^ORD(101.41,+Z,0)),U) S:$L(Z) DIC("B")=Z
"RTN","ORCMEDT0",70,0)
 S DIC("S")="I $P(^(0),U,4)'=""P"""
"RTN","ORCMEDT0",71,0)
IT1 D ^DIC I Y'>0 S Y=$S($D(DUOUT)!$D(DTOUT):"^",1:"") Q Y
"RTN","ORCMEDT0",72,0)
 D RECURSV^ORCMEDT5(+Y,+ORMENU,.ORERR) I $D(ORERR) D  G IT1
"RTN","ORCMEDT0",73,0)
 . W $C(7),!!,"An ancestor of this menu may not be added as an item!"
"RTN","ORCMEDT0",74,0)
 . W !,ORERR S I=0 F  S I=$O(ORERR(I)) Q:I'>0  W !?18," =>"_ORERR(I)
"RTN","ORCMEDT0",75,0)
 Q +Y
"RTN","ORCMEDT1")
0^215^B44493328
"RTN","ORCMEDT1",1,0)
ORCMEDT1 ;SLC/MKB-QO,Set editor ;02/25/08
"RTN","ORCMEDT1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**8,46,57,95,110,245,243**;Dec 17, 1997;Build 242
"RTN","ORCMEDT1",3,0)
OI ; -- Enter/edit generic orderable items
"RTN","ORCMEDT1",4,0)
 N X,Y,DA,DR,DIE,DIC,ID,DLAYGO,ORDG
"RTN","ORCMEDT1",5,0)
 F  S ORDG=$$DGRP Q:ORDG'>0  D  W !!
"RTN","ORCMEDT1",6,0)
 . F  S D="S."_$P(ORDG,U,4) D   Q:Y'>0  S DA=+Y,ID=DA_";99ORD",DR=".01"_$S($P(Y,U,3):";2///^S X=ID;5////"_+ORDG,1:"") D ^DIE W ! ;110
"RTN","ORCMEDT1",7,0)
 .. S DIC="^ORD(101.43,",DIC(0)="AEQL",DLAYGO=101.43,DIE=DIC D IX^DIC ;110
"RTN","ORCMEDT1",8,0)
 Q
"RTN","ORCMEDT1",9,0)
 ;
"RTN","ORCMEDT1",10,0)
DGRP() ; -- Returns sub-display group of Nursing or Other for generic OI
"RTN","ORCMEDT1",11,0)
 N X,Y,DIC,ORGRP,ORDG,ORI
"RTN","ORCMEDT1",12,0)
 F ORI="NURS","OTHER" S ORDG=+$O(^ORD(100.98,"B",ORI,0)) D DG^ORCHANG1(ORDG,"BILD",.ORGRP)
"RTN","ORCMEDT1",13,0)
 S DIC="^ORD(100.98,",DIC(0)="AEQ",DIC("S")="I $D(ORGRP(+Y))"
"RTN","ORCMEDT1",14,0)
 S DIC("A")="Type of Orderable: " D ^DIC
"RTN","ORCMEDT1",15,0)
 S:Y>0 Y=+Y_U_$G(^ORD(100.98,+Y,0))
"RTN","ORCMEDT1",16,0)
 Q Y
"RTN","ORCMEDT1",17,0)
 ;
"RTN","ORCMEDT1",18,0)
QUICK ; -- Enter/edit quick order dialogs
"RTN","ORCMEDT1",19,0)
 N ORQDLG,ORDG
"RTN","ORCMEDT1",20,0)
 F  S ORQDLG=$$DIALOG^ORCMEDT0("Q") Q:ORQDLG="^"  D QCK0(ORQDLG) W !
"RTN","ORCMEDT1",21,0)
 Q
"RTN","ORCMEDT1",22,0)
QCK0(ORQDLG) ; -- edit quick order ORQDLG
"RTN","ORCMEDT1",23,0)
 N ORDIALOG,DA,DR,DIE,DIDEL,ORQUIT,ORVP,ORL,ACTION,FIRST,ORTYPE,ORNAME,X,Y,BEFORCRC,AFTERCRC
"RTN","ORCMEDT1",24,0)
 Q:'$G(ORQDLG)  S DA=ORQDLG,(ORVP,ORL)=0,FIRST=1,ORTYPE="Z"
"RTN","ORCMEDT1",25,0)
 S ORNAME=$$NAME^ORCMEDT4(ORQDLG) Q:(ORNAME="@")!(ORNAME="^")  ;deleted,^
"RTN","ORCMEDT1",26,0)
 S BEFORCRC=$$RAWCRC^ORCMEDT8(ORQDLG)
"RTN","ORCMEDT1",27,0)
 S DR=".01///^S X=ORNAME;2;8;20"_$S(DUZ(0)="@":";30",1:""),DIE="^ORD(101.41,"
"RTN","ORCMEDT1",28,0)
 D ^DIE G:$D(Y)!$D(DTOUT) QR  D GETQDLG^ORCD(ORQDLG) G:'$G(ORDIALOG) QR
"RTN","ORCMEDT1",29,0)
 I '$P($G(^ORD(101.41,ORQDLG,0)),U,7) S X=+$P($G(^ORD(101.41,+ORDIALOG,0)),U,7) S:X $P(^ORD(101.41,ORQDLG,0),U,7)=X,^ORD(101.41,"APKG",X,ORQDLG)=""
"RTN","ORCMEDT1",30,0)
 W ! I $D(^ORD(101.41,+ORDIALOG,3.1)) X ^(3.1) G:$G(ORQUIT) QQ
"RTN","ORCMEDT1",31,0)
Q1 D DIALOG^ORCDLG G:$G(ORQUIT) QQ
"RTN","ORCMEDT1",32,0)
 D DISPLAY^ORCDLG S ACTION=$$OK G:ACTION="^" QQ
"RTN","ORCMEDT1",33,0)
 D:ACTION="P" SAVE^ORCMEDT0,AUTO(ORQDLG) I ACTION="E" S FIRST=0 G Q1 ;fall thru if "C"
"RTN","ORCMEDT1",34,0)
QQ X:$D(^ORD(101.41,+ORDIALOG,4)) ^(4)
"RTN","ORCMEDT1",35,0)
QR S AFTERCRC=$$RAWCRC^ORCMEDT8(ORQDLG)
"RTN","ORCMEDT1",36,0)
 I BEFORCRC'=AFTERCRC D UPDQNAME^ORCMEDT8(ORQDLG) ; Rename personal quick order if modified
"RTN","ORCMEDT1",37,0)
 Q
"RTN","ORCMEDT1",38,0)
 ;
"RTN","ORCMEDT1",39,0)
OK() ; -- Ready to save?
"RTN","ORCMEDT1",40,0)
 N X,Y,DIR S DIR(0)="SAM^P:PLACE;E:EDIT;C:CANCEL;",DIR("B")="PLACE"
"RTN","ORCMEDT1",41,0)
 S DIR("A")="(P)lace, (E)dit, or (C)ancel this quick order? "
"RTN","ORCMEDT1",42,0)
 S DIR("?")="Enter P to save this quick order, or E to change any of the displayed values; enter C to quit without saving these responses"
"RTN","ORCMEDT1",43,0)
 D ^DIR S:$D(DTOUT) Y="^"
"RTN","ORCMEDT1",44,0)
 Q Y
"RTN","ORCMEDT1",45,0)
 ;
"RTN","ORCMEDT1",46,0)
SAVE G SAVE^ORCMEDT0
"RTN","ORCMEDT1",47,0)
 ;
"RTN","ORCMEDT1",48,0)
AUTO(DLG) ; -- set AutoAccept flag for GUI
"RTN","ORCMEDT1",49,0)
 N X,Y,DIR
"RTN","ORCMEDT1",50,0)
 I $$VALQO^ORWDXM3(+DLG)=0 S $P(^ORD(101.41,+DLG,5),U,8)="" Q
"RTN","ORCMEDT1",51,0)
 S DIR(0)="YA",DIR("A")="Auto-accept this order? "
"RTN","ORCMEDT1",52,0)
 S DIR("B")=$S($P($G(^ORD(101.41,+DLG,5)),U,8):"YES",1:"NO")
"RTN","ORCMEDT1",53,0)
 S DIR("?")="Enter YES if this order can be placed simply by selecting it, or NO if the dialog should be presented to complete the order."
"RTN","ORCMEDT1",54,0)
 D ^DIR S:Y=1!(Y=0) $P(^ORD(101.41,+DLG,5),U,8)=$S(Y:1,1:"")
"RTN","ORCMEDT1",55,0)
 I $P($G(^ORD(101.41,+DLG,0)),"^",8)'=1&($P($G(^(0)),"^",9)=2)&(Y) D EXPLAIN S $P(^ORD(101.41,+DLG,5),"^",8)="" ;Reset auto-accept to no if explanation required. 
"RTN","ORCMEDT1",56,0)
 Q
"RTN","ORCMEDT1",57,0)
 ;
"RTN","ORCMEDT1",58,0)
SET ; -- Order Sets
"RTN","ORCMEDT1",59,0)
 N ORSET,ORDG
"RTN","ORCMEDT1",60,0)
 F  S ORSET=$$DIALOG^ORCMEDT0("O") Q:ORSET="^"  D SET0(ORSET) W !
"RTN","ORCMEDT1",61,0)
 Q
"RTN","ORCMEDT1",62,0)
SET0(ORSET) ; -- edit order set ORSET
"RTN","ORCMEDT1",63,0)
 N DA,DR,DIE,DIC,DIK,X,Y,SEQ,ITM,LCNT,QUIT,ORNAME Q:'$G(ORSET)
"RTN","ORCMEDT1",64,0)
 S ORNAME=$$NAME^ORCMEDT4(ORSET) Q:(ORNAME="@")!(ORNAME="^")  ;deleted,^
"RTN","ORCMEDT1",65,0)
 S DR=".01///^S X=ORNAME;2;20"_$S(DUZ(0)="@":";30;40",1:""),DA=ORSET
"RTN","ORCMEDT1",66,0)
 S DIE="^ORD(101.41," D ^DIE Q:$D(Y)  Q:'$G(DA)
"RTN","ORCMEDT1",67,0)
S1 I $O(^ORD(101.41,+ORSET,10,0)) D  Q:QUIT  ;Show existing components
"RTN","ORCMEDT1",68,0)
 . W !,"ORDER SET COMPONENTS:" S (SEQ,LCNT,QUIT)=0
"RTN","ORCMEDT1",69,0)
 . S DIK="^ORD(101.41,"_+ORSET_",10,",DA(1)=+ORSET ;just in case
"RTN","ORCMEDT1",70,0)
 . F  S SEQ=$O(^ORD(101.41,+ORSET,10,"B",SEQ)) Q:SEQ'>0  D
"RTN","ORCMEDT1",71,0)
 . . S DA=0 F  S DA=$O(^ORD(101.41,+ORSET,10,"B",SEQ,DA)) Q:DA'>0  D
"RTN","ORCMEDT1",72,0)
 . . . S ITM=$P($G(^ORD(101.41,+ORSET,10,DA,0)),U,2) I ITM'>0 D ^DIK Q
"RTN","ORCMEDT1",73,0)
 . . . S LCNT=LCNT+1 I LCNT>(IOSL-3) R !,"Press <return> to continue ...",X:DTIME S LCNT=0 I X["^" S QUIT=1 Q
"RTN","ORCMEDT1",74,0)
 . . . W !?3,SEQ,?10,$P(^ORD(101.41,ITM,0),U)
"RTN","ORCMEDT1",75,0)
S2 S QUIT=0 F  D  Q:QUIT  W ! ;Enter/edit components
"RTN","ORCMEDT1",76,0)
 . S DIC="^ORD(101.41,"_+ORSET_",10,",DIC(0)="AEQLM",D="B^D"
"RTN","ORCMEDT1",77,0)
 . S DIC("A")="Select COMPONENT SEQUENCE#: ",DIC("P")=$P(^DD(101.41,10,0),U,2)
"RTN","ORCMEDT1",78,0)
 . K DA S DA(1)=+ORSET D MIX^DIC1 I Y'>0 S QUIT=1 Q
"RTN","ORCMEDT1",79,0)
 . S DA=+Y,DIE=DIC,DR=".01;2R" D ^DIE Q:'$G(DA)
"RTN","ORCMEDT1",80,0)
 . I $D(^ORD(101.41,+ORSET,10,DA,0)),'$P(^(0),U,2) S DIK=DIE D ^DIK
"RTN","ORCMEDT1",81,0)
 Q
"RTN","ORCMEDT1",82,0)
 ;
"RTN","ORCMEDT1",83,0)
PROTOCOL ; -- Convert additional protocols to dialogs
"RTN","ORCMEDT1",84,0)
 N X,Y,DIC,ORERR
"RTN","ORCMEDT1",85,0)
 F  S DIC="^ORD(101,",DIC(0)="AEQM" D ^DIC Q:Y'>0  D  W !
"RTN","ORCMEDT1",86,0)
 . S ORP=+Y,ORM=$$MENU Q:ORM="^"  ; What about "^^"-jumping? (ORWARD)
"RTN","ORCMEDT1",87,0)
 . W !,"Converting ..." D ONE(ORP,ORM,.ORERR) I '$G(ORERR) W " done." Q
"RTN","ORCMEDT1",88,0)
 . W " unable to convert.",!,">> "_$P(ORERR,U,2) K ORERR
"RTN","ORCMEDT1",89,0)
 Q
"RTN","ORCMEDT1",90,0)
ONE(PITEM,ORADD,ERROR) ; -- Convert single item protocol, add to menu(s)
"RTN","ORCMEDT1",91,0)
 N PMENU,DMENU,NAME,ORPOS,POS,XUTL,DA,DIK
"RTN","ORCMEDT1",92,0)
 I $D(^ORD(100.99,1,101.41,PITEM,0)) S DA=PITEM,DA(1)=1,DIK="^ORD(100.99,1,101.41," D ^DIK ; delete error entry
"RTN","ORCMEDT1",93,0)
 S NAME=$P($G(^ORD(101,PITEM,0)),U),DITEM=$$ITEM^ORCONVRT(PITEM)
"RTN","ORCMEDT1",94,0)
 I 'DITEM!$D(^ORD(100.99,1,101.41,PITEM,0)) S ERROR=$G(^(0)) Q
"RTN","ORCMEDT1",95,0)
 Q:'$G(ORADD)  ;to add, may enter here with PITEM & DITEM defined
"RTN","ORCMEDT1",96,0)
ADD S PMENU=0 F  S PMENU=$O(^ORD(101,"AD",PITEM,PMENU)) Q:PMENU'>0  D  W "."
"RTN","ORCMEDT1",97,0)
 . S DMENU=$O(^ORD(101.41,"AB",$P(^ORD(101,PMENU,0),U),0)) Q:'DMENU
"RTN","ORCMEDT1",98,0)
 . S ORPOS=$$FINDXUTL(PMENU,PITEM) Q:'ORPOS
"RTN","ORCMEDT1",99,0)
 . S XUTL=$G(^XUTL("XQORM",PMENU_";ORD(101,",ORPOS,0))
"RTN","ORCMEDT1",100,0)
 . S DA=$O(^ORD(101.41,DMENU,10,"B",ORPOS,0)) I DA Q:$P(^ORD(101.41,DMENU,10,DA,0),U,2)=DITEM  S POS=$O(^ORD(101.41,DMENU,10,"B",""),-1),ORPOS=($P(POS,".")+1)_".1",DA="" ; move to end, if collision
"RTN","ORCMEDT1",101,0)
 . S DA=$$NEXT^ORCONVRT(DMENU)
"RTN","ORCMEDT1",102,0)
 . S ^ORD(101.41,DMENU,10,DA,0)=ORPOS_U_DITEM_U_$P(XUTL,U,4)_U_$S($P(XUTL,U,3)'=$P(^ORD(101.41,DITEM,0),U,2):$P(XUTL,U,3),1:"")
"RTN","ORCMEDT1",103,0)
 . S ^ORD(101.41,DMENU,10,"B",ORPOS,DA)="",^ORD(101.41,DMENU,10,"D",DITEM,DA)=""
"RTN","ORCMEDT1",104,0)
 . S ^ORD(101.41,"AD",DITEM,DMENU,DA)="",^ORD(101.41,DMENU,99)=$H
"RTN","ORCMEDT1",105,0)
 Q
"RTN","ORCMEDT1",106,0)
 ;
"RTN","ORCMEDT1",107,0)
FINDXUTL(MENU,ITEM) ; -- Returns position of ITEM in MENU
"RTN","ORCMEDT1",108,0)
 N XQORM,POS
"RTN","ORCMEDT1",109,0)
 S XQORM=MENU_";ORD(101," D XREF^XQORM
"RTN","ORCMEDT1",110,0)
 S POS=0 F  S POS=$O(^XUTL("XQORM",XQORM,POS)) Q:POS'>0  I $P(^(POS,0),U,2)=ITEM Q
"RTN","ORCMEDT1",111,0)
 Q POS
"RTN","ORCMEDT1",112,0)
 ;
"RTN","ORCMEDT1",113,0)
MENU() ; -- Add converted item to menus?
"RTN","ORCMEDT1",114,0)
 N X,Y,DIR S DIR(0)="YA"
"RTN","ORCMEDT1",115,0)
 S DIR("A")="Add this item to the same menus again? ",DIR("B")="YES"
"RTN","ORCMEDT1",116,0)
 S DIR("?")="Enter YES to have this item placed on the same menus in the Order Dialog file as it was in the Protocol file"
"RTN","ORCMEDT1",117,0)
 D ^DIR S:$D(DTOUT) Y="^"
"RTN","ORCMEDT1",118,0)
 Q Y
"RTN","ORCMEDT1",119,0)
EXPLAIN ;Give reason why user can't set auto-accept to yes
"RTN","ORCMEDT1",120,0)
 W !!,"The combination of VERIFY set to NO and ASK FOR ANOTHER ORDER set to",!,"YES, DON'T ASK and AUTO-ACCEPT set to YES is not allowed."
"RTN","ORCMEDT1",121,0)
 W !!,"This combination of settings could cause CPRS to enter into an infinite loop",!,"creating the same order over and over.  If you wish to have"
"RTN","ORCMEDT1",122,0)
 W !,"AUTO-ACCEPT set to YES you must change one of the other two fields",!,"to a different value.",!!,"AUTO-ACCEPT is being set to NO for you."
"RTN","ORCMEDT1",123,0)
 Q
"RTN","ORCMEDT8")
0^210^B77783054
"RTN","ORCMEDT8",1,0)
ORCMEDT8 ;SLC/JM-QO, Generate quick order CRC ;10/18/07
"RTN","ORCMEDT8",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**245,243**;Dec 17, 1997;Build 242
"RTN","ORCMEDT8",3,0)
 Q
"RTN","ORCMEDT8",4,0)
 ;
"RTN","ORCMEDT8",5,0)
UPDQNAME(ORIEN) ; Rename personal quick order name if needed
"RTN","ORCMEDT8",6,0)
 N OLDNAME,NEWNAME,DA,DR,DIE,DIDEL
"RTN","ORCMEDT8",7,0)
 I $P($G(^ORD(101.41,ORIEN,0)),U,4)'="Q" Q
"RTN","ORCMEDT8",8,0)
 S OLDNAME=$P($G(^ORD(101.41,ORIEN,0)),U,1)
"RTN","ORCMEDT8",9,0)
 I $E($P(OLDNAME,U),1,6)'="ORWDQ " Q
"RTN","ORCMEDT8",10,0)
 S NEWNAME="ORWDQ "_$$CRC4QCK(ORIEN)
"RTN","ORCMEDT8",11,0)
 I OLDNAME'=NEWNAME D
"RTN","ORCMEDT8",12,0)
 . S NEWNAME=$$ENSURNEW(NEWNAME)
"RTN","ORCMEDT8",13,0)
 . S DA=ORIEN,DR=".01///"_NEWNAME,DIE="^ORD(101.41," D ^DIE
"RTN","ORCMEDT8",14,0)
 Q
"RTN","ORCMEDT8",15,0)
 ;
"RTN","ORCMEDT8",16,0)
ENSURNEW(NAME) ; Ensures the name is a new entry
"RTN","ORCMEDT8",17,0)
 N IDX,BASENAME,ABC,NEWNAME
"RTN","ORCMEDT8",18,0)
 S NEWNAME=NAME
"RTN","ORCMEDT8",19,0)
 S IDX=0,BASENAME=NEWNAME,ABC=97 ; Find an unused name
"RTN","ORCMEDT8",20,0)
 F  S IDX=$O(^ORD(101.41,"B",NEWNAME,0))  Q:'IDX  D
"RTN","ORCMEDT8",21,0)
 . S NEWNAME=BASENAME_$C(ABC) ; append letter 'a' - 'z'
"RTN","ORCMEDT8",22,0)
 . S ABC=ABC+1 I ABC>122 S BASENAME=BASENAME_"a",ABC=97
"RTN","ORCMEDT8",23,0)
 Q NEWNAME
"RTN","ORCMEDT8",24,0)
RAWCRC(ORIEN) ; Get a raw CRC value to determine if a record has changed
"RTN","ORCMEDT8",25,0)
 N ORDATA,RESULT,ADDCRLF,LASTLINE,LASTIDX,OLDCRC
"RTN","ORCMEDT8",26,0)
 S (RESULT,OLDCRC)=""
"RTN","ORCMEDT8",27,0)
 I $P($G(^ORD(101.41,ORIEN,0)),U,4)'="Q" G RWQ
"RTN","ORCMEDT8",28,0)
 I $E($P($G(^ORD(101.41,ORIEN,0)),U),1,6)'="ORWDQ " G RWQ
"RTN","ORCMEDT8",29,0)
 D LOADRSP^ORWDX(.ORDATA,ORIEN)
"RTN","ORCMEDT8",30,0)
 D PARSE
"RTN","ORCMEDT8",31,0)
RWQ Q RESULT
"RTN","ORCMEDT8",32,0)
 ;
"RTN","ORCMEDT8",33,0)
 ; The following code attemps to duplicate the CRC calculated by the Delphi code
"RTN","ORCMEDT8",34,0)
 ; in CPRS for quick orders.  It will not match all the time, since not all the
"RTN","ORCMEDT8",35,0)
 ; data neded to make the determination is stored on the M side, but it does it's best.
"RTN","ORCMEDT8",36,0)
 ;
"RTN","ORCMEDT8",37,0)
CRC4QCK(ORIEN) ; Get CRC for a personal quick order
"RTN","ORCMEDT8",38,0)
 N ORDATA,DISPGRP,DEFDLG,FORMID,RESULT,FORMDATA,ADDCRLF
"RTN","ORCMEDT8",39,0)
 N LASTLINE,LASTIDX,OLDCRC,FORMINFO,IDINFO,NEXTFORM
"RTN","ORCMEDT8",40,0)
 S RESULT="",FORMID=0
"RTN","ORCMEDT8",41,0)
 ; Must be personal quick order
"RTN","ORCMEDT8",42,0)
 I $P($G(^ORD(101.41,ORIEN,0)),U,4)'="Q" G EXT
"RTN","ORCMEDT8",43,0)
 I $E($P($G(^ORD(101.41,ORIEN,0)),U),1,6)'="ORWDQ " G EXT
"RTN","ORCMEDT8",44,0)
 S OLDCRC=$E($P($G(^ORD(101.41,ORIEN,0)),U,1),7,14)
"RTN","ORCMEDT8",45,0)
 F  Q:(RESULT=OLDCRC)!(FORMID="")  D
"RTN","ORCMEDT8",46,0)
 . K ORDATA D LOADRSP^ORWDX(.ORDATA,ORIEN)
"RTN","ORCMEDT8",47,0)
 . ; First pass don't use any form id - get baseline CRC
"RTN","ORCMEDT8",48,0)
 . I FORMID=1 D  Q:FORMID=""
"RTN","ORCMEDT8",49,0)
 . . S FORMID=""
"RTN","ORCMEDT8",50,0)
 . . S DISPGRP=$P($G(^ORD(101.41,ORIEN,0)),U,5) I '+DISPGRP Q  ; Must have a valid display group
"RTN","ORCMEDT8",51,0)
 . . S DEFDLG=$P($G(^ORD(100.98,DISPGRP,0)),U,4) I '+DEFDLG Q  ; Display group must have a valid default dialog
"RTN","ORCMEDT8",52,0)
 . . D FORMID^ORWDXM(.FORMID,DEFDLG) I '+FORMID S FORMID="" Q  ; Default dialog must have a valid windows form ID
"RTN","ORCMEDT8",53,0)
 . . I (FORMID=130)!(FORMID=140) D
"RTN","ORCMEDT8",54,0)
 . . . N NEWFORM D CHK94^ORWDPS1(.NEWFORM) I NEWFORM=1 S FORMID=135
"RTN","ORCMEDT8",55,0)
 . . D FORMINFO(.FORMINFO,.IDINFO,.NEXTFORM)
"RTN","ORCMEDT8",56,0)
 . I FORMID=0 S FORMID=1
"RTN","ORCMEDT8",57,0)
 . E  D SORTDATA I FORMDATA="" S FORMID="" Q  ; Updates FORMID
"RTN","ORCMEDT8",58,0)
 . D PARSE
"RTN","ORCMEDT8",59,0)
EXT Q RESULT
"RTN","ORCMEDT8",60,0)
 ;
"RTN","ORCMEDT8",61,0)
PARSE ; Parse Data
"RTN","ORCMEDT8",62,0)
 N DATAIDX,IDX,LINE,CODE,CRCDATA,OUTPUT,DONE,ISMASTER,LASTMSTR,FIRST,P3,LK4SPACE
"RTN","ORCMEDT8",63,0)
 S DATAIDX="",(IDX,DONE,ISMASTER,LASTMSTR,LASTIDX)=0,LASTLINE=""
"RTN","ORCMEDT8",64,0)
 F  D GETLINE Q:DONE  D  Q:DONE
"RTN","ORCMEDT8",65,0)
 . I ISMASTER D
"RTN","ORCMEDT8",66,0)
 . . S OUTPUT=+$P(LINE,U,1)_U_+$P(LINE,U,2)_U
"RTN","ORCMEDT8",67,0)
 . . S IDX=IDX+1,CRCDATA(IDX)=OUTPUT
"RTN","ORCMEDT8",68,0)
 . . S FIRST=1,P3=$P(LINE,U,3)
"RTN","ORCMEDT8",69,0)
 . . I P3="COMMENT" S ADDCRLF=1,LK4SPACE=1
"RTN","ORCMEDT8",70,0)
 . . E  D
"RTN","ORCMEDT8",71,0)
 . . . I P3="STATEMENTS" S ADDCRLF=1,LK4SPACE=0
"RTN","ORCMEDT8",72,0)
 . . . E  S ADDCRLF=0,LK4SPACE=0
"RTN","ORCMEDT8",73,0)
 . . F  D GETLINE Q:DONE!ISMASTER  D
"RTN","ORCMEDT8",74,0)
 . . . I CODE="i" S IDX=IDX+1,CRCDATA(IDX)=LINE
"RTN","ORCMEDT8",75,0)
 . . . I CODE="t" D
"RTN","ORCMEDT8",76,0)
 . . . . I FIRST S FIRST=0,OUTPUT=LINE
"RTN","ORCMEDT8",77,0)
 . . . . E  D
"RTN","ORCMEDT8",78,0)
 . . . . . I $L(LASTLINE)=0 S OUTPUT=$C(13)_$C(10)_LINE Q
"RTN","ORCMEDT8",79,0)
 . . . . . I LK4SPACE,$L(LASTLINE)>1,$E(LASTLINE,$L(LASTLINE))=" " S OUTPUT=""
"RTN","ORCMEDT8",80,0)
 . . . . . E  D
"RTN","ORCMEDT8",81,0)
 . . . . . . I ADDCRLF S OUTPUT=$C(13)_$C(10) ; ,$L(LASTLINE)<65
"RTN","ORCMEDT8",82,0)
 . . . . . . E  S OUTPUT=" "
"RTN","ORCMEDT8",83,0)
 . . . . . S OUTPUT=OUTPUT_LINE
"RTN","ORCMEDT8",84,0)
 . . . . S LASTLINE=LINE
"RTN","ORCMEDT8",85,0)
 . . . . S IDX=IDX+1,CRCDATA(IDX)=OUTPUT
"RTN","ORCMEDT8",86,0)
 . . . . I ADDCRLF S LASTIDX=IDX
"RTN","ORCMEDT8",87,0)
 . . I ISMASTER,'DONE S LASTMSTR=1
"RTN","ORCMEDT8",88,0)
 S RESULT=$$CRC4ARRY^ORCRC(.CRCDATA)
"RTN","ORCMEDT8",89,0)
 ; Same data can generate 2 different CRCs - CRLF on end of comments are stripped
"RTN","ORCMEDT8",90,0)
 I OLDCRC'="",RESULT'=OLDCRC,LASTIDX>0 D
"RTN","ORCMEDT8",91,0)
 . S CRCDATA(LASTIDX)=CRCDATA(LASTIDX)_$C(13)_$C(10)
"RTN","ORCMEDT8",92,0)
 . S RESULT=$$CRC4ARRY^ORCRC(.CRCDATA)
"RTN","ORCMEDT8",93,0)
 Q
"RTN","ORCMEDT8",94,0)
 ;
"RTN","ORCMEDT8",95,0)
SORTDATA ; Sorts data by fields according to FormID
"RTN","ORCMEDT8",96,0)
 N IN,OUT,LINE,DATA,ID,CODE,INDEX,END,IDX,RTN,SUBFORM,SUBFORM2,SUBIDX,NODE
"RTN","ORCMEDT8",97,0)
 S SUBFORM="",SUBFORM2=""
"RTN","ORCMEDT8",98,0)
 S FORMDATA=$G(FORMINFO(FORMID)) I FORMDATA="" Q
"RTN","ORCMEDT8",99,0)
 I $E(FORMDATA,1,2)'="00" S RTN="SUBID"_$E(FORMDATA,1,2) D @RTN S FORMDATA=$G(FORMINFO(FORMID)) I FORMDATA="" Q
"RTN","ORCMEDT8",100,0)
 S IN=0,OUT=0,END=1000000,IDX=0
"RTN","ORCMEDT8",101,0)
 F  S IN=$O(ORDATA(IN)) Q:'+IN  D
"RTN","ORCMEDT8",102,0)
 . S LINE=ORDATA(IN)
"RTN","ORCMEDT8",103,0)
 . I $E(LINE)="~" D
"RTN","ORCMEDT8",104,0)
 . . S IDX=1,ID=$P(LINE,U,3),CODE="."_IDINFO(ID)_".",NODE=$P(LINE,U,2)
"RTN","ORCMEDT8",105,0)
 . . S INDEX=$F(FORMDATA,CODE),SUBIDX=0
"RTN","ORCMEDT8",106,0)
 . . I INDEX=0,SUBFORM'="" D
"RTN","ORCMEDT8",107,0)
 . . . S INDEX=($F(FORMDATA,".ZZZ."))
"RTN","ORCMEDT8",108,0)
 . . . I INDEX>0 S SUBIDX=$F(SUBFORM,CODE) I SUBIDX<1 S INDEX=0
"RTN","ORCMEDT8",109,0)
 . . I INDEX=0,SUBFORM2'="" D
"RTN","ORCMEDT8",110,0)
 . . . S INDEX=($F(FORMDATA,".XXX."))
"RTN","ORCMEDT8",111,0)
 . . . I INDEX>0 S SUBIDX=$F(SUBFORM2,CODE) I SUBIDX<1 S INDEX=0
"RTN","ORCMEDT8",112,0)
 . . I INDEX=0 S OUT=END,END=END+1
"RTN","ORCMEDT8",113,0)
 . . E  D
"RTN","ORCMEDT8",114,0)
 . . . I SUBIDX>0 D  I 1
"RTN","ORCMEDT8",115,0)
 . . . . S OUT=(INDEX-4)*250
"RTN","ORCMEDT8",116,0)
 . . . . S SUBIDX=(SUBIDX-4)\4
"RTN","ORCMEDT8",117,0)
 . . . . S OUT=OUT+SUBIDX+(NODE*20)
"RTN","ORCMEDT8",118,0)
 . . . E  S OUT=(INDEX-4)*250
"RTN","ORCMEDT8",119,0)
 . I IDX>0 D
"RTN","ORCMEDT8",120,0)
 . . S DATA(OUT,IDX)=LINE
"RTN","ORCMEDT8",121,0)
 . . S IDX=IDX+1
"RTN","ORCMEDT8",122,0)
 K ORDATA
"RTN","ORCMEDT8",123,0)
 S (IN,OUT,INDEX)=0
"RTN","ORCMEDT8",124,0)
 F  S IN=$O(DATA(IN)) Q:'+IN  D
"RTN","ORCMEDT8",125,0)
 . F  S INDEX=$O(DATA(IN,INDEX)) Q:'+INDEX  D
"RTN","ORCMEDT8",126,0)
 . . S OUT=OUT+1
"RTN","ORCMEDT8",127,0)
 . . S ORDATA(OUT)=DATA(IN,INDEX)
"RTN","ORCMEDT8",128,0)
 S FORMID=$G(NEXTFORM(FORMID))
"RTN","ORCMEDT8",129,0)
 Q
"RTN","ORCMEDT8",130,0)
 ;
"RTN","ORCMEDT8",131,0)
GETLINE ;
"RTN","ORCMEDT8",132,0)
 I LASTMSTR S LASTMSTR=0 Q
"RTN","ORCMEDT8",133,0)
 S DATAIDX=$O(ORDATA(DATAIDX))
"RTN","ORCMEDT8",134,0)
 S DONE=(DATAIDX="")
"RTN","ORCMEDT8",135,0)
 I 'DONE S CODE=$E(ORDATA(DATAIDX),1),LINE=$E(ORDATA(DATAIDX),2,9999),ISMASTER=(CODE="~")
"RTN","ORCMEDT8",136,0)
 Q
"RTN","ORCMEDT8",137,0)
 ;
"RTN","ORCMEDT8",138,0)
FORMINFO(FORMINFO,IDINFO,NEXTFORM) ; populates FORMINFO,IDINFO and NEXTFORM arrays
"RTN","ORCMEDT8",139,0)
 N IDX,LINE,CODE,RTN,NEXT
"RTN","ORCMEDT8",140,0)
 S IDX=1
"RTN","ORCMEDT8",141,0)
 F  S LINE=$E($T(FORMTBL+IDX),21,999) Q:$L(LINE)<1  D
"RTN","ORCMEDT8",142,0)
 . S CODE=$E(LINE,1,3),NEXT=$E(LINE,5,7),LINE=$E(LINE,9,999)
"RTN","ORCMEDT8",143,0)
 . S FORMINFO(CODE)=LINE
"RTN","ORCMEDT8",144,0)
 . I NEXT'="   " S NEXTFORM(CODE)=NEXT
"RTN","ORCMEDT8",145,0)
 . S IDX=IDX+1
"RTN","ORCMEDT8",146,0)
 S IDX=1
"RTN","ORCMEDT8",147,0)
 F  S LINE=$E($T(IDTABLE+IDX),4,999) Q:$L(LINE)<1  D
"RTN","ORCMEDT8",148,0)
 . S CODE=$E(LINE,1,3),LINE=$E(LINE,5,99)
"RTN","ORCMEDT8",149,0)
 . S IDINFO(LINE)=CODE,IDX=IDX+1
"RTN","ORCMEDT8",150,0)
 Q
"RTN","ORCMEDT8",151,0)
 ;
"RTN","ORCMEDT8",152,0)
HASCODE(CODE) ; scans data for code
"RTN","ORCMEDT8",153,0)
 N RESULT,IDX,LINE S IDX="",RESULT=0
"RTN","ORCMEDT8",154,0)
 F  S IDX=$O(ORDATA(IDX)) Q:IDX=""  D  Q:IDX=""
"RTN","ORCMEDT8",155,0)
 . S LINE=ORDATA(IDX)
"RTN","ORCMEDT8",156,0)
 . I $E(LINE)="~" D
"RTN","ORCMEDT8",157,0)
 . . S LINE=$P(LINE,U,3)
"RTN","ORCMEDT8",158,0)
 . . I LINE=CODE S RESULT=1,IDX=""
"RTN","ORCMEDT8",159,0)
 Q RESULT
"RTN","ORCMEDT8",160,0)
 ;
"RTN","ORCMEDT8",161,0)
SUBID ; SubID codes are used to change the form ID depending on depending on data
"RTN","ORCMEDT8",162,0)
 ; Data below is FormID;SubID.list of ID codes in order of use
"RTN","ORCMEDT8",163,0)
 ; SubID's are used to change the FormID depending on data values.
"RTN","ORCMEDT8",164,0)
 Q
"RTN","ORCMEDT8",165,0)
SUBID01 ; Generic Meds dialog
"RTN","ORCMEDT8",166,0)
 N INPT,COMPLEX
"RTN","ORCMEDT8",167,0)
 S INPT=$$HASCODE("NOW"),COMPLEX=$$HASCODE("DAYS")
"RTN","ORCMEDT8",168,0)
 I INPT D  I 1
"RTN","ORCMEDT8",169,0)
 . I COMPLEX S FORMID="INX",SUBFORM=$G(FORMINFO("MDX"))
"RTN","ORCMEDT8",170,0)
 . E  S FORMID="INP"
"RTN","ORCMEDT8",171,0)
 E  I COMPLEX S FORMID="OPX",SUBFORM=$G(FORMINFO("MDX"))
"RTN","ORCMEDT8",172,0)
 Q
"RTN","ORCMEDT8",173,0)
SUBID02 ; IV Meds
"RTN","ORCMEDT8",174,0)
 S SUBFORM=$G(FORMINFO("IVL"))
"RTN","ORCMEDT8",175,0)
 Q
"RTN","ORCMEDT8",176,0)
SUBID03 ; Delphi code adds URGENCY prompt that does not exist in dialog on M side
"RTN","ORCMEDT8",177,0)
 I '$$HASCODE("URGENCY") D
"RTN","ORCMEDT8",178,0)
 . N X
"RTN","ORCMEDT8",179,0)
 . S X=$O(ORDATA(999999),-1)+1
"RTN","ORCMEDT8",180,0)
 . S ORDATA(X)="~0^1^URGENCY"
"RTN","ORCMEDT8",181,0)
 Q
"RTN","ORCMEDT8",182,0)
SUBID04 ; Blood Bank will probably be wrong - quick orders not working in v26
"RTN","ORCMEDT8",183,0)
 S SUBFORM=$G(FORMINFO("BBK"))
"RTN","ORCMEDT8",184,0)
 S SUBFORM2=$G(FORMINFO("BBX"))
"RTN","ORCMEDT8",185,0)
 Q
"RTN","ORCMEDT8",186,0)
SUBID05 ; Diet
"RTN","ORCMEDT8",187,0)
 I FORMID="117" S SUBFORM=$G(FORMINFO("DLN"))
"RTN","ORCMEDT8",188,0)
 I FORMID="TBF" S SUBFORM=$G(FORMINFO("TBL"))
"RTN","ORCMEDT8",189,0)
 Q
"RTN","ORCMEDT8",190,0)
FORMTBL ; Form Table - Forms allowing personal quick orders, as of CPRS GUI v26 (OR*3*215)
"RTN","ORCMEDT8",191,0)
 ;;Consult         ;110;CS2;00.ORD.CLS.URG.PLA.MSC.COD.PRV.COM.
"RTN","ORCMEDT8",192,0)
 ;;                ;CS2;   ;00.ORD.CLS.URG.PLA.MSC.COD.COM.PRV.
"RTN","ORCMEDT8",193,0)
 ;;Procedure       ;112;PR2;00.SER.ORD.CLS.URG.PLA.MSC.COD.PRV.COM.
"RTN","ORCMEDT8",194,0)
 ;;                ;PR2;PR3;00.SER.ORD.COM.CLS.URG.PLA.MSC.COD.PRV.
"RTN","ORCMEDT8",195,0)
 ;;                ;PR3;   ;00.SER.ORD.CLS.URG.PLA.MSC.COD.COM.PRV.
"RTN","ORCMEDT8",196,0)
 ;;Diet            ;117;TBF;05.STT.STP.ZZZ.COM.DEL.CAN.
"RTN","ORCMEDT8",197,0)
 ;;                ;TBF;OPM;05.ZZZ.COM.CAN.
"RTN","ORCMEDT8",198,0)
 ;;                ;OPM;   ;00.ORD.MEL.STT.STP.SCH.COM.DEL.
"RTN","ORCMEDT8",199,0)
 ;;                ;DLN;   ;00.ORD.
"RTN","ORCMEDT8",200,0)
 ;;                ;TBL;   ;00.ORD.STR.INS.
"RTN","ORCMEDT8",201,0)
 ;;Lab             ;120;   ;00.ORD.SAM.SPE.URG.COM.COL.STT.SCH.DAY.
"RTN","ORCMEDT8",202,0)
 ;;Blood Bank      ;125;BB2;04.ZZZ.DTE.COL.URG.COM.STT.MSC.REA.YN0.XXX.LAB.
"RTN","ORCMEDT8",203,0)
 ;;                ;BB2;   ;04.ZZZ.URG.COM.COL.DTE.MSC.REA.YN0.STT.XXX.
"RTN","ORCMEDT8",204,0)
 ;;                ;BBK;   ;00.ORD.QTY.MDF.SPC.
"RTN","ORCMEDT8",205,0)
 ;;                ;BBX;   ;00.RES.
"RTN","ORCMEDT8",206,0)
 ;;Inpatient Meds  ;130;   ;00.ORD.DRG.INS.ROU.SCH.URG.COM.SCT.ADM
"RTN","ORCMEDT8",207,0)
 ;;Generic Meds    ;135;   ;01.ORD.INS.DRG.DOS.STR.NAM.ROU.SCH.URG.COM.SUP.QTY.REF.SC0.PCK.PI0.SIG.
"RTN","ORCMEDT8",208,0)
 ;;                ;INP;   ;00.ORD.INS.DRG.DOS.STR.NAM.ROU.SCH.URG.COM.NOW.SIG.
"RTN","ORCMEDT8",209,0)
 ;;                ;OPX;   ;00.ORD.STR.NAM.DRG.ZZZ.URG.COM.SUP.QTY.REF.SC0.PCK.PI0.SIG.
"RTN","ORCMEDT8",210,0)
 ;;                ;INX;   ;00.ORD.STR.NAM.DRG.ZZZ.URG.COM.NOW.SIG.
"RTN","ORCMEDT8",211,0)
 ;;                ;MDX;   ;00.INS.DOS.ROU.SCH.DAY.CNJ.
"RTN","ORCMEDT8",212,0)
 ;;Outpatient Meds ;140;   ;00.ORD.DRG.INS.MSC.ROU.SCH.QTY.REF.PCK.URG.COM.SC0.
"RTN","ORCMEDT8",213,0)
 ;;Non-VA Meds     ;145;   ;03.ORD.INS.DRG.DOS.STR.NAM.ROU.SCH.URG.COM.STT.STA.NOW.SIG.
"RTN","ORCMEDT8",214,0)
 ;;Radiology       ;160;   ;00.ORD.STT.URG.MOD.CLS.IML.PRG.YN0.PRE.COM.MDF.PRV.CON.RSH.LOC.
"RTN","ORCMEDT8",215,0)
 ;;IV Meds         ;180;   ;02.ZZZ.RAT.URG.DAY.COM.SCH.TYP.ADM
"RTN","ORCMEDT8",216,0)
 ;;                ;IVL;   ;00.ORD.VOL.ADD.STR.UNT.
"RTN","ORCMEDT8",217,0)
 ;;
"RTN","ORCMEDT8",218,0)
IDTABLE ; ID table - returns codes used in the form table IDINFO("LONGNAME")=SHORNAME
"RTN","ORCMEDT8",219,0)
 ;;ADD;ADDITIVE
"RTN","ORCMEDT8",220,0)
 ;;ADM:ADMIN
"RTN","ORCMEDT8",221,0)
 ;;CAN;CANCEL
"RTN","ORCMEDT8",222,0)
 ;;CLS;CLASS
"RTN","ORCMEDT8",223,0)
 ;;COD;CODE
"RTN","ORCMEDT8",224,0)
 ;;COL;COLLECT
"RTN","ORCMEDT8",225,0)
 ;;COM;COMMENT
"RTN","ORCMEDT8",226,0)
 ;;CNJ;CONJ
"RTN","ORCMEDT8",227,0)
 ;;CON;CONTRACT
"RTN","ORCMEDT8",228,0)
 ;;DTE;DATETIME
"RTN","ORCMEDT8",229,0)
 ;;DAY;DAYS
"RTN","ORCMEDT8",230,0)
 ;;DEL;DELIVERY
"RTN","ORCMEDT8",231,0)
 ;;DOS;DOSE
"RTN","ORCMEDT8",232,0)
 ;;DRG;DRUG
"RTN","ORCMEDT8",233,0)
 ;;IML;IMLOC
"RTN","ORCMEDT8",234,0)
 ;;INS;INSTR
"RTN","ORCMEDT8",235,0)
 ;;ISO;ISOLATION
"RTN","ORCMEDT8",236,0)
 ;;LAB;LAB
"RTN","ORCMEDT8",237,0)
 ;;LOC;LOCATION
"RTN","ORCMEDT8",238,0)
 ;;MEL;MEAL
"RTN","ORCMEDT8",239,0)
 ;;MSC;MISC
"RTN","ORCMEDT8",240,0)
 ;;MOD;MODE
"RTN","ORCMEDT8",241,0)
 ;;MDF;MODIFIER
"RTN","ORCMEDT8",242,0)
 ;;NAM;NAME
"RTN","ORCMEDT8",243,0)
 ;;NOW;NOW
"RTN","ORCMEDT8",244,0)
 ;;ORD;ORDERABLE
"RTN","ORCMEDT8",245,0)
 ;;PI0;PI
"RTN","ORCMEDT8",246,0)
 ;;PCK;PICKUP
"RTN","ORCMEDT8",247,0)
 ;;PLA;PLACE
"RTN","ORCMEDT8",248,0)
 ;;PRG;PREGNANT
"RTN","ORCMEDT8",249,0)
 ;;PRE;PREOP
"RTN","ORCMEDT8",250,0)
 ;;PRV;PROVIDER
"RTN","ORCMEDT8",251,0)
 ;;QTY;QTY
"RTN","ORCMEDT8",252,0)
 ;;RAT;RATE
"RTN","ORCMEDT8",253,0)
 ;;REA;REASON
"RTN","ORCMEDT8",254,0)
 ;;REF;REFILLS
"RTN","ORCMEDT8",255,0)
 ;;RSH:RESEARCH
"RTN","ORCMEDT8",256,0)
 ;;RES;RESULTS
"RTN","ORCMEDT8",257,0)
 ;;ROU;ROUTE
"RTN","ORCMEDT8",258,0)
 ;;SAM;SAMPLE
"RTN","ORCMEDT8",259,0)
 ;;SC0;SC
"RTN","ORCMEDT8",260,0)
 ;;SCH;SCHEDULE
"RTN","ORCMEDT8",261,0)
 ;;SCT:SCHTYPE
"RTN","ORCMEDT8",262,0)
 ;;SER;SERVICE
"RTN","ORCMEDT8",263,0)
 ;;SIG;SIG
"RTN","ORCMEDT8",264,0)
 ;;SPE;SPECIMEN
"RTN","ORCMEDT8",265,0)
 ;;SPC;SPECSTS
"RTN","ORCMEDT8",266,0)
 ;;STT;START
"RTN","ORCMEDT8",267,0)
 ;;STA;STATEMENTS
"RTN","ORCMEDT8",268,0)
 ;;STP;STOP
"RTN","ORCMEDT8",269,0)
 ;;STR;STRENGTH
"RTN","ORCMEDT8",270,0)
 ;;SUP;SUPPLY
"RTN","ORCMEDT8",271,0)
 ;;TIM;TIME
"RTN","ORCMEDT8",272,0)
 ;;TYP:TYPE
"RTN","ORCMEDT8",273,0)
 ;;UNT;UNITS
"RTN","ORCMEDT8",274,0)
 ;;URG;URGENCY
"RTN","ORCMEDT8",275,0)
 ;;VIS;VISITSTR
"RTN","ORCMEDT8",276,0)
 ;;VOL;VOLUME
"RTN","ORCMEDT8",277,0)
 ;;XFU;XFUSION
"RTN","ORCMEDT8",278,0)
 ;;YN0;YN
"RTN","ORCMEDT8",279,0)
 ;;XXX;XXX
"RTN","ORCMEDT8",280,0)
 ;;ZZZ;ZZZ
"RTN","ORCMEDT8",281,0)
 ;;              
"RTN","ORCSAVE")
0^61^B70416179
"RTN","ORCSAVE",1,0)
ORCSAVE ;SLC/MKB/JDL-Save ; 7/24/07 9:54am
"RTN","ORCSAVE",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,56,70,73,92,94,116,141,163,187,190,195,243**;Dec 17, 1997;Build 242
"RTN","ORCSAVE",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ORCSAVE",4,0)
NEW(ORDIALOG,ORDG,ORPKG,ORCAT,OREVENT,ORDUZ,ORLOG) ; -- New order
"RTN","ORCSAVE",5,0)
 ; Returns ORIFN = [new] order number, if created/saved
"RTN","ORCSAVE",6,0)
 D EN
"RTN","ORCSAVE",7,0)
 Q
"RTN","ORCSAVE",8,0)
 ;
"RTN","ORCSAVE",9,0)
XX ; -- save new/unreleased edited order into Orders file
"RTN","ORCSAVE",10,0)
 ;    Requires: ORDIALOG() = array of dialog values
"RTN","ORCSAVE",11,0)
 ;              ORIFN      = IFN of original order that was edited
"RTN","ORCSAVE",12,0)
 ;  
"RTN","ORCSAVE",13,0)
 N OLDIFN S ORIFN=+ORIFN,OLDIFN=0
"RTN","ORCSAVE",14,0)
 I $S($P(^OR(100,ORIFN,3),U,3)=11:0,$P(^(3),U,3)'=10:1,$P(^(8,1,0),U,4)=2:0,1:1) S OLDIFN=ORIFN K ORIFN ; create new order if released or delayed&signed
"RTN","ORCSAVE",15,0)
 D EN Q:'ORIFN  S:'$G(ORDA) ORDA=1
"RTN","ORCSAVE",16,0)
 I $G(OLDIFN) D  ;save links between orders
"RTN","ORCSAVE",17,0)
 . S $P(^OR(100,ORIFN,3),U,5)=OLDIFN,$P(^(3),U,11)=1
"RTN","ORCSAVE",18,0)
 . S $P(^OR(100,OLDIFN,3),U,6)=ORIFN S:$D(^(5)) ^OR(100,ORIFN,5)=^OR(100,OLDIFN,5)
"RTN","ORCSAVE",19,0)
 I $D(^OR(100,+OLDIFN,0)) D
"RTN","ORCSAVE",20,0)
 . Q:'$G(OREVTDF)
"RTN","ORCSAVE",21,0)
 . N OLDEVT,OLDSTS,LSTACT,PATID,NOW,WHEN
"RTN","ORCSAVE",22,0)
 . S (OLDEVT,OLDSTS,LSTACT)=0
"RTN","ORCSAVE",23,0)
 . S NOW=$$NOW^XLFDT
"RTN","ORCSAVE",24,0)
 . S OLDEVT=$P(^(0),U,17),OLDSTS=$P(^(3),U,3)
"RTN","ORCSAVE",25,0)
 . ; Active status = 6 from #100.01
"RTN","ORCSAVE",26,0)
 . I (OLDEVT>0),OLDSTS=6 D
"RTN","ORCSAVE",27,0)
 . . S $P(^OR(100,+ORIFN,0),U,17)=OLDEVT
"RTN","ORCSAVE",28,0)
 . . S $P(^OR(100,+ORIFN,3),U,3)=11
"RTN","ORCSAVE",29,0)
 . . S LSTACT=$P($G(^OR(100,+ORIFN,3)),U,7)
"RTN","ORCSAVE",30,0)
 . . I $D(^OR(100,+ORIFN,8,LSTACT,0)) D
"RTN","ORCSAVE",31,0)
 . . . S $P(^OR(100,+ORIFN,8,LSTACT,0),U,15)=11
"RTN","ORCSAVE",32,0)
 . . . S PATID=$P(^OR(100,+ORIFN,0),U,2)
"RTN","ORCSAVE",33,0)
 . . . S WHEN=$P(^OR(100,+ORIFN,8,LSTACT,0),U)
"RTN","ORCSAVE",34,0)
 . . . S ^OR(100,"AC",PATID,9999999-WHEN,+ORIFN,LSTACT)=""
"RTN","ORCSAVE",35,0)
 Q
"RTN","ORCSAVE",36,0)
 ;
"RTN","ORCSAVE",37,0)
RN ; -- save new/unreleased renewal order into Orders file
"RTN","ORCSAVE",38,0)
 ;    Requires: ORDIALOG() = array of new dialog values
"RTN","ORCSAVE",39,0)
 ;              ORIFN      = IFN of original order that was renewed
"RTN","ORCSAVE",40,0)
 ; 
"RTN","ORCSAVE",41,0)
 N OLDIFN S OLDIFN=+ORIFN K ORIFN
"RTN","ORCSAVE",42,0)
 D EN Q:'ORIFN  S:'$G(ORDA) ORDA=1
"RTN","ORCSAVE",43,0)
 S $P(^OR(100,ORIFN,3),U,5)=OLDIFN,$P(^(3),U,11)=2
"RTN","ORCSAVE",44,0)
 S $P(^OR(100,OLDIFN,3),U,6)=ORIFN S:$D(^(5)) ^OR(100,ORIFN,5)=^OR(100,OLDIFN,5)
"RTN","ORCSAVE",45,0)
 Q
"RTN","ORCSAVE",46,0)
 ;
"RTN","ORCSAVE",47,0)
EN ; -- save new/unreleased order in ORDIALOG() into Orders file
"RTN","ORCSAVE",48,0)
 ;    Requires: ORVP, ORNP [and ORL, ORTS, ORAPPT if available]
"RTN","ORCSAVE",49,0)
 ;    If defined: ORCAT,ORPKG,ORDG,ORLOG,ORDUZ,OREVENT,ORDCNTRL,ORSRC
"RTN","ORCSAVE",50,0)
 ;     (else use values from ORDIALOG and current state)
"RTN","ORCSAVE",51,0)
 ;
"RTN","ORCSAVE",52,0)
 N PKG,NOW,NODE,CNT,CDL,I,X,STS,SIGNREQD,LOC,TRSPEC,NATR,CATG,DG,LOG,USR,TYPE
"RTN","ORCSAVE",53,0)
 Q:'$G(ORVP)  Q:'$G(ORDIALOG)  Q:'$D(^ORD(101.41,+ORDIALOG,0))
"RTN","ORCSAVE",54,0)
 S NOW=$$NOW^XLFDT,SIGNREQD=+$P(^ORD(101.41,+ORDIALOG,0),U,6)
"RTN","ORCSAVE",55,0)
 S CATG=$S($L($G(ORCAT)):ORCAT,1:$S($$INPT^ORCD:"I",1:"O"))
"RTN","ORCSAVE",56,0)
 S PKG=$S($G(ORPKG):ORPKG,1:$P(^ORD(101.41,+ORDIALOG,0),U,7))
"RTN","ORCSAVE",57,0)
 I $G(ORIFN),$D(^OR(100,ORIFN,0)) S STS=$P(^(3),U,3) G EN2 ; unrel order
"RTN","ORCSAVE",58,0)
 S DG=$S($G(ORDG):+ORDG,1:$P(^ORD(101.41,+ORDIALOG,0),U,5))
"RTN","ORCSAVE",59,0)
 I $G(OREVENT),$$GET1^DIQ(9.4,+PKG_",",1)'="PSO",'$G(DGPMT) S LOC="",TRSPEC="" ;195
"RTN","ORCSAVE",60,0)
 E  S LOC=$G(ORL),TRSPEC=$G(ORTS)
"RTN","ORCSAVE",61,0)
 S TYPE=$S("^B^C^X^P^0^"[(U_$G(ORSRC)_U):ORSRC,$G(ORDCNTRL)="SN":"P",1:0)
"RTN","ORCSAVE",62,0)
 S LOG=$S($G(ORLOG):ORLOG,1:+$E(NOW,1,12)),USR=$S($G(ORDUZ):ORDUZ,1:DUZ)
"RTN","ORCSAVE",63,0)
 S NATR=+$O(^ORD(100.02,"C","E",0)) ;assume Elec Entered until changed
"RTN","ORCSAVE",64,0)
 S STS=$S($G(OREVENT):10,1:11),ORIFN=$$NEXTIFN Q:'ORIFN
"RTN","ORCSAVE",65,0)
EN1 S ^OR(100,ORIFN,0)=ORIFN_U_ORVP_U_U_$G(ORNP)_U_+ORDIALOG_";ORD(101.41,^"_USR_U_LOG_U_U_U_LOC_U_DG_U_CATG_U_TRSPEC_U_PKG_U_U_SIGNREQD_U_$G(OREVENT)_U_$G(ORAPPT)
"RTN","ORCSAVE",66,0)
 S ^OR(100,ORIFN,3)=LOG_"^90^"_STS_U_$S($G(ORIT):ORIT_";ORD(101.41,",1:"")_U_$G(ORDIALOG("PREV"))_"^^1^^^^"_TYPE
"RTN","ORCSAVE",67,0)
 S ^OR(100,ORIFN,8,0)="^100.008DA^1^1",^OR(100,ORIFN,8,1,0)=LOG_"^NW^"_$G(ORNP)_U_$S(SIGNREQD:2,1:3)_"^^^^^^^^"_NATR_U_USR_"^1^"_STS,^OR(100,ORIFN,8,"C","NW",1)=""
"RTN","ORCSAVE",68,0)
 S ^OR(100,"AF",LOG,ORIFN,1)=""
"RTN","ORCSAVE",69,0)
 S ^OR(100,"ACT",ORVP,9999999-LOG,+DG,ORIFN,1)=""
"RTN","ORCSAVE",70,0)
 S:STS'=10 ^OR(100,"AC",ORVP,9999999-LOG,ORIFN,1)=""
"RTN","ORCSAVE",71,0)
 S:SIGNREQD ^OR(100,"AS",ORVP,9999999-LOG,ORIFN,1)=""
"RTN","ORCSAVE",72,0)
 S:$G(OREVENT) ^OR(100,"AEVNT",ORVP,OREVENT,ORIFN)=""
"RTN","ORCSAVE",73,0)
EN2 S ORIFN=+ORIFN D RESPONSE ; save responses
"RTN","ORCSAVE",74,0)
 I $P(^OR(100,ORIFN,0),"^",5) D  ;Copy orders PKI fix
"RTN","ORCSAVE",75,0)
 . N OI
"RTN","ORCSAVE",76,0)
 . S OI=+$O(^OR(100,ORIFN,4.5,"ID","ORDERABLE",0)),OI=+$G(^OR(100,ORIFN,4.5,OI,1)) Q:'OI
"RTN","ORCSAVE",77,0)
 . I PKG'=$O(^DIC(9.4,"B","OUTPATIENT PHARMACY",0)) Q
"RTN","ORCSAVE",78,0)
 . D PKI^ORWDPS1(.ORY,OI,CATG,+ORVP,$$GET^XPAR("ALL^USR.`"_DUZ,"ORWOR PKI USE",1,"Q"))
"RTN","ORCSAVE",79,0)
 . I $E($G(ORY))=2 S ORDEA=ORY
"RTN","ORCSAVE",80,0)
 K ^OR(100,ORIFN,8,1,.1) D ORDTEXT^ORCSAVE1(ORIFN_";1") ; order text
"RTN","ORCSAVE",81,0)
 S NODE=$G(^OR(100,ORIFN,0)) D  S ^OR(100,ORIFN,0)=NODE
"RTN","ORCSAVE",82,0)
 . S $P(NODE,U,4)=$G(ORNP) ; COST?
"RTN","ORCSAVE",83,0)
 . S I=$O(^OR(100,ORIFN,4.5,"ID","LOCATION",0))
"RTN","ORCSAVE",84,0)
 . I I,$P(NODE,U,10) S X=+$G(^OR(100,ORIFN,4.5,+I,1)) S:X $P(NODE,U,10)=X_";SC(" ;reset Loc if prev value
"RTN","ORCSAVE",85,0)
 . S I=$O(^OR(100,ORIFN,4.5,"ID","CLASS",0))
"RTN","ORCSAVE",86,0)
 . I I S X=$G(^OR(100,ORIFN,4.5,+I,1)) S:"^I^O^"[(U_X_U) $P(NODE,U,12)=X
"RTN","ORCSAVE",87,0)
 S $P(^OR(100,ORIFN,3),U)=NOW
"RTN","ORCSAVE",88,0)
 K ^OR(100,ORIFN,9) I $G(ORCHECK) D  ; save order checks
"RTN","ORCSAVE",89,0)
 . S (CNT,CDL)=0 F  S CDL=$O(ORCHECK("NEW",CDL)) Q:CDL'>0  S I=0 D
"RTN","ORCSAVE",90,0)
 . . F  S I=$O(ORCHECK("NEW",CDL,I)) Q:I'>0  S X=ORCHECK("NEW",CDL,I) D
"RTN","ORCSAVE",91,0)
 . . . S CNT=CNT+1,^OR(100,ORIFN,9,"B",+X,CNT)=""
"RTN","ORCSAVE",92,0)
 . . . S ^OR(100,ORIFN,9,CNT,0)=$P(X,U,1,2),^(1)=$E($P(X,U,3),1,245)
"RTN","ORCSAVE",93,0)
 . S:CNT ^OR(100,ORIFN,9,0)="^100.09PA^"_CNT_U_CNT
"RTN","ORCSAVE",94,0)
 K ORDEA
"RTN","ORCSAVE",95,0)
ENQ Q
"RTN","ORCSAVE",96,0)
 ;
"RTN","ORCSAVE",97,0)
NEXTIFN() ; -- Returns next available ORIFN
"RTN","ORCSAVE",98,0)
 N I,HDR,LAST,TOTAL,DA
"RTN","ORCSAVE",99,0)
 F I=1:1:10 L +^OR(100,0):1 Q:$T  H 2
"RTN","ORCSAVE",100,0)
 I '$T Q "^"
"RTN","ORCSAVE",101,0)
 S HDR=$G(^OR(100,0)),TOTAL=+$P(HDR,U,4),LAST=$O(^OR(100,"?"),-1)
"RTN","ORCSAVE",102,0)
 S I=LAST\1 F I=(I+1):1 Q:'$D(^OR(100,I,0))
"RTN","ORCSAVE",103,0)
 S DA=I,^OR(100,DA,0)=DA,$P(HDR,U,3,4)=DA_U_(TOTAL+1)
"RTN","ORCSAVE",104,0)
 S ^OR(100,0)=HDR L -^OR(100,0)
"RTN","ORCSAVE",105,0)
 Q DA
"RTN","ORCSAVE",106,0)
 ;
"RTN","ORCSAVE",107,0)
RESPONSE ; -- Save responses in ORDIALOG() into ^OR(100,ORIFN,4.5)
"RTN","ORCSAVE",108,0)
 N PROMPT,CNT,ITM,TYPE,INST,VALUE,I,START,PAT,X
"RTN","ORCSAVE",109,0)
 S PAT=$P(^OR(100,ORIFN,0),U,2),START=$P(^(0),U,8) K ^(4.5)
"RTN","ORCSAVE",110,0)
 S (PROMPT,CNT)=0 F  S PROMPT=$O(ORDIALOG(PROMPT)) Q:PROMPT'>0  D
"RTN","ORCSAVE",111,0)
 . S ITM=$G(ORDIALOG(PROMPT)) Q:'ITM
"RTN","ORCSAVE",112,0)
 . S TYPE=$E($G(ORDIALOG(PROMPT,0))) Q:'$L(TYPE)
"RTN","ORCSAVE",113,0)
 . S INST=0 F  S INST=$O(ORDIALOG(PROMPT,INST)) Q:INST'>0  D
"RTN","ORCSAVE",114,0)
 . . S VALUE=$G(ORDIALOG(PROMPT,INST)) Q:VALUE=""  S CNT=CNT+1
"RTN","ORCSAVE",115,0)
 . . S ^OR(100,ORIFN,4.5,CNT,0)=+ITM_U_PROMPT_U_INST_U_$P(ITM,U,2)
"RTN","ORCSAVE",116,0)
 . . S:$L($P(ITM,U,2)) ^OR(100,ORIFN,4.5,"ID",$P(ITM,U,2),CNT)=""
"RTN","ORCSAVE",117,0)
 . . I VALUE<1,TYPE="N" S VALUE=0_+VALUE I VALUE="00" S VALUE=0
"RTN","ORCSAVE",118,0)
 . . S:TYPE'="W" ^OR(100,ORIFN,4.5,CNT,1)=VALUE
"RTN","ORCSAVE",119,0)
 . . M:TYPE="W" ^OR(100,ORIFN,4.5,CNT,2)=@VALUE ; array root
"RTN","ORCSAVE",120,0)
 S ^OR(100,ORIFN,4.5,0)="^100.045A^"_CNT_U_CNT
"RTN","ORCSAVE",121,0)
R1 ; [Reset] Orderables
"RTN","ORCSAVE",122,0)
 I $D(^OR(100,ORIFN,.1)) S I=0 F  S I=$O(^OR(100,ORIFN,.1,I)) Q:I'>0  S X=$G(^(I,0)) I X,PAT,START K ^OR(100,"AOI",X,PAT,9999999-START,ORIFN) ; kill xref
"RTN","ORCSAVE",123,0)
 K ^OR(100,ORIFN,.1) I $D(^OR(100,ORIFN,4.5,"ID","ORDERABLE")) D
"RTN","ORCSAVE",124,0)
 . S (I,CNT)=0
"RTN","ORCSAVE",125,0)
 . F  S I=$O(^OR(100,ORIFN,4.5,"ID","ORDERABLE",I)) Q:I'>0  D
"RTN","ORCSAVE",126,0)
 . . S X=$G(^OR(100,ORIFN,4.5,I,1)) Q:'X
"RTN","ORCSAVE",127,0)
 . . S CNT=CNT+1,^OR(100,ORIFN,.1,CNT,0)=X,^OR(100,ORIFN,.1,"B",X,CNT)=""
"RTN","ORCSAVE",128,0)
 . . I PAT,START S ^OR(100,"AOI",X,PAT,9999999-START,ORIFN)=""
"RTN","ORCSAVE",129,0)
 . S ^OR(100,ORIFN,.1,0)="^100.001PA^"_CNT_U_CNT
"RTN","ORCSAVE",130,0)
 Q
"RTN","ORCSAVE",131,0)
 ;
"RTN","ORCSAVE",132,0)
RESUME(IFN) ; -- add Response nodes for RESUME tray service
"RTN","ORCSAVE",133,0)
 ; S ^OR(100,+IFN,4.5,<next>,0)=DT_"^^^RESUME",^(1)=1
"RTN","ORCSAVE",134,0)
 ;
"RTN","ORCSAVE",135,0)
 N X,Y,DA,DIC
"RTN","ORCSAVE",136,0)
 S DIC="^OR(100,"_+IFN_",4.5,",DIC(0)="LX",DA(1)=+IFN,X=DT
"RTN","ORCSAVE",137,0)
 S DIC("DR")=".04///RESUME",DIC("P")=$P(^DD(100,4.5,0),U,2)
"RTN","ORCSAVE",138,0)
 D ^DIC S:Y ^OR(100,+IFN,4.5,+Y,1)=1
"RTN","ORCSAVE",139,0)
 Q
"RTN","ORCSAVE",140,0)
 ;
"RTN","ORCSAVE",141,0)
PROVIDER(ORDER,PROV) ; -- Change PROVider assigned to ORDER
"RTN","ORCSAVE",142,0)
 Q:'$G(ORDER)  Q:'$G(PROV)
"RTN","ORCSAVE",143,0)
 N ORACT S ORACT=+$P(ORDER,";",2) S:'ORACT ORACT=1
"RTN","ORCSAVE",144,0)
 S $P(^OR(100,+ORDER,8,ORACT,0),U,3)=PROV
"RTN","ORCSAVE",145,0)
 S:ORACT=1 $P(^OR(100,+ORDER,0),U,4)=PROV
"RTN","ORCSAVE",146,0)
 Q
"RTN","ORCSAVE",147,0)
 ;
"RTN","ORCSAVE",148,0)
ACTION(CODE,DA,PROV,REASON,WHEN,WHO) ; -- save new action
"RTN","ORCSAVE",149,0)
 N NEXT,TOTAL,HDR,LAST,X,PAT,DGRP,SIG,NATR,TXT S DA=+DA
"RTN","ORCSAVE",150,0)
 Q:'$D(^OR(100,DA,0)) 0 Q:$G(CODE)'?2U 0
"RTN","ORCSAVE",151,0)
 S:'$G(WHEN) WHEN=+$E($$NOW^XLFDT,1,12) S:'$G(WHO) WHO=DUZ
"RTN","ORCSAVE",152,0)
 S NATR=+$O(^ORD(100.02,"C","E",0)) ;assume Elec Entered until changed
"RTN","ORCSAVE",153,0)
 S PAT=$P(^OR(100,DA,0),U,2),DGRP=$P(^(0),U,11),SIG=$P(^(0),U,16),X=+$P($G(^(3)),U,7),HDR=$G(^(8,0))
"RTN","ORCSAVE",154,0)
 S:X'>0 X=1 S TXT=$P($G(^OR(100,DA,8,X,0)),U,14) ;current actn's txt ptr
"RTN","ORCSAVE",155,0)
 S:HDR="" HDR="^100.008DA^^" S TOTAL=+$P(HDR,U,4)
"RTN","ORCSAVE",156,0)
 S LAST=$O(^OR(100,DA,8,"C",CODE,"?"),-1) I LAST D
"RTN","ORCSAVE",157,0)
 . S X=$G(^OR(100,DA,8,LAST,0)) Q:$P(X,U,15)'=11  Q:$P(X,U,4)'=2
"RTN","ORCSAVE",158,0)
 . S NEXT=LAST I PAT,$P(X,U) D  ; kill old xref entries
"RTN","ORCSAVE",159,0)
 . . K:DGRP ^OR(100,"ACT",PAT,(9999999-$P(X,U)),DGRP,DA,NEXT)
"RTN","ORCSAVE",160,0)
 . . K ^OR(100,"AC",PAT,(9999999-$P(X,U)),DA,NEXT),^OR(100,"AS",PAT,(9999999-$P(X,U)),DA,NEXT),^OR(100,"AF",$P(X,U),DA,NEXT)
"RTN","ORCSAVE",161,0)
 S:'$G(NEXT) NEXT=$O(^OR(100,DA,8,"?"),-1)+1,TOTAL=TOTAL+1
"RTN","ORCSAVE",162,0)
 S ^OR(100,DA,8,NEXT,0)=WHEN_U_CODE_U_$G(PROV)_U_$S(SIG:2,1:3)_"^^^^^^^^"_NATR_U_WHO_U_TXT_"^11",^OR(100,DA,8,"C",CODE,NEXT)=""
"RTN","ORCSAVE",163,0)
 S ^OR(100,"AF",WHEN,DA,NEXT)=""
"RTN","ORCSAVE",164,0)
 I PAT,DGRP S ^OR(100,"ACT",PAT,9999999-WHEN,DGRP,DA,NEXT)=""
"RTN","ORCSAVE",165,0)
 I PAT S ^OR(100,"AC",PAT,9999999-WHEN,DA,NEXT)=""
"RTN","ORCSAVE",166,0)
 I SIG S ^OR(100,"AS",PAT,9999999-WHEN,DA,NEXT)=""
"RTN","ORCSAVE",167,0)
 S:$L($G(REASON)) ^OR(100,DA,8,NEXT,1)=REASON
"RTN","ORCSAVE",168,0)
 S $P(HDR,U,3,4)=NEXT_U_TOTAL,^OR(100,DA,8,0)=HDR
"RTN","ORCSAVE",169,0)
 Q NEXT
"RTN","ORCSAVE",170,0)
 ;
"RTN","ORCSAVE",171,0)
SET(DLG) ; -- Create new parent for order set ORDIALOG
"RTN","ORCSAVE",172,0)
 ; Returns ORPIFN = ifn of new parent order for set
"RTN","ORCSAVE",173,0)
 ;
"RTN","ORCSAVE",174,0)
 Q:'$G(ORVP)  Q:'$G(DLG)  N OR0,PKG,NOW,CATG,STS,ORLOC,TRSPEC,X
"RTN","ORCSAVE",175,0)
 S OR0=$G(^ORD(101.41,DLG,0)) Q:OR0=""  S ORPIFN=$$NEXTIFN Q:'ORPIFN
"RTN","ORCSAVE",176,0)
 S PKG=$O(^DIC(9.4,"C","OR",0)),CATG=$S($$INPT^ORCD:"I",1:"O"),STS=$S($G(OREVENT):10,1:11),NOW=$S($G(ORSLOG):ORSLOG,1:+$E($$NOW^XLFDT,1,12))
"RTN","ORCSAVE",177,0)
 I $G(OREVENT) S ORLOC="",TRSPEC=""
"RTN","ORCSAVE",178,0)
 S ^OR(100,ORPIFN,0)=ORPIFN_U_ORVP_U_U_$G(ORNP)_U_DLG_";ORD(101.41,^"_DUZ_U_NOW_U_U_U_ORLOC_U_U_CATG_U_TRSPEC_U_PKG_"^^^"_$G(OREVENT),^(3)=NOW_"^90^"_STS_U_$S($G(ORIT):ORIT_"ORD(101.41,",1:"")_"^^^1^^^^0^^"_+$P(OR0,U,6)
"RTN","ORCSAVE",179,0)
 S ^OR(100,ORPIFN,8,0)="^100.008DA^1^1",^(1,0)=NOW_"^NW^"_$G(ORNP)_"^^^^^^^^^^"_DUZ_"^^"_STS,^OR(100,ORPIFN,8,"C","NW",1)="",^OR(100,"AF",NOW,ORPIFN,1)=""
"RTN","ORCSAVE",180,0)
 S ^OR(100,"ACT",ORVP,9999999-NOW,ORPIFN,1)=""
"RTN","ORCSAVE",181,0)
 S:STS=11 ^OR(100,"AC",ORVP,9999999-NOW,ORPIFN,1)=""
"RTN","ORCSAVE",182,0)
 ; AEVNT ??
"RTN","ORCSAVE",183,0)
 S ^OR(100,ORPIFN,1,0)="^100.011^1^1",^(1,0)=$P(OR0,U,2) ; Order text
"RTN","ORCSAVE",184,0)
 Q
"RTN","ORCSAVE1")
0^154^B30031657
"RTN","ORCSAVE1",1,0)
ORCSAVE1 ; SLC/MKB - Save Order Text ;02/22/07
"RTN","ORCSAVE1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**92,132,141,163,187,223,243**;Dec 17, 1997;Build 242
"RTN","ORCSAVE1",3,0)
 ;
"RTN","ORCSAVE1",4,0)
 ; ^ORD(101.41,+ORDIALOG,10,ITM,2)=Seq#^Format^Omit^Lead Text^Trail Text
"RTN","ORCSAVE1",5,0)
 ; ^ORD(101.41,+ORDIALOG,10,"ATXT",Seq#,ITM)=""
"RTN","ORCSAVE1",6,0)
 ;
"RTN","ORCSAVE1",7,0)
ORDTEXT(ORDER) ; -- Build and save order text from ORDIALOG() into ORDER
"RTN","ORCSAVE1",8,0)
 N ORTX,I,IFN,ACT,ORSET
"RTN","ORCSAVE1",9,0)
 D ORTX(240) Q:'$G(ORTX)
"RTN","ORCSAVE1",10,0)
 S IFN=+ORDER,ACT=+$P(ORDER,";",2) S:ACT'>0 ACT=1
"RTN","ORCSAVE1",11,0)
 F I=1:1:ORTX S ^OR(100,IFN,8,ACT,.1,I,0)=ORTX(I)
"RTN","ORCSAVE1",12,0)
 S ^OR(100,IFN,8,ACT,.1,0)=U_U_ORTX_U_ORTX_U_DT_U
"RTN","ORCSAVE1",13,0)
 I $E($G(ORDEA))=2 D  ;PKI Drug Schedule - in future may allow 2-5
"RTN","ORCSAVE1",14,0)
 . S ORSET=0
"RTN","ORCSAVE1",15,0)
 . D DIGTEXT(IFN,ORDEA)
"RTN","ORCSAVE1",16,0)
 . F I=1:1:ORSET S ^OR(100,IFN,8,ACT,.2,I,0)=ORSET(I)
"RTN","ORCSAVE1",17,0)
 . I ORSET>0 S ^OR(100,IFN,8,ACT,.2,0)=U_U_ORSET_U_ORSET_U_DT_U
"RTN","ORCSAVE1",18,0)
 Q
"RTN","ORCSAVE1",19,0)
 ;
"RTN","ORCSAVE1",20,0)
ORTX(WIDTH) ; -- May enter here to return order text in ORTX()
"RTN","ORCSAVE1",21,0)
 N ORP,SEQ,ITEM,ORMAX,IVIEN,IVITEM,IVTYPE,RATE
"RTN","ORCSAVE1",22,0)
 K ORTX S ORMAX=$S(+$G(WIDTH):WIDTH,1:240)
"RTN","ORCSAVE1",23,0)
 D EXT ; get external form of values
"RTN","ORCSAVE1",24,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"ATXT",SEQ)) Q:SEQ'>0  D
"RTN","ORCSAVE1",25,0)
 . S ITEM=0 F  S ITEM=$O(^ORD(101.41,+ORDIALOG,10,"ATXT",SEQ,ITEM)) Q:ITEM'>0  D TEXT(ITEM)
"RTN","ORCSAVE1",26,0)
 Q
"RTN","ORCSAVE1",27,0)
 ;
"RTN","ORCSAVE1",28,0)
TEXT(DA) ; -- Includes text of item DA
"RTN","ORCSAVE1",29,0)
 Q:$P(^ORD(101.41,ORDIALOG,10,DA,0),U,11)  Q:'$O(ORP(DA,0))
"RTN","ORCSAVE1",30,0)
 N NEWLN,INST,TYPE,PTR,CHSEQ,CHILD,ORI,X,Y
"RTN","ORCSAVE1",31,0)
 S:'$G(ORTX) ORTX=1,ORTX(1)=""
"RTN","ORCSAVE1",32,0)
 S NEWLN=+$P(ORP(DA),U,4),INST=$O(ORP(DA,0)),Y=""
"RTN","ORCSAVE1",33,0)
 I NEWLN,$L(ORTX(ORTX)) S ORTX=ORTX+1,ORTX(ORTX)="",Y=" "
"RTN","ORCSAVE1",34,0)
 S X=$$GETXT($P(ORP(DA),U,2)) I $L(X) S X=Y_X,Y="" D TXT^ORCHTAB ;lead tx
"RTN","ORCSAVE1",35,0)
 S PTR=+ORP(DA),TYPE=$E(ORDIALOG(PTR,0))
"RTN","ORCSAVE1",36,0)
TXT1 I TYPE'="W" S X=Y_ORP(DA,INST),Y="" D TXT^ORCHTAB
"RTN","ORCSAVE1",37,0)
 I TYPE="W" S ORI=0 F  S ORI=$O(ORP(DA,INST,ORI)) Q:ORI'>0  D  S Y=""
"RTN","ORCSAVE1",38,0)
 . S Y=$S(Y=" ":" ",$P(ORP(DA),U,5):" ",1:"") ;new line, or as stored
"RTN","ORCSAVE1",39,0)
 . S X=Y_ORP(DA,INST,ORI,0),Y=""
"RTN","ORCSAVE1",40,0)
 . I $E(X)'=" " D TXT^ORCHTAB Q  ; wrap
"RTN","ORCSAVE1",41,0)
 . S:$L(ORTX(ORTX)) ORTX=ORTX+1,ORTX(ORTX)="" ; force new line
"RTN","ORCSAVE1",42,0)
 . I X?1." " S ORTX(ORTX)=" ",ORTX=ORTX+1,ORTX(ORTX)="" ; blank line
"RTN","ORCSAVE1",43,0)
 . E  D TXT^ORCHTAB
"RTN","ORCSAVE1",44,0)
 D:$D(^ORD(101.41,+ORDIALOG,10,"DAD",PTR)) CHILD(PTR)
"RTN","ORCSAVE1",45,0)
 S INST=$O(ORP(DA,INST)) ; multiple?
"RTN","ORCSAVE1",46,0)
 I INST S ORTX(ORTX)=ORTX(ORTX)_",",Y="" S:NEWLN ORTX=ORTX+1,ORTX(ORTX)="",Y=" " G TXT1
"RTN","ORCSAVE1",47,0)
 S X=$$GETXT($P(ORP(DA),U,3)) D:$L(X) TXT^ORCHTAB ; trailing text
"RTN","ORCSAVE1",48,0)
 Q
"RTN","ORCSAVE1",49,0)
 ;
"RTN","ORCSAVE1",50,0)
CHILD(PARENT) ; -- add child values
"RTN","ORCSAVE1",51,0)
 N CHSEQ,CHILD S CHSEQ=0
"RTN","ORCSAVE1",52,0)
 F  S CHSEQ=$O(^ORD(101.41,+ORDIALOG,10,"DAD",PARENT,CHSEQ)) Q:CHSEQ'>0  S CHILD=$O(^(CHSEQ,0)) D
"RTN","ORCSAVE1",53,0)
 . Q:'$L($G(ORP(CHILD,INST)))
"RTN","ORCSAVE1",54,0)
 . S X=$$GETXT($P(ORP(CHILD),U,2)) D:$L(X) TXT^ORCHTAB ; lead text
"RTN","ORCSAVE1",55,0)
 . S X=ORP(CHILD,INST) D TXT^ORCHTAB
"RTN","ORCSAVE1",56,0)
 . S X=$$GETXT($P(ORP(CHILD),U,3)) D:$L(X) TXT^ORCHTAB ; trail text
"RTN","ORCSAVE1",57,0)
 Q
"RTN","ORCSAVE1",58,0)
 ;
"RTN","ORCSAVE1",59,0)
GETXT(X) ; -- Returns text of X
"RTN","ORCSAVE1",60,0)
 I $E(X)="@" N VAR S VAR=$E(X,2,99),X=$G(@VAR) K @VAR ; variable w/text
"RTN","ORCSAVE1",61,0)
 Q X
"RTN","ORCSAVE1",62,0)
 ;
"RTN","ORCSAVE1",63,0)
EXT ; -- Build ORP(DA) array of external forms
"RTN","ORCSAVE1",64,0)
 N PROMPT,INST,DA,NODE,FORMAT,OMIT,X,Y,TYPE,PTR
"RTN","ORCSAVE1",65,0)
 S PROMPT=0 F  S PROMPT=$O(ORDIALOG(PROMPT)) Q:PROMPT'>0  D
"RTN","ORCSAVE1",66,0)
 . S DA=+$G(ORDIALOG(PROMPT)),TYPE=$E($G(ORDIALOG(PROMPT,0))) Q:'$L(TYPE)
"RTN","ORCSAVE1",67,0)
 . Q:'DA  S NODE=$G(^ORD(101.41,ORDIALOG,10,DA,2)),FORMAT=$P(NODE,U,2),OMIT=$P(NODE,U,3)
"RTN","ORCSAVE1",68,0)
 . S:$D(ORDIALOG(PROMPT,"FORMAT")) FORMAT=ORDIALOG(PROMPT,"FORMAT")
"RTN","ORCSAVE1",69,0)
 . I $E(FORMAT)="@" S PTR=+$E(FORMAT,2,99) Q:'PTR  ; Don't include
"RTN","ORCSAVE1",70,0)
 . S INST=0 F  S INST=$O(ORDIALOG(PROMPT,INST)) Q:INST'>0  D
"RTN","ORCSAVE1",71,0)
 . . Q:ORDIALOG(PROMPT,INST)=""
"RTN","ORCSAVE1",72,0)
 . . I $E(FORMAT)="@",$L($G(ORDIALOG(PTR,INST))) Q  ; use PTR instead
"RTN","ORCSAVE1",73,0)
 . . I $E(FORMAT)="*" S PTR=+$E(FORMAT,2,99) I '$L($G(ORDIALOG(PTR,INST))) Q  ; must have PTR too
"RTN","ORCSAVE1",74,0)
 . . I $E(FORMAT)="=" S PTR=+$E(FORMAT,2,99) I PTR,$L($G(ORDIALOG(PTR,INST))) S Y=$$EXT^ORCD(PTR,INST),X=$$EXT^ORCD(PROMPT,INST) I (X=Y)!(X[Y)!(Y[X) Q
"RTN","ORCSAVE1",75,0)
 . . I TYPE="W" M ORP(DA,INST)=@ORDIALOG(PROMPT,INST)
"RTN","ORCSAVE1",76,0)
 . . E  S X=$$EXT^ORCD(PROMPT,INST,FORMAT) Q:X=""  Q:OMIT[X  S ORP(DA,INST)=X
"RTN","ORCSAVE1",77,0)
 . . S ORP(DA)=PROMPT_U_$P(NODE,U,4,7) ; ptr^lead^trail^new line^wrap
"RTN","ORCSAVE1",78,0)
 Q
"RTN","ORCSAVE1",79,0)
DIGTEXT(ORDER,ORDEA,ORSIGNER)  ;Build text used to create Digital Signature
"RTN","ORCSAVE1",80,0)
 ;ORDER = ifn of order # (file 100)
"RTN","ORCSAVE1",81,0)
 ;ORDEA = Controlled substance schedule of drug (2-5)
"RTN","ORCSAVE1",82,0)
 ;ORSIGNER = DUZ of sigining physician
"RTN","ORCSAVE1",83,0)
 ;ORSET(1)=1)Date of Prescription (RX) -Date Ordered HL7 format 2)Full Patient Name 3)Patient SSN 4)DFN
"RTN","ORCSAVE1",84,0)
 ;ORSET(2)=5)Patient Street1 6)Patient Street2 7)Patient Street3 8)Patient City 9)Patient State 10)Patient Zip 11)???
"RTN","ORCSAVE1",85,0)
 ;ORSET(3)=12)Drug name (From Dispense Drug or Orderable Item) 13)Variable ptr for Drug (file 50 or 101.43) 14)Drug quantity prescribed 15)Schedule of medication 16)DEA Schedule
"RTN","ORCSAVE1",86,0)
 ;ORSET(4)=17)Direction for use
"RTN","ORCSAVE1",87,0)
 ;ORSET(5)=18)Practitioner's name 19)DUZ 20)Practitioner's (DEA) registration number
"RTN","ORCSAVE1",88,0)
 ;ORSET(6)=22)SiteName 23)SiteStreet1 24)SiteStreet2 25)SiteCity 26)SiteState 27)SiteZip
"RTN","ORCSAVE1",89,0)
 ;ORSET(7)=28)$H
"RTN","ORCSAVE1",90,0)
 N I,DFN,OR80,ORPNM,ORSSN,ORXDT,VAERR,VAPA,X0,X1,X4,X5,X6,X8,X9,X10,X11,X12,X13,X14,SIG
"RTN","ORCSAVE1",91,0)
 S OR80=$G(^OR(100,ORDER,8,1,0))
"RTN","ORCSAVE1",92,0)
 Q:'$L(OR80)
"RTN","ORCSAVE1",93,0)
 S:'$G(ORSIGNER) ORSIGNER=$P(OR80,"^",3)
"RTN","ORCSAVE1",94,0)
 Q:'ORSIGNER
"RTN","ORCSAVE1",95,0)
 S $P(^OR(100,ORDER,8,1,2),"^",4,5)=ORDEA_"^"_1 ;Flag to signing process to get digital signature
"RTN","ORCSAVE1",96,0)
 S ORXDT=$P(OR80,"^"),X1=$$FMTHL7^XLFDT(ORXDT),X4="",X14="",X10=""
"RTN","ORCSAVE1",97,0)
 I '$D(ORVP) S ORVP=$P(^OR(100,ORDER,0),"^",2)
"RTN","ORCSAVE1",98,0)
 S DFN=+ORVP
"RTN","ORCSAVE1",99,0)
 D ADD^VADPT
"RTN","ORCSAVE1",100,0)
 S ORPNM=^DPT(+ORVP,0),ORSSN=$P(ORPNM,"^",9),ORPNM=$P(ORPNM,"^")
"RTN","ORCSAVE1",101,0)
 F I=1:1:6 S X4=X4_$S($L($G(VAPA(I))):$S((I=5):$P(VAPA(I),"^",2),1:VAPA(I)),1:"")_"^"
"RTN","ORCSAVE1",102,0)
 S X11=$$GET1^DIQ(200,ORSIGNER,.01,"E") Q:'$L(X11)
"RTN","ORCSAVE1",103,0)
 S X12=$$DEA^XUSER(,ORSIGNER)
"RTN","ORCSAVE1",104,0)
 S X0=$$GET1^DIQ(4,+$G(DUZ(2)),.01,"E")
"RTN","ORCSAVE1",105,0)
 I $L(X0) S X14=X0_"^"_$$GET1^DIQ(4,DUZ(2),1.01,"E")_"^"_$$GET1^DIQ(4,DUZ(2),1.02,"E")_"^"_$$GET1^DIQ(4,DUZ(2),1.03,"E")_"^"_$$GET1^DIQ(4,DUZ(2),.02,"E")_"^"_$$GET1^DIQ(4,DUZ(2),1.04,"E")
"RTN","ORCSAVE1",106,0)
 S X5=$$VALUE^ORX8(ORDER,"DRUG",,"E"),X6=$$VALUE^ORX8(ORDER,"DRUG")_";50"
"RTN","ORCSAVE1",107,0)
 I '$L(X5) S X5=$$VALUE^ORX8(ORDER,"ORDERABLE",,"E"),X6=$$VALUE^ORX8(ORDER,"ORDERABLE")_";101.43"
"RTN","ORCSAVE1",108,0)
 S X8=$$VALUE^ORX8(ORDER,"QTY",,"E"),X9=$$VALUE^ORX8(ORDER,"SCHEDULE",,"E")
"RTN","ORCSAVE1",109,0)
 S SIG=+$O(^OR(100,ORDER,4.5,"ID","SIG",0)) I SIG,$L($G(^OR(100,ORDER,4.5,SIG,2,1,0))) S X10=^(0)
"RTN","ORCSAVE1",110,0)
 S ORSET(1)=X1_"^"_ORPNM_"^"_ORSSN_"^"_+ORVP_"^"
"RTN","ORCSAVE1",111,0)
 S ORSET(2)=X4_"^"
"RTN","ORCSAVE1",112,0)
 S ORSET(3)=X5_"^"_X6_"^"_X8_"^"_X9_"^"_ORDEA_"^"
"RTN","ORCSAVE1",113,0)
 S ORSET(4)=X10_"^"
"RTN","ORCSAVE1",114,0)
 S ORSET(5)=X11_"^"_ORSIGNER_"^"_X12_"^"
"RTN","ORCSAVE1",115,0)
 S ORSET(6)=X14
"RTN","ORCSAVE1",116,0)
 S ORSET(7)=$H
"RTN","ORCSAVE1",117,0)
 S ORSET=7
"RTN","ORCSAVE1",118,0)
 Q
"RTN","ORCSAVE2")
0^45^B68713994
"RTN","ORCSAVE2",1,0)
ORCSAVE2 ;SLC/MKB-Utilities to update an order ; 4/8/08 12:04pm
"RTN","ORCSAVE2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,27,56,70,94,116,190,157,215,265,243**;Dec 17, 1997;Build 242
"RTN","ORCSAVE2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ORCSAVE2",4,0)
 ;
"RTN","ORCSAVE2",5,0)
STATUS(IFN,ST) ; -- Update status of order
"RTN","ORCSAVE2",6,0)
 Q:'$G(IFN)  Q:'$D(^OR(100,+IFN,0))  Q:$P($G(^(3)),U,3)=$G(ST)  ;no change
"RTN","ORCSAVE2",7,0)
 Q:'$G(ST)  Q:'$D(^ORD(100.01,+ST,0))
"RTN","ORCSAVE2",8,0)
 N NODE0,NODE3,ORNOW,DA,XACT,PROV,ORVP
"RTN","ORCSAVE2",9,0)
 S NODE3=$G(^OR(100,+IFN,3)),ORVP=$P($G(^(0)),U,2),ORNOW=$$NOW^XLFDT
"RTN","ORCSAVE2",10,0)
 S $P(NODE3,U)=ORNOW,$P(NODE3,U,3)=ST,^OR(100,+IFN,3)=NODE3
"RTN","ORCSAVE2",11,0)
 I (ST<3)!(ST=12)!(ST=13),$G(ORDCNTRL)'="ZC" D DATES(+IFN,,+$E(ORNOW,1,12))
"RTN","ORCSAVE2",12,0)
 I "^1^2^7^12^13^15^"[(U_ST_U) D CANCEL^ORCSEND(+IFN),UNOTIF^ORCSIGN
"RTN","ORCSAVE2",13,0)
 I $P(NODE3,U,9) D CKPARENT($P(NODE3,U,9)) ; ck siblings to update parent
"RTN","ORCSAVE2",14,0)
 D SETALL^ORDD100(+IFN)
"RTN","ORCSAVE2",15,0)
 Q
"RTN","ORCSAVE2",16,0)
 ;
"RTN","ORCSAVE2",17,0)
CKPARENT(ORIFN) ; -- Update status of parent order, if appropriate
"RTN","ORCSAVE2",18,0)
 N ORSTS,ALLRELSD,ALLDONE,DC,COMP,CH,CHSTS,ACTIVE,LAPS
"RTN","ORCSAVE2",19,0)
 Q:'$D(^OR(100,ORIFN,0))  S ORSTS=$P($G(^(3)),U,3)
"RTN","ORCSAVE2",20,0)
 I (ORSTS=11)!(ORSTS=10) S ALLRELSD=1 D  Q  ;Parent unrel'd - ck children
"RTN","ORCSAVE2",21,0)
 . F CH=0:0 S CH=$O(^OR(100,ORIFN,2,CH)) Q:CH'>0  D  Q:'ALLRELSD
"RTN","ORCSAVE2",22,0)
 . . I '$D(^OR(100,CH)) K ^OR(100,ORIFN,2,CH) Q
"RTN","ORCSAVE2",23,0)
 . . S CHSTS=$P($G(^OR(100,CH,3)),U,3) S:CHSTS=11 ALLRELSD=0
"RTN","ORCSAVE2",24,0)
 . I ALLRELSD D STATUS(ORIFN,5) ; update Parent order to pending
"RTN","ORCSAVE2",25,0)
 S ALLDONE=1,(DC,COMP,LAPS,ACTIVE)=0
"RTN","ORCSAVE2",26,0)
 F CH=0:0 S CH=$O(^OR(100,ORIFN,2,CH)) Q:CH'>0  D  Q:'ALLDONE
"RTN","ORCSAVE2",27,0)
 . I '$D(^OR(100,CH)) K ^OR(100,ORIFN,2,CH) Q
"RTN","ORCSAVE2",28,0)
 . S CHSTS=$P($G(^OR(100,CH,3)),U,3) I CHSTS=14 S LAPS=1 Q
"RTN","ORCSAVE2",29,0)
 . I "^1^12^13^"[(U_CHSTS_U) S DC=1 Q
"RTN","ORCSAVE2",30,0)
 . I "^2^7^"[(U_CHSTS_U) S COMP=1 Q
"RTN","ORCSAVE2",31,0)
 . S ALLDONE=0 S:CHSTS=6 ACTIVE=1
"RTN","ORCSAVE2",32,0)
 I ALLDONE S ORSTS=$S(COMP:2,DC:1,LAPS:14,1:"") D:ORSTS STATUS(ORIFN,ORSTS) Q
"RTN","ORCSAVE2",33,0)
 I ACTIVE,ORSTS'=6 D STATUS(ORIFN,6) ;at least child active
"RTN","ORCSAVE2",34,0)
 Q
"RTN","ORCSAVE2",35,0)
 ;
"RTN","ORCSAVE2",36,0)
RELEASE(ORDER,ACTION,WHEN,WHO,NATURE) ; -- Mark order as released to service
"RTN","ORCSAVE2",37,0)
 S:'$G(ACTION) ACTION=1 S:'$G(WHEN) WHEN=+$E($$NOW^XLFDT,1,12) S:'$G(WHO) WHO=DUZ
"RTN","ORCSAVE2",38,0)
 Q:'$G(ORDER)  N OR0 S OR0=$G(^OR(100,ORDER,8,ACTION,0))
"RTN","ORCSAVE2",39,0)
 S:$L($G(NATURE)) $P(OR0,U,12)=$S(NATURE:NATURE,1:+$O(^ORD(100.02,"C",NATURE,0)))
"RTN","ORCSAVE2",40,0)
 S:($P(OR0,U,15)=10)!($P(OR0,U,15)=11) $P(OR0,U,15)=""
"RTN","ORCSAVE2",41,0)
 ;S $P(OR0,U,16,17)=WHEN_U_WHO,^OR(100,"AR",ORVP,9999999-WHEN,ORDER,ACTION)=""
"RTN","ORCSAVE2",42,0)
 S $P(OR0,U,16,17)=WHEN_U_WHO
"RTN","ORCSAVE2",43,0)
 S ^OR(100,ORDER,8,ACTION,0)=OR0
"RTN","ORCSAVE2",44,0)
 I $P(OR0,U,2)="NW",'$P(^OR(100,ORDER,0),U,8) D STARTDT(ORDER)
"RTN","ORCSAVE2",45,0)
 ;Set the "AR" index.
"RTN","ORCSAVE2",46,0)
 D RS^ORDD100(ORDER,ACTION,ORVP,WHEN)
"RTN","ORCSAVE2",47,0)
 Q
"RTN","ORCSAVE2",48,0)
 ;
"RTN","ORCSAVE2",49,0)
STARTDT(DA) ; -- resolve Start and Stop dates from Responses
"RTN","ORCSAVE2",50,0)
 N X,Y,%DT,ORDG,ORT,ORLAB
"RTN","ORCSAVE2",51,0)
 S ORDG=$P($G(^ORD(100.98,+$P(^OR(100,DA,0),U,11),0)),U,3)
"RTN","ORCSAVE2",52,0)
 S ORLAB="^LAB^CH^HEMA^MI^AP^AU^EM^SP^CY^BB^"[(U_ORDG_U),ORT=""
"RTN","ORCSAVE2",53,0)
 S:ORDG="E/L T" ORT=$$VALUE(DA,"TIME") S:ORDG="MEAL" ORT=$$MEALTIME^ORCDFHO(DA)
"RTN","ORCSAVE2",54,0)
STRT S X=$$VALUE(DA,"START") I '$L(X) D WS^ORDD100 Q  S:$L(ORT) X=X_"@"_ORT
"RTN","ORCSAVE2",55,0)
 D AM:X="AM",NEXT:X="NEXT",ADMIN("NEXT"):X="NEXTA",ADMIN("CLOSEST"):X="CLOSEST"
"RTN","ORCSAVE2",56,0)
 S %DT="T" D ^%DT Q:Y'>0  S:$E($P(Y,".",2),1,2)=24 Y=$P(Y,".")_".2359"
"RTN","ORCSAVE2",57,0)
 S $P(^OR(100,DA,0),U,8)=Y D SS^ORDD100,WS^ORDD100,OI1^ORDD100A(DA)
"RTN","ORCSAVE2",58,0)
STOP I ORLAB S X=$$VALUE(DA,"DAYS") Q:X'>1  S X=$$FMADD^XLFDT(Y,(X-1))
"RTN","ORCSAVE2",59,0)
 I 'ORLAB S X=$$VALUE(DA,"STOP") Q:'$L(X)  S:$L(ORT) X=X_"@"_ORT
"RTN","ORCSAVE2",60,0)
 S %DT="T" D ^%DT Q:Y'>0  S:$E($P(Y,".",2),1,2)=24 Y=$P(Y,".")_".2359"
"RTN","ORCSAVE2",61,0)
 S $P(^OR(100,DA,0),U,9)=Y D ES^ORDD100A
"RTN","ORCSAVE2",62,0)
 Q
"RTN","ORCSAVE2",63,0)
 ;
"RTN","ORCSAVE2",64,0)
NEXT ; -- Resolve next lab collection to FM date/time
"RTN","ORCSAVE2",65,0)
 N ORTIME,ORDAY,NOW,NEXT,ENT
"RTN","ORCSAVE2",66,0)
 ;is referenced by DBIA #964
"RTN","ORCSAVE2",67,0)
 S ENT=$S($P($G(^SC(+$G(ORL),0)),U,4):+$P(^(0),U,4),1:+$G(DUZ(2)))_";DIC(4," S:ENT'>0 ENT="ALL"
"RTN","ORCSAVE2",68,0)
 D GETLST^XPAR(.ORTIME,ENT,"LR PHLEBOTOMY COLLECTION","N")
"RTN","ORCSAVE2",69,0)
 S NOW=$P($H,",",2),ORDAY=$S($O(ORTIME(NOW)):"T",1:"T+1")
"RTN","ORCSAVE2",70,0)
 S ORDAY=$$NEXTCOLL^ORCDLR1(ORDAY) S:ORDAY["+" NOW=0
"RTN","ORCSAVE2",71,0)
 S NEXT=$O(ORTIME(NOW)),X=ORDAY_"@"_$P($G(ORTIME(+NEXT)),U)
"RTN","ORCSAVE2",72,0)
 Q
"RTN","ORCSAVE2",73,0)
 ;
"RTN","ORCSAVE2",74,0)
AM ; -- Resolve AM lab collection to FM date/time
"RTN","ORCSAVE2",75,0)
 N ORTIME,ORDAY,AM,NOW,ENT
"RTN","ORCSAVE2",76,0)
 ;is referenced by DBIA #964
"RTN","ORCSAVE2",77,0)
 S ENT=$S($P($G(^SC(+$G(ORL),0)),U,4):+$P(^(0),U,4),1:+$G(DUZ(2)))_";DIC(4," S:ENT'>0 ENT="ALL"
"RTN","ORCSAVE2",78,0)
 D GETLST^XPAR(.ORTIME,ENT,"LR PHLEBOTOMY COLLECTION","N")
"RTN","ORCSAVE2",79,0)
 S AM=$O(ORTIME(0)),NOW=$P($H,",",2)
"RTN","ORCSAVE2",80,0)
 S ORDAY=$S(AM=$O(ORTIME(NOW)):"T",1:"T+1")
"RTN","ORCSAVE2",81,0)
 S X=$$NEXTCOLL^ORCDLR1(ORDAY)_"@"_$P($G(ORTIME(+AM)),U)
"RTN","ORCSAVE2",82,0)
 Q
"RTN","ORCSAVE2",83,0)
 ;
"RTN","ORCSAVE2",84,0)
ADMIN(START) ; -- Resolve next/closest administration times to FM date/time
"RTN","ORCSAVE2",85,0)
 N PAT,SCH,OI,LOC,Y,I
"RTN","ORCSAVE2",86,0)
 I $G(DA) D  ;get data from order DA
"RTN","ORCSAVE2",87,0)
 . S PAT=+$P($G(^OR(100,DA,0)),U,2),LOC=""
"RTN","ORCSAVE2",88,0)
 . S I=+$O(^OR(100,DA,4.5,"ID","INSTR",0)),I=+$P($G(^OR(100,DA,4.5,I,0)),U,3) ;first
"RTN","ORCSAVE2",89,0)
 . S SCH=$$VALUE(DA,"SCHEDULE",I),OI=$$VALUE(DA,"ORDERABLE")
"RTN","ORCSAVE2",90,0)
 I '$G(DA) D  ;or look in ORDIALOG() instead
"RTN","ORCSAVE2",91,0)
 . S I=+$O(ORDIALOG($$PTR^ORCD("OR GTX INSTRUCTIONS"),0))
"RTN","ORCSAVE2",92,0)
 . S PAT=$G(ORVP),SCH=$G(ORDIALOG($$PTR^ORCD("OR GTX SCHEDULE"),I))
"RTN","ORCSAVE2",93,0)
 . S OI=$G(ORDIALOG($$PTR^ORCD("OR GTX ORDERABLE ITEM"),1)),LOC=""
"RTN","ORCSAVE2",94,0)
 S OI=+$P($G(^ORD(101.43,+OI,0)),U,2) ;PSOI
"RTN","ORCSAVE2",95,0)
 ;is referenced by DBIA #3167
"RTN","ORCSAVE2",96,0)
 S Y=$$RESOLVE^PSJORPOE(PAT,SCH,OI,START,LOC),X=$P(Y,U,2)
"RTN","ORCSAVE2",97,0)
 Q
"RTN","ORCSAVE2",98,0)
 ;
"RTN","ORCSAVE2",99,0)
SIGN(DA,WHO,WHEN,HOW,WHAT) ; -- affix ES to order
"RTN","ORCSAVE2",100,0)
 Q:'$G(DA)  S:'$G(WHAT) WHAT=1
"RTN","ORCSAVE2",101,0)
 N X S X=$G(^OR(100,DA,8,WHAT,0)) D S2^ORDD100(DA,WHAT) ; kill AS xref
"RTN","ORCSAVE2",102,0)
 S $P(X,U,4,7)=$G(HOW)_U_$G(WHO)_U_$E($G(WHEN),1,12)_U_$S(HOW=0:DUZ,1:"")
"RTN","ORCSAVE2",103,0)
 ; S:$G(WHO) $P(X,U,3)=WHO ; reset provider to signer
"RTN","ORCSAVE2",104,0)
 S ^OR(100,DA,8,WHAT,0)=X
"RTN","ORCSAVE2",105,0)
 D:$G(HOW)=2 S1^ORDD100(DA,WHAT) ; reset AS xref
"RTN","ORCSAVE2",106,0)
 Q
"RTN","ORCSAVE2",107,0)
 ;
"RTN","ORCSAVE2",108,0)
SIGSTS(IFN,ACT) ; -- Set SigSts for backdoor orders [Called from ^ORM* rtns]
"RTN","ORCSAVE2",109,0)
 ; Expects ORNATR, ORVP, ORNP to be defined
"RTN","ORCSAVE2",110,0)
 Q:'$G(IFN)  Q:'$G(ACT)  N X,OR0 S OR0=+$P($G(^OR(100,+IFN,8,ACT,0)),U)
"RTN","ORCSAVE2",111,0)
 S X=$S($$SIGNREQD^ORCACT1(+IFN):$$SIGSTS^ORX1(ORNATR),1:3)
"RTN","ORCSAVE2",112,0)
 K ^OR(100,"AS",ORVP,9999999-OR0,+IFN,ACT)
"RTN","ORCSAVE2",113,0)
 S $P(^OR(100,+IFN,8,ACT,0),U,4)=X
"RTN","ORCSAVE2",114,0)
 I X=2 S ^OR(100,"AS",ORVP,9999999-OR0,+IFN,ACT)="" D NOTIF^ORCSIGN
"RTN","ORCSAVE2",115,0)
 Q
"RTN","ORCSAVE2",116,0)
 ;
"RTN","ORCSAVE2",117,0)
UNVEIL(IFN) ; -- unveil new order
"RTN","ORCSAVE2",118,0)
 S $P(^OR(100,IFN,3),U,8)=""
"RTN","ORCSAVE2",119,0)
 Q
"RTN","ORCSAVE2",120,0)
 ;
"RTN","ORCSAVE2",121,0)
DELETE(ORDER) ; -- delete order [action]
"RTN","ORCSAVE2",122,0)
 N DIK,DA,DAD
"RTN","ORCSAVE2",123,0)
 I $P(ORDER,";",2)>1 S DA=+$P(ORDER,";",2),DA(1)=+ORDER,DIK="^OR(100,"_DA(1)_",8," D:DA ^DIK Q
"RTN","ORCSAVE2",124,0)
 S DAD=+$P($G(^OR(100,+ORDER,3)),U,9) I DAD S DIK="^OR(100,"_DAD_",2,",DA(1)=DAD,DA=+ORDER D ^DIK ; remove link to child from parent
"RTN","ORCSAVE2",125,0)
 K DA S DA=+ORDER,DIK="^OR(100," D ^DIK ;remove order, text
"RTN","ORCSAVE2",126,0)
 Q
"RTN","ORCSAVE2",127,0)
 ;
"RTN","ORCSAVE2",128,0)
VERIFY(IFN,DA,TYPE,WHO,WHEN) ; -- order verified
"RTN","ORCSAVE2",129,0)
 Q:'$G(IFN)  Q:'$G(DA)  Q:"^N^C^R^"'[(U_$G(TYPE)_U)
"RTN","ORCSAVE2",130,0)
 N FLD S FLD=$S(TYPE="N":8,TYPE="C":10,1:18)
"RTN","ORCSAVE2",131,0)
 S:'$G(WHO) WHO=DUZ S:'$G(WHEN) WHEN=+$E($$NOW^XLFDT,1,12)
"RTN","ORCSAVE2",132,0)
 S $P(^OR(100,IFN,8,DA,0),U,FLD,FLD+1)=WHO_U_WHEN
"RTN","ORCSAVE2",133,0)
 D:$L($T(VER^EDPFMON)) VER^EDPFMON(IFN)
"RTN","ORCSAVE2",134,0)
 Q
"RTN","ORCSAVE2",135,0)
 ;
"RTN","ORCSAVE2",136,0)
COMP(IFN,WHO,WHEN) ; -- order completed
"RTN","ORCSAVE2",137,0)
 Q:'$G(IFN)  S:'$G(WHO) WHO=DUZ S:'$G(WHEN) WHEN=+$E($$NOW^XLFDT,1,12)
"RTN","ORCSAVE2",138,0)
 D DATES(+IFN,,WHEN),STATUS(+IFN,2)
"RTN","ORCSAVE2",139,0)
 S $P(^OR(100,+IFN,6),U,6,7)=WHEN_U_WHO
"RTN","ORCSAVE2",140,0)
 D:$L($T(COMP^EDPFMON)) COMP^EDPFMON(IFN)
"RTN","ORCSAVE2",141,0)
 Q
"RTN","ORCSAVE2",142,0)
 ;
"RTN","ORCSAVE2",143,0)
DATES(DA,START,STOP) ; -- Update start/stop dates for order DA
"RTN","ORCSAVE2",144,0)
 Q:'$G(DA)  I $G(START) D
"RTN","ORCSAVE2",145,0)
 . Q:START=$P(^OR(100,DA,0),U,8)
"RTN","ORCSAVE2",146,0)
 . D SK^ORDD100,WK^ORDD100,OI2^ORDD100A(DA)
"RTN","ORCSAVE2",147,0)
 . S $P(^OR(100,DA,0),U,8)=START
"RTN","ORCSAVE2",148,0)
 . D SS^ORDD100,WS^ORDD100,OI1^ORDD100A(DA)
"RTN","ORCSAVE2",149,0)
 I $G(STOP) D
"RTN","ORCSAVE2",150,0)
 . ;Q:STOP=$P(^OR(100,DA,0),U,9)  ;ck xref anyway
"RTN","ORCSAVE2",151,0)
 . D EK^ORDD100A S $P(^OR(100,DA,0),U,9)=STOP D ES^ORDD100A
"RTN","ORCSAVE2",152,0)
 Q
"RTN","ORCSAVE2",153,0)
 ;
"RTN","ORCSAVE2",154,0)
OC ; -- Save order checks in ORCHECK() in ^OR(100,+ORIFN,9)
"RTN","ORCSAVE2",155,0)
 Q:'$G(ORIFN)  Q:'$D(^OR(100,+ORIFN,0))  K ^OR(100,+ORIFN,9)
"RTN","ORCSAVE2",156,0)
 N NOW,CNT,CDL,I,OC,OVERIDE S NOW=+$E($$NOW^XLFDT,1,12),CNT=0
"RTN","ORCSAVE2",157,0)
 S CDL=0 F  S CDL=$O(ORCHECK(+ORIFN,CDL)) Q:CDL'>0  D
"RTN","ORCSAVE2",158,0)
 . S I=0 F  S I=$O(ORCHECK(+ORIFN,CDL,I)) Q:I'>0  D
"RTN","ORCSAVE2",159,0)
 . . S OC=ORCHECK(+ORIFN,CDL,I) Q:'OC
"RTN","ORCSAVE2",160,0)
 . . S OVERIDE=$S($G(MODE)="NOTIF":$G(ORCHECK("OK"))_U,CDL=1:$G(ORCHECK("OK"))_U_DUZ,1:U_DUZ)_U_NOW
"RTN","ORCSAVE2",161,0)
 . . S CNT=CNT+1,^OR(100,+ORIFN,9,"B",+OC,CNT)=""
"RTN","ORCSAVE2",162,0)
 . . S ^OR(100,+ORIFN,9,CNT,0)=$P(OC,U,1,2)_U_U_OVERIDE,^(1)=$E($P(OC,U,3),1,245)
"RTN","ORCSAVE2",163,0)
 S:CNT ^OR(100,+ORIFN,9,0)="^100.09PA^"_CNT_U_CNT
"RTN","ORCSAVE2",164,0)
 Q
"RTN","ORCSAVE2",165,0)
 ;
"RTN","ORCSAVE2",166,0)
VALUE(IFN,ID,INST) ; -- Returns value of prompt by identifier ID
"RTN","ORCSAVE2",167,0)
 I '$G(IFN)!('$D(^OR(100,+$G(IFN),0)))!($G(ID)="") Q ""
"RTN","ORCSAVE2",168,0)
 N I,Y S I=0,Y="" S:'$G(INST) INST=1
"RTN","ORCSAVE2",169,0)
 F  S I=$O(^OR(100,IFN,4.5,"ID",ID,I)) Q:I'>0  I $P($G(^OR(100,IFN,4.5,+I,0)),U,3)=INST S Y=$G(^(1)) Q
"RTN","ORCSAVE2",170,0)
 Q Y
"RTN","ORCSAVE2",171,0)
 ;
"RTN","ORCSAVE2",172,0)
SC(ORX,ORIFN) ; -- save responses to SC questions
"RTN","ORCSAVE2",173,0)
 Q:'$G(ORIFN)  Q:'$D(^OR(100,+ORIFN,0))  ;invalid order number
"RTN","ORCSAVE2",174,0)
 N OR5,I,P S OR5=$G(^OR(100,+ORIFN,5)),P=0
"RTN","ORCSAVE2",175,0)
 F I="SC","MST","AO","IR","EC","HNC","CV","SHD" S P=P+1 S:$D(ORX(I)) $P(OR5,U,P)=ORX(I)
"RTN","ORCSAVE2",176,0)
 S ^OR(100,+ORIFN,5)=OR5
"RTN","ORCSAVE2",177,0)
 Q
"RTN","ORCSAVE2",178,0)
 ;
"RTN","ORCSAVE2",179,0)
CANCEL(ORDER) ; -- cancel order [action]
"RTN","ORCSAVE2",180,0)
 N ORA,DIE,DA,DR,ORX
"RTN","ORCSAVE2",181,0)
 S ORDER=$G(ORDER),ORA=+$P(ORDER,";",2) Q:'ORA!('ORDER)
"RTN","ORCSAVE2",182,0)
 I $D(^OR(100,+ORDER,8,ORA)) D
"RTN","ORCSAVE2",183,0)
 .S ORX="Unsigned/unreleased order cancelled by provider"
"RTN","ORCSAVE2",184,0)
 .S DIE="^OR(100,"_+ORDER_",8,",DA=ORA,DA(1)=+ORDER
"RTN","ORCSAVE2",185,0)
 .S DR="4////5;15////13;1////^S X=ORX" D ^DIE
"RTN","ORCSAVE2",186,0)
 I ORA=1 D
"RTN","ORCSAVE2",187,0)
 .K DA S DIE="^OR(100,",DA=+ORDER,DR="5////13" D ^DIE
"RTN","ORCSAVE2",188,0)
 Q
"RTN","ORCSAVE2",189,0)
 ;
"RTN","ORCSAVE2",190,0)
LAPSE(ORDER) ; -- lapse order [action]
"RTN","ORCSAVE2",191,0)
 N ORA S ORA=+$P(ORDER,";",2)
"RTN","ORCSAVE2",192,0)
 Q:'$D(^OR(100,+ORDER,0))  Q:'ORA!('ORDER)
"RTN","ORCSAVE2",193,0)
 I $D(^OR(100,+ORDER,8,ORA)) D
"RTN","ORCSAVE2",194,0)
 .N DIE,DA,DR
"RTN","ORCSAVE2",195,0)
 .S DIE="^OR(100,"_+ORDER_",8,",DA=ORA,DA(1)=+ORDER
"RTN","ORCSAVE2",196,0)
 .S DR="4////5;15////14" D ^DIE
"RTN","ORCSAVE2",197,0)
 I ORA=1 D
"RTN","ORCSAVE2",198,0)
 .N DIE,DA,DR
"RTN","ORCSAVE2",199,0)
 .S DIE="^OR(100,",DA=+ORDER,DR="5////14"
"RTN","ORCSAVE2",200,0)
 .D ^DIE,ALPS(DA,ORA)
"RTN","ORCSAVE2",201,0)
 Q
"RTN","ORCSAVE2",202,0)
ALPS(DA,ORACT,TYPE) ;set the lapse index ^OR(100,"ALPS")
"RTN","ORCSAVE2",203,0)
 N ORVP,X,OR0,ORLOG
"RTN","ORCSAVE2",204,0)
 S OR0=$G(^OR(100,DA,8,ORACT,0))
"RTN","ORCSAVE2",205,0)
 S ORLOG=$P(OR0,U),ORVP=$P($G(^OR(100,DA,0)),U,2)
"RTN","ORCSAVE2",206,0)
 I ORVP,ORLOG S ^OR(100,"ALPS",ORVP,9999999-ORLOG,DA,ORACT)=$G(TYPE)
"RTN","ORCSAVE2",207,0)
 S ^OR(100,DA,10)=$$NOW^XLFDT
"RTN","ORCSAVE2",208,0)
 Q
"RTN","ORCSAVE2",209,0)
 ;
"RTN","ORCSAVE2",210,0)
RESP(IFN,PRMT,VAL,INST) ; -- update a single Response VALue
"RTN","ORCSAVE2",211,0)
 S IFN=+$G(IFN),VAL=$G(VAL),PRMT=+$O(^ORD(101.41,"AB",PRMT,0))
"RTN","ORCSAVE2",212,0)
 N ID,DA,DIK S:'$G(INST) INST=1
"RTN","ORCSAVE2",213,0)
 S ID=$P($G(^ORD(101.41,PRMT,1)),U,3) Q:'$L(ID)
"RTN","ORCSAVE2",214,0)
 S DA=0 F  S DA=$O(^OR(100,IFN,4.5,"ID",ID,DA)) Q:DA<1  Q:$P($G(^OR(100,IFN,4.5,DA,0)),U,3)=INST
"RTN","ORCSAVE2",215,0)
 I 'DA D:$L(VAL)  Q  ;add
"RTN","ORCSAVE2",216,0)
 . N DO,DIC,DLG,X
"RTN","ORCSAVE2",217,0)
 . S DIC="^OR(100,"_IFN_",4.5,",DA(1)=IFN,DIC(0)="FL"
"RTN","ORCSAVE2",218,0)
 . S DIC("DR")=".02///"_PRMT_";.03///"_INST_";.04///"_ID
"RTN","ORCSAVE2",219,0)
 . S DLG=+$P($G(^OR(100,IFN,0)),U,5)
"RTN","ORCSAVE2",220,0)
 . S X=+$O(^ORD(101.41,DLG,10,"D",PRMT,0))
"RTN","ORCSAVE2",221,0)
 . D FILE^DICN S:Y ^OR(100,IFN,4.5,+Y,1)=VAL
"RTN","ORCSAVE2",222,0)
 I $L(VAL) S ^OR(100,IFN,4.5,DA,1)=VAL Q  ;change
"RTN","ORCSAVE2",223,0)
 S DIK="^OR(100,"_IFN_",4.5,",DA(1)=IFN D ^DIK ;delete
"RTN","ORCSAVE2",224,0)
 Q
"RTN","ORCSEND")
0^17^B63497942
"RTN","ORCSEND",1,0)
ORCSEND ;SLC/MKB-Release orders ; 11/8/2006
"RTN","ORCSEND",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,27,45,79,92,141,165,195,243**;Dec 17, 1997;Build 242
"RTN","ORCSEND",3,0)
 ;
"RTN","ORCSEND",4,0)
EN(ORIFN,ACTION,SIGSTS,RELSTS,NATURE,REASON,ORERR) ; -- Release [actions on] orders
"RTN","ORCSEND",5,0)
 N ORDA,ORNOW,SIGNREQD,SIGNED,SIGNER
"RTN","ORCSEND",6,0)
 S SIGNREQD=+$P($G(^OR(100,+ORIFN,0)),U,16),ORERR=""
"RTN","ORCSEND",7,0)
 S SIGNED=$S(SIGSTS=2:0,1:1),SIGNER=$S(SIGSTS=1:DUZ,SIGSTS=7:DUZ,1:"")
"RTN","ORCSEND",8,0)
 S ORDA=+$P(ORIFN,";",2),ORIFN=+ORIFN,ORNOW=+$E($$NOW^XLFDT,1,12)
"RTN","ORCSEND",9,0)
 S:"ES"[$G(ACTION) ACTION=$P($G(^OR(100,ORIFN,8,ORDA,0)),U,2)
"RTN","ORCSEND",10,0)
 I SIGNREQD,ORDA,"^NW^RW^XX^RN^DC^HD^RL^"[(U_ACTION_U) D  ; sign/alert
"RTN","ORCSEND",11,0)
 . I 'SIGNED D NOTIF^ORCSIGN Q
"RTN","ORCSEND",12,0)
 . D:SIGSTS'="" SIGN^ORCSAVE2(ORIFN,SIGNER,ORNOW,SIGSTS,ORDA)
"RTN","ORCSEND",13,0)
 . D:SIGSTS=4 CHART^ORCSIGN ; not used anymore
"RTN","ORCSEND",14,0)
 I '$L(ACTION) S ORERR="1^Invalid order action" Q
"RTN","ORCSEND",15,0)
 I $$READY(ORIFN,ORDA) D:$L($T(@ACTION)) @ACTION I 'ORERR,ACTION="NW" D
"RTN","ORCSEND",16,0)
 . N OREVT S OREVT=+$P($G(^OR(100,ORIFN,0)),U,17) Q:OREVT<1
"RTN","ORCSEND",17,0)
 . I '$$EVTORDER^OREVNTX(ORIFN) D SAVE^ORMEVNT1(ORIFN,OREVT,2,"ES")
"RTN","ORCSEND",18,0)
 ; If order originated from the back door, send Dx and TxF back to ancil.
"RTN","ORCSEND",19,0)
 I SIGNED,$P($G(^OR(100,+ORIFN,3)),U,11)="P" D BDOEDIT^ORWDBA7
"RTN","ORCSEND",20,0)
 Q
"RTN","ORCSEND",21,0)
 ;
"RTN","ORCSEND",22,0)
EN1(ORDER,ORERR) ; -- Delayed Release [from RELEASE^ORMEVNT]
"RTN","ORCSEND",23,0)
 ;
"RTN","ORCSEND",24,0)
 Q:$P($G(^OR(100,+ORDER,3)),U,3)'=10
"RTN","ORCSEND",25,0)
 N ORPKG,ORA0,ORNOW,ORIFN,ORDA,ORNP,ORNATR,ORQUIT,ORDUZ,SIGSTS,RELSTS
"RTN","ORCSEND",26,0)
 S ORPKG=$P($G(^OR(100,+ORDER,0)),U,14),ORA0=$G(^(8,1,0))
"RTN","ORCSEND",27,0)
 S ORNOW=+$E($$NOW^XLFDT,1,12),ORIFN=+ORDER,ORDA=1,ORNP=$P(ORA0,U,3)
"RTN","ORCSEND",28,0)
 S SIGSTS=$P(ORA0,U,4),ORNATR=$P($G(^ORD(100.02,+$P(ORA0,U,12),0)),U,2)
"RTN","ORCSEND",29,0)
 S RELSTS=$S(SIGSTS'=2:1,"^V^P^"[(U_ORNATR_U):1,1:0) I RELSTS D
"RTN","ORCSEND",30,0)
 . D STARTDT^ORCSAVE2(ORIFN),PKGSTUFF^ORCSEND1(ORPKG) Q:$G(ORQUIT)
"RTN","ORCSEND",31,0)
 . S ORDUZ=$S(SIGSTS=0:$P(ORA0,U,7),SIGSTS=1:$P(ORA0,U,5),SIGSTS=2:$P(ORA0,U,17),SIGSTS=3:$P(ORA0,U,13),1:DUZ)
"RTN","ORCSEND",32,0)
 . D RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,ORDUZ),NEW^ORMBLD(ORIFN)
"RTN","ORCSEND",33,0)
 . I "^10^13^"[(U_$P($G(^OR(100,ORIFN,3)),U,3)_U) S ORERR=1 ;error
"RTN","ORCSEND",34,0)
 I 'RELSTS!$G(ORERR),$P($G(^OR(100,ORIFN,3)),U,3)=10 D STATUS^ORCSAVE2(ORIFN,11) S $P(^OR(100,ORIFN,8,1,0),U,15)=11
"RTN","ORCSEND",35,0)
 Q
"RTN","ORCSEND",36,0)
 ;
"RTN","ORCSEND",37,0)
EN2(ORIFN,SIGSTS,NATURE,ORERR) ; -- Manual Release [from OREVNT1,SENDED^ORWDX]
"RTN","ORCSEND",38,0)
 N ORDA,ORNOW,OREVT,ORA0,ORNP,SIGNREQD,SIGNED,RELSTS
"RTN","ORCSEND",39,0)
 S ORDA=+$P(ORIFN,";",2),ORIFN=+ORIFN S:ORDA<1 ORDA=1
"RTN","ORCSEND",40,0)
 S OREVT=+$P($G(^OR(100,ORIFN,0)),U,17),ORA0=$G(^(8,ORDA,0))
"RTN","ORCSEND",41,0)
 S ORNP=$P(ORA0,U,3),SIGNREQD=($P(ORA0,U,4)'=3),(SIGNED,RELSTS)=1
"RTN","ORCSEND",42,0)
 S ORNOW=+$E($$NOW^XLFDT,1,12),ORERR="" I $P(ORA0,U,4)=2 D  ;needs ES
"RTN","ORCSEND",43,0)
 . N SIGNER S SIGNER=$S(SIGSTS=1:DUZ,1:"")
"RTN","ORCSEND",44,0)
 . I SIGSTS=2 D NOTIF^ORCSIGN S SIGNED=0 Q  ;still unsigned
"RTN","ORCSEND",45,0)
 . D:SIGSTS'="" SIGN^ORCSAVE2(ORIFN,SIGNER,ORNOW,SIGSTS,ORDA)
"RTN","ORCSEND",46,0)
 D NW I 'ORERR D SAVE^ORMEVNT1(+ORIFN,OREVT,2,"MN")
"RTN","ORCSEND",47,0)
 Q
"RTN","ORCSEND",48,0)
 ;
"RTN","ORCSEND",49,0)
NW ; -- New order ORIFN
"RTN","ORCSEND",50,0)
RW ; -- Rewritten order ORIFN
"RTN","ORCSEND",51,0)
XX ; -- Changed order ORIFN
"RTN","ORCSEND",52,0)
RN ; -- Renewed order ORIFN
"RTN","ORCSEND",53,0)
 N ORQUIT,STS,TYPE,OR0,OR3,CODE,ORIG,ORSAVE
"RTN","ORCSEND",54,0)
 N IVDIEN,IVPKGM
"RTN","ORCSEND",55,0)
 S IVPKGM=0
"RTN","ORCSEND",56,0)
 S IVDIEN=$O(^ORD(101.41,"B","PSJI OR PAT FLUID OE",""))
"RTN","ORCSEND",57,0)
 I SIGNREQD,'SIGNED,'RELSTS S ORERR=$$NEEDSIG,OREBUILD=1 Q
"RTN","ORCSEND",58,0)
 S:'ORDA ORDA=1 S ORSAVE=ORIFN
"RTN","ORCSEND",59,0)
 S OR0=$G(^OR(100,ORIFN,0)),OR3=$G(^(3)) D STARTDT^ORCSAVE2(ORIFN)
"RTN","ORCSEND",60,0)
 S TYPE=$P(OR3,U,11),ORIG=+$P(OR3,U,5),CODE="NW"
"RTN","ORCSEND",61,0)
 I TYPE=1,ORIG,$D(^OR(100,ORIG,4)) S CODE="XO",^OR(100,ORIG,6)=$O(^ORD(100.02,"C","C",0))_U_DUZ_U_ORNOW
"RTN","ORCSEND",62,0)
 I $$GET1^DIQ(9.4,+$P(OR0,U,14)_",",1)="PSJ" S IVPKGM=1
"RTN","ORCSEND",63,0)
 I IVPKGM=1,$P($P(OR0,U,5),";")=IVDIEN D PSJI^ORCSEND3 Q:$G(ORQUIT)
"RTN","ORCSEND",64,0)
 I IVPKGM=0!($P($P(OR0,U,5),";")'=IVDIEN) D PKGSTUFF^ORCSEND1(+$P(OR0,U,14)) Q:$G(ORQUIT)
"RTN","ORCSEND",65,0)
 D RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,DUZ,$G(NATURE))
"RTN","ORCSEND",66,0)
 D NEW^ORMBLD(ORIFN,CODE) S ORIFN=ORSAVE,STS=$P($G(^OR(100,ORIFN,3)),U,3)
"RTN","ORCSEND",67,0)
 I (STS=1)!(STS=13) S ORERR="1^"_$$WHY(ORIFN,1) D:'SIGNED&SIGNREQD NOSIG K:ORIG ^OR(100,ORIG,6)
"RTN","ORCSEND",68,0)
 I STS=11 S ORERR="1^ERROR"
"RTN","ORCSEND",69,0)
 Q
"RTN","ORCSEND",70,0)
 ;
"RTN","ORCSEND",71,0)
DC ; -- DC order ORIFN
"RTN","ORCSEND",72,0)
 N PKG,CODE,ORCHLD,ORCHDA,STS,ORIDA,ORSAVE,OR3,OR6,DCNATURE
"RTN","ORCSEND",73,0)
 I '$G(REASON),$G(NATURE)="D" S REASON=+$O(^ORD(100.03,"C","ORDUP",0))
"RTN","ORCSEND",74,0)
 S:$G(REASON) $P(^OR(100,ORIFN,6),U,1,5)=$S($G(NATURE):NATURE,$L($G(NATURE)):$O(^ORD(100.02,"C",NATURE,0)),1:"")_"^^^"_+REASON_U_$P(^ORD(100.03,+REASON,0),U)
"RTN","ORCSEND",75,0)
 I SIGNREQD,'SIGNED,'RELSTS S ORERR=$$NEEDSIG Q
"RTN","ORCSEND",76,0)
 S $P(^OR(100,ORIFN,6),U,2,3)=$S($G(DGPMT):"",1:DUZ)_U_ORNOW,ORSAVE=ORIFN S:'$G(REASON) REASON=$P(^(6),U,4)
"RTN","ORCSEND",77,0)
 S STS=$P($G(^OR(100,ORIFN,3)),U,3),PKG=$P($G(^(0)),U,14),PKG=$$NMSP^ORCD(PKG),CODE=$S(PKG="LR":"CA",(PKG="PS")&(STS=5):"CA",(PKG="FH")&(STS=8):"CA",1:"DC")
"RTN","ORCSEND",78,0)
 D:ORDA RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,DUZ,$G(NATURE))
"RTN","ORCSEND",79,0)
DC1 I $O(^OR(100,ORIFN,2,0)) D  G DC2 ; DC children
"RTN","ORCSEND",80,0)
 . S ORCHLD=0 F  S ORCHLD=$O(^OR(100,ORIFN,2,ORCHLD)) Q:ORCHLD'>0  I $$VALID^ORCACT0(ORCHLD,"DC") D  Q:$G(ORERR)
"RTN","ORCSEND",81,0)
 . . S ORCHDA=$S(ORDA:$$ACTION^ORCSAVE("DC",ORCHLD,ORNP),1:0)
"RTN","ORCSEND",82,0)
 . . D:ORCHDA SIGN^ORCSAVE2(ORCHLD,,,8,ORCHDA) ;Sig on Parent only
"RTN","ORCSEND",83,0)
 . . D MSG^ORMBLD((ORCHLD_";"_ORCHDA),CODE,$G(REASON))
"RTN","ORCSEND",84,0)
 . . I "^1^13^"'[(U_$P(^OR(100,ORCHLD,3),U,3)_U) S ORERR="1^"_$$WHY(ORCHLD,ORCHDA)
"RTN","ORCSEND",85,0)
 . ;D:'$G(ORERR) STATUS^ORCSAVE2(ORIFN,1)
"RTN","ORCSEND",86,0)
 . S:$G(ORERR) ^OR(100,ORIFN,8,ORDA,1)=$P(ORERR,U,2)
"RTN","ORCSEND",87,0)
 D MSG^ORMBLD((ORIFN_";"_ORDA),CODE,$G(REASON))
"RTN","ORCSEND",88,0)
DC2 S ORIFN=ORSAVE,OR3=$G(^OR(100,ORIFN,3)),STS=$P(OR3,U,3)
"RTN","ORCSEND",89,0)
 S OR6=$G(^OR(100,ORIFN,6))
"RTN","ORCSEND",90,0)
 I STS'=1,STS'=13,STS'=2 D  Q
"RTN","ORCSEND",91,0)
 . S ORERR="1^"_$S(ORDA:$$WHY(ORIFN,ORDA),1:"Unable to discontinue")
"RTN","ORCSEND",92,0)
 . I ORDA,'SIGNED&SIGNREQD D NOSIG ; sig no longer reqd
"RTN","ORCSEND",93,0)
 . K ^OR(100,ORIFN,6)
"RTN","ORCSEND",94,0)
 S DCNATURE=$S(+OR6:+OR6,1:$G(NATURE))
"RTN","ORCSEND",95,0)
 S $P(^OR(100,ORIFN,3),U,7)=$S('$$ACTV^ORX1($G(DCNATURE)):0,1:$P(OR3,U,7))
"RTN","ORCSEND",96,0)
 D CANCEL(ORIFN),SETALL^ORDD100(ORIFN)
"RTN","ORCSEND",97,0)
 I $P(OR3,U,11)=2 D  ; dc a renewal
"RTN","ORCSEND",98,0)
 . N ORIG,ORIG3,NATR S ORIG=$P(OR3,U,5),ORIG3=$G(^OR(100,ORIG,3)) Q:'ORIG
"RTN","ORCSEND",99,0)
 . ;I CODE="CA",+$P(OR6,U,9)'>0 S $P(^OR(100,ORIG,3),U,6)="" Q  ;pend - remove fwd ptr
"RTN","ORCSEND",100,0)
 . I +$P(OR6,U,9)'>0 S $P(^OR(100,ORIG,3),U,6)="" Q  ;pend - remove fwd ptr
"RTN","ORCSEND",101,0)
 . Q:"^1^7^12^13^"[(U_$P(ORIG3,U,3)_U)  S NATR=$O(^ORD(100.02,"C","A",0))
"RTN","ORCSEND",102,0)
 . S ^OR(100,ORIG,6)=NATR_U_DUZ_U_ORNOW_"^^Renewal cancelled"
"RTN","ORCSEND",103,0)
 . D MSG^ORMBLD(ORIG,"DC") I "^1^13^"'[$P(^OR(100,ORIG,3),U,3) K ^(6) Q
"RTN","ORCSEND",104,0)
 . S:'$$ACTV^ORX1(NATR) $P(^OR(100,ORIG,3),U,7)=0
"RTN","ORCSEND",105,0)
 Q
"RTN","ORCSEND",106,0)
 ;
"RTN","ORCSEND",107,0)
CANCEL(IFN) ; -- Cancel any outstanding actions for order IFN 
"RTN","ORCSEND",108,0)
 N I S I=0
"RTN","ORCSEND",109,0)
 F  S I=$O(^OR(100,IFN,8,I)) Q:I'>0  I $P(^(I,0),U,15)=11 S $P(^(0),U,15)=13 D:$P(^(0),U,4)=2 SIGN^ORCSAVE2(IFN,"","",5,I) ; cancelled, sig not reqd now
"RTN","ORCSEND",110,0)
 Q
"RTN","ORCSEND",111,0)
 ;
"RTN","ORCSEND",112,0)
HD ; -- Hold order ORIFN
"RTN","ORCSEND",113,0)
 N STS,ORSAVE I 'ORDA S ORERR="1^Unable to hold" Q
"RTN","ORCSEND",114,0)
 I SIGNREQD,'SIGNED,'RELSTS S ORERR=$$NEEDSIG Q
"RTN","ORCSEND",115,0)
 D RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,DUZ,$G(NATURE))
"RTN","ORCSEND",116,0)
 S ORSAVE=ORIFN D MSG^ORMBLD((ORIFN_";"_ORDA),"HD") S ORIFN=ORSAVE
"RTN","ORCSEND",117,0)
 S STS=$P($G(^OR(100,ORIFN,3)),U,3) I STS=3 S $P(^(3),U,7)=ORDA D SET^ORDD100(ORIFN,ORDA)
"RTN","ORCSEND",118,0)
 I STS'=3 S ORERR="1^"_$$WHY(ORIFN,ORDA) D:'SIGNED&SIGNREQD NOSIG
"RTN","ORCSEND",119,0)
 Q
"RTN","ORCSEND",120,0)
 ;
"RTN","ORCSEND",121,0)
RL ; -- Release hold on order ORIFN
"RTN","ORCSEND",122,0)
 N STS,ORSAVE,ORHD I 'ORDA S ORERR="1^Unable to release hold" Q
"RTN","ORCSEND",123,0)
 I SIGNREQD,'SIGNED,'RELSTS S ORERR=$$NEEDSIG Q
"RTN","ORCSEND",124,0)
 D RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,DUZ,$G(NATURE))
"RTN","ORCSEND",125,0)
 S ORSAVE=ORIFN D MSG^ORMBLD((ORIFN_";"_ORDA),"RL") S ORIFN=ORSAVE
"RTN","ORCSEND",126,0)
 S STS=$P($G(^OR(100,ORIFN,3)),U,3),ORHD=+$P($G(^(3)),U,7)
"RTN","ORCSEND",127,0)
 I STS'=3 S $P(^OR(100,ORIFN,3),U,7)=ORDA,$P(^(8,ORHD,2),U,1,2)=ORNOW_U_DUZ D SET^ORDD100(ORIFN,ORDA)
"RTN","ORCSEND",128,0)
 I STS=3 S ORERR="1^"_$$WHY(ORIFN,ORDA) D:'SIGNED&SIGNREQD NOSIG
"RTN","ORCSEND",129,0)
 Q
"RTN","ORCSEND",130,0)
 ;
"RTN","ORCSEND",131,0)
FL ; -- Flag order ORIFN
"RTN","ORCSEND",132,0)
 Q
"RTN","ORCSEND",133,0)
 ;
"RTN","ORCSEND",134,0)
UF ; -- Unflag order ORIFN
"RTN","ORCSEND",135,0)
 Q
"RTN","ORCSEND",136,0)
 ;
"RTN","ORCSEND",137,0)
CM ; -- Add Ward comments to order ORIFN
"RTN","ORCSEND",138,0)
 Q
"RTN","ORCSEND",139,0)
 ;
"RTN","ORCSEND",140,0)
VR ; -- Verify order ORIFN
"RTN","ORCSEND",141,0)
 I 'ORDA!(SIGSTS=2) S ORERR="1^Unable to verify" Q
"RTN","ORCSEND",142,0)
 I "^N^C^R^"'[(U_$G(ORVER)_U) S ORERR="1^Unable to verify" Q
"RTN","ORCSEND",143,0)
 D VERIFY^ORCSAVE2(ORIFN,ORDA,ORVER,DUZ,ORNOW)
"RTN","ORCSEND",144,0)
 ; -- send HL7 msg to Pharmacy if Nurse-Verified, [Sts=pending]
"RTN","ORCSEND",145,0)
 Q:ORVER'="N"  N ORSTS,ORPKG,ORX
"RTN","ORCSEND",146,0)
 S ORX=$P($G(^OR(100,ORIFN,8,ORDA,0)),U,2) Q:ORX'="NW"&(ORX'="XX")
"RTN","ORCSEND",147,0)
 S ORPKG=+$P($G(^OR(100,ORIFN,0)),U,14),ORSTS=$P($G(^(3)),U,3)
"RTN","ORCSEND",148,0)
 ;I ORSTS=5!$L($T(ZV^ORMPS)),$$NMSP^ORCD(ORPKG)="PS" D VER^ORMBLDPS(ORIFN)
"RTN","ORCSEND",149,0)
 I $$NMSP^ORCD(ORPKG)="PS" D VER^ORMBLDPS(ORIFN)
"RTN","ORCSEND",150,0)
 Q
"RTN","ORCSEND",151,0)
 ;
"RTN","ORCSEND",152,0)
NEEDSIG() ; -- Msg
"RTN","ORCSEND",153,0)
 Q "1^This order requires a signature."
"RTN","ORCSEND",154,0)
 ;
"RTN","ORCSEND",155,0)
WHY(IFN,DA) ; -- Return reason request was rejected
"RTN","ORCSEND",156,0)
 N X S X=$G(^OR(100,IFN,8,DA,1))
"RTN","ORCSEND",157,0)
 S:'$L(X) X="Unable to "_$S(ACTION="HD":"hold",ACTION="RL":"release hold",ACTION="DC":"discontinue",ACTION="XX":"change",ACTION="RN":"renew",1:"release")
"RTN","ORCSEND",158,0)
 Q X
"RTN","ORCSEND",159,0)
 ;
"RTN","ORCSEND",160,0)
NOSIG ; -- Mark order as Sig not Req'd due to cancel/reject
"RTN","ORCSEND",161,0)
 D SIGN^ORCSAVE2(ORIFN,"","",5,ORDA) S SIGNREQD=0
"RTN","ORCSEND",162,0)
 Q
"RTN","ORCSEND",163,0)
 ;
"RTN","ORCSEND",164,0)
READY(IFN,ACT) ; -- Ready to release?
"RTN","ORCSEND",165,0)
 N X,Y,OR0,OR3,ORA
"RTN","ORCSEND",166,0)
 I ACTION="VR" S Y=1 G RQ ; no action to release
"RTN","ORCSEND",167,0)
 I 'ACT,ACTION="DC" S Y=1 G RQ ; cancel a duplicate
"RTN","ORCSEND",168,0)
 S Y=0,OR0=$G(^OR(100,IFN,0)),OR3=$G(^(3)),ORA=$G(^(8,ACT,0))
"RTN","ORCSEND",169,0)
 I $P(ORA,U,15)=11 S Y=1 G RQ ; unreleased
"RTN","ORCSEND",170,0)
 I $P(ORA,U,15)=10 D  G RQ ; delayed
"RTN","ORCSEND",171,0)
 . I $G(^DPT(+ORVP,.105)),$$GET1^DIQ(9.4,+$P(OR0,U,14)_",",1)="PSO" S Y=1 Q
"RTN","ORCSEND",172,0)
 . Q:'RELSTS  N ORIG S ORIG=+$P(OR3,U,5)
"RTN","ORCSEND",173,0)
 . I 'SIGNED,$L($G(NATURE)) S $P(ORA,U,17)=DUZ,$P(ORA,U,12)=$S(NATURE:NATURE,1:+$O(^ORD(100.02,"C",NATURE,0))),^OR(100,IFN,8,ACT,0)=ORA
"RTN","ORCSEND",174,0)
 . Q:$P(OR3,U,11)'=1!('ORIG)  ;dc original if signed edit
"RTN","ORCSEND",175,0)
 . D STATUS^ORCSAVE2(ORIG,12)
"RTN","ORCSEND",176,0)
 . S ^OR(100,ORIG,6)=+$O(^ORD(100.02,"C","C",0))_U_DUZ_U_ORNOW
"RTN","ORCSEND",177,0)
 . S $P(^OR(100,ORIG,3),U,7)=0,$P(^(8,1,0),U,15)=12 D:$P($G(^(0)),U,4)=2 SIGN^ORCSAVE2(ORIG,,,5,1)
"RTN","ORCSEND",178,0)
 I $P(OR3,U,3)=11,$P(ORA,U,2)="NW" S Y=1 ; Action Sts = "" (old)
"RTN","ORCSEND",179,0)
RQ I +$$SWSTAT^IBBAPI() D:Y=1 EN^ORWPFSS4(+IFN) ; Associate PFSS Account Reference with order, Patch OR*3.0*228 IA #4663
"RTN","ORCSEND",180,0)
 Q Y
"RTN","ORCSEND1")
0^22^B61198784
"RTN","ORCSEND1",1,0)
ORCSEND1 ;SLC/MKB-Release cont ;11/22/06
"RTN","ORCSEND1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,29,45,61,79,94,116,138,158,149,187,215,243**;Dec 17, 1997;Build 242
"RTN","ORCSEND1",3,0)
 ;
"RTN","ORCSEND1",4,0)
PKGSTUFF(PKG) ; Package code
"RTN","ORCSEND1",5,0)
 S PKG=$$GET1^DIQ(9.4,+PKG_",",1) Q:'$L(PKG)
"RTN","ORCSEND1",6,0)
 D:$L($T(@PKG)) @PKG
"RTN","ORCSEND1",7,0)
 Q
"RTN","ORCSEND1",8,0)
LR ; Spawn child orders if continuous schedule
"RTN","ORCSEND1",9,0)
 N ORSTRT,ORPARENT,OR0,ORNP,ORDIALOG,ORL,ORX,ORTIME,ORPITEM,ORPSAMP,ORPSPEC,ORPURG,ORPCOMM,ORPTYPE,ORPCOLL,ORS1,ORS2,P,ORCHLD,ORDG,ORLAST,ORDUZ,ORLOG,ORCOLLCT,STS
"RTN","ORCSEND1",10,0)
 S ORPARENT=+ORIFN,OR0=$G(^OR(100,ORIFN,0)),ORL=$P(OR0,U,10)
"RTN","ORCSEND1",11,0)
 D SCHEDULE(ORIFN,"LR",.ORSTRT) I ORSTRT'>1 D  Q
"RTN","ORCSEND1",12,0)
 . N START S START=$O(ORSTRT(0)) Q:START=$P($G(^OR(100,+ORIFN,0)),U,8)
"RTN","ORCSEND1",13,0)
 . D DATES^ORCSAVE2(+ORIFN,START) ;update start date from schedule
"RTN","ORCSEND1",14,0)
 S ORNP=+$P(OR0,U,4),ORDIALOG=+$P(OR0,U,5),ORDUZ=+$P(OR0,U,6),ORLOG=$P(OR0,U,7),ORDG=+$P(OR0,U,11)
"RTN","ORCSEND1",15,0)
 D GETDLG1^ORCD(ORDIALOG),GETORDER(ORIFN),GETIMES^ORCDLR1
"RTN","ORCSEND1",16,0)
 K ORDIALOG($$PTR^ORCD("OR GTX ADMIN SCHEDULE"),1),ORDIALOG($$PTR^ORCD("OR GTX DURATION"),1)
"RTN","ORCSEND1",17,0)
 S ORPITEM=$$PTR^ORCD("OR GTX ORDERABLE ITEM")
"RTN","ORCSEND1",18,0)
 S ORPSAMP=$$PTR^ORCD("OR GTX COLLECTION SAMPLE")
"RTN","ORCSEND1",19,0)
 S ORPSPEC=$$PTR^ORCD("OR GTX SPECIMEN")
"RTN","ORCSEND1",20,0)
 S ORPURG=$$PTR^ORCD("OR GTX LAB URGENCY")
"RTN","ORCSEND1",21,0)
 S ORPCOMM=$$PTR^ORCD("OR GTX WORD PROCESSING 1")
"RTN","ORCSEND1",22,0)
 S ORPTYPE=$$PTR^ORCD("OR GTX COLLECTION TYPE")
"RTN","ORCSEND1",23,0)
 S ORPCOLL=$$PTR^ORCD("OR GTX START DATE/TIME")
"RTN","ORCSEND1",24,0)
LR1 S ORS1=0 F  S ORS1=$O(ORX(ORS1)) Q:ORS1'>0  D
"RTN","ORCSEND1",25,0)
 . F P=ORPITEM,ORPSAMP,ORPSPEC,ORPURG,ORPCOMM,ORPTYPE S ORDIALOG(P,1)=$G(ORX(ORS1,P)) ;set values to next instance
"RTN","ORCSEND1",26,0)
 . S ORCOLLCT=$G(ORDIALOG(ORPTYPE,1))
"RTN","ORCSEND1",27,0)
 . S ORS2=0 F  S ORS2=$O(ORSTRT(ORS2)) Q:ORS2'>0  D
"RTN","ORCSEND1",28,0)
 .. S ORDIALOG(ORPCOLL,1)=ORS2 ;,ORDUZ=DUZ,ORLOG=+$E($$NOW^XLFDT,1,12)
"RTN","ORCSEND1",29,0)
 .. I ORCOLLCT="LC" S ORDIALOG(ORPTYPE,1)=$S($$LABCOLL^ORCDLR1(ORS2):"LC",1:"WC")
"RTN","ORCSEND1",30,0)
 .. I ORCOLLCT="I" S ORDIALOG(ORPTYPE,1)=$S($$IMMCOLL^ORCDLR1(ORS2):"I",1:"WC")
"RTN","ORCSEND1",31,0)
 .. D CHILD^ORCSEND3()
"RTN","ORCSEND1",32,0)
 S:$G(ORCHLD) ^OR(100,ORPARENT,2,0)="^100.002PA^"_ORLAST_U_ORCHLD
"RTN","ORCSEND1",33,0)
 S ORIFN=ORPARENT,ORQUIT=1,STS=$P(^OR(100,ORIFN,3),U,3)
"RTN","ORCSEND1",34,0)
 I (STS=1)!(STS=13)!(STS=11) S ORERR="1^Unable to release orders"
"RTN","ORCSEND1",35,0)
 D RELEASE^ORCSAVE2(ORPARENT,1,ORNOW,DUZ,$G(NATURE))
"RTN","ORCSEND1",36,0)
 Q
"RTN","ORCSEND1",37,0)
SCHEDULE(IFN,PKG,ORY,STRT) ; Returns list of start time(s) from schedule
"RTN","ORCSEND1",38,0)
 N I,X,PSJSD,PSJFD,PSJW,PSJNE,PSJPP,PSJX,PSJAT,PSJM,PSJTS,PSJY,PSJAX,PSJSCH,PSJOSD,PSJOFD,PSJC,ORDUR
"RTN","ORCSEND1",39,0)
 S PSJSD=$S(+$G(STRT):STRT,1:$P($G(^OR(100,+IFN,0)),U,8)) I 'PSJSD S ORY=-1 Q
"RTN","ORCSEND1",40,0)
 S ORY=1,ORY(PSJSD)="" ;1st occurrance
"RTN","ORCSEND1",41,0)
 S I=$O(^OR(100,+IFN,4.5,"ID","SCHEDULE",0)) Q:'I  Q:'$L($G(PKG))
"RTN","ORCSEND1",42,0)
 S X=$G(^OR(100,+IFN,4.5,I,1)),PSJX=$S(X:$$GET1^DIQ(51.1,+X_",",.01),1:X)
"RTN","ORCSEND1",43,0)
 S PSJW=+$G(ORL),PSJNE="",PSJPP=PKG D ENSV^PSJEEU Q:'$L($G(PSJX))
"RTN","ORCSEND1",44,0)
 I $G(PSJTS)'="C",$G(PSJTS)'="D" Q  ;not continuous or day-of-week
"RTN","ORCSEND1",45,0)
 S PSJSCH=PSJX,I=$O(^OR(100,+IFN,4.5,"ID","DAYS",0)) Q:'I
"RTN","ORCSEND1",46,0)
 S ORDUR=$G(^OR(100,+IFN,4.5,+I,1))
"RTN","ORCSEND1",47,0)
 S:ORDUR PSJFD=$$FMADD^XLFDT(PSJSD,+ORDUR,,-1)
"RTN","ORCSEND1",48,0)
 I 'ORDUR S X=+$E(ORDUR,2,9) D
"RTN","ORCSEND1",49,0)
 . I PSJM S PSJFD=$$FMADD^XLFDT(PSJSD,,,(PSJM*X)-1) ;X_#times
"RTN","ORCSEND1",50,0)
 . E  D  ;no freq in minutes --> day of week
"RTN","ORCSEND1",51,0)
 .. N DAYS,LOCMX,SCHMX
"RTN","ORCSEND1",52,0)
 .. S LOCMX=$$GET^XPAR("ALL^LOC.`"_+ORL,"LR MAX DAYS CONTINUOUS",1,"Q")
"RTN","ORCSEND1",53,0)
 .. K ^TMP($J,"ORCSEND1 SCHEDULE")
"RTN","ORCSEND1",54,0)
 .. D ZERO^PSS51P1(PSJY,,,,"ORCSEND1 SCHEDULE")
"RTN","ORCSEND1",55,0)
 .. S SCHMX=+$G(^TMP($J,"ORCSEND1 SCHEDULE",PSJY,2.5))
"RTN","ORCSEND1",56,0)
 .. K ^TMP($J,"ORCSEND1 SCHEDULE")
"RTN","ORCSEND1",57,0)
 .. ;S SCHMX=$P(^PS(51.1,PSJY,0),U,7)
"RTN","ORCSEND1",58,0)
 .. S DAYS=$S('SCHMX:LOCMX,LOCMX<SCHMX:LOCMX,1:SCHMX)
"RTN","ORCSEND1",59,0)
 .. S PSJFD=$$FMADD^XLFDT(PSJSD,DAYS,,-1)
"RTN","ORCSEND1",60,0)
 D ENSPU^PSJEEU K ORY
"RTN","ORCSEND1",61,0)
 I ORDUR M ORY=PSJC Q
"RTN","ORCSEND1",62,0)
 S ORY=$S(PSJC<$E(ORDUR,2,9):PSJC,1:$E(ORDUR,2,9))
"RTN","ORCSEND1",63,0)
 N NXT
"RTN","ORCSEND1",64,0)
 S NXT=0 F I=1:1:ORY S NXT=$O(PSJC(NXT)) Q:'NXT  S ORY(NXT)=PSJC(NXT)
"RTN","ORCSEND1",65,0)
 Q
"RTN","ORCSEND1",66,0)
GETORDER(IFN) ; Set ORX(Inst,Ptr)=Value
"RTN","ORCSEND1",67,0)
 N I,X,Y,PTR,INST,TYPE
"RTN","ORCSEND1",68,0)
 S I=0 F  S I=$O(^OR(100,IFN,4.5,I)) Q:I'>0  S X=$G(^(I,0)),Y=$G(^(1)) D
"RTN","ORCSEND1",69,0)
 . S PTR=+$P(X,U,2),INST=+$P(X,U,3),TYPE=$P($G(^ORD(101.41,PTR,1)),U)
"RTN","ORCSEND1",70,0)
 . I TYPE'="W" S ORX(INST,PTR)=Y Q
"RTN","ORCSEND1",71,0)
 . S ORX(INST,PTR)="^OR(100,"_IFN_",4.5,"_I_",2)"
"RTN","ORCSEND1",72,0)
 Q
"RTN","ORCSEND1",73,0)
PTR(X) ; Returns ptr of prompt X in Order Dialog file
"RTN","ORCSEND1",74,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_X,1,63),0))
"RTN","ORCSEND1",75,0)
PS ; spawn child orders if multiple doses
"RTN","ORCSEND1",76,0)
PSJ ; (Inpt only)
"RTN","ORCSEND1",77,0)
PSS ;
"RTN","ORCSEND1",78,0)
 N ORPARENT,OR0,ORNP,ORDIALOG,ORDUZ,ORLOG,ORL,ORDG,ORCAT,ORX,ORP,ORI,STS
"RTN","ORCSEND1",79,0)
 N ORDOSE,ORT,ORSCH,ORDUR,ORSTRT,ORFRST,ORCONJ,ORID,ORDD,ORSTR,ORDGNM
"RTN","ORCSEND1",80,0)
 N ORSTART,ORCHLD,ORLAST,ORSIG,OROI,ID,OR3,ORIG,CODE,ORPKG,ORENEW,I,ORADMIN
"RTN","ORCSEND1",81,0)
 S ORPARENT=+ORIFN,OR0=$G(^OR(100,ORPARENT,0)),OR3=$G(^(3))
"RTN","ORCSEND1",82,0)
 Q:$P(OR0,U,12)'="I"  S ORCAT="I",ORNP=+$P(OR0,U,4)
"RTN","ORCSEND1",83,0)
 S ORDIALOG=+$P(OR0,U,5),ORDUZ=+$P(OR0,U,6),ORLOG=$P(OR0,U,7)
"RTN","ORCSEND1",84,0)
 S ORL=$P(OR0,U,10),ORDG=+$P(OR0,U,11),ORPKG=+$P(OR0,U,14)
"RTN","ORCSEND1",85,0)
 D GETDLG1^ORCD(ORDIALOG),GETORDER(ORPARENT)
"RTN","ORCSEND1",86,0)
 S ORDOSE=$$PTR("INSTRUCTIONS"),ORT=$$PTR("ROUTE")
"RTN","ORCSEND1",87,0)
 S ORSCH=$$PTR("SCHEDULE"),ORDUR=$$PTR("DURATION")
"RTN","ORCSEND1",88,0)
 S ORCONJ=$$PTR("AND/THEN") D STRT S ORSTART=$G(ORSTRT("BEG"))
"RTN","ORCSEND1",89,0)
 S ORADMIN=$$PTR("ADMIN TIMES")
"RTN","ORCSEND1",90,0)
 D DATES^ORCSAVE2(ORPARENT,ORSTART) Q:$$DOSES(ORPARENT)'>1
"RTN","ORCSEND1",91,0)
 S ORFRST=$$PTR("NOW"),ORSIG=$$PTR("SIG")
"RTN","ORCSEND1",92,0)
 S ORID=$$PTR("DOSE"),ORDD=$$PTR("DISPENSE DRUG")
"RTN","ORCSEND1",93,0)
 S ORSTR=$$PTR("STRENGTH"),ORDGNM=$$PTR("DRUG NAME")
"RTN","ORCSEND1",94,0)
 I $P(OR3,U,11)=2,$O(^OR(100,+$P(OR3,U,5),2,0)) D
"RTN","ORCSEND1",95,0)
 . S ORENEW=+$P(OR3,U,5),I=0
"RTN","ORCSEND1",96,0)
 . I $$VALUE^ORX8(ORENEW,"NOW") S I=$O(^OR(100,ORENEW,2,0))
"RTN","ORCSEND1",97,0)
 . F  S I=$O(^OR(100,ORENEW,2,I)) Q:I<1  S ORENEW(I)=""
"RTN","ORCSEND1",98,0)
PS1 F ORP="ORDERABLE ITEM","URGENCY","WORD PROCESSING 1" D
"RTN","ORCSEND1",99,0)
 . N PTR S PTR=$$PTR(ORP) Q:PTR'>0  Q:'$D(ORX(1,PTR))
"RTN","ORCSEND1",100,0)
 . S ORDIALOG(PTR,1)=ORX(1,PTR) S:$E(ORP)="O" OROI=ORX(1,PTR)
"RTN","ORCSEND1",101,0)
 S ORI=$$FRSTDOSE I $G(ORX(1,ORFRST)) D
"RTN","ORCSEND1",102,0)
 . F ORP=ORDOSE,ORT,ORID S:$D(ORX(ORI,ORP)) ORDIALOG(ORP,1)=ORX(ORI,ORP)
"RTN","ORCSEND1",103,0)
 . S ID=$G(ORX(ORI,ORID)) S:$P(ID,"&",6) ORDIALOG(ORDD,1)=$P(ID,"&",6)
"RTN","ORCSEND1",104,0)
 . S ORDIALOG(ORSCH,1)="NOW",ORSTART=$$NOW^XLFDT
"RTN","ORCSEND1",105,0)
 . D SIG,CHILD^ORCSEND3(ORSTART)
"RTN","ORCSEND1",106,0)
 F  D  S ORI=$O(ORX(ORI)) Q:ORI'>0
"RTN","ORCSEND1",107,0)
 . F ORP=ORDOSE,ORT,ORSCH,ORDUR,ORID,ORADMIN S:$D(ORX(ORI,ORP)) ORDIALOG(ORP,1)=ORX(ORI,ORP) K:'$D(ORX(ORI,ORP)) ORDIALOG(ORP,1)
"RTN","ORCSEND1",108,0)
 . K ORDIALOG(ORDD,1) S ID=$G(ORX(ORI,ORID))
"RTN","ORCSEND1",109,0)
 . S:$P(ID,"&",6) ORDIALOG(ORDD,1)=$P(ID,"&",6)
"RTN","ORCSEND1",110,0)
 . S ORSTART=$G(ORSTRT(ORI))
"RTN","ORCSEND1",111,0)
 . D SIG,CHILD^ORCSEND3(ORSTART)
"RTN","ORCSEND1",112,0)
 S:$G(ORCHLD) ^OR(100,ORPARENT,2,0)="^100.002PA^"_ORLAST_U_ORCHLD
"RTN","ORCSEND1",113,0)
 S ORIFN=ORPARENT,ORQUIT=1,OR3=$G(^OR(100,ORIFN,3)),STS=$P(OR3,U,3)
"RTN","ORCSEND1",114,0)
 I (STS=1)!(STS=13)!(STS=11) S ORERR="1^Unable to release orders"
"RTN","ORCSEND1",115,0)
 D RELEASE^ORCSAVE2(ORIFN,1,ORNOW,DUZ,$G(NATURE)) K ^TMP("ORWORD",$J)
"RTN","ORCSEND1",116,0)
 S $P(^OR(100,ORIFN,3),U,8)=1 ;veil parent order - set stop date/time?
"RTN","ORCSEND1",117,0)
 Q:(STS=1)!(STS=13)!(STS=11)  ;unsuccessful
"RTN","ORCSEND1",118,0)
PS2 ; ck if parent is unsigned or edit
"RTN","ORCSEND1",119,0)
 I $P($G(^OR(100,ORIFN,8,1,0)),U,4)=2 S $P(^(0),U,4)="" K ^OR(100,"AS",ORVP,9999999-ORLOG,ORIFN,1) ;clear ES
"RTN","ORCSEND1",120,0)
 Q:$P(OR3,U,11)'=1  S ORIG=$P(OR3,U,5) Q:ORIG'>0
"RTN","ORCSEND1",121,0)
 S CODE=$S($P($G(^OR(100,ORIG,3)),U,3)=5:"CA",1:"DC")
"RTN","ORCSEND1",122,0)
 D MSG^ORMBLD(ORIG,CODE) I "^1^13^"[(U_$P($G(^OR(100,ORIG,3)),U,3)_U) D
"RTN","ORCSEND1",123,0)
 . N NATR S NATR=+$O(^ORD(100.02,"C","C",0))
"RTN","ORCSEND1",124,0)
 . S $P(^OR(100,ORIG,3),U,3)=12,$P(^(3),U,7)=0,^(6)=NATR_U_DUZ_U_ORNOW
"RTN","ORCSEND1",125,0)
 . D CANCEL^ORCSEND(ORIG) ;ck for unrel actions
"RTN","ORCSEND1",126,0)
 Q
"RTN","ORCSEND1",127,0)
DOSES(IFN) ; count number of doses in order
"RTN","ORCSEND1",128,0)
 N I,CNT S CNT=0
"RTN","ORCSEND1",129,0)
 S I=0 F  S I=$O(^OR(100,+$G(IFN),4.5,"ID","INSTR",I)) Q:I'>0  I $L($G(^OR(100,+$G(IFN),4.5,I,1))) S CNT=CNT+1
"RTN","ORCSEND1",130,0)
 S I=+$O(^OR(100,+$G(IFN),4.5,"ID","NOW",0)) I I,$G(^OR(100,+$G(IFN),4.5,I,1)) S CNT=CNT+1
"RTN","ORCSEND1",131,0)
 Q CNT
"RTN","ORCSEND1",132,0)
FRSTDOSE() ; Return instance of first dose
"RTN","ORCSEND1",133,0)
 N I,Y S I=0,Y=1
"RTN","ORCSEND1",134,0)
 F  S I=$O(ORX(I)) Q:I'>0  I $D(ORX(I,ORDOSE)) S Y=I Q
"RTN","ORCSEND1",135,0)
 Q Y
"RTN","ORCSEND1",136,0)
SIG ; Build text of instructions
"RTN","ORCSEND1",137,0)
 N ORDRUG,ID,DOSE,ORI,ORX K ^TMP("ORWORD",$J,ORSIG,1)
"RTN","ORCSEND1",138,0)
 S ORDRUG=$G(ORDIALOG(ORDD,1)),ID=$G(ORDIALOG(ORID,1))
"RTN","ORCSEND1",139,0)
 S DOSE=$G(ORDIALOG(ORDOSE,1)),ORI=1
"RTN","ORCSEND1",140,0)
 S ORX=$$DOSE^ORCDPS2_$$RTE^ORCDPS2_$$SCH^ORCDPS2_$$DUR^ORCDPS2
"RTN","ORCSEND1",141,0)
 S ^TMP("ORWORD",$J,ORSIG,1,0)="^^1^1^"_DT_U,^(1,0)=ORX
"RTN","ORCSEND1",142,0)
 S ORDIALOG(ORSIG,1)=$NA(^TMP("ORWORD",$J,ORSIG,1))
"RTN","ORCSEND1",143,0)
 S ORDIALOG(ORDOSE,"FORMAT")="@"
"RTN","ORCSEND1",144,0)
 K ORDIALOG(ORSTR,1),ORDIALOG(ORDGNM,1)
"RTN","ORCSEND1",145,0)
 I ORDRUG,'ID D  ;set strength or drug name
"RTN","ORCSEND1",146,0)
 . N STR,ITM S STR=$P(ID,"&",7)_$P(ID,"&",8)
"RTN","ORCSEND1",147,0)
 . I STR'>0 S ORDIALOG(ORDGNM,1)=$$GET1^DIQ(50,+ORDRUG_",",.01) Q
"RTN","ORCSEND1",148,0)
 . S ITM=$P($G(^ORD(101.43,+$G(OROI),0)),U)
"RTN","ORCSEND1",149,0)
 . S:ITM'[STR ORDIALOG(ORSTR,1)=STR
"RTN","ORCSEND1",150,0)
 Q
"RTN","ORCSEND1",151,0)
STRT ; Build ORSTRT(inst)=date.time array of start times by dose
"RTN","ORCSEND1",152,0)
 N OI,PSOI,XD,XH,XM,XS,ORWD,ORI,SCH,ORSD,X,ORD K ORSTRT
"RTN","ORCSEND1",153,0)
 S OI=$G(ORX(1,$$PTR^ORCD("OR GTX ORDERABLE ITEM")))
"RTN","ORCSEND1",154,0)
 S PSOI=+$P($G(^ORD(101.43,+OI,0)),U,2),(XD,XH,XM,XS)=0
"RTN","ORCSEND1",155,0)
 S ORWD=+$G(^SC(+$G(ORL),42)) ;ward
"RTN","ORCSEND1",156,0)
 S ORI=0 F  S ORI=$O(ORX(ORI)) Q:ORI<1  D
"RTN","ORCSEND1",157,0)
 . S SCH=$G(ORX(ORI,ORSCH)),ORSD="" S:'$L(SCH) X=$$NOW^XLFDT
"RTN","ORCSEND1",158,0)
 . S:$L(SCH) ORSD=$$STARTSTP^PSJORPOE(+ORVP,SCH,PSOI,ORWD),X=$P(ORSD,U,4)
"RTN","ORCSEND1",159,0)
 . S ORSTRT(ORI)=$$FMADD^XLFDT(X,XD,XH,XM,XS) ;START+OFFSET
"RTN","ORCSEND1",160,0)
 . ; update OFFSET for next THEN dose
"RTN","ORCSEND1",161,0)
 . D DUR(ORI) I $G(ORX(ORI,ORCONJ))="T" D
"RTN","ORCSEND1",162,0)
 .. I $G(ORD("XD"))<1,$G(ORD("XH"))<1,$G(ORD("XM"))<1,$G(ORD("XS"))<1 S ORD("XD")=+$P(ORSD,U,3) ;default duration
"RTN","ORCSEND1",163,0)
 .. N I,Y F I="XD","XH","XM","XS" S Y=@I,@I=Y+$G(ORD(I))
"RTN","ORCSEND1",164,0)
 .. K ORD
"RTN","ORCSEND1",165,0)
 ; find beginning date.time for parent
"RTN","ORCSEND1",166,0)
 S ORI=0,X=9999999 F  S ORI=$O(ORSTRT(ORI)) Q:ORI<1  I ORSTRT(ORI)<X S X=ORSTRT(ORI)
"RTN","ORCSEND1",167,0)
 S ORSTRT("BEG")=X
"RTN","ORCSEND1",168,0)
 Q
"RTN","ORCSEND1",169,0)
DUR(I) ; Accumulate duration in ORD("Xt") for offsetting next THEN dose
"RTN","ORCSEND1",170,0)
 N X,Y S X=$$FMDUR^ORCDPS3($G(ORX(I,ORDUR)))
"RTN","ORCSEND1",171,0)
 I X["S",+X>$G(ORD("XS")) S ORD("XS")=+X
"RTN","ORCSEND1",172,0)
 I X["'",+X>$G(ORD("XM")) S ORD("XM")=+X
"RTN","ORCSEND1",173,0)
 I X["H",+X>$G(ORD("XH")) S ORD("XH")=+X
"RTN","ORCSEND1",174,0)
 S Y=$S(X["D":+X,X["W":+X*7,X["M":+X*30,1:0)
"RTN","ORCSEND1",175,0)
 I Y,Y>$G(ORD("XD")) S ORD("XD")=Y
"RTN","ORCSEND1",176,0)
 Q
"RTN","ORCSEND1",177,0)
VBEC ; Spawn VBECS children
"RTN","ORCSEND1",178,0)
 D:$L($T(EN^ORCSEND2)) EN^ORCSEND2
"RTN","ORCSEND1",179,0)
 Q
"RTN","ORCSEND3")
0^94^B25727603
"RTN","ORCSEND3",1,0)
ORCSEND3 ;SLC/MKB,AGP-Release cont ;05/20/2008
"RTN","ORCSEND3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORCSEND3",3,0)
 ;
"RTN","ORCSEND3",4,0)
CHILD(STRT) ; Create child order, send to package
"RTN","ORCSEND3",5,0)
 N ORAPPT
"RTN","ORCSEND3",6,0)
 K ORIFN D EN^ORCSAVE Q:'$G(ORIFN)  D STARTDT^ORCSAVE2(ORIFN)
"RTN","ORCSEND3",7,0)
 I $G(STRT) D DATES^ORCSAVE2(ORIFN,STRT)
"RTN","ORCSEND3",8,0)
 S ORCHLD=+$G(ORCHLD)+1,^OR(100,ORPARENT,2,ORIFN,0)=ORIFN,ORLAST=ORIFN
"RTN","ORCSEND3",9,0)
 S ORAPPT=$P($G(^OR(100,ORPARENT,0)),U,18)
"RTN","ORCSEND3",10,0)
 S $P(^OR(100,ORIFN,0),U,18)=ORAPPT,$P(^(3),U,9)=ORPARENT
"RTN","ORCSEND3",11,0)
 I $G(PKG)="LR" S $P(^OR(100,ORIFN,8,1,0),U,4)=8 K ^OR(100,"AS",ORVP,9999999-ORLOG,ORIFN,1) ;signature tracked on parent order only, for Labs
"RTN","ORCSEND3",12,0)
 I $G(PKG)?1"PS".E D
"RTN","ORCSEND3",13,0)
 . N X0 S X0=$G(^OR(100,ORPARENT,8,1,0))
"RTN","ORCSEND3",14,0)
 . I $P(X0,U,4)'=2 D SIGN^ORCSAVE2(ORIFN,+$P(X0,U,5),ORNOW,$P(X0,U,4),1)
"RTN","ORCSEND3",15,0)
 . I $D(^OR(100,ORPARENT,9)) M ^OR(100,ORIFN,9)=^OR(100,ORPARENT,9)
"RTN","ORCSEND3",16,0)
 . I $G(ORENEW) S OLD=$O(ORENEW(0)) I OLD S $P(^OR(100,OLD,3),U,6)=ORIFN,$P(^OR(100,ORIFN,3),U,5)=OLD,$P(^(3),U,11)=2 K ORENEW(OLD)
"RTN","ORCSEND3",17,0)
 D RELEASE^ORCSAVE2(ORIFN,1,ORNOW,DUZ,$G(NATURE)),NEW^ORMBLD(ORIFN)
"RTN","ORCSEND3",18,0)
 Q
"RTN","ORCSEND3",19,0)
 ;
"RTN","ORCSEND3",20,0)
DOSES(IFN) ;
"RTN","ORCSEND3",21,0)
 N I,CNT S CNT=0
"RTN","ORCSEND3",22,0)
 S I=+$O(^OR(100,+$G(IFN),4.5,"ID","NOW",0)) I I,$G(^OR(100,+$G(IFN),4.5,I,1)) S CNT=CNT+1
"RTN","ORCSEND3",23,0)
 Q CNT
"RTN","ORCSEND3",24,0)
 ;
"RTN","ORCSEND3",25,0)
GETORDER(IFN) ; Set ORX(Inst,Ptr)=Value
"RTN","ORCSEND3",26,0)
 N I,X,Y,PTR,INST,TYPE,SOLCNT,ADDCNT
"RTN","ORCSEND3",27,0)
 S (SOLCNT,ADDCNT)=0
"RTN","ORCSEND3",28,0)
 S I=0 F  S I=$O(^OR(100,IFN,4.5,I)) Q:I'>0  S X=$G(^(I,0)),Y=$G(^(1)) D
"RTN","ORCSEND3",29,0)
 . S PTR=+$P(X,U,2),INST=+$P(X,U,3),TYPE=$P($G(^ORD(101.41,PTR,1)),U)
"RTN","ORCSEND3",30,0)
 . I TYPE'="W" S ORX(PTR,INST)=Y Q
"RTN","ORCSEND3",31,0)
 . ;S ORX(INST,PTR)="^OR(100,"_IFN_",4.5,"_I_",2)"
"RTN","ORCSEND3",32,0)
 . S ORX(PTR,INST)="^OR(100,"_IFN_",4.5,"_I_",2)"
"RTN","ORCSEND3",33,0)
 Q
"RTN","ORCSEND3",34,0)
PSJI ;
"RTN","ORCSEND3",35,0)
 ;IV dialog
"RTN","ORCSEND3",36,0)
 N ORPARENT,OR0,ORNP,ORDIALOG,ORDUZ,ORLOG,ORL,ORDG,ORCAT,ORX,ORP,ORI,STS
"RTN","ORCSEND3",37,0)
 N ORDOSE,ORT,ORSCH,ORDUR,ORSTRT,ORFRST,ORCONJ,ORID,ORDD,ORSTR,ORDGNM
"RTN","ORCSEND3",38,0)
 N ORSTART,ORCHLD,ORLAST,ORSIG,OROI,ID,OR3,ORIG,CODE,PKG,ORENEW,I,ORADMIN
"RTN","ORCSEND3",39,0)
 N ORDUR
"RTN","ORCSEND3",40,0)
 N CNT
"RTN","ORCSEND3",41,0)
 S ORPARENT=+ORIFN,OR0=$G(^OR(100,ORPARENT,0)),OR3=$G(^OR(100,ORPARENT,3))
"RTN","ORCSEND3",42,0)
 S ORCAT="I",ORNP=+$P(OR0,U,4)
"RTN","ORCSEND3",43,0)
 ;Q:$P(OR0,U,12)'="I"  S ORCAT="I",ORNP=+$P(OR0,U,4)
"RTN","ORCSEND3",44,0)
 S ORDIALOG=+$P(OR0,U,5),ORDUZ=+$P(OR0,U,6),ORLOG=$P(OR0,U,7)
"RTN","ORCSEND3",45,0)
 S ORL=$P(OR0,U,10),ORDG=+$P(OR0,U,11),PKG=$$GET1^DIQ(9.4,+$P(OR0,U,14)_",",1)
"RTN","ORCSEND3",46,0)
 ;Build ORDIALOG Array and ORX local array
"RTN","ORCSEND3",47,0)
 D GETDLG1^ORCD(ORDIALOG),GETORDER(ORPARENT)
"RTN","ORCSEND3",48,0)
 ;
"RTN","ORCSEND3",49,0)
 S ORSCH=$$PTR("SCHEDULE"),ORDUR=$$PTR("DURATION")
"RTN","ORCSEND3",50,0)
 D STRT S ORSTART=$G(ORSTRT("BEG"))
"RTN","ORCSEND3",51,0)
 S ORADMIN=$$PTR("ADMIN TIMES")
"RTN","ORCSEND3",52,0)
 D DATES^ORCSAVE2(ORPARENT,ORSTART) Q:$$DOSES(ORPARENT)<1
"RTN","ORCSEND3",53,0)
 S ORFRST=$$PTR("NOW"),ORSIG=$$PTR("SIG")
"RTN","ORCSEND3",54,0)
 ;
"RTN","ORCSEND3",55,0)
 I $P(OR3,U,11)=2,$O(^OR(100,+$P(OR3,U,5),2,0)) D
"RTN","ORCSEND3",56,0)
 . S ORENEW=+$P(OR3,U,5),I=0
"RTN","ORCSEND3",57,0)
 . I $$VALUE^ORX8(ORENEW,"NOW") S I=$O(^OR(100,ORENEW,2,0))
"RTN","ORCSEND3",58,0)
 . F  S I=$O(^OR(100,ORENEW,2,I)) Q:I<1  S ORENEW(I)=""
"RTN","ORCSEND3",59,0)
 ;
"RTN","ORCSEND3",60,0)
PSJI1 ;
"RTN","ORCSEND3",61,0)
 ;Build Order Dialog Prompts that can have Multiple Responses
"RTN","ORCSEND3",62,0)
 F ORP="ADDITIVE","ORDERABLE ITEM","STRENGTH PSIV","UNITS","VOLUME" D
"RTN","ORCSEND3",63,0)
 . N PTR S PTR=$$PTR(ORP) Q:PTR'>0  Q:'$D(ORX(PTR,1))
"RTN","ORCSEND3",64,0)
 . S CNT=0 F  S CNT=$O(ORX(PTR,CNT)) Q:CNT'>0  S ORDIALOG(PTR,CNT)=ORX(PTR,CNT)
"RTN","ORCSEND3",65,0)
 ;
"RTN","ORCSEND3",66,0)
 ;Build Order Dialog Responses that should be in both Child Orders
"RTN","ORCSEND3",67,0)
 F ORP="INFUSION RATE","IV TYPE","ROUTE","URGENCY","WORD PROCESSING 1" D
"RTN","ORCSEND3",68,0)
 . N PTR S PTR=$$PTR(ORP) Q:PTR'>0  Q:'$D(ORX(PTR,1))
"RTN","ORCSEND3",69,0)
 . S ORDIALOG(PTR,1)=ORX(PTR,1) S:$E(ORP)="O" OROI=ORX(PTR,1) Q
"RTN","ORCSEND3",70,0)
 ;
"RTN","ORCSEND3",71,0)
 ;If NOW order create NOW Child Order
"RTN","ORCSEND3",72,0)
 I $G(ORX(ORFRST,1)) D
"RTN","ORCSEND3",73,0)
 . S:$D(ORX(ORP,1)) ORDIALOG(ORP,1)=ORX(ORP,1)
"RTN","ORCSEND3",74,0)
 . ;S ID=$G(ORX(ORI,ORID)) S:$P(ID,"&",6) ORDIALOG(ORDD,1)=$P(ID,"&",6)
"RTN","ORCSEND3",75,0)
 . S ORDIALOG(ORSCH,1)="NOW",ORSTART=$$NOW^XLFDT
"RTN","ORCSEND3",76,0)
 . D CHILD(ORSTART)
"RTN","ORCSEND3",77,0)
 ;
"RTN","ORCSEND3",78,0)
 ;Build Order Fields for non-NOW Child Order
"RTN","ORCSEND3",79,0)
 F ORP=ORSCH,ORADMIN,ORDUR S:$D(ORX(ORP,1)) ORDIALOG(ORP,1)=ORX(ORP,1) K:'$D(ORX(ORP,1)) ORDIALOG(ORP,1)
"RTN","ORCSEND3",80,0)
 S ORSTART=$G(ORSTRT(1))
"RTN","ORCSEND3",81,0)
 D CHILD(ORSTART)
"RTN","ORCSEND3",82,0)
 ;
"RTN","ORCSEND3",83,0)
 S:$G(ORCHLD) ^OR(100,ORPARENT,2,0)="^100.002PA^"_ORLAST_U_ORCHLD
"RTN","ORCSEND3",84,0)
 S ORIFN=ORPARENT,ORQUIT=1,OR3=$G(^OR(100,ORIFN,3)),STS=$P(OR3,U,3)
"RTN","ORCSEND3",85,0)
 I (STS=1)!(STS=13)!(STS=11) S ORERR="1^Unable to release orders"
"RTN","ORCSEND3",86,0)
 D RELEASE^ORCSAVE2(ORIFN,1,ORNOW,DUZ,$G(NATURE)) K ^TMP("ORWORD",$J)
"RTN","ORCSEND3",87,0)
 S $P(^OR(100,ORIFN,3),U,8)=1 ;veil parent order - set stop date/time?
"RTN","ORCSEND3",88,0)
 Q:(STS=1)!(STS=13)!(STS=11)  ;unsuccessful
"RTN","ORCSEND3",89,0)
PSJI2 ; ck if parent is unsigned or edit
"RTN","ORCSEND3",90,0)
 I $P($G(^OR(100,ORIFN,8,1,0)),U,4)=2 S $P(^(0),U,4)="" K ^OR(100,"AS",ORVP,9999999-ORLOG,ORIFN,1) ;clear ES
"RTN","ORCSEND3",91,0)
 Q:$P(OR3,U,11)'=1  S ORIG=$P(OR3,U,5) Q:ORIG'>0
"RTN","ORCSEND3",92,0)
 S CODE=$S($P($G(^OR(100,ORIG,3)),U,3)=5:"CA",1:"DC")
"RTN","ORCSEND3",93,0)
 D MSG^ORMBLD(ORIG,CODE) I "^1^13^"[(U_$P($G(^OR(100,ORIG,3)),U,3)_U) D
"RTN","ORCSEND3",94,0)
 . N NATR S NATR=+$O(^ORD(100.02,"C","C",0))
"RTN","ORCSEND3",95,0)
 . S $P(^OR(100,ORIG,3),U,3)=12,$P(^(3),U,7)=0,^(6)=NATR_U_DUZ_U_ORNOW
"RTN","ORCSEND3",96,0)
 . D CANCEL^ORCSEND(ORIG) ;ck for unrel actions
"RTN","ORCSEND3",97,0)
 Q
"RTN","ORCSEND3",98,0)
PTR(X) ; Returns ptr of prompt X in Order Dialog file
"RTN","ORCSEND3",99,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_X,1,63),0))
"RTN","ORCSEND3",100,0)
 ;
"RTN","ORCSEND3",101,0)
STRT ; Build ORSTRT(inst)=date.time array of start times by dose
"RTN","ORCSEND3",102,0)
 N OI,PSOI,XD,XH,XM,XS,ORWD,ORI,SCH,ORSD,X,ORD K ORSTRT
"RTN","ORCSEND3",103,0)
 S OI=$G(ORX($$PTR^ORCD("OR GTX ORDERABLE ITEM"),1))
"RTN","ORCSEND3",104,0)
 ;if OI is null assume Intermittent IV order this does not required a 
"RTN","ORCSEND3",105,0)
 ;solution check for an additive only value
"RTN","ORCSEND3",106,0)
 I OI="" S OI=$G(ORX($$PTR^ORCD("OR GTX ADDITIVE"),1))
"RTN","ORCSEND3",107,0)
 S PSOI=+$P($G(^ORD(101.43,+OI,0)),U,2),(XD,XH,XM,XS)=0
"RTN","ORCSEND3",108,0)
 S ORWD=+$G(^SC(+$G(ORL),42)) ;ward
"RTN","ORCSEND3",109,0)
 ;S ORI=0 F  S ORI=$O(ORX(ORI)) Q:ORI<1  D
"RTN","ORCSEND3",110,0)
 S SCH=$G(ORX(ORSCH,1)),ORSD="" S:'$L(SCH) X=$$NOW^XLFDT
"RTN","ORCSEND3",111,0)
 S:$L(SCH) ORSD=$$STARTSTP^PSJORPOE(+ORVP,SCH,PSOI,ORWD),X=$P(ORSD,U,4)
"RTN","ORCSEND3",112,0)
 S ORSTRT(1)=$$FMADD^XLFDT(X,XD,XH,XM,XS) ;START+OFFSET
"RTN","ORCSEND3",113,0)
 ; find beginning date.time for parent
"RTN","ORCSEND3",114,0)
 S ORI=0,X=9999999 F  S ORI=$O(ORSTRT(ORI)) Q:ORI<1  I ORSTRT(ORI)<X S X=ORSTRT(ORI)
"RTN","ORCSEND3",115,0)
 S ORSTRT("BEG")=X
"RTN","ORCSEND3",116,0)
 Q
"RTN","ORCXPND1")
0^16^B72217223
"RTN","ORCXPND1",1,0)
ORCXPND1 ; SLC/MKB - Expanded Display cont ; 04/25/2007
"RTN","ORCXPND1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**26,67,75,89,92,94,148,159,188,172,215,243**;Dec 17, 1997;Build 242
"RTN","ORCXPND1",3,0)
 ;
"RTN","ORCXPND1",4,0)
 ; External References
"RTN","ORCXPND1",5,0)
 ;   DBIA  2387  ^LAB(60
"RTN","ORCXPND1",6,0)
 ;   DBIA  3420  ^DPT(  file #2
"RTN","ORCXPND1",7,0)
 ;   DBIA 10035  ^DPT(  file #2
"RTN","ORCXPND1",8,0)
 ;   DBIA 10037  EN^DGRPD
"RTN","ORCXPND1",9,0)
 ;   DBIA   700  DIS^DGRPDB
"RTN","ORCXPND1",10,0)
 ;   DBIA  2926  RT^GMRCGUIA
"RTN","ORCXPND1",11,0)
 ;   DBIA  2925  DT^GMRCSLM2                     ^TMP("GMRCR"
"RTN","ORCXPND1",12,0)
 ;   DBIA  2503  RR^LR7OR1                       ^TMP("LRRR"
"RTN","ORCXPND1",13,0)
 ;   DBIA  2951  EN1^LR7OSBR                     ^TMP("LRC"
"RTN","ORCXPND1",14,0)
 ;   DBIA  2952  EN^LR7OSMZ0
"RTN","ORCXPND1",15,0)
 ;   DBIA  2400  OEL^PSOORRL                     ^TMP("PS"
"RTN","ORCXPND1",16,0)
 ;   DBIA  2877  EN3^RAO7PC3
"RTN","ORCXPND1",17,0)
 ;   DBIA  2877  EN30^RAO7PC3
"RTN","ORCXPND1",18,0)
 ;   DBIA  1252  $$OUTPTPR^SDUTL3
"RTN","ORCXPND1",19,0)
 ;   DBIA  1252  $$OUTPTTM^SDUTL3
"RTN","ORCXPND1",20,0)
 ;   DBIA  2832  RPC^TIUSRV
"RTN","ORCXPND1",21,0)
 ;   DBIA 10061  DEM^VADPT
"RTN","ORCXPND1",22,0)
 ;   DBIA 10061  KVAR^VADPT
"RTN","ORCXPND1",23,0)
 ;   DBIA 10061  OAD^VADPT
"RTN","ORCXPND1",24,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","ORCXPND1",25,0)
 ;   DBIA  4408  DISP^DGIBDSP
"RTN","ORCXPND1",26,0)
 ;                       
"RTN","ORCXPND1",27,0)
COVER ; -- Cover Sheet
"RTN","ORCXPND1",28,0)
 N PKG S PKG=$P($G(^TMP("OR",$J,ORTAB,"IDX",NUM)),U,4)
"RTN","ORCXPND1",29,0)
 D ALLERGY^ORCXPND2:PKG="GMRA",NOTES:PKG="TIU"
"RTN","ORCXPND1",30,0)
 Q
"RTN","ORCXPND1",31,0)
NOTES ; -- Progress Notes
"RTN","ORCXPND1",32,0)
 N I,ORY,DATE,AUTHOR,PTLOC,SUBJ K ^TMP("TIUAUDIT",$J)
"RTN","ORCXPND1",33,0)
 D RPC^TIUSRV(.ORY,ID)
"RTN","ORCXPND1",34,0)
 S I=0 F  S I=$O(@ORY@(I)) Q:I'>0  S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=$G(@ORY@(I,0))
"RTN","ORCXPND1",35,0)
 K @ORY
"RTN","ORCXPND1",36,0)
 Q
"RTN","ORCXPND1",37,0)
PROBLEMS ; -- Problem List
"RTN","ORCXPND1",38,0)
 D PL^ORCXPND4
"RTN","ORCXPND1",39,0)
 Q
"RTN","ORCXPND1",40,0)
MEDS ; -- Pharmacy
"RTN","ORCXPND1",41,0)
 ;N NODE,ORIFN
"RTN","ORCXPND1",42,0)
 K ^TMP("PS",$J)
"RTN","ORCXPND1",43,0)
 D OEL^PSOORRL(+ORVP,ID) ;S NODE=$G(^TMP("PS",$J,0)),ORIFN=+$P(NODE,U,11)
"RTN","ORCXPND1",44,0)
 S ID=+$P($G(^TMP("PS",$J,0)),U,11) D ORDERS  ;DBIA 2400
"RTN","ORCXPND1",45,0)
 ;D @($S($P($G(^OR(100,ORIFN,0)),U,11)=$O(^ORD(100.98,"B","IV RX",0)):"IV",1:"DRUG")_"^ORCXPND2")
"RTN","ORCXPND1",46,0)
 K ^TMP("PS",$J)
"RTN","ORCXPND1",47,0)
 Q
"RTN","ORCXPND1",48,0)
LABS ; -- Laboratory [RESULTS ONLY for ID=OE order #]
"RTN","ORCXPND1",49,0)
 N ORIFN,X,SUB,TEST,NAME,SS,IDE,IVDT,TST,CCNT,ORCY,IG,TCNT
"RTN","ORCXPND1",50,0)
 K ^TMP("LRRR",$J)  ;DBIA 2503
"RTN","ORCXPND1",51,0)
 I (ID?2.5U1" "2N1" "1.N1"-"7N1"."1.4N)!(ID?2.5U1" "2N1" "1.N1"-"7N) D AP^ORCXPND3 Q  ;ID=Accession #-Date/time specimen taken
"RTN","ORCXPND1",52,0)
 S ORIFN=+ID,IDE=$G(^OR(100,+ID,4)) Q:'$L(IDE)  ; OE# -> Lab#
"RTN","ORCXPND1",53,0)
 I +IDE  D RR^LR7OR1(+ORVP,IDE) I '$D(^TMP("LRRR",$J,+ORVP)) S $P(IDE,";",1,3)=";;" ;Order possibly purged, reset to lookup on file 63
"RTN","ORCXPND1",54,0)
 I '+IDE,$P(IDE,";",5)  D RR^LR7OR1(+ORVP,,9999999-$P(IDE,";",5),9999999-$P(IDE,";",5),$P(IDE,";",4))
"RTN","ORCXPND1",55,0)
 K ORCY D TEXT^ORQ12(.ORCY,ORIFN,80)
"RTN","ORCXPND1",56,0)
 S IG=0 F  S IG=$O(ORCY(IG)) Q:IG<1  S X=ORCY(IG) D ITEM^ORCXPND(X)
"RTN","ORCXPND1",57,0)
 D BLANK^ORCXPND I '$D(^TMP("LRRR",$J,+ORVP)) S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="No data available." Q
"RTN","ORCXPND1",58,0)
 M TEST=^TMP("LRRR",$J,+ORVP) S CCNT=0,SS=""
"RTN","ORCXPND1",59,0)
 F  S SS=$O(TEST(SS)) Q:SS=""  S IVDT=0 F  S IVDT=$O(TEST(SS,IVDT)) Q:'IVDT  D
"RTN","ORCXPND1",60,0)
 . I SS="BB" D
"RTN","ORCXPND1",61,0)
 .. I $$GET^XPAR("DIV^SYS^PKG","OR VBECS ON",1,"Q"),$L($T(EN^ORWLR1)),$L($T(CPRS^VBECA3B)) D  Q  ;Transition to VBEC's interface
"RTN","ORCXPND1",62,0)
 ... K ^TMP("ORLRC",$J)
"RTN","ORCXPND1",63,0)
 ... D EN^ORWLR1(DFN)
"RTN","ORCXPND1",64,0)
 ... I '$O(^TMP("ORLRC",$J,0)) S ^TMP("ORLRC",$J,1,0)="",^TMP("ORLRC",$J,2,0)="No Blood Bank report available..."
"RTN","ORCXPND1",65,0)
 ... N I S I=0 F  S I=$O(^TMP("ORLRC",$J,I)) Q:I<1  S X=^(I,0),LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X
"RTN","ORCXPND1",66,0)
 ... K ^TMP("ORLRC",$J)
"RTN","ORCXPND1",67,0)
 .. K ^TMP("LRC",$J) D EN1^LR7OSBR(+ORVP) Q:'$D(^TMP("LRC",$J))  D  Q  ;DBIA 2951
"RTN","ORCXPND1",68,0)
 ... N I S I=0 F  S I=$O(^TMP("LRC",$J,I)) Q:I<1  S X=^(I,0),LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X
"RTN","ORCXPND1",69,0)
 ... K ^TMP("LRC",$J)
"RTN","ORCXPND1",70,0)
 . I SS="MI" K ^TMP("LRC",$J) D EN^LR7OSMZ0(+ORVP) Q:'$D(^TMP("LRC",$J))  D  Q
"RTN","ORCXPND1",71,0)
 .. N I S I=0 F  S I=$O(^TMP("LRC",$J,I)) Q:I<1  S X=^(I,0),LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X
"RTN","ORCXPND1",72,0)
 .. K ^TMP("LRC",$J)
"RTN","ORCXPND1",73,0)
 . I SS="CH" D  Q
"RTN","ORCXPND1",74,0)
 .. S (TCNT,TST)=0 F  S TST=$O(TEST(SS,IVDT,TST)) Q:TST=""  S CCNT=0,TCNT=TCNT+1 D
"RTN","ORCXPND1",75,0)
 ... I TCNT=1 D
"RTN","ORCXPND1",76,0)
 .... S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="   Collection time:          "_$$FMTE^XLFDT(9999999-IVDT,1)
"RTN","ORCXPND1",77,0)
 .... S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=$$S(1,CCNT," ")_$$S(3,CCNT,"Test Name")_$$S(29,CCNT,"Result")_$$S(39,CCNT,"Units")_$$S(55,CCNT,"Range") D:$D(IOUON) SETVIDEO^ORCXPND(LCNT,1,70,IOUON,IOUOFF)
"RTN","ORCXPND1",78,0)
 ... I TST S X=TEST(SS,IVDT,TST),CCNT=0 I +X D
"RTN","ORCXPND1",79,0)
 .... S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=$$S(1,CCNT,$P(^LAB(60,+X,0),U))_$$S(26,CCNT,$J($P(X,U,2),7))_$$S(34,CCNT,$S($L($P(X,U,3)):$P(X,U,3),1:""))_$$S(39,CCNT,$P(X,U,4))_$$S(45,CCNT,$J($P(X,U,5),15))
"RTN","ORCXPND1",80,0)
 .... I $L($P(X,U,3)),$D(IOINHI) D SETVIDEO^ORCXPND(LCNT,26,8,IOINHI,IOINORM)
"RTN","ORCXPND1",81,0)
 .... I $P(X,U,3)["*",$D(IOBON),$D(IOINHI) D SETVIDEO^ORCXPND(LCNT,26,8,IOBON_IOINHI,IOBOFF_IOINORM)
"RTN","ORCXPND1",82,0)
 ... I TST="N" S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=" Comments: " D
"RTN","ORCXPND1",83,0)
 .... N CMT S CMT=0 F  S CMT=$O(TEST(SS,IVDT,"N",CMT)) Q:'CMT  S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=" "_TEST(SS,IVDT,"N",CMT)
"RTN","ORCXPND1",84,0)
 K ^TMP("LRRR",$J)
"RTN","ORCXPND1",85,0)
 Q
"RTN","ORCXPND1",86,0)
 ;
"RTN","ORCXPND1",87,0)
DELAY ; -- Delayed Orders
"RTN","ORCXPND1",88,0)
NEW ; -- New Orders
"RTN","ORCXPND1",89,0)
ORDERS ; -- Orders
"RTN","ORCXPND1",90,0)
 I '$G(ORESULTS) D ORDERS^ORCXPND2 Q
"RTN","ORCXPND1",91,0)
 ; -- Results Display (Add more packages as available)
"RTN","ORCXPND1",92,0)
 N PKG,TAB,ORIFN
"RTN","ORCXPND1",93,0)
 S PKG=+$P($G(^OR(100,+ID,0)),"^",14),PKG=$$NMSP^ORCD(PKG)
"RTN","ORCXPND1",94,0)
 S TAB=$S(PKG="LR":"LABS",PKG="GMRC":"CONSULTS",PKG="RA":"XRAYS",1:"")
"RTN","ORCXPND1",95,0)
 I '$L(TAB)!(ID'>0) D  Q  ; no display available
"RTN","ORCXPND1",96,0)
 . N ORY,I D TEXT^ORQ12(.ORY,+ID,80)
"RTN","ORCXPND1",97,0)
 . S I=0 F  S I=$O(ORY(I)) Q:I'>0  D ITEM^ORCXPND(ORY(I))
"RTN","ORCXPND1",98,0)
 . D BLANK^ORCXPND
"RTN","ORCXPND1",99,0)
 . S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="There are no results to report."
"RTN","ORCXPND1",100,0)
 I $O(^OR(100,+ID,2,0)) S ORIFN=+ID,ID=0 F  S ID=$O(^OR(100,ORIFN,2,ID)) Q:ID<1  I $D(^OR(100,ID,0)) D @TAB
"RTN","ORCXPND1",101,0)
 I '$O(^OR(100,+ID,2,0)) D @TAB
"RTN","ORCXPND1",102,0)
 Q
"RTN","ORCXPND1",103,0)
REPORTS ; -- Patient Profiles
"RTN","ORCXPND1",104,0)
 D EN^ORCXPNDR ; Reports
"RTN","ORCXPND1",105,0)
 Q
"RTN","ORCXPND1",106,0)
CONSULTS ; -- Consults
"RTN","ORCXPND1",107,0)
 N I,X,SUB,ORTX ;,VALMAR
"RTN","ORCXPND1",108,0)
 I $G(ORTAB)="CONSULTS" S X=$P($G(^TMP("OR",$J,ORTAB,"IDX",NUM)),U,4)
"RTN","ORCXPND1",109,0)
 E  D TEXT^ORQ12(.ORTX,+ID) S X=ORTX(1),ID=+$G(^OR(100,+ID,4)) ; OE->GMRC order#
"RTN","ORCXPND1",110,0)
 D ITEM^ORCXPND(X),BLANK^ORCXPND
"RTN","ORCXPND1",111,0)
 I ID'>0 S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="No data available." Q
"RTN","ORCXPND1",112,0)
 I '$G(ORESULTS) D  ;DT action
"RTN","ORCXPND1",113,0)
 . S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Consult No.:           "_ID
"RTN","ORCXPND1",114,0)
 . N GMRCOER S GMRCOER=2 D DT^GMRCSLM2(ID) S SUB="DT"  ;DBIA 2925
"RTN","ORCXPND1",115,0)
 I $G(ORESULTS) D RT^GMRCGUIA(ID,"^TMP(""GMRCR"",$J,""RT"")") S SUB="RT"
"RTN","ORCXPND1",116,0)
 S I=0 F  S I=$O(^TMP("GMRCR",$J,SUB,I)) Q:I'>0  S X=$G(^(I,0)),LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X  ;DBIA 2925
"RTN","ORCXPND1",117,0)
 K ^TMP("GMRCR",$J)
"RTN","ORCXPND1",118,0)
 Q
"RTN","ORCXPND1",119,0)
XRAYS ; -- Radiology
"RTN","ORCXPND1",120,0)
 I '$G(ORESULTS) S ID=+ORVP_U_$TR(ID,"-","^") D EN3^RAO7PC3(ID)
"RTN","ORCXPND1",121,0)
 I $G(ORESULTS) S ID=+$G(^OR(100,+ID,4)) D EN30^RAO7PC3(ID)
"RTN","ORCXPND1",122,0)
 N CASE,PROC,PSET S PSET=$D(^TMP($J,"RAE3",+ORVP,"PRINT_SET"))
"RTN","ORCXPND1",123,0)
 S CASE=0 F  S CASE=$O(^TMP($J,"RAE3",+ORVP,CASE)) Q:CASE'>0  D
"RTN","ORCXPND1",124,0)
 . I PSET S PROC=$O(^TMP($J,"RAE3",+ORVP,CASE,"")) D ITEM^ORCXPND(PROC) Q
"RTN","ORCXPND1",125,0)
 . S PROC="" F  S PROC=$O(^TMP($J,"RAE3",+ORVP,CASE,PROC)) Q:PROC=""  D ITEM^ORCXPND(PROC),BLANK^ORCXPND,XRPT,BLANK^ORCXPND
"RTN","ORCXPND1",126,0)
 I PSET S CASE=$O(^TMP($J,"RAE3",+ORVP,0)),PROC=$O(^(CASE,"")) D BLANK^ORCXPND,XRPT,BLANK^ORCXPND ;printset=list all procs, then one report
"RTN","ORCXPND1",127,0)
 K ^TMP($J,"RAE3",+ORVP),^UTILITY($J,"W")
"RTN","ORCXPND1",128,0)
 S VALM("RM")=81
"RTN","ORCXPND1",129,0)
 Q
"RTN","ORCXPND1",130,0)
 ;
"RTN","ORCXPND1",131,0)
XRPT ; -- Body of Report for CASE, PROC
"RTN","ORCXPND1",132,0)
 N ORD,X,I
"RTN","ORCXPND1",133,0)
 S ORD=$S($L($G(^TMP($J,"RAE3",+ORVP,"ORD"))):^("ORD"),$L($G(^("ORD",CASE))):^(CASE),1:"") I $L(ORD),ORD'=PROC S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Proc Ord: "_ORD
"RTN","ORCXPND1",134,0)
 S I=1 F  S I=$O(^TMP($J,"RAE3",+ORVP,CASE,PROC,I)) Q:I'>0  S X=^(I),LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X ;Skip pt ID on line 1
"RTN","ORCXPND1",135,0)
 Q
"RTN","ORCXPND1",136,0)
 ;
"RTN","ORCXPND1",137,0)
SUMMRIES ; -- Discharge Summaries
"RTN","ORCXPND1",138,0)
 N I,ORY,DATE,AUTHOR,PTLOC,SUBJ K ^TMP("TIUAUDIT",$J)
"RTN","ORCXPND1",139,0)
 D RPC^TIUSRV(.ORY,ID)
"RTN","ORCXPND1",140,0)
 S I=0 F  S I=$O(@ORY@(I)) Q:I'>0  S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=$G(@ORY@(I,0))
"RTN","ORCXPND1",141,0)
 K @ORY
"RTN","ORCXPND1",142,0)
 Q
"RTN","ORCXPND1",143,0)
PTINQ ; Print Patient Inquiry in List Manager
"RTN","ORCXPND1",144,0)
 N DFN,ORI,X
"RTN","ORCXPND1",145,0)
 S DFN=+ORVP
"RTN","ORCXPND1",146,0)
 D DGINQ(DFN)
"RTN","ORCXPND1",147,0)
 S ORI=4,LCNT=0
"RTN","ORCXPND1",148,0)
 F  S ORI=$O(^TMP("ORDATA",$J,1,ORI)) Q:'ORI  S X=^(ORI) D
"RTN","ORCXPND1",149,0)
 . S LCNT=LCNT+1
"RTN","ORCXPND1",150,0)
 . S ^TMP("ORXPND",$J,LCNT,0)=X
"RTN","ORCXPND1",151,0)
 K ^TMP("ORDATA",$J,1)
"RTN","ORCXPND1",152,0)
 Q
"RTN","ORCXPND1",153,0)
 ;
"RTN","ORCXPND1",154,0)
DGINQ(DFN) ; Patient Inquiry
"RTN","ORCXPND1",155,0)
 D START^ORWRP(80,"DGINQB^ORCXPND1(DFN)")
"RTN","ORCXPND1",156,0)
 Q
"RTN","ORCXPND1",157,0)
DGINQB(DFN) ; Build Patient Inquiry
"RTN","ORCXPND1",158,0)
 N CONTACT,ORDOC,ORTEAM,ORVP,XQORNOD,ORSSTRT,ORSSTOPT,VAOA
"RTN","ORCXPND1",159,0)
 S ORVP=DFN_";DPT(",XQORNOD=1
"RTN","ORCXPND1",160,0)
 D EN^DGRPD ; MAS Patient Inquiry
"RTN","ORCXPND1",161,0)
 ;
"RTN","ORCXPND1",162,0)
 S ORDOC=$$OUTPTPR^SDUTL3(DFN)
"RTN","ORCXPND1",163,0)
 S ORTEAM=$$OUTPTTM^SDUTL3(DFN)
"RTN","ORCXPND1",164,0)
 I ORDOC!ORTEAM  D
"RTN","ORCXPND1",165,0)
 . W !!,"Primary Care Information:"
"RTN","ORCXPND1",166,0)
 . I ORDOC W !,"Primary Practitioner:  ",$P(ORDOC,"^",2)
"RTN","ORCXPND1",167,0)
 . I ORTEAM W !,"Primary Care Team:     ",$P(ORTEAM,"^",2)
"RTN","ORCXPND1",168,0)
 W !!,"Health Insurance Information:"
"RTN","ORCXPND1",169,0)
 D DISP^DGIBDSP  ;DBIA #4408
"RTN","ORCXPND1",170,0)
 W !!,"Service Connection/Rated Disabilities:"
"RTN","ORCXPND1",171,0)
 D DIS^DGRPDB
"RTN","ORCXPND1",172,0)
 F CONTACT="N","S" D
"RTN","ORCXPND1",173,0)
 .S VAOA("A")=$S(CONTACT="N":"",1:3)
"RTN","ORCXPND1",174,0)
 .D OAD^VADPT ;   Get NOK Information
"RTN","ORCXPND1",175,0)
 .I VAOA(9)]"" D
"RTN","ORCXPND1",176,0)
 .. W !!,$S(CONTACT="N":"Next of Kin Information:",1:"Secondary Next of Kin Information:")
"RTN","ORCXPND1",177,0)
 .. W !,"Name:  ",VAOA(9)                          ;     NOK Name
"RTN","ORCXPND1",178,0)
 .. I VAOA(10)]"" W " (",VAOA(10),")"              ;     Relationship
"RTN","ORCXPND1",179,0)
 .. I VAOA(1)]"" W !?7,VAOA(1)                     ;     Address Line 1
"RTN","ORCXPND1",180,0)
 .. I VAOA(2)]"" W !?7,VAOA(2)                     ;     Line 2
"RTN","ORCXPND1",181,0)
 .. I VAOA(3)]"" W !?7,VAOA(3)                     ;     Line 3
"RTN","ORCXPND1",182,0)
 .. I VAOA(4)]"" D
"RTN","ORCXPND1",183,0)
 .. . W !?7,VAOA(4)                                ;     City
"RTN","ORCXPND1",184,0)
 .. . I VAOA(5)]"" W ", "_$P(VAOA(5),"^",2)        ;     State
"RTN","ORCXPND1",185,0)
 .. . W "  ",$P(VAOA(11),"^",2)                    ;     Zip+4
"RTN","ORCXPND1",186,0)
 .. I VAOA(8)]"" W !!?7,"Phone number:  ",VAOA(8)  ;     Phone
"RTN","ORCXPND1",187,0)
 .. I CONTACT="N",$P($G(^DPT(DFN,.21)),U,11)]"" W !?7,"Work phone number:  ",$P(^DPT(DFN,.21),U,11)
"RTN","ORCXPND1",188,0)
 .. I CONTACT="S",$P($G(^DPT(DFN,.211)),U,11)]"" W !?7,"Work phone number:  ",$P(^DPT(DFN,.211),U,11)
"RTN","ORCXPND1",189,0)
 D KVAR^VADPT
"RTN","ORCXPND1",190,0)
 Q
"RTN","ORCXPND1",191,0)
TRIM(X) ;   Trim Spaces
"RTN","ORCXPND1",192,0)
 S X=$G(X) F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","ORCXPND1",193,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","ORCXPND1",194,0)
 Q X
"RTN","ORCXPND1",195,0)
S(X,Y,Z) ; Pad Over
"RTN","ORCXPND1",196,0)
 ;   X=Column #
"RTN","ORCXPND1",197,0)
 ;   Y=Current Length
"RTN","ORCXPND1",198,0)
 ;   Z=Text
"RTN","ORCXPND1",199,0)
 ;   SP=Text Sent
"RTN","ORCXPND1",200,0)
 ;   CCNT=Line Position After Input Text
"RTN","ORCXPND1",201,0)
 I '$D(Z) Q ""
"RTN","ORCXPND1",202,0)
 N SP S SP=Z I X,Y,X>Y S SP=$E("                                                                             ",1,X-Y)_Z
"RTN","ORCXPND1",203,0)
 S CCNT=$$INC(CCNT,SP)
"RTN","ORCXPND1",204,0)
 Q SP
"RTN","ORCXPND1",205,0)
INC(X,Y) ; Character Position Count
"RTN","ORCXPND1",206,0)
 ;   X=Current Count
"RTN","ORCXPND1",207,0)
 ;   Y=Text
"RTN","ORCXPND1",208,0)
 N INC S INC=X+$L(Y)
"RTN","ORCXPND1",209,0)
 Q INC
"RTN","ORCXPND3")
0^192^B44348323
"RTN","ORCXPND3",1,0)
ORCXPND3 ; SLC/MKB,dcm - Expanded display of Reports ;2/21/01  14:07
"RTN","ORCXPND3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**25,30,43,85,172,243**;Dec 17, 1997;Build 242
"RTN","ORCXPND3",3,0)
 ;
"RTN","ORCXPND3",4,0)
AP ; -- Retrieve AP results for a specific date/time specimen taken
"RTN","ORCXPND3",5,0)
 ; [alert follow-up, from LABS^ORCXPND1]
"RTN","ORCXPND3",6,0)
 N ORACCNO,ORDTSTKN S ORACCNO=$P(ID,"-"),ORDTSTKN=$P(ID,"-",2)
"RTN","ORCXPND3",7,0)
 I (ORACCNO["CY"!(ORACCNO["SP")!(ORACCNO["EM")!(ORACCNO["AU"))&($L(ORACCNO)>0) D  ;check for valid accession #
"RTN","ORCXPND3",8,0)
 . N ORLRDFN,ORLRSS S ORLRDFN=$$LRDFN^LR7OR1(DFN),ORLRSS=$P($G(XQADATA),U) ;DBIA/ICR #2503
"RTN","ORCXPND3",9,0)
 . K ^TMP("ORAP",$J) D EN^LR7OSAP4("^TMP(""ORAP"",$J)",ORLRDFN,ORLRSS,ORDTSTKN)
"RTN","ORCXPND3",10,0)
 . I '$O(^TMP("ORAP",$J,0)) S ^TMP("ORAP",$J,1,0)="",^TMP("ORAP",$J,2,0)="No Anatomic Pathology report available..."
"RTN","ORCXPND3",11,0)
 . N I S I=0 F  S I=$O(^TMP("ORAP",$J,I)) Q:I<1  S X=^(I,0),LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X
"RTN","ORCXPND3",12,0)
 . K ^TMP("ORAP",$J)
"RTN","ORCXPND3",13,0)
 Q
"RTN","ORCXPND3",14,0)
 ;
"RTN","ORCXPND3",15,0)
LRA ; -- Anatomic Pathology Report
"RTN","ORCXPND3",16,0)
 N DFN,Y,I,LRLLOC,LRQ
"RTN","ORCXPND3",17,0)
 D TIT^ORCXPNDR("Anatomic Path Report") Q:$$OS^ORCXPNDR()
"RTN","ORCXPND3",18,0)
 D PREP^ORCXPNDR
"RTN","ORCXPND3",19,0)
 D RPT^ORWRP(.Y,ID,3)
"RTN","ORCXPND3",20,0)
 D ITEM^ORCXPND("Anatomic Path Report")
"RTN","ORCXPND3",21,0)
 S I=3 F  S I=$O(^TMP("ORDATA",$J,1,I)) Q:I<1  S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=^TMP("ORDATA",$J,1,I)
"RTN","ORCXPND3",22,0)
 K ^TMP("ORDATA",$J)
"RTN","ORCXPND3",23,0)
 Q
"RTN","ORCXPND3",24,0)
 ;
"RTN","ORCXPND3",25,0)
LRAA ; -- Alternate Anatomic Path Report
"RTN","ORCXPND3",26,0)
 N DFN,Y,I,LRLLOC,LRQ
"RTN","ORCXPND3",27,0)
 D TIT^ORCXPNDR("Alternate Anatomic Path Report") Q:$$OS^ORCXPNDR()
"RTN","ORCXPND3",28,0)
 D PREP^ORCXPNDR I $$OS^ORCXPNDR() Q
"RTN","ORCXPND3",29,0)
 D AP^LR7OSUM(ID)
"RTN","ORCXPND3",30,0)
 D ITEM^ORCXPND("Anatomic Pathology Report")
"RTN","ORCXPND3",31,0)
 I '$O(^TMP("LRC",$J,0)) S ^TMP("LRC",$J,1,0)="No Anatomic Pathology reports available..."
"RTN","ORCXPND3",32,0)
 S I=0 F  S I=$O(^TMP("LRC",$J,I)) Q:I<1  S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=^TMP("LRC",$J,I,0)
"RTN","ORCXPND3",33,0)
 K ^TMP("LRC",$J)
"RTN","ORCXPND3",34,0)
 Q
"RTN","ORCXPND3",35,0)
 ;
"RTN","ORCXPND3",36,0)
LRB1 ; -- Blood Bank Report
"RTN","ORCXPND3",37,0)
 N DFN,Y,I,LRBLOOD,LRCAPA,LRDT0,LRLABKY,LRLLOC,LRO,LRPCEVSO,LRPLASMA,LRSERUM,LRT,LRUNKNOW,LRURINE,LRVIDO,LRVIDOF
"RTN","ORCXPND3",38,0)
 D TIT^ORCXPNDR("Blood Bank Report") Q:$$OS^ORCXPNDR()
"RTN","ORCXPND3",39,0)
 D PREP^ORCXPNDR
"RTN","ORCXPND3",40,0)
 D RPT^ORWRP(.Y,ID,2)
"RTN","ORCXPND3",41,0)
 D ITEM^ORCXPND("Blood Bank Report")
"RTN","ORCXPND3",42,0)
 S I=5 F  S I=$O(^TMP("ORDATA",$J,1,I)) Q:I<1  S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=^TMP("ORDATA",$J,1,I)
"RTN","ORCXPND3",43,0)
 K ^TMP("ORDATA",$J)
"RTN","ORCXPND3",44,0)
 Q
"RTN","ORCXPND3",45,0)
 ;
"RTN","ORCXPND3",46,0)
LRB ; -- A better Blood Bank Report
"RTN","ORCXPND3",47,0)
 N DFN,ORY,I,SUBHEAD
"RTN","ORCXPND3",48,0)
 D TIT^ORCXPNDR("Blood Bank Report")
"RTN","ORCXPND3",49,0)
 S DFN=ID
"RTN","ORCXPND3",50,0)
 D PREP^ORCXPNDR
"RTN","ORCXPND3",51,0)
 I $$GET^XPAR("DIV^SYS^PKG","OR VBECS ON",1,"Q"),$L($T(EN^ORWLR1)),$L($T(CPRS^VBECA3B)) D  Q  ;Transition to VBEC's interface
"RTN","ORCXPND3",52,0)
 . K ^TMP("ORLRC",$J)
"RTN","ORCXPND3",53,0)
 . D EN^ORWLR1(DFN)
"RTN","ORCXPND3",54,0)
 . I '$O(^TMP("ORLRC",$J,0)) S ^TMP("ORLRC",$J,1,0)="",^TMP("ORLRC",$J,2,0)="No Blood Bank report available..."
"RTN","ORCXPND3",55,0)
 . D ITEM^ORCXPND("Blood Bank Report"),BLANK^ORCXPND
"RTN","ORCXPND3",56,0)
 . S I=0 F  S I=$O(^TMP("ORLRC",$J,I)) Q:I'>0  S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=^TMP("ORLRC",$J,I,0)
"RTN","ORCXPND3",57,0)
 . K ^TMP("ORLRC",$J)
"RTN","ORCXPND3",58,0)
 S SUBHEAD("BLOOD BANK")=""
"RTN","ORCXPND3",59,0)
 D EN^LR7OSUM(.ORY,DFN,,,,,.SUBHEAD)
"RTN","ORCXPND3",60,0)
 I '$O(^TMP("LRC",$J,0)) S ^TMP("LRC",$J,1,0)="No Blood Bank report available..."
"RTN","ORCXPND3",61,0)
 D ITEM^ORCXPND("Blood Bank Report"),BLANK^ORCXPND
"RTN","ORCXPND3",62,0)
 S I=0 F  S I=$O(^TMP("LRC",$J,I)) Q:I'>0  S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=^TMP("LRC",$J,I,0)
"RTN","ORCXPND3",63,0)
 K ^TMP("LRC",$J),^TMP("LRH",$J)
"RTN","ORCXPND3",64,0)
 Q
"RTN","ORCXPND3",65,0)
 ;
"RTN","ORCXPND3",66,0)
LRC ; -- Lab Cumulative
"RTN","ORCXPND3",67,0)
 N DFN,ORY,I,BEG,END,OREND,ORSSTRT,ORSSTOP
"RTN","ORCXPND3",68,0)
 D TIT^ORCXPNDR("Lab Cumulative")
"RTN","ORCXPND3",69,0)
 S DFN=ID
"RTN","ORCXPND3",70,0)
 D RANGE($S($G(ORWARD):7,1:180)) Q:OREND  S BEG=+ORSSTRT,END=+ORSSTOP
"RTN","ORCXPND3",71,0)
 D PREP^ORCXPNDR
"RTN","ORCXPND3",72,0)
 D EN^LR7OSUM(.ORY,DFN,BEG,END)
"RTN","ORCXPND3",73,0)
 D ITEM^ORCXPND("Lab Cumulative"),BLANK^ORCXPND
"RTN","ORCXPND3",74,0)
 S I=0 F  S I=$O(^TMP("LRC",$J,I)) Q:I'>0  S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=^TMP("LRC",$J,I,0)
"RTN","ORCXPND3",75,0)
 K ^TMP("LRC",$J),^TMP("LRH",$J)
"RTN","ORCXPND3",76,0)
 Q
"RTN","ORCXPND3",77,0)
 ;
"RTN","ORCXPND3",78,0)
LRG ; -- Graph Lab Tests
"RTN","ORCXPND3",79,0)
 N DFN,Y,I,X,BCNT,LRSS,LRCW,LRFLAG,LRCTRL,LRNSET,N,LOW,LRPCEVSO,LRPRAC,LRRB,LRTREA,LRVIDO,LRVIDOF,OREND,ORSSTRT,ORSSTOP
"RTN","ORCXPND3",80,0)
 D TIT^ORCXPNDR("Graph Lab Tests") Q:$$OS^ORCXPNDR()
"RTN","ORCXPND3",81,0)
 D RANGE($S($G(ORWARD):7,1:180)) Q:OREND
"RTN","ORCXPND3",82,0)
 S LRSS="CH",LRCW=8,LRFLAG="",LRCTRL=0,(LRNSET,N)=80
"RTN","ORCXPND3",83,0)
 D L2^LRDIST4 Q:'$D(LRTEST)
"RTN","ORCXPND3",84,0)
 D PREP^ORCXPNDR
"RTN","ORCXPND3",85,0)
 D RPT^ORWRP(.Y,ID,8,,,,+ORSSTRT,+ORSSTOP)
"RTN","ORCXPND3",86,0)
 D ITEM^ORCXPND("Lab Graph")
"RTN","ORCXPND3",87,0)
 S I=4,BCNT=0
"RTN","ORCXPND3",88,0)
 F  S I=$O(^TMP("ORDATA",$J,1,I)) Q:I<1  S X=^(I) D
"RTN","ORCXPND3",89,0)
 . I '$L(X) S BCNT=BCNT+1 I BCNT>1 Q
"RTN","ORCXPND3",90,0)
 . S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X S:$L(X) BCNT=0
"RTN","ORCXPND3",91,0)
 K ^TMP("ORDATA",$J)
"RTN","ORCXPND3",92,0)
 Q
"RTN","ORCXPND3",93,0)
 ;
"RTN","ORCXPND3",94,0)
LRI ; -- Interim Lab Results
"RTN","ORCXPND3",95,0)
 N ORX,DFN,Y,I,X,BCNT,LREDT,LRIDT,LRLLT,LRPCEVSO,LRPRAC,LRRB,LRTREA,LRVIDO,LRVIDOF,OREND,ORSSTRT,ORSSTOP
"RTN","ORCXPND3",96,0)
 D TIT^ORCXPNDR("Lab Interim Results") Q:$$OS^ORCXPNDR()
"RTN","ORCXPND3",97,0)
 D RANGE($S($G(ORWARD):7,1:180)) Q:OREND
"RTN","ORCXPND3",98,0)
 D SET^LRRP4
"RTN","ORCXPND3",99,0)
 D PREP^ORCXPNDR
"RTN","ORCXPND3",100,0)
 D RPT^ORWRP(.Y,ID,3,,,,+ORSSTRT,+ORSSTOP)
"RTN","ORCXPND3",101,0)
 D ITEM^ORCXPND("Lab Interim Report")
"RTN","ORCXPND3",102,0)
 S I=0,BCNT=0
"RTN","ORCXPND3",103,0)
 F  S I=$O(^TMP("ORDATA",$J,1,I)) Q:I<1  S X=^(I) D
"RTN","ORCXPND3",104,0)
 . I '$L(X) S BCNT=BCNT+1 I BCNT>1 Q
"RTN","ORCXPND3",105,0)
 . S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X S:$L(X) BCNT=0
"RTN","ORCXPND3",106,0)
 K ^TMP("ORDATA",$J)
"RTN","ORCXPND3",107,0)
 Q
"RTN","ORCXPND3",108,0)
 ;
"RTN","ORCXPND3",109,0)
LRGEN ;Lab Results by Test
"RTN","ORCXPND3",110,0)
 N DFN,Y,I,II,X,BCNT,LRPRETTY,LREDT,LRLLT,LRPCEVSO,LRPRAC,LRRB,LRTREA,LRVIDO,LRVIDOF,LRCW,LREND,LRTP,LRIX,LRWPL,LRIDT,LRSC,DIC,LRTSTS,LRORD,LRTEST,LRSUB,LRHDR,LRSSP,LRHI,LRLO
"RTN","ORCXPND3",111,0)
 N LBL,LRBLOOD,LRDAT,LRDFN,LRDPF,LRDT0,LREX,LRFFLG,LRFOOT,LRLAB,LRLABKY,LRND,LRNG,LRNOP,LRNOTE,LRODT0,LRONESPC,LRONETST,LRPAGE,LRPARAM,LRPLASMA,LRPP,LRSERUM,LRPS,LRTN,LRUNKNOW,LRURINE,LRWRD,LRX,LRY
"RTN","ORCXPND3",112,0)
 N AGE,I,INC,LRIDT1,LRSV,OREND,ORSSTRT,ORSSTOP
"RTN","ORCXPND3",113,0)
 K ^TMP("LR",$J)
"RTN","ORCXPND3",114,0)
 D TIT^ORCXPNDR("Lab Results by Test") Q:$$OS^ORCXPNDR()
"RTN","ORCXPND3",115,0)
 D RANGE($S($G(ORWARD):7,1:180)) Q:OREND
"RTN","ORCXPND3",116,0)
 D SET^LRGEN
"RTN","ORCXPND3",117,0)
 Q:LREND!'LRTSTS
"RTN","ORCXPND3",118,0)
 D PREP^ORCXPNDR
"RTN","ORCXPND3",119,0)
 D RPT^ORWRP(.Y,ID,16,,,,+ORSSTRT,+ORSSTOP)
"RTN","ORCXPND3",120,0)
 D ITEM^ORCXPND("Lab Results by Test")
"RTN","ORCXPND3",121,0)
 S I=1,BCNT=0
"RTN","ORCXPND3",122,0)
 F  S I=$O(^TMP("ORDATA",$J,1,I)) Q:I<1  S X=^(I) D
"RTN","ORCXPND3",123,0)
 . I '$L(X) S BCNT=BCNT+1 I BCNT>1 Q
"RTN","ORCXPND3",124,0)
 . S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X S:$L(X) BCNT=0
"RTN","ORCXPND3",125,0)
 K ^TMP("ORDATA",$J)
"RTN","ORCXPND3",126,0)
 Q
"RTN","ORCXPND3",127,0)
 ;
"RTN","ORCXPND3",128,0)
STAT ; -- Lab test status
"RTN","ORCXPND3",129,0)
 N DFN,Y,I,X,BCNT,OREND,ORSSTRT,ORSSTOP
"RTN","ORCXPND3",130,0)
 D TIT^ORCXPNDR("Lab Test Status") Q:$$OS^ORCXPNDR()
"RTN","ORCXPND3",131,0)
 D RANGE($S($G(ORWARD):7,1:180)) Q:$G(OREND)
"RTN","ORCXPND3",132,0)
 D PREP^ORCXPNDR
"RTN","ORCXPND3",133,0)
 D RPT^ORWRP(.Y,ID,9,,,,+ORSSTRT,+ORSSTOP)
"RTN","ORCXPND3",134,0)
 D ITEM^ORCXPND("Lab Test Status")
"RTN","ORCXPND3",135,0)
 S I=0,BCNT=0
"RTN","ORCXPND3",136,0)
 F  S I=$O(^TMP("ORDATA",$J,1,I)) Q:I<1  S X=$S($D(^(I))#2:^(I),$D(^(I,0))#2:^(0),1:"") D
"RTN","ORCXPND3",137,0)
 . I '$L(X) S BCNT=BCNT+1 I BCNT>1 Q
"RTN","ORCXPND3",138,0)
 . S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X S:$L(X) BCNT=0
"RTN","ORCXPND3",139,0)
 K ^TMP("ORDATA",$J)
"RTN","ORCXPND3",140,0)
 Q
"RTN","ORCXPND3",141,0)
 ;
"RTN","ORCXPND3",142,0)
RANGE(BEG) ;Get date range for report
"RTN","ORCXPND3",143,0)
 ;BEG=# of days (T-BEG) for start default
"RTN","ORCXPND3",144,0)
 ;Output: ORSSTRT=Start date/time
"RTN","ORCXPND3",145,0)
 ;        ORSSTOP=Stop date/time
"RTN","ORCXPND3",146,0)
 ;        OREND=1 if user '^'s out, so look for it!
"RTN","ORCXPND3",147,0)
 S BEG=$$FMADD^XLFDT(DT,-$G(BEG)),END=$$NOW^XLFDT
"RTN","ORCXPND3",148,0)
 D RANGE^ORPRS01(BEG,END)
"RTN","ORCXPND3",149,0)
 Q
"RTN","ORCXPND3",150,0)
 ;
"RTN","ORCXPND3",151,0)
MED(MED) ; -- Medicine Summary of Patient Procedures
"RTN","ORCXPND3",152,0)
 N DFN,Y,I,X,BCNT,OREND,PROCID
"RTN","ORCXPND3",153,0)
 D TIT^ORCXPNDR("Summary of Patient Procedures") Q:$$OS^ORCXPNDR()
"RTN","ORCXPND3",154,0)
 D PREP^ORCXPNDR
"RTN","ORCXPND3",155,0)
 S DFN=+ID,PROCID=$P(MED,"~",2)
"RTN","ORCXPND3",156,0)
 D RPT^ORWRP(.Y,DFN,19,,,PROCID)
"RTN","ORCXPND3",157,0)
 D ITEM^ORCXPND("Summary of Patient Procedures")
"RTN","ORCXPND3",158,0)
 S I=4,BCNT=0
"RTN","ORCXPND3",159,0)
 F  S I=$O(^TMP("ORDATA",$J,1,I)) Q:I<1  S X=^(I) D
"RTN","ORCXPND3",160,0)
 . I '$L(X) S BCNT=BCNT+1 I BCNT>1 Q
"RTN","ORCXPND3",161,0)
 . I $E(X,1,4)="Pg. " Q
"RTN","ORCXPND3",162,0)
 . I X["PHYSICIANS' SIGNATURE" Q
"RTN","ORCXPND3",163,0)
 . S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X S:$L(X) BCNT=0
"RTN","ORCXPND3",164,0)
 K ^TMP("ORDATA",$J)
"RTN","ORCXPND3",165,0)
 Q
"RTN","ORDDPAPI")
0^23^B1521511
"RTN","ORDDPAPI",1,0)
ORDDPAPI ; SLC/AGP - Misc. Order Dialog functions; 04/11/2006
"RTN","ORDDPAPI",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORDDPAPI",3,0)
 ;
"RTN","ORDDPAPI",4,0)
ADMTIME(ORARRAY) ;
"RTN","ORDDPAPI",5,0)
 N ERR,I
"RTN","ORDDPAPI",6,0)
 D GETWP^XPAR(.X,"SYS","OR ADMIN TIME HELP TEXT",,.ERR)
"RTN","ORDDPAPI",7,0)
 S I=0  F  S I=$O(X(I)) Q:I'>0  S ORARRAY(I)=$G(X(I,0))
"RTN","ORDDPAPI",8,0)
 Q
"RTN","ORDDPAPI",9,0)
 ;
"RTN","ORDDPAPI",10,0)
LRD1() ;
"RTN","ORDDPAPI",11,0)
 N IEN
"RTN","ORDDPAPI",12,0)
 K ^TMP($J,"ORDDPAPI LRD1")
"RTN","ORDDPAPI",13,0)
 D ZERO^PSS51P1("","ONE TIME","LR",,"ORDDPAPI LRD1")
"RTN","ORDDPAPI",14,0)
 I $G(^TMP($J,"ORDDPAPI LRD1",0))'>0 Q ""
"RTN","ORDDPAPI",15,0)
 S IEN=$O(^TMP($J,"ORDDPAPI LRD1","B","ONE TIME",""))
"RTN","ORDDPAPI",16,0)
 K ^TMP($J,"ORDDPAPI LRD1")
"RTN","ORDDPAPI",17,0)
 Q IEN
"RTN","ORDDPAPI",18,0)
 ;
"RTN","ORDDPAPI",19,0)
LRD2(IEN) ;
"RTN","ORDDPAPI",20,0)
 N RESULT
"RTN","ORDDPAPI",21,0)
 K ^TMP($J,"ORDDPAPI LRD2")
"RTN","ORDDPAPI",22,0)
 D ZERO^PSS51P1(IEN,,,,"ORDDPAPI LRD2")
"RTN","ORDDPAPI",23,0)
 S RESULT=$P($G(^TMP($J,"ORDDPAPI LRD2",IEN,5)),U)
"RTN","ORDDPAPI",24,0)
 K ^TMP($J,"ORDDPAPI LRD2")
"RTN","ORDDPAPI",25,0)
 Q RESULT
"RTN","ORDDPAPI",26,0)
 ;
"RTN","ORDDPAPI",27,0)
CLOZMSG(ORARRAY) ;
"RTN","ORDDPAPI",28,0)
 N ERR,I
"RTN","ORDDPAPI",29,0)
 D GETWP^XPAR(.X,"SYS","OR CLOZ INPT MSG",,.ERR)
"RTN","ORDDPAPI",30,0)
 S I=0  F  S I=$O(X(I)) Q:I'>0  S ORARRAY(I)=$G(X(I,0))
"RTN","ORDDPAPI",31,0)
 Q
"RTN","ORDDPAPI",32,0)
 ;
"RTN","ORDV02A")
0^172^B11152192
"RTN","ORDV02A",1,0)
ORDV02A ; slc/dcm - OE/RR Report Extracts ; 10/8/03 11:18
"RTN","ORDV02A",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORDV02A",3,0)
 ;LAB Components
"RTN","ORDV02A",4,0)
EM(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT)      ;Electron Microscopy
"RTN","ORDV02A",5,0)
 ;External references to ^DPT(DFN,"LR"), ^ORDVX1,
"RTN","ORDV02A",6,0)
 ;
"RTN","ORDV02A",7,0)
 S OROMEGA=1,ORALPHA=9999999,ORMAX=9999
"RTN","ORDV02A",8,0)
 I $L($T(GCPR^OMGCOAS1)) D  ; Call if FHIE station 200
"RTN","ORDV02A",9,0)
 . N BEG,END
"RTN","ORDV02A",10,0)
 . Q:'$G(ORALPHA)  Q:'$G(OROMEGA)
"RTN","ORDV02A",11,0)
 . S ORMAX=$S(+$G(ORMAX)>0:ORMAX,1:999)
"RTN","ORDV02A",12,0)
 . S BEG=9999999-OROMEGA,END=9999999-ORALPHA
"RTN","ORDV02A",13,0)
 . D GCPR^OMGCOAS1(DFN,"EM",BEG,END,ORMAX)
"RTN","ORDV02A",14,0)
 D GET
"RTN","ORDV02A",15,0)
 Q
"RTN","ORDV02A",16,0)
CY(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT)      ;Cytology
"RTN","ORDV02A",17,0)
 ;External references to ^DPT(DFN,"LR"), ^ORDVX1,
"RTN","ORDV02A",18,0)
 ;
"RTN","ORDV02A",19,0)
 S OROMEGA=1,ORALPHA=9999999,ORMAX=9999
"RTN","ORDV02A",20,0)
 I $L($T(GCPR^OMGCOAS1)) D  ; Call if FHIE station 200
"RTN","ORDV02A",21,0)
 . N BEG,END
"RTN","ORDV02A",22,0)
 . Q:'$G(ORALPHA)  Q:'$G(OROMEGA)
"RTN","ORDV02A",23,0)
 . S ORMAX=$S(+$G(ORMAX)>0:ORMAX,1:999)
"RTN","ORDV02A",24,0)
 . S BEG=9999999-OROMEGA,END=9999999-ORALPHA
"RTN","ORDV02A",25,0)
 . D GCPR^OMGCOAS1(DFN,"CY",BEG,END,ORMAX)
"RTN","ORDV02A",26,0)
 D GET
"RTN","ORDV02A",27,0)
 Q
"RTN","ORDV02A",28,0)
SP(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT)      ;Surgical Pathology
"RTN","ORDV02A",29,0)
 ;External references to ^DPT(DFN,"LR"), ^ORDVX1,
"RTN","ORDV02A",30,0)
 ;
"RTN","ORDV02A",31,0)
 S OROMEGA=1,ORALPHA=9999999,ORMAX=9999
"RTN","ORDV02A",32,0)
 I $L($T(GCPR^OMGCOAS1)) D  ; Call if FHIE station 200
"RTN","ORDV02A",33,0)
 . N BEG,END
"RTN","ORDV02A",34,0)
 . Q:'$G(ORALPHA)  Q:'$G(OROMEGA)
"RTN","ORDV02A",35,0)
 . S ORMAX=$S(+$G(ORMAX)>0:ORMAX,1:999)
"RTN","ORDV02A",36,0)
 . S BEG=9999999-OROMEGA,END=9999999-ORALPHA
"RTN","ORDV02A",37,0)
 . D GCPR^OMGCOAS1(DFN,"SP",BEG,END,ORMAX)
"RTN","ORDV02A",38,0)
 D GET
"RTN","ORDV02A",39,0)
 Q
"RTN","ORDV02A",40,0)
 ;
"RTN","ORDV02A",41,0)
GET ;Get data
"RTN","ORDV02A",42,0)
 N ORDT,ORX0,ORCNT,GMI,LRDFN,IX,X,IX0,ORSITE,ORSS,SITE,GO
"RTN","ORDV02A",43,0)
 Q:'$L(OREXT)
"RTN","ORDV02A",44,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV02A",45,0)
 Q:'$L($T(@GO))
"RTN","ORDV02A",46,0)
 S LRDFN=+$G(^DPT(DFN,"LR"))
"RTN","ORDV02A",47,0)
 Q:'LRDFN
"RTN","ORDV02A",48,0)
 S ORMAX=$S(+$G(ORMAX)>0:ORMAX,1:999)
"RTN","ORDV02A",49,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV02A",50,0)
 K ^TMP("ORDATA",$J)
"RTN","ORDV02A",51,0)
 I '$L($T(GCPR^OMGCOAS1)) D
"RTN","ORDV02A",52,0)
 . K ^TMP("OROOT",$J)
"RTN","ORDV02A",53,0)
 . D @GO
"RTN","ORDV02A",54,0)
 S ORDT=OROMEGA,ORCNT=0
"RTN","ORDV02A",55,0)
 F  S ORDT=$O(^TMP("OROOT",$J,ORDT)) Q:(ORDT'>0)!(ORDT>ORALPHA)!(ORCNT>ORMAX)  D
"RTN","ORDV02A",56,0)
 . S ORSS="" F  S ORSS=$O(^TMP("OROOT",$J,ORDT,ORSS)) Q:ORSS=""!(ORCNT>ORMAX)  S ORX0=^(ORSS,0) D
"RTN","ORDV02A",57,0)
 .. S SITE=$S($L($G(^TMP("OROOT",$J,ORDT,ORSS,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV02A",58,0)
 .. S ^TMP("ORDATA",$J,ORDT_ORSS,"WP",1)="1^"_SITE ;Station ID
"RTN","ORDV02A",59,0)
 .. S ^TMP("ORDATA",$J,ORDT_ORSS,"WP",2)="2^"_$P(ORX0,U) ;collection date
"RTN","ORDV02A",60,0)
 .. S ^TMP("ORDATA",$J,ORDT_ORSS,"WP",4)="4^"_$P(ORX0,U,2) ;accession number
"RTN","ORDV02A",61,0)
 .. D SPMRG^ORDVU("^TMP(""OROOT"","_$J_","_ORDT_","_""""_ORSS_""""_",.1)","^TMP(""ORDATA"","_$J_","_""""_ORDT_ORSS_""""_",""WP"",3)",3) ;specimen
"RTN","ORDV02A",62,0)
 .. D SPMRG^ORDVU("^TMP(""OROOT"","_$J_","_ORDT_","_""""_ORSS_""""_",.2)","^TMP(""ORDATA"","_$J_","_""""_ORDT_ORSS_""""_",""WP"",5)",5) ;report text
"RTN","ORDV02A",63,0)
 .. S ^TMP("ORDATA",$J,ORDT_ORSS,"WP",6)="6^[+]",ORCNT=ORCNT+1 ;flag for detail
"RTN","ORDV02A",64,0)
 K ^TMP("OROOT",$J)
"RTN","ORDV02A",65,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV02A",66,0)
 Q
"RTN","ORDV03")
0^155^B47046777
"RTN","ORDV03",1,0)
ORDV03 ; slc/dcm - OE/RR Report Extracts ;10/8/03  11:17
"RTN","ORDV03",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**109,208,215,243**;Dec 17, 1997;Build 242
"RTN","ORDV03",3,0)
RI(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT)      ;Radiology impression
"RTN","ORDV03",4,0)
 ;External Calls: MAIN^GMTSRAE(1)
"RTN","ORDV03",5,0)
 ;
"RTN","ORDV03",6,0)
 ; ^TMP("GMTSRAD",$J) used via DBIA 4333
"RTN","ORDV03",7,0)
 ; ^TMP("RAE",$J) used via DBIA 3968
"RTN","ORDV03",8,0)
 N ORDT,ORX0,ORJ,ORCNT,GMDATA,GMTSI,GMW,MAX,TEST,GMTSNDM,GMTS1,GMTS2,ORSITE,SITE,GO
"RTN","ORDV03",9,0)
 Q:'$L(OREXT)
"RTN","ORDV03",10,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV03",11,0)
 Q:'$L($T(@GO))
"RTN","ORDV03",12,0)
 S IOST=$G(IOST),GMTSNDM=$S(+$G(ORMAX)>0:ORMAX,1:999),GMTS2=ORALPHA,GMTS1=OROMEGA
"RTN","ORDV03",13,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV03",14,0)
 K ^TMP("ORDATA",$J),^TMP("RAE",$J)  ;DBIA 3968
"RTN","ORDV03",15,0)
 D @GO
"RTN","ORDV03",16,0)
 S ORDT=GMTS1,ORCNT=0
"RTN","ORDV03",17,0)
 F  S ORDT=$O(^TMP("RAE",$J,ORDT)) Q:(ORDT'>0)!(ORDT>GMTS2)  D
"RTN","ORDV03",18,0)
 . S ORJ=0 F  S ORJ=$O(^TMP("RAE",$J,ORDT,ORJ)) Q:'ORJ  I $G(^(ORJ,0)) S ORX0=^(0) D
"RTN","ORDV03",19,0)
 .. S ORCNT=ORCNT+1
"RTN","ORDV03",20,0)
 .. S SITE=$S($L($G(^TMP("RAE",$J,ORDT,ORJ,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV03",21,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",1)="1^"_SITE ;Station ID
"RTN","ORDV03",22,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",2)="2^"_$$DATE^ORDVU($P(ORX0,U)) ;date
"RTN","ORDV03",23,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",3)="3^"_$P(ORX0,U,2) ;procedure
"RTN","ORDV03",24,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",4)="4^"_$P(ORX0,U,4) ;report status
"RTN","ORDV03",25,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",5)="5^"_$P(ORX0,U,7) ;cpt code
"RTN","ORDV03",26,0)
 .. D SPMRG^ORDVU($NA(^TMP("RAE",$J,ORDT,ORJ,"I")),$NA(^TMP("ORDATA",$J,ORCNT,"WP",6)),6) ;impression
"RTN","ORDV03",27,0)
 .. I $O(^TMP("RAE",$J,ORDT,ORJ,"I",0)) S ^TMP("ORDATA",$J,ORCNT,"WP",8)="8^[+]" ;flag for detail
"RTN","ORDV03",28,0)
 K ^TMP("RAE",$J)
"RTN","ORDV03",29,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV03",30,0)
 Q
"RTN","ORDV03",31,0)
RR(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT)        ;Radiology report
"RTN","ORDV03",32,0)
 ;External Calls: MAIN^GMTSRAE(2)
"RTN","ORDV03",33,0)
 I $L($T(GCPR^OMGCOAS1)) D  ; Call if FHIE station 200
"RTN","ORDV03",34,0)
 . N BEG,END,MAX
"RTN","ORDV03",35,0)
 . Q:'$G(ORALPHA)  Q:'$G(OROMEGA)
"RTN","ORDV03",36,0)
 . S MAX=$S(+$G(ORMAX)>0:ORMAX,1:999)
"RTN","ORDV03",37,0)
 . S BEG=9999999-OROMEGA,END=9999999-ORALPHA
"RTN","ORDV03",38,0)
 . D GCPR^OMGCOAS1(DFN,"RR",BEG,END,MAX)
"RTN","ORDV03",39,0)
 N ORDT,ORX0,ORJ,ORCNT,GMDATA,GMTSI,GMW,MAX,TEST,GMTSNDM,GMTS1,GMTS2,ORSITE,SITE,GO,ORMORE
"RTN","ORDV03",40,0)
 Q:'$L(OREXT)
"RTN","ORDV03",41,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV03",42,0)
 Q:'$L($T(@GO))
"RTN","ORDV03",43,0)
 K ^TMP("ORDATA",$J)
"RTN","ORDV03",44,0)
 S GMTSNDM=$S(+$G(ORMAX)>0:ORMAX,1:999),GMTS1=OROMEGA,GMTS2=ORALPHA
"RTN","ORDV03",45,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV03",46,0)
 I '$L($T(GCPR^OMGCOAS1)) D
"RTN","ORDV03",47,0)
 . K ^TMP("RAE",$J)
"RTN","ORDV03",48,0)
 . D @GO
"RTN","ORDV03",49,0)
 S ORDT=GMTS1,ORCNT=0
"RTN","ORDV03",50,0)
 F  S ORDT=$O(^TMP("RAE",$J,ORDT)) Q:(ORDT'>0)  D
"RTN","ORDV03",51,0)
 . S ORJ=0 F  S ORJ=$O(^TMP("RAE",$J,ORDT,ORJ)) Q:'ORJ  D
"RTN","ORDV03",52,0)
 .. S ORCNT=ORCNT+1,ORMORE=0
"RTN","ORDV03",53,0)
 .. S ORX0=$G(^TMP("RAE",$J,ORDT,ORJ,0))
"RTN","ORDV03",54,0)
 .. S SITE=$S($L($G(^TMP("RAE",$J,ORDT,ORJ,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV03",55,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",1)="1^"_SITE ;Site ID
"RTN","ORDV03",56,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",2)="2^"_$$DATE^ORDVU($P(ORX0,U)) ;date
"RTN","ORDV03",57,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",3)="3^"_$P(ORX0,U,2) ;procedure
"RTN","ORDV03",58,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",4)="4^"_$S($L($P(ORX0,U,4)):$P(ORX0,U,4),1:"No Report") ;report status
"RTN","ORDV03",59,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",5)="5^"_$P(ORX0,U,7) ;cpt code
"RTN","ORDV03",60,0)
 .. I $O(^TMP("RAE",$J,ORDT,ORJ,"S",0)) S ORMORE=1 D SPMRG^ORDVU($NA(^TMP("RAE",$J,ORDT,ORJ,"S")),$NA(^TMP("ORDATA",$J,ORCNT,"WP",6,1)),6) ;reason for study
"RTN","ORDV03",61,0)
 .. I $O(^TMP("RAE",$J,ORDT,ORJ,"H",0)) S ORMORE=1 D SPMRG^ORDVU($NA(^TMP("RAE",$J,ORDT,ORJ,"H")),$NA(^TMP("ORDATA",$J,ORCNT,"WP",7,1)),7) ;clinical history
"RTN","ORDV03",62,0)
 .. I $O(^TMP("RAE",$J,ORDT,ORJ,"I",0)) S ORMORE=1 D SPMRG^ORDVU($NA(^TMP("RAE",$J,ORDT,ORJ,"I")),$NA(^TMP("ORDATA",$J,ORCNT,"WP",8,1)),8) ;impression
"RTN","ORDV03",63,0)
 .. I $O(^TMP("RAE",$J,ORDT,ORJ,"R",0)) S ORMORE=1 D SPMRG^ORDVU($NA(^TMP("RAE",$J,ORDT,ORJ,"R")),$NA(^TMP("ORDATA",$J,ORCNT,"WP",9,1)),9) ;report
"RTN","ORDV03",64,0)
 .. I ORMORE S ^TMP("ORDATA",$J,ORCNT,"WP",10)="10^[+]" ;flag for detail
"RTN","ORDV03",65,0)
 K ^TMP("RAE",$J)
"RTN","ORDV03",66,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV03",67,0)
 Q
"RTN","ORDV03",68,0)
RRDOD(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT)        ;Radiology report
"RTN","ORDV03",69,0)
 ;External Calls: MAIN^GMTSRAE(2)
"RTN","ORDV03",70,0)
 ;
"RTN","ORDV03",71,0)
 I $L($T(GCPR^OMGCOAS1)) D  ; Call if FHIE station 200
"RTN","ORDV03",72,0)
 . N BEG,END,MAX
"RTN","ORDV03",73,0)
 . Q:'$G(ORALPHA)  Q:'$G(OROMEGA)
"RTN","ORDV03",74,0)
 . S MAX=$S(+$G(ORMAX)>0:ORMAX,1:999)
"RTN","ORDV03",75,0)
 . S BEG=9999999-OROMEGA,END=9999999-ORALPHA
"RTN","ORDV03",76,0)
 . D GCPR^OMGCOAS1(DFN,"RR",BEG,END,MAX)
"RTN","ORDV03",77,0)
 ;
"RTN","ORDV03",78,0)
 N ORDT,ORX0,ORJ,ORCNT,GMDATA,GMTSI,GMW,MAX,TEST,GMTSNDM,GMTS1,GMTS2,ORSITE,SITE,GO,ORMORE
"RTN","ORDV03",79,0)
 Q:'$L(OREXT)
"RTN","ORDV03",80,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV03",81,0)
 Q:'$L($T(@GO))
"RTN","ORDV03",82,0)
 K ^TMP("ORDATA",$J)
"RTN","ORDV03",83,0)
 S GMTSNDM=$S(+$G(ORMAX)>0:ORMAX,1:999),GMTS1=OROMEGA,GMTS2=ORALPHA
"RTN","ORDV03",84,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV03",85,0)
 I '$L($T(GCPR^OMGCOAS1)) D
"RTN","ORDV03",86,0)
 . K ^TMP("RAE",$J)
"RTN","ORDV03",87,0)
 . D @GO
"RTN","ORDV03",88,0)
 S ORDT=GMTS1,ORCNT=0
"RTN","ORDV03",89,0)
 F  S ORDT=$O(^TMP("RAE",$J,ORDT)) Q:(ORDT'>0)  D
"RTN","ORDV03",90,0)
 . S ORJ=0 F  S ORJ=$O(^TMP("RAE",$J,ORDT,ORJ)) Q:'ORJ  D
"RTN","ORDV03",91,0)
 .. S ORCNT=ORCNT+1,ORMORE=0
"RTN","ORDV03",92,0)
 .. S ORX0=$G(^TMP("RAE",$J,ORDT,ORJ,0))
"RTN","ORDV03",93,0)
 .. S SITE=$S($L($G(^TMP("RAE",$J,ORDT,ORJ,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV03",94,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",1)="1^"_SITE ;Site ID
"RTN","ORDV03",95,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",2)="2^"_$$DATE^ORDVU($P(ORX0,U)) ;date
"RTN","ORDV03",96,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",3)="3^"_$P(ORX0,U,2) ;procedure
"RTN","ORDV03",97,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",4)="4^"_$S($L($P(ORX0,U,4)):$P(ORX0,U,4),1:"No Report") ;report status
"RTN","ORDV03",98,0)
 .. S ^TMP("ORDATA",$J,ORCNT,"WP",5)="5^"_$P(ORX0,U,7) ;cpt code
"RTN","ORDV03",99,0)
 .. I $O(^TMP("RAE",$J,ORDT,ORJ,"H",0)) S ORMORE=1 D SPMRG^ORDVU($NA(^TMP("RAE",$J,ORDT,ORJ,"H")),$NA(^TMP("ORDATA",$J,ORCNT,"WP",6,1)),6) ;clinical history
"RTN","ORDV03",100,0)
 .. I $O(^TMP("RAE",$J,ORDT,ORJ,"I",0)) S ORMORE=1 D SPMRG^ORDVU($NA(^TMP("RAE",$J,ORDT,ORJ,"I")),$NA(^TMP("ORDATA",$J,ORCNT,"WP",7,1)),7) ;impression
"RTN","ORDV03",101,0)
 .. I $O(^TMP("RAE",$J,ORDT,ORJ,"R",0)) S ORMORE=1 D SPMRG^ORDVU($NA(^TMP("RAE",$J,ORDT,ORJ,"R")),$NA(^TMP("ORDATA",$J,ORCNT,"WP",8,1)),8) ;report
"RTN","ORDV03",102,0)
 .. I ORMORE S ^TMP("ORDATA",$J,ORCNT,"WP",9)="9^[+]" ;flag for detail
"RTN","ORDV03",103,0)
 K ^TMP("RAE",$J)
"RTN","ORDV03",104,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV03",105,0)
 Q
"RTN","ORDV03",106,0)
RS(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;Radiology status
"RTN","ORDV03",107,0)
 ;External calls: GET^GMTSRAD
"RTN","ORDV03",108,0)
 N ORSITE,SITE,CNT,ORDT,ORDA,ORDA2,REC,GMTSEND,GMTSBEG,GO,STAT
"RTN","ORDV03",109,0)
 Q:'$L(OREXT)
"RTN","ORDV03",110,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV03",111,0)
 Q:'$L($T(@GO))
"RTN","ORDV03",112,0)
 S GMTSBEG=ORDBEG,GMTSEND=ORDEND
"RTN","ORDV03",113,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV03",114,0)
 K ^TMP("GMTSRAD",$J)  ;DBIA 4333
"RTN","ORDV03",115,0)
 D @GO
"RTN","ORDV03",116,0)
 S CNT=0,ORDT=OROMEGA
"RTN","ORDV03",117,0)
 F  S ORDT=$O(^TMP("GMTSRAD",$J,ORDT)) Q:(ORDT'>0)!(ORDT>ORALPHA)!(CNT'<ORMAX)  D
"RTN","ORDV03",118,0)
 .S ORDA=0
"RTN","ORDV03",119,0)
 .F  S ORDA=$O(^TMP("GMTSRAD",$J,ORDT,ORDA)) Q:'ORDA!(CNT'<ORMAX)  D
"RTN","ORDV03",120,0)
 ..S ORDA2=0
"RTN","ORDV03",121,0)
 ..F  S ORDA2=$O(^TMP("GMTSRAD",$J,ORDT,ORDA,ORDA2)) Q:'ORDA2!(CNT'<ORMAX)  S REC=^(ORDA2),STAT=$P(REC,"^",2) D
"RTN","ORDV03",122,0)
 ...S CNT=CNT+1
"RTN","ORDV03",123,0)
 ...S SITE=$S($L($G(^TMP("GMTSRAD",$J,ORDT,ORDA,ORDA2,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV03",124,0)
 ...S ^TMP("ORDATA",$J,ORDT,"WP",1)="1^"_SITE
"RTN","ORDV03",125,0)
 ...S ^TMP("ORDATA",$J,ORDT,"WP",2)="2^"_$$DATE^ORDVU($P(REC,"^"))
"RTN","ORDV03",126,0)
 ...S ^TMP("ORDATA",$J,ORDT,"WP",3)="3^"_$S(STAT="d":"Discontinued",STAT="c":"Complete",STAT="h":"Hold",STAT="p":"Pending",STAT="a":"Active",STAT="s":"Scheduled",STAT="u":"Unreleased",1:STAT)
"RTN","ORDV03",127,0)
 ...S ^TMP("ORDATA",$J,ORDT,"WP",4)="4^"_$P(REC,"^",3)
"RTN","ORDV03",128,0)
 ...S ^TMP("ORDATA",$J,ORDT,"WP",5)="5^"_$$DATE^ORDVU($P(REC,"^",4))
"RTN","ORDV03",129,0)
 ...S ^TMP("ORDATA",$J,ORDT,"WP",6)="6^"_$P(REC,"^",5)
"RTN","ORDV03",130,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV03",131,0)
 Q
"RTN","ORDV03",132,0)
RAD1 ;Get radiology impression
"RTN","ORDV03",133,0)
 D MAIN^GMTSRAE(1)
"RTN","ORDV03",134,0)
 Q
"RTN","ORDV03",135,0)
RAD2 ;Get radiology report
"RTN","ORDV03",136,0)
 D MAIN^GMTSRAE(2)
"RTN","ORDV03",137,0)
 Q
"RTN","ORDV04")
0^150^B57992153
"RTN","ORDV04",1,0)
ORDV04 ; SLC/DAN/dcm - OE/RR ;7/21/04  15:32
"RTN","ORDV04",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**109,148,160,208,195,241,215,274,256,243**;Dec 17,1997;Build 242
"RTN","ORDV04",3,0)
 ;OE/RR COMPONENT
"RTN","ORDV04",4,0)
 ;
"RTN","ORDV04",5,0)
 ; ^TMP("GMPLHS",$J) DBIA 1183
"RTN","ORDV04",6,0)
 ; ^UTILITY & ^TMP("GMRVD") DBIA 10061
"RTN","ORDV04",7,0)
 ; 
"RTN","ORDV04",8,0)
ORC(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ; Current Orders
"RTN","ORDV04",9,0)
 ;Calls EN^ORQ1, ^OR(100
"RTN","ORDV04",10,0)
 N ORCNT,ORJ,ORSITE,SITE,ORX0,ORLIST,GO
"RTN","ORDV04",11,0)
 Q:'$L(OREXT)
"RTN","ORDV04",12,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV04",13,0)
 Q:'$L($T(@GO))
"RTN","ORDV04",14,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV04",15,0)
 K ^TMP("ORR",$J),^TMP("ORDATA",$J)
"RTN","ORDV04",16,0)
 D @GO
"RTN","ORDV04",17,0)
 I '$D(^TMP("ORR",$J)) Q
"RTN","ORDV04",18,0)
 S ORCNT=0,ORJ=0
"RTN","ORDV04",19,0)
 F  S ORJ=$O(^TMP("ORR",$J,ORLIST,ORJ)) Q:'+ORJ!(ORCNT'<ORMAX)  S ORX0=^(ORJ) D
"RTN","ORDV04",20,0)
 . S ORCNT=ORCNT+1,SITE=$S($L($G(^TMP("ORR",$J,ORLIST,ORJ,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV04",21,0)
 . S ^TMP("ORDATA",$J,ORLIST,ORJ,"WP",1)="1^"_SITE ;Station ID
"RTN","ORDV04",22,0)
 . D SPMRG^ORDVU("^TMP(""ORR"","_$J_","""_ORLIST_""","_ORJ_",""TX"")","^TMP(""ORDATA"","_$J_","""_ORLIST_""","_ORJ_",""WP"",2)",2) ;order text
"RTN","ORDV04",23,0)
 . S ^TMP("ORDATA",$J,ORLIST,ORJ,"WP",3)="3^"_$P(ORX0,"^",6) ; status
"RTN","ORDV04",24,0)
 . S ^TMP("ORDATA",$J,ORLIST,ORJ,"WP",4)="4^"_$$DATE^ORDVU($P(ORX0,"^",4)) ;start date
"RTN","ORDV04",25,0)
 . S ^TMP("ORDATA",$J,ORLIST,ORJ,"WP",5)="5^"_$$DATE^ORDVU($P(ORX0,"^",5)) ;stop date
"RTN","ORDV04",26,0)
 . S ^TMP("ORDATA",$J,ORLIST,ORJ,"WP",7)="7^"_$P(^TMP("ORR",$J,ORLIST,ORJ),U) ;Order Number
"RTN","ORDV04",27,0)
 . I $O(^TMP("ORR",$J,ORLIST,ORJ,"TX",1)) S ^TMP("ORDATA",$J,ORLIST,ORJ,"WP",6)="6^[+]" ;flag for details
"RTN","ORDV04",28,0)
 K ^TMP("ORR",$J)
"RTN","ORDV04",29,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV04",30,0)
 Q
"RTN","ORDV04",31,0)
ORCVA ;Current Orders
"RTN","ORDV04",32,0)
 N ORVP
"RTN","ORDV04",33,0)
 S ORVP=DFN_";DPT("
"RTN","ORDV04",34,0)
 I '$D(^OR(100,"AC",ORVP)) Q
"RTN","ORDV04",35,0)
 D EN^ORQ1(ORVP,,2,,ORDBEG,ORDEND,1) ;get current orders. ORLIST is set in ORQ1
"RTN","ORDV04",36,0)
 Q
"RTN","ORDV04",37,0)
PLAILALL(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;Problem list API returns ALL problems
"RTN","ORDV04",38,0)
 N GO
"RTN","ORDV04",39,0)
 Q:'$L(OREXT)
"RTN","ORDV04",40,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV04",41,0)
 Q:'$L($T(@GO))
"RTN","ORDV04",42,0)
 D PLAIL
"RTN","ORDV04",43,0)
 Q
"RTN","ORDV04",44,0)
PLALL ;All Problems
"RTN","ORDV04",45,0)
 D GETLIST^GMPLHS(DFN,"ALL")
"RTN","ORDV04",46,0)
 Q
"RTN","ORDV04",47,0)
PLAILI(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;Problem list API returns INACTIVE problems
"RTN","ORDV04",48,0)
 N GO
"RTN","ORDV04",49,0)
 Q:'$L(OREXT)
"RTN","ORDV04",50,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV04",51,0)
 Q:'$L($T(@GO))
"RTN","ORDV04",52,0)
 D PLAIL
"RTN","ORDV04",53,0)
 Q
"RTN","ORDV04",54,0)
PLI ;Inactive Problems
"RTN","ORDV04",55,0)
 D GETLIST^GMPLHS(DFN,"I")
"RTN","ORDV04",56,0)
 Q
"RTN","ORDV04",57,0)
PLAILA(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;Problem list API returns ACTIVE problems
"RTN","ORDV04",58,0)
 N GO
"RTN","ORDV04",59,0)
 Q:'$L(OREXT)
"RTN","ORDV04",60,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV04",61,0)
 Q:'$L($T(@GO))
"RTN","ORDV04",62,0)
 D PLAIL
"RTN","ORDV04",63,0)
 Q
"RTN","ORDV04",64,0)
PLA ;Active Problems
"RTN","ORDV04",65,0)
 D GETLIST^GMPLHS(DFN,"A")
"RTN","ORDV04",66,0)
 Q
"RTN","ORDV04",67,0)
PLAIL ;problems(active, inactive or all)
"RTN","ORDV04",68,0)
 ;External calls to ^GMPLHS
"RTN","ORDV04",69,0)
 ; input:
"RTN","ORDV04",70,0)
 ;   STATUS = "A"   active problems
"RTN","ORDV04",71,0)
 ;   STATUS = "I"   inactive problems
"RTN","ORDV04",72,0)
 ;   STATUS = "ALL" all problems
"RTN","ORDV04",73,0)
 ;
"RTN","ORDV04",74,0)
 I $L($T(GCPR^OMGCOAS1)) D  Q  ; Call if FHIE station 200
"RTN","ORDV04",75,0)
 . S ORDBEG=0,ORDEND=9999999,ORMAX=99999
"RTN","ORDV04",76,0)
 . D GCPR^OMGCOAS1(DFN,"PLL",ORDBEG,ORDEND,ORMAX)
"RTN","ORDV04",77,0)
 . S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV04",78,0)
 N ORPROBNO,ORXREC0,ORLOC,I,K,X,ORSITE,SITE,ORMORE
"RTN","ORDV04",79,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV04",80,0)
 K ^TMP("ORDATA",$J),^TMP("GMPLHS",$J)  ;DBIA #1183
"RTN","ORDV04",81,0)
 D @GO
"RTN","ORDV04",82,0)
 I '$D(^TMP("GMPLHS",$J)) Q
"RTN","ORDV04",83,0)
 S ORPROBNO=0
"RTN","ORDV04",84,0)
 F I=1:1 S ORPROBNO=$O(^TMP("GMPLHS",$J,ORPROBNO)) Q:'ORPROBNO  D
"RTN","ORDV04",85,0)
 . S ORXREC0=$G(^TMP("GMPLHS",$J,ORPROBNO,0)),ORMORE=0
"RTN","ORDV04",86,0)
 . S SITE=$S($L($G(^TMP("GMPLHS",$J,ORPROBNO,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV04",87,0)
 . S ^TMP("ORDATA",$J,ORPROBNO,"WP",1)="1^"_SITE ;Station ID
"RTN","ORDV04",88,0)
 . S ^TMP("ORDATA",$J,ORPROBNO,"WP",2)="2^"_$P(ORXREC0,U,5) ;status
"RTN","ORDV04",89,0)
 . S ^TMP("ORDATA",$J,ORPROBNO,"WP",3)="3^"_$G(^TMP("GMPLHS",$J,ORPROBNO,"N")) ;provider narrative
"RTN","ORDV04",90,0)
 . S ^TMP("ORDATA",$J,ORPROBNO,"WP",4)="4^"_$$DATE^ORDVU($P(ORXREC0,U,6)) ;onset date
"RTN","ORDV04",91,0)
 . S ^TMP("ORDATA",$J,ORPROBNO,"WP",5)="5^"_$$DATE^ORDVU($P(ORXREC0,U,2)) ;last modified date
"RTN","ORDV04",92,0)
 . S ^TMP("ORDATA",$J,ORPROBNO,"WP",6)="6^"_$P(ORXREC0,U,7) ;provider
"RTN","ORDV04",93,0)
 . S ORLOC=0,K=0
"RTN","ORDV04",94,0)
 . F  S ORLOC=$O(^TMP("GMPLHS",$J,ORPROBNO,"C",ORLOC)) Q:'ORLOC  D
"RTN","ORDV04",95,0)
 .. S X=0
"RTN","ORDV04",96,0)
 .. F  S X=$O(^TMP("GMPLHS",$J,ORPROBNO,"C",ORLOC,X)) Q:'X  D
"RTN","ORDV04",97,0)
 ... S K=K+1,ORMORE=1
"RTN","ORDV04",98,0)
 ... S ^TMP("ORDATA",$J,ORPROBNO,"WP",7,K)="7^"_$P($G(^TMP("GMPLHS",$J,ORPROBNO,"C",ORLOC,X,0)),U) ;note narrative
"RTN","ORDV04",99,0)
 . S ^TMP("ORDATA",$J,ORPROBNO,"WP",8)="8^"_$P(ORXREC0,U,14) ;exposures
"RTN","ORDV04",100,0)
 . I ORMORE S ^TMP("ORDATA",$J,ORPROBNO,"WP",9)="9^[+]" ;flag for details
"RTN","ORDV04",101,0)
 K ^TMP("GMPLHS",$J)
"RTN","ORDV04",102,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV04",103,0)
 Q
"RTN","ORDV04",104,0)
SR(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;Surgery Report
"RTN","ORDV04",105,0)
 ;Call ^ORDV04A
"RTN","ORDV04",106,0)
 N ORCNT
"RTN","ORDV04",107,0)
 S ORCNT=0
"RTN","ORDV04",108,0)
 K ^TMP("ORDATA",$J)
"RTN","ORDV04",109,0)
 D ENSR^ORDV04A
"RTN","ORDV04",110,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV04",111,0)
 Q
"RTN","ORDV04",112,0)
VS(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ; get vital Signs
"RTN","ORDV04",113,0)
 D VS^ORDV04A
"RTN","ORDV04",114,0)
 Q
"RTN","ORDV04",115,0)
TIUPRG(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;  TIU version of progress reports
"RTN","ORDV04",116,0)
 ;Calls to TIUSRVLO,TIUSRVR1,VASITE
"RTN","ORDV04",117,0)
 I $L($T(GCPR^OMGCOAS1)) D  Q  ; Call if FHIE station 200
"RTN","ORDV04",118,0)
 . D GCPR^OMGCOAS1(DFN,"PN",ORDBEG,ORDEND,ORMAX)
"RTN","ORDV04",119,0)
 . S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV04",120,0)
 N ORDT,DATE,ORCI,ORGLOB,ORGLOBA,ORTEMP,ORSITE,SITE,I,ORNODE,GO,ORIMAG
"RTN","ORDV04",121,0)
 Q:'$L(OREXT)
"RTN","ORDV04",122,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV04",123,0)
 Q:'$L($T(@GO))
"RTN","ORDV04",124,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV04",125,0)
 D @GO
"RTN","ORDV04",126,0)
 I '$D(@ORGLOB) Q
"RTN","ORDV04",127,0)
 S ORNODE=0,ORCI=0
"RTN","ORDV04",128,0)
 K ^TMP("ORDATA",$J)
"RTN","ORDV04",129,0)
 F  S ORNODE=$O(@ORGLOB@(ORNODE)) Q:'ORNODE!(ORCI'<ORMAX)  D
"RTN","ORDV04",130,0)
 . S ORTEMP=@ORGLOB@(ORNODE)
"RTN","ORDV04",131,0)
 . S ORIMAG=$P($$RESOLVE^TIUSRVLO($P(ORTEMP,U)),U,10)
"RTN","ORDV04",132,0)
 . S DATE=$P(ORTEMP,U,3)       ;date
"RTN","ORDV04",133,0)
 . S SITE=$S($L($G(@ORGLOB@(ORNODE,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV04",134,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",1)="1^"_SITE ;Station ID
"RTN","ORDV04",135,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",2)="2^"_$P(ORTEMP,U) ;TIU ien
"RTN","ORDV04",136,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",3)="3^"_$$DATE^ORDVU(DATE) ;date
"RTN","ORDV04",137,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",4)="4^"_$P(ORTEMP,U,2) ;type
"RTN","ORDV04",138,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",5)="5^"_$P($P(ORTEMP,U,5),";",2) ;author
"RTN","ORDV04",139,0)
 . S ORCI=ORCI+1
"RTN","ORDV04",140,0)
 . D TGET^TIUSRVR1(.ORGLOBA,$P(ORTEMP,U)) ;Call back to get note text
"RTN","ORDV04",141,0)
 . D SPMRG^ORDVU($NA(@ORGLOBA),$NA(^TMP("ORDATA",$J,ORNODE,"WP",6)),6) ;Notes Text
"RTN","ORDV04",142,0)
 . I $O(@ORGLOBA@(0)) S ^TMP("ORDATA",$J,ORNODE,"WP",7)="7^[+]"
"RTN","ORDV04",143,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",8)="8^"_ORIMAG
"RTN","ORDV04",144,0)
 . K @ORGLOBA
"RTN","ORDV04",145,0)
 K @ORGLOB
"RTN","ORDV04",146,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV04",147,0)
 Q
"RTN","ORDV04",148,0)
TPRG ;TIU Progress Notes
"RTN","ORDV04",149,0)
 D CONTEXT^TIUSRVLO(.ORGLOB,3,5,DFN,ORDBEG,ORDEND,,ORMAX)
"RTN","ORDV04",150,0)
 Q
"RTN","ORDV04",151,0)
TIUDCS(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;  Discharge Summaries
"RTN","ORDV04",152,0)
 ;Calls VASITE, DIQ1, TIUSRVLO
"RTN","ORDV04",153,0)
 I $L($T(GCPR^OMGCOAS1)) D  Q  ; Call if FHIE station 200
"RTN","ORDV04",154,0)
 . D GCPR^OMGCOAS1(DFN,"DS",ORDBEG,ORDEND,ORMAX)
"RTN","ORDV04",155,0)
 . S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV04",156,0)
 N ORGLOB,ORGLOBA,ORI,ORNODE,ORICDIEN,ORARRAY,ORTEMP,ORSITE,SITE,DIC,DR,DIQ,DA,GO
"RTN","ORDV04",157,0)
 Q:'$L(OREXT)
"RTN","ORDV04",158,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV04",159,0)
 Q:'$L($T(@GO))
"RTN","ORDV04",160,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV04",161,0)
 D @GO
"RTN","ORDV04",162,0)
 I '$D(@ORGLOB) Q
"RTN","ORDV04",163,0)
 K ^TMP("ORDATA",$J)
"RTN","ORDV04",164,0)
 S ORNODE=0,ORI=0
"RTN","ORDV04",165,0)
 F  S ORNODE=$O(@ORGLOB@(ORNODE)) Q:'ORNODE!(ORI'<ORMAX)  D
"RTN","ORDV04",166,0)
 . S ORTEMP=@ORGLOB@(ORNODE)
"RTN","ORDV04",167,0)
 . S SITE=$S($L($G(@ORGLOB@(ORNODE,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV04",168,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",1)="1^"_SITE ;Station ID
"RTN","ORDV04",169,0)
 . K ORARRAY S DIC=8925,DA=$P(ORTEMP,U),DR=".05;.07;.08;1202;1502",DIQ="ORARRAY"
"RTN","ORDV04",170,0)
 . D EN^DIQ1
"RTN","ORDV04",171,0)
 . S DIQ="ORARRAY(8925,"_DA_")"
"RTN","ORDV04",172,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",2)="2^"_$$DATEMMM^ORDVU($G(@DIQ@(.07))) ;episode begin date/time
"RTN","ORDV04",173,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",3)="3^"_$$DATEMMM^ORDVU($G(@DIQ@(.08))) ;episode end date/time
"RTN","ORDV04",174,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",4)="4^"_$G(@DIQ@(1202)) ;author/dicator
"RTN","ORDV04",175,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",5)="5^"_$G(@DIQ@(1502)) ;signed by
"RTN","ORDV04",176,0)
 . S ^TMP("ORDATA",$J,ORNODE,"WP",6)="6^"_$G(@DIQ@(.05)) ;status
"RTN","ORDV04",177,0)
 . S ORI=ORI+1
"RTN","ORDV04",178,0)
 . D TGET^TIUSRVR1(.ORGLOBA,$P(ORTEMP,U)) ;Call to get summary text
"RTN","ORDV04",179,0)
 . D SPMRG^ORDVU($NA(@ORGLOBA),$NA(^TMP("ORDATA",$J,ORNODE,"WP",7)),7) ;summary Text
"RTN","ORDV04",180,0)
 . I $O(@ORGLOBA@(0)) S ^TMP("ORDATA",$J,ORNODE,"WP",8)="8^[+]" ;detail flag
"RTN","ORDV04",181,0)
 . K @ORGLOBA
"RTN","ORDV04",182,0)
 K @ORGLOB
"RTN","ORDV04",183,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV04",184,0)
 Q
"RTN","ORDV04",185,0)
TDCS ;TIU Discharge Summary
"RTN","ORDV04",186,0)
 D CONTEXT^TIUSRVLO(.ORGLOB,244,5,DFN,ORDBEG,ORDEND,,ORMAX)
"RTN","ORDV04",187,0)
 Q
"RTN","ORDV04A")
0^153^B41731567
"RTN","ORDV04A",1,0)
ORDV04A ; SLC/DAN/dcm - OE/RR ;7/30/01  14:33
"RTN","ORDV04A",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**109,243**;Dec 17,1997;Build 242
"RTN","ORDV04A",3,0)
 ;
"RTN","ORDV04A",4,0)
 Q
"RTN","ORDV04A",5,0)
ENSR ; Entry point for component
"RTN","ORDV04A",6,0)
 ;External calls to ^GMTSROB, ^DIQ, ^GMTSORC, ^DIWP
"RTN","ORDV04A",7,0)
 ;External references to ^SRF, ^DD, ^ICPT
"RTN","ORDV04A",8,0)
 N GMIDT,GMN,SURG
"RTN","ORDV04A",9,0)
 I '$D(^SRF("B",DFN)) Q
"RTN","ORDV04A",10,0)
 S GMN=0 F  S GMN=$O(^SRF("B",DFN,GMN)) Q:GMN'>0  D SORT
"RTN","ORDV04A",11,0)
 I '$D(SURG) Q
"RTN","ORDV04A",12,0)
 S GMIDT=0 F  S GMIDT=$O(SURG(GMIDT)) Q:GMIDT'>0!(ORCNT'<ORMAX)  S GMN=SURG(GMIDT) D EXTRCT
"RTN","ORDV04A",13,0)
 Q
"RTN","ORDV04A",14,0)
 ;
"RTN","ORDV04A",15,0)
SORT ; Sort surgeries by inverted date
"RTN","ORDV04A",16,0)
 N GMDT
"RTN","ORDV04A",17,0)
 S GMDT=$P(^SRF(GMN,0),U,9) I GMDT>ORDBEG&(GMDT<ORDEND) D
"RTN","ORDV04A",18,0)
 . F  Q:'$D(SURG(9999999-GMDT))  S GMDT=GMDT+.0001
"RTN","ORDV04A",19,0)
 . S SURG(9999999-GMDT)=GMN
"RTN","ORDV04A",20,0)
 Q
"RTN","ORDV04A",21,0)
EXTRCT ; Extract surgical case record
"RTN","ORDV04A",22,0)
 N X,GMI,GMDT,OPPRC,POSDX,PREDX,SPEC,STATUS,SURGEON,VER
"RTN","ORDV04A",23,0)
 N DCTDTM,TRSDTM,Y,C,DIWL,DIWF,ORSITE,ORMORE,SITE
"RTN","ORDV04A",24,0)
 S ORCNT=ORCNT+1,ORMORE=0
"RTN","ORDV04A",25,0)
 S GMDT=$$DATE^ORDVU($P(^SRF(GMN,0),U,9))
"RTN","ORDV04A",26,0)
 D STATUS^GMTSROB S:'$D(STATUS) STATUS="UNKNOWN"
"RTN","ORDV04A",27,0)
 S X=$P(^SRF(GMN,0),U,4) I X>0 S Y=X,C=$P(^DD(130,.04,0),U,2) D Y^DIQ S SPEC=Y K Y
"RTN","ORDV04A",28,0)
 I $D(^SRF(GMN,.1)) S X=$P(^SRF(GMN,.1),U,4) I X>0 S Y=X,C=$P(^DD(130,.14,0),U,2) D Y^DIQ S SURGEON=Y K Y
"RTN","ORDV04A",29,0)
 S VER=$S($G(^SRF(GMN,"VER"))'="Y":"(Unverified)",1:"")
"RTN","ORDV04A",30,0)
 S PREDX(0)=$S($G(^SRF(GMN,33))]"":$P(^(33),U),1:"") S GMI=0 F  S GMI=$O(^SRF(GMN,14,GMI)) Q:GMI'>0  S PREDX(GMI)=$P(^SRF(GMN,14,GMI,0),U)
"RTN","ORDV04A",31,0)
 S POSDX(0)=$S($G(^SRF(GMN,34))]"":$P(^(34),U),1:"") S GMI=0 F  S GMI=$O(^SRF(GMN,15,GMI)) Q:GMI'>0  S POSDX(GMI)=$P(^SRF(GMN,15,GMI,0),U)
"RTN","ORDV04A",32,0)
 S OPPRC(0)=$P($G(^SRF(GMN,"OP")),U,1,2) S:$P(OPPRC(0),U,2)]"" $P(OPPRC(0),U,2)=$P($$CPT^ICPTCOD($P($G(^SRF(GMN,"OP")),U,2)),U,3) D
"RTN","ORDV04A",33,0)
 . S GMI=0 F  S GMI=$O(^SRF(GMN,13,GMI)) Q:GMI'>0  S OPPRC(GMI)=$P($G(^SRF(GMN,13,GMI,0)),U)_U_$G(^SRF(GMN,13,GMI,2)) S:$P(OPPRC(GMI),U,2)]"" $P(OPPRC(GMI),U,2)=$P($$CPT^ICPTCOD($P($G(^SRF(GMN,13,GMI,2)),U)),U,3)
"RTN","ORDV04A",34,0)
 S X=$P($G(^SRF(GMN,31)),U,6) S:X>0 DCTDTM=$$DATE^ORDVU(X)
"RTN","ORDV04A",35,0)
 S X=$P($G(^SRF(GMN,31)),U,7) S:X>0 TRSDTM=$$DATE^ORDVU(X)
"RTN","ORDV04A",36,0)
 S DIWL=0,DIWF="N",ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV04A",37,0)
 K ^UTILITY($J,"W")
"RTN","ORDV04A",38,0)
 I $D(^SRF(GMN,12)) F GMI=1:1:$P(^SRF(GMN,12,0),U,4) S X=^SRF(GMN,12,GMI,0) D ^DIWP
"RTN","ORDV04A",39,0)
 S SITE=ORSITE
"RTN","ORDV04A",40,0)
 S ^TMP("ORDATA",$J,GMIDT,"WP",1)="1^"_SITE ;Station ID
"RTN","ORDV04A",41,0)
 S ^TMP("ORDATA",$J,GMIDT,"WP",2)="2^"_GMDT ; date
"RTN","ORDV04A",42,0)
 ;
"RTN","ORDV04A",43,0)
 ; Operative Procedure(s)
"RTN","ORDV04A",44,0)
 S GMI="" F  S GMI=$O(OPPRC(GMI)) Q:GMI=""  D  S:GMI ORMORE=1
"RTN","ORDV04A",45,0)
 . S ^TMP("ORDATA",$J,GMIDT,"WP",3,GMI)="3^"_$P(OPPRC(GMI),U)_$S($P(OPPRC(GMI),U,2)]"":" - "_$P(OPPRC(GMI),U,2),1:"")
"RTN","ORDV04A",46,0)
 ;
"RTN","ORDV04A",47,0)
 S ^TMP("ORDATA",$J,GMIDT,"WP",4)="4^"_$G(SPEC) ;surgical specialty
"RTN","ORDV04A",48,0)
 ;
"RTN","ORDV04A",49,0)
 S ^TMP("ORDATA",$J,GMIDT,"WP",5)="5^"_$G(SURGEON) ; surgeon
"RTN","ORDV04A",50,0)
 S ^TMP("ORDATA",$J,GMIDT,"WP",6)="6^"_$G(STATUS) ; op status
"RTN","ORDV04A",51,0)
 ;
"RTN","ORDV04A",52,0)
 ; Pre-operative diagnosis
"RTN","ORDV04A",53,0)
 S GMI="" F  S GMI=$O(PREDX(GMI)) Q:GMI=""  D  S:GMI ORMORE=1
"RTN","ORDV04A",54,0)
 . S ^TMP("ORDATA",$J,GMIDT,"WP",7,GMI)="7^"_PREDX(GMI)
"RTN","ORDV04A",55,0)
 ;
"RTN","ORDV04A",56,0)
 ; Post-operative diagnosis
"RTN","ORDV04A",57,0)
 S GMI="" F  S GMI=$O(POSDX(GMI)) Q:GMI=""  D  S:GMI ORMORE=1
"RTN","ORDV04A",58,0)
 . S ^TMP("ORDATA",$J,GMIDT,"WP",8,GMI)="8^"_POSDX(GMI)
"RTN","ORDV04A",59,0)
 ;
"RTN","ORDV04A",60,0)
 ; Lab work? Y/N
"RTN","ORDV04A",61,0)
 S ^TMP("ORDATA",$J,GMIDT,"WP",9)="9^"_$S($O(^SRF(GMN,9,0)):"Yes",1:"No")
"RTN","ORDV04A",62,0)
 S ^TMP("ORDATA",$J,GMIDT,"WP",10)="10^"_$G(DCTDTM) ; dictation time
"RTN","ORDV04A",63,0)
 S ^TMP("ORDATA",$J,GMIDT,"WP",11)="11^"_$G(TRSDTM) ; transcription time
"RTN","ORDV04A",64,0)
 ;
"RTN","ORDV04A",65,0)
 ; surgeon's dictation
"RTN","ORDV04A",66,0)
 I $D(^UTILITY($J,"W")) D  S ORMORE=1
"RTN","ORDV04A",67,0)
 . K ^TMP("ORHSSRT",$J)
"RTN","ORDV04A",68,0)
 . F GMI=1:1:^UTILITY($J,"W",DIWL) D
"RTN","ORDV04A",69,0)
 .. S ^TMP("ORHSSRT",$J,GMIDT,"WP",GMI)=^UTILITY($J,"W",DIWL,GMI,0)
"RTN","ORDV04A",70,0)
 . D SPMRG^ORDVU($NA(^TMP("ORHSSRT",$J,GMIDT,"WP")),$NA(^TMP("ORDATA",$J,GMIDT,"WP",12)),12)
"RTN","ORDV04A",71,0)
 . K ^UTILITY($J,"W")
"RTN","ORDV04A",72,0)
 . K ^TMP("ORHSSRT",$J)
"RTN","ORDV04A",73,0)
 I ORMORE S ^TMP("ORDATA",$J,GMIDT,"WP",13)="13^[+]" ;flag for detail
"RTN","ORDV04A",74,0)
 Q
"RTN","ORDV04A",75,0)
VS ;Continuation of Vitals Extract (from ORDV04)
"RTN","ORDV04A",76,0)
 ;Calls GMRVUT0
"RTN","ORDV04A",77,0)
 I $L($T(GCPR^OMGCOAS1)) D  Q  ; OMGCOAS1 routine only on Station 200
"RTN","ORDV04A",78,0)
 . D GCPR^OMGCOAS1(DFN,"VIT",ORDBEG,ORDEND,ORMAX)
"RTN","ORDV04A",79,0)
 . S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV04A",80,0)
 N ORDT,I,TYPE,IEN,GMRVSTR,ORSITE,SITE,PLACE,GO,X,QUALIF,NODE,UNITS,UCNT,QCNT,ORI
"RTN","ORDV04A",81,0)
 Q:'$L(OREXT)
"RTN","ORDV04A",82,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV04A",83,0)
 Q:'$L($T(@GO))
"RTN","ORDV04A",84,0)
 K ^UTILITY($J,"GMRVD"),^TMP("ORDATA",$J)
"RTN","ORDV04A",85,0)
 S GMRVSTR="T;P;R;BP;HT;WT;PN;PO2;CVP;CG",GMRVSTR(0)=ORDBEG_"^"_ORDEND_"^"_ORMAX_"^"_1
"RTN","ORDV04A",86,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV04A",87,0)
 D @GO
"RTN","ORDV04A",88,0)
 S ORDT=0
"RTN","ORDV04A",89,0)
 F I=1:1 S ORDT=$O(^UTILITY($J,"GMRVD",ORDT)) Q:'+ORDT!(I>ORMAX)  D  ;DBIA 4791
"RTN","ORDV04A",90,0)
 . S SITE=$S($L($G(^TMP("GMRVD",$J,ORDT,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV04A",91,0)
 . S ^TMP("ORDATA",$J,"WP",ORDT,1)="1^"_SITE
"RTN","ORDV04A",92,0)
 . S ^TMP("ORDATA",$J,"WP",ORDT,2)="2^"_$$DATE^ORDVU(9999999-ORDT) ;date vitals taken
"RTN","ORDV04A",93,0)
 . K UNITS,QUALIF
"RTN","ORDV04A",94,0)
 . S TYPE="",(UCNT,QCNT)=1,UNITS(UCNT)="",QUALIF(QCNT)="",QUALIF=""
"RTN","ORDV04A",95,0)
 . F  S TYPE=$O(^UTILITY($J,"GMRVD",ORDT,TYPE)) Q:TYPE=""  D
"RTN","ORDV04A",96,0)
 .. S IEN=$O(^UTILITY($J,"GMRVD",ORDT,TYPE,0)) Q:'IEN  S NODE=$G(^(IEN))
"RTN","ORDV04A",97,0)
 .. S PLACE=$S(TYPE="T":3,TYPE="P":4,TYPE="R":5,TYPE="BP":6,TYPE="HT":7,TYPE="WT":8,TYPE="PN":9,TYPE="PO2":10,TYPE="CVP":11,TYPE="CG":12,1:0)
"RTN","ORDV04A",98,0)
 .. I PLACE S ^TMP("ORDATA",$J,"WP",ORDT,PLACE)=PLACE_"^"_$P(NODE,"^",8) ;Get value of vitals from global
"RTN","ORDV04A",99,0)
 .. S X=$$UNITMAP(TYPE) S:$L(UNITS(UCNT))>60 UCNT=UCNT+1,UNITS(UCNT)="" S UNITS(UCNT)=$S($L(UNITS(UCNT)):UNITS(UCNT)_","_$$MAP(TYPE)_":",1:$$MAP(TYPE)_":")_X ;Units
"RTN","ORDV04A",100,0)
 .. I TYPE="PO2" D
"RTN","ORDV04A",101,0)
 ... I $L($P(NODE,"^",15)) S ^TMP("ORDATA",$J,"WP",ORDT,13)=13_"^"_$P($G(^UTILITY($J,"GMRVD",ORDT,TYPE,IEN)),"^",15) ; Flow Rate
"RTN","ORDV04A",102,0)
 ... I $L($P(NODE,"^",16)) S ^TMP("ORDATA",$J,"WP",ORDT,14)=14_"^"_$P($G(^UTILITY($J,"GMRVD",ORDT,TYPE,IEN)),"^",16) ; O2 Concentration
"RTN","ORDV04A",103,0)
 .. I $L($P(NODE,"^",17)) S X=$P(NODE,"^",17)  D
"RTN","ORDV04A",104,0)
 ... I QUALIF'[($$MAP(TYPE)_":"_X) D
"RTN","ORDV04A",105,0)
 .... S QUALIF=$S($L(QUALIF):QUALIF_" , "_$$MAP(TYPE)_":",1:$$MAP(TYPE)_":")_X ; Qualifier
"RTN","ORDV04A",106,0)
 .... S:$L(QUALIF(QCNT))>60 QCNT=QCNT+1,QUALIF(QCNT)=""
"RTN","ORDV04A",107,0)
 .... S QUALIF(QCNT)=$S($L(QUALIF(QCNT)):QUALIF(QCNT)_" , "_$$MAP(TYPE)_":",1:$$MAP(TYPE)_":")_X ; Qualifier
"RTN","ORDV04A",108,0)
 .. I TYPE="WT",$L($P(NODE,"^",14)) D
"RTN","ORDV04A",109,0)
 ... S ^TMP("ORDATA",$J,"WP",ORDT,16)=16_"^"_$P(NODE,"^",14) ; BMI
"RTN","ORDV04A",110,0)
 . I $O(QUALIF(0)) D
"RTN","ORDV04A",111,0)
 .. S ORI=0 F  S ORI=$O(QUALIF(ORI)) Q:'ORI  D
"RTN","ORDV04A",112,0)
 ... S ^TMP("ORDATA",$J,"WP",ORDT,15,ORI)="15^"_QUALIF(ORI)
"RTN","ORDV04A",113,0)
 . I $O(UNITS(0)) D
"RTN","ORDV04A",114,0)
 .. S ORI=0 F  S ORI=$O(UNITS(ORI)) Q:'ORI  D
"RTN","ORDV04A",115,0)
 ... S ^TMP("ORDATA",$J,"WP",ORDT,17,ORI)="17^"_UNITS(ORI)
"RTN","ORDV04A",116,0)
 K ^UTILITY($J,"GMRVD")
"RTN","ORDV04A",117,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV04A",118,0)
 Q
"RTN","ORDV04A",119,0)
MAP(TEXT) ;Map test code to abbreviation
"RTN","ORDV04A",120,0)
 Q:'$L($G(TEXT)) ""
"RTN","ORDV04A",121,0)
 I TEXT="T" Q "TEMP"
"RTN","ORDV04A",122,0)
 I TEXT="P" Q "PULSE"
"RTN","ORDV04A",123,0)
 I TEXT="R" Q "RESP"
"RTN","ORDV04A",124,0)
 I TEXT="BP" Q "BP"
"RTN","ORDV04A",125,0)
 I TEXT="HT" Q "HT"
"RTN","ORDV04A",126,0)
 I TEXT="WT" Q "WT"
"RTN","ORDV04A",127,0)
 I TEXT="PN" Q "PAIN"
"RTN","ORDV04A",128,0)
 I TEXT="PO2" Q "POx"
"RTN","ORDV04A",129,0)
 I TEXT="CVP" Q "CVP"
"RTN","ORDV04A",130,0)
 I TEXT="CG" Q "C/G"
"RTN","ORDV04A",131,0)
 Q TEXT
"RTN","ORDV04A",132,0)
UNITMAP(TEXT) ;Map units to abbreviation
"RTN","ORDV04A",133,0)
 Q:'$L($G(TEXT)) ""
"RTN","ORDV04A",134,0)
 I TEXT="T" Q "F"
"RTN","ORDV04A",135,0)
 I TEXT="P" Q "/min"
"RTN","ORDV04A",136,0)
 I TEXT="R" Q " /min"
"RTN","ORDV04A",137,0)
 I TEXT="BP" Q "mmHg"
"RTN","ORDV04A",138,0)
 I TEXT="HT" Q "in"
"RTN","ORDV04A",139,0)
 I TEXT="WT" Q "lb"
"RTN","ORDV04A",140,0)
 I TEXT="PN" Q ""
"RTN","ORDV04A",141,0)
 I TEXT="PO2" Q "%SpO2"
"RTN","ORDV04A",142,0)
 I TEXT="CVP" Q "cmH2O"
"RTN","ORDV04A",143,0)
 I TEXT="CG" Q " in"
"RTN","ORDV04A",144,0)
 Q ""
"RTN","ORDV06")
0^176^B40307303
"RTN","ORDV06",1,0)
ORDV06 ; slc/dkm - OE/RR Report Extracts ;10/8/03  11:17
"RTN","ORDV06",2,0)
 ;;3.0;ORDER ENTRY RESULTS REPORTING;**109,118,167,208,215,274,243**;Dec 17, 1997;Build 242
"RTN","ORDV06",3,0)
 ;Pharmacy Extracts
"RTN","ORDV06",4,0)
RXA(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;Active Outpatient Pharmacy
"RTN","ORDV06",5,0)
 ;Call to PSOHCSUM
"RTN","ORDV06",6,0)
 ;
"RTN","ORDV06",7,0)
 I $L($T(GCPR^OMGCOAS1)) D  ; Call if FHIE station 200
"RTN","ORDV06",8,0)
 . N BEG,END,MAX
"RTN","ORDV06",9,0)
 . S BEG=0,END=9999999,MAX=9999
"RTN","ORDV06",10,0)
 . D GCPR^OMGCOAS1(DFN,"RXA",BEG,END,MAX)
"RTN","ORDV06",11,0)
 ;
"RTN","ORDV06",12,0)
 N ORRXSTAT,GO,PSOACT
"RTN","ORDV06",13,0)
 Q:'$L(OREXT)
"RTN","ORDV06",14,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV06",15,0)
 Q:'$L($T(@GO))
"RTN","ORDV06",16,0)
 S PSOACT=1,ORRXSTAT="^ACTIVE^ACTIVE/SUSP^"
"RTN","ORDV06",17,0)
 D GET
"RTN","ORDV06",18,0)
 Q
"RTN","ORDV06",19,0)
RXOP(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;All Outpatient Pharmacy
"RTN","ORDV06",20,0)
 ;Call to PSOHCSUM
"RTN","ORDV06",21,0)
 ;
"RTN","ORDV06",22,0)
 I $L($T(GCPR^OMGCOAS1)) D  ; Call if FHIE station 200
"RTN","ORDV06",23,0)
 . N BEG,END,MAX
"RTN","ORDV06",24,0)
 . S BEG=0,END=9999999,MAX=9999
"RTN","ORDV06",25,0)
 . D GCPR^OMGCOAS1(DFN,"RXOP",BEG,END,MAX)
"RTN","ORDV06",26,0)
 ;
"RTN","ORDV06",27,0)
 N ORRXSTAT,GO
"RTN","ORDV06",28,0)
 Q:'$L(OREXT)
"RTN","ORDV06",29,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV06",30,0)
 Q:'$L($T(@GO))
"RTN","ORDV06",31,0)
 S ORRXSTAT=""
"RTN","ORDV06",32,0)
 D GET
"RTN","ORDV06",33,0)
 Q
"RTN","ORDV06",34,0)
GET N J,ORDT,ORI,ORDRGIEN,ORDRG,ORRXNO,ORSTAT,ORQTY,OREXP,ORISSUE,ORLAST,ORREF,ORPRVD,ORCOST,ORSIG
"RTN","ORDV06",35,0)
 N ECD,GMR,GMW,IX,PSOBEGIN,GMTSNDM,GMTS1,GMTS2,ORSITE,SITE
"RTN","ORDV06",36,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV06",37,0)
 S PSOBEGIN=0
"RTN","ORDV06",38,0)
 K ^TMP("ORDATA",$J)
"RTN","ORDV06",39,0)
 I '$L($T(GCPR^OMGCOAS1)) D
"RTN","ORDV06",40,0)
 . K ^TMP("PSOO",$J)
"RTN","ORDV06",41,0)
 . D @GO
"RTN","ORDV06",42,0)
 S (ORDT,ORI)=0
"RTN","ORDV06",43,0)
 F  S ORDT=$O(^TMP("PSOO",$J,ORDT)) Q:(ORDT'>0)  S ORX0=$G(^(ORDT,0)) I ORX0'="" D
"RTN","ORDV06",44,0)
 . I $L(ORRXSTAT),ORRXSTAT'[(U_$P($P(ORX0,U,5),";",2)) Q  ;Check status
"RTN","ORDV06",45,0)
 . S ORI=ORI+1
"RTN","ORDV06",46,0)
 . S SITE=$S($L($G(^TMP("PSOO",$J,ORDT,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV06",47,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",1)="1^"_SITE ;Station ID
"RTN","ORDV06",48,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",2)="2^"_$P($P(ORX0,U,3),";",2) ;Drug Name
"RTN","ORDV06",49,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",3)="3^"_$P($P(ORX0,U,3),";") ;Drug IEN
"RTN","ORDV06",50,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",4)="4^"_$P(ORX0,U,6) ;RX #
"RTN","ORDV06",51,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",5)="5^"_$P($P(ORX0,U,5),";",2) ;Status
"RTN","ORDV06",52,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",6)="6^"_$P(ORX0,U,7) ;Quantity
"RTN","ORDV06",53,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",7)="7^"_$$DATE^ORDVU($P(ORX0,U,11)) ;Exp/Cancel Date
"RTN","ORDV06",54,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",8)="8^"_$$DATE^ORDVU($P(ORX0,U)) ;Issue Date
"RTN","ORDV06",55,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",9)="9^"_$$DATE^ORDVU($P(ORX0,U,2)) ;Last Fill Date
"RTN","ORDV06",56,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",10)="10^"_$P(ORX0,U,8) ;#Refills
"RTN","ORDV06",57,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",11)="11^"_$P($P(ORX0,U,4),";",2) ;Provider
"RTN","ORDV06",58,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",12)="12^"_$P(ORX0,U,10) ;Cost-fill
"RTN","ORDV06",59,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",15)="15^"_$P(ORX0,U,9) ;PharmID
"RTN","ORDV06",60,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",16)="16^"_$P(ORX0,U,11) ;Order Number
"RTN","ORDV06",61,0)
 . S J=0
"RTN","ORDV06",62,0)
 . F  S J=$O(^TMP("PSOO",$J,ORDT,J)) Q:'J  D 
"RTN","ORDV06",63,0)
 ..S X=^(J,0),^TMP("ORDATA",$J,ORDT,"WP",14,J)="14^"_X
"RTN","ORDV06",64,0)
 K ^TMP("PSOO",$J)
"RTN","ORDV06",65,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV06",66,0)
 Q
"RTN","ORDV06",67,0)
RXAV(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;Active IV Pharmacy
"RTN","ORDV06",68,0)
 ;Call to ENHS^PSJEEU0
"RTN","ORDV06",69,0)
 N ORIVSTAT,GO
"RTN","ORDV06",70,0)
 Q:'$L(OREXT)
"RTN","ORDV06",71,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV06",72,0)
 Q:'$L($T(@GO))
"RTN","ORDV06",73,0)
 S ORIVSTAT="^ACTIVE^"
"RTN","ORDV06",74,0)
 D GET1
"RTN","ORDV06",75,0)
 Q
"RTN","ORDV06",76,0)
RXIV(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;  All IV Pharmcy
"RTN","ORDV06",77,0)
 ;Call to ENHS^PSJEEU0
"RTN","ORDV06",78,0)
 N ORIVSTAT,GO
"RTN","ORDV06",79,0)
 Q:'$L(OREXT)
"RTN","ORDV06",80,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV06",81,0)
 Q:'$L($T(@GO))
"RTN","ORDV06",82,0)
 S ORIVSTAT=""
"RTN","ORDV06",83,0)
 D GET1
"RTN","ORDV06",84,0)
 Q
"RTN","ORDV06",85,0)
GET1 N ORDT,ORI,ORX0,ORIDRG,ORDRGIEN,ORDRG,ORDOSE,ORREC,ORSTAT,ORSTRTDT,ORSTOPDT,ORROUT,ORSIG,ORWII,ORMORE
"RTN","ORDV06",86,0)
 N GMI,GMTSIDT,MAX,ON,PS,PSIVREA,PSJEDT,PSJNKF,PSJPFWD,TN,GMTSNDM,GMTS1,GMTS2,ORSITE,SITE
"RTN","ORDV06",87,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV06",88,0)
 S PSJEDT=1,PSJNKF=1
"RTN","ORDV06",89,0)
 K ^TMP("ORDATA",$J),^UTILITY("PSG",$J),^UTILITY("PSIV",$J)
"RTN","ORDV06",90,0)
 D @GO
"RTN","ORDV06",91,0)
 S ORDT=-9999999,ORI=0
"RTN","ORDV06",92,0)
 F  S ORDT=$O(^UTILITY("PSIV",$J,ORDT)) Q:(ORDT="")  S ORX0=$G(^(ORDT,0)) I ORX0'="" D
"RTN","ORDV06",93,0)
 . I $L(ORIVSTAT),ORIVSTAT'[(U_$P($P(ORX0,U,4),";",2)_U) Q  ;Check status
"RTN","ORDV06",94,0)
 . S ORMORE=0,SITE=$S($L($G(^UTILITY("PSIV",$J,ORDT,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV06",95,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",1)="1^"_SITE  ;Station ID
"RTN","ORDV06",96,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",6)="6^"_$$DATE^ORDVU($P(ORX0,U))  ;Start Date
"RTN","ORDV06",97,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",7)="7^"_$$DATE^ORDVU($P(ORX0,U,2))  ;Stop Date
"RTN","ORDV06",98,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",4)="4^"_$P(ORX0,U,5)  ;Rate
"RTN","ORDV06",99,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",5)="5^"_$P(ORX0,U,6)  ;Schedule JEH
"RTN","ORDV06",100,0)
 . S ORIDRG=0
"RTN","ORDV06",101,0)
 . F  S ORIDRG=$O(^UTILITY("PSIV",$J,ORDT,"A",ORIDRG)) Q:'ORIDRG  S ORREC=$G(^(ORIDRG)) S:ORIDRG>1 ORMORE=1 D  ;Additives
"RTN","ORDV06",102,0)
 .. S ^TMP("ORDATA",$J,ORDT,"WP",2,ORIDRG)="2^"_$P($P(ORREC,U),";",2)_"  "_$P(ORREC,U,2) ;Additive  Dose
"RTN","ORDV06",103,0)
 . S ORIDRG=0
"RTN","ORDV06",104,0)
 . F  S ORIDRG=$O(^UTILITY("PSIV",$J,ORDT,"S",ORIDRG)) Q:'ORIDRG  S ORREC=$G(^(ORIDRG)) S:ORIDRG>1 ORMORE=1 D  ;Solutions
"RTN","ORDV06",105,0)
 .. S ^TMP("ORDATA",$J,ORDT,"WP",3,ORIDRG)="3^"_$P($P(ORREC,U),";",2)_"  "_$P(ORREC,U,2) ;Solution  Dose
"RTN","ORDV06",106,0)
 . I ORMORE S ^TMP("ORDATA",$J,ORDT,"WP",8)="8^[+]" ;flag for detail
"RTN","ORDV06",107,0)
 K ^UTILITY("PSG",$J),^UTILITY("PSIV",$J)
"RTN","ORDV06",108,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV06",109,0)
 Q
"RTN","ORDV06",110,0)
RXUD(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;  Get Unit Dose Pharmacy Component
"RTN","ORDV06",111,0)
 ;Call to ENHS^PSJEEU0
"RTN","ORDV06",112,0)
 N J,ORDT,ORI,ORX0,ORDRGIEN,ORDRG,ORDOSE,ORSTAT,ORSTRTDT,ORSTOPDT,ORROUT,ORSIG,GO
"RTN","ORDV06",113,0)
 N GMI,IX,MAX,ON,PS,PSIVREA,PSJEDT,PSJNKF,PSJPFWD,GMR,TN,UDS,GMTSNDM,GMTS1,GMTS2,ORSITE,SITE
"RTN","ORDV06",114,0)
 Q:'$L(OREXT)
"RTN","ORDV06",115,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV06",116,0)
 Q:'$L($T(@GO))
"RTN","ORDV06",117,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV06",118,0)
 S PSJEDT=1,PSJNKF=1
"RTN","ORDV06",119,0)
 K ^TMP("ORDATA",$J),^UTILITY("PSG",$J),^UTILITY("PSIV",$J)
"RTN","ORDV06",120,0)
 D @GO
"RTN","ORDV06",121,0)
 S ORDT=-9999999,ORI=0
"RTN","ORDV06",122,0)
 F  S ORDT=$O(^UTILITY("PSG",$J,ORDT)) Q:(ORDT="")  S ORX0=$G(^(ORDT)) I ORX0'="" D
"RTN","ORDV06",123,0)
 . S SITE=$S($L($G(^UTILITY("PSG",$J,ORDT,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV06",124,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",1)="1^"_SITE  ;Station ID
"RTN","ORDV06",125,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",2)="2^"_$P($P(ORX0,U,3),":")  ;DRUG IEN
"RTN","ORDV06",126,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",3)="3^"_$P($P(ORX0,U,3),";",2)  ;Drug Name
"RTN","ORDV06",127,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",4)="4^"_$P(ORX0,U,6)  ;Dose
"RTN","ORDV06",128,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",5)="5^"_$P($P(ORX0,U,5),";",2)  ;Status
"RTN","ORDV06",129,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",6)="6^"_$$DATE^ORDVU($P(ORX0,U))  ;START Date
"RTN","ORDV06",130,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",7)="7^"_$$DATE^ORDVU($P(ORX0,U,2))  ;Stop Date
"RTN","ORDV06",131,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",8)="8^"_$P($P(ORX0,U,7),";",3)  ;Route
"RTN","ORDV06",132,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",9)="9^"_$P(ORX0,U,8)  ;SIG
"RTN","ORDV06",133,0)
 K ^UTILITY("PSG",$J),^UTILITY("PSIV",$J)
"RTN","ORDV06",134,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV06",135,0)
 Q
"RTN","ORDV06A")
0^214^B7403444
"RTN","ORDV06A",1,0)
ORDV06A ; slc/dcm - OE/RR Report Extracts ;3/8/04  11:17
"RTN","ORDV06A",2,0)
 ;;3.0;ORDER ENTRY RESULTS REPORTING;**215,243**;Dec 17, 1997;Build 242
"RTN","ORDV06A",3,0)
 ;Pharmacy Extracts
"RTN","ORDV06A",4,0)
NVA(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;All Outpatient Pharmacy
"RTN","ORDV06A",5,0)
 ;Call to PSOHCSUM
"RTN","ORDV06A",6,0)
 ;^TMP("PSOO",$J,"NVA",n,0)=Herbal/OTC/Non VA Medication^status (active or discontinued)^start date(fm format)^cprs order # (ptr to 100)
"RTN","ORDV06A",7,0)
 ;                          ^date/time documented (fm format)^documented by (ptr to 200_";"_.01)^dc date/time(fm format)
"RTN","ORDV06A",8,0)
 ;^TMP("PSOO",$J,"NVA",n,1,0)=dosage^med route^schedule (previous 3 fields are Instructions)^drug (file #50_";"_.01)^clinic (file #44_";"_.01)
"RTN","ORDV06A",9,0)
 ;^TMP("PSOO",$J,"NVA",n,"DSC",nn,0)=statement/explanation/comments
"RTN","ORDV06A",10,0)
 I $L($T(GCPR^OMGCOAS1)) D  ; Call if FHIE station 200
"RTN","ORDV06A",11,0)
 . N BEG,END,MAX
"RTN","ORDV06A",12,0)
 . S BEG=0,END=9999999,MAX=9999
"RTN","ORDV06A",13,0)
 . D GCPR^OMGCOAS1(DFN,"RXOP",BEG,END,MAX)
"RTN","ORDV06A",14,0)
 ;
"RTN","ORDV06A",15,0)
 N GO
"RTN","ORDV06A",16,0)
 Q:'$L(OREXT)
"RTN","ORDV06A",17,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV06A",18,0)
 Q:'$L($T(@GO))
"RTN","ORDV06A",19,0)
 D GET
"RTN","ORDV06A",20,0)
 Q
"RTN","ORDV06A",21,0)
GET N J,ORDT,ORDRGIEN,ORDRG,ORRXNO,ORSTAT,ORQTY,OREXP,ORISSUE,ORLAST,ORREF,ORPRVD,ORCOST,ORSIG,ORX0,ORX1
"RTN","ORDV06A",22,0)
 N ECD,GMR,GMW,IX,PSOBEGIN,GMTSNDM,GMTS1,GMTS2,ORSITE,SITE
"RTN","ORDV06A",23,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV06A",24,0)
 S PSOBEGIN=0
"RTN","ORDV06A",25,0)
 K ^TMP("ORDATA",$J)
"RTN","ORDV06A",26,0)
 I '$L($T(GCPR^OMGCOAS1)) D
"RTN","ORDV06A",27,0)
 . K ^TMP("PSOO",$J)
"RTN","ORDV06A",28,0)
 . D @GO
"RTN","ORDV06A",29,0)
 S ORDT=0
"RTN","ORDV06A",30,0)
 F  S ORDT=$O(^TMP("PSOO",$J,"NVA",ORDT)) Q:(ORDT'>0)  S ORX0=$G(^(ORDT,0)) I ORX0'="" S ORX1=$G(^(1,0)) D
"RTN","ORDV06A",31,0)
 . S SITE=$S($L($G(^TMP("PSOO",$J,"NVA",ORDT,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV06A",32,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",1)="1^"_SITE ;Station ID
"RTN","ORDV06A",33,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",2)="2^"_$P(ORX0,U) ;Herbal/OTC/Non VA Medication
"RTN","ORDV06A",34,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",3)="3^"_$P(ORX0,U,2) ;Status
"RTN","ORDV06A",35,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",4)="4^"_$$DATE^ORDVU($P(ORX0,U,3)) ;Start Date
"RTN","ORDV06A",36,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",5)="5^"_$$DATE^ORDVU($P(ORX0,U,5)) ;Date Documented
"RTN","ORDV06A",37,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",6)="6^"_$P($P(ORX0,U,6),";",2) ;Documented By
"RTN","ORDV06A",38,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",7)="7^"_$$DATE^ORDVU($P(ORX0,U,7)) ;Date DC'd
"RTN","ORDV06A",39,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",8)="8^"_$P(ORX1,U)_" "_$P(ORX1,U,2)_" "_$P(ORX1,U,3) ;SIG dose + route + schedule
"RTN","ORDV06A",40,0)
 . S J=0
"RTN","ORDV06A",41,0)
 . F  S J=$O(^TMP("PSOO",$J,"NVA",ORDT,"DSC",J)) Q:'J  S X=^(J,0),^TMP("ORDATA",$J,ORDT,"WP",10,J)="10^"_X
"RTN","ORDV06A",42,0)
 . I $O(^TMP("PSOO",$J,"NVA",ORDT,"DSC",1)) S ^TMP("ORDATA",$J,ORDT,"WP",9)="9^[+]" ;flag for detail
"RTN","ORDV06A",43,0)
 K ^TMP("PSOO",$J)
"RTN","ORDV06A",44,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV06A",45,0)
 Q
"RTN","ORDV08")
0^72^B20597537
"RTN","ORDV08",1,0)
ORDV08 ;DAN/SLC Testing new component ;8/22/01  11:30
"RTN","ORDV08",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**109,120,243**;Dec 17,1997;Build 242
"RTN","ORDV08",3,0)
 ;
"RTN","ORDV08",4,0)
RIM(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT)        ;Radiology report
"RTN","ORDV08",5,0)
 ;External Calls: MAIN^GMTSRAE(2),RPT^ORWRA
"RTN","ORDV08",6,0)
 N ORX0,ORCNT,ORSITE,SITE,GO,ORMORE,ORROOT
"RTN","ORDV08",7,0)
 Q:'$L(OREXT)
"RTN","ORDV08",8,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV08",9,0)
 Q:'$L($T(@GO))
"RTN","ORDV08",10,0)
 K ^TMP("ORDATA",$J),^TMP("ORXPND",$J)
"RTN","ORDV08",11,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV08",12,0)
 D @GO
"RTN","ORDV08",13,0)
 S ORCNT=0
"RTN","ORDV08",14,0)
 F  S ORCNT=$O(^TMP($J,"ORAEXAMS",ORCNT)) Q:'ORCNT  D
"RTN","ORDV08",15,0)
 . S ORMORE=0
"RTN","ORDV08",16,0)
 . S ORX0=$G(^TMP($J,"ORAEXAMS",ORCNT))
"RTN","ORDV08",17,0)
 . D RPT^ORWRA(.ORROOT,DFN,$P(ORX0,U))
"RTN","ORDV08",18,0)
 . S SITE=$S($L($G(^TMP($J,"ORAEXAMS",ORCNT,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV08",19,0)
 . S ^TMP("ORDATA",$J,ORCNT,"WP",1)="1^"_SITE ;Site ID
"RTN","ORDV08",20,0)
 . S ^TMP("ORDATA",$J,ORCNT,"WP",2)="2^"_$$DATE^ORDVU($P(ORX0,U,2)) ;date
"RTN","ORDV08",21,0)
 . S ^TMP("ORDATA",$J,ORCNT,"WP",3)="3^"_$P(ORX0,U,3) ;procedure
"RTN","ORDV08",22,0)
 . S ^TMP("ORDATA",$J,ORCNT,"WP",4)="4^"_$P(ORX0,U,5) ;report status
"RTN","ORDV08",23,0)
 . S ^TMP("ORDATA",$J,ORCNT,"WP",5)="5^"_$P(ORX0,U,4) ;Case #
"RTN","ORDV08",24,0)
 . I $O(^TMP("ORXPND",$J,0)) S ORMORE=1 D SPMRG^ORDVU($NA(^TMP("ORXPND",$J)),$NA(^TMP("ORDATA",$J,ORCNT,"WP",6,1)),6) ;clinical history
"RTN","ORDV08",25,0)
 . I ORMORE S ^TMP("ORDATA",$J,ORCNT,"WP",7)="7^[+]" ;flag for detail
"RTN","ORDV08",26,0)
 . S ^TMP("ORDATA",$J,ORCNT,"WP",8)="8^"_$P(ORX0,U,14) ;Image available
"RTN","ORDV08",27,0)
 . S ^TMP("ORDATA",$J,ORCNT,"WP",9)="9^"_"i"_$P(ORX0,U,1)  ;EXAM ID
"RTN","ORDV08",28,0)
 K ^TMP("RAE",$J),^TMP("ORXPND",$J)
"RTN","ORDV08",29,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV08",30,0)
 Q
"RTN","ORDV08",31,0)
 ;
"RTN","ORDV08",32,0)
IGET ;Get imaging exams
"RTN","ORDV08",33,0)
 N ORROOT,ORRADATA,I,ID
"RTN","ORDV08",34,0)
 S ORRADATA=$NA(^TMP($J,"RAE1",DFN))
"RTN","ORDV08",35,0)
 S ORROOT=$NA(^TMP($J,"ORAEXAMS"))
"RTN","ORDV08",36,0)
 K @ORRADATA,@ORROOT
"RTN","ORDV08",37,0)
 D EN1^RAO7PC1(DFN,ORDBEG,ORDEND,ORMAX) ;call to Radiology to get exams
"RTN","ORDV08",38,0)
 S I=0,ID=""
"RTN","ORDV08",39,0)
 F  S ID=$O(@ORRADATA@(ID)) Q:ID=""  D
"RTN","ORDV08",40,0)
 . S I=I+1
"RTN","ORDV08",41,0)
 . S @ORROOT@(I)=ID_U_(9999999.9999-ID)_U_@ORRADATA@(ID)
"RTN","ORDV08",42,0)
 K @ORRADATA
"RTN","ORDV08",43,0)
 Q
"RTN","ORDV08",44,0)
 ;
"RTN","ORDV08",45,0)
MPRO(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;Medicine Procedures
"RTN","ORDV08",46,0)
 N ORSITE,ORI,ORREC,ORMORE,ORDATE,SITE,ORARRAY,ORPROC,ORSUM
"RTN","ORDV08",47,0)
 Q:'$L(OREXT)
"RTN","ORDV08",48,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV08",49,0)
 Q:'$L($T(@GO))
"RTN","ORDV08",50,0)
 K ^TMP("ORDATA",$J),^TMP("ORTEMP",$J),^TMP("MCAR",$J)
"RTN","ORDV08",51,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV08",52,0)
 D @GO
"RTN","ORDV08",53,0)
 S ORI=0
"RTN","ORDV08",54,0)
 F  S ORI=$O(^TMP("MCAR",$J,ORI)) Q:'ORI!(ORI>ORMAX)  D
"RTN","ORDV08",55,0)
 .K ^TMP("ORTEMP",$J) D GETREC^ORDV08A(ORI,80,20,56,3)
"RTN","ORDV08",56,0)
 .S SITE=$S($L($G(^TMP("MCAR",$J,ORI,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV08",57,0)
 .S ^TMP("ORDATA",$J,ORI,"WP",1)="1^"_SITE ;Site ID
"RTN","ORDV08",58,0)
 .S ^TMP("ORDATA",$J,ORI,"WP",2)="2^"_$$DATEMMM^ORDVU(ORDATE) ;Procedure date/time
"RTN","ORDV08",59,0)
 .S ^TMP("ORDATA",$J,ORI,"WP",3)="3^"_ORPROC ;Procedure Name
"RTN","ORDV08",60,0)
 .S ^TMP("ORDATA",$J,ORI,"WP",4)="4^"_$S(ORSUM'="":ORSUM,1:"No Summary") ;Summary
"RTN","ORDV08",61,0)
 .I $D(^TMP("ORTEMP",$J)) S ORMORE=1 D SPMRG^ORDVU($NA(^TMP("ORTEMP",$J)),$NA(^TMP("ORDATA",$J,ORI,"WP",5,1)),5) ;Detailed Report
"RTN","ORDV08",62,0)
 .I ORMORE S ^TMP("ORDATA",$J,ORI,"WP",6)="6^[+]" ;Detailed report flag
"RTN","ORDV08",63,0)
 .Q
"RTN","ORDV08",64,0)
 K ^TMP("ORTEMP",$J),^TMP("MCAR",$J)
"RTN","ORDV08",65,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV08",66,0)
 Q
"RTN","ORDV08",67,0)
MGET ;Get medicine results
"RTN","ORDV08",68,0)
 D HSUM^GMTSMCMA(DFN,ORDBEG,ORDEND,ORMAX,"","F")
"RTN","ORDV08",69,0)
 Q
"RTN","ORDV08",70,0)
DIETNS(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT) ;Nutrition assessment
"RTN","ORDV08",71,0)
 ;External Calls:SITE^VASITE, NUTR^ORWRP1, LISTNUTR^ORWPR1,FMTE^XLFDT
"RTN","ORDV08",72,0)
 N ORSITE,ORARRAY,ORID,ORCNT,ORMORE,GO,ORDT
"RTN","ORDV08",73,0)
 Q:'$L(OREXT)
"RTN","ORDV08",74,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV08",75,0)
 Q:'$L($T(@GO))
"RTN","ORDV08",76,0)
 K ^TMP("ORDATA",$J),^TMP("ORXPND",$J)
"RTN","ORDV08",77,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV08",78,0)
 D @GO
"RTN","ORDV08",79,0)
 S ORCNT=0,ORDT=OROMEGA
"RTN","ORDV08",80,0)
 F  S ORDT=$O(^TMP($J,"FHADT",DFN,ORDT)) Q:(ORDT'>0)!(ORDT>ORALPHA)!(ORCNT>ORMAX)  D
"RTN","ORDV08",81,0)
 . S ORID=$$FMTE^XLFDT(9999999-ORDT,2) ;convert inverse date to external date
"RTN","ORDV08",82,0)
 . S ORCNT=ORCNT+1,ORMORE=0
"RTN","ORDV08",83,0)
 . D NUTR^ORWRP1(.ORARRAY,DFN,ORID)
"RTN","ORDV08",84,0)
 . S ORSITE=$S($L($G(^TMP($J,"FHADT",ORDT,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV08",85,0)
 . S ^TMP("ORDATA",$J,ORCNT,"WP",1)="1^"_ORSITE ;Site ID
"RTN","ORDV08",86,0)
 . S ^TMP("ORDATA",$J,ORCNT,"WP",2)="2^"_ORID ;assessment date/time
"RTN","ORDV08",87,0)
 . I $O(^TMP("ORXPND",$J,0)) S ORMORE=1 D SPMRG^ORDVU($NA(^TMP("ORXPND",$J)),$NA(^TMP("ORDATA",$J,ORCNT,"WP",3,1)),3) ;assessment report
"RTN","ORDV08",88,0)
 . I ORMORE S ^TMP("ORDATA",$J,ORCNT,"WP",4)="4^[+]" ;flag for detail
"RTN","ORDV08",89,0)
 K ^TMP($J,"FHADT"),^TMP("ORXPND",$J)
"RTN","ORDV08",90,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV08",91,0)
 Q
"RTN","ORDV08",92,0)
 ;
"RTN","ORDV08",93,0)
GETNS ;Get nutritional assessments
"RTN","ORDV08",94,0)
 D LISTNUTR^ORWRP1(.ORARRAY,DFN)
"RTN","ORDV08",95,0)
 Q
"RTN","ORDVX1")
0^171^B5290851
"RTN","ORDVX1",1,0)
ORDVX1 ; slc/dcm - OE/RR Extract Lab AP Reports ;3/22/03  9:34
"RTN","ORDVX1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 199;Build 242
"RTN","ORDVX1",3,0)
 ; Modified from Health Summary Extract ^GMTSLREE
"RTN","ORDVX1",4,0)
 ; External References
"RTN","ORDVX1",5,0)
 ;   DBIA   525  ^LR(
"RTN","ORDVX1",6,0)
 ;   DBIA 10011  ^DIWP
"RTN","ORDVX1",7,0)
 ;                    
"RTN","ORDVX1",8,0)
XEM ; Extract EM Data
"RTN","ORDVX1",9,0)
 N IX0,IX K ^TMP("OROOT",$J) S IX=OROMEGA
"RTN","ORDVX1",10,0)
 F IX0=1:0:ORMAX S IX=$O(^LR(LRDFN,"EM",IX)) Q:IX'>0!(IX>ORALPHA)  D APSET("EM")
"RTN","ORDVX1",11,0)
 Q
"RTN","ORDVX1",12,0)
XSP ; Extract SP Data
"RTN","ORDVX1",13,0)
 N IX0,IX K ^TMP("OROOT",$J) S IX=OROMEGA
"RTN","ORDVX1",14,0)
 F IX0=1:0:ORMAX S IX=$O(^LR(LRDFN,"SP",IX)) Q:IX'>0!(IX>ORALPHA)  D APSET("SP")
"RTN","ORDVX1",15,0)
 Q
"RTN","ORDVX1",16,0)
XCY ; Extract CY Data
"RTN","ORDVX1",17,0)
 N IX0,IX K ^TMP("OROOT",$J) S IX=OROMEGA
"RTN","ORDVX1",18,0)
 F IX0=1:0:ORMAX S IX=$O(^LR(LRDFN,"CY",IX)) Q:IX'>0!(IX>ORALPHA)  D APSET("CY")
"RTN","ORDVX1",19,0)
 Q
"RTN","ORDVX1",20,0)
APSET(LRSS)   ; Sets ^TMP("OROOT",$J
"RTN","ORDVX1",21,0)
 N ACC,CDT,DA,DIC,DIQ,DR,GMW,SN,X,YR
"RTN","ORDVX1",22,0)
 S CDT=$P(^LR(LRDFN,LRSS,IX,0),U),ACC=$P(^(0),U,6)
"RTN","ORDVX1",23,0)
 ;I $S(+$P(^LR(LRDFN,LRSS,IX,0),U)'>0:1,+$P(^(0),U,11)'>0:1,1:0) Q
"RTN","ORDVX1",24,0)
 I $D(ACC) S IX0=IX0+1
"RTN","ORDVX1",25,0)
 S X=CDT D DTM4 S CDT=X K X
"RTN","ORDVX1",26,0)
 S ^TMP("OROOT",$J,IX,LRSS,0)=CDT_U_ACC
"RTN","ORDVX1",27,0)
 I $D(^LR(LRDFN,LRSS,IX,.1)) S ^TMP("OROOT",$J,IX,LRSS,.1)="Site/Specimen"
"RTN","ORDVX1",28,0)
 S SN=0 F  S SN=$O(^LR(LRDFN,LRSS,IX,.1,SN)) Q:SN'>0  S ^TMP("OROOT",$J,IX,LRSS,.1,SN)=$P(^LR(LRDFN,LRSS,IX,.1,SN,0),U)
"RTN","ORDVX1",29,0)
 K ^TMP("ORC",$J)
"RTN","ORDVX1",30,0)
 D EN^LR7OSAP4("^TMP(""ORC"",$J)",LRDFN,LRSS,IX)
"RTN","ORDVX1",31,0)
 S J=0,CNT=$O(^TMP("OROOT",$J,IX,LRSS,.2,999999),-1)-1
"RTN","ORDVX1",32,0)
 F  S J=$O(^TMP("ORC",$J,J)) Q:'J  S CNT=CNT+1,^TMP("OROOT",$J,IX,LRSS,.2,CNT)=^TMP("ORC",$J,J,0)
"RTN","ORDVX1",33,0)
 K ^TMP("ORC",$J)
"RTN","ORDVX1",34,0)
 Q
"RTN","ORDVX1",35,0)
DTM4 ;   Receives X FM date and returns X in MM/DD/YYYY TT:TT
"RTN","ORDVX1",36,0)
 S X=$TR($$FMTE^XLFDT(X,"5ZM"),"@"," ")
"RTN","ORDVX1",37,0)
 Q
"RTN","ORDVX1",38,0)
ALL ; Get all AP data in one swell foop
"RTN","ORDVX1",39,0)
 N IX0,IX K ^TMP("OROOT",$J) S IX=OROMEGA
"RTN","ORDVX1",40,0)
 F IX0=1:0:ORMAX S IX=$O(^LR(LRDFN,"SP",IX)) Q:IX'>0!(IX>ORALPHA)  D APSET("SP")
"RTN","ORDVX1",41,0)
 S IX=OROMEGA F IX0=1:0:ORMAX S IX=$O(^LR(LRDFN,"CY",IX)) Q:IX'>0!(IX>ORALPHA)  D APSET("CY")
"RTN","ORDVX1",42,0)
 S IX=OROMEGA F IX0=1:0:ORMAX S IX=$O(^LR(LRDFN,"EM",IX)) Q:IX'>0!(IX>ORALPHA)  D APSET("EM")
"RTN","ORDVX1",43,0)
 Q
"RTN","OREVNTX")
0^169^B73719059
"RTN","OREVNTX",1,0)
OREVNTX ; SLC/MKB - Event delayed orders RPC's ; 5/4/07 11:34am
"RTN","OREVNTX",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141,243**;Dec 17, 1997;Build 242
"RTN","OREVNTX",3,0)
 ;
"RTN","OREVNTX",4,0)
PAT(ORY,DFN)    ; -- Returns currently delayed events for patient DFN
"RTN","OREVNTX",5,0)
 N EVT,CNT,X,Y S DFN=+$G(DFN),(EVT,CNT)=0
"RTN","OREVNTX",6,0)
 F  S EVT=+$O(^ORE(100.2,"AE",DFN,EVT)) Q:EVT<1  S Y=+$O(^(EVT,0)) D
"RTN","OREVNTX",7,0)
 . I $G(^ORE(100.2,Y,1)) K ^ORE(100.2,"AE",DFN,EVT,Y) Q
"RTN","OREVNTX",8,0)
 . Q:$$LAPSED(Y)  ;I $$EMPTY(Y) D CANCEL(Y) Q
"RTN","OREVNTX",9,0)
 . Q:$O(^ORE(100.2,"DAD",Y,0))  ;has children
"RTN","OREVNTX",10,0)
 . S X=$P($G(^ORD(100.5,EVT,0)),U,8),X="Delayed "_$$LOWER^VALM1(X)
"RTN","OREVNTX",11,0)
 . S CNT=CNT+1,ORY(CNT)=Y_U_X
"RTN","OREVNTX",12,0)
 S:CNT ORY(0)=CNT
"RTN","OREVNTX",13,0)
 Q
"RTN","OREVNTX",14,0)
 ;
"RTN","OREVNTX",15,0)
EXISTS(DFN,EVT) ; -- Returns 1 if patient DFN has delayed orders for EVT,
"RTN","OREVNTX",16,0)
 ;    or 2 if parent/sibling event has delayed orders, else 0
"RTN","OREVNTX",17,0)
 ;
"RTN","OREVNTX",18,0)
 N X,Y,I S Y=0 I '$G(DFN)!'$G(EVT) G EXQ
"RTN","OREVNTX",19,0)
 I $O(^ORE(100.2,"AE",+DFN,+EVT,0)) S Y=1 G EXQ
"RTN","OREVNTX",20,0)
 S X=+$P($G(^ORD(100.5,+EVT,0)),U,12) I X D  G EXQ ;ck parent,siblings
"RTN","OREVNTX",21,0)
 . I $O(^ORE(100.2,"AE",+DFN,X,0)) S Y=2 Q
"RTN","OREVNTX",22,0)
 . S I=0 F  S I=+$O(^ORD(100.5,"DAD",X,I)) Q:I<1  I $O(^ORE(100.2,"AE",+DFN,I,0)) S Y=2 Q
"RTN","OREVNTX",23,0)
EXQ Q Y
"RTN","OREVNTX",24,0)
 ;
"RTN","OREVNTX",25,0)
LIST(ORY,DFN)   ; -- Returns all processed events for patient DFN as
"RTN","OREVNTX",26,0)
 ;    ORY(#) = PatEvtIEN ^ Display Text ^ EvtDateTime
"RTN","OREVNTX",27,0)
 ;             in reverse chronological order
"RTN","OREVNTX",28,0)
 N IDT,DA,CNT,X0,X1,EVT,DC,X
"RTN","OREVNTX",29,0)
 S DFN=+$G(DFN),(IDT,CNT)=0
"RTN","OREVNTX",30,0)
 F  S IDT=$O(^ORE(100.2,"AC",DFN,IDT)) Q:IDT<1  D
"RTN","OREVNTX",31,0)
 . S DA=0 F  S DA=+$O(^ORE(100.2,"AC",DFN,IDT,DA)) Q:DA<1  D
"RTN","OREVNTX",32,0)
 .. S X0=$G(^ORE(100.2,DA,0)),X1=$G(^(1)) Q:$P(X1,U,5)  ;has parent
"RTN","OREVNTX",33,0)
 .. S EVT=+$P(X0,U,2),DC=+$P(X1,U,3)
"RTN","OREVNTX",34,0)
 .. I '$P(X0,U,4),'$O(^ORE(100.2,DA,2,0)),'$O(^ORE(100.2,DA,3,0)),'$D(^OR(100,"AEVNT",DFN_";DPT(",DA)) Q  ;no orders
"RTN","OREVNTX",35,0)
 .. S I=+$O(^ORE(100.2,DA,10,"B"),-1),X=$P($G(^(I,0)),U,2) I X="LP"!(X="CA") Q  ;lapsed or cancelled
"RTN","OREVNTX",36,0)
 .. ;Q if not current admission?
"RTN","OREVNTX",37,0)
 .. S X=$S(EVT:$P($G(^ORD(100.5,EVT,0)),U,8),DC:$P($G(^ORD(100.6,DC,0)),U,5),1:"UNSPECIFIED EVENT")
"RTN","OREVNTX",38,0)
 .. S X=$$LOWER^VALM1(X),CNT=CNT+1,ORY(CNT)=DA_U_X_U_$P(X1,U)
"RTN","OREVNTX",39,0)
 S:CNT ORY(0)=CNT
"RTN","OREVNTX",40,0)
 Q
"RTN","OREVNTX",41,0)
 ;
"RTN","OREVNTX",42,0)
COMP(PTEVT) ; -- Returns 1 or 0, if PTEVT has been completed
"RTN","OREVNTX",43,0)
 N Y,I S Y=$S($G(^ORE(100.2,+$G(PTEVT),1)):1,1:0)
"RTN","OREVNTX",44,0)
 I Y S I=+$O(^ORE(100.2,+$G(PTEVT),10,0)) S:$P($G(^(I,0)),U,2)="CA" Y=0
"RTN","OREVNTX",45,0)
 Q Y
"RTN","OREVNTX",46,0)
 ;
"RTN","OREVNTX",47,0)
ACTIVE(ORY,TYPE)     ; -- Returns all active events [of TYPE] from #100.5
"RTN","OREVNTX",48,0)
 ;  where TYPE=string containing any of the codes from the TYPE field
"RTN","OREVNTX",49,0)
 N NM,IEN,CNT,X0,X S CNT=0,TYPE=$G(TYPE)
"RTN","OREVNTX",50,0)
 S NM="" F  S NM=$O(^ORD(100.5,"C",NM)) Q:NM=""  D
"RTN","OREVNTX",51,0)
 . S IEN=0 F  S IEN=+$O(^ORD(100.5,"C",NM,IEN)) Q:IEN<1  D
"RTN","OREVNTX",52,0)
 .. S X0=$G(^ORD(100.5,IEN,0)) I '$L($P(X0,U,2)) D  ;Child event
"RTN","OREVNTX",53,0)
 ... S X=$P(X0,U,12) S:X $P(X0,U,2)=$P($G(^ORD(100.5,+X,0)),U,2)
"RTN","OREVNTX",54,0)
 .. I $L(TYPE),TYPE'[$P(X0,U,2) Q
"RTN","OREVNTX",55,0)
 .. Q:$O(^ORD(100.5,"DAD",IEN,0))  ;Parent event
"RTN","OREVNTX",56,0)
 .. S CNT=CNT+1,ORY(CNT)=IEN_U_X0
"RTN","OREVNTX",57,0)
 S:CNT ORY(0)=CNT
"RTN","OREVNTX",58,0)
 Q
"RTN","OREVNTX",59,0)
 ;
"RTN","OREVNTX",60,0)
NAME(PTEVT)     ; -- Return name of Patient Event
"RTN","OREVNTX",61,0)
 N X,Y,Z S X=+$P($G(^ORE(100.2,+$G(PTEVT),0)),U,2),Z=$G(^(1))
"RTN","OREVNTX",62,0)
 S:X Y=$P($G(^ORD(100.5,X,0)),U,8)
"RTN","OREVNTX",63,0)
 I 'X S X=+$P(Z,U,3),Y=$P($G(^ORD(100.6,X,0)),U,5)
"RTN","OREVNTX",64,0)
 S Y=$S('Z:"Delayed ",1:"")_$$LOWER^VALM1(Y)
"RTN","OREVNTX",65,0)
 Q Y
"RTN","OREVNTX",66,0)
 ;
"RTN","OREVNTX",67,0)
SHORTNM(PTEVT)  ; -- Return Short Name of Patient Event
"RTN","OREVNTX",68,0)
 ;   or first 15 characters of Event Name if unspecified
"RTN","OREVNTX",69,0)
 N X,Y,Y0 S X=+$P($G(^ORE(100.2,+$G(PTEVT),0)),U,2) I X D
"RTN","OREVNTX",70,0)
 . S Y0=$G(^ORD(100.5,X,0)),Y=$P(Y0,U,10)
"RTN","OREVNTX",71,0)
 . S:'$L(Y) Y=$E($P(Y0,U,8),1,15)
"RTN","OREVNTX",72,0)
 I 'X S X=+$P($G(^ORE(100.2,+$G(PTEVT),1)),U,3),Y=$E($P($G(^ORD(100.6,X,0)),U,5),1,15)
"RTN","OREVNTX",73,0)
 Q Y
"RTN","OREVNTX",74,0)
 ;
"RTN","OREVNTX",75,0)
EVT(PTEVT)      ; -- Return Event ptr #100.5, given PTEVT ptr #100.2
"RTN","OREVNTX",76,0)
 Q +$P($G(^ORE(100.2,+$G(PTEVT),0)),U,2)
"RTN","OREVNTX",77,0)
 ;
"RTN","OREVNTX",78,0)
DC(PTEVT) ; -- Return DC Rule ptr #100.6, given PTEVT ptr #100.2
"RTN","OREVNTX",79,0)
 I $P($G(^ORE(100.2,+$G(PTEVT),1)),U,5) S PTEVT=$P(^(1),U,5) ;use parent
"RTN","OREVNTX",80,0)
 Q +$P($G(^ORE(100.2,+$G(PTEVT),1)),U,3)
"RTN","OREVNTX",81,0)
 ;
"RTN","OREVNTX",82,0)
TYPE(PTEVT)     ; -- Return Type of Patient Event (i.e. A/D/T)
"RTN","OREVNTX",83,0)
 N X,Y S X=+$P($G(^ORE(100.2,+$G(PTEVT),0)),U,2)
"RTN","OREVNTX",84,0)
 I $P($G(^ORD(100.5,X,0)),U,12) S X=$P(^(0),U,12) ;use parent
"RTN","OREVNTX",85,0)
 S Y=$S(X:$P($G(^ORD(100.5,X,0)),U,2),1:"DC")
"RTN","OREVNTX",86,0)
 Q Y
"RTN","OREVNTX",87,0)
 ;
"RTN","OREVNTX",88,0)
DIV(PTEVT)      ; -- Return Division for PTEVT
"RTN","OREVNTX",89,0)
 N X,Y S X=+$P($G(^ORE(100.2,+$G(PTEVT),0)),U,2)
"RTN","OREVNTX",90,0)
 I $P($G(^ORD(100.5,X,0)),U,12) S X=$P(^(0),U,12) ;use parent
"RTN","OREVNTX",91,0)
 S Y=+$P($G(^ORD(100.5,X,0)),U,3) S:Y<1 Y=+$G(DUZ(2))
"RTN","OREVNTX",92,0)
 Q Y
"RTN","OREVNTX",93,0)
 ;
"RTN","OREVNTX",94,0)
LOC(PTEVT)      ; -- Return Default Ordering Location for PTEVT
"RTN","OREVNTX",95,0)
 N X,X0,Y S X=+$P($G(^ORE(100.2,+$G(PTEVT),0)),U,2)
"RTN","OREVNTX",96,0)
 S X0=$G(^ORD(100.5,X,0)),Y=+$P(X0,U,9)_";SC("
"RTN","OREVNTX",97,0)
 I Y<1,$P(X0,U,12) S Y=+$P($G(^ORD(100.5,+$P(X0,U,12),0)),U,9)_";SC("
"RTN","OREVNTX",98,0)
 S:Y<1 Y=$G(ORL)
"RTN","OREVNTX",99,0)
 Q Y
"RTN","OREVNTX",100,0)
 ;
"RTN","OREVNTX",101,0)
EMPTY(PTEVT)    ; -- Returns 1 or 0, if PTEVT has delayed orders
"RTN","OREVNTX",102,0)
 N Y,OR0,PAT,TYPE,PSO,IFN,STS S Y=1 I '$G(PTEVT) Q Y
"RTN","OREVNTX",103,0)
 S OR0=$G(^ORE(100.2,+PTEVT,0)),PAT=+$P(OR0,U)_";DPT("
"RTN","OREVNTX",104,0)
 S TYPE=$$TYPE(PTEVT) I TYPE="D" S PSO=+$O(^DIC(9.4,"C","PSO",0))
"RTN","OREVNTX",105,0)
 S IFN=0 F  S IFN=$O(^OR(100,"AEVNT",PAT,PTEVT,IFN)) Q:IFN<1  D  Q:'Y
"RTN","OREVNTX",106,0)
 . S STS=$P($G(^OR(100,IFN,3)),U,3) I STS=10 S Y=0 Q
"RTN","OREVNTX",107,0)
 . ;I IFN=+$P(OR0,U,4),STS=11!(STS=6) S Y=0 Q
"RTN","OREVNTX",108,0)
 . I TYPE="D",$P($G(^OR(100,IFN,0)),U,14)=PSO,STS=5!(STS=6) S Y=0 Q
"RTN","OREVNTX",109,0)
 I Y,$D(^ORE(100.2,"DAD",PTEVT)) D  ;ck child events
"RTN","OREVNTX",110,0)
 . N CHLD S CHLD=0
"RTN","OREVNTX",111,0)
 . F  S CHLD=+$O(^ORE(100.2,"DAD",PTEVT,CHLD)) Q:CHLD<1  D  Q:'Y
"RTN","OREVNTX",112,0)
 .. S IFN=0 F  S IFN=$O(^OR(100,"AEVNT",PAT,CHLD,IFN)) Q:IFN<1  I $P($G(^OR(100,IFN,3)),U,3)=10 S Y=0 Q
"RTN","OREVNTX",113,0)
 Q Y
"RTN","OREVNTX",114,0)
 ;
"RTN","OREVNTX",115,0)
EVTORDER(ORDER) ; -- Returns 1 or 0, if ORDER is for event
"RTN","OREVNTX",116,0)
 ;    Will return 0 if action DA is included but not NW
"RTN","OREVNTX",117,0)
 N X0,X,Y S X0=$G(^OR(100,+ORDER,0)),X=+$P(ORDER,";",2),Y=0
"RTN","OREVNTX",118,0)
 I $P(X0,U,17),X'>1 D
"RTN","OREVNTX",119,0)
 . I $P($G(^ORE(100.2,+$P(X0,U,17),0)),U,4)=+ORDER S Y=1 Q
"RTN","OREVNTX",120,0)
 . S DAD=+$P($G(^ORE(100.2,+$P(X0,U,17),1)),U,5) ;has parent?
"RTN","OREVNTX",121,0)
 . I DAD,$P($G(^ORE(100.2,DAD,0)),U,4)=+ORDER S Y=1
"RTN","OREVNTX",122,0)
 Q Y
"RTN","OREVNTX",123,0)
 ;
"RTN","OREVNTX",124,0)
MANREL(ORDER)   ; -- Returns 1 or 0, if ORDER was manually released
"RTN","OREVNTX",125,0)
 N EVT,Y,RELDT,TYPE,EVTDT S Y=0
"RTN","OREVNTX",126,0)
 S EVT=+$P($G(^OR(100,+ORDER,0)),U,17),RELDT=+$P($G(^(8,1,0)),U,16)
"RTN","OREVNTX",127,0)
 G:EVT<1 MNQ G:RELDT<1 MNQ ;not delayed or released
"RTN","OREVNTX",128,0)
 I '$D(^ORE(100.2,EVT,2,+ORDER)) S Y=1 G MNQ ;not rel'd by event
"RTN","OREVNTX",129,0)
 S TYPE=$$TYPE(EVT),EVTDT=+$G(^ORE(100.2,EVT,1))
"RTN","OREVNTX",130,0)
 I TYPE="M",$$FMDIFF^XLFDT(EVTDT,RELDT,2)<300 S Y=1
"RTN","OREVNTX",131,0)
MNQ Q Y
"RTN","OREVNTX",132,0)
 ;
"RTN","OREVNTX",133,0)
CANCEL(PTEVT)   ; -- Cancel empty PTEVT, event order
"RTN","OREVNTX",134,0)
 S PTEVT=+$G(PTEVT) D DONE(PTEVT),ACTLOG(PTEVT,"CA")
"RTN","OREVNTX",135,0)
 N IFN,DAD S IFN=+$P($G(^ORE(100.2,PTEVT,0)),U,4)
"RTN","OREVNTX",136,0)
 I IFN<1 D  ;ck for parent w/event order
"RTN","OREVNTX",137,0)
 . S DAD=+$P($G(^ORE(100.2,PTEVT,1)),U,5) Q:DAD<1
"RTN","OREVNTX",138,0)
 . Q:'$G(^ORE(100.2,DAD,1))  ;parent still active
"RTN","OREVNTX",139,0)
 . S IFN=+$P($G(^ORE(100.2,DAD,0)),U,4)
"RTN","OREVNTX",140,0)
 I IFN D:'$$DCD^ORCACT2(IFN) CLRDLY^ORCACT2(IFN) ;cancel event order
"RTN","OREVNTX",141,0)
 Q
"RTN","OREVNTX",142,0)
 ;
"RTN","OREVNTX",143,0)
DONE(PTEVT,WHEN,MVT,OR)    ; -- Terminate PTEVT
"RTN","OREVNTX",144,0)
 Q:'$G(PTEVT)  Q:'$D(^ORE(100.2,PTEVT,0))
"RTN","OREVNTX",145,0)
 N X0,X1,PAT,EVT,DAD
"RTN","OREVNTX",146,0)
 S:'$G(WHEN) WHEN=+$E($$NOW^XLFDT,1,12) D D1
"RTN","OREVNTX",147,0)
 S DAD=$P(X1,U,5) I DAD,$$ALLDONE(DAD) S PTEVT=DAD D D1 Q
"RTN","OREVNTX",148,0)
 S DAD=PTEVT,PTEVT=0 ;if PTEVT=parent, terminate children too
"RTN","OREVNTX",149,0)
 F  S PTEVT=+$O(^ORE(100.2,"DAD",DAD,PTEVT)) Q:PTEVT<1  D D1
"RTN","OREVNTX",150,0)
 Q
"RTN","OREVNTX",151,0)
D1 S X0=$G(^ORE(100.2,+PTEVT,0)),X1=$G(^(1)) Q:'$L(X0)
"RTN","OREVNTX",152,0)
 S PAT=+$P(X0,U),EVT=+$P(X0,U,2) ;,ORD=+$P(X0,U,4)
"RTN","OREVNTX",153,0)
 S $P(X1,U,1,2)=WHEN_U_$G(MVT),$P(X1,U,4)=$G(OR),^ORE(100.2,PTEVT,1)=X1
"RTN","OREVNTX",154,0)
 S ^ORE(100.2,"AC",PAT,9999999-WHEN,PTEVT)=""
"RTN","OREVNTX",155,0)
 S:$G(OR) ^ORE(100.2,"ASR",OR,PTEVT)=""
"RTN","OREVNTX",156,0)
 K:EVT ^ORE(100.2,"AE",PAT,EVT,PTEVT)
"RTN","OREVNTX",157,0)
 Q
"RTN","OREVNTX",158,0)
 ;
"RTN","OREVNTX",159,0)
ALLDONE(DAD) ; -- Returns 1 or 0, if all child events are done
"RTN","OREVNTX",160,0)
 N I,Y S Y=1,I=0
"RTN","OREVNTX",161,0)
 F  S I=+$O(^ORE(100.2,"DAD",+$G(DAD),I)) Q:I<1  I '$G(^ORE(100.2,I,1)) S Y=0 Q
"RTN","OREVNTX",162,0)
 Q Y
"RTN","OREVNTX",163,0)
 ;
"RTN","OREVNTX",164,0)
CHGEVT(IFN,NEWEVT)      ; -- Change the Patient Event for order IFN to NEWEVT
"RTN","OREVNTX",165,0)
 ;    Includes adding or removing event pointer to order
"RTN","OREVNTX",166,0)
 Q:'$G(IFN)  N PAT,OLDEVT,OR3 S:$G(NEWEVT) NEWEVT=+NEWEVT
"RTN","OREVNTX",167,0)
 S PAT=$P($G(^OR(100,+IFN,0)),U,2),OLDEVT=$P($G(^(0)),U,17),OR3=$G(^(3))
"RTN","OREVNTX",168,0)
 Q:OLDEVT=NEWEVT  K:OLDEVT ^OR(100,"AEVNT",PAT,OLDEVT,+IFN)
"RTN","OREVNTX",169,0)
 S $P(^OR(100,+IFN,0),U,17)=NEWEVT S:NEWEVT ^OR(100,"AEVNT",PAT,NEWEVT,+IFN)=""
"RTN","OREVNTX",170,0)
 I NEWEVT,$P(OR3,U,3)'=10 S $P(^OR(100,+IFN,3),U,3)=10,$P(^(8,1,0),U,15)=10
"RTN","OREVNTX",171,0)
 I 'NEWEVT,$P(OR3,U,3)=10 S $P(^OR(100,+IFN,3),U,3)=11,$P(^(8,1,0),U,15)=11 D SET^ORDD100(+IFN,1)
"RTN","OREVNTX",172,0)
 Q
"RTN","OREVNTX",173,0)
 ;
"RTN","OREVNTX",174,0)
ACTLOG(PTEVT,ACTION,EVTYPE,SAVE)  ; -- Log a note for ACTION on PTEVT
"RTN","OREVNTX",175,0)
 ;    SAVE => new data in VAIP() will be saved
"RTN","OREVNTX",176,0)
 Q:'$G(PTEVT)  Q:'$D(^ORE(100.2,PTEVT,0))  Q:'$L($G(ACTION))
"RTN","OREVNTX",177,0)
 N I,HDR,LAST,TOTAL,DA,ORNOW,MVT
"RTN","OREVNTX",178,0)
 F I=1:1:10 L +^ORE(100.2,PTEVT,10,0):1 Q:$T  H 2
"RTN","OREVNTX",179,0)
 Q:'$T "^" S HDR=$G(^ORE(100.2,PTEVT,10,0)) S:'$L(HDR) HDR="^100.25DA^^"
"RTN","OREVNTX",180,0)
 S TOTAL=+$P(HDR,U,4),LAST=+$O(^ORE(100.2,PTEVT,10,"B"),-1)
"RTN","OREVNTX",181,0)
 S I=LAST F I=(I+1):1 Q:'$D(^ORE(100.2,PTEVT,10,I,0))
"RTN","OREVNTX",182,0)
 S DA=I,$P(HDR,U,3,4)=DA_U_(TOTAL+1)
"RTN","OREVNTX",183,0)
 S ^ORE(100.2,PTEVT,10,0)=HDR L -^ORE(100.2,PTEVT,10,0)
"RTN","OREVNTX",184,0)
 S ORNOW=+$$NOW^XLFDT,^ORE(100.2,PTEVT,10,"B",ORNOW,DA)=""
"RTN","OREVNTX",185,0)
 S ^ORE(100.2,PTEVT,10,DA,0)=ORNOW_U_ACTION_U_$S(ACTION="LP":"",1:$G(DUZ))_U_$G(EVTYPE)
"RTN","OREVNTX",186,0)
 S MVT=+$P($G(^ORE(100.2,PTEVT,1)),U,2)
"RTN","OREVNTX",187,0)
 S:MVT ^ORE(100.2,"ADT",MVT,ORNOW,PTEVT,DA)=""
"RTN","OREVNTX",188,0)
 I $G(SAVE),$G(VAIP(4)) S $P(^ORE(100.2,PTEVT,10,DA,0),U,5,7)=+VAIP(4)_U_+VAIP(8)_U_+VAIP(5)
"RTN","OREVNTX",189,0)
 Q
"RTN","OREVNTX",190,0)
 ;
"RTN","OREVNTX",191,0)
LAPSED(PTEVT)   ; -- Ck if PTEVT has lapsed, if so lapse all orders
"RTN","OREVNTX",192,0)
 N Y,X0,EVT,ENTERED,DAYS S Y=0
"RTN","OREVNTX",193,0)
 I $G(^ORE(100.2,PTEVT,1)) G LPQ ;already terminated
"RTN","OREVNTX",194,0)
 S X0=$G(^ORE(100.2,PTEVT,0)),EVT=+$P(X0,U,2),ENTERED=+$P(X0,U,5)
"RTN","OREVNTX",195,0)
 S:$P($G(^ORD(100.5,EVT,0)),U,12) EVT=+$P(^(0),U,12) ;parent
"RTN","OREVNTX",196,0)
 S DAYS=+$P($G(^ORD(100.5,EVT,0)),U,6) I DAYS<1 G LPQ ;doesn't lapse
"RTN","OREVNTX",197,0)
 I ENTERED>$$FMADD^XLFDT(DT,(0-DAYS)) G LPQ ;not lapsed yet
"RTN","OREVNTX",198,0)
 D LP1(PTEVT) S Y=1 ;lapse orders, event
"RTN","OREVNTX",199,0)
 N J S J=0 F  S J=$O(^ORE(100.2,"DAD",PTEVT,J)) Q:'J  D LP1(J)
"RTN","OREVNTX",200,0)
LPQ Q Y
"RTN","OREVNTX",201,0)
 ;
"RTN","OREVNTX",202,0)
LP1(PTEVT) ; -- Lapse orders, event PTEVT
"RTN","OREVNTX",203,0)
 N X0,PAT,IFN,STS
"RTN","OREVNTX",204,0)
 S X0=$G(^ORE(100.2,PTEVT,0)),PAT=+$P(X0,U)_";DPT("
"RTN","OREVNTX",205,0)
 S IFN=0 F  S IFN=$O(^OR(100,"AEVNT",PAT,PTEVT,IFN)) Q:IFN<1  D
"RTN","OREVNTX",206,0)
 . S STS=$P($G(^OR(100,IFN,3)),U,3) I (STS=10)!(STS=11)!(IFN=+$P(X0,U,4)) D
"RTN","OREVNTX",207,0)
 .. D STATUS^ORCSAVE2(IFN,14)
"RTN","OREVNTX",208,0)
 .. D ALPS^ORCSAVE2(IFN,1,"DELAYED ORDER")
"RTN","OREVNTX",209,0)
 .. S $P(^OR(100,IFN,8,1,0),U,15)="" D:$P(^(0),U,4)=2 SIGN^ORCSAVE2(IFN,"","",5,1)
"RTN","OREVNTX",210,0)
 D DONE(PTEVT),ACTLOG(PTEVT,"LP")
"RTN","OREVNTX",211,0)
 Q
"RTN","OREVNTX1")
0^185^B72373665
"RTN","OREVNTX1",1,0)
OREVNTX1 ; SLC/JLI - Event delayed orders RPC's ;9/19/02  13:35
"RTN","OREVNTX1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141,165,149,243**;Dec 17, 1997;Build 242
"RTN","OREVNTX1",3,0)
 ;
"RTN","OREVNTX1",4,0)
PUTEVNT(ORY,DFN,EVT,ORIFN) ; Save new patient delayed events to file 100.2
"RTN","OREVNTX1",5,0)
 S ORY=$$NEW^OREVNT(DFN,EVT,ORIFN)
"RTN","OREVNTX1",6,0)
 Q
"RTN","OREVNTX1",7,0)
 ;
"RTN","OREVNTX1",8,0)
GTEVT(ORY,PTEVT) ; Return Event infomation based on PTEVT ptr #100.2
"RTN","OREVNTX1",9,0)
 ;EVTID     ptr #100.5
"RTN","OREVNTX1",10,0)
 Q:'+PTEVT
"RTN","OREVNTX1",11,0)
 N EVTID,EVTTYPE,EVTNAME,EVTDISP,EVTDLG,PRTEVT
"RTN","OREVNTX1",12,0)
 S (EVTTYPE,EVTNAME,EVTDISP,PRTEVT)=""
"RTN","OREVNTX1",13,0)
 S EVTDLG=0
"RTN","OREVNTX1",14,0)
 I '$P(^ORE(100.2,+$G(PTEVT),0),U,2) Q
"RTN","OREVNTX1",15,0)
 S EVTID=$$EVT^OREVNTX(PTEVT)
"RTN","OREVNTX1",16,0)
 S PRTEVT=$P(^ORD(100.5,EVTID,0),U,12)
"RTN","OREVNTX1",17,0)
 I PRTEVT S EVTTYPE=$P(^ORD(100.5,PRTEVT,0),U,2)
"RTN","OREVNTX1",18,0)
 E  S EVTTYPE=$P(^ORD(100.5,EVTID,0),U,2)
"RTN","OREVNTX1",19,0)
 I $D(^ORD(100.5,EVTID,0)) D
"RTN","OREVNTX1",20,0)
 . S EVTNAME=$P(^ORD(100.5,EVTID,0),U,1)
"RTN","OREVNTX1",21,0)
 . S EVTDISP=$P(^ORD(100.5,EVTID,0),U,8)
"RTN","OREVNTX1",22,0)
 . S EVTDLG=$P(^ORD(100.5,EVTID,0),U,4)
"RTN","OREVNTX1",23,0)
 S ORY=EVTTYPE_U_EVTID_U_EVTNAME_U_EVTDISP_U_EVTDLG
"RTN","OREVNTX1",24,0)
 Q
"RTN","OREVNTX1",25,0)
GTEVT1(ORY,EVT) ; Return Event information based on EVT ptr #100.5
"RTN","OREVNTX1",26,0)
 ;EVT    ptr #100.5
"RTN","OREVNTX1",27,0)
 Q:'+EVT
"RTN","OREVNTX1",28,0)
 N EVTTYPE,EVTNAME,EVTDISP,EVTDLG,PRTEVT
"RTN","OREVNTX1",29,0)
 S (EVTDLG,PRTEVT)=0
"RTN","OREVNTX1",30,0)
 S PRTEVT=$P(^ORD(100.5,+EVT,0),U,12)
"RTN","OREVNTX1",31,0)
 I PRTEVT>0 S EVTTYPE=$P(^ORD(100.5,PRTEVT,0),U,2)
"RTN","OREVNTX1",32,0)
 E  S EVTTYPE=$P(^ORD(100.5,+EVT,0),U,2)
"RTN","OREVNTX1",33,0)
 S EVTNAME=$P($G(^ORD(100.5,+EVT,0)),U,1)
"RTN","OREVNTX1",34,0)
 S EVTDISP=$P($G(^ORD(100.5,+EVT,0)),U,8)
"RTN","OREVNTX1",35,0)
 S EVTDLG=$P($G(^ORD(100.5,+EVT,0)),U,4)
"RTN","OREVNTX1",36,0)
 S ORY=EVTTYPE_U_EVT_U_EVTNAME_U_EVTDISP_U_EVTDLG
"RTN","OREVNTX1",37,0)
 Q
"RTN","OREVNTX1",38,0)
 ;
"RTN","OREVNTX1",39,0)
EVT(ORY,PTEVT) ; Return Event ptr #100.5, given PTEVT ptr #100.2
"RTN","OREVNTX1",40,0)
 Q:'+PTEVT
"RTN","OREVNTX1",41,0)
 S ORY=$$EVT^OREVNTX(PTEVT)
"RTN","OREVNTX1",42,0)
 Q
"RTN","OREVNTX1",43,0)
 ; 
"RTN","OREVNTX1",44,0)
EXISTS(ORY,DFN,EVT) ;Returns PtEvtID ptr #100.2 if patient already has delayed orders
"RTN","OREVNTX1",45,0)
 I '+EVT S ORY=0 Q
"RTN","OREVNTX1",46,0)
 N PTEVT S (PTEVT,ORY)=0
"RTN","OREVNTX1",47,0)
 S PTEVT=$O(^ORE(100.2,"AE",+DFN,+EVT,PTEVT))
"RTN","OREVNTX1",48,0)
 I PTEVT>0 S ORY=PTEVT
"RTN","OREVNTX1",49,0)
 Q
"RTN","OREVNTX1",50,0)
 ;
"RTN","OREVNTX1",51,0)
TYPEXT(ORY,DFN,EVT) ; does EVT has delayed orders?
"RTN","OREVNTX1",52,0)
 ; 1 if Patient DFN has delayed orders for EVT
"RTN","OREVNTX1",53,0)
 ; 2 if Parent/Sibling event has delayed orders
"RTN","OREVNTX1",54,0)
 ; 0 if No delayed orders for EVT
"RTN","OREVNTX1",55,0)
 Q:'+EVT
"RTN","OREVNTX1",56,0)
 S ORY=$$EXISTS^OREVNTX(DFN,EVT)
"RTN","OREVNTX1",57,0)
 Q
"RTN","OREVNTX1",58,0)
 ;
"RTN","OREVNTX1",59,0)
MATCH(ORY,DFN,EVT) ;If Pt's current data match selected event
"RTN","OREVNTX1",60,0)
 ;DFN: patient DFN
"RTN","OREVNTX1",61,0)
 ;EVT: ptr to #100.5
"RTN","OREVNTX1",62,0)
 S ORY=0
"RTN","OREVNTX1",63,0)
 Q:('+DFN)!('+EVT)
"RTN","OREVNTX1",64,0)
 S ORY=$$MATCH^OREVNT(DFN,EVT)
"RTN","OREVNTX1",65,0)
 N TS,TSNM
"RTN","OREVNTX1",66,0)
 S TS=$S($G(ORTS):+ORTS,1:+$G(^DPT(DFN,.103)))
"RTN","OREVNTX1",67,0)
 S TSNM=$P($G(^DIC(45.7,TS,0)),U)
"RTN","OREVNTX1",68,0)
 S:ORY ORY=ORY_U_TSNM
"RTN","OREVNTX1",69,0)
 Q
"RTN","OREVNTX1",70,0)
 ;
"RTN","OREVNTX1",71,0)
NAME(ORY,PTEVT) ; Return Event name from #100.5, given PTEVT ptr #100.2
"RTN","OREVNTX1",72,0)
 I PTEVT'>0 S ORY="" Q
"RTN","OREVNTX1",73,0)
 S ORY=$$NAME^OREVNTX(PTEVT)
"RTN","OREVNTX1",74,0)
 Q
"RTN","OREVNTX1",75,0)
 ;
"RTN","OREVNTX1",76,0)
DIV(ORY,PTEVT) ; Return division for PTEVT ptr #100.2
"RTN","OREVNTX1",77,0)
 Q:'+PTEVT
"RTN","OREVNTX1",78,0)
 S ORY=$$DIV^OREVNTX(PTEVT)
"RTN","OREVNTX1",79,0)
 Q
"RTN","OREVNTX1",80,0)
 ;
"RTN","OREVNTX1",81,0)
DIV1(ORY,EVT) ; Return division for EVT ptr #100.5
"RTN","OREVNTX1",82,0)
 Q:'+EVT
"RTN","OREVNTX1",83,0)
 S ORY=+$P($G(^ORD(100.5,+EVT,0)),U,3) S:ORY<1 ORY=+$G(DUZ(2))
"RTN","OREVNTX1",84,0)
 Q
"RTN","OREVNTX1",85,0)
 ;
"RTN","OREVNTX1",86,0)
LOC(ORY,PTEVT) ; Return default hospital location ^SC( for PTEVT ptr #100.2
"RTN","OREVNTX1",87,0)
 Q:'+PTEVT
"RTN","OREVNTX1",88,0)
 S ORY=$$LOC^OREVNTX(PTEVT)
"RTN","OREVNTX1",89,0)
 S ORY=+ORY
"RTN","OREVNTX1",90,0)
 Q
"RTN","OREVNTX1",91,0)
 ;
"RTN","OREVNTX1",92,0)
LOC1(ORY,EVT) ; Return default hospital location ^SC( for EVT ptr #100.5
"RTN","OREVNTX1",93,0)
 Q:'+EVT
"RTN","OREVNTX1",94,0)
 S ORY=+$P($G(^ORD(100.5,+EVT,0)),U,9) S:ORY<1 ORY=+$G(ORL)
"RTN","OREVNTX1",95,0)
 Q
"RTN","OREVNTX1",96,0)
 ;
"RTN","OREVNTX1",97,0)
CHGEVT(ORY,NEWEVT,ORIDS) ; Change order's event
"RTN","OREVNTX1",98,0)
 N ORI
"RTN","OREVNTX1",99,0)
 S ORI=0
"RTN","OREVNTX1",100,0)
 F  S ORI=$O(ORIDS(ORI)) Q:'+ORI  D
"RTN","OREVNTX1",101,0)
 . D CHGEVT^OREVNTX(+$G(ORIDS(ORI)),NEWEVT)
"RTN","OREVNTX1",102,0)
 Q
"RTN","OREVNTX1",103,0)
 ;
"RTN","OREVNTX1",104,0)
EMPTY(ORY,PTEVT) ; Return 1 if PTEVT doesn't have any orders
"RTN","OREVNTX1",105,0)
 Q:'+PTEVT
"RTN","OREVNTX1",106,0)
 S ORY=$$EMPTY^OREVNTX(PTEVT)
"RTN","OREVNTX1",107,0)
 Q
"RTN","OREVNTX1",108,0)
 ;
"RTN","OREVNTX1",109,0)
DELPTEVT(ORY,PTEVT) ; Delete Patient Event in #100.2
"RTN","OREVNTX1",110,0)
 Q:'+PTEVT
"RTN","OREVNTX1",111,0)
 D CANCEL^OREVNTX(PTEVT)
"RTN","OREVNTX1",112,0)
 Q
"RTN","OREVNTX1",113,0)
 ;
"RTN","OREVNTX1",114,0)
UPDTOR(ORY,PTIFN,ORIFN,PTEVT) ; If delayed order was DCed, then update the EVENT and "AEVNT"
"RTN","OREVNTX1",115,0)
 Q  ;Don't ever need to do this!
"RTN","OREVNTX1",116,0)
CURSPE(ORY,PTIFN) ; Return current treating specialty
"RTN","OREVNTX1",117,0)
 Q:'PTIFN
"RTN","OREVNTX1",118,0)
 N SPEC S SPEC=$$PT^DGPMOBS(PTIFN),ORY=""
"RTN","OREVNTX1",119,0)
 I SPEC'<0 S ORY=$P(SPEC,U,3)_U_$P(SPEC,U,2)_U_$P(SPEC,U) ;name^ien^obs flag
"RTN","OREVNTX1",120,0)
 Q
"RTN","OREVNTX1",121,0)
DFLTEVT(ORY,PVIFN) ; Return default release event based on provider IFN
"RTN","OREVNTX1",122,0)
 N CMEVTLST,IDX
"RTN","OREVNTX1",123,0)
 S CMEVTLST="",IDX=0
"RTN","OREVNTX1",124,0)
 D GETLST^OREV3(.CMEVTLST)
"RTN","OREVNTX1",125,0)
 F  S IDX=$O(CMEVTLST(IDX)) Q:'IDX  D
"RTN","OREVNTX1",126,0)
 . I $P($G(CMEVTLST(IDX)),U,2) S ORY=$P($G(CMEVTLST(IDX)),U) Q
"RTN","OREVNTX1",127,0)
 Q
"RTN","OREVNTX1",128,0)
CMEVTS(ORY,CLOC) ;Return common event list
"RTN","OREVNTX1",129,0)
 N IDX,X0,X,LOC
"RTN","OREVNTX1",130,0)
 S:CLOC>0 LOC=CLOC
"RTN","OREVNTX1",131,0)
 S IDX=0,ORY=""
"RTN","OREVNTX1",132,0)
 D GETLST^OREV3(.ORY)
"RTN","OREVNTX1",133,0)
 F  S IDX=$O(ORY(IDX)) Q:'IDX  D
"RTN","OREVNTX1",134,0)
 . S X0=""
"RTN","OREVNTX1",135,0)
 . S:$L($G(^ORD(100.5,+ORY(IDX),0))) X0=$G(^(0))
"RTN","OREVNTX1",136,0)
 . I '$L($P(X0,U,2)) D
"RTN","OREVNTX1",137,0)
 .. S X=$P(X0,U,12) S:X $P(X0,U,2)=$P($G(^ORD(100.5,+X,0)),U,2)
"RTN","OREVNTX1",138,0)
 . S:$L(X0) ORY(IDX)=+ORY(IDX)_U_X0
"RTN","OREVNTX1",139,0)
 Q
"RTN","OREVNTX1",140,0)
 ;
"RTN","OREVNTX1",141,0)
DELDFLT(ORY,PVIFN) ; Delete default release event
"RTN","OREVNTX1",142,0)
 Q:'PVIFN
"RTN","OREVNTX1",143,0)
 N ORERR
"RTN","OREVNTX1",144,0)
 S ORERR=""
"RTN","OREVNTX1",145,0)
 D DEL^XPAR(PVIFN_";VA(200,","OREVNT DEFAULT",1,.ORERR)
"RTN","OREVNTX1",146,0)
 Q
"RTN","OREVNTX1",147,0)
WRLSTED(LST,LOC,EVTID) ; Return list of dialogs for writing event delayed orders
"RTN","OREVNTX1",148,0)
 ; .Y(n): DlgName^ListBox Text
"RTN","OREVNTX1",149,0)
WRLST1 N ANENT
"RTN","OREVNTX1",150,0)
 S LOC=+$G(LOC)_";SC(" I 'LOC S LOC=""
"RTN","OREVNTX1",151,0)
 S ANENT="ALL^USR.`"_DUZ_"^"_LOC_$S($G(^VA(200,DUZ,5)):"^SRV.`"_+$G(^(5)),1:"")
"RTN","OREVNTX1",152,0)
 N MNU,SEQ,IEN,ITM,TXT,FID,DGRP,X,TYP
"RTN","OREVNTX1",153,0)
 S MNU=$$GET^XPAR(ANENT,"ORWDX WRITE ORDERS EVENT LIST",EVTID,"I") Q:'MNU
"RTN","OREVNTX1",154,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,MNU,10,"B",SEQ)) Q:'SEQ  D
"RTN","OREVNTX1",155,0)
 . S IEN=0 F  S IEN=$O(^ORD(101.41,MNU,10,"B",SEQ,IEN)) Q:'IEN  D
"RTN","OREVNTX1",156,0)
 . . S X=$G(^ORD(101.41,MNU,10,IEN,0)),ITM=+$P(X,U,2),TXT=$P(X,U,4)
"RTN","OREVNTX1",157,0)
 . . S X=$G(^ORD(101.41,ITM,5)),FID=+$P(X,U,5)
"RTN","OREVNTX1",158,0)
 . . S X=$G(^ORD(101.41,ITM,0)),TYP=$P(X,U,4),DGRP=+$P(X,U,5)
"RTN","OREVNTX1",159,0)
 . . S:'$L(TXT) TXT=$P(X,U,2)
"RTN","OREVNTX1",160,0)
 . . I TYP="M" S:'FID FID=1001
"RTN","OREVNTX1",161,0)
 . . S LST(SEQ)=ITM_";"_FID_";"_DGRP_";"_TYP_U_TXT
"RTN","OREVNTX1",162,0)
 Q
"RTN","OREVNTX1",163,0)
 ;
"RTN","OREVNTX1",164,0)
GETDLG(LST,DLGID) ; Return dialog infomation based on the DLGID
"RTN","OREVNTX1",165,0)
 N DIEN,DFID,DTXT,DTYP,DGRP,X0,X5
"RTN","OREVNTX1",166,0)
 S DLGID=+DLGID
"RTN","OREVNTX1",167,0)
 Q:'DLGID
"RTN","OREVNTX1",168,0)
 S X0=^ORD(101.41,DLGID,0),X5=$G(^(5))
"RTN","OREVNTX1",169,0)
 S DGRP=+$P(X0,U,5),DFID=+$P(X5,U,5),DTXT=$P(X5,U,4),DTYP=$P(X0,U,4)
"RTN","OREVNTX1",170,0)
    S:'$L(DTXT) DTXT=$P(X0,U,2)
"RTN","OREVNTX1",171,0)
 I $P(X0,U,4)="M" S:'DFID DFID=1001
"RTN","OREVNTX1",172,0)
 S LST=DLGID_";"_DFID_";"_DGRP_";"_DTYP_U_DTXT
"RTN","OREVNTX1",173,0)
 Q
"RTN","OREVNTX1",174,0)
DONE(LST,PTEVT) ; Terminate PTEvt
"RTN","OREVNTX1",175,0)
 Q:'PTEVT
"RTN","OREVNTX1",176,0)
 D DONE^OREVNTX(PTEVT)
"RTN","OREVNTX1",177,0)
 D ACTLOG^OREVNTX(PTEVT,"MN")
"RTN","OREVNTX1",178,0)
 Q
"RTN","OREVNTX1",179,0)
SETDFLT(ORY,EVT) ;Set personal default event
"RTN","OREVNTX1",180,0)
 N ERR,VAL S ERR=""
"RTN","OREVNTX1",181,0)
 Q:'$D(^ORD(100.5,EVT,0))
"RTN","OREVNTX1",182,0)
 S VAL=$P(^ORD(100.5,EVT,0),U)
"RTN","OREVNTX1",183,0)
 D EN^XPAR(DUZ_";VA(200,","OREVNT DEFAULT",1,VAL,ERR)
"RTN","OREVNTX1",184,0)
 S ORY=ERR
"RTN","OREVNTX1",185,0)
 Q
"RTN","OREVNTX1",186,0)
CPACT(ORY,EVT) ; Return True/False to display active orders for copy
"RTN","OREVNTX1",187,0)
 ; EVT ptr to #100.5
"RTN","OREVNTX1",188,0)
 Q:'EVT
"RTN","OREVNTX1",189,0)
 S ORY=0
"RTN","OREVNTX1",190,0)
 Q:'$D(^ORD(100.5,EVT,0))
"RTN","OREVNTX1",191,0)
 S ORY=$P(^ORD(100.5,EVT,0),U,11)
"RTN","OREVNTX1",192,0)
 Q
"RTN","OREVNTX1",193,0)
PRMPTID(ORY,PRTNM) ;Return event prompt IEN for OR GTX EVENT
"RTN","OREVNTX1",194,0)
 S:$D(^ORD(101.41,"B","OR GTX EVENT")) ORY=$O(^("OR GTX EVENT",0))
"RTN","OREVNTX1",195,0)
 Q
"RTN","OREVNTX1",196,0)
ISDCOD(ORY,ORIFN) ;True: the order need to be filtered out
"RTN","OREVNTX1",197,0)
 N PAS,X3,X0,ORGRPLST,THEGRP,IDX,ODGRP
"RTN","OREVNTX1",198,0)
 S (ORY,IDX)=0
"RTN","OREVNTX1",199,0)
 Q:'$D(^OR(100,+ORIFN,0))
"RTN","OREVNTX1",200,0)
 S X0=$G(^OR(100,+ORIFN,0))
"RTN","OREVNTX1",201,0)
 S ODGRP=$P(X0,U,11)
"RTN","OREVNTX1",202,0)
 D GETLST^XPAR(.ORGRPLST,"ALL","OREVNT EXCLUDE DGRP")
"RTN","OREVNTX1",203,0)
 F  S IDX=$O(ORGRPLST(IDX)) Q:'IDX!ORY  D
"RTN","OREVNTX1",204,0)
 . S THEGRP=$P($G(ORGRPLST(IDX)),U,2)
"RTN","OREVNTX1",205,0)
 . I $$GRPCHK(THEGRP,ODGRP) S ORY=1
"RTN","OREVNTX1",206,0)
 I ORY Q
"RTN","OREVNTX1",207,0)
 S PAS=";1;"
"RTN","OREVNTX1",208,0)
 S:$D(^OR(100,+ORIFN,3)) X3=^OR(100,+ORIFN,3)
"RTN","OREVNTX1",209,0)
 S:(PAS'[(";"_$P(X3,U,3)_";")) ORY=0
"RTN","OREVNTX1",210,0)
 Q
"RTN","OREVNTX1",211,0)
DEFLTS(ORY,EVTID) ;Return default specialty for EVTID(#100.5)
"RTN","OREVNTX1",212,0)
 Q:'+EVTID
"RTN","OREVNTX1",213,0)
 N PRTEVT
"RTN","OREVNTX1",214,0)
 S PRTEVT=0
"RTN","OREVNTX1",215,0)
 S PRTEVT=$P(^ORD(100.5,+EVTID,0),U,12)
"RTN","OREVNTX1",216,0)
 I PRTEVT>0 S EVTID=PRTEVT
"RTN","OREVNTX1",217,0)
 S ORY=$$DEFTS^ORCDADT(EVTID)
"RTN","OREVNTX1",218,0)
 Q
"RTN","OREVNTX1",219,0)
 ;
"RTN","OREVNTX1",220,0)
MULTS(ORY,EVTID) ;Return specialty list for the EVTID(#100.5)
"RTN","OREVNTX1",221,0)
 Q:'+EVTID
"RTN","OREVNTX1",222,0)
 N I,CNT,X,Y S (I,CNT)=0
"RTN","OREVNTX1",223,0)
 N PRTEVT
"RTN","OREVNTX1",224,0)
 S PRTEVT=0
"RTN","OREVNTX1",225,0)
 S PRTEVT=$P(^ORD(100.5,+EVTID,0),U,12)
"RTN","OREVNTX1",226,0)
 I PRTEVT>0 S EVTID=PRTEVT
"RTN","OREVNTX1",227,0)
 F  S I=$O(^ORD(100.5,+$G(EVTID),"TS",I)) Q:I<1  S X=+$G(^(I,0)) D
"RTN","OREVNTX1",228,0)
 . S Y=$$GET1^DIQ(45.7,X_",",.01)
"RTN","OREVNTX1",229,0)
 . S CNT=CNT+1,ORY(CNT)=X_U_Y
"RTN","OREVNTX1",230,0)
 Q
"RTN","OREVNTX1",231,0)
 ;
"RTN","OREVNTX1",232,0)
PRTIDS(ORY,IDS) ;Return some prompt ids from #101.41
"RTN","OREVNTX1",233,0)
 ; treating specialty Id^attending provider id
"RTN","OREVNTX1",234,0)
 N IDX,ORTS,ORATT
"RTN","OREVNTX1",235,0)
 S (ORY,ORTS,ORATT)=""
"RTN","OREVNTX1",236,0)
 S IDX=$O(^ORD(101.41,"B","OR GTX TREATING SPECIALTY",0))
"RTN","OREVNTX1",237,0)
 S:$D(^ORD(101.41,IDX,1)) ORTS=$P($G(^ORD(101.41,IDX,1)),U,2,3)
"RTN","OREVNTX1",238,0)
 S IDX=$O(^ORD(101.41,"B","OR GTX PROVIDER",0))
"RTN","OREVNTX1",239,0)
 S:$D(^ORD(101.41,IDX,1)) ORATT=$P($G(^ORD(101.41,IDX,1)),U,2,3)
"RTN","OREVNTX1",240,0)
 S ORY=ORTS_"~"_ORATT
"RTN","OREVNTX1",241,0)
 Q
"RTN","OREVNTX1",242,0)
 ;
"RTN","OREVNTX1",243,0)
DFLTDLG(ORY,EVTID) ;Return event default dialog IEN
"RTN","OREVNTX1",244,0)
 S ORY=0
"RTN","OREVNTX1",245,0)
 Q:'$D(^ORD(100.5,+EVTID,0))
"RTN","OREVNTX1",246,0)
 S ORY=$P(^ORD(100.5,+EVTID,0),U,4)
"RTN","OREVNTX1",247,0)
 Q
"RTN","OREVNTX1",248,0)
AUTHMREL(ORY,USER) ;1: user can manual release delayed orders 0: can't
"RTN","OREVNTX1",249,0)
 S ORY=$$CANREL^OREV3
"RTN","OREVNTX1",250,0)
 Q
"RTN","OREVNTX1",251,0)
HAVEPRT(ORY,PTEVT) ;return parent patient event from #100.2
"RTN","OREVNTX1",252,0)
 Q:'+PTEVT
"RTN","OREVNTX1",253,0)
 S ORY=""
"RTN","OREVNTX1",254,0)
 S:$L($G(^ORE(100.2,PTEVT,1))) ORY=$P(^(1),U,5)
"RTN","OREVNTX1",255,0)
 Q
"RTN","OREVNTX1",256,0)
GRPCHK(DG,AGRP) ;If an order's group belong to DG group
"RTN","OREVNTX1",257,0)
 N RST
"RTN","OREVNTX1",258,0)
 S RST=0
"RTN","OREVNTX1",259,0)
 N ORGRP
"RTN","OREVNTX1",260,0)
 D GRP^ORQ1(DG)
"RTN","OREVNTX1",261,0)
 S RST=$S($D(ORGRP(AGRP)):1,1:0)
"RTN","OREVNTX1",262,0)
 Q RST
"RTN","OREVNTX1",263,0)
ODPTEVID(ORY,ORID) ;Return PtEvtID based on the ORID
"RTN","OREVNTX1",264,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","OREVNTX1",265,0)
 S ORY=$P($G(^OR(100,+ORID,0)),U,17)
"RTN","OREVNTX1",266,0)
 Q
"RTN","OREVNTX1",267,0)
COMP(ORY,PTEVT) ;Return 1 or 0 if PTEVT completed or not
"RTN","OREVNTX1",268,0)
 Q:'+PTEVT
"RTN","OREVNTX1",269,0)
 S ORY=$$COMP^OREVNTX(+PTEVT)
"RTN","OREVNTX1",270,0)
 Q
"RTN","OREVNTX1",271,0)
ISHDORD(ORY,ORID) ;Return 1 if it's on-hold med order
"RTN","OREVNTX1",272,0)
 Q:'+ORID
"RTN","OREVNTX1",273,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","OREVNTX1",274,0)
 N STS,HDSTS,ODGP,INPT,OUPT,MEDS,IVMD
"RTN","OREVNTX1",275,0)
 S HDSTS=$O(^ORD(100.01,"B","HOLD",0))
"RTN","OREVNTX1",276,0)
 S STS=$P($G(^OR(100,+ORID,3)),U,3)
"RTN","OREVNTX1",277,0)
 S INPT=$O(^ORD(100.98,"B","UD RX",0))
"RTN","OREVNTX1",278,0)
 S OUPT=$O(^ORD(100.98,"B","O RX",0))
"RTN","OREVNTX1",279,0)
 S MEDS=$O(^ORD(100.98,"B","RX",0))
"RTN","OREVNTX1",280,0)
 S IVMD=$O(^ORD(100.98,"B","IV RX",0))
"RTN","OREVNTX1",281,0)
 S ODGP=$P(^OR(100,+ORID,0),U,11)
"RTN","OREVNTX1",282,0)
 I (U_INPT_U_OUPT_U_MEDS_U_IVMD_U[U_ODGP_U),(HDSTS=STS) S ORY=1
"RTN","OREVNTX1",283,0)
 Q
"RTN","OREVNTX1",284,0)
ISPASS(ORY,PTEVTID,EVTTYPE) ;Return 1 if it's a pass event
"RTN","OREVNTX1",285,0)
 S ORY=$$EVT^OREVNTX(PTEVTID)
"RTN","OREVNTX1",286,0)
 S ORY=$P($G(^ORD(100.5,+ORY,0)),U,7)
"RTN","OREVNTX1",287,0)
 I EVTTYPE="T",ORY,ORY<4 S ORY=1
"RTN","OREVNTX1",288,0)
 E  S ORY=0
"RTN","OREVNTX1",289,0)
 Q
"RTN","OREVNTX1",290,0)
ISPASS1(ORY,EVTID,EVTTYPE) ;Return 1 if it's a pass event
"RTN","OREVNTX1",291,0)
 S ORY=$P($G(^ORD(100.5,+EVTID,0)),U,7)
"RTN","OREVNTX1",292,0)
 I EVTTYPE="T",ORY,ORY<4 S ORY=1
"RTN","OREVNTX1",293,0)
 E  S ORY=0
"RTN","OREVNTX1",294,0)
 Q
"RTN","OREVNTX1",295,0)
DLGIEN(ORY,DLGNAME) ;Return Order Dialog IEN based on name
"RTN","OREVNTX1",296,0)
 Q:'$D(^ORD(101.41,"B",DLGNAME))
"RTN","OREVNTX1",297,0)
 S ORY=$O(^ORD(101.41,"B",DLGNAME,0))
"RTN","OREVNTX1",298,0)
 Q
"RTN","OREVNTX1",299,0)
GETSTS(ORY,ORDID) ;Return Order status
"RTN","OREVNTX1",300,0)
 Q:'+ORDID
"RTN","OREVNTX1",301,0)
 Q:'$D(^OR(100,+ORDID,0))
"RTN","OREVNTX1",302,0)
 S ORY=$P($G(^OR(100,+ORDID,3)),U,3)
"RTN","OREVNTX1",303,0)
 Q
"RTN","ORHLESC")
0^74^B6778413
"RTN","ORHLESC",1,0)
ORHLESC ;SLC/JMH - HL7 UTILITY ;11:26 AM  2 Apr 2001
"RTN","ORHLESC",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORHLESC",3,0)
 ;
"RTN","ORHLESC",4,0)
 ; VAL = COMPONENT_REPETITION_ESCAPE_SUBCOMPONENT_FIELD
"RTN","ORHLESC",5,0)
 ;
"RTN","ORHLESC",6,0)
ESC(ORSTR,VAL) ; REPLACE HL7 DELIMITER CHAR
"RTN","ORHLESC",7,0)
 N SEPC,SEPR,SEPS,SEPF,SEPE,REPSEPC,REPSEPR,REPSEPS,REPSEPF,REPSEPE,I,HL7DEL
"RTN","ORHLESC",8,0)
 I '$L($G(VAL)) S VAL="~|\&^"
"RTN","ORHLESC",9,0)
 I $G(ORSTR)="" Q ""
"RTN","ORHLESC",10,0)
 I $TR(ORSTR,$G(VAL))=ORSTR Q ORSTR
"RTN","ORHLESC",11,0)
 N X,Y,Z,RES
"RTN","ORHLESC",12,0)
 S SEPE=$E(VAL,3),REPSEPE=SEPE_"E"_SEPE
"RTN","ORHLESC",13,0)
 S SEPC=$E(VAL,1),REPSEPC=SEPE_"S"_SEPE
"RTN","ORHLESC",14,0)
 S SEPR=$E(VAL,2),REPSEPR=SEPE_"R"_SEPE
"RTN","ORHLESC",15,0)
 S SEPS=$E(VAL,4),REPSEPS=SEPE_"T"_SEPE
"RTN","ORHLESC",16,0)
 S SEPF=$E(VAL,5),REPSEPF=SEPE_"F"_SEPE
"RTN","ORHLESC",17,0)
 S RES=ORSTR
"RTN","ORHLESC",18,0)
 I $F(ORSTR,SEPE) S X=RES D
"RTN","ORHLESC",19,0)
 . S Z=$P(X,SEPE,2,9999),Y=$P(X,SEPE)_REPSEPE_Z,RES=Y,X=Z I '$F(Z,SEPE) Q
"RTN","ORHLESC",20,0)
 . F I=2:1 S Z=$P(X,SEPE,2,9999),Y=$P(RES,REPSEPE,1,I-1)_REPSEPE_$P(X,SEPE)_REPSEPE_Z,RES=Y,X=Z I '$F(Z,SEPE) Q
"RTN","ORHLESC",21,0)
 ;
"RTN","ORHLESC",22,0)
 I $F(RES,SEPC) F I=1:1 S Y=$P(RES,SEPC)_REPSEPC_$P(RES,SEPC,2,9999),RES=Y I '$F(RES,SEPC) Q
"RTN","ORHLESC",23,0)
 I $F(RES,SEPR) F I=1:1 S Y=$P(RES,SEPR)_REPSEPR_$P(RES,SEPR,2,9999),RES=Y I '$F(RES,SEPR) Q
"RTN","ORHLESC",24,0)
 I $F(RES,SEPS) F I=1:1 S Y=$P(RES,SEPS)_REPSEPS_$P(RES,SEPS,2,9999),RES=Y I '$F(RES,SEPS) Q
"RTN","ORHLESC",25,0)
 I $F(RES,SEPF) F I=1:1 S Y=$P(RES,SEPF)_REPSEPF_$P(RES,SEPF,2,9999),RES=Y I '$F(RES,SEPF) Q
"RTN","ORHLESC",26,0)
 Q RES
"RTN","ORHLESC",27,0)
UNESC(ORSTR,VAL) ;
"RTN","ORHLESC",28,0)
 ; Remove Escape Characters from HL7 Message Text
"RTN","ORHLESC",29,0)
 ; Escape Sequence codes:
"RTN","ORHLESC",30,0)
 ;         F = field separator (ORFS)
"RTN","ORHLESC",31,0)
 ;         S = component separator (ORCS)
"RTN","ORHLESC",32,0)
 ;         R = repetition separator (ORRS)
"RTN","ORHLESC",33,0)
 ;         E = escape character (ORES)
"RTN","ORHLESC",34,0)
 ;         T = subcomponent separator (ORSS)
"RTN","ORHLESC",35,0)
 N ORFS,ORCS,ORRS,ORES,ORSS
"RTN","ORHLESC",36,0)
 I '$L($G(VAL)) S VAL="~|\&^"
"RTN","ORHLESC",37,0)
 S ORFS=$E(VAL,5)
"RTN","ORHLESC",38,0)
 S ORCS=$E(VAL,1)
"RTN","ORHLESC",39,0)
 S ORRS=$E(VAL,2)
"RTN","ORHLESC",40,0)
 S ORES=$E(VAL,3)
"RTN","ORHLESC",41,0)
 S ORSS=$E(VAL,4)
"RTN","ORHLESC",42,0)
 N ORCHR,ORREP,I1,I2,J1,J2,K,VALUE
"RTN","ORHLESC",43,0)
 F ORCHR="F","S","R","E","T" S ORREP(ORES_ORCHR_ORES)=$S(ORCHR="F":ORFS,ORCHR="S":ORCS,ORCHR="R":ORRS,ORCHR="E":ORES,ORCHR="T":ORSS)
"RTN","ORHLESC",44,0)
 S ORSTR=$$REPLACE^XLFSTR(ORSTR,.ORREP)
"RTN","ORHLESC",45,0)
 F  S I1=$P(ORSTR,ORES_"X") Q:$L(I1)=$L(ORSTR)  D
"RTN","ORHLESC",46,0)
 .S I2=$P(ORSTR,ORES_"X",2,99)
"RTN","ORHLESC",47,0)
 .S J1=$P(I2,ORES) Q:'$L(J1)
"RTN","ORHLESC",48,0)
 .S J2=$P(I2,ORES,2,99)
"RTN","ORHLESC",49,0)
 .S VALUE=$$BASE^XLFUTL($$UP^XLFSTR(J1),16,10)
"RTN","ORHLESC",50,0)
 .S K=$S(VALUE>255:"?",VALUE<32!(VALUE>127&(VALUE<160)):"",1:$C(VALUE))
"RTN","ORHLESC",51,0)
 .S ORSTR=I1_K_J2
"RTN","ORHLESC",52,0)
 Q ORSTR
"RTN","ORHLESC",53,0)
REPLACE(X,Y,Z) ;
"RTN","ORHLESC",54,0)
 ; X is initial string
"RTN","ORHLESC",55,0)
 ; Y is string to be replaced
"RTN","ORHLESC",56,0)
 ; Z is string to replace
"RTN","ORHLESC",57,0)
 N RET
"RTN","ORHLESC",58,0)
 I X'[Y Q X
"RTN","ORHLESC",59,0)
 S I=1,RET=$P(X,Y) F  S I=I+1,RET=RET_Z_$P(X,Y,I) Q:I=$L(X,Y)
"RTN","ORHLESC",60,0)
 Q RET
"RTN","ORIMO")
0^149^B2288142
"RTN","ORIMO",1,0)
ORIMO ;SLC/JDL - Inpatient medication on outpatient. ; 02/12/2007
"RTN","ORIMO",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**187,190,195,215,243**;Dec 17, 1997;Build 242
"RTN","ORIMO",3,0)
IMOLOC(ORY,ORLOC,ORDFN) ;ORY>=0: LOC is an IMO authorized location
"RTN","ORIMO",4,0)
 S ORY=-1
"RTN","ORIMO",5,0)
 N PACH
"RTN","ORIMO",6,0)
 S PACH=$$PATCH^XPDUTL("PSJ*5.0*111")
"RTN","ORIMO",7,0)
 Q:'PACH
"RTN","ORIMO",8,0)
 I $L($TEXT(SDIMO^SDAMA203)) D
"RTN","ORIMO",9,0)
 . ;#DBIA 4133
"RTN","ORIMO",10,0)
 . S ORY=$$SDIMO^SDAMA203(ORLOC,ORDFN)
"RTN","ORIMO",11,0)
 . ;if RSA returns an error then check against Clinic Loc.
"RTN","ORIMO",12,0)
 . I ORY=-3 D
"RTN","ORIMO",13,0)
 . .I $P($G(^SC(ORLOC,0)),U,3)'="C" Q
"RTN","ORIMO",14,0)
 . .I $D(^SC("AE",1,ORLOC))=1 S ORY=1
"RTN","ORIMO",15,0)
 . K SDIMO(1)
"RTN","ORIMO",16,0)
 Q
"RTN","ORIMO",17,0)
 ; 
"RTN","ORIMO",18,0)
IMOOD(ORY,ORDERID) ;Is it an IMO order?
"RTN","ORIMO",19,0)
 Q:'$D(^OR(100,+ORDERID,0))
"RTN","ORIMO",20,0)
 N PIMO,DGRP,IMOGRP,ISIMO
"RTN","ORIMO",21,0)
 S (PIMO,DGRP,ISIMO)=0
"RTN","ORIMO",22,0)
 I $P($G(^OR(100,+ORDERID,0)),U,18)>0 S PIMO=1
"RTN","ORIMO",23,0)
 S DGRP=$P($G(^OR(100,+ORDERID,0)),U,11)
"RTN","ORIMO",24,0)
 S IMOGRP=$O(^ORD(100.98,"B","CLINIC ORDERS",""))
"RTN","ORIMO",25,0)
 I DGRP=IMOGRP S ISIMO=1
"RTN","ORIMO",26,0)
 I PIMO,ISIMO S ORY=1
"RTN","ORIMO",27,0)
 Q
"RTN","ORIMO",28,0)
 ;
"RTN","ORIMO",29,0)
ISCLOC(ORY,ALOC) ;Is it a clinical location
"RTN","ORIMO",30,0)
 S ORY=0
"RTN","ORIMO",31,0)
 Q:'$D(^SC(+ALOC,0))
"RTN","ORIMO",32,0)
 I $P(^SC(+ALOC,0),U,3)="C" S ORY=1
"RTN","ORIMO",33,0)
 Q
"RTN","ORIMO",34,0)
ISIVQO(ORY,DLGID) ;Is it an IV quick order
"RTN","ORIMO",35,0)
 S ORY=0
"RTN","ORIMO",36,0)
 Q:'$D(^ORD(101.41,DLGID,0))
"RTN","ORIMO",37,0)
 N IVGRP,DLGTYP,DLGGRP
"RTN","ORIMO",38,0)
 S IVGRP=$O(^ORD(100.98,"B","IV RX",0))
"RTN","ORIMO",39,0)
 S DLGTYP=$P($G(^ORD(101.41,DLGID,0)),U,4)
"RTN","ORIMO",40,0)
 S DLGGRP=$P($G(^ORD(101.41,DLGID,0)),U,5)
"RTN","ORIMO",41,0)
 I (DLGTYP="Q"),(DLGGRP=IVGRP) S ORY=1
"RTN","ORIMO",42,0)
 Q
"RTN","ORKCHK")
0^207^B41864853
"RTN","ORKCHK",1,0)
ORKCHK ; slc/CLA - Main routine called by OE/RR to initiate order checks ; 9/21/07 11:54am
"RTN","ORKCHK",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**6,32,94,105,123,232,267,243**;Dec 17, 1997;Build 242
"RTN","ORKCHK",3,0)
EN(ORKY,ORKDFN,ORKA,ORKMODE) ;initiate order checking
"RTN","ORKCHK",4,0)
 ;ORKY: array of returned msgs in format: ornum^orderchk ien^clin danger^msg
"RTN","ORKCHK",5,0)
 ;ORKDFN: patient dfn
"RTN","ORKCHK",6,0)
 ;ORKA: array of order information in the format:
"RTN","ORKCHK",7,0)
 ; orderable item ien|
"RTN","ORKCHK",8,0)
 ; display group-filler app|
"RTN","ORKCHK",9,0)
 ; nat'l id^nat'l text^nat'l code sys^local id^local text^local code sys|
"RTN","ORKCHK",10,0)
 ; effective d/t|
"RTN","ORKCHK",11,0)
 ; order number|
"RTN","ORKCHK",12,0)
 ; filler data (LR: specimen ien, PS: meds prev ordered during this session in format med1^med2^...)
"RTN","ORKCHK",13,0)
 ;ORKMODE: mode/event trigger (DISPLAY,SELECT,ACCEPT,SESSION,ALL,NOTIF)
"RTN","ORKCHK",14,0)
 ; PS: meds previously ordered during this session med1^med2^...
"RTN","ORKCHK",15,0)
 ;
"RTN","ORKCHK",16,0)
 N ORKQ,ORKN S ORKQ=0,ORKN=1
"RTN","ORKCHK",17,0)
 S:+$G(ORKDFN)<1 ORKY(ORKN)="^^^Order Checking Unavailable - invalid patient id",ORKQ=1,ORKN=ORKN+1
"RTN","ORKCHK",18,0)
 S:'$L($G(ORKMODE)) ORKY(ORKN)="^^^Order Checking Unavailable - invalid mode/event",ORKQ=1,ORKN=ORKN+1
"RTN","ORKCHK",19,0)
 Q:$G(ORKQ)=1
"RTN","ORKCHK",20,0)
 Q:+$G(ORKA)<1
"RTN","ORKCHK",21,0)
 N ORKX,ORKS,DNGR,ORENT,ORKENT,ORKNENT,ORNUM,ORKOFF,ORKTMODE
"RTN","ORKCHK",22,0)
 N ORKADUZ,ORKNDUZ,ORKI,ORKPRIM,ORKNMSG,ORKMSG,ORKLOG,ORKLD,ORKLI,ORKOI
"RTN","ORKCHK",23,0)
 N ORKDG,ORKLPS,ORKPSA,ORKCNT,ORKDGI
"RTN","ORKCHK",24,0)
 ;
"RTN","ORKCHK",25,0)
 ;save array of orders for use in session processing:
"RTN","ORKCHK",26,0)
 M ^TMP("ORKA",$J)=ORKA
"RTN","ORKCHK",27,0)
 ;
"RTN","ORKCHK",28,0)
 ;get patient's location flag (INPATIENT ONLY - outpt locations cannot be
"RTN","ORKCHK",29,0)
 ;reliably determined, and many simultaneous outpt locations can occur):
"RTN","ORKCHK",30,0)
 N DFN,ORKLOC
"RTN","ORKCHK",31,0)
 S DFN=ORKDFN,VA200="" D OERR^VADPT
"RTN","ORKCHK",32,0)
 S ORKLOC=+$G(^DIC(42,+VAIN(4),44))
"RTN","ORKCHK",33,0)
 K VA200,VAIN
"RTN","ORKCHK",34,0)
 ;
"RTN","ORKCHK",35,0)
 ;get user's service/section flag:
"RTN","ORKCHK",36,0)
 N ORKSRV
"RTN","ORKCHK",37,0)
 S ORKSRV=$$GET1^DIQ(200,DUZ,29,"I") I +ORKSRV>0 S ORKSRV=$P(ORKSRV,U)
"RTN","ORKCHK",38,0)
 ;
"RTN","ORKCHK",39,0)
 ;log order check debug messages (or not)
"RTN","ORKCHK",40,0)
 S ORKLOG=$$GET^XPAR("DIV^SYS^PKG","ORK DEBUG ENABLE/DISABLE",1,"I")
"RTN","ORKCHK",41,0)
 I $G(ORKLOG)="D" K ^XTMP("ORKLOG") S ^XTMP("ORKLOG",0)=""
"RTN","ORKCHK",42,0)
 I +$P($G(^XTMP("ORKLOG",0)),U,3)>5000 K ^XTMP("ORKLOG")
"RTN","ORKCHK",43,0)
 ;
"RTN","ORKCHK",44,0)
 ;if SESSION mode & pharmacy order occurred in session get unsigned med orders
"RTN","ORKCHK",45,0)
 I ORKMODE="SESSION" D
"RTN","ORKCHK",46,0)
 .S ORKDG=$P(ORKA(1),"|",2)
"RTN","ORKCHK",47,0)
 .I $E($G(ORKDG),1,2)="PS" D
"RTN","ORKCHK",48,0)
 ..S ORKDGI=0,ORKDGI=$O(^ORD(100.98,"B","PHARMACY",ORKDGI))
"RTN","ORKCHK",49,0)
 ..K ^TMP("ORR",$J)
"RTN","ORKCHK",50,0)
 ..D EN^ORQ1(DFN_";DPT(",ORKDGI,11,"","","",0,0)
"RTN","ORKCHK",51,0)
 ..;store unsigned med orders in ^TMP("ORR",$J for processing in ORKPS
"RTN","ORKCHK",52,0)
 ;
"RTN","ORKCHK",53,0)
 ;main processing loop:
"RTN","ORKCHK",54,0)
 S ORKX="" F  S ORKX=$O(ORKA(ORKX)) Q:ORKX=""  D
"RTN","ORKCHK",55,0)
 .S ORKOI=$P(ORKA(ORKX),"|")
"RTN","ORKCHK",56,0)
 .;
"RTN","ORKCHK",57,0)
 .;log debug msgs if parameter is enabled:
"RTN","ORKCHK",58,0)
 .I $G(ORKLOG)="E" D
"RTN","ORKCHK",59,0)
 ..S ORKLD=$$NOW^XLFDT
"RTN","ORKCHK",60,0)
 ..S ORKLI=0
"RTN","ORKCHK",61,0)
 ..I +$P($G(^XTMP("ORKLOG",0)),U,3)<1 S $P(^XTMP("ORKLOG",0),U,3)=0
"RTN","ORKCHK",62,0)
 ..S ORKCNT=$P(^XTMP("ORKLOG",0),U,3)+1
"RTN","ORKCHK",63,0)
 ..S ^XTMP("ORKLOG",0)=$$FMADD^XLFDT(ORKLD,3,"","","")_U_ORKLD_U_ORKCNT
"RTN","ORKCHK",64,0)
 ..S ^XTMP("ORKLOG",ORKLD,ORKDFN,+$G(ORKOI),ORKMODE,DUZ,ORKLI)=ORKA(ORKX)
"RTN","ORKCHK",65,0)
 .;
"RTN","ORKCHK",66,0)
 .S ORKDG=$P(ORKA(ORKX),"|",2),ORKTMODE=""
"RTN","ORKCHK",67,0)
 .S ORKENT="USR^LOC.`"_+$G(ORKLOC)_"^SRV.`"_+$G(ORKSRV)_"^DIV^SYS^PKG"
"RTN","ORKCHK",68,0)
 .Q:'$L($G(ORKDG))
"RTN","ORKCHK",69,0)
 .;
"RTN","ORKCHK",70,0)
 .;if pharmacy order and multiple pharmacy orders in session add data node:
"RTN","ORKCHK",71,0)
 .I $E(ORKDG,1,2)="PS",($L($G(ORKPSA))) D
"RTN","ORKCHK",72,0)
 ..S $P(ORKA(ORKX),"|",6)=ORKPSA
"RTN","ORKCHK",73,0)
 .;
"RTN","ORKCHK",74,0)
 .S ORNUM=$P(ORKA(ORKX),"|",5)
"RTN","ORKCHK",75,0)
 .; get correct DUZ for notification processing if in NOTIF mode:
"RTN","ORKCHK",76,0)
 .I ORKMODE="NOTIF" D
"RTN","ORKCHK",77,0)
 ..S:+$G(ORNUM)>0 ORKNDUZ=$$ORDERER^ORQOR2(ORNUM) ;ordering provider
"RTN","ORKCHK",78,0)
 ..S:+$G(ORNUM)<1 ORKNDUZ=$P($$PRIM^ORQPTQ4(ORKDFN),U) ;prim provider
"RTN","ORKCHK",79,0)
 ..I +$G(ORKNDUZ)>0 D
"RTN","ORKCHK",80,0)
 ...S ORKSRV=$$GET1^DIQ(200,ORKNDUZ,29,"I") I +ORKSRV>0 S ORKSRV=$P(ORKSRV,U)
"RTN","ORKCHK",81,0)
 ...S ORKNENT="USR.`"_+ORKNDUZ_"^LOC.`"_+$G(ORKLOC)_"^SRV.`"_+$G(ORKSRV)_"^DIV^SYS^PKG"
"RTN","ORKCHK",82,0)
 ..S:+$G(ORKNDUZ)<1 ORKNENT="LOC.`"_+$G(ORKLOC)_"^DIV^SYS^PKG"
"RTN","ORKCHK",83,0)
 .S ORENT=$S(ORKMODE="NOTIF":ORKNENT,1:ORKENT)
"RTN","ORKCHK",84,0)
 .;
"RTN","ORKCHK",85,0)
 .;If the order is a delayed release order (NOTIF) process all nodes.
"RTN","ORKCHK",86,0)
 .;If it is a renewal, edit or delayed signature order (ALL) process all
"RTN","ORKCHK",87,0)
 .;modes except SESSION which gets processed just before signature:
"RTN","ORKCHK",88,0)
 .I ORKMODE="NOTIF"!(ORKMODE="ALL") S ORKTMODE=ORKMODE D
"RTN","ORKCHK",89,0)
 ..D EN^ORKCHK3(.ORKS,ORKDFN,ORKA(ORKX),ORENT,ORKTMODE)  ;DISPLAY
"RTN","ORKCHK",90,0)
 ..D EN^ORKCHK4(.ORKS,ORKDFN,ORKA(ORKX),ORENT,ORKTMODE)  ;SELECT
"RTN","ORKCHK",91,0)
 ..D EN^ORKCHK5(.ORKS,ORKDFN,ORKA(ORKX),ORENT,ORKTMODE)  ;ACCEPT
"RTN","ORKCHK",92,0)
 ..I ORKMODE="NOTIF" D EN^ORKCHK6(.ORKS,ORKDFN,ORKA(ORKX),ORENT,ORKTMODE)  ;SESSION
"RTN","ORKCHK",93,0)
 ..S ORKMODE=ORKTMODE
"RTN","ORKCHK",94,0)
 .;
"RTN","ORKCHK",95,0)
 .;Process regular orders/modes:
"RTN","ORKCHK",96,0)
 .I '$L($G(ORKTMODE)) D
"RTN","ORKCHK",97,0)
 ..I ORKMODE="DISPLAY" D EN^ORKCHK3(.ORKS,ORKDFN,ORKA(ORKX),ORENT,ORKTMODE)
"RTN","ORKCHK",98,0)
 ..I ORKMODE="SELECT" D EN^ORKCHK4(.ORKS,ORKDFN,ORKA(ORKX),ORENT,ORKTMODE)
"RTN","ORKCHK",99,0)
 ..I ORKMODE="ACCEPT" D EN^ORKCHK5(.ORKS,ORKDFN,ORKA(ORKX),ORENT,ORKTMODE)
"RTN","ORKCHK",100,0)
 ..I ORKMODE="SESSION" D EN^ORKCHK6(.ORKS,ORKDFN,ORKA(ORKX),ORENT,ORKTMODE)
"RTN","ORKCHK",101,0)
 ;
"RTN","ORKCHK",102,0)
 ;set messages into sorting array then into ORKY ORKS("ORK",clinical danger level,oi,msg)=ornum^order check ien^clin danger level^message
"RTN","ORKCHK",103,0)
 S ORKX="",ORKI=1
"RTN","ORKCHK",104,0)
 F  S ORKX=$O(ORKS("ORK",ORKX)) Q:ORKX=""  D
"RTN","ORKCHK",105,0)
 .S ORKY(ORKI)=$E(ORKS("ORK",ORKX),1,250)
"RTN","ORKCHK",106,0)
 .;
"RTN","ORKCHK",107,0)
 .;log debug msgs if parameter is enabled:
"RTN","ORKCHK",108,0)
 .I $G(ORKLOG)="E" D
"RTN","ORKCHK",109,0)
 ..S ORKLI=$G(ORKLI)+1
"RTN","ORKCHK",110,0)
 ..S ^XTMP("ORKLOG",$$NOW^XLFDT,ORKDFN,+$G(ORKOI),ORKMODE,DUZ,ORKLI)=ORKY(ORKI)
"RTN","ORKCHK",111,0)
 ..S $P(^XTMP("ORKLOG",0),U,3)=$P($G(^XTMP("ORKLOG",0)),U,3)+1
"RTN","ORKCHK",112,0)
 .;
"RTN","ORKCHK",113,0)
 .;send moderate and high danger order checks for delayed orders as notifications:
"RTN","ORKCHK",114,0)
 .I ORKMODE="NOTIF" S DNGR=$P(ORKY(ORKI),U,3) I $G(DNGR)<3 D
"RTN","ORKCHK",115,0)
 ..S ORKADUZ="",ORNUM=$P(ORKY(ORKI),U)
"RTN","ORKCHK",116,0)
 ..S:+$G(ORKNDUZ)>0 ORKADUZ(ORKNDUZ)=""
"RTN","ORKCHK",117,0)
 ..S ORKNMSG="Order check: "_$P(ORKY(ORKI),U,4)
"RTN","ORKCHK",118,0)
 ..D EN^ORB3(54,ORKDFN,$G(ORNUM),.ORKADUZ,ORKNMSG,"")
"RTN","ORKCHK",119,0)
 .S ORKI=ORKI+1
"RTN","ORKCHK",120,0)
 ;
"RTN","ORKCHK",121,0)
 K ^TMP("ORKA",$J),^TMP("ORR",$J)
"RTN","ORKCHK",122,0)
 I $G(ORKLOG)="E" D
"RTN","ORKCHK",123,0)
 .S ORKLI=$G(ORKLI)+1
"RTN","ORKCHK",124,0)
 .S ^XTMP("ORKLOG",$$NOW^XLFDT,ORKDFN,+$G(ORKOI),ORKMODE,DUZ,ORKLI)="LEAVING ORDER CHECKING"
"RTN","ORKCHK",125,0)
 .S $P(^XTMP("ORKLOG",0),U,3)=$P($G(^XTMP("ORKLOG",0)),U,3)+1
"RTN","ORKCHK",126,0)
 D CHKRMT
"RTN","ORKCHK",127,0)
 Q
"RTN","ORKCHK",128,0)
 ;
"RTN","ORKCHK",129,0)
OI2DD(ORPSA,OROI,ORPSPKG) ;rtn dispense drugs for a PS OI
"RTN","ORKCHK",130,0)
 N PSOI
"RTN","ORKCHK",131,0)
 Q:'$D(^ORD(101.43,OROI,0))
"RTN","ORKCHK",132,0)
 S PSOI=$P($P(^ORD(101.43,OROI,0),U,2),";")
"RTN","ORKCHK",133,0)
 Q:+$G(PSOI)<1
"RTN","ORKCHK",134,0)
 D DRG^PSSUTIL1(.ORPSA,PSOI,ORPSPKG)
"RTN","ORKCHK",135,0)
 Q
"RTN","ORKCHK",136,0)
CHKRMT ;
"RTN","ORKCHK",137,0)
 N I,ORQFLAG
"RTN","ORKCHK",138,0)
 S ORQFLAG=1
"RTN","ORKCHK",139,0)
 S I=0 F  S I=$O(ORKA(I)) Q:'I  I $E($P(ORKA(I),"|",2),1,2)="PS"!($E($P(ORKA(I),"|",2),1,2)="RA") S ORQFLAG=0
"RTN","ORKCHK",140,0)
 Q:$G(ORQFLAG)
"RTN","ORKCHK",141,0)
 Q:'$$HAVEHDR^ORRDI1
"RTN","ORKCHK",142,0)
 Q:$$LDPTTVAL^ORRDI2($G(DFN))
"RTN","ORKCHK",143,0)
 Q:$P($G(^XTMP("ORRDI","PSOO",ORKDFN,0)),U,3)'<0&($P($G(^XTMP("ORRDI","ART",ORKDFN,0)),U,3)'<0)
"RTN","ORKCHK",144,0)
 I $G(ORKMODE)="ACCEPT" D
"RTN","ORKCHK",145,0)
 . N IFN
"RTN","ORKCHK",146,0)
 . S IFN=$O(ORKY(""),-1)+1
"RTN","ORKCHK",147,0)
 . S ORKY(IFN)="^99^2^Remote Order Checking not available - checks done on local data only"
"RTN","ORKCHK",148,0)
 . K ^TMP($J,"ORRDI") S ^TMP($J,"ORRDI",ORKDFN)=1
"RTN","ORKCHK",149,0)
 I $G(ORKMODE)="SESSION" D
"RTN","ORKCHK",150,0)
 . N I,IFN,ORARR
"RTN","ORKCHK",151,0)
 . S IFN=$O(ORKY(""),-1)
"RTN","ORKCHK",152,0)
 . S I=0 F  S I=$O(ORKY(I)) Q:'I  S ORARR(+ORKY(I))=""
"RTN","ORKCHK",153,0)
 . S I=0 F  S I=$O(ORARR(I)) Q:'I  S IFN=IFN+1,ORKY(IFN)=I_"^99^2^Remote Order Checking not available - checks done on local data only"
"RTN","ORKCHK",154,0)
 . K ^TMP($J,"ORRDI") S ^TMP($J,"ORRDI",ORKDFN)=1
"RTN","ORKCHK",155,0)
 Q
"RTN","ORKLR")
0^110^B31162442
"RTN","ORKLR",1,0)
ORKLR ; slc/CLA - Order checking support procedure for lab orders ;7/23/96  14:31
"RTN","ORKLR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**6,32,51,92,105,243**;Dec 17, 1997;Build 242
"RTN","ORKLR",3,0)
 Q
"RTN","ORKLR",4,0)
DUP(ORKLR,OI,ORDFN,NEWORDT,SPECIMEN) ; return duplicate lab order info
"RTN","ORKLR",5,0)
 N ORL,DDT,ODT,ORN,ORNC,LRID,DGIEN,ORPANEL
"RTN","ORKLR",6,0)
 ;get lab id from orderable item (OI):
"RTN","ORKLR",7,0)
 S LRID=$P(^ORD(101.43,OI,0),U,2) S:$L($G(LRID)) ORL(LRID_";"_SPECIMEN)=""
"RTN","ORKLR",8,0)
 ;expand into child-level lab identifiers if children exist for this OI:
"RTN","ORKLR",9,0)
 ;if children found, set panel flag to '1':
"RTN","ORKLR",10,0)
 S LRID="" F  S LRID=$O(^ORD(101.43,OI,10,"AID",LRID)) Q:LRID=""  S ORL(LRID_";"_SPECIMEN)="",ORPANEL=1
"RTN","ORKLR",11,0)
 ;get duplicate date range-beginning date/time for this OI:
"RTN","ORKLR",12,0)
 S DDT=$P($$DUPRANGE^ORQOR2(OI,"LR",NEWORDT,ORDFN),U)
"RTN","ORKLR",13,0)
 Q:DDT=0  ;if dup range for this OI = zero, don't process dup order oc
"RTN","ORKLR",14,0)
 ;
"RTN","ORKLR",15,0)
 ;get all lab orders since dup beg d/t:
"RTN","ORKLR",16,0)
 S DGIEN=0,DGIEN=$O(^ORD(100.98,"B","LAB",DGIEN))
"RTN","ORKLR",17,0)
 K ^TMP("ORR",$J)
"RTN","ORKLR",18,0)
 D EN^ORQ1(ORDFN_";DPT(",DGIEN,1,"",DDT,NEWORDT,1,0)
"RTN","ORKLR",19,0)
 N J,HOR,SEQ,X S J=1,HOR=0,SEQ=0
"RTN","ORKLR",20,0)
 S HOR=$O(^TMP("ORR",$J,HOR)) Q:+HOR<1
"RTN","ORKLR",21,0)
 F  S SEQ=$O(^TMP("ORR",$J,HOR,SEQ)) Q:+SEQ<1  D
"RTN","ORKLR",22,0)
 .S X=^TMP("ORR",$J,HOR,SEQ),ORN=+$P(X,U),ODT=$P(X,U,4)
"RTN","ORKLR",23,0)
 .Q:+$G(ORN)=+$G(ORIFN)  ;quit current order # = dup order #
"RTN","ORKLR",24,0)
 .;break into child orders if they exist:
"RTN","ORKLR",25,0)
 .I $D(^OR(100,ORN,2,0)) D  ;child orders exist
"RTN","ORKLR",26,0)
 ..S ORNC=0 F  S ORNC=$O(^OR(100,ORN,2,ORNC)) Q:ORNC=""  D
"RTN","ORKLR",27,0)
 ...Q:+$G(ORNC)=+$G(ORIFN)  ;quit current order # = dup order #
"RTN","ORKLR",28,0)
 ...D DUP2(.ORKLR,ORNC,ODT,.ORL,$G(ORPANEL))
"RTN","ORKLR",29,0)
 .I '$D(^OR(100,ORN,2,0)) D DUP2(.ORKLR,ORN,ODT,.ORL,$G(ORPANEL))
"RTN","ORKLR",30,0)
 K ^TMP("ORR",$J)
"RTN","ORKLR",31,0)
 Q
"RTN","ORKLR",32,0)
DUP2(ORKLR,ORN,ODT,ORL,ORPANEL) ;second part of dup lab order check
"RTN","ORKLR",33,0)
 N ORS,ORST,ORSI,ORSP,OROI,LRID,LRIDX,LRIDXC,EXDT,INVDT,RCNT,ORY,ORX,ORQ
"RTN","ORKLR",34,0)
 S ORS=$$STATUS^ORQOR2(ORN),ORSI=$P(ORS,U),ORST=$P(ORS,U,2)
"RTN","ORKLR",35,0)
 ;quit if order status is canceled/discontinued/expired/lapsed/changed/delayed:
"RTN","ORKLR",36,0)
 I (ORSI=13)!(ORSI=1)!(ORSI=7)!(ORSI=14)!(ORSI=12)!(ORSI=10) Q
"RTN","ORKLR",37,0)
 ;
"RTN","ORKLR",38,0)
 ;get specimen for this order:
"RTN","ORKLR",39,0)
 S ORSP=$$VALUE^ORCSAVE2(ORN,"SPECIMEN")
"RTN","ORKLR",40,0)
 Q:'$L($G(ORSP))  ;quit if no specimen found
"RTN","ORKLR",41,0)
 ;get orderable item for this order:
"RTN","ORKLR",42,0)
 S OROI=$$OI^ORQOR2(ORN)
"RTN","ORKLR",43,0)
 Q:'$L($G(OROI))  ;quit if no orderable item found
"RTN","ORKLR",44,0)
 ;get lab id and check against ordered array ORL
"RTN","ORKLR",45,0)
 S:$L($G(^ORD(101.43,OROI,0))) LRIDX=$P(^ORD(101.43,OROI,0),U,2)_";"_ORSP I $L($G(LRIDX)) D
"RTN","ORKLR",46,0)
 .S LRID="" F  S LRID=$O(ORL(LRID)) Q:LRID=""  I LRID=LRIDX D  ;dup!
"RTN","ORKLR",47,0)
 ..;
"RTN","ORKLR",48,0)
 ..;quit if order results entered in lab as "cancelled":
"RTN","ORKLR",49,0)
 ..D ORDER^ORQQLR(.ORY,ORDFN,ORN)
"RTN","ORKLR",50,0)
 ..S ORX=0 F  S ORX=$O(ORY(ORX)) Q:+$G(ORX)<1  D
"RTN","ORKLR",51,0)
 ...I ($P(LRID,";")=$P(ORY(ORX),U)),($P(ORY(ORX),U,3)["canc") S ORQ=1
"RTN","ORKLR",52,0)
 ..Q:+$G(ORQ)=1  ;quit if lab test cancelled in lab
"RTN","ORKLR",53,0)
 ..;
"RTN","ORKLR",54,0)
 ..S EXDT=$$FMTE^XLFDT(ODT,"2P"),INVDT=9999999-ODT
"RTN","ORKLR",55,0)
 ..;get most recent lab results:
"RTN","ORKLR",56,0)
 ..S RCNT=$$LOCLFORM^ORQQLR1(ORDFN,+LRID,ORSP)
"RTN","ORKLR",57,0)
 ..;
"RTN","ORKLR",58,0)
 ..S ORKLR(INVDT)=ORN_U_$P($$TEXT^ORKOR(ORN,60),U,2)_" "_$G(EXDT)_" ["_$S(ORST="COMPLETE":"COLLECTED",ORST="PENDING":"UNCOLLECTED",1:ORST)_"]"
"RTN","ORKLR",59,0)
 ..I +RCNT>0 S ORKLR(INVDT)=ORKLR(INVDT)_"  *Most recent result: "_$P(RCNT,U,2)_"*"
"RTN","ORKLR",60,0)
 ;get children lab ids and check against ordered array  ORL
"RTN","ORKLR",61,0)
 S LRIDX="" F  S LRIDX=$O(^ORD(101.43,OROI,10,"AID",LRIDX)) Q:LRIDX=""  D
"RTN","ORKLR",62,0)
 .S LRIDXC=LRIDX_";"_ORSP
"RTN","ORKLR",63,0)
 .S LRID="" F  S LRID=$O(ORL(LRID)) Q:LRID=""  I LRID=LRIDXC D  ;dup!
"RTN","ORKLR",64,0)
 ..;
"RTN","ORKLR",65,0)
 ..D ORDER^ORQQLR(.ORY,ORDFN,ORN)
"RTN","ORKLR",66,0)
 ..S ORX=0 F  S ORX=$O(ORY(ORX)) Q:+$G(ORX)<1  D
"RTN","ORKLR",67,0)
 ...I ($P(LRID,";")=$P(ORY(ORX),U)),($P(ORY(ORX),U,3)["canc") S ORQ=1
"RTN","ORKLR",68,0)
 ..Q:+$G(ORQ)=1  ;quit if lab test cancelled in lab
"RTN","ORKLR",69,0)
 ..;
"RTN","ORKLR",70,0)
 ..S EXDT=$$FMTE^XLFDT(ODT,"2P"),INVDT=9999999-ODT
"RTN","ORKLR",71,0)
 ..;get most recent lab results:
"RTN","ORKLR",72,0)
 ..S RCNT=$S($G(ORPANEL)=1:"",1:$$LOCLFORM^ORQQLR1(ORDFN,+LRID,ORSP))
"RTN","ORKLR",73,0)
 ..;
"RTN","ORKLR",74,0)
 ..S ORKLR(INVDT)=ORN_U_$P($$TEXT^ORKOR(ORN,60),U,2)_" "_$G(EXDT)_" ["_$S(ORST="COMPLETE":"COLLECTED",ORST="PENDING":"UNCOLLECTED",1:ORST)_"]"
"RTN","ORKLR",75,0)
 ..I +RCNT>0 S ORKLR(INVDT)=ORKLR(INVDT)_"  *Most recent result: "_$P(RCNT,U,2)_"*"
"RTN","ORKLR",76,0)
 Q
"RTN","ORKLR",77,0)
RECNTWBC(ORDFN,ORDAYS) ;extrinsic function to return most recent WBC within <ORDAYS> in format:
"RTN","ORKLR",78,0)
 ;test id^result units flag ref range collection d/t
"RTN","ORKLR",79,0)
 N BDT,CDT,ORY,ORX,ORZ,X,TEST,ORI,ORJ,WBCRSLT,LABFILE,SPECFILE
"RTN","ORKLR",80,0)
 Q:'$L($G(ORDFN)) "0^"
"RTN","ORKLR",81,0)
 D NOW^%DTC
"RTN","ORKLR",82,0)
 I $L($G(ORDAYS)) S BDT=$$FMADD^XLFDT(%,"-"_ORDAYS,"","","")
"RTN","ORKLR",83,0)
 K %
"RTN","ORKLR",84,0)
 S:'$L($G(BDT)) BDT=1  ;if no ORDAYS, set BDT to '1' to search all days
"RTN","ORKLR",85,0)
 S LABFILE=$$TERMLKUP^ORB31(.ORY,"WBC")
"RTN","ORKLR",86,0)
 Q:'$D(ORY) "0^"  ;quit if no link between WBC and local lab test
"RTN","ORKLR",87,0)
 Q:$G(LABFILE)'=60 "0^"
"RTN","ORKLR",88,0)
 S SPECFILE=$$TERMLKUP^ORB31(.ORX,"BLOOD SPECIMEN")
"RTN","ORKLR",89,0)
 Q:'$D(ORX) "0^" ;quit if no link between BLOOD SPECIMEN and local spec
"RTN","ORKLR",90,0)
 Q:$G(SPECFILE)'=61 "0^"
"RTN","ORKLR",91,0)
 F ORI=1:1:ORY I +$G(WBCRSLT)<1 D
"RTN","ORKLR",92,0)
 .S TEST=$P(ORY(ORI),U)
"RTN","ORKLR",93,0)
 .Q:+$G(TEST)<1
"RTN","ORKLR",94,0)
 .F ORJ=1:1:ORX I +$G(WBCRSLT)<1 D
"RTN","ORKLR",95,0)
 ..S SPECIMEN=$P(ORX(ORJ),U)
"RTN","ORKLR",96,0)
 ..Q:+$G(SPECIMEN)<1
"RTN","ORKLR",97,0)
 ..S ORZ=$$LOCL^ORQQLR1(ORDFN,TEST,SPECIMEN)
"RTN","ORKLR",98,0)
 ..Q:'$L($G(ORZ))
"RTN","ORKLR",99,0)
 ..S CDT=$P(ORZ,U,7)
"RTN","ORKLR",100,0)
 ..I CDT'<BDT S WBCRSLT=1
"RTN","ORKLR",101,0)
 Q:+$G(WBCRSLT)<1 "0^"
"RTN","ORKLR",102,0)
 Q $P(ORZ,U,3)_U_$P(ORZ,U,3)_" "_$P(ORZ,U,4)_" "_$P(ORZ,U,5)_" ("_$P(ORZ,U,6)_")  "_$$FMTE^XLFDT(CDT,"2P")
"RTN","ORKLR",103,0)
 ;
"RTN","ORKLR",104,0)
CLOZLABS(ORDFN,ORDAYS,ORCLOZ) ;extrinsic function rtns "1" if clozapine ordered and WBC labs results within past ORDAYS, "0" if not
"RTN","ORKLR",105,0)
 ;result format: clozapine/mapped labs flag^recent WBC flag;recent WBC
"RTN","ORKLR",106,0)
 ; result^recent ANC flag;recent ANC result^formatted WBC and ANC results
"RTN","ORKLR",107,0)
 ;
"RTN","ORKLR",108,0)
 N BDT,WBC,WBCSPEC,WBCRSLT,WBCCDT,WBCF,ANC,ANCSPEC,ANCRSLT,ANCCDT,ANCF
"RTN","ORKLR",109,0)
 Q:'$L($G(ORDFN)) "0^"
"RTN","ORKLR",110,0)
 I $L($G(ORDAYS)) S BDT=$$FMADD^XLFDT($$NOW^XLFDT,"-"_ORDAYS,"","","")
"RTN","ORKLR",111,0)
 S:'$L($G(BDT)) BDT=1  ;if no ORDAYS, set BDT to '1' to search all days
"RTN","ORKLR",112,0)
 ;
"RTN","ORKLR",113,0)
 K LAB
"RTN","ORKLR",114,0)
 D EN^PSODRG(ORCLOZ)  ;pharmacy api rtns Lab file ptrs for WBC, ANC
"RTN","ORKLR",115,0)
 Q:$G(LAB("NOT"))=0 "0^"  ;medication is not clozapine
"RTN","ORKLR",116,0)
 ;Q:$G(LAB("BAD TEST"))=0 "0^"  ;one or both lab tests aren't mapped
"RTN","ORKLR",117,0)
 ;S WBC=$G(LAB("WBC")),WBCSPEC=$P(WBC,U,2),WBC=$P(WBC,U)
"RTN","ORKLR",118,0)
 ;S ANC=$G(LAB("ANC")),ANCSPEC=$P(ANC,U,2),ANC=$P(ANC,U)
"RTN","ORKLR",119,0)
 ;
"RTN","ORKLR",120,0)
 K ^TMP($J,"PSO")
"RTN","ORKLR",121,0)
 D CL1^YSCLTST2(ORDFN,ORDAYS)
"RTN","ORKLR",122,0)
 I $D(^TMP($J,"PSO")) D
"RTN","ORKLR",123,0)
 .N INVDT
"RTN","ORKLR",124,0)
 .S INVDT=$O(^TMP($J,"PSO",0))
"RTN","ORKLR",125,0)
 .Q:'INVDT
"RTN","ORKLR",126,0)
 .S WBC=$P($G(^TMP($J,"PSO",INVDT)),U)/1000
"RTN","ORKLR",127,0)
 .S ANC=$P($G(^TMP($J,"PSO",INVDT)),U,2)/1000
"RTN","ORKLR",128,0)
 .I WBC S WBCF=1
"RTN","ORKLR",129,0)
 .I ANC S ANCF=1
"RTN","ORKLR",130,0)
 .I $L(WBC)=1 S WBC=WBC_".0"
"RTN","ORKLR",131,0)
 .I $L(ANC)=1 S ANC=ANC_".0"
"RTN","ORKLR",132,0)
 .S WBCRSLT="WBC "_WBC_" ["_$$FMTE^XLFDT(9999999-INVDT,"""2P""")_"]"
"RTN","ORKLR",133,0)
 .S ANCRSLT="ANC "_ANC_" ["_$$FMTE^XLFDT(9999999-INVDT,"""2P""")_"]"
"RTN","ORKLR",134,0)
 ;
"RTN","ORKLR",135,0)
 K LAB
"RTN","ORKLR",136,0)
 Q "1^"_$G(WBCF,0)_";"_$G(WBC)_"^"_$G(ANCF,0)_";"_$G(ANC)_"^"_$G(WBCRSLT)_"  "_$G(ANCRSLT)
"RTN","ORLP")
0^206^B76319972
"RTN","ORLP",1,0)
ORLP ; SLC/CLA - Manager for Team List options ; 5/30/08 6:28am
"RTN","ORLP",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**47,90,98,243**;Dec 17, 1997;Build 242
"RTN","ORLP",3,0)
 ;
"RTN","ORLP",4,0)
CLEAR ; From TM, MERG^ORLP1, END^ORLP0.
"RTN","ORLP",5,0)
 K ^XUTL("OR",$J,"ORLP"),^("ORV"),^("ORU"),^("ORW") S ORCNT=0
"RTN","ORLP",6,0)
 Q
"RTN","ORLP",7,0)
 ;
"RTN","ORLP",8,0)
TM ; From option ORLP TEAM ADD - create/add a team list.
"RTN","ORLP",9,0)
 N ORLTYP
"RTN","ORLP",10,0)
 D CLEAR
"RTN","ORLP",11,0)
 W @IOF,!,"A team list is a list containing patients related to several providers.",!,"These providers are the list's users.  You may now create a new team list"
"RTN","ORLP",12,0)
 W !,"or add autolinks, users and/or patients to an existing team list.  Autolinks",!,"automatically add or remove patients with ADT movements.  Users on the list"
"RTN","ORLP",13,0)
 W !,"may receive notifications regarding patients on the same list.  Please prefix",!,"your list name with 'TEAM' or 'SERVICE' (e.g. TEAM7B, SERVICECARDIOLOGY.)",!
"RTN","ORLP",14,0)
 D ASKLIST,END
"RTN","ORLP",15,0)
 Q
"RTN","ORLP",16,0)
 ;
"RTN","ORLP",17,0)
ASKLIST ; Ask for team list.
"RTN","ORLP",18,0)
 ; NOTE: For new entries, TYPE field is required and trigger
"RTN","ORLP",19,0)
 ;       stuffs CREATOR field with DUZ of current user.
"RTN","ORLP",20,0)
 ;
"RTN","ORLP",21,0)
AL N DLAYGO,DIC,DIE,DIK,DR,ORFLAG,ORLTNAM,OROWNER,ORROOT,ORDA,ORYY
"RTN","ORLP",22,0)
 N DIR S DIR(0)="FAO^3:30",DIR("A")="Enter team list name: "
"RTN","ORLP",23,0)
 D ^DIR
"RTN","ORLP",24,0)
 I '$D(X)!$D(DIRUT) K DIR,DIRUT Q
"RTN","ORLP",25,0)
 S ORLTNAM=$$CHKNAM(Y)                 ; Check for duplication.
"RTN","ORLP",26,0)
 K DIR
"RTN","ORLP",27,0)
 N DIC S X=$G(X),(ORROOT,DIC)="^OR(100.21,",DLAYGO=100.21,DIC(0)="LEFQZ" D ^DIC
"RTN","ORLP",28,0)
 I '$D(X)!(+Y<0)!$D(DIRUT) K DIRUT Q   ; User aborted or problem.
"RTN","ORLP",29,0)
 I +Y,'+$G(^OR(100.21,+Y,11)) S ^OR(100.21,+Y,11)="0^"
"RTN","ORLP",30,0)
 ; Check for "Personal" lists (and not a new entry):
"RTN","ORLP",31,0)
 I ORLTNAM>0,(+Y>0),$P($G(^OR(100.21,+Y,0)),U,2)="P" W !!,"     Personal lists cannot be edited here.",! G AL
"RTN","ORLP",32,0)
 S (ORYY,TEAM)=Y,ORDA=+Y,TEAM(0)=Y(0),^TMP("ORLP",$J,"TLIST")=+Y K DIC
"RTN","ORLP",33,0)
 ; Check for entry of team type (new team entry):
"RTN","ORLP",34,0)
 I $P(TEAM,U,3) D  Q
"RTN","ORLP",35,0)
 .I $P(TEAM(0),U,2)="" D
"RTN","ORLP",36,0)
 ..SET Y=TEAM,Y(0)=TEAM(0) ; Reassign in case DIE previously called.
"RTN","ORLP",37,0)
 ..N DIE S DIE=ORROOT,DA=+Y,DR="1  Enter type:  ~R" D ^DIE I $O(Y(0)) S DIK=DIE D ^DIK Q
"RTN","ORLP",38,0)
 .S (ORLTYP,OROWNER)=""
"RTN","ORLP",39,0)
 .S ORLTYP=$P(^OR(100.21,+TEAM,0),U,2) Q:'$L(ORLTYP)
"RTN","ORLP",40,0)
 .; Check for "P" type, ask for user/owner input:
"RTN","ORLP",41,0)
 .I ORLTYP="P" D OWNER^ORLP1 ; Sets OROWNER variable.
"RTN","ORLP",42,0)
 .I (ORLTYP="P")&(OROWNER="") S DIK=ORROOT,DA=ORDA D ^DIK Q
"RTN","ORLP",43,0)
 .;
"RTN","ORLP",44,0)
 .; Allow further editing of autolink type teams:
"RTN","ORLP",45,0)
 .I ORLTYP["A" S:'$D(^OR(100.21,+TEAM,2,0)) ^(0)="^100.213AVI^^" D  Q
"RTN","ORLP",46,0)
 .. D ASKLINK,ASKUSER,ASKDEV,ASKSUB
"RTN","ORLP",47,0)
 .;
"RTN","ORLP",48,0)
 .; Proceed with editing for "TM" type teams:
"RTN","ORLP",49,0)
 .D ASKPT^ORLP00(+TEAM),ASKUSER,ASKDEV
"RTN","ORLP",50,0)
 ;
"RTN","ORLP",51,0)
 ; For existing teams, display team type:
"RTN","ORLP",52,0)
 W !,"  Type: "_$S($P(Y(0),U,2)="TM":"Manual Team List",$P(Y(0),U,2)="TA":"Autolinked Team List",$P(Y(0),U,2)="MRAL":"Manual Removal Autolinked Team List",1:"(Unknown)")
"RTN","ORLP",53,0)
 ;
"RTN","ORLP",54,0)
 ; Lock before allowing editing:
"RTN","ORLP",55,0)
 I $O(^OR(100.21,+TEAM,10,0)) L +^OR(100.21,+TEAM):3 I '$T W !?5,"  Another user is editing this entry." Q
"RTN","ORLP",56,0)
 ;
"RTN","ORLP",57,0)
 ; Allow applicable editing for all types but "TM" teams:
"RTN","ORLP",58,0)
 I $P(TEAM(0),U,2)'="TM" D
"RTN","ORLP",59,0)
 . D ASKLINK,ASKUSER,ASKDEV
"RTN","ORLP",60,0)
 . ;
"RTN","ORLP",61,0)
 . ; Editing of "subscription" attribute for "TA" and "MRAL" teams:
"RTN","ORLP",62,0)
 . I $P(TEAM(0),U,2)["A" D
"RTN","ORLP",63,0)
 . . D ASKSUB
"RTN","ORLP",64,0)
 ;
"RTN","ORLP",65,0)
 ; Proceed with editing for "TM" type teams:
"RTN","ORLP",66,0)
 I $P(TEAM(0),U,2)="TM" D ASKPT^ORLP00(+TEAM),ASKUSER,ASKDEV
"RTN","ORLP",67,0)
 Q
"RTN","ORLP",68,0)
 ;
"RTN","ORLP",69,0)
ASKLINK ; Ask for autolinks.
"RTN","ORLP",70,0)
 N DIC,DA,DLAYGO,Y,DUOUT,LVP,LVPT,LNAME
"RTN","ORLP",71,0)
 W !
"RTN","ORLP",72,0)
 F  K DIC,DA,DUOUT D  I LVP<1 Q
"RTN","ORLP",73,0)
 .S DLAYGO=100.21,DA(1)=+TEAM,DIC="^OR(100.21,"_DA(1)_",2,",DIC(0)="AELMQZ",DIC("A")="  Enter team autolink: "
"RTN","ORLP",74,0)
 .D ^DIC S LVP=Y I Y<1 Q
"RTN","ORLP",75,0)
 .I $P($G(Y),U,3)=1 D
"RTN","ORLP",76,0)
 ..S LNAME=Y(0,0)
"RTN","ORLP",77,0)
 ..I LVP["VA(200" F  D  Q:'$D(Y)
"RTN","ORLP",78,0)
 ...S DA(1)=+TEAM,DIE="^OR(100.21,"_DA(1)_",2,",DA(1)=+TEAM,DA=+LVP,DR="1R" D ^DIE I $D(Y) W !,"  This field is required in order for Provider autolinks to work correctly.",!,"  Please answer the question."
"RTN","ORLP",79,0)
 ..S LVPT=$P($G(^OR(100.21,+TEAM,2,+LVP,0)),U,2)
"RTN","ORLP",80,0)
 ..; For clinics, take a fork in the road:
"RTN","ORLP",81,0)
 ..I $P($P(LVP,U,2),";",2)="SC(" D BYCL(LVP) Q
"RTN","ORLP",82,0)
 ..; For autolinks besides clinics, truck on:
"RTN","ORLP",83,0)
 ..D ADDLPTS
"RTN","ORLP",84,0)
 Q
"RTN","ORLP",85,0)
 ;
"RTN","ORLP",86,0)
ADDLPTS ; Add patients linked to autolink.
"RTN","ORLP",87,0)
 W !
"RTN","ORLP",88,0)
 W !,"       [ADT movements linked to "
"RTN","ORLP",89,0)
 W !,"          ",LNAME
"RTN","ORLP",90,0)
 W !,"        will now automatically add patients to this list.]"
"RTN","ORLP",91,0)
 S LINK=$P(LVP,U,2),FILE="^"_$P(LINK,";",2),X="",CNT=0
"RTN","ORLP",92,0)
 W !!,"       Adding patients linked to ",LNAME,"..."
"RTN","ORLP",93,0)
 W !
"RTN","ORLP",94,0)
 I FILE="^DIC(42," D LOOPTS("CN",LNAME) Q
"RTN","ORLP",95,0)
 I FILE="^DG(405.4," D LOOPTS("RM",LNAME) Q
"RTN","ORLP",96,0)
 I FILE="^VA(200," D  Q
"RTN","ORLP",97,0)
 . ; Variable LVPT determines if provider pointer is for:
"RTN","ORLP",98,0)
 . ;    B - Both Primary and Attending
"RTN","ORLP",99,0)
 . ;    A - Attending
"RTN","ORLP",100,0)
 . ;    P - Primary
"RTN","ORLP",101,0)
 . I LVPT["B" D LOOPTS("APR",+LINK) N CNTAPR S CNTAPR=CNT,CNT=0 D LOOPTS("AAP",+LINK) Q
"RTN","ORLP",102,0)
 . I LVPT["P" D LOOPTS("APR",+LINK) Q
"RTN","ORLP",103,0)
 . I LVPT["A" D LOOPTS("AAP",+LINK)
"RTN","ORLP",104,0)
 I FILE="^DIC(45.7," D LOOPTS("ATR",+LINK) Q
"RTN","ORLP",105,0)
 Q
"RTN","ORLP",106,0)
 ;
"RTN","ORLP",107,0)
BYCL(CLINIC) ; SLC/PKS - 6/99 - Return list of clinic patients by enrollment.
"RTN","ORLP",108,0)
 ;
"RTN","ORLP",109,0)
 ; Called by ASKLINK.
"RTN","ORLP",110,0)
 ;
"RTN","ORLP",111,0)
 ; Variables used:
"RTN","ORLP",112,0)
 ;
"RTN","ORLP",113,0)
 ;    CLINIC  = Clinic to search.
"RTN","ORLP",114,0)
 ;    ORLIST  = Array, returned by call to PTCL^SCAPMC.
"RTN","ORLP",115,0)
 ;    ORERR   = Array for errors, returned by call to PTCL^SCAPMC.
"RTN","ORLP",116,0)
 ;    ORRET  = Flag for problem with PTCL^SCAPMC call.
"RTN","ORLP",117,0)
 ;    RESULT  = Holds result of PTCL^SCAPMC call (1=OK, 0=error).
"RTN","ORLP",118,0)
 ;    RCD     = Holder for each record in ^TMP of PTCL^SCAPMC.
"RTN","ORLP",119,0)
 ;    DFN     = Patient IEN.
"RTN","ORLP",120,0)
 ;    ALCNT   = Count of autolink patients added.
"RTN","ORLP",121,0)
 ;    DUPCNT  = Count of duplicate patients already on list.
"RTN","ORLP",122,0)
 ;    X       = Temp value holder variable.
"RTN","ORLP",123,0)
 ;
"RTN","ORLP",124,0)
 N DIC,DA,DO,DD,ORLIST,ORERR,RESULT,RCD,DFN,ALCNT,DUPCNT,X,ORRET
"RTN","ORLP",125,0)
 ;
"RTN","ORLP",126,0)
 ; Assign clinic variable:
"RTN","ORLP",127,0)
 S CLINIC=$P(CLINIC,"^",2)
"RTN","ORLP",128,0)
 S CLINIC=$P(CLINIC,";")
"RTN","ORLP",129,0)
 ;
"RTN","ORLP",130,0)
 ; Keep user informed:
"RTN","ORLP",131,0)
 W !
"RTN","ORLP",132,0)
 W !,"       [Patient enrollments linked to "
"RTN","ORLP",133,0)
 W !,"          ",LNAME
"RTN","ORLP",134,0)
 W !,"        will now automatically add patients to this list.]"
"RTN","ORLP",135,0)
 W !
"RTN","ORLP",136,0)
 W !,"       Adding patients enrolled in ",LNAME,"..."
"RTN","ORLP",137,0)
 W !
"RTN","ORLP",138,0)
 ;
"RTN","ORLP",139,0)
 ; Process the Autolink entries:
"RTN","ORLP",140,0)
 K ^TMP("SC TMP LIST") ; Clean up potential leftover data.
"RTN","ORLP",141,0)
 S ORRET=1
"RTN","ORLP",142,0)
 S RESULT=$$PTCL^SCAPMC(CLINIC,,.ORLIST,.ORERR)
"RTN","ORLP",143,0)
 I $L($G(RESULT)) D   ; Make sure something was returned.
"RTN","ORLP",144,0)
 .I RESULT>0 S ORRET=0 ; Was return value 1 or more?
"RTN","ORLP",145,0)
 I ORRET W !,"  Error in processing - patients will not be added." Q  ; Abort if there's a problem.
"RTN","ORLP",146,0)
 ; Clinic patients should now be in ^TMP("SC TMP LIST",$J file.
"RTN","ORLP",147,0)
 ;
"RTN","ORLP",148,0)
 ; Write the patients to the OE/RR LIST file:
"RTN","ORLP",149,0)
 S ALCNT=0  ; Initialize autolink counter.
"RTN","ORLP",150,0)
 S DUPCNT=0 ; Initialize duplicate counter.
"RTN","ORLP",151,0)
 S RCD=0    ; Initialize to start with first data record.
"RTN","ORLP",152,0)
 F  S RCD=$O(^TMP("SC TMP LIST",$J,RCD)) Q:'RCD  D  ; Each record.
"RTN","ORLP",153,0)
 .S DFN=$P(^TMP("SC TMP LIST",$J,RCD),"^")          ; Patient IEN.
"RTN","ORLP",154,0)
 .S X=DFN_";DPT(" ; Add ";DPT(" to patient string.
"RTN","ORLP",155,0)
 .I $D(^OR(100.21,+TEAM,10,"B",X)) S DUPCNT=DUPCNT+1 Q  ; This patient already on list - increment dupe counter.
"RTN","ORLP",156,0)
 .S:'$D(^OR(100.21,+TEAM,10,0)) ^(0)="^100.2101AV^^"
"RTN","ORLP",157,0)
 .K DIC,DA,DO,DD
"RTN","ORLP",158,0)
 .S DA(1)=+TEAM,DIC="^OR(100.21,"_DA(1)_",10,",DIC(0)="L"
"RTN","ORLP",159,0)
 .D FILE^DICN
"RTN","ORLP",160,0)
 .I +X S ALCNT=ALCNT+1 ; Increment counter.
"RTN","ORLP",161,0)
 .Q  ; Loop for each record in ^TMP file.
"RTN","ORLP",162,0)
 ;
"RTN","ORLP",163,0)
 ; Give user the results:
"RTN","ORLP",164,0)
 I ALCNT>0 W !,"       "_ALCNT_" patient(s) added to list."
"RTN","ORLP",165,0)
 I ALCNT=0 W !,"       No linked patients found."
"RTN","ORLP",166,0)
 I DUPCNT>0 W !,"       "_DUPCNT_" patient(s) already on list."
"RTN","ORLP",167,0)
 W !
"RTN","ORLP",168,0)
 K ^TMP("SC TMP LIST",$J) ; Clean up ^TMP file entries.
"RTN","ORLP",169,0)
 ;
"RTN","ORLP",170,0)
 Q
"RTN","ORLP",171,0)
 ;
"RTN","ORLP",172,0)
LOOPTS(REF,DEX) ;
"RTN","ORLP",173,0)
 S ORLPT=0 F  S ORLPT=$O(^DPT(REF,DEX,ORLPT)) Q:ORLPT'>0  S X=ORLPT_";DPT(" D ADDLOOP
"RTN","ORLP",174,0)
 I $D(LVPT),LVPT["B"!(LVPT']"") Q:REF="APR"
"RTN","ORLP",175,0)
 I +X W !,$S(+CNT:"       "_(+$G(CNTAPR)+(+CNT))_" patient(s) added.",1:"       Linked patients already on list.")
"RTN","ORLP",176,0)
 E  W "       No linked patients found."
"RTN","ORLP",177,0)
 W !
"RTN","ORLP",178,0)
 K DEX,FILE,MSG,REF,X,Y
"RTN","ORLP",179,0)
 Q
"RTN","ORLP",180,0)
 ;
"RTN","ORLP",181,0)
ASKUSER ; From ASKLIST - ask for providers/users.
"RTN","ORLP",182,0)
 Q:$D(DTOUT)!($D(DUOUT))
"RTN","ORLP",183,0)
 W !
"RTN","ORLP",184,0)
 S:'$D(^OR(100.21,+TEAM,1,0)) ^(0)="^100.212PA^^"
"RTN","ORLP",185,0)
 K DIC,DA
"RTN","ORLP",186,0)
 S DLAYGO=100.212,DA(1)=+TEAM
"RTN","ORLP",187,0)
 S DIC("P")="100.212PA",DIC="^OR(100.21,"_DA(1)_",1,",DIC(0)="AELMQ"
"RTN","ORLP",188,0)
 S DIC("A")="  Enter team provider/user: "
"RTN","ORLP",189,0)
 ; SLC/PKS - Next line added on 4/11/2000:
"RTN","ORLP",190,0)
 S DIC("S")="I $D(X),$D(^VA(200,""AK.PROVIDER"",$P(^(0),U))),$$ACTIVE^XUSER(+Y)"
"RTN","ORLP",191,0)
 F  D  Q:Y<1
"RTN","ORLP",192,0)
 .D ^DIC
"RTN","ORLP",193,0)
 .I '(Y<1) W !
"RTN","ORLP",194,0)
 K DIC,DA,DLAYGO
"RTN","ORLP",195,0)
 Q
"RTN","ORLP",196,0)
 ;
"RTN","ORLP",197,0)
ASKDEV ; From ASKLIST - ask for device.
"RTN","ORLP",198,0)
 ;
"RTN","ORLP",199,0)
 ; New, by PKS - 7/29/99:
"RTN","ORLP",200,0)
 Q:$D(DTOUT)!($D(DUOUT))  ; Previous interaction fail?
"RTN","ORLP",201,0)
 W !
"RTN","ORLP",202,0)
 N DIE,DR
"RTN","ORLP",203,0)
 S DIE="^OR(100.21,"
"RTN","ORLP",204,0)
 S DA=+TEAM
"RTN","ORLP",205,0)
 S DR="1.5  Enter device: "
"RTN","ORLP",206,0)
 D ^DIE ; Writes to DEVICE field.
"RTN","ORLP",207,0)
 K DIE
"RTN","ORLP",208,0)
 Q
"RTN","ORLP",209,0)
 ;
"RTN","ORLP",210,0)
ASKSUB ; From ASKLIST - Ask re: subscription status.
"RTN","ORLP",211,0)
 ; (PKS - 8/1999)
"RTN","ORLP",212,0)
 ;
"RTN","ORLP",213,0)
 Q:$D(DTOUT)!($D(DUOUT))  ; Previous interaction fail?
"RTN","ORLP",214,0)
 W !
"RTN","ORLP",215,0)
 N DIE,DR
"RTN","ORLP",216,0)
 S DIE="^OR(100.21,"
"RTN","ORLP",217,0)
 S DA=+TEAM
"RTN","ORLP",218,0)
 S DR="1.7  Enter subscription status: "
"RTN","ORLP",219,0)
 D ^DIE ; Writes to SUBSCRIBE field.
"RTN","ORLP",220,0)
 K DIE
"RTN","ORLP",221,0)
 ;
"RTN","ORLP",222,0)
 Q
"RTN","ORLP",223,0)
 ;
"RTN","ORLP",224,0)
STOR ; From SEQ^ORLP0 - store list in 100.21.
"RTN","ORLP",225,0)
 Q:'$D(DUZ)!('ORCNT)
"RTN","ORLP",226,0)
 I '$D(TEAM),($D(Y)#2) S TEAM=Y
"RTN","ORLP",227,0)
 S DLAYGO=100.21
"RTN","ORLP",228,0)
 L +^OR(100.21,+TEAM)
"RTN","ORLP",229,0)
 S (CNT,ORLI)=0 F ORLJ=1:1 S ORLI=$O(^XUTL("OR",$J,"ORLP",ORLI)) Q:ORLI<1  I $D(^(ORLI,0)) S X=^(0),X=$P(X,U,3) D ADDLOOP
"RTN","ORLP",230,0)
 I $G(X)>0 S MSG=$S(CNT=0:"       Patient(s) already on list.",1:"       "_CNT_" patient(s) added.") W !?5,MSG
"RTN","ORLP",231,0)
 E  W !?5,"       No patients found."
"RTN","ORLP",232,0)
 I CNT>0 W !?5,"  Storing list " W:$D(TEAM) $P(TEAM,U,2)," " W "for future reference..."
"RTN","ORLP",233,0)
 L -^OR(100.12,+TEAM)
"RTN","ORLP",234,0)
 Q
"RTN","ORLP",235,0)
 ;
"RTN","ORLP",236,0)
ADDLOOP ; From STOR, LOOPTS - add patients.
"RTN","ORLP",237,0)
 Q:$D(^OR(100.21,+TEAM,10,"B",X))  ; Quit if on list.
"RTN","ORLP",238,0)
 S:'$D(^OR(100.21,+TEAM,10,0)) ^(0)="^100.2101AV^^"
"RTN","ORLP",239,0)
 K DIC,DA,DO,DD
"RTN","ORLP",240,0)
 S DA(1)=+TEAM,DIC="^OR(100.21,"_DA(1)_",10,",DIC(0)="L"
"RTN","ORLP",241,0)
 D FILE^DICN I Y>0 S:$D(CNT) CNT=CNT+1
"RTN","ORLP",242,0)
 Q
"RTN","ORLP",243,0)
 ;
"RTN","ORLP",244,0)
CHKNAM(X) ; Check for duplicate entry.
"RTN","ORLP",245,0)
 N DIC
"RTN","ORLP",246,0)
 S X=$G(X)
"RTN","ORLP",247,0)
 S DIC="^OR(100.21,"
"RTN","ORLP",248,0)
 D ^DIC
"RTN","ORLP",249,0)
 S X=+Y
"RTN","ORLP",250,0)
 Q X
"RTN","ORLP",251,0)
 ;
"RTN","ORLP",252,0)
END ;
"RTN","ORLP",253,0)
 I $G(TEAM) L -^OR(100.21,+TEAM)
"RTN","ORLP",254,0)
 ;
"RTN","ORLP",255,0)
END1 K %,CNT,DA,DD,DIC,DO,DIE,DIK,DIR,DR,LINK,ORCNT,ORLI,ORLJ,ORLPT,SEL,TEAM,X,Y,ORBSTG,ORBROOT,DTOUT
"RTN","ORLP",256,0)
 Q
"RTN","ORLP",257,0)
 ;
"RTN","ORLPSR")
0^137^B54297693
"RTN","ORLPSR",1,0)
ORLPSR ; SLC/RAF-unsigned orders search ;10/19/00  14:02
"RTN","ORLPSR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORLPSR",3,0)
 ;
"RTN","ORLPSR",4,0)
 ;This routine will loop thru the "AS" xref in file 100 and 
"RTN","ORLPSR",5,0)
 ;allow the user to sort orders by date range, with a status of unsigned,
"RTN","ORLPSR",6,0)
 ;released/unsigned or unsigned/unreleased. It will also allow sorting by
"RTN","ORLPSR",7,0)
 ;service/section, provider, patient, location, entered by person,
"RTN","ORLPSR",8,0)
 ;or division
"RTN","ORLPSR",9,0)
 ;
"RTN","ORLPSR",10,0)
EN ;
"RTN","ORLPSR",11,0)
 N CNT,DASH,DATE,DCNT,DFN,DIR,DIRUT,DIV,DTOUT,DUOUT,EDATE,EDT
"RTN","ORLPSR",12,0)
 N HDR,HDR1,IEN,LCNT,LOC,LONER,LONUM,PAGE,PAT,PNM,PROV,QUIT,RPDT
"RTN","ORLPSR",13,0)
 N SD1,SD2,SDATE,SDT,SER,SINGLE,SORT,SSN,STOP,STATUS,SUB,SUMONLY,TOT,TOT0,TOT1
"RTN","ORLPSR",14,0)
 N TYPE,VA,VADM,VAERR,WHO,WHEN,Y
"RTN","ORLPSR",15,0)
 S U="^" K ^TMP("ORUNS",$J),^TMP("ORSTATS",$J)
"RTN","ORLPSR",16,0)
 W @IOF,!!?30,"Lapsed Orders Search",!?15,"This report is formatted for a 132 column output.",!
"RTN","ORLPSR",17,0)
TYPE S TYPE=2
"RTN","ORLPSR",18,0)
SORT ;sets DIR call to ask for the sorting criteria
"RTN","ORLPSR",19,0)
 S DIR(0)="SX^1:Service/Section;2:Provider;3:Patient;4:Location;5:Entered By;6:Division"
"RTN","ORLPSR",20,0)
 S DIR("A")="Enter the sort criteria"
"RTN","ORLPSR",21,0)
 S DIR("?")="To sort orders by Service/Section enter a 1, by Provider enter a 2, by Patient enter a 3, by Location enter a 4, by Entering Person enter a 5 and by Division enter a 6, Enter an ^ to exit the option"
"RTN","ORLPSR",22,0)
 D ^DIR S:+Y>0 SORT=+Y K DIR I $D(DTOUT)!$D(DUOUT) G EXIT
"RTN","ORLPSR",23,0)
SINGLE ;sets DIR call to ask the user if they want to sort for a single
"RTN","ORLPSR",24,0)
 ;service, provider, patient, location, division or entered by
"RTN","ORLPSR",25,0)
 S DIR(0)="Y"
"RTN","ORLPSR",26,0)
 S DIR("A")="Would you like a specific "_$S(SORT=1:"Service/Section",SORT=2:"Provider",SORT=3:"Patient",SORT=4:"Location",SORT=5:"Entering person",1:"Division")
"RTN","ORLPSR",27,0)
 S DIR("B")="NO"
"RTN","ORLPSR",28,0)
 S DIR("?")="You can limit your sort to one or more Service/Section, Provider, Patient, Location, Entered by, or Division, by entering a YES  here"
"RTN","ORLPSR",29,0)
 D ^DIR S:+Y>0 SINGLE=+Y K DIR I $D(DTOUT)!$D(DUOUT) G EXIT
"RTN","ORLPSR",30,0)
LONER ;sets DIR call to allow the user to select the specific sort entity
"RTN","ORLPSR",31,0)
 ;only asked if the user entered a YES in the previous prompt
"RTN","ORLPSR",32,0)
 I $D(SINGLE) D  I $D(QUIT)!('$D(LONER)) G EXIT
"RTN","ORLPSR",33,0)
 .F  D  I Y=-1!($D(QUIT)) Q
"RTN","ORLPSR",34,0)
 ..S DIR(0)=$S(SORT=1:"PAO^49:AEQM",SORT=2:"PAO^200:AEQM,",SORT=3:"PAO^2:AEQM",SORT=4:"PAO^44:AEQM",SORT=5:"PAO^200:AEQM",SORT=6:"PAO^40.8:AEQM")
"RTN","ORLPSR",35,0)
 ..S DIR("A")="Select "_$S(SORT=1:"Service/Section: ",SORT=2:"Provider: ",SORT=3:"Patient: ",SORT=4:"Location: ",SORT=5:"Entering Person: ",1:"Division: ")
"RTN","ORLPSR",36,0)
 ..S DIR("?")="When finished entering all the selections you want, press return or enter to go on. Enter an ^ to exit the option."
"RTN","ORLPSR",37,0)
 ..D ^DIR S:+Y>0 LONER($P(Y,U,2))=+Y K DIR I $D(DTOUT)!$D(DUOUT) S QUIT=1
"RTN","ORLPSR",38,0)
SDATE ;sets DIR call to ask the user for a starting date
"RTN","ORLPSR",39,0)
 S DIR(0)="DA^::ETX"
"RTN","ORLPSR",40,0)
 S DIR("A")="Enter a starting date: "
"RTN","ORLPSR",41,0)
 S DIR("?")="Enter the date or date/time that you want the search to start with.  Example: If your site has a 48 hr grace period for signing orders,         enter T-2"
"RTN","ORLPSR",42,0)
 D ^DIR S:+Y>0 (SDATE,SD1)=(9999999-Y),SDT=$$FMTE^XLFDT(Y) K DIR I $D(DTOUT)!$D(DUOUT) G EXIT
"RTN","ORLPSR",43,0)
EDATE ;sets DIR call to ask the user for an ending date (optional)
"RTN","ORLPSR",44,0)
 S DIR(0)="DA^::ETX"
"RTN","ORLPSR",45,0)
 S DIR("A")="Enter an ending date: "
"RTN","ORLPSR",46,0)
 S DIR("?")="Enter the date or date/time that you want the search to end with. This field can be used to ignore pre-CPRS unsigned orders by entering the date of your CPRS installation."
"RTN","ORLPSR",47,0)
 D ^DIR S (EDATE,SD2)=(9999999-Y),EDT=$$FMTE^XLFDT(Y) K DIR I $D(DTOUT)!$D(DUOUT) G EXIT
"RTN","ORLPSR",48,0)
SWITCH ;takes the date input from the user and does a switcheroo so the program
"RTN","ORLPSR",49,0)
 ;can work as intended
"RTN","ORLPSR",50,0)
 I EDATE'>SDATE S EDATE=SD1,SDATE=SD2
"RTN","ORLPSR",51,0)
SUMONLY ;ask if summary only or full detail
"RTN","ORLPSR",52,0)
 S DIR(0)="Y",DIR("A")="Print summary only ",DIR("B")="NO",DIR("?")="Enter yes for summary report (statistics), no for detailed report."
"RTN","ORLPSR",53,0)
 D ^DIR S SUMONLY=$S(Y=1:1,Y=0:0,1:"^") K DIR I SUMONLY="^" Q
"RTN","ORLPSR",54,0)
TASK ;
"RTN","ORLPSR",55,0)
 S %ZIS="Q" D ^%ZIS I POP Q
"RTN","ORLPSR",56,0)
 I $D(IO("Q")) D  K IO("Q") Q
"RTN","ORLPSR",57,0)
 .S ZTIO=ION,ZTDESC="File 100 order status search"
"RTN","ORLPSR",58,0)
 .S ZTRTN="LOOP^ORLPSRA",ZTSAVE("SORT")="",ZTSAVE("TYPE")=""
"RTN","ORLPSR",59,0)
 .S ZTSAVE("SDATE")="",ZTSAVE("EDATE")="",ZTSAVE("SINGLE")=""
"RTN","ORLPSR",60,0)
 .S ZTSAVE("LONER*")="",ZTSAVE("SDT")="",ZTSAVE("EDT")="",ZTSAVE("SUMONLY")=""
"RTN","ORLPSR",61,0)
 .D ^%ZTLOAD I $D(ZTSK) W !,?32,"REQUEST QUEUED"
"RTN","ORLPSR",62,0)
 U IO D LOOP^ORLPSRA Q
"RTN","ORLPSR",63,0)
STATS ;SERVICE/SECTION statistics
"RTN","ORLPSR",64,0)
 S:SUMONLY PAGE=0 S SUMONLY=0 ;Set SUMONLY back to zero so header will print.
"RTN","ORLPSR",65,0)
 I '$D(^TMP("ORSTATS",$J)) D HDR Q:STOP  W !,"There are no statistics for the selected sort range." Q
"RTN","ORLPSR",66,0)
 I SORT=1&($D(^TMP("ORSTATS",$J))) D
"RTN","ORLPSR",67,0)
 .S HDR="!!?25,""Order Statistics for Service/Section sort"""
"RTN","ORLPSR",68,0)
 .S HDR1="!,""Service/Section"",?25,""Provider"",?50,""# of Orders"""
"RTN","ORLPSR",69,0)
 .S TOT=0 D HDR
"RTN","ORLPSR",70,0)
 .S SER="" F  S SER=$O(^TMP("ORSTATS",$J,SER)) S TOT0=0 Q:SER=""!STOP  D
"RTN","ORLPSR",71,0)
 ..S PROV="" F  S PROV=$O(^TMP("ORSTATS",$J,SER,PROV)) Q:PROV=""!STOP  D
"RTN","ORLPSR",72,0)
 ...W SER,?25,PROV,?50,^(PROV),! S TOT1=^(PROV),TOT0=TOT0+TOT1
"RTN","ORLPSR",73,0)
 ...S TOT=TOT+TOT1 D:$Y>(IOSL-4) HDR Q:STOP
"RTN","ORLPSR",74,0)
 ..W:'STOP ?46,"SUBTOTAL: ",TOT0,!
"RTN","ORLPSR",75,0)
 .W:'STOP ?46,"------------",!?46,"TOTAL: ",TOT
"RTN","ORLPSR",76,0)
PV ;PROVIDER statistics
"RTN","ORLPSR",77,0)
 I SORT=2&($D(^TMP("ORSTATS",$J))) D
"RTN","ORLPSR",78,0)
 .S HDR="!!?25,""Order Statistics for Provider sort"""
"RTN","ORLPSR",79,0)
 .S HDR1="!,""Provider"",?25,""Patient"",?50,""# of Orders"""
"RTN","ORLPSR",80,0)
 .S TOT=0 D HDR
"RTN","ORLPSR",81,0)
 .S PROV="" F  S PROV=$O(^TMP("ORSTATS",$J,PROV)) S TOT0=0 Q:PROV=""!STOP  D
"RTN","ORLPSR",82,0)
 ..S PNM="" F  S PNM=$O(^TMP("ORSTATS",$J,PROV,PNM)) Q:PNM=""!STOP  D
"RTN","ORLPSR",83,0)
 ...W PROV,?25,PNM,?50,^(PNM),! S TOT1=^(PNM)
"RTN","ORLPSR",84,0)
 ...S TOT=TOT+TOT1,TOT0=TOT0+TOT1 D:$Y>(IOSL-4) HDR Q:STOP
"RTN","ORLPSR",85,0)
 ..W:'STOP ?46,"SUBTOTAL: ",TOT0,!
"RTN","ORLPSR",86,0)
 .W:'STOP ?46,"------------",!?46,"TOTAL: ",TOT
"RTN","ORLPSR",87,0)
PT ;PATIENT statistics
"RTN","ORLPSR",88,0)
 I SORT=3&($D(^TMP("ORSTATS",$J))) D
"RTN","ORLPSR",89,0)
 .S HDR="!!?25,""Order Statistics for Patient sort"""
"RTN","ORLPSR",90,0)
 .S HDR1="!,""Patient"",?25,""Provider"",?50,""# of Orders"""
"RTN","ORLPSR",91,0)
 .S TOT=0 D HDR
"RTN","ORLPSR",92,0)
 .S PNM="" F  S PNM=$O(^TMP("ORSTATS",$J,PNM)) S TOT0=0 Q:PNM=""!STOP  D
"RTN","ORLPSR",93,0)
 ..S PROV="" F  S PROV=$O(^TMP("ORSTATS",$J,PNM,PROV)) Q:PROV=""!STOP  D
"RTN","ORLPSR",94,0)
 ...W PNM,?25,PROV,?50,^(PROV),! S TOT1=^(PROV),TOT0=TOT0+TOT1
"RTN","ORLPSR",95,0)
 ...S TOT=TOT+TOT1 D:$Y>(IOSL-4) HDR Q:STOP
"RTN","ORLPSR",96,0)
 ..W:'STOP ?46,"SUBTOTAL: ",TOT0,!
"RTN","ORLPSR",97,0)
 .W:'STOP ?46,"------------",!?46,"TOTAL: ",TOT
"RTN","ORLPSR",98,0)
L ;LOCATION statistics
"RTN","ORLPSR",99,0)
 I SORT=4&($D(^TMP("ORSTATS",$J))) D
"RTN","ORLPSR",100,0)
 .S HDR="!!?25,""Order Statistics for Location sort"""
"RTN","ORLPSR",101,0)
 .S HDR1="!,""Location"",?25,""Provider"",?50,""# of Orders"""
"RTN","ORLPSR",102,0)
 .S TOT=0 D HDR
"RTN","ORLPSR",103,0)
 .S LOC="" F  S LOC=$O(^TMP("ORSTATS",$J,LOC)) S TOT0=0 Q:LOC=""!STOP  D
"RTN","ORLPSR",104,0)
 ..S PROV="" F  S PROV=$O(^TMP("ORSTATS",$J,LOC,PROV)) Q:PROV=""!STOP  D
"RTN","ORLPSR",105,0)
 ...W $E(LOC,1,24),?25,PROV,?50,^(PROV),! S TOT1=^(PROV),TOT0=TOT0+TOT1
"RTN","ORLPSR",106,0)
 ...S TOT=TOT+TOT1 D:$Y>(IOSL-4) HDR Q:STOP
"RTN","ORLPSR",107,0)
 ..W:'STOP ?46,"SUBTOTAL: ",TOT0,!
"RTN","ORLPSR",108,0)
 .W:'STOP ?46,"------------",!?46,"TOTAL: ",TOT
"RTN","ORLPSR",109,0)
EB ;ENTERED BY statistics
"RTN","ORLPSR",110,0)
 I SORT=5&($D(^TMP("ORSTATS",$J))) D
"RTN","ORLPSR",111,0)
 .S HDR="!!?25,""Order Statistics for Entering Person sort"""
"RTN","ORLPSR",112,0)
 .S HDR1="!,""Entering person"",?25,""Patient"",?50,""# of Orders"""
"RTN","ORLPSR",113,0)
 .S TOT=0 D HDR
"RTN","ORLPSR",114,0)
 .S WHO="" F  S WHO=$O(^TMP("ORSTATS",$J,WHO)) S TOT0=0 Q:WHO=""!STOP  D
"RTN","ORLPSR",115,0)
 ..S PNM="" F  S PNM=$O(^TMP("ORSTATS",$J,WHO,PNM)) Q:PNM=""!STOP  D
"RTN","ORLPSR",116,0)
 ...W WHO,?25,PNM,?50,^(PNM),! S TOT1=^(PNM),TOT0=TOT0+TOT1
"RTN","ORLPSR",117,0)
 ...S TOT=TOT+TOT1 D:$Y>(IOS-4) HDR Q:STOP
"RTN","ORLPSR",118,0)
 ..W:'STOP ?46,"SUBTOTAL: ",TOT0,!
"RTN","ORLPSR",119,0)
 .W:'STOP ?46,"------------",!?46,"TOTAL: ",TOT
"RTN","ORLPSR",120,0)
D ;DIVISION statistics
"RTN","ORLPSR",121,0)
 I SORT=6&($D(^TMP("ORSTATS",$J))) D
"RTN","ORLPSR",122,0)
 .S HDR="!!?25,""Order Statistics for Division sort"""
"RTN","ORLPSR",123,0)
 .S DIV="" F  S DIV=$O(^TMP("ORSTATS",$J,DIV)) Q:DIV=""!STOP  S DCNT=0 D
"RTN","ORLPSR",124,0)
 ..S LOC="" F  S LOC=$O(^TMP("ORSTATS",$J,DIV,LOC)) Q:LOC=""!STOP  S LCNT=0 D
"RTN","ORLPSR",125,0)
 ...S HDR1="!!,""Division: "",DIV,!?5,""Location: "",LOC,!?20,""Provider"",?51,""Orders""" D HDR Q:STOP
"RTN","ORLPSR",126,0)
 ...S PROV="" F  S PROV=$O(^TMP("ORSTATS",$J,DIV,LOC,PROV)) Q:PROV=""!STOP  D
"RTN","ORLPSR",127,0)
 ....W ?20,PROV,?51,^(PROV),! S LCNT=LCNT+^(PROV) D:$Y>(IOSL-4) HDR Q:STOP
"RTN","ORLPSR",128,0)
 ...I 'STOP W !?41,"Subtotal",?51,LCNT S DCNT=DCNT+LCNT
"RTN","ORLPSR",129,0)
 ..I 'STOP W !?5,"Total orders for Division: ",DIV_" = "_DCNT
"RTN","ORLPSR",130,0)
EXIT K ^TMP("ORUNS",$J),^TMP("ORSTATS",$J)
"RTN","ORLPSR",131,0)
 D ^%ZISC
"RTN","ORLPSR",132,0)
 Q
"RTN","ORLPSR",133,0)
LOC(LOC) ;resolves the location pointer
"RTN","ORLPSR",134,0)
 N X
"RTN","ORLPSR",135,0)
 S X=$P(^SC(+LOC,0),U)
"RTN","ORLPSR",136,0)
 Q X
"RTN","ORLPSR",137,0)
USER(USER) ;resolves user pointers
"RTN","ORLPSR",138,0)
 N X
"RTN","ORLPSR",139,0)
 S X=$E($P(^VA(200,+USER,0),U),1,24)
"RTN","ORLPSR",140,0)
 Q X
"RTN","ORLPSR",141,0)
STAT(STA) ;resolves pointer to the order status file
"RTN","ORLPSR",142,0)
 N X
"RTN","ORLPSR",143,0)
 S X=$E($P(^ORD(100.01,+STA,0),U),1,14)
"RTN","ORLPSR",144,0)
 Q X
"RTN","ORLPSR",145,0)
SER(SER) ;resolves pointer to the service/section file
"RTN","ORLPSR",146,0)
 N X
"RTN","ORLPSR",147,0)
 S X=$P(^DIC(49,+SER,0),U)
"RTN","ORLPSR",148,0)
 Q X
"RTN","ORLPSR",149,0)
DIV(LOC) ;determines the division based on the entry in file 44
"RTN","ORLPSR",150,0)
 N X
"RTN","ORLPSR",151,0)
 S X=$P(^SC(+LOC,0),U,15) I X="" Q "UNKNOWN"
"RTN","ORLPSR",152,0)
 S X=$P(^DG(40.8,X,0),U)
"RTN","ORLPSR",153,0)
 Q X
"RTN","ORLPSR",154,0)
HDR ;Print header
"RTN","ORLPSR",155,0)
 I $G(SUMONLY) Q
"RTN","ORLPSR",156,0)
 I $E(IOST)="C"&(PAGE) S DIR(0)="E" D ^DIR S:Y'=1 STOP=1 K DIR Q:STOP
"RTN","ORLPSR",157,0)
 I PAGE!('PAGE&($E(IOST)="C")) W @IOF
"RTN","ORLPSR",158,0)
 I $D(RPDT) W @RPDT
"RTN","ORLPSR",159,0)
 I $D(HDR) W @HDR
"RTN","ORLPSR",160,0)
 I $D(HDR1) W @HDR1
"RTN","ORLPSR",161,0)
 W !,$$REPEAT^XLFSTR("-",IOM),!
"RTN","ORLPSR",162,0)
 S PAGE=1
"RTN","ORLPSR",163,0)
 Q
"RTN","ORLPSRA")
0^138^B62257534
"RTN","ORLPSRA",1,0)
ORLPSRA ;SLC/RAF - Continuation of ORLPSR ; 3/31/08 6:24am
"RTN","ORLPSRA",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORLPSRA",3,0)
 ;
"RTN","ORLPSRA",4,0)
LOOP ;called from ORLPSR
"RTN","ORLPSRA",5,0)
 ;goes thru the "ALPS" xref in 100 for order dates - called from ORLPSR
"RTN","ORLPSRA",6,0)
 S RPDT="""Report Date: "",$$FMTE^XLFDT($$NOW^XLFDT),""  Sort Range From: "",SDT,""   To: "",EDT",STOP=0
"RTN","ORLPSRA",7,0)
 S PAT="" F  S PAT=$O(^OR(100,"ALPS",PAT)) Q:'PAT!STOP  D
"RTN","ORLPSRA",8,0)
 .Q:$P(^DPT(+PAT,0),U,21)  ;Quit if test patient
"RTN","ORLPSRA",9,0)
 .S DATE=0 F  S DATE=$O(^OR(100,"ALPS",PAT,DATE)) Q:'DATE!STOP  I DATE>SDATE,DATE<EDATE D
"RTN","ORLPSRA",10,0)
 ..S IEN=0 F  S IEN=$O(^OR(100,"ALPS",PAT,DATE,IEN)) Q:'IEN!STOP  D
"RTN","ORLPSRA",11,0)
 ...S SUB=0 F  S SUB=$O(^OR(100,"ALPS",PAT,DATE,IEN,SUB)) Q:'SUB!STOP  D
"RTN","ORLPSRA",12,0)
 ....I $D(^OR(100,IEN,8,SUB,0)) D
"RTN","ORLPSRA",13,0)
 .....;W !,DATE
"RTN","ORLPSRA",14,0)
 .....;I TYPE=1 Q:+$P(^(0),U,15)=11
"RTN","ORLPSRA",15,0)
 .....;I TYPE=3 Q:+$P(^(0),U,15)'=11
"RTN","ORLPSRA",16,0)
 .....N LTYPE S LTYPE=$G(^OR(100,"ALPS",PAT,DATE,IEN,SUB))
"RTN","ORLPSRA",17,0)
 .....I LTYPE="DELAYED ORDER" S LTYPE="DO"
"RTN","ORLPSRA",18,0)
 .....N LDATE S LDATE=""
"RTN","ORLPSRA",19,0)
 .....S (LOC,DIV)="**DELAYED ORDER/NOT ENTERED" ;Reset values as delayed orders may not have these values yet
"RTN","ORLPSRA",20,0)
 .....I $D(^VA(200,+$P(^OR(100,IEN,8,SUB,0),U,3),0)) S PROV=$$USER^ORLPSR(+$P(^OR(100,IEN,8,SUB,0),U,3))
"RTN","ORLPSRA",21,0)
 .....I $D(^VA(200,+$P(^OR(100,IEN,8,SUB,0),U,3),5)),$L($P(^(5),U)) S SER=$$SER^ORLPSR(+$P(^VA(200,+$P(^OR(100,IEN,8,SUB,0),U,3),5),U))
"RTN","ORLPSRA",22,0)
 .....E  S SER="MISSING from file 200"
"RTN","ORLPSRA",23,0)
 .....I $D(^VA(200,+$P(^OR(100,IEN,8,SUB,0),U,13))) S WHO=$$USER^ORLPSR(+$P(^OR(100,IEN,8,SUB,0),U,13))
"RTN","ORLPSRA",24,0)
 .....I $G(^OR(100,IEN,6)) I $P(^(6),U)=9&($P(^(6),U,5)="AUTO DC") S WHO=$$USER^ORLPSR(+$P(^OR(100,IEN,8,1,0),U,13)) ;If DCd nature is auto and text is auto dc set entered by to original entry person
"RTN","ORLPSRA",25,0)
 .....S DFN=+$P(^OR(100,IEN,0),U,2) D DEM^VADPT S SSN=VA("BID"),PNM=$E(VADM(1),1,24)
"RTN","ORLPSRA",26,0)
 .....I $D(^OR(100,IEN,3)),$P(^(3),U,3) S STATUS=$$STAT^ORLPSR(+$P(^(3),U,3))
"RTN","ORLPSRA",27,0)
 .....I $D(^OR(100,IEN,0)),$P(^(0),U,10) S LOC=$$LOC^ORLPSR(+$P(^(0),U,10))
"RTN","ORLPSRA",28,0)
 .....I $D(^OR(100,IEN,0)),$P(^(0),U,10) S DIV=$$DIV^ORLPSR(+$P(^(0),U,10))
"RTN","ORLPSRA",29,0)
 .....I $D(^OR(100,IEN,8,SUB,0)),$P(^(0),U) S WHEN=$$FMTE^XLFDT($P($P(^(0),U),"."))
"RTN","ORLPSRA",30,0)
 .....I $D(^OR(100,IEN,10)),$P(^(10),U) S LDATE=$$FMTE^XLFDT($P($P(^(10),U),"."))
"RTN","ORLPSRA",31,0)
 .....I $L(LTYPE) S STATUS=STATUS_"("_LTYPE_")"
"RTN","ORLPSRA",32,0)
 .....I SORT=1 S ^TMP("ORUNS",$J,SER,PROV,IEN)=SER_U_PROV_U_WHO_U_PNM_U_SSN_U_STATUS_U_IEN_U_WHEN_U_LDATE
"RTN","ORLPSRA",33,0)
 .....I SORT=2 S ^TMP("ORUNS",$J,PROV,PNM,IEN)=PROV_U_WHO_U_PNM_U_SSN_U_STATUS_U_IEN_U_WHEN_U_LDATE
"RTN","ORLPSRA",34,0)
 .....I SORT=3 S ^TMP("ORUNS",$J,PNM,PROV,IEN)=PNM_U_SSN_U_PROV_U_WHO_U_STATUS_U_IEN_U_WHEN_U_LDATE
"RTN","ORLPSRA",35,0)
 .....I SORT=4 S ^TMP("ORUNS",$J,LOC,PROV,IEN)=LOC_U_PROV_U_WHO_U_PNM_U_SSN_U_STATUS_U_IEN_U_WHEN_U_LDATE
"RTN","ORLPSRA",36,0)
 .....I SORT=5 S ^TMP("ORUNS",$J,WHO,PNM,IEN)=WHO_U_PROV_U_PNM_U_SSN_U_STATUS_U_IEN_U_WHEN_U_LDATE
"RTN","ORLPSRA",37,0)
 .....I SORT=6 S ^TMP("ORUNS",$J,DIV,LOC,PROV,IEN)=DIV_U_LOC_U_PROV_U_WHO_U_PNM_U_SSN_U_STATUS_U_IEN_U_WHEN_U_LDATE
"RTN","ORLPSRA",38,0)
PROV ;loops thru the TMP global for output sort by provider
"RTN","ORLPSRA",39,0)
 I SORT=2&('$D(LONER)) D
"RTN","ORLPSRA",40,0)
 .I TYPE=1 S HDR="!!?30,""List of RELEASED but UNSIGNED orders by PROVIDER"""
"RTN","ORLPSRA",41,0)
 .I TYPE=2 S HDR="!!?40,""List of LAPSED orders by PROVIDER"""
"RTN","ORLPSRA",42,0)
 .I TYPE=3 S HDR="!!?30,""List of UNSIGNED/UNRELEASED orders by PROVIDER"""
"RTN","ORLPSRA",43,0)
 .S HDR1="!!,""PROVIDER"",?25,""ENTERED BY"",?50,""PATIENT"",?75,""SSN"",?81,""STATUS"",?91,""ORDER #"",?104,""ORDER DATE"",?118,""LAPSE DATE"""
"RTN","ORLPSRA",44,0)
 .S PAGE=0 D HDR^ORLPSR
"RTN","ORLPSRA",45,0)
 .I '$D(^TMP("ORUNS",$J)) W !,"No lapsed orders found" Q
"RTN","ORLPSRA",46,0)
 .S PROV="" F  S PROV=$O(^TMP("ORUNS",$J,PROV)) Q:PROV=""!STOP  D
"RTN","ORLPSRA",47,0)
 ..S PNM="" F  S PNM=$O(^TMP("ORUNS",$J,PROV,PNM)) S CNT=0 Q:PNM=""!STOP  D
"RTN","ORLPSRA",48,0)
 ...S IEN=0 F  S IEN=$O(^TMP("ORUNS",$J,PROV,PNM,IEN)) S CNT=CNT+1 Q:'IEN!STOP  D
"RTN","ORLPSRA",49,0)
 ....I 'SUMONLY W $P(^(IEN),U),?25,$P(^(IEN),U,2),?50,$P(^(IEN),U,3),?75,$P(^(IEN),U,4),?81,$P(^(IEN),U,5),?91,$P(^(IEN),U,6),?104,$P(^(IEN),U,7),?118,$P(^(IEN),U,8),! D:$Y>(IOSL-4) HDR^ORLPSR Q:STOP
"RTN","ORLPSRA",50,0)
 ....S ^TMP("ORSTATS",$J,PROV,PNM)=CNT
"RTN","ORLPSRA",51,0)
SPROV ;sorts for a single provider
"RTN","ORLPSRA",52,0)
 I SORT=2&($D(LONER)) S LONER="",PAGE=0 F  S LONER=$O(LONER(LONER)) Q:LONER=""!STOP  D
"RTN","ORLPSRA",53,0)
 .I TYPE=1 S HDR="!!?30,""List of RELEASED but UNSIGNED orders for "",LONER"
"RTN","ORLPSRA",54,0)
 .I TYPE=2 S HDR="!!?30,""List of LAPSED orders for "",LONER"
"RTN","ORLPSRA",55,0)
 .I TYPE=3 S HDR="!!?30,""List of UNSIGNED/UNRELEASED orders for "",LONER"
"RTN","ORLPSRA",56,0)
 .S HDR1="!!,""PROVIDER"",?25,""ENTERED BY"",?50,""PATIENT"",?75,""SSN"",?81,""STATUS"",?91,""ORDER #"",?104,""ORDER DATE"",?118,""LAPSE DATE"""
"RTN","ORLPSRA",57,0)
 .D HDR^ORLPSR
"RTN","ORLPSRA",58,0)
 .S PROV=LONER I $D(^TMP("ORUNS",$J,PROV)) D
"RTN","ORLPSRA",59,0)
 ..S PNM="" F  S PNM=$O(^TMP("ORUNS",$J,PROV,PNM)) S CNT=0 Q:PNM=""!STOP  D
"RTN","ORLPSRA",60,0)
 ...S IEN=0 F  S IEN=$O(^TMP("ORUNS",$J,PROV,PNM,IEN)) S CNT=CNT+1 Q:'IEN!STOP  D
"RTN","ORLPSRA",61,0)
 ....I 'SUMONLY W $P(^(IEN),U),?25,$P(^(IEN),U,2),?50,$P(^(IEN),U,3),?75,$P(^(IEN),U,4),?81,$P(^(IEN),U,5),?91,$P(^(IEN),U,6),?104,$P(^(IEN),U,7),?118,$P(^(IEN),U,8),! D:$Y>(IOSL-4) HDR^ORLPSR Q:STOP
"RTN","ORLPSRA",62,0)
 ....S ^TMP("ORSTATS",$J,PROV,PNM)=CNT
"RTN","ORLPSRA",63,0)
 .I '$D(^TMP("ORUNS",$J,PROV)) W !!,"No lapsed orders found for "_LONER
"RTN","ORLPSRA",64,0)
PAT ;loops thru the TMP global for output sort by patient
"RTN","ORLPSRA",65,0)
 I SORT=3&('$D(LONER)) D
"RTN","ORLPSRA",66,0)
 .I TYPE=1 S HDR="!!?30,""List of RELEASED but UNSIGNED orders by PATIENT"""
"RTN","ORLPSRA",67,0)
 .I TYPE=2 S HDR="!!?40,""List of LAPSED orders by PATIENT"""
"RTN","ORLPSRA",68,0)
 .I TYPE=3 S HDR="!!?30,""List of UNSIGNED/UNRELEASED orders by PATIENT"""
"RTN","ORLPSRA",69,0)
 .S HDR1="!!,""PATIENT"",?25,""SSN"",?30,""PROVIDER"",?55,""ENTERED BY"",?81,""STATUS"",?91,""ORDER #"",?104,""ORDER DATE"",?118,""LAPSE DATE"""
"RTN","ORLPSRA",70,0)
 .S PAGE=0 D HDR^ORLPSR
"RTN","ORLPSRA",71,0)
 .I '$D(^TMP("ORUNS",$J)) W !,"No lapsed orders found" Q
"RTN","ORLPSRA",72,0)
 .S PNM="" F  S PNM=$O(^TMP("ORUNS",$J,PNM)) Q:PNM=""!STOP  D
"RTN","ORLPSRA",73,0)
 ..S PROV="" F  S PROV=$O(^TMP("ORUNS",$J,PNM,PROV)) S CNT=0 Q:PROV=""!STOP  D
"RTN","ORLPSRA",74,0)
 ...S IEN=0 F  S IEN=$O(^TMP("ORUNS",$J,PNM,PROV,IEN)) S CNT=CNT+1 Q:'IEN!STOP  D
"RTN","ORLPSRA",75,0)
 ....I 'SUMONLY W $P(^(IEN),U),?25,$P(^(IEN),U,2),?30,$P(^(IEN),U,3),?55,$P(^(IEN),U,4),?81,$P(^(IEN),U,5),?91,$P(^(IEN),U,6),?104,$P(^(IEN),U,7),?118,$P(^(IEN),U,8),! D:$Y>(IOSL-4) HDR^ORLPSR Q:STOP
"RTN","ORLPSRA",76,0)
 ....S ^TMP("ORSTATS",$J,PNM,PROV)=CNT
"RTN","ORLPSRA",77,0)
 ....;I $E(IOST)="E",$Y>(IOSL-105) W @IOF,@HDR
"RTN","ORLPSRA",78,0)
SPAT ;sorts for a single patient
"RTN","ORLPSRA",79,0)
 I SORT=3&($D(LONER)) S LONER="",PAGE=0 F  S LONER=$O(LONER(LONER)) Q:LONER=""!STOP  D
"RTN","ORLPSRA",80,0)
 .I TYPE=1 S HDR="!!?30,""List of RELEASED but UNSIGNED orders for "",LONER"
"RTN","ORLPSRA",81,0)
 .I TYPE=2 S HDR="!!?30,""List of LAPSED orders for "",LONER"
"RTN","ORLPSRA",82,0)
 .I TYPE=3 S HDR="!!?30,""List of UNSIGNED/UNRELEASED orders for "",LONER"
"RTN","ORLPSRA",83,0)
 .S HDR1="!!,""PATIENT"",?25,""SSN"",?30,""PROVIDER"",?55,""ENTERED BY"",?81,""STATUS"",?91,""ORDER #"",?104,""ORDER DATE"",?118,""LAPSE DATE"""
"RTN","ORLPSRA",84,0)
 .D HDR^ORLPSR
"RTN","ORLPSRA",85,0)
 .S PNM=LONER I $D(^TMP("ORUNS",$J,PNM)) D
"RTN","ORLPSRA",86,0)
 ..S PROV="" F  S PROV=$O(^TMP("ORUNS",$J,PNM,PROV)) S CNT=0 Q:PROV=""!STOP  D
"RTN","ORLPSRA",87,0)
 ...S IEN=0 F  S IEN=$O(^TMP("ORUNS",$J,PNM,PROV,IEN)) S CNT=CNT+1 Q:'IEN!STOP  D
"RTN","ORLPSRA",88,0)
 ....I 'SUMONLY W $P(^(IEN),U),?25,$P(^(IEN),U,2),?30,$P(^(IEN),U,3),?55,$P(^(IEN),U,4),?81,$P(^(IEN),U,5),?91,$P(^(IEN),U,6),?104,$P(^(IEN),U,7),?118,$P(^(IEN),U,8),! D:$Y>(IOSL-4) HDR^ORLPSR Q:STOP
"RTN","ORLPSRA",89,0)
 ....S ^TMP("ORSTATS",$J,PNM,PROV)=CNT
"RTN","ORLPSRA",90,0)
 .I '$D(^TMP("ORUNS",$J,PNM)) W !!,"No lapsed orders found for "_LONER
"RTN","ORLPSRA",91,0)
WARD ;loops thru the TMP global for output sort by location
"RTN","ORLPSRA",92,0)
 I SORT=4&('$D(LONER)) D
"RTN","ORLPSRA",93,0)
 .I TYPE=1 S HDR="!!?30,""List of RELEASED but UNSIGNED orders by LOCATION"""
"RTN","ORLPSRA",94,0)
 .I TYPE=2 S HDR="!!?30,""List of LAPSED orders by LOCATION"""
"RTN","ORLPSRA",95,0)
 .I TYPE=3 S HDR="!!?30,""List of UNSIGNED/UNRELEASED orders by LOCATION"""
"RTN","ORLPSRA",96,0)
 .S HDR1="!!,""PROVIDER"",?25,""ENTERED BY"",?50,""PATIENT"",?75,""SSN"",?81,""STATUS"",?91,""ORDER #"",?104,""ORDER DATE"",?118,""LAPSE DATE"""
"RTN","ORLPSRA",97,0)
 .S PAGE=0 D HDR^ORLPSR
"RTN","ORLPSRA",98,0)
 .I '$D(^TMP("ORUNS",$J)) W !,"No lapsed orders found" Q
"RTN","ORLPSRA",99,0)
 .S LOC="" F  S LOC=$O(^TMP("ORUNS",$J,LOC)) Q:LOC=""!STOP  W:'SUMONLY "Location: ",LOC,! D
"RTN","ORLPSRA",100,0)
 ..S PROV="" F  S PROV=$O(^TMP("ORUNS",$J,LOC,PROV)) S CNT=0 Q:PROV=""!STOP  D
"RTN","ORLPSRA",101,0)
 ...S IEN=0 F  S IEN=$O(^TMP("ORUNS",$J,LOC,PROV,IEN)) S CNT=CNT+1 Q:'IEN!STOP  D
"RTN","ORLPSRA",102,0)
 ....I 'SUMONLY W $P(^TMP("ORUNS",$J,LOC,PROV,IEN),U,2),?25,$P(^(IEN),U,3),?50,$P(^(IEN),U,4),?75,$P(^(IEN),U,5),?81,$P(^(IEN),U,6),?91,$P(^(IEN),U,7),?104,$P(^(IEN),U,8),?118,$P(^(IEN),U,9),! D:$Y>(IOSL-4) HDR^ORLPSR Q:STOP
"RTN","ORLPSRA",103,0)
 ....S ^TMP("ORSTATS",$J,LOC,PROV)=CNT
"RTN","ORLPSRA",104,0)
 ..W !
"RTN","ORLPSRA",105,0)
 ;
"RTN","ORLPSRA",106,0)
SWARD ;sorts for a single location
"RTN","ORLPSRA",107,0)
 I SORT=4&($D(LONER)) S LONER="",PAGE=0 F  S LONER=$O(LONER(LONER)) Q:LONER=""!STOP  D
"RTN","ORLPSRA",108,0)
 .I TYPE=1 S HDR="!!?30,""List of RELEASED but UNSIGNED orders for "",LONER"
"RTN","ORLPSRA",109,0)
 .I TYPE=2 S HDR="!!?30,""List of LAPSED orders for "",LONER"
"RTN","ORLPSRA",110,0)
 .I TYPE=3 S HDR="!!?30,""List of UNSIGNED/UNRELEASED orders for "",LONER"
"RTN","ORLPSRA",111,0)
 .S HDR1="!!,""PROVIDER"",?25,""ENTERED BY"",?50,""PATIENT"",?75,""SSN"",?81,""STATUS"",?91,""ORDER #"",?104,""ORDER DATE"",?118,""LAPSE DATE"""
"RTN","ORLPSRA",112,0)
 .D HDR^ORLPSR
"RTN","ORLPSRA",113,0)
 .S LOC=LONER I $D(^TMP("ORUNS",$J,LOC)) D
"RTN","ORLPSRA",114,0)
 ..S PROV="" F  S PROV=$O(^TMP("ORUNS",$J,LOC,PROV)) S CNT=0 Q:PROV=""!STOP  D
"RTN","ORLPSRA",115,0)
 ...S IEN=0 F  S IEN=$O(^TMP("ORUNS",$J,LOC,PROV,IEN)) S CNT=CNT+1 Q:'IEN!STOP  D
"RTN","ORLPSRA",116,0)
 ....I 'SUMONLY W $P(^TMP("ORUNS",$J,LOC,PROV,IEN),U,2),?25,$P(^(IEN),U,3),?50,$P(^(IEN),U,4),?75,$P(^(IEN),U,5),?81,$P(^(IEN),U,6),?91,$P(^(IEN),U,7),?104,$P(^(IEN),U,8),?118,$P(^(IEN),U,9),! D:$Y>(IOSL-4) HDR^ORLPSR Q:STOP
"RTN","ORLPSRA",117,0)
 ....S ^TMP("ORSTATS",$J,LOC,PROV)=CNT
"RTN","ORLPSRA",118,0)
 .I '$D(^TMP("ORUNS",$J,LOC)) W !!,"No lapsed orders found for "_LONER
"RTN","ORLPSRA",119,0)
 I SORT=1 D SERV^ORLPSRB
"RTN","ORLPSRA",120,0)
 I SORT=5 D WHO^ORLPSRB
"RTN","ORLPSRA",121,0)
 I SORT=6 D DIV^ORLPSRB
"RTN","ORLPSRA",122,0)
 I 'STOP D STATS^ORLPSR
"RTN","ORLPSRA",123,0)
EXIT K ^TMP("ORUNS",$J),^TMP("ORSTATS",$J)
"RTN","ORLPSRA",124,0)
 D ^%ZISC
"RTN","ORLPSRA",125,0)
 Q
"RTN","ORLPSRB")
0^139^B38794452
"RTN","ORLPSRB",1,0)
ORLPSRB ;SLC/RAF - Continuation of ORLPSRA  ; 3/31/08 6:23am
"RTN","ORLPSRB",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORLPSRB",3,0)
 ;
"RTN","ORLPSRB",4,0)
WHO ;loops thru the TMP global for output sort by entering person
"RTN","ORLPSRB",5,0)
 I SORT=5&('$D(LONER)) D
"RTN","ORLPSRB",6,0)
 .I TYPE=1 S HDR="!!?30,""List of RELEASED but UNSIGNED orders by ENTERING PERSON"""
"RTN","ORLPSRB",7,0)
 .I TYPE=2 S HDR="!!?40,""List of LAPSED orders by ENTERING PERSON"""
"RTN","ORLPSRB",8,0)
 .I TYPE=3 S HDR="!!?30,""List of UNSIGNED/UNRELEASED orders by ENTERING PERSON"""
"RTN","ORLPSRB",9,0)
 .S HDR1="!!,""ENTERED BY"",?23,""PROVIDER"",?46,""PATIENT"",?71,""SSN"",?77,""STATUS"",?87,""ORDER #"",?100,""ORDER DATE"",?118,""LAPSE DATE"""
"RTN","ORLPSRB",10,0)
 .S PAGE=0 D HDR^ORLPSR
"RTN","ORLPSRB",11,0)
 .I '$D(^TMP("ORUNS",$J)) W !,"No lapsed orders found" Q
"RTN","ORLPSRB",12,0)
 .S WHO="" F  S WHO=$O(^TMP("ORUNS",$J,WHO)) Q:WHO=""!STOP  D
"RTN","ORLPSRB",13,0)
 ..S PNM="" F  S PNM=$O(^TMP("ORUNS",$J,WHO,PNM)) S CNT=0 Q:PNM=""!STOP  D
"RTN","ORLPSRB",14,0)
 ...S IEN=0 F  S IEN=$O(^TMP("ORUNS",$J,WHO,PNM,IEN)) S CNT=CNT+1 Q:'IEN!STOP  D
"RTN","ORLPSRB",15,0)
 ....I 'SUMONLY W $P(^(IEN),U),?23,$P(^(IEN),U,2),?46,$P(^(IEN),U,3),?71,$P(^(IEN),U,4),?77,$P(^(IEN),U,5),?87,$P(^(IEN),U,6),?100,$P(^(IEN),U,7),?118,$P(^(IEN),U,8),! D:$Y>(IOSL-4) HDR^ORLPSR Q:STOP
"RTN","ORLPSRB",16,0)
 ....S ^TMP("ORSTATS",$J,WHO,PNM)=CNT
"RTN","ORLPSRB",17,0)
SWHO ;sorts for a single provider/entering person
"RTN","ORLPSRB",18,0)
 I SORT=5&($D(LONER)) S LONER="",PAGE=0 F  S LONER=$O(LONER(LONER)) Q:LONER=""!STOP  D
"RTN","ORLPSRB",19,0)
 .I TYPE=1 S HDR="!!?30,""List of RELEASED but UNSIGNED orders for "",LONER"
"RTN","ORLPSRB",20,0)
 .I TYPE=2 S HDR="!!?30,""List of LAPSED orders for "",LONER"
"RTN","ORLPSRB",21,0)
 .I TYPE=3 S HDR="!!?30,""List of UNSIGNED/UNRELEASED orders for "",LONER"
"RTN","ORLPSRB",22,0)
 .S HDR1="!!,""ENTERED BY"",?23,""PROVIDER"",?46,""PATIENT"",?71,""SSN"",?77,""STATUS"",?87,""ORDER #"",?100,""ORDER DATE"",?118,""LAPSE DATE"""
"RTN","ORLPSRB",23,0)
 .D HDR^ORLPSR
"RTN","ORLPSRB",24,0)
 .S WHO=LONER I $D(^TMP("ORUNS",$J,WHO)) D
"RTN","ORLPSRB",25,0)
 ..S PNM="" F  S PNM=$O(^TMP("ORUNS",$J,WHO,PNM)) S CNT=0 Q:PNM=""!STOP  D
"RTN","ORLPSRB",26,0)
 ...S IEN=0 F  S IEN=$O(^TMP("ORUNS",$J,WHO,PNM,IEN)) S CNT=CNT+1 Q:'IEN!STOP  D
"RTN","ORLPSRB",27,0)
 ....I 'SUMONLY W $P(^(IEN),U),?23,$P(^(IEN),U,2),?46,$P(^(IEN),U,3),?71,$P(^(IEN),U,4),?77,$P(^(IEN),U,5),?87,$P(^(IEN),U,6),?100,$P(^(IEN),U,7),?118,$P(^(IEN),U,8),! D:$Y>(IOSL-4) HDR^ORLPSR Q:STOP
"RTN","ORLPSRB",28,0)
 ....S ^TMP("ORSTATS",$J,WHO,PNM)=CNT
"RTN","ORLPSRB",29,0)
 .I '$D(^TMP("ORUNS",$J,WHO)) W !!,"No lapsed orders found for "_LONER
"RTN","ORLPSRB",30,0)
DIV ;loops thru the TMP global for output sort by division
"RTN","ORLPSRB",31,0)
 I SORT=6&('$D(LONER)) D
"RTN","ORLPSRB",32,0)
 .I TYPE=1 S HDR="!!?30,""List of RELEASED but UNSIGNED orders by DIVISION"""
"RTN","ORLPSRB",33,0)
 .I TYPE=2 S HDR="!!?30,""List of LAPSED orders by DIVISION"""
"RTN","ORLPSRB",34,0)
 .I TYPE=3 S HDR="!!?30,""List of UNSIGNED/UNRELEASED orders by DIVISION"""
"RTN","ORLPSRB",35,0)
 .S HDR1="!!?15,""ENTERED BY"",?40,""PATIENT"",?65,""SSN"",?71,""STATUS"",?90,""ORDER #"",?102,""ORDER DATE"",?118,""LAPSE DATE"""
"RTN","ORLPSRB",36,0)
 .S PAGE=0 D HDR^ORLPSR
"RTN","ORLPSRB",37,0)
 .I '$D(^TMP("ORUNS",$J)) W !,"No lapsed orders found" Q
"RTN","ORLPSRB",38,0)
 .S DIV="" F  S DIV=$O(^TMP("ORUNS",$J,DIV)) Q:DIV=""!STOP  W:'SUMONLY "Division: ",DIV D
"RTN","ORLPSRB",39,0)
 ..S LOC="" F  S LOC=$O(^TMP("ORUNS",$J,DIV,LOC)) Q:LOC=""!STOP  W:'SUMONLY !?5,"Location: ",LOC D
"RTN","ORLPSRB",40,0)
 ...S PROV="" F  S PROV=$O(^TMP("ORUNS",$J,DIV,LOC,PROV)) Q:PROV=""!STOP  W:'SUMONLY !?10,"Provider: ",PROV,! S CNT=0 D
"RTN","ORLPSRB",41,0)
 ....S IEN=0 F  S IEN=$O(^TMP("ORUNS",$J,DIV,LOC,PROV,IEN)) S CNT=CNT+1 Q:'IEN!STOP  D
"RTN","ORLPSRB",42,0)
 .....W:'SUMONLY ?15,$S(PROV'=$P(^TMP("ORUNS",$J,DIV,LOC,PROV,IEN),U,4):$P(^(IEN),U,4),1:""),?40,$P(^(IEN),U,5),?65,$P(^(IEN),U,6),?71,$P(^(IEN),U,7),?90,$P(^(IEN),U,8),?102,$P(^(IEN),U,9),?118,$P(^(IEN),U,10),! D:$Y>(IOSL-4) HDR^ORLPSR Q:STOP
"RTN","ORLPSRB",43,0)
 .....S ^TMP("ORSTATS",$J,DIV,LOC,PROV)=CNT
"RTN","ORLPSRB",44,0)
SDIV ;sorts for a single division
"RTN","ORLPSRB",45,0)
 I SORT=6&($D(LONER)) S LONER="",PAGE=0 F  S LONER=$O(LONER(LONER)) Q:LONER=""!STOP  D
"RTN","ORLPSRB",46,0)
 .I TYPE=1 S HDR="!!?30,""List of RELEASED but UNSIGNED orders for "",LONER"
"RTN","ORLPSRB",47,0)
 .I TYPE=2 S HDR="!!?30,""List of LAPSED orders for "",LONER"
"RTN","ORLPSRB",48,0)
 .I TYPE=3 S HDR="!!?30,""List of UNSIGNED/UNRELEASED orders for "",LONER"
"RTN","ORLPSRB",49,0)
 .S HDR1="!!,""PROVIDER"",?23,""ENTERED BY"",?46,""PATIENT"",?69,""SSN"",?72,""STATUS"",?87,""ORDER #"",?100,""ORDER DATE"",?116,""LAPSE DATE"""
"RTN","ORLPSRB",50,0)
 .D HDR^ORLPSR
"RTN","ORLPSRB",51,0)
 .S DIV=LONER I $D(^TMP("ORUNS",$J,DIV)) D
"RTN","ORLPSRB",52,0)
 ..S LOC="" F  S LOC=$O(^TMP("ORUNS",$J,DIV,LOC)) Q:LOC=""!STOP  W:'SUMONLY ?5,"Location: ",LOC,! D  W:'SUMONLY !
"RTN","ORLPSRB",53,0)
 ...S PROV="" F  S PROV=$O(^TMP("ORUNS",$J,DIV,LOC,PROV)) S CNT=0 Q:PROV=""!STOP  D
"RTN","ORLPSRB",54,0)
 ....S IEN="" F  S IEN=$O(^TMP("ORUNS",$J,DIV,LOC,PROV,IEN)) S CNT=CNT+1 Q:'IEN!STOP  D
"RTN","ORLPSRB",55,0)
 .....W:'SUMONLY $P(^(IEN),U,3),?23,$P(^(IEN),U,4),?46,$P(^(IEN),U,5),?69,$P(^(IEN),U,6),?72,$P(^(IEN),U,7),?87,$P(^(IEN),U,8),?100,$P(^(IEN),U,9),?116,$P(^(IEN),U,10),! D:$Y>(IOSL-4) HDR^ORLPSR Q:STOP
"RTN","ORLPSRB",56,0)
 .....S ^TMP("ORSTATS",$J,DIV,LOC,PROV)=CNT
"RTN","ORLPSRB",57,0)
 .I '$D(^TMP("ORUNS",$J,DIV)) W !!,"No lapsed orders found for "_LONER
"RTN","ORLPSRB",58,0)
SERV ;loops thru the TMP global for output sort by service
"RTN","ORLPSRB",59,0)
 I SORT=1&('$D(LONER)) D
"RTN","ORLPSRB",60,0)
 .I TYPE=1 S HDR="!!?30,""List of RELEASED but UNSIGNED orders by SERVICE/SECTION"""
"RTN","ORLPSRB",61,0)
 .I TYPE=2 S HDR="!!?30,""List of LAPSED orders by SERVICE/SECTION"""
"RTN","ORLPSRB",62,0)
 .I TYPE=3 S HDR="!!?30,""List of UNSIGNED/UNRELEASED orders by SERVICE/SECTION"""
"RTN","ORLPSRB",63,0)
 .S HDR1="!!,""PROVIDER"",?23,""ENTERED BY"",?46,""PATIENT"",?71,""SSN"",?77,""STATUS"",?87,""ORDER #"",?104,""ORDER DATE"",?120,""LAPSE DATE"""
"RTN","ORLPSRB",64,0)
 .S PAGE=0 D HDR^ORLPSR
"RTN","ORLPSRB",65,0)
 .I '$D(^TMP("ORUNS",$J)) W !,"No lapsed orders found" Q
"RTN","ORLPSRB",66,0)
 .S SER="" F  S SER=$O(^TMP("ORUNS",$J,SER)) Q:SER=""!STOP  W:'SUMONLY "Service/Section: ",SER,! D  W:'SUMONLY !
"RTN","ORLPSRB",67,0)
 ..S PROV="" F  S PROV=$O(^TMP("ORUNS",$J,SER,PROV)) S CNT=0 Q:PROV=""!STOP  D
"RTN","ORLPSRB",68,0)
 ...S IEN=0 F  S IEN=$O(^TMP("ORUNS",$J,SER,PROV,IEN)) S CNT=CNT+1 Q:'IEN!STOP  D
"RTN","ORLPSRB",69,0)
 ....W:'SUMONLY $P(^TMP("ORUNS",$J,SER,PROV,IEN),U,2),?23,$P(^(IEN),U,3),?46,$P(^(IEN),U,4),?71,$P(^(IEN),U,5),?77,$P(^(IEN),U,6),?87,$P(^(IEN),U,7),?104,$P(^(IEN),U,8),?120,$P(^(IEN),U,9),! D:$Y>(IOSL-4) HDR^ORLPSR Q:STOP
"RTN","ORLPSRB",70,0)
 ....S ^TMP("ORSTATS",$J,SER,PROV)=CNT
"RTN","ORLPSRB",71,0)
SSERV ;sorts for a single service/section
"RTN","ORLPSRB",72,0)
 I SORT=1&($D(LONER)) S LONER="",PAGE=0 F  S LONER=$O(LONER(LONER)) Q:LONER=""!STOP  D
"RTN","ORLPSRB",73,0)
 .I TYPE=1 S HDR="!!?30,""List of RELEASED but UNSIGNED orders for "",LONER"
"RTN","ORLPSRB",74,0)
 .I TYPE=2 S HDR="!!?30,""List of LAPSED orders for "",LONER"
"RTN","ORLPSRB",75,0)
 .I TYPE=3 S HDR="!!?30,""List of UNSIGNED/UNRELEASED orders for "",LONER"
"RTN","ORLPSRB",76,0)
 .S HDR1="!!,""PROVIDER"",?23,""ENTERED BY"",?46,""PATIENT"",?71,""SSN"",?77,""STATUS"",?87,""ORDER #"",?104,""ORDER DATE"",?120,""LAPSE DATE"""
"RTN","ORLPSRB",77,0)
 .D HDR^ORLPSR
"RTN","ORLPSRB",78,0)
 .S SER=LONER I $D(^TMP("ORUNS",$J,SER)) D
"RTN","ORLPSRB",79,0)
 ..S PROV="" F  S PROV=$O(^TMP("ORUNS",$J,SER,PROV)) S CNT=0 Q:PROV=""!STOP  D
"RTN","ORLPSRB",80,0)
 ...S IEN=0 F  S IEN=$O(^TMP("ORUNS",$J,SER,PROV,IEN)) S CNT=CNT+1 Q:'IEN!STOP  D
"RTN","ORLPSRB",81,0)
 ....W:'SUMONLY $P(^(IEN),U,2),?23,$P(^(IEN),U,3),?46,$P(^(IEN),U,4),?71,$P(^(IEN),U,5),?77,$P(^(IEN),U,6),?87,$P(^(IEN),U,7),?104,$P(^(IEN),U,8),?120,$P(^(IEN),U,9),! D:$Y>(IOSL-4) HDR^ORLPSR Q:STOP
"RTN","ORLPSRB",82,0)
 ....S ^TMP("ORSTATS",$J,SER,PROV)=CNT
"RTN","ORLPSRB",83,0)
 .I '$D(^TMP("ORUNS",$J,SER)) W !!,"No lapsed orders found for "_LONER
"RTN","ORLPSRB",84,0)
 Q
"RTN","ORLSTVIZ")
0^64^B5546292
"RTN","ORLSTVIZ",1,0)
ORLSTVIZ ; SLC/WAT - Editing Team List Visibility ;9/14/06 14:00
"RTN","ORLSTVIZ",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORLSTVIZ",3,0)
 ;
"RTN","ORLSTVIZ",4,0)
 ;PROMPT THE USER FOR A LIST OR LISTS FOR WHICH TO SET VISIBILITY
"RTN","ORLSTVIZ",5,0)
 ;SHOW THE POSSIBLE OPTIONS FOR VISIBILITY:
"RTN","ORLSTVIZ",6,0)
 ;       '0' = NOBODY
"RTN","ORLSTVIZ",7,0)
 ;       '1' = ALLUSERS
"RTN","ORLSTVIZ",8,0)
 ;DIC,DIR,DIE - FileMan call
"RTN","ORLSTVIZ",9,0)
 ;                 DA - input variable to ^DIE - internal entry number of the file entry to be edited
"RTN","ORLSTVIZ",10,0)
 ;                 DR - input variable to ^DIE - as used here it's the field number in file stuffed with user-chosen VISBILITY value
"RTN","ORLSTVIZ",11,0)
 ;          DTOUT - output from ^DIC-only defined when DIC times out
"RTN","ORLSTVIZ",12,0)
 ;          DUOUT - output from ^DIC-only defined when user enters carat
"RTN","ORLSTVIZ",13,0)
 ;          DIRUT - output from ^DIR-defined when user enters carat, presses Return/Enter, or times out
"RTN","ORLSTVIZ",14,0)
 ;          Y - Returned from FM call-returns "-1" is lookup was unsuccessful
"RTN","ORLSTVIZ",15,0)
 ;       Y(0) - Returned from ^DIC-hold external value of chosen VISIBILITY by user
"RTN","ORLSTVIZ",16,0)
 ;        IEN - IEN of list from 100.21
"RTN","ORLSTVIZ",17,0)
 ;        VIS - VISIBILITY value from 100.21
"RTN","ORLSTVIZ",18,0)
 ;        CNT - counter/array index position
"RTN","ORLSTVIZ",19,0)
 ;       LIST - NAME value from 100.21
"RTN","ORLSTVIZ",20,0)
 ;        VIS - VISIBILITY value from 100.21
"RTN","ORLSTVIZ",21,0)
 N DIC,DIR,DIE,DA,DR,DTOUT,DUOUT,DIRUT,Y,LIST,VIS,CNT,IEN,VAL
"RTN","ORLSTVIZ",22,0)
 K ^TMP("ORLST",$J)
"RTN","ORLSTVIZ",23,0)
 S DIC="^OR(100.21,",DIC(0)="AEQZ",CNT=0
"RTN","ORLSTVIZ",24,0)
 W !,"You may set the VISIBILITY for one or more lists."
"RTN","ORLSTVIZ",25,0)
 W !,"Please enter your selection(s) below."
"RTN","ORLSTVIZ",26,0)
LKUP F  D ^DIC Q:$D(DTOUT)!($D(DUOUT))!(Y=-1)  I Y>0 S ^TMP("ORLST",$J,CNT)=$P(Y,U,1) S ^TMP("ORLST",$J,CNT,CNT+1)=$P(Y,U,2) S ^TMP("ORLST",$J,CNT,CNT+1,CNT+2)=$$GET1^DIQ(100.21,^TMP("ORLST",$J,0),11) S CNT=CNT+1
"RTN","ORLSTVIZ",27,0)
 Q:$D(DTOUT)!($D(DUOUT))
"RTN","ORLSTVIZ",28,0)
 Q:'$D(^TMP("ORLST",$J,0))
"RTN","ORLSTVIZ",29,0)
 ;*********For each selected list(s), display current NAME and VISIBILITY*******
"RTN","ORLSTVIZ",30,0)
 W !!,"You have chosen to update the following list(s):"
"RTN","ORLSTVIZ",31,0)
 S (IEN,LIST,VIS)=""
"RTN","ORLSTVIZ",32,0)
 F  S IEN=$O(^TMP("ORLST",$J,IEN)) Q:IEN=""  D
"RTN","ORLSTVIZ",33,0)
 . S LIST=$O(^TMP("ORLST",$J,IEN,LIST)) Q:LIST=""  W !?5,^TMP("ORLST",$J,IEN,LIST) D
"RTN","ORLSTVIZ",34,0)
 . .S VIS=$O(^TMP("ORLST",$J,IEN,LIST,VIS)) Q:VIS=""  W ?37,"Current value: "_^TMP("ORLST",$J,IEN,LIST,VIS)
"RTN","ORLSTVIZ",35,0)
 W !!,""
"RTN","ORLSTVIZ",36,0)
 ;
"RTN","ORLSTVIZ",37,0)
READER S DIR(0)="100.21,11",DIR("B")="ALLUSERS"
"RTN","ORLSTVIZ",38,0)
 D ^DIR Q:$D(DIRUT)
"RTN","ORLSTVIZ",39,0)
 ;
"RTN","ORLSTVIZ",40,0)
 S VAL=Y(0)  ;capture user-selected VISIBILTY value
"RTN","ORLSTVIZ",41,0)
EDIT S IEN="",DIE=DIC,DR="11///^S X=VAL" ; 11 is VISIBILITY field in 100.21
"RTN","ORLSTVIZ",42,0)
 F  S IEN=$O(^TMP("ORLST",$J,IEN)) Q:IEN=""  D
"RTN","ORLSTVIZ",43,0)
 .S DA=^TMP("ORLST",$J,IEN)
"RTN","ORLSTVIZ",44,0)
 .D ^DIE
"RTN","ORLSTVIZ",45,0)
 K ^TMP("ORLST",$J)
"RTN","ORLSTVIZ",46,0)
 W @IOF
"RTN","ORLSTVIZ",47,0)
 W !!,"Update Complete"
"RTN","ORLSTVIZ",48,0)
 Q
"RTN","ORMBLDP1")
0^143^B3663295
"RTN","ORMBLDP1",1,0)
ORMBLDP1 ;SLC/MKB-Build outgoing Pharmacy ORM msgs ;05/09/2007
"RTN","ORMBLDP1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORMBLDP1",3,0)
 ;
"RTN","ORMBLDP1",4,0)
MOB(ORIEN,DFN) ;
"RTN","ORMBLDP1",5,0)
 N IVTYPE,NODE,NUM,TYPE
"RTN","ORMBLDP1",6,0)
 S IVTYPE=""
"RTN","ORMBLDP1",7,0)
 D MOB^PSBAPIPM(DFN,ORIEN)
"RTN","ORMBLDP1",8,0)
 S NODE=$G(^TMP("PSB",$J,0)) I NODE=-1 Q IVTYPE
"RTN","ORMBLDP1",9,0)
 S TYPE=$P(NODE,U,3)
"RTN","ORMBLDP1",10,0)
 S NUM=+$P(NODE,U,4)
"RTN","ORMBLDP1",11,0)
 I TYPE="A" S IVTYPE="C" Q IVTYPE
"RTN","ORMBLDP1",12,0)
 I TYPE="P" S IVTYPE="I" Q IVTYPE
"RTN","ORMBLDP1",13,0)
 I TYPE="S",NUM=0 S IVTYPE="C" Q IVTYPE
"RTN","ORMBLDP1",14,0)
 I TYPE="S",NUM=1 S IVTYPE="I" Q IVTYPE
"RTN","ORMBLDP1",15,0)
 Q IVTYPE
"RTN","ORMBLDP1",16,0)
 ;
"RTN","ORMBLDP1",17,0)
HL7IVLMT(STR) ;
"RTN","ORMBLDP1",18,0)
 N LEN,VAL,UNIT,IVLMT,TVAL
"RTN","ORMBLDP1",19,0)
 S (UNIT,IVLMT)="",VAL=0
"RTN","ORMBLDP1",20,0)
 I $E($$LOW^XLFSTR(STR))="f" D
"RTN","ORMBLDP1",21,0)
 . I STR["for a total of" D  Q
"RTN","ORMBLDP1",22,0)
 . .S VAL=$P(STR," ",5)
"RTN","ORMBLDP1",23,0)
 . .S UNIT=$P(STR," ",6)
"RTN","ORMBLDP1",24,0)
 . S VAL=$P(STR," ",2)
"RTN","ORMBLDP1",25,0)
 . S UNIT=$E($P(STR," ",3))
"RTN","ORMBLDP1",26,0)
 I $E($$LOW^XLFSTR(STR))="w" D
"RTN","ORMBLDP1",27,0)
 . S TVAL=$P(STR," ",4)      ;pull data in total example 0.5ml
"RTN","ORMBLDP1",28,0)
 . S VAL=+TVAL     ;this will strip out leading zero and alpha 00.5L becomes .5 or 05.5 becomes 5.5
"RTN","ORMBLDP1",29,0)
 . S LEN=$F(TVAL,VAL)        ;get length up to alphas or trailing zeros
"RTN","ORMBLDP1",30,0)
 . I $P(VAL,".")="" S VAL=0_VAL  ;make sure decimal values have only one leading zero .5 becomes 0.5.
"RTN","ORMBLDP1",31,0)
 . F  S UNIT=$E(TVAL,LEN) Q:((UNIT'=0)&(UNIT'="."))  D    ;get first alpha m or l
"RTN","ORMBLDP1",32,0)
 . . S LEN=LEN+1
"RTN","ORMBLDP1",33,0)
 I $L(UNIT),$L(VAL) S IVLMT=$$LOW^XLFSTR(UNIT)_VAL
"RTN","ORMBLDP1",34,0)
 Q IVLMT
"RTN","ORMBLDPS")
0^73^B74740266
"RTN","ORMBLDPS",1,0)
ORMBLDPS ;SLC/MKB-Build outgoing Pharmacy ORM msgs ;6/16/08
"RTN","ORMBLDPS",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,38,54,86,97,94,116,129,141,190,195,237,254,243**;Dec 17, 1997;Build 242
"RTN","ORMBLDPS",3,0)
PTR(NAME) ; -- Returns ptr value of prompt in Dialog file
"RTN","ORMBLDPS",4,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_NAME,1,63),0))
"RTN","ORMBLDPS",5,0)
 ;
"RTN","ORMBLDPS",6,0)
NVA ; -- new Non-VA Meds order
"RTN","ORMBLDPS",7,0)
 N NVA S NVA=1
"RTN","ORMBLDPS",8,0)
OUT ; -- new Outpt Meds order [same as UD, +3 fields]
"RTN","ORMBLDPS",9,0)
UD ; -- new Inpt (Unit Dose) Meds order
"RTN","ORMBLDPS",10,0)
 N ADMIN,OI,DRUG,INSTR,DOSE,ROUTE,SCHED,DUR,URG,PROVCOMM,PI,DISPENSE,X,Y,I,J,K,L,QT1,QT2,QT3,QT4,QT6,QT9,CONJ,ORC,SC,OUTPT,OITXT,OITXT2
"RTN","ORMBLDPS",11,0)
 N QT7,SCHTYPE
"RTN","ORMBLDPS",12,0)
 S OUTPT=$S($P(OR0,U,12)="O":1,1:0) ;outpt flag
"RTN","ORMBLDPS",13,0)
 S X=$G(^OR(100,IFN,8,1,0)) I $P(X,U,5),$P(X,U,5)'=$P(X,U,3) S $P(ORMSG(4),"|",13)=$P(X,U,5) ; Send signer instead of orderer if different
"RTN","ORMBLDPS",14,0)
 S OI=$$PTR("ORDERABLE ITEM"),DRUG=$$PTR("DISPENSE DRUG")
"RTN","ORMBLDPS",15,0)
 S INSTR=$$PTR("INSTRUCTIONS"),SCHED=$$PTR("SCHEDULE"),ADMIN=$$PTR("ADMIN TIMES")
"RTN","ORMBLDPS",16,0)
 S SCHTYPE=$$PTR("SCHEDULE TYPE")
"RTN","ORMBLDPS",17,0)
 S DUR=$$PTR("DURATION"),URG=$$PTR("URGENCY"),DOSE=$$PTR("DOSE")
"RTN","ORMBLDPS",18,0)
 S ROUTE=$$PTR("ROUTE"),PROVCOMM=$$PTR("WORD PROCESSING 1")
"RTN","ORMBLDPS",19,0)
 S PI=$$PTR("PATIENT INSTRUCTIONS"),CONJ=$$PTR("AND/THEN")
"RTN","ORMBLDPS",20,0)
 S J=1,ORC(J)=$P(ORMSG(4),"|",1,7)_"|"
"RTN","ORMBLDPS",21,0)
 I +$G(NVA)=1 G NVA1
"RTN","ORMBLDPS",22,0)
UD1 S I=0 F  S I=$O(ORDIALOG(INSTR,I)) Q:I'>0  D
"RTN","ORMBLDPS",23,0)
 . S X=$G(ORDIALOG(DOSE,I))
"RTN","ORMBLDPS",24,0)
 . ;S QT1=$S($L(X):$P(X,"&",1,4)_"&"_$P(X,"&",6),1:"")
"RTN","ORMBLDPS",25,0)
 . S QT2=$$ESC($G(ORDIALOG(SCHED,I)))_$S(OUTPT:"",1:"&"_$G(ORDIALOG(ADMIN,I)))
"RTN","ORMBLDPS",26,0)
 . S QT3=$$HL7DUR
"RTN","ORMBLDPS",27,0)
 . S QT1=$S($L(X):$P(X,"&",1,6),1:"")
"RTN","ORMBLDPS",28,0)
 . S QT6=$P($G(^ORD(101.42,+$G(ORDIALOG(URG,I)),0)),U,2)
"RTN","ORMBLDPS",29,0)
 . S QT7=$G(ORDIALOG(SCHTYPE,I))
"RTN","ORMBLDPS",30,0)
 . S QT9=$G(ORDIALOG(CONJ,I))_"~" S:$E(QT9)="T" QT9="S~"
"RTN","ORMBLDPS",31,0)
 . S J=J+1,ORC(J)=QT1_U_QT2_U_QT3_"^^^"_QT6_U_QT7_U_$$INSTR_U_QT9
"RTN","ORMBLDPS",32,0)
 ;
"RTN","ORMBLDPS",33,0)
NVA1 I +$G(NVA)=1 D
"RTN","ORMBLDPS",34,0)
 . S I=1 ;only one dosage possible for non-va meds
"RTN","ORMBLDPS",35,0)
 . S QT2=$G(ORDIALOG(SCHED,I)),QT3=$$HL7DUR,X=$G(ORDIALOG(DOSE,I))
"RTN","ORMBLDPS",36,0)
 . S QT1=$S($L(X):$P(X,"&",1,6),1:"")
"RTN","ORMBLDPS",37,0)
 . S QT6=$P($G(^ORD(101.42,+$G(ORDIALOG(URG,I)),0)),U,2)
"RTN","ORMBLDPS",38,0)
 . S QT9=$G(ORDIALOG(CONJ,I))_"~" S:$E(QT9)="T" QT9="S~"
"RTN","ORMBLDPS",39,0)
 . S J=J+1,ORC(J)=QT1_U_$$ESC(QT2)_U_QT3_"^^^"_QT6_"^^"_$$INSTR_U_QT9
"RTN","ORMBLDPS",40,0)
 ;
"RTN","ORMBLDPS",41,0)
 I $L($P(OR0,U,8)) S $P(ORC(2),U,4)=$$FMTHL7^XLFDT($P(OR0,U,8)) S:J<2 J=2
"RTN","ORMBLDPS",42,0)
 S J=J+1,ORC(J)="|"_$P(ORMSG(4),"|",9,999),ORC=J,X="ORMSG(4)",ORMSG(4)="",I=0
"RTN","ORMBLDPS",43,0)
 F J=1:1:ORC S Y=ORC(J) D  ;add to ORMSG(4)
"RTN","ORMBLDPS",44,0)
 . I $L(@X)+$L(Y)'>245 S @X=@X_Y
"RTN","ORMBLDPS",45,0)
 . E  S L=245-$L(@X),@X=@X_$E(Y,1,L),I=I+1,X="ORMSG(4,"_I_")",@X=$E(Y,L+1,$L(Y))
"RTN","ORMBLDPS",46,0)
 I $G(ORDIALOG(DRUG,1)) S X=$$ENDCM^PSJORUTL(ORDIALOG(DRUG,1)),DISPENSE=$P(X,U,3)_"^^99NDF^"_ORDIALOG(DRUG,1)_"^^99PSD"
"RTN","ORMBLDPS",47,0)
 S OITXT=$$USID^ORMBLD($G(ORDIALOG(OI,1)))
"RTN","ORMBLDPS",48,0)
 S OITXT2=$P(OITXT,U,1,4)_U_$$ESC($P(OITXT,U,5))_U_$P(OITXT,U,6,99)
"RTN","ORMBLDPS",49,0)
 S ORMSG(5)="RXO|"_OITXT2_"|||||||||"_$G(DISPENSE)
"RTN","ORMBLDPS",50,0)
UD2 I $G(OUTPT) D
"RTN","ORMBLDPS",51,0)
 . N QTY,REFS,DSPY
"RTN","ORMBLDPS",52,0)
 . S QTY=$$PTR("QUANTITY"),REFS=$$PTR("REFILLS"),DSPY=$$PTR("DAYS SUPPLY")
"RTN","ORMBLDPS",53,0)
 . S ORMSG(5)=ORMSG(5)_"|"_$G(ORDIALOG(QTY,1))_"||"_$G(ORDIALOG(REFS,1))_"||||D"_$G(ORDIALOG(DSPY,1))
"RTN","ORMBLDPS",54,0)
 S I=5 I $L($G(ORDIALOG(PROVCOMM,1))) D
"RTN","ORMBLDPS",55,0)
 . S J=$O(^TMP("ORWORD",$J,PROVCOMM,1,0)) Q:'J
"RTN","ORMBLDPS",56,0)
 . S I=6,ORMSG(6)="NTE|6|P|"_$$ESC($G(^TMP("ORWORD",$J,PROVCOMM,1,J,0)))
"RTN","ORMBLDPS",57,0)
 . S K=0 F  S J=$O(^TMP("ORWORD",$J,PROVCOMM,1,J)) Q:J'>0  S K=K+1,ORMSG(6,K)=$G(^(J,0))
"RTN","ORMBLDPS",58,0)
 I $G(OUTPT),$L($G(ORDIALOG(PI,1))) D
"RTN","ORMBLDPS",59,0)
 . S J=$O(^TMP("ORWORD",$J,PI,1,0)) Q:'J
"RTN","ORMBLDPS",60,0)
 . S I=I+1,ORMSG(I)="NTE|7|P|"_$G(^TMP("ORWORD",$J,PI,1,J,0))
"RTN","ORMBLDPS",61,0)
 . S K=0 F  S J=$O(^TMP("ORWORD",$J,PI,1,J)) Q:J'>0  S K=K+1,ORMSG(I,K)=$G(^(J,0))
"RTN","ORMBLDPS",62,0)
UD3 S J=0 F  S J=$O(ORDIALOG(ROUTE,J)) Q:J'>0  S I=I+1,ORMSG(I)=$$RXR($G(ORDIALOG(ROUTE,J)))
"RTN","ORMBLDPS",63,0)
 I $D(^OR(100,IFN,9)) D ORDCHKS
"RTN","ORMBLDPS",64,0)
 S I=I+1,ORMSG(I)=$$ZRX(IFN,OUTPT)
"RTN","ORMBLDPS",65,0)
 I $G(OUTPT) D  ;add SC data
"RTN","ORMBLDPS",66,0)
 . N OR5 S OR5=$G(^OR(100,IFN,5))
"RTN","ORMBLDPS",67,0)
 . I $L(OR5),OR5'?5"^" S I=I+1,ORMSG(I)="ZSC|"_$TR(OR5,"^","|") Q
"RTN","ORMBLDPS",68,0)
 . S SC=$$PTR("SERVICE CONNECTED") S:$D(ORDIALOG(SC,1)) I=I+1,ORMSG(I)="ZSC|"_$S(ORDIALOG(SC,1):"SC",1:"NSC")
"RTN","ORMBLDPS",69,0)
 ; Create DG1 & ZCL segment(s) for Billing Awareness (BA) Project
"RTN","ORMBLDPS",70,0)
 D DG1^ORWDBA3($G(IFN),"I",I)
"RTN","ORMBLDPS",71,0)
 I $P(^ORD(100.98,$P(OR0,U,11),0),U)="NON-VA MEDICATIONS" D
"RTN","ORMBLDPS",72,0)
 . S I=I+1 D ZRN(IFN,.ORMSG,I)
"RTN","ORMBLDPS",73,0)
 Q
"RTN","ORMBLDPS",74,0)
 ;
"RTN","ORMBLDPS",75,0)
INSTR() ; -- Return text instructions for QT-8, instance I
"RTN","ORMBLDPS",76,0)
 N Y S Y=$P($G(ORDIALOG(DOSE,I)),"&",5)
"RTN","ORMBLDPS",77,0)
 I $G(ORDIALOG(DRUG,1)),$L(Y) Q $$ESC(Y)
"RTN","ORMBLDPS",78,0)
 S Y=$G(ORDIALOG(INSTR,I)) I $G(OUTPT) D
"RTN","ORMBLDPS",79,0)
 . N UNITS,UNT S UNITS=$$PTR("FREE TEXT"),UNT=$G(ORDIALOG(UNITS,I))
"RTN","ORMBLDPS",80,0)
 . S:$L(UNT) Y=Y_" "_UNT ;old format
"RTN","ORMBLDPS",81,0)
 Q $$ESC(Y)
"RTN","ORMBLDPS",82,0)
 ;
"RTN","ORMBLDPS",83,0)
HL7DUR() ; -- Returns HL7 form of duration X
"RTN","ORMBLDPS",84,0)
 N X,X1,X2,Y S X=$G(ORDIALOG(DUR,I))
"RTN","ORMBLDPS",85,0)
 S X1=+$G(X),Y="" G:X1'>0 HDQ
"RTN","ORMBLDPS",86,0)
 S X2=$$UP^XLFSTR($P(X,X1,2)) S:$E(X2)=" " X2=$E(X2,2,99)
"RTN","ORMBLDPS",87,0)
 S Y=$S($E(X2,1,2)="MO":"L",'$L(X2):"D",1:$E(X2))_X1
"RTN","ORMBLDPS",88,0)
HDQ Q Y
"RTN","ORMBLDPS",89,0)
 ;
"RTN","ORMBLDPS",90,0)
IV ; -- new IV Meds order
"RTN","ORMBLDPS",91,0)
 N SOLN,VOL,ADDS,STR,UNITS,RATE,URG,WP,QT,I,X1,X2,INST
"RTN","ORMBLDPS",92,0)
 N IVLIMIT ; duratioin or total volume for IV order
"RTN","ORMBLDPS",93,0)
 N IVTYPE,IVZRX,X,CNT,ROUTE,ORBCMA,DFN
"RTN","ORMBLDPS",94,0)
 S IVLIMIT=$$PTR("DURATION")
"RTN","ORMBLDPS",95,0)
 S IVTYPE=$G(ORDIALOG(+$$PTR("IV TYPE"),1))
"RTN","ORMBLDPS",96,0)
 I IVTYPE="",$P($G(^OR(100,IFN,3)),U,11)="B" D
"RTN","ORMBLDPS",97,0)
 .S IVTYPE=$$MOB^ORMBLDP1(IFN,+$P($G(^OR(100,IFN,0)),U,2))
"RTN","ORMBLDPS",98,0)
 .D RESP^ORCSAVE2(IFN,"OR GTX IV TYPE",IVTYPE)
"RTN","ORMBLDPS",99,0)
 S RATE=$$PTR("INFUSION RATE"),ADDS=$$PTR("ADDITIVE")
"RTN","ORMBLDPS",100,0)
 S STR=$$PTR("STRENGTH PSIV"),UNITS=$$PTR("UNITS")
"RTN","ORMBLDPS",101,0)
 S WP=$$PTR("WORD PROCESSING 1"),VOL=$$PTR("VOLUME")
"RTN","ORMBLDPS",102,0)
 S SCHTYPE=$$PTR("SCHEDULE TYPE")
"RTN","ORMBLDPS",103,0)
 S SOLN=$$PTR("ORDERABLE ITEM"),URG=+$G(ORDIALOG($$PTR("URGENCY"),1))
"RTN","ORMBLDPS",104,0)
 ;I IVTYPE="",$G(ORDIALOG(+$$PTR("SCHEDULE"),1))="" S IVTYPE="C"
"RTN","ORMBLDPS",105,0)
 I IVTYPE="I" S QT=U_$$ESC($G(ORDIALOG(+$$PTR("SCHEDULE"),1)))_"&"_$G(ORDIALOG(+$$PTR("ADMIN TIMES"),1))_"^^^^"
"RTN","ORMBLDPS",106,0)
 I IVTYPE="C" S QT="^^^^^"
"RTN","ORMBLDPS",107,0)
 ;S QT=U_$G(ORDIALOG(+$$PTR("SCHEDULE"),1))_"^^^^"
"RTN","ORMBLDPS",108,0)
 S:URG QT=QT_$P($G(^ORD(101.42,URG,0)),U,2)
"RTN","ORMBLDPS",109,0)
 S $P(ORMSG(4),"|",8)=QT
"RTN","ORMBLDPS",110,0)
 S X=$G(^OR(100,IFN,8,1,0)) I $P(X,U,5),$P(X,U,5)'=$P(X,U,3) S $P(ORMSG(4),"|",13)=$P(X,U,5) ; Send signer instead of orderer if different
"RTN","ORMBLDPS",111,0)
 S RATE=$G(ORDIALOG(RATE,1)) S:$E(RATE,$L(RATE))=" " RATE=$E(RATE,1,($L(RATE)-1)) S ORMSG(5)="RXO|^^^PS-1^IV^99OTH|"_$$ESC(RATE) ;strip any trailing spaces
"RTN","ORMBLDPS",112,0)
 S IVLIMIT=$G(ORDIALOG(IVLIMIT,1))
"RTN","ORMBLDPS",113,0)
 I $L(IVLIMIT) S IVLIMIT=$$HL7IVLMT^ORMBLDP1(IVLIMIT),ORMSG(5)="RXO|^^"_IVLIMIT_"^PS-1^IV^99OTH|"_RATE
"RTN","ORMBLDPS",114,0)
 S I=5 I $L($G(ORDIALOG(WP,1))) D
"RTN","ORMBLDPS",115,0)
 . N J,K S J=$O(^TMP("ORWORD",$J,WP,1,0)) Q:'J
"RTN","ORMBLDPS",116,0)
 . S I=6,ORMSG(6)="NTE|6|P|"_$$ESC($G(^TMP("ORWORD",$J,WP,1,J,0)))
"RTN","ORMBLDPS",117,0)
 . S K=0 F  S J=$O(^TMP("ORWORD",$J,WP,1,J)) Q:J'>0  S K=K+1,ORMSG(6,K)=^(J,0)
"RTN","ORMBLDPS",118,0)
 ;S I=I+1,ORMSG(I)=$$RXR(+$$PTR("ROUTE"))
"RTN","ORMBLDPS",119,0)
 S ROUTE=+$$PTR("ROUTE")
"RTN","ORMBLDPS",120,0)
 S I=I+1,ORMSG(I)=$$RXR($G(ORDIALOG(ROUTE,1)))
"RTN","ORMBLDPS",121,0)
IV1 S INST=0 F  S INST=$O(ORDIALOG(SOLN,INST)) Q:INST'>0  D
"RTN","ORMBLDPS",122,0)
 . S X1="B",X2=+$G(ORDIALOG(SOLN,INST))
"RTN","ORMBLDPS",123,0)
 . I $P($G(^ORD(101.43,X2,"PS")),U,4) S X1=X1_"A" ;pre-mix
"RTN","ORMBLDPS",124,0)
 . S I=I+1,ORMSG(I)="RXC|"_X1_"|"_$$USID^ORMBLD(X2)_"|"_$G(ORDIALOG(VOL,INST))_"|"_$$HL7UNIT("ML")
"RTN","ORMBLDPS",125,0)
 I $O(ORDIALOG(ADDS,0)) D
"RTN","ORMBLDPS",126,0)
 . S INST=0 F  S INST=$O(ORDIALOG(ADDS,INST)) Q:INST'>0  D
"RTN","ORMBLDPS",127,0)
 . . S X1=$G(ORDIALOG(ADDS,INST)),X2=$G(ORDIALOG(UNITS,INST))
"RTN","ORMBLDPS",128,0)
 . . S I=I+1,ORMSG(I)="RXC|A|"_$$USID^ORMBLD(X1)_"|"_$G(ORDIALOG(STR,INST))_"|"_$$HL7UNIT(X2)
"RTN","ORMBLDPS",129,0)
 I $D(^OR(100,IFN,9)) D ORDCHKS
"RTN","ORMBLDPS",130,0)
 S IVZRX=$$ZRX(IFN,0)
"RTN","ORMBLDPS",131,0)
 S CNT=0
"RTN","ORMBLDPS",132,0)
 F X=1:1:$L(IVZRX) I $E(IVZRX,X)="|" S CNT=CNT+1
"RTN","ORMBLDPS",133,0)
 I CNT<6 F X=CNT:1:5 S IVZRX=IVZRX_"|"
"RTN","ORMBLDPS",134,0)
 S I=I+1,ORMSG(I)=IVZRX_IVTYPE
"RTN","ORMBLDPS",135,0)
 ; Create DG1 & ZCL segment(s) for Billing Awareness (BA) Project
"RTN","ORMBLDPS",136,0)
 D DG1^ORWDBA3($G(IFN),"I",I)
"RTN","ORMBLDPS",137,0)
 Q
"RTN","ORMBLDPS",138,0)
 ;
"RTN","ORMBLDPS",139,0)
RXR(ROUTE) ; -- Returns RXR segment
"RTN","ORMBLDPS",140,0)
 N IEN,NAME
"RTN","ORMBLDPS",141,0)
 I +ROUTE=0 Q "RXR|^^^^^99PSR"
"RTN","ORMBLDPS",142,0)
 K ^TMP($J,"ORMBLDPS RXR")
"RTN","ORMBLDPS",143,0)
 D ALL^PSS51P2(+ROUTE,,,,"ORMBLDPS RXR")
"RTN","ORMBLDPS",144,0)
 S NAME=^TMP($J,"ORMBLDPS RXR",+ROUTE,.01)
"RTN","ORMBLDPS",145,0)
 ;N NAME S NAME=$$GET1^DIQ(51.2,+ROUTE_",",.01)
"RTN","ORMBLDPS",146,0)
 K ^TMP($J,"ORMBLDPS RXR")
"RTN","ORMBLDPS",147,0)
 Q "RXR|^^^"_+ROUTE_U_NAME_"^99PSR"
"RTN","ORMBLDPS",148,0)
 ;
"RTN","ORMBLDPS",149,0)
ZRX(IFN,OUTPT) ; -- Returns ZRX segment
"RTN","ORMBLDPS",150,0)
 N NATURE,TYPE,ORIG,PSORIG,ROUTING,ZRX
"RTN","ORMBLDPS",151,0)
 S TYPE=$P($G(^OR(100,IFN,3)),U,11),NATURE=$P($G(^(8,1,0)),U,12)
"RTN","ORMBLDPS",152,0)
 S:NATURE NATURE=$P($G(^ORD(100.02,+NATURE,0)),U,2) ;code
"RTN","ORMBLDPS",153,0)
 S PSORIG="" I (TYPE=1)!(TYPE=2) D
"RTN","ORMBLDPS",154,0)
 . S ORIG=$P($G(^OR(100,IFN,3)),U,5),PSORIG=$G(^OR(100,+ORIG,4))
"RTN","ORMBLDPS",155,0)
 . I PSORIG'>0 S PSORIG="",TYPE=0 ;edit of unreleased order
"RTN","ORMBLDPS",156,0)
 S ZRX="ZRX|"_PSORIG_"|"_NATURE_"|"_$S(TYPE=1:"E",TYPE=2:"R",1:"N")
"RTN","ORMBLDPS",157,0)
 S ROUTING=$G(ORDIALOG($$PTR("ROUTING"),1))
"RTN","ORMBLDPS",158,0)
 ;AGP FIX FOR PROBLEM WITH ROUTING BE SET TO DAY SUPPLY ONCE ROOT CAUSE
"RTN","ORMBLDPS",159,0)
 ;IS FOUND THIS CODE WILL BE REMOVE
"RTN","ORMBLDPS",160,0)
 I OUTPT=1,ROUTING'="",ROUTING>0 S ROUTING="M"
"RTN","ORMBLDPS",161,0)
 I $G(OUTPT) S ZRX=ZRX_"|"_ROUTING_$S($L($P($G(^OR(100,ORIFN,8,1,2)),"^",3)):"|||1",1:"")
"RTN","ORMBLDPS",162,0)
 Q ZRX
"RTN","ORMBLDPS",163,0)
 ;
"RTN","ORMBLDPS",164,0)
ZRN(IFN,ORMSG,I) ; -- Set ZRN segment
"RTN","ORMBLDPS",165,0)
 N ST,ZRN,J,K,TXT
"RTN","ORMBLDPS",166,0)
 S ORMSG(I)="ZRN|N|"
"RTN","ORMBLDPS",167,0)
 S ST=$$PTR("STATEMENTS")
"RTN","ORMBLDPS",168,0)
 I $L($G(ORDIALOG(ST,1))) D
"RTN","ORMBLDPS",169,0)
 . S J=$O(^TMP("ORWORD",$J,ST,1,0)) Q:'J
"RTN","ORMBLDPS",170,0)
 . S K=0,TXT=$G(^TMP("ORWORD",$J,ST,1,J,0))
"RTN","ORMBLDPS",171,0)
 . I $L(TXT) S K=K+1,ORMSG(I,K)=TXT
"RTN","ORMBLDPS",172,0)
 . F  S J=$O(^TMP("ORWORD",$J,ST,1,J)) Q:J'>0  S TXT=$G(^(J,0)) D
"RTN","ORMBLDPS",173,0)
 . . I $L(TXT) S K=K+1,ORMSG(I,K)=TXT
"RTN","ORMBLDPS",174,0)
 Q
"RTN","ORMBLDPS",175,0)
 ;
"RTN","ORMBLDPS",176,0)
ORDCHKS ; -- Include order checks in OBX segments
"RTN","ORMBLDPS",177,0)
 N OC,X,X1 S OC=0
"RTN","ORMBLDPS",178,0)
 F  S OC=$O(^OR(100,IFN,9,OC)) Q:OC'>0  S X=$G(^(OC,0)),X1=$G(^(1)) D
"RTN","ORMBLDPS",179,0)
 . S I=I+1,ORMSG(I)="OBX|"_OC_"|TX|^^^"_+X_"^^99OCX||"_$$ESC($S($L(X1):X1,1:$P(X,U,3)))_"|||||||||"_$$FMTHL7^XLFDT($P(X,U,6))_"||"_$P(X,U,5)
"RTN","ORMBLDPS",180,0)
 . I $L($P(X,U,4)) S I=I+1,ORMSG(I)="NTE|"_OC_"|P|"_$$ESC($P(X,U,4))
"RTN","ORMBLDPS",181,0)
 Q
"RTN","ORMBLDPS",182,0)
 ;
"RTN","ORMBLDPS",183,0)
HL7UNIT(X) ; -- Return coded element for volume/strength units
"RTN","ORMBLDPS",184,0)
 N I,UNIT,Y
"RTN","ORMBLDPS",185,0)
 F I=1:1:$L(X) I $E(X,I)?1A Q  ; first letter
"RTN","ORMBLDPS",186,0)
 S UNIT=$$UP^XLFSTR($E(X,I,$L(X))),Y=""
"RTN","ORMBLDPS",187,0)
 F I=1:1:14 S X=$P("ML^LITER^MCG^MG^GM^UNITS^IU^MEQ^MM^MU^THOUU^MG-PE^NANOGRAM^MMOL","^",I) I UNIT=X S Y="^^^PSIV-"_I_U_UNIT_"^99OTH" Q
"RTN","ORMBLDPS",188,0)
 Q Y
"RTN","ORMBLDPS",189,0)
 ;
"RTN","ORMBLDPS",190,0)
VER(IFN) ; -- Send msg for nurse-verified orders
"RTN","ORMBLDPS",191,0)
 N OR0,ORMSG S OR0=$G(^OR(100,+IFN,0)) Q:$P(OR0,U,12)'="I"  ;Inpt only
"RTN","ORMBLDPS",192,0)
 S ORMSG(1)=$$MSH^ORMBLD("ORM","PS"),ORMSG(2)=$$PID^ORMBLD($P(OR0,U,2))
"RTN","ORMBLDPS",193,0)
 S ORMSG(3)=$$PV1^ORMBLD($P(OR0,U,2),$P(OR0,U,12),+$P(OR0,U,10))
"RTN","ORMBLDPS",194,0)
 S ORMSG(4)="ORC|ZV|"_IFN_"^OR|"_$G(^OR(100,+IFN,4))_"^PS||||||||"_DUZ_"||||"_$$FMTHL7^XLFDT($$NOW^XLFDT)
"RTN","ORMBLDPS",195,0)
 D MSG^XQOR("OR EVSEND PS",.ORMSG)
"RTN","ORMBLDPS",196,0)
 Q
"RTN","ORMBLDPS",197,0)
 ;
"RTN","ORMBLDPS",198,0)
REF(IFN,ROUTING,CLINIC) ; -- Send msg for refill request
"RTN","ORMBLDPS",199,0)
 N OR0,ORMSG S OR0=$G(^OR(100,+IFN,0)) Q:$P(OR0,U,12)'="O"
"RTN","ORMBLDPS",200,0)
 S:'$G(CLINIC) CLINIC=$S($G(ORL):+ORL,1:+$P(OR0,U,10))
"RTN","ORMBLDPS",201,0)
 S ORMSG(1)=$$MSH^ORMBLD("ORM","PS"),ORMSG(2)=$$PID^ORMBLD($P(OR0,U,2))
"RTN","ORMBLDPS",202,0)
 S ORMSG(3)=$$PV1^ORMBLD($P(OR0,U,2),"O",CLINIC)
"RTN","ORMBLDPS",203,0)
 S ORMSG(4)="ORC|ZF|"_IFN_"^OR|"_$G(^OR(100,+IFN,4))_"^PS|||||||"_DUZ_"||"_$G(ORNP)_"|||"_$$FMTHL7^XLFDT($$NOW^XLFDT)
"RTN","ORMBLDPS",204,0)
 S ORMSG(5)="ZRX||||"_ROUTING
"RTN","ORMBLDPS",205,0)
 D MSG^XQOR("OR EVSEND PS",.ORMSG)
"RTN","ORMBLDPS",206,0)
 Q
"RTN","ORMBLDPS",207,0)
ESC(STR) ;
"RTN","ORMBLDPS",208,0)
 Q $$ESC^ORHLESC(STR,"~|\&^")
"RTN","ORMBLDRA")
0^32^B9959617
"RTN","ORMBLDRA",1,0)
ORMBLDRA ; SLC/MKB - Build outgoing Radiology ORM msgs ;05/30/06  11:30AM
"RTN","ORMBLDRA",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**75,97,190,195,243**;Dec 17, 1997;Build 242
"RTN","ORMBLDRA",3,0)
HL7DATE(DATE) ; -- FM -> HL7 format
"RTN","ORMBLDRA",4,0)
 Q $$FMTHL7^XLFDT(DATE)  ;**97
"RTN","ORMBLDRA",5,0)
 ;
"RTN","ORMBLDRA",6,0)
PTR(NAME) ; -- Returns ptr value of prompt in Dialog file
"RTN","ORMBLDRA",7,0)
 Q $O(^ORD(101.41,"AB",$E("OR GTX "_NAME,1,63),0))
"RTN","ORMBLDRA",8,0)
 ;
"RTN","ORMBLDRA",9,0)
EN ; -- Segments for new Radiology order
"RTN","ORMBLDRA",10,0)
 N ORSEX,OI,START,IP,URG,ILOC,MODE,CATG,PREOP,PREG,MODS,CLHIST,PROV,REASON,QT,I,J,Z,J0,LIN,RA75
"RTN","ORMBLDRA",11,0)
 S OI=$G(ORDIALOG($$PTR("ORDERABLE ITEM"),1))
"RTN","ORMBLDRA",12,0)
 S START=$P($G(^OR(100,IFN,0)),U,8),IP=$G(ORDIALOG($$PTR("YES/NO"),1))
"RTN","ORMBLDRA",13,0)
 S URG=$P($G(^ORD(101.42,+$G(ORDIALOG($$PTR("URGENCY"),1)),0)),U,2)
"RTN","ORMBLDRA",14,0)
 S ILOC=$G(ORDIALOG($$PTR("IMAGING LOCATION"),1))
"RTN","ORMBLDRA",15,0)
 S MODE=$G(ORDIALOG($$PTR("MODE OF TRANSPORT"),1))
"RTN","ORMBLDRA",16,0)
 S CATG=$G(ORDIALOG($$PTR("CATEGORY"),1))
"RTN","ORMBLDRA",17,0)
 S PREOP=$G(ORDIALOG($$PTR("PRE-OP SCHEDULED DATE/TIME"),1))
"RTN","ORMBLDRA",18,0)
 S PREG=$G(ORDIALOG($$PTR("PREGNANT"),1))
"RTN","ORMBLDRA",19,0)
 S REASON=$G(ORDIALOG($$PTR("STUDY REASON"),1))
"RTN","ORMBLDRA",20,0)
 S MODS=$$PTR("MODIFIERS"),CLHIST=$$PTR("WORD PROCESSING 1")
"RTN","ORMBLDRA",21,0)
 S MODS=$$MULT(MODS) S:ILOC ILOC=ILOC_U_$P($G(^RA(79.1,+ILOC,0)),U)
"RTN","ORMBLDRA",22,0)
 S MODE=$S(MODE="A":"WALK",MODE="P":"PORT",MODE="S":"CART",1:"WHLC")
"RTN","ORMBLDRA",23,0)
 S PREG=$S(PREG="Y":"YES",PREG="N":"NO",1:"UNKNOWN")
"RTN","ORMBLDRA",24,0)
 S QT="^^^"_$$HL7DATE(START)_"^^"_URG,$P(ORMSG(4),"|",8)=QT
"RTN","ORMBLDRA",25,0)
 S PROV=+$G(ORDIALOG($$PTR("PROVIDER"),1)) S:PROV $P(ORMSG(4),"|",12)=PROV
"RTN","ORMBLDRA",26,0)
 S RA75=$$PATCH^XPDUTL("RA*5.0*75")
"RTN","ORMBLDRA",27,0)
 S ORMSG(5)="OBR||||"_$$USID^ORMBLD(OI)_"||||||||"_$S(IP:"isolation",1:"")_"||||||"_MODS_"|"_ILOC_"|||||||||||"_MODE,I=5
"RTN","ORMBLDRA",28,0)
 I +RA75 S $P(ORMSG(5),"|",32)=U_REASON
"RTN","ORMBLDRA",29,0)
 ; Create DG1 & ZCL segment(s) for Billing Awareness (BA) Project
"RTN","ORMBLDRA",30,0)
 D DG1^ORWDBA3($G(IFN),"I",I)
"RTN","ORMBLDRA",31,0)
OBX S J0=0
"RTN","ORMBLDRA",32,0)
 I 'RA75 D
"RTN","ORMBLDRA",33,0)
 . S I=I+1,ORMSG(I)="OBX|1|TX|2000.02^CLINICAL HISTORY^AS4|1|"_"REASON FOR STUDY: "_REASON
"RTN","ORMBLDRA",34,0)
 . S $P(LIN,"-",55)=""
"RTN","ORMBLDRA",35,0)
 . S I=I+1,ORMSG(I)="OBX|2|TX|2000.02^CLINICAL HISTORY^AS4|1|"_LIN
"RTN","ORMBLDRA",36,0)
 . S J0=2
"RTN","ORMBLDRA",37,0)
 S J=0 F  S J=$O(^TMP("ORWORD",$J,CLHIST,1,J)) Q:J'>0  S I=I+1,J0=J0+1,ORMSG(I)="OBX|"_J0_"|TX|2000.02^CLINICAL HISTORY^AS4|1|"_^(J,0)
"RTN","ORMBLDRA",38,0)
 S ORSEX=$P($G(^DPT(+ORVP,0)),U,2)
"RTN","ORMBLDRA",39,0)
 S:ORSEX="F" I=I+1,ORMSG(I)="OBX|1|TX|2000.33^PREGNANT^AS4||"_PREG
"RTN","ORMBLDRA",40,0)
 S:PREOP I=I+1,ORMSG(I)="OBX|1|TS|^PRE-OP SCHEDULED DATE/TIME||"_$$HL7DATE(PREOP)
"RTN","ORMBLDRA",41,0)
 I "CS"[CATG S Z=$$PTR("CONTRACT/SHARING SOURCE"),I=I+1,ORMSG(I)="OBX|1|CE|34^CONTRACT/SHARING SOURCE^99DD||"_+$G(ORDIALOG(Z,1))_U_$P($G(^DIC(34,+$G(ORDIALOG(Z,1)),0)),U)
"RTN","ORMBLDRA",42,0)
 I CATG="R" S Z=$$PTR("RESEARCH SOURCE"),I=I+1,ORMSG(I)="OBX|1|TX|^RESEARCH SOURCE||"_$G(ORDIALOG(Z,1))
"RTN","ORMBLDRA",43,0)
 Q
"RTN","ORMBLDRA",44,0)
MULT(M) ; -- Returns string of MODIFIER~MODIFIER~...
"RTN","ORMBLDRA",45,0)
 N I,X S X="" Q:'$O(ORDIALOG(M,0)) X
"RTN","ORMBLDRA",46,0)
 S I=$O(ORDIALOG(M,0)),X=$P($G(^RAMIS(71.2,+ORDIALOG(M,I),0)),U)
"RTN","ORMBLDRA",47,0)
 F  S I=$O(ORDIALOG(M,I)) Q:I'>0  S X=X_"~"_$P($G(^RAMIS(71.2,+ORDIALOG(M,I),0)),U)
"RTN","ORMBLDRA",48,0)
 Q X
"RTN","ORMEVNT")
0^178^B75252404
"RTN","ORMEVNT",1,0)
ORMEVNT ;SLC/MKB-Trigger HL7 msg off MAS events ;3/31/04  09:21
"RTN","ORMEVNT",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**24,45,70,79,141,165,177,186,195,278,243**;Dec 17, 1997;Build 242
"RTN","ORMEVNT",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ORMEVNT",4,0)
 ;
"RTN","ORMEVNT",5,0)
EN1 ; -- tasked entry point
"RTN","ORMEVNT",6,0)
 Q:'$G(DFN)  Q:$D(DGPMPC)  Q:DGPMT=4!(DGPMT=5)  ;skip lodger mvts
"RTN","ORMEVNT",7,0)
 N ZTDESC,ZTIO,ZTRTN,ZTDTH,ZTSAVE,ZTSK,I
"RTN","ORMEVNT",8,0)
 S ZTDESC="Auto-DC and/or Release orders on MAS movement",ZTIO=""
"RTN","ORMEVNT",9,0)
 S ZTRTN="EN^ORMEVNT",ZTDTH=$H,ZTSAVE("^UTILITY(""DGPM"",$J,")=""
"RTN","ORMEVNT",10,0)
 F I="DFN","DGPMDA","DGPMA","DGPMP","DGPMT" S ZTSAVE(I)=""
"RTN","ORMEVNT",11,0)
 D ^%ZTLOAD ;D EN^ORYDGPM
"RTN","ORMEVNT",12,0)
 Q
"RTN","ORMEVNT",13,0)
 ;
"RTN","ORMEVNT",14,0)
EN ; -- main entry point
"RTN","ORMEVNT",15,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","ORMEVNT",16,0)
 Q:'$G(DFN)  Q:$D(DGPMPC)  Q:DGPMT=4!(DGPMT=5)
"RTN","ORMEVNT",17,0)
 I '$G(DGPMP) S ^XTMP("OREVENT",DFN,DGPMDA,0)=DT_U_$$FMADD^XLFDT(DT,2)_U_"Event process flag" ;195
"RTN","ORMEVNT",18,0)
 I $G(DGPMP),$D(^XTMP("OREVENT",DFN,DGPMDA)) D EN1 Q  ;195 edits processed after new JEH
"RTN","ORMEVNT",19,0)
 N XQORQUIT,XQORPOP,DTOUT,DUOUT,DIRUT,DIROUT ;protect protocol context
"RTN","ORMEVNT",20,0)
 N VAIP,DONE,ORVP,ORWARD,ORTS,ORL,ORDIV,ORLAST,X,Y,I,ORCURRNT,OREVENT,ORDCRULE,ORACT,ORPRINT
"RTN","ORMEVNT",21,0)
 S VAIP("E")=DGPMDA D IN5^VADPT M ORVP=VAIP I '$G(DGPMA) D  Q  ;deleted
"RTN","ORMEVNT",22,0)
 . N LAST,OREVT S LAST=+$O(^ORE(100.2,"ADT",DGPMDA,""),-1) Q:LAST<1
"RTN","ORMEVNT",23,0)
 . S OREVT=+$O(^ORE(100.2,"ADT",DGPMDA,LAST,0))
"RTN","ORMEVNT",24,0)
 . D ACTLOG^OREVNTX(OREVT,"DL")
"RTN","ORMEVNT",25,0)
A ;
"RTN","ORMEVNT",26,0)
 S ORVP=+DFN_";DPT(",ORTS=+$G(^DPT(DFN,.103)),ORWARD=$G(^(.1))
"RTN","ORMEVNT",27,0)
 S ORWARD=$S($L(ORWARD):+$O(^DIC(42,"B",ORWARD,0)),1:0)
"RTN","ORMEVNT",28,0)
 S ORL=$S(ORWARD:+$G(^DIC(42,ORWARD,44))_";SC(",1:""),ORDIV=$$DIV(+ORL)
"RTN","ORMEVNT",29,0)
 S ORLAST("TS")=$$PREVTS,X=+VAIP(15,4) F I="WD","LOC","DIV" S ORLAST(I)=""
"RTN","ORMEVNT",30,0)
 S:X ORLAST("WD")=X,Y=+$G(^DIC(42,X,44)),ORLAST("LOC")=Y_";SC(",ORLAST("DIV")=$$DIV(Y)
"RTN","ORMEVNT",31,0)
 N OREVNTLK S OREVNTLK=""  ;JEH
"RTN","ORMEVNT",32,0)
 S ORCURRNT=$$CURRENT,OREVENT=$$PATEVT,ORACT=$S($G(DGPMP):"ED",1:"NW") ; Lock
"RTN","ORMEVNT",33,0)
 I OREVENT=-1 D EN1 Q  ;195 Can't lock, retry
"RTN","ORMEVNT",34,0)
 S OREVNTLK=OREVENT  ; save routine copy of ifn JEH
"RTN","ORMEVNT",35,0)
 I $G(DGPMP),$D(^ORE(100.2,"ADT",DGPMDA)) D   ;edited 
"RTN","ORMEVNT",36,0)
 . N LAST,OREVT,DA,X,I S LAST=+$O(^ORE(100.2,"ADT",DGPMDA,""),-1) Q:LAST<1
"RTN","ORMEVNT",37,0)
 . S OREVT=+$O(^ORE(100.2,"ADT",DGPMDA,LAST,0)),DA=+$O(^(OREVT,0))
"RTN","ORMEVNT",38,0)
 . S X=$G(^ORE(100.2,OREVT,10,DA,0)) ;last activity on movement
"RTN","ORMEVNT",39,0)
 . I $P(X,U,5)=+$G(VAIP(4)),$P(X,U,6)=+$G(VAIP(8)),$P(X,U,7)=+$G(VAIP(5)) S DONE=1 Q  ;no change
"RTN","ORMEVNT",40,0)
 . I 'OREVENT D ACTLOG^OREVNTX(OREVT,"ED",$$TYPE(DGPMT),1) S DONE=1
"RTN","ORMEVNT",41,0)
 I $G(DONE) D FINISHED Q  ; unlock and clean up before quit IFNjeh 
"RTN","ORMEVNT",42,0)
B ;
"RTN","ORMEVNT",43,0)
 I '$G(DGPMP),ORCURRNT D  ;new mvt - autoDC
"RTN","ORMEVNT",44,0)
 . I $D(^ORE(100.2,"ADT",DGPMDA)) D  Q:$G(DONE)  ;ReEntered
"RTN","ORMEVNT",45,0)
 .. N LAST,OREVT S DONE=0
"RTN","ORMEVNT",46,0)
 .. S LAST=+$O(^ORE(100.2,"ADT",DGPMDA,""),-1),OREVT=+$O(^(LAST,0))
"RTN","ORMEVNT",47,0)
 .. Q:+ORVP'=+$G(^ORE(100.2,OREVT,0))  ;diff pat -> diff mvt
"RTN","ORMEVNT",48,0)
 .. S ORACT="RE",DONE=1 Q:OREVENT  ;log on new event instead
"RTN","ORMEVNT",49,0)
 .. D ACTLOG^OREVNTX(OREVT,ORACT,$$TYPE(DGPMT),1)
"RTN","ORMEVNT",50,0)
 . I DGPMT=3 D COMP("ALG") ;keep until GMRA*4*15 gets out
"RTN","ORMEVNT",51,0)
 . S ORDCRULE=$$DCEVT D:ORDCRULE AUTODC^ORMEVNT1(ORDCRULE,$P(DGPMA,U))
"RTN","ORMEVNT",52,0)
 . I DGPMT=1!(DGPMT=2&("^13^40^"[("^"_$P(DGPMA,U,18)_"^"))) I $G(^XTMP("ORDCOBS-"_+ORVP,0)) D REINST ;186 TO ASIH tran mvmt
"RTN","ORMEVNT",53,0)
C ;
"RTN","ORMEVNT",54,0)
 I OREVENT D  ;release delayed orders, complete event
"RTN","ORMEVNT",55,0)
 . D RELEASE^ORMEVNT1(OREVENT),DONE^OREVNTX(OREVENT,$P(DGPMA,U),DGPMDA)
"RTN","ORMEVNT",56,0)
 . I '$G(VAIP(1)) M VAIP=ORVP ;reset for ACTLOG use
"RTN","ORMEVNT",57,0)
 . D ACTLOG^OREVNTX(OREVENT,ORACT,$$TYPE(DGPMT),1)
"RTN","ORMEVNT",58,0)
 . I DGPMT=1,'$P($G(^ORE(100.2,+OREVENT,0)),U,3) S $P(^(0),U,3)=DGPMDA
"RTN","ORMEVNT",59,0)
 . ;D UNLEVT^ORX2(OREVENT)
"RTN","ORMEVNT",60,0)
 I $O(ORPRINT(0)),$G(ORL) D PRINTS^ORWD1(.ORPRINT,+ORL)
"RTN","ORMEVNT",61,0)
 I DGPMT=3,ORCURRNT,'$G(DGPMP) D DISCH ;lapse remaining events
"RTN","ORMEVNT",62,0)
 I '$G(DFN),$G(ORVP) S DFN=+ORVP ;just in case
"RTN","ORMEVNT",63,0)
FINISHED  ; unlock and clean up JEH
"RTN","ORMEVNT",64,0)
 D:$G(OREVNTLK) UNLEVT^ORX2(OREVNTLK) K ^XTMP("OREVENT",DFN,DGPMDA) ;195
"RTN","ORMEVNT",65,0)
 Q
"RTN","ORMEVNT",66,0)
 ;
"RTN","ORMEVNT",67,0)
CURRENT() ; -- Returns 1 or 0, if DGPMDA is the latest movement
"RTN","ORMEVNT",68,0)
 N Y,LAST,LASTYPE,LASTDT S Y=0
"RTN","ORMEVNT",69,0)
 S LAST=+VAIP(14),LASTDT=+VAIP(14,1),LASTYPE=+VAIP(14,2)
"RTN","ORMEVNT",70,0)
 ; VAIP(14) = last physical movement for the admission
"RTN","ORMEVNT",71,0)
 I DGPMT=6 D  G CQ
"RTN","ORMEVNT",72,0)
 . N CA,IDT I LAST,LASTDT>+VAIP(3) Q  ;last physical mvt
"RTN","ORMEVNT",73,0)
 . S CA=+VAIP(13),IDT=9999999.9999999-VAIP(3)
"RTN","ORMEVNT",74,0)
 . I '$O(^DGPM("ATS",DFN,CA,IDT),-1) S Y=1 Q  ;last TS mvt
"RTN","ORMEVNT",75,0)
 I DGPMT=3 D  ;get last mvt overall
"RTN","ORMEVNT",76,0)
 . N VAIP,Y S VAIP("D")="LAST" D IN5^VADPT
"RTN","ORMEVNT",77,0)
 . S LAST=+VAIP(14),LASTYPE=+VAIP(14,2) ;reset
"RTN","ORMEVNT",78,0)
 I LAST=DGPMDA S Y=1 G CQ ;primary mvt
"RTN","ORMEVNT",79,0)
 I $D(^UTILITY("DGPM",$J,LASTYPE,LAST)) S Y=1 ;secondary mvt
"RTN","ORMEVNT",80,0)
CQ Q Y
"RTN","ORMEVNT",81,0)
 ;
"RTN","ORMEVNT",82,0)
PREVTS() ; -- Returns previous treating specialty
"RTN","ORMEVNT",83,0)
 N TS,TSP,CA,ID,LAST,Y
"RTN","ORMEVNT",84,0)
 S TS=+$O(^UTILITY("DGPM",$J,6,0)),TSP=$G(^(TS,"P"))
"RTN","ORMEVNT",85,0)
 I $G(TSP) S Y=+$P(TSP,U,9) G PRVQ ;edited TS mvt
"RTN","ORMEVNT",86,0)
 ; look for TS mvt since last phys mvt
"RTN","ORMEVNT",87,0)
 S CA=$P(DGPMA,U,14),ID=9999999.9999999-DGPMA
"RTN","ORMEVNT",88,0)
 S LAST=+$O(^DGPM("ATS",DFN,CA,ID)),Y=$S(LAST:+$O(^(LAST,0)),1:+VAIP(15,6))
"RTN","ORMEVNT",89,0)
PRVQ Q Y
"RTN","ORMEVNT",90,0)
 ;
"RTN","ORMEVNT",91,0)
TYPE(X) ; -- Return type of event from MAS code
"RTN","ORMEVNT",92,0)
 N Y S Y=$S(X=1:"A",X=2:"T",X=3:"D",X=6:"S",1:"")
"RTN","ORMEVNT",93,0)
 Q Y
"RTN","ORMEVNT",94,0)
 ;
"RTN","ORMEVNT",95,0)
DIV(LOC) ; -- Return Institution file #4 ptr for LOC
"RTN","ORMEVNT",96,0)
 N X0,Y S X0=$G(^SC(+LOC,0))
"RTN","ORMEVNT",97,0)
 S Y=$S($P(X0,U,4):$P(X0,U,4),$P(X0,U,15):$$SITE^VASITE(DT,$P(X0,U,15)),1:+$G(DUZ(2)))
"RTN","ORMEVNT",98,0)
 Q Y
"RTN","ORMEVNT",99,0)
 ;
"RTN","ORMEVNT",100,0)
PATEVT() ; -- Find match to new data in Patient Event file
"RTN","ORMEVNT",101,0)
 N TYPE,MVTYPE,EVT,IFN,X0,Y S Y="" G:'$G(ORCURRNT) PTQ
"RTN","ORMEVNT",102,0)
 S TYPE=$S(DGPMT=1:"A",DGPMT=3:"D",DGPMT=2!(DGPMT=6):"T",1:""),EVT=0
"RTN","ORMEVNT",103,0)
 S MVTYPE=$P(DGPMA,U,18),TYPE(1)="",MVTYPE(1)=""
"RTN","ORMEVNT",104,0)
 I DGPMT=2,MVTYPE=13 S TYPE(1)="A",MVTYPE(1)=40 ;To ASIH
"RTN","ORMEVNT",105,0)
 I DGPMT=3,MVTYPE=41 S TYPE(1)="T",MVTYPE(1)=14 ;From ASIH
"RTN","ORMEVNT",106,0)
 I DGPMT'=3,$$GET1^DIQ(45.7,+$G(ORTS)_",","SPECIALTY:SERVICE")="NHCU" S TYPE(1)=$S(TYPE="A":"T",1:"A") ;DBIA #1154
"RTN","ORMEVNT",107,0)
 F  S EVT=+$O(^ORE(100.2,"AE",DFN,EVT)) Q:EVT<1  S IFN=+$O(^(EVT,0)) D  Q:Y
"RTN","ORMEVNT",108,0)
 . Q:$$LAPSED^OREVNTX(+IFN)  Q:$P($G(^ORE(100.2,IFN,1)),U,5)
"RTN","ORMEVNT",109,0)
 . S X0=$G(^ORD(100.5,EVT,0)) Q:$P(X0,U,3)'=ORDIV
"RTN","ORMEVNT",110,0)
 . I $P(X0,U,2)'=TYPE,$P(X0,U,2)'=TYPE(1) Q  ;Xaction type
"RTN","ORMEVNT",111,0)
 . I $P(X0,U,7),$P(X0,U,7)'=MVTYPE,$P(X0,U,7)'=MVTYPE(1) Q  ;Mvt type
"RTN","ORMEVNT",112,0)
 . I $O(^ORD(100.5,EVT,"TS",0)) Q:'$D(^("B",ORTS))  Q:ORTS=ORLAST("TS")&(ORDIV=ORLAST("DIV"))
"RTN","ORMEVNT",113,0)
 . I $O(^ORD(100.5,EVT,"LOC",0)) Q:'$D(^("B",ORWARD))  Q:ORWARD=ORLAST("WD")
"RTN","ORMEVNT",114,0)
 . S Y=+IFN ;ok
"RTN","ORMEVNT",115,0)
 I Y S:'$$LCKEVT^ORX2(Y) Y=-1 ;195 Lock event if possible
"RTN","ORMEVNT",116,0)
PTQ Q Y
"RTN","ORMEVNT",117,0)
 ;
"RTN","ORMEVNT",118,0)
DCEVT() ; -- Find match to event in AutoDC Rules file for [new] ORDIV,ORTS,ORL
"RTN","ORMEVNT",119,0)
 N MVTYPE,DIV,XFER,ORY,EXC,OBS
"RTN","ORMEVNT",120,0)
 S OBS=$S(DGPMT=3:$$MVT^DGPMOBS(DGPMDA),1:0) ;observation mvt
"RTN","ORMEVNT",121,0)
 S MVTYPE=+$P(DGPMA,U,18) S:MVTYPE=41 MVTYPE=14 S:MVTYPE=40 MVTYPE=13 ;ASIH- 186
"RTN","ORMEVNT",122,0)
 S XFER=$S(DGPMT=2:1,DGPMT=6:1,MVTYPE'=14:0,OBS:0,1:1)
"RTN","ORMEVNT",123,0)
 I DGPMT=2,MVTYPE=13,$G(^XTMP("ORDCOBS-"_+ORVP,"READMIT")) S ORY=0 K ^XTMP("ORDCOBS-"_+ORVP,"READMIT") G DCQ ;186 Obs readmit from ASIH don't auto-dc
"RTN","ORMEVNT",124,0)
 I XFER,ORLAST("TS")'=ORTS,$D(^ORD(100.6,"AC",ORDIV,20)) S MVTYPE=20 ;TS
"RTN","ORMEVNT",125,0)
 S DIV=ORDIV I DGPMT=3,MVTYPE'=14 S DIV=ORLAST("DIV") ;discharge
"RTN","ORMEVNT",126,0)
 S ORY=+$O(^ORD(100.6,"AC",ORDIV,MVTYPE,0)) K:ORY<1&(DGPMT=3)&(OBS) ^XTMP("ORDCOBS-"_+ORVP) G:ORY<1 DCQ ;186, If obs, no active rule, no reinstate
"RTN","ORMEVNT",127,0)
 I MVTYPE=20,$D(^ORD(100.6,ORY,4,ORLAST("TS"),1,ORTS))!(ORTS=ORLAST("TS")) S ORY=0 G DCQ
"RTN","ORMEVNT",128,0)
 I MVTYPE=4 D  G DCQ ;ck Div and Loc multiples
"RTN","ORMEVNT",129,0)
 . I ORLAST("DIV")'=ORDIV S:'$D(^ORD(100.6,ORY,6,ORLAST("DIV"))) ORY=0 Q
"RTN","ORMEVNT",130,0)
 . N OLD,INCL S INCL=0 ;ck incl loc's
"RTN","ORMEVNT",131,0)
 . F OLD=+ORLAST("LOC"),"ALL" I $D(^ORD(100.6,ORY,5,"ADC",OLD,+ORL))!$D(^("ALL")) S INCL=1 Q
"RTN","ORMEVNT",132,0)
 . S:'INCL ORY=0
"RTN","ORMEVNT",133,0)
 I DGPMT=3,OBS D  ;readmitting from observation?
"RTN","ORMEVNT",134,0)
 . N TORY
"RTN","ORMEVNT",135,0)
 . S TORY=ORY
"RTN","ORMEVNT",136,0)
 . S EXC=+$P($G(^ORD(100.6,ORY,0)),U,6) S:EXC=2 ORY=0 ;ignore rule
"RTN","ORMEVNT",137,0)
 . I EXC=1,'$D(ZTQUEUED),$$READMIT S ORY=0
"RTN","ORMEVNT",138,0)
 . I ORY=0 D DCGEN^ORMEVNT2,TIMER^ORMEVNT2 S:"^14^41^"[("^"_$P(DGPMA,U,18)_"^") ^XTMP("ORDCOBS-"_+ORVP,"READMIT")=1 ;177,186 
"RTN","ORMEVNT",139,0)
 . K:ORY ^XTMP("ORDCOBS-"_+ORVP) ;have rule -> dc, don't reinstate meds
"RTN","ORMEVNT",140,0)
DCQ Q ORY
"RTN","ORMEVNT",141,0)
 ;
"RTN","ORMEVNT",142,0)
READMIT() ; -- Return 1 or 0, if patient is being readmitted
"RTN","ORMEVNT",143,0)
 N X,Y,DIR
"RTN","ORMEVNT",144,0)
 S DIR(0)="YA",DIR("A")="Will the patient be re-admitted immediately? "
"RTN","ORMEVNT",145,0)
 S DIR("?")="Enter YES if the patient is to be admitted to the hospital immediately following this discharge from observation."
"RTN","ORMEVNT",146,0)
 D ^DIR S:$D(DTOUT)!$D(DUOUT) Y="^"
"RTN","ORMEVNT",147,0)
 Q Y
"RTN","ORMEVNT",148,0)
 ;
"RTN","ORMEVNT",149,0)
COMP(ORDG) ; -- Complete orders on event [Keep until GMRA*4*15]
"RTN","ORMEVNT",150,0)
 N ORI,ORLIST,ORIFN,OREDT
"RTN","ORMEVNT",151,0)
 I 'ORDG S:ORDG?1.U ORDG=+$O(^ORD(100.98,"B",ORDG,0)) Q:ORDG'>0
"RTN","ORMEVNT",152,0)
 D EN^ORQ1(ORVP,ORDG,2) S ORI=0,OREDT=$P(DGPMA,U)
"RTN","ORMEVNT",153,0)
 F  S ORI=$O(^TMP("ORR",$J,ORLIST,ORI)) Q:ORI'>0  S ORIFN=^(ORI) D STATUS^ORCSAVE2(+ORIFN,2) S:$G(OREDT) $P(^OR(100,+ORIFN,3),U)=OREDT,$P(^(6),U,6)=OREDT
"RTN","ORMEVNT",154,0)
 Q
"RTN","ORMEVNT",155,0)
 ;
"RTN","ORMEVNT",156,0)
LOC(NODE) ; -- Returns [new] patient location from NODE
"RTN","ORMEVNT",157,0)
 N X,Y S X=$P($G(NODE),U,6)
"RTN","ORMEVNT",158,0)
 I X'>0 S X=$P($G(^DPT(+ORVP,.1)),U) S:$L(X) X=$O(^DIC(42,"B",X,0))
"RTN","ORMEVNT",159,0)
 S Y=+$G(^DIC(42,+X,44))_";SC("
"RTN","ORMEVNT",160,0)
 Q Y
"RTN","ORMEVNT",161,0)
 ;
"RTN","ORMEVNT",162,0)
DISCH ; -- Lapse/cancel outstanding events on discharge
"RTN","ORMEVNT",163,0)
 D DISCH^ORMEVNT2 ;195 Code moved to ORMEVNT2 for space considerations
"RTN","ORMEVNT",164,0)
 Q
"RTN","ORMEVNT",165,0)
 ;
"RTN","ORMEVNT",166,0)
XTMP ; -- Save ORIFN to possibly reinstate on admission
"RTN","ORMEVNT",167,0)
 ;    Also uses ORVP, DGPMDA
"RTN","ORMEVNT",168,0)
 Q:'$G(DGPMDA)  Q:'$G(ORIFN)  Q:'$G(ORVP)
"RTN","ORMEVNT",169,0)
 N ORNOW S ORNOW=+$$NOW^XLFDT
"RTN","ORMEVNT",170,0)
 I $G(^XTMP("ORDCOBS-"_+ORVP,0)),+^(0)<ORNOW K ^XTMP("ORDCOBS-"_+ORVP)
"RTN","ORMEVNT",171,0)
 I '$G(^XTMP("ORDCOBS-"_+ORVP,0)) D
"RTN","ORMEVNT",172,0)
 . N ORNOW1H S ORNOW1H=$$FMADD^XLFDT(ORNOW,,1)
"RTN","ORMEVNT",173,0)
 . S ^XTMP("ORDCOBS-"_+ORVP,0)=ORNOW1H_U_ORNOW_"^InptMeds AutoDC'd on Discharge from Observation"
"RTN","ORMEVNT",174,0)
 S ^XTMP("ORDCOBS-"_+ORVP,+ORIFN)=$G(^OR(100,+ORIFN,4))
"RTN","ORMEVNT",175,0)
 S ^XTMP("ORDCOBS-"_+ORVP,"DISCHARGE")=DGPMDA
"RTN","ORMEVNT",176,0)
 Q
"RTN","ORMEVNT",177,0)
 ;
"RTN","ORMEVNT",178,0)
REINST ; -- Reinstate meds from observation
"RTN","ORMEVNT",179,0)
 I '$L($T(ENR^PSJOERI)) K ^XTMP("ORDCOBS-"_+ORVP) Q   ;DBIA 3598
"RTN","ORMEVNT",180,0)
 N ORIDT,ORLASTDC,X0,ORIFN,PSIFN
"RTN","ORMEVNT",181,0)
 S ORIDT=+$O(^DGPM("ATID3",+ORVP,0)) S:DGPMT=2 ORIDT=$O(^DGPM("ATID3",+ORVP,ORIDT)) Q:ORIDT<1  S ORLASTDC=+$O(^(ORIDT,0)) ;186 If reinstating for transfer TO ASIH then skip pseudo discharge for WHILE ASIH
"RTN","ORMEVNT",182,0)
 Q:$G(^XTMP("ORDCOBS-"_+ORVP,"DISCHARGE"))'=ORLASTDC  S X0=$G(^(0))
"RTN","ORMEVNT",183,0)
 I $P(X0,U)<$$NOW^XLFDT K ^XTMP("ORDCOBS-"_+ORVP) Q  ;readmit after one hour 177
"RTN","ORMEVNT",184,0)
 S ORIFN=0 F  S ORIFN=+$O(^XTMP("ORDCOBS-"_+ORVP,ORIFN))  Q:ORIFN<1  S PSIFN=$G(^(ORIFN)) D:PSIFN ENR^PSJOERI(+ORVP,PSIFN,+ORWARD)  ;DBIA 3598
"RTN","ORMEVNT",185,0)
 K ^XTMP("ORDCOBS-"_+ORVP)
"RTN","ORMEVNT",186,0)
 Q
"RTN","ORMEVNT",187,0)
 ;
"RTN","ORMEVNT",188,0)
 ; -- Moved code:
"RTN","ORMEVNT",189,0)
EXP(ORDER,ORSTOP) G EXP^ORMEVNT1
"RTN","ORMEVNT",190,0)
ACTIVE(ORDER,ORSTRT) G ACT^ORMEVNT1
"RTN","ORMEVNT",191,0)
PURGE(ORDER) G PUR^ORMEVNT1
"RTN","ORMFH")
0^76^B63062271
"RTN","ORMFH",1,0)
ORMFH ;SLC/MKB - Process Dietetics ORM msgs ;5/5/05  13:18
"RTN","ORMFH",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**3,73,92,215,243**;Dec 17, 1997;Build 242
"RTN","ORMFH",3,0)
 ;
"RTN","ORMFH",4,0)
EN ; -- entry point for FH messages
"RTN","ORMFH",5,0)
 I '$L($T(@ORDCNTRL)) Q  ;S ORERR="Invalid order control code" Q
"RTN","ORMFH",6,0)
 I ORDCNTRL'="SN",ORDCNTRL'="ZP",'ORIFN!('$D(^OR(100,+ORIFN,0))) S ORERR="Invalid OE/RR order number" Q
"RTN","ORMFH",7,0)
 S ORLOG=+$E($$NOW^XLFDT,1,12) S:'$G(ORDUZ) ORDUZ=DUZ S:'$G(ORNP) ORNP=ORDUZ
"RTN","ORMFH",8,0)
 S:$G(DGPMT) ORNATR="A",OREASON=$S(DGPMT=1:"Admission",DGPMT=3:"Discharge",1:"Transfer"),ORDUZ=""
"RTN","ORMFH",9,0)
 D @ORDCNTRL
"RTN","ORMFH",10,0)
 Q
"RTN","ORMFH",11,0)
 ;
"RTN","ORMFH",12,0)
ZP ; -- Purged
"RTN","ORMFH",13,0)
 Q:'ORIFN  Q:'$D(^OR(100,+ORIFN,0))
"RTN","ORMFH",14,0)
 K ^OR(100,+ORIFN,4) I "^6^8^"[(U_$P($G(^(3)),U,3)_U) D STATUS^ORCSAVE2(+ORIFN,14) ; Remove pkg reference, sts=lapsed if still active
"RTN","ORMFH",15,0)
 Q
"RTN","ORMFH",16,0)
 ;
"RTN","ORMFH",17,0)
ZR ; -- Purged as requested [ack]
"RTN","ORMFH",18,0)
 D DELETE^ORCSAVE2(+ORIFN)
"RTN","ORMFH",19,0)
 Q
"RTN","ORMFH",20,0)
 ;
"RTN","ORMFH",21,0)
ZU ; -- Unable to purge [ack]
"RTN","ORMFH",22,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT ; update Last Activity
"RTN","ORMFH",23,0)
 Q
"RTN","ORMFH",24,0)
 ;
"RTN","ORMFH",25,0)
OK ; -- Order accepted, FH order # assigned [ack]
"RTN","ORMFH",26,0)
 N ORSTS S ^OR(100,+ORIFN,4)=PKGIFN ; FH identifier
"RTN","ORMFH",27,0)
 I "DN"'[$E(PKGIFN) S ORSTS=6 ;not Diet or NPO
"RTN","ORMFH",28,0)
 E  S ORSTS=$S($P($G(^OR(100,+ORIFN,0)),U,8)>ORLOG:8,1:6)
"RTN","ORMFH",29,0)
 D STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMFH",30,0)
 Q
"RTN","ORMFH",31,0)
 ;
"RTN","ORMFH",32,0)
XX ; -- Edited backdoor order (OP recurring meals only)
"RTN","ORMFH",33,0)
 D XX^ORMFH1 Q
"RTN","ORMFH",34,0)
 ;
"RTN","ORMFH",35,0)
SN ; -- New backdoor order: return NA msg w/ORIFN
"RTN","ORMFH",36,0)
 N ODS,ODT,OBR,ORDIALOG,X,I,OI,SEG,ORNEW,ORPARAM,ORTIME,ORSTS,ORDG,ORP,ORTRAIL
"RTN","ORMFH",37,0)
 ;I '$D(^VA(200,+ORNP,0)) S ORERR="Missing or invalid ordering provider"Q
"RTN","ORMFH",38,0)
 ; Don't require provider until Nature of Order is added
"RTN","ORMFH",39,0)
 I '$G(DGPMT),'$D(^VA(200,+ORDUZ,0)) S ORERR="Missing or invalid entering person" Q
"RTN","ORMFH",40,0)
 I 'ORSTRT S ORERR="Missing effective date/time" Q
"RTN","ORMFH",41,0)
 ;I '$G(ORL) S ORERR="Missing or invalid patient location" Q
"RTN","ORMFH",42,0)
 D EN1^FHWOR8(ORL,.ORPARAM)
"RTN","ORMFH",43,0)
 S ODS=$O(@ORMSG@(+ORC)) I 'ODS S ORERR="Incomplete message" Q
"RTN","ORMFH",44,0)
 S ODS=ODS_U_@ORMSG@(ODS),ORSTS=6 I '$L(ORNATR),ORCAT="I" S ORNATR="S"
"RTN","ORMFH",45,0)
 I $E($P(ODS,U,2),1,3)="OBR" S OBR=ODS D IP G SN1
"RTN","ORMFH",46,0)
 I $E($P(ODS,U,2),1,3)="ODT" S ODT=ODS D TRAY G SN1
"RTN","ORMFH",47,0)
 I $E($P(ODS,U,2),1,3)'="ODS" S ORERR="Missing or invalid ODS segment" Q
"RTN","ORMFH",48,0)
 I $P(ODS,"|",2)="ZE" D TF G SN1
"RTN","ORMFH",49,0)
 I $P(ODS,"|",4)?1"^^^FH-6".E D ADDL G SN1
"RTN","ORMFH",50,0)
 I ORCAT'="I" D OPM^ORMFH1 G SN1
"RTN","ORMFH",51,0)
 I $P(ODS,"|",4)?1"^^^FH-5".E D NPO G SN1
"RTN","ORMFH",52,0)
DIET ; Diet order
"RTN","ORMFH",53,0)
 S ORDIALOG=$O(^ORD(101.41,"AB","FHW1",0)),ORTRAIL="Diet"
"RTN","ORMFH",54,0)
 D GETDLG1^ORCD(ORDIALOG) S:ORSTRT>ORLOG ORSTS=8
"RTN","ORMFH",55,0)
 S ORDIALOG($$PTR("START DATE/TIME"),1)=ORSTRT
"RTN","ORMFH",56,0)
 S:ORSTOP ORDIALOG($$PTR("STOP DATE/TIME"),1)=ORSTOP
"RTN","ORMFH",57,0)
 S X=$P(ODS,"|",2),ORDIALOG($$PTR("DELIVERY"),1)=$S($L(X)=1:X,1:$E(X,2))
"RTN","ORMFH",58,0)
 ; Comments ??
"RTN","ORMFH",59,0)
 S X=$$ORDITEM^ORM($P(ODS,"|",4))
"RTN","ORMFH",60,0)
 I 'X S ORERR="Missing or invalid diet modification" Q
"RTN","ORMFH",61,0)
 S I=1,OI=$$PTR("ORDERABLE ITEM"),ORDIALOG(OI,I)=X
"RTN","ORMFH",62,0)
 I $O(@ORMSG@(+ODS)) F  S ODS=$O(@ORMSG@(+ODS)) Q:ODS'>0  S SEG=$E(@ORMSG@(+ODS),1,3) Q:SEG="ORC"  Q:SEG="MSH"  I SEG="ODS" D  Q:$D(ORERR)
"RTN","ORMFH",63,0)
 . S X=$$ORDITEM^ORM($P(@ORMSG@(+ODS),"|",4))
"RTN","ORMFH",64,0)
 . I 'X S ORERR="Missing or invalid diet modification" Q
"RTN","ORMFH",65,0)
 . S I=I+1,ORDIALOG(OI,I)=X
"RTN","ORMFH",66,0)
SN1 ; continue ... save order, post message
"RTN","ORMFH",67,0)
 Q:$D(ORERR)
"RTN","ORMFH",68,0)
 D EN^ORCSAVE I '$G(ORIFN) S ORERR="Cannot create new order" Q
"RTN","ORMFH",69,0)
 D RELEASE^ORCSAVE2(ORIFN,1,ORLOG,ORDUZ,ORNATR),SIGSTS^ORCSAVE2(ORIFN,1)
"RTN","ORMFH",70,0)
 D:'$P($G(^OR(100,ORIFN,0)),U,8) DATES^ORCSAVE2(ORIFN,ORSTRT,ORSTOP)
"RTN","ORMFH",71,0)
 D STATUS^ORCSAVE2(ORIFN,ORSTS)
"RTN","ORMFH",72,0)
 I $G(ORL) S ORP(1)=ORIFN_";1^1" D PRINTS^ORWD1(.ORP,+ORL) ; chart copy
"RTN","ORMFH",73,0)
 S ^OR(100,ORIFN,4)=PKGIFN
"RTN","ORMFH",74,0)
 Q
"RTN","ORMFH",75,0)
 ;
"RTN","ORMFH",76,0)
TRAY ; Early/Late tray
"RTN","ORMFH",77,0)
 I 'ORSTOP S ORERR="Missing stop date" Q
"RTN","ORMFH",78,0)
 S ORDIALOG=$O(^ORD(101.41,"AB","FHW2",0)) D GETDLG1^ORCD(ORDIALOG),EN2^ORCDFH
"RTN","ORMFH",79,0)
 S ORDIALOG($$PTR("START DATE"),1)=ORSTRT
"RTN","ORMFH",80,0)
 S ORDIALOG($$PTR("STOP DATE"),1)=ORSTOP
"RTN","ORMFH",81,0)
 N DAYS,SCH S DAYS="",SCH=$P(ORQT,U,2)
"RTN","ORMFH",82,0)
 I $L(SCH),SCH'="ONCE" F I=1:1:$L(SCH,"~") S X=+$P($P(SCH,"~",I),"J",2),DAYS=DAYS_$E("MTWRFSX",X)
"RTN","ORMFH",83,0)
 S:$L(DAYS) ORDIALOG($$PTR("SCHEDULE"),1)=DAYS
"RTN","ORMFH",84,0)
 S OI=+$O(^ORD(101.43,"S.E/L T",$P(ODT,"|",2)_" TRAY",0)),ORDIALOG($$PTR("ORDERABLE ITEM"),1)=OI
"RTN","ORMFH",85,0)
 S X=$P($P(ODT,"|",3),U,4),ORDIALOG($$PTR("MEAL"),1)=$E(X)
"RTN","ORMFH",86,0)
 S ORDIALOG($$PTR("MEAL TIME"),1)=$P($G(ORTIME(OI,$E(X),+$E(X,3))),U,2)
"RTN","ORMFH",87,0)
 S:$L($P(ODT,"|",4)) ORDIALOG($$PTR("YES/NO"),1)=1
"RTN","ORMFH",88,0)
 Q
"RTN","ORMFH",89,0)
 ;
"RTN","ORMFH",90,0)
IP ; Isolation/Precautions
"RTN","ORMFH",91,0)
 N IP S IP=+$P($P(OBR,"|",13),U,4)
"RTN","ORMFH",92,0)
 I IP'>0 S ORERR="Missing or invalid isolation type" Q
"RTN","ORMFH",93,0)
 S ORDIALOG=$O(^ORD(101.41,"AB","FHW3",0)) D GETDLG1^ORCD(ORDIALOG)
"RTN","ORMFH",94,0)
 S ORDIALOG($$PTR("ISOLATION TYPE"),1)=IP
"RTN","ORMFH",95,0)
 S ORDIALOG($$PTR("ORDERABLE ITEM"),1)=$O(^ORD(101.43,"S.PREC","ISOLATION PROCEDURES",0))
"RTN","ORMFH",96,0)
 Q
"RTN","ORMFH",97,0)
 ;
"RTN","ORMFH",98,0)
TF ; Tubefeeding
"RTN","ORMFH",99,0)
 N OI,STR,INSTR,CMMT,I,X,X4,XI,ZQT,QT,QTY,DUR
"RTN","ORMFH",100,0)
 S ORDIALOG=$O(^ORD(101.41,"AB","FHW8",0)) D GETDLG1^ORCD(ORDIALOG)
"RTN","ORMFH",101,0)
 S OI=$$PTR("ORDERABLE ITEM"),STR=$$PTR("STRENGTH FH")
"RTN","ORMFH",102,0)
 S INSTR=$$PTR("INSTRUCTIONS"),CMMT=$$PTR("FREE TEXT 1")
"RTN","ORMFH",103,0)
 ; Comments ??
"RTN","ORMFH",104,0)
 S I=0 F  D  S ODS=$O(@ORMSG@(+ODS)) Q:ODS'>0  Q:$E(@ORMSG@(ODS),1,3)="ORC"  S ODS=ODS_U_@ORMSG@(ODS)
"RTN","ORMFH",105,0)
 . Q:$E($P(ODS,U,2),1,3)'="ODS"  ; not ODS segment
"RTN","ORMFH",106,0)
 . S X=$P(ODS,"|",4),X4=$P(X,U,4) ; OI
"RTN","ORMFH",107,0)
 . S:X4["-" $P(X,U,4)=+X4,X4=+$P(X4,"-",2) ; strength
"RTN","ORMFH",108,0)
 . S XI=$$ORDITEM^ORM(X) I 'XI S ORERR="Missing or invalid tubefeeding product" Q
"RTN","ORMFH",109,0)
 . S ZQT=$O(@ORMSG@(+ODS)) I 'ZQT S ORERR="Missing QT information" Q
"RTN","ORMFH",110,0)
 . S QT=$P(@ORMSG@(ZQT),"|",3),DUR=$P(QT,U,3)
"RTN","ORMFH",111,0)
 . S QTY=+QT_" "_$$UNITS($P($P(QT,U),"&",2))_"/"_$P(QT,U,2)
"RTN","ORMFH",112,0)
 . S:$L(DUR) QTY=QTY_" X "_+$E(DUR,2,99)_$S($E(DUR)="H":"HR",1:"")
"RTN","ORMFH",113,0)
 . S I=I+1,ORDIALOG(OI,I)=XI,ORDIALOG(STR,I)=X4,ORDIALOG(INSTR,I)=QTY
"RTN","ORMFH",114,0)
 . S:$L($P(ODS,"|",5)) ORDIALOG(CMMT,I)=$P(ODS,"|",5)
"RTN","ORMFH",115,0)
 I ORCAT="O",ORQT["~" D DATES
"RTN","ORMFH",116,0)
 Q
"RTN","ORMFH",117,0)
 ;
"RTN","ORMFH",118,0)
UNITS(X) ; -- Returns name of unit X
"RTN","ORMFH",119,0)
 N Y S X=$E(X)
"RTN","ORMFH",120,0)
 S Y=$S(X="K":"KCAL",X="C":"CC",X="M":"ML",X="O":"OZ",X="U":"UNITS",X="T":"TBSP",X="G":"GM",1:"")
"RTN","ORMFH",121,0)
 Q Y
"RTN","ORMFH",122,0)
 ;
"RTN","ORMFH",123,0)
NPO ; NPO <uses FHW1 dialog - FHW4 now a quick order>
"RTN","ORMFH",124,0)
 S ORDIALOG=$O(^ORD(101.41,"AB","FHW1",0)) D GETDLG1^ORCD(ORDIALOG)
"RTN","ORMFH",125,0)
 S ORDIALOG($$PTR("ORDERABLE ITEM"),1)=$O(^ORD(101.43,"S.DIET","NPO",0))
"RTN","ORMFH",126,0)
 S ORDIALOG($$PTR("START DATE/TIME"),1)=ORSTRT S:ORSTRT>ORLOG ORSTS=8
"RTN","ORMFH",127,0)
 S:ORSTOP ORDIALOG($$PTR("STOP DATE/TIME"),1)=ORSTOP
"RTN","ORMFH",128,0)
 S:$L($P(ODS,"|",5)) ORDIALOG($$PTR("FREE TEXT 1"),1)=$P(ODS,"|",5)
"RTN","ORMFH",129,0)
 Q
"RTN","ORMFH",130,0)
 ;
"RTN","ORMFH",131,0)
ADDL ; Additional order
"RTN","ORMFH",132,0)
 S ORDIALOG=$O(^ORD(101.41,"AB","FHW7",0)) D GETDLG1^ORCD(ORDIALOG)
"RTN","ORMFH",133,0)
 S ORDIALOG($$PTR("FREE TEXT 1"),1)=$P(ODS,"|",5)
"RTN","ORMFH",134,0)
 I ORCAT="O",ORQT["~" D DATES
"RTN","ORMFH",135,0)
 Q
"RTN","ORMFH",136,0)
 ;
"RTN","ORMFH",137,0)
DATES ; -- pull dates out of ORQT
"RTN","ORMFH",138,0)
 N P,I,X S P=$$PTR("DATE/TIME")
"RTN","ORMFH",139,0)
 F I=1:1:$L(ORQT,"~") S X=$P(ORQT,"~",I),ORDIALOG(P,I)=$$HL7TFM^XLFDT($P(X,U,4))
"RTN","ORMFH",140,0)
 S ORSTRT=$G(ORDIALOG(P,1)),ORSTOP=$G(ORDIALOG(P,I))
"RTN","ORMFH",141,0)
 Q
"RTN","ORMFH",142,0)
 ;
"RTN","ORMFH",143,0)
SC ; -- Status Change
"RTN","ORMFH",144,0)
SR ; -- Status Update [ack]
"RTN","ORMFH",145,0)
 N ORSTS,OROLD S OROLD=$P($G(^OR(100,+ORIFN,3)),U,3)
"RTN","ORMFH",146,0)
 D DATES^ORCSAVE2(+ORIFN,ORSTRT,ORSTOP)
"RTN","ORMFH",147,0)
 S ORSTS=$S(ORDSTS="DC":1,ORDSTS="IP":6,ORDSTS="ZE":7,ORDSTS="SC":8,1:"")
"RTN","ORMFH",148,0)
 D:ORSTS STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMFH",149,0)
 I ORDSTS="DC",'$D(^OR(100,+ORIFN,6)) D  ;set 6-node
"RTN","ORMFH",150,0)
 . I ORNATR'="A","DN"[$E(PKGIFN) S ORNATR="C" S:'$L(OREASON) OREASON="Replaced with new diet order" S:ORDUZ<1 ORDUZ=""
"RTN","ORMFH",151,0)
 . S ^OR(100,+ORIFN,6)=$S($L(ORNATR):+$O(^ORD(100.02,"C",ORNATR,0)),1:"")_U_ORDUZ_U_ORLOG_U_U_OREASON
"RTN","ORMFH",152,0)
 I OROLD=1,ORSTS=6 D  ; reactivate
"RTN","ORMFH",153,0)
 . N X S $P(^OR(100,+ORIFN,3),U,7)=1,X=$P(^(0),U,9) K ^(6)
"RTN","ORMFH",154,0)
 . I 'ORSTOP,X S $P(^OR(100,+ORIFN,0),U,9)="" K ^OR(100,"AE",X,+ORIFN)
"RTN","ORMFH",155,0)
 . D SETALL^ORDD100(+ORIFN)
"RTN","ORMFH",156,0)
 Q
"RTN","ORMFH",157,0)
 ;
"RTN","ORMFH",158,0)
OC ; -- Cancelled <E/L Trays only> / [ack]
"RTN","ORMFH",159,0)
 G:ORTYPE="ORR" UA ;rejected new order
"RTN","ORMFH",160,0)
 I $P($G(^OR(100,+ORIFN,3)),U,3)=6,$P(^(0),U,8)<ORLOG G OD
"RTN","ORMFH",161,0)
 S ^OR(100,+ORIFN,6)=$S($L(ORNATR):+$O(^ORD(100.02,"C",ORNATR,0)),1:"")_U_ORDUZ_U_ORLOG_U_U_OREASON
"RTN","ORMFH",162,0)
 D UPDATE(13,"DC")
"RTN","ORMFH",163,0)
 Q
"RTN","ORMFH",164,0)
 ;
"RTN","ORMFH",165,0)
CR ; -- Cancelled as requested [ack]
"RTN","ORMFH",166,0)
 D STATUS^ORCSAVE2(+ORIFN,13)
"RTN","ORMFH",167,0)
 Q
"RTN","ORMFH",168,0)
 ;
"RTN","ORMFH",169,0)
OD ; -- Discontinued <Tubefeedings only>
"RTN","ORMFH",170,0)
 S ^OR(100,+ORIFN,6)=$S($L(ORNATR):+$O(^ORD(100.02,"C",ORNATR,0)),1:"")_U_ORDUZ_U_ORLOG_U_U_OREASON
"RTN","ORMFH",171,0)
 D UPDATE(1,"DC")
"RTN","ORMFH",172,0)
 Q
"RTN","ORMFH",173,0)
 ;
"RTN","ORMFH",174,0)
DR ; -- Discontinued as requested [ack]
"RTN","ORMFH",175,0)
 D STATUS^ORCSAVE2(+ORIFN,1)
"RTN","ORMFH",176,0)
 Q
"RTN","ORMFH",177,0)
 ;
"RTN","ORMFH",178,0)
UA ; -- Unable to Accept [ack]
"RTN","ORMFH",179,0)
 S:'$L(ORNATR) ORNATR="X" ;Rejected
"RTN","ORMFH",180,0)
 S ^OR(100,+ORIFN,6)=+$O(^ORD(100.02,"C",ORNATR,0))_U_U_ORLOG_U_U_OREASON
"RTN","ORMFH",181,0)
 D STATUS^ORCSAVE2(+ORIFN,13)
"RTN","ORMFH",182,0)
UC ; -- Unable to Cancel [ack]
"RTN","ORMFH",183,0)
UD ; -- Unable to Discontinue [ack]
"RTN","ORMFH",184,0)
 N DA S DA=$P(ORIFN,";",2) I DA D
"RTN","ORMFH",185,0)
 . S:$G(OREJECT) $P(^OR(100,+ORIFN,8,DA,0),U,15)=13 ; request rejected
"RTN","ORMFH",186,0)
 . S:$L(OREASON) ^OR(100,+ORIFN,8,DA,1)=OREASON
"RTN","ORMFH",187,0)
 Q
"RTN","ORMFH",188,0)
 ;
"RTN","ORMFH",189,0)
UPDATE(ORSTS,ORACT) ; -- continue processing
"RTN","ORMFH",190,0)
 N ORX,DA,ORP D DATES^ORCSAVE2(+ORIFN,ORSTRT,ORSTOP)
"RTN","ORMFH",191,0)
 D:$G(ORSTS) STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMFH",192,0)
 S ORX=$$CREATE^ORX1(ORNATR) D:ORX
"RTN","ORMFH",193,0)
 . S DA=$$ACTION^ORCSAVE(ORACT,+ORIFN,ORNP,OREASON,ORLOG,ORDUZ)
"RTN","ORMFH",194,0)
 . I DA'>0 S ORERR="Cannot create new order action" Q
"RTN","ORMFH",195,0)
 . D RELEASE^ORCSAVE2(+ORIFN,DA,ORLOG,ORDUZ,ORNATR)
"RTN","ORMFH",196,0)
 . D SIGSTS^ORCSAVE2(+ORIFN,DA)
"RTN","ORMFH",197,0)
 . I $G(ORL) S ORP(1)=+ORIFN_";"_DA_"^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMFH",198,0)
 . S $P(^OR(100,+ORIFN,3),U,7)=DA
"RTN","ORMFH",199,0)
 I ORACT="DC",'$$ACTV^ORX1(ORNATR) S $P(^OR(100,+ORIFN,3),U,7)=0
"RTN","ORMFH",200,0)
 D:ORACT="DC" CANCEL^ORCSEND(+ORIFN)
"RTN","ORMFH",201,0)
 Q
"RTN","ORMFH",202,0)
 ;
"RTN","ORMFH",203,0)
PTR(NAME) ; -- Returns ien of prompt NAME in Order Dialog file #101.41
"RTN","ORMFH",204,0)
 Q $O(^ORD(101.41,"AB",$E("OR GTX "_NAME,1,63),0))
"RTN","ORMFN")
0^101^B33381686
"RTN","ORMFN",1,0)
ORMFN ; SLC/MKB - MFN msg router ;11/21/2006
"RTN","ORMFN",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**26,97,94,176,215,243**;Dec 17, 1997;Build 242
"RTN","ORMFN",3,0)
EN(MSG) ; -- main entry point for OR ITEM RECEIVE
"RTN","ORMFN",4,0)
 N ORMSG,ORNMSP,ORDG,MSH,MFI,MFE,ZPKG,ZSY,NTE,ORMFE,ORDITEM,ORACTION,ORDIFN,ORFIEN,ORFLD,ORFDA,NUM,VALUE,X,Y,DA,DIC,DIK,SYS,ZLC,LAST,NAME,ID,INACTIVE,I,ORY,NEXT,DD,DO
"RTN","ORMFN",5,0)
 S ORMSG=$G(MSG,"MSG") Q:'$O(@ORMSG@(0))  ; msg array root
"RTN","ORMFN",6,0)
 N ORNOW S ORNOW=$$NOW^XLFDT ;M ^XTMP("OR ITEM RECEIVE",ORNOW)=@ORMSG
"RTN","ORMFN",7,0)
MSH S MSH=0 F  S MSH=$O(@ORMSG@(MSH)) Q:MSH'>0  Q:$E(@ORMSG@(MSH),1,3)="MSH"
"RTN","ORMFN",8,0)
 Q:'MSH  S MSH=MSH_U_@ORMSG@(MSH)
"RTN","ORMFN",9,0)
 S X=$P(MSH,"|",3) S:X="RADIOLOGY" X="IMAGING"
"RTN","ORMFN",10,0)
 S ORDG=$O(^ORD(100.98,"B",X,0)),ORNMSP=$$NMSP(X) Q:'$L(ORNMSP)
"RTN","ORMFN",11,0)
 S MFI=$O(@ORMSG@(+MSH)) Q:$E(@ORMSG@(MFI),1,3)'="MFI"  ; error
"RTN","ORMFN",12,0)
MFE S MFE=+MFI ; ** loop through each MFE segment
"RTN","ORMFN",13,0)
 F  S MFE=$O(@ORMSG@(+MFE)) Q:MFE'>0  I $E(@ORMSG@(MFE),1,3)="MFE" D
"RTN","ORMFN",14,0)
 . K ORFLD,ORFDA
"RTN","ORMFN",15,0)
 . S MFE=MFE_U_@ORMSG@(MFE),ORMFE=$P(MFE,"|",2),INACTIVE=$P(MFE,"|",4)
"RTN","ORMFN",16,0)
 . S ORDITEM=$P(MFE,"|",5),NAME=$TR($P(ORDITEM,U,5),"~"," ")
"RTN","ORMFN",17,0)
 . S ID=$P(ORDITEM,U,4)_";"_$P(ORDITEM,U,6)
"RTN","ORMFN",18,0)
 . S ORDIFN=+$O(^ORD(101.43,"ID",ID,0)),ORFIEN=ORDIFN_","
"RTN","ORMFN",19,0)
 . S ORACTION=$S(ORMFE="MAD":1,(ORMFE="MAC")&('ORDIFN):1,(ORMFE="MUP")&('ORDIFN):1,'ORDIFN:0,ORMFE="MAC":2,ORMFE="MUP":2,ORMFE="MDC":3,ORMFE="MDL":3,1:0) ; 1=add, 2=change, 3=delete (inactivate)
"RTN","ORMFN",20,0)
 . Q:'ORACTION  ; 0=error
"RTN","ORMFN",21,0)
 . I ORACTION=3 S ORFDA(101.43,ORFIEN,.1)=$S(INACTIVE:$$HL7TFM^XLFDT(INACTIVE),1:$$NOW^XLFDT) D FILE^DIE("K","ORFDA") Q
"RTN","ORMFN",22,0)
ADD . I ORACTION=1,'ORDIFN D  Q:'ORDIFN  ;create item if it doesn't exist
"RTN","ORMFN",23,0)
 . . S ORDIFN=$$CREATE(NAME),ORFIEN=ORDIFN_","
"RTN","ORMFN",24,0)
 . . S ORFDA(101.43,ORFIEN,5)=+ORDG
"RTN","ORMFN",25,0)
 . S ORFLD(.01)=NAME,ORFLD(1.1)=NAME,ORFLD(2)=ID,ORFLD(3)=$P(ORDITEM,U)
"RTN","ORMFN",26,0)
 . S SYS=$P(ORDITEM,U,3),ORFLD(4)=$S(+SYS=99:$E(SYS,3,99),1:SYS)
"RTN","ORMFN",27,0)
 . S ORFLD(.1)=$S(ORMFE="MAC":"@",(ORMFE="MUP")&('INACTIVE):"@",INACTIVE:$$HL7TFM^XLFDT(INACTIVE),1:"")
"RTN","ORMFN",28,0)
 . F NUM=.01,.1,1.1,2,3,4 S VALUE=$S(ORFLD(NUM)="":"@",1:ORFLD(NUM)) D VAL^DIE(101.43,ORFIEN,NUM,"F",VALUE,.ORY,"ORFDA")
"RTN","ORMFN",29,0)
ZPKG . S LAST=+MFE,ZPKG=$O(@ORMSG@(+MFE))
"RTN","ORMFN",30,0)
 . I ZPKG,$E(@ORMSG@(ZPKG),1,3)=("Z"_ORNMSP) S ZPKG=ZPKG_U_@ORMSG@(ZPKG),LAST=+ZPKG D @ORNMSP ; ZXX segment
"RTN","ORMFN",31,0)
 . D FILE^DIE("K","ORFDA") ; file data
"RTN","ORMFN",32,0)
ZLC . S NEXT=$O(@ORMSG@(LAST)) I NEXT,$E(@ORMSG@(NEXT),1,3)="ZLC" D
"RTN","ORMFN",33,0)
 . . N COMP,CID,CODE,CSYS
"RTN","ORMFN",34,0)
 . . K DA,^ORD(101.43,ORDIFN,10) ;S DIC("P")=$P(^DD(101.43,10,0),U,2)
"RTN","ORMFN",35,0)
 . . S DA(1)=ORDIFN,DIC="^ORD(101.43,"_DA(1)_",10,",DIC(0)="L",ZLC=LAST
"RTN","ORMFN",36,0)
 . . F  S ZLC=$O(@ORMSG@(ZLC)) Q:ZLC'>0  Q:$E(@ORMSG@(ZLC),1,3)'="ZLC"  D
"RTN","ORMFN",37,0)
 . . . S COMP=$P(@ORMSG@(ZLC),"|",5),X=$P(COMP,U,5) I X="" S LAST=ZLC Q
"RTN","ORMFN",38,0)
 . . . S CID=$P(COMP,U,4)_";"_$P(COMP,U,6) K DIC("DR"),DO,DD
"RTN","ORMFN",39,0)
 . . . S CODE=$P(COMP,U),CSYS=$P(COMP,U,3) S:+CSYS=99 CSYS=$E(CSYS,3,99)
"RTN","ORMFN",40,0)
 . . . S DIC("DR")="2///^S X=CID;3///^S X=CODE;4///^S X=CSYS"
"RTN","ORMFN",41,0)
 . . . D FILE^DICN S LAST=ZLC
"RTN","ORMFN",42,0)
ZSY . I $D(^ORD(101.43,ORDIFN,2)) D  ; kill old ones first
"RTN","ORMFN",43,0)
 . . S DA(1)=ORDIFN,DIK="^ORD(101.43,"_DA(1)_",2,"
"RTN","ORMFN",44,0)
 . . S DA=0 F  S DA=$O(^ORD(101.43,DA(1),2,DA)) Q:DA'>0  D ^DIK
"RTN","ORMFN",45,0)
 . . K ^ORD(101.43,ORDIFN,2),DIK,DA
"RTN","ORMFN",46,0)
 . S NEXT=$O(@ORMSG@(LAST)) I NEXT,$E(@ORMSG@(NEXT),1,3)="ZSY" D
"RTN","ORMFN",47,0)
 . . K DA,DIC S DA(1)=ORDIFN,DIC="^ORD(101.43,"_DA(1)_",2,"
"RTN","ORMFN",48,0)
 . . S DIC(0)="L",ZSY=LAST ;,DIC("P")=$P(^DD(101.43,1,0),U,2)
"RTN","ORMFN",49,0)
 . . F  S ZSY=$O(@ORMSG@(+ZSY)) Q:ZSY'>0  Q:$E(@ORMSG@(ZSY),1,3)'="ZSY"  D
"RTN","ORMFN",50,0)
 . . . S X=$P(@ORMSG@(ZSY),"|",3),LAST=ZSY
"RTN","ORMFN",51,0)
 . . . K DD,DO D:$L(X) FILE^DICN
"RTN","ORMFN",52,0)
NTE . K ^ORD(101.43,ORDIFN,8) ; replace text
"RTN","ORMFN",53,0)
 . S NEXT=$O(@ORMSG@(LAST)) I NEXT,$E(@ORMSG@(NEXT),1,3)="NTE" D
"RTN","ORMFN",54,0)
 . . S NTE=LAST,DA=0
"RTN","ORMFN",55,0)
 . . F  S NTE=$O(@ORMSG@(NTE)) Q:NTE'>0  Q:$E(@ORMSG@(NTE),1,3)'="NTE"  S DA=DA+1,^ORD(101.43,ORDIFN,8,DA,0)=$P(@ORMSG@(NTE),"|",4) I $O(@ORMSG@(NTE,0)) D
"RTN","ORMFN",56,0)
 . . . S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S DA=DA+1,^ORD(101.43,ORDIFN,8,DA,0)=@ORMSG@(NTE,I)
"RTN","ORMFN",57,0)
 . . S ^ORD(101.43,ORDIFN,8,0)="^^"_DA_U_DA_U_DT_U
"RTN","ORMFN",58,0)
 Q
"RTN","ORMFN",59,0)
 ;
"RTN","ORMFN",60,0)
NMSP(NAME) ; -- returns namespace for package
"RTN","ORMFN",61,0)
 I NAME="RADIOLOGY" Q "RA"
"RTN","ORMFN",62,0)
 I NAME="IMAGING" Q "RA"
"RTN","ORMFN",63,0)
 I NAME="LABORATORY" Q "LR"
"RTN","ORMFN",64,0)
 I NAME="DIETETICS" Q "FH"
"RTN","ORMFN",65,0)
 I NAME="PHARMACY" Q "PS"
"RTN","ORMFN",66,0)
 I NAME="CONSULTS" Q "CS"
"RTN","ORMFN",67,0)
 I NAME="PROCEDURES" Q "CS"
"RTN","ORMFN",68,0)
 Q ""
"RTN","ORMFN",69,0)
 ;
"RTN","ORMFN",70,0)
CREATE(X) ; -- Create new item in #101.43
"RTN","ORMFN",71,0)
 Q:'$L($G(X)) 0 N HDR,LAST,TOTAL,I
"RTN","ORMFN",72,0)
 L +^ORD(101.43,0):1 Q:'$T 0
"RTN","ORMFN",73,0)
 S HDR=$G(^ORD(101.43,0)) Q:HDR="" 0
"RTN","ORMFN",74,0)
 S LAST=$P(HDR,U,3),TOTAL=$P(HDR,U,4)
"RTN","ORMFN",75,0)
 F I=(LAST+1):1 Q:'$D(^ORD(101.43,I,0))
"RTN","ORMFN",76,0)
 S ^ORD(101.43,I,0)=X,X=$E(X,1,30),^ORD(101.43,"B",$$UP^XLFSTR(X),I)=""
"RTN","ORMFN",77,0)
 S $P(^ORD(101.43,0),U,3,4)=I_U_(TOTAL+1)
"RTN","ORMFN",78,0)
 L -^ORD(101.43,0)
"RTN","ORMFN",79,0)
 Q I
"RTN","ORMFN",80,0)
 ;
"RTN","ORMFN",81,0)
FH ; -- Dietetics
"RTN","ORMFN",82,0)
 S X=$P(ZPKG,"|",2),ORFLD(111.1)=$S(X="":"@",1:X)
"RTN","ORMFN",83,0)
 S X=$P(ZPKG,"|",3),ORFLD(111.2)=$S(X="":"@",1:X)
"RTN","ORMFN",84,0)
 S X=$P(ZPKG,"|",5),ORFLD(111.3)=$S(X="":"@",1:X)
"RTN","ORMFN",85,0)
 F NUM=111.1,111.2,111.3 D VAL^DIE(101.43,ORFIEN,NUM,"F",ORFLD(NUM),.ORY,"ORFDA")
"RTN","ORMFN",86,0)
 K ^ORD(101.43,ORDIFN,8) S X=$P(ZPKG,"|",4)
"RTN","ORMFN",87,0)
 I $L(X) S ^ORD(101.43,ORDIFN,8,0)="^^1^1^"_DT_U,^(1,0)=X
"RTN","ORMFN",88,0)
 Q
"RTN","ORMFN",89,0)
 ;
"RTN","ORMFN",90,0)
LR ; -- Laboratory
"RTN","ORMFN",91,0)
 S X=$P(ZPKG,"|",2),ORFLD(60.1)=$S(X="":"@",1:X)
"RTN","ORMFN",92,0)
 S X=$P(ZPKG,"|",3),ORFLD(60.2)=$S(X="":"@",1:X)
"RTN","ORMFN",93,0)
 ;S X=$P(ZPKG,"|",4),ORFLD(60.3)=$S(X="":"@",1:X)
"RTN","ORMFN",94,0)
 S X=$P(ZPKG,"|",5),ORFLD(60.6)=$S(X="":"@",1:X)
"RTN","ORMFN",95,0)
 S X=$P(ZPKG,"|",6),ORFLD(60.4)=$S(X="":"@",1:X)
"RTN","ORMFN",96,0)
 S X=$P(ZPKG,"|",7),ORFLD(60.5)=$S(X="":"@",1:X)
"RTN","ORMFN",97,0)
 S X=$P(ZPKG,"|",8),ORFLD(6)=$S(X="":"@",1:X)
"RTN","ORMFN",98,0)
 S X=$P(ZPKG,"|",9),ORFLD(60.7)=$S(X="":"@",1:X)
"RTN","ORMFN",99,0)
 F NUM=6,60.1,60.2,60.4,60.5,60.6,60.7 D VAL^DIE(101.43,ORFIEN,NUM,"F",ORFLD(NUM),.ORY,"ORFDA")
"RTN","ORMFN",100,0)
 Q
"RTN","ORMFN",101,0)
 ;
"RTN","ORMFN",102,0)
PS ; -- Pharmacy
"RTN","ORMFN",103,0)
 N ROUTE
"RTN","ORMFN",104,0)
 S X=$P(ZPKG,"|",2)
"RTN","ORMFN",105,0)
 ;S ORFDA(101.43,ORFIEN,50.1)=$S(X'["I":0,$L($P($P(ORDITEM,U,5),"~",3)):2,1:1)
"RTN","ORMFN",106,0)
 S ORFDA(101.43,ORFIEN,50.1)=$S(X["V":2,X["I":1,1:0) ;inpt or iv med
"RTN","ORMFN",107,0)
 S ORFDA(101.43,ORFIEN,50.2)=(X["O") ;outpt med
"RTN","ORMFN",108,0)
 S ORFDA(101.43,ORFIEN,50.3)=(X["B") ;fluid base/soln
"RTN","ORMFN",109,0)
 S ORFDA(101.43,ORFIEN,50.4)=(X["A") ;fluid additive
"RTN","ORMFN",110,0)
 S ORFDA(101.43,ORFIEN,50.5)=(X["S") ;supply item
"RTN","ORMFN",111,0)
 S ORFDA(101.43,ORFIEN,50.7)=(X["N") ;non-VA med
"RTN","ORMFN",112,0)
 S X=$P(ZPKG,"|",3),ORFDA(101.43,ORFIEN,50.6)=$S(X:1,1:0)
"RTN","ORMFN",113,0)
 ;Check for default med route
"RTN","ORMFN",114,0)
 ;S ROUTE=$$MEDROUTE
"RTN","ORMFN",115,0)
 ;I ROUTE>0 S ORFDA(101.43,ORFIEN,50.8)=ROUTE
"RTN","ORMFN",116,0)
 Q
"RTN","ORMFN",117,0)
 ;
"RTN","ORMFN",118,0)
MEDROUTE() ;
"RTN","ORMFN",119,0)
 N CNT,ROUTE
"RTN","ORMFN",120,0)
 S CNT=0,ROUTE=0
"RTN","ORMFN",121,0)
 F  S CNT=$O(@ORMSG@(CNT)) Q:CNT'>0  D
"RTN","ORMFN",122,0)
 .I $P($G(@ORMSG@(CNT)),"|")'="ZPB" Q
"RTN","ORMFN",123,0)
 .S ROUTE=+$P($G(@ORMSG@(CNT)),"|",4)
"RTN","ORMFN",124,0)
 Q ROUTE
"RTN","ORMFN",125,0)
 ;
"RTN","ORMFN",126,0)
RA ; -- Radiology/Nuc Medicine
"RTN","ORMFN",127,0)
 S X=$P(ZPKG,"|",4),ORFLD(6)=$S(X="":"@",1:X)
"RTN","ORMFN",128,0)
 S X=$P(ZPKG,"|",5),ORFLD(71.1)=$S(X="":"@",1:X)
"RTN","ORMFN",129,0)
 S X=$P(ZPKG,"|",7),ORFLD(71.2)=$S(X="":"@",1:X)
"RTN","ORMFN",130,0)
 S X=$P(ZPKG,"|",2),ORFLD(71.3)=$S(X="":"@",1:X)
"RTN","ORMFN",131,0)
 S ORFLD(71.4)=$S($P(ZPKG,"|",6)="Y":1,1:0)
"RTN","ORMFN",132,0)
 S ORFLD(7)=$S($P(ZPKG,"|",3)="Y":2,1:1)
"RTN","ORMFN",133,0)
 F NUM=6,7,71.1,71.2,71.3,71.4 D VAL^DIE(101.43,ORFIEN,NUM,"F",ORFLD(NUM),.ORY,"ORFDA")
"RTN","ORMFN",134,0)
 Q
"RTN","ORMFN",135,0)
 ;
"RTN","ORMFN",136,0)
CS ; -- Consults/Requests
"RTN","ORMFN",137,0)
 S X=$P(ZPKG,"|",2),ORFLD(123.1)=$S(X="":"@",1:X)
"RTN","ORMFN",138,0)
 D VAL^DIE(101.43,ORFIEN,123.1,"F",ORFLD(123.1),.ORY,"ORFDA")
"RTN","ORMFN",139,0)
 Q
"RTN","ORMGMRC")
0^77^B44058430
"RTN","ORMGMRC",1,0)
ORMGMRC ; SLC/MKB - Process Consult ORM msgs ;12/13/2006
"RTN","ORMGMRC",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**3,26,68,92,153,174,195,255,243**;Dec 17, 1997;Build 242
"RTN","ORMGMRC",3,0)
EN ; -- entry point for GMRC messges
"RTN","ORMGMRC",4,0)
 I '$L($T(@ORDCNTRL)) Q  ;S ORERR="Invalid order control code" Q
"RTN","ORMGMRC",5,0)
 I ORDCNTRL'="SN",ORDCNTRL'="ZP",'ORIFN!('$D(^OR(100,+ORIFN,0))) S ORERR="Invalid OE/RR order number" Q
"RTN","ORMGMRC",6,0)
 S:ORDCNTRL="OC"&(ORTYPE="ORR") ORDCNTRL="UA" ;new code
"RTN","ORMGMRC",7,0)
 N ORSTS,OREASON1,NTE S ORSTS=$$STATUS(ORDSTS)
"RTN","ORMGMRC",8,0)
 S:'ORLOG ORLOG=$$NOW^XLFDT S:'ORDUZ ORDUZ=DUZ S:$G(DGPMT) ORDUZ=""
"RTN","ORMGMRC",9,0)
 S OREASON=$P(OREASON,U,5),NTE=$O(@ORMSG@(+ORC)),OREASON1=""
"RTN","ORMGMRC",10,0)
 I NTE,$E(@ORMSG@(NTE),1,3)="NTE" S OREASON1=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMGMRC",11,0)
 D @ORDCNTRL
"RTN","ORMGMRC",12,0)
 Q
"RTN","ORMGMRC",13,0)
 ;
"RTN","ORMGMRC",14,0)
ZP ; -- Purged
"RTN","ORMGMRC",15,0)
 Q:'ORIFN  Q:'$D(^OR(100,+ORIFN,0))
"RTN","ORMGMRC",16,0)
 K ^OR(100,+ORIFN,4) I "^3^5^6^8^"[(U_$P($G(^(3)),U,3)_U) D STATUS^ORCSAVE2(+ORIFN,14) ; Remove pkg reference, sts=lapsed if still active
"RTN","ORMGMRC",17,0)
 Q
"RTN","ORMGMRC",18,0)
 ;
"RTN","ORMGMRC",19,0)
ZR ; -- Purged as requested [ack]
"RTN","ORMGMRC",20,0)
 D DELETE^ORCSAVE2(+ORIFN)
"RTN","ORMGMRC",21,0)
 Q
"RTN","ORMGMRC",22,0)
 ;
"RTN","ORMGMRC",23,0)
ZU ; -- Unable to purge [ack]
"RTN","ORMGMRC",24,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT ; update Last Activity
"RTN","ORMGMRC",25,0)
 Q
"RTN","ORMGMRC",26,0)
 ;
"RTN","ORMGMRC",27,0)
OK ; -- Order accepted, GMRC order # assigned [ack]
"RTN","ORMGMRC",28,0)
 S ^OR(100,+ORIFN,4)=PKGIFN S:'$G(ORSTS) ORSTS=5
"RTN","ORMGMRC",29,0)
 D STATUS^ORCSAVE2(+ORIFN,ORSTS) ; 5=pending
"RTN","ORMGMRC",30,0)
 D DATES^ORCSAVE2(+ORIFN,+$E($$NOW^XLFDT,1,12))
"RTN","ORMGMRC",31,0)
 Q
"RTN","ORMGMRC",32,0)
 ;
"RTN","ORMGMRC",33,0)
XX ; -- Change order
"RTN","ORMGMRC",34,0)
 N ORDIALOG,ORDG,ORDA,ORX,ORP,ORSIG S:'$L(ORNATR) ORNATR="S"
"RTN","ORMGMRC",35,0)
 D DLG Q:$D(ORERR)  Q:'$D(ORDIALOG)  S ORIFN=+ORIFN
"RTN","ORMGMRC",36,0)
 S ORDA=$$ACTION^ORCSAVE("XX",ORIFN,ORNP,OREASON1,ORLOG,ORDUZ)
"RTN","ORMGMRC",37,0)
 I ORDA'>0 S ORERR="Cannot create new order action" Q
"RTN","ORMGMRC",38,0)
 ; -Update sts of order to active, last action to dc/edit:
"RTN","ORMGMRC",39,0)
 S ORX=+$P($G(^OR(100,ORIFN,3)),U,7) S:ORX'>0 ORX=+$O(^(8,ORDA),-1)
"RTN","ORMGMRC",40,0)
 I $D(^OR(100,ORIFN,8,ORX,0)),$P(^(0),U,15)="" S $P(^(0),U,15)=12
"RTN","ORMGMRC",41,0)
 S $P(^OR(100,ORIFN,3),U,7)=ORDA D:$G(ORSTS) STATUS^ORCSAVE2(ORIFN,ORSTS)
"RTN","ORMGMRC",42,0)
 D PXRMKILL^ORDD100(ORIFN,ORVP,ORLOG) ; JEH 255
"RTN","ORMGMRC",43,0)
 D RELEASE^ORCSAVE2(ORIFN,ORDA,ORLOG,ORDUZ,ORNATR)
"RTN","ORMGMRC",44,0)
 ; -If unsigned edit, leave XX unsigned & mark ORX as Sig Not Req'd
"RTN","ORMGMRC",45,0)
 S ORSIG=$S($P($G(^OR(100,ORIFN,8,ORX,0)),U,4)'=2:1,1:0)
"RTN","ORMGMRC",46,0)
 D SIGSTS^ORCSAVE2(ORIFN,ORDA):ORSIG,SIGN^ORCSAVE2(ORIFN,,,5,ORX):'ORSIG
"RTN","ORMGMRC",47,0)
 ; -Update responses, get/save new order text:
"RTN","ORMGMRC",48,0)
 K ^OR(100,ORIFN,4.5) D RESPONSE^ORCSAVE,ORDTEXT^ORCSAVE1(ORIFN_";"_ORDA)
"RTN","ORMGMRC",49,0)
 S $P(^OR(100,ORIFN,8,ORDA,0),U,14)=ORDA
"RTN","ORMGMRC",50,0)
 K:OREASON="RESUBMIT" ^OR(100,ORIFN,6) ;clear previous DC data
"RTN","ORMGMRC",51,0)
 D PXRMADD^ORDD100(ORIFN,ORVP,ORLOG) ; JEH 255
"RTN","ORMGMRC",52,0)
 I $G(ORL) S ORP(1)=+ORIFN_";"_ORDA_"^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMGMRC",53,0)
 Q
"RTN","ORMGMRC",54,0)
 ;
"RTN","ORMGMRC",55,0)
SN ; -- New backdoor order: return NA msg w/ORIFN, or DE msg
"RTN","ORMGMRC",56,0)
 N ORDIALOG,ORDG,ORP K ^TMP("ORWORD",$J) S:'$L(ORNATR) ORNATR="W"
"RTN","ORMGMRC",57,0)
 I '$D(^VA(200,ORNP,0)) S ORERR="Missing or invalid ordering provider" Q
"RTN","ORMGMRC",58,0)
 I ORDUZ,'$D(^VA(200,ORDUZ,0)) S ORERR="Invalid entering person" Q
"RTN","ORMGMRC",59,0)
 I '$G(ORL) S ORERR="Missing or invalid patient location" Q
"RTN","ORMGMRC",60,0)
 D DLG Q:$D(ORERR)  Q:'$D(ORDIALOG)
"RTN","ORMGMRC",61,0)
SN1 D EN^ORCSAVE K ^TMP("ORWORD",$J) ; setting status, xrefs
"RTN","ORMGMRC",62,0)
 I '$G(ORIFN) S ORERR="Cannot create new order" Q
"RTN","ORMGMRC",63,0)
 ;Save DG1 and ZCL segments of HL7 message from backdoor orders
"RTN","ORMGMRC",64,0)
 D BDOSTR^ORWDBA3
"RTN","ORMGMRC",65,0)
 D RELEASE^ORCSAVE2(ORIFN,1,ORLOG,ORDUZ,ORNATR),SIGSTS^ORCSAVE2(ORIFN,1)
"RTN","ORMGMRC",66,0)
 S:'ORSTRT ORSTRT=$$NOW^XLFDT D DATES^ORCSAVE2(+ORIFN,ORSTRT)
"RTN","ORMGMRC",67,0)
 D:$G(ORSTS) STATUS^ORCSAVE2(ORIFN,ORSTS)
"RTN","ORMGMRC",68,0)
 I $G(ORL) S ORP(1)=ORIFN_";1^1" D PRINTS^ORWD1(.ORP,+ORL) ; chart copy
"RTN","ORMGMRC",69,0)
 S ^OR(100,ORIFN,4)=PKGIFN
"RTN","ORMGMRC",70,0)
 Q
"RTN","ORMGMRC",71,0)
 ;
"RTN","ORMGMRC",72,0)
DLG ; -- Build ORDIALOG(),ORDG from msg
"RTN","ORMGMRC",73,0)
 N OBR,USID,TYPE,OI,ZSV,J,OBX,WP,I
"RTN","ORMGMRC",74,0)
 S OBR=$$OBR I 'OBR!($E($G(@ORMSG@(OBR)),1,3)'="OBR") S ORERR="Missing OBR segment" Q
"RTN","ORMGMRC",75,0)
 S USID=$P(@ORMSG@(OBR),"|",5),TYPE=$S(USID["99CON":"CONSULT",1:"REQUEST")
"RTN","ORMGMRC",76,0)
 S ORDIALOG=$O(^ORD(101.41,"AB","GMRCOR "_TYPE,0))
"RTN","ORMGMRC",77,0)
 D GETDLG1^ORCD(ORDIALOG)
"RTN","ORMGMRC",78,0)
 S ORDIALOG($$PTR("URGENCY"),1)=ORURG
"RTN","ORMGMRC",79,0)
 S OI=$$ORDITEM^ORM(USID) I 'OI S ORERR="Invalid consult or procedure" Q
"RTN","ORMGMRC",80,0)
 S ORDIALOG($$PTR("ORDERABLE ITEM"),1)=OI
"RTN","ORMGMRC",81,0)
 S ZSV=$O(@ORMSG@(OBR)) I ZSV,$E(@ORMSG@(ZSV),1,3)="ZSV" D
"RTN","ORMGMRC",82,0)
 . N X1,X2 S X1=$P(@ORMSG@(ZSV),"|",2),X2=$P(@ORMSG@(ZSV),"|",3)
"RTN","ORMGMRC",83,0)
 . I TYPE="REQUEST" S ORDIALOG($$PTR("REQUEST SERVICE"),1)=+$P(X1,U,4)
"RTN","ORMGMRC",84,0)
 . I TYPE="CONSULT",$L(X2) S ORDIALOG($$PTR("FREE TEXT OI"),1)=X2
"RTN","ORMGMRC",85,0)
D1 S ORDIALOG($$PTR("CATEGORY"),1)=$G(ORCAT)
"RTN","ORMGMRC",86,0)
 S J=$P(@ORMSG@(OBR),"|",19),ORDIALOG($$PTR("PLACE OF CONSULTATION"),1)=$S(J="OC":"C",1:J)
"RTN","ORMGMRC",87,0)
 S ORDIALOG($$PTR("PROVIDER"),1)=$P(@ORMSG@(OBR),"|",20)
"RTN","ORMGMRC",88,0)
 S OBX=OBR F  S OBX=$O(@ORMSG@(OBX)) Q:OBX'>0  S J=$E(@ORMSG@(OBX),1,3) Q:J="ORC"  Q:J="MSH"  I J="OBX" D
"RTN","ORMGMRC",89,0)
 . N SEG,NAME,VALUE S SEG=@ORMSG@(OBX)
"RTN","ORMGMRC",90,0)
 . S NAME=$$UP^XLFSTR($P($P(SEG,"|",4),U,2)),VALUE=$P(SEG,"|",6)
"RTN","ORMGMRC",91,0)
 . I NAME="PROVISIONAL DIAGNOSIS" D  Q
"RTN","ORMGMRC",92,0)
 .. S:$P(SEG,"|",3)="CE" ORDIALOG($$PTR("CODE"),1)=$P(VALUE,U),VALUE=$P(VALUE,U,2)
"RTN","ORMGMRC",93,0)
 .. S ORDIALOG($$PTR("FREE TEXT"),1)=VALUE
"RTN","ORMGMRC",94,0)
 . S WP=$$PTR("WORD PROCESSING 1"),I=1,^TMP("ORWORD",$J,WP,1,I,0)=VALUE
"RTN","ORMGMRC",95,0)
 . S J=0 F  S J=$O(@ORMSG@(OBX,J)) Q:J'>0  S I=I+1,^TMP("ORWORD",$J,WP,1,I,0)=@ORMSG@(OBX,J)
"RTN","ORMGMRC",96,0)
 S:$G(I) ^TMP("ORWORD",$J,WP,1,0)="^^"_I_U_I_U_DT_U,ORDIALOG(WP,1)="^TMP(""ORWORD"",$J,"_WP_",1)"
"RTN","ORMGMRC",97,0)
 Q
"RTN","ORMGMRC",98,0)
 ;
"RTN","ORMGMRC",99,0)
OBR() ; -- Return subscript of RXE segment
"RTN","ORMGMRC",100,0)
 N X,I,SEG S X="",I=+ORC
"RTN","ORMGMRC",101,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="OBR" S X=I Q
"RTN","ORMGMRC",102,0)
 Q X
"RTN","ORMGMRC",103,0)
 ;
"RTN","ORMGMRC",104,0)
SC ; -- Status changed (i.e. scheduled)
"RTN","ORMGMRC",105,0)
 S:'$G(ORSTS) ORSTS=6 D STATUS^ORCSAVE2(+ORIFN,ORSTS) ; 6=active
"RTN","ORMGMRC",106,0)
 Q
"RTN","ORMGMRC",107,0)
 ;
"RTN","ORMGMRC",108,0)
STATUS(X) ; -- Returns ptr to Order Status file #100.01
"RTN","ORMGMRC",109,0)
 Q $S(X="DC":1,X="CM":2,X="HD":3,X="IP":5,X="SC":6,X="A":9,X="RP":12,X="CA":13,X="ZC":8,1:5)
"RTN","ORMGMRC",110,0)
 ;
"RTN","ORMGMRC",111,0)
RE ; -- Completed, w/results
"RTN","ORMGMRC",112,0)
 N I,SEG,DA,DR,DIE,X,Y
"RTN","ORMGMRC",113,0)
 S:'$G(ORSTS) ORSTS=2 D STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMGMRC",114,0)
 S X="",DA=+ORIFN,DIE="^OR(100,"
"RTN","ORMGMRC",115,0)
 S DR="71////"_+$E($$NOW^XLFDT,1,12) D ^DIE
"RTN","ORMGMRC",116,0)
 S I=+ORC,X="" F  S I=$O(@ORMSG@(I)) Q:I<1  S SEG=$G(@ORMSG@(I)) Q:$E(SEG,1,3)="ORC"  I $E(SEG,1,3)="OBX",$P(SEG,"|",4)["SIG FINDINGS" S X=$P(SEG,"|",6) Q
"RTN","ORMGMRC",117,0)
 S $P(^OR(100,DA,7),U,2)=$S(X="Y":1,1:"")
"RTN","ORMGMRC",118,0)
 S:'$G(ORNP) ORNP=+$P($G(^OR(100,+ORIFN,0)),U,4)
"RTN","ORMGMRC",119,0)
 I $P(ORC,"|",17)["MAINTENANCE" Q  ;group update - no CM ack needed
"RTN","ORMGMRC",120,0)
 I $L($T(ADD^ORRCACK)) D ADD^ORRCACK(+ORIFN,ORNP) ;Ack stub for prov
"RTN","ORMGMRC",121,0)
 Q
"RTN","ORMGMRC",122,0)
 ;
"RTN","ORMGMRC",123,0)
UA ; -- Unable to Accept [ack]
"RTN","ORMGMRC",124,0)
 S ORDUZ="" I '$L(OREASON1),$L(OREASON) S OREASON1=OREASON
"RTN","ORMGMRC",125,0)
OC ; -- Cancelled/Denied
"RTN","ORMGMRC",126,0)
 S:'$L(ORNATR) ORNATR="X" ;Rejected
"RTN","ORMGMRC",127,0)
 S ^OR(100,+ORIFN,6)=$O(^ORD(100.02,"C",ORNATR,0))_U_ORDUZ_U_ORLOG_U_U_OREASON1
"RTN","ORMGMRC",128,0)
 D STATUS^ORCSAVE2(+ORIFN,13) I ORDCNTRL="OC" D UPDATE("DC") Q
"RTN","ORMGMRC",129,0)
UD ; -- Unable to discontinue [ack]
"RTN","ORMGMRC",130,0)
 N DA S DA=$P(ORIFN,";",2) I DA D
"RTN","ORMGMRC",131,0)
 . S $P(^OR(100,+ORIFN,8,DA,0),U,15)=13 ;request rejected
"RTN","ORMGMRC",132,0)
 . S:$L(OREASON1) ^OR(100,+ORIFN,8,DA,1)=OREASON1
"RTN","ORMGMRC",133,0)
 Q
"RTN","ORMGMRC",134,0)
 ;
"RTN","ORMGMRC",135,0)
OD ; -- Discontinued
"RTN","ORMGMRC",136,0)
 S ^OR(100,+ORIFN,6)=$S($L(ORNATR):$O(^ORD(100.02,"C",ORNATR,0)),1:"")_U_ORDUZ_U_ORLOG_U_U_OREASON1
"RTN","ORMGMRC",137,0)
 D STATUS^ORCSAVE2(+ORIFN,1),UPDATE("DC"):$L(ORNATR)
"RTN","ORMGMRC",138,0)
 Q
"RTN","ORMGMRC",139,0)
 ;
"RTN","ORMGMRC",140,0)
DR ; -- Discontinued [ack]
"RTN","ORMGMRC",141,0)
 D STATUS^ORCSAVE2(+ORIFN,1)
"RTN","ORMGMRC",142,0)
 Q
"RTN","ORMGMRC",143,0)
 ;
"RTN","ORMGMRC",144,0)
UPDATE(ORACT) ; -- continue processing
"RTN","ORMGMRC",145,0)
 N ORX,ORDA,ORP
"RTN","ORMGMRC",146,0)
 S ORX=$$CREATE^ORX1(ORNATR) D:ORX
"RTN","ORMGMRC",147,0)
 . S ORDA=$$ACTION^ORCSAVE(ORACT,+ORIFN,ORNP,OREASON1,ORLOG,ORDUZ)
"RTN","ORMGMRC",148,0)
 . I ORDA'>0 S ORERR="Cannot create new order action" Q
"RTN","ORMGMRC",149,0)
 . D RELEASE^ORCSAVE2(+ORIFN,ORDA,ORLOG,ORDUZ,ORNATR)
"RTN","ORMGMRC",150,0)
 . D SIGSTS^ORCSAVE2(+ORIFN,ORDA)
"RTN","ORMGMRC",151,0)
 . I $G(ORL) S ORP(1)=+ORIFN_";"_ORDA_"^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMGMRC",152,0)
 . S $P(^OR(100,+ORIFN,3),U,7)=ORDA
"RTN","ORMGMRC",153,0)
 I 'ORX,ORACT="DC",'$$ACTV^ORX1(ORNATR) S $P(^OR(100,+ORIFN,3),U,7)=0
"RTN","ORMGMRC",154,0)
 D:$G(ORACT)="DC" CANCEL^ORCSEND(+ORIFN)
"RTN","ORMGMRC",155,0)
 Q
"RTN","ORMGMRC",156,0)
 ;
"RTN","ORMGMRC",157,0)
PTR(X) ; -- Returns ptr to prompt in Order Dialog file #101.41
"RTN","ORMGMRC",158,0)
 Q $O(^ORD(101.41,"AB",$E("OR GTX "_X,1,63),0))
"RTN","ORMLR")
0^75^B55346176
"RTN","ORMLR",1,0)
ORMLR ; SLC/MKB - Process Lab ORM msgs ;11:59 AM  26 Jul 2000
"RTN","ORMLR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**3,92,153,174,195,243**;Dec 17, 1997;Build 242
"RTN","ORMLR",3,0)
EN ; -- entry point for LR messages
"RTN","ORMLR",4,0)
 I '$L($T(@ORDCNTRL)) Q  ;S ORERR="Invalid order control code" Q
"RTN","ORMLR",5,0)
 I ORDCNTRL'="SN",ORDCNTRL'="ZC",ORDCNTRL'="ZP" D  Q:$L($G(ORERR))
"RTN","ORMLR",6,0)
 . I 'ORIFN!('$D(^OR(100,+ORIFN,0))) S ORERR="Invalid OE/RR order number" Q
"RTN","ORMLR",7,0)
 . S ORDUZ=DUZ,ORLOG=+$E($$NOW^XLFDT,1,12)
"RTN","ORMLR",8,0)
 S OREASON=$$REASON I 'ORNATR,OREASON S ORNATR=+$P($G(^ORD(100.03,+OREASON,0)),U,7)
"RTN","ORMLR",9,0)
 D @ORDCNTRL
"RTN","ORMLR",10,0)
 Q
"RTN","ORMLR",11,0)
 ;
"RTN","ORMLR",12,0)
STATUS(X) ; -- Returns Order Status for HL7 code X
"RTN","ORMLR",13,0)
 N Y S Y=$S(X="DC":1,X="CM":2,X="IP":5,X="SC":6,X="ZS":9,X="CA":13,1:"")
"RTN","ORMLR",14,0)
 Q Y
"RTN","ORMLR",15,0)
 ;
"RTN","ORMLR",16,0)
OK ; -- Order accepted, LR order # assigned [ack]
"RTN","ORMLR",17,0)
 S ^OR(100,+ORIFN,4)=PKGIFN ; LR identifier
"RTN","ORMLR",18,0)
 D STATUS^ORCSAVE2(+ORIFN,5) ; pending
"RTN","ORMLR",19,0)
 Q
"RTN","ORMLR",20,0)
 ;
"RTN","ORMLR",21,0)
ZC ; -- Convert existing 2.5 orders to 3.0 format
"RTN","ORMLR",22,0)
 S ORNATR="" I 'ORIFN!('$D(^OR(100,+ORIFN,0))) D  Q  ;create
"RTN","ORMLR",23,0)
 . K ORIFN D SN Q:'$G(ORIFN)  S ORDCNTRL="SN"
"RTN","ORMLR",24,0)
 . I ORSTOP,ORSTOP<$$NOW^XLFDT S $P(^OR(100,+ORIFN,3),U)=ORSTOP
"RTN","ORMLR",25,0)
 N ORDIALOG,I,X,OBR,NTE S ORIFN=+ORIFN
"RTN","ORMLR",26,0)
 S I=+ORC F  S I=$O(@ORMSG@(I)) Q:'I  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  Q:SEG="MSH"  I SEG="OBR" S OBR=I Q
"RTN","ORMLR",27,0)
 I '$G(OBR) S ORERR="Missing OBR segment" Q
"RTN","ORMLR",28,0)
 S ORDIALOG=+$O(^ORD(101.41,"AB","LR OTHER LAB TESTS",0))
"RTN","ORMLR",29,0)
 D GETDLG1^ORCD(ORDIALOG)
"RTN","ORMLR",30,0)
 S X=$$FIND^ORM(OBR,5),X=$$ORDITEM^ORM(X) I 'X S ORERR="Invalid test" Q
"RTN","ORMLR",31,0)
 S ORDIALOG($$PTR("ORDERABLE ITEM"),1)=X,X=$$FIND^ORM(OBR,16)
"RTN","ORMLR",32,0)
 S ORDIALOG($$PTR("COLLECTION SAMPLE"),1)=$P(X,";",4)
"RTN","ORMLR",33,0)
 S ORDIALOG($$PTR("SPECIMEN"),1)=$S($L($P(X,";")):+$O(^LAB(61,"C",$P(X,";"),0)),1:+$P(X,U,4))
"RTN","ORMLR",34,0)
 S X=$$FIND^ORM(OBR,28),ORDIALOG($$PTR("LAB URGENCY"),1)=+$P($P(X,U,6),";",2)
"RTN","ORMLR",35,0)
 S X=$$FIND^ORM(OBR,12),ORDIALOG($$PTR("COLLECTION TYPE"),1)=$S(X="L":"LC",X="O":"WC",X=2:"I",1:"SP")
"RTN","ORMLR",36,0)
ZC1 S NTE=$O(@ORMSG@(OBR)) I NTE,$E(@ORMSG@(NTE),1,3)="NTE" D
"RTN","ORMLR",37,0)
 . N LCNT,WP S WP=$$PTR("WORD PROCESSING 1") K ^TMP("ORWORD",$J)
"RTN","ORMLR",38,0)
 . S LCNT=1,^TMP("ORWORD",$J,WP,1,LCNT,0)=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMLR",39,0)
 . S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S LCNT=LCNT+1,^TMP("ORWORD",$J,WP,1,LCNT,0)=@ORMSG@(NTE,I)
"RTN","ORMLR",40,0)
 . S ^TMP("ORWORD",$J,WP,1,0)="^^"_LCNT_U_LCNT_U_DT_U
"RTN","ORMLR",41,0)
 . S ORDIALOG(WP,1)="^TMP(""ORWORD"","_$J_","_WP_",1)"
"RTN","ORMLR",42,0)
 S ORDIALOG($$PTR("START DATE/TIME"),1)=ORSTRT
"RTN","ORMLR",43,0)
 S ^OR(100,ORIFN,4)=PKGIFN,$P(^(0),U,5)=+ORDIALOG_";ORD(101.41,"
"RTN","ORMLR",44,0)
 D RESPONSE^ORCSAVE ; save ORDIALOG() into ^(4.5)
"RTN","ORMLR",45,0)
 K ^TMP("ORWORD",$J)
"RTN","ORMLR",46,0)
 Q
"RTN","ORMLR",47,0)
 ;
"RTN","ORMLR",48,0)
SN ; -- New backdoor order: return NA msg w/ORIFN, or DE msg
"RTN","ORMLR",49,0)
 N X,ORDIALOG,ORDG,OBR,NTE,CMMT,OI,LCNT,I,ORSTS,LRSUB,ORNEW,ORP
"RTN","ORMLR",50,0)
 I ORDUZ,'$D(^VA(200,+ORDUZ,0)) S ORERR="Invalid entering person" Q
"RTN","ORMLR",51,0)
 ; I '$G(ORL) S ORERR="Missing or invalid patient location" Q
"RTN","ORMLR",52,0)
 ;S LRSUB=$E($P($P(@ORMSG@(+ORC),"|",4),U,2),3,4),ORDG=$$DGRP(LRSUB)
"RTN","ORMLR",53,0)
 S ORDIALOG="LR OTHER LAB TESTS" ; $S(LRSUB="AP",LRSUB="BB")
"RTN","ORMLR",54,0)
 S ORDIALOG=$O(^ORD(101.41,"AB",ORDIALOG,0)) D GETDLG1^ORCD(ORDIALOG)
"RTN","ORMLR",55,0)
 S ORDIALOG($$PTR("START DATE/TIME"),1)=ORSTRT
"RTN","ORMLR",56,0)
 S CMMT=$$PTR("WORD PROCESSING 1") K ^TMP("ORWORD",$J)
"RTN","ORMLR",57,0)
SN1 S OBR=$O(@ORMSG@(+ORC)) I 'OBR!($E($G(@ORMSG@(OBR)),1,3)'="OBR") S ORERR="Missing OBR segment" Q
"RTN","ORMLR",58,0)
 S X=$$FIND^ORM(OBR,5),OI=$$ORDITEM^ORM(X) I 'OI S ORERR="Invalid test" Q
"RTN","ORMLR",59,0)
 S LRSUB=$P(^ORD(101.43,OI,"LR"),U,6),ORDG=$$DGRP(LRSUB)
"RTN","ORMLR",60,0)
 S ORDIALOG($$PTR("ORDERABLE ITEM"),1)=OI
"RTN","ORMLR",61,0)
 I LRSUB="BB" S ORDIALOG($$PTR("QUANTITY"),1)=+ORQT G SN2
"RTN","ORMLR",62,0)
 S X=$$FIND^ORM(OBR,16),ORDIALOG($$PTR("COLLECTION SAMPLE"),1)=$P(X,";",4)
"RTN","ORMLR",63,0)
 S ORDIALOG($$PTR("SPECIMEN"),1)=$S($L($P(X,";")):$O(^LAB(61,"C",$P(X,";"),0)),1:+$P(X,U,4))
"RTN","ORMLR",64,0)
 S X=+$P($P($$FIND^ORM(OBR,28),U,6),";",2),ORDIALOG($$PTR("LAB URGENCY"),1)=$S(X:X,1:9)
"RTN","ORMLR",65,0)
 S X=$$FIND^ORM(OBR,12),ORDIALOG($$PTR("COLLECTION TYPE"),1)=$S(X="L":"LC",X="O":"WC",X=2:"I",1:"SP")
"RTN","ORMLR",66,0)
SN2 S NTE=$O(@ORMSG@(+OBR)) I NTE,$E(@ORMSG@(NTE),1,3)="NTE" D
"RTN","ORMLR",67,0)
 . S LCNT=1,^TMP("ORWORD",$J,CMMT,1,LCNT,0)=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMLR",68,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S LCNT=LCNT+1,^TMP("ORWORD",$J,CMMT,1,LCNT,0)=@ORMSG@(NTE,I)
"RTN","ORMLR",69,0)
 . S ^TMP("ORWORD",$J,CMMT,1,0)="^^"_LCNT_U_LCNT_U_DT_U,ORDIALOG(CMMT,1)="^TMP(""ORWORD"",$J,"_CMMT_",1)"
"RTN","ORMLR",70,0)
SNQ D EN^ORCSAVE K ^TMP("ORWORD",$J)
"RTN","ORMLR",71,0)
 I '$G(ORIFN) S ORERR="Cannot create new order" Q
"RTN","ORMLR",72,0)
 ;Save DG1 and ZCL segments of HL7 message from backdoor orders
"RTN","ORMLR",73,0)
 D BDOSTR^ORWDBA3
"RTN","ORMLR",74,0)
 D RELEASE^ORCSAVE2(ORIFN,1,ORLOG,ORDUZ,ORNATR),SIGSTS^ORCSAVE2(ORIFN,1)
"RTN","ORMLR",75,0)
 D:ORSTOP DATES^ORCSAVE2(ORIFN,,ORSTOP) ;Start date in order itself
"RTN","ORMLR",76,0)
 S ORSTS=$$STATUS(ORDSTS) D:ORSTS STATUS^ORCSAVE2(ORIFN,ORSTS)
"RTN","ORMLR",77,0)
 I ORDCNTRL="SN",$G(ORL) S ORP(1)=ORIFN_";1^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMLR",78,0)
 S ^OR(100,ORIFN,4)=PKGIFN
"RTN","ORMLR",79,0)
 Q
"RTN","ORMLR",80,0)
 ;
"RTN","ORMLR",81,0)
PTR(NAME) ; -- Returns ien of prompt NAME in Order Dialog file #101.41
"RTN","ORMLR",82,0)
 Q $O(^ORD(101.41,"AB",$E("OR GTX "_NAME,1,63),0))
"RTN","ORMLR",83,0)
 ;
"RTN","ORMLR",84,0)
DGRP(DG) ; -- Returns Display Group ptr based on Lab section
"RTN","ORMLR",85,0)
 N Y S:'$L($G(DG)) DG="CH" S Y=$O(^ORD(100.98,"B",DG,0))
"RTN","ORMLR",86,0)
 S:'Y Y=$O(^ORD(100.98,"B","LAB",0))
"RTN","ORMLR",87,0)
 Q Y
"RTN","ORMLR",88,0)
 ;
"RTN","ORMLR",89,0)
XX ; -- Changed: NOT IN USE
"RTN","ORMLR",90,0)
 D XX^ORMLR1
"RTN","ORMLR",91,0)
 Q
"RTN","ORMLR",92,0)
 ;
"RTN","ORMLR",93,0)
XR ; -- Changed [ack]: NOT IN USE
"RTN","ORMLR",94,0)
 N ORIG
"RTN","ORMLR",95,0)
 S ^OR(100,+ORIFN,4)=PKGIFN,ORIG=$P(^(3),U,5)
"RTN","ORMLR",96,0)
 D:ORIG STATUS^ORCSAVE2(ORIG,12)
"RTN","ORMLR",97,0)
 D STATUS^ORCSAVE2(+ORIFN,5) ; pending
"RTN","ORMLR",98,0)
 Q
"RTN","ORMLR",99,0)
 ;
"RTN","ORMLR",100,0)
ZP ; -- Purged
"RTN","ORMLR",101,0)
 Q:'ORIFN  Q:'$D(^OR(100,+ORIFN,0))
"RTN","ORMLR",102,0)
 S $P(^OR(100,+ORIFN,4),";",1,3)=";;" I "^5^6^"[(U_$P($G(^(3)),U,3)_U) D STATUS^ORCSAVE2(+ORIFN,$S($P(^(4),";",5):2,1:14)) ; Remove pkg reference, sts=lapsed if still active
"RTN","ORMLR",103,0)
 Q
"RTN","ORMLR",104,0)
 ;
"RTN","ORMLR",105,0)
ZR ; -- Purged as requested [ack]
"RTN","ORMLR",106,0)
 D DELETE^ORCSAVE2(+ORIFN)
"RTN","ORMLR",107,0)
 Q
"RTN","ORMLR",108,0)
 ;
"RTN","ORMLR",109,0)
ZU ; -- Unable to purge [ack]
"RTN","ORMLR",110,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT ; update Last Activity
"RTN","ORMLR",111,0)
 Q
"RTN","ORMLR",112,0)
 ;
"RTN","ORMLR",113,0)
SC ; -- Status changed (collected)
"RTN","ORMLR",114,0)
 N ORSTS D DATES^ORCSAVE2(+ORIFN,ORSTRT,ORSTOP)
"RTN","ORMLR",115,0)
 S ORSTS=$$STATUS(ORDSTS) D:ORSTS STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMLR",116,0)
 S:$L($P(OREASON,U,2)) ^OR(100,+ORIFN,8,1,1)=$P(OREASON,U,2)
"RTN","ORMLR",117,0)
 Q
"RTN","ORMLR",118,0)
 ;
"RTN","ORMLR",119,0)
RE ; -- Completed, w/results
"RTN","ORMLR",120,0)
 N ORSTS,ORX,I,SEG,DONE,X,Y,ORABN,ORFIND,LRSA,LRSB
"RTN","ORMLR",121,0)
 S ORSTS=$$STATUS(ORDSTS) D:ORSTS STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMLR",122,0)
 S ^OR(100,+ORIFN,4)=PKGIFN,ORX="" D  ;get Results D/T [from OBR]
"RTN","ORMLR",123,0)
 . N OBR S OBR=+$O(@ORMSG@(+ORC)),X=""
"RTN","ORMLR",124,0)
 . I OBR,$E($G(@ORMSG@(OBR)),1,3)="OBR" S X=$P(@ORMSG@(OBR),"|",23)
"RTN","ORMLR",125,0)
 . S X=$S(X:$$FMDATE^ORM(X),1:+$E($$NOW^XLFDT,1,12))
"RTN","ORMLR",126,0)
 . S $P(^OR(100,+ORIFN,7),U)=X,^OR(100,"ARS",ORVP,9999999-X,+ORIFN)=""
"RTN","ORMLR",127,0)
 D RR^LR7OR1(DFN,PKGIFN)
"RTN","ORMLR",128,0)
 S ORABN="",ORFIND=""
"RTN","ORMLR",129,0)
 I $D(^TMP("LRRR",$J)) D
"RTN","ORMLR",130,0)
 . N IDT,DNAM,ORSLT
"RTN","ORMLR",131,0)
 . S IDT=0 F  S IDT=$O(^TMP("LRRR",$J,DFN,"CH",IDT)) Q:'IDT  D
"RTN","ORMLR",132,0)
 .. S DNAM=0 F  S DNAM=$O(^TMP("LRRR",$J,DFN,"CH",IDT,DNAM)) Q:'DNAM  D
"RTN","ORMLR",133,0)
 ... S ORSLT=$G(^TMP("LRRR",$J,DFN,"CH",IDT,DNAM))
"RTN","ORMLR",134,0)
 ... I '$L($P(ORSLT,U,3)) Q
"RTN","ORMLR",135,0)
 ... S ORABN=1,ORFIND=$S($L(ORFIND):(ORFIND_", "),1:"")
"RTN","ORMLR",136,0)
 ... S ORFIND=ORFIND_$P(ORSLT,U,15)_"="_$P(ORSLT,U,2)
"RTN","ORMLR",137,0)
 . Q
"RTN","ORMLR",138,0)
 K ^TMP("LRRR",$J),^TMP("LRX",$J)
"RTN","ORMLR",139,0)
 S $P(^OR(100,+ORIFN,7),U,2,3)=ORABN_U_ORFIND
"RTN","ORMLR",140,0)
 S:'$G(ORNP) ORNP=+$P($G(^OR(100,+ORIFN,0)),U,4)
"RTN","ORMLR",141,0)
 I $L($T(ADD^ORRCACK)) D ADD^ORRCACK(+ORIFN,ORNP) ;Ack stub for prov
"RTN","ORMLR",142,0)
 Q
"RTN","ORMLR",143,0)
 ;
"RTN","ORMLR",144,0)
OC ; -- Cancelled
"RTN","ORMLR",145,0)
 G:ORTYPE="ORR" UA S:ORNATR=+$O(^ORD(100.02,"C","A",0)) ORDUZ=""
"RTN","ORMLR",146,0)
 S ^OR(100,+ORIFN,6)=ORNATR_U_ORDUZ_U_ORLOG_U_$P(OREASON,U)_U_$E($P(OREASON,U,2),1,80)
"RTN","ORMLR",147,0)
 D UPDATE(1,"DC")
"RTN","ORMLR",148,0)
 Q
"RTN","ORMLR",149,0)
 ;
"RTN","ORMLR",150,0)
CR ; -- Cancelled [ack]
"RTN","ORMLR",151,0)
 D STATUS^ORCSAVE2(+ORIFN,1)
"RTN","ORMLR",152,0)
 Q
"RTN","ORMLR",153,0)
 ;
"RTN","ORMLR",154,0)
UA ; -- Unable to accept [ack]
"RTN","ORMLR",155,0)
UX ; -- Unable to change [ack]: NOT IN USE
"RTN","ORMLR",156,0)
 S:'ORNATR ORNATR=$O(^ORD(100.02,"C","X",0)) ;rejected
"RTN","ORMLR",157,0)
 S ^OR(100,+ORIFN,6)=ORNATR_U_U_ORLOG_U_$P(OREASON,U)_U_$E($P(OREASON,U,2),1,80)
"RTN","ORMLR",158,0)
 D STATUS^ORCSAVE2(+ORIFN,13)
"RTN","ORMLR",159,0)
UC ; -- Unable to cancel [ack]
"RTN","ORMLR",160,0)
DE ; -- Data Error [ack]
"RTN","ORMLR",161,0)
 N DA S DA=$P(ORIFN,";",2) Q:'DA
"RTN","ORMLR",162,0)
 S $P(^OR(100,+ORIFN,8,DA,0),U,15)=13 ;request rejected
"RTN","ORMLR",163,0)
 S:$L($P(OREASON,U,2)) ^OR(100,+ORIFN,8,DA,1)=$E($P(OREASON,U,2),1,240)
"RTN","ORMLR",164,0)
 Q
"RTN","ORMLR",165,0)
 ;
"RTN","ORMLR",166,0)
UPDATE(ORSTS,ORACT) ; -- continue processing
"RTN","ORMLR",167,0)
 N DA,ORX,ORCMMT,ORP
"RTN","ORMLR",168,0)
 D DATES^ORCSAVE2(+ORIFN,ORSTRT,ORSTOP)
"RTN","ORMLR",169,0)
 D:$G(ORSTS) STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMLR",170,0)
 S ORCMMT=$E($P(OREASON,U,2),1,240),ORX=$$CREATE^ORX1(ORNATR) D:ORX
"RTN","ORMLR",171,0)
 . S DA=$$ACTION^ORCSAVE(ORACT,+ORIFN,ORNP,ORCMMT,ORLOG,ORDUZ)
"RTN","ORMLR",172,0)
 . I DA'>0 S ORERR="Cannot create new order action" Q
"RTN","ORMLR",173,0)
 . D RELEASE^ORCSAVE2(+ORIFN,DA,ORLOG,ORDUZ,ORNATR)
"RTN","ORMLR",174,0)
 . D SIGSTS^ORCSAVE2(+ORIFN,DA)
"RTN","ORMLR",175,0)
 . I $G(ORL) S ORP(1)=+ORIFN_";"_DA_"^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMLR",176,0)
 . S $P(^OR(100,+ORIFN,3),U,7)=DA
"RTN","ORMLR",177,0)
 I '$$ACTV^ORX1(ORNATR) S $P(^OR(100,+ORIFN,3),U,7)=0
"RTN","ORMLR",178,0)
 D:ORACT="DC" CANCEL^ORCSEND(+ORIFN)
"RTN","ORMLR",179,0)
 Q
"RTN","ORMLR",180,0)
 ;
"RTN","ORMLR",181,0)
REASON() ; -- Get reason from OREASON or NTE segments
"RTN","ORMLR",182,0)
 N NTE,CMMT,X,Y,I,L
"RTN","ORMLR",183,0)
 S NTE=+$O(@ORMSG@(+ORC)),CMMT=$P(OREASON,U,4,5)
"RTN","ORMLR",184,0)
 G:'NTE RQ G:$E(@ORMSG@(NTE),1,3)'="NTE" RQ ; no add'l comments
"RTN","ORMLR",185,0)
 S Y=$P(@ORMSG@(NTE),"|",4),I=0
"RTN","ORMLR",186,0)
 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S X=$G(@ORMSG@(NTE,I)),L=$L(Y)+1+$L(X) S:L'>240 Y=Y_" "_X I L>240 S Y=Y_" "_$E(X,1,239-$L(Y)) Q
"RTN","ORMLR",187,0)
 S $P(CMMT,U,2)=Y
"RTN","ORMLR",188,0)
RQ Q CMMT
"RTN","ORMPS")
0^53^B79586894
"RTN","ORMPS",1,0)
ORMPS ; SLC/MKB - Process Pharmacy ORM msgs ;02/06/2007  10:32
"RTN","ORMPS",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**3,54,62,86,92,94,116,138,152,141,165,149,213,195,243**;Dec 17, 1997;Build 242
"RTN","ORMPS",3,0)
 ;
"RTN","ORMPS",4,0)
EN ; -- entry point
"RTN","ORMPS",5,0)
 I '$L($T(@ORDCNTRL)) Q  ;S ORERR="Invalid order control code" Q
"RTN","ORMPS",6,0)
 I ORDCNTRL'="SN",ORDCNTRL'="ZC",ORDCNTRL'="ZP",'ORIFN!('$D(^OR(100,+ORIFN,0))) S ORERR="Invalid OE/RR order number" Q
"RTN","ORMPS",7,0)
 N ORSTS,RXE,ZRX,ORWHO,ORNOW
"RTN","ORMPS",8,0)
 S ORSTS=$$STATUS(ORDSTS),RXE=$$RXE,ZRX=$$ZRX D QT^ORMPS1 ;QT in RXE
"RTN","ORMPS",9,0)
 S ORNOW=+$E($$NOW^XLFDT,1,12),ORWHO=+$P(ZRX,"|",6) S:'ORWHO ORWHO=DUZ
"RTN","ORMPS",10,0)
 S:ORLOG ORLOG=+$E(ORLOG,1,12) ;no seconds
"RTN","ORMPS",11,0)
 S:'$L(ORNATR) ORNATR=$P(ZRX,"|",3) S:OREASON["^" OREASON=$P(OREASON,U,5)
"RTN","ORMPS",12,0)
 I ORNATR="D",'$L(OREASON) S OREASON="DUPLICATE"
"RTN","ORMPS",13,0)
 D @ORDCNTRL
"RTN","ORMPS",14,0)
 Q
"RTN","ORMPS",15,0)
 ;
"RTN","ORMPS",16,0)
ZV ; -- Verified
"RTN","ORMPS",17,0)
 N ORUSR,ORVER,ORDA,ORES,ORI
"RTN","ORMPS",18,0)
 S ORUSR=+$P(ORC,"|",12),ORVER="N" Q:'ORUSR
"RTN","ORMPS",19,0)
 S ORDA=+$P($G(^OR(100,+ORIFN,3)),U,7),ORES(+ORIFN_";"_ORDA)=""
"RTN","ORMPS",20,0)
 Q:$P($G(^OR(100,+ORIFN,8,ORDA,0)),U,8)  ;already verified
"RTN","ORMPS",21,0)
 D REPLCD^ORCACT1 ;get unverified replaced orders
"RTN","ORMPS",22,0)
 S ORI="" F  S ORI=$O(ORES(ORI)) Q:ORI=""  D
"RTN","ORMPS",23,0)
 . S ORDA=+$P(ORI,";",2)
"RTN","ORMPS",24,0)
 . D VERIFY^ORCSAVE2(+ORI,ORDA,"N",ORUSR,ORLOG)
"RTN","ORMPS",25,0)
 Q
"RTN","ORMPS",26,0)
 ;
"RTN","ORMPS",27,0)
ZP ; -- Purged
"RTN","ORMPS",28,0)
 Q:'ORIFN  Q:'$D(^OR(100,+ORIFN,0))
"RTN","ORMPS",29,0)
 K ^OR(100,+ORIFN,4) I "^3^5^6^15^"[(U_$P($G(^(3)),U,3)_U) D STATUS^ORCSAVE2(+ORIFN,14) ;Remove pkg reference, sts=lapsed if still active
"RTN","ORMPS",30,0)
 Q
"RTN","ORMPS",31,0)
 ;
"RTN","ORMPS",32,0)
ZR ; -- Purged as requested [ack]
"RTN","ORMPS",33,0)
 D DELETE^ORCSAVE2(+ORIFN)
"RTN","ORMPS",34,0)
 Q
"RTN","ORMPS",35,0)
 ;
"RTN","ORMPS",36,0)
ZU ; -- Unable to purge [ack]
"RTN","ORMPS",37,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT ;update Last Activity
"RTN","ORMPS",38,0)
 Q
"RTN","ORMPS",39,0)
 ;
"RTN","ORMPS",40,0)
XR ; -- Changed as requested [ack]
"RTN","ORMPS",41,0)
 N ORIG S ORIG=$P(^OR(100,+ORIFN,3),U,5) I ORIG,$P(^OR(100,ORIG,3),U,3)'=12 D STATUS^ORCSAVE2(ORIG,12)
"RTN","ORMPS",42,0)
OK ; -- Order accepted, PS order # assigned [ack]
"RTN","ORMPS",43,0)
 S ^OR(100,+ORIFN,4)=PKGIFN ;PS identifier
"RTN","ORMPS",44,0)
 D:ORSTS STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMPS",45,0)
 Q
"RTN","ORMPS",46,0)
 ;
"RTN","ORMPS",47,0)
ZC ; -- convert orders
"RTN","ORMPS",48,0)
 N RXO,RXC,ORDIALOG,ORDG,ORPKG,ORP,ORSIG,ORIG,TYPE,EVNT
"RTN","ORMPS",49,0)
 I '$D(^VA(200,ORDUZ,0)) S ORERR="Missing or invalid entering person" Q
"RTN","ORMPS",50,0)
 I '$D(^VA(200,ORNP,0)) S ORERR="Missing or invalid ordering provider" Q
"RTN","ORMPS",51,0)
 I 'RXE S ORERR="Missing or invalid RXE segment" Q
"RTN","ORMPS",52,0)
 S RXO=$$RXO,RXC=$$RXC K ^TMP("ORWORD",$J)
"RTN","ORMPS",53,0)
 D @($S(RXC:"IV",$G(ORCAT)="I":"UDOSE",1:"OUT")_"^ORMPS1")
"RTN","ORMPS",54,0)
ZC1 ; continue
"RTN","ORMPS",55,0)
 Q:$D(ORERR)  I 'ORIFN!('$D(^OR(100,+ORIFN,0))) D  Q  ;create
"RTN","ORMPS",56,0)
 . K ORIFN D SN1 Q:'$G(ORIFN)  S ORDCNTRL="SN"
"RTN","ORMPS",57,0)
 . I ORSTOP,ORSTOP<ORNOW S $P(^OR(100,ORIFN,3),U)=ORSTOP
"RTN","ORMPS",58,0)
 S ORIFN=+ORIFN D RESPONSE^ORCSAVE K ^TMP("ORWORD",$J)
"RTN","ORMPS",59,0)
 S ^OR(100,ORIFN,4)=PKGIFN,$P(^(0),U,5)=+ORDIALOG_";ORD(101.41,"
"RTN","ORMPS",60,0)
 D DATES^ORCSAVE2(ORIFN,ORSTRT,ORSTOP),STATUS^ORCSAVE2(ORIFN,ORSTS):ORSTS
"RTN","ORMPS",61,0)
 Q
"RTN","ORMPS",62,0)
 ;
"RTN","ORMPS",63,0)
SN ; -- New backdoor order, return OE# via NA msg
"RTN","ORMPS",64,0)
 I $$FINISHED^ORMPS2 D RO^ORMPS2 Q  ;change action instead
"RTN","ORMPS",65,0)
 N RXO,RXC,ORDIALOG,ORDG,ORPKG,ORP,ORSIG,ORIG,TYPE,EVNT,ZSC
"RTN","ORMPS",66,0)
 I '$D(^VA(200,ORDUZ,0)) S ORERR="Missing or invalid entering person" Q
"RTN","ORMPS",67,0)
 I '$D(^VA(200,ORNP,0)) S ORERR="Missing or invalid ordering provider" Q
"RTN","ORMPS",68,0)
 ; I '$G(ORL) S ORERR="Missing or invalid patient location" Q
"RTN","ORMPS",69,0)
 I 'RXE S ORERR="Missing or invalid RXE segment" Q
"RTN","ORMPS",70,0)
 S RXO=$$RXO,RXC=$$RXC K ^TMP("ORWORD",$J),ORIFN
"RTN","ORMPS",71,0)
 D @($S(RXC:"IV",$G(ORCAT)="I":"UDOSE",1:"OUT")_"^ORMPS1") Q:$D(ORERR)
"RTN","ORMPS",72,0)
SN1 ; save order
"RTN","ORMPS",73,0)
 D EN^ORCSAVE I '$G(ORIFN) S ORERR="Cannot create new order" G SNQ
"RTN","ORMPS",74,0)
 D BDOSTR^ORWDBA3 ;DG1 & ZCL data
"RTN","ORMPS",75,0)
 S ORIG=+$P(ZRX,"|",2),TYPE=$P(ZRX,"|",4) I ORIG D  ;set fwd/bwd ptrs
"RTN","ORMPS",76,0)
 . S TYPE=$S(TYPE="R":2,1:1) Q:'$D(^OR(100,ORIG,0))
"RTN","ORMPS",77,0)
 . S $P(^OR(100,ORIFN,3),U,5)=ORIG,$P(^(3),U,11)=TYPE
"RTN","ORMPS",78,0)
 . S $P(^OR(100,ORIG,3),U,6)=ORIFN,EVNT=$P(^(0),U,17)
"RTN","ORMPS",79,0)
 . I $L(EVNT),TYPE=1 S $P(^OR(100,ORIFN,0),U,17)=EVNT
"RTN","ORMPS",80,0)
 . I TYPE=2,$G(ORCAT)="I" S ORSTRT=ORLOG D PARENT^ORMPS3 ;ck if complex
"RTN","ORMPS",81,0)
 I $G(ORCAT)="O" S ZSC=$$ZSC^ORMPS3 I ZSC,$P(ZSC,"|",2)'?2.3U S ^OR(100,ORIFN,5)=$TR($P(ZSC,"|",2,9),"|","^") ;1 or 0 instead of [N]SC
"RTN","ORMPS",82,0)
SN2 D DATES^ORCSAVE2(ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS",83,0)
 D:ORSTS STATUS^ORCSAVE2(ORIFN,ORSTS)
"RTN","ORMPS",84,0)
 D RELEASE^ORCSAVE2(ORIFN,1,ORLOG,ORDUZ,ORNATR)
"RTN","ORMPS",85,0)
 ; if unsigned edit, leave ORIFN unsigned & mark ORIG as Sig Not Req'd
"RTN","ORMPS",86,0)
 S ORSIG=1 ;$S('ORIG:1,TYPE'=1:1,$P($G(^OR(100,ORIG,8,1,0)),U,4)'=2:1,1:0)
"RTN","ORMPS",87,0)
 D SIGSTS^ORCSAVE2(ORIFN,1):ORSIG,SIGN^ORCSAVE2(ORIG,,,5,1):'ORSIG
"RTN","ORMPS",88,0)
 I ORDCNTRL="SN" D  ;print
"RTN","ORMPS",89,0)
 . S:ORNATR="" $P(^OR(100,ORIFN,8,1,0),U,12)="" ;CHCS/OP orders
"RTN","ORMPS",90,0)
 . S ORP(1)=ORIFN_";1"_$S(ORNATR="":"^^^^1",$G(ORL):"^1",1:"")
"RTN","ORMPS",91,0)
 . I ORP(1)["^" D PRINTS^ORWD1(.ORP,+$G(ORL))
"RTN","ORMPS",92,0)
 S ^OR(100,ORIFN,4)=PKGIFN
"RTN","ORMPS",93,0)
SNQ K ^TMP("ORWORD",$J)
"RTN","ORMPS",94,0)
 Q
"RTN","ORMPS",95,0)
 ;
"RTN","ORMPS",96,0)
XX ; -- Changed (new order not necessary)
"RTN","ORMPS",97,0)
 Q:$P($G(^OR(100,+ORIFN,3)),U,3)=5  ;pending - update when finished
"RTN","ORMPS",98,0)
 I '$$CHANGED^ORMPS2 D SC Q  ;ck sts/dates only
"RTN","ORMPS",99,0)
RO ; -- Replacement order (finished)
"RTN","ORMPS",100,0)
 S:ORNATR="" ORNATR="S" D RO^ORMPS2
"RTN","ORMPS",101,0)
 Q
"RTN","ORMPS",102,0)
 ;
"RTN","ORMPS",103,0)
SC ; -- Status changed (verified, expired, suspended, renewed, reinstate)
"RTN","ORMPS",104,0)
 N OR0,OR3,ZSC,DONE S OR0=$G(^OR(100,+ORIFN,0)),OR3=$G(^(3))
"RTN","ORMPS",105,0)
 I "^1^13^"[(U_$P(OR3,U,3)_U),ORSTS=7 Q  ;retain DC status
"RTN","ORMPS",106,0)
 I $P(OR3,U,3)=5,ORSTS=6 D  Q:$G(DONE)
"RTN","ORMPS",107,0)
 . I $$CHANGED^ORMPS2 S ORNATR="S" D RO^ORMPS2 S DONE=1 Q
"RTN","ORMPS",108,0)
 . I $P(ZRX,"|",7)="TPN",+$P(OR0,U,11)'=$O(^ORD(100.98,"B","TPN",0)) D
"RTN","ORMPS",109,0)
 .. N DA,DR,DIE,ORDG S ORDG=+$O(^ORD(100.98,"B","TPN",0))
"RTN","ORMPS",110,0)
 .. S DA=+ORIFN,DR="23////"_ORDG,DIE="^OR(100," D ^DIE
"RTN","ORMPS",111,0)
 . I $P(OR3,U,11)=2,$P(OR0,U,12)="I" S ORSTRT=+$P($G(^OR(100,+ORIFN,8,1,0)),U,16) ;use Release Date for inpt renewals
"RTN","ORMPS",112,0)
 I $P(OR0,U,12)="I",$P(ZRX,"|",4)="R",+$P(ZRX,"|",2)=+ORIFN S ORSTRT=$P(OR0,U,8) ;keep orig start when renewed
"RTN","ORMPS",113,0)
 I ORSTS=7,ORSTOP S $P(^OR(100,+ORIFN,6),U,6)=ORSTOP ;save exp date
"RTN","ORMPS",114,0)
 I ORSTS=1 D EXPDT
"RTN","ORMPS",115,0)
 D DATES^ORCSAVE2(+ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS",116,0)
 D:ORSTS STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMPS",117,0)
 I ORSTS=$P(OR3,U,3),ORSTOP'=$P(OR0,U,9) D SETALL^ORDD100(+ORIFN) ;AC xrf
"RTN","ORMPS",118,0)
 S ^OR(100,+ORIFN,4)=PKGIFN
"RTN","ORMPS",119,0)
 I "^1^13^"[(U_$P(OR3,U,3)_U),"^3^5^6^15^"[(U_ORSTS_U) D  ;reinstated
"RTN","ORMPS",120,0)
 . I $P($G(^OR(100,+ORIFN,8,+$P(OR3,U,7),0)),U,2)="DC" S ^(2)=ORNOW_U_ORWHO ; When^Who reinstated order
"RTN","ORMPS",121,0)
 . S I="?" F  S I=$O(^OR(100,+ORIFN,8,I),-1) Q:'+I  I $P(^(I,0),U,15)="" S $P(^OR(100,+ORIFN,3),U,7)=I Q  ;138 Finds current action
"RTN","ORMPS",122,0)
 . K ^OR(100,+ORIFN,6) D SETALL^ORDD100(+ORIFN)
"RTN","ORMPS",123,0)
 D UPD^ORMPS3 ;update some responses
"RTN","ORMPS",124,0)
 Q
"RTN","ORMPS",125,0)
 ;
"RTN","ORMPS",126,0)
STATUS(X) ; -- HL7 order status
"RTN","ORMPS",127,0)
 N Y S Y=$S(X="IP":5,X="CM":6,X="DC":1,X="ZE":7,X="HD":3,X="ZX":11,X="RP":12,X="ZZ":15,X="ZS":6,X="ZU":6,1:"")
"RTN","ORMPS",128,0)
 Q Y
"RTN","ORMPS",129,0)
 ;
"RTN","ORMPS",130,0)
DE ; -- Data Errors
"RTN","ORMPS",131,0)
 Q
"RTN","ORMPS",132,0)
 ;
"RTN","ORMPS",133,0)
UA ; -- Unable to accept [ack]
"RTN","ORMPS",134,0)
UX ; -- Unable to change [ack]
"RTN","ORMPS",135,0)
 S:'$L(ORNATR) ORNATR="X" ;Rejected
"RTN","ORMPS",136,0)
 S ^OR(100,+ORIFN,6)=$O(^ORD(100.02,"C",ORNATR,0))_U_U_ORNOW_U_U_OREASON
"RTN","ORMPS",137,0)
 I $P($G(^OR(100,+ORIFN,3)),U,11)=2 N ORIG S ORIG=$P(^(3),U,5) S:ORIG $P(^OR(100,ORIG,3),U,6)="" ;remove fwd ptr if pending renewal
"RTN","ORMPS",138,0)
 D STATUS^ORCSAVE2(+ORIFN,13)
"RTN","ORMPS",139,0)
UC ; -- Unable to cancel [ack]
"RTN","ORMPS",140,0)
UD ; -- Unable to discontinue [ack]
"RTN","ORMPS",141,0)
UH ; -- Unable to hold [ack]
"RTN","ORMPS",142,0)
UR ; -- Unable to release hold [ack]
"RTN","ORMPS",143,0)
 N ORDA S ORDA=+$P(ORIFN,";",2) I ORDA D
"RTN","ORMPS",144,0)
 . S $P(^OR(100,+ORIFN,8,ORDA,0),U,15)=13 ;request rejected
"RTN","ORMPS",145,0)
 . S:$L(OREASON) ^OR(100,+ORIFN,8,ORDA,1)=OREASON
"RTN","ORMPS",146,0)
 Q
"RTN","ORMPS",147,0)
 ;
"RTN","ORMPS",148,0)
OC ; -- Cancelled (before pharmacist's verification)
"RTN","ORMPS",149,0)
 G:ORTYPE="ORR" UA S:ORNATR="A" ORWHO=""
"RTN","ORMPS",150,0)
 S:'ORSTS ORSTS=13 S:ORSTS=12 ORNATR="S"
"RTN","ORMPS",151,0)
 S $P(^OR(100,+ORIFN,6),U,1,5)=$S($L(ORNATR):$O(^ORD(100.02,"C",ORNATR,0)),1:"")_U_ORWHO_U_ORNOW_U_U_OREASON
"RTN","ORMPS",152,0)
 I $P($G(^OR(100,+ORIFN,3)),U,11)=2 N ORIG S ORIG=$P(^(3),U,5) S:ORIG $P(^OR(100,ORIG,3),U,6)="" ;remove fwd ptr when pending renewal cancelled
"RTN","ORMPS",153,0)
 S ^OR(100,+ORIFN,4)=PKGIFN S:ORSTOP>ORNOW ORSTOP=ORNOW
"RTN","ORMPS",154,0)
 D EXPDT,UPDATE(ORSTS,"DC")
"RTN","ORMPS",155,0)
 Q
"RTN","ORMPS",156,0)
 ;
"RTN","ORMPS",157,0)
CR ; -- Cancelled [ack]
"RTN","ORMPS",158,0)
 D EXPDT ;save exp date, if past
"RTN","ORMPS",159,0)
 D STATUS^ORCSAVE2(+ORIFN,13) S ^OR(100,+ORIFN,4)=PKGIFN
"RTN","ORMPS",160,0)
 Q
"RTN","ORMPS",161,0)
 ;
"RTN","ORMPS",162,0)
OD ; -- Discontinued (cancelled after pharmacist's verification)
"RTN","ORMPS",163,0)
 S:'ORSTS ORSTS=1 S:ORSTS=12 ORNATR="C"
"RTN","ORMPS",164,0)
 I ORNATR="A" S ORWHO="" I $G(DGPMT)=3,$$MVT^DGPMOBS(DGPMDA) D XTMP^ORMEVNT ;save order#
"RTN","ORMPS",165,0)
 S $P(^OR(100,+ORIFN,6),U,1,5)=$S($L(ORNATR):$O(^ORD(100.02,"C",ORNATR,0)),1:"")_U_ORWHO_U_ORNOW_U_U_OREASON
"RTN","ORMPS",166,0)
 S ^OR(100,+ORIFN,4)=PKGIFN S:ORSTOP>ORNOW ORSTOP=ORNOW
"RTN","ORMPS",167,0)
 D EXPDT,UPDATE(ORSTS,"DC")
"RTN","ORMPS",168,0)
 Q
"RTN","ORMPS",169,0)
 ;
"RTN","ORMPS",170,0)
DR ; -- Discontinued [ack]
"RTN","ORMPS",171,0)
 D EXPDT ;save exp date, if past
"RTN","ORMPS",172,0)
 D STATUS^ORCSAVE2(+ORIFN,1) S ^OR(100,+ORIFN,4)=PKGIFN
"RTN","ORMPS",173,0)
 Q
"RTN","ORMPS",174,0)
 ;
"RTN","ORMPS",175,0)
EXPDT ; -- save exp date when dc'd
"RTN","ORMPS",176,0)
 N STOP S STOP=$P($G(^OR(100,+ORIFN,0)),U,9)
"RTN","ORMPS",177,0)
 I STOP,STOP<ORNOW,'$P($G(^OR(100,+ORIFN,6)),U,6) S $P(^(6),U,6)=STOP
"RTN","ORMPS",178,0)
 Q
"RTN","ORMPS",179,0)
 ;
"RTN","ORMPS",180,0)
OH ; -- Held
"RTN","ORMPS",181,0)
 S:'ORSTS ORSTS=3 D UPDATE(ORSTS,"HD")
"RTN","ORMPS",182,0)
 Q
"RTN","ORMPS",183,0)
 ;
"RTN","ORMPS",184,0)
HR ; -- Held [ack]
"RTN","ORMPS",185,0)
 D STATUS^ORCSAVE2(+ORIFN,3)
"RTN","ORMPS",186,0)
 Q
"RTN","ORMPS",187,0)
 ;
"RTN","ORMPS",188,0)
RL ; -- Released hold
"RTN","ORMPS",189,0)
OE ; -- Released hold
"RTN","ORMPS",190,0)
 N ORDA S ORDA=+$P(^OR(100,+ORIFN,3),U,7)
"RTN","ORMPS",191,0)
 I $P($G(^OR(100,+ORIFN,8,ORDA,0)),U,2)="HD" S $P(^(2),U,1,2)=ORNOW_U_ORWHO
"RTN","ORMPS",192,0)
 S:'$G(ORSTS) ORSTS=6 D UPDATE(ORSTS,"RL")
"RTN","ORMPS",193,0)
 Q
"RTN","ORMPS",194,0)
 ;
"RTN","ORMPS",195,0)
OR ; -- Released / [ack]
"RTN","ORMPS",196,0)
 S:'ORSTS ORSTS=6 D STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMPS",197,0)
 D:ORSTRT!ORSTOP DATES^ORCSAVE2(+ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS",198,0)
 Q
"RTN","ORMPS",199,0)
 ;
"RTN","ORMPS",200,0)
UPDATE(ORSTS,ORACT) ; -- continue
"RTN","ORMPS",201,0)
 N ORX,ORDA,ORP D:$G(ORSTS) STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMPS",202,0)
 D:ORSTRT!ORSTOP DATES^ORCSAVE2(+ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS",203,0)
 S ORX=$$CREATE^ORX1(ORNATR) D:ORX
"RTN","ORMPS",204,0)
 . S ORDA=$$ACTION^ORCSAVE(ORACT,+ORIFN,ORNP,OREASON,ORNOW,ORWHO)
"RTN","ORMPS",205,0)
 . I ORDA'>0 S ORERR="Cannot create new order action" Q
"RTN","ORMPS",206,0)
 . D RELEASE^ORCSAVE2(+ORIFN,ORDA,ORNOW,ORWHO,ORNATR)
"RTN","ORMPS",207,0)
 . D SIGSTS^ORCSAVE2(+ORIFN,ORDA)
"RTN","ORMPS",208,0)
 . I $G(ORL) S ORP(1)=+ORIFN_";"_ORDA_"^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMPS",209,0)
 . S $P(^OR(100,+ORIFN,3),U,7)=ORDA
"RTN","ORMPS",210,0)
 I ORACT="DC",'$$ACTV^ORX1(ORNATR) S $P(^OR(100,+ORIFN,3),U,7)=0
"RTN","ORMPS",211,0)
 D:$G(ORACT)="DC" CANCEL^ORCSEND(+ORIFN)
"RTN","ORMPS",212,0)
 Q
"RTN","ORMPS",213,0)
 ;
"RTN","ORMPS",214,0)
RXO() ; -- RXO segment
"RTN","ORMPS",215,0)
 N I,X S X="",I=$O(@ORMSG@(+ORC))
"RTN","ORMPS",216,0)
 I I,$E(@ORMSG@(I),1,3)="RXO" S X=I_U_@ORMSG@(I)
"RTN","ORMPS",217,0)
 Q X
"RTN","ORMPS",218,0)
 ;
"RTN","ORMPS",219,0)
RXE() ; -- RXE segment
"RTN","ORMPS",220,0)
 N X,I,SEG S X="",I=+ORC
"RTN","ORMPS",221,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="RXE" S X=I_U_@ORMSG@(I) Q
"RTN","ORMPS",222,0)
 Q X
"RTN","ORMPS",223,0)
 ;
"RTN","ORMPS",224,0)
RXR() ; -- RXR segment
"RTN","ORMPS",225,0)
 N X,I,SEG S X="",I=+RXE
"RTN","ORMPS",226,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="RXR" S X=I_U_@ORMSG@(I) Q
"RTN","ORMPS",227,0)
 Q X
"RTN","ORMPS",228,0)
 ;
"RTN","ORMPS",229,0)
RXC() ; -- [First] RXC segment
"RTN","ORMPS",230,0)
 N X,I,SEG S X="",I=+RXE
"RTN","ORMPS",231,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="RXC" S X=I Q
"RTN","ORMPS",232,0)
 Q X
"RTN","ORMPS",233,0)
 ;
"RTN","ORMPS",234,0)
ZRX() ; -- ZRX segment
"RTN","ORMPS",235,0)
 N X,I,SEG S X="",I=+ORC
"RTN","ORMPS",236,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="ZRX" S X=I_U_@ORMSG@(I) Q
"RTN","ORMPS",237,0)
 Q X
"RTN","ORMPS1")
0^78^B68866316
"RTN","ORMPS1",1,0)
ORMPS1 ;SLC/MKB - Process Pharmacy ORM msgs cont ; 3/27/08 7:38am
"RTN","ORMPS1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**86,92,94,116,134,152,158,149,190,195,215,265,275,243**;Dec 17, 1997;Build 242
"RTN","ORMPS1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ORMPS1",4,0)
UDOSE ; -- new Unit Dose order
"RTN","ORMPS1",5,0)
 N ADMIN,QT,DRUG,INSTR,DOSE,RTE,SCH,OI,URG,WP,DUR,STR,DRGNM,X,PSOI,PSDD,S0,ID,LDOSE,XC,NTE,S0,RXR
"RTN","ORMPS1",6,0)
 S ORDIALOG=+$O(^ORD(101.41,"AB","PSJ OR PAT OE",0))
"RTN","ORMPS1",7,0)
 I $G(ORAPPT)>0 S ORDG=+$O(^ORD(100.98,"B","CLINIC ORDERS",0))
"RTN","ORMPS1",8,0)
 E  S ORDG=+$O(^ORD(100.98,"B","UNIT DOSE MEDICATIONS",0))
"RTN","ORMPS1",9,0)
 S ORPKG=+$$PKG("PSJ")
"RTN","ORMPS1",10,0)
 D GETDLG1^ORCD(ORDIALOG) S QT=$G(ORQT(1))
"RTN","ORMPS1",11,0)
 S DRUG=$$PTR("DISPENSE DRUG"),INSTR=$$PTR("INSTRUCTIONS")
"RTN","ORMPS1",12,0)
 S DOSE=$$PTR("DOSE"),RTE=$$PTR("ROUTE")
"RTN","ORMPS1",13,0)
 S SCH=$$PTR("SCHEDULE"),ADMIN=$$PTR("ADMIN TIMES")
"RTN","ORMPS1",14,0)
 S OI=$$PTR("ORDERABLE ITEM"),URG=$$PTR("URGENCY")
"RTN","ORMPS1",15,0)
 S WP=$$PTR("WORD PROCESSING 1"),DUR=$$PTR("DURATION")
"RTN","ORMPS1",16,0)
 S STR=$$PTR("STRENGTH"),DRGNM=$$PTR("DRUG NAME")
"RTN","ORMPS1",17,0)
UD1 S:RXO X=$P(RXO,"|",2),ORDIALOG(OI,1)=$$ORDITEM^ORM(X),PSOI=$P(X,U,4,5)
"RTN","ORMPS1",18,0)
 I '$G(ORDIALOG(OI,1)) S ORERR="Missing or invalid orderable item" Q
"RTN","ORMPS1",19,0)
 S PSDD=$P($$FIND^ORM(+RXE,3),U,4,5),ORDIALOG(DRUG,1)=+PSDD
"RTN","ORMPS1",20,0)
 S S0=$$FIND^ORM(+RXE,26)_"&"_$P($$FIND^ORM(+RXE,27),U,5)
"RTN","ORMPS1",21,0)
 S ID=$P(QT,U),LDOSE=$P(QT,U,8) I 'ID,S0 D
"RTN","ORMPS1",22,0)
 . N UNT,PTRN S UNT=$P(S0,"&",2),PTRN="1.N1"""_UNT_""""
"RTN","ORMPS1",23,0)
 . I LDOSE?@PTRN S $P(ID,"&",1,2)=+LDOSE_"&"_UNT Q  ;pre-POE orders
"RTN","ORMPS1",24,0)
 . S:$P(PSOI,U,2)'[S0 ORDIALOG(STR,1)=$TR(S0,"&")
"RTN","ORMPS1",25,0)
 I 'ID,'S0 S ORDIALOG(DRGNM,1)=$$UNESC^ORMPS2($P(PSDD,U,2))
"RTN","ORMPS1",26,0)
 S:$L(ID) ORDIALOG(DOSE,1)=$$UNESC^ORMPS2($P(ID,"&",1,4)_"&"_LDOSE_"&"_+PSDD_"&"_S0)
"RTN","ORMPS1",27,0)
 I LDOSE="" D  I LDOSE="" S ORERR="Unable to determine instructions" Q
"RTN","ORMPS1",28,0)
 . I $G(RXC)'>0 D  Q  ;look for units/dose
"RTN","ORMPS1",29,0)
 .. S LDOSE=$P(ID,"&",3),X=$P(ID,"&",4) I 'LDOSE S LDOSE="" Q
"RTN","ORMPS1",30,0)
 .. S:'$L(X) X=$$UNESC^ORMPS2($P($$FIND^ORM(+RXE,7),U,5)) S:$L(X) LDOSE=LDOSE_" "_X
"RTN","ORMPS1",31,0)
 .. S ORDIALOG(DRGNM,1)=$$UNESC^ORMPS2($P(PSDD,U,2)) ;force use of DD
"RTN","ORMPS1",32,0)
 . F  D  Q:LDOSE'=""  S RXC=$O(@ORMSG@(RXC)) Q:'RXC  Q:$E(@ORMSG@(RXC),1,3)'="RXC"
"RTN","ORMPS1",33,0)
 .. S XC=@ORMSG@(RXC) Q:+$P($P(XC,"|",3),U,4)'=+PSOI
"RTN","ORMPS1",34,0)
 .. S LDOSE=$P(XC,"|",4)_$P($P(XC,"|",5),U,5) ;strength_units
"RTN","ORMPS1",35,0)
 S ORDIALOG(INSTR,1)=$$UNESC^ORMPS2(LDOSE)
"RTN","ORMPS1",36,0)
UD2 S NTE=$$NTE^ORMPS3(21) I NTE D
"RTN","ORMPS1",37,0)
 . N CNT,I S CNT=1,^TMP("ORWORD",$J,WP,1,CNT,0)=$$UNESC^ORMPS2($P(@ORMSG@(NTE),"|",4))
"RTN","ORMPS1",38,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S CNT=CNT+1,^TMP("ORWORD",$J,WP,1,CNT,0)=$$UNESC^ORMPS2(@ORMSG@(NTE,I))
"RTN","ORMPS1",39,0)
 . S ^TMP("ORWORD",$J,WP,1,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORMPS1",40,0)
 . S ORDIALOG(WP,1)="^TMP(""ORWORD"",$J,"_WP_",1)"
"RTN","ORMPS1",41,0)
 S RXR=$$RXR^ORMPS I 'RXR S ORERR="Missing or invalid RXR segment" Q
"RTN","ORMPS1",42,0)
 S ORDIALOG(RTE,1)=$P($P(RXR,"|",2),U,4),ORDIALOG(URG,1)=ORURG
"RTN","ORMPS1",43,0)
 S X=$P(QT,U,2)
"RTN","ORMPS1",44,0)
 S ORDIALOG(SCH,1)=$$UNESC^ORMPS2($P(X,"&"))
"RTN","ORMPS1",45,0)
 S:$L($P(X,"&",2)) ORDIALOG(ADMIN,1)=$P(X,"&",2)
"RTN","ORMPS1",46,0)
 S X=$P(QT,U,3) I $L(X) D  ;set only if previous order had duration
"RTN","ORMPS1",47,0)
 . N IFN S IFN=$S($G(ORIFN):+ORIFN,$P(ZRX,"|",2):+$P(ZRX,"|",2),1:0)
"RTN","ORMPS1",48,0)
 . S:$O(^OR(100,+IFN,4.5,"ID","DAYS",0)) ORDIALOG(DUR,1)=$$DURATION^ORMPS3(X)
"RTN","ORMPS1",49,0)
 D DOSETEXT^ORCDPS2 ;reset Instructions text, SIG
"RTN","ORMPS1",50,0)
 D UNESCARR^ORMPS2("ORDIALOG")
"RTN","ORMPS1",51,0)
 Q
"RTN","ORMPS1",52,0)
OUT ; -- new Outpt order
"RTN","ORMPS1",53,0)
 N OI,SIG,INSTR,DOSE,RTE,SCH,DUR,SC,STR,DRUG,PI,CONJ,PSOI,PSDD,S0,X,I,RXR,J,NTE,ZSC,CNT,PC
"RTN","ORMPS1",54,0)
 S ORDIALOG=+$O(^ORD(101.41,"AB","PSO OERR",0))
"RTN","ORMPS1",55,0)
 S ORDG=+$O(^ORD(100.98,"B","OUTPATIENT MEDICATIONS",0))
"RTN","ORMPS1",56,0)
 S ORPKG=+$$PKG("PSO") D GETDLG1^ORCD(ORDIALOG)
"RTN","ORMPS1",57,0)
 S OI=$$PTR("ORDERABLE ITEM"),SIG=$$PTR("SIG")
"RTN","ORMPS1",58,0)
 S INSTR=$$PTR("INSTRUCTIONS"),DOSE=$$PTR("DOSE")
"RTN","ORMPS1",59,0)
 S SCH=$$PTR("SCHEDULE"),DUR=$$PTR("DURATION")
"RTN","ORMPS1",60,0)
 S RTE=$$PTR("ROUTE"),SC=$$PTR("SERVICE CONNECTED")
"RTN","ORMPS1",61,0)
 S STR=$$PTR("STRENGTH"),DRUG=$$PTR("DISPENSE DRUG")
"RTN","ORMPS1",62,0)
 S PI=$$PTR("PATIENT INSTRUCTIONS"),CONJ=$$PTR("AND/THEN")
"RTN","ORMPS1",63,0)
 S PC=$$PTR("WORD PROCESSING 1")
"RTN","ORMPS1",64,0)
 S:RXO X=$P(RXO,"|",2),ORDIALOG(OI,1)=$$ORDITEM^ORM(X),PSOI=$P(X,U,4,5)
"RTN","ORMPS1",65,0)
 I '$G(ORDIALOG(OI,1)) S ORERR="Missing or invalid orderable item" Q
"RTN","ORMPS1",66,0)
 S PSDD=$P($$FIND^ORM(+RXE,3),U,4,5),ORDIALOG(DRUG,1)=+PSDD
"RTN","ORMPS1",67,0)
 S S0=$$FIND^ORM(+RXE,26)_"&"_$P($$FIND^ORM(+RXE,27),U,5)
"RTN","ORMPS1",68,0)
 I S0,$P(PSOI,U,2)'[S0 S ORDIALOG(STR,1)=$TR(S0,"&")
"RTN","ORMPS1",69,0)
 I 'S0,'$G(ORQT(1)) S ORDIALOG($$PTR("DRUG NAME"),1)=$$UNESC^ORMPS2($P(PSDD,U,2))
"RTN","ORMPS1",70,0)
OUT1 S ORDIALOG($$PTR("QUANTITY"),1)=$$FIND^ORM(+RXE,11)
"RTN","ORMPS1",71,0)
 S ORDIALOG($$PTR("REFILLS"),1)=$$FIND^ORM(+RXE,13)
"RTN","ORMPS1",72,0)
 S X=$$FIND^ORM(+RXE,23) S:$E(X)="D" X=+$E(X,2,99)
"RTN","ORMPS1",73,0)
 S:X ORDIALOG($$PTR("DAYS SUPPLY"),1)=X
"RTN","ORMPS1",74,0)
 I ZRX S X=$P(ZRX,"|",5) S:$L(X) ORDIALOG($$PTR("ROUTING"),1)=X
"RTN","ORMPS1",75,0)
 S:ORURG ORDIALOG($$PTR("URGENCY"),1)=ORURG F I=1:1:ORQT D
"RTN","ORMPS1",76,0)
 . S ORDIALOG(INSTR,I)=$$UNESC^ORMPS2($P(ORQT(I),U,8)),X=$P(ORQT(I),U)
"RTN","ORMPS1",77,0)
 . S:$L(X) ORDIALOG(DOSE,I)=$$UNESC^ORMPS2($P(X,"&",1,4)_"&"_$P(ORQT(I),U,8)_"&"_+PSDD_"&"_S0)
"RTN","ORMPS1",78,0)
 . S X=$P(ORQT(I),U,2) S:$L(X) ORDIALOG(SCH,I)=$$UNESC^ORMPS2(X)
"RTN","ORMPS1",79,0)
 . S X=$P(ORQT(I),U,3) S:$L(X) ORDIALOG(DUR,I)=$$DURATION^ORMPS3(X)
"RTN","ORMPS1",80,0)
 . S X=$P(ORQT(I),U,9) S:$L(X) ORDIALOG(CONJ,I)=$S(X="S":"T",1:X)
"RTN","ORMPS1",81,0)
 S RXR=$$RXR^ORMPS I RXR S ORDIALOG(RTE,1)=$P($P(RXR,"|",2),U,4) D
"RTN","ORMPS1",82,0)
 . S I=1,J=+RXR ;look for multiple RXR's
"RTN","ORMPS1",83,0)
 . F  S J=$O(@ORMSG@(J)) Q:J'>0  S RXR=@ORMSG@(J) Q:$E(RXR,1,3)'="RXR"  S I=I+1,ORDIALOG(RTE,I)=$P($P(RXR,"|",2),U,4)
"RTN","ORMPS1",84,0)
OUT2 S NTE=$$NTE^ORMPS3(6) I NTE D  ;Prov Comm ;D:'NTE PCOMM^ORMPS2
"RTN","ORMPS1",85,0)
 . S CNT=1,^TMP("ORWORD",$J,PC,1,CNT,0)=$$UNESC^ORMPS2($P(@ORMSG@(NTE),"|",4))
"RTN","ORMPS1",86,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S CNT=CNT+1,^TMP("ORWORD",$J,PC,1,CNT,0)=$$UNESC^ORMPS2(@ORMSG@(NTE,I))
"RTN","ORMPS1",87,0)
 . S ^TMP("ORWORD",$J,PC,1,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORMPS1",88,0)
 . S ORDIALOG(PC,1)="^TMP(""ORWORD"",$J,"_PC_",1)",ORDIALOG(PC,"FORMAT")="@" ;keep, don't show
"RTN","ORMPS1",89,0)
 . N XCNT,XCOMM,XCOMMENT,XORCOMM,XXCNT,XORIFN
"RTN","ORMPS1",90,0)
 . S XORIFN=$G(ORIFN) S:XORIFN="" XORIFN=$P(RXR,"|",2) Q:XORIFN=""
"RTN","ORMPS1",91,0)
 . S XCOMM=$O(^OR(100,+XORIFN,4.5,"ID","COMMENT",0)) Q:XCOMM=""
"RTN","ORMPS1",92,0)
 . S XCNT=0 F  S XCNT=$O(^TMP("ORWORD",$J,PC,1,XCNT)) Q:XCNT=""  S XCOMMENT=^TMP("ORWORD",$J,PC,1,XCNT,0) D
"RTN","ORMPS1",93,0)
 .. S XORCOMM=$G(^OR(100,+XORIFN,4.5,XCOMM,2,XCNT,0)),XXCNT=0
"RTN","ORMPS1",94,0)
 .. I XORCOMM="" F  S XXCNT=$O(^OR(100,+XORIFN,4.5,XCOMM,2,XXCNT)) Q:XXCNT=""  S XORCOMM=$G(^(XXCNT,0)) Q:XORCOMM'=""
"RTN","ORMPS1",95,0)
 .. I $G(XCOMMENT)=$G(XORCOMM) S ORDIALOG(PC,"FORMAT")="@"
"RTN","ORMPS1",96,0)
 S NTE=$$NTE^ORMPS3(7) I NTE D  ;Pat Instr
"RTN","ORMPS1",97,0)
 . S CNT=1,^TMP("ORWORD",$J,PI,1,CNT,0)=$$UNESC^ORMPS2($P(@ORMSG@(NTE),"|",4))
"RTN","ORMPS1",98,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S CNT=CNT+1,^TMP("ORWORD",$J,PI,1,CNT,0)=$$UNESC^ORMPS2(@ORMSG@(NTE,I))
"RTN","ORMPS1",99,0)
 . S ^TMP("ORWORD",$J,PI,1,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORMPS1",100,0)
 . S ORDIALOG(PI,1)="^TMP(""ORWORD"",$J,"_PI_",1)"
"RTN","ORMPS1",101,0)
 S NTE=$$NTE^ORMPS3(21) I NTE D  ;Sig
"RTN","ORMPS1",102,0)
 . S CNT=1,^TMP("ORWORD",$J,SIG,1,CNT,0)=$$UNESC^ORMPS2($P(@ORMSG@(NTE),"|",4))
"RTN","ORMPS1",103,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S CNT=CNT+1,^TMP("ORWORD",$J,SIG,1,CNT,0)=$$UNESC^ORMPS2(@ORMSG@(NTE,I))
"RTN","ORMPS1",104,0)
 . S ^TMP("ORWORD",$J,SIG,1,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORMPS1",105,0)
 . S ORDIALOG(SIG,1)="^TMP(""ORWORD"",$J,"_SIG_",1)"
"RTN","ORMPS1",106,0)
 . S ORDIALOG(PI,"FORMAT")="@" ;PI already included in Sig
"RTN","ORMPS1",107,0)
OUT3 I '$G(ORQT(1))!('NTE) D DOSETEXT^ORCDPS2 ;reset Instructions text, Sig
"RTN","ORMPS1",108,0)
 S ZSC=$$ZSC^ORMPS3,X=$P(ZSC,"|",2) I X?2.3U S ORDIALOG(SC,1)=$S(X="SC":1,1:0)
"RTN","ORMPS1",109,0)
 Q
"RTN","ORMPS1",110,0)
IV ; -- new IV order
"RTN","ORMPS1",111,0)
 N IVTYP,IVTYPE S IVTYP=$P(ZRX,"|",7) I IVTYP="",$$NUMADDS^ORMPS3'>1 G UDOSE
"RTN","ORMPS1",112,0)
 N SOLN,VOL,ADDS,STR,UNITS,RATE,URG,X,X1,X2,I,J,TYPE,OI,WP,NTE,SCH,DAYS,ROUTE,ADMIN
"RTN","ORMPS1",113,0)
 N RXR
"RTN","ORMPS1",114,0)
 S ORDIALOG=+$O(^ORD(101.41,"AB","PSJI OR PAT FLUID OE",0))
"RTN","ORMPS1",115,0)
 I +$G(ORAPPT)>0 S ORDG=+$O(^ORD(100.98,"B","CLINIC ORDERS",0))
"RTN","ORMPS1",116,0)
 E  S ORDG=+$O(^ORD(100.98,"B",$S($P(ZRX,"|",7)="TPN":"TPN",1:"IV RX"),0))
"RTN","ORMPS1",117,0)
 S ORPKG=+$$PKG("PSJ") D GETDLG1^ORCD(ORDIALOG)
"RTN","ORMPS1",118,0)
 S SOLN=$$PTR("ORDERABLE ITEM"),VOL=$$PTR("VOLUME"),SCH=$$PTR("SCHEDULE")
"RTN","ORMPS1",119,0)
 S RATE=$$PTR("INFUSION RATE") S:ORURG ORDIALOG($$PTR("URGENCY"),1)=ORURG
"RTN","ORMPS1",120,0)
 S WP=$$PTR("WORD PROCESSING 1"),ADDS=$$PTR("ADDITIVE")
"RTN","ORMPS1",121,0)
 S STR=$$PTR("STRENGTH PSIV"),UNITS=$$PTR("UNITS")
"RTN","ORMPS1",122,0)
 S DAYS=$$PTR("DURATION"),IVTYPE=$$PTR("IV TYPE"),ADMIN=$$PTR("ADMIN TIMES")
"RTN","ORMPS1",123,0)
IV1 S NTE=$$NTE^ORMPS3(21) I NTE D
"RTN","ORMPS1",124,0)
 . N CNT,I S CNT=1,^TMP("ORWORD",$J,WP,1,CNT,0)=$$UNESC^ORMPS2($P(@ORMSG@(NTE),"|",4))
"RTN","ORMPS1",125,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S CNT=CNT+1,^TMP("ORWORD",$J,WP,1,CNT,0)=$$UNESC^ORMPS2(@ORMSG@(NTE,I))
"RTN","ORMPS1",126,0)
 . S ^TMP("ORWORD",$J,WP,1,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORMPS1",127,0)
 . S ORDIALOG(WP,1)="^TMP(""ORWORD"",$J,"_WP_",1)"
"RTN","ORMPS1",128,0)
 N ORDAYS S ORDAYS=""
"RTN","ORMPS1",129,0)
 S:$D(RXO) ORDAYS=$P($P(RXO,"|",2),"^",3)
"RTN","ORMPS1",130,0)
 S:$L(ORDAYS) ORDAYS=$$IVLIM^ORMPS2(ORDAYS)
"RTN","ORMPS1",131,0)
 S:$L(ORDAYS) ORDIALOG(DAYS,1)=ORDAYS
"RTN","ORMPS1",132,0)
 S ORDIALOG(IVTYPE,1)=IVTYP
"RTN","ORMPS1",133,0)
 S X=$P($$FIND^ORM(+RXE,25),U,5)
"RTN","ORMPS1",134,0)
 S ORDIALOG(RATE,1)=$$FIND^ORM(+RXE,24)_$S($L(X):" "_X,1:""),(I,J)=0
"RTN","ORMPS1",135,0)
 F  D  S RXC=$O(@ORMSG@(RXC)) Q:'RXC  Q:$E(@ORMSG@(RXC),1,3)'="RXC"
"RTN","ORMPS1",136,0)
 . S X=@ORMSG@(RXC),TYPE=$P(X,"|",2),OI=$$ORDITEM^ORM($P(X,"|",3)) Q:'OI
"RTN","ORMPS1",137,0)
 . S X1=$P(X,"|",4),X2=$P($P(X,"|",5),U,5)
"RTN","ORMPS1",138,0)
 . I $E(TYPE)="B" S J=J+1,ORDIALOG(SOLN,J)=OI,ORDIALOG(VOL,J)=X1 Q
"RTN","ORMPS1",139,0)
 . S I=I+1,ORDIALOG(ADDS,I)=OI,ORDIALOG(STR,I)=X1,ORDIALOG(UNITS,I)=X2
"RTN","ORMPS1",140,0)
IV2 ;
"RTN","ORMPS1",141,0)
 S RXR=$$RXR^ORMPS
"RTN","ORMPS1",142,0)
 S ROUTE=$P(RXR,"|",2)
"RTN","ORMPS1",143,0)
 S ORDIALOG($$PTR("ROUTE"),1)=$P(ROUTE,U,4)
"RTN","ORMPS1",144,0)
 I IVTYP="I" S X=$P($G(ORQT(1)),U,2) D
"RTN","ORMPS1",145,0)
 .S:$L($P(X,"&")) ORDIALOG(SCH,1)=$P(X,"&")
"RTN","ORMPS1",146,0)
 .S:$L($P(X,"&",2)) ORDIALOG(ADMIN,1)=$P(X,"&",2)
"RTN","ORMPS1",147,0)
 D UNESCARR^ORMPS2("ORDIALOG")
"RTN","ORMPS1",148,0)
 Q
"RTN","ORMPS1",149,0)
PKG(NMSP) ; -- Return Package file ptr for NMSP
"RTN","ORMPS1",150,0)
 N I S I=0
"RTN","ORMPS1",151,0)
 F  S I=+$O(^DIC(9.4,"C",NMSP,I)) Q:I<1  Q:'$O(^(I,0))  ;no Addl Prefs
"RTN","ORMPS1",152,0)
 Q I
"RTN","ORMPS1",153,0)
PTR(NAME) ; -- Returns ien of prompt NAME in Order Dialog file #101.41
"RTN","ORMPS1",154,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_NAME,1,63),0))
"RTN","ORMPS1",155,0)
QT ; -- Unpiece the Q/T field from RXE
"RTN","ORMPS1",156,0)
 I 'RXE S ORQT(1)=ORQT,ORQT=1 Q  ; nothing to reset
"RTN","ORMPS1",157,0)
 N X,Y,I,J,P,SEG,DONE K ORQT
"RTN","ORMPS1",158,0)
 S SEG=$G(@ORMSG@(+RXE)),X=$P(SEG,"|",2),(I,J,P,DONE)=0
"RTN","ORMPS1",159,0)
 F  D  Q:DONE
"RTN","ORMPS1",160,0)
 . S P=P+1,Y=$P(X,"~",P) I Y="" S DONE=1 Q
"RTN","ORMPS1",161,0)
 . I P<$L(X,"~") S I=I+1,ORQT(I)=Y Q
"RTN","ORMPS1",162,0)
 . I $L(SEG,"|")>2 S I=I+1,ORQT(I)=Y,DONE=1 Q
"RTN","ORMPS1",163,0)
 . S J=+$O(@ORMSG@(+RXE,J)) I J'>0 S I=I+1,ORQT(I)=Y,DONE=1 Q
"RTN","ORMPS1",164,0)
 . S SEG=$G(@ORMSG@(+RXE,J)),X=$P(SEG,"|"),P=1,I=I+1,ORQT(I)=Y_$P(X,"~")
"RTN","ORMPS1",165,0)
 S ORQT=I Q:'ORQT  ; else reset ORSTRT, ORSTOP, ORURG
"RTN","ORMPS1",166,0)
 S ORSTRT=$P(ORQT(1),U,4),ORSTOP=$P(ORQT(ORQT),U,5),ORURG=$P(ORQT(1),U,6)
"RTN","ORMPS1",167,0)
 S:ORSTRT ORSTRT=$$FMDATE^ORM(ORSTRT) S:ORSTOP ORSTOP=$$FMDATE^ORM(ORSTOP) S:$L(ORURG) ORURG=$$URGENCY^ORM(ORURG)
"RTN","ORMPS1",168,0)
 Q
"RTN","ORMPS2")
0^54^B46355925
"RTN","ORMPS2",1,0)
ORMPS2 ;SLC/MKB - Process Pharmacy ORM msgs cont ;04/01/2008
"RTN","ORMPS2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**94,116,129,134,186,190,195,215,265,243**;Dec 17, 1997;Build 242
"RTN","ORMPS2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ORMPS2",4,0)
 ;
"RTN","ORMPS2",5,0)
FINISHED() ; -- new order [SN^ORMPS] due to finishing?
"RTN","ORMPS2",6,0)
 N Y,ORIG,TYPE,ORIG4 S Y=0
"RTN","ORMPS2",7,0)
 S ORIG=+$P(ZRX,"|",2),TYPE=$P(ZRX,"|",4),ORIG4=$G(^OR(100,ORIG,4))
"RTN","ORMPS2",8,0)
 I ORIG,TYPE="E",ORIG4?1.N1"P"!(ORIG4?1.N1"S") S ORIFN=+ORIG,Y=1
"RTN","ORMPS2",9,0)
 Q Y
"RTN","ORMPS2",10,0)
 ;
"RTN","ORMPS2",11,0)
WPX() ; -- Compare comments in @ORMSG@(NTE) with order ORIFN
"RTN","ORMPS2",12,0)
 ;     Returns 1 if different, or 0 if same
"RTN","ORMPS2",13,0)
 N NTE,SPINST,Y,X S Y=0
"RTN","ORMPS2",14,0)
 S NTE=+$$NTE^ORMPS3(21),SPINST=$S(NTE:$$NTXT^ORMPS3(NTE),1:"")
"RTN","ORMPS2",15,0)
 S X=$$VALTXT^ORMPS3(+ORIFN,"COMMENT")
"RTN","ORMPS2",16,0)
 I $TR(X," ")'=$TR(SPINST," ") S Y=1 ;comp text w/o spaces
"RTN","ORMPS2",17,0)
WQ Q Y
"RTN","ORMPS2",18,0)
 ;
"RTN","ORMPS2",19,0)
IVX() ; -- Compare ORMSG to Inpt order ORIFN if IV, return 0 if 'diff or 'IV
"RTN","ORMPS2",20,0)
 N Y,RXC,DG,OI,PSOI,XC,X,RATE,RXR,ORA,ORB,ORX,I,J,OI0,INST,VOL,STR,UNT
"RTN","ORMPS2",21,0)
 S RXC=$$RXC^ORMPS,Y=0 I RXC'>0 Q Y  ;not IV of any kind
"RTN","ORMPS2",22,0)
 S DG=+$P($G(^OR(100,+ORIFN,0)),U,11),DG=$P($G(^ORD(100.98,DG,0)),U,3)
"RTN","ORMPS2",23,0)
 I DG'="IV RX",DG'="TPN" D  Q Y  ;not fluid
"RTN","ORMPS2",24,0)
 . I $P(ZRX,"|",7)'="" S Y=1 Q
"RTN","ORMPS2",25,0)
 . I $$NUMADDS^ORMPS3>1 S Y=1 Q
"RTN","ORMPS2",26,0)
 . S OI=$$VALUE("ORDERABLE"),PSOI=+$P($G(^ORD(101.43,+OI,0)),U,2)
"RTN","ORMPS2",27,0)
 . S XC=@ORMSG@(RXC) I PSOI'=$P(XC,U,4) S Y=1 Q
"RTN","ORMPS2",28,0)
 . N X1,X2,X3 S X1=$P(XC,"|",4),X2=$P($P(XC,"|",5),U,5)
"RTN","ORMPS2",29,0)
 . S X3=$$VALUE("INSTR") I (X1_X2)'=X3,(X1_" "_X2)'=X3 S Y=1 Q
"RTN","ORMPS2",30,0)
IV1 S RATE=$$FIND^ORM(+RXE,24),UNT=$P($$FIND^ORM(+RXE,25),U,5)
"RTN","ORMPS2",31,0)
 S:$L(UNT) RATE=RATE_" "_UNT S X=$$VALUE("RATE") I RATE'=X D  Q:Y Y
"RTN","ORMPS2",32,0)
 . S:RATE["@" RATE=$P(RATE,"@") S:X["@" X=$P(X,"@") ;rate@labels
"RTN","ORMPS2",33,0)
 . I RATE'=X S Y=1 Q
"RTN","ORMPS2",34,0)
 I $P(ZRX,"|",7)'=$$VALUE("TYPE") S Y=1 Q Y
"RTN","ORMPS2",35,0)
 S RXR=$$RXR^ORMPS
"RTN","ORMPS2",36,0)
 I $P($P(RXR,"|",2),U,4)'=$$VALUE("ROUTE") S Y=1 Q Y
"RTN","ORMPS2",37,0)
 S ORB=+$$PTR("ORDERABLE ITEM"),ORA=+$$PTR("ADDITIVE"),I=+RXC
"RTN","ORMPS2",38,0)
 F  S XC=@ORMSG@(I) Q:$E(XC,1,3)'="RXC"  D  S I=$O(@ORMSG@(I)) Q:I'>0
"RTN","ORMPS2",39,0)
 . S ORX($P(XC,"|",2),+$P(XC,U,4))=$P(XC,"|",4)_U_$P($P(XC,"|",5),U,5)
"RTN","ORMPS2",40,0)
 . ;ORX("A",PSOI)=str^units or ORX("B",PSOI)=volume^units
"RTN","ORMPS2",41,0)
 F I="STRENGTH","UNITS","VOLUME" D  ;ORX(I,inst)=value
"RTN","ORMPS2",42,0)
 . S J=0 F  S J=$O(^OR(100,+ORIFN,4.5,"ID",I,J)) Q:J'>0  D
"RTN","ORMPS2",43,0)
 .. S INST=+$P($G(^OR(100,+ORIFN,4.5,J,0)),U,3)
"RTN","ORMPS2",44,0)
 .. S:INST ORX(I,INST)=$G(^OR(100,+ORIFN,4.5,J,1))
"RTN","ORMPS2",45,0)
 S I=0 F  S I=$O(^OR(100,+ORIFN,4.5,"ID","ORDERABLE",I)) Q:I'>0  D  Q:Y
"RTN","ORMPS2",46,0)
 . S OI0=$G(^OR(100,+ORIFN,4.5,I,0)),OI=+$G(^(1))
"RTN","ORMPS2",47,0)
 . S PSOI=+$P($G(^ORD(101.43,OI,0)),U,2)
"RTN","ORMPS2",48,0)
 . I $P(OI0,U,2)=ORA,$G(ORX("A",PSOI)) D  Q
"RTN","ORMPS2",49,0)
 .. S INST=$P(OI0,U,3),STR=+ORX("A",PSOI),UNT=$P(ORX("A",PSOI),U,2)
"RTN","ORMPS2",50,0)
 .. I STR'=$G(ORX("STRENGTH",INST)) S Y=1 Q
"RTN","ORMPS2",51,0)
 .. I UNT'=$G(ORX("UNITS",INST)) S Y=1 Q
"RTN","ORMPS2",52,0)
 .. K ORX("A",PSOI) ;same
"RTN","ORMPS2",53,0)
 . I $P(OI0,U,2)=ORB,$G(ORX("B",PSOI)) D  Q
"RTN","ORMPS2",54,0)
 .. S INST=$P(OI0,U,3),VOL=+$G(ORX("B",PSOI))
"RTN","ORMPS2",55,0)
 .. I VOL'=$G(ORX("VOLUME",INST)) S Y=1 Q
"RTN","ORMPS2",56,0)
 .. K ORX("B",PSOI) ;same
"RTN","ORMPS2",57,0)
 . S Y=1
"RTN","ORMPS2",58,0)
 I $O(ORX("A",0))!$O(ORX("B",0)) S Y=1 ;leftover items - changed
"RTN","ORMPS2",59,0)
 Q Y
"RTN","ORMPS2",60,0)
 ;
"RTN","ORMPS2",61,0)
CHANGED() ; -- Compare ORMSG to order ORIFN, return 1 if different
"RTN","ORMPS2",62,0)
 N I,X,Y,X1,NTE,SIG,PI,TRXO S Y=0
"RTN","ORMPS2",63,0)
 I $G(ORCAT)="I" D  G CHQ
"RTN","ORMPS2",64,0)
 . I $$WPX S Y=1 Q  ;Special Instructions
"RTN","ORMPS2",65,0)
 . S X=$$VALUE("DAYS") ;duration
"RTN","ORMPS2",66,0)
 . I $G(X)'="" D  I $G(X)'=X1 S Y=1 Q
"RTN","ORMPS2",67,0)
 . .S X=$$HL7IVLMT^ORMBLDP1(X)
"RTN","ORMPS2",68,0)
 . .S TRXO=$$RXO^ORMPS,X1=$P($P($G(TRXO),"|",2),U,3)
"RTN","ORMPS2",69,0)
 . .;S X1=$$DURATION^ORMPS3($P($P(TRXO,"|",2),U,3))
"RTN","ORMPS2",70,0)
 . I $$IVX S Y=1 Q  ;IV fields
"RTN","ORMPS2",71,0)
 ;S X=+$P($P(RXE,"|",3),U,4) I X'=+$$VALUE("DRUG") S Y=1 G CHQ
"RTN","ORMPS2",72,0)
 I +$P(RXE,"|",11)'=+$$VALUE("QTY") S Y=1 G CHQ
"RTN","ORMPS2",73,0)
 I +$P(RXE,"|",13)'=+$$VALUE("REFILLS") S Y=1 G CHQ
"RTN","ORMPS2",74,0)
 ;S X=$P(RXE,"|",23) S:$E(X)="D" X=+$E(X,2,99) I X'=+$$VALUE("SUPPLY") S Y=1 G CHQ
"RTN","ORMPS2",75,0)
 ;I $P(ZRX,"|",5)'=$$VALUE("PICKUP") S Y=1 G CHQ
"RTN","ORMPS2",76,0)
 S NTE=$$NTE^ORMPS3(21),SIG=+$O(^OR(100,+ORIFN,4.5,"ID","SIG",0)) ;verb
"RTN","ORMPS2",77,0)
 I NTE,SIG,$P($P(@ORMSG@(NTE),"|",4)," ")'=$P($G(^OR(100,+ORIFN,4.5,SIG,2,1,0))," ") S Y=1 G CHQ
"RTN","ORMPS2",78,0)
 S NTE=$$NTE^ORMPS3(7),PI=+$O(^OR(100,+ORIFN,4.5,"ID","PI",0))
"RTN","ORMPS2",79,0)
 I (NTE&'PI)!('NTE&PI) Q 1 ;added or deleted
"RTN","ORMPS2",80,0)
 I NTE,PI D  G CHQ ;compare text
"RTN","ORMPS2",81,0)
 . S PI=$$VALTXT^ORMPS3(+ORIFN,PI)_$$VALTXT^ORMPS3(+ORIFN,"COMMENT")
"RTN","ORMPS2",82,0)
 . S NTE=$$NTXT^ORMPS3(NTE)
"RTN","ORMPS2",83,0)
 . I $TR(NTE," ")'=$TR(PI," ") S Y=1 Q  ;comp text w/o spaces
"RTN","ORMPS2",84,0)
CHQ Q Y
"RTN","ORMPS2",85,0)
 ;
"RTN","ORMPS2",86,0)
VALUE(ID) ; -- Return value of ID in ^OR(100,+ORIFN,4.5,"ID")
"RTN","ORMPS2",87,0)
 N I,Y I '$L($G(ID)) Q ""
"RTN","ORMPS2",88,0)
 S I=+$O(^OR(100,+ORIFN,4.5,"ID",ID,0))
"RTN","ORMPS2",89,0)
 S Y=$G(^OR(100,+ORIFN,4.5,I,1))
"RTN","ORMPS2",90,0)
 Q Y
"RTN","ORMPS2",91,0)
 ;
"RTN","ORMPS2",92,0)
PTR(X) ; -- Return ptr to prompt OR GTX X
"RTN","ORMPS2",93,0)
 Q +$O(^ORD(101.41,"AB","OR GTX "_X,0))
"RTN","ORMPS2",94,0)
 ;
"RTN","ORMPS2",95,0)
RO ; -- Replacement order (finished)
"RTN","ORMPS2",96,0)
 N RXO,RXC,ORDIALOG,ORDG,ORPKG,ORDA,ORX,ORSIG,ORP,ZSC,NEWSTS
"RTN","ORMPS2",97,0)
 N ADMIN,IVTYPE
"RTN","ORMPS2",98,0)
 K ^TMP("ORWORD",$J)
"RTN","ORMPS2",99,0)
 I '$D(^VA(200,ORNP,0)) S ORERR="Missing or invalid ordering provider" Q
"RTN","ORMPS2",100,0)
 I 'RXE S ORERR="Missing or invalid RXE segment" Q
"RTN","ORMPS2",101,0)
 S RXO=$$RXO^ORMPS,RXC=$$RXC^ORMPS,ORIFN=+$G(ORIFN)
"RTN","ORMPS2",102,0)
 I ORIFN'>0 S ORERR="Missing or invalid order number" Q
"RTN","ORMPS2",103,0)
 D @($S(RXC:"IV",$G(ORCAT)="I":"UDOSE",1:"OUT")_"^ORMPS1") Q:$D(ORERR)
"RTN","ORMPS2",104,0)
 ;Check keep Admin Time with order if not define in the RXE segment on
"RTN","ORMPS2",105,0)
 ;verify
"RTN","ORMPS2",106,0)
 I RXC,$$VALUE("TYPE")="I" S ORDIALOG($$PTR("ADMIN TIMES"),1)=$$VALUE("ADMIN")
"RTN","ORMPS2",107,0)
 S ORDA=$$ACTION^ORCSAVE("XX",ORIFN,ORNP,"",ORNOW,ORWHO)
"RTN","ORMPS2",108,0)
 I ORDA'>0 S ORERR="Cannot create new order action" Q
"RTN","ORMPS2",109,0)
RO1 ; -Update sts of order to active, last action to dc/edit:
"RTN","ORMPS2",110,0)
 S ORX=ORDA F  S ORX=+$O(^OR(100,ORIFN,8,ORX),-1) Q:ORX'>0  I $D(^(ORX,0)),$P(^(0),U,15)="" Q  ;ORX=last released action
"RTN","ORMPS2",111,0)
 S:ORX $P(^OR(100,ORIFN,8,ORX,0),U,15)=12 ;dc/edit
"RTN","ORMPS2",112,0)
 S $P(^OR(100,ORIFN,3),U,7)=ORDA,NEWSTS=$S('$G(ORSTS):0,ORSTS=$P(^(3),U,3):0,1:1) K ^(6)
"RTN","ORMPS2",113,0)
 D STATUS^ORCSAVE2(ORIFN,ORSTS):NEWSTS,SETALL^ORDD100(ORIFN):'NEWSTS
"RTN","ORMPS2",114,0)
 D DATES^ORCSAVE2(ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS2",115,0)
 D RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,ORWHO,ORNATR)
"RTN","ORMPS2",116,0)
 ; -If unsigned edit, leave XX unsigned & mark ORX as Sig Not Req'd
"RTN","ORMPS2",117,0)
 S ORSIG=$S($P($G(^OR(100,ORIFN,8,ORX,0)),U,4)'=2:1,1:0)
"RTN","ORMPS2",118,0)
 D SIGSTS^ORCSAVE2(ORIFN,ORDA):ORSIG,SIGN^ORCSAVE2(ORIFN,,,5,ORX):'ORSIG
"RTN","ORMPS2",119,0)
RO2 ; -Update responses, get/save new order text:
"RTN","ORMPS2",120,0)
 K ^OR(100,ORIFN,4.5) D RESPONSE^ORCSAVE,ORDTEXT^ORCSAVE1(ORIFN_";"_ORDA)
"RTN","ORMPS2",121,0)
 S $P(^OR(100,ORIFN,0),U,5)=ORDIALOG_";ORD(101.41,",$P(^(0),U,14)=ORPKG
"RTN","ORMPS2",122,0)
 ;I $P(^OR(100,ORIFN,0),U,11)'=ORDG D  ;update DG,xrefs
"RTN","ORMPS2",123,0)
 ;AGP Changes to handle IMO IV orders CPRS 26v43
"RTN","ORMPS2",124,0)
 I $P(^OR(100,ORIFN,0),U,11)'=ORDG,$P(^OR(100,ORIFN,0),U,11)'=$O(^ORD(100.98,"B","CLINIC ORDERS","")) D
"RTN","ORMPS2",125,0)
 . N DA,DR,DIE
"RTN","ORMPS2",126,0)
 . S DA=ORIFN,DR="23////"_ORDG,DIE="^OR(100," D ^DIE
"RTN","ORMPS2",127,0)
 S ^OR(100,ORIFN,4)=PKGIFN,$P(^(8,ORDA,0),U,14)=ORDA
"RTN","ORMPS2",128,0)
 S ORIFN=ORIFN_";"_ORDA,ORDCNTRL="SN" ;to send NA msg back
"RTN","ORMPS2",129,0)
 I $G(ORL) S ORP(1)=ORIFN_"^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMPS2",130,0)
 I $G(ORCAT)="O" S ZSC=$$ZSC^ORMPS3 I ZSC,$P(ZSC,"|",2)'?2.3U S ^OR(100,+ORIFN,5)=$TR($P(ZSC,"|",2,9),"|","^") ;1 or 0 instead of [N]SC in #100
"RTN","ORMPS2",131,0)
 Q
"RTN","ORMPS2",132,0)
IVLIM(IVDUR) ;
"RTN","ORMPS2",133,0)
 I $L(IVDUR) D
"RTN","ORMPS2",134,0)
 . N DURU,DURV S DURU="",DURV=0
"RTN","ORMPS2",135,0)
 . S DURU=$E(IVDUR,1),DURV=$E(IVDUR,2,$L(IVDUR))
"RTN","ORMPS2",136,0)
 . I IVDUR["dose" S DURV=$E(IVDUR,6,$L(IVDUR)),IVDUR="for a total of "_+DURV_$S(+DURV=1:" doses",+DURV>1:" doses",1:" dose") Q
"RTN","ORMPS2",137,0)
 . I (DURU="D")!(DURU="d") S IVDUR="for "_+DURV_$S(+DURV=1:" day",+DURV>1:" days",1:" day")
"RTN","ORMPS2",138,0)
 . I (DURU="H")!(DURU="h") S IVDUR="for "_+DURV_$S(+DURV=1:" hours",+DURV>1:" hours",1:" hour")
"RTN","ORMPS2",139,0)
 . I (DURU="M")!(DURU="m") S IVDUR="with total volume "_+DURV_" ml"
"RTN","ORMPS2",140,0)
 . I (DURU="L")!(DURU="l") S IVDUR="with total volume "_+DURV_" L"
"RTN","ORMPS2",141,0)
 Q IVDUR
"RTN","ORMPS2",142,0)
UNESC(STRING) ;
"RTN","ORMPS2",143,0)
 Q $$UNESC^ORHLESC(STRING)
"RTN","ORMPS2",144,0)
UNESCARR(ARR) ;
"RTN","ORMPS2",145,0)
 N I S I="" F  S I=$O(@ARR@(I)) Q:'$L(I)  D
"RTN","ORMPS2",146,0)
 .N IND S IND=$S(ARR["(":$E(ARR,0,$L(ARR)-1)_","""_I_""")",1:ARR_"("""_I_""")")
"RTN","ORMPS2",147,0)
 .N TYPE S TYPE=$D(@ARR@(I))
"RTN","ORMPS2",148,0)
 .I TYPE=11!(TYPE=10) D UNESCARR(IND)
"RTN","ORMPS2",149,0)
 .I TYPE=1!(TYPE=11) S @ARR@(I)=$$UNESC(@ARR@(I))
"RTN","ORMPS2",150,0)
 Q
"RTN","ORMPS2",151,0)
PCOMM ; -- Get Provider Comments from previous order, when changed
"RTN","ORMPS2",152,0)
 N OLD,I
"RTN","ORMPS2",153,0)
 S OLD=+$G(ORIFN) I OLD<1 S OLD=+$P(ZRX,"|",2) Q:OLD<1
"RTN","ORMPS2",154,0)
 S I=+$O(^OR(100,OLD,4.5,"ID","COMMENT",0)) Q:I<1
"RTN","ORMPS2",155,0)
 Q:'$O(^OR(100,OLD,4.5,I,2,0))  ;none
"RTN","ORMPS2",156,0)
 M ^TMP("ORWORD",$J,PC,1)=^OR(100,OLD,4.5,I,2)
"RTN","ORMPS2",157,0)
 S ORDIALOG(PC,1)="^TMP(""ORWORD"",$J,"_PC_",1)"
"RTN","ORMPS2",158,0)
 S ORDIALOG(PC,"FORMAT")="@" ;text in Sig already
"RTN","ORMPS2",159,0)
 Q
"RTN","ORMPS3")
0^145^B25338633
"RTN","ORMPS3",1,0)
ORMPS3 ;SLC/MKB - Process Pharmacy ORM msgs cont ;05/08/2008  10:32
"RTN","ORMPS3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**213,243**;Dec 17, 1997;Build 242
"RTN","ORMPS3",3,0)
 ;
"RTN","ORMPS3",4,0)
PTR(X) ; -- Return ptr to prompt OR GTX X
"RTN","ORMPS3",5,0)
 Q +$O(^ORD(101.41,"AB","OR GTX "_X,0))
"RTN","ORMPS3",6,0)
 ;
"RTN","ORMPS3",7,0)
PARENT ; -- create parent order for backdoor complex renewals
"RTN","ORMPS3",8,0)
 ;    Expects ORIFN, ORIG, ORDIALOG()
"RTN","ORMPS3",9,0)
 ;Q:'$$PATCH^XPDUTL("PSJ*5.0*110")
"RTN","ORMPS3",10,0)
 N ORIGDAD,ORIFNDAD,HDR S ORIGDAD=$P($G(^OR(100,ORIG,3)),U,9)
"RTN","ORMPS3",11,0)
 Q:ORIGDAD<1  Q:$$DOSES^ORCACT4(ORIGDAD)'>1  ;cont if complex
"RTN","ORMPS3",12,0)
 S ORIFNDAD=$P($G(^OR(100,ORIGDAD,3)),U,6) I ORIFNDAD<1 D  G P1
"RTN","ORMPS3",13,0)
 . N ORIFN D EN^ORCSAVE Q:ORIFN<1
"RTN","ORMPS3",14,0)
 . S $P(^OR(100,ORIFN,3),U,5)=ORIGDAD,$P(^(3),U,8)=1,$P(^(3),U,11)=2
"RTN","ORMPS3",15,0)
 . S $P(^OR(100,ORIGDAD,3),U,6)=ORIFN,ORIFNDAD=ORIFN
"RTN","ORMPS3",16,0)
 . D RELEASE^ORCSAVE2(ORIFN,1,ORLOG,ORDUZ,ORNATR)
"RTN","ORMPS3",17,0)
 . D SIGSTS^ORCSAVE2(ORIFN,1),DATES^ORCSAVE2(ORIFN,ORSTRT)
"RTN","ORMPS3",18,0)
 . I $P(^OR(100,ORIFN,8,1,0),U,4)=2 S $P(^(0),U,4)="" K ^OR(100,"AS",ORVP,9999999-ORLOG,ORIFN,1) ;sign children instead
"RTN","ORMPS3",19,0)
 . ;STATUS updated in SN2^ORMPS from child orders
"RTN","ORMPS3",20,0)
P0 ; -- just add conjunction, new dose if DAD already exists
"RTN","ORMPS3",21,0)
 N INST,DA,PTR,ID,P,I,J,X
"RTN","ORMPS3",22,0)
 S INST=$$DOSES^ORCACT4(ORIFNDAD),DA=$O(^OR(100,ORIFNDAD,4.5,"A"),-1)
"RTN","ORMPS3",23,0)
 S PTR=$$PTR("AND/THEN"),ID="CONJ",DA=DA+1
"RTN","ORMPS3",24,0)
 S ^OR(100,ORIFNDAD,4.5,DA,0)=U_PTR_U_INST_U_ID,^(1)="A"
"RTN","ORMPS3",25,0)
 S ^OR(100,ORIFNDAD,4.5,"ID","CONJ",DA)="",INST=INST+1
"RTN","ORMPS3",26,0)
 F P="INSTRUCTIONS","ROUTE","SCHEDULE","DURATION","DOSE","DISPENSE DRUG" D
"RTN","ORMPS3",27,0)
 . S PTR=$$PTR(P) Q:'$L($G(ORDIALOG(PTR,1)))
"RTN","ORMPS3",28,0)
 . S DA=DA+1,ID=$P($G(^ORD(101.41,PTR,1)),U,3)
"RTN","ORMPS3",29,0)
 . S ^OR(100,ORIFNDAD,4.5,DA,0)=U_PTR_U_INST_U_ID,^(1)=ORDIALOG(PTR,1)
"RTN","ORMPS3",30,0)
 . S ^OR(100,ORIFNDAD,4.5,"ID",ID,DA)=""
"RTN","ORMPS3",31,0)
 S $P(^OR(100,ORIFNDAD,4.5,0),U,3,4)=DA_U_DA
"RTN","ORMPS3",32,0)
 S P=$$PTR("SIG"),DA=+$O(^OR(100,ORIFNDAD,4.5,"ID","SIG",0))
"RTN","ORMPS3",33,0)
 S I=+$O(^OR(100,ORIFNDAD,4.5,DA,2,""),-1),X=$G(^(I,0)) S:$L(X) X=X_" AND",^(0)=X
"RTN","ORMPS3",34,0)
 S J=0 F  S J=$O(^TMP("ORWORD",$J,PTR,1,J)) Q:J<1  S I=I+1,^OR(100,ORIFNDAD,4.5,DA,2,I,0)=^TMP("ORWORD",$J,PTR,1,J,0)
"RTN","ORMPS3",35,0)
 S $P(^OR(100,ORIFNDAD,4.5,DA,2,0),U,3,4)=I_U_I
"RTN","ORMPS3",36,0)
 ; -- rebuild order text w/new SIG
"RTN","ORMPS3",37,0)
 K ^TMP("ORWORD",$J,PTR) M ^TMP("ORWORD",$J,PTR,1)=^OR(100,ORIFNDAD,4.5,DA,2)
"RTN","ORMPS3",38,0)
 K ^OR(100,ORIFNDAD,8,1,.1) D ORDTEXT^ORCSAVE1(ORIFNDAD_";1")
"RTN","ORMPS3",39,0)
P1 ; -- set up links
"RTN","ORMPS3",40,0)
 S $P(^OR(100,ORIFN,3),U,9)=ORIFNDAD
"RTN","ORMPS3",41,0)
 S HDR=$G(^OR(100,ORIFNDAD,2,0)),^(0)="^100.002PA^"_ORIFN_U_($P(HDR,U,4)+1),^(ORIFN,0)=ORIFN
"RTN","ORMPS3",42,0)
 Q
"RTN","ORMPS3",43,0)
 ;
"RTN","ORMPS3",44,0)
NTE(ID) ; -- Return subscript of NTE|ID segment
"RTN","ORMPS3",45,0)
 N I,SEG,Y S Y="",I=+RXE S:'$G(ID) ID=21
"RTN","ORMPS3",46,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=@ORMSG@(I) Q:$E(SEG,1,3)="ORC"  I $P(SEG,"|",1,2)=("NTE|"_ID) S Y=I Q
"RTN","ORMPS3",47,0)
 Q Y
"RTN","ORMPS3",48,0)
 ;
"RTN","ORMPS3",49,0)
NTXT(NTE) ; -- Return string of text in ORMSG(NTE)
"RTN","ORMPS3",50,0)
 N Y,I S NTE=+$G(NTE)
"RTN","ORMPS3",51,0)
 S Y=$P($G(@ORMSG@(NTE)),"|",4),Y=$$UNESC^ORHLESC(Y)
"RTN","ORMPS3",52,0)
 S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I<1  S Y=Y_" "_$$UNESC^ORHLESC(@ORMSG@(NTE,I))
"RTN","ORMPS3",53,0)
 Q Y
"RTN","ORMPS3",54,0)
 ;
"RTN","ORMPS3",55,0)
ZSC() ; -- Return subscript of ZSC segment
"RTN","ORMPS3",56,0)
 N I,SEG,Y S Y="",I=+RXE
"RTN","ORMPS3",57,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="ZSC" S Y=I_U_@ORMSG@(I) Q
"RTN","ORMPS3",58,0)
 Q Y
"RTN","ORMPS3",59,0)
 ;
"RTN","ORMPS3",60,0)
NUMADDS() ; -- count number of additives to determine type
"RTN","ORMPS3",61,0)
 N CNT,I,X S CNT=0,I=+RXE
"RTN","ORMPS3",62,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S X=@ORMSG@(I) Q:$P(X,"|")="ORC"  I $E(X,1,6)="RXC|A|" S CNT=CNT+1
"RTN","ORMPS3",63,0)
 Q CNT
"RTN","ORMPS3",64,0)
 ;
"RTN","ORMPS3",65,0)
DURATION(X) ; -- Returns "# units" from U# format
"RTN","ORMPS3",66,0)
 N Y,Y1,Y2 I X'?.1U1.N Q ""
"RTN","ORMPS3",67,0)
 S Y1=$E(X),Y2=+$E(X,2,$L(X)) I X=+X S Y1="D",Y2=+X
"RTN","ORMPS3",68,0)
 S Y=Y2_" "_$S(Y1="L":"MONTH",Y1="W":"WEEK",Y1="H":"HOUR",Y1="M":"MINUTE",Y1="S":"SECOND",1:"DAY")_$S(Y2>1:"S",1:"")
"RTN","ORMPS3",69,0)
 Q Y
"RTN","ORMPS3",70,0)
 ;
"RTN","ORMPS3",71,0)
UPD ; -- Compare ORMSG to order, update responses [from SC^ORMPS]
"RTN","ORMPS3",72,0)
 ;    Also expects ORIFN,ORNP,ORCAT,OR3,RXE,ZRX,PKGIFN
"RTN","ORMPS3",73,0)
 N X,I,ORDER,ZSC,NTE,PI
"RTN","ORMPS3",74,0)
 S ORDER=+$G(ORIFN),I=+$P(ORIFN,";",2) I I<1 D
"RTN","ORMPS3",75,0)
 . S I=+$P(OR3,U,7) Q:I
"RTN","ORMPS3",76,0)
 . S I=$O(^OR(100,+ORIFN,8,"A"),-1)
"RTN","ORMPS3",77,0)
 S X=+$P($G(^OR(100,+ORIFN,8,I,0)),U,3) S:X'=ORNP $P(^(0),U,3)=ORNP
"RTN","ORMPS3",78,0)
 S X=+$P($P(RXE,"|",3),U,4)
"RTN","ORMPS3",79,0)
 I X,X'=+$$VALUE(ORDER,"DRUG") D RESP^ORCSAVE2(ORDER,"OR GTX DISPENSE DRUG",X)
"RTN","ORMPS3",80,0)
 I $G(ORCAT)="I" D  Q
"RTN","ORMPS3",81,0)
 . S X=$P($P($P(RXE,"|",2),U,2),"&",2)
"RTN","ORMPS3",82,0)
 . I X'=$$VALUE(ORDER,"ADMIN") D RESP^ORCSAVE2(ORDER,"OR GTX ADMIN TIMES",X)
"RTN","ORMPS3",83,0)
 . ;SCHEDULE TYPE
"RTN","ORMPS3",84,0)
 . S X=$P($P(RXE,"|",2),U,7)
"RTN","ORMPS3",85,0)
 . I X'=$$VALUE(ORDER,"SCHTYPE") D RESP^ORCSAVE2(ORDER,"OR GTX SCHEDULE TYPE",X)
"RTN","ORMPS3",86,0)
 . I $S(X="P":1,X="O":1,X="OC":1,1:0) D
"RTN","ORMPS3",87,0)
 . .D RESP^ORCSAVE2(ORDER,"OR GTX ADMIN TIMES","")
"RTN","ORMPS3",88,0)
 I $G(PKGIFN)'["N" D  ;Rx only, not non-VA
"RTN","ORMPS3",89,0)
 . S X=$P(RXE,"|",23) S:$E(X)="D" X=+$E(X,2,99)
"RTN","ORMPS3",90,0)
 . I +X'=+$$VALUE(ORDER,"SUPPLY") D RESP^ORCSAVE2(ORDER,"OR GTX DAYS SUPPLY",X)
"RTN","ORMPS3",91,0)
 . I $P(ZRX,"|",5)'=$$VALUE(ORDER,"PICKUP") D RESP^ORCSAVE2(ORDER,"OR GTX ROUTING",$P(ZRX,"|",5))
"RTN","ORMPS3",92,0)
 . S NTE=$$NTE(7),PI=+$O(^OR(100,ORDER,4.5,"ID","PI",0))
"RTN","ORMPS3",93,0)
 . I NTE,PI,$$NTXT(NTE)'=$$VALTXT(ORDER,PI) D
"RTN","ORMPS3",94,0)
 .. N CNT K ^OR(100,ORDER,4.5,PI,2)
"RTN","ORMPS3",95,0)
 .. S CNT=1,^OR(100,ORDER,4.5,PI,2,1,0)=$$UNESC^ORMPS2($P(@ORMSG@(NTE),"|",4))
"RTN","ORMPS3",96,0)
 .. S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I<1  S CNT=CNT+1,^OR(100,ORDER,4.5,PI,2,CNT,0)=$$UNESC^ORMPS2(@ORMSG@(NTE,I))
"RTN","ORMPS3",97,0)
 .. S ^OR(100,ORDER,4.5,PI,2,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORMPS3",98,0)
 S ZSC=$$ZSC I ZSC,$P(ZSC,"|",2)'?2.3U S ^OR(100,ORDER,5)=$TR($P(ZSC,"|",2,7),"|","^") ;1 or 0 instead of [N]SC
"RTN","ORMPS3",99,0)
 Q
"RTN","ORMPS3",100,0)
 ;
"RTN","ORMPS3",101,0)
VALUE(IFN,ID,INST) ; -- Returns value of prompt by identifier ID
"RTN","ORMPS3",102,0)
 I '$G(IFN)!('$D(^OR(100,+$G(IFN),0)))!($G(ID)="") Q ""
"RTN","ORMPS3",103,0)
 N I,Y S I=0,Y="" S:'$G(INST) INST=1
"RTN","ORMPS3",104,0)
 F  S I=$O(^OR(100,IFN,4.5,"ID",ID,I)) Q:I'>0  I $P($G(^OR(100,IFN,4.5,+I,0)),U,3)=INST S Y=$G(^(1)) Q
"RTN","ORMPS3",105,0)
 Q Y
"RTN","ORMPS3",106,0)
 ;
"RTN","ORMPS3",107,0)
VALTXT(IFN,ID) ; -- Return string of text for prompt ID [assumes single instance]
"RTN","ORMPS3",108,0)
 ;    ID may be identifier name or Response IEN
"RTN","ORMPS3",109,0)
 N Y,DA,I S IFN=+$G(IFN),ID=$G(ID)
"RTN","ORMPS3",110,0)
 S DA=$S($G(ID):+ID,$L(ID):+$O(^OR(100,IFN,4.5,"ID",ID,0)),1:0)
"RTN","ORMPS3",111,0)
 S I=+$O(^OR(100,IFN,4.5,DA,2,0)),Y=$G(^(I,0))
"RTN","ORMPS3",112,0)
 F  S I=$O(^OR(100,IFN,4.5,DA,2,I)) Q:I<1  S Y=Y_" "_$G(^(I,0))
"RTN","ORMPS3",113,0)
 Q Y
"RTN","ORMRA")
0^33^B62066557
"RTN","ORMRA",1,0)
ORMRA ; SLC/MKB/RV - Process Radiology ORM msgs ;2/21/02  15:44 [05/30/06 12:30pm]
"RTN","ORMRA",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**3,53,92,110,136,153,174,195,243**;Dec 17, 1997;Build 242
"RTN","ORMRA",3,0)
 ;DBIA 2968 allows for reading ^DIC(34
"RTN","ORMRA",4,0)
EN ; -- entry point for RA messages
"RTN","ORMRA",5,0)
 I '$L($T(@ORDCNTRL)) Q  ;S ORERR="Invalid order control code" Q
"RTN","ORMRA",6,0)
 I ORDCNTRL'="SN",ORDCNTRL'="ZP",'ORIFN!('$D(^OR(100,+ORIFN,0))) S ORERR="Invalid OE/RR order number" Q
"RTN","ORMRA",7,0)
 S OREASON=$S($P(OREASON,U,6)="99RAR":$P(OREASON,U,5),1:$P(OREASON,U,2))
"RTN","ORMRA",8,0)
 S:'ORDUZ ORDUZ=DUZ S:'ORLOG ORLOG=+$E($$NOW^XLFDT,1,12)
"RTN","ORMRA",9,0)
 D @ORDCNTRL
"RTN","ORMRA",10,0)
 Q
"RTN","ORMRA",11,0)
 ;
"RTN","ORMRA",12,0)
ZP ; -- Purged
"RTN","ORMRA",13,0)
 Q:'ORIFN  Q:'$D(^OR(100,+ORIFN,0))  K ^OR(100,+ORIFN,4)
"RTN","ORMRA",14,0)
 ; - Set status=lapsed, if still active
"RTN","ORMRA",15,0)
 I "^3^5^6^8^"[(U_$P($G(^(3)),U,3)_U) D STATUS^ORCSAVE2(ORIFN,14)
"RTN","ORMRA",16,0)
 Q
"RTN","ORMRA",17,0)
 ;
"RTN","ORMRA",18,0)
ZR ; -- Purged as requested [ack]
"RTN","ORMRA",19,0)
 D DELETE^ORCSAVE2(+ORIFN)
"RTN","ORMRA",20,0)
 Q
"RTN","ORMRA",21,0)
 ;
"RTN","ORMRA",22,0)
ZU ; -- Unable to purge [ack]
"RTN","ORMRA",23,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT ; update Last Activity
"RTN","ORMRA",24,0)
 Q
"RTN","ORMRA",25,0)
 ;
"RTN","ORMRA",26,0)
OK ; -- Order accepted, RA order # assigned [ack]
"RTN","ORMRA",27,0)
 N ORSTS,OBR S ^OR(100,+ORIFN,4)=PKGIFN,ORSTS=5 ; 5=pending
"RTN","ORMRA",28,0)
 ; Ck if also scheduled, else quit
"RTN","ORMRA",29,0)
 S OBR=$O(@ORMSG@(+ORC)) G:'OBR OKQ G:$E(@ORMSG@(OBR),1,3)'="OBR" OKQ
"RTN","ORMRA",30,0)
 S ORSTRT=$$FMDATE^ORM($P(@ORMSG@(OBR),"|",37))
"RTN","ORMRA",31,0)
 D:ORSTRT DATES^ORCSAVE2(+ORIFN,ORSTRT)
"RTN","ORMRA",32,0)
OKQ D STATUS^ORCSAVE2(ORIFN,ORSTS)
"RTN","ORMRA",33,0)
 ;Save the Radiology pre-certification Account Reference in the PV1
"RTN","ORMRA",34,0)
 ;segment of the HL7 message from the Radiology package to the Order
"RTN","ORMRA",35,0)
 ;File (#100). Support for Patch OR*3.0*228
"RTN","ORMRA",36,0)
 I +$$SWSTAT^IBBAPI() D PRECERT^ORWPFSS2  ;IA #4663
"RTN","ORMRA",37,0)
 Q
"RTN","ORMRA",38,0)
 ;
"RTN","ORMRA",39,0)
XX ; -- Change order
"RTN","ORMRA",40,0)
 N ORDIALOG,ORDG,ORDA,ORX,ORP S:'$L(ORNATR) ORNATR="S"
"RTN","ORMRA",41,0)
 D DLG Q:$D(ORERR)  Q:'$D(ORDIALOG)  S ORIFN=+ORIFN
"RTN","ORMRA",42,0)
 S ORDA=$$ACTION^ORCSAVE("XX",ORIFN,ORNP,OREASON,ORLOG,ORDUZ)
"RTN","ORMRA",43,0)
 I ORDA'>0 S ORERR="Cannot create new order action" Q
"RTN","ORMRA",44,0)
 ; -Update sts of order to active, last action to dc/edit:
"RTN","ORMRA",45,0)
 S ORX=+$P($G(^OR(100,ORIFN,3)),U,7)
"RTN","ORMRA",46,0)
 S:$P($G(^OR(100,ORIFN,8,ORX,0)),U,15)="" $P(^(0),U,15)=12
"RTN","ORMRA",47,0)
 S $P(^OR(100,ORIFN,3),U,7)=ORDA D STATUS^ORCSAVE2(ORIFN,6)
"RTN","ORMRA",48,0)
 D RELEASE^ORCSAVE2(ORIFN,ORDA,ORLOG,ORDUZ,ORNATR)
"RTN","ORMRA",49,0)
 ; -If unsigned edit, leave XX unsigned & mark ORX as Sig Not Req'd
"RTN","ORMRA",50,0)
 S ORSIG=$S($P($G(^OR(100,ORIFN,8,ORX,0)),U,4)'=2:1,1:0)
"RTN","ORMRA",51,0)
 D SIGSTS^ORCSAVE2(ORIFN,ORDA):ORSIG,SIGN^ORCSAVE2(ORIFN,,,5,ORX):'ORSIG
"RTN","ORMRA",52,0)
 ; -Update responses, get/save new order text:
"RTN","ORMRA",53,0)
 K ^OR(100,ORIFN,4.5) D RESPONSE^ORCSAVE,ORDTEXT^ORCSAVE1(ORIFN_";"_ORDA)
"RTN","ORMRA",54,0)
 S $P(^OR(100,ORIFN,8,ORDA,0),U,14)=ORDA
"RTN","ORMRA",55,0)
 I $G(ORL) S ORP(1)=+ORIFN_";"_ORDA_"^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMRA",56,0)
 Q
"RTN","ORMRA",57,0)
 ;
"RTN","ORMRA",58,0)
SN ; -- New backdoor order: return NA msg w/ORIFN, or DE msg
"RTN","ORMRA",59,0)
 N ORDIALOG,ORDG,ORP K ^TMP("ORWORD",$J) S:'$L(ORNATR) ORNATR="W"
"RTN","ORMRA",60,0)
 I ORDUZ,'$D(^VA(200,ORDUZ,0)) S ORERR="Invalid entering person" Q
"RTN","ORMRA",61,0)
 I '$D(^VA(200,ORNP,0)) S ORERR="Missing or invalid ordering provider" Q
"RTN","ORMRA",62,0)
 I '$G(ORL) S ORERR="Missing or invalid patient location" Q
"RTN","ORMRA",63,0)
 D DLG Q:$D(ORERR)  Q:'$D(ORDIALOG)
"RTN","ORMRA",64,0)
SNQ D EN^ORCSAVE K ^TMP("ORWORD",$J)
"RTN","ORMRA",65,0)
 I '$G(ORIFN) S ORERR="Cannot create new order" Q
"RTN","ORMRA",66,0)
 ;Save DG1 and ZCL segments of HL7 message from backdoor orders
"RTN","ORMRA",67,0)
 D BDOSTR^ORWDBA3
"RTN","ORMRA",68,0)
 ;Save the Radiology pre-certification Account Reference in the PV1
"RTN","ORMRA",69,0)
 ;segment of the HL7 message from the Radiology package to the Order
"RTN","ORMRA",70,0)
 ;File (#100). Support for Patch OR*3.0*228
"RTN","ORMRA",71,0)
 I +$$SWSTAT^IBBAPI() D PRECERT^ORWPFSS2  ;IA #4663
"RTN","ORMRA",72,0)
 D RELEASE^ORCSAVE2(ORIFN,1,ORLOG,ORDUZ,ORNATR),SIGSTS^ORCSAVE2(ORIFN,1)
"RTN","ORMRA",73,0)
 D STATUS^ORCSAVE2(ORIFN,5) S ^OR(100,ORIFN,4)=PKGIFN
"RTN","ORMRA",74,0)
 I $G(ORL) S ORP(1)=ORIFN_";1^1" D PRINTS^ORWD1(.ORP,+ORL) ; chart copy
"RTN","ORMRA",75,0)
 Q
"RTN","ORMRA",76,0)
 ;
"RTN","ORMRA",77,0)
DLG ; -- Build ORDIALOG() from msg
"RTN","ORMRA",78,0)
 N OBR,OI,MODS,J,X,Y,ILOC,MODE,CH,CHI,OBX,NTE,REASON
"RTN","ORMRA",79,0)
 S ORDIALOG=$O(^ORD(101.41,"AB","RA OERR EXAM",0))
"RTN","ORMRA",80,0)
 D GETDLG1^ORCD(ORDIALOG)
"RTN","ORMRA",81,0)
 S ORDIALOG($$PTR("CATEGORY"),1)=$G(ORCAT)
"RTN","ORMRA",82,0)
 S ORDIALOG($$PTR("START DATE/TIME"),1)=ORSTRT
"RTN","ORMRA",83,0)
 S ORDIALOG($$PTR("URGENCY"),1)=ORURG
"RTN","ORMRA",84,0)
 S:$P(ORC,"|",12) ORDIALOG($$PTR("PROVIDER"),1)=+$P(ORC,"|",12)
"RTN","ORMRA",85,0)
D1 S OBR=$O(@ORMSG@(+ORC)) I 'OBR!($E($G(@ORMSG@(OBR)),1,3)'="OBR") S ORERR="Missing OBR segment" Q
"RTN","ORMRA",86,0)
 S OI=$$ORDITEM^ORM($P(@ORMSG@(OBR),"|",5))
"RTN","ORMRA",87,0)
 I 'OI S ORERR="Invalid procedure" Q
"RTN","ORMRA",88,0)
 S ORDIALOG($$PTR("ORDERABLE ITEM"),1)=OI
"RTN","ORMRA",89,0)
 S ORDG=$P($G(^ORD(101.43,+OI,"RA")),U,3) S:$L(ORDG) ORDG=+$O(^ORD(100.98,"B",ORDG,0)) I 'ORDG S ORDG=$P(^ORD(101.41,+ORDIALOG,0),U,5) ; Im Type
"RTN","ORMRA",90,0)
 S MODS=$P(@ORMSG@(OBR),"|",19) I $L(MODS) D
"RTN","ORMRA",91,0)
 . F J=1:1:$L(MODS,"~") S X=$P(MODS,"~",J) I $L(X) S Y=$O(^RAMIS(71.2,"B",X,0)) S:Y ORDIALOG($$PTR("MODIFIERS"),J)=Y
"RTN","ORMRA",92,0)
 S ILOC=+$P(@ORMSG@(OBR),"|",20),MODE=$P(@ORMSG@(OBR),"|",31),REASON=$P($P(@ORMSG@(OBR),"|",32),U,2)
"RTN","ORMRA",93,0)
 S:ILOC ORDIALOG($$PTR("IMAGING LOCATION"),1)=ILOC
"RTN","ORMRA",94,0)
 S ORDIALOG($$PTR("MODE OF TRANSPORT"),1)=$S(MODE="WALK":"A",MODE="CART":"S",1:$E(MODE))
"RTN","ORMRA",95,0)
 S:$L(REASON) ORDIALOG($$PTR("STUDY REASON"),1)=REASON
"RTN","ORMRA",96,0)
 I ORDCNTRL="XX" S NTE=+$O(@ORMSG@(OBR)) I NTE,$E($G(@ORMSG@(NTE)),1,3)="NTE" S OREASON=$P(@ORMSG@(NTE),"|",4) ;Tech's Comments
"RTN","ORMRA",97,0)
D2 ; might the procedure be scheduled at this point ??  Not in spec
"RTN","ORMRA",98,0)
 S CH=$$PTR("WORD PROCESSING 1"),CHI=0
"RTN","ORMRA",99,0)
 S OBX=OBR F  S OBX=$O(@ORMSG@(OBX)) Q:OBX'>0  S J=$E(@ORMSG@(OBX),1,3) Q:J="ORC"  Q:J="MSH"  I J="OBX" D
"RTN","ORMRA",100,0)
 . N NAME,VALUE,X0 S VALUE=$P(@ORMSG@(OBX),"|",6)
"RTN","ORMRA",101,0)
 . S NAME=$$UP^XLFSTR($P($P(@ORMSG@(OBX),"|",4),U,2))
"RTN","ORMRA",102,0)
 . I NAME="CONTRACT/SHARING SOURCE" S X0=$G(^DIC(34,+VALUE,0)) S:$L(X0) ORDIALOG($$PTR(NAME),1)=+VALUE,ORDIALOG($$PTR("CATEGORY"),1)=$P(X0,U,2) Q
"RTN","ORMRA",103,0)
 . I NAME="RESEARCH SOURCE" S ORDIALOG($$PTR(NAME),1)=VALUE,ORDIALOG($$PTR("CATEGORY"),1)="R" Q
"RTN","ORMRA",104,0)
 . I NAME="PREGNANT" S ORDIALOG($$PTR(NAME),1)=VALUE Q
"RTN","ORMRA",105,0)
 . I NAME="PRE-OP SCHEDULED DATE/TIME" S ORDIALOG($$PTR(NAME),1)=$$FMDATE^ORM(VALUE) Q
"RTN","ORMRA",106,0)
 . S CHI=CHI+1,^TMP("ORWORD",$J,CH,1,CHI,0)=VALUE
"RTN","ORMRA",107,0)
 S:CHI ^TMP("ORWORD",$J,CH,1,0)="^^"_CHI_U_CHI_U_DT_U,ORDIALOG(CH,1)="^TMP(""ORWORD"",$J,"_CH_",1)"
"RTN","ORMRA",108,0)
 Q
"RTN","ORMRA",109,0)
 ;
"RTN","ORMRA",110,0)
PTR(X) ; -- Returns ptr to prompt in Order Dialog file #101.41
"RTN","ORMRA",111,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_X,1,63),0))
"RTN","ORMRA",112,0)
 ;
"RTN","ORMRA",113,0)
SC ; -- Status changed (scheduled, registered, or unverified)
"RTN","ORMRA",114,0)
 N ORSTS,OBR,OR3 ;110
"RTN","ORMRA",115,0)
 S ORSTS=$S(ORDSTS="ZR":6,ORDSTS="ZU":6,1:8),OR3=$G(^OR(100,+ORIFN,3)) ;110
"RTN","ORMRA",116,0)
 G:ORSTS=6 SCQ ;136  Done if active, else get scheduled data
"RTN","ORMRA",117,0)
 S OBR=$O(@ORMSG@(+ORC)) I 'OBR!($E($G(@ORMSG@(OBR)),1,3)'="OBR") S ORERR="Missing OBR segment" Q
"RTN","ORMRA",118,0)
 S ORSTRT=$$FMDATE^ORM($P(@ORMSG@(OBR),"|",37))
"RTN","ORMRA",119,0)
 D:ORSTRT DATES^ORCSAVE2(+ORIFN,ORSTRT)
"RTN","ORMRA",120,0)
 I $P(OR3,U,3)=3,$P($G(^OR(100,+ORIFN,8,+$P(OR3,U,7),0)),U,2)="HD" D RL ;If status is hold and current action is hold then release.  Added with 110
"RTN","ORMRA",121,0)
SCQ D STATUS^ORCSAVE2(ORIFN,ORSTS)
"RTN","ORMRA",122,0)
 Q
"RTN","ORMRA",123,0)
 ;
"RTN","ORMRA",124,0)
RE ; -- Completed, w/results
"RTN","ORMRA",125,0)
 N I,SEG,OBX
"RTN","ORMRA",126,0)
 D STATUS^ORCSAVE2(ORIFN,2)
"RTN","ORMRA",127,0)
 S OBX="" D  ;get Results D/T [from OBR]
"RTN","ORMRA",128,0)
 . N DA,DR,DIE,X,Y,OBR
"RTN","ORMRA",129,0)
 . S DA=+ORIFN,DIE="^OR(100,",OBR=+$O(@ORMSG@(+ORC)),X=""
"RTN","ORMRA",130,0)
 . I OBR,$E($G(@ORMSG@(OBR)),1,3)="OBR" S X=$P(@ORMSG@(OBR),"|",23)
"RTN","ORMRA",131,0)
 . S DR="71////"_$S(X:$$FMDATE^ORM(X),1:+$E($$NOW^XLFDT,1,12)) D ^DIE
"RTN","ORMRA",132,0)
 S I=+ORC F  S I=$O(@ORMSG@(I)) Q:I<1  S SEG=$G(@ORMSG@(I)) Q:$E(SEG,1,3)="ORC"  I $E(SEG,1,3)="OBX" S OBX=I_U_SEG Q  ;first one
"RTN","ORMRA",133,0)
 S $P(^OR(100,+ORIFN,7),U,2)=$S($P(OBX,"|",9)="A":1,1:"")
"RTN","ORMRA",134,0)
 S:'$G(ORNP) ORNP=+$P($G(^OR(100,+ORIFN,0)),U,4)
"RTN","ORMRA",135,0)
 I $L($T(ADD^ORRCACK)) D ADD^ORRCACK(+ORIFN,ORNP) ;Ack stub for prov
"RTN","ORMRA",136,0)
 Q
"RTN","ORMRA",137,0)
 ;
"RTN","ORMRA",138,0)
OH ; -- Held
"RTN","ORMRA",139,0)
 D UPDATE(3,"HD")
"RTN","ORMRA",140,0)
 Q
"RTN","ORMRA",141,0)
 ;
"RTN","ORMRA",142,0)
OC ; -- Cancelled/Unable to accept [ack]
"RTN","ORMRA",143,0)
UA ; -- Unable to accept [ack]
"RTN","ORMRA",144,0)
 S:'$L(ORNATR) ORNATR="X" ;Rejected
"RTN","ORMRA",145,0)
 S ^OR(100,+ORIFN,6)=$O(^ORD(100.02,"C",ORNATR,0))_U_U_ORLOG_U_U_OREASON
"RTN","ORMRA",146,0)
 D STATUS^ORCSAVE2(ORIFN,13)
"RTN","ORMRA",147,0)
UD ; -- Unable to discontinue [ack]
"RTN","ORMRA",148,0)
 N DA S DA=+$P(ORIFN,";",2) I DA D
"RTN","ORMRA",149,0)
 . S $P(^OR(100,+ORIFN,8,DA,0),U,15)=13 ;Request rejected
"RTN","ORMRA",150,0)
 . S:$L(OREASON) ^OR(100,+ORIFN,8,DA,1)=OREASON
"RTN","ORMRA",151,0)
 Q
"RTN","ORMRA",152,0)
 ;
"RTN","ORMRA",153,0)
OD ; -- Discontinued
"RTN","ORMRA",154,0)
 S:$G(DGPMT) ORDUZ="" ;auto-dc on movement
"RTN","ORMRA",155,0)
 S ^OR(100,+ORIFN,6)=$S($L(ORNATR):$O(^ORD(100.02,"C",ORNATR,0)),1:"")_U_ORDUZ_U_ORLOG_U_U_OREASON
"RTN","ORMRA",156,0)
 D UPDATE(1,"DC")
"RTN","ORMRA",157,0)
 Q
"RTN","ORMRA",158,0)
 ;
"RTN","ORMRA",159,0)
DR ; -- Discontinued [ack]
"RTN","ORMRA",160,0)
 D STATUS^ORCSAVE2(ORIFN,1)
"RTN","ORMRA",161,0)
 Q
"RTN","ORMRA",162,0)
 ;
"RTN","ORMRA",163,0)
UPDATE(ORSTS,ORACT) ; -- continue processing
"RTN","ORMRA",164,0)
 N ORX,ORDA,ORP D:$G(ORSTS) STATUS^ORCSAVE2(ORIFN,ORSTS)
"RTN","ORMRA",165,0)
 S ORX=$$CREATE^ORX1(ORNATR) D:ORX
"RTN","ORMRA",166,0)
 . S ORDA=$$ACTION^ORCSAVE(ORACT,+ORIFN,ORNP,OREASON,ORLOG,ORDUZ)
"RTN","ORMRA",167,0)
 . I ORDA'>0 S ORERR="Cannot create new order action" Q
"RTN","ORMRA",168,0)
 . D RELEASE^ORCSAVE2(+ORIFN,ORDA,ORLOG,ORDUZ,ORNATR)
"RTN","ORMRA",169,0)
 . D SIGSTS^ORCSAVE2(+ORIFN,ORDA)
"RTN","ORMRA",170,0)
 . I $G(ORL) S ORP(1)=+ORIFN_";"_ORDA_"^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMRA",171,0)
 . S $P(^OR(100,+ORIFN,3),U,7)=ORDA
"RTN","ORMRA",172,0)
 I 'ORX D  ;no new action created
"RTN","ORMRA",173,0)
 . ;I ORACT="DC" S:'$$ACTV^ORX1(ORNATR) $P(^OR(100,+ORIFN,3),U,7)=0 Q
"RTN","ORMRA",174,0)
 . S:ORACT="HD"&$L(OREASON) ^OR(100,+ORIFN,8,1,1)=OREASON ;pend/sch only
"RTN","ORMRA",175,0)
 I ORACT="DC" D CANCEL^ORCSEND(+ORIFN) S:'$$ACTV^ORX1(ORNATR) $P(^OR(100,+ORIFN,3),U,7)=0
"RTN","ORMRA",176,0)
 Q
"RTN","ORMRA",177,0)
 ;
"RTN","ORMRA",178,0)
RL ;Release hold --entire section added with patch 110
"RTN","ORMRA",179,0)
 S ^OR(100,+ORIFN,8,$P(OR3,U,7),2)=ORLOG_"^"_ORDUZ  ;Set release hold date/time and release hold user
"RTN","ORMRA",180,0)
 S ORNATR=$S($L(ORNATR):ORNATR,1:$P(^OR(100,+ORIFN,8,$P(OR3,U,7),0),U,12)) ;set nature of order for release equal to nature of order for hold if it doesn't exist
"RTN","ORMRA",181,0)
 I $G(ORSTS)="" S ORSTS=6
"RTN","ORMRA",182,0)
 D UPDATE(ORSTS,"RL")
"RTN","ORMRA",183,0)
 Q
"RTN","ORMTIM02")
0^136^B17248840
"RTN","ORMTIM02",1,0)
ORMTIM02 ; JM/SLC-ISC - PERFORM MISC TIME BASED ACTIVITIES ;05/02/06
"RTN","ORMTIM02",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**253,243**;Dec 17, 1997;Build 242
"RTN","ORMTIM02",3,0)
 ;
"RTN","ORMTIM02",4,0)
 Q
"RTN","ORMTIM02",5,0)
MISC ; Perform misc time based activities
"RTN","ORMTIM02",6,0)
 ;
"RTN","ORMTIM02",7,0)
 D UNSIGNED ; Generate alerts for unsigned orders that have slipped through the cracks
"RTN","ORMTIM02",8,0)
 D INIT^ORWGTASK(0) ; check to run rebuild of cache for graphing
"RTN","ORMTIM02",9,0)
 ;
"RTN","ORMTIM02",10,0)
 Q
"RTN","ORMTIM02",11,0)
 ;
"RTN","ORMTIM02",12,0)
UNSIGNED ; Generate alerts for unsigned orders that were not alerted by CPRS
"RTN","ORMTIM02",13,0)
 ; This happens when CPRS crashes - through network connection drops or other causes
"RTN","ORMTIM02",14,0)
 N ORZPAT,ORZDATE,ORZIEN,ORZSUB,ORZSDATE,%DT,X,Y,ORZTIME,ORZNOW,ORZPURGE
"RTN","ORMTIM02",15,0)
 N ORN,ORBDFN,ORNUM,ORBADUZ,ORBPMSG,ORBPDATA,ORZREC8,ORZSIGDT,ORZSTS,ORZWHEN,ORMARKID
"RTN","ORMTIM02",16,0)
 N MINTIME,XTMPDAYS,XTMPHOUR,MINDAYS
"RTN","ORMTIM02",17,0)
 S ORN=12,ORMARKID="ORMTIME_UNSGNORD"
"RTN","ORMTIM02",18,0)
 ;
"RTN","ORMTIM02",19,0)
 S MINTIME=60 ; Order must be unsigned for 60 Minutes before generating an alert
"RTN","ORMTIM02",20,0)
 S MINDAYS=90 ; Order must have been generated within the last 90 days
"RTN","ORMTIM02",21,0)
 ;
"RTN","ORMTIM02",22,0)
 S XTMPDAYS=10 ; Keep ^XTMP record for 10 days - reset timeframe with each run
"RTN","ORMTIM02",23,0)
 S XTMPHOUR=48 ; Each order that's verified as having generated an alert has a flag set in
"RTN","ORMTIM02",24,0)
 ;               ^XTMP that's kept for 48 hours.  When flag is gone, must recheck alert status
"RTN","ORMTIM02",25,0)
 ;
"RTN","ORMTIM02",26,0)
 S X="T-"_MINDAYS
"RTN","ORMTIM02",27,0)
 D ^%DT S ORZSDATE=9999999-Y
"RTN","ORMTIM02",28,0)
 S %DT="ST",X="NOW" D ^%DT
"RTN","ORMTIM02",29,0)
 S ORZNOW=Y
"RTN","ORMTIM02",30,0)
 S ORZTIME=$$FMADD^XLFDT(ORZNOW,0,0,-MINTIME,0) ; Order must have existed for ORZTIME minutes
"RTN","ORMTIM02",31,0)
 S ORZPURGE=$$FMADD^XLFDT(ORZNOW,XTMPDAYS,0,0,0) ; Purge all marked flags if not run in XTMPDAYS days
"RTN","ORMTIM02",32,0)
 S ^XTMP(ORMARKID,0)=ORZPURGE_U_ORZNOW_U_"Unsigned Orders Reviewed by ORMTIME"
"RTN","ORMTIM02",33,0)
 S ORZPURGE=$$FMADD^XLFDT(ORZNOW,0,XTMPHOUR,0,0) ; Purge each marked flag XTMPHOUR hours after creation
"RTN","ORMTIM02",34,0)
 K MINTIME,MINDAYS,XTMPDAYS,XTMPHOUR,X,Y,%DT ; Kill non-namespaced vars
"RTN","ORMTIM02",35,0)
 S ORZPAT="" F  S ORZPAT=$O(^OR(100,"AS",ORZPAT)) Q:'ORZPAT  D
"RTN","ORMTIM02",36,0)
 . Q:$P(^DPT(+ORZPAT,0),U,21)  ; Quit if test patient
"RTN","ORMTIM02",37,0)
 . S ORZDATE=0 F  S ORZDATE=$O(^OR(100,"AS",ORZPAT,ORZDATE)) Q:'ORZDATE  I ORZDATE<ORZSDATE D
"RTN","ORMTIM02",38,0)
 . . S ORZIEN=0 F  S ORZIEN=$O(^OR(100,"AS",ORZPAT,ORZDATE,ORZIEN)) Q:'ORZIEN  D
"RTN","ORMTIM02",39,0)
 . . . S ORZSUB=0 F  S ORZSUB=$O(^OR(100,"AS",ORZPAT,ORZDATE,ORZIEN,ORZSUB)) Q:'ORZSUB  D
"RTN","ORMTIM02",40,0)
 . . . . I $D(^OR(100,ORZIEN,8,ORZSUB,0)) D
"RTN","ORMTIM02",41,0)
 . . . . . S ORZREC8=^OR(100,ORZIEN,8,ORZSUB,0)
"RTN","ORMTIM02",42,0)
 . . . . . S ORZSIGDT=$P(ORZREC8,U,6) I $L(ORZSIGDT)>0 Q  ; Can't have a sign date/time
"RTN","ORMTIM02",43,0)
 . . . . . S ORZSTS=$P(ORZREC8,U,4) I ORZSTS'=2 Q  ; must be in an unsigned state
"RTN","ORMTIM02",44,0)
 . . . . . S ORZWHEN=$P(ORZREC8,U) I ORZWHEN>ORZTIME Q  ; must have been unsigned for MINTIME
"RTN","ORMTIM02",45,0)
 . . . . . S ORBDFN=+ORZPAT
"RTN","ORMTIM02",46,0)
 . . . . . S ORNUM=ORZIEN_";"_ORZSUB
"RTN","ORMTIM02",47,0)
 . . . . . I $$NEEDALRT($P(ORZREC8,U,3),ORBDFN,ORNUM) D  ; must not have already generated an alert
"RTN","ORMTIM02",48,0)
 . . . . . . S (ORBADUZ,ORBPMSG,ORBPDATA)=""
"RTN","ORMTIM02",49,0)
 . . . . . . D DOALERT^ORB3
"RTN","ORMTIM02",50,0)
 . . . . . . D MARK(ORNUM) ; Alert sent, don't send another one
"RTN","ORMTIM02",51,0)
 D CLEAN
"RTN","ORMTIM02",52,0)
 Q
"RTN","ORMTIM02",53,0)
 ;
"RTN","ORMTIM02",54,0)
NEEDALRT(PROVIDER,DFN,ORNUM) ; Returns true if order needs an alert
"RTN","ORMTIM02",55,0)
 ;
"RTN","ORMTIM02",56,0)
 I $$MARKED(ORNUM) Q 0 ; If already checked, return
"RTN","ORMTIM02",57,0)
 ;
"RTN","ORMTIM02",58,0)
 N RESULT,SUROGATE
"RTN","ORMTIM02",59,0)
 S RESULT=1
"RTN","ORMTIM02",60,0)
 I $$HASALERT(PROVIDER,DFN) S RESULT=0 I 1
"RTN","ORMTIM02",61,0)
 E  D
"RTN","ORMTIM02",62,0)
 . S SUROGATE=$P($$GETSURO^XQALSURO(PROVIDER),U,1)
"RTN","ORMTIM02",63,0)
 . I +SUROGATE,$$HASALERT(SUROGATE,DFN) S RESULT=0
"RTN","ORMTIM02",64,0)
 I 'RESULT D MARK(ORNUM)
"RTN","ORMTIM02",65,0)
 Q RESULT
"RTN","ORMTIM02",66,0)
 ;
"RTN","ORMTIM02",67,0)
HASALERT(USER,PATIENT) ; Returns true if alert exists for user and patient
"RTN","ORMTIM02",68,0)
 N RESULT,ALERTID,DATE
"RTN","ORMTIM02",69,0)
 S RESULT=0,ALERTID="OR,"_PATIENT_",12"
"RTN","ORMTIM02",70,0)
 I $D(^XTV(8992,"AXQAN",ALERTID,USER)) D  ;DBIA# 2689
"RTN","ORMTIM02",71,0)
 . S DATE=$O(^XTV(8992,"AXQAN",ALERTID,USER,0))
"RTN","ORMTIM02",72,0)
 . I $G(DATE)>0 S RESULT=1
"RTN","ORMTIM02",73,0)
 Q RESULT
"RTN","ORMTIM02",74,0)
 ;
"RTN","ORMTIM02",75,0)
MARKED(ORNUM) ; Returns true if the order has been marked as not needing an alert
"RTN","ORMTIM02",76,0)
 I $D(^XTMP(ORMARKID,"A",ORNUM))>0 Q 1
"RTN","ORMTIM02",77,0)
 Q 0
"RTN","ORMTIM02",78,0)
 ; 
"RTN","ORMTIM02",79,0)
MARK(ORNUM) ; Marks an order as already having been alerted
"RTN","ORMTIM02",80,0)
 S ^XTMP(ORMARKID,"A",ORNUM)=""
"RTN","ORMTIM02",81,0)
 S ^XTMP(ORMARKID,"B",ORZPURGE,ORNUM)=""
"RTN","ORMTIM02",82,0)
 Q
"RTN","ORMTIM02",83,0)
CLEAN ; Clean up old entries in ^XTMP
"RTN","ORMTIM02",84,0)
 N IDX,ORNUM
"RTN","ORMTIM02",85,0)
 S IDX=0
"RTN","ORMTIM02",86,0)
 F  S IDX=$O(^XTMP(ORMARKID,"B",IDX)) Q:((+IDX=0)!(IDX>ORZNOW))  D
"RTN","ORMTIM02",87,0)
 . S ORNUM=0
"RTN","ORMTIM02",88,0)
 . F  S ORNUM=$O(^XTMP(ORMARKID,"B",IDX,ORNUM)) Q:+ORNUM=0  D
"RTN","ORMTIM02",89,0)
 . . K ^XTMP(ORMARKID,"A",ORNUM)
"RTN","ORMTIM02",90,0)
 . . K ^XTMP(ORMARKID,"B",IDX,ORNUM)
"RTN","ORMTIM02",91,0)
 Q
"RTN","ORMTIME")
0^99^B9294457
"RTN","ORMTIME",1,0)
ORMTIME ; SLC/RJS - PROCESS TIME BASED EVENT ;9/29/99  09:35 [2/1/00 9:30am]
"RTN","ORMTIME",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**40,253,243**;Dec 17, 1997;Build 242
"RTN","ORMTIME",3,0)
 ;
"RTN","ORMTIME",4,0)
EN ; Main entry tag.
"RTN","ORMTIME",5,0)
 ;
"RTN","ORMTIME",6,0)
 N OCXPSDT,OCXZTSK,OCXERR,OCXORMTR,OCXSTDT,OCXLOCK,OCXPAR
"RTN","ORMTIME",7,0)
 K ^TMP("OCXORMTIME",$J)
"RTN","ORMTIME",8,0)
 S OCXLOCK=0
"RTN","ORMTIME",9,0)
 S OCXORMTR="ORMTIME: Startup"
"RTN","ORMTIME",10,0)
 S OCXSTDT=$$EDATE($$IDATE("NOW"))
"RTN","ORMTIME",11,0)
 S ^TMP("OCXORMTIME",$J,"STATUS")="ORMTIME: Attempting to lock ^OR(100,""AE"") at "_OCXSTDT_"."
"RTN","ORMTIME",12,0)
 L +^OR(100,"AE"):10
"RTN","ORMTIME",13,0)
 I  D
"RTN","ORMTIME",14,0)
 .S OCXLOCK=1
"RTN","ORMTIME",15,0)
 .D SCAN
"RTN","ORMTIME",16,0)
 .L -^OR(100,"AE")
"RTN","ORMTIME",17,0)
 .K ^TMP("OCXORMTIME")
"RTN","ORMTIME",18,0)
 .S OCXPAR=$$IDATE2("NOW")
"RTN","ORMTIME",19,0)
 .D PUT^XPAR("SYS","ORM ORMTIME LAST RUN",1,OCXPAR,.OCXERR)
"RTN","ORMTIME",20,0)
 S:'OCXLOCK ^TMP("OCXORMTIME",$J,"STATUS")="ORMTIME: Unable to lock ^OR(100,""AE"") at "_OCXSTDT_" attempt."
"RTN","ORMTIME",21,0)
 Q
"RTN","ORMTIME",22,0)
 ;
"RTN","ORMTIME",23,0)
SCAN ; Call ORMTIM01 for order checking, etc.  ORMTIM02 for misc time based tasks
"RTN","ORMTIME",24,0)
 ;
"RTN","ORMTIME",25,0)
 D SCAN^ORMTIM01
"RTN","ORMTIME",26,0)
 D MISC^ORMTIM02
"RTN","ORMTIME",27,0)
 D TASK^ORTSKLPS
"RTN","ORMTIME",28,0)
 Q
"RTN","ORMTIME",29,0)
 ;
"RTN","ORMTIME",30,0)
EDATE(Y) X ^DD("DD") S:(Y["@") Y=$P(Y,"@",1)_" at "_$P(Y,"@",2) Q Y
"RTN","ORMTIME",31,0)
 ;
"RTN","ORMTIME",32,0)
IDATE(X) N %DT,Y S %DT="F" D ^%DT Q Y
"RTN","ORMTIME",33,0)
 ;
"RTN","ORMTIME",34,0)
IDATE2(X) N %DT,Y S %DT="TF" D ^%DT Q Y
"RTN","ORMTIME",35,0)
 ;
"RTN","ORMTIME",36,0)
REQUEUE(ORMQT) ; Code formerly queued ORMTIME tasks in Taskman.
"RTN","ORMTIME",37,0)
 ;
"RTN","ORMTIME",38,0)
 ; (This tag kept for compatibility with outside calls.)
"RTN","ORMTIME",39,0)
 ;
"RTN","ORMTIME",40,0)
 Q
"RTN","ORMTIME",41,0)
 ;
"RTN","ORMTIME",42,0)
STATUS ; Check status of last ORMTIME run. 
"RTN","ORMTIME",43,0)
 ;
"RTN","ORMTIME",44,0)
 N ORMLAST
"RTN","ORMTIME",45,0)
 ;
"RTN","ORMTIME",46,0)
 ; Get date/time of last ORMTIME run:
"RTN","ORMTIME",47,0)
 S ORMLAST=$$GET^XPAR("SYS","ORM ORMTIME LAST RUN",1,"I")
"RTN","ORMTIME",48,0)
 S ORMLAST=$$EDATE(ORMLAST) ; Convert to external format for display.
"RTN","ORMTIME",49,0)
 ;
"RTN","ORMTIME",50,0)
 ; Present information to user:
"RTN","ORMTIME",51,0)
 W !
"RTN","ORMTIME",52,0)
 W !,"     ORMTIME last ran "_ORMLAST_"."
"RTN","ORMTIME",53,0)
 W !
"RTN","ORMTIME",54,0)
 ;
"RTN","ORMTIME",55,0)
 Q
"RTN","ORMTIME",56,0)
 ;
"RTN","ORMTIME",57,0)
BULL ; Send a bulletin if ORMTIME's last run is greater than 24 hours.
"RTN","ORMTIME",58,0)
 ;
"RTN","ORMTIME",59,0)
 N DIC,ORMMSG,X,XMSUB,XMTEXT,XMY,XMZ,Y,ORMLAST
"RTN","ORMTIME",60,0)
 ;
"RTN","ORMTIME",61,0)
 ; Don't send bulletin if ORMTIME STATUS mail group does not exist:
"RTN","ORMTIME",62,0)
 S DIC=3.8,DIC(0)="",X="ORMTIME STATUS"
"RTN","ORMTIME",63,0)
 D ^DIC Q:(+Y<0)
"RTN","ORMTIME",64,0)
 ;
"RTN","ORMTIME",65,0)
 S ORMLAST=$$GET^XPAR("SYS","ORM ORMTIME LAST RUN",1,"I")
"RTN","ORMTIME",66,0)
 I $$FMDIFF^XLFDT($$IDATE2("NOW"),ORMLAST,2)>86400  D
"RTN","ORMTIME",67,0)
 .S XMY("G.ORMTIME STATUS")=""
"RTN","ORMTIME",68,0)
 .S XMSUB=" ORMTIME Warning"
"RTN","ORMTIME",69,0)
 .S ORMMSG(1,0)=" "
"RTN","ORMTIME",70,0)
 .S ORMMSG(2,0)="    The ORMTIME process last ran more than 24 hours ago. "
"RTN","ORMTIME",71,0)
 .S ORMMSG(3,0)=" "
"RTN","ORMTIME",72,0)
 .S ORMMSG(4,0)=" The ORMTIME background job handles activating and expiring orders,"
"RTN","ORMTIME",73,0)
 .S ORMMSG(5,0)=" some time based notifications, as well as purging of temporary CPRS"
"RTN","ORMTIME",74,0)
 .S ORMMSG(6,0)=" data. It is important that it runs regularly."
"RTN","ORMTIME",75,0)
 .S ORMMSG(7,0)=" "
"RTN","ORMTIME",76,0)
 .S ORMMSG(8,0)="    Assure that the scheduled option, ORMTIME RUN, is correctly implemented."
"RTN","ORMTIME",77,0)
 .S ORMMSG(9,0)=" "
"RTN","ORMTIME",78,0)
 .S XMTEXT="ORMMSG("
"RTN","ORMTIME",79,0)
 .D ^XMD
"RTN","ORMTIME",80,0)
 Q
"RTN","ORMTIME",81,0)
 ;
"RTN","OROVRRPT")
0^100^B40771295
"RTN","OROVRRPT",1,0)
OROVRRPT ;SLC/TC - Order Check Override Reason Report Utility; 8/31/06 1:45pm
"RTN","OROVRRPT",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","OROVRRPT",3,0)
 ;
"RTN","OROVRRPT",4,0)
EN ;
"RTN","OROVRRPT",5,0)
 N ANS,TMP
"RTN","OROVRRPT",6,0)
 W @IOF
"RTN","OROVRRPT",7,0)
 D ASKUSER^ORSRCHOR(.ANS,"FILTER SEARCH by") Q:$G(ANS("EXIT"))="YES"
"RTN","OROVRRPT",8,0)
 D
"RTN","OROVRRPT",9,0)
 . N POP,ORDESC,ORRTN,ORSAVE
"RTN","OROVRRPT",10,0)
 . S ORDESC="OROVRRPT Override Reason Report",ORRTN="DISPLAY^OROVRRPT",ORSAVE("*")=""
"RTN","OROVRRPT",11,0)
 . W ! D EN^XUTMDEVQ(ORRTN,ORDESC,.ORSAVE) K ^TMP("OROVRRPT",$J)
"RTN","OROVRRPT",12,0)
 Q
"RTN","OROVRRPT",13,0)
 ;
"RTN","OROVRRPT",14,0)
DISPLAY ; Print data in an organized report format.
"RTN","OROVRRPT",15,0)
 ;
"RTN","OROVRRPT",16,0)
 D HEADER^ORSRCHOR
"RTN","OROVRRPT",17,0)
 N ORSUB1,ORSUB2,ORSUB3,ORSUB4,ORDNO,NORECS,ORCONT,LINECNT,RECNO S (ORSUB1,ORSUB2,ORSUB3,ORSUB4,ORDNO,RECNO)=0,NORECS="NO RECORDS FOUND!",ORCONT=1
"RTN","OROVRRPT",18,0)
 S LINECNT=$S(ANS("SORT")="OVRDNBY":12,ANS("SORT")="ORCHK":11,ANS("SORT")="DIV":11,ANS("SORT")="DSPGRP":11,ANS("SORT")="DTORD":12)
"RTN","OROVRRPT",19,0)
 F  S ORSUB1=$O(^TMP("OROVRRPT",$J,ORSUB1)) Q:ORSUB1=""  D  Q:ORCONT=0
"RTN","OROVRRPT",20,0)
 . F  S ORSUB2=$O(^TMP("OROVRRPT",$J,ORSUB1,ORSUB2)) Q:ORSUB2=""  D  Q:ORCONT=0
"RTN","OROVRRPT",21,0)
 . . F  S ORSUB3=$O(^TMP("OROVRRPT",$J,ORSUB1,ORSUB2,ORSUB3)) Q:ORSUB3=""  D  Q:ORCONT=0
"RTN","OROVRRPT",22,0)
 . . . F  S ORSUB4=$O(^TMP("OROVRRPT",$J,ORSUB1,ORSUB2,ORSUB3,ORSUB4)) Q:ORSUB4=""  D  Q:ORCONT=0
"RTN","OROVRRPT",23,0)
 . . . . F  S ORDNO=$O(^TMP("OROVRRPT",$J,ORSUB1,ORSUB2,ORSUB3,ORSUB4,ORDNO)) Q:ORDNO=""  D  Q:ORCONT=0
"RTN","OROVRRPT",24,0)
 . . . . . N DATA,OVRRIDBY,ORDCHK1,ORDCHK2,ORDCHK S DATA=$G(^TMP("OROVRRPT",$J,ORSUB1,ORSUB2,ORSUB3,ORSUB4,ORDNO)),OVRRIDBY=$P($G(^VA(200,+$P(DATA,U,3),0)),U)
"RTN","OROVRRPT",25,0)
 . . . . . I '$L(OVRRIDBY) S OVRRIDBY="NONE SPECIFIED"
"RTN","OROVRRPT",26,0)
 . . . . . S ORDCHK1=$S(ANS("SORT")="OVRDNBY":ORSUB4,ANS("SORT")="ORCHK":ORSUB1,ANS("SORT")="DIV":ORSUB3,ANS("SORT")="DSPGRP":ORSUB3,ANS("SORT")="DTORD":ORSUB4)
"RTN","OROVRRPT",27,0)
 . . . . . S ORDCHK2=$P(DATA,U,5),ORDCHK=$S($L(ORDCHK2)>1:ORDCHK1_ORDCHK2,1:ORDCHK1)
"RTN","OROVRRPT",28,0)
 . . . . . I ANS("DELIMIT")="YES" D      ; Delimited report printout of non-word processing fields
"RTN","OROVRRPT",29,0)
 . . . . . . S RECNO=RECNO+1
"RTN","OROVRRPT",30,0)
 . . . . . . I ANS("SORT")="OVRDNBY" W !,RECNO_TMP("DLMTR")_$$FMTE^XLFDT(ORSUB1,"1P")_TMP("DLMTR")_ORSUB2_TMP("DLMTR")_ORSUB3_TMP("DLMTR")_ORDNO_TMP("DLMTR")_$$FMTE^XLFDT($P(DATA,U,4),"1P")
"RTN","OROVRRPT",31,0)
 . . . . . . I ANS("SORT")="ORCHK" W !,RECNO_TMP("DLMTR")_$$FMTE^XLFDT(ORSUB4,"1P")_TMP("DLMTR")_ORSUB2_TMP("DLMTR")_ORSUB3_TMP("DLMTR")_ORDNO_TMP("DLMTR")_OVRRIDBY_TMP("DLMTR")_$$FMTE^XLFDT($P(DATA,U,4),"1P")
"RTN","OROVRRPT",32,0)
 . . . . . . I ANS("SORT")="DIV" W !,RECNO_TMP("DLMTR")_$$FMTE^XLFDT(ORSUB4,"1P")_TMP("DLMTR")_ORSUB2_TMP("DLMTR")_ORDNO_TMP("DLMTR")_OVRRIDBY_TMP("DLMTR")_$$FMTE^XLFDT($P(DATA,U,4),"1P")
"RTN","OROVRRPT",33,0)
 . . . . . . I ANS("SORT")="DSPGRP" W !,RECNO_TMP("DLMTR")_$$FMTE^XLFDT(ORSUB4,"1P")_TMP("DLMTR")_ORSUB2_TMP("DLMTR")_ORDNO_TMP("DLMTR")_OVRRIDBY_TMP("DLMTR")_$$FMTE^XLFDT($P(DATA,U,4),"1P")
"RTN","OROVRRPT",34,0)
 . . . . . . I ANS("SORT")="DTORD" W !,RECNO_TMP("DLMTR")_$$FMTE^XLFDT(ORSUB1,"1P")_TMP("DLMTR")_ORDNO_TMP("DLMTR")_OVRRIDBY_TMP("DLMTR")_$$FMTE^XLFDT($P(DATA,U,4),"1P")
"RTN","OROVRRPT",35,0)
 . . . . . . S ^TMP(ANS("SORT"),"ORDER TEXT",RECNO)=$P(DATA,U),^TMP(ANS("SORT"),"ORDER CHK",RECNO)=ORDCHK,^TMP(ANS("SORT"),"OVERRIDE REASON",RECNO)=$P(DATA,U,2)
"RTN","OROVRRPT",36,0)
 . . . . . E  D  ; Summary report printout
"RTN","OROVRRPT",37,0)
 . . . . . . I ANS("SORT")="OVRDNBY"&(ORCONT=1) W !,$$FMTE^XLFDT(ORSUB1,"1M"),?21,ORSUB2,?40,ORSUB3,?70,ORDNO
"RTN","OROVRRPT",38,0)
 . . . . . . I ANS("SORT")="ORCHK"&(ORCONT=1) W !,$$FMTE^XLFDT(ORSUB4,"1M"),?21,ORSUB2,?40,ORSUB3,?70,ORDNO
"RTN","OROVRRPT",39,0)
 . . . . . . I ANS("SORT")="DIV"&(ORCONT=1) W !,$$FMTE^XLFDT(ORSUB4,"1M"),?25,ORSUB2,?60,ORDNO
"RTN","OROVRRPT",40,0)
 . . . . . . I ANS("SORT")="DSPGRP"&(ORCONT=1) W !,$$FMTE^XLFDT(ORSUB4,"1M"),?25,ORSUB2,?60,ORDNO
"RTN","OROVRRPT",41,0)
 . . . . . . I ANS("SORT")="DTORD"&(ORCONT=1) W !,$$FMTE^XLFDT(ORSUB1,"1M"),?45,ORDNO
"RTN","OROVRRPT",42,0)
 . . . . . . S LINECNT=$$CHK4BRK(LINECNT)
"RTN","OROVRRPT",43,0)
 . . . . . . I ANS("SORT")="OVRDNBY"&(ORCONT=1) W !?3,"D/T Overridden: ",$$FMTE^XLFDT($P(DATA,U,4),"1M")
"RTN","OROVRRPT",44,0)
 . . . . . . E  I ORCONT=1 W !?3,"Overridden by: ",OVRRIDBY,?46,"D/T Overridden: ",$$FMTE^XLFDT($P(DATA,U,4),"1M")
"RTN","OROVRRPT",45,0)
 . . . . . . S LINECNT=$$CHK4BRK(LINECNT)
"RTN","OROVRRPT",46,0)
 . . . . . . N CNT,CNT1,CNT2,ORDTXT,OVRRSN S ORDTXT=$P(DATA,U),OVRRSN=$P(DATA,U,2) I ($L(ORDTXT)>65)!($L(OVRRSN)>60)!($L(ORDCHK)>66) D
"RTN","OROVRRPT",47,0)
 . . . . . . . S ORDTXT=$$WRAP^TIULS(ORDTXT,65) I ORCONT=1 W !?3,"Order Text: ",$P(ORDTXT,"|") S LINECNT=$$CHK4BRK(LINECNT)
"RTN","OROVRRPT",48,0)
 . . . . . . . I $L(ORDTXT,"|")>1 F CNT=2:1:$L(ORDTXT,"|") I ORCONT=1 W !?15,$P(ORDTXT,"|",CNT) S LINECNT=$$CHK4BRK(LINECNT)
"RTN","OROVRRPT",49,0)
 . . . . . . . S ORDCHK=$$WRAP^TIULS(ORDCHK,66) I ORCONT=1 W !?3,"Order Chk: ",$P(ORDCHK,"|") S LINECNT=$$CHK4BRK(LINECNT)
"RTN","OROVRRPT",50,0)
 . . . . . . . I $L(ORDCHK,"|")>1 F CNT2=2:1:$L(ORDCHK,"|") I ORCONT=1 W !?14,$P(ORDCHK,"|",CNT2) S LINECNT=$$CHK4BRK(LINECNT)
"RTN","OROVRRPT",51,0)
 . . . . . . . S OVRRSN=$$WRAP^TIULS(OVRRSN,60) I ORCONT=1 W !?3,"Override Reason: ",$P(OVRRSN,"|") S LINECNT=$$CHK4BRK(LINECNT)
"RTN","OROVRRPT",52,0)
 . . . . . . . I (ORCONT=1)&($L(OVRRSN,"|")=1) W ! S LINECNT=$$CHK4BRK(LINECNT)
"RTN","OROVRRPT",53,0)
 . . . . . . . E  I $L(OVRRSN,"|")>1 D
"RTN","OROVRRPT",54,0)
 . . . . . . . . F CNT1=2:1:$L(OVRRSN,"|")  D  Q:ORCONT=0
"RTN","OROVRRPT",55,0)
 . . . . . . . . . W !?20,$P(OVRRSN,"|",CNT1) S LINECNT=$$CHK4BRK(LINECNT)
"RTN","OROVRRPT",56,0)
 . . . . . . . . . I CNT1=$L(OVRRSN,"|") W ! S LINECNT=$$CHK4BRK(LINECNT)
"RTN","OROVRRPT",57,0)
 . . . . . . E  I ORCONT=1 D
"RTN","OROVRRPT",58,0)
 . . . . . . . W !?3,"Order Text: ",ORDTXT S LINECNT=$$CHK4BRK(LINECNT)
"RTN","OROVRRPT",59,0)
 . . . . . . . W !?3,"Order Chk: ",ORDCHK S LINECNT=$$CHK4BRK(LINECNT)
"RTN","OROVRRPT",60,0)
 . . . . . . . W !?3,"Override Reason: ",OVRRSN S LINECNT=$$CHK4BRK(LINECNT)
"RTN","OROVRRPT",61,0)
 . . . . . . . W ! S LINECNT=$$CHK4BRK(LINECNT)
"RTN","OROVRRPT",62,0)
 I ANS("DELIMIT")="YES"&($D(^TMP("OROVRRPT",$J))) D      ; Delimited report printout of word-processing fields
"RTN","OROVRRPT",63,0)
 . N ROUND F ROUND=1:1:3 D  Q:ANS("CONT")="NO"
"RTN","OROVRRPT",64,0)
 . . N DIR,DIRUT,Y,FLD S FLD=$S(ROUND=1:"ORDER TEXT",ROUND=2:"ORDER CHK",ROUND=3:"OVERRIDE REASON"),DIR(0)="Y",DIR("A")="Continue to export the "_FLD_" field only",DIR("B")="YES"
"RTN","OROVRRPT",65,0)
 . . S DIR("?",1)="Entering 'YES' will print out a delimited report of the word-processing field.",DIR("?",2)=""
"RTN","OROVRRPT",66,0)
 . . S DIR("?")="Entering 'NO' will complete the report and allow the user to exit the program." W ! D ^DIR K DIR W !
"RTN","OROVRRPT",67,0)
 . . I '$D(DIRUT),Y=1 D
"RTN","OROVRRPT",68,0)
 . . . S ANS("CONT")="YES" W !,"RECNO"_TMP("DLMTR")_FLD
"RTN","OROVRRPT",69,0)
 . . . N RECNO S RECNO="" F  S RECNO=$O(^TMP(ANS("SORT"),FLD,RECNO)) Q:RECNO=""  W !,RECNO_TMP("DLMTR"),$G(^TMP(ANS("SORT"),FLD,RECNO))
"RTN","OROVRRPT",70,0)
 . . E  S ANS("CONT")="NO" Q
"RTN","OROVRRPT",71,0)
 I '$D(^TMP("OROVRRPT",$J)) W !!!?(IOM-$L(NORECS))/2,NORECS,!!
"RTN","OROVRRPT",72,0)
 K ^TMP("OROVRRPT",$J),^TMP(ANS("SORT"))
"RTN","OROVRRPT",73,0)
 I ($E(IOST)="C")&(ORCONT=1) W ! N DIR,DIRUT S DIR(0)="E",DIR("A")="Report Completed. Please Press ENTER to EXIT" D ^DIR Q:$D(DIRUT)
"RTN","OROVRRPT",74,0)
 Q
"RTN","OROVRRPT",75,0)
 ;
"RTN","OROVRRPT",76,0)
PGBRK() ; Executes page breaks for a terminal device.
"RTN","OROVRRPT",77,0)
 ; If ORCONT=1, continue page break. 
"RTN","OROVRRPT",78,0)
 ; If ORCONT=0, Quit page break.
"RTN","OROVRRPT",79,0)
 ; 
"RTN","OROVRRPT",80,0)
 N DIR,Y,ORCONT,DIRUT S DIR(0)="E" D ^DIR S ORCONT=Y Q ORCONT
"RTN","OROVRRPT",81,0)
 ;
"RTN","OROVRRPT",82,0)
CHK4BRK(LINECNT) ; Check for page break and display appropriate column headers for terminal screen display.
"RTN","OROVRRPT",83,0)
 ;
"RTN","OROVRRPT",84,0)
 S LINECNT=LINECNT+1
"RTN","OROVRRPT",85,0)
 I ($E(IOST)="C")&(IOSL<98)&(LINECNT=22) W ! S ORCONT=$$PGBRK,LINECNT=2 I ORCONT=1 W @IOF D COLHDR^ORSRCHOR
"RTN","OROVRRPT",86,0)
 Q LINECNT
"RTN","OROVRRPT",87,0)
 ;
"RTN","ORPEAPI")
0^25^B385487
"RTN","ORPEAPI",1,0)
ORPEAPI ;SLC/JMH - WRAPPERS FOR PHARMACY ENCAPSULATION;  ; Compiled April 17, 2006 09:44:11
"RTN","ORPEAPI",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORPEAPI",3,0)
NAME50(ORDRGIEN) ;
"RTN","ORPEAPI",4,0)
 N NAME
"RTN","ORPEAPI",5,0)
 D DATA^PSS50(ORDRGIEN,,,,,"ORLST")
"RTN","ORPEAPI",6,0)
 S NAME=$G(^TMP($J,"ORLST",ORDRGIEN,.01))
"RTN","ORPEAPI",7,0)
 K ^TMP($J,"ORLST")
"RTN","ORPEAPI",8,0)
 Q NAME
"RTN","ORPEAPI",9,0)
 ;
"RTN","ORPEAPI",10,0)
CLASS50(ORDRGIEN) ;
"RTN","ORPEAPI",11,0)
 N CLASS
"RTN","ORPEAPI",12,0)
 D DATA^PSS50(ORDRGIEN,,,,,"ORLST")
"RTN","ORPEAPI",13,0)
 S CLASS=$G(^TMP($J,"ORLST",ORDRGIEN,2))
"RTN","ORPEAPI",14,0)
 K ^TMP($J,"ORLST")
"RTN","ORPEAPI",15,0)
 Q CLASS
"RTN","ORPEAPI",16,0)
 Q
"RTN","ORPEAPI",17,0)
 ;
"RTN","ORPRF")
0^34^B13135968
"RTN","ORPRF",1,0)
ORPRF ;SLC/JLI-Patient record flag ;6/14/06
"RTN","ORPRF",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**173,187,190,215,243**;Dec 17, 1997;Build 242
"RTN","ORPRF",3,0)
 ;
"RTN","ORPRF",4,0)
FMT(ROOT) ; Format - Convert record flag data to displayable data
"RTN","ORPRF",5,0)
 ; Sets ^TMP("ORPRF",$J,NN) with flag data for multiple flags
"RTN","ORPRF",6,0)
 N IDX,IX,CNT
"RTN","ORPRF",7,0)
 S (IDX,CNT)=0
"RTN","ORPRF",8,0)
 F  S IDX=$O(ROOT(IDX)) Q:'IDX  D
"RTN","ORPRF",9,0)
 . S ^TMP("ORPRF",$J,IDX,"FLAG")=$P($G(ROOT(IDX,"FLAG")),U,2)
"RTN","ORPRF",10,0)
 . S ^TMP("ORPRF",$J,IDX,"CATEGORY")=$P($G(ROOT(IDX,"CATEGORY")),U,2)
"RTN","ORPRF",11,0)
 . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)="Flag Name:               "_$P($G(ROOT(IDX,"FLAG")),U,2)
"RTN","ORPRF",12,0)
 . I $D(ROOT(IDX,"NARR")) D
"RTN","ORPRF",13,0)
 . . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)="            "
"RTN","ORPRF",14,0)
 . . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)="Assignment Narrative:   "
"RTN","ORPRF",15,0)
 . . S IX=0 F  S IX=$O(ROOT(IDX,"NARR",IX)) Q:'IX  D
"RTN","ORPRF",16,0)
 . . . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)=$G(ROOT(IDX,"NARR",IX,0))
"RTN","ORPRF",17,0)
 . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)="            "
"RTN","ORPRF",18,0)
 . ; -- Assignment Details:
"RTN","ORPRF",19,0)
 . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)="Flag Type:               "_$P($G(ROOT(IDX,"FLAGTYPE")),U,2)
"RTN","ORPRF",20,0)
 . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)="Flag Category:           "_$P($G(ROOT(IDX,"CATEGORY")),U,2)
"RTN","ORPRF",21,0)
 . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)="Assignment Status:       "_"Active"
"RTN","ORPRF",22,0)
 . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)="Initial Assigned Date:   "_$P($G(ROOT(IDX,"ASSIGNDT")),U,2)
"RTN","ORPRF",23,0)
 . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)="Approved by:             "_$P($G(ROOT(IDX,"APPRVBY")),U,2)
"RTN","ORPRF",24,0)
 . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)="Next Review Date:        "_$P($G(ROOT(IDX,"REVIEWDT")),U,2)
"RTN","ORPRF",25,0)
 . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)="Owner Site:              "_$P($G(ROOT(IDX,"OWNER")),U,2)
"RTN","ORPRF",26,0)
 . S CNT=CNT+1,^TMP("ORPRF",$J,IDX,CNT)="Originating Site:        "_$P($G(ROOT(IDX,"ORIGSITE")),U,2)
"RTN","ORPRF",27,0)
 K ROOT
"RTN","ORPRF",28,0)
 Q
"RTN","ORPRF",29,0)
 ;
"RTN","ORPRF",30,0)
HASFLG(ORY,PTDFN) ;Does patient PTDFN has flags
"RTN","ORPRF",31,0)
 ;     DBIA 3860: $$GETACT^DGPFAPI(PTDFN,.FLGDATA)
"RTN","ORPRF",32,0)
 ; Returns array ORY listing active assigned flags
"RTN","ORPRF",33,0)
 ; Array ORY has form:
"RTN","ORPRF",34,0)
 ;   ORY(flagID) = flagID^flagname,CAT1
"RTN","ORPRF",35,0)
 ;      where CAT1 is 1 if flag is cat 1, 0 if cat 2
"RTN","ORPRF",36,0)
 ; ORY = Num of items returned in array ORY = num of flags
"RTN","ORPRF",37,0)
 I '$L($TEXT(GETACT^DGPFAPI)) S ORY=0 Q
"RTN","ORPRF",38,0)
 N IDY,PRFARR,CAT1
"RTN","ORPRF",39,0)
 K ^TMP("ORPRF",$J)
"RTN","ORPRF",40,0)
 S ORY=$$GETACT^DGPFAPI(PTDFN,"PRFARR")
"RTN","ORPRF",41,0)
 Q:'ORY
"RTN","ORPRF",42,0)
 D FMT(.@("PRFARR")) ; Sets ^TMP("ORPRF"
"RTN","ORPRF",43,0)
 S IDY=0 F  S IDY=$O(^TMP("ORPRF",$J,IDY)) Q:'IDY  D
"RTN","ORPRF",44,0)
 . S ORY(IDY)=IDY_U_$G(^TMP("ORPRF",$J,IDY,"FLAG"))
"RTN","ORPRF",45,0)
 . S CAT1=0
"RTN","ORPRF",46,0)
 . I $G(^TMP("ORPRF",$J,IDY,"CATEGORY"))="I (NATIONAL)" S CAT1=1
"RTN","ORPRF",47,0)
 . S ORY(IDY)=ORY(IDY)_U_CAT1
"RTN","ORPRF",48,0)
 Q
"RTN","ORPRF",49,0)
 ;
"RTN","ORPRF",50,0)
HASFLG1(ORY,PTDFN) ; Does patient PTDFN have **Cat I** flags
"RTN","ORPRF",51,0)
 ; Returns array ORY listing active assigned Cat I flags
"RTN","ORPRF",52,0)
 ; Array ORY has form:
"RTN","ORPRF",53,0)
 ;   ORY(flagID) = flagID^flagname
"RTN","ORPRF",54,0)
 ; ORY = Num of Cat I flags
"RTN","ORPRF",55,0)
 ;   If pt has no Cat I flags ORY = 0 and no flags are returned.
"RTN","ORPRF",56,0)
 ; Also calls FMT^ORPRF, which sets ^TMP("ORPRF" for Cat I flags
"RTN","ORPRF",57,0)
 ;  
"RTN","ORPRF",58,0)
 I '$L($TEXT(GETACT^DGPFAPI)) S ORY=0 Q
"RTN","ORPRF",59,0)
 N FLAGID,PRFARR,CAT1CNT,ACTFLGS
"RTN","ORPRF",60,0)
 K ^TMP("ORPRF",$J)
"RTN","ORPRF",61,0)
 S ACTFLGS=$$GETACT^DGPFAPI(PTDFN,"PRFARR")
"RTN","ORPRF",62,0)
 I 'ACTFLGS S ORY=0 Q
"RTN","ORPRF",63,0)
 S (FLAGID,CAT1CNT)=0
"RTN","ORPRF",64,0)
 F  S FLAGID=$O(PRFARR(FLAGID)) Q:'FLAGID  D
"RTN","ORPRF",65,0)
 . I $P($G(PRFARR(FLAGID,"CATEGORY"))," ")="I" S CAT1CNT=CAT1CNT+1 Q
"RTN","ORPRF",66,0)
 . K PRFARR(FLAGID)
"RTN","ORPRF",67,0)
 I 'CAT1CNT S ORY=0 Q
"RTN","ORPRF",68,0)
 D FMT(.@("PRFARR"))
"RTN","ORPRF",69,0)
 S IDY=0 F  S IDY=$O(^TMP("ORPRF",$J,IDY)) Q:'IDY  D
"RTN","ORPRF",70,0)
 . S ORY(IDY)=IDY_U_$G(^TMP("ORPRF",$J,IDY,"FLAG"))
"RTN","ORPRF",71,0)
 S ORY=CAT1CNT
"RTN","ORPRF",72,0)
 Q
"RTN","ORPRF",73,0)
 ;
"RTN","ORPRF",74,0)
HASCAT1(HASCAT1,PTDFN) ;Does patient have Category I flags (no arrays)
"RTN","ORPRF",75,0)
 ; Returns boolean HASCAT1 = 0 or 1
"RTN","ORPRF",76,0)
 ; Does NOT set arrays or TMP globals
"RTN","ORPRF",77,0)
 N FLAGID,PRFARR,ACTFLGS
"RTN","ORPRF",78,0)
 S (HASCAT1,FLAGID)=0
"RTN","ORPRF",79,0)
 S ACTFLGS=$$GETACT^DGPFAPI(PTDFN,"PRFARR") I 'ACTFLGS G HASCAT1X
"RTN","ORPRF",80,0)
 F  S FLAGID=$O(PRFARR(FLAGID)) Q:'FLAGID  D  Q:HASCAT1
"RTN","ORPRF",81,0)
 . I $P($G(PRFARR(FLAGID,"CATEGORY"))," ")="I" S HASCAT1=1
"RTN","ORPRF",82,0)
HASCAT1X ;
"RTN","ORPRF",83,0)
 Q
"RTN","ORPRF",84,0)
 ;
"RTN","ORPRF",85,0)
TRIGRPOP(POPUP,PTDFN) ;Should the flag display pop up upon patient selection
"RTN","ORPRF",86,0)
 ; for patient PTDFN?
"RTN","ORPRF",87,0)
 ;As of 1/10/06, returns POPUP as:
"RTN","ORPRF",88,0)
 ;   1 if pt has any active flags, either Cat I or Cat II
"RTN","ORPRF",89,0)
 ;   0 otherwise
"RTN","ORPRF",90,0)
 N PRFARR
"RTN","ORPRF",91,0)
 S POPUP=$S($$GETACT^DGPFAPI(PTDFN,"PRFARR"):1,1:0)
"RTN","ORPRF",92,0)
 Q
"RTN","ORPRF",93,0)
 ;
"RTN","ORPRF",94,0)
GETFLG(ORY,PTDFN,FLAGID) ;Return detailed flag info for flag FLAGID
"RTN","ORPRF",95,0)
 I '$D(^TMP("ORPRF",$J,FLAGID)) Q
"RTN","ORPRF",96,0)
 N IX,CNT
"RTN","ORPRF",97,0)
 S (IX,CNT)=0
"RTN","ORPRF",98,0)
 F  S IX=$O(^TMP("ORPRF",$J,FLAGID,IX)) Q:'IX  D
"RTN","ORPRF",99,0)
 . S CNT=CNT+1,ORY(CNT)=$G(^TMP("ORPRF",$J,FLAGID,IX))
"RTN","ORPRF",100,0)
 Q
"RTN","ORPRF",101,0)
 ;
"RTN","ORPRF",102,0)
CLEAR(ORY) ;Clear up the temp global
"RTN","ORPRF",103,0)
 K ^TMP("ORPRF",$J)
"RTN","ORPRF",104,0)
 Q
"RTN","ORPRF",105,0)
 ;
"RTN","ORPRPM")
0^13^B62635453
"RTN","ORPRPM",1,0)
ORPRPM ;DAN/SLC Performance Measure; ;4/8/04  10:20
"RTN","ORPRPM",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**107,114,119,196,190,243**;Dec 17, 1997;Build 242
"RTN","ORPRPM",3,0)
 ;
"RTN","ORPRPM",4,0)
 ;DBIA SECTION
"RTN","ORPRPM",5,0)
 ;4195 - EN^PSOTPCUL
"RTN","ORPRPM",6,0)
 ;
"RTN","ORPRPM",7,0)
 ;This routine will print a report indicating the percent of
"RTN","ORPRPM",8,0)
 ;orders entered for a provider by a provider holding the ORES key.
"RTN","ORPRPM",9,0)
 ;The data for the report will be stored in ^TMP as follows:
"RTN","ORPRPM",10,0)
 ;^TMP($J,"SUM",Provider Name,Patient Status)=Total # of order (universe)^Denominator^Numerator^Verbal^Written^Telephone^Policy^Electronically entered^Student entered^Outpatient narcotic orders
"RTN","ORPRPM",11,0)
 ;Where Patient Status is I for inpatient or O for outpatient.
"RTN","ORPRPM",12,0)
 ;
"RTN","ORPRPM",13,0)
 N DIR,ORSD,ORED,ORPROV,ORTYPE,ORPT,ORREP,ORPIECE,Y,DIRUT,DUOUT,DTOUT,ZTRTN,ORDT,ORIEN,ORACT0,ORPVID,PG,REPDT,ORSTOP,ORI,ORJ,ORPAT,ORTOT,ORSTOT,X,ORPVNM,ORORD,ORPTST,ORP,ORWROTE,ORNS,ORFS,ORPFILE
"RTN","ORPRPM",14,0)
 D GETDATE K DIR Q:$D(DIRUT)  ;quit if no dates selected ;get start and end dates
"RTN","ORPRPM",15,0)
 D GETPROV K DIR Q:'$D(ORPROV)!($G(ORPROV)'="ALL"&($D(ORPROV)'=11))!($D(DUOUT))!($D(DTOUT))  ;quit if user didn't select all providers or if didn't choose individual providers or if user timed out or up-arrowed out
"RTN","ORPRPM",16,0)
 D GETOTHER Q:$D(DIRUT)  ;quit if any questions were unanswered in this section
"RTN","ORPRPM",17,0)
 I DUZ=1395 D DQ Q
"RTN","ORPRPM",18,0)
 S ZTRTN="DQ^ORPRPM" D QUE^ORUTL1(ZTRTN,"CPRS Performance Monitor")
"RTN","ORPRPM",19,0)
 Q
"RTN","ORPRPM",20,0)
 ;
"RTN","ORPRPM",21,0)
GETDATE ;Prompt for start and end dates
"RTN","ORPRPM",22,0)
 S DIR(0)="DO^:DT:AE",DIR("A")="Enter starting date",DIR("?")="Enter date to begin searching from" D ^DIR Q:$D(DIRUT)  S ORSD=Y
"RTN","ORPRPM",23,0)
 S DIR(0)="DOA^"_ORSD_":DT:AE",DIR("A")="Enter ending date: ",DIR("?")="Enter date to stop searching.  Must be between "_$$FMTE^XLFDT(ORSD,2)_" and "_$$FMTE^XLFDT(DT,2) D ^DIR Q:$D(DIRUT)
"RTN","ORPRPM",24,0)
 S ORED=Y_.24,ORSD=ORSD-.1 ;Set end date to end of day, start date back to include current day
"RTN","ORPRPM",25,0)
 Q  ;End GETDATE
"RTN","ORPRPM",26,0)
 ;
"RTN","ORPRPM",27,0)
GETPROV ;Allow selection of all/single/multiple providers
"RTN","ORPRPM",28,0)
 ;return ORPROV="ALL" for all providers or ORPROV array for individual providers
"RTN","ORPRPM",29,0)
 S DIR(0)="Y",DIR("A")="Do you want ALL providers to appear on this report",DIR("B")="Y",DIR("?")="Enter Yes to search for all providers.  Enter No to select individual providers"  D ^DIR Q:$D(DIRUT)  S ORPROV=$S(Y=1:"ALL",1:"") Q:ORPROV="ALL"
"RTN","ORPRPM",30,0)
 K DIR ;clear DIR variables before getting individual providers
"RTN","ORPRPM",31,0)
 F  D  Q:$D(DIRUT)  ;quit when finished selecting
"RTN","ORPRPM",32,0)
 .S DIR(0)="PO^200:AEQM",DIR("S")="I $D(^VA(200,""AK.PROVIDER"",$P(^(0),U)))",DIR("A")="Select "_$S($D(ORPROV)=11:"another ",1:"")_"provider"
"RTN","ORPRPM",33,0)
 .S DIR("?")="Select providers to appear on report.  Return when finished, ^ to stop processing" D ^DIR Q:$D(DIRUT)  S ORPROV(+Y)=""
"RTN","ORPRPM",34,0)
 Q  ;End GETPROV
"RTN","ORPRPM",35,0)
 ;
"RTN","ORPRPM",36,0)
GETOTHER ;Get order type, patient type, and summary only report response
"RTN","ORPRPM",37,0)
 ;Get order type first
"RTN","ORPRPM",38,0)
 S DIR(0)="S^A:All orders;P:Pharmacy orders only",DIR("A")="Select order category",DIR("B")="P",DIR("?")="Enter P to see pharmacy orders only.  Enter A to see all orders. Enter ^ to quit" D ^DIR Q:$D(DIRUT)  S ORTYPE=Y
"RTN","ORPRPM",39,0)
 K DIR
"RTN","ORPRPM",40,0)
 ;Get patient status
"RTN","ORPRPM",41,0)
 S DIR(0)="S^I:Inpatient;O:Outpatient;B:Both",DIR("A")="Select patient status",DIR("B")="B",DIR("?")="Enter patient status at time of order.  Enter ^ to quit" D ^DIR Q:$D(DIRUT)  S ORPT=Y
"RTN","ORPRPM",42,0)
 K DIR
"RTN","ORPRPM",43,0)
 ;Ask if user desires facility subtotal, summary, detail, or both (detail and summary) reports
"RTN","ORPRPM",44,0)
 S DIR(0)="S^S:Summary (includes provider details);D:Detail (includes order details);B:Both (Summary & Detail);T:Summary Report Totals Only (no provider details)",DIR("A")="Select report",DIR("B")="S"
"RTN","ORPRPM",45,0)
 D ^DIR Q:$D(DIRUT)  S ORREP=Y,ORFS=0 I Y="T" S ORREP="S",ORFS=1
"RTN","ORPRPM",46,0)
 K DIR
"RTN","ORPRPM",47,0)
 Q  ;End GETOTHER
"RTN","ORPRPM",48,0)
 ;
"RTN","ORPRPM",49,0)
DQ ;Come here to do build and print from QUE^ORUTL either direct or tasked
"RTN","ORPRPM",50,0)
 U IO K ^TMP($J) ;clean out temp space
"RTN","ORPRPM",51,0)
 S ORDT=ORSD F  S ORDT=$O(^OR(100,"AF",ORDT)) Q:'ORDT!(ORDT>ORED)  S ORIEN="" F  S ORIEN=$O(^OR(100,"AF",ORDT,ORIEN)) Q:'ORIEN  I $O(^OR(100,"AF",ORDT,ORIEN,0))=1 I $D(^OR(100,ORIEN,8,1,0)) D CHECK
"RTN","ORPRPM",52,0)
 D PRINT^ORPRPM1
"RTN","ORPRPM",53,0)
 K ^TMP($J)
"RTN","ORPRPM",54,0)
 Q
"RTN","ORPRPM",55,0)
 ;
"RTN","ORPRPM",56,0)
CHECK ;If order matches requirements then save
"RTN","ORPRPM",57,0)
 S ORPFILE=$P($G(^OR(100,ORIEN,0)),"^",2) Q:ORPFILE=""  ;Quit if no object of order
"RTN","ORPRPM",58,0)
 I $P(ORPFILE,";",2)["DPT" Q:$P($G(^DPT(+$P($G(^OR(100,ORIEN,0)),"^",2),0)),"^",21)  ;Quit if test patient
"RTN","ORPRPM",59,0)
 Q:+$P($G(^OR(100,ORIEN,3)),"^",11)'=0  ;190 quit if order type not standard
"RTN","ORPRPM",60,0)
 S ORPTST=$P($G(^OR(100,ORIEN,0)),"^",12) ;patient status (in/out)
"RTN","ORPRPM",61,0)
 I ORPT'="B" Q:ORPTST'=ORPT  ;Quit if patient status is not 'both' and status doesn't match selected status
"RTN","ORPRPM",62,0)
 S ORNS=$$NMSP^ORCD($P($G(^OR(100,ORIEN,0)),"^",14))
"RTN","ORPRPM",63,0)
 I ORTYPE'="A"&(ORNS'="PS") Q  ;if not getting all types of orders then quit if order is not from pharmacy
"RTN","ORPRPM",64,0)
 I ORPTST="O",ORNS="PS",$G(^OR(100,ORIEN,4))=+$G(^OR(100,ORIEN,4)),$L($T(EN^PSOTPCUL)) Q:$$EN^PSOTPCUL($G(^OR(100,ORIEN,4)))  ;196 Don't count if outpatient pharm order is a transitional pharmacy benefit order
"RTN","ORPRPM",65,0)
 S ORACT0=$G(^OR(100,ORIEN,8,1,0)),ORORD=$P(ORACT0,"^",12) ;ORORD holds nature of order ien
"RTN","ORPRPM",66,0)
 S ORPVID=$P(ORACT0,"^",3) I ORPROV'="ALL" Q:'$D(ORPROV(ORPVID))  ;quit if ordering provider doesn't match user selected provider
"RTN","ORPRPM",67,0)
 S ORPVNM=$P($G(^VA(200,ORPVID,0)),"^") ;get provider name
"RTN","ORPRPM",68,0)
 Q:'$D(^XUSEC("ORES",ORPVID))  ;quit if ordering provider doesn't have ORES key DBIA # 10076 allows direct read of XUSEC
"RTN","ORPRPM",69,0)
 Q:"^1^2^3^5^8^"'[("^"_ORORD_"^")  ;quit if NATURE OF ORDER is not verbal, written, telephoned, policy, or electronically entered
"RTN","ORPRPM",70,0)
 D COUNT ;Count order
"RTN","ORPRPM",71,0)
 Q
"RTN","ORPRPM",72,0)
 ;
"RTN","ORPRPM",73,0)
COUNT ;This section determines how the order should be counted
"RTN","ORPRPM",74,0)
 N OREB,ORPIECE
"RTN","ORPRPM",75,0)
 D ADD(1) ;Add one to universe (total # of orders)
"RTN","ORPRPM",76,0)
 S OREB=$P(ORACT0,"^",13) ;Entered by
"RTN","ORPRPM",77,0)
 S ^TMP($J,"DET",ORPVNM,ORIEN)=$D(^XUSEC("ORES",OREB))&(OREB=ORPVID) ;Mark "HAS ORES" column for detailed listing if entered by = provider and has ORES key
"RTN","ORPRPM",78,0)
 I OREB=ORPVID D ADD(2),ADD(3) Q  ;if order entered by provider then add one to denominator and numerator
"RTN","ORPRPM",79,0)
 I ORNS="PS" I $$OIDEA=1 D ADD(10) Q  ;If order requires wet signature add one to narcotic group
"RTN","ORPRPM",80,0)
 I $$STUDENT D ADD(9) Q  ;If order entered by student add one to student group
"RTN","ORPRPM",81,0)
 S ORPIECE=$S(ORORD=1:4,ORORD=2:5,ORORD=3:6,ORORD=8:7,1:8) D ADD(ORPIECE) ;add to exceptions group for orders not entered by provider
"RTN","ORPRPM",82,0)
 I ORORD'=5 D ADD(2) ;Add to denominator if not policy order
"RTN","ORPRPM",83,0)
 Q
"RTN","ORPRPM",84,0)
 ;
"RTN","ORPRPM",85,0)
ADD(PIECE) ;Add one to storage
"RTN","ORPRPM",86,0)
 S $P(^TMP($J,"SUM",ORPVNM,ORPTST),"^",PIECE)=$P($G(^TMP($J,"SUM",ORPVNM,ORPTST)),"^",PIECE)+1 Q
"RTN","ORPRPM",87,0)
 ;
"RTN","ORPRPM",88,0)
OIDEA() ;Check to see if pharmacy order requires wet signature
"RTN","ORPRPM",89,0)
 ;dbia 3373 allows call to pharmacy API or dbia 221 allows direct read of ^PSDRUG if routine doesn't exist yet
"RTN","ORPRPM",90,0)
 N OI,PSOI,SIGREQ,PSSXOLP,PSSXOLPD,PSSXOLPX,PSSXNODD,PSSPKLX
"RTN","ORPRPM",91,0)
 Q:ORPTST'="O" 0 ;quit if inpatient
"RTN","ORPRPM",92,0)
 S OI=$$VALUE^ORX8(ORIEN,"ORDERABLE") ;get orderable item
"RTN","ORPRPM",93,0)
 S PSOI=+$P($G(^ORD(101.43,+OI,0)),U,2) I PSOI'>0 Q 0 ;quit if no pharmacy orderable item
"RTN","ORPRPM",94,0)
 I $L($T(OIDEA^PSSUTLA1)) S SIGREQ=$$OIDEA^PSSUTLA1(PSOI,"O") Q:SIGREQ=1 1 Q 0 ;If SIGREQ = 1 then wet signature required
"RTN","ORPRPM",95,0)
 S (PSSXOLPD,PSSXNODD)=0
"RTN","ORPRPM",96,0)
 S PSSPKLX=0
"RTN","ORPRPM",97,0)
 K ^TMP($J,"ORPRPM ASP")
"RTN","ORPRPM",98,0)
 D ASP^PSS50(PSOI,,,"ORPRPM ASP")
"RTN","ORPRPM",99,0)
 F PSSXOLP=0:0 S PSSXOLP=$O(^TMP($J,"ORPRPM ASP","")) Q:'PSSXOLP!(PSSXOLPD=1)  D
"RTN","ORPRPM",100,0)
 .K ^TMP($J,"ORPRPM DATA") D DATA^PSS50(PSSXOLP,,(DT-1),,,"ORPRPM DATA") I +^TMP($J,"ORPRPM DATA",0)<0 Q
"RTN","ORPRPM",101,0)
 .I 'PSSPKLX,$G(^TMP($J,"ORPRPM DATA",63))'["O" K ^TMP($J,"ORPRPM DATA") Q
"RTN","ORPRPM",102,0)
 .I PSSPKLX I $G(^TMP($J,"ORPRPM DATA",63))'["U",$G(^TMP($J,"ORPRPM DATA",63))'["I" Q
"RTN","ORPRPM",103,0)
 .S PSSXNODD=1
"RTN","ORPRPM",104,0)
 .S PSSXOLPX=$G(^TMP($J,"ORPRPM DATA",3))
"RTN","ORPRPM",105,0)
 .I PSSXOLPX[1!(PSSXOLPX[2)!((PSSXOLPX[3)&(PSSXOLPX["A")) S PSSXOLPD=1 Q
"RTN","ORPRPM",106,0)
 .I PSSXOLPX[3!(PSSXOLPX[4)!(PSSXOLPX[5) S PSSXOLPD=2
"RTN","ORPRPM",107,0)
 I PSSXOLPD=0,'PSSXNODD S PSSXOLPD=""
"RTN","ORPRPM",108,0)
 K ^TMP($J,"ORPRPM ASP")
"RTN","ORPRPM",109,0)
 K ^TMP($J,"ORPRPM DATA")
"RTN","ORPRPM",110,0)
 Q PSSXOLPD
"RTN","ORPRPM",111,0)
 ;
"RTN","ORPRPM",112,0)
STUDENT() ;Check to see if entered by is a student
"RTN","ORPRPM",113,0)
 ;Check USER CLASS for membership in "STUDENT" CLASS - DBIA 2324
"RTN","ORPRPM",114,0)
 ;Then check PROVIDER CLASS in NEW PERSON file for "STUDENT" - DBIA 10060
"RTN","ORPRPM",115,0)
 N ORCLASS,ORSUB,EXPIRE,ORUSR
"RTN","ORPRPM",116,0)
 D WHATIS^USRLM(OREB,"ORCLASS") ;API to get user class membership
"RTN","ORPRPM",117,0)
 S ORSUB=0,ORUSR=0 F  S ORSUB=$O(ORCLASS(ORSUB)) Q:ORSUB=""!ORUSR  D
"RTN","ORPRPM",118,0)
 .I $$UP^XLFSTR(ORSUB)'["STUDENT" Q  ;User not a member of student class
"RTN","ORPRPM",119,0)
 .I ORDT'<+$P(ORCLASS(ORSUB),"^",4) S EXPIRE=$S(+$P(ORCLASS(ORSUB),"^",5):$P(ORCLASS(ORSUB),"^",5),1:9999999) I ORDT'>EXPIRE S ORUSR=1 ;member of student class and within date range for class
"RTN","ORPRPM",120,0)
 I ORUSR Q 1 ;User identified as a student
"RTN","ORPRPM",121,0)
 K ORCLASS
"RTN","ORPRPM",122,0)
 S DIC=200,DR=53.5,DA=OREB,DIQ="ORCLASS",DIQ(0)="E" D EN^DIQ1
"RTN","ORPRPM",123,0)
 I $G(ORCLASS(200,OREB,53.5,"E"))["STUDENT" Q 1 ;Provider class set to student
"RTN","ORPRPM",124,0)
 Q 0 ;User not a student
"RTN","ORQ11")
0^140^B63884857
"RTN","ORQ11",1,0)
ORQ11 ;slc/dcm-Get patient orders in context ;3/31/04  09:57
"RTN","ORQ11",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,27,48,72,78,99,94,148,141,177,186,190,195,215,243**;Dec 17, 1997;Build 242
"RTN","ORQ11",3,0)
LOOP ; -- main loop through "ACT" x-ref
"RTN","ORQ11",4,0)
 I $G(XREF)="AW" D AW Q
"RTN","ORQ11",5,0)
 I $G(FLG)=27 D EXPD^ORQ12 Q
"RTN","ORQ11",6,0)
 K ^TMP("ORGOTIT",$J)
"RTN","ORQ11",7,0)
AWIN ;Jump in here to add active orders to AW context
"RTN","ORQ11",8,0)
 N TM,TO,IFN,X0,X3,X7,X8,USTS,NOW,ACTOR,X ;195
"RTN","ORQ11",9,0)
 S NOW=+$E($$NOW^XLFDT,1,12),TM=SDATE
"RTN","ORQ11",10,0)
 F  S TM=$O(^OR(100,"ACT",PAT,TM)) Q:'TM!(TM>EDATE)  S TO=0 F  S TO=$O(^OR(100,"ACT",PAT,TM,TO)) Q:'TO  I $D(ORGRP(TO)) D
"RTN","ORQ11",11,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"ACT",PAT,TM,TO,IFN)) Q:'IFN  I ('$D(^TMP("ORGOTIT",$J,IFN))!MULT),$D(^OR(100,IFN,0)),$D(^(3)) S X0=^(0),X3=^(3) D
"RTN","ORQ11",12,0)
 .. S ACTOR=0 F  S ACTOR=$O(^OR(100,"ACT",PAT,TM,TO,IFN,ACTOR)) Q:ACTOR<1  I '$D(^TMP("ORGOTIT",$J,IFN,ACTOR)),$D(^OR(100,IFN,8,ACTOR,0)),$P(^(0),U,15)'=13!(FLG=1) S X8=^(0),X7=$G(^(7)) D LP1
"RTN","ORQ11",13,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ11",14,0)
 Q
"RTN","ORQ11",15,0)
AW ; -- loop through "AW" x-ref
"RTN","ORQ11",16,0)
 K ^TMP("ORGOTIT",$J),^TMP("ORSORT",$J)
"RTN","ORQ11",17,0)
 N TM,TO,IFN,X0,X3,X7,X8,USTS,NOW,ACTOR,X ;195
"RTN","ORQ11",18,0)
 S NOW=+$E($$NOW^XLFDT,1,12),TO=0,SDATE=9999999-SDATE,EDATE=9999999-EDATE
"RTN","ORQ11",19,0)
 F  S TO=$O(^OR(100,"AW",PAT,TO)) Q:'TO  I $D(ORGRP(TO)) S TM=EDATE F  S TM=$O(^OR(100,"AW",PAT,TO,TM)) Q:'TM!(TM>SDATE)!(+TM<EDATE)  D
"RTN","ORQ11",20,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AW",PAT,TO,TM,IFN)) Q:'IFN  I ('$D(^TMP("ORGOTIT",$J,IFN))!MULT) D
"RTN","ORQ11",21,0)
 .. S ^TMP("ORSORT",$J,9999999-TM,TO,IFN)=""
"RTN","ORQ11",22,0)
 S TM=0 F  S TM=$O(^TMP("ORSORT",$J,TM)) Q:'TM  S TO=0 F  S TO=$O(^TMP("ORSORT",$J,TM,TO)) Q:'TO  D
"RTN","ORQ11",23,0)
 . S IFN=0 F  S IFN=$O(^TMP("ORSORT",$J,TM,TO,IFN)) Q:'IFN  I $D(^OR(100,IFN,0)),$D(^(3)) S X0=^(0),X3=^(3) D 
"RTN","ORQ11",24,0)
 .. S ACTOR=0 F  S ACTOR=$O(^OR(100,"ACT",PAT,9999999-$P(X0,U,7),TO,IFN,ACTOR)) Q:ACTOR<1  I '$D(^TMP("ORGOTIT",$J,IFN,ACTOR)),$D(^OR(100,IFN,8,ACTOR,0)),$P(^(0),U,15)'=13 S X8=^(0),X7=$G(^(7)) D LP1
"RTN","ORQ11",25,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ11",26,0)
 I +$$GET^XPAR("SYS","OR ORDER SUMMARY CONTEXT",1,"I")=2 S SDATE=9999999-SDATE,EDATE=9999999-EDATE D AWIN
"RTN","ORQ11",27,0)
 K ^TMP("ORSORT",$J),^TMP("ORGOTIT",$J)
"RTN","ORQ11",28,0)
 Q
"RTN","ORQ11",29,0)
LP1 ; -- main secondary loop
"RTN","ORQ11",30,0)
 N STS ;195
"RTN","ORQ11",31,0)
 N TAG
"RTN","ORQ11",32,0)
 Q:$P(X3,U,8)  Q:$P(X3,U,3)=99  S STS=$P(X3,U,3)
"RTN","ORQ11",33,0)
 I '$G(GETKID),$P(X3,U,9),'$P($G(^OR(100,$P(X3,U,9),3)),U,8),FLG'=11 Q
"RTN","ORQ11",34,0)
 I $L($P(X0,U,17)),"^10^11^"[(U_STS_U) S X=$$LAPSED^OREVNTX($P(X0,U,17))
"RTN","ORQ11",35,0)
 S TAG=$S(FLG=2:"CUR1",FLG=4:"COM1",FLG=5:"EXG1",FLG=7:"PEN1",FLG=8:"UVR1",FLG=9:"UVN1",FLG=10:"UVC1",FLG=12:"FLG1",FLG=13:"VP1",FLG=14:"VPU1",FLG=18:"HLD1",FLG=20:"CHT1",FLG=21:"CHTSUM",FLG=22:"LPS1",FLG=23:"AVT1",1:"ALL1")
"RTN","ORQ11",36,0)
 I TAG="ALL1" S TAG=$S(FLG=3:"DC1",FLG=28:"DC1",1:"ALL1")
"RTN","ORQ11",37,0)
 D @TAG
"RTN","ORQ11",38,0)
 Q
"RTN","ORQ11",39,0)
 ; ** FLG context specific loops:
"RTN","ORQ11",40,0)
 ;
"RTN","ORQ11",41,0)
ALL1 ; 1 -- secondary pass for All, Recent Orders, Unsigned
"RTN","ORQ11",42,0)
 D GET^ORQ12(IFN,ORLIST,DETAIL,$G(ACTOR))
"RTN","ORQ11",43,0)
 Q
"RTN","ORQ11",44,0)
 ;
"RTN","ORQ11",45,0)
CUR ; 2 -- Active/Current
"RTN","ORQ11",46,0)
 N X,X0,X1,X2,X3,X8,%H,YD,%,TM,IFN,ACTOR,NORX,OIEN,OACT
"RTN","ORQ11",47,0)
 I $G(GROUP)=$O(^ORD(100.98,"B","ALL SERVICES",0)),$G(ORWARD),$G(DGPMT)'=1 S NORX=$O(^ORD(100.98,"B","O RX",0)) ;K:X ORGRP(X) ; 177 screen out Outpt Meds if inpt
"RTN","ORQ11",48,0)
 S X2=+$$GET^XPAR("SYS","ORPF ACTIVE ORDERS CONTEXT HRS",1,"I"),X=$H,X=+X*24+($P(X,",",2)/3600),X1=X-X2,X3=X1#24,X1=X1\24,X2=$J(X3*3600,0,0),%H=X1_","_X2 D YMD^%DTC S YD=+(X_%)
"RTN","ORQ11",49,0)
 S TM=SDATE F  S TM=$O(^OR(100,"AC",PAT,TM)) Q:TM<1!(TM>EDATE)  S IFN=0 F  S IFN=$O(^OR(100,"AC",PAT,TM,IFN)) Q:IFN<1  I $D(^OR(100,IFN,0)),$D(^(3)) S X0=^(0),X3=^(3) D
"RTN","ORQ11",50,0)
 . Q:'$D(ORGRP($P(X0,U,11)))  S ACTOR=0
"RTN","ORQ11",51,0)
 . F  S ACTOR=$O(^OR(100,"AC",PAT,TM,IFN,ACTOR)) Q:ACTOR<1  I $D(^OR(100,IFN,8,ACTOR,0)) S X8=^(0) D
"RTN","ORQ11",52,0)
 .. I "^10^12^"[(U_$P(X8,U,15)_U) K ^OR(100,"AC",PAT,TM,IFN,ACTOR) Q
"RTN","ORQ11",53,0)
 .. I $P(X8,U,15)=13,$P(X8,U)<YD K ^OR(100,"AC",PAT,TM,IFN,ACTOR) Q
"RTN","ORQ11",54,0)
 .. I $P(X8,U,15)="",ACTOR'=$P(X3,U,7) K ^OR(100,"AC",PAT,TM,IFN,ACTOR) Q
"RTN","ORQ11",55,0)
 .. ;AGP waiting for approval change to remove duplicate orders for DC reason
"RTN","ORQ11",56,0)
 .. ;I ACTOR>0,$P($G(^OR(100,IFN,8,ACTOR,0)),U,2)="DC" S OIEN=IFN,OACT=ACTOR
"RTN","ORQ11",57,0)
 .. ;I OIEN=IFN,OACT>ACTOR K ^OR(100,"AC",PAT,TM,IFN,ACTOR) Q 
"RTN","ORQ11",58,0)
 .. D LP1
"RTN","ORQ11",59,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ11",60,0)
 Q
"RTN","ORQ11",61,0)
CUR1 ; 2 -- secondary pass for Active/Current
"RTN","ORQ11",62,0)
 N STOP S STOP=$P(X0,U,9)
"RTN","ORQ11",63,0)
 I STS=10 K ^OR(100,"AC",PAT,TM,IFN) Q  ;no delayed orders
"RTN","ORQ11",64,0)
 I $P(X8,U,4)=2,$P(X8,U,15)=11 G CURX ;incl all unsig/unrel actions
"RTN","ORQ11",65,0)
 I '$D(YD),"^1^2^7^12^13^14^"[(U_STS_U) K ^OR(100,"AC",PAT,TM,IFN) Q
"RTN","ORQ11",66,0)
 I $D(YD),"^1^2^7^12^13^14^"[(U_STS_U),STOP<YD K ^OR(100,"AC",PAT,TM,IFN) Q
"RTN","ORQ11",67,0)
 I $G(NORX),NORX=$P(X0,U,11) Q  ;skip Rx for inpatients
"RTN","ORQ11",68,0)
CURX D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",69,0)
 Q
"RTN","ORQ11",70,0)
 ;
"RTN","ORQ11",71,0)
DC1 ; 3 -- secondary pass for DC
"RTN","ORQ11",72,0)
 I FLG=28 D GETEIE^ORQ12(IFN,ORLIST,DETAIL,ACTOR) Q
"RTN","ORQ11",73,0)
 I STS=1!(STS=13)!(STS=12) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",74,0)
 Q
"RTN","ORQ11",75,0)
 ;
"RTN","ORQ11",76,0)
COM1 ; 4 -- secondary pass for Completed/Expired
"RTN","ORQ11",77,0)
 N STOP S STOP=$P(X0,U,9)
"RTN","ORQ11",78,0)
 I STS=2!(STS=7)!($L(STOP)&(STOP<NOW)&(STS'=1)&(STS'=13)&(STS'=12)) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",79,0)
 Q
"RTN","ORQ11",80,0)
 ;
"RTN","ORQ11",81,0)
EXG ; 5 -- Expiring
"RTN","ORQ11",82,0)
 N ORNG,ORDT,ORDW,ORHOL,X,Y,%DT,DIC,TMW,NOW ;195
"RTN","ORQ11",83,0)
 F ORNG=1:1 D  I ORHOL=0,ORDW=0 Q
"RTN","ORQ11",84,0)
 . S ORDT=$$FMADD^XLFDT(DT,ORNG),ORDW=$S($H-4+ORNG#7>4:1,1:0)
"RTN","ORQ11",85,0)
 . S DIC="^HOLIDAY(",X=$P(ORDT,".")
"RTN","ORQ11",86,0)
 . D ^DIC S ORHOL=$S(+$G(Y)>0:1,1:0)
"RTN","ORQ11",87,0)
 S %DT="",X="T+"_ORNG D ^%DT
"RTN","ORQ11",88,0)
 S TMW=Y_".9999",NOW=+$E($$NOW^XLFDT,1,12)
"RTN","ORQ11",89,0)
 D CUR ;D LOOP
"RTN","ORQ11",90,0)
 Q
"RTN","ORQ11",91,0)
EXG1 ; 5 -- secondary pass for Expiring
"RTN","ORQ11",92,0)
 N STOP S STOP=$P(X0,U,9)
"RTN","ORQ11",93,0)
 I STS'=1,STS'=2,STS'=7,STS'>9,STOP>NOW,STOP'>TMW D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",94,0)
 Q
"RTN","ORQ11",95,0)
 ;
"RTN","ORQ11",96,0)
ACT ; 6 -- Recent Activity (Order Summary)
"RTN","ORQ11",97,0)
 ;N ORLSIGN S ORLSIGN=$$GET^XPAR("ALL","OR ORDER REVIEW DT","`"_+PAT,"Q")
"RTN","ORQ11",98,0)
 N TM,IFN,X0,X3,ACTOR,X8
"RTN","ORQ11",99,0)
 S TM=SDATE F  S TM=$O(^OR(100,"AR",PAT,TM)) Q:TM<1!(TM>EDATE)  D
"RTN","ORQ11",100,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AR",PAT,TM,IFN)) Q:IFN<1  S X0=$G(^OR(100,IFN,0)),X3=$G(^(3)) I $D(ORGRP(+$P(X0,U,11))) D
"RTN","ORQ11",101,0)
 .. S ACTOR=0 F  S ACTOR=$O(^OR(100,"AR",PAT,TM,IFN,ACTOR)) Q:ACTOR<1  I $D(^OR(100,IFN,8,ACTOR,0)),$P(^(0),U,15)'=13 S X8=^(0) D LP1
"RTN","ORQ11",102,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ11",103,0)
 Q
"RTN","ORQ11",104,0)
 ;
"RTN","ORQ11",105,0)
PEN1 ; 7 -- secondary pass for Pending
"RTN","ORQ11",106,0)
 I STS=5 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",107,0)
 Q
"RTN","ORQ11",108,0)
 ;
"RTN","ORQ11",109,0)
UVR1 ; 8 -- secondary pass for Unverified
"RTN","ORQ11",110,0)
 ;      Include if: unverified, released, inpt, not repl/canc/lapsed
"RTN","ORQ11",111,0)
 I '$P(X8,U,9),'$P(X8,U,11),$P(X8,U,15)="",$$INPT,"^12^13^14^"'[(U_STS_U) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",112,0)
 Q
"RTN","ORQ11",113,0)
 ;
"RTN","ORQ11",114,0)
UVN1 ; 9 -- secondary pass for Unverified/Nurse
"RTN","ORQ11",115,0)
 ;      Include if: unverified, released, inpt, not repl/canc/lapsed
"RTN","ORQ11",116,0)
 I '$P(X8,U,9),$P(X8,U,15)="",$$INPT,"^12^13^14^"'[(U_STS_U) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",117,0)
 Q
"RTN","ORQ11",118,0)
 ;
"RTN","ORQ11",119,0)
UVC1 ; 10 -- secondary pass for Unverified/Clerk
"RTN","ORQ11",120,0)
 ;       Include if: unverified, released, inpt, not repl/canc/lapsed
"RTN","ORQ11",121,0)
 I '$P(X8,U,11),$P(X8,U,15)="",$$INPT,"^12^13^14^"'[(U_STS_U) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",122,0)
 Q
"RTN","ORQ11",123,0)
 ;
"RTN","ORQ11",124,0)
INPT() ; -- Returns 1 or 0, if inpt order using X0=^OR(100,IFN,0)
"RTN","ORQ11",125,0)
 I ($P(X0,U,12)="I")!($$TYPE^OREVNTX($P(X0,U,17))="D") Q 1
"RTN","ORQ11",126,0)
 ;I $P($G(^SC(+$P(X0,U,10),0)),U,3)="W" Q 1
"RTN","ORQ11",127,0)
 Q 0
"RTN","ORQ11",128,0)
 ;
"RTN","ORQ11",129,0)
SIG ; 11 -- Unsigned
"RTN","ORQ11",130,0)
 N TM,IFN,X0,X3,ACTOR S TM=SDATE
"RTN","ORQ11",131,0)
 F  S TM=$O(^OR(100,"AS",PAT,TM)) Q:TM<1!(TM>EDATE)  S IFN=0 F  S IFN=$O(^OR(100,"AS",PAT,TM,IFN)) Q:IFN<1  D
"RTN","ORQ11",132,0)
 . S X0=$G(^OR(100,IFN,0)),X3=$G(^(3))
"RTN","ORQ11",133,0)
 . I X0="" K ^OR(100,"AS",PAT,TM,IFN) Q  ;deleted
"RTN","ORQ11",134,0)
 . Q:'$D(ORGRP(+$P(X0,U,11)))  ;not a selected DispGrp
"RTN","ORQ11",135,0)
 . S ACTOR=0 F  S ACTOR=$O(^OR(100,"AS",PAT,TM,IFN,ACTOR)) Q:ACTOR<1  D
"RTN","ORQ11",136,0)
 .. I $P($G(^OR(100,IFN,8,ACTOR,0)),U,4)'=2 K ^OR(100,"AS",PAT,TM,IFN,ACTOR) Q  ;signed or deleted
"RTN","ORQ11",137,0)
 .. D LP1
"RTN","ORQ11",138,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ11",139,0)
 Q
"RTN","ORQ11",140,0)
 ;
"RTN","ORQ11",141,0)
FLG1 ; 12 -- secondary pass for Flagged
"RTN","ORQ11",142,0)
 I +$G(^OR(100,IFN,8,ACTOR,3)) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",143,0)
 Q
"RTN","ORQ11",144,0)
 ;
"RTN","ORQ11",145,0)
VP1 ; 13 -- secondary pass for Verbal/Phone
"RTN","ORQ11",146,0)
 N ORNATR S ORNATR=$P(X8,U,12)
"RTN","ORQ11",147,0)
 I ORNATR,"PV"[$P($G(^ORD(100.02,+ORNATR,0)),U,2) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR) ;STS'=12
"RTN","ORQ11",148,0)
 Q
"RTN","ORQ11",149,0)
 ;
"RTN","ORQ11",150,0)
VPU1 ; 14 -- secondary pass for Verbal/Phone Unsigned
"RTN","ORQ11",151,0)
 N ORNATR S ORNATR=$P(X8,U,12)
"RTN","ORQ11",152,0)
 I ORNATR,"PV"[$P($G(^ORD(100.02,+ORNATR,0)),U,2),'$P(X8,U,5),$P(X8,U,4)=2 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR) ;STS'=12
"RTN","ORQ11",153,0)
 Q
"RTN","ORQ11",154,0)
 ;
"RTN","ORQ11",155,0)
HLD1 ; 18 -- secondary pass for On Hold
"RTN","ORQ11",156,0)
 I STS=3 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",157,0)
 Q
"RTN","ORQ11",158,0)
 ;
"RTN","ORQ11",159,0)
NEW ; 19 -- New Orders, plus other unsigned orders by current provider
"RTN","ORQ11",160,0)
 N IFN,ACTOR,TM,X0,X3,X8,ORENT,ORPAR
"RTN","ORQ11",161,0)
 S IFN=0 F  S IFN=$O(^TMP("ORNEW",$J,IFN)) Q:IFN'>0  D  ;New orders
"RTN","ORQ11",162,0)
 . S ACTOR=0 F  S ACTOR=$O(^TMP("ORNEW",$J,IFN,ACTOR)) Q:ACTOR'>0  D
"RTN","ORQ11",163,0)
 .. Q:'$D(^OR(100,IFN,0))  Q:'$D(^(8,ACTOR,0))  ;deleted
"RTN","ORQ11",164,0)
 .. D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",165,0)
 G:'$D(^XUSEC("ORES",DUZ)) NW1 ;ck parameter for add'l orders
"RTN","ORQ11",166,0)
 S ORENT="ALL"_$S($G(^VA(200,DUZ,5)):"^SRV.`"_+^(5),1:"")
"RTN","ORQ11",167,0)
 S ORPAR=$$GET^XPAR(ORENT,"OR UNSIGNED ORDERS ON EXIT")
"RTN","ORQ11",168,0)
 I ORPAR S TM=SDATE F  S TM=$O(^OR(100,"AS",PAT,TM)) Q:TM<1!(TM>EDATE)  D
"RTN","ORQ11",169,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AS",PAT,TM,IFN)) Q:IFN<1  D
"RTN","ORQ11",170,0)
 .. S ACTOR=0 F  S ACTOR=$O(^OR(100,"AS",PAT,TM,IFN,ACTOR)) Q:ACTOR<1  D
"RTN","ORQ11",171,0)
 ... Q:$D(^TMP("ORNEW",$J,IFN,ACTOR))  ;already included
"RTN","ORQ11",172,0)
 ... S X0=$G(^OR(100,IFN,0)),X3=$G(^(3)),X8=$G(^(8,ACTOR,0))
"RTN","ORQ11",173,0)
 ... I $S(ORPAR=1&($P(X8,U,3)=DUZ):1,ORPAR=2:1,1:0) D LP1
"RTN","ORQ11",174,0)
NW1 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ11",175,0)
 Q
"RTN","ORQ11",176,0)
 ;
"RTN","ORQ11",177,0)
CHT1 ; 20 -- secondary pass for Chart Review
"RTN","ORQ11",178,0)
 ;       Include if: unverified, released, inpt, not repl/canc/lapsed
"RTN","ORQ11",179,0)
 I '$P(X8,U,19),$P(X8,U,15)="",$$INPT,"^12^13^14^"'[(U_STS_U) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",180,0)
 Q
"RTN","ORQ11",181,0)
 ;
"RTN","ORQ11",182,0)
CHTSUM ; 21 -- secondary pass for Chart copy summary
"RTN","ORQ11",183,0)
 ;       Included based on Nature of Order
"RTN","ORQ11",184,0)
 N XP,NAT
"RTN","ORQ11",185,0)
 S XP=+$$GET^XPAR("SYS","OR PRINT ALL ORDERS CHART SUM",1,"I")
"RTN","ORQ11",186,0)
 I XP=2 D  Q  ;depends on Nature of Order
"RTN","ORQ11",187,0)
 . S NAT=$P($G(^OR(100,IFN,6)),U)
"RTN","ORQ11",188,0)
 . I 'NAT S NAT=$P(X8,U,12)
"RTN","ORQ11",189,0)
 . I NAT,$$CHART^ORX1(NAT) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",190,0)
 I XP=0 D  Q  ;If original printed, print on sum
"RTN","ORQ11",191,0)
 . I X7 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",192,0)
 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR) ;XP=1 gets All orders
"RTN","ORQ11",193,0)
 Q
"RTN","ORQ11",194,0)
 ;
"RTN","ORQ11",195,0)
LPS1 ; 22 -- secondary pass for Lapsed
"RTN","ORQ11",196,0)
 I STS=14 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",197,0)
 Q
"RTN","ORQ11",198,0)
 ;
"RTN","ORQ11",199,0)
AVT1 ; 23 -- secondary pass for Active/Pending sts only
"RTN","ORQ11",200,0)
 I (STS=6)!(STS=5) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",201,0)
 Q
"RTN","ORQ11",202,0)
 ;
"RTN","ORQ11",203,0)
QUIT ; -- stop
"RTN","ORQ11",204,0)
 Q
"RTN","ORQ12")
0^37^B36656064
"RTN","ORQ12",1,0)
ORQ12 ; slc/dcm - Get patient orders in context ;06/29/06
"RTN","ORQ12",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**12,27,78,92,116,190,220,215,243**;Dec 17, 1997;Build 242
"RTN","ORQ12",3,0)
GET(IFN,NEWD,DETAIL,ACTOR) ; -- Setup TMP array
"RTN","ORQ12",4,0)
 ; IFN=ifn of order
"RTN","ORQ12",5,0)
 ; NEWD=3rd subscript in ^TMP("ORR",$J, node (ORLIST)
"RTN","ORQ12",6,0)
 ; DETAIL=see description in ^ORQ1
"RTN","ORQ12",7,0)
 ;
"RTN","ORQ12",8,0)
 N X0,X3,X4,X6,TXT,STAT,START,DG,STOP,ENTERD
"RTN","ORQ12",9,0)
 S ORLST=ORLST+1,^TMP("ORGOTIT",$J,IFN,+$G(ACTOR))=""
"RTN","ORQ12",10,0)
 I '$G(DETAIL) S ^TMP("ORR",$J,NEWD,ORLST)=IFN_$S($G(ACTOR):";"_ACTOR,1:"") Q
"RTN","ORQ12",11,0)
 S X0=^OR(100,IFN,0),X3=$G(^(3)),X4=$G(^(4)),X6=$G(^(6))
"RTN","ORQ12",12,0)
 S DG=$P(X0,U,11),DG=$P($G(^ORD(100.98,+DG,0)),U,3)
"RTN","ORQ12",13,0)
 S STAT=$S($P(X3,U,3):$P(^ORD(100.01,$P(X3,U,3),0),U,1,2),1:"") ;.01^abbr
"RTN","ORQ12",14,0)
 S ENTERD=$P(X0,U,7),START=$P(X0,U,8),STOP=$P(X0,U,9)
"RTN","ORQ12",15,0)
 ; S FLAGREA=$P(X6,U,7)
"RTN","ORQ12",16,0)
 S ^TMP("ORR",$J,NEWD,ORLST)=IFN_$S($G(ACTOR):";"_ACTOR,1:"")_U_DG_U_ENTERD_U_START_U_STOP_U_STAT
"RTN","ORQ12",17,0)
 D TEXT(.TXT,IFN) M ^TMP("ORR",$J,NEWD,ORLST,"TX")=TXT
"RTN","ORQ12",18,0)
 Q
"RTN","ORQ12",19,0)
 ;
"RTN","ORQ12",20,0)
TEXT(ORTX,ORIFN,WIDTH) ; -- Returns text of order ORIFN in ORTX(#)
"RTN","ORQ12",21,0)
 N OR0,OR3,OR6,X,Y,FIRST,ORI,ORJ,DLG,ORX,ORACT,ORTA
"RTN","ORQ12",22,0)
 K ORTX S:'$G(WIDTH) WIDTH=244
"RTN","ORQ12",23,0)
 S ORACT=+$P(ORIFN,";",2),ORIFN=+ORIFN
"RTN","ORQ12",24,0)
 I ORACT<1 S ORACT=+$P($G(^OR(100,ORIFN,3)),U,7) S:'ORACT ORACT=1
"RTN","ORQ12",25,0)
 ;D:$O(^OR(100,ORIFN,1,0)) CNV^ORY92(ORIFN) ;convert text otf
"RTN","ORQ12",26,0)
 S OR0=$G(^OR(100,ORIFN,0)),OR3=$G(^(3)),OR6=$G(^(6)),ORX=$G(^(8,ORACT,0))
"RTN","ORQ12",27,0)
 S ORTX=1,ORTX(1)=""
"RTN","ORQ12",28,0)
 I $P($G(OR0),U,11)'="",($P(^ORD(100.98,$P(OR0,U,11),0),U)="NON-VA MEDICATIONS") S X="Non-VA" D ADD
"RTN","ORQ12",29,0)
 G:$G(ORIGVIEW)>1 T1
"RTN","ORQ12",30,0)
 S:$P(OR0,U,14)=$O(^DIC(9.4,"C","OR",0)) ORTX(1)=">>" ;generic
"RTN","ORQ12",31,0)
 S X=$$ACTION($P(ORX,U,2)) D:$L(X) ADD
"RTN","ORQ12",32,0)
 I $P(ORX,U,2)="NW",$P(OR3,U,11),'$G(ORIGVIEW) D  ; Changed or Renewed
"RTN","ORQ12",33,0)
 . I $P(OR3,U,11)=2 S X="Renew" D ADD Q
"RTN","ORQ12",34,0)
 . N ORIG,ORIGTA S ORIG=+$P(OR3,U,5) Q:'ORIG  Q:$P(OR3,U,11)'=1
"RTN","ORQ12",35,0)
 . S X="Change" D ADD S ORI=0
"RTN","ORQ12",36,0)
 . I $G(IOST)'="P-OTHER" D
"RTN","ORQ12",37,0)
 . .S ORIGTA=$$LASTXT(ORIG) ;D:$O(^OR(100,ORIG,1,0)) CNV^ORY92(ORIG)
"RTN","ORQ12",38,0)
 . .F  S ORI=$O(^OR(100,ORIG,8,ORIGTA,.1,ORI)) Q:ORI'>0  S X=$G(^(ORI,0)) S:$E(X,1,3)=">> " X=$E(X,4,999) D ADD
"RTN","ORQ12",39,0)
 . .S X=" to" D ADD
"RTN","ORQ12",40,0)
T1 S ORTA=+$P(ORX,U,14),FIRST=+$O(^OR(100,ORIFN,8,ORTA,.1,0))
"RTN","ORQ12",41,0)
 S ORI=0 F  S ORI=$O(^OR(100,ORIFN,8,ORTA,.1,ORI)) Q:ORI'>0  S X=$G(^(ORI,0)) S:(FIRST=ORI)&($E(X,1,3)=">> ") X=$E(X,4,999) D:$L(X) ADD
"RTN","ORQ12",42,0)
 Q:$G(ORIGVIEW)>1  ;contents of global only
"RTN","ORQ12",43,0)
 S DLG=$P(OR0,U,5) K Y I DLG,$P(DLG,";",2)["101.41",$D(^ORD(101.41,+DLG,9)) X ^(9) I $L($G(Y)) S X=Y D ADD ; additional text
"RTN","ORQ12",44,0)
 ; I $P(OR3,U,11)=2 S X="(Renewal)" D ADD
"RTN","ORQ12",45,0)
 I $P(ORX,U,4)=2 S X="*UNSIGNED*" D ADD
"RTN","ORQ12",46,0)
 I $P(ORX,U,2)="DC"!("^1^13^"[(U_$P(OR3,U,3)_U)),$L(OR6) S X=" <"_$S($L($P(OR6,U,5)):$P(OR6,U,5),$P(OR6,U,4):$P($G(^ORD(100.03,+$P(OR6,U,4),0)),U),1:"")_">" D:$L(X)>3 ADD ; DC Reason
"RTN","ORQ12",47,0)
 I $D(XQAID),$G(ORFLG)=12 S ORX=$G(^OR(100,ORIFN,8,ORACT,3)) I $P(ORX,U) S X=" Flagged "_$$DATETIME($P(ORX,U,3))_$S($P(ORX,U,4):" by "_$$NAME($P(ORX,U,4)),1:"")_": "_$P(ORX,U,5) D ADD ; Flagged - show in FUP
"RTN","ORQ12",48,0)
 Q
"RTN","ORQ12",49,0)
 ;
"RTN","ORQ12",50,0)
LASTXT(IFN)     ; -- Returns action with latest text for order IFN
"RTN","ORQ12",51,0)
 N I,Y S Y=1
"RTN","ORQ12",52,0)
 S I=0 F  S I=$O(^OR(100,IFN,8,I)) Q:I'>0  S:$O(^(I,.1,0)) Y=I
"RTN","ORQ12",53,0)
 Q Y
"RTN","ORQ12",54,0)
 ;
"RTN","ORQ12",55,0)
LAST(CODE) ; -- Return DA of last occurence of CODE action
"RTN","ORQ12",56,0)
 N DA
"RTN","ORQ12",57,0)
 I '$L($G(CODE)) S DA=$O(^OR(100,ORIFN,8,"A"),-1) ; last entry
"RTN","ORQ12",58,0)
 E  S DA=$O(^OR(100,ORIFN,8,"C",CODE,"?"),-1) ; last CODE entry
"RTN","ORQ12",59,0)
 Q DA
"RTN","ORQ12",60,0)
 ;
"RTN","ORQ12",61,0)
ACTION(X) ; -- Returns text of action X
"RTN","ORQ12",62,0)
 N Y
"RTN","ORQ12",63,0)
 S Y=$S(X="DC":"Discontinue",X="HD":"Hold",X="RL"&'$G(ORIGVIEW):"Release Hold of",X="FL":"Flag",X="UF":"Unflag",X="RN"&'$G(ORIGVIEW):"Renew",1:"")
"RTN","ORQ12",64,0)
 Q Y
"RTN","ORQ12",65,0)
 ;
"RTN","ORQ12",66,0)
DATETIME(X) ; -- Returns date/time in format 00/00/00@00:00am
"RTN","ORQ12",67,0)
 N Y,D,T,T1,Z
"RTN","ORQ12",68,0)
 S D=$P(X,"."),T=$E($P(X,".",2)_"0000",1,4),T1=$E(T,1,2),Z="AM"
"RTN","ORQ12",69,0)
 S:T1>12 T1=T1-12,Z="PM"
"RTN","ORQ12",70,0)
 S Y=$E(D,4,5)_"/"_$E(D,6,7)_"/"_(1700+$E(D,1,3))_"@"_T1_":"_$E(T,3,4)_Z
"RTN","ORQ12",71,0)
 Q Y
"RTN","ORQ12",72,0)
 ;
"RTN","ORQ12",73,0)
NAME(X) ; -- Returns name as Lname,F
"RTN","ORQ12",74,0)
 N Y,Z S Z=$P($G(^VA(200,+X,0)),U) Q:Z="" ""
"RTN","ORQ12",75,0)
 S Y=$P(Z,",")_"," F I=$F(Z,","):1:$L(Z) I $E(Z,I)'=" " S Y=Y_$E(Z,I) Q
"RTN","ORQ12",76,0)
 S Y=$$LOWER^VALM1(Y) ; mixed case
"RTN","ORQ12",77,0)
 Q Y
"RTN","ORQ12",78,0)
 ;
"RTN","ORQ12",79,0)
ADD ; -- Add text X to ORTX()
"RTN","ORQ12",80,0)
 N I,Y S Y=$L(ORTX(ORTX)) S:Y Y=Y+1 ;allow for space
"RTN","ORQ12",81,0)
 I $E(X)=" ",Y S ORTX=ORTX+1,ORTX(ORTX)="",Y=0,X=$E(X,2,999) ;new line
"RTN","ORQ12",82,0)
 I Y+$L(X)'>WIDTH S ORTX(ORTX)=ORTX(ORTX)_$S(Y:" ",1:"")_X Q
"RTN","ORQ12",83,0)
 F I=1:1:$L(X," ") S Z=$P(X," ",I) D:(Y+$L(Z))>WIDTH  S ORTX(ORTX)=$G(ORTX(ORTX))_$S(Y:" ",1:"")_Z,Y=$L(ORTX(ORTX)) S:Y Y=Y+1
"RTN","ORQ12",84,0)
 . I $L(Z)>WIDTH F  S ORTX(ORTX)=$G(ORTX(ORTX))_$S(Y:" ",1:"")_$E(Z,1,WIDTH-Y),Z=$E(Z,WIDTH-Y+1,999) Q:$L(Z)'>WIDTH  S ORTX=ORTX+1,Y=0
"RTN","ORQ12",85,0)
 . S ORTX=ORTX+1,Y=0
"RTN","ORQ12",86,0)
 Q
"RTN","ORQ12",87,0)
 ;
"RTN","ORQ12",88,0)
EXPD ; -- loop through ^XTMP("ORAE" to get expired orders
"RTN","ORQ12",89,0)
 K ^TMP("ORGOTIT",$J),^TMP("ORSORT",$J)
"RTN","ORQ12",90,0)
 N TM,TO,IFN,X0,X3,X7,X8,USTS,NOW,ACTOR,X,ORREP
"RTN","ORQ12",91,0)
 S NOW=+$E($$NOW^XLFDT,1,12),TO=0,SDATE=9999999-SDATE,EDATE=9999999-EDATE
"RTN","ORQ12",92,0)
 F  S TO=$O(^XTMP("ORAE",PAT,TO)) Q:'TO  I $D(ORGRP(TO)) S TM=EDATE F  S TM=$O(^XTMP("ORAE",PAT,TO,TM)) Q:'TM!(TM>SDATE)!(+TM<EDATE)  D
"RTN","ORQ12",93,0)
 . S IFN=0 F  S IFN=$O(^XTMP("ORAE",PAT,TO,TM,IFN)) Q:'IFN  I ('$D(^TMP("ORGOTIT",$J,IFN))!MULT) D
"RTN","ORQ12",94,0)
 .. S USTS=$P(^OR(100,IFN,3),U,3)
"RTN","ORQ12",95,0)
 .. Q:+$G(USTS)'=7  ;quit if order no longer expired
"RTN","ORQ12",96,0)
 .. S ORREP=$P(^OR(100,IFN,3),U,6)
"RTN","ORQ12",97,0)
 .. Q:+$G(ORREP)>0  ;quit if order has been replaced
"RTN","ORQ12",98,0)
 .. S ^TMP("ORSORT",$J,9999999-TM,TO,IFN)=""
"RTN","ORQ12",99,0)
 S TM=0 F  S TM=$O(^TMP("ORSORT",$J,TM)) Q:'TM  S TO=0 F  S TO=$O(^TMP("ORSORT",$J,TM,TO)) Q:'TO  D
"RTN","ORQ12",100,0)
 .S IFN=0 F  S IFN=$O(^TMP("ORSORT",$J,TM,TO,IFN)) Q:'IFN  I $D(^OR(100,IFN,0)),$D(^(3)) S X0=^(0),X3=^(3) D
"RTN","ORQ12",101,0)
 ..S ACTOR=+$P(X3,U,7) D LP1^ORQ11
"RTN","ORQ12",102,0)
 ..;S ACTOR=0 F  S ACTOR=$O(^OR(100,"ACT",PAT,9999999-$P(X0,U,7),TO,IFN,ACTOR)) Q:ACTOR<1  I '$D(^TMP("ORGOTIT",$J,IFN,ACTOR)),$D(^OR(100,IFN,8,ACTOR,0)),$P(^(0),U,15)'=13 S X8=^(0),X7=$G(^(7)) D LP1^ORQ11
"RTN","ORQ12",103,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=$G(ORLST)
"RTN","ORQ12",104,0)
 K ^TMP("ORSORT",$J),^TMP("ORGOTIT",$J)
"RTN","ORQ12",105,0)
 Q
"RTN","ORQ12",106,0)
GETEIE(IFN,NEWD,DETAIL,ACTOR) ; -- Setup TMP array
"RTN","ORQ12",107,0)
 ; IFN=ifn of order
"RTN","ORQ12",108,0)
 ; NEWD=3rd subscript in ^TMP("ORR",$J, node (ORLIST)
"RTN","ORQ12",109,0)
 ; DETAIL=see description in ^ORQ1
"RTN","ORQ12",110,0)
 ;
"RTN","ORQ12",111,0)
 N X0,X3,X4,X6,TXT,STAT,START,DG,STOP,ENTERD,DCREAS
"RTN","ORQ12",112,0)
 S X0=^OR(100,IFN,0),X3=$G(^(3)),X4=$G(^(4)),X6=$G(^(6))
"RTN","ORQ12",113,0)
 S DG=$P(X0,U,11),DG=$P($G(^ORD(100.98,+DG,0)),U,3)
"RTN","ORQ12",114,0)
 S STAT=$S($P(X3,U,3):$P(^ORD(100.01,$P(X3,U,3),0),U,1,2),1:"")
"RTN","ORQ12",115,0)
 S ENTERD=$P(X0,U,7),START=$P(X0,U,8),STOP=$P(X0,U,9)
"RTN","ORQ12",116,0)
 S DCREAS=$P($G(X6),U,4) Q:DCREAS'>0
"RTN","ORQ12",117,0)
 I DCREAS'=$O(^ORD(100.03,"B","Entered in error","")) Q
"RTN","ORQ12",118,0)
 S ORLST=ORLST+1,^TMP("ORGOTIT",$J,IFN,+$G(ACTOR))=""
"RTN","ORQ12",119,0)
 I '$G(DETAIL) S ^TMP("ORR",$J,NEWD,ORLST)=IFN_$S($G(ACTOR):";"_ACTOR,1:"") Q
"RTN","ORQ12",120,0)
 S ^TMP("ORR",$J,NEWD,ORLST)=IFN_$S($G(ACTOR):";"_ACTOR,1:"")_U_DG_U_ENTERD_U_START_U_STOP_U_STAT
"RTN","ORQ12",121,0)
 D TEXT(.TXT,IFN) M ^TMP("ORR",$J,NEWD,ORLST,"TX")=TXT
"RTN","ORQ12",122,0)
 Q
"RTN","ORQ2")
0^67^B39956511
"RTN","ORQ2",1,0)
ORQ2 ; SLC/MKB/GSS - Detailed Order Report ;10/10/2006
"RTN","ORQ2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**12,56,75,94,141,213,195,243**;Dec 17, 1997;Build 242
"RTN","ORQ2",3,0)
DETAIL(ORY,ORIFN) ; -- Returns details of order ORIFN in ORY(#)
"RTN","ORQ2",4,0)
 N X,X2,I,CNT,ORDIALOG,OR0,OR3,OR6,SEQ,ITEM,PRMT,MULT,FIRST,TITLE,INST,DIWL,DIWR,DIWF,ACTION,VAIN,ORIGVIEW,ORNMSP,ORYT
"RTN","ORQ2",5,0)
 S CNT=0,ORIFN=+ORIFN,OR0=$G(^OR(100,ORIFN,0)),OR3=$G(^(3)),OR6=$G(^(6))
"RTN","ORQ2",6,0)
 K @ORY,ORYT S ORIGVIEW=1 D TEXT^ORQ12(.ORYT,+ORIFN_";"_+$P(OR3,U,7),80) ;CurrTx
"RTN","ORQ2",7,0)
 M @ORY=ORYT ;Move text to global
"RTN","ORQ2",8,0)
 S I=0 F CNT=1:1 S I=$O(ORYT(I)) Q:I'>0  D:$D(IORVON) SETVIDEO(I,1,$L(ORYT(I)),IORVON,IORVOFF)
"RTN","ORQ2",9,0)
 S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",10,0)
D1 I $O(^OR(100,+ORIFN,2,0)) D
"RTN","ORQ2",11,0)
 . S CNT=CNT+1,@ORY@(CNT)="Sub Orders:"
"RTN","ORQ2",12,0)
 . D:$D(IOUON) SETVIDEO(CNT,1,11,IOUON,IOUOFF)
"RTN","ORQ2",13,0)
 . N IFN S IFN=0
"RTN","ORQ2",14,0)
 . F  S IFN=+$O(^OR(100,+ORIFN,2,IFN)) Q:IFN<1  I $D(^OR(100,IFN,0)) D SUB(IFN)
"RTN","ORQ2",15,0)
 . S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",16,0)
 I $P(OR3,U,9),$D(^OR(100,+$P(OR3,U,9),0)) D
"RTN","ORQ2",17,0)
 . S CNT=CNT+1,@ORY@(CNT)="Parent Order:"
"RTN","ORQ2",18,0)
 . D:$D(IOUON) SETVIDEO(CNT,1,12,IOUON,IOUOFF)
"RTN","ORQ2",19,0)
 . D SUB(+$P(OR3,U,9))
"RTN","ORQ2",20,0)
 . S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",21,0)
 I $P(OR3,U,11)=1,$P(OR3,U,5) D  ;Changed - show previous order
"RTN","ORQ2",22,0)
 . S CNT=CNT+1,@ORY@(CNT)="Previous Order:"
"RTN","ORQ2",23,0)
 . D:$D(IOUON) SETVIDEO(CNT,1,15,IOUON,IOUOFF) ;prev order original text
"RTN","ORQ2",24,0)
 . N ORZ,I,ORIGVIEW S ORIGVIEW=2 D TEXT^ORQ12(.ORZ,+$P(OR3,U,5),55)
"RTN","ORQ2",25,0)
 . S CNT=CNT+1,@ORY@(CNT)="     Order Text:        "_$G(ORZ(1))
"RTN","ORQ2",26,0)
 . S I=1 F  S I=$O(ORZ(I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=$$REPEAT^XLFSTR(" ",24)_$G(ORZ(I))
"RTN","ORQ2",27,0)
D2 S CNT=CNT+1,@ORY@(CNT)="Activity:"
"RTN","ORQ2",28,0)
 D:$D(IOUON) SETVIDEO(CNT,1,9,IOUON,IOUOFF)
"RTN","ORQ2",29,0)
 S DIWL=1,DIWR=64,DIWF="C64",ORI=0 K ^UTILITY($J,"W")
"RTN","ORQ2",30,0)
 F  S ORI=$O(^OR(100,ORIFN,8,ORI)) Q:ORI'>0  S ACTION=$G(^(ORI,0)) D ACT^ORQ20
"RTN","ORQ2",31,0)
 I "^1^12^13^"[(U_$P(OR3,U,3)_U),$L(OR6),$P(ACTION,U,2)'="DC" D DC^ORQ20
"RTN","ORQ2",32,0)
 I $P(OR3,U,3)=2,$P(OR6,U,6) S CNT=CNT+1,@ORY@(CNT)=$$DATE^ORQ20($P(OR6,U,6))_"  Completed"_$S($P(OR6,U,7):" by "_$$USER^ORQ20($P(OR6,U,7)),1:"")
"RTN","ORQ2",33,0)
 S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",34,0)
D3 S CNT=CNT+1,@ORY@(CNT)="Current Data:"
"RTN","ORQ2",35,0)
 D:$D(IOUON) SETVIDEO(CNT,1,13,IOUON,IOUOFF)
"RTN","ORQ2",36,0)
 D VA I $G(VAIN(2)) S CNT=CNT+1,@ORY@(CNT)="Current Primary Provider:     "_$P(VAIN(2),"^",2)
"RTN","ORQ2",37,0)
 I $G(VAIN(11)) S CNT=CNT+1,@ORY@(CNT)="Current Attending Physician:  "_$P(VAIN(11),"^",2)
"RTN","ORQ2",38,0)
 S CNT=CNT+1,@ORY@(CNT)="Treating Specialty:           "_$P($G(^DIC(45.7,+$P(OR0,U,13),0)),U)
"RTN","ORQ2",39,0)
 S CNT=CNT+1,@ORY@(CNT)="Ordering Location:            "_$P($G(^SC(+$P(OR0,U,10),0)),U)
"RTN","ORQ2",40,0)
 S CNT=CNT+1,@ORY@(CNT)="Start Date/Time:              "_$S($P(OR0,U,8):$$DATE^ORQ20($P(OR0,U,8)),1:"")
"RTN","ORQ2",41,0)
 I $P(OR3,U,5),$P(OR3,U,11)=2 S X=$$ORIG(ORIFN),@ORY@(CNT)=@ORY@(CNT)_" (originally "_$$DATE^ORQ20(X)_")"
"RTN","ORQ2",42,0)
 S CNT=CNT+1,@ORY@(CNT)="Stop Date/Time:               "_$S($P(OR0,U,9):$$DATE^ORQ20($P(OR0,U,9)),1:"")
"RTN","ORQ2",43,0)
 I $P(OR3,U,3)=1,$P(OR6,U,6) S @ORY@(CNT)=@ORY@(CNT)_"  (expired "_$$DATE^ORQ20($P(OR6,U,6))_")"
"RTN","ORQ2",44,0)
 S CNT=CNT+1,@ORY@(CNT)="Current Status:               "_$S($D(^ORD(100.01,+$P(OR3,U,3),0)):$P(^(0),"^"),1:"-")
"RTN","ORQ2",45,0)
 I $$GET^XPAR("ALL","ORPF SHOW STATUS DESCRIPTION",1,"I"),$P(OR3,U,3),$D(^ORD(100.01,$P(OR3,U,3),0)) N J S J=0 F  S J=$O(^ORD(100.01,$P(OR3,U,3),1,J)) Q:J<1  S CNT=CNT+1,@ORY@(CNT)="  "_^(J,0)
"RTN","ORQ2",46,0)
 S CNT=CNT+1,@ORY@(CNT)="Order #"_ORIFN
"RTN","ORQ2",47,0)
 S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",48,0)
D4 S CNT=CNT+1,@ORY@(CNT)="Order:" D:$D(IOUON) SETVIDEO(CNT,1,6,IOUON,IOUOFF)
"RTN","ORQ2",49,0)
 S ORNMSP=$$NMSP^ORCD($P(OR0,U,14))
"RTN","ORQ2",50,0)
 I '$O(^OR(100,ORIFN,4.5,0)),ORNMSP="RA" D RAD^ORQ21("") Q
"RTN","ORQ2",51,0)
 S ORDIALOG=$P(OR0,U,5) Q:$P(ORDIALOG,";",2)="ORD(101,"  ; 2.5 order
"RTN","ORQ2",52,0)
 D GETDLG^ORCD(+ORDIALOG),GETORDER^ORCD(ORIFN)
"RTN","ORQ2",53,0)
 S DIWL=1,DIWR=50,DIWF="C50"
"RTN","ORQ2",54,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ)) Q:SEQ'>0  S DA=0 F  S DA=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ,DA)) Q:'DA  D
"RTN","ORQ2",55,0)
 . S ITEM=$G(^ORD(101.41,+ORDIALOG,10,DA,0)) Q:$P(ITEM,U,11)  ; child
"RTN","ORQ2",56,0)
 . S PRMT=$P(ITEM,U,2),MULT=$P(ITEM,U,7) Q:$P(ITEM,U,9)["*"  ;hide
"RTN","ORQ2",57,0)
 . S FIRST=$O(ORDIALOG(PRMT,0)) Q:'FIRST  ; no values
"RTN","ORQ2",58,0)
 . S TITLE=$S(MULT&$L($G(ORDIALOG(PRMT,"TTL"))):ORDIALOG(PRMT,"TTL"),1:ORDIALOG(PRMT,"A"))
"RTN","ORQ2",59,0)
 . S TITLE=TITLE_$$REPEAT^XLFSTR(" ",30-$L(TITLE))
"RTN","ORQ2",60,0)
 . S INST=0 F  S INST=$O(ORDIALOG(PRMT,INST)) Q:INST'>0  D
"RTN","ORQ2",61,0)
 . . I $E(ORDIALOG(PRMT,0))="W" D WP Q
"RTN","ORQ2",62,0)
 . . K ^UTILITY($J,"W") S X=$$EXT^ORCD(PRMT,INST) I TITLE["Infusion Rate"&(X'="")&(X'["ml/hr") S TITLE="Infuse Over Time:",TITLE=TITLE_$$REPEAT^XLFSTR(" ",30-$L(TITLE))
"RTN","ORQ2",63,0)
 . . D ^DIWP
"RTN","ORQ2",64,0)
 . . D:$D(^ORD(101.41,+ORDIALOG,10,"DAD",PRMT)) CHILDREN(PRMT)
"RTN","ORQ2",65,0)
 . . S I=0 F  S I=$O(^UTILITY($J,"W",DIWL,I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=$S((INST=FIRST)&(I=1):TITLE,1:$$REPEAT^XLFSTR(" ",30))_^(I,0)
"RTN","ORQ2",66,0)
 I ORNMSP="GMRC",$G(^OR(100,ORIFN,4)) S CNT=CNT+1,@ORY@(CNT)="Consult No.:                  "_+^(4)
"RTN","ORQ2",67,0)
 S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",68,0)
 D RAD^ORQ21(1):ORNMSP="RA",MED^ORQ21:ORNMSP="PS" ;add'l data
"RTN","ORQ2",69,0)
 D BA^ORQ21 ;call for CIDC data
"RTN","ORQ2",70,0)
D5 I $O(^OR(100,+ORIFN,9,0)) D
"RTN","ORQ2",71,0)
 . N CK,OK,X0,X,CDL,I S CNT=CNT+1,@ORY@(CNT)="Order Checks:"
"RTN","ORQ2",72,0)
 . D:$D(IOUON) SETVIDEO(CNT,1,13,IOUON,IOUOFF)
"RTN","ORQ2",73,0)
 . S CK=0 F  S CK=$O(^OR(100,+ORIFN,9,CK)) Q:CK'>0  S X0=$G(^(CK,0)),X=$G(^(1)) D
"RTN","ORQ2",74,0)
 .. S CDL=$$CDL($P(X0,U,2)) I $P(X0,U,6),'$D(OK) S OK=$P(X0,U,4,6)
"RTN","ORQ2",75,0)
 .. I $L(X)'>68 S CNT=CNT+1,@ORY@(CNT)=CDL_X Q
"RTN","ORQ2",76,0)
 .. S DIWL=1,DIWR=68,DIWF="C68" K ^UTILITY($J,"W") D ^DIWP
"RTN","ORQ2",77,0)
 .. S I=0 F  S I=$O(^UTILITY($J,"W",DIWL,I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=CDL_^(I,0),CDL="            "
"RTN","ORQ2",78,0)
 . Q:'$L($G(OK))  S CNT=CNT+1,@ORY@(CNT)="Override:   "_$S($P(OK,U,2):$$USER^ORQ20($P(OK,U,2))_" on ",1:"")_$$DATE^ORQ20($P(OK,U,3))
"RTN","ORQ2",79,0)
 . I $L($P(OK,U))'>68 S CNT=CNT+1,@ORY@(CNT)="            "_$P(OK,U) Q
"RTN","ORQ2",80,0)
 . S DIWL=1,DIWR=68,DIWF="C68",X=$P(OK,U) K ^UTILITY($J,"W") D ^DIWP
"RTN","ORQ2",81,0)
 . S I=0 F  S I=$O(^UTILITY($J,"W",DIWL,I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)="            "_^(I,0)
"RTN","ORQ2",82,0)
 K ^TMP("ORWORD",$J),^UTILITY($J,"W")
"RTN","ORQ2",83,0)
 Q
"RTN","ORQ2",84,0)
 ;
"RTN","ORQ2",85,0)
SUB(IFN) ; -- add suborder or parent
"RTN","ORQ2",86,0)
 N ORCY,STS,STRT,IG D TEXT^ORQ12(.ORCY,IFN,58)
"RTN","ORQ2",87,0)
 S STS=$G(^ORD(100.01,+$P($G(^OR(100,IFN,3)),U,3),.1))
"RTN","ORQ2",88,0)
 S STRT=$P(^OR(100,IFN,0),U,8) S:STRT'="" STRT=$$DATE^ORQ20(STRT)
"RTN","ORQ2",89,0)
 S IG=0 F  S IG=$O(ORCY(IG)) Q:IG<1  S CNT=CNT+1,@ORY@(CNT)=$J(STS,4)_" "_ORCY(IG)_" "_STRT,(STS,STRT)=" "
"RTN","ORQ2",90,0)
 Q
"RTN","ORQ2",91,0)
 ;
"RTN","ORQ2",92,0)
WP ; -- add word-processing
"RTN","ORQ2",93,0)
 N WP,ORI,X M WP=@ORDIALOG(PRMT,INST)
"RTN","ORQ2",94,0)
 S CNT=CNT+1,@ORY@(CNT)=TITLE
"RTN","ORQ2",95,0)
 S ORI=0 F  S ORI=$O(WP(ORI)) Q:ORI'>0  S X=WP(ORI,0) S:X'="" CNT=CNT+1,@ORY@(CNT)="  "_X
"RTN","ORQ2",96,0)
 Q
"RTN","ORQ2",97,0)
 ;
"RTN","ORQ2",98,0)
CHILDREN(PARENT) ; -- add children
"RTN","ORQ2",99,0)
 N SEQ,DA,ITM,PRMT,TYPE,X
"RTN","ORQ2",100,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"DAD",PARENT,SEQ)) Q:SEQ'>0  S DA=$O(^(SEQ,0)) D
"RTN","ORQ2",101,0)
 . S ITM=$G(^ORD(101.41,+ORDIALOG,10,DA,0)),PRMT=$P(ITM,U,2)
"RTN","ORQ2",102,0)
 . Q:$G(ORDIALOG(PRMT,INST))=""  Q:$P(ITM,U,9)["*"  ;no value or hide
"RTN","ORQ2",103,0)
 . S TYPE=$E(ORDIALOG(PRMT,0)) D:TYPE="W" WP
"RTN","ORQ2",104,0)
 . I TYPE'="W" D
"RTN","ORQ2",105,0)
 . . S X=$$EXT^ORCD(PRMT,INST)
"RTN","ORQ2",106,0)
 . . I $L(X,"|")=2 S X=$$REPLACE^ORHLESC(X,"|","||")
"RTN","ORQ2",107,0)
 . . D ^DIWP
"RTN","ORQ2",108,0)
 Q
"RTN","ORQ2",109,0)
 ;
"RTN","ORQ2",110,0)
SETVIDEO(LINE,COL,WIDTH,ON,OFF) ; -- set video attributes
"RTN","ORQ2",111,0)
 S ORY("VIDEO",LINE,COL,WIDTH)=ON
"RTN","ORQ2",112,0)
 S ORY("VIDEO",LINE,COL+WIDTH,0)=OFF
"RTN","ORQ2",113,0)
 Q
"RTN","ORQ2",114,0)
 ;
"RTN","ORQ2",115,0)
VA ; -- Call VADPT
"RTN","ORQ2",116,0)
 N ORY,DFN,Y S DFN=+$P(OR0,"^",2) D OERR^VADPT
"RTN","ORQ2",117,0)
 Q
"RTN","ORQ2",118,0)
 ;
"RTN","ORQ2",119,0)
CDL(X) ; -- Returns Clinical Danger Level X
"RTN","ORQ2",120,0)
 N Y S Y=$S(X=1:"HIGH:",X=2:"MODERATE:",X=3:"LOW:",1:"NONE:")
"RTN","ORQ2",121,0)
 S Y=$E(Y_"        ",1,12)
"RTN","ORQ2",122,0)
 Q Y
"RTN","ORQ2",123,0)
 ;
"RTN","ORQ2",124,0)
ORIG(IFN) ; -- Return original start date of [renewal] order
"RTN","ORQ2",125,0)
 N I,Y,X3,DONE
"RTN","ORQ2",126,0)
 S I=IFN,Y=$P($G(^OR(100,IFN,0)),U,8),DONE=0
"RTN","ORQ2",127,0)
 F  S X3=$G(^OR(100,I,3)) D  Q:DONE
"RTN","ORQ2",128,0)
 . I $P(X3,U,11)=2,$P(X3,U,5) S I=$P(X3,U,5) Q  ;loop
"RTN","ORQ2",129,0)
 . S Y=$P($G(^OR(100,I,0)),U,8),DONE=1
"RTN","ORQ2",130,0)
 Q Y
"RTN","ORQ20")
0^98^B49432908
"RTN","ORQ20",1,0)
ORQ20 ; SLC/MKB - Detailed Order Report cont ;3/6/08  10:25
"RTN","ORQ20",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**12,27,92,94,116,141,177,186,190,215,243**;Dec 17, 1997;Build 242
"RTN","ORQ20",3,0)
ACT ; -- add Activity [from ^ORQ2]
"RTN","ORQ20",4,0)
 N ORACT S ORACT=$P(ACTION,U,2)
"RTN","ORQ20",5,0)
 I ORACT'="NW",$P(ACTION,U,4)=5,$P(ACTION,U,15)=13 Q  ;skip canc actions
"RTN","ORQ20",6,0)
 N NVA,USER S:$P(^ORD(100.98,$P(^OR(100,+ORIFN,0),U,11),0),U)="NON-VA MEDICATIONS" NVA=1
"RTN","ORQ20",7,0)
 S CNT=CNT+1,@ORY@(CNT)=$$DATE($P(ACTION,U))_"  "_$$ACTION(ORACT)
"RTN","ORQ20",8,0)
 I $P(ACTION,U,13) S @ORY@(CNT)=@ORY@(CNT)_" entered by "_$$USER(+$P(ACTION,U,13))
"RTN","ORQ20",9,0)
 I ORACT="NW" D  ;Show original order text
"RTN","ORQ20",10,0)
 . N ORZ,I,ORIGVIEW S ORIGVIEW=2 D TEXT^ORQ12(.ORZ,ORIFN_";1",80)
"RTN","ORQ20",11,0)
 . S CNT=CNT+1,@ORY@(CNT)="     Order Text:        "_$G(ORZ(1))
"RTN","ORQ20",12,0)
 . S I=1 F  S I=$O(ORZ(I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=$$REPEAT^XLFSTR(" ",24)_$G(ORZ(I))
"RTN","ORQ20",13,0)
 I ORACT="XX" D  ;Changed - show new text
"RTN","ORQ20",14,0)
 . N ORZ,I,ORIGVIEW S ORIGVIEW=2 D TEXT^ORQ12(.ORZ,ORIFN_";"_ORI,80)
"RTN","ORQ20",15,0)
 . S CNT=CNT+1,@ORY@(CNT)="     Changed to:        "_$G(ORZ(1))
"RTN","ORQ20",16,0)
 . S I=1 F  S I=$O(ORZ(I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=$$REPEAT^XLFSTR(" ",24)_$G(ORZ(I))
"RTN","ORQ20",17,0)
A1 I $P(ACTION,U,12) D  ;Nature of Order/Release
"RTN","ORQ20",18,0)
 . N ORZ S ORZ=$G(^ORD(100.02,+$P(ACTION,U,12),0))
"RTN","ORQ20",19,0)
 . S CNT=CNT+1,@ORY@(CNT)="     Nature of Order:   "_$P(ORZ,U)
"RTN","ORQ20",20,0)
 . I $P(OR0,U,17),(ORACT="NW") Q  ;see event
"RTN","ORQ20",21,0)
 . I "^V^P^"[(U_$P(ORZ,U,2)_U),$P(ACTION,U,16) S CNT=CNT+1,@ORY@(CNT)="     Released by:       "_$$USER(+$P(ACTION,U,17))_" on "_$$DATE($P(ACTION,U,16))
"RTN","ORQ20",22,0)
 I $P(OR0,U,17)&(ORACT="NW") D  ;Delayed Release Event
"RTN","ORQ20",23,0)
 . N EVT,X,ORV,I S EVT=+$P(OR0,U,17),X=$$NAME^OREVNTX(EVT)
"RTN","ORQ20",24,0)
 . S:$E(X,1,8)="Delayed " X=$E(X,9,99)
"RTN","ORQ20",25,0)
 . I $G(^ORE(100.2,EVT,1)),'$P(ACTION,U,16) S X=X_" on "_$$DATE(+^(1))
"RTN","ORQ20",26,0)
 . S CNT=CNT+1,@ORY@(CNT)="     Delayed Until:     "_X Q:'$P(ACTION,U,16)
"RTN","ORQ20",27,0)
 . D EVENT(.ORV) S CNT=CNT+1,@ORY@(CNT)="     Released by:       "_ORV(1)
"RTN","ORQ20",28,0)
 . S I=1 F  S I=$O(ORV(I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=$$REPEAT^XLFSTR(" ",24)_$G(ORV(I))
"RTN","ORQ20",29,0)
A2 I $P(ACTION,U,5) S CNT=CNT+1,@ORY@(CNT)=$S($P(ACTION,U,4)=7:"      Dig",1:"     Elec")_" Signature:    "_$$USER(+$P(ACTION,U,5))_" on "_$$DATE($P(ACTION,U,6))
"RTN","ORQ20",30,0)
 I '$P(ACTION,U,5)!($P(ACTION,U,3)'=$P(ACTION,U,5)),'$$SERVCORR S CNT=CNT+1,@ORY@(CNT)="     "_$S($D(NVA):"Documented by:",1:"Ordered by:   ")_"     "_$$USER(+$P(ACTION,U,3))
"RTN","ORQ20",31,0)
 I '$P(ACTION,U,5),$L($P(ACTION,U,4)) D
"RTN","ORQ20",32,0)
 .I $P(ACTION,U,4)=0 D
"RTN","ORQ20",33,0)
 ..S USER=$$USER(+$P(ACTION,U,7))
"RTN","ORQ20",34,0)
 ..S CNT=CNT+1
"RTN","ORQ20",35,0)
 ..I USER'="" S @ORY@(CNT)="     Released by:       "_USER_" on "_$$DATE($P(ACTION,U,16))
"RTN","ORQ20",36,0)
 ..I USER="" S @ORY@(CNT)="        Released:       "_$$DATE($P(ACTION,U,16))
"RTN","ORQ20",37,0)
 .S CNT=CNT+1,@ORY@(CNT)="     Signature:         "_$$SIG($P(ACTION,U,4)) ;186
"RTN","ORQ20",38,0)
 ;I '$P(ACTION,U,5),$L($P(ACTION,U,4)) S:$P(ACTION,U,4)=0 CNT=CNT+1,@ORY@(CNT)="     Released by:       "_$$USER(+$P(ACTION,U,7))_" on "_$$DATE($P(ACTION,U,16)) S CNT=CNT+1,@ORY@(CNT)="     Signature:         "_$$SIG($P(ACTION,U,4)) ;186
"RTN","ORQ20",39,0)
 I $P(ACTION,U,9) S CNT=CNT+1,@ORY@(CNT)="     Nurse Verified:    "_$S($P(ACTION,U,8):$$USER(+$P(ACTION,U,8))_" on ",1:"")_$$DATE($P(ACTION,U,9))
"RTN","ORQ20",40,0)
 I $P(ACTION,U,11) S CNT=CNT+1,@ORY@(CNT)="     Clerk Verified:    "_$S($P(ACTION,U,10):$$USER(+$P(ACTION,U,10))_" on ",1:"")_$$DATE($P(ACTION,U,11))
"RTN","ORQ20",41,0)
 I $P(ACTION,U,19) S CNT=CNT+1,@ORY@(CNT)="     Chart Reviewed:    "_$S($P(ACTION,U,18):$$USER(+$P(ACTION,U,18))_" on ",1:"")_$$DATE($P(ACTION,U,19))
"RTN","ORQ20",42,0)
A3 I $P(ACTION,U,2)="DC",$L(OR6) S X=$S($L($P(OR6,U,5)):$P(OR6,U,5),$P(OR6,U,4):$P($G(^ORD(100.03,+$P(OR6,U,4),0)),U),$P(OR6,U):$P($G(^ORD(100.02,+$P(OR6,U),0)),U),1:"") S:$L(X) CNT=CNT+1,@ORY@(CNT)="     Reason for DC:     "_X
"RTN","ORQ20",43,0)
 I $L($G(^OR(100,ORIFN,8,ORI,1))) S X=^(1) D  ;add backdoor comments
"RTN","ORQ20",44,0)
 . N LBL,I S LBL=""
"RTN","ORQ20",45,0)
 . I $P(ACTION,U,15)="",$P(ACTION,U,2)'="DC" S LBL="     Comments:          " ;DC shown above
"RTN","ORQ20",46,0)
 . I $P(ACTION,U,15)=13,$P(ACTION,U,2)'="NW" S LBL="     Cancelled:         " ;NW shown in ORQ2
"RTN","ORQ20",47,0)
 . Q:'$L(LBL)  I $L(X)'>56 S CNT=CNT+1,@ORY@(CNT)=LBL_X Q
"RTN","ORQ20",48,0)
 . S DIWL=1,DIWR=56,DIWF="C56" K ^UTILITY($J,"W") D ^DIWP
"RTN","ORQ20",49,0)
 . S I=0 F  S I=$O(^UTILITY($J,"W",DIWL,I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=LBL_^(I,0),LBL="                        "
"RTN","ORQ20",50,0)
 I $D(^OR(100,ORIFN,8,ORI,5)) D  ;Ward comments
"RTN","ORQ20",51,0)
 . N X,ORJ K ^UTILITY($J,"W")
"RTN","ORQ20",52,0)
 . S ORJ=0 F  S ORJ=$O(^OR(100,ORIFN,8,ORI,5,ORJ)) Q:ORJ'>0  S X=^(ORJ,0) D ^DIWP
"RTN","ORQ20",53,0)
 . S ORJ=0 F  S ORJ=$O(^UTILITY($J,"W",DIWL,ORJ)) Q:ORJ'>0  S CNT=CNT+1,@ORY@(CNT)=$S(ORJ=1:"     Ward/Clinic Cmmts: ",1:"                        ")_^(ORJ,0)
"RTN","ORQ20",54,0)
 . K ^UTILITY($J,"W")
"RTN","ORQ20",55,0)
A4 I $P(ACTION,U,2)="HD",$G(^OR(100,ORIFN,8,ORI,2)) S X2=^(2),CNT=CNT+1,@ORY@(CNT)="     Hold Released:     "_$$FMTE^XLFDT($P(X2,U),"2P")_" by "_$$USER($P(X2,U,2))
"RTN","ORQ20",56,0)
 I $D(^OR(100,ORIFN,8,ORI,3)) D  ;Un-/Flagged
"RTN","ORQ20",57,0)
 . N X S X=$G(^OR(100,ORIFN,8,ORI,3))
"RTN","ORQ20",58,0)
 . S CNT=CNT+1,@ORY@(CNT)="     Flagged by:        "_$$USER(+$P(X,U,4))_" on "_$$DATE($P(X,U,3))
"RTN","ORQ20",59,0)
 . S CNT=CNT+1,@ORY@(CNT)="                        "_$P(X,U,5)
"RTN","ORQ20",60,0)
 . Q:X  S CNT=CNT+1,@ORY@(CNT)="     Unflagged by:      "_$$USER(+$P(X,U,7))_" on "_$$DATE($P(X,U,6))
"RTN","ORQ20",61,0)
 . S CNT=CNT+1,@ORY@(CNT)="                        "_$P(X,U,8)
"RTN","ORQ20",62,0)
 Q
"RTN","ORQ20",63,0)
 ;
"RTN","ORQ20",64,0)
DC ; -- Add Reason for DC
"RTN","ORQ20",65,0)
 S CNT=CNT+1,@ORY@(CNT)=$$DATE($P(OR6,U,3))_$S($P(OR6,U,8):"  Auto-",1:"  ")_"Discontinued"
"RTN","ORQ20",66,0)
 I $P(OR6,U,8) D  Q
"RTN","ORQ20",67,0)
 . N EVT,PKG,ORV,I
"RTN","ORQ20",68,0)
 . S EVT=$P(OR6,U,8),PKG=$P($G(^ORE(100.2,+EVT,3,ORIFN,0)),U,2)
"RTN","ORQ20",69,0)
 . S @ORY@(CNT)=@ORY@(CNT)_" by "_$S(PKG="FH":"DIETETICS",PKG="LR":"LABORATORY",PKG="PS":"PHARMACY",1:"CPRS")
"RTN","ORQ20",70,0)
 . D EVENT(.ORV,1) S CNT=CNT+1,@ORY@(CNT)="     Patient Movement:  "_ORV(1)
"RTN","ORQ20",71,0)
 . S I=1 F  S I=$O(ORV(I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=$$REPEAT^XLFSTR(" ",24)_$G(ORV(I))
"RTN","ORQ20",72,0)
 I $P(OR6,U,2),$P($G(^ORD(100.02,+$P(OR6,U),0)),U,2)'="A" S @ORY@(CNT)=@ORY@(CNT)_" by "_$$USER($P(OR6,U,2)) ;don't show user name if auto-dc
"RTN","ORQ20",73,0)
 N X S X=$S($L($P(OR6,U,5)):$P(OR6,U,5),$P(OR6,U,4):$P($G(^ORD(100.03,+$P(OR6,U,4),0)),U),$P(OR6,U):$P($G(^ORD(100.02,+$P(OR6,U),0)),U),1:"") S:$L(X) CNT=CNT+1,@ORY@(CNT)="     Reason for DC:     "_X
"RTN","ORQ20",74,0)
 Q
"RTN","ORQ20",75,0)
 ;
"RTN","ORQ20",76,0)
ACTION(CODE) ; -- Return name of action CODE
"RTN","ORQ20",77,0)
 N NAME S NAME=$S(CODE="NW":"New Order",CODE="DC":"Discontinue",CODE="HD":"Hold",CODE="RL":"Release Hold",CODE="RN":"Renewal",CODE="XX":"Change",1:"")
"RTN","ORQ20",78,0)
 I CODE="NW",$P(OR3,U,11) S NAME=NAME_$S($P(OR3,U,11)=1:" (Change)",$P(OR3,U,11)=2:" (Renewal)",1:"")
"RTN","ORQ20",79,0)
 Q NAME
"RTN","ORQ20",80,0)
 ;
"RTN","ORQ20",81,0)
XACT(X) ; -- Return name of transaction code X
"RTN","ORQ20",82,0)
 N Y S X=$G(X)
"RTN","ORQ20",83,0)
 S Y=$S(X="XX":"Edited",X="DC":"Discontinued",X="HD":"Held",X="RL":"Hold Released",X="FW":"Forwarded",X="CA":"Cancelled",1:"")
"RTN","ORQ20",84,0)
 Q Y
"RTN","ORQ20",85,0)
 ;
"RTN","ORQ20",86,0)
DATE(X) ; -- Return date formatted as 00/00/0000 00:00
"RTN","ORQ20",87,0)
 N T,Y  S T=$P(X,".",2)_"0000"
"RTN","ORQ20",88,0)
 S Y=$E(X,4,5)_"/"_$E(X,6,7)_"/"_(1700+$E(X,1,3))
"RTN","ORQ20",89,0)
 I T S Y=Y_" "_$E(T,1,2)_":"_$E(T,3,4)
"RTN","ORQ20",90,0)
 Q Y
"RTN","ORQ20",91,0)
 ;
"RTN","ORQ20",92,0)
USER(X) ; -- Returns NAME (TITLE) of New Person X
"RTN","ORQ20",93,0)
 N X0,Y S X0=$G(^VA(200,+X,0)),Y=$P(X0,U)
"RTN","ORQ20",94,0)
 S:$P(X0,U,9) Y=Y_" ("_$E($P($G(^DIC(3.1,+$P(X0,U,9),0)),U),1,15)_")"
"RTN","ORQ20",95,0)
 Q Y
"RTN","ORQ20",96,0)
 ;
"RTN","ORQ20",97,0)
SIG(X) ; -- Returns text of signature status X
"RTN","ORQ20",98,0)
 N Y S Y=""
"RTN","ORQ20",99,0)
 I X=0 S Y="ON CHART WITH WRITTEN ORDERS"
"RTN","ORQ20",100,0)
 I X=1 S Y="ELECTRONICALLY SIGNED"
"RTN","ORQ20",101,0)
 I X=2 S Y="NOT SIGNED"
"RTN","ORQ20",102,0)
 I X=3 S Y="NOT REQUIRED"
"RTN","ORQ20",103,0)
 I X=4 S Y="ON CHART WITH PRINTED ORDERS"
"RTN","ORQ20",104,0)
 I X=5 S Y="NOT REQUIRED DUE TO SERVICE CANCEL/LAPSE"
"RTN","ORQ20",105,0)
 I X=6 S Y="SERVICE CORRECTION TO SIGNED ORDER"
"RTN","ORQ20",106,0)
 Q Y
"RTN","ORQ20",107,0)
 ;
"RTN","ORQ20",108,0)
SERVCORR() ; -- Returns 1 or 0, if current ACTION is a serv corr change
"RTN","ORQ20",109,0)
 N Y,NATURE,I,X S Y=0
"RTN","ORQ20",110,0)
 G:ORACT'="XX" SCQ
"RTN","ORQ20",111,0)
 S NATURE=+$P(ACTION,U,12),NATURE=$P($G(^ORD(100.02,NATURE,0)),U,2)
"RTN","ORQ20",112,0)
 I "^S^I^"'[(U_NATURE_U) G SCQ
"RTN","ORQ20",113,0)
 S I=$O(^OR(100,ORIFN,8,ORI),-1),X=$G(^(I,0))
"RTN","ORQ20",114,0)
 I $P(X,U,3)'=$P(ACTION,U,3),$P(X,U,5)'=$P(ACTION,U,3) G SCQ ;show prov
"RTN","ORQ20",115,0)
 S Y=1
"RTN","ORQ20",116,0)
SCQ Q Y
"RTN","ORQ20",117,0)
 ;
"RTN","ORQ20",118,0)
EVENT(ORTX,DC) ; -- Returns patient event info for EVT
"RTN","ORQ20",119,0)
 N EVT1,REL,X,Y,I,ORMAX
"RTN","ORQ20",120,0)
 S ORTX(1)="" ;177
"RTN","ORQ20",121,0)
 S EVT1=$G(^ORE(100.2,EVT,1)),REL=$G(^ORE(100.2,EVT,2,ORIFN,0))
"RTN","ORQ20",122,0)
 ; Return event data if AutoDC or auto-released by an event:
"RTN","ORQ20",123,0)
 I $G(DC)!(REL&'$L($P(REL,U,2))&($P(EVT1,U,2)!$P(EVT1,U,4))) D  Q
"RTN","ORQ20",124,0)
 . S Y=$S($P(EVT1,U,5):$P(EVT1,U,5),1:EVT) ;parent owns Activity
"RTN","ORQ20",125,0)
 . S Y=+$O(^ORE(100.2,+Y,10,0)),Y=$G(^(Y,0)),X=$P(Y,U,4) Q:'$L(X)
"RTN","ORQ20",126,0)
 . S X=$S(X="A":"ADMISSION",X="T":"TRANSFER",X="D":"DISCHARGE",X="S":"SPECIALTY CHANGE",1:$S($P(EVT1,U)>$$DPI^ORUTL1("SR*3.0*157"):"IN TO O.R.",1:"OUT OF O.R."))_" on "_$$DATE($P(EVT1,U)) ;243
"RTN","ORQ20",127,0)
 . S ORTX(1)=X,ORTX=1,ORMAX=56
"RTN","ORQ20",128,0)
 . I $P(Y,U,6) S X=$S($P(Y,U,4)="D":"from ",1:"to ")_$$GET1^DIQ(45.7,+$P(Y,U,6)_",",.01) D TXT^ORCHTAB
"RTN","ORQ20",129,0)
 . I $P(Y,U,7) S X="on "_$$GET1^DIQ(42,+$P(Y,U,7)_",",.01) D TXT^ORCHTAB
"RTN","ORQ20",130,0)
 S X=$$USER(+$P(ACTION,U,17))_" on "_$$DATE($P(ACTION,U,16))
"RTN","ORQ20",131,0)
 I ORIFN'=+$P($G(^ORE(100.2,EVT,0)),U,4),$P(REL,U,2)="MN" S X=X_" (manually released)"
"RTN","ORQ20",132,0)
 S ORTX(1)=X
"RTN","ORQ20",133,0)
 Q
"RTN","ORQ21")
0^46^B35097340
"RTN","ORQ21",1,0)
ORQ21 ; SLC/MKB/GSS - Detailed Order Report cont ; 12/28/2006
"RTN","ORQ21",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141,190,195,215,243**;Dec 17, 1997;Build 242
"RTN","ORQ21",3,0)
 ;
"RTN","ORQ21",4,0)
 ; DBIA 2400   OEL^PSOORRL   ^TMP("PS",$J)
"RTN","ORQ21",5,0)
 ; DBIA 2266   EN30^RAO7PC1  ^TMP($J,"RAE2")
"RTN","ORQ21",6,0)
 ; 
"RTN","ORQ21",7,0)
RAD(TCOM) ; -- add RA data for 2.5 orders
"RTN","ORQ21",8,0)
 N RAIFN,CASE,PROC,ORD,ORI,X,ORTTL,ORB
"RTN","ORQ21",9,0)
 S RAIFN=$G(^OR(100,ORIFN,4)) Q:RAIFN'>0
"RTN","ORQ21",10,0)
 D EN30^RAO7PC1(RAIFN) Q:'$D(^TMP($J,"RAE2",+ORVP))  ;DBIA 2266
"RTN","ORQ21",11,0)
 S ORD=$G(^TMP($J,"RAE2",+ORVP,"ORD")),CASE=$O(^(0)) Q:'CASE  S PROC=$O(^(CASE,""))
"RTN","ORQ21",12,0)
 I '$G(TCOM) D  ;else add only Tech Comments
"RTN","ORQ21",13,0)
 . S CNT=CNT+1,@ORY@(CNT)=$$LJ^XLFSTR("Procedure:",30)_$S($L(ORD):ORD,1:PROC)
"RTN","ORQ21",14,0)
 . S ORI=0,ORTTL="Procedure Modifiers:          ",ORB=1
"RTN","ORQ21",15,0)
 . F  S ORI=$O(^TMP($J,"RAE2",+ORVP,CASE,PROC,"M",ORI)) Q:ORI'>0  S CNT=CNT+1,@ORY@(CNT)=ORTTL_^(ORI),ORTTL=$$REPEAT^XLFSTR(" ",30)
"RTN","ORQ21",16,0)
 . S CNT=CNT+1,@ORY@(CNT)="History and Reason for Exam:"
"RTN","ORQ21",17,0)
 . F  S ORI=$O(^TMP($J,"RAE2",+ORVP,CASE,PROC,"H",ORI)) Q:ORI'>0  S CNT=CNT+1,@ORY@(CNT)="  "_^(ORI)
"RTN","ORQ21",18,0)
RAD1 I $L($G(^TMP($J,"RAE2",+ORVP,CASE,PROC,"TCOM",1))) S X=^(1) D
"RTN","ORQ21",19,0)
 . N DIWL,DIWR,DIWF,I K ^UTILITY($J,"W")
"RTN","ORQ21",20,0)
 . S DIWL=1,DIWR=72,DIWF="C72" D ^DIWP
"RTN","ORQ21",21,0)
 . S CNT=CNT+1,@ORY@(CNT)="Technologist's Comment:",ORB=1
"RTN","ORQ21",22,0)
 . S I=0 F  S I=$O(^UTILITY($J,"W",DIWL,I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)="  "_^(I,0)
"RTN","ORQ21",23,0)
 I $D(^TMP($J,"RAE2",+ORVP,CASE,PROC,"CM")) D
"RTN","ORQ21",24,0)
 . S ORTTL="Contrast Media used:          ",ORI=0,ORB=1
"RTN","ORQ21",25,0)
 . F  S ORI=$O(^TMP($J,"RAE2",+ORVP,CASE,PROC,"CM",ORI)) Q:ORI<1  S CNT=CNT+1,@ORY@(CNT)=ORTTL_$P(^(ORI),U,2),ORTTL=$$REPEAT^XLFSTR(" ",30)
"RTN","ORQ21",26,0)
 K ^TMP($J,"RAE2",+ORVP),^UTILITY($J,"W")
"RTN","ORQ21",27,0)
 S:$G(ORB) CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ21",28,0)
 Q
"RTN","ORQ21",29,0)
 ;
"RTN","ORQ21",30,0)
MED ; -- Add Pharmacy order data
"RTN","ORQ21",31,0)
 Q:$G(^OR(100,ORIFN,4))["N"  ;non-VA med -- no refill history
"RTN","ORQ21",32,0)
 N TYPE,NODE,RXN,OR5,STAT S TYPE=$P(OR0,U,12)
"RTN","ORQ21",33,0)
 I '$D(^TMP("PS",$J,0)) D  ;get PS data / DBIA 2400
"RTN","ORQ21",34,0)
 . N PSIFN S PSIFN=$G(^OR(100,ORIFN,4))
"RTN","ORQ21",35,0)
 . S:TYPE="O" PSIFN=$TR(PSIFN,"S","P")_$S(PSIFN?1.N:"R",1:"")
"RTN","ORQ21",36,0)
 . D OEL^PSOORRL(+ORVP,PSIFN_";"_TYPE)  ;DBIA 2400
"RTN","ORQ21",37,0)
 S NODE=$G(^TMP("PS",$J,0)),RXN=$G(^("RXN",0)),STAT=$P(NODE,U,6)
"RTN","ORQ21",38,0)
 I '$L(NODE) K ^TMP("PS",$J) Q  ;error
"RTN","ORQ21",39,0)
 I $O(^TMP("PS",$J,"DD",0)) D  ;Disp Drugs
"RTN","ORQ21",40,0)
 . N I,X,Y S X="Dispense Drugs (units/dose):  ",I=0
"RTN","ORQ21",41,0)
 . F  S I=$O(^TMP("PS",$J,"DD",I)) Q:I'>0  S Y=$G(^(I,0)) S:Y CNT=CNT+1,@ORY@(CNT)=X_$$GET1^DIQ(50,+Y_",",.01)_" ("_$P(Y,U,2)_")"
"RTN","ORQ21",42,0)
 S:$P(NODE,U,9) CNT=CNT+1,@ORY@(CNT)="Total Dose:                   "_$P(NODE,U,9)
"RTN","ORQ21",43,0)
M1 I TYPE="I" D  ;admin data
"RTN","ORQ21",44,0)
 . N I,X,Y I $O(^TMP("PS",$J,"B",0)) D
"RTN","ORQ21",45,0)
 .. S X="IV Print Name:                ",I=0
"RTN","ORQ21",46,0)
 .. F  S I=$O(^TMP("PS",$J,"B",I)) Q:I<1  S Y=$G(^(I,0)) S:$L(Y) CNT=CNT+1,@ORY@(CNT)=X_$P(Y,U),X=$$REPEAT^XLFSTR(" ",30) I $L($P(Y,U,3)) S CNT=CNT+1,@ORY@(CNT)=X_" "_$P(Y,U,3)
"RTN","ORQ21",47,0)
 . S I=+$O(^TMP("PS",$J,"SCH",0)),X=$P($G(^(I,0)),U,2)
"RTN","ORQ21",48,0)
 . S:$L(X) CNT=CNT+1,@ORY@(CNT)="Schedule Type:                "_X
"RTN","ORQ21",49,0)
 . S X="Administration Times:         ",I=0
"RTN","ORQ21",50,0)
 . F  S I=$O(^TMP("PS",$J,"ADM",I)) Q:I'>0  S Y=$G(^(I,0)) S:$L(Y) CNT=CNT+1,@ORY@(CNT)=X_Y,X=$$REPEAT^XLFSTR(" ",30)
"RTN","ORQ21",51,0)
M2 I TYPE="O" D  ;fill history
"RTN","ORQ21",52,0)
 . N FILLD,RET,X,Y,I
"RTN","ORQ21",53,0)
 . S:$P(NODE,U,12) CNT=CNT+1,@ORY@(CNT)="Last Filled:                  "_$$FMTE^XLFDT($P(NODE,U,12),2)
"RTN","ORQ21",54,0)
 . S CNT=CNT+1,@ORY@(CNT)="Refills Remaining:            "_$P(NODE,U,4)
"RTN","ORQ21",55,0)
 . I $P(RXN,U,6)!$G(^TMP("PS",$J,"REF",0)) S X="Filled:                       " D
"RTN","ORQ21",56,0)
 .. I $P(RXN,U,6) S FILLD=$P(RXN,U,6)_"^^^"_$P(RXN,U,7)_U_$P(RXN,U,3,4) D FILLED("R")
"RTN","ORQ21",57,0)
 .. S RET=$G(^TMP("PS",$J,"RXN","RSTC")) I RET'="" D RETURNS(RET)
"RTN","ORQ21",58,0)
 .. S I=0 F  S I=$O(^TMP("PS",$J,"REF",I)) Q:I'>0  D
"RTN","ORQ21",59,0)
 ... S FILLD=$G(^(I,0)) D FILLED("R")
"RTN","ORQ21",60,0)
 ... S RET=$G(^TMP("PS",$J,"REF",I,"RSTC")) I RET'="" D RETURNS(RET)
"RTN","ORQ21",61,0)
 . I $G(^TMP("PS",$J,"PAR",0)) S I=0,X="Partial Fills:      " F  S I=$O(^TMP("PS",$J,"PAR",I)) Q:I'>0  S FILLD=$G(^(I,0)) D FILLED("P")
"RTN","ORQ21",62,0)
 . S:RXN CNT=CNT+1,@ORY@(CNT)="Prescription#:                "_$P(RXN,U)
"RTN","ORQ21",63,0)
M3 S:$P(RXN,U,5) CNT=CNT+1,@ORY@(CNT)="Pharmacist:                   "_$P($G(^VA(200,+$P(RXN,U,5),0)),U)
"RTN","ORQ21",64,0)
    I $G(STAT)="ACTIVE/SUSP" S CNT=CNT+1,@ORY@(CNT)="Prescription Status:          "_STAT_" - Order is active. Fill or Refill has been requested."
"RTN","ORQ21",65,0)
 S:$P(NODE,U,13) CNT=CNT+1,@ORY@(CNT)="NOT TO BE GIVEN" K ^TMP("PS",$J)
"RTN","ORQ21",66,0)
 S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ21",67,0)
 S OR5=$G(^OR(100,ORIFN,5)) I $L(OR5) D  ;SC data
"RTN","ORQ21",68,0)
 . N X,Y,I
"RTN","ORQ21",69,0)
 . S CNT=CNT+1,@ORY@(CNT)="   " ;blank line
"RTN","ORQ21",70,0)
 . S CNT=CNT+1,@ORY@(CNT)="First Party Pay Exemptions"
"RTN","ORQ21",71,0)
 . S X="For conditions related to:    "
"RTN","ORQ21",72,0)
 . F I=1:1:8 S Y=$P(OR5,U,I) I Y S CNT=CNT+1,@ORY@(CNT)=X_$$SC(I),X=$$REPEAT^XLFSTR(" ",30)
"RTN","ORQ21",73,0)
 Q
"RTN","ORQ21",74,0)
 ;
"RTN","ORQ21",75,0)
BA ;Billing Aware data display
"RTN","ORQ21",76,0)
 N DXIEN,DXV,ICD9,ICDR,OCT,ORFMDAT
"RTN","ORQ21",77,0)
 S OCT=0,X=""
"RTN","ORQ21",78,0)
 ; Get the date of the order for CSV/CTD usage
"RTN","ORQ21",79,0)
 S ORFMDAT=$$ORFMDAT^ORWDBA3(ORIFN)
"RTN","ORQ21",80,0)
 ; $O through diagnoses for an order
"RTN","ORQ21",81,0)
 F  S OCT=$O(^OR(100,ORIFN,5.1,OCT)) Q:OCT'?1N.N  D
"RTN","ORQ21",82,0)
 . ; DXIEN=Dx IEN
"RTN","ORQ21",83,0)
 . S DXIEN=+^OR(100,ORIFN,5.1,OCT,0)
"RTN","ORQ21",84,0)
 . ; Get Dx record for date ORFMDAT
"RTN","ORQ21",85,0)
 . S ICDR=$$ICDDX^ICDCODE(DXIEN,ORFMDAT)
"RTN","ORQ21",86,0)
 . ; Get Dx verbiage and ICD code
"RTN","ORQ21",87,0)
 . S DXV=$P(ICDR,U,4),ICD9=$P(ICDR,U,2)
"RTN","ORQ21",88,0)
 . S X="               "
"RTN","ORQ21",89,0)
 . I OCT=1 D
"RTN","ORQ21",90,0)
 .. S CNT=CNT+1,@ORY@(CNT)="   " ;blank line
"RTN","ORQ21",91,0)
 .. S CNT=CNT+1,@ORY@(CNT)="Clinical Indicators"
"RTN","ORQ21",92,0)
 .. S X="Diagnosis of:  "
"RTN","ORQ21",93,0)
 . S X=X_ICD9_" - "_DXV,CNT=CNT+1,@ORY@(CNT)=X
"RTN","ORQ21",94,0)
 I OCT'="" D  ;if there are diagnoses show Treatment Factors
"RTN","ORQ21",95,0)
 . S X="For conditions related to:    "
"RTN","ORQ21",96,0)
 . F I=1:1:8 S Y=$P(^OR(100,ORIFN,5.2),U,I) I Y D
"RTN","ORQ21",97,0)
 .. S CNT=CNT+1,@ORY@(CNT)=X_$$SC(I),X=$$REPEAT^XLFSTR(" ",30)
"RTN","ORQ21",98,0)
 Q
"RTN","ORQ21",99,0)
 ;
"RTN","ORQ21",100,0)
FILLED(TYPE) ; -- add FILLD data
"RTN","ORQ21",101,0)
 N Y S Y=$$FMTE^XLFDT($P(FILLD,U),2)_" ("_$$ROUTING($P(FILLD,U,5))_")"
"RTN","ORQ21",102,0)
 S:TYPE="R"&$P(FILLD,U,4) Y=Y_" released "_$$FMTE^XLFDT($P(FILLD,U,4),2)
"RTN","ORQ21",103,0)
 S:TYPE="P"&$P(FILLD,U,3) Y=Y_" Qty: "_$P(FILLD,U,3)
"RTN","ORQ21",104,0)
 S CNT=CNT+1,@ORY@(CNT)=X_Y,X=$$REPEAT^XLFSTR(" ",30)
"RTN","ORQ21",105,0)
 S:$L($P(FILLD,U,6)) CNT=CNT+1,@ORY@(CNT)=X_$P(FILLD,U,6)
"RTN","ORQ21",106,0)
 Q
"RTN","ORQ21",107,0)
RETURNS(NODE) ; add Return to Stock Data
"RTN","ORQ21",108,0)
 N DATE,NAME,TEXT,X
"RTN","ORQ21",109,0)
 S DATE=$$FMTE^XLFDT($P(NODE,U))
"RTN","ORQ21",110,0)
 S NAME=$P(^VA(200,$P(NODE,U,2),0),U)
"RTN","ORQ21",111,0)
 S X=$$REPEAT^XLFSTR(" ",13)
"RTN","ORQ21",112,0)
 S TEXT="Return to Stock: "_X_DATE_" by "_NAME
"RTN","ORQ21",113,0)
 S CNT=CNT+1,@ORY@(CNT)=TEXT
"RTN","ORQ21",114,0)
 S X=$$REPEAT^XLFSTR(" ",30)
"RTN","ORQ21",115,0)
 S TEXT=X_"Comments: "_$P(NODE,U,3)
"RTN","ORQ21",116,0)
 S CNT=CNT+1,@ORY@(CNT)=TEXT
"RTN","ORQ21",117,0)
 Q
"RTN","ORQ21",118,0)
 ;
"RTN","ORQ21",119,0)
ROUTING(X) ; -- Returns external form
"RTN","ORQ21",120,0)
 N Y S Y=$S($G(X)="M":"Mail",$G(X)="W":"Window",1:$G(X))
"RTN","ORQ21",121,0)
 Q Y
"RTN","ORQ21",122,0)
 ;
"RTN","ORQ21",123,0)
SC(J) ; -- Returns name of SC field by piece number
"RTN","ORQ21",124,0)
 I '$G(J) Q ""
"RTN","ORQ21",125,0)
 I J=1 Q "SERVICE CONNECTED CONDITION"
"RTN","ORQ21",126,0)
 I J=2 Q "MILITARY SEXUAL TRAUMA"
"RTN","ORQ21",127,0)
 I J=3 Q "AGENT ORANGE EXPOSURE"
"RTN","ORQ21",128,0)
 I J=4 Q "IONIZING RADIATION EXPOSURE"
"RTN","ORQ21",129,0)
 I J=5 Q "ENVIRONMENTAL CONTAMINANTS"
"RTN","ORQ21",130,0)
 I J=6 Q "HEAD OR NECK CANCER"
"RTN","ORQ21",131,0)
 I J=7 Q "COMBAT VETERAN"
"RTN","ORQ21",132,0)
 I J=8 Q "SHIPBOARD HAZARD AND DEFENSE"
"RTN","ORQ21",133,0)
 Q ""
"RTN","ORQPT")
0^161^B73861080
"RTN","ORQPT",1,0)
ORQPT ; SLC/MKB - Patient Selection ; 4/18/07 7:20am
"RTN","ORQPT",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**52,82,85,215,243**;Dec 17, 1997;Build 242
"RTN","ORQPT",3,0)
 ;
"RTN","ORQPT",4,0)
 ; Ref. to ^UTILITY via IA 10061
"RTN","ORQPT",5,0)
 ; SLC/PKS - 3/2000: Modified to deal with "Combinations."
"RTN","ORQPT",6,0)
 ;
"RTN","ORQPT",7,0)
EN ; -- main entry point for OR PATIENT SELECTION
"RTN","ORQPT",8,0)
 I $G(ORVP),'($D(ORPNM)&$D(ORSSN)) K ORVP ; reset
"RTN","ORQPT",9,0)
 D EN^VALM("OR PATIENT SELECTION")
"RTN","ORQPT",10,0)
 Q
"RTN","ORQPT",11,0)
 ;
"RTN","ORQPT",12,0)
HDR ; -- header code
"RTN","ORQPT",13,0)
 N X I '$G(ORVP) S X="** No patient selected **"
"RTN","ORQPT",14,0)
 E  S X=$G(ORPNM)_"   "_$G(ORSSN)
"RTN","ORQPT",15,0)
 S VALMHDR(1)="Current patient: "_X
"RTN","ORQPT",16,0)
 Q
"RTN","ORQPT",17,0)
 ;
"RTN","ORQPT",18,0)
INIT ; -- init variables and list array
"RTN","ORQPT",19,0)
 ; Modifications for multiple "Combination" lists by PKS.
"RTN","ORQPT",20,0)
 ;
"RTN","ORQPT",21,0)
 ; PARAM herein might end up as: ORLP DEFAULT CLINIC WEDNESDAY
"RTN","ORQPT",22,0)
 ;    (Param Name and current DOW)
"RTN","ORQPT",23,0)
 ; ORY might end up passed as:  5^5^C;1;T-360;T+60;A
"RTN","ORQPT",24,0)
 ;    (#lines^#pts^source;serviceSection;startDate;stopDate;sort)
"RTN","ORQPT",25,0)
 ;
"RTN","ORQPT",26,0)
 N ORY,ORX,PARAM,ORYZB,ORYZE
"RTN","ORQPT",27,0)
 ;
"RTN","ORQPT",28,0)
 ;added by CLA 12/12/96 - gets SERVICE/SECTION of user:
"RTN","ORQPT",29,0)
 N ORSRV S ORSRV=$G(^VA(200,DUZ,5)) I +ORSRV>0 S ORSRV=$P(ORSRV,U)
"RTN","ORQPT",30,0)
 ;
"RTN","ORQPT",31,0)
 S ORY=$$GET^XPAR("USR^SRV.`"_$G(ORSRV),"ORLP DEFAULT LIST SOURCE",1,"I") ; Gets default list source for this user.
"RTN","ORQPT",32,0)
 I $L(ORY) D  S ORY=ORY_";"_ORX
"RTN","ORQPT",33,0)
 . ; PKS: Set "PARAM" var to parameter name in param def file:
"RTN","ORQPT",34,0)
 . S PARAM="ORLP DEFAULT "_$S(ORY="T":"TEAM",ORY="S":"SPECIALTY",ORY="P":"PROVIDER",ORY="W":"WARD",ORY="C":"CLINIC",ORY="M":"COMBINATION",1:"")
"RTN","ORQPT",35,0)
 . S:ORY="C" PARAM=PARAM_" "_$$UP^XLFSTR($$DOW^XLFDT(DT)) ; For clinics, add current DOW.
"RTN","ORQPT",36,0)
 . S ORX=$$GET^XPAR("USR^SRV.`"_$G(ORSRV),PARAM,1,"I") ; Source param.
"RTN","ORQPT",37,0)
 . ; Next lines modified by PKS for "Combinations" and dates:
"RTN","ORQPT",38,0)
 . I (ORY="C")!(ORY="M") D
"RTN","ORQPT",39,0)
 . . S ORYZB=$$UP^XLFSTR($$GET^XPAR("USR^SRV.`"_$G(ORSRV)_"^DIV^SYS^PKG","ORLP DEFAULT CLINIC START DATE",1,"I")) ; Gets clinic start date.
"RTN","ORQPT",40,0)
 . . I ORYZB="T+0" S ORYZB=$$FMTE^XLFDT(DT,ORYZB)
"RTN","ORQPT",41,0)
 . . S ORX=ORX_";"_ORYZB
"RTN","ORQPT",42,0)
 . . S ORYZE=$$UP^XLFSTR($$GET^XPAR("USR^SRV.`"_$G(ORSRV)_"^DIV^SYS^PKG","ORLP DEFAULT CLINIC STOP DATE",1,"I")) ; Add ";" & stop date.
"RTN","ORQPT",43,0)
 . . I ORYZE="T+0" S ORYZE=$$FMTE^XLFDT(DT,ORYZE)
"RTN","ORQPT",44,0)
 . . S ORX=ORX_";"_ORYZE
"RTN","ORQPT",45,0)
 S $P(ORY,";",5)=$$GET^XPAR("USR^SRV.`"_$G(ORSRV)_"^DIV^SYS^PKG","ORLP DEFAULT LIST ORDER",1,"I") ; Add default sort order.
"RTN","ORQPT",46,0)
 ;
"RTN","ORQPT",47,0)
 ; Call tag that builds the actual Patient Selection List:
"RTN","ORQPT",48,0)
 D BUILD(ORY)
"RTN","ORQPT",49,0)
 Q
"RTN","ORQPT",50,0)
 ;
"RTN","ORQPT",51,0)
DEFAULT() ; -- Returns default action
"RTN","ORQPT",52,0)
 I '$P($G(^TMP("OR",$J,"PATIENTS",0)),U,2) Q "Change View"
"RTN","ORQPT",53,0)
 I XQORM("B")="Quit" Q "Close"
"RTN","ORQPT",54,0)
 Q "Next Screen"
"RTN","ORQPT",55,0)
 ;
"RTN","ORQPT",56,0)
MSG() ; -- Lmgr msg bar
"RTN","ORQPT",57,0)
 Q "Enter the number of the patient chart to be opened"
"RTN","ORQPT",58,0)
 ;
"RTN","ORQPT",59,0)
HELP ; -- help code
"RTN","ORQPT",60,0)
 N X D FULL^VALM1 S VALMBCK="R"
"RTN","ORQPT",61,0)
 W !!,"Enter the display number of the patient whose chart you wish to open"
"RTN","ORQPT",62,0)
 W !,"or enter a patient name, SSN, or initial/last 4 combination.  To"
"RTN","ORQPT",63,0)
 W !,"change the list of patients displayed on this screen, enter CV.  To"
"RTN","ORQPT",64,0)
 W !,"have the new list automatically displayed when selecting a new patient,"
"RTN","ORQPT",65,0)
 W !,"enter SV.  Enter FD to search by patient name or identifier."
"RTN","ORQPT",66,0)
 W !!,"Press <return> to continue ..." R X:DTIME
"RTN","ORQPT",67,0)
 Q
"RTN","ORQPT",68,0)
 ;
"RTN","ORQPT",69,0)
EXIT ; -- exit code
"RTN","ORQPT",70,0)
 K ^TMP("OR",$J,"PATIENTS"),XQORM("ALT")
"RTN","ORQPT",71,0)
 Q
"RTN","ORQPT",72,0)
 ;
"RTN","ORQPT",73,0)
BUILD(LIST) ; -- build list in ^TMP("OR",$J,"PATIENTS")
"RTN","ORQPT",74,0)
 N ORI,ORX,ORY,LCNT,NUM,DFN,NAME,TYPE,PTR,BEG,END,SORT,DOB,RBED,%DT,X,Y,TITLE,PTID,SENS
"RTN","ORQPT",75,0)
 S TYPE=$E(LIST),PTR=+$P(LIST,";",2),SORT=$P(LIST,";",5)
"RTN","ORQPT",76,0)
 ; Next 5 lines added by PKS:
"RTN","ORQPT",77,0)
 I ((SORT="S")&(TYPE'="M")) S SORT="A"    ; Reset invalid sorts.
"RTN","ORQPT",78,0)
 I TYPE="M" D                             ; Deal with combinations.
"RTN","ORQPT",79,0)
 .I ((SORT="P")!(SORT="A")!(SORT="S")) Q  ; P,A,S are acceptable.
"RTN","ORQPT",80,0)
 .S SORT="A"                              ; Default.
"RTN","ORQPT",81,0)
 S $P(LIST,";",5)=SORT                    ; Reset in case of change.
"RTN","ORQPT",82,0)
 S BEG=$P(LIST,";",3) I $L(BEG) S X=BEG,%DT="X" D ^%DT S BEG=Y
"RTN","ORQPT",83,0)
 S END=$P(LIST,";",4) I $L(END) S X=END,%DT="X" D ^%DT S END=Y
"RTN","ORQPT",84,0)
 I TYPE="T" D TEAMPTS^ORQPTQ1(.ORY,PTR) S TITLE="Team "_$P($G(^OR(100.21,+PTR,0)),U)
"RTN","ORQPT",85,0)
 I TYPE="P" D PROVPTS^ORQPTQ2(.ORY,PTR) S TITLE="Provider "_$P($G(^VA(200,+PTR,0)),U)
"RTN","ORQPT",86,0)
 I TYPE="S" D SPECPTS^ORQPTQ2(.ORY,PTR) S TITLE="Specialty "_$P($G(^DIC(45.7,+PTR,0)),U)
"RTN","ORQPT",87,0)
 I TYPE="W" D WARDPTS^ORQPTQ2(.ORY,PTR) S TITLE="Ward "_$P($G(^DIC(42,+PTR,0)),U)
"RTN","ORQPT",88,0)
 I TYPE="C" D CLINPTS^ORQPTQ2(.ORY,PTR,BEG,END) S TITLE="Clinic "_$P($G(^SC(+PTR,0)),U)
"RTN","ORQPT",89,0)
 ; Next line added by PKS for "Combinations:"
"RTN","ORQPT",90,0)
 I TYPE="M" N MSG D COMBPTS^ORQPTQ6(1,PTR,BEG,END) S TITLE="Combination List" ; Sets MSG,LCNT,NUM, and writes ^TMP("OR",$J,"PATIENTS").
"RTN","ORQPT",91,0)
 ; Next section added by PKS for "Combinations:"
"RTN","ORQPT",92,0)
 I TYPE="M" D  G BQ    ; Check MSG var, then go to BQ tag.
"RTN","ORQPT",93,0)
 .I MSG'="" D          ; Did call to COMBPTS assign an error message?
"RTN","ORQPT",94,0)
 ..S LCNT=1,NUM=0      ; Set defaults.
"RTN","ORQPT",95,0)
 ..S ^TMP("OR",$J,"PATIENTS",1,0)="     "_MSG ; Write error msg.
"RTN","ORQPT",96,0)
 D CLEAN^VALM10 S (LCNT,NUM)=0 ; All but "M" types reset, go on to B1.
"RTN","ORQPT",97,0)
 ;
"RTN","ORQPT",98,0)
B1 S ORI=0 F  S ORI=$O(ORY(ORI)) Q:ORI'>0  I ORY(ORI) D  ; sort
"RTN","ORQPT",99,0)
 . S DFN=+ORY(ORI)
"RTN","ORQPT",100,0)
 . ;sort logic added by CLA 7/23/97:
"RTN","ORQPT",101,0)
 . S ORX=""
"RTN","ORQPT",102,0)
 . I SORT="P",(TYPE="C") S ORX=$P($G(ORY(ORI)),U,4) D
"RTN","ORQPT",103,0)
 .. S $P(ORX,".",2)=$E($P(ORX,".",2)_"000",1,4)
"RTN","ORQPT",104,0)
 ..S ORX=ORX_U_$P(ORY(ORI),U,2)
"RTN","ORQPT",105,0)
 . I SORT="R",(TYPE'="C") S ORX=$P($G(^DPT(+ORY(ORI),.101)),U)_U_$P(ORY(ORI),U,2)
"RTN","ORQPT",106,0)
 . I SORT="T" S ORX="" ; Need to add terminal digit sorting.
"RTN","ORQPT",107,0)
 . ; If no sort specified, default to alphabetic (plus app't if clinic type):
"RTN","ORQPT",108,0)
 . I ORX="" S ORX=$P(ORY(ORI),U,2)_U_$P($G(ORY(ORI)),U,4)
"RTN","ORQPT",109,0)
 . S ^TMP("OR",$J,"PATIENTS","B",ORX_DFN)=ORY(ORI) ; DFN ^ Name
"RTN","ORQPT",110,0)
 I '$D(^TMP("OR",$J,"PATIENTS")) D  G BQ
"RTN","ORQPT",111,0)
 . N MSG
"RTN","ORQPT",112,0)
 . S MSG="No patients found"
"RTN","ORQPT",113,0)
 . S LCNT=1,NUM=0
"RTN","ORQPT",114,0)
 . I $D(ORY(1)) S MSG=$P(ORY(1),"^",2) ; error message from search
"RTN","ORQPT",115,0)
 . S ^TMP("OR",$J,"PATIENTS",1,0)="     "_MSG
"RTN","ORQPT",116,0)
B2 S ORX="" F  S ORX=$O(^TMP("OR",$J,"PATIENTS","B",ORX)) Q:ORX=""  S ORY=^(ORX) D
"RTN","ORQPT",117,0)
 . S DFN=+ORY,NAME=$P(ORY,U,2)
"RTN","ORQPT",118,0)
 . S DOB=$$FMTE^XLFDT($P($G(^DPT(DFN,0)),U,3))
"RTN","ORQPT",119,0)
 . S:(TYPE'="C") RBED=$P($G(^DPT(DFN,.101)),U)
"RTN","ORQPT",120,0)
 . I (TYPE="C") S RBED=$S(SORT="P":$$FMTE^XLFDT($P(ORX,U)),1:$$FMTE^XLFDT($P(^TMP("OR",$J,"PATIENTS","B",ORX),U,4)))
"RTN","ORQPT",121,0)
 . ;Q:RBED=""  removed by CLA 7/23/97 to prevent blank lines
"RTN","ORQPT",122,0)
 . S LCNT=LCNT+1,NUM=NUM+1
"RTN","ORQPT",123,0)
 . S ^TMP("OR",$J,"PATIENTS","IDX",NUM)=ORY ; DFN ^ NAME
"RTN","ORQPT",124,0)
 . ; Next lines modified/added by PKS on 1/24/2001:
"RTN","ORQPT",125,0)
 . ; Check for "sensitive" patients:
"RTN","ORQPT",126,0)
 . S PTID=""
"RTN","ORQPT",127,0)
 . S PTID=$$ID(DFN)
"RTN","ORQPT",128,0)
 . S SENS=$$SSN^DPTLK1(DFN)
"RTN","ORQPT",129,0)
 . I SENS["*" S PTID=""
"RTN","ORQPT",130,0)
 . S DOB=$$DOB^DPTLK1(DFN)
"RTN","ORQPT",131,0)
 . S ^TMP("OR",$J,"PATIENTS",LCNT,0)=$$LJ^XLFSTR(NUM,5)_$$LJ^XLFSTR(NAME,31)_$$LJ^XLFSTR(PTID,10)_$$LJ^XLFSTR(DOB,15)_$G(RBED)
"RTN","ORQPT",132,0)
 . D CNTRL^VALM10(LCNT,1,5,IOINHI,IOINORM)
"RTN","ORQPT",133,0)
BQ S ^TMP("OR",$J,"PATIENTS",0)=LCNT_U_NUM_U_$G(LIST) ; #lines^#pts^context
"RTN","ORQPT",134,0)
 S ^TMP("OR",$J,"PATIENTS","#")=$O(^ORD(101,"B","ORQPT SELECT PATIENT",0))_"^1:"_NUM
"RTN","ORQPT",135,0)
 S RBED=$S(TYPE="C":"Appointment Date",TYPE="M":"Source   Other",1:"Room-Bed")
"RTN","ORQPT",136,0)
 D CHGCAP^VALM("ROOM-BED",RBED) K VALMHDR
"RTN","ORQPT",137,0)
 S VALMCNT=LCNT,VALMBG=1,VALMBCK="R" S:$L($G(TITLE)) VALM("TITLE")=TITLE
"RTN","ORQPT",138,0)
 Q
"RTN","ORQPT",139,0)
 ;
"RTN","ORQPT",140,0)
ID(DFN) ; -- Returns short ID for patient ID
"RTN","ORQPT",141,0)
 N ID S ID=$P($G(^DPT(DFN,.36)),U,4) ; short ID
"RTN","ORQPT",142,0)
 I '$L(ID) S ID=$E($P($G(^DPT(DFN,0)),U,9),6,9) ; last 4 of SSN
"RTN","ORQPT",143,0)
 Q "("_$E(NAME)_ID_")"
"RTN","ORQPT",144,0)
 ;
"RTN","ORQPT",145,0)
APPT(DFN,CLINIC,FROM,TO) ; -- Return [next?] clinic appointment
"RTN","ORQPT",146,0)
 ; returns date/time next appt or "", returns "^error message" on error
"RTN","ORQPT",147,0)
 N ERR,ERRMSG,VASD,VAERR K ^UTILITY("VASD",$J)  ;IA 10061
"RTN","ORQPT",148,0)
 S VASD("F")=FROM,VASD("T")=TO,VASD("C",CLINIC)=""
"RTN","ORQPT",149,0)
 D SDA^ORQRY01(.ERR,.ERRMSG)
"RTN","ORQPT",150,0)
 I ERR K ^UTILITY("VASD",$J) Q ERRMSG
"RTN","ORQPT",151,0)
 S NEXT=+$O(^UTILITY("VASD",$J,0)),NEXT=$P($G(^(NEXT,"I")),U)
"RTN","ORQPT",152,0)
 K ^UTILITY("VASD",$J)
"RTN","ORQPT",153,0)
 Q NEXT
"RTN","ORQPT",154,0)
 ;
"RTN","ORQPT",155,0)
ALT ; -- XQORM("ALT") code to search File 2 for patient X
"RTN","ORQPT",156,0)
 N DIC,DFN,Y,ORX S ORX=X D FULL^VALM1
"RTN","ORQPT",157,0)
 S DIC=2,DIC(0)="EQM",X=$S($D(XQORMRCL):" ",1:ORX)
"RTN","ORQPT",158,0)
 D ^DIC I Y'>0 S VALMBCK="R" Q  ;S XQORMERR=1 Q
"RTN","ORQPT",159,0)
 S ORX=+$G(^DPT(+Y,.35)) I ORX,'$$OK(ORX) S VALMBCK="R" Q
"RTN","ORQPT",160,0)
 S DFN=+Y G:DFN'=+$G(ORVP) SLCT1 ; set patient variables
"RTN","ORQPT",161,0)
 Q
"RTN","ORQPT",162,0)
 ;
"RTN","ORQPT",163,0)
FIND ; -- find patient in ^DPT
"RTN","ORQPT",164,0)
 N X,Y,DIC,ORX,DFN
"RTN","ORQPT",165,0)
 S DIC=2,DIC(0)="AEQM" D FULL^VALM1
"RTN","ORQPT",166,0)
 D ^DIC I Y'>0 S VALMBCK="R" Q
"RTN","ORQPT",167,0)
 S ORX=+$G(^DPT(+Y,.35)) I ORX,'$$OK(ORX) S VALMBCK="R" Q
"RTN","ORQPT",168,0)
 S DFN=+Y G:DFN'=+$G(ORVP) SLCT1 ; set patient variables
"RTN","ORQPT",169,0)
 Q
"RTN","ORQPT",170,0)
 ;
"RTN","ORQPT",171,0)
SELECT ; -- select patient from list
"RTN","ORQPT",172,0)
 N NMBR,X,Y,Z,DIC,DFN,ORX S NMBR=+$P(XQORNOD(0),"=",2)
"RTN","ORQPT",173,0)
 S Y=$G(^TMP("OR",$J,"PATIENTS","IDX",NMBR)),DFN=+Y
"RTN","ORQPT",174,0)
 I 'DFN W $C(7),!!,NMBR_" is not a valid selection.",! S VALMBCK="" H 1 Q
"RTN","ORQPT",175,0)
 ;W "   "_$P(Y,U,2) S ^DISV(DUZ,"^DPT(")=DFN
"RTN","ORQPT",176,0)
 D FULL^VALM1 S DIC=2,DIC(0)="EQM",X="`"_DFN D ^DIC I Y<0 S VALMBCK="R" Q
"RTN","ORQPT",177,0)
 S ORX=+$G(^DPT(+Y,.35)) I ORX,'$$OK(ORX) S VALMBCK="R" Q
"RTN","ORQPT",178,0)
SLCT1 ; -- may enter here with DFN from FIND
"RTN","ORQPT",179,0)
 N VADM,VAEL,VAIN,VA,VAERR,LOC,ORCNV
"RTN","ORQPT",180,0)
 D OERR^VADPT,ELIG^VADPT
"RTN","ORQPT",181,0)
 S LOC=+$G(^DIC(42,+VAIN(4),44))_";SC(" I 'LOC,'$D(XQAID) D
"RTN","ORQPT",182,0)
 . I $G(NMBR) N X S X=$$CONTEXT^ORQPT1 I $E(X)="C" S LOC=$P(X,";",2)_";SC(" Q:LOC  ; use clinic if selected from list, else ask
"RTN","ORQPT",183,0)
 . S LOC="" ;,X=$$LOCATION^ORCMENU1(1) S:X LOC=X
"RTN","ORQPT",184,0)
 S ORL=LOC,ORL(0)=$P($G(^SC(+ORL,0)),U),ORL(1)=VAIN(5)
"RTN","ORQPT",185,0)
 S ORVP=DFN_";DPT(",ORPNM=VADM(1),ORSSN=$P(VADM(2),U,2)
"RTN","ORQPT",186,0)
 S ORDOB=$P(VADM(3),U,2),ORAGE=VADM(4),ORSEX=$P(VADM(5),U)
"RTN","ORQPT",187,0)
 S ORTS=+VAIN(3),ORWARD=VAIN(4),ORATTEND=+VAIN(11),ORSC=$G(VAEL(3))
"RTN","ORQPT",188,0)
 I $P($G(^DGSL(38.1,+ORVP,0)),"^",2),($G(^DPT(+ORVP,.1))]""!$D(^XUSEC("DG SENSITIVITY",DUZ))) D
"RTN","ORQPT",189,0)
 . ; if senstive patient and (patient inpatient or user holds key)
"RTN","ORQPT",190,0)
 . ; prevents sensitive patient warning from scrolling off screen
"RTN","ORQPT",191,0)
 . N X
"RTN","ORQPT",192,0)
 . W !!,"Press <return> to continue ..."
"RTN","ORQPT",193,0)
 . R X:DTIME
"RTN","ORQPT",194,0)
SLCT2 ; -- convert patient's orders, if not already done
"RTN","ORQPT",195,0)
 Q
"RTN","ORQPT",196,0)
 ;
"RTN","ORQPT",197,0)
OK(DATE) ; -- Patient is deceased; ok to continue?
"RTN","ORQPT",198,0)
 N X,Y,DIR S DIR(0)="YA",DIR("B")="NO"
"RTN","ORQPT",199,0)
 S DIR("A")="Do you wish to continue? "
"RTN","ORQPT",200,0)
 W $C(7),!!,"This patient died "_$$FMTE^XLFDT(DATE)_"!"
"RTN","ORQPT",201,0)
 D ^DIR
"RTN","ORQPT",202,0)
 Q +Y
"RTN","ORQPTQ1")
0^58^B54791820
"RTN","ORQPTQ1",1,0)
ORQPTQ1 ; SLC/CLA - Functs which return OR patient lists and sources pt 1 ; 8/20/07 5:43am
"RTN","ORQPTQ1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**9,74,63,91,85,139,243**;Dec 17, 1997;Build 242
"RTN","ORQPTQ1",3,0)
VAMCPTS(Y) ; RETURN LIST OF PATIENTS IN VAMC: DFN^NAME
"RTN","ORQPTQ1",4,0)
 N I,J,V
"RTN","ORQPTQ1",5,0)
 S I=1
"RTN","ORQPTQ1",6,0)
 S J=0 F  S J=$O(^DPT("B",J)) Q:J=""  S V=0,V=$O(^DPT("B",J,V))  S Y(I)=V_"^"_J,I=I+1
"RTN","ORQPTQ1",7,0)
 Q
"RTN","ORQPTQ1",8,0)
VAMCLONG(Y,DIR,FROM) ; return a bolus of patients in VAMC: DFN^NAME
"RTN","ORQPTQ1",9,0)
 N I,IEN,CNT S CNT=44
"RTN","ORQPTQ1",10,0)
 I DIR=0 D  ; Forward direction
"RTN","ORQPTQ1",11,0)
 . F I=1:1:CNT S FROM=$O(^DPT("B",FROM)) Q:FROM=""  D
"RTN","ORQPTQ1",12,0)
 . . S Y(I)=$O(^DPT("B",FROM,0))_"^"_FROM
"RTN","ORQPTQ1",13,0)
 . I +$G(Y(CNT))="" S Y(I)=""
"RTN","ORQPTQ1",14,0)
 I DIR=1 D  ; Reverse direction
"RTN","ORQPTQ1",15,0)
 . F I=1:1:CNT S FROM=$O(^DPT("B",FROM),-1) Q:FROM=""  D
"RTN","ORQPTQ1",16,0)
 . . S Y(I)=$O(^DPT("B",FROM,0))_"^"_FROM
"RTN","ORQPTQ1",17,0)
 Q 
"RTN","ORQPTQ1",18,0)
DEFTM(ORY) ; return current user's default team list
"RTN","ORQPTQ1",19,0)
 Q:'$D(DUZ)
"RTN","ORQPTQ1",20,0)
 N ORSRV S ORSRV=$G(^VA(200,DUZ,5)) I +ORSRV>0 S ORSRV=$P(ORSRV,U)
"RTN","ORQPTQ1",21,0)
 S ORY=$$GET^XPAR("USR^SRV.`"_+$G(ORSRV),"ORLP DEFAULT TEAM",1,"B")
"RTN","ORQPTQ1",22,0)
 Q
"RTN","ORQPTQ1",23,0)
TEAMS(ORY) ; return list of teams for a system
"RTN","ORQPTQ1",24,0)
 ; Also called under DBIA # 2692.
"RTN","ORQPTQ1",25,0)
 N ORTM,I,ORTMN
"RTN","ORQPTQ1",26,0)
 S ORTMN="",I=1
"RTN","ORQPTQ1",27,0)
 F  S ORTMN=$O(^OR(100.21,"B",ORTMN)) Q:ORTMN=""  D
"RTN","ORQPTQ1",28,0)
 .S ORTM="",ORTM=$O(^OR(100.21,"B",ORTMN,ORTM)) Q:ORTM=""
"RTN","ORQPTQ1",29,0)
 .I $P($G(^OR(100.21,ORTM,11)),U)'=0!($D(^OR(100.21,ORTM,1,$G(DUZ,0)))) S ORY(I)=ORTM_U_ORTMN,I=I+1
"RTN","ORQPTQ1",30,0)
 S:+$G(ORY(1))<1 ORY(1)="^No teams found."
"RTN","ORQPTQ1",31,0)
 Q
"RTN","ORQPTQ1",32,0)
TEAMPTS(ORY,TEAM,TMPFLAG) ; RETURN LIST OF PATIENTS IN A TEAM
"RTN","ORQPTQ1",33,0)
 ; Also called under DBIA # 2692.
"RTN","ORQPTQ1",34,0)
 ; If TMPFLAG passed and = TRUE, code expects a "^TMP(xxx"
"RTN","ORQPTQ1",35,0)
 ;    global root string passed in ORY, and builds the returned 
"RTN","ORQPTQ1",36,0)
 ;    list in that global instead of to a memory array.
"RTN","ORQPTQ1",37,0)
 N DOTMP,NEWTMP
"RTN","ORQPTQ1",38,0)
 S DOTMP=0
"RTN","ORQPTQ1",39,0)
 I $G(TMPFLAG) D             ; Was value passed?
"RTN","ORQPTQ1",40,0)
 .I TMPFLAG S DOTMP=1        ; Is value TRUE?
"RTN","ORQPTQ1",41,0)
 I +$G(TEAM)<1 D
"RTN","ORQPTQ1",42,0)
 .I DOTMP S NEWTMP=ORY_1_")",@NEWTMP="^No team identified" Q
"RTN","ORQPTQ1",43,0)
 .I 'DOTMP S ORY(1)="^No team identified" Q
"RTN","ORQPTQ1",44,0)
 N ORI,ORPT,I
"RTN","ORQPTQ1",45,0)
 S I=0
"RTN","ORQPTQ1",46,0)
 S ORI=0 F  S ORI=$O(^OR(100.21,+TEAM,10,ORI)) Q:ORI<1  D
"RTN","ORQPTQ1",47,0)
 .S ORPT=^OR(100.21,+TEAM,10,ORI,0)
"RTN","ORQPTQ1",48,0)
 .I DOTMP D
"RTN","ORQPTQ1",49,0)
 ..S I=I+1,NEWTMP=ORY_+I_")"
"RTN","ORQPTQ1",50,0)
 ..S @NEWTMP=+ORPT_U_$P(^DPT(+ORPT,0),U)
"RTN","ORQPTQ1",51,0)
 .I 'DOTMP S I=I+1,ORY(I)=+ORPT_U_$P(^DPT(+ORPT,0),U)
"RTN","ORQPTQ1",52,0)
 I DOTMP S:I<1 NEWTMP=ORY_1_")",@NEWTMP="^No patients found."
"RTN","ORQPTQ1",53,0)
 I 'DOTMP S:I<1 ORY(1)="^No patients found."
"RTN","ORQPTQ1",54,0)
 Q
"RTN","ORQPTQ1",55,0)
TEAMPR(ORY,PROV) ; return list of teams linked to a provider
"RTN","ORQPTQ1",56,0)
 I +$G(PROV)<1 S ORY(1)="^No provider identified" Q 
"RTN","ORQPTQ1",57,0)
 N ORTM,I,ORTMN
"RTN","ORQPTQ1",58,0)
 S ORTM="",I=1
"RTN","ORQPTQ1",59,0)
 F  S ORTM=$O(^OR(100.21,"C",+PROV,ORTM)) Q:+$G(ORTM)<1  D
"RTN","ORQPTQ1",60,0)
 .S ORTMN=$P(^OR(100.21,ORTM,0),U)
"RTN","ORQPTQ1",61,0)
 .S ORY(I)=ORTM_U_ORTMN,I=I+1
"RTN","ORQPTQ1",62,0)
 S:+$G(ORY(1))<1 ORY(1)="^No teams found."
"RTN","ORQPTQ1",63,0)
 Q
"RTN","ORQPTQ1",64,0)
TEAMPR2(ORY,PROV) ; return list of teams linked to a provider
"RTN","ORQPTQ1",65,0)
 ; This tag added by PKS/slc - 8/1999.
"RTN","ORQPTQ1",66,0)
 I +$G(PROV)<1 S ORY(1)="^No provider identified" Q
"RTN","ORQPTQ1",67,0)
 N ORTM,ORDATA,ORTMN,ORTYPE,I
"RTN","ORQPTQ1",68,0)
 S ORTM="",I=1
"RTN","ORQPTQ1",69,0)
 F  S ORTM=$O(^OR(100.21,"C",+PROV,ORTM)) Q:+$G(ORTM)<1  D
"RTN","ORQPTQ1",70,0)
 .S ORDATA=^OR(100.21,ORTM,0) ; Get value.
"RTN","ORQPTQ1",71,0)
 .S ORTMN=$P(ORDATA,U)        ; Team List name.
"RTN","ORQPTQ1",72,0)
 .S ORTYPE=$P(ORDATA,U,2)     ; Team List type.
"RTN","ORQPTQ1",73,0)
 .S ORY(I)=ORTM_U_ORTMN_U_ORTYPE,I=I+1
"RTN","ORQPTQ1",74,0)
 S:+$G(ORY(1))<1 ORY(1)="^No teams found."
"RTN","ORQPTQ1",75,0)
 Q
"RTN","ORQPTQ1",76,0)
TEAMPROV(ORY,TEAM) ; return list of providers linked to a team
"RTN","ORQPTQ1",77,0)
 I +$G(TEAM)<1 S ORY(1)="^No team identified"
"RTN","ORQPTQ1",78,0)
 N PROV,I,SEQ
"RTN","ORQPTQ1",79,0)
 S I=1
"RTN","ORQPTQ1",80,0)
 S SEQ=0 F  S SEQ=$O(^OR(100.21,+TEAM,1,SEQ)) Q:SEQ<1  D
"RTN","ORQPTQ1",81,0)
 .S PROV=^OR(100.21,+TEAM,1,SEQ,0) I $L(PROV) D
"RTN","ORQPTQ1",82,0)
 ..S ORY(I)=+PROV_U_$P(^VA(200,+PROV,0),U),I=I+1
"RTN","ORQPTQ1",83,0)
 S:+$G(ORY(1))<1 ORY(1)="^No providers found."
"RTN","ORQPTQ1",84,0)
 Q
"RTN","ORQPTQ1",85,0)
TPROVPT(PROV) ;return list of patients linked to a provider via teams
"RTN","ORQPTQ1",86,0)
 ; Modified by PKS: 8/1999.
"RTN","ORQPTQ1",87,0)
 I +$G(PROV)<1 S ^TMP("ORLPUPT",$J,"^No provider identified")=""
"RTN","ORQPTQ1",88,0)
 N ORTM,ORTMN,ORI,ORPT
"RTN","ORQPTQ1",89,0)
 S ORTM=""
"RTN","ORQPTQ1",90,0)
 F  S ORTM=$O(^OR(100.21,"C",+PROV,ORTM)) Q:+$G(ORTM)<1  D  ; Teams.
"RTN","ORQPTQ1",91,0)
 .S ORTMN=$P(^OR(100.21,+ORTM,0),U,1) ; Get name of Team List.
"RTN","ORQPTQ1",92,0)
 .S ORI=0 F  S ORI=$O(^OR(100.21,+ORTM,10,ORI)) Q:ORI<1  D
"RTN","ORQPTQ1",93,0)
 ..S ORPT=^OR(100.21,+ORTM,10,ORI,0)
"RTN","ORQPTQ1",94,0)
 ..S ^TMP("ORLPUPT",$J,+ORPT_U_$P(^DPT(+ORPT,0),U))=""
"RTN","ORQPTQ1",95,0)
 ..; Next line added by PKS:
"RTN","ORQPTQ1",96,0)
 ..S ^TMP("ORLPUPT",$J,"B",ORTMN,$P(^DPT(+ORPT,0),U)_U_+ORPT)=""
"RTN","ORQPTQ1",97,0)
 I '$D(^TMP("ORLPUPT",$J)) S ^TMP("ORLPUPT",$J,"^No patients found.")=""
"RTN","ORQPTQ1",98,0)
 Q
"RTN","ORQPTQ1",99,0)
TMSPT(ORY,PT) ;return list of teams linked to a patient (patient is active)
"RTN","ORQPTQ1",100,0)
 I +$G(PT)<1 S ORY(1)="^No patient identified" Q
"RTN","ORQPTQ1",101,0)
 N ORTM,I,ORTMN,ORTMTYP
"RTN","ORQPTQ1",102,0)
 S ORTM="",I=1
"RTN","ORQPTQ1",103,0)
 F  S ORTM=$O(^OR(100.21,"AB",+PT_";DPT(",ORTM)) Q:+$G(ORTM)<1  D
"RTN","ORQPTQ1",104,0)
 .S ORTMN=$P(^OR(100.21,ORTM,0),U)
"RTN","ORQPTQ1",105,0)
 .S ORTMTYP=$P(^OR(100.21,ORTM,0),U,2) I $L(ORTMTYP) D
"RTN","ORQPTQ1",106,0)
 ..S ORTMTYP=$$EXTERNAL^DILFD(100.21,1,"",ORTMTYP,"")
"RTN","ORQPTQ1",107,0)
 .S ORY(I)=ORTM_U_ORTMN_U_$S($L(ORTMTYP):ORTMTYP,1:"no type"),I=I+1
"RTN","ORQPTQ1",108,0)
 S:+$G(ORY(1))<1 ORY(1)="^No teams found."
"RTN","ORQPTQ1",109,0)
 Q
"RTN","ORQPTQ1",110,0)
TPTPR(ORY,PT) ;return list of providers linked to a patient via teams
"RTN","ORQPTQ1",111,0)
 I +$G(PT)<1 S ORY(1)="^No patient identified" Q
"RTN","ORQPTQ1",112,0)
 N ORTM,PROV,SEQ
"RTN","ORQPTQ1",113,0)
 S ORTM=""
"RTN","ORQPTQ1",114,0)
 F  S ORTM=$O(^OR(100.21,"AB",+PT_";DPT(",ORTM)) Q:+$G(ORTM)<1  D
"RTN","ORQPTQ1",115,0)
 .S SEQ=0 F  S SEQ=$O(^OR(100.21,+ORTM,1,SEQ)) Q:SEQ<1  D
"RTN","ORQPTQ1",116,0)
 ..S PROV=^OR(100.21,+ORTM,1,SEQ,0) I $L(PROV) D
"RTN","ORQPTQ1",117,0)
 ...S ORY(+PROV)=+PROV_U_$P(^VA(200,+PROV,0),U)
"RTN","ORQPTQ1",118,0)
 S:'$D(ORY) ORY(1)="^No providers found."
"RTN","ORQPTQ1",119,0)
 Q
"RTN","ORQPTQ1",120,0)
PERSPR(ORY) ; return list of personal lists linked to current user
"RTN","ORQPTQ1",121,0)
 N ORTM,I,ORTMN
"RTN","ORQPTQ1",122,0)
 S ORTM="",I=1
"RTN","ORQPTQ1",123,0)
 F  S ORTM=$O(^OR(100.21,"C",DUZ,ORTM)) Q:+$G(ORTM)<1  D
"RTN","ORQPTQ1",124,0)
 .Q:$P(^OR(100.21,ORTM,0),U,2)'="P"  ;quit if not a personal list
"RTN","ORQPTQ1",125,0)
 .S ORTMN=$P(^OR(100.21,ORTM,0),U)
"RTN","ORQPTQ1",126,0)
 .S ORY(I)=ORTM_U_ORTMN,I=I+1
"RTN","ORQPTQ1",127,0)
 S:+$G(ORY(1))<1 ORY(1)="^No personal lists found."
"RTN","ORQPTQ1",128,0)
 Q
"RTN","ORQPTQ1",129,0)
PRIMPT(ORY,ORPT) ; return patient's PCMM primary care team
"RTN","ORQPTQ1",130,0)
 I +$G(ORPT)<1 S ORY(1)="^No patient identified"
"RTN","ORQPTQ1",131,0)
 N ORQPUR,ORQERROR,ORQLST,ORQERR,ORQDT,ORIDT,ORADT,ORX
"RTN","ORQPTQ1",132,0)
 S ORQPUR(2)=""  ;"2" is the ien for purpose "primary care" [^SD(403.47]
"RTN","ORQPTQ1",133,0)
 D NOW^%DTC S ORQDT("BEGIN")=%-.0001,ORQDT("END")=%+.0001,ORQDT("INCL")=0
"RTN","ORQPTQ1",134,0)
 S ORQERROR=$$TMPT^SCAPMC(.ORPT,"ORQDT","ORQPUR","ORQLST","ORQERR")
"RTN","ORQPTQ1",135,0)
 I ORQERROR=0 S ORY="^Error in search for primary care team."
"RTN","ORQPTQ1",136,0)
 I +$G(ORQLST(1))>0 D
"RTN","ORQPTQ1",137,0)
 .S ORX=ORQLST(1),ORADT=$P(ORX,U,4),ORIDT=$P(ORX,U,5)
"RTN","ORQPTQ1",138,0)
 .I ($G(ORADT)>$G(ORIDT)) S ORY=$P(ORX,U)_U_$P(ORX,U,2)
"RTN","ORQPTQ1",139,0)
 S:+$G(ORY)<1 ORY="^No primary care team found."
"RTN","ORQPTQ1",140,0)
 K %
"RTN","ORQPTQ1",141,0)
 Q
"RTN","ORQPTQ1",142,0)
PROVPT(ORY,ORPT) ; return PCMM primary provider for a patient
"RTN","ORQPTQ1",143,0)
 I +$G(ORPT)<1 S ORY(1)="^No patient identified"
"RTN","ORQPTQ1",144,0)
 S ORY(1)=$$OUTPTPR^SDUTL3(ORPT,$$NOW^XLFDT,1)
"RTN","ORQPTQ1",145,0)
 Q
"RTN","ORQPTQ1",146,0)
PPLINK(ORPROV,ORPT) ; returns '1' if patient is linked to provider
"RTN","ORQPTQ1",147,0)
 N ORX,ORPP
"RTN","ORQPTQ1",148,0)
 S ORX="",ORPP=0
"RTN","ORQPTQ1",149,0)
 I (+$G(ORPT)<1)!(+$G(ORPROV)<1) Q 0
"RTN","ORQPTQ1",150,0)
 I $D(^DPT("APR",ORPROV,ORPT)) Q "1^PRIM"  ;provider is patient's primary
"RTN","ORQPTQ1",151,0)
 I $D(^DPT("AAP",ORPROV,ORPT)) Q "1^ATTD"  ;provider is patient's attending
"RTN","ORQPTQ1",152,0)
 ;is provider and patient on the same team:
"RTN","ORQPTQ1",153,0)
 D TPROVPT(ORPROV)
"RTN","ORQPTQ1",154,0)
 F  S ORX=$O(^TMP("ORLPUPT",$J,ORX)) Q:ORX=""  D
"RTN","ORQPTQ1",155,0)
 .I +ORX=ORPT S ORPP="1^OERRTM" Q
"RTN","ORQPTQ1",156,0)
 K ^TMP("ORLPUPT",$J)
"RTN","ORQPTQ1",157,0)
 ;
"RTN","ORQPTQ1",158,0)
 ;If not linked already, see if linked via PCMM:
"RTN","ORQPTQ1",159,0)
 I ORPP=0 S ORPP=$$PCMMLINK(ORPROV,ORPT)
"RTN","ORQPTQ1",160,0)
 ;
"RTN","ORQPTQ1",161,0)
 Q ORPP
"RTN","ORQPTQ1",162,0)
PDLINK(ORDEV,ORPT) ; returns '1' if patient is linked to device via team
"RTN","ORQPTQ1",163,0)
 ;ORDEV can be either ien or device name
"RTN","ORQPTQ1",164,0)
 N ORY,ORX,ORTM,ORDP,ORTMDEV,ORDEVIEN
"RTN","ORQPTQ1",165,0)
 S ORDP=0
"RTN","ORQPTQ1",166,0)
 I (+$G(ORPT)<1)!($L($G(ORDEV))<1) Q 0
"RTN","ORQPTQ1",167,0)
 ; Are device and patient on the same team?:
"RTN","ORQPTQ1",168,0)
 I '$D(^%ZIS(1,ORDEV,0)) D  ;ORDEV is not an ien
"RTN","ORQPTQ1",169,0)
 .S ORDEVIEN=0,ORDEVIEN=$O(^%ZIS(1,"B",$P(ORDEV,U),ORDEVIEN))
"RTN","ORQPTQ1",170,0)
 .S ORDEV=ORDEVIEN
"RTN","ORQPTQ1",171,0)
 Q:+$G(ORDEV)<1 0
"RTN","ORQPTQ1",172,0)
 D TMSPT(.ORY,ORPT)
"RTN","ORQPTQ1",173,0)
 S ORX="" F  S ORX=$O(ORY(ORX)) Q:ORX=""  D
"RTN","ORQPTQ1",174,0)
 .S ORTM=ORY(ORX)
"RTN","ORQPTQ1",175,0)
 .I $D(^OR(100.21,+ORTM,0)),$P(^(0),U,4)=ORDEV S ORDP=1 Q
"RTN","ORQPTQ1",176,0)
 Q ORDP
"RTN","ORQPTQ1",177,0)
PCMMLINK(ORPROV,ORPT) ;returns '1' if patient is linked to provider via PCMM
"RTN","ORQPTQ1",178,0)
 N ORPP,ORPCMM,ORPCP
"RTN","ORQPTQ1",179,0)
 S ORPP=0
"RTN","ORQPTQ1",180,0)
 I (+$G(ORPT)<1)!(+$G(ORPROV)<1) Q 0
"RTN","ORQPTQ1",181,0)
 ;
"RTN","ORQPTQ1",182,0)
 ;provider is patient's PCMM primary care practitioner:
"RTN","ORQPTQ1",183,0)
 I ORPROV=+$$OUTPTPR^SDUTL3(ORPT,$$NOW^XLFDT,1) Q "1^PCP"   ;DBIA #1252
"RTN","ORQPTQ1",184,0)
 ;
"RTN","ORQPTQ1",185,0)
 ;provider is patient's PCMM associate provider:
"RTN","ORQPTQ1",186,0)
 I ORPROV=+$$OUTPTAP^SDUTL3(ORPT,$$NOW^XLFDT) Q "1^AP"      ;DBIA #1252
"RTN","ORQPTQ1",187,0)
 ;
"RTN","ORQPTQ1",188,0)
 ;provider is linked to patient via PCMM team position assignment:
"RTN","ORQPTQ1",189,0)
 S ORPCMM=$$PRPT^SCAPMC(ORPT,,,,,,"^TMP(""ORPCMMLK"",$J)",)  ;DBIA #1916
"RTN","ORQPTQ1",190,0)
 S ORPCP=0
"RTN","ORQPTQ1",191,0)
 F  S ORPCP=$O(^TMP("ORPCMMLK",$J,"SCPR",ORPCP)) Q:'ORPCP!ORPP=1  D
"RTN","ORQPTQ1",192,0)
 .I ORPROV=ORPCP S ORPP="1^PCMMTM"
"RTN","ORQPTQ1",193,0)
 K ^TMP("ORPCMMLK",$J)
"RTN","ORQPTQ1",194,0)
 ;
"RTN","ORQPTQ1",195,0)
 Q ORPP
"RTN","ORQPTQ1",196,0)
PUNSIGN(ORY,ORBDFN) ;rtns array of providers with unsigned orders for pt
"RTN","ORQPTQ1",197,0)
 N ORDG,ORX,ORZ,ORDNUM
"RTN","ORQPTQ1",198,0)
 S ORDG=$$DG^ORQOR1("ALL")  ;get Display Group ien
"RTN","ORQPTQ1",199,0)
 K ^TMP("ORR",$J)
"RTN","ORQPTQ1",200,0)
 ;get unsigned orders:
"RTN","ORQPTQ1",201,0)
 D EN^ORQ1(ORBDFN_";DPT(",ORDG,11,"","","",0,0)
"RTN","ORQPTQ1",202,0)
 S ORX="",ORX=$O(^TMP("ORR",$J,ORX)) Q:ORX=""
"RTN","ORQPTQ1",203,0)
 I +$G(^TMP("ORR",$J,ORX,"TOT"))>0 D
"RTN","ORQPTQ1",204,0)
 .S ORX="" F  S ORX=$O(^TMP("ORR",$J,ORX)) Q:ORX=""  D
"RTN","ORQPTQ1",205,0)
 ..S ORZ="" F  S ORZ=$O(^TMP("ORR",$J,ORX,ORZ)) Q:+$G(ORZ)<1  D
"RTN","ORQPTQ1",206,0)
 ...S ORDNUM=^TMP("ORR",$J,ORX,ORZ)
"RTN","ORQPTQ1",207,0)
 ...S ORY(+$$UNSIGNOR^ORQOR2(+ORDNUM))=""
"RTN","ORQPTQ1",208,0)
 K ^TMP("ORR",$J)
"RTN","ORQPTQ1",209,0)
 Q
"RTN","ORQQAL")
0^27^B28169891
"RTN","ORQQAL",1,0)
ORQQAL ; slc/CLA,JFR - Functions which return patient allergy data ;6/8/06  14:11
"RTN","ORQQAL",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**9,85,162,190,216,232,243**;Dec 17, 1997;Build 242
"RTN","ORQQAL",3,0)
LIST(ORAY,ORPT) ; RETURN PATIENT'S ALLERGY/ADVERSE REACTION INFO:
"RTN","ORQQAL",4,0)
 ; null:no allergy assessment, 0:no known allergies, 1:pt has allergies
"RTN","ORQQAL",5,0)
 ; if 1 also get: allergen/reactant^reaction/symptom^severity^allergy ien
"RTN","ORQQAL",6,0)
 N I,J,K
"RTN","ORQQAL",7,0)
 S I=1,J=0,K=0
"RTN","ORQQAL",8,0)
 D EN1^GMRAOR1(ORPT,"GMRARXN")
"RTN","ORQQAL",9,0)
 I $G(GMRARXN)="" S ORAY(I)="^No Allergy Assessment"
"RTN","ORQQAL",10,0)
 I $G(GMRARXN)=0 S ORAY(I)="^No Known Allergies"
"RTN","ORQQAL",11,0)
 I $G(GMRARXN)=1 F  S J=$O(GMRARXN(J)) Q:J=""  S ORAY(I)=$P(GMRARXN(J),"^",3)_"^"_$P(GMRARXN(J),"^")_"^"_$P(GMRARXN(J),"^",2) D SIGNS S I=I+1
"RTN","ORQQAL",12,0)
 S:'$D(ORAY(1)) ORAY(1)="^No allergies found."
"RTN","ORQQAL",13,0)
 K GMRARXN
"RTN","ORQQAL",14,0)
 Q
"RTN","ORQQAL",15,0)
SIGNS S K=0,N=0 F  S K=$O(GMRARXN(J,"S",K)) Q:K'>0  D
"RTN","ORQQAL",16,0)
 .I N=0 S ORAY(I)=ORAY(I)_"^"_$P(GMRARXN(J,"S",K),";")
"RTN","ORQQAL",17,0)
 .E  S ORAY(I)=ORAY(I)_";"_$P(GMRARXN(J,"S",K),";")
"RTN","ORQQAL",18,0)
 .S N=N+1
"RTN","ORQQAL",19,0)
 Q
"RTN","ORQQAL",20,0)
LRPT(ORAY,ORPT) ; RETURN PT'S ALLERGY/ADVERSE REACTION INFO IN REPORT FORMAT:
"RTN","ORQQAL",21,0)
 ; null:no allergy assessment, 0:no known allergies, 1:pt has allergies
"RTN","ORQQAL",22,0)
 ; if 1 also get: allergen/reactant^reaction/symptom^severity^allergy ien
"RTN","ORQQAL",23,0)
 N I,J,K,SEVER,CR,GMRAIDT ;216
"RTN","ORQQAL",24,0)
 S CR=$CHAR(13)
"RTN","ORQQAL",25,0)
 S I=1,J=0,K=0,SEVER="",GMRAIDT=1 ;216
"RTN","ORQQAL",26,0)
 D EN1^GMRAOR1(ORPT,"GMRARXN")
"RTN","ORQQAL",27,0)
 I $G(GMRARXN)="" S ORAY(I)="No Allergy Assessment"
"RTN","ORQQAL",28,0)
 I $G(GMRARXN)=0 S ORAY(I)="No Known Allergies"
"RTN","ORQQAL",29,0)
 I $G(GMRARXN)=1 F  S J=$O(GMRARXN(J)) Q:J=""  D
"RTN","ORQQAL",30,0)
 .S SEVER=$P(GMRARXN(J),U,2)
"RTN","ORQQAL",31,0)
 .S ORAY(I)=$P(GMRARXN(J),U)_"     "_$S($L($G(SEVER)):"[Severity: "_SEVER_"]",1:""),I=I+1
"RTN","ORQQAL",32,0)
 .S K=0,N=0 F  S K=$O(GMRARXN(J,"S",K)) Q:K'>0  D
"RTN","ORQQAL",33,0)
 ..I N=0 S ORAY(I)="    Signs/symptoms: "_$P(GMRARXN(J,"S",K),";")
"RTN","ORQQAL",34,0)
 ..E     S ORAY(I)="                    "_$P(GMRARXN(J,"S",K),";")
"RTN","ORQQAL",35,0)
 ..I $P(GMRARXN(J,"S",K),";",2) S ORAY(I)=ORAY(I)_" ("_$$FMTE^XLFDT($P(GMRARXN(J,"S",K),";",2),2)_")" ;216
"RTN","ORQQAL",36,0)
 ..S N=N+1,I=I+1
"RTN","ORQQAL",37,0)
 .S ORAY(I)=" ",I=I+1
"RTN","ORQQAL",38,0)
 S:'$D(ORAY(1)) ORAY(1)="No allergies found."
"RTN","ORQQAL",39,0)
 K GMRARXN
"RTN","ORQQAL",40,0)
 Q
"RTN","ORQQAL",41,0)
RXN(ORAY,ORPT,SRC,NDF,PSDRUG) ; RETURN TRUE OR FALSE IF PATIENT IS ALLERGIC TO AGENT
"RTN","ORQQAL",42,0)
 ; SRC: ALLERGEN SOURCE (CM=CONTRAST MEDIA, DR=DRUG)
"RTN","ORQQAL",43,0)
 ; NDF: IF SRC=DR, NDF=Nat'l Drug File ien ELSE NDF=""
"RTN","ORQQAL",44,0)
 ; PSDRUG:IF SRC=DR, PSDRUG=(local) Drug file ien ELSE PSDRUG=""
"RTN","ORQQAL",45,0)
 S ORAY=$$ORCHK^GMRAOR(ORPT,SRC,NDF)
"RTN","ORQQAL",46,0)
 I SRC="DR",ORAY=1 D  ;drug ingredient allergy found
"RTN","ORQQAL",47,0)
 .S I=1,J=0 F  S J=$O(GMRAING(J)) Q:J=""  D
"RTN","ORQQAL",48,0)
 ..I I=1 S ORAY=ORAY_U_GMRAING(J)
"RTN","ORQQAL",49,0)
 ..E  S ORAY=ORAY_";"_GMRAING(J)
"RTN","ORQQAL",50,0)
 ..S I=I+1
"RTN","ORQQAL",51,0)
 I SRC="DR",ORAY=2 D  ;drug class allergy found
"RTN","ORQQAL",52,0)
 .S CL="",I=1,J=0 F  S J=$O(GMRADRCL(J)) Q:J=""  D
"RTN","ORQQAL",53,0)
 ..; per test sites 3/17/04 - no oc for pt allergy to entire HERBS class:
"RTN","ORQQAL",54,0)
 ..Q:$P(GMRADRCL(J),U)="HA000"
"RTN","ORQQAL",55,0)
 ..I I=1 S ORAY=ORAY_U_$P(GMRADRCL(J),U,2)
"RTN","ORQQAL",56,0)
 ..E  S CL=$P(GMRADRCL(J),U,2) I ORAY'[CL S ORAY=ORAY_";"_CL
"RTN","ORQQAL",57,0)
 ..S I=I+1
"RTN","ORQQAL",58,0)
 I SRC="DR",(+$G(ORAY)<1) D MEDCLASS(.ORAY,ORPT,PSDRUG)
"RTN","ORQQAL",59,0)
 K I,J,GMRADRCL,GMRAING,CL
"RTN","ORQQAL",60,0)
 Q
"RTN","ORQQAL",61,0)
MEDCLASS(ORAY,DFN,PSDRUG) ;check for allergens with medications in same VA drug class
"RTN","ORQQAL",62,0)
 N ORVACLS,CL,X,I,RET,TYP
"RTN","ORQQAL",63,0)
 S TYP="DR"
"RTN","ORQQAL",64,0)
 Q:+$G(PSDRUG)<1
"RTN","ORQQAL",65,0)
 ;S ORVACLS=$P(^PSDRUG(PSDRUG,0),U,2)
"RTN","ORQQAL",66,0)
 S ORVACLS=$$CLASS50^ORPEAPI(PSDRUG)
"RTN","ORQQAL",67,0)
 Q:$L(ORVACLS)<4
"RTN","ORQQAL",68,0)
 Q:$G(ORVACLS)="HA000"  ;don't process herbal drug class for order checks
"RTN","ORQQAL",69,0)
 S CL=$S($E(ORVACLS,1,4)="CN10":5,1:4) ;look at 5 chars if ANALGESICS
"RTN","ORQQAL",70,0)
 D GETDATA^GMRAOR(DFN)
"RTN","ORQQAL",71,0)
 Q:'$D(^TMP("GMRAOC",$J,"APC"))
"RTN","ORQQAL",72,0)
 S I="" F  S I=$O(^TMP("GMRAOC",$J,"APC",I)) Q:'$L(I)  D
"RTN","ORQQAL",73,0)
 .I $E(I,1,CL)=$E(ORVACLS,1,CL) S X=I
"RTN","ORQQAL",74,0)
 I $L($G(X)) D
"RTN","ORQQAL",75,0)
 .N IEN,NAME
"RTN","ORQQAL",76,0)
 .D IEN^PSN50P65(,X,"ORQQAL")
"RTN","ORQQAL",77,0)
 .S IEN=$O(^TMP($J,"ORQQAL","B",X,0))
"RTN","ORQQAL",78,0)
 .I 'IEN S ORAY="2"_U_X Q
"RTN","ORQQAL",79,0)
 .S NAME=$G(^TMP($J,"ORQQAL",IEN,1))
"RTN","ORQQAL",80,0)
 .I '$L(NAME) S ORAY="2"_U_X Q
"RTN","ORQQAL",81,0)
 .S ORAY="2"_U_NAME_": ("_$G(^TMP("GMRAOC",$J,"APC",X))_")"
"RTN","ORQQAL",82,0)
 K ^TMP("GMRAOC",$J)
"RTN","ORQQAL",83,0)
 Q
"RTN","ORQQAL",84,0)
DETAIL(ORAY,DFN,ALLR,ID) ; RETURN DETAILED ALLERGY INFO FOR SPECIFIED ALLERGIC REACTION:
"RTN","ORQQAL",85,0)
 D EN1^GMRAOR2(ALLR,"GMRACT")
"RTN","ORQQAL",86,0)
 N CR,OX,OH S CR=$CHAR(13),I=1
"RTN","ORQQAL",87,0)
 S ORAY(I)="    Causative agent: "_$P(GMRACT,U),I=I+1
"RTN","ORQQAL",88,0)
 S ORAY(I)=" Nature of Reaction: "_$S($P(GMRACT,U,6)="ALLERGY":"Allergy",$P(GMRACT,U,6)="PHARMACOLOGIC":"Adverse Reaction",$P(GMRACT,U,6)="UNKNOWN":"Unknown",1:""),I=I+1 ;216
"RTN","ORQQAL",89,0)
 S ORAY(I)=" ",I=I+1
"RTN","ORQQAL",90,0)
 I $D(GMRACT("S",1)) D SYMP
"RTN","ORQQAL",91,0)
 I $D(GMRACT("V",1)) D CLAS
"RTN","ORQQAL",92,0)
 S ORAY(I)="         Originator: "_$P(GMRACT,U,2)_$S($L($P(GMRACT,U,3)):" ("_$P(GMRACT,U,3)_")",1:""),I=I+1 ;216
"RTN","ORQQAL",93,0)
 S ORAY(I)="         Originated: "_$P(GMRACT,U,10),I=I+1 ;216
"RTN","ORQQAL",94,0)
 I $D(GMRACT("O",1)) D OBS
"RTN","ORQQAL",95,0)
 S ORAY(I)="           Verified: "_$S($P(GMRACT,U,4)="VERIFIED":$P(GMRACT,U,8),1:"No"),I=I+1 ;216
"RTN","ORQQAL",96,0)
 S ORAY(I)="Observed/Historical: "_$S($P(GMRACT,U,5)="OBSERVED":"Observed",$P(GMRACT,U,5)="HISTORICAL":"Historical",1:""),I=I+1
"RTN","ORQQAL",97,0)
 I $D(GMRACT("C",1)) D COM
"RTN","ORQQAL",98,0)
 K GMRACT
"RTN","ORQQAL",99,0)
 Q
"RTN","ORQQAL",100,0)
SYMP S K=0,N=0 F  S K=$O(GMRACT("S",K)) Q:K'>0  D
"RTN","ORQQAL",101,0)
 .I N=0 S ORAY(I)="     Signs/symptoms: "_GMRACT("S",K),I=I+1
"RTN","ORQQAL",102,0)
 .E  S ORAY(I)="                     "_GMRACT("S",K),I=I+1
"RTN","ORQQAL",103,0)
 .S N=N+1
"RTN","ORQQAL",104,0)
 S ORAY(I)=" ",I=I+1
"RTN","ORQQAL",105,0)
 K N,K
"RTN","ORQQAL",106,0)
 Q
"RTN","ORQQAL",107,0)
CLAS S K=0,N=0 F  S K=$O(GMRACT("V",K)) Q:K'>0  D
"RTN","ORQQAL",108,0)
 .I N=0 S ORAY(I)="       Drug Classes: "_$P(GMRACT("V",K),U,2),I=I+1
"RTN","ORQQAL",109,0)
 .E  S ORAY(I)="                     "_$P(GMRACT("V",K),U,2),I=I+1
"RTN","ORQQAL",110,0)
 .S N=N+1
"RTN","ORQQAL",111,0)
 S ORAY(I)=" ",I=I+1
"RTN","ORQQAL",112,0)
 K N,K
"RTN","ORQQAL",113,0)
 Q
"RTN","ORQQAL",114,0)
OBS S K=0,N=0 F  S K=$O(GMRACT("O",K)) Q:K'>0  D
"RTN","ORQQAL",115,0)
 .I N=0 D
"RTN","ORQQAL",116,0)
 ..S Y=$P(GMRACT("O",K),U) D DD^%DT
"RTN","ORQQAL",117,0)
 ..S ORAY(I)=" Obs dates/severity: "_Y_" "_$P(GMRACT("O",K),U,2),I=I+1
"RTN","ORQQAL",118,0)
 .E  D
"RTN","ORQQAL",119,0)
 ..S Y=$P(GMRACT("O",K),U) D DD^%DT
"RTN","ORQQAL",120,0)
 ..S ORAY(I)="                     "_Y_" "_$P(GMRACT("O",K),U,2),I=I+1
"RTN","ORQQAL",121,0)
 .S N=N+1
"RTN","ORQQAL",122,0)
 S ORAY(I)=" ",I=I+1
"RTN","ORQQAL",123,0)
 K N,K,Y
"RTN","ORQQAL",124,0)
 Q
"RTN","ORQQAL",125,0)
COM S K=0,N=0,ORAY(I)=" ",I=I+1
"RTN","ORQQAL",126,0)
 F  S K=$O(GMRACT("C",K)) Q:K'>0  D
"RTN","ORQQAL",127,0)
 .I N=0 S ORAY(I)="Comments:",I=I+1
"RTN","ORQQAL",128,0)
 .S Y=$P(GMRACT("C",K),U) D DD^%DT
"RTN","ORQQAL",129,0)
 .S ORAY(I)="   "_Y_" by "_$P(GMRACT("C",K),U,2),I=I+1
"RTN","ORQQAL",130,0)
 .I $D(GMRACT("C",K,1,0)) S L=0 F  S L=$O(GMRACT("C",K,L)) Q:L'>0  D
"RTN","ORQQAL",131,0)
 ..S ORAY(I)=GMRACT("C",K,L,0),I=I+1
"RTN","ORQQAL",132,0)
 .S N=N+1
"RTN","ORQQAL",133,0)
 S ORAY(I)=" ",I=I+1
"RTN","ORQQAL",134,0)
 K N,K,L,Y
"RTN","ORQQAL",135,0)
 Q
"RTN","ORQQPL1")
0^49^B62886431
"RTN","ORQQPL1",1,0)
ORQQPL1 ; ALB/PDR/REV - PROBLEM LIST FOR CPRS GUI ; 02/12/08
"RTN","ORQQPL1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,148,173,203,206,249,243**;Dec 17, 1997;Build 242
"RTN","ORQQPL1",3,0)
 ;
"RTN","ORQQPL1",4,0)
 ;------------------------- GET PROBLEM FROM LEXICON -------------------
"RTN","ORQQPL1",5,0)
 ;
"RTN","ORQQPL1",6,0)
LEXSRCH(LIST,FROM,N,VIEW,ORDATE) ; Get candidate Problems from LEX file
"RTN","ORQQPL1",7,0)
 N LEX,VAL,VAL1,COD,CIEN,SYS,MAX,NAME
"RTN","ORQQPL1",8,0)
 S:'+$G(ORDATE) ORDATE=DT
"RTN","ORQQPL1",9,0)
 S:'$G(N) N=100
"RTN","ORQQPL1",10,0)
 S:'$L($G(VIEW)) VIEW="PL1"
"RTN","ORQQPL1",11,0)
 D CONFIG^LEXSET("GMPL",VIEW,ORDATE)
"RTN","ORQQPL1",12,0)
 D LOOK^LEXA(FROM,"GMPL",N,"",ORDATE)
"RTN","ORQQPL1",13,0)
 S S=0
"RTN","ORQQPL1",14,0)
 F  S S=$O(LEX("LIST",S)) Q:S<1  D
"RTN","ORQQPL1",15,0)
 . S VAL1=LEX("LIST",S)
"RTN","ORQQPL1",16,0)
 . S COD="",CIEN="",SYS="",NAME=""
"RTN","ORQQPL1",17,0)
 . I $L(VAL1,"CPT-4 ")>1 D
"RTN","ORQQPL1",18,0)
 .. S SYS="ICD-9-CM "
"RTN","ORQQPL1",19,0)
 .. S COD="799.9"
"RTN","ORQQPL1",20,0)
 .. S CIEN=""
"RTN","ORQQPL1",21,0)
 .. S NAME=$P(VAL1," (CPT-4")
"RTN","ORQQPL1",22,0)
 . I $L(VAL1,"DSM-IV ")>1 D
"RTN","ORQQPL1",23,0)
 .. S SYS="DSM-IV "
"RTN","ORQQPL1",24,0)
 .. S COD=$P($P(VAL1,SYS,2),")")
"RTN","ORQQPL1",25,0)
 .. S:COD["/" COD=$P(COD,"/",1)
"RTN","ORQQPL1",26,0)
 .. S CIEN=$$CODEN^ICDCODE($$ICDONE^LEXU($P(VAL1,U,1),ORDATE),80)
"RTN","ORQQPL1",27,0)
 .. S NAME=$P(VAL1," (DSM-IV")
"RTN","ORQQPL1",28,0)
 .. ;
"RTN","ORQQPL1",29,0)
 . I $L(VAL1,"(TITLE 38 ")>1 D
"RTN","ORQQPL1",30,0)
 .. S SYS="TITLE 38 "
"RTN","ORQQPL1",31,0)
 .. S COD=$P($P(VAL1,SYS,2),")")
"RTN","ORQQPL1",32,0)
 .. S:COD["/" COD=$P(COD,"/",1)
"RTN","ORQQPL1",33,0)
 .. S CIEN=$$CODEN^ICDCODE($$ICDONE^LEXU($P(VAL1,U,1),ORDATE),80)
"RTN","ORQQPL1",34,0)
 .. S NAME=$P(VAL1,"(TITLE 38 ")
"RTN","ORQQPL1",35,0)
 .. ;
"RTN","ORQQPL1",36,0)
 . I $L(VAL1,"ICD-9-CM ")>1 D
"RTN","ORQQPL1",37,0)
 .. S SYS="ICD-9-CM "
"RTN","ORQQPL1",38,0)
 .. S COD=$P($P(VAL1,SYS,2),")")
"RTN","ORQQPL1",39,0)
 .. S:COD["/" COD=$P(COD,"/",1)
"RTN","ORQQPL1",40,0)
 .. S CIEN=+$$CODEN^ICDCODE(COD,80)
"RTN","ORQQPL1",41,0)
 .. S NAME=$P(VAL1," (ICD-9-CM")
"RTN","ORQQPL1",42,0)
 . I $L(NAME)=0 S NAME=$P($P(VAL1," (")," *")
"RTN","ORQQPL1",43,0)
 . ;
"RTN","ORQQPL1",44,0)
 . ; jeh Clean left over codes
"RTN","ORQQPL1",45,0)
 . S NAME=$P(NAME," (CPT-4")
"RTN","ORQQPL1",46,0)
 . S NAME=$P(NAME," (DSM-IV")
"RTN","ORQQPL1",47,0)
 . S NAME=$P(NAME,"(TITLE 38 ")
"RTN","ORQQPL1",48,0)
 . S NAME=$P(NAME," (ICD-9-CM")
"RTN","ORQQPL1",49,0)
 . ;
"RTN","ORQQPL1",50,0)
 . S VAL=NAME_U_COD_U_CIEN_U_SYS ; ien^.01^icd^icdifn^system
"RTN","ORQQPL1",51,0)
 . S LIST(S)=VAL
"RTN","ORQQPL1",52,0)
 . S MAX=S
"RTN","ORQQPL1",53,0)
 I $G(MAX)'="" S LIST(MAX+1)=$G(LEX("MAT"))
"RTN","ORQQPL1",54,0)
 K ^TMP("LEXSCH",$J)
"RTN","ORQQPL1",55,0)
 Q
"RTN","ORQQPL1",56,0)
 ;
"RTN","ORQQPL1",57,0)
ICDREC(COD) ; 
"RTN","ORQQPL1",58,0)
 N CODIEN
"RTN","ORQQPL1",59,0)
 I COD="" Q ""
"RTN","ORQQPL1",60,0)
 S COD=$P($P(COD,U),"/")
"RTN","ORQQPL1",61,0)
 S CODIEN=+$O(^ICD9("AB",COD_" ",0))
"RTN","ORQQPL1",62,0)
 S:CODIEN'>0 CODIEN=+$O(^ICD9("AB",COD_"0 ",0))
"RTN","ORQQPL1",63,0)
 Q CODIEN
"RTN","ORQQPL1",64,0)
 ;Q $O(^ICD9("BA",COD,""))
"RTN","ORQQPL1",65,0)
 ;
"RTN","ORQQPL1",66,0)
CPTREC(COD) ; 
"RTN","ORQQPL1",67,0)
 I COD="" Q ""
"RTN","ORQQPL1",68,0)
 Q $O(^ICPT("BA",COD,""))
"RTN","ORQQPL1",69,0)
 ;
"RTN","ORQQPL1",70,0)
EDLOAD(RETURN,DA,GMPROV,GMPVAMC) ; LOAD  EDIT ARRAYS
"RTN","ORQQPL1",71,0)
 ; DA=problem IFN
"RTN","ORQQPL1",72,0)
 N I,GMPFLD,GMPORIG,GMPL
"RTN","ORQQPL1",73,0)
 D GETFLDS^GMPLEDT3(DA)
"RTN","ORQQPL1",74,0)
 S I=0
"RTN","ORQQPL1",75,0)
 D LOADFLDS(.RETURN,"GMPFLD","NEW",.I)
"RTN","ORQQPL1",76,0)
 D LOADFLDS(.RETURN,"GMPORIG","ORG",.I)
"RTN","ORQQPL1",77,0)
 K GMPFLD,GMPORIG,GMPL  ; should not have to do this
"RTN","ORQQPL1",78,0)
 Q
"RTN","ORQQPL1",79,0)
 ;
"RTN","ORQQPL1",80,0)
LOADFLDS(RETURN,NAM,TYP,I) ; LOAD FIELDS FOR TYPE OF ARRAY
"RTN","ORQQPL1",81,0)
 N S,V,CVP,PN,PID
"RTN","ORQQPL1",82,0)
 S S="",V=$C(254)
"RTN","ORQQPL1",83,0)
 F  S S=$O(@NAM@(S)) Q:S=10  D
"RTN","ORQQPL1",84,0)
 . S RETURN(I)=TYP_V_S_V_@NAM@(S)
"RTN","ORQQPL1",85,0)
 . S I=I+1
"RTN","ORQQPL1",86,0)
 S S=""
"RTN","ORQQPL1",87,0)
 F  S S=$O(@NAM@(10,S)) Q:S=""  D
"RTN","ORQQPL1",88,0)
 . S CVP=@NAM@(10,S)
"RTN","ORQQPL1",89,0)
 . S PN="" ; provider name
"RTN","ORQQPL1",90,0)
 . S PID=$P(CVP,U,6) ; provider id
"RTN","ORQQPL1",91,0)
 . I PID'=""  S PN=$$GET1^DIQ(200,PID,.01) ; get provider name
"RTN","ORQQPL1",92,0)
 . S RETURN(I)=TYP_V_"10,"_S_V_CVP_U_PN
"RTN","ORQQPL1",93,0)
 . S I=I+1
"RTN","ORQQPL1",94,0)
 Q
"RTN","ORQQPL1",95,0)
 ;
"RTN","ORQQPL1",96,0)
EDSAVE(RETURN,GMPIFN,GMPROV,GMPVAMC,UT,EDARRAY) ; SAVE EDITED RES
"RTN","ORQQPL1",97,0)
 ; RETURN - boolean, 1 success, 0 failure
"RTN","ORQQPL1",98,0)
 ; EDARRAY - array used for indirect sets of GMPORIG() and GMPFLDS()
"RTN","ORQQPL1",99,0)
 ;
"RTN","ORQQPL1",100,0)
 N GMPFLD,GMPORIG,S,GMPLUSER
"RTN","ORQQPL1",101,0)
 S RETURN=1 ; initialize for success
"RTN","ORQQPL1",102,0)
 I UT S GMPLUSER=1
"RTN","ORQQPL1",103,0)
 ;
"RTN","ORQQPL1",104,0)
 ;S GMPLUSER=1
"RTN","ORQQPL1",105,0)
 S S=""
"RTN","ORQQPL1",106,0)
 F  S S=$O(EDARRAY(S)) Q:S=""  D
"RTN","ORQQPL1",107,0)
 . S @EDARRAY(S)
"RTN","ORQQPL1",108,0)
 I $D(GMPFLD(10,"NEW"))>9 D  I 'RETURN Q  ; Bail Out if no lock
"RTN","ORQQPL1",109,0)
 . L +^AUPNPROB(GMPIFN,11):10  ; given bogus nature of this lock, should be able to get
"RTN","ORQQPL1",110,0)
 . I '$T S RETURN=0
"RTN","ORQQPL1",111,0)
 ;
"RTN","ORQQPL1",112,0)
 D EN^GMPLSAVE  ; save the data
"RTN","ORQQPL1",113,0)
 K GMPFLD,GMPORIG
"RTN","ORQQPL1",114,0)
 ;
"RTN","ORQQPL1",115,0)
 L -^AUPNPROB(GMPIFN,11)  ; free this instance of lock (in case it was set)
"RTN","ORQQPL1",116,0)
 S RETURN=1
"RTN","ORQQPL1",117,0)
 Q
"RTN","ORQQPL1",118,0)
 ;
"RTN","ORQQPL1",119,0)
UPDATE(ORRETURN,UPDARRAY) ; UPDATE A PROBLEM RECORD
"RTN","ORQQPL1",120,0)
 ; Does essentially same job as EDSAVE above, however does not handle edits to comments
"RTN","ORQQPL1",121,0)
 ; or addition of multiple comments. 
"RTN","ORQQPL1",122,0)
 ; Use initially just for status updates.
"RTN","ORQQPL1",123,0)
 ;
"RTN","ORQQPL1",124,0)
 N S,GMPL,GMPORIG ; last 2 vars created in nested call
"RTN","ORQQPL1",125,0)
 S S=""
"RTN","ORQQPL1",126,0)
 F  S S=$O(UPDARRAY(S)) Q:S=""  D
"RTN","ORQQPL1",127,0)
 . S @UPDARRAY(S)
"RTN","ORQQPL1",128,0)
 D UPDATE^GMPLUTL(.ORARRAY,.ORRETURN)
"RTN","ORQQPL1",129,0)
 K ORARRAY
"RTN","ORQQPL1",130,0)
 ; broker wont pick up root node RETURN
"RTN","ORQQPL1",131,0)
 S ORRETURN(1)=ORRETURN(0) ; error text
"RTN","ORQQPL1",132,0)
 S ORRETURN(0)=ORRETURN ; gmpdfn
"RTN","ORQQPL1",133,0)
 I ORRETURN(0)=""  S ORRETURN=1 ; insurance ? need
"RTN","ORQQPL1",134,0)
 Q
"RTN","ORQQPL1",135,0)
 ;
"RTN","ORQQPL1",136,0)
ADDSAVE(RETURN,GMPDFN,GMPROV,GMPVAMC,ADDARRAY) ; SAVE NEW RECORD
"RTN","ORQQPL1",137,0)
 ; RETURN - Problem IFN if success, 0 otherwise
"RTN","ORQQPL1",138,0)
 ; ADDARRAY - array used for indirect sets of  GMPFLDS()
"RTN","ORQQPL1",139,0)
 ;
"RTN","ORQQPL1",140,0)
 N DA,GMPFLD,GMPORIG,S
"RTN","ORQQPL1",141,0)
 S RETURN=0 ;
"RTN","ORQQPL1",142,0)
 L +^AUPNPROB(0):10
"RTN","ORQQPL1",143,0)
 Q:'$T  ; bail out if no lock
"RTN","ORQQPL1",144,0)
 ;
"RTN","ORQQPL1",145,0)
 S S=""
"RTN","ORQQPL1",146,0)
 F  S S=$O(ADDARRAY(S)) Q:S=""  D
"RTN","ORQQPL1",147,0)
 . S @ADDARRAY(S)
"RTN","ORQQPL1",148,0)
 ;
"RTN","ORQQPL1",149,0)
 D NEW^GMPLSAVE
"RTN","ORQQPL1",150,0)
 ;
"RTN","ORQQPL1",151,0)
 S RETURN=DA
"RTN","ORQQPL1",152,0)
 ;
"RTN","ORQQPL1",153,0)
 L -^AUPNPROB(0)
"RTN","ORQQPL1",154,0)
 S RETURN=1
"RTN","ORQQPL1",155,0)
 Q
"RTN","ORQQPL1",156,0)
 ;
"RTN","ORQQPL1",157,0)
INITUSER(RETURN,ORDUZ) ; INITIALIZE FOR NEW USER
"RTN","ORQQPL1",158,0)
 ; taken from INIT^GMPLMGR
"RTN","ORQQPL1",159,0)
 ; leave GMPLUSER on symbol table - is evaluated in EDITSAVE
"RTN","ORQQPL1",160,0)
 ; 
"RTN","ORQQPL1",161,0)
 N X,PV,CTXT,GMPLPROV
"RTN","ORQQPL1",162,0)
 S GMPLUSER=$$CLINUSER(DUZ)
"RTN","ORQQPL1",163,0)
 S CTXT=$$GET^XPAR("ALL","ORCH CONTEXT PROBLEMS",1)
"RTN","ORQQPL1",164,0)
 S X=$G(^GMPL(125.99,1,0)) ; IN1+6^GMPLMGR
"RTN","ORQQPL1",165,0)
 S RETURN(0)=GMPLUSER ;  problem list user, or other user
"RTN","ORQQPL1",166,0)
 S RETURN(1)=$$VIEW^GMPLX1(DUZ) ; GMPLVIEW("VIEW") - users default view
"RTN","ORQQPL1",167,0)
 S RETURN(2)=+$P(X,U,2) ; verify transcribed problems
"RTN","ORQQPL1",168,0)
 S RETURN(3)=+$P(X,U,3) ; prompt for chart copy
"RTN","ORQQPL1",169,0)
 S RETURN(4)=+$P(X,U,4) ; use lexicon
"RTN","ORQQPL1",170,0)
 S RETURN(5)=$S($P(X,U,5)="R":1,1:0) ; chron or reverse chron listing
"RTN","ORQQPL1",171,0)
 S RETURN(6)=$S($P($G(CTXT),";",3)'="":$P($G(CTXT),";",3),1:"A")
"RTN","ORQQPL1",172,0)
 S GMPLPROV=$P($G(CTXT),";",5)
"RTN","ORQQPL1",173,0)
 I +GMPLPROV>0,$D(^VA(200,GMPLPROV)) D
"RTN","ORQQPL1",174,0)
 . S RETURN(7)=GMPLPROV_U_$P(^VA(200,GMPLPROV,0),U)
"RTN","ORQQPL1",175,0)
 E  S RETURN(7)="0^All"
"RTN","ORQQPL1",176,0)
 S RETURN(8)=$$SERVICE^GMPLX1(DUZ) ; user's service/section
"RTN","ORQQPL1",177,0)
 ; Guessing from what I see in the data that $$VIEW^GMPLX1 actually returns a composite
"RTN","ORQQPL1",178,0)
 ; of default view (in/out patient)/(c1/c2... if out patient i.e. GMPLVIEW("CLIN")) or
"RTN","ORQQPL1",179,0)
 ;                                 /(s1/s2... if in patient i.e. GMPLVIEW("SERV"))
"RTN","ORQQPL1",180,0)
 ; Going with this assumption for now:
"RTN","ORQQPL1",181,0)
 I $L(RETURN(1),"/")>1 D
"RTN","ORQQPL1",182,0)
 . S PV=RETURN(1)
"RTN","ORQQPL1",183,0)
 . S RETURN(1)=$P(PV,"/")
"RTN","ORQQPL1",184,0)
 . I RETURN(1)="C" S GMPLVIEW("CLIN")=$P(PV,"/",2,99)
"RTN","ORQQPL1",185,0)
 . I RETURN(1)="S" S GMPLVIEW("SERV")=$P(PV,"/",2,99)
"RTN","ORQQPL1",186,0)
 S RETURN(9)=$G(GMPLVIEW("SERV")) ; ??? Where from - see tech doc
"RTN","ORQQPL1",187,0)
 S RETURN(10)=$G(GMPLVIEW("CLIN")) ; ??? Where from - see tech doc
"RTN","ORQQPL1",188,0)
 S RETURN(11)=""
"RTN","ORQQPL1",189,0)
 S RETURN(12)=+$P($G(CTXT),";",4)    ; should comments display?
"RTN","ORQQPL1",190,0)
 K GMPLVIEW
"RTN","ORQQPL1",191,0)
 Q
"RTN","ORQQPL1",192,0)
 ;
"RTN","ORQQPL1",193,0)
CLINUSER(ORDUZ) ;is this a clinical user?
"RTN","ORQQPL1",194,0)
 N ORUSER
"RTN","ORQQPL1",195,0)
 S ORUSER=0
"RTN","ORQQPL1",196,0)
 I $D(^XUSEC("ORES",ORDUZ)) S ORUSER=1
"RTN","ORQQPL1",197,0)
 I $D(^XUSEC("ORELSE",ORDUZ)) S ORUSER=1
"RTN","ORQQPL1",198,0)
 I $D(^XUSEC("PROVIDER",ORDUZ)) S ORUSER=1
"RTN","ORQQPL1",199,0)
 Q ORUSER
"RTN","ORQQPL1",200,0)
 ;
"RTN","ORQQPL1",201,0)
INITPT(RETURN,DFN) ; GET PATIENT PARAMETERS
"RTN","ORQQPL1",202,0)
 Q:+$G(DFN)=0
"RTN","ORQQPL1",203,0)
 N GMPSC,GMPAGTOR,GMPION,GMPGULF,GMPHNC,GMPMST,GMPCV,GMPSHD
"RTN","ORQQPL1",204,0)
 ;
"RTN","ORQQPL1",205,0)
 S RETURN(0)=DUZ(2) ; facility #
"RTN","ORQQPL1",206,0)
 D DEM^VADPT ; get death indicator
"RTN","ORQQPL1",207,0)
 S RETURN(1)=$G(VADM(6)) ; death indicator
"RTN","ORQQPL1",208,0)
 D VADPT^GMPLX1(DFN) ; get eligibilities
"RTN","ORQQPL1",209,0)
 S RETURN(2)=$P(GMPSC,U) ; service connected
"RTN","ORQQPL1",210,0)
 S RETURN(3)=$G(GMPAGTOR) ; agent orange exposure
"RTN","ORQQPL1",211,0)
 S RETURN(4)=$G(GMPION) ; ionizing radiation exposure
"RTN","ORQQPL1",212,0)
 S RETURN(5)=$G(GMPGULF) ; gulf war exposure
"RTN","ORQQPL1",213,0)
 S RETURN(6)=VA("BID") ; need this to reconstitute GMPDFN on return
"RTN","ORQQPL1",214,0)
 S RETURN(7)=$G(GMPHNC) ; head/neck cancer
"RTN","ORQQPL1",215,0)
 S RETURN(8)=$G(GMPMST) ; MST
"RTN","ORQQPL1",216,0)
 S RETURN(9)=$G(GMPCV) ; CV
"RTN","ORQQPL1",217,0)
 S RETURN(10)=$G(GMPSHD) ; SHAD
"RTN","ORQQPL1",218,0)
 Q
"RTN","ORQQPL1",219,0)
 ;
"RTN","ORQQPL1",220,0)
PROVSRCH(LST,FLAG,N,FROM,PART) ; Get candidate Rroviders from person file
"RTN","ORQQPL1",221,0)
 N LV,NS,RV,IEN
"RTN","ORQQPL1",222,0)
 S RV=$NAME(LV("DILIST","ID"))
"RTN","ORQQPL1",223,0)
 IF +$G(N)=0 S N=50
"RTN","ORQQPL1",224,0)
 S FLAG=$G(FLAG),N=$G(N),FROM=$G(FROM),PART=$G(PART)
"RTN","ORQQPL1",225,0)
 D LIST^DIC(200,"",".01;1",FLAG,N,FROM,PART,"","","","LV")
"RTN","ORQQPL1",226,0)
 S NS=""
"RTN","ORQQPL1",227,0)
 F  S NS=$O(LV("DILIST",1,NS)) Q:NS=""  D
"RTN","ORQQPL1",228,0)
 . S IEN=""
"RTN","ORQQPL1",229,0)
 . S IEN=$O(^VA(200,"B",@RV@(NS,.01),IEN)) ; compliments of PROV^ORQPTQ
"RTN","ORQQPL1",230,0)
 . S LST(NS)=IEN_U_@RV@(NS,.01)  ; initials_U_@RV@(NS,1)
"RTN","ORQQPL1",231,0)
 Q
"RTN","ORQQPL1",232,0)
 ;
"RTN","ORQQPL1",233,0)
CLINSRCH(Y,X) ; Get LIST OF CLINICS
"RTN","ORQQPL1",234,0)
 ; Note: This comes from CLIN^ORQPTQ2, where it was commented out in place of 
"RTN","ORQQPL1",235,0)
 ; a call to ^XPAR. I would have just used CLIN^ORQPTQ2, but it didn't work - at
"RTN","ORQQPL1",236,0)
 ; least on SLC OEX directory.
"RTN","ORQQPL1",237,0)
 ; X has no purpose other than to satisfy apparent rpc and tcallv requirement for args
"RTN","ORQQPL1",238,0)
 N I,NAME,IEN
"RTN","ORQQPL1",239,0)
 S I=1,IEN=0,NAME=""
"RTN","ORQQPL1",240,0)
 ;access to SC global granted under DBIA #518:
"RTN","ORQQPL1",241,0)
 F  S NAME=$O(^SC("B",NAME)) Q:NAME=""  S IEN=$O(^(NAME,0)) D
"RTN","ORQQPL1",242,0)
 . I $P(^SC(IEN,0),"^",3)="C" S Y(I)=IEN_"^"_NAME,I=I+1
"RTN","ORQQPL1",243,0)
 Q
"RTN","ORQQPL1",244,0)
 ;
"RTN","ORQQPL1",245,0)
SRVCSRCH(Y,FROM,DIR,ALL) ; GET LIST OF SERVICES
"RTN","ORQQPL1",246,0)
 N I,IEN,CNT S I=0,CNT=44
"RTN","ORQQPL1",247,0)
 F  Q:I=CNT  S FROM=$O(^DIC(49,"B",FROM),DIR) Q:FROM=""  D
"RTN","ORQQPL1",248,0)
 . S IEN=$O(^DIC(49,"B",FROM,0)) I '$G(ALL),$P(^DIC(49,IEN,0),U,9)'="C" Q
"RTN","ORQQPL1",249,0)
 . S I=I+1,Y(I)=IEN_"^"_FROM
"RTN","ORQQPL1",250,0)
 Q
"RTN","ORQQPL1",251,0)
 ;
"RTN","ORQQPL1",252,0)
DUP(Y,DFN,TERM,TEXT) ;Check for duplicate problem
"RTN","ORQQPL1",253,0)
 S Y=$$DUPL^GMPLX(DFN,TERM,TEXT) Q:+Y=0
"RTN","ORQQPL1",254,0)
 I $P(^AUPNPROB(Y,1),U,2)="H" S Y=0 Q
"RTN","ORQQPL1",255,0)
 S Y=Y_U_$P(^AUPNPROB(Y,0),U,12)
"RTN","ORQQPL1",256,0)
 Q
"RTN","ORQQPL3")
0^55^B55317795
"RTN","ORQQPL3",1,0)
ORQQPL3 ; ALB/PDR/REV ; Problem List RPC's ; 8-OCT-1998 09:08:49.29
"RTN","ORQQPL3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,148,173,243**;Dec 17, 1997;Build 242
"RTN","ORQQPL3",3,0)
 ;
"RTN","ORQQPL3",4,0)
 ;---------------- LIST PATIENT PROBLEMS ------------------------
"RTN","ORQQPL3",5,0)
 ;
"RTN","ORQQPL3",6,0)
PROBL(ROOT,DFN,CONTEXT)        ;  GET LIST OF PATIENT PROBLEMS
"RTN","ORQQPL3",7,0)
 N DIWL,DIWR,DIWF
"RTN","ORQQPL3",8,0)
 N ST,ORI,ORX
"RTN","ORQQPL3",9,0)
 S (LCNT,NUM)=0
"RTN","ORQQPL3",10,0)
 S DIWL=1,DIWR=48,DIWF="C48"
"RTN","ORQQPL3",11,0)
 S CONTEXT=";;"_$G(CONTEXT)
"RTN","ORQQPL3",12,0)
 I CONTEXT=";;" S CONTEXT=";;A"
"RTN","ORQQPL3",13,0)
 S ST=$P(CONTEXT,";",3)
"RTN","ORQQPL3",14,0)
 ;
"RTN","ORQQPL3",15,0)
 I ST="R" D DELLIST(.ROOT,+DFN) ; show deleted only
"RTN","ORQQPL3",16,0)
 I ST'="R"  D LIST(.ROOT,+DFN,ST) ; show others - don't trust ELSE here
"RTN","ORQQPL3",17,0)
 ;
"RTN","ORQQPL3",18,0)
 I ROOT(0)<1 D
"RTN","ORQQPL3",19,0)
 . S LCNT=1
"RTN","ORQQPL3",20,0)
 . S ROOT(1)="     "_$$PAD^ORCHTAB("No data available.",49)_"|"
"RTN","ORQQPL3",21,0)
 Q
"RTN","ORQQPL3",22,0)
 ;
"RTN","ORQQPL3",23,0)
 ;
"RTN","ORQQPL3",24,0)
LIST(GMPL,GMPDFN,GMPSTAT)       ; -- Returns list of problems for patient GMPDFN
"RTN","ORQQPL3",25,0)
 ;    in GMPL(#)=ifn^status^description^ICD^onset^last modified^SC^SpExp^Condition^Loc^
"RTN","ORQQPL3",26,0)
 ;                          loc.type^prov^service
"RTN","ORQQPL3",27,0)
 ;     & GMPL(0)=number of problems returned
"RTN","ORQQPL3",28,0)
 ; This is virtually same as LIST^GMPLUTL2 except that it appends the 
"RTN","ORQQPL3",29,0)
 ; condition - T)ranscribed or P)ermanent,location,loc type,provider, service.
"RTN","ORQQPL3",30,0)
 ;
"RTN","ORQQPL3",31,0)
 N I,IFN,CNT,GMPL0,GMPL1,SP,ST,NUM,ONSET,ICD,LASTMOD,PRIO,DTREC
"RTN","ORQQPL3",32,0)
 N SC,ORLIST,ORVIEW,GMPARAM,ORTOTAL,LIN,LOC,LT,PROV,SERV,HASCMT
"RTN","ORQQPL3",33,0)
 N SCCOND,AO,IR,ENV,HNC,MST,CV,SHD,ORICD186,INACT
"RTN","ORQQPL3",34,0)
 Q:$G(GMPDFN)'>0
"RTN","ORQQPL3",35,0)
 S CNT=0,SP=""
"RTN","ORQQPL3",36,0)
 S GMPARAM("QUIET")=1
"RTN","ORQQPL3",37,0)
 S GMPARAM("REV")=$P($G(^GMPL(125.99,1,0)),U,5)="R"
"RTN","ORQQPL3",38,0)
 S ORVIEW("ACT")=GMPSTAT
"RTN","ORQQPL3",39,0)
 S ORVIEW("PROV")=0
"RTN","ORQQPL3",40,0)
 S ORVIEW("VIEW")=""
"RTN","ORQQPL3",41,0)
 S ORICD186=$$PATCH^XPDUTL("ICD*18.0*6")
"RTN","ORQQPL3",42,0)
 ;
"RTN","ORQQPL3",43,0)
 D GETPLIST^GMPLMGR1(.ORLIST,.ORTOTAL,.ORVIEW)
"RTN","ORQQPL3",44,0)
 ;
"RTN","ORQQPL3",45,0)
 F NUM=0:0 S NUM=$O(ORLIST(NUM)) Q:NUM'>0  D
"RTN","ORQQPL3",46,0)
 . S IFN=+ORLIST(NUM) Q:IFN'>0
"RTN","ORQQPL3",47,0)
 . S INACT=""
"RTN","ORQQPL3",48,0)
 . S GMPL0=$G(^AUPNPROB(IFN,0))
"RTN","ORQQPL3",49,0)
 . S GMPL1=$G(^AUPNPROB(IFN,1))
"RTN","ORQQPL3",50,0)
 . S HASCMT=($D(^AUPNPROB(IFN,11,0))>0)
"RTN","ORQQPL3",51,0)
 . S CNT=CNT+1
"RTN","ORQQPL3",52,0)
 . I +ORICD186 D
"RTN","ORQQPL3",53,0)
 . . S ICD=$$CODEC^ICDCODE(+GMPL0)
"RTN","ORQQPL3",54,0)
 . . I '+$$STATCHK^ICDAPIU(ICD,DT) S INACT="#"
"RTN","ORQQPL3",55,0)
 . E  D
"RTN","ORQQPL3",56,0)
 . . S ICD=$P($G(^ICD9(+GMPL0,0)),U)
"RTN","ORQQPL3",57,0)
 . S LASTMOD=$P(GMPL0,U,3)
"RTN","ORQQPL3",58,0)
 . S ST=$P(GMPL0,U,12)
"RTN","ORQQPL3",59,0)
 . S ONSET=$P(GMPL0,U,13)
"RTN","ORQQPL3",60,0)
 . S SC=$S(+$P(GMPL1,U,10):"SC",$P(GMPL1,U,10)=0:"NSC",1:"")
"RTN","ORQQPL3",61,0)
 . S AO=$S(+$P(GMPL1,U,11):"/AO",1:"")
"RTN","ORQQPL3",62,0)
 . S IR=$S(+$P(GMPL1,U,12):"/IR",1:"")
"RTN","ORQQPL3",63,0)
 . S ENV=$S(+$P(GMPL1,U,13):"/EC",1:"")
"RTN","ORQQPL3",64,0)
 . S HNC=$S(+$P(GMPL1,U,15):"/HNC",1:"")
"RTN","ORQQPL3",65,0)
 . S MST=$S(+$P(GMPL1,U,16):"/MST",1:"")
"RTN","ORQQPL3",66,0)
 . S CV=$S(+$P(GMPL1,U,17):"/CV",1:"")
"RTN","ORQQPL3",67,0)
 . S SHD=$S(+$P(GMPL1,U,18):"/SHD",1:"")
"RTN","ORQQPL3",68,0)
 . S SCCOND=SC_AO_IR_ENV_HNC_MST_CV_SHD
"RTN","ORQQPL3",69,0)
 . S LOC=$P(GMPL1,U,8)
"RTN","ORQQPL3",70,0)
 . S DTREC=$P(GMPL1,U,9)
"RTN","ORQQPL3",71,0)
 . S LT=""
"RTN","ORQQPL3",72,0)
 . I LOC'="" S LT=$P($G(^SC(LOC,0)),"^",3),LOC=LOC_";"_$P($G(^SC(LOC,0)),U,1)
"RTN","ORQQPL3",73,0)
 . S PROV=$P(GMPL1,U,5) ; responsible provider
"RTN","ORQQPL3",74,0)
 . I PROV'="" S PROV=PROV_";"_$P($G(^VA(200,PROV,0)),U,1)
"RTN","ORQQPL3",75,0)
 . S SERV=$P(GMPL1,U,6)
"RTN","ORQQPL3",76,0)
 . I SERV=0 S SERV="" ; not sure how it gets set to 0, but need consistency in GUI
"RTN","ORQQPL3",77,0)
 . I SERV'="" S SERV=SERV_";"_$P($G(^DIC(49,SERV,0)),U,1)
"RTN","ORQQPL3",78,0)
 . S SP=""
"RTN","ORQQPL3",79,0)
 . F I=11,12,13 S:$P(GMPL1,U,I) SP=SP_$S(I=11:"A",I=12:"I",1:"P")
"RTN","ORQQPL3",80,0)
 . S PRIO=$P(GMPL1,U,14)
"RTN","ORQQPL3",81,0)
 . S LIN=IFN_U_ST_U_$$PROBTEXT^GMPLX(IFN)_U_ICD_U_ONSET
"RTN","ORQQPL3",82,0)
 . S LIN=LIN_U_LASTMOD_U_SC_U_SP_U_$P(GMPL1,U,2)
"RTN","ORQQPL3",83,0)
 . S LIN=LIN_U_LOC_U_LT_U_PROV_U_SERV_U_PRIO_U_HASCMT_U_DTREC_U_SCCOND_U_INACT
"RTN","ORQQPL3",84,0)
 . S GMPL(CNT)=LIN
"RTN","ORQQPL3",85,0)
 S GMPL(0)=CNT
"RTN","ORQQPL3",86,0)
 Q
"RTN","ORQQPL3",87,0)
 ;
"RTN","ORQQPL3",88,0)
 ;
"RTN","ORQQPL3",89,0)
 ;------------------------------------- GET LIST OF DELETED PROBLEMS -----------------------------
"RTN","ORQQPL3",90,0)
 ;
"RTN","ORQQPL3",91,0)
DELLIST(RETURN,GMPDFN) ; GET LIST OF DELETED PROBLEMS
"RTN","ORQQPL3",92,0)
 ; see GETPLIST^GMPLMGR1 and LIST^GMPUTL2
"RTN","ORQQPL3",93,0)
 N S,IFN,I,L0,L1,ST,TXT,ICD,ONSET,MOD,SC,SP,LOC,LT,PROV,SERV,PRIO,HASCMT,DTREC
"RTN","ORQQPL3",94,0)
 N SCCOND,AO,IR,ENV,HNC,MST,CV,SHD,ORICD186,INACT
"RTN","ORQQPL3",95,0)
 S I=0,S=""
"RTN","ORQQPL3",96,0)
 S ORICD186=$$PATCH^XPDUTL("ICD*18.0*6")
"RTN","ORQQPL3",97,0)
 F  S S=$O(^AUPNPROB("ACTIVE",GMPDFN,S)) Q:S=""  D
"RTN","ORQQPL3",98,0)
 . S IFN=""
"RTN","ORQQPL3",99,0)
 . F  S IFN=$O(^AUPNPROB("ACTIVE",+GMPDFN,S,IFN)) Q:IFN=""  D
"RTN","ORQQPL3",100,0)
 .. I $P($G(^AUPNPROB(IFN,1)),U,2)="H" D
"RTN","ORQQPL3",101,0)
 ... S L0=$G(^AUPNPROB(IFN,0))
"RTN","ORQQPL3",102,0)
 ... Q:L0=""
"RTN","ORQQPL3",103,0)
 ... S INACT=""
"RTN","ORQQPL3",104,0)
 ... S L1=$G(^AUPNPROB(IFN,1))
"RTN","ORQQPL3",105,0)
 ... S ST=$P(L0,U,12)
"RTN","ORQQPL3",106,0)
 ... S TXT=$$PROBTEXT^GMPLX(IFN)
"RTN","ORQQPL3",107,0)
 ... I +ORICD186 D
"RTN","ORQQPL3",108,0)
 ... . S ICD=$$CODEC^ICDCODE(+L0)
"RTN","ORQQPL3",109,0)
 ... . I '+$$STATCHK^ICDAPIU(ICD,DT) S INACT="#"
"RTN","ORQQPL3",110,0)
 ... E  D
"RTN","ORQQPL3",111,0)
 ... . S ICD=$P($G(^ICD9(+L0,0)),U)
"RTN","ORQQPL3",112,0)
 ... S ONSET=$P(L0,U,13)
"RTN","ORQQPL3",113,0)
 ... S MOD=$P(L0,U,3)
"RTN","ORQQPL3",114,0)
 ... S SC=$S(+$P(L1,U,10):"SC",$P(L1,U,10)=0:"NSC",1:"")
"RTN","ORQQPL3",115,0)
 ... S AO=$S(+$P(L1,U,11):"/AO",1:"")
"RTN","ORQQPL3",116,0)
 ... S IR=$S(+$P(L1,U,12):"/IR",1:"")
"RTN","ORQQPL3",117,0)
 ... S ENV=$S(+$P(L1,U,13):"/EC",1:"")
"RTN","ORQQPL3",118,0)
 ... S HNC=$S(+$P(L1,U,15):"/HNC",1:"")
"RTN","ORQQPL3",119,0)
 ... S MST=$S(+$P(L1,U,16):"/MST",1:"")
"RTN","ORQQPL3",120,0)
 ... S CV=$S(+$P(L1,U,17):"/CV",1:"")
"RTN","ORQQPL3",121,0)
 ... S SHD=$S(+$P(L1,U,18):"/SHD",1:"")
"RTN","ORQQPL3",122,0)
 ... S SCCOND=SC_AO_IR_ENV_HNC_MST_CV_SHD
"RTN","ORQQPL3",123,0)
 ... S SP=$$GETSP
"RTN","ORQQPL3",124,0)
 ... S LOC=$P(L1,U,8)
"RTN","ORQQPL3",125,0)
 ... S LT=""
"RTN","ORQQPL3",126,0)
 ... I LOC'="" S LT=$P($G(^SC(LOC,0)),"^",3)
"RTN","ORQQPL3",127,0)
 ... S PROV=$P(L1,U,5) ; responsible provider
"RTN","ORQQPL3",128,0)
 ... S SERV=$P(L1,U,6)
"RTN","ORQQPL3",129,0)
 ... S PRIO=$P(L1,U,14)
"RTN","ORQQPL3",130,0)
 ... S HASCMT=($D(^AUPNPROB(IFN,11,0))>0)
"RTN","ORQQPL3",131,0)
 ... S DTREC=$P(L1,U,9)
"RTN","ORQQPL3",132,0)
 ... S I=I+1
"RTN","ORQQPL3",133,0)
 ... S RETURN(I)=IFN_U_ST_U_TXT_U_ICD_U_ONSET
"RTN","ORQQPL3",134,0)
 ... S RETURN(I)=RETURN(I)_U_MOD_U_SC_U_SP_U_$P(L1,U,2)
"RTN","ORQQPL3",135,0)
 ... S RETURN(I)=RETURN(I)_U_LOC_U_LT_U_PROV_U_SERV
"RTN","ORQQPL3",136,0)
 ... S RETURN(I)=RETURN(I)_U_PRIO_U_HASCMT_U_DTREC_U_SCCOND_U_INACT
"RTN","ORQQPL3",137,0)
 S RETURN(0)=I
"RTN","ORQQPL3",138,0)
 Q
"RTN","ORQQPL3",139,0)
 ;
"RTN","ORQQPL3",140,0)
GETSP() ; GET EXPOSURES
"RTN","ORQQPL3",141,0)
 N I
"RTN","ORQQPL3",142,0)
 S SP=""
"RTN","ORQQPL3",143,0)
 F I=11,12,13 S:$P(L1,U,I) SP=SP_$S(I=11:"A",I=12:"I",1:"P")
"RTN","ORQQPL3",144,0)
 Q SP
"RTN","ORQQPL3",145,0)
 ;
"RTN","ORQQPL3",146,0)
 ; adapted from ^GMPLBLD3 ;9/96
"RTN","ORQQPL3",147,0)
 ;
"RTN","ORQQPL3",148,0)
 ; ----------------------- GET USER PROBLEM CATEGORIES --------------
"RTN","ORQQPL3",149,0)
 ;
"RTN","ORQQPL3",150,0)
CAT(TMP,ORDUZ,CLIN) ; Get user category list
"RTN","ORQQPL3",151,0)
 N GSEQ,GCNT,GROUP,HDR,IFN,LCNT,ITEM,TG,GMPLSLST
"RTN","ORQQPL3",152,0)
 ; S TG=$NAME(^TMP("GMPLMENU",$J)) ; put list in global for testing
"RTN","ORQQPL3",153,0)
 S TG=$NAME(TMP) ; put list in local
"RTN","ORQQPL3",154,0)
 K @TG
"RTN","ORQQPL3",155,0)
 S (GSEQ,GCNT,LCNT)=0
"RTN","ORQQPL3",156,0)
 ;
"RTN","ORQQPL3",157,0)
 S GMPLSLST=$$GETUSLST(DUZ,CLIN)  ; get approp list for user
"RTN","ORQQPL3",158,0)
 ; Build multiple of category\problems
"RTN","ORQQPL3",159,0)
 ; Iterate categories
"RTN","ORQQPL3",160,0)
 F  S GSEQ=$O(^GMPL(125.1,"C",+GMPLSLST,GSEQ)) Q:GSEQ'>0  D
"RTN","ORQQPL3",161,0)
 . S IFN=$O(^GMPL(125.1,"C",+GMPLSLST,GSEQ,0)) Q:IFN'>0
"RTN","ORQQPL3",162,0)
 . S ITEM=$G(^GMPL(125.1,IFN,0))
"RTN","ORQQPL3",163,0)
 . S GROUP=+$P(ITEM,U,3)
"RTN","ORQQPL3",164,0)
 . S HDR=GROUP_U_$P(ITEM,U,4,5)
"RTN","ORQQPL3",165,0)
 . S GCNT=GCNT+1
"RTN","ORQQPL3",166,0)
 . S @TG@(GCNT)=HDR ; put category into temp global
"RTN","ORQQPL3",167,0)
 Q
"RTN","ORQQPL3",168,0)
 ;
"RTN","ORQQPL3",169,0)
GETUSLST(ORDUZ,CLIN) ; GET AN APPROPRIATE CATEGORY LIST FOR THE USER
"RTN","ORQQPL3",170,0)
 N GMPLSLST
"RTN","ORQQPL3",171,0)
 S GMPLSLST=$P($G(^VA(200,DUZ,125)),U,2)
"RTN","ORQQPL3",172,0)
 ;I 'GMPLSLST D
"RTN","ORQQPL3",173,0)
 I 'GMPLSLST,CLIN,$D(^GMPL(125,"C",+CLIN)) S GMPLSLST=$O(^(+CLIN,0))
"RTN","ORQQPL3",174,0)
 ;. S GMPLSLST=$O(^VA(200,DUZ,+CLIN,0))  ;$O(^(+CLIN,0))
"RTN","ORQQPL3",175,0)
 Q GMPLSLST
"RTN","ORQQPL3",176,0)
 ;
"RTN","ORQQPL3",177,0)
 ;----------------------- USER PROBLEM LIST --------------------------
"RTN","ORQQPL3",178,0)
 ;
"RTN","ORQQPL3",179,0)
PROB(TMP,GROUP) ; Get user problem list for given group
"RTN","ORQQPL3",180,0)
 N PSEQ,PCNT,IFN,ITEM,TG,CODE,TEXT,ORICD186
"RTN","ORQQPL3",181,0)
 ; S TG=$NAME(^TMP("GMPLMENU",$J)) ; put list in global for testing
"RTN","ORQQPL3",182,0)
 S TG=$NAME(TMP) ; put list in local
"RTN","ORQQPL3",183,0)
 K @TG
"RTN","ORQQPL3",184,0)
 S LCNT=0
"RTN","ORQQPL3",185,0)
 S ORICD186=$$PATCH^XPDUTL("ICD*18.0*6")
"RTN","ORQQPL3",186,0)
 ;
"RTN","ORQQPL3",187,0)
 ; iterate through problems in category
"RTN","ORQQPL3",188,0)
 S (PSEQ,PCNT)=0
"RTN","ORQQPL3",189,0)
 F  S PSEQ=$O(^GMPL(125.12,"C",GROUP,PSEQ)) Q:PSEQ'>0  D
"RTN","ORQQPL3",190,0)
 . S IFN=$O(^GMPL(125.12,"C",GROUP,PSEQ,0)) Q:IFN'>0
"RTN","ORQQPL3",191,0)
 . S ITEM=$G(^GMPL(125.12,IFN,0))
"RTN","ORQQPL3",192,0)
 . S TEXT=$P(ITEM,U,4)
"RTN","ORQQPL3",193,0)
 . ; SEE DD for GMPL(125.12,4 :
"RTN","ORQQPL3",194,0)
 . ; "...code which is to be displayed... generally assumed to be ICD"
"RTN","ORQQPL3",195,0)
 . S CODE=$P(ITEM,U,5)
"RTN","ORQQPL3",196,0)
 . I +ORICD186,'+$$STATCHK^ICDAPIU(CODE,DT) Q
"RTN","ORQQPL3",197,0)
 . S PCNT=PCNT+1
"RTN","ORQQPL3",198,0)
 . ; RETURN:
"RTN","ORQQPL3",199,0)
 . ; PROBLEM^DISPLAY TEXT^CODE^CODE IFN
"RTN","ORQQPL3",200,0)
 . I +ORICD186 D
"RTN","ORQQPL3",201,0)
 . . S @TG@(PCNT)=$P(ITEM,U,3,5)_U_$$CODEN^ICDCODE(CODE,80)
"RTN","ORQQPL3",202,0)
 . E  D
"RTN","ORQQPL3",203,0)
 . . S @TG@(PCNT)=$P(ITEM,U,3,5)_U_$$ICDCODE(CODE)
"RTN","ORQQPL3",204,0)
 Q
"RTN","ORQQPL3",205,0)
 ;
"RTN","ORQQPL3",206,0)
ICDCODE(COD)    ; RETURN INTERNAL ICD FOR EXTERNAL CODE  (obsolete after CSV patches released - RV)
"RTN","ORQQPL3",207,0)
 N CODIEN
"RTN","ORQQPL3",208,0)
 I COD="" Q ""
"RTN","ORQQPL3",209,0)
 S CODIEN=+$O(^ICD9("AB",$P(COD,U)_" ",0))
"RTN","ORQQPL3",210,0)
 S:CODIEN'>0 CODIEN=+$O(^ICD9("AB",$P(COD,U)_"0 ",0))
"RTN","ORQQPL3",211,0)
 Q CODIEN
"RTN","ORQQPL3",212,0)
 ;
"RTN","ORQQPL3",213,0)
 ;------------------ Filter Providers ---------------------
"RTN","ORQQPL3",214,0)
 ;
"RTN","ORQQPL3",215,0)
GETRPRV(RETURN,INP) ; GET LIST OF RESPONSIBLE PROVIDERS FROM PRBLM LIST 
"RTN","ORQQPL3",216,0)
 ; RETURN - aa list of responsible providers from which to select for filtering
"RTN","ORQQPL3",217,0)
 ; INP - array of problem list providers to select from
"RTN","ORQQPL3",218,0)
 ;
"RTN","ORQQPL3",219,0)
 N S
"RTN","ORQQPL3",220,0)
 S S=""
"RTN","ORQQPL3",221,0)
 F I=1:1 S S=$O(INP(S)) Q:S=""  D
"RTN","ORQQPL3",222,0)
 . I INP(S)'="",$G(^VA(200,INP(S),0))'="" D  Q  ; get next
"RTN","ORQQPL3",223,0)
 .. S RETURN(I)=INP(S)_U_$P(^VA(200,INP(S),0),U)
"RTN","ORQQPL3",224,0)
 S RETURN(0)="-1"_U_"<None recorded>" ; return empty provider
"RTN","ORQQPL3",225,0)
 Q
"RTN","ORQQPL3",226,0)
 ;
"RTN","ORQQPL3",227,0)
 ;---------------------------------------------------- GET FILTERED CLINIC LIST ------------------------
"RTN","ORQQPL3",228,0)
 ;
"RTN","ORQQPL3",229,0)
GETCLIN(RETURN,INP) ; Get FILTERED LIST OF CLINICS
"RTN","ORQQPL3",230,0)
 ; RETURN NAMES FOR LIST OF CLINICS PASSED IN
"RTN","ORQQPL3",231,0)
 N I,S
"RTN","ORQQPL3",232,0)
 S S=""
"RTN","ORQQPL3",233,0)
 F I=1:1 S S=$O(INP(S)) Q:S=""  D
"RTN","ORQQPL3",234,0)
 . I INP(S)'="",$G(^SC(INP(S),0))'="" D  Q  ; get next
"RTN","ORQQPL3",235,0)
 .. S RETURN(I)=INP(S)_U_$P(^SC(INP(S),0),U,1)
"RTN","ORQQPL3",236,0)
 ;. S RETURN(I)="-1"_U_"None" ; return empty location
"RTN","ORQQPL3",237,0)
 Q
"RTN","ORQQPL3",238,0)
 ;
"RTN","ORQQPL3",239,0)
GETSRVC(RETURN,INP) ; GET FILTERED LIST OF INPATIENT SERVICES
"RTN","ORQQPL3",240,0)
 ; RETURN NAMES FOR LIST OF IEN PASSED IN
"RTN","ORQQPL3",241,0)
 N I,S
"RTN","ORQQPL3",242,0)
 S S=""
"RTN","ORQQPL3",243,0)
 F I=1:1 S S=$O(INP(S)) Q:S=""  D
"RTN","ORQQPL3",244,0)
 . I INP(S)'="",$G(^DIC(49,INP(S),0))'="" D  Q  ; get next
"RTN","ORQQPL3",245,0)
 .. S RETURN(I)=INP(S)_U_$P(^DIC(49,INP(S),0),U,1)
"RTN","ORQQPL3",246,0)
 ;. S RETURN(I)="-1"_U_"None" ; return empty service
"RTN","ORQQPL3",247,0)
 Q
"RTN","ORQQPXRM")
0^180^B18382115
"RTN","ORQQPXRM",1,0)
ORQQPXRM ; SLC/PJH - Functions for reminder data ;12/04/2007
"RTN","ORQQPXRM",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,116,173,187,190,215,243**;Dec 17, 1997;Build 242
"RTN","ORQQPXRM",3,0)
 ;
"RTN","ORQQPXRM",4,0)
 ;ORQQPXRM DIALOG ACTIVE
"RTN","ORQQPXRM",5,0)
ACTIVE(ORY,ORLIST) D ACTIVE^PXRMRPCC(.ORY,.ORLIST) Q  ; DBIA 3080
"RTN","ORQQPXRM",6,0)
 ;
"RTN","ORQQPXRM",7,0)
 ;ORQQPXRM REMINDER EVALUATION
"RTN","ORQQPXRM",8,0)
ALIST(ORY,ORPT,ORLIST) D ALIST^PXRMRPCA(.ORY,.ORPT,.ORLIST) Q  ; DBIA 3078
"RTN","ORQQPXRM",9,0)
 ;
"RTN","ORQQPXRM",10,0)
 ;ORQQPXRM REMINDERS APPLICABLE
"RTN","ORQQPXRM",11,0)
APPL(ORY,ORPT,ORLOC) D EVALCOVR^ORQQPX(.ORY,ORPT,ORLOC) Q
"RTN","ORQQPXRM",12,0)
 ;D APPL^PXRMRPCA(.ORY,ORPT,ORLOC) Q  ; DBIA 3078
"RTN","ORQQPXRM",13,0)
 ;
"RTN","ORQQPXRM",14,0)
 ;ORQQPXRM REMINDER CATEGORIES
"RTN","ORQQPXRM",15,0)
CATEGORY(ORY,ORPT,ORLOC) ;
"RTN","ORQQPXRM",16,0)
 D CATEGORY^PXRMRPCA(.ORY,ORPT,ORLOC) Q  ; DBIA 3078
"RTN","ORQQPXRM",17,0)
 ;
"RTN","ORQQPXRM",18,0)
 ;ORQQPXRM REMINDER DIALOG
"RTN","ORQQPXRM",19,0)
DIALOG(ORY,ORREM,DFN) ;
"RTN","ORQQPXRM",20,0)
 ; DBIA 3080
"RTN","ORQQPXRM",21,0)
 N DIEN
"RTN","ORQQPXRM",22,0)
 D DIALOG^PXRMRPCC(.ORY,ORREM,DFN)
"RTN","ORQQPXRM",23,0)
 ;I $G(DFN)'="" D DIALOG^PXRMRPCC(.ORY,ORREM,DFN)
"RTN","ORQQPXRM",24,0)
 ;I $G(DFN)="" D DIALOG^PXRMRPCC(.ORY,ORREM)
"RTN","ORQQPXRM",25,0)
 I $P($G(ORY(1)),U)=-1 Q
"RTN","ORQQPXRM",26,0)
 S DIEN=$G(^PXD(811.9,ORREM,51))
"RTN","ORQQPXRM",27,0)
 S ORY(0)=0_U_+$P($G(^PXRMD(801.41,DIEN,0)),U,17)
"RTN","ORQQPXRM",28,0)
 Q
"RTN","ORQQPXRM",29,0)
 ;
"RTN","ORQQPXRM",30,0)
 ;ORQQPXRM EDUCATION SUBTOPICS
"RTN","ORQQPXRM",31,0)
EDS(ORY,OREDU) D EDS^PXRMRPCB(.ORY,OREDU) Q  ; DBIA 3079
"RTN","ORQQPXRM",32,0)
 ;
"RTN","ORQQPXRM",33,0)
 ;ORQQPXRM EDUCATION SUMMARY
"RTN","ORQQPXRM",34,0)
EDL(ORY,OREM) D EDL^PXRMRPCB(.ORY,OREM) Q  ; DBIA 3079
"RTN","ORQQPXRM",35,0)
 ;
"RTN","ORQQPXRM",36,0)
 ;ORQQPXRM EDUCATION TOPIC
"RTN","ORQQPXRM",37,0)
EDU(ORY,OREDU) D EDU^PXRMRPCB(.ORY,OREDU) Q  ; DBIA 3079
"RTN","ORQQPXRM",38,0)
 ;
"RTN","ORQQPXRM",39,0)
 ;ORQQPXRM PROGRESS NOTE HEADER
"RTN","ORQQPXRM",40,0)
HDR(ORY,ORLOC) D HDR^PXRMRPCC(.ORY,ORLOC) Q  ; DBIA 3080
"RTN","ORQQPXRM",41,0)
 ;
"RTN","ORQQPXRM",42,0)
 ;ORQQPXRM REMINDERS UNEVALUATED
"RTN","ORQQPXRM",43,0)
LIST(ORY,ORPT,ORLOC) D GETLIST^ORQQPX(.ORY,ORLOC) Q
"RTN","ORQQPXRM",44,0)
 ;D LIST^PXRMRPCA(.ORY,ORPT,ORLOC) Q  ; DBIA 3078
"RTN","ORQQPXRM",45,0)
 ;
"RTN","ORQQPXRM",46,0)
 ;ORQQPXRM MENTAL HEALTH
"RTN","ORQQPXRM",47,0)
MH(ORY,OTEST) ;
"RTN","ORQQPXRM",48,0)
 D MH^PXRMRPCC(.ORY,OTEST)  ; DBIA 3080
"RTN","ORQQPXRM",49,0)
 S ORY(0)=0
"RTN","ORQQPXRM",50,0)
 I $$PATCH^XPDUTL("YS*5.01*85") S ORY(0)=1
"RTN","ORQQPXRM",51,0)
 Q
"RTN","ORQQPXRM",52,0)
 ;
"RTN","ORQQPXRM",53,0)
MHDLL(ORY,DFN,INPUTS) ;
"RTN","ORQQPXRM",54,0)
 N CNT,CNT1,ORRESULT,ORSCORES,TEXT
"RTN","ORQQPXRM",55,0)
 F TEXT="RESULTS","SCORES" D
"RTN","ORQQPXRM",56,0)
 .S CNT=0,CNT1=0
"RTN","ORQQPXRM",57,0)
 .F  S CNT=$O(INPUTS(TEXT,CNT)) Q:CNT=""  D
"RTN","ORQQPXRM",58,0)
 ..S CNT1=CNT1+1
"RTN","ORQQPXRM",59,0)
 ..I TEXT="RESULTS" S ORRESULT(CNT1)=$G(INPUTS(TEXT,CNT))
"RTN","ORQQPXRM",60,0)
 ..I TEXT="SCORES" S ORSCORES(CNT1)=$G(INPUTS(TEXT,CNT))
"RTN","ORQQPXRM",61,0)
 D MHDLL^PXRMDRSG(.ORY,.ORRESULT,.ORSCORES,DFN)
"RTN","ORQQPXRM",62,0)
 Q
"RTN","ORQQPXRM",63,0)
 ;
"RTN","ORQQPXRM",64,0)
MHDLLDMS(ORY) ;
"RTN","ORQQPXRM",65,0)
 ;Returns a one if CPRS should used the MH dll. Returns a 0 if CPRS
"RTN","ORQQPXRM",66,0)
 ;should not used the MH dll.
"RTN","ORQQPXRM",67,0)
 S ORY=1
"RTN","ORQQPXRM",68,0)
 I '$$PATCH^XPDUTL("YS*5.01*85") S ORY=0 Q
"RTN","ORQQPXRM",69,0)
 I '$$PATCH^XPDUTL("PXRM*2.0*6") S ORY=0 Q
"RTN","ORQQPXRM",70,0)
 I $$GET^XPAR("SYS","OR USE MH DLL")<1 S ORY=0 Q
"RTN","ORQQPXRM",71,0)
 Q
"RTN","ORQQPXRM",72,0)
 ;
"RTN","ORQQPXRM",73,0)
 ;ORQQPXRM MENTAL HEALTH RESULTS
"RTN","ORQQPXRM",74,0)
MHR(ORY,RESULT,ORES) ;
"RTN","ORQQPXRM",75,0)
 ; DBIA 3080
"RTN","ORQQPXRM",76,0)
 D MHR^PXRMRPCC(.ORY,RESULT,.ORES)
"RTN","ORQQPXRM",77,0)
 Q
"RTN","ORQQPXRM",78,0)
 ;
"RTN","ORQQPXRM",79,0)
 ;ORQQPXRM MENTAL HEALTH SAVE
"RTN","ORQQPXRM",80,0)
MHS(ORY,ORES) D MHS^PXRMRPCC(.ORY,.ORES) Q  ; DBIA 3080
"RTN","ORQQPXRM",81,0)
 ;
"RTN","ORQQPXRM",82,0)
MHV(ORY,DFN,NAME,ANS) ;
"RTN","ORQQPXRM",83,0)
 N ORDATA,ORES,X
"RTN","ORQQPXRM",84,0)
 S ORY(0)=0
"RTN","ORQQPXRM",85,0)
 I '$$PATCH^XPDUTL("YS*5.01*85") S ORY(0)=2 Q
"RTN","ORQQPXRM",86,0)
 I '$L(ANS) Q
"RTN","ORQQPXRM",87,0)
 S ORES("DFN")=DFN,ORES("CODE")=NAME
"RTN","ORQQPXRM",88,0)
 F X=1:1:$L(ANS) I $E(ANS,X)'="X" D
"RTN","ORQQPXRM",89,0)
 .;I $E(ANS,X)="T" S $E(ANS,X)=1
"RTN","ORQQPXRM",90,0)
 .;I $E(ANS,X)="F" S $E(ANS,X)=2
"RTN","ORQQPXRM",91,0)
 .S ORES(X)=X_U_$E(ANS,X)
"RTN","ORQQPXRM",92,0)
 D CHECKCR^YTQPXRM4(.ORDATA,.ORES)
"RTN","ORQQPXRM",93,0)
 I $G(ORDATA(2))="OK" S ORY(0)=1 Q
"RTN","ORQQPXRM",94,0)
 S ORY(1)=$P($G(ORDATA(2)),U,2)
"RTN","ORQQPXRM",95,0)
 Q
"RTN","ORQQPXRM",96,0)
 ;
"RTN","ORQQPXRM",97,0)
 ;ORQQPXRM MST UPDATE
"RTN","ORQQPXRM",98,0)
MST(ORY,ORPT,ORDATE,ORSTAT,ORPROV,ORFTYP,ORFIEN,ORRES) ;
"RTN","ORQQPXRM",99,0)
 D MST^PXRMRPCC(.ORY,ORPT,ORDATE,ORSTAT,ORPROV,ORFTYP,ORFIEN,ORRES) Q
"RTN","ORQQPXRM",100,0)
 ;
"RTN","ORQQPXRM",101,0)
 ;ORQQPXRM WOMEN HEALTH RESULT
"RTN","ORQQPXRM",102,0)
WH(ORY,ORRESULT) ;
"RTN","ORQQPXRM",103,0)
 D WH^PXRMRPCC(.ORY,.ORRESULT) Q
"RTN","ORQQPXRM",104,0)
 ;
"RTN","ORQQPXRM",105,0)
WHLETTER(ORY,ORIEN) ;
"RTN","ORQQPXRM",106,0)
 D LETTER^WVRPCNO1(.ORY,ORIEN) Q
"RTN","ORQQPXRM",107,0)
 ;
"RTN","ORQQPXRM",108,0)
WHREPORT(ORY,ORIEN) ;
"RTN","ORQQPXRM",109,0)
 D RESULTS^WVALERTF(.ORY,ORIEN) Q
"RTN","ORQQPXRM",110,0)
 ;
"RTN","ORQQPXRM",111,0)
 ;ORQQPXRM DIALOG PROMPTS
"RTN","ORQQPXRM",112,0)
PROMPT(ORY,ORDLG,ORDCUR,ORFTYP) ;
"RTN","ORQQPXRM",113,0)
 D PROMPT^PXRMRPCC(.ORY,ORDLG,ORDCUR,ORFTYP) Q  ; DBIA 3080
"RTN","ORQQPXRM",114,0)
 ;
"RTN","ORQQPXRM",115,0)
 ;ORQQPXRM REMINDER DETAIL
"RTN","ORQQPXRM",116,0)
REMDET(ORY,ORPT,ORIEN) D REMDET^PXRMRPCA(.ORY,ORPT,ORIEN) Q  ; DBIA 3078
"RTN","ORQQPXRM",117,0)
 ;
"RTN","ORQQPXRM",118,0)
 ;ORQQPXRM REMINDER INQUIRY
"RTN","ORQQPXRM",119,0)
RES(ORY,ORREM) D RES^PXRMRPCC(.ORY,ORREM) Q  ; DBIA 3080
"RTN","ORQQPXRM",120,0)
 ;
"RTN","ORQQPXRM",121,0)
 ;ORQQPXRM REMINDER WEB
"RTN","ORQQPXRM",122,0)
WEB(ORY,ORREM) D WEB^PXRMRPCA(.ORY,ORREM) Q  ; DBIA 3078
"RTN","ORQQPXRM",123,0)
 ;
"RTN","ORQQPXRM",124,0)
 ;PXRM REMINDER DIALOG (TIU)
"RTN","ORQQPXRM",125,0)
TDIALOG(ORY,ORDLG,DFN) ;
"RTN","ORQQPXRM",126,0)
 D DIALOG^PXRMRPCD(.ORY,ORDLG,DFN)
"RTN","ORQQPXRM",127,0)
 I $P($G(ORY(1)),U)=-1 Q
"RTN","ORQQPXRM",128,0)
 S ORY(0)=0_U_+$P($G(^PXRMD(801.41,ORDLG,0)),U,17)
"RTN","ORQQPXRM",129,0)
 Q
"RTN","ORQQPXRM",130,0)
 ;
"RTN","ORQQPXRM",131,0)
ACT(REM) ;ORQQPX SEARCH ITEMS - XPAR value screen for active reminders
"RTN","ORQQPXRM",132,0)
 ;Treat a null value as inactive
"RTN","ORQQPXRM",133,0)
 I 'REM Q 0
"RTN","ORQQPXRM",134,0)
 ;Treat a non-existen entry as inactive
"RTN","ORQQPXRM",135,0)
 I $G(^PXD(811.9,REM,0))="" Q 0
"RTN","ORQQPXRM",136,0)
 ;Check IF inactive flag is set
"RTN","ORQQPXRM",137,0)
 I ($T(INACTIVE^PXRM)'=""),$$INACTIVE^PXRM(REM) Q 0 ; DBIA 2182
"RTN","ORQQPXRM",138,0)
 ;Otherwise active
"RTN","ORQQPXRM",139,0)
 Q 1
"RTN","ORQQPXRM",140,0)
 ;
"RTN","ORQQPXRM",141,0)
REMVER(ORLIST) ;
"RTN","ORQQPXRM",142,0)
 S ORLIST=$$VERSION^XPDUTL("PXRM")
"RTN","ORQQPXRM",143,0)
 Q
"RTN","ORQQPXRM",144,0)
 ;
"RTN","ORQQPXRM",145,0)
GEC(ORRESULT,IEN,DFN,VISIT,NOTEIEN) ;
"RTN","ORQQPXRM",146,0)
 D API^PXRMGECU(.ORRESULT,IEN,DFN,VISIT,1,NOTEIEN)
"RTN","ORQQPXRM",147,0)
 Q
"RTN","ORQQPXRM",148,0)
 ;
"RTN","ORQQPXRM",149,0)
GECF(RESULT,DFN,FIN) ;
"RTN","ORQQPXRM",150,0)
 D FINISHED^PXRMGECU(DFN,FIN)
"RTN","ORQQPXRM",151,0)
 Q
"RTN","ORQQPXRM",152,0)
 ;
"RTN","ORQQPXRM",153,0)
GECP(RESULT,DFN) ;
"RTN","ORQQPXRM",154,0)
 S RESULT=$$STATUS^PXRMGECU(DFN)
"RTN","ORQQPXRM",155,0)
 Q
"RTN","ORQQPXRM",156,0)
 ;
"RTN","ORSRCHOR")
0^102^B77451785
"RTN","ORSRCHOR",1,0)
ORSRCHOR ;SLC/TC - Search Utility for Order Check Override Reason Report; 11/15/06 1:45pm
"RTN","ORSRCHOR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORSRCHOR",3,0)
 ;
"RTN","ORSRCHOR",4,0)
 ;
"RTN","ORSRCHOR",5,0)
ASKUSER(ANS,DIR,ORQUIT) ; Controls prompting of the report utility.
"RTN","ORSRCHOR",6,0)
 ;
"RTN","ORSRCHOR",7,0)
 I $G(ANS("EXIT"))="YES" Q
"RTN","ORSRCHOR",8,0)
 S ANS("EXIT")="NO"
"RTN","ORSRCHOR",9,0)
 N DIRUT,POP,X,Y
"RTN","ORSRCHOR",10,0)
 S DIR(0)="S^1:DATE/TIME ORDERED & OVERRIDDEN BY;2:DATE/TIME ORDERED & ORDER CHECK;3:DATE/TIME ORDERED & DIVISION;4:DATE/TIME ORDERED & DISPLAY GROUP;5:DATE/TIME ORDERED, DIVISION, & DISPLAY GROUP",DIR("A")=DIR,DIR("B")="1"
"RTN","ORSRCHOR",11,0)
 D ^DIR I $D(DIRUT) S ANS("EXIT")="YES" Q
"RTN","ORSRCHOR",12,0)
 N ORRSPNSE S ORRSPNSE=Y K DIR
"RTN","ORSRCHOR",13,0)
 N %DT,CNT,Y,DUOUT,DTOUT
"RTN","ORSRCHOR",14,0)
 S %DT="AE" F CNT=1:1:2 D
"RTN","ORSRCHOR",15,0)
 . S %DT("A")=$S(CNT=1:"SEARCH Orders Beginning: ",CNT=2:$J("Thru: ",25)),%DT("B")=$S(CNT=1:"",CNT=2:$P($$HTE^XLFDT($H),"@"))
"RTN","ORSRCHOR",16,0)
 . D ^%DT I Y=-1 S CNT=2 Q
"RTN","ORSRCHOR",17,0)
 . E  D
"RTN","ORSRCHOR",18,0)
 . . I CNT=1 S TMP("STRDT")=$P(Y,".")
"RTN","ORSRCHOR",19,0)
 . . I CNT=2 S TMP("ENDDT")=$P(Y,".")_".24"
"RTN","ORSRCHOR",20,0)
 I '$D(TMP("STRDT"))!'$D(TMP("ENDDT"))!$D(DTOUT)!$D(DUOUT) S ANS("EXIT")="YES" Q
"RTN","ORSRCHOR",21,0)
 I ORRSPNSE=1 D  ; filter search by OVERRIDDEN BY field
"RTN","ORSRCHOR",22,0)
 . N DIC,Y,DTOUT,DUOUT S DIC="^VA(200,",DIC(0)="QEAMZ",DIC("A")="SEARCH Order Chks Overridden By: " D ^DIC I (Y=-1)!$D(DTOUT)!$D(DUOUT) S ANS("EXIT")="YES" Q
"RTN","ORSRCHOR",23,0)
 . S ANS("SORT")="OVRDNBY",TMP("OVRBYIEN")=+Y,TMP("OVRBY")=Y(0,0)
"RTN","ORSRCHOR",24,0)
 I ORRSPNSE=2 D  ; filter search by ORDER CHK
"RTN","ORSRCHOR",25,0)
 . N DIC,Y,DTOUT,DUOUT S DIC="^ORD(100.8,",DIC(0)="QEAMZ" D ^DIC I (Y=-1)!$D(DTOUT)!$D(DUOUT) S ANS("EXIT")="YES" Q
"RTN","ORSRCHOR",26,0)
 . S ANS("SORT")="ORCHK",TMP("ORCHKIEN")=+Y,TMP("ORCHK")=Y(0,0)
"RTN","ORSRCHOR",27,0)
 I ORRSPNSE=3 D  ; filter search by DIUISION
"RTN","ORSRCHOR",28,0)
 . N DIC,Y,DTOUT,DUOUT S DIC="^DG(40.8,",DIC(0)="QEAMZ" D ^DIC I (Y=-1)!$D(DTOUT)!$D(DUOUT) S ANS("EXIT")="YES" Q
"RTN","ORSRCHOR",29,0)
 . S ANS("SORT")="DIV",TMP("ORDIVIEN")=+Y,TMP("ORDIV")=Y(0,0)
"RTN","ORSRCHOR",30,0)
 I ORRSPNSE=4 D  ; filter search by DISPLAY GROUP
"RTN","ORSRCHOR",31,0)
 . N DIC,Y,DTOUT,DUOUT S DIC="^ORD(100.98,",DIC(0)="QEAMZ" D ^DIC I (Y=-1)!$D(DTOUT)!$D(DUOUT) S ANS("EXIT")="YES" Q
"RTN","ORSRCHOR",32,0)
 . S ANS("SORT")="DSPGRP",TMP("ORDGPIEN")=+Y,TMP("ORDSPGRP")=Y(0,0)
"RTN","ORSRCHOR",33,0)
 I ORRSPNSE=5 D  ; filter search by DIVISION & DISPLAY GROUP
"RTN","ORSRCHOR",34,0)
 . N DIC,CNT,Y,DTOUT,DUOUT S DIC(0)="QEAMZ",ANS("SORT")="DTORD"
"RTN","ORSRCHOR",35,0)
 . F CNT=1:1:2 D
"RTN","ORSRCHOR",36,0)
 . . S DIC=$S(CNT=1:"^DG(40.8,",CNT=2:"^ORD(100.98,")
"RTN","ORSRCHOR",37,0)
 . . D ^DIC I Y=-1 S CNT=2 Q
"RTN","ORSRCHOR",38,0)
 . . E  D
"RTN","ORSRCHOR",39,0)
 . . . I CNT=1 S TMP("ORDIVIEN")=+Y,TMP("ORDIV")=Y(0,0)
"RTN","ORSRCHOR",40,0)
 . . . I CNT=2 S TMP("ORDGPIEN")=+Y,TMP("ORDSPGRP")=Y(0,0)
"RTN","ORSRCHOR",41,0)
 . I '$D(TMP("ORDIVIEN"))!'$D(TMP("ORDGPIEN"))!$D(DTOUT)!$D(DUOUT) S ANS("EXIT")="YES" Q
"RTN","ORSRCHOR",42,0)
 I ANS("EXIT")="NO" D
"RTN","ORSRCHOR",43,0)
 . N DIR,DIRUT,POP,X,Y S DIR(0)="Y",DIR("A")="Print delimited output only",DIR("B")="NO"
"RTN","ORSRCHOR",44,0)
 . S DIR("?",1)="Entering 'YES' will allow the user to specify a delimiter character",DIR("?",2)="and create a delimited report.",DIR("?",3)=""
"RTN","ORSRCHOR",45,0)
 . S DIR("?")="Entering 'NO' will create a regular summary report."
"RTN","ORSRCHOR",46,0)
 . D ^DIR I $D(DIRUT) S ANS("EXIT")="YES" Q
"RTN","ORSRCHOR",47,0)
 . S ANS("DELIMIT")=Y(0) I ANS("DELIMIT")="YES" D
"RTN","ORSRCHOR",48,0)
 . . N DIR,DIRUT,X,Y S DIR("A")="Specify REPORT DELIMITER CHARACTER",DIR("B")="U"
"RTN","ORSRCHOR",49,0)
 . . S DIR(0)="S^P:Pipe;T:Tilde;U:Up arrow"
"RTN","ORSRCHOR",50,0)
 . . D ^DIR I $D(DIRUT) S ANS("EXIT")="YES" Q
"RTN","ORSRCHOR",51,0)
 . . S ANS("DELIMITER")=Y K DIR
"RTN","ORSRCHOR",52,0)
 . W !,"Searching....." D SRCHBYDT(TMP("STRDT"),TMP("ENDDT"))
"RTN","ORSRCHOR",53,0)
 Q
"RTN","ORSRCHOR",54,0)
 ;
"RTN","ORSRCHOR",55,0)
SRCHBYDT(STRDT,ENDDT) ; Search by Date/Time Ordered and sort by Date/Time Ordered, Division, Display Group, or Order Chk.
"RTN","ORSRCHOR",56,0)
 ; 
"RTN","ORSRCHOR",57,0)
 N AFGLB,ORDNO
"RTN","ORSRCHOR",58,0)
 K ^TMP("OROVRRPT",$J) ; Ensures a fresh start
"RTN","ORSRCHOR",59,0)
 S AFGLB=$NA(^OR(100,"AF")),TMP=$NA(^TMP("OROVRRPT",$J))
"RTN","ORSRCHOR",60,0)
 S (ORDNO,ORDACT)=0
"RTN","ORSRCHOR",61,0)
 I (ANS("SORT")="OVRDNBY") S (TMP("ORCHKIEN"),TMP("ORDIVIEN"),TMP("ORDGPIEN"))=""
"RTN","ORSRCHOR",62,0)
 I (ANS("SORT")="ORCHK") S (TMP("OVRBYIEN"),TMP("ORDIVIEN"),TMP("ORDGPIEN"))=""
"RTN","ORSRCHOR",63,0)
 I (ANS("SORT")="DIV") S (TMP("ORCHKIEN"),TMP("OVRBYIEN"),TMP("ORDGPIEN"))=""
"RTN","ORSRCHOR",64,0)
 I (ANS("SORT")="DSPGRP") S (TMP("ORCHKIEN"),TMP("ORDIVIEN"),TMP("OVRBYIEN"))=""
"RTN","ORSRCHOR",65,0)
 I (ANS("SORT")="DTORD") S (TMP("ORCHKIEN"),TMP("OVRBYIEN"))=""
"RTN","ORSRCHOR",66,0)
 F  S STRDT=$O(@AFGLB@(STRDT)) Q:'+STRDT!(STRDT>ENDDT)  F  S ORDNO=$O(@AFGLB@(STRDT,ORDNO)) Q:'+ORDNO  F  S ORDACT=$O(@AFGLB@(STRDT,ORDNO,ORDACT)) Q:'+ORDACT  I (ORDACT=1)&($D(^OR(100,ORDNO,9)))&($L($P($G(^OR(100,ORDNO,9,1,0)),U,4))>0)  D
"RTN","ORSRCHOR",67,0)
 . N ORD0,ORD8,ORD9,ORD91,ORDCHK S ORD0=$G(^OR(100,ORDNO,0)),ORD8=$G(^OR(100,ORDNO,8,1,.1,1,0)),ORD9=$G(^OR(100,ORDNO,9,1,0)),ORD91=$G(^OR(100,ORDNO,9,1,1)),ORDCHK=$G(^ORD(100.8,$P(ORD9,U),0))_": "_ORD91
"RTN","ORSRCHOR",68,0)
 . N PTLOC,DIVIEN,DIVISN,ORDLG,DSPGRIEN,DSPGRP S PTLOC=$P(ORD0,U,10),ORDLG=$P(ORD0,U,5)
"RTN","ORSRCHOR",69,0)
 . I $D(PTLOC)&($P(PTLOC,";",2)="SC(")&($D(^SC(+PTLOC,0)))  S DIVIEN=$P($G(^SC(+PTLOC,0)),U,15),DIVISN=$P($G(^DG(40.8,DIVIEN,0)),U)  ;DBIA #10040
"RTN","ORSRCHOR",70,0)
 . E  S DIVISN="NONE SPECIFIED"
"RTN","ORSRCHOR",71,0)
 . I $D(ORDLG)&($P(ORDLG,";",2)="ORD(101.41,")&($D(^ORD(101.41,+ORDLG,0)))  S DSPGRIEN=$P($G(^ORD(101.41,+ORDLG,0)),U,5),DSPGRP=$P($G(^ORD(100.98,DSPGRIEN,0)),U)
"RTN","ORSRCHOR",72,0)
 . E  S DSPGRP="NONE SPECIFIED"
"RTN","ORSRCHOR",73,0)
 . N ORDCHK1,ORDCHK2 I $L(ORDCHK)>255 S ORDCHK1=$E(ORDCHK,1,255),ORDCHK2=$E(ORDCHK,256,$L(ORDCHK))
"RTN","ORSRCHOR",74,0)
 . I (ANS("SORT")="OVRDNBY")&($P(ORD9,U,5)=TMP("OVRBYIEN"))  D
"RTN","ORSRCHOR",75,0)
 . . I $L(ORDCHK)>255 S @TMP@(STRDT,DIVISN,DSPGRP,ORDCHK1,ORDNO)=ORD8_U_$P(ORD9,U,4)_U_TMP("OVRBY")_U_$P(ORD9,U,6)_U_ORDCHK2
"RTN","ORSRCHOR",76,0)
 . . E  S @TMP@(STRDT,DIVISN,DSPGRP,ORDCHK,ORDNO)=ORD8_U_$P(ORD9,U,4)_U_TMP("OVRBY")_U_$P(ORD9,U,6)
"RTN","ORSRCHOR",77,0)
 . I (ANS("SORT")="ORCHK")&($P(ORD9,U)=TMP("ORCHKIEN"))  D
"RTN","ORSRCHOR",78,0)
 . . N ORCHCK1,ORCHCK2 I $L(ORD91)>255 D
"RTN","ORSRCHOR",79,0)
 . . . S ORCHCK1=$E(ORD91,1,255),ORCHCK2=$E(ORD91,256,$L(ORD91)),@TMP@(ORCHCK1,DIVISN,DSPGRP,STRDT,ORDNO)=ORD8_U_$P(ORD9,U,4)_U_$P(ORD9,U,5)_U_$P(ORD9,U,6)_U_ORCHCK2
"RTN","ORSRCHOR",80,0)
 . . E  S @TMP@(ORD91,DIVISN,DSPGRP,STRDT,ORDNO)=ORD8_U_$P(ORD9,U,4)_U_$P(ORD9,U,5)_U_$P(ORD9,U,6)
"RTN","ORSRCHOR",81,0)
 . I (ANS("SORT")="DIV")&($P($G(^SC(+$P($G(^OR(100,ORDNO,0)),U,10),0)),U,15)=TMP("ORDIVIEN"))  D 
"RTN","ORSRCHOR",82,0)
 . . I $L(ORDCHK)>255 S @TMP@(TMP("ORDIV"),DSPGRP,ORDCHK1,STRDT,ORDNO)=ORD8_U_$P(ORD9,U,4)_U_$P(ORD9,U,5)_U_$P(ORD9,U,6)_U_ORDCHK2
"RTN","ORSRCHOR",83,0)
 . . E  S @TMP@(TMP("ORDIV"),DSPGRP,ORDCHK,STRDT,ORDNO)=ORD8_U_$P(ORD9,U,4)_U_$P(ORD9,U,5)_U_$P(ORD9,U,6)
"RTN","ORSRCHOR",84,0)
 . I (ANS("SORT")="DSPGRP")&($P($G(^ORD(101.41,+$P($G(^OR(100,ORDNO,0)),U,5),0)),U,5)=TMP("ORDGPIEN"))  D
"RTN","ORSRCHOR",85,0)
 . . I $L(ORDCHK)>255 S @TMP@(TMP("ORDSPGRP"),DIVISN,ORDCHK1,STRDT,ORDNO)=ORD8_U_$P(ORD9,U,4)_U_$P(ORD9,U,5)_U_$P(ORD9,U,6)_U_ORDCHK2
"RTN","ORSRCHOR",86,0)
 . . E  S @TMP@(TMP("ORDSPGRP"),DIVISN,ORDCHK,STRDT,ORDNO)=ORD8_U_$P(ORD9,U,4)_U_$P(ORD9,U,5)_U_$P(ORD9,U,6)
"RTN","ORSRCHOR",87,0)
 . I (ANS("SORT")="DTORD")&($P($G(^SC(+$P($G(^OR(100,ORDNO,0)),U,10),0)),U,15)=TMP("ORDIVIEN"))&($P($G(^ORD(101.41,+$P($G(^OR(100,ORDNO,0)),U,5),0)),U,5)=TMP("ORDGPIEN"))  D 
"RTN","ORSRCHOR",88,0)
 . . I $L(ORDCHK)>255 S @TMP@(STRDT,TMP("ORDIV"),TMP("ORDSPGRP"),ORDCHK1,ORDNO)=ORD8_U_$P(ORD9,U,4)_U_$P(ORD9,U,5)_U_$P(ORD9,U,6)_U_ORDCHK2
"RTN","ORSRCHOR",89,0)
 . . E  S @TMP@(STRDT,TMP("ORDIV"),TMP("ORDSPGRP"),ORDCHK,ORDNO)=ORD8_U_$P(ORD9,U,4)_U_$P(ORD9,U,5)_U_$P(ORD9,U,6)
"RTN","ORSRCHOR",90,0)
 Q
"RTN","ORSRCHOR",91,0)
 ;
"RTN","ORSRCHOR",92,0)
HEADER ; Prints out the report header
"RTN","ORSRCHOR",93,0)
 ;
"RTN","ORSRCHOR",94,0)
 N SORT,SRTORD,TITLE,PERTTL,TTLIEN S TITLE="Order Check Override Reason Report",SORT="Sorted in Ascending order by: "
"RTN","ORSRCHOR",95,0)
 I ANS("SORT")="OVRDNBY" S SRTORD="Date/Time Ordered, Division, Display Group, Order Chk, & Order#"
"RTN","ORSRCHOR",96,0)
 I ANS("SORT")="ORCHK" S SRTORD="Order Chk, Division, Display Group, Date/Time Ordered, & Order#"
"RTN","ORSRCHOR",97,0)
 I ANS("SORT")="DTORD" S SRTORD="Date/Time Ordered, Order Chk, & Order#"
"RTN","ORSRCHOR",98,0)
 I ANS("SORT")="DIV" S SRTORD="Display Group, Order Chk, Date/Time Ordered, & Order#"
"RTN","ORSRCHOR",99,0)
 I ANS("SORT")="DSPGRP" S SRTORD="Division, Order Chk, Date/Time Ordered, & Order#"
"RTN","ORSRCHOR",100,0)
 I $D(IO("SPOOL"))!($D(IO("HFSIO"))) S IOM=80
"RTN","ORSRCHOR",101,0)
 W @IOF,?(IOM-$L(TITLE))/2,TITLE,!?(IOM-$L(SORT))/2,SORT,!?(IOM-$L(SRTORD))/2,SRTORD
"RTN","ORSRCHOR",102,0)
 W !!!,"Current User:  ",$E($$GET1^DIQ(200,+$G(DUZ),.01),1,26),?42,"Current Date:  ",$$HTE^XLFDT($H)
"RTN","ORSRCHOR",103,0)
 W !,"Date Range Searched:  ",$$FMTE^XLFDT(TMP("STRDT"),"1D")," - ",$$FMTE^XLFDT(TMP("ENDDT"),"1D"),?54,"WHERE"
"RTN","ORSRCHOR",104,0)
 I ANS("SORT")="OVRDNBY" D
"RTN","ORSRCHOR",105,0)
 . S TTLIEN=$P($G(^VA(200,TMP("OVRBYIEN"),0)),U,9) I TTLIEN="" S PERTTL="NONE SPECIFIED"
"RTN","ORSRCHOR",106,0)
 . E  S PERTTL=$P($G(^DIC(3.1,TTLIEN,0)),U) I PERTTL="" S PERTTL="NONE SPECIFIED"
"RTN","ORSRCHOR",107,0)
 . W !,"Order Chks are Overridden By:  ",TMP("OVRBY"),!,"Title:  ",PERTTL,!!
"RTN","ORSRCHOR",108,0)
 I ANS("SORT")="ORCHK" W !,"Order Check:  ",TMP("ORCHK"),!!
"RTN","ORSRCHOR",109,0)
 I ANS("SORT")="DIV" W !,"Division:  ",TMP("ORDIV"),!!
"RTN","ORSRCHOR",110,0)
 I ANS("SORT")="DSPGRP" W !,"Display Group:  ",TMP("ORDSPGRP"),!!
"RTN","ORSRCHOR",111,0)
 I ANS("SORT")="DTORD" W !,"Division:  ",TMP("ORDIV"),!,"Display Group:  ",TMP("ORDSPGRP"),!!
"RTN","ORSRCHOR",112,0)
 I ANS("DELIMIT")="YES"&($D(^TMP("OROVRRPT",$J))) D
"RTN","ORSRCHOR",113,0)
 . S TMP("DLMTR")=$S(ANS("DELIMITER")="P":"|",ANS("DELIMITER")="T":"~",ANS("DELIMITER")="U":"^")
"RTN","ORSRCHOR",114,0)
 . I ANS("SORT")="OVRDNBY" W "RECNO"_TMP("DLMTR")_"Date/Time Ordered"_TMP("DLMTR")_"Division"_TMP("DLMTR")_"Display Group"_TMP("DLMTR")_"Order#"_TMP("DLMTR")_"D/T Overridden"
"RTN","ORSRCHOR",115,0)
 . I ANS("SORT")="ORCHK" W "RECNO"_TMP("DLMTR")_"Date/Time Ordered"_TMP("DLMTR")_"Division"_TMP("DLMTR")_"Display Group"_TMP("DLMTR")_"Order#"_TMP("DLMTR")_"Overridden by"_TMP("DLMTR")_"D/T Overridden"
"RTN","ORSRCHOR",116,0)
 . I ANS("SORT")="DIV" W "RECNO"_TMP("DLMTR")_"Date/Time Ordered"_TMP("DLMTR")_"Display Group"_TMP("DLMTR")_"Order#"_TMP("DLMTR")_"Overridden by"_TMP("DLMTR")_"D/T Overridden"
"RTN","ORSRCHOR",117,0)
 . I ANS("SORT")="DSPGRP" W "RECNO"_TMP("DLMTR")_"Date/Time Ordered"_TMP("DLMTR")_"Division"_TMP("DLMTR")_"Order#"_TMP("DLMTR")_"Overridden by"_TMP("DLMTR")_"D/T Overridden"
"RTN","ORSRCHOR",118,0)
 . I ANS("SORT")="DTORD" W "RECNO"_TMP("DLMTR")_"Date/Time Ordered"_TMP("DLMTR")_"Order#"_TMP("DLMTR")_"Overridden by"_TMP("DLMTR")_"D/T Overridden"
"RTN","ORSRCHOR",119,0)
COLHDR I ANS("DELIMIT")="NO" D
"RTN","ORSRCHOR",120,0)
 . I ANS("SORT")="OVRDNBY"!(ANS("SORT")="ORCHK") W "Date/Time Ordered",?21,"Division",?40,"Display Group",?70,"Order#",!,"-----------------",?21,"--------",?40,"-------------",?70,"------"
"RTN","ORSRCHOR",121,0)
 . I ANS("SORT")="DIV" W "Date/Time Ordered",?25,"Display Group",?60,"Order#",!,"-----------------",?25,"-------------",?60,"------"
"RTN","ORSRCHOR",122,0)
 . I ANS("SORT")="DSPGRP" W "Date/Time Ordered",?25,"Division",?60,"Order#",!,"-----------------",?25,"--------",?60,"------"
"RTN","ORSRCHOR",123,0)
 . I ANS("SORT")="DTORD" W "Date/Time Ordered",?45,"Order#",!,"-----------------",?45,"------"
"RTN","ORSRCHOR",124,0)
 Q
"RTN","ORSRCHOR",125,0)
 ;
"RTN","ORTSKLPS")
0^96^B5805034
"RTN","ORTSKLPS",1,0)
ORTSKLPS ;SLC/JMH-nightly task to lapse old unsigned orders ; 4/9/08 10:00am
"RTN","ORTSKLPS",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORTSKLPS",3,0)
 ;
"RTN","ORTSKLPS",4,0)
TASK ;
"RTN","ORTSKLPS",5,0)
 ;only run between Midnight and 1:59:59 AM
"RTN","ORTSKLPS",6,0)
 I $E($P($$NOW^XLFDT,".",2),1,2)>1 Q
"RTN","ORTSKLPS",7,0)
 ;don't run if run recently (within 4 hours)
"RTN","ORTSKLPS",8,0)
 ;I $$FMDIFF^XLFDT($$NOW^XLFDT,$G(^XTMP("OR LAPSE ORDERS","LAST TIME")),2)<14400 Q
"RTN","ORTSKLPS",9,0)
 ;set timestamp of last run
"RTN","ORTSKLPS",10,0)
 S ^XTMP("OR LAPSE ORDERS",0)=$$FMADD^XLFDT($$NOW^XLFDT,2)_U_$$NOW^XLFDT
"RTN","ORTSKLPS",11,0)
 S ^XTMP("OR LAPSE ORDERS","LAST TIME")=$$NOW^XLFDT
"RTN","ORTSKLPS",12,0)
 ;loop through unsigned orders
"RTN","ORTSKLPS",13,0)
 N ORVP,ORDT,ORN,ORACT,ORINVDT,ORPARAM,ORDIAL,ORDISP
"RTN","ORTSKLPS",14,0)
 S ORVP="" F  S ORVP=$O(^OR(100,"AS",ORVP)) Q:'$L(ORVP)  D
"RTN","ORTSKLPS",15,0)
 .S ORINVDT=0 F  S ORINVDT=$O(^OR(100,"AS",ORVP,ORINVDT)) Q:'ORINVDT  D
"RTN","ORTSKLPS",16,0)
 ..S ORDT=9999999-ORINVDT
"RTN","ORTSKLPS",17,0)
 ..S ORN=0 F  S ORN=$O(^OR(100,"AS",ORVP,ORINVDT,ORN)) Q:'ORN  D
"RTN","ORTSKLPS",18,0)
 ...;don't lapse if order does not have a status of unreleased (11)
"RTN","ORTSKLPS",19,0)
 ...Q:$P($G(^OR(100,ORN,3)),U,3)'=11
"RTN","ORTSKLPS",20,0)
 ...;get order action
"RTN","ORTSKLPS",21,0)
 ...S ORACT=$O(^OR(100,"AS",ORVP,ORINVDT,ORN,""))
"RTN","ORTSKLPS",22,0)
 ...;get order dialog
"RTN","ORTSKLPS",23,0)
 ...S ORDIAL=$P($G(^OR(100,ORN,0)),U,5)
"RTN","ORTSKLPS",24,0)
 ...I $P(ORDIAL,";",2)='"ORD(101.41," Q
"RTN","ORTSKLPS",25,0)
 ...;using order dialog get display group
"RTN","ORTSKLPS",26,0)
 ...S ORDISP=$P($G(^ORD(101.41,+ORDIAL,0)),U,5)
"RTN","ORTSKLPS",27,0)
 ...I +ORDISP S ORDISP=$P($G(^ORD(100.98,+ORDISP,0)),U)
"RTN","ORTSKLPS",28,0)
 ...;get lapse parameter for display group
"RTN","ORTSKLPS",29,0)
 ...I $L(ORDISP) S ORPARAM=$$GET^XPAR("ALL","OR LAPSE ORDERS",ORDISP)
"RTN","ORTSKLPS",30,0)
 ...;get default lapse parameter if one for display group not set
"RTN","ORTSKLPS",31,0)
 ...I '$G(ORPARAM) S ORPARAM=$$GET^XPAR("ALL","OR LAPSE ORDERS DFLT")
"RTN","ORTSKLPS",32,0)
 ...;quit if ORPARAM isn't even set
"RTN","ORTSKLPS",33,0)
 ...Q:'$L(ORPARAM)
"RTN","ORTSKLPS",34,0)
 ...;quit if order is not older than T-(days for lapse)
"RTN","ORTSKLPS",35,0)
 ...I $$FMDIFF^XLFDT($$NOW^XLFDT,ORDT,1)<ORPARAM Q
"RTN","ORTSKLPS",36,0)
 ...;if old then lapse
"RTN","ORTSKLPS",37,0)
 ...D LAPSE^ORCSAVE2(ORN_";"_ORACT)
"RTN","ORTSKLPS",38,0)
 ;loop through pending events
"RTN","ORTSKLPS",39,0)
 N ORPT,OREVT,ORPTR,Y
"RTN","ORTSKLPS",40,0)
 S ORPT="" F  S ORPT=$O(^ORE(100.2,"AE",ORPT)) Q:'ORPT  D
"RTN","ORTSKLPS",41,0)
 .S OREVT="" F  S OREVT=$O(^ORE(100.2,"AE",ORPT,OREVT)) Q:'OREVT  D
"RTN","ORTSKLPS",42,0)
 ..S ORPTR="" F  S ORPTR=$O(^ORE(100.2,"AE",ORPT,OREVT,ORPTR)) Q:'ORPTR  S Y=$$LAPSED^OREVNTX(ORPTR)
"RTN","ORTSKLPS",43,0)
 Q
"RTN","ORUDPA")
0^162^B4870592
"RTN","ORUDPA",1,0)
ORUDPA ; slc/dcm,RWF - Object (patient) lookup ;10/7/91  15:21 ; 3/7/08 5:22am
"RTN","ORUDPA",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**16,243**;Dec 17, 1997;Build 242
"RTN","ORUDPA",3,0)
ENT ;
"RTN","ORUDPA",4,0)
 ;Entry: none  Exit: DFN,ORACTION,ORAGE,ORDOB,ORL,ORNP,ORPD,ORPNM,ORPV,ORSEX,ORSSN,ORTS,ORVP,ORWARD,VADPT("V"),VAERR
"RTN","ORUDPA",5,0)
 D PATIENT^ORU1(.Y)
"RTN","ORUDPA",6,0)
 Q
"RTN","ORUDPA",7,0)
EN2 ;
"RTN","ORUDPA",8,0)
 S (ORVP,X)="",DIC(0)="EMQZI",DIC=2
"RTN","ORUDPA",9,0)
 R !,"Select PATIENT NAME: ",X:DTIME
"RTN","ORUDPA",10,0)
 I X=""!(X["^") S Y=-1 G END1
"RTN","ORUDPA",11,0)
 S:'$D(DIC(0)) DIC(0)="EMQZI"
"RTN","ORUDPA",12,0)
 S DIC="^DPT(" D ^DIC I $E(X)="^" S:X="^^" DIROUT=1 G END1
"RTN","ORUDPA",13,0)
 I Y>0 S ORVP=+Y_";DPT(" Q:$D(ORUS)  G END1
"RTN","ORUDPA",14,0)
 Q
"RTN","ORUDPA",15,0)
END1 ;
"RTN","ORUDPA",16,0)
 I Y>0 S ^TMP("OR",$J,"PAT",1)=ORVP,^TMP("OR",$J,"PAT","B",ORVP,1)=""
"RTN","ORUDPA",17,0)
END ;from ORUHDR
"RTN","ORUDPA",18,0)
 Q:Y<0
"RTN","ORUDPA",19,0)
 I ORVP[";DPT(" D HOMO
"RTN","ORUDPA",20,0)
 K VA,VAROOT,VA200,VAIN,VAINDT,VAERR,VADM,DIC Q
"RTN","ORUDPA",21,0)
 ;
"RTN","ORUDPA",22,0)
GPD ;
"RTN","ORUDPA",23,0)
 N GMRVSTR
"RTN","ORUDPA",24,0)
 K ORPD
"RTN","ORUDPA",25,0)
 S (ORSEQ,ORPD)=0,DFN=+ORVP
"RTN","ORUDPA",26,0)
 I $D(^GMRD(120.51)) S X="GMRVUTL",GMRVSTR="WT" X ^%ZOSF("TEST") I $T D EN6^GMRVUTL S ORPD=+$P(X,U,8)\1
"RTN","ORUDPA",27,0)
 S:ORPD'>0 ORPD="NF"
"RTN","ORUDPA",28,0)
 K ORSEQ
"RTN","ORUDPA",29,0)
 Q
"RTN","ORUDPA",30,0)
HOMO ;
"RTN","ORUDPA",31,0)
 N XQORFLG,ORCNV
"RTN","ORUDPA",32,0)
 S DFN=+Y,VA200=1 K VAINDT
"RTN","ORUDPA",33,0)
 D OERR^VADPT,GPD
"RTN","ORUDPA",34,0)
 S ORPNM=VADM(1),ORSSN=VA("PID"),ORDOB=$P(VADM(3),"^",2),ORAGE=VADM(4),ORSEX=$P(VADM(5),"^"),ORTS=+VAIN(3),ORTS=$S(ORTS:ORTS,1:""),(ORATTEND,ORNP)=+VAIN(2),ORWARD=VAIN(4),ORL(1)=VAIN(5),(ORPV,ORL,ORL(0),ORL(2))=""
"RTN","ORUDPA",35,0)
 I +$P(ORWARD,"^") S X=+ORWARD I $D(^DIC(42,+X,44)) S X=$P(^(44),"^") I X,$D(^SC(X,0)) S ORL=X_";SC(",ORL(0)=$S($L($P(^(0),"^",2)):$P(^(0),"^",2),1:$E($P(^(0),"^"),1,4)),ORL(2)=ORL
"RTN","ORUDPA",36,0)
 Q
"RTN","ORUTL1")
0^179^B5293035
"RTN","ORUTL1",1,0)
ORUTL1 ; slc/dcm - OE/RR Utilities ;5/30/07  13:46
"RTN","ORUTL1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**11,66,243**;Dec 17, 1997;Build 242
"RTN","ORUTL1",3,0)
LOC ;Hospital Location Look-up
"RTN","ORUTL1",4,0)
 N DIC,ORIA,ORRA
"RTN","ORUTL1",5,0)
 S DIC=44,DIC(0)="AEQM",DIC("S")="I '$P($G(^(""OOS"")),""^"")"
"RTN","ORUTL1",6,0)
 D ^DIC
"RTN","ORUTL1",7,0)
 I Y<1 Q
"RTN","ORUTL1",8,0)
 I $D(^SC(+Y,"I")) S ORIA=+^("I"),ORRA=$P(^("I"),U,2)
"RTN","ORUTL1",9,0)
 I $S('$D(ORIA):0,'ORIA:0,ORIA>DT:0,ORRA'>DT&(ORRA):0,1:1) W $C(7),!,"  This location has been inactivated.",! K ORL G LOC
"RTN","ORUTL1",10,0)
 Q
"RTN","ORUTL1",11,0)
QUE(ZTRTN,ZTDESC,ZTSAVE,ORIOPTR,ZTDTH,%ZIS,QUE,ECHO,ORION) ;Device Handling
"RTN","ORUTL1",12,0)
IO ;This entry point replaced by QUE, but left for backwards compatibility
"RTN","ORUTL1",13,0)
 Q:'$D(ZTRTN)
"RTN","ORUTL1",14,0)
 N IO,ION,IOP,IOPAR,IOT,ZTSK,ZTIO,POP
"RTN","ORUTL1",15,0)
 I $G(QUE),'$L($G(ORIOPTR)) Q
"RTN","ORUTL1",16,0)
 I $L($G(ORIOPTR)),$G(QUE),$D(ORION) S ZTIO=ORION G IOQ
"RTN","ORUTL1",17,0)
 S:'($D(%ZIS)#2) %ZIS="Q"
"RTN","ORUTL1",18,0)
 I $G(QUE) S:%ZIS'["Q" %ZIS=%ZIS_"Q" S %ZIS("S")="I $S($G(^%ZIS(2,+$G(^(""SUBTYPE"")),0))'[""C-"":1,1:0)",%ZIS("B")=""
"RTN","ORUTL1",19,0)
 I $L($G(ORIOPTR)) S IOP=ORIOPTR
"RTN","ORUTL1",20,0)
 D ^%ZIS
"RTN","ORUTL1",21,0)
 I POP S OREND=1 Q
"RTN","ORUTL1",22,0)
 S ZTIO=ION
"RTN","ORUTL1",23,0)
IOQ I $G(QUE)!$D(IO("Q")) D  Q
"RTN","ORUTL1",24,0)
 . S:'$D(ZTSAVE) ZTSAVE("O*")=""
"RTN","ORUTL1",25,0)
 . D ^%ZTLOAD
"RTN","ORUTL1",26,0)
 . I $D(ZTSK),'$D(ECHO) W !,"REQUEST QUEUED"
"RTN","ORUTL1",27,0)
 . I '$D(ZTSK) S OREND=1
"RTN","ORUTL1",28,0)
 . D ^%ZISC
"RTN","ORUTL1",29,0)
 D @ZTRTN
"RTN","ORUTL1",30,0)
 D ^%ZISC
"RTN","ORUTL1",31,0)
 Q
"RTN","ORUTL1",32,0)
 ;
"RTN","ORUTL1",33,0)
DPI(PATCH) ;Function returns date patch installed - added in patch 243
"RTN","ORUTL1",34,0)
 ;PATCH is set to patch designation, for example, "SR*3.0*157"
"RTN","ORUTL1",35,0)
 ;Output is the fileman date/time that patch was installed on this system
"RTN","ORUTL1",36,0)
 ;A return value of -1 is given if patch hasn't been installed
"RTN","ORUTL1",37,0)
 N ORVALUE,ORDAT,ORERR,VER,PKG,DATE,NUM
"RTN","ORUTL1",38,0)
 S DATE=-1
"RTN","ORUTL1",39,0)
 I '$$PATCH^XPDUTL(PATCH) Q DATE  ;If patch hasn't been installed yet quit
"RTN","ORUTL1",40,0)
 S ORVALUE=$P(PATCH,"*") ;Package
"RTN","ORUTL1",41,0)
 D FIND^DIC(9.4,,,"MO",.ORVALUE,,,,,"ORDAT","ORERR")
"RTN","ORUTL1",42,0)
 S PKG=$G(ORDAT("DILIST",2,1)) I 'PKG Q DATE
"RTN","ORUTL1",43,0)
 S ORVALUE=$P(PATCH,"*",2) ;Version
"RTN","ORUTL1",44,0)
 D FIND^DIC(9.49,(","_PKG_","),,"X",.ORVALUE,,,,,"ORDAT","ORERR")
"RTN","ORUTL1",45,0)
 S VER=$G(ORDAT("DILIST",2,1)) I 'VER Q DATE
"RTN","ORUTL1",46,0)
 S ORVALUE=$P(PATCH,"*",3) ;Patch number
"RTN","ORUTL1",47,0)
 D FIND^DIC(9.4901,(","_VER_","_PKG_","),,,.ORVALUE,,,,,"ORDAT","ORERR")
"RTN","ORUTL1",48,0)
 S NUM=$G(ORDAT("DILIST",2,1)) I 'NUM Q DATE
"RTN","ORUTL1",49,0)
 S DATE=$$GET1^DIQ(9.4901,(NUM_","_VER_","_PKG_","),.02,"I")
"RTN","ORUTL1",50,0)
 Q DATE
"RTN","ORWCIRN")
0^218^B9046507
"RTN","ORWCIRN",1,0)
ORWCIRN ; slc/dcm,REV - Functions for GUI CIRN ACTIONS ;22-NOV-1999 07:27:24
"RTN","ORWCIRN",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,101,109,132,141,160,208,239,215,243**;October 28, 1997;Build 242
"RTN","ORWCIRN",3,0)
 ;
"RTN","ORWCIRN",4,0)
FACLIST(ORY,ORDFN) ; Return list of remote facilities for patient
"RTN","ORWCIRN",5,0)
 ;Check to see if CIRN PD/MPI installed
"RTN","ORWCIRN",6,0)
 N X,ORSITES,I,IFN,LOCAL,CTR,HDRFLG
"RTN","ORWCIRN",7,0)
 S X="MPIF001" X ^%ZOSF("TEST")
"RTN","ORWCIRN",8,0)
 I '$T S ORY(0)="-1^CIRN MPI not installed." Q
"RTN","ORWCIRN",9,0)
 S X="VAFCTFU1" X ^%ZOSF("TEST")
"RTN","ORWCIRN",10,0)
 I '$T S ORY(0)="-1^Remote data view not installed." Q
"RTN","ORWCIRN",11,0)
 S X=$$GET^XPAR("ALL","ORWRP CIRN REMOTE DATA ALLOW",1,"I")
"RTN","ORWCIRN",12,0)
 I 'X S ORY(0)="-1^Remote access not allowed" Q
"RTN","ORWCIRN",13,0)
 D TFL^VAFCTFU1(.ORY,ORDFN)
"RTN","ORWCIRN",14,0)
 S I=0 F  S I=$O(ORY(I)) Q:'I  I $P(ORY(I),"^",5)="OTHER",'($P(ORY(I),"^")="200HD") K ORY(I) ;Screen out Type 'OTHER' locations
"RTN","ORWCIRN",15,0)
 S HDRFLG=0
"RTN","ORWCIRN",16,0)
 I $$GET^XPAR("ALL","ORWRP CIRN SITES ALL",1,"I") D
"RTN","ORWCIRN",17,0)
 . S (CTR,I)=0
"RTN","ORWCIRN",18,0)
 . F  S I=$O(ORY(I)) Q:'I  S $P(ORY(I),"^",5)=1,CTR=CTR+1 D
"RTN","ORWCIRN",19,0)
 .. I $P(ORY(I),"^")=200 S $P(ORY(I),"^",2)="DEPT. OF DEFENSE"
"RTN","ORWCIRN",20,0)
 .. I $P(ORY(I),"^")="200HD" D
"RTN","ORWCIRN",21,0)
 ... I +$$GET^XPAR("ALL","ORWRP HDR ON",1,"I")=0 K ORY(I) S CTR=CTR-1 Q
"RTN","ORWCIRN",22,0)
 ... S HDRFLG=I ; Remove commented out code to enable HDR + 1 other site. 
"RTN","ORWCIRN",23,0)
 D GETLST^XPAR(.ORSITES,"ALL","ORWRP CIRN SITES","I")
"RTN","ORWCIRN",24,0)
 S (CTR,I)=0,LOCAL=$P($$SITE^VASITE,"^",3)
"RTN","ORWCIRN",25,0)
 F  S I=$O(ORY(I)) Q:'I  D
"RTN","ORWCIRN",26,0)
 . I +ORY(I)=+LOCAL K ORY(I) Q
"RTN","ORWCIRN",27,0)
 . S IFN=$$IEN^XUAF4(ORY(I)),CTR=CTR+1
"RTN","ORWCIRN",28,0)
 . I IFN,$G(ORSITES(IFN)) S $P(ORY(I),"^",5)=1 I $P(ORY(I),"^")=200 S $P(ORY(I),"^",2)="DEPT. OF DEFENSE"
"RTN","ORWCIRN",29,0)
 . I IFN,$G(ORSITES(IFN)),$P(ORY(I),"^")="200HD" D
"RTN","ORWCIRN",30,0)
 .. I +$$GET^XPAR("ALL","ORWRP HDR ON",1,"I")=0 K ORY(I) S CTR=CTR-1 Q
"RTN","ORWCIRN",31,0)
 .. S HDRFLG=I ; Remove commented out code to enable HDR + 1 other site. 
"RTN","ORWCIRN",32,0)
 I '$L($O(ORY(""))) S ORY(0)="-1^Only local data exists for this patient"
"RTN","ORWCIRN",33,0)
 I $G(HDRFLG),CTR'>1 K ORY(HDRFLG) S ORY(0)="-1^Only HDR has data for this patient"
"RTN","ORWCIRN",34,0)
 Q
"RTN","ORWCIRN",35,0)
RESTRICT(ORY,PATID) ;Check for sensitive patient
"RTN","ORWCIRN",36,0)
 N DFN,ICN,SITE
"RTN","ORWCIRN",37,0)
 I '$G(PATID) S ORY(1)="-1",ORY(2)="Invalid Patient ID" Q
"RTN","ORWCIRN",38,0)
 S ICN=$P(PATID,";",2)
"RTN","ORWCIRN",39,0)
 I 'ICN S ORY(1)="-1",ORY(2)="Invalid ICN" Q
"RTN","ORWCIRN",40,0)
 S SITE=$$SITE^VASITE,SITE=$P(SITE,"^",2)_";"_$P(SITE,"^",3)
"RTN","ORWCIRN",41,0)
 S DFN=+$$GETDFN^MPIF001(ICN)
"RTN","ORWCIRN",42,0)
 I DFN<0 S ORY(1)="-1",ORY(2)="Patient not found on remote system ("_SITE_")" Q
"RTN","ORWCIRN",43,0)
 D PTSEC^DGSEC4(.ORY,DFN)
"RTN","ORWCIRN",44,0)
 Q
"RTN","ORWCIRN",45,0)
CHKLNK(ORY) ;Check for active HL7 TCP link on local system
"RTN","ORWCIRN",46,0)
 S ORY=$$STAT^HLCSLM
"RTN","ORWCIRN",47,0)
 Q
"RTN","ORWCIRN",48,0)
WEBADDR(ORY,PATID) ;Get VistaWeb Address
"RTN","ORWCIRN",49,0)
 S ORY=$$GET^XPAR("ALL","ORWRP VISTAWEB ADDRESS",1,"I")
"RTN","ORWCIRN",50,0)
 I ORY="" S ORY="https://vistaweb.med.va.gov" Q
"RTN","ORWCIRN",51,0)
 I ORY="https://vistaweb.med.va.gov" Q
"RTN","ORWCIRN",52,0)
 S ORY=ORY_"?q9gtw0="_$P($$SITE^VASITE,"^",3)_"&xqi4z="_PATID_"&yiicf="_DUZ
"RTN","ORWCIRN",53,0)
 Q
"RTN","ORWCIRN",54,0)
AUTORDV(ORY) ;Get parameter value for ORWRP CIRN AUTOMATIC
"RTN","ORWCIRN",55,0)
 S ORY=+$$GET^XPAR("ALL","ORWRP CIRN AUTOMATIC",1,"I")
"RTN","ORWCIRN",56,0)
 Q
"RTN","ORWCIRN",57,0)
HDRON(ORY) ;Get parameter value for ORWRP HDR ON
"RTN","ORWCIRN",58,0)
 S ORY=+$$GET^XPAR("ALL","ORWRP HDR ON",1,"I")
"RTN","ORWCIRN",59,0)
 Q
"RTN","ORWCV")
0^216^B73405381
"RTN","ORWCV",1,0)
ORWCV ; SLC/KCM - Background Cover Sheet Load; ; 3/6/08 6:34am
"RTN","ORWCV",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,109,132,209,214,195,215,260,243**;Dec 17, 1997;Build 242
"RTN","ORWCV",3,0)
 ;
"RTN","ORWCV",4,0)
 ; DBIA 4011    Access ^XWB(8994)
"RTN","ORWCV",5,0)
 ; DBIA 4313    Direct R/W permission to capacity mgmt global ^KMPTMP("KMPDT")
"RTN","ORWCV",6,0)
 ; DBIA 10061   Reference to ^UTILITY
"RTN","ORWCV",7,0)
 ; 
"RTN","ORWCV",8,0)
START(VAL,DFN,IP,HWND,LOC,NODO,NEWREM) ; start cover sheet build in background
"RTN","ORWCV",9,0)
 N ZTIO,ZTRTN,ZTDTH,ZTSAVE,ZTDESC,SECT,BACK,X,I,ORLIST,STR,FILE,NODE,ORHTIME,ORX
"RTN","ORWCV",10,0)
 ; Capacity planning timing code uses ORHTIME
"RTN","ORWCV",11,0)
 S ORHTIME=$H
"RTN","ORWCV",12,0)
 S LOC=$G(LOC),NODO=";"_$G(NODO),NEWREM=+$G(NEWREM)
"RTN","ORWCV",13,0)
 D GETLST^XPAR(.ORX,"SYS^PKG","ORWOR COVER RETRIEVAL NEW","Q")
"RTN","ORWCV",14,0)
 S I=0 F  S I=$O(ORX(I)) Q:'I  I $D(^ORD(101.24,+ORX(I),0)) S SECT(+$P(^(0),"^",2))=$P(ORX(I),"^",2)
"RTN","ORWCV",15,0)
 D GETLST^XPAR(.ORLIST,"ALL","ORWCV1 COVERSHEET LIST")
"RTN","ORWCV",16,0)
 S (VAL,BACK,STR,FILE)=""
"RTN","ORWCV",17,0)
 F  S I=$O(ORLIST(I)) Q:'I  I $D(^ORD(101.24,$P(ORLIST(I),"^",2),0))  S X0=^(0) D
"RTN","ORWCV",18,0)
 . Q:$P(X0,"^",8)'="C"
"RTN","ORWCV",19,0)
 . S X=$P(X0,"^",2)
"RTN","ORWCV",20,0)
 . I NODO[(";"_X_";") Q                                  ; if in NODO, dont do section
"RTN","ORWCV",21,0)
 . S STR=STR_X_";"
"RTN","ORWCV",22,0)
 . I '$G(SECT(X)) S VAL=VAL_X_";"                        ; load section in foreground
"RTN","ORWCV",23,0)
 . E  S BACK=BACK_X_";",FILE=FILE_$P(ORLIST(I),"^",2)_";"  ; load section in background
"RTN","ORWCV",24,0)
 Q:BACK=""
"RTN","ORWCV",25,0)
 S ZTIO="ORW THREAD RESOURCE",ZTRTN="BUILD^ORWCV",ZTDTH=$H
"RTN","ORWCV",26,0)
 S (ZTSAVE("DFN"),ZTSAVE("IP"),ZTSAVE("HWND"),ZTSAVE("NEWREM"),ZTSAVE("LOC"),ZTSAVE("BACK"),ZTSAVE("FILE"))=""
"RTN","ORWCV",27,0)
 S ZTDESC="CPRS GUI Background Data Retrieval"
"RTN","ORWCV",28,0)
 D ^%ZTLOAD I '$D(ZTSK) S VAL=STR Q
"RTN","ORWCV",29,0)
 S NODE="ORWCV "_IP_"-"_HWND_"-"_DFN
"RTN","ORWCV",30,0)
 K ^XTMP(NODE)
"RTN","ORWCV",31,0)
 S ^XTMP(NODE,0)=$$FMADD^XLFDT(DT,1)_U_DT_U_"Background CPRS "_ZTSK
"RTN","ORWCV",32,0)
 ; Start capacity planning timing clock - will be stopped in POLL code
"RTN","ORWCV",33,0)
 I +$G(^KMPTMP("KMPD-CPRS")) S ^KMPTMP("KMPDT","ORWCV",NODE)=$G(ORHTIME)_"^^"_$G(DUZ)_"^"_$G(IO("CLNM"))
"RTN","ORWCV",34,0)
 Q
"RTN","ORWCV",35,0)
BUILD ; called in background by task manager, expects DFN, JobID
"RTN","ORWCV",36,0)
 N NODE,IFLE,ORFNUM,ID,ENT,RTN,INODE,PARAM1,PARAM2,DETAIL,X0,X2
"RTN","ORWCV",37,0)
 S NODE="ORWCV "_IP_"-"_HWND_"-"_DFN
"RTN","ORWCV",38,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","ORWCV",39,0)
 I $G(^XTMP(NODE,"STOP")) K ^XTMP(NODE) Q  ; client no longer polling
"RTN","ORWCV",40,0)
 I '$D(^XTMP(NODE,0)) Q                    ; XTMP node has been purged
"RTN","ORWCV",41,0)
 L +^XTMP(NODE)
"RTN","ORWCV",42,0)
 S ^XTMP(NODE,"DFN")=DFN
"RTN","ORWCV",43,0)
 ;N $ETRAP,$ESTACK
"RTN","ORWCV",44,0)
 ;S $ETRAP="D ERR^ORWCV Q"
"RTN","ORWCV",45,0)
 I $L($G(FILE),";")>0 F IFLE=1:1:$L(FILE,";") S ORFNUM=$P(FILE,";",IFLE)  Q:'$D(^ORD(101.24,+ORFNUM,0))  S X0=^(0),X2=$G(^(2)) D
"RTN","ORWCV",46,0)
 . S ID=$P(X0,"^",2),ENT=$P(X0,"^",6),RTN=$P(X0,"^",5),PARAM1=$P(X2,"^"),PARAM2=$P(X2,"^",2),INODE=$P(X2,"^",5),DETAIL=""
"RTN","ORWCV",47,0)
 . I $P(X0,"^",18) S DETAIL=$P($G(^ORD(101.24,+$P(X0,"^",18),0)),"^",13),DETAIL=$P($G(^XWB(8994,+DETAIL,0)),"^")  ;DBIA 4011
"RTN","ORWCV",48,0)
 . I '$L(INODE) Q
"RTN","ORWCV",49,0)
 . I '$L(ENT) S LST(IFLE)="0^ERROR: Missing ENTRY POINT field in file 101.24 for "_$P(X0,"^")_", IFN="_+ORFNUM D LST2XTMP(INODE) Q
"RTN","ORWCV",50,0)
 . I '$L(RTN) S LST(IFLE)="0^ERROR: Missing ROUTINE field in file 101.24 for "_$P(X0,"^")_", IFN="_+ORFNUM D LST2XTMP(INODE) Q
"RTN","ORWCV",51,0)
 . I '$L($T(@(ENT_"^"_RTN))) S LST(IFLE)="0^ERROR: "_ENT_"~"_RTN_" does not exist. See file 101.24 entry: "_$P(X0,"^")_", IFN="_+ORFNUM D LST2XTMP(INODE) Q
"RTN","ORWCV",52,0)
 . I ID=50 D:$L($T(STRT3^AWCMCPR1)) STRT3^AWCMCPR1 D  D:$L($T(END^AWCMCPR1)) END^AWCMCPR1 Q  ;Special case for reminders
"RTN","ORWCV",53,0)
 .. I $G(NEWREM) D APPL^ORQQPXRM(.LST,DFN,LOC) I 1
"RTN","ORWCV",54,0)
 .. E  D @(ENT_"^"_RTN_"(.LST,DFN)")
"RTN","ORWCV",55,0)
 .. D LST2XTMP(INODE)
"RTN","ORWCV",56,0)
 . I $L(PARAM1),$L(PARAM2) D @(ENT_"^"_RTN_"(.LST,DFN,PARAM1,PARAM2)"),LST2XTMP(INODE) Q
"RTN","ORWCV",57,0)
 . I $L(PARAM1) D @(ENT_"^"_RTN_"(.LST,DFN,PARAM1)"),LST2XTMP(INODE) Q
"RTN","ORWCV",58,0)
 . D @(ENT_"^"_RTN_"(.LST,DFN)"),LST2XTMP(INODE)
"RTN","ORWCV",59,0)
 S ^XTMP(NODE,"DONE")=1
"RTN","ORWCV",60,0)
 I $G(^XTMP(NODE,"STOP")) K ^XTMP(NODE)
"RTN","ORWCV",61,0)
 L -^XTMP(NODE)
"RTN","ORWCV",62,0)
 Q
"RTN","ORWCV",63,0)
ERR ;Error trap
"RTN","ORWCV",64,0)
 S $ETRAP="D UNWIND^ORWCV Q"
"RTN","ORWCV",65,0)
 I $D(NODE) D
"RTN","ORWCV",66,0)
 . I $D(INODE) S LST(0)="",LST(1)="0^ERROR DURING COVER SHEET BUILD:"_$ZERROR D LST2XTMP(INODE)
"RTN","ORWCV",67,0)
 . S ^XTMP(NODE,"DONE")=1
"RTN","ORWCV",68,0)
 . L -^XTMP(NODE)
"RTN","ORWCV",69,0)
 D @^%ZOSF("ERRTN") ;file error
"RTN","ORWCV",70,0)
 S $ECODE=",UOR70 error during Cover Sheet build,"
"RTN","ORWCV",71,0)
 Q
"RTN","ORWCV",72,0)
UNWIND ;Unwind Error stack
"RTN","ORWCV",73,0)
 Q:$ESTACK>1  ;pop the stack
"RTN","ORWCV",74,0)
 ;add additional code here, if needed
"RTN","ORWCV",75,0)
 Q
"RTN","ORWCV",76,0)
LST2XTMP(ID) ; put the list in ^XTMP(NODE,ID)
"RTN","ORWCV",77,0)
 I $G(^XTMP(NODE,"STOP")) Q
"RTN","ORWCV",78,0)
 N I
"RTN","ORWCV",79,0)
 I $L($G(DETAIL)) S I=0 F  S I=$O(LST(I)) Q:'I  S $P(LST(I),"^",12)=DETAIL
"RTN","ORWCV",80,0)
 K ^XTMP(NODE,ID) M ^XTMP(NODE,ID)=LST S ^XTMP(NODE,ID)=1 K LST
"RTN","ORWCV",81,0)
 Q
"RTN","ORWCV",82,0)
POLL(LST,DFN,IP,HWND) ; poll for completed cover sheet parts
"RTN","ORWCV",83,0)
 N I,ILST,ID,NODE,DONE
"RTN","ORWCV",84,0)
 S NODE="ORWCV "_IP_"-"_HWND_"-"_DFN,ILST=0,DONE=0
"RTN","ORWCV",85,0)
 I '$D(^XTMP(NODE,"DFN")) Q
"RTN","ORWCV",86,0)
 I ^XTMP(NODE,"DFN")'=DFN S LST(1)="~DONE=1" Q
"RTN","ORWCV",87,0)
 I $G(^XTMP(NODE,"DONE")) S ILST=ILST+1,LST(ILST)="~DONE=1",DONE=1
"RTN","ORWCV",88,0)
 F ID="PROB","CWAD","MEDS","RMND","LABS","VITL","VSIT" D
"RTN","ORWCV",89,0)
 . I '$G(^XTMP(NODE,ID)) Q
"RTN","ORWCV",90,0)
 . S ILST=ILST+1,LST(ILST)="~"_ID
"RTN","ORWCV",91,0)
 . S I=0 F  S I=$O(^XTMP(NODE,ID,I)) Q:'I  S ILST=ILST+1,LST(ILST)="i"_^(I)
"RTN","ORWCV",92,0)
 . K ^XTMP(NODE,ID)
"RTN","ORWCV",93,0)
 ; Stop capacity planning timing clock - was started in START code
"RTN","ORWCV",94,0)
 I DONE K ^XTMP(NODE) I +$G(^KMPTMP("KMPD-CPRS")) S $P(^KMPTMP("KMPDT","ORWCV",NODE),"^",2)=$H
"RTN","ORWCV",95,0)
 Q
"RTN","ORWCV",96,0)
STOP(OK,DFN,IP,HWND) ; stop cover sheet data retrieval
"RTN","ORWCV",97,0)
 S NODE="ORWCV "_IP_"-"_HWND_"-"_DFN,ILST=0,DONE=0
"RTN","ORWCV",98,0)
 S ^XTMP(NODE,"STOP")=1,OK=1
"RTN","ORWCV",99,0)
 L +^XTMP(NODE)
"RTN","ORWCV",100,0)
 I $G(^XTMP(NODE,"DONE")) K ^XTMP(NODE)
"RTN","ORWCV",101,0)
 L -^XTMP(NODE)
"RTN","ORWCV",102,0)
 Q
"RTN","ORWCV",103,0)
CLEAN ; clean up ^XTMP nodes
"RTN","ORWCV",104,0)
 S X="ORWCV"
"RTN","ORWCV",105,0)
 F  S X=$O(^XTMP(X)) Q:$E(X,1,5)'="ORWCV"  W !,X K ^XTMP(X)
"RTN","ORWCV",106,0)
 Q
"RTN","ORWCV",107,0)
LAB(LST,DFN) ; return labs for patient
"RTN","ORWCV",108,0)
 D:$L($T(STRT2^AWCMCPR1)) STRT2^AWCMCPR1
"RTN","ORWCV",109,0)
 D LIST^ORQOR1(.LST,DFN,"LAB",4,"T-"_$$RNGLAB(DFN),"T","AW",1)
"RTN","ORWCV",110,0)
 D:$L($T(END^AWCMCPR1)) END^AWCMCPR1
"RTN","ORWCV",111,0)
 Q
"RTN","ORWCV",112,0)
 ;
"RTN","ORWCV",113,0)
VST1(ORVISIT,DFN,BEG,END,SKIP) ;
"RTN","ORWCV",114,0)
 N ERR,ERRMSG
"RTN","ORWCV",115,0)
 S ERR=0 ; kludge to return errors
"RTN","ORWCV",116,0)
 Q:'$G(DFN)
"RTN","ORWCV",117,0)
 D VST(.ORVISIT,DFN,.BEG,.END,$G(SKIP),.ERR,.ERRMSG)
"RTN","ORWCV",118,0)
 I ERR K ORVISIT S ORVISIT(1)=ERRMSG
"RTN","ORWCV",119,0)
 Q
"RTN","ORWCV",120,0)
 ;
"RTN","ORWCV",121,0)
TEST ;D VST(.ZZZ,76,2950101,3050401,777,1,1)
"RTN","ORWCV",122,0)
 Q
"RTN","ORWCV",123,0)
VST(ORVISIT,DFN,BEG,END,SKIP,ERR,ERRMSG) ; return appts/admissions for patient
"RTN","ORWCV",124,0)
 N CHECKERR,VAERR,VASD,BDT,COUNT,DTM,EDT,LOC,NOW,ORQUERY,ORLST,STI,STS,TODAY,I,J,K,XI,XE,X
"RTN","ORWCV",125,0)
 S CHECKERR=($G(ERR)=0) ; kludge to check for errors
"RTN","ORWCV",126,0)
 S NOW=$$NOW^XLFDT(),TODAY=$P(NOW,".",1)
"RTN","ORWCV",127,0)
 I '$G(BEG) S BEG=$$X2FM($$RNGVBEG)
"RTN","ORWCV",128,0)
 I '$G(END) S END=$$X2FM($$RNGVEND)+0.2359
"RTN","ORWCV",129,0)
 S COUNT=0
"RTN","ORWCV",130,0)
 K ^TMP("ORVSTLIST",$J)
"RTN","ORWCV",131,0)
 S VAERR=0
"RTN","ORWCV",132,0)
 I END>NOW D   Q:VAERR  ; get future encounters, past cancels/no-shows from VADPT
"RTN","ORWCV",133,0)
 . S VASD("F")=BEG
"RTN","ORWCV",134,0)
 . S VASD("T")=END
"RTN","ORWCV",135,0)
 . S VASD("W")="123456789"
"RTN","ORWCV",136,0)
 . D SDA^ORQRY01(.ERR,.ERRMSG)
"RTN","ORWCV",137,0)
 . I CHECKERR,ERR K ^UTILITY("VASD",$J) S ORVISIT(1)=ERRMSG Q  ;IA 10061
"RTN","ORWCV",138,0)
 . S I=0 F  S I=$O(^UTILITY("VASD",$J,I)) Q:'I  D
"RTN","ORWCV",139,0)
 . . S XI=^UTILITY("VASD",$J,I,"I"),XE=^("E")
"RTN","ORWCV",140,0)
 . . S DTM=$P(XI,U),IEN=$P(XI,U,2),STI=$P(XI,U,3)
"RTN","ORWCV",141,0)
 . . S LOC=$P(XE,U,2),STS=$P(XE,U,3)
"RTN","ORWCV",142,0)
 . . I DTM<TODAY,(STI=""!(STI["I")!(STI="NT")) Q  ; no prior kept appts
"RTN","ORWCV",143,0)
 . . S ^TMP("ORVSTLIST",$J,DTM,"A",1)="A;"_DTM_";"_IEN_U_DTM_U_LOC_U_STS
"RTN","ORWCV",144,0)
 . K ^UTILITY("VASD",$J)
"RTN","ORWCV",145,0)
 I BEG'>NOW D  ;past encounters from ACRP Toolkit - set in CALLBACK
"RTN","ORWCV",146,0)
 . S BDT=BEG
"RTN","ORWCV",147,0)
 . S EDT=$S(END<NOW:END,1:NOW)
"RTN","ORWCV",148,0)
 . D OPEN^SDQ(.ORQUERY)
"RTN","ORWCV",149,0)
 . I '$$ERRCHK^SDQUT() D INDEX^SDQ(.ORQUERY,"PATIENT/DATE","SET")
"RTN","ORWCV",150,0)
 . I '$$ERRCHK^SDQUT() D PAT^SDQ(.ORQUERY,DFN,"SET")
"RTN","ORWCV",151,0)
 . I '$$ERRCHK^SDQUT() D DATE^SDQ(.ORQUERY,BDT,EDT,"SET")
"RTN","ORWCV",152,0)
 . I '$$ERRCHK^SDQUT() D
"RTN","ORWCV",153,0)
 . . S ORLST=$NA(^TMP("ORVSTLIST",$J))
"RTN","ORWCV",154,0)
 . . D SCANCB^SDQ(.ORQUERY,"D CALLBACK^ORWCV(Y,Y0,.ORLST,.ORSTOP)","SET")
"RTN","ORWCV",155,0)
 . I '$$ERRCHK^SDQUT() D ACTIVE^SDQ(.ORQUERY,"TRUE","SET")
"RTN","ORWCV",156,0)
 . I '$$ERRCHK^SDQUT() D SCAN^SDQ(.ORQUERY,"FORWARD")
"RTN","ORWCV",157,0)
 . D CLOSE^SDQ(.ORQUERY)
"RTN","ORWCV",158,0)
 ;
"RTN","ORWCV",159,0)
 I '$G(SKIP) D
"RTN","ORWCV",160,0)
 . N TIM,MOV,X0,Y,MTIM,XTYP,XLOC,HLOC,EARLY,DONE                ; admits
"RTN","ORWCV",161,0)
 . S EARLY=$$X2FM($$RNGVBEG),DONE=0
"RTN","ORWCV",162,0)
 . S TIM="" F  S TIM=$O(^DGPM("ATID1",DFN,TIM)) Q:TIM'>0  D  Q:DONE
"RTN","ORWCV",163,0)
 . . S MOV=0  F  S MOV=$O(^DGPM("ATID1",DFN,TIM,MOV)) Q:MOV'>0  D  Q:DONE
"RTN","ORWCV",164,0)
 . . . S X0=^DGPM(MOV,0),MTIM=$P(X0,U)
"RTN","ORWCV",165,0)
 . . . I MTIM<EARLY S DONE=1 Q
"RTN","ORWCV",166,0)
 . . . S XTYP=$P($G(^DG(405.1,+$P(X0,U,4),0)),U,1)
"RTN","ORWCV",167,0)
 . . . S XLOC=$P($G(^DIC(42,+$P(X0,U,6),0)),U,1),HLOC=+$G(^(44))
"RTN","ORWCV",168,0)
 . . . S ^TMP("ORVSTLIST",$J,MTIM,"I",1)="I;"_MTIM_";"_HLOC_U_MTIM_U_"Inpatient Stay"_U_XLOC_U_XTYP
"RTN","ORWCV",169,0)
 ;
"RTN","ORWCV",170,0)
 S COUNT=0
"RTN","ORWCV",171,0)
 S I=0 F  S I=$O(^TMP("ORVSTLIST",$J,I)) Q:'I  D
"RTN","ORWCV",172,0)
 . S J="" F  S J=$O(^TMP("ORVSTLIST",$J,I,J)) Q:J=""  D
"RTN","ORWCV",173,0)
 . . S K=0 F  S K=$O(^TMP("ORVSTLIST",$J,I,J,K)) Q:'K  D
"RTN","ORWCV",174,0)
 . . . S COUNT=COUNT+1
"RTN","ORWCV",175,0)
 . . . S ORVISIT(COUNT)=^TMP("ORVSTLIST",$J,I,J,K)
"RTN","ORWCV",176,0)
 K ^TMP("ORVSTLIST",$J)
"RTN","ORWCV",177,0)
 Q
"RTN","ORWCV",178,0)
CALLBACK(IEN,NODE0,ARRAY,STOP) ; called back from ACRP Toolkit for encounters
"RTN","ORWCV",179,0)
 ;
"RTN","ORWCV",180,0)
 ; IEN and NODE0 relate to Outpatient Encounter File
"RTN","ORWCV",181,0)
 ; set STOP to 1 if need to quit
"RTN","ORWCV",182,0)
 ;
"RTN","ORWCV",183,0)
 N COUNT,DTM,LOC,OOS,TYPE,XSTAT,XLOC
"RTN","ORWCV",184,0)
 S DTM=+NODE0,COUNT=1
"RTN","ORWCV",185,0)
 S LOC=$P(NODE0,"^",4)
"RTN","ORWCV",186,0)
 S XLOC=$P($G(^SC(+LOC,0)),U),OOS=$G(^("OOS"))
"RTN","ORWCV",187,0)
 I OOS Q              ; ignore OOS locations
"RTN","ORWCV",188,0)
 I $P(NODE0,"^",6) Q  ; not parent encounter
"RTN","ORWCV",189,0)
 S XSTAT=$P($G(^SD(409.63,+$P(NODE0,"^",12),0)),"^")
"RTN","ORWCV",190,0)
 S TYPE=$S($P(NODE0,"^",8)=1:"A",1:"V")
"RTN","ORWCV",191,0)
 I TYPE="V",$D(@ARRAY@(DTM,"V")) S COUNT=$O(@ARRAY@(DTM,"V","A"),-1)+1 ; same d/t
"RTN","ORWCV",192,0)
 S @ARRAY@(DTM,TYPE,COUNT)=TYPE_";"_DTM_";"_LOC_U_DTM_U_XLOC_U_XSTAT
"RTN","ORWCV",193,0)
 Q
"RTN","ORWCV",194,0)
DTLVST(RPT,DFN,IEN,APPTINFO) ; return progress notes / discharge summary
"RTN","ORWCV",195,0)
 N VISIT
"RTN","ORWCV",196,0)
 I $P(APPTINFO,";")="A" D  Q
"RTN","ORWCV",197,0)
 . S VISIT=$$APPT2VST^PXAPI(DFN,$P(APPTINFO,";",2),$P(APPTINFO,";",3))
"RTN","ORWCV",198,0)
 . I VISIT=0 S VISIT=+$$GETENC^PXAPI(DFN,$P(APPTINFO,";",2),$P(APPTINFO,";",3))
"RTN","ORWCV",199,0)
 . D DETNOTE^ORQQVS(.RPT,DFN,VISIT)
"RTN","ORWCV",200,0)
 I $P(APPTINFO,";")="V" D  Q
"RTN","ORWCV",201,0)
 . S VISIT=+$$GETENC^PXAPI(DFN,$P(APPTINFO,";",2),$P(APPTINFO,";",3))
"RTN","ORWCV",202,0)
 . D DETNOTE^ORQQVS(.RPT,DFN,VISIT)
"RTN","ORWCV",203,0)
 I $P(APPTINFO,";")="I" D  Q
"RTN","ORWCV",204,0)
 . S VISIT=+$$GETENC^PXAPI(DFN,$P(APPTINFO,";",2),$P(APPTINFO,";",3))
"RTN","ORWCV",205,0)
 . D DETSUM^ORQQVS(.RPT,DFN,VISIT)
"RTN","ORWCV",206,0)
 . K ^TMP("PXKENC",$J)
"RTN","ORWCV",207,0)
 Q
"RTN","ORWCV",208,0)
X2FM(X) ; return FM date given relative date
"RTN","ORWCV",209,0)
 N %DT S %DT="TS" D ^%DT
"RTN","ORWCV",210,0)
 Q Y
"RTN","ORWCV",211,0)
RNGLAB(DFN) ; return days back for patient
"RTN","ORWCV",212,0)
 N INPT,PAR
"RTN","ORWCV",213,0)
 S INPT=0 I $L($G(^DPT(DFN,.1))) S INPT=1
"RTN","ORWCV",214,0)
 S PAR="ORQQLR DATE RANGE "_$S(INPT:"INPT",1:"OUTPT")
"RTN","ORWCV",215,0)
 Q $$GET^XPAR("ALL",PAR,1,"I")
"RTN","ORWCV",216,0)
 ;
"RTN","ORWCV",217,0)
RNGVBEG() ; return start date for encounters
"RTN","ORWCV",218,0)
 Q $$GET^XPAR("ALL","ORQQCSDR CS RANGE START",1,"I")
"RTN","ORWCV",219,0)
 ;
"RTN","ORWCV",220,0)
RNGVEND() ; return stop date for encounters
"RTN","ORWCV",221,0)
 Q $$GET^XPAR("ALL","ORQQCSDR CS RANGE STOP",1,"I")
"RTN","ORWCV",222,0)
 ;
"RTN","ORWCV",223,0)
RANGES(REC,DFN) ; return ranges given a patient
"RTN","ORWCV",224,0)
 N REC
"RTN","ORWCV",225,0)
 S REC=$$RNGLAB(DFN)_U_$$RNGVBEG_U_$$RNGVEND
"RTN","ORWCV",226,0)
 Q
"RTN","ORWD")
0^97^B42948340
"RTN","ORWD",1,0)
ORWD ; SLC/KCM - Utilities for Windows Dialogs ;7/2/01  13:31
"RTN","ORWD",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORWD",3,0)
 ;
"RTN","ORWD",4,0)
DT(Y,X) ; Returns internal Fileman Date/Time
"RTN","ORWD",5,0)
 N %DT S %DT="TS" D ^%DT
"RTN","ORWD",6,0)
 Q
"RTN","ORWD",7,0)
PROVKEY(VAL,USERID) ; Returns 1 if user possesses the provider key
"RTN","ORWD",8,0)
 N NAM S NAM=$P(^VA(200,USERID,0),U,1)
"RTN","ORWD",9,0)
 S VAL=$D(^VA(200,"AK.PROVIDER",NAM,USERID))
"RTN","ORWD",10,0)
 Q
"RTN","ORWD",11,0)
KEY(VAL,KEYNAME,USERID) ; Returns 1 if user possesses the key
"RTN","ORWD",12,0)
 S VAL=0 I $D(^XUSEC(KEYNAME,USERID)) S VAL=1
"RTN","ORWD",13,0)
 Q
"RTN","ORWD",14,0)
OI(Y,XREF,DIR,FROM) ; Return a bolus of orderable items
"RTN","ORWD",15,0)
 ; .Return Array, Cross Reference (S.xxx), Direction, Starting Text
"RTN","ORWD",16,0)
 N I,IEN,CNT S CNT=44
"RTN","ORWD",17,0)
 ;
"RTN","ORWD",18,0)
 I DIR=0 D  ; Forward direction
"RTN","ORWD",19,0)
 . F I=1:1:CNT S FROM=$O(^ORD(101.43,XREF,FROM)) Q:FROM=""  D
"RTN","ORWD",20,0)
 . . S Y(I)=$O(^ORD(101.43,XREF,FROM,0))_"^"_FROM
"RTN","ORWD",21,0)
 . I $G(Y(CNT))="" S Y(I)=""
"RTN","ORWD",22,0)
 ;
"RTN","ORWD",23,0)
 I DIR=1 D  ; Reverse direction
"RTN","ORWD",24,0)
 . F I=1:1:CNT S FROM=$O(^ORD(101.43,XREF,FROM),-1) Q:FROM=""  D
"RTN","ORWD",25,0)
 . . S Y(I)=$O(^ORD(101.43,XREF,FROM,0))_"^"_FROM
"RTN","ORWD",26,0)
 Q
"RTN","ORWD",27,0)
ODEF(Y,DLG) ; Return the definition for a dialog
"RTN","ORWD",28,0)
 Q:'$L(DLG)
"RTN","ORWD",29,0)
 S DLG=+$O(^ORD(101.41,"B",DLG,0))
"RTN","ORWD",30,0)
 Q:$D(^ORD(101.41,DLG,50))<10
"RTN","ORWD",31,0)
 N I,IEN,IDX
"RTN","ORWD",32,0)
 S I=0,IDX=0
"RTN","ORWD",33,0)
 S Y(0)=$P($G(^ORD(101.41,DLG,5)),"^",4)
"RTN","ORWD",34,0)
 F  S I=$O(^ORD(101.41,DLG,50,"AC",I)) Q:I=""  S IEN=$O(^(I,0)) D
"RTN","ORWD",35,0)
 . S IDX=IDX+1,Y(IDX)=$G(^ORD(101.41,DLG,50,IEN,0))
"RTN","ORWD",36,0)
 Q
"RTN","ORWD",37,0)
DEF(Y,DLG) ; Return format mapping for a dialog
"RTN","ORWD",38,0)
 ; Y(n): CtrlName^DlgPtr^FmtSeq^Fmt^Omit^Lead^Trail^Mult?^chd1~chd2~...
"RTN","ORWD",39,0)
 I DLG="NOT IMPLEMENTED" S Y(0)="0^0" Q                 ; for testing
"RTN","ORWD",40,0)
 S DLG=$O(^ORD(101.41,"B",DLG,0))
"RTN","ORWD",41,0)
 N I,J,K,N,X0,X2,XW,DPTR
"RTN","ORWD",42,0)
 S Y(0)=$P(^ORD(101.41,DLG,0),U,5)_U_DLG
"RTN","ORWD",43,0)
 S I=0,N=0
"RTN","ORWD",44,0)
 F  S I=$O(^ORD(101.41,DLG,10,I)) Q:I'>0  D
"RTN","ORWD",45,0)
 . S X0=$G(^ORD(101.41,DLG,10,I,0)),DPTR=$P(X0,U,2)
"RTN","ORWD",46,0)
 . S X2=$G(^ORD(101.41,DLG,10,I,2))
"RTN","ORWD",47,0)
 . S XW=$G(^ORD(101.41,DLG,10,I,"W"))
"RTN","ORWD",48,0)
 . S N=N+1,Y(N)=$P(XW,U,1)_U_DPTR_U_X2,CHLD=""
"RTN","ORWD",49,0)
 . S J=0 F  S J=$O(^ORD(101.41,DLG,10,"DAD",DPTR,J)) Q:'J  D
"RTN","ORWD",50,0)
 . . S K=0 F  S K=$O(^ORD(101.41,DLG,10,"DAD",DPTR,J,K)) Q:'K  D
"RTN","ORWD",51,0)
 . . . S CHLD=CHLD_$P(^ORD(101.41,DLG,10,K,0),U,2)_"~"
"RTN","ORWD",52,0)
 . S $P(Y(N),U,8)=CHLD
"RTN","ORWD",53,0)
 Q
"RTN","ORWD",54,0)
FORMID(VAL,ORIFN) ; procedure
"RTN","ORWD",55,0)
 ; Returns the Dialog Form ID
"RTN","ORWD",56,0)
 N X
"RTN","ORWD",57,0)
 S VAL=0,X=$P(^OR(100,+ORIFN,0),U,5)
"RTN","ORWD",58,0)
 Q:$P(X,";",2)'="ORD(101.41,"
"RTN","ORWD",59,0)
 S VAL=+$P($G(^ORD(101.41,+X,5)),U,5)
"RTN","ORWD",60,0)
 ; I X S VAL=$P($G(^XTV(8989.52,+X,0)),U,2)
"RTN","ORWD",61,0)
 Q
"RTN","ORWD",62,0)
GET4EDIT(LST,ORIFN) ; procedure
"RTN","ORWD",63,0)
 ; return responses in format that can be used by dialog
"RTN","ORWD",64,0)
 N ILST,PRMT,INST,DLG,ORDIALOG S ILST=0
"RTN","ORWD",65,0)
 I '$D(ORIFN) S LST=0 Q
"RTN","ORWD",66,0)
 S ORIFN=+ORIFN,DLG=+$P(^OR(100,ORIFN,0),U,5)
"RTN","ORWD",67,0)
 D GETDLG1^ORCD(DLG),GETORDER^ORCD("^OR(100,"_ORIFN_",4.5)")
"RTN","ORWD",68,0)
 S PRMT=0 F  S PRMT=$O(ORDIALOG(PRMT)) Q:'PRMT  D
"RTN","ORWD",69,0)
 . S INST=0 F  S INST=$O(ORDIALOG(PRMT,INST)) Q:'INST  D
"RTN","ORWD",70,0)
 . . S ILST=ILST+1,LST(ILST)="~"_PRMT_U_INST_U_$P(ORDIALOG(PRMT),U,3)
"RTN","ORWD",71,0)
 . . S ILST=ILST+1,LST(ILST)="d"_ORDIALOG(PRMT,INST)
"RTN","ORWD",72,0)
 . . I $E(ORDIALOG(PRMT,INST))=U D                 ; load word processing
"RTN","ORWD",73,0)
 . . . N I,REF S I=0,REF=ORDIALOG(PRMT,INST)
"RTN","ORWD",74,0)
 . . . F  S I=$O(@REF@(I)) Q:'I  S ILST=ILST+1,LST(ILST)="t"_^(I,0)
"RTN","ORWD",75,0)
 . . E  S $P(LST(ILST),U,2)=$$EXT^ORCD(PRMT,INST)  ; load external value
"RTN","ORWD",76,0)
 . . I "R"[$E(ORDIALOG(PRMT,0)) D
"RTN","ORWD",77,0)
 . . . S $P(LST(ILST),U,2)=$$UP^XLFSTR($$FMTE^XLFDT(ORDIALOG(PRMT,INST)))
"RTN","ORWD",78,0)
 Q
"RTN","ORWD",79,0)
EXTDT(X) ; Return an external date time that can be interpreted by %DT
"RTN","ORWD",80,0)
 I $E(X)="T" Q "TODAY"_$E(X,2,255)
"RTN","ORWD",81,0)
 I $E(X)="V" Q "NEXT VISIT"_$E(X,2,255)
"RTN","ORWD",82,0)
 Q ""
"RTN","ORWD",83,0)
WRLST(Y,TYP) ; Return list of dialogs for writing orders
"RTN","ORWD",84,0)
 ; .Y(n): DlgName^ListBox Text
"RTN","ORWD",85,0)
 ;   TYP: 'I' = inpatient, 'O' = outpatient
"RTN","ORWD",86,0)
 N PAR,ERR,SEQ,IEN,I,X
"RTN","ORWD",87,0)
 S PAR=$S(TYP="I":"ORW ADDORD INPT",1:"ORW ADDORD OUTPT")
"RTN","ORWD",88,0)
 D GETLST^XPAR(.X,"ALL",PAR,"Q",.ERR) Q:ERR
"RTN","ORWD",89,0)
 S I=0 F  S I=$O(X(I)) Q:'I  D
"RTN","ORWD",90,0)
 . S SEQ=$P(X(I),U,1),IEN=$P(X(I),U,2)
"RTN","ORWD",91,0)
 . S Y(SEQ)=$P(^ORD(101.41,IEN,0),U,1)_U_$P($G(^(5)),U,4)
"RTN","ORWD",92,0)
 Q
"RTN","ORWD",93,0)
SAVE(Y,DFN,ORNP,LOC,DLG,ORWDACT,RSP) ; procedure
"RTN","ORWD",94,0)
 ; Save order
"RTN","ORWD",95,0)
 N ORDIALOG,ORL,ORVP,ORIFN,ORDUZ,ORSTS,ORDG,OREVENT,ORCAT,ORDA
"RTN","ORWD",96,0)
 I $P(^ORD(101.41,+DLG,0),U)="PSO OERR" S ORCAT="O"
"RTN","ORWD",97,0)
 I $P(^ORD(101.41,+DLG,0),U)="PSJ OR PAT OE" S ORCAT="I"
"RTN","ORWD",98,0)
 S ORVP=DFN_";DPT(",ORL(2)=LOC_";SC(",ORL=ORL(2)
"RTN","ORWD",99,0)
 D GETDLG^ORCD(DLG)
"RTN","ORWD",100,0)
 M ORDIALOG=RSP S ORDIALOG=DLG
"RTN","ORWD",101,0)
 I ORWDACT="N" D
"RTN","ORWD",102,0)
 . D EN^ORCSAVE
"RTN","ORWD",103,0)
 . S Y="" I ORIFN D GETBYIFN^ORWORR(.Y,ORIFN)
"RTN","ORWD",104,0)
 I $P(ORWDACT,U,1)="E" D
"RTN","ORWD",105,0)
 . S ORIFN=+$P(ORWDACT,U,2) D XX^ORCSAVE
"RTN","ORWD",106,0)
 . S Y="" S ORIFN=+$P(ORWDACT,U,2)_";"_ORDA D GETBYIFN^ORWORR(.Y,ORIFN)
"RTN","ORWD",107,0)
 Q
"RTN","ORWD",108,0)
SIGN(ERRLST,DFN,ORNP,LOC,ORWSIGN) ; procedure
"RTN","ORWD",109,0)
 ; Sign orders (ORIFN;ACT^RELSTS^SIGSTS^NATR)
"RTN","ORWD",110,0)
 N ORVP,ORL,IDX,ANERROR,ERRCNT
"RTN","ORWD",111,0)
 S ORVP=DFN_";DPT(",ORL(2)=LOC_";SC(",ORL=ORL(2),ERRCNT=0
"RTN","ORWD",112,0)
 I '$D(^XUSEC("ORES",DUZ)) S ERRLST(1)=0_U_"Must have ORES key." Q
"RTN","ORWD",113,0)
 S IDX=0 F  S IDX=$O(ORWSIGN(IDX)) Q:'IDX  S X=ORWSIGN(IDX) D
"RTN","ORWD",114,0)
 . ; ** change NATR when GUI changed to pass Nature in 4th piece
"RTN","ORWD",115,0)
 . S ORIFN=$P(X,U),RELSTS=$P(X,U,2),SIGSTS=$P(X,U,3),NATR="E" ;$P(X,U,4)
"RTN","ORWD",116,0)
 . I SIGSTS=2 D NOTIF^ORCSIGN S ANERROR=""
"RTN","ORWD",117,0)
 . I SIGSTS'=2 D EN^ORCSEND(ORIFN,"",SIGSTS,RELSTS,NATR,"",.ANERROR)
"RTN","ORWD",118,0)
 . I $L(ANERROR) D  Q           ; don't print if an error occurred
"RTN","ORWD",119,0)
 . . S ERRCNT=ERRCNT+1,ERRLST(ERRCNT)=$P(ORWSIGN(IDX),U)_U_ANERROR
"RTN","ORWD",120,0)
 . . K ORWSIGN(IDX)
"RTN","ORWD",121,0)
 . I RELSTS=0 K ORWSIGN(IDX) Q  ; don't print if unreleased
"RTN","ORWD",122,0)
 . S ORWSIGN(IDX)=$P(ORWSIGN(IDX),U)
"RTN","ORWD",123,0)
 D PRINTS^ORWD1(.ORWSIGN,LOC)
"RTN","ORWD",124,0)
 Q
"RTN","ORWD",125,0)
VALIDACT(VAL,ORIFN,ACTION) ;procedure
"RTN","ORWD",126,0)
 ; Return 1 if action is valid for this order, otherwise 0^error
"RTN","ORWD",127,0)
 S VAL=$$VALID^ORCACT0(ORIFN,ACTION,.ERR)
"RTN","ORWD",128,0)
 I VAL=0 S VAL=VAL_U_ERR
"RTN","ORWD",129,0)
 Q
"RTN","ORWD",130,0)
SAVEACT(LST,ORIFN,ACTION,REASON,DFN,ORNP,LOC) ;procedure
"RTN","ORWD",131,0)
 ; Save this action for the order (it is still unsigned/unreleased)
"RTN","ORWD",132,0)
 N ORDIALOG,ORL,ORVP,ORDUZ,ORSTS,ORDG,OREVENT,ACTDA,SIGSTS,RELSTS,ASTS
"RTN","ORWD",133,0)
 S ORVP=DFN_";DPT(",ORL(2)=LOC_";SC("
"RTN","ORWD",134,0)
 S SIGSTS=2,RELSTS=11
"RTN","ORWD",135,0)
 I '$P(ORIFN,";",2) S $P(ORIFN,";",2)=1
"RTN","ORWD",136,0)
 I (ACTION="FL")!(ACTION="UF")!(ACTION="WC") S SIGSTS=3,RELSTS=""
"RTN","ORWD",137,0)
 S ASTS=$P(^OR(100,+ORIFN,8,+$P(ORIFN,";",2),0),U,15)
"RTN","ORWD",138,0)
 I ACTION="DC",((ASTS=10)!(ASTS=11)) D  Q       ; exit here if DELETE
"RTN","ORWD",139,0)
 . D GETBYIFN^ORWORR(.LST,ORIFN)
"RTN","ORWD",140,0)
 . S $P(LST(1),U,1)="~0",LST(2)="tDELETED - "_$E(LST(2),2,245)
"RTN","ORWD",141,0)
 . D CANCEL^ORCSAVE2(ORIFN)
"RTN","ORWD",142,0)
 ;
"RTN","ORWD",143,0)
 ; the only valid action for ActDA>1 is deletion, so only orders 
"RTN","ORWD",144,0)
 ; identified by ORIFN;1 should reach this point
"RTN","ORWD",145,0)
 ;
"RTN","ORWD",146,0)
 I $P(ORIFN,";",2)>1 S $ECODE=",Uorder action invalid," Q
"RTN","ORWD",147,0)
 I ACTION="FL" S $P(^OR(100,+ORIFN,6),U,1)=1
"RTN","ORWD",148,0)
 I ACTION="UF" S $P(^OR(100,+ORIFN,6),U,1)=0
"RTN","ORWD",149,0)
 I ACTION'="RN" D
"RTN","ORWD",150,0)
 . S ACTDA=$$ACTION^ORCSAVE(ACTION,+ORIFN,ORNP,REASON)
"RTN","ORWD",151,0)
 I ACTION="RN" D
"RTN","ORWD",152,0)
 . N ORDA,ORDIALOG,PRMT,SAVIFN,X0
"RTN","ORWD",153,0)
 . S SAVIFN=+ORIFN,X0=^OR(100,+ORIFN,0)
"RTN","ORWD",154,0)
 . I $P(X0,U,5)["101.41," D                        ; version 3
"RTN","ORWD",155,0)
 . . S ORDIALOG=+$P(X0,U,5),ORCAT=$P(^OR(100,+ORIFN,0),U,12)
"RTN","ORWD",156,0)
 . . D GETDLG^ORCD(ORDIALOG),GETORDER^ORCD(+ORIFN)
"RTN","ORWD",157,0)
 . E  D                                            ; version 2.5 generic
"RTN","ORWD",158,0)
 . . S ORDIALOG=$O(^ORD(101.41,"B","OR GXTEXT WORD PROCESSING ORDE",0))
"RTN","ORWD",159,0)
 . . D GETDLG^ORCD(ORDIALOG)
"RTN","ORWD",160,0)
 . . S PRMT=$O(^ORD(101.41,"B","OR GTX WORD PROCESSING 1",0))
"RTN","ORWD",161,0)
 . . S ORDIALOG(PRMT,1)=$NA(^TMP("ORWORD",$J,PRMT,1))
"RTN","ORWD",162,0)
 . . M ^TMP("ORWORD",$J,PRMT,1)=^OR(100,+ORIFN,1)
"RTN","ORWD",163,0)
 . . S PRMT=$O(^ORD(101.41,"B","OR GTX START DATE/TIME",0))
"RTN","ORWD",164,0)
 . . I $P(X0,U,9) S ORDIALOG(PRMT,1)=$P(X0,U,9)
"RTN","ORWD",165,0)
 . D RN^ORCSAVE I 'ORIFN S $ECODE=",UCPRS renew order,"
"RTN","ORWD",166,0)
 . S ACTDA=ORDA,ORIFN=SAVIFN
"RTN","ORWD",167,0)
 I (ACTION="FL")!(ACTION="UF") S ACTDA=1
"RTN","ORWD",168,0)
 D GETBYIFN^ORWORR(.LST,+ORIFN_";"_ACTDA)
"RTN","ORWD",169,0)
 S $P(LST(1),U,12)=ACTDA
"RTN","ORWD",170,0)
 Q
"RTN","ORWDAL32")
0^28^B40874191
"RTN","ORWDAL32",1,0)
ORWDAL32 ; SLC/REV - Allergy calls to support windows ;5/31/05  14:14
"RTN","ORWDAL32",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,109,190,195,233,243**;Dec 17, 1997;Build 242
"RTN","ORWDAL32",3,0)
 ;
"RTN","ORWDAL32",4,0)
DEF(LST) ; Get dialog data for allergies
"RTN","ORWDAL32",5,0)
 N ILST,I,X S ILST=0
"RTN","ORWDAL32",6,0)
 S LST($$NXT)="~Allergy Types" D ALLGYTYP
"RTN","ORWDAL32",7,0)
 S LST($$NXT)="~Reactions" D ALLGYTYP
"RTN","ORWDAL32",8,0)
 S LST($$NXT)="~Nature of Reaction" D NATREACT
"RTN","ORWDAL32",9,0)
 S LST($$NXT)="~Top Ten" D TOPTEN
"RTN","ORWDAL32",10,0)
 S LST($$NXT)="~Observ/Hist" D OBSHIST
"RTN","ORWDAL32",11,0)
 S LST($$NXT)="~Severity" D SEVERITY
"RTN","ORWDAL32",12,0)
 Q
"RTN","ORWDAL32",13,0)
GMRASITE(ORY) ;Return GMRA Site Params
"RTN","ORWDAL32",14,0)
 N GMRASITE
"RTN","ORWDAL32",15,0)
 D SITE^GMRAUTL
"RTN","ORWDAL32",16,0)
 S ORY=$G(^GMRD(120.84,GMRASITE,0))
"RTN","ORWDAL32",17,0)
 Q
"RTN","ORWDAL32",18,0)
TOPTEN ;  Get top ten symptoms from Allergy Site Parameters file
"RTN","ORWDAL32",19,0)
 N X0,I,CNT,GMRASITE S I=0,X0="",CNT=0 ;233
"RTN","ORWDAL32",20,0)
 D SITE^GMRAUTL ;233
"RTN","ORWDAL32",21,0)
 F  S I=$O(^GMRD(120.84,GMRASITE,1,I)),CNT=CNT+1 Q:+I=0!(CNT>10)  D  ;233
"RTN","ORWDAL32",22,0)
 . S X0=^GMRD(120.84,GMRASITE,1,I,0) Q:'$D(^GMRD(120.83,X0))  Q:$P(^GMRD(120.83,X0,0),"^")="OTHER REACTION"  ;233 Don't send this entry
"RTN","ORWDAL32",23,0)
 . ;233 Don't send if inactive term
"RTN","ORWDAL32",24,0)
 . I $L($T(SCREEN^XTID)) Q:$$SCREEN^XTID(120.83,.01,X0_",")
"RTN","ORWDAL32",25,0)
 . S LST($$NXT)="i"_X0_U_$P($G(^GMRD(120.83,X0,0)),U,1)
"RTN","ORWDAL32",26,0)
 Q
"RTN","ORWDAL32",27,0)
ALLSRCH(Y,X) ; Return list of partial matches  ; CHANGED TO PRODUCE TREEVIEW IN GUI
"RTN","ORWDAL32",28,0)
 N ORX,ROOT,XP,CNT,ORFILE,ORSRC,ORIEN,ORREAX S ORIEN=0,CNT=0,ORSRC=0,ORFILE=""
"RTN","ORWDAL32",29,0)
 S ORX=X,X=$$UP^XLFSTR(X)
"RTN","ORWDAL32",30,0)
 F ROOT="^GMRD(120.82,""B"")","^GMRD(120.82,""D"")",$$B^PSNAPIS,$$T^PSNAPIS,"^PSDRUG(""B"")","^PSDRUG(""C"")","^PS(50.416,""P"")","^PS(50.605,""C"")" D
"RTN","ORWDAL32",31,0)
 . S ORSRC=$G(ORSRC)+1,ORFILE=$P(ROOT,",",1)_")",ORSRC(ORSRC)=$P($T(FILENAME+ORSRC),";;",2)
"RTN","ORWDAL32",32,0)
 . I (ORSRC'=2),(ORSRC'=6) S CNT=CNT+1,Y(CNT)=ORSRC_U_ORSRC(ORSRC)_U_U_U_"TOP"_U_"+"
"RTN","ORWDAL32",33,0)
 . I ORSRC=1!(ORSRC=2) D
"RTN","ORWDAL32",34,0)
 .. I $D(@ROOT@(X)) D
"RTN","ORWDAL32",35,0)
 ... I ORSRC=1,X="OTHER ALLERGY/ADVERSE REACTION" Q  ;don't send this entry
"RTN","ORWDAL32",36,0)
 ... S ORIEN=$O(@ROOT@(X,0))
"RTN","ORWDAL32",37,0)
 ... I $L($T(SCREEN^XTID)) I $$SCREEN^XTID(120.82,.01,ORIEN_",") Q  ;233 Is term active?
"RTN","ORWDAL32",38,0)
 ... I ORSRC=2 S CNT=CNT+1,Y(CNT)=ORIEN_U_$P($G(^GMRD(120.82,+ORIEN,0)),U,1)_" <"_X_">"_ROOT
"RTN","ORWDAL32",39,0)
 ... I ORSRC'=2  S CNT=CNT+1,Y(CNT)=ORIEN_U_X_ROOT
"RTN","ORWDAL32",40,0)
 ... S Y(CNT)=Y(CNT)_U_$P($G(^GMRD(120.82,+Y(CNT),0)),U,2)_U_$S(ORSRC=2:1,1:ORSRC)
"RTN","ORWDAL32",41,0)
 .. S XP=X F  S XP=$O(@ROOT@(XP)) Q:XP=""  Q:$E(XP,1,$L(X))'=X  D
"RTN","ORWDAL32",42,0)
 ... I ORSRC=1,XP="OTHER ALLERGY/ADVERSE REACTION" Q  ;don't send this entry
"RTN","ORWDAL32",43,0)
 ... S ORIEN=$O(@ROOT@(XP,0))
"RTN","ORWDAL32",44,0)
 ... I $L($T(SCREEN^XTID)) I $$SCREEN^XTID(120.82,.01,ORIEN_",") Q  ;233 Is term active?
"RTN","ORWDAL32",45,0)
 ... I ORSRC=2 S CNT=CNT+1,Y(CNT)=ORIEN_U_$P($G(^GMRD(120.82,+ORIEN,0)),U,1)_" <"_XP_">"_ROOT ; partial matches
"RTN","ORWDAL32",46,0)
 ... I ORSRC'=2  S CNT=CNT+1,Y(CNT)=ORIEN_U_XP_ROOT
"RTN","ORWDAL32",47,0)
 ... S Y(CNT)=Y(CNT)_U_$P($G(^GMRD(120.82,+Y(CNT),0)),U,2)_U_$S(ORSRC=2:1,1:ORSRC)
"RTN","ORWDAL32",48,0)
 . I (ORSRC>2),(ORSRC'=4),(ORSRC'=5),(ORSRC'=6) D
"RTN","ORWDAL32",49,0)
 .. N CODE,LIST,VAL,NAME
"RTN","ORWDAL32",50,0)
 .. S CODE=$S(ORSRC=3:"S VAL=$$TGTOG2^PSNAPIS(X,.LIST)",ORSRC=4:"D TRDNAME(X,.LIST)",ORSRC=7:"D INGSRCH(X,.LIST)",ORSRC=8:"D CLASRCH(X,.LIST)",1:"") Q:'$L(CODE)
"RTN","ORWDAL32",51,0)
 .. X CODE I $D(LIST) S ORIEN=0 F  S ORIEN=$O(LIST(ORIEN)) Q:'ORIEN  D
"RTN","ORWDAL32",52,0)
 ... S NAME=$P(LIST(ORIEN),U,2)
"RTN","ORWDAL32",53,0)
 ... Q:$E($P(LIST(ORIEN),U,2),1,$L(X))'=X
"RTN","ORWDAL32",54,0)
 ... I $L($T(SCREEN^XTID)) I $$SCREEN^XTID($S(ORSRC=3:50.6,(ORSRC=4):50.6,ORSRC=7:50.416,ORSRC=8:50.605,1:0),.01,ORIEN_",") Q
"RTN","ORWDAL32",55,0)
 ... S CNT=CNT+1,Y(CNT)=ORIEN_U_NAME_ROOT_U_"D"_U_ORSRC
"RTN","ORWDAL32",56,0)
 . I ORSRC=4 D
"RTN","ORWDAL32",57,0)
 .. N CODE,LIST,VAL,NAME
"RTN","ORWDAL32",58,0)
 .. S CODE="D TRDNAME(X,.LIST)"
"RTN","ORWDAL32",59,0)
 .. X CODE I $D(LIST) S ORIEN=0 F  S ORIEN=$O(LIST(ORIEN)) Q:'ORIEN  D
"RTN","ORWDAL32",60,0)
 ... S NAME=$P(LIST(ORIEN),U,2)
"RTN","ORWDAL32",61,0)
 ... Q:$E($P(LIST(ORIEN),U,2),1,$L(X))'=X
"RTN","ORWDAL32",62,0)
 ... I $L($T(SCREEN^XTID)) I $$SCREEN^XTID(50.6,.01,+LIST(ORIEN)_",") Q
"RTN","ORWDAL32",63,0)
 ... S CNT=CNT+1,Y(CNT)=+LIST(ORIEN)_U_NAME_ROOT_U_"D"_U_ORSRC
"RTN","ORWDAL32",64,0)
 Q
"RTN","ORWDAL32",65,0)
FILENAME ; Display text of filenames for search treeview
"RTN","ORWDAL32",66,0)
 ;;VA Allergies File
"RTN","ORWDAL32",67,0)
 ;;VA Allergies File (Synonyms)  SPACER ONLY - NOT DISPLAYED
"RTN","ORWDAL32",68,0)
 ;;National Drug File - Generic Drug Name
"RTN","ORWDAL32",69,0)
 ;;National Drug file - Trade Name
"RTN","ORWDAL32",70,0)
 ;;Local Drug File
"RTN","ORWDAL32",71,0)
 ;;Local Drug File (Synonyms)  SPACER ONLY - NOT DISPLAYED
"RTN","ORWDAL32",72,0)
 ;;Drug Ingredients File
"RTN","ORWDAL32",73,0)
 ;;VA Drug Class File
"RTN","ORWDAL32",74,0)
 ;;
"RTN","ORWDAL32",75,0)
NATREACT ; Get the NATURE OF REACTION types
"RTN","ORWDAL32",76,0)
 ;Removing "R^Adverse Reaction" from choices below until we can add it as a choice in the nature of reaction/mechanism file
"RTN","ORWDAL32",77,0)
 F X="A^Allergy","P^Pharmacological","U^Unknown" D
"RTN","ORWDAL32",78,0)
 . S LST($$NXT)="i"_X
"RTN","ORWDAL32",79,0)
 Q
"RTN","ORWDAL32",80,0)
ALLGYTYP ; Get the allergy types
"RTN","ORWDAL32",81,0)
 F X="D^Drug","F^Food","O^Other","DF^Drug,Food","DO^Drug,Other","FO^Food,Other","DFO^Drug,Food,Other" D
"RTN","ORWDAL32",82,0)
 . S LST($$NXT)="i"_X
"RTN","ORWDAL32",83,0)
 Q
"RTN","ORWDAL32",84,0)
OBSHIST ; Observed or historical
"RTN","ORWDAL32",85,0)
 F X="o^Observed","h^Historical" D
"RTN","ORWDAL32",86,0)
 . S LST($$NXT)="i"_X
"RTN","ORWDAL32",87,0)
 Q
"RTN","ORWDAL32",88,0)
SEVERITY ; Severity
"RTN","ORWDAL32",89,0)
 F X="3^Severe","2^Moderate","1^Mild" D
"RTN","ORWDAL32",90,0)
 . S LST($$NXT)="i"_X
"RTN","ORWDAL32",91,0)
 Q
"RTN","ORWDAL32",92,0)
SYMPTOMS(Y,FROM,DIR) ; Return a subset of symptoms
"RTN","ORWDAL32",93,0)
 ; .Return Array, Starting Text, Direction
"RTN","ORWDAL32",94,0)
 N I,IEN,CNT,X,NAME,SUB S I=0,CNT=44 ;233
"RTN","ORWDAL32",95,0)
 K ^TMP($J,"SIGNS") ;233
"RTN","ORWDAL32",96,0)
 ;The following lines were added in 233.  Now accounts for synonyms
"RTN","ORWDAL32",97,0)
 M ^TMP($J,"SIGNS","B")=^GMRD(120.83,"B") ;233
"RTN","ORWDAL32",98,0)
 S SYN="" F  S SYN=$O(^GMRD(120.83,"D",SYN)) Q:SYN=""  S SUB=0 F  S SUB=$O(^GMRD(120.83,"D",SYN,SUB)) Q:'+SUB  D  ;233
"RTN","ORWDAL32",99,0)
 .S NAME=$P(^GMRD(120.83,SUB,0),U) S ^TMP($J,"SIGNS","B",(SYN_$C(9)_"<"_NAME_">"_U_NAME),SUB)="" ;233
"RTN","ORWDAL32",100,0)
 F  Q:I'<CNT  S FROM=$O(^TMP($J,"SIGNS","B",FROM),DIR) Q:FROM=""  D  ;233
"RTN","ORWDAL32",101,0)
 . I FROM="OTHER REACTION" Q  ;Don't send this entry
"RTN","ORWDAL32",102,0)
 . S IEN=0 F  S IEN=$O(^TMP($J,"SIGNS","B",FROM,IEN)) Q:'IEN  D  ;233
"RTN","ORWDAL32",103,0)
 . . I $L($T(SCREEN^XTID)) I $$SCREEN^XTID(120.83,.01,IEN_",") Q  ;233 Is term active
"RTN","ORWDAL32",104,0)
 . . S I=I+1
"RTN","ORWDAL32",105,0)
 . . S Y(I)=IEN_U_FROM
"RTN","ORWDAL32",106,0)
 Q
"RTN","ORWDAL32",107,0)
NXT() ; Increment index of LST
"RTN","ORWDAL32",108,0)
 S ILST=ILST+1
"RTN","ORWDAL32",109,0)
 Q ILST
"RTN","ORWDAL32",110,0)
EDITLOAD(Y,ORALIEN) ; Load an allergy/adverse reaction for editing
"RTN","ORWDAL32",111,0)
 Q:+$G(ORALIEN)=0
"RTN","ORWDAL32",112,0)
 N ORNODE,I
"RTN","ORWDAL32",113,0)
 S ORNODE=$NAME(^TMP("GMRA",$J)),I=0
"RTN","ORWDAL32",114,0)
 ;following patch check is made via GUI RPC call to ORWU PATCH instead
"RTN","ORWDAL32",115,0)
 ;I '$$PATCH^XPDUTL("GMRA*4.0*21") S @ORNODE@(0)="-1^Not yet implemented",Y=ORNODE Q
"RTN","ORWDAL32",116,0)
 D GETREC^GMRAGUI(ORALIEN,ORNODE)
"RTN","ORWDAL32",117,0)
 S Y=ORNODE
"RTN","ORWDAL32",118,0)
 Q
"RTN","ORWDAL32",119,0)
EDITSAVE(ORY,ORALIEN,ORDFN,OREDITED) ; Save Edit/Add of an allergy/adverse reaction
"RTN","ORWDAL32",120,0)
 ;following patch check is made via GUI RPC call to ORWU PATCH instead
"RTN","ORWDAL32",121,0)
 ;I '$$PATCH^XPDUTL("GMRA*4.0*21") S Y="-1^Not yet implemented" Q
"RTN","ORWDAL32",122,0)
 N ORNODE
"RTN","ORWDAL32",123,0)
 S ORNODE=$NAME(^TMP("GMRA",$J))
"RTN","ORWDAL32",124,0)
 K @ORNODE M @ORNODE=OREDITED
"RTN","ORWDAL32",125,0)
 S ORY=0
"RTN","ORWDAL32",126,0)
 I $G(@ORNODE@("GMRAERR"))="YES" D EIE^GMRAGUI1(ORALIEN,ORDFN,ORNODE) Q  ;Handle entered in error
"RTN","ORWDAL32",127,0)
 I $G(@ORNODE@("GMRANKA"))="YES" D NKA^GMRAGUI1 Q
"RTN","ORWDAL32",128,0)
 D UPDATE^GMRAGUI1(ORALIEN,ORDFN,ORNODE) Q  ;Add/edit reactions
"RTN","ORWDAL32",129,0)
 Q
"RTN","ORWDAL32",130,0)
SENDBULL(Y,ORDUZ,ORDFN,ORTEXT,ORCMTS) ; Send bulletin if user attempts free-text entry
"RTN","ORWDAL32",131,0)
 I '$D(ORCMTS) D
"RTN","ORWDAL32",132,0)
 . S Y=$$SENDREQ^GMRAPES0(ORDUZ,ORDFN,ORTEXT)
"RTN","ORWDAL32",133,0)
 E  D
"RTN","ORWDAL32",134,0)
 . S Y=$$SENDREQ^GMRAPES0(ORDUZ,ORDFN,ORTEXT,.ORCMTS)
"RTN","ORWDAL32",135,0)
 Q
"RTN","ORWDAL32",136,0)
INGSRCH(NAME,LIST) ;
"RTN","ORWDAL32",137,0)
 K ^TMP($J,"ORWDAL32")
"RTN","ORWDAL32",138,0)
 D NAME^PSN50P41(NAME,"ORWDAL32")
"RTN","ORWDAL32",139,0)
 I $D(^TMP($J,"ORWDAL32","P")) D
"RTN","ORWDAL32",140,0)
 . N I S I="" F  S I=$O(^TMP($J,"ORWDAL32","P",I)) Q:I=""  D
"RTN","ORWDAL32",141,0)
 .. N J S J=0 F  S J=$O(^TMP($J,"ORWDAL32","P",I,J)) Q:'J  S LIST(J)=J_U_I
"RTN","ORWDAL32",142,0)
 K ^TMP($J,"ORWDAL32")
"RTN","ORWDAL32",143,0)
 Q
"RTN","ORWDAL32",144,0)
CLASRCH(NAME,LIST) ;
"RTN","ORWDAL32",145,0)
 K ^TMP($J,"ORWDAL32")
"RTN","ORWDAL32",146,0)
 D C^PSN50P65(,NAME,"ORWDAL32")
"RTN","ORWDAL32",147,0)
 I $D(^TMP($J,"ORWDAL32","C")) D
"RTN","ORWDAL32",148,0)
 . N I S I="" F  S I=$O(^TMP($J,"ORWDAL32","C",I)) Q:I=""  D
"RTN","ORWDAL32",149,0)
 .. N J S J=0 F  S J=$O(^TMP($J,"ORWDAL32","C",I,J)) Q:'J  S LIST(J)=J_U_$G(^TMP($J,"ORWDAL32",J,1))
"RTN","ORWDAL32",150,0)
 K ^TMP($J,"ORWDAL32")
"RTN","ORWDAL32",151,0)
 Q
"RTN","ORWDAL32",152,0)
TRDNAME(NAME,LIST) ;
"RTN","ORWDAL32",153,0)
 K ^TMP($J,"ORWDAL32")
"RTN","ORWDAL32",154,0)
 D ALL^PSN5067(,NAME,,"ORWDAL32")
"RTN","ORWDAL32",155,0)
 I $D(^TMP($J,"ORWDAL32","B")) D
"RTN","ORWDAL32",156,0)
 . N I S I="" F  S I=$O(^TMP($J,"ORWDAL32","B",I)) Q:I=""  D
"RTN","ORWDAL32",157,0)
 .. N J,K S J=$O(^TMP($J,"ORWDAL32","B",I,0)) Q:'J  S K=$$TGTOG^PSNAPIS(I),LIST(J)=K_U_$G(^TMP($J,"ORWDAL32",J,4))
"RTN","ORWDAL32",158,0)
 K ^TMP($J,"ORWDAL32")
"RTN","ORWDAL32",159,0)
 Q
"RTN","ORWDBA1")
0^39^B58828931
"RTN","ORWDBA1",1,0)
ORWDBA1 ;; SLC OIFO/DKK/GSS - Order Dialogs Billing Awareness;[10/21/03 3:16pm]
"RTN","ORWDBA1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**190,195,229,215,243**;Dec 17, 1997;Build 242
"RTN","ORWDBA1",3,0)
 ;
"RTN","ORWDBA1",4,0)
 ; External References
"RTN","ORWDBA1",5,0)
 ;   DBIA    406  CL^SDCO21 - call to determine Treatment Factors
"RTN","ORWDBA1",6,0)
 ;
"RTN","ORWDBA1",7,0)
 ;Ref to ^DIC(9.4 - DBIA ___
"RTN","ORWDBA1",8,0)
 ;BA refers to Billing Awareness Project
"RTN","ORWDBA1",9,0)
 ;CIDC refers to Clinical Indicator Data Capture (same project 3/10/2004)
"RTN","ORWDBA1",10,0)
 ;Treatment Factors (TxF) refer to SC,AO,IR,EC,MST,HNC,CV,SHD
"RTN","ORWDBA1",11,0)
 ;
"RTN","ORWDBA1",12,0)
GETORDX(Y,ORIEN) ; Retrieve Diagnoses for an order - RPC
"RTN","ORWDBA1",13,0)
 ; Input:
"RTN","ORWDBA1",14,0)
 ;   ORIEN    Order Internal ID#
"RTN","ORWDBA1",15,0)
 ; Output:
"RTN","ORWDBA1",16,0)
 ;   Y        Array of Diagnoses (Dx) - Y(#)=#^DxInt#^ICD9^DxDesc^TxF
"RTN","ORWDBA1",17,0)
 ; Variables used:
"RTN","ORWDBA1",18,0)
 ;   CT       Counter for # of Dx related to order
"RTN","ORWDBA1",19,0)
 ;   DXIEN    Dx internal ID
"RTN","ORWDBA1",20,0)
 ;   DXN      Internal (to ^OR(100)) sequence # for Dx storage
"RTN","ORWDBA1",21,0)
 ;   DXREC    Dx record from Order file
"RTN","ORWDBA1",22,0)
 ;   DXV      Dx description
"RTN","ORWDBA1",23,0)
 ;   ICD9     External ICD9 #
"RTN","ORWDBA1",24,0)
 ;   TXFACTRS Treatment Factors (TxF)
"RTN","ORWDBA1",25,0)
 ;
"RTN","ORWDBA1",26,0)
 N CT,DXIEN,DXN,DXREC,DXV,ICD9,ICDR,ORFMDAT,TXFACTRS
"RTN","ORWDBA1",27,0)
 S (CT,DXN)=0
"RTN","ORWDBA1",28,0)
 I '$G(^OR(100,ORIEN,0)) S Y=-1
"RTN","ORWDBA1",29,0)
 I '$D(^OR(100,ORIEN,5.1,1,0)) S Y=0
"RTN","ORWDBA1",30,0)
 E  D  S Y=CT
"RTN","ORWDBA1",31,0)
 . ; Get order date for CSV/CTD/HIPAA usage
"RTN","ORWDBA1",32,0)
 . S ORFMDAT=$$ORFMDAT^ORWDBA3(ORIEN)
"RTN","ORWDBA1",33,0)
 . ; Go through all Dx's for an order
"RTN","ORWDBA1",34,0)
 . F  S DXN=$O(^OR(100,ORIEN,5.1,DXN)) Q:DXN'?1N.N  D
"RTN","ORWDBA1",35,0)
 .. ; Get diagnosis record and IEN
"RTN","ORWDBA1",36,0)
 .. S DXREC=$G(^OR(100,ORIEN,5.1,DXN,0)),DXIEN=$P(DXREC,U)
"RTN","ORWDBA1",37,0)
 .. S ICDR=$$ICDDX^ICDCODE($G(DXIEN),ORFMDAT)
"RTN","ORWDBA1",38,0)
 .. S DXV=$P(ICDR,U,4),ICD9=$P(ICDR,U,2)
"RTN","ORWDBA1",39,0)
 .. ; Convert internal to external Treatment Factors
"RTN","ORWDBA1",40,0)
 .. S TXFACTRS=$$TFGBLGUI(^OR(100,ORIEN,5.2))
"RTN","ORWDBA1",41,0)
 .. S CT=CT+1,Y(CT)=DXN_U_$G(DXIEN)_U_ICD9_U_DXV_U_TXFACTRS
"RTN","ORWDBA1",42,0)
 Q
"RTN","ORWDBA1",43,0)
 ;
"RTN","ORWDBA1",44,0)
SCLST(Y,DFN,ORLST) ; RPC for compiling appropriate TxF's
"RTN","ORWDBA1",45,0)
 ; RPC titled ORWDBA1 SCLST
"RTN","ORWDBA1",46,0)
 ;
"RTN","ORWDBA1",47,0)
 ;  Y       =    Returned value
"RTN","ORWDBA1",48,0)
 ;  DFN     =    Patient IEN
"RTN","ORWDBA1",49,0)
 ;  ORLST   =    List of orders
"RTN","ORWDBA1",50,0)
 ;
"RTN","ORWDBA1",51,0)
 ; call for BA/TF
"RTN","ORWDBA1",52,0)
 N GMRCPROS,ORD,ORI,ORPKG
"RTN","ORWDBA1",53,0)
 D CPLSTBA(.Y,DFN,.ORLST)
"RTN","ORWDBA1",54,0)
 Q
"RTN","ORWDBA1",55,0)
 ;
"RTN","ORWDBA1",56,0)
CPLSTBA(TEST,PTIFN,ORIFNS) ; set-up SC/TFs for BA
"RTN","ORWDBA1",57,0)
 ;
"RTN","ORWDBA1",58,0)
 ;  TEST    =  Returned value
"RTN","ORWDBA1",59,0)
 ;  PTIFN   =  Patient IEN
"RTN","ORWDBA1",60,0)
 ;  ORIFNS  =  List of orders
"RTN","ORWDBA1",61,0)
 ;
"RTN","ORWDBA1",62,0)
 S ORI=""
"RTN","ORWDBA1",63,0)
 ;
"RTN","ORWDBA1",64,0)
 ; define array of packages for which BA data collected (SC/CIs)
"RTN","ORWDBA1",65,0)
 ;  GMRC    =  Consult/Request Tracking (#128) - Prosthetics
"RTN","ORWDBA1",66,0)
 ;  LR      =  Lab Services (#26) - Lab
"RTN","ORWDBA1",67,0)
 ;  PSO     =  Outpt Pharmacy (#112) - Outpt Pharmacy (orig. Co-Pay)
"RTN","ORWDBA1",68,0)
 ;  RA      =  Radiology/Nuclear Medicine (#31) - Radiology
"RTN","ORWDBA1",69,0)
 ;
"RTN","ORWDBA1",70,0)
 S ORPKG(+$O(^DIC(9.4,"C","PSO",0)))=1
"RTN","ORWDBA1",71,0)
 ; See ISWITCH^ORWDBA7 for insurance/Ed switch, i.e., $$CIDC^IBBAPI
"RTN","ORWDBA1",72,0)
 ; Also check provider switch via 'OR BILLING AWARENESS BY USER'
"RTN","ORWDBA1",73,0)
 I $$BASTAT&$$CIDC^IBBAPI(DFN)&$$GET^XPAR(DUZ_";VA(200,","OR BILLING AWARENESS BY USER",1,"Q") F I=1:1 S ORPKG=$P("GMRC;LR;RA",";",I) Q:ORPKG=""  D
"RTN","ORWDBA1",74,0)
 . S ORPKG(+$O(^DIC(9.4,"C",ORPKG,0)))=1  ; ^DIC(9.4) is package file
"RTN","ORWDBA1",75,0)
 ;
"RTN","ORWDBA1",76,0)
 ; get Treatment Factors (TxF) for patient
"RTN","ORWDBA1",77,0)
 D SCPRE(.DR,DFN)
"RTN","ORWDBA1",78,0)
 ;
"RTN","ORWDBA1",79,0)
 ; set TxF's if order is for a package for which BA data is collected
"RTN","ORWDBA1",80,0)
 F  S ORI=$O(ORLST(ORI)) Q:'ORI  S ORD=+ORLST(ORI) D
"RTN","ORWDBA1",81,0)
 . I $G(^OR(100,ORD,0))="" Q
"RTN","ORWDBA1",82,0)
 . I $P($G(^OR(100,ORD,0)),U,14)="" Q
"RTN","ORWDBA1",83,0)
 . I $D(TEST(ORD))!'$D(ORPKG($P($G(^OR(100,ORD,0)),U,14))) Q
"RTN","ORWDBA1",84,0)
 . I $E($P(ORIFNS(ORI),";",2))>1 Q  ;canceled order (2) & ? (3)
"RTN","ORWDBA1",85,0)
 . S TEST(ORD)=ORLST(ORI)_DR
"RTN","ORWDBA1",86,0)
 Q
"RTN","ORWDBA1",87,0)
 ;
"RTN","ORWDBA1",88,0)
SCPRE(DR,DFN) ; Dialog validation, to ask BA questions
"RTN","ORWDBA1",89,0)
 ;
"RTN","ORWDBA1",90,0)
 ;  DR    =  return value
"RTN","ORWDBA1",91,0)
 ;  DFN   =  input patient IEN
"RTN","ORWDBA1",92,0)
 ;
"RTN","ORWDBA1",93,0)
 Q:$G(DFN)=""
"RTN","ORWDBA1",94,0)
 N CPNODE,CT,I,ORX,ORSDCARY,TF,X
"RTN","ORWDBA1",95,0)
 K ORSDCARY
"RTN","ORWDBA1",96,0)
 S (CPNODE,DR,ORX,TF)="",CT=0,X="T"
"RTN","ORWDBA1",97,0)
 ; Call API to acquire Treatment Factors in force
"RTN","ORWDBA1",98,0)
 D NOW^%DTC,CL^SDCO21(DFN,%,"",.ORSDCARY)  ;DBIA 406
"RTN","ORWDBA1",99,0)
 ; Retrved array order: AO,IR,SC,EC,MST,HNC,CV,SHD e.g., ORSDCARY(3) for SC
"RTN","ORWDBA1",100,0)
 ; Convert to ^OR/CPRS GUI order: SC,MST,AO,IR,EC,HNC,CV,SHD
"RTN","ORWDBA1",101,0)
 F I=3,5,1,2,4,6,7,8 S TF=0,CT=CT+1 S:$D(ORSDCARY(I)) TF=1 S $P(CPNODE,U,CT)=TF
"RTN","ORWDBA1",102,0)
 ;
"RTN","ORWDBA1",103,0)
 S X=$S($P(CPNODE,U)=1:"SC",1:""),DR=$S($L(X):DR_U_X,1:DR)
"RTN","ORWDBA1",104,0)
 S X=$S($P(CPNODE,U,2)=1:"MST",1:""),DR=$S($L(X):DR_U_X,1:DR)
"RTN","ORWDBA1",105,0)
 S X=$S($P(CPNODE,U,3)=1:"AO",1:""),DR=$S($L(X):DR_U_X,1:DR)
"RTN","ORWDBA1",106,0)
 S X=$S($P(CPNODE,U,4)=1:"IR",1:""),DR=$S($L(X):DR_U_X,1:DR)
"RTN","ORWDBA1",107,0)
 S X=$S($P(CPNODE,U,5)=1:"EC",1:""),DR=$S($L(X):DR_U_X,1:DR)
"RTN","ORWDBA1",108,0)
 S X=$S($P(CPNODE,U,6)=1:"HNC",1:""),DR=$S($L(X):DR_U_X,1:DR)
"RTN","ORWDBA1",109,0)
 S X=$S($P(CPNODE,U,7)=1:"CV",1:""),DR=$S($L(X):DR_U_X,1:DR)
"RTN","ORWDBA1",110,0)
 S X=$S($P(CPNODE,U,8)=1:"SHD",1:""),DR=$S($L(X):DR_U_X,1:DR)
"RTN","ORWDBA1",111,0)
 ;
"RTN","ORWDBA1",112,0)
 ; TxF's for patient (TxF's include SC,AO,IR,EC,MST,HNC,CV,SHD) where
"RTN","ORWDBA1",113,0)
 ;  SC      =  Service Connected
"RTN","ORWDBA1",114,0)
 ;  AO      =  Agent Orange
"RTN","ORWDBA1",115,0)
 ;  IR      =  Ionizing Radiation
"RTN","ORWDBA1",116,0)
 ;  EC      =  Environmental Contaminants
"RTN","ORWDBA1",117,0)
 ;  MST     =  Military Sexual Trauma
"RTN","ORWDBA1",118,0)
 ;  HNC     =  Head and Neck Cancer
"RTN","ORWDBA1",119,0)
 ;  CV      =  Combat Veteran
"RTN","ORWDBA1",120,0)
 ;  SHD     =  Shipboard Disability
"RTN","ORWDBA1",121,0)
 F I="SC","AO","IR","EC","MST","HNC","CV","SHD" D
"RTN","ORWDBA1",122,0)
 . I $D(ORX(I)) S DR=DR_U_I_$S($L(ORX(I)):";"_ORX(I),1:"")
"RTN","ORWDBA1",123,0)
 Q
"RTN","ORWDBA1",124,0)
 ;
"RTN","ORWDBA1",125,0)
ORPKGTYP(Y,ORLST) ; Build BA supported packages array
"RTN","ORWDBA1",126,0)
 ; GMRC=Prosthetics, LR=Lab, PSO=Pharmacy, RA=Radiology
"RTN","ORWDBA1",127,0)
 N OIREC,OIV,OIVN
"RTN","ORWDBA1",128,0)
 ;
"RTN","ORWDBA1",129,0)
 F I=1:1 S ORPKG=$P("GMRC;LR;PSO;RA",";",I) Q:ORPKG=""  D
"RTN","ORWDBA1",130,0)
 . S ORPKG(+$O(^DIC(9.4,"C",ORPKG,0)))=ORPKG  ; ^DIC(9.4) is package file
"RTN","ORWDBA1",131,0)
 ;
"RTN","ORWDBA1",132,0)
 S GMRCPROS=+$O(^DIC(9.4,"C","GMRC",0))
"RTN","ORWDBA1",133,0)
 ; see if order is for a package which BA supports
"RTN","ORWDBA1",134,0)
 D ORPKG1(.Y,.ORLST)
"RTN","ORWDBA1",135,0)
 Q
"RTN","ORWDBA1",136,0)
 ;
"RTN","ORWDBA1",137,0)
ORPKG1(TEST,ORIFNS) ; Order for package BA supports?  TEST(ORI)=1 is YES
"RTN","ORWDBA1",138,0)
 S U="^",ORI=""
"RTN","ORWDBA1",139,0)
 F I=1:1:5 S OIV(I)=$P("PROSTHETICS REQUEST^EYEGLASS REQUEST^CONTACT LENS REQUEST^HOME OXYGEN REQUEST^AMPUTEE/PROSTHETICS CLINIC",U,I)
"RTN","ORWDBA1",140,0)
 F  S ORI=$O(ORIFNS(ORI)) Q:'ORI  S ORD=+ORIFNS(ORI),TEST(ORI)=0 D
"RTN","ORWDBA1",141,0)
 . I ORD=0 Q  ;document/note not an order
"RTN","ORWDBA1",142,0)
 . ;I ORD="CONSULT_DX" S TEST(ORI)=1 Q  ;consult dx prev entered
"RTN","ORWDBA1",143,0)
 . I '$D(^OR(100,ORD,0)) Q  ;invalid order #
"RTN","ORWDBA1",144,0)
 . I $P(^OR(100,ORD,0),U,14)'?1N.N Q  ;invalid order # or entry
"RTN","ORWDBA1",145,0)
 . I $E($P(ORIFNS(ORI),";",2))>1 Q  ;canceled order (2) & ? (3)
"RTN","ORWDBA1",146,0)
 . I $D(^OR(100,ORD,5.1,1,0)) S TEST(ORI)=1 Q  ;
"RTN","ORWDBA1",147,0)
 . I '$D(ORPKG($P(^OR(100,ORD,0),U,14))) Q  ;pkg not supported
"RTN","ORWDBA1",148,0)
 . ;      IPt OPt (ask BA questions?)
"RTN","ORWDBA1",149,0)
 . ; Pros  Y   Y   GMRC
"RTN","ORWDBA1",150,0)
 . ; Rad   Y   Y   RA
"RTN","ORWDBA1",151,0)
 . ; Lab   N   Y   LR
"RTN","ORWDBA1",152,0)
 . ; Phrm  Y   Y   PSO
"RTN","ORWDBA1",153,0)
 . ; Pt Class = 'I' or 'O' in ^OR
"RTN","ORWDBA1",154,0)
 . I $P(^OR(100,ORD,0),U,12)="I"&(ORPKG($P(^OR(100,ORD,0),U,14))="LR") Q
"RTN","ORWDBA1",155,0)
 . I $P(^OR(100,ORD,0),U,14)=GMRCPROS D  Q  ;check for Pros consult order
"RTN","ORWDBA1",156,0)
 .. S OIREC=$G(^ORD(101.43,$G(^OR(100,ORD,4.5,1,1)),0)),OIVN=""
"RTN","ORWDBA1",157,0)
 .. F  S OIVN=$O(OIV(OIVN)) Q:OIVN=""  I OIV(OIVN)=$E($P(OIREC,U),1,$L(OIV(OIVN))) S TEST(ORI)=1 Q
"RTN","ORWDBA1",158,0)
 . S TEST(ORI)=1  ;order is for a supported pkg (also note Pros ck above)
"RTN","ORWDBA1",159,0)
 Q
"RTN","ORWDBA1",160,0)
 ;
"RTN","ORWDBA1",161,0)
BASTATUS(Y) ;RPC to retrieve the status of the Billing Awareness software
"RTN","ORWDBA1",162,0)
 ;   Y  =  Returned Value (1=BA usable, 0=BA not-usable)
"RTN","ORWDBA1",163,0)
 ; Check for installation of CIDC ancillary build
"RTN","ORWDBA1",164,0)
 S Y=$D(^XPD(9.7,"B","PX CLINICAL INDICATOR DATA CAPTURE 1.0"))
"RTN","ORWDBA1",165,0)
 Q:'Y
"RTN","ORWDBA1",166,0)
 ; Check if system parameter switch set
"RTN","ORWDBA1",167,0)
 S Y=$$CHKPS1^ORWDBA5
"RTN","ORWDBA1",168,0)
 Q
"RTN","ORWDBA1",169,0)
 ;
"RTN","ORWDBA1",170,0)
BASTAT() ; Internal version of BASTATUS
"RTN","ORWDBA1",171,0)
 ; Returns 0 if disabled or 1 if enabled
"RTN","ORWDBA1",172,0)
 Q $$CHKPS1^ORWDBA5
"RTN","ORWDBA1",173,0)
 ;
"RTN","ORWDBA1",174,0)
RCVORCI(Y,DIAG) ;Receive order related Clinical Indicators & Diagnoses from GUI
"RTN","ORWDBA1",175,0)
 ; Store data in ^OR(100,ODN,5.1) & ^OR(100,0DN,5.2)
"RTN","ORWDBA1",176,0)
 ;
"RTN","ORWDBA1",177,0)
 N DXIEN,ODN,ORIEN,SCI,OCDXCT,OCT
"RTN","ORWDBA1",178,0)
 S ODN="",OCDXCT=0,Y=""
"RTN","ORWDBA1",179,0)
 F  S ODN=$O(DIAG(ODN)) Q:ODN=""  D
"RTN","ORWDBA1",180,0)
 . S ORIEN=$P(DIAG(ODN),";",1)  ;Order IEN
"RTN","ORWDBA1",181,0)
 . I ORIEN'?1N.N S Y=0 Q
"RTN","ORWDBA1",182,0)
 . K ^OR(100,ORIEN,5.1) ;Clear currently stored diagnosis for rewrite
"RTN","ORWDBA1",183,0)
 . ; Data from Delphi format: ORIEN;11CNNNCNN^exDx1^exDx2^exDx3^exDx4
"RTN","ORWDBA1",184,0)
 . ; Convert 8 Tx Factors
"RTN","ORWDBA1",185,0)
 . S SCI=$$TFGUIGBL($RE($E($RE($P(DIAG(ODN),U)),1,8)))
"RTN","ORWDBA1",186,0)
 . S ^OR(100,ORIEN,5.2)=SCI  ;Store TFs (SC,MST,AO,IR,EC,HNC,CV,SHD)
"RTN","ORWDBA1",187,0)
 . ; Get order date for CSV/CTD/HIPAA
"RTN","ORWDBA1",188,0)
 . S ORFMDAT=$$ORFMDAT^ORWDBA3(ORIEN)
"RTN","ORWDBA1",189,0)
 . ; Go through the diagnoses entered
"RTN","ORWDBA1",190,0)
 . F OCT=2:1 Q:$P(DIAG(ODN),U,OCT)=""  D
"RTN","ORWDBA1",191,0)
 .. S DXIEN=$P($$ICDDX^ICDCODE($P(DIAG(ODN),U,OCT),ORFMDAT),U,1)  ;Dx IEN
"RTN","ORWDBA1",192,0)
 .. I DXIEN=-1!(DXIEN="") Q  ;No or invalid code passed in
"RTN","ORWDBA1",193,0)
 .. S OCDXCT=OCDXCT+1
"RTN","ORWDBA1",194,0)
 .. S ^OR(100,ORIEN,5.1,0)="^100.051PA^"_OCDXCT_U_OCDXCT ;Set 5.1 zero node
"RTN","ORWDBA1",195,0)
 .. S ^OR(100,ORIEN,5.1,OCDXCT,0)=DXIEN  ;Store a diagnosis for order
"RTN","ORWDBA1",196,0)
 .. S ^OR(100,ORIEN,5.1,"B",DXIEN,OCDXCT)="" ;Index diagnosis for order
"RTN","ORWDBA1",197,0)
 S:Y="" Y=1
"RTN","ORWDBA1",198,0)
 Q
"RTN","ORWDBA1",199,0)
 ;
"RTN","ORWDBA1",200,0)
TFSTGS ; Set Treatment Factor strings sequence order
"RTN","ORWDBA1",201,0)
 ; TFGBL is order of TxFs in ^OR(100,ORIEN,5) & ^OR(100,ORIEN,5.2)
"RTN","ORWDBA1",202,0)
 ; TFGUI is order of TxFs to/from GUI
"RTN","ORWDBA1",203,0)
 ; TFTBL is order of TxFs for table SD008 (used in ZCL segment)
"RTN","ORWDBA1",204,0)
 ; NOTE: change examples in TFGUIGBL and TFGBLGUI if order changed
"RTN","ORWDBA1",205,0)
 S TFGBL="SC^MST^AO^IR^EC^HNC^CV^SHD"
"RTN","ORWDBA1",206,0)
 S TFGUI="SC^AO^IR^EC^MST^HNC^CV^SHD"
"RTN","ORWDBA1",207,0)
 S TFTBL="AO^IR^SC^EC^MST^HNC^CV^SHD"
"RTN","ORWDBA1",208,0)
 Q
"RTN","ORWDBA1",209,0)
 ;
"RTN","ORWDBA1",210,0)
TFGUIGBL(GUI) ;Convert Treatment Factors from GUI to Global order & format
"RTN","ORWDBA1",211,0)
 ;
"RTN","ORWDBA1",212,0)
 ; Input:  GUI in CNU?NCU: C=checked, N=not checked, U=unchecked
"RTN","ORWDBA1",213,0)
 ; Output: GBL in 1^^^0^?^1^0^ (global) format (reordered for storage)
"RTN","ORWDBA1",214,0)
 ;
"RTN","ORWDBA1",215,0)
 N GBL,J,NTF,TF,TFGBL,TFGUI,TFTBL
"RTN","ORWDBA1",216,0)
 S GBL="",NTF=8  ;NTF=# of Treatment Factors (TxF)
"RTN","ORWDBA1",217,0)
 ;I $L(GUI)'=NTF Q -1  ;invalid # of TxF
"RTN","ORWDBA1",218,0)
 ; Get Treatment Factor sequence order strings
"RTN","ORWDBA1",219,0)
 D TFSTGS
"RTN","ORWDBA1",220,0)
 ; Convert from GBL to GUI format and sequence
"RTN","ORWDBA1",221,0)
 F J=1:1:NTF S TF=$E(GUI,J) D
"RTN","ORWDBA1",222,0)
 . S TF($P(TFGUI,U,J))=$S(TF="C":1,TF="U":0,TF="?":"?",1:"")
"RTN","ORWDBA1",223,0)
 F J=1:1:NTF S GBL=GBL_U_TF($P(TFGBL,U,J))
"RTN","ORWDBA1",224,0)
 Q $P(GBL,U,2,NTF+1)
"RTN","ORWDBA1",225,0)
 ;
"RTN","ORWDBA1",226,0)
TFGBLGUI(GBL) ;Convert Treatment Factors from Global to GUI order & format
"RTN","ORWDBA1",227,0)
 ;
"RTN","ORWDBA1",228,0)
 ; Input:  GBL in 1^0^1^1^^0^?^ (global) format
"RTN","ORWDBA1",229,0)
 ; Output: GUI in CCCNUU? (GUI) format (also reordered)
"RTN","ORWDBA1",230,0)
 ;
"RTN","ORWDBA1",231,0)
 N GUI,J,NTF,TF,TFGBL,TFGUI,TFTBL
"RTN","ORWDBA1",232,0)
 S GUI="",NTF=8  ;NCI=# of TxF
"RTN","ORWDBA1",233,0)
 ; Get Treatment Factor sequence order strings
"RTN","ORWDBA1",234,0)
 D TFSTGS
"RTN","ORWDBA1",235,0)
 ; Convert from GUI to GBL format and sequence
"RTN","ORWDBA1",236,0)
 F J=1:1:NTF S TF=$P(GBL,U,J) D
"RTN","ORWDBA1",237,0)
 . S TF($P(TFGBL,U,J))=$S(TF=1:"C",TF=0:"U",TF="?":"?",1:"N")
"RTN","ORWDBA1",238,0)
 F J=1:1:NTF S GUI=GUI_TF($P(TFGUI,U,J))
"RTN","ORWDBA1",239,0)
 Q GUI
"RTN","ORWDBA1",240,0)
 ;
"RTN","ORWDBA1",241,0)
PRVKEY(X) ;Check for active & provider key - to be deleted in CPRS v26
"RTN","ORWDBA1",242,0)
 N PTD
"RTN","ORWDBA1",243,0)
 Q:'+$G(X) 0
"RTN","ORWDBA1",244,0)
 Q:$G(^VA(200,X,0))="" 0
"RTN","ORWDBA1",245,0)
 S PTD=+$P(^VA(200,X,0),"^",11)
"RTN","ORWDBA1",246,0)
 I $$DT^XLFDT'<PTD,PTD>0 Q 0
"RTN","ORWDBA1",247,0)
 Q:$D(^XUSEC("PROVIDER",X)) 1
"RTN","ORWDBA1",248,0)
 Q 0
"RTN","ORWDBA1",249,0)
 ;
"RTN","ORWDBA1",250,0)
ORESKEY(X) ;Does 'X' hold ORES key, returns: 1=true, 0=false
"RTN","ORWDBA1",251,0)
 Q:'+$G(X) 0
"RTN","ORWDBA1",252,0)
 Q:$D(^XUSEC("ORES",X)) 1
"RTN","ORWDBA1",253,0)
 Q 0
"RTN","ORWDBA3")
0^40^B40638555
"RTN","ORWDBA3",1,0)
ORWDBA3 ; SLC/GSS Billing Awareness (CIDC) [8/20/03 9:19am]
"RTN","ORWDBA3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**190,195,243**;Dec 17, 1997;Build 242
"RTN","ORWDBA3",3,0)
 ;
"RTN","ORWDBA3",4,0)
ORFMDAT(ORDFN) ; Return date in FM format regarding order for CSV/CTD/HIPAA
"RTN","ORWDBA3",5,0)
 ; Pass in Order IEN
"RTN","ORWDBA3",6,0)
 Q ($P($G(^OR(100,ORDFN,8,1,0)),"^",16)\1)
"RTN","ORWDBA3",7,0)
 ;
"RTN","ORWDBA3",8,0)
DISPLAY ; Display of BA data from original copied order (ORIT = ORIEN)
"RTN","ORWDBA3",9,0)
 ; Displayed in window with all order info and user can accept/edit
"RTN","ORWDBA3",10,0)
 ; Note: TxF = Treatment Factor
"RTN","ORWDBA3",11,0)
 ; BA data (Dx,TxF's) not editable but in signature window, not in above
"RTN","ORWDBA3",12,0)
 ; ORIT defined in ORWDXM1, DISPLAY called from ORWDXM2
"RTN","ORWDBA3",13,0)
 ;
"RTN","ORWDBA3",14,0)
 ; Input:
"RTN","ORWDBA3",15,0)
 ;  ORIT, ILST, and LST() from ORWDXM* routines
"RTN","ORWDBA3",16,0)
 ; Output:
"RTN","ORWDBA3",17,0)
 ;  ILST and LST() appropriately incremented/populated for order display
"RTN","ORWDBA3",18,0)
 ; Variables:
"RTN","ORWDBA3",19,0)
 ;  CUN     = TxF's in C, U, or N format
"RTN","ORWDBA3",20,0)
 ;  I       = counter
"RTN","ORWDBA3",21,0)
 ;  ILST    = line counter, initially from ORWDXM* routines
"RTN","ORWDBA3",22,0)
 ;  LST()   = array of lines to output, initially from ORWDXM* routines
"RTN","ORWDBA3",23,0)
 ;  NTF     = # of Treatment Factors
"RTN","ORWDBA3",24,0)
 ;  ORITARY = ORIT array of 1 needed to access GETTFCI^ORWDBA4
"RTN","ORWDBA3",25,0)
 ;  SPCS    = # of characters to space to left of ':'
"RTN","ORWDBA3",26,0)
 ;  TF1     = first TxF output? (0/1)
"RTN","ORWDBA3",27,0)
 ;  TFGBL   = TxF's in Global stored order
"RTN","ORWDBA3",28,0)
 ;  TFGUI   = TxF's in GUI returned order
"RTN","ORWDBA3",29,0)
 ;  TFV     = TxF verbiage
"RTN","ORWDBA3",30,0)
 ;
"RTN","ORWDBA3",31,0)
 N CUN,I,NTF,ORITARY,SPCS,TF1,TFGBL,TFGUI,TFV,Y
"RTN","ORWDBA3",32,0)
 S NTF=8,SPCS=28,ORITARY(1)=+ORIT
"RTN","ORWDBA3",33,0)
 ; Get Y(+ORIT) string in ORIEN^CUUUCCN^Dx1^Desc1^Dx2^Desc2^... format
"RTN","ORWDBA3",34,0)
 D GETTFCI^ORWDBA4(.Y,.ORITARY)
"RTN","ORWDBA3",35,0)
 S CUN=$P($G(Y(1)),U,2)  ;CUN = Treatment Factors in CUN syntax
"RTN","ORWDBA3",36,0)
 ; First output Diagnosis information - if any
"RTN","ORWDBA3",37,0)
 F I=3:2:9 I $P($G(Y(1)),U,I)'="" D
"RTN","ORWDBA3",38,0)
 . S ILST=ILST+1,LST(ILST)=$S(I=3:"Diagnoses",1:"")
"RTN","ORWDBA3",39,0)
 . S LST(ILST)=LST(ILST)_":"_$P(Y(1),U,I)_" - "_$P(Y(1),U,I+1)
"RTN","ORWDBA3",40,0)
 . D FRMTLST
"RTN","ORWDBA3",41,0)
 ; Get GUI and GBL Treatment Factor sequence strings
"RTN","ORWDBA3",42,0)
 D TFSTGS^ORWDBA1
"RTN","ORWDBA3",43,0)
 ; Assumes SC will always be first in sequence! - not likely to change
"RTN","ORWDBA3",44,0)
 S ILST=ILST+1
"RTN","ORWDBA3",45,0)
 S LST(ILST)="Service Connected:"_$S($E(CUN)="C":"YES",1:"NO")
"RTN","ORWDBA3",46,0)
 D FRMTLST
"RTN","ORWDBA3",47,0)
 S ILST=ILST+1,LST(ILST)="Treatment Factors:"
"RTN","ORWDBA3",48,0)
 ; If no TxF's (no 'C'hecked) {SC output above} then output '<none>'
"RTN","ORWDBA3",49,0)
 I '$F($E(CUN,2,NTF),"C") S LST(ILST)=LST(ILST)_"<none>" D FRMTLST Q
"RTN","ORWDBA3",50,0)
 S TF1=0  ;No TxF yet output
"RTN","ORWDBA3",51,0)
 ; Verbiage for TxF's
"RTN","ORWDBA3",52,0)
 S TFV("MST")="MILITARY SEXUAL TRAUMA",TFV("AO")="AGENT ORANGE"
"RTN","ORWDBA3",53,0)
 S TFV("IR")="IONIZING RADIATION",TFV("EC")="ENVIRONMENTAL CONTAMINANTS"
"RTN","ORWDBA3",54,0)
 S TFV("HNC")="HEAD AND NECK CANCER",TFV("CV")="COMBAT VETERAN"
"RTN","ORWDBA3",55,0)
 S TFV("SHD")="SHIPBOARD HAZARD"
"RTN","ORWDBA3",56,0)
 ; Output Checked TxF's
"RTN","ORWDBA3",57,0)
 F I=2:1:NTF I $E(CUN,I)="C" D
"RTN","ORWDBA3",58,0)
 . I 'TF1 S LST(ILST)=LST(ILST)_TFV($P(TFGUI,U,I)),TF1=1 D FRMTLST Q
"RTN","ORWDBA3",59,0)
 . S ILST=ILST+1,LST(ILST)=":"_TFV($P(TFGUI,U,I)) D FRMTLST
"RTN","ORWDBA3",60,0)
 Q
"RTN","ORWDBA3",61,0)
 ;
"RTN","ORWDBA3",62,0)
FRMTLST ; Format the variable LST(ILST) for DISPLAY tag
"RTN","ORWDBA3",63,0)
 S LST(ILST)=$J($P(LST(ILST),":"),SPCS)_": "_$P(LST(ILST),":",2)
"RTN","ORWDBA3",64,0)
 Q
"RTN","ORWDBA3",65,0)
 ;
"RTN","ORWDBA3",66,0)
HINTS(Y) ; Return HINTS for ORBA Treatment Factors - used by Delphi
"RTN","ORWDBA3",67,0)
 ; The hints returned in the Y array will be used in the CPRS GUI and
"RTN","ORWDBA3",68,0)
 ; displayed on fly-over of the cursor over the TxF text in the window
"RTN","ORWDBA3",69,0)
 ;
"RTN","ORWDBA3",70,0)
 ; Input
"RTN","ORWDBA3",71,0)
 ;  <none>
"RTN","ORWDBA3",72,0)
 ; Output
"RTN","ORWDBA3",73,0)
 ;  Y array of the hints for TxF's> Y(#)=TxFA ^ TxF line # ^ hint text
"RTN","ORWDBA3",74,0)
 ;    where TxFA is Treatment Factor acronym, e.g., CV=Combat Veteran
"RTN","ORWDBA3",75,0)
 ; Variables
"RTN","ORWDBA3",76,0)
 ;  CT      = line number count, used in Y(#) where #=CT
"RTN","ORWDBA3",77,0)
 ;  I       = incrementor index #
"RTN","ORWDBA3",78,0)
 ;  ORTFIEN = the IEN for the TxF in the Help Frame (^DIC(9.2)) file
"RTN","ORWDBA3",79,0)
 ;  TF      = TxF acronym
"RTN","ORWDBA3",80,0)
 ;  TFLN    = TxF text line number, e.g., ^DIC(9.2,ORTFIEN,1,TFLN,0)
"RTN","ORWDBA3",81,0)
 ;  TFS     = string of TxF acronyms
"RTN","ORWDBA3",82,0)
 ;  TFV     = TxF description/text
"RTN","ORWDBA3",83,0)
 ;
"RTN","ORWDBA3",84,0)
 N CT,I,ORTFIEN,TF,TFLN,TFS,TFV
"RTN","ORWDBA3",85,0)
 ;
"RTN","ORWDBA3",86,0)
 S TFS="SC^MST^AO^IR^EC^HNC^CV^SHD",CT=0
"RTN","ORWDBA3",87,0)
 ; Get next TxF from TFS
"RTN","ORWDBA3",88,0)
 F I=1:1 S TF=$P(TFS,U,I) Q:TF=""  D
"RTN","ORWDBA3",89,0)
 . S ORTFIEN=$O(^DIC(9.2,"B","ORBA-"_TF,"")),TFV="",TFLN=0
"RTN","ORWDBA3",90,0)
 . ; Get next line of hint text
"RTN","ORWDBA3",91,0)
 . F  S TFLN=$O(^DIC(9.2,ORTFIEN,1,TFLN)) Q:'TFLN  D
"RTN","ORWDBA3",92,0)
 .. S CT=CT+1,Y(CT)=TF_U_TFLN_U_^DIC(9.2,ORTFIEN,1,TFLN,0)
"RTN","ORWDBA3",93,0)
 Q
"RTN","ORWDBA3",94,0)
 ;
"RTN","ORWDBA3",95,0)
DG1(ORDFN,COUNTER,CTVALUE) ; Create DG1 segment(s) & make call for ZCL seg.
"RTN","ORWDBA3",96,0)
 ;
"RTN","ORWDBA3",97,0)
 ;  Input
"RTN","ORWDBA3",98,0)
 ;    ORDFN      Internal Order ID#
"RTN","ORWDBA3",99,0)
 ;    COUNTER    Variable used as counter from calling routine
"RTN","ORWDBA3",100,0)
 ;    CTVALUE    Value of COUNTER when DG1 called
"RTN","ORWDBA3",101,0)
 ;  Output
"RTN","ORWDBA3",102,0)
 ;    DG1 & ZCL HL7 segments
"RTN","ORWDBA3",103,0)
 ;
"RTN","ORWDBA3",104,0)
 I $$BASTAT^ORWDBA1=0 Q  ;BA not used
"RTN","ORWDBA3",105,0)
 N DG13,DXIEN,DXR,DXV,FROMFILE,ICD9,OCT,OREC,ORFMDAT
"RTN","ORWDBA3",106,0)
 ; zero order count variable
"RTN","ORWDBA3",107,0)
 S OCT=0
"RTN","ORWDBA3",108,0)
 ; Get the date of order (for CSV/CTD usage)
"RTN","ORWDBA3",109,0)
 S ORFMDAT=$$ORFMDAT(ORDFN)
"RTN","ORWDBA3",110,0)
 ; Get the diagnoses for an order
"RTN","ORWDBA3",111,0)
 F  S OCT=$O(^OR(100,ORDFN,5.1,OCT)) Q:OCT'?1N.N  D
"RTN","ORWDBA3",112,0)
 . S OREC=^OR(100,ORDFN,5.1,OCT,0)
"RTN","ORWDBA3",113,0)
 . S DXIEN=$P(OREC,U)  ; DXIEN=pointer to diagnosis (ICD9) file #80
"RTN","ORWDBA3",114,0)
 . ; the DXIEN pointer should point to a valid diagnosis (after all is
"RTN","ORWDBA3",115,0)
 . ;   was previously entered .. but just in case ...)
"RTN","ORWDBA3",116,0)
 . S (DXV,ICD9)=""
"RTN","ORWDBA3",117,0)
 . I DXIEN'="" D
"RTN","ORWDBA3",118,0)
 .. S DXR=$$ICDDX^ICDCODE(DXIEN,ORFMDAT) Q:+DXR=-1
"RTN","ORWDBA3",119,0)
 .. ; Get diagnosis verbiage and ICD code
"RTN","ORWDBA3",120,0)
 .. S DXV=$P(DXR,U,4),ICD9=$P(DXR,U,2)
"RTN","ORWDBA3",121,0)
 . S FROMFILE=80
"RTN","ORWDBA3",122,0)
 . S DG13=DXIEN_U_DXV_U_FROMFILE_U_ICD9_U_DXV_U_"ICD9"
"RTN","ORWDBA3",123,0)
 . S CTVALUE=CTVALUE+1
"RTN","ORWDBA3",124,0)
 . S ORMSG(CTVALUE)="DG1"_"|"_OCT_"||"_DG13_"|||||||||||||"
"RTN","ORWDBA3",125,0)
 . D ZCL
"RTN","ORWDBA3",126,0)
 S @COUNTER=CTVALUE
"RTN","ORWDBA3",127,0)
 Q
"RTN","ORWDBA3",128,0)
 ;
"RTN","ORWDBA3",129,0)
ZCL ;create all the ZCL segments (currently 8 TxF's) for order number OCT
"RTN","ORWDBA3",130,0)
 ;
"RTN","ORWDBA3",131,0)
 N I,J,TABLE,TF,TFGBL,TFGUI,TFTBL,TFIN,TFS,VALUE
"RTN","ORWDBA3",132,0)
 D TFSTGS^ORWDBA1  ;set string sequence of treatment factors
"RTN","ORWDBA3",133,0)
 ; TFS is TxF data in ^OR(100,ORIEN,5.2) order
"RTN","ORWDBA3",134,0)
 S TFS=$G(^OR(100,ORDFN,5.2)),TABLE=""
"RTN","ORWDBA3",135,0)
 ; conversion order from ^OR stored data and Table SD008 for HL7 msg
"RTN","ORWDBA3",136,0)
 ; convert so that the ZCL segments will be in Table SD008 order (1-8)
"RTN","ORWDBA3",137,0)
 F I=1:1:8 S TF=$P(TFTBL,U,I) F J=1:1:8 I $P(TFGBL,U,J)=TF S TABLE=TABLE_J Q
"RTN","ORWDBA3",138,0)
 F TFIN=1:1:8 D
"RTN","ORWDBA3",139,0)
 . ; ORMSG counter incremented
"RTN","ORWDBA3",140,0)
 . S CTVALUE=CTVALUE+1
"RTN","ORWDBA3",141,0)
 . ; TF VALUE=0 for no or 1 for yes (only if not req. is it null)
"RTN","ORWDBA3",142,0)
 . S VALUE=$P(TFS,U,$E(TABLE,TFIN))
"RTN","ORWDBA3",143,0)
 . I VALUE="?" S VALUE=0  ;temp fix if sending '?' to ancillary???
"RTN","ORWDBA3",144,0)
 . ; for Table SD008: OCT=Set ID, SCIN=O/P Classif. Type, VALUE=Value
"RTN","ORWDBA3",145,0)
 . S ORMSG(CTVALUE)="ZCL|"_OCT_"|"_TFIN_"|"_VALUE
"RTN","ORWDBA3",146,0)
 Q
"RTN","ORWDBA3",147,0)
 ;
"RTN","ORWDBA3",148,0)
BDOSTR ;Store backdoor order DG1 and ZCL messages from HL7
"RTN","ORWDBA3",149,0)
 ;Processes one order per entry into BDOSTR, e.g., ROUT(1)
"RTN","ORWDBA3",150,0)
 ;Depends upon ORM* routines to set-up a number of variables including
"RTN","ORWDBA3",151,0)
 ;  ORMSG array and ORIFN.
"RTN","ORWDBA3",152,0)
 ;ORM* routines calling BDOSTR: ORMGMRC, ORMLR, ORMPS, & ORMRA
"RTN","ORWDBA3",153,0)
 ;
"RTN","ORWDBA3",154,0)
 ; Input:   HL7 messages and related data
"RTN","ORWDBA3",155,0)
 ; Output:  ROUT array in Delphi GUI format, i.e.
"RTN","ORWDBA3",156,0)
 ;          OrderIEN;11CNNNCNN^exDx1^exDx2^exDx3^exDx4
"RTN","ORWDBA3",157,0)
 ;
"RTN","ORWDBA3",158,0)
 ; Variables Used
"RTN","ORWDBA3",159,0)
 ;  DG1      = sequential numbered array with a value of DXIEN
"RTN","ORWDBA3",160,0)
 ;  I,J      = counters
"RTN","ORWDBA3",161,0)
 ;  GUITF    = GUI order treatment factors (TxF)
"RTN","ORWDBA3",162,0)
 ;  NDX      = number of diagnoses being passed
"RTN","ORWDBA3",163,0)
 ;  NTF      = number of TxF
"RTN","ORWDBA3",164,0)
 ;  OBX      = @ORMSG Dx array element # (max of 4 diagnoses stored)
"RTN","ORWDBA3",165,0)
 ;  REC      = set to sequential HL7 messages, contains HL7 message data
"RTN","ORWDBA3",166,0)
 ;  ROUT     = record sent for storage processing to RCVORCI
"RTN","ORWDBA3",167,0)
 ;  TF       = individual TxF values
"RTN","ORWDBA3",168,0)
 ;  TFGBL    = TxF acronyms in ^ delimited string in ^OR sequence
"RTN","ORWDBA3",169,0)
 ;  TFGUI    = TxF acronyms in ^ delimited string in from GUI sequence
"RTN","ORWDBA3",170,0)
 ;  TFTBL    = TxF acronyms in ^ delimited string in Table SD008 sequence
"RTN","ORWDBA3",171,0)
 ;  VAL      = individual TxF values
"RTN","ORWDBA3",172,0)
 ;  ZCL      = TxF in Table SD008 format and sequence
"RTN","ORWDBA3",173,0)
 ;
"RTN","ORWDBA3",174,0)
 ; See if CIDC master switch set, if not then no DG1/ZCL seg, to store
"RTN","ORWDBA3",175,0)
 I $$BASTAT^ORWDBA1=0 Q  ;CIDC (nee BA) not used
"RTN","ORWDBA3",176,0)
 ;
"RTN","ORWDBA3",177,0)
 N CPNODE,CT,DG1,I,J,GUITF,NDX,NTF,OBX,REC,ROUT,ORSDCARY,SDCARYA
"RTN","ORWDBA3",178,0)
 N TF,TFGBL,TFGUI,TFTBL,VAL,X,ZCL
"RTN","ORWDBA3",179,0)
 ;
"RTN","ORWDBA3",180,0)
 K ORSDCARY,SDCARYA
"RTN","ORWDBA3",181,0)
 D TFSTGS^ORWDBA1  ;set string sequence of treatment factors
"RTN","ORWDBA3",182,0)
 S (CT,NDX,OBX)=0,NTF=8,(CPNODE,GUITF,TF,Y,ZCL)="",X="T"
"RTN","ORWDBA3",183,0)
 ; Call API to acquire Treatment Factors in force
"RTN","ORWDBA3",184,0)
 D NOW^%DTC,CL^SDCO21(DFN,%,"",.ORSDCARY)  ;DBIA 406
"RTN","ORWDBA3",185,0)
 ; Retrved array order: AO,IR,SC,EC,MST,HNC,CV,SHD, e.g., ORSDCARY(3) for SC
"RTN","ORWDBA3",186,0)
 ; Convert to character array, e.g., SDCARYA("SC")=""
"RTN","ORWDBA3",187,0)
 F I=1:1:NTF S:$D(ORSDCARY(I)) SDCARYA($P("AO^IR^SC^EC^MST^HNC^CV^SHD",U,I))=""
"RTN","ORWDBA3",188,0)
 ; Process only four DG1 segments and first set of ZCL segments
"RTN","ORWDBA3",189,0)
 F  S OBX=$O(@ORMSG@(OBX)) Q:OBX'>0  S J=$E(@ORMSG@(OBX),1,3) I J="DG1"!(J="ZCL"&($P(@ORMSG@(OBX),"|",2)=1)) D
"RTN","ORWDBA3",190,0)
 . S REC=@ORMSG@(OBX)
"RTN","ORWDBA3",191,0)
 . ; Setting DG1(#)=DXIEN where # is Dx sequence # (1=primary)
"RTN","ORWDBA3",192,0)
 . I J="DG1"&(NDX<4) S DG1($P(REC,"|",2))=$P(REC,U,4),NDX=NDX+1 Q
"RTN","ORWDBA3",193,0)
 . ; Create ZCL string of TxFs, e.g., 1101011
"RTN","ORWDBA3",194,0)
 . I J="ZCL" D
"RTN","ORWDBA3",195,0)
 .. S:$P(REC,"|",4)="" $P(REC,"|",4)=" "
"RTN","ORWDBA3",196,0)
 .. S $E(ZCL,$P(REC,"|",3))=$P(REC,"|",4)
"RTN","ORWDBA3",197,0)
 ; convert order and format from Table SD008 to GUI
"RTN","ORWDBA3",198,0)
 F I=1:1:NTF S TF=$P(TFGUI,U,I) F J=1:1:NTF I $P(TFTBL,U,J)=TF D
"RTN","ORWDBA3",199,0)
 . ; If patient does not have that Tx Factor (TF) then ghost in GUI ("N")
"RTN","ORWDBA3",200,0)
 . I '$D(SDCARYA(TF)) S GUITF=GUITF_"N" Q
"RTN","ORWDBA3",201,0)
 . ; If patient has TF then format for GUI (C=ck'd, U=unck'd, ?=not ans)
"RTN","ORWDBA3",202,0)
 . S VAL=$E(ZCL,J),GUITF=GUITF_$S(VAL=1:"C",VAL=0:"U",1:"?")
"RTN","ORWDBA3",203,0)
 ; Create output string in a format that can be stored by RCVORCI^ORWDBA1
"RTN","ORWDBA3",204,0)
 S ROUT(1)=ORIFN_";11"_GUITF_U_$G(DG1(1))_U_$G(DG1(2))_U_$G(DG1(3))_U_$G(DG1(4))
"RTN","ORWDBA3",205,0)
 ; Store diagnoses and treatment factors
"RTN","ORWDBA3",206,0)
 D RCVORCI^ORWDBA1(Y,.ROUT)
"RTN","ORWDBA3",207,0)
 Q
"RTN","ORWDBA3",208,0)
 ;
"RTN","ORWDBA3",209,0)
ERRMSG(VISIT) ; Error handling and message
"RTN","ORWDBA3",210,0)
 ; to be determined
"RTN","ORWDBA3",211,0)
 Q
"RTN","ORWDBA4")
0^41^B10113870
"RTN","ORWDBA4",1,0)
ORWDBA4 ; SLC/GU Billing Awareness - Phase II [11/26/04 15:44]
"RTN","ORWDBA4",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**195,243**;Dec 17, 1997;Build 242
"RTN","ORWDBA4",3,0)
 ;
"RTN","ORWDBA4",4,0)
 ;Miscellaneous CIDC functions utility.
"RTN","ORWDBA4",5,0)
 ;
"RTN","ORWDBA4",6,0)
 ;External References used by this routine
"RTN","ORWDBA4",7,0)
 ;  $$GETS^DIQ            DBIA 2056
"RTN","ORWDBA4",8,0)
 ;  GETS^DIQ              DBIA 2056
"RTN","ORWDBA4",9,0)
 ;  $$ICDDX^ICDCODE       DBIA 3990
"RTN","ORWDBA4",10,0)
 ;  $$TFGBLGUI^ORWDBA1    DBIA none listed
"RTN","ORWDBA4",11,0)
 ;  $$SETDXD^ORWDBA2      DBIA none listed
"RTN","ORWDBA4",12,0)
 ;  $$NOW^XLFDT           DBIA 10103
"RTN","ORWDBA4",13,0)
 ;  $$GET^XPAR            DBIA 2263
"RTN","ORWDBA4",14,0)
 ;
"RTN","ORWDBA4",15,0)
GETTFCI(Y,ORIEN) ;Get Treatment Factors Clinical Indicators
"RTN","ORWDBA4",16,0)
 ;Input Variable:
"RTN","ORWDBA4",17,0)
 ;  ORIEN    Order Internal Entry Number (array variable)
"RTN","ORWDBA4",18,0)
 ;Ouput Variable:
"RTN","ORWDBA4",19,0)
 ;  Y        Y(AI)=Order_IEN^Treatment_Factors^ICD9^ICD9_Description
"RTN","ORWDBA4",20,0)
 ;           There can be up to 4 ICD9 codes and thier descriptions
"RTN","ORWDBA4",21,0)
 ;           ICD901^DESC01^ICD902^DESC02^ICD903^DESC03^ICD904^DESC04
"RTN","ORWDBA4",22,0)
 ;Local Variables:
"RTN","ORWDBA4",23,0)
 ;  AI       Array Index
"RTN","ORWDBA4",24,0)
 ;  CI       Clinical Index
"RTN","ORWDBA4",25,0)
 ;  TF       Treatment Factors
"RTN","ORWDBA4",26,0)
 ;  TFCI     Treatment Factors Clinical Indicators
"RTN","ORWDBA4",27,0)
 N AI,CI,CNT,DXS,TF,TFCI
"RTN","ORWDBA4",28,0)
 S U="^",(CNT,TF)=""
"RTN","ORWDBA4",29,0)
 F  S CNT=$O(ORIEN(CNT)) Q:CNT=""  D
"RTN","ORWDBA4",30,0)
 . S TF=$$GTF(ORIEN(CNT))
"RTN","ORWDBA4",31,0)
 . S DXS=$$GDCD(ORIEN(CNT))
"RTN","ORWDBA4",32,0)
 . I TF="NNNNNNNN"&(DXS="") Q
"RTN","ORWDBA4",33,0)
 . S TFCI(CNT)=ORIEN(CNT)_U_TF_$S(DXS="":"",1:U_DXS)
"RTN","ORWDBA4",34,0)
 M Y=TFCI
"RTN","ORWDBA4",35,0)
 Q
"RTN","ORWDBA4",36,0)
 ;
"RTN","ORWDBA4",37,0)
GTF(IEN) ;Get Treatment Factors
"RTN","ORWDBA4",38,0)
 ;Gets the Treatment Factors for the current order converted to the
"RTN","ORWDBA4",39,0)
 ;format used by the CPRS GUI display.
"RTN","ORWDBA4",40,0)
 ;
"RTN","ORWDBA4",41,0)
 ;Input Variable:
"RTN","ORWDBA4",42,0)
 ;  IEN     Internal Entry Number
"RTN","ORWDBA4",43,0)
 ;Local Variables:
"RTN","ORWDBA4",44,0)
 ;  ORTF    Order Record Treatment Factors
"RTN","ORWDBA4",45,0)
 ;  OREM    Order Record Error Message
"RTN","ORWDBA4",46,0)
 ;  OTF     Order Treatment Factors
"RTN","ORWDBA4",47,0)
 ;          (Converted to GUI values and returned)
"RTN","ORWDBA4",48,0)
 N ORTF,OREM,OTF
"RTN","ORWDBA4",49,0)
 S OTF=""
"RTN","ORWDBA4",50,0)
 D GETS^DIQ(100,IEN,"90;91;92;93;94;95;96;98","I","ORTF","OREM")
"RTN","ORWDBA4",51,0)
 S OTF=$G(ORTF(100,IEN_",",90,"I"))
"RTN","ORWDBA4",52,0)
 S OTF=OTF_U_$G(ORTF(100,IEN_",",91,"I"))
"RTN","ORWDBA4",53,0)
 S OTF=OTF_U_$G(ORTF(100,IEN_",",92,"I"))
"RTN","ORWDBA4",54,0)
 S OTF=OTF_U_$G(ORTF(100,IEN_",",93,"I"))
"RTN","ORWDBA4",55,0)
 S OTF=OTF_U_$G(ORTF(100,IEN_",",94,"I"))
"RTN","ORWDBA4",56,0)
 S OTF=OTF_U_$G(ORTF(100,IEN_",",95,"I"))
"RTN","ORWDBA4",57,0)
 S OTF=OTF_U_$G(ORTF(100,IEN_",",96,"I"))
"RTN","ORWDBA4",58,0)
 S OTF=OTF_U_$G(ORTF(100,IEN_",",98,"I"))
"RTN","ORWDBA4",59,0)
 S OTF=$$TFGBLGUI^ORWDBA1(OTF)
"RTN","ORWDBA4",60,0)
 I OTF'="NNNNNNNN" Q OTF
"RTN","ORWDBA4",61,0)
 S OTF=""
"RTN","ORWDBA4",62,0)
 K ORTF,OREM
"RTN","ORWDBA4",63,0)
 D GETS^DIQ(100,IEN,"51;52;53;54;55;56;57;58","I","ORTF","OREM")
"RTN","ORWDBA4",64,0)
 S OTF=$G(ORTF(100,IEN_",",51,"I"))
"RTN","ORWDBA4",65,0)
 S OTF=OTF_U_$G(ORTF(100,IEN_",",52,"I"))
"RTN","ORWDBA4",66,0)
 S OTF=OTF_U_$G(ORTF(100,IEN_",",53,"I"))
"RTN","ORWDBA4",67,0)
 S OTF=OTF_U_$G(ORTF(100,IEN_",",54,"I"))
"RTN","ORWDBA4",68,0)
 S OTF=OTF_U_$G(ORTF(100,IEN_",",55,"I"))
"RTN","ORWDBA4",69,0)
 S OTF=OTF_U_$G(ORTF(100,IEN_",",56,"I"))
"RTN","ORWDBA4",70,0)
 S OTF=OTF_U_$G(ORTF(100,IEN_",",57,"I"))
"RTN","ORWDBA4",71,0)
 S OTF=OTF_U_$G(ORTF(100,IEN_",",58,"I"))
"RTN","ORWDBA4",72,0)
 S OTF=$$TFGBLGUI^ORWDBA1(OTF)
"RTN","ORWDBA4",73,0)
 Q OTF
"RTN","ORWDBA4",74,0)
 ;
"RTN","ORWDBA4",75,0)
GDCD(IEN) ;Get Diagnoses Codes / Description
"RTN","ORWDBA4",76,0)
 ;Builds and returns a text string delimited by the "^". The text string
"RTN","ORWDBA4",77,0)
 ;made from the ICD9 codes associated with the current order and thier
"RTN","ORWDBA4",78,0)
 ;descriptions pulled from the ICD DIAGNOSIS file #80. The string can
"RTN","ORWDBA4",79,0)
 ;contain up to four diagnoses codes and thier descriptions. The string
"RTN","ORWDBA4",80,0)
 ;with all four possiable diagnoses codes is formatted:
"RTN","ORWDBA4",81,0)
 ;ICD901^DESC01^ICD902^DESC02^ICD903^DESC03^ICD904^DESC04
"RTN","ORWDBA4",82,0)
 ;
"RTN","ORWDBA4",83,0)
 ;Input Variable:
"RTN","ORWDBA4",84,0)
 ;  IEN
"RTN","ORWDBA4",85,0)
 ;Local Variables:
"RTN","ORWDBA4",86,0)
 ;  DCD      Diagnosis Code Description (retrun variable)
"RTN","ORWDBA4",87,0)
 ;  DXDT     Diagnosis Date (either Order date or system date)
"RTN","ORWDBA4",88,0)
 ;  DXD      Diagnosis Description
"RTN","ORWDBA4",89,0)
 ;  DXIEN    Diagnosis Internal Entry Number
"RTN","ORWDBA4",90,0)
 ;  ICD9     ICD9 code (for GUI display)
"RTN","ORWDBA4",91,0)
 ;  IENS     Internale Entry Number Sequence
"RTN","ORWDBA4",92,0)
 ;           (Array index variable for data returned from lookup)
"RTN","ORWDBA4",93,0)
 ;  ORRF     Order Record Found (returned data from lookup)
"RTN","ORWDBA4",94,0)
 ;  OREM     Order Record Error Message
"RTN","ORWDBA4",95,0)
 N DCD,DXDT,DXD,DXIEN,ICD9,IENS,ORRF,OREM
"RTN","ORWDBA4",96,0)
 S DCD=""
"RTN","ORWDBA4",97,0)
 D GETS^DIQ(100,IEN,".8*;5.1*","I","ORRF","OREM")
"RTN","ORWDBA4",98,0)
 I $D(ORRF) D
"RTN","ORWDBA4",99,0)
 . S DXDT=""
"RTN","ORWDBA4",100,0)
 . I $D(ORRF(100.008)) S DXDT=$G(ORRF(100.008,"1,"_IEN_",",.01,"I"))
"RTN","ORWDBA4",101,0)
 . I DXDT="" S DXDT=$$NOW^XLFDT
"RTN","ORWDBA4",102,0)
 . I $D(ORRF(100.051)) D
"RTN","ORWDBA4",103,0)
 .. S IENS="" F  S IENS=$O(ORRF(100.051,IENS)) Q:IENS=""  D
"RTN","ORWDBA4",104,0)
 ... I ORRF(100.051,IENS,.01,"I")="" S DCD=DCD_U Q
"RTN","ORWDBA4",105,0)
 ... S DXIEN=ORRF(100.051,IENS,.01,"I")
"RTN","ORWDBA4",106,0)
 ... S ICD9=$$GET1^DIQ(80,DXIEN,.01,"")
"RTN","ORWDBA4",107,0)
 ... S DXD=$$SETDXD^ORWDBA2($P($$ICDDX^ICDCODE(ICD9,DT),U,4))
"RTN","ORWDBA4",108,0)
 ... S DCD=$S(DCD="":ICD9_U_DXD,1:DCD_U_ICD9_U_DXD)
"RTN","ORWDBA4",109,0)
 Q DCD
"RTN","ORWDBA4",110,0)
 ;
"RTN","ORWDBA4",111,0)
GETBAUSR(Y,ORCIEN) ;GUI RPC CALL
"RTN","ORWDBA4",112,0)
 ;Get Billing Awareness By User parameter value
"RTN","ORWDBA4",113,0)
 ;Gets and returns the value of the Enabled Billing Awareness By User 
"RTN","ORWDBA4",114,0)
 ;parameter assigned to a provider.
"RTN","ORWDBA4",115,0)
 ;Input Variable:
"RTN","ORWDBA4",116,0)
 ;  ORCIEN    Ordering Clinician's Internal Entry Number
"RTN","ORWDBA4",117,0)
 ;Output Variable:
"RTN","ORWDBA4",118,0)
 ;  Y         Parameter value, 1 if enabled, 0 if disabled
"RTN","ORWDBA4",119,0)
 S Y=$$GET^XPAR(ORCIEN_";VA(200,","OR BILLING AWARENESS BY USER",1,"Q")
"RTN","ORWDBA4",120,0)
 Q
"RTN","ORWDBA7")
0^42^B17868873
"RTN","ORWDBA7",1,0)
ORWDBA7 ;;SLC/GSS Billing Awareness (CIDC-Clinical Indicators Data Capture)
"RTN","ORWDBA7",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**195,215,243**;Dec 17, 1997;Build 242
"RTN","ORWDBA7",3,0)
 ;
"RTN","ORWDBA7",4,0)
BDOEDIT ; Backdoor entered orders edit in CPRS - entry point
"RTN","ORWDBA7",5,0)
 ; Data Flow> Ancillary creates a back door order which is incomplete
"RTN","ORWDBA7",6,0)
 ;            and thus edited in CPRS GUI. The ancillary needs to know
"RTN","ORWDBA7",7,0)
 ;            what Dx and TF's are edited thus this tag calls three
"RTN","ORWDBA7",8,0)
 ;            ancillary APIs, passing the Dx and TF data to them.
"RTN","ORWDBA7",9,0)
 ;
"RTN","ORWDBA7",10,0)
 ; Variable  Description
"RTN","ORWDBA7",11,0)
 ; ANCILARY  Acronym of ancillary/package relative to order
"RTN","ORWDBA7",12,0)
 ; DXN       Diagnosis sequence number in ^OR file
"RTN","ORWDBA7",13,0)
 ; MSG       Error message
"RTN","ORWDBA7",14,0)
 ; ORDX      Array of diagnoses (1-n) with value from ICD file (#80)
"RTN","ORWDBA7",15,0)
 ; ORIFN     Order internal reference number (defined in ORCSEND)
"RTN","ORWDBA7",16,0)
 ; ORITEM    Package reference or ^OR(100,ORIFN,4)
"RTN","ORWDBA7",17,0)
 ; ORSCEI    String of Treatment Factors in table SD008 order/format
"RTN","ORWDBA7",18,0)
 ; PTIEN     Patient IEN
"RTN","ORWDBA7",19,0)
 ; TAGROU    Tag^Routine of ancillary routine to store edited data
"RTN","ORWDBA7",20,0)
 ; TFO       Treatment Factors in ^OR (GBL) order
"RTN","ORWDBA7",21,0)
 ;
"RTN","ORWDBA7",22,0)
 ; If CIDC master switch set, then no back door orders to store
"RTN","ORWDBA7",23,0)
 I $$BASTAT^ORWDBA1=0 Q  ;CIDC (nee BA) not used
"RTN","ORWDBA7",24,0)
 ; If ORIFN not defined (God only knows why) then log error and quit
"RTN","ORWDBA7",25,0)
 I '$D(ORIFN) S MSG="ORIFN not defined" D VAR,EN^ORERR(MSG,"",.VAR) Q
"RTN","ORWDBA7",26,0)
 ;
"RTN","ORWDBA7",27,0)
 N ANCILARY,DXN,MSG,ORDX,ORITEM,ORSCEI,PTIEN,RT,SUCCESS,TAGROU,TFO,VAR
"RTN","ORWDBA7",28,0)
 ;
"RTN","ORWDBA7",29,0)
 S DXN=0,(RT,SUCCESS)="",PTIEN=+$P($G(^OR(100,ORIFN,0)),U,2)
"RTN","ORWDBA7",30,0)
 ; Package (ancillary) reference data
"RTN","ORWDBA7",31,0)
 S ORITEM=$G(^OR(100,ORIFN,4))
"RTN","ORWDBA7",32,0)
 ; Create an array (ORDX) of diagnoses
"RTN","ORWDBA7",33,0)
 F  S DXN=$O(^OR(100,ORIFN,5.1,DXN)) Q:'DXN  D
"RTN","ORWDBA7",34,0)
 . S ORDX(DXN)=$G(^OR(100,ORIFN,5.1,DXN,0))
"RTN","ORWDBA7",35,0)
 ; Treatment Factors - converted and reformatted
"RTN","ORWDBA7",36,0)
 S ORSCEI=$$TFGBLTBL($G(^OR(100,ORIFN,5.2)))
"RTN","ORWDBA7",37,0)
 ; Get the acronym of the package generating this order
"RTN","ORWDBA7",38,0)
 S ANCILARY=$P($G(^DIC(9.4,$P($G(^OR(100,ORIFN,0)),U,14),0)),U,2)
"RTN","ORWDBA7",39,0)
 ; Send data to the appropriate ancillary API based on package
"RTN","ORWDBA7",40,0)
 D OUTPUT
"RTN","ORWDBA7",41,0)
 ; If ancillary routine or tag w/in the routine doesn't exist check
"RTN","ORWDBA7",42,0)
 I 'RT D
"RTN","ORWDBA7",43,0)
 . S MSG="NON-EXISTANT ROUTINE/TAG FOR "_ANCILARY
"RTN","ORWDBA7",44,0)
 . D VAR,EN^ORERR(MSG,"",.VAR)
"RTN","ORWDBA7",45,0)
 ; If we don't get back a thumbs-up from the ancillary re: the order data
"RTN","ORWDBA7",46,0)
 I 'SUCCESS,RT D
"RTN","ORWDBA7",47,0)
 . S MSG="ANCILLARY API RETURNED ERROR FOR CPRS EDITED BACK DOOR DATA"
"RTN","ORWDBA7",48,0)
 . D VAR,EN^ORERR(MSG,"",.VAR)
"RTN","ORWDBA7",49,0)
 Q
"RTN","ORWDBA7",50,0)
 ;
"RTN","ORWDBA7",51,0)
OUTPUT ; Call ancillary's API to store data after checking for it's existence
"RTN","ORWDBA7",52,0)
 ;
"RTN","ORWDBA7",53,0)
 ; Laboratory
"RTN","ORWDBA7",54,0)
 I ANCILARY?1"LR".U D  Q
"RTN","ORWDBA7",55,0)
 . S RT=$$CKROUTAG("UPDOR^LRBEBA4") Q:'RT
"RTN","ORWDBA7",56,0)
 . S SUCCESS=$$UPDOR^LRBEBA4(PTIEN,ORITEM,ORIFN,.ORDX,ORSCEI)  ;IA 4775
"RTN","ORWDBA7",57,0)
 ;
"RTN","ORWDBA7",58,0)
 ; Pharmacy
"RTN","ORWDBA7",59,0)
 I ANCILARY?1"PS".U D  Q
"RTN","ORWDBA7",60,0)
 . S RT=$$CKROUTAG("EN^PSOHLNE3") Q:'RT
"RTN","ORWDBA7",61,0)
 . S SUCCESS=$$EN^PSOHLNE3(PTIEN,ORITEM,ORIFN,.ORDX,ORSCEI)  ;IA 4666
"RTN","ORWDBA7",62,0)
 ;
"RTN","ORWDBA7",63,0)
 ; Radiolgy
"RTN","ORWDBA7",64,0)
 I ANCILARY?1"RA".U D  Q
"RTN","ORWDBA7",65,0)
 . S RT=$$CKROUTAG("CPRSUPD^RABWORD1") Q:'RT
"RTN","ORWDBA7",66,0)
 . S SUCCESS=$$CPRSUPD^RABWORD1(PTIEN,ORITEM,ORIFN,.ORDX,ORSCEI) ;IA 4771
"RTN","ORWDBA7",67,0)
 Q
"RTN","ORWDBA7",68,0)
 ;
"RTN","ORWDBA7",69,0)
CKROUTAG(TAGROU) ;Check if valid tag and routine
"RTN","ORWDBA7",70,0)
 ; Temporary check until all the ancillaries have their API's built
"RTN","ORWDBA7",71,0)
 Q $L($T(@TAGROU))
"RTN","ORWDBA7",72,0)
 ;
"RTN","ORWDBA7",73,0)
TFGBLTBL(GBL) ;Convert Tx Factors from Global to TBL (HL7) order & format
"RTN","ORWDBA7",74,0)
 ; Note: this does not set Tx Factors in ZCL segment format but rather
"RTN","ORWDBA7",75,0)
 ;       AO^IR^SC^EC^MST^HNC^CV^SHD ('^' delimited string) format
"RTN","ORWDBA7",76,0)
 ;
"RTN","ORWDBA7",77,0)
 ; Input:  GBL in 1^1^0^0^^^0^ (global) format
"RTN","ORWDBA7",78,0)
 ; Output: TBL in 0^0^1^^1^^0^ (TBL) format (also reordered)
"RTN","ORWDBA7",79,0)
 ;
"RTN","ORWDBA7",80,0)
 N J,NTF,TBL,TF,TFGBL,TFGUI,TFTBL
"RTN","ORWDBA7",81,0)
 S TBL="",NTF=8  ;NCI=# of TxF
"RTN","ORWDBA7",82,0)
 ; Get Treatment Factor sequence order strings
"RTN","ORWDBA7",83,0)
 D TFSTGS^ORWDBA1
"RTN","ORWDBA7",84,0)
 ; Convert from GBL to TBL format and sequence
"RTN","ORWDBA7",85,0)
 F J=1:1:NTF S TF=$P(GBL,U,J) D
"RTN","ORWDBA7",86,0)
 . ;OK..just in case there is a '?' we'll return a null for a '?'
"RTN","ORWDBA7",87,0)
 . S TF($P(TFGBL,U,J))=$S(TF=1:1,TF=0:0,TF="?":"",1:"")
"RTN","ORWDBA7",88,0)
 F J=1:1:NTF S TBL=TBL_U_TF($P(TFTBL,U,J))
"RTN","ORWDBA7",89,0)
 ; Remove the first '^' and pass TBL formatted TF's
"RTN","ORWDBA7",90,0)
 Q $E(TBL,2,99)
"RTN","ORWDBA7",91,0)
 ;
"RTN","ORWDBA7",92,0)
VAR ;Create VAR array for tracking error in ^ORYX("ORERR",err#)
"RTN","ORWDBA7",93,0)
 S VAR("DFN")=PTIEN
"RTN","ORWDBA7",94,0)
 S VAR("ORITEM")=ORITEM
"RTN","ORWDBA7",95,0)
 S VAR("ORIFN")=ORIFN
"RTN","ORWDBA7",96,0)
 M VAR("ORDX")=ORDX
"RTN","ORWDBA7",97,0)
 S VAR("ORSCEI")=ORSCEI
"RTN","ORWDBA7",98,0)
 Q
"RTN","ORWDBA7",99,0)
 ;
"RTN","ORWDBA7",100,0)
ISWITCH(Y,DFN) ;Return 0 if don't ask (no ins) or 1 to ask CIDC quest (yes ins)
"RTN","ORWDBA7",101,0)
 S Y=$$CIDC^IBBAPI(DFN)
"RTN","ORWDBA7",102,0)
 Q
"RTN","ORWDBA7",103,0)
 ;
"RTN","ORWDBA7",104,0)
GETIEN9(Y,ICD9) ;Return IEN for an ICD9 code (RPC: ORWDBA7 GETIEN9)
"RTN","ORWDBA7",105,0)
 S Y=$P($$CODEN^ICDCODE(ICD9,80),"~")
"RTN","ORWDBA7",106,0)
 Q
"RTN","ORWDBA7",107,0)
 ;
"RTN","ORWDBA7",108,0)
CONDTLD ;Consult Detailed Display Compile for CIDC/BA (called by GMRCSLM2)
"RTN","ORWDBA7",109,0)
 ; Input:  ORIFN and GMRCCT defined in GMRCSLM2
"RTN","ORWDBA7",110,0)
 ; Output: CIDCARY = array of CIDC display lines for GMRCSLM2 display
"RTN","ORWDBA7",111,0)
 N BGNRCCT,DXIEN,DXOF,DXV,EYE,ICD9,ICDR,LINE,OCT,ORFMDAT,TF
"RTN","ORWDBA7",112,0)
 S BGNRCCT=GMRCCT,OCT=0
"RTN","ORWDBA7",113,0)
 ; Get the date of the order for CSV/CTD usage
"RTN","ORWDBA7",114,0)
 S ORFMDAT=$$ORFMDAT^ORWDBA3(ORIFN)
"RTN","ORWDBA7",115,0)
 ; $O through diagnoses for an order
"RTN","ORWDBA7",116,0)
 F  S OCT=$O(^OR(100,ORIFN,5.1,OCT)) Q:OCT'?1N.N  D
"RTN","ORWDBA7",117,0)
 . S DXOF="               "
"RTN","ORWDBA7",118,0)
 . ; DXIEN=Dx IEN
"RTN","ORWDBA7",119,0)
 . S DXIEN=+^OR(100,ORIFN,5.1,OCT,0)
"RTN","ORWDBA7",120,0)
 . ; Get Dx record for date ORFMDAT
"RTN","ORWDBA7",121,0)
 . S ICDR=$$ICDDX^ICDCODE(DXIEN,ORFMDAT)
"RTN","ORWDBA7",122,0)
 . ; Get Dx verbiage and ICD code
"RTN","ORWDBA7",123,0)
 . S DXV=$P(ICDR,U,4),ICD9=$P(ICDR,U,2)
"RTN","ORWDBA7",124,0)
 . I OCT=1 D
"RTN","ORWDBA7",125,0)
 .. S CIDCARY(GMRCCT,0)=" ",GMRCCT=GMRCCT+1 ;blank line
"RTN","ORWDBA7",126,0)
 .. S CIDCARY(GMRCCT,0)="Clinical Indicators",GMRCCT=GMRCCT+1
"RTN","ORWDBA7",127,0)
 .. S DXOF="Diagnosis of:  "
"RTN","ORWDBA7",128,0)
 . S LINE=DXOF_ICD9_" - "_DXV
"RTN","ORWDBA7",129,0)
 . S CIDCARY(GMRCCT,0)=LINE,GMRCCT=GMRCCT+1
"RTN","ORWDBA7",130,0)
 I OCT'="" D  ;if there are diagnoses then show Treatment Factors
"RTN","ORWDBA7",131,0)
 . S LINE="For conditions related to:    "
"RTN","ORWDBA7",132,0)
 . F EYE=1:1:8 S TF=$P(^OR(100,ORIFN,5.2),U,EYE) I TF D
"RTN","ORWDBA7",133,0)
 .. S CIDCARY(GMRCCT,0)=LINE_$$SC^ORQ21(EYE)
"RTN","ORWDBA7",134,0)
 .. S X=$$REPEAT^XLFSTR(" ",30),GMRCCT=GMRCCT+1
"RTN","ORWDBA7",135,0)
 Q
"RTN","ORWDFH")
0^175^B51608431
"RTN","ORWDFH",1,0)
ORWDFH ; SLC/KCM/JLI - Diet Order calls for Windows Dialogs ;12/12/00  14:44
"RTN","ORWDFH",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,92,141,187,215,243**;Dec 17, 1997;Build 242
"RTN","ORWDFH",3,0)
TXT(LST,DFN)    ; Return text of current & future diets for a patient
"RTN","ORWDFH",4,0)
 S LST(1)="Current Diet:  "_$$DIET^ORCDFH(DFN)
"RTN","ORWDFH",5,0)
 N FUTLST D FUT(.FUTLST,DFN) I $D(FUTLST)>1 D
"RTN","ORWDFH",6,0)
 . S LST(2)="Future Diet Orders:",ILST=2
"RTN","ORWDFH",7,0)
 . S I=0 F  S I=$O(FUTLST(I)) Q:'I  D
"RTN","ORWDFH",8,0)
 . . S X=$$FMTE^XLFDT(I,2)_"  "_$P(FUTLST(I),U,2)
"RTN","ORWDFH",9,0)
 . . S LST(ILST)=$S(ILST=2:"Future Diet Orders:  "_X,1:"   "_X)
"RTN","ORWDFH",10,0)
 . . S ILST=ILST+1
"RTN","ORWDFH",11,0)
 Q
"RTN","ORWDFH",12,0)
FUT(LST,DFN)    ; Return a list of future diet orders
"RTN","ORWDFH",13,0)
 N DGRP,NXTDT,ORIFN,ORVP,ORTX
"RTN","ORWDFH",14,0)
 S ORVP=DFN_";DPT(",DGRP=$O(^ORD(100.98,"B","DO",0)),NXTDT=$$NOW^XLFDT
"RTN","ORWDFH",15,0)
 F  S NXTDT=$O(^OR(100,"AW",ORVP,DGRP,NXTDT)) Q:NXTDT'>0  D
"RTN","ORWDFH",16,0)
 . S ORIFN=+$O(^OR(100,"AW",ORVP,DGRP,NXTDT,0))
"RTN","ORWDFH",17,0)
 . I $P($G(^OR(100,ORIFN,3)),U,3)'=8 Q  ; only scheduled diets
"RTN","ORWDFH",18,0)
 . D TEXT^ORQ12(.ORTX,ORIFN) S LST(NXTDT)=NXTDT_U_$G(ORTX(1))
"RTN","ORWDFH",19,0)
 Q
"RTN","ORWDFH",20,0)
PARAM(ORLST,ORVP,ORLOC)  ; Return dietetics parameters for a patient at a location
"RTN","ORWDFH",21,0)
 ; ORLOC: hospital location ptr to ^SC #44
"RTN","ORWDFH",22,0)
 ; ORLST(1)=EB1^EB2^EB3^LB1^LB2^LB3^EN1^EN2^...LE2^LE3
"RTN","ORWDFH",23,0)
 ; ORLST(2)=BAB^BAE^NAB^NAE^EAB^EAE^BegB^BegN^BegE^Bagged
"RTN","ORWDFH",24,0)
 ; ORLST(3)=type of service^RegIEN^NPOIEN^EarlyIEN^LateIEN^TFIFN
"RTN","ORWDFH",25,0)
 ; ORLST(4)=max days in future for outpatient recurring meals
"RTN","ORWDFH",26,0)
 ; ORLST(5)=default outpatient diet
"RTN","ORWDFH",27,0)
 Q:'+ORVP
"RTN","ORWDFH",28,0)
 N X,IEN,CURTM
"RTN","ORWDFH",29,0)
 S ORVP=+ORVP_";DPT(",ORLOC=+ORLOC
"RTN","ORWDFH",30,0)
 S CURTM=$$NOW^XLFDT
"RTN","ORWDFH",31,0)
 I +$G(^SC(ORLOC,42)) S ORLOC=$G(^SC(ORLOC,42))_";DIC(42"
"RTN","ORWDFH",32,0)
 E  S ORLOC=ORLOC_";SC("
"RTN","ORWDFH",33,0)
 D EN1^FHWOR8(ORLOC,.ORLST)
"RTN","ORWDFH",34,0)
 ;
"RTN","ORWDFH",35,0)
 I '$L($G(ORLST(3))) S ORLST(3)="T"
"RTN","ORWDFH",36,0)
 S $P(ORLST(3),U,2)=$O(^ORD(101.43,"S.DIET","REGULAR",0))
"RTN","ORWDFH",37,0)
 S $P(ORLST(3),U,3)=$O(^ORD(101.43,"S.DIET","NPO",0))
"RTN","ORWDFH",38,0)
 S $P(ORLST(3),U,4)=$O(^ORD(101.43,"S.E/L T","EARLY TRAY",0))
"RTN","ORWDFH",39,0)
 S $P(ORLST(3),U,5)=$O(^ORD(101.43,"S.E/L T","LATE TRAY",0))
"RTN","ORWDFH",40,0)
 N TF S TF=$$CURRENT^ORCDFH("TF") I $L(TF,";")=1 S TF=TF_";1"
"RTN","ORWDFH",41,0)
 I TF,'$$FUTURE^ORCDFH("EFFECTIVE DATE/TIME") S $P(ORLST(3),U,6)=TF
"RTN","ORWDFH",42,0)
 I $$VERSION^XPDUTL("FH")>5 D
"RTN","ORWDFH",43,0)
 . S ORLST(4)=$$MAXDAYS^FHOMAPI(ORLOC)
"RTN","ORWDFH",44,0)
 . D DIETLST^FHOMAPI Q:'$G(FHDIET(1))
"RTN","ORWDFH",45,0)
 . S IEN=$O(^ORD(101.43,"ID",$P(FHDIET(1),U,1)_";99FHD",0)) Q:+IEN=0
"RTN","ORWDFH",46,0)
 . S X=^ORD(101.43,"S.DIET",$P(FHDIET(1),U,2),IEN)
"RTN","ORWDFH",47,0)
 . I +$P(X,U,3),$P(X,U,3)<CURTM Q
"RTN","ORWDFH",48,0)
 . I $P($G(^ORD(101.43,IEN,"FH")),U)'="D",($P($G(^(0)),U)'="NPO") Q
"RTN","ORWDFH",49,0)
 . S ORLST(5)=+$G(IEN)
"RTN","ORWDFH",50,0)
 Q
"RTN","ORWDFH",51,0)
ATTR(REC,OI)    ; Return OI^Text^Type^Precedence^AskExpire for a diet
"RTN","ORWDFH",52,0)
 I $G(^ORD(101.43,OI,.1)),^(.1)'>$$NOW^XLFDT S REC="0^"_$P($G(^ORD(101.43,OI,0)),U)_" has been inactivated and may not be ordered anymore." Q
"RTN","ORWDFH",53,0)
 S REC=OI_U_$P($G(^ORD(101.43,OI,0)),U)_U_$G(^("FH"))
"RTN","ORWDFH",54,0)
 Q
"RTN","ORWDFH",55,0)
DIETS(Y,FROM,DIR)       ; Return a subset of active diets, including NPO
"RTN","ORWDFH",56,0)
 ; Y(n)=IEN^.01 Name^.01 Name  -or-  IEN^Synonym <.01 Name>^.01 Name
"RTN","ORWDFH",57,0)
 N I,IEN,CNT,X,CURTM
"RTN","ORWDFH",58,0)
 S I=0,CNT=44,CURTM=$$NOW^XLFDT
"RTN","ORWDFH",59,0)
 F  Q:I'<CNT  S FROM=$O(^ORD(101.43,"S.DIET",FROM),DIR) Q:FROM=""  D
"RTN","ORWDFH",60,0)
 . S IEN=0 F  S IEN=$O(^ORD(101.43,"S.DIET",FROM,IEN)) Q:'IEN  D
"RTN","ORWDFH",61,0)
 . . S X=^ORD(101.43,"S.DIET",FROM,IEN)
"RTN","ORWDFH",62,0)
 . . I +$P(X,U,3),$P(X,U,3)<CURTM Q
"RTN","ORWDFH",63,0)
 . . I $P($G(^ORD(101.43,IEN,"FH")),U)'="D",($P($G(^(0)),U)'="NPO") Q
"RTN","ORWDFH",64,0)
 . . S I=I+1
"RTN","ORWDFH",65,0)
 . . I 'X S Y(I)=IEN_U_$P(X,U,2)_U_$P(X,U,2)
"RTN","ORWDFH",66,0)
 . . E  S Y(I)=IEN_U_$P(X,U,2)_$C(9)_"<"_$P(X,U,4)_">"_U_$P(X,U,4)
"RTN","ORWDFH",67,0)
 Q
"RTN","ORWDFH",68,0)
OPDIETS(ORY,FROM,DIR)   ;Return a list of up to 5 outpatient diets from file 119.9
"RTN","ORWDFH",69,0)
 N X,I,J,IEN,CURTM,SYNCNT,SYNTOT,FHDIET
"RTN","ORWDFH",70,0)
 D DIETLST^FHOMAPI
"RTN","ORWDFH",71,0)
 S CURTM=$$NOW^XLFDT,I=0,SYNTOT=1
"RTN","ORWDFH",72,0)
 F  S I=$O(FHDIET(I)) Q:'I  D
"RTN","ORWDFH",73,0)
 . S IEN=$O(^ORD(101.43,"ID",$P(FHDIET(I),U,1)_";99FHD",0)) Q:+IEN=0
"RTN","ORWDFH",74,0)
 . S X=^ORD(101.43,"S.DIET",$P(FHDIET(I),U,2),IEN)
"RTN","ORWDFH",75,0)
 . I +$P(X,U,3),$P(X,U,3)<CURTM Q
"RTN","ORWDFH",76,0)
 . I $P($G(^ORD(101.43,IEN,"FH")),U)'="D",($P($G(^(0)),U)'="NPO") Q
"RTN","ORWDFH",77,0)
 . S X=$P(^ORD(101.43,IEN,0),U,1)
"RTN","ORWDFH",78,0)
 . S SYNCNT=$P($G(^ORD(101.43,IEN,2,0)),U,4),J=0
"RTN","ORWDFH",79,0)
 . S ORY(X)=IEN_U_X_U_X
"RTN","ORWDFH",80,0)
 . I +SYNCNT  D  Q
"RTN","ORWDFH",81,0)
 . . S SYNTOT=SYNTOT+SYNCNT
"RTN","ORWDFH",82,0)
 . . F  S J=$O(^ORD(101.43,IEN,2,J)) Q:'J  D
"RTN","ORWDFH",83,0)
 . . . S ORY(^ORD(101.43,IEN,2,J,0))=IEN_U_^ORD(101.43,IEN,2,J,0)_$C(9)_"<"_X_">"_U_X
"RTN","ORWDFH",84,0)
 Q
"RTN","ORWDFH",85,0)
TFPROD(Y)     ; Return a list of active tubefeeding products
"RTN","ORWDFH",86,0)
 N I,IEN,NAM,X,CURTM
"RTN","ORWDFH",87,0)
 S I=0,NAM="",CURTM=$$NOW^XLFDT
"RTN","ORWDFH",88,0)
 F  S NAM=$O(^ORD(101.43,"S.TF",NAM)) Q:NAM=""  D
"RTN","ORWDFH",89,0)
 . S IEN=0 F  S IEN=$O(^ORD(101.43,"S.TF",NAM,IEN)) Q:'IEN  D
"RTN","ORWDFH",90,0)
 . . S X=^ORD(101.43,"S.TF",NAM,IEN)
"RTN","ORWDFH",91,0)
 . . I +$P(X,U,3),$P(X,U,3)<CURTM Q
"RTN","ORWDFH",92,0)
 . . S I=I+1
"RTN","ORWDFH",93,0)
 . . I 'X S Y(I)=IEN_U_$P(X,U,2)_U_$P(X,U,2)
"RTN","ORWDFH",94,0)
 . . E  S Y(I)=IEN_U_$P(X,U,2)_$C(9)_"<"_$P(X,U,4)_">"_U_$P(X,U,4)
"RTN","ORWDFH",95,0)
 Q
"RTN","ORWDFH",96,0)
QTY2CC(VAL,PRD,STR,QTY)     ; Return cc's given a product, strength, & quantity
"RTN","ORWDFH",97,0)
 N X,VQTY,DUR
"RTN","ORWDFH",98,0)
 S VQTY=$$VALIDQTY^ORCDFHTF(QTY) I '$L(VQTY)!('PRD)!('STR) S VAL="" Q
"RTN","ORWDFH",99,0)
 S PRD=+$P($G(^ORD(101.43,PRD,0)),U,2)
"RTN","ORWDFH",100,0)
 S DUR=$P(VQTY," X ",2) I $L(DUR) S DUR=$S(DUR["H":"H",1:"X")_+DUR
"RTN","ORWDFH",101,0)
 S X=+VQTY_"&"_$E($P(VQTY," ",2))_U_$P($P(VQTY,"/",2)," ")_U_DUR
"RTN","ORWDFH",102,0)
 S VAL=$$QUAN^FHWOR5R(PRD_"-"_STR,X)_U_VQTY
"RTN","ORWDFH",103,0)
 Q
"RTN","ORWDFH",104,0)
FINDTYP(VAL,DGRP)       ; Return type of dietetics order based on display group
"RTN","ORWDFH",105,0)
 S VAL=$P($G(^ORD(100.98,DGRP,0)),U,3)
"RTN","ORWDFH",106,0)
 S:VAL="D AO" VAL="A" S VAL=$E(VAL)
"RTN","ORWDFH",107,0)
 Q
"RTN","ORWDFH",108,0)
ISOIEN(VAL)     ; Return IEN for the Isolation/Precaution orderable item
"RTN","ORWDFH",109,0)
 S VAL=$O(^ORD(101.43,"S.PREC","ISOLATION PROCEDURES",0))
"RTN","ORWDFH",110,0)
 Q
"RTN","ORWDFH",111,0)
CURISO(VAL,ORVP) ; Return a patient's current isolation
"RTN","ORWDFH",112,0)
 S ORVP=ORVP_";DPT(" S VAL=$P($$IP^ORMBLD,U,2)
"RTN","ORWDFH",113,0)
 I '$L(VAL) S VAL="<none>"
"RTN","ORWDFH",114,0)
 Q
"RTN","ORWDFH",115,0)
ISOLIST(LST)    ; Return list of active isolations/precautions
"RTN","ORWDFH",116,0)
 N I,X,IEN
"RTN","ORWDFH",117,0)
 S I=0,X="" F  S X=$O(^FH(119.4,"B",X)) Q:X=""  S IEN=$O(^(X,0)) D
"RTN","ORWDFH",118,0)
 . I '$D(^FH(119.4,IEN,"I")) S I=I+1,LST(I)=IEN_U_X
"RTN","ORWDFH",119,0)
 Q
"RTN","ORWDFH",120,0)
MILTM(X)        ; return military time for am/pm time
"RTN","ORWDFH",121,0)
 N TM
"RTN","ORWDFH",122,0)
 S TM=$P(X,":",1)_+$P(X,":",2)
"RTN","ORWDFH",123,0)
 I X["P",TM<1200 S TM=TM+1200
"RTN","ORWDFH",124,0)
 I X["A",TM>1200 S TM=TM-1200
"RTN","ORWDFH",125,0)
 Q TM
"RTN","ORWDFH",126,0)
 ;
"RTN","ORWDFH",127,0)
ASKLATE(REC,DFN,ORIFN)        ; Return info for ordering late tray for diet order
"RTN","ORWDFH",128,0)
 ; REC=0  or  1^meal^bagged^time^time^time
"RTN","ORWDFH",129,0)
 S REC=0 Q:'$G(ORIFN)  Q:$E($$VALUE^ORX8(ORIFN,"ORDERABLE",1,"E"),1,3)="NPO"
"RTN","ORWDFH",130,0)
 N X,Y,%DT,STRT,DATE,ORPARAM,I,MEAL,MEALTIME
"RTN","ORWDFH",131,0)
 S X=$O(^OR(100,ORIFN,4.5,"ID","START",0)),X=$G(^OR(100,ORIFN,4.5,+X,1))
"RTN","ORWDFH",132,0)
 Q:X=""  S %DT="TX" D ^%DT Q:Y'>0  Q:$P(Y,".")>DT  ;invalid or future
"RTN","ORWDFH",133,0)
 S DATE=$P(Y,"."),STRT=+$E($P(Y,".",2)_"0000",1,4),MEAL=0
"RTN","ORWDFH",134,0)
 D EN^FHWOR8(DFN,.ORPARAM) Q:'$D(ORPARAM(2))
"RTN","ORWDFH",135,0)
 F I=1,3,5 I $P(ORPARAM(2),U,I)<STRT,STRT<$P(ORPARAM(2),U,I+1) S MEAL=I Q
"RTN","ORWDFH",136,0)
 S MEAL=$S(MEAL=1:4,MEAL=3:10,MEAL=5:16,1:0) Q:'MEAL
"RTN","ORWDFH",137,0)
 S MEALTIME=$P(ORPARAM(1),U,MEAL,MEAL+2)
"RTN","ORWDFH",138,0)
 S MEAL=$S(MEAL=4:"B",MEAL=10:"N",MEAL=16:"E",1:"")
"RTN","ORWDFH",139,0)
 F I=1:1:3 S X=$$MILTM($P(MEAL,U,I)) I X<STRT S $P(MEAL,U,I)=""
"RTN","ORWDFH",140,0)
 S REC="1"_U_MEAL_U_$P(ORPARAM(2),U,10)_U_MEALTIME
"RTN","ORWDFH",141,0)
 I $P(REC,U,2,4)="^^" S REC=0
"RTN","ORWDFH",142,0)
 Q
"RTN","ORWDFH",143,0)
ADDLATE(REC,ORVP,ORNP,ORL,MEAL,TIME,BAG)      ; Add late tray order
"RTN","ORWDFH",144,0)
 N ORIFN,ORNEW,ORDUZ,ORSTS,OREVENT,ORCAT,ORDA,ORTS,ORCHECK,ORLOG
"RTN","ORWDFH",145,0)
 N ORDIALOG,ORDG,ORTYPE,DA,FIRST,TRAY
"RTN","ORWDFH",146,0)
 S ORVP=ORVP_";DPT(",ORL(2)=ORL_";SC(",ORL=ORL(2)
"RTN","ORWDFH",147,0)
 S ORTYPE="D",FIRST=1,ORDUZ=DUZ,ORLOG=+$E($$NOW^XLFDT,1,12)
"RTN","ORWDFH",148,0)
 S TRAY=+$O(^ORD(101.43,"S.E/L T","LATE TRAY",0))
"RTN","ORWDFH",149,0)
 S ORDIALOG=$O(^ORD(101.41,"AB","FHW2",0))
"RTN","ORWDFH",150,0)
 D GETDLG^ORCD(ORDIALOG)
"RTN","ORWDFH",151,0)
 S ORDIALOG($$PTR^ORCD("OR GTX MEAL"),1)=MEAL
"RTN","ORWDFH",152,0)
 S ORDIALOG($$PTR^ORCD("OR GTX ORDERABLE ITEM"),1)=TRAY
"RTN","ORWDFH",153,0)
 S ORDIALOG($$PTR^ORCD("OR GTX START DATE"),1)=DT
"RTN","ORWDFH",154,0)
 S ORDIALOG($$PTR^ORCD("OR GTX STOP DATE"),1)=DT
"RTN","ORWDFH",155,0)
 S ORDIALOG($$PTR^ORCD("OR GTX MEAL TIME"),1)=TIME
"RTN","ORWDFH",156,0)
 S ORDIALOG($$PTR^ORCD("OR GTX YES/NO"),1)=BAG
"RTN","ORWDFH",157,0)
 D EN^ORCSAVE
"RTN","ORWDFH",158,0)
 S REC="" I ORIFN D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDFH",159,0)
 Q
"RTN","ORWDFH",160,0)
CURMEALS(ORY,ORDFN,ORMEAL)     ;Return current list of recurring meals for AO and TF orders
"RTN","ORWDFH",161,0)
 N I,Y,X S I=0
"RTN","ORWDFH",162,0)
 S ORMEAL=$G(ORMEAL,"")
"RTN","ORWDFH",163,0)
 D EN2^FHWOR8(ORDFN,ORMEAL,.ORY)
"RTN","ORWDFH",164,0)
 F  S I=$O(ORY(I)) Q:'I  D
"RTN","ORWDFH",165,0)
 . S X=$P(ORY(I),U,2)
"RTN","ORWDFH",166,0)
 . S Y=$P(ORY(I),U,1) D DD^%DT S $P(ORY(I),U,2)=Y
"RTN","ORWDFH",167,0)
 . S $P(ORY(I),U,3)=$S(X="B":"Breakfast",X="N":"Noon",X="E":"Evening",1:"")
"RTN","ORWDFH",168,0)
 Q
"RTN","ORWDFH",169,0)
NFSLOC(ORLOC) ;Get NUTRITION LOCATION name for HOSPITAL LOCATION
"RTN","ORWDFH",170,0)
 Q $$NFSLOC^FHOMAPI(ORLOC)
"RTN","ORWDFH",171,0)
OPLOCOK(ORY,ORLOC) ; OK to order OP Meals from this location
"RTN","ORWDFH",172,0)
 I 'ORLOC S ORY=0 Q
"RTN","ORWDFH",173,0)
 S ORY=$S($L($$NFSLOC^FHOMAPI(ORLOC))>0:1,1:0)
"RTN","ORWDFH",174,0)
 Q
"RTN","ORWDGX")
0^3^B5976236
"RTN","ORWDGX",1,0)
ORWDGX ; SLC/KCM - Generic Orders calls for Windows Dialogs [ 08/05/96  8:21 AM ]
"RTN","ORWDGX",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORWDGX",3,0)
 ;
"RTN","ORWDGX",4,0)
ACT() N X,RSLT S X=^(0),RSLT=1
"RTN","ORWDGX",5,0)
 I "DQ"'[$P(X,U,4) S RSLT=0
"RTN","ORWDGX",6,0)
 S X1=$O(^ORD(100.98,"B","ACTIVITY",0))
"RTN","ORWDGX",7,0)
 S X2=$O(^ORD(100.98,"B","NURSING",0))
"RTN","ORWDGX",8,0)
 I "DQ"'[$P(X,U,4) S RSLT=0
"RTN","ORWDGX",9,0)
 I RSLT,((U_X1_U_X2_U)'[(U_$P(X,U,5)_U)) S RSLT=0
"RTN","ORWDGX",10,0)
 Q RSLT
"RTN","ORWDGX",11,0)
NURS() N X,RSLT S X=^(0),RSLT=1
"RTN","ORWDGX",12,0)
 I "DQ"'[$P(X,U,4) S RSLT=0
"RTN","ORWDGX",13,0)
 I RSLT,($P(X,U,5)'=$O(^ORD(100.98,"B","NURSING",0))) S RSLT=0
"RTN","ORWDGX",14,0)
 Q RSLT
"RTN","ORWDGX",15,0)
OITEXT(Y,DLG)    ; Return Orderable Item Text given dialog or quick order
"RTN","ORWDGX",16,0)
 S Y=$P(^ORD(101.41,DLG,0),U,2)
"RTN","ORWDGX",17,0)
 Q
"RTN","ORWDGX",18,0)
LOAD(LST,PAR)          ; Load a list of activity orders
"RTN","ORWDGX",19,0)
 N I,ILST,DLG,NAM,TLST
"RTN","ORWDGX",20,0)
 D GETLST^XPAR(.TLST,"ALL",PAR)
"RTN","ORWDGX",21,0)
 S I=0,ILST=0 F  S I=$O(TLST(I)) Q:'I  D
"RTN","ORWDGX",22,0)
 . S DLG=$P(TLST(I),U,2),NAM=$P(^ORD(101.41,+DLG,0),U,2)
"RTN","ORWDGX",23,0)
 . S ILST=ILST+1,LST(ILST)=DLG_U_NAM
"RTN","ORWDGX",24,0)
 Q
"RTN","ORWDGX",25,0)
 ;
"RTN","ORWDGX",26,0)
 N DLGTYP,OIDLG,FTDLG,OITYP,I,IFN
"RTN","ORWDGX",27,0)
 S DLGTYP=$P(^ORD(101.41,DLG,0),U,4)
"RTN","ORWDGX",28,0)
 S OIDLG=$O(^ORD(101.41,"B","OR GTX ORDERABLE ITEM",0))
"RTN","ORWDGX",29,0)
 S FTDLG=$O(^ORD(101.41,"B","OR GTX FREE TEXT OI",0))
"RTN","ORWDGX",30,0)
 I DLGTYP="D" D
"RTN","ORWDGX",31,0)
 . S I=0,IFN=0 F  S I=$O(^ORD(101.41,DLG,10,I)) S X=^(I,0) D  Q:IFN
"RTN","ORWDGX",32,0)
 . . I $P(X,U,2)=OIDLG S IFN=I,OITYP="O"
"RTN","ORWDGX",33,0)
 . . I $P(X,U,2)=FTDLG S IFN=I,OITYP="F"
"RTN","ORWDGX",34,0)
 . S Y="" I $L($G(^ORD(101.41,DLG,10,IFN,7))) X ^(7)
"RTN","ORWDGX",35,0)
 . I OITYP="O" S Y=$P(^ORD(101.43,+Y,0),U,1)
"RTN","ORWDGX",36,0)
 Q
"RTN","ORWDGX",37,0)
VMDEF(LST)         ; Return dialog definition for vitals/measurements
"RTN","ORWDGX",38,0)
 N ILST S ILST=0
"RTN","ORWDGX",39,0)
 S LST($$NXT)="~Measurements" D MEASURE
"RTN","ORWDGX",40,0)
 S LST($$NXT)="~Schedules" D VMSCHED
"RTN","ORWDGX",41,0)
 Q
"RTN","ORWDGX",42,0)
MEASURE ; Get measurements available
"RTN","ORWDGX",43,0)
 S X="" F  S X=$O(^ORD(101.43,"S.V/M",X)) Q:X=""  D
"RTN","ORWDGX",44,0)
 . S I=$O(^ORD(101.43,"S.V/M",X,0)),LST($$NXT)="i"_I_U_X
"RTN","ORWDGX",45,0)
 S LST($$NXT)="dTPR B/P"      ; ** do this with a parameter
"RTN","ORWDGX",46,0)
 Q
"RTN","ORWDGX",47,0)
VMSCHED ; Get vitals/measurements schedules
"RTN","ORWDGX",48,0)
 K ^TMP($J,"ORWDGX APGMRV")
"RTN","ORWDGX",49,0)
 D AP^PSS51P1("GMRV",,,,"ORWDGX APGMRV")
"RTN","ORWDGX",50,0)
 S X="" F  S X=$O(^TMP($J,"ORWDGX APGMRV","APGMRV",X)) Q:X=""  D
"RTN","ORWDGX",51,0)
 . S I=$O(^TMP($J,"ORWDGX APGMRV","APGMRV",X,0)),LST($$NXT)="i"_I_U_X
"RTN","ORWDGX",52,0)
 K ^TMP($J,"ORWDGX APGMRV")
"RTN","ORWDGX",53,0)
 Q
"RTN","ORWDGX",54,0)
NXT() ; Increment index into LST
"RTN","ORWDGX",55,0)
 S ILST=ILST+1
"RTN","ORWDGX",56,0)
 Q ILST
"RTN","ORWDLR")
0^5^B25735868
"RTN","ORWDLR",1,0)
ORWDLR ; SLC/KCM - Lab Calls [ 08/04/96  8:47 PM ]
"RTN","ORWDLR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORWDLR",3,0)
 ;
"RTN","ORWDLR",4,0)
DEF(LST,ALOC) ; procedure
"RTN","ORWDLR",5,0)
 ; get dialog definition specific to lab
"RTN","ORWDLR",6,0)
 S ILST=0
"RTN","ORWDLR",7,0)
 S LST($$NXT)="~Collection Times" D COLLTM
"RTN","ORWDLR",8,0)
 S LST($$NXT)="~Send Patient Times" D SENDTM
"RTN","ORWDLR",9,0)
 S LST($$NXT)="~Default Urgency="_$$DEFURG^LR7OR3
"RTN","ORWDLR",10,0)
 ; S LST($$NXT)="~Urgencies Map" D URGMAP
"RTN","ORWDLR",11,0)
 S LST($$NXT)="~Schedules" D SCHED
"RTN","ORWDLR",12,0)
 S LST($$NXT)="~Common" D COMMON
"RTN","ORWDLR",13,0)
 Q
"RTN","ORWDLR",14,0)
COLLTM ; get collection times
"RTN","ORWDLR",15,0)
 N TDAY,TMRW,IGNOR,CNT,ICTM,CTM,DOW,AMPM,DAY,TIME,FMDT
"RTN","ORWDLR",16,0)
 S TDAY=DT,TDAY("DOW")=$H#7,TDAY("H")=$H
"RTN","ORWDLR",17,0)
 M TMRW=TDAY D INCDATE(.TMRW)
"RTN","ORWDLR",18,0)
 I $G(ALOC),'$$GET^XPAR(ALOC_";SC(","LR EXCEPTED LOCATIONS",1,"Q") D
"RTN","ORWDLR",19,0)
 . S IGNOR=$$GET^XPAR("ALL","LR IGNORE HOLIDAYS",1,"Q")
"RTN","ORWDLR",20,0)
 . S DOW(0)=$$GET^XPAR("ALL","LR COLLECT THURSDAY",1,"Q")
"RTN","ORWDLR",21,0)
 . S DOW(1)=$$GET^XPAR("ALL","LR COLLECT FRIDAY",1,"Q")
"RTN","ORWDLR",22,0)
 . S DOW(2)=$$GET^XPAR("ALL","LR COLLECT SATURDAY",1,"Q")
"RTN","ORWDLR",23,0)
 . S DOW(3)=$$GET^XPAR("ALL","LR COLLECT SUNDAY",1,"Q")
"RTN","ORWDLR",24,0)
 . S DOW(4)=$$GET^XPAR("ALL","LR COLLECT MONDAY",1,"Q")
"RTN","ORWDLR",25,0)
 . S DOW(5)=$$GET^XPAR("ALL","LR COLLECT TUESDAY",1,"Q")
"RTN","ORWDLR",26,0)
 . S DOW(6)=$$GET^XPAR("ALL","LR COLLECT WEDNESDAY",1,"Q")
"RTN","ORWDLR",27,0)
 . S CNT=0 F  Q:(DOW(TDAY("DOW"))=1)&((IGNOR=1)!('$D(^HOLIDAY(TDAY,0))))  D  Q:CNT>6
"RTN","ORWDLR",28,0)
 . . D INCDATE(.TDAY) S CNT=CNT+1
"RTN","ORWDLR",29,0)
 . S CNT=0 F  Q:(DOW(TMRW("DOW"))=1)&((IGNOR=1)!('$D(^HOLIDAY(TMRW,0))))  D  Q:CNT>6
"RTN","ORWDLR",30,0)
 . . D INCDATE(.TMRW) S CNT=CNT+1
"RTN","ORWDLR",31,0)
 D GETLST^XPAR(.CTM,"ALL","LR PHLEBOTOMY COLLECTION","Q")
"RTN","ORWDLR",32,0)
 S ICTM=0 F  S ICTM=$O(CTM(ICTM)) Q:'ICTM  D
"RTN","ORWDLR",33,0)
 . I $P(CTM(ICTM),U)>$P($H,",",2) D
"RTN","ORWDLR",34,0)
 . . S FMDT=TDAY
"RTN","ORWDLR",35,0)
 . . I +TDAY("H")=+$H S DAY="Today"
"RTN","ORWDLR",36,0)
 . . I TDAY("H")-$H=1 S DAY="Tomorrow"
"RTN","ORWDLR",37,0)
 . . I TDAY("H")-$H>1 S DAY=$$DOWNAME(TDAY("DOW"))
"RTN","ORWDLR",38,0)
 . E  D
"RTN","ORWDLR",39,0)
 . . S FMDT=TMRW
"RTN","ORWDLR",40,0)
 . . S DAY=$S(TMRW("H")-$H>1:$$DOWNAME(TMRW("DOW")),1:"Tomorrow")
"RTN","ORWDLR",41,0)
 . S AMPM=$S($P(CTM(ICTM),U,2)>1159:"PM",1:"AM")
"RTN","ORWDLR",42,0)
 . S FMDT=FMDT_"."_$P(CTM(ICTM),"^",2)
"RTN","ORWDLR",43,0)
 . S TIME=$P(CTM(ICTM),U,2),TIME=$E(TIME,1,2)_":"_$E(TIME,3,4)
"RTN","ORWDLR",44,0)
 . S LST($$NXT)="iL"_FMDT_U_AMPM_" Collection: "_TIME_" ("_DAY_")"
"RTN","ORWDLR",45,0)
 D NOW^%DTC
"RTN","ORWDLR",46,0)
 S LST($$NXT)="iW"_%_"^Now (Collect on ward)"
"RTN","ORWDLR",47,0)
 Q
"RTN","ORWDLR",48,0)
SENDTM ; get send patient times
"RTN","ORWDLR",49,0)
 N X,X1,X2
"RTN","ORWDLR",50,0)
 S LST($$NXT)="iL"_DT_"^Today"
"RTN","ORWDLR",51,0)
 S X1=DT,X2=1 D C^%DTC
"RTN","ORWDLR",52,0)
 S LST($$NXT)="iL"_X_"^Tomorrow"
"RTN","ORWDLR",53,0)
 Q
"RTN","ORWDLR",54,0)
INCDATE(ADATE) ; called from COLLTM, increments date nodes in .ADATE
"RTN","ORWDLR",55,0)
 N X,X1,X2,%H
"RTN","ORWDLR",56,0)
 S X1=ADATE,X2=1 D C^%DTC S ADATE=X
"RTN","ORWDLR",57,0)
 S ADATE("H")=ADATE("H")+1
"RTN","ORWDLR",58,0)
 S ADATE("DOW")=ADATE("H")#7
"RTN","ORWDLR",59,0)
 Q
"RTN","ORWDLR",60,0)
DOWNAME(DOW) ; function
"RTN","ORWDLR",61,0)
 ; Returns Day of Week name (DOW should be $H#7)
"RTN","ORWDLR",62,0)
 I DOW=0 Q "Thursday"
"RTN","ORWDLR",63,0)
 I DOW=1 Q "Friday"
"RTN","ORWDLR",64,0)
 I DOW=2 Q "Saturday"
"RTN","ORWDLR",65,0)
 I DOW=3 Q "Sunday"
"RTN","ORWDLR",66,0)
 I DOW=4 Q "Monday"
"RTN","ORWDLR",67,0)
 I DOW=5 Q "Tuesday"
"RTN","ORWDLR",68,0)
 I DOW=6 Q "Wednesday"
"RTN","ORWDLR",69,0)
 Q ""
"RTN","ORWDLR",70,0)
URGMAP ; return list of lab urgencies mapped to OE/RR urgencies
"RTN","ORWDLR",71,0)
 Q
"RTN","ORWDLR",72,0)
 N I,X
"RTN","ORWDLR",73,0)
 S I=0 F  S I=$O(^LAB(62.05,I)) Q:'I  S X=^(I,0) I '$P(X,U,3) D
"RTN","ORWDLR",74,0)
 . S LST($$NXT)="i"_I_"="_I_U_$P(X,U)
"RTN","ORWDLR",75,0)
 ; D GETLST^XPAR(.Y,"ALL","ORCDLR URGENCIES","N")
"RTN","ORWDLR",76,0)
 ; S URG=0 F  S URG=$O(Y(URG)) Q:'URG  S LST($$NXT)="i"_URG_"="_Y(URG)
"RTN","ORWDLR",77,0)
 Q
"RTN","ORWDLR",78,0)
SCHED ; return list of schedules available for lab tests
"RTN","ORWDLR",79,0)
 N X,IEN
"RTN","ORWDLR",80,0)
 K ^TMP($J,"ORWDLR APLR")
"RTN","ORWDLR",81,0)
 D AP^PSS51P1("LR",,,,"ORWDLR APLR")
"RTN","ORWDLR",82,0)
 S X="" F  S X=$O(^TMP($J,"ORWDLR APLR","APLR",X)) Q:X=""  D
"RTN","ORWDLR",83,0)
 . S IEN=$O(^TMP($J,"ORWDLR APLR","APLR",X,"")) I IEN'>0 Q
"RTN","ORWDLR",84,0)
 . S LST($$NXT)="i"_IEN_U_X_U_$P($G(^TMP($J,"ORWDLR APLR",IEN,5)),U)
"RTN","ORWDLR",85,0)
 . I X="ONE TIME" S LST($$NXT)="d"_X
"RTN","ORWDLR",86,0)
 K ^TMP($J,"ORWDLR APLR")
"RTN","ORWDLR",87,0)
 Q
"RTN","ORWDLR",88,0)
COMMON ; return list of commonly ordered lab tests
"RTN","ORWDLR",89,0)
 N TMPLST,IEN,I
"RTN","ORWDLR",90,0)
 D GETLST^XPAR(.TMPLST,"ALL","ORWD COMMON LAB INPT")
"RTN","ORWDLR",91,0)
 S I=0 F  S I=$O(TMPLST(I)) Q:'I  D
"RTN","ORWDLR",92,0)
 . S IEN=$P(TMPLST(I),U,2)
"RTN","ORWDLR",93,0)
 . S LST($$NXT)="i"_IEN_U_$P(^ORD(101.43,IEN,0),U,1)
"RTN","ORWDLR",94,0)
 Q
"RTN","ORWDLR",95,0)
LOAD(LST,TESTID) ; procedure
"RTN","ORWDLR",96,0)
 ; Return sample, specimen, & urgency info about a lab test
"RTN","ORWDLR",97,0)
 N X,Y,ILST,PARAM S ILST=0
"RTN","ORWDLR",98,0)
 S LST($$NXT)="~Test Name="_$P(^ORD(101.43,TESTID,0),U,1)
"RTN","ORWDLR",99,0)
 I $D(^ORD(101.43,TESTID,8))>1 S LST($$NXT)="~OIMessage"
"RTN","ORWDLR",100,0)
 S I=0 F  S I=$O(^ORD(101.43,TESTID,8,I)) Q:'I  S LST($$NXT)="t"_^(I,0)
"RTN","ORWDLR",101,0)
 S TESTID=+$P(^ORD(101.43,TESTID,0),U,2)
"RTN","ORWDLR",102,0)
 D TEST^LR7OR3(TESTID,.Y)
"RTN","ORWDLR",103,0)
 S PARAM="" F  S PARAM=$O(Y(PARAM)) Q:PARAM=""  D
"RTN","ORWDLR",104,0)
 . S LST($$NXT)="~"_PARAM_$S($D(Y(PARAM))>1:"",1:"="_$G(Y(PARAM)))
"RTN","ORWDLR",105,0)
 . I $D(Y(PARAM))>1 S I=0 F  S I=$O(Y(PARAM,I)) Q:'I  D
"RTN","ORWDLR",106,0)
 . . I PARAM="Specimens" S LST($$NXT)="i"_Y(PARAM,I) Q
"RTN","ORWDLR",107,0)
 . . I PARAM="Urgencies" S LST($$NXT)="i"_Y(PARAM,I) Q
"RTN","ORWDLR",108,0)
 . . S LST($$NXT)="i"_I_U_Y(PARAM,I)
"RTN","ORWDLR",109,0)
 . . I PARAM="CollSamp" D
"RTN","ORWDLR",110,0)
 . . . I $G(Y("Lab CollSamp")) S $P(LST(ILST),U,8)=1
"RTN","ORWDLR",111,0)
 . . . S X=+$P(Y(PARAM,I),U,3)
"RTN","ORWDLR",112,0)
 . . . I X S $P(LST(ILST),U,10)=$P($G(^LAB(61,X,0)),U,1)
"RTN","ORWDLR",113,0)
 . . I $D(Y(PARAM,I,"WP")) S J=0 F  S J=$O(Y(PARAM,I,"WP",J)) Q:'J  D
"RTN","ORWDLR",114,0)
 . . . S LST($$NXT)="t"_Y(PARAM,I,"WP",J,0)
"RTN","ORWDLR",115,0)
 Q
"RTN","ORWDLR",116,0)
ALLSAMP(LST) ; procedure
"RTN","ORWDLR",117,0)
 ; returns all collection samples
"RTN","ORWDLR",118,0)
 ; n^SampIEN^SampName^SpecPtr^TubeTop^^^LabCollect^^SpecName
"RTN","ORWDLR",119,0)
 N SMP,SPC,ILST,IEN,X,X0
"RTN","ORWDLR",120,0)
 S ILST=0,LST($$NXT)="~CollSamp"
"RTN","ORWDLR",121,0)
 S SMP="" F  S SMP=$O(^LAB(62,"B",SMP)) Q:SMP=""  D
"RTN","ORWDLR",122,0)
 . S IEN=0 F  S IEN=$O(^LAB(62,"B",SMP,IEN)) Q:'IEN  D
"RTN","ORWDLR",123,0)
 . . S X0=^LAB(62,IEN,0)
"RTN","ORWDLR",124,0)
 . . S X="i"_U_IEN_U_SMP_U_$P(X0,U,2)_U_$P(X0,U,3)_U_U_U_$P(X0,U,7)
"RTN","ORWDLR",125,0)
 . . I $P(X0,U,2) D
"RTN","ORWDLR",126,0)
 . . . S $P(X,U,10)=$P(^LAB(61,+$P(X0,U,2),0),U,1)
"RTN","ORWDLR",127,0)
 . . . S SPC($P(X,U,4))=$P(X,U,10)
"RTN","ORWDLR",128,0)
 . . S LST($$NXT)=X
"RTN","ORWDLR",129,0)
 S LST($$NXT)="~Specimens"
"RTN","ORWDLR",130,0)
 S SPC=0 F  S SPC=$O(SPC(SPC)) Q:'SPC  S LST($$NXT)=SPC_U_SPC(SPC)
"RTN","ORWDLR",131,0)
 Q
"RTN","ORWDLR",132,0)
ABBSPEC(LST) ; procedure
"RTN","ORWDLR",133,0)
 ; returns specimens with abbreviation (uses 'E' xref)
"RTN","ORWDLR",134,0)
 N X,IEN,ILST S ILST=0
"RTN","ORWDLR",135,0)
 S X="" F  S X=$O(^LAB(61,"E",X)) Q:X=""  S IEN=$O(^(X,0)) D
"RTN","ORWDLR",136,0)
 . S LST($$NXT)=IEN_U_$P(^LAB(61,IEN,0),U,1)
"RTN","ORWDLR",137,0)
 Q
"RTN","ORWDLR",138,0)
NXT() ; called by TESTINFO, increments ILST
"RTN","ORWDLR",139,0)
 S ILST=ILST+1
"RTN","ORWDLR",140,0)
 Q ILST
"RTN","ORWDLR",141,0)
STOP(VAL,X2)       ; return a calculated stop date
"RTN","ORWDLR",142,0)
 N X1,X
"RTN","ORWDLR",143,0)
 S X1=DT D C^%DTC S VAL=X
"RTN","ORWDLR",144,0)
 Q
"RTN","ORWDLR32")
0^6^B60083103
"RTN","ORWDLR32",1,0)
ORWDLR32 ; SLC/KCM/REV/JDL - Lab Calls 6/28/2002
"RTN","ORWDLR32",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,141,215,250,243**;Dec 17, 1997;Build 242
"RTN","ORWDLR32",3,0)
 ;
"RTN","ORWDLR32",4,0)
 ; DBIA 2263   GETLST^XPAR  ^TMP($J,"WC")
"RTN","ORWDLR32",5,0)
 ;
"RTN","ORWDLR32",6,0)
DEF(LST,ALOC,ADIV) ; procedure
"RTN","ORWDLR32",7,0)
 ; For Event Delay Order
"RTN","ORWDLR32",8,0)
 ;  ALOC: Delay Event's default location
"RTN","ORWDLR32",9,0)
 ;  ADIV: Delay Event's default division
"RTN","ORWDLR32",10,0)
 ; get dialog definition specific to lab
"RTN","ORWDLR32",11,0)
 S ILST=0
"RTN","ORWDLR32",12,0)
 S LST($$NXT)="~ShortList" D SHORT
"RTN","ORWDLR32",13,0)
 S LST($$NXT)="~Lab Collection Times" D LCOLLTM
"RTN","ORWDLR32",14,0)
 S LST($$NXT)="~Ward Collection Times" D WCOLLTM
"RTN","ORWDLR32",15,0)
 S LST($$NXT)="~Send Patient Times" D SENDTM
"RTN","ORWDLR32",16,0)
 S LST($$NXT)="~Collection Types" D COLLTYP
"RTN","ORWDLR32",17,0)
 S LST($$NXT)="~Default Urgency" D URGENCY
"RTN","ORWDLR32",18,0)
 S LST($$NXT)="~Schedules" D SCHED
"RTN","ORWDLR32",19,0)
 S LST($$NXT)="~Common" D COMMON
"RTN","ORWDLR32",20,0)
 Q
"RTN","ORWDLR32",21,0)
SHORT ; from DEF, get short list of lab quick orders
"RTN","ORWDLR32",22,0)
 N I,ORTMP,ORDG,A
"RTN","ORWDLR32",23,0)
 S I=$O(^ORD(100.98,"B","LAB",0))  ; get IEN of parent lab
"RTN","ORWDLR32",24,0)
 D DG^ORCHANG1(I,"BILD",.ORDG)   ; find members groups for parent lab
"RTN","ORWDLR32",25,0)
 S I=0
"RTN","ORWDLR32",26,0)
 F  S I=$O(ORDG(I)) Q:'I  D   ; loop through list of members groups
"RTN","ORWDLR32",27,0)
 . I $E($P($G(^ORD(100.98,I,0)),"^",3),1,2)="VB" Q
"RTN","ORWDLR32",28,0)
 . D GETQLST^ORWDXQ(.ORTMP,I,"Q")   ;get quick order of each members groups
"RTN","ORWDLR32",29,0)
 . S A=0 F  S A=$O(ORTMP(A)) Q:'A  D   ; loop through returned quick orders and
"RTN","ORWDLR32",30,0)
 . . S LST($$NXT)="i"_ORTMP(A)  ; move quick orders to display list
"RTN","ORWDLR32",31,0)
 . K ORTMP   ; clean up for next members groups of quick orders
"RTN","ORWDLR32",32,0)
 Q
"RTN","ORWDLR32",33,0)
LCOLLTM ; get collection times
"RTN","ORWDLR32",34,0)
 N TDAY,TMRW,IGNOR,CNT,ICTM,ORCTM,DOW,AMPM,DAY,TIME,TXDT
"RTN","ORWDLR32",35,0)
 S TDAY=DT,TDAY("DOW")=$H#7,TDAY("H")=$H,TDAY("TX")="T"
"RTN","ORWDLR32",36,0)
 M TMRW=TDAY D INCDATE(.TMRW)
"RTN","ORWDLR32",37,0)
 I $G(ALOC),'$$GET^XPAR(ALOC_";SC(","LR EXCEPTED LOCATIONS",1,"Q") D
"RTN","ORWDLR32",38,0)
 . S IGNOR=$$GET^XPAR("ALL","LR IGNORE HOLIDAYS",1,"Q")
"RTN","ORWDLR32",39,0)
 . S DOW(0)=$$GET^XPAR("ALL","LR COLLECT THURSDAY",1,"Q")
"RTN","ORWDLR32",40,0)
 . S DOW(1)=$$GET^XPAR("ALL","LR COLLECT FRIDAY",1,"Q")
"RTN","ORWDLR32",41,0)
 . S DOW(2)=$$GET^XPAR("ALL","LR COLLECT SATURDAY",1,"Q")
"RTN","ORWDLR32",42,0)
 . S DOW(3)=$$GET^XPAR("ALL","LR COLLECT SUNDAY",1,"Q")
"RTN","ORWDLR32",43,0)
 . S DOW(4)=$$GET^XPAR("ALL","LR COLLECT MONDAY",1,"Q")
"RTN","ORWDLR32",44,0)
 . S DOW(5)=$$GET^XPAR("ALL","LR COLLECT TUESDAY",1,"Q")
"RTN","ORWDLR32",45,0)
 . S DOW(6)=$$GET^XPAR("ALL","LR COLLECT WEDNESDAY",1,"Q")
"RTN","ORWDLR32",46,0)
 . S CNT=0 F  Q:(DOW(TDAY("DOW"))=1)&((IGNOR=1)!('$D(^HOLIDAY(TDAY,0))))  D  Q:CNT>6
"RTN","ORWDLR32",47,0)
 . . D INCDATE(.TDAY) S CNT=CNT+1
"RTN","ORWDLR32",48,0)
 . S CNT=0 F  Q:(DOW(TMRW("DOW"))=1)&((IGNOR=1)!('$D(^HOLIDAY(TMRW,0))))  D  Q:CNT>6
"RTN","ORWDLR32",49,0)
 . . D INCDATE(.TMRW) S CNT=CNT+1
"RTN","ORWDLR32",50,0)
 I $G(ADIV) D GETLST^XPAR(.ORCTM,ADIV_";DIC(4,^SYS","LR PHLEBOTOMY COLLECTION","Q")
"RTN","ORWDLR32",51,0)
 E  D GETLST^XPAR(.ORCTM,"ALL","LR PHLEBOTOMY COLLECTION","Q")
"RTN","ORWDLR32",52,0)
 ;S DUZ(2)=TMPDIV
"RTN","ORWDLR32",53,0)
 S LST($$NXT)="iLNEXT^Next scheduled lab collection"
"RTN","ORWDLR32",54,0)
 S ICTM=0 F  S ICTM=$O(ORCTM(ICTM)) Q:'ICTM  D
"RTN","ORWDLR32",55,0)
 . I $P(ORCTM(ICTM),U)>$P($H,",",2) D
"RTN","ORWDLR32",56,0)
 . . S TXDT=TDAY("TX")
"RTN","ORWDLR32",57,0)
 . . I +TDAY("H")=+$H S DAY="Today"
"RTN","ORWDLR32",58,0)
 . . I TDAY("H")-$H=1 S DAY="Tomorrow"
"RTN","ORWDLR32",59,0)
 . . I TDAY("H")-$H>1 S DAY=$$DOWNAME(TDAY("DOW"))
"RTN","ORWDLR32",60,0)
 . E  D
"RTN","ORWDLR32",61,0)
 . . S TXDT=TMRW("TX")
"RTN","ORWDLR32",62,0)
 . . S DAY=$S(TMRW("H")-$H>1:$$DOWNAME(TMRW("DOW")),1:"Tomorrow")
"RTN","ORWDLR32",63,0)
 . S AMPM=$S($P(ORCTM(ICTM),U,2)>1159:"PM",1:"AM")
"RTN","ORWDLR32",64,0)
 . S TXDT=TXDT_"@"_$P(ORCTM(ICTM),"^",2)
"RTN","ORWDLR32",65,0)
 . S TIME=$P(ORCTM(ICTM),U,2),TIME=$E(TIME,1,2)_":"_$E(TIME,3,4)
"RTN","ORWDLR32",66,0)
 . S LST($$NXT)="iL"_TXDT_U_AMPM_" Collection: "_TIME_" ("_DAY_")"
"RTN","ORWDLR32",67,0)
 . S ^TMP($J,"WC",ILST)="iW"_TXDT_U_TIME_" "_AMPM_" ("_DAY_") Ward collect"  ;DBIA 2263
"RTN","ORWDLR32",68,0)
 ; D NOW^%DTC
"RTN","ORWDLR32",69,0)
 ;S LST($$NXT)="iWNOW^Now (Collect on ward)"
"RTN","ORWDLR32",70,0)
 S LST($$NXT)="iLO^Future"
"RTN","ORWDLR32",71,0)
 Q
"RTN","ORWDLR32",72,0)
WCOLLTM ; get Ward Collect times
"RTN","ORWDLR32",73,0)
 S I=""
"RTN","ORWDLR32",74,0)
 F  S I=$O(^TMP($J,"WC",I)) Q:I=""  D
"RTN","ORWDLR32",75,0)
 . S LST($$NXT)=^TMP($J,"WC",I)
"RTN","ORWDLR32",76,0)
 S LST($$NXT)="iWNOW^Now (Collect on ward)"
"RTN","ORWDLR32",77,0)
 ;S LST($$NXT)="iWO^Other"
"RTN","ORWDLR32",78,0)
 K ^TMP($J,"WC")
"RTN","ORWDLR32",79,0)
 Q
"RTN","ORWDLR32",80,0)
SENDTM ; get send patient times
"RTN","ORWDLR32",81,0)
 ;N X,X1,X2
"RTN","ORWDLR32",82,0)
 S LST($$NXT)="iLT^Today"
"RTN","ORWDLR32",83,0)
 ;S X1=DT,X2=1 D C^%DTC
"RTN","ORWDLR32",84,0)
 S LST($$NXT)="iLT+1^Tomorrow"
"RTN","ORWDLR32",85,0)
 ;S LST($$NXT)="iLO^Other"
"RTN","ORWDLR32",86,0)
 Q
"RTN","ORWDLR32",87,0)
COLLTYP ; Collection Types in effect for this division
"RTN","ORWDLR32",88,0)
 N Y S Y=""
"RTN","ORWDLR32",89,0)
 S LST($$NXT)="iLC^Lab Collect"
"RTN","ORWDLR32",90,0)
 S LST($$NXT)="iWC^Ward Collect"
"RTN","ORWDLR32",91,0)
 S LST($$NXT)="iSP^Send Patient to Lab"
"RTN","ORWDLR32",92,0)
 I +$$ON^LR7OV4(DUZ(2)) S LST($$NXT)="iI^Immediate Collect"
"RTN","ORWDLR32",93,0)
 S:$G(ALOC) Y=$$GET^XPAR("ALL^"_ALOC_";SC(","LR DEFAULT TYPE QUICK")
"RTN","ORWDLR32",94,0)
 I $L(Y) S LST($$NXT)="d"_Y
"RTN","ORWDLR32",95,0)
 Q
"RTN","ORWDLR32",96,0)
INCDATE(ADATE) ; called from COLLTM, increments date nodes in .ADATE
"RTN","ORWDLR32",97,0)
 N X,X1,X2,%H
"RTN","ORWDLR32",98,0)
 S X1=ADATE,X2=1 D C^%DTC S ADATE=X
"RTN","ORWDLR32",99,0)
 S ADATE("H")=ADATE("H")+1
"RTN","ORWDLR32",100,0)
 S ADATE("DOW")=ADATE("H")#7
"RTN","ORWDLR32",101,0)
 S ADATE("TX")="T+"_($P(ADATE("TX"),"+",2)+1)
"RTN","ORWDLR32",102,0)
 Q
"RTN","ORWDLR32",103,0)
DOWNAME(DOW) ; function
"RTN","ORWDLR32",104,0)
 ; Returns Day of Week name (DOW should be $H#7)
"RTN","ORWDLR32",105,0)
 I DOW=0 Q "Thursday"
"RTN","ORWDLR32",106,0)
 I DOW=1 Q "Friday"
"RTN","ORWDLR32",107,0)
 I DOW=2 Q "Saturday"
"RTN","ORWDLR32",108,0)
 I DOW=3 Q "Sunday"
"RTN","ORWDLR32",109,0)
 I DOW=4 Q "Monday"
"RTN","ORWDLR32",110,0)
 I DOW=5 Q "Tuesday"
"RTN","ORWDLR32",111,0)
 I DOW=6 Q "Wednesday"
"RTN","ORWDLR32",112,0)
 Q ""
"RTN","ORWDLR32",113,0)
URGENCY ; return default urgency for lab
"RTN","ORWDLR32",114,0)
 N URG
"RTN","ORWDLR32",115,0)
 S URG=$$DEFURG^LR7OR3
"RTN","ORWDLR32",116,0)
 S LST($$NXT)="i"_URG_U_$P(^LAB(62.05,URG,0),U,1)
"RTN","ORWDLR32",117,0)
 S LST($$NXT)="d"_URG_U_$P(^LAB(62.05,URG,0),U,1)
"RTN","ORWDLR32",118,0)
 Q
"RTN","ORWDLR32",119,0)
SCHED ; return list of schedules available for lab tests
"RTN","ORWDLR32",120,0)
 N X,X0,IEN,TYPE,FREQ
"RTN","ORWDLR32",121,0)
 K ^TMP($J,"ORWDLR32 APLR")
"RTN","ORWDLR32",122,0)
 D AP^PSS51P1("LR",,,,"ORWDLR32 APLR")
"RTN","ORWDLR32",123,0)
 S X="" F  S X=$O(^TMP($J,"ORWDLR32 APLR","APLR",X)) Q:X=""  D
"RTN","ORWDLR32",124,0)
 .S IEN=$O(^TMP($J,"ORWDLR32 APLR","APLR",X,"")) I IEN'>0 Q
"RTN","ORWDLR32",125,0)
 .S TYPE=$P($G(^TMP($J,"ORWDLR32 APLR",IEN,5)),U)
"RTN","ORWDLR32",126,0)
 .S FREQ=+$G(^TMP($J,"ORWDLR32 APLR",IEN,2))
"RTN","ORWDLR32",127,0)
 .I ((TYPE="C")!(TYPE="D")),FREQ=0 Q
"RTN","ORWDLR32",128,0)
 .S LST($$NXT)="i"_IEN_U_X_U_TYPE_U_FREQ
"RTN","ORWDLR32",129,0)
 .I X="ONE TIME" S LST($$NXT)="d"_IEN_U_X
"RTN","ORWDLR32",130,0)
 K ^TMP($J,"ORWDLR32 APLR")
"RTN","ORWDLR32",131,0)
 Q
"RTN","ORWDLR32",132,0)
COMMON ; return list of commonly ordered lab tests
"RTN","ORWDLR32",133,0)
 N ORLST,IEN,I
"RTN","ORWDLR32",134,0)
 D GETLST^XPAR(.ORLST,"ALL","ORWD COMMON LAB INPT")  ;DBIA 2263
"RTN","ORWDLR32",135,0)
 S I=0 F  S I=$O(ORLST(I)) Q:'I  D
"RTN","ORWDLR32",136,0)
 . S IEN=$P(ORLST(I),U,2)
"RTN","ORWDLR32",137,0)
 . S LST($$NXT)="i"_IEN_U_$P(^ORD(101.43,IEN,0),U,1)
"RTN","ORWDLR32",138,0)
 Q
"RTN","ORWDLR32",139,0)
LOAD(LST,TESTID) ; procedure
"RTN","ORWDLR32",140,0)
 ; Return sample, specimen, & urgency info about a lab test
"RTN","ORWDLR32",141,0)
 N I,J,X,X1,X4,ORY,ORLABID,ILST,PARAM
"RTN","ORWDLR32",142,0)
 S ILST=0,X=$P(^ORD(101.43,TESTID,0),"^"),ORLABID=$P(^(0),U,2)
"RTN","ORWDLR32",143,0)
 S LST($$NXT)="~Test Name"
"RTN","ORWDLR32",144,0)
 S LST($$NXT)="d"_X
"RTN","ORWDLR32",145,0)
 S LST($$NXT)="~Item ID"
"RTN","ORWDLR32",146,0)
 S LST($$NXT)="d"_+ORLABID
"RTN","ORWDLR32",147,0)
 S X1=$S($P($P(^ORD(101.43,TESTID,0),U,2),";",2)="99VBC":$O(^LAB(60,"B",$P(^ORD(101.43,TESTID,0),"^")_" - LAB",0)),1:$P($P(^ORD(101.43,TESTID,0),U,2),";",1)) Q:'X1
"RTN","ORWDLR32",148,0)
 S X4=$P($G(^LAB(60,X1,0)),U,4)
"RTN","ORWDLR32",149,0)
 S LST(ILST)=LST(ILST)_U_X4
"RTN","ORWDLR32",150,0)
 I $D(^ORD(101.43,TESTID,8))>1 S LST($$NXT)="~OIMessage"
"RTN","ORWDLR32",151,0)
 S I=0 F  S I=$O(^ORD(101.43,TESTID,8,I)) Q:'I  S LST($$NXT)="t"_^(I,0)
"RTN","ORWDLR32",152,0)
 S TESTID=+$P(^ORD(101.43,TESTID,0),U,2)
"RTN","ORWDLR32",153,0)
 D TEST^LR7OR3(X1,.ORY)
"RTN","ORWDLR32",154,0)
 S PARAM="" F  S PARAM=$O(ORY(PARAM)) Q:PARAM=""  D
"RTN","ORWDLR32",155,0)
 . S LST($$NXT)="~"_PARAM
"RTN","ORWDLR32",156,0)
 . I PARAM="ReqCom" D
"RTN","ORWDLR32",157,0)
 . . S LST($$NXT)="d"_$G(ORY("ReqCom")) Q
"RTN","ORWDLR32",158,0)
 . I PARAM="Default CollSamp" D
"RTN","ORWDLR32",159,0)
 . . S LST($$NXT)="d"_$G(ORY("Default CollSamp")) Q
"RTN","ORWDLR32",160,0)
 . I PARAM="Unique CollSamp" D
"RTN","ORWDLR32",161,0)
 . . S LST($$NXT)="d"_$G(ORY("Unique CollSamp")) Q
"RTN","ORWDLR32",162,0)
 . I PARAM="Default Urgency" D
"RTN","ORWDLR32",163,0)
 . . S LST($$NXT)="d"_$G(ORY("Default Urgency")) Q
"RTN","ORWDLR32",164,0)
 . I PARAM="Lab CollSamp" D
"RTN","ORWDLR32",165,0)
 . . S LST($$NXT)="d"_$G(ORY("Lab CollSamp")) Q
"RTN","ORWDLR32",166,0)
 . I $D(ORY(PARAM))>1 S I=0 F  S I=$O(ORY(PARAM,I)) Q:'I  D
"RTN","ORWDLR32",167,0)
 . . I PARAM="Specimens" S LST($$NXT)="i"_ORY(PARAM,I) Q
"RTN","ORWDLR32",168,0)
 . . I PARAM="Urgencies" S LST($$NXT)="i"_ORY(PARAM,I) Q
"RTN","ORWDLR32",169,0)
 . . I PARAM="GenWardInstructions" S LST($$NXT)="t"_ORY(PARAM,I,0) Q
"RTN","ORWDLR32",170,0)
 . . S LST($$NXT)="i"_I_U_ORY(PARAM,I)
"RTN","ORWDLR32",171,0)
 . . I PARAM="CollSamp" D
"RTN","ORWDLR32",172,0)
 . . . I $G(ORY("Lab CollSamp")) S $P(LST(ILST),U,8)=1
"RTN","ORWDLR32",173,0)
 . . . S X=+$P(ORY(PARAM,I),U,3)
"RTN","ORWDLR32",174,0)
 . . . I X S $P(LST(ILST),U,10)=$P($G(^LAB(61,X,0)),U,1)
"RTN","ORWDLR32",175,0)
 . . I $D(ORY(PARAM,I,"WP")) S J=0 F  S J=$O(ORY(PARAM,I,"WP",J)) Q:'J  D
"RTN","ORWDLR32",176,0)
 . . . S LST($$NXT)="t"_ORY(PARAM,I,"WP",J,0)
"RTN","ORWDLR32",177,0)
 Q
"RTN","ORWDLR32",178,0)
ALLSAMP(LST) ; procedure
"RTN","ORWDLR32",179,0)
 ; returns all collection samples
"RTN","ORWDLR32",180,0)
 ; n^SampIEN^SampName^SpecPtr^TubeTop^^^LabCollect^^SpecName
"RTN","ORWDLR32",181,0)
 N SMP,SPC,ILST,IEN,X,X0
"RTN","ORWDLR32",182,0)
 S ILST=0,LST($$NXT)="~CollSamp"
"RTN","ORWDLR32",183,0)
 S SMP="" F  S SMP=$O(^LAB(62,"B",SMP)) Q:SMP=""  D
"RTN","ORWDLR32",184,0)
 . S IEN=0 F  S IEN=$O(^LAB(62,"B",SMP,IEN)) Q:'IEN  D
"RTN","ORWDLR32",185,0)
 . . S X0=^LAB(62,IEN,0)
"RTN","ORWDLR32",186,0)
 . . S X="i"_U_IEN_U_SMP_U_$P(X0,U,2)_U_$P(X0,U,3)_U_U_U_$P(X0,U,7)
"RTN","ORWDLR32",187,0)
 . . I $P(X0,U,2) D
"RTN","ORWDLR32",188,0)
 . . . S $P(X,U,10)=$P(^LAB(61,+$P(X0,U,2),0),U,1)
"RTN","ORWDLR32",189,0)
 . . . S SPC($P(X,U,4))=$P(X,U,10)
"RTN","ORWDLR32",190,0)
 . . S LST($$NXT)=X
"RTN","ORWDLR32",191,0)
 S LST($$NXT)="~Specimens"
"RTN","ORWDLR32",192,0)
 S SPC=0 F  S SPC=$O(SPC(SPC)) Q:'SPC  S LST($$NXT)=SPC_U_SPC(SPC)
"RTN","ORWDLR32",193,0)
 Q
"RTN","ORWDLR32",194,0)
ONESAMP(LST,IEN) ;Return data for one colelction sample
"RTN","ORWDLR32",195,0)
 ; n^SampIEN^SampName^SpecPtr^TubeTop^^^LabCollect^^SpecName
"RTN","ORWDLR32",196,0)
 N SPC,ILST,X,X0
"RTN","ORWDLR32",197,0)
 Q:+$G(IEN)=0
"RTN","ORWDLR32",198,0)
 S ILST=0,LST($$NXT)="~CollSamp"
"RTN","ORWDLR32",199,0)
 S X0=^LAB(62,IEN,0)
"RTN","ORWDLR32",200,0)
 S X="i1"_U_IEN_U_$P(X0,U,1)_U_$P(X0,U,2)_U_$P(X0,U,3)_U_U_U_$P(X0,U,7)
"RTN","ORWDLR32",201,0)
 I $P(X0,U,2) D
"RTN","ORWDLR32",202,0)
 . S $P(X,U,10)=$P(^LAB(61,+$P(X0,U,2),0),U,1)
"RTN","ORWDLR32",203,0)
 . S SPC($P(X,U,4))=$P(X,U,10)
"RTN","ORWDLR32",204,0)
 S LST($$NXT)=X
"RTN","ORWDLR32",205,0)
 S LST($$NXT)="~Specimens"
"RTN","ORWDLR32",206,0)
 S SPC=0 F  S SPC=$O(SPC(SPC)) Q:'SPC  S LST($$NXT)=SPC_U_SPC(SPC)
"RTN","ORWDLR32",207,0)
 Q
"RTN","ORWDLR32",208,0)
ONESPEC(LST,IEN) ;return one specimen
"RTN","ORWDLR32",209,0)
 Q:(+$G(IEN)=0)!('$D(^LAB(61,IEN,0)))
"RTN","ORWDLR32",210,0)
 S LST=IEN_U_$P(^LAB(61,IEN,0),U,1)
"RTN","ORWDLR32",211,0)
 Q
"RTN","ORWDLR32",212,0)
ABBSPEC(LST) ; procedure
"RTN","ORWDLR32",213,0)
 ; returns specimens with abbreviation (uses 'E' xref)
"RTN","ORWDLR32",214,0)
 N X,IEN,ILST S ILST=0
"RTN","ORWDLR32",215,0)
 S X="" F  S X=$O(^LAB(61,"E",X)) Q:X=""  S IEN=$O(^(X,0)) D
"RTN","ORWDLR32",216,0)
 . S LST($$NXT)=IEN_U_$P(^LAB(61,IEN,0),U,1)
"RTN","ORWDLR32",217,0)
 Q
"RTN","ORWDLR32",218,0)
NXT() ; called by TESTINFO, increments ILST
"RTN","ORWDLR32",219,0)
 S ILST=ILST+1
"RTN","ORWDLR32",220,0)
 Q ILST
"RTN","ORWDLR32",221,0)
 ;
"RTN","ORWDLR33")
0^7^B20970855
"RTN","ORWDLR33",1,0)
ORWDLR33 ; SLC/KCM/REV/JDL - Lab Calls ; 7/1/2002 11AM
"RTN","ORWDLR33",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,141,243**;Dec 17, 1997;Build 242
"RTN","ORWDLR33",3,0)
 ;
"RTN","ORWDLR33",4,0)
STOP(VAL,X2)       ; return a calculated stop date
"RTN","ORWDLR33",5,0)
 N X1,X
"RTN","ORWDLR33",6,0)
 S X1=DT D C^%DTC S VAL=X
"RTN","ORWDLR33",7,0)
 Q
"RTN","ORWDLR33",8,0)
MAXDAYS(Y,LOC,SCHED) ; Return max number of days for a continuing order
"RTN","ORWDLR33",9,0)
 N TMP1,TMP2
"RTN","ORWDLR33",10,0)
 K ^TMP($J,"ORWDLR33 MAXDAYS")
"RTN","ORWDLR33",11,0)
 S TMP1=$$GET^XPAR("ALL^LOC.`"_+LOC,"LR MAX DAYS CONTINUOUS",1,"Q")
"RTN","ORWDLR33",12,0)
 I +TMP1=0 S Y="-1" Q
"RTN","ORWDLR33",13,0)
 I +$G(SCHED)>0 D ZERO^PSS51P1(SCHED,,,,"ORWDLR33 MAXDAYS") S TMP2=$G(^TMP($J,"ORWDLR33 MAXDAYS",SCHED,2.5)) K ^TMP($J,"ORWDLR33 MAXDAYS")
"RTN","ORWDLR33",14,0)
 E  S TMP2=0
"RTN","ORWDLR33",15,0)
 I +TMP1=0,+TMP2>0 S Y=TMP2 Q
"RTN","ORWDLR33",16,0)
 I +TMP2=0,+TMP1>0 S Y=TMP1 Q
"RTN","ORWDLR33",17,0)
 S Y=$S(+TMP1>+TMP2:+TMP2,+TMP2>+TMP1:+TMP1,+TMP1=+TMP2:+TMP1,1:0)
"RTN","ORWDLR33",18,0)
 K ^TMP($J,"ORWDLR33 MAXDAYS")
"RTN","ORWDLR33",19,0)
 Q
"RTN","ORWDLR33",20,0)
ALLSPEC(Y,FROM,DIR) ; Return a set of specimens from topography file
"RTN","ORWDLR33",21,0)
 N I,IEN,CNT S I=0,CNT=44
"RTN","ORWDLR33",22,0)
 F  Q:I'<CNT  S FROM=$O(^LAB(61,"B",FROM),DIR) Q:FROM=""  D
"RTN","ORWDLR33",23,0)
 . S IEN=0 F  S IEN=$O(^LAB(61,"B",FROM,IEN)) Q:'IEN  D
"RTN","ORWDLR33",24,0)
 . . S I=I+1,Y(I)=IEN_U_FROM_"  ("_$P($G(^LAB(61,IEN,0)),U,2)_")"
"RTN","ORWDLR33",25,0)
 Q
"RTN","ORWDLR33",26,0)
LABCOLTM(ORYN,ORDATE,ORLOC) ; Is this a routine lab collect time for this location?
"RTN","ORWDLR33",27,0)
 N ORDA,ORTI,ORDOW,ORCTM,I,X,Y
"RTN","ORWDLR33",28,0)
 S ORYN=0 Q:'$G(ORDATE)!($G(ORDATE)<0)!('$G(ORLOC))
"RTN","ORWDLR33",29,0)
 S ORDA=$P(ORDATE,".",1),ORTI=$P(ORDATE,".",2)
"RTN","ORWDLR33",30,0)
 S I=0 F  S I=$L(ORTI) Q:I>3  S ORTI=ORTI_"0"
"RTN","ORWDLR33",31,0)
 S X=ORDA D DW^%DTC S ORDOW=X
"RTN","ORWDLR33",32,0)
 D GETLST^XPAR(.ORCTM,"ALL","LR PHLEBOTOMY COLLECTION","Q")
"RTN","ORWDLR33",33,0)
 S I=0 F  S I=$O(ORCTM(I)) Q:'I  D
"RTN","ORWDLR33",34,0)
 . S:$P(ORCTM(I),U,2)=ORTI ORYN=1
"RTN","ORWDLR33",35,0)
 Q:ORYN=0
"RTN","ORWDLR33",36,0)
 I $G(ORLOC),$$GET^XPAR(ORLOC_";SC(","LR EXCEPTED LOCATIONS",1,"Q") S ORYN=1 Q
"RTN","ORWDLR33",37,0)
 I '$$GET^XPAR("ALL","LR IGNORE HOLIDAYS",1,"Q"),$D(^HOLIDAY(ORDA,0)) S ORYN=0 Q
"RTN","ORWDLR33",38,0)
 I $$GET^XPAR("ALL","LR COLLECT "_ORDOW,1,"Q") S ORYN=1 Q
"RTN","ORWDLR33",39,0)
 S ORYN=0
"RTN","ORWDLR33",40,0)
 Q
"RTN","ORWDLR33",41,0)
IMMCOLL(ORY) ; Return help screen showing immediate collect times
"RTN","ORWDLR33",42,0)
 D SHOW^LR7OV4(DUZ(2),.ORY)
"RTN","ORWDLR33",43,0)
 Q
"RTN","ORWDLR33",44,0)
ICDEFLT(ORY) ;Return default immediate collect time
"RTN","ORWDLR33",45,0)
 S ORY=$$DEFTIME^LR7OV4(DUZ(2))
"RTN","ORWDLR33",46,0)
 Q
"RTN","ORWDLR33",47,0)
ICVALID(ORY,ORTIME) ;Is the time a valid immediate collect time?
"RTN","ORWDLR33",48,0)
 S ORTIME=$P(ORTIME,".",1)_"."_$E($P(ORTIME,".",2),1,4)
"RTN","ORWDLR33",49,0)
 S ORY=$$VALID^LR7OV4(DUZ(2),ORTIME)
"RTN","ORWDLR33",50,0)
 Q
"RTN","ORWDLR33",51,0)
GETLABTM(ORY,ORDATE,ORLOC) ;Return list of lab collect times for a date and location
"RTN","ORWDLR33",52,0)
 N ORDA,ORTI,ORNOW,ORDOW,ORCTM,ORTI,X,%,%H
"RTN","ORWDLR33",53,0)
 S ORY(0)=0 Q:'$G(ORDATE)!($G(ORDATE)<0)!('$G(ORLOC))
"RTN","ORWDLR33",54,0)
 S ORDA=$P(ORDATE,".",1)
"RTN","ORWDLR33",55,0)
 S ORNOW=$$NOW^XLFDT,ORTI=$P(ORNOW,".",2)
"RTN","ORWDLR33",56,0)
 I ORDA<$P(ORNOW,".",1) S ORY(0)="-1^Dates in the past are not allowed." Q
"RTN","ORWDLR33",57,0)
 I '+$$GET^XPAR(ORLOC_";SC(","LR EXCEPTED LOCATIONS",1,"Q") D
"RTN","ORWDLR33",58,0)
 . S X=ORDA D DW^%DTC S ORDOW=X
"RTN","ORWDLR33",59,0)
 . I '+$$GET^XPAR("ALL","LR COLLECT "_ORDOW,1,"Q") S ORY(0)="-1^No collections on "_ORDOW Q
"RTN","ORWDLR33",60,0)
 . I '+$$GET^XPAR("ALL","LR IGNORE HOLIDAYS",1,"Q"),$D(^HOLIDAY(ORDA,0)) S ORY(0)="-1^No holiday collections" Q
"RTN","ORWDLR33",61,0)
 I +ORY(0)>-1 D 
"RTN","ORWDLR33",62,0)
 . D GETLST^XPAR(.ORY,"ALL","LR PHLEBOTOMY COLLECTION","Q")
"RTN","ORWDLR33",63,0)
 . I +$G(ORY)=0 S ORY(0)="-1^No lab collect times defined for this division" Q
"RTN","ORWDLR33",64,0)
 S I=0 F  S I=$O(ORY(I)) Q:'I  D
"RTN","ORWDLR33",65,0)
 . D NOW^%DTC S ORTI=%,%H=+%H_","_+ORY(I) D YMD^%DTC
"RTN","ORWDLR33",66,0)
 . I (ORDA=$P(ORTI,".",1)),(+(ORDA+%)<+ORTI) K ORY(I) S ORY=ORY-1 Q   ; cutoff time has passed for this collect time
"RTN","ORWDLR33",67,0)
 . S ORY(I)=$P(ORY(I),U,2)
"RTN","ORWDLR33",68,0)
 I +$G(ORY)=0,('$D(ORY(0))) S ORY(0)="-1^All of today's collection times have passed."
"RTN","ORWDLR33",69,0)
 Q
"RTN","ORWDLR33",70,0)
LCFUTR(ORDY,ORLOC,ORDIV)  ;Get # of days for future Lab Collects
"RTN","ORWDLR33",71,0)
 ; For Event Delay Order
"RTN","ORWDLR33",72,0)
 ;  --ORLOC Event default location
"RTN","ORWDLR33",73,0)
 ;  --ORDIV Event default division
"RTN","ORWDLR33",74,0)
 S ORDY=0
"RTN","ORWDLR33",75,0)
 Q:'$D(^XTV(8989.51,"B","LR LAB COLLECT FUTURE"))
"RTN","ORWDLR33",76,0)
 I $G(ORDIV) S ORDY=+$$GET^XPAR(+$G(ORLOC)_";SC("_"^"_+$G(ORDIV)_";DIC(4,^SYS^PKG","LR LAB COLLECT FUTURE",1,"I")
"RTN","ORWDLR33",77,0)
 E  S ORDY=+$$GET^XPAR(+$G(ORLOC)_";SC("_"^DIV^SYS^PKG","LR LAB COLLECT FUTURE",1,"I")
"RTN","ORWDLR33",78,0)
 ;S DUZ(2)=TMPDIV
"RTN","ORWDLR33",79,0)
 Q
"RTN","ORWDLR33",80,0)
LASTTIME(ORY)   ; Get last collection time used from ^TMP("ORECALL",$J) array
"RTN","ORWDLR33",81,0)
 N ORDIALOG,ORTYPE,ORTIME
"RTN","ORWDLR33",82,0)
 S ORDIALOG=$O(^ORD(101.41,"B","LR OTHER LAB TESTS",0))
"RTN","ORWDLR33",83,0)
 S ORTYPE=$O(^ORD(101.41,"B","OR GTX COLLECTION TYPE",0))
"RTN","ORWDLR33",84,0)
 S ORTIME=$O(^ORD(101.41,"B","OR GTX START DATE/TIME",0))
"RTN","ORWDLR33",85,0)
 S ORY=$$RECALL^ORCD(ORTYPE,1)_U_$$RECALL^ORCD(ORTIME,1)
"RTN","ORWDLR33",86,0)
 Q
"RTN","ORWDLR33",87,0)
LCTOWC(ORTXT,ORLOC)     ; return text instructing user when LC changed to WC on accept/release
"RTN","ORWDLR33",88,0)
 N ORDIV,ORSVC
"RTN","ORWDLR33",89,0)
 S ORDIV=DUZ(2)
"RTN","ORWDLR33",90,0)
 S ORSVC=+$G(^VA(200,DUZ,5))
"RTN","ORWDLR33",91,0)
 I ORSVC S ORTXT=$$GET^XPAR(+$G(ORLOC)_";SC("_"^"_+$G(ORSVC)_";DIC(49,^"_+$G(ORDIV)_";DIC(4,^SYS^PKG","ORWLR LC CHANGED TO WC",1,"I")
"RTN","ORWDLR33",92,0)
 E  S ORTXT=$$GET^XPAR(+$G(ORLOC)_";SC("_"^SVC^"_+$G(ORDIV)_";DIC(4,^SYS^PKG","ORWLR LC CHANGED TO WC",1,"I")
"RTN","ORWDLR33",93,0)
 Q
"RTN","ORWDOR")
0^4^B8588372
"RTN","ORWDOR",1,0)
ORWDOR ; SLC/KCM - Generic Orders calls for Windows Dialogs [ 08/05/96  8:21 AM ];03:50 PM  17 Jun 1998
"RTN","ORWDOR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,164,253,243**;Dec 17, 1997;Build 242
"RTN","ORWDOR",3,0)
NXT() ; -- returns next available index in return data array
"RTN","ORWDOR",4,0)
 S ILST=ILST+1
"RTN","ORWDOR",5,0)
 Q ILST
"RTN","ORWDOR",6,0)
 ;
"RTN","ORWDOR",7,0)
VMSLCT(LST) ; return default lists for vitals dialog
"RTN","ORWDOR",8,0)
 N ILST S ILST=0
"RTN","ORWDOR",9,0)
 S LST($$NXT)="~Measurements" D MEAS
"RTN","ORWDOR",10,0)
 S LST($$NXT)="~Schedules"    D SCHED
"RTN","ORWDOR",11,0)
 Q
"RTN","ORWDOR",12,0)
MEAS ; called from VMSLCT
"RTN","ORWDOR",13,0)
 N I,X
"RTN","ORWDOR",14,0)
 S X="" F  S X=$O(^ORD(101.43,"S.V/M",X)) Q:X=""  D
"RTN","ORWDOR",15,0)
 . S I=$O(^ORD(101.43,"S.V/M",X,0))
"RTN","ORWDOR",16,0)
 . S LST($$NXT)="i"_I_U_$P(^ORD(101.43,"S.V/M",X,I),U,2)
"RTN","ORWDOR",17,0)
 Q
"RTN","ORWDOR",18,0)
SCHED ; called from VMSLCT
"RTN","ORWDOR",19,0)
 N X,I
"RTN","ORWDOR",20,0)
 K ^TMP($J,"ORWDGX APGMRV")
"RTN","ORWDOR",21,0)
 D AP^PSS51P1("GMRV",,,,"ORWDGX APGMRV")
"RTN","ORWDOR",22,0)
 S X="" F  S X=$O(^TMP($J,"ORWDGX APGMRV","APGMRV",X)) Q:X=""  D
"RTN","ORWDOR",23,0)
 . S I=$O(^TMP($J,"ORWDGX APGMRV","APGMRV",X,0)),LST($$NXT)="i"_I_U_X
"RTN","ORWDOR",24,0)
 K ^TMP($J,"ORWDGX APGMRV")
"RTN","ORWDOR",25,0)
 Q
"RTN","ORWDOR",26,0)
VALNUM(ERR,X,DOM) ; return error if invalid number
"RTN","ORWDOR",27,0)
 N LOW,HIGH,DEC
"RTN","ORWDOR",28,0)
 S LOW=$P(DOM,":"),HIGH=$P(DOM,":",2),DEC=$P(DOM,":",3),ERR=0
"RTN","ORWDOR",29,0)
 I $L($P(X,"."))>24 S ERR="1^Exceeded maximum number of 24 characters" Q
"RTN","ORWDOR",30,0)
 I X'?.1"-".N.1".".N S ERR="1^Entry must be numeric" Q
"RTN","ORWDOR",31,0)
 I X>HIGH!(X<LOW) S ERR="1^Out of Range - value must be between "_LOW_" and "_HIGH_" inclusive" Q
"RTN","ORWDOR",32,0)
 I $L($P(+X,".",2))>DEC D
"RTN","ORWDOR",33,0)
 . I DEC=0 S ERR="1^No decimal places allowed"
"RTN","ORWDOR",34,0)
 . E  I DEC=1 S ERR="1^Only one decimal place allowed"
"RTN","ORWDOR",35,0)
 . E  S ERR="1^No more than "_DEC_" decimal places allowed"
"RTN","ORWDOR",36,0)
 Q
"RTN","ORWDOR",37,0)
LKSCRN(ORLST,FROM,DIR,REF,GBL,SCR) ; Return a set of entries from xref in REF
"RTN","ORWDOR",38,0)
 ; .Y=returned list, FROM=text to $O from, DIR=$O direction,
"RTN","ORWDOR",39,0)
 ; REF=subscript indirection global ref including xref,
"RTN","ORWDOR",40,0)
 ; GBL=standard FM global ref, SCR=reference to screen in 101.41
"RTN","ORWDOR",41,0)
 N I,IEN,CNT,X,Y,D,ORTYPE
"RTN","ORWDOR",42,0)
 S I=0,CNT=44,SCR=$G(SCR)
"RTN","ORWDOR",43,0)
 I $L(SCR) S SCR=$G(^ORD(101.41,+SCR,10,+$P(SCR,":",2),4))
"RTN","ORWDOR",44,0)
 S D=$P(REF,"""",2),ORTYPE="D" ;for OI screen
"RTN","ORWDOR",45,0)
 F  Q:I'<CNT  S FROM=$O(@REF@(FROM),DIR) Q:FROM=""  D
"RTN","ORWDOR",46,0)
 . S IEN=0 F  S IEN=$O(@REF@(FROM,IEN)) Q:'IEN  D
"RTN","ORWDOR",47,0)
 . . ; if screen, set naked ref & Y, then execute screen
"RTN","ORWDOR",48,0)
 . . I $L(SCR) S Y=IEN,X=$P($G(@(GBL_"Y,0)")),U) X SCR Q:'$T
"RTN","ORWDOR",49,0)
 . . S I=I+1,ORLST(I)=IEN_"^"_FROM
"RTN","ORWDOR",50,0)
 Q
"RTN","ORWDOR",51,0)
MNUTREE(LST,ROOT) ; return menu tree for a menu type dialog
"RTN","ORWDOR",52,0)
 N ILST S ILST=0
"RTN","ORWDOR",53,0)
 S ILST=ILST+1,LST(ILST)=ROOT_U_$P(^ORD(101.41,ROOT,0),U,2)_"^0^+"
"RTN","ORWDOR",54,0)
 D LSTCHLD(ROOT)
"RTN","ORWDOR",55,0)
 Q
"RTN","ORWDOR",56,0)
LSTCHLD(PARENT) ; list descendends of this node (recursive)
"RTN","ORWDOR",57,0)
 N CHILD,I,J
"RTN","ORWDOR",58,0)
 S I=0 F  S I=$O(^ORD(101.41,PARENT,10,"B",I)) Q:'I  D
"RTN","ORWDOR",59,0)
 . S J=0 F  S J=$O(^ORD(101.41,PARENT,10,"B",I,J)) Q:'J  D
"RTN","ORWDOR",60,0)
 . . S CHILD=+$P(^ORD(101.41,PARENT,10,J,0),U,2) Q:'CHILD
"RTN","ORWDOR",61,0)
 . . ; also quit if child is not a generic order
"RTN","ORWDOR",62,0)
 . . S ILST=ILST+1,LST(ILST)=CHILD_U_$P(^ORD(101.41,CHILD,0),U,2)_U_PARENT
"RTN","ORWDOR",63,0)
 . . I $P(^ORD(101.41,CHILD,0),U,4)="M",$D(^ORD(101.41,CHILD,10))>1 D
"RTN","ORWDOR",64,0)
 . . . S LST(ILST)=LST(ILST)_"^+"
"RTN","ORWDOR",65,0)
 . . . D LSTCHLD(CHILD)
"RTN","ORWDOR",66,0)
 Q
"RTN","ORWDPS1")
0^8^B49131928
"RTN","ORWDPS1",1,0)
ORWDPS1 ; SLC/KCM/JLI - Pharmacy Calls for Windows Dialog; 03/10/2008
"RTN","ORWDPS1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**85,132,141,163,215,255,243**;Dec 17, 1997;Build 242
"RTN","ORWDPS1",3,0)
 ;
"RTN","ORWDPS1",4,0)
ODSLCT(LST,PSTYPE,DFN,LOC) ; return default lists for dialog
"RTN","ORWDPS1",5,0)
 ; PSTYPE: pharmacy type (U=unit dose, F=IV fluids, O=outpatient)
"RTN","ORWDPS1",6,0)
 N ILST S ILST=0
"RTN","ORWDPS1",7,0)
 S ILST=ILST+1,LST(ILST)="~Priority" D PRIOR
"RTN","ORWDPS1",8,0)
 S ILST=ILST+1,LST(ILST)="~DispMsg"
"RTN","ORWDPS1",9,0)
 S ILST=ILST+1,LST(ILST)="d"_$$DISPMSG
"RTN","ORWDPS1",10,0)
 ;
"RTN","ORWDPS1",11,0)
 ; I PSTYPE="F" D  Q                           ; IV Fluids
"RTN","ORWDPS1",12,0)
 ; . S ILST=ILST+1,LST(ILST)="~ShortList" D SHORT
"RTN","ORWDPS1",13,0)
 ;
"RTN","ORWDPS1",14,0)
 I PSTYPE="O" D                                ; Outpatient
"RTN","ORWDPS1",15,0)
 . S ILST=ILST+1,LST(ILST)="~Refills"
"RTN","ORWDPS1",16,0)
 . S ILST=ILST+1,LST(ILST)="d0^0"
"RTN","ORWDPS1",17,0)
 . S ILST=ILST+1,LST(ILST)="~Pickup"
"RTN","ORWDPS1",18,0)
 . S ILST=ILST+1,LST(ILST)="d"_$$DEFPICK($G(LOC))
"RTN","ORWDPS1",19,0)
 . ; S ILST=ILST+1,LST(ILST)="~Supply"
"RTN","ORWDPS1",20,0)
 . ; S ILST=ILST+1,LST(ILST)="d^"_$$DEFSPLY(DFN)
"RTN","ORWDPS1",21,0)
 Q
"RTN","ORWDPS1",22,0)
PKI(ORY,OI,PSTYPE,ORVP,PKIACTIV) ; return DEA Schedule for drug
"RTN","ORWDPS1",23,0)
 N ILST,ORDOSE,ORWPSOI,ORWDOSES,X1,X2,X
"RTN","ORWDPS1",24,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J),^TMP("PSSDIN",$J)
"RTN","ORWDPS1",25,0)
 S ILST=0
"RTN","ORWDPS1",26,0)
 S ORWPSOI=0
"RTN","ORWDPS1",27,0)
 S:+OI ORWPSOI=+$P($G(^ORD(101.43,+OI,0)),U,2)
"RTN","ORWDPS1",28,0)
 D START^PSSJORDF(ORWPSOI,$S(PSTYPE="U":"I",1:"O")) ; dflt route, schedule, etc.
"RTN","ORWDPS1",29,0)
 I '$L($T(DOSE^PSSOPKI1)) D DOSE^PSSORUTL(.ORDOSE,ORWPSOI,PSTYPE,ORVP)       ; dflt doses
"RTN","ORWDPS1",30,0)
 I $L($T(DOSE^PSSOPKI1)) D DOSE^PSSOPKI1(.ORDOSE,ORWPSOI,PSTYPE,ORVP)       ; dflt doses NEW PKI CODE from pharmacy
"RTN","ORWDPS1",31,0)
 D EN^PSSDIN(ORWPSOI)                               ; nfi text
"RTN","ORWDPS1",32,0)
 S ORY="" ;PKI
"RTN","ORWDPS1",33,0)
 I $D(ORDOSE("DEA")) S X="",X1=$P(ORDOSE("DEA"),";"),X2=$P(ORDOSE("DEA"),";",2) D
"RTN","ORWDPS1",34,0)
 . I '$L(X2) Q
"RTN","ORWDPS1",35,0)
 . I $G(PKIACTIV) S X=X2
"RTN","ORWDPS1",36,0)
 S ORY=X
"RTN","ORWDPS1",37,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J),^TMP("PSSDIN",$J)
"RTN","ORWDPS1",38,0)
 Q
"RTN","ORWDPS1",39,0)
PRIOR ; from DLGSLCT, get list of allowed priorities
"RTN","ORWDPS1",40,0)
 N X,XREF
"RTN","ORWDPS1",41,0)
 S XREF=$S(PSTYPE="O":"S.PSO",1:"S.PSJ")
"RTN","ORWDPS1",42,0)
 S X="" F  S X=$O(^ORD(101.42,XREF,X)) Q:'$L(X)  D
"RTN","ORWDPS1",43,0)
 . I XREF["PSJ",X'="ASAP",X'="ROUTINE",X'="STAT" Q
"RTN","ORWDPS1",44,0)
 . S ILST=ILST+1,LST(ILST)="i"_$O(^ORD(101.42,XREF,X,0))_U_X
"RTN","ORWDPS1",45,0)
 S ILST=ILST+1,LST(ILST)="d"_$O(^ORD(101.42,"B","ROUTINE",0))_U_"ROUTINE"
"RTN","ORWDPS1",46,0)
 Q
"RTN","ORWDPS1",47,0)
DEFPICK(LOC)       ; return default routing
"RTN","ORWDPS1",48,0)
 N X,DLG,PRMT
"RTN","ORWDPS1",49,0)
 S DLG=$O(^ORD(101.41,"AB","PSO OERR",0)),X=""
"RTN","ORWDPS1",50,0)
 S PRMT=$O(^ORD(101.41,"AB","OR GTX ROUTING",0))
"RTN","ORWDPS1",51,0)
 I $D(^TMP("ORECALL",$J,+DLG,+PRMT,1)) S X=^(1)
"RTN","ORWDPS1",52,0)
 I X'="" S EDITONLY=1 Q X  ; EDITONLY used by default action
"RTN","ORWDPS1",53,0)
 ;
"RTN","ORWDPS1",54,0)
 ;S X=$$GET^XPAR("ALL^"_"LOC.`"_LOC,"ORWDPS ROUTING DEFAULT",1,"I")
"RTN","ORWDPS1",55,0)
 S X=$$GET^XPAR("LOC.`"_LOC_"^SYS","ORWDPS ROUTING DEFAULT",1,"I")
"RTN","ORWDPS1",56,0)
 I X="C" S X="C^in Clinic" G XPICK
"RTN","ORWDPS1",57,0)
 I X="M" S X="M^by Mail"   G XPICK
"RTN","ORWDPS1",58,0)
 I X="W" S X="W^at Window" G XPICK
"RTN","ORWDPS1",59,0)
 I X="N" S X=""            G XPICK
"RTN","ORWDPS1",60,0)
 I X=""  S X=$S($D(^PSX(550,"C")):"M^by Mail",1:"W^at Window")
"RTN","ORWDPS1",61,0)
XPICK Q X
"RTN","ORWDPS1",62,0)
 ;
"RTN","ORWDPS1",63,0)
DEFSPLY(DFN)    ; return default days supply for this patient
"RTN","ORWDPS1",64,0)
 N ORWX
"RTN","ORWDPS1",65,0)
 S ORWX("PATIENT")=DFN
"RTN","ORWDPS1",66,0)
 D DSUP^PSOSIGDS(.ORWX)
"RTN","ORWDPS1",67,0)
 Q $G(ORWX("DAYS SUPPLY"))
"RTN","ORWDPS1",68,0)
 ;
"RTN","ORWDPS1",69,0)
DFLTSPLY(VAL,UPD,SCH,PAT,DRG)        ; return days supply given quantity
"RTN","ORWDPS1",70,0)
 ; VAL: default days supply
"RTN","ORWDPS1",71,0)
 N ORWX,I
"RTN","ORWDPS1",72,0)
 S ORWX("PATIENT")=PAT
"RTN","ORWDPS1",73,0)
 I DRG S ORWX("DRUG")=DRG
"RTN","ORWDPS1",74,0)
 F I=1:1:$L(UPD,U)-1 D
"RTN","ORWDPS1",75,0)
 . S ORWX("DOSE ORDERED",I)=$P(UPD,U,I)
"RTN","ORWDPS1",76,0)
 . S ORWX("SCHEDULE",I)=$P(SCH,U,I)
"RTN","ORWDPS1",77,0)
 D DSUP^PSOSIGDS(.ORWX)
"RTN","ORWDPS1",78,0)
 S VAL=$G(ORWX("DAYS SUPPLY"))
"RTN","ORWDPS1",79,0)
 Q
"RTN","ORWDPS1",80,0)
DISPMSG()       ; return 1 to suppress dispense message
"RTN","ORWDPS1",81,0)
 Q +$$GET^XPAR("ALL","ORWDPS SUPPRESS DISPENSE MSG",1,"I")
"RTN","ORWDPS1",82,0)
 ;
"RTN","ORWDPS1",83,0)
DOWSCH(LST,DFN,LOCIEN)     ; return all schedules
"RTN","ORWDPS1",84,0)
 N CNT,FREQ,ILST,ORARRAY,WIEN
"RTN","ORWDPS1",85,0)
 S WIEN=$$WARDIEN^ORWDPS32(+$G(LOCIEN))
"RTN","ORWDPS1",86,0)
 D SCHED^PSS51P1(WIEN,.ORARRAY)
"RTN","ORWDPS1",87,0)
 S ILST=0
"RTN","ORWDPS1",88,0)
 S CNT=0 F  S CNT=$O(ORARRAY(CNT)) Q:CNT'>0  D
"RTN","ORWDPS1",89,0)
 .S NODE=$G(ORARRAY(CNT))
"RTN","ORWDPS1",90,0)
 .I $P(NODE,U,4)="C" D
"RTN","ORWDPS1",91,0)
 ..K ^TMP($J,"ORWDPS1 DOWSCH")
"RTN","ORWDPS1",92,0)
 ..D ZERO^PSS51P1($P(NODE,U),,,,"ORWDPS1 DOWSCH")
"RTN","ORWDPS1",93,0)
 ..S FREQ=$G(^TMP($J,"ORWDPS1 DOWSCH",$P(NODE,U),2))
"RTN","ORWDPS1",94,0)
 ..K ^TMP($J,"ORWDPS1 DOWSCH")
"RTN","ORWDPS1",95,0)
 ..I +FREQ=0 Q
"RTN","ORWDPS1",96,0)
 ..I +FREQ>1440 Q
"RTN","ORWDPS1",97,0)
 ..S ILST=ILST+1,LST(ILST)=$P(ORARRAY(CNT),U,2,5)
"RTN","ORWDPS1",98,0)
 Q
"RTN","ORWDPS1",99,0)
 ;
"RTN","ORWDPS1",100,0)
SCHALL(LST,DFN,LOCIEN)     ; return all schedules
"RTN","ORWDPS1",101,0)
 N CNT,ILST,ORARRAY,WIEN
"RTN","ORWDPS1",102,0)
 S WIEN=$$WARDIEN^ORWDPS32(+$G(LOCIEN))
"RTN","ORWDPS1",103,0)
 D SCHED^PSS51P1(WIEN,.ORARRAY)
"RTN","ORWDPS1",104,0)
 S ILST=0
"RTN","ORWDPS1",105,0)
 S CNT=0 F  S CNT=$O(ORARRAY(CNT)) Q:CNT'>0  D
"RTN","ORWDPS1",106,0)
 .S ILST=ILST+1,LST(ILST)=$P(ORARRAY(CNT),U,2,5)
"RTN","ORWDPS1",107,0)
 Q
"RTN","ORWDPS1",108,0)
 ;
"RTN","ORWDPS1",109,0)
FORMALT(ORLST,ORIEN,PSTYPE) ; return a list of formulary alternatives
"RTN","ORWDPS1",110,0)
 N PSID,I
"RTN","ORWDPS1",111,0)
 S ORIEN=+$P(^ORD(101.43,ORIEN,0),U,2)
"RTN","ORWDPS1",112,0)
 D EN1^PSSUTIL1(.ORIEN,PSTYPE)
"RTN","ORWDPS1",113,0)
 S PSID=0,I=0
"RTN","ORWDPS1",114,0)
 F  S PSID=$O(ORIEN(PSID)) Q:'PSID  D
"RTN","ORWDPS1",115,0)
 . S OI=+$O(^ORD(101.43,"ID",PSID_";99PSP",0))
"RTN","ORWDPS1",116,0)
 . I OI S I=I+1,ORLST(I)=OI,$P(ORLST(I),U,2)=$P(^ORD(101.43,OI,0),U)
"RTN","ORWDPS1",117,0)
 Q
"RTN","ORWDPS1",118,0)
DOSEALT(LST,DDRUG,CUROI,PSTYPE) ; return a list of formulary alternatives for dose
"RTN","ORWDPS1",119,0)
 N I,OI,ORWLST,ILST S ILST=0
"RTN","ORWDPS1",120,0)
 D ENRFA^PSJORUTL(DDRUG,PSTYPE,.ORWLST)
"RTN","ORWDPS1",121,0)
 S I=0 F  S I=$O(ORWLST(I)) Q:'I  D
"RTN","ORWDPS1",122,0)
 . S OI=+$O(^ORD(101.43,"ID",+$P(ORWLST(I),U,4)_";99PSP",0))
"RTN","ORWDPS1",123,0)
 . I OI,OI'=CUROI S ILST=ILST+1,LST(ILST)=OI_U_$P(^ORD(101.43,OI,0),U)
"RTN","ORWDPS1",124,0)
 Q
"RTN","ORWDPS1",125,0)
QOMEDALT(ORY,ODIEN) ;
"RTN","ORWDPS1",126,0)
 N ARRAY,IDIEN,ORDERID,PKG,PSTYPE,VALUE
"RTN","ORWDPS1",127,0)
 S ORY=0,PKG=+$P(^ORD(101.41,ODIEN,0),U,7)
"RTN","ORWDPS1",128,0)
 S PSTYPE=$S($$GET1^DIQ(9.4,PKG_",",1)="PSO":"O",1:"I")
"RTN","ORWDPS1",129,0)
 S ORDERID=$O(^ORD(101.41,"B","OR GTX ORDERABLE ITEM","")) Q:ORDERID'>0
"RTN","ORWDPS1",130,0)
 S IDIEN=$O(^ORD(101.41,ODIEN,6,"D",ORDERID,"")) Q:IDIEN'>0
"RTN","ORWDPS1",131,0)
 S VALUE=$G(^ORD(101.41,ODIEN,6,IDIEN,1)) Q:VALUE'>0
"RTN","ORWDPS1",132,0)
 I $P($G(^ORD(101.43,VALUE,"PS")),U,6)=1 S ORY=VALUE
"RTN","ORWDPS1",133,0)
 ;D FORMALT(.ARRAY,VALUE,PSTYPE) I $D(ARRAY)>0 S ORY=VALUE
"RTN","ORWDPS1",134,0)
 ;I ORY=0,$P($G(^ORD(101.43,VALUE,"PS")),U,6)=1 S ORY=VALUE
"RTN","ORWDPS1",135,0)
 Q
"RTN","ORWDPS1",136,0)
FAILDEA(FAIL,OI,ORNP,PSTYPE)    ; return 1 if DEA check fails for this provider
"RTN","ORWDPS1",137,0)
 N DEAFLG,PSOI,TPKG
"RTN","ORWDPS1",138,0)
 S FAIL=0,TPKG=$P($G(^ORD(101.43,+$G(OI),0)),U,2)
"RTN","ORWDPS1",139,0)
 Q:TPKG'["PS"
"RTN","ORWDPS1",140,0)
 S PSOI=+TPKG Q:PSOI'>0
"RTN","ORWDPS1",141,0)
 I '$L($T(OIDEA^PSSUTLA1)) Q
"RTN","ORWDPS1",142,0)
 S DEAFLG=$$OIDEA^PSSUTLA1(PSOI,PSTYPE) Q:DEAFLG'>0
"RTN","ORWDPS1",143,0)
 I '$L($$DEA^XUSER(,+$G(ORNP))) S FAIL=1
"RTN","ORWDPS1",144,0)
 Q
"RTN","ORWDPS1",145,0)
FDEA1(FAIL,OI,OITYPE,ORNP) ; only be called for an outpaitent and IV dialog
"RTN","ORWDPS1",146,0)
 ;OI: IV Orderable Item
"RTN","ORWDPS1",147,0)
 ;OITYPE: A:ADDITIVE  S:SOLUTION
"RTN","ORWDPS1",148,0)
 N DEAFLG,PSOI,TKPG
"RTN","ORWDPS1",149,0)
 S FAIL=0,TPKG=$P($G(^ORD(101.43,+$G(OI),0)),U,2)
"RTN","ORWDPS1",150,0)
 Q:TPKG'["PS"
"RTN","ORWDPS1",151,0)
 S PSOI=+TPKG Q:PSOI'>0
"RTN","ORWDPS1",152,0)
 I '$L($T(IVDEA^PSSUTIL1)) Q
"RTN","ORWDPS1",153,0)
 S DEAFLG=$$IVDEA^PSSUTIL1(PSOI,OITYPE) Q:DEAFLG'>0
"RTN","ORWDPS1",154,0)
 I '$L($P($G(^VA(200,+$G(ORNP),"PS")),U,2)),'$L($P($G(^("PS")),U,3)) S FAIL=1
"RTN","ORWDPS1",155,0)
 Q
"RTN","ORWDPS1",156,0)
 ;
"RTN","ORWDPS1",157,0)
CHK94(VAL)      ; return 1 if patch 94 has been installed
"RTN","ORWDPS1",158,0)
 S VAL=0
"RTN","ORWDPS1",159,0)
 I $O(^ORD(101.41,"B","PS MEDS",0)) S VAL=1
"RTN","ORWDPS1",160,0)
 Q
"RTN","ORWDPS1",161,0)
LOCPICK(Y,LOC) ; return default Location level routing
"RTN","ORWDPS1",162,0)
 S Y=""
"RTN","ORWDPS1",163,0)
 S Y=$$GET^XPAR("LOC.`"_LOC_"^SYS","ORWDPS ROUTING DEFAULT",1,"I")
"RTN","ORWDPS1",164,0)
 I Y="C" S Y="C^in Clinic"
"RTN","ORWDPS1",165,0)
 I Y="M" S Y="M^by Mail"
"RTN","ORWDPS1",166,0)
 I Y="W" S Y="W^at Window"
"RTN","ORWDPS1",167,0)
 I Y="N" S Y=""
"RTN","ORWDPS1",168,0)
 Q
"RTN","ORWDPS1",169,0)
HASOIPI(Y,QOID) ; Check if QO put orderable item's PI into Sig
"RTN","ORWDPS1",170,0)
 N PIIEN,OIX
"RTN","ORWDPS1",171,0)
 S Y=0
"RTN","ORWDPS1",172,0)
 Q:'$D(^ORD(101.41,QOID,0))
"RTN","ORWDPS1",173,0)
 S PIIEN=$O(^ORD(101.41,"B","OR GTX PATIENT INSTRUCTIONS",0))
"RTN","ORWDPS1",174,0)
 Q:'PIIEN
"RTN","ORWDPS1",175,0)
 S OIX=0
"RTN","ORWDPS1",176,0)
 Q:'$D(^ORD(101.41,QOID,6,"D"))
"RTN","ORWDPS1",177,0)
 F  S OIX=$O(^ORD(101.41,+QOID,6,"D",OIX)) Q:'OIX  D
"RTN","ORWDPS1",178,0)
 . I OIX=PIIEN S Y=1 Q
"RTN","ORWDPS1",179,0)
 Q
"RTN","ORWDPS1",180,0)
HASROUTE(Y,QOID) ;Check if QO has a ROUTE defined
"RTN","ORWDPS1",181,0)
 N ROUTID
"RTN","ORWDPS1",182,0)
 S Y=0,ROUTID=0
"RTN","ORWDPS1",183,0)
 S ROUTID=$O(^ORD(101.41,"B","OR GTX ROUTING",0))
"RTN","ORWDPS1",184,0)
 Q:'ROUTID
"RTN","ORWDPS1",185,0)
 Q:'$D(^ORD(101.41,+QOID))
"RTN","ORWDPS1",186,0)
 I $D(^ORD(101.41,+QOID,6,"D",ROUTID)) S Y=1
"RTN","ORWDPS1",187,0)
 Q
"RTN","ORWDPS1",188,0)
QOCHECK(ORY,DIEN) ;
"RTN","ORWDPS1",189,0)
 N ARY,DG,FORMIEN,NAME,OI,OIIEN,ORDIALOG,ORPKG,TYPE
"RTN","ORWDPS1",190,0)
 S ORPKG=$$NMSP^ORCD($P($G(^ORD(101.41,DIEN,0)),U,7)) Q:ORPKG'["PS"
"RTN","ORWDPS1",191,0)
 S DG=$P(^ORD(101.41,DIEN,0),U,5)
"RTN","ORWDPS1",192,0)
 S NAME=$P(^ORD(100.98,DIEN,0),U)
"RTN","ORWDPS1",193,0)
 S TYPE=$S(NAME="INPATIENT MEDICATIONS":"I",NAME="OUTPATIENT MEDICATIONS":"O",1:"")
"RTN","ORWDPS1",194,0)
 I TYPE="" Q
"RTN","ORWDPS1",195,0)
 S ORDIALOG=$$DEFDLG^ORCD(DIEN) Q:ORDIALOG
"RTN","ORWDPS1",196,0)
 D GETDLG^ORCD(ORDIALOG),GETORDER^ORCD("^ORD(101.41,"_DIEN_",6)")
"RTN","ORWDPS1",197,0)
 I $D(ORDIALOG)'>0 Q
"RTN","ORWDPS1",198,0)
 S OI=$P($G(ORDIALOG("B","ORDERABLE")),U,2) Q:OI'>0
"RTN","ORWDPS1",199,0)
 S OIIEN=$G(ORDIALOG(OI,1)) Q:OIIEN'>0
"RTN","ORWDPS1",200,0)
 D FORMALT(.ARY,OIIEN,TYPE) I $D(ARY)'>0 Q
"RTN","ORWDPS1",201,0)
 S ORY=OIIEN
"RTN","ORWDPS1",202,0)
 Q
"RTN","ORWDPS2")
0^173^B57106070
"RTN","ORWDPS2",1,0)
ORWDPS2 ; SLC/KCM/JLI - Pharmacy Calls for Windows Dialog;05/09/2007
"RTN","ORWDPS2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**85,116,125,131,132,148,141,195,215,258,243**;Dec 17, 1997;Build 242
"RTN","ORWDPS2",3,0)
 ;
"RTN","ORWDPS2",4,0)
OISLCT(LST,OI,PSTYPE,ORVP,NEEDPI,PKIACTIV) ; return for defaults for pharmacy orderable item
"RTN","ORWDPS2",5,0)
 N ILST,ORDOSE,ORWPSOI,ORWDOSES,X1,X2
"RTN","ORWDPS2",6,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J),^TMP("PSSDIN",$J)
"RTN","ORWDPS2",7,0)
 S ILST=0
"RTN","ORWDPS2",8,0)
 S ORWPSOI=0
"RTN","ORWDPS2",9,0)
 S:+OI ORWPSOI=+$P($G(^ORD(101.43,+OI,0)),U,2)
"RTN","ORWDPS2",10,0)
 D START^PSSJORDF(ORWPSOI,$S(PSTYPE="U":"I",1:"O")) ; dflt route, schedule, etc.
"RTN","ORWDPS2",11,0)
 I '$L($T(DOSE^PSSOPKI1)) D DOSE^PSSORUTL(.ORDOSE,ORWPSOI,PSTYPE,ORVP)       ; dflt doses
"RTN","ORWDPS2",12,0)
 I $L($T(DOSE^PSSOPKI1)) D DOSE^PSSOPKI1(.ORDOSE,ORWPSOI,PSTYPE,ORVP)       ; dflt doses NEW PKI CODE from pharmacy
"RTN","ORWDPS2",13,0)
 D EN^PSSDIN(ORWPSOI)                               ; nfi text
"RTN","ORWDPS2",14,0)
 S ILST=ILST+1,LST(ILST)="~Medication"
"RTN","ORWDPS2",15,0)
 S ILST=ILST+1,LST(ILST)="d"_OI_U_$S(+OI:$P(^ORD(101.43,OI,0),U),1:"")
"RTN","ORWDPS2",16,0)
 S ILST=ILST+1,LST(ILST)="~Verb"
"RTN","ORWDPS2",17,0)
 S ILST=ILST+1,LST(ILST)="d"_$P($G(ORDOSE("MISC")),U)
"RTN","ORWDPS2",18,0)
 S ILST=ILST+1,LST(ILST)="~Preposition"
"RTN","ORWDPS2",19,0)
 S ILST=ILST+1,LST(ILST)="d"_$P($G(ORDOSE("MISC")),U,2)
"RTN","ORWDPS2",20,0)
 I $D(NEEDPI),(NEEDPI="Y") S ILST=ILST+1,LST(ILST)="~PtInstr" D PTINSTR
"RTN","ORWDPS2",21,0)
 ;S:NEEDPI="Y" ILST=ILST+1,LST(ILST)="~PtInstr"   D PTINSTR
"RTN","ORWDPS2",22,0)
 S ILST=ILST+1,LST(ILST)="~AllDoses"  D ALLDOSE ; must do before DOSAGE
"RTN","ORWDPS2",23,0)
 S ILST=ILST+1,LST(ILST)="~Dosage"    D DOSAGE
"RTN","ORWDPS2",24,0)
 S ILST=ILST+1,LST(ILST)="~Dispense"  D DISPLST
"RTN","ORWDPS2",25,0)
 S ILST=ILST+1,LST(ILST)="~Route"     D ROUTE
"RTN","ORWDPS2",26,0)
 S ILST=ILST+1,LST(ILST)="~Schedule"  D SCHED
"RTN","ORWDPS2",27,0)
 S ILST=ILST+1,LST(ILST)="~Guideline" D GUIDE
"RTN","ORWDPS2",28,0)
 S ILST=ILST+1,LST(ILST)="~Message"   D OIMSG
"RTN","ORWDPS2",29,0)
 S ILST=ILST+1,LST(ILST)="~DEASchedule" ;PKI
"RTN","ORWDPS2",30,0)
 ;S ILST=ILST+1,LST(ILST)="d"_$P($G(ORDOSE("DEA")),U) ;PKI
"RTN","ORWDPS2",31,0)
 S ILST=ILST+1,LST(ILST)="d" ;PKI
"RTN","ORWDPS2",32,0)
 I $D(ORDOSE("DEA")) S X="",X1=$P(ORDOSE("DEA"),";"),X2=$P(ORDOSE("DEA"),";",2) D
"RTN","ORWDPS2",33,0)
 . I '$L(X2) Q
"RTN","ORWDPS2",34,0)
 . I $G(PKIACTIV)="Y" S X=X2
"RTN","ORWDPS2",35,0)
 S LST(ILST)=LST(ILST)_X
"RTN","ORWDPS2",36,0)
 I PSTYPE="U" D
"RTN","ORWDPS2",37,0)
 . ; start, expires, next admin
"RTN","ORWDPS2",38,0)
 I PSTYPE="O" D
"RTN","ORWDPS2",39,0)
 . ; days supply, quantity, refills
"RTN","ORWDPS2",40,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J),^TMP("PSSDIN",$J)
"RTN","ORWDPS2",41,0)
 Q
"RTN","ORWDPS2",42,0)
 ;
"RTN","ORWDPS2",43,0)
PTINSTR ; from OISLCT, set up patient instructions
"RTN","ORWDPS2",44,0)
 N I
"RTN","ORWDPS2",45,0)
 S I=0 F  S I=$O(ORDOSE("PI",I)) Q:I'>0  S ILST=ILST+1,LST(ILST)="t"_ORDOSE("PI",I)
"RTN","ORWDPS2",46,0)
 Q
"RTN","ORWDPS2",47,0)
DOSAGE ; from OISLCT, set up the list of dosages
"RTN","ORWDPS2",48,0)
 ; LST(n)=iDrugName^Strength^NF^... (see BLDDOSE)
"RTN","ORWDPS2",49,0)
 ; must be called after ALLDOSE so ORWDOSES is set up
"RTN","ORWDPS2",50,0)
 N I
"RTN","ORWDPS2",51,0)
 S I=0 F  S I=$O(ORWDOSES(I)) Q:I'>0  S ILST=ILST+1,LST(ILST)=ORWDOSES(I)
"RTN","ORWDPS2",52,0)
 Q
"RTN","ORWDPS2",53,0)
DISPLST ; from OISLCT, set up list of dispense drugs
"RTN","ORWDPS2",54,0)
 ; DrugIEN^Strength^Units^Name^Split
"RTN","ORWDPS2",55,0)
 N DD
"RTN","ORWDPS2",56,0)
 S DD=0 F  S DD=$O(ORDOSE("DD",DD)) Q:'DD  D
"RTN","ORWDPS2",57,0)
 . S ILST=ILST+1
"RTN","ORWDPS2",58,0)
 . S LST(ILST)="i"_DD_U_$P(ORDOSE("DD",DD),U,5,6)_U_$P(ORDOSE("DD",DD),U)_U_$P(ORDOSE("DD",DD),U,11)
"RTN","ORWDPS2",59,0)
 Q
"RTN","ORWDPS2",60,0)
ALLDOSE ; from OISLCT, set up a list of all possible doses
"RTN","ORWDPS2",61,0)
 ; LST(n)=iDrugName^Strength^NF^... (see BLDDOSE)
"RTN","ORWDPS2",62,0)
 N I,J,CONJ,DD,DRUG,DDNM,LDOSE,TEXT,STREN,UD,COST,NF,ID,X
"RTN","ORWDPS2",63,0)
 S CONJ=$P($G(ORDOSE("MISC")),U,3),ORWDOSES=0
"RTN","ORWDPS2",64,0)
 S:$L(CONJ) CONJ=" "_CONJ_" " S:'$L(CONJ) CONJ=" "
"RTN","ORWDPS2",65,0)
 S I=0 F  S I=$O(ORDOSE(I)) Q:I'>0  D
"RTN","ORWDPS2",66,0)
 . S X=$$BLDDOSE(ORDOSE(I))
"RTN","ORWDPS2",67,0)
 . S ORWDOSES=ORWDOSES+1,ORWDOSES(ORWDOSES)=X
"RTN","ORWDPS2",68,0)
 . S ILST=ILST+1
"RTN","ORWDPS2",69,0)
 . S LST(ILST)="i"_$P(X,U,5)_U_$P($P(X,U,4),"&",6)_U_$P(X,U,4)
"RTN","ORWDPS2",70,0)
 . S J=0 F  S J=$O(ORDOSE(I,J)) Q:J'>0  D
"RTN","ORWDPS2",71,0)
 . . S X=$$BLDDOSE(ORDOSE(I,J))
"RTN","ORWDPS2",72,0)
 . . S ILST=ILST+1
"RTN","ORWDPS2",73,0)
 . . S LST(ILST)="i"_$P(X,U,5)_U_$P($P(X,U,4),"&",6)_U_$P(X,U,4)
"RTN","ORWDPS2",74,0)
 Q
"RTN","ORWDPS2",75,0)
BLDDOSE(X) ; build dose info where X is ORDOSE node
"RTN","ORWDPS2",76,0)
 ; from ALLDOSE
"RTN","ORWDPS2",77,0)
 ;    X=TotalDose^Units^U/D^Noun^LocalDose^DispDrugIEN
"RTN","ORWDPS2",78,0)
 ;    Y=iDrugName^Strength^NF^TDose&Units&U/D&Noun&LDose&Drug&Stren&Units^
"RTN","ORWDPS2",79,0)
 ;      DoseText^CostText^MaxRefills^DispUnits^CanSplit
"RTN","ORWDPS2",80,0)
 ; DRUG=Name^Cost^NF^DispUnit^Strength^Units^DoseForm^MaxRefills^
"RTN","ORWDPS2",81,0)
 ; No TotalDose,           use LocalDose
"RTN","ORWDPS2",82,0)
 ; TotalDose & Strength,   use LocalDose+Conjunction+Strength+Units
"RTN","ORWDPS2",83,0)
 ; TotalDose, No Strength, use LocalDose+Conjunction+DispenseName
"RTN","ORWDPS2",84,0)
 S DD=+$P(X,U,6),DRUG=ORDOSE("DD",DD),DDNM=$P(DRUG,U),ID=$P(X,U,1,6)
"RTN","ORWDPS2",85,0)
 S LDOSE=$P(X,U,5),TEXT=LDOSE,STREN=$P(DRUG,U,5)_$P(DRUG,U,6)
"RTN","ORWDPS2",86,0)
 S $P(ID,U,7)=$P(DRUG,U,5) S $P(ID,U,8)=$P(DRUG,U,6) ; add strength
"RTN","ORWDPS2",87,0)
 I '$L($P(X,U)),$L($P(DRUG,U,5))  S TEXT=TEXT_CONJ_STREN
"RTN","ORWDPS2",88,0)
 I '$L($P(X,U)),'$L($P(DRUG,U,5)) S TEXT=TEXT_CONJ_$P(DRUG,U)
"RTN","ORWDPS2",89,0)
 S UD=$P(X,U,3),COST=$P(X,U,7),NF=$S($P(DRUG,U,3):"NF",1:"")
"RTN","ORWDPS2",90,0)
 ;I UD S COST="$"_$J(UD*$P(DRUG,U,2),1,3) ;_" per "_UD_" "_$P(X,U,4)
"RTN","ORWDPS2",91,0)
 S Y="i"_DDNM_U_STREN_U_NF_U_$TR(ID,U,"&")_U_TEXT_U_COST_U_$P(DRUG,U,8)_U_$P(DRUG,U,4)
"RTN","ORWDPS2",92,0)
 Q Y
"RTN","ORWDPS2",93,0)
ROUTE ; from OISLCT, get list of routes for the drug form
"RTN","ORWDPS2",94,0)
 ; ** NEED BOTH ABBREVIATION & NAME IN LIST BOX
"RTN","ORWDPS2",95,0)
 N I,CNT,ABBR,IEN,ROUT,EXP,X
"RTN","ORWDPS2",96,0)
 S I="" F  S I=$O(^TMP("PSJMR",$J,I)) Q:I=""  D
"RTN","ORWDPS2",97,0)
 . S X=^TMP("PSJMR",$J,I)
"RTN","ORWDPS2",98,0)
 . S ROUT=$P(X,U),ABBR=$P(X,U,2),IEN=$P(X,U,3),EXP=$P(X,U,4)
"RTN","ORWDPS2",99,0)
 . S ILST=ILST+1,LST(ILST)="i"_IEN_U_ROUT_U_ABBR_U_EXP_U_$P(X,U,5)
"RTN","ORWDPS2",100,0)
 . I $P(X,U,6)="D",IEN S ILST=ILST+1,LST(ILST)="d"_IEN_U_ROUT ;_U_ABBR ; assume first always default
"RTN","ORWDPS2",101,0)
 ; add abbreviations to list of routes, commented out for 15.5 on
"RTN","ORWDPS2",102,0)
 ; S I="" F  S I=$O(^TMP("PSJMR",$J,I)) Q:I=""  D
"RTN","ORWDPS2",103,0)
 ; . S X=^TMP("PSJMR",$J,I)
"RTN","ORWDPS2",104,0)
 ; . S ROUT=$P(X,U),ABBR=$P(X,U,2),IEN=$P(X,U,3),EXP=$P(X,U,4)
"RTN","ORWDPS2",105,0)
 ; . I $L(ABBR),(ABBR'=ROUT) S ILST=ILST+1,LST(ILST)="i"_IEN_U_ABBR_" ("_ROUT_")"_U_ABBR_U_EXP
"RTN","ORWDPS2",106,0)
 Q
"RTN","ORWDPS2",107,0)
SCHED ; from OISLCT, get default schedule for this medication
"RTN","ORWDPS2",108,0)
 I $L($G(^TMP("PSJSCH",$J))) S ILST=ILST+1,LST(ILST)="d"_^($J)
"RTN","ORWDPS2",109,0)
 Q
"RTN","ORWDPS2",110,0)
GUIDE ; from OISLCT, get guidelines associated with this medication
"RTN","ORWDPS2",111,0)
 N IEN,I
"RTN","ORWDPS2",112,0)
 S IEN=0 F  S IEN=$O(^TMP("PSSDIN",$J,"OI",ORWPSOI,IEN)) Q:'IEN  D
"RTN","ORWDPS2",113,0)
 . S I=0 F  S I=$O(^TMP("PSSDIN",$J,"OI",ORWPSOI,IEN,I)) Q:'I  D
"RTN","ORWDPS2",114,0)
 . . S ILST=ILST+1,LST(ILST)="t"_^TMP("PSSDIN",$J,"OI",ORWPSOI,IEN,I)
"RTN","ORWDPS2",115,0)
 Q
"RTN","ORWDPS2",116,0)
OIMSG ; from OISLCT, get the orderable item message for this medication
"RTN","ORWDPS2",117,0)
 S I=0 F  S I=$O(^ORD(101.43,OI,8,I)) Q:I'>0  S ILST=ILST+1,LST(ILST)="t"_^(I,0)
"RTN","ORWDPS2",118,0)
 Q
"RTN","ORWDPS2",119,0)
ADMIN(REC,DFN,SCH,OI,LOC,ADMIN) ; return administration time info
"RTN","ORWDPS2",120,0)
 ; REC: StartText^StartTime^Duration^FirstAdmin
"RTN","ORWDPS2",121,0)
 S OI=+$P($G(^ORD(101.43,+OI,0)),U,2)
"RTN","ORWDPS2",122,0)
 S LOC=+$G(^SC(LOC,42)),REC=""
"RTN","ORWDPS2",123,0)
 I $L($G(^DPT(DFN,.1))) S REC=$$FIRST^ORCDPS3(DFN,LOC,OI,SCH,"",$G(ADMIN))
"RTN","ORWDPS2",124,0)
 Q
"RTN","ORWDPS2",125,0)
REQST(VAL,DFN,SCH,OI,LOC,TXT) ; return requested start time
"RTN","ORWDPS2",126,0)
 ; VAL: FirstAdmin time
"RTN","ORWDPS2",127,0)
 S VAL=""
"RTN","ORWDPS2",128,0)
 Q:'$L($G(SCH))  Q:'$G(OI)
"RTN","ORWDPS2",129,0)
 S OI=+$P($G(^ORD(101.43,+OI,0)),U,2)
"RTN","ORWDPS2",130,0)
 S LOC=+$G(^SC(LOC,42))
"RTN","ORWDPS2",131,0)
 S VAL=$P($$RESOLVE^PSJORPOE(DFN,SCH,OI,TXT,LOC),U,2)
"RTN","ORWDPS2",132,0)
 Q
"RTN","ORWDPS2",133,0)
DAY2QTY(VAL,DAY,UPD,SCH,DUR,PAT,DRG) ; return qty for days supply
"RTN","ORWDPS2",134,0)
 ; VAL: quantity
"RTN","ORWDPS2",135,0)
 N ORWX,I,X,ADUR,ADURNM
"RTN","ORWDPS2",136,0)
 S ORWX("DAYS SUPPLY")=DAY
"RTN","ORWDPS2",137,0)
 S ORWX("PATIENT")=PAT
"RTN","ORWDPS2",138,0)
 I DRG S ORWX("DRUG")=DRG
"RTN","ORWDPS2",139,0)
 F I=1:1:$L(UPD,U)-1 D
"RTN","ORWDPS2",140,0)
 . S ORWX("DOSE ORDERED",I)=$P(UPD,U,I)
"RTN","ORWDPS2",141,0)
 . S ORWX("SCHEDULE",I)=$P(SCH,U,I)
"RTN","ORWDPS2",142,0)
 . S ADUR=$P(DUR,U,I),ADURNM=$P($P(ADUR," ",2),"~")
"RTN","ORWDPS2",143,0)
 . S:ADURNM="MONTHS" X=+ADUR_"L"
"RTN","ORWDPS2",144,0)
 . S:ADURNM'="MONTHS" X=+ADUR_$E($P(ADUR," ",2))
"RTN","ORWDPS2",145,0)
 . I $L(X) S ORWX("DURATION",I)=X
"RTN","ORWDPS2",146,0)
 . S X=$E($P(ADUR,"~",2))
"RTN","ORWDPS2",147,0)
 . I $L(X) S ORWX("CONJUNCTION",I)=X
"RTN","ORWDPS2",148,0)
 D QTYX^PSOSIG(.ORWX)
"RTN","ORWDPS2",149,0)
 S VAL=$G(ORWX("QTY"))
"RTN","ORWDPS2",150,0)
 Q
"RTN","ORWDPS2",151,0)
QTY2DAY(VAL,QTY,UPD,SCH,DUR,PAT,DRG) ; return days supply given quantity
"RTN","ORWDPS2",152,0)
 ; VAL: days supply
"RTN","ORWDPS2",153,0)
 N ORWX,I,X,ADUR
"RTN","ORWDPS2",154,0)
 S ORWX("QTY")=QTY
"RTN","ORWDPS2",155,0)
 S ORWX("PATIENT")=PAT
"RTN","ORWDPS2",156,0)
 I DRG S ORWX("DRUG")=DRG
"RTN","ORWDPS2",157,0)
 F I=1:1:$L(UPD,U)-1 D
"RTN","ORWDPS2",158,0)
 . S ORWX("DOSE ORDERED",I)=$P(UPD,U,I)
"RTN","ORWDPS2",159,0)
 . S ORWX("SCHEDULE",I)=$P(SCH,U,I)
"RTN","ORWDPS2",160,0)
 . S ADUR=$P(DUR,U,I),X=+ADUR_$E($P(ADUR," ",2))
"RTN","ORWDPS2",161,0)
 . I $L(X) S ORWX("DURATION",I)=X
"RTN","ORWDPS2",162,0)
 . S X=$E($P(ADUR,"~",2))
"RTN","ORWDPS2",163,0)
 . I $L(X) S ORWX("CONJUNCTION",I)=X
"RTN","ORWDPS2",164,0)
 D QTYX^PSOSIG(.ORWX)
"RTN","ORWDPS2",165,0)
 S VAL=$G(ORWX("DAYS SUPPLY"))
"RTN","ORWDPS2",166,0)
 Q
"RTN","ORWDPS2",167,0)
MAXREF(VAL,PAT,DRG,SUP,OI,OUT) ; return the maximum number of refills
"RTN","ORWDPS2",168,0)
 ; PAT=Patient DFN, DRG=ptr50, SUP=days supply, OI=orderable item
"RTN","ORWDPS2",169,0)
 ; VAL: maximum refills allowed
"RTN","ORWDPS2",170,0)
 N ORWX
"RTN","ORWDPS2",171,0)
 S ORWX("PATIENT")=PAT
"RTN","ORWDPS2",172,0)
 I $G(DRG) S ORWX("DRUG")=+DRG
"RTN","ORWDPS2",173,0)
 I $G(SUP) S ORWX("DAYS SUPPLY")=SUP
"RTN","ORWDPS2",174,0)
 I $G(OI)  S ORWX("ITEM")=+$P(^ORD(101.43,+OI,0),U,2)
"RTN","ORWDPS2",175,0)
 I $G(OUT) S ORWX("DISCHARGE")=1
"RTN","ORWDPS2",176,0)
 D MAX^PSOSIGDS(.ORWX)
"RTN","ORWDPS2",177,0)
 S VAL=$G(ORWX("MAX"))
"RTN","ORWDPS2",178,0)
 Q
"RTN","ORWDPS2",179,0)
SCHREQ(VAL,OI,RTE,DRG) ; return 1 if schedule is required
"RTN","ORWDPS2",180,0)
 ; OI=orderable item, RTE=ptr route, DRG=ptr dispense drug
"RTN","ORWDPS2",181,0)
 S VAL=1
"RTN","ORWDPS2",182,0)
 Q:'$G(OI)  Q:'$G(RTE)
"RTN","ORWDPS2",183,0)
 S VAL=$$SCHREQ^PSJORPOE(RTE,OI,+$G(DRG))
"RTN","ORWDPS2",184,0)
 Q
"RTN","ORWDPS2",185,0)
CHKPI(VAL,ODIFN) ; return pre-existing patient instruct
"RTN","ORWDPS2",186,0)
 N IDNUM,IDPI
"RTN","ORWDPS2",187,0)
 S (IDNUM,IDPI)=0,VAL=""
"RTN","ORWDPS2",188,0)
 I '$D(^OR(100,ODIFN,4.5,"ID","PI")) S VAL="" Q
"RTN","ORWDPS2",189,0)
 F  S IDNUM=$O(^OR(100,ODIFN,4.5,"ID","PI",IDNUM)) Q:'IDNUM  D
"RTN","ORWDPS2",190,0)
 . F  S IDPI=$O(^OR(100,ODIFN,4.5,IDNUM,2,IDPI)) Q:'IDPI  D
"RTN","ORWDPS2",191,0)
 .. S VAL=VAL_^OR(100,ODIFN,4.5,IDNUM,2,IDPI,0)
"RTN","ORWDPS2",192,0)
 K IDNUM,IDPI
"RTN","ORWDPS2",193,0)
 Q
"RTN","ORWDPS2",194,0)
CHKGRP(VAL,ORIFN) ;
"RTN","ORWDPS2",195,0)
 ;Inpatient Med Order Group or Clin Meds Group: return 1
"RTN","ORWDPS2",196,0)
 ;If order belong to Outpatient Med Order Grpoup: return 2 
"RTN","ORWDPS2",197,0)
 ;Otherwise, return 0
"RTN","ORWDPS2",198,0)
 S VAL=0
"RTN","ORWDPS2",199,0)
 I '$L(ORIFN) Q
"RTN","ORWDPS2",200,0)
 N UDGRP,IPGRP,OPGRP,ODGRP,ODID,CLMED
"RTN","ORWDPS2",201,0)
 S ODID=+ORIFN
"RTN","ORWDPS2",202,0)
 Q:ODID<1
"RTN","ORWDPS2",203,0)
 S (UDGRP,IPGRP,OPGRP,ODGRP,CLMED)=0
"RTN","ORWDPS2",204,0)
 S UDGRP=$O(^ORD(100.98,"B","UD RX",UDGRP))
"RTN","ORWDPS2",205,0)
 S OPGRP=$O(^ORD(100.98,"B","OUTPATIENT MEDICATIONS",OPGRP))
"RTN","ORWDPS2",206,0)
 S IPGRP=$O(^ORD(100.98,"B","INPATIENT MEDICATIONS",IPGRP))
"RTN","ORWDPS2",207,0)
 S CLMED=$O(^ORD(100.98,"B","CLINIC ORDERS",CLMED))
"RTN","ORWDPS2",208,0)
 S:IPGRP=0 IPGRP=$O(^ORD(100.98,"B","I RX",IPGRP))
"RTN","ORWDPS2",209,0)
 I $L($G(^OR(100,ODID,0)))<1 Q
"RTN","ORWDPS2",210,0)
 S ODGRP=$P(^OR(100,ODID,0),U,11)
"RTN","ORWDPS2",211,0)
 I (UDGRP=ODGRP)!(CLMED=ODGRP) S VAL=1
"RTN","ORWDPS2",212,0)
 I IPGRP=ODGRP S VAL=1
"RTN","ORWDPS2",213,0)
 I OPGRP=ODGRP S VAL=2
"RTN","ORWDPS2",214,0)
 K UDGRP,ODGRP,OPGRP,IPGRP,ODID,CLMED
"RTN","ORWDPS2",215,0)
 Q
"RTN","ORWDPS2",216,0)
QOGRP(VAL,QOIFN) ;
"RTN","ORWDPS2",217,0)
 ;If quick order belong to Inpatient Med Order Group: return 1
"RTN","ORWDPS2",218,0)
 ;Otherwise, return 0
"RTN","ORWDPS2",219,0)
 S VAL=0
"RTN","ORWDPS2",220,0)
 I '$L(QOIFN) Q
"RTN","ORWDPS2",221,0)
 N UDGRP,IPGRP,QOGRP,QOID,CLMED
"RTN","ORWDPS2",222,0)
 S QOID=+QOIFN
"RTN","ORWDPS2",223,0)
 Q:QOID<1
"RTN","ORWDPS2",224,0)
 S (UDGRP,IPGRP,QOGRP,CLMED)=0
"RTN","ORWDPS2",225,0)
 S UDGRP=$O(^ORD(100.98,"B","UD RX",UDGRP))
"RTN","ORWDPS2",226,0)
 S IPGRP=$O(^ORD(100.98,"B","INPATIENT MEDICATIONS",IPGRP))
"RTN","ORWDPS2",227,0)
 S CLMED=$O(^ORD(100.98,"B","CLINIC ORDERS",CLMED))
"RTN","ORWDPS2",228,0)
 S:IPGRP=0 IPGRP=$O(^ORD(100.98,"B","I RX",IPGRP))
"RTN","ORWDPS2",229,0)
 I $L($G(^ORD(101.41,QOID,0)))<1 Q
"RTN","ORWDPS2",230,0)
 S QOGRP=$P(^ORD(101.41,QOID,0),U,5)
"RTN","ORWDPS2",231,0)
 I UDGRP=QOGRP S VAL=1
"RTN","ORWDPS2",232,0)
 I (IPGRP=QOGRP)!(CLMED=QOGRP) S VAL=1
"RTN","ORWDPS2",233,0)
 K UDGRP,QOGRP,QOID,IPGRP,CLMED
"RTN","ORWDPS2",234,0)
 Q
"RTN","ORWDPS32")
0^2^B70700114
"RTN","ORWDPS32",1,0)
ORWDPS32 ; SLC/KCM - Pharmacy Calls for GUI Dialog ; 02/11/2008
"RTN","ORWDPS32",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,94,190,195,243**;Dec 17, 1997;Build 242
"RTN","ORWDPS32",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ORWDPS32",4,0)
NXT() ; -- ret next available index in data array
"RTN","ORWDPS32",5,0)
 S ILST=ILST+1
"RTN","ORWDPS32",6,0)
 Q ILST
"RTN","ORWDPS32",7,0)
 ;
"RTN","ORWDPS32",8,0)
DLGSLCT(LST,PSTYPE,DFN,LOCIEN) ; return def lists for dialog
"RTN","ORWDPS32",9,0)
 ; PSTYPE: pharmacy type (U=unit dose, F=IV fluids, O=outpt)
"RTN","ORWDPS32",10,0)
 N ILST S ILST=0
"RTN","ORWDPS32",11,0)
 I PSTYPE="F" D  Q                       ; IV Fluids
"RTN","ORWDPS32",12,0)
 . S LST($$NXT)="~ShortList"  D SHORT
"RTN","ORWDPS32",13,0)
 . S LST($$NXT)="~Priorities" D PRIOR
"RTN","ORWDPS32",14,0)
 . ;S LST($$NXT)="~Schedules"  D SCHED(LOCIEN)
"RTN","ORWDPS32",15,0)
 . S LST($$NXT)="~Route" D IVROUTE
"RTN","ORWDPS32",16,0)
 ;
"RTN","ORWDPS32",17,0)
 S LST($$NXT)="~ShortList"  D SHORT      ; Unit Dose & Outpt
"RTN","ORWDPS32",18,0)
 ;S LST($$NXT)="~Schedules"  D SCHED(LOCIEN)
"RTN","ORWDPS32",19,0)
 S LST($$NXT)="~Priorities" D PRIOR
"RTN","ORWDPS32",20,0)
 I PSTYPE="O" D                          ; Outpt
"RTN","ORWDPS32",21,0)
 . S LST($$NXT)="~Pickup"   D PICKUP
"RTN","ORWDPS32",22,0)
 . S LST($$NXT)="~SCStatus" D SCLIST
"RTN","ORWDPS32",23,0)
 Q
"RTN","ORWDPS32",24,0)
SHORT ; from DLGSLCT, get short list of med quick orders
"RTN","ORWDPS32",25,0)
 ; !!! change this so that it uses the ORWDXQ call!!!
"RTN","ORWDPS32",26,0)
 N I,X,TMP
"RTN","ORWDPS32",27,0)
 I PSTYPE="U" S X="UD RX"
"RTN","ORWDPS32",28,0)
 I PSTYPE="F" S X="IV RX"
"RTN","ORWDPS32",29,0)
 I PSTYPE="O" S X="O RX"
"RTN","ORWDPS32",30,0)
 D GETQLST^ORWDXQ(.TMP,X,"iQ")
"RTN","ORWDPS32",31,0)
 S I=0 F  S I=$O(TMP(I)) Q:'I  S LST($$NXT)=TMP(I)
"RTN","ORWDPS32",32,0)
 Q
"RTN","ORWDPS32",33,0)
SCHEDA ; (similar to SCHED, but also rtns admin times)
"RTN","ORWDPS32",34,0)
 N X,IEN,SCH,TIME
"RTN","ORWDPS32",35,0)
 K ^TMP($J,"ORWDPS32 SCHEDA")
"RTN","ORWDPS32",36,0)
 D AP^PSS51P1("PSJ",,,,"ORWDPS32 SCHEDA")
"RTN","ORWDPS32",37,0)
 S SCH="" F  S SCH=$O(^TMP($J,"ORWDPS32 SCHEDA","APPSJ",SCH)) Q:SCH=""  D
"RTN","ORWDPS32",38,0)
 .S IEN="" F  S IEN=$O(^TMP($J,"ORWDPS32 SCHEDA","APPSJ",SCH,IEN)) Q:IEN'>0  D
"RTN","ORWDPS32",39,0)
 ..S TIME=$G(^TMP($J,"ORWDPS32 SCHEDA",IEN,1))
"RTN","ORWDPS32",40,0)
 ..S X=$S($L(TIME):"  ("_TIME_")",1:"")
"RTN","ORWDPS32",41,0)
 ..S LST($$NXT)="i"_IEN_U_SCH_U_X
"RTN","ORWDPS32",42,0)
 K ^TMP($J,"ORWDPS32 SCHEDA")
"RTN","ORWDPS32",43,0)
 Q
"RTN","ORWDPS32",44,0)
 ;
"RTN","ORWDPS32",45,0)
IVROUTE ;
"RTN","ORWDPS32",46,0)
 N ABB,EXP,IEN,RTE
"RTN","ORWDPS32",47,0)
 K ^TMP($J,"ORWDPS32 IVROUTE")
"RTN","ORWDPS32",48,0)
 D ALL^PSS51P2(,"??",,1,"ORWDPS32 IVROUTE")
"RTN","ORWDPS32",49,0)
 S RTE="" F  S RTE=$O(^TMP($J,"ORWDPS32 IVROUTE","B",RTE)) Q:RTE=""  D
"RTN","ORWDPS32",50,0)
 .S IEN=$O(^TMP($J,"ORWDPS32 IVROUTE","IV",RTE,"")) Q:IEN'>0
"RTN","ORWDPS32",51,0)
 .S ABB=$G(^TMP($J,"ORWDPS32 IVROUTE",IEN,1))
"RTN","ORWDPS32",52,0)
 .S EXP=$G(^TMP($J,"ORWDPS32 IVROUTE",IEN,4))
"RTN","ORWDPS32",53,0)
 .S LST($$NXT)="i"_IEN_U_RTE_U_ABB_U_EXP
"RTN","ORWDPS32",54,0)
 K ^TMP($J,"ORWDPS32 IVROUTE")
"RTN","ORWDPS32",55,0)
 Q
"RTN","ORWDPS32",56,0)
 ;
"RTN","ORWDPS32",57,0)
ALLIVRTE(LST) ;
"RTN","ORWDPS32",58,0)
 N ABB,CNT,EXP,IEN,RTE
"RTN","ORWDPS32",59,0)
 K ^TMP($J,"ORWDPS32 ALLIVRTE")
"RTN","ORWDPS32",60,0)
 S CNT=0
"RTN","ORWDPS32",61,0)
 D ALL^PSS51P2(,"??",,1,"ORWDPS32 ALLIVRTE")
"RTN","ORWDPS32",62,0)
 S RTE="" F  S RTE=$O(^TMP($J,"ORWDPS32 ALLIVRTE","B",RTE)) Q:RTE=""  D
"RTN","ORWDPS32",63,0)
 .S IEN=$O(^TMP($J,"ORWDPS32 ALLIVRTE","IV",RTE,"")) Q:IEN'>0
"RTN","ORWDPS32",64,0)
 .S ABB=$G(^TMP($J,"ORWDPS32 ALLIVRTE",IEN,1))
"RTN","ORWDPS32",65,0)
 .S EXP=$G(^TMP($J,"ORWDPS32 ALLIVRTE",IEN,4))
"RTN","ORWDPS32",66,0)
 .S CNT=CNT+1,LST(CNT)=IEN_U_RTE_U_ABB_U_U_U_U
"RTN","ORWDPS32",67,0)
 K ^TMP($J,"ORWDPS32 IVROUTE")
"RTN","ORWDPS32",68,0)
 Q
"RTN","ORWDPS32",69,0)
 ;
"RTN","ORWDPS32",70,0)
ROUTE ; from OISLCT^ORWDPS32, get list of routes for the drug form
"RTN","ORWDPS32",71,0)
 ; ** NEED BOTH ABBREVIATION & NAME IN LIST BOX
"RTN","ORWDPS32",72,0)
 N I,CNT,ABBR,IEN,ROUT,X
"RTN","ORWDPS32",73,0)
 S I="" F  S I=$O(^TMP("PSJMR",$J,I)) Q:I=""  D
"RTN","ORWDPS32",74,0)
 . S ROUT=$P(^TMP("PSJMR",$J,I),U),ABBR=$P(^(I),U,2),IEN=$P(^(I),U,3)
"RTN","ORWDPS32",75,0)
 . S LST($$NXT)="i"_IEN_U_ROUT_U_ABBR
"RTN","ORWDPS32",76,0)
 . I I=1,IEN S LST($$NXT)="d"_IEN_U_ROUT ;_U_ABBR ; assume first always default
"RTN","ORWDPS32",77,0)
 S I="" F  S I=$O(^TMP("PSJMR",$J,I)) Q:I=""  D
"RTN","ORWDPS32",78,0)
 . S ROUT=$P(^TMP("PSJMR",$J,I),U),ABBR=$P(^(I),U,2),IEN=$P(^(I),U,3)
"RTN","ORWDPS32",79,0)
 . I $L(ABBR),(ABBR'=ROUT) S LST($$NXT)="i"_IEN_U_ABBR_" ("_ROUT_")"_U_ABBR
"RTN","ORWDPS32",80,0)
 Q
"RTN","ORWDPS32",81,0)
 ;similar to SCHED^ORWDPS32, also returns Admin Time for Patient ward location
"RTN","ORWDPS32",82,0)
 ;AGP CPRS 27.72 THIS CODE IS NOT NEEDED ANYMORE
"RTN","ORWDPS32",83,0)
SCHED(LOCIEN) ;
"RTN","ORWDPS32",84,0)
 N CNT,ORARRAY,SCH,IEN,EXP,TIME,TYP,X0,WIEN
"RTN","ORWDPS32",85,0)
 ;K ^TMP($J,"ORWDPS32 SCHED1")
"RTN","ORWDPS32",86,0)
 S WIEN=$$WARDIEN(+LOCIEN)
"RTN","ORWDPS32",87,0)
 D SCHED^PSS51P1(WIEN,.ORARRAY)
"RTN","ORWDPS32",88,0)
 S CNT=0 F  S CNT=$O(ORARRAY(CNT)) Q:CNT'>0  D
"RTN","ORWDPS32",89,0)
 .S LST($$NXT)="i"_$P(ORARRAY(CNT),U,2,5)
"RTN","ORWDPS32",90,0)
 Q
"RTN","ORWDPS32",91,0)
 ;
"RTN","ORWDPS32",92,0)
WARDIEN(LOCIEN) ;
"RTN","ORWDPS32",93,0)
 N RESULT
"RTN","ORWDPS32",94,0)
 S RESULT=0
"RTN","ORWDPS32",95,0)
 I LOCIEN=0 Q RESULT
"RTN","ORWDPS32",96,0)
 I $P($G(^SC(LOCIEN,42)),U)="" Q RESULT
"RTN","ORWDPS32",97,0)
 S RESULT=+$P($G(^SC(LOCIEN,42)),U)
"RTN","ORWDPS32",98,0)
 Q RESULT
"RTN","ORWDPS32",99,0)
PRIOR ; from DLGSLCT, get list of allowed priorities
"RTN","ORWDPS32",100,0)
 N X,XREF
"RTN","ORWDPS32",101,0)
 S XREF=$S(PSTYPE="O":"S.PSO",1:"S.PSJ")
"RTN","ORWDPS32",102,0)
 S X="" F  S X=$O(^ORD(101.42,XREF,X)) Q:'$L(X)  D
"RTN","ORWDPS32",103,0)
 . S LST($$NXT)="i"_$O(^ORD(101.42,XREF,X,0))_U_X
"RTN","ORWDPS32",104,0)
 S LST($$NXT)="d"_$O(^ORD(101.42,"B","ROUTINE",0))_U_"ROUTINE"
"RTN","ORWDPS32",105,0)
 Q
"RTN","ORWDPS32",106,0)
PICKUP ; from DLGSLCT, get prescription routing
"RTN","ORWDPS32",107,0)
 N X,EDITONLY
"RTN","ORWDPS32",108,0)
 F X="W^at Window","M^by Mail","C^in Clinic" S LST($$NXT)="i"_X
"RTN","ORWDPS32",109,0)
 S X=$$DEFPICK I $L(X) S LST($$NXT)="d"_X
"RTN","ORWDPS32",110,0)
 Q
"RTN","ORWDPS32",111,0)
DEFPICK()       ; ret def routing
"RTN","ORWDPS32",112,0)
 N X,DLG,PRMT
"RTN","ORWDPS32",113,0)
 S DLG=$O(^ORD(101.41,"AB","PSO OERR",0)),X=""
"RTN","ORWDPS32",114,0)
 S PRMT=$O(^ORD(101.41,"AB","OR GTX ROUTING",0))
"RTN","ORWDPS32",115,0)
 I $D(^TMP("ORECALL",$J,+DLG,+PRMT,1)) S X=^(1)
"RTN","ORWDPS32",116,0)
 I X'="" S EDITONLY=1 Q X  ; EDITONLY used by def action
"RTN","ORWDPS32",117,0)
 ;
"RTN","ORWDPS32",118,0)
 S X=$$GET^XPAR("ALL","ORWDPS ROUTING DEFAULT",1,"I")
"RTN","ORWDPS32",119,0)
 I X="C" S X="C^in Clinic" G XPICK
"RTN","ORWDPS32",120,0)
 I X="M" S X="M^by Mail"   G XPICK
"RTN","ORWDPS32",121,0)
 I X="W" S X="W^at Window" G XPICK
"RTN","ORWDPS32",122,0)
 I X="N" S X=""             G XPICK
"RTN","ORWDPS32",123,0)
 I X=""  S X=$S($D(^PSX(550,"C")):"M^by Mail",1:"W^at Window")
"RTN","ORWDPS32",124,0)
XPICK Q X
"RTN","ORWDPS32",125,0)
 ;
"RTN","ORWDPS32",126,0)
SCLIST ; from DLGSLCT, get options for service connected
"RTN","ORWDPS32",127,0)
 F X="0^No","1^Yes" S LST($$NXT)="i"_X
"RTN","ORWDPS32",128,0)
 Q
"RTN","ORWDPS32",129,0)
 ;
"RTN","ORWDPS32",130,0)
OISLCT(LST,OI,PSTYPE,ORVP) ; rtn for defaults for pharm OI
"RTN","ORWDPS32",131,0)
 N ILST S ILST=0
"RTN","ORWDPS32",132,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORWDPS32",133,0)
 S LST($$NXT)="~Dispense" D DISPDRG
"RTN","ORWDPS32",134,0)
 S LST($$NXT)="~Instruct" D INSTRCT
"RTN","ORWDPS32",135,0)
 S LST($$NXT)="~Route"    D ROUTE
"RTN","ORWDPS32",136,0)
 S LST($$NXT)="~Message"  D MESSAGE
"RTN","ORWDPS32",137,0)
 I $L($G(^TMP("PSJSCH",$J))) S LST($$NXT)="~DefSched",LST($$NXT)="d"_^($J)
"RTN","ORWDPS32",138,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORWDPS32",139,0)
 Q
"RTN","ORWDPS32",140,0)
 ;
"RTN","ORWDPS32",141,0)
DISPDRUG(LST,OI) ; list dispense drugs for an OI
"RTN","ORWDPS32",142,0)
 N ILST,PSTYPE S ILST=0,PSTYPE="U" D DISPDRG
"RTN","ORWDPS32",143,0)
 Q
"RTN","ORWDPS32",144,0)
 ;
"RTN","ORWDPS32",145,0)
DISPDRG ; from OISLCT, get disp drugs for this pharm OI
"RTN","ORWDPS32",146,0)
 N I,ORTMP,ORX
"RTN","ORWDPS32",147,0)
 S ORX=$T(ENDD^PSJORUTL),ORX=$L($P(ORX,";"),",")
"RTN","ORWDPS32",148,0)
 I ORX>3 D ENDD^PSJORUTL("^^^"_+$P($G(^ORD(101.43,OI,0)),"^",2),PSTYPE,.ORTMP,+ORVP)
"RTN","ORWDPS32",149,0)
 I ORX'>3 D ENDD^PSJORUTL("^^^"_+$P($G(^ORD(101.43,OI,0)),"^",2),PSTYPE,.ORTMP)
"RTN","ORWDPS32",150,0)
 S I="" F  S I=$O(ORTMP(I)) Q:I=""  D
"RTN","ORWDPS32",151,0)
 . I $P(ORTMP(I),U,4)="1" S $P(ORTMP(I),U,4)="NF"
"RTN","ORWDPS32",152,0)
 . S $P(ORTMP(I),U,3)="$"_$P(ORTMP(I),U,3)_" per "_$P(ORTMP(I),U,5)
"RTN","ORWDPS32",153,0)
 . S LST($$NXT)="i"_ORTMP(I)
"RTN","ORWDPS32",154,0)
 Q
"RTN","ORWDPS32",155,0)
INSTRCT ; from OISLCT, get list of potential instructs (based on drug form)
"RTN","ORWDPS32",156,0)
 N INOUN,NOUN,IINS,INS,VERB,INSREC
"RTN","ORWDPS32",157,0)
 D START^PSSJORDF(+$P(^ORD(101.43,OI,0),U,2))
"RTN","ORWDPS32",158,0)
 I PSTYPE="U" Q  ; don't use the instructions list for inpatients
"RTN","ORWDPS32",159,0)
 S IINS=0 F  S IINS=$O(^TMP("PSJINS",$J,IINS)) Q:'IINS  D
"RTN","ORWDPS32",160,0)
 . S INSREC=$G(^TMP("PSJINS",$J,IINS))
"RTN","ORWDPS32",161,0)
 . I '$D(VERB) S VERB=$P(INSREC,U)
"RTN","ORWDPS32",162,0)
 . I $L($P(INSREC,U,2)) S LST($$NXT)="i"_$P(INSREC,U,2)
"RTN","ORWDPS32",163,0)
 S LST($$NXT)="~Nouns"
"RTN","ORWDPS32",164,0)
 S INOUN=0 F  S INOUN=$O(^TMP("PSJNOUN",$J,INOUN)) Q:'INOUN  D
"RTN","ORWDPS32",165,0)
 . S LST($$NXT)="i"_$P(^TMP("PSJNOUN",$J,INOUN),U)
"RTN","ORWDPS32",166,0)
 I $D(VERB) S LST($$NXT)="~Verb",LST($$NXT)="d"_VERB
"RTN","ORWDPS32",167,0)
 ;
"RTN","ORWDPS32",168,0)
 Q
"RTN","ORWDPS32",169,0)
MIXED(X)   ; Return mixed case
"RTN","ORWDPS32",170,0)
 Q X
"RTN","ORWDPS32",171,0)
 ;
"RTN","ORWDPS32",172,0)
MESSAGE ; message
"RTN","ORWDPS32",173,0)
 S I=0 F  S I=$O(^ORD(101.43,OI,8,I)) Q:I'>0  S LST($$NXT)="t"_^(I,0)
"RTN","ORWDPS32",174,0)
 Q
"RTN","ORWDPS32",175,0)
ALLROUTE(LST) ; returns a list of all available med routes
"RTN","ORWDPS32",176,0)
 N I,X,ILST
"RTN","ORWDPS32",177,0)
 S ILST=0
"RTN","ORWDPS32",178,0)
 K ^TMP($J,"ORWDPS32 ALLROUTE")
"RTN","ORWDPS32",179,0)
 D ALL^PSS51P2(,"??",,,"ORWDPS32 ALLROUTE")
"RTN","ORWDPS32",180,0)
 S I=0 F  S I=$O(^TMP($J,"ORWDPS32 ALLROUTE",I)) Q:'I  D
"RTN","ORWDPS32",181,0)
 . I +$P(^TMP($J,"ORWDPS32 ALLROUTE",I,3),U)>0 S LST($$NXT)=I_U_^TMP($J,"ORWDPS32 ALLROUTE",I,.01)_U_^TMP($J,"ORWDPS32 ALLROUTE",I,1)
"RTN","ORWDPS32",182,0)
 K ^TMP($J,"ORWDPS32 ALLROUTE")
"RTN","ORWDPS32",183,0)
 Q
"RTN","ORWDPS32",184,0)
VALROUTE(REC,X)        ; validates route name & returns IEN + abbreviation
"RTN","ORWDPS32",185,0)
 N ABBR,NAME,IEN
"RTN","ORWDPS32",186,0)
 K ^TMP($J,"ORWDPS32 VALROUTE")
"RTN","ORWDPS32",187,0)
 S X=$$UPPER(X)
"RTN","ORWDPS32",188,0)
 D ALL^PSS51P2(,X,,1,"ORWDPS32 VALROUTE")
"RTN","ORWDPS32",189,0)
 I $P(^TMP($J,"ORWDPS32 VALROUTE",0),U)=-1 K ^TMP($J,"ORWDPS32 VALROUTE") S REC=0 Q
"RTN","ORWDPS32",190,0)
 S IEN=$O(^TMP($J,"ORWDPS32 VALROUTE","B",X,""))
"RTN","ORWDPS32",191,0)
 I IEN'>0 S IEN=$O(^TMP($J,"ORWDPS32 VALROUTE","C",X,""))
"RTN","ORWDPS32",192,0)
 I IEN'>0 S REC=0 Q
"RTN","ORWDPS32",193,0)
 S NAME=$G(^TMP($J,"ORWDPS32 VALROUTE",IEN,.01))
"RTN","ORWDPS32",194,0)
 S ABBR=$G(^TMP($J,"ORWDPS32 VALROUTE",IEN,1))
"RTN","ORWDPS32",195,0)
 I '$L(ABBR) S ABBR=NAME
"RTN","ORWDPS32",196,0)
 I ($$UPPER(NAME)'=X),($$UPPER(ABBR)'=X) S REC=0 K ^TMP($J,"ORWDPS32 VALROUTE") Q
"RTN","ORWDPS32",197,0)
 S REC=IEN_U_ABBR
"RTN","ORWDPS32",198,0)
 K ^TMP($J,"ORWDPS32 VALROUTE")
"RTN","ORWDPS32",199,0)
 Q
"RTN","ORWDPS32",200,0)
AUTH(VAL,PRV) ; For inpatient meds, check restrictions
"RTN","ORWDPS32",201,0)
 N NAME,AUTH,INACT,X S VAL=0
"RTN","ORWDPS32",202,0)
 S NAME=$P($G(^VA(200,PRV,20)),U,2) S:'$L(NAME) NAME=$P(^(0),U)
"RTN","ORWDPS32",203,0)
 S X=$G(^VA(200,PRV,"PS")),AUTH=$P(X,U),INACT=$P(X,U,4)
"RTN","ORWDPS32",204,0)
 I 'AUTH!(INACT&(DT>INACT)) D  Q
"RTN","ORWDPS32",205,0)
 . S VAL="1^"_NAME_" is not authorized to write medication orders."
"RTN","ORWDPS32",206,0)
 I $D(^XUSEC("OREMAS",DUZ)),'$$GET^XPAR("ALL","OR OREMAS MED ORDERS") D  Q
"RTN","ORWDPS32",207,0)
 . S VAL="1^OREMAS key holders may not enter medication orders."
"RTN","ORWDPS32",208,0)
 Q
"RTN","ORWDPS32",209,0)
AUTHNVA(VAL,PRV) ; For Non-VA meds, check restrictions
"RTN","ORWDPS32",210,0)
 N NAME,AUTH,INACT,X S VAL=0
"RTN","ORWDPS32",211,0)
 I $D(^XUSEC("OREMAS",DUZ)),$$GET^XPAR("ALL","OR OREMAS NON-VA MED ORDERS")=2 Q
"RTN","ORWDPS32",212,0)
 I $D(^XUSEC("OREMAS",DUZ)),'$$GET^XPAR("ALL","OR OREMAS NON-VA MED ORDERS") D  Q
"RTN","ORWDPS32",213,0)
 . S VAL="1^OREMAS key holders may not enter non-VA medication orders."
"RTN","ORWDPS32",214,0)
 S NAME=$P($G(^VA(200,PRV,20)),U,2) S:'$L(NAME) NAME=$P(^(0),U)
"RTN","ORWDPS32",215,0)
 S X=$G(^VA(200,PRV,"PS")),AUTH=$P(X,U),INACT=$P(X,U,4)
"RTN","ORWDPS32",216,0)
 I 'AUTH!(INACT&(DT>INACT)) D  Q
"RTN","ORWDPS32",217,0)
 . S VAL="1^"_NAME_" is not authorized to write medication orders."
"RTN","ORWDPS32",218,0)
 Q
"RTN","ORWDPS32",219,0)
 ;
"RTN","ORWDPS32",220,0)
UPPER(X)        ; return uppercase
"RTN","ORWDPS32",221,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","ORWDPS32",222,0)
 ;
"RTN","ORWDPS32",223,0)
TRIM(X) ; trim leading and trailing spaces
"RTN","ORWDPS32",224,0)
 S X=$RE(X) F  S:$E(X)=" " X=$E(X,2,999) Q:$E(X)'=" "  Q:'$L(X)  ;trail
"RTN","ORWDPS32",225,0)
 S X=$RE(X) F  S:$E(X)=" " X=$E(X,2,999) Q:$E(X)'=" "  Q:'$L(X)  ;lead
"RTN","ORWDPS32",226,0)
 Q X
"RTN","ORWDPS32",227,0)
 ;
"RTN","ORWDPS33")
0^103^B31468284
"RTN","ORWDPS33",1,0)
ORWDPS33 ; SLC/KCM - Pharmacy Calls for GUI Dialog ; 01/26/2008
"RTN","ORWDPS33",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORWDPS33",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ORWDPS33",4,0)
 ;This routine move several RPCs from ORWDPS32 because of the routine size
"RTN","ORWDPS33",5,0)
 ;
"RTN","ORWDPS33",6,0)
COMPLOC(ORY,ORID,LOC) ;
"RTN","ORWDPS33",7,0)
 S ORY=0
"RTN","ORWDPS33",8,0)
 I LOC'=+$P($G(^OR(100,+ORID,0)),U,10) S ORY=1
"RTN","ORWDPS33",9,0)
 Q
"RTN","ORWDPS33",10,0)
DOSES(LST,OI) ; return doses for an orderable item  -  TEST ONLY
"RTN","ORWDPS33",11,0)
 N ORTMP,ORI,ORJ,ILST,LTSA,NDF,ORWDRG,VAPN,X,PSTYPE S PSTYPE="O"
"RTN","ORWDPS33",12,0)
 D ENDD^PSJORUTL("^^^"_+$P($G(^ORD(101.43,OI,0)),"^",2),PSTYPE,.ORTMP)
"RTN","ORWDPS33",13,0)
 S ORI=0 F  S ORI=$O(ORTMP(ORI)) Q:'ORI  S ORWDRG=+ORTMP(ORI) D
"RTN","ORWDPS33",14,0)
 . K ^TMP($J,"ORWDPS32 DRUG")
"RTN","ORWDPS33",15,0)
 . D NDF^PSS50(+ORWDRG,,,,,"ORWDPS32 DRUG")
"RTN","ORWDPS33",16,0)
 . S VAPN=$P($G(^TMP($J,"ORWDPS32 DRUG",+ORWDRG,22)),U),NDF=$P($G(^TMP($J,"ORWDPS32 DRUG",+ORWDRG,20)),U)
"RTN","ORWDPS33",17,0)
 . S X=$$DFSU^PSNAPIS(NDF,VAPN)
"RTN","ORWDPS33",18,0)
 . S LSTA($P(X,U,4),$P(X,U,6))=""
"RTN","ORWDPS33",19,0)
 . I +$P(X,U,4)=$P(X,U,4) S LSTA($P(X,U,4)*2,$P(X,U,6))=""
"RTN","ORWDPS33",20,0)
 K ^TMP($J,"ORWDPS32 DRUG")
"RTN","ORWDPS33",21,0)
 S ORI="",ILST=0 F  S ORI=$O(LSTA(ORI)) Q:ORI=""  D
"RTN","ORWDPS33",22,0)
 . S ORJ="" F  S ORJ=$O(LSTA(ORI,ORJ)) Q:ORJ=""  D
"RTN","ORWDPS33",23,0)
 . . S ILST=ILST+1,LST(ILST)=ORI_" "_ORJ
"RTN","ORWDPS33",24,0)
 Q
"RTN","ORWDPS33",25,0)
 ;
"RTN","ORWDPS33",26,0)
DRUGMSG(VAL,IEN)        ; return any message associated with a dispense drug
"RTN","ORWDPS33",27,0)
 N X S X=$$ENDCM^PSJORUTL(IEN)
"RTN","ORWDPS33",28,0)
 S VAL=$P(X,U,2)_U_$P(X,U,4)
"RTN","ORWDPS33",29,0)
 Q
"RTN","ORWDPS33",30,0)
 ;
"RTN","ORWDPS33",31,0)
FORMALT(ORLST,IEN,PSTYPE) ; return a list of formulary alternatives
"RTN","ORWDPS33",32,0)
 D ENRFA^PSJORUTL(IEN,PSTYPE,.ORLST)
"RTN","ORWDPS33",33,0)
 S I=0 F  S I=$O(ORLST(I)) Q:'I  D
"RTN","ORWDPS33",34,0)
 . S OI=+$O(^ORD(101.43,"ID",+$P(ORLST(I),U,4)_";99PSP",0))
"RTN","ORWDPS33",35,0)
 . S $P(ORLST(I),U,4)=OI I OI S $P(ORLST(I),U,5)=$P(^ORD(101.43,OI,0),U)
"RTN","ORWDPS33",36,0)
 Q
"RTN","ORWDPS33",37,0)
 ;
"RTN","ORWDPS33",38,0)
ISVALIV(RESULT,ORID,ACTION) ;
"RTN","ORWDPS33",39,0)
 N ARRAY,CNT,ID,IVD,NUM,ORDERID,OUTPUT,ROUTE,ROUTEID,TYPE
"RTN","ORWDPS33",40,0)
 S TYPE=$S(ACTION="XFR":"transfered",ACTION="RN":"renewed",1:"copied")
"RTN","ORWDPS33",41,0)
 S IVD=$O(^ORD(101.41,"B","PSJI OR PAT FLUID OE","")) Q:IVD'>0
"RTN","ORWDPS33",42,0)
 I +$P($G(^OR(100,+ORID,0)),U,5)'=IVD Q
"RTN","ORWDPS33",43,0)
 S ORDERID="",ROUTEID="",CNT=0
"RTN","ORWDPS33",44,0)
 F  S ORDERID=$O(^OR(100,+ORID,4.5,"ID","ORDERABLE",ORDERID)) Q:ORDERID'>0  D
"RTN","ORWDPS33",45,0)
 .I +$G(^OR(100,+ORID,4.5,ORDERID,1))'>0 Q
"RTN","ORWDPS33",46,0)
 .S CNT=CNT+1,ARRAY(CNT)=^OR(100,+ORID,4.5,ORDERID,1)
"RTN","ORWDPS33",47,0)
 S ROUTEID=+$O(^OR(100,+ORID,4.5,"ID","ROUTE","")) I ROUTEID'>0 D  Q
"RTN","ORWDPS33",48,0)
 .S RESULT="This order contains an invalid route it cannot be "_TYPE_"."
"RTN","ORWDPS33",49,0)
 S ROUTE=+$G(^OR(100,+ORID,4.5,ROUTEID,1)) I ROUTE'>0 D  Q
"RTN","ORWDPS33",50,0)
 .S RESULT="This order contains an invalid route it cannot be "_TYPE_"."
"RTN","ORWDPS33",51,0)
 S OUTPUT=$$IVQOVAL(.ARRAY,ROUTE) I OUTPUT="" D
"RTN","ORWDPS33",52,0)
 .;S TYPE=$S(ACTION="XFR":"transfered",ACTION="RN":"renewed",1:"copied")
"RTN","ORWDPS33",53,0)
 .S RESULT="This order contains an invalid route it cannot be "_TYPE_"."
"RTN","ORWDPS33",54,0)
 I RESULT'="" Q
"RTN","ORWDPS33",55,0)
 N IVTYPE,IVTYPEID,INFUSEID,INFUSE
"RTN","ORWDPS33",56,0)
 S IVTYPEID=+$O(^OR(100,+ORID,4.5,"ID","TYPE","")) I IVTYPEID'>0 D  Q
"RTN","ORWDPS33",57,0)
 .S RESULT="This order contains an  invalid IV Type it cannot be "_TYPE_"."
"RTN","ORWDPS33",58,0)
 S IVTYPE=$G(^OR(100,+ORID,4.5,IVTYPEID,1)) I IVTYPE="" D  Q
"RTN","ORWDPS33",59,0)
 .S RESULT="This order contains an invalid IV Type it cannot be "_TYPE_"."
"RTN","ORWDPS33",60,0)
 S INFUSEID=+$O(^OR(100,+ORID,4.5,"ID","RATE","")) Q:INFUSEID'>0
"RTN","ORWDPS33",61,0)
 S INFUSE=$G(^OR(100,+ORID,4.5,INFUSEID,1)) Q:INFUSE=""
"RTN","ORWDPS33",62,0)
 I $$VALINF^ORWDXM3(IVTYPE,INFUSE)=0 D
"RTN","ORWDPS33",63,0)
 .;S TYPE=$S(ACTION="XFR":"transfered",ACTION="RN":"renewed",1:"copied")
"RTN","ORWDPS33",64,0)
 .S RESULT="This order contains an invalid infusion rate it cannot be "_TYPE_"."
"RTN","ORWDPS33",65,0)
 Q
"RTN","ORWDPS33",66,0)
 ;
"RTN","ORWDPS33",67,0)
IVQOVAL(ARRAY,ROUTE) ;
"RTN","ORWDPS33",68,0)
 N CNT,RARR,RESULT
"RTN","ORWDPS33",69,0)
 S RESULT=""
"RTN","ORWDPS33",70,0)
 D IVDOSFRM(.RARR,.ARRAY,0,1)
"RTN","ORWDPS33",71,0)
 S CNT="" F  S CNT=$O(RARR(CNT)) Q:CNT'>0!(RESULT'="")  D
"RTN","ORWDPS33",72,0)
 .I $P(RARR(CNT),U)=ROUTE S RESULT=RARR(CNT) Q 
"RTN","ORWDPS33",73,0)
 Q RESULT
"RTN","ORWDPS33",74,0)
 ;
"RTN","ORWDPS33",75,0)
IVDOSFRM(LST,ORDERIDS,DEFAULT,ALLIV) ;
"RTN","ORWDPS33",76,0)
 N ARRAY,CNT,CNT1,OI,POI
"RTN","ORWDPS33",77,0)
 S OI="",CNT=0,CNT1=0
"RTN","ORWDPS33",78,0)
 F  S OI=$O(ORDERIDS(OI)) Q:OI'>0  D
"RTN","ORWDPS33",79,0)
 .S POI=+$P($G(^ORD(101.43,$G(ORDERIDS(OI)),0)),U,2) Q:POI'>0
"RTN","ORWDPS33",80,0)
 .S CNT=CNT+1
"RTN","ORWDPS33",81,0)
 .S ARRAY(CNT)=POI
"RTN","ORWDPS33",82,0)
 I CNT=0 Q
"RTN","ORWDPS33",83,0)
 S ARRAY(0)=CNT
"RTN","ORWDPS33",84,0)
 D START1^PSSJORDF(.ARRAY,ALLIV)
"RTN","ORWDPS33",85,0)
 S CNT="" F  S CNT=$O(ARRAY(CNT)) Q:CNT'>0  D
"RTN","ORWDPS33",86,0)
 .S CNT1=CNT1+1,LST(CNT1)=$G(ARRAY(CNT))
"RTN","ORWDPS33",87,0)
 ;this temp should be killed by Pharmacy. This will be removed once
"RTN","ORWDPS33",88,0)
 ;Pharmacy send an update
"RTN","ORWDPS33",89,0)
 K ^TMP("PSJMR",$J)
"RTN","ORWDPS33",90,0)
 Q
"RTN","ORWDPS33",91,0)
 ;
"RTN","ORWDPS33",92,0)
ISSPLY(VAL,IEN) ; return true if orderable item is a supply
"RTN","ORWDPS33",93,0)
 S VAL=0
"RTN","ORWDPS33",94,0)
 I $P($G(^ORD(101.43,IEN,"PS")),U,5)=1 S VAL=1
"RTN","ORWDPS33",95,0)
 Q
"RTN","ORWDPS33",96,0)
IVAMT(VAL,OI,ORWTYP)     ; return UNITS^AMOUNT |^AMOUNT^AMOUNT...| for IV soln
"RTN","ORWDPS33",97,0)
 N I,PSOI,ORWY,AMT
"RTN","ORWDPS33",98,0)
 S PSOI=+$P($G(^ORD(101.43,OI,0)),U,2)_ORWTYP,VAL=""
"RTN","ORWDPS33",99,0)
 D ENVOL^PSJORUT2(PSOI,.ORWY)
"RTN","ORWDPS33",100,0)
 I ORWTYP="B" D
"RTN","ORWDPS33",101,0)
 . S I=0 F  S I=$O(ORWY(I)) Q:I'>0  S AMT(+ORWY(I))="" D
"RTN","ORWDPS33",102,0)
 . . I ORWY(I)<1 D  ;SBR
"RTN","ORWDPS33",103,0)
 . . . K AMT(+ORWY(I))
"RTN","ORWDPS33",104,0)
 . . . S AMT(0_+ORWY(I))=""
"RTN","ORWDPS33",105,0)
 . S AMT=0,VAL="ML" F  S AMT=$O(AMT(AMT)) Q:AMT'>0  S VAL=VAL_U_AMT
"RTN","ORWDPS33",106,0)
 I ORWTYP="A" D
"RTN","ORWDPS33",107,0)
 . S I=+$O(ORWY(0)) S VAL=$P($G(ORWY(I)),U,2)
"RTN","ORWDPS33",108,0)
 . I '$L(VAL) S VAL="ML^LITER^MCG^MG^GM^UNITS^IU^MEQ^MM^MU^THOUU^MG-PE^NANOGRAM^MMOL"
"RTN","ORWDPS33",109,0)
 Q
"RTN","ORWDPS33",110,0)
 ;
"RTN","ORWDPS33",111,0)
MEDISIV(VAL,IEN)        ; return true if orderable item is IV medication
"RTN","ORWDPS33",112,0)
 S VAL=0
"RTN","ORWDPS33",113,0)
 I $P($G(^ORD(101.43,IEN,"PS")),U)=2 S VAL=1
"RTN","ORWDPS33",114,0)
 Q
"RTN","ORWDPS33",115,0)
 ;
"RTN","ORWDPS33",116,0)
SCSTS(VAL,ORVP,ORDRUG)  ; return service connected eligibility for patient
"RTN","ORWDPS33",117,0)
 N ORWP94 S ORWP94=$O(^ORD(101.41,"AB","PS MEDS",0))>0
"RTN","ORWDPS33",118,0)
 I $L($T(SC^PSOCP)),$$SC^PSOCP(+ORVP,+$G(ORDRUG)) S VAL=0 G XSCSTS
"RTN","ORWDPS33",119,0)
 I 'ORWP94,(+$$RXST^IBARXEU(+ORVP)>0) S VAL=0 G XSCSTS
"RTN","ORWDPS33",120,0)
 S VAL=1
"RTN","ORWDPS33",121,0)
XSCSTS Q
"RTN","ORWDPS33",122,0)
 ;
"RTN","ORWDPS33",123,0)
VALQTY(OK,X)    ; validate a quantity, return 1 if valid, 0 if not
"RTN","ORWDPS33",124,0)
 ; to be compatible with LM, make sure X is integer from 1 to 240
"RTN","ORWDPS33",125,0)
 ; this is based on the input transform from 52,7
"RTN","ORWDPS33",126,0)
 K:(+X'>0)!(+X>99999999)!(X'?.8N.1".".2N)!($L(X)>12) X
"RTN","ORWDPS33",127,0)
 S OK=$S($D(X):1,1:0)
"RTN","ORWDPS33",128,0)
 Q
"RTN","ORWDPS33",129,0)
 ;
"RTN","ORWDPS33",130,0)
VALRATE(VAL,X)   ; return "1" (true) if IV rate text is valid
"RTN","ORWDPS33",131,0)
 I $E($RE($$UPPER^ORWDPS32(X)),1,5)="RH/LM"  S X=$E(X,1,$L(X)-5)
"RTN","ORWDPS33",132,0)
 S X=$$TRIM^ORWDPS32(X)
"RTN","ORWDPS33",133,0)
 D ORINF^PSIVSP S VAL=$G(X) ;S OK=$S($D(X):1,1:0)
"RTN","ORWDPS33",134,0)
 Q
"RTN","ORWDPS33",135,0)
VALSCH(OK,X,PSTYPE)    ; validate a schedule, return 1 if valid, 0 if not
"RTN","ORWDPS33",136,0)
 I '$L($T(EN^PSSGSGUI)) S OK=-1 Q
"RTN","ORWDPS33",137,0)
 I $E($T(EN^PSSGSGUI),1,4)="EN(X" D
"RTN","ORWDPS33",138,0)
 . N ORX S ORX=$G(X) D EN^PSSGSGUI(.ORX,$G(PSTYPE,"I"))
"RTN","ORWDPS33",139,0)
 . K X S:$D(ORX) X=ORX
"RTN","ORWDPS33",140,0)
 E  D
"RTN","ORWDPS33",141,0)
 . D EN^PSSGSGUI
"RTN","ORWDPS33",142,0)
 S OK=$S($D(X):1,1:0)
"RTN","ORWDPS33",143,0)
 Q
"RTN","ORWDPS33",144,0)
 ;
"RTN","ORWDPS4")
0^44^B20050046
"RTN","ORWDPS4",1,0)
ORWDPS4 ;; SLC/JDL - Order Dialogs CO-PAY and Other;[12/31/01 6:38pm]
"RTN","ORWDPS4",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**116,125,131,141,173,187,190,195,215,243**;Dec 17, 1997;Build 242
"RTN","ORWDPS4",3,0)
 ;
"RTN","ORWDPS4",4,0)
CPLST(TEST,PTIFN,ORIFNS) ; --Get CP questions
"RTN","ORWDPS4",5,0)
 N ORIFN,ORDA,ORI,ORPSO,CPX
"RTN","ORWDPS4",6,0)
 S ORI=0,ORPSO=+$O(^DIC(9.4,"C","PSO",0))
"RTN","ORWDPS4",7,0)
 F  S ORI=$O(ORIFNS(ORI)) Q:'ORI  D
"RTN","ORWDPS4",8,0)
 .S ORIFN=+ORIFNS(ORI),ORDA=$P(ORIFNS(ORI),";",2)
"RTN","ORWDPS4",9,0)
 .I $D(^OR(100,ORIFN,0)),($P(^OR(100,ORIFN,0),U,14)=ORPSO) D
"RTN","ORWDPS4",10,0)
 ..N PRIO S PRIO=0
"RTN","ORWDPS4",11,0)
 ..I $D(^OR(100,ORIFN,4.5,"ID","URGENCY")) S PRIO=$O(^("URGENCY",0))
"RTN","ORWDPS4",12,0)
 ..S PRIO=$G(^OR(100,ORIFN,4.5,+PRIO,1))
"RTN","ORWDPS4",13,0)
 ..Q:PRIO=99
"RTN","ORWDPS4",14,0)
 ..S CPX=$$SC(ORIFN)
"RTN","ORWDPS4",15,0)
 ..I $L(CPX)>1 S TEST(ORIFN)=ORIFN_";"_ORDA_CPX
"RTN","ORWDPS4",16,0)
 K PTIFN,ORIFN,ORDA,ORI,CPX
"RTN","ORWDPS4",17,0)
 Q
"RTN","ORWDPS4",18,0)
 ;
"RTN","ORWDPS4",19,0)
CPINFO(Y,ORINFO) ; -- Save reponses to CP questions
"RTN","ORWDPS4",20,0)
 Q:'$D(ORINFO)
"RTN","ORWDPS4",21,0)
 N ORIFN,ORI,ORX,ANS S ORI=0
"RTN","ORWDPS4",22,0)
 F  S ORI=$O(ORINFO(ORI)) Q:'ORI  D
"RTN","ORWDPS4",23,0)
 .S ORIFN=$P($P(ORINFO(ORI),U,1),";",1)
"RTN","ORWDPS4",24,0)
 .S ANS=$P(ORINFO(ORI),U,2)
"RTN","ORWDPS4",25,0)
 .D REFMT(.ORX,ANS)
"RTN","ORWDPS4",26,0)
 .D SC^ORCSAVE2(.ORX,ORIFN)
"RTN","ORWDPS4",27,0)
 S Y=1
"RTN","ORWDPS4",28,0)
 K ORIFN,ORX,ORI,ANS
"RTN","ORWDPS4",29,0)
 Q
"RTN","ORWDPS4",30,0)
 ;
"RTN","ORWDPS4",31,0)
SC(ORIFN) ; -- Dialog validation, to ask CP questions
"RTN","ORWDPS4",32,0)
 ;Expects ORIFN and ORDA
"RTN","ORWDPS4",33,0)
 ;
"RTN","ORWDPS4",34,0)
 N DR S DR=""
"RTN","ORWDPS4",35,0)
 I '$L($T(SCNEW^PSOCP))!('$G(ORIFN))!('$G(ORDA)) Q DR
"RTN","ORWDPS4",36,0)
 I $P($G(^OR(100,ORIFN,8,ORDA,0)),U,2)'="NW" Q DR
"RTN","ORWDPS4",37,0)
 ;
"RTN","ORWDPS4",38,0)
 N OR3,ORDRUG,ORENEW,ORX,I,XACT,YACT,CPNODE,ASC,AAO,AIR,AEC,AMST,AHNC,ACV,ASHD
"RTN","ORWDPS4",39,0)
 S ORX="",XACT=""
"RTN","ORWDPS4",40,0)
 ;--Only new, renew, edited, copied outpatient order can continue...
"RTN","ORWDPS4",41,0)
 ;AGP CHANGE 26.65, will returned service connection data for change orders
"RTN","ORWDPS4",42,0)
 S OR3=$G(^OR(100,ORIFN,3)),XACT=$P(OR3,U,11) I (XACT'=0)&(XACT'=1)&((XACT'=2)&(XACT'="C")) Q DR
"RTN","ORWDPS4",43,0)
 I (XACT=1)&($D(^OR(100,ORIFN,5))=0) Q DR
"RTN","ORWDPS4",44,0)
 I $D(^OR(100,ORIFN,5))>0 D
"RTN","ORWDPS4",45,0)
 .S CPNODE=$G(^OR(100,ORIFN,5))
"RTN","ORWDPS4",46,0)
 .S ASC=$S($L($P(CPNODE,"^",1)):"SC;"_$P(CPNODE,"^",1),1:"")
"RTN","ORWDPS4",47,0)
 .S DR=$S($L(ASC):DR_U_ASC,1:DR)
"RTN","ORWDPS4",48,0)
 .S AAO=$S($L($P(CPNODE,"^",3)):"AO;"_$P(CPNODE,"^",3),1:"")
"RTN","ORWDPS4",49,0)
 .S DR=$S($L(AAO):DR_U_AAO,1:DR)
"RTN","ORWDPS4",50,0)
 .S AIR=$S($L($P(CPNODE,"^",4)):"IR;"_$P(CPNODE,"^",4),1:"")
"RTN","ORWDPS4",51,0)
 .S DR=$S($L(AIR):DR_U_AIR,1:DR)
"RTN","ORWDPS4",52,0)
 .S AEC=$S($L($P(CPNODE,"^",5)):"EC;"_$P(CPNODE,"^",5),1:"")
"RTN","ORWDPS4",53,0)
 .S DR=$S($L(AEC):DR_U_AEC,1:DR)
"RTN","ORWDPS4",54,0)
 .S AMST=$S($L($P(CPNODE,"^",2)):"MST;"_$P(CPNODE,"^",2),1:"")
"RTN","ORWDPS4",55,0)
 .S DR=$S($L(AMST):DR_U_AMST,1:DR)
"RTN","ORWDPS4",56,0)
 .S AHNC=$S($L($P(CPNODE,"^",6)):"HNC;"_$P(CPNODE,"^",6),1:"")
"RTN","ORWDPS4",57,0)
 .S DR=$S($L(AHNC):DR_U_AHNC,1:DR)
"RTN","ORWDPS4",58,0)
 .S ACV=$S($L($P(CPNODE,"^",7)):"CV;"_$P(CPNODE,"^",7),1:"")
"RTN","ORWDPS4",59,0)
 .S DR=$S($L(ACV):DR_U_ACV,1:DR)
"RTN","ORWDPS4",60,0)
 .S ASHD=$S($L($P(CPNODE,"^",8)):"SHD;"_$P(CPNODE,"^",8),1:"")
"RTN","ORWDPS4",61,0)
 .S DR=$S($L(ASHD):DR_U_ASHD,1:DR)
"RTN","ORWDPS4",62,0)
 .D CPCOMP(.DR)
"RTN","ORWDPS4",63,0)
 .K ASC,AAO,AIR,AEC,AMST,AHNC,CPNODE
"RTN","ORWDPS4",64,0)
 I $L(DR)>0 Q DR
"RTN","ORWDPS4",65,0)
 I XACT=2 S YACT=$P(OR3,U,5),ORENEW=$G(^OR(100,YACT,4)) ;get PS# if renewal
"RTN","ORWDPS4",66,0)
 S ORDRUG=$$VALUE^ORCSAVE2(ORIFN,"DRUG")
"RTN","ORWDPS4",67,0)
 D SCNEW^PSOCP(.ORX,+PTIFN,ORDRUG,$G(ORENEW)) I '$D(ORX) Q DR
"RTN","ORWDPS4",68,0)
 F I="SC","AO","IR","EC","MST","HNC","CV","SHD" D
"RTN","ORWDPS4",69,0)
 . I $D(ORX(I)) S DR=DR_U_I_$S($L(ORX(I)):";"_ORX(I),1:"")
"RTN","ORWDPS4",70,0)
 Q DR
"RTN","ORWDPS4",71,0)
REFMT(ORX,INFO) ;
"RTN","ORWDPS4",72,0)
 ;"U": Unchecked ("NO") 
"RTN","ORWDPS4",73,0)
 ;"C": Checked ("YES")
"RTN","ORWDPS4",74,0)
 ;"N" : Question not asked
"RTN","ORWDPS4",75,0)
 N RST,RST1
"RTN","ORWDPS4",76,0)
 S RST=""
"RTN","ORWDPS4",77,0)
 F I=1:1:$L(INFO)  S RST=RST_U_$S($E(INFO,I)="U":0,$E(INFO,I)="C":1,1:"")
"RTN","ORWDPS4",78,0)
 S RST1=$E(RST,2,$L(RST))
"RTN","ORWDPS4",79,0)
 S ORX("SC")=$P(RST1,U,1)
"RTN","ORWDPS4",80,0)
 S ORX("MST")=$P(RST1,U,5)
"RTN","ORWDPS4",81,0)
 S ORX("AO")=$P(RST1,U,2)
"RTN","ORWDPS4",82,0)
 S ORX("IR")=$P(RST1,U,3)
"RTN","ORWDPS4",83,0)
 S ORX("EC")=$P(RST1,U,4)
"RTN","ORWDPS4",84,0)
 S ORX("HNC")=$P(RST1,U,6)
"RTN","ORWDPS4",85,0)
 S ORX("CV")=$P(RST1,U,7)
"RTN","ORWDPS4",86,0)
 S ORX("SHD")=$P(RST1,U,8)
"RTN","ORWDPS4",87,0)
 K RST,RST1
"RTN","ORWDPS4",88,0)
 Q
"RTN","ORWDPS4",89,0)
CPCOMP(PREX) ; -- Compare the existed exemptions with new exemption questions
"RTN","ORWDPS4",90,0)
 N ORX1,ORDRUG1,CPI,LSTCP,TMPVAL
"RTN","ORWDPS4",91,0)
 S LSTCP=""
"RTN","ORWDPS4",92,0)
 S ORDRUG1=$$VALUE^ORCSAVE2(ORIFN,"DRUG")
"RTN","ORWDPS4",93,0)
 D SCNEW^PSOCP(.ORX1,+PTIFN,ORDRUG1,$G(ORENEW)) I '$D(ORX1) Q
"RTN","ORWDPS4",94,0)
 F CPI="SC","AO","IR","EC","MST","HNC","CV","SHD" D
"RTN","ORWDPS4",95,0)
 . I $D(ORX1(CPI)) D
"RTN","ORWDPS4",96,0)
 . . S TMPVAL=""
"RTN","ORWDPS4",97,0)
 . . I $F(PREX,CPI) D
"RTN","ORWDPS4",98,0)
 . . . S TMPVAL=+$E(PREX,$F(PREX,CPI)+1)
"RTN","ORWDPS4",99,0)
 . . . I $L(TMPVAL),((TMPVAL=0)!(TMPVAL=1)) S TMPVAL=CPI_";"_TMPVAL
"RTN","ORWDPS4",100,0)
 . . . E  S TMPVAL=CPI
"RTN","ORWDPS4",101,0)
 . . E  S TMPVAL=CPI
"RTN","ORWDPS4",102,0)
 . . S LSTCP=LSTCP_U_TMPVAL
"RTN","ORWDPS4",103,0)
 S PREX=LSTCP
"RTN","ORWDPS4",104,0)
 Q
"RTN","ORWDPS4",105,0)
IPOD4OP(ORY,ORID) ;True: is an Inpt (IV OI) order on an OutPatient
"RTN","ORWDPS4",106,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","ORWDPS4",107,0)
 S ORY=0
"RTN","ORWDPS4",108,0)
 N APKG,ADLG,ADG,APTCLS,RXDG,UDDLG,IPPKG
"RTN","ORWDPS4",109,0)
 S (RXDG,UDDLG,IPPKG)=0
"RTN","ORWDPS4",110,0)
 S RXDG=+$O(^ORD(100.98,"B","O RX",0))
"RTN","ORWDPS4",111,0)
 S UDDLG=+$O(^ORD(101.41,"B","PSJ OR PAT OE",0))
"RTN","ORWDPS4",112,0)
 S IPPKG=+$O(^DIC(9.4,"B","INPATIENT MEDICATIONS",0))
"RTN","ORWDPS4",113,0)
 S ADLG=+$P($G(^OR(100,+ORID,0)),U,5)
"RTN","ORWDPS4",114,0)
 S ADG=$P($G(^OR(100,+ORID,0)),U,11)
"RTN","ORWDPS4",115,0)
 S APKG=$P($G(^OR(100,+ORID,0)),U,14)
"RTN","ORWDPS4",116,0)
 S APTCLS=$P($G(^OR(100,+ORID,0)),U,12)
"RTN","ORWDPS4",117,0)
 I ADG=RXDG,(ADLG=UDDLG),(APKG=IPPKG),(APTCLS="I") S ORY=1
"RTN","ORWDPS4",118,0)
 Q
"RTN","ORWDPS4",119,0)
 ;
"RTN","ORWDPS4",120,0)
UPDTDG(ORY,ORID) ;Update Inpt order for outpatient DG to Inpt DG
"RTN","ORWDPS4",121,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","ORWDPS4",122,0)
 N UDDG
"RTN","ORWDPS4",123,0)
 S UDDG=$O(^ORD(100.98,"B","UD RX",0))
"RTN","ORWDPS4",124,0)
 S $P(^OR(100,+ORID,0),U,11)=UDDG
"RTN","ORWDPS4",125,0)
 Q
"RTN","ORWDPS4",126,0)
ISUDIV(ORY,ORIFN) ;True: OI of the order is for both UD and IV
"RTN","ORWDPS4",127,0)
 N OI
"RTN","ORWDPS4",128,0)
 S (OI,ORY)=0
"RTN","ORWDPS4",129,0)
 S OI=+$O(^OR(100,+$G(ORIFN),.1,"B",0)) Q:OI<1
"RTN","ORWDPS4",130,0)
 I $O(^ORD(101.43,OI,9,"B","IVM RX",0)) S ORY=1
"RTN","ORWDPS4",131,0)
 Q
"RTN","ORWDVAL")
0^30^B2573377
"RTN","ORWDVAL",1,0)
ORWDVAL ; SLC/KCM - Validate procedures
"RTN","ORWDVAL",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORWDVAL",3,0)
 ;
"RTN","ORWDVAL",4,0)
VALSCHED(ERR,SCHED) ; Validate a schedule
"RTN","ORWDVAL",5,0)
 ; Set up 'interval^repeat count', if no interval assume QD
"RTN","ORWDVAL",6,0)
 S ERR=0
"RTN","ORWDVAL",7,0)
 S INTERVAL=$P(SCHED," ",1),REPEAT=$P(SCHED," ",2)
"RTN","ORWDVAL",8,0)
 ;I '$O(^PS(51.1,"APLR",INTERVAL,0)) S ERR=1 Q
"RTN","ORWDVAL",9,0)
 K ^TMP($J,"ORLIST")
"RTN","ORWDVAL",10,0)
 D ZERO^PSS51P1(,INTERVAL,"LR",,"ORLIST")
"RTN","ORWDVAL",11,0)
 I '$D(^TMP($J,"ORLIST","B",INTERVAL)) K ^TMP($J,"ORLIST") S ERR=1 Q
"RTN","ORWDVAL",12,0)
 K ^TMP($J,"ORLIST")
"RTN","ORWDVAL",13,0)
 I '(X?1"X"1.N) S ERR=1 Q
"RTN","ORWDVAL",14,0)
 Q
"RTN","ORWDVAL",15,0)
STOPDT(ADATE,SCHED) ; Return stop date given a schedule
"RTN","ORWDVAL",16,0)
 ; Look at max days continuous orders
"RTN","ORWDVAL",17,0)
 ; set numdays to lesser of Xnn and LR MAX...
"RTN","ORWDVAL",18,0)
 ; calculate stop date from collection time
"RTN","ORWDVAL",19,0)
 Q
"RTN","ORWDVAL",20,0)
EXPSCHED(LST,SCHED,START,STOP,MAX) ; procedure
"RTN","ORWDVAL",21,0)
 ; Expand schedule into start/stop times
"RTN","ORWDVAL",22,0)
 N IEN,TYP,INTERVAL,REPEAT
"RTN","ORWDVAL",23,0)
 D VALSCHED I ERR S LST=""
"RTN","ORWDVAL",24,0)
 S INTERVAL=$P(SCHED," ",1),REPEAT=$E($P(SCHED," ",2),2,999)
"RTN","ORWDVAL",25,0)
 K ^TMP($J,"ORWDVAL") D AP^PSS51P1("LR",INTERVAL,,,"ORWDVAL")
"RTN","ORWDVAL",26,0)
 S IEN=$O(^TMP($J,"ORWDVAL","APLR",INTERVAL,0))
"RTN","ORWDVAL",27,0)
 S TYP=$P($G(^TMP($J,"ORWDVAL",IEN,5)),U)
"RTN","ORWDVAL",28,0)
 S FREQ=$G(^TMP($J,"ORWDVAL",IEN,2))
"RTN","ORWDVAL",29,0)
 I TYP="C" D  ; add interval until repeat count or stop time reached
"RTN","ORWDVAL",30,0)
 . ;
"RTN","ORWDVAL",31,0)
 I TYP="D" D  ; from start time look for matching day of week & add
"RTN","ORWDVAL",32,0)
 . ;
"RTN","ORWDVAL",33,0)
 I TYP="O" D  ; quit with just the start time
"RTN","ORWDVAL",34,0)
 . ;
"RTN","ORWDVAL",35,0)
 ; range, shift, dow-range ???
"RTN","ORWDVAL",36,0)
 K ^TMP($J,"ORWDVAL")
"RTN","ORWDVAL",37,0)
 Q
"RTN","ORWDVAL",38,0)
DATE ; Validate a date/time (allow visits)
"RTN","ORWDVAL",39,0)
 Q
"RTN","ORWDX")
0^62^B62342605
"RTN","ORWDX",1,0)
ORWDX ; SLC/KCM/REV/JLI - Order dialog utilities ;11/28/2006
"RTN","ORWDX",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,125,131,132,141,164,178,187,190,195,215,246,243**;Dec 17, 1997;Build 242
"RTN","ORWDX",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ORWDX",4,0)
 ;
"RTN","ORWDX",5,0)
ORDITM(Y,FROM,DIR,XREF) ; Subset of orderable items
"RTN","ORWDX",6,0)
 ; Y(n)=IEN^.01 Name^.01 Name  -or-  IEN^Synonym <.01 Name>^.01 Name
"RTN","ORWDX",7,0)
 N I,IEN,CNT,X,DTXT,CURTM,DEFROUTE
"RTN","ORWDX",8,0)
 S DEFROUTE=""
"RTN","ORWDX",9,0)
 S I=0,CNT=44,CURTM=$$NOW^XLFDT
"RTN","ORWDX",10,0)
 F  Q:I'<CNT  S FROM=$O(^ORD(101.43,XREF,FROM),DIR) Q:FROM=""  D
"RTN","ORWDX",11,0)
 . S IEN="" F  S IEN=$O(^ORD(101.43,XREF,FROM,IEN),DIR) Q:'IEN  D
"RTN","ORWDX",12,0)
 . . S X=^ORD(101.43,XREF,FROM,IEN)
"RTN","ORWDX",13,0)
 . . I +$P(X,U,3),$P(X,U,3)<CURTM Q
"RTN","ORWDX",14,0)
 . . Q:$P(X,U,5)  S I=I+1
"RTN","ORWDX",15,0)
 . . I XREF="S.IVA RX"!(XREF="S.IVB RX") S DEFROUTE=$P($G(^ORD(101.43,IEN,"PS")),U,8)
"RTN","ORWDX",16,0)
 . . I 'X S Y(I)=IEN_U_$P(X,U,2)_U_$P(X,U,2)_U_DEFROUTE
"RTN","ORWDX",17,0)
 . . E  S Y(I)=IEN_U_$P(X,U,2)_$C(9)_"<"_$P(X,U,4)_">"_U_$P(X,U,4)_U_DEFROUTE
"RTN","ORWDX",18,0)
 Q
"RTN","ORWDX",19,0)
ODITMBC(Y,XREF,ODLST) ;
"RTN","ORWDX",20,0)
 N CNT,NM,XRF
"RTN","ORWDX",21,0)
 S CNT=0,NM=0,XRF=XREF
"RTN","ORWDX",22,0)
 F  S CNT=$O(ODLST(CNT)) Q:'CNT  D FNDINFO(.Y,ODLST(CNT))
"RTN","ORWDX",23,0)
 Q
"RTN","ORWDX",24,0)
FNDINFO(Y,ODIEN) ;
"RTN","ORWDX",25,0)
 D FNDINFO^ORWDX1(.Y,.ODIEN)
"RTN","ORWDX",26,0)
 Q
"RTN","ORWDX",27,0)
DLGDEF(LST,DLG) ; Format mapping for a dlg
"RTN","ORWDX",28,0)
 D DLGDEF^ORWDX1(.LST,.DLG)
"RTN","ORWDX",29,0)
 Q
"RTN","ORWDX",30,0)
DLGQUIK(LST,QO) ;(NOT USED)
"RTN","ORWDX",31,0)
 D LOADRSP(.LST,QO)
"RTN","ORWDX",32,0)
 Q
"RTN","ORWDX",33,0)
LOADRSP(LST,RSPID,TRANS)      ; Load responses from 101.41 or 100
"RTN","ORWDX",34,0)
 ; RSPID:  C123456;1-3243 = cached copy,   134-3234 = cached quick
"RTN","ORWDX",35,0)
 ;         X123456;1      = change order,  134      = quick dialog
"RTN","ORWDX",36,0)
 N I,J,DLG,INST,ID,VAL,ILST,ROOT,ORLOC S ROOT=""
"RTN","ORWDX",37,0)
 I RSPID["-" S ROOT="^TMP(""ORWDXMQ"",$J,"""_RSPID_""")" G XROOT^ORWDX2
"RTN","ORWDX",38,0)
 I $E(RSPID)="X" S ROOT="^OR(100,"_+$P(RSPID,"X",2)_",4.5)"  G XROOT^ORWDX2
"RTN","ORWDX",39,0)
 I +RSPID=RSPID  S ROOT="^ORD(101.41,"_+RSPID_",6)" G XROOT^ORWDX2
"RTN","ORWDX",40,0)
 Q:ROOT=""
"RTN","ORWDX",41,0)
 G XROOT^ORWDX2
"RTN","ORWDX",42,0)
SAVE(REC,ORVP,ORNP,ORL,DLG,ORDG,ORIT,ORIFN,ORDIALOG,ORDEA,ORAPPT,ORSRC,OREVTDF) ;
"RTN","ORWDX",43,0)
 ; ORVP=DFN, ORNP=Provider, ORL=Location, DLG=Order Dialog,
"RTN","ORWDX",44,0)
 ; ORDG=Display Group, ORIT=Quick Order Dialog, ORAPPT=Appointment
"RTN","ORWDX",45,0)
 N ORDUZ,ORSTS,OREVENT,ORCAT,ORDA,ORTS,ORNEW,ORCHECK,ORLOG,ORLEAD,ORTRAIL,ORPKG,ORWP94,ORCATFN,OREVTYPE,ONPASS
"RTN","ORWDX",46,0)
 N XCNT,XCOMM,XDONE,XX  ;SBR
"RTN","ORWDX",47,0)
 S (XCOMM,XCNT)=""  ;SBR
"RTN","ORWDX",48,0)
 I $G(ORIFN)'="" D  ;SBR problem only occurs on change or renew orders
"RTN","ORWDX",49,0)
 . S XCNT=$O(^OR(100,+ORIFN,4.5,"ID","COMMENT",XCNT))  ;SBR
"RTN","ORWDX",50,0)
 . I XCNT'="" S XCOMM=$P($G(^OR(100,+ORIFN,4.5,XCNT,0)),"^",2)  ;SBR
"RTN","ORWDX",51,0)
 . I XCOMM'="" S XDONE=0,XX="" F  S XX=$O(ORDIALOG("WP",XCOMM,1,XX)) Q:XX=""  D  ;SBR
"RTN","ORWDX",52,0)
 . . I ORDIALOG("WP",XCOMM,1,XX,0)'="" S XDONE=1 Q  ;SBR
"RTN","ORWDX",53,0)
 . I XCOMM'="",'$G(XDONE),$D(ORDIALOG("WP",XCOMM)) K ORDIALOG("WP",XCOMM)  ;SBR
"RTN","ORWDX",54,0)
 S ORCATFN="" I $L($P(DLG,U,2)) S ORCATFN=$P(DLG,U,2),DLG=$P(DLG,U,1)
"RTN","ORWDX",55,0)
 ;Remove treating facility if inpatient and IMO order 26.42
"RTN","ORWDX",56,0)
 I $G(^DPT(ORVP,.1))'="",$P($G(^ORD(100.98,ORDG,0)),U)="CLINIC ORDERS" K ORDIALOG("ORTS")
"RTN","ORWDX",57,0)
 I $G(ORDIALOG("ORTS")) S ORTS=ORDIALOG("ORTS") K ORDIALOG("ORTS")
"RTN","ORWDX",58,0)
 I $G(ORDIALOG("ORSLOG")) S ORLOG=ORDIALOG("ORSLOG") K ORDIALOG("ORSLOG")
"RTN","ORWDX",59,0)
 I $D(ORDIALOG("OREVENT")) S OREVENT=ORDIALOG("OREVENT") K ORDIALOG("OREVENT")
"RTN","ORWDX",60,0)
 ;=====================================================
"RTN","ORWDX",61,0)
 ; Changed for v26.27 (RV)
"RTN","ORWDX",62,0)
 S ORCAT=$$INPT^ORCD,ORCAT=$S(ORCAT=1:"I",1:"O")
"RTN","ORWDX",63,0)
 ;I $L($G(OREVENT)) D
"RTN","ORWDX",64,0)
 ;. S ONPASS=0
"RTN","ORWDX",65,0)
 ;. S OREVTYPE=$$TYPE^OREVNTX(OREVENT)
"RTN","ORWDX",66,0)
 ;. I OREVTYPE="T" D ISPASS^OREVNTX1(.ONPASS,+OREVENT,"T")
"RTN","ORWDX",67,0)
 ;. S ORCAT=$S(OREVTYPE="A":"I",OREVTYPE="T":"I",ONPASS=1:"O",1:"O")
"RTN","ORWDX",68,0)
 ;E  S ORCAT=$S($L($P($G(^DPT(+ORVP,.1)),U)):"I",1:"O")
"RTN","ORWDX",69,0)
 ;=====================================================
"RTN","ORWDX",70,0)
 I DLG="PS MEDS" S ORWP94=1 D
"RTN","ORWDX",71,0)
 . I ORIT=$O(^ORD(101.41,"AB","PSO SUPPLY",0)) S DLG="PSO SUPPLY"
"RTN","ORWDX",72,0)
 . I ORIT=$O(^ORD(101.41,"AB","PSO OERR",0)) S DLG="PSO OERR"
"RTN","ORWDX",73,0)
 . I ORIT=$O(^ORD(101.41,"AB","PSJ OR PAT OE",0)) S DLG="PSJ OR PAT OE"
"RTN","ORWDX",74,0)
 I DLG="PSO OERR" S ORCAT="O" I $G(OREVENT("EFFECTIVE")) D
"RTN","ORWDX",75,0)
 . S ORDIALOG($O(^ORD(101.41,"B","OR GTX START DATE"_$S($G(ORWP94):"/TIME",1:""),0)),1)=OREVENT("EFFECTIVE")
"RTN","ORWDX",76,0)
 I DLG="PSJ OR PAT OE" S ORCAT="I"
"RTN","ORWDX",77,0)
 S:DLG="FHW1" ORCAT="I" S:DLG?1"FHW "2.7U1" MEAL" ORCAT="O"
"RTN","ORWDX",78,0)
 S ORVP=ORVP_";DPT(",ORL(2)=ORL_";SC(",ORL=ORL(2)
"RTN","ORWDX",79,0)
 I ORDG=$O(^ORD(100.98,"B","LAB",0)) D  ;use section
"RTN","ORWDX",80,0)
 . N OI,SUB S OI=+$G(ORDIALOG($$PTR^ORCD("OR GTX ORDERABLE ITEM"),1))
"RTN","ORWDX",81,0)
 . S SUB=$P($G(^ORD(101.43,OI,"LR")),U,6),ORDG=$$DGRP^ORMLR(SUB)
"RTN","ORWDX",82,0)
 K:'ORDG ORDG K:'ORIT ORIT ; Dgrp & Quick must be non-zero
"RTN","ORWDX",83,0)
 M ORCHECK=ORDIALOG("ORCHECK") K ORDIALOG("ORCHECK")
"RTN","ORWDX",84,0)
 S ORDIALOG=$O(^ORD(101.41,"AB",DLG,0))
"RTN","ORWDX",85,0)
 I 'ORDIALOG S ORDIALOG=$O(^ORD(101.41,"B",DLG,0))
"RTN","ORWDX",86,0)
 I $D(ORDIALOG("ORLEAD")) S ORLEAD=ORDIALOG("ORLEAD")
"RTN","ORWDX",87,0)
 I $D(ORDIALOG("ORTRAIL")) S ORTRAIL=ORDIALOG("ORTRAIL")
"RTN","ORWDX",88,0)
 D GETDLG1^ORCD(ORDIALOG)
"RTN","ORWDX",89,0)
 I $L(ORCATFN) S ORCAT=ORCATFN
"RTN","ORWDX",90,0)
 I $G(ORWP94) D
"RTN","ORWDX",91,0)
 . N SIGPRMT S SIGPRMT=$O(^ORD(101.41,"B","OR GTX SIG",0))
"RTN","ORWDX",92,0)
 . N INSPRMT S INSPRMT=$O(^ORD(101.41,"B","OR GTX INSTRUCTIONS",0))
"RTN","ORWDX",93,0)
 . I $L($G(ORDIALOG(SIGPRMT,1))) S ORDIALOG(INSPRMT,"FORMAT")="@"
"RTN","ORWDX",94,0)
 . I ORCAT="O" S ORPKG=$O(^DIC(9.4,"C","PSO",0))
"RTN","ORWDX",95,0)
 . I ORCAT="I" S ORPKG=$O(^DIC(9.4,"C","PSJ",0))
"RTN","ORWDX",96,0)
 S ORSRC=$G(ORSRC)
"RTN","ORWDX",97,0)
 D DELPI^ORWDX1 ;delete empty PI
"RTN","ORWDX",98,0)
 I $G(ORIFN)="" D  ; new order
"RTN","ORWDX",99,0)
 . D EN^ORCSAVE
"RTN","ORWDX",100,0)
 . S REC="" I ORIFN D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDX",101,0)
 . I '$D(^TMP("ORECALL",$J,ORDIALOG)) M ^TMP("ORECALL",$J,ORDIALOG)=ORDIALOG
"RTN","ORWDX",102,0)
 E  D
"RTN","ORWDX",103,0)
 . N OR0
"RTN","ORWDX",104,0)
 . S OR0=$G(^OR(100,+ORIFN,0)),ORSTS=$P($G(^(3)),U,3),ORDG=$P(OR0,U,11)
"RTN","ORWDX",105,0)
 . I $L($P(OR0,U,17)),ORSTS=10 S OREVENT=$P(OR0,U,17),OREVENT("TS")=$P(OR0,U,13)
"RTN","ORWDX",106,0)
 . D XX^ORCSAVE ; edit order
"RTN","ORWDX",107,0)
 . S REC="" S ORIFN=+ORIFN_";"_ORDA D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDX",108,0)
 Q
"RTN","ORWDX",109,0)
SENDED(ORWLST,ORIENS,TS,LOC) ; Release EDOs to svc
"RTN","ORWDX",110,0)
 N OK,ORVP,ORWERR,ORSIGST,ORDA,ORNATURE,ORIX,X,PTEVT,ORIFN,J,EVENT,LOCK
"RTN","ORWDX",111,0)
 S ORWERR="",ORIX=0,LOC=LOC_";SC("
"RTN","ORWDX",112,0)
 F  S ORIX=$O(ORIENS(ORIX)) Q:'ORIX  D
"RTN","ORWDX",113,0)
 . S ORIFN=ORIENS(ORIX)
"RTN","ORWDX",114,0)
 . S PTEVT=$P(^OR(100,+ORIFN,0),U,17) I PTEVT S LOCK=$$LCKEVT^ORX2(PTEVT) S:LOCK EVENT(PTEVT)="" I 'LOCK S ORWERR="1^delayed event is locked - another user is processing orders for this event" ;195
"RTN","ORWDX",115,0)
 . S ORDA=$P(ORIFN,";",2) S:'ORDA ORDA=1
"RTN","ORWDX",116,0)
 . S ORVP=$P($G(^OR(100,+ORIFN,0)),U,2)
"RTN","ORWDX",117,0)
 . I $D(^OR(100,+ORIFN,8,ORDA,0)) D
"RTN","ORWDX",118,0)
 .. S ORSIGST=$P($G(^(0)),U,4)
"RTN","ORWDX",119,0)
 .. S ORNATURE=$P($G(^(0)),U,12)
"RTN","ORWDX",120,0)
 . S:$G(LOC) $P(^OR(100,+ORIFN,0),U,10)=LOC ;set location
"RTN","ORWDX",121,0)
 . S:$G(TS) $P(^OR(100,+ORIFN,0),U,13)=TS ;set specialty
"RTN","ORWDX",122,0)
 . S OK=$$LOCK1^ORX2(ORIFN) I 'OK S ORWERR="1^"_$P(OK,U,2)
"RTN","ORWDX",123,0)
 . I OK,$G(LOCK) D EN2^ORCSEND(ORIENS(ORIX),ORSIGST,ORNATURE,.ORWERR),UNLK1^ORX2(ORIENS(ORIX)) ;add ,LOCK to if statement for 195
"RTN","ORWDX",124,0)
 . S ORWLST(ORIX)=ORIENS(ORIX)
"RTN","ORWDX",125,0)
 . I $L(ORWERR) S ORWLST(ORIX)=ORWLST(ORIX)_"^E^"_ORWERR Q
"RTN","ORWDX",126,0)
 . E  D
"RTN","ORWDX",127,0)
 .. S PTEVT=$P($G(^OR(100,+ORIENS(ORIX),0)),U,17)
"RTN","ORWDX",128,0)
 .. D:$$TYPE^OREVNTX(PTEVT)="M" SAVE^ORMEVNT1(ORIENS(ORIX),PTEVT,2)
"RTN","ORWDX",129,0)
 . S X="RS"
"RTN","ORWDX",130,0)
 . S $P(ORWLST(ORIX),U,2)=X
"RTN","ORWDX",131,0)
 S J=0 F  S J=$O(EVENT(J)) Q:'+J  D UNLEVT^ORX2(J) ;195
"RTN","ORWDX",132,0)
 Q
"RTN","ORWDX",133,0)
SEND(ORWLST,DFN,ORNP,ORL,ES,ORWREC) ; Sign
"RTN","ORWDX",134,0)
 ; DFN=Patient, ORNP=Provider, ORL=Location, ES=Encrypted ES code
"RTN","ORWDX",135,0)
 ; ORWREC(n)=ORIFN;Action^Signature Sts^Release Sts^Nature of Order
"RTN","ORWDX",136,0)
SEND1 N ORVP,ORWI,ORWERR,ORWREL,ORWSIG,ORWNATR,ORDERID,ORBEF,ORLR,ORLAB,X,I
"RTN","ORWDX",137,0)
 S ORVP=DFN_";DPT(",ORL=ORL_";SC(",ORL(2)=ORL,ORWLST=0
"RTN","ORWDX",138,0)
 F I="LR","VBEC" S X=+$O(^DIC(9.4,"C",I,0)) S:X ORLR(X)=1
"RTN","ORWDX",139,0)
 S ORWI=0 F  S ORWI=$O(ORWREC(ORWI)) Q:'ORWI  D
"RTN","ORWDX",140,0)
 . S X=ORWREC(ORWI),ORWERR=""
"RTN","ORWDX",141,0)
 . S ORDERID=$P(X,U),ORWSIG=$P(X,U,2),ORWREL=$P(X,U,3),ORWNATR=$P(X,U,4)
"RTN","ORWDX",142,0)
 . S ORBEF=0
"RTN","ORWDX",143,0)
 . I '$D(^OR(100,+ORDERID,0)) Q
"RTN","ORWDX",144,0)
 . I $D(^OR(100,+ORDERID,8,+$P(ORDERID,";",2),0)) S ORBEF=$P(^OR(100,+ORDERID,8,+$P(ORDERID,";",2),0),U,15)
"RTN","ORWDX",145,0)
 . S:$D(^OR(100,+ORDERID,8,+$P(ORDERID,";",2),0)) ORWNATR=$S($P(^OR(100,+ORDERID,8,+$P(ORDERID,";",2),0),"^",4)=3:"",1:ORWNATR)
"RTN","ORWDX",146,0)
 . S ORWERR=$$CHKACT^ORWDXR(ORDERID,ORWSIG,ORWREL,ORWNATR)
"RTN","ORWDX",147,0)
 . I $L(ORWERR) S ORWERR="1^"_ORWERR
"RTN","ORWDX",148,0)
 . I '$L(ORWERR) D
"RTN","ORWDX",149,0)
 .. I $G(ORLR(+$P(^OR(100,+ORDERID,0),U,14))),'$G(ORLAB) D  ; lab batch start
"RTN","ORWDX",150,0)
 ... I $L($T(BHS^ORMBLD)) D BHS^ORMBLD(ORVP) S ORLAB=1
"RTN","ORWDX",151,0)
 .. N OK S OK=$$LOCK1^ORX2(ORDERID) I 'OK S ORWERR="1^"_$P(OK,U,2)
"RTN","ORWDX",152,0)
 .. I OK D EN^ORCSEND(ORDERID,"",ORWSIG,ORWREL,ORWNATR,"",.ORWERR),UNLK1^ORX2(ORDERID)
"RTN","ORWDX",153,0)
 . S ORWLST(ORWI)=ORDERID,X=""
"RTN","ORWDX",154,0)
 . I $L(ORWERR) S ORWLST(ORWI)=ORWLST(ORWI)_"^E^"_ORWERR Q
"RTN","ORWDX",155,0)
 . I ORWREL,((ORBEF=10)!(ORBEF=11)),($P(^OR(100,+ORDERID,3),U,3)'=10) S X="R"
"RTN","ORWDX",156,0)
 . I ORWSIG'=2 S X=X_"S"
"RTN","ORWDX",157,0)
 . S $P(ORWLST(ORWI),U,2)=X
"RTN","ORWDX",158,0)
 I $G(ORLAB) D BTS^ORMBLD(ORVP)
"RTN","ORWDX",159,0)
 Q
"RTN","ORWDX",160,0)
DLGID(VAL,ORIFN) ; return dlg IEN for order
"RTN","ORWDX",161,0)
 S VAL=$P(^OR(100,+ORIFN,0),U,5)
"RTN","ORWDX",162,0)
 S VAL=$S($P(VAL,";",2)="ORD(101.41,":+VAL,1:0)
"RTN","ORWDX",163,0)
 Q
"RTN","ORWDX",164,0)
FORMID(VAL,ORIFN)  ; Base dlg FormID for an order
"RTN","ORWDX",165,0)
 N DLG
"RTN","ORWDX",166,0)
 S VAL=0,DLG=$P(^OR(100,+ORIFN,0),U,5)
"RTN","ORWDX",167,0)
 Q:$P(DLG,";",2)'="ORD(101.41,"
"RTN","ORWDX",168,0)
 D FORMID^ORWDXM(.VAL,+DLG)
"RTN","ORWDX",169,0)
 Q
"RTN","ORWDX",170,0)
AGAIN(VAL,DLG)  ; return true to keep dlg for another order
"RTN","ORWDX",171,0)
 S VAL=''$P($G(^ORD(101.41,DLG,0)),U,9)
"RTN","ORWDX",172,0)
 Q
"RTN","ORWDX",173,0)
DGRP(VAL,DLG)   ; Display grp pointer for a dlg
"RTN","ORWDX",174,0)
 S DLG=$S($E(DLG)="`":+$P(DLG,"`",2),1:$O(^ORD(101.41,"AB",DLG,0))) ;kcm
"RTN","ORWDX",175,0)
 S VAL=$P($G(^ORD(101.41,DLG,0)),U,5)
"RTN","ORWDX",176,0)
 Q
"RTN","ORWDX",177,0)
DGNM(VAL,NM) ; Display grp pointer for name
"RTN","ORWDX",178,0)
 S VAL=$O(^ORD(100.98,"B",NM,0))
"RTN","ORWDX",179,0)
 Q
"RTN","ORWDX",180,0)
WRLST(LST,LOC) ; List of dlgs for writing orders
"RTN","ORWDX",181,0)
 G WRLST1^ORWDX1
"RTN","ORWDX",182,0)
MSG(LST,IEN) ; Msg text for orderable item
"RTN","ORWDX",183,0)
 N I
"RTN","ORWDX",184,0)
 S I=0 F  S I=$O(^ORD(101.43,IEN,8,I)) Q:I'>0  S LST(I)=^(I,0)
"RTN","ORWDX",185,0)
 Q
"RTN","ORWDX",186,0)
DISMSG(VAL,IEN) ; Disabled mge for ordering dlg
"RTN","ORWDX",187,0)
 S VAL=$P($G(^ORD(101.41,+IEN,0)),U,3)
"RTN","ORWDX",188,0)
 Q
"RTN","ORWDX",189,0)
LOCK(OK,DFN) ; Attempt to lock pt for ordering
"RTN","ORWDX",190,0)
 S OK=$$LOCK^ORX2(DFN)
"RTN","ORWDX",191,0)
 Q
"RTN","ORWDX",192,0)
UNLOCK(OK,DFN) ; Unlock pt for ordering
"RTN","ORWDX",193,0)
 D UNLOCK^ORX2(DFN) S OK=1
"RTN","ORWDX",194,0)
 Q
"RTN","ORWDX",195,0)
LOCKORD(OK,ORIFN) ; Attempt to lock order
"RTN","ORWDX",196,0)
 S OK=$$LOCK1^ORX2(ORIFN)
"RTN","ORWDX",197,0)
 Q
"RTN","ORWDX",198,0)
UNLKORD(OK,ORIFN) ; Unlock order
"RTN","ORWDX",199,0)
 D UNLK1^ORX2(ORIFN) S OK=1
"RTN","ORWDX",200,0)
 Q
"RTN","ORWDX1")
0^19^B51089138
"RTN","ORWDX1",1,0)
ORWDX1 ; SLC/KCM/REV - Utilities for Order Dialogs ;06/06/2007
"RTN","ORWDX1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**85,187,195,215,243**;Dec 17, 1997;Build 242
"RTN","ORWDX1",3,0)
 ;
"RTN","ORWDX1",4,0)
WRLST(LST,LOC) ; Return list of dialogs for writing orders
"RTN","ORWDX1",5,0)
 ; .Y(n): DlgName^ListBox Text
"RTN","ORWDX1",6,0)
WRLST1 N ANENT
"RTN","ORWDX1",7,0)
 S LOC=+$G(LOC)_";SC(" I 'LOC S LOC=""
"RTN","ORWDX1",8,0)
 S ANENT="ALL^"_LOC_$S($G(^VA(200,DUZ,5)):"^SRV.`"_+$G(^(5)),1:"")
"RTN","ORWDX1",9,0)
 D WRLSTB(.LST) Q:$D(LST)>1  ; check ORWDX WRITE ORDERS first
"RTN","ORWDX1",10,0)
 N ORX,X0,X5,ORERR,I,SEQ,IEN,DGRP,FID,TXT,TYP
"RTN","ORWDX1",11,0)
 D GETLST^XPAR(.ORX,ANENT,"ORWOR WRITE ORDERS LIST","Q",.ORERR) Q:ORERR
"RTN","ORWDX1",12,0)
 S I=0 F  S I=$O(ORX(I)) Q:'I  D
"RTN","ORWDX1",13,0)
 . S SEQ=+ORX(I),IEN=$P(ORX(I),U,2),X0=$G(^ORD(101.41,+IEN,0)),X5=$G(^(5))
"RTN","ORWDX1",14,0)
 . S DGRP=+$P(X0,U,5),FID=+$P(X5,U,5),TXT=$P(X5,U,4),TYP=$P(X0,U,4)
"RTN","ORWDX1",15,0)
 . S:'$L(TXT) TXT=$P(X0,U,2)
"RTN","ORWDX1",16,0)
 . I $P(X0,U,4)="M" S:'FID FID=1001
"RTN","ORWDX1",17,0)
 . S LST(SEQ)=IEN_";"_FID_";"_DGRP_";"_TYP_U_TXT
"RTN","ORWDX1",18,0)
 Q
"RTN","ORWDX1",19,0)
WRLSTB(LST)     ; return menu from which Write Orders list is built
"RTN","ORWDX1",20,0)
 N MNU,SEQ,IEN,ITM,TXT,FID,DGRP,X,TYP
"RTN","ORWDX1",21,0)
 S MNU=$$GET^XPAR(ANENT,"ORWDX WRITE ORDERS LIST",1,"I") Q:'MNU
"RTN","ORWDX1",22,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,MNU,10,"B",SEQ)) Q:'SEQ  D
"RTN","ORWDX1",23,0)
 . S IEN=0 F  S IEN=$O(^ORD(101.41,MNU,10,"B",SEQ,IEN)) Q:'IEN  D
"RTN","ORWDX1",24,0)
 . . S X=$G(^ORD(101.41,MNU,10,IEN,0)),ITM=+$P(X,U,2),TXT=$P(X,U,4)
"RTN","ORWDX1",25,0)
 . . S X=$G(^ORD(101.41,ITM,5)),FID=+$P(X,U,5)
"RTN","ORWDX1",26,0)
 . . S X=$G(^ORD(101.41,ITM,0)),TYP=$P(X,U,4),DGRP=+$P(X,U,5)
"RTN","ORWDX1",27,0)
 . . S:'$L(TXT) TXT=$P(X,U,2)
"RTN","ORWDX1",28,0)
 . . I TYP="M" S:'FID FID=1001
"RTN","ORWDX1",29,0)
 . . S LST(SEQ)=ITM_";"_FID_";"_DGRP_";"_TYP_U_TXT
"RTN","ORWDX1",30,0)
 Q
"RTN","ORWDX1",31,0)
DELPI ; delete PI from ORDIALOG if PI = ""
"RTN","ORWDX1",32,0)
 ;Called from SAVE^ORWDX
"RTN","ORWDX1",33,0)
 N ORPI S ORPI=0
"RTN","ORWDX1",34,0)
 S ORPI=$O(^ORD(101.41,"B","OR GTX PATIENT INSTRUCTIONS",ORPI))
"RTN","ORWDX1",35,0)
 Q:'$D(ORDIALOG(ORPI))
"RTN","ORWDX1",36,0)
 I '$D(ORDIALOG(ORPI,1)) K ORDIALOG(ORPI),ORDIALOG("WP",ORPI) Q
"RTN","ORWDX1",37,0)
 N PINODE,PITX
"RTN","ORWDX1",38,0)
 S PITX="",PINODE=$G(ORDIALOG(ORPI,1))
"RTN","ORWDX1",39,0)
 S PITX=$G(@PINODE@(1,0))
"RTN","ORWDX1",40,0)
 S PITX=$TR(PITX," ","")
"RTN","ORWDX1",41,0)
 I '$L(PITX) K ORDIALOG(ORPI),ORDIALOG("WP",ORPI) Q
"RTN","ORWDX1",42,0)
 N ORSIG S ORSIG=+$O(^ORD(101.41,"B","OR GTX SIG",0))
"RTN","ORWDX1",43,0)
 I $$STR^ORWDXR(ORSIG)[$$STR^ORWDXR(ORPI) S ORDIALOG(ORPI,"FORMAT")="@"
"RTN","ORWDX1",44,0)
 Q
"RTN","ORWDX1",45,0)
FNDINFO(Y,ODIEN) ;
"RTN","ORWDX1",46,0)
 N ODI,CRTM,FRM,XX
"RTN","ORWDX1",47,0)
 S FRM="",CRTM=$$NOW^XLFDT
"RTN","ORWDX1",48,0)
 F  S FRM=$O(^ORD(101.43,XRF,FRM)) Q:FRM=""  D
"RTN","ORWDX1",49,0)
 . S ODI=0 F  S ODI=$O(^ORD(101.43,XRF,FRM,ODI)) Q:'ODI  D
"RTN","ORWDX1",50,0)
 .. S XX=^ORD(101.43,XRF,FRM,ODI)
"RTN","ORWDX1",51,0)
 .. I +$P(XX,U,3),$P(XX,U,3)<CRTM Q
"RTN","ORWDX1",52,0)
 .. I ODI=ODIEN D
"RTN","ORWDX1",53,0)
 ... S NM=NM+1
"RTN","ORWDX1",54,0)
 ... I 'XX S Y(NM)=ODIEN_U_$P(XX,U,2)_U_$P(XX,U,2)
"RTN","ORWDX1",55,0)
 ... E  S Y(NM)=ODIEN_U_$P(XX,U,2)_$C(9)_"<"_$P(XX,U,4)_">"_U_$P(XX,U,4)
"RTN","ORWDX1",56,0)
 Q
"RTN","ORWDX1",57,0)
DLGDEF(LST,DLG) ; Format mapping for a dlg
"RTN","ORWDX1",58,0)
 N I,IEN,ILST,X0,X2,XW  S ILST=0
"RTN","ORWDX1",59,0)
 I $O(^ORD(101.41,"AB",DLG,0))>0 S DLG=$O(^ORD(101.41,"AB",DLG,0))
"RTN","ORWDX1",60,0)
 E  S DLG=$O(^ORD(101.41,"B",DLG,0))
"RTN","ORWDX1",61,0)
 Q:'DLG
"RTN","ORWDX1",62,0)
 S I=0 F  S I=$O(^ORD(101.41,DLG,10,I)) Q:I'>0  D
"RTN","ORWDX1",63,0)
 . S X0=$G(^ORD(101.41,DLG,10,I,0)),X2=$G(^(2)),IEN=+$P(X0,U,2)
"RTN","ORWDX1",64,0)
 . S ILST=ILST+1,LST(ILST)=U_IEN_U_$P(X2,U,1,7)
"RTN","ORWDX1",65,0)
 . I $P(X0,U,11) S $P(LST(ILST),U,11)=1
"RTN","ORWDX1",66,0)
 . S $P(LST(ILST),U)=$P($G(^ORD(101.41,IEN,1)),U,3)
"RTN","ORWDX1",67,0)
 . I $P($G(^ORD(101.41,IEN,0)),U)="OR GTX ADDITIVE" S $P(LST(ILST),U)="ADDITIVE"
"RTN","ORWDX1",68,0)
 . I $P($G(^ORD(101.41,IEN,0)),U)="OR GTX ADDL DIETS" S $P(LST(ILST),U)="ADDLDIETS"
"RTN","ORWDX1",69,0)
 . I $L($P(LST(ILST),U))=0 S $P(LST(ILST),U)="ID"_IEN
"RTN","ORWDX1",70,0)
 . I $D(^ORD(101.41,DLG,10,"DAD",IEN)) D
"RTN","ORWDX1",71,0)
 .. N SEQ,DA,CHILD S CHILD=""
"RTN","ORWDX1",72,0)
 .. S SEQ=0 F  S SEQ=$O(^ORD(101.41,DLG,10,"DAD",IEN,SEQ)) Q:'SEQ  D
"RTN","ORWDX1",73,0)
 ... S DA=0 F  S DA=$O(^ORD(101.41,DLG,10,"DAD",IEN,SEQ,DA)) Q:'DA  D
"RTN","ORWDX1",74,0)
 .... S CHILD=CHILD_+$P($G(^ORD(101.41,DLG,10,DA,0)),U,2)_"~"
"RTN","ORWDX1",75,0)
 .. S $P(LST(ILST),U,10)=CHILD
"RTN","ORWDX1",76,0)
 Q
"RTN","ORWDX1",77,0)
 ;
"RTN","ORWDX1",78,0)
CHANGE(ORLST,ORCLST,DFN,ISIMO) ;
"RTN","ORWDX1",79,0)
 N CATCH,CHANGE,CNT,INP,INPDIEN,IVM,IVMDIEN,ORIEN,ORLOC,OR3,ORDG
"RTN","ORWDX1",80,0)
 N CIEN,DIAL,TDIAL,TDIEN,UDIEN,QORDDG,PACKIEN
"RTN","ORWDX1",81,0)
 S (INP,IVM,INPDIEN,IVMDIEN,UDIEN)=0
"RTN","ORWDX1",82,0)
 S (TDIAL,TDIEN)=0
"RTN","ORWDX1",83,0)
 S INP=$O(^ORD(101.41,"B","PSJ OR PAT OE","")) Q:INP'>0
"RTN","ORWDX1",84,0)
 S IVM=$O(^ORD(101.41,"B","PSJI OR PAT FLUID OE","")) Q:IVM'>0
"RTN","ORWDX1",85,0)
 S TDIAL=$O(^ORD(101.41,"B","OR GXTEXT WORD PROCESSING ORDER","")) Q:TDIAL'>0
"RTN","ORWDX1",86,0)
 S INPDIEN=$O(^ORD(100.98,"B","INPATIENT MEDICATIONS","")) Q:INPDIEN'>0
"RTN","ORWDX1",87,0)
 S IVMDIEN=$O(^ORD(100.98,"B","IV MEDICATIONS","")) Q:IVMDIEN'>0
"RTN","ORWDX1",88,0)
 S UDIEN=$O(^ORD(100.98,"B","UNIT DOSE MEDICATIONS","")) Q:UDIEN'>0
"RTN","ORWDX1",89,0)
 S TIEN=$O(^ORD(100.98,"B","NURSING","")) Q:TIEN'>0
"RTN","ORWDX1",90,0)
 S CIEN=$O(^ORD(100.98,"B","CLINIC ORDERS","")) Q:CIEN'>0
"RTN","ORWDX1",91,0)
 S CNT=0 F  S CNT=$O(ORCLST(CNT)) Q:CNT'>0  D
"RTN","ORWDX1",92,0)
 .S CHANGE=0
"RTN","ORWDX1",93,0)
 .S ORIEN=$P($G(ORCLST(CNT)),U),ORIEN=$P(ORIEN,";")
"RTN","ORWDX1",94,0)
 .S ORDG=$P($G(^OR(100,ORIEN,0)),U,11)
"RTN","ORWDX1",95,0)
 .S ORLOC=$P($G(ORCLST(CNT)),U,2)
"RTN","ORWDX1",96,0)
 .S OR3=$G(^OR(100,ORIEN,3))
"RTN","ORWDX1",97,0)
 .S DIAL=$P(OR3,U,4)
"RTN","ORWDX1",98,0)
 .;Remove Treating Speciality if the order location is the clinic
"RTN","ORWDX1",99,0)
 .I $P($G(^OR(100,ORIEN,0)),U,10)=(ORLOC_";SC("),$P($G(^SC(ORLOC,0)),U,3)="C" D  Q
"RTN","ORWDX1",100,0)
 ..S $P(^OR(100,ORIEN,0),U,13)=""
"RTN","ORWDX1",101,0)
 .;
"RTN","ORWDX1",102,0)
 .;CHANGE PATIENT LOCATION AND PATIENT STATUS.
"RTN","ORWDX1",103,0)
 .S $P(^OR(100,ORIEN,0),U,10)=ORLOC_";SC("
"RTN","ORWDX1",104,0)
 .S PACKIEN=$P(^OR(100,ORIEN,0),U,14)
"RTN","ORWDX1",105,0)
 .I $$GET1^DIQ(9.4,PACKIEN_",",1)'="PSO" S $P(^OR(100,ORIEN,0),U,12)="I"
"RTN","ORWDX1",106,0)
 .;
"RTN","ORWDX1",107,0)
 .;Check for IMO orders Nursing Dialog problem
"RTN","ORWDX1",108,0)
 .S CATCH=$P($G(^OR(100,ORIEN,0)),U,11)
"RTN","ORWDX1",109,0)
 .;
"RTN","ORWDX1",110,0)
 .S $P(^OR(100,ORIEN,0),U,11)=$S(DIAL=(IVM_";ORD(101.41,"):IVMDIEN,DIAL=(INP_";ORD(101.41,"):INPDIEN,DIAL=(TDIAL_";ORD(101.41,"):TIEN,1:CATCH)
"RTN","ORWDX1",111,0)
 .;
"RTN","ORWDX1",112,0)
 .;Check for Quick Order Dialog
"RTN","ORWDX1",113,0)
 .I CATCH=$P($G(^OR(100,ORIEN,0)),U,11),ISIMO=1 D
"RTN","ORWDX1",114,0)
 ..S QORDDG=$P($G(^ORD(101.41,+DIAL,0)),U,5)
"RTN","ORWDX1",115,0)
 ..I QORDDG=UDIEN!(QORDDG=INPDIEN) S $P(^OR(100,ORIEN,0),U,11)=INPDIEN,DIAL=(INP_";ORD(101.41,") Q
"RTN","ORWDX1",116,0)
 ..I QORDDG=IVMDIEN S $P(^OR(100,ORIEN,0),U,11)=IVMDIEN,DIAL=(IVM_";ORD(101.41,") Q
"RTN","ORWDX1",117,0)
 ..I QORDDG=TIEN S $P(^OR(100,ORIEN,0),U,11)=TIEN,DIAL=(TDIAL_";ORD(101.41,") Q
"RTN","ORWDX1",118,0)
 .;
"RTN","ORWDX1",119,0)
 .;Add treating spec if Inpatient order
"RTN","ORWDX1",120,0)
 .;I (ISIMO=1)&(DIAL=(IVM_";ORD(101.41,"))!(DIAL=(INP_";ORD(101.41,")) D
"RTN","ORWDX1",121,0)
 .;.S $P(^OR(100,ORIEN,0),U,13)=+$G(^DPT(DFN,.103))
"RTN","ORWDX1",122,0)
 .I ISIMO=0 S $P(^OR(100,ORIEN,0),U,13)=+$G(^DPT(DFN,.103))
"RTN","ORWDX1",123,0)
 Q
"RTN","ORWDX1",124,0)
 ;
"RTN","ORWDX1",125,0)
STCHANGE(ORY,DFN,ORYARR) ;
"RTN","ORWDX1",126,0)
 N CNT,DONE,NODE,PHARMID,STR,STATUS
"RTN","ORWDX1",127,0)
 S ORY=0,DONE=0
"RTN","ORWDX1",128,0)
 I '$$PATCH^XPDUTL("PSS*1.0*93") Q
"RTN","ORWDX1",129,0)
 S CNT=0 F  S CNT=$O(ORYARR(CNT)) Q:CNT'>0!(DONE>0)  D
"RTN","ORWDX1",130,0)
 . S NODE=$G(ORYARR(CNT))
"RTN","ORWDX1",131,0)
 . S PHARMID=$P(NODE,U),STATUS=$P(NODE,U,2)
"RTN","ORWDX1",132,0)
 . I $$UP^XLFSTR(STATUS)'=$$STATUS^PSSORUTE(DFN,PHARMID) S ORY=1,DONE=1
"RTN","ORWDX1",133,0)
 Q
"RTN","ORWDX1",134,0)
ORDMATCH(ORY,DFN,ORYARR) ;
"RTN","ORWDX1",135,0)
 N ACTION,CNT,IEN,MATCH,ORDERID,STATUS
"RTN","ORWDX1",136,0)
 S CNT=0,MATCH=1
"RTN","ORWDX1",137,0)
 F  S CNT=$O(ORYARR(CNT)) Q:CNT'>0!(MATCH=0)  D
"RTN","ORWDX1",138,0)
 . S ORDERID=$P(ORYARR(CNT),U),STATUS=$P(ORYARR(CNT),U,2)
"RTN","ORWDX1",139,0)
 . I ORDERID=0,$G(ACTION)="" Q
"RTN","ORWDX1",140,0)
 . S IEN=$P(ORDERID,";"),ACTION=$P(ORDERID,";",2)
"RTN","ORWDX1",141,0)
 . I STATUS=$P($G(^OR(100,IEN,3)),U,3) Q
"RTN","ORWDX1",142,0)
 . I $P($G(^ORD(100.01,STATUS,0)),U)="DISCONTINUED/EDIT" Q
"RTN","ORWDX1",143,0)
 . ;S MATCH=0
"RTN","ORWDX1",144,0)
 . I $P($G(^OR(100,IEN,8,ACTION,0)),U,15)'=STATUS S MATCH=0
"RTN","ORWDX1",145,0)
 S ORY=MATCH
"RTN","ORWDX1",146,0)
 Q
"RTN","ORWDX1",147,0)
 ;
"RTN","ORWDX1",148,0)
DCREN(ORY,ORYARR) ;
"RTN","ORWDX1",149,0)
 N ACT,CNT,CNT1,I,OR3,ORG,ORGID,ORID,TEXT,STATUS
"RTN","ORWDX1",150,0)
 S CNT1=0
"RTN","ORWDX1",151,0)
 S CNT=0 F  S CNT=$O(ORYARR(CNT)) Q:CNT'>0  D
"RTN","ORWDX1",152,0)
 .S ORGID=ORYARR(CNT)
"RTN","ORWDX1",153,0)
 .S ORID=+ORGID,ACT=$P(ORGID,";",2),TEXT=""
"RTN","ORWDX1",154,0)
 .S OR3=$G(^OR(100,ORID,3))
"RTN","ORWDX1",155,0)
 .;Make sure current order status is pending
"RTN","ORWDX1",156,0)
 .I $P($G(^ORD(100.01,$P(OR3,U,3),0)),U)'="PENDING" Q
"RTN","ORWDX1",157,0)
 .S ORG=$P($G(OR3),U,5) Q:ORG'>0
"RTN","ORWDX1",158,0)
 .;do not add original order if it is expired
"RTN","ORWDX1",159,0)
 .S STATUS=$P(^OR(100,ORG,3),U,3)
"RTN","ORWDX1",160,0)
 .I $P($G(^ORD(100.01,STATUS,0)),U)="EXPIRED" Q
"RTN","ORWDX1",161,0)
 .;Do not add original order if Stop date has pass
"RTN","ORWDX1",162,0)
 .I $P(^OR(100,ORG,0),U,9)'>$$NOW^XLFDT Q
"RTN","ORWDX1",163,0)
 .;make sure current order is a renewed order
"RTN","ORWDX1",164,0)
 .I $P(OR3,U,11)'=2 Q
"RTN","ORWDX1",165,0)
 .S ACT=+$P($G(^OR(100,ORG,3)),U,7)
"RTN","ORWDX1",166,0)
 .S CNT1=CNT1+1,ORY(CNT1)=ORGID_U_$P(OR3,U,5)_";"_ACT_U_TEXT
"RTN","ORWDX1",167,0)
 Q
"RTN","ORWDX1",168,0)
DCORIG(ORY,ORIEN) ;
"RTN","ORWDX1",169,0)
 S $P(^OR(100,+ORIEN,6),U,9)=1
"RTN","ORWDX1",170,0)
 Q
"RTN","ORWDX1",171,0)
UNDCORIG(ORY,ORYARR) ;
"RTN","ORWDX1",172,0)
 N CNT
"RTN","ORWDX1",173,0)
 S CNT=0 F  S CNT=$O(ORYARR(CNT)) Q:CNT'>0  S $P(^OR(100,+ORYARR(CNT),6),U,9)=0
"RTN","ORWDX1",174,0)
 Q
"RTN","ORWDX1",175,0)
PATWARD(ORY,DFN) ;
"RTN","ORWDX1",176,0)
 S ORY=0
"RTN","ORWDX1",177,0)
 I $G(^DPT(DFN,.1))'="" S ORY=1
"RTN","ORWDX1",178,0)
 Q
"RTN","ORWDX1",179,0)
ISPEND(ORIFN) ;Is the order's status pending?
"RTN","ORWDX1",180,0)
 N ISPEND,PENDST,N3 S ISPEND=0
"RTN","ORWDX1",181,0)
 Q:'$D(^OR(100,+ORIFN,3))
"RTN","ORWDX1",182,0)
 S PENDST=$O(^ORD(100.01,"B","PENDING",0))
"RTN","ORWDX1",183,0)
 S N3=$G(^OR(100,+ORIFN,3))
"RTN","ORWDX1",184,0)
 I $P(N3,U,3)=PENDST S ISPEND=1
"RTN","ORWDX1",185,0)
 Q ISPEND
"RTN","ORWDX2")
0^63^B12248764
"RTN","ORWDX2",1,0)
ORWDX2 ; SLC/JM/AGP - Order dialog utilities ;11/09/2006
"RTN","ORWDX2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**246,243**;Dec 17, 1997;Build 242
"RTN","ORWDX2",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ORWDX2",4,0)
 ;
"RTN","ORWDX2",5,0)
 Q
"RTN","ORWDX2",6,0)
 ;
"RTN","ORWDX2",7,0)
NXT() ; -- Gets index in array
"RTN","ORWDX2",8,0)
 S ILST=ILST+1
"RTN","ORWDX2",9,0)
 Q ILST
"RTN","ORWDX2",10,0)
 ;
"RTN","ORWDX2",11,0)
EXTVAL(IVAL,DLG) ; External value given a dlg ptr
"RTN","ORWDX2",12,0)
 N ORDIALOG
"RTN","ORWDX2",13,0)
 S ORDIALOG(DLG,0)=$P($G(^ORD(101.41,DLG,1)),U,1,2)
"RTN","ORWDX2",14,0)
 S ORDIALOG(DLG,1)=IVAL
"RTN","ORWDX2",15,0)
 I $E(ORDIALOG(DLG,0))="R",(+IVAL'=IVAL) Q IVAL  ; free text date/time
"RTN","ORWDX2",16,0)
 Q $$EXT^ORCD(DLG,1)  ; all others
"RTN","ORWDX2",17,0)
 ;
"RTN","ORWDX2",18,0)
XROOT ; Part of LOADRSP^ORWDX - moved here because of routine size
"RTN","ORWDX2",19,0)
 N CHKDOSE,DOSE,INSTR
"RTN","ORWDX2",20,0)
 S (ILST,I)=0,CHKDOSE=$$CHKDOSES
"RTN","ORWDX2",21,0)
 F  S I=$O(@ROOT@(I)) Q:I'>0  D
"RTN","ORWDX2",22,0)
 . S DLG=$P(@ROOT@(I,0),U,2),INST=$P(^(0),U,3)
"RTN","ORWDX2",23,0)
 . S ID=$P($G(^ORD(101.41,DLG,1)),U,3)
"RTN","ORWDX2",24,0)
 . I '$L(ID) S ID="ID"_DLG
"RTN","ORWDX2",25,0)
 . S VAL=$G(@ROOT@(I,1))
"RTN","ORWDX2",26,0)
 . I $P($G(^ORD(101.41,DLG,0)),U)="OR GTX ADDITIVE" S ID="ADDITIVE"
"RTN","ORWDX2",27,0)
 . I $E(RSPID)="C",(ID="START"),VAL Q  ; skip literal start time on copy
"RTN","ORWDX2",28,0)
 . S LST($$NXT)="~"_DLG_U_INST_U_ID
"RTN","ORWDX2",29,0)
 . I $L(VAL) D
"RTN","ORWDX2",30,0)
 .. S LST($$NXT)="i"_VAL,LST($$NXT)="e"_$$EXTVAL(VAL,DLG)
"RTN","ORWDX2",31,0)
 .. I CHKDOSE D DOSEINFO
"RTN","ORWDX2",32,0)
 . I $D(@ROOT@(I,2))>1 D
"RTN","ORWDX2",33,0)
 .. I $E(RSPID)?1U,'$G(TRANS),ID="COMMENT",'$$DRAFT(RSPID) D FORMID^ORWDX(.X,+$E(RSPID,2,99)) Q:X=140
"RTN","ORWDX2",34,0)
 .. S J=0 F  S J=$O(@ROOT@(I,2,J)) Q:J'>0  D
"RTN","ORWDX2",35,0)
 ... S LST($$NXT)="t"_$G(@ROOT@(I,2,J,0))
"RTN","ORWDX2",36,0)
 I CHKDOSE D FIXDOSES
"RTN","ORWDX2",37,0)
 I $E(ROOT,1,4)="^TMP" K ^TMP("ORWDXMQ",$J)
"RTN","ORWDX2",38,0)
 Q
"RTN","ORWDX2",39,0)
 ;
"RTN","ORWDX2",40,0)
DRAFT(ID) ; -- Return 1 or 0 if editing an unsigned/unreleased or pending order
"RTN","ORWDX2",41,0)
 N IEN,STS,ES
"RTN","ORWDX2",42,0)
 I $E(ID)?1U,$E(ID)'="X" Q 0
"RTN","ORWDX2",43,0)
 S IEN=$S(ID:+ID,1:+$E(ID,2,99))
"RTN","ORWDX2",44,0)
 S STS=$P($G(^OR(100,IEN,3)),U,3),ES=$P($G(^(8,1,0)),U,4)
"RTN","ORWDX2",45,0)
 I STS=5 Q 1
"RTN","ORWDX2",46,0)
 I STS=11 Q 1
"RTN","ORWDX2",47,0)
 I STS=10,ES=2 Q 1
"RTN","ORWDX2",48,0)
 Q 0
"RTN","ORWDX2",49,0)
 ;
"RTN","ORWDX2",50,0)
CHKDOSES() ; Returns true if doses may need to be modified
"RTN","ORWDX2",51,0)
 Q $$PATCH^XPDUTL("PSS*1.0*78")&($T(DOSE^PSSORUTE)'="")
"RTN","ORWDX2",52,0)
 ;
"RTN","ORWDX2",53,0)
DOSEINFO ; Collect pointers to dose information
"RTN","ORWDX2",54,0)
 I ID="INSTR" S INSTR(INST)=ILST-1
"RTN","ORWDX2",55,0)
 I ID="DOSE",+VAL>0 S DOSE(INST)=ILST-1 ; +VAL filters out local dosages
"RTN","ORWDX2",56,0)
 Q
"RTN","ORWDX2",57,0)
 ;
"RTN","ORWDX2",58,0)
FIXDOSES ; Update doses for those saved before PSS*1*78 was installed
"RTN","ORWDX2",59,0)
 N CODE,OLDDOSE,IDX,NEWDOSE,IIDX
"RTN","ORWDX2",60,0)
 S IIDX=0
"RTN","ORWDX2",61,0)
 F  S IIDX=$O(INSTR(IIDX)) Q:'+IIDX  D
"RTN","ORWDX2",62,0)
 . I +$G(INSTR(IIDX))>0,+$G(DOSE(IIDX))>0 D
"RTN","ORWDX2",63,0)
 .. S OLDDOSE=$E(LST(INSTR(IIDX)),2,999)
"RTN","ORWDX2",64,0)
 .. S NEWDOSE=$$DOSE^PSSORUTE(OLDDOSE)
"RTN","ORWDX2",65,0)
 .. I OLDDOSE'=NEWDOSE D
"RTN","ORWDX2",66,0)
 ... F IDX=0:1:1 D
"RTN","ORWDX2",67,0)
 .... S CODE=$E(LST(INSTR(IIDX)+IDX),1)
"RTN","ORWDX2",68,0)
 .... S LST(INSTR(IIDX)+IDX)=CODE_NEWDOSE
"RTN","ORWDX2",69,0)
 .. S OLDDOSE=$P(LST(DOSE(IIDX)),"&",5)
"RTN","ORWDX2",70,0)
 .. S NEWDOSE=$$DOSE^PSSORUTE(OLDDOSE)
"RTN","ORWDX2",71,0)
 .. I OLDDOSE'=NEWDOSE D
"RTN","ORWDX2",72,0)
 ... F IDX=0:1:1 D
"RTN","ORWDX2",73,0)
 .... S $P(LST(DOSE(IIDX)+IDX),"&",5)=NEWDOSE
"RTN","ORWDX2",74,0)
 Q
"RTN","ORWDX2",75,0)
 ;       
"RTN","ORWDX2",76,0)
DCREASON(LST)   ; Return a list of DC reasons
"RTN","ORWDX2",77,0)
 N ARRAY,CNT,ERROR,IEN,ILST,NAME,SEQARR,X
"RTN","ORWDX2",78,0)
 S ILST=1,LST(ILST)="~DCReason"
"RTN","ORWDX2",79,0)
 S IEN=0 F  S IEN=$O(^ORD(100.03,IEN)) Q:'IEN  S X=^(IEN,0) D
"RTN","ORWDX2",80,0)
 . I $P(X,U,4) Q                              ; inactive
"RTN","ORWDX2",81,0)
 . I $P(X,U,5)'=+$O(^DIC(9.4,"C","OR",0)) Q   ; not OR pkg
"RTN","ORWDX2",82,0)
 . I $P(X,U,7)=+$O(^ORD(100.02,"C","A",0)) Q  ; nature=auto
"RTN","ORWDX2",83,0)
 . S ARRAY($P(X,U))="i"_IEN_U_$P(X,U)
"RTN","ORWDX2",84,0)
 D GETLST^XPAR(.SEQARR,"SYS","OR DC REASON LIST","Q",.ERROR)
"RTN","ORWDX2",85,0)
 ;S CNT=0 F  S CNT=$O(SEQARR(CNT)) Q:CNT'>0  D
"RTN","ORWDX2",86,0)
 F CNT=1:1:SEQARR D
"RTN","ORWDX2",87,0)
 . S IEN=$P(SEQARR(CNT),U,2),NAME=$P(^ORD(100.03,IEN,0),U)
"RTN","ORWDX2",88,0)
 . S ILST=ILST+1,LST(ILST)="i"_IEN_U_NAME
"RTN","ORWDX2",89,0)
 . I $D(ARRAY(NAME))>0 K ARRAY(NAME)
"RTN","ORWDX2",90,0)
 I $D(ARRAY)'>0 Q
"RTN","ORWDX2",91,0)
 S NAME="" F  S NAME=$O(ARRAY(NAME)) Q:NAME=""  D
"RTN","ORWDX2",92,0)
 .S ILST=ILST+1,LST(ILST)=ARRAY(NAME)
"RTN","ORWDX2",93,0)
 Q
"RTN","ORWDXA")
0^15^B73502300
"RTN","ORWDXA",1,0)
ORWDXA ; SLC/KCM/JLI - Utilites for Order Actions; 10/07/2007 ; 2/7/08 11:48am
"RTN","ORWDXA",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,116,132,148,141,149,187,213,195,215,243**;Dec 17, 1997;Build 242
"RTN","ORWDXA",3,0)
 ;
"RTN","ORWDXA",4,0)
VALID(VAL,ORID,ACTION,ORNP,ORWNAT) ; Return error message if not valid action for order
"RTN","ORWDXA",5,0)
 N ORACT,ORVP,ORVER,ORIFN,PRTID S VAL="",PRTID=0
"RTN","ORWDXA",6,0)
 I +ORID=0 S VAL="This order has been deleted." Q
"RTN","ORWDXA",7,0)
 I '$D(^OR(100,+ORID,0)) S VAL="This order has been deleted!" Q
"RTN","ORWDXA",8,0)
 I ACTION="XFR",'$L($T(XFR^ORCACT01)) S ACTION="RW" ; for pre-POE
"RTN","ORWDXA",9,0)
 N ORNSS S ORNSS=1
"RTN","ORWDXA",10,0)
 I (ACTION="RN") D VALSCH^ORWNSS(.ORNSS,ORID)
"RTN","ORWDXA",11,0)
 I ORNSS=0 S VAL="This order contains an invalid administration schedule." Q
"RTN","ORWDXA",12,0)
 I (ACTION="RN") D ISVALIV^ORWDPS33(.VAL,ORID,ACTION) I $L(VAL)>0 Q
"RTN","ORWDXA",13,0)
 S ORIFN=ORID,ORVP=$P(^OR(100,+ORID,0),U,2)  ; ORCACT0 expects defined
"RTN","ORWDXA",14,0)
 I (ACTION="RN") D  Q:$L(VAL)  ; ** There's got to be a better way!
"RTN","ORWDXA",15,0)
 . N DLG S DLG=$P(^OR(100,+ORID,0),U,5) Q:DLG'[";ORD(101.41,"
"RTN","ORWDXA",16,0)
 . I $G(^ORD(101.41,+DLG,3))'["PROVIDER^ORCDPSIV" Q
"RTN","ORWDXA",17,0)
 . D AUTH^ORWDPS32(.VAL,ORNP)
"RTN","ORWDXA",18,0)
 . I VAL S VAL=$P(VAL,U,2)
"RTN","ORWDXA",19,0)
 . E  S VAL=""
"RTN","ORWDXA",20,0)
 S ORVER=$S(ACTION="CR":"R",$D(^XUSEC("ORELSE",DUZ)):"N",$D(^XUSEC("OREMAS",DUZ)):"C",1:"^")
"RTN","ORWDXA",21,0)
 I ACTION="CR" S ACTION="VR"
"RTN","ORWDXA",22,0)
 I (ACTION="ES")!(ACTION="OC")!(ACTION="RS") S ORACT=ACTION ; why not defined???
"RTN","ORWDXA",23,0)
 I (ACTION="VR"),'($D(^XUSEC("ORELSE",DUZ))!$D(^XUSEC("OREMAS",DUZ))) D  Q
"RTN","ORWDXA",24,0)
 . S VAL="You are not authorized to verify these orders."
"RTN","ORWDXA",25,0)
 I $L(VAL) Q
"RTN","ORWDXA",26,0)
 N OIIEN,ISIV,IVOD
"RTN","ORWDXA",27,0)
 S (ISIV,OIIEN,IVOD)=0
"RTN","ORWDXA",28,0)
 I (ACTION="RW")!(ACTION="XX")!(ACTION="XFR") D  Q:$L(VAL)
"RTN","ORWDXA",29,0)
 . S ISIV=$P(^OR(100,+ORID,0),U,11)
"RTN","ORWDXA",30,0)
 . I ISIV,($P(^ORD(100.98,ISIV,0),U,3)="IV RX") S IVOD=1
"RTN","ORWDXA",31,0)
 . D:'IVOD GTORITM^ORWDXR(.OIIEN,+ORID)
"RTN","ORWDXA",32,0)
 . D:OIIEN ISACTOI(.VAL,OIIEN) I $L(VAL)>0 Q
"RTN","ORWDXA",33,0)
 . N DLG,FRM
"RTN","ORWDXA",34,0)
 . S DLG=$P(^OR(100,+ORID,0),U,5),FRM=0
"RTN","ORWDXA",35,0)
 . I $P(DLG,";",2)'="ORD(101.41," S DLG=0
"RTN","ORWDXA",36,0)
 . I DLG D FORMID^ORWDXM(.FRM,+DLG)
"RTN","ORWDXA",37,0)
 . I '(DLG&FRM) D
"RTN","ORWDXA",38,0)
 . . S VAL="Copy & Change are not implemented for this order that predates CPRS."
"RTN","ORWDXA",39,0)
 N OREBUILD  ; sometimes left defined by $$VALID
"RTN","ORWDXA",40,0)
 ;I (ACTION="RW")!(ACTION="XFR")!(ACTION="RN") D ISVALIV^ORWDPS33(.VAL,ORID,ACTION) I $L(VAL)>0 Q
"RTN","ORWDXA",41,0)
 I $$VALID^ORCACT0(ORID,ACTION,.VAL,$G(ORWNAT)) S VAL="" ; VAL=error
"RTN","ORWDXA",42,0)
 Q
"RTN","ORWDXA",43,0)
 ;
"RTN","ORWDXA",44,0)
HOLD(REC,ORID,ORNP) ; Place an order on hold
"RTN","ORWDXA",45,0)
 N ACTDA
"RTN","ORWDXA",46,0)
 S ACTDA=$$ACTION^ORCSAVE("HD",+ORID,ORNP)
"RTN","ORWDXA",47,0)
 D GETBYIFN^ORWORR(.REC,+ORID_";"_ACTDA)
"RTN","ORWDXA",48,0)
 Q
"RTN","ORWDXA",49,0)
UNHOLD(REC,ORID,ORNP) ; Release an order from hold
"RTN","ORWDXA",50,0)
 N ACTDA
"RTN","ORWDXA",51,0)
 S ACTDA=$$ACTION^ORCSAVE("RL",+ORID,ORNP)
"RTN","ORWDXA",52,0)
 D GETBYIFN^ORWORR(.REC,+ORID_";"_ACTDA)
"RTN","ORWDXA",53,0)
 Q
"RTN","ORWDXA",54,0)
DC(REC,ORID,ORNP,ORL,REASON,DCORIG,ISNEWORD) ; Discontinue/Cancel/Delete an order
"RTN","ORWDXA",55,0)
 N NATURE,CREATE,PRINT,STATUS,ACTDA,SIGSTS
"RTN","ORWDXA",56,0)
 N X3,X8,CURRACT
"RTN","ORWDXA",57,0)
 Q:'+ORID
"RTN","ORWDXA",58,0)
 I $G(DCORIG)="" S DCORIG=0
"RTN","ORWDXA",59,0)
 S CURRACT=0
"RTN","ORWDXA",60,0)
 S ORL(2)=ORL_";SC(",ORL=ORL(2),NATURE=""
"RTN","ORWDXA",61,0)
 I REASON S NATURE=$P(^ORD(100.02,$P(^ORD(100.03,REASON,0),U,7),0),U,2)
"RTN","ORWDXA",62,0)
 S:NATURE="" NATURE="W"  ; S:ORNP=DUZ NATURE="E" 
"RTN","ORWDXA",63,0)
 ;change the way create work to support forcing signature for all DC
"RTN","ORWDXA",64,0)
 ;reasons
"RTN","ORWDXA",65,0)
 S CREATE=1,PRINT=$$PRINT^ORCACT2(NATURE)
"RTN","ORWDXA",66,0)
 ;S CREATE=$$CREATE^ORX1(NATURE)
"RTN","ORWDXA",67,0)
 S X3=$G(^OR(100,+ORID,3))
"RTN","ORWDXA",68,0)
 S CURRACT=$P(X3,U,7) S:CURRACT<1 CURRACT=+$O(^OR(100,+ORID,8,"?"),-1)
"RTN","ORWDXA",69,0)
 I '$D(^OR(100,+ORID,8,+$P(ORID,";",2),0)) D
"RTN","ORWDXA",70,0)
 . S X8=$G(^OR(100,+ORID,8,CURRACT,0))
"RTN","ORWDXA",71,0)
 . S SIGSTS=$P(X8,U,4)
"RTN","ORWDXA",72,0)
 . S $P(ORID,";",2)=CURRACT
"RTN","ORWDXA",73,0)
 E  D
"RTN","ORWDXA",74,0)
 . S X8=^OR(100,+ORID,8,+$P(ORID,";",2),0)
"RTN","ORWDXA",75,0)
 . S SIGSTS=$P(X8,U,4)
"RTN","ORWDXA",76,0)
 I '$D(SIGSTS) S SIGSTS=1
"RTN","ORWDXA",77,0)
 S STATUS=$P($G(^OR(100,+ORID,8,+$P(ORID,";",2),0)),U,15)
"RTN","ORWDXA",78,0)
 I (STATUS=10)!(STATUS=11) D  Q   ; delete/cancel unreleased order
"RTN","ORWDXA",79,0)
 . N RPLORD
"RTN","ORWDXA",80,0)
 . S RPLORD=$P($G(^OR(100,+ORID,3)),U,5)    ; replaced order
"RTN","ORWDXA",81,0)
 . D GETBYIFN^ORWORR(.REC,ORID)
"RTN","ORWDXA",82,0)
 . I STATUS=10,($P(X8,U,4)'=2) D  ; CANCEL signed, delayed, unreleased
"RTN","ORWDXA",83,0)
 . . ; taken from CLRDLY^ORCACT2
"RTN","ORWDXA",84,0)
 . . I REASON D SET^ORCACT2(+ORID,NATURE,REASON,,DCORIG)
"RTN","ORWDXA",85,0)
 . . I 'REASON D SET^ORCACT2(+ORID,"M","","Delayed Order Cancelled",DCORIG)
"RTN","ORWDXA",86,0)
 . . D STATUS^ORCSAVE2(+ORID,13) S $P(^OR(100,+ORID,8,1,0),U,15)=13
"RTN","ORWDXA",87,0)
 . E  D                           ; CANCEL OR DELETE unsigned, unreleased
"RTN","ORWDXA",88,0)
 . . I $P(X8,U,2)="DC" K ^OR(100,+ORID,6)
"RTN","ORWDXA",89,0)
 . . ; delete fwd ptr to order about to be deleted
"RTN","ORWDXA",90,0)
 . . I RPLORD,$P(X8,U,2)="NW" S $P(^OR(100,RPLORD,3),U,6)=""
"RTN","ORWDXA",91,0)
 . . ; delete ptr to order in Patient Event file #100.2
"RTN","ORWDXA",92,0)
 . . N EVT S EVT=$P($G(^OR(100,+ORID,0)),U,17) I EVT,EVT=+$O(^ORE(100.2,"AO",+ORID,0)) S $P(^ORE(100.2,EVT,0),U,4)="" K ^ORE(100.2,"AO",+ORID,EVT)
"RTN","ORWDXA",93,0)
 . . I $G(ISNEWORD) D DELETE^ORCSAVE2(ORID)
"RTN","ORWDXA",94,0)
 . . I '$G(ISNEWORD) D CANCEL^ORCSAVE2(ORID)
"RTN","ORWDXA",95,0)
 . I RPLORD,'(SIGSTS=1) S ORID=RPLORD  ; for Renews & Changes, show replaced order
"RTN","ORWDXA",96,0)
 . I '$D(^OR(100,+ORID)) D
"RTN","ORWDXA",97,0)
 . . S $P(REC(1),U)="~0",REC(2)="tDELETED: "_$E(REC(2),2,245)
"RTN","ORWDXA",98,0)
 . E  D
"RTN","ORWDXA",99,0)
 . . K REC
"RTN","ORWDXA",100,0)
 . . D GETBYIFN^ORWORR(.REC,+ORID_";"_$P($G(^OR(100,+ORID,3)),U,7))
"RTN","ORWDXA",101,0)
 . S $P(REC(1),U,14)=2 ; DCType = deletion
"RTN","ORWDXA",102,0)
 S ACTDA=$$ACTION^ORCSAVE("DC",+ORID,ORNP)
"RTN","ORWDXA",103,0)
 D SET^ORCACT2(+ORID,NATURE,REASON,,DCORIG)
"RTN","ORWDXA",104,0)
 D GETBYIFN^ORWORR(.REC,+ORID_";"_ACTDA)
"RTN","ORWDXA",105,0)
 S $P(REC(1),U,14)=$S(CREATE:1,1:3)  ;DCType - 1=NewOrder, 3=NewStatus
"RTN","ORWDXA",106,0)
 N PKG
"RTN","ORWDXA",107,0)
 S PKG=$P($G(^OR(100,+ORID,0)),U,14)
"RTN","ORWDXA",108,0)
 S PKG=$$NMSP^ORCD(PKG)
"RTN","ORWDXA",109,0)
 I REASON=16&(PKG="PS") D
"RTN","ORWDXA",110,0)
 . N XMB
"RTN","ORWDXA",111,0)
 . S XMB="OR DRUG ORDER CANCELLED"
"RTN","ORWDXA",112,0)
 . S XMB(1)=$P($G(REC(2)),"tDiscontinue",2),XMB(4)=$P($G(^VA(200,DUZ,0)),U)
"RTN","ORWDXA",113,0)
 . S XMB(2)=+ORID
"RTN","ORWDXA",114,0)
 . S XMB(3)=+$P($G(^OR(100,+ORID,0)),U,2)
"RTN","ORWDXA",115,0)
 . S XMB(3)=$P($G(^DPT(XMB(3),0)),U)
"RTN","ORWDXA",116,0)
 . D ^XMB
"RTN","ORWDXA",117,0)
 Q
"RTN","ORWDXA",118,0)
DCREQIEN(VAL) ; Return the IEN for Requesting Physician Cancelled reason
"RTN","ORWDXA",119,0)
 S VAL=$O(^ORD(100.03,"S","REQ",0))
"RTN","ORWDXA",120,0)
 Q
"RTN","ORWDXA",121,0)
COMPLETE(REC,ORID,ESCODE) ; Complete an order (generic orders)
"RTN","ORWDXA",122,0)
 ;N X S X=+$E($$NOW^XLFDT,1,12)
"RTN","ORWDXA",123,0)
 ;D DATES^ORCSAVE2(+ORID,,X)
"RTN","ORWDXA",124,0)
 ;D STATUS^ORCSAVE2(+ORID,2)
"RTN","ORWDXA",125,0)
 ; validate ESCode
"RTN","ORWDXA",126,0)
 D COMP^ORCSAVE2(ORID)
"RTN","ORWDXA",127,0)
 D GETBYIFN^ORWORR(.REC,ORID)
"RTN","ORWDXA",128,0)
 Q
"RTN","ORWDXA",129,0)
VERIFY(REC,ORID,ESCODE,ORVER) ; Verify an order
"RTN","ORWDXA",130,0)
 ; validate ESCode
"RTN","ORWDXA",131,0)
 S ORVER=$G(ORVER,$S($D(^XUSEC("ORELSE",DUZ)):"N",$D(^XUSEC("OREMAS",DUZ)):"C",1:U))
"RTN","ORWDXA",132,0)
 I ORVER'=U D
"RTN","ORWDXA",133,0)
 . N ORIFN,ORES,ORI
"RTN","ORWDXA",134,0)
 . ; to match 56, need to VERIFY any replaced orders:
"RTN","ORWDXA",135,0)
 . S ORIFN=ORID,ORES(ORIFN)="" D REPLCD^ORCACT1
"RTN","ORWDXA",136,0)
 . S ORI="" F  S ORI=$O(ORES(ORI)) Q:ORI=""  D EN^ORCSEND(ORI,"VR","",""),UNLK1^ORX2(+ORI):ORI'=ORID ;ORID locked prior
"RTN","ORWDXA",137,0)
 D GETBYIFN^ORWORR(.REC,ORID)
"RTN","ORWDXA",138,0)
 Q
"RTN","ORWDXA",139,0)
ALERT(DUMMY,ORID,ORDUZ) ;send alert to user (ORDUZ) when order (ORID) resulted
"RTN","ORWDXA",140,0)
 ;if no user passed from GUI, use ordering provider:
"RTN","ORWDXA",141,0)
 I $G(ORDUZ)<1 S ORDUZ=+$$ORDERER^ORQOR2(+ORID)
"RTN","ORWDXA",142,0)
 I $L($G(ORDUZ))<1 S ORDUZ=DUZ
"RTN","ORWDXA",143,0)
 S DUMMY=1,$P(^OR(100,+ORID,3),U,10)=ORDUZ
"RTN","ORWDXA",144,0)
 Q
"RTN","ORWDXA",145,0)
FLAG(REC,ORIFN,OREASON,ORNP) ; Flag an order
"RTN","ORWDXA",146,0)
 N ORB,ORVP,DA,ORPS
"RTN","ORWDXA",147,0)
 D BULLETIN
"RTN","ORWDXA",148,0)
 S DA=$P(ORIFN,";",2),ORVP=+$P(^OR(100,+ORIFN,0),U,2)
"RTN","ORWDXA",149,0)
 K ^OR(100,+ORIFN,8,DA,3) S ^(3)="1^"_$G(XMZ)_U_+$E($$NOW^XLFDT,1,12)_U_DUZ_U_OREASON_$S($G(ORNP):"^^^^"_+ORNP,1:"")
"RTN","ORWDXA",150,0)
 D KILL^XM,MSG^ORCFLAG(ORIFN)
"RTN","ORWDXA",151,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT ; Last Activity
"RTN","ORWDXA",152,0)
 I +$G(ORNP)<1 S ORNP=+$P($G(^OR(100,+ORIFN,8,DA,0)),U,3)
"RTN","ORWDXA",153,0)
 S ORB=+ORVP_U_+ORIFN_U_ORNP_"^1" D EN^OCXOERR(ORB) ; notification
"RTN","ORWDXA",154,0)
 D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDXA",155,0)
 Q
"RTN","ORWDXA",156,0)
BULLETIN ; Send flagged order bulletin (USED BY FLAG)
"RTN","ORWDXA",157,0)
 N OR0,OR3,ORDTXT,XMB,XMY,XMDUZ,ORENT,BULL,ORSRV,ORUSR
"RTN","ORWDXA",158,0)
 S OR0=$G(^OR(100,+ORIFN,0)),OR3=$G(^(3))
"RTN","ORWDXA",159,0)
 ;CLA - 3/21/96:
"RTN","ORWDXA",160,0)
 S ORUSR=+$P(OR0,U,4)
"RTN","ORWDXA",161,0)
 S ORSRV=$G(^VA(200,ORUSR,5)) I +ORSRV>0 S ORSRV=$P(ORSRV,U)
"RTN","ORWDXA",162,0)
 S ORENT="USR.`"_ORUSR_"^SRV.`"_$G(ORSRV)_"^DIV^SYS^PKG"
"RTN","ORWDXA",163,0)
 S BULL=$$GET^XPAR(ORENT,"ORB FLAGGED ORDERS BULLETIN",1,"Q")
"RTN","ORWDXA",164,0)
 Q:$G(BULL)'="Y"   ;quit if parameter value is not 'Y'es
"RTN","ORWDXA",165,0)
 ;
"RTN","ORWDXA",166,0)
 S XMB="OR FLAGGED ORDER",XMDUZ=DUZ,XMY(+$P(OR0,U,4))=""
"RTN","ORWDXA",167,0)
 S XMB(1)=$P(^DPT(+$P(OR0,U,2),0),U),XMB(2)=$P(^(0),U,9),XMB(3)="" ;sb AGE
"RTN","ORWDXA",168,0)
 S XMB(4)=$$FMTE^XLFDT($P(OR0,U,7))
"RTN","ORWDXA",169,0)
 D TEXT^ORQ12(.ORDTXT,+ORIFN,80)
"RTN","ORWDXA",170,0)
 S XMB(5)=$G(ORDTXT(1)),XMB(6)=$G(ORDTXT(2)),XMB(7)=$G(ORDTXT(3))
"RTN","ORWDXA",171,0)
 S XMB(8)=$$FMTE^XLFDT($P(OR0,U,8)),XMB(9)=$$FMTE^XLFDT($P(OR0,U,9)),XMB(10)=OREASON
"RTN","ORWDXA",172,0)
 S XMB(11)=$P($G(^ORD(100.01,+$P(OR3,U,3),0)),U)
"RTN","ORWDXA",173,0)
 D EN^XMB
"RTN","ORWDXA",174,0)
 Q
"RTN","ORWDXA",175,0)
UNFLAG(REC,ORIFN,OREASON) ; Unflag an order
"RTN","ORWDXA",176,0)
 N DA,ORB,ORNP,ORVP,ORPS
"RTN","ORWDXA",177,0)
 S DA=$P(ORIFN,";",2),ORVP=+$P(^OR(100,+ORIFN,0),U,2)
"RTN","ORWDXA",178,0)
 S $P(^OR(100,+ORIFN,8,DA,3),U)=0,$P(^(3),U,6,8)=+$E($$NOW^XLFDT,1,12)_U_DUZ_U_OREASON D MSG^ORCFLAG(ORIFN)
"RTN","ORWDXA",179,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT  ; Last Activity
"RTN","ORWDXA",180,0)
 S ORNP=+$P($G(^OR(100,+ORIFN,8,DA,0)),U,3)
"RTN","ORWDXA",181,0)
 S ORB=+ORVP_U_+ORIFN_U_ORNP_"^0" D EN^OCXOERR(ORB) ; notification
"RTN","ORWDXA",182,0)
 D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDXA",183,0)
 Q
"RTN","ORWDXA",184,0)
FLAGTXT(LST,ORID) ; Return flag reason
"RTN","ORWDXA",185,0)
 N FLAG
"RTN","ORWDXA",186,0)
 S FLAG=$G(^OR(100,+ORID,8,$P(ORID,";",2),3))
"RTN","ORWDXA",187,0)
 S LST(1)="FLAGGED: "_$$FMTE^XLFDT($P(FLAG,U,3))_" by "_$P($G(^VA(200,+$P(FLAG,U,4),0)),U)
"RTN","ORWDXA",188,0)
 S LST(2)=$P(FLAG,U,5) ; reason
"RTN","ORWDXA",189,0)
 Q
"RTN","ORWDXA",190,0)
WCGET(LST,ORID) ; Return ward comments
"RTN","ORWDXA",191,0)
 N I,ORIFN,ACT S ORIFN=+ORID,ACT=+$P(ORID,";",2)
"RTN","ORWDXA",192,0)
 S I=0 F  S I=$O(^OR(100,ORIFN,8,ACT,5,I)) Q:'I  S LST(I)=$G(^(I,0))
"RTN","ORWDXA",193,0)
 Q
"RTN","ORWDXA",194,0)
WCPUT(ERR,ORID,WCLST) ; Set ward comments for order
"RTN","ORWDXA",195,0)
 N DIERR,ERRLST,ORIFN,ACT S ORIFN=+ORID,ACT=+$P(ORID,";",2)
"RTN","ORWDXA",196,0)
 D WP^DIE(100.008,ACT_","_ORIFN_",",50,"","WCLST","ERRLST")
"RTN","ORWDXA",197,0)
 S ERR="" I $D(DIERR) S ERR="An error occurred while saving comments."
"RTN","ORWDXA",198,0)
 Q
"RTN","ORWDXA",199,0)
OFCPLX(ORY,ORID,PRTORDER) ;Check if ORID is an child of the PRTORDER
"RTN","ORWDXA",200,0)
 N NUMCHDS,NOWID,NOWVAL,X3,ORDA,ISNOW
"RTN","ORWDXA",201,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","ORWDXA",202,0)
 S ISNOW=0
"RTN","ORWDXA",203,0)
 D ISNOW^ORWDXR(.ISNOW,+ORID)
"RTN","ORWDXA",204,0)
 Q:ISNOW
"RTN","ORWDXA",205,0)
 N PKG
"RTN","ORWDXA",206,0)
 S PKG=$P($G(^OR(100,+ORID,0)),U,14)
"RTN","ORWDXA",207,0)
 S PKG=$$NMSP^ORCD(PKG)
"RTN","ORWDXA",208,0)
 I PKG'="PS" Q
"RTN","ORWDXA",209,0)
 I $L($G(^OR(100,+ORID,3))),('$L($P(^(3),U,9))) Q
"RTN","ORWDXA",210,0)
 S (NUMCHDS,NOWID,NOWVAL,X3,ORDA)=0
"RTN","ORWDXA",211,0)
 S PRTORDER=+$P(^(3),U,9)
"RTN","ORWDXA",212,0)
 S X3=$G(^OR(100,PRTORDER,3)),ORDA=$P(X3,U,7)
"RTN","ORWDXA",213,0)
 S PRTORDER=PRTORDER_";"_ORDA
"RTN","ORWDXA",214,0)
 S NUMCHDS=$P($G(^OR(100,+PRTORDER,2,0)),U,4)
"RTN","ORWDXA",215,0)
 I NUMCHDS>2 S ORY="COMPLEX-PSI"_U_PRTORDER
"RTN","ORWDXA",216,0)
 S:$D(^OR(100,+PRTORDER,4.5,"ID","NOW")) NOWID=$O(^("NOW",0))
"RTN","ORWDXA",217,0)
 S:NOWID NOWVAL=$G(^OR(100,+PRTORDER,4.5,NOWID,1))
"RTN","ORWDXA",218,0)
 I NOWVAL=1 Q
"RTN","ORWDXA",219,0)
 E  S ORY="COMPLEX-PSI"_U_PRTORDER
"RTN","ORWDXA",220,0)
 Q
"RTN","ORWDXA",221,0)
ISACTOI(ORY,OI) ;If it's an active orderable item
"RTN","ORWDXA",222,0)
 I $G(^ORD(101.43,+OI,.1)),^(.1)'>$$NOW^XLFDT D
"RTN","ORWDXA",223,0)
 . S ORY=$P($G(^ORD(101.43,OI,0)),U)_" has been inactivated and may not be ordered anymore."
"RTN","ORWDXA",224,0)
 Q
"RTN","ORWDXC")
0^29^B22991536
"RTN","ORWDXC",1,0)
ORWDXC ; SLC/KCM - Utilities for Order Checking
"RTN","ORWDXC",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,141,221,243**;Dec 17, 1997;Build 242
"RTN","ORWDXC",3,0)
 ;
"RTN","ORWDXC",4,0)
ON(VAL) ; returns E if order checking enabled, otherwise D
"RTN","ORWDXC",5,0)
 S VAL=$$GET^XPAR("DIV^SYS^PKG","ORK SYSTEM ENABLE/DISABLE")
"RTN","ORWDXC",6,0)
 Q
"RTN","ORWDXC",7,0)
FILLID(VAL,DLG) ; Return the FillerID (namespace) for a dialog
"RTN","ORWDXC",8,0)
 N DGRP
"RTN","ORWDXC",9,0)
 S VAL="",DGRP=$P($G(^ORD(101.41,DLG,0)),U,5) Q:'DGRP
"RTN","ORWDXC",10,0)
 S DLG=$$DEFDLG^ORWDXQ(DGRP)
"RTN","ORWDXC",11,0)
 S VAL=$P($G(^ORD(101.41,DLG,0)),U,7),VAL=$$NMSP^ORCD(VAL)
"RTN","ORWDXC",12,0)
 I VAL="PS" D
"RTN","ORWDXC",13,0)
 . N X
"RTN","ORWDXC",14,0)
 . S X=$P($P($G(^ORD(100.98,DGRP,0)),U,3)," ")
"RTN","ORWDXC",15,0)
 . I $L(X) S VAL="PS"_$S(X="UD":"I",1:X)
"RTN","ORWDXC",16,0)
 Q
"RTN","ORWDXC",17,0)
DISPLAY(LST,DFN,FID) ; Return list of Order Checks for a FillerID (namespace)
"RTN","ORWDXC",18,0)
 N I,ORX,ORY
"RTN","ORWDXC",19,0)
 S ORX=1,ORX(1)="|"_FID
"RTN","ORWDXC",20,0)
 D EN^ORKCHK(.ORY,DFN,.ORX,"DISPLAY")
"RTN","ORWDXC",21,0)
 S I=0 F  S I=$O(ORY(I)) Q:I'>0  S LST(I)=$P(ORY(I),U,4)
"RTN","ORWDXC",22,0)
 Q
"RTN","ORWDXC",23,0)
ACCEPT(LST,DFN,FID,STRT,ORL,OIL,ORIFN)    ; Return list of Order Checks on Accept Order
"RTN","ORWDXC",24,0)
 ; OIL(n)=OIptr^PS|PSIV|LR^PkgInfo
"RTN","ORWDXC",25,0)
 N X,Y,USID,ORCHECK,ORI,ORX,ORY
"RTN","ORWDXC",26,0)
 ; convert relative start date to real start date
"RTN","ORWDXC",27,0)
 S ORL=ORL_";SC(",X=STRT,STRT=""
"RTN","ORWDXC",28,0)
 D:X="AM" AM^ORCSAVE2 D:X="NEXT" NEXT^ORCSAVE2
"RTN","ORWDXC",29,0)
 I $L(X) S %DT="FTX" D ^%DT S:Y'>0 Y="" S STRT=Y
"RTN","ORWDXC",30,0)
 ; do the SELECT order checks
"RTN","ORWDXC",31,0)
 S ORI=0 F  S ORI=$O(OIL(ORI)) Q:'ORI  D
"RTN","ORWDXC",32,0)
 . S USID=$$USID(OIL(ORI))
"RTN","ORWDXC",33,0)
 . S OIL(ORI,"USID")=USID
"RTN","ORWDXC",34,0)
 . S ORX=1,ORX(1)=+OIL(ORI)_"|"_FID_"|"_USID
"RTN","ORWDXC",35,0)
 . D EN^ORKCHK(.ORY,DFN,.ORX,"SELECT")
"RTN","ORWDXC",36,0)
 . I $D(ORY) D RETURN^ORCHECK ; expects ORY, ORCHECK
"RTN","ORWDXC",37,0)
 . K ORX,ORY
"RTN","ORWDXC",38,0)
 ; do the ACCEPT order checks
"RTN","ORWDXC",39,0)
 S (ORI,ORX)=0 F  S ORI=$O(OIL(ORI)) Q:'ORI  D
"RTN","ORWDXC",40,0)
 . S ORX=ORX+1
"RTN","ORWDXC",41,0)
 . S ORX(ORX)=+OIL(ORI)_"|"_FID_"|"_OIL(ORI,"USID")_"|"_STRT
"RTN","ORWDXC",42,0)
 . I $P(OIL(ORI),U,2)="LR" S $P(ORX(ORX),"|",6)=$P(OIL(ORI),U,3)
"RTN","ORWDXC",43,0)
 D EN^ORKCHK(.ORY,DFN,.ORX,"ACCEPT")
"RTN","ORWDXC",44,0)
 I $D(ORY) D RETURN^ORCHECK   ; expects ORY, ORCHECK
"RTN","ORWDXC",45,0)
 ; return ORCHECK as 1 dimensional list
"RTN","ORWDXC",46,0)
 D CHK2LST
"RTN","ORWDXC",47,0)
 Q
"RTN","ORWDXC",48,0)
DELAY(LST,DFN,FID,STRT,ORL,OIL) ; Return list of Order Checks on Accept Delayed
"RTN","ORWDXC",49,0)
 ; OIL(n)=OIptr^PS|PSIV|LR^PkgInfo
"RTN","ORWDXC",50,0)
 N X,Y,ORCHECK,ORI,ORX,ORY
"RTN","ORWDXC",51,0)
 ; convert relative start date to real start date
"RTN","ORWDXC",52,0)
 S ORL=ORL_";SC(",X=STRT,STRT=""
"RTN","ORWDXC",53,0)
 D:X="AM" AM^ORCSAVE2 D:X="NEXT" NEXT^ORCSAVE2
"RTN","ORWDXC",54,0)
 I $L(X) S %DT="FTX" D ^%DT S:Y'>0 Y="" S STRT=Y
"RTN","ORWDXC",55,0)
 ; do the ACCEPT order checks
"RTN","ORWDXC",56,0)
 S (ORI,ORX)=0 F  S ORI=$O(OIL(ORI)) Q:'ORI  D
"RTN","ORWDXC",57,0)
 . S ORX=ORX+1
"RTN","ORWDXC",58,0)
 . S ORX(ORX)=+OIL(ORI)_"|"_FID_"|"_$$USID(OIL(ORI))_"|"_STRT
"RTN","ORWDXC",59,0)
 . I $P(OIL(ORI),U,2)="LR" S $P(ORX(ORX),"|",6)=$P(OIL(ORI),U,3)
"RTN","ORWDXC",60,0)
 D EN^ORKCHK(.ORY,DFN,.ORX,"ALL")
"RTN","ORWDXC",61,0)
 I $D(ORY) D RETURN^ORCHECK   ; expects ORY, ORCHECK
"RTN","ORWDXC",62,0)
 ; return ORCHECK as 1 dimensional list
"RTN","ORWDXC",63,0)
 D CHK2LST
"RTN","ORWDXC",64,0)
 Q
"RTN","ORWDXC",65,0)
SESSION(LST,ORVP,ORLST)  ; Return list of Order Checks on Release Order
"RTN","ORWDXC",66,0)
 N ORES,ORCHECK
"RTN","ORWDXC",67,0)
 S ORVP=+ORVP_";DPT("
"RTN","ORWDXC",68,0)
 S I=0 F  S I=$O(ORLST(I)) Q:'I  D
"RTN","ORWDXC",69,0)
 . I +$P(ORLST(I),";",2)'=1 Q  ; order not new
"RTN","ORWDXC",70,0)
 . I $P(ORLST(I),U,3)="0" Q    ; order not being released
"RTN","ORWDXC",71,0)
 . S ORES($P(ORLST(I),U))=""
"RTN","ORWDXC",72,0)
 D SESSION^ORCHECK
"RTN","ORWDXC",73,0)
 D CHK2LST
"RTN","ORWDXC",74,0)
 Q
"RTN","ORWDXC",75,0)
SAVECHK(OK,ORVP,RSN,LST)    ; Save order checks for session
"RTN","ORWDXC",76,0)
 N ORCHECK,ORIFN S OK=1
"RTN","ORWDXC",77,0)
 D LST2CHK
"RTN","ORWDXC",78,0)
 I $L(RSN)>0 S ORCHECK("OK")=RSN
"RTN","ORWDXC",79,0)
 S ORIFN=0 F  S ORIFN=$O(ORCHECK(ORIFN)) Q:'ORIFN  D OC^ORCSAVE2
"RTN","ORWDXC",80,0)
 Q
"RTN","ORWDXC",81,0)
DELORD(OK,ORIFN)      ; Delete order
"RTN","ORWDXC",82,0)
 N STS,DIK,DA
"RTN","ORWDXC",83,0)
 S STS=$P(^OR(100,+ORIFN,8,1,0),U,15),OK=0
"RTN","ORWDXC",84,0)
 I (STS=10)!(STS=11) D  Q  ; makes sure it's an unreleased order
"RTN","ORWDXC",85,0)
 . S DA=+ORIFN,DIK="^OR(100," Q:'DA
"RTN","ORWDXC",86,0)
 . D ^DIK
"RTN","ORWDXC",87,0)
 . S OK=1
"RTN","ORWDXC",88,0)
 Q
"RTN","ORWDXC",89,0)
USID(ORITMX) ; Return universal svc ID for an orderable item
"RTN","ORWDXC",90,0)
 ; ORITMX = OI^NMSP^PKGINFO
"RTN","ORWDXC",91,0)
 N RSLT,ORDRUG S RSLT=""
"RTN","ORWDXC",92,0)
 I $E($P(ORITMX,U,2),1,2)="PS" D
"RTN","ORWDXC",93,0)
 . I $P(ORITMX,U,2)="PSIV" D
"RTN","ORWDXC",94,0)
 . . N PSOI,TYPE,VOL S VOL=""
"RTN","ORWDXC",95,0)
 . . S PSOI=+$P($G(^ORD(101.43,+ORITMX,0)),U,2)
"RTN","ORWDXC",96,0)
 . . S TYPE=$P($P(ORITMX,U,3),";")
"RTN","ORWDXC",97,0)
 . . I TYPE="B" S VOL=$P($P(ORITMX,U,3),";",2)
"RTN","ORWDXC",98,0)
 . . D ENDDIV^PSJORUTL(PSOI,TYPE,VOL,.ORDRUG)
"RTN","ORWDXC",99,0)
 . . S ORDRUG=+ORDRUG
"RTN","ORWDXC",100,0)
 . E  S ORDRUG=+$P(ORITMX,U,3)
"RTN","ORWDXC",101,0)
 . S RSLT=$$ENDCM^PSJORUTL(ORDRUG)
"RTN","ORWDXC",102,0)
 . S RSLT=$P(RSLT,U,3)_"^^99NDF^"_ORDRUG_U_$$NAME50^ORPEAPI(ORDRUG)_"^99PSD"
"RTN","ORWDXC",103,0)
 E  S RSLT=$$USID^ORMBLD(+ORITMX)
"RTN","ORWDXC",104,0)
 I +$P(RSLT,U)=0,+($P(RSLT,U,4)=0) S RSLT="" ; has to be null (why?) 
"RTN","ORWDXC",105,0)
 Q RSLT
"RTN","ORWDXC",106,0)
 ;
"RTN","ORWDXC",107,0)
CHK2LST ; creates list that can be passed to broker from ORCHECK array
"RTN","ORWDXC",108,0)
 ; expects ORCHECK to be present and populates LST
"RTN","ORWDXC",109,0)
 N ORIFN,ORID,CDL,I,ILST S ILST=1  ;Start array at 1 always leaving room for RDI msg at top
"RTN","ORWDXC",110,0)
 S ORIFN="" F  S ORIFN=$O(ORCHECK(ORIFN)) Q:ORIFN=""  D
"RTN","ORWDXC",111,0)
 . S CDL=0 F  S CDL=$O(ORCHECK(ORIFN,CDL)) Q:'CDL  D
"RTN","ORWDXC",112,0)
 . . S I=0 F  S I=$O(ORCHECK(ORIFN,CDL,I)) Q:'I  D
"RTN","ORWDXC",113,0)
 . . . S ORID=ORIFN I +ORID,(+ORID=ORID) S ORID=ORID_";1"
"RTN","ORWDXC",114,0)
 . . . I '$P(ORCHECK(ORIFN,CDL,I),U,2) Q  ; CDL="" means don't show
"RTN","ORWDXC",115,0)
 . . . I $P(ORCHECK(ORIFN,CDL,I),U,1)=99 S LST(1)=ORID_U_ORCHECK(ORIFN,CDL,I) Q  ;Put RDI warning at the top
"RTN","ORWDXC",116,0)
 . . . S ILST=ILST+1,LST(ILST)=ORID_U_ORCHECK(ORIFN,CDL,I)
"RTN","ORWDXC",117,0)
 Q
"RTN","ORWDXC",118,0)
LST2CHK ; create ORCHECK array from list passed by broker
"RTN","ORWDXC",119,0)
 N ORIFN,CDL,I,ILST S I=0
"RTN","ORWDXC",120,0)
 S ILST=0 F  S ILST=$O(LST(ILST)) Q:'ILST  D
"RTN","ORWDXC",121,0)
 . S X=LST(ILST)
"RTN","ORWDXC",122,0)
 . S ORIFN=$P(X,U),CDL=$P(X,U,3)
"RTN","ORWDXC",123,0)
 . I +$G(ORIFN)>0,+$G(CDL)>0 D  ;cla 12/16/03
"RTN","ORWDXC",124,0)
 . . S I=I+1,ORCHECK(+ORIFN,CDL,I)=$P(X,U,2,4)
"RTN","ORWDXC",125,0)
 Q
"RTN","ORWDXM1")
0^168^B76690189
"RTN","ORWDXM1",1,0)
ORWDXM1 ; SLC/KCM - Order Dialogs, Menus;2/19/03 ;5/27/2008
"RTN","ORWDXM1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,131,132,141,178,185,187,215,243**;Dec 17, 1997;Build 242
"RTN","ORWDXM1",3,0)
BLDQRSP(LST,ORIT,FLDS,ISIMO,ENCLOC) ; Build responses for an order
"RTN","ORWDXM1",4,0)
 ; LST=QuickLevel^ResponseID(ORIT;$H)^Dialog^Type^FormID^DGrp
"RTN","ORWDXM1",5,0)
 ; LST(n)=verify text or reject text
"RTN","ORWDXM1",6,0)
 ; ORIT= ptr to 101.41 for quick order, 100 for copy
"RTN","ORWDXM1",7,0)
 ;       1   2    3    4   5   6    7    8        11-20
"RTN","ORWDXM1",8,0)
 ; FLDS=DFN^LOC^ORNP^INPT^SEX^AGE^EVENT^SC%^^^Key Variables...
"RTN","ORWDXM1",9,0)
 ; ORIT=+ORIT: ptr to 101.41, $E(ORIT)=C: copy $E(ORIT)=X: change
"RTN","ORWDXM1",10,0)
 ; !! SHOULD CHECK for PRE-CPRS ORDERS (treat as text?)
"RTN","ORWDXM1",11,0)
 K ^TMP("ORWDXMQ",$J)
"RTN","ORWDXM1",12,0)
 N ORWMODE ; 0:Dialog,Quick 1:copy order 2:change order
"RTN","ORWDXM1",13,0)
 N TEMPCAT ; patient category from DPT file
"RTN","ORWDXM1",14,0)
 N ISXFER ; Transfer order?
"RTN","ORWDXM1",15,0)
 N ORIMO ;If IMO(inpatient medication on outpatient)
"RTN","ORWDXM1",16,0)
 N TEMPORIT
"RTN","ORWDXM1",17,0)
 N ADMLOC,PATLOC,ORDLOC,LEVEL,DELAY,SCHLOC,SCHTYP
"RTN","ORWDXM1",18,0)
 S PATLOC=$P(FLDS,U,2)
"RTN","ORWDXM1",19,0)
 S ORDLOC=$S(ORIT["C":+$P($G(^OR(100,+$P(ORIT,"C",2),0)),U,10),1:0)
"RTN","ORWDXM1",20,0)
 S ORIMO=$G(ISIMO)
"RTN","ORWDXM1",21,0)
 S ORWMODE=0,ISXFER=""
"RTN","ORWDXM1",22,0)
 S:$E(ORIT)="C" ORWMODE=1 S:$E(ORIT)="T" ORWMODE=1,ISXFER=";T" ;treat xfer as copy for now
"RTN","ORWDXM1",23,0)
 S:$E(ORIT)="X" ORWMODE=2
"RTN","ORWDXM1",24,0)
 S TEMPORIT=ORIT
"RTN","ORWDXM1",25,0)
 I ORWMODE S ORIT=$E(ORIT,2,999)
"RTN","ORWDXM1",26,0)
 S LST(0)=""
"RTN","ORWDXM1",27,0)
 D CHKDSBL^ORWDXM3(.LST,ORIT,ORWMODE) Q:+LST(0)=8  ;disable
"RTN","ORWDXM1",28,0)
 D CHKVACT^ORWDXM3(.LST,ORIT,ORWMODE,$P(FLDS,U,3)) Q:+LST(0)=8  ;action
"RTN","ORWDXM1",29,0)
 I ORWMODE=1 D CHKCOPY^ORWDXM3(.LST,ORIT,FLDS) Q:+LST(0)=8  ;no copy
"RTN","ORWDXM1",30,0)
 I ORWMODE=2 D BLD4CHG^ORWDXM3(.LST,ORIT,FLDS) Q  ;change
"RTN","ORWDXM1",31,0)
 I 'ORWMODE,($P(^ORD(101.41,+ORIT,0),U,4)="D"),'($O(^DIC(9.4,"C","OR",0))[$P(^ORD(101.41,+ORIT,0),U,7)) S LST(0)="0^0^"_$$DLGINFO^ORWDXM3(ORIT,ORWMODE_ISXFER) Q
"RTN","ORWDXM1",32,0)
 ;radilogy vars
"RTN","ORWDXM1",33,0)
 N ORIMTYPE
"RTN","ORWDXM1",34,0)
 ;blood bank vars
"RTN","ORWDXM1",35,0)
 N ORCOMP,ORTAS
"RTN","ORWDXM1",36,0)
 ;lab vars
"RTN","ORWDXM1",37,0)
 N LRFZX,LRFSAMP,LRFSPEC,LRFDATE,LRFURG,LRFSCH
"RTN","ORWDXM1",38,0)
 N ORTIME,ORCOLLCT,ORMAX,ORTEST,ORIMTIME,ORSMAX,ORSTMS,ORSCH
"RTN","ORWDXM1",39,0)
 ;pharmacy vars
"RTN","ORWDXM1",40,0)
 N PSJNOPC,ORMORE,ORINPT,ORXNP,ORSCHED,ORQTY,ORNOUNS,ORXNP,OREFILLS
"RTN","ORWDXM1",41,0)
 N ORCOMPLX,ORQTY,ORCOPAY,ORDRUG,ORWPSPIK,ORWPSWRG,ORSD,ORDSUP,ORWP94
"RTN","ORWDXM1",42,0)
 ;dietetics vars
"RTN","ORWDXM1",43,0)
 N ORPARAM,ORNPO,ORTIME,ORMEAL,ORTRAY,ORDATE
"RTN","ORWDXM1",44,0)
 ;consults vars
"RTN","ORWDXM1",45,0)
 N GMRCNOPD,GMRCNOAT,GMRCREAF
"RTN","ORWDXM1",46,0)
 ; setup general env
"RTN","ORWDXM1",47,0)
 N ORTYPE,ORVP,ORL,ORNP,ORSEX,ORAGE,ORWARD,OREVENT,ORDIV,ORSC,KEYVAR
"RTN","ORWDXM1",48,0)
 N ORDG,ORDIALOG,ORCAT,FIRST,ORQUIT,X,ORTRAIL,ORLEAD,RSPREF,AUTOACK
"RTN","ORWDXM1",49,0)
 N OREVNTYP
"RTN","ORWDXM1",50,0)
 S ORWP94=$O(^ORD(101.41,"AB","PS MEDS",0))>0
"RTN","ORWDXM1",51,0)
 S ORVP=$P(FLDS,U,1)_";DPT(",ORNP=+$P(FLDS,U,3),ORSC=$P(FLDS,U,8)
"RTN","ORWDXM1",52,0)
 S ORL=$P(FLDS,U,2)_";SC(",ORL(2)=ORL
"RTN","ORWDXM1",53,0)
 S ORSEX=$P(FLDS,U,5),ORAGE=$P(FLDS,U,6),ORTYPE="Q",FIRST=1
"RTN","ORWDXM1",54,0)
 I $P(FLDS,U,4),$G(^SC(+ORL,42)) S ORWARD=+^SC(+ORL,42)
"RTN","ORWDXM1",55,0)
 I $L($P(FLDS,U,7))  D
"RTN","ORWDXM1",56,0)
 . S OREVENT=$P(FLDS,U,7)
"RTN","ORWDXM1",57,0)
 . S OREVNTYP=$P(OREVENT,";",2)
"RTN","ORWDXM1",58,0)
 . S OREVENT("TS")=$P(OREVENT,";",3)
"RTN","ORWDXM1",59,0)
 . S OREVENT("EFFECTIVE")=$P(OREVENT,";",4)
"RTN","ORWDXM1",60,0)
 . S OREVENT=+$P(OREVENT,";",1)
"RTN","ORWDXM1",61,0)
 I 'ORWMODE D
"RTN","ORWDXM1",62,0)
 . D SETKEYV^ORWDXM3($P(FLDS,U,11,20)) ; from menu path
"RTN","ORWDXM1",63,0)
 . S KEYVAR=$$KEYVAR^ORWDXM3(ORIT) ; from entry action
"RTN","ORWDXM1",64,0)
 . D SETKEYV^ORWDXM3(KEYVAR)
"RTN","ORWDXM1",65,0)
 K ^TMP("ORWORD",$J)
"RTN","ORWDXM1",66,0)
 ; init return record based on auto-accept
"RTN","ORWDXM1",67,0)
 I ORWMODE S LST(0)="2^"_ORIT ;verify on copy 
"RTN","ORWDXM1",68,0)
 E  S LST(0)=+$P($G(^ORD(101.41,ORIT,5)),U,8)_U_ORIT
"RTN","ORWDXM1",69,0)
 S TEMPCAT=$S($L($P($G(^DPT(+ORVP,.1)),U)):"I",1:"O")
"RTN","ORWDXM1",70,0)
 I TEMPCAT="I",+$P(FLDS,U,4)=1,$E(TEMPORIT)="C",$P($G(^ORD(100.98,$P($G(^OR(100,+ORIT,0)),U,11),0)),U)="OUTPATIENT MEDICATIONS" S TEMPCAT="O"
"RTN","ORWDXM1",71,0)
 I $L($G(OREVNTYP)) D
"RTN","ORWDXM1",72,0)
 . S ORCAT=$S(OREVNTYP="A":"I",OREVNTYP="T":"I",OREVNTYP="O":TEMPCAT,OREVNTYP="M":TEMPCAT,OREVNTYP="C":TEMPCAT,1:"O") I $G(OREVENT) D
"RTN","ORWDXM1",73,0)
 .. N X S X=$$EVT^OREVNTX(OREVENT),X=$P($G(^ORD(100.5,+X,0)),U,7)
"RTN","ORWDXM1",74,0)
 .. I OREVNTYP="T",X,X<4 S ORCAT="O" ;To pass=outpt
"RTN","ORWDXM1",75,0)
 .. I OREVNTYP="D",X=41 S ORCAT="I" ;From ASIH=inpt
"RTN","ORWDXM1",76,0)
 E  S ORCAT=TEMPCAT
"RTN","ORWDXM1",77,0)
 D SETUP^ORWDXM4 Q:+LST(0)=8
"RTN","ORWDXM1",78,0)
 S X="OR GTX START DATE"_$S($G(ORWP94):"/TIME",1:"")
"RTN","ORWDXM1",79,0)
 I ORWMODE,(ORDG=+$O(^ORD(100.98,"B","O RX",0))) D  ;remove old values
"RTN","ORWDXM1",80,0)
 . K ORDIALOG($$PTR^ORCD(X),1)
"RTN","ORWDXM1",81,0)
 . I ORWMODE=2,$$DRAFT^ORWDX2(ORIT) Q  ;keep comments
"RTN","ORWDXM1",82,0)
 . K:ISXFER'["T" ORDIALOG($$PTR^ORCD("OR GTX WORD PROCESSING 1"),1)
"RTN","ORWDXM1",83,0)
 D SETUPS^ORWDXM4 ;moved to save space, expects X
"RTN","ORWDXM1",84,0)
 Q:+LST(0)=8
"RTN","ORWDXM1",85,0)
 I $G(ORQUIT) S LST(0)="0^0^"_$$DLGINFO^ORWDXM3(ORIT,ORWMODE_ISXFER)_"^"_$G(KEYVAR) Q
"RTN","ORWDXM1",86,0)
 N SEQ,DA,XCODE,MUSTASK,PROMPT,INST,KEY,IVFID
"RTN","ORWDXM1",87,0)
 S IVFID=$O(^ORD(101.41,"B","PSJI OR PAT FLUID OE",0))
"RTN","ORWDXM1",88,0)
 S AUTOACK=$S($D(ORWPSWRG):0,1:1)
"RTN","ORWDXM1",89,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ)) Q:'SEQ  D
"RTN","ORWDXM1",90,0)
 . S DA=0 F  S DA=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ,DA)) Q:'DA  D
"RTN","ORWDXM1",91,0)
 . . ; skip if this is a child prompt
"RTN","ORWDXM1",92,0)
 . . I $P(^ORD(101.41,+ORDIALOG,10,DA,0),U,11) Q
"RTN","ORWDXM1",93,0)
 . . ; set default for prompt, see if needs to be interactive
"RTN","ORWDXM1",94,0)
 . . S PROMPT=$P(^ORD(101.41,+ORDIALOG,10,DA,0),U,2)
"RTN","ORWDXM1",95,0)
 . . D SETITEM(DA,PROMPT,1,.MUSTASK)
"RTN","ORWDXM1",96,0)
 . . I MUSTASK S AUTOACK=0 Q
"RTN","ORWDXM1",97,0)
 . . ; iterate through the child items if parent and edit only
"RTN","ORWDXM1",98,0)
 . . Q:'$D(^ORD(101.41,+ORDIALOG,10,"DAD",PROMPT))
"RTN","ORWDXM1",99,0)
 . . N CSEQ,CDA,CPROMPT,INST,ORQUIT
"RTN","ORWDXM1",100,0)
 . . S CSEQ=0 F  S CSEQ=$O(^ORD(101.41,+ORDIALOG,10,"DAD",PROMPT,CSEQ)) Q:'CSEQ  D  Q:$G(ORQUIT)
"RTN","ORWDXM1",101,0)
 . . . S CDA=$O(^ORD(101.41,+ORDIALOG,10,"DAD",PROMPT,CSEQ,0))
"RTN","ORWDXM1",102,0)
 . . . S CPROMPT=$P(^ORD(101.41,+ORDIALOG,10,CDA,0),U,2)
"RTN","ORWDXM1",103,0)
 . . . ; if req & no instances then need interaction
"RTN","ORWDXM1",104,0)
 . . . I $P(^ORD(101.41,+ORDIALOG,10,CDA,0),U,6),ORDIALOG'=IVFID,'$O(ORDIALOG(CPROMPT,0)) S AUTOACK=0
"RTN","ORWDXM1",105,0)
 . . . S INST=0 F  S INST=$O(ORDIALOG(CPROMPT,INST)) Q:'INST  D
"RTN","ORWDXM1",106,0)
 . . . . N ORASK D VBASK^ORWDXM4(INST) ; set ORASK for VBECS
"RTN","ORWDXM1",107,0)
 . . . . ; set default for each child prompt, if necessary
"RTN","ORWDXM1",108,0)
 . . . . D SETITEM(CDA,CPROMPT,INST,.MUSTASK)
"RTN","ORWDXM1",109,0)
 . . . . ; if no val & child prmpt required then need interaction
"RTN","ORWDXM1",110,0)
 . . . . I MUSTASK,$P(^ORD(101.41,+ORDIALOG,10,CDA,0),U,6) S AUTOACK=0
"RTN","ORWDXM1",111,0)
 N IVDLG
"RTN","ORWDXM1",112,0)
 S IVDLG=$O(^ORD(101.41,"AB","PSJI OR PAT FLUID OE",0))
"RTN","ORWDXM1",113,0)
 I $$ISMED(ORIT),(ORDIALOG'=IVDLG),(ORCAT="I") D
"RTN","ORWDXM1",114,0)
 . F P="PATIENT INSTRUCTIONS","START DATE/TIME","DAYS SUPPLY","QUANTITY","REFILLS","ROUTING","SERVICE CONNECTED" K ORDIALOG($$PTR(P),1)
"RTN","ORWDXM1",115,0)
 S KEY=$S(ORWMODE:"C",1:"")_ORIT_"-"_$P($H,",",2),SEQ=0
"RTN","ORWDXM1",116,0)
 I $$ISINPMED(ORIT) D
"RTN","ORWDXM1",117,0)
 .S LEVEL=$P(LST(0),U),DELAY=$S($P($G(OREVENT),";")>0:1,1:0)
"RTN","ORWDXM1",118,0)
 .I LEVEL=2!(ISIMO) D ADMTIME^ORWDXM2(ORDLOC,PATLOC,ENCLOC,DELAY,ISIMO)
"RTN","ORWDXM1",119,0)
 I ($$ISMED(ORIT)),'($$VALQO^ORWDXM3(ORIT)) S AUTOACK=0
"RTN","ORWDXM1",120,0)
 S PROMPT=0 F  S PROMPT=$O(ORDIALOG(PROMPT)) Q:'PROMPT  D
"RTN","ORWDXM1",121,0)
 . I '$D(^ORD(101.41,ORDIALOG,10,"D",PROMPT)) K ORDIALOG(PROMPT) Q 
"RTN","ORWDXM1",122,0)
 . S INST=0 F  S INST=$O(ORDIALOG(PROMPT,INST)) Q:'INST  D
"RTN","ORWDXM1",123,0)
 . . S SEQ=SEQ+1,^TMP("ORWDXMQ",$J,KEY,SEQ,0)=U_PROMPT_U_INST
"RTN","ORWDXM1",124,0)
 . . ; save word processing value
"RTN","ORWDXM1",125,0)
 . . I $E(ORDIALOG(PROMPT,0))="W",$L(ORDIALOG(PROMPT,INST)) D
"RTN","ORWDXM1",126,0)
 . . .  M ^TMP("ORWDXMQ",$J,KEY,SEQ,2)=@ORDIALOG(PROMPT,INST)
"RTN","ORWDXM1",127,0)
 . . ; save other value types
"RTN","ORWDXM1",128,0)
 . . E  S ^TMP("ORWDXMQ",$J,KEY,SEQ,1)=ORDIALOG(PROMPT,INST)
"RTN","ORWDXM1",129,0)
 I AUTOACK D
"RTN","ORWDXM1",130,0)
 . I ORWMODE S AUTOACK=2
"RTN","ORWDXM1",131,0)
 . I 'ORWMODE,($P(^ORD(101.41,ORIT,0),U,8)!'LST(0)) S AUTOACK=2
"RTN","ORWDXM1",132,0)
 ;I ($$ISMED(ORIT)),'($$VALQO^ORWDXM3(ORIT)) S AUTOACK=0
"RTN","ORWDXM1",133,0)
 I ORIMO,ORWMODE S AUTOACK=2
"RTN","ORWDXM1",134,0)
 ; added to accept Herbal/OTC/NonVA Med quick orders
"RTN","ORWDXM1",135,0)
 I $L($G(^ORD(101.41,+ORIT,0))),($P(^ORD(100.98,$P(^ORD(101.41,+ORIT,0),U,5),0),U,3)="NV RX"),($P($G(^ORD(101.41,+ORIT,5)),U,8)) S AUTOACK=1
"RTN","ORWDXM1",136,0)
 ;I $G(^OR(100,+ORIT,0)),$P($G(^ORD(101.41,+$P(^OR(100,+ORIT,0),U,5),0)),U,8),$D(ORDIALOG("B","HERBAL/OTC/NON VA MEDICATION")) S AUTOACK=1
"RTN","ORWDXM1",137,0)
 I AUTOACK=2,$$ISMED(ORIT),(ORDIALOG=IVDLG),$$VERORD^ORWDXM3=0 S AUTOACK=0
"RTN","ORWDXM1",138,0)
 I AUTOACK=2 D VERTXT^ORWDXM2
"RTN","ORWDXM1",139,0)
 S LST(0)=AUTOACK_U_KEY_U_$$DLGINFO^ORWDXM3(ORIT,ORWMODE_ISXFER)_"^"_$G(KEYVAR)
"RTN","ORWDXM1",140,0)
 I $P(LST(0),U,4)="D" S $P(LST(0),U,4)="Q"
"RTN","ORWDXM1",141,0)
 I ORWMODE=1 S $P(LST(0),U,4)="C"
"RTN","ORWDXM1",142,0)
 K ^TMP("ORWORD",$J)
"RTN","ORWDXM1",143,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J)
"RTN","ORWDXM1",144,0)
 Q
"RTN","ORWDXM1",145,0)
SETITEM(DA,PROMPT,INST,MUSTASK) ; set default value & return if must prompt
"RTN","ORWDXM1",146,0)
 N EDITONLY,Y,VALIV,XCODE
"RTN","ORWDXM1",147,0)
 S MUSTASK=0,EDITONLY=0,VALIV=0
"RTN","ORWDXM1",148,0)
 I $D(^TMP("ORWDHTM",$J,ORDIALOG,PROMPT)) D
"RTN","ORWDXM1",149,0)
 . I $E(ORDIALOG(PROMPT,0))="W" D
"RTN","ORWDXM1",150,0)
 . . S ^TMP("ORWORD",$J,PROMPT,INST,1,0)=^TMP("ORWDHTM",$J,ORDIALOG,PROMPT)
"RTN","ORWDXM1",151,0)
 . . S ORDIALOG(PROMPT,INST)="^TMP(""ORWORD"","_$J_","_PROMPT_","_INST_")"
"RTN","ORWDXM1",152,0)
 . E  S ORDIALOG(PROMPT,INST)=^TMP("ORWDHTM",$J,ORDIALOG,PROMPT)
"RTN","ORWDXM1",153,0)
 I $D(^TMP("ORWDHTM",$J,ORIT,PROMPT)) D
"RTN","ORWDXM1",154,0)
 . S ORDIALOG(PROMPT,INST)=^TMP("ORWDHTM",$J,ORIT,PROMPT)
"RTN","ORWDXM1",155,0)
 . ; NEED TO CLEAN UP ^TMP("ORWDHTM") after process order set!!!
"RTN","ORWDXM1",156,0)
 ;
"RTN","ORWDXM1",157,0)
 ; skip if a value already exists for this prompt and not WP
"RTN","ORWDXM1",158,0)
 Q:$D(ORDIALOG(PROMPT,INST))&($E(ORDIALOG(PROMPT,0))'="W")
"RTN","ORWDXM1",159,0)
 ; execute default action if no value in QO, checking EDITONLY afterwards
"RTN","ORWDXM1",160,0)
 I '$D(ORDIALOG(PROMPT,INST)) D
"RTN","ORWDXM1",161,0)
 . ;
"RTN","ORWDXM1",162,0)
 . ;Intermittent IV orders do not require a solution or an infusion rate
"RTN","ORWDXM1",163,0)
 . I PROMPT=$$PTR("INFUSION RATE"),$$GETIVTYP^ORWDXM3="I" S VALIV=1 Q
"RTN","ORWDXM1",164,0)
 . I PROMPT=$$PTR("ORDERABLE ITEM"),$$GETIVTYP^ORWDXM3="I" S VALIV=1 Q
"RTN","ORWDXM1",165,0)
 . I $E(ORDIALOG(PROMPT,0))="W",$D(^ORD(101.41,+ORDIALOG,10,DA,8))>9 D
"RTN","ORWDXM1",166,0)
 . . M ^TMP("ORWORD",$J,PROMPT,INST)=^ORD(101.41,+ORDIALOG,10,DA,8)
"RTN","ORWDXM1",167,0)
 . . S ORDIALOG(PROMPT,INST)="^TMP(""ORWORD"","_$J_","_PROMPT_","_INST_")"
"RTN","ORWDXM1",168,0)
 . E  D
"RTN","ORWDXM1",169,0)
 . . S XCODE=$$SUBCODE($G(^ORD(101.41,+ORDIALOG,10,DA,7)))
"RTN","ORWDXM1",170,0)
 . . I $L(XCODE) X XCODE S:$D(Y) ORDIALOG(PROMPT,INST)=Y
"RTN","ORWDXM1",171,0)
 Q:VALIV=1
"RTN","ORWDXM1",172,0)
 Q:$G(EDITONLY)
"RTN","ORWDXM1",173,0)
 I 'ORWMODE,$P($G(^ORD(101.41,+ORDIALOG,10,DA,0)),U,8) Q
"RTN","ORWDXM1",174,0)
 I ORWMODE,($P($G(^ORD(101.41,+ORDIALOG,10,DA,0)),U,9)'["W"),'$P($G(^ORD(101.41,+ORDIALOG,10,DA,0)),U,6)!$D(ORDIALOG(PROMPT,INST)) Q
"RTN","ORWDXM1",175,0)
 I 'ORWMODE,LST(0),$D(ORDIALOG(PROMPT,INST)),($E(ORDIALOG(PROMPT,0))="W") Q
"RTN","ORWDXM1",176,0)
 I 'ORWMODE,LST(0),'$P($G(^ORD(101.41,+ORDIALOG,10,DA,0)),U,6) Q
"RTN","ORWDXM1",177,0)
 S XCODE=$$SUBCODE($G(^ORD(101.41,+ORDIALOG,10,DA,3)))
"RTN","ORWDXM1",178,0)
 I $L(XCODE) X XCODE Q:'$T
"RTN","ORWDXM1",179,0)
 S MUSTASK=1
"RTN","ORWDXM1",180,0)
 Q
"RTN","ORWDXM1",181,0)
SUBCODE(X) ; substitute code
"RTN","ORWDXM1",182,0)
 I X["$$REQDCOMM^ORCDLR" Q "I $$LRRQCM^ORWDXM2"
"RTN","ORWDXM1",183,0)
 I X["$$ASKSAMP^ORCDLR" Q "I $$LRASMP^ORWDXM2"
"RTN","ORWDXM1",184,0)
 I X["$$SCHEDULD^ORCDRA1" Q "I $$SCHEDULD^ORWDXM2"
"RTN","ORWDXM1",185,0)
 I X["(^PSX(550,""C"")" Q "S Y=$E($$DEFPICK^ORWDPS32) K:'$L(Y) Y"
"RTN","ORWDXM1",186,0)
 I X["I $$ASKURG^ORCDVBEC" Q "I 1"
"RTN","ORWDXM1",187,0)
 I X["K:$G(ORASK)" Q "I $G(ORASK)"
"RTN","ORWDXM1",188,0)
 Q X
"RTN","ORWDXM1",189,0)
PTR(NAME) ; -- Returns pointer to OR GTX NAME
"RTN","ORWDXM1",190,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_NAME,1,63),0))
"RTN","ORWDXM1",191,0)
 ;
"RTN","ORWDXM1",192,0)
ISINPMED(IFN) ;
"RTN","ORWDXM1",193,0)
 N PKG,RESULT,Y
"RTN","ORWDXM1",194,0)
 I 'ORWMODE S PKG=$P($G(^ORD(101.41,IFN,0)),U,7)
"RTN","ORWDXM1",195,0)
 E  S PKG=$P($G(^OR(100,+IFN,0)),U,14)
"RTN","ORWDXM1",196,0)
 S Y=$$GET1^DIQ(9.4,+PKG_",",1)
"RTN","ORWDXM1",197,0)
 S RESULT=$S($E(Y,1,3)="PSJ":1,1:0)
"RTN","ORWDXM1",198,0)
 Q RESULT
"RTN","ORWDXM1",199,0)
 ;
"RTN","ORWDXM1",200,0)
ISMED(IFN) ; return 1 if pharmacy order dlg used
"RTN","ORWDXM1",201,0)
 N PKG
"RTN","ORWDXM1",202,0)
 I 'ORWMODE S PKG=$P($G(^ORD(101.41,IFN,0)),U,7)
"RTN","ORWDXM1",203,0)
 E  S PKG=$P($G(^OR(100,+IFN,0)),U,14)
"RTN","ORWDXM1",204,0)
 Q $$NMSP^ORCD(PKG)="PS"
"RTN","ORWDXM1",205,0)
SITEVAL() ;return 1 if site does want the reason for study to carry through from past orders of this ordering session
"RTN","ORWDXM1",206,0)
 I $$GET^XPAR("ALL","OR RA RFS CARRY ON")=0 Q 0
"RTN","ORWDXM1",207,0)
 Q 1
"RTN","ORWDXM1",208,0)
SVRPC(RET,X) ;RPC FOR SITEVAL
"RTN","ORWDXM1",209,0)
 S RET=$$SITEVAL
"RTN","ORWDXM1",210,0)
 Q
"RTN","ORWDXM2")
0^142^B75208802
"RTN","ORWDXM2",1,0)
ORWDXM2 ; SLC/KCM - Quick Orders ;04/25/2007
"RTN","ORWDXM2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,109,116,132,158,187,195,215,243**;Dec 17, 1997;Build 242
"RTN","ORWDXM2",3,0)
 ;
"RTN","ORWDXM2",4,0)
ADMTIME(ORDLOC,PATLOC,ENCLOC,DELAY,ISIMO) ;
"RTN","ORWDXM2",5,0)
 N ADMLOC,INST,SCHLOC,SCHTYPE
"RTN","ORWDXM2",6,0)
 S ADMLOC=+$P($G(ORDIALOG("B","ADMINISTRATION TIMES")),U,2)
"RTN","ORWDXM2",7,0)
 I ADMLOC>0,ORDLOC>0,PATLOC'=ORDLOC D  Q
"RTN","ORWDXM2",8,0)
 .S INST=0 F  S INST=$O(ORDIALOG(ADMLOC,INST)) Q:+INST'>0  D
"RTN","ORWDXM2",9,0)
 ..S ORDIALOG(ADMLOC,INST)=""
"RTN","ORWDXM2",10,0)
 I ADMLOC>0,$S(ENCLOC'=PATLOC:1,ISIMO:1,DELAY:1,1:0) D  Q
"RTN","ORWDXM2",11,0)
 .S INST=0 F  S INST=$O(ORDIALOG(ADMLOC,INST)) Q:+INST'>0  D
"RTN","ORWDXM2",12,0)
 ..S ORDIALOG(ADMLOC,INST)=""
"RTN","ORWDXM2",13,0)
 S SCHLOC=+$P($G(ORDIALOG("B","SCHEDULE TYPE")),U,2) Q:SCHLOC'>0
"RTN","ORWDXM2",14,0)
 S INST=0 F  S INST=$O(ORDIALOG(SCHLOC,INST)) Q:+INST'>0  D
"RTN","ORWDXM2",15,0)
 .S SCHTYP=$G(ORDIALOG(SCHLOC,INST)) Q:SCHTYP=""
"RTN","ORWDXM2",16,0)
 .I $S(SCHTYP="P":1,SCHTYP="O":1,SCHTYP="OC":1,1:0),ADMLOC>0 S ORDIALOG(ADMLOC,INST)=""
"RTN","ORWDXM2",17,0)
 Q
"RTN","ORWDXM2",18,0)
 ;
"RTN","ORWDXM2",19,0)
CLRRCL(OK)      ; clear ORECALL
"RTN","ORWDXM2",20,0)
 S OK=1
"RTN","ORWDXM2",21,0)
 K ^TMP("ORECALL",$J),^TMP("ORWDXMQ",$J)
"RTN","ORWDXM2",22,0)
 Q
"RTN","ORWDXM2",23,0)
VERTXT ; set verify text for order
"RTN","ORWDXM2",24,0)
 N SEQ,DA,X,PROMPT,MULT,CHILD,INST,TITLE,TEMP,ILST,SPACES
"RTN","ORWDXM2",25,0)
 N ISADMIN
"RTN","ORWDXM2",26,0)
 S ILST=0,$P(SPACES," ",31)=""
"RTN","ORWDXM2",27,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ)) Q:SEQ'>0  D
"RTN","ORWDXM2",28,0)
 . S DA=0 F  S DA=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ,DA)) Q:'DA  D
"RTN","ORWDXM2",29,0)
 . . S X0=$G(^ORD(101.41,+ORDIALOG,10,DA,0))
"RTN","ORWDXM2",30,0)
 . . S ISADMIN=$S(+OREVENT>0:0,ISIMO=1:0,$P($G(^ORD(101.41,$P(X0,U,2),0)),U)="OR GTX ADMIN TIMES":1,1:0)
"RTN","ORWDXM2",31,0)
 . . I ISADMIN=1,ORDLOC>0,ORDLOC'=PATLOC Q
"RTN","ORWDXM2",32,0)
 . . I $P(X0,U,9)["*",ISADMIN=0 Q
"RTN","ORWDXM2",33,0)
 . . S PROMPT=$P(X0,U,2),MULT=$P(X0,U,7),CHILD=$P(X0,U,11) I CHILD,ISADMIN=0 Q
"RTN","ORWDXM2",34,0)
 . . Q:'PROMPT  S INST=$O(ORDIALOG(PROMPT,0)) Q:'INST  ; no values
"RTN","ORWDXM2",35,0)
 . . S TITLE=$S($L($G(ORDIALOG(PROMPT,"TTL"))):ORDIALOG(PROMPT,"TTL"),1:ORDIALOG(PROMPT,"A"))
"RTN","ORWDXM2",36,0)
 . . I $E(ORDIALOG(PROMPT,0))="W" D
"RTN","ORWDXM2",37,0)
 . . . N IWP,WP,CNT
"RTN","ORWDXM2",38,0)
 . . . S IWP=0,CNT=0
"RTN","ORWDXM2",39,0)
 . . . F  S IWP=$O(^TMP("ORWORD",$J,PROMPT,INST,IWP)) Q:'IWP  D
"RTN","ORWDXM2",40,0)
 . . . . S CNT=CNT+1,WP(CNT)=^TMP("ORWORD",$J,PROMPT,INST,IWP,0)
"RTN","ORWDXM2",41,0)
 . . . I CNT=1 S ILST=ILST+1,LST(ILST)=$J(TITLE,30)_WP(1)
"RTN","ORWDXM2",42,0)
 . . . I CNT>1 D 
"RTN","ORWDXM2",43,0)
 . . . . S ILST=ILST+1,LST(ILST)=TITLE,IWP=0
"RTN","ORWDXM2",44,0)
 . . . . F  S IWP=$O(WP(IWP)) Q:'IWP  S ILST=ILST+1,LST(ILST)=WP(IWP)
"RTN","ORWDXM2",45,0)
 . . E  D
"RTN","ORWDXM2",46,0)
 . . . S TEMP=$$ITEM^ORCDLG(PROMPT,INST) I TEMP="" Q
"RTN","ORWDXM2",47,0)
 . . . S ILST=ILST+1,LST(ILST)=$J(TITLE,30)
"RTN","ORWDXM2",48,0)
 . . . ;S LST(ILST)=LST(ILST)_$$ITEM^ORCDLG(PROMPT,INST)
"RTN","ORWDXM2",49,0)
 . . . S LST(ILST)=LST(ILST)_TEMP
"RTN","ORWDXM2",50,0)
 . . Q:'MULT  Q:'$O(ORDIALOG(PROMPT,INST))  ; done
"RTN","ORWDXM2",51,0)
 . . F  S INST=$O(ORDIALOG(PROMPT,INST)) Q:INST'>0  S ILST=ILST+1,LST(ILST)=SPACES_$$ITEM^ORCDLG(PROMPT,INST)
"RTN","ORWDXM2",52,0)
 D DISPLAY^ORWDBA3  ;for display of Billing Aware data from orig order
"RTN","ORWDXM2",53,0)
 Q
"RTN","ORWDXM2",54,0)
RA ; setup environment for radiology
"RTN","ORWDXM2",55,0)
 ; -- get imaging types based on display group of quick order and
"RTN","ORWDXM2",56,0)
 ;    setup list of imaging locations based on imaging type
"RTN","ORWDXM2",57,0)
 N ORY,ITYPE,IFN,CNT,ORIMLOC,PROMPT
"RTN","ORWDXM2",58,0)
 S ORDIV=$$DIV^ORCDRA1,ITYPE=$P($G(^ORD(100.98,+ORDG,0)),U,3)
"RTN","ORWDXM2",59,0)
 S ORIMTYPE=$O(^RA(79.2,"C",ITYPE,0))
"RTN","ORWDXM2",60,0)
 D EN4^RAO7PC1(ITYPE,"ORY")
"RTN","ORWDXM2",61,0)
 S (IFN,CNT)=0 F  S IFN=$O(ORY(IFN)) Q:IFN'>0  D
"RTN","ORWDXM2",62,0)
 . S CNT=CNT+1,ORIMLOC(CNT)=ORY(IFN),ORIMLOC("B",$P(ORY(IFN),U,2))=IFN
"RTN","ORWDXM2",63,0)
 I '$$GET^XPAR("ALL","RA SUBMIT PROMPT",1,"Q"),CNT>1 K ORIMLOC
"RTN","ORWDXM2",64,0)
 E  S ORIMLOC=CNT_"^1"
"RTN","ORWDXM2",65,0)
 S PROMPT=$O(^ORD(101.41,"B","OR GTX IMAGING LOCATION",0))
"RTN","ORWDXM2",66,0)
 I $G(ORIMLOC) M ORDIALOG(PROMPT,"LIST")=ORIMLOC
"RTN","ORWDXM2",67,0)
 Q
"RTN","ORWDXM2",68,0)
LR ; setup environment for lab
"RTN","ORWDXM2",69,0)
 ; -- setup ORTIME, ORIMTIME & ORTEST arrays
"RTN","ORWDXM2",70,0)
 ;    setup ORMAX, ORDG, & ORCOLLCT variables
"RTN","ORWDXM2",71,0)
 N PROMPT,INST,EDITONLY
"RTN","ORWDXM2",72,0)
 D GETIMES^ORCDLR1  ; sets up ORTIME and ORIMTIME arrays
"RTN","ORWDXM2",73,0)
 S ORMAX=$$GET^XPAR("ALL^LOC.`"_+ORL,"LR MAX DAYS CONTINUOUS",1,"Q")
"RTN","ORWDXM2",74,0)
 S PROMPT=$O(^ORD(101.41,"B","OR GTX ORDERABLE ITEM",0)),INST=1
"RTN","ORWDXM2",75,0)
 D LRTEST           ; sets up ORTEST array and ORDG
"RTN","ORWDXM2",76,0)
 S PROMPT=$O(^ORD(101.41,"B","OR GTX COLLECTION TYPE",0))
"RTN","ORWDXM2",77,0)
 I $D(ORDIALOG(PROMPT,1)) S ORCOLLCT=ORDIALOG(PROMPT,1) I 1
"RTN","ORWDXM2",78,0)
 E  S EDITONLY=0,ORCOLLCT=$$COLLTYPE^ORCDLR1
"RTN","ORWDXM2",79,0)
 I ORCOLLCT="I" D
"RTN","ORWDXM2",80,0)
 . S PROMPT=$O(^ORD(101.41,"B","OR GTX START DATE/TIME",0))
"RTN","ORWDXM2",81,0)
 . D LRICTMOK
"RTN","ORWDXM2",82,0)
 S PROMPT=$O(^ORD(101.41,"B","OR GTX ADMIN SCHEDULE",0))
"RTN","ORWDXM2",83,0)
 I $D(ORDIALOG(PROMPT,1)) S ORSCH=ORDIALOG(PROMPT,1)
"RTN","ORWDXM2",84,0)
 Q
"RTN","ORWDXM2",85,0)
LRTEST ; -- Setup ORTEST() array of ordering parameters (copied from ORCDLR)
"RTN","ORWDXM2",86,0)
 N OI,TST,DG
"RTN","ORWDXM2",87,0)
 S OI=+$G(ORDIALOG(PROMPT,INST)) Q:'OI
"RTN","ORWDXM2",88,0)
 I '$D(ORTEST) S TST=+$P($G(^ORD(101.43,OI,0)),U,2) D TEST^LR7OR3(TST,.ORTEST) S ORTEST=TST
"RTN","ORWDXM2",89,0)
 S DG=$P($G(^ORD(101.43,+OI,"LR")),U,6) S:'$L(DG) DG="LAB"
"RTN","ORWDXM2",90,0)
 S DG=$O(^ORD(100.98,"B",DG,0)) S:DG ORDG=DG
"RTN","ORWDXM2",91,0)
 Q
"RTN","ORWDXM2",92,0)
LRRQCM()        ; return true if lab test has required comments
"RTN","ORWDXM2",93,0)
 I $O(^TMP("ORWORD",$J,PROMPT,INST,0)) Q 1 ; edit via WP
"RTN","ORWDXM2",94,0)
 N LRTEST,LRSAMP,LRSPEC,LRTSTN,LRTCOM,LRCCOM,DA,CNT,I,REQDCOMM,OI,TST
"RTN","ORWDXM2",95,0)
 S LRSAMP=$$VAL^ORCD("COLLECTION SAMPLE"),LRSPEC=$$VAL^ORCD("SPECIMEN")
"RTN","ORWDXM2",96,0)
 S OI=+$G(ORDIALOG(PROMPT,INST)) Q:'OI 0
"RTN","ORWDXM2",97,0)
 I '$D(ORTEST) S TST=+$P($G(^ORD(101.43,OI,0)),U,2) D TEST^LR7OR3(TST,.ORTEST) S ORTEST=TST
"RTN","ORWDXM2",98,0)
 S LRTSTN=1,LRTEST(1)=+ORTEST,DA=$O(^LAB(60,LRTEST(1),3,"B",+LRSAMP,0))
"RTN","ORWDXM2",99,0)
 S REQDCOMM=$P($G(^LAB(60,LRTEST(1),3,+DA,0)),U,6)
"RTN","ORWDXM2",100,0)
 S:'REQDCOMM REQDCOMM=+$P($G(^LAB(60,LRTEST(1),0)),U,19)
"RTN","ORWDXM2",101,0)
 Q REQDCOMM
"RTN","ORWDXM2",102,0)
LRASMP()       ; return true to ask collection sample (from ASKSAMP^ORCDLR)
"RTN","ORWDXM2",103,0)
 N DEFSAMP,SAMP0
"RTN","ORWDXM2",104,0)
 S DEFSAMP=$G(ORDIALOG(PROMPT,INST)),SAMP0=$G(^LAB(62,+DEFSAMP,0))
"RTN","ORWDXM2",105,0)
 I (ORCOLLCT="LC")!(ORCOLLCT="I"),$G(ORTEST("Lab CollSamp")) Q 0
"RTN","ORWDXM2",106,0)
 I $G(ORTEST("Unique CollSamp")),DEFSAMP Q 0 ; unique -> don't ask
"RTN","ORWDXM2",107,0)
 I 'DEFSAMP!('FIRST) Q 1 ; no default or edit -> ask
"RTN","ORWDXM2",108,0)
 I $G(ORDIALOG(PROMPT,"LIST"))="1^1" Q 0 ; only one choice
"RTN","ORWDXM2",109,0)
 Q 1
"RTN","ORWDXM2",110,0)
LRICTMOK        ;
"RTN","ORWDXM2",111,0)
 Q:'$D(ORDIALOG(PROMPT,1))
"RTN","ORWDXM2",112,0)
 N ORY
"RTN","ORWDXM2",113,0)
 D VALDT^ORWU(.ORY,ORDIALOG(PROMPT,1))
"RTN","ORWDXM2",114,0)
 I +$$VALID^LR7OV4(DUZ(2),ORY)=0 S ORDIALOG(PROMPT,1)=""
"RTN","ORWDXM2",115,0)
 Q
"RTN","ORWDXM2",116,0)
DO ; setup environment for diet order
"RTN","ORWDXM2",117,0)
 ; partially copied from EN^ORCDFH
"RTN","ORWDXM2",118,0)
 I ORCAT'="I" D  Q
"RTN","ORWDXM2",119,0)
 . S ORQUIT=1
"RTN","ORWDXM2",120,0)
 . S LST(0)="8^0"
"RTN","ORWDXM2",121,0)
 . S LST(.5)="This type of diet may be entered for inpatients only."
"RTN","ORWDXM2",122,0)
 D EN^FHWOR8(+ORVP,.ORPARAM)          ; set FH ordering parameters
"RTN","ORWDXM2",123,0)
 S:'$L($G(ORPARAM(3))) ORPARAM(3)="T" ; for now
"RTN","ORWDXM2",124,0)
 N PROMPT,OI                          ; set NPO flag if NPO diet
"RTN","ORWDXM2",125,0)
 S PROMPT=$O(^ORD(101.41,"B","OR GTX ORDERABLE ITEM",0))
"RTN","ORWDXM2",126,0)
 S OI=+$G(ORDIALOG(PROMPT,1))
"RTN","ORWDXM2",127,0)
 S ORNPO=($P($G(^ORD(101.43,OI,0)),U)="NPO")
"RTN","ORWDXM2",128,0)
 S PROMPT=$O(^ORD(101.41,"B","OR GTX START DATE/TIME",0))
"RTN","ORWDXM2",129,0)
 S X=$G(ORDIALOG(PROMPT,1)) I $L(X) D CNV^ORCDFH1 S ORDIALOG(PROMPT,1)=$G(X)
"RTN","ORWDXM2",130,0)
 Q
"RTN","ORWDXM2",131,0)
EL ; setup environment for early/late tray
"RTN","ORWDXM2",132,0)
 D EN^FHWOR8(+ORVP,.ORPARAM)          ; set FH ordering parameters
"RTN","ORWDXM2",133,0)
 S:'$L($G(ORPARAM(3))) ORPARAM(3)="T" ; for now
"RTN","ORWDXM2",134,0)
 D EN2^ORCDFH                         ; setup ORTIME array
"RTN","ORWDXM2",135,0)
 N PROMPT                             ; set ORMEAL,ORTRAY
"RTN","ORWDXM2",136,0)
 S PROMPT=$O(^ORD(101.41,"B","OR GTX MEAL",0))
"RTN","ORWDXM2",137,0)
 I $D(ORDIALOG(PROMPT,1)) S ORMEAL=ORDIALOG(PROMPT,1)
"RTN","ORWDXM2",138,0)
 S PROMPT=$O(^ORD(101.41,"B","OR GTX ORDERABLE ITEM",0))
"RTN","ORWDXM2",139,0)
 I $D(ORDIALOG(PROMPT,1)) S ORTRAY=ORDIALOG(PROMPT,1)
"RTN","ORWDXM2",140,0)
 Q
"RTN","ORWDXM2",141,0)
UD ; setup environment for unit dose med
"RTN","ORWDXM2",142,0)
 I $G(ORWP94) G PS^ORWDPS3  ; if patch 94 installed
"RTN","ORWDXM2",143,0)
 ;
"RTN","ORWDXM2",144,0)
 D AUTHMED Q:$G(ORQUIT)  ; checks authorized to write meds
"RTN","ORWDXM2",145,0)
 N PROMPT,OI
"RTN","ORWDXM2",146,0)
 S PROMPT=$O(^ORD(101.41,"B","OR GTX ORDERABLE ITEM",0))
"RTN","ORWDXM2",147,0)
 I $D(ORDIALOG(PROMPT,1)) S OI=ORDIALOG(PROMPT,1) D MEDACTV(1) Q:$G(ORQUIT)
"RTN","ORWDXM2",148,0)
 D INSTR^ORCDPS(OI)      ; sets up instructions, routes, etc.
"RTN","ORWDXM2",149,0)
 D CHOICES^ORCDPS("U")   ; gets list of dispense drugs       
"RTN","ORWDXM2",150,0)
 Q
"RTN","ORWDXM2",151,0)
IV ; setup environment for IV fluid
"RTN","ORWDXM2",152,0)
 D AUTHMED Q:$G(ORQUIT)  ; checks authorized to write meds
"RTN","ORWDXM2",153,0)
 ; sets up list of volumes if only one solution
"RTN","ORWDXM2",154,0)
 ; otherwise, let the dialog go interactive
"RTN","ORWDXM2",155,0)
 N PROMPT,INST,CNT,OI
"RTN","ORWDXM2",156,0)
 S PROMPT=$O(^ORD(101.41,"B","OR GTX ORDERABLE ITEM",0))
"RTN","ORWDXM2",157,0)
 S (CNT,INST)=0
"RTN","ORWDXM2",158,0)
 F  S INST=$O(ORDIALOG(PROMPT,INST)) Q:'INST  D  Q:$G(ORQUIT)
"RTN","ORWDXM2",159,0)
 . S CNT=CNT+1
"RTN","ORWDXM2",160,0)
 . S OI=ORDIALOG(PROMPT,INST) D MEDACTV(3) ; check active solutions
"RTN","ORWDXM2",161,0)
 I CNT=1 S INST=1 D VOLUME^ORCDPSIV
"RTN","ORWDXM2",162,0)
 S PROMPT=$O(^ORD(101.41,"B","OR GTX ADDITIVE",0))
"RTN","ORWDXM2",163,0)
 S INST=0
"RTN","ORWDXM2",164,0)
 F  S INST=$O(ORDIALOG(PROMPT,INST)) Q:'INST  D  Q:$G(ORQUIT)
"RTN","ORWDXM2",165,0)
 . S OI=ORDIALOG(PROMPT,INST) D MEDACTV(4) ; check active additives
"RTN","ORWDXM2",166,0)
 Q
"RTN","ORWDXM2",167,0)
OP ; setup environment for outpatient pharmacy
"RTN","ORWDXM2",168,0)
 I $G(ORWP94) G PS^ORWDPS3  ; if patch 94 installed
"RTN","ORWDXM2",169,0)
 ;
"RTN","ORWDXM2",170,0)
 D AUTHMED Q:$G(ORQUIT)       ; checks authorized to write meds
"RTN","ORWDXM2",171,0)
 N PROMPT,INST,CNT,OI
"RTN","ORWDXM2",172,0)
 S PROMPT=$O(^ORD(101.41,"B","OR GTX ORDERABLE ITEM",0)),OI=0
"RTN","ORWDXM2",173,0)
 I $D(ORDIALOG(PROMPT,1)) S OI=$G(ORDIALOG(PROMPT,1)) D MEDACTV(2) Q:$G(ORQUIT)
"RTN","ORWDXM2",174,0)
 D:+OI INSTR^ORCDPS(OI)           ; sets up instructions, routes, etc.
"RTN","ORWDXM2",175,0)
 D CHOICES^ORCDPS("O")        ; gets list of dispense drugs      
"RTN","ORWDXM2",176,0)
 ; get defaults for drug, refills if only one dispense drug
"RTN","ORWDXM2",177,0)
 S PROMPT=$O(^ORD(101.41,"B","OR GTX DISPENSE DRUG",0))
"RTN","ORWDXM2",178,0)
 S (CNT,INST)=0
"RTN","ORWDXM2",179,0)
 F  S INST=$O(ORDIALOG(PROMPT,INST)) Q:'INST  S CNT=CNT+1
"RTN","ORWDXM2",180,0)
 I CNT=1 D
"RTN","ORWDXM2",181,0)
 . S ORDRUG=+$G(ORDIALOG(PROMPT,1)),ORCOMPLX=0
"RTN","ORWDXM2",182,0)
 . S OREFILLS=$P($G(ORDIALOG(PROMPT,"LIST","D",ORDRUG)),U,3)
"RTN","ORWDXM2",183,0)
 . S:'$L(OREFILLS) OREFILLS=11
"RTN","ORWDXM2",184,0)
 E  S ORCOMPLX=1,OREFILLS=11  ; force interactive on complex order
"RTN","ORWDXM2",185,0)
 S ORCOPAY=1                  ; ask SC if can't determine copay
"RTN","ORWDXM2",186,0)
 I $G(ORDRUG),$L($T(ASKSC^ORCDPS)) S ORCOPAY=$$ASKSC^ORCDPS
"RTN","ORWDXM2",187,0)
 Q
"RTN","ORWDXM2",188,0)
AUTHMED ; sets ORQUIT if not authorized to write meds
"RTN","ORWDXM2",189,0)
 N NOAUTH,NAME
"RTN","ORWDXM2",190,0)
 D AUTH^ORWDPS32(.NOAUTH,ORNP)
"RTN","ORWDXM2",191,0)
 I +NOAUTH D
"RTN","ORWDXM2",192,0)
 . S ORQUIT=1
"RTN","ORWDXM2",193,0)
 . S LST(0)="8^0"
"RTN","ORWDXM2",194,0)
 . S NAME=$P($G(^VA(200,+ORNP,20)),U,2)
"RTN","ORWDXM2",195,0)
 . I '$L(NAME) S NAME=$P($G(^VA(200,+ORNP,0)),U,1)
"RTN","ORWDXM2",196,0)
 . S LST(.5)=NAME_" is not authorized to write med orders."
"RTN","ORWDXM2",197,0)
 Q
"RTN","ORWDXM2",198,0)
MEDACTV(USAGE) ; sets ORQUIT if the orderable item is not active for a med
"RTN","ORWDXM2",199,0)
 Q:'$G(OI)  S USAGE=+$G(USAGE)
"RTN","ORWDXM2",200,0)
 I $G(^ORD(101.43,OI,.1)),^(.1)'>$$NOW^XLFDT D  Q
"RTN","ORWDXM2",201,0)
 . S ORQUIT=1,LST(0)="8^0"
"RTN","ORWDXM2",202,0)
 . S LST(.5)=$P($G(^ORD(101.43,OI,0)),U)_" has been inactivated and may not be ordered anymore."
"RTN","ORWDXM2",203,0)
 I USAGE,'$P($G(^ORD(101.43,OI,"PS")),U,USAGE) D  Q
"RTN","ORWDXM2",204,0)
 . S ORQUIT=1,LST(0)="8^0"
"RTN","ORWDXM2",205,0)
 . S LST(.5)=$P($G(^ORD(101.43,OI,0)),U)_" may not be ordered as an "_$S(USAGE=1:"inpatient medication",USAGE=2:"outpatient medication",USAGE=3:"IV solution",1:"IV additive")_" anymore."
"RTN","ORWDXM2",206,0)
 Q
"RTN","ORWDXM2",207,0)
SCHEDULD() ; Is patient scheduled for PREOP (Imaging)
"RTN","ORWDXM2",208,0)
 I $G(ORDIALOG(PROMPT,1)) Q 1 ; don't ask - already have date
"RTN","ORWDXM2",209,0)
 E  Q 0
"RTN","ORWDXM2",210,0)
 Q
"RTN","ORWDXM3")
0^189^B65753115
"RTN","ORWDXM3",1,0)
ORWDXM3 ; SLC/KCM/JLI - Quick Orders ;05/27/2008
"RTN","ORWDXM3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,131,132,141,185,187,190,195,215,243**;Dec 17, 1997;Build 242
"RTN","ORWDXM3",3,0)
 ;
"RTN","ORWDXM3",4,0)
VALCOUNT(NAME,ORDIALOG) ;
"RTN","ORWDXM3",5,0)
 N COUNT,IEN,NUM
"RTN","ORWDXM3",6,0)
 S NUM=0,COUNT=0
"RTN","ORWDXM3",7,0)
 S IEN=$P($G(ORDIALOG("B",NAME)),U,2) Q:IEN'>0
"RTN","ORWDXM3",8,0)
 F  S NUM=$O(ORDIALOG(IEN,NUM)) Q:+NUM'>0  S COUNT=COUNT+1
"RTN","ORWDXM3",9,0)
 Q COUNT
"RTN","ORWDXM3",10,0)
 ;
"RTN","ORWDXM3",11,0)
ISMISSFL(ORDIALOG,IVTYPE) ;
"RTN","ORWDXM3",12,0)
 N ADDCNT,RESULT,STRCNT
"RTN","ORWDXM3",13,0)
 S RESULT=0
"RTN","ORWDXM3",14,0)
 S ADDCNT=$$VALCOUNT("ADDITIVE",.ORDIALOG)
"RTN","ORWDXM3",15,0)
 S STRCNT=$$VALCOUNT("STRENGTH",.ORDIALOG)
"RTN","ORWDXM3",16,0)
 I IVTYPE'="I",ADDCNT'=STRCNT S RESULT=1
"RTN","ORWDXM3",17,0)
 I IVTYPE="I",ADDCNT=0 S RESULT=1
"RTN","ORWDXM3",18,0)
 Q RESULT
"RTN","ORWDXM3",19,0)
 ;
"RTN","ORWDXM3",20,0)
KEYVAR(DLG)  ; Parse entry action for key variables & return in string
"RTN","ORWDXM3",21,0)
 ; RV=CollTp^Samp^Spec^CollDt^Urg^Sched^NoComm^NoDiag^NoProv^NoRsn
"RTN","ORWDXM3",22,0)
 N XCODE,RV,POS,Z
"RTN","ORWDXM3",23,0)
 S XCODE=$G(^ORD(101.41,DLG,3)),RV=""
"RTN","ORWDXM3",24,0)
 I '$L(XCODE) Q ""
"RTN","ORWDXM3",25,0)
 S POS=$F(XCODE,"LRFZX=")    I POS S $P(RV,U,1)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",26,0)
 S POS=$F(XCODE,"LRFSAMP=")  I POS S $P(RV,U,2)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",27,0)
 S POS=$F(XCODE,"LRFSPEC=")  I POS S $P(RV,U,3)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",28,0)
 S POS=$F(XCODE,"LRFDATE=")  I POS S $P(RV,U,4)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",29,0)
 S POS=$F(XCODE,"LRFURG=")   I POS S $P(RV,U,5)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",30,0)
 S POS=$F(XCODE,"LRFSCH=")   I POS S $P(RV,U,6)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",31,0)
 S POS=$F(XCODE,"PSJNOPC=")  I POS S $P(RV,U,7)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",32,0)
 S POS=$F(XCODE,"GMRCNOPD=") I POS S $P(RV,U,8)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",33,0)
 S POS=$F(XCODE,"GMRCNOAT=") I POS S $P(RV,U,9)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",34,0)
 S POS=$F(XCODE,"GMRCREAF=") I POS S $P(RV,U,10)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",35,0)
 S POS=$F(XCODE,"ORFORGET=") I POS D
"RTN","ORWDXM3",36,0)
 . ; need to change this so that it is executed in SETKEYV so
"RTN","ORWDXM3",37,0)
 . ; that it is executed each time menu is revisited
"RTN","ORWDXM3",38,0)
 . N ORFORGET S ORFORGET=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",39,0)
 . I ORFORGET K ^TMP("ORECALL",$J,+ORFORGET)
"RTN","ORWDXM3",40,0)
 . E  K ^TMP("ORECALL",$J)
"RTN","ORWDXM3",41,0)
 Q RV
"RTN","ORWDXM3",42,0)
VALUE(STR,BEG) ; Return value of "var=" (copied from ORCONVRT)
"RTN","ORWDXM3",43,0)
 N X,Y,I S X=$E(STR,BEG,999),Y=""
"RTN","ORWDXM3",44,0)
 S:$E(X)="""" X=$E(X,2,999) ; strip leading "
"RTN","ORWDXM3",45,0)
 F I=1:1:$L(X) S Z=$E(X,I) Q:(Z=",")!(Z=" ")!(Z="""")  S Y=Y_Z
"RTN","ORWDXM3",46,0)
 Q $TR(Y,U,"")
"RTN","ORWDXM3",47,0)
 ;
"RTN","ORWDXM3",48,0)
SETKEYV(X)      ; Set the key variables based on contents of X
"RTN","ORWDXM3",49,0)
 I $L($P(X,U,1))  S LRFZX=$P(X,U,1)
"RTN","ORWDXM3",50,0)
 I $L($P(X,U,2))  S LRFSAMP=$P(X,U,2)
"RTN","ORWDXM3",51,0)
 I $L($P(X,U,3))  S LRFSPEC=$P(X,U,3)
"RTN","ORWDXM3",52,0)
 I $L($P(X,U,4))  S LRFDATE=$P(X,U,4)
"RTN","ORWDXM3",53,0)
 I $L($P(X,U,5))  S LRFURG=$P(X,U,5)
"RTN","ORWDXM3",54,0)
 I $L($P(X,U,6))  S LRFSCH=$P(X,U,6)
"RTN","ORWDXM3",55,0)
 I $L($P(X,U,7))  S PSJNOPC=$P(X,U,7)
"RTN","ORWDXM3",56,0)
 I $L($P(X,U,8))  S GMRCNOPD=$P(X,U,8)
"RTN","ORWDXM3",57,0)
 I $L($P(X,U,9))  S GMRCNOAT=$P(X,U,9)
"RTN","ORWDXM3",58,0)
 I $L($P(X,U,10)) S GMRCREAF=$P(X,U,10)
"RTN","ORWDXM3",59,0)
 Q
"RTN","ORWDXM3",60,0)
DLGINFO(IEN,MODE)    ; return information about a dialog
"RTN","ORWDXM3",61,0)
 ; IEN=DlgIEN or ORIFN, MODE=0:Dlg,1:Copy,2:Change
"RTN","ORWDXM3",62,0)
 ; RESULT=DlgIEN^DlgType^FormID^DGrp
"RTN","ORWDXM3",63,0)
 ; If MODE="1;T",don't check "PS MEDS" for transfer order
"RTN","ORWDXM3",64,0)
 ; PSMDGP=1: Unit/Dose  Group
"RTN","ORWDXM3",65,0)
 ; PSMDGP=2: OutPatient Group
"RTN","ORWDXM3",66,0)
 N X0,DLGIEN,TYP,FID,DGRP,PSMDGP,ISXF
"RTN","ORWDXM3",67,0)
 S PSMDGP=0,ISXF=""
"RTN","ORWDXM3",68,0)
 S ISXF=$P(MODE,";",2)
"RTN","ORWDXM3",69,0)
 S MODE=+MODE
"RTN","ORWDXM3",70,0)
 S DLGIEN=IEN I MODE,(ISXF'="T") D
"RTN","ORWDXM3",71,0)
 . S DLGIEN=+$P($G(^OR(100,+IEN,0)),U,5)
"RTN","ORWDXM3",72,0)
 . I $P(^ORD(101.41,DLGIEN,0),U)="PS MEDS" D
"RTN","ORWDXM3",73,0)
 . . N PTCAT S PTCAT=$P($G(^OR(100,+IEN,0)),U,12)
"RTN","ORWDXM3",74,0)
 . . I PTCAT="I" S DLGIEN=$O(^ORD(101.41,"B","PSJ OR PAT OE",0)),PSMDGP=1
"RTN","ORWDXM3",75,0)
 . . I PTCAT="O" S DLGIEN=$O(^ORD(101.41,"B","PSO OERR",0)),PSMDGP=2
"RTN","ORWDXM3",76,0)
 I MODE,(ISXF="T") S DLGIEN=+$P($G(^OR(100,+IEN,0)),U,5)
"RTN","ORWDXM3",77,0)
 S X0=$G(^ORD(101.41,DLGIEN,0)),TYP=$P(X0,U,4),DGRP=$P(X0,U,5)
"RTN","ORWDXM3",78,0)
 I MODE S DGRP=+$P($G(^OR(100,+IEN,0)),U,11)
"RTN","ORWDXM3",79,0)
 ;JD NEW START 11/13/02
"RTN","ORWDXM3",80,0)
 I DLGIEN=$O(^ORD(101.41,"B","PSJ OR PAT OE",0)) S PSMDGP=1
"RTN","ORWDXM3",81,0)
 I DLGIEN=$O(^ORD(101.41,"B","PSO OERR",0)) S PSMDGP=2
"RTN","ORWDXM3",82,0)
 ;JD NEW END 11/13/02
"RTN","ORWDXM3",83,0)
 ; for copy or change, if the base dialog has changed, use it's info 
"RTN","ORWDXM3",84,0)
 I MODE,$G(ORDIALOG),(+DLGIEN'=+ORDIALOG),(PSMDGP=0) D
"RTN","ORWDXM3",85,0)
 . S DLGIEN=+ORDIALOG,DGRP=$P(^ORD(101.41,+ORDIALOG,0),U,5)
"RTN","ORWDXM3",86,0)
 D FORMID^ORWDXM(.FID,DLGIEN)
"RTN","ORWDXM3",87,0)
 Q DLGIEN_U_TYP_U_FID_U_DGRP
"RTN","ORWDXM3",88,0)
 ;
"RTN","ORWDXM3",89,0)
CHKDSBL(LST,ID,MODE)  ; return message if dialog disabled
"RTN","ORWDXM3",90,0)
 ; ID=DlgIEN or ORIFN, MODE=0:Dialog,1:Copy,2:Change
"RTN","ORWDXM3",91,0)
 ; LST=QL_REJECT + disabled message or unchanged
"RTN","ORWDXM3",92,0)
 S DLGIEN=+ID I MODE S DLGIEN=+$P($G(^OR(100,+ID,0)),U,5)
"RTN","ORWDXM3",93,0)
 S X0=$G(^ORD(101.41,DLGIEN,0)),X=$P(X0,U,3)
"RTN","ORWDXM3",94,0)
 I '$L(X),($P(X0,U,4)="Q") D  ; check default dialog
"RTN","ORWDXM3",95,0)
 . S DLGIEN=+$$DEFDLG^ORWDXQ($P(X0,U,5))
"RTN","ORWDXM3",96,0)
 . S X=$P($G(^ORD(101.41,DLGIEN,0)),U,3)
"RTN","ORWDXM3",97,0)
 I $L(X) D
"RTN","ORWDXM3",98,0)
 . I MODE D GETTXT^ORWORR(.LST,ID) S LST(.6)="",LST(.7)="Cannot "_$S(MODE=1:"Copy",1:"Change")_" -"
"RTN","ORWDXM3",99,0)
 . S LST(0)="8^0",LST(.5)="Dialog Disabled:  "_X
"RTN","ORWDXM3",100,0)
 Q
"RTN","ORWDXM3",101,0)
CHKVACT(LST,ID,MODE,ORNP)  ; return message if action not valid
"RTN","ORWDXM3",102,0)
 ; ID=DlgIEN or ORIFN, MODE=0:Dialog,1:Copy,2:Change
"RTN","ORWDXM3",103,0)
 ; LST=QL_REJECT + invalid action message or unchanged
"RTN","ORWDXM3",104,0)
 Q:'MODE  ; not an action on an order
"RTN","ORWDXM3",105,0)
 N X,ACT S ACT=$S(MODE=1:"RW",MODE=2:"XX",1:"")
"RTN","ORWDXM3",106,0)
 D VALID^ORWDXA(.X,ID,ACT,ORNP)
"RTN","ORWDXM3",107,0)
 I $L(X) D GETTXT^ORWORR(.LST,ID) D
"RTN","ORWDXM3",108,0)
 . S LST(0)="8^0",LST(.5)=X,LST(.6)="",LST(.7)="Cannot "_$S(MODE=1:"Copy",1:"Change")_" -"
"RTN","ORWDXM3",109,0)
 Q
"RTN","ORWDXM3",110,0)
CHKCOPY(LST,ID,FLDS)  ; return message if can't copy this order
"RTN","ORWDXM3",111,0)
 ; ID=ORIFN;ACT FLDS=EventType in 7th piece
"RTN","ORWDXM3",112,0)
 ; LST=QL_REJECT + cannot copy message or unchanged
"RTN","ORWDXM3",113,0)
 I "^A^D^T^"'[(U_$E($P(FLDS,U,7))_U) Q             ; not event delayed
"RTN","ORWDXM3",114,0)
 N PKG S PKG=$P($G(^OR(100,+ID,0)),U,14)
"RTN","ORWDXM3",115,0)
 S PKG=$$NMSP^ORCD(PKG) I PKG="OR"!(PKG="PS") Q    ; xfer meds, generics
"RTN","ORWDXM3",116,0)
 N ORWCAT S ORWCAT=$P($G(^OR(100,+ID,0)),U,12)
"RTN","ORWDXM3",117,0)
 I ORWCAT="I",("^A^T^"[(U_$E($P(FLDS,U,7))_U)) Q   ; admit, xfer inpt
"RTN","ORWDXM3",118,0)
 I ORWCAT="O",$E($P(FLDS,U,7))="D" Q               ; discharge outpt
"RTN","ORWDXM3",119,0)
 D GETTXT^ORWORR(.LST,ID)
"RTN","ORWDXM3",120,0)
 I ORWCAT="I" S LST(.5)="inpatient order to outpatient -"
"RTN","ORWDXM3",121,0)
 I ORWCAT="O" S LST(.5)="outpatient order to inpatient -"
"RTN","ORWDXM3",122,0)
 S:$D(LST(.5)) LST(.5)="Cannot copy the following "_LST(.5)
"RTN","ORWDXM3",123,0)
 S LST(0)="8^0",LST(.7)=""
"RTN","ORWDXM3",124,0)
 Q
"RTN","ORWDXM3",125,0)
BLD4CHG(LST,ID,FLDS)  ; build responses for an edit
"RTN","ORWDXM3",126,0)
 ; ID=ORIFN;ACT FLDS=unused right now
"RTN","ORWDXM3",127,0)
 ; LST(0)=Qlvl^RespID(XOrderID)^DlgIEN^DlgType^FormID^DGrp
"RTN","ORWDXM3",128,0)
 N OIDX,OI,CNT
"RTN","ORWDXM3",129,0)
 S (OI,OIDX,CNT)=0
"RTN","ORWDXM3",130,0)
 S:$D(^OR(100,+ID,4.5,"ID","ORDERABLE")) OIDX=$O(^OR(100,+ID,4.5,"ID","ORDERABLE",0))
"RTN","ORWDXM3",131,0)
 I $D(^OR(100,+ID,4.5,OIDX)) D
"RTN","ORWDXM3",132,0)
 . F  S CNT=$O(^OR(100,+ID,4.5,OIDX,CNT)) Q:'CNT  D
"RTN","ORWDXM3",133,0)
 . . S OI=^(CNT) D VALDOI
"RTN","ORWDXM3",134,0)
 I +LST(0)=8 S LST(.5)="You can not change this order." Q
"RTN","ORWDXM3",135,0)
 S LST(0)="0^X"_ID_U_$$DLGINFO(+ID,2)
"RTN","ORWDXM3",136,0)
 S $P(LST(0),U,4)="X"
"RTN","ORWDXM3",137,0)
 Q
"RTN","ORWDXM3",138,0)
GETIVTYP() ;
"RTN","ORWDXM3",139,0)
 N RESULT,TYPEIEN
"RTN","ORWDXM3",140,0)
 S RESULT=""
"RTN","ORWDXM3",141,0)
 S TYPEIEN=$O(^ORD(101.41,"B","OR GTX IV TYPE","")) I TYPEIEN'>0 Q RESULT
"RTN","ORWDXM3",142,0)
 S RESULT=$G(ORDIALOG(TYPEIEN,1))
"RTN","ORWDXM3",143,0)
 Q RESULT
"RTN","ORWDXM3",144,0)
 ;
"RTN","ORWDXM3",145,0)
VALDOI ; Validate the Orderable Items
"RTN","ORWDXM3",146,0)
 N ORQUIT,ORPS
"RTN","ORWDXM3",147,0)
 I $G(^ORD(101.43,OI,.1)),^(.1)'>$$NOW^XLFDT D
"RTN","ORWDXM3",148,0)
 . S ORQUIT=1
"RTN","ORWDXM3",149,0)
 . S LST(0)="8^0"
"RTN","ORWDXM3",150,0)
 I $D(ORQUIT) Q:ORQUIT
"RTN","ORWDXM3",151,0)
 S ORPS=$G(^ORD(101.43,+OI,"PS"))
"RTN","ORWDXM3",152,0)
 I $P(ORPS,U,1,4)="0^0^0^0",($P(ORPS,U,7)=0) S LST(0)="8^0"
"RTN","ORWDXM3",153,0)
 Q
"RTN","ORWDXM3",154,0)
VERORD() ;
"RTN","ORWDXM3",155,0)
 N INFUSE,INFUID,PASSIV,SUCC,TYPE
"RTN","ORWDXM3",156,0)
 S SUCC=0
"RTN","ORWDXM3",157,0)
 S TYPE=$$GETIVTYP
"RTN","ORWDXM3",158,0)
 I TYPE="" Q SUCC
"RTN","ORWDXM3",159,0)
 S PASSIV=$$IVRTECHK
"RTN","ORWDXM3",160,0)
 I PASSIV=0 Q SUCC
"RTN","ORWDXM3",161,0)
 S INFUID=$O(^ORD(101.41,"B","OR GTX INFUSION RATE",0))
"RTN","ORWDXM3",162,0)
 S INFUSE=$G(ORDIALOG(INFUID,1))
"RTN","ORWDXM3",163,0)
 S SUCC=$$VALINF(TYPE,INFUSE)
"RTN","ORWDXM3",164,0)
 Q SUCC
"RTN","ORWDXM3",165,0)
 ;
"RTN","ORWDXM3",166,0)
VALINF(TYPE,INFUSE) ;
"RTN","ORWDXM3",167,0)
 N SUCC
"RTN","ORWDXM3",168,0)
 S SUCC=0
"RTN","ORWDXM3",169,0)
 I TYPE="I" D  Q SUCC
"RTN","ORWDXM3",170,0)
 .I INFUSE["INFUSE OVER" S SUCC=1 Q
"RTN","ORWDXM3",171,0)
 .I $L(INFUSE)>4 Q
"RTN","ORWDXM3",172,0)
 Q 1
"RTN","ORWDXM3",173,0)
 ;
"RTN","ORWDXM3",174,0)
VALQO(IFN) ;Check to see if it's a good QO med
"RTN","ORWDXM3",175,0)
 ;If it's an IV QO: check if infusion rate entered
"RTN","ORWDXM3",176,0)
 ;If it's an UD QO: check if dosage entered
"RTN","ORWDXM3",177,0)
 ;regular order treated as good QO
"RTN","ORWDXM3",178,0)
 ;
"RTN","ORWDXM3",179,0)
 I $P($G(^ORD(101.41,IFN,0)),U,4)'="Q" Q 1
"RTN","ORWDXM3",180,0)
 N ODP,ODG,INFUID,INFUSE,DSAGEID,SUCC,PASSIV,TYPE
"RTN","ORWDXM3",181,0)
 S SUCC=0
"RTN","ORWDXM3",182,0)
 S ODP=+$P($G(^ORD(101.41,IFN,0)),U,7),ODG=+$P($G(^(0)),U,5)
"RTN","ORWDXM3",183,0)
 S ODP=$$GET1^DIQ(9.4,+ODP_",",1),ODG=$P($G(^ORD(100.98,ODG,0)),U,3)
"RTN","ORWDXM3",184,0)
 I ODP'["PS" Q 1
"RTN","ORWDXM3",185,0)
 ;check infusion rate for IV QO
"RTN","ORWDXM3",186,0)
 I ODG="IV RX"!(ODG="TPN") D
"RTN","ORWDXM3",187,0)
 . S INFUID=$O(^ORD(101.41,"B","OR GTX INFUSION RATE",0))
"RTN","ORWDXM3",188,0)
 . S TYPE=$$GETIVTYP
"RTN","ORWDXM3",189,0)
 . I TYPE="" Q
"RTN","ORWDXM3",190,0)
 . I $D(ORDIALOG(INFUID,1)) D
"RTN","ORWDXM3",191,0)
 . . I TYPE="I" D  Q
"RTN","ORWDXM3",192,0)
 . . . S INFUSE=$G(ORDIALOG(INFUID,1))
"RTN","ORWDXM3",193,0)
 . . . I INFUSE="" Q
"RTN","ORWDXM3",194,0)
 . . . I INFUSE["INFUSE OVER" S SUCC=1 Q
"RTN","ORWDXM3",195,0)
 . . . I $L(INFUSE)>4 Q
"RTN","ORWDXM3",196,0)
 . . . I +INFUSE>0 S INFUSE="INFUSE OVER "_INFUSE_" Minutes"
"RTN","ORWDXM3",197,0)
 . . . S ORDIALOG(INFUID,1)=INFUSE,SUCC=1
"RTN","ORWDXM3",198,0)
 . . S SUCC=1
"RTN","ORWDXM3",199,0)
 . I '$D(ORDIALOG(INFUID,1)),TYPE="I" S SUCC=1
"RTN","ORWDXM3",200,0)
 . S PASSIV=$$IVRTECHK
"RTN","ORWDXM3",201,0)
 . I SUCC=0 Q
"RTN","ORWDXM3",202,0)
 . I PASSIV=0 S SUCC=0
"RTN","ORWDXM3",203,0)
 . I SUCC=1,$$ISMISSFL(.ORDIALOG,TYPE)=1 S SUCC=0
"RTN","ORWDXM3",204,0)
 ;check dosage for UD QO
"RTN","ORWDXM3",205,0)
 I (ODP="PSJ")!(ODP="PSO"),ODG'="IV RX",ODG'="TPN" D
"RTN","ORWDXM3",206,0)
 . S DSAGEID=$O(^ORD(101.41,"B","OR GTX INSTRUCTIONS",0))
"RTN","ORWDXM3",207,0)
 . I $D(ORDIALOG(DSAGEID,1)) S SUCC=1
"RTN","ORWDXM3",208,0)
 Q SUCC
"RTN","ORWDXM3",209,0)
 ;
"RTN","ORWDXM3",210,0)
IVRTECHK() ;
"RTN","ORWDXM3",211,0)
 N RTIEN,RTVALUE,RESULT
"RTN","ORWDXM3",212,0)
 N CNT,NUM,ORDERIDS,OIIEN,OTYPE,ROUTE
"RTN","ORWDXM3",213,0)
 S CNT=0,RESULT=0
"RTN","ORWDXM3",214,0)
 S RTIEN=+$P($G(ORDIALOG("B","ROUTE")),U,2) I RTIEN'>0 Q RESULT
"RTN","ORWDXM3",215,0)
 S RTVALUE=+$G(ORDIALOG(RTIEN,1)) I RTVALUE'>0 Q RESULT
"RTN","ORWDXM3",216,0)
 F OTYPE="SOLUTION","ADDITIVE" D
"RTN","ORWDXM3",217,0)
 .S OIIEN=+$P($G(ORDIALOG("B",OTYPE)),U,2) I OIIEN>0 D
"RTN","ORWDXM3",218,0)
 ..S NUM=0 F  S NUM=$O(ORDIALOG(OIIEN,NUM)) Q:NUM'>0  I +$G(ORDIALOG(OIIEN,NUM))>0 D
"RTN","ORWDXM3",219,0)
 ...S CNT=CNT+1,ORDERIDS(CNT)=ORDIALOG(OIIEN,NUM)
"RTN","ORWDXM3",220,0)
 I $D(ORDERIDS)=0 Q
"RTN","ORWDXM3",221,0)
 S ROUTE=$$IVQOVAL^ORWDPS33(.ORDERIDS,RTVALUE)
"RTN","ORWDXM3",222,0)
 I ROUTE="" S ORDIALOG(RTIEN,1)=ROUTE
"RTN","ORWDXM3",223,0)
 I ROUTE'="" S RESULT=1
"RTN","ORWDXM3",224,0)
 ;K ^TMP($J,"ORWDXM3 IVRTECHK")
"RTN","ORWDXM3",225,0)
 ;D ALL^PSS51P2(RTVALUE,,,,"ORWDXM3 IVRTECHK")
"RTN","ORWDXM3",226,0)
 ;I +^TMP($J,"ORWDXM3 IVRTECHK",RTVALUE,6)'=1 S ORDIALOG(RTIEN,1)="",RESULT=0
"RTN","ORWDXM3",227,0)
 ;K ^TMP($J,"ORWDXM3 IVRTECHK")
"RTN","ORWDXM3",228,0)
 Q RESULT
"RTN","ORWDXM3",229,0)
 ;
"RTN","ORWDXM3",230,0)
ISUDQO(ORY,DLGID) ;True: is unit dose quick order
"RTN","ORWDXM3",231,0)
 S ORY=0
"RTN","ORWDXM3",232,0)
 Q:'$D(^ORD(101.41,DLGID,0))
"RTN","ORWDXM3",233,0)
 N CLODGRP,UDGRP1,UDGRP2,DLGTYP,DLGGRP
"RTN","ORWDXM3",234,0)
 S UDGRP1=$O(^ORD(100.98,"B","UD RX",0))
"RTN","ORWDXM3",235,0)
 S UDGRP2=$O(^ORD(100.98,"B","I RX",0))
"RTN","ORWDXM3",236,0)
 S CLODGRP=$O(^ORD(100.98,"B","CLINIC ORDERS",""))
"RTN","ORWDXM3",237,0)
 S DLGTYP=$P($G(^ORD(101.41,DLGID,0)),U,4)
"RTN","ORWDXM3",238,0)
 S DLGGRP=$P($G(^ORD(101.41,DLGID,0)),U,5)
"RTN","ORWDXM3",239,0)
 I (DLGTYP="Q"),((DLGGRP=UDGRP1)!(DLGGRP=UDGRP2)!(DLGGRP=CLODGRP)) S ORY=1
"RTN","ORWDXM3",240,0)
 Q
"RTN","ORWDXR")
0^14^B48540055
"RTN","ORWDXR",1,0)
ORWDXR ; SLC/KCM/JDL - Utilites for Order Actions ;5/30/06  14:50
"RTN","ORWDXR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,125,131,134,141,149,187,190,213,243**;Dec 17, 1997;Build 242
"RTN","ORWDXR",3,0)
 ;
"RTN","ORWDXR",4,0)
ACTDCREA(DCIEN) ; Valid DC Reason
"RTN","ORWDXR",5,0)
 N X
"RTN","ORWDXR",6,0)
 S X=$G(^ORD(100.03,DCIEN,0))
"RTN","ORWDXR",7,0)
 I $P(X,U,4) Q 0
"RTN","ORWDXR",8,0)
 I $P(X,U,5)'=+$O(^DIC(9.4,"C","OR",0)) Q 0
"RTN","ORWDXR",9,0)
 I $P(X,U,7)=+$O(^ORD(100.02,"C","A",0)) Q 0
"RTN","ORWDXR",10,0)
 Q 1
"RTN","ORWDXR",11,0)
 ;
"RTN","ORWDXR",12,0)
ISREL(VAL,ORIFN) ; Return true if an order has been released
"RTN","ORWDXR",13,0)
 N STS S STS=$P(^OR(100,+ORIFN,3),U,3)
"RTN","ORWDXR",14,0)
 S VAL=$S(STS=10:0,STS=11:0,1:1)  ; false if delayed or unreleased order
"RTN","ORWDXR",15,0)
 Q
"RTN","ORWDXR",16,0)
RENEW(REC,ORIFN,ORVP,ORNP,ORL,FLDS,CPLX,ORAPPT) ; Renew an order
"RTN","ORWDXR",17,0)
 N ORDG
"RTN","ORWDXR",18,0)
 N ORDUZ,ORSTS,OREVENT,ORCAT,ORDA,ORTS,ORNEW,ORCHECK,ORLOG,ORPKG
"RTN","ORWDXR",19,0)
 N ORDIALOG,PRMT,X0
"RTN","ORWDXR",20,0)
 N FSTDOSE,FST
"RTN","ORWDXR",21,0)
 S (FSTDOSE,FST)=0
"RTN","ORWDXR",22,0)
 I '$D(CPLX) S CPLX=0
"RTN","ORWDXR",23,0)
 I '$G(ORAPPT) S ORAPPT=""
"RTN","ORWDXR",24,0)
 S ORVP=ORVP_";DPT(",ORL(2)=ORL_";SC(",ORL=ORL(2)
"RTN","ORWDXR",25,0)
 S X0=^OR(100,+ORIFN,0)
"RTN","ORWDXR",26,0)
 S ORDG=$P(X0,U,11)
"RTN","ORWDXR",27,0)
 S ORPKG=$P(X0,U,14)
"RTN","ORWDXR",28,0)
 I $D(FLDS("ORCHECK")) M ORCHECK=FLDS("ORCHECK")
"RTN","ORWDXR",29,0)
 I $P(X0,U,5)["101.41," D                        ; version 3
"RTN","ORWDXR",30,0)
 . S ORDIALOG=+$P(X0,U,5),ORCAT=$P(^OR(100,+ORIFN,0),U,12)
"RTN","ORWDXR",31,0)
 . D GETDLG^ORCD(ORDIALOG),GETORDER^ORCD(+ORIFN)
"RTN","ORWDXR",32,0)
 . I CPLX S FSTDOSE=$P($G(ORDIALOG("B","FIRST DOSE")),U,2) S:'FSTDOSE FSTDOSE=$$PTR^ORCD("OR GTX NOW")
"RTN","ORWDXR",33,0)
 . I FSTDOSE,$G(ORDIALOG(FSTDOSE,1)) K ORDIALOG(FSTDOSE,1)
"RTN","ORWDXR",34,0)
 E  D                                            ; version 2.5 generic
"RTN","ORWDXR",35,0)
 . S ORDIALOG=$O(^ORD(101.41,"B","OR GXTEXT WORD PROCESSING ORDE",0))
"RTN","ORWDXR",36,0)
 . D GETDLG^ORCD(ORDIALOG)
"RTN","ORWDXR",37,0)
 . S PRMT=$O(^ORD(101.41,"B","OR GTX WORD PROCESSING 1",0))
"RTN","ORWDXR",38,0)
 . S ORDIALOG(PRMT,1)=$NA(^TMP("ORWORD",$J,PRMT,1))
"RTN","ORWDXR",39,0)
 . M ^TMP("ORWORD",$J,PRMT,1)=^OR(100,+ORIFN,1)
"RTN","ORWDXR",40,0)
 . S PRMT=$O(^ORD(101.41,"B","OR GTX START DATE/TIME",0))
"RTN","ORWDXR",41,0)
 . I $P(X0,U,9) S ORDIALOG(PRMT,1)=$P(X0,U,9)
"RTN","ORWDXR",42,0)
 I +FLDS(1)=999 D  ; generic order
"RTN","ORWDXR",43,0)
 . S ORDIALOG($$PTR^ORCD("OR GTX START DATE/TIME"),1)=$P(FLDS(1),U,2)
"RTN","ORWDXR",44,0)
 . S ORDIALOG($$PTR^ORCD("OR GTX STOP DATE/TIME"),1)=$P(FLDS(1),U,3)
"RTN","ORWDXR",45,0)
 I ($O(^ORD(101.41,"AB","PS MEDS",0))>0),(+FLDS(1)=130)!(+FLDS(1)=135)!(+FLDS(1)=140),'$L($G(ORDIALOG($$PTR^ORCD("OR GTX SIG"),1))) D
"RTN","ORWDXR",46,0)
 . N ORDOSE,ORDRUG,ORCAT,ORWPSOI,PROMPT,DRUG
"RTN","ORWDXR",47,0)
 . S ORCAT=$P($G(^OR(100,+ORIFN,0)),U,12)
"RTN","ORWDXR",48,0)
 . S PROMPT=$$PTR^ORCD("OR GTX INSTRUCTIONS")
"RTN","ORWDXR",49,0)
 . S ORDRUG=$G(ORDIALOG($$PTR^ORCD("OR GTX DISPENSE DRUG"),1))
"RTN","ORWDXR",50,0)
 . S ORWPSOI=+$G(ORDIALOG($$PTR^ORCD("OR GTX ORDERABLE ITEM"),1))
"RTN","ORWDXR",51,0)
 . I ORWPSOI S ORWPSOI=+$P($G(^ORD(101.43,+ORWPSOI,0)),U,2)
"RTN","ORWDXR",52,0)
 . D DOSE^PSSORUTL(.ORDOSE,ORWPSOI,$S(ORCAT="I":"U",1:"O"),ORVP)       ; dflt doses
"RTN","ORWDXR",53,0)
 . D D1^ORCDPS2  ; set up ORDOSE
"RTN","ORWDXR",54,0)
 . S DRUG=$G(ORDOSE("DD",+ORDRUG))
"RTN","ORWDXR",55,0)
 . I DRUG,ORCAT="O" D RESETID^ORCDPS
"RTN","ORWDXR",56,0)
 . D SIG^ORCDPS2
"RTN","ORWDXR",57,0)
 I +FLDS(1)=140 D  ; outpatient meds
"RTN","ORWDXR",58,0)
 . K ORDIALOG($$PTR^ORCD("OR GTX START DATE"),1) ; remove effective dt
"RTN","ORWDXR",59,0)
 . S ORDIALOG($$PTR^ORCD("OR GTX REFILLS"),1)=$P(FLDS(1),U,4)
"RTN","ORWDXR",60,0)
 . S ORDIALOG($$PTR^ORCD("OR GTX ROUTING"),1)=$P(FLDS(1),U,5)
"RTN","ORWDXR",61,0)
 . S PRMT=$$PTR^ORCD("OR GTX WORD PROCESSING 1")
"RTN","ORWDXR",62,0)
 . K ^TMP("ORWORD",$J,PRMT,1)
"RTN","ORWDXR",63,0)
 . S I=1 F  S I=$O(FLDS(I)) Q:'I  S ^TMP("ORWORD",$J,PRMT,1,I-1,0)=FLDS(I)
"RTN","ORWDXR",64,0)
 . S ^TMP("ORWORD",$J,PRMT,1,0)=U_U_(I-1)_U_(I-1)_U_DT_U
"RTN","ORWDXR",65,0)
 . S ORDIALOG(PRMT,1)=$NA(^TMP("ORWORD",$J,PRMT,1))
"RTN","ORWDXR",66,0)
 . N SIG,PI,X S SIG=$$PTR^ORCD("OR GTX SIG")
"RTN","ORWDXR",67,0)
 . S PI=$$PTR^ORCD("OR GTX PATIENT INSTRUCTIONS"),X=$$STR(PI)
"RTN","ORWDXR",68,0)
 . I $L(X),$$STR(SIG)[X S ORDIALOG(PI,"FORMAT")="@" ;PI in Sig
"RTN","ORWDXR",69,0)
 D RN^ORCSAVE
"RTN","ORWDXR",70,0)
 S REC="" S ORIFN=+ORIFN_";"_ORDA D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDXR",71,0)
 Q
"RTN","ORWDXR",72,0)
RNWFLDS(LST,ORIFN) ; Return fields for renew action
"RTN","ORWDXR",73,0)
 ; LST(0)=RenewType^Start^Stop^Refills^Pickup  LST(n)=Comments
"RTN","ORWDXR",74,0)
 N X0,DG,PKG,RNWTYPE,START,STOP,REFILLS,OROI
"RTN","ORWDXR",75,0)
 S ORIFN=+ORIFN,X0=^OR(100,ORIFN,0),DG=$P(X0,U,11),PKG=$P(X0,U,14)
"RTN","ORWDXR",76,0)
 S PKG=$E($P(^DIC(9.4,PKG,0),U,2),1,2),DG=$P(^ORD(100.98,DG,0),U,3)
"RTN","ORWDXR",77,0)
 S LST(0)=$S(PKG="OR":999,PKG="PS"&(DG="O RX"):140,PKG="PS"&(DG="UD RX"):130,PKG="PS"&(DG="NV RX"):145,1:0)
"RTN","ORWDXR",78,0)
 I +LST(0)=140 D
"RTN","ORWDXR",79,0)
 . S LST(0)=LST(0)_U_U_U_+$$VAL(ORIFN,"REFILLS")_U_$$VAL(ORIFN,"PICKUP")
"RTN","ORWDXR",80,0)
 . ;D WPVAL(.LST,ORIFN,"COMMENT")
"RTN","ORWDXR",81,0)
 I +LST(0)=999 S LST(0)=LST(0)_U_$$VAL(ORIFN,"START")_U_$$VAL(ORIFN,"STOP")
"RTN","ORWDXR",82,0)
 ; make sure start/stop times are relative times, otherwise use NOW, no Stop
"RTN","ORWDXR",83,0)
 I +$P(LST(0),U,2) S $P(LST(0),U,2)="NOW"
"RTN","ORWDXR",84,0)
 I +$P(LST(0),U,3)!($P(LST(0),U,3)="0") S $P(LST(0),U,3)=""
"RTN","ORWDXR",85,0)
 ;NEW STUFF AFTER THIS LINE OR*3*243
"RTN","ORWDXR",86,0)
 S $P(LST(0),U,9)=0
"RTN","ORWDXR",87,0)
 S OROI=$O(^OR(100,+ORIFN,4.5,"ID","ORDERABLE",0))
"RTN","ORWDXR",88,0)
 Q:'OROI
"RTN","ORWDXR",89,0)
 S OROI=$G(^OR(100,+ORIFN,4.5,OROI,1))
"RTN","ORWDXR",90,0)
 Q:'OROI
"RTN","ORWDXR",91,0)
 S $P(LST(0),U,9)=$$ISCLOZ^ORALWORD(OROI)
"RTN","ORWDXR",92,0)
 ; add to LST node specifying if patient of ORIFN passes clozapine lab tests
"RTN","ORWDXR",93,0)
 I $P(LST(0),U,9) D
"RTN","ORWDXR",94,0)
 .N ORY,ORDFN,ORTMP
"RTN","ORWDXR",95,0)
 .S ORTMP=LST(0)
"RTN","ORWDXR",96,0)
 .K LST
"RTN","ORWDXR",97,0)
 .S LST(0)=ORTMP
"RTN","ORWDXR",98,0)
 .S ORDFN=$P(^OR(100,ORIFN,0),U,2)
"RTN","ORWDXR",99,0)
 .I $P(ORDFN,";",2)'="DPT(" Q
"RTN","ORWDXR",100,0)
 .S ORDFN=+ORDFN
"RTN","ORWDXR",101,0)
 .D ALLWORD^ORALWORD(.ORY,ORDFN,ORIFN,"E")
"RTN","ORWDXR",102,0)
 .M LST(1)=ORY
"RTN","ORWDXR",103,0)
 Q
"RTN","ORWDXR",104,0)
VAL(ORIFN,ID) ; Return value for order response
"RTN","ORWDXR",105,0)
 N DA S DA=+$O(^OR(100,ORIFN,4.5,"ID",ID,0))
"RTN","ORWDXR",106,0)
 Q $G(^OR(100,ORIFN,4.5,DA,1))
"RTN","ORWDXR",107,0)
WPVAL(TXT,ORIFN,ID) ; Return word processing value
"RTN","ORWDXR",108,0)
 N DA S DA=+$O(^OR(100,ORIFN,4.5,"ID",ID,0))
"RTN","ORWDXR",109,0)
 S I=0 F  S I=$O(^OR(100,ORIFN,4.5,DA,2,I)) Q:'I  S TXT(I)=^(I,0)
"RTN","ORWDXR",110,0)
 Q
"RTN","ORWDXR",111,0)
STR(PTR) ; -- Return word processing text as long string for comparison
"RTN","ORWDXR",112,0)
 N X,Y,I,ARRY
"RTN","ORWDXR",113,0)
 S ARRY=$G(ORDIALOG(+$G(PTR),1)) Q:'$L(ARRY) ""
"RTN","ORWDXR",114,0)
 S I=+$O(@ARRY@(0)),Y=$$UP^XLFSTR($G(@ARRY@(I,0)))
"RTN","ORWDXR",115,0)
 F  S I=+$O(@ARRY@(I)) Q:'I  S X=$G(@ARRY@(I,0)),Y=Y_$$UP^XLFSTR(X)
"RTN","ORWDXR",116,0)
 S Y=$TR(Y," ") ;remove all spaces, compare only text
"RTN","ORWDXR",117,0)
 Q Y
"RTN","ORWDXR",118,0)
CHKACT(ORDERID,ORWSIG,ORWREL,ORWNATR) ; Return error if can't sign/release order
"RTN","ORWDXR",119,0)
 N ORACT,ORWERR
"RTN","ORWDXR",120,0)
 ; begin case
"RTN","ORWDXR",121,0)
 S ORACT=""
"RTN","ORWDXR",122,0)
 I (ORWSIG=1),$D(^XUSEC("ORES",DUZ)) S ORACT="ES" G XC1
"RTN","ORWDXR",123,0)
 I (ORWSIG=7),$D(^XUSEC("ORES",DUZ)) S ORACT="DS" G XC1
"RTN","ORWDXR",124,0)
 I ORWREL,(ORWNATR="W") S ORACT="OC" G XC1
"RTN","ORWDXR",125,0)
 I ORWREL S ORACT="RS" S:$P($G(^OR(100,+ORDERID,0)),U,16)<2 ORACT="ES"
"RTN","ORWDXR",126,0)
XC1 ; end case
"RTN","ORWDXR",127,0)
 S ORWERR=""
"RTN","ORWDXR",128,0)
 I $L(ORACT),$$VALID^ORCACT0(ORDERID,ORACT,.ORWERR,ORWNATR) S ORWERR=""
"RTN","ORWDXR",129,0)
 Q ORWERR
"RTN","ORWDXR",130,0)
GTORITM(Y,ORIFN) ;-- Get back the orderable item IEN
"RTN","ORWDXR",131,0)
 S ORIFN=+ORIFN
"RTN","ORWDXR",132,0)
 S Y=$$VALUE^ORCSAVE2(ORIFN,"ORDERABLE")
"RTN","ORWDXR",133,0)
 Q
"RTN","ORWDXR",134,0)
GETPKG(Y,IFN) ;Get package for an order
"RTN","ORWDXR",135,0)
 N ORDERID,PKGID
"RTN","ORWDXR",136,0)
 Q:+IFN<1
"RTN","ORWDXR",137,0)
 S ORDERID=+IFN,Y=""
"RTN","ORWDXR",138,0)
 S PKGID=$P(^OR(100,ORDERID,0),U,14)
"RTN","ORWDXR",139,0)
 S:PKGID>0 Y=$P(^DIC(9.4,PKGID,0),U,2)
"RTN","ORWDXR",140,0)
 Q
"RTN","ORWDXR",141,0)
ISCPLX(ORY,ORID) ; 1: is complex order 0: is not
"RTN","ORWDXR",142,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","ORWDXR",143,0)
 N PKG
"RTN","ORWDXR",144,0)
 S PKG=$P($G(^OR(100,+ORID,0)),U,14)
"RTN","ORWDXR",145,0)
 S PKG=$$NMSP^ORCD(PKG)
"RTN","ORWDXR",146,0)
 I PKG'="PS" Q
"RTN","ORWDXR",147,0)
 N NUMCHDS,NOWID,NOWVAL
"RTN","ORWDXR",148,0)
 S (NOWVAL,NOWID)=0
"RTN","ORWDXR",149,0)
 S NUMCHDS=$P($G(^OR(100,+ORID,2,0)),U,4)
"RTN","ORWDXR",150,0)
 I NUMCHDS>2 S ORY=1 Q
"RTN","ORWDXR",151,0)
 I NUMCHDS=2 D
"RTN","ORWDXR",152,0)
 . S ORY=1
"RTN","ORWDXR",153,0)
 . S:$D(^OR(100,+ORID,4.5,"ID","NOW")) NOWID=$O(^("NOW",0))
"RTN","ORWDXR",154,0)
 . S:NOWID NOWVAL=$G(^OR(100,+ORID,4.5,NOWID,1))
"RTN","ORWDXR",155,0)
 I NOWVAL=1 S ORY=0 Q
"RTN","ORWDXR",156,0)
 Q
"RTN","ORWDXR",157,0)
ORCPLX(ORY,ORID,ORACT) ;Return children orders of the complex order
"RTN","ORWDXR",158,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","ORWDXR",159,0)
 N PKG,LACT,OELACT,ISNOW
"RTN","ORWDXR",160,0)
 S PKG=$P($G(^OR(100,+ORID,0)),U,14)
"RTN","ORWDXR",161,0)
 S PKG=$$NMSP^ORCD(PKG)
"RTN","ORWDXR",162,0)
 I PKG'="PS" Q
"RTN","ORWDXR",163,0)
 N CHLDCNT,IDX,X3
"RTN","ORWDXR",164,0)
 S (CHLDCNT,IDX)=0
"RTN","ORWDXR",165,0)
 S:$L($G(^OR(100,+ORID,2,0))) CHLDCNT=$P(^(0),U,4)
"RTN","ORWDXR",166,0)
 I 'CHLDCNT Q
"RTN","ORWDXR",167,0)
 F  S IDX=$O(^OR(100,+ORID,2,IDX)) Q:'IDX  D
"RTN","ORWDXR",168,0)
 . S (LACT,OELACT,ISNOW)=0
"RTN","ORWDXR",169,0)
 . D ISNOW(.ISNOW,IDX)
"RTN","ORWDXR",170,0)
 . Q:ISNOW
"RTN","ORWDXR",171,0)
 . S X3=$G(^OR(100,IDX,3))
"RTN","ORWDXR",172,0)
 . S LACT=$P(X3,U,7)
"RTN","ORWDXR",173,0)
 . F  S OELACT=$O(^OR(100,IDX,8,OELACT),-1) Q:OELACT
"RTN","ORWDXR",174,0)
 . S:OELACT>LACT LACT=OELACT
"RTN","ORWDXR",175,0)
 . S ORY(IDX)=IDX_";"_LACT
"RTN","ORWDXR",176,0)
 Q
"RTN","ORWDXR",177,0)
CANRN(ORY,ORID) ; Check conjunction for renew.
"RTN","ORWDXR",178,0)
 ; All conjunctioni = "And" return 1
"RTN","ORWDXR",179,0)
 ; Has a "Then" return 0
"RTN","ORWDXR",180,0)
 Q:'$G(^OR(100,+ORID,0))
"RTN","ORWDXR",181,0)
 N PKG
"RTN","ORWDXR",182,0)
 S PKG=$P($G(^OR(100,+ORID,0)),U,14)
"RTN","ORWDXR",183,0)
 S PKG=$$NMSP^ORCD(PKG)
"RTN","ORWDXR",184,0)
 I PKG'="PS" Q
"RTN","ORWDXR",185,0)
 N INDX,INDY,CANRENEW
"RTN","ORWDXR",186,0)
 S INDX=0
"RTN","ORWDXR",187,0)
 S CANRENEW=1
"RTN","ORWDXR",188,0)
 N CHID
"RTN","ORWDXR",189,0)
 S CHID=0 F  S CHID=$O(^OR(100,+ORID,2,CHID)) Q:'CHID  D
"RTN","ORWDXR",190,0)
 . N ORSTS,ACTIVE S ORSTS=0
"RTN","ORWDXR",191,0)
 . S ORSTS=$P($G(^OR(100,CHID,3)),U,3)
"RTN","ORWDXR",192,0)
 . S ACTIVE=$O(^ORD(100.01,"B","ACTIVE",0))
"RTN","ORWDXR",193,0)
 . I ACTIVE'=ORSTS S CANRENEW=0
"RTN","ORWDXR",194,0)
 I 'CANRENEW S ORY=CANRENEW Q
"RTN","ORWDXR",195,0)
 F  S INDX=$O(^OR(100,+ORID,4.5,"ID","CONJ",INDX)) Q:'INDX  D
"RTN","ORWDXR",196,0)
 . S INDY=0 F  S INDY=$O(^OR(100,+ORID,4.5,INDX,INDY)) Q:'INDY  D
"RTN","ORWDXR",197,0)
 . . I $G(^(INDY))="T" S CANRENEW=0 Q
"RTN","ORWDXR",198,0)
 . I CANRENEW=0 Q
"RTN","ORWDXR",199,0)
 S ORY=CANRENEW
"RTN","ORWDXR",200,0)
 Q
"RTN","ORWDXR",201,0)
ISNOW(ORY,ORID) ; Is first time now order?
"RTN","ORWDXR",202,0)
 N SCH
"RTN","ORWDXR",203,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","ORWDXR",204,0)
 S SCH=""
"RTN","ORWDXR",205,0)
 S SCH=$O(^OR(100,+ORID,4.5,"ID","SCHEDULE",0))
"RTN","ORWDXR",206,0)
 S:SCH SCH=$G(^OR(100,+ORID,4.5,SCH,1))
"RTN","ORWDXR",207,0)
 S:SCH="NOW" ORY=1
"RTN","ORWDXR",208,0)
 Q
"RTN","ORWDXVB")
0^56^B43771926
"RTN","ORWDXVB",1,0)
ORWDXVB ;slc/dcm - Order dialog utilities for Blood Bank ;12/7/05  17:11
"RTN","ORWDXVB",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,243**;Dec 17 1997;Build 242
"RTN","ORWDXVB",3,0)
 ;
"RTN","ORWDXVB",4,0)
 ; DBIA 2503   RR^LR7OR1   ^TMP("LRRR",$J)
"RTN","ORWDXVB",5,0)
 ; 
"RTN","ORWDXVB",6,0)
GETPAT(ORX,DFN,ORL)     ;Get Patient data from VBECS
"RTN","ORWDXVB",7,0)
 ;Needs patient DFN and Location (ORL)
"RTN","ORWDXVB",8,0)
 N ORSTN,DIV
"RTN","ORWDXVB",9,0)
 S DIV=+$P($G(^SC(+$G(ORL),0)),U,15),ORSTN=$P($$SITE^VASITE(DT,DIV),U,3)
"RTN","ORWDXVB",10,0)
 D OEAPI^VBECA3(.ORX,DFN,ORSTN)
"RTN","ORWDXVB",11,0)
 Q
"RTN","ORWDXVB",12,0)
PTINFO(OROOT,ORX)       ;Format patient BB info
"RTN","ORWDXVB",13,0)
 Q:'$D(ORX)
"RTN","ORWDXVB",14,0)
 D PTINFO^ORWDXVB1
"RTN","ORWDXVB",15,0)
 Q
"RTN","ORWDXVB",16,0)
RESULTS(OROOT,DFN,ORX)  ;Get test results
"RTN","ORWDXVB",17,0)
 Q:'$O(ORX(0))  ;ORX contains a list of tests to retrieve results for
"RTN","ORWDXVB",18,0)
 N ORCOM,ORT,ORTST,ORTDT,ORTMP,GCNT,CCNT,GIOSL,GIOM,I,ORZ
"RTN","ORWDXVB",19,0)
 S GCNT=0,CCNT=1,GIOSL=999999,GIOM=80
"RTN","ORWDXVB",20,0)
 S OROOT=$NA(^TMP("ORVBEC",$J))
"RTN","ORWDXVB",21,0)
 K ^TMP("ORVBEC",$J)
"RTN","ORWDXVB",22,0)
 D LN
"RTN","ORWDXVB",23,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT,"RECENT LAB RESULTS:",.CCNT)
"RTN","ORWDXVB",24,0)
 D LN
"RTN","ORWDXVB",25,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT,"Test    Result    Units      Range     Collected       Accession     Sts",.CCNT)
"RTN","ORWDXVB",26,0)
 D LN
"RTN","ORWDXVB",27,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT,"----    ------    -----      -----     ---------       ---------     ---",.CCNT)
"RTN","ORWDXVB",28,0)
 S ORT=0 F  S ORT=$O(ORX(ORT)) Q:'ORT  S ORTST=$P(ORX(ORT),"^",1) D
"RTN","ORWDXVB",29,0)
 . K ^TMP("LRRR",$J) D RR^LR7OR1(DFN,,,,,ORTST,,1)  ;DBIA 2503
"RTN","ORWDXVB",30,0)
 . S ORTMP="^TMP(""LRRR"",$J,DFN)",ORTMP=$Q(@ORTMP)
"RTN","ORWDXVB",31,0)
 . Q:$P(ORTMP,",",1,3)'=("^TMP(""LRRR"","_$J_","_DFN)
"RTN","ORWDXVB",32,0)
 . S ORTDT=9999999-+$P(ORTMP,",",5),ORZ=@ORTMP
"RTN","ORWDXVB",33,0)
 . D LN
"RTN","ORWDXVB",34,0)
 . S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT,$P(ORZ,"^",15),.CCNT)_$$S^ORU4(8,CCNT,$J($P(ORZ,"^",2),7),.CCNT)_$$S^ORU4(16,CCNT,$P(ORZ,"^",3),.CCNT)_$$S^ORU4(19,CCNT,$P(ORZ,"^",4),.CCNT)_$$S^ORU4(30,CCNT,$P(ORZ,"^",5),.CCNT)
"RTN","ORWDXVB",35,0)
 . S ^(0)=^TMP("ORVBEC",$J,GCNT,0)_$$S^ORU4(40,CCNT,$$DATETIME^ORCHTAB(ORTDT),.CCNT)_$$S^ORU4(56,CCNT,$P(ORZ,"^",16),.CCNT)_$$S^ORU4(71,CCNT,$P(ORZ,"^",6),.CCNT)
"RTN","ORWDXVB",36,0)
 . S ORCOM=$P(ORTMP,",",1,5)_",""N""" ;check for comments
"RTN","ORWDXVB",37,0)
 . F  S ORTMP=$Q(@ORTMP) Q:$P(ORTMP,",",1,6)'=ORCOM  D
"RTN","ORWDXVB",38,0)
 .. D LN
"RTN","ORWDXVB",39,0)
 .. S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT,@ORTMP,.CCNT)
"RTN","ORWDXVB",40,0)
 K ^TMP("LRRR",$J)
"RTN","ORWDXVB",41,0)
 Q
"RTN","ORWDXVB",42,0)
RAW(OROOT,DFN,ORX)  ;Get RAW test results
"RTN","ORWDXVB",43,0)
 Q:'$O(ORX(0))  ;ORX contains a list of tests to retrieve results for
"RTN","ORWDXVB",44,0)
 N ORCOM,ORT,ORTST,ORTDT,ORTMP,GCNT,CCNT,GIOSL,GIOM,I
"RTN","ORWDXVB",45,0)
 S GCNT=0,CCNT=1,GIOSL=999999,GIOM=80
"RTN","ORWDXVB",46,0)
 S OROOT=$NA(^TMP("ORVBEC",$J))
"RTN","ORWDXVB",47,0)
 K ^TMP("ORVBEC",$J)
"RTN","ORWDXVB",48,0)
 S ORT=0 F  S ORT=$O(ORX(ORT)) Q:'ORT  S ORTST=$P(ORX(ORT),"^",1) D
"RTN","ORWDXVB",49,0)
 . K ^TMP("LRRR",$J) D RR^LR7OR1(DFN,,,,,ORTST,,1)
"RTN","ORWDXVB",50,0)
 . S ORTMP="^TMP(""LRRR"",$J,DFN)",ORTMP=$Q(@ORTMP)
"RTN","ORWDXVB",51,0)
 . Q:$P(ORTMP,",",1,3)'=("^TMP(""LRRR"","_$J_","_DFN)
"RTN","ORWDXVB",52,0)
 . S ORTDT=9999999-+$P(ORTMP,",",5),ORZ=@ORTMP
"RTN","ORWDXVB",53,0)
 . D LN
"RTN","ORWDXVB",54,0)
 . S ^TMP("ORVBEC",$J,GCNT,0)=$P(ORZ,"^",1,6)_"^"_ORTDT
"RTN","ORWDXVB",55,0)
 K ^TMP("LRRR",$J)
"RTN","ORWDXVB",56,0)
 Q
"RTN","ORWDXVB",57,0)
SURG(OROOT,ORX) ;Get list of surgeries
"RTN","ORWDXVB",58,0)
 N I,CNT,X
"RTN","ORWDXVB",59,0)
 S (I,CNT)=0
"RTN","ORWDXVB",60,0)
 F  S I=$O(ORX("SURGERY",I)) Q:'I  S X=$G(ORX("SURGERY",I)) D
"RTN","ORWDXVB",61,0)
 . S CNT=CNT+1,OROOT(CNT)=X_U_X
"RTN","ORWDXVB",62,0)
 Q
"RTN","ORWDXVB",63,0)
LN ;Increment counts
"RTN","ORWDXVB",64,0)
 S GCNT=GCNT+1,CCNT=1
"RTN","ORWDXVB",65,0)
 Q
"RTN","ORWDXVB",66,0)
PATINFO(OROOT,DFN,LOC)   ;Test ^TMP global output
"RTN","ORWDXVB",67,0)
 N ORX
"RTN","ORWDXVB",68,0)
 D GETPAT(.ORX,DFN,LOC)
"RTN","ORWDXVB",69,0)
 I $L($G(ORX("SPECIMEN"))) S:$P(ORX("SPECIMEN"),"^") $P(ORX("SPECIMEN"),"^")=$$HL7TFM^XLFDT($P(ORX("SPECIMEN"),"^"))
"RTN","ORWDXVB",70,0)
 D PTINFO(.OROOT,.ORX)
"RTN","ORWDXVB",71,0)
 ;S I=0 F  S I=$O(@OROOT@(I)) Q:'I  W !,^(I,0)
"RTN","ORWDXVB",72,0)
 ;K @OROOT
"RTN","ORWDXVB",73,0)
 Q
"RTN","ORWDXVB",74,0)
GETALL(OROOT,DFN,LOC) ;Get all data in one call and let the GUI divide it up
"RTN","ORWDXVB",75,0)
 N ORX,INFO,CNT,I,J,K
"RTN","ORWDXVB",76,0)
 S OROOT=$NA(^TMP("ORVBECINFO",$J)),CNT=1
"RTN","ORWDXVB",77,0)
 D GETPAT(.ORX,DFN,LOC)
"RTN","ORWDXVB",78,0)
 ;S ^TMP("ORVBECINFO",$J,CNT)="~RAWDATA",I=0
"RTN","ORWDXVB",79,0)
 ;F  S I=$O(ORX(I)) Q:'I  S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)=ORX(I)
"RTN","ORWDXVB",80,0)
 I $L($G(ORX("SPECIMEN"))) S:$P(ORX("SPECIMEN"),"^") $P(ORX("SPECIMEN"),"^")=$$HL7TFM^XLFDT($P(ORX("SPECIMEN"),"^")) S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="~SPECIMEN",CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_ORX("SPECIMEN")
"RTN","ORWDXVB",81,0)
 I $L($G(ORX("ABORH"))) S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="~ABORH",CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_ORX("ABORH")
"RTN","ORWDXVB",82,0)
 S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="~TYPE AND SCREEN",CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_$O(^ORD(101.43,"ID","1;99VBC",0))
"RTN","ORWDXVB",83,0)
 S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="~OTHER",CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_$O(^ORD(101.43,"ID","6;99VBC",0))
"RTN","ORWDXVB",84,0)
 S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="~SPECIMENS",I=0
"RTN","ORWDXVB",85,0)
 F  S I=$O(ORX(I)) Q:'I  S J="" F  S J=$O(ORX(I,J)) Q:J=""  I J="SPECIMEN" S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_I_"^"_ORX(I,J)
"RTN","ORWDXVB",86,0)
 S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="~TESTS",I=0
"RTN","ORWDXVB",87,0)
 F  S I=$O(ORX(I)) Q:'I  S J="" F  S J=$O(ORX(I,J)) Q:J=""  I J="TEST" S K=0 F  S K=$O(ORX(I,J,K)) Q:'K  S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_I_"^"_K_"^"_ORX(I,J,K)
"RTN","ORWDXVB",88,0)
 S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="~MSBOS",I=0
"RTN","ORWDXVB",89,0)
 F  S I=$O(ORX(I)) Q:'I  S J="" F  S J=$O(ORX(I,J)) Q:J=""  I J="MSBOS" S K=0 F  S K=$O(ORX(I,J,K)) Q:'K  S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_I_"^"_K_"^"_ORX(I,J,K),$P(^(CNT),"^",4)=+$P(ORX(I,J,K),"^",2)
"RTN","ORWDXVB",90,0)
 S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="~SURGERIES",I=0
"RTN","ORWDXVB",91,0)
 F  S I=$O(ORX("SURGERY",I)) Q:'I  S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_I_"^"_ORX("SURGERY",I)
"RTN","ORWDXVB",92,0)
 S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="~URGENCIES",I=""
"RTN","ORWDXVB",93,0)
 F  S I=$O(^ORD(101.42,"S.VBEC",I)) Q:I=""  S J=0 F  S J=$O(^ORD(101.42,"S.VBEC",I,J)) Q:'J  S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_J_"^"_I
"RTN","ORWDXVB",94,0)
 S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="~MODIFIERS",I=""
"RTN","ORWDXVB",95,0)
 N ORMODS D GETLST^XPAR(.ORMODS,"ALL","OR VBECS MODIFIERS","I")
"RTN","ORWDXVB",96,0)
 F  S I=$O(ORMODS(I)) Q:'I  S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_ORMODS(I)
"RTN","ORWDXVB",97,0)
 ;F I="W^Washed","I^Irradiated","L^Leuko Reduced","V^Volume Reduced","D^Divided","E^Leuko Reduced/Irradiated" S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_I
"RTN","ORWDXVB",98,0)
 S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="~REASONS",I=""
"RTN","ORWDXVB",99,0)
 N ORMODS D GETLST^XPAR(.ORMODS,"ALL","OR VBECS REASON FOR REQUEST","I")
"RTN","ORWDXVB",100,0)
 F  S I=$O(ORMODS(I)) Q:'I  S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_ORMODS(I)
"RTN","ORWDXVB",101,0)
 S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="~INFO"
"RTN","ORWDXVB",102,0)
 D PTINFO(.INFO,.ORX)
"RTN","ORWDXVB",103,0)
 S I=0 F  S I=$O(^TMP("ORVBEC",$J,I)) Q:'I  S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_^TMP("ORVBEC",$J,I,0)
"RTN","ORWDXVB",104,0)
 S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="~TNS ORDERS"
"RTN","ORWDXVB",105,0)
 N ORMODS D PULL^ORWDXVB2(.ORMODS,DFN)
"RTN","ORWDXVB",106,0)
 S I=0 F  S I=$O(ORMODS(I)) Q:'I  S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_ORMODS(I)
"RTN","ORWDXVB",107,0)
 K ^TMP("ORVBEC",$J)
"RTN","ORWDXVB",108,0)
 Q
"RTN","ORWDXVB",109,0)
STATALOW(OROOT,DFN) ;Allow stat for ORES ORELSE users
"RTN","ORWDXVB",110,0)
 S OROOT=$D(^XUSEC("ORES",DUZ))!($D(^XUSEC("ORELSE",DUZ)))
"RTN","ORWDXVB",111,0)
 Q
"RTN","ORWDXVB",112,0)
NURSADMN(OROOT) ;Suppress Nursing Adiminstration Order Prompt
"RTN","ORWDXVB",113,0)
 S OROOT=+$$GET^XPAR("DIV^SYS^PKG","OR VBECS SUPPRESS NURS ADMIN")
"RTN","ORWDXVB",114,0)
 Q
"RTN","ORWDXVB",115,0)
VBTNS(RETURN) ;RPC to get Days back to check for Type & Screen order
"RTN","ORWDXVB",116,0)
 S RETURN=$$GET^XPAR("ALL","ORWDXVB VBECS TNS CHECK",1,"I")
"RTN","ORWDXVB",117,0)
 Q
"RTN","ORWDXVB",118,0)
COMPORD(OROOT) ;Get sequence order of Blood Components
"RTN","ORWDXVB",119,0)
 N ORLIST,I,X
"RTN","ORWDXVB",120,0)
 D GETLST^XPAR(.ORLIST,"ALL","OR VBECS COMPONENT ORDER")
"RTN","ORWDXVB",121,0)
 S I=0 F  S I=$O(ORLIST(I)) Q:'I  S X=ORLIST(I) I $D(^ORD(101.43,$P(X,"^",2),0)) S OROOT(I)=$P(X,"^",2)_"^"_$P(^(0),"^",1)_"^"_$P(^(0),"^",1)
"RTN","ORWDXVB",122,0)
 Q
"RTN","ORWDXVB",123,0)
SUBCHK(OROOT,TSTNM) ;Check to see if selected test is a Blood Component or a Diagnostic Test
"RTN","ORWDXVB",124,0)
 S OROOT=""
"RTN","ORWDXVB",125,0)
 Q:'$L($G(TSTNM))
"RTN","ORWDXVB",126,0)
 I $O(^ORD(101.43,"S.VBT",TSTNM,0)) S OROOT="t"
"RTN","ORWDXVB",127,0)
 I $O(^ORD(101.43,"S.VBC",TSTNM,0)) S OROOT="c"
"RTN","ORWDXVB",128,0)
 Q
"RTN","ORWDXVB",129,0)
TESTR ;Test results call
"RTN","ORWDXVB",130,0)
 N ORX
"RTN","ORWDXVB",131,0)
 S ORX(3)="3" ;HGB
"RTN","ORWDXVB",132,0)
 S ORX(4)="4" ;HCT
"RTN","ORWDXVB",133,0)
 S ORX(1)="1" ;WBC
"RTN","ORWDXVB",134,0)
 S ORX(113)="113" ;FERRITIN
"RTN","ORWDXVB",135,0)
 D RESULTS(.OROOT,66,.ORX)
"RTN","ORWDXVB",136,0)
 S I=0 F  S I=$O(@OROOT@(I)) Q:'I  W !,^(I,0)
"RTN","ORWDXVB",137,0)
 K @OROOT
"RTN","ORWDXVB",138,0)
 Q
"RTN","ORWDXVB1")
0^174^B34643378
"RTN","ORWDXVB1",1,0)
ORWDXVB1 ;slc/dcm - Order dialog utilities for Blood Bank Cont.;3/2/04  09:31 ;12/7/05  17:20
"RTN","ORWDXVB1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,243**;Dec 17 1997;Build 242
"RTN","ORWDXVB1",3,0)
 ;
"RTN","ORWDXVB1",4,0)
PTINFO ;Format patient BB info
"RTN","ORWDXVB1",5,0)
 N GCNT,CCNT,GIOSL,GIOM,I,TYPE,ORUA,VBERROR,ABFND,LINE1,LINE2,NOABO,NOPAT,TREQFND
"RTN","ORWDXVB1",6,0)
 S (GCNT,NOPAT,NOABO)=0,CCNT=1,GIOSL=999999,GIOM=80
"RTN","ORWDXVB1",7,0)
 S OROOT=$NA(^TMP("ORVBEC",$J))
"RTN","ORWDXVB1",8,0)
 K ^TMP("ORVBEC",$J)
"RTN","ORWDXVB1",9,0)
 ;
"RTN","ORWDXVB1",10,0)
 I +$G(ORX("ERROR")) D ERROR^ORWDXVB2 Q
"RTN","ORWDXVB1",11,0)
 ; Patient Demographics
"RTN","ORWDXVB1",12,0)
 D LN
"RTN","ORWDXVB1",13,0)
 I '$D(ORX("PATIENT")) D  Q
"RTN","ORWDXVB1",14,0)
 . D LINE^ORU4("^TMP(""ORVBEC"",$J)",GIOM),LN
"RTN","ORWDXVB1",15,0)
 . S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(10,CCNT,"There is no previous record of this patient in VBECS.",.CCNT) Q
"RTN","ORWDXVB1",16,0)
 ;
"RTN","ORWDXVB1",17,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT,"Name",.CCNT)_$$S^ORU4(27,CCNT,"SSN",.CCNT)_$$S^ORU4(42,CCNT,"ABO/Rh",.CCNT)
"RTN","ORWDXVB1",18,0)
 D LN
"RTN","ORWDXVB1",19,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT,"----",.CCNT)_$$S^ORU4(27,CCNT,"---",.CCNT)_$$S^ORU4(42,CCNT,"------",.CCNT) D
"RTN","ORWDXVB1",20,0)
 . D LN
"RTN","ORWDXVB1",21,0)
 . S X=ORX("PATIENT"),^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT,$P(X,"^",3)_", "_$P(X,"^",2),.CCNT)_$$S^ORU4(27,CCNT,$P(X,"^",4),.CCNT)
"RTN","ORWDXVB1",22,0)
 . I $P(ORX("ABORH"),"^")']"" S ^TMP("ORVBEC",$J,GCNT,0)=^TMP("ORVBEC",$J,GCNT,0)_$$S^ORU4(42,CCNT,"unknown",.CCNT) Q
"RTN","ORWDXVB1",23,0)
 . S X=ORX("ABORH"),^TMP("ORVBEC",$J,GCNT,0)=^TMP("ORVBEC",$J,GCNT,0)_$$S^ORU4(42,CCNT,$$STRIP^XLFSTR($P(X,"^")," ")_" "_$S($$STRIP^XLFSTR($P(X,"^",2)," ")="P":"Pos",$$STRIP^XLFSTR($P(X,"^",2)," ")="N":"Neg",1:"unknown"),.CCNT) Q
"RTN","ORWDXVB1",24,0)
 D LINE^ORU4("^TMP(""ORVBEC"",$J)",GIOM),LN
"RTN","ORWDXVB1",25,0)
 D LINE^ORU4("^TMP(""ORVBEC"",$J)",GIOM),LN
"RTN","ORWDXVB1",26,0)
 ;
"RTN","ORWDXVB1",27,0)
 ; Available Specimens
"RTN","ORWDXVB1",28,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT,"Lab Specimen ID",.CCNT)_$$S^ORU4(27,CCNT,"Expiration Date",.CCNT)
"RTN","ORWDXVB1",29,0)
 D LN
"RTN","ORWDXVB1",30,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT,"----------------------",.CCNT)_$$S^ORU4(27,CCNT,"---------------",.CCNT) D
"RTN","ORWDXVB1",31,0)
 . I '$D(ORX("SPECIMEN")) D LN S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT," none",.CCNT) Q
"RTN","ORWDXVB1",32,0)
 . D LN
"RTN","ORWDXVB1",33,0)
 . S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,$P(ORX("SPECIMEN"),"^",2),.CCNT)_$$S^ORU4(27,CCNT,$$DATETIME^ORCHTAB($P(ORX("SPECIMEN"),"^")),.CCNT) Q
"RTN","ORWDXVB1",34,0)
 D LINE^ORU4("^TMP(""ORVBEC"",$J)",GIOM),LN
"RTN","ORWDXVB1",35,0)
 D LINE^ORU4("^TMP(""ORVBEC"",$J)",GIOM),LN
"RTN","ORWDXVB1",36,0)
 ;
"RTN","ORWDXVB1",37,0)
 ; Antibodies Identified section
"RTN","ORWDXVB1",38,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT,"Antibodies Identified",.CCNT)
"RTN","ORWDXVB1",39,0)
 D LN
"RTN","ORWDXVB1",40,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT,"---------------------",.CCNT) D
"RTN","ORWDXVB1",41,0)
 . I '$O(ORX("ABHIS",0)) D LN S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT," none",.CCNT) Q
"RTN","ORWDXVB1",42,0)
 . D LN
"RTN","ORWDXVB1",43,0)
 . S ABFND=0
"RTN","ORWDXVB1",44,0)
 . S I=0 F  S I=$O(ORX("ABHIS",I)) Q:I<1  D
"RTN","ORWDXVB1",45,0)
 . . S X=ORX("ABHIS",I)
"RTN","ORWDXVB1",46,0)
 . . I ABFND S ^TMP("ORVBEC",$J,GCNT,0)=^TMP("ORVBEC",$J,GCNT,0)_$$S^ORU4(2,CCNT,", "_$P(X,"^"),.CCNT) Q
"RTN","ORWDXVB1",47,0)
 . . S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,$P(X,"^"),.CCNT),ABFND=1
"RTN","ORWDXVB1",48,0)
 D LINE^ORU4("^TMP(""ORVBEC"",$J)",GIOM),LN
"RTN","ORWDXVB1",49,0)
 D LINE^ORU4("^TMP(""ORVBEC"",$J)",GIOM),LN
"RTN","ORWDXVB1",50,0)
 ;
"RTN","ORWDXVB1",51,0)
 ; Transfusion Requirements section
"RTN","ORWDXVB1",52,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT,"Transfusion Requirements",.CCNT)
"RTN","ORWDXVB1",53,0)
 D LN
"RTN","ORWDXVB1",54,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT,"------------------------",.CCNT) D
"RTN","ORWDXVB1",55,0)
 . I '$O(ORX("TRREQ",0)) D LN S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT," none",.CCNT) Q
"RTN","ORWDXVB1",56,0)
 . D LN
"RTN","ORWDXVB1",57,0)
 . S TREQFND=0
"RTN","ORWDXVB1",58,0)
 . S I=0 F  S I=$O(ORX("TRREQ",I)) Q:I<1  D
"RTN","ORWDXVB1",59,0)
 . . S X=ORX("TRREQ",I)
"RTN","ORWDXVB1",60,0)
 . . I TREQFND S ^TMP("ORVBEC",$J,GCNT,0)=^TMP("ORVBEC",$J,GCNT,0)_$$S^ORU4(2,CCNT,", "_X,.CCNT) Q
"RTN","ORWDXVB1",61,0)
 . . S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,X,.CCNT),TREQFND=1
"RTN","ORWDXVB1",62,0)
 D LINE^ORU4("^TMP(""ORVBEC"",$J)",GIOM),LN
"RTN","ORWDXVB1",63,0)
 D LINE^ORU4("^TMP(""ORVBEC"",$J)",GIOM),LN
"RTN","ORWDXVB1",64,0)
 ;
"RTN","ORWDXVB1",65,0)
 ; Transfusion Reactions section
"RTN","ORWDXVB1",66,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT,"Transfusion Reactions",.CCNT)_$$S^ORU4(27,CCNT,"Date/Time",.CCNT)
"RTN","ORWDXVB1",67,0)
 D LN
"RTN","ORWDXVB1",68,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT,"---------------------",.CCNT)_$$S^ORU4(27,CCNT,"---------",.CCNT) D
"RTN","ORWDXVB1",69,0)
 . I '$O(ORX("TRHX",0)) D LN S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT," none",.CCNT) Q
"RTN","ORWDXVB1",70,0)
 . S I=0 F  S I=$O(ORX("TRHX",I)) Q:I<1  D
"RTN","ORWDXVB1",71,0)
 . . D LN
"RTN","ORWDXVB1",72,0)
 . . S X=ORX("TRHX",I),^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,$P(X,"^"),.CCNT)_$$S^ORU4(27,CCNT,$$DATETIME($P(X,"^",2)),.CCNT)
"RTN","ORWDXVB1",73,0)
 D LINE^ORU4("^TMP(""ORVBEC"",$J)",GIOM),LN
"RTN","ORWDXVB1",74,0)
 D LINE^ORU4("^TMP(""ORVBEC"",$J)",GIOM),LN
"RTN","ORWDXVB1",75,0)
 ;
"RTN","ORWDXVB1",76,0)
 ; New Units section
"RTN","ORWDXVB1",77,0)
 N INDEX,UNT,ORY,I,CNT,J,K,L,M,X
"RTN","ORWDXVB1",78,0)
 S CNT=0
"RTN","ORWDXVB1",79,0)
 F INDEX="A","D","C","S" I $O(ORX("UNIT",INDEX,0)) D  ; A:Autologous D:Directed C:Crossmatched A:Assigned
"RTN","ORWDXVB1",80,0)
 . S I=0 F  S I=$O(ORX("UNIT",INDEX,I)) Q:I<1  D
"RTN","ORWDXVB1",81,0)
 .. S X=ORX("UNIT",INDEX,I),CNT=CNT+1,ORY("~"_$P(X,"^"),"~"_$P(X,"^",2),"~"_INDEX,"~"_$P(X,"^",4),CNT)=X
"RTN","ORWDXVB1",82,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT,"Units Available",.CCNT)
"RTN","ORWDXVB1",83,0)
 D LN
"RTN","ORWDXVB1",84,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT,"---------------",.CCNT)
"RTN","ORWDXVB1",85,0)
 D LN
"RTN","ORWDXVB1",86,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"Unit ID",.CCNT)_$$S^ORU4(13,CCNT,"Component",.CCNT)_$$S^ORU4(27,CCNT,"Status",.CCNT)_$$S^ORU4(42,CCNT,"Exp Date",.CCNT)_$$S^ORU4(58,CCNT,"Division",.CCNT)
"RTN","ORWDXVB1",87,0)
 D LN
"RTN","ORWDXVB1",88,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"-------",.CCNT)_$$S^ORU4(13,CCNT,"---------",.CCNT)_$$S^ORU4(27,CCNT,"------",.CCNT)_$$S^ORU4(42,CCNT,"--------",.CCNT)_$$S^ORU4(58,CCNT,"--------",.CCNT)
"RTN","ORWDXVB1",89,0)
 S I="" F  S I=$O(ORY(I)) Q:I=""  S J="" F  S J=$O(ORY(I,J)) Q:J=""  S K="" F  S K=$O(ORY(I,J,K)) Q:K=""  S L="" F  S L=$O(ORY(I,J,K,L)) Q:L=""  S M="" F  S M=$O(ORY(I,J,K,L,M)) Q:M=""  D LN D
"RTN","ORWDXVB1",90,0)
 . S X=ORY(I,J,K,L,M),INDEX=$E(K,2),UNT=$S(INDEX="A":"Autologous",INDEX="D":"Directed",INDEX="C":"Crossmatched",INDEX="S":"Assigned",1:"Unknown")
"RTN","ORWDXVB1",91,0)
 . S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,$P(X,"^"),.CCNT)_$$S^ORU4(13,CCNT,$P(X,"^",2),.CCNT)_$$S^ORU4(27,CCNT,UNT,.CCNT)_$$S^ORU4(42,CCNT,$$DATETIME($P(X,"^",4)),.CCNT)_$$S^ORU4(58,CCNT,$P(X,"^",3),.CCNT)
"RTN","ORWDXVB1",92,0)
 Q
"RTN","ORWDXVB1",93,0)
LN ;Increment counts
"RTN","ORWDXVB1",94,0)
 S GCNT=GCNT+1,CCNT=1
"RTN","ORWDXVB1",95,0)
 Q
"RTN","ORWDXVB1",96,0)
DATETIME(X) ; -- Return external form of YYYYMMDDHHNNSS date
"RTN","ORWDXVB1",97,0)
 N Y S Y=$$HL7TFM^XLFDT(X),Y=$$DATETIME^ORCHTAB(Y)
"RTN","ORWDXVB1",98,0)
 Q Y
"RTN","ORWDXVB2")
0^217^B24066583
"RTN","ORWDXVB2",1,0)
ORWDXVB2 ;slc/dcm - Order dialog utilities for Blood Bank Cont.;3/2/04  09:31
"RTN","ORWDXVB2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,243**;Dec 17 1997;Build 242
"RTN","ORWDXVB2",3,0)
 ;
"RTN","ORWDXVB2",4,0)
ERROR ;Process error
"RTN","ORWDXVB2",5,0)
 D LN
"RTN","ORWDXVB2",6,0)
 S VBERROR=$P(ORX("ERROR"),"^",2)
"RTN","ORWDXVB2",7,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"******************************************************************",.CCNT) D LN
"RTN","ORWDXVB2",8,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"*                                                                *",.CCNT) D LN
"RTN","ORWDXVB2",9,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"*                           WARNING!                             *",.CCNT) D LN
"RTN","ORWDXVB2",10,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"*                                                                *",.CCNT) D LN
"RTN","ORWDXVB2",11,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"*                An Error occurred attempting to                 *",.CCNT) D LN
"RTN","ORWDXVB2",12,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"*                retrieve Blood Bank order data.                 *",.CCNT) D LN
"RTN","ORWDXVB2",13,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"*                                                                *",.CCNT) D LN
"RTN","ORWDXVB2",14,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"*          This order cannot be completed at this time.          *",.CCNT) D LN
"RTN","ORWDXVB2",15,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"*         Revert to local downtime procedures to continue        *",.CCNT) D LN
"RTN","ORWDXVB2",16,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"*           order or retry this option at a later time.          *",.CCNT) D LN
"RTN","ORWDXVB2",17,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"*                                                                *",.CCNT) D LN
"RTN","ORWDXVB2",18,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"*           Contact the Blood Bank System Administrator          *",.CCNT) D LN
"RTN","ORWDXVB2",19,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"*                                                                *",.CCNT) D LN
"RTN","ORWDXVB2",20,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"******************************************************************",.CCNT) D LN
"RTN","ORWDXVB2",21,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"*                                                                *",.CCNT) D LN
"RTN","ORWDXVB2",22,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"*                         Error Message                          *",.CCNT) D LN
"RTN","ORWDXVB2",23,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"*                                                                *",.CCNT) D LN
"RTN","ORWDXVB2",24,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"*",.CCNT)
"RTN","ORWDXVB2",25,0)
 I $L(VBERROR)<68 D
"RTN","ORWDXVB2",26,0)
 . S ^TMP("ORVBEC",$J,GCNT,0)=^TMP("ORVBEC",$J,GCNT,0)_$$S^ORU4(70-$L(VBERROR)/2,CCNT,VBERROR,.CCNT)
"RTN","ORWDXVB2",27,0)
 . S ^TMP("ORVBEC",$J,GCNT,0)=^TMP("ORVBEC",$J,GCNT,0)_$$S^ORU4(67,CCNT,"*",.CCNT) D LN
"RTN","ORWDXVB2",28,0)
 I $L(VBERROR)>68 D
"RTN","ORWDXVB2",29,0)
 . I $L(VBERROR)>136 S VBERROR=$E(VBERROR,1,136)_"..."
"RTN","ORWDXVB2",30,0)
 . N L1 S L1=$E(VBERROR,1,$L(VBERROR)/2)
"RTN","ORWDXVB2",31,0)
 . I $E(L1,$L(L1))'=" " D
"RTN","ORWDXVB2",32,0)
 . . S LINE1=$E(L1,1,($L(L1)-($L($P(L1," ",$L(L1," ")))))),LINE2=$E(VBERROR,$L(LINE1)+1,$L(VBERROR))
"RTN","ORWDXVB2",33,0)
 . E  S LINE1=$E(L1),LINE2=$E(VBERROR,$L(LINE1)+1,$L(VBERROR))
"RTN","ORWDXVB2",34,0)
 . S ^TMP("ORVBEC",$J,GCNT,0)=^TMP("ORVBEC",$J,GCNT,0)_$$S^ORU4(70-$L(LINE1)/2,CCNT,LINE1,.CCNT)
"RTN","ORWDXVB2",35,0)
 . S ^TMP("ORVBEC",$J,GCNT,0)=^TMP("ORVBEC",$J,GCNT,0)_$$S^ORU4(67,CCNT,"*",.CCNT) D LN
"RTN","ORWDXVB2",36,0)
 . S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"*",.CCNT)
"RTN","ORWDXVB2",37,0)
 . S ^TMP("ORVBEC",$J,GCNT,0)=^TMP("ORVBEC",$J,GCNT,0)_$$S^ORU4(70-$L(LINE2)/2,CCNT,LINE2,.CCNT)
"RTN","ORWDXVB2",38,0)
 . S ^TMP("ORVBEC",$J,GCNT,0)=^TMP("ORVBEC",$J,GCNT,0)_$$S^ORU4(67,CCNT,"*",.CCNT) D LN
"RTN","ORWDXVB2",39,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"*                                                                *",.CCNT) D LN
"RTN","ORWDXVB2",40,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"******************************************************************",.CCNT) D LN
"RTN","ORWDXVB2",41,0)
 D LINE^ORU4("^TMP(""ORVBEC"",$J)",GIOM),LN
"RTN","ORWDXVB2",42,0)
 Q
"RTN","ORWDXVB2",43,0)
PULL(OROOT,ORVP,ITEMID,SDATE,EDATE) ;Get list of orders matching ITEM
"RTN","ORWDXVB2",44,0)
 ;ITEM = Orderable Item ID e.g. "1;99VBC" for Type and Screen
"RTN","ORWDXVB2",45,0)
 ;SDATE = Start Date for search
"RTN","ORWDXVB2",46,0)
 ;EDATE = End Date for search
"RTN","ORWDXVB2",47,0)
 Q:'$G(ORVP)
"RTN","ORWDXVB2",48,0)
 N ORTNSB
"RTN","ORWDXVB2",49,0)
 I $P(ORVP,";",2)="" S ORVP=ORVP_";DPT("
"RTN","ORWDXVB2",50,0)
 S ORTNSB=$$GET^XPAR("ALL","ORWDXVB VBECS TNS CHECK",1,"I")
"RTN","ORWDXVB2",51,0)
 S:'ORTNSB ORTNSB=3 ;Use Default of DT-3 or Parameter [ORWDXVB VBECS TNS CHECK] if no start date passed in
"RTN","ORWDXVB2",52,0)
 S ITEMID=$S($D(ITEMID):ITEMID,1:"1;99VBC") ;Default to Type and Screen if nothing passed in
"RTN","ORWDXVB2",53,0)
 S SDATE=$S($D(SDATE):SDATE,1:$$FMADD^XLFDT(DT-ORTNSB))
"RTN","ORWDXVB2",54,0)
 S EDATE=$S($D(EDATE):EDATE,1:DT) ;Default to DT if no End date passed in
"RTN","ORWDXVB2",55,0)
 N ORDG,FLG,ORLIST,ORX0,ORX3,ORSTAT,ORIFN,I,X,J,CNT,ITEM,ITEMNM,ORLOC,DIV
"RTN","ORWDXVB2",56,0)
 S ITEM=+$O(^ORD(101.43,"ID",ITEMID,0)),ITEMNM=$P($G(^ORD(101.43,ITEM,0)),"^")
"RTN","ORWDXVB2",57,0)
 S CNT=0,ORDG=$O(^ORD(100.98,"B","VBEC",0)) Q:'ORDG
"RTN","ORWDXVB2",58,0)
 F FLG=4,23,19 D  ;Get completed, active/pending, unreleased
"RTN","ORWDXVB2",59,0)
 . K ^TMP("ORR",$J)
"RTN","ORWDXVB2",60,0)
 . D EN^ORQ1(ORVP,ORDG,FLG,0,SDATE,EDATE)
"RTN","ORWDXVB2",61,0)
 . I '$O(^TMP("ORR",$J,ORLIST,0)) Q
"RTN","ORWDXVB2",62,0)
 . S I=0
"RTN","ORWDXVB2",63,0)
 . F  S I=$O(^TMP("ORR",$J,ORLIST,I)) Q:'I  S X=^(I) D
"RTN","ORWDXVB2",64,0)
 .. S ORIFN=+X,J=0,DIV=""
"RTN","ORWDXVB2",65,0)
 .. Q:'$D(^OR(100,ORIFN,0))  S ORX0=^(0),ORX3=^(3)
"RTN","ORWDXVB2",66,0)
 .. S ORSTAT=$S($D(^ORD(100.01,+$P(ORX3,"^",3),0)):$P(^(0),"^"),1:""),ORLOC=$S($L($P($G(^SC(+$P(ORX0,"^",10),0)),"^")):$P(^(0),"^"),1:"UNKNOWN")
"RTN","ORWDXVB2",67,0)
 .. I +$P(ORX0,"^",10) S DIV=$P($G(^SC(+$P(ORX0,"^",10),0)),U,15),DIV=$S(DIV:$P($$SITE^VASITE(DT,DIV),"^",2),1:"")
"RTN","ORWDXVB2",68,0)
 .. F  S J=$O(^OR(100,ORIFN,4.5,"ID","ORDERABLE",J)) Q:'J  I +$G(^OR(100,ORIFN,4.5,J,1))=ITEM D
"RTN","ORWDXVB2",69,0)
 ... S CNT=CNT+1,OROOT(CNT)="Duplicate order: "_ITEMNM_" entered "_$$FMTE^XLFDT($P(ORX0,"^",7))_" Div/Loc: "_DIV_":"_ORLOC_" ["_ORSTAT_"]"
"RTN","ORWDXVB2",70,0)
 Q
"RTN","ORWDXVB2",71,0)
LN ;Increment counts
"RTN","ORWDXVB2",72,0)
 S GCNT=GCNT+1,CCNT=1
"RTN","ORWDXVB2",73,0)
 Q
"RTN","ORWGAPI")
0^113^B23670784
"RTN","ORWGAPI",1,0)
ORWGAPI ; SLC/STAFF - Graph API ;12/21/05  08:14
"RTN","ORWGAPI",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,243**;Dec 17, 1997;Build 242
"RTN","ORWGAPI",3,0)
 ;
"RTN","ORWGAPI",4,0)
ALLITEMS(ITEMS,DFN) ; API - return all items of data on patient (procedures, tests, codes,..)
"RTN","ORWGAPI",5,0)
 N CNT,SUB,TMP,TYPE
"RTN","ORWGAPI",6,0)
 K ^TMP("ORWGAPI",$J)
"RTN","ORWGAPI",7,0)
 S DFN=+$G(DFN) I 'DFN Q
"RTN","ORWGAPI",8,0)
 D TYPES("ORWGAPI",DFN)
"RTN","ORWGAPI",9,0)
 D RETURN^ORWGAPIW(.TMP,.ITEMS)
"RTN","ORWGAPI",10,0)
 S CNT=0
"RTN","ORWGAPI",11,0)
 S SUB=""
"RTN","ORWGAPI",12,0)
 F  S SUB=$O(^TMP("ORWGAPI",$J,SUB)) Q:SUB=""  D
"RTN","ORWGAPI",13,0)
 . S TYPE=$P(^TMP("ORWGAPI",$J,SUB),U)
"RTN","ORWGAPI",14,0)
 . D ITEMS^ORWGAPIR(.ITEMS,DFN,TYPE,0,,,.CNT,TMP)
"RTN","ORWGAPI",15,0)
 D SETLAST^ORWGTASK(DFN)
"RTN","ORWGAPI",16,0)
 K ^TMP("ORWGAPI",$J)
"RTN","ORWGAPI",17,0)
 Q
"RTN","ORWGAPI",18,0)
 ;
"RTN","ORWGAPI",19,0)
ALLVIEWS(DATA,VIEW,USER) ; API - get all graph views
"RTN","ORWGAPI",20,0)
 D ALLVIEWS^ORWGAPIP(.DATA,+$G(VIEW),+$G(USER))
"RTN","ORWGAPI",21,0)
 Q
"RTN","ORWGAPI",22,0)
 ;
"RTN","ORWGAPI",23,0)
CLASS(DATA,TYPE) ; API - get classification
"RTN","ORWGAPI",24,0)
 I TYPE=50.605 D DRUGC^ORWGAPIC(.DATA)
"RTN","ORWGAPI",25,0)
 I TYPE=68 D ACC^ORWGAPIC(.DATA)
"RTN","ORWGAPI",26,0)
 I TYPE=8925.1 D TIUTITLE^ORWGAPIA(.DATA)
"RTN","ORWGAPI",27,0)
 I TYPE=100.98 D OITEM^ORWGAPIA(.DATA)
"RTN","ORWGAPI",28,0)
 Q
"RTN","ORWGAPI",29,0)
 ;
"RTN","ORWGAPI",30,0)
DATEDATA(DATA,OLDEST,NEWEST,TYPEITEM,DFN) ; API - return all data for an item on patient for date range
"RTN","ORWGAPI",31,0)
 N CNT,ITEM,SUB,TMP,TYPE
"RTN","ORWGAPI",32,0)
 S DFN=+$G(DFN) I 'DFN Q
"RTN","ORWGAPI",33,0)
 S OLDEST=+$G(OLDEST)
"RTN","ORWGAPI",34,0)
 S NEWEST=+$G(NEWEST,$$NOW^ORWGAPIX)
"RTN","ORWGAPI",35,0)
 S TYPEITEM=$G(TYPEITEM) I TYPEITEM'[U Q
"RTN","ORWGAPI",36,0)
 I 'OLDEST D ITEMDATA(.DATA,TYPEITEM,NEWEST,DFN,OLDEST) Q
"RTN","ORWGAPI",37,0)
 I OLDEST<NEWEST Q
"RTN","ORWGAPI",38,0)
 S TYPEITEM=$$UP^ORWGAPIX(TYPEITEM)
"RTN","ORWGAPI",39,0)
 D RETURN^ORWGAPIW(.TMP,.DATA)
"RTN","ORWGAPI",40,0)
 S TYPE=$P(TYPEITEM,U)
"RTN","ORWGAPI",41,0)
 S ITEM=$P(TYPEITEM,U,2)
"RTN","ORWGAPI",42,0)
 S CNT=0
"RTN","ORWGAPI",43,0)
 D DATA^ORWGAPIR(.DATA,ITEM,TYPE,NEWEST,DFN,.CNT,TMP,OLDEST)
"RTN","ORWGAPI",44,0)
 Q
"RTN","ORWGAPI",45,0)
 ;
"RTN","ORWGAPI",46,0)
DATEITEM(ITEMS,OLDEST,NEWEST,TYPE,DFN) ; API - return all file items on patient for date range
"RTN","ORWGAPI",47,0)
 N CNT,SUB,TMP
"RTN","ORWGAPI",48,0)
 K ^TMP("ORWGAPI",$J)
"RTN","ORWGAPI",49,0)
 S DFN=+$G(DFN) I 'DFN Q
"RTN","ORWGAPI",50,0)
 S OLDEST=+$G(OLDEST),NEWEST=+$G(NEWEST),TYPE=$G(TYPE)
"RTN","ORWGAPI",51,0)
 I $L(TYPE) S ^TMP("ORWGAPI",$J,1)=TYPE
"RTN","ORWGAPI",52,0)
 I '$L(TYPE) D TYPES("ORWGAPI",DFN)
"RTN","ORWGAPI",53,0)
 D RETURN^ORWGAPIW(.TMP,.ITEMS)
"RTN","ORWGAPI",54,0)
 S CNT=0
"RTN","ORWGAPI",55,0)
 S SUB=""
"RTN","ORWGAPI",56,0)
 F  S SUB=$O(^TMP("ORWGAPI",$J,SUB)) Q:SUB=""  D
"RTN","ORWGAPI",57,0)
 . S TYPE=$P(^TMP("ORWGAPI",$J,SUB),U)
"RTN","ORWGAPI",58,0)
 . D ITEMS^ORWGAPIR(.ITEMS,DFN,TYPE,6,OLDEST,NEWEST,.CNT,TMP)
"RTN","ORWGAPI",59,0)
 K ^TMP("ORWGAPI",$J)
"RTN","ORWGAPI",60,0)
 Q
"RTN","ORWGAPI",61,0)
 ;
"RTN","ORWGAPI",62,0)
DELVIEWS(DATA,NAME,PUBLIC) ; API - delete a graph view
"RTN","ORWGAPI",63,0)
 D DELVIEWS^ORWGAPIP(.DATA,$G(NAME),$G(PUBLIC))
"RTN","ORWGAPI",64,0)
 Q
"RTN","ORWGAPI",65,0)
 ;
"RTN","ORWGAPI",66,0)
DETAIL(DATA,DFN,DATE1,DATE2,VAL,COMP) ; API - get all reports for types of data from items and date range
"RTN","ORWGAPI",67,0)
 D DETAIL^ORWGAPID("ORWGRPC",DFN,DATE1,DATE2,.VAL)
"RTN","ORWGAPI",68,0)
 S DATA=$NA(^TMP("ORWGRPC",$J))
"RTN","ORWGAPI",69,0)
 Q
"RTN","ORWGAPI",70,0)
 ;
"RTN","ORWGAPI",71,0)
DETAILS(DATA,DFN,DATE1,DATE2,TYPE,COMP) ; API - get report for type of data for a date or date range
"RTN","ORWGAPI",72,0)
 D DETAILS^ORWGAPID("ORWGRPC",DFN,DATE1,DATE2,TYPE)
"RTN","ORWGAPI",73,0)
 S DATA=$NA(^TMP("ORWGRPC",$J))
"RTN","ORWGAPI",74,0)
 Q
"RTN","ORWGAPI",75,0)
 ;
"RTN","ORWGAPI",76,0)
FASTDATA(DATA,DFN) ; API - get all data (non-lab) on patient
"RTN","ORWGAPI",77,0)
 D FASTDATA^ORWGAPIF(.DATA,DFN)
"RTN","ORWGAPI",78,0)
 Q
"RTN","ORWGAPI",79,0)
 ;
"RTN","ORWGAPI",80,0)
FASTITEM(ITEMS,DFN) ; API - get all items on patient 
"RTN","ORWGAPI",81,0)
 D FASTITEM^ORWGAPIF(.ITEMS,DFN)
"RTN","ORWGAPI",82,0)
 D SETLAST^ORWGTASK(DFN)
"RTN","ORWGAPI",83,0)
 Q
"RTN","ORWGAPI",84,0)
 ;
"RTN","ORWGAPI",85,0)
FASTLABS(DATA,DFN) ; API - get all lab data on patient
"RTN","ORWGAPI",86,0)
 D FASTLABS^ORWGAPIF(.DATA,DFN)
"RTN","ORWGAPI",87,0)
 Q
"RTN","ORWGAPI",88,0)
 ;
"RTN","ORWGAPI",89,0)
FASTTASK(STATUS,DFN,OLDDFN) ; API - process cache of all data and items on patient, -1 if turned off
"RTN","ORWGAPI",90,0)
 ; this should be able to be turned off if needbe (D CLEAN^ORWGTASK)
"RTN","ORWGAPI",91,0)
 D UPDATE^ORWGTASK(.STATUS,DFN,DUZ,+$G(OLDDFN))
"RTN","ORWGAPI",92,0)
 Q
"RTN","ORWGAPI",93,0)
 ;
"RTN","ORWGAPI",94,0)
GETDATES(DATA,REPORTID) ; API - get graph date ranges
"RTN","ORWGAPI",95,0)
 D GETDATES^ORWGAPID(.DATA,$G(REPORTID))
"RTN","ORWGAPI",96,0)
 Q
"RTN","ORWGAPI",97,0)
 ;
"RTN","ORWGAPI",98,0)
GETPREF(DATA) ; API - get graph settings
"RTN","ORWGAPI",99,0)
 D GETPREF^ORWGAPIP(.DATA)
"RTN","ORWGAPI",100,0)
 Q
"RTN","ORWGAPI",101,0)
 ;
"RTN","ORWGAPI",102,0)
GETSIZE(DATA) ; API - get graph positions and sizes
"RTN","ORWGAPI",103,0)
 D GETSIZE^ORWGAPIP(.DATA)
"RTN","ORWGAPI",104,0)
 Q
"RTN","ORWGAPI",105,0)
 ;
"RTN","ORWGAPI",106,0)
GETVIEWS(DATA,ALL,PUBLIC,EXT,USER) ; API - get graph views
"RTN","ORWGAPI",107,0)
 D GETVIEWS^ORWGAPIP(.DATA,$G(ALL),$G(PUBLIC),$G(EXT),+$G(USER))
"RTN","ORWGAPI",108,0)
 Q
"RTN","ORWGAPI",109,0)
 ;
"RTN","ORWGAPI",110,0)
ITEMDATA(DATA,TYPEITEM,START,DFN,BACKTO) ; API - return data of an item on patient (glucose results)
"RTN","ORWGAPI",111,0)
 N CNT,ITEM,TMP,TYPE
"RTN","ORWGAPI",112,0)
 S DFN=+$G(DFN) I 'DFN Q
"RTN","ORWGAPI",113,0)
 S TYPEITEM=$G(TYPEITEM) I TYPEITEM'[U Q
"RTN","ORWGAPI",114,0)
 S TYPEITEM=$$UP^ORWGAPIX(TYPEITEM)
"RTN","ORWGAPI",115,0)
 S START=$G(START,$$NOW^ORWGAPIX)
"RTN","ORWGAPI",116,0)
 D RETURN^ORWGAPIW(.TMP,.DATA)
"RTN","ORWGAPI",117,0)
 S TYPE=$P(TYPEITEM,U)
"RTN","ORWGAPI",118,0)
 S ITEM=$P(TYPEITEM,U,2)
"RTN","ORWGAPI",119,0)
 S CNT=0
"RTN","ORWGAPI",120,0)
 D DATA^ORWGAPIR(.DATA,ITEM,TYPE,START,DFN,.CNT,TMP,$G(BACKTO))
"RTN","ORWGAPI",121,0)
 Q
"RTN","ORWGAPI",122,0)
 ; 
"RTN","ORWGAPI",123,0)
ITEMS(ITEMS,DFN,TYPE) ; API - return items of a type of data on patient (lab tests)
"RTN","ORWGAPI",124,0)
 N CNT,TMP
"RTN","ORWGAPI",125,0)
 S DFN=+$G(DFN) I 'DFN Q
"RTN","ORWGAPI",126,0)
 S TYPE=$G(TYPE) I '$L(TYPE) Q
"RTN","ORWGAPI",127,0)
 D RETURN^ORWGAPIW(.TMP,.ITEMS)
"RTN","ORWGAPI",128,0)
 S CNT=0
"RTN","ORWGAPI",129,0)
 D ITEMS^ORWGAPIR(.ITEMS,DFN,TYPE,3,,,.CNT,TMP)
"RTN","ORWGAPI",130,0)
 I TYPE=63 D SETLAST^ORWGTASK(DFN)
"RTN","ORWGAPI",131,0)
 Q
"RTN","ORWGAPI",132,0)
 ;
"RTN","ORWGAPI",133,0)
LOOKUP(VAL,FILE,FROM,DIR) ; API - get item names for long lookup
"RTN","ORWGAPI",134,0)
 N REF,SCREEN,XREF
"RTN","ORWGAPI",135,0)
 D FILE^ORWGAPIU($G(FILE),.REF,.XREF,.SCREEN)
"RTN","ORWGAPI",136,0)
 I '$L(REF) Q
"RTN","ORWGAPI",137,0)
 D GENERIC^ORWGAPIW(.VAL,.FROM,DIR,FILE,REF,XREF,SCREEN)
"RTN","ORWGAPI",138,0)
 Q
"RTN","ORWGAPI",139,0)
 ;
"RTN","ORWGAPI",140,0)
PUBLIC(USER) ; API - $$(user) -> 1 if user can edit public settings and views
"RTN","ORWGAPI",141,0)
 Q $$PUBLIC^ORWGAPIP(USER)
"RTN","ORWGAPI",142,0)
 ;
"RTN","ORWGAPI",143,0)
RPTPARAM(IEN) ; API - $$(ien) -> PARAM1^PARAM2 for graph report else ""
"RTN","ORWGAPI",144,0)
 Q $$RPTPARAM^ORWGAPIP(IEN)
"RTN","ORWGAPI",145,0)
 ;
"RTN","ORWGAPI",146,0)
SETPREF(DATA,VAL,PUBLIC) ; API - set a graph setting
"RTN","ORWGAPI",147,0)
 D SETPREF^ORWGAPIP(.DATA,$G(VAL),$G(PUBLIC))
"RTN","ORWGAPI",148,0)
 Q
"RTN","ORWGAPI",149,0)
 ;
"RTN","ORWGAPI",150,0)
SETSIZE(DATA,VAL) ; API - set graph positions and settings
"RTN","ORWGAPI",151,0)
 D SETSIZE^ORWGAPIP(.DATA,.VAL)
"RTN","ORWGAPI",152,0)
 Q
"RTN","ORWGAPI",153,0)
 ;
"RTN","ORWGAPI",154,0)
SETVIEWS(DATA,NAME,PUBLIC,VAL) ; API - set a graph view
"RTN","ORWGAPI",155,0)
 D SETVIEWS^ORWGAPIP(.DATA,$G(NAME),$G(PUBLIC),.VAL)
"RTN","ORWGAPI",156,0)
 Q
"RTN","ORWGAPI",157,0)
 ;
"RTN","ORWGAPI",158,0)
TAX(DATA,ALL,REMTAX) ; API - get reminder taxonomies
"RTN","ORWGAPI",159,0)
 D TAX^ORWGAPID(.DATA,+$G(ALL),.REMTAX)
"RTN","ORWGAPI",160,0)
 Q
"RTN","ORWGAPI",161,0)
 ;
"RTN","ORWGAPI",162,0)
TESTING(DATA) ; API - return test data
"RTN","ORWGAPI",163,0)
 D TESTING^ORWGTEST(.DATA)
"RTN","ORWGAPI",164,0)
 Q
"RTN","ORWGAPI",165,0)
 ;
"RTN","ORWGAPI",166,0)
TESTSPEC(DATA) ;  API - return test/spec info on all lab tests
"RTN","ORWGAPI",167,0)
 D TESTSPEC^ORWGAPIC(.DATA)
"RTN","ORWGAPI",168,0)
 Q
"RTN","ORWGAPI",169,0)
 ;
"RTN","ORWGAPI",170,0)
TYPES(TYPES,DFN,SUB) ; API - return all types of data on patient (if no dfn, return all)
"RTN","ORWGAPI",171,0)
 N TMP
"RTN","ORWGAPI",172,0)
 S DFN=+$G(DFN)
"RTN","ORWGAPI",173,0)
 S SUB=+$G(SUB)
"RTN","ORWGAPI",174,0)
 D RETURN^ORWGAPIW(.TMP,.TYPES)
"RTN","ORWGAPI",175,0)
 D TYPES^ORWGAPIT(.TYPES,DFN,SUB,TMP)
"RTN","ORWGAPI",176,0)
 Q
"RTN","ORWGAPI1")
0^114^B30659117
"RTN","ORWGAPI1",1,0)
ORWGAPI1 ; SLC/STAFF - Graph Items ;12/21/05  08:15
"RTN","ORWGAPI1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,243**;Dec 17, 1997;Build 242
"RTN","ORWGAPI1",3,0)
 ;
"RTN","ORWGAPI1",4,0)
AA(ITEMS,DFN,FMT,OLDEST,NEWEST,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI1",5,0)
 ; FMT,OLDEST,NEWEST not used
"RTN","ORWGAPI1",6,0)
 N ITEM,FILE,NUM,REF,RESULT
"RTN","ORWGAPI1",7,0)
 K ^TMP("ORWGRPC DC",$J)
"RTN","ORWGAPI1",8,0)
 S ITEM=""
"RTN","ORWGAPI1",9,0)
 F  S ITEM=$O(^PXRMINDX(63,"PI",DFN,ITEM)) Q:ITEM=""  D
"RTN","ORWGAPI1",10,0)
 . I $E(ITEM)="A" Q
"RTN","ORWGAPI1",11,0)
 . I $E(ITEM)="M" Q
"RTN","ORWGAPI1",12,0)
 . S RESULT=$$AALAB^ORWGAPIC(ITEM)
"RTN","ORWGAPI1",13,0)
 . I RESULT="" Q
"RTN","ORWGAPI1",14,0)
 . S RESULT="68^"_RESULT
"RTN","ORWGAPI1",15,0)
 . S ^TMP("ORWGRPC DC",$J,RESULT)=""
"RTN","ORWGAPI1",16,0)
 S RESULT=""
"RTN","ORWGAPI1",17,0)
 F  S RESULT=$O(^TMP("ORWGRPC DC",$J,RESULT)) Q:RESULT=""  S CNT=CNT+1 D
"RTN","ORWGAPI1",18,0)
 . D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPI1",19,0)
 K ^TMP("ORWGRPC DC",$J)
"RTN","ORWGAPI1",20,0)
 Q
"RTN","ORWGAPI1",21,0)
 ;
"RTN","ORWGAPI1",22,0)
AP(ITEMS,DFN,FMT,OLDEST,NEWEST,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI1",23,0)
 N DATE,ITEM,OK,RESULT
"RTN","ORWGAPI1",24,0)
 S ITEM="A"
"RTN","ORWGAPI1",25,0)
 F  S ITEM=$O(^PXRMINDX(63,"PI",DFN,ITEM)) Q:ITEM=""  Q:ITEM]"AZ"  D
"RTN","ORWGAPI1",26,0)
 . S OK=0
"RTN","ORWGAPI1",27,0)
 . I FMT=6 D
"RTN","ORWGAPI1",28,0)
 .. S DATE=OLDEST
"RTN","ORWGAPI1",29,0)
 .. F  S DATE=$O(^PXRMINDX(63,"PI",DFN,ITEM,DATE)) Q:DATE=""  Q:DATE>NEWEST  D  Q:OK
"RTN","ORWGAPI1",30,0)
 ... S CNT=CNT+1
"RTN","ORWGAPI1",31,0)
 ... S OK=1
"RTN","ORWGAPI1",32,0)
 ... S RESULT="63AP"_U_ITEM
"RTN","ORWGAPI1",33,0)
 . I FMT=3 D
"RTN","ORWGAPI1",34,0)
 .. S DATE=$O(^PXRMINDX(63,"PI",DFN,ITEM,""),-1)
"RTN","ORWGAPI1",35,0)
 .. I 'DATE Q
"RTN","ORWGAPI1",36,0)
 .. S OK=1
"RTN","ORWGAPI1",37,0)
 .. S CNT=CNT+1
"RTN","ORWGAPI1",38,0)
 .. S RESULT="63AP^"_ITEM_"^^"_$$ITEMPRFX^ORWGAPIU(ITEM)_": "_$$EVALUE^ORWGAPIU(ITEM,63,.01)_"^^"_DATE
"RTN","ORWGAPI1",39,0)
 . I FMT=0 D
"RTN","ORWGAPI1",40,0)
 .. S OK=1
"RTN","ORWGAPI1",41,0)
 .. S CNT=CNT+1
"RTN","ORWGAPI1",42,0)
 .. S RESULT="63AP^"_ITEM_U_$$ITEMPRFX^ORWGAPIU(ITEM)_": "_$$EVALUE^ORWGAPIU(ITEM,63,.01)
"RTN","ORWGAPI1",43,0)
 . I OK D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPI1",44,0)
 Q
"RTN","ORWGAPI1",45,0)
 ;
"RTN","ORWGAPI1",46,0)
LAB(ITEMS,DFN,FMT,OLDEST,NEWEST,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI1",47,0)
 N DATE,ITEM,OK,RESULT
"RTN","ORWGAPI1",48,0)
 S ITEM=0
"RTN","ORWGAPI1",49,0)
 F  S ITEM=$O(^PXRMINDX(63,"PI",DFN,ITEM)) Q:ITEM<1  D
"RTN","ORWGAPI1",50,0)
 . S OK=0
"RTN","ORWGAPI1",51,0)
 . I FMT=6 D
"RTN","ORWGAPI1",52,0)
 .. S DATE=OLDEST
"RTN","ORWGAPI1",53,0)
 .. F  S DATE=$O(^PXRMINDX(63,"PI",DFN,ITEM,DATE)) Q:DATE=""  Q:DATE>NEWEST  D  Q:OK
"RTN","ORWGAPI1",54,0)
 ... S CNT=CNT+1
"RTN","ORWGAPI1",55,0)
 ... S OK=1
"RTN","ORWGAPI1",56,0)
 ... S RESULT=63_U_ITEM
"RTN","ORWGAPI1",57,0)
 . I FMT=3 D
"RTN","ORWGAPI1",58,0)
 .. S DATE=$O(^PXRMINDX(63,"PI",DFN,ITEM,""),-1)
"RTN","ORWGAPI1",59,0)
 .. I 'DATE Q
"RTN","ORWGAPI1",60,0)
 .. S CNT=CNT+1
"RTN","ORWGAPI1",61,0)
 .. S OK=1
"RTN","ORWGAPI1",62,0)
 .. S RESULT=63_U_ITEM_"^^"_$$EVALUE^ORWGAPIU(ITEM,63,.01)_"^^"_DATE
"RTN","ORWGAPI1",63,0)
 . I FMT=0 D
"RTN","ORWGAPI1",64,0)
 .. S CNT=CNT+1
"RTN","ORWGAPI1",65,0)
 .. S OK=1
"RTN","ORWGAPI1",66,0)
 .. S RESULT=63_U_ITEM_U_$$EVALUE^ORWGAPIU(ITEM,63,.01)
"RTN","ORWGAPI1",67,0)
 . I OK D
"RTN","ORWGAPI1",68,0)
 .. S RESULT=RESULT_U_$$AALAB^ORWGAPIC(ITEM)
"RTN","ORWGAPI1",69,0)
 .. D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPI1",70,0)
 Q
"RTN","ORWGAPI1",71,0)
 ;
"RTN","ORWGAPI1",72,0)
MI(ITEMS,DFN,FMT,OLDEST,NEWEST,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI1",73,0)
 N DATE,ITEM,OK,RESULT
"RTN","ORWGAPI1",74,0)
 S ITEM="M"
"RTN","ORWGAPI1",75,0)
 F  S ITEM=$O(^PXRMINDX(63,"PI",DFN,ITEM)) Q:ITEM=""  Q:ITEM]"MZ"  D
"RTN","ORWGAPI1",76,0)
 . S OK=0
"RTN","ORWGAPI1",77,0)
 . I FMT=6 D
"RTN","ORWGAPI1",78,0)
 .. S DATE=OLDEST
"RTN","ORWGAPI1",79,0)
 .. F  S DATE=$O(^PXRMINDX(63,"PI",DFN,ITEM,DATE)) Q:DATE=""  Q:DATE>NEWEST  D  Q:OK
"RTN","ORWGAPI1",80,0)
 ... S CNT=CNT+1
"RTN","ORWGAPI1",81,0)
 ... S OK=1
"RTN","ORWGAPI1",82,0)
 ... S RESULT="63MI"_U_ITEM
"RTN","ORWGAPI1",83,0)
 . I FMT=3 D
"RTN","ORWGAPI1",84,0)
 .. S DATE=$O(^PXRMINDX(63,"PI",DFN,ITEM,""),-1)
"RTN","ORWGAPI1",85,0)
 .. I 'DATE Q
"RTN","ORWGAPI1",86,0)
 .. S CNT=CNT+1
"RTN","ORWGAPI1",87,0)
 .. S OK=1
"RTN","ORWGAPI1",88,0)
 .. S RESULT="63MI^"_ITEM_"^^"_$$ITEMPRFX^ORWGAPIU(ITEM)_": "_$$EVALUE^ORWGAPIU(ITEM,63,.01)_"^^"_DATE
"RTN","ORWGAPI1",89,0)
 . I FMT=0 D
"RTN","ORWGAPI1",90,0)
 .. S CNT=CNT+1
"RTN","ORWGAPI1",91,0)
 .. S OK=1
"RTN","ORWGAPI1",92,0)
 .. S RESULT="63MI^"_ITEM_U_$$ITEMPRFX^ORWGAPIU(ITEM)_": "_$$EVALUE^ORWGAPIU(ITEM,63,.01)
"RTN","ORWGAPI1",93,0)
 . I OK D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPI1",94,0)
 Q
"RTN","ORWGAPI1",95,0)
 ;
"RTN","ORWGAPI1",96,0)
MED(ITEMS,DFN,FMT,OLDEST,NEWEST,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI1",97,0)
 D MED1^ORWGAPIE(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,.TMP)
"RTN","ORWGAPI1",98,0)
 Q
"RTN","ORWGAPI1",99,0)
 ;
"RTN","ORWGAPI1",100,0)
NOTES(ITEMS,DFN,FMT,OLDEST,NEWEST,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI1",101,0)
 N DATE,DOC,DOCCLASS,DOCIEN,DOCTYPE,DUMMY,RESULT,RESULTS,TITLE K DUMMY
"RTN","ORWGAPI1",102,0)
 K ^TMP("ORWGRPC TEMP",$J),^TMP("TIUR",$J)
"RTN","ORWGAPI1",103,0)
 S CNT=$G(CNT)
"RTN","ORWGAPI1",104,0)
 I FMT=6 D 
"RTN","ORWGAPI1",105,0)
 . F DOCTYPE="P","D","C" D
"RTN","ORWGAPI1",106,0)
 .. S DOCCLASS=$$DOCCLASS^ORWGAPIA(DOCTYPE)
"RTN","ORWGAPI1",107,0)
 .. K ^TMP("TIUR",$J)
"RTN","ORWGAPI1",108,0)
 .. D TIU^ORWGAPIA(.DUMMY,DOCCLASS,5,DFN,$G(OLDEST),$G(NEWEST))
"RTN","ORWGAPI1",109,0)
 .. S DOC=0
"RTN","ORWGAPI1",110,0)
 .. F  S DOC=$O(^TMP("TIUR",$J,DOC)) Q:DOC<1  D
"RTN","ORWGAPI1",111,0)
 ... S RESULTS=^TMP("TIUR",$J,DOC)
"RTN","ORWGAPI1",112,0)
 ... S TITLE=$P(RESULTS,U,2)
"RTN","ORWGAPI1",113,0)
 ... S DATE=$P(RESULTS,U,3)
"RTN","ORWGAPI1",114,0)
 ... I '$L(TITLE) Q
"RTN","ORWGAPI1",115,0)
 ... S ^TMP("ORWGRPC TEMP",$J,TITLE,DATE)=RESULTS
"RTN","ORWGAPI1",116,0)
 I FMT'=6 D
"RTN","ORWGAPI1",117,0)
 . F DOCTYPE="P","D","C" D
"RTN","ORWGAPI1",118,0)
 .. S DOCCLASS=$$DOCCLASS^ORWGAPIA(DOCTYPE)
"RTN","ORWGAPI1",119,0)
 .. K ^TMP("TIUR",$J)
"RTN","ORWGAPI1",120,0)
 .. D TIU^ORWGAPIA(.DUMMY,DOCCLASS,5,DFN)
"RTN","ORWGAPI1",121,0)
 .. S DOC=0
"RTN","ORWGAPI1",122,0)
 .. F  S DOC=$O(^TMP("TIUR",$J,DOC)) Q:DOC<1  D
"RTN","ORWGAPI1",123,0)
 ... S RESULTS=^TMP("TIUR",$J,DOC)
"RTN","ORWGAPI1",124,0)
 ... S TITLE=$P(RESULTS,U,2)
"RTN","ORWGAPI1",125,0)
 ... S DATE=$P(RESULTS,U,3)
"RTN","ORWGAPI1",126,0)
 ... I '$L(TITLE) Q
"RTN","ORWGAPI1",127,0)
 ... S ^TMP("ORWGRPC TEMP",$J,TITLE,DATE)=RESULTS
"RTN","ORWGAPI1",128,0)
 S TITLE=""
"RTN","ORWGAPI1",129,0)
 F  S TITLE=$O(^TMP("ORWGRPC TEMP",$J,TITLE)) Q:TITLE=""  D
"RTN","ORWGAPI1",130,0)
 . S CNT=CNT+1
"RTN","ORWGAPI1",131,0)
 . I FMT=6 S RESULT=8925_U_TITLE
"RTN","ORWGAPI1",132,0)
 . I FMT=3 D
"RTN","ORWGAPI1",133,0)
 .. S DATE=+$O(^TMP("ORWGRPC TEMP",$J,TITLE,""),-1)
"RTN","ORWGAPI1",134,0)
 .. S DOCIEN=+$G(^TMP("ORWGRPC TEMP",$J,TITLE,DATE))
"RTN","ORWGAPI1",135,0)
 .. S RESULT=8925_U_TITLE_"^^"_TITLE_"^^"
"RTN","ORWGAPI1",136,0)
 .. S RESULT=RESULT_DATE
"RTN","ORWGAPI1",137,0)
 .. S RESULT=RESULT_U_$$TITLE^ORWGAPIA(DOCIEN)
"RTN","ORWGAPI1",138,0)
 . I FMT=0 S RESULT=8925_U_TITLE_U_TITLE
"RTN","ORWGAPI1",139,0)
 . S RESULT=$$UP^ORWGAPIX(RESULT)
"RTN","ORWGAPI1",140,0)
 . D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPI1",141,0)
 K ^TMP("ORWGRPC TEMP",$J),^TMP("TIUR",$J)
"RTN","ORWGAPI1",142,0)
 Q
"RTN","ORWGAPI1",143,0)
 ;
"RTN","ORWGAPI1",144,0)
TITLE(ITEMS,DFN,FMT,OLDEST,NEWEST,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI1",145,0)
 ; FMT,OLDEST,NEWEST not used
"RTN","ORWGAPI1",146,0)
 N ITEM,FILE,NUM,REF,RESULT
"RTN","ORWGAPI1",147,0)
 K ^TMP("ORWGRPC DC",$J)
"RTN","ORWGAPI1",148,0)
 S ITEM=""
"RTN","ORWGAPI1",149,0)
 F  S ITEM=$O(^PXRMINDX(63,"PI",DFN,ITEM)) Q:ITEM=""  D
"RTN","ORWGAPI1",150,0)
 . I $E(ITEM)="A" Q
"RTN","ORWGAPI1",151,0)
 . I $E(ITEM)="M" Q
"RTN","ORWGAPI1",152,0)
 . S RESULT=$$AALAB^ORWGAPIC(ITEM)
"RTN","ORWGAPI1",153,0)
 . I RESULT="" Q
"RTN","ORWGAPI1",154,0)
 . S RESULT="68^"_RESULT
"RTN","ORWGAPI1",155,0)
 . S ^TMP("ORWGRPC DC",$J,RESULT)=""
"RTN","ORWGAPI1",156,0)
 S RESULT=""
"RTN","ORWGAPI1",157,0)
 F  S RESULT=$O(^TMP("ORWGRPC DC",$J,RESULT)) Q:RESULT=""  S CNT=CNT+1 D
"RTN","ORWGAPI1",158,0)
 . D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPI1",159,0)
 K ^TMP("ORWGRPC DC",$J)
"RTN","ORWGAPI1",160,0)
 Q
"RTN","ORWGAPI1",161,0)
 ;
"RTN","ORWGAPI2")
0^115^B18274252
"RTN","ORWGAPI2",1,0)
ORWGAPI2 ; SLC/STAFF - Graph API Items ;12/21/05  08:16
"RTN","ORWGAPI2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,243**;Dec 17, 1997;Build 242
"RTN","ORWGAPI2",3,0)
 ;
"RTN","ORWGAPI2",4,0)
ADVERSE(ITEMS,DFN,FMT,OLDEST,NEWEST,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI2",5,0)
 N DATE,IEN,ITEM,RESULT
"RTN","ORWGAPI2",6,0)
 K ^TMP("ORWGRPC SORT",$J),^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPI2",7,0)
 S IEN=0
"RTN","ORWGAPI2",8,0)
 F  S IEN=$O(^GMR(120.8,"B",DFN,IEN)) Q:IEN<1  D
"RTN","ORWGAPI2",9,0)
 . I '$D(^GMR(120.8,IEN,0)) Q
"RTN","ORWGAPI2",10,0)
 . I $G(^GMR(120.8,IEN,"ER")) Q
"RTN","ORWGAPI2",11,0)
 . I '$P(^GMR(120.8,IEN,0),U,12) Q
"RTN","ORWGAPI2",12,0)
 . S DATE=+$P($G(^GMR(120.8,IEN,0)),U,4) I 'DATE Q
"RTN","ORWGAPI2",13,0)
 . S ITEM=$P(^GMR(120.8,IEN,0),U,2) I '$L(ITEM) Q
"RTN","ORWGAPI2",14,0)
 . S ^TMP("ORWGRPC SORT",$J,DATE,ITEM)="" ;ADVERSE
"RTN","ORWGAPI2",15,0)
 I FMT=6 D
"RTN","ORWGAPI2",16,0)
 . S DATE=OLDEST
"RTN","ORWGAPI2",17,0)
 . F  S DATE=$O(^TMP("ORWGRPC SORT",$J,DATE)) Q:DATE<1  Q:DATE>NEWEST  D
"RTN","ORWGAPI2",18,0)
 .. S ITEM=""
"RTN","ORWGAPI2",19,0)
 .. F  S ITEM=$O(^TMP("ORWGRPC SORT",$J,DATE,ITEM)) Q:ITEM=""  D
"RTN","ORWGAPI2",20,0)
 ... I $D(^TMP("ORWGRPC TEMP",$J,ITEM)) Q
"RTN","ORWGAPI2",21,0)
 ... S ^TMP("ORWGRPC TEMP",$J,ITEM)=""
"RTN","ORWGAPI2",22,0)
 ... S CNT=CNT+1
"RTN","ORWGAPI2",23,0)
 ... S RESULT="120.8^"_ITEM
"RTN","ORWGAPI2",24,0)
 ... D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPI2",25,0)
 I FMT'=6 D
"RTN","ORWGAPI2",26,0)
 . S DATE=0
"RTN","ORWGAPI2",27,0)
 . F  S DATE=$O(^TMP("ORWGRPC SORT",$J,DATE)) Q:DATE<1  D
"RTN","ORWGAPI2",28,0)
 .. S ITEM=""
"RTN","ORWGAPI2",29,0)
 .. F  S ITEM=$O(^TMP("ORWGRPC SORT",$J,DATE,ITEM)) Q:ITEM=""  D
"RTN","ORWGAPI2",30,0)
 ... I $D(^TMP("ORWGRPC TEMP",$J,ITEM)) Q
"RTN","ORWGAPI2",31,0)
 ... S ^TMP("ORWGRPC TEMP",$J,ITEM)=""
"RTN","ORWGAPI2",32,0)
 ... S CNT=CNT+1
"RTN","ORWGAPI2",33,0)
 ... I FMT=3 S RESULT="120.8^"_ITEM_"^^"_ITEM_"^^"_DATE
"RTN","ORWGAPI2",34,0)
 ... I FMT=0 S RESULT="120.8^"_ITEM_U_ITEM
"RTN","ORWGAPI2",35,0)
 ... D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPI2",36,0)
 K ^TMP("ORWGRPC SORT",$J),^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPI2",37,0)
 Q
"RTN","ORWGAPI2",38,0)
 ;
"RTN","ORWGAPI2",39,0)
PL(ITEMS,DFN,FMT,OLDEST,NEWEST,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI2",40,0)
 N DATE,ICD9,OK,PRIORITY,RESULT,STATUS
"RTN","ORWGAPI2",41,0)
 K ^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPI2",42,0)
 S STATUS=""
"RTN","ORWGAPI2",43,0)
 F  S STATUS=$O(^PXRMINDX(9000011,"PSPI",DFN,STATUS)) Q:STATUS=""  D
"RTN","ORWGAPI2",44,0)
 . S PRIORITY=""
"RTN","ORWGAPI2",45,0)
 . F  S PRIORITY=$O(^PXRMINDX(9000011,"PSPI",DFN,STATUS,PRIORITY)) Q:PRIORITY=""  D
"RTN","ORWGAPI2",46,0)
 .. S ICD9=""
"RTN","ORWGAPI2",47,0)
 .. F  S ICD9=$O(^PXRMINDX(9000011,"PSPI",DFN,STATUS,PRIORITY,ICD9)) Q:ICD9=""  D
"RTN","ORWGAPI2",48,0)
 ... S OK=0
"RTN","ORWGAPI2",49,0)
 ... I FMT=6 D
"RTN","ORWGAPI2",50,0)
 .... S DATE=OLDEST
"RTN","ORWGAPI2",51,0)
 .... F  S DATE=$O(^PXRMINDX(9000011,"PSPI",DFN,STATUS,PRIORITY,ICD9,DATE)) Q:DATE=""  Q:DATE>NEWEST  D  Q:OK
"RTN","ORWGAPI2",52,0)
 ..... S CNT=CNT+1
"RTN","ORWGAPI2",53,0)
 ..... S OK=1
"RTN","ORWGAPI2",54,0)
 ..... S RESULT=9000011_U_ICD9
"RTN","ORWGAPI2",55,0)
 ... I FMT=3 D
"RTN","ORWGAPI2",56,0)
 .... S DATE=$O(^PXRMINDX(9000011,"PSPI",DFN,STATUS,PRIORITY,ICD9,""),-1)
"RTN","ORWGAPI2",57,0)
 .... I DATE S ^TMP("ORWGRPC TEMP",$J,ICD9,DATE)=""
"RTN","ORWGAPI2",58,0)
 ... I FMT=0 D
"RTN","ORWGAPI2",59,0)
 .... S CNT=CNT+1
"RTN","ORWGAPI2",60,0)
 .... S OK=1
"RTN","ORWGAPI2",61,0)
 .... S RESULT=9000011_U_ICD9_U_$$EVALUE^ORWGAPIU(ICD9,9000011,.01)
"RTN","ORWGAPI2",62,0)
 ... I OK D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPI2",63,0)
 I FMT=3 D
"RTN","ORWGAPI2",64,0)
 . S ICD9=""
"RTN","ORWGAPI2",65,0)
 . F  S ICD9=$O(^TMP("ORWGRPC TEMP",$J,ICD9)) Q:ICD9=""  D
"RTN","ORWGAPI2",66,0)
 .. S DATE=$O(^TMP("ORWGRPC TEMP",$J,ICD9,""),-1)
"RTN","ORWGAPI2",67,0)
 .. I 'DATE Q
"RTN","ORWGAPI2",68,0)
 .. S CNT=CNT+1
"RTN","ORWGAPI2",69,0)
 .. S RESULT=9000011_U_ICD9_"^^"_$$EVALUE^ORWGAPIU(ICD9,9000011,.01)_"^^"_DATE
"RTN","ORWGAPI2",70,0)
 .. D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPI2",71,0)
 K ^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPI2",72,0)
 Q
"RTN","ORWGAPI2",73,0)
 ;
"RTN","ORWGAPI2",74,0)
PLX(ITEMS,DFN,FMT,OLDEST,NEWEST,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI2",75,0)
 D PLX2^ORWGAPID(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,.TMP)
"RTN","ORWGAPI2",76,0)
 Q
"RTN","ORWGAPI2",77,0)
 ;
"RTN","ORWGAPI2",78,0)
REG(ITEMS,DFN,FILE,FMT,OLDEST,NEWEST,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI2",79,0)
 N DATE,ICD,ITEM,NUM,OK,RESULT
"RTN","ORWGAPI2",80,0)
 K ^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPI2",81,0)
 I $E(FILE,3,4)="DX" S ICD="ICD9"
"RTN","ORWGAPI2",82,0)
 I $E(FILE,3,4)="OP" S ICD="ICD0"
"RTN","ORWGAPI2",83,0)
 S NUM=""
"RTN","ORWGAPI2",84,0)
 F  S NUM=$O(^PXRMINDX(45,ICD,"PNI",DFN,NUM)) Q:NUM=""  D
"RTN","ORWGAPI2",85,0)
 . S ITEM=""
"RTN","ORWGAPI2",86,0)
 . F  S ITEM=$O(^PXRMINDX(45,ICD,"PNI",DFN,NUM,ITEM)) Q:ITEM=""  D
"RTN","ORWGAPI2",87,0)
 .. S OK=0
"RTN","ORWGAPI2",88,0)
 .. I FMT=6 D
"RTN","ORWGAPI2",89,0)
 ... S DATE=OLDEST
"RTN","ORWGAPI2",90,0)
 ... F  S DATE=$O(^PXRMINDX(45,ICD,"PNI",DFN,NUM,ITEM,DATE)) Q:DATE=""  Q:DATE>NEWEST  D  Q:OK
"RTN","ORWGAPI2",91,0)
 .... S CNT=CNT+1
"RTN","ORWGAPI2",92,0)
 .... S OK=1
"RTN","ORWGAPI2",93,0)
 .... S RESULT=FILE_U_ITEM
"RTN","ORWGAPI2",94,0)
 .. I FMT=3 D
"RTN","ORWGAPI2",95,0)
 ... S DATE=$O(^PXRMINDX(45,ICD,"PNI",DFN,NUM,ITEM,""),-1)
"RTN","ORWGAPI2",96,0)
 ... I DATE S ^TMP("ORWGRPC TEMP",$J,ITEM,DATE)=""
"RTN","ORWGAPI2",97,0)
 .. I FMT=0 D
"RTN","ORWGAPI2",98,0)
 ... S CNT=CNT+1
"RTN","ORWGAPI2",99,0)
 ... S OK=1
"RTN","ORWGAPI2",100,0)
 ... S RESULT=FILE_U_ITEM_U_$$EVALUE^ORWGAPIU(ITEM,45_";"_ICD,.01)
"RTN","ORWGAPI2",101,0)
 .. I OK D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPI2",102,0)
 I FMT=3 D
"RTN","ORWGAPI2",103,0)
 . S ITEM=""
"RTN","ORWGAPI2",104,0)
 . F  S ITEM=$O(^TMP("ORWGRPC TEMP",$J,ITEM)) Q:ITEM=""  D
"RTN","ORWGAPI2",105,0)
 .. S DATE=$O(^TMP("ORWGRPC TEMP",$J,ITEM,""),-1)
"RTN","ORWGAPI2",106,0)
 .. I 'DATE Q
"RTN","ORWGAPI2",107,0)
 .. S CNT=CNT+1
"RTN","ORWGAPI2",108,0)
 .. S RESULT=FILE_U_ITEM_"^^"_$$EVALUE^ORWGAPIU(ITEM,45_";"_ICD,.01)_"^^"_DATE
"RTN","ORWGAPI2",109,0)
 .. D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPI2",110,0)
 K ^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPI2",111,0)
 Q
"RTN","ORWGAPI2",112,0)
 ;
"RTN","ORWGAPI3")
0^116^B30105389
"RTN","ORWGAPI3",1,0)
ORWGAPI3 ; SLC/STAFF - Graph Data ;12/21/05  08:17
"RTN","ORWGAPI3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,243**;Dec 17, 1997;Build 242
"RTN","ORWGAPI3",3,0)
 ;
"RTN","ORWGAPI3",4,0)
 ; 
"RTN","ORWGAPI3",5,0)
ADVERSE(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPI3",6,0)
 N ADVERSE,DATE,DATE2,NODE,RESULT,RXN,VALUE
"RTN","ORWGAPI3",7,0)
 S DATE="",DATE2="",CNT=$G(CNT),BACKTO=+$G(BACKTO)
"RTN","ORWGAPI3",8,0)
 S ADVERSE=""
"RTN","ORWGAPI3",9,0)
 S VALUE=ITEM_U_ITEM
"RTN","ORWGAPI3",10,0)
 S NODE=""
"RTN","ORWGAPI3",11,0)
 F  S NODE=$O(^GMR(120.8,"B",DFN,NODE)) Q:NODE=""  D
"RTN","ORWGAPI3",12,0)
 . I '$D(^GMR(120.8,NODE,0)) Q
"RTN","ORWGAPI3",13,0)
 . I $G(^GMR(120.8,NODE,"ER")) Q  ; entered in error
"RTN","ORWGAPI3",14,0)
 . I '$P(^GMR(120.8,NODE,0),U,12) Q  ; signed
"RTN","ORWGAPI3",15,0)
 . S DATE=+$P($G(^GMR(120.8,NODE,0)),U,4) I 'DATE Q
"RTN","ORWGAPI3",16,0)
 . I DATE>START Q
"RTN","ORWGAPI3",17,0)
 . I DATE<BACKTO Q
"RTN","ORWGAPI3",18,0)
 . I ITEM'=$P(^GMR(120.8,NODE,0),U,2) Q
"RTN","ORWGAPI3",19,0)
 . S RXN=0
"RTN","ORWGAPI3",20,0)
 . F  S RXN=$O(^GMR(120.8,NODE,10,"B",RXN)) Q:RXN<1  D
"RTN","ORWGAPI3",21,0)
 .. S ADVERSE=ADVERSE_$$EVALUE^ORWGAPIU(RXN,120.8)_", "
"RTN","ORWGAPI3",22,0)
 . I $L(ADVERSE)>0 S ADVERSE=$E(ADVERSE,1,$L(ADVERSE)-2)
"RTN","ORWGAPI3",23,0)
 . S CNT=CNT+1
"RTN","ORWGAPI3",24,0)
 . S RESULT=120.8_U_ITEM_U_DATE_U_DATE2_U_ADVERSE
"RTN","ORWGAPI3",25,0)
 . D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI3",26,0)
 Q
"RTN","ORWGAPI3",27,0)
 ;
"RTN","ORWGAPI3",28,0)
DX(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPI3",29,0)
 N DATE,DATE2,NODE,NUM,RESULT,VALUE,VALUES K VALUE
"RTN","ORWGAPI3",30,0)
 K ^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPI3",31,0)
 S DATE2="",CNT=$G(CNT),BACKTO=+$G(BACKTO)
"RTN","ORWGAPI3",32,0)
 S NUM=""
"RTN","ORWGAPI3",33,0)
 F  S NUM=$O(^PXRMINDX(45,"ICD9","PNI",DFN,NUM)) Q:NUM=""  D
"RTN","ORWGAPI3",34,0)
 . S DATE=""
"RTN","ORWGAPI3",35,0)
 . F  S DATE=$O(^PXRMINDX(45,"ICD9","PNI",DFN,NUM,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI3",36,0)
 .. I DATE>START Q
"RTN","ORWGAPI3",37,0)
 .. I DATE<BACKTO Q
"RTN","ORWGAPI3",38,0)
 .. S NODE=""
"RTN","ORWGAPI3",39,0)
 .. F  S NODE=$O(^PXRMINDX(45,"ICD9","PNI",DFN,NUM,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI3",40,0)
 ... I '$D(^TMP("ORWGRPC TEMP",$J,ITEM,DATE)) S ^TMP("ORWGRPC TEMP",$J,ITEM,DATE)=NODE_U_NUM
"RTN","ORWGAPI3",41,0)
 S ITEM=""
"RTN","ORWGAPI3",42,0)
 F  S ITEM=$O(^TMP("ORWGRPC TEMP",$J,ITEM)) Q:ITEM=""  D
"RTN","ORWGAPI3",43,0)
 . S DATE=""
"RTN","ORWGAPI3",44,0)
 . F  S DATE=$O(^TMP("ORWGRPC TEMP",$J,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI3",45,0)
 .. S NODE=$G(^TMP("ORWGRPC TEMP",$J,ITEM,DATE)) I '$L(NODE) Q
"RTN","ORWGAPI3",46,0)
 .. S NUM=$P(NODE,U,2)
"RTN","ORWGAPI3",47,0)
 .. S NODE=$P(NODE,U)
"RTN","ORWGAPI3",48,0)
 .. I '$L($G(^DGPT(+NODE,0))) Q  ; ****** remove this when PTF patch is released **********
"RTN","ORWGAPI3",49,0)
 .. D PTF^ORWGAPIA(NODE,.VALUE,.VALUES) S VALUE=$$EXT^ORWGAPIX($G(VALUE("DISCHARGE STATUS")),45,6)
"RTN","ORWGAPI3",50,0)
 .. I NUM="DXLS" S VALUE="(DXLS)  "_VALUE_U_U_VALUES ;*****************************
"RTN","ORWGAPI3",51,0)
 .. S RESULT=45_"DX"_U_ITEM_U_DATE_U_DATE2_U_"  "_VALUE
"RTN","ORWGAPI3",52,0)
 .. D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI3",53,0)
 K ^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPI3",54,0)
 Q
"RTN","ORWGAPI3",55,0)
 ;
"RTN","ORWGAPI3",56,0)
LAB(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPI3",57,0)
 N COMMENT,DATE,DATE2,NODE,RESULT,TYPE,VALUE K VALUE
"RTN","ORWGAPI3",58,0)
 S DATE="",DATE2="",CNT=$G(CNT),BACKTO=+$G(BACKTO)
"RTN","ORWGAPI3",59,0)
 D
"RTN","ORWGAPI3",60,0)
 . I $E(ITEM)="A" S TYPE="AP" Q
"RTN","ORWGAPI3",61,0)
 . I $E(ITEM)="M" S TYPE="MI" Q
"RTN","ORWGAPI3",62,0)
 . S TYPE="" Q
"RTN","ORWGAPI3",63,0)
 F  S DATE=$O(^PXRMINDX(63,"PI",DFN,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI3",64,0)
 . I DATE>START Q
"RTN","ORWGAPI3",65,0)
 . I DATE<BACKTO Q
"RTN","ORWGAPI3",66,0)
 . S NODE=""
"RTN","ORWGAPI3",67,0)
 . F  S NODE=$O(^PXRMINDX(63,"PI",DFN,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI3",68,0)
 .. K VALUE
"RTN","ORWGAPI3",69,0)
 .. D LAB^ORWGAPIC(.VALUE,NODE,ITEM)
"RTN","ORWGAPI3",70,0)
 .. I TYPE="AP" S RESULT="63AP^"_ITEM_U_DATE_U_DATE2 ;_U_$P(VALUE,U,2)
"RTN","ORWGAPI3",71,0)
 .. I TYPE="MI" S RESULT="63MI^"_ITEM_U_DATE_U_DATE2_U_$P(VALUE,U,4)
"RTN","ORWGAPI3",72,0)
 .. I TYPE="" D
"RTN","ORWGAPI3",73,0)
 ... S COMMENT=""
"RTN","ORWGAPI3",74,0)
 ... I $L($G(VALUE("COMMENTS",1))) S COMMENT=1
"RTN","ORWGAPI3",75,0)
 ... S RESULT="63^"_ITEM_U_DATE_U_DATE2_U_$P(VALUE,U,3)_U_$P(VALUE,U,4)_U_$G(VALUE("SPECIMEN"))_U_COMMENT
"RTN","ORWGAPI3",76,0)
 .. D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI3",77,0)
 Q
"RTN","ORWGAPI3",78,0)
 ;
"RTN","ORWGAPI3",79,0)
MED(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPI3",80,0)
 D MED3^ORWGAPIE(.DATA,ITEM,START,DFN,.CNT,.TMP)
"RTN","ORWGAPI3",81,0)
 Q
"RTN","ORWGAPI3",82,0)
 ;
"RTN","ORWGAPI3",83,0)
NOTE(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPI3",84,0)
 N DATE,DOC,DOCCLASS,DOCTYPE,DUM,IEN,RESULT,RESULTS,TITLE,VALUE K DUM
"RTN","ORWGAPI3",85,0)
 K ^TMP("ORWGRPC TEMP",$J),^TMP("TIUR",$J)
"RTN","ORWGAPI3",86,0)
 S CNT=$G(CNT),ITEM=$$UP^ORWGAPIX(ITEM),BACKTO=+$G(BACKTO)
"RTN","ORWGAPI3",87,0)
 F DOCTYPE="P","D","C" D
"RTN","ORWGAPI3",88,0)
 . S DOCCLASS=$$DOCCLASS^ORWGAPIA(DOCTYPE)
"RTN","ORWGAPI3",89,0)
 . K ^TMP("TIUR",$J)
"RTN","ORWGAPI3",90,0)
 . D TIU^ORWGAPIA(.DUM,DOCCLASS,5,DFN)
"RTN","ORWGAPI3",91,0)
 . S DOC=0
"RTN","ORWGAPI3",92,0)
 . F  S DOC=$O(^TMP("TIUR",$J,DOC)) Q:DOC<1  D
"RTN","ORWGAPI3",93,0)
 .. S RESULTS=^TMP("TIUR",$J,DOC)
"RTN","ORWGAPI3",94,0)
 .. S IEN=+$P(RESULTS,U)
"RTN","ORWGAPI3",95,0)
 .. S TITLE=$$UP^ORWGAPIX($P(RESULTS,U,2))
"RTN","ORWGAPI3",96,0)
 .. I TITLE'=ITEM Q
"RTN","ORWGAPI3",97,0)
 .. ; do not use admission date S DATE=$P($G(^AUPNVSIT(+$P($G(^TIU(8925,IEN,0)),U,3),0)),U)
"RTN","ORWGAPI3",98,0)
 .. S DATE=$P(RESULTS,U,3)
"RTN","ORWGAPI3",99,0)
 .. I DATE>START Q
"RTN","ORWGAPI3",100,0)
 .. I DATE<BACKTO Q
"RTN","ORWGAPI3",101,0)
 .. S VALUE=$P(RESULTS,U,7)
"RTN","ORWGAPI3",102,0)
 .. S CNT=CNT+1
"RTN","ORWGAPI3",103,0)
 .. S RESULT=8925_U_TITLE_U_DATE_"^^"_VALUE
"RTN","ORWGAPI3",104,0)
 .. I $D(^TMP("ORWGRPC TEMP",$J,RESULT)) Q
"RTN","ORWGAPI3",105,0)
 .. S ^TMP("ORWGRPC TEMP",$J,RESULT)=""
"RTN","ORWGAPI3",106,0)
 .. D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI3",107,0)
 K ^TMP("ORWGRPC TEMP",$J),^TMP("TIUR",$J)
"RTN","ORWGAPI3",108,0)
 Q
"RTN","ORWGAPI3",109,0)
 ;
"RTN","ORWGAPI3",110,0)
ORDER(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPI3",111,0)
 N DATE,DATE2,NODE,ORUPCHUK,RESULT,VALUE K ORUPCHUK
"RTN","ORWGAPI3",112,0)
 S DATE="",CNT=$G(CNT),BACKTO=+$G(BACKTO)
"RTN","ORWGAPI3",113,0)
 F  S DATE=$O(^PXRMINDX(100,"PI",DFN,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI3",114,0)
 . I DATE>START Q
"RTN","ORWGAPI3",115,0)
 . I DATE<BACKTO Q
"RTN","ORWGAPI3",116,0)
 . S DATE2=""
"RTN","ORWGAPI3",117,0)
 . F  S DATE2=$O(^PXRMINDX(100,"PI",DFN,ITEM,DATE,DATE2)) Q:DATE2=""  D
"RTN","ORWGAPI3",118,0)
 .. S NODE=""
"RTN","ORWGAPI3",119,0)
 .. F  S NODE=$O(^PXRMINDX(100,"PI",DFN,ITEM,DATE,DATE2,NODE)) Q:NODE=""  D
"RTN","ORWGAPI3",120,0)
 ... D EN^ORX8($P(NODE,";")) S VALUE=$P($G(ORUPCHUK("ORSTS")),U,2)
"RTN","ORWGAPI3",121,0)
 ... S RESULT=100_U_ITEM_U_DATE_"^^"_VALUE
"RTN","ORWGAPI3",122,0)
 ... D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI3",123,0)
 Q
"RTN","ORWGAPI3",124,0)
 ;
"RTN","ORWGAPI3",125,0)
RAD(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPI3",126,0)
 N DATE,DATE2,NODE,RESULT,VALUE,VALUES K VALUE
"RTN","ORWGAPI3",127,0)
 S DATE="",DATE2="",CNT=$G(CNT),BACKTO=+$G(BACKTO)
"RTN","ORWGAPI3",128,0)
 F  S DATE=$O(^PXRMINDX(70,"PI",DFN,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI3",129,0)
 . I DATE>START Q
"RTN","ORWGAPI3",130,0)
 . I DATE<BACKTO Q
"RTN","ORWGAPI3",131,0)
 . S NODE=""
"RTN","ORWGAPI3",132,0)
 . F  S NODE=$O(^PXRMINDX(70,"PI",DFN,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI3",133,0)
 .. D RAD^ORWGAPIA(NODE,.VALUE,.VALUES) S VALUE=$G(VALUE("PDX"))_"-"_$G(VALUE("EXAM STATUS"))_U_U_VALUES
"RTN","ORWGAPI3",134,0)
 .. S RESULT=70_U_ITEM_U_DATE_U_DATE2_U_VALUE
"RTN","ORWGAPI3",135,0)
 .. D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI3",136,0)
 Q
"RTN","ORWGAPI3",137,0)
 ;
"RTN","ORWGAPI4")
0^117^B60283342
"RTN","ORWGAPI4",1,0)
ORWGAPI4 ; SLC/STAFF - Graph Data, indexed ;8/21/06  07:52
"RTN","ORWGAPI4",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,260,243**;Dec 17, 1997;Build 242
"RTN","ORWGAPI4",3,0)
 ;
"RTN","ORWGAPI4",4,0)
EDU(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPI4",5,0)
 N DATE,DATE2,NODE,RESULT,VALUE,VALUES K VALUE
"RTN","ORWGAPI4",6,0)
 S DATE="",DATE2="",CNT=$G(CNT),BACKTO=+$G(BACKTO)
"RTN","ORWGAPI4",7,0)
 F  S DATE=$O(^PXRMINDX(9000010.16,"PI",DFN,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI4",8,0)
 . I DATE>START Q
"RTN","ORWGAPI4",9,0)
 . I DATE<BACKTO Q
"RTN","ORWGAPI4",10,0)
 . S NODE=""
"RTN","ORWGAPI4",11,0)
 . F  S NODE=$O(^PXRMINDX(9000010.16,"PI",DFN,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI4",12,0)
 .. D EDU^ORWGAPIA(NODE,.VALUE,.VALUES)
"RTN","ORWGAPI4",13,0)
 .. S VALUE=VALUE("VALUE"),VALUE=VALUE_U_$$EVALUE^ORWGAPIU(VALUE,9000010.16,.06)_U_VALUES ;*****************************
"RTN","ORWGAPI4",14,0)
 .. S RESULT=9000010.16_U_ITEM_U_DATE_"^^" ;_VALUE
"RTN","ORWGAPI4",15,0)
 .. S RESULT=9000010.16_U_ITEM_U_DATE_U_DATE2_U ;_VALUE
"RTN","ORWGAPI4",16,0)
 .. D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI4",17,0)
 Q
"RTN","ORWGAPI4",18,0)
 ;
"RTN","ORWGAPI4",19,0)
EXAM(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPI4",20,0)
 N DATE,DATE2,NODE,RESULT,VALUE,VALUES K VALUE
"RTN","ORWGAPI4",21,0)
 S DATE="",DATE2="",CNT=$G(CNT),BACKTO=+$G(BACKTO)
"RTN","ORWGAPI4",22,0)
 F  S DATE=$O(^PXRMINDX(9000010.13,"PI",DFN,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI4",23,0)
 . I DATE>START Q
"RTN","ORWGAPI4",24,0)
 . I DATE<BACKTO Q
"RTN","ORWGAPI4",25,0)
 . S NODE=""
"RTN","ORWGAPI4",26,0)
 . F  S NODE=$O(^PXRMINDX(9000010.13,"PI",DFN,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI4",27,0)
 .. D EXAM^ORWGAPIA(NODE,.VALUE,.VALUES)
"RTN","ORWGAPI4",28,0)
 .. S VALUE=$G(VALUE("VALUE")),VALUE=VALUE_U_$$EVALUE^ORWGAPIU(VALUE,9000010.13,.04)_U_VALUES ;*****************************
"RTN","ORWGAPI4",29,0)
 .. S RESULT=9000010.13_U_ITEM_U_DATE_U_DATE2_U_VALUE
"RTN","ORWGAPI4",30,0)
 .. D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI4",31,0)
 Q
"RTN","ORWGAPI4",32,0)
 ;
"RTN","ORWGAPI4",33,0)
HF(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPI4",34,0)
 N DATE,DATE2,NODE,RESULT,VALUE,VALUES K VALUE
"RTN","ORWGAPI4",35,0)
 S DATE="",DATE2="",CNT=$G(CNT),BACKTO=+$G(BACKTO)
"RTN","ORWGAPI4",36,0)
 F  S DATE=$O(^PXRMINDX(9000010.23,"PI",DFN,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI4",37,0)
 . I DATE>START Q
"RTN","ORWGAPI4",38,0)
 . I DATE<BACKTO Q
"RTN","ORWGAPI4",39,0)
 . S NODE=""
"RTN","ORWGAPI4",40,0)
 . F  S NODE=$O(^PXRMINDX(9000010.23,"PI",DFN,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI4",41,0)
 .. D HF^ORWGAPIA(NODE,.VALUE,.VALUES)
"RTN","ORWGAPI4",42,0)
 .. S VALUE=VALUE("VALUE"),VALUE=VALUE_U_$$EVALUE^ORWGAPIU(VALUE,9000010.23,.04)_U_VALUES ;*****************************
"RTN","ORWGAPI4",43,0)
 .. S RESULT=9000010.23_U_ITEM_U_DATE_U_DATE2_U_VALUE
"RTN","ORWGAPI4",44,0)
 .. D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI4",45,0)
 Q
"RTN","ORWGAPI4",46,0)
 ;
"RTN","ORWGAPI4",47,0)
IMM(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPI4",48,0)
 N DATE,DATE2,NODE,RESULT,VALUE,VALUES K VALUE
"RTN","ORWGAPI4",49,0)
 S DATE="",DATE2="",CNT=$G(CNT),BACKTO=+$G(BACKTO)
"RTN","ORWGAPI4",50,0)
 F  S DATE=$O(^PXRMINDX(9000010.11,"PI",DFN,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI4",51,0)
 . I DATE>START Q
"RTN","ORWGAPI4",52,0)
 . I DATE<BACKTO Q
"RTN","ORWGAPI4",53,0)
 . S NODE=""
"RTN","ORWGAPI4",54,0)
 . F  S NODE=$O(^PXRMINDX(9000010.11,"PI",DFN,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI4",55,0)
 .. D IMM^ORWGAPIA(NODE,.VALUE,.VALUES)
"RTN","ORWGAPI4",56,0)
 .. S VALUE=$G(VALUE("VALUE")),VALUE=VALUE_U_$$EVALUE^ORWGAPIU(VALUE,9000010.11,.04)_U_VALUES ;*****************************
"RTN","ORWGAPI4",57,0)
 .. S CNT=CNT+1
"RTN","ORWGAPI4",58,0)
 .. S RESULT=9000010.11_U_ITEM_U_DATE_U_DATE2_U_VALUE
"RTN","ORWGAPI4",59,0)
 .. D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI4",60,0)
 Q
"RTN","ORWGAPI4",61,0)
 ;
"RTN","ORWGAPI4",62,0)
MH(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPI4",63,0)
 N DATE,DATE2,NODE,RESULT,VALUE,VALUES K VALUE
"RTN","ORWGAPI4",64,0)
 S DATE="",DATE2="",CNT=$G(CNT),BACKTO=+$G(BACKTO)
"RTN","ORWGAPI4",65,0)
 F  S DATE=$O(^PXRMINDX(601.2,"PI",DFN,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI4",66,0)
 . I DATE>START Q
"RTN","ORWGAPI4",67,0)
 . I DATE<BACKTO Q
"RTN","ORWGAPI4",68,0)
 . S NODE=""
"RTN","ORWGAPI4",69,0)
 . F  S NODE=$O(^PXRMINDX(601.2,"PI",DFN,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI4",70,0)
 .. D MH^ORWGAPIA(.VALUE,NODE,.VALUES) S VALUE=$P($G(VALUE(2)),U,2,3)_U_VALUES ;*****************************
"RTN","ORWGAPI4",71,0)
 .. S RESULT=601.2_U_ITEM_U_DATE_U_DATE2_U ;_VALUE
"RTN","ORWGAPI4",72,0)
 .. D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI4",73,0)
 Q
"RTN","ORWGAPI4",74,0)
 ;
"RTN","ORWGAPI4",75,0)
OP(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPI4",76,0)
 N DATE,DATE2,NODE,NUM,RESULT,VALUE,VALUES K VALUE
"RTN","ORWGAPI4",77,0)
 S DATE2="",CNT=$G(CNT),BACKTO=+$G(BACKTO),VALUES=""
"RTN","ORWGAPI4",78,0)
 S NUM=""
"RTN","ORWGAPI4",79,0)
 F  S NUM=$O(^PXRMINDX(45,"ICD0","PNI",DFN,NUM)) Q:NUM=""  D
"RTN","ORWGAPI4",80,0)
 . S DATE=""
"RTN","ORWGAPI4",81,0)
 . F  S DATE=$O(^PXRMINDX(45,"ICD0","PNI",DFN,NUM,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI4",82,0)
 .. I DATE>START Q
"RTN","ORWGAPI4",83,0)
 .. I DATE<BACKTO Q
"RTN","ORWGAPI4",84,0)
 .. S NODE=""
"RTN","ORWGAPI4",85,0)
 .. F  S NODE=$O(^PXRMINDX(45,"ICD0","PNI",DFN,NUM,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI4",86,0)
 ... I '$L($G(^DGPT(+NODE,0))) Q  ; ****** remove this when PTF patch is released **********
"RTN","ORWGAPI4",87,0)
 ... D PTF^ORWGAPIA(NODE,.VALUE,.VALUES) S VALUE=$G(VALUE("DISCHARGE STATUS"))_U_VALUES ;*****************************
"RTN","ORWGAPI4",88,0)
 ... S RESULT=45_"OP"_U_ITEM_U_DATE_U_DATE2_U ;_VALUE
"RTN","ORWGAPI4",89,0)
 ... D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI4",90,0)
 Q
"RTN","ORWGAPI4",91,0)
 ;
"RTN","ORWGAPI4",92,0)
POV(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPI4",93,0)
 N DATE,DATE2,NODE,RESULT,TYPE,VALUE,VALUES K VALUE
"RTN","ORWGAPI4",94,0)
 S DATE2="",CNT=$G(CNT),BACKTO=+$G(BACKTO)
"RTN","ORWGAPI4",95,0)
 S TYPE=""
"RTN","ORWGAPI4",96,0)
 F  S TYPE=$O(^PXRMINDX(9000010.07,"PPI",DFN,TYPE)) Q:TYPE=""  D
"RTN","ORWGAPI4",97,0)
 . S DATE=""
"RTN","ORWGAPI4",98,0)
 . F  S DATE=$O(^PXRMINDX(9000010.07,"PPI",DFN,TYPE,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI4",99,0)
 .. I DATE>START Q
"RTN","ORWGAPI4",100,0)
 .. I DATE<BACKTO Q
"RTN","ORWGAPI4",101,0)
 .. S NODE=""
"RTN","ORWGAPI4",102,0)
 .. F  S NODE=$O(^PXRMINDX(9000010.07,"PPI",DFN,TYPE,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI4",103,0)
 ... D POV^ORWGAPIA(NODE,.VALUE,.VALUES)
"RTN","ORWGAPI4",104,0)
 ... S VALUE=VALUE("CLINICAL TERM"),VALUE=VALUE_U_$$EVALUE^ORWGAPIU(VALUE,9000010.07,.15)_U_VALUES ;*****************************
"RTN","ORWGAPI4",105,0)
 ... S CNT=CNT+1
"RTN","ORWGAPI4",106,0)
 ... S RESULT=9000010.07_U_ITEM_U_DATE_U_DATE2_U_VALUE
"RTN","ORWGAPI4",107,0)
 ... D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI4",108,0)
 Q
"RTN","ORWGAPI4",109,0)
 ;
"RTN","ORWGAPI4",110,0)
PROB(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPI4",111,0)
 N DATE,DATE2,DTONSET,DTRESOLV,ICD9,NODE,PRIORITY,PROB,PROBDX,PSTATUS,RESULT,STATUS,VALUE
"RTN","ORWGAPI4",112,0)
 K ^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPI4",113,0)
 S DATE2="",CNT=$G(CNT),BACKTO=+$G(BACKTO)
"RTN","ORWGAPI4",114,0)
 S STATUS=""
"RTN","ORWGAPI4",115,0)
 F  S STATUS=$O(^PXRMINDX(9000011,"PSPI",DFN,STATUS)) Q:STATUS=""  D
"RTN","ORWGAPI4",116,0)
 . S PRIORITY=""
"RTN","ORWGAPI4",117,0)
 . F  S PRIORITY=$O(^PXRMINDX(9000011,"PSPI",DFN,STATUS,PRIORITY)) Q:PRIORITY=""  D
"RTN","ORWGAPI4",118,0)
 .. S DATE=""
"RTN","ORWGAPI4",119,0)
 .. F  S DATE=$O(^PXRMINDX(9000011,"PSPI",DFN,STATUS,PRIORITY,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI4",120,0)
 ... I DATE>START Q
"RTN","ORWGAPI4",121,0)
 ... I DATE<BACKTO Q
"RTN","ORWGAPI4",122,0)
 ... S NODE=""
"RTN","ORWGAPI4",123,0)
 ... F  S NODE=$O(^PXRMINDX(9000011,"PSPI",DFN,STATUS,PRIORITY,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI4",124,0)
 .... S ^TMP("ORWGRPC TEMP",$J,ITEM,DATE,NODE)=""
"RTN","ORWGAPI4",125,0)
 S ICD9=""
"RTN","ORWGAPI4",126,0)
 F  S ICD9=$O(^TMP("ORWGRPC TEMP",$J,ICD9)) Q:ICD9=""  D
"RTN","ORWGAPI4",127,0)
 . S DATE=""
"RTN","ORWGAPI4",128,0)
 . F  S DATE=$O(^TMP("ORWGRPC TEMP",$J,ICD9,DATE)) Q:DATE=""  D
"RTN","ORWGAPI4",129,0)
 .. S NODE=""
"RTN","ORWGAPI4",130,0)
 .. F  S NODE=$O(^TMP("ORWGRPC TEMP",$J,ICD9,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI4",131,0)
 ... D PROB^ORWGAPIA(.PROB,.PSTATUS,.PROBDX,.DTONSET,.DTRESOLV,NODE)
"RTN","ORWGAPI4",132,0)
 ... S RESULT=9000011_U_ITEM_U_DTONSET_U_DATE2_U_$$EXT^ORWGAPIX(PSTATUS,9000011,.12)
"RTN","ORWGAPI4",133,0)
 ... D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI4",134,0)
 K ^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPI4",135,0)
 Q
"RTN","ORWGAPI4",136,0)
 ;
"RTN","ORWGAPI4",137,0)
PROBX(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPI4",138,0)
 D PROBX4^ORWGAPID(.DATA,ITEM,START,DFN,.CNT,.TMP)
"RTN","ORWGAPI4",139,0)
 Q
"RTN","ORWGAPI4",140,0)
 ;
"RTN","ORWGAPI4",141,0)
PROC(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPI4",142,0)
 N DATE,DATE2,NODE,RESULT,TYPE,VALUE,VALUES K VALUE
"RTN","ORWGAPI4",143,0)
 S DATE2="",CNT=$G(CNT),BACKTO=+$G(BACKTO)
"RTN","ORWGAPI4",144,0)
 S TYPE=""
"RTN","ORWGAPI4",145,0)
 F  S TYPE=$O(^PXRMINDX(9000010.18,"PPI",DFN,TYPE)) Q:TYPE=""  D
"RTN","ORWGAPI4",146,0)
 . S DATE=""
"RTN","ORWGAPI4",147,0)
 . F  S DATE=$O(^PXRMINDX(9000010.18,"PPI",DFN,TYPE,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI4",148,0)
 .. I DATE>START Q
"RTN","ORWGAPI4",149,0)
 .. I DATE<BACKTO Q
"RTN","ORWGAPI4",150,0)
 .. S NODE=""
"RTN","ORWGAPI4",151,0)
 .. F  S NODE=$O(^PXRMINDX(9000010.18,"PPI",DFN,TYPE,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI4",152,0)
 ... D CPT^ORWGAPIA(NODE,.VALUE,.VALUES)
"RTN","ORWGAPI4",153,0)
 ... S VALUE=VALUE("PRINCIPAL PROCEDURE"),VALUE=VALUE_U_$$EVALUE^ORWGAPIU(VALUE,9000010.18,.07)_U_VALUES ;*****************************
"RTN","ORWGAPI4",154,0)
 ... S RESULT=9000010.18_U_ITEM_U_DATE_U_DATE2_U_VALUE
"RTN","ORWGAPI4",155,0)
 ... D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI4",156,0)
 Q
"RTN","ORWGAPI4",157,0)
 ;
"RTN","ORWGAPI4",158,0)
SKIN(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPI4",159,0)
 N DATE,DATE2,NODE,RESULT,VALUE,VALUES K VALUE
"RTN","ORWGAPI4",160,0)
 S DATE="",DATE2="",CNT=$G(CNT),BACKTO=+$G(BACKTO)
"RTN","ORWGAPI4",161,0)
 F  S DATE=$O(^PXRMINDX(9000010.12,"PI",DFN,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI4",162,0)
 . I DATE>START Q
"RTN","ORWGAPI4",163,0)
 . I DATE<BACKTO Q
"RTN","ORWGAPI4",164,0)
 . S NODE=""
"RTN","ORWGAPI4",165,0)
 . F  S NODE=$O(^PXRMINDX(9000010.12,"PI",DFN,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI4",166,0)
 .. D SKIN^ORWGAPIA(NODE,.VALUE,.VALUES)
"RTN","ORWGAPI4",167,0)
 .. S VALUE=$G(VALUE("VALUE")),VALUE=VALUE_U_$$EVALUE^ORWGAPIU(VALUE,9000010.12,.04)_U_VALUES ;*****************************
"RTN","ORWGAPI4",168,0)
 .. S CNT=CNT+1
"RTN","ORWGAPI4",169,0)
 .. S RESULT=9000010.12_U_ITEM_U_DATE_U_DATE2_U_VALUE
"RTN","ORWGAPI4",170,0)
 .. D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI4",171,0)
 Q
"RTN","ORWGAPI4",172,0)
 ;
"RTN","ORWGAPI4",173,0)
VITAL(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPI4",174,0)
 I ITEM=99999 D BMIDATA^ORWGAPIX(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPI4",175,0)
 N DATE,DATE2,NODE,RESULT,VALUE,VALUES K VALUE
"RTN","ORWGAPI4",176,0)
 S DATE="",DATE2="",CNT=$G(CNT),BACKTO=+$G(BACKTO)
"RTN","ORWGAPI4",177,0)
 F  S DATE=$O(^PXRMINDX(120.5,"PI",DFN,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI4",178,0)
 . I DATE>START Q
"RTN","ORWGAPI4",179,0)
 . I DATE<BACKTO Q
"RTN","ORWGAPI4",180,0)
 . S NODE=""
"RTN","ORWGAPI4",181,0)
 . F  S NODE=$O(^PXRMINDX(120.5,"PI",DFN,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI4",182,0)
 .. D VITAL^ORWGAPIA(.VALUE,NODE,.VALUES) S VALUE=$P($G(VALUE(7)),U)
"RTN","ORWGAPI4",183,0)
 .. I $P($G(VALUE(3)),U,2)="PAIN",VALUE=99 S VALUE="(99)"
"RTN","ORWGAPI4",184,0)
 .. S RESULT=120.5_U_ITEM_U_DATE_U_DATE2_U_VALUE_U_U_VALUES ;*****************************
"RTN","ORWGAPI4",185,0)
 .. D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI4",186,0)
 Q
"RTN","ORWGAPI4",187,0)
 ;
"RTN","ORWGAPI5")
0^118^B9504422
"RTN","ORWGAPI5",1,0)
ORWGAPI5 ; SLC/STAFF - Graph Items, Meds ;12/21/05  08:15
"RTN","ORWGAPI5",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORWGAPI5",3,0)
 ;
"RTN","ORWGAPI5",4,0)
BCMA(ITEMS,DFN,FMT,OLDEST,NEWEST,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI5",5,0)
 N DATE,DRUG,ITEM,NUM,RESULT
"RTN","ORWGAPI5",6,0)
 K ^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPI5",7,0)
 I FMT=6 D
"RTN","ORWGAPI5",8,0)
 . S DATE=OLDEST
"RTN","ORWGAPI5",9,0)
 . F  S DATE=$O(^PSB(53.79,"AADT",DFN,DATE)) Q:DATE<1  Q:DATE>NEWEST  D
"RTN","ORWGAPI5",10,0)
 .. S NUM=0
"RTN","ORWGAPI5",11,0)
 .. F  S NUM=$O(^PSB(53.79,"AADT",DFN,DATE,NUM)) Q:NUM<1  D
"RTN","ORWGAPI5",12,0)
 ... S ITEM=$P($G(^PSB(53.79,NUM,0)),U,8) I 'ITEM Q
"RTN","ORWGAPI5",13,0)
 ... I $D(^TMP("ORWGRPC TEMP",$J,ITEM)) Q
"RTN","ORWGAPI5",14,0)
 ... S ^TMP("ORWGRPC TEMP",$J,ITEM)=""
"RTN","ORWGAPI5",15,0)
 ... S CNT=CNT+1
"RTN","ORWGAPI5",16,0)
 ... S RESULT="53.79^"_ITEM
"RTN","ORWGAPI5",17,0)
 ... D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPI5",18,0)
 I FMT'=6 D
"RTN","ORWGAPI5",19,0)
 . S ITEM=""
"RTN","ORWGAPI5",20,0)
 . F  S ITEM=$O(^PSB(53.79,"AOIP",DFN,ITEM)) Q:ITEM=""  D
"RTN","ORWGAPI5",21,0)
 .. S DATE=$O(^PSB(53.79,"AOIP",DFN,ITEM,""),-1)
"RTN","ORWGAPI5",22,0)
 .. I 'DATE Q
"RTN","ORWGAPI5",23,0)
 .. S NUM=$O(^PSB(53.79,"AOIP",DFN,ITEM,DATE,""),-1)
"RTN","ORWGAPI5",24,0)
 .. I 'NUM Q
"RTN","ORWGAPI5",25,0)
 .. S CNT=CNT+1
"RTN","ORWGAPI5",26,0)
 .. I FMT=3 S RESULT="53.79^"_ITEM_"^^"_$$POINAME^ORWGAPIC(ITEM)_"^^"_DATE
"RTN","ORWGAPI5",27,0)
 .. I FMT=0 S RESULT="53.79^"_ITEM_U_$$POINAME^ORWGAPIC(ITEM)
"RTN","ORWGAPI5",28,0)
 .. S DRUG=$$DRUG^ORWGAPIC(NUM)
"RTN","ORWGAPI5",29,0)
 .. I DRUG S RESULT=RESULT_U_$$DRGCLASS^ORWGAPIC(DRUG)
"RTN","ORWGAPI5",30,0)
 .. D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPI5",31,0)
 K ^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPI5",32,0)
 Q
"RTN","ORWGAPI5",33,0)
 ;
"RTN","ORWGAPI5",34,0)
DC(ITEMS,DFN,FMT,OLDEST,NEWEST,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI5",35,0)
 ; FMT,OLDEST,NEWEST not used
"RTN","ORWGAPI5",36,0)
 N DATA,DATE,DATE1,DRUG,ITEM,FILE,NUM,REF,RESULT K DATA
"RTN","ORWGAPI5",37,0)
 K ^TMP("ORWGRPC DC",$J)
"RTN","ORWGAPI5",38,0)
 F FILE=52,55 D
"RTN","ORWGAPI5",39,0)
 . S ITEM=""
"RTN","ORWGAPI5",40,0)
 . F  S ITEM=$O(^PXRMINDX(FILE,"PI",DFN,ITEM)) Q:ITEM=""  D
"RTN","ORWGAPI5",41,0)
 .. S RESULT=$$DRGCLASS^ORWGAPIC(ITEM)
"RTN","ORWGAPI5",42,0)
 .. I RESULT="" Q
"RTN","ORWGAPI5",43,0)
 .. S RESULT="50.605^"_RESULT
"RTN","ORWGAPI5",44,0)
 .. S ^TMP("ORWGRPC DC",$J,RESULT)=""
"RTN","ORWGAPI5",45,0)
 S ITEM=""
"RTN","ORWGAPI5",46,0)
 F  S ITEM=$O(^PSB(53.79,"AOIP",DFN,ITEM)) Q:ITEM=""  D
"RTN","ORWGAPI5",47,0)
 . S DATE=$O(^PSB(53.79,"AOIP",DFN,ITEM,""),-1)
"RTN","ORWGAPI5",48,0)
 . I 'DATE Q
"RTN","ORWGAPI5",49,0)
 . S NUM=$O(^PSB(53.79,"AOIP",DFN,ITEM,DATE,""),-1)
"RTN","ORWGAPI5",50,0)
 . I 'NUM Q
"RTN","ORWGAPI5",51,0)
 . S DRUG=$$DRUG^ORWGAPIC(NUM)
"RTN","ORWGAPI5",52,0)
 . I 'DRUG Q
"RTN","ORWGAPI5",53,0)
 . S RESULT=$$DRGCLASS^ORWGAPIC(DRUG)
"RTN","ORWGAPI5",54,0)
 . I 'RESULT Q
"RTN","ORWGAPI5",55,0)
 . S RESULT="50.605^"_RESULT
"RTN","ORWGAPI5",56,0)
 . S ^TMP("ORWGRPC DC",$J,RESULT)=""
"RTN","ORWGAPI5",57,0)
 S ITEM=""
"RTN","ORWGAPI5",58,0)
 F  S ITEM=$O(^PXRMINDX("55NVA","PI",DFN,ITEM)) Q:ITEM=""  D
"RTN","ORWGAPI5",59,0)
 . S DATE=$O(^PXRMINDX("55NVA","PI",DFN,ITEM,""),-1)
"RTN","ORWGAPI5",60,0)
 . I 'DATE Q
"RTN","ORWGAPI5",61,0)
 . S DATE1=$O(^PXRMINDX("55NVA","PI",DFN,ITEM,DATE,""),-1)
"RTN","ORWGAPI5",62,0)
 . I '$L(DATE1) Q
"RTN","ORWGAPI5",63,0)
 . S REF=$O(^PXRMINDX("55NVA","PI",DFN,ITEM,DATE,DATE1,""),-1)
"RTN","ORWGAPI5",64,0)
 . I '$L(REF) Q
"RTN","ORWGAPI5",65,0)
 . D RXNVA^ORWGAPIC(REF,.DATA)
"RTN","ORWGAPI5",66,0)
 . S DRUG=+$G(DATA("DISPENSE DRUG"))
"RTN","ORWGAPI5",67,0)
 . I 'DRUG Q
"RTN","ORWGAPI5",68,0)
 . S RESULT=$$DRGCLASS^ORWGAPIC(DRUG)
"RTN","ORWGAPI5",69,0)
 . I 'RESULT Q
"RTN","ORWGAPI5",70,0)
 . S RESULT="50.605^"_RESULT
"RTN","ORWGAPI5",71,0)
 . S ^TMP("ORWGRPC DC",$J,RESULT)=""
"RTN","ORWGAPI5",72,0)
 S RESULT=""
"RTN","ORWGAPI5",73,0)
 F  S RESULT=$O(^TMP("ORWGRPC DC",$J,RESULT)) Q:RESULT=""  S CNT=CNT+1 D
"RTN","ORWGAPI5",74,0)
 . D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPI5",75,0)
 K ^TMP("ORWGRPC DC",$J)
"RTN","ORWGAPI5",76,0)
 Q
"RTN","ORWGAPI5",77,0)
 ;
"RTN","ORWGAPI5",78,0)
NVA(ITEMS,DFN,FMT,OLDEST,NEWEST,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI5",79,0)
 D NVA1^ORWGAPIE(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,.TMP)
"RTN","ORWGAPI5",80,0)
 Q
"RTN","ORWGAPI5",81,0)
 ;
"RTN","ORWGAPI6")
0^119^B16567335
"RTN","ORWGAPI6",1,0)
ORWGAPI6 ; SLC/STAFF - Graph API Items, non-indexed ;12/21/05  08:16
"RTN","ORWGAPI6",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORWGAPI6",3,0)
 ;
"RTN","ORWGAPI6",4,0)
ADMITS(ITEMS,DFN,FMT,OLDEST,NEWEST,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI6",5,0)
 N DATE,DATE2,DISCH,LINE,LST,NUM,OK,RESULT K LST
"RTN","ORWGAPI6",6,0)
 K ^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPI6",7,0)
 D ADMITLST^ORWPT(.LST,DFN)
"RTN","ORWGAPI6",8,0)
 S OK=0
"RTN","ORWGAPI6",9,0)
 S NUM=0
"RTN","ORWGAPI6",10,0)
 F  S NUM=$O(LST(NUM)) Q:NUM<1  D  Q:OK
"RTN","ORWGAPI6",11,0)
 . S LINE=LST(NUM)
"RTN","ORWGAPI6",12,0)
 . S DATE=$P(LINE,U)
"RTN","ORWGAPI6",13,0)
 . S DISCH=$P(LINE,U,5)
"RTN","ORWGAPI6",14,0)
 . S DATE2=$$DISCH^ORWGAPIA(DISCH)
"RTN","ORWGAPI6",15,0)
 . I DATE2="" S DATE2=DATE2\1
"RTN","ORWGAPI6",16,0)
 . I FMT=6 D  Q
"RTN","ORWGAPI6",17,0)
 .. I DATE>NEWEST Q
"RTN","ORWGAPI6",18,0)
 .. I DATE2>0,DATE2<OLDEST Q
"RTN","ORWGAPI6",19,0)
 .. I $D(^TMP("ORWGRPC TEMP",$J,"ADMIT")) Q
"RTN","ORWGAPI6",20,0)
 .. S ^TMP("ORWGRPC TEMP",$J,"ADMIT")=""
"RTN","ORWGAPI6",21,0)
 .. S CNT=CNT+1
"RTN","ORWGAPI6",22,0)
 .. S OK=1
"RTN","ORWGAPI6",23,0)
 .. S RESULT="405^ADMIT"
"RTN","ORWGAPI6",24,0)
 . I FMT=3 D  Q
"RTN","ORWGAPI6",25,0)
 .. I $D(^TMP("ORWGRPC TEMP",$J,"ADMIT")) Q
"RTN","ORWGAPI6",26,0)
 .. S ^TMP("ORWGRPC TEMP",$J,"ADMIT")=""
"RTN","ORWGAPI6",27,0)
 .. S CNT=CNT+1
"RTN","ORWGAPI6",28,0)
 .. S OK=1
"RTN","ORWGAPI6",29,0)
 .. S RESULT="405^ADMIT^^ADMIT^^"_DATE
"RTN","ORWGAPI6",30,0)
 . I FMT=0 D  Q
"RTN","ORWGAPI6",31,0)
 .. S ^TMP("ORWGRPC TEMP",$J,"ADMIT")=""
"RTN","ORWGAPI6",32,0)
 .. S CNT=CNT+1
"RTN","ORWGAPI6",33,0)
 .. S OK=1
"RTN","ORWGAPI6",34,0)
 .. S RESULT="405^ADMIT^ADMIT"
"RTN","ORWGAPI6",35,0)
 I OK D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPI6",36,0)
 K ^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPI6",37,0)
 Q
"RTN","ORWGAPI6",38,0)
 ;
"RTN","ORWGAPI6",39,0)
SURGERY(ITEMS,DFN,FMT,OLDEST,NEWEST,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI6",40,0)
 N CASE,DATE,PROC,RESULT,RESULTS,SURG,SURGPROC K SURG,SURGPROC
"RTN","ORWGAPI6",41,0)
 D SURG^ORWGAPIA(.SURG,DFN)
"RTN","ORWGAPI6",42,0)
 K SURG(0),SURG(1)
"RTN","ORWGAPI6",43,0)
 I FMT=6 D
"RTN","ORWGAPI6",44,0)
 . S CASE=0
"RTN","ORWGAPI6",45,0)
 . F  S CASE=$O(SURG(CASE)) Q:CASE<1  D
"RTN","ORWGAPI6",46,0)
 .. S RESULTS=SURG(CASE)
"RTN","ORWGAPI6",47,0)
 .. S PROC=$P(RESULTS,U,3)
"RTN","ORWGAPI6",48,0)
 .. I '$L(PROC) Q
"RTN","ORWGAPI6",49,0)
 .. S DATE=$P(RESULTS,U,5)
"RTN","ORWGAPI6",50,0)
 .. I DATE>NEWEST Q
"RTN","ORWGAPI6",51,0)
 .. I DATE<OLDEST Q
"RTN","ORWGAPI6",52,0)
 .. I $D(SURGPROC(PROC)) Q
"RTN","ORWGAPI6",53,0)
 .. S SURGPROC(PROC)=""
"RTN","ORWGAPI6",54,0)
 .. S CNT=CNT+1
"RTN","ORWGAPI6",55,0)
 .. S RESULT=130_U_PROC
"RTN","ORWGAPI6",56,0)
 .. D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPI6",57,0)
 I FMT'=6 D
"RTN","ORWGAPI6",58,0)
 . S CASE=0
"RTN","ORWGAPI6",59,0)
 . F  S CASE=$O(SURG(CASE)) Q:CASE<1  D
"RTN","ORWGAPI6",60,0)
 .. S RESULTS=SURG(CASE)
"RTN","ORWGAPI6",61,0)
 .. S PROC=$P(RESULTS,U,3)
"RTN","ORWGAPI6",62,0)
 .. I '$L(PROC) Q
"RTN","ORWGAPI6",63,0)
 .. S SURGPROC(PROC)=RESULTS
"RTN","ORWGAPI6",64,0)
 . K SURG S PROC=""
"RTN","ORWGAPI6",65,0)
 . F  S PROC=$O(SURGPROC(PROC)) Q:PROC=""  D
"RTN","ORWGAPI6",66,0)
 .. S CNT=CNT+1
"RTN","ORWGAPI6",67,0)
 .. I FMT=3 S RESULT=130_U_PROC_"^^"_PROC_"^^"_$P(SURGPROC(PROC),U,5)
"RTN","ORWGAPI6",68,0)
 .. I FMT=0 S RESULT=130_U_PROC_U_PROC
"RTN","ORWGAPI6",69,0)
 .. D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPI6",70,0)
 Q
"RTN","ORWGAPI6",71,0)
 ;
"RTN","ORWGAPI6",72,0)
VISITS(ITEMS,DFN,FMT,OLDEST,NEWEST,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI6",73,0)
 N DATE,DATE2,ITEM,NODE,NUM,OK,RESULT
"RTN","ORWGAPI6",74,0)
 K ^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPI6",75,0)
 I FMT=6 D
"RTN","ORWGAPI6",76,0)
 . S DATE=0
"RTN","ORWGAPI6",77,0)
 . F  S DATE=$O(^AUPNVSIT("AET",DFN,DATE)) Q:DATE<1  Q:DATE>NEWEST  D
"RTN","ORWGAPI6",78,0)
 .. S ITEM=""
"RTN","ORWGAPI6",79,0)
 .. F  S ITEM=$O(^AUPNVSIT("AET",DFN,DATE,ITEM)) Q:ITEM=""  D
"RTN","ORWGAPI6",80,0)
 ... S NODE=""
"RTN","ORWGAPI6",81,0)
 ... F  S NODE=$O(^AUPNVSIT("AET",DFN,DATE,ITEM,NODE)) Q:NODE=""  D
"RTN","ORWGAPI6",82,0)
 .... S NUM=0
"RTN","ORWGAPI6",83,0)
 .... F  S NUM=$O(^AUPNVSIT("AET",DFN,DATE,ITEM,NODE,NUM)) Q:NUM=""  D
"RTN","ORWGAPI6",84,0)
 ..... S DATE2=+$P($G(^AUPNVSIT(NUM,0)),U,18)
"RTN","ORWGAPI6",85,0)
 ..... I 'DATE2 S DATE2=DATE+.01
"RTN","ORWGAPI6",86,0)
 ..... I +$E($P(DATE2,".",2),1,2)>24 S DATE2=(DATE\1)+.2359
"RTN","ORWGAPI6",87,0)
 ..... S ^TMP("ORWGRPC TEMP",$J,ITEM,DATE)=DATE2
"RTN","ORWGAPI6",88,0)
 . S ITEM=0
"RTN","ORWGAPI6",89,0)
 . F  S ITEM=$O(^TMP("ORWGRPC TEMP",$J,ITEM)) Q:ITEM<1  D
"RTN","ORWGAPI6",90,0)
 .. S OK=0
"RTN","ORWGAPI6",91,0)
 .. S DATE=0
"RTN","ORWGAPI6",92,0)
 .. F  S DATE=$O(^TMP("ORWGRPC TEMP",$J,ITEM,DATE)) Q:DATE<1  Q:DATE>NEWEST  D  Q:OK
"RTN","ORWGAPI6",93,0)
 ... S DATE2=$G(^TMP("ORWGRPC TEMP",$J,ITEM,DATE))
"RTN","ORWGAPI6",94,0)
 ... I DATE2<OLDEST Q
"RTN","ORWGAPI6",95,0)
 ... S CNT=CNT+1
"RTN","ORWGAPI6",96,0)
 ... S OK=1
"RTN","ORWGAPI6",97,0)
 ... S RESULT="9000010^"_ITEM
"RTN","ORWGAPI6",98,0)
 ... D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPI6",99,0)
 I FMT'=6 D
"RTN","ORWGAPI6",100,0)
 . S DATE=0
"RTN","ORWGAPI6",101,0)
 . F  S DATE=$O(^AUPNVSIT("AET",DFN,DATE)) Q:DATE<1  D
"RTN","ORWGAPI6",102,0)
 .. S ITEM=0
"RTN","ORWGAPI6",103,0)
 .. F  S ITEM=$O(^AUPNVSIT("AET",DFN,DATE,ITEM)) Q:ITEM<1  D
"RTN","ORWGAPI6",104,0)
 ... I $D(^TMP("ORWGRPC TEMP",$J,ITEM)) Q
"RTN","ORWGAPI6",105,0)
 ... S ^TMP("ORWGRPC TEMP",$J,ITEM)=""
"RTN","ORWGAPI6",106,0)
 ... S CNT=CNT+1
"RTN","ORWGAPI6",107,0)
 ... I FMT=3 S RESULT="9000010^"_ITEM_"^^"_$$EVALUE^ORWGAPIU(ITEM,9000010,.22)_"^^"_DATE
"RTN","ORWGAPI6",108,0)
 ... I FMT=0 S RESULT="9000010^"_ITEM_U_$$EVALUE^ORWGAPIU(ITEM,9000010,.22)
"RTN","ORWGAPI6",109,0)
 ... D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPI6",110,0)
 K ^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPI6",111,0)
 Q
"RTN","ORWGAPI6",112,0)
 ;
"RTN","ORWGAPI7")
0^120^B6370115
"RTN","ORWGAPI7",1,0)
ORWGAPI7 ; SLC/STAFF - Graph Data ;12/21/05  08:17
"RTN","ORWGAPI7",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORWGAPI7",3,0)
 ;
"RTN","ORWGAPI7",4,0)
 ; 
"RTN","ORWGAPI7",5,0)
BCMA(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPI7",6,0)
 N DATE,NODE,RESULT,VALUE
"RTN","ORWGAPI7",7,0)
 S DATE="",CNT=$G(CNT),BACKTO=+$G(BACKTO)
"RTN","ORWGAPI7",8,0)
 F  S DATE=$O(^PSB(53.79,"AOIP",DFN,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI7",9,0)
 . I DATE>START Q
"RTN","ORWGAPI7",10,0)
 . I DATE<BACKTO Q
"RTN","ORWGAPI7",11,0)
 . S NODE=""
"RTN","ORWGAPI7",12,0)
 . F  S NODE=$O(^PSB(53.79,"AOIP",DFN,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI7",13,0)
 .. S VALUE=$P($G(^PSB(53.79,NODE,0)),U,9) I VALUE'="G" Q
"RTN","ORWGAPI7",14,0)
 .. S RESULT=53.79_U_ITEM_U_DATE_"^^"
"RTN","ORWGAPI7",15,0)
 .. D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI7",16,0)
 Q
"RTN","ORWGAPI7",17,0)
 ;
"RTN","ORWGAPI7",18,0)
INRX(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPI7",19,0)
 N DATE,DATE2,NODE,RESULT,VALUE K VALUE
"RTN","ORWGAPI7",20,0)
 S DATE="",CNT=$G(CNT),BACKTO=+$G(BACKTO)
"RTN","ORWGAPI7",21,0)
 F  S DATE=$O(^PXRMINDX(55,"PI",DFN,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI7",22,0)
 . I DATE>START Q
"RTN","ORWGAPI7",23,0)
 . I DATE<BACKTO Q
"RTN","ORWGAPI7",24,0)
 . S DATE2=""
"RTN","ORWGAPI7",25,0)
 . F  S DATE2=$O(^PXRMINDX(55,"PI",DFN,ITEM,DATE,DATE2)) Q:DATE2=""  D
"RTN","ORWGAPI7",26,0)
 .. S NODE=""
"RTN","ORWGAPI7",27,0)
 .. F  S NODE=$O(^PXRMINDX(55,"PI",DFN,ITEM,DATE,DATE2,NODE)) Q:NODE=""  D
"RTN","ORWGAPI7",28,0)
 ... D RXIN^ORWGAPIC(NODE,.VALUE) S VALUE=VALUE("STAT")
"RTN","ORWGAPI7",29,0)
 ... S VALUE=VALUE_"  "_$$INSIG^ORWGAPIC(NODE)
"RTN","ORWGAPI7",30,0)
 ... S RESULT=55_U_ITEM_U_DATE_U_DATE2_U_VALUE
"RTN","ORWGAPI7",31,0)
 ... D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI7",32,0)
 Q
"RTN","ORWGAPI7",33,0)
 ;
"RTN","ORWGAPI7",34,0)
NVA(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPI7",35,0)
 D NVA3^ORWGAPIE(.DATA,ITEM,START,DFN,.CNT,.TMP)
"RTN","ORWGAPI7",36,0)
 Q
"RTN","ORWGAPI7",37,0)
 ;
"RTN","ORWGAPI7",38,0)
OUTRX(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPI7",39,0)
 N DATE1,DATE2,LNUM,NODE,RESULT,VALUE K VALUE
"RTN","ORWGAPI7",40,0)
 S DATE1="",DATE2="",CNT=$G(CNT),BACKTO=+$G(BACKTO)
"RTN","ORWGAPI7",41,0)
 F  S DATE1=$O(^PXRMINDX(52,"PI",DFN,ITEM,DATE1)) Q:DATE1=""  D
"RTN","ORWGAPI7",42,0)
 . I DATE1>START Q
"RTN","ORWGAPI7",43,0)
 . I DATE1<BACKTO Q
"RTN","ORWGAPI7",44,0)
 . S DATE2=""
"RTN","ORWGAPI7",45,0)
 . F  S DATE2=$O(^PXRMINDX(52,"PI",DFN,ITEM,DATE1,DATE2)) Q:DATE2=""  D
"RTN","ORWGAPI7",46,0)
 .. S NODE=""
"RTN","ORWGAPI7",47,0)
 .. F  S NODE=$O(^PXRMINDX(52,"PI",DFN,ITEM,DATE1,DATE2,NODE)) Q:NODE=""  D
"RTN","ORWGAPI7",48,0)
 ... D RXOUT^ORWGAPIC(NODE,.VALUE) S VALUE=$$EXTERNAL^ORWGAPIX(52,100,"",VALUE("STATUS"))
"RTN","ORWGAPI7",49,0)
 ... S VALUE=VALUE_"  "_$$SIG^ORWGAPIC(DFN,+NODE)_"  "_$$RXNUM^ORWGAPIC(DFN,+NODE)
"RTN","ORWGAPI7",50,0)
 ... S RESULT=52_U_ITEM_U_DATE1_U_DATE2_U_VALUE
"RTN","ORWGAPI7",51,0)
 ... D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI7",52,0)
 Q
"RTN","ORWGAPI7",53,0)
 ;
"RTN","ORWGAPI8")
0^121^B7954497
"RTN","ORWGAPI8",1,0)
ORWGAPI8 ; SLC/STAFF - Graph Data, non-index ;8/21/06  07:52
"RTN","ORWGAPI8",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORWGAPI8",3,0)
 ;
"RTN","ORWGAPI8",4,0)
ADMIT(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPI8",5,0)
 N DATE,DATE2,DISCH,LINE,LST,NUM,RESULT,VALUE K LST
"RTN","ORWGAPI8",6,0)
 S DATE="",DATE2="",CNT=$G(CNT),BACKTO=+$G(BACKTO)
"RTN","ORWGAPI8",7,0)
 S ITEM=$G(ITEM,"ADMIT")
"RTN","ORWGAPI8",8,0)
 D ADMITLST^ORWPT(.LST,DFN)
"RTN","ORWGAPI8",9,0)
 S NUM=0
"RTN","ORWGAPI8",10,0)
 F  S NUM=$O(LST(NUM)) Q:NUM<1  D
"RTN","ORWGAPI8",11,0)
 . S LINE=LST(NUM)
"RTN","ORWGAPI8",12,0)
 . S DATE=$P(LINE,U)
"RTN","ORWGAPI8",13,0)
 . I DATE>START Q
"RTN","ORWGAPI8",14,0)
 . S DISCH=$P(LINE,U,5)
"RTN","ORWGAPI8",15,0)
 . S DATE2=$$DISCH^ORWGAPIA(DISCH)
"RTN","ORWGAPI8",16,0)
 . I DATE2="" D
"RTN","ORWGAPI8",17,0)
 .. S DATE2=$$FMADD^ORWGAPIX(DATE,$$LOS^ORWGAPIA(DISCH)+1)
"RTN","ORWGAPI8",18,0)
 .. I DATE2=-1 S DATE2=$$FMADD^ORWGAPIX(DT,1) ; just make it today + 1
"RTN","ORWGAPI8",19,0)
 .. S DATE2=DATE2\1
"RTN","ORWGAPI8",20,0)
 . S VALUE=$P(LINE,U,3)_"  "_$P(LINE,U,4)_U_$P(LINE,U,5,6)
"RTN","ORWGAPI8",21,0)
 . S CNT=CNT+1
"RTN","ORWGAPI8",22,0)
 . S RESULT=405_U_ITEM_U_DATE_U_DATE2_U_VALUE
"RTN","ORWGAPI8",23,0)
 . D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI8",24,0)
 Q
"RTN","ORWGAPI8",25,0)
 ;
"RTN","ORWGAPI8",26,0)
SURG(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPI8",27,0)
 N CASE,DATE,DATE2,NUM,PROC,RESULT,RESULTS,SURG,SURGPROC,VALUE K SURG,SURGPROC
"RTN","ORWGAPI8",28,0)
 S DATE2="",CNT=$G(CNT),BACKTO=+$G(BACKTO)
"RTN","ORWGAPI8",29,0)
 D SURG^ORWGAPIA(.SURG,DFN)
"RTN","ORWGAPI8",30,0)
 K SURG(0),SURG(1)
"RTN","ORWGAPI8",31,0)
 S ITEM=$$UP^ORWGAPIX(ITEM)
"RTN","ORWGAPI8",32,0)
 S NUM=0
"RTN","ORWGAPI8",33,0)
 S CASE=0
"RTN","ORWGAPI8",34,0)
 F  S CASE=$O(SURG(CASE)) Q:CASE<1  D
"RTN","ORWGAPI8",35,0)
 . S RESULTS=SURG(CASE)
"RTN","ORWGAPI8",36,0)
 . S PROC=$P(RESULTS,U,3)
"RTN","ORWGAPI8",37,0)
 . I '$L(PROC) Q
"RTN","ORWGAPI8",38,0)
 . S PROC=$$UP^ORWGAPIX(PROC)
"RTN","ORWGAPI8",39,0)
 . I PROC'=ITEM Q
"RTN","ORWGAPI8",40,0)
 . S NUM=NUM+1
"RTN","ORWGAPI8",41,0)
 . S SURGPROC(PROC,NUM)=RESULTS
"RTN","ORWGAPI8",42,0)
 K SURG
"RTN","ORWGAPI8",43,0)
 S PROC=""
"RTN","ORWGAPI8",44,0)
 F  S PROC=$O(SURGPROC(PROC)) Q:PROC=""  D
"RTN","ORWGAPI8",45,0)
 . S NUM=0
"RTN","ORWGAPI8",46,0)
 . F  S NUM=$O(SURGPROC(PROC,NUM)) Q:NUM<1  D
"RTN","ORWGAPI8",47,0)
 .. S RESULTS=SURGPROC(PROC,NUM)
"RTN","ORWGAPI8",48,0)
 .. S DATE=$P(RESULTS,U,5)
"RTN","ORWGAPI8",49,0)
 .. I DATE>START Q
"RTN","ORWGAPI8",50,0)
 .. I DATE<BACKTO Q
"RTN","ORWGAPI8",51,0)
 .. S VALUE=""
"RTN","ORWGAPI8",52,0)
 .. S RESULT=130_U_PROC_U_DATE_U_DATE2_U_VALUE
"RTN","ORWGAPI8",53,0)
 .. S CNT=CNT+1
"RTN","ORWGAPI8",54,0)
 .. D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI8",55,0)
 Q
"RTN","ORWGAPI8",56,0)
 ;
"RTN","ORWGAPI8",57,0)
VISIT(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPI8",58,0)
 N DATE,DATE2,NODE,NUM,RESULT,VALUE
"RTN","ORWGAPI8",59,0)
 S DATE="",DATE2="",CNT=$G(CNT),BACKTO=+$G(BACKTO)
"RTN","ORWGAPI8",60,0)
 F  S DATE=$O(^AUPNVSIT("AET",DFN,DATE)) Q:DATE=""  D
"RTN","ORWGAPI8",61,0)
 . I DATE>START Q
"RTN","ORWGAPI8",62,0)
 . I DATE<BACKTO Q
"RTN","ORWGAPI8",63,0)
 . S NODE=""
"RTN","ORWGAPI8",64,0)
 . F  S NODE=$O(^AUPNVSIT("AET",DFN,DATE,ITEM,NODE)) Q:NODE=""  D
"RTN","ORWGAPI8",65,0)
 .. S NUM=0
"RTN","ORWGAPI8",66,0)
 .. F  S NUM=$O(^AUPNVSIT("AET",DFN,DATE,ITEM,NODE,NUM)) Q:NUM=""  D
"RTN","ORWGAPI8",67,0)
 ... S DATE2=+$P($G(^AUPNVSIT(NUM,0)),U,18)
"RTN","ORWGAPI8",68,0)
 ... I 'DATE2 S DATE2=DATE+.01
"RTN","ORWGAPI8",69,0)
 ... I +$E($P(DATE2,".",2),1,2)>24 S DATE2=(DATE\1)+.2359
"RTN","ORWGAPI8",70,0)
 ... S VALUE=""
"RTN","ORWGAPI8",71,0)
 ... S CNT=CNT+1
"RTN","ORWGAPI8",72,0)
 ... S RESULT=9000010_U_ITEM_U_DATE_U_DATE2_U_VALUE
"RTN","ORWGAPI8",73,0)
 ... D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI8",74,0)
 Q
"RTN","ORWGAPI8",75,0)
 ;
"RTN","ORWGAPIA")
0^122^B34887063
"RTN","ORWGAPIA",1,0)
ORWGAPIA ; SLC/STAFF - Graph Application Calls ;2/22/07  11:16
"RTN","ORWGAPIA",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,251,260,243**;Dec 17, 1997;Build 242
"RTN","ORWGAPIA",3,0)
 ;
"RTN","ORWGAPIA",4,0)
ADMITX(DFN) ; $$(dfn) -> 1 if patient has data else 0
"RTN","ORWGAPIA",5,0)
 Q $O(^DGPM("C",+$G(DFN),0))>0
"RTN","ORWGAPIA",6,0)
 ;
"RTN","ORWGAPIA",7,0)
ALLERGYX(DFN) ; $$(dfn) -> 1 if patient has data else 0
"RTN","ORWGAPIA",8,0)
 Q $O(^GMR(120.8,"B",+$G(DFN),0))>0
"RTN","ORWGAPIA",9,0)
 ;
"RTN","ORWGAPIA",10,0)
ALLG(IEN) ; $$(ien) -> external display of allergies
"RTN","ORWGAPIA",11,0)
 I IEN Q $P($G(^GMRD(120.83,IEN,0)),U) ; this is for rxn, allergy is free text
"RTN","ORWGAPIA",12,0)
 Q IEN
"RTN","ORWGAPIA",13,0)
 ;
"RTN","ORWGAPIA",14,0)
CPT(NODE,ORVALUE,VALUES) ; from ORWGAPI4
"RTN","ORWGAPIA",15,0)
 D VCPT^PXPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",16,0)
 S VALUES=$$DATA^ORWGAPIW(.ORVALUE) ;*****************************
"RTN","ORWGAPIA",17,0)
 Q
"RTN","ORWGAPIA",18,0)
 ;
"RTN","ORWGAPIA",19,0)
DISCH(IEN) ; $$(pt movement ien) -> discharge date
"RTN","ORWGAPIA",20,0)
 Q $P($G(^DGPM(+$P($G(^DGPM(+$G(IEN),0)),U,17),0)),U)
"RTN","ORWGAPIA",21,0)
 ;
"RTN","ORWGAPIA",22,0)
DOCCLASS(DOCTYPE) ; $$(doc type) -> ien of tiu doc class
"RTN","ORWGAPIA",23,0)
 N CONSULTS
"RTN","ORWGAPIA",24,0)
 S DOCTYPE=$E(DOCTYPE,1)
"RTN","ORWGAPIA",25,0)
 I DOCTYPE="P" Q 3
"RTN","ORWGAPIA",26,0)
 I DOCTYPE="D" Q 244
"RTN","ORWGAPIA",27,0)
 I DOCTYPE="C" D CNSLCLAS^TIUSRVD(.CONSULTS) Q CONSULTS
"RTN","ORWGAPIA",28,0)
 Q 0
"RTN","ORWGAPIA",29,0)
 ;
"RTN","ORWGAPIA",30,0)
EDU(NODE,ORVALUE,VALUES) ; from ORWGAPI4
"RTN","ORWGAPIA",31,0)
 D VPEDU^PXPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",32,0)
 S VALUES=$$DATA^ORWGAPIW(.ORVALUE) ;*****************************
"RTN","ORWGAPIA",33,0)
 Q
"RTN","ORWGAPIA",34,0)
 ;
"RTN","ORWGAPIA",35,0)
EXAM(NODE,ORVALUE,VALUES) ; from ORWGAPI4
"RTN","ORWGAPIA",36,0)
 D VXAM^PXPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",37,0)
 S VALUES=$$DATA^ORWGAPIW(.ORVALUE) ;*****************************
"RTN","ORWGAPIA",38,0)
 Q
"RTN","ORWGAPIA",39,0)
 ;
"RTN","ORWGAPIA",40,0)
GETTIU(ORDATA,IEN) ; from ORWGAPID
"RTN","ORWGAPIA",41,0)
 D TGET^TIUSRVR1(.ORDATA,IEN)
"RTN","ORWGAPIA",42,0)
 Q
"RTN","ORWGAPIA",43,0)
 ;
"RTN","ORWGAPIA",44,0)
HF(NODE,ORVALUE,VALUES) ; from ORWGAPI4
"RTN","ORWGAPIA",45,0)
 D VHF^PXPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",46,0)
 S VALUES=$$DATA^ORWGAPIW(.ORVALUE) ;*****************************
"RTN","ORWGAPIA",47,0)
 Q
"RTN","ORWGAPIA",48,0)
 ;
"RTN","ORWGAPIA",49,0)
ICD0(IEN) ; $$(ien) -> external display of IDC0
"RTN","ORWGAPIA",50,0)
 Q $P($G(^ICD0(IEN,0)),U)_" "_$P($G(^ICD0(IEN,0)),U,4)
"RTN","ORWGAPIA",51,0)
 ;
"RTN","ORWGAPIA",52,0)
ICD9(IEN) ; $$(ien) -> external display of IDC9
"RTN","ORWGAPIA",53,0)
 Q $P($G(^ICD9(IEN,0)),U)_" "_$P($G(^ICD9(IEN,0)),U,3)
"RTN","ORWGAPIA",54,0)
 ;
"RTN","ORWGAPIA",55,0)
ICPT(IEN,CSD) ; $$(ien) -> external display of CPT
"RTN","ORWGAPIA",56,0)
 N X S X=$$CPT^ICPTCOD($G(IEN),$G(CSD))
"RTN","ORWGAPIA",57,0)
 Q $P(X,U,2)_" "_$E($P(X,U,3),1,30)
"RTN","ORWGAPIA",58,0)
 ;
"RTN","ORWGAPIA",59,0)
IMM(NODE,ORVALUE,VALUES) ; from ORWGAPI4
"RTN","ORWGAPIA",60,0)
 D VIMM^PXPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",61,0)
 S VALUES=$$DATA^ORWGAPIW(.ORVALUE) ;*****************************
"RTN","ORWGAPIA",62,0)
 Q
"RTN","ORWGAPIA",63,0)
 ;
"RTN","ORWGAPIA",64,0)
ISA(USER,CLASS,ORERR) ; $$(user,user class,err) -> 1 if user in class, else 0
"RTN","ORWGAPIA",65,0)
 Q $$ISA^USRLM(USER,CLASS,.ORERR)
"RTN","ORWGAPIA",66,0)
 ;
"RTN","ORWGAPIA",67,0)
LOS(DGPMIFN) ; $$(pt movement ien) -> length of stay
"RTN","ORWGAPIA",68,0)
 N X D ^DGPMLOS
"RTN","ORWGAPIA",69,0)
 Q +$P($G(X),U,5)
"RTN","ORWGAPIA",70,0)
 ;
"RTN","ORWGAPIA",71,0)
MEDICINE(ARRAY,DFN) ;
"RTN","ORWGAPIA",72,0)
 N DATE,FILE,IEN,NAME,NUM,REF,VALUES,XREF
"RTN","ORWGAPIA",73,0)
 K ARRAY,^TMP("MCAR",$J),^TMP("OR",$J,"MCAR")
"RTN","ORWGAPIA",74,0)
 D FILE^ORWGAPIU(690,.REF,.XREF)
"RTN","ORWGAPIA",75,0)
 I '$L(REF) Q
"RTN","ORWGAPIA",76,0)
 I $E(REF,$L(REF))="," S REF=$E(REF,1,$L(REF)-1)_")"
"RTN","ORWGAPIA",77,0)
 I $E(REF,$L(REF))="(" S REF=$P(REF,"(")
"RTN","ORWGAPIA",78,0)
 D EN^MCARPS2(DFN)
"RTN","ORWGAPIA",79,0)
 S NUM=0
"RTN","ORWGAPIA",80,0)
 F  S NUM=$O(^TMP("OR",$J,"MCAR","OT",NUM)) Q:NUM<1  D
"RTN","ORWGAPIA",81,0)
 . S VALUES=^TMP("OR",$J,"MCAR","OT",NUM)
"RTN","ORWGAPIA",82,0)
 . S DATE=$$DATETFM^ORWGAPIW($P(VALUES,U,6))
"RTN","ORWGAPIA",83,0)
 . S NAME=$P(VALUES,U) I '$L(NAME) Q
"RTN","ORWGAPIA",84,0)
 . S IEN=+$O(@REF@(XREF,NAME,""))
"RTN","ORWGAPIA",85,0)
 . I DATE,IEN S ARRAY(IEN,DATE)=NAME
"RTN","ORWGAPIA",86,0)
 K ^TMP("MCAR",$J),^TMP("OR",$J,"MCAR")
"RTN","ORWGAPIA",87,0)
 Q
"RTN","ORWGAPIA",88,0)
 ;
"RTN","ORWGAPIA",89,0)
MEDVAL(VAL) ;
"RTN","ORWGAPIA",90,0)
 N IEN,NAME,NAMES,REF,SEQ,XREF K NAMES,VAL
"RTN","ORWGAPIA",91,0)
 D FILE^ORWGAPIU(690,.REF,.XREF)
"RTN","ORWGAPIA",92,0)
 I '$L(REF) Q
"RTN","ORWGAPIA",93,0)
 I $E(REF,$L(REF))="," S REF=$E(REF,1,$L(REF)-1)_")"
"RTN","ORWGAPIA",94,0)
 I $E(REF,$L(REF))="(" S REF=$P(REF,"(")
"RTN","ORWGAPIA",95,0)
 S NAME=""
"RTN","ORWGAPIA",96,0)
 F  S NAME=$O(@REF@(XREF,NAME)) Q:NAME=""  D
"RTN","ORWGAPIA",97,0)
 . S IEN=0
"RTN","ORWGAPIA",98,0)
 . F  S IEN=$O(@REF@(XREF,NAME,IEN)) Q:IEN<1  D
"RTN","ORWGAPIA",99,0)
 .. S NAMES(IEN)=NAME
"RTN","ORWGAPIA",100,0)
 S SEQ=0
"RTN","ORWGAPIA",101,0)
 S IEN=0
"RTN","ORWGAPIA",102,0)
 F  S IEN=$O(NAMES(IEN)) Q:IEN<1  D
"RTN","ORWGAPIA",103,0)
 . S SEQ=SEQ+1
"RTN","ORWGAPIA",104,0)
 . S VAL(SEQ)=690_U_IEN_U_NAMES(IEN)
"RTN","ORWGAPIA",105,0)
 Q
"RTN","ORWGAPIA",106,0)
 ;
"RTN","ORWGAPIA",107,0)
MH(ORVALUE,NODE,VALUES) ; from ORWGAPI4
"RTN","ORWGAPIA",108,0)
 D ENDAS^YTAPI10(.ORVALUE,NODE)
"RTN","ORWGAPIA",109,0)
 S VALUES=$$DATA^ORWGAPIW(.ORVALUE) ;*****************************
"RTN","ORWGAPIA",110,0)
 Q
"RTN","ORWGAPIA",111,0)
 ;
"RTN","ORWGAPIA",112,0)
NOTEX(DFN) ; $$(dfn) -> 1 if patient has data else 0
"RTN","ORWGAPIA",113,0)
 Q $$HASDOCMT^TIULX($G(DFN))
"RTN","ORWGAPIA",114,0)
 ;
"RTN","ORWGAPIA",115,0)
OITEM(DATA) ; API - get order display groups   -  from ORWGAPI
"RTN","ORWGAPIA",116,0)
 N CNT,IEN,RESULT,TMP,ZERO
"RTN","ORWGAPIA",117,0)
 D RETURN^ORWGAPIW(.TMP,.DATA)
"RTN","ORWGAPIA",118,0)
 S CNT=0
"RTN","ORWGAPIA",119,0)
 S IEN=0
"RTN","ORWGAPIA",120,0)
 F  S IEN=$O(^ORD(100.98,IEN)) Q:IEN<1  D
"RTN","ORWGAPIA",121,0)
 . S ZERO=$G(^ORD(100.98,IEN,0)) I '$L(ZERO) Q
"RTN","ORWGAPIA",122,0)
 . S RESULT="100.98^"_IEN_U_$P(ZERO,U)_U_$P(ZERO,U,3)
"RTN","ORWGAPIA",123,0)
 . D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPIA",124,0)
 Q
"RTN","ORWGAPIA",125,0)
 ;
"RTN","ORWGAPIA",126,0)
POV(NODE,ORVALUE,VALUES) ; from ORWGAPI4
"RTN","ORWGAPIA",127,0)
 D VPOV^PXPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",128,0)
 S VALUES=$$DATA^ORWGAPIW(.ORVALUE) ;*****************************
"RTN","ORWGAPIA",129,0)
 Q
"RTN","ORWGAPIA",130,0)
 ;
"RTN","ORWGAPIA",131,0)
PROB(GMPLLEX,GMPLSTAT,GMPLICD,GMPLODAT,GMPLXDAT,NODE) ; from ORWGAPI4
"RTN","ORWGAPIA",132,0)
 N GMPLPNAM,GMPLDLM,GMPLTXT,GMPLCOND,GMPLPRV,GMPLPRIO
"RTN","ORWGAPIA",133,0)
 D CALL2^GMPLUTL3(NODE)
"RTN","ORWGAPIA",134,0)
 Q
"RTN","ORWGAPIA",135,0)
 ;
"RTN","ORWGAPIA",136,0)
PTF(NODE,ORVALUE,VALUES) ; from ORWGAPI3, ORWGAPI4
"RTN","ORWGAPIA",137,0)
 D PTF^DGPTPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",138,0)
 S VALUES=$$DATA^ORWGAPIW(.ORVALUE) ;*****************************
"RTN","ORWGAPIA",139,0)
 Q
"RTN","ORWGAPIA",140,0)
 ;
"RTN","ORWGAPIA",141,0)
RAD(NODE,ORVALUE,VALUES) ; from ORWGAPI3
"RTN","ORWGAPIA",142,0)
 D EN1^RAPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",143,0)
 S VALUES=$$DATA^ORWGAPIW(.ORVALUE) ;*****************************
"RTN","ORWGAPIA",144,0)
 Q
"RTN","ORWGAPIA",145,0)
 ;
"RTN","ORWGAPIA",146,0)
SKIN(NODE,ORVALUE,VALUES) ; from ORWGAPI4
"RTN","ORWGAPIA",147,0)
 D VSKIN^PXPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",148,0)
 S VALUES=$$DATA^ORWGAPIW(.ORVALUE) ;*****************************
"RTN","ORWGAPIA",149,0)
 Q
"RTN","ORWGAPIA",150,0)
 ;
"RTN","ORWGAPIA",151,0)
SURG(ORSURG,DFN,VALUES) ; from ORWGAPI2, ORWGAPI4
"RTN","ORWGAPIA",152,0)
 D GET^SROGTSR(.ORSURG,DFN)
"RTN","ORWGAPIA",153,0)
 S VALUES=$$DATA^ORWGAPIW(.ORSURG) ;*****************************
"RTN","ORWGAPIA",154,0)
 Q
"RTN","ORWGAPIA",155,0)
 ;
"RTN","ORWGAPIA",156,0)
SURGX(DFN) ; $$(dfn) -> 1 if patient has data else 0
"RTN","ORWGAPIA",157,0)
 Q $O(^SRF("B",+$G(DFN),0))>0
"RTN","ORWGAPIA",158,0)
 ;
"RTN","ORWGAPIA",159,0)
TAX(IEN) ; $$(ien) -> external display of reminder taxonomy
"RTN","ORWGAPIA",160,0)
 Q $P($G(^PXD(811.2,+$G(IEN),0)),U)
"RTN","ORWGAPIA",161,0)
 ;
"RTN","ORWGAPIA",162,0)
TITLE(DOCTYPE) ; $$(document type) -> parent ien^parent^parent abbrev
"RTN","ORWGAPIA",163,0)
 N IEN,RESULTS K RESULTS
"RTN","ORWGAPIA",164,0)
 S DOCTYPE=+$G(^TIU(8925,+$G(DOCTYPE),0))
"RTN","ORWGAPIA",165,0)
 S IEN=+$$DOCCLASS^TIULC1(DOCTYPE) I 'IEN Q ""
"RTN","ORWGAPIA",166,0)
 D GETDATA^ORWGAPIX(.RESULTS,8925.1,".01;.02",IEN)
"RTN","ORWGAPIA",167,0)
 I '$L($G(RESULTS(.01))) Q ""
"RTN","ORWGAPIA",168,0)
 Q IEN_U_"note - "_RESULTS(.01)_U_$G(RESULTS(.02))
"RTN","ORWGAPIA",169,0)
 ;
"RTN","ORWGAPIA",170,0)
TIU(ORVALUE,DOCIEN,ONE,DFN,OLDEST,NEWEST) ; from ORWGAPI1, ORWGAPI3
"RTN","ORWGAPIA",171,0)
 D CONTEXT^TIUSRVLO(.ORVALUE,DOCIEN,ONE,DFN,$G(OLDEST),$G(NEWEST))
"RTN","ORWGAPIA",172,0)
 Q
"RTN","ORWGAPIA",173,0)
 ;
"RTN","ORWGAPIA",174,0)
TIUTITLE(DATA) ; API - get tiu document titles   - from ORWGAPI
"RTN","ORWGAPIA",175,0)
 N CNT,IEN,RESULT,RESULTS,TMP K ^TMP("TIUTLS",$J)
"RTN","ORWGAPIA",176,0)
 D RETURN^ORWGAPIW(.TMP,.DATA)
"RTN","ORWGAPIA",177,0)
 S CNT=0
"RTN","ORWGAPIA",178,0)
 D TITLIENS^TIULX
"RTN","ORWGAPIA",179,0)
 S IEN=0
"RTN","ORWGAPIA",180,0)
 F  S IEN=$O(^TMP("TIUTLS",$J,IEN)) Q:IEN<1  D
"RTN","ORWGAPIA",181,0)
 . K RESULTS
"RTN","ORWGAPIA",182,0)
 . D GETDATA^ORWGAPIX(.RESULTS,8925.1,".01;.02",IEN)
"RTN","ORWGAPIA",183,0)
 . I '$L($G(RESULTS(.01))) Q
"RTN","ORWGAPIA",184,0)
 . S RESULT="8925.1^"_IEN_U_RESULTS(.01)_U_$G(RESULTS(.02))
"RTN","ORWGAPIA",185,0)
 . D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPIA",186,0)
 K ^TMP("TIUTLS",$J)
"RTN","ORWGAPIA",187,0)
 Q
"RTN","ORWGAPIA",188,0)
 ;
"RTN","ORWGAPIA",189,0)
VISITX(DFN) ; $$(dfn) -> 1 if patient has data else 0
"RTN","ORWGAPIA",190,0)
 Q $O(^AUPNVSIT("AET",+$G(DFN),0))>0
"RTN","ORWGAPIA",191,0)
 ;
"RTN","ORWGAPIA",192,0)
VITAL(ORVALUE,NODE,VALUES) ; from ORWGAPI4
"RTN","ORWGAPIA",193,0)
 D EN^GMVPXRM(.ORVALUE,NODE)
"RTN","ORWGAPIA",194,0)
 S VALUES=$$DATA^ORWGAPIW(.ORVALUE) ;*****************************
"RTN","ORWGAPIA",195,0)
 Q
"RTN","ORWGAPIA",196,0)
 ;
"RTN","ORWGAPIB")
0^123^B3779452
"RTN","ORWGAPIB",1,0)
ORWGAPIB ; SLC/STAFF - Graph Blood Bank ;12/21/05  08:21
"RTN","ORWGAPIB",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,243**;Dec 17, 1997;Build 242
"RTN","ORWGAPIB",3,0)
 ;
"RTN","ORWGAPIB",4,0)
BBITEM(ITEMS,DFN,FMT,OLDEST,NEWEST,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPIB",5,0)
 N DATE,IDATE,INEWEST,IOLDEST,ITEM,LRDFN,OK,RESULT
"RTN","ORWGAPIB",6,0)
 K ^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPIB",7,0)
 S INEWEST=$$LRIDT^ORWGAPIC(NEWEST),IOLDEST=$$LRIDT^ORWGAPIC(OLDEST)
"RTN","ORWGAPIB",8,0)
 S LRDFN=$$LRDFN^ORWGAPIC(DFN)
"RTN","ORWGAPIB",9,0)
 S IDATE=0
"RTN","ORWGAPIB",10,0)
 F  S IDATE=$O(^LR(LRDFN,1.6,IDATE)) Q:IDATE<1  D
"RTN","ORWGAPIB",11,0)
 . S ITEM=+$P($G(^LR(LRDFN,1.6,IDATE,0)),U,2)
"RTN","ORWGAPIB",12,0)
 . I 'ITEM Q
"RTN","ORWGAPIB",13,0)
 . S OK=0
"RTN","ORWGAPIB",14,0)
 . I FMT=6 D
"RTN","ORWGAPIB",15,0)
 .. Q:IDATE<INEWEST  Q:IDATE>IOLDEST
"RTN","ORWGAPIB",16,0)
 .. S OK=1
"RTN","ORWGAPIB",17,0)
 .. S CNT=CNT+1
"RTN","ORWGAPIB",18,0)
 .. S RESULT="63BB"_U_ITEM
"RTN","ORWGAPIB",19,0)
 . I FMT=3 D
"RTN","ORWGAPIB",20,0)
 .. I '$D(^TMP("ORWGRPC TEMP",$J,ITEM)) D
"RTN","ORWGAPIB",21,0)
 ... S OK=1
"RTN","ORWGAPIB",22,0)
 ... S ^TMP("ORWGRPC TEMP",$J,ITEM)=""
"RTN","ORWGAPIB",23,0)
 ... S DATE=$$LRIDT^ORWGAPIC(IDATE)
"RTN","ORWGAPIB",24,0)
 ... S CNT=CNT+1
"RTN","ORWGAPIB",25,0)
 ... S RESULT="63BB^"_ITEM_"^^"_$P($G(^LAB(66,ITEM,0)),U)_"^^"_DATE
"RTN","ORWGAPIB",26,0)
 . I FMT=0 D
"RTN","ORWGAPIB",27,0)
 .. S OK=1
"RTN","ORWGAPIB",28,0)
 .. S CNT=CNT+1
"RTN","ORWGAPIB",29,0)
 .. S RESULT="63BB^"_ITEM_U_$P($G(^LAB(66,ITEM,0)),U)
"RTN","ORWGAPIB",30,0)
 . I OK D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPIB",31,0)
 K ^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPIB",32,0)
 Q
"RTN","ORWGAPIB",33,0)
 ;
"RTN","ORWGAPIB",34,0)
BBDATA(DATA,ITEM,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPIR
"RTN","ORWGAPIB",35,0)
 N DATE,IDATE,LRDFN,NITEM,RESULT
"RTN","ORWGAPIB",36,0)
 S LRDFN=$$LRDFN^ORWGAPIC(DFN)
"RTN","ORWGAPIB",37,0)
 S IDATE="",CNT=$G(CNT),BACKTO=+$G(BACKTO)
"RTN","ORWGAPIB",38,0)
 F  S IDATE=$O(^LR(LRDFN,1.6,IDATE)) Q:IDATE=""  D
"RTN","ORWGAPIB",39,0)
 . S NITEM=+$P($G(^LR(LRDFN,1.6,IDATE,0)),U,2)
"RTN","ORWGAPIB",40,0)
 . I NITEM'=ITEM Q
"RTN","ORWGAPIB",41,0)
 . S DATE=$$LRIDT^ORWGAPIC(IDATE)
"RTN","ORWGAPIB",42,0)
 . I DATE>START Q
"RTN","ORWGAPIB",43,0)
 . I DATE<BACKTO Q
"RTN","ORWGAPIB",44,0)
 . S RESULT="63BB^"_ITEM_U_DATE_U
"RTN","ORWGAPIB",45,0)
 . D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPIB",46,0)
 Q
"RTN","ORWGAPIB",47,0)
 ;
"RTN","ORWGAPIB",48,0)
BBX(DFN) ; $$(dfn) -> 1 if patient has blood bank data ,else 0
"RTN","ORWGAPIB",49,0)
 Q $L($O(^LR(+$$LRDFN^ORWGAPIC($G(DFN)),1.6,"")))>0
"RTN","ORWGAPIB",50,0)
 ;
"RTN","ORWGAPIC")
0^124^B34311571
"RTN","ORWGAPIC",1,0)
ORWGAPIC ; SLC/STAFF - Graph Application Calls - Labs, Meds ;11/1/06  12:49
"RTN","ORWGAPIC",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORWGAPIC",3,0)
 ;
"RTN","ORWGAPIC",4,0)
AA(IEN) ; $$(ien) -> external display of accession area
"RTN","ORWGAPIC",5,0)
 Q $P($G(^LRO(68,IEN,0)),U)
"RTN","ORWGAPIC",6,0)
 ;
"RTN","ORWGAPIC",7,0)
AALAB(TEST) ; $$(lab test) -> accession ien^acc name^acc abbrev
"RTN","ORWGAPIC",8,0)
 N AA,DIV
"RTN","ORWGAPIC",9,0)
 S TEST=+$G(TEST)
"RTN","ORWGAPIC",10,0)
 S DIV=+$G(DUZ(2))
"RTN","ORWGAPIC",11,0)
 S AA=+$P($G(^LAB(60,+TEST,8,DIV,0)),U,2)
"RTN","ORWGAPIC",12,0)
 I AA Q AA_U_$$ACCLAB(AA)
"RTN","ORWGAPIC",13,0)
 S AA=+$P($G(^LAB(60,+TEST,8,+$O(^LAB(60,+TEST,8,0)),0)),U,2)
"RTN","ORWGAPIC",14,0)
 I AA Q AA_U_$$ACCLAB(AA)
"RTN","ORWGAPIC",15,0)
 Q ""
"RTN","ORWGAPIC",16,0)
 ;
"RTN","ORWGAPIC",17,0)
ACC(DATA) ; API - get accession areas   - from ORWGAPI
"RTN","ORWGAPIC",18,0)
 N CNT,IEN,TMP,RESULT,ZERO
"RTN","ORWGAPIC",19,0)
 D RETURN^ORWGAPIW(.TMP,.DATA)
"RTN","ORWGAPIC",20,0)
 S CNT=0
"RTN","ORWGAPIC",21,0)
 S IEN=0
"RTN","ORWGAPIC",22,0)
 F  S IEN=$O(^LRO(68,IEN)) Q:IEN<1  D
"RTN","ORWGAPIC",23,0)
 . S ZERO=$G(^LRO(68,IEN,0)) I '$L(ZERO) Q
"RTN","ORWGAPIC",24,0)
 . S RESULT="68^"_IEN_U_$P(ZERO,U)_U_$P(ZERO,U,11)
"RTN","ORWGAPIC",25,0)
 . D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPIC",26,0)
 Q
"RTN","ORWGAPIC",27,0)
 ;
"RTN","ORWGAPIC",28,0)
ACCLAB(AA) ; $$(accession ien) -> acc name^acc abbrev
"RTN","ORWGAPIC",29,0)
 N ZERO
"RTN","ORWGAPIC",30,0)
 S ZERO=$G(^LRO(68,AA,0)) I '$L(ZERO) Q ""
"RTN","ORWGAPIC",31,0)
 Q "lab - "_$P(ZERO,U)_U_$P(ZERO,U,11)
"RTN","ORWGAPIC",32,0)
 ;
"RTN","ORWGAPIC",33,0)
ADDDRUG(IEN) ; $$(additive) -> drug in 50 else ""
"RTN","ORWGAPIC",34,0)
 N RESULT K ^TMP($J,"RX")
"RTN","ORWGAPIC",35,0)
 I '$G(IEN) Q ""
"RTN","ORWGAPIC",36,0)
 D ZERO^PSS52P6(IEN,,,"RX")
"RTN","ORWGAPIC",37,0)
 S RESULT=$P($G(^TMP($J,"RX",IEN,1)),U)
"RTN","ORWGAPIC",38,0)
 K ^TMP($J,"RX")
"RTN","ORWGAPIC",39,0)
 Q RESULT
"RTN","ORWGAPIC",40,0)
 ;
"RTN","ORWGAPIC",41,0)
BCMAX(DFN) ; $$(dfn) -> 1 if patient has data else 0
"RTN","ORWGAPIC",42,0)
 Q $O(^PSB(53.79,"B",+$G(DFN),0))>0
"RTN","ORWGAPIC",43,0)
 ;
"RTN","ORWGAPIC",44,0)
DC(IEN) ; $$(ien) -> external display of drug class
"RTN","ORWGAPIC",45,0)
 N RESULT K ^TMP($J,"RX")
"RTN","ORWGAPIC",46,0)
 I '$G(IEN) Q ""
"RTN","ORWGAPIC",47,0)
 D IEN^PSN50P65(IEN,,"RX")
"RTN","ORWGAPIC",48,0)
 S RESULT=$G(^TMP($J,"RX",IEN,1))
"RTN","ORWGAPIC",49,0)
 K ^TMP($J,"RX")
"RTN","ORWGAPIC",50,0)
 Q RESULT
"RTN","ORWGAPIC",51,0)
 ;
"RTN","ORWGAPIC",52,0)
DRGCLASS(DRUG) ; $$(drug) -> drug class^classification
"RTN","ORWGAPIC",53,0)
 N RESULT K ^TMP($J,"RX")
"RTN","ORWGAPIC",54,0)
 I '$G(DRUG) Q ""
"RTN","ORWGAPIC",55,0)
 D DATA^PSS50(DRUG,,,,,"RX")
"RTN","ORWGAPIC",56,0)
 S RESULT=+$G(^TMP($J,"RX",DRUG,25))
"RTN","ORWGAPIC",57,0)
 K ^TMP($J,"RX")
"RTN","ORWGAPIC",58,0)
 Q RESULT_U_"drug - "_$$DC(RESULT)
"RTN","ORWGAPIC",59,0)
 ;
"RTN","ORWGAPIC",60,0)
DRUG(NUM) ; $$(bcma entry) -> drug in 50 else ""
"RTN","ORWGAPIC",61,0)
 N DONE,DRUG,NUM1
"RTN","ORWGAPIC",62,0)
 S DONE=0,NUM=+$G(NUM)
"RTN","ORWGAPIC",63,0)
 S NUM1=0
"RTN","ORWGAPIC",64,0)
 F  S NUM1=$O(^PSB(53.79,NUM,.5,"B",NUM1)) Q:NUM1<1  S DONE=1 Q
"RTN","ORWGAPIC",65,0)
 I DONE Q NUM1
"RTN","ORWGAPIC",66,0)
 S DRUG=0
"RTN","ORWGAPIC",67,0)
 S NUM1=0
"RTN","ORWGAPIC",68,0)
 F  S NUM1=$O(^PSB(53.79,NUM,.6,"B",NUM1)) Q:NUM1<1  D  I DONE Q
"RTN","ORWGAPIC",69,0)
 . S DRUG=$$ADDDRUG(NUM1)
"RTN","ORWGAPIC",70,0)
 . I DRUG S DONE=1
"RTN","ORWGAPIC",71,0)
 I DONE Q DRUG
"RTN","ORWGAPIC",72,0)
 S DRUG=0
"RTN","ORWGAPIC",73,0)
 S NUM1=0
"RTN","ORWGAPIC",74,0)
 F  S NUM1=$O(^PSB(53.79,NUM,.7,"B",NUM1)) Q:NUM1<1  D  I DONE Q
"RTN","ORWGAPIC",75,0)
 . S DRUG=$$SOLDRUG(NUM1)
"RTN","ORWGAPIC",76,0)
 . I DRUG S DONE=1
"RTN","ORWGAPIC",77,0)
 I DONE Q DRUG
"RTN","ORWGAPIC",78,0)
 Q ""
"RTN","ORWGAPIC",79,0)
 ;
"RTN","ORWGAPIC",80,0)
DRUGC(VALUES) ; API - get drug classes   - from ORWGAPI
"RTN","ORWGAPIC",81,0)
 N CLASS,IEN,NUM,ROOT K VALUES
"RTN","ORWGAPIC",82,0)
 S NUM=0
"RTN","ORWGAPIC",83,0)
 S ROOT=$$ROOT^PSN50P65(1)
"RTN","ORWGAPIC",84,0)
 S CLASS=""
"RTN","ORWGAPIC",85,0)
 F  S CLASS=$O(@ROOT@(CLASS)) Q:CLASS=""  D
"RTN","ORWGAPIC",86,0)
 . S IEN=0
"RTN","ORWGAPIC",87,0)
 . F  S IEN=$O(@ROOT@(CLASS,IEN)) Q:IEN=""  D
"RTN","ORWGAPIC",88,0)
 .. S NUM=NUM+1
"RTN","ORWGAPIC",89,0)
 .. S VALUES(NUM)="50.605^"_IEN_U_CLASS
"RTN","ORWGAPIC",90,0)
 M ^TMP("ORWGRPC",$J)=VALUES K VALUES
"RTN","ORWGAPIC",91,0)
 Q
"RTN","ORWGAPIC",92,0)
 ;
"RTN","ORWGAPIC",93,0)
INSIG(NODE) ; $$(node) -> sig
"RTN","ORWGAPIC",94,0)
 N SIG,SUB,VALUES K VALUES
"RTN","ORWGAPIC",95,0)
 S SUB=$P($G(NODE),";",2)
"RTN","ORWGAPIC",96,0)
 D RXIN(NODE,.VALUES)
"RTN","ORWGAPIC",97,0)
 S SIG=""
"RTN","ORWGAPIC",98,0)
 I SUB=5 D
"RTN","ORWGAPIC",99,0)
 . S SIG="  Give: "_$G(VALUES("MR"))
"RTN","ORWGAPIC",100,0)
 . S SIG=SIG_" "_$P($G(VALUES("SCH",1,0)),U)
"RTN","ORWGAPIC",101,0)
 . S SIG=SIG_" "_$P($G(VALUES("SCH",1,0)),U,2)
"RTN","ORWGAPIC",102,0)
 I SUB="IV" D
"RTN","ORWGAPIC",103,0)
 . S SIG="  Give: "_$G(VALUES("DO"))
"RTN","ORWGAPIC",104,0)
 . S SIG=SIG_" "_$$EXT^ORWGAPIX($G(VALUES("START")),55.01,.02)
"RTN","ORWGAPIC",105,0)
 . S SIG=SIG_" "_$G(VALUES("SCH",1,0))
"RTN","ORWGAPIC",106,0)
 Q SIG
"RTN","ORWGAPIC",107,0)
 ;
"RTN","ORWGAPIC",108,0)
LAB(ORVALUE,NODE,ITEM) ; from ORWGAPI3
"RTN","ORWGAPIC",109,0)
 D LRPXRM^LRPXAPI(.ORVALUE,NODE,ITEM,"VSC")
"RTN","ORWGAPIC",110,0)
 Q
"RTN","ORWGAPIC",111,0)
 ;
"RTN","ORWGAPIC",112,0)
LABNAME(Y) ; $$(item ien) -> item name
"RTN","ORWGAPIC",113,0)
 I $P(Y,";")="A",$P(Y,";",2)="S" Q $P(Y,".",2,99)
"RTN","ORWGAPIC",114,0)
 Q $$ITEMNM^LRPXAPIU(Y)
"RTN","ORWGAPIC",115,0)
 ;
"RTN","ORWGAPIC",116,0)
LABSUM(ORDATA,DFN,DATE1,DATE2,ORSUB) ; from ORWGAPID
"RTN","ORWGAPIC",117,0)
 D EN^LR7OSUM(.ORDATA,DFN,DATE1,DATE2,,80,.ORSUB)
"RTN","ORWGAPIC",118,0)
 Q
"RTN","ORWGAPIC",119,0)
 ;
"RTN","ORWGAPIC",120,0)
LRDFN(DFN) ; $$(dfn) -> lrdfn
"RTN","ORWGAPIC",121,0)
 Q $$LRDFN^LRPXAPIU(DFN)
"RTN","ORWGAPIC",122,0)
 ;
"RTN","ORWGAPIC",123,0)
LRIDT(LRDT) ;  $$(date) -> inverse date
"RTN","ORWGAPIC",124,0)
 Q $$LRIDT^LRPXAPIU(LRDT)
"RTN","ORWGAPIC",125,0)
 ;
"RTN","ORWGAPIC",126,0)
NVASIG(NODE) ;  $$(node) -> sig on non-va drug
"RTN","ORWGAPIC",127,0)
 N RESULTS,SIG K RESULTS
"RTN","ORWGAPIC",128,0)
 I '$L(NODE) Q ""
"RTN","ORWGAPIC",129,0)
 D RXNVA(NODE,.RESULTS)
"RTN","ORWGAPIC",130,0)
 S SIG=RESULTS("DOSAGE")
"RTN","ORWGAPIC",131,0)
 S SIG=SIG_" "_RESULTS("MEDICATION ROUTE")
"RTN","ORWGAPIC",132,0)
 S SIG=SIG_" "_RESULTS("SCHEDULE")
"RTN","ORWGAPIC",133,0)
 Q SIG
"RTN","ORWGAPIC",134,0)
 ;
"RTN","ORWGAPIC",135,0)
NVAX(DFN) ; $$(dfn) -> 1 if patient has data else 0
"RTN","ORWGAPIC",136,0)
 Q $L($O(^PXRMINDX("55NVA","PI",+$G(DFN),"")))>0
"RTN","ORWGAPIC",137,0)
 ;
"RTN","ORWGAPIC",138,0)
POINAME(IEN) ; $$(poi entry) - > name and dosage form else ""
"RTN","ORWGAPIC",139,0)
 N NAME,RESULT K ^TMP($J,"RX")
"RTN","ORWGAPIC",140,0)
 I '$G(IEN) Q ""
"RTN","ORWGAPIC",141,0)
 D ZERO^PSS50P7(IEN,,,"RX")
"RTN","ORWGAPIC",142,0)
 S NAME=$P($G(^TMP($J,"RX",IEN,.01)),U)
"RTN","ORWGAPIC",143,0)
 K ^TMP($J,"RX")
"RTN","ORWGAPIC",144,0)
 I NAME'=" " Q NAME
"RTN","ORWGAPIC",145,0)
 Q ""
"RTN","ORWGAPIC",146,0)
 ;
"RTN","ORWGAPIC",147,0)
RXIN(NODE,ORVALUE) ; from ORWGAPI3
"RTN","ORWGAPIC",148,0)
 D OEL^PSJPXRM1(NODE,.ORVALUE)
"RTN","ORWGAPIC",149,0)
 Q
"RTN","ORWGAPIC",150,0)
 ;
"RTN","ORWGAPIC",151,0)
RXNUM(DFN,RXIEN) ; $$(dfn,prescription ien) -> rx#
"RTN","ORWGAPIC",152,0)
 N RXNUM K ^TMP($J,"RX")
"RTN","ORWGAPIC",153,0)
 S RXIEN=+$G(RXIEN)
"RTN","ORWGAPIC",154,0)
 D RX^PSO52API(DFN,"RX",RXIEN,,0)
"RTN","ORWGAPIC",155,0)
 S RXNUM=$G(^TMP($J,"RX",DFN,RXIEN,.01))
"RTN","ORWGAPIC",156,0)
 I $L(RXNUM) S RXNUM=" RX#: "_+RXNUM
"RTN","ORWGAPIC",157,0)
 K ^TMP($J,"RX")
"RTN","ORWGAPIC",158,0)
 Q RXNUM
"RTN","ORWGAPIC",159,0)
 ;
"RTN","ORWGAPIC",160,0)
RXNVA(NODE,ORVALUE,XSTART,XSTOP) ; from ORWGAPI1, ORWGAPI3, ORWGAPID
"RTN","ORWGAPIC",161,0)
 S XSTART=1,XSTOP=1
"RTN","ORWGAPIC",162,0)
 D NVA^PSOPXRM1(NODE,.ORVALUE)
"RTN","ORWGAPIC",163,0)
 I '$G(ORVALUE("START DATE")) D
"RTN","ORWGAPIC",164,0)
 . S ORVALUE("START DATE")=$G(ORVALUE("DOCUMENTED DATE"))
"RTN","ORWGAPIC",165,0)
 . S XSTART=0
"RTN","ORWGAPIC",166,0)
 I '$G(ORVALUE("DISCONTINUED DATE")) D
"RTN","ORWGAPIC",167,0)
 . S XSTOP=0
"RTN","ORWGAPIC",168,0)
 Q
"RTN","ORWGAPIC",169,0)
 ;
"RTN","ORWGAPIC",170,0)
RXOUT(NODE,ORVALUE) ; from ORWGAPI3
"RTN","ORWGAPIC",171,0)
 D PSRX^PSOPXRM1(NODE,.ORVALUE)
"RTN","ORWGAPIC",172,0)
 Q
"RTN","ORWGAPIC",173,0)
 ;
"RTN","ORWGAPIC",174,0)
SIG(DFN,RXIEN) ; $$(dfn,prescription ien) -> sig
"RTN","ORWGAPIC",175,0)
 N LNUM,SIG K ^TMP($J,"RX")
"RTN","ORWGAPIC",176,0)
 S RXIEN=+$G(RXIEN)
"RTN","ORWGAPIC",177,0)
 D RX^PSO52API(DFN,"RX",RXIEN,,"M",,)
"RTN","ORWGAPIC",178,0)
 S SIG=""
"RTN","ORWGAPIC",179,0)
 S LNUM=0
"RTN","ORWGAPIC",180,0)
 F  S LNUM=$O(^TMP($J,"RX",DFN,RXIEN,"M",LNUM)) Q:LNUM<1  D
"RTN","ORWGAPIC",181,0)
 . S SIG=SIG_$G(^TMP($J,"RX",DFN,RXIEN,"M",LNUM,0))_" "
"RTN","ORWGAPIC",182,0)
 I $L(SIG) S SIG="  Sig: "_$$LOW^ORWGAPIX(SIG)
"RTN","ORWGAPIC",183,0)
 K ^TMP($J,"RX")
"RTN","ORWGAPIC",184,0)
 Q SIG
"RTN","ORWGAPIC",185,0)
 ;
"RTN","ORWGAPIC",186,0)
SOLDRUG(IEN) ; $$(iv solution) -> drug in 50 else ""
"RTN","ORWGAPIC",187,0)
 N RESULT K ^TMP($J,"RX")
"RTN","ORWGAPIC",188,0)
 I '$G(IEN) Q ""
"RTN","ORWGAPIC",189,0)
 D ZERO^PSS52P7(IEN,,,"RX")
"RTN","ORWGAPIC",190,0)
 S RESULT=$P($G(^TMP($J,"RX",IEN,1)),U)
"RTN","ORWGAPIC",191,0)
 K ^TMP($J,"RX")
"RTN","ORWGAPIC",192,0)
 Q RESULT
"RTN","ORWGAPIC",193,0)
 ;
"RTN","ORWGAPIC",194,0)
TESTSPEC(DATA) ;  from ORWGAPI
"RTN","ORWGAPIC",195,0)
 N CNT,LINE,TEST,TMP,SPEC
"RTN","ORWGAPIC",196,0)
 D RETURN^ORWGAPIW(.TMP,.DATA)
"RTN","ORWGAPIC",197,0)
 S CNT=0
"RTN","ORWGAPIC",198,0)
 S TEST=0
"RTN","ORWGAPIC",199,0)
 F  S TEST=$O(^LAB(60,TEST)) Q:TEST<1  D
"RTN","ORWGAPIC",200,0)
 . S SPEC=0
"RTN","ORWGAPIC",201,0)
 . F  S SPEC=$O(^LAB(60,TEST,1,SPEC)) Q:SPEC<1  D
"RTN","ORWGAPIC",202,0)
 .. S CNT=CNT+1
"RTN","ORWGAPIC",203,0)
 .. S LINE=TEST_U_$G(^LAB(60,TEST,1,SPEC,0))
"RTN","ORWGAPIC",204,0)
 .. I $P(LINE,U,3)[$C(34) S $P(LINE,U,3)=$$TRIM^ORWGAPIX($P(LINE,U,3),"LR",$C(34))
"RTN","ORWGAPIC",205,0)
 .. I $P(LINE,U,4)[$C(34) S $P(LINE,U,4)=$$TRIM^ORWGAPIX($P(LINE,U,4),"LR",$C(34))
"RTN","ORWGAPIC",206,0)
 .. I TMP S ^TMP(DATA,$J,CNT)=LINE Q
"RTN","ORWGAPIC",207,0)
 .. S DATA(CNT)=LINE
"RTN","ORWGAPIC",208,0)
 Q
"RTN","ORWGAPIC",209,0)
 ;
"RTN","ORWGAPID")
0^125^B59091643
"RTN","ORWGAPID",1,0)
ORWGAPID ; SLC/STAFF - Graph API Details ;12/21/05  08:19
"RTN","ORWGAPID",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,243**;Dec 17, 1997;Build 242
"RTN","ORWGAPID",3,0)
 ;
"RTN","ORWGAPID",4,0)
DETAILS(DATA,DFN,DATE1,DATE2,FILEITEM) ; from ORWGAPI (series click)
"RTN","ORWGAPID",5,0)
 N ITEM,FILE,SUBHEAD,TYPEITEM K SUBHEAD,TYPEITEM
"RTN","ORWGAPID",6,0)
 K ^TMP("LR7OGX",$J),^TMP("LRC",$J)
"RTN","ORWGAPID",7,0)
 K ^TMP("ORLRC",$J),^TMP("PSBO",$J),^TMP("TIUVIEW",$J)
"RTN","ORWGAPID",8,0)
 S FILE=$P(FILEITEM,U)
"RTN","ORWGAPID",9,0)
 S ITEM=$$UP^ORWGAPIX($P(FILEITEM,U,2))
"RTN","ORWGAPID",10,0)
 I '$L(ITEM) Q
"RTN","ORWGAPID",11,0)
 D
"RTN","ORWGAPID",12,0)
 . I FILE=63 D  Q
"RTN","ORWGAPID",13,0)
 .. D INTERIM^ORWLRR(.DATA,DFN,DATE1,DATE2)
"RTN","ORWGAPID",14,0)
 .. M ^TMP("ORWGRPC",$J)=^TMP("LR7OGX",$J,"OUTPUT")
"RTN","ORWGAPID",15,0)
 . I FILE="63MI" D  Q
"RTN","ORWGAPID",16,0)
 .. D MICRO^ORWLRR(.DATA,DFN,DATE1,DATE2)
"RTN","ORWGAPID",17,0)
 .. M ^TMP("ORWGRPC",$J)=^TMP("LR7OGX",$J,"OUTPUT")
"RTN","ORWGAPID",18,0)
 . I FILE="63AP" D   Q
"RTN","ORWGAPID",19,0)
 .. S SUBHEAD("CYTOPATHOLOGY")=""
"RTN","ORWGAPID",20,0)
 .. S SUBHEAD("SURGICAL PATHOLOGY")=""
"RTN","ORWGAPID",21,0)
 .. S SUBHEAD("EM")=""
"RTN","ORWGAPID",22,0)
 .. S SUBHEAD("AUTOPSY")=""
"RTN","ORWGAPID",23,0)
 .. D LABSUM^ORWGAPIC(.DATA,DFN,DATE1,DATE2,.SUBHEAD)
"RTN","ORWGAPID",24,0)
 .. M ^TMP("ORWGRPC",$J)=^TMP("LRC",$J)
"RTN","ORWGAPID",25,0)
 . I FILE="63BB" D  Q
"RTN","ORWGAPID",26,0)
 .. D BLR^ORWRP1(.DATA,DFN,"",DATE1,DATE2)
"RTN","ORWGAPID",27,0)
 .. M ^TMP("ORWGRPC",$J)=^TMP("ORLRC",$J)
"RTN","ORWGAPID",28,0)
 . I FILE="53.79" D  Q
"RTN","ORWGAPID",29,0)
 .. ;D BCMA1^ORWRP1A(.DATA,DFN,"",DATE1,DATE2) ***** BA 12/14/07
"RTN","ORWGAPID",30,0)
 .. D BCMA1^ORWRP1A(.DATA,DFN,"",DATE2,DATE1)
"RTN","ORWGAPID",31,0)
 .. M ^TMP("ORWGRPC",$J)=^TMP("PSBO",$J)
"RTN","ORWGAPID",32,0)
 . I FILE="8925" D  Q
"RTN","ORWGAPID",33,0)
 .. D NOTE(.DATA,DFN,DATE1,DATE2,ITEM)
"RTN","ORWGAPID",34,0)
 .. ;M ^TMP("ORWGRPC",$J)=^TMP("TIUVIEW",$J)
"RTN","ORWGAPID",35,0)
 . S TYPEITEM(1)=FILE_"^0"
"RTN","ORWGAPID",36,0)
 . D DETAIL(.DATA,DFN,DATE1,DATE2,.TYPEITEM)
"RTN","ORWGAPID",37,0)
 K ^TMP("LR7OGX",$J),^TMP("LRC",$J)
"RTN","ORWGAPID",38,0)
 K ^TMP("ORLRC",$J),^TMP("PSBO",$J),^TMP("TIUVIEW",$J)
"RTN","ORWGAPID",39,0)
 Q
"RTN","ORWGAPID",40,0)
 ;
"RTN","ORWGAPID",41,0)
DETAIL(DATA,DFN,DATE1,DATE2,TYPEITEM) ; from ORWGAPI (legend click)
"RTN","ORWGAPID",42,0)
 N CNT,FILE,GMTSPX1,GMTSPX2,ITEM,TITEMS,TYPE
"RTN","ORWGAPID",43,0)
 N COMP,NEWITEMS K COMP,NEWITEMS
"RTN","ORWGAPID",44,0)
 K ^TMP("ORDATA",$J)
"RTN","ORWGAPID",45,0)
 S DFN=+$G(DFN) I 'DFN Q
"RTN","ORWGAPID",46,0)
 I '$L($O(TYPEITEM(0))) Q
"RTN","ORWGAPID",47,0)
 S TYPE=""
"RTN","ORWGAPID",48,0)
 F  S TYPE=$O(TYPEITEM(TYPE)) Q:TYPE=""  D
"RTN","ORWGAPID",49,0)
 . S TITEMS=TYPEITEM(TYPE)
"RTN","ORWGAPID",50,0)
 . S FILE=$P(TITEMS,U) I '$L(FILE) Q
"RTN","ORWGAPID",51,0)
 . S ITEM=$P(TITEMS,U,2) I '$L(ITEM) Q
"RTN","ORWGAPID",52,0)
 . S NEWITEMS(FILE,ITEM)=""
"RTN","ORWGAPID",53,0)
 S CNT=0
"RTN","ORWGAPID",54,0)
 S FILE=""
"RTN","ORWGAPID",55,0)
 F  S FILE=$O(NEWITEMS(FILE)) Q:FILE=""  D
"RTN","ORWGAPID",56,0)
 . S CNT=CNT+1
"RTN","ORWGAPID",57,0)
 . S COMP(CNT)=$$COMPTYPE^ORWGAPIT(FILE)
"RTN","ORWGAPID",58,0)
 S GMTSPX1=DATE1,GMTSPX2=DATE2
"RTN","ORWGAPID",59,0)
 D REPORT^ORWRP2(.DATA,.COMP,DFN)
"RTN","ORWGAPID",60,0)
 M ^TMP("ORWGRPC",$J)=^TMP("ORDATA",$J)
"RTN","ORWGAPID",61,0)
 ;K ^TMP("ORDATA",$J)
"RTN","ORWGAPID",62,0)
 ;Q
"RTN","ORWGAPID",63,0)
 ;
"RTN","ORWGAPID",64,0)
 S CNT=0
"RTN","ORWGAPID",65,0)
 S TYPE=""
"RTN","ORWGAPID",66,0)
 F  S TYPE=$O(TYPEITEM(TYPE)) Q:TYPE=""  D
"RTN","ORWGAPID",67,0)
 . S TITEMS=TYPEITEM(TYPE)
"RTN","ORWGAPID",68,0)
 . S CNT=CNT+1
"RTN","ORWGAPID",69,0)
 . S ^TMP("ORWGRPC",$J,CNT/10000)="~~~^"_TITEMS
"RTN","ORWGAPID",70,0)
 ;
"RTN","ORWGAPID",71,0)
 K ^TMP("ORDATA",$J)
"RTN","ORWGAPID",72,0)
 Q
"RTN","ORWGAPID",73,0)
 ;
"RTN","ORWGAPID",74,0)
GETDATES(DATA,REPORTID) ; from ORWGAPI
"RTN","ORWGAPID",75,0)
 N DAT,TMP K DAT
"RTN","ORWGAPID",76,0)
 D RETURN^ORWGAPIW(.TMP,.DATA)
"RTN","ORWGAPID",77,0)
 S DAT(1)="S^Date Range..."
"RTN","ORWGAPID",78,0)
 S DAT(2)="1^Today"
"RTN","ORWGAPID",79,0)
 S DAT(3)="2^One Week"
"RTN","ORWGAPID",80,0)
 S DAT(4)="3^Two Weeks"
"RTN","ORWGAPID",81,0)
 S DAT(5)="4^One Month"
"RTN","ORWGAPID",82,0)
 S DAT(6)="5^Six Months"
"RTN","ORWGAPID",83,0)
 S DAT(7)="6^One Year"
"RTN","ORWGAPID",84,0)
 S DAT(8)="7^Two Years"
"RTN","ORWGAPID",85,0)
 S DAT(9)="8^All Results"
"RTN","ORWGAPID",86,0)
 D DATES^ORWGAPIP(.DAT,REPORTID)
"RTN","ORWGAPID",87,0)
 I TMP M ^TMP(DATA,$J)=DAT
"RTN","ORWGAPID",88,0)
 I 'TMP M DATA=DAT
"RTN","ORWGAPID",89,0)
 Q
"RTN","ORWGAPID",90,0)
 ;
"RTN","ORWGAPID",91,0)
NOTE(DATA,DFN,DATE1,DATE2,ITEM) ;
"RTN","ORWGAPID",92,0)
 N CNT,DATE,DOC,DOCCLASS,DOCTYPE,DUM,IEN,LINE,NUM,RESULTS K DUM
"RTN","ORWGAPID",93,0)
 K ^TMP("TIUR",$J),^TMP("TIUVIEW",$J)
"RTN","ORWGAPID",94,0)
 S CNT=$G(CNT)
"RTN","ORWGAPID",95,0)
 F DOCTYPE="P","D","C" D
"RTN","ORWGAPID",96,0)
 . S DOCCLASS=$$DOCCLASS^ORWGAPIA(DOCTYPE)
"RTN","ORWGAPID",97,0)
 . K ^TMP("TIUR",$J)
"RTN","ORWGAPID",98,0)
 . D TIU^ORWGAPIA(.DUM,DOCCLASS,5,DFN,DATE1,DATE2)
"RTN","ORWGAPID",99,0)
 . S DOC=0
"RTN","ORWGAPID",100,0)
 . F  S DOC=$O(^TMP("TIUR",$J,DOC)) Q:DOC<1  D
"RTN","ORWGAPID",101,0)
 .. S RESULTS=^TMP("TIUR",$J,DOC)
"RTN","ORWGAPID",102,0)
 .. S IEN=+$P(RESULTS,U)
"RTN","ORWGAPID",103,0)
 .. K ^TMP("TIUVIEW",$J)
"RTN","ORWGAPID",104,0)
 .. D GETTIU^ORWGAPIA(.DATA,IEN)
"RTN","ORWGAPID",105,0)
 .. S NUM=0
"RTN","ORWGAPID",106,0)
 .. F  S NUM=$O(^TMP("TIUVIEW",$J,NUM)) Q:NUM<1  D
"RTN","ORWGAPID",107,0)
 ... S LINE=$G(^TMP("TIUVIEW",$J,NUM))
"RTN","ORWGAPID",108,0)
 ... S CNT=CNT+1
"RTN","ORWGAPID",109,0)
 ... S ^TMP("ORWGRPC",$J,CNT)=LINE
"RTN","ORWGAPID",110,0)
 .. I CNT>1 D
"RTN","ORWGAPID",111,0)
 ... S CNT=CNT+1
"RTN","ORWGAPID",112,0)
 ... S ^TMP("ORWGRPC",$J,CNT)=" "
"RTN","ORWGAPID",113,0)
 ... S CNT=CNT+1
"RTN","ORWGAPID",114,0)
 ... S ^TMP("ORWGRPC",$J,CNT)=" "
"RTN","ORWGAPID",115,0)
 ... S ^TMP("ORWGRPC",$J,CNT/10000)="~~~^"_^TMP("TIUR",$J,DOC)
"RTN","ORWGAPID",116,0)
 K ^TMP("TIUR",$J),^TMP("TIUVIEW",$J)
"RTN","ORWGAPID",117,0)
 Q
"RTN","ORWGAPID",118,0)
 ;
"RTN","ORWGAPID",119,0)
TAX(DATA,ALL,REMTAX) ; from ORWGAPI
"RTN","ORWGAPID",120,0)
 N CNT,REM,CODE,NUM,TMP
"RTN","ORWGAPID",121,0)
 K ^TMP("ORWG TEMP",$J)
"RTN","ORWGAPID",122,0)
 D RETURN^ORWGAPIW(.TMP,.DATA)
"RTN","ORWGAPID",123,0)
 S CNT=0
"RTN","ORWGAPID",124,0)
 S REM=0
"RTN","ORWGAPID",125,0)
 I ALL F  S REM=$O(^PXD(811.2,REM)) Q:REM<1  D TEMP(REM)
"RTN","ORWGAPID",126,0)
 I 'ALL D
"RTN","ORWGAPID",127,0)
 . S NUM=0
"RTN","ORWGAPID",128,0)
 . F  S NUM=$O(REMTAX(NUM)) Q:NUM<1  D
"RTN","ORWGAPID",129,0)
 .. S REM=REMTAX(NUM)
"RTN","ORWGAPID",130,0)
 .. D TEMP(REM)
"RTN","ORWGAPID",131,0)
 S CODE=""
"RTN","ORWGAPID",132,0)
 F  S CODE=$O(^TMP("ORWG TEMP",$J,CODE)) Q:CODE=""  D
"RTN","ORWGAPID",133,0)
 . D SETUP^ORWGAPIW(.DATA,CODE,TMP,.CNT)
"RTN","ORWGAPID",134,0)
 K ^TMP("ORWG TEMP",$J)
"RTN","ORWGAPID",135,0)
 Q
"RTN","ORWGAPID",136,0)
 ;
"RTN","ORWGAPID",137,0)
TEMP(REM) ;
"RTN","ORWGAPID",138,0)
 N NODE,NUM,SUB
"RTN","ORWGAPID",139,0)
 I $P($G(^PXD(811.2,REM,0)),U,6)=1 Q
"RTN","ORWGAPID",140,0)
 F SUB=80,80.1,81 D
"RTN","ORWGAPID",141,0)
 . S NUM=0
"RTN","ORWGAPID",142,0)
 . F  S NUM=$O(^PXD(811.3,REM,SUB,NUM)) Q:NUM<1  D
"RTN","ORWGAPID",143,0)
 .. S NODE=+$G(^PXD(811.3,REM,SUB,NUM,0))
"RTN","ORWGAPID",144,0)
 .. I 'NODE Q
"RTN","ORWGAPID",145,0)
 .. I SUB=80 D  Q
"RTN","ORWGAPID",146,0)
 ... S ^TMP("ORWG TEMP",$J,"45DX;"_NODE)=""
"RTN","ORWGAPID",147,0)
 ... S ^TMP("ORWG TEMP",$J,"9000010.07;"_NODE)=""
"RTN","ORWGAPID",148,0)
 ... S ^TMP("ORWG TEMP",$J,"9000011;"_NODE)=""
"RTN","ORWGAPID",149,0)
 .. I SUB=80.1 D  Q
"RTN","ORWGAPID",150,0)
 ... S ^TMP("ORWG TEMP",$J,"45OP;"_NODE)=""
"RTN","ORWGAPID",151,0)
 .. I SUB=81 D  Q
"RTN","ORWGAPID",152,0)
 ... S ^TMP("ORWG TEMP",$J,"9000010.18;"_NODE)=""
"RTN","ORWGAPID",153,0)
 Q
"RTN","ORWGAPID",154,0)
 ;
"RTN","ORWGAPID",155,0)
PLX2(ITEMS,DFN,FMT,OLDEST,NEWEST,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPID",156,0)
 N DATE,DTONSET,DTPLUS1,DTRESOLV,NODE,PRIORITY,PROB,PROBDX,PSTATUS,RESULT,STATUS,VALUE
"RTN","ORWGAPID",157,0)
 K ^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPID",158,0)
 S DTPLUS1=$$FMADD^ORWGAPIX(DT,1)
"RTN","ORWGAPID",159,0)
 S STATUS=""
"RTN","ORWGAPID",160,0)
 F  S STATUS=$O(^PXRMINDX(9000011,"PSPI",DFN,STATUS)) Q:STATUS=""  D
"RTN","ORWGAPID",161,0)
 . S PRIORITY=""
"RTN","ORWGAPID",162,0)
 . F  S PRIORITY=$O(^PXRMINDX(9000011,"PSPI",DFN,STATUS,PRIORITY)) Q:PRIORITY=""  D
"RTN","ORWGAPID",163,0)
 .. S ITEM=""
"RTN","ORWGAPID",164,0)
 .. F  S ITEM=$O(^PXRMINDX(9000011,"PSPI",DFN,STATUS,PRIORITY,ITEM)) Q:ITEM=""  D
"RTN","ORWGAPID",165,0)
 ... S DATE=""
"RTN","ORWGAPID",166,0)
 ... F  S DATE=$O(^PXRMINDX(9000011,"PSPI",DFN,STATUS,PRIORITY,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPID",167,0)
 .... S NODE=""
"RTN","ORWGAPID",168,0)
 .... F  S NODE=$O(^PXRMINDX(9000011,"PSPI",DFN,STATUS,PRIORITY,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPID",169,0)
 ..... D PROB^ORWGAPIA(.PROB,.PSTATUS,.PROBDX,.DTONSET,.DTRESOLV,NODE)
"RTN","ORWGAPID",170,0)
 ..... I 'DTRESOLV S ^TMP("ORWGRPC TEMP",$J,PROBDX,DTONSET)=DTPLUS1 Q
"RTN","ORWGAPID",171,0)
 ..... S ^TMP("ORWGRPC TEMP",$J,PROBDX,DTONSET)=DTRESOLV
"RTN","ORWGAPID",172,0)
 S PROB=""
"RTN","ORWGAPID",173,0)
 F  S PROB=$O(^TMP("ORWGRPC TEMP",$J,PROB)) Q:PROB=""  D
"RTN","ORWGAPID",174,0)
 . S VALUE=$$EVALUE^ORWGAPIU(PROB,9000011,.01)
"RTN","ORWGAPID",175,0)
 . I FMT=0 D
"RTN","ORWGAPID",176,0)
 .. S CNT=CNT+1
"RTN","ORWGAPID",177,0)
 .. S RESULT=9999911_U_PROB_U_VALUE
"RTN","ORWGAPID",178,0)
 .. D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPID",179,0)
 . I FMT=6 D
"RTN","ORWGAPID",180,0)
 .. S OK=0
"RTN","ORWGAPID",181,0)
 .. S DATE=0
"RTN","ORWGAPID",182,0)
 .. F  S DATE=$O(^TMP("ORWGRPC TEMP",$J,PROB,DATE)) Q:DATE=""  Q:DATE>NEWEST  D  Q:OK
"RTN","ORWGAPID",183,0)
 ... S DTRESOLV=^TMP("ORWGRPC TEMP",$J,PROB,DATE)
"RTN","ORWGAPID",184,0)
 ... I DTRESOLV<OLDEST Q
"RTN","ORWGAPID",185,0)
 ... S CNT=CNT+1
"RTN","ORWGAPID",186,0)
 ... S OK=1
"RTN","ORWGAPID",187,0)
 ... S RESULT=9999911_U_PROB
"RTN","ORWGAPID",188,0)
 .. I OK D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPID",189,0)
 . I FMT=3 D
"RTN","ORWGAPID",190,0)
 .. S DATE=$O(^TMP("ORWGRPC TEMP",$J,PROB,""),-1)
"RTN","ORWGAPID",191,0)
 .. I 'DATE Q
"RTN","ORWGAPID",192,0)
 .. S CNT=CNT+1
"RTN","ORWGAPID",193,0)
 .. S RESULT=9999911_U_PROB_"^^"_VALUE_"^^"_DATE
"RTN","ORWGAPID",194,0)
 .. D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPID",195,0)
 K ^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPID",196,0)
 Q
"RTN","ORWGAPID",197,0)
 ;
"RTN","ORWGAPID",198,0)
PROBX4(DATA,ITEM,START,DFN,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPID",199,0)
 N DATE,DTONSET,DTPLUS1,DTRESOLV,NODE,PRIORITY,PROB,PROBDX,PSTATUS,RESULT,STATUS,VALUE
"RTN","ORWGAPID",200,0)
 K ^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPID",201,0)
 S CNT=$G(CNT),DTPLUS1=$$FMADD^ORWGAPIX(DT,1)
"RTN","ORWGAPID",202,0)
 S STATUS=""
"RTN","ORWGAPID",203,0)
 F  S STATUS=$O(^PXRMINDX(9000011,"PSPI",DFN,STATUS)) Q:STATUS=""  D
"RTN","ORWGAPID",204,0)
 . S PRIORITY=""
"RTN","ORWGAPID",205,0)
 . F  S PRIORITY=$O(^PXRMINDX(9000011,"PSPI",DFN,STATUS,PRIORITY)) Q:PRIORITY=""  D
"RTN","ORWGAPID",206,0)
 .. S DATE=""
"RTN","ORWGAPID",207,0)
 .. F  S DATE=$O(^PXRMINDX(9000011,"PSPI",DFN,STATUS,PRIORITY,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPID",208,0)
 ... I DATE>START Q
"RTN","ORWGAPID",209,0)
 ... S NODE=""
"RTN","ORWGAPID",210,0)
 ... F  S NODE=$O(^PXRMINDX(9000011,"PSPI",DFN,STATUS,PRIORITY,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPID",211,0)
 .... S ^TMP("ORWGRPC TEMP",$J,NODE)=""
"RTN","ORWGAPID",212,0)
 S NODE=""
"RTN","ORWGAPID",213,0)
 F  S NODE=$O(^TMP("ORWGRPC TEMP",$J,NODE)) Q:NODE=""  D
"RTN","ORWGAPID",214,0)
 . D PROB^ORWGAPIA(.PROB,.PSTATUS,.PROBDX,.DTONSET,.DTRESOLV,NODE)
"RTN","ORWGAPID",215,0)
 . I 'DTONSET Q
"RTN","ORWGAPID",216,0)
 . I 'DTRESOLV S DTRESOLV=DTPLUS1
"RTN","ORWGAPID",217,0)
 . S RESULT=9999911_U_PROBDX_U_DTONSET_U_DTRESOLV_U_$$EXT^ORWGAPIX(PSTATUS,9000011,.12)
"RTN","ORWGAPID",218,0)
 . D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPID",219,0)
 K ^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPID",220,0)
 Q
"RTN","ORWGAPID",221,0)
 ;
"RTN","ORWGAPIE")
0^126^B14227801
"RTN","ORWGAPIE",1,0)
ORWGAPIE ; SLC/STAFF - Graph API Details, Medicine, NVAMeds ;12/21/05  08:19
"RTN","ORWGAPIE",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORWGAPIE",3,0)
 ;
"RTN","ORWGAPIE",4,0)
MED1(ITEMS,DFN,FMT,OLDEST,NEWEST,CNT,TMP) ; from ORWGAPI1
"RTN","ORWGAPIE",5,0)
 N DATE,ITEM,OK,MEDARRAY,RESULT K MEDARRAY
"RTN","ORWGAPIE",6,0)
 D MEDICINE^ORWGAPIA(.MEDARRAY,DFN)
"RTN","ORWGAPIE",7,0)
 S ITEM=0
"RTN","ORWGAPIE",8,0)
 F  S ITEM=$O(MEDARRAY(ITEM)) Q:ITEM<1  D
"RTN","ORWGAPIE",9,0)
 . S OK=0
"RTN","ORWGAPIE",10,0)
 . I FMT=6 D
"RTN","ORWGAPIE",11,0)
 .. S DATE=OLDEST
"RTN","ORWGAPIE",12,0)
 .. F  S DATE=$O(MEDARRAY(ITEM,DATE)) Q:DATE=""  Q:DATE>NEWEST  D  Q:OK
"RTN","ORWGAPIE",13,0)
 ... S CNT=CNT+1
"RTN","ORWGAPIE",14,0)
 ... S OK=1
"RTN","ORWGAPIE",15,0)
 ... S RESULT=690_U_ITEM
"RTN","ORWGAPIE",16,0)
 ... D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPIE",17,0)
 . I FMT'=6 D
"RTN","ORWGAPIE",18,0)
 .. S DATE=$O(MEDARRAY(ITEM,""),-1)
"RTN","ORWGAPIE",19,0)
 .. I 'DATE Q
"RTN","ORWGAPIE",20,0)
 .. S NAME=MEDARRAY(ITEM,DATE)
"RTN","ORWGAPIE",21,0)
 .. I '$L(NAME) Q
"RTN","ORWGAPIE",22,0)
 .. S CNT=CNT+1
"RTN","ORWGAPIE",23,0)
 .. S OK=1
"RTN","ORWGAPIE",24,0)
 .. I FMT=3 S RESULT=690_U_ITEM_"^^"_NAME_"^^"_DATE
"RTN","ORWGAPIE",25,0)
 .. I FMT=0 S RESULT=690_U_ITEM_U_NAME
"RTN","ORWGAPIE",26,0)
 . I OK D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPIE",27,0)
 Q
"RTN","ORWGAPIE",28,0)
 ;
"RTN","ORWGAPIE",29,0)
MED3(DATA,ITEM,START,DFN,CNT,TMP) ; from ORWGAPI3
"RTN","ORWGAPIE",30,0)
 N DATE,DATE2,DATESTOP,DATESTRT,DTPLUS1,NODE,RESULT,STATUS,VALUE K VALUE
"RTN","ORWGAPIE",31,0)
 D MEDICINE^ORWGAPIA(.MEDARRAY,DFN)
"RTN","ORWGAPIE",32,0)
 S ITEM=+$G(ITEM)
"RTN","ORWGAPIE",33,0)
 S CNT=$G(CNT)
"RTN","ORWGAPIE",34,0)
 S DATE=""
"RTN","ORWGAPIE",35,0)
 F  S DATE=$O(MEDARRAY(ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPIE",36,0)
 . I DATE>START Q
"RTN","ORWGAPIE",37,0)
 . S RESULT=690_U_ITEM_U_DATE_"^^"
"RTN","ORWGAPIE",38,0)
 . D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPIE",39,0)
 Q
"RTN","ORWGAPIE",40,0)
 ;
"RTN","ORWGAPIE",41,0)
NVA1(ITEMS,DFN,FMT,OLDEST,NEWEST,CNT,TMP) ; from ORWGAPI1
"RTN","ORWGAPIE",42,0)
 N DATA,DATE,DATE1,DATESTRT,DRUG,ITEM,OK,REF,RESULT K DATA
"RTN","ORWGAPIE",43,0)
 S ITEM=""
"RTN","ORWGAPIE",44,0)
 F  S ITEM=$O(^PXRMINDX("55NVA","PI",DFN,ITEM)) Q:ITEM=""  D
"RTN","ORWGAPIE",45,0)
 . S OK=0
"RTN","ORWGAPIE",46,0)
 . I FMT=6 D
"RTN","ORWGAPIE",47,0)
 .. S DATE=0
"RTN","ORWGAPIE",48,0)
 .. F  S DATE=$O(^PXRMINDX("55NVA","PI",DFN,ITEM,DATE)) Q:DATE=""  Q:DATE>NEWEST  D  Q:OK
"RTN","ORWGAPIE",49,0)
 ... S DATE1=""
"RTN","ORWGAPIE",50,0)
 ... F  S DATE1=$O(^PXRMINDX("55NVA","PI",DFN,ITEM,DATE,DATE1)) Q:DATE1=""  D  Q:OK
"RTN","ORWGAPIE",51,0)
 .... I DATE1'["U",DATE1<OLDEST Q
"RTN","ORWGAPIE",52,0)
 .... S CNT=CNT+1
"RTN","ORWGAPIE",53,0)
 .... S OK=1
"RTN","ORWGAPIE",54,0)
 .... S RESULT="55NVA"_U_ITEM
"RTN","ORWGAPIE",55,0)
 . I FMT'=6 D
"RTN","ORWGAPIE",56,0)
 .. S DATE=$O(^PXRMINDX("55NVA","PI",DFN,ITEM,""),-1)
"RTN","ORWGAPIE",57,0)
 .. I 'DATE Q
"RTN","ORWGAPIE",58,0)
 .. S DATE1=$O(^PXRMINDX("55NVA","PI",DFN,ITEM,DATE,""),-1)
"RTN","ORWGAPIE",59,0)
 .. I '$L(DATE1) Q
"RTN","ORWGAPIE",60,0)
 .. S REF=$O(^PXRMINDX("55NVA","PI",DFN,ITEM,DATE,DATE1,""),-1)
"RTN","ORWGAPIE",61,0)
 .. I '$L(REF) Q
"RTN","ORWGAPIE",62,0)
 .. D RXNVA^ORWGAPIC(REF,.DATA)
"RTN","ORWGAPIE",63,0)
 .. S DRUG=+$G(DATA("DISPENSE DRUG"))
"RTN","ORWGAPIE",64,0)
 .. S DATESTRT=+$G(DATA("START DATE"))
"RTN","ORWGAPIE",65,0)
 .. I 'DATESTRT Q
"RTN","ORWGAPIE",66,0)
 .. S CNT=CNT+1
"RTN","ORWGAPIE",67,0)
 .. S OK=1
"RTN","ORWGAPIE",68,0)
 .. I FMT=3 S RESULT="55NVA"_U_ITEM_"^^"_$$EVALUE^ORWGAPIU(ITEM,"55NVA",.01)_"^^"_DATESTRT
"RTN","ORWGAPIE",69,0)
 .. I FMT=0 S RESULT="55NVA"_U_ITEM_U_$$EVALUE^ORWGAPIU(ITEM,"55NVA",.01)
"RTN","ORWGAPIE",70,0)
 .. I DRUG S RESULT=RESULT_U_$$DRGCLASS^ORWGAPIC(DRUG)
"RTN","ORWGAPIE",71,0)
 . I OK D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPIE",72,0)
 Q
"RTN","ORWGAPIE",73,0)
 ;
"RTN","ORWGAPIE",74,0)
NVA3(DATA,ITEM,START,DFN,CNT,TMP) ; from ORWGAPI3
"RTN","ORWGAPIE",75,0)
 N DATE1,DATE2,DATESTOP,DATESTRT,DTPLUS1,NODE,RESULT,STATUS,VALUE K VALUE
"RTN","ORWGAPIE",76,0)
 S CNT=$G(CNT),DTPLUS1=$$FMADD^ORWGAPIX(DT,1)
"RTN","ORWGAPIE",77,0)
 S DATE1=""
"RTN","ORWGAPIE",78,0)
 F  S DATE1=$O(^PXRMINDX("55NVA","PI",DFN,ITEM,DATE1)) Q:DATE1=""  D
"RTN","ORWGAPIE",79,0)
 . I DATE1>START Q
"RTN","ORWGAPIE",80,0)
 . S DATE2=""
"RTN","ORWGAPIE",81,0)
 . F  S DATE2=$O(^PXRMINDX("55NVA","PI",DFN,ITEM,DATE1,DATE2)) Q:DATE2=""  D
"RTN","ORWGAPIE",82,0)
 .. S NODE=""
"RTN","ORWGAPIE",83,0)
 .. F  S NODE=$O(^PXRMINDX("55NVA","PI",DFN,ITEM,DATE1,DATE2,NODE)) Q:NODE=""  D
"RTN","ORWGAPIE",84,0)
 ... D RXNVA^ORWGAPIC(NODE,.VALUE)
"RTN","ORWGAPIE",85,0)
 ... S STATUS=$G(VALUE("STATUS"))
"RTN","ORWGAPIE",86,0)
 ... S DATESTRT=+$G(VALUE("START DATE"))
"RTN","ORWGAPIE",87,0)
 ... I 'DATESTRT Q
"RTN","ORWGAPIE",88,0)
 ... S DATESTOP=+$G(VALUE("DISCONTINUED DATE"))
"RTN","ORWGAPIE",89,0)
 ... I 'DATESTOP S DATESTOP=DTPLUS1
"RTN","ORWGAPIE",90,0)
 ... S STATUS=STATUS_"  "_$$NVASIG^ORWGAPIC(NODE)
"RTN","ORWGAPIE",91,0)
 ... S RESULT="55NVA"_U_ITEM_U_DATESTRT_U_DATESTOP_U_STATUS
"RTN","ORWGAPIE",92,0)
 ... D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPIE",93,0)
 Q
"RTN","ORWGAPIE",94,0)
 ;
"RTN","ORWGAPIF")
0^127^B5028214
"RTN","ORWGAPIF",1,0)
ORWGAPIF ; SLC/STAFF - Graph Fast Data Retrieval ;11/1/06  12:49
"RTN","ORWGAPIF",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORWGAPIF",3,0)
 ;
"RTN","ORWGAPIF",4,0)
FASTDATA(DATA,DFN) ; from ORWGAPI
"RTN","ORWGAPIF",5,0)
 I '$G(DFN) Q
"RTN","ORWGAPIF",6,0)
 D FAST(.DATA,DFN,"ALL DATA")
"RTN","ORWGAPIF",7,0)
 Q
"RTN","ORWGAPIF",8,0)
 ;
"RTN","ORWGAPIF",9,0)
FASTITEM(DATA,DFN) ; from ORWGAPI
"RTN","ORWGAPIF",10,0)
 I '$G(DFN) Q
"RTN","ORWGAPIF",11,0)
 D FAST(.DATA,DFN,"ALL ITEMS")
"RTN","ORWGAPIF",12,0)
 Q
"RTN","ORWGAPIF",13,0)
 ;
"RTN","ORWGAPIF",14,0)
FASTLABS(DATA,DFN) ; from ORWGAPI
"RTN","ORWGAPIF",15,0)
 I '$G(DFN) Q
"RTN","ORWGAPIF",16,0)
 D FAST(.DATA,DFN,"ALL LABS")
"RTN","ORWGAPIF",17,0)
 Q
"RTN","ORWGAPIF",18,0)
 ;
"RTN","ORWGAPIF",19,0)
FAST(DATA,DFN,SOURCE) ;
"RTN","ORWGAPIF",20,0)
 I '$L($G(^XTMP("ORGRAPH",0))) Q
"RTN","ORWGAPIF",21,0)
 I '$G(DFN) Q
"RTN","ORWGAPIF",22,0)
 I '$G(DUZ) Q
"RTN","ORWGAPIF",23,0)
 N OK,PATUSER
"RTN","ORWGAPIF",24,0)
 S PATUSER=DFN_U_DUZ
"RTN","ORWGAPIF",25,0)
 S OK=0
"RTN","ORWGAPIF",26,0)
 I $L($O(^XTMP("ORGRAPH",SOURCE,PATUSER,""))) S OK=1
"RTN","ORWGAPIF",27,0)
 D LOG(DFN,DUZ,SOURCE)
"RTN","ORWGAPIF",28,0)
 I 'OK Q
"RTN","ORWGAPIF",29,0)
 L +^XTMP("ORGRAPH",SOURCE,PATUSER):3 I '$T Q  ; wait 3 sec for merge
"RTN","ORWGAPIF",30,0)
 S DATA=$NA(^XTMP("ORGRAPH",SOURCE,PATUSER))
"RTN","ORWGAPIF",31,0)
 L -^XTMP("ORGRAPH",SOURCE,PATUSER)
"RTN","ORWGAPIF",32,0)
 Q
"RTN","ORWGAPIF",33,0)
 ;
"RTN","ORWGAPIF",34,0)
LOG(DFN,USER,SOURCE) ;
"RTN","ORWGAPIF",35,0)
 N GOLD,GNOW,GSTAMP,PATUSER,LINE,SIZE
"RTN","ORWGAPIF",36,0)
 S GOLD=$G(^XTMP("ORGDATA","QT",USER_U_DFN))
"RTN","ORWGAPIF",37,0)
 I 'GOLD Q
"RTN","ORWGAPIF",38,0)
 S GSTAMP=GOLD_U_USER_U_DFN
"RTN","ORWGAPIF",39,0)
 S PATUSER=DFN_U_USER
"RTN","ORWGAPIF",40,0)
 I '$D(^XTMP("ORGDATA","Q",GSTAMP)) Q
"RTN","ORWGAPIF",41,0)
 S GNOW=$$MNOW^ORWGTASK
"RTN","ORWGAPIF",42,0)
 S SIZE=0
"RTN","ORWGAPIF",43,0)
 S LINE=""
"RTN","ORWGAPIF",44,0)
 F  S LINE=$O(^XTMP("ORGRAPH",SOURCE,PATUSER,LINE)) Q:LINE=""  D
"RTN","ORWGAPIF",45,0)
 . S SIZE=$L(^XTMP("ORGRAPH",SOURCE,PATUSER,LINE))+SIZE
"RTN","ORWGAPIF",46,0)
 I SOURCE="ALL ITEMS" D  Q
"RTN","ORWGAPIF",47,0)
 . S $P(^XTMP("ORGDATA","Q",GSTAMP),U,13)=SIZE
"RTN","ORWGAPIF",48,0)
 . I $P($G(^XTMP("ORGDATA","Q",GSTAMP)),U,10)<1 D
"RTN","ORWGAPIF",49,0)
 .. D GSTAMP^ORWGTASK(GSTAMP,GOLD,GNOW,9)
"RTN","ORWGAPIF",50,0)
 . S $P(^XTMP("ORGDATA","Q",GSTAMP),U,10)=(1+$P($G(^XTMP("ORGDATA","Q",GSTAMP)),U,10))
"RTN","ORWGAPIF",51,0)
 I SOURCE="ALL LABS" D  Q
"RTN","ORWGAPIF",52,0)
 . S $P(^XTMP("ORGDATA","Q",GSTAMP),U,14)=SIZE
"RTN","ORWGAPIF",53,0)
 . D GSTAMP^ORWGTASK(GSTAMP,GOLD,GNOW,11)
"RTN","ORWGAPIF",54,0)
 I SOURCE="ALL DATA" D  Q
"RTN","ORWGAPIF",55,0)
 . S $P(^XTMP("ORGDATA","Q",GSTAMP),U,15)=SIZE
"RTN","ORWGAPIF",56,0)
 . D GSTAMP^ORWGTASK(GSTAMP,GOLD,GNOW,12)
"RTN","ORWGAPIF",57,0)
 Q
"RTN","ORWGAPIF",58,0)
 ;
"RTN","ORWGAPIP")
0^128^B70762744
"RTN","ORWGAPIP",1,0)
ORWGAPIP ; SLC/STAFF - Graph Parameters ;11/20/06  08:59
"RTN","ORWGAPIP",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,260,243**;Dec 17, 1997;Build 242
"RTN","ORWGAPIP",3,0)
 ;
"RTN","ORWGAPIP",4,0)
ALLVIEWS(DATA,VTYPE,USER) ; from ORWGAPI
"RTN","ORWGAPIP",5,0)
 N CNT,ENT,NUM,NUM1,PARAM,PROF,RESULT,TEST,TG,TGNUM,TGNAME,TMP,VIEW,VNUM K PROF,VIEW
"RTN","ORWGAPIP",6,0)
 D RETURN^ORWGAPIW(.TMP,.DATA)
"RTN","ORWGAPIP",7,0)
 S CNT=0
"RTN","ORWGAPIP",8,0)
 I VTYPE=-2 D
"RTN","ORWGAPIP",9,0)
 . S ENT="SYS"
"RTN","ORWGAPIP",10,0)
 . S USER=0
"RTN","ORWGAPIP",11,0)
 I VTYPE=-1 D
"RTN","ORWGAPIP",12,0)
 . S ENT="USR"
"RTN","ORWGAPIP",13,0)
 . I USER S ENT="USR.`"_USER
"RTN","ORWGAPIP",14,0)
 I VTYPE=-3 D  Q
"RTN","ORWGAPIP",15,0)
 . ;LAB GROUPS
"RTN","ORWGAPIP",16,0)
 . I 'USER S USER=DUZ
"RTN","ORWGAPIP",17,0)
 . D TG^ORWLRR(.PROF,USER)
"RTN","ORWGAPIP",18,0)
 . S NUM=0
"RTN","ORWGAPIP",19,0)
 . F  S NUM=$O(PROF(NUM)) Q:NUM<1  D
"RTN","ORWGAPIP",20,0)
 .. S TG=PROF(NUM)
"RTN","ORWGAPIP",21,0)
 .. S TGNUM=+TG
"RTN","ORWGAPIP",22,0)
 .. S TGNAME=$P(TG,U,2)
"RTN","ORWGAPIP",23,0)
 .. ;I TGNAME[") " S TGNAME=$P(TGNAME,") ",2,99)
"RTN","ORWGAPIP",24,0)
 .. S VNUM=CNT+1
"RTN","ORWGAPIP",25,0)
 .. S RESULT="-3^V^"_VNUM_U_TGNAME_"^^^"_USER
"RTN","ORWGAPIP",26,0)
 .. D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPIP",27,0)
 .. K VIEW
"RTN","ORWGAPIP",28,0)
 .. D ATG^ORWLRR(.VIEW,TGNUM,USER)
"RTN","ORWGAPIP",29,0)
 .. S NUM1=0
"RTN","ORWGAPIP",30,0)
 .. F  S NUM1=$O(VIEW(NUM1)) Q:NUM1<1  D
"RTN","ORWGAPIP",31,0)
 ... S TEST=VIEW(NUM1)
"RTN","ORWGAPIP",32,0)
 ... S RESULT="-3^C^"_VNUM_U_$P(TEST,U,2)_"^63^"_+TEST_U
"RTN","ORWGAPIP",33,0)
 ... D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPIP",34,0)
 D XGETLST^ORWGAPIX(.PROF,ENT,"ORWG GRAPH VIEW")
"RTN","ORWGAPIP",35,0)
 S NUM=0
"RTN","ORWGAPIP",36,0)
 F  S NUM=$O(PROF(NUM)) Q:NUM<1  D
"RTN","ORWGAPIP",37,0)
 . S PARAM=$P(PROF(NUM),U)
"RTN","ORWGAPIP",38,0)
 . S VNUM=CNT+1
"RTN","ORWGAPIP",39,0)
 . S RESULT=VTYPE_"^V^"_VNUM_U_PARAM_"^^^"_USER
"RTN","ORWGAPIP",40,0)
 . D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPIP",41,0)
 . K VIEW
"RTN","ORWGAPIP",42,0)
 . D XGETWP^ORWGAPIX(.VIEW,ENT,"ORWG GRAPH VIEW",PARAM)
"RTN","ORWGAPIP",43,0)
 . D DEFVIEWS(.DATA,.VIEW,VTYPE,VNUM,TMP,.CNT)
"RTN","ORWGAPIP",44,0)
 Q
"RTN","ORWGAPIP",45,0)
 ;
"RTN","ORWGAPIP",46,0)
DATES(DAT,REPORTID) ; from ORWGAPI
"RTN","ORWGAPIP",47,0)
 N BEGIN,END,INFO,NEXT,PARAM1,PARAM2,RPT,START,STOP
"RTN","ORWGAPIP",48,0)
 S RPT=+$O(^ORD(101.24,"AC",+$G(REPORTID),0))
"RTN","ORWGAPIP",49,0)
 I 'RPT Q  ; RPT=1150 is exported graph report
"RTN","ORWGAPIP",50,0)
 S PARAM1=$P($G(^ORD(101.24,RPT,2)),U)
"RTN","ORWGAPIP",51,0)
 S PARAM2=$P($G(^ORD(101.24,RPT,2)),U,2)
"RTN","ORWGAPIP",52,0)
 S INFO=$$XGET^ORWGAPIX("ALL","ORWRP TIME/OCC LIMITS INDV",RPT,"I")
"RTN","ORWGAPIP",53,0)
 S BEGIN=$P(INFO,";"),START=$$DATE^ORWGAPIX(BEGIN)
"RTN","ORWGAPIP",54,0)
 S END=$P(INFO,";",2),STOP=$$DATE^ORWGAPIX(END)
"RTN","ORWGAPIP",55,0)
 I START<1 Q
"RTN","ORWGAPIP",56,0)
 I STOP<1 Q
"RTN","ORWGAPIP",57,0)
 S NEXT=1+$O(DAT(""),-1)
"RTN","ORWGAPIP",58,0)
 S DAT(NEXT)=U_BEGIN_" to "_END_"^^^"_INFO_U_START_U_STOP_U_PARAM1_U_PARAM2
"RTN","ORWGAPIP",59,0)
 Q
"RTN","ORWGAPIP",60,0)
 ;
"RTN","ORWGAPIP",61,0)
DEFVIEWS(DATA,VIEW,VTYPE,VNUM,TMP,CNT) ;
"RTN","ORWGAPIP",62,0)
 N FIRST,NUM,PIECE,RESULT,RESULT1,SECOND,VALUE
"RTN","ORWGAPIP",63,0)
 S NUM=""
"RTN","ORWGAPIP",64,0)
 F  S NUM=$O(VIEW(NUM)) Q:NUM=""  D
"RTN","ORWGAPIP",65,0)
 . S RESULT=$G(VIEW(NUM,0))
"RTN","ORWGAPIP",66,0)
 . S PIECE=0
"RTN","ORWGAPIP",67,0)
 . F  S PIECE=PIECE+1 S VALUE=$P(RESULT,"|",PIECE) D:$L(VALUE)  Q:'$L($P(RESULT,"|",PIECE+1,999))
"RTN","ORWGAPIP",68,0)
 .. S FIRST=$P(VALUE,"~"),SECOND=$P(VALUE,"~",2)
"RTN","ORWGAPIP",69,0)
 .. I FIRST=0 D
"RTN","ORWGAPIP",70,0)
 ... I $E(SECOND,1,5)="63AP;" S RESULT1=VTYPE_"^C^"_VNUM_U_"Anatomic Path: "_$$ITEMPRFX^ORWGAPIU($E(SECOND,3,6))_" <any>"_U_SECOND_"^0^" Q
"RTN","ORWGAPIP",71,0)
 ... I $E(SECOND,1,5)="63MI;" S RESULT1=VTYPE_"^C^"_VNUM_U_"Microbiology: "_$$ITEMPRFX^ORWGAPIU($E(SECOND,3,6))_" <any>"_U_SECOND_"^0^" Q
"RTN","ORWGAPIP",72,0)
 ... S RESULT1=VTYPE_"^C^"_VNUM_U_$$FILENAME^ORWGAPIT(SECOND)_" <any>"_U_SECOND_"^0^"
"RTN","ORWGAPIP",73,0)
 .. I FIRST'=0 S RESULT1=VTYPE_"^C^"_VNUM_U_$$EVALUE^ORWGAPIU(SECOND,FIRST)_U_FIRST_U_SECOND_U
"RTN","ORWGAPIP",74,0)
 .. D SETUP^ORWGAPIW(.DATA,RESULT1,TMP,.CNT)
"RTN","ORWGAPIP",75,0)
 Q
"RTN","ORWGAPIP",76,0)
 ;
"RTN","ORWGAPIP",77,0)
DELVIEWS(DATA,NAME,PUBLIC) ; from ORWGAPI
"RTN","ORWGAPIP",78,0)
 N ERR,TMP
"RTN","ORWGAPIP",79,0)
 D RETURN^ORWGAPIW(.TMP,.DATA)
"RTN","ORWGAPIP",80,0)
 S ERR=0
"RTN","ORWGAPIP",81,0)
 I '$L(NAME) S ERR=1
"RTN","ORWGAPIP",82,0)
 I 'ERR D
"RTN","ORWGAPIP",83,0)
 . S NAME=$$UP^ORWGAPIX(NAME)
"RTN","ORWGAPIP",84,0)
 . I PUBLIC D XDEL^ORWGAPIX("SYS","ORWG GRAPH VIEW",NAME,.ERR)
"RTN","ORWGAPIP",85,0)
 . I 'PUBLIC  D XDEL^ORWGAPIX("USR","ORWG GRAPH VIEW",NAME,.ERR)
"RTN","ORWGAPIP",86,0)
 I TMP S ^TMP(DATA,$J)=ERR,^TMP(DATA,$J,1)=ERR
"RTN","ORWGAPIP",87,0)
 I 'TMP S DATA=ERR,DATA(1)=ERR
"RTN","ORWGAPIP",88,0)
 Q
"RTN","ORWGAPIP",89,0)
 ;
"RTN","ORWGAPIP",90,0)
GETPREF(DATA) ; from ORWGAPI
"RTN","ORWGAPIP",91,0)
 N CNT,NUM,PROF,RESULT,TMP,VAL K PROF
"RTN","ORWGAPIP",92,0)
 I '$O(^PXRMINDX(63,"PI","")) Q  ; graphing is not used if no indexes
"RTN","ORWGAPIP",93,0)
 S VAL=$$XGET^ORWGAPIX("PKG","ORWG GRAPH SETTING",1,"I")
"RTN","ORWGAPIP",94,0)
 I '$L(VAL) Q  ; graphing not used if no pkg param on settings
"RTN","ORWGAPIP",95,0)
 D RETURN^ORWGAPIW(.TMP,.DATA)
"RTN","ORWGAPIP",96,0)
 S PROF(2)=1
"RTN","ORWGAPIP",97,0)
 I '$L($G(^XTMP("ORGRAPH",0))) S PROF(2)=-1
"RTN","ORWGAPIP",98,0)
 S VAL=$$XGET^ORWGAPIX("DIV^SYS^PKG","ORWG GRAPH SETTING",1,"I")
"RTN","ORWGAPIP",99,0)
 S PROF(1)=VAL
"RTN","ORWGAPIP",100,0)
 S VAL=$$XGET^ORWGAPIX("ALL","ORWG GRAPH SETTING",1,"I")
"RTN","ORWGAPIP",101,0)
 S PROF(0)=VAL
"RTN","ORWGAPIP",102,0)
 S CNT=0
"RTN","ORWGAPIP",103,0)
 S NUM=""
"RTN","ORWGAPIP",104,0)
 F  S NUM=$O(PROF(NUM)) Q:NUM=""  D
"RTN","ORWGAPIP",105,0)
 . S RESULT=$G(PROF(NUM))
"RTN","ORWGAPIP",106,0)
 . D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPIP",107,0)
 Q
"RTN","ORWGAPIP",108,0)
 ;
"RTN","ORWGAPIP",109,0)
GETSIZE(DATA) ; from ORWGAPI
"RTN","ORWGAPIP",110,0)
 N CNT,NUM,PROF,RESULT,TMP K PROF
"RTN","ORWGAPIP",111,0)
 D RETURN^ORWGAPIW(.TMP,.DATA)
"RTN","ORWGAPIP",112,0)
 D XGETLST^ORWGAPIX(.PROF,"USR","ORWG GRAPH SIZING")
"RTN","ORWGAPIP",113,0)
 S CNT=0
"RTN","ORWGAPIP",114,0)
 S NUM=""
"RTN","ORWGAPIP",115,0)
 F  S NUM=$O(PROF(NUM)) Q:NUM=""  D
"RTN","ORWGAPIP",116,0)
 . S RESULT=$G(PROF(NUM))
"RTN","ORWGAPIP",117,0)
 . D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPIP",118,0)
 Q
"RTN","ORWGAPIP",119,0)
 ;
"RTN","ORWGAPIP",120,0)
 ;GETVIEWS(DATA,ALL,PUBLIC,EXT,USER) ; from ORWGAPI
"RTN","ORWGAPIP",121,0)
 ;N CNT,NUM,PROF,RESULT,TMP,USERPRM K PROF
"RTN","ORWGAPIP",122,0)
 ;D RETURN^ORWGAPIW(.TMP,.DATA)
"RTN","ORWGAPIP",123,0)
 ;I PUBLIC D
"RTN","ORWGAPIP",124,0)
 ;. I ALL=1 D XGETLST^ORWGAPIX(.PROF,"SYS","ORWG GRAPH VIEW") ; get list of public views
"RTN","ORWGAPIP",125,0)
 ;. I ALL'=1 D XGETWP^ORWGAPIX(.PROF,"SYS","ORWG GRAPH VIEW",ALL) ; get a public view definition
"RTN","ORWGAPIP",126,0)
 ;I 'PUBLIC D
"RTN","ORWGAPIP",127,0)
 ;. S USERPRM="USR"
"RTN","ORWGAPIP",128,0)
 ;. I USER S USERPRM="USR.`"_USER
"RTN","ORWGAPIP",129,0)
 ;. I ALL=1 D XGETLST^ORWGAPIX(.PROF,USERPRM,"ORWG GRAPH VIEW") ; get list of personal views
"RTN","ORWGAPIP",130,0)
 ;. I ALL'=1 D XGETWP^ORWGAPIX(.PROF,USERPRM,"ORWG GRAPH VIEW",ALL) ; get a personal view definition
"RTN","ORWGAPIP",131,0)
 ;S CNT=0
"RTN","ORWGAPIP",132,0)
 ;I 'EXT D  Q
"RTN","ORWGAPIP",133,0)
 ;. S NUM=""
"RTN","ORWGAPIP",134,0)
 ;. F  S NUM=$O(PROF(NUM)) Q:NUM=""  D
"RTN","ORWGAPIP",135,0)
 ;.. I ALL=1 S RESULT=$P($G(PROF(NUM)),U)
"RTN","ORWGAPIP",136,0)
 ;.. I ALL'=1 S RESULT=$G(PROF(NUM,0))
"RTN","ORWGAPIP",137,0)
 ;.. D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPIP",138,0)
 ;D DEFVIEWS(.DATA,.PROF,"",TMP,.CNT)
"RTN","ORWGAPIP",139,0)
 ;Q
"RTN","ORWGAPIP",140,0)
 ;
"RTN","ORWGAPIP",141,0)
GETVIEWS(DATA,ALL,PUBLIC,EXT,USER) ; from ORWGAPI
"RTN","ORWGAPIP",142,0)
 N CNT,FIRST,NUM,PIECE,PROF,RESULT,RESULT1,SECOND,TMP,VALUE K PROF
"RTN","ORWGAPIP",143,0)
 D RETURN^ORWGAPIW(.TMP,.DATA)
"RTN","ORWGAPIP",144,0)
 I PUBLIC D
"RTN","ORWGAPIP",145,0)
 . I ALL=1 D XGETLST^ORWGAPIX(.PROF,"SYS","ORWG GRAPH VIEW") ; get list of public views
"RTN","ORWGAPIP",146,0)
 . I ALL'=1 D XGETWP^ORWGAPIX(.PROF,"SYS","ORWG GRAPH VIEW",ALL) ; get a public view definition
"RTN","ORWGAPIP",147,0)
 I 'PUBLIC D
"RTN","ORWGAPIP",148,0)
 . S USERPRM="USR"
"RTN","ORWGAPIP",149,0)
 . I USER S USERPRM="USR.`"_USER
"RTN","ORWGAPIP",150,0)
 . I ALL=1 D XGETLST^ORWGAPIX(.PROF,USERPRM,"ORWG GRAPH VIEW") ; get list of personal views
"RTN","ORWGAPIP",151,0)
 . I ALL'=1 D XGETWP^ORWGAPIX(.PROF,USERPRM,"ORWG GRAPH VIEW",ALL) ; get a personal view definition
"RTN","ORWGAPIP",152,0)
 S CNT=0
"RTN","ORWGAPIP",153,0)
 I 'EXT D  Q
"RTN","ORWGAPIP",154,0)
 . S NUM=""
"RTN","ORWGAPIP",155,0)
 . F  S NUM=$O(PROF(NUM)) Q:NUM=""  D
"RTN","ORWGAPIP",156,0)
 .. I ALL=1 S RESULT=$P($G(PROF(NUM)),U)
"RTN","ORWGAPIP",157,0)
 .. I ALL'=1 S RESULT=$G(PROF(NUM,0))
"RTN","ORWGAPIP",158,0)
 .. D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPIP",159,0)
 S NUM=""
"RTN","ORWGAPIP",160,0)
 F  S NUM=$O(PROF(NUM)) Q:NUM=""  D
"RTN","ORWGAPIP",161,0)
 . S RESULT=$G(PROF(NUM,0))
"RTN","ORWGAPIP",162,0)
 . S PIECE=0
"RTN","ORWGAPIP",163,0)
 . F  S PIECE=PIECE+1 S VALUE=$P(RESULT,"|",PIECE) D:$L(VALUE)  Q:'$L($P(RESULT,"|",PIECE+1,999))
"RTN","ORWGAPIP",164,0)
 .. S FIRST=$P(VALUE,"~"),SECOND=$P(VALUE,"~",2)
"RTN","ORWGAPIP",165,0)
 .. I FIRST=0 S CNT=CNT+1,RESULT1="0^"_SECOND_U_$$FILENAME^ORWGAPIT(SECOND)_" <any>"
"RTN","ORWGAPIP",166,0)
 .. I FIRST'=0 S CNT=CNT+1,RESULT1=FIRST_U_SECOND_U_$$EVALUE^ORWGAPIU(SECOND,FIRST)
"RTN","ORWGAPIP",167,0)
 .. D SETUP^ORWGAPIW(.DATA,RESULT1,TMP,.CNT)
"RTN","ORWGAPIP",168,0)
 Q
"RTN","ORWGAPIP",169,0)
 ;
"RTN","ORWGAPIP",170,0)
INISET ; from ORWGAPIU initial setup of package parameters
"RTN","ORWGAPIP",171,0)
 N ERR,RPTNUM
"RTN","ORWGAPIP",172,0)
 S RPTNUM=1150
"RTN","ORWGAPIP",173,0)
 D SETPREF(.ERR,"63;53.79;55;55NVA;52;70;120.5|BCEFGHIKN|1|4|90|1|100||",9) ; default public settings
"RTN","ORWGAPIP",174,0)
 I '$D(^ORD(101.24,RPTNUM,0)) D  ; make sure report has been added
"RTN","ORWGAPIP",175,0)
 . L +^ORD(101.24,0):20 I '$T Q
"RTN","ORWGAPIP",176,0)
 . S $P(^ORD(101.24,0),U,3)=RPTNUM,$P(^(0),U,4)=$P(^(0),U,4)+1
"RTN","ORWGAPIP",177,0)
 . S ^ORD(101.24,RPTNUM,0)="ORWG GRAPHING^OR_GRAPHS^^2^^^1^R^^^^G^^T"
"RTN","ORWGAPIP",178,0)
 . S ^ORD(101.24,RPTNUM,2)="^^Graphing (local only)^Graphing"
"RTN","ORWGAPIP",179,0)
 . L -^ORD(101.24,0)
"RTN","ORWGAPIP",180,0)
 . D INDEX^ORWGAPIX("^ORD(101.24,",RPTNUM)
"RTN","ORWGAPIP",181,0)
 D XEN^ORWGAPIX("PKG","ORWRP REPORT LIST",12,RPTNUM)
"RTN","ORWGAPIP",182,0)
 Q
"RTN","ORWGAPIP",183,0)
 ;
"RTN","ORWGAPIP",184,0)
PUBLIC(USER) ; from ORWGAPI
"RTN","ORWGAPIP",185,0)
 N ERR,IDX,ORSRV,USRCLASS,VAL K USRCLASS
"RTN","ORWGAPIP",186,0)
 S VAL=0
"RTN","ORWGAPIP",187,0)
 I '$G(USER) Q VAL
"RTN","ORWGAPIP",188,0)
 S ORSRV=$$GET1^DIQ(200,DUZ,29,"I")
"RTN","ORWGAPIP",189,0)
 D XGETLST1^ORWGAPIX(.USRCLASS,"SYS","ORWG GRAPH PUBLIC EDITOR CLASS","Q",.ERR)
"RTN","ORWGAPIP",190,0)
 I ERR Q VAL
"RTN","ORWGAPIP",191,0)
 S IDX=0
"RTN","ORWGAPIP",192,0)
 F  S IDX=$O(USRCLASS(IDX)) Q:'IDX  D  Q:VAL
"RTN","ORWGAPIP",193,0)
 . I $$ISA^ORWGAPIA(USER,$P(USRCLASS(IDX),U,2),.ERR) S VAL=1
"RTN","ORWGAPIP",194,0)
 Q VAL
"RTN","ORWGAPIP",195,0)
 ;
"RTN","ORWGAPIP",196,0)
RPTPARAM(IEN) ; from ORWGAPI
"RTN","ORWGAPIP",197,0)
 N DATES,NODE,VAL
"RTN","ORWGAPIP",198,0)
 S IEN=+$G(IEN)
"RTN","ORWGAPIP",199,0)
 S VAL=""
"RTN","ORWGAPIP",200,0)
 S NODE=$$UP^XLFSTR($P($G(^ORD(101.24,IEN,2)),U,1,2))
"RTN","ORWGAPIP",201,0)
 I $L(NODE)<2 Q VAL
"RTN","ORWGAPIP",202,0)
 Q NODE
"RTN","ORWGAPIP",203,0)
 ;
"RTN","ORWGAPIP",204,0)
SETPREF(DATA,VAL,PUBLIC) ; from ORWGAPI
"RTN","ORWGAPIP",205,0)
 N ERR,TMP
"RTN","ORWGAPIP",206,0)
 D RETURN^ORWGAPIW(.TMP,.DATA)
"RTN","ORWGAPIP",207,0)
 S ERR=0
"RTN","ORWGAPIP",208,0)
 I '$L(VAL) S ERR=1
"RTN","ORWGAPIP",209,0)
 I 'ERR D
"RTN","ORWGAPIP",210,0)
 . S VAL=$$UP^ORWGAPIX(VAL)
"RTN","ORWGAPIP",211,0)
 . I PUBLIC=9 D XEN^ORWGAPIX("PKG","ORWG GRAPH SETTING",1,VAL,.ERR) ; only on postinit
"RTN","ORWGAPIP",212,0)
 . I PUBLIC D XEN^ORWGAPIX("SYS","ORWG GRAPH SETTING",1,VAL,.ERR)
"RTN","ORWGAPIP",213,0)
 . I 'PUBLIC D XEN^ORWGAPIX("USR","ORWG GRAPH SETTING",1,VAL,.ERR)
"RTN","ORWGAPIP",214,0)
 I TMP S ^TMP(DATA,$J)=ERR,^TMP(DATA,$J,1)=ERR
"RTN","ORWGAPIP",215,0)
 I 'TMP S DATA=ERR,DATA(1)=ERR
"RTN","ORWGAPIP",216,0)
 Q
"RTN","ORWGAPIP",217,0)
 ;
"RTN","ORWGAPIP",218,0)
SETSIZE(DATA,VAL) ; from ORWGAPI
"RTN","ORWGAPIP",219,0)
 N ERR,NAME,NUM,VALUE,VALUES,TMP
"RTN","ORWGAPIP",220,0)
 D RETURN^ORWGAPIW(.TMP,.DATA)
"RTN","ORWGAPIP",221,0)
 S ERR=0
"RTN","ORWGAPIP",222,0)
 I '$L($O(VAL(0))) S ERR=1
"RTN","ORWGAPIP",223,0)
 I 'ERR D
"RTN","ORWGAPIP",224,0)
 . S NUM=0
"RTN","ORWGAPIP",225,0)
 . F  S NUM=$O(VAL(NUM)) Q:NUM<1  D  Q:ERR
"RTN","ORWGAPIP",226,0)
 .. S VALUES=VAL(NUM)
"RTN","ORWGAPIP",227,0)
 .. S VALUES=$$UP^ORWGAPIX(VALUES)
"RTN","ORWGAPIP",228,0)
 .. S NAME=$P(VALUES,U)
"RTN","ORWGAPIP",229,0)
 .. S VALUE=$P(VALUES,U,2)
"RTN","ORWGAPIP",230,0)
 .. D XEN^ORWGAPIX("USR","ORWG GRAPH SIZING",NAME,VALUE,.ERR)
"RTN","ORWGAPIP",231,0)
 I TMP S ^TMP(DATA,$J)=ERR,^TMP(DATA,$J,1)=ERR
"RTN","ORWGAPIP",232,0)
 I 'TMP S DATA=ERR,DATA(1)=ERR
"RTN","ORWGAPIP",233,0)
 Q
"RTN","ORWGAPIP",234,0)
 ;
"RTN","ORWGAPIP",235,0)
SETVIEWS(DATA,NAME,PUBLIC,VAL) ; from ORWGAPI
"RTN","ORWGAPIP",236,0)
 N ERR,TMP
"RTN","ORWGAPIP",237,0)
 D RETURN^ORWGAPIW(.TMP,.DATA)
"RTN","ORWGAPIP",238,0)
 S ERR=0
"RTN","ORWGAPIP",239,0)
 I '$L(NAME) S ERR=1
"RTN","ORWGAPIP",240,0)
 I '$L($O(VAL(""))) S ERR=1
"RTN","ORWGAPIP",241,0)
 I 'ERR D
"RTN","ORWGAPIP",242,0)
 . S NAME=$$UP^ORWGAPIX(NAME)
"RTN","ORWGAPIP",243,0)
 . S VAL=NAME
"RTN","ORWGAPIP",244,0)
 . I PUBLIC D XEN^ORWGAPIX("SYS","ORWG GRAPH VIEW",NAME,.VAL,.ERR)
"RTN","ORWGAPIP",245,0)
 . I 'PUBLIC  D XEN^ORWGAPIX("USR","ORWG GRAPH VIEW",NAME,.VAL,.ERR)
"RTN","ORWGAPIP",246,0)
 I TMP S ^TMP(DATA,$J)=ERR,^TMP(DATA,$J,1)=ERR
"RTN","ORWGAPIP",247,0)
 I 'TMP S DATA=ERR,DATA(1)=ERR
"RTN","ORWGAPIP",248,0)
 Q
"RTN","ORWGAPIP",249,0)
 ;
"RTN","ORWGAPIR")
0^129^B41364234
"RTN","ORWGAPIR",1,0)
ORWGAPIR ; SLC/STAFF - Graph API Router ;8/21/06  07:52
"RTN","ORWGAPIR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,260,243**;Dec 17, 1997;Build 242
"RTN","ORWGAPIR",3,0)
 ;
"RTN","ORWGAPIR",4,0)
DATA(DATA,ITEM,FILE,START,DFN,CNT,TMP,BACKTO) ; from ORWGAPI
"RTN","ORWGAPIR",5,0)
 S DFN=+$G(DFN) I 'DFN Q
"RTN","ORWGAPIR",6,0)
 S FILE=$G(FILE) I '$L(FILE) Q
"RTN","ORWGAPIR",7,0)
 S ITEM=$G(ITEM) I '$L(ITEM) Q
"RTN","ORWGAPIR",8,0)
 S BACKTO=+$G(BACKTO)
"RTN","ORWGAPIR",9,0)
 I FILE=52 D OUTRX^ORWGAPI7(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",10,0)
 I FILE=53.79 D BCMA^ORWGAPI7(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",11,0)
 I FILE=55 D INRX^ORWGAPI7(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",12,0)
 I FILE="55NVA" D NVA^ORWGAPI7(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",13,0)
 I FILE=63 D LAB^ORWGAPI3(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",14,0)
 I FILE="63AP" D LAB^ORWGAPI3(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",15,0)
 ;I FILE="63BB" D BBDATA^ORWGAPIB(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",16,0)
 I FILE="63MI" D LAB^ORWGAPI3(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",17,0)
 I FILE=70 D RAD^ORWGAPI3(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",18,0)
 I FILE=100 D ORDER^ORWGAPI3(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",19,0)
 I FILE=120.5 D VITAL^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",20,0)
 I FILE=120.8 D ADVERSE^ORWGAPI3(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",21,0)
 I FILE=601.2 D MH^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",22,0)
 I FILE=9000010.07 D POV^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",23,0)
 I FILE=9000010.11 D IMM^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",24,0)
 I FILE=9000010.12 D SKIN^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",25,0)
 I FILE=9000010.13 D EXAM^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",26,0)
 I FILE=9000010.16 D EDU^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",27,0)
 I FILE=9000010.18 D PROC^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",28,0)
 I FILE=9000010.23 D HF^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",29,0)
 I FILE=9000011 D PROB^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",30,0)
 I FILE=9999911 D PROBX^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",31,0)
 I FILE="45OP" D OP^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",32,0)
 I FILE="45DX" D DX^ORWGAPI3(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",33,0)
 I FILE=9000010 D VISIT^ORWGAPI8(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",34,0)
 I FILE=405 D ADMIT^ORWGAPI8(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",35,0)
 I FILE=130 D SURG^ORWGAPI8(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",36,0)
 I FILE=8925 D NOTE^ORWGAPI3(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",37,0)
 I FILE=690 D MED^ORWGAPI3(.DATA,ITEM,START,DFN,.CNT,TMP,BACKTO) Q
"RTN","ORWGAPIR",38,0)
 Q
"RTN","ORWGAPIR",39,0)
 ;
"RTN","ORWGAPIR",40,0)
ITEMS(ITEMS,DFN,TYPE,FMT,OLDEST,NEWEST,CNT,TMP) ; from ORWGAPI
"RTN","ORWGAPIR",41,0)
 S FMT=$G(FMT,3),OLDEST=+$G(OLDEST),NEWEST=+$G(NEWEST),CNT=+$G(CNT)
"RTN","ORWGAPIR",42,0)
 I (TYPE=70)!(TYPE=100)!(TYPE=120.5)!(TYPE=601.2) D STD(.ITEMS,DFN,TYPE,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",43,0)
 I (TYPE=9000010.11)!(TYPE=9000010.12)!(TYPE=9000010.13) D STD(.ITEMS,DFN,TYPE,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",44,0)
 I (TYPE=9000010.16)!(TYPE=9000010.23) D STD(.ITEMS,DFN,TYPE,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",45,0)
 I (TYPE=9000010.07)!(TYPE=9000010.18) D STD1(.ITEMS,DFN,TYPE,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",46,0)
 I (TYPE=52)!(TYPE=55) D STD2(.ITEMS,DFN,TYPE,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",47,0)
 I TYPE=63 D LAB^ORWGAPI1(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",48,0)
 I TYPE=9000010 D VISITS^ORWGAPI6(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",49,0)
 I TYPE=9000011 D PL^ORWGAPI2(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",50,0)
 I TYPE=9999911 D PLX^ORWGAPI2(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",51,0)
 I TYPE=405 D ADMITS^ORWGAPI6(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",52,0)
 I TYPE=50.605 D DC^ORWGAPI5(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",53,0)
 I TYPE=68 D AA^ORWGAPI1(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",54,0)
 I TYPE=8925.1 D TITLE^ORWGAPI1(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",55,0)
 I TYPE=53.79 D BCMA^ORWGAPI5(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",56,0)
 I TYPE=120.8 D ADVERSE^ORWGAPI2(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",57,0)
 I TYPE=130 D SURGERY^ORWGAPI6(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",58,0)
 I TYPE=8925 D NOTES^ORWGAPI1(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",59,0)
 I TYPE=690 D MED^ORWGAPI1(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",60,0)
 S TYPE=$$UP^ORWGAPIX(TYPE)
"RTN","ORWGAPIR",61,0)
 I $E(TYPE,1,2)=45 D REG^ORWGAPI2(.ITEMS,DFN,TYPE,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",62,0)
 I TYPE="55NVA" D NVA^ORWGAPI5(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",63,0)
 I TYPE="63AP" D AP^ORWGAPI1(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",64,0)
 I TYPE="63BB" D BBITEM^ORWGAPIB(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",65,0)
 I TYPE="63MI" D MI^ORWGAPI1(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",66,0)
 Q
"RTN","ORWGAPIR",67,0)
 ;
"RTN","ORWGAPIR",68,0)
STD(ITEMS,DFN,FILE,FMT,OLDEST,NEWEST,CNT,TMP) ;
"RTN","ORWGAPIR",69,0)
 N DATE,ITEM,OK,RESULT
"RTN","ORWGAPIR",70,0)
 S ITEM=""
"RTN","ORWGAPIR",71,0)
 F  S ITEM=$O(^PXRMINDX(FILE,"PI",DFN,ITEM)) Q:ITEM=""  D
"RTN","ORWGAPIR",72,0)
 . S OK=0
"RTN","ORWGAPIR",73,0)
 . I FMT=6 D
"RTN","ORWGAPIR",74,0)
 .. S DATE=OLDEST
"RTN","ORWGAPIR",75,0)
 .. F  S DATE=$O(^PXRMINDX(FILE,"PI",DFN,ITEM,DATE)) Q:DATE=""  Q:DATE>NEWEST  D  Q:OK
"RTN","ORWGAPIR",76,0)
 ... S CNT=CNT+1
"RTN","ORWGAPIR",77,0)
 ... S OK=1
"RTN","ORWGAPIR",78,0)
 ... S RESULT=FILE_U_ITEM
"RTN","ORWGAPIR",79,0)
 . I FMT=3 D
"RTN","ORWGAPIR",80,0)
 .. S DATE=$O(^PXRMINDX(FILE,"PI",DFN,ITEM,""),-1)
"RTN","ORWGAPIR",81,0)
 .. I 'DATE Q
"RTN","ORWGAPIR",82,0)
 .. S CNT=CNT+1
"RTN","ORWGAPIR",83,0)
 .. S OK=1
"RTN","ORWGAPIR",84,0)
 .. S RESULT=FILE_U_ITEM_"^^"_$$EVALUE^ORWGAPIU(ITEM,FILE,.01)_"^^"_DATE
"RTN","ORWGAPIR",85,0)
 .. I FILE=100 S RESULT=RESULT_U_$$OGROUP^ORWGAPIW(ITEM)
"RTN","ORWGAPIR",86,0)
 . I FMT=0 D
"RTN","ORWGAPIR",87,0)
 .. S CNT=CNT+1
"RTN","ORWGAPIR",88,0)
 .. S OK=1
"RTN","ORWGAPIR",89,0)
 .. S RESULT=FILE_U_ITEM_U_$$EVALUE^ORWGAPIU(ITEM,FILE,.01)
"RTN","ORWGAPIR",90,0)
 . I OK D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPIR",91,0)
 I FILE=120.5 D BMIITEMS^ORWGAPIX(.ITEMS,.CNT,TMP) Q
"RTN","ORWGAPIR",92,0)
 Q
"RTN","ORWGAPIR",93,0)
 ;
"RTN","ORWGAPIR",94,0)
STD1(ITEMS,DFN,FILE,FMT,OLDEST,NEWEST,CNT,TMP) ;
"RTN","ORWGAPIR",95,0)
 N DATE,ITEM,OK,RESULT,TYPE
"RTN","ORWGAPIR",96,0)
 K ^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPIR",97,0)
 S TYPE=""
"RTN","ORWGAPIR",98,0)
 F  S TYPE=$O(^PXRMINDX(FILE,"PPI",DFN,TYPE)) Q:TYPE=""  D
"RTN","ORWGAPIR",99,0)
 . S ITEM=""
"RTN","ORWGAPIR",100,0)
 . F  S ITEM=$O(^PXRMINDX(FILE,"PPI",DFN,TYPE,ITEM)) Q:ITEM=""  D
"RTN","ORWGAPIR",101,0)
 .. S OK=0
"RTN","ORWGAPIR",102,0)
 .. I FMT=6 D
"RTN","ORWGAPIR",103,0)
 ... S DATE=OLDEST
"RTN","ORWGAPIR",104,0)
 ... F  S DATE=$O(^PXRMINDX(FILE,"PPI",DFN,TYPE,ITEM,DATE)) Q:DATE=""  Q:DATE>NEWEST  D  Q:OK
"RTN","ORWGAPIR",105,0)
 .... S CNT=CNT+1
"RTN","ORWGAPIR",106,0)
 .... S OK=1
"RTN","ORWGAPIR",107,0)
 .... S RESULT=FILE_U_ITEM
"RTN","ORWGAPIR",108,0)
 .. I FMT=3 D
"RTN","ORWGAPIR",109,0)
 ... S DATE=$O(^PXRMINDX(FILE,"PPI",DFN,TYPE,ITEM,""),-1)
"RTN","ORWGAPIR",110,0)
 ... I DATE S ^TMP("ORWGRPC TEMP",$J,ITEM,DATE)=""
"RTN","ORWGAPIR",111,0)
 .. I FMT=0 D
"RTN","ORWGAPIR",112,0)
 ... S CNT=CNT+1
"RTN","ORWGAPIR",113,0)
 ... S OK=1
"RTN","ORWGAPIR",114,0)
 ... S RESULT=FILE_U_ITEM_U_$$EVALUE^ORWGAPIU(ITEM,FILE,.01)
"RTN","ORWGAPIR",115,0)
 .. I OK D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPIR",116,0)
 I FMT=3 D
"RTN","ORWGAPIR",117,0)
 . S ITEM=""
"RTN","ORWGAPIR",118,0)
 . F  S ITEM=$O(^TMP("ORWGRPC TEMP",$J,ITEM)) Q:ITEM=""  D
"RTN","ORWGAPIR",119,0)
 .. S DATE=$O(^TMP("ORWGRPC TEMP",$J,ITEM,""),-1)
"RTN","ORWGAPIR",120,0)
 .. I 'DATE Q
"RTN","ORWGAPIR",121,0)
 .. S CNT=CNT+1
"RTN","ORWGAPIR",122,0)
 .. S RESULT=FILE_U_ITEM_"^^"_$$EVALUE^ORWGAPIU(ITEM,FILE,.01)_"^^"_DATE
"RTN","ORWGAPIR",123,0)
 .. D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPIR",124,0)
 K ^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPIR",125,0)
 Q
"RTN","ORWGAPIR",126,0)
 ;
"RTN","ORWGAPIR",127,0)
STD2(ITEMS,DFN,FILE,FMT,OLDEST,NEWEST,CNT,TMP) ;
"RTN","ORWGAPIR",128,0)
 N DATE,DATE2,ITEM,OK,RESULT
"RTN","ORWGAPIR",129,0)
 S ITEM=""
"RTN","ORWGAPIR",130,0)
 F  S ITEM=$O(^PXRMINDX(FILE,"PI",DFN,ITEM)) Q:ITEM=""  D
"RTN","ORWGAPIR",131,0)
 . S OK=0
"RTN","ORWGAPIR",132,0)
 . I FMT=6 D
"RTN","ORWGAPIR",133,0)
 .. S DATE=0
"RTN","ORWGAPIR",134,0)
 .. F  S DATE=$O(^PXRMINDX(FILE,"PI",DFN,ITEM,DATE)) Q:DATE=""  Q:DATE>NEWEST  D  Q:OK
"RTN","ORWGAPIR",135,0)
 ... S DATE2=""
"RTN","ORWGAPIR",136,0)
 ... F  S DATE2=$O(^PXRMINDX(FILE,"PI",DFN,ITEM,DATE,DATE2)) Q:DATE2=""  D
"RTN","ORWGAPIR",137,0)
 .... I DATE2<OLDEST Q
"RTN","ORWGAPIR",138,0)
 .... S CNT=CNT+1
"RTN","ORWGAPIR",139,0)
 .... S OK=1
"RTN","ORWGAPIR",140,0)
 .... S RESULT=FILE_U_ITEM
"RTN","ORWGAPIR",141,0)
 . I FMT=3 D
"RTN","ORWGAPIR",142,0)
 .. S DATE=$O(^PXRMINDX(FILE,"PI",DFN,ITEM,""),-1)
"RTN","ORWGAPIR",143,0)
 .. I 'DATE Q
"RTN","ORWGAPIR",144,0)
 .. S CNT=CNT+1
"RTN","ORWGAPIR",145,0)
 .. S OK=1
"RTN","ORWGAPIR",146,0)
 .. S RESULT=FILE_U_ITEM_"^^"_$$EVALUE^ORWGAPIU(ITEM,FILE,.01)_"^^"_DATE
"RTN","ORWGAPIR",147,0)
 .. S RESULT=RESULT_U_$$DRGCLASS^ORWGAPIC(ITEM)
"RTN","ORWGAPIR",148,0)
 . I FMT=0 D
"RTN","ORWGAPIR",149,0)
 .. S CNT=CNT+1
"RTN","ORWGAPIR",150,0)
 .. S OK=1
"RTN","ORWGAPIR",151,0)
 .. S RESULT=FILE_U_ITEM_U_$$EVALUE^ORWGAPIU(ITEM,FILE,.01)
"RTN","ORWGAPIR",152,0)
 .. S RESULT=RESULT_U_$$DRGCLASS^ORWGAPIC(ITEM)
"RTN","ORWGAPIR",153,0)
 . I OK D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPIR",154,0)
 Q
"RTN","ORWGAPIR",155,0)
 ;
"RTN","ORWGAPIT")
0^130^B57224397
"RTN","ORWGAPIT",1,0)
ORWGAPIT ; SLC/STAFF - Graph Item Types ;11/20/06  08:58
"RTN","ORWGAPIT",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,260,243**;Dec 17, 1997;Build 242
"RTN","ORWGAPIT",3,0)
 ;
"RTN","ORWGAPIT",4,0)
COMPTYPE(FILE) ; $$(file) -> hs component abbrv   - from ORWGAPID
"RTN","ORWGAPIT",5,0)
 N COMP,COMPNAME,COMPS,NUM,OK K COMPS
"RTN","ORWGAPIT",6,0)
 S COMPNAME=$$COMPNAME(FILE)_"]"
"RTN","ORWGAPIT",7,0)
 D COMP^ORWRP2(.COMPS)
"RTN","ORWGAPIT",8,0)
 S COMP=""
"RTN","ORWGAPIT",9,0)
 S OK=0
"RTN","ORWGAPIT",10,0)
 S NUM=0
"RTN","ORWGAPIT",11,0)
 D
"RTN","ORWGAPIT",12,0)
 . F  S NUM=$O(COMPS(NUM)) Q:NUM<1  D  I OK Q
"RTN","ORWGAPIT",13,0)
 .. S COMP=COMPS(NUM)
"RTN","ORWGAPIT",14,0)
 .. I COMP[COMPNAME,COMPNAME=$P($P(COMP,U,2),"[",2) S OK=1
"RTN","ORWGAPIT",15,0)
 Q COMP
"RTN","ORWGAPIT",16,0)
 ;
"RTN","ORWGAPIT",17,0)
COMPNAME(FILE) ; $$(file) -> hs component abbrv
"RTN","ORWGAPIT",18,0)
 I FILE=63 Q "CH"
"RTN","ORWGAPIT",19,0)
 I FILE=120.5 Q "VSD"
"RTN","ORWGAPIT",20,0)
 I FILE=120.8 Q "ADR"
"RTN","ORWGAPIT",21,0)
 I FILE=52 Q "RXOP"
"RTN","ORWGAPIT",22,0)
 I FILE=55 Q "RXUD"
"RTN","ORWGAPIT",23,0)
 I FILE=70 Q "II"
"RTN","ORWGAPIT",24,0)
 I FILE=9000010.11 Q "IM"
"RTN","ORWGAPIT",25,0)
 I FILE=9000010.12 Q "ST"
"RTN","ORWGAPIT",26,0)
 I FILE=9000010.13 Q "EXAM"
"RTN","ORWGAPIT",27,0)
 I FILE=9000010.18 Q "CPT"
"RTN","ORWGAPIT",28,0)
 I FILE=9000011 Q "PLL"
"RTN","ORWGAPIT",29,0)
 I FILE=9999911 Q "PLL"
"RTN","ORWGAPIT",30,0)
 I FILE=9000010.23 Q "HF"
"RTN","ORWGAPIT",31,0)
 I FILE=9000010.07 Q "OD"
"RTN","ORWGAPIT",32,0)
 I FILE=9000010.16 Q "ED"
"RTN","ORWGAPIT",33,0)
 I FILE=601.2 Q "MHPE"
"RTN","ORWGAPIT",34,0)
 I FILE=100 Q "ORC"
"RTN","ORWGAPIT",35,0)
 I FILE="45OP" Q "PRC"
"RTN","ORWGAPIT",36,0)
 I FILE="45DX" Q "DD"
"RTN","ORWGAPIT",37,0)
 I FILE="63AP" Q "SP"
"RTN","ORWGAPIT",38,0)
 I FILE="63BB" Q "BT"
"RTN","ORWGAPIT",39,0)
 I FILE="63MI" Q "MIC"
"RTN","ORWGAPIT",40,0)
 I FILE=9000010 Q "CVP"
"RTN","ORWGAPIT",41,0)
 I FILE=405 Q "ADC"
"RTN","ORWGAPIT",42,0)
 I FILE="55NVA" Q "RXNV"
"RTN","ORWGAPIT",43,0)
 I FILE=53.79 Q "BCMA"
"RTN","ORWGAPIT",44,0)
 I FILE=130 Q "SR"
"RTN","ORWGAPIT",45,0)
 I FILE=8925 Q "CNB"
"RTN","ORWGAPIT",46,0)
 I FILE=690 Q "MEDF"
"RTN","ORWGAPIT",47,0)
 Q ""
"RTN","ORWGAPIT",48,0)
 ;
"RTN","ORWGAPIT",49,0)
FILENAME(FILE) ; $$(file) -> filename   - from ORWGAPIP
"RTN","ORWGAPIT",50,0)
 I FILE=63 Q "LAB TESTS"
"RTN","ORWGAPIT",51,0)
 I FILE=120.5 Q "VITALS"
"RTN","ORWGAPIT",52,0)
 I FILE=120.8 Q "ALLERGIES"
"RTN","ORWGAPIT",53,0)
 I FILE=52 Q "MEDICATION,OUTPATIENT"
"RTN","ORWGAPIT",54,0)
 I FILE=55 Q "MEDICATION,INPATIENT"
"RTN","ORWGAPIT",55,0)
 I FILE=70 Q "RADIOLOGY EXAMS"
"RTN","ORWGAPIT",56,0)
 I FILE=9000010.11 Q "IMMUNIZATIONS"
"RTN","ORWGAPIT",57,0)
 I FILE=9000010.12 Q "SKIN TESTS"
"RTN","ORWGAPIT",58,0)
 I FILE=9000010.13 Q "EXAMS"
"RTN","ORWGAPIT",59,0)
 I FILE=9000010.18 Q "PROCEDURES"
"RTN","ORWGAPIT",60,0)
 I FILE=9000011 Q "PROBLEMS"
"RTN","ORWGAPIT",61,0)
 I FILE=9999911 Q "PROBLEMS-DURATION" ;**************
"RTN","ORWGAPIT",62,0)
 I FILE=9000010.23 Q "HEALTH FACTORS"
"RTN","ORWGAPIT",63,0)
 I FILE=9000010.07 Q "PURPOSE OF VISIT"
"RTN","ORWGAPIT",64,0)
 I FILE=9000010.16 Q "PATIENT EDUCATION"
"RTN","ORWGAPIT",65,0)
 I FILE=601.2 Q "MENTAL HEALTH"
"RTN","ORWGAPIT",66,0)
 I FILE=100 Q "ORDERS"
"RTN","ORWGAPIT",67,0)
 I FILE="45OP" Q "REGISTRATION OP/PROC"
"RTN","ORWGAPIT",68,0)
 I FILE="45DX" Q "REGISTRATION DX"
"RTN","ORWGAPIT",69,0)
 I FILE="63AP" Q "ANATOMIC PATHOLOGY"
"RTN","ORWGAPIT",70,0)
 I FILE="63BB" Q "BLOOD PRODUCTS"
"RTN","ORWGAPIT",71,0)
 I FILE="63MI" Q "MICROBIOLOGY"
"RTN","ORWGAPIT",72,0)
 I FILE=9000010 Q "VISITS"
"RTN","ORWGAPIT",73,0)
 I FILE=405 Q "ADMISSIONS"
"RTN","ORWGAPIT",74,0)
 I FILE="55NVA" Q "MEDICATION,NON-VA"
"RTN","ORWGAPIT",75,0)
 I FILE=53.79 Q "MEDICATION,BCMA"
"RTN","ORWGAPIT",76,0)
 I FILE=50.605 Q "DRUG CLASS"
"RTN","ORWGAPIT",77,0)
 I FILE=68 Q "LAB ACC AREA"
"RTN","ORWGAPIT",78,0)
 I FILE=8925.1 Q "NOTE TITLE"
"RTN","ORWGAPIT",79,0)
 I FILE=100.98 Q "ORDER DISPLAY GROUP"
"RTN","ORWGAPIT",80,0)
 I FILE=811.2 Q "REMINDER TAXONOMY"
"RTN","ORWGAPIT",81,0)
 I FILE=130 Q "SURGERY"
"RTN","ORWGAPIT",82,0)
 I FILE=8925 Q "NOTES"
"RTN","ORWGAPIT",83,0)
 I FILE=690 Q "MEDICINE"
"RTN","ORWGAPIT",84,0)
 Q ""
"RTN","ORWGAPIT",85,0)
 ;
"RTN","ORWGAPIT",86,0)
FILECHK(FILES) ;
"RTN","ORWGAPIT",87,0)
 ; get parameter string of excluded files
"RTN","ORWGAPIT",88,0)
 N CHECK,NUM,ORSRV,VAL
"RTN","ORWGAPIT",89,0)
 S ORSRV=$$GET1^DIQ(200,DUZ,29,"I")
"RTN","ORWGAPIT",90,0)
 S CHECK=$$XGET^ORWGAPIX("USR^SRV.`"_+$G(ORSRV)_"^DIV^SYS^PKG","ORWG GRAPH EXCLUDE DATA TYPE",1,"I")
"RTN","ORWGAPIT",91,0)
 S CHECK=CHECK_";"
"RTN","ORWGAPIT",92,0)
 S NUM=0
"RTN","ORWGAPIT",93,0)
 F  S NUM=$O(FILES(NUM)) Q:NUM<1  D
"RTN","ORWGAPIT",94,0)
 . S VAL=FILES(NUM)
"RTN","ORWGAPIT",95,0)
 . S VAL=$P(VAL,U)_";"
"RTN","ORWGAPIT",96,0)
 . I CHECK[VAL K FILES(NUM)
"RTN","ORWGAPIT",97,0)
 Q
"RTN","ORWGAPIT",98,0)
 ;
"RTN","ORWGAPIT",99,0)
GETFILES(FILES) ;
"RTN","ORWGAPIT",100,0)
 ; file #^file name^graph type^lookup file^lookup global^lookup index^prefix^abbrev^hint format
"RTN","ORWGAPIT",101,0)
 ; commenting out a line setting FILES will inactivate that type
"RTN","ORWGAPIT",102,0)
 S FILES(1)="63^LAB TESTS^1^60^LAB(60,^B^^CH^~  ~units~flag~|"
"RTN","ORWGAPIT",103,0)
 S FILES(2)="120.5^VITALS^1^120.51^GMRD(120.51,^B^^VSD^~  ~"
"RTN","ORWGAPIT",104,0)
 S FILES(3)="52^MEDICATION,OUTPATIENT^3^50^PSDRUG(^B^^RXOP^~  ~"
"RTN","ORWGAPIT",105,0)
 S FILES(4)="55^MEDICATION,INPATIENT^3^50^PSDRUG(^B^^RXUD^~  ~"
"RTN","ORWGAPIT",106,0)
 S FILES(5)="70^RADIOLOGY EXAMS^2^71^RAMIS(71,^B^rad^II^~  ~"
"RTN","ORWGAPIT",107,0)
 S FILES(6)="9000010.11^IMMUNIZATIONS^2^9999999.14^AUTTIMM(^B^imm^IM^~  ~"
"RTN","ORWGAPIT",108,0)
 S FILES(7)="9000010.12^SKIN TESTS^2^9999999.28^AUTTSK(^B^skin^ST^~  ~"
"RTN","ORWGAPIT",109,0)
 S FILES(8)="9000010.13^EXAMS^2^9999999.15,^AUTTEXAM(^B^exam^EXAM^~  ~"
"RTN","ORWGAPIT",110,0)
 S FILES(9)="9000010.18^PROCEDURES^2^81^ICPT(^C^proc^CPT^~  ~"
"RTN","ORWGAPIT",111,0)
 S FILES(10)="9000011^PROBLEMS^2^80^ICD9(^B^prob^PLL^~  ~" ;***
"RTN","ORWGAPIT",112,0)
 S FILES(11)="9000010.23^HEALTH FACTORS^2^9999999.64^AUTTHF(,^B^hf^HF^~  ~"
"RTN","ORWGAPIT",113,0)
 S FILES(12)="9000010.07^PURPOSE OF VISIT^2^80^ICD9(^B^pov^OD^"
"RTN","ORWGAPIT",114,0)
 S FILES(13)="9000010.16^PATIENT EDUCATION^2^9999999.09^AUTTEDT(^B^edu^ED^~  ~"
"RTN","ORWGAPIT",115,0)
 S FILES(14)="601.2^MENTAL HEALTH^2^601^YTT(601,^B^mh^MHPE^~  ~"
"RTN","ORWGAPIT",116,0)
 S FILES(15)="100^ORDERS^2^101.43^ORD(101.43,^B^order^ORC^~  ~"
"RTN","ORWGAPIT",117,0)
 S FILES(16)="45OP^REGISTRATION OP/PROC^2^*^^^op^PRC^~  ~"
"RTN","ORWGAPIT",118,0)
 S FILES(17)="45DX^REGISTRATION DX^2^*^^^dx^DD^~  ~"
"RTN","ORWGAPIT",119,0)
 S FILES(18)="63AP^ANATOMIC PATHOLOGY^2^*^^^ap^SP^~  ~"
"RTN","ORWGAPIT",120,0)
 S FILES(19)="63MI^MICROBIOLOGY^2^*^^^micro^MIC^~  ~"
"RTN","ORWGAPIT",121,0)
 S FILES(20)="9000010^VISITS^3^44^SC(^B^^CVP^~  ~"
"RTN","ORWGAPIT",122,0)
 S FILES(21)="405^ADMISSIONS^3^*^^^^ADC^~  ~"
"RTN","ORWGAPIT",123,0)
 S FILES(23)="53.79^MEDICATION,BCMA^2^50.7^PS(50.7,^B^^BCMA^~  ~"
"RTN","ORWGAPIT",124,0)
 S FILES(24)="130^SURGERY^2^81^ICPT(^C^surg^SR^~  ~"
"RTN","ORWGAPIT",125,0)
 S FILES(25)="8925^NOTES^2^*^^^note^CNB^~  ~"
"RTN","ORWGAPIT",126,0)
 S FILES(27)="120.8^ALLERGIES^2^*^^^allg^ADR^~  ~"
"RTN","ORWGAPIT",127,0)
 S FILES(28)="63BB^BLOOD BANK^2^66^LAB(66,^B^bb^BT^~  ~"
"RTN","ORWGAPIT",128,0)
 ;S FILES(29)="9999911^PROBLEMS-DURATION^3^80^ICD9(^B^prob^PLL^~  ~" ;***
"RTN","ORWGAPIT",129,0)
 S FILES(30)="55NVA^MEDICATION,NON-VA^3^50.7^PS(50.7,^B^^RXNV^~  ~"
"RTN","ORWGAPIT",130,0)
 S FILES(31)="690^MEDICINE^2^*^^^med^MEDF^~  ~"
"RTN","ORWGAPIT",131,0)
 S FILES(2000)="811.2^Reminder Taxonomy"
"RTN","ORWGAPIT",132,0)
 S FILES(3000)="50.605^Drug Class"
"RTN","ORWGAPIT",133,0)
 Q
"RTN","ORWGAPIT",134,0)
 ;
"RTN","ORWGAPIT",135,0)
TYPES(TYPES,DFN,SUB,TMP) ; from ORWGAPI
"RTN","ORWGAPIT",136,0)
 N CNT,FILES,ITEM,MEDARRAY,NUM,OK,SEQ K FILES,MEDARRAY
"RTN","ORWGAPIT",137,0)
 S TMP=$G(TMP)
"RTN","ORWGAPIT",138,0)
 D GETFILES(.FILES)
"RTN","ORWGAPIT",139,0)
 D FILECHK(.FILES)
"RTN","ORWGAPIT",140,0)
 I SUB D
"RTN","ORWGAPIT",141,0)
 . I $D(FILES(18)) D
"RTN","ORWGAPIT",142,0)
 .. S FILES(1801)="63AP;O^AP: Organ"
"RTN","ORWGAPIT",143,0)
 .. S FILES(1802)="63AP;T^AP: Test"
"RTN","ORWGAPIT",144,0)
 .. S FILES(1803)="63AP;D^AP: Disease"
"RTN","ORWGAPIT",145,0)
 .. S FILES(1804)="63AP;I^AP: ICD9"
"RTN","ORWGAPIT",146,0)
 .. S FILES(1805)="63AP;E^AP: Etiology"
"RTN","ORWGAPIT",147,0)
 .. S FILES(1806)="63AP;F^AP: Function"
"RTN","ORWGAPIT",148,0)
 .. S FILES(1807)="63AP;P^AP: Procedure"
"RTN","ORWGAPIT",149,0)
 .. S FILES(1808)="63AP;M^AP: Morphology"
"RTN","ORWGAPIT",150,0)
 .. S FILES(1809)="63AP;S^AP: Specimen"
"RTN","ORWGAPIT",151,0)
 . I $D(FILES(19)) D
"RTN","ORWGAPIT",152,0)
 .. S FILES(1901)="63MI;A^Microbiology: Antibiotic"
"RTN","ORWGAPIT",153,0)
 .. S FILES(1902)="63MI;T^Microbiology: Test"
"RTN","ORWGAPIT",154,0)
 .. S FILES(1903)="63MI;S^Microbiology: Specimen"
"RTN","ORWGAPIT",155,0)
 .. S FILES(1904)="63MI;O^Microbiology: Organism"
"RTN","ORWGAPIT",156,0)
 .. ;S FILES(1905)="63MI;M^Microbiology: TB Drug"
"RTN","ORWGAPIT",157,0)
 I 'SUB D
"RTN","ORWGAPIT",158,0)
 . K FILES(2000)
"RTN","ORWGAPIT",159,0)
 . K FILES(3000)
"RTN","ORWGAPIT",160,0)
 I DFN D
"RTN","ORWGAPIT",161,0)
 . I '$L($O(^PXRMINDX(63,"PI",DFN,""))) K FILES(1)
"RTN","ORWGAPIT",162,0)
 . I '$L($O(^PXRMINDX(120.5,"PI",DFN,""))) K FILES(2)
"RTN","ORWGAPIT",163,0)
 . I '$L($O(^PXRMINDX(52,"PI",DFN,""))) K FILES(3)
"RTN","ORWGAPIT",164,0)
 . I '$L($O(^PXRMINDX(55,"PI",DFN,""))) K FILES(4)
"RTN","ORWGAPIT",165,0)
 . I '$L($O(^PXRMINDX(70,"PI",DFN,""))) K FILES(5)
"RTN","ORWGAPIT",166,0)
 . I '$L($O(^PXRMINDX(9000010.11,"PI",DFN,""))) K FILES(6)
"RTN","ORWGAPIT",167,0)
 . I '$L($O(^PXRMINDX(9000010.12,"PI",DFN,""))) K FILES(7)
"RTN","ORWGAPIT",168,0)
 . I '$L($O(^PXRMINDX(9000010.13,"PI",DFN,""))) K FILES(8)
"RTN","ORWGAPIT",169,0)
 . I '$L($O(^PXRMINDX(9000010.18,"PPI",DFN,""))) K FILES(9)
"RTN","ORWGAPIT",170,0)
 . I '$L($O(^PXRMINDX(9000011,"PSPI",DFN,""))) K FILES(10),FILES(29)
"RTN","ORWGAPIT",171,0)
 . I '$L($O(^PXRMINDX(9000010.23,"PI",DFN,""))) K FILES(11)
"RTN","ORWGAPIT",172,0)
 . I '$L($O(^PXRMINDX(9000010.07,"PPI",DFN,""))) K FILES(12)
"RTN","ORWGAPIT",173,0)
 . I '$L($O(^PXRMINDX(9000010.16,"PI",DFN,""))) K FILES(13)
"RTN","ORWGAPIT",174,0)
 . I '$L($O(^PXRMINDX(601.2,"PI",DFN,""))) K FILES(14)
"RTN","ORWGAPIT",175,0)
 . I '$L($O(^PXRMINDX(100,"PI",DFN,""))) K FILES(15)
"RTN","ORWGAPIT",176,0)
 . I '$L($O(^PXRMINDX(45,"ICD0","PNI",DFN,0))) K FILES(16)
"RTN","ORWGAPIT",177,0)
 . I '$L($O(^PXRMINDX(45,"ICD9","PNI",DFN,0))) K FILES(17)
"RTN","ORWGAPIT",178,0)
 . I $E($O(^PXRMINDX(63,"PI",DFN,"A")))'="A" K FILES(18) D
"RTN","ORWGAPIT",179,0)
 .. F NUM=1:1:9 K FILES(180+NUM)
"RTN","ORWGAPIT",180,0)
 . I $E($O(^PXRMINDX(63,"PI",DFN,"M")))'="M" K FILES(19) D
"RTN","ORWGAPIT",181,0)
 .. F NUM=1:1:5 K FILES(190+NUM)
"RTN","ORWGAPIT",182,0)
 . I '$$VISITX^ORWGAPIA(DFN) K FILES(20)
"RTN","ORWGAPIT",183,0)
 . I '$$ADMITX^ORWGAPIA(DFN) K FILES(21)
"RTN","ORWGAPIT",184,0)
 . I '$$NVAX^ORWGAPIC(DFN) K FILES(22),FILES(30)
"RTN","ORWGAPIT",185,0)
 . I '$$BCMAX^ORWGAPIC(DFN) K FILES(23)
"RTN","ORWGAPIT",186,0)
 . I '$$SURGX^ORWGAPIA(DFN) K FILES(24)
"RTN","ORWGAPIT",187,0)
 . I '$$NOTEX^ORWGAPIA(DFN) K FILES(25)
"RTN","ORWGAPIT",188,0)
 . I '$$ALLERGYX^ORWGAPIA(DFN) K FILES(27)
"RTN","ORWGAPIT",189,0)
 . I '$$BBX^ORWGAPIB(DFN) K FILES(28)
"RTN","ORWGAPIT",190,0)
 . S OK=0
"RTN","ORWGAPIT",191,0)
 . D MEDICINE^ORWGAPIA(.MEDARRAY,DFN)
"RTN","ORWGAPIT",192,0)
 . I $O(MEDARRAY(0)) S OK=1
"RTN","ORWGAPIT",193,0)
 . I 'OK K FILES(31)
"RTN","ORWGAPIT",194,0)
 S CNT=0,SEQ=0
"RTN","ORWGAPIT",195,0)
 F  S SEQ=$O(FILES(SEQ)) Q:SEQ<1  D
"RTN","ORWGAPIT",196,0)
 . S CNT=CNT+1
"RTN","ORWGAPIT",197,0)
 . I TMP S ^TMP(TYPES,$J,CNT)=FILES(SEQ)
"RTN","ORWGAPIT",198,0)
 . I 'TMP S TYPES(CNT)=FILES(SEQ)
"RTN","ORWGAPIT",199,0)
 Q
"RTN","ORWGAPIT",200,0)
 ;
"RTN","ORWGAPIU")
0^131^B23844957
"RTN","ORWGAPIU",1,0)
ORWGAPIU ; SLC/STAFF - Graph API Utilities ;3/17/08  10:27
"RTN","ORWGAPIU",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,260,243**;Dec 17, 1997;Build 242
"RTN","ORWGAPIU",3,0)
 ;
"RTN","ORWGAPIU",4,0)
EVALUE(VAL,FILE,FIELD) ; $$(internal value,file,field) -> external value or ""
"RTN","ORWGAPIU",5,0)
 ; from ORWGAPI1, ORWGAPI2, ORWGAPI3, ORWGAPI4, ORWGAPIP, ORWGAPIR
"RTN","ORWGAPIU",6,0)
 I VAL="" Q ""
"RTN","ORWGAPIU",7,0)
 S FIELD=$G(FIELD,.01)
"RTN","ORWGAPIU",8,0)
 I $E(FILE,1,2)=63 Q $$LABNAME^ORWGAPIC(VAL)
"RTN","ORWGAPIU",9,0)
 I FILE="63AP;I" Q $$ICD9^ORWGAPIA(VAL)
"RTN","ORWGAPIU",10,0)
 I FILE="45DX" Q $$ICD9^ORWGAPIA(VAL)
"RTN","ORWGAPIU",11,0)
 I FILE="45OP" Q $$ICD0^ORWGAPIA(VAL)
"RTN","ORWGAPIU",12,0)
 I FILE="45;ICD9" Q $$ICD9^ORWGAPIA(VAL)
"RTN","ORWGAPIU",13,0)
 I FILE="45;ICD0" Q $$ICD0^ORWGAPIA(VAL)
"RTN","ORWGAPIU",14,0)
 I FIELD=.01,'$L(VAL) Q ""
"RTN","ORWGAPIU",15,0)
 I FILE=9000010.07 Q $$ICD9^ORWGAPIA(VAL)
"RTN","ORWGAPIU",16,0)
 I FILE=9000010.18 Q $$ICPT^ORWGAPIA(VAL)
"RTN","ORWGAPIU",17,0)
 I FILE=9000011 Q $$ICD9^ORWGAPIA(VAL)
"RTN","ORWGAPIU",18,0)
 I FILE=9999911 Q $$ICD9^ORWGAPIA(VAL)
"RTN","ORWGAPIU",19,0)
 I FILE=130 Q $$ICPT^ORWGAPIA(VAL)
"RTN","ORWGAPIU",20,0)
 I FILE=120.8 Q $$ALLG^ORWGAPIA(VAL)
"RTN","ORWGAPIU",21,0)
 I FILE=50.605 Q $$DC^ORWGAPIC(VAL)
"RTN","ORWGAPIU",22,0)
 I FILE=68 Q $$AA^ORWGAPIC(VAL)
"RTN","ORWGAPIU",23,0)
 I FILE=811.2 Q $$TAX^ORWGAPIA(VAL)
"RTN","ORWGAPIU",24,0)
 D
"RTN","ORWGAPIU",25,0)
 . I FILE=52 S FIELD=6 Q
"RTN","ORWGAPIU",26,0)
 . I FILE=53.79 S FIELD=.08 Q
"RTN","ORWGAPIU",27,0)
 . I FILE=55 S FILE=55.07 Q
"RTN","ORWGAPIU",28,0)
 . I FILE="55NVA" S FILE=55.05 Q
"RTN","ORWGAPIU",29,0)
 . I FILE=70 S FILE=70.03,FIELD=2 Q
"RTN","ORWGAPIU",30,0)
 . I FILE=100 S FILE=100.001 Q
"RTN","ORWGAPIU",31,0)
 . I FILE=120.5 S FIELD=.03 Q
"RTN","ORWGAPIU",32,0)
 . I FILE=601.2 S FILE=601.21 Q
"RTN","ORWGAPIU",33,0)
 Q $$EXT^ORWGAPIX(VAL,FILE,FIELD)
"RTN","ORWGAPIU",34,0)
 ;
"RTN","ORWGAPIU",35,0)
FILE(FILE,REF,XREF,SCREEN) ; from ORWGAPI
"RTN","ORWGAPIU",36,0)
 S REF="",SCREEN="I 1",XREF="B"
"RTN","ORWGAPIU",37,0)
 I FILE="" Q
"RTN","ORWGAPIU",38,0)
 D
"RTN","ORWGAPIU",39,0)
 . I FILE="45DX" S REF=$$GBLREF(80),XREF="AB" Q
"RTN","ORWGAPIU",40,0)
 . I FILE="45OP" S REF=$$GBLREF(80.1),XREF="AB" Q
"RTN","ORWGAPIU",41,0)
 . I FILE=50.605 S REF=$$GBLREF(50.605),XREF="C" Q
"RTN","ORWGAPIU",42,0)
 . I FILE=52 S REF=$$GBLREF(50) Q
"RTN","ORWGAPIU",43,0)
 . I FILE=53.79 S REF=$$GBLREF(50.7),SCREEN="I $P(ZERO,U,10)'=1" Q
"RTN","ORWGAPIU",44,0)
 . I FILE=55 S REF=$$GBLREF(50) Q
"RTN","ORWGAPIU",45,0)
 . I FILE="55NVA" S REF=$$GBLREF(50.7),SCREEN="I $P(ZERO,U,10)=1" Q
"RTN","ORWGAPIU",46,0)
 . I FILE=63 S REF=$$GBLREF(60),SCREEN="I $L($P(ZERO,U,5)),""BO""[$P(ZERO,U,3),$P(ZERO,U,4)=""CH""" Q
"RTN","ORWGAPIU",47,0)
 . I FILE="63AP" S REF=$$GBLREF(60),SCREEN="I 0" Q
"RTN","ORWGAPIU",48,0)
 . I FILE="63AP;D" S REF=$$GBLREF(61.4) Q
"RTN","ORWGAPIU",49,0)
 . I FILE="63AP;E" S REF=$$GBLREF(61.2) Q
"RTN","ORWGAPIU",50,0)
 . I FILE="63AP;F" S REF=$$GBLREF(61.3) Q
"RTN","ORWGAPIU",51,0)
 . I FILE="63AP;I" S REF=$$GBLREF(80),XREF="AB" Q
"RTN","ORWGAPIU",52,0)
 . I FILE="63AP;M" S REF=$$GBLREF(61.1) Q
"RTN","ORWGAPIU",53,0)
 . I FILE="63AP;O" S REF=$$GBLREF(61) Q
"RTN","ORWGAPIU",54,0)
 . I FILE="63AP;P" S REF=$$GBLREF(61.5) Q
"RTN","ORWGAPIU",55,0)
 . I FILE="63AP;T" S REF=$$GBLREF(60),SCREEN="I ""BO""[$P(ZERO,U,3),(($P(ZERO,U,4)=""CY"")!($P(ZERO,U,4)=""SP"")!($P(ZERO,U,4)=""EM"")!($P(ZERO,U,4)=""AU""))" Q
"RTN","ORWGAPIU",56,0)
 . I FILE="63BB" S REF=$$GBLREF(66),SCREEN="I $P(ZERO,U,15)=1" Q
"RTN","ORWGAPIU",57,0)
 . I FILE="63MI" S REF=$$GBLREF(60),SCREEN="I 0" Q
"RTN","ORWGAPIU",58,0)
 . I FILE="63MI;A" S REF=$$GBLREF(62.06) Q
"RTN","ORWGAPIU",59,0)
 . I FILE="63MI;M" S REF=$$GBLREF(60) Q  ; mycobacteria not currently used
"RTN","ORWGAPIU",60,0)
 . I FILE="63MI;O" S REF=$$GBLREF(61.2),SCREEN="I $L($P(ZERO,U,5)),""BFPMV""[$P(ZERO,U,5)" Q
"RTN","ORWGAPIU",61,0)
 . I FILE="63MI;S" S REF=$$GBLREF(61) Q
"RTN","ORWGAPIU",62,0)
 . I FILE="63MI;T" S REF=$$GBLREF(60),SCREEN="I ""BO""[$P(ZERO,U,3),$P(ZERO,U,4)=""MI""" Q
"RTN","ORWGAPIU",63,0)
 . I FILE=70 S REF=$$GBLREF(71) Q
"RTN","ORWGAPIU",64,0)
 . I FILE=100 S REF=$$GBLREF(101.43) Q
"RTN","ORWGAPIU",65,0)
 . I FILE=120.5 S REF=$$GBLREF(120.51),SCREEN="I ""BP^P^T^R^P^HT^WT^CVP^CG^PO2^PN""[$P(ZERO,U,2)" Q
"RTN","ORWGAPIU",66,0)
 . ;I FILE=120.8 S REF=$$GBLREF(120.83) Q
"RTN","ORWGAPIU",67,0)
 . I FILE=130 S REF=$$GBLREF(81),SCREEN="I '$P(ZERO,U,4)" Q
"RTN","ORWGAPIU",68,0)
 . I FILE=405 S REF=$$GBLREF(44),SCREEN="I 0" Q
"RTN","ORWGAPIU",69,0)
 . I FILE=601.2 S REF=$$GBLREF(601) Q
"RTN","ORWGAPIU",70,0)
 . I FILE=690 S REF=$$GBLREF(697.2),XREF="BA" Q
"RTN","ORWGAPIU",71,0)
 . I FILE=811.2 S REF=$$GBLREF(811.2),SCREEN="I $P(ZERO,U,6)'=1" Q
"RTN","ORWGAPIU",72,0)
 . I FILE=8925 S REF=$$GBLREF(8925.1),SCREEN="I $P(ZERO,U,4)=""DOC""" Q
"RTN","ORWGAPIU",73,0)
 . I FILE=9000010 S REF=$$GBLREF(44) Q
"RTN","ORWGAPIU",74,0)
 . I FILE=9000010.07 S REF=$$GBLREF(80),XREF="AB" Q
"RTN","ORWGAPIU",75,0)
 . I FILE=9000010.11 S REF=$$GBLREF(9999999.14),SCREEN="I $P(ZERO,U,7)'=1" Q
"RTN","ORWGAPIU",76,0)
 . I FILE=9000010.12 S REF=$$GBLREF(9999999.28),SCREEN="I $P(ZERO,U,3)'=1" Q
"RTN","ORWGAPIU",77,0)
 . I FILE=9000010.13 S REF=$$GBLREF(9999999.15),SCREEN="I $P(ZERO,U,4)'=1" Q
"RTN","ORWGAPIU",78,0)
 . I FILE=9000010.16 S REF=$$GBLREF(9999999.09),SCREEN="I $P(ZERO,U,3)'=1" Q
"RTN","ORWGAPIU",79,0)
 . I FILE=9000010.18 S REF=$$GBLREF(81),XREF="BA",SCREEN="I '$P(ZERO,U,4)" Q
"RTN","ORWGAPIU",80,0)
 . I FILE=9000010.23 S REF=$$GBLREF(9999999.64),SCREEN="I $P(ZERO,U,10)=""F"",$P(ZERO,U,11)'=1" Q
"RTN","ORWGAPIU",81,0)
 . I FILE=9000011 S REF=$$GBLREF(80),XREF="AB",SCREEN="I $E(ZERO)'=""E"",'$L($P(ZERO,U,9))" Q
"RTN","ORWGAPIU",82,0)
 . I FILE=9999911 S REF=$$GBLREF(80),XREF="AB",SCREEN="I $E(ZERO)'=""E"",'$L($P(ZERO,U,9))" Q
"RTN","ORWGAPIU",83,0)
 I $E(REF)'="^" S REF=""
"RTN","ORWGAPIU",84,0)
 S REF=REF  ;_""""_XREF_""")"
"RTN","ORWGAPIU",85,0)
 Q
"RTN","ORWGAPIU",86,0)
 ;
"RTN","ORWGAPIU",87,0)
GBLREF(FN) ; $$(file#) -> global reference
"RTN","ORWGAPIU",88,0)
 Q $$GBLREF^ORWGAPIX($G(FN))
"RTN","ORWGAPIU",89,0)
 ;
"RTN","ORWGAPIU",90,0)
INISET ; postinit, set initial public graph setting  - from ORY215, ORY243
"RTN","ORWGAPIU",91,0)
 D INISET^ORWGAPIP
"RTN","ORWGAPIU",92,0)
 D RESOURCE^ORWGTASK
"RTN","ORWGAPIU",93,0)
 Q
"RTN","ORWGAPIU",94,0)
 ;
"RTN","ORWGAPIU",95,0)
ITEMPRFX(ITEM) ; $$(item) -> item prefix   - from ORWGAPI1
"RTN","ORWGAPIU",96,0)
 N ABBREV,PREFIX
"RTN","ORWGAPIU",97,0)
 S PREFIX=""
"RTN","ORWGAPIU",98,0)
 S ABBREV=$P(ITEM,";",2)
"RTN","ORWGAPIU",99,0)
 I $E(ITEM)="A" D  Q PREFIX
"RTN","ORWGAPIU",100,0)
 . I ABBREV="T" S PREFIX="TEST" Q
"RTN","ORWGAPIU",101,0)
 . I ABBREV="S" S PREFIX="SPECIMEN" Q
"RTN","ORWGAPIU",102,0)
 . I ABBREV="O" S PREFIX="ORGAN" Q
"RTN","ORWGAPIU",103,0)
 . I ABBREV="M" S PREFIX="MORPHOLOGY" Q
"RTN","ORWGAPIU",104,0)
 . I ABBREV="E" S PREFIX="ETIOLOGY" Q
"RTN","ORWGAPIU",105,0)
 . I ABBREV="D" S PREFIX="DISEASE" Q
"RTN","ORWGAPIU",106,0)
 . I ABBREV="P" S PREFIX="PROCEDURE" Q
"RTN","ORWGAPIU",107,0)
 . I ABBREV="F" S PREFIX="FUNCTION" Q
"RTN","ORWGAPIU",108,0)
 . I ABBREV="I" S PREFIX="ICD9" Q
"RTN","ORWGAPIU",109,0)
 I $E(ITEM)="B" Q "BLOOD COMPONENT"
"RTN","ORWGAPIU",110,0)
 I $E(ITEM)="M" D  Q PREFIX
"RTN","ORWGAPIU",111,0)
 . I ABBREV="T" S PREFIX="TEST" Q
"RTN","ORWGAPIU",112,0)
 . I ABBREV="S" S PREFIX="SPECIMEN" Q
"RTN","ORWGAPIU",113,0)
 . I ABBREV="O" S PREFIX="ORGANISM" Q
"RTN","ORWGAPIU",114,0)
 . I ABBREV="A" S PREFIX="ANTIBIOTIC" Q
"RTN","ORWGAPIU",115,0)
 . I ABBREV="M" S PREFIX="TB ANTIBIOTIC" Q
"RTN","ORWGAPIU",116,0)
 Q PREFIX
"RTN","ORWGAPIU",117,0)
 ;
"RTN","ORWGAPIW")
0^132^B11947849
"RTN","ORWGAPIW",1,0)
ORWGAPIW ; SLC/STAFF - Graph API Utilities, Generic ;8/19/06  15:20
"RTN","ORWGAPIW",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORWGAPIW",3,0)
 ;
"RTN","ORWGAPIW",4,0)
DATA(ARRAY) ; $$(application results) -> single string of results
"RTN","ORWGAPIW",5,0)
 N NUM,RESULT,SUB
"RTN","ORWGAPIW",6,0)
 S OUT=""
"RTN","ORWGAPIW",7,0)
 S SUB=""
"RTN","ORWGAPIW",8,0)
 F  S SUB=$O(ARRAY(SUB)) Q:SUB=""  D
"RTN","ORWGAPIW",9,0)
 . I $D(ARRAY(SUB,0)) D  Q
"RTN","ORWGAPIW",10,0)
 .. S OUT=OUT_SUB_"["
"RTN","ORWGAPIW",11,0)
 .. S NUM=0
"RTN","ORWGAPIW",12,0)
 .. F  S NUM=$O(ARRAY(SUB,NUM)) Q:NUM<1  D
"RTN","ORWGAPIW",13,0)
 ... S RESULT=$G(ARRAY(SUB,NUM,0))
"RTN","ORWGAPIW",14,0)
 ... S OUT=OUT_RESULT_";"
"RTN","ORWGAPIW",15,0)
 .. S OUT=OUT_"]"
"RTN","ORWGAPIW",16,0)
 . S RESULT=$G(ARRAY(SUB))
"RTN","ORWGAPIW",17,0)
 . S OUT=OUT_SUB_"["_RESULT_"]"
"RTN","ORWGAPIW",18,0)
 S OUT=$TR(OUT,U,"~")
"RTN","ORWGAPIW",19,0)
 Q OUT
"RTN","ORWGAPIW",20,0)
 ;
"RTN","ORWGAPIW",21,0)
DATETFM(DATETIME) ; $$(external date/time) -> fm date/time else 0
"RTN","ORWGAPIW",22,0)
 N DATE,DAY,FMDT,HOUR,MIN,SEC,TIME,YEAR
"RTN","ORWGAPIW",23,0)
 S DATE=$P(DATETIME,"@"),TIME=$P(DATETIME,"@",2)
"RTN","ORWGAPIW",24,0)
 S YEAR=$P(DATE,",",2) I $L(YEAR)'=4 Q 0
"RTN","ORWGAPIW",25,0)
 S YEAR=YEAR-1700 I YEAR<270 Q 0
"RTN","ORWGAPIW",26,0)
 S MONTH=$P(DATE," ")
"RTN","ORWGAPIW",27,0)
 S MONTH=$$MTN(MONTH) I MONTH<1 Q 0
"RTN","ORWGAPIW",28,0)
 I MONTH<10 S MONTH="0"_MONTH
"RTN","ORWGAPIW",29,0)
 S DAY=$P(DATE," ",2),DAY=$P(DAY,",")
"RTN","ORWGAPIW",30,0)
 I DAY<1 Q 0
"RTN","ORWGAPIW",31,0)
 I DAY<10 S DAY="0"_DAY
"RTN","ORWGAPIW",32,0)
 S HOUR=$P(TIME,":")
"RTN","ORWGAPIW",33,0)
 S MIN=$P(TIME,":",2)
"RTN","ORWGAPIW",34,0)
 S SEC=$P(TIME,":",3)
"RTN","ORWGAPIW",35,0)
 S TIME=HOUR_MIN_SEC
"RTN","ORWGAPIW",36,0)
 S FMDT=YEAR_MONTH_DAY
"RTN","ORWGAPIW",37,0)
 I '$L(TIME) Q FMDT
"RTN","ORWGAPIW",38,0)
 Q FMDT_"."_TIME
"RTN","ORWGAPIW",39,0)
 ;
"RTN","ORWGAPIW",40,0)
GENERIC(VAL,FROM,DIR,FILE,REF,XREF,SCREEN) ; Return a set of entries from xref in REF
"RTN","ORWGAPIW",41,0)
 ; from ORWGAPI
"RTN","ORWGAPIW",42,0)
 ; .VAL=returned list, FROM=text to $O from, DIR=$O direction,
"RTN","ORWGAPIW",43,0)
 N CNT,IEN,NAME,NEXTNAME,NUM,OK,ROOT,ZERO S NUM=0,CNT=44 K VAL
"RTN","ORWGAPIW",44,0)
 I FILE=405 Q
"RTN","ORWGAPIW",45,0)
 S ROOT=""
"RTN","ORWGAPIW",46,0)
 S FROM=$$UP^ORWGAPIX(FROM)
"RTN","ORWGAPIW",47,0)
 I $E(REF,$L(REF))="," S ROOT=$E(REF,1,$L(REF)-1)_")"
"RTN","ORWGAPIW",48,0)
 I $E(REF,$L(REF))="(" S ROOT=$P(REF,"(")
"RTN","ORWGAPIW",49,0)
 I '$L(ROOT) Q
"RTN","ORWGAPIW",50,0)
 S REF=REF_""""_XREF_""")"
"RTN","ORWGAPIW",51,0)
 F  Q:NUM'<CNT  S FROM=$O(@REF@(FROM),DIR) Q:FROM=""  D
"RTN","ORWGAPIW",52,0)
 . S IEN="" F  S IEN=$O(@REF@(FROM,IEN),DIR) Q:'IEN  D
"RTN","ORWGAPIW",53,0)
 .. I FILE=100,$O(@REF@(FROM,IEN,""))>0 Q
"RTN","ORWGAPIW",54,0)
 .. S ZERO=$G(@ROOT@(IEN,0)) I '$L(ZERO) Q
"RTN","ORWGAPIW",55,0)
 .. X SCREEN I '$T Q
"RTN","ORWGAPIW",56,0)
 .. S NUM=NUM+1
"RTN","ORWGAPIW",57,0)
 .. I FILE="45DX"!(FILE=9000010.07)!(FILE=9000011)!(FILE="63AP;I") D  Q
"RTN","ORWGAPIW",58,0)
 ... S VAL(NUM)=FILE_U_IEN_U_$$ICD9^ORWGAPIA(IEN) Q
"RTN","ORWGAPIW",59,0)
 .. I FILE="45OP" S VAL(NUM)=FILE_U_IEN_U_$$ICD0^ORWGAPIA(IEN) Q
"RTN","ORWGAPIW",60,0)
 .. I FILE=53.79 S VAL(NUM)=FILE_U_IEN_U_$$POINAME^ORWGAPIC(IEN) Q
"RTN","ORWGAPIW",61,0)
 .. I FILE="55NVA" S VAL(NUM)=FILE_U_IEN_U_$$POINAME^ORWGAPIC(IEN) Q
"RTN","ORWGAPIW",62,0)
 .. I FILE=9000010.18 S VAL(NUM)=FILE_U_IEN_U_$$ICPT^ORWGAPIA(IEN) Q
"RTN","ORWGAPIW",63,0)
 .. I FILE=130 S VAL(NUM)=FILE_U_IEN_U_$$ICPT^ORWGAPIA(IEN) Q
"RTN","ORWGAPIW",64,0)
 .. S VAL(NUM)=FILE_U_IEN_U_FROM
"RTN","ORWGAPIW",65,0)
 I FILE=120.5 D
"RTN","ORWGAPIW",66,0)
 . S (NUM,OK)=0
"RTN","ORWGAPIW",67,0)
 . F  S NUM=$O(VAL(NUM)) Q:NUM<1  D  Q:OK
"RTN","ORWGAPIW",68,0)
 .. S NAME=$P(VAL(NUM),U,3)
"RTN","ORWGAPIW",69,0)
 .. S NEXTNAME=$P($G(VAL(NUM+1)),U,3)
"RTN","ORWGAPIW",70,0)
 .. I "BODY MASS INDEX"]NAME,NEXTNAME]"BODY MASS INDEX" D
"RTN","ORWGAPIW",71,0)
 ... S OK=1
"RTN","ORWGAPIW",72,0)
 ... S VAL(NUM+.5)="120.5^99999^BODY MASS INDEX"
"RTN","ORWGAPIW",73,0)
 Q
"RTN","ORWGAPIW",74,0)
 ;
"RTN","ORWGAPIW",75,0)
MTN(MONTH) ; $$(external month) -> month number
"RTN","ORWGAPIW",76,0)
 N MONTHS,NUM
"RTN","ORWGAPIW",77,0)
 I $L(MONTH)'=3 Q 0
"RTN","ORWGAPIW",78,0)
 S MONTHS="JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC"
"RTN","ORWGAPIW",79,0)
 F NUM=1:1:13 I $P(MONTHS,U,NUM)=MONTH Q
"RTN","ORWGAPIW",80,0)
 I NUM=13 Q 0
"RTN","ORWGAPIW",81,0)
 Q NUM
"RTN","ORWGAPIW",82,0)
 ;
"RTN","ORWGAPIW",83,0)
OGROUP(OITEM) ; $$(orderable item) -> ien display group^display group   - from ORWGAPIR
"RTN","ORWGAPIW",84,0)
 N IEN
"RTN","ORWGAPIW",85,0)
 S IEN=+$P($G(^ORD(101.43,+$G(OITEM),0)),U,5)
"RTN","ORWGAPIW",86,0)
 Q IEN_U_"order - "_$P($G(^ORD(100.98,IEN,0)),U)
"RTN","ORWGAPIW",87,0)
 ;
"RTN","ORWGAPIW",88,0)
RETURN(TMP,ITEMS) ; return TMP (0 use local, 1 use ^TMP(ITEMS,$J, where ITEMS is a namespaced string)
"RTN","ORWGAPIW",89,0)
 ; from ORWGAPI, ORWGAPIP, ORWGAPIX
"RTN","ORWGAPIW",90,0)
 N NMSP
"RTN","ORWGAPIW",91,0)
 S NMSP=$G(ITEMS) K ITEMS S ITEMS=""
"RTN","ORWGAPIW",92,0)
 S TMP=NMSP?1U1UN1.14UNP
"RTN","ORWGAPIW",93,0)
 I TMP S ITEMS=NMSP
"RTN","ORWGAPIW",94,0)
 Q
"RTN","ORWGAPIW",95,0)
 ;
"RTN","ORWGAPIW",96,0)
SETUP(DATA,RESULT,TMP,CNT) ; from ORWGAPI1, ORWGAPI2, ORWGAPI3, ORWGAPI4, ORWGAPIP, ORWGAPIR, ORWGAPIX
"RTN","ORWGAPIW",97,0)
 S CNT=CNT+1
"RTN","ORWGAPIW",98,0)
 I TMP=2 S ^TMP(DATA,$J,$P(RESULT,U,1,2))=RESULT Q
"RTN","ORWGAPIW",99,0)
 I TMP S ^TMP(DATA,$J,CNT)=RESULT
"RTN","ORWGAPIW",100,0)
 I 'TMP S DATA(CNT)=RESULT
"RTN","ORWGAPIW",101,0)
 Q
"RTN","ORWGAPIW",102,0)
 ;
"RTN","ORWGAPIX")
0^133^B23118742
"RTN","ORWGAPIX",1,0)
ORWGAPIX ; SLC/STAFF - Graph External Calls ;9/29/06  11:49
"RTN","ORWGAPIX",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,260,243**;Dec 17, 1997;Build 242
"RTN","ORWGAPIX",3,0)
 ;
"RTN","ORWGAPIX",4,0)
DATE(X) ; $$(date/time) -> date/time
"RTN","ORWGAPIX",5,0)
 N Y D ^%DT
"RTN","ORWGAPIX",6,0)
 Q Y
"RTN","ORWGAPIX",7,0)
ENDIQ1(RESULTS,DIC,DR,DA,DIQ) ; use file # for DIC
"RTN","ORWGAPIX",8,0)
 N NUMDIC K RESULTS,^UTILITY("DIQ1",$J)
"RTN","ORWGAPIX",9,0)
 Q:'$G(DIC)  Q:'$L(DR)  Q:'$G(DA)
"RTN","ORWGAPIX",10,0)
 S NUMDIC=DIC
"RTN","ORWGAPIX",11,0)
 D EN^DIQ1
"RTN","ORWGAPIX",12,0)
 M RESULTS=^UTILITY("DIQ1",$J,NUMDIC,DA)
"RTN","ORWGAPIX",13,0)
 K ^UTILITY("DIQ1",$J)
"RTN","ORWGAPIX",14,0)
 Q
"RTN","ORWGAPIX",15,0)
EXT(Y,FILE,FIELD) ; $$(value,file,field) -> external value
"RTN","ORWGAPIX",16,0)
 N C S C=$P($G(^DD(FILE,FIELD,0)),U,2) D Y^DIQ
"RTN","ORWGAPIX",17,0)
 Q Y
"RTN","ORWGAPIX",18,0)
EXTERNAL(FILE,FIELD,FLAG,VAL) ; $$(file,field,flag,internal value) -> external value
"RTN","ORWGAPIX",19,0)
 Q $$EXTERNAL^DILFD(FILE,FIELD,FLAG,VAL)
"RTN","ORWGAPIX",20,0)
EXTNAME(IEN,FN) ; $$(ien,file#) -> external form of pointer
"RTN","ORWGAPIX",21,0)
 N REF
"RTN","ORWGAPIX",22,0)
 S REF=$G(^DIC(FN,0,"GL"))
"RTN","ORWGAPIX",23,0)
 I $L(REF),+IEN Q $P($G(@(REF_IEN_",0)")),U)
"RTN","ORWGAPIX",24,0)
 Q ""
"RTN","ORWGAPIX",25,0)
FILENM(FILENUM) ; $$(file#) -> file name
"RTN","ORWGAPIX",26,0)
 N DIC,DO,NAME K DIC,DO
"RTN","ORWGAPIX",27,0)
 S FILENUM=$$GBLREF(+$G(FILENUM))
"RTN","ORWGAPIX",28,0)
 I '$L($G(FILENUM)) Q ""
"RTN","ORWGAPIX",29,0)
 S DIC=FILENUM
"RTN","ORWGAPIX",30,0)
 D DO^DIC1
"RTN","ORWGAPIX",31,0)
 S NAME=$P(DO,U)
"RTN","ORWGAPIX",32,0)
 Q NAME
"RTN","ORWGAPIX",33,0)
GETDATA(RESULTS,DIC,DR,DA,DIQ) ; use file # for DIC
"RTN","ORWGAPIX",34,0)
 N NUMDIC K RESULTS,^UTILITY("DIQ1",$J)
"RTN","ORWGAPIX",35,0)
 Q:'$G(DIC)  Q:'$L(DR)  Q:'$G(DA)
"RTN","ORWGAPIX",36,0)
 S NUMDIC=DIC
"RTN","ORWGAPIX",37,0)
 D EN^DIQ1
"RTN","ORWGAPIX",38,0)
 M RESULTS=^UTILITY("DIQ1",$J,NUMDIC,DA)
"RTN","ORWGAPIX",39,0)
 K ^UTILITY("DIQ1",$J)
"RTN","ORWGAPIX",40,0)
 Q
"RTN","ORWGAPIX",41,0)
GBLREF(FILENUM) ; $$(file#) -> global reference
"RTN","ORWGAPIX",42,0)
 I '$G(FILENUM) Q ""
"RTN","ORWGAPIX",43,0)
 Q $$ROOT^DILFD(+FILENUM)
"RTN","ORWGAPIX",44,0)
INDEX(DIK,DA) ; index entry in file   -  from ORWGAPIP
"RTN","ORWGAPIX",45,0)
 D IX1^DIK
"RTN","ORWGAPIX",46,0)
 Q
"RTN","ORWGAPIX",47,0)
XDEL(ENTITY,PARAM,NAME,ORERR) ; from ORWGAPIP
"RTN","ORWGAPIX",48,0)
 D DEL^XPAR(ENTITY,PARAM,NAME,.ORERR)
"RTN","ORWGAPIX",49,0)
 Q
"RTN","ORWGAPIX",50,0)
XEN(ENTITY,PARAM,NAME,ORVAL,ORERR) ; from ORWGAPIP
"RTN","ORWGAPIX",51,0)
 D EN^XPAR(ENTITY,PARAM,NAME,.ORVAL,.ORERR)
"RTN","ORWGAPIX",52,0)
 Q
"RTN","ORWGAPIX",53,0)
XENVAL(ORVALUES,PARAM) ;
"RTN","ORWGAPIX",54,0)
 D ENVAL^XPAR(.ORVALUES,PARAM)
"RTN","ORWGAPIX",55,0)
 Q
"RTN","ORWGAPIX",56,0)
XGET(ENTITY,PARAM,INST,FORMAT) ; $$(...) -> parameter values
"RTN","ORWGAPIX",57,0)
 Q $$GET^XPAR(ENTITY,PARAM,INST,FORMAT)
"RTN","ORWGAPIX",58,0)
XGETLST(ORLIST,ENTITY,PARAM) ; from ORWGAPIP
"RTN","ORWGAPIX",59,0)
 D GETLST^XPAR(.ORLIST,ENTITY,PARAM)
"RTN","ORWGAPIX",60,0)
 Q
"RTN","ORWGAPIX",61,0)
XGETLST1(ORLIST,ENTITY,PARAM,FORMAT,ORERR) ; from ORWGAPIP
"RTN","ORWGAPIX",62,0)
 D GETLST^XPAR(.ORLIST,ENTITY,PARAM,FORMAT,.ORERR)
"RTN","ORWGAPIX",63,0)
 Q
"RTN","ORWGAPIX",64,0)
XGETWP(ORWP,ENTITY,PARAM,ALL) ; from ORWGAPIP
"RTN","ORWGAPIX",65,0)
 D GETWP^XPAR(.ORWP,ENTITY,PARAM,ALL)
"RTN","ORWGAPIX",66,0)
 Q
"RTN","ORWGAPIX",67,0)
 ; kernel functions
"RTN","ORWGAPIX",68,0)
FMADD(X,D,H,M,S) ;
"RTN","ORWGAPIX",69,0)
 Q $$FMADD^XLFDT(X,$G(D),$G(H),$G(M),$G(S))
"RTN","ORWGAPIX",70,0)
NOW() ;
"RTN","ORWGAPIX",71,0)
 Q $$NOW^XLFDT
"RTN","ORWGAPIX",72,0)
LOW(X) ;
"RTN","ORWGAPIX",73,0)
 Q $$LOW^XLFSTR(X)
"RTN","ORWGAPIX",74,0)
REPLACE(STRING,ORARRAY) ;
"RTN","ORWGAPIX",75,0)
 Q $$REPLACE^XLFSTR(STRING,.ORARRAY)
"RTN","ORWGAPIX",76,0)
TRIM(X,F,V) ;
"RTN","ORWGAPIX",77,0)
 Q $$TRIM^XLFSTR(X,$G(F,"LR"),$G(V," "))
"RTN","ORWGAPIX",78,0)
UP(X) ;
"RTN","ORWGAPIX",79,0)
 Q $$UP^XLFSTR(X)
"RTN","ORWGAPIX",80,0)
BMIITEMS(ITEMS,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPIX",81,0)
 N BMI,NUM,REPLACE K REPLACE
"RTN","ORWGAPIX",82,0)
 S REPLACE("WEIGHT")="BODY MASS INDEX"
"RTN","ORWGAPIX",83,0)
 S BMI=""
"RTN","ORWGAPIX",84,0)
 S NUM=0
"RTN","ORWGAPIX",85,0)
 I 'TMP D
"RTN","ORWGAPIX",86,0)
 . F  S NUM=$O(ITEMS(NUM)) Q:NUM<1  D
"RTN","ORWGAPIX",87,0)
 .. I $P(ITEMS(NUM),U,2)=8 S $P(BMI,U)=1
"RTN","ORWGAPIX",88,0)
 .. I $P(ITEMS(NUM),U,2)=9 S $P(BMI,U,2)=ITEMS(NUM)
"RTN","ORWGAPIX",89,0)
 I TMP D
"RTN","ORWGAPIX",90,0)
 . F  S NUM=$O(^TMP(ITEMS,$J,NUM)) Q:NUM<1  D
"RTN","ORWGAPIX",91,0)
 .. I $P(^TMP(ITEMS,$J,NUM),U,2)=8 S $P(BMI,U)=1
"RTN","ORWGAPIX",92,0)
 .. I $P(^TMP(ITEMS,$J,NUM),U,2)=9 S $P(BMI,U,2)=^TMP(ITEMS,$J,NUM)
"RTN","ORWGAPIX",93,0)
 I BMI,$L(BMI)>3 D
"RTN","ORWGAPIX",94,0)
 . S CNT=CNT+1
"RTN","ORWGAPIX",95,0)
 . S RESULT=$P(BMI,U,2,99)
"RTN","ORWGAPIX",96,0)
 . S RESULT=$$REPLACE^ORWGAPIX(RESULT,.REPLACE)
"RTN","ORWGAPIX",97,0)
 . S $P(RESULT,U,2)=99999
"RTN","ORWGAPIX",98,0)
 . D SETUP^ORWGAPIW(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPIX",99,0)
 Q
"RTN","ORWGAPIX",100,0)
 ;
"RTN","ORWGAPIX",101,0)
BMIDATA(DATA,ITEM,START,DFN,CNT,TMP) ; from ORWGAPI4
"RTN","ORWGAPIX",102,0)
 N DATE,DATE2,NODE,RESULT,VALUE,W K VALUE
"RTN","ORWGAPIX",103,0)
 S DATE="",DATE2="",CNT=$G(CNT)
"RTN","ORWGAPIX",104,0)
 F  S DATE=$O(^PXRMINDX(120.5,"PI",DFN,9,DATE)) Q:DATE=""  D
"RTN","ORWGAPIX",105,0)
 . I DATE>START Q
"RTN","ORWGAPIX",106,0)
 . S NODE=""
"RTN","ORWGAPIX",107,0)
 . F  S NODE=$O(^PXRMINDX(120.5,"PI",DFN,9,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPIX",108,0)
 .. D VITAL^ORWGAPIA(.VALUE,NODE) S WT=$P($G(VALUE(7)),U) I 'WT Q
"RTN","ORWGAPIX",109,0)
 .. S BMI=$$BMI(DFN,WT,DATE) I 'BMI Q
"RTN","ORWGAPIX",110,0)
 .. S RESULT=120.5_U_ITEM_U_DATE_U_DATE2_U_BMI
"RTN","ORWGAPIX",111,0)
 .. D SETUP^ORWGAPIW(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPIX",112,0)
 Q
"RTN","ORWGAPIX",113,0)
 ;
"RTN","ORWGAPIX",114,0)
BMI(DFN,WT,DATE) ; $$(dfn,wt,date) -> bmi, else ""
"RTN","ORWGAPIX",115,0)
 N HDATE,HT,NEXT,NODE,PREV
"RTN","ORWGAPIX",116,0)
 I '$O(^PXRMINDX(120.5,"PI",DFN,8,0)) Q ""
"RTN","ORWGAPIX",117,0)
 S NODE=$O(^PXRMINDX(120.5,"PI",DFN,8,DATE,""))
"RTN","ORWGAPIX",118,0)
 I '$L(NODE) D
"RTN","ORWGAPIX",119,0)
 . S NEXT=+$O(^PXRMINDX(120.5,"PI",DFN,8,DATE))
"RTN","ORWGAPIX",120,0)
 . S PREV=+$O(^PXRMINDX(120.5,"PI",DFN,8,DATE),-1)
"RTN","ORWGAPIX",121,0)
 . S NODE=$O(^PXRMINDX(120.5,"PI",DFN,8,$$CLOSEST(DATE,NEXT,PREV),""))
"RTN","ORWGAPIX",122,0)
 I '$L(NODE) Q ""
"RTN","ORWGAPIX",123,0)
 D VITAL^ORWGAPIA(.VALUE,NODE) S HT=$P($G(VALUE(7)),U) I 'HT Q ""
"RTN","ORWGAPIX",124,0)
 Q $$CALCBMI(HT,WT)
"RTN","ORWGAPIX",125,0)
 ;
"RTN","ORWGAPIX",126,0)
CALCBMI(HT,WT) ; $$(ht,wt) -> bmi  uses (inches,lbs)
"RTN","ORWGAPIX",127,0)
 S WT=WT/2.2 ;+$$WEIGHT^XLFMSMT(WT,"LB","KG")
"RTN","ORWGAPIX",128,0)
 S HT=HT*2.54/100 ;+$$LENGTH^XLFMSMT(HT,"IN","M")
"RTN","ORWGAPIX",129,0)
 Q $J(WT/(HT*HT),0,2)
"RTN","ORWGAPIX",130,0)
 ;
"RTN","ORWGAPIX",131,0)
CLOSEST(DATE,NEXT,PREV) ;
"RTN","ORWGAPIX",132,0)
 I $$FMDIFF^XLFDT(DATE,NEXT,2)>$$FMDIFF^XLFDT(DATE,PREV,2) Q PREV
"RTN","ORWGAPIX",133,0)
 Q NEXT
"RTN","ORWGAPIX",134,0)
 ;
"RTN","ORWGAPIX",135,0)
BMILAST(DFN,ARRAY,CNT) ;
"RTN","ORWGAPIX",136,0)
 N BMI,DATE,NUM,WT
"RTN","ORWGAPIX",137,0)
 S (DATE,NUM,WT)=0
"RTN","ORWGAPIX",138,0)
 F  S NUM=$O(ARRAY(NUM)) Q:NUM<1  D  Q:WT
"RTN","ORWGAPIX",139,0)
 . I $P(ARRAY(NUM),U,2)'="WT" Q
"RTN","ORWGAPIX",140,0)
 . S WT=+$P(ARRAY(NUM),U,3)
"RTN","ORWGAPIX",141,0)
 . S DATE=$P(ARRAY(NUM),U,4)
"RTN","ORWGAPIX",142,0)
 I 'WT Q
"RTN","ORWGAPIX",143,0)
 I 'DATE Q
"RTN","ORWGAPIX",144,0)
 S BMI=$$BMI(DFN,WT,DATE)
"RTN","ORWGAPIX",145,0)
 I 'BMI Q
"RTN","ORWGAPIX",146,0)
 S CNT=CNT+1
"RTN","ORWGAPIX",147,0)
 S ARRAY(CNT)="-1^BMI^"_BMI_U_DATE_U_BMI_"^^"
"RTN","ORWGAPIX",148,0)
 Q
"RTN","ORWGAPIX",149,0)
 ;
"RTN","ORWGAPIX",150,0)
ZZ() ; test use only - this code will be removed before v27 release
"RTN","ORWGAPIX",151,0)
 N X,ZIP,ZZ
"RTN","ORWGAPIX",152,0)
 S ZZ=$C(36)_$C(90)_$C(72)
"RTN","ORWGAPIX",153,0)
 S ZIP="S X="_ZZ X ZIP
"RTN","ORWGAPIX",154,0)
 Q X
"RTN","ORWGRPC")
0^111^B13989770
"RTN","ORWGRPC",1,0)
ORWGRPC ; SLC/STAFF - Graph RPC ;3/9/06  13:59
"RTN","ORWGRPC",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,243**;Dec 17, 1997;Build 242
"RTN","ORWGRPC",3,0)
 ;
"RTN","ORWGRPC",4,0)
ALLITEMS(ITEMS,DFN) ; RPC - get all items of data on patient (procedures, tests, codes,..)
"RTN","ORWGRPC",5,0)
 D ALLITEMS^ORWGAPI("ORWGRPC",DFN)
"RTN","ORWGRPC",6,0)
 S ITEMS=$NA(^TMP("ORWGRPC",$J))
"RTN","ORWGRPC",7,0)
 Q
"RTN","ORWGRPC",8,0)
 ;
"RTN","ORWGRPC",9,0)
ALLVIEWS(DATA,VIEW,USER) ; RPC - get all graph views
"RTN","ORWGRPC",10,0)
 D ALLVIEWS^ORWGAPI("ORWGRPC",+$G(VIEW),+$G(USER))
"RTN","ORWGRPC",11,0)
 S DATA=$NA(^TMP("ORWGRPC",$J))
"RTN","ORWGRPC",12,0)
 Q
"RTN","ORWGRPC",13,0)
 ;
"RTN","ORWGRPC",14,0)
CLASS(DATA,TYPE) ; RPC - get classifications
"RTN","ORWGRPC",15,0)
 D CLASS^ORWGAPI("ORWGRPC",TYPE)
"RTN","ORWGRPC",16,0)
 S DATA=$NA(^TMP("ORWGRPC",$J))
"RTN","ORWGRPC",17,0)
 Q
"RTN","ORWGRPC",18,0)
 ;
"RTN","ORWGRPC",19,0)
DATEDATA(DATA,OLDEST,NEWEST,TYPEITEM,DFN) ; RPC - get data for an item on patient in date range
"RTN","ORWGRPC",20,0)
 D DATEDATA^ORWGAPI("ORWGRPC",OLDEST,NEWEST,TYPEITEM,DFN)
"RTN","ORWGRPC",21,0)
 S DATA=$NA(^TMP("ORWGRPC",$J))
"RTN","ORWGRPC",22,0)
 Q
"RTN","ORWGRPC",23,0)
 ; 
"RTN","ORWGRPC",24,0)
DATEITEM(DATA,OLDEST,NEWEST,FNUM,DFN) ; RPC - get patient items in date range for a type
"RTN","ORWGRPC",25,0)
 D DATEITEM^ORWGAPI("ORWGRPC",OLDEST,NEWEST,FNUM,DFN)
"RTN","ORWGRPC",26,0)
 S DATA=$NA(^TMP("ORWGRPC",$J))
"RTN","ORWGRPC",27,0)
 Q
"RTN","ORWGRPC",28,0)
 ; 
"RTN","ORWGRPC",29,0)
DELVIEWS(ERR,NAME,PUBLIC) ; RPC - delete a graph view
"RTN","ORWGRPC",30,0)
 D DELVIEWS^ORWGAPI("ORWGRPC",NAME,+$G(PUBLIC))
"RTN","ORWGRPC",31,0)
 S ERR=$NA(^TMP("ORWGRPC",$J))
"RTN","ORWGRPC",32,0)
 Q
"RTN","ORWGRPC",33,0)
 ;
"RTN","ORWGRPC",34,0)
DETAIL(ITEMS,DFN,DATE1,DATE2,VAL,COMP) ; RPC - get all reports for types of data from items and date range
"RTN","ORWGRPC",35,0)
 D DETAIL^ORWGAPI("ORWGRPC",DFN,DATE1,DATE2,.VAL,$G(COMP))
"RTN","ORWGRPC",36,0)
 S ITEMS=$NA(^TMP("ORWGRPC",$J))
"RTN","ORWGRPC",37,0)
 Q
"RTN","ORWGRPC",38,0)
 ;
"RTN","ORWGRPC",39,0)
DETAILS(ITEMS,DFN,DATE1,DATE2,TYPE,COMP) ; RPC - get report for type of data for a date or date range
"RTN","ORWGRPC",40,0)
 D DETAILS^ORWGAPI("ORWGRPC",DFN,DATE1,DATE2,TYPE,$G(COMP))
"RTN","ORWGRPC",41,0)
 S ITEMS=$NA(^TMP("ORWGRPC",$J))
"RTN","ORWGRPC",42,0)
 Q
"RTN","ORWGRPC",43,0)
 ;
"RTN","ORWGRPC",44,0)
FASTDATA(DATA,DFN) ; RPC - get all data (non-lab) set up on patient
"RTN","ORWGRPC",45,0)
 D FASTDATA^ORWGAPI(.DATA,DFN)
"RTN","ORWGRPC",46,0)
 Q
"RTN","ORWGRPC",47,0)
 ;
"RTN","ORWGRPC",48,0)
FASTITEM(ITEMS,DFN) ; RPC - get all items set up on patient
"RTN","ORWGRPC",49,0)
 D FASTITEM^ORWGAPI(.ITEMS,DFN)
"RTN","ORWGRPC",50,0)
 Q
"RTN","ORWGRPC",51,0)
 ;
"RTN","ORWGRPC",52,0)
FASTLABS(DATA,DFN) ; RPC - get all lab data set up on patient
"RTN","ORWGRPC",53,0)
 D FASTLABS^ORWGAPI(.DATA,DFN)
"RTN","ORWGRPC",54,0)
 Q
"RTN","ORWGRPC",55,0)
 ;
"RTN","ORWGRPC",56,0)
FASTTASK(STATUS,DFN,OLDDFN) ; set up all data and items on patient
"RTN","ORWGRPC",57,0)
 D FASTTASK^ORWGAPI(.STATUS,DFN,$G(OLDDFN))
"RTN","ORWGRPC",58,0)
 Q
"RTN","ORWGRPC",59,0)
 ;
"RTN","ORWGRPC",60,0)
GETDATES(DATA,REPORTID) ; RPC - get graph date range
"RTN","ORWGRPC",61,0)
 D GETDATES^ORWGAPI("ORWGRPC",$G(REPORTID))
"RTN","ORWGRPC",62,0)
 S DATA=$NA(^TMP("ORWGRPC",$J))
"RTN","ORWGRPC",63,0)
 Q
"RTN","ORWGRPC",64,0)
 ;
"RTN","ORWGRPC",65,0)
GETPREF(DATA) ; RPC - get graph settings
"RTN","ORWGRPC",66,0)
 D GETPREF^ORWGAPI("ORWGRPC")
"RTN","ORWGRPC",67,0)
 S DATA=$NA(^TMP("ORWGRPC",$J))
"RTN","ORWGRPC",68,0)
 Q
"RTN","ORWGRPC",69,0)
 ;
"RTN","ORWGRPC",70,0)
GETSIZE(DATA) ; RPC - get graph positions and sizes
"RTN","ORWGRPC",71,0)
 D GETSIZE^ORWGAPI("ORWGRPC")
"RTN","ORWGRPC",72,0)
 S DATA=$NA(^TMP("ORWGRPC",$J))
"RTN","ORWGRPC",73,0)
 Q
"RTN","ORWGRPC",74,0)
 ;
"RTN","ORWGRPC",75,0)
GETVIEWS(DATA,ALL,PUBLIC,EXT,USER) ; RPC - get graph views
"RTN","ORWGRPC",76,0)
 D GETVIEWS^ORWGAPI("ORWGRPC",ALL,+$G(PUBLIC),+$G(EXT),+$G(USER))
"RTN","ORWGRPC",77,0)
 S DATA=$NA(^TMP("ORWGRPC",$J))
"RTN","ORWGRPC",78,0)
 Q
"RTN","ORWGRPC",79,0)
 ;
"RTN","ORWGRPC",80,0)
ITEMDATA(DATA,ITEM,START,DFN) ; RPC - get data of an item on patient (glucose results)
"RTN","ORWGRPC",81,0)
 D ITEMDATA^ORWGAPI("ORWGRPC",ITEM,START,DFN)
"RTN","ORWGRPC",82,0)
 S DATA=$NA(^TMP("ORWGRPC",$J))
"RTN","ORWGRPC",83,0)
 Q
"RTN","ORWGRPC",84,0)
 ; 
"RTN","ORWGRPC",85,0)
ITEMS(ITEMS,DFN,TYPE) ; RPC - get items of a type of data on patient (lab tests)
"RTN","ORWGRPC",86,0)
 D ITEMS^ORWGAPI("ORWGRPC",DFN,TYPE)
"RTN","ORWGRPC",87,0)
 S ITEMS=$NA(^TMP("ORWGRPC",$J))
"RTN","ORWGRPC",88,0)
 Q
"RTN","ORWGRPC",89,0)
 ;
"RTN","ORWGRPC",90,0)
LOOKUP(VAL,INFO,FROM,DIR) ; RPC - get item names for long lookup
"RTN","ORWGRPC",91,0)
 D LOOKUP^ORWGAPI(.VAL,INFO,.FROM,DIR)
"RTN","ORWGRPC",92,0)
 Q
"RTN","ORWGRPC",93,0)
 ;
"RTN","ORWGRPC",94,0)
PUBLIC(VAL) ; RPC - check if user can edit public views and settings
"RTN","ORWGRPC",95,0)
 S VAL=$$PUBLIC^ORWGAPI(DUZ)
"RTN","ORWGRPC",96,0)
 Q
"RTN","ORWGRPC",97,0)
 ;
"RTN","ORWGRPC",98,0)
RPTPARAM(VAL,IEN) ; RPC - return PARAM1^PARAM2 for graph report
"RTN","ORWGRPC",99,0)
 S VAL=$$RPTPARAM^ORWGAPI(IEN)
"RTN","ORWGRPC",100,0)
 Q
"RTN","ORWGRPC",101,0)
 ;
"RTN","ORWGRPC",102,0)
SETPREF(ERR,SETTING,PUBLIC) ; RPC - set a graph setting
"RTN","ORWGRPC",103,0)
 D SETPREF^ORWGAPI("ORWGRPC",SETTING,+$G(PUBLIC))
"RTN","ORWGRPC",104,0)
 S ERR=$NA(^TMP("ORWGRPC",$J))
"RTN","ORWGRPC",105,0)
 Q
"RTN","ORWGRPC",106,0)
 ;
"RTN","ORWGRPC",107,0)
SETSIZE(ERR,VAL) ; RPC - set graph positions and sizes
"RTN","ORWGRPC",108,0)
 D SETSIZE^ORWGAPI("ORWGRPC",.VAL)
"RTN","ORWGRPC",109,0)
 S ERR=$NA(^TMP("ORWGRPC",$J))
"RTN","ORWGRPC",110,0)
 Q
"RTN","ORWGRPC",111,0)
 ;
"RTN","ORWGRPC",112,0)
SETVIEWS(ERR,NAME,PUBLIC,VAL) ; RPC - set a graph view
"RTN","ORWGRPC",113,0)
 D SETVIEWS^ORWGAPI("ORWGRPC",NAME,+$G(PUBLIC),.VAL)
"RTN","ORWGRPC",114,0)
 S ERR=$NA(^TMP("ORWGRPC",$J))
"RTN","ORWGRPC",115,0)
 Q
"RTN","ORWGRPC",116,0)
 ;
"RTN","ORWGRPC",117,0)
TAX(DATA,ALL,REMTAX) ; RPC - get reminder taxonomies
"RTN","ORWGRPC",118,0)
 D TAX^ORWGAPI("ORWGRPC",+$G(ALL),.REMTAX)
"RTN","ORWGRPC",119,0)
 S DATA=$NA(^TMP("ORWGRPC",$J))
"RTN","ORWGRPC",120,0)
 Q
"RTN","ORWGRPC",121,0)
 ;
"RTN","ORWGRPC",122,0)
TESTING(DATA) ; RPC - cache data
"RTN","ORWGRPC",123,0)
 D TESTING^ORWGAPI("ORWGRPC")
"RTN","ORWGRPC",124,0)
 S DATA=$NA(^TMP("ORWGRPC",$J))
"RTN","ORWGRPC",125,0)
 Q
"RTN","ORWGRPC",126,0)
 ;
"RTN","ORWGRPC",127,0)
TESTSPEC(DATA) ; RPC - get test/spec info on all lab tests
"RTN","ORWGRPC",128,0)
 D TESTSPEC^ORWGAPI("ORWGRPC")
"RTN","ORWGRPC",129,0)
 S DATA=$NA(^TMP("ORWGRPC",$J))
"RTN","ORWGRPC",130,0)
 Q
"RTN","ORWGRPC",131,0)
 ;
"RTN","ORWGRPC",132,0)
TYPES(TYPES,DFN,SUB) ; RPC - get all the types of data on a patient (SUB=1, gets subtypes, DFN=0 gets all types), 
"RTN","ORWGRPC",133,0)
 D TYPES^ORWGAPI("ORWGRPC",DFN,+$G(SUB))
"RTN","ORWGRPC",134,0)
 S TYPES=$NA(^TMP("ORWGRPC",$J))
"RTN","ORWGRPC",135,0)
 Q
"RTN","ORWGRPC",136,0)
 ;
"RTN","ORWGTASK")
0^112^B79728825
"RTN","ORWGTASK",1,0)
ORWGTASK ; SLC/STAFF - Graph Task ;3/17/08  10:48
"RTN","ORWGTASK",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORWGTASK",3,0)
 ;
"RTN","ORWGTASK",4,0)
SETLAST(PAT) ; from ORWGAPI - set whenever patient is graphed
"RTN","ORWGTASK",5,0)
 N NOW,USER
"RTN","ORWGTASK",6,0)
 S PAT=+$G(PAT)
"RTN","ORWGTASK",7,0)
 S USER=+$G(DUZ)
"RTN","ORWGTASK",8,0)
 S NOW=$$NOW^ORWGAPIX
"RTN","ORWGTASK",9,0)
 I USER,PAT D
"RTN","ORWGTASK",10,0)
 . S ^XTMP("ORGDATA","TP",PAT)=NOW
"RTN","ORWGTASK",11,0)
 . S ^XTMP("ORGDATA","TP",PAT,"U",USER)=NOW
"RTN","ORWGTASK",12,0)
 . S ^XTMP("ORGDATA","TU",USER)=NOW
"RTN","ORWGTASK",13,0)
 . D COUNT("G",PAT,USER)
"RTN","ORWGTASK",14,0)
 Q
"RTN","ORWGTASK",15,0)
 ;
"RTN","ORWGTASK",16,0)
INIT(OK) ; from ORMTIM02 - run by ORMTIME (OK=0) 
"RTN","ORWGTASK",17,0)
 N BACKTO,CNT,DFN,ITEM,LASTDFN,NOW,PURGE,TASKED,TIME
"RTN","ORWGTASK",18,0)
 S OK=+$G(OK,0)
"RTN","ORWGTASK",19,0)
 I $G(^XTMP("ORGRAPH","FORCE"))="ON" D  ; set in ORY243 (post-init v27)
"RTN","ORWGTASK",20,0)
 . S OK=1
"RTN","ORWGTASK",21,0)
 . D CLEANALL
"RTN","ORWGTASK",22,0)
 I 'OK D  ; unless forced, run one time on Saturday
"RTN","ORWGTASK",23,0)
 . I $P($G(^XTMP("ORGRAPH",0)),U,2)=DT Q
"RTN","ORWGTASK",24,0)
 . I $E(DT,6)="0",$$DOW^XLFDT(DT)="Saturday",$L($G(^XTMP("ORGRAPH",0))) D  Q  ; cleanup on 1st Sat of the month
"RTN","ORWGTASK",25,0)
 .. S OK=1
"RTN","ORWGTASK",26,0)
 .. D CLEANALL
"RTN","ORWGTASK",27,0)
 . I $$DOW^XLFDT(DT)="Saturday",$L($G(^XTMP("ORGRAPH",0))) S OK=1 Q
"RTN","ORWGTASK",28,0)
 I 'OK Q
"RTN","ORWGTASK",29,0)
 S BACKTO=$$FMADD^XLFDT(DT,-30) ;clear old data on non-graphed patients backto this date 
"RTN","ORWGTASK",30,0)
 S PURGE=$$FMADD^XLFDT(DT,180) ; when to purge XTMP nodes
"RTN","ORWGTASK",31,0)
 S NOW=$$NOW^ORWGAPIX
"RTN","ORWGTASK",32,0)
 S ^XTMP("ORGDATA",0)=PURGE_U_DT_U_"CPRS Graphing - Patient Data Cache Stats"_U_NOW
"RTN","ORWGTASK",33,0)
 S ^XTMP("ORGRAPH",0)=PURGE_U_DT_U_"CPRS Graphing - Patient Data Cache"
"RTN","ORWGTASK",34,0)
 S CNT=0
"RTN","ORWGTASK",35,0)
 S LASTDFN=0
"RTN","ORWGTASK",36,0)
 S DFN=""
"RTN","ORWGTASK",37,0)
 F  S DFN=$O(^XTMP("ORGDATA","TP",DFN)) Q:DFN=""  D
"RTN","ORWGTASK",38,0)
 . S TIME=$O(^XTMP("ORGDATA","TP",DFN))
"RTN","ORWGTASK",39,0)
 . I '$L(TIME) Q
"RTN","ORWGTASK",40,0)
 . I TIME<BACKTO D CLRDATA(DFN) Q
"RTN","ORWGTASK",41,0)
 . S ^XTMP("ORGRAPH","QUEUE",NOW_"^0^"_DFN)=NOW ; put patients to update on queue
"RTN","ORWGTASK",42,0)
 . S LASTDFN=DFN
"RTN","ORWGTASK",43,0)
 . S CNT=CNT+1
"RTN","ORWGTASK",44,0)
 . S OK=1
"RTN","ORWGTASK",45,0)
 D UPDATE(.TASKED,LASTDFN,0,0) ; last patient starts the updates
"RTN","ORWGTASK",46,0)
 S ^XTMP("ORGRAPH","INIT")=NOW_U_$$NOW^ORWGAPIX_U_CNT
"RTN","ORWGTASK",47,0)
 S ^XTMP("ORGDATA",0)=^XTMP("ORGDATA",0)_U_$$NOW^ORWGAPIX_U_CNT
"RTN","ORWGTASK",48,0)
 Q
"RTN","ORWGTASK",49,0)
 ;
"RTN","ORWGTASK",50,0)
CLEANALL ;
"RTN","ORWGTASK",51,0)
 K ^XTMP("ORGDATA")
"RTN","ORWGTASK",52,0)
 K ^XTMP("ORGRAPH")
"RTN","ORWGTASK",53,0)
 Q
"RTN","ORWGTASK",54,0)
 ;
"RTN","ORWGTASK",55,0)
CLRDATA(DFN) ;
"RTN","ORWGTASK",56,0)
 N PATUSER,USER
"RTN","ORWGTASK",57,0)
 S USER=.9
"RTN","ORWGTASK",58,0)
 F  S USER=$O(^XTMP("ORGDATA","TP",DFN,"U",USER)) Q:USER<1  D
"RTN","ORWGTASK",59,0)
 . S PATUSER=DFN_U_USER
"RTN","ORWGTASK",60,0)
 . K ^XTMP("ORGRAPH","ALL DATA",PATUSER)
"RTN","ORWGTASK",61,0)
 . K ^XTMP("ORGRAPH","ALL ITEMS",PATUSER)
"RTN","ORWGTASK",62,0)
 . K ^XTMP("ORGRAPH","ALL LABS",PATUSER)
"RTN","ORWGTASK",63,0)
 . K ^XTMP("ORGRAPH","OLD DATA",DFN)
"RTN","ORWGTASK",64,0)
 . K ^XTMP("ORGRAPH","OLD LABS",DFN)
"RTN","ORWGTASK",65,0)
 K ^XTMP("ORGDATA","TP",DFN)
"RTN","ORWGTASK",66,0)
 Q
"RTN","ORWGTASK",67,0)
 ;
"RTN","ORWGTASK",68,0)
UPDATE(TASKED,DFN,USER,OLDDFN) ; from ORWGAPI
"RTN","ORWGTASK",69,0)
 ; whenever patient is selected
"RTN","ORWGTASK",70,0)
 ; to update, cache must exist and user/patient combo has used graphs
"RTN","ORWGTASK",71,0)
 ;D CLEANALL Q  ; ******** temporary disabled BA 1/16/08 *********
"RTN","ORWGTASK",72,0)
 N NOW,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE K ZTSAVE
"RTN","ORWGTASK",73,0)
 ;S ^XTMP("ZZZBOB")=$G(TASKED)_U_$G(DFN)_U_$G(USER)_U_$G(OLDDFN)
"RTN","ORWGTASK",74,0)
 S TASKED=-1 ; cache turned off
"RTN","ORWGTASK",75,0)
 I '$L($G(^XTMP("ORGRAPH",0))) Q
"RTN","ORWGTASK",76,0)
 S TASKED=0 ; not building cache
"RTN","ORWGTASK",77,0)
 I USER,DFN D COUNT("P",DFN,USER)
"RTN","ORWGTASK",78,0)
 I USER,'$G(^XTMP("ORGDATA","TU",USER)) Q  ; user must use graphing to cache
"RTN","ORWGTASK",79,0)
 I USER,OLDDFN D CLEARPT(OLDDFN,USER)
"RTN","ORWGTASK",80,0)
 I 'DFN Q
"RTN","ORWGTASK",81,0)
 I '$G(^XTMP("ORGDATA","TP",DFN)) Q  ; patient must be used with graphing to cache
"RTN","ORWGTASK",82,0)
 I USER,'$G(^XTMP("ORGDATA","TP",DFN,"U",USER)) Q  ; pat/user combo to cache **** comment this out for better graph speed - but more cache
"RTN","ORWGTASK",83,0)
 S TASKED=1 ; building cache
"RTN","ORWGTASK",84,0)
 S NOW=$$NOW^ORWGAPIX
"RTN","ORWGTASK",85,0)
 I USER D CLEARPT(DFN,USER)
"RTN","ORWGTASK",86,0)
 S ZTIO="ORWG GRAPHING RESOURCE",ZTDTH=$H,ZTDESC="process graph data"
"RTN","ORWGTASK",87,0)
 S ZTSAVE("ORMTIME")=$$MNOW
"RTN","ORWGTASK",88,0)
 S ZTSAVE("ORPAT")=DFN
"RTN","ORWGTASK",89,0)
 S ZTSAVE("ORTSTMP")=NOW
"RTN","ORWGTASK",90,0)
 S ZTSAVE("ORUSER")=USER
"RTN","ORWGTASK",91,0)
 S ZTRTN="UP^ORWGTASK"
"RTN","ORWGTASK",92,0)
 D ^%ZTLOAD
"RTN","ORWGTASK",93,0)
 Q
"RTN","ORWGTASK",94,0)
 ;
"RTN","ORWGTASK",95,0)
COUNT(EVENT,DFN,USER) ;
"RTN","ORWGTASK",96,0)
 I EVENT="P" D  Q
"RTN","ORWGTASK",97,0)
 . S ^("C")=1+$G(^XTMP("ORGDATA","P",DFN,"C"))
"RTN","ORWGTASK",98,0)
 . S ^(USER)=1+$G(^XTMP("ORGDATA","P",DFN,"C-U",USER))
"RTN","ORWGTASK",99,0)
 . S ^("C")=1+$G(^XTMP("ORGDATA","U",USER,"C"))
"RTN","ORWGTASK",100,0)
 . S ^(DFN)=1+$G(^XTMP("ORGDATA","U",USER,"C-P",DFN))
"RTN","ORWGTASK",101,0)
 I EVENT="G" D  Q
"RTN","ORWGTASK",102,0)
 . S ^("CG")=1+$G(^XTMP("ORGDATA","P",DFN,"CG"))
"RTN","ORWGTASK",103,0)
 . S ^(USER)=1+$G(^XTMP("ORGDATA","P",DFN,"CG-U",USER))
"RTN","ORWGTASK",104,0)
 . S ^("CG")=1+$G(^XTMP("ORGDATA","U",USER,"CG"))
"RTN","ORWGTASK",105,0)
 . S ^(DFN)=1+$G(^XTMP("ORGDATA","U",USER,"CG-P",DFN))
"RTN","ORWGTASK",106,0)
 Q
"RTN","ORWGTASK",107,0)
 ;
"RTN","ORWGTASK",108,0)
CLEARPT(DFN,USER) ;
"RTN","ORWGTASK",109,0)
 N PATUSER
"RTN","ORWGTASK",110,0)
 S PATUSER=DFN_U_USER
"RTN","ORWGTASK",111,0)
 K ^XTMP("ORGRAPH","ALL DATA",PATUSER)
"RTN","ORWGTASK",112,0)
 K ^XTMP("ORGRAPH","ALL ITEMS",PATUSER)
"RTN","ORWGTASK",113,0)
 K ^XTMP("ORGRAPH","ALL LABS",PATUSER)
"RTN","ORWGTASK",114,0)
 Q
"RTN","ORWGTASK",115,0)
 ;
"RTN","ORWGTASK",116,0)
UP ; dequeued from ORWGTASK
"RTN","ORWGTASK",117,0)
 ; ORUSER, ORPAT, ORTSTMP were saved
"RTN","ORWGTASK",118,0)
 N GNOW,GSTAMP,NOW,STAMP
"RTN","ORWGTASK",119,0)
 S STAMP=ORTSTMP_U_ORUSER_U_ORPAT
"RTN","ORWGTASK",120,0)
 S GSTAMP=ORMTIME_U_ORUSER_U_ORPAT
"RTN","ORWGTASK",121,0)
 S NOW=$$NOW^ORWGAPIX
"RTN","ORWGTASK",122,0)
 S GNOW=$$MNOW
"RTN","ORWGTASK",123,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","ORWGTASK",124,0)
 S ^XTMP("ORGRAPH","QUEUE",STAMP)=NOW_U_ORMTIME
"RTN","ORWGTASK",125,0)
 S ^XTMP("ORGDATA","Q",GSTAMP)=GSTAMP
"RTN","ORWGTASK",126,0)
 S ^XTMP("ORGDATA","QT",ORUSER_U_ORPAT)=ORMTIME
"RTN","ORWGTASK",127,0)
 D GSTAMP(GSTAMP,ORMTIME,GNOW,4)
"RTN","ORWGTASK",128,0)
 I 'ORUSER S $P(^XTMP("ORGRAPH","INIT"),U,4)=NOW
"RTN","ORWGTASK",129,0)
 I $G(^XTMP("ORGRAPH","STATUS"))'="ACTIVE" D START
"RTN","ORWGTASK",130,0)
 S ^XTMP("ORGRAPH","STATUS")="INACTIVE"
"RTN","ORWGTASK",131,0)
 Q
"RTN","ORWGTASK",132,0)
 ;
"RTN","ORWGTASK",133,0)
START ;
"RTN","ORWGTASK",134,0)
 S ^XTMP("ORGRAPH","STATUS")="ACTIVE"
"RTN","ORWGTASK",135,0)
 N COUNT,MAX,NEXT,STOP,TIMES
"RTN","ORWGTASK",136,0)
 S MAX=5
"RTN","ORWGTASK",137,0)
 S COUNT=0
"RTN","ORWGTASK",138,0)
 S STOP=0
"RTN","ORWGTASK",139,0)
 S NEXT=""
"RTN","ORWGTASK",140,0)
 F  S NEXT=$O(^XTMP("ORGRAPH","QUEUE",NEXT)) D  Q:STOP
"RTN","ORWGTASK",141,0)
 . I NEXT="" D  Q
"RTN","ORWGTASK",142,0)
 .. H 1
"RTN","ORWGTASK",143,0)
 .. S COUNT=COUNT+1
"RTN","ORWGTASK",144,0)
 .. I COUNT>MAX S STOP=1 Q
"RTN","ORWGTASK",145,0)
 . S TIMES=^XTMP("ORGRAPH","QUEUE",NEXT)
"RTN","ORWGTASK",146,0)
 . K ^XTMP("ORGRAPH","QUEUE",NEXT)
"RTN","ORWGTASK",147,0)
 . D PROCESS(NEXT,TIMES)
"RTN","ORWGTASK",148,0)
 . K ^XTMP("ORGRAPH","QUEUE",NEXT)
"RTN","ORWGTASK",149,0)
 Q
"RTN","ORWGTASK",150,0)
 ;
"RTN","ORWGTASK",151,0)
PROCESS(NEXT,TIMES) ;
"RTN","ORWGTASK",152,0)
 N DFN,GSTAMP,IN,OUT,TSTMP,USER
"RTN","ORWGTASK",153,0)
 S TSTMP=+$P(NEXT,U)
"RTN","ORWGTASK",154,0)
 S USER=+$P(NEXT,U,2)
"RTN","ORWGTASK",155,0)
 S DFN=$P(NEXT,U,3)
"RTN","ORWGTASK",156,0)
 S GSTAMP=$P(TIMES,U,2)_U_USER_U_DFN
"RTN","ORWGTASK",157,0)
 D ALL(GSTAMP,DFN,USER)
"RTN","ORWGTASK",158,0)
 I 'USER S $P(^XTMP("ORGRAPH","INIT"),U,5)=$$NOW^ORWGAPIX
"RTN","ORWGTASK",159,0)
 Q
"RTN","ORWGTASK",160,0)
 ;
"RTN","ORWGTASK",161,0)
ALL(GSTAMP,DFN,USER) ;
"RTN","ORWGTASK",162,0)
 N BACKTO,CNT,LASTDATE,NUM,PATUSER,PREV,START,TIMED,TIMEI,TIMEL,TIMEZ,TYPE
"RTN","ORWGTASK",163,0)
 K ^TMP("ORGAI",$J),^TMP("ORGI",$J),^TMP("ORGT",$J)
"RTN","ORWGTASK",164,0)
 S START=$$NOW^ORWGAPIX
"RTN","ORWGTASK",165,0)
 S DFN=+$G(DFN) I 'DFN Q
"RTN","ORWGTASK",166,0)
 S USER=+$G(USER)
"RTN","ORWGTASK",167,0)
 S PATUSER=DFN_U_USER
"RTN","ORWGTASK",168,0)
 S TIMEI=START
"RTN","ORWGTASK",169,0)
 D GSTAMP(GSTAMP,+GSTAMP,$$MNOW,5)
"RTN","ORWGTASK",170,0)
 S GTIME=$$MNOW
"RTN","ORWGTASK",171,0)
 D TYPES^ORWGAPI("ORGT",DFN)
"RTN","ORWGTASK",172,0)
 I '$L($O(^TMP("ORGT",$J,""))) Q
"RTN","ORWGTASK",173,0)
 S NUM=""
"RTN","ORWGTASK",174,0)
 F  S NUM=$O(^TMP("ORGT",$J,NUM)) Q:NUM=""  D
"RTN","ORWGTASK",175,0)
 . S TYPE=$P(^TMP("ORGT",$J,NUM),U)
"RTN","ORWGTASK",176,0)
 . K ^TMP("ORGI",$J)
"RTN","ORWGTASK",177,0)
 . S CNT=0
"RTN","ORWGTASK",178,0)
 . D ITEMS^ORWGAPIR("ORGI",DFN,TYPE,3,,,.CNT,2)
"RTN","ORWGTASK",179,0)
 . M ^TMP("ORGAI",$J)=^TMP("ORGI",$J)
"RTN","ORWGTASK",180,0)
 K ^TMP("ORGI",$J)
"RTN","ORWGTASK",181,0)
 S PREV=1
"RTN","ORWGTASK",182,0)
 I '$D(^XTMP("ORGRAPH","OLD DATA",DFN)) S PREV=0
"RTN","ORWGTASK",183,0)
 I '$D(^XTMP("ORGRAPH","OLD LABS",DFN)) S PREV=0
"RTN","ORWGTASK",184,0)
 I USER D  ; user is 0 when doing init
"RTN","ORWGTASK",185,0)
 . L +^XTMP("ORGRAPH","ALL ITEMS",PATUSER):1 I '$T Q
"RTN","ORWGTASK",186,0)
 . M ^XTMP("ORGRAPH","ALL ITEMS",PATUSER)=^TMP("ORGAI",$J)
"RTN","ORWGTASK",187,0)
 . L -^XTMP("ORGRAPH","ALL ITEMS",PATUSER)
"RTN","ORWGTASK",188,0)
 S LASTDATE=+$G(^XTMP("ORGRAPH","LAST BUILD",DFN))
"RTN","ORWGTASK",189,0)
 I 'LASTDATE S LASTDATE=DT
"RTN","ORWGTASK",190,0)
 S BACKTO=$$FMADD^XLFDT(LASTDATE,-30) ; *** backto value is 30 days ********************
"RTN","ORWGTASK",191,0)
 S TIMED=$$NOW^ORWGAPIX
"RTN","ORWGTASK",192,0)
 D GETDATA("DATA",GSTAMP,GTIME,PATUSER,START,BACKTO)
"RTN","ORWGTASK",193,0)
 S TIMEL=$$NOW^ORWGAPIX
"RTN","ORWGTASK",194,0)
 D GETDATA("LABS",GSTAMP,GTIME,PATUSER,START,BACKTO)
"RTN","ORWGTASK",195,0)
 S TIMEZ=$$NOW^ORWGAPIX
"RTN","ORWGTASK",196,0)
 S ^XTMP("ORGRAPH","LAST BUILD",DFN)=DT
"RTN","ORWGTASK",197,0)
 K ^TMP("ORGAI",$J),^TMP("ORGI",$J),^TMP("ORGT",$J)
"RTN","ORWGTASK",198,0)
 Q
"RTN","ORWGTASK",199,0)
 ;
"RTN","ORWGTASK",200,0)
GETDATA(TYPES,GSTAMP,GTIME,PATUSER,START,BACKTO) ;
"RTN","ORWGTASK",201,0)
 N ALLSUBS,CNT,DATA,DFN,NUM,NUM1,OLDSUBS,SUB,TYPEITEM,USER
"RTN","ORWGTASK",202,0)
 K ^TMP("ORGD",$J),^TMP("ORGID",$J),^TMP("ORGNI",$J)
"RTN","ORWGTASK",203,0)
 S OLDSUBS="OLD "_TYPES
"RTN","ORWGTASK",204,0)
 S ALLSUBS="ALL "_TYPES
"RTN","ORWGTASK",205,0)
 S DFN=+PATUSER
"RTN","ORWGTASK",206,0)
 S USER=+$P(PATUSER,U,2)
"RTN","ORWGTASK",207,0)
 S SIZE=0
"RTN","ORWGTASK",208,0)
 I $D(^XTMP("ORGRAPH",OLDSUBS,DFN)) D
"RTN","ORWGTASK",209,0)
 . S SUB=""
"RTN","ORWGTASK",210,0)
 . F  S SUB=$O(^TMP("ORGAI",$J,SUB)) Q:SUB=""  D
"RTN","ORWGTASK",211,0)
 .. S TYPEITEM=$G(^TMP("ORGAI",$J,SUB))
"RTN","ORWGTASK",212,0)
 .. I TYPES="DATA",$P(TYPEITEM,U)=63 Q
"RTN","ORWGTASK",213,0)
 .. I TYPES="LABS",$P(TYPEITEM,U)'=63 Q
"RTN","ORWGTASK",214,0)
 .. I $P(TYPEITEM,U,6)>BACKTO S ^TMP("ORGNI",$J,SUB)=TYPEITEM
"RTN","ORWGTASK",215,0)
 . S CNT=0
"RTN","ORWGTASK",216,0)
 . S NUM=""
"RTN","ORWGTASK",217,0)
 . F  S NUM=$O(^TMP("ORGNI",$J,NUM)) Q:NUM=""  D
"RTN","ORWGTASK",218,0)
 .. S TYPEITEM=^TMP("ORGNI",$J,NUM)
"RTN","ORWGTASK",219,0)
 .. D SIZE(TYPEITEM,START,DFN,BACKTO,.SIZE)
"RTN","ORWGTASK",220,0)
 . D GSTAMP(GSTAMP,GTIME,$$MNOW,6)
"RTN","ORWGTASK",221,0)
 . S $P(^XTMP("ORGDATA","Q",GSTAMP),U,16)=SIZE+$P(^XTMP("ORGDATA","Q",GSTAMP),U,16)
"RTN","ORWGTASK",222,0)
 E  D
"RTN","ORWGTASK",223,0)
 . S NUM=""
"RTN","ORWGTASK",224,0)
 . F  S NUM=$O(^TMP("ORGAI",$J,NUM)) Q:NUM=""  D
"RTN","ORWGTASK",225,0)
 .. S TYPEITEM=^TMP("ORGAI",$J,NUM)
"RTN","ORWGTASK",226,0)
 .. I TYPES="DATA",$P(TYPEITEM,U)=63 Q
"RTN","ORWGTASK",227,0)
 .. I TYPES="LABS",$P(TYPEITEM,U)'=63 Q
"RTN","ORWGTASK",228,0)
 .. D SIZE(TYPEITEM,START,DFN,2700101,.SIZE)
"RTN","ORWGTASK",229,0)
 . D GSTAMP(GSTAMP,GTIME,$$MNOW,7)
"RTN","ORWGTASK",230,0)
 . S $P(^XTMP("ORGDATA","Q",GSTAMP),U,17)=SIZE+$P(^XTMP("ORGDATA","Q",GSTAMP),U,17)
"RTN","ORWGTASK",231,0)
 S GTIME=$$MNOW
"RTN","ORWGTASK",232,0)
 M ^XTMP("ORGRAPH",OLDSUBS,DFN)=^TMP("ORGD",$J)
"RTN","ORWGTASK",233,0)
 I USER D  ; user is 0 when doing init
"RTN","ORWGTASK",234,0)
 . L +^XTMP("ORGRAPH",ALLSUBS,PATUSER):1 I '$T Q
"RTN","ORWGTASK",235,0)
 . M ^XTMP("ORGRAPH",ALLSUBS,PATUSER)=^XTMP("ORGRAPH",OLDSUBS,DFN)
"RTN","ORWGTASK",236,0)
 . L -^XTMP("ORGRAPH",ALLSUBS,PATUSER)
"RTN","ORWGTASK",237,0)
 K ^TMP("ORGD",$J),^TMP("ORGID",$J),^TMP("ORGNI",$J)
"RTN","ORWGTASK",238,0)
 D GSTAMP(GSTAMP,GTIME,$$MNOW,8)
"RTN","ORWGTASK",239,0)
 Q
"RTN","ORWGTASK",240,0)
 ;
"RTN","ORWGTASK",241,0)
SIZE(TYPEITEM,START,DFN,BACKTO,SIZE) ;
"RTN","ORWGTASK",242,0)
 N DATA,NUM
"RTN","ORWGTASK",243,0)
 K ^TMP("ORGID",$J)
"RTN","ORWGTASK",244,0)
 D ITEMDATA^ORWGAPI("ORGID",TYPEITEM,START,DFN,BACKTO)
"RTN","ORWGTASK",245,0)
 S NUM=""
"RTN","ORWGTASK",246,0)
 F  S NUM=$O(^TMP("ORGID",$J,NUM)) Q:NUM=""  D
"RTN","ORWGTASK",247,0)
 . S DATA=^TMP("ORGID",$J,NUM)
"RTN","ORWGTASK",248,0)
 . S ^TMP("ORGD",$J,$P(DATA,U,1,3))=DATA
"RTN","ORWGTASK",249,0)
 . S SIZE=$L(DATA)+SIZE
"RTN","ORWGTASK",250,0)
 Q
"RTN","ORWGTASK",251,0)
 ;
"RTN","ORWGTASK",252,0)
RESOURCE ; from ORWGAPIU on post init, setup graphing resource device
"RTN","ORWGTASK",253,0)
 N X
"RTN","ORWGTASK",254,0)
 S X=$$RES^XUDHSET("ORWG GRAPHING RESOURCE",,3,"CPRS GUI graphing data retrieval")
"RTN","ORWGTASK",255,0)
 Q
"RTN","ORWGTASK",256,0)
 ;
"RTN","ORWGTASK",257,0)
GSTAMP(GSTAMP,TIME1,TIME2,PIECE) ;
"RTN","ORWGTASK",258,0)
 S $P(^XTMP("ORGDATA","Q",GSTAMP),"^",PIECE)=TIME2-TIME1
"RTN","ORWGTASK",259,0)
 Q
"RTN","ORWGTASK",260,0)
 ;
"RTN","ORWGTASK",261,0)
MNOW() ;
"RTN","ORWGTASK",262,0)
 Q $$ZZ^ORWGAPIX
"RTN","ORWGTASK",263,0)
 ;
"RTN","ORWGTASK",264,0)
CLEAN ;
"RTN","ORWGTASK",265,0)
 K ^XTMP("ORGRAPH")
"RTN","ORWGTASK",266,0)
 Q
"RTN","ORWGTASK",267,0)
 ;
"RTN","ORWGTEST")
0^167^B8668416
"RTN","ORWGTEST",1,0)
ORWGTEST ; SLC/STAFF - Graph Test Cache ;5/2/07  09:22
"RTN","ORWGTEST",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORWGTEST",3,0)
 ;
"RTN","ORWGTEST",4,0)
TEST ;
"RTN","ORWGTEST",5,0)
 N DFN,TASKED
"RTN","ORWGTEST",6,0)
 ;D CLEAN^ORWGTASK
"RTN","ORWGTEST",7,0)
 ;D INIT^ORWGTASK(1)
"RTN","ORWGTEST",8,0)
 S ^XTMP("ORGDATA","TU",DUZ)=$$NOW^ORWGAPIX
"RTN","ORWGTEST",9,0)
 S DFN=40
"RTN","ORWGTEST",10,0)
 D UPDATE^ORWGTASK(.TASKED,DFN,DUZ,0)
"RTN","ORWGTEST",11,0)
 Q
"RTN","ORWGTEST",12,0)
 ;
"RTN","ORWGTEST",13,0)
TESTING(DATA) ; from ORWGAPI
"RTN","ORWGTEST",14,0)
 N CNT,DFN,LINE,SUB,TMP,USER
"RTN","ORWGTEST",15,0)
 K ^TMP("ORWGRPC",$J)
"RTN","ORWGTEST",16,0)
 D RETURN^ORWGAPIW(.TMP,.DATA)
"RTN","ORWGTEST",17,0)
 S CNT=0
"RTN","ORWGTEST",18,0)
 S SUB=""
"RTN","ORWGTEST",19,0)
 F  S SUB=$O(^XTMP("ORGDATA","Q",SUB)) Q:SUB=""  D
"RTN","ORWGTEST",20,0)
 . S LINE=^XTMP("ORGDATA","Q",SUB)
"RTN","ORWGTEST",21,0)
 . D SETUP^ORWGAPIW(.DATA,LINE,TMP,.CNT)
"RTN","ORWGTEST",22,0)
 S USER=""
"RTN","ORWGTEST",23,0)
 F  S USER=$O(^XTMP("ORGDATA","U",USER)) Q:USER=""  D
"RTN","ORWGTEST",24,0)
 . S LINE="u^"_USER
"RTN","ORWGTEST",25,0)
 . S LINE=LINE_U_+$G(^XTMP("ORGDATA","U",USER,"C"))
"RTN","ORWGTEST",26,0)
 . S LINE=LINE_U_+$G(^XTMP("ORGDATA","U",USER,"CG"))
"RTN","ORWGTEST",27,0)
 . D SETUP^ORWGAPIW(.DATA,LINE,TMP,.CNT)
"RTN","ORWGTEST",28,0)
 . S DFN=""
"RTN","ORWGTEST",29,0)
 . F  S DFN=$O(^XTMP("ORGDATA","U",USER,"C-P",DFN)) Q:DFN=""  D
"RTN","ORWGTEST",30,0)
 .. S LINE="u^"_USER_"^p^"_DFN
"RTN","ORWGTEST",31,0)
 .. S LINE=LINE_U_+$G(^XTMP("ORGDATA","U",USER,"C-P",DFN))
"RTN","ORWGTEST",32,0)
 .. S LINE=LINE_U_+$G(^XTMP("ORGDATA","U",USER,"CG-P",DFN))
"RTN","ORWGTEST",33,0)
 .. D SETUP^ORWGAPIW(.DATA,LINE,TMP,.CNT)
"RTN","ORWGTEST",34,0)
 S DFN=""
"RTN","ORWGTEST",35,0)
 F  S DFN=$O(^XTMP("ORGDATA","P",DFN)) Q:DFN=""  D
"RTN","ORWGTEST",36,0)
 . S LINE="p^"_DFN
"RTN","ORWGTEST",37,0)
 . S LINE=LINE_U_+$G(^XTMP("ORGDATA","P",DFN,"C"))
"RTN","ORWGTEST",38,0)
 . S LINE=LINE_U_+$G(^XTMP("ORGDATA","P",DFN,"CG"))
"RTN","ORWGTEST",39,0)
 . D SETUP^ORWGAPIW(.DATA,LINE,TMP,.CNT)
"RTN","ORWGTEST",40,0)
 . S USER=""
"RTN","ORWGTEST",41,0)
 . F  S USER=$O(^XTMP("ORGDATA","P",DFN,"C-P",USER)) Q:USER=""  D
"RTN","ORWGTEST",42,0)
 .. S LINE="p^"_DFN_"^u^"_USER
"RTN","ORWGTEST",43,0)
 .. S LINE=LINE_U_+$G(^XTMP("ORGDATA","P",DFN,"C-P",USER))
"RTN","ORWGTEST",44,0)
 .. S LINE=LINE_U_+$G(^XTMP("ORGDATA","P",DFN,"CG-P",USER))
"RTN","ORWGTEST",45,0)
 .. D SETUP^ORWGAPIW(.DATA,LINE,TMP,.CNT)
"RTN","ORWGTEST",46,0)
 S DFN=""
"RTN","ORWGTEST",47,0)
 F  S DFN=$O(^XTMP("ORGRAPH","LAST BUILD",DFN)) Q:DFN=""  D
"RTN","ORWGTEST",48,0)
 . S LINE="b^"_DFN_U_+$G(^XTMP("ORGRAPH","LAST BUILD",DFN))
"RTN","ORWGTEST",49,0)
 . D SETUP^ORWGAPIW(.DATA,LINE,TMP,.CNT)
"RTN","ORWGTEST",50,0)
 S DFN=""
"RTN","ORWGTEST",51,0)
 F  S DFN=$O(^XTMP("ORGRAPH","OLD DATA",DFN)) Q:DFN=""  D
"RTN","ORWGTEST",52,0)
 . S SUB=""
"RTN","ORWGTEST",53,0)
 . F  S SUB=$O(^XTMP("ORGRAPH","OLD DATA",DFN,SUB)) Q:SUB=""  D
"RTN","ORWGTEST",54,0)
 .. S LINE="d^"_DFN_U_SUB
"RTN","ORWGTEST",55,0)
 .. ;S LINE=LINE_U_$G(^XTMP("ORGRAPH","OLD DATA",DFN,SUB))
"RTN","ORWGTEST",56,0)
 .. S LINE=LINE_U_($L(LINE)+$L($G(^XTMP("ORGRAPH","OLD DATA",DFN,SUB))))
"RTN","ORWGTEST",57,0)
 .. D SETUP^ORWGAPIW(.DATA,LINE,TMP,.CNT)
"RTN","ORWGTEST",58,0)
 S DFN=""
"RTN","ORWGTEST",59,0)
 F  S DFN=$O(^XTMP("ORGRAPH","OLD LABS",DFN)) Q:DFN=""  D
"RTN","ORWGTEST",60,0)
 . S SUB=""
"RTN","ORWGTEST",61,0)
 . F  S SUB=$O(^XTMP("ORGRAPH","OLD LABS",DFN,SUB)) Q:SUB=""  D
"RTN","ORWGTEST",62,0)
 .. S LINE="l^"_DFN_U_SUB
"RTN","ORWGTEST",63,0)
 .. ;S LINE=LINE_U_$G(^XTMP("ORGRAPH","OLD LABS",DFN,SUB))
"RTN","ORWGTEST",64,0)
 .. S LINE=LINE_U_($L(LINE)+$L($G(^XTMP("ORGRAPH","OLD LABS",DFN,SUB))))
"RTN","ORWGTEST",65,0)
 .. D SETUP^ORWGAPIW(.DATA,LINE,TMP,.CNT)
"RTN","ORWGTEST",66,0)
 Q
"RTN","ORWNSS")
0^104^B4680257
"RTN","ORWNSS",1,0)
ORWNSS ;JDL/SLC Non-Standard Schedule ;11/24/06
"RTN","ORWNSS",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**195,243**;Dec 17, 1997;Build 242
"RTN","ORWNSS",3,0)
NSSOK(ORY,ORX) ;Check availability for Non-standard schedule
"RTN","ORWNSS",4,0)
 N VAL
"RTN","ORWNSS",5,0)
 S VAL=$$PATCH^XPDUTL("PSJ*5.0*113")
"RTN","ORWNSS",6,0)
 S ORY=VAL
"RTN","ORWNSS",7,0)
 Q
"RTN","ORWNSS",8,0)
NSSMSG(ORY) ;Retrieve site message for None-Standard Schedule
"RTN","ORWNSS",9,0)
 N ORSRV
"RTN","ORWNSS",10,0)
 S ORY=""
"RTN","ORWNSS",11,0)
 S ORSRV=$G(^VA(200,DUZ,5)) I +ORSRV>0 S ORSRV=$P(ORSRV,U)
"RTN","ORWNSS",12,0)
 S ORY=$$GET^XPAR("SRV.`"_+$G(ORSRV)_"^DIV^SYS","ORWIM NSS MESSAGE",1,"I")
"RTN","ORWNSS",13,0)
 Q
"RTN","ORWNSS",14,0)
VALSCH(ORY,ORID) ;Validate a schedule for IM order; 1: valid, 0: invalid
"RTN","ORWNSS",15,0)
 ;
"RTN","ORWNSS",16,0)
 S ORY=0
"RTN","ORWNSS",17,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","ORWNSS",18,0)
 N IPGRP,ORGRP
"RTN","ORWNSS",19,0)
 S IPGRP=$O(^ORD(100.98,"B","UD RX",0))
"RTN","ORWNSS",20,0)
 S ORGRP=$P($G(^OR(100,+ORID,0)),U,11)
"RTN","ORWNSS",21,0)
 I ORGRP'=IPGRP S ORY=1 Q
"RTN","ORWNSS",22,0)
 N SCH,IDX,SCHVAL S (SCH,SCHVAL)=""
"RTN","ORWNSS",23,0)
 I $D(^OR(100,+ORID,4.5,"ID","SCHEDULE")) S SCH=$O(^OR(100,+ORID,4.5,"ID","SCHEDULE",0))
"RTN","ORWNSS",24,0)
 I SCH="" S ORY=1 Q
"RTN","ORWNSS",25,0)
 S IDX=0 F  S IDX=$O(^OR(100,+ORID,4.5,SCH,IDX)) Q:'IDX  D
"RTN","ORWNSS",26,0)
 . S SCHVAL=$G(^OR(100,+ORID,4.5,SCH,IDX))
"RTN","ORWNSS",27,0)
 . Q:'$L(SCHVAL)
"RTN","ORWNSS",28,0)
 . D VALSCH^ORWDPS33(.ORY,SCHVAL,"I")
"RTN","ORWNSS",29,0)
 . I ORY=0 Q
"RTN","ORWNSS",30,0)
 Q
"RTN","ORWNSS",31,0)
QOSCH(ORY,QOID) ;Validate IM QO schedule
"RTN","ORWNSS",32,0)
 ;QOID: Inpt Pharmacy QO
"RTN","ORWNSS",33,0)
 S ORY=""
"RTN","ORWNSS",34,0)
 N QOSCH,SCHID,SCHVAL,RST
"RTN","ORWNSS",35,0)
 S SCHID=$O(^ORD(101.41,"B","OR GTX SCHEDULE",0))
"RTN","ORWNSS",36,0)
 S (QOSCH,SCHVAL)="",RST=1
"RTN","ORWNSS",37,0)
 I '$D(^ORD(101.41,+QOID,6,"D",SCHID)) S ORY="schedule is not defined." Q
"RTN","ORWNSS",38,0)
 S QOSCH=$O(^ORD(101.41,+QOID,6,"D",SCHID,0))
"RTN","ORWNSS",39,0)
 I 'QOSCH S ORY="schedule is not defined." Q
"RTN","ORWNSS",40,0)
 N IDX S IDX=0
"RTN","ORWNSS",41,0)
 F  S IDX=$O(^ORD(101.41,+QOID,6,QOSCH,IDX)) Q:'IDX!('RST)  D
"RTN","ORWNSS",42,0)
 . S SCHVAL=^ORD(101.41,+QOID,6,QOSCH,IDX)
"RTN","ORWNSS",43,0)
 . I $$UP^XLFSTR(SCHVAL)="OTHER" S ORY="OTHER" Q
"RTN","ORWNSS",44,0)
 . D VALSCH^ORWDPS33(.RST,SCHVAL,"I")
"RTN","ORWNSS",45,0)
 . I RST=0 S ORY="This quick order contains a non-standard administration schedule." Q
"RTN","ORWNSS",46,0)
 Q
"RTN","ORWNSS",47,0)
CHKSCH(ORY,SCH) ;Validate schedule
"RTN","ORWNSS",48,0)
 Q:SCH=""
"RTN","ORWNSS",49,0)
 D VALSCH^ORWDPS33(.ORY,SCH,"I")
"RTN","ORWNSS",50,0)
 Q
"RTN","ORWOD")
0^187^B64537880
"RTN","ORWOD",1,0)
ORWOD ; SLC/GSS - Utility for Order Dialogs ; 7/24/07 9:55am
"RTN","ORWOD",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;DEC 17, 1997;Build 242
"RTN","ORWOD",3,0)
 ;
"RTN","ORWOD",4,0)
 ; DBIA 5133: reading ^PXRMD file #801.41
"RTN","ORWOD",5,0)
 ; 
"RTN","ORWOD",6,0)
 Q
"RTN","ORWOD",7,0)
 ;
"RTN","ORWOD",8,0)
INSTALL ;Entry point for running as post-install in OR*3*243
"RTN","ORWOD",9,0)
 D MAIN
"RTN","ORWOD",10,0)
 Q
"RTN","ORWOD",11,0)
 ;
"RTN","ORWOD",12,0)
ATWILL ;Entry point for ORDER MENU MANAGEMENT menu - ORCM MGMT opt MR
"RTN","ORWOD",13,0)
 W !,"Compiling Med Quick Order check report..."
"RTN","ORWOD",14,0)
 D MAIN
"RTN","ORWOD",15,0)
 W !,"...QO check report compiled and mailed to ",$P(^VA(200,DUZ,0),U)
"RTN","ORWOD",16,0)
 Q
"RTN","ORWOD",17,0)
 ;
"RTN","ORWOD",18,0)
MAIN ;Main calls for QO Reports
"RTN","ORWOD",19,0)
 N ANCSTR,I,PSJNOPC,XMDUN,XMSUB
"RTN","ORWOD",20,0)
 D NTRY
"RTN","ORWOD",21,0)
 ; ANCSTR=ancestors, i.e., QO being used on a menu/Reminder Dialogs
"RTN","ORWOD",22,0)
 F ANCSTR="Y","N" D
"RTN","ORWOD",23,0)
 . D MAILSU
"RTN","ORWOD",24,0)
 . D SEND(XMSUB,DUZ)
"RTN","ORWOD",25,0)
 D CLEANUP
"RTN","ORWOD",26,0)
 Q
"RTN","ORWOD",27,0)
 ;
"RTN","ORWOD",28,0)
ANCSTR ;Determine QO usage - called by XSET and MM
"RTN","ORWOD",29,0)
 S ANCSTR="N"
"RTN","ORWOD",30,0)
 I $O(^ORD(101.41,"AD",ODIENXT,0))!($D(^TMP("OR",$J,"RD",ODIENXT))=0) S ANCSTR="Y"
"RTN","ORWOD",31,0)
 Q
"RTN","ORWOD",32,0)
 ;
"RTN","ORWOD",33,0)
XSET ;Set QO record for display
"RTN","ORWOD",34,0)
 D ANCSTR
"RTN","ORWOD",35,0)
 S RC=ODIENXT_U_$P(REC,U)_U_$P(REC,U,2)_U_$G(ODATYPE)_U_$G(ODAROUTE)_U_$G(ODASCHD)_U_$G(ODARATE)_U_$G(ODALIMIT)
"RTN","ORWOD",36,0)
 Q
"RTN","ORWOD",37,0)
 ;
"RTN","ORWOD",38,0)
NTRY ;Entry point for compiling report
"RTN","ORWOD",39,0)
 N AFIND,DIEN,DOSE,DSPLGRP,DSPLGPTR,GETXT,HIT,NODE3,ODALIMIT,ODARATE,ODAROUTE,ODASCHD,ODATYPE,ODIEN,ODIENXT,ORDIALOG,PTEXT,PTYPE,RC,REC,TYPE,XSET
"RTN","ORWOD",40,0)
 K ^TMP("OR",$J)
"RTN","ORWOD",41,0)
 S (DSPLGRP,DSPLGPTR,ODIEN,ODIENXT,TYPE)=""
"RTN","ORWOD",42,0)
 S XSET="S RC=ODIENXT_U_$P(REC,U)_U_$P(REC,U,2)_U_$G(ODATYPE)_U_$G(ODAROUTE)_U_$G(ODASCHD)_U_$G(ODARATE)_U_$G(ODALIMIT)"
"RTN","ORWOD",43,0)
 S DOSE=+$O(^ORD(101.41,"B","OR GTX INSTRUCTIONS",0))  ;use for MM tag
"RTN","ORWOD",44,0)
 ;
"RTN","ORWOD",45,0)
 ; Order Dialogs Structure, Menus - original code by Anthony Puleo
"RTN","ORWOD",46,0)
 ; Reminder Dialog Type: (PTYPE) E=Dialog Element, G=Dialog Group
"RTN","ORWOD",47,0)
 F PTYPE="G","E" S DIEN="" D
"RTN","ORWOD",48,0)
 . F  S DIEN=$O(^PXRMD(801.41,"TYPE",PTYPE,DIEN)) Q:DIEN'>0  D  ;DBIA 5133
"RTN","ORWOD",49,0)
 .. ; PTEXT is 'FINDING ITEM' where 101.41 refers to ^ORD(101.41)
"RTN","ORWOD",50,0)
 .. ; Example: ^PXRMD(801.41,2515,1)="^^3^^51;ORD(101.41,"
"RTN","ORWOD",51,0)
 .. S PTEXT=$P($G(^PXRMD(801.41,DIEN,1)),U,5),AFIND=""
"RTN","ORWOD",52,0)
 .. I PTEXT[101.41 S ^TMP("OR",$J,"RD",$P(PTEXT,";"))=DIEN
"RTN","ORWOD",53,0)
 .. F  S AFIND=$O(^PXRMD(801.41,DIEN,3,"B",AFIND)) Q:AFIND=""  D
"RTN","ORWOD",54,0)
 ... I AFIND[101.41 S ^TMP("OR",$J,"RD",$P(AFIND,";"))=DIEN
"RTN","ORWOD",55,0)
 ;
"RTN","ORWOD",56,0)
 ; find IEN for the 'PSJI OR PAT FLUID OE' entry in Order Dialog File
"RTN","ORWOD",57,0)
 S ODIEN=$O(^ORD(101.41,"AB","PSJI OR PAT FLUID OE",0))
"RTN","ORWOD",58,0)
 ; 
"RTN","ORWOD",59,0)
 ; loop through the Display Group File, file # 100.98 and store all
"RTN","ORWOD",60,0)
 ; Display Group entries that have a pointer to 'PSJI OR PAT FLUID OE'
"RTN","ORWOD",61,0)
 ; in field # 4 or Default Dialog field
"RTN","ORWOD",62,0)
 F  S DSPLGRP=$O(^ORD(100.98,DSPLGRP)) Q:DSPLGRP'?1N.N  D
"RTN","ORWOD",63,0)
 . I ODIEN=$P($G(^ORD(100.98,DSPLGRP,0)),U,4) S ^TMP("OR",$J,"DG",DSPLGRP)=ODIEN
"RTN","ORWOD",64,0)
 ;
"RTN","ORWOD",65,0)
 ; loop though Order Dialog file in order to
"RTN","ORWOD",66,0)
 ; find each entry that is an IV Quick Order. Do this by checking
"RTN","ORWOD",67,0)
 ; field #4 or TYPE field for a 'Q' and then check field #5 or
"RTN","ORWOD",68,0)
 ; DISPLAY GROUP field for a pointer to one of the display groups found
"RTN","ORWOD",69,0)
 ; above. If both conditions are true then continue to next step,
"RTN","ORWOD",70,0)
 ; if not, continue looping.
"RTN","ORWOD",71,0)
 F  S ODIENXT=$O(^ORD(101.41,ODIENXT)) Q:ODIENXT'?1N.N  D
"RTN","ORWOD",72,0)
 . D MM
"RTN","ORWOD",73,0)
 . S TYPE=$P($G(^ORD(101.41,ODIENXT,0)),U,4) Q:TYPE'="Q"
"RTN","ORWOD",74,0)
 . S DSPLGPTR=$P($G(^ORD(101.41,ODIENXT,0)),U,5) Q:$G(DSPLGPTR)=""  ;no display group pointer in QO
"RTN","ORWOD",75,0)
 . Q:'$G(^TMP("OR",$J,"DG",DSPLGPTR))  ;no such display group in compiled data
"RTN","ORWOD",76,0)
 . S REC=^ORD(101.41,ODIENXT,0)
"RTN","ORWOD",77,0)
 . ;
"RTN","ORWOD",78,0)
 . K ORDIALOG
"RTN","ORWOD",79,0)
 . ; call GETQDLG^ORCD to build the Order dialog array (ORDIALOG())
"RTN","ORWOD",80,0)
 . D GETQDLG^ORCD(ODIENXT) S (HIT)=0
"RTN","ORWOD",81,0)
 . ;
"RTN","ORWOD",82,0)
 . ;ZW ORDIALOG("B")  ;ORDIALOG() listing
"RTN","ORWOD",83,0)
 . ; set variables for 'TYPE' (IV TYPE), 'ROUTE', 'SCHEDULE', 'RATE', 'LIMITATION'
"RTN","ORWOD",84,0)
 . F I=1:1:5 S @($P("ODATYPE,ODAROUTE,ODASCHD,ODARATE,ODALIMIT",",",I))=$G(ORDIALOG($P($G(ORDIALOG("B",$P("TYPE,ROUTE,SCHEDULE,INFUSION RATE,LIMITATION",",",I))),U,2),1))
"RTN","ORWOD",85,0)
 . ;
"RTN","ORWOD",86,0)
 . ; Quick Orders to be displayed to end user in First List Message follow:
"RTN","ORWOD",87,0)
 . ;
"RTN","ORWOD",88,0)
 . ; IV TYPE is null or ROUTE is null
"RTN","ORWOD",89,0)
 . I (ODATYPE=""!(ODAROUTE="")) D XSET S ^TMP("OR",$J,"QO",ANCSTR,$P(REC,U),1,1,0)=RC,HIT=1
"RTN","ORWOD",90,0)
 . ;
"RTN","ORWOD",91,0)
 . ; IV TYPE is 'I' and SCHEDULE is null
"RTN","ORWOD",92,0)
 . I ODATYPE="I"&(ODASCHD="") D XSET S ^TMP("OR",$J,"QO",ANCSTR,$P(REC,U),2,1,0)=RC,HIT=1
"RTN","ORWOD",93,0)
 . ;
"RTN","ORWOD",94,0)
 . ; IV TYPE is not 'C' or null or RATE is not 1-4#.1#, integer or '@'
"RTN","ORWOD",95,0)
 . I ODATYPE="C"!(ODATYPE="") D
"RTN","ORWOD",96,0)
 .. Q:ODARATE["@"
"RTN","ORWOD",97,0)
 .. Q:ODARATE?1.4N!(ODARATE?1.4N1".".1N)  ;integers alone OK
"RTN","ORWOD",98,0)
 .. S GETXT=$$GETXT(ODARATE," ml/hr")
"RTN","ORWOD",99,0)
 .. Q:GETXT?1.4N!(GETXT?1.4N1".".1N)  ;# ml/hr & #.# ml/hr Rate OK
"RTN","ORWOD",100,0)
 .. D XSET S ^TMP("OR",$J,"QO",ANCSTR,$P(REC,U),3,1,0)=RC,HIT=1
"RTN","ORWOD",101,0)
 . ;
"RTN","ORWOD",102,0)
 . ; IV TYPE is 'I' but RATE not an integer minute or hour or null
"RTN","ORWOD",103,0)
 . I ODATYPE="I"&(ODARATE'?1.N)&(ODARATE'="") D  ;integer alone OK
"RTN","ORWOD",104,0)
 .. S GETXT=$$GETXT(ODARATE," Minutes| Hours")
"RTN","ORWOD",105,0)
 .. Q:GETXT?1.3N  ;integer # Minutes & # Hours Rate OK
"RTN","ORWOD",106,0)
 .. D XSET S ^TMP("OR",$J,"QO",ANCSTR,$P(REC,U),4,1,0)=RC,HIT=1
"RTN","ORWOD",107,0)
 . ;
"RTN","ORWOD",108,0)
 . ; IV LIMIT or Duration (LIMITATION) was not integer or null
"RTN","ORWOD",109,0)
 . I ODALIMIT'?.N,ODALIMIT'="" D
"RTN","ORWOD",110,0)
 .. Q:ODALIMIT?1.2N1"D"!(ODALIMIT?1.3N1"H")!(ODALIMIT?1.4N1"ML")!(ODALIMIT?1.4N1" ML")!(ODALIMIT?1.2N1"L")!(ODALIMIT?1.4N1"CC")!(ODALIMIT?1.4N1" CC")  ;#D, #H, #ML, #L, #CC Limit OK
"RTN","ORWOD",111,0)
 .. Q:ODALIMIT?1.2N1"d"!(ODALIMIT?1.3N1"h")!(ODALIMIT?1.4N1"ml")!(ODALIMIT?1.4n1" ml")!(ODALIMIT?1.2N1"l")!(ODALIMIT?1.4N1"cc")!(ODALIMIT?1.4N1" cc")  ;#d, #h, #ml, #l, #cc Limit OK
"RTN","ORWOD",112,0)
 .. Q:ODALIMIT?1"for "1.2N1" days"  ;for # days OK
"RTN","ORWOD",113,0)
 .. Q:ODALIMIT?1.5N1"DOSES"!(ODALIMIT?1"for a total of "1.5N1" doses")  ;for a total of # doses OK
"RTN","ORWOD",114,0)
 .. Q:ODALIMIT?1"with total volume "1.2N1"L"!(ODALIMIT?1"with total volume "1.4N1"ml")
"RTN","ORWOD",115,0)
 .. Q:ODALIMIT?1"for "1.2N1" hours"
"RTN","ORWOD",116,0)
 .. D XSET S ^TMP("OR",$J,"QO",ANCSTR,$P(REC,U),5,1,0)=RC,HIT=1
"RTN","ORWOD",117,0)
 . ;
"RTN","ORWOD",118,0)
 . ; Go get next Order Dialog entry if no potential problems
"RTN","ORWOD",119,0)
 . I 'HIT Q
"RTN","ORWOD",120,0)
 . ;
"RTN","ORWOD",121,0)
 . ; If the Quick Order is in First List message then check
"RTN","ORWOD",122,0)
 . ; the Order Dialog file #101.41, field #58 or AUTO-ACCEPT QUICK ORDER
"RTN","ORWOD",123,0)
 . ; field.  If field #58 is set to 'Y'es then set the field to 'N'o and
"RTN","ORWOD",124,0)
 . ; then display this Quick Order in the Second List.
"RTN","ORWOD",125,0)
 . I +$P($G(^ORD(101.41,ODIENXT,5)),U,8) D
"RTN","ORWOD",126,0)
 .. S $P(^ORD(101.41,ODIENXT,5),U,8)=""  ;uncommented, sets AUTO-ACCEPT QUICK ORDER field
"RTN","ORWOD",127,0)
 .. D XSET S ^TMP("OR",$J,"QO",ANCSTR,$P(REC,U),7,1,0)=RC
"RTN","ORWOD",128,0)
 Q
"RTN","ORWOD",129,0)
 ;
"RTN","ORWOD",130,0)
GETXT(LOOKIN,SUFFIX) ;Return text occuring prior to suffix
"RTN","ORWOD",131,0)
 ; e.g. LOOKIN="INFUSE OVER 30 MINUTES",SUFFIX=" MINUTES" returns '30'
"RTN","ORWOD",132,0)
 N I,ISUFFIX,RSTRG,RTXT,STRG
"RTN","ORWOD",133,0)
 S I=0,RTXT=""
"RTN","ORWOD",134,0)
 F  S I=I+1,ISUFFIX=$P(SUFFIX,"|",I) Q:ISUFFIX=""  D:$F(LOOKIN,ISUFFIX)  Q:$G(RTXT)'=""
"RTN","ORWOD",135,0)
 . S RSTRG=$RE($E(LOOKIN,1,$F(LOOKIN,ISUFFIX)-$L(ISUFFIX)-1))
"RTN","ORWOD",136,0)
 . S RTXT=$P(RSTRG," ")
"RTN","ORWOD",137,0)
 Q $RE(RTXT)
"RTN","ORWOD",138,0)
 ;
"RTN","ORWOD",139,0)
MM ;Looks for 'MM' in Order Dialog / original code logic by James Hartin
"RTN","ORWOD",140,0)
 N ANCSTR,MMREC,NEXT,NODE3,PROMPT,VALUE
"RTN","ORWOD",141,0)
 S NEXT=1,VALUE=""
"RTN","ORWOD",142,0)
 F  S NEXT=$O(^ORD(101.41,ODIENXT,6,NEXT))  Q:NEXT'?1N.N  D
"RTN","ORWOD",143,0)
 . S VALUE=$G(^ORD(101.41,ODIENXT,6,NEXT,1)),PROMPT=+$P($G(^(0)),U,2)
"RTN","ORWOD",144,0)
 . S MMREC=^ORD(101.41,ODIENXT,0)
"RTN","ORWOD",145,0)
 . ; ODIEN^NAME^DISPLAY TEXT^VALUE
"RTN","ORWOD",146,0)
 . I PROMPT=DOSE,(VALUE["MM ") D
"RTN","ORWOD",147,0)
 .. D ANCSTR
"RTN","ORWOD",148,0)
 .. S ^TMP("OR",$J,"QO",ANCSTR,$P(MMREC,U),6,1,0)=ODIENXT_U_$P(MMREC,U)_U_$P(MMREC,U,2)_U_VALUE
"RTN","ORWOD",149,0)
 Q
"RTN","ORWOD",150,0)
 ;
"RTN","ORWOD",151,0)
MAILSU ;Set-up MAILMAN variables and format ^TMP("OR",$J,"MAIL")
"RTN","ORWOD",152,0)
 N DASH,DISPNAME,HDRLINE,LEGEND,LEGENDS,NEXT,NUM,NXTLINE,ODIENXT,ODQONAME,ORLEGEND,OROUT,QONAM,QOTOT,QORECORD,SPC
"RTN","ORWOD",153,0)
 K ^TMP("OR",$J,"MAIL")
"RTN","ORWOD",154,0)
 ;
"RTN","ORWOD",155,0)
 ;Title of emails
"RTN","ORWOD",156,0)
 S:ANCSTR="Y" XMSUB="MED QUICK ORDERS W/ ANCESTORS: "
"RTN","ORWOD",157,0)
 S:ANCSTR="N" XMSUB="MED QUICK ORDERS W/O ANCESTORS: "
"RTN","ORWOD",158,0)
 S XMSUB=XMSUB_$$HTE^XLFDT($H)
"RTN","ORWOD",159,0)
 ;
"RTN","ORWOD",160,0)
 ;Group 1/A="IV TYPE IS NULL OR ROUTE IS NULL"
"RTN","ORWOD",161,0)
 ;Group 2/B="IV TYPE IS 'I' AND SCHEDULE IS NULL"
"RTN","ORWOD",162,0)
 ;Group 3/C="IV TYPE IS NOT 'C' OR NULL OR RATE IS NOT 1-4#.1#, INTERGER OR '@'"
"RTN","ORWOD",163,0)
 ;Group 4/D="IV TYPE IS 'I' BUT RATE NOT AN INTEGER MINUTE OR HOUR"
"RTN","ORWOD",164,0)
 ;Group 5/E="IV LIMIT OR DURATION (LIMITATION) WAS NOT NULL OR INTEGER"
"RTN","ORWOD",165,0)
 ;Group 6/F="ORDER DIALOGS WITH 'MM' IN THE DISPLAY TEXT"
"RTN","ORWOD",166,0)
 ;Group 7/G="AUTO-ACCEPT QUICK ORDER WAS 'Y'es, NOW SET TO 'N'o"
"RTN","ORWOD",167,0)
 ;
"RTN","ORWOD",168,0)
 D NTRY^ORWOD1
"RTN","ORWOD",169,0)
 S ODQONAME="@",SPC="                            ",QOTOT=0
"RTN","ORWOD",170,0)
 F  S ODQONAME=$O(^TMP("OR",$J,"QO",ANCSTR,ODQONAME)) Q:ODQONAME=""  D
"RTN","ORWOD",171,0)
 . S (LEGENDS,ORLEGEND,QORECORD)=""
"RTN","ORWOD",172,0)
 . F  S ORLEGEND=$O(^TMP("OR",$J,"QO",ANCSTR,ODQONAME,ORLEGEND)) D  Q:ORLEGEND=""
"RTN","ORWOD",173,0)
 .. I ORLEGEND'="" S LEGENDS=LEGENDS_$C(ORLEGEND+64) S:$G(QORECORD)="" QORECORD=^TMP("OR",$J,"QO",ANCSTR,ODQONAME,ORLEGEND,1,0) Q
"RTN","ORWOD",174,0)
 .. S NXTLINE=NXTLINE+1,QONAM=$P(QORECORD,U,2),DISPNAME=$P(QORECORD,U,3) S:DISPNAME="" DISPNAME=SPC
"RTN","ORWOD",175,0)
 .. S OROUT=$J($P(QORECORD,U,1),5)_" "_$E(QONAM,1,30)_$E(SPC,1,30-$L(QONAM))_" "_$E(DISPNAME,1,30)_$E(SPC,1,30-$L(DISPNAME))_" "_$J(LEGENDS,6)
"RTN","ORWOD",176,0)
 .. S ^TMP("OR",$J,"MAIL",NXTLINE,0)=OROUT,QOTOT=QOTOT+1
"RTN","ORWOD",177,0)
 S NXTLINE=NXTLINE+1,^TMP("OR",$J,"MAIL",NXTLINE,0)=""
"RTN","ORWOD",178,0)
 S NXTLINE=NXTLINE+1,^TMP("OR",$J,"MAIL",NXTLINE,0)=QOTOT_" = Med Quick Orders"
"RTN","ORWOD",179,0)
 Q
"RTN","ORWOD",180,0)
 ;
"RTN","ORWOD",181,0)
SEND(XMSUB,USER) ;Send a MailMan message to USER
"RTN","ORWOD",182,0)
 ; The text of the message is located in ^TMP("OR",$J,"MAIL",LineNumbers0-n)
"RTN","ORWOD",183,0)
 ; The subject is the string XMSUB.
"RTN","ORWOD",184,0)
 N MGIEN,MGROUP,NL,REF,XMDUZ,XMY,XMZ
"RTN","ORWOD",185,0)
 ;
"RTN","ORWOD",186,0)
 ;Make sure the subject does not exceed 64 characters.
"RTN","ORWOD",187,0)
 S XMSUB=$E(XMSUB,1,64)
"RTN","ORWOD",188,0)
 ;Make the sender the Postmaster.
"RTN","ORWOD",189,0)
 S XMDUZ=0.5
"RTN","ORWOD",190,0)
 ;
"RTN","ORWOD",191,0)
RETRY ;Get the message number.
"RTN","ORWOD",192,0)
 D XMZ^XMA2
"RTN","ORWOD",193,0)
 I XMZ<1 G RETRY
"RTN","ORWOD",194,0)
 ;
"RTN","ORWOD",195,0)
 ;Load the message
"RTN","ORWOD",196,0)
 M ^XMB(3.9,XMZ,2)=^TMP("OR",$J,"MAIL")
"RTN","ORWOD",197,0)
 S NL=$O(^XMB(3.9,XMZ,2,""),-1)
"RTN","ORWOD",198,0)
 S ^XMB(3.9,XMZ,2,0)="^3.92^"_+NL_U_+NL_U_DT
"RTN","ORWOD",199,0)
 ;
"RTN","ORWOD",200,0)
 ;Send message to USER
"RTN","ORWOD",201,0)
 I $G(USER)'="" S XMY(DUZ)="" D ENT1^XMD Q
"RTN","ORWOD",202,0)
 W !,"Error: No USER defined..message not sent!"
"RTN","ORWOD",203,0)
 Q
"RTN","ORWOD",204,0)
 ;
"RTN","ORWOD",205,0)
CLEANUP ; Clean-up
"RTN","ORWOD",206,0)
 K ^TMP("OR",$J)
"RTN","ORWOD",207,0)
 Q
"RTN","ORWOD1")
0^212^B30304637
"RTN","ORWOD1",1,0)
ORWOD1 ; SLC/GSS - Utility for Order Dialogs ; 11/07/07 11:28am
"RTN","ORWOD1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;DEC 17, 1997;Build 242
"RTN","ORWOD1",3,0)
 ;
"RTN","ORWOD1",4,0)
NTRY ;Entry point
"RTN","ORWOD1",5,0)
 N TXT
"RTN","ORWOD1",6,0)
 F NXTLINE=1:1 S TXT=$P($T(TXT+NXTLINE),";;",2) Q:TXT="Q"  S ^TMP("OR",$J,"MAIL",NXTLINE,0)=TXT
"RTN","ORWOD1",7,0)
 Q
"RTN","ORWOD1",8,0)
TXT ;Text for report follows
"RTN","ORWOD1",9,0)
 ;;         Quick Orders Which Should be Considered for Editing
"RTN","ORWOD1",10,0)
 ;;
"RTN","ORWOD1",11,0)
 ;;CPRS 27 has added three new fields (Route, IV Type, and Schedule) to the
"RTN","ORWOD1",12,0)
 ;;IV Order Dialog. For all IV orders the Route and IV Type must be defined.
"RTN","ORWOD1",13,0)
 ;;For Intermittent IV Type orders the schedule field must be defined. CPRS
"RTN","ORWOD1",14,0)
 ;;will not process the orders unless these fields are defined.
"RTN","ORWOD1",15,0)
 ;;
"RTN","ORWOD1",16,0)
 ;;The following table of Quick Orders (QO) should be edited to add the new
"RTN","ORWOD1",17,0)
 ;;field and data validation requirements implemented in CPRS GUI v27.  The
"RTN","ORWOD1",18,0)
 ;;Quick Orders are listed in alphabetical order by QO name and include the
"RTN","ORWOD1",19,0)
 ;;QO's IEN (internal reference number), display name, and Legend code.  The
"RTN","ORWOD1",20,0)
 ;;Legend code corresponds to a letter or letters in the Legend (see below.)
"RTN","ORWOD1",21,0)
 ;;You will need to evaluate each quick order and update it based on the
"RTN","ORWOD1",22,0)
 ;;Legend code(s).
"RTN","ORWOD1",23,0)
 ;;
"RTN","ORWOD1",24,0)
 ;;A Quick Order can be edited by using the "Enter/edit quick orders" option
"RTN","ORWOD1",25,0)
 ;;on the Order Menu Management menu in VistA (roll and scroll). At the
"RTN","ORWOD1",26,0)
 ;;prompt, "Select QUICK ORDER NAME:", enter the name of the Quick Order.
"RTN","ORWOD1",27,0)
 ;;The QO will then be displayed for your editing.  The "Enter/edit quick
"RTN","ORWOD1",28,0)
 ;;orders" option can also be used to edit a Personal Quick Order.
"RTN","ORWOD1",29,0)
 ;;
"RTN","ORWOD1",30,0)
 ;;QO Edit Hint:
"RTN","ORWOD1",31,0)
 ;;In addition to entering the QO name, users may also edit a Quick Order by
"RTN","ORWOD1",32,0)
 ;;entering the back tick (`) and the IEN at the "Select QUICK ORDER NAME:"
"RTN","ORWOD1",33,0)
 ;;prompt. For example, if the Quick Order name is PSI SICU CAM DOBUTAMINE 500
"RTN","ORWOD1",34,0)
 ;;MG and the IEN is 6200, a user may enter "`6200" at the "Select QUICK ORDER
"RTN","ORWOD1",35,0)
 ;;NAME:" prompt. This will the save time required to type the name of the Quick
"RTN","ORWOD1",36,0)
 ;;Order in at the "Select QUICK ORDER NAME:" prompt.
"RTN","ORWOD1",37,0)
 ;;
"RTN","ORWOD1",38,0)
 ;;Note: The term 'null', as used below, can be viewed as meaning 'not defined'.
"RTN","ORWOD1",39,0)
 ;;
"RTN","ORWOD1",40,0)
 ;;Legend:
"RTN","ORWOD1",41,0)
 ;;A...Problem: The IV type is null or the route is null.
"RTN","ORWOD1",42,0)
 ;;    Action:  Please edit the IV Type or route fields with the appropriate
"RTN","ORWOD1",43,0)
 ;;      information.
"RTN","ORWOD1",44,0)
 ;;B...Problem: The IV type is 'I' and the schedule is null.
"RTN","ORWOD1",45,0)
 ;;    Action:  For Intermittent IV Orders a schedule is needed to process the
"RTN","ORWOD1",46,0)
 ;;      order.  Enter a schedule which denotes the Intermittent IV dose.
"RTN","ORWOD1",47,0)
 ;;C...Problem: Continuous IV Type does not have a rate defined. When accepting
"RTN","ORWOD1",48,0)
 ;;      the order in CPRS, rate is required adn must be between 1 and 9999.9,
"RTN","ORWOD1",49,0)
 ;;      a whole number, or text that contains an '@'. Some continuous IV Type
"RTN","ORWOD1",50,0)
 ;;      Quick Orders may not include a rate to allow provider to define at
"RTN","ORWOD1",51,0)
 ;;      time of order.
"RTN","ORWOD1",52,0)
 ;;    Action:  Evaluate need for rate default and assign in Quick Order if
"RTN","ORWOD1",53,0)
 ;;      appropriate. The infusion rate must be a number up to four digits and
"RTN","ORWOD1",54,0)
 ;;      it will allow up to one decimel place. If IV Type is not defined in
"RTN","ORWOD1",55,0)
 ;;      the Quick Order, then an IV Type must be defined in the Quick Order
"RTN","ORWOD1",56,0)
 ;;      set-up.
"RTN","ORWOD1",57,0)
 ;;D...Problem:  The IV type is 'I' but the rate is not a whole number minute
"RTN","ORWOD1",58,0)
 ;;      or hour yet not null.
"RTN","ORWOD1",59,0)
 ;;    Action:  A valid "Infuse Over" value must be assigned to the Quick
"RTN","ORWOD1",60,0)
 ;;      Order. Using the Quick Order Editor, add an "Infuse Over" value in
"RTN","ORWOD1",61,0)
 ;;      the number of minutes (maximum of 9999).
"RTN","ORWOD1",62,0)
 ;;E...Problem:  The IV limit or duration (limitation) value was other than
"RTN","ORWOD1",63,0)
 ;;      null or a whole number.
"RTN","ORWOD1",64,0)
 ;;    Action:  This field is not required but if it exists, it must be a
"RTN","ORWOD1",65,0)
 ;;      whole number. To correct this, follow the Help Text for the Limitation
"RTN","ORWOD1",66,0)
 ;;      Prompt in the Quick Order editor for this Quick Order.
"RTN","ORWOD1",67,0)
 ;;F...Problem:  The Order Dialogs with 'MM' in the display text
"RTN","ORWOD1",68,0)
 ;;    Action:  MMOL (millimole) has been added as a unit of measure.  Please 
"RTN","ORWOD1",69,0)
 ;;      replace 'MM' with MMOL.
"RTN","ORWOD1",70,0)
 ;;G...Problem:  Auto Accept Quick Order which was 'Y'es and now set to 'N'o.
"RTN","ORWOD1",71,0)
 ;;    Action:  These Quick Orders were converted from an Auto Accept Quick
"RTN","ORWOD1",72,0)
 ;;      Order to a non-Auto Accept Quick because they have at least one
"RTN","ORWOD1",73,0)
 ;;      invalid field. Please correct the problems identified by the Legend
"RTN","ORWOD1",74,0)
 ;;      code(s) for the Quick Order before setting the Quick Order back to
"RTN","ORWOD1",75,0)
 ;;      an Auto-Accept Quick Order.
"RTN","ORWOD1",76,0)
 ;;
"RTN","ORWOD1",77,0)
 ;;Note: QO Names and QO Dislay Names over 30 characters are truncated at 30
"RTN","ORWOD1",78,0)
 ;;      characters.  If in doubt on the Name you can use the IEN to edit the
"RTN","ORWOD1",79,0)
 ;;      Quick Order (see above).
"RTN","ORWOD1",80,0)
 ;;
"RTN","ORWOD1",81,0)
 ;;                            -----------------------
"RTN","ORWOD1",82,0)
 ;;                            
"RTN","ORWOD1",83,0)
 ;;  IEN Name                           Display Name                   Legend
"RTN","ORWOD1",84,0)
 ;;===== ============================== ============================== ======
"RTN","ORWOD1",85,0)
 ;;Q
"RTN","ORWOR")
0^47^B35518390
"RTN","ORWOR",1,0)
ORWOR ; SLC/KCM - Orders Calls;10:54 PM  08/15/2006
"RTN","ORWOR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,132,141,163,187,190,215,243**;Dec 17, 1997;Build 242
"RTN","ORWOR",3,0)
 ;
"RTN","ORWOR",4,0)
CURRENT(LST,DFN) ; Get Current Orders for a Patient
"RTN","ORWOR",5,0)
 ; Returns two lists in ^TMP("ORW",$J), fields and text
"RTN","ORWOR",6,0)
 N TM,IEN,X,X0,X3,CTR,IDX,I
"RTN","ORWOR",7,0)
 K ^TMP("ORW",$J)
"RTN","ORWOR",8,0)
 S IDX=0,DFN=DFN_";DPT("
"RTN","ORWOR",9,0)
 S TM=0 F  S TM=$O(^OR(100,"AC",DFN,TM)) Q:TM<1  D
"RTN","ORWOR",10,0)
 . S IEN=0 F  S IEN=$O(^OR(100,"AC",DFN,TM,IEN)) Q:IEN<1  D
"RTN","ORWOR",11,0)
 . . S X0=^OR(100,IEN,0),X3=^(3)
"RTN","ORWOR",12,0)
 . . S X=IEN_U_$P(X0,U,7)_U_$P(X0,U,11)_U_$P(X3,U,6)_U_$P(X3,U,3)
"RTN","ORWOR",13,0)
 . . S ^TMP("ORW",$J,IDX+1)=X
"RTN","ORWOR",14,0)
 . . S (CTR,I)=0,X=""
"RTN","ORWOR",15,0)
 . . F  S I=$O(^OR(100,IEN,1,I)) Q:I<1  D  Q:CTR>244
"RTN","ORWOR",16,0)
 . . . S X=X_$E(^OR(100,IEN,1,I,0),1,(245-CTR)),CTR=$L(X)
"RTN","ORWOR",17,0)
 . . S ^TMP("ORW",$J,IDX+2)=X,IDX=IDX+2
"RTN","ORWOR",18,0)
 ; S LST=$NA(^TMP("ORW",$J))
"RTN","ORWOR",19,0)
 M LST=^TMP("ORW",$J)
"RTN","ORWOR",20,0)
 Q
"RTN","ORWOR",21,0)
DETAIL(LST,ORID,DFN)    ; Return details of ORID (shell to kill VIDEO subs)
"RTN","ORWOR",22,0)
 Q:'+ORID
"RTN","ORWOR",23,0)
 I $G(DFN) N ORVP S ORVP=DFN_";DPT("
"RTN","ORWOR",24,0)
 S LST="^TMP(""ORTXT"",$J)"
"RTN","ORWOR",25,0)
 D DETAIL^ORQ2(.LST,ORID)
"RTN","ORWOR",26,0)
 K @LST@("VIDEO")
"RTN","ORWOR",27,0)
 S LST=$NA(^TMP("ORTXT",$J)),@LST=""
"RTN","ORWOR",28,0)
 Q
"RTN","ORWOR",29,0)
RESULT(REF,DFN,ORID,ID)      ; Return results of order identified by ID
"RTN","ORWOR",30,0)
 K ^TMP("ORXPND",$J)
"RTN","ORWOR",31,0)
 N ORESULTS,ORVP,LCNT S ORESULTS=1,LCNT=0,ORVP=DFN_";DPT("
"RTN","ORWOR",32,0)
 D ORDERS^ORCXPND1
"RTN","ORWOR",33,0)
 K ^TMP("ORXPND",$J,"VIDEO")
"RTN","ORWOR",34,0)
 S REF=$NA(^TMP("ORXPND",$J))
"RTN","ORWOR",35,0)
 Q
"RTN","ORWOR",36,0)
RESHIST(REF,DFN,ORID,ID)      ; Return result history of associated tests identified by ID
"RTN","ORWOR",37,0)
 K ^TMP("ORXPND",$J)
"RTN","ORWOR",38,0)
 N ORESULTS,ORVP,LCNT
"RTN","ORWOR",39,0)
 S ORESULTS=1,LCNT=0,ORVP=DFN_";DPT("
"RTN","ORWOR",40,0)
 D ORDHIST^ORWOR2
"RTN","ORWOR",41,0)
 K ^TMP("ORXPND",$J,"VIDEO")
"RTN","ORWOR",42,0)
 S REF=$NA(^TMP("ORXPND",$J))
"RTN","ORWOR",43,0)
 Q
"RTN","ORWOR",44,0)
TSALL(LST)      ; Return list of treating specialties
"RTN","ORWOR",45,0)
 N Y S Y=0
"RTN","ORWOR",46,0)
 F  S Y=$O(^DIC(45.7,Y)) Q:'Y  I $$ACTIVE^DGACT(45.7,Y) S LST(Y)=Y_U_$P(^DIC(45.7,Y,0),U)
"RTN","ORWOR",47,0)
 Q
"RTN","ORWOR",48,0)
DT(X) ; -- Returns FM date for X (SEE ORCHTAB1)
"RTN","ORWOR",49,0)
 N Y,%DT S %DT="T",Y="" D:X'="" ^%DT
"RTN","ORWOR",50,0)
 Q +Y
"RTN","ORWOR",51,0)
VWSET(ORERR,VIEW)       ; Set the preferred view for orders
"RTN","ORWOR",52,0)
 ; VIEW:  semi-colon delimited record
"RTN","ORWOR",53,0)
 ;        1 - Relative From Date/Time or ""
"RTN","ORWOR",54,0)
 ;        2 - Relative Thru Date/Time or ""
"RTN","ORWOR",55,0)
 ;        3 - Filter
"RTN","ORWOR",56,0)
 ;        4 - Display Group Pointer
"RTN","ORWOR",57,0)
 ;        5 - Format (preserve for list manager)
"RTN","ORWOR",58,0)
 ;        6 - chronological display (R or F)
"RTN","ORWOR",59,0)
 ;        7 - sort by display group
"RTN","ORWOR",60,0)
 N FMT
"RTN","ORWOR",61,0)
 ; use short name for display group instead of pointer
"RTN","ORWOR",62,0)
 I $E($P(VIEW,";",2))="T" S $P(VIEW,";",2)=$P($P(VIEW,";",2),"@") ;allows all orders for Today
"RTN","ORWOR",63,0)
 S $P(VIEW,";",4)=$P($G(^ORD(100.98,+$P(VIEW,";",4),0)),U,3)
"RTN","ORWOR",64,0)
 ; use last saved format, since this is used only by LM
"RTN","ORWOR",65,0)
 S FMT=$P($$GET^XPAR("ALL","ORCH CONTEXT ORDERS",1,"I"),";",5)
"RTN","ORWOR",66,0)
 S:'$L(FMT) FMT="L" S $P(VIEW,";",5)=FMT
"RTN","ORWOR",67,0)
 ; and save the parameter
"RTN","ORWOR",68,0)
 D EN^XPAR(DUZ_";VA(200,","ORCH CONTEXT ORDERS",1,VIEW,.ORERR)
"RTN","ORWOR",69,0)
 Q
"RTN","ORWOR",70,0)
VWGET(REC)      ; Get the preferred view for orders
"RTN","ORWOR",71,0)
 N FROM,THRU,FILTER,DGRP,FRMT,CHRN,BYGRP,S,VNAME,FL
"RTN","ORWOR",72,0)
 S REC=$$GET^XPAR("ALL","ORCH CONTEXT ORDERS",1,"I"),S=";"
"RTN","ORWOR",73,0)
 S FROM=$$DT($P(REC,S)),THRU=$$DT($P(REC,S,2)),FILTER=$P(REC,S,3)
"RTN","ORWOR",74,0)
 S DGRP=$P(REC,S,4),FRMT=$P(REC,S,5),CHRN=$P(REC,S,6),BYGRP=$P(REC,S,7)
"RTN","ORWOR",75,0)
 S:'$L(DGRP) DGRP="ALL" S DGRP=+$O(^ORD(100.98,"B",DGRP,0))
"RTN","ORWOR",76,0)
 I FILTER="" S FILTER=2  ; active orders
"RTN","ORWOR",77,0)
 I CHRN="" S CHRN="R"    ; reverse chronological
"RTN","ORWOR",78,0)
 I BYGRP="" S BYGRP=1    ; sort by display group
"RTN","ORWOR",79,0)
 ; set up view name
"RTN","ORWOR",80,0)
 D REVSTS^ORWORDG(.FL)
"RTN","ORWOR",81,0)
 S I=0 F  S I=$O(FL(I)) Q:'I  Q:+FL(I)=FILTER
"RTN","ORWOR",82,0)
 S VNAME=$P($G(FL(+I)),U,2)
"RTN","ORWOR",83,0)
 I '("^6^8^9^10^19^20^"[(U_FILTER_U)) S VNAME=VNAME_" Orders"
"RTN","ORWOR",84,0)
 I FILTER=2 S VNAME="Active Orders (includes Pending & Recent Activity)"
"RTN","ORWOR",85,0)
 I FILTER=23 S VNAME="Current Orders (Active & Pending Status Only)"
"RTN","ORWOR",86,0)
 S VNAME=VNAME_" - "_$P($G(^ORD(100.98,DGRP,0)),U)
"RTN","ORWOR",87,0)
 I (FROM>0)!(THRU>0) D
"RTN","ORWOR",88,0)
 . S VNAME=VNAME_" ("_$$FMTE^XLFDT(FROM,"2D")_" thru "
"RTN","ORWOR",89,0)
 . S VNAME=VNAME_$S(THRU>0:$$FMTE^XLFDT(THRU,"2D"),1:"")_")"
"RTN","ORWOR",90,0)
 S REC=FROM_S_THRU_S_FILTER_S_DGRP_S_FRMT_S_CHRN_S_BYGRP_S_VNAME
"RTN","ORWOR",91,0)
 Q
"RTN","ORWOR",92,0)
SHEETS(LST,ORVP) ; Return Order Sheets for a patient
"RTN","ORWOR",93,0)
 N ELST,ETYP,ORIFN,TS,I
"RTN","ORWOR",94,0)
 S ORVP=ORVP_";DPT("
"RTN","ORWOR",95,0)
 S ETYP="" F  S ETYP=$O(^OR(100,"AEVNT",ORVP,ETYP)) Q:ETYP=""  D
"RTN","ORWOR",96,0)
 . S ORIFN=0 F  S ORIFN=$O(^OR(100,"AEVNT",ORVP,ETYP,ORIFN)) Q:'ORIFN  D
"RTN","ORWOR",97,0)
 . . I (ETYP="A")!(ETYP="T") S ELST(ETYP,$P($G(^OR(100,+ORIFN,0)),U,13))=""
"RTN","ORWOR",98,0)
 S LST(1)="C;O^Current View",I=1
"RTN","ORWOR",99,0)
 S TS="" F  S TS=$O(ELST("A",TS)) Q:TS=""  D
"RTN","ORWOR",100,0)
 . S I=I+1,LST(I)="A;"_TS_U_"Admit to "_$P($G(^DIC(45.7,TS,0)),U)
"RTN","ORWOR",101,0)
 S I=I+1,LST(I)="A;-1^Admit..."
"RTN","ORWOR",102,0)
 S TS="" F  S TS=$O(ELST("T",TS)) Q:TS=""  D
"RTN","ORWOR",103,0)
 . S I=I+1,LST(I)="T;"_TS_U_"Transfer to "_$P($G(^DIC(45.7,TS,0)),U)
"RTN","ORWOR",104,0)
 I $L($G(^DPT(+ORVP,.1))) D
"RTN","ORWOR",105,0)
 . S I=I+1,LST(I)="T;-1^Transfer..."
"RTN","ORWOR",106,0)
 . S I=I+1,LST(I)="D;0^Discharge"
"RTN","ORWOR",107,0)
 Q
"RTN","ORWOR",108,0)
EVENTS(LST,EVT) ; Return general delayed events categories for a patient
"RTN","ORWOR",109,0)
 N EVTI
"RTN","ORWOR",110,0)
 S EVTI=0
"RTN","ORWOR",111,0)
 S EVTI=EVTI+1,LST(EVTI)="A;-1^Admit..."
"RTN","ORWOR",112,0)
 S EVTI=EVTI+1,LST(EVTI)="T;-1^Transfer..."
"RTN","ORWOR",113,0)
 S EVTI=EVTI+1,LST(EVTI)="D;0^Discharge"
"RTN","ORWOR",114,0)
 Q
"RTN","ORWOR",115,0)
UNSIGN(LST,ORVP,HAVE)   ; Return Unsigned Orders that are not on client
"RTN","ORWOR",116,0)
 N IFN,ACT,X8,ENT,LVL,TM,ILST S ILST=0
"RTN","ORWOR",117,0)
 Q:'$D(^XUSEC("ORES",DUZ))
"RTN","ORWOR",118,0)
 S ORVP=ORVP_";DPT("
"RTN","ORWOR",119,0)
 S ENT="ALL"_$S($G(^VA(200,DUZ,5)):"^SRV.`"_+^(5),1:"")
"RTN","ORWOR",120,0)
 S LVL=$$GET^XPAR(ENT,"OR UNSIGNED ORDERS ON EXIT")
"RTN","ORWOR",121,0)
 Q:'LVL
"RTN","ORWOR",122,0)
 S TM=0 F  S TM=$O(^OR(100,"AS",ORVP,TM)) Q:TM<1  D
"RTN","ORWOR",123,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AS",ORVP,TM,IFN)) Q:IFN<1  D
"RTN","ORWOR",124,0)
 . . S ACT=0 F  S ACT=$O(^OR(100,"AS",ORVP,TM,IFN,ACT)) Q:ACT<1  D
"RTN","ORWOR",125,0)
 . . . Q:$D(HAVE(IFN_";"_ACT))                        ;in Changes
"RTN","ORWOR",126,0)
 . . . S X8=$G(^OR(100,IFN,8,ACT,0))
"RTN","ORWOR",127,0)
 . . . I '$S(LVL=1&($P(X8,U,3)=DUZ):1,LVL=2:1,1:0) Q  ;chk user
"RTN","ORWOR",128,0)
 . . . S ILST=ILST+1,LST(ILST)=IFN_";"_ACT_U_$P(X8,U,3)
"RTN","ORWOR",129,0)
 Q
"RTN","ORWOR",130,0)
PKIUSE(RETURN) ; RPC determines user can use PKI Digital Signature
"RTN","ORWOR",131,0)
 S RETURN=0
"RTN","ORWOR",132,0)
 I $$GET^XPAR("ALL^USR.`"_DUZ,"ORWOR PKI USE",1,"Q") S RETURN=1
"RTN","ORWOR",133,0)
 Q
"RTN","ORWOR",134,0)
PKISITE(RETURN) ; RPC determines if PKI is turned on at the site
"RTN","ORWOR",135,0)
 S RETURN=0
"RTN","ORWOR",136,0)
 Q:'$L($T(STORESIG^XUSSPKI))  ;Check for Kernel piece
"RTN","ORWOR",137,0)
 Q:'$L($T(DOSE^PSSOPKI1))  ;Check for Pharmacy piece
"RTN","ORWOR",138,0)
 I $$GET^XPAR("ALL","ORWOR PKI SITE",1,"Q") S RETURN=1
"RTN","ORWOR",139,0)
 Q
"RTN","ORWOR",140,0)
ACTXT(ORY,ORIFN) ;Return detail action information
"RTN","ORWOR",141,0)
 N ORI,CNT,OR0,OR3,OR6
"RTN","ORWOR",142,0)
 K ^TMP("ORACTXT",$J)
"RTN","ORWOR",143,0)
 S ORY="^TMP(""ORACTXT"",$J)",ORI=$P(ORIFN,";",2)
"RTN","ORWOR",144,0)
 S CNT=0,ORIFN=+ORIFN,OR0=$G(^OR(100,ORIFN,0)),OR3=$G(^(3)),OR6=$G(^(6))
"RTN","ORWOR",145,0)
 F  S ORI=$O(^OR(100,+ORIFN,8,ORI)) Q:ORI'>0  S ACTION=$G(^(ORI,0)) D ACT^ORQ20
"RTN","ORWOR",146,0)
 S ORY=$NA(^TMP("ORACTXT",$J)),@ORY=""
"RTN","ORWOR",147,0)
 Q
"RTN","ORWOR",148,0)
EXPIRED(ORY) ;return FM date/time to begin search for expired orders
"RTN","ORWOR",149,0)
 N HRS
"RTN","ORWOR",150,0)
 S HRS=$$GET^XPAR("ALL","ORWOR EXPIRED ORDERS",1,"I")
"RTN","ORWOR",151,0)
 S ORY=$$FMADD^XLFDT($$NOW^XLFDT,"","-"_HRS,"","")
"RTN","ORWOR",152,0)
 Q
"RTN","ORWORB")
0^146^B67054061
"RTN","ORWORB",1,0)
ORWORB ; slc/dee/REV/CLA - RPC functions which return user alert ;10:12 am JAN 31, 2001
"RTN","ORWORB",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,116,148,173,190,215,243**;Dec 17, 1997;Build 242
"RTN","ORWORB",3,0)
 ;
"RTN","ORWORB",4,0)
URGENLST(ORY) ;return array of the  urgency for the notification
"RTN","ORWORB",5,0)
 N ORSRV,ORERROR
"RTN","ORWORB",6,0)
 S ORSRV=$G(^VA(200,DUZ,5)) I +ORSRV>0 S ORSRV=$P(ORSRV,U)
"RTN","ORWORB",7,0)
 D GETLST^XPAR(.ORY,"USR^SRV.`"_$G(ORSRV)_"^DIV^SYS^PKG","ORB URGENCY","I",.ORERROR)
"RTN","ORWORB",8,0)
 Q
"RTN","ORWORB",9,0)
 ;
"RTN","ORWORB",10,0)
FASTUSER(ORY) ;return current user's notifications across all patients
"RTN","ORWORB",11,0)
 N STRTDATE,STOPDATE,ORTOT,I,ORURG,URG,ORN,SORT,ORN0,URGLIST,REMLIST,REM,NONORLST,NONOR
"RTN","ORWORB",12,0)
 N ALRT,ALRTDT,ALRTPT,ALRTMSG,ALRTI,ALRTLOC,ALRTXQA,J,FWDBY,PRE,ALRTDFN
"RTN","ORWORB",13,0)
 K ^TMP("ORBG",$J)
"RTN","ORWORB",14,0)
 S STRTDATE="",STOPDATE="",FWDBY="Forwarded by: "
"RTN","ORWORB",15,0)
 D GETUSER1^XQALDATA("^TMP(""ORB"",$J)",DUZ,STRTDATE,STOPDATE)
"RTN","ORWORB",16,0)
 S ORTOT=^TMP("ORB",$J)
"RTN","ORWORB",17,0)
 D URGLIST^ORQORB(.URGLIST)
"RTN","ORWORB",18,0)
 D REMLIST^ORQORB(.REMLIST)
"RTN","ORWORB",19,0)
 D REMNONOR^ORQORB(.NONORLST)
"RTN","ORWORB",20,0)
 S J=0
"RTN","ORWORB",21,0)
 F I=1:1:ORTOT D
"RTN","ORWORB",22,0)
 .S ALRTDFN=""
"RTN","ORWORB",23,0)
 .S ALRT=^TMP("ORB",$J,I)
"RTN","ORWORB",24,0)
 .S PRE=$E(ALRT,1,1)
"RTN","ORWORB",25,0)
 .S ALRTXQA=$P(ALRT,U,2)  ;XQAID
"RTN","ORWORB",26,0)
 .S NONOR="" F  S NONOR=$O(NONORLST(NONOR)) Q:NONOR=""  D
"RTN","ORWORB",27,0)
 ..I ALRTXQA[NONOR S REM=1  ;allow this type of alert to be Removed
"RTN","ORWORB",28,0)
 .S ALRTMSG=$P($P(ALRT,U),PRE_"  ",2)
"RTN","ORWORB",29,0)
 .I $E(ALRT,4,8)'="-----" D  ;not forwarded alert info/comment
"RTN","ORWORB",30,0)
 ..S ORURG="n/a"
"RTN","ORWORB",31,0)
 ..S ALRTI=$P(ALRT,"  ")
"RTN","ORWORB",32,0)
 ..S ALRTPT=""
"RTN","ORWORB",33,0)
 ..S ALRTLOC=""
"RTN","ORWORB",34,0)
 ..I $E($P(ALRTXQA,";"),1,3)="TIU" S ORURG="Moderate"
"RTN","ORWORB",35,0)
 ..I $P(ALRTXQA,",")="OR" D
"RTN","ORWORB",36,0)
 ...S ORN=$P($P(ALRTXQA,";"),",",3)
"RTN","ORWORB",37,0)
 ...S URG=$G(URGLIST(ORN))
"RTN","ORWORB",38,0)
 ...S ORURG=$S(URG=1:"HIGH",URG=2:"Moderate",1:"low")
"RTN","ORWORB",39,0)
 ...S REM=$G(REMLIST(ORN))
"RTN","ORWORB",40,0)
 ...S ORN0=^ORD(100.9,ORN,0)
"RTN","ORWORB",41,0)
 ...S ALRTI=$S($P(ORN0,U,6)="INFODEL":"I",1:"")
"RTN","ORWORB",42,0)
 ...S ALRTDFN=$P(ALRTXQA,",",2)
"RTN","ORWORB",43,0)
 ...S ALRTLOC=$G(^DPT(+$G(ALRTDFN),.1))
"RTN","ORWORB",44,0)
 ..S ALRTI=$S(ALRTI="I":"I",1:"")
"RTN","ORWORB",45,0)
 ..I ALRT["): " D
"RTN","ORWORB",46,0)
 ...S ALRTPT=$P(ALRT,": ")
"RTN","ORWORB",47,0)
 ...S ALRTPT=$E(ALRTPT,4,$L(ALRTPT))
"RTN","ORWORB",48,0)
 ...S ALRTMSG=$P($P(ALRT,U),"): ",2)
"RTN","ORWORB",49,0)
 ...I $E(ALRTMSG,1,1)="[" D
"RTN","ORWORB",50,0)
 ....S:'$L(ALRTLOC) ALRTLOC=$P($P(ALRTMSG,"]"),"[",2)
"RTN","ORWORB",51,0)
 ....S ALRTMSG=$P(ALRTMSG,"] ",2)
"RTN","ORWORB",52,0)
 ..I '$L($G(ALRTPT)) S ALRTPT="no patient"
"RTN","ORWORB",53,0)
 ..S ALRTDT=$P(ALRTXQA,";",3)
"RTN","ORWORB",54,0)
 ..S ALRTDT=$P(ALRTDT,".")_"."_$E($P(ALRTDT,".",2)_"0000",1,4)
"RTN","ORWORB",55,0)
 ..S ALRTDT=$E(ALRTDT,4,5)_"/"_$E(ALRTDT,6,7)_"/"_($E(ALRTDT,1,3)+1700)_"@"_$E($P(ALRTDT,".",2),1,2)_":"_$E($P(ALRTDT,".",2),3,4)
"RTN","ORWORB",56,0)
 ..;S ALRTDT=($E(ALRTDT,1,3)+1700)_"/"_$E(ALRTDT,4,5)_"/"_$E(ALRTDT,6,7)_"@"_$E($P(ALRTDT,".",2),1,2)_":"_$E($P(ALRTDT,".",2),3,4)
"RTN","ORWORB",57,0)
 ..S J=J+1,^TMP("ORBG",$J,J)=ALRTI_U_ALRTPT_U_ALRTLOC_U_ORURG_U_ALRTDT_U
"RTN","ORWORB",58,0)
 ..S ^TMP("ORBG",$J,J)=^TMP("ORBG",$J,J)_ALRTMSG_U_U_ALRTXQA_U_$G(REM)_U
"RTN","ORWORB",59,0)
 .;
"RTN","ORWORB",60,0)
 .;if alert forward info/comment:
"RTN","ORWORB",61,0)
 .I $E(ALRTMSG,1,5)="-----" D
"RTN","ORWORB",62,0)
 ..S ALRTMSG=$P(ALRTMSG,"-----",2)
"RTN","ORWORB",63,0)
 ..I $E(ALRTMSG,1,14)=FWDBY D
"RTN","ORWORB",64,0)
 ...S J=J+1,^TMP("ORBG",$J,J)=FWDBY_U_$P($P(ALRTMSG,FWDBY,2),"Generated: ")_$P($P(ALRTMSG,FWDBY,2),"Generated: ",2)
"RTN","ORWORB",65,0)
 ..E  S ^TMP("ORBG",$J,J)=^TMP("ORBG",$J,J)_U_""""_ALRTMSG_""""
"RTN","ORWORB",66,0)
 S ^TMP("ORBG",$J)=""
"RTN","ORWORB",67,0)
 S ORY=$NA(^TMP("ORBG",$J))
"RTN","ORWORB",68,0)
 Q
"RTN","ORWORB",69,0)
 ;
"RTN","ORWORB",70,0)
GETDATA(ORY,XQAID) ; return XQADATA for an alert
"RTN","ORWORB",71,0)
 N SHOWADD
"RTN","ORWORB",72,0)
 S ORY=""
"RTN","ORWORB",73,0)
 Q:$G(XQAID)=""!('$D(^XTV(8992,"AXQA",XQAID)))
"RTN","ORWORB",74,0)
 D GETACT^XQALERT(XQAID)
"RTN","ORWORB",75,0)
 S ORY=XQADATA
"RTN","ORWORB",76,0)
 I ($E(XQAID,1,3)="TIU"),(+ORY>0) D
"RTN","ORWORB",77,0)
 . S SHOWADD=1
"RTN","ORWORB",78,0)
 . S ORY=ORY_$$RESOLVE^TIUSRVLO(+ORY)
"RTN","ORWORB",79,0)
 K XQAID,XQADATA,XQAOPT,XQAROU
"RTN","ORWORB",80,0)
 Q
"RTN","ORWORB",81,0)
 ;
"RTN","ORWORB",82,0)
KILUNSNO(Y,ORVP) ; Delete unsigned order alerts if no unsigned orders remaining
"RTN","ORWORB",83,0)
 S ORVP=ORVP_";DPT("
"RTN","ORWORB",84,0)
 D UNOTIF^ORCSIGN
"RTN","ORWORB",85,0)
 Q
"RTN","ORWORB",86,0)
 ;
"RTN","ORWORB",87,0)
UNFLORD(ORY,DFN,XQAID) ; -- auto-unflag orders?/delete alert
"RTN","ORWORB",88,0)
 Q:'$L(DFN)!('$L(XQAID))
"RTN","ORWORB",89,0)
 N ORI,ORIFN,ORA,XQAKILL,ORN,ORBY,ORAUTO,ORUNF
"RTN","ORWORB",90,0)
 S ORN=+$O(^ORD(100.9,"B","FLAGGED ORDERS",0))
"RTN","ORWORB",91,0)
 S XQAKILL=$$XQAKILL^ORB3F1(ORN)
"RTN","ORWORB",92,0)
 D LIST^ORQOR1(.ORBY,DFN,"ALL",12,"","")
"RTN","ORWORB",93,0)
 S ORAUTO=+$$GET^XPAR("ALL","ORPF AUTO UNFLAG")
"RTN","ORWORB",94,0)
 S ORI=0 F  S ORI=$O(ORBY(ORI)) Q:ORI'>0  D
"RTN","ORWORB",95,0)
 . I ORAUTO D  ; unflag
"RTN","ORWORB",96,0)
 . . S ORUNF=+$E($$NOW^XLFDT,1,12)_U_DUZ_"^Auto-Unflagged"
"RTN","ORWORB",97,0)
 . . S ORIFN=$P(ORBY(ORI),U),ORA=+$P(ORIFN,";",2)
"RTN","ORWORB",98,0)
 . . I ORIFN,$D(^OR(100,+ORIFN,0)) S $P(^(8,ORA,3),U)=0,$P(^(3),U,6,8)=ORUNF D MSG^ORCFLAG(ORIFN) ; unflag
"RTN","ORWORB",99,0)
 I ORAUTO!(+$G(ORBY(1))=0) D DELETE^XQALERT
"RTN","ORWORB",100,0)
 Q
"RTN","ORWORB",101,0)
KILEXMED(Y,ORDFN)  ; -- Delete expiring meds notification if no expiring meds remaining
"RTN","ORWORB",102,0)
 N ORDG,ORLST S ORDG=$$DG^ORQOR1("RX")
"RTN","ORWORB",103,0)
 D AGET^ORWORR(.ORLST,ORDFN,5,ORDG)
"RTN","ORWORB",104,0)
 Q:+(@ORLST@(.1))  ;more left
"RTN","ORWORB",105,0)
 N XQAKILL,ORNIFN,ORVP,ORIO S OROI=""
"RTN","ORWORB",106,0)
 F OROI="INPT","OUTPT" D
"RTN","ORWORB",107,0)
 .S ORNIFN=$O(^ORD(100.9,"B","MEDICATIONS EXPIRING - "_OROI,0)),ORVP=ORDFN_";DPT("
"RTN","ORWORB",108,0)
 .Q:'$L($G(ORNIFN))
"RTN","ORWORB",109,0)
 .S XQAKILL=$$XQAKILL^ORB3F1(ORNIFN) ; expiring meds notif
"RTN","ORWORB",110,0)
 .I $D(XQAID) D DELETE^XQALERT
"RTN","ORWORB",111,0)
 .I '$D(XQAID) S XQAID=$P($G(^ORD(100.9,ORNIFN,0)),U,2)_","_+ORVP_","_ORNIFN D DELETEA^XQALERT K XQAID
"RTN","ORWORB",112,0)
 Q
"RTN","ORWORB",113,0)
KILEXOI(Y,ORDFN,ORNIFN)  ; -- Delete expiring flagged OI notification if no flagged expiring OI remaining
"RTN","ORWORB",114,0)
 N ORDG,ORLST S ORDG=$$DG^ORQOR1("ALL")
"RTN","ORWORB",115,0)
 D AGET^ORWORR(.ORLST,ORDFN,5,ORDG)
"RTN","ORWORB",116,0)
 Q:+(@ORLST@(.1))  ;more left
"RTN","ORWORB",117,0)
 N XQAKILL,ORVP
"RTN","ORWORB",118,0)
 S ORVP=ORDFN_";DPT("
"RTN","ORWORB",119,0)
 S XQAKILL=$$XQAKILL^ORB3F1(ORNIFN) ; flagged expiring OI notifications
"RTN","ORWORB",120,0)
 I $D(XQAID) D DELETE^XQALERT
"RTN","ORWORB",121,0)
 I '$D(XQAID) S XQAID=$P($G(^ORD(100.9,ORNIFN,0)),U,2)_","_+ORVP_","_ORNIFN D DELETEA^XQALERT K XQAID
"RTN","ORWORB",122,0)
 Q
"RTN","ORWORB",123,0)
KILUNVOR(Y,ORDFN)  ; -- Delete UNVERIFIED ORDER notification if none remaining within current admission/30 days
"RTN","ORWORB",124,0)
 N DFN,ORDG,ORLST,ORBDT,OREDT,ORDDT S ORDG=$$DG^ORQOR1("ALL")
"RTN","ORWORB",125,0)
 S OREDT=$$NOW^XLFDT
"RTN","ORWORB",126,0)
 S ORDDT=$$FMADD^XLFDT(OREDT,"-90")
"RTN","ORWORB",127,0)
 ;get current admission date/time:
"RTN","ORWORB",128,0)
 S DFN=ORDFN,VA200="" D INP^VADPT
"RTN","ORWORB",129,0)
 S ORBDT=$P($G(VAIN(7)),U)
"RTN","ORWORB",130,0)
 S ORBDT=$S('$L($G(ORBDT)):$$FMADD^XLFDT(OREDT,"-30"),1:ORBDT)  ;<= if no admission use past 30 days
"RTN","ORWORB",131,0)
 S ORBDT=$S(ORDDT>ORBDT:ORDDT,1:ORBDT)  ;max past days to use is 90 days
"RTN","ORWORB",132,0)
 D AGET^ORWORR(.ORLST,ORDFN,9,ORDG,ORBDT,OREDT)
"RTN","ORWORB",133,0)
 Q:+(@ORLST@(.1))  ;more left
"RTN","ORWORB",134,0)
 N XQAKILL,ORVP,ORNIFN
"RTN","ORWORB",135,0)
 S ORNIFN=$O(^ORD(100.9,"B","UNVERIFIED ORDER",0)),ORVP=ORDFN_";DPT("
"RTN","ORWORB",136,0)
 S XQAKILL=$$XQAKILL^ORB3F1(ORNIFN)
"RTN","ORWORB",137,0)
 I $D(XQAID) D DELETE^XQALERT
"RTN","ORWORB",138,0)
 I '$D(XQAID) S XQAID=$P($G(^ORD(100.9,ORNIFN,0)),U,2)_","_+ORVP_","_ORNIFN D DELETEA^XQALERT K XQAID
"RTN","ORWORB",139,0)
 Q
"RTN","ORWORB",140,0)
KILUNVMD(Y,ORDFN)  ; -- Delete UNVERIFIED MEDS notification if none remaining within current admission/30 days
"RTN","ORWORB",141,0)
 N DFN,ORDG,ORLST,ORBDT,OREDT,ORDDT S ORDG=$$DG^ORQOR1("RX")
"RTN","ORWORB",142,0)
 S OREDT=$$NOW^XLFDT
"RTN","ORWORB",143,0)
 S ORDDT=$$FMADD^XLFDT(OREDT,"-90")
"RTN","ORWORB",144,0)
 ;get current admission date/time:
"RTN","ORWORB",145,0)
 S DFN=ORDFN,VA200="" D INP^VADPT
"RTN","ORWORB",146,0)
 S ORBDT=$P($G(VAIN(7)),U)
"RTN","ORWORB",147,0)
 S ORBDT=$S('$L($G(ORBDT)):$$FMADD^XLFDT(OREDT,"-30"),1:ORBDT)  ;<= if no admission use past 30 days
"RTN","ORWORB",148,0)
 S ORBDT=$S(ORDDT>ORBDT:ORDDT,1:ORBDT)  ;max past days to use is 90 days
"RTN","ORWORB",149,0)
 D AGET^ORWORR(.ORLST,ORDFN,9,ORDG,ORBDT,OREDT)
"RTN","ORWORB",150,0)
 Q:+(@ORLST@(.1))  ;more left
"RTN","ORWORB",151,0)
 N XQAKILL,ORVP,ORNIFN
"RTN","ORWORB",152,0)
 S ORNIFN=$O(^ORD(100.9,"B","UNVERIFIED MEDICATION ORDER",0)),ORVP=ORDFN_";DPT("
"RTN","ORWORB",153,0)
 S XQAKILL=$$XQAKILL^ORB3F1(ORNIFN)
"RTN","ORWORB",154,0)
 I $D(XQAID) D DELETE^XQALERT
"RTN","ORWORB",155,0)
 I '$D(XQAID) S XQAID=$P($G(^ORD(100.9,ORNIFN,0)),U,2)_","_+ORVP_","_ORNIFN D DELETEA^XQALERT K XQAID
"RTN","ORWORB",156,0)
 Q
"RTN","ORWORB",157,0)
ESORD(ORY,XQAID)   ;order(s) requiring electronic signature follow-up
"RTN","ORWORB",158,0)
 K XQAKILL
"RTN","ORWORB",159,0)
 N ORPT,ORDG,ORBXQAID,ORY,ORX,ORZ,ORDERS,ORDNUM,ORQUIT,ORBLMDEL
"RTN","ORWORB",160,0)
 S ORBXQAID=XQAID,ORDERS=0,ORQUIT=0
"RTN","ORWORB",161,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORWORB",162,0)
 S ORDG=$$DG^ORQOR1("ALL")
"RTN","ORWORB",163,0)
 ;the FLG code for UNSIGNED orders in ORQ1 is '11'
"RTN","ORWORB",164,0)
 ;get unsigned orders - if none exist, delete alert then quit:
"RTN","ORWORB",165,0)
 D EN^ORQ1(ORPT_";DPT(",ORDG,11,"","","",0,0)
"RTN","ORWORB",166,0)
 S ORX="",ORX=$O(^TMP("ORR",$J,ORX)) Q:ORX=""  I +$G(^TMP("ORR",$J,ORX,"TOT"))<1 D DEL^ORB3FUP1(.ORY,ORBXQAID) K ^TMP("ORR",$J) Q
"RTN","ORWORB",167,0)
 ;
"RTN","ORWORB",168,0)
 ;user does not have ORES key, delete user's alert:
"RTN","ORWORB",169,0)
 I '$D(^XUSEC("ORES",DUZ)) S XQAKILL=1 D DEL^ORB3FUP1(.ORY,ORBXQAID) K ^TMP("ORR",$J) Q
"RTN","ORWORB",170,0)
 ;
"RTN","ORWORB",171,0)
 ;if prov is NOT linked to pt via attending, primary or teams:
"RTN","ORWORB",172,0)
 I $$PPLINK^ORQPTQ1(DUZ,ORPT)=0 D
"RTN","ORWORB",173,0)
 .S ORX="" F  S ORX=$O(^TMP("ORR",$J,ORX)) Q:ORX=""!(ORDERS=1)  D
"RTN","ORWORB",174,0)
 ..S ORZ="" F  S ORZ=$O(^TMP("ORR",$J,ORX,ORZ)) Q:+ORZ=0!(ORDERS=1)  D
"RTN","ORWORB",175,0)
 ...S ORDNUM=^TMP("ORR",$J,ORX,ORZ)
"RTN","ORWORB",176,0)
 ...;quit if this unsigned order's last action was made by the user
"RTN","ORWORB",177,0)
 ...I DUZ=+$$UNSIGNOR^ORQOR2(ORDNUM) S ORDERS=1
"RTN","ORWORB",178,0)
 .I ORDERS'=1 D  ;provider has no outstanding unsigned orders for pt
"RTN","ORWORB",179,0)
 ..S XQAKILL=1 D DEL^ORB3FUP1(.ORY,ORBXQAID)  ;delete alert for this user
"RTN","ORWORB",180,0)
 K ^TMP("ORR",$J)
"RTN","ORWORB",181,0)
 Q
"RTN","ORWORB",182,0)
 ;
"RTN","ORWORB",183,0)
TXTFUP(ROOT,DFN,NOTIF,XQADATA) ; Follow-up for text messages
"RTN","ORWORB",184,0)
 ;
"RTN","ORWORB",185,0)
 I NOTIF=67 D CHGRAD
"RTN","ORWORB",186,0)
 Q
"RTN","ORWORB",187,0)
 ;
"RTN","ORWORB",188,0)
CHGRAD ;GUI follow-up for Imaging Request Changed (#67)
"RTN","ORWORB",189,0)
 S ROOT=$NA(^TMP($J,"RAE4"))
"RTN","ORWORB",190,0)
 K @ROOT
"RTN","ORWORB",191,0)
 D SET1^RAO7PC4  ;DBIA #3563
"RTN","ORWORB",192,0)
 Q
"RTN","ORWORB",193,0)
 ;
"RTN","ORWORB",194,0)
GETSORT(ORY) ;return notification sort method^direction for user/division/system/pkg
"RTN","ORWORB",195,0)
 S ORY=$$GET^XPAR("ALL","ORB SORT METHOD",1,"I")_U_$$GET^XPAR("ALL","ORB SORT DIRECTION",1,"I")
"RTN","ORWORB",196,0)
 Q
"RTN","ORWORB",197,0)
 ;
"RTN","ORWORB",198,0)
SETSORT(ORERR,SORT,DIR) ;set notification sort method^direction for user
"RTN","ORWORB",199,0)
 D EN^XPAR(DUZ_";VA(200,","ORB SORT METHOD",1,SORT,.ORERR)
"RTN","ORWORB",200,0)
 I $L($G(DIR)) D EN^XPAR(DUZ_";VA(200,","ORB SORT DIRECTION",1,DIR,.ORERR)
"RTN","ORWORB",201,0)
 Q
"RTN","ORWORR")
0^70^B66127235
"RTN","ORWORR",1,0)
ORWORR ; SLC/KCM/JLI - Retrieve Orders for Broker ;7/24/05
"RTN","ORWORR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,92,116,110,132,141,163,189,195,215,243**;Dec 17, 1997;Build 242
"RTN","ORWORR",3,0)
 ;
"RTN","ORWORR",4,0)
GET(LST,DFN,FILTER,GROUPS) ; procedure
"RTN","ORWORR",5,0)
 Q  ; don't call until using same treating specialty logic as AGET
"RTN","ORWORR",6,0)
 ;    & until MULT, ORWARD, & ORIGVIEW implemented
"RTN","ORWORR",7,0)
 ;    & until the date ranges implemented
"RTN","ORWORR",8,0)
 ; Get orders for patient
"RTN","ORWORR",9,0)
 ;        1   2    3     4      5     6   7   8   9   10     11    12    13    14     15     16 17    18
"RTN","ORWORR",10,0)
 ; .LST=~IFN^Grp^ActTm^StrtTm^StopTm^Sts^Sig^Nrs^Clk^PrvID^PrvNam^ActDA^Flag^DCType^ChrtRev^DEA#^^Schedule
"RTN","ORWORR",11,0)
 ; .LST=tOrder Text (repeating as necessary)
"RTN","ORWORR",12,0)
 ;     DFN=Patient ID
"RTN","ORWORR",13,0)
 ;  FILTER=# indicates which orders to return, default=2 (current)
"RTN","ORWORR",14,0)
 ;  GROUPS=display grp of orders to show (default=ALL)
"RTN","ORWORR",15,0)
 ; -- section uses ORQ1 to get orders list rather than XGET --
"RTN","ORWORR",16,0)
 N ORLIST,ORIFN,X0,X3,X8,IDX,IFN,ACT,PRV,LN,TXT,STRT,STOP,CSTS,EYE,DEA ;PKI
"RTN","ORWORR",17,0)
 K ^TMP("ORR",$J)
"RTN","ORWORR",18,0)
 S (IDX,LST)=0 S:'$D(GROUPS) GROUPS=1 S:'$D(FILTER) FILTER=2
"RTN","ORWORR",19,0)
 D EN^ORQ1(DFN_";DPT(",GROUPS,FILTER,"","","",0,1)
"RTN","ORWORR",20,0)
 S EYE=0 F  S EYE=$O(^TMP("ORR",$J,ORLIST,EYE)) Q:'EYE  S IFN=^(EYE) D
"RTN","ORWORR",21,0)
 . S ACT=$P(IFN,";",2),IFN=+IFN,X0=^OR(100,IFN,0),X3=^(3),X8=^(8,ACT,0)
"RTN","ORWORR",22,0)
 . D GETFLDS
"RTN","ORWORR",23,0)
 K ^TMP("ORR",$J)
"RTN","ORWORR",24,0)
 G EXIT
"RTN","ORWORR",25,0)
AGET(REF,DFN,FILTER,GROUPS,DTFROM,DTTHRU,EVENT,ORRECIP) ;Get abbrev. event delayed order list for patient 
"RTN","ORWORR",26,0)
 ; returns ^TMP("ORR",$J,ORLIST,n)=IFN^DGrp^ActTm
"RTN","ORWORR",27,0)
 ; see input parameters above
"RTN","ORWORR",28,0)
 ; -- from ORWORR
"RTN","ORWORR",29,0)
 ; -- section uses ORQ1 to get orders list rather than XGET --
"RTN","ORWORR",30,0)
 N ORLIST,ORIFN,IFN,I,ORWTS,TOT,MULT,ORWARD,TXTVW,ORYD,PTEVTID,EVTNAME
"RTN","ORWORR",31,0)
 S (PTEVTID,EVTNAME)=""
"RTN","ORWORR",32,0)
 K ^TMP("ORR",$J),^TMP("ORRJD",$J)
"RTN","ORWORR",33,0)
 S:'$D(GROUPS) GROUPS=1 S:'$D(FILTER) FILTER=2
"RTN","ORWORR",34,0)
 S ORWTS=+$P(FILTER,U,2),FILTER=+FILTER
"RTN","ORWORR",35,0)
 S MULT=$S("^1^6^8^9^10^11^13^14^20^22^"[(U_FILTER_U):1,1:0)
"RTN","ORWORR",36,0)
 I $L($G(^DPT(DFN,.1))) S ORWARD=1 ; normally ptr to 42
"RTN","ORWORR",37,0)
 S:'$L($G(DTFROM)) DTFROM=0
"RTN","ORWORR",38,0)
 S:'$L($G(DTTHRU)) DTTHRU=0
"RTN","ORWORR",39,0)
 I $P(DTFROM,".")=$P(DTTHRU,"."),$P(DTFROM,".",2)>$P(DTTHRU,".",2),$P(DTTHRU,".",2)="" S $P(DTTHRU,".",2)=2359
"RTN","ORWORR",40,0)
 S:'$L($G(EVENT)) EVENT=0
"RTN","ORWORR",41,0)
 I $G(EVTDCREL)="TRUE" D
"RTN","ORWORR",42,0)
 . D EN^ORQ1(DFN_";DPT(",GROUPS,FILTER,"",DTFROM,DTTHRU,2,MULT,"",1,EVENT)
"RTN","ORWORR",43,0)
 . D GET2^ORWORR1
"RTN","ORWORR",44,0)
 E  D
"RTN","ORWORR",45,0)
 . D EN^ORQ1(DFN_";DPT(",GROUPS,FILTER,"",DTFROM,DTTHRU,0,MULT,"",1,EVENT)
"RTN","ORWORR",46,0)
 . D GET1^ORWORR1
"RTN","ORWORR",47,0)
 Q
"RTN","ORWORR",48,0)
RGET(REF,DFN,FILTER,GROUPS,DTFROM,DTTHRU,EVENT) ;Orders of AutoDC/Release Event
"RTN","ORWORR",49,0)
 N EVTDCREL
"RTN","ORWORR",50,0)
 S EVTDCREL="TRUE"
"RTN","ORWORR",51,0)
 D AGET(.REF,DFN,FILTER,GROUPS,DTFROM,DTTHRU,EVENT)
"RTN","ORWORR",52,0)
 Q
"RTN","ORWORR",53,0)
XGET ; retrieval algorithm before all the AC xref changes
"RTN","ORWORR",54,0)
 N X,X0,X3,IDX,IFN,LN,TIME,DGRP,MASK,TXT,ACT,PRV,ID,DEA,PASS ;PKI
"RTN","ORWORR",55,0)
 S DFN=DFN_";DPT(",IDX=0,LST=0
"RTN","ORWORR",56,0)
 I '$G(FILTER) S FILTER=2                    ; Default: Current/Active
"RTN","ORWORR",57,0)
 I $D(GROUPS)=1 D
"RTN","ORWORR",58,0)
 . S:'GROUPS GROUPS=$O(^ORD(100.98,"B",GROUPS,0))
"RTN","ORWORR",59,0)
 . D XPND(GROUPS)
"RTN","ORWORR",60,0)
 I FILTER=1  D DOALL G EXIT                  ; All
"RTN","ORWORR",61,0)
 I FILTER=2  D DOCUR G EXIT                  ; Current
"RTN","ORWORR",62,0)
 I FILTER=3  S PASS=";1;"                    ; Discontinued
"RTN","ORWORR",63,0)
 I FILTER=4  S PASS=";2;7;"                  ; Comp/Expired
"RTN","ORWORR",64,0)
 I FILTER=5  S PASS=";3;4;5;6;8;9;"          ; Expiring
"RTN","ORWORR",65,0)
 I FILTER=6  S PASS=";1;2;3;4;5;6;7;8;9;11;" ; New Activity
"RTN","ORWORR",66,0)
 I FILTER=7  S PASS=";5;"                    ; Pending
"RTN","ORWORR",67,0)
 I FILTER=8  Q                               ; Expanded
"RTN","ORWORR",68,0)
 I FILTER=9  S PASS=";3;4;5;6;8;9;11;"       ; Unverified by Nurse
"RTN","ORWORR",69,0)
 I FILTER=10 S PASS=";3;4;5;6;8;9;11;"       ; Unverified by Clerk
"RTN","ORWORR",70,0)
 I FILTER=11 S PASS=";3;4;5;6;7;8;11;"       ; Unsigned
"RTN","ORWORR",71,0)
 I FILTER=12 S PASS=";4;"                    ; Flagged
"RTN","ORWORR",72,0)
 I FILTER=13 S PASS=""                       ; Verbal/Phone
"RTN","ORWORR",73,0)
 I FILTER=14 S PASS=""                       ; Verbal/Phone Unsigned
"RTN","ORWORR",74,0)
 D DOGET
"RTN","ORWORR",75,0)
EXIT I LST=0 D
"RTN","ORWORR",76,0)
 . N %,X,%I D NOW^%DTC
"RTN","ORWORR",77,0)
 . S LST(1)="~0^0^"_%_"^^^97",LST(2)="tNo Orders Found."
"RTN","ORWORR",78,0)
 Q
"RTN","ORWORR",79,0)
DOGET ; Here to filter orders 
"RTN","ORWORR",80,0)
 S TIME=0 F  S TIME=$O(^OR(100,"AO",DFN,TIME)) Q:'TIME  D
"RTN","ORWORR",81,0)
 . S DGRP=0 F  S DGRP=$O(^OR(100,"AO",DFN,TIME,DGRP)) Q:'DGRP  D
"RTN","ORWORR",82,0)
 . . I $D(GROUPS)>1 Q:'$D(GROUPS(DGRP))           ;filter by display grp
"RTN","ORWORR",83,0)
 . . S IFN=0 F  S IFN=$O(^OR(100,"AO",DFN,TIME,DGRP,IFN)) Q:'IFN  D
"RTN","ORWORR",84,0)
 . . . S X0=^OR(100,IFN,0),X3=^(3)                ;get main nodes
"RTN","ORWORR",85,0)
 . . . I $P(X3,U,8)!$P(X3,U,9)!($P(X3,U,3)=99) Q  ;skip veil,chld,sts=99
"RTN","ORWORR",86,0)
 . . . I $L(PASS),(PASS'[(";"_$P(X3,U,3)_";")) Q  ;filter by status
"RTN","ORWORR",87,0)
 . . . ; any other filtering
"RTN","ORWORR",88,0)
 . . . D GETFLDS
"RTN","ORWORR",89,0)
 Q
"RTN","ORWORR",90,0)
DOALL ; Here to get all orders (no filter by status)
"RTN","ORWORR",91,0)
 S TIME=0 F  S TIME=$O(^OR(100,"AO",DFN,TIME)) Q:'TIME  D
"RTN","ORWORR",92,0)
 . S DGRP=0 F  S DGRP=$O(^OR(100,"AO",DFN,TIME,DGRP)) Q:'DGRP  D
"RTN","ORWORR",93,0)
 . . I $D(GROUPS)>1 Q:'$D(GROUPS(DGRP))           ;filter by display grp
"RTN","ORWORR",94,0)
 . . S IFN=0 F  S IFN=$O(^OR(100,"AO",DFN,TIME,DGRP,IFN)) Q:'IFN  D
"RTN","ORWORR",95,0)
 . . . S X0=^OR(100,IFN,0),X3=^(3)                ;get main nodes
"RTN","ORWORR",96,0)
 . . . I $P(X3,U,8)!$P(X3,U,9)!($P(X3,U,3)=99) Q  ;skip veil,chld,sts=99
"RTN","ORWORR",97,0)
 . . . D GETFLDS
"RTN","ORWORR",98,0)
 Q
"RTN","ORWORR",99,0)
DOCUR ; Here to get all current orders
"RTN","ORWORR",100,0)
 N AOCTXT,STS,STOP,%
"RTN","ORWORR",101,0)
 S X=-$$GET^XPAR("ALL","ORPF ACTIVE ORDERS CONTEXT HRS")
"RTN","ORWORR",102,0)
 S %H=$H,X=(%H*86400+$P(%H,",",2))+(X*3600),%H=(X\86400)_","_(X#86400)
"RTN","ORWORR",103,0)
 D YMD^%DTC S AOCTXT=X_%
"RTN","ORWORR",104,0)
 S MASK="110000100101110"   ; mask out STS=1,2,7,10,12,13,14
"RTN","ORWORR",105,0)
 S TIME=0 F  S TIME=$O(^OR(100,"AC",DFN,TIME)) Q:'TIME  D
"RTN","ORWORR",106,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AC",DFN,TIME,IFN)) Q:'IFN  D
"RTN","ORWORR",107,0)
 . . ; filter out display groups here
"RTN","ORWORR",108,0)
 . . S ACT=0 F  S ACT=$O(^OR(100,"AC",DFN,TIME,IFN,ACT)) Q:'ACT  D
"RTN","ORWORR",109,0)
 . . . S X0=^OR(100,IFN,0),X3=^(3),X8=^(8,ACT,0)
"RTN","ORWORR",110,0)
 . . . S STS=$P(X3,U,3),STOP=$P(X0,U,9)
"RTN","ORWORR",111,0)
 . . . I $P(X3,U,8)!$P(X3,U,9)!(STS=99) Q
"RTN","ORWORR",112,0)
 . . . I $P(X8,U,15)=13,($P(X8,U)<AOCTXT) D ACKILL Q
"RTN","ORWORR",113,0)
 . . . I $P(X8,U,15)=13!($P(X8,U,15)=""),("RN^XX"[$P(X8,U,2)) D ACKILL Q
"RTN","ORWORR",114,0)
 . . . I $E(MASK,STS),STOP<AOCTXT D ACKILL Q
"RTN","ORWORR",115,0)
 . . . D GETFLDS
"RTN","ORWORR",116,0)
 Q
"RTN","ORWORR",117,0)
ACKILL ; called only from DOCUR - kill AC xref
"RTN","ORWORR",118,0)
 ; K ^OR(100,"AC",DFN,TIME,IFN,ACT)  ; let ORQ1 kill if for now
"RTN","ORWORR",119,0)
 Q
"RTN","ORWORR",120,0)
GET4V11(LST,TXTVW,ORYD,IFNLST) ; get order fields TEMP
"RTN","ORWORR",121,0)
 G GET41
"RTN","ORWORR",122,0)
GET4LST(LST,IFNLST) ; get order fields for list of orders
"RTN","ORWORR",123,0)
GET41 N ACT,ACTID,IDX,X0,X3,X8,PRV,ID,LN,TXT,STRT,STOP,CSTS,IFN,IFNIDX,ORIGVIEW,DEA ;PKI
"RTN","ORWORR",124,0)
 N LOC ;IMO
"RTN","ORWORR",125,0)
 S (IDX,LST,IFNIDX)=0
"RTN","ORWORR",126,0)
 F  S IFNIDX=$O(IFNLST(IFNIDX)) Q:'IFNIDX  S IFN=IFNLST(IFNIDX) D
"RTN","ORWORR",127,0)
 . S ACT=$S($P(IFN,";",2):$P(IFN,";",2),1:1),IFN=+IFN
"RTN","ORWORR",128,0)
 . S X0=$G(^OR(100,IFN,0)),X3=$G(^(3)),X8=$G(^(8,ACT,0))
"RTN","ORWORR",129,0)
 . D GETFLDS
"RTN","ORWORR",130,0)
 Q
"RTN","ORWORR",131,0)
GETBYIFN(LST,IFN) ; procedure
"RTN","ORWORR",132,0)
 ; get fields for single order
"RTN","ORWORR",133,0)
 ; .LST(n)=described above in GET
"RTN","ORWORR",134,0)
 ;  IFN=internal entry # for order
"RTN","ORWORR",135,0)
 I 'IFN Q
"RTN","ORWORR",136,0)
 N ACT,IDX,X0,X3,X8,PRV,ID,LN,TXT,STRT,STOP,CSTS,ACTID,ORIGVIEW,ORYD,TXTVW,DEA ;PKI
"RTN","ORWORR",137,0)
 S IDX=0,LST=0,ORYD=0
"RTN","ORWORR",138,0)
 S X0=$G(^OR(100,+IFN,0)),X3=$G(^(3))
"RTN","ORWORR",139,0)
 S ACT=$S($P(IFN,";",2):$P(IFN,";",2),$P(X3,U,7):$P(X3,U,7),1:1)
"RTN","ORWORR",140,0)
 S IFN=+IFN,X8=$G(^OR(100,IFN,8,ACT,0))
"RTN","ORWORR",141,0)
GETFLDS ; used by entry points to place order fields into list
"RTN","ORWORR",142,0)
 ; expects IDX=sequence #, IFN=order, X0=node 0, X3=node 3, LST=results
"RTN","ORWORR",143,0)
 ; LST(IDX)=~IFN^Grp^OrdTm^StrtTm^StopTm^Sts^Sig^Nrs^Clk^PrvID^PrvNam^Act^Flagged[^DCType]^ChartRev^DEA#^^DigSig^LOC
"RTN","ORWORR",144,0)
 S PRV=$P(X8,U,5) S:'PRV PRV=$P(X8,U,3) S PRV=PRV_U
"RTN","ORWORR",145,0)
 I PRV S PRV=PRV_$P(^VA(200,+PRV,0),U)
"RTN","ORWORR",146,0)
 S DEA=$$DEA^XUSER(,+PRV) ; get user DEA info - PKI
"RTN","ORWORR",147,0)
 S IDX=IDX+1,LST=LST+1,ID=IFN_";"_ACT,ACTID=$P(X8,U,2)
"RTN","ORWORR",148,0)
 S CSTS=$S($P(X8,U,15):$P(X8,U,15),1:$P(X3,U,3))
"RTN","ORWORR",149,0)
 I $P(X8,U,15)=10,$P(X3,U,3)=14 S CSTS=14 ;delayed-lapsed order
"RTN","ORWORR",150,0)
 S STRT=$S($P(X3,U,3)=11:$$RSTRT,ACTID="NW"!(ACTID="XX")!(ACTID="RL"):$P(X0,U,8),ACTID="DC":"",1:$P(X8,U)) ;110
"RTN","ORWORR",151,0)
 S STOP=$S($P(X3,U,3)=11:$$RSTOP,ACTID="HD":$P($G(^OR(100,+IFN,8,ACT,2)),U),1:$P(X0,U,9))
"RTN","ORWORR",152,0)
 S LST(IDX)="~"_ID_U_$P(X0,U,11)_U_$P(X8,U)_U_STRT_U_STOP_U_CSTS_U_$P(X8,U,4)_U_$P(X8,U,8)_U_$P(X8,U,10)_U_PRV
"RTN","ORWORR",153,0)
 S $P(LST(IDX),U,13)=+$G(^OR(100,IFN,8,ACT,3))    ; flagged
"RTN","ORWORR",154,0)
 I +$P(X8,U,8) S $P(LST(IDX),U,8)=$$INITIALS^ORCHTAB2(+$P(X8,U,8))    ;nurse
"RTN","ORWORR",155,0)
 I +$P(X8,U,10) S $P(LST(IDX),U,9)=$$INITIALS^ORCHTAB2(+$P(X8,U,10))  ;clerk
"RTN","ORWORR",156,0)
 I +$P(X8,U,18) S $P(LST(IDX),U,15)=$$INITIALS^ORCHTAB2(+$P(X8,U,18)) ;chart review
"RTN","ORWORR",157,0)
 I $L($G(DEA)) S $P(LST(IDX),U,16)=DEA ;PKI
"RTN","ORWORR",158,0)
 I $P($G(^OR(100,IFN,8,ACT,2)),"^",5) S $P(LST(IDX),U,18)=$P(^(2),"^",4)
"RTN","ORWORR",159,0)
 I '$P($G(^OR(100,IFN,8,ACT,2)),"^",5),$P(X0,"^",5) D  ;Copy orders PKI fix
"RTN","ORWORR",160,0)
 . N OI,ORVP,ORCAT,PKG
"RTN","ORWORR",161,0)
 . S OI=+$O(^OR(100,IFN,4.5,"ID","ORDERABLE",0)),OI=+$G(^OR(100,IFN,4.5,OI,1)) Q:'OI
"RTN","ORWORR",162,0)
 . S ORVP=$P(X0,"^",2),PKG=$P(X0,"^",14)
"RTN","ORWORR",163,0)
 . S ORCAT=$S($L($P($G(^DPT(+ORVP,.1)),U)):"I",1:"O")
"RTN","ORWORR",164,0)
 . I PKG'=$O(^DIC(9.4,"B","OUTPATIENT PHARMACY",0)) Q
"RTN","ORWORR",165,0)
 . D PKI^ORWDPS1(.ORY,OI,ORCAT,+ORVP,$$GET^XPAR("ALL^USR.`"_DUZ,"ORWOR PKI USE",1,"Q"))
"RTN","ORWORR",166,0)
 . I $E($G(ORY))=2 S $P(LST(IDX),U,18)=ORY
"RTN","ORWORR",167,0)
 ; Change to display location for Clinic Orders, Inpatients, & IV infusion orders.
"RTN","ORWORR",168,0)
 N DGID,DGNAM
"RTN","ORWORR",169,0)
 S LOC=""
"RTN","ORWORR",170,0)
 S DGID=$P(X0,U,11)
"RTN","ORWORR",171,0)
 I $L(DGID) D 
"RTN","ORWORR",172,0)
 .S DGNAM=$P($G(^ORD(100.98,DGID,0)),U)
"RTN","ORWORR",173,0)
 .;I DGNAM="CLINIC ORDERS"!(DGNAM="INPATIENT MEDICATIONS")!(DGNAM="IV MEDICATIONS")!(DGNAM="UNIT DOSE MEDICATIONS") D
"RTN","ORWORR",174,0)
 .S LOC=$P(X0,U,10) ;IMO
"RTN","ORWORR",175,0)
 .S:+LOC LOC=$P($G(^SC(+LOC,0)),U)_":"_+LOC ;IMO
"RTN","ORWORR",176,0)
 S $P(LST(IDX),U,19)=LOC ;IMO
"RTN","ORWORR",177,0)
 ;
"RTN","ORWORR",178,0)
 S ORIGVIEW=$S($G(TXTVW)=0:0,$G(TXTVW)=1:1,ORYD=-1:1,'ORYD:1,$P(X8,U)'<ORYD:0,1:1)
"RTN","ORWORR",179,0)
 K TXT D TEXT^ORQ12(.TXT,ID,255)                  ; optimize later
"RTN","ORWORR",180,0)
 I $O(^OR(100,+IFN,2,0)) S LN=$O(TXT(0)),TXT(LN)="+"_TXT(LN)
"RTN","ORWORR",181,0)
 I $O(^OR(100,+IFN,8,"C","XX",0)) S LN=$O(TXT(0)),TXT(LN)="*"_TXT(LN)
"RTN","ORWORR",182,0)
 S LN=0 F  S LN=$O(TXT(LN)) Q:'LN  S IDX=IDX+1,LST(IDX)="t"_TXT(LN)
"RTN","ORWORR",183,0)
 I $O(^OR(100,+IFN,8,1,.2,0)) S IDX=IDX+1,LST(IDX)="|" D  ;PKI XMLText
"RTN","ORWORR",184,0)
 . S I=0 F  S I=$O(^OR(100,+IFN,8,1,.2,I)) Q:'I  S IDX=IDX+1,LST(IDX)="x"_^(I,0)
"RTN","ORWORR",185,0)
 Q
"RTN","ORWORR",186,0)
RSTRT() ; return start date from responses
"RTN","ORWORR",187,0)
 Q $G(^OR(100,IFN,4.5,+$O(^OR(100,IFN,4.5,"ID","START",0)),1))
"RTN","ORWORR",188,0)
RSTOP() ; return stop date from responses
"RTN","ORWORR",189,0)
 Q $G(^OR(100,IFN,4.5,+$O(^OR(100,IFN,4.5,"ID","STOP",0)),1))
"RTN","ORWORR",190,0)
GETTXT(LST,IFN) ; get text of an order
"RTN","ORWORR",191,0)
 I $L(IFN,";")=1 S IFN=IFN_";1"
"RTN","ORWORR",192,0)
 D TEXT^ORQ12(.LST,IFN,255)
"RTN","ORWORR",193,0)
 Q
"RTN","ORWORR",194,0)
XPND(AGRP) ; procedure
"RTN","ORWORR",195,0)
 ; Expand display group (GROUPS defined outside of call)
"RTN","ORWORR",196,0)
 N I,CHLD
"RTN","ORWORR",197,0)
 S GROUPS(AGRP)=^ORD(100.98,AGRP,0),I=0
"RTN","ORWORR",198,0)
 F  S I=$O(^ORD(100.98,AGRP,1,I)) Q:'I  S CHLD=$P(^(I,0),U) D XPND(CHLD)
"RTN","ORWORR",199,0)
 Q
"RTN","ORWORR",200,0)
GETPKG(Y,IFN) ; get order pkg
"RTN","ORWORR",201,0)
 N ORDERID,PKGID
"RTN","ORWORR",202,0)
 Q:+IFN<1
"RTN","ORWORR",203,0)
 S ORDERID=+IFN,Y=""
"RTN","ORWORR",204,0)
 S PKGID=$P(OR(100,ORDERID,0),U,14)
"RTN","ORWORR",205,0)
 S:PKGID>0 Y=$P(^DIC(9.4,PKGID,0),U,2)
"RTN","ORWORR",206,0)
 Q
"RTN","ORWORR1")
0^68^B7659282
"RTN","ORWORR1",1,0)
ORWORR1 ; SLC/JLI - Utilities for Retrieve Orders for Broker ; 4/3/08 7:47am
"RTN","ORWORR1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141,243**;Dec 17, 1997;Build 242
"RTN","ORWORR1",3,0)
 ;Called from ORWORR
"RTN","ORWORR1",4,0)
GET1 ; 
"RTN","ORWORR1",5,0)
 S TOT=^TMP("ORR",$J,ORLIST,"TOT") K ^TMP("ORR",$J,ORLIST,"TOT")
"RTN","ORWORR1",6,0)
 S I=.1 F  S I=$O(^TMP("ORR",$J,ORLIST,I)) Q:'I  S IFN=^(I) D
"RTN","ORWORR1",7,0)
 . I $G(ORRECIP)&&($G(FILTER)=12&&($$FLAGRULE(+IFN))) K ^TMP("ORR",$J,ORLIST,I) S TOT=TOT-1 Q
"RTN","ORWORR1",8,0)
 . I ORWTS,(+$P($G(^OR(100,+IFN,0)),U,13)'=ORWTS) K ^TMP("ORR",$J,ORLIST,I) S TOT=TOT-1 Q
"RTN","ORWORR1",9,0)
 . S PTEVTID=$P($G(^OR(100,+IFN,0)),U,17)
"RTN","ORWORR1",10,0)
 . S:PTEVTID>0 EVTNAME=$$NAME^OREVNTX(PTEVTID)
"RTN","ORWORR1",11,0)
 . S ^TMP("ORR",$J,ORLIST,I)=IFN_U_$P($G(^OR(100,+IFN,0)),U,11)_U_$P($G(^(8,+$P(IFN,";",2),0)),U)_U_PTEVTID_U_EVTNAME
"RTN","ORWORR1",12,0)
 S TXTVW=$S(MULT:0,FILTER=2:2,1:1) D:FILTER=2 ORYD^ORDD100
"RTN","ORWORR1",13,0)
 S ^TMP("ORR",$J,ORLIST,.1)=TOT_U_TXTVW_U_$G(ORYD,0)
"RTN","ORWORR1",14,0)
 S REF=$NA(^TMP("ORR",$J,ORLIST))
"RTN","ORWORR1",15,0)
 Q
"RTN","ORWORR1",16,0)
GET2 ; For AUTO DC/Event Release Orders
"RTN","ORWORR1",17,0)
 N JDND,JDIX,JDCNT,DCSPLIT
"RTN","ORWORR1",18,0)
 S JDCNT=1,DCSPLIT=0
"RTN","ORWORR1",19,0)
 S TOT=^TMP("ORR",$J,ORLIST,"TOT") K ^TMP("ORR",$J,ORLIST,"TOT")
"RTN","ORWORR1",20,0)
 F JDND="RL","DC" D
"RTN","ORWORR1",21,0)
 . S I=.1 F  S I=$O(^TMP("ORR",$J,ORLIST,I)) Q:'I  D
"RTN","ORWORR1",22,0)
 . . I '$D(^TMP("ORR",$J,ORLIST,I,JDND)) Q
"RTN","ORWORR1",23,0)
 . . S JDIX=0 F  S JDIX=$O(^TMP("ORR",$J,ORLIST,I,JDND,JDIX)) Q:'JDIX  S IFN=^(JDIX)  D
"RTN","ORWORR1",24,0)
 . . . I 'DCSPLIT,(JDND="DC") D
"RTN","ORWORR1",25,0)
 . . . . S ^TMP("ORRJD",$J,JDCNT)="DC START"
"RTN","ORWORR1",26,0)
 . . . . S DCSPLIT=1,JDCNT=JDCNT+1,TOT=TOT+1
"RTN","ORWORR1",27,0)
 . . . I ORWTS,(+$P($G(^OR(100,+IFN,0)),U,13)'=ORWTS) S TOT=TOT-1 Q
"RTN","ORWORR1",28,0)
 . . . S PTEVTID=$P($G(^OR(100,+IFN,0)),U,17)
"RTN","ORWORR1",29,0)
 . . . S:PTEVTID>0 EVTNAME=$$NAME^OREVNTX(PTEVTID)
"RTN","ORWORR1",30,0)
 . . . S ^TMP("ORRJD",$J,JDCNT)=IFN_U_$P($G(^OR(100,+IFN,0)),U,11)_U_$P($G(^(8,+$P(IFN,";",2),0)),U)_U_PTEVTID_U_EVTNAME
"RTN","ORWORR1",31,0)
 . . . S JDCNT=JDCNT+1
"RTN","ORWORR1",32,0)
 S TXTVW=$S(MULT:0,FILTER=2:2,1:1) D:FILTER=2 ORYD^ORDD100
"RTN","ORWORR1",33,0)
 S ^TMP("ORRJD",$J,.1)=TOT_U_TXTVW_U_$G(ORYD,0)
"RTN","ORWORR1",34,0)
 S REF=$NA(^TMP("ORRJD",$J))
"RTN","ORWORR1",35,0)
 Q
"RTN","ORWORR1",36,0)
FLAGRULE(ORNUM,USR) ;
"RTN","ORWORR1",37,0)
 ;returns 0 if we should keep ORNUM in the list
"RTN","ORWORR1",38,0)
 ;returns 1 if we should remove ORNUM from the list
"RTN","ORWORR1",39,0)
 ;determines based on whether the user USR should see these flagged orders
"RTN","ORWORR1",40,0)
 ; based on presence in file 100 NODE 8 FIELD 39 and
"RTN","ORWORR1",41,0)
 ; based on whether the user should have gotten the flag due to provider recipients
"RTN","ORWORR1",42,0)
 N ORI,ORRET,ORQUIT,I,LST,ORDFN
"RTN","ORWORR1",43,0)
 I '$G(USR) S USR=DUZ
"RTN","ORWORR1",44,0)
 S ORRET=1,ORQUIT=0
"RTN","ORWORR1",45,0)
 S ORI=0 F  S ORI=$O(^OR(100,ORNUM,8,ORI)) Q:'ORI  D
"RTN","ORWORR1",46,0)
 .I '$P($G(^OR(100,ORNUM,8,ORI,3)),U,6)&($P($G(^OR(100,ORNUM,8,ORI,3)),U,9)) S LST($P($G(^OR(100,ORNUM,8,ORI,3)),U,9))=""
"RTN","ORWORR1",47,0)
 S ORDFN=+$P($G(^OR(100,ORNUM,0)),U,2)
"RTN","ORWORR1",48,0)
 D START^ORBPRCHK(.LST,ORNUM,6,ORDFN)
"RTN","ORWORR1",49,0)
 ;add ordering provider
"RTN","ORWORR1",50,0)
 N ORDPROV
"RTN","ORWORR1",51,0)
 S ORDPROV=$$ORDERER^ORQOR2(ORNUM)
"RTN","ORWORR1",52,0)
 I $G(ORDPROV) S LST(ORDPROV)=""
"RTN","ORWORR1",53,0)
 D ADDSURR(.LST)
"RTN","ORWORR1",54,0)
 I $D(LST(USR)) S ORRET=0
"RTN","ORWORR1",55,0)
 Q ORRET
"RTN","ORWORR1",56,0)
ADDSURR(LST) ;TAKE LIST OF USERS AND ADD SURROGATES TO THE LIST
"RTN","ORWORR1",57,0)
 N I
"RTN","ORWORR1",58,0)
 S I=0 F  S I=$O(LST(I)) Q:'I  S LST($$CURRSURO^XQALSURO(I))=""
"RTN","ORWORR1",59,0)
 Q
"RTN","ORWPCE")
0^50^B56892321
"RTN","ORWPCE",1,0)
ORWPCE ; SLC/JM/REV - wrap calls to PCE and AICS;04/01/2003 ;10/11/06  16:05
"RTN","ORWPCE",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,116,173,190,195,215,243**;Dec 17, 1997;Build 242
"RTN","ORWPCE",3,0)
 ;
"RTN","ORWPCE",4,0)
 ; DBIA 2950   LOOK^LEXA          ^TMP("LEXFND",$J)
"RTN","ORWPCE",5,0)
 ; DBIA 1609   CONFIG^LEXSET      ^TMP("LEXSCH",$J)
"RTN","ORWPCE",6,0)
 ; DBIA 1365   DSELECT^GMPLENFM   ^TMP("IB",$J)
"RTN","ORWPCE",7,0)
 ; DBIA 3991   $$STATCHK^ICDAPIU
"RTN","ORWPCE",8,0)
 ; 
"RTN","ORWPCE",9,0)
 Q
"RTN","ORWPCE",10,0)
VISIT(LST,CLINIC,ORDATE) ; get list of visit types for clinic
"RTN","ORWPCE",11,0)
 S:'+$G(ORDATE) ORDATE=DT
"RTN","ORWPCE",12,0)
 D GETLST^IBDF18A(CLINIC,"DG SELECT VISIT TYPE CPT PROCEDURES","LST",,,,ORDATE)
"RTN","ORWPCE",13,0)
 Q
"RTN","ORWPCE",14,0)
PROC(LST,CLINIC,ORDATE) ; get list of procedures for clinic P12 for CPTMods
"RTN","ORWPCE",15,0)
 S:'+$G(ORDATE) ORDATE=DT
"RTN","ORWPCE",16,0)
 D GETLST^IBDF18A(CLINIC,"DG SELECT CPT PROCEDURE CODES","LST",,,1,ORDATE)
"RTN","ORWPCE",17,0)
 N IDX,MOD,CODES,FIRST S IDX=0
"RTN","ORWPCE",18,0)
 F  S IDX=$O(LST(IDX)) Q:'+IDX  D
"RTN","ORWPCE",19,0)
 . I LST(IDX)="" K LST(IDX) Q
"RTN","ORWPCE",20,0)
 . S MOD=0,CODES="",FIRST=1
"RTN","ORWPCE",21,0)
 . F  S MOD=$O(LST(IDX,"MODIFIER",MOD)) Q:(MOD="")  D
"RTN","ORWPCE",22,0)
 . . I FIRST S FIRST=0
"RTN","ORWPCE",23,0)
 . . E  S CODES=CODES_";"
"RTN","ORWPCE",24,0)
 . . S CODES=CODES_LST(IDX,"MODIFIER",MOD)
"RTN","ORWPCE",25,0)
 . K LST(IDX,"MODIFIER")
"RTN","ORWPCE",26,0)
 . I 'FIRST S $P(LST(IDX),U,12)=CODES
"RTN","ORWPCE",27,0)
 Q
"RTN","ORWPCE",28,0)
CPTMODS(LST,ORCPTCOD,ORDATE) ;Return CPT Modifiers for a CPT Code
"RTN","ORWPCE",29,0)
 N ORM,ORIDX,ORI,MODNAME
"RTN","ORWPCE",30,0)
 S:'+$G(ORDATE) ORDATE=DT
"RTN","ORWPCE",31,0)
 I +($$CODM^ICPTCOD(ORCPTCOD,$NA(ORM),0,ORDATE)),+$D(ORM) D
"RTN","ORWPCE",32,0)
 . S ORIDX="",ORI=0
"RTN","ORWPCE",33,0)
 . F  S ORIDX=$O(ORM(ORIDX)) Q:(ORIDX="")  D
"RTN","ORWPCE",34,0)
 . . S ORI=ORI+1,MODNAME=$P(ORM(ORIDX),U,1)
"RTN","ORWPCE",35,0)
 . . S LST(MODNAME_ORI)=$P(ORM(ORIDX),U,2)_U_MODNAME_U_ORIDX
"RTN","ORWPCE",36,0)
 Q
"RTN","ORWPCE",37,0)
GETMOD(MODINFO,ORMODIEN,ORDATE) ;Returns info for a specific CPT Modifier
"RTN","ORWPCE",38,0)
 N ORDATA
"RTN","ORWPCE",39,0)
 S:'+$G(ORDATE) ORDATE=DT
"RTN","ORWPCE",40,0)
 S ORDATA=$$MOD^ICPTMOD(ORMODIEN,"I",ORDATE,1)
"RTN","ORWPCE",41,0)
 I +ORDATA>0 S MODINFO=ORMODIEN_U_$P(ORDATA,U,3)_U_$P(ORDATA,U,2)
"RTN","ORWPCE",42,0)
 Q
"RTN","ORWPCE",43,0)
DIAG(LST,CLINIC,ORDATE) ; get list of diagnoses for clinic
"RTN","ORWPCE",44,0)
 S:'+$G(ORDATE) ORDATE=DT
"RTN","ORWPCE",45,0)
 D GETLST^IBDF18A(CLINIC,"DG SELECT ICD-9 DIAGNOSIS CODES","LST",,,,ORDATE)
"RTN","ORWPCE",46,0)
 Q
"RTN","ORWPCE",47,0)
IMM(LST,CLINIC) ;get list of immunizations for clinic
"RTN","ORWPCE",48,0)
 D GETLST^IBDF18A(CLINIC,"PX SELECT IMMUNIZATIONS","LST")
"RTN","ORWPCE",49,0)
 Q
"RTN","ORWPCE",50,0)
SK(LST,CLINIC) ;get list of skin test for clinic
"RTN","ORWPCE",51,0)
 D GETLST^IBDF18A(CLINIC,"PX SELECT SKIN TESTS","LST")
"RTN","ORWPCE",52,0)
 Q
"RTN","ORWPCE",53,0)
HF(LST,CLINIC) ;get list of health factors for clinic
"RTN","ORWPCE",54,0)
 D GETLST^IBDF18A(CLINIC,"PX SELECT HEALTH FACTORS","LST")
"RTN","ORWPCE",55,0)
 Q
"RTN","ORWPCE",56,0)
PED(LST,CLINIC) ;get list of education topices for clinic
"RTN","ORWPCE",57,0)
 D GETLST^IBDF18A(CLINIC,"PX SELECT EDUCATION TOPICS","LST")
"RTN","ORWPCE",58,0)
 Q
"RTN","ORWPCE",59,0)
TRT(LST,CLINIC) ;get list of treatments for clinic
"RTN","ORWPCE",60,0)
 D GETLST^IBDF18A(CLINIC,"PX SELECT TREATMENTS","LST")
"RTN","ORWPCE",61,0)
 Q
"RTN","ORWPCE",62,0)
XAM(LST,CLINIC) ;get list of exams for clinic
"RTN","ORWPCE",63,0)
 D GETLST^IBDF18A(CLINIC,"PX SELECT EXAMS","LST")
"RTN","ORWPCE",64,0)
 Q
"RTN","ORWPCE",65,0)
ACTPROB(GLST,DFN,ORDATE) ;get list of patient's active problems
"RTN","ORWPCE",66,0)
 K ^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS")
"RTN","ORWPCE",67,0)
 S:'+$G(ORDATE) ORDATE=DT
"RTN","ORWPCE",68,0)
 D DSELECT^GMPLENFM  ;DBIA 1365
"RTN","ORWPCE",69,0)
 N ORPROB,ORPROBIX,ORPRCNT
"RTN","ORWPCE",70,0)
 S ORPRCNT=0
"RTN","ORWPCE",71,0)
 S ORPROBIX=0
"RTN","ORWPCE",72,0)
 F  S ORPROBIX=$O(^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",ORPROBIX)) Q:'ORPROBIX  D  ;DBIA 1365
"RTN","ORWPCE",73,0)
 . S ORPROB=$P(^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",ORPROBIX),"^",2,3)
"RTN","ORWPCE",74,0)
 . I $E(ORPROB,1)="$" S ORPROB=$E(ORPROB,2,255)
"RTN","ORWPCE",75,0)
 . I '$D(ORPROB(ORPROB)) D
"RTN","ORWPCE",76,0)
 .. S ORPROB(ORPROB)=""
"RTN","ORWPCE",77,0)
 .. S ORPRCNT=ORPRCNT+1
"RTN","ORWPCE",78,0)
 .. S $P(^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",ORPROBIX),"^",2,3)=ORPROB
"RTN","ORWPCE",79,0)
 . E  K ^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",ORPROBIX)
"RTN","ORWPCE",80,0)
 ; DBIA   10082     NAME: ICD DIAGNOSIS FILE
"RTN","ORWPCE",81,0)
 N ORWINDEX,ORITEM
"RTN","ORWPCE",82,0)
 S ORWINDEX=0
"RTN","ORWPCE",83,0)
 F  S ORWINDEX=$O(^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",ORWINDEX)) Q:'ORWINDEX  D:$P(^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",ORWINDEX),"^",1)]""
"RTN","ORWPCE",84,0)
 . S ORITEM=^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",ORWINDEX)
"RTN","ORWPCE",85,0)
 . I '+$$STATCHK^ICDAPIU($P(ORITEM,"^",3),ORDATE) S $P(ORITEM,"^",11)="#"  ;DBIA 3991
"RTN","ORWPCE",86,0)
 . S ^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",ORWINDEX)=ORITEM
"RTN","ORWPCE",87,0)
 S ^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",0)=ORPRCNT
"RTN","ORWPCE",88,0)
 S GLST="^TMP(""IB"","_$J_",""INTERFACES"",""GMP SELECT PATIENT ACTIVE PROBLEMS"")"
"RTN","ORWPCE",89,0)
 Q
"RTN","ORWPCE",90,0)
SCSEL(VAL,DFN,ATM,LOC,VST) ; return SC conditions that may be selected
"RTN","ORWPCE",91,0)
 ; VAL=SCallow^SCdflt;AOallow^AOdflt;IRallow^IRdflt;ECallow^ECdflt;
"RTN","ORWPCE",92,0)
 ;     MSTallow^MSTdflt;HNCallow^HNCdflt;CVAllow^CVDflt;SHADAllow^SHADDflt
"RTN","ORWPCE",93,0)
 N ORX,S S S=";"
"RTN","ORWPCE",94,0)
 D SCCOND^PXUTLSCC(DFN,ATM,LOC,$G(VST),.ORX)
"RTN","ORWPCE",95,0)
 S VAL=$G(ORX("SC"))_S_$G(ORX("AO"))_S_$G(ORX("IR"))_S_$G(ORX("EC"))_S_$G(ORX("MST"))_S_$G(ORX("HNC"))_S_$G(ORX("CV"))_S_$G(ORX("SHAD"))
"RTN","ORWPCE",96,0)
 Q
"RTN","ORWPCE",97,0)
SCDIS(LST,DFN) ; Return service connected % and rated disabilities
"RTN","ORWPCE",98,0)
 N VAEL,VAERR,I,ILST,DIS,SC,X
"RTN","ORWPCE",99,0)
 D ELIG^VADPT
"RTN","ORWPCE",100,0)
 S LST(1)="Service Connected: "_$S(+VAEL(3):$P(VAEL(3),U,2)_"%",1:"NO")
"RTN","ORWPCE",101,0)
 I 'VAEL(4),'$P($G(^DG(391,+VAEL(6),0)),U,2) S LST(2)="NOT A VETERAN." Q
"RTN","ORWPCE",102,0)
 S I=0,ILST=1 F  S I=$O(^DPT(DFN,.372,I)) Q:'I  S X=^(I,0) D
"RTN","ORWPCE",103,0)
 . S DIS=$P($G(^DIC(31,+X,0)),U) Q:DIS=""
"RTN","ORWPCE",104,0)
 . S SC=$S($P(X,U,3):"SC",$P(X,U,3)']"":"not specified",1:"NSC")
"RTN","ORWPCE",105,0)
 . S ILST=ILST+1,LST(ILST)=DIS_" ("_$P(X,U,2)_"% "_SC_")"
"RTN","ORWPCE",106,0)
 I ILST=1 S LST(2)="Rated Disabilities: NONE STATED"
"RTN","ORWPCE",107,0)
 Q
"RTN","ORWPCE",108,0)
CPTREQD(VAL,IEN) ; return 1 in VAL if note still needs a CPT code
"RTN","ORWPCE",109,0)
 S VAL=+$P(^TIU(8925,IEN,0),U,11)
"RTN","ORWPCE",110,0)
 Q
"RTN","ORWPCE",111,0)
NOTEVSTR(VAL,IEN) ; return the VSTR^AUTHOR for a note
"RTN","ORWPCE",112,0)
 N X0,X12,VISIT
"RTN","ORWPCE",113,0)
 S X0=$G(^TIU(8925,+IEN,0)),X12=$G(^(12)),VISIT=$P(X12,U,7)
"RTN","ORWPCE",114,0)
 I +VISIT S VAL=$$VSTRBLD^TIUSRVP(VISIT) I 1
"RTN","ORWPCE",115,0)
 E  S VAL=$P(X12,U,11)_";"_$P(X0,U,7)_";"_$P(X0,U,13)
"RTN","ORWPCE",116,0)
 Q
"RTN","ORWPCE",117,0)
HASVISIT(ORY,IEN,DFN,ORLOC,ORDTE) ;Has visit or is stand alone
"RTN","ORWPCE",118,0)
 N ORVISIT
"RTN","ORWPCE",119,0)
 S ORY=-1
"RTN","ORWPCE",120,0)
 I +$G(IEN)>0 S ORVISIT=+$P($G(^TIU(8925,+IEN,0)),U,3)
"RTN","ORWPCE",121,0)
 I +$G(ORVISIT)'>0 S ORVISIT=$$GETENC^PXAPI(DFN,ORDTE,ORLOC)
"RTN","ORWPCE",122,0)
 I +$G(ORVISIT)>0 S ORY=$$VST2APPT^PXAPI(ORVISIT)
"RTN","ORWPCE",123,0)
 Q
"RTN","ORWPCE",124,0)
DELETE(VAL,VSTR,DFN) ; delete PCE info when deleting a note
"RTN","ORWPCE",125,0)
 N VISIT,ORCOUNT
"RTN","ORWPCE",126,0)
 N ZTIO,ZTRTN,ZTDTH,ZTSAVE,ZTDESC,ZTSYNC,ZTSK
"RTN","ORWPCE",127,0)
 I '$D(^TMP("ORWPCE",$J,VSTR)) S VAL=0 Q  ; no PCE data saved yet
"RTN","ORWPCE",128,0)
 I $P(VSTR,";",3)="H" S VAL=0 Q           ; leave inpatient alone
"RTN","ORWPCE",129,0)
 I $L($T(DOCCNT^TIUSRVLV))=0 S VAL=0 Q    ; leave if no tiu entry point
"RTN","ORWPCE",130,0)
 D DOCCNT^TIUSRVLV(.ORCOUNT,DFN,VSTR)     ; Do not delete if another
"RTN","ORWPCE",131,0)
 I ORCOUNT>0 S VAL=0 Q                    ; title points to visit
"RTN","ORWPCE",132,0)
 S ZTIO="ORW/PXAPI RESOURCE",ZTRTN="DQDEL^ORWPCE1",ZTDTH=$H
"RTN","ORWPCE",133,0)
 S (ZTSAVE("VSTR"),ZTSAVE("DFN"))="",ZTDESC="CPRS Delete Note/PCE"
"RTN","ORWPCE",134,0)
 S ZTSYNC="ORW"_VSTR
"RTN","ORWPCE",135,0)
 D ^%ZTLOAD I '$D(ZTSK) D DQDEL^ORWPCE1
"RTN","ORWPCE",136,0)
 Q
"RTN","ORWPCE",137,0)
SAVE(OK,PCELIST,NOTEIEN,ORLOC) ; save PCE information
"RTN","ORWPCE",138,0)
 N VSTR,GMPLUSER
"RTN","ORWPCE",139,0)
 N ZTIO,ZTRTN,ZTDTH,ZTSAVE,ZTDESC,ZTSYNC,ZTSK
"RTN","ORWPCE",140,0)
 S VSTR=$P(PCELIST(1),U,4) K ^TMP("ORWPCE",$J,VSTR)
"RTN","ORWPCE",141,0)
 M ^TMP("ORWPCE",$J,VSTR)=PCELIST
"RTN","ORWPCE",142,0)
 S GMPLUSER=$$CLINUSER^ORQQPL1(DUZ),NOTEIEN=+$G(NOTEIEN)
"RTN","ORWPCE",143,0)
 S ZTIO="ORW/PXAPI RESOURCE",ZTRTN="DQSAVE^ORWPCE1",ZTDTH=$H
"RTN","ORWPCE",144,0)
 S ZTSAVE("PCELIST(")="",ZTDESC="Data from CPRS to PCE"
"RTN","ORWPCE",145,0)
 S ZTSAVE("GMPLUSER")="",ZTSAVE("NOTEIEN")="",ZTSAVE("DUZ")=""
"RTN","ORWPCE",146,0)
 I VSTR'["E" S ZTSYNC="ORW"_VSTR
"RTN","ORWPCE",147,0)
 S ZTSAVE("ORLOC")=""
"RTN","ORWPCE",148,0)
 D ^%ZTLOAD I '$D(ZTSK) D DQSAVE^ORWPCE1
"RTN","ORWPCE",149,0)
 Q
"RTN","ORWPCE",150,0)
LEX(LST,X,APP,ORDATE)   ; return list after lexicon lookup
"RTN","ORWPCE",151,0)
 N LEX,ILST,I,IEN
"RTN","ORWPCE",152,0)
 S:APP="CPT" APP="CHP" ; LEX PATCH 10
"RTN","ORWPCE",153,0)
 S:'+$G(ORDATE) ORDATE=DT
"RTN","ORWPCE",154,0)
 D CONFIG^LEXSET(APP,APP,ORDATE)  ;DBIA 1609
"RTN","ORWPCE",155,0)
 I APP="CHP" D
"RTN","ORWPCE",156,0)
 . ; Set the filter for CPT only using CS APIs - format is the same as for DIC("S")
"RTN","ORWPCE",157,0)
 . S ^TMP("LEXSCH",$J,"FIL",0)="I $L($$CPTONE^LEXU(+Y,$G(ORDATE)))!($L($$CPCONE^LEXU(+Y,$G(ORDATE))))"  ;DBIA 1609
"RTN","ORWPCE",158,0)
 . ; Set Applications Default Flag (Lexicon can not overwrite filter)
"RTN","ORWPCE",159,0)
 . S ^TMP("LEXSCH",$J,"ADF",0)=1
"RTN","ORWPCE",160,0)
 D LOOK^LEXA(X,APP,1,"",ORDATE)
"RTN","ORWPCE",161,0)
 I '$D(LEX("LIST",1)) S LST(1)="-1^No matches found." Q
"RTN","ORWPCE",162,0)
 S LST(1)=LEX("LIST",1),ILST=1
"RTN","ORWPCE",163,0)
 S (I,IEN)=""
"RTN","ORWPCE",164,0)
 F  S I=$O(^TMP("LEXFND",$J,I)) Q:I=""  D  ;DBIA 2950
"RTN","ORWPCE",165,0)
 .F  S IEN=$O(^TMP("LEXFND",$J,I,IEN)) Q:IEN=""  D
"RTN","ORWPCE",166,0)
 ..S ILST=ILST+1,LST(ILST)=IEN_U_^TMP("LEXFND",$J,I,IEN)
"RTN","ORWPCE",167,0)
 K ^TMP("LEXFND",$J),^TMP("LEXHIT",$J),^TMP("LEXSCH",$J)
"RTN","ORWPCE",168,0)
 Q
"RTN","ORWPCE",169,0)
LEXCODE(VAL,IEN,APP,ORDATE)     ; return code for a lexicon entry
"RTN","ORWPCE",170,0)
 S VAL=""
"RTN","ORWPCE",171,0)
 S:'+$G(ORDATE) ORDATE=DT
"RTN","ORWPCE",172,0)
 I APP="ICD" S VAL=$$ICDONE^LEXU(IEN,ORDATE)
"RTN","ORWPCE",173,0)
 I APP="CPT"!(APP="CHP") S VAL=$$CPTONE^LEXU(IEN,ORDATE) ; LEX PATCH 10
"RTN","ORWPCE",174,0)
 I VAL="",(APP="CHP") S VAL=$$CPCONE^LEXU(IEN,ORDATE) ; LEX PATCH 10
"RTN","ORWPCE",175,0)
 Q
"RTN","ORWPCE",176,0)
ADDRES ; Add the ORW/PXAPI RESOURCE device
"RTN","ORWPCE",177,0)
 N X
"RTN","ORWPCE",178,0)
 S X=$$RES^XUDHSET("ORW/PXAPI RESOURCE",,5,"CPRS to PCE transactions")
"RTN","ORWPCE",179,0)
 Q
"RTN","ORWPCE",180,0)
GETSVC(NEWSVC,SVC,LOC,INP) ; Returns the correct Service Connected Category
"RTN","ORWPCE",181,0)
 N DSS,ORWSVC
"RTN","ORWPCE",182,0)
 S DSS=$P($G(^SC(+LOC,0)),U,7)
"RTN","ORWPCE",183,0)
 Q:'+DSS
"RTN","ORWPCE",184,0)
 M ORWSVC=SVC
"RTN","ORWPCE",185,0)
 S NEWSVC=$$SVC^PXKCO(.ORWSVC,DSS,INP,LOC) ; DBIA #3225
"RTN","ORWPCE",186,0)
 Q
"RTN","ORWPCE1")
0^51^B63376274
"RTN","ORWPCE1",1,0)
ORWPCE1 ;SLC/KCM - PCE Calls from CPRS GUI; 10/26/04 ;4/9/08  07:44
"RTN","ORWPCE1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,116,132,148,187,190,215,243**;Dec 17, 1997;Build 242
"RTN","ORWPCE1",3,0)
 ;
"RTN","ORWPCE1",4,0)
 ; DBIA 1365   DSELECT^GMPLENFM   ^TMP("IB",$J)
"RTN","ORWPCE1",5,0)
 ;
"RTN","ORWPCE1",6,0)
GETVSIT(VSTR,DFN) ; lookup a visit
"RTN","ORWPCE1",7,0)
 N PKG,SRC,ORPXAPI,OK,ORVISIT
"RTN","ORWPCE1",8,0)
 S PKG=$O(^DIC(9.4,"B","ORDER ENTRY/RESULTS REPORTING",0))
"RTN","ORWPCE1",9,0)
 S SRC="TEXT INTEGRATION UTILITIES"
"RTN","ORWPCE1",10,0)
 S ORPXAPI("ENCOUNTER",1,"ENC D/T")=$P(VSTR,";",2)
"RTN","ORWPCE1",11,0)
 S ORPXAPI("ENCOUNTER",1,"PATIENT")=DFN
"RTN","ORWPCE1",12,0)
 S ORPXAPI("ENCOUNTER",1,"HOS LOC")=+VSTR
"RTN","ORWPCE1",13,0)
 S ORPXAPI("ENCOUNTER",1,"SERVICE CATEGORY")=$P(VSTR,";",3)
"RTN","ORWPCE1",14,0)
 S ORPXAPI("ENCOUNTER",1,"ENCOUNTER TYPE")="P"
"RTN","ORWPCE1",15,0)
 S OK=$$DATA2PCE^PXAPI("ORPXAPI",PKG,SRC,.ORVISIT)
"RTN","ORWPCE1",16,0)
 Q ORVISIT
"RTN","ORWPCE1",17,0)
DQDEL ; background call to DATA2PCE and DELVFILE
"RTN","ORWPCE1",18,0)
 N VISIT,VAL
"RTN","ORWPCE1",19,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","ORWPCE1",20,0)
 S VISIT=$$GETVSIT(VSTR,DFN)
"RTN","ORWPCE1",21,0)
 S VAL=$$DELVFILE^PXAPI("ALL",VISIT,"","TEXT INTEGRATION UTILITIES")
"RTN","ORWPCE1",22,0)
 S ZTSTAT=0  ; clear sync flag
"RTN","ORWPCE1",23,0)
 Q
"RTN","ORWPCE1",24,0)
DQSAVE ; Background Call to DATA2PCE
"RTN","ORWPCE1",25,0)
 N PKG,SRC,TYP,CODE,IEN,OK,I,X,ORPXAPI,ORPXDEL
"RTN","ORWPCE1",26,0)
 N CAT,NARR,ROOT,ROOT2,ORAVST
"RTN","ORWPCE1",27,0)
 N PRV,CPT,ICD,IMM,SK,PED,HF,XAM,TRT,MOD,MODCNT,MODIDX,MODS
"RTN","ORWPCE1",28,0)
 N COM,COMMENT,COMMENTS
"RTN","ORWPCE1",29,0)
 N DFN,PROBLEMS,PXAPREDT,ORCPTDEL
"RTN","ORWPCE1",30,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","ORWPCE1",31,0)
 S PKG=$O(^DIC(9.4,"B","ORDER ENTRY/RESULTS REPORTING",0))
"RTN","ORWPCE1",32,0)
 S SRC="TEXT INTEGRATION UTILITIES"
"RTN","ORWPCE1",33,0)
 S (PRV,CPT,ICD,IMM,SK,PED,HF,XAM,TRT)=0
"RTN","ORWPCE1",34,0)
 S I="" F  S I=$O(PCELIST(I)) Q:'I  S X=PCELIST(I) D
"RTN","ORWPCE1",35,0)
 . S X=PCELIST(I),TYP=$P(X,U),CODE=$P(X,U,2),CAT=$P(X,U,3),NARR=$P(X,U,4)
"RTN","ORWPCE1",36,0)
 . I $E(TYP,1,3)="PRV" D  Q
"RTN","ORWPCE1",37,0)
 . . Q:'$L(CODE)
"RTN","ORWPCE1",38,0)
 . . S PRV=PRV+1
"RTN","ORWPCE1",39,0)
 . . S ROOT="ORPXAPI(""PROVIDER"","_PRV_")"
"RTN","ORWPCE1",40,0)
 . . S ROOT2="ORPXDEL(""PROVIDER"","_PRV_")"
"RTN","ORWPCE1",41,0)
 . . I $E(TYP,4)'="-" D
"RTN","ORWPCE1",42,0)
 . . . S @ROOT@("NAME")=CODE
"RTN","ORWPCE1",43,0)
 . . . S @ROOT@("PRIMARY")=$P(X,U,6)
"RTN","ORWPCE1",44,0)
 . . S @ROOT2@("NAME")=CODE
"RTN","ORWPCE1",45,0)
 . . S @ROOT2@("DELETE")=1
"RTN","ORWPCE1",46,0)
 . . S PXAPREDT=1 ;Allow edit of primary flag
"RTN","ORWPCE1",47,0)
 . I TYP="VST" D  Q
"RTN","ORWPCE1",48,0)
 . . S ROOT="ORPXAPI(""ENCOUNTER"",1)"
"RTN","ORWPCE1",49,0)
 . . I CODE="DT" S @ROOT@("ENC D/T")=$P(X,U,3) Q
"RTN","ORWPCE1",50,0)
 . . I CODE="PT" S @ROOT@("PATIENT")=$P(X,U,3),DFN=$P(X,U,3) Q
"RTN","ORWPCE1",51,0)
 . . I CODE="HL" S @ROOT@("HOS LOC")=$P(X,U,3) Q
"RTN","ORWPCE1",52,0)
 . . I CODE="PR" S @ROOT@("PARENT")=$P(X,U,3) Q
"RTN","ORWPCE1",53,0)
 . . ;prevents checkout!
"RTN","ORWPCE1",54,0)
 . . I CODE="VC" S @ROOT@("SERVICE CATEGORY")=$P(X,U,3) Q
"RTN","ORWPCE1",55,0)
 . . I CODE="SC" S @ROOT@("SC")=$P(X,U,3) Q
"RTN","ORWPCE1",56,0)
 . . I CODE="AO" S @ROOT@("AO")=$P(X,U,3) Q
"RTN","ORWPCE1",57,0)
 . . I CODE="IR" S @ROOT@("IR")=$P(X,U,3) Q
"RTN","ORWPCE1",58,0)
 . . I CODE="EC" S @ROOT@("EC")=$P(X,U,3) Q
"RTN","ORWPCE1",59,0)
 . . I CODE="MST" S @ROOT@("MST")=$P(X,U,3) Q
"RTN","ORWPCE1",60,0)
 . . I CODE="HNC" S @ROOT@("HNC")=$P(X,U,3) Q
"RTN","ORWPCE1",61,0)
 . . I CODE="CV" S @ROOT@("CV")=$P(X,U,3) Q
"RTN","ORWPCE1",62,0)
 . . I CODE="SHD" S @ROOT@("SHAD")=$P(X,U,3) Q
"RTN","ORWPCE1",63,0)
 . . I CODE="OL" D  Q
"RTN","ORWPCE1",64,0)
 . . . I +$P(X,U,3) S @ROOT@("INSTITUTION")=$P(X,U,3)
"RTN","ORWPCE1",65,0)
 . . . E  I $P(X,U,4)'="",$P(X,U,4)'="0" D
"RTN","ORWPCE1",66,0)
 . . . . I $$PATCH^XPDUTL("PX*1.0*96") S @ROOT@("OUTSIDE LOCATION")=$P(X,U,4)
"RTN","ORWPCE1",67,0)
 . . . . E  S @ROOT@("COMMENT")="OUTSIDE LOCATION:  "_$P(X,U,4)
"RTN","ORWPCE1",68,0)
 . I $E(TYP,1,3)="CPT" D  Q
"RTN","ORWPCE1",69,0)
 . . Q:'$L(CODE)
"RTN","ORWPCE1",70,0)
 . . S CPT=CPT+1,ROOT="ORPXAPI(""PROCEDURE"","_CPT_")"
"RTN","ORWPCE1",71,0)
 . . S IEN=+$O(^ICPT("B",CODE,0))
"RTN","ORWPCE1",72,0)
 . . S @ROOT@("PROCEDURE")=IEN
"RTN","ORWPCE1",73,0)
 . . I +$P(X,U,9) D
"RTN","ORWPCE1",74,0)
 . . . S MODS=$P(X,U,9),MODCNT=+MODS
"RTN","ORWPCE1",75,0)
 . . . F MODIDX=1:1:MODCNT D
"RTN","ORWPCE1",76,0)
 . . . . S MOD=$P($P(MODS,";",MODIDX+1),"/")
"RTN","ORWPCE1",77,0)
 . . . . S @ROOT@("MODIFIERS",MOD)=""
"RTN","ORWPCE1",78,0)
 . . S:$L(CAT) @ROOT@("CATEGORY")=CAT
"RTN","ORWPCE1",79,0)
 . . S:$L(NARR) @ROOT@("NARRATIVE")=NARR
"RTN","ORWPCE1",80,0)
 . . S:$L($P(X,U,5)) @ROOT@("QTY")=$P(X,U,5)
"RTN","ORWPCE1",81,0)
 . . S:$P(X,U,6)>0 @ROOT@("ENC PROVIDER")=$P(X,U,6)
"RTN","ORWPCE1",82,0)
 . . S:$L($P(X,U,10))>0 COMMENT($P(X,U,10))="PROCEDURE^"_CPT
"RTN","ORWPCE1",83,0)
 . . I $E(TYP,4)="-" S @ROOT@("DELETE")=1,@ROOT@("QTY")=0,ORCPTDEL=CPT
"RTN","ORWPCE1",84,0)
 . I $E(TYP,1,3)="POV" D  Q
"RTN","ORWPCE1",85,0)
 . . Q:'$L(CODE)
"RTN","ORWPCE1",86,0)
 . . S ICD=ICD+1,ROOT="ORPXAPI(""DX/PL"","_ICD_")"
"RTN","ORWPCE1",87,0)
 . . S IEN=+$O(^ICD9("AB",CODE_" ",0))
"RTN","ORWPCE1",88,0)
 . . S @ROOT@("DIAGNOSIS")=IEN
"RTN","ORWPCE1",89,0)
 . . S @ROOT@("PRIMARY")=$P(X,U,5)
"RTN","ORWPCE1",90,0)
 . . S:$L(CAT) @ROOT@("CATEGORY")=CAT
"RTN","ORWPCE1",91,0)
 . . S:$L(NARR) @ROOT@("NARRATIVE")=NARR
"RTN","ORWPCE1",92,0)
 . . S:$P(X,U,6)>0 @ROOT@("ENC PROVIDER")=$P(X,U,6)
"RTN","ORWPCE1",93,0)
 . . I $L($P(X,U,7)),$P(X,U,7)=1 S @ROOT@("PL ADD")=$P(X,U,7),PROBLEMS(ICD)=NARR_U_CODE
"RTN","ORWPCE1",94,0)
 . . S:$L($P(X,U,10))>0 COMMENT($P(X,U,10))="DX/PL^"_ICD
"RTN","ORWPCE1",95,0)
 . . I $E(TYP,4)="-" S @ROOT@("DELETE")=1
"RTN","ORWPCE1",96,0)
 . I $E(TYP,1,3)="IMM" D  Q
"RTN","ORWPCE1",97,0)
 . . Q:'$L(CODE)
"RTN","ORWPCE1",98,0)
 . . S IMM=IMM+1,ROOT="ORPXAPI(""IMMUNIZATION"","_IMM_")"
"RTN","ORWPCE1",99,0)
 . . S @ROOT@("IMMUN")=CODE
"RTN","ORWPCE1",100,0)
 . . S:$L($P(X,U,5)) @ROOT@("SERIES")=$P(X,U,5)
"RTN","ORWPCE1",101,0)
 . . S:$L($P(X,U,5)) @ROOT@("REACTION")=$P(X,U,7)
"RTN","ORWPCE1",102,0)
 . . S:$L($P(X,U,8)) @ROOT@("CONTRAINDICATED")=$P(X,U,8)
"RTN","ORWPCE1",103,0)
 . . S:$L($P(X,U,9)) @ROOT@("REFUSED")=$P(X,U,9)
"RTN","ORWPCE1",104,0)
 . . S:$P(X,U,6)>0 @ROOT@("ENC PROVIDER")=$P(X,U,6)
"RTN","ORWPCE1",105,0)
 . . S:$L($P(X,U,10))>0 COMMENT($P(X,U,10))="IMMUNIZATION^"_IMM
"RTN","ORWPCE1",106,0)
 . . I $E(TYP,4)="-" S @ROOT@("DELETE")=1
"RTN","ORWPCE1",107,0)
 . I $E(TYP,1,2)="SK" D  Q
"RTN","ORWPCE1",108,0)
 . . Q:'$L(CODE)
"RTN","ORWPCE1",109,0)
 . . S SK=SK+1,ROOT="ORPXAPI(""SKIN TEST"","_SK_")"
"RTN","ORWPCE1",110,0)
 . . S @ROOT@("TEST")=CODE
"RTN","ORWPCE1",111,0)
 . . S:$L($P(X,U,5)) @ROOT@("RESULT")=$P(X,U,5)
"RTN","ORWPCE1",112,0)
 . . S:$L($P(X,U,7)) @ROOT@("READING")=$P(X,U,7)
"RTN","ORWPCE1",113,0)
 . . S:$L($P(X,U,8)) @ROOT@("D/T READ")=$P(X,U,8)
"RTN","ORWPCE1",114,0)
 . . S:$L($P(X,U,9)) @ROOT@("EVENT D/T")=$P(X,U,9)
"RTN","ORWPCE1",115,0)
 . . S:$P(X,U,6)>0 @ROOT@("ENC PROVIDER")=$P(X,U,6)
"RTN","ORWPCE1",116,0)
 . . S:$L($P(X,U,10))>0 COMMENT($P(X,U,10))="SKIN TEST^"_SK
"RTN","ORWPCE1",117,0)
 . . I $E(TYP,3)="-" S @ROOT@("DELETE")=1
"RTN","ORWPCE1",118,0)
 . I $E(TYP,1,3)="PED" D  Q
"RTN","ORWPCE1",119,0)
 . . Q:'$L(CODE)
"RTN","ORWPCE1",120,0)
 . . S PED=PED+1,ROOT="ORPXAPI(""PATIENT ED"","_PED_")"
"RTN","ORWPCE1",121,0)
 . . S @ROOT@("TOPIC")=CODE
"RTN","ORWPCE1",122,0)
 . . S:$L($P(X,U,5)) @ROOT@("UNDERSTANDING")=$P(X,U,5)
"RTN","ORWPCE1",123,0)
 . . S:$P(X,U,6)>0 @ROOT@("ENC PROVIDER")=$P(X,U,6)
"RTN","ORWPCE1",124,0)
 . . S:$L($P(X,U,10))>0 COMMENT($P(X,U,10))="PATIENT ED^"_PED
"RTN","ORWPCE1",125,0)
 . . I $E(TYP,4)="-" S @ROOT@("DELETE")=1
"RTN","ORWPCE1",126,0)
 . I $E(TYP,1,2)="HF" D  Q
"RTN","ORWPCE1",127,0)
 . . Q:'$L(CODE)
"RTN","ORWPCE1",128,0)
 . . S HF=HF+1,ROOT="ORPXAPI(""HEALTH FACTOR"","_HF_")"
"RTN","ORWPCE1",129,0)
 . . S @ROOT@("HEALTH FACTOR")=CODE
"RTN","ORWPCE1",130,0)
 . . S:$L($P(X,U,5)) @ROOT@("LEVEL/SEVERITY")=$P(X,U,5)
"RTN","ORWPCE1",131,0)
 . . S:$P(X,U,6)'>0 $P(X,U,6)=$G(ORPXAPI("PROVIDER",1,"NAME"))
"RTN","ORWPCE1",132,0)
 . . S:$P(X,U,6)>0 @ROOT@("ENC PROVIDER")=$P(X,U,6)
"RTN","ORWPCE1",133,0)
 . . S:$L($P(X,U,11)) @ROOT@("EVENT D/T")=$P($P(X,U,11),";",1)
"RTN","ORWPCE1",134,0)
 . . S:$L($P(X,U,11)) SRC=$P($P(X,U,11),";",2)
"RTN","ORWPCE1",135,0)
 . . S:$L($P(X,U,10))>0 COMMENT($P(X,U,10))="HEALTH FACTOR^"_HF
"RTN","ORWPCE1",136,0)
 . . I $E(TYP,3)="-" S @ROOT@("DELETE")=1
"RTN","ORWPCE1",137,0)
 . I $E(TYP,1,3)="XAM" D  Q
"RTN","ORWPCE1",138,0)
 . . Q:'$L(CODE)
"RTN","ORWPCE1",139,0)
 . . S XAM=XAM+1,ROOT="ORPXAPI(""EXAM"","_XAM_")"
"RTN","ORWPCE1",140,0)
 . . S @ROOT@("EXAM")=CODE
"RTN","ORWPCE1",141,0)
 . . S:$L($P(X,U,5)) @ROOT@("RESULT")=$P(X,U,5)
"RTN","ORWPCE1",142,0)
 . . S:$P(X,U,6)>0 @ROOT@("ENC PROVIDER")=$P(X,U,6)
"RTN","ORWPCE1",143,0)
 . . S:$L($P(X,U,10))>0 COMMENT($P(X,U,10))="EXAM^"_XAM
"RTN","ORWPCE1",144,0)
 . . I $E(TYP,4)="-" S @ROOT@("DELETE")=1
"RTN","ORWPCE1",145,0)
 . I $E(TYP,1,3)="TRT" D  Q
"RTN","ORWPCE1",146,0)
 . . Q:'$L(CODE)
"RTN","ORWPCE1",147,0)
 . . S TRT=TRT+1,ROOT="ORPXAPI(""TREATMENT"","_TRT_")"
"RTN","ORWPCE1",148,0)
 . . S @ROOT@("IMMUN")=CODE
"RTN","ORWPCE1",149,0)
 . . S:$L(CAT) @ROOT@("CATEGORY")=CAT
"RTN","ORWPCE1",150,0)
 . . S:$L(NARR) @ROOT@("NARRATIVE")=NARR
"RTN","ORWPCE1",151,0)
 . . S:$L($P(X,U,5)) @ROOT@("QTY")=$P(X,U,5)
"RTN","ORWPCE1",152,0)
 . . S:$P(X,U,6)>0 @ROOT@("ENC PROVIDER")=$P(X,U,6)
"RTN","ORWPCE1",153,0)
 . . S:$L($P(X,U,10))>0 COMMENT($P(X,U,10))="TREATMENT^"_TRT
"RTN","ORWPCE1",154,0)
 . . I $E(TYP,4)="-" S @ROOT@("DELETE")=1,@ROOT@("QTY")=0
"RTN","ORWPCE1",155,0)
 . I $E(TYP,1,3)="COM" D  Q
"RTN","ORWPCE1",156,0)
 . . Q:'$L(CODE)
"RTN","ORWPCE1",157,0)
 . . Q:'$L(CAT)
"RTN","ORWPCE1",158,0)
 . . S COMMENTS(CODE)=$P(X,U,3,999)
"RTN","ORWPCE1",159,0)
 ;Store the comments
"RTN","ORWPCE1",160,0)
 S COM=""
"RTN","ORWPCE1",161,0)
 F  S COM=$O(COMMENT(COM)) Q:COM=""  S:$D(COMMENTS(COM)) ORPXAPI($P(COMMENT(COM),"^",1),$P(COMMENT(COM),"^",2),"COMMENT")=COMMENTS(COM)
"RTN","ORWPCE1",162,0)
 ;
"RTN","ORWPCE1",163,0)
 ;Remove any problems to add that the patient already has as active problems
"RTN","ORWPCE1",164,0)
 I $D(PROBLEMS),$D(DFN) D
"RTN","ORWPCE1",165,0)
 . N ORWPROB,ORPROBIX
"RTN","ORWPCE1",166,0)
 . K ^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS")
"RTN","ORWPCE1",167,0)
 . D DSELECT^GMPLENFM  ;DBIA 1365
"RTN","ORWPCE1",168,0)
 . S ORPROBIX=0
"RTN","ORWPCE1",169,0)
 . F  S ORPROBIX=$O(^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",ORPROBIX)) Q:'ORPROBIX  D  ;DBIA 1365
"RTN","ORWPCE1",170,0)
 .. S ORWPROB=$P(^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",ORPROBIX),"^",2,3)
"RTN","ORWPCE1",171,0)
 .. S ORWPROB($S($E(ORWPROB,1)="$":$E(ORWPROB,2,255),1:ORWPROB))=""
"RTN","ORWPCE1",172,0)
 . K ^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS")
"RTN","ORWPCE1",173,0)
 . Q:'$D(ORWPROB)
"RTN","ORWPCE1",174,0)
 . S ORPROBIX=""
"RTN","ORWPCE1",175,0)
 . F  S ORPROBIX=$O(PROBLEMS(ORPROBIX)) Q:'ORPROBIX  D
"RTN","ORWPCE1",176,0)
 .. S:$D(ORWPROB(PROBLEMS(ORPROBIX))) ORPXAPI("DX/PL",ORPROBIX,"PL ADD")=0
"RTN","ORWPCE1",177,0)
 ;
"RTN","ORWPCE1",178,0)
 I $$MDS(.ORPXAPI,$G(ORLOC)) S ORPXAPI("ENCOUNTER",1,"CHECKOUT D/T")=$$NOW^XLFDT
"RTN","ORWPCE1",179,0)
 S ORPXAPI("ENCOUNTER",1,"ENCOUNTER TYPE")="P"
"RTN","ORWPCE1",180,0)
DATA2PCE ;
"RTN","ORWPCE1",181,0)
 I $G(PXAPREDT)!($G(ORCPTDEL)) D
"RTN","ORWPCE1",182,0)
 . M ORPXDEL("ENCOUNTER")=ORPXAPI("ENCOUNTER")
"RTN","ORWPCE1",183,0)
 . I $G(ORCPTDEL) M ORPXDEL("PROCEDURE",ORCPTDEL)=ORPXAPI("PROCEDURE",ORCPTDEL)
"RTN","ORWPCE1",184,0)
 . S OK=$$DATA2PCE^PXAPI("ORPXDEL",PKG,SRC,.ORAVST)
"RTN","ORWPCE1",185,0)
 S OK=$$DATA2PCE^PXAPI("ORPXAPI",PKG,SRC,.ORAVST)
"RTN","ORWPCE1",186,0)
 I OK>0,+NOTEIEN,+ORAVST D  ; NOTEIEN only set on inpatient encounters
"RTN","ORWPCE1",187,0)
 .N OROK,ORX
"RTN","ORWPCE1",188,0)
 .S ORX(1207)=ORAVST
"RTN","ORWPCE1",189,0)
 .D FILE^TIUSRVP(.OROK,NOTEIEN,.ORX,1)
"RTN","ORWPCE1",190,0)
 S ZTSTAT=0  ; clear sync flag
"RTN","ORWPCE1",191,0)
 Q
"RTN","ORWPCE1",192,0)
 ;
"RTN","ORWPCE1",193,0)
MDS(X,ORLOC) ; return TRUE if checkout is needed
"RTN","ORWPCE1",194,0)
 I $$CHKOUT^ORWPCE2(ORLOC) Q 1
"RTN","ORWPCE1",195,0)
 N I,ORAUTO,OROK
"RTN","ORWPCE1",196,0)
 S (OROK,I)=0
"RTN","ORWPCE1",197,0)
 F  S I=$O(X("DX/PL",I)) Q:'I  D  Q:OROK
"RTN","ORWPCE1",198,0)
 . I $G(X("DX/PL",I,"DIAGNOSIS")) S OROK=1
"RTN","ORWPCE1",199,0)
 I 'OROK D
"RTN","ORWPCE1",200,0)
 .S I=0 F  S I=$O(X("PROCEDURE",I)) Q:'I  D  Q:OROK
"RTN","ORWPCE1",201,0)
 .. I $G(X("PROCEDURE",I,"PROCEDURE")) S OROK=1
"RTN","ORWPCE1",202,0)
 I $D(X("PROVIDER",1,"NAME")) S OROK=1
"RTN","ORWPCE1",203,0)
 Q OROK
"RTN","ORWPCE1",204,0)
NONCOUNT(ORY,ORLOC) ;  Is the location a non-count clinic? (DBIA #964)
"RTN","ORWPCE1",205,0)
 Q:'ORLOC
"RTN","ORWPCE1",206,0)
 S ORY=$S($P($G(^SC(ORLOC,0)),U,17)="Y":1,1:0)
"RTN","ORWPCE1",207,0)
 Q
"RTN","ORWPCE2")
0^211^B49058348
"RTN","ORWPCE2",1,0)
ORWPCE2 ; ISL/JM/RV - wrap calls to PCE ;04/06/2006
"RTN","ORWPCE2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,109,116,173,195,243**;Dec 17, 1997;Build 242
"RTN","ORWPCE2",3,0)
GETSET(ORWLST,ORWFILE,ORWFIELD,ORWNULL) ;gets set of codes 
"RTN","ORWPCE2",4,0)
 ; ORWLST(n)=code^text for code
"RTN","ORWPCE2",5,0)
 N ORWPCE,ORWPCEL,ORWPCEC,ORWPCELO,ORWPCEHI,ORWPCECD,ORWPCET
"RTN","ORWPCE2",6,0)
 S ORWPCELO="abcdefghijklmnopqrstuvwxyz"
"RTN","ORWPCE2",7,0)
 S ORWPCEHI="ABCDEFGHIJKLMNOPQRSTUVWXYZ"
"RTN","ORWPCE2",8,0)
 D FIELD^DID(ORWFILE,ORWFIELD,"","POINTER","ORWPCE","ORWPCE")
"RTN","ORWPCE2",9,0)
 S ORWPCEL=$L(ORWPCE("POINTER"),";")-1
"RTN","ORWPCE2",10,0)
 F ORWPCEC=1:1:ORWPCEL D
"RTN","ORWPCE2",11,0)
 . S ORWPCECD=$P($P(ORWPCE("POINTER"),";",ORWPCEC),":",1)
"RTN","ORWPCE2",12,0)
 . S ORWPCET=$P($P(ORWPCE("POINTER"),";",ORWPCEC),":",2)
"RTN","ORWPCE2",13,0)
 . S ORWLST(ORWPCEC)=ORWPCECD_"^"_$E(ORWPCET)_$TR($E(ORWPCET,2,99),ORWPCEHI,ORWPCELO)
"RTN","ORWPCE2",14,0)
 S:$G(ORWNULL) ORWLST(0)="@^(None selected)"
"RTN","ORWPCE2",15,0)
 Q
"RTN","ORWPCE2",16,0)
 ;
"RTN","ORWPCE2",17,0)
IMMTYPE(ORWLST,ORDT) ;get the list of active immunizations
"RTN","ORWPCE2",18,0)
 N IEN,CNT,BINDEX S (IEN,CNT,BINDEX)=0
"RTN","ORWPCE2",19,0)
 S:'$G(ORDT) ORDT=DT
"RTN","ORWPCE2",20,0)
 F  S BINDEX=$O(^AUTTIMM("B",BINDEX)) Q:BINDEX']""  F  S IEN=$O(^(BINDEX,IEN)) Q:'+IEN  D
"RTN","ORWPCE2",21,0)
 . I $D(^AUTTIMM(IEN,0))#2,+$P(^(0),"^",7)=0 S CNT=CNT+1,ORWLST(CNT)=IEN_"^"_$P(^(0),"^")
"RTN","ORWPCE2",22,0)
 . ;I $D(^AUTTIMM(IEN,0))#2,+$$SCREEN^XTID(9999999.14,,IEN,ORDT)=0 S CNT=CNT+1,ORWLST(CNT)=IEN_"^"_$P(^(0),"^")
"RTN","ORWPCE2",23,0)
 Q
"RTN","ORWPCE2",24,0)
 ;
"RTN","ORWPCE2",25,0)
SKTYPE(ORWLST,ORDT) ;get the list of active skin test 
"RTN","ORWPCE2",26,0)
 N IEN,CNT,BINDEX S (IEN,CNT,BINDEX)=0
"RTN","ORWPCE2",27,0)
 S:'$G(ORDT) ORDT=DT
"RTN","ORWPCE2",28,0)
 F  S BINDEX=$O(^AUTTSK("B",BINDEX)) Q:BINDEX']""  F  S IEN=$O(^(BINDEX,IEN)) Q:'+IEN  D
"RTN","ORWPCE2",29,0)
 . I $D(^AUTTSK(IEN,0))#2,+$P(^(0),"^",3)=0 S CNT=CNT+1,ORWLST(CNT)=IEN_"^"_$P(^(0),"^")
"RTN","ORWPCE2",30,0)
 . ;I $D(^AUTTSK(IEN,0))#2,+$$SCREEN^XTID(9999999.28,,IEN,ORDT)=0 S CNT=CNT+1,ORWLST(CNT)=IEN_"^"_$P(^(0),"^")
"RTN","ORWPCE2",31,0)
 Q
"RTN","ORWPCE2",32,0)
 ;
"RTN","ORWPCE2",33,0)
EDTTYPE(ORWLST) ;get the list of active education topics
"RTN","ORWPCE2",34,0)
 N IEN,CNT,BINDEX S (IEN,CNT,BINDEX)=0
"RTN","ORWPCE2",35,0)
 F  S BINDEX=$O(^AUTTEDT("B",BINDEX)) Q:BINDEX']""  F  S IEN=$O(^(BINDEX,IEN)) Q:'+IEN  I $D(^AUTTEDT(IEN,0))#2,+$P(^(0),"^",3)=0 S CNT=CNT+1,ORWLST(CNT)=IEN_"^"_$P(^(0),"^")
"RTN","ORWPCE2",36,0)
 Q
"RTN","ORWPCE2",37,0)
 ;
"RTN","ORWPCE2",38,0)
HFTYPE(ORWLST,ADDCATS) ;get the list of active  health factors
"RTN","ORWPCE2",39,0)
 N IEN,CNT,BINDEX,REC
"RTN","ORWPCE2",40,0)
 S (IEN,CNT,BINDEX)=0,ADDCATS=+$G(ADDCATS)
"RTN","ORWPCE2",41,0)
 F  S BINDEX=$O(^AUTTHF("B",BINDEX)) Q:BINDEX']""  D
"RTN","ORWPCE2",42,0)
 .F  S IEN=$O(^AUTTHF("B",BINDEX,IEN)) Q:'+IEN  D
"RTN","ORWPCE2",43,0)
 ..S REC=$G(^AUTTHF(IEN,0))
"RTN","ORWPCE2",44,0)
 ..I +$P(REC,U,11) S REC=""
"RTN","ORWPCE2",45,0)
 ..I 'ADDCATS,$P(REC,U,10)="C" S REC=""
"RTN","ORWPCE2",46,0)
 ..I REC'="" D
"RTN","ORWPCE2",47,0)
 ...S CNT=CNT+1,ORWLST(CNT)=IEN_U_$P(REC,U)
"RTN","ORWPCE2",48,0)
 ...I ADDCATS S ORWLST(CNT)=ORWLST(CNT)_U_$P(REC,U,10)_U_$P(REC,U,3)
"RTN","ORWPCE2",49,0)
 Q
"RTN","ORWPCE2",50,0)
 ;
"RTN","ORWPCE2",51,0)
EXAMTYPE(ORWLST) ;get the list of active exams
"RTN","ORWPCE2",52,0)
 N IEN,CNT,BINDEX S (IEN,CNT,BINDEX)=0
"RTN","ORWPCE2",53,0)
 F  S BINDEX=$O(^AUTTEXAM("B",BINDEX)) Q:BINDEX']""  F  S IEN=$O(^(BINDEX,IEN)) Q:'+IEN  I $D(^AUTTEXAM(IEN,0))#2,+$P(^(0),"^",4)=0 S CNT=CNT+1,ORWLST(CNT)=IEN_"^"_$P(^(0),"^")
"RTN","ORWPCE2",54,0)
 Q
"RTN","ORWPCE2",55,0)
 ;
"RTN","ORWPCE2",56,0)
TRTTYPE(ORWLST) ;get the list of active treatments
"RTN","ORWPCE2",57,0)
 N IEN,CNT,BINDEX S (IEN,CNT,BINDEX)=0
"RTN","ORWPCE2",58,0)
 F  S BINDEX=$O(^AUTTTRT("B",BINDEX)) Q:BINDEX']""  F  S IEN=$O(^(BINDEX,IEN)) Q:'+IEN  I $D(^AUTTTRT(IEN,0))#2,+$P(^(0),"^",4)=0 S CNT=CNT+1,ORWLST(CNT)=IEN_"^"_$P(^(0),"^")
"RTN","ORWPCE2",59,0)
 Q
"RTN","ORWPCE2",60,0)
 ;
"RTN","ORWPCE2",61,0)
ACTIVPRV(ORRETURN,ORWPROV,ORWDT) ;get if provider is active or not
"RTN","ORWPCE2",62,0)
 S ORRETURN=$$ACTIVPRV^PXAPI(ORWPROV,ORWDT)
"RTN","ORWPCE2",63,0)
 Q
"RTN","ORWPCE2",64,0)
GETVISIT(VISIT,IEN,DFN,VSITSTR) ;Get the visit IEN
"RTN","ORWPCE2",65,0)
 I +$G(IEN)<1 D  I 1
"RTN","ORWPCE2",66,0)
 .S VISIT=$$GETENC^PXAPI(DFN,$P(VSITSTR,";",2),$P(VSITSTR,";"))
"RTN","ORWPCE2",67,0)
 E  S VISIT=$P(^TIU(8925,IEN,0),U,3)
"RTN","ORWPCE2",68,0)
 Q
"RTN","ORWPCE2",69,0)
GAFOK(ORY) ; Returns true if all supporting MH GAF Code exists
"RTN","ORWPCE2",70,0)
 S ORY=0
"RTN","ORWPCE2",71,0)
 I $T(GAFHX^YSGAFAPI)'="",$T(ENT^YSGAFAP1)'="" S ORY=1
"RTN","ORWPCE2",72,0)
 Q
"RTN","ORWPCE2",73,0)
MHCLINIC(ORY,ORIEN)     ; See if this is a mental health clinic
"RTN","ORWPCE2",74,0)
 I $T(MHCLIN^SDUTL2)="" S ORY=1
"RTN","ORWPCE2",75,0)
 E  S ORY=$$MHCLIN^SDUTL2(ORIEN)
"RTN","ORWPCE2",76,0)
 Q
"RTN","ORWPCE2",77,0)
LOADGAF(ORY,ORINPUT) ; Retrieve GAF scores
"RTN","ORWPCE2",78,0)
 D GAFHX^YSGAFAPI(.ORY,.ORINPUT)
"RTN","ORWPCE2",79,0)
 Q
"RTN","ORWPCE2",80,0)
SAVEGAF(ORY,ORINPUT) ; Save new GAF score
"RTN","ORWPCE2",81,0)
 N ORDATA
"RTN","ORWPCE2",82,0)
 D ENT^YSGAFAP1(.ORDATA,.ORINPUT)
"RTN","ORWPCE2",83,0)
 S ORY=($G(ORDATA(1))="[DATA]")
"RTN","ORWPCE2",84,0)
 Q
"RTN","ORWPCE2",85,0)
FORCE(ORY,USER,LOC) ; Retrieve FORCE GUI PCE Entry for a given User/Location
"RTN","ORWPCE2",86,0)
 N SRV,ORTMP,ORERR
"RTN","ORWPCE2",87,0)
 S USER=$G(USER,DUZ)
"RTN","ORWPCE2",88,0)
 S SRV=$P($G(^VA(200,USER,5)),U)
"RTN","ORWPCE2",89,0)
 D GETLST^XPAR(.ORTMP,"USR^LOC.`"_$G(LOC)_"^SRV.`"_+$G(SRV)_"^DIV^SYS^PKG","ORWPCE FORCE PCE ENTRY","Q",.ORERR)
"RTN","ORWPCE2",90,0)
 S ORY=+$P($G(ORTMP(1)),U,2)
"RTN","ORWPCE2",91,0)
 Q
"RTN","ORWPCE2",92,0)
HASCPT(ORY,ORLIST)        ; Returns true if there are any mapped CPT Codes
"RTN","ORWPCE2",93,0)
 N IEN,IDX,FOUND
"RTN","ORWPCE2",94,0)
 S IDX=0
"RTN","ORWPCE2",95,0)
 F  S IDX=$O(ORLIST(IDX)) Q:'+IDX  D
"RTN","ORWPCE2",96,0)
 . S FOUND=0
"RTN","ORWPCE2",97,0)
 . S IEN=$$FIND1^DIC(811.1,"","QX",ORLIST(IDX))
"RTN","ORWPCE2",98,0)
 . I +IEN S FOUND=+$$GET1^DIQ(811.1,IEN,.05,"I")
"RTN","ORWPCE2",99,0)
 . S ORY(IDX)=ORLIST(IDX)_"="_FOUND
"RTN","ORWPCE2",100,0)
 Q
"RTN","ORWPCE2",101,0)
ASKPCE(ORY,USER,LOC) ; Returns ORWPCE ASK ENCOUNTER UPDATE parameter value
"RTN","ORWPCE2",102,0)
 N SRV,ORTMP,ORERR
"RTN","ORWPCE2",103,0)
 S USER=$G(USER,DUZ)
"RTN","ORWPCE2",104,0)
 S SRV=$P($G(^VA(200,USER,5)),U)
"RTN","ORWPCE2",105,0)
 D GETLST^XPAR(.ORTMP,"USR^LOC.`"_$G(LOC)_"^SRV.`"_+$G(SRV)_"^DIV^SYS^PKG","ORWPCE ASK ENCOUNTER UPDATE","Q",.ORERR)
"RTN","ORWPCE2",106,0)
 S ORY=+$P($G(ORTMP(1)),U,2)
"RTN","ORWPCE2",107,0)
 Q
"RTN","ORWPCE2",108,0)
GAFURL(URL) ;Returns the MH GAF Web Page URL
"RTN","ORWPCE2",109,0)
 S URL=""
"RTN","ORWPCE2",110,0)
 I $T(GAFURL^YTAPI5)'="" D
"RTN","ORWPCE2",111,0)
 .N ORY
"RTN","ORWPCE2",112,0)
 .D GAFURL^YTAPI5(.ORY)
"RTN","ORWPCE2",113,0)
 .I $G(ORY(1))="[DATA]" S URL=$G(ORY(2))
"RTN","ORWPCE2",114,0)
 Q
"RTN","ORWPCE2",115,0)
MHTESTOK(ORY) ; Returns True if all supporting MH Test APIs exist
"RTN","ORWPCE2",116,0)
 D GAFOK(.ORY)
"RTN","ORWPCE2",117,0)
 I +ORY,+$G(DUZ),$T(SAVEIT^YTAPI1)'="",$T(PREVIEW^YTAPI4)'="",$T(SHOWALL^YTAPI3)'="",$T(LISTONE^YTAPI)'="",$T(MHS^PXRMRPCC)'="",$T(MHR^PXRMRPCC)'="",$T(MH^PXRMRPCC)'="" D
"RTN","ORWPCE2",118,0)
 . N SRV
"RTN","ORWPCE2",119,0)
 . S SRV=$P($G(^VA(200,DUZ,5)),U)
"RTN","ORWPCE2",120,0)
 . S ORY=$$GET^XPAR(DUZ_";VA(200,^SRV.`"_+$G(SRV)_"^DIV^SYS","PXRM MENTAL HEALTH ACTIVE",1,"Q")
"RTN","ORWPCE2",121,0)
 . I +ORY S ORY=1
"RTN","ORWPCE2",122,0)
 Q
"RTN","ORWPCE2",123,0)
MHATHRZD(ORY,TEST,USER) ;Indicates that user can score test
"RTN","ORWPCE2",124,0)
 N ORYS,ORANS
"RTN","ORWPCE2",125,0)
 I $T(PRIVL^YTAPI5)="" S ORY=1 Q
"RTN","ORWPCE2",126,0)
 S ORY=0
"RTN","ORWPCE2",127,0)
 S ORYS("CODE")=TEST
"RTN","ORWPCE2",128,0)
 S ORYS("STAFF")=USER
"RTN","ORWPCE2",129,0)
 D PRIVL^YTAPI5(.ORANS,.ORYS)
"RTN","ORWPCE2",130,0)
 I $G(ORANS(1))="[DATA]" S ORY=+$P($G(ORANS(2)),U,1)
"RTN","ORWPCE2",131,0)
 Q
"RTN","ORWPCE2",132,0)
ANYTIME(ORY) ;Returns status of the ORWPCE ANYTIME ENCOUNTERS parameter
"RTN","ORWPCE2",133,0)
 N SRV
"RTN","ORWPCE2",134,0)
 S SRV=$P($G(^VA(200,DUZ,5)),U)
"RTN","ORWPCE2",135,0)
 S ORY=$$GET^XPAR(DUZ_";VA(200,^SRV.`"_+$G(SRV)_"^DIV^SYS","ORWPCE ANYTIME ENCOUNTERS",1,"Q")
"RTN","ORWPCE2",136,0)
 I +ORY S ORY=1
"RTN","ORWPCE2",137,0)
 Q
"RTN","ORWPCE2",138,0)
AUTOVSIT(ORY,LOC) ; Returns TRUE if automatic selection of Visit Type
"RTN","ORWPCE2",139,0)
 N SRV
"RTN","ORWPCE2",140,0)
 S SRV=$P($G(^VA(200,DUZ,5)),U)
"RTN","ORWPCE2",141,0)
 S ORY=$$GET^XPAR(DUZ_";VA(200,^LOC.`"_$G(LOC)_"^SRV.`"_+$G(SRV)_"^DIV^SYS","ORWPCE DISABLE AUTO VISIT TYPE",1,"Q")
"RTN","ORWPCE2",142,0)
 I +ORY S ORY=1
"RTN","ORWPCE2",143,0)
 S ORY='ORY
"RTN","ORWPCE2",144,0)
 Q
"RTN","ORWPCE2",145,0)
DOCHKOUT(ORY,LOC) ; Returns TRUE if automatic selection of Visit Type
"RTN","ORWPCE2",146,0)
 N SRV
"RTN","ORWPCE2",147,0)
 S SRV=$P($G(^VA(200,DUZ,5)),U)
"RTN","ORWPCE2",148,0)
 S ORY=$$GET^XPAR(DUZ_";VA(200,^LOC.`"_$G(LOC)_"^SRV.`"_+$G(SRV)_"^DIV^SYS","ORWPCE DISABLE AUTO CHECKOUT",1,"Q")
"RTN","ORWPCE2",149,0)
 I +ORY S ORY=1
"RTN","ORWPCE2",150,0)
 S ORY='ORY
"RTN","ORWPCE2",151,0)
 Q
"RTN","ORWPCE2",152,0)
CHKOUT(LOC) ; Returns TRUE if automatic selection of Visit Type
"RTN","ORWPCE2",153,0)
 N ORY
"RTN","ORWPCE2",154,0)
 D DOCHKOUT(.ORY,LOC)
"RTN","ORWPCE2",155,0)
 Q ORY
"RTN","ORWPCE2",156,0)
EXCLUDED(ORY,LOC,TYPE) ; Returns list of excluded PCE data elements
"RTN","ORWPCE2",157,0)
 N SRV,PARAM
"RTN","ORWPCE2",158,0)
 S PARAM=$S(TYPE=1:"IMMUNIZATIONS",TYPE=2:"SKIN TESTS",TYPE=3:"PATIENT ED",TYPE=4:"HEALTH FACTORS",TYPE=5:"EXAMS",1:"")
"RTN","ORWPCE2",159,0)
 Q:PARAM=""
"RTN","ORWPCE2",160,0)
 S SRV=$P($G(^VA(200,DUZ,5)),U)
"RTN","ORWPCE2",161,0)
 S PARAM="ORWPCE EXCLUDE "_PARAM
"RTN","ORWPCE2",162,0)
 D GETLST^XPAR(.ORY,"USR^LOC.`"_$G(LOC)_"^SRV.`"_+$G(SRV)_"^DIV^SYS^PKG",PARAM,"Q",.ORERR)
"RTN","ORWPCE2",163,0)
 Q
"RTN","ORWPCE2",164,0)
ISCLINIC(ORY,ORLOC) ; Returns TRUE if location is a clinic
"RTN","ORWPCE2",165,0)
 N ORTYP
"RTN","ORWPCE2",166,0)
 S ORY=0
"RTN","ORWPCE2",167,0)
 S ORTYP=$$GET1^DIQ(44,+ORLOC,2,"I")
"RTN","ORWPCE2",168,0)
 I (ORTYP="C")!(ORTYP="M") S ORY=1
"RTN","ORWPCE2",169,0)
 Q
"RTN","ORWPCE2",170,0)
HNCOK(ORY) ; Returns true if Head and/or Neck Cancer is enabled
"RTN","ORWPCE2",171,0)
 S ORY=0
"RTN","ORWPCE2",172,0)
 I $$PATCH^XPDUTL("DG*5.3*397"),$$PATCH^XPDUTL("SD*5.3*244"),$$PATCH^XPDUTL("PX*1.0*111"),$$PATCH^XPDUTL("IVM*2.0*46") S ORY=1
"RTN","ORWPCE2",173,0)
 Q
"RTN","ORWPCE2",174,0)
 ;
"RTN","ORWPCE2",175,0)
CODACTIV(ORY,ORCODE,ORAPP,ORDATE)       ; Is code active on the given date?
"RTN","ORWPCE2",176,0)
 ; Remote procedure:  ORWPCE ACTIVE CODE
"RTN","ORWPCE2",177,0)
 ; ORCODE = ICD or CPT code to be checked
"RTN","ORWPCE2",178,0)
 ; ORAPP  = "ICD" or "CHP"
"RTN","ORWPCE2",179,0)
 ; ORDATE = Date to be checked (defaults to current date)
"RTN","ORWPCE2",180,0)
 S:'+$G(ORDATE) ORDATE=DT
"RTN","ORWPCE2",181,0)
 S ORY=1
"RTN","ORWPCE2",182,0)
 I ORAPP="ICD" D
"RTN","ORWPCE2",183,0)
 . S ORY=+$$STATCHK^ICDAPIU(ORCODE,ORDATE)
"RTN","ORWPCE2",184,0)
 E  I ORAPP="CHP" D
"RTN","ORWPCE2",185,0)
 . S ORY=+$$STATCHK^ICPTAPIU(ORCODE,ORDATE)
"RTN","ORWPCE2",186,0)
 Q
"RTN","ORWPCE2",187,0)
ICDACTIV(ORCODE,ORDATE) ; Check for active ICD code
"RTN","ORWPCE2",188,0)
 D CODACTIV(.ORY,ORCODE,"ICD",$G(ORDATE))
"RTN","ORWPCE2",189,0)
 Q +ORY
"RTN","ORWPCE2",190,0)
CPTACTIV(ORCODE,ORDATE) ; Check for active CPT code
"RTN","ORWPCE2",191,0)
 D CODACTIV(.ORY,ORCODE,"CHP",$G(ORDATE))
"RTN","ORWPCE2",192,0)
 Q +ORY
"RTN","ORWPCE2",193,0)
CXNOSHOW(ORY,ORDOCIEN) ; Should workload requirement be skipped for this note's visit?
"RTN","ORWPCE2",194,0)
 ; RETURN VALUE:  0=SKIP ALL GUI WORKLOAD REQUIREMENTS
"RTN","ORWPCE2",195,0)
 ;                1=CONTINUE WITH OTHER GUI WORKLOAD LOGIC
"RTN","ORWPCE2",196,0)
 N ORTIU
"RTN","ORWPCE2",197,0)
 D DOCPARM^TIUSRVP1(.ORTIU,ORDOCIEN)          ; DBIA #4331
"RTN","ORWPCE2",198,0)
 S ORY=+$$CHKWKL^TIUPXAP2(ORDOCIEN,ORTIU(0))  ; DBIA #4332
"RTN","ORWPCE2",199,0)
 Q
"RTN","ORWPS")
0^21^B62358507
"RTN","ORWPS",1,0)
ORWPS ; SLC/KCM/JLI/REV/CLA - Meds Tab; 02/11/2008
"RTN","ORWPS",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,116,132,141,173,203,190,195,265,275,243**;Dec 17, 1997;Build 242
"RTN","ORWPS",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ORWPS",4,0)
COVER(LST,DFN) ; retrieve meds for cover sheet
"RTN","ORWPS",5,0)
 K ^TMP("PS",$J)
"RTN","ORWPS",6,0)
 D OCL^PSOORRL(DFN,"","")
"RTN","ORWPS",7,0)
 N ILST,ITMP,X S ILST=0
"RTN","ORWPS",8,0)
 S ITMP="" F  S ITMP=$O(^TMP("PS",$J,ITMP)) Q:'ITMP  D
"RTN","ORWPS",9,0)
 . S X=^TMP("PS",$J,ITMP,0)
"RTN","ORWPS",10,0)
 . I '$L($P(X,U,2)) S X="??"  ; show something if drug empty
"RTN","ORWPS",11,0)
 . I $D(^TMP("PS",$J,ITMP,"CLINIC",0)) S LST($$NXT)=$P(X,U,1,2)_U_$P(X,U,8,9)_U_"C"
"RTN","ORWPS",12,0)
 . E  S LST($$NXT)=$P(X,U,1,2)_U_$P(X,U,8,9)
"RTN","ORWPS",13,0)
 K ^TMP("PS",$J)
"RTN","ORWPS",14,0)
 Q
"RTN","ORWPS",15,0)
DT(X) ; -- Returns FM date for X
"RTN","ORWPS",16,0)
 N Y,%DT S %DT="T",Y="" D:X'="" ^%DT
"RTN","ORWPS",17,0)
 Q Y
"RTN","ORWPS",18,0)
 ;
"RTN","ORWPS",19,0)
ACTIVE(LST,DFN,USER,VIEW,UPDATE) ; retrieve active inpatient & outpatient meds
"RTN","ORWPS",20,0)
 K ^TMP("PS",$J)
"RTN","ORWPS",21,0)
 K ^TMP("ORACT",$J)
"RTN","ORWPS",22,0)
 N BEG,END,ERROR,CTX,STVIEW
"RTN","ORWPS",23,0)
 S (BEG,END,CTX)=""
"RTN","ORWPS",24,0)
 S VIEW=+$G(VIEW)
"RTN","ORWPS",25,0)
 S UPDATE=+$G(UPDATE)
"RTN","ORWPS",26,0)
 I VIEW=0,UPDATE=0 S VIEW=1
"RTN","ORWPS",27,0)
 S CTX=$$GET^XPAR("ALL","ORCH CONTEXT MEDS")
"RTN","ORWPS",28,0)
 I CTX=";" D DEL^XPAR("USR.`"_DUZ,"ORCH CONTEXT MEDS")
"RTN","ORWPS",29,0)
 S CTX=$$GET^XPAR("ALL","ORCH CONTEXT MEDS")
"RTN","ORWPS",30,0)
 S BEG=$$DT($P(CTX,";")),END=$$DT($P(CTX,";",2))
"RTN","ORWPS",31,0)
 I +$G(USER)=0 S USER=DUZ
"RTN","ORWPS",32,0)
 I UPDATE=1 D
"RTN","ORWPS",33,0)
 .S STVIEW=$$GET^XPAR($G(USER)_";VA(200,","OR MEDS TAB SORT",1,"I")
"RTN","ORWPS",34,0)
 .I VIEW>0,+STVIEW'=VIEW D PUT^XPAR(DUZ_";VA(200,","OR MEDS TAB SORT",,VIEW,.ERROR) S STVIEW=VIEW
"RTN","ORWPS",35,0)
 .I VIEW=0,+STVIEW=0 D PUT^XPAR(DUZ_";VA(200,","OR MEDS TAB SORT",,"1",.ERROR) S STVIEW=1,VIEW=1
"RTN","ORWPS",36,0)
 .I VIEW=0,+STVIEW'=VIEW S VIEW=+STVIEW
"RTN","ORWPS",37,0)
 .S LST(0)=STVIEW
"RTN","ORWPS",38,0)
 D OCL^PSOORRL(DFN,BEG,END,VIEW)
"RTN","ORWPS",39,0)
 N ITMP,FIELDS,INSTRUCT,COMMENTS,REASON,NVSDT,TYPE,ILST,J S ILST=0
"RTN","ORWPS",40,0)
 S ITMP="" F  S ITMP=$O(^TMP("PS",$J,ITMP)) Q:'ITMP  D
"RTN","ORWPS",41,0)
 . K INSTRUCT,COMMENTS,REASON
"RTN","ORWPS",42,0)
 . K ^TMP("ORACT",$J,"COMMENTS")
"RTN","ORWPS",43,0)
 . S COMMENTS="^TMP(""ORACT"",$J,""COMMENTS"")"
"RTN","ORWPS",44,0)
 . S (INSTRUCT,@COMMENTS)="",FIELDS=^TMP("PS",$J,ITMP,0)
"RTN","ORWPS",45,0)
 . I +$P(FIELDS,"^",8),$D(^OR(100,+$P(FIELDS,"^",8),8,"C","XX")) D
"RTN","ORWPS",46,0)
 . . S $P(^TMP("PS",$J,ITMP,0),"^",2)="*"_$P(^TMP("PS",$J,ITMP,0),"^",2) ;dan testing
"RTN","ORWPS",47,0)
 . S TYPE=$S($P($P(FIELDS,U),";",2)="O":"OP",1:"UD")
"RTN","ORWPS",48,0)
 . I $D(^TMP("PS",$J,ITMP,"CLINIC",0)) S TYPE="CP"
"RTN","ORWPS",49,0)
 . N LOC,LOCEX S (LOC,LOCEX)=""
"RTN","ORWPS",50,0)
 . I TYPE="CP" S LOC=$G(^TMP("PS",$J,ITMP,"CLINIC",0))
"RTN","ORWPS",51,0)
 . S:LOC LOCEX=$P($G(^SC(+LOC,0)),U)_":"_+LOC ;IMO NEW
"RTN","ORWPS",52,0)
 . I TYPE="OP",$P(FIELDS,";")["N" S TYPE="NV"          ;non-VA med
"RTN","ORWPS",53,0)
 . I $O(^TMP("PS",$J,ITMP,"A",0))>0 S TYPE="IV"
"RTN","ORWPS",54,0)
 . I $O(^TMP("PS",$J,ITMP,"B",0))>0 S TYPE="IV"
"RTN","ORWPS",55,0)
 . I (TYPE="UD")!(TYPE="CP") D UDINST(.INSTRUCT,ITMP)
"RTN","ORWPS",56,0)
 . I TYPE="OP" D OPINST(.INSTRUCT,ITMP)
"RTN","ORWPS",57,0)
 . I TYPE="IV" D IVINST(.INSTRUCT,ITMP)
"RTN","ORWPS",58,0)
 . I TYPE="NV" D NVINST(.INSTRUCT,ITMP),NVREASON(.REASON,.NVSDT,ITMP)
"RTN","ORWPS",59,0)
 . I (TYPE="UD")!(TYPE="IV")!(TYPE="NV")!(TYPE="CP") D SETMULT(COMMENTS,ITMP,"SIO")
"RTN","ORWPS",60,0)
 . M COMMENTS=@COMMENTS
"RTN","ORWPS",61,0)
 . I $D(COMMENTS(1)) S COMMENTS(1)="\"_COMMENTS(1)
"RTN","ORWPS",62,0)
 . S:TYPE="NV" $P(FIELDS,U,4)=$G(NVSDT)
"RTN","ORWPS",63,0)
 . I LOC S LST($$NXT)="~CP:"_LOCEX_U_FIELDS
"RTN","ORWPS",64,0)
 . E  S LST($$NXT)="~"_TYPE_U_FIELDS
"RTN","ORWPS",65,0)
 . S J=0 F  S J=$O(INSTRUCT(J)) Q:'J  S LST($$NXT)=INSTRUCT(J)
"RTN","ORWPS",66,0)
 . S J=0 F  S J=$O(COMMENTS(J)) Q:'J  S LST($$NXT)="t"_COMMENTS(J)
"RTN","ORWPS",67,0)
 . S J=0 F  S J=$O(REASON(J)) Q:'J  S LST($$NXT)="t"_REASON(J)
"RTN","ORWPS",68,0)
 K ^TMP("PS",$J)
"RTN","ORWPS",69,0)
 K ^TMP("ORACT",$J)
"RTN","ORWPS",70,0)
 Q
"RTN","ORWPS",71,0)
NXT() ; increment ILST
"RTN","ORWPS",72,0)
 S ILST=ILST+1
"RTN","ORWPS",73,0)
 Q ILST
"RTN","ORWPS",74,0)
 ;
"RTN","ORWPS",75,0)
UDINST(Y,INDEX) ; assembles instructions for a unit dose order
"RTN","ORWPS",76,0)
 N I,X,RST
"RTN","ORWPS",77,0)
 S X=^TMP("PS",$J,INDEX,0)
"RTN","ORWPS",78,0)
 S RST="^TMP(""ORACT"",$J,""INSTRUCT"")"
"RTN","ORWPS",79,0)
 S @RST@(1)=" "_$P(X,U,2),@RST=1
"RTN","ORWPS",80,0)
 S X=$S($L($P(X,U,6)):$P(X,U,6),1:$P(X,U,7))
"RTN","ORWPS",81,0)
 I $L(X) S @RST=2,@RST@(2)=X
"RTN","ORWPS",82,0)
 E  S @RST=1 D SETMULT(.RST,INDEX,"SIG")
"RTN","ORWPS",83,0)
 S @RST@(2)="\Give: "_$G(@RST@(2)),@RST=$G(@RST,2)
"RTN","ORWPS",84,0)
 D SETMULT(RST,INDEX,"MDR"),SETMULT(RST,INDEX,"SCH")
"RTN","ORWPS",85,0)
 F I=3:1:@RST S @RST@(I)=" "_@RST@(I)
"RTN","ORWPS",86,0)
 M Y=@RST K @RST
"RTN","ORWPS",87,0)
 Q
"RTN","ORWPS",88,0)
OPINST(Y,INDEX) ; assembles instructions for an outpatient prescription
"RTN","ORWPS",89,0)
 N I,X,RST
"RTN","ORWPS",90,0)
 S X=^TMP("PS",$J,INDEX,0)
"RTN","ORWPS",91,0)
 S RST="^TMP(""ORACT"",$J,""INSTRUCT"")"
"RTN","ORWPS",92,0)
 S @RST@(1)=" "_$P(X,U,2),@RST=1
"RTN","ORWPS",93,0)
 I $L($P(X,U,12)) S @RST@(1)=@RST@(1)_"  Qty: "_$P(X,U,12)
"RTN","ORWPS",94,0)
 I $L($P(X,U,11)) S @RST@(1)=@RST@(1)_" for "_$P(X,U,11)_" days"
"RTN","ORWPS",95,0)
 D SETMULT(RST,INDEX,"SIG")
"RTN","ORWPS",96,0)
 I @RST=1 D
"RTN","ORWPS",97,0)
 . D SETMULT(RST,INDEX,"SIO")
"RTN","ORWPS",98,0)
 . D SETMULT(RST,INDEX,"MDR")
"RTN","ORWPS",99,0)
 . D SETMULT(RST,INDEX,"SCH")
"RTN","ORWPS",100,0)
 S @RST@(2)="\ Sig: "_$G(@RST@(2))
"RTN","ORWPS",101,0)
 F I=3:1:@RST S @RST@(I)=" "_@RST@(I)
"RTN","ORWPS",102,0)
 M Y=@RST K @RST
"RTN","ORWPS",103,0)
 Q
"RTN","ORWPS",104,0)
IVINST(Y,INDEX) ; assembles instructions for an IV order
"RTN","ORWPS",105,0)
 N SOLN1,I,RST,IVDUR,CNT
"RTN","ORWPS",106,0)
 S IVDUR=""
"RTN","ORWPS",107,0)
 S RST="^TMP(""ORACT"",$J,""INSTRUCT"")"
"RTN","ORWPS",108,0)
 S @RST=0 D SETMULT(RST,INDEX,"A") S SOLN1=@RST+1
"RTN","ORWPS",109,0)
 D SETMULT(RST,INDEX,"B")
"RTN","ORWPS",110,0)
 I $D(@RST@(SOLN1)),$L($P(FIELDS,U,2)) S @RST@(SOLN1)="in "_@RST@(SOLN1)
"RTN","ORWPS",111,0)
 S SOLN1=@RST+1
"RTN","ORWPS",112,0)
 S CNT=@RST
"RTN","ORWPS",113,0)
 D SETMULT(RST,INDEX,"MDR")
"RTN","ORWPS",114,0)
 I $D(^TMP("PS",$J,INDEX,"SCH",1,0)) S @RST@(@RST)=@RST@(@RST)_" "_^TMP("PS",$J,INDEX,"SCH",1,0)
"RTN","ORWPS",115,0)
 F I=1:1:@RST S @RST@(I)="\"_$TR(@RST@(I),U," ")
"RTN","ORWPS",116,0)
 I $D(@RST@(1)) S @RST@(1)=" "_$E(@RST@(1),2,999)
"RTN","ORWPS",117,0)
 S @RST@(@RST)=@RST@(@RST)_" "_$P(^TMP("PS",$J,INDEX,0),U,3)
"RTN","ORWPS",118,0)
 S:$D(^TMP("PS",$J,INDEX,"IVLIM",0)) IVDUR=$G(^TMP("PS",$J,INDEX,"IVLIM",0))
"RTN","ORWPS",119,0)
 I $L(IVDUR) D
"RTN","ORWPS",120,0)
 . N DURU,DURV S DURU="",DURV=0
"RTN","ORWPS",121,0)
 . I IVDUR["dose" D  Q
"RTN","ORWPS",122,0)
 . .S DURV=$P(IVDUR,"doses",2)
"RTN","ORWPS",123,0)
 . .S IVDUR="for a total of "_+DURV_$S(+DURV=1:"dose",+DURV>1:" doses",1:" dose")
"RTN","ORWPS",124,0)
 . .S @RST@(@RST)=@RST@(@RST)_" "_IVDUR
"RTN","ORWPS",125,0)
 . S DURU=$E(IVDUR,1),DURV=$E(IVDUR,2,$L(IVDUR))
"RTN","ORWPS",126,0)
 . I (DURU="D")!(DURU="d") S IVDUR="for "_+DURV_$S(+DURV=1:" day",+DURV>1:" days",1:" day")
"RTN","ORWPS",127,0)
 . I (DURU="H")!(DURU="h") S IVDUR="for "_+DURV_$S(+DURV=1:" hours",+DURV>1:" hours",1:" hour")
"RTN","ORWPS",128,0)
 . I (DURU="M")!(DURU="m") S IVDUR="with total volume "_+DURV_" ml"
"RTN","ORWPS",129,0)
 . I (DURU="L")!(DURU="l") S IVDUR="with total volume "_+DURV_" L"
"RTN","ORWPS",130,0)
 . S @RST@(@RST)=@RST@(@RST)_" "_IVDUR
"RTN","ORWPS",131,0)
 M Y=@RST K @RST
"RTN","ORWPS",132,0)
 Q
"RTN","ORWPS",133,0)
NVINST(Y,INDEX) ; assembles instructions for a non-VA med
"RTN","ORWPS",134,0)
 N I,X,RST
"RTN","ORWPS",135,0)
 S X=^TMP("PS",$J,INDEX,0)
"RTN","ORWPS",136,0)
 S RST="^TMP(""ORACT"",$J,""INSTRUCT"")"
"RTN","ORWPS",137,0)
 S @RST@(1)=" "_$P(X,U,2),@RST=1
"RTN","ORWPS",138,0)
 D SETMULT(RST,INDEX,"SIG")
"RTN","ORWPS",139,0)
 I @RST=1 D
"RTN","ORWPS",140,0)
 . D SETMULT(RST,INDEX,"SIO")
"RTN","ORWPS",141,0)
 . D SETMULT(RST,INDEX,"MDR")
"RTN","ORWPS",142,0)
 . D SETMULT(RST,INDEX,"SCH")
"RTN","ORWPS",143,0)
 S @RST@(2)="\ "_$G(@RST@(2))
"RTN","ORWPS",144,0)
 F I=3:1:@RST S @RST@(I)=" "_@RST@(I)
"RTN","ORWPS",145,0)
 M Y=@RST K @RST
"RTN","ORWPS",146,0)
 Q
"RTN","ORWPS",147,0)
NVREASON(ORR,NVSDT,INDEX) ; assembles start date and reasons for a non-VA med
"RTN","ORWPS",148,0)
 N ORI,J,X,ORN,ORA
"RTN","ORWPS",149,0)
 S ORI=0 K ORR
"RTN","ORWPS",150,0)
 S X=^TMP("PS",$J,INDEX,0)
"RTN","ORWPS",151,0)
 S ORN=+$P(X,U,8)
"RTN","ORWPS",152,0)
 I $D(^OR(100,ORN,0)) D
"RTN","ORWPS",153,0)
 .S NVSDT=$P(^OR(100,ORN,0),U,8)
"RTN","ORWPS",154,0)
 .D WPVAL^ORWDXR(.ORA,ORN,"STATEMENTS") I $D(ORA) D
"RTN","ORWPS",155,0)
 ..S J=0 F  S J=$O(ORA(J)) Q:J<1  S ORI=ORI+1,ORR(ORI)=ORA(J)
"RTN","ORWPS",156,0)
 Q
"RTN","ORWPS",157,0)
SETMULT(Y,INDEX,SUB) ; appends the multiple at the subscript to Y
"RTN","ORWPS",158,0)
 N I,X,J
"RTN","ORWPS",159,0)
 S J=$G(@Y)
"RTN","ORWPS",160,0)
 S I=0 F  S I=$O(^TMP("PS",$J,INDEX,SUB,I)) Q:'I  S X=$G(^(I,0)) D
"RTN","ORWPS",161,0)
 . I SUB="B",$L($P(X,U,3)) S X=$P(X,U)_" "_$P(X,U,3)_"^"_$P(X,U,2)
"RTN","ORWPS",162,0)
 . S J=J+1,@Y@(J)=X
"RTN","ORWPS",163,0)
 S @Y=J
"RTN","ORWPS",164,0)
 Q
"RTN","ORWPS",165,0)
COMPRESS(Y) ; concatenate Y subscripts into smallest possible number
"RTN","ORWPS",166,0)
 N I,J,X S J=1,X(J)=""
"RTN","ORWPS",167,0)
 S I=0 F  S I=$O(Y(I)) Q:'I  D
"RTN","ORWPS",168,0)
 . I ($L(Y(I))+$L(X(J)))>245 S J=J+1,X(J)=""
"RTN","ORWPS",169,0)
 . S X(J)=X(J)_$S($L(X(J)):" ",1:"")_Y(I)
"RTN","ORWPS",170,0)
 K Y M Y=X
"RTN","ORWPS",171,0)
 Q
"RTN","ORWPS",172,0)
DETAIL(ROOT,DFN,ID) ; -- show details for a med order
"RTN","ORWPS",173,0)
 K ^TMP("ORXPND",$J)
"RTN","ORWPS",174,0)
 N LCNT,ORVP
"RTN","ORWPS",175,0)
 S LCNT=0,ORVP=DFN_";DPT("
"RTN","ORWPS",176,0)
 D MEDS^ORCXPND1
"RTN","ORWPS",177,0)
 S ROOT=$NA(^TMP("ORXPND",$J))
"RTN","ORWPS",178,0)
 Q
"RTN","ORWPS",179,0)
MEDHIST(ORROOT,DFN,ORIFN) ; -- show admin history for a med  (RV)
"RTN","ORWPS",180,0)
 N ORPSID,HPIV,ISIV,CKPKG,ORPHMID
"RTN","ORWPS",181,0)
 N CLINDISP,IVDIAL
"RTN","ORWPS",182,0)
 S ORPSID=+$P($$OI^ORX8(ORIFN),U,3),ISIV=0,HPIV=0
"RTN","ORWPS",183,0)
 S ORROOT=$NA(^TMP("ORHIST",$J)) K @ORROOT
"RTN","ORWPS",184,0)
 S ORPHMID=$G(^OR(100,+ORIFN,4))  ;Pharmacy order number
"RTN","ORWPS",185,0)
 S ISIV=$O(^ORD(100.98,"B","IV RX",ISIV))
"RTN","ORWPS",186,0)
 S HPIV=$O(^ORD(100.98,"B","TPN",HPIV))
"RTN","ORWPS",187,0)
 S CLINDISP=$O(^ORD(100.98,"B","C RX",""))
"RTN","ORWPS",188,0)
 S IVDIAL=$O(^ORD(101.41,"B","PSJI OR PAT FLUID OE",""))
"RTN","ORWPS",189,0)
 S CKPKG=$$PATCH^XPDUTL("PSB*2.0*19")
"RTN","ORWPS",190,0)
 ;if the order is pending or the order has no pharmacy # 
"RTN","ORWPS",191,0)
 ;or the order is not in the Display Group IV MEDICATION
"RTN","ORWPS",192,0)
 ; then use the Orderable item number to get the MAH.
"RTN","ORWPS",193,0)
 I (ORPHMID["P")!(ORPHMID="") D  Q
"RTN","ORWPS",194,0)
 . I '$L($T(HISTORY^PSBMLHS)) D  Q
"RTN","ORWPS",195,0)
 . . S @ORROOT@(0)="This report is only available using BCMA version 2.0."
"RTN","ORWPS",196,0)
 . D HISTORY^PSBMLHS(.ORROOT,DFN,ORPSID)  ; DBIA #3459 for BCMA v2.0
"RTN","ORWPS",197,0)
 ; If the order has a Display Group of IV MEDICATION the use the Pharmacy order number to get the MA
"RTN","ORWPS",198,0)
 I ($P($G(^OR(100,+ORIFN,0)),U,11)=ISIV)!($P($G(^OR(100,+ORIFN,0)),U,11)=HPIV)!(($P($G(^OR(100,+ORIFN,0)),U,11)=CLINDISP)&(+$P($G(^OR(100,+ORIFN,0)),U,5)=IVDIAL)) D  Q
"RTN","ORWPS",199,0)
 . I 'CKPKG S @ORROOT@(0)="Medication Administration History is not available at this time for IV fluids."
"RTN","ORWPS",200,0)
 . I CKPKG D
"RTN","ORWPS",201,0)
 . . D RPC^PSBO(.ORROOT,"PM",DFN,"","","","","","","","","",ORPHMID)  ;DBIA #3955
"RTN","ORWPS",202,0)
 . . I '$D(@ORROOT) S @ORROOT@(0)="No Medication Administration History found for the IV order."
"RTN","ORWPS",203,0)
 I '$L($T(HISTORY^PSBMLHS)) D  Q
"RTN","ORWPS",204,0)
 . S @ORROOT@(0)="This report is only available using BCMA version 2.0."
"RTN","ORWPS",205,0)
 D HISTORY^PSBMLHS(.ORROOT,DFN,ORPSID)  ; DBIA #3459 for BCMA v2.0
"RTN","ORWPS",206,0)
 Q
"RTN","ORWPS",207,0)
 ;
"RTN","ORWPS",208,0)
REASON(ORY) ; -- Return Non-VA Med Statement/Reasons
"RTN","ORWPS",209,0)
 N ORE
"RTN","ORWPS",210,0)
 D GETLST^XPAR(.ORY,"ALL","ORWD NONVA REASON","E")
"RTN","ORWPS",211,0)
 Q
"RTN","ORWPT")
0^163^B59655732
"RTN","ORWPT",1,0)
ORWPT ; SLC/KCM/REV - Patient Lookup Functions ;3/18/05  10:50
"RTN","ORWPT",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,132,149,206,187,190,215,243**;Dec 17, 1997;Build 242
"RTN","ORWPT",3,0)
 ;
"RTN","ORWPT",4,0)
 ; Ref. to ^UTILITY via IA 10061
"RTN","ORWPT",5,0)
 ; 
"RTN","ORWPT",6,0)
IDINFO(REC,DFN) ; Return identifying information for a patient
"RTN","ORWPT",7,0)
 ; PID^DOB^SEX^VET^SC%^WARD^RM-BED^NAME
"RTN","ORWPT",8,0)
 N X0,X1,X101,X3,XV  ; name/dob/sex/ssn, ward, room-bed, sc%, vet
"RTN","ORWPT",9,0)
 S X0=$G(^DPT(DFN,0)),X1=$G(^(.1)),X101=$G(^(.101)),X3=$G(^(.3)),XV=$G(^("VET"))
"RTN","ORWPT",10,0)
 S REC=$$SSN^DPTLK1(DFN)_U_$$DOB^DPTLK1(DFN,2)_U_$P(X0,U,2)_U_$P(XV,U)_U_$P(X3,U,2)_U_$P(X1,U)_U_$P(X101,U)_U_$P(X0,U) ;DG249
"RTN","ORWPT",11,0)
 Q
"RTN","ORWPT",12,0)
PTINQ(REF,DFN) ; Return formatted pt inquiry report
"RTN","ORWPT",13,0)
 K ^TMP("ORDATA",$J,1)
"RTN","ORWPT",14,0)
 D DGINQ^ORCXPND1(DFN)
"RTN","ORWPT",15,0)
 S REF=$NA(^TMP("ORDATA",$J,1))
"RTN","ORWPT",16,0)
 Q
"RTN","ORWPT",17,0)
SCDIS(LST,DFN) ; Return service connected % and rated disabilities
"RTN","ORWPT",18,0)
 N VAEL,VAERR,I,ILST,DIS,SC,X
"RTN","ORWPT",19,0)
 D ELIG^VADPT
"RTN","ORWPT",20,0)
 S LST(1)="Service Connected: "_$S(+VAEL(3):$P(VAEL(3),U,2)_"%",1:"NO")
"RTN","ORWPT",21,0)
 I 'VAEL(4),'$P($G(^DG(391,+VAEL(6),0)),U,2) S LST(2)="NOT A VETERAN." Q
"RTN","ORWPT",22,0)
 S I=0,ILST=1 F  S I=$O(^DPT(DFN,.372,I)) Q:'I  S X=^(I,0) D
"RTN","ORWPT",23,0)
 . S DIS=$P($G(^DIC(31,+X,0)),U) Q:DIS=""
"RTN","ORWPT",24,0)
 . S SC=$S($P(X,U,3):"SC",$P(X,U,3)']"":"not specified",1:"NSC")
"RTN","ORWPT",25,0)
 . S ILST=ILST+1,LST(ILST)=DIS_" ("_$P(X,U,2)_"% "_SC_")"
"RTN","ORWPT",26,0)
 I ILST=1 S LST(2)="Rated Disabilities: NONE STATED"
"RTN","ORWPT",27,0)
 Q
"RTN","ORWPT",28,0)
SHOW ; temporary - show patient inquiry screen
"RTN","ORWPT",29,0)
 N I,Y,DIC S DIC=2,DIC(0)="AEMQ" D ^DIC Q:'Y
"RTN","ORWPT",30,0)
 K ^TMP("ORDATA",$J,1)
"RTN","ORWPT",31,0)
 D DGINQ^ORCXPND1(+Y)
"RTN","ORWPT",32,0)
 S I=0 F  S I=$O(^TMP("ORDATA",$J,1,I)) Q:'I  W !,^(I)
"RTN","ORWPT",33,0)
 K ^TMP("ORDATA",$J,1)
"RTN","ORWPT",34,0)
 Q
"RTN","ORWPT",35,0)
SELCHK(REC,DFN) ; Check for sensitive pt
"RTN","ORWPT",36,0)
 ; SENSITIVE
"RTN","ORWPT",37,0)
 S REC=$$EN1^ORQPT2(DFN)
"RTN","ORWPT",38,0)
 Q
"RTN","ORWPT",39,0)
DIEDON(VAL,DFN) ; Check for a date of death
"RTN","ORWPT",40,0)
 S VAL=+$G(^DPT(DFN,.35))
"RTN","ORWPT",41,0)
 Q
"RTN","ORWPT",42,0)
SELECT(REC,DFN) ; Selects patient & returns key information
"RTN","ORWPT",43,0)
 ;  1    2   3   4    5      6    7    8       9       10      11  12
"RTN","ORWPT",44,0)
 ; NAME^SEX^DOB^SSN^LOCIEN^LOCNM^RMBD^CWAD^SENSITIVE^ADMITTED^CONV^SC^
"RTN","ORWPT",45,0)
 ; 13  14  15  16
"RTN","ORWPT",46,0)
 ; SC%^ICN^AGE^TS
"RTN","ORWPT",47,0)
 ;
"RTN","ORWPT",48,0)
 ; for CCOW (RV - 2/27/03)  name="-1", location=error message
"RTN","ORWPT",49,0)
 I '$D(^DPT(+DFN,0)) S REC="-1^^^^^Patient is unknown to CPRS." Q
"RTN","ORWPT",50,0)
 ;
"RTN","ORWPT",51,0)
 N X
"RTN","ORWPT",52,0)
 K ^TMP("ORWPCE",$J) ; delete PCE 'cache' when switching patients
"RTN","ORWPT",53,0)
 S X=^DPT(DFN,0),REC=$P(X,U,1,3)_U_$P(X,U,9)_U_U_$G(^(.1))_U_$G(^(.101))
"RTN","ORWPT",54,0)
 S X=$P(REC,U,6) I $L(X) S $P(REC,U,5)=+$G(^DIC(42,+$O(^DIC(42,"B",X,0)),44))
"RTN","ORWPT",55,0)
 S $P(REC,U,8)=$$CWAD^ORQPT2(DFN)_U_$$EN1^ORQPT2(DFN)
"RTN","ORWPT",56,0)
 ; I $P(REC,U,9) D EN2^ORQPT2(DFN)  ;update DG security log ; DG249
"RTN","ORWPT",57,0)
 S X=$G(^DPT(DFN,.105)) I X S $P(REC,U,10)=$P($G(^DGPM(X,0)),U)
"RTN","ORWPT",58,0)
 S:'$D(IOST) IOST="P-OTHER"
"RTN","ORWPT",59,0)
 S $P(REC,U,11)=0
"RTN","ORWPT",60,0)
 D ELIG^VADPT S $P(REC,U,12)=$G(VAEL(3)) ;two pieces: SC^SC%
"RTN","ORWPT",61,0)
 I $L($T(GETICN^MPIF001)) S X=+$$GETICN^MPIF001(DFN) S:X>0 $P(REC,U,14)=X
"RTN","ORWPT",62,0)
 S $P(REC,U,15)=$$AGE(DFN,$P(REC,U,3))
"RTN","ORWPT",63,0)
 S $P(REC,U,16)=+$G(^DPT(DFN,.103)) ; treating specialty
"RTN","ORWPT",64,0)
 K VAEL,VAERR ;VADPT call to kill?
"RTN","ORWPT",65,0)
 S ^DISV(DUZ,"^DPT(")=DFN
"RTN","ORWPT",66,0)
 Q
"RTN","ORWPT",67,0)
SHARE(VAL,IP,HWND,DFN) ; Set global to share DFN with other applications
"RTN","ORWPT",68,0)
 K ^TMP("ORWCHART",$J),^TMP("ORECALL",$J),^TMP("ORWORD",$J)
"RTN","ORWPT",69,0)
 K ^TMP("ORWDXMQ",$J)
"RTN","ORWPT",70,0)
 S ^TMP("ORWCHART",$J,IP,HWND)=DFN
"RTN","ORWPT",71,0)
 Q
"RTN","ORWPT",72,0)
BYWARD(LST,WARD) ; Return a list of patients in a ward
"RTN","ORWPT",73,0)
 N ILST,DFN
"RTN","ORWPT",74,0)
 I +$G(WARD)<1 S LST(1)="^No ward identified" Q
"RTN","ORWPT",75,0)
 S (ILST,DFN)=0
"RTN","ORWPT",76,0)
 S WARD=$P(^DIC(42,WARD,0),"^")   ;DBIA #36
"RTN","ORWPT",77,0)
 F  S DFN=$O(^DPT("CN",WARD,DFN)) Q:DFN'>0  D
"RTN","ORWPT",78,0)
 . S ILST=ILST+1,LST(ILST)=+DFN_U_$P(^DPT(+DFN,0),U)_U_$G(^DPT(+DFN,.101))
"RTN","ORWPT",79,0)
 I ILST<1 S LST(1)="^No patients found."
"RTN","ORWPT",80,0)
 Q
"RTN","ORWPT",81,0)
LAST5(LST,ID) ; Return a list of patients matching A9999 identifiers
"RTN","ORWPT",82,0)
 N I,IEN,XREF
"RTN","ORWPT",83,0)
 S (I,IEN)=0,XREF=$S($L(ID)=5:"BS5",1:"BS")
"RTN","ORWPT",84,0)
 F  S IEN=$O(^DPT(XREF,ID,IEN)) Q:'IEN  D
"RTN","ORWPT",85,0)
 . S I=I+1,LST(I)=IEN_U_$P(^DPT(IEN,0),U)_U_$$DOB^DPTLK1(IEN,2)_U_$$SSN^DPTLK1(IEN)  ; DG249
"RTN","ORWPT",86,0)
 Q
"RTN","ORWPT",87,0)
 ;
"RTN","ORWPT",88,0)
LAST5RPL(LST,ID) ; ; Return list matching A9999 id's, but from RPL only.
"RTN","ORWPT",89,0)
 N ORRPL,ORCNT,ORPT,ORPIEN
"RTN","ORWPT",90,0)
 ; IA ____ allows read access to NEW PERSON file node 101:
"RTN","ORWPT",91,0)
 S ORRPL=$G(^VA(200,DUZ,101))
"RTN","ORWPT",92,0)
 S ORRPL=$P(ORRPL,U,2)
"RTN","ORWPT",93,0)
 I (('ORRPL)!(ORRPL="")) S LST(0)="" Q
"RTN","ORWPT",94,0)
 ;
"RTN","ORWPT",95,0)
 S (ORCNT,ORPT)=0
"RTN","ORWPT",96,0)
 F  S ORPT=$O(^OR(100.21,ORRPL,10,ORPT)) Q:'ORPT  D
"RTN","ORWPT",97,0)
 .S ORPIEN=+$G(^OR(100.21,ORRPL,10,ORPT,0))
"RTN","ORWPT",98,0)
 .I ((ORPIEN<0)!(ORPIEN="")) Q
"RTN","ORWPT",99,0)
 .S ORCNT=ORCNT+1
"RTN","ORWPT",100,0)
 .S LST(ORCNT)=ORPIEN_U_$P(^DPT(ORPIEN,0),U)_U_$$DOB^DPTLK1(ORPIEN,2)_U_$$SSN^DPTLK1(ORPIEN) ; DG249.
"RTN","ORWPT",101,0)
 ;
"RTN","ORWPT",102,0)
 Q
"RTN","ORWPT",103,0)
 ;
"RTN","ORWPT",104,0)
FULLSSN(LST,ID) ; Return a list of patients matching full SSN entered
"RTN","ORWPT",105,0)
 N I,IEN
"RTN","ORWPT",106,0)
 S (I,IEN)=0
"RTN","ORWPT",107,0)
 F  S IEN=$O(^DPT("SSN",ID,IEN)) Q:'IEN  D
"RTN","ORWPT",108,0)
 . S I=I+1,LST(I)=IEN_U_$P(^DPT(IEN,0),U)_U_$$DOB^DPTLK1(IEN,2)_U_$$SSN^DPTLK1(IEN)  ; DG249
"RTN","ORWPT",109,0)
 Q
"RTN","ORWPT",110,0)
 ;
"RTN","ORWPT",111,0)
FSSNRPL(LST,ID) ; Return list matching Full SSN, but from RPL only.
"RTN","ORWPT",112,0)
 N ORRPL,ORCNT,ORPT,ORLPT,ORPIEN
"RTN","ORWPT",113,0)
 ; IA ____ allows read access to NEW PERSON file node 101:
"RTN","ORWPT",114,0)
 S ORRPL=$G(^VA(200,DUZ,101))
"RTN","ORWPT",115,0)
 S ORRPL=$P(ORRPL,U,2)
"RTN","ORWPT",116,0)
 I (('ORRPL)!(ORRPL="")) S LST(0)="" Q
"RTN","ORWPT",117,0)
 ;
"RTN","ORWPT",118,0)
 S (ORCNT,ORPT)=0
"RTN","ORWPT",119,0)
 F  S ORPT=$O(^DPT("SSN",ID,ORPT)) Q:'ORPT  D
"RTN","ORWPT",120,0)
 .S ORLPT=0
"RTN","ORWPT",121,0)
 .F  S ORLPT=$O(^OR(100.21,ORRPL,10,ORLPT)) Q:'ORLPT  D
"RTN","ORWPT",122,0)
 ..S ORPIEN=+$G(^OR(100.21,ORRPL,10,ORLPT,0))
"RTN","ORWPT",123,0)
 ..I ((ORPIEN<0)!(ORPIEN="")) Q
"RTN","ORWPT",124,0)
 ..I (ORPIEN'=ORPT) Q
"RTN","ORWPT",125,0)
 ..S ORCNT=ORCNT+1
"RTN","ORWPT",126,0)
 ..S LST(ORCNT)=ORPIEN_U_$P(^DPT(ORPIEN,0),U)_U_$$DOB^DPTLK1(ORPIEN,2)_U_$$SSN^DPTLK1(ORPIEN) ; DG249.
"RTN","ORWPT",127,0)
 ;
"RTN","ORWPT",128,0)
 Q
"RTN","ORWPT",129,0)
 ;
"RTN","ORWPT",130,0)
TOP(LST) ; Return top for all patients list (last selected for now)
"RTN","ORWPT",131,0)
 N IEN
"RTN","ORWPT",132,0)
 S IEN=$G(^DISV(DUZ,"^DPT("))
"RTN","ORWPT",133,0)
 I IEN S LST(1)=IEN_U_$P($G(^DPT(IEN,0)),U)
"RTN","ORWPT",134,0)
 Q
"RTN","ORWPT",135,0)
ENCTITL(REC,DFN,LOC,PROV) ; Return external values for encounter
"RTN","ORWPT",136,0)
 ; LOCNAME^LOCABBR^ROOMBED^PROVNAME
"RTN","ORWPT",137,0)
 S $P(REC,U,1)=$P($G(^SC(+LOC,0)),U,1,2)
"RTN","ORWPT",138,0)
 S $P(REC,U,3)=$P($G(^DPT(DFN,.101)),U)
"RTN","ORWPT",139,0)
 S $P(REC,U,4)=$P($G(^VA(200,+PROV,0)),U)
"RTN","ORWPT",140,0)
 Q
"RTN","ORWPT",141,0)
LISTALL(Y,FROM,DIR) ; Return a bolus of patient names.  From is either Name or IEN^Name.
"RTN","ORWPT",142,0)
 N I,IEN,CNT,FROMIEN,ORIDNAME S CNT=44,I=0,FROMIEN=0
"RTN","ORWPT",143,0)
 I $P(FROM,U,2)'="" S FROMIEN=$P(FROM,U,1),FROM=$O(^DPT("B",$P(FROM,U,2)),-DIR)
"RTN","ORWPT",144,0)
 F  S FROM=$O(^DPT("B",FROM),DIR) Q:FROM=""  D  Q:I=CNT
"RTN","ORWPT",145,0)
 . S IEN=FROMIEN,FROMIEN=0 F  S IEN=$O(^DPT("B",FROM,IEN)) Q:'IEN  D  Q:I=CNT
"RTN","ORWPT",146,0)
 . . S ORIDNAME=""
"RTN","ORWPT",147,0)
 . . S ORIDNAME=$G(^DPT(IEN,0)) ; Get zero node name.
"RTN","ORWPT",148,0)
 . . ; S X1=$G(^DPT(IEN,.1))_" "_$G(^DPT(IEN,.101))
"RTN","ORWPT",149,0)
 . . S I=I+1 S Y(I)=IEN_U_FROM_U_U_U_U_$P(ORIDNAME,U) ;_"^"_X ; _"^"_X1  ;"   ("_X_")"
"RTN","ORWPT",150,0)
 Q
"RTN","ORWPT",151,0)
APPTLST(LST,DFN) ; return a list of appointments
"RTN","ORWPT",152,0)
 ; APPTTIME^LOCIEN^LOCNAME^EXTSTATUS
"RTN","ORWPT",153,0)
 N ERR,ERRMSG,VASD,VAERR K ^UTILITY("VASD",$J)  ;IA 10061
"RTN","ORWPT",154,0)
 S VASD("F")=$$HTFM^XLFDT($H-30,1)
"RTN","ORWPT",155,0)
 S VASD("T")=$$HTFM^XLFDT($H+1,1)_".2359"
"RTN","ORWPT",156,0)
 S VASD("W")="123456789"
"RTN","ORWPT",157,0)
 D SDA^ORQRY01(.ERR,.ERRMSG)
"RTN","ORWPT",158,0)
 I ERR K ^UTILITY("VASD",$J) K LST S LST(1)=ERRMSG Q
"RTN","ORWPT",159,0)
 S I=0 F  S I=$O(^UTILITY("VASD",$J,I)) Q:'I  D
"RTN","ORWPT",160,0)
 . S LST(I)=$P(^UTILITY("VASD",$J,I,"I"),U,1,2)_U_$P(^("E"),U,2,3)
"RTN","ORWPT",161,0)
 K ^UTILITY("VASD",$J)
"RTN","ORWPT",162,0)
 Q
"RTN","ORWPT",163,0)
ADMITLST(LST,DFN) ; return a list of admissions
"RTN","ORWPT",164,0)
 ; MOVETIME^LOCIEN^LOCNAME^TYPE
"RTN","ORWPT",165,0)
 N TIM,MOV,X0,Y,MTIM,XTYP,XLOC,HLOC,ILST S ILST=0
"RTN","ORWPT",166,0)
 S TIM="" F  S TIM=$O(^DGPM("ATID1",DFN,TIM)) Q:TIM'>0  D
"RTN","ORWPT",167,0)
 . S MOV=0  F  S MOV=$O(^DGPM("ATID1",DFN,TIM,MOV)) Q:MOV'>0  D
"RTN","ORWPT",168,0)
 . . N VSTR,TIUDA
"RTN","ORWPT",169,0)
 . . S X0=$G(^DGPM(MOV,0)) I X0']"" Q
"RTN","ORWPT",170,0)
 . . S MTIM=$P(X0,U)
"RTN","ORWPT",171,0)
 . . S XTYP=$P($G(^DG(405.1,+$P(X0,U,4),0)),U,1)
"RTN","ORWPT",172,0)
 . . S XLOC=$P($G(^DIC(42,+$P(X0,U,6),0)),U,1),HLOC=+$G(^(44))
"RTN","ORWPT",173,0)
 . . S VSTR=HLOC_";"_MTIM_";H",TIUDA=$$HASDS^TIULX(DFN,VSTR)
"RTN","ORWPT",174,0)
 . . S ILST=ILST+1,LST(ILST)=MTIM_U_HLOC_U_XLOC_U_XTYP_U_MOV_U_TIUDA
"RTN","ORWPT",175,0)
 Q
"RTN","ORWPT",176,0)
CLINRNG(LST) ; return date ranges for clinic appointments
"RTN","ORWPT",177,0)
 S LST(1)="T;T^Today"
"RTN","ORWPT",178,0)
 S LST(2)="T+1;T+1^Tomorrow"
"RTN","ORWPT",179,0)
 S LST(3)="T-1;T-1^Yesterday"
"RTN","ORWPT",180,0)
 S LST(4)="T-7;T^Past Week"
"RTN","ORWPT",181,0)
 S LST(5)="T-31;T^Past Month"
"RTN","ORWPT",182,0)
 S LST(6)="S^Specify Date Range..."
"RTN","ORWPT",183,0)
 Q
"RTN","ORWPT",184,0)
 ;
"RTN","ORWPT",185,0)
 N %,%H,X,SUNDAY,START
"RTN","ORWPT",186,0)
 S LST(1)=DT_";"_DT_"^Today",X=$$HTFM^XLFDT($H+1,1)
"RTN","ORWPT",187,0)
 S LST(2)=X_";"_X_"^Tomorrow"
"RTN","ORWPT",188,0)
 S X=+$H F  Q:X#7=3  S X=X-1                        ; $H#7=3 is Sunday
"RTN","ORWPT",189,0)
 S LST(3)=$$HTFM^XLFDT(X)_";"_$$HTFM^XLFDT(X+6)_"^This Week"
"RTN","ORWPT",190,0)
 S LST(4)=$$HTFM^XLFDT(X+7)_";"_$$HTFM^XLFDT(X+13)_"^Next Week"
"RTN","ORWPT",191,0)
 S LST(5)=$E(DT,1,5)_"01;"_$E(DT,1,5)_"31^This Month"
"RTN","ORWPT",192,0)
 S X=$E(DT,4,5)+1 S:X=13 X=1 S X=$E(DT,1,3)_$TR($J(X,2)," ",0)
"RTN","ORWPT",193,0)
 S LST(6)=X_"01;"_X_"31^Next Month"
"RTN","ORWPT",194,0)
 S LST(7)="^Specify Dates"
"RTN","ORWPT",195,0)
 Q
"RTN","ORWPT",196,0)
DFLTSRC(VAL) ; return default patient list source (T, W, C, P, S)
"RTN","ORWPT",197,0)
 N SRV S SRV=+$G(^VA(200,DUZ,5))
"RTN","ORWPT",198,0)
 S VAL=$$GET^XPAR("ALL^SRV.`"_SRV,"ORLP DEFAULT LIST SOURCE")
"RTN","ORWPT",199,0)
 Q
"RTN","ORWPT",200,0)
SAVDFLT(OK,X) ; save new default patient list settings (X=type^ien^sdt;edt)
"RTN","ORWPT",201,0)
 G SAVDFLT^ORWPT1
"RTN","ORWPT",202,0)
 ;
"RTN","ORWPT",203,0)
DISCHRG(Y,DFN,ADMITDT) ; Get discharge movement information
"RTN","ORWPT",204,0)
 N VAIP
"RTN","ORWPT",205,0)
 I +$G(ADMITDT)=0 S Y=DT Q
"RTN","ORWPT",206,0)
 S VAIP("D")=ADMITDT D 52^VADPT
"RTN","ORWPT",207,0)
 I +VAIP(17)=0 S Y=DT Q
"RTN","ORWPT",208,0)
 S Y=+VAIP(17,1)
"RTN","ORWPT",209,0)
 Q
"RTN","ORWPT",210,0)
CWAD(Y,DFN) ;  returns CWAD flags for a patient
"RTN","ORWPT",211,0)
 S Y=$$CWAD^ORQPT2(DFN)
"RTN","ORWPT",212,0)
 Q
"RTN","ORWPT",213,0)
LEGACY(ORLST,DFN) ; return message if data on the legacy system
"RTN","ORWPT",214,0)
 ; ORLST(0)=1 if data,  ORLST(n)=display message if data
"RTN","ORWPT",215,0)
 S ORLST(0)=0
"RTN","ORWPT",216,0)
 I $L($T(HXDATA^A7RDPAGU)) D
"RTN","ORWPT",217,0)
 . D HXDATA^A7RDPAGU(.ORLST,DFN)
"RTN","ORWPT",218,0)
 . I $O(ORLST(0)) S ORLST(0)=1
"RTN","ORWPT",219,0)
 Q
"RTN","ORWPT",220,0)
INPLOC(REC,DFN) ; Return a patient's current location
"RTN","ORWPT",221,0)
 N X
"RTN","ORWPT",222,0)
 S X=$G(^DPT(DFN,.102)),REC=0
"RTN","ORWPT",223,0)
 I X S X=$P($G(^DGPM(X,0)),U,6)
"RTN","ORWPT",224,0)
 I X S REC=+$G(^DIC(42,X,44))
"RTN","ORWPT",225,0)
 I X S $P(REC,U,2)=$P($G(^DIC(42,X,0)),U,1)
"RTN","ORWPT",226,0)
 I X S X=$P($G(^DIC(42,X,0)),U,3)
"RTN","ORWPT",227,0)
 S $P(REC,U,3)=X
"RTN","ORWPT",228,0)
 Q
"RTN","ORWPT",229,0)
AGE(DFN,BEG) ; returns age based on date of birth and date of death (or DT)
"RTN","ORWPT",230,0)
 N END,X
"RTN","ORWPT",231,0)
 S END=+$G(^DPT(DFN,.35)),END=$S(END:END,1:DT)
"RTN","ORWPT",232,0)
 S X=$E(END,1,3)-$E(BEG,1,3)-($E(END,4,7)<$E(BEG,4,7))
"RTN","ORWPT",233,0)
 Q X
"RTN","ORWPT",234,0)
ROK(X) ; Routine OK (in UCI) (NDBI)
"RTN","ORWPT",235,0)
 S X=$G(X) Q:'$L(X) 0  Q:$L(X)>8 0  X ^%ZOSF("TEST") Q:$T 1  Q 0
"RTN","ORWPT",236,0)
 ;
"RTN","ORWPT",237,0)
 ;NDBI(X) ; National Database Integration site 1 = yes  0 = no
"RTN","ORWPT",238,0)
 ; N R,G S X="A7RDUP" X ^%ZOSF("TEST") S R=$T,G=$S($D(^A7RCP):1,1:0),X=R+G,X=$S(X=2:1,1:0) Q X
"RTN","ORWPT16")
0^164^B11809182
"RTN","ORWPT16",1,0)
ORWPT16 ; SLC/KCM - Patient Lookup Functions - 16bit ;7/20/96  15:43
"RTN","ORWPT16",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORWPT16",3,0)
 ;
"RTN","ORWPT16",4,0)
IDINFO(ORY,DFN) ; Return identifying information for a patient
"RTN","ORWPT16",5,0)
 ; PID^DOB^AGE^SEX^SC%^TYPE^WARD^RM-BED^NAME
"RTN","ORWPT16",6,0)
 N OR0,OR36,OR1,OR101,VAEL,VAERR
"RTN","ORWPT16",7,0)
 S OR0=$G(^DPT(DFN,0)),OR36=$G(^(.36)),OR1=$G(^(.1)),OR101=$G(^(.101))
"RTN","ORWPT16",8,0)
 D ELIG^VADPT
"RTN","ORWPT16",9,0)
 S ORY=$P(OR36,U,3)_U_$P(OR0,U,3)_U_U_$P(OR0,U,2)
"RTN","ORWPT16",10,0)
 S ORY=ORY_U_$P(VAEL(3),U,2)_U_$P(VAEL(6),U,2)_U_$P(OR1,U)_U_$P(OR101,U)
"RTN","ORWPT16",11,0)
 I $P(OR0,U,3) S $P(ORY,U,3)=DT-$P(OR0,U,3)\10000
"RTN","ORWPT16",12,0)
 I '$L($P(ORY,U,1)) D
"RTN","ORWPT16",13,0)
 . S X=$P(OR0,U,9),$P(ORY,U,1)=$E(X,1,3)_"-"_$E(X,4,5)_"-"_$E(X,6,99)
"RTN","ORWPT16",14,0)
 S $P(ORY,U,9)=$P(OR0,U,1)
"RTN","ORWPT16",15,0)
 Q
"RTN","ORWPT16",16,0)
DEMOG(VAL,DFN) ; procedure
"RTN","ORWPT16",17,0)
 ; Return common patient demographic info
"RTN","ORWPT16",18,0)
 ; NAME^SEX^DOB^SSN^WARDID^WARDNAME^RMBED^ADMITTIME^DIED ;^SC%^ELIGTYPE
"RTN","ORWPT16",19,0)
 S X=^DPT(DFN,0),VAL=$P(X,U,1,3)_U_$P(X,U,9)_U_U_$G(^(.1))_U_$G(^(.101))
"RTN","ORWPT16",20,0)
 S X=$P(VAL,U,6) I $L(X) S $P(VAL,U,5)=$O(^SC("B",X,0))
"RTN","ORWPT16",21,0)
 S X=$G(^DPT(DFN,.105)) I X S $P(VAL,U,8)=$P(^DGPM(X,0),U,1)
"RTN","ORWPT16",22,0)
 I $L($P($G(^DPT(DFN,.35)),U,1)) S $P(VAL,U,9)=$P(^(.35),U,1)
"RTN","ORWPT16",23,0)
 Q
"RTN","ORWPT16",24,0)
PSCNVT(VAL,DFN) ; procedure
"RTN","ORWPT16",25,0)
 ; Call conversion routine for pharmacy (both inpatient and outpatient)
"RTN","ORWPT16",26,0)
 S VAL=0
"RTN","ORWPT16",27,0)
 Q
"RTN","ORWPT16",28,0)
LISTALL(Y,DIR,FROM) ; Return a bolus of patient names
"RTN","ORWPT16",29,0)
 N I,IEN,CNT S CNT=44,I=0
"RTN","ORWPT16",30,0)
 ;
"RTN","ORWPT16",31,0)
 I DIR=0 D  ; Forward direction
"RTN","ORWPT16",32,0)
 . F  S FROM=$O(^DPT("B",FROM)) Q:FROM=""  D  Q:I=CNT
"RTN","ORWPT16",33,0)
 . . S IEN=0 F  S IEN=$O(^DPT("B",FROM,IEN)) Q:'IEN  D  Q:I=CNT
"RTN","ORWPT16",34,0)
 . . . ; S X=$P($G(^DPT(IEN,0)),"^",9)
"RTN","ORWPT16",35,0)
 . . . ; S X=$E(X,1,3)_"-"_$E(X,4,5)_"-"_$E(X,6,99)
"RTN","ORWPT16",36,0)
 . . . ; S X1=$G(^DPT(IEN,.1))_" "_$G(^DPT(IEN,.101))
"RTN","ORWPT16",37,0)
 . . . S I=I+1 S Y(I)=IEN_"^"_FROM ;_"^"_X ; _"^"_X1  ;"   ("_X_")"
"RTN","ORWPT16",38,0)
 . I $G(Y(CNT))="" S I=I+1,Y(I)=""
"RTN","ORWPT16",39,0)
 ;
"RTN","ORWPT16",40,0)
 I DIR=1 D  ; Reverse direction
"RTN","ORWPT16",41,0)
 . F  S FROM=$O(^DPT("B",FROM),-1) Q:FROM=""  D  Q:I=CNT
"RTN","ORWPT16",42,0)
 . . S IEN=0 F  S IEN=$O(^DPT("B",FROM,IEN)) Q:'IEN  D  Q:I=CNT
"RTN","ORWPT16",43,0)
 . . . ; S X=$P($G(^DPT(IEN,0)),"^",9)
"RTN","ORWPT16",44,0)
 . . . ; S X=$E(X,1,3)_"-"_$E(X,4,5)_"-"_$E(X,6,99)
"RTN","ORWPT16",45,0)
 . . . ; S X1=$G(^DPT(IEN,.1))_" "_$G(^DPT(IEN,.101))
"RTN","ORWPT16",46,0)
 . . . S I=I+1 S Y(I)=IEN_"^"_FROM ;_"^"_X ; _"^"_X1  ;"   ("_X_")"
"RTN","ORWPT16",47,0)
 Q
"RTN","ORWPT16",48,0)
LOOKUP(Y,FROM) ; Return a set of patient names
"RTN","ORWPT16",49,0)
 N I,X
"RTN","ORWPT16",50,0)
 D FIND^DIC(2,"","","M",FROM)
"RTN","ORWPT16",51,0)
 S I=0,Y=""
"RTN","ORWPT16",52,0)
 F  S I=$O(^TMP("DILIST",$J,1,I)) Q:'I  D
"RTN","ORWPT16",53,0)
 . S X=^TMP("DILIST",$J,"ID",I,.09)
"RTN","ORWPT16",54,0)
 . S X=$E(X,1,3)_"-"_$E(X,4,5)_"-"_$E(X,6,99)
"RTN","ORWPT16",55,0)
 . S Y(I)=^TMP("DILIST",$J,2,I)_"^"_^TMP("DILIST",$J,1,I)_"^"_X
"RTN","ORWPT16",56,0)
 K ^TMP("DILIST",$J)
"RTN","ORWPT16",57,0)
 Q
"RTN","ORWPT16",58,0)
GETVSIT(Y,DFN,LOC,ADATE) ; procedure
"RTN","ORWPT16",59,0)
 ; Return a visit given a patient, location, and date/time
"RTN","ORWPT16",60,0)
 N VSIT,VSITPKG
"RTN","ORWPT16",61,0)
 S (VSIT,VSIT("VDT"))=ADATE,VSIT("PAT")=DFN,VSIT("LOC")=LOC
"RTN","ORWPT16",62,0)
 S VSIT("SVC")="A",VSIT("PRI")="P",VSIT(0)="NMD1",VSITPKG="OR"
"RTN","ORWPT16",63,0)
 D ^VSIT
"RTN","ORWPT16",64,0)
 S Y=VSIT("IEN") I +VSIT("IEN")'>0 S Y="" Q
"RTN","ORWPT16",65,0)
 I +VSIT("LOC") S Y=Y_U_VSIT("LOC")_U_$P(^SC(+VSIT("LOC"),0),U,1,2)
"RTN","ORWPT16",66,0)
 Q
"RTN","ORWPT16",67,0)
APPTLST(LST,DFN) ; procedure
"RTN","ORWPT16",68,0)
 ; Return a list of appointments
"RTN","ORWPT16",69,0)
 N I,ILST S ILST=0
"RTN","ORWPT16",70,0)
 D GETAPPT^TIUVSIT(DFN)
"RTN","ORWPT16",71,0)
 S I=0 F  S I=$O(^TMP("TIUVNI",$J,I)) Q:'I  D
"RTN","ORWPT16",72,0)
 . S ILST=ILST+1
"RTN","ORWPT16",73,0)
 . S LST(ILST)=$P(^TMP("TIUVNI",$J,I),U,1,2)_U_$P(^TMP("TIUVN",$J,I),U,1,2)
"RTN","ORWPT16",74,0)
 K ^TMP("TIUVN",$J),^TMP("TIUVNI",$J)
"RTN","ORWPT16",75,0)
 Q
"RTN","ORWPT16",76,0)
ADMITLST(LST,DFN) ; procedure
"RTN","ORWPT16",77,0)
 ; Return a list of admissions
"RTN","ORWPT16",78,0)
 N TIM,MOV,X0,Y,MTIM,XTIM,XTYP,XLOC,HLOC,ILST S ILST=0
"RTN","ORWPT16",79,0)
 S TIM="" F  S TIM=$O(^DGPM("ATID1",DFN,TIM)) Q:TIM'>0  D
"RTN","ORWPT16",80,0)
 . S MOV=0  F  S MOV=$O(^DGPM("ATID1",DFN,TIM,MOV)) Q:MOV'>0  D
"RTN","ORWPT16",81,0)
 . . S X0=^DGPM(MOV,0)
"RTN","ORWPT16",82,0)
 . . S MTIM=$P(X0,U,1),Y=MTIM D DD^%DT S XTIM=Y
"RTN","ORWPT16",83,0)
 . . S XTYP=$P($G(^DG(405.1,+$P(X0,U,4),0)),U,1)
"RTN","ORWPT16",84,0)
 . . S XLOC=$P($G(^DIC(42,+$P(X0,U,6),0)),U,1),HLOC=+$G(^(44))
"RTN","ORWPT16",85,0)
 . . S ILST=ILST+1,LST(ILST)=MTIM_U_HLOC_U_XTIM_U_XTYP_U_"TO: "_XLOC
"RTN","ORWPT16",86,0)
 Q
"RTN","ORWRP")
0^170^B77665061
"RTN","ORWRP",1,0)
ORWRP ; ALB/MJK,dcm Report Calls ; 12/05/02 11:03
"RTN","ORWRP",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**1,10,85,109,132,160,194,227,215,262,243**;Dec 17, 1997;Build 242
"RTN","ORWRP",3,0)
 ;
"RTN","ORWRP",4,0)
LABLIST(LST) ; -- report list for labs tab
"RTN","ORWRP",5,0)
 ;  RPC: ORWRP LAB REPORT LIST
"RTN","ORWRP",6,0)
 N I,J,X,X0,X2,CNT,EOF,IFN,ROOT,RPC,ORLIST,HEAD
"RTN","ORWRP",7,0)
 S EOF="$$END",ROOT=$NA(LST),(CNT,I)=0
"RTN","ORWRP",8,0)
 D SETITEM(ROOT,"[LAB REPORT LIST]")
"RTN","ORWRP",9,0)
 D GETLST^XPAR(.ORLIST,"ALL","ORWRP REPORT LAB LIST")
"RTN","ORWRP",10,0)
 F  S I=$O(ORLIST(I)) Q:'I  Q:'$D(^ORD(101.24,$P(ORLIST(I),"^",2),0))  S X0=^(0),X2=$G(^(2)) D
"RTN","ORWRP",11,0)
 . Q:$P(X0,"^",12)="L"
"RTN","ORWRP",12,0)
 . S RPC=$$GET1^DIQ(8994,+$P(X0,"^",13),.01),IFN=ORLIST(I),HEAD=$P(X0,"^")
"RTN","ORWRP",13,0)
 . I $L($P(X2,"^",3)) S HEAD=$P(X2,"^",3)
"RTN","ORWRP",14,0)
 . S X=$P(X0,"^",2)_"^"_HEAD_"^"_$P(X0,"^",3)_"^"_$P(X0,"^",12)_"^"_$P(X0,"^",7)_"^"_RPC_"^"_IFN
"RTN","ORWRP",15,0)
 . D SETITEM(.ROOT,X)
"RTN","ORWRP",16,0)
 D SETITEM(.ROOT,"$$END")
"RTN","ORWRP",17,0)
 Q
"RTN","ORWRP",18,0)
LIST(LST) ; -- report lists for reports tab
"RTN","ORWRP",19,0)
 ;  RPC: ORWRP REPORT LIST
"RTN","ORWRP",20,0)
 N EOF,ROOT
"RTN","ORWRP",21,0)
 S EOF="$$END",ROOT=$NA(LST)
"RTN","ORWRP",22,0)
 K @ROOT
"RTN","ORWRP",23,0)
 D GETRPTS(.ROOT,.EOF) ; -report list
"RTN","ORWRP",24,0)
 D GETHS(.ROOT,.EOF) ; -health summary types
"RTN","ORWRP",25,0)
 D GETDT(.ROOT,.EOF) ; -date ranges
"RTN","ORWRP",26,0)
 Q
"RTN","ORWRP",27,0)
GETCOL(ROOT,IFN) ; -- get Column headers for ListView
"RTN","ORWRP",28,0)
 N I,J,X,VAL
"RTN","ORWRP",29,0)
 Q:'$G(IFN)
"RTN","ORWRP",30,0)
 S I=0,ROOT=$NA(ROOT)
"RTN","ORWRP",31,0)
 F  S I=$O(^ORD(101.24,IFN,3,"C",I)) Q:'I  D
"RTN","ORWRP",32,0)
 . S VAL=$$GET^XPAR(DUZ_";VA(200,","ORWCH COLUMNS REPORTS",IFN,"I"),J=0
"RTN","ORWRP",33,0)
 . F  S J=$O(^ORD(101.24,IFN,3,"C",I,J)) Q:'J  I $D(^ORD(101.24,IFN,3,J)) S X=^(J,0) D
"RTN","ORWRP",34,0)
 .. I $L(VAL),$P(VAL,",",I) S $P(X,"^",10)=$P(VAL,",",I)
"RTN","ORWRP",35,0)
 .. D SETITEM(.ROOT,X)
"RTN","ORWRP",36,0)
 Q
"RTN","ORWRP",37,0)
GETRPTS(ROOT,EOF) ; -- get report list
"RTN","ORWRP",38,0)
 N I,J,X,X0,X2,CNT,IFN,ORLIST,HEAD
"RTN","ORWRP",39,0)
 D SETITEM(.ROOT,"[REPORT LIST]"),GETLST^XPAR(.ORLIST,"ALL","ORWRP REPORT LIST")
"RTN","ORWRP",40,0)
 S (CNT,I)=0
"RTN","ORWRP",41,0)
 F  S I=$O(ORLIST(I)) Q:'I  Q:'$D(^ORD(101.24,$P(ORLIST(I),"^",2),0))  S X0=^(0),X2=$G(^(2)) D
"RTN","ORWRP",42,0)
 . Q:$P(X0,"^",12)="L"
"RTN","ORWRP",43,0)
 . S RPC=$$GET1^DIQ(8994,+$P(X0,"^",13),.01),IFN=ORLIST(I),HEAD=$P(X0,"^")
"RTN","ORWRP",44,0)
 . I $L($P(X2,"^",3)) S HEAD=$P(X2,"^",3)
"RTN","ORWRP",45,0)
 . S X=$P(X0,"^",2)_"^"_HEAD_"^"_$P(X0,"^",4)_"^"_$P(X0,"^",19)_";"_$P(X0,"^",20)_"^"_$P(X0,"^",6)_"^"_$P(X0,"^",5)_"^"_$P(X0,"^",3)_"^"_$P(X0,"^",12)_"^"_$P(X0,"^",7)_"^"_RPC_"^"_IFN
"RTN","ORWRP",46,0)
 . D SETITEM(.ROOT,X)
"RTN","ORWRP",47,0)
 D SETITEM(.ROOT,"$$END")
"RTN","ORWRP",48,0)
 Q
"RTN","ORWRP",49,0)
GETHS(ROOT,EOF) ; --get health summary types
"RTN","ORWRP",50,0)
 N C,I,IFN,ORHSPARM,ORERR,X,T
"RTN","ORWRP",51,0)
 K ^TMP("ORHSPARM",$J)
"RTN","ORWRP",52,0)
 S ORHSROOT="^TMP(""ORHSPARM"",$J)"
"RTN","ORWRP",53,0)
 I $$GET^XPAR("ALL","ORWRP HEALTH SUMMARY LIST ALL",1) S I="",C=0 D
"RTN","ORWRP",54,0)
 . F  S I=$O(^GMT(142,"B",I)) Q:I=""  S IFN=$O(^(I,0)) Q:'IFN  D
"RTN","ORWRP",55,0)
 .. S X=$G(^GMT(142,IFN,0)) Q:'$L(X)
"RTN","ORWRP",56,0)
 .. S T=$G(^GMT(142,IFN,"T")),C=C+1,@ORHSROOT@(C)=IFN_"^"_$S($L(T):T,1:$P(X,"^"))_"^^^^^1"
"RTN","ORWRP",57,0)
 .. I I="GMTS HS ADHOC OPTION" S @ORHSROOT@(C)="0^GMTS Adhoc Report"
"RTN","ORWRP",58,0)
 I '$$GET^XPAR("ALL","ORWRP HEALTH SUMMARY LIST ALL",1) D
"RTN","ORWRP",59,0)
 . D:$L($T(GETLIST^GMTSXAL)) GETLIST^GMTSXAL($NA(@ORHSROOT),$G(DUZ),1,.ORERR)
"RTN","ORWRP",60,0)
 . Q:$G(ORERR)
"RTN","ORWRP",61,0)
 . S I=0 F  S I=$O(@ORHSROOT@(I)) Q:'I  S @ORHSROOT@(I)=@ORHSROOT@(I)_"^^^^^1" I $P(@ORHSROOT@(I),"^",2)="GMTS HS ADHOC OPTION" S @ORHSROOT@(I)="0^Adhoc Report"
"RTN","ORWRP",62,0)
 D SETITEM(.ROOT,"[HEALTH SUMMARY TYPES]")
"RTN","ORWRP",63,0)
 S I=0  F  S I=$O(@ORHSROOT@(I)) Q:'I  D SETITEM(.ROOT,"h"_@ORHSROOT@(I))
"RTN","ORWRP",64,0)
 D SETITEM(.ROOT,EOF)
"RTN","ORWRP",65,0)
 Q
"RTN","ORWRP",66,0)
GETDT(ROOT,EOF) ; -- get date range choices
"RTN","ORWRP",67,0)
 N I,X
"RTN","ORWRP",68,0)
 D SETITEM(.ROOT,"[DATE RANGES]")
"RTN","ORWRP",69,0)
 F I=2:1 S X=$P($T(DTLIST+I),";",3) Q:X=EOF  D SETITEM(.ROOT,"d"_X)
"RTN","ORWRP",70,0)
 Q
"RTN","ORWRP",71,0)
DTLIST ; -- list of date ranges
"RTN","ORWRP",72,0)
 ;<number of days>^ <display text>
"RTN","ORWRP",73,0)
 ;;S^Date Range...
"RTN","ORWRP",74,0)
 ;;0^Today
"RTN","ORWRP",75,0)
 ;;7^One Week Back
"RTN","ORWRP",76,0)
 ;;14^Two Weeks Back
"RTN","ORWRP",77,0)
 ;;30^One Month Back
"RTN","ORWRP",78,0)
 ;;180^Six Months Back
"RTN","ORWRP",79,0)
 ;;365^One Year Back
"RTN","ORWRP",80,0)
 ;;732^Two Years Back
"RTN","ORWRP",81,0)
 ;;50000^All Results
"RTN","ORWRP",82,0)
 ;;$$END
"RTN","ORWRP",83,0)
 ;
"RTN","ORWRP",84,0)
SETITEM(ROOT,X) ; -- set item in list
"RTN","ORWRP",85,0)
 S @ROOT@($O(@ROOT@(9999),-1)+1)=X
"RTN","ORWRP",86,0)
 Q
"RTN","ORWRP",87,0)
RPT(ROOT,DFN,RPTID,HSTYPE,DTRANGE,EXAMID,ALPHA,OMEGA) ; -- return report text
"RTN","ORWRP",88,0)
 ;ROOT=Output in ^TMP("ORDATA",$J)
"RTN","ORWRP",89,0)
 ;DFN=Patient DFN ; ICN for remote sites
"RTN","ORWRP",90,0)
 ;RPTID=Unique report ID_";"_Remote ID_"~"_HSComponent for listview (ent;rtn;0;MaxOcc) or text (ent;rtn;#component;MaxOcc)
"RTN","ORWRP",91,0)
 ;HSTYPE=Health Sum Type
"RTN","ORWRP",92,0)
 ;DTRANGE=# days back from today
"RTN","ORWRP",93,0)
 ;EXAMID=Rad exam ID
"RTN","ORWRP",94,0)
 ;ALPHA=Start date
"RTN","ORWRP",95,0)
 ;OMEGA=End date
"RTN","ORWRP",96,0)
 ;  RPC: ORWRP REPORT TEXT
"RTN","ORWRP",97,0)
 ;
"RTN","ORWRP",98,0)
 N X,X0,X2,X4,I,J,ENT,RTN,ID,REMOTE,GO,OUT,MAX,SITE,ORFHIE,%ZIS,HSTAG,DIRECT,TAB
"RTN","ORWRP",99,0)
 K ^TMP("ORDATA",$J)
"RTN","ORWRP",100,0)
 S TAB="R"
"RTN","ORWRP",101,0)
 I $E(RPTID,1,2)="L:" S TAB="L",RPTID=$P(RPTID,":",2,999) ;an ID beginning with "L:" forces TAB to LAB - "L:" added in GUI code
"RTN","ORWRP",102,0)
 S HSTAG=$P($G(RPTID),"~",2),RPTID=$P($G(RPTID),"~"),ROOT=$NA(^TMP("ORDATA",$J,1)),REMOTE=+$P(RPTID,";",2),RPTID=$P($P(RPTID,";"),":")
"RTN","ORWRP",103,0)
 I 'REMOTE S DFN=+DFN ;DFN = DFN;ICN for remote calls
"RTN","ORWRP",104,0)
 S I=0,X0="",X2="",X4="",SITE=$$SITE^VASITE,SITE=$P(SITE,"^",2)_";"_$P(SITE,"^",3)
"RTN","ORWRP",105,0)
 F  S I=$O(^ORD(101.24,"AC",I)) Q:I=""  S J=0 F  S J=$O(^ORD(101.24,"AC",I,J)) Q:'J  D
"RTN","ORWRP",106,0)
 . I $P($G(^ORD(101.24,J,0)),"^",2)=RPTID,$P(^(0),"^",8)=TAB S X0=^(0),X2=$G(^(2)),ORFHIE=$G(^(4)),DIRECT=$P(ORFHIE,"^",4),X4=$P(ORFHIE,"^",2),ORFHIE=$P(ORFHIE,"^",3)
"RTN","ORWRP",107,0)
 I '$L(X0) D NOTYET(.ROOT) Q
"RTN","ORWRP",108,0)
 S RTN=$P(X0,"^",5),ENT=$P(X0,"^",6)
"RTN","ORWRP",109,0)
 I '$L(RTN)!'$L(ENT) D NOTYET(.ROOT) Q
"RTN","ORWRP",110,0)
 I '$L($T(@(ENT_"^"_RTN))) D NOTYET(.ROOT) Q
"RTN","ORWRP",111,0)
 ;I $G(ALPHA) S X=ALPHA-$G(OMEGA) D  ;jeh 243
"RTN","ORWRP",112,0)
 I $G(ALPHA) D
"RTN","ORWRP",113,0)
 . N X1,X2
"RTN","ORWRP",114,0)
 . S X=ALPHA
"RTN","ORWRP",115,0)
 . S X1=ALPHA,X2=$G(OMEGA) D:X2 ^%DTC ;X returned, # of days diff
"RTN","ORWRP",116,0)
 . I X<0 S X=X*(-1)
"RTN","ORWRP",117,0)
 . I X4,X>X4 S:ALPHA>OMEGA OMEGA=$$FMADD^XLFDT(ALPHA,-X4) S:ALPHA'>OMEGA ALPHA=$$FMADD^XLFDT(OMEGA,-X4) S DTRANGE=""
"RTN","ORWRP",118,0)
 I X4,$G(DTRANGE)>X4 S DTRANGE=X4,ALPHA=""
"RTN","ORWRP",119,0)
 I $L($G(DTRANGE)),'$G(ALPHA) S ALPHA=$$FMADD^XLFDT(DT,-DTRANGE),OMEGA=DT_".235959"
"RTN","ORWRP",120,0)
 I $G(OMEGA),$E(OMEGA,8)'="." S OMEGA=OMEGA_".235959"
"RTN","ORWRP",121,0)
 S ID=$G(HSTAG),$P(ID,";",5,10)=SITE_";"_$P(X2,"^",8)_";"_$P(X2,"^",9)_";"_RPTID_";"_$G(DIRECT) ;HDRHX CHANGE
"RTN","ORWRP",122,0)
 I $L($P($G(HSTAG),";",4)) S MAX=$P(HSTAG,";",4)
"RTN","ORWRP",123,0)
 I $L($G(HSTYPE)) M ID=HSTYPE
"RTN","ORWRP",124,0)
 I $L($G(EXAMID)) M ID=EXAMID
"RTN","ORWRP",125,0)
 S OUT=ENT_"^"_RTN_"(.ROOT,DFN,.ID,.ALPHA,.OMEGA,.DTRANGE,.REMOTE,.MAX,.ORFHIE)"
"RTN","ORWRP",126,0)
 I REMOTE S GO=0 D  Q:'GO
"RTN","ORWRP",127,0)
 . I '$L($T(GETDFN^MPIF001)) D SETITEM(.ROOT,"MPI routines missing on remote system ("_SITE_")") S GO=0 Q
"RTN","ORWRP",128,0)
 . S ICN=+$P(DFN,";",2),DFN=+$$GETDFN^MPIF001(ICN)
"RTN","ORWRP",129,0)
 . I DFN<0 D SETITEM(.ROOT,"Patient not found on remote system ("_SITE_")") S GO=0 Q
"RTN","ORWRP",130,0)
 . S GO=+$P(X0,"^",3)
"RTN","ORWRP",131,0)
 . I 'GO D SETITEM(.ROOT,"Remote access not available for this report ("_SITE_")")
"RTN","ORWRP",132,0)
 S %ZIS="0N"
"RTN","ORWRP",133,0)
 D @OUT
"RTN","ORWRP",134,0)
 Q
"RTN","ORWRP",135,0)
NOTYET(ROOT) ; -- not available
"RTN","ORWRP",136,0)
 D SETITEM(.ROOT,"Report not available at this time.")
"RTN","ORWRP",137,0)
 Q
"RTN","ORWRP",138,0)
START(RM,GOTO,ORIOSL) ;
"RTN","ORWRP",139,0)
 ;RM=Right margin
"RTN","ORWRP",140,0)
 N ZTQUEUED,ORHFS,ORSUB,ORIO,ORHANDLE,IOM,IOSL,IOST,IOF,IOT,IOS
"RTN","ORWRP",141,0)
 S ORHFS=$$HFS(),ORSUB="ORDATA",ORHANDLE="ORWRP"
"RTN","ORWRP",142,0)
 D HFSOPEN(ORHANDLE,ORHFS,"W")
"RTN","ORWRP",143,0)
 I POP D  Q
"RTN","ORWRP",144,0)
 . I $D(ROOT) D SETITEM(.ROOT,"ERROR: Unable to open HFS file")
"RTN","ORWRP",145,0)
 D IOVAR(.ORIO,.RM,.ORIOSL)
"RTN","ORWRP",146,0)
 N $ETRAP,$ESTACK
"RTN","ORWRP",147,0)
 S $ETRAP="D ERR^ORWRP Q"
"RTN","ORWRP",148,0)
 U IO
"RTN","ORWRP",149,0)
 D @GOTO
"RTN","ORWRP",150,0)
 D HFSCLOSE(ORHANDLE,ORHFS)
"RTN","ORWRP",151,0)
 Q
"RTN","ORWRP",152,0)
ERR ;Error trap
"RTN","ORWRP",153,0)
 S $ETRAP="D UNWIND^ORWRP Q"
"RTN","ORWRP",154,0)
 N %ZIS
"RTN","ORWRP",155,0)
 S %ZIS="0N"
"RTN","ORWRP",156,0)
 D @^%ZOSF("ERRTN") ;file error
"RTN","ORWRP",157,0)
 I $D(ORHANDLE) D CLOSE^%ZISH(ORHANDLE)
"RTN","ORWRP",158,0)
 I $D(ORHFS) D
"RTN","ORWRP",159,0)
 . N ORARR,OROK
"RTN","ORWRP",160,0)
 . S ORARR(ORHFS)="",OROK=$$DEL^%ZISH("",$NA(ORARR)) ;delete HFS file
"RTN","ORWRP",161,0)
 S $ECODE=",UOR69 error during CPRS report build,"
"RTN","ORWRP",162,0)
 Q
"RTN","ORWRP",163,0)
UNWIND ;Unwind Error stack
"RTN","ORWRP",164,0)
 Q:$ESTACK>1  ;pop stack
"RTN","ORWRP",165,0)
 ;
"RTN","ORWRP",166,0)
 Q
"RTN","ORWRP",167,0)
HFS() ; -- get hfs file name
"RTN","ORWRP",168,0)
 N H
"RTN","ORWRP",169,0)
 S H=$H
"RTN","ORWRP",170,0)
 Q "ORU_"_$J_"_"_$P(H,",")_"_"_$P(H,",",2)_".DAT"
"RTN","ORWRP",171,0)
HFSOPEN(HANDLE,ORHFS,ORMODE) ;
"RTN","ORWRP",172,0)
 D OPEN^%ZISH(HANDLE,,ORHFS,$G(ORMODE,"W")) Q:POP
"RTN","ORWRP",173,0)
 Q
"RTN","ORWRP",174,0)
IOVAR(ORIO,ORRM,ORIOSL,ORIOST,ORIOF,ORIOT) ;Setup IO variables based on IO Device
"RTN","ORWRP",175,0)
 N IFN,IFN1
"RTN","ORWRP",176,0)
 S ORIO=$G(ORIO,"OR WORKSTATION"),ION=ORIO,IOM=$G(ORRM,80),IOSL=$G(ORIOSL,62),IOST=$G(ORIOST,"P-OTHER"),IOF=$G(ORIOF,""""""),IOT=$G(ORIOT,"HFS")
"RTN","ORWRP",177,0)
 I $O(^%ZIS(1,"B",ORIO,0)) S IFN=$O(^(0)),IOS=IFN
"RTN","ORWRP",178,0)
 I $D(^%ZIS(1,IFN,0)) S IOST(0)=+$G(^("SUBTYPE")),IOT=$G(ORIOT,^("TYPE")),IOST=$G(ORIOST,$P($G(^%ZIS(2,IOST(0),0),IOST),"^"))
"RTN","ORWRP",179,0)
 I $O(^%ZIS(2,"B",IOST,0)) S IFN=$O(^(0)) I IFN S IOST(0)=IFN,IFN1=$G(^%ZIS(2,IFN,1)),IOM=$G(ORRM,$P(IFN1,"^")),IOF=$G(ORIOF,$P(IFN1,"^",2)),IOSL=$G(ORIOSL,$P(IFN1,"^",3))
"RTN","ORWRP",180,0)
 Q
"RTN","ORWRP",181,0)
HFSCLOSE(HANDLE,ORHFS) ;Close HFS and unload data
"RTN","ORWRP",182,0)
 N ORDEL,X,%ZIS
"RTN","ORWRP",183,0)
 S %ZIS="0N"
"RTN","ORWRP",184,0)
 I IO[ORHFS D CLOSE^%ZISH(HANDLE)
"RTN","ORWRP",185,0)
 S ROOT=$NA(^TMP(ORSUB,$J,1)),ORDEL(ORHFS)=""
"RTN","ORWRP",186,0)
 K @ROOT
"RTN","ORWRP",187,0)
 S X=$$FTG^%ZISH(,ORHFS,$NA(@ROOT@(1)),4)
"RTN","ORWRP",188,0)
 D STRIP
"RTN","ORWRP",189,0)
 S X=$$DEL^%ZISH(,$NA(ORDEL))
"RTN","ORWRP",190,0)
 Q
"RTN","ORWRP",191,0)
USEHFS ; -- use host file to build global array
"RTN","ORWRP",192,0)
 N OROK,SECTION
"RTN","ORWRP",193,0)
 S SECTION=0
"RTN","ORWRP",194,0)
 D INIT
"RTN","ORWRP",195,0)
 S OROK=$$FTG^%ZISH(,ORHFS,$NA(@ROOT@(1)),4) I 'OROK Q
"RTN","ORWRP",196,0)
 D STRIP
"RTN","ORWRP",197,0)
 N ORARR S ORARR(ORHFS)=""
"RTN","ORWRP",198,0)
 S OROK=$$DEL^%ZISH("",$NA(ORARR))
"RTN","ORWRP",199,0)
 Q
"RTN","ORWRP",200,0)
INIT ; -- initialize counts and global section
"RTN","ORWRP",201,0)
 S (INC,CNT)=0,SECTION=SECTION+1,ROOT=$NA(^TMP(ORSUB,$J,SECTION))
"RTN","ORWRP",202,0)
 K @ROOT
"RTN","ORWRP",203,0)
 Q
"RTN","ORWRP",204,0)
FINAL ; -- set 'x of y' for each section CALLED FROM ^ORWLR
"RTN","ORWRP",205,0)
 N I
"RTN","ORWRP",206,0)
 F I=1:1:SECTION S ^TMP(ORSUB,$J,I,.1)=I_U_SECTION
"RTN","ORWRP",207,0)
 Q
"RTN","ORWRP",208,0)
STRIP ; -- strip off control chars
"RTN","ORWRP",209,0)
 N I,X
"RTN","ORWRP",210,0)
 S I=0 F  S I=$O(@ROOT@(I)) Q:'I  S X=^(I) D
"RTN","ORWRP",211,0)
 . I X[$C(8) D  ;BS
"RTN","ORWRP",212,0)
 .. I $L(X,$C(8))=$L(X,$C(95)) S (X,@ROOT@(I))=$TR(X,$C(8,95),"") Q  ;BS & _
"RTN","ORWRP",213,0)
 .. S (X,@ROOT@(I))=$TR(X,$C(8),"")
"RTN","ORWRP",214,0)
 . I X[$C(7)!(X[$C(12)) S @ROOT@(I)=$TR(X,$C(7,12),"") ;BEL or FF
"RTN","ORWRP",215,0)
 Q
"RTN","ORWRP",216,0)
WINDFLT(ORY) ;Windows printer as default?
"RTN","ORWRP",217,0)
 S ORY=+$$GET^XPAR("ALL","ORWDP WINPRINT DEFAULT")
"RTN","ORWRP",218,0)
 Q
"RTN","ORWRP",219,0)
GETDFPRT(Y,ORUSER,ORLOC) ; Returns default printer for user
"RTN","ORWRP",220,0)
 N IEN,X0,ENT
"RTN","ORWRP",221,0)
 S ENT="ALL"
"RTN","ORWRP",222,0)
 I $G(ORLOC) S ORLOC=+ORLOC_";SC(",ENT=ENT_"^"_ORLOC
"RTN","ORWRP",223,0)
 I +$$GET^XPAR(ENT,"ORWDP WINPRINT DEFAULT") S Y="WIN;Windows Printer" Q
"RTN","ORWRP",224,0)
 S IEN=$$GET^XPAR(ENT,"ORWDP DEFAULT PRINTER",1) Q:+IEN=0
"RTN","ORWRP",225,0)
 Q:'$D(^%ZIS(1,IEN,0))  S X0=^(0)
"RTN","ORWRP",226,0)
 S Y=IEN_";"_$P(X0,U)
"RTN","ORWRP",227,0)
 Q
"RTN","ORWRP",228,0)
SAVDFPRT(Y,ORDEV) ; Save new default printer for user
"RTN","ORWRP",229,0)
 N ORPAR,ORERR,ORWINDEF
"RTN","ORWRP",230,0)
 Q:$L(ORDEV)=0
"RTN","ORWRP",231,0)
 ; Reset Windows printer default to True/False
"RTN","ORWRP",232,0)
 S ORPAR="ORWDP WINPRINT DEFAULT"
"RTN","ORWRP",233,0)
 I ORDEV="WIN" S ORWINDEF="Y"
"RTN","ORWRP",234,0)
 E  S ORWINDEF="N"
"RTN","ORWRP",235,0)
 I $$GET^XPAR(DUZ_";VA(200,",ORPAR,1)'="" D CHG^XPAR(DUZ_";VA(200,",ORPAR,1,ORWINDEF,.ORERR)
"RTN","ORWRP",236,0)
 E  D ADD^XPAR(DUZ_";VA(200,",ORPAR,1,ORWINDEF,.ORERR)
"RTN","ORWRP",237,0)
 Q:ORDEV="WIN"
"RTN","ORWRP",238,0)
 ; If not Windows printer selected, save VistA default printer
"RTN","ORWRP",239,0)
 S ORPAR="ORWDP DEFAULT PRINTER",ORDEV="`"_ORDEV
"RTN","ORWRP",240,0)
 I $$GET^XPAR(DUZ_";VA(200,",ORPAR,1)'="" D CHG^XPAR(DUZ_";VA(200,",ORPAR,1,ORDEV,.ORERR)
"RTN","ORWRP",241,0)
 E  D ADD^XPAR(DUZ_";VA(200,",ORPAR,1,ORDEV,.ORERR)
"RTN","ORWRP",242,0)
 Q
"RTN","ORWRP3")
0^148^B10390812
"RTN","ORWRP3",1,0)
ORWRP3 ; slc/dcm - OE/RR Report Extract RPC's ; 08 May 2001  13:32PM
"RTN","ORWRP3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**109,120,132,215,243**;Dec 17, 1997;Build 242
"RTN","ORWRP3",3,0)
 ;
"RTN","ORWRP3",4,0)
 ; DBIA 4011   Access ^XWB(8994)
"RTN","ORWRP3",5,0)
 ;
"RTN","ORWRP3",6,0)
EX(ROOT,TST) ;Expand columns
"RTN","ORWRP3",7,0)
  ;TST=ptr to file 101.24
"RTN","ORWRP3",8,0)
  ;Y(i)=id^Name^Qualifier^IOM^Entry^Routine^Remote^Type^Category^RPC^ifn^sort_order^max_days^direct^hdr^fhie
"RTN","ORWRP3",9,0)
  Q:'$G(TST)
"RTN","ORWRP3",10,0)
  N J,X,X0,X1,X2,X4,RPC,HEAD,ORX0,ORX2,ORX4,ORX,ORTIMOCC,MAX
"RTN","ORWRP3",11,0)
  I '$L($G(C)) S C=0
"RTN","ORWRP3",12,0)
  S ORTIMOCC=$$GET^XPAR("USR.`"_DUZ_"^SYS^PKG","ORWRP TIME/OCC LIMITS INDV",+TST,"I")
"RTN","ORWRP3",13,0)
  I '$L(ORTIMOCC) S ORTIMOCC=$$GET^XPAR("USR.`"_DUZ_"^SYS^PKG","ORWRP TIME/OCC LIMITS ALL",1,"I")
"RTN","ORWRP3",14,0)
  S X0=$G(^ORD(101.24,+TST,0)),X2=$G(^(2)),X4=$G(^(4)),MAX=$P(X4,"^",2),X=$P($P(ORTIMOCC,";"),"-",2)
"RTN","ORWRP3",15,0)
  I $P(X4,"^",10) Q
"RTN","ORWRP3",16,0)
  I X,MAX,X>MAX S ORTIMOCC="T-"_MAX_";"_$P(ORTIMOCC,";",2,99)
"RTN","ORWRP3",17,0)
  I '$L(ORTIMOCC) S ORTIMOCC=";;"
"RTN","ORWRP3",18,0)
  I '$O(^ORD(101.24,+TST,10,0)) D  Q
"RTN","ORWRP3",19,0)
  . Q:$P(X0,"^",12)="L"
"RTN","ORWRP3",20,0)
  . S RPC=$P($G(^XWB(8994,+$P(X0,"^",13),0)),"^")  ;DBIA 4011
"RTN","ORWRP3",21,0)
  . S HEAD=$P(X0,"^")
"RTN","ORWRP3",22,0)
  . I $L($P(X2,"^",3)) S HEAD=$P(X2,"^",3)
"RTN","ORWRP3",23,0)
  . S X1=$P(X0,U,2)_U_HEAD_U_ORTIMOCC_";"_$P(X0,U,4)_U_$P(X0,U,19)_";"_$P(X0,U,20)_";"
"RTN","ORWRP3",24,0)
  . S X=X1_+$P(X0,U,21)_U_$P(X0,U,6)_U_$P(X0,U,5)_U_$P(X0,U,3)_U_$P(X0,U,12)_U_$P(X0,U,7)_U_RPC_U_+TST_U_$P(X4,U)_U_$P(X4,U,2)_U_$P(X4,U,4)_U_$P(X4,U,5)_U_$P(X4,U,8)_U_$P(X4,U,9)
"RTN","ORWRP3",25,0)
  . D SETITEM(.ROOT,X)
"RTN","ORWRP3",26,0)
  I $O(^ORD(101.24,+TST,10,0)) S ORX0=^ORD(101.24,+TST,0),ORX2=$G(^(2)),ORX4=$G(^(4)) D
"RTN","ORWRP3",27,0)
  . I $P(ORX4,"^",10) Q
"RTN","ORWRP3",28,0)
  . S RPC=$P($G(^XWB(8994,+$P(X0,"^",13),0)),"^")  ;DBIA 4011
"RTN","ORWRP3",29,0)
  . S X=ORX0,HEAD=$P(X,"^")
"RTN","ORWRP3",30,0)
  . I $L($P(ORX2,"^",3)) S HEAD=$P(ORX2,"^",3)
"RTN","ORWRP3",31,0)
  . S X1=$P(X,U,2)_U_HEAD_U_ORTIMOCC_";"_$P(X,U,4)_U_$P(X,U,19)_";"_$P(X,U,20)_";"
"RTN","ORWRP3",32,0)
  . S ORX=X1_+$P(X,U,21)_U_$P(X,U,6)_U_$P(X,U,5)_U_$P(X,U,3)_U_$P(X,U,12)_U_$P(X,U,7)_U_RPC_U_+TST_U_$P(ORX4,U)_U_$P(ORX4,U,2)_U_$P(ORX4,U,4)_U_$P(ORX4,U,5)_U_$P(ORX4,U,8)_U_$P(X4,U,9)
"RTN","ORWRP3",33,0)
  . D SETITEM(.ROOT,"[PARENT START]^"_ORX)
"RTN","ORWRP3",34,0)
  . S J=0 F  S J=$O(^ORD(101.24,+TST,10,J)) Q:J<1  S X=^(J,0) D EX(.ROOT,+X)
"RTN","ORWRP3",35,0)
  . D SETITEM(.ROOT,"[PARENT END]^"_ORX)
"RTN","ORWRP3",36,0)
  Q
"RTN","ORWRP3",37,0)
LIST(LST,TAB)       ;Get list for Reports & Labs Tab Treeview
"RTN","ORWRP3",38,0)
 N ROOT
"RTN","ORWRP3",39,0)
 S ROOT=$NA(LST)
"RTN","ORWRP3",40,0)
 K @ROOT
"RTN","ORWRP3",41,0)
 D TRY1(.ROOT,$G(TAB))
"RTN","ORWRP3",42,0)
 Q
"RTN","ORWRP3",43,0)
TRY1(ROOT,TAB)    ;Test expanding reports using established parameters
"RTN","ORWRP3",44,0)
 N I,ORLIST
"RTN","ORWRP3",45,0)
 D SETITEM(.ROOT,"[REPORT LIST]")
"RTN","ORWRP3",46,0)
 D GETLST^XPAR(.ORLIST,"ALL",$S($G(TAB)="LABS":"ORWRP REPORT LAB LIST",1:"ORWRP REPORT LIST"))
"RTN","ORWRP3",47,0)
 S I=0
"RTN","ORWRP3",48,0)
 F  S I=$O(ORLIST(I)) Q:'I  Q:'$D(^ORD(101.24,$P(ORLIST(I),"^",2),0))  D EX(.ROOT,$P(ORLIST(I),"^",2))
"RTN","ORWRP3",49,0)
 D SETITEM(.ROOT,"$$END")
"RTN","ORWRP3",50,0)
 Q
"RTN","ORWRP3",51,0)
SETITEM(ROOT,X) ; -- set item in list
"RTN","ORWRP3",52,0)
 S @ROOT@($O(@ROOT@(9999),-1)+1)=X
"RTN","ORWRP3",53,0)
 Q
"RTN","ORWRP4P")
0^152^B6881393
"RTN","ORWRP4P",1,0)
ORWRP4P  ; slc/dcm - OE/RR HDR Report Extract RPC's Outpatient Pharmacy ;9/21/05  13:21
"RTN","ORWRP4P",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,243**;Dec 17, 1997;Build 242
"RTN","ORWRP4P",3,0)
PSO ;Outpatient RX for HDR
"RTN","ORWRP4P",4,0)
 N IFN,IFN1,IFN2,X,X1,X2,X3,X10,X16,X17,XIFN,ORX,COL,CODE,I1,CNT,%DT,Y,FAC,FACU
"RTN","ORWRP4P",5,0)
 K ^TMP("ORXS",$J)
"RTN","ORWRP4P",6,0)
 S IFN=""
"RTN","ORWRP4P",7,0)
 F  S IFN=$O(^XTMP(HANDLE,"D",IFN)) Q:IFN=""  S XIFN=^(IFN) D
"RTN","ORWRP4P",8,0)
 . S X16=$P(XIFN,"^",16),X17=$P(XIFN,"^",17),X2=$P(XIFN,"^",2),FACU=X17
"RTN","ORWRP4P",9,0)
 . I X17="",X16,X16'=200 S FACU=$O(^DIC(4,"D",X16,0)) I FACU S FACU=$P(^DIC(4,FACU,0),"^")
"RTN","ORWRP4P",10,0)
 . I '$L(FACU) S FACU=$S($L($P(XIFN,"^",2)):$P(XIFN,"^",2),1:"Unknown")
"RTN","ORWRP4P",11,0)
 . S $P(XIFN,"^",2)=FACU,X10=$P($P(XIFN,"^",10),":",1,2),X3=$P($P(XIFN,"^",3),"~",2)
"RTN","ORWRP4P",12,0)
 . I X3="" S X3=$P($P(XIFN,"^",4),"~",2) ;Get NDC name if Drug name not sent
"RTN","ORWRP4P",13,0)
 . I $L(X10),$L(X3) D
"RTN","ORWRP4P",14,0)
 .. S X10=9999999-$$SETDATE^ORWRP4(X10),^TMP("ORXS",$J,FACU,X10,X3,IFN)=XIFN
"RTN","ORWRP4P",15,0)
 K ^TMP("ORXS1",$J)
"RTN","ORWRP4P",16,0)
 S FAC="",CNT=-1
"RTN","ORWRP4P",17,0)
 F  S FAC=$O(^TMP("ORXS",$J,FAC)) Q:FAC=""  S IFN="" F  S IFN=$O(^TMP("ORXS",$J,FAC,IFN)) Q:IFN=""  D
"RTN","ORWRP4P",18,0)
 . S IFN1=""
"RTN","ORWRP4P",19,0)
 . F  S IFN1=$O(^TMP("ORXS",$J,FAC,IFN,IFN1)) Q:IFN1=""  S IFN2="" F  S IFN2=$O(^TMP("ORXS",$J,FAC,IFN,IFN1,IFN2)) Q:IFN2=""  S X=^(IFN2) D
"RTN","ORWRP4P",20,0)
 .. D XSET^ORWRP4("1^"_$P(X,"^",2)) ; Facility
"RTN","ORWRP4P",21,0)
 .. D XSET^ORWRP4("2^"_IFN1) ; Drug Name
"RTN","ORWRP4P",22,0)
 .. D XSET^ORWRP4("3^"_$P($P(X,"^",3),"~")) ; Drug IEN
"RTN","ORWRP4P",23,0)
 .. D XSET^ORWRP4("4^"_$P(X,"^",5)) ; RX # 
"RTN","ORWRP4P",24,0)
 .. D XSET^ORWRP4("5^"_$P($P(X,"^",6),"~",2)) ; Status
"RTN","ORWRP4P",25,0)
 .. D XSET^ORWRP4("6^"_$P(X,"^",7)) ; Qty
"RTN","ORWRP4P",26,0)
 .. S Y=$$SETDATE^ORWRP4($P(X,"^",9)) D XSET^ORWRP4("7^"_$$DATE^ORDVU(Y)) ; Exp/Canc Date
"RTN","ORWRP4P",27,0)
 .. S Y=$$SETDATE^ORWRP4($P(X,"^",10)) D XSET^ORWRP4("8^"_$$DATE^ORDVU(Y)) ; Issue Date
"RTN","ORWRP4P",28,0)
 .. S Y=$$SETDATE^ORWRP4($P(X,"^",11)) D XSET^ORWRP4("9^"_$$DATE^ORDVU(Y)) ; Last Fill Date
"RTN","ORWRP4P",29,0)
 .. D XSET^ORWRP4("10^"_$P(X,"^",12)) ; Refills
"RTN","ORWRP4P",30,0)
 .. D XSET^ORWRP4("11^"_$P(X,"^",13)) ; Provider
"RTN","ORWRP4P",31,0)
 .. D XSET^ORWRP4("12^"_$P(X,"^",14)) ; Cost/Fill
"RTN","ORWRP4P",32,0)
 .. D XSET^ORWRP4("13^"_$S($L($P(X,"^",15))>60:"[+]",1:"")) ; [+]
"RTN","ORWRP4P",33,0)
 .. D XSET^ORWRP4("14^"_$P(X,"^",15)) ; SIG
"RTN","ORWRP4P",34,0)
 K ^XTMP(HANDLE,"D") M ^XTMP(HANDLE,"D")=^TMP("ORXS1",$J) K ^TMP("ORXS",$J),^TMP("ORXS1",$J)
"RTN","ORWRP4P",35,0)
 Q
"RTN","ORWRP4V")
0^151^B25785819
"RTN","ORWRP4V",1,0)
ORWRP4V ; slc/dcm - OE/RR HDR Report Extract RPC's Vitals;9/21/05  13:21
"RTN","ORWRP4V",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,243**;Dec 17, 1997;Build 242
"RTN","ORWRP4V",3,0)
VS ;Vitals code for HDR
"RTN","ORWRP4V",4,0)
 N I,IFN,IFN1,IFN2,X,X1,X2,X4,X5,XIFN,ORX,COL,CODE,I1,CNT,%DT,FAC,FACU,NODE,QUALIF,METHOD,UNIT
"RTN","ORWRP4V",5,0)
 K ^TMP("ORXS",$J)
"RTN","ORWRP4V",6,0)
 S IFN=""
"RTN","ORWRP4V",7,0)
 F  S IFN=$O(^XTMP(HANDLE,"D",IFN)) Q:IFN=""  S XIFN=^(IFN) D
"RTN","ORWRP4V",8,0)
 . S X11=$P(XIFN,"^",11),X12=$P(XIFN,"^",12),X2=$P(XIFN,"^",2),FACU=X12
"RTN","ORWRP4V",9,0)
 . I X12="",X11,X11'=200 S FACU=$O(^DIC(4,"D",X11,0)) I FACU S FACU=$P(^DIC(4,FACU,0),"^")
"RTN","ORWRP4V",10,0)
 . I '$L(FACU) S FACU=$S($L($P(XIFN,"^",2)):$P(XIFN,"^",2),1:"Unknown")
"RTN","ORWRP4V",11,0)
 . S $P(XIFN,"^",2)=FACU,X4=$P($P(XIFN,"^",4),":",1,2),X5=$P($P(XIFN,"^",5),"~",2)
"RTN","ORWRP4V",12,0)
 . I $P(XIFN,"^",10)'="W",$L(X5) D
"RTN","ORWRP4V",13,0)
 .. S X4=9999999-$$SETDATE^ORWRP4(X4)
"RTN","ORWRP4V",14,0)
 .. I X4=9999999 F I=.01:.01 S X4=X4+I I '$D(^TMP("ORXS",$J,FACU,X4)) Q
"RTN","ORWRP4V",15,0)
 .. S ^TMP("ORXS",$J,FACU,X4)=$P(XIFN,"^",2),^TMP("ORXS",$J,FACU,X4,X5,IFN)=XIFN
"RTN","ORWRP4V",16,0)
 K ^TMP("ORXS1",$J),^TMP("ORXS2",$J)
"RTN","ORWRP4V",17,0)
 S FAC="",CNT=-1
"RTN","ORWRP4V",18,0)
 F  S FAC=$O(^TMP("ORXS",$J,FAC)) Q:FAC=""  S IFN="" F  S IFN=$O(^TMP("ORXS",$J,FAC,IFN)) Q:IFN=""  S NODE=^(IFN) D
"RTN","ORWRP4V",19,0)
 . D XVSET("1^"_$P(NODE,"^"),1,FAC,IFN,NODE) ;Facility
"RTN","ORWRP4V",20,0)
 . I $P(IFN,".")'=9999999 D XVSET("2^"_$$DATE^ORDVU(9999999-IFN),2,FAC,IFN,NODE) ; Measurement Date/Time
"RTN","ORWRP4V",21,0)
 . I $P(IFN,".")=9999999 D XVSET("2^"_" ",2,FAC,IFN,NODE) ; Measurement Date/Time = ""
"RTN","ORWRP4V",22,0)
 . S IFN1=""
"RTN","ORWRP4V",23,0)
 . F  S IFN1=$O(^TMP("ORXS",$J,FAC,IFN,IFN1)) Q:IFN1=""  S IFN2="" F  S IFN2=$O(^TMP("ORXS",$J,FAC,IFN,IFN1,IFN2)) Q:IFN2=""  S X=^(IFN2) D
"RTN","ORWRP4V",24,0)
 .. I $$UPPER^ORU(IFN1)="TEMPERATURE" D XVSET("3^"_$P(X,"^",6),3,FAC,IFN,X) D METH(X)
"RTN","ORWRP4V",25,0)
 .. I $$UPPER^ORU(IFN1)="PULSE" D XVSET("4^"_$P(X,"^",6),4,FAC,IFN,X) D METH(X)
"RTN","ORWRP4V",26,0)
 .. I $$UPPER^ORU(IFN1)="RESPIRATION" D XVSET("5^"_$P(X,"^",6),5,FAC,IFN,X) D METH(X)
"RTN","ORWRP4V",27,0)
 .. I $$UPPER^ORU(IFN1)="BLOOD PRESSURE" D XVSET("6^"_$P(X,"^",6),6,FAC,IFN,X) D METH(X)
"RTN","ORWRP4V",28,0)
 .. I $$UPPER^ORU(IFN1)="HEIGHT" D XVSET("7^"_$P(X,"^",6),7,FAC,IFN,X) D METH(X)
"RTN","ORWRP4V",29,0)
 .. I $$UPPER^ORU(IFN1)="WEIGHT" D XVSET("8^"_$P(X,"^",6),8,FAC,IFN,X) D METH(X)
"RTN","ORWRP4V",30,0)
 .. I $$UPPER^ORU(IFN1)="PAIN" D XVSET("9^"_$P(X,"^",6),9,FAC,IFN,X) D METH(X)
"RTN","ORWRP4V",31,0)
 .. I $$UPPER^ORU(IFN1)="PULSE OXIMETRY" D
"RTN","ORWRP4V",32,0)
 ... D XVSET("10^"_$P(X,"^",6),10,FAC,IFN,X) D METH(X)
"RTN","ORWRP4V",33,0)
 ... F I=1:1:2 D
"RTN","ORWRP4V",34,0)
 .... I $L($P(X,"^",13)),$P($P($P(X,"^",13),"|",I)," ",2)["l/min" D XVSET("13^"_$P($P($P(X,"^",13),"|",I)," "),13,FAC,IFN,X) ;Flow Rate
"RTN","ORWRP4V",35,0)
 .... I $L($P(X,"^",13)),$P($P($P(X,"^",13),"|",I)," ",2)["%" D XVSET("14^"_$P($P($P(X,"^",13),"|",I)," "),14,FAC,IFN,X) ;O2 Concentration
"RTN","ORWRP4V",36,0)
 .. I $$UPPER^ORU(IFN1)="CENTRAL VENOUS PRESSURE" D XVSET("11^"_$P(X,"^",6),11,FAC,IFN,X) D METH(X)
"RTN","ORWRP4V",37,0)
 .. I $$UPPER^ORU(IFN1)="CIRCUMFERENCE/GIRTH" D XVSET("12^"_$P(X,"^",6),12,FAC,IFN,X) D METH(X)
"RTN","ORWRP4V",38,0)
 S FAC=""
"RTN","ORWRP4V",39,0)
 F  S FAC=$O(^TMP("ORXS2",$J,"METH",FAC)) Q:FAC=""  S IFN="" F  S IFN=$O(^TMP("ORXS2",$J,"METH",FAC,IFN)) Q:IFN=""  S METHOD=^(IFN,1),DATA=^(0) D
"RTN","ORWRP4V",40,0)
 .I $L(METHOD) S X=METHOD D
"RTN","ORWRP4V",41,0)
 .. D XVSET("16^"_X,16,FAC,IFN,DATA) ;Methods
"RTN","ORWRP4V",42,0)
 S FAC=""
"RTN","ORWRP4V",43,0)
 F  S FAC=$O(^TMP("ORXS2",$J,"QUAL",FAC)) Q:FAC=""  S IFN="" F  S IFN=$O(^TMP("ORXS2",$J,"QUAL",FAC,IFN)) Q:IFN=""  S QUALIF=^(IFN,1),DATA=^(0) D
"RTN","ORWRP4V",44,0)
 .I $L(QUALIF) S X=QUALIF D
"RTN","ORWRP4V",45,0)
 .. D XVSET("15^"_X,15,FAC,IFN,DATA) ;Qualifiers
"RTN","ORWRP4V",46,0)
 S FAC=""
"RTN","ORWRP4V",47,0)
 F  S FAC=$O(^TMP("ORXS2",$J,"UNIT",FAC)) Q:FAC=""  S IFN="" F  S IFN=$O(^TMP("ORXS2",$J,"UNIT",FAC,IFN)) Q:IFN=""  S UNIT=^(IFN,1),DATA=^(0) D
"RTN","ORWRP4V",48,0)
 .I $L(UNIT) S X=UNIT D
"RTN","ORWRP4V",49,0)
 .. D XVSET("17^"_X,17,FAC,IFN,DATA) ;Units
"RTN","ORWRP4V",50,0)
 K ^XTMP(HANDLE,"D")
"RTN","ORWRP4V",51,0)
 S FAC="",CNT=-1
"RTN","ORWRP4V",52,0)
 F  S FAC=$O(^TMP("ORXS1",$J,FAC)) Q:FAC=""  S IFN="" F  S IFN=$O(^TMP("ORXS1",$J,FAC,IFN)) Q:IFN=""  S IFN1="" D
"RTN","ORWRP4V",53,0)
 . F  S IFN1=$O(^TMP("ORXS1",$J,FAC,IFN,IFN1)) Q:IFN1=""  S X=^(IFN1) D
"RTN","ORWRP4V",54,0)
 .. S CNT=CNT+1,^XTMP(HANDLE,"D",CNT)=X
"RTN","ORWRP4V",55,0)
 K ^TMP("ORXS",$J),^TMP("ORXS1",$J),^TMP("ORXS2",$J)
"RTN","ORWRP4V",56,0)
 Q
"RTN","ORWRP4V",57,0)
METH(DATA) ;Get Methods, Units & Qualifiers
"RTN","ORWRP4V",58,0)
 Q:'$D(DATA)
"RTN","ORWRP4V",59,0)
 N X,D,T
"RTN","ORWRP4V",60,0)
 S X=$P($P(DATA,"^",3),"~",2),D=$P($G(DATA),"^",4),T=$P($P(DATA,"^",5),"~",2)
"RTN","ORWRP4V",61,0)
 I $L(X),$L(T),$L(D) S METHOD=$G(^TMP("ORXS2",$J,"METH",FAC,IFN,1)),METHOD=$S($L(METHOD):METHOD_" | "_T_":",1:T_":")_X,^TMP("ORXS2",$J,"METH",FAC,IFN,1)=METHOD,^(0)=DATA
"RTN","ORWRP4V",62,0)
 S X=$P($P(DATA,"^",8),"~",2)
"RTN","ORWRP4V",63,0)
 I $L(X),$L(T),$L(D) S QUALIF=$G(^TMP("ORXS2",$J,"QUAL",FAC,IFN,1)),QUALIF=$S($L(QUALIF):QUALIF_" | "_T_":",1:T_":")_X,^TMP("ORXS2",$J,"QUAL",FAC,IFN,1)=QUALIF,^(0)=DATA
"RTN","ORWRP4V",64,0)
 S X=$P($P(DATA,"^",7),"~",2)
"RTN","ORWRP4V",65,0)
 I $L(X),$L(T),$L(D) S UNIT=$G(^TMP("ORXS2",$J,"UNIT",FAC,IFN,1)),UNIT=$S($L(UNIT):UNIT_" | "_T_":",1:T_":")_X,^TMP("ORXS2",$J,"UNIT",FAC,IFN,1)=UNIT,^(0)=DATA
"RTN","ORWRP4V",66,0)
 Q
"RTN","ORWRP4V",67,0)
XVSET(X,IFN,FAC,IDT,NODE) ;Setup Vitals nodes
"RTN","ORWRP4V",68,0)
 Q:'$D(X)  Q:'$L($G(IDT))
"RTN","ORWRP4V",69,0)
 N SAVE,OIDT
"RTN","ORWRP4V",70,0)
 S SAVE=X
"RTN","ORWRP4V",71,0)
 I '$L($G(IFN)) S CNT=CNT+1,^TMP("ORXS1",$J,IDT,FAC,CNT)=$$ESCP^ORWRP4(SAVE) Q
"RTN","ORWRP4V",72,0)
 I $D(^TMP("ORXS1",$J,IDT,FAC,IFN)) D  Q  ;Get data where item, facility, date/time are the same
"RTN","ORWRP4V",73,0)
 . S OIDT=IDT
"RTN","ORWRP4V",74,0)
 . F  S IDT=IDT+.0001 Q:'$D(^TMP("ORXS1",$J,IDT,IFN))
"RTN","ORWRP4V",75,0)
 . I '$D(^TMP("ORXS1",$J,IDT,FAC,IFN)) D
"RTN","ORWRP4V",76,0)
 .. S ^TMP("ORXS1",$J,IDT,FAC,1)=$$ESCP^ORWRP4("1^"_$P($G(NODE),"^",2)) ;Facility
"RTN","ORWRP4V",77,0)
 .. S ^TMP("ORXS1",$J,IDT,FAC,2)=$$ESCP^ORWRP4("2^"_$$DATE^ORDVU($$SETDATE^ORWRP4($P($G(NODE),"^",4)))) ;Date/Time
"RTN","ORWRP4V",78,0)
 . S ^TMP("ORXS1",$J,IDT,FAC,IFN)=$$ESCP^ORWRP4(SAVE),IDT=OIDT
"RTN","ORWRP4V",79,0)
 S ^TMP("ORXS1",$J,IDT,FAC,IFN)=$$ESCP^ORWRP4(SAVE)
"RTN","ORWRP4V",80,0)
 Q
"RTN","ORWTIU")
0^52^B10078381
"RTN","ORWTIU",1,0)
ORWTIU ; slc/REV - Functions for GUI PARAMETER ACTIONS ; 08 Feb 2001  09:02AM
"RTN","ORWTIU",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,109,132,195,243**;Dec 17, 1997;Build 242
"RTN","ORWTIU",3,0)
 ;
"RTN","ORWTIU",4,0)
GTTIUCTX(Y,ORUSER) ; Returns current Notes view context for user
"RTN","ORWTIU",5,0)
 N OCCLIM,SHOWSUB
"RTN","ORWTIU",6,0)
 S Y=$$GET^XPAR("ALL","ORCH CONTEXT NOTES",1)
"RTN","ORWTIU",7,0)
 I +$P(Y,";",5)=0 D
"RTN","ORWTIU",8,0)
 . S OCCLIM=$P($$PERSPRF^TIULE(DUZ),U,10)
"RTN","ORWTIU",9,0)
 . S:+OCCLIM>0 $P(Y,";",5)=OCCLIM
"RTN","ORWTIU",10,0)
 S SHOWSUB=$P(Y,";",6)
"RTN","ORWTIU",11,0)
 S $P(Y,";",6)=$S(SHOWSUB'="":SHOWSUB,1:0)
"RTN","ORWTIU",12,0)
 Q
"RTN","ORWTIU",13,0)
SVTIUCTX(Y,ORCTXT) ; Save new Notes view preferences for user
"RTN","ORWTIU",14,0)
 N TMP
"RTN","ORWTIU",15,0)
 S TMP=$$GET^XPAR(DUZ_";VA(200,","ORCH CONTEXT NOTES",1)
"RTN","ORWTIU",16,0)
 I TMP'="" D  Q
"RTN","ORWTIU",17,0)
 . D CHG^XPAR(DUZ_";VA(200,","ORCH CONTEXT NOTES",1,ORCTXT)
"RTN","ORWTIU",18,0)
 D ADD^XPAR(DUZ_";VA(200,","ORCH CONTEXT NOTES",1,ORCTXT)
"RTN","ORWTIU",19,0)
 Q
"RTN","ORWTIU",20,0)
 ;
"RTN","ORWTIU",21,0)
GTDCCTX(Y,ORUSER) ; Returns current DC Summary view context for user
"RTN","ORWTIU",22,0)
 N OCCLIM,SHOWSUB
"RTN","ORWTIU",23,0)
 S Y=$$GET^XPAR("ALL","ORCH CONTEXT SUMMRIES",1)
"RTN","ORWTIU",24,0)
 I +$P(Y,";",5)=0 D
"RTN","ORWTIU",25,0)
 . S OCCLIM=$P($$PERSPRF^TIULE(DUZ),U,10)
"RTN","ORWTIU",26,0)
 . S:+OCCLIM>0 $P(Y,";",5)=OCCLIM
"RTN","ORWTIU",27,0)
 S SHOWSUB=$P(Y,";",6)
"RTN","ORWTIU",28,0)
 S $P(Y,";",6)=$S(SHOWSUB'="":SHOWSUB,1:0)
"RTN","ORWTIU",29,0)
 Q
"RTN","ORWTIU",30,0)
SVDCCTX(Y,ORCTXT) ; Save new DC Summary view preferences for user
"RTN","ORWTIU",31,0)
 N TMP
"RTN","ORWTIU",32,0)
 S TMP=$$GET^XPAR(DUZ_";VA(200,","ORCH CONTEXT SUMMRIES",1)
"RTN","ORWTIU",33,0)
 I TMP'="" D  Q
"RTN","ORWTIU",34,0)
 . D CHG^XPAR(DUZ_";VA(200,","ORCH CONTEXT SUMMRIES",1,ORCTXT)
"RTN","ORWTIU",35,0)
 D ADD^XPAR(DUZ_";VA(200,","ORCH CONTEXT SUMMRIES",1,ORCTXT)
"RTN","ORWTIU",36,0)
 Q
"RTN","ORWTIU",37,0)
 ;
"RTN","ORWTIU",38,0)
PRINTW(ORY,ORDA,ORFLG) ;TIU print to windows printer
"RTN","ORWTIU",39,0)
 N ZTQUEUED,ORHFS,ORSUB,ORIO,ORSTATUS,ROOT,ORERR,ORWIN,ORHANDLE
"RTN","ORWTIU",40,0)
 N IOM,IOSL,IOST,IOF,IOT,IOS
"RTN","ORWTIU",41,0)
 S (ORSUB,ROOT)="ORDATA",ORIO="OR WINDOWS HFS",ORWIN=1,ORHANDLE="ORWTIU"
"RTN","ORWTIU",42,0)
 S ORY=$NA(^TMP(ORSUB,$J,1))
"RTN","ORWTIU",43,0)
 S ORHFS=$$HFS^ORWRP()
"RTN","ORWTIU",44,0)
 D HFSOPEN^ORWRP(ORHANDLE,ORHFS,"W")
"RTN","ORWTIU",45,0)
 I POP D  Q
"RTN","ORWTIU",46,0)
 . I $D(ROOT) D SETITEM^ORWRP(.ROOT,"ERROR: Unable to open HFS file for TIU print")
"RTN","ORWTIU",47,0)
 D IOVAR^ORWRP(.ORIO,,,"P-WINHFS80")
"RTN","ORWTIU",48,0)
 N $ETRAP,$ESTACK
"RTN","ORWTIU",49,0)
 S $ETRAP="D ERR^ORWRP Q"
"RTN","ORWTIU",50,0)
 U IO
"RTN","ORWTIU",51,0)
 D RPC^TIUPD(.ORERR,ORDA,ORIO,ORFLG,ORWIN)
"RTN","ORWTIU",52,0)
 D HFSCLOSE^ORWRP(ORHANDLE,ORHFS)
"RTN","ORWTIU",53,0)
 Q
"RTN","ORWTIU",54,0)
GTLSTITM(ORY,ORTIUDA) ; Return single listbox item for document
"RTN","ORWTIU",55,0)
 Q:+$G(ORTIUDA)=0
"RTN","ORWTIU",56,0)
 S ORY=ORTIUDA_U_$$RESOLVE^TIUSRVLO(ORTIUDA)
"RTN","ORWTIU",57,0)
 Q
"RTN","ORWTIU",58,0)
IDNOTES(ORY)    ; Is ID Notes installed?
"RTN","ORWTIU",59,0)
 S ORY=$$PATCH^XPDUTL("TIU*1.0*100")
"RTN","ORWTIU",60,0)
 Q
"RTN","ORWTIU",61,0)
CANLINK(ORY,ORTITLE)    ;Can the title be an ID child?
"RTN","ORWTIU",62,0)
 ; DBIA #2322
"RTN","ORWTIU",63,0)
 S ORY=$$CANLINK^TIULP(ORTITLE)
"RTN","ORWTIU",64,0)
 Q
"RTN","ORWTIU",65,0)
GETCP(ORY,ORTIUDA) ; Checks required CP fields before signature
"RTN","ORWTIU",66,0)
 S ORY=""
"RTN","ORWTIU",67,0)
 N ORTITLE,ORAUTH,ORCOS,ORPSUMCD,ORPROCDT,ORROOT,ORERR,ORREFDT
"RTN","ORWTIU",68,0)
 S ORERR="",ORROOT=$NA(^TMP("ORTIU",$J))
"RTN","ORWTIU",69,0)
 D EXTRACT^TIULQ(ORTIUDA,.ORROOT,.ORERR,".01;1202;1208;70201;70202;1301",,,"I")
"RTN","ORWTIU",70,0)
 S ORTITLE=@ORROOT@(ORTIUDA,".01","I")
"RTN","ORWTIU",71,0)
 S ORAUTH=@ORROOT@(ORTIUDA,"1202","I")
"RTN","ORWTIU",72,0)
 S ORCOS=@ORROOT@(ORTIUDA,"1208","I")
"RTN","ORWTIU",73,0)
 S ORPSUMCD=@ORROOT@(ORTIUDA,"70201","I")
"RTN","ORWTIU",74,0)
 S ORPROCDT=@ORROOT@(ORTIUDA,"70202","I")
"RTN","ORWTIU",75,0)
 S ORREFDT=@ORROOT@(ORTIUDA,"1301","I")
"RTN","ORWTIU",76,0)
 S ORY=ORAUTH_U_ORCOS_U_ORPSUMCD_U_ORPROCDT_U_ORTITLE_U_ORREFDT
"RTN","ORWTIU",77,0)
 K @ORROOT
"RTN","ORWTIU",78,0)
 Q
"RTN","ORWTIU",79,0)
CHKTXT(ORY,ORTIUDA) ; Checks for presence of text before signature
"RTN","ORWTIU",80,0)
 S ORY='$$EMPTYDOC^TIULF(ORTIUDA)  ;DBIA #4426
"RTN","ORWTIU",81,0)
 Q
"RTN","ORWTPD")
0^181^B13966510
"RTN","ORWTPD",1,0)
ORWTPD ; slc/jdl - Personal Reference Tool ;6/20/02 11:40am [7/22/03 11:27am]
"RTN","ORWTPD",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**109,120,132,148,141,173,195,243**;Dec 17,1997;Build 242
"RTN","ORWTPD",3,0)
 ;; Allow user to customize the CPRS reports date/time
"RTN","ORWTPD",4,0)
 ;; and max occurences setting
"RTN","ORWTPD",5,0)
 ;
"RTN","ORWTPD",6,0)
SUDF(Y,VALUE) ;----Set user default for all CPRS reports
"RTN","ORWTPD",7,0)
 N ORERR S ORERR=""
"RTN","ORWTPD",8,0)
 I VALUE=$$GET^XPAR("DIV^SYS^PKG","ORWRP TIME/OCC LIMITS ALL",1,"I") D DEL^XPAR(DUZ_";VA(200,","ORWRP TIME/OCC LIMITS ALL",1,.ORERR) K ORERR Q
"RTN","ORWTPD",9,0)
 E  D EN^XPAR(DUZ_";VA(200,","ORWRP TIME/OCC LIMITS ALL",1,VALUE,.ORERR)
"RTN","ORWTPD",10,0)
 S Y=1
"RTN","ORWTPD",11,0)
 K ORERR,VALUES1
"RTN","ORWTPD",12,0)
 Q
"RTN","ORWTPD",13,0)
 ;
"RTN","ORWTPD",14,0)
SUINDV(Y,RPTS,VALUE) ;----Set user individual time/occ setting
"RTN","ORWTPD",15,0)
 ; RPTS format: RPTIen^RPTIen^RPTIen such as 1^2^3
"RTN","ORWTPD",16,0)
 I $L(RPTS)=0 Q
"RTN","ORWTPD",17,0)
 N ORERR,RPTID,P1,P7 S ORERR=0
"RTN","ORWTPD",18,0)
 S (P1,P7)=""
"RTN","ORWTPD",19,0)
 F I=1:1:$L(RPTS,"^") S RPTID=$P(RPTS,U,I) D
"RTN","ORWTPD",20,0)
 . S P1=$P($G(^ORD(101.24,RPTID,0)),U),P7=$P($G(^(0)),U,7)
"RTN","ORWTPD",21,0)
 . I "02345"[P7,(P1'="ORRP IMAGING") D DEL^XPAR("USR.`"_DUZ,"ORWRP TIME/OCC LIMITS INDV",RPTID,.ORERR) Q
"RTN","ORWTPD",22,0)
 . D EN^XPAR(DUZ_";VA(200,","ORWRP TIME/OCC LIMITS INDV",RPTID,VALUE,.ORERR)
"RTN","ORWTPD",23,0)
 Q
"RTN","ORWTPD",24,0)
 ;
"RTN","ORWTPD",25,0)
GETIMG(Y,RPT) ; ----Get Image (local only) Time/Occ
"RTN","ORWTPD",26,0)
 N IMGID,BEG,END,MAX
"RTN","ORWTPD",27,0)
 S IMGID=0,Y=""
"RTN","ORWTPD",28,0)
 S IMGID=$O(^ORD(101.24,"B","ORRP IMAGING",0))
"RTN","ORWTPD",29,0)
 D GETINDV(.Y,IMGID)
"RTN","ORWTPD",30,0)
 I $L(Y) D
"RTN","ORWTPD",31,0)
 . S BEG=$$DT^ORCHTAB1($P(Y,";"))
"RTN","ORWTPD",32,0)
 . S END=$$DT^ORCHTAB1($P(Y,";",2))
"RTN","ORWTPD",33,0)
 . S MAX=$P(Y,";",3)
"RTN","ORWTPD",34,0)
 . S Y=BEG_"^"_END_"^"_MAX
"RTN","ORWTPD",35,0)
 I Y="" D GETDEF^ORWRA(.Y)
"RTN","ORWTPD",36,0)
 Q
"RTN","ORWTPD",37,0)
 ;
"RTN","ORWTPD",38,0)
GETINDV(Y,RPT) ;----Get time/occ limits for this report
"RTN","ORWTPD",39,0)
 ;RPT:  Report IEN of 101.24
"RTN","ORWTPD",40,0)
 N CTX,X0,X4,X,IMGCTX
"RTN","ORWTPD",41,0)
 S X0=$G(^ORD(101.24,RPT,0)),X4=$G(^(4))
"RTN","ORWTPD",42,0)
 I "02345"[($P(X0,U,7)),($P(X0,U)'="ORRP IMAGING") Q
"RTN","ORWTPD",43,0)
 S CTX="^DIV^SYS^PKG"
"RTN","ORWTPD",44,0)
 S Y=$$GET^XPAR("USR.`"_DUZ_CTX,"ORWRP TIME/OCC LIMITS INDV",RPT,"I")
"RTN","ORWTPD",45,0)
 S:'$L(Y) Y=$$GET^XPAR("USR.`"_DUZ_CTX,"ORWRP TIME/OCC LIMITS ALL",1,"I")
"RTN","ORWTPD",46,0)
 I $P(^ORD(101.24,RPT,0),U,7)=1 S $P(Y,";",3)=""
"RTN","ORWTPD",47,0)
 I $P(X4,"^",2) S X=$P($P(Y,";"),"-",2) I X,X>$P(X4,"^",2) S Y="T-"_$P(X4,"^",2)_";"_$P(Y,";",2,99)
"RTN","ORWTPD",48,0)
 Q
"RTN","ORWTPD",49,0)
 ;
"RTN","ORWTPD",50,0)
GETSETS(Y) ;----Get time/occ limit set for each report
"RTN","ORWTPD",51,0)
 N I,CNT,CAT,SEC
"RTN","ORWTPD",52,0)
 S I=0,CNT=1,RST=""
"RTN","ORWTPD",53,0)
 F  S I=$O(^ORD(101.24,I)) Q:'I   D
"RTN","ORWTPD",54,0)
 . I $P($G(^ORD(101.24,I,0)),U,12)'="M" D
"RTN","ORWTPD",55,0)
 .. S CAT=$P(^ORD(101.24,I,0),U,7),SEC=$P(^(0),U,8)
"RTN","ORWTPD",56,0)
 .. I $S(CAT=1:1,CAT=6:1,1:0)!($P(^(0),U)="ORRP IMAGING") D
"RTN","ORWTPD",57,0)
 ... D GETINDV(.RST,I)
"RTN","ORWTPD",58,0)
 ... I $L($P(^ORD(101.24,I,2),U,4))>0 S Y(CNT)=I_U_$P(^(2),U,4)_" ["_SEC_"]"_U_RST
"RTN","ORWTPD",59,0)
 ... E  S Y(CNT)=I_U_$P(^ORD(101.24,I,2),U,3)_" ["_SEC_"]"_U_RST
"RTN","ORWTPD",60,0)
 ... S CNT=CNT+1
"RTN","ORWTPD",61,0)
 K I,CNT,RST,CAT
"RTN","ORWTPD",62,0)
 Q
"RTN","ORWTPD",63,0)
 ;
"RTN","ORWTPD",64,0)
GETDFLT(Y) ;----Get default time/occ limits for all reports
"RTN","ORWTPD",65,0)
 N VALUE
"RTN","ORWTPD",66,0)
 S Y=$$GET^XPAR("USR.`"_DUZ_"^DIV^SYS^PKG","ORWRP TIME/OCC LIMITS ALL",1,"I")
"RTN","ORWTPD",67,0)
 K VALUE
"RTN","ORWTPD",68,0)
 Q
"RTN","ORWTPD",69,0)
 ;
"RTN","ORWTPD",70,0)
RSDFLT(Y) ;----Retrieve sys/pkg level default time/occ setting
"RTN","ORWTPD",71,0)
 N VALUE
"RTN","ORWTPD",72,0)
 S Y=$$GET^XPAR("DIV^SYS^PKG","ORWRP TIME/OCC LIMITS ALL",1,"I")
"RTN","ORWTPD",73,0)
 Q
"RTN","ORWTPD",74,0)
 ;
"RTN","ORWTPD",75,0)
DELDFLT(Y) ;----Delete user's default setting 
"RTN","ORWTPD",76,0)
 N ORERR S ORERR=""
"RTN","ORWTPD",77,0)
 D NDEL^XPAR(DUZ_";VA(200,","ORWRP TIME/OCC LIMITS INDV",.ORERR)
"RTN","ORWTPD",78,0)
 D DEL^XPAR(DUZ_";VA(200,","ORWRP TIME/OCC LIMITS ALL",1,.ORERR)
"RTN","ORWTPD",79,0)
 K ORERR
"RTN","ORWTPD",80,0)
 Q
"RTN","ORWTPD",81,0)
 ;
"RTN","ORWTPD",82,0)
ACTDF(Y) ;----Make default setting take action for each report
"RTN","ORWTPD",83,0)
 N IND,DFLT,VALUE,X,X0,X4,MAX,DFLT1
"RTN","ORWTPD",84,0)
 S DFLT=$$GET^XPAR("USR.`"_DUZ_"^DIV^SYS^PKG","ORWRP TIME/OCC LIMITS ALL",1,"I")
"RTN","ORWTPD",85,0)
 S IND=0,X=$P($P(DFLT,";"),"-",2)
"RTN","ORWTPD",86,0)
 F  S IND=$O(^ORD(101.24,IND)) Q:'IND  S X0=$G(^(IND,0)),X4=$G(^(4)) D
"RTN","ORWTPD",87,0)
 . I $P(X0,"^",8)="R",$P(X0,"^",12)'="M" D
"RTN","ORWTPD",88,0)
 .. S MAX=$P(X4,"^",2),DFLT1=DFLT
"RTN","ORWTPD",89,0)
 .. I MAX,X,X>MAX S DFLT1="T-"_MAX_";"_$P(DFLT,";",2,99)
"RTN","ORWTPD",90,0)
 .. D SUINDV(.Y,IND,DFLT1)
"RTN","ORWTPD",91,0)
 Q
"RTN","ORWTPD",92,0)
GETOCM(ORY) ;Get value of "ORCH CONTEXT MEDS"
"RTN","ORWTPD",93,0)
 S ORY=$$GET^XPAR("ALL","ORCH CONTEXT MEDS")
"RTN","ORWTPD",94,0)
 Q
"RTN","ORWTPD",95,0)
 ;
"RTN","ORWTPD",96,0)
PUTOCM(ORY,ORVAL) ;Set value of "ORCH CONTEXT MEDS"
"RTN","ORWTPD",97,0)
 I '$L(ORVAL) D DEL^XPAR("USR.`"_DUZ,"ORCH CONTEXT MEDS",1) Q
"RTN","ORWTPD",98,0)
 N ORERR S ORERR=""
"RTN","ORWTPD",99,0)
 D EN^XPAR(DUZ_";VA(200,","ORCH CONTEXT MEDS",1,ORVAL,.ORERR)
"RTN","ORWTPD",100,0)
 S ORY=ORERR
"RTN","ORWTPD",101,0)
 Q
"RTN","ORWTPD",102,0)
 ;
"RTN","ORWTPL")
0^59^B25081990
"RTN","ORWTPL",1,0)
ORWTPL ; SLC/STAFF Personal Preference - Lists ; 3/11/08 6:36am
"RTN","ORWTPL",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**85,109,173,243**;Oct 24, 2000;Build 242
"RTN","ORWTPL",3,0)
 ;
"RTN","ORWTPL",4,0)
NEWLIST(VAL,LISTNAME,USER,ORVIZ) ; from ORWTPP
"RTN","ORWTPL",5,0)
 ; set user's new personal list
"RTN","ORWTPL",6,0)
 S LISTNAME=$G(LISTNAME)
"RTN","ORWTPL",7,0)
 I '$L(LISTNAME) S VAL="^invalid list name" Q
"RTN","ORWTPL",8,0)
 I $O(^OR(100.21,"B",LISTNAME,0)) S VAL="^invalid list name - duplicate of another name" Q
"RTN","ORWTPL",9,0)
 ;*** check input transform, duplicate name for same user
"RTN","ORWTPL",10,0)
 N DA,DIK,NUM
"RTN","ORWTPL",11,0)
 L +^OR(100.21,0):20 I '$T S VAL="^unable to set up" Q
"RTN","ORWTPL",12,0)
 S NUM=1+$P(^OR(100.21,0),U,3)
"RTN","ORWTPL",13,0)
 F  Q:'$D(^OR(100.21,NUM,0))  S NUM=NUM+1
"RTN","ORWTPL",14,0)
 S $P(^OR(100.21,0),U,3)=NUM,$P(^(0),U,4)=$P(^(0),U,4)+1
"RTN","ORWTPL",15,0)
 S ^OR(100.21,NUM,0)=LISTNAME_"^P"
"RTN","ORWTPL",16,0)
 L -^OR(100.21,0)
"RTN","ORWTPL",17,0)
 K ^OR(100.21,NUM,1),^(2),^(10)
"RTN","ORWTPL",18,0)
 S ^OR(100.21,NUM,1,0)="^100.212PA^"_USER_"^1"
"RTN","ORWTPL",19,0)
 S ^OR(100.21,NUM,1,USER,0)=USER
"RTN","ORWTPL",20,0)
 S ^OR(100.21,NUM,11)=$G(ORVIZ)_U
"RTN","ORWTPL",21,0)
 S DIK="^OR(100.21,",DA=NUM
"RTN","ORWTPL",22,0)
 D IX1^DIK
"RTN","ORWTPL",23,0)
 S VAL=NUM_U_LISTNAME_"^^^^^^^"_$G(ORVIZ)
"RTN","ORWTPL",24,0)
 Q
"RTN","ORWTPL",25,0)
 ;
"RTN","ORWTPL",26,0)
DELLIST(OK,LISTNUM,USER) ; from ORWTPP
"RTN","ORWTPL",27,0)
 ; delete user's personal list
"RTN","ORWTPL",28,0)
 N DA,DIK
"RTN","ORWTPL",29,0)
 S LISTNUM=+$G(LISTNUM),OK=1
"RTN","ORWTPL",30,0)
 I '$O(^OR(100.21,"C",USER,LISTNUM,0)) S OK=0 Q
"RTN","ORWTPL",31,0)
 I $P($G(^OR(100.21,LISTNUM,0)),U,2)'="P" S OK=0 Q
"RTN","ORWTPL",32,0)
 S DA=LISTNUM,DIK="^OR(100.21,"
"RTN","ORWTPL",33,0)
 D ^DIK
"RTN","ORWTPL",34,0)
 Q
"RTN","ORWTPL",35,0)
 ;
"RTN","ORWTPL",36,0)
SAVELIST(OK,PLIST,LISTNUM,USER,ORVIZ) ; from ORWTPP
"RTN","ORWTPL",37,0)
 ; save user's personal list changes
"RTN","ORWTPL",38,0)
 N CNT,DA,DFN,DIK,NUM K DA
"RTN","ORWTPL",39,0)
 S LISTNUM=+$G(LISTNUM),OK=1
"RTN","ORWTPL",40,0)
 I $P($G(^OR(100.21,LISTNUM,0)),U,2)'="P" S OK=0 Q
"RTN","ORWTPL",41,0)
 I '$D(^OR(100.21,"C",USER,LISTNUM)) S OK=0 Q
"RTN","ORWTPL",42,0)
 I '$D(^OR(100.21,LISTNUM,10,0))#2 S ^(0)="^100.2101AV^"
"RTN","ORWTPL",43,0)
 S DA(1)=LISTNUM,DIK="^OR(100.21,"_LISTNUM_",10,"
"RTN","ORWTPL",44,0)
 S DA=0 F  S DA=$O(^OR(100.21,LISTNUM,10,DA)) Q:DA<1  D ^DIK
"RTN","ORWTPL",45,0)
 K DA
"RTN","ORWTPL",46,0)
 S CNT=0
"RTN","ORWTPL",47,0)
 S NUM=0 F  S NUM=$O(PLIST(NUM)) Q:NUM<1  D
"RTN","ORWTPL",48,0)
 .S DFN=+PLIST(NUM) I 'DFN Q
"RTN","ORWTPL",49,0)
 .S CNT=CNT+1
"RTN","ORWTPL",50,0)
 .S ^OR(100.21,LISTNUM,10,CNT,0)=DFN_";DPT("
"RTN","ORWTPL",51,0)
 S ^OR(100.21,LISTNUM,10,0)="^100.2101AV^"_CNT_U_CNT
"RTN","ORWTPL",52,0)
 S ^OR(100.21,LISTNUM,11)=$G(ORVIZ)_U
"RTN","ORWTPL",53,0)
 S DA=LISTNUM,DIK="^OR(100.21,"
"RTN","ORWTPL",54,0)
 D IX1^DIK
"RTN","ORWTPL",55,0)
 Q
"RTN","ORWTPL",56,0)
 ;
"RTN","ORWTPL",57,0)
LSDEF(INFO,USER) ; from ORWTPP
"RTN","ORWTPL",58,0)
 ; get user's list sources
"RTN","ORWTPL",59,0)
 N TYPE
"RTN","ORWTPL",60,0)
 S INFO=""
"RTN","ORWTPL",61,0)
 F TYPE="P","S","T","W","C" D
"RTN","ORWTPL",62,0)
 .S INFO=INFO_$P($$LISTSRC^ORQPTQ11(USER,TYPE),U)_U
"RTN","ORWTPL",63,0)
 Q
"RTN","ORWTPL",64,0)
 ;
"RTN","ORWTPL",65,0)
SORTDEF(SORT,USER) ; from ORWTPP
"RTN","ORWTPL",66,0)
 ; get user's sort order - Modified by PKS - 8/30/2001
"RTN","ORWTPL",67,0)
 N ORSECT
"RTN","ORWTPL",68,0)
 S ORSECT=$G(^VA(200,USER,5))
"RTN","ORWTPL",69,0)
 I +ORSECT>0 S ORSECT=$P(ORSECT,U)
"RTN","ORWTPL",70,0)
 S SORT=$$GET^XPAR("USR.`"_USER_"^SRV.`"_$G(ORSECT)_"^DIV^SYS^PKG","ORLP DEFAULT LIST ORDER",1,"I") I SORT']"" S SORT="A"
"RTN","ORWTPL",71,0)
 Q
"RTN","ORWTPL",72,0)
 ;
"RTN","ORWTPL",73,0)
CLDAYS(DAYS,USER) ; from ORWTPP
"RTN","ORWTPL",74,0)
 ; get user's clinic defaults
"RTN","ORWTPL",75,0)
 N DAY
"RTN","ORWTPL",76,0)
 S DAYS=""
"RTN","ORWTPL",77,0)
 F DAY="MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY","SUNDAY" D
"RTN","ORWTPL",78,0)
 .S DAYS=DAYS_$$GET^XPAR("USR.`"_USER,"ORLP DEFAULT CLINIC "_DAY,1,"I")_U
"RTN","ORWTPL",79,0)
 Q
"RTN","ORWTPL",80,0)
 ;
"RTN","ORWTPL",81,0)
CLRANGE(RANGE,USER) ; from ORWTPP
"RTN","ORWTPL",82,0)
 ; get user's default clinic start, stop dates
"RTN","ORWTPL",83,0)
 N RNG
"RTN","ORWTPL",84,0)
 S RANGE=""
"RTN","ORWTPL",85,0)
 F RNG="START","STOP" D
"RTN","ORWTPL",86,0)
 .S RANGE=RANGE_$$GET^XPAR("USR.`"_USER,"ORLP DEFAULT CLINIC "_RNG_" DATE",1,"I")_U
"RTN","ORWTPL",87,0)
 Q
"RTN","ORWTPL",88,0)
 ;
"RTN","ORWTPL",89,0)
SAVECD(OK,INFO,USER) ; from ORWTPP
"RTN","ORWTPL",90,0)
 ; save user's clinic defaults
"RTN","ORWTPL",91,0)
 N FRI,MON,SAT,START,STOP,SUN,THURS,TUES,WED
"RTN","ORWTPL",92,0)
 S OK=1
"RTN","ORWTPL",93,0)
 S START=+$P(INFO,U,1) S START=$S(START=0:"T",START<0:"T"_START,1:"T+"_START)
"RTN","ORWTPL",94,0)
 S STOP=+$P(INFO,U,2) S STOP=$S(STOP=0:"T",STOP<0:"T"_STOP,1:"T+"_STOP)
"RTN","ORWTPL",95,0)
 S MON=+$P(INFO,U,3),MON=$S('MON:"@",1:"`"_MON)
"RTN","ORWTPL",96,0)
 S TUES=+$P(INFO,U,4),TUES=$S('TUES:"@",1:"`"_TUES)
"RTN","ORWTPL",97,0)
 S WED=+$P(INFO,U,5),WED=$S('WED:"@",1:"`"_WED)
"RTN","ORWTPL",98,0)
 S THURS=+$P(INFO,U,6),THURS=$S('THURS:"@",1:"`"_THURS)
"RTN","ORWTPL",99,0)
 S FRI=+$P(INFO,U,7),FRI=$S('FRI:"@",1:"`"_FRI)
"RTN","ORWTPL",100,0)
 S SAT=+$P(INFO,U,8),SAT=$S('SAT:"@",1:"`"_SAT)
"RTN","ORWTPL",101,0)
 S SUN=+$P(INFO,U,9),SUN=$S('SUN:"@",1:"`"_SUN)
"RTN","ORWTPL",102,0)
 D EN^XPAR(USER_";VA(200,","ORLP DEFAULT CLINIC START DATE",1,START)
"RTN","ORWTPL",103,0)
 D EN^XPAR(USER_";VA(200,","ORLP DEFAULT CLINIC STOP DATE",1,STOP)
"RTN","ORWTPL",104,0)
 D EN^XPAR(USER_";VA(200,","ORLP DEFAULT CLINIC MONDAY",1,MON)
"RTN","ORWTPL",105,0)
 D EN^XPAR(USER_";VA(200,","ORLP DEFAULT CLINIC TUESDAY",1,TUES)
"RTN","ORWTPL",106,0)
 D EN^XPAR(USER_";VA(200,","ORLP DEFAULT CLINIC WEDNESDAY",1,WED)
"RTN","ORWTPL",107,0)
 D EN^XPAR(USER_";VA(200,","ORLP DEFAULT CLINIC THURSDAY",1,THURS)
"RTN","ORWTPL",108,0)
 D EN^XPAR(USER_";VA(200,","ORLP DEFAULT CLINIC FRIDAY",1,FRI)
"RTN","ORWTPL",109,0)
 D EN^XPAR(USER_";VA(200,","ORLP DEFAULT CLINIC SATURDAY",1,SAT)
"RTN","ORWTPL",110,0)
 D EN^XPAR(USER_";VA(200,","ORLP DEFAULT CLINIC SUNDAY",1,SUN)
"RTN","ORWTPL",111,0)
 Q
"RTN","ORWTPL",112,0)
 ;
"RTN","ORWTPL",113,0)
SAVEPLD(OK,INFO,USER) ; from ORWTPP
"RTN","ORWTPL",114,0)
 ; save user's clinic defaults
"RTN","ORWTPL",115,0)
 N PROV,SORT,SOURCE,SPEC,TEAM,WARD
"RTN","ORWTPL",116,0)
 S OK=1
"RTN","ORWTPL",117,0)
 S SOURCE=$P(INFO,U,1)
"RTN","ORWTPL",118,0)
 S SORT=$P(INFO,U,2)
"RTN","ORWTPL",119,0)
 S PROV=+$P(INFO,U,3),PROV=$S('PROV:"@",1:"`"_PROV)
"RTN","ORWTPL",120,0)
 S SPEC=+$P(INFO,U,4),SPEC=$S('SPEC:"@",1:"`"_SPEC)
"RTN","ORWTPL",121,0)
 S TEAM=+$P(INFO,U,5),TEAM=$S('TEAM:"@",1:"`"_TEAM)
"RTN","ORWTPL",122,0)
 S WARD=+$P(INFO,U,6),WARD=$S('WARD:"@",1:"`"_WARD)
"RTN","ORWTPL",123,0)
 D EN^XPAR(USER_";VA(200,","ORLP DEFAULT LIST SOURCE",1,SOURCE)
"RTN","ORWTPL",124,0)
 D EN^XPAR(USER_";VA(200,","ORLP DEFAULT LIST ORDER",1,SORT)
"RTN","ORWTPL",125,0)
 D EN^XPAR(USER_";VA(200,","ORLP DEFAULT PROVIDER",1,PROV)
"RTN","ORWTPL",126,0)
 D EN^XPAR(USER_";VA(200,","ORLP DEFAULT SPECIALTY",1,SPEC)
"RTN","ORWTPL",127,0)
 D EN^XPAR(USER_";VA(200,","ORLP DEFAULT TEAM",1,TEAM)
"RTN","ORWTPL",128,0)
 D EN^XPAR(USER_";VA(200,","ORLP DEFAULT WARD",1,WARD)
"RTN","ORWTPL",129,0)
 Q
"RTN","ORWTPP")
0^60^B19368874
"RTN","ORWTPP",1,0)
ORWTPP ; SLC/STAFF Personal Preference - Personal ; 3/11/08 6:34am
"RTN","ORWTPP",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**85,149,243**;Oct 24, 2000;Build 242
"RTN","ORWTPP",3,0)
 ;
"RTN","ORWTPP",4,0)
NEWLIST(VAL,LISTNAME,ORVIZ) ; RPC
"RTN","ORWTPP",5,0)
 ; set current user's new personal list
"RTN","ORWTPP",6,0)
 D NEWLIST^ORWTPL(.VAL,LISTNAME,DUZ,$G(ORVIZ))
"RTN","ORWTPP",7,0)
 Q
"RTN","ORWTPP",8,0)
 ;
"RTN","ORWTPP",9,0)
DELLIST(OK,LISTNUM) ; RPC
"RTN","ORWTPP",10,0)
 ; delete current user's personal list
"RTN","ORWTPP",11,0)
 D DELLIST^ORWTPL(.OK,LISTNUM,DUZ)
"RTN","ORWTPP",12,0)
 Q
"RTN","ORWTPP",13,0)
 ;
"RTN","ORWTPP",14,0)
SAVELIST(OK,PLIST,LISTNUM,ORVIZ) ; RPC
"RTN","ORWTPP",15,0)
 ; save current user's personal list changes
"RTN","ORWTPP",16,0)
 D SAVELIST^ORWTPL(.OK,.PLIST,LISTNUM,DUZ,$G(ORVIZ))
"RTN","ORWTPP",17,0)
 Q
"RTN","ORWTPP",18,0)
 ;
"RTN","ORWTPP",19,0)
LSDEF(INFO) ; RPC
"RTN","ORWTPP",20,0)
 ; get current user's list sources
"RTN","ORWTPP",21,0)
 D LSDEF^ORWTPL(.INFO,DUZ)
"RTN","ORWTPP",22,0)
 Q
"RTN","ORWTPP",23,0)
 ;
"RTN","ORWTPP",24,0)
SORTDEF(VALUE) ; RPC
"RTN","ORWTPP",25,0)
 ; get current user's sort order
"RTN","ORWTPP",26,0)
 D SORTDEF^ORWTPL(.VALUE,DUZ)
"RTN","ORWTPP",27,0)
 Q
"RTN","ORWTPP",28,0)
 ;
"RTN","ORWTPP",29,0)
CLDAYS(INFO) ; RPC
"RTN","ORWTPP",30,0)
 ; get current user's clinic defaults
"RTN","ORWTPP",31,0)
 D CLDAYS^ORWTPL(.INFO,DUZ)
"RTN","ORWTPP",32,0)
 Q
"RTN","ORWTPP",33,0)
 ;
"RTN","ORWTPP",34,0)
CLRANGE(INFO) ; RPC
"RTN","ORWTPP",35,0)
 ; get current user's default clinic start, stop dates
"RTN","ORWTPP",36,0)
 D CLRANGE^ORWTPL(.INFO,DUZ)
"RTN","ORWTPP",37,0)
 Q
"RTN","ORWTPP",38,0)
 ;
"RTN","ORWTPP",39,0)
SAVECD(OK,INFO) ; RPC
"RTN","ORWTPP",40,0)
 ; save current user's clinic defaults
"RTN","ORWTPP",41,0)
 D SAVECD^ORWTPL(.OK,INFO,DUZ)
"RTN","ORWTPP",42,0)
 Q
"RTN","ORWTPP",43,0)
 ;
"RTN","ORWTPP",44,0)
SAVEPLD(OK,INFO) ; RPC
"RTN","ORWTPP",45,0)
 ; save current user's list selection defaults
"RTN","ORWTPP",46,0)
 D SAVEPLD^ORWTPL(.OK,INFO,DUZ)
"RTN","ORWTPP",47,0)
 Q
"RTN","ORWTPP",48,0)
 ;
"RTN","ORWTPP",49,0)
CSLAB(INFO) ; RPC
"RTN","ORWTPP",50,0)
 ; get lab date range defaults
"RTN","ORWTPP",51,0)
 D CSLAB^ORWTPO(.INFO,DUZ)
"RTN","ORWTPP",52,0)
 Q
"RTN","ORWTPP",53,0)
 ;
"RTN","ORWTPP",54,0)
CSARNG(INFO) ; RPC
"RTN","ORWTPP",55,0)
 ; get current user's start, stop defaults
"RTN","ORWTPP",56,0)
 D CSARNG^ORWTPO(.INFO,DUZ)
"RTN","ORWTPP",57,0)
 Q
"RTN","ORWTPP",58,0)
 ;
"RTN","ORWTPP",59,0)
SAVECS(OK,INFO) ; RPC
"RTN","ORWTPP",60,0)
 ; save current user's date range defaults
"RTN","ORWTPP",61,0)
 D SAVECS^ORWTPO(.OK,INFO,DUZ)
"RTN","ORWTPP",62,0)
 Q
"RTN","ORWTPP",63,0)
 ;
"RTN","ORWTPP",64,0)
GETIMG(INFO) ; RPC
"RTN","ORWTPP",65,0)
 ; get current user's image report defaults
"RTN","ORWTPP",66,0)
 D GETIMG^ORWTPO(.INFO,DUZ)
"RTN","ORWTPP",67,0)
 Q
"RTN","ORWTPP",68,0)
 ;
"RTN","ORWTPP",69,0)
SETIMG(OK,MAX,START,STOP) ; RPC
"RTN","ORWTPP",70,0)
 ; save current user's image report defaults
"RTN","ORWTPP",71,0)
 D SETIMG^ORWTPO(.OK,MAX,START,STOP,DUZ)
"RTN","ORWTPP",72,0)
 Q
"RTN","ORWTPP",73,0)
 ;
"RTN","ORWTPP",74,0)
GETREM(VALUES) ; RPC
"RTN","ORWTPP",75,0)
 ; get current user's reminders
"RTN","ORWTPP",76,0)
 D GETREM^ORWTPR(.VALUES,DUZ)
"RTN","ORWTPP",77,0)
 Q
"RTN","ORWTPP",78,0)
 ;
"RTN","ORWTPP",79,0)
SETREM(OK,VALUES) ; RPC
"RTN","ORWTPP",80,0)
 ; set current user's reminders
"RTN","ORWTPP",81,0)
 D SETREM^ORWTPR(.OK,.VALUES,DUZ)
"RTN","ORWTPP",82,0)
 Q
"RTN","ORWTPP",83,0)
 ;
"RTN","ORWTPP",84,0)
GETOC(VALUES) ; RPC
"RTN","ORWTPP",85,0)
 ; get current user's order checks
"RTN","ORWTPP",86,0)
 D GETOC^ORWTPR(.VALUES,DUZ)
"RTN","ORWTPP",87,0)
 Q
"RTN","ORWTPP",88,0)
 ;
"RTN","ORWTPP",89,0)
SAVEOC(OK,VALUES) ; RPC
"RTN","ORWTPP",90,0)
 ; save current user's order checks
"RTN","ORWTPP",91,0)
 D SAVEOC^ORWTPR(.OK,.VALUES,DUZ)
"RTN","ORWTPP",92,0)
 Q
"RTN","ORWTPP",93,0)
 ;
"RTN","ORWTPP",94,0)
GETNOT(VALUES) ; RPC
"RTN","ORWTPP",95,0)
 ; get current user's notifications
"RTN","ORWTPP",96,0)
 D GETNOT^ORWTPR(.VALUES,DUZ)
"RTN","ORWTPP",97,0)
 Q
"RTN","ORWTPP",98,0)
 ;
"RTN","ORWTPP",99,0)
SAVENOT(OK,VALUES) ; RPC
"RTN","ORWTPP",100,0)
 ; save current user's notifications
"RTN","ORWTPP",101,0)
 D SAVENOT^ORWTPR(.OK,.VALUES,DUZ)
"RTN","ORWTPP",102,0)
 Q
"RTN","ORWTPP",103,0)
 ;
"RTN","ORWTPP",104,0)
CLEARNOT(OK) ; RPC
"RTN","ORWTPP",105,0)
 ; clear current user's notifications
"RTN","ORWTPP",106,0)
 D CLEARNOT^ORWTPR(.OK,DUZ)
"RTN","ORWTPP",107,0)
 Q
"RTN","ORWTPP",108,0)
 ;
"RTN","ORWTPP",109,0)
GETNOTO(INFO) ; RPC
"RTN","ORWTPP",110,0)
 ; get current user's other info for notifications
"RTN","ORWTPP",111,0)
 D GETNOTO^ORWTPR(.INFO,DUZ)
"RTN","ORWTPP",112,0)
 Q
"RTN","ORWTPP",113,0)
 ;
"RTN","ORWTPP",114,0)
CHKSURR(OK,SURR) ; RPC
"RTN","ORWTPP",115,0)
 ; check if current user's surrogate is valid
"RTN","ORWTPP",116,0)
 S OK=$$CHKSURR^ORWTPUA(DUZ,SURR)
"RTN","ORWTPP",117,0)
 Q
"RTN","ORWTPP",118,0)
 ;
"RTN","ORWTPP",119,0)
GETSURR(INFO) ; RPC
"RTN","ORWTPP",120,0)
 ; get current user's surrogate info
"RTN","ORWTPP",121,0)
 D GETSURR^ORWTPR(.INFO,DUZ)
"RTN","ORWTPP",122,0)
 Q
"RTN","ORWTPP",123,0)
 ;
"RTN","ORWTPP",124,0)
SAVESURR(OK,INFO) ; RPC
"RTN","ORWTPP",125,0)
 ; save current user's surrogate info
"RTN","ORWTPP",126,0)
 D SAVESURR^ORWTPR(.OK,INFO,DUZ)
"RTN","ORWTPP",127,0)
 Q
"RTN","ORWTPP",128,0)
 ;
"RTN","ORWTPP",129,0)
SAVENOTO(OK,INFO) ; RPC
"RTN","ORWTPP",130,0)
 ; save current user's notification info
"RTN","ORWTPP",131,0)
 D SAVENOTO^ORWTPR(.OK,INFO,DUZ)
"RTN","ORWTPP",132,0)
 Q
"RTN","ORWTPP",133,0)
 ;
"RTN","ORWTPP",134,0)
GETOTHER(INFO) ; RPC
"RTN","ORWTPP",135,0)
 ; get user's other parameter settings
"RTN","ORWTPP",136,0)
 D GETOTHER^ORWTPO(.INFO,DUZ)
"RTN","ORWTPP",137,0)
 Q
"RTN","ORWTPP",138,0)
 ;
"RTN","ORWTPP",139,0)
SETOTHER(OK,INFO) ; RPC
"RTN","ORWTPP",140,0)
 ; set current user's other parameter settings
"RTN","ORWTPP",141,0)
 D SETOTHER^ORWTPO(.OK,INFO,DUZ)
"RTN","ORWTPP",142,0)
 Q
"RTN","ORWTPP",143,0)
 ;
"RTN","ORWTPP",144,0)
GETSUB(VALUE) ; RPC
"RTN","ORWTPP",145,0)
 ; get Ask for Subject on notes for current user
"RTN","ORWTPP",146,0)
 D GETSUB^ORWTPN(.VALUE,DUZ)
"RTN","ORWTPP",147,0)
 Q
"RTN","ORWTPP",148,0)
 ;
"RTN","ORWTPP",149,0)
GETCOS(VALUES,FROM,DIR,VISITORS) ; RPC
"RTN","ORWTPP",150,0)
 ; get elgible cosigners for current user
"RTN","ORWTPP",151,0)
 I '$G(VISITORS) S VISITORS=""
"RTN","ORWTPP",152,0)
 D GETCOS^ORWTPN(.VALUES,DUZ,FROM,DIR,VISITORS)
"RTN","ORWTPP",153,0)
 Q
"RTN","ORWTPP",154,0)
 ;
"RTN","ORWTPP",155,0)
GETDCOS(VALUE) ; RPC
"RTN","ORWTPP",156,0)
 ; get default cosigner for current user
"RTN","ORWTPP",157,0)
 D GETDCOS^ORWTPN(.VALUE,DUZ)
"RTN","ORWTPP",158,0)
 Q
"RTN","ORWTPP",159,0)
 ;
"RTN","ORWTPP",160,0)
SETDCOS(OK,VALUE) ; RPC
"RTN","ORWTPP",161,0)
 ; set default cosigner for current user
"RTN","ORWTPP",162,0)
 D SETDCOS^ORWTPN(.OK,VALUE,DUZ)
"RTN","ORWTPP",163,0)
 Q
"RTN","ORWTPP",164,0)
 ;
"RTN","ORWTPP",165,0)
SETSUB(OK,VALUE) ; RPC
"RTN","ORWTPP",166,0)
 ; set Ask for Subject on note for current user
"RTN","ORWTPP",167,0)
 D SETSUB^ORWTPN(.OK,VALUE,DUZ)
"RTN","ORWTPP",168,0)
 Q
"RTN","ORWTPP",169,0)
 ;
"RTN","ORWTPP",170,0)
GETTU(VALUES,CLASS) ; RPC
"RTN","ORWTPP",171,0)
 ; get titles for current user
"RTN","ORWTPP",172,0)
 D GETTU^ORWTPN(.VALUES,CLASS,DUZ)
"RTN","ORWTPP",173,0)
 Q
"RTN","ORWTPP",174,0)
 ;
"RTN","ORWTPP",175,0)
GETTD(VALUE,CLASS) ; RPC
"RTN","ORWTPP",176,0)
 ; get default title for current user
"RTN","ORWTPP",177,0)
 D GETTD^ORWTPN(.VALUE,CLASS,DUZ)
"RTN","ORWTPP",178,0)
 Q
"RTN","ORWTPP",179,0)
 ;
"RTN","ORWTPP",180,0)
SAVET(OK,CLASS,DEFAULT,VALUES) ; RPC
"RTN","ORWTPP",181,0)
 ; save titles for current user
"RTN","ORWTPP",182,0)
 D SAVET^ORWTPN(.OK,CLASS,DEFAULT,.VALUES,DUZ)
"RTN","ORWTPP",183,0)
 Q
"RTN","ORWTPP",184,0)
 ;
"RTN","ORWTPP",185,0)
PLISTS(VALUES) ; RPC
"RTN","ORWTPP",186,0)
 ; get current user's personal lists
"RTN","ORWTPP",187,0)
 D PLISTS^ORWTPT(.VALUES,DUZ)
"RTN","ORWTPP",188,0)
 Q
"RTN","ORWTPP",189,0)
 ;
"RTN","ORWTPP",190,0)
PLTEAMS(VALUES) ; RPC
"RTN","ORWTPP",191,0)
 ; get current user's teams and personal lists
"RTN","ORWTPP",192,0)
 D PLTEAMS^ORWTPT(.VALUES,DUZ)
"RTN","ORWTPP",193,0)
 Q
"RTN","ORWTPP",194,0)
 ;
"RTN","ORWTPP",195,0)
TEAMS(VALUES) ; RPC
"RTN","ORWTPP",196,0)
 ; get teams for current user
"RTN","ORWTPP",197,0)
 D TEAMS^ORWTPT(.VALUES,DUZ)
"RTN","ORWTPP",198,0)
 Q
"RTN","ORWTPP",199,0)
 ;
"RTN","ORWTPP",200,0)
ADDLIST(OK,VALUE) ; RPC
"RTN","ORWTPP",201,0)
 ; adds current user to a team
"RTN","ORWTPP",202,0)
 D ADDLIST^ORWTPT(.OK,VALUE,DUZ)
"RTN","ORWTPP",203,0)
 Q
"RTN","ORWTPP",204,0)
 ;
"RTN","ORWTPP",205,0)
REMLIST(OK,VALUE) ; RPC
"RTN","ORWTPP",206,0)
 ; removes current user from a team
"RTN","ORWTPP",207,0)
 D REMLIST^ORWTPT(.OK,VALUE,DUZ)
"RTN","ORWTPP",208,0)
 Q
"RTN","ORWTPP",209,0)
 ;
"RTN","ORWTPP",210,0)
GETCOMBO(VALUES) ; RPC
"RTN","ORWTPP",211,0)
 ; get current user's combo list definition
"RTN","ORWTPP",212,0)
 D GETCOMBO^ORWTPT(.VALUES,DUZ)
"RTN","ORWTPP",213,0)
 Q
"RTN","ORWTPP",214,0)
 ;
"RTN","ORWTPP",215,0)
SETCOMBO(OK,VALUES) ; RPC
"RTN","ORWTPP",216,0)
 ; set current user's combo list definition
"RTN","ORWTPP",217,0)
 D SETCOMBO^ORWTPT(.OK,.VALUES,DUZ)
"RTN","ORWTPP",218,0)
 Q
"RTN","ORWTPR")
0^166^B16242046
"RTN","ORWTPR",1,0)
ORWTPR ; SLC/STAFF Personal Preference - Reminders ; 4/20/07 10:00am
"RTN","ORWTPR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**85,173,215,243**;Oct 24, 2000;Build 242
"RTN","ORWTPR",3,0)
 ;
"RTN","ORWTPR",4,0)
GETREM(VALUES,USER) ; from ORWTPP
"RTN","ORWTPR",5,0)
 ; get user's reminders
"RTN","ORWTPR",6,0)
 N CLASS,CNT,ERR,IEN,NUM,OK,TMPLIST,ZERO K VALUES
"RTN","ORWTPR",7,0)
 D GETLST^XPAR(.TMPLIST,"USR.`"_USER,"ORQQPX SEARCH ITEMS","Q",.ERR)
"RTN","ORWTPR",8,0)
 S CNT=0,IEN=0 F  S IEN=$O(^PXD(811.9,IEN)) Q:IEN<1  S ZERO=$G(^(IEN,0)) I $L($P(ZERO,U,3)),'$P(ZERO,U,6) D
"RTN","ORWTPR",9,0)
 .S CNT=CNT+1
"RTN","ORWTPR",10,0)
 .S VALUES(CNT)=IEN_"^0^"_$P(ZERO,U,3)_U_$P(ZERO,U)
"RTN","ORWTPR",11,0)
 .S CLASS=$P($G(^PXD(811.9,IEN,100)),U)
"RTN","ORWTPR",12,0)
 .S $P(VALUES(CNT),U,5)=$S(CLASS="N":"NATIONAL",CLASS="L":"LOCAL",1:CLASS)
"RTN","ORWTPR",13,0)
 .S OK=0,NUM=0 F  S NUM=$O(TMPLIST(NUM)) Q:NUM<1  D  Q:OK
"RTN","ORWTPR",14,0)
 ..I IEN=$P(TMPLIST(NUM),U,2) S OK=1
"RTN","ORWTPR",15,0)
 .I OK S $P(VALUES(CNT),U,2)=$P(TMPLIST(NUM),U)
"RTN","ORWTPR",16,0)
 Q
"RTN","ORWTPR",17,0)
 ;
"RTN","ORWTPR",18,0)
SETREM(OK,VALUES,USER) ; from ORWTPP
"RTN","ORWTPR",19,0)
 ; save user's reminders
"RTN","ORWTPR",20,0)
 N NUM,ERR
"RTN","ORWTPR",21,0)
 S OK=1
"RTN","ORWTPR",22,0)
 D NDEL^XPAR("USR.`"_USER,"ORQQPX SEARCH ITEMS",.ERR)
"RTN","ORWTPR",23,0)
 S NUM=0 F  S NUM=$O(VALUES(NUM)) Q:NUM<1  D
"RTN","ORWTPR",24,0)
 .D EN^XPAR(USER_";VA(200,","ORQQPX SEARCH ITEMS",$P(VALUES(NUM),U,1),"`"_$P(VALUES(NUM),U,2),.ERR)
"RTN","ORWTPR",25,0)
 Q
"RTN","ORWTPR",26,0)
 ;
"RTN","ORWTPR",27,0)
GETOC(VALUES,USER) ; from ORWTPP
"RTN","ORWTPR",28,0)
 ; get user's order checks
"RTN","ORWTPR",29,0)
 N CNT,IEN,LIST,NUM,VAL,VALOK K LIST,VALUES
"RTN","ORWTPR",30,0)
 S IEN=0 F  S IEN=$O(^ORD(100.8,IEN)) Q:IEN<1  D
"RTN","ORWTPR",31,0)
 .S VAL=$$GET^XPAR("ALL","ORK PROCESSING FLAG",IEN,"I")
"RTN","ORWTPR",32,0)
 .I '$L(VAL) Q
"RTN","ORWTPR",33,0)
 .S VALOK=$$GET^XPAR("ALL","ORK EDITABLE BY USER",IEN,"I")
"RTN","ORWTPR",34,0)
 .S LIST(IEN)=VAL_U_VALOK
"RTN","ORWTPR",35,0)
 S NUM=0,CNT=0 F  S NUM=$O(LIST(NUM)) Q:NUM<1  D
"RTN","ORWTPR",36,0)
 .S CNT=CNT+1
"RTN","ORWTPR",37,0)
 .S VALUES(CNT)=NUM_U_$P($G(^ORD(100.8,NUM,0)),U)_U_$S($P(LIST(NUM),U)="E":"ON",1:"OFF")_U_$S($P(LIST(NUM),U,2)="0":"MANDATORY",1:"")
"RTN","ORWTPR",38,0)
 Q
"RTN","ORWTPR",39,0)
 ;
"RTN","ORWTPR",40,0)
SAVEOC(OK,VALUES,USER) ; from ORWTPP
"RTN","ORWTPR",41,0)
 ; save user's order checks
"RTN","ORWTPR",42,0)
 N NUM,ERR
"RTN","ORWTPR",43,0)
 S OK=1
"RTN","ORWTPR",44,0)
 S NUM=0 F  S NUM=$O(VALUES(NUM)) Q:NUM<1  D
"RTN","ORWTPR",45,0)
 .D EN^XPAR(USER_";VA(200,","ORK PROCESSING FLAG","`"_+VALUES(NUM),$S($P(VALUES(NUM),U,2)="ON":"E",1:"D"),.ERR)
"RTN","ORWTPR",46,0)
 Q
"RTN","ORWTPR",47,0)
 ;
"RTN","ORWTPR",48,0)
 ;
"RTN","ORWTPR",49,0)
GETNOT(VALUES,USER) ; from ORWTPP
"RTN","ORWTPR",50,0)
 ; get user's notifications
"RTN","ORWTPR",51,0)
 N CNT,IEN,NAME,RESULT K VALUES
"RTN","ORWTPR",52,0)
 S CNT=0
"RTN","ORWTPR",53,0)
 S NAME="" F  S NAME=$O(^ORD(100.9,"B",NAME)) Q:NAME=""  D
"RTN","ORWTPR",54,0)
 .S IEN=0  F  S IEN=$O(^ORD(100.9,"B",NAME,IEN)) Q:IEN<1  D
"RTN","ORWTPR",55,0)
 ..S RESULT=$$ONOFF^ORB3USER(IEN,USER,"","") I $L($G(RESULT)) D
"RTN","ORWTPR",56,0)
 ...S CNT=CNT+1
"RTN","ORWTPR",57,0)
 ...S VALUES(CNT)=IEN_U_NAME_U_$P(RESULT,U)_U_$S($$UP^XLFSTR($P(RESULT,U,3))["MANDATORY":"MANDATORY",1:"")
"RTN","ORWTPR",58,0)
 Q
"RTN","ORWTPR",59,0)
 ;
"RTN","ORWTPR",60,0)
SAVENOT(OK,VALUES,USER) ; from ORWTPP
"RTN","ORWTPR",61,0)
 ; save user's notifications
"RTN","ORWTPR",62,0)
 N ERR,NUM
"RTN","ORWTPR",63,0)
 S OK=1
"RTN","ORWTPR",64,0)
 S NUM=0 F  S NUM=$O(VALUES(NUM)) Q:NUM<1  D
"RTN","ORWTPR",65,0)
 .D EN^XPAR(USER_";VA(200,","ORB PROCESSING FLAG","`"_+VALUES(NUM),$S($P(VALUES(NUM),U,2)="ON":"E",1:"D"),.ERR)
"RTN","ORWTPR",66,0)
 Q
"RTN","ORWTPR",67,0)
 ;
"RTN","ORWTPR",68,0)
CLEARNOT(OK,USER) ; from ORWTPP
"RTN","ORWTPR",69,0)
 ; clear user's notifications
"RTN","ORWTPR",70,0)
 D RECIPURG^XQALBUTL(USER)
"RTN","ORWTPR",71,0)
 S OK=1
"RTN","ORWTPR",72,0)
 Q
"RTN","ORWTPR",73,0)
 ;
"RTN","ORWTPR",74,0)
GETNOTO(INFO,USER) ; from ORWTPP
"RTN","ORWTPR",75,0)
 ; get user's other info for notifications
"RTN","ORWTPR",76,0)
 I $$GET^XPAR("USR.`"_USER,"ORB FLAGGED ORDERS BULLETIN",1,"Q")="Y" S $P(INFO,U,2)=1
"RTN","ORWTPR",77,0)
 I $$GET^XPAR("ALL^USR.`"_USER,"ORB ERASE ALL",1,"Q") S $P(INFO,U,3)=1
"RTN","ORWTPR",78,0)
 Q
"RTN","ORWTPR",79,0)
 ;
"RTN","ORWTPR",80,0)
GETSURR(INFO,USER) ; from ORWTPP
"RTN","ORWTPR",81,0)
 ; get user's surrogate info
"RTN","ORWTPR",82,0)
 N SURR
"RTN","ORWTPR",83,0)
 D SUROLIST^XQALSURO(USER,.SURR)
"RTN","ORWTPR",84,0)
 S INFO=$G(SURR(1))
"RTN","ORWTPR",85,0)
 Q
"RTN","ORWTPR",86,0)
 ;
"RTN","ORWTPR",87,0)
SAVESURR(OK,INFO,USER) ; from ORWTPP
"RTN","ORWTPR",88,0)
 ; save user's surrogate info
"RTN","ORWTPR",89,0)
 N START,STOP,SURR,RET
"RTN","ORWTPR",90,0)
 S OK=1
"RTN","ORWTPR",91,0)
 S SURR=$P(INFO,U,1)
"RTN","ORWTPR",92,0)
 S START=$P(INFO,U,2)
"RTN","ORWTPR",93,0)
 S STOP=$P(INFO,U,3)
"RTN","ORWTPR",94,0)
 S RET=$$SAVESURR^ORWTPUA(USER,SURR,START,STOP)
"RTN","ORWTPR",95,0)
 I 'RET S OK="0^"_RET
"RTN","ORWTPR",96,0)
 Q
"RTN","ORWTPR",97,0)
 ;
"RTN","ORWTPR",98,0)
SAVENOTO(OK,INFO,USER) ; from ORWTPP
"RTN","ORWTPR",99,0)
 ; save user's notification settings
"RTN","ORWTPR",100,0)
 N ERR,FLAG,VAL
"RTN","ORWTPR",101,0)
 S OK=1
"RTN","ORWTPR",102,0)
 S FLAG=$P(INFO,U,3)
"RTN","ORWTPR",103,0)
 S VAL=$S(FLAG>0:"Y",1:"@")
"RTN","ORWTPR",104,0)
 D EN^XPAR(USER_";VA(200,","ORB FLAGGED ORDERS BULLETIN",1,VAL,.ERR)
"RTN","ORWTPR",105,0)
 Q
"RTN","ORWTPR",106,0)
 ;
"RTN","ORWTPR",107,0)
OCDESC(TEXT,IEN) ; from RPC
"RTN","ORWTPR",108,0)
 N CNT,LINE,NUM K TEXT
"RTN","ORWTPR",109,0)
 S IEN=+$G(IEN) I IEN<1 Q
"RTN","ORWTPR",110,0)
 S TEXT(1)=$P($G(^ORD(100.8,IEN,0)),U)
"RTN","ORWTPR",111,0)
 S TEXT(2)=""
"RTN","ORWTPR",112,0)
 S CNT=2
"RTN","ORWTPR",113,0)
 S NUM=0 F  S NUM=$O(^ORD(100.8,IEN,1,NUM)) Q:NUM<1  S LINE=$G(^(NUM,0)) D
"RTN","ORWTPR",114,0)
 .S CNT=CNT+1
"RTN","ORWTPR",115,0)
 .S TEXT(CNT)=LINE
"RTN","ORWTPR",116,0)
 S TEXT(CNT+1)=""
"RTN","ORWTPR",117,0)
 Q
"RTN","ORWTPR",118,0)
 ;
"RTN","ORWTPR",119,0)
NOTDESC(TEXT,IEN) ; from RPC
"RTN","ORWTPR",120,0)
 K TEXT
"RTN","ORWTPR",121,0)
 S IEN=+$G(IEN) I IEN<1 Q
"RTN","ORWTPR",122,0)
 S TEXT(1)=$P($G(^ORD(100.9,IEN,0)),U)
"RTN","ORWTPR",123,0)
 S TEXT(2)=""
"RTN","ORWTPR",124,0)
 S TEXT(3)=$P($G(^ORD(100.9,IEN,4)),U)
"RTN","ORWTPR",125,0)
 S TEXT(4)=""
"RTN","ORWTPR",126,0)
 Q
"RTN","ORWTPT")
0^57^B20925260
"RTN","ORWTPT",1,0)
ORWTPT ; SLC/STAFF Personal Preference - Teams ;5/4/01  15:55
"RTN","ORWTPT",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**85,243**;Oct 24, 2000;Build 242
"RTN","ORWTPT",3,0)
 ;
"RTN","ORWTPT",4,0)
GETTEAM(USERS,TEAM) ; RPC
"RTN","ORWTPT",5,0)
 ; returns members of a team
"RTN","ORWTPT",6,0)
 N CNT,NAME,NUM,USER K USERS
"RTN","ORWTPT",7,0)
 S TEAM=+$G(TEAM),CNT=0
"RTN","ORWTPT",8,0)
 S NUM=0 F  S NUM=$O(^OR(100.21,TEAM,1,NUM)) Q:NUM<1  S USER=+$G(^(NUM,0)) D
"RTN","ORWTPT",9,0)
 .S NAME=$P($G(^VA(200,USER,0)),U)
"RTN","ORWTPT",10,0)
 .I '$L(NAME) Q
"RTN","ORWTPT",11,0)
 .S CNT=CNT+1
"RTN","ORWTPT",12,0)
 .S USERS(CNT)=USER_U_NAME
"RTN","ORWTPT",13,0)
 Q
"RTN","ORWTPT",14,0)
 ;
"RTN","ORWTPT",15,0)
TEAMS(TEAMS,USER) ; from ORWTPP
"RTN","ORWTPT",16,0)
 ; returns all teams a user is a member of (exculdes personal lists)
"RTN","ORWTPT",17,0)
 N CNT,NUM,ZERO K TEAMS
"RTN","ORWTPT",18,0)
 S USER=+$G(USER),CNT=0
"RTN","ORWTPT",19,0)
 S NUM=0 F  S NUM=$O(^OR(100.21,"C",USER,NUM)) Q:NUM<1  D
"RTN","ORWTPT",20,0)
 .S ZERO=$G(^OR(100.21,NUM,0))
"RTN","ORWTPT",21,0)
 .I $P(ZERO,U,2)="P" Q
"RTN","ORWTPT",22,0)
 .S CNT=CNT+1
"RTN","ORWTPT",23,0)
 .S TEAMS(CNT)=NUM_U_ZERO
"RTN","ORWTPT",24,0)
 Q
"RTN","ORWTPT",25,0)
 ;
"RTN","ORWTPT",26,0)
PLISTS(TEAMS,USER) ; from ORWTPP
"RTN","ORWTPT",27,0)
 ; returns a user's personal lists
"RTN","ORWTPT",28,0)
 N CNT,NUM,ZERO K TEAMS
"RTN","ORWTPT",29,0)
 S USER=+$G(USER),CNT=0
"RTN","ORWTPT",30,0)
 S NUM=0 F  S NUM=$O(^OR(100.21,"C",USER,NUM)) Q:NUM<1  D
"RTN","ORWTPT",31,0)
 .S ZERO=$G(^OR(100.21,NUM,0))
"RTN","ORWTPT",32,0)
 .I $P(ZERO,U,2)'="P" Q
"RTN","ORWTPT",33,0)
 .S CNT=CNT+1
"RTN","ORWTPT",34,0)
 .N VIS S VIS=$P($G(^OR(100.21,NUM,11)),U)
"RTN","ORWTPT",35,0)
 .I '$L(VIS) S VIS=1
"RTN","ORWTPT",36,0)
 .S TEAMS(CNT)=NUM_U_ZERO_U_VIS
"RTN","ORWTPT",37,0)
 Q
"RTN","ORWTPT",38,0)
 ;
"RTN","ORWTPT",39,0)
PLTEAMS(TEAMS,USER) ; from ORWTPP
"RTN","ORWTPT",40,0)
 ; returns all teams and personal lists for a user
"RTN","ORWTPT",41,0)
 N CNT,NUM,ZERO K TEAMS
"RTN","ORWTPT",42,0)
 S USER=+$G(USER),CNT=0
"RTN","ORWTPT",43,0)
 S NUM=0 F  S NUM=$O(^OR(100.21,"C",USER,NUM)) Q:NUM<1  D
"RTN","ORWTPT",44,0)
 .S ZERO=$G(^OR(100.21,NUM,0))
"RTN","ORWTPT",45,0)
 .S CNT=CNT+1
"RTN","ORWTPT",46,0)
 .S TEAMS(CNT)=NUM_U_ZERO
"RTN","ORWTPT",47,0)
 Q
"RTN","ORWTPT",48,0)
 ;
"RTN","ORWTPT",49,0)
ATEAMS(TEAMS) ; RPC
"RTN","ORWTPT",50,0)
 ; all teams available to subscribe to
"RTN","ORWTPT",51,0)
 N CNT,NAME,NODE,NUM K TEAMS
"RTN","ORWTPT",52,0)
 S CNT=0
"RTN","ORWTPT",53,0)
 S NUM=0 F  S NUM=$O(^OR(100.21,NUM)) Q:NUM<1  S NODE=$G(^(NUM,0)) D
"RTN","ORWTPT",54,0)
 .I $P(NODE,U,6)'="Y" Q
"RTN","ORWTPT",55,0)
 .I $P(NODE,U,2)="P" Q
"RTN","ORWTPT",56,0)
 .S CNT=CNT+1
"RTN","ORWTPT",57,0)
 .S TEAMS(CNT)=NUM_U_NODE ;$P(NODE,U)
"RTN","ORWTPT",58,0)
 Q
"RTN","ORWTPT",59,0)
 ;
"RTN","ORWTPT",60,0)
ADDLIST(OK,VALUE,USER) ; from ORWTPP
"RTN","ORWTPT",61,0)
 ; adds a user to a team
"RTN","ORWTPT",62,0)
 N DA,DIC,DLAYGO,X,Y K DA,DIC,DLAYGO
"RTN","ORWTPT",63,0)
 S USER=+$G(USER)
"RTN","ORWTPT",64,0)
 S DA=USER,DA(1)=+$G(VALUE),OK=1
"RTN","ORWTPT",65,0)
 I '$D(^OR(100.21,DA(1),0)) Q
"RTN","ORWTPT",66,0)
 S DIC(0)="LM"
"RTN","ORWTPT",67,0)
 S DLAYGO=100.212
"RTN","ORWTPT",68,0)
 S X=$P($G(^VA(200,USER,0)),U)
"RTN","ORWTPT",69,0)
 S DIC="^OR(100.21,"_DA(1)_",1,"
"RTN","ORWTPT",70,0)
 D
"RTN","ORWTPT",71,0)
 .L +^OR(100.21,DA(1)):5 I '$T Q
"RTN","ORWTPT",72,0)
 .D ^DIC
"RTN","ORWTPT",73,0)
 .L -^OR(100.21,DA(1))
"RTN","ORWTPT",74,0)
 I Y=-1 S OK=0
"RTN","ORWTPT",75,0)
 K DA,DIC,DLAYGO
"RTN","ORWTPT",76,0)
 Q
"RTN","ORWTPT",77,0)
 ;
"RTN","ORWTPT",78,0)
REMLIST(OK,VALUE,USER) ; from ORWTPP
"RTN","ORWTPT",79,0)
 ; removes a user from a team
"RTN","ORWTPT",80,0)
 N DA,DIK K DA
"RTN","ORWTPT",81,0)
 S DA=+$G(USER),DA(1)=+$G(VALUE),OK=1
"RTN","ORWTPT",82,0)
 I '$D(^OR(100.21,DA(1),0)) Q
"RTN","ORWTPT",83,0)
 S DIK="^OR(100.21,"_DA(1)_",1,"
"RTN","ORWTPT",84,0)
 D
"RTN","ORWTPT",85,0)
 .L +^OR(100.21,DA(1)):5 I '$T S OK=0 Q
"RTN","ORWTPT",86,0)
 .D ^DIK
"RTN","ORWTPT",87,0)
 .L -^OR(100.21,DA(1))
"RTN","ORWTPT",88,0)
 K DA,DIK
"RTN","ORWTPT",89,0)
 Q
"RTN","ORWTPT",90,0)
 ;
"RTN","ORWTPT",91,0)
GETCOMBO(VALUES,USER) ; from ORWTPP
"RTN","ORWTPT",92,0)
 ; get user's combo list definition
"RTN","ORWTPT",93,0)
 N CNT,IEN,NAME,NODE,NUM,SOURCE K VALUES
"RTN","ORWTPT",94,0)
 S USER=+$G(USER)
"RTN","ORWTPT",95,0)
 I '$D(^OR(100.24,USER,0)) Q
"RTN","ORWTPT",96,0)
 S CNT=0
"RTN","ORWTPT",97,0)
 S NUM=0 F  S NUM=$O(^OR(100.24,USER,.01,NUM)) Q:NUM<1  S NODE=$G(^(NUM,0)) D
"RTN","ORWTPT",98,0)
 .I '$L(NODE) Q
"RTN","ORWTPT",99,0)
 .S IEN=+NODE,SOURCE=$P(NODE,";",2),NAME=""
"RTN","ORWTPT",100,0)
 .D
"RTN","ORWTPT",101,0)
 ..I SOURCE="DIC(42," S SOURCE="WARD",NAME=$P($G(^DIC(42,IEN,0)),U) Q
"RTN","ORWTPT",102,0)
 ..I SOURCE="VA(200," S SOURCE="PROVIDER",NAME=$P($G(^VA(200,IEN,0)),U) Q
"RTN","ORWTPT",103,0)
 ..I SOURCE="DIC(45.7," S SOURCE="SPECIALTY",NAME=$P($G(^DIC(45.7,IEN,0)),U) Q
"RTN","ORWTPT",104,0)
 ..I SOURCE="OR(100.21," S SOURCE="LIST",NAME=$P($G(^OR(100.21,IEN,0)),U) Q
"RTN","ORWTPT",105,0)
 ..I SOURCE="SC(" S SOURCE="CLINIC",NAME=$P($G(^SC(IEN,0)),U) Q
"RTN","ORWTPT",106,0)
 ..I SOURCE="DIC(42," S SOURCE="WARD",NAME=$P($G(^DIC(42,IEN,0)),U) Q
"RTN","ORWTPT",107,0)
 .I '$L(NAME) Q
"RTN","ORWTPT",108,0)
 .S CNT=CNT+1
"RTN","ORWTPT",109,0)
 .S VALUES(CNT)=SOURCE_U_NAME_U_IEN
"RTN","ORWTPT",110,0)
 Q
"RTN","ORWTPT",111,0)
 ;
"RTN","ORWTPT",112,0)
SETCOMBO(OK,VALUES,USER) ; from ORWTPP
"RTN","ORWTPT",113,0)
 ; set user's combo list definition
"RTN","ORWTPT",114,0)
 N CNT,DA,DIK,IEN,NUM,NVALUES,SOURCE,SOURCENM K NVALUES
"RTN","ORWTPT",115,0)
 S USER=+$G(USER),OK=1
"RTN","ORWTPT",116,0)
 I 'USER Q
"RTN","ORWTPT",117,0)
 S NUM=0 F  S NUM=$O(VALUES(NUM)) Q:NUM<1  D
"RTN","ORWTPT",118,0)
 .S IEN=+VALUES(NUM),SOURCENM=$$UP^XLFSTR($P(VALUES(NUM),U,2)),SOURCE=""
"RTN","ORWTPT",119,0)
 .I 'IEN Q
"RTN","ORWTPT",120,0)
 .I SOURCENM="WARD" S SOURCE=";DIC(42,"
"RTN","ORWTPT",121,0)
 .I SOURCENM="PROVIDER" S SOURCE=";VA(200,"
"RTN","ORWTPT",122,0)
 .I SOURCENM="SPECIALTY" S SOURCE=";DIC(45.7,"
"RTN","ORWTPT",123,0)
 .I SOURCENM="LIST" S SOURCE=";OR(100.21,"
"RTN","ORWTPT",124,0)
 .I SOURCENM="CLINIC" S SOURCE=";SC("
"RTN","ORWTPT",125,0)
 .I '$L(SOURCE) Q
"RTN","ORWTPT",126,0)
 .S NVALUES(NUM)=IEN_SOURCE
"RTN","ORWTPT",127,0)
 I '$D(^OR(100.24,USER,0)) D  I '$D(^OR(100.24,USER,0)) Q
"RTN","ORWTPT",128,0)
 .L +^OR(100.24,0):5 I '$T S OK=0 Q
"RTN","ORWTPT",129,0)
 .S ^OR(100.24,USER,0)=USER
"RTN","ORWTPT",130,0)
 .S $P(^OR(100.24,0),U,4)=$P(^OR(100.24,0),U,4)+1,$P(^(0),U,3)=USER
"RTN","ORWTPT",131,0)
 .L -^OR(100.24,0)
"RTN","ORWTPT",132,0)
 S CNT=0,DA=USER,DIK="^OR(100.24,"
"RTN","ORWTPT",133,0)
 L +^OR(100.24,USER,0):5 I '$T Q
"RTN","ORWTPT",134,0)
 K ^OR(100.24,USER,.01)
"RTN","ORWTPT",135,0)
 S NUM=0 F  S NUM=$O(NVALUES(NUM)) Q:NUM<1  D
"RTN","ORWTPT",136,0)
 .S CNT=CNT+1
"RTN","ORWTPT",137,0)
 .S ^OR(100.24,USER,.01,CNT,0)=NVALUES(NUM)
"RTN","ORWTPT",138,0)
 S ^OR(100.24,USER,.01,0)="^100.241V^"_CNT_U_CNT
"RTN","ORWTPT",139,0)
 D IX1^DIK
"RTN","ORWTPT",140,0)
 L -^OR(100.24,USER,0)
"RTN","ORWTPT",141,0)
 K NVALUES
"RTN","ORWTPT",142,0)
 Q
"RTN","ORWTPUA")
0^165^B2193311
"RTN","ORWTPUA",1,0)
ORWTPUA ; SLC/STAFF Personal Preference - Utility Alerts ; 4/20/07 10:01am
"RTN","ORWTPUA",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**85,243**;Oct 24, 2000;Build 242
"RTN","ORWTPUA",3,0)
 ;
"RTN","ORWTPUA",4,0)
START(USER) ; $$(user) -> user's surrogate start date/time
"RTN","ORWTPUA",5,0)
 Q $P($G(^XTV(8992,+$G(USER),0)),U,3)
"RTN","ORWTPUA",6,0)
 ;
"RTN","ORWTPUA",7,0)
STOP(USER) ; $$(user) -> user's surrogate stop date/time
"RTN","ORWTPUA",8,0)
 Q $P($G(^XTV(8992,+$G(USER),0)),U,4)
"RTN","ORWTPUA",9,0)
 ;
"RTN","ORWTPUA",10,0)
CHKSURR(USER,SURR) ; $$(user,surrogate) -> 1 if ok else 0^reason for reject
"RTN","ORWTPUA",11,0)
 N OK,START
"RTN","ORWTPUA",12,0)
 S USER=+$G(USER),SURR=+$G(SURR)
"RTN","ORWTPUA",13,0)
 I USER=SURR Q "0^You cannot specify yourself as your own surrogate!"
"RTN","ORWTPUA",14,0)
 S START=$$GET1^DIQ(8992,(SURR_","),.02,"I")
"RTN","ORWTPUA",15,0)
 I START<.5 Q 1
"RTN","ORWTPUA",16,0)
 I START=USER Q "0^You are designated as the surrogate for this user - can't do it!"
"RTN","ORWTPUA",17,0)
 S OK=1 F  S START=$$GET1^DIQ(8992,(START_","),.02,"I") Q:START'>0  I START=USER S OK=0 Q
"RTN","ORWTPUA",18,0)
 I 'OK Q "0^This forms a circle which leads back to you - can't do it!"
"RTN","ORWTPUA",19,0)
 Q 1
"RTN","ORWTPUA",20,0)
 ;
"RTN","ORWTPUA",21,0)
GETSURR(USER) ; $$(user ien) -> surrogate ien
"RTN","ORWTPUA",22,0)
 Q $$CURRSURO^XQALSURO(+$G(USER))
"RTN","ORWTPUA",23,0)
 ;
"RTN","ORWTPUA",24,0)
SAVESURR(USER,SURR,START,STOP) ; save user's surrogate info
"RTN","ORWTPUA",25,0)
 N RET
"RTN","ORWTPUA",26,0)
 D REMVSURO^XQALSURO(USER)
"RTN","ORWTPUA",27,0)
 S RET=$$SETSURO1^XQALSURO(USER,SURR,START,STOP)
"RTN","ORWTPUA",28,0)
 Q RET
"RTN","ORWU")
0^65^B60173136
"RTN","ORWU",1,0)
ORWU ; SLC/KCM - General Utilites for Windows Calls; 2/28/01 [1/15/04 11:43am]
"RTN","ORWU",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,132,148,149,187,195,215,243**;Dec 17, 1997;Build 242
"RTN","ORWU",3,0)
 ;
"RTN","ORWU",4,0)
DT(Y,X,%DT) ; Internal Fileman Date/Time
"RTN","ORWU",5,0)
 ; change the '00:00' that could be passed so Fileman doesn't reject
"RTN","ORWU",6,0)
 I $L($P(X,"@",2)),("00000000"[$TR($P(X,"@",2),":","")) S $P(X,"@",2)="00:00:01"
"RTN","ORWU",7,0)
 S %DT=$G(%DT,"TS") D ^%DT K %DT
"RTN","ORWU",8,0)
 Q
"RTN","ORWU",9,0)
VALDT(Y,X,%DT) ; Validate date/time
"RTN","ORWU",10,0)
 S:'$D(%DT) %DT="TX" D ^%DT
"RTN","ORWU",11,0)
 Q
"RTN","ORWU",12,0)
USERINFO(REC) ; Relevant info for current user
"RTN","ORWU",13,0)
 ; return DUZ^NAME^USRCLS^CANSIGN^ISPROVIDER^ORDERROLE^NOORDER^DTIME^
"RTN","ORWU",14,0)
 ;        COUNTDOWN^ENABLEVERIFY^NOTIFYAPPS^MSGHANG^DOMAIN^SERVICE^
"RTN","ORWU",15,0)
 ;        AUTOSAVE^INITTAB^LASTTAB^WEBACCESS^ALLOWHOLD^ISRPL^RPLLIST^
"RTN","ORWU",16,0)
 ;        CORTABS^RPTTAB^STANUM^GECSTATUS^PRODACCT
"RTN","ORWU",17,0)
 N X,ORRPL,ORRPL1,ORRPL2,ORTAB,CORTABS,RPTTAB,ORDT,OREFF,OREXP,ORDATEOK
"RTN","ORWU",18,0)
 S REC=DUZ_U_$P(^VA(200,DUZ,0),U)
"RTN","ORWU",19,0)
 S $P(REC,U,3)=$S($D(^XUSEC("ORES",DUZ)):3,$D(^XUSEC("ORELSE",DUZ)):2,$D(^XUSEC("OREMAS",DUZ)):1,1:0)
"RTN","ORWU",20,0)
 S $P(REC,U,4)=$D(^XUSEC("ORES",DUZ))&$D(^XUSEC("PROVIDER",DUZ))
"RTN","ORWU",21,0)
 S $P(REC,U,5)=$D(^XUSEC("PROVIDER",DUZ))
"RTN","ORWU",22,0)
 S $P(REC,U,6)=$$ORDROLE
"RTN","ORWU",23,0)
 S $P(REC,U,7)=$$GET^XPAR("USR^SYS^PKG","ORWOR DISABLE ORDERING",1,"I")
"RTN","ORWU",24,0)
 S $P(REC,U,8)=$$GET^XPAR("USR^SYS","ORWOR TIMEOUT CHART",1,"I")
"RTN","ORWU",25,0)
 I '$P(REC,U,8),$G(DTIME) S $P(REC,U,8)=DTIME
"RTN","ORWU",26,0)
 S $P(REC,U,9)=$$GET^XPAR("USR^SYS^PKG","ORWOR TIMEOUT COUNTDOWN",1,"I")
"RTN","ORWU",27,0)
 S X=$$GET^XPAR("USR^SYS^PKG","ORWOR ENABLE VERIFY",1,"I")
"RTN","ORWU",28,0)
 S $P(REC,U,10)=$S(X=1:1,X=2:0,1:'$P(REC,U,7))
"RTN","ORWU",29,0)
 S $P(REC,U,11)=$$GET^XPAR("USR^SYS^PKG","ORWOR BROADCAST MESSAGES",1,"I")
"RTN","ORWU",30,0)
 S $P(REC,U,12)=$$GET^XPAR("USR^SYS^PKG","ORWOR AUTO CLOSE PT MSG",1,"I")
"RTN","ORWU",31,0)
 S $P(REC,U,13)=$$KSP^XUPARAM("WHERE")  ; domain
"RTN","ORWU",32,0)
 S $P(REC,U,14)=+$G(^VA(200,DUZ,5))     ; service/section
"RTN","ORWU",33,0)
 S $P(REC,U,15)=$$GET^XPAR("USR^SYS^PKG","ORWOR AUTOSAVE NOTE",1,"I")
"RTN","ORWU",34,0)
 S $P(REC,U,16)=$$GET^XPAR("USR^DIV^SYS^PKG","ORCH INITIAL TAB",1,"I")
"RTN","ORWU",35,0)
 S $P(REC,U,17)=$$GET^XPAR("USR^DIV^SYS^PKG","ORCH USE LAST TAB",1,"I")
"RTN","ORWU",36,0)
 S $P(REC,U,18)=$$GET^XPAR("USR^DIV^SYS^PKG","ORWOR DISABLE WEB ACCESS",1,"I")
"RTN","ORWU",37,0)
 S $P(REC,U,19)=$$GET^XPAR("SYS^PKG","ORWOR DISABLE HOLD ORDERS",1,"I")
"RTN","ORWU",38,0)
 ; 2 pieces added by PKS on 11/5/2001 for "Reports Only:"
"RTN","ORWU",39,0)
 ; IA# 10060 allows read access to ^VA(200 file.
"RTN","ORWU",40,0)
 S ORRPL=$G(^VA(200,DUZ,101))           ; RPL node.
"RTN","ORWU",41,0)
 S ORRPL1=$P(ORRPL,U)
"RTN","ORWU",42,0)
 S $P(REC,U,20)=ORRPL1                  ; ISRPL piece.
"RTN","ORWU",43,0)
 S ORRPL2=$P(ORRPL,U,2)
"RTN","ORWU",44,0)
 S $P(REC,U,21)=ORRPL2                  ; RPLLIST piece.
"RTN","ORWU",45,0)
 ;
"RTN","ORWU",46,0)
 ; Additional pieces for CPRS tabs access:
"RTN","ORWU",47,0)
 ; IA# 10060 allows read access to ^VA(200.01013 multiple.
"RTN","ORWU",48,0)
 S ORDT=DT                              ; Today.
"RTN","ORWU",49,0)
 S (CORTABS,RPTTAB)=0
"RTN","ORWU",50,0)
 S ORRPL=0
"RTN","ORWU",51,0)
 F  S ORRPL=$O(^VA(200,DUZ,"ORD",ORRPL)) Q:ORRPL<1  D
"RTN","ORWU",52,0)
 .S ORTAB=$G(^VA(200,DUZ,"ORD",ORRPL,0))
"RTN","ORWU",53,0)
 .I ORTAB="" Q
"RTN","ORWU",54,0)
 .S OREFF=$P(ORTAB,U,2)
"RTN","ORWU",55,0)
 .S OREXP=$P(ORTAB,U,3)
"RTN","ORWU",56,0)
 .S ORTAB=$P(ORTAB,U)
"RTN","ORWU",57,0)
 .I ORTAB="" Q
"RTN","ORWU",58,0)
 .S ORTAB=$G(^ORD(101.13,ORTAB,0))
"RTN","ORWU",59,0)
 .I ORTAB="" Q
"RTN","ORWU",60,0)
 .S ORTAB=$P(ORTAB,U)
"RTN","ORWU",61,0)
 .I ORTAB="" Q
"RTN","ORWU",62,0)
 .S ORTAB=$$UP^XLFSTR(ORTAB)
"RTN","ORWU",63,0)
 .S ORDATEOK=1                             ; Default.
"RTN","ORWU",64,0)
 .I ((OREFF="")!(OREFF>ORDT)) S ORDATEOK=0 ; Eff. date NG.
"RTN","ORWU",65,0)
 .I ORDATEOK  D
"RTN","ORWU",66,0)
 ..I OREXP="" Q                            ; No exp. date.
"RTN","ORWU",67,0)
 ..I (OREXP<ORDT) S ORDATEOK=0             ; Exp. date NG.
"RTN","ORWU",68,0)
 ..I (OREXP=ORDT) S ORDATEOK=0             ; Exp. date NG.
"RTN","ORWU",69,0)
 .;
"RTN","ORWU",70,0)
 .; Set TRUE if OK:
"RTN","ORWU",71,0)
 .I ((ORTAB="COR")&(ORDATEOK)) S CORTABS=1
"RTN","ORWU",72,0)
 .I ((ORTAB="RPT")&(ORDATEOK)) S RPTTAB=1
"RTN","ORWU",73,0)
 ;
"RTN","ORWU",74,0)
 ; When done, set all valid tabs for access:
"RTN","ORWU",75,0)
 S $P(REC,U,22)=CORTABS                 ; "Core" tabs.
"RTN","ORWU",76,0)
 S $P(REC,U,23)=RPTTAB                  ; "Reports" tab.
"RTN","ORWU",77,0)
 ;
"RTN","ORWU",78,0)
 S $P(REC,U,24)=$P($$SITE^VASITE,U,3)
"RTN","ORWU",79,0)
 S $P(REC,U,25)=$$GET^XPAR("USR^TEA","PXRM GEC STATUS CHECK",1,"I")
"RTN","ORWU",80,0)
 S $P(REC,U,26)=$$PROD^XUPROD
"RTN","ORWU",81,0)
 Q
"RTN","ORWU",82,0)
 ;
"RTN","ORWU",83,0)
HASKEY(VAL,KEY) ; returns TRUE if the user possesses the security key
"RTN","ORWU",84,0)
 S VAL=''$D(^XUSEC(KEY,DUZ))
"RTN","ORWU",85,0)
 Q
"RTN","ORWU",86,0)
HASOPTN(VAL,OPTION) ; returns TRUE if the user has access to a menu option
"RTN","ORWU",87,0)
 S VAL=+$$ACCESS^XQCHK(DUZ,OPTION)
"RTN","ORWU",88,0)
 I VAL'>0 S VAL=0
"RTN","ORWU",89,0)
 E  S VAL=1
"RTN","ORWU",90,0)
 Q
"RTN","ORWU",91,0)
NPHASKEY(VAL,NP,KEY) ; returns TRUE if the person has the security key
"RTN","ORWU",92,0)
 S VAL=''$D(^XUSEC(KEY,NP))
"RTN","ORWU",93,0)
 Q
"RTN","ORWU",94,0)
ORDROLE() ; returns the role a person takes in ordering
"RTN","ORWU",95,0)
 ; VAL: 0=nokey, 1=clerk, 2=nurse, 3=physician, 4=student, 5=bad keys
"RTN","ORWU",96,0)
 ;I '$G(ORWCLVER) Q 0  ; version of client is to old for ordering
"RTN","ORWU",97,0)
 I ($D(^XUSEC("OREMAS",DUZ))+$D(^XUSEC("ORELSE",DUZ))+$D(^XUSEC("ORES",DUZ)))>1 Q 5
"RTN","ORWU",98,0)
 I $D(^XUSEC("OREMAS",DUZ)) Q 1                           ; clerk
"RTN","ORWU",99,0)
 I $D(^XUSEC("ORELSE",DUZ)) Q 2                           ; nurse
"RTN","ORWU",100,0)
 I $D(^XUSEC("ORES",DUZ)),$D(^XUSEC("PROVIDER",DUZ)) Q 3  ; doctor
"RTN","ORWU",101,0)
 I $D(^XUSEC("PROVIDER",DUZ)) Q 4                         ; student
"RTN","ORWU",102,0)
 Q 0
"RTN","ORWU",103,0)
VALIDSIG(ESOK,X) ; returns TRUE if valid electronic signature
"RTN","ORWU",104,0)
 S X=$$DECRYP^XUSRB1(X),ESOK=0                   ; network encrypted
"RTN","ORWU",105,0)
 D HASH^XUSHSHP
"RTN","ORWU",106,0)
 I X=$P($G(^VA(200,+DUZ,20)),U,4) S ESOK=1
"RTN","ORWU",107,0)
 Q
"RTN","ORWU",108,0)
TOOLMENU(ORLST) ; returns a list of items for the Tools menu
"RTN","ORWU",109,0)
 N ANENT
"RTN","ORWU",110,0)
 S ANENT="ALL^"_$S($G(^VA(200,DUZ,5)):"^SRV.`"_+$G(^(5)),1:"")
"RTN","ORWU",111,0)
 D GETLST^XPAR(.ORLST,ANENT,"ORWT TOOLS MENU","N")
"RTN","ORWU",112,0)
 Q
"RTN","ORWU",113,0)
ACTLOC(LOC) ; Function: returns TRUE if active hospital location
"RTN","ORWU",114,0)
 ; IA# 10040.
"RTN","ORWU",115,0)
 N D0,X I +$G(^SC(LOC,"OOS")) Q 0                ; screen out OOS entry
"RTN","ORWU",116,0)
 S D0=+$G(^SC(LOC,42)) I D0 D WIN^DGPMDDCF Q 'X  ; chk out of svc wards
"RTN","ORWU",117,0)
 S X=$G(^SC(LOC,"I")) I +X=0 Q 1                 ; no inactivate date
"RTN","ORWU",118,0)
 I DT>$P(X,U)&($P(X,U,2)=""!(DT<$P(X,U,2))) Q 0  ; chk reactivate date
"RTN","ORWU",119,0)
 Q 1                                             ; must still be active
"RTN","ORWU",120,0)
 ;
"RTN","ORWU",121,0)
CLINLOC(Y,FROM,DIR) ; Return a set of clinics from HOSPITAL LOCATION
"RTN","ORWU",122,0)
 ; .Y=returned list, FROM=text to $O from, DIR=$O direction,
"RTN","ORWU",123,0)
 N I,IEN,CNT S I=0,CNT=44
"RTN","ORWU",124,0)
 F  Q:I'<CNT  S FROM=$O(^SC("B",FROM),DIR) Q:FROM=""  D  ; IA# 10040.
"RTN","ORWU",125,0)
 . S IEN="" F  S IEN=$O(^SC("B",FROM,IEN),DIR) Q:'IEN  D
"RTN","ORWU",126,0)
 . . I ($P($G(^SC(IEN,0)),U,3)'="C")!('$$ACTLOC(IEN)) Q
"RTN","ORWU",127,0)
 . . S I=I+1,Y(I)=IEN_"^"_FROM
"RTN","ORWU",128,0)
 Q
"RTN","ORWU",129,0)
INPLOC(Y,FROM,DIR) ;Return a set of wards from HOSPITAL LOCATION
"RTN","ORWU",130,0)
 ; .Y=returned list, FROM=text to $O from, DIR=$O direction,
"RTN","ORWU",131,0)
 N I,IEN,CNT S I=0,CNT=44
"RTN","ORWU",132,0)
 F  Q:I'<CNT  S FROM=$O(^SC("B",FROM),DIR) Q:FROM=""  D  ; IA# 10040.
"RTN","ORWU",133,0)
 . S IEN="" F  S IEN=$O(^SC("B",FROM,IEN),DIR) Q:'IEN  D
"RTN","ORWU",134,0)
 . . I ($P($G(^SC(IEN,0)),U,3)'="W") Q
"RTN","ORWU",135,0)
 . . I '$$ACTLOC(IEN) Q
"RTN","ORWU",136,0)
 . . S I=I+1,Y(I)=IEN_"^"_FROM
"RTN","ORWU",137,0)
 Q
"RTN","ORWU",138,0)
HOSPLOC(Y,FROM,DIR) ; Return a set of locations from HOSPITAL LOCATION
"RTN","ORWU",139,0)
 ; .Y=returned list, FROM=text to $O from, DIR=$O direction,
"RTN","ORWU",140,0)
 N I,IEN,CNT S I=0,CNT=44
"RTN","ORWU",141,0)
 F  Q:I'<CNT  S FROM=$O(^SC("B",FROM),DIR) Q:FROM=""  D  ; IA# 10040.
"RTN","ORWU",142,0)
 . S IEN="" F  S IEN=$O(^SC("B",FROM,IEN),DIR) Q:'IEN  D
"RTN","ORWU",143,0)
 . . Q:("CW"'[$P($G(^SC(IEN,0)),U,3)!('$$ACTLOC(IEN)))
"RTN","ORWU",144,0)
 . . S I=I+1,Y(I)=IEN_"^"_FROM
"RTN","ORWU",145,0)
 Q
"RTN","ORWU",146,0)
NEWPERS(ORY,ORFROM,ORDIR,ORKEY,ORDATE,ORVIZ,ORALL) ; Return a set of names from the NEW PERSON file.
"RTN","ORWU",147,0)
 ; SLC/PKS: Code moved to ORWU1 on 12/3/2002.
"RTN","ORWU",148,0)
 D NP1^ORWU1
"RTN","ORWU",149,0)
 Q
"RTN","ORWU",150,0)
GBLREF(VAL,FN) ; return global reference for file number
"RTN","ORWU",151,0)
 S VAL="" Q:'FN
"RTN","ORWU",152,0)
 S VAL=$$ROOT^DILFD(+FN)
"RTN","ORWU",153,0)
 ; I $E($RE(VAL))="," S VAL=$E(VAL,1,$L(VAL)-1)_")"
"RTN","ORWU",154,0)
 ; I $E($RE(VAL))="(" S VAL=$P(VAL,"(",1) 
"RTN","ORWU",155,0)
 Q
"RTN","ORWU",156,0)
GENERIC(Y,FROM,DIR,REF) ; Return a set of entries from xref in REF
"RTN","ORWU",157,0)
 ; .Y=returned list, FROM=text to $O from, DIR=$O direction,
"RTN","ORWU",158,0)
 N I,IEN,CNT S I=0,CNT=44
"RTN","ORWU",159,0)
 F  Q:I'<CNT  S FROM=$O(@REF@(FROM),DIR) Q:FROM=""  D
"RTN","ORWU",160,0)
 . S IEN="" F  S IEN=$O(@REF@(FROM,IEN),DIR) Q:'IEN  D
"RTN","ORWU",161,0)
 . . S I=I+1,Y(I)=IEN_"^"_FROM
"RTN","ORWU",162,0)
 Q
"RTN","ORWU",163,0)
EXTNAME(VAL,IEN,FN) ; return external form of pointer
"RTN","ORWU",164,0)
 ; IEN=internal number, FN=file number
"RTN","ORWU",165,0)
 N REF S REF=$G(^DIC(FN,0,"GL")),VAL=""
"RTN","ORWU",166,0)
 I $L(REF),+IEN S VAL=$P($G(@(REF_IEN_",0)")),U)
"RTN","ORWU",167,0)
 Q
"RTN","ORWU",168,0)
PARAM(VAL,APARAM) ; return a parameter value for a user
"RTN","ORWU",169,0)
 ; call assumes current user, default entities, single instance
"RTN","ORWU",170,0)
 S VAL=$$GET^XPAR("ALL",APARAM,1,"I")
"RTN","ORWU",171,0)
 Q
"RTN","ORWU",172,0)
PARAMS(ORLIST,APARAM) ; return a list of parameter values
"RTN","ORWU",173,0)
 ; call assumes current user, default entities, multiple instances
"RTN","ORWU",174,0)
 D GETLST^XPAR(.ORLIST,"ALL",APARAM,"Q")
"RTN","ORWU",175,0)
 Q
"RTN","ORWU",176,0)
DEVICE(Y,FROM,DIR) ; Return a subset of entries from the Device file
"RTN","ORWU",177,0)
 ; .LST(n)=IEN;Name^DisplayName^Location^RMar^PLen
"RTN","ORWU",178,0)
 ; FROM=text to $O from, DIR=$O direction
"RTN","ORWU",179,0)
 N I,IEN,CNT,SHOW,X S I=0,CNT=20
"RTN","ORWU",180,0)
 I FROM["<" S FROM=$RE($P($RE(FROM),"<  ",2))
"RTN","ORWU",181,0)
 F  Q:I'<CNT  S FROM=$O(^%ZIS(1,"B",FROM),DIR) Q:FROM=""  D
"RTN","ORWU",182,0)
 . S IEN=0 F  S IEN=$O(^%ZIS(1,"B",FROM,IEN)) Q:'IEN  D
"RTN","ORWU",183,0)
 .. N X0,X1,X90,X91,X95,XTYPE,XSTYPE,XTIME,ORA,ORPX,POP
"RTN","ORWU",184,0)
 .. Q:'$D(^%ZIS(1,IEN,0))  S X0=^(0),X1=$G(^(1)),X90=$G(^(90)),X91=$G(^(91)),X95=$G(^(95)),XSTYPE=$G(^("SUBTYPE")),XTIME=$G(^("TIME")),XTYPE=$G(^("TYPE"))
"RTN","ORWU",185,0)
 .. I $E($G(^%ZIS(2,+XSTYPE,0)))'="P" Q  ;Printers only
"RTN","ORWU",186,0)
 .. S X=$P(XTYPE,"^") I X'="TRM",X'="HG",X'="HFS",X'="CHAN" Q  ;Device Types
"RTN","ORWU",187,0)
 .. S X=X0 I ($P(X,U,2)="0")!($P(X,U,12)=2) Q  ;Queuing allowed
"RTN","ORWU",188,0)
 .. S X=+X90 I X,(X'>DT) Q  ;Out of Service
"RTN","ORWU",189,0)
 .. I XTIME]"" S ORA=$P(XTIME,"^"),ORPX=$P($H,",",2),ORPCNT=ORPX\60#60+(ORPX\3600*100),ORPX=$P(ORA,"-",2) I ORPX'<ORA&(ORPCNT'>ORPX&(ORPCNT'<ORA))!(ORPX<ORA&(ORPCNT'<ORA!(ORPCNT'>ORPX))) Q  ;Prohibited Times
"RTN","ORWU",190,0)
 .. S POP=0
"RTN","ORWU",191,0)
 .. I X95]"" S ORPX=$G(DUZ(0)) I ORPX'="@" S POP=1 F ORA=1:1:$L(ORPX) I X95[$E(ORPX,ORA) S POP=0 Q
"RTN","ORWU",192,0)
 .. Q:POP  ;Security check
"RTN","ORWU",193,0)
 .. S SHOW=$P(X0,U) I SHOW'=FROM S SHOW=FROM_"  <"_SHOW_">"
"RTN","ORWU",194,0)
 .. S I=I+1,Y(I)=IEN_";"_$P(X0,U)_U_SHOW_U_$P(X1,U)_U_$P(X91,U)_U_$P(X91,U,3)
"RTN","ORWU",195,0)
 Q
"RTN","ORWU",196,0)
URGENCY(Y) ; -- retrieve set values from dd for discharge summary urgency
"RTN","ORWU",197,0)
 N ORDD,I,X
"RTN","ORWU",198,0)
 D FIELD^DID(8925,.09,"","POINTER","ORDD")
"RTN","ORWU",199,0)
 F I=1:1 S X=$P(ORDD("POINTER"),";",I) Q:X=""   S Y(I)=$TR(X,":","^")
"RTN","ORWU",200,0)
 Q
"RTN","ORWU",201,0)
PATCH(VAL,X) ; Return 1 if patch X is installed
"RTN","ORWU",202,0)
 S VAL=$$PATCH^XPDUTL(X)
"RTN","ORWU",203,0)
 Q
"RTN","ORWU",204,0)
VERSION(VAL,X) ;Return version of package or namespace
"RTN","ORWU",205,0)
 S VAL=$$VERSION^XPDUTL(X)
"RTN","ORWU",206,0)
 Q
"RTN","ORWU",207,0)
VERSRV(VAL,X,CLVER) ; Return server version of option name
"RTN","ORWU",208,0)
 S ORWCLVER=$G(CLVER)  ; leave in partition for session
"RTN","ORWU",209,0)
 N BADVAL,ORLST
"RTN","ORWU",210,0)
 D FIND^DIC(19,"",1,"X",X,1,,,,"ORLST")
"RTN","ORWU",211,0)
 I 'ORLST("DILIST",0) S VAL="0.0.0.0" Q
"RTN","ORWU",212,0)
 S VAL=ORLST("DILIST","ID",1,1)
"RTN","ORWU",213,0)
 S VAL=$P(VAL,"version ",2)
"RTN","ORWU",214,0)
 S BADVAL=0
"RTN","ORWU",215,0)
 I $P(VAL,".",1)="" S BADVAL=1
"RTN","ORWU",216,0)
 I $P(VAL,".",2)="" S BADVAL=1
"RTN","ORWU",217,0)
 I $P(VAL,".",3)="" S BADVAL=1
"RTN","ORWU",218,0)
 I $P(VAL,".",4)="" S BADVAL=1
"RTN","ORWU",219,0)
 I ((BADVAL)!('VAL)!(VAL="")) S VAL="0.0.0.0"
"RTN","ORWU",220,0)
 Q
"RTN","ORWU2")
0^197^B22524024
"RTN","ORWU2",1,0)
ORWU2 ;SLC/JEH - General Utilities for Windows Calls [2/25/04 11:10am]
"RTN","ORWU2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORWU2",3,0)
 ;
"RTN","ORWU2",4,0)
 Q
"RTN","ORWU2",5,0)
 ;
"RTN","ORWU2",6,0)
 ; Return a set of names from the NEW PERSON file.
"RTN","ORWU2",7,0)
COSIGNER(ORY,ORFROM,ORDIR,ORDATE,ORTIUTYP,ORTIUDA) ;
"RTN","ORWU2",8,0)
 ; (Set up for the DC Summary)
"RTN","ORWU2",9,0)
 ;  (to use TIU doc requirments and USR PROVIDER)
"RTN","ORWU2",10,0)
 ;
"RTN","ORWU2",11,0)
 ; PARAMS from ORWU2 COSIGNER RPC call:
"RTN","ORWU2",12,0)
 ;  .ORY=returned list.
"RTN","ORWU2",13,0)
 ;  ORFROM=Starting name for this set.  
"RTN","ORWU2",14,0)
 ;  ORDIR=Direction to move through the x-ref with $O.  
"RTN","ORWU2",15,0)
 ;  ORDATE=Checks for an USR PROVIDER on this date (optional).
"RTN","ORWU2",16,0)
 ;  ORTIUTYP is + of the 0 node of the 8925 docmt.  
"RTN","ORWU2",17,0)
 ;  ORTIUDA is the docmt IEN,
"RTN","ORWU2",18,0)
 ;  
"RTN","ORWU2",19,0)
 ;  
"RTN","ORWU2",20,0)
 ;  
"RTN","ORWU2",21,0)
 N ORDD,ORDIV,ORDUP,ORGOOD,ORI,ORIEN1,ORIEN2,ORLAST,ORMAX,ORMRK,ORMULTI,ORPREV,ORSRV,ORTTL,ORERR
"RTN","ORWU2",22,0)
 ;
"RTN","ORWU2",23,0)
 S ORI=0,ORMAX=44,(ORLAST,ORPREV)="",ORDATE=$G(ORDATE) ;ORKEY=$G(ORKEY)
"RTN","ORWU2",24,0)
 I +$G(ORTIUDA) S ORTIUTYP=+$G(^TIU(8925,+$G(ORTIUDA),0))
"RTN","ORWU2",25,0)
 S ORMULTI=$$ALL^VASITE ; IA# 10112.  Do once at beginning of call.
"RTN","ORWU2",26,0)
 ;
"RTN","ORWU2",27,0)
 F  Q:ORI'<ORMAX  S ORFROM=$O(^VA(200,"AUSER",ORFROM),ORDIR) Q:ORFROM=""  D
"RTN","ORWU2",28,0)
 .S ORIEN1=""
"RTN","ORWU2",29,0)
 .F  S ORIEN1=$O(^VA(200,"AUSER",ORFROM,ORIEN1),ORDIR) Q:'ORIEN1  D
"RTN","ORWU2",30,0)
 ..;
"RTN","ORWU2",31,0)
 ..I '$$PROVIDER^XUSER(ORIEN1,1) Q   ; Terminated? 
"RTN","ORWU2",32,0)
 ..I '$$ISA^USRLM(+ORIEN1,"PROVIDER",.ORERR,ORDATE) Q  ;(USR PROVIDER CLASS CHECK?)
"RTN","ORWU2",33,0)
TIU .. I $$REQCOSIG^TIULP(ORTIUTYP,ORTIUDA,ORIEN1,ORDATE) Q  ; User requiers cosigner 
"RTN","ORWU2",34,0)
 ..;I ($L(ORKEY)),(ORKEY'="COSIGNER"),('$D(^XUSEC(ORKEY,+ORIEN1))) Q       ; Check for key?
"RTN","ORWU2",35,0)
 ..;I ORDATE>0,$$GET^XUA4A72(ORIEN1,ORDATE)<1 Q    ; Check date? 
"RTN","ORWU2",36,0)
 ..S ORI=ORI+1,ORY(ORI)=ORIEN1_"^"_$$NAMEFMT^XLFNAME(ORFROM,"F","DcMPC")
"RTN","ORWU2",37,0)
 ..S ORDUP=0                            ; Init flag, check dupe.
"RTN","ORWU2",38,0)
 ..I ($P(ORPREV_" "," ")=$P(ORFROM_" "," ")) S ORDUP=1
"RTN","ORWU2",39,0)
 ..;
"RTN","ORWU2",40,0)
 ..; Append Title if not duplicated:
"RTN","ORWU2",41,0)
 ..I 'ORDUP D
"RTN","ORWU2",42,0)
 ...S ORIEN2=ORIEN1
"RTN","ORWU2",43,0)
 ...D COS4(0)                            ; Get Title. 
"RTN","ORWU2",44,0)
 ...I ORTTL="" Q
"RTN","ORWU2",45,0)
 ...S ORY(ORI)=ORY(ORI)_U_"- "_ORTTL
"RTN","ORWU2",46,0)
 ..;
"RTN","ORWU2",47,0)
 ..; Get data in case of dupes:
"RTN","ORWU2",48,0)
 ..I ORDUP D
"RTN","ORWU2",49,0)
 ...S ORIEN2=ORLAST                     ; Prev IEN for NP2 call.
"RTN","ORWU2",50,0)
 ...;
"RTN","ORWU2",51,0)
 ...; Reset, use previous array element, call for extended data:
"RTN","ORWU2",52,0)
 ...S ORI=ORI-1,ORY(ORI)=$P(ORY(ORI),U)_U_$P(ORY(ORI),U,2)  D COS2
"RTN","ORWU2",53,0)
 ...;
"RTN","ORWU2",54,0)
 ...; Then return to current user for second extended data call:
"RTN","ORWU2",55,0)
 ...S ORIEN2=ORIEN1,ORI=ORI+1  D COS2
"RTN","ORWU2",56,0)
 ..S ORLAST=ORIEN1,ORPREV=ORFROM        ; Reassign vars for next pass.
"RTN","ORWU2",57,0)
 ;
"RTN","ORWU2",58,0)
END Q
"RTN","ORWU2",59,0)
 ;
"RTN","ORWU2",60,0)
COS2 ; Retrieve subset of data for dupes in COSIGNER.
"RTN","ORWU2",61,0)
 ; (Assumes certain vars already set/new'd in calling code.)
"RTN","ORWU2",62,0)
 ;
"RTN","ORWU2",63,0)
 ; Variables used:
"RTN","ORWU2",64,0)
 ;   ORZ    = Memory array storage variable.
"RTN","ORWU2",65,0)
 ;   ORZERR = Error storage for LIST^DIC call.
"RTN","ORWU2",66,0)
 ;
"RTN","ORWU2",67,0)
 N ORZ,ORZERR                           ; Initialize variables.
"RTN","ORWU2",68,0)
 S ORDIV=""                             ; Reset each time.
"RTN","ORWU2",69,0)
 D COS4(1)                               ; Get Title, Service/Section.
"RTN","ORWU2",70,0)
 ;
"RTN","ORWU2",71,0)
 ; For multi-divisional site, get Division if determinable:
"RTN","ORWU2",72,0)
 I ORMULTI D
"RTN","ORWU2",73,0)
 .D LIST^DIC(200.02,","_ORIEN2_",","@;.01;1","QP","","","","","","","ORZ","ORZERR")
"RTN","ORWU2",74,0)
 .S (ORDD,ORGOOD)=0                     ; Initialize variables.
"RTN","ORWU2",75,0)
 .I $P(ORZ("DILIST",0),U)=0 Q           ; Division not listed.
"RTN","ORWU2",76,0)
 .I $P(ORZ("DILIST",0),U)=1 D  Q        ; Only one, so use it.
"RTN","ORWU2",77,0)
 ..S ORDD=$O(ORZ("DILIST",ORDD))        ; Get the node's entry.
"RTN","ORWU2",78,0)
 ..S ORDIV=$P(ORDD,U,2)                 ; Get actual name value.
"RTN","ORWU2",79,0)
 .;
"RTN","ORWU2",80,0)
 .; More than one Division entry, so:
"RTN","ORWU2",81,0)
 .F  S ORDD=$O(ORZ("DILIST",ORDD)) Q:+ORDD=0!'($L(ORDD))  D  Q:ORGOOD
"RTN","ORWU2",82,0)
 ..;
"RTN","ORWU2",83,0)
 ..; See if current entry being processed is "Default" (done if so):
"RTN","ORWU2",84,0)
 ..I $P(ORZ("DILIST",ORDD,0),U,3)["Y" S ORDIV=$P(ORZ("DILIST",ORDD,0),U,2),ORGOOD=1  Q                       ; Division text.
"RTN","ORWU2",85,0)
 ;
"RTN","ORWU2",86,0)
 ; Append new pieces to array string:
"RTN","ORWU2",87,0)
 S ORMRK=""
"RTN","ORWU2",88,0)
 I (ORTTL="")&(ORSRV="")&(ORDIV="")  Q  ; Nothing to append.
"RTN","ORWU2",89,0)
 S ORY(ORI)=ORY(ORI)_U_"- "             ; At least something exists.
"RTN","ORWU2",90,0)
 I (ORTTL'="") S ORY(ORI)=ORY(ORI)_ORTTL,ORMRK=", "       ; Title.
"RTN","ORWU2",91,0)
 I (ORSRV'="") S ORY(ORI)=ORY(ORI)_ORMRK_ORSRV,ORMRK=", " ; Service.
"RTN","ORWU2",92,0)
 I (ORDIV'="") S ORY(ORI)=ORY(ORI)_ORMRK_ORDIV            ; Division.
"RTN","ORWU2",93,0)
 ;
"RTN","ORWU2",94,0)
 Q
"RTN","ORWU2",95,0)
 ;
"RTN","ORWU2",96,0)
 ;
"RTN","ORWU2",97,0)
COS4(ORSS) ; Retrieve Title or Title and Service/Section.
"RTN","ORWU2",98,0)
 ; (Assumes certain vars already set/new'd in calling code.)
"RTN","ORWU2",99,0)
 ;
"RTN","ORWU2",100,0)
 ; Passed variable ORSS: If true, get Service/Section also.
"RTN","ORWU2",101,0)
 ;
"RTN","ORWU2",102,0)
 S (ORTTL,ORSRV)=""                            ; Init each time.
"RTN","ORWU2",103,0)
 ; DBIA# 4329:
"RTN","ORWU2",104,0)
 S ORTTL=$P($G(^VA(200,ORIEN2,0)),U,9)         ; Get Title pointer.
"RTN","ORWU2",105,0)
 I ORTTL<1 S ORTTL=""                          ; Reset var if none.
"RTN","ORWU2",106,0)
 ; DBIA# 1234:
"RTN","ORWU2",107,0)
 I ORTTL>0 S ORTTL=$G(^DIC(3.1,ORTTL,0))       ; Actual Title value.
"RTN","ORWU2",108,0)
 S ORSS=$G(ORSS)
"RTN","ORWU2",109,0)
 I ORSS D                                      ; Get Service/Section?
"RTN","ORWU2",110,0)
 .; DBIA# 4329:
"RTN","ORWU2",111,0)
 .S ORSRV=$P($G(^VA(200,ORIEN2,5)),U,1)        ; Get S/S pointer.
"RTN","ORWU2",112,0)
 .I ORSRV<1 S ORSRV=""                         ; Reset var if none.
"RTN","ORWU2",113,0)
 .; DBIA# 4330:
"RTN","ORWU2",114,0)
 .I ORSRV>0 S ORSRV=$P($G(^DIC(49,ORSRV,0)),U) ; Actual S/S value.
"RTN","ORWU2",115,0)
 ;
"RTN","ORWU2",116,0)
 Q
"RTN","ORWU2",117,0)
 ;
"RTN","ORY243")
0^31^B79494059
"RTN","ORY243",1,0)
ORY243 ;SLCOIFO - Pre and Post-init for patch OR*3*243 ; 3/28/08 5:58am
"RTN","ORY243",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORY243",3,0)
 ;
"RTN","ORY243",4,0)
DELDD ;Delete the old data dictionaries.
"RTN","ORY243",5,0)
 N DIU,TEXT
"RTN","ORY243",6,0)
 D EN^DDIOL("Removing old data dictionaries.")
"RTN","ORY243",7,0)
 S DIU(0)=""
"RTN","ORY243",8,0)
 S DIU=101.43
"RTN","ORY243",9,0)
 S TEXT=" Deleting data dictionary for file # "_DIU
"RTN","ORY243",10,0)
 D EN^DDIOL(TEXT)
"RTN","ORY243",11,0)
 D EN^DIU2
"RTN","ORY243",12,0)
 Q
"RTN","ORY243",13,0)
 ;
"RTN","ORY243",14,0)
PRE ; initiate pre-init processes
"RTN","ORY243",15,0)
 D DELDD
"RTN","ORY243",16,0)
 D PEOMRPT,B
"RTN","ORY243",17,0)
 D UPDTALRT
"RTN","ORY243",18,0)
 Q
"RTN","ORY243",19,0)
 ;
"RTN","ORY243",20,0)
POST ; initiate post-init processes
"RTN","ORY243",21,0)
 ;
"RTN","ORY243",22,0)
 D VITREG ;register Vitals RPC
"RTN","ORY243",23,0)
 I +$$PATCH^XPDUTL("MAG*3.0*7") D MAGREG1
"RTN","ORY243",24,0)
 I +$$PATCH^XPDUTL("MAG*3.0*37") D MAGREG2
"RTN","ORY243",25,0)
 D DLGBULL
"RTN","ORY243",26,0)
 D MAIL
"RTN","ORY243",27,0)
 D PARVAL
"RTN","ORY243",28,0)
 D PARAM
"RTN","ORY243",29,0)
 D NOTIF
"RTN","ORY243",30,0)
 D INISET^ORWGAPIU ; graph setting default
"RTN","ORY243",31,0)
 S ^XTMP("ORGRAPH","FORCE")="ON" ; force rebuild of cache for graphing via ORMTIME
"RTN","ORY243",32,0)
 D BULLMG
"RTN","ORY243",33,0)
 D FLAGORD
"RTN","ORY243",34,0)
 D ^ORY243ES ;expert system changes
"RTN","ORY243",35,0)
 D DDEDIT
"RTN","ORY243",36,0)
 D STS
"RTN","ORY243",37,0)
 D MHDLL
"RTN","ORY243",38,0)
 D CLRDFTD
"RTN","ORY243",39,0)
 D INPQCONV^ORY243A
"RTN","ORY243",40,0)
 D IVORCON^ORY243A
"RTN","ORY243",41,0)
 D INSTALL^ORWOD  ;med quick order report
"RTN","ORY243",42,0)
 Q
"RTN","ORY243",43,0)
 ;
"RTN","ORY243",44,0)
PEOMRPT ;Remove new & changed reports from OE/RR REPORTS file (101.24)
"RTN","ORY243",45,0)
 N ORI,ORVIT
"RTN","ORY243",46,0)
 S ORVIT=0
"RTN","ORY243",47,0)
 I $P($G(^ORD(101.24,3,0)),"^",1)="ORRP AP ALL" D
"RTN","ORY243",48,0)
 . S ORVIT=1,DA=3,DIK="^ORD(101.24," D ^DIK
"RTN","ORY243",49,0)
 . S ^ORD(101.24,3,0)="ORRP AP ALL",^ORD(101.24,"B","ORRP AP ALL",3)=""
"RTN","ORY243",50,0)
 I $P($G(^ORD(101.24,3,0)),"^",1)="ORRP AP MENU" D
"RTN","ORY243",51,0)
 . S ORVIT=1,DA=3,DIK="^ORD(101.24," D ^DIK
"RTN","ORY243",52,0)
 . S ^ORD(101.24,3,0)="ORRP AP ALL",^ORD(101.24,"B","ORRP AP ALL",3)=""
"RTN","ORY243",53,0)
 I $P($G(^ORD(101.24,18,0)),"^",1)="ORL MOST RECENT" D
"RTN","ORY243",54,0)
 . S ORVIT=1,DA=18,DIK="^ORD(101.24," D ^DIK
"RTN","ORY243",55,0)
 . S ^ORD(101.24,18,0)="ORL MOST RECENT",^ORD(101.24,"B","ORL MOST RECENT",18)=""
"RTN","ORY243",56,0)
 I $P($G(^ORD(101.24,19,0)),"^",1)="ORL CUMULATIVE" D
"RTN","ORY243",57,0)
 . S ORVIT=1,DA=19,DIK="^ORD(101.24," D ^DIK
"RTN","ORY243",58,0)
 . S ^ORD(101.24,19,0)="ORL CUMULATIVE",^ORD(101.24,"B","ORL CUMULATIVE",19)=""
"RTN","ORY243",59,0)
 I $P($G(^ORD(101.24,20,0)),"^",1)="ORL ALL TESTS BY DATE" D
"RTN","ORY243",60,0)
 . S ORVIT=1,DA=20,DIK="^ORD(101.24," D ^DIK
"RTN","ORY243",61,0)
 . S ^ORD(101.24,20,0)="ORL ALL TESTS BY DATE",^ORD(101.24,"B","ORL ALL TESTS BY DATE",20)=""
"RTN","ORY243",62,0)
 I $P($G(^ORD(101.24,21,0)),"^",1)="ORL WORKSHEET" D
"RTN","ORY243",63,0)
 . S ORVIT=1,DA=21,DIK="^ORD(101.24," D ^DIK
"RTN","ORY243",64,0)
 . S ^ORD(101.24,21,0)="ORL WORKSHEET",^ORD(101.24,"B","ORL WORKSHEET",21)=""
"RTN","ORY243",65,0)
 I $P($G(^ORD(101.24,22,0)),"^",1)="ORL GRAPH" D
"RTN","ORY243",66,0)
 . S ORVIT=1,DA=22,DIK="^ORD(101.24," D ^DIK
"RTN","ORY243",67,0)
 . S ^ORD(101.24,22,0)="ORL GRAPH",^ORD(101.24,"B","ORL GRAPH",22)=""
"RTN","ORY243",68,0)
 I $P($G(^ORD(101.24,23,0)),"^",1)="ORL MICROBIOLOGY" D
"RTN","ORY243",69,0)
 . S ORVIT=1,DA=23,DIK="^ORD(101.24," D ^DIK
"RTN","ORY243",70,0)
 . S ^ORD(101.24,23,0)="ORL MICROBIOLOGY",^ORD(101.24,"B","ORL MICROBIOLOGY",23)=""
"RTN","ORY243",71,0)
 I $P($G(^ORD(101.24,24,0)),"^",1)="ORL ANATOMIC PATHOLOGY" D
"RTN","ORY243",72,0)
 . S ORVIT=1,DA=24,DIK="^ORD(101.24," D ^DIK
"RTN","ORY243",73,0)
 . S ^ORD(101.24,24,0)="ORL ANATOMIC PATHOLOGY",^ORD(101.24,"B","ORL ANATOMIC PATHOLOGY",24)=""
"RTN","ORY243",74,0)
 I $P($G(^ORD(101.24,25,0)),"^",1)="ORL BLOOD BANK" D
"RTN","ORY243",75,0)
 . S ORVIT=1,DA=25,DIK="^ORD(101.24," D ^DIK
"RTN","ORY243",76,0)
 . S ^ORD(101.24,25,0)="ORL BLOOD BANK",^ORD(101.24,"B","ORL BLOOD BANK",25)=""
"RTN","ORY243",77,0)
 I $P($G(^ORD(101.24,26,0)),"^",1)="ORL LAB STATUS" D
"RTN","ORY243",78,0)
 . S ORVIT=1,DA=26,DIK="^ORD(101.24," D ^DIK
"RTN","ORY243",79,0)
 . S ^ORD(101.24,26,0)="ORL LAB STATUS",^ORD(101.24,"B","ORL LAB STATUS",26)=""
"RTN","ORY243",80,0)
 I $P($G(^ORD(101.24,27,0)),"^",1)="ORL SELECTED TESTS BY DATE" D
"RTN","ORY243",81,0)
 . S ORVIT=1,DA=27,DIK="^ORD(101.24," D ^DIK
"RTN","ORY243",82,0)
 . S ^ORD(101.24,27,0)="ORL SELECTED TESTS BY DATE",^ORD(101.24,"B","ORL SELECTED TESTS BY DATE",27)=""
"RTN","ORY243",83,0)
 I $P($G(^ORD(101.24,1032,0)),"^",1)="ORRPW ALLERGIES ADV" D
"RTN","ORY243",84,0)
 . S ORVIT=1,DA=1032,DIK="^ORD(101.24," D ^DIK
"RTN","ORY243",85,0)
 . S ^ORD(101.24,1032,0)="ORRPW ALLERGIES ADV",^ORD(101.24,"B","ORRPW ALLERGIES ADV",1032)=""
"RTN","ORY243",86,0)
 I $P($G(^ORD(101.24,1100,0)),"^",1)="ORRPW ORDERS CURRENT" D
"RTN","ORY243",87,0)
 . S ORVIT=1,DA=1100,DIK="^ORD(101.24," D ^DIK
"RTN","ORY243",88,0)
 . S ^ORD(101.24,1100,0)="ORRPW ORDERS CURRENT",^ORD(101.24,"B","ORRPW ORDERS CURRENT",1100)=""
"RTN","ORY243",89,0)
 I $P($G(^ORD(101.24,1079,0)),"^",1)="ORRPW PHARMACY ALL OUT" D
"RTN","ORY243",90,0)
 . S ORVIT=1,DA=1079,DIK="^ORD(101.24," D ^DIK
"RTN","ORY243",91,0)
 . S ^ORD(101.24,1079,0)="ORRPW PHARMACY ALL OUT",^ORD(101.24,"B","ORRPW PHARMACY ALL OUT",1079)=""
"RTN","ORY243",92,0)
 I $P($G(^ORD(101.24,48,0)),"^",1)="ORRP SURGERIES" D
"RTN","ORY243",93,0)
 . S ORVIT=1,DA=48,DIK="^ORD(101.24," D ^DIK
"RTN","ORY243",94,0)
 . S ^ORD(101.24,48,0)="ORRP SURGERIES",^ORD(101.24,"B","ORRP SURGERIES",48)=""
"RTN","ORY243",95,0)
 I $P($G(^ORD(101.24,1137,0)),"^",1)="ORRPW DOD ALLERGIES ADV" D
"RTN","ORY243",96,0)
 . S ORVIT=1,DA=1137,DIK="^ORD(101.24," D ^DIK
"RTN","ORY243",97,0)
 . S ^ORD(101.24,1137,0)="ORRPW DOD ALLERGIES ADV",^ORD(101.24,"B","ORRPW DOD ALLERGIES ADV",1137)=""
"RTN","ORY243",98,0)
 I $P($G(^ORD(101.24,1551,0)),"^",1)="ORRPW HDR ALLERGIES" D
"RTN","ORY243",99,0)
 . S ORVIT=1,DA=1551,DIK="^ORD(101.24," D ^DIK
"RTN","ORY243",100,0)
 . S ^ORD(101.24,1551,0)="ORRPW HDR ALLERGIES",^ORD(101.24,"B","ORRPW HDR ALLERGIES",1551)=""
"RTN","ORY243",101,0)
 I $P($G(^ORD(101.24,1553,0)),"^",1)="ORRPW HDR PHARMACY OUT" D
"RTN","ORY243",102,0)
 . S ORVIT=1,DA=1553,DIK="^ORD(101.24," D ^DIK
"RTN","ORY243",103,0)
 . S ^ORD(101.24,1553,0)="ORRPW HDR PHARMACY OUT",^ORD(101.24,"B","ORRPW HDR PHARMACY OUT",1553)=""
"RTN","ORY243",104,0)
 I $P($G(^ORD(101.24,1105,0)),"^",1)="ORRPW DOD PHARM ALL OUT" D
"RTN","ORY243",105,0)
 . S ORVIT=1,DA=1105,DIK="^ORD(101.24," D ^DIK
"RTN","ORY243",106,0)
 . S ^ORD(101.24,1105,0)="ORRPW DOD PHARM ALL OUT",^ORD(101.24,"B","ORRPW DOD PHARM ALL OUT",1105)=""
"RTN","ORY243",107,0)
 I $P($G(^ORD(101.24,1078,0)),"^",1)="ORRPW PHARMACY ACT OUT" D
"RTN","ORY243",108,0)
 . S ORVIT=1,DA=1078,DIK="^ORD(101.24," D ^DIK
"RTN","ORY243",109,0)
 . S ^ORD(101.24,1078,0)="ORRPW PHARMACY ACT OUT",^ORD(101.24,"B","ORRPW PHARMACY ACT OUT",1078)=""
"RTN","ORY243",110,0)
 S ORI=999
"RTN","ORY243",111,0)
 F  S ORI=$O(^ORD(101.24,ORI)) Q:'ORI  I ORI<1110!(ORI>1116) S DA=ORI,DIK="^ORD(101.24," D ^DIK
"RTN","ORY243",112,0)
 Q
"RTN","ORY243",113,0)
MAIL ; send bulletin of installation time
"RTN","ORY243",114,0)
 N COUNT,DIFROM,I,START,TEXT,XMDUZ,XMSUB,XMTEXT,XMY
"RTN","ORY243",115,0)
 S COUNT=0,XMDUZ="CPRS PACKAGE",XMTEXT="TEXT("
"RTN","ORY243",116,0)
 S XMSUB="Version "_$P($T(VERSION),";;",2)_" Installed"
"RTN","ORY243",117,0)
 F I="G.CPRS GUI INSTALL@ISC-SLC.VA.GOV",DUZ S XMY(I)=""
"RTN","ORY243",118,0)
 ;
"RTN","ORY243",119,0)
 S X=$P($T(VERSION),";;",2)
"RTN","ORY243",120,0)
 D LINE("Version "_X_" has been installed.")
"RTN","ORY243",121,0)
 D LINE(" ")
"RTN","ORY243",122,0)
 D LINE("Install complete:  "_$$FMTE^XLFDT($$NOW^XLFDT()))
"RTN","ORY243",123,0)
 ;
"RTN","ORY243",124,0)
 D ^XMD
"RTN","ORY243",125,0)
 Q
"RTN","ORY243",126,0)
 ;
"RTN","ORY243",127,0)
CLRDFTD ;
"RTN","ORY243",128,0)
 N DA,DR,DIE
"RTN","ORY243",129,0)
 S DA=$O(^ORD(100.98,"B","INPATIENT MEDICATIONS","")) Q:DA'>0
"RTN","ORY243",130,0)
 I +$P($G(^ORD(100.98,DA,0)),U,4)'>0 Q
"RTN","ORY243",131,0)
 S DIE="^ORD(100.98,",DR="4///@" D ^DIE
"RTN","ORY243",132,0)
 Q
"RTN","ORY243",133,0)
VITREG ; Register Vitals RPC
"RTN","ORY243",134,0)
 D ADDRPCS^GMV3PST ;call tag from vitals patch post init to register
"RTN","ORY243",135,0)
 Q
"RTN","ORY243",136,0)
 ;
"RTN","ORY243",137,0)
MAGREG1 ; Register Imaging RPC if MAG*3.0*7 installed (DBIA 4526)
"RTN","ORY243",138,0)
 D INSERT("OR CPRS GUI CHART","MAG4 REMOTE IMPORT")
"RTN","ORY243",139,0)
 Q
"RTN","ORY243",140,0)
 ;
"RTN","ORY243",141,0)
MAGREG2 ; Register Imaging RPCS if MAG*3.0*37 installed (DBIA 4528/4530)
"RTN","ORY243",142,0)
 D INSERT("OR CPRS GUI CHART","MAG IMPORT CHECK STATUS")
"RTN","ORY243",143,0)
 D INSERT("OR CPRS GUI CHART","MAG IMPORT CLEAR STATUS")
"RTN","ORY243",144,0)
 Q
"RTN","ORY243",145,0)
 ;
"RTN","ORY243",146,0)
LINE(DATA) ; set text into array
"RTN","ORY243",147,0)
 S COUNT=COUNT+1
"RTN","ORY243",148,0)
 S TEXT(COUNT)=DATA
"RTN","ORY243",149,0)
 Q
"RTN","ORY243",150,0)
 ;
"RTN","ORY243",151,0)
INSERT(OPTION,RPC) ; Call FM Updater with each RPC
"RTN","ORY243",152,0)
 ; Input  -- OPTION   Option file (#19) Name field (#.01)
"RTN","ORY243",153,0)
 ;           RPC      RPC sub-file (#19.05) RPC field (#.01)
"RTN","ORY243",154,0)
 ; Output -- None
"RTN","ORY243",155,0)
 N FDA,FDAIEN,ERR,DIERR
"RTN","ORY243",156,0)
 S FDA(19,"?1,",.01)=OPTION
"RTN","ORY243",157,0)
 S FDA(19.05,"?+2,?1,",.01)=RPC
"RTN","ORY243",158,0)
 D UPDATE^DIE("E","FDA","FDAIEN","ERR")
"RTN","ORY243",159,0)
 Q
"RTN","ORY243",160,0)
 ;
"RTN","ORY243",161,0)
SENDDLG(ANAME) ; Return true if the current order dialog should be sent
"RTN","ORY243",162,0)
 I ANAME="LR OTHER LAB TESTS" Q 1
"RTN","ORY243",163,0)
 I ANAME="OR GTX STUDY REASON" Q 1
"RTN","ORY243",164,0)
 I ANAME="RA OERR EXAM" Q 1
"RTN","ORY243",165,0)
 I ANAME="PSH OERR" Q 1
"RTN","ORY243",166,0)
 I ANAME="PSJI OR PAT FLUID OE" Q 1
"RTN","ORY243",167,0)
 I ANAME="OR GTX IV TYPE" Q 1
"RTN","ORY243",168,0)
 I ANAME="PSJ OR PAT OE" Q 1
"RTN","ORY243",169,0)
 I ANAME="PSO OERR" Q 1
"RTN","ORY243",170,0)
 I ANAME="PSO SUPPLY" Q 1
"RTN","ORY243",171,0)
 I ANAME="PS MEDS" Q 1
"RTN","ORY243",172,0)
 I ANAME="OR GTX ADMIN TIMES" Q 1
"RTN","ORY243",173,0)
 I ANAME="OR GTX SCHEDULE TYPE" Q 1
"RTN","ORY243",174,0)
 I ANAME="FHW7" Q 1
"RTN","ORY243",175,0)
 I ANAME="FHW2" Q 1
"RTN","ORY243",176,0)
 I ANAME="FHW1" Q 1
"RTN","ORY243",177,0)
 I ANAME="OR GTX UNITS" Q 1
"RTN","ORY243",178,0)
 Q 0
"RTN","ORY243",179,0)
 ;
"RTN","ORY243",180,0)
DLGBULL ; send bulletin about modified dialogs <on first install>
"RTN","ORY243",181,0)
 N I,ORD
"RTN","ORY243",182,0)
 F I="PSH OERR","PSJI OR PAT FLUID OE","FHW2","FHW7","RA OERR EXAM","LR OTHER LAB TESTS","PSJ OR PAT OE","PSO OERR","PSO SUPPLY","PS MEDS" S ORD(I)=""
"RTN","ORY243",183,0)
 D EN^ORYDLG(243,.ORD)
"RTN","ORY243",184,0)
 Q
"RTN","ORY243",185,0)
 ;
"RTN","ORY243",186,0)
VERSION ;;27.77
"RTN","ORY243",187,0)
 ;
"RTN","ORY243",188,0)
NOTIF ; DO NOT REMOVE WITH VBECS - rename notif 47 (MEDICATIONS EXPIRING)
"RTN","ORY243",189,0)
 S $P(^ORD(100.9,47,0),U)="MEDICATIONS EXPIRING - INPT"
"RTN","ORY243",190,0)
 K ^ORD(100.9,"B")
"RTN","ORY243",191,0)
 S DIK="^ORD(100.9,",DIK(1)=".01^B" D ENALL^DIK
"RTN","ORY243",192,0)
 K DIK
"RTN","ORY243",193,0)
 Q
"RTN","ORY243",194,0)
 ;
"RTN","ORY243",195,0)
PARAM ; DO NOT REMOVE WITH VBECS - main (initial) parameter transport routine
"RTN","ORY243",196,0)
 ; MOVED TO ORY243R - ROUTINE MAXED OUT - 10/02/07 - RV
"RTN","ORY243",197,0)
 D PARAM^ORY243R
"RTN","ORY243",198,0)
 Q
"RTN","ORY243",199,0)
BULLMG ;
"RTN","ORY243",200,0)
 N MGIEN,FDA,ORERR
"RTN","ORY243",201,0)
 S MGIEN=$$FIND1^DIC(3.8,,"MX","OR DRUG ORDER CANCELLED")
"RTN","ORY243",202,0)
 S FDA(3.6,"?1,",.01)="OR DRUG ORDER CANCELLED"
"RTN","ORY243",203,0)
 S FDA(3.62,"+2,?1,",.01)="OR DRUG ORDER CANCELLED"
"RTN","ORY243",204,0)
 D UPDATE^DIE("E","FDA","",.ORERR)
"RTN","ORY243",205,0)
 Q
"RTN","ORY243",206,0)
FLAGORD ;def reasons flagged ords
"RTN","ORY243",207,0)
 N CNT,LST
"RTN","ORY243",208,0)
 D GETLST^XPAR(.LST,"ALL","OR FLAGGED ORD REASONS","I")
"RTN","ORY243",209,0)
 S CNT=$O(LST(""),-1)
"RTN","ORY243",210,0)
 Q:CNT>0
"RTN","ORY243",211,0)
 D EN^XPAR("SYS","OR FLAGGED ORD REASONS",CNT,"Med renewal request")
"RTN","ORY243",212,0)
 S CNT=CNT+1
"RTN","ORY243",213,0)
 D EN^XPAR("SYS","OR FLAGGED ORD REASONS",CNT,"Order request")
"RTN","ORY243",214,0)
 S CNT=CNT+1
"RTN","ORY243",215,0)
 D EN^XPAR("SYS","OR FLAGGED ORD REASONS",CNT,"Order needing clarification")
"RTN","ORY243",216,0)
 Q
"RTN","ORY243",217,0)
MHDLL ;update MH message parameter
"RTN","ORY243",218,0)
 D EN^XPAR("SYS","OR USE MH DLL",,1)
"RTN","ORY243",219,0)
 Q
"RTN","ORY243",220,0)
DDEDIT ;Remove field 80 from file 100
"RTN","ORY243",221,0)
 ;call to EN^DIU2 where DIU = the subfile number
"RTN","ORY243",222,0)
 ;DIU(0)="S", The "S" flag indicates subfile DD is to be deleted
"RTN","ORY243",223,0)
 N DIU S DIU=100.04,DIU(0)="S" D EN^DIU2
"RTN","ORY243",224,0)
 Q
"RTN","ORY243",225,0)
STS ;DC status desc
"RTN","ORY243",226,0)
 K ^ORD(100.01,1,1)
"RTN","ORY243",227,0)
 S ^ORD(100.01,1,1,0)="^^1^1^3070625^^^^",^(1,0)="Orders that have been explicitly stopped."
"RTN","ORY243",228,0)
 Q
"RTN","ORY243",229,0)
 ;
"RTN","ORY243",230,0)
B ; B xref new-style
"RTN","ORY243",231,0)
 Q:'$O(^ORD(101.41,"B","OR GTX PRE-OP SCHEDULED DATE/T",0))  ;done
"RTN","ORY243",232,0)
 N ORI,ORY,ORX S ORI=0
"RTN","ORY243",233,0)
 F  S ORI=$O(^DD(101.41,.01,1,ORI)) Q:ORI<1  S ORY=$G(^(ORI,0)) I ORY="101.41^B" D DELIX^DDMOD(101.41,.01,ORI,"K") Q  ;DBIA #1412
"RTN","ORY243",234,0)
 S ORX("FILE")=101.41,ORX("ROOT FILE")=101.41,ORX("NAME")="B"
"RTN","ORY243",235,0)
 S ORX("TYPE")="R",ORX("USE")="LS",ORX("EXECUTION")="F",ORX("ACTIVITY")="IR"
"RTN","ORY243",236,0)
 S ORX("SHORT DESCR")="Regular B index using full field length"
"RTN","ORY243",237,0)
 S ORX("VAL",1)=.01,ORX("VAL",1,"SUBSCRIPT")=1,ORX("VAL",1,"LENGTH")=63
"RTN","ORY243",238,0)
 D CREIXN^DDMOD(.ORX,"S",.ORY) ;DBIA #2916
"RTN","ORY243",239,0)
 Q
"RTN","ORY243",240,0)
 ;
"RTN","ORY243",241,0)
UPDTALRT ; AP Alerts
"RTN","ORY243",242,0)
 N I
"RTN","ORY243",243,0)
 F I=1:1:3  D
"RTN","ORY243",244,0)
 . N DIC,DA,X,DIE,DR
"RTN","ORY243",245,0)
 . S DIC="^ORD(100.9,",DIC(0)="BIXZ"
"RTN","ORY243",246,0)
 . S X=$S(I=1:"MAMMOGRAM RESULTS",I=2:"PAP SMEAR RESULTS",1:"ANATOMIC PATHOLOGY RESULTS")
"RTN","ORY243",247,0)
 . D ^DIC I Y=-1 K DIC Q
"RTN","ORY243",248,0)
 . S DIE=DIC,DR=".06///"_$S(I=1:"RPTRAD2",I=2:"RPTAP",1:"RPTAP")_";5///REPORT",DA=+Y
"RTN","ORY243",249,0)
 . D ^DIE K DIE,DIC,DR,DA,Y
"RTN","ORY243",250,0)
 Q
"RTN","ORY243",251,0)
 ;
"RTN","ORY243",252,0)
ORWOD ; Med QO Correction
"RTN","ORY243",253,0)
 D INSTALL^ORWOD  ;Run quick order report and send to installers mail box
"RTN","ORY243",254,0)
 Q
"RTN","ORY243",255,0)
PARVAL ;Set Param Val
"RTN","ORY243",256,0)
 D EN^XPAR("PKG","ORWRP REPORT LAB LIST",42,"@")
"RTN","ORY243",257,0)
 Q
"RTN","ORY2430")
0^89^B15644892
"RTN","ORY2430",1,0)
ORY2430 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*243) ;NOV 2,2006 at 12:05
"RTN","ORY2430",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17,1997;Build 242
"RTN","ORY2430",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY2430",4,0)
 ;
"RTN","ORY2430",5,0)
S ;
"RTN","ORY2430",6,0)
 ;
"RTN","ORY2430",7,0)
 Q
"RTN","ORY2430",8,0)
 ;
"RTN","ORY2430",9,0)
WARN(RTN,MSG,LINES) ;
"RTN","ORY2430",10,0)
 ;
"RTN","ORY2430",11,0)
 Q:$G(OCXAUTO)
"RTN","ORY2430",12,0)
 ;
"RTN","ORY2430",13,0)
 N DASH,LINE,NLINE,PLINE
"RTN","ORY2430",14,0)
 ;
"RTN","ORY2430",15,0)
 S DASH="",$P(DASH,"-",(55-$L(MSG)-2))="-"
"RTN","ORY2430",16,0)
 W !!,"--------------",MSG,DASH
"RTN","ORY2430",17,0)
 ;
"RTN","ORY2430",18,0)
 W !,RTN,?10,"[CPRS27.FO-SLC.MED.VA.GOV] -> [",$$NETNAME^OCXSEND,"] Line"
"RTN","ORY2430",19,0)
 ;
"RTN","ORY2430",20,0)
 I $O(LINES($O(LINES(0)))) W "s: "
"RTN","ORY2430",21,0)
 E  W ": "
"RTN","ORY2430",22,0)
 ;
"RTN","ORY2430",23,0)
 S LINE=0 F  S LINE=$O(LINES(LINE)) Q:'LINE  D
"RTN","ORY2430",24,0)
 .W:($X>60) !,?40
"RTN","ORY2430",25,0)
 .S NLINE=LINE F  S PLINE=NLINE,NLINE=$O(LINES(NLINE)) Q:(NLINE-PLINE-1)
"RTN","ORY2430",26,0)
 .I (PLINE=LINE) W " ",LINE
"RTN","ORY2430",27,0)
 .E  W " ",LINE,"-",PLINE S LINE=PLINE
"RTN","ORY2430",28,0)
 ;
"RTN","ORY2430",29,0)
 W ! Q
"RTN","ORY2430",30,0)
 ;
"RTN","ORY2430",31,0)
TEXT(RTN,LINE) ;
"RTN","ORY2430",32,0)
 ;
"RTN","ORY2430",33,0)
 N TEXT X "S TEXT=$T(+"_(+LINE)_"^"_RTN_")" Q TEXT
"RTN","ORY2430",34,0)
 ;
"RTN","ORY2430",35,0)
HEADER ;
"RTN","ORY2430",36,0)
 ;
"RTN","ORY2430",37,0)
 W !," Created: NOV 2,2006 at 12:05  at  CPRS27.FO-SLC.MED.VA.GOV"
"RTN","ORY2430",38,0)
 W !," Current Date: ",$$NOW,"  at  ",$$NETNAME^OCXSEND,!!
"RTN","ORY2430",39,0)
 S LASTFILE=0 K ^TMP("OCXRULE",$J)
"RTN","ORY2430",40,0)
 S ^TMP("OCXRULE",$J)=($P($H,",",2)+($H*86400)+(1*60*60))_" <- ^TMP ENTRY EXPIRATION DATE FOR ^OCXOPURG"
"RTN","ORY2430",41,0)
 Q
"RTN","ORY2430",42,0)
 ;
"RTN","ORY2430",43,0)
GETFILE(FILE,RECNAME,ARRAY) ;
"RTN","ORY2430",44,0)
 ;
"RTN","ORY2430",45,0)
 N CHECK,GLNEXT,GLREF,LINES,REC,DD,FLD
"RTN","ORY2430",46,0)
 S REC=$$LOOKUP(FILE,RECNAME)
"RTN","ORY2430",47,0)
 I 'REC W !!,$$FILENAME^OCXSENDD(FILE),": ",RECNAME Q 0
"RTN","ORY2430",48,0)
 I (REC=-1) W !!,$$FILENAME^OCXSENDD(FILE),": ",RECNAME,"  duplicate local entries.",! Q 0
"RTN","ORY2430",49,0)
 I (REC=-2) W !!,$$FILENAME^OCXSENDD(FILE)," (",FILE,") local file not found." W ! Q:$$PAUSE -10 Q REC
"RTN","ORY2430",50,0)
 I (REC<0) W !!,$$FILENAME^OCXSENDD(FILE),": ",RECNAME,"  unknown lookup error." W ! Q:$$PAUSE -10 Q REC
"RTN","ORY2430",51,0)
 I (REC>0) D
"RTN","ORY2430",52,0)
 .S CHECK=0,LINES=0
"RTN","ORY2430",53,0)
 .D GETREC($$FILE^OCXSENDD(FILE,"GLOBAL NAME"),"ARRAY(",REC,.ARRAY)
"RTN","ORY2430",54,0)
 .S GLREF="ARRAY" F  S GLREF=$Q(@GLREF) Q:'$L(GLREF)  Q:'($E(GLREF,1,6)="ARRAY(")  K:'$L(@GLREF) @GLREF
"RTN","ORY2430",55,0)
 ;
"RTN","ORY2430",56,0)
 Q REC
"RTN","ORY2430",57,0)
 ;
"RTN","ORY2430",58,0)
LKUPARRY(DD,KEY,ARRAY) ;
"RTN","ORY2430",59,0)
 ;
"RTN","ORY2430",60,0)
 N D0 S D0=0 F  S D0=$O(ARRAY(DD,D0)) Q:'D0  Q:($G(ARRAY(DD,D0,.01,"E"))=KEY)
"RTN","ORY2430",61,0)
 Q D0
"RTN","ORY2430",62,0)
 ;
"RTN","ORY2430",63,0)
LOOKUP(FILE,KEY) ;
"RTN","ORY2430",64,0)
 I $O(^TMP("OCXRULE",$J,"B",FILE,KEY,0)) Q 0
"RTN","ORY2430",65,0)
 N RECNAM,REC,D0,CNT,SHORT S (REC,CNT)=0
"RTN","ORY2430",66,0)
 S GL=$$FILE^OCXSENDD(FILE,"GLOBAL NAME") Q:'$L(GL) -2 S GL=$E(GL,1,$L(GL)-1)_")"
"RTN","ORY2430",67,0)
 S SHORT=$E(KEY,1,30),RECNAM=SHORT D  F  S RECNAM=$O(@GL@("B",RECNAM)) Q:'$L(RECNAM)  Q:'($E(RECNAM,1,$L(SHORT))=SHORT)  D
"RTN","ORY2430",68,0)
 .S D0=0 F  S D0=$O(@GL@("B",RECNAM,D0)) Q:'D0  I ($P($G(@GL@(D0,0)),U,1)=KEY) S CNT=CNT+1,REC=D0_U_RECNAME
"RTN","ORY2430",69,0)
 Q:(CNT>1) -1
"RTN","ORY2430",70,0)
 S:$L($P(REC,U,2)) ^TMP("OCXRULE",$J,"A",FILE,$P(REC,U,2))=""
"RTN","ORY2430",71,0)
 Q +REC
"RTN","ORY2430",72,0)
 ;
"RTN","ORY2430",73,0)
GETREC(GL,PATH,D0,REM) ;
"RTN","ORY2430",74,0)
 ;
"RTN","ORY2430",75,0)
 Q:'($P($G(@(GL_"0)")),U,2))
"RTN","ORY2430",76,0)
 N S1,DATA,DD
"RTN","ORY2430",77,0)
 S DATA="" D DIQ(GL,D0,.DATA)
"RTN","ORY2430",78,0)
 S DD=$O(DATA(0)) Q:'DD
"RTN","ORY2430",79,0)
 ;
"RTN","ORY2430",80,0)
 I $L($$FILE^OCXSENDD(DD,"NAME")) S PATH=PATH_""""_DD_":"_D0_""""
"RTN","ORY2430",81,0)
 I '$L($$FILE^OCXSENDD(DD,"NAME")) S PATH=PATH_","""_DD_":"_D0_""""
"RTN","ORY2430",82,0)
 M @(PATH_")")=DATA(DD,D0)
"RTN","ORY2430",83,0)
 ;
"RTN","ORY2430",84,0)
 S S1="" F  S S1=$O(@(GL_D0_","_$$SUB(S1)_")")) Q:'$L(S1)  I ($D(@(GL_D0_","_$$SUB(S1)_")"))>3) D
"RTN","ORY2430",85,0)
 .N D1,GLREF S GLREF=GL_D0_","_$$SUB(S1)_","
"RTN","ORY2430",86,0)
 .S D1=0 F  S D1=$O(@(GLREF_D1_")")) Q:'D1  D GETREC(GLREF,PATH,D1,.REM)
"RTN","ORY2430",87,0)
 ;
"RTN","ORY2430",88,0)
 Q
"RTN","ORY2430",89,0)
 ;
"RTN","ORY2430",90,0)
SUB(X) Q:'(X=+X) """"_X_"""" Q X
"RTN","ORY2430",91,0)
 ;
"RTN","ORY2430",92,0)
DIQ(DIC,DA,OCXARY) ;
"RTN","ORY2430",93,0)
 N DR,DIQ S DR=".01:99999",DIQ="OCXARY(",DIQ(0)="EN" D EN^DIQ1
"RTN","ORY2430",94,0)
 Q
"RTN","ORY2430",95,0)
 ;
"RTN","ORY2430",96,0)
PAUSE() W "  Press Enter " R X:DTIME W ! Q (X[U)
"RTN","ORY2430",97,0)
 ;
"RTN","ORY2430",98,0)
NOW() N X,Y,%DT S X="N",%DT="T" D ^%DT S Y=$$DATE^OCXSENDD(Y) S:(Y["@") Y=$P(Y,"@",1)_" at "_$P(Y,"@",2) Q Y
"RTN","ORY2430",99,0)
 ;
"RTN","ORY24301")
0^79^B71550908
"RTN","ORY24301",1,0)
ORY24301 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*243) ;NOV 2,2006 at 12:05
"RTN","ORY24301",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17,1997;Build 242
"RTN","ORY24301",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY24301",4,0)
 ;
"RTN","ORY24301",5,0)
S ;
"RTN","ORY24301",6,0)
 ;
"RTN","ORY24301",7,0)
 D DOT^ORY243ES
"RTN","ORY24301",8,0)
 ;
"RTN","ORY24301",9,0)
 ;
"RTN","ORY24301",10,0)
 K REMOTE,LOCAL,OPCODE,REF
"RTN","ORY24301",11,0)
 F LINE=1:1:500 S TEXT=$P($T(DATA+LINE),";",2,999) Q:TEXT  I $L(TEXT) D  Q:QUIT
"RTN","ORY24301",12,0)
 .S ^TMP("OCXRULE",$J,$O(^TMP("OCXRULE",$J,"A"),-1)+1)=TEXT
"RTN","ORY24301",13,0)
 ;
"RTN","ORY24301",14,0)
 G ^ORY24302
"RTN","ORY24301",15,0)
 ;
"RTN","ORY24301",16,0)
 Q
"RTN","ORY24301",17,0)
 ;
"RTN","ORY24301",18,0)
DATA ;
"RTN","ORY24301",19,0)
 ;
"RTN","ORY24301",20,0)
 ;;ROOT^OCXS(860.2,0)^ORDER CHECK RULE^860.2I
"RTN","ORY24301",21,0)
 ;;ROOT^OCXS(860.3,0)^ORDER CHECK ELEMENT^860.3
"RTN","ORY24301",22,0)
 ;;ROOT^OCXS(860.4,0)^ORDER CHECK DATA FIELD^860.4I
"RTN","ORY24301",23,0)
 ;;ROOT^OCXS(860.5,0)^ORDER CHECK DATA SOURCE^860.5
"RTN","ORY24301",24,0)
 ;;ROOT^OCXS(860.6,0)^ORDER CHECK DATA CONTEXT^860.6
"RTN","ORY24301",25,0)
 ;;ROOT^OCXS(860.8,0)^ORDER CHECK COMPILER FUNCTIONS^860.8
"RTN","ORY24301",26,0)
 ;;ROOT^OCXS(860.9,0)^ORDER CHECK NATIONAL TERM^860.9
"RTN","ORY24301",27,0)
 ;;ROOT^OCXS(863,0)^OCX MDD CLASS^863
"RTN","ORY24301",28,0)
 ;;ROOT^OCXS(863.1,0)^OCX MDD APPLICATION^863.1
"RTN","ORY24301",29,0)
 ;;ROOT^OCXS(863.2,0)^OCX MDD SUBJECT^863.2
"RTN","ORY24301",30,0)
 ;;ROOT^OCXS(863.3,0)^OCX MDD LINK^863.3I
"RTN","ORY24301",31,0)
 ;;ROOT^OCXS(863.4,0)^OCX MDD ATTRIBUTE^863.4
"RTN","ORY24301",32,0)
 ;;ROOT^OCXS(863.5,0)^OCX MDD VALUES^863.5
"RTN","ORY24301",33,0)
 ;;ROOT^OCXS(863.6,0)^OCX MDD METHOD^863.6
"RTN","ORY24301",34,0)
 ;;ROOT^OCXS(863.7,0)^OCX MDD PUBLIC FUNCTION^863.7
"RTN","ORY24301",35,0)
 ;;ROOT^OCXS(863.8,0)^OCX MDD PARAMETER^863.8
"RTN","ORY24301",36,0)
 ;;ROOT^OCXS(863.9,0)^OCX MDD CONDITION/FUNCTION^863.9I
"RTN","ORY24301",37,0)
 ;;ROOT^OCXS(864,0)^OCX MDD SITE PREFERENCES^864P
"RTN","ORY24301",38,0)
 ;;ROOT^OCXS(864.1,0)^OCX MDD DATATYPE^864.1
"RTN","ORY24301",39,0)
 ;;ROOT^OCXD(860.1,0)^ORDER CHECK PATIENT ACTIVE DATA^860.1P
"RTN","ORY24301",40,0)
 ;;ROOT^OCXD(860.7,0)^ORDER CHECK PATIENT RULE EVENT^860.7P
"RTN","ORY24301",41,0)
 ;;ROOT^OCXD(861,0)^ORDER CHECK RAW DATA LOG^861
"RTN","ORY24301",42,0)
 ;;SOF^863.8  OCX MDD PARAMETER
"RTN","ORY24301",43,0)
 ;;KEY^863.8:^COMPARISON VALUE
"RTN","ORY24301",44,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY24301",45,0)
 ;;D^COMPARISON VALUE
"RTN","ORY24301",46,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY24301",47,0)
 ;;D^CVAL
"RTN","ORY24301",48,0)
 ;;R^"863.8:",1,1
"RTN","ORY24301",49,0)
 ;;D^ 
"RTN","ORY24301",50,0)
 ;;R^"863.8:",1,2
"RTN","ORY24301",51,0)
 ;;D^   This is a value to be compared with PRIMARY DATA FIELD
"RTN","ORY24301",52,0)
 ;;R^"863.8:",1,3
"RTN","ORY24301",53,0)
 ;;D^ in a truth conditional.
"RTN","ORY24301",54,0)
 ;;R^"863.8:",1,4
"RTN","ORY24301",55,0)
 ;;D^ 
"RTN","ORY24301",56,0)
 ;;EOR^
"RTN","ORY24301",57,0)
 ;;KEY^863.8:^DATA TYPE
"RTN","ORY24301",58,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY24301",59,0)
 ;;D^DATA TYPE
"RTN","ORY24301",60,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY24301",61,0)
 ;;D^DATA TYPE
"RTN","ORY24301",62,0)
 ;;R^"863.8:",1,1
"RTN","ORY24301",63,0)
 ;;D^An MDD data type; i.e., an entry in the OCX MDD DATA TYPE file.
"RTN","ORY24301",64,0)
 ;;R^"863.8:","863.84:6",.01,"E"
"RTN","ORY24301",65,0)
 ;;D^QUERY
"RTN","ORY24301",66,0)
 ;;R^"863.8:","863.84:6",1,"E"
"RTN","ORY24301",67,0)
 ;;D^Enter the datatype
"RTN","ORY24301",68,0)
 ;;R^"863.8:","863.84:7",.01,"E"
"RTN","ORY24301",69,0)
 ;;D^DIC
"RTN","ORY24301",70,0)
 ;;R^"863.8:","863.84:7",1,"E"
"RTN","ORY24301",71,0)
 ;;D^864.1
"RTN","ORY24301",72,0)
 ;;R^"863.8:","863.84:8",.01,"E"
"RTN","ORY24301",73,0)
 ;;D^DATA TYPE
"RTN","ORY24301",74,0)
 ;;R^"863.8:","863.84:8",1,"E"
"RTN","ORY24301",75,0)
 ;;D^POINTER TO A FILEMAN FILE
"RTN","ORY24301",76,0)
 ;;R^"863.8:","863.84:9",.01,"E"
"RTN","ORY24301",77,0)
 ;;D^DIC LOOKUP INDEX STRING
"RTN","ORY24301",78,0)
 ;;R^"863.8:","863.84:9",1,"E"
"RTN","ORY24301",79,0)
 ;;D^B^C
"RTN","ORY24301",80,0)
 ;;EOR^
"RTN","ORY24301",81,0)
 ;;KEY^863.8:^DIC
"RTN","ORY24301",82,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY24301",83,0)
 ;;D^DIC
"RTN","ORY24301",84,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY24301",85,0)
 ;;D^DIC
"RTN","ORY24301",86,0)
 ;;R^"863.8:",1,1
"RTN","ORY24301",87,0)
 ;;D^An open reference used to specify the file in a DIC lookup
"RTN","ORY24301",88,0)
 ;;R^"863.8:","863.84:1",.01,"E"
"RTN","ORY24301",89,0)
 ;;D^DATA TYPE
"RTN","ORY24301",90,0)
 ;;R^"863.8:","863.84:1",1,"E"
"RTN","ORY24301",91,0)
 ;;D^POINTER TO A FILEMAN FILE
"RTN","ORY24301",92,0)
 ;;R^"863.8:","863.84:2",.01,"E"
"RTN","ORY24301",93,0)
 ;;D^DIC
"RTN","ORY24301",94,0)
 ;;R^"863.8:","863.84:2",1,"E"
"RTN","ORY24301",95,0)
 ;;D^1
"RTN","ORY24301",96,0)
 ;;R^"863.8:","863.84:3",.01,"E"
"RTN","ORY24301",97,0)
 ;;D^QUERY
"RTN","ORY24301",98,0)
 ;;R^"863.8:","863.84:3",1,"E"
"RTN","ORY24301",99,0)
 ;;D^Enter the name of the file you are pointing to
"RTN","ORY24301",100,0)
 ;;EOR^
"RTN","ORY24301",101,0)
 ;;KEY^863.8:^DIC LOOKUP INDEX STRING
"RTN","ORY24301",102,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY24301",103,0)
 ;;D^DIC LOOKUP INDEX STRING
"RTN","ORY24301",104,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY24301",105,0)
 ;;D^DICIX
"RTN","ORY24301",106,0)
 ;;R^"863.8:",1,1
"RTN","ORY24301",107,0)
 ;;D^Contains the names of indices to be used in a DIC lookup in a comma
"RTN","ORY24301",108,0)
 ;;R^"863.8:",1,2
"RTN","ORY24301",109,0)
 ;;D^delimited string.
"RTN","ORY24301",110,0)
 ;;R^"863.8:","863.84:1",.01,"E"
"RTN","ORY24301",111,0)
 ;;D^DATA TYPE
"RTN","ORY24301",112,0)
 ;;R^"863.8:","863.84:1",1,"E"
"RTN","ORY24301",113,0)
 ;;D^FREE TEXT
"RTN","ORY24301",114,0)
 ;;R^"863.8:","863.84:2",.01,"E"
"RTN","ORY24301",115,0)
 ;;D^QUERY
"RTN","ORY24301",116,0)
 ;;R^"863.8:","863.84:2",1,"E"
"RTN","ORY24301",117,0)
 ;;D^Enter a DIC lookup index string
"RTN","ORY24301",118,0)
 ;;R^"863.8:","863.84:3",.01,"E"
"RTN","ORY24301",119,0)
 ;;D^HELP MESSAGE
"RTN","ORY24301",120,0)
 ;;R^"863.8:","863.84:3",1,"E"
"RTN","ORY24301",121,0)
 ;;D^This is an '^' delimited string which contains the names of indices which are to be used in a DIC lookup; e.g., B^C^DOB.
"RTN","ORY24301",122,0)
 ;;EOR^
"RTN","ORY24301",123,0)
 ;;KEY^863.8:^FILE
"RTN","ORY24301",124,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY24301",125,0)
 ;;D^FILE
"RTN","ORY24301",126,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY24301",127,0)
 ;;D^FILE
"RTN","ORY24301",128,0)
 ;;R^"863.8:",1,1
"RTN","ORY24301",129,0)
 ;;D^The internal entry number of a file.
"RTN","ORY24301",130,0)
 ;;R^"863.8:","863.84:6",.01,"E"
"RTN","ORY24301",131,0)
 ;;D^QUERY
"RTN","ORY24301",132,0)
 ;;R^"863.8:","863.84:6",1,"E"
"RTN","ORY24301",133,0)
 ;;D^File
"RTN","ORY24301",134,0)
 ;;R^"863.8:","863.84:7",.01,"E"
"RTN","ORY24301",135,0)
 ;;D^DATA TYPE
"RTN","ORY24301",136,0)
 ;;R^"863.8:","863.84:7",1,"E"
"RTN","ORY24301",137,0)
 ;;D^POINTER TO A FILEMAN FILE
"RTN","ORY24301",138,0)
 ;;R^"863.8:","863.84:8",.01,"E"
"RTN","ORY24301",139,0)
 ;;D^DIC
"RTN","ORY24301",140,0)
 ;;R^"863.8:","863.84:8",1,"E"
"RTN","ORY24301",141,0)
 ;;D^1
"RTN","ORY24301",142,0)
 ;;EOR^
"RTN","ORY24301",143,0)
 ;;KEY^863.8:^FM MASK
"RTN","ORY24301",144,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY24301",145,0)
 ;;D^FM MASK
"RTN","ORY24301",146,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY24301",147,0)
 ;;D^FM MASK
"RTN","ORY24301",148,0)
 ;;R^"863.8:",1,1
"RTN","ORY24301",149,0)
 ;;D^Tag^routine where code is located to parse the FM DD and override the parameter value
"RTN","ORY24301",150,0)
 ;;R^"863.8:","863.84:4",.01,"E"
"RTN","ORY24301",151,0)
 ;;D^QUERY
"RTN","ORY24301",152,0)
 ;;R^"863.8:","863.84:4",1,"E"
"RTN","ORY24301",153,0)
 ;;D^Enter tag^routine where the FM MASK parser is located
"RTN","ORY24301",154,0)
 ;;R^"863.8:","863.84:5",.01,"E"
"RTN","ORY24301",155,0)
 ;;D^DATA TYPE
"RTN","ORY24301",156,0)
 ;;R^"863.8:","863.84:5",1,"E"
"RTN","ORY24301",157,0)
 ;;D^LINE TAG
"RTN","ORY24301",158,0)
 ;;EOR^
"RTN","ORY24301",159,0)
 ;;KEY^863.8:^FREE TEXT MAXIMUM LENGTH
"RTN","ORY24301",160,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY24301",161,0)
 ;;D^FREE TEXT MAXIMUM LENGTH
"RTN","ORY24301",162,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY24301",163,0)
 ;;D^FMAX
"RTN","ORY24301",164,0)
 ;;R^"863.8:",1,1
"RTN","ORY24301",165,0)
 ;;D^Maximum string length allowed
"RTN","ORY24301",166,0)
 ;;R^"863.8:",2,"E"
"RTN","ORY24301",167,0)
 ;;D^245
"RTN","ORY24301",168,0)
 ;;R^"863.8:","863.84:3",.01,"E"
"RTN","ORY24301",169,0)
 ;;D^QUERY
"RTN","ORY24301",170,0)
 ;;R^"863.8:","863.84:3",1,"E"
"RTN","ORY24301",171,0)
 ;;D^Maximum text string length allowed
"RTN","ORY24301",172,0)
 ;;R^"863.8:","863.84:4",.01,"E"
"RTN","ORY24301",173,0)
 ;;D^FM MASK
"RTN","ORY24301",174,0)
 ;;R^"863.8:","863.84:4",1,"E"
"RTN","ORY24301",175,0)
 ;;D^FMAX^OCXF6
"RTN","ORY24301",176,0)
 ;;R^"863.8:","863.84:5",.01,"E"
"RTN","ORY24301",177,0)
 ;;D^DATA TYPE
"RTN","ORY24301",178,0)
 ;;R^"863.8:","863.84:5",1,"E"
"RTN","ORY24301",179,0)
 ;;D^POSITIVE INTEGER
"RTN","ORY24301",180,0)
 ;;EOR^
"RTN","ORY24301",181,0)
 ;;KEY^863.8:^HELP MESSAGE
"RTN","ORY24301",182,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY24301",183,0)
 ;;D^HELP MESSAGE
"RTN","ORY24301",184,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY24301",185,0)
 ;;D^HELP
"RTN","ORY24301",186,0)
 ;;R^"863.8:",1,1
"RTN","ORY24301",187,0)
 ;;D^A text string 1-250 characters long which overrides the Fileman help
"RTN","ORY24301",188,0)
 ;;R^"863.8:",1,2
"RTN","ORY24301",189,0)
 ;;D^message.
"RTN","ORY24301",190,0)
 ;;R^"863.8:","863.84:10",.01,"E"
"RTN","ORY24301",191,0)
 ;;D^QUERY
"RTN","ORY24301",192,0)
 ;;R^"863.8:","863.84:10",1,"E"
"RTN","ORY24301",193,0)
 ;;D^Enter a brief help message
"RTN","ORY24301",194,0)
 ;;R^"863.8:","863.84:8",.01,"E"
"RTN","ORY24301",195,0)
 ;;D^DATA TYPE
"RTN","ORY24301",196,0)
 ;;R^"863.8:","863.84:8",1,"E"
"RTN","ORY24301",197,0)
 ;;D^FREE TEXT
"RTN","ORY24301",198,0)
 ;;R^"863.8:","863.84:9",.01,"E"
"RTN","ORY24301",199,0)
 ;;D^FM MASK
"RTN","ORY24301",200,0)
 ;;R^"863.8:","863.84:9",1,"E"
"RTN","ORY24301",201,0)
 ;;D^HELP^OCXF6
"RTN","ORY24301",202,0)
 ;;EOR^
"RTN","ORY24301",203,0)
 ;;KEY^863.8:^LOOP QUERY
"RTN","ORY24301",204,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY24301",205,0)
 ;;D^LOOP QUERY
"RTN","ORY24301",206,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY24301",207,0)
 ;;D^LOOP QUERY
"RTN","ORY24301",208,0)
 ;;R^"863.8:",1,1
"RTN","ORY24301",209,0)
 ;;D^Alternate query used when repeated answers are required
"RTN","ORY24301",210,0)
 ;;R^"863.8:","863.84:1",.01,"E"
"RTN","ORY24301",211,0)
 ;;D^DATA TYPE
"RTN","ORY24301",212,0)
 ;;R^"863.8:","863.84:1",1,"E"
"RTN","ORY24301",213,0)
 ;;D^FREE TEXT
"RTN","ORY24301",214,0)
 ;;R^"863.8:","863.84:2",.01,"E"
"RTN","ORY24301",215,0)
 ;;D^QUERY
"RTN","ORY24301",216,0)
 ;;R^"863.8:","863.84:2",1,"E"
"RTN","ORY24301",217,0)
 ;;D^Enter loop query text
"RTN","ORY24301",218,0)
 ;;R^"863.8:","863.84:3",.01,"E"
"RTN","ORY24301",219,0)
 ;;D^HELP MESSAGE
"RTN","ORY24301",220,0)
 ;;R^"863.8:","863.84:3",1,"E"
"RTN","ORY24301",221,0)
 ;;D^This is the query text for all entries after the first one
"RTN","ORY24301",222,0)
 ;;EOR^
"RTN","ORY24301",223,0)
 ;;KEY^863.8:^MANDATORY MESSAGE
"RTN","ORY24301",224,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY24301",225,0)
 ;;D^MANDATORY MESSAGE
"RTN","ORY24301",226,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY24301",227,0)
 ;;D^MAND MSG
"RTN","ORY24301",228,0)
 ;;R^"863.8:",1,1
"RTN","ORY24301",229,0)
 ;;D^Message sent to user telling him that his entry is mandatory
"RTN","ORY24301",230,0)
 ;;R^"863.8:",2,"E"
"RTN","ORY24301",231,0)
 ;;D^Mandatory answer.  You must enter a value or '^' to exit.
"RTN","ORY24301",232,0)
 ;;R^"863.8:","863.84:4",.01,"E"
"RTN","ORY24301",233,0)
 ;;D^QUERY
"RTN","ORY24301",234,0)
 ;;R^"863.8:","863.84:4",1,"E"
"RTN","ORY24301",235,0)
 ;;D^Enter message
"RTN","ORY24301",236,0)
 ;;R^"863.8:","863.84:5",.01,"E"
"RTN","ORY24301",237,0)
 ;;D^DATA TYPE
"RTN","ORY24301",238,0)
 ;;R^"863.8:","863.84:5",1,"E"
"RTN","ORY24301",239,0)
 ;;D^FREE TEXT
"RTN","ORY24301",240,0)
 ;;EOR^
"RTN","ORY24301",241,0)
 ;;KEY^863.8:^OCXO DATA DRIVE SOURCE
"RTN","ORY24301",242,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY24301",243,0)
 ;;D^OCXO DATA DRIVE SOURCE
"RTN","ORY24301",244,0)
 ;;EOR^
"RTN","ORY24301",245,0)
 ;;KEY^863.8:^OCXO EXTERNAL FUNCTION CALL
"RTN","ORY24301",246,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY24301",247,0)
 ;;D^OCXO EXTERNAL FUNCTION CALL
"RTN","ORY24301",248,0)
 ;;EOR^
"RTN","ORY24301",249,0)
 ;;KEY^863.8:^OCXO FILE POINTER
"RTN","ORY24301",250,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY24301",251,0)
 ;;D^OCXO FILE POINTER
"RTN","ORY24301",252,0)
 ;;EOR^
"RTN","ORY24301",253,0)
 ;;KEY^863.8:^OCXO GENERATE CODE FUNCTION
"RTN","ORY24301",254,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY24301",255,0)
 ;;D^OCXO GENERATE CODE FUNCTION
"RTN","ORY24301",256,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY24301",257,0)
 ;;D^GEN
"RTN","ORY24301",258,0)
 ;;EOR^
"RTN","ORY24301",259,0)
 ;;KEY^863.8:^OCXO HL7 SEGMENT ID
"RTN","ORY24301",260,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY24301",261,0)
 ;;D^OCXO HL7 SEGMENT ID
"RTN","ORY24301",262,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY24301",263,0)
 ;;D^HL7SEGID
"RTN","ORY24301",264,0)
 ;;EOR^
"RTN","ORY24301",265,0)
 ;;KEY^863.8:^OCXO SEMI-COLON PIECE NUMBER
"RTN","ORY24301",266,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY24301",267,0)
 ;;D^OCXO SEMI-COLON PIECE NUMBER
"RTN","ORY24301",268,0)
 ;;EOR^
"RTN","ORY24301",269,0)
 ;;KEY^863.8:^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY24301",270,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY24301",271,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY24301",272,0)
 ;;EOR^
"RTN","ORY24301",273,0)
 ;;KEY^863.8:^OCXO VARIABLE NAME
"RTN","ORY24301",274,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY24301",275,0)
 ;;D^OCXO VARIABLE NAME
"RTN","ORY24301",276,0)
 ;;EOR^
"RTN","ORY24301",277,0)
 ;;KEY^863.8:^OCXO VT-BAR PIECE NUMBER
"RTN","ORY24301",278,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY24301",279,0)
 ;;D^OCXO VT-BAR PIECE NUMBER
"RTN","ORY24301",280,0)
 ;;EOR^
"RTN","ORY24301",281,0)
 ;;KEY^863.8:^PRIMARY DATA FIELD
"RTN","ORY24301",282,0)
 ;1;
"RTN","ORY24301",283,0)
 ;
"RTN","ORY24302")
0^80^B79020665
"RTN","ORY24302",1,0)
ORY24302 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*243) ;NOV 2,2006 at 12:05
"RTN","ORY24302",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17,1997;Build 242
"RTN","ORY24302",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY24302",4,0)
 ;
"RTN","ORY24302",5,0)
S ;
"RTN","ORY24302",6,0)
 ;
"RTN","ORY24302",7,0)
 D DOT^ORY243ES
"RTN","ORY24302",8,0)
 ;
"RTN","ORY24302",9,0)
 ;
"RTN","ORY24302",10,0)
 K REMOTE,LOCAL,OPCODE,REF
"RTN","ORY24302",11,0)
 F LINE=1:1:500 S TEXT=$P($T(DATA+LINE),";",2,999) Q:TEXT  I $L(TEXT) D  Q:QUIT
"RTN","ORY24302",12,0)
 .S ^TMP("OCXRULE",$J,$O(^TMP("OCXRULE",$J,"A"),-1)+1)=TEXT
"RTN","ORY24302",13,0)
 ;
"RTN","ORY24302",14,0)
 G ^ORY24303
"RTN","ORY24302",15,0)
 ;
"RTN","ORY24302",16,0)
 Q
"RTN","ORY24302",17,0)
 ;
"RTN","ORY24302",18,0)
DATA ;
"RTN","ORY24302",19,0)
 ;
"RTN","ORY24302",20,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY24302",21,0)
 ;;D^PRIMARY DATA FIELD
"RTN","ORY24302",22,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY24302",23,0)
 ;;D^PDFLD
"RTN","ORY24302",24,0)
 ;;R^"863.8:",1,1
"RTN","ORY24302",25,0)
 ;;D^ 
"RTN","ORY24302",26,0)
 ;;R^"863.8:",1,2
"RTN","ORY24302",27,0)
 ;;D^  Primary data field in a comparison expression that
"RTN","ORY24302",28,0)
 ;;R^"863.8:",1,3
"RTN","ORY24302",29,0)
 ;;D^ is to be tested.
"RTN","ORY24302",30,0)
 ;;R^"863.8:",1,4
"RTN","ORY24302",31,0)
 ;;D^ 
"RTN","ORY24302",32,0)
 ;;EOR^
"RTN","ORY24302",33,0)
 ;;KEY^863.8:^QUERY
"RTN","ORY24302",34,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY24302",35,0)
 ;;D^QUERY
"RTN","ORY24302",36,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY24302",37,0)
 ;;D^QUERY
"RTN","ORY24302",38,0)
 ;;R^"863.8:",1,1
"RTN","ORY24302",39,0)
 ;;D^Used with methods that manage interactive dialogues.  Equivalent to DIC("A")
"RTN","ORY24302",40,0)
 ;;R^"863.8:","863.84:1",.01,"E"
"RTN","ORY24302",41,0)
 ;;D^DATA TYPE
"RTN","ORY24302",42,0)
 ;;R^"863.8:","863.84:1",1,"E"
"RTN","ORY24302",43,0)
 ;;D^FREE TEXT
"RTN","ORY24302",44,0)
 ;;R^"863.8:","863.84:2",.01,"E"
"RTN","ORY24302",45,0)
 ;;D^QUERY
"RTN","ORY24302",46,0)
 ;;R^"863.8:","863.84:2",1,"E"
"RTN","ORY24302",47,0)
 ;;D^Enter the query (free text string)
"RTN","ORY24302",48,0)
 ;;EOR^
"RTN","ORY24302",49,0)
 ;;KEY^863.8:^REPEAT THE QUERY
"RTN","ORY24302",50,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY24302",51,0)
 ;;D^REPEAT THE QUERY
"RTN","ORY24302",52,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY24302",53,0)
 ;;D^LOOP
"RTN","ORY24302",54,0)
 ;;R^"863.8:",1,1
"RTN","ORY24302",55,0)
 ;;D^Set this = 1 to repetitively ask the user to enter a value
"RTN","ORY24302",56,0)
 ;;R^"863.8:","863.84:1",.01,"E"
"RTN","ORY24302",57,0)
 ;;D^DATA TYPE
"RTN","ORY24302",58,0)
 ;;R^"863.8:","863.84:1",1,"E"
"RTN","ORY24302",59,0)
 ;;D^YES NO
"RTN","ORY24302",60,0)
 ;;R^"863.8:","863.84:2",.01,"E"
"RTN","ORY24302",61,0)
 ;;D^HELP MESSAGE
"RTN","ORY24302",62,0)
 ;;R^"863.8:","863.84:2",1,"E"
"RTN","ORY24302",63,0)
 ;;D^Answer 'YES' if you want the user to repetitively enter a value.
"RTN","ORY24302",64,0)
 ;;R^"863.8:","863.84:3",.01,"E"
"RTN","ORY24302",65,0)
 ;;D^QUERY
"RTN","ORY24302",66,0)
 ;;R^"863.8:","863.84:3",1,"E"
"RTN","ORY24302",67,0)
 ;;D^Is the query repetitive
"RTN","ORY24302",68,0)
 ;;EOR^
"RTN","ORY24302",69,0)
 ;;KEY^863.8:^TERMINATOR
"RTN","ORY24302",70,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY24302",71,0)
 ;;D^TERMINATOR
"RTN","ORY24302",72,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY24302",73,0)
 ;;D^TERMINATOR
"RTN","ORY24302",74,0)
 ;;R^"863.8:",1,1
"RTN","ORY24302",75,0)
 ;;D^A text string terminator; e.g., '?', ': ', '=>'
"RTN","ORY24302",76,0)
 ;;R^"863.8:",2,"E"
"RTN","ORY24302",77,0)
 ;;D^:
"RTN","ORY24302",78,0)
 ;;R^"863.8:","863.84:4",.01,"E"
"RTN","ORY24302",79,0)
 ;;D^QUERY
"RTN","ORY24302",80,0)
 ;;R^"863.8:","863.84:4",1,"E"
"RTN","ORY24302",81,0)
 ;;D^Enter text string terminator
"RTN","ORY24302",82,0)
 ;;R^"863.8:","863.84:5",.01,"E"
"RTN","ORY24302",83,0)
 ;;D^DATA TYPE
"RTN","ORY24302",84,0)
 ;;R^"863.8:","863.84:5",1,"E"
"RTN","ORY24302",85,0)
 ;;D^FREE TEXT
"RTN","ORY24302",86,0)
 ;;R^"863.8:","863.84:6",.01,"E"
"RTN","ORY24302",87,0)
 ;;D^FREE TEXT MAXIMUM LENGTH
"RTN","ORY24302",88,0)
 ;;R^"863.8:","863.84:6",1,"E"
"RTN","ORY24302",89,0)
 ;;D^9
"RTN","ORY24302",90,0)
 ;;EOR^
"RTN","ORY24302",91,0)
 ;;KEY^863.8:^VALUE CALL
"RTN","ORY24302",92,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY24302",93,0)
 ;;D^VALUE CALL
"RTN","ORY24302",94,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY24302",95,0)
 ;;D^VAL CALL
"RTN","ORY24302",96,0)
 ;;R^"863.8:",.03,"E"
"RTN","ORY24302",97,0)
 ;;D^NO
"RTN","ORY24302",98,0)
 ;;R^"863.8:",1,1
"RTN","ORY24302",99,0)
 ;;D^tag^routine which manages the dialogue for collecting and validating a value
"RTN","ORY24302",100,0)
 ;;R^"863.8:","863.84:3",.01,"E"
"RTN","ORY24302",101,0)
 ;;D^QUERY
"RTN","ORY24302",102,0)
 ;;R^"863.8:","863.84:3",1,"E"
"RTN","ORY24302",103,0)
 ;;D^Enter tag^routine
"RTN","ORY24302",104,0)
 ;;R^"863.8:","863.84:4",.01,"E"
"RTN","ORY24302",105,0)
 ;;D^DATA TYPE
"RTN","ORY24302",106,0)
 ;;R^"863.8:","863.84:4",1,"E"
"RTN","ORY24302",107,0)
 ;;D^LINE TAG
"RTN","ORY24302",108,0)
 ;;EOR^
"RTN","ORY24302",109,0)
 ;;EOF^OCXS(863.8)^1
"RTN","ORY24302",110,0)
 ;;SOF^864.1  OCX MDD DATATYPE
"RTN","ORY24302",111,0)
 ;;KEY^864.1:^BOOLEAN
"RTN","ORY24302",112,0)
 ;;R^"864.1:",.01,"E"
"RTN","ORY24302",113,0)
 ;;D^BOOLEAN
"RTN","ORY24302",114,0)
 ;;R^"864.1:",.02,"E"
"RTN","ORY24302",115,0)
 ;;D^BOOL
"RTN","ORY24302",116,0)
 ;;EOR^
"RTN","ORY24302",117,0)
 ;;KEY^864.1:^FREE TEXT
"RTN","ORY24302",118,0)
 ;;R^"864.1:",.01,"E"
"RTN","ORY24302",119,0)
 ;;D^FREE TEXT
"RTN","ORY24302",120,0)
 ;;R^"864.1:",.02,"E"
"RTN","ORY24302",121,0)
 ;;D^FT
"RTN","ORY24302",122,0)
 ;;R^"864.1:",2,"E"
"RTN","ORY24302",123,0)
 ;;D^GENERIC
"RTN","ORY24302",124,0)
 ;;R^"864.1:","864.11:1",.01,"E"
"RTN","ORY24302",125,0)
 ;;D^VALUE CALL
"RTN","ORY24302",126,0)
 ;;R^"864.1:","864.11:1",1,"E"
"RTN","ORY24302",127,0)
 ;;D^FT^OCXFDFT
"RTN","ORY24302",128,0)
 ;;R^"864.1:","864.11:2",.01,"E"
"RTN","ORY24302",129,0)
 ;;D^QUERY
"RTN","ORY24302",130,0)
 ;;R^"864.1:","864.11:2",1,"E"
"RTN","ORY24302",131,0)
 ;;D^Enter a free text string
"RTN","ORY24302",132,0)
 ;;R^"864.1:","864.11:3",.01,"E"
"RTN","ORY24302",133,0)
 ;;D^FREE TEXT MAXIMUM LENGTH
"RTN","ORY24302",134,0)
 ;;R^"864.1:","864.11:3",1,"E"
"RTN","ORY24302",135,0)
 ;;D^240
"RTN","ORY24302",136,0)
 ;;R^"864.1:","864.11:4",.01,"E"
"RTN","ORY24302",137,0)
 ;;D^HELP MESSAGE
"RTN","ORY24302",138,0)
 ;;R^"864.1:","864.11:4",1,"E"
"RTN","ORY24302",139,0)
 ;;D^Enter a free text string.  Do not use control characters.  |FTMM HELP|
"RTN","ORY24302",140,0)
 ;;R^"864.1:","864.11:5",.01,"E"
"RTN","ORY24302",141,0)
 ;;D^LOOP QUERY
"RTN","ORY24302",142,0)
 ;;R^"864.1:","864.11:5",1,"E"
"RTN","ORY24302",143,0)
 ;;D^Enter another free text string
"RTN","ORY24302",144,0)
 ;;R^"864.1:","864.11:6",.01,"E"
"RTN","ORY24302",145,0)
 ;;D^REPEAT THE QUERY
"RTN","ORY24302",146,0)
 ;;R^"864.1:","864.11:6",1,"E"
"RTN","ORY24302",147,0)
 ;;D^0
"RTN","ORY24302",148,0)
 ;;EOR^
"RTN","ORY24302",149,0)
 ;;KEY^864.1:^GENERIC
"RTN","ORY24302",150,0)
 ;;R^"864.1:",.01,"E"
"RTN","ORY24302",151,0)
 ;;D^GENERIC
"RTN","ORY24302",152,0)
 ;;R^"864.1:",.02,"E"
"RTN","ORY24302",153,0)
 ;;D^GENERIC
"RTN","ORY24302",154,0)
 ;;R^"864.1:","864.11:11",.01,"E"
"RTN","ORY24302",155,0)
 ;;D^MANDATORY MESSAGE
"RTN","ORY24302",156,0)
 ;;R^"864.1:","864.11:11",1,"E"
"RTN","ORY24302",157,0)
 ;;D^This answer is mandatory.  Enter a response or press '^' to exit.
"RTN","ORY24302",158,0)
 ;;R^"864.1:","864.11:12",.01,"E"
"RTN","ORY24302",159,0)
 ;;D^TERMINATOR
"RTN","ORY24302",160,0)
 ;;R^"864.1:","864.11:12",1,"E"
"RTN","ORY24302",161,0)
 ;;D^:
"RTN","ORY24302",162,0)
 ;;R^"864.1:","864.11:13",.01,"E"
"RTN","ORY24302",163,0)
 ;;D^LOOP QUERY
"RTN","ORY24302",164,0)
 ;;R^"864.1:","864.11:13",1,"E"
"RTN","ORY24302",165,0)
 ;;D^Enter another value
"RTN","ORY24302",166,0)
 ;;R^"864.1:","864.11:7",.01,"E"
"RTN","ORY24302",167,0)
 ;;D^VALUE CALL
"RTN","ORY24302",168,0)
 ;;R^"864.1:","864.11:7",1,"E"
"RTN","ORY24302",169,0)
 ;;D^GEN^OCXFDMOM
"RTN","ORY24302",170,0)
 ;;R^"864.1:","864.11:8",.01,"E"
"RTN","ORY24302",171,0)
 ;;D^QUERY
"RTN","ORY24302",172,0)
 ;;R^"864.1:","864.11:8",1,"E"
"RTN","ORY24302",173,0)
 ;;D^Enter a value
"RTN","ORY24302",174,0)
 ;;R^"864.1:","864.11:9",.01,"E"
"RTN","ORY24302",175,0)
 ;;D^HELP MESSAGE
"RTN","ORY24302",176,0)
 ;;R^"864.1:","864.11:9",1,"E"
"RTN","ORY24302",177,0)
 ;;D^ 
"RTN","ORY24302",178,0)
 ;;EOR^
"RTN","ORY24302",179,0)
 ;;KEY^864.1:^NUMERIC
"RTN","ORY24302",180,0)
 ;;R^"864.1:",.01,"E"
"RTN","ORY24302",181,0)
 ;;D^NUMERIC
"RTN","ORY24302",182,0)
 ;;R^"864.1:",.02,"E"
"RTN","ORY24302",183,0)
 ;;D^NUMERIC
"RTN","ORY24302",184,0)
 ;;R^"864.1:",2,"E"
"RTN","ORY24302",185,0)
 ;;D^GENERIC
"RTN","ORY24302",186,0)
 ;;R^"864.1:","864.11:1",.01,"E"
"RTN","ORY24302",187,0)
 ;;D^VALUE CALL
"RTN","ORY24302",188,0)
 ;;R^"864.1:","864.11:1",1,"E"
"RTN","ORY24302",189,0)
 ;;D^NU^OCXFDNU
"RTN","ORY24302",190,0)
 ;;R^"864.1:","864.11:2",.01,"E"
"RTN","ORY24302",191,0)
 ;;D^QUERY
"RTN","ORY24302",192,0)
 ;;R^"864.1:","864.11:2",1,"E"
"RTN","ORY24302",193,0)
 ;;D^Enter a number
"RTN","ORY24302",194,0)
 ;;R^"864.1:","864.11:3",.01,"E"
"RTN","ORY24302",195,0)
 ;;D^LOOP QUERY
"RTN","ORY24302",196,0)
 ;;R^"864.1:","864.11:3",1,"E"
"RTN","ORY24302",197,0)
 ;;D^Enter another number
"RTN","ORY24302",198,0)
 ;;R^"864.1:","864.11:4",.01,"E"
"RTN","ORY24302",199,0)
 ;;D^REPEAT THE QUERY
"RTN","ORY24302",200,0)
 ;;R^"864.1:","864.11:4",1,"E"
"RTN","ORY24302",201,0)
 ;;D^0
"RTN","ORY24302",202,0)
 ;;EOR^
"RTN","ORY24302",203,0)
 ;;EOF^OCXS(864.1)^1
"RTN","ORY24302",204,0)
 ;;SOF^863.7  OCX MDD PUBLIC FUNCTION
"RTN","ORY24302",205,0)
 ;;KEY^863.7:^GCC BOOLEAN LOGICAL FALSE
"RTN","ORY24302",206,0)
 ;;R^"863.7:",.01,"E"
"RTN","ORY24302",207,0)
 ;;D^GCC BOOLEAN LOGICAL FALSE
"RTN","ORY24302",208,0)
 ;;R^"863.7:",.02,"E"
"RTN","ORY24302",209,0)
 ;;D^EXTRINSIC FUNCTION
"RTN","ORY24302",210,0)
 ;;R^"863.7:",3,"E"
"RTN","ORY24302",211,0)
 ;;D^FALSE^OCXF23
"RTN","ORY24302",212,0)
 ;;R^"863.7:","863.74:1",.01,"E"
"RTN","ORY24302",213,0)
 ;;D^PRIMARY DATA FIELD
"RTN","ORY24302",214,0)
 ;;R^"863.7:","863.74:1",1.1,"E"
"RTN","ORY24302",215,0)
 ;;D^1
"RTN","ORY24302",216,0)
 ;;EOR^
"RTN","ORY24302",217,0)
 ;;KEY^863.7:^GCC BOOLEAN LOGICAL TRUE
"RTN","ORY24302",218,0)
 ;;R^"863.7:",.01,"E"
"RTN","ORY24302",219,0)
 ;;D^GCC BOOLEAN LOGICAL TRUE
"RTN","ORY24302",220,0)
 ;;R^"863.7:",.02,"E"
"RTN","ORY24302",221,0)
 ;;D^EXTRINSIC FUNCTION
"RTN","ORY24302",222,0)
 ;;R^"863.7:",3,"E"
"RTN","ORY24302",223,0)
 ;;D^TRUE^OCXF23
"RTN","ORY24302",224,0)
 ;;R^"863.7:","863.74:1",.01,"E"
"RTN","ORY24302",225,0)
 ;;D^PRIMARY DATA FIELD
"RTN","ORY24302",226,0)
 ;;R^"863.7:","863.74:1",1.1,"E"
"RTN","ORY24302",227,0)
 ;;D^1
"RTN","ORY24302",228,0)
 ;;EOR^
"RTN","ORY24302",229,0)
 ;;KEY^863.7:^GCC FREE TEXT EQUALS
"RTN","ORY24302",230,0)
 ;;R^"863.7:",.01,"E"
"RTN","ORY24302",231,0)
 ;;D^GCC FREE TEXT EQUALS
"RTN","ORY24302",232,0)
 ;;R^"863.7:",.02,"E"
"RTN","ORY24302",233,0)
 ;;D^EXTRINSIC FUNCTION
"RTN","ORY24302",234,0)
 ;;R^"863.7:",3,"E"
"RTN","ORY24302",235,0)
 ;;D^AEQ^OCXF22
"RTN","ORY24302",236,0)
 ;;R^"863.7:","863.74:1",.01,"E"
"RTN","ORY24302",237,0)
 ;;D^PRIMARY DATA FIELD
"RTN","ORY24302",238,0)
 ;;R^"863.7:","863.74:1",1.1,"E"
"RTN","ORY24302",239,0)
 ;;D^1
"RTN","ORY24302",240,0)
 ;;R^"863.7:","863.74:2",.01,"E"
"RTN","ORY24302",241,0)
 ;;D^COMPARISON VALUE
"RTN","ORY24302",242,0)
 ;;R^"863.7:","863.74:2",1.1,"E"
"RTN","ORY24302",243,0)
 ;;D^2
"RTN","ORY24302",244,0)
 ;;EOR^
"RTN","ORY24302",245,0)
 ;;KEY^863.7:^GCC FREE TEXT STARTS WITH
"RTN","ORY24302",246,0)
 ;;R^"863.7:",.01,"E"
"RTN","ORY24302",247,0)
 ;;D^GCC FREE TEXT STARTS WITH
"RTN","ORY24302",248,0)
 ;;R^"863.7:",.02,"E"
"RTN","ORY24302",249,0)
 ;;D^EXTRINSIC FUNCTION
"RTN","ORY24302",250,0)
 ;;R^"863.7:",3,"E"
"RTN","ORY24302",251,0)
 ;;D^START^OCXF22
"RTN","ORY24302",252,0)
 ;;R^"863.7:","863.74:1",.01,"E"
"RTN","ORY24302",253,0)
 ;;D^PRIMARY DATA FIELD
"RTN","ORY24302",254,0)
 ;;R^"863.7:","863.74:1",1.1,"E"
"RTN","ORY24302",255,0)
 ;;D^1
"RTN","ORY24302",256,0)
 ;;R^"863.7:","863.74:2",.01,"E"
"RTN","ORY24302",257,0)
 ;;D^COMPARISON VALUE
"RTN","ORY24302",258,0)
 ;;R^"863.7:","863.74:2",1.1,"E"
"RTN","ORY24302",259,0)
 ;;D^2
"RTN","ORY24302",260,0)
 ;;EOR^
"RTN","ORY24302",261,0)
 ;;KEY^863.7:^GCC NUMERIC GREATER THAN
"RTN","ORY24302",262,0)
 ;;R^"863.7:",.01,"E"
"RTN","ORY24302",263,0)
 ;;D^GCC NUMERIC GREATER THAN
"RTN","ORY24302",264,0)
 ;;R^"863.7:",.02,"E"
"RTN","ORY24302",265,0)
 ;;D^EXTRINSIC FUNCTION
"RTN","ORY24302",266,0)
 ;;R^"863.7:",3,"E"
"RTN","ORY24302",267,0)
 ;;D^GRT^OCXF20
"RTN","ORY24302",268,0)
 ;;R^"863.7:","863.74:1",.01,"E"
"RTN","ORY24302",269,0)
 ;;D^PRIMARY DATA FIELD
"RTN","ORY24302",270,0)
 ;;R^"863.7:","863.74:1",1.1,"E"
"RTN","ORY24302",271,0)
 ;;D^1
"RTN","ORY24302",272,0)
 ;;R^"863.7:","863.74:2",.01,"E"
"RTN","ORY24302",273,0)
 ;;D^COMPARISON VALUE
"RTN","ORY24302",274,0)
 ;;R^"863.7:","863.74:2",1.1,"E"
"RTN","ORY24302",275,0)
 ;;D^2
"RTN","ORY24302",276,0)
 ;;EOR^
"RTN","ORY24302",277,0)
 ;;KEY^863.7:^GCC NUMERIC LESS THAN
"RTN","ORY24302",278,0)
 ;;R^"863.7:",.01,"E"
"RTN","ORY24302",279,0)
 ;;D^GCC NUMERIC LESS THAN
"RTN","ORY24302",280,0)
 ;;R^"863.7:",.02,"E"
"RTN","ORY24302",281,0)
 ;;D^EXTRINSIC FUNCTION
"RTN","ORY24302",282,0)
 ;;R^"863.7:",3,"E"
"RTN","ORY24302",283,0)
 ;;D^LESS^OCXF20
"RTN","ORY24302",284,0)
 ;;R^"863.7:","863.74:1",.01,"E"
"RTN","ORY24302",285,0)
 ;;D^PRIMARY DATA FIELD
"RTN","ORY24302",286,0)
 ;;R^"863.7:","863.74:1",1.1,"E"
"RTN","ORY24302",287,0)
 ;;D^1
"RTN","ORY24302",288,0)
 ;;R^"863.7:","863.74:2",.01,"E"
"RTN","ORY24302",289,0)
 ;;D^COMPARISON VALUE
"RTN","ORY24302",290,0)
 ;;R^"863.7:","863.74:2",1.1,"E"
"RTN","ORY24302",291,0)
 ;;D^2
"RTN","ORY24302",292,0)
 ;;EOR^
"RTN","ORY24302",293,0)
 ;;EOF^OCXS(863.7)^1
"RTN","ORY24302",294,0)
 ;;SOF^863.9  OCX MDD CONDITION/FUNCTION
"RTN","ORY24302",295,0)
 ;;KEY^863.9:^EQ FREE TEXT
"RTN","ORY24302",296,0)
 ;;R^"863.9:",.01,"E"
"RTN","ORY24302",297,0)
 ;;D^EQ FREE TEXT
"RTN","ORY24302",298,0)
 ;;R^"863.9:",.02,"E"
"RTN","ORY24302",299,0)
 ;;D^FREE TEXT
"RTN","ORY24302",300,0)
 ;;R^"863.9:",.04,"E"
"RTN","ORY24302",301,0)
 ;;D^IS EQUAL TO
"RTN","ORY24302",302,0)
 ;;R^"863.9:","863.91:3",.01,"E"
"RTN","ORY24302",303,0)
 ;;D^OCXO GENERATE CODE FUNCTION
"RTN","ORY24302",304,0)
 ;;R^"863.9:","863.91:3",1,"E"
"RTN","ORY24302",305,0)
 ;;D^GCC FREE TEXT EQUALS
"RTN","ORY24302",306,0)
 ;;R^"863.9:","863.92:1",.01,"E"
"RTN","ORY24302",307,0)
 ;;D^EQUALS
"RTN","ORY24302",308,0)
 ;;EOR^
"RTN","ORY24302",309,0)
 ;;KEY^863.9:^GREATER THAN
"RTN","ORY24302",310,0)
 ;;R^"863.9:",.01,"E"
"RTN","ORY24302",311,0)
 ;;D^GREATER THAN
"RTN","ORY24302",312,0)
 ;;R^"863.9:",.02,"E"
"RTN","ORY24302",313,0)
 ;;D^NUMERIC
"RTN","ORY24302",314,0)
 ;;R^"863.9:",.04,"E"
"RTN","ORY24302",315,0)
 ;;D^IS GREATER THAN
"RTN","ORY24302",316,0)
 ;;R^"863.9:","863.91:3",.01,"E"
"RTN","ORY24302",317,0)
 ;;D^OCXO GENERATE CODE FUNCTION
"RTN","ORY24302",318,0)
 ;;R^"863.9:","863.91:3",1,"E"
"RTN","ORY24302",319,0)
 ;;D^GCC NUMERIC GREATER THAN
"RTN","ORY24302",320,0)
 ;;EOR^
"RTN","ORY24302",321,0)
 ;;KEY^863.9:^LESS THAN
"RTN","ORY24302",322,0)
 ;;R^"863.9:",.01,"E"
"RTN","ORY24302",323,0)
 ;;D^LESS THAN
"RTN","ORY24302",324,0)
 ;;R^"863.9:",.02,"E"
"RTN","ORY24302",325,0)
 ;;D^NUMERIC
"RTN","ORY24302",326,0)
 ;;R^"863.9:",.04,"E"
"RTN","ORY24302",327,0)
 ;1;
"RTN","ORY24302",328,0)
 ;
"RTN","ORY24303")
0^81^B78469831
"RTN","ORY24303",1,0)
ORY24303 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*243) ;NOV 2,2006 at 12:05
"RTN","ORY24303",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17,1997;Build 242
"RTN","ORY24303",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY24303",4,0)
 ;
"RTN","ORY24303",5,0)
S ;
"RTN","ORY24303",6,0)
 ;
"RTN","ORY24303",7,0)
 D DOT^ORY243ES
"RTN","ORY24303",8,0)
 ;
"RTN","ORY24303",9,0)
 ;
"RTN","ORY24303",10,0)
 K REMOTE,LOCAL,OPCODE,REF
"RTN","ORY24303",11,0)
 F LINE=1:1:500 S TEXT=$P($T(DATA+LINE),";",2,999) Q:TEXT  I $L(TEXT) D  Q:QUIT
"RTN","ORY24303",12,0)
 .S ^TMP("OCXRULE",$J,$O(^TMP("OCXRULE",$J,"A"),-1)+1)=TEXT
"RTN","ORY24303",13,0)
 ;
"RTN","ORY24303",14,0)
 G ^ORY24304
"RTN","ORY24303",15,0)
 ;
"RTN","ORY24303",16,0)
 Q
"RTN","ORY24303",17,0)
 ;
"RTN","ORY24303",18,0)
DATA ;
"RTN","ORY24303",19,0)
 ;
"RTN","ORY24303",20,0)
 ;;D^IS LESS THAN
"RTN","ORY24303",21,0)
 ;;R^"863.9:","863.91:3",.01,"E"
"RTN","ORY24303",22,0)
 ;;D^OCXO GENERATE CODE FUNCTION
"RTN","ORY24303",23,0)
 ;;R^"863.9:","863.91:3",1,"E"
"RTN","ORY24303",24,0)
 ;;D^GCC NUMERIC LESS THAN
"RTN","ORY24303",25,0)
 ;;EOR^
"RTN","ORY24303",26,0)
 ;;KEY^863.9:^LOGICAL FALSE
"RTN","ORY24303",27,0)
 ;;R^"863.9:",.01,"E"
"RTN","ORY24303",28,0)
 ;;D^LOGICAL FALSE
"RTN","ORY24303",29,0)
 ;;R^"863.9:",.02,"E"
"RTN","ORY24303",30,0)
 ;;D^BOOLEAN
"RTN","ORY24303",31,0)
 ;;R^"863.9:",.03,"E"
"RTN","ORY24303",32,0)
 ;;D^GCC BOOLEAN LOGICAL FALSE
"RTN","ORY24303",33,0)
 ;;R^"863.9:",.04,"E"
"RTN","ORY24303",34,0)
 ;;D^IS FALSE
"RTN","ORY24303",35,0)
 ;;R^"863.9:","863.91:1",.01,"E"
"RTN","ORY24303",36,0)
 ;;D^OCXO GENERATE CODE FUNCTION
"RTN","ORY24303",37,0)
 ;;R^"863.9:","863.91:1",1,"E"
"RTN","ORY24303",38,0)
 ;;D^GCC BOOLEAN LOGICAL FALSE
"RTN","ORY24303",39,0)
 ;;R^"863.9:","863.92:1",.01,"E"
"RTN","ORY24303",40,0)
 ;;D^FALSE
"RTN","ORY24303",41,0)
 ;;EOR^
"RTN","ORY24303",42,0)
 ;;KEY^863.9:^LOGICAL TRUE
"RTN","ORY24303",43,0)
 ;;R^"863.9:",.01,"E"
"RTN","ORY24303",44,0)
 ;;D^LOGICAL TRUE
"RTN","ORY24303",45,0)
 ;;R^"863.9:",.02,"E"
"RTN","ORY24303",46,0)
 ;;D^BOOLEAN
"RTN","ORY24303",47,0)
 ;;R^"863.9:",.03,"E"
"RTN","ORY24303",48,0)
 ;;D^GCC BOOLEAN LOGICAL TRUE
"RTN","ORY24303",49,0)
 ;;R^"863.9:",.04,"E"
"RTN","ORY24303",50,0)
 ;;D^IS TRUE
"RTN","ORY24303",51,0)
 ;;R^"863.9:","863.91:1",.01,"E"
"RTN","ORY24303",52,0)
 ;;D^OCXO GENERATE CODE FUNCTION
"RTN","ORY24303",53,0)
 ;;R^"863.9:","863.91:1",1,"E"
"RTN","ORY24303",54,0)
 ;;D^GCC BOOLEAN LOGICAL TRUE
"RTN","ORY24303",55,0)
 ;;R^"863.9:","863.92:1",.01,"E"
"RTN","ORY24303",56,0)
 ;;D^TRUE
"RTN","ORY24303",57,0)
 ;;EOR^
"RTN","ORY24303",58,0)
 ;;KEY^863.9:^STARTS WITH
"RTN","ORY24303",59,0)
 ;;R^"863.9:",.01,"E"
"RTN","ORY24303",60,0)
 ;;D^STARTS WITH
"RTN","ORY24303",61,0)
 ;;R^"863.9:",.02,"E"
"RTN","ORY24303",62,0)
 ;;D^FREE TEXT
"RTN","ORY24303",63,0)
 ;;R^"863.9:",.04,"E"
"RTN","ORY24303",64,0)
 ;;D^STARTS WITH
"RTN","ORY24303",65,0)
 ;;R^"863.9:","863.91:3",.01,"E"
"RTN","ORY24303",66,0)
 ;;D^OCXO GENERATE CODE FUNCTION
"RTN","ORY24303",67,0)
 ;;R^"863.9:","863.91:3",1,"E"
"RTN","ORY24303",68,0)
 ;;D^GCC FREE TEXT STARTS WITH
"RTN","ORY24303",69,0)
 ;;R^"863.9:","863.92:1",.01,"E"
"RTN","ORY24303",70,0)
 ;;D^BEGINS WITH
"RTN","ORY24303",71,0)
 ;;EOR^
"RTN","ORY24303",72,0)
 ;;EOF^OCXS(863.9)^1
"RTN","ORY24303",73,0)
 ;;SOF^863.4  OCX MDD ATTRIBUTE
"RTN","ORY24303",74,0)
 ;;KEY^863.4:^CLOZAPINE ANC W/IN 7 FLAG
"RTN","ORY24303",75,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY24303",76,0)
 ;;D^CLOZAPINE ANC W/IN 7 FLAG
"RTN","ORY24303",77,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY24303",78,0)
 ;;D^DATA TYPE
"RTN","ORY24303",79,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY24303",80,0)
 ;;D^BOOLEAN
"RTN","ORY24303",81,0)
 ;;EOR^
"RTN","ORY24303",82,0)
 ;;KEY^863.4:^CLOZAPINE ANC W/IN 7 RESULT
"RTN","ORY24303",83,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY24303",84,0)
 ;;D^CLOZAPINE ANC W/IN 7 RESULT
"RTN","ORY24303",85,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY24303",86,0)
 ;;D^DATA TYPE
"RTN","ORY24303",87,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY24303",88,0)
 ;;D^NUMERIC
"RTN","ORY24303",89,0)
 ;;EOR^
"RTN","ORY24303",90,0)
 ;;KEY^863.4:^CLOZAPINE LAB RESULTS
"RTN","ORY24303",91,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY24303",92,0)
 ;;D^CLOZAPINE LAB RESULTS
"RTN","ORY24303",93,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY24303",94,0)
 ;;D^DATA TYPE
"RTN","ORY24303",95,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY24303",96,0)
 ;;D^FREE TEXT
"RTN","ORY24303",97,0)
 ;;EOR^
"RTN","ORY24303",98,0)
 ;;KEY^863.4:^CLOZAPINE MED
"RTN","ORY24303",99,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY24303",100,0)
 ;;D^CLOZAPINE MED
"RTN","ORY24303",101,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY24303",102,0)
 ;;D^DATA TYPE
"RTN","ORY24303",103,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY24303",104,0)
 ;;D^BOOLEAN
"RTN","ORY24303",105,0)
 ;;EOR^
"RTN","ORY24303",106,0)
 ;;KEY^863.4:^CLOZAPINE WBC W/IN 7 FLAG
"RTN","ORY24303",107,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY24303",108,0)
 ;;D^CLOZAPINE WBC W/IN 7 FLAG
"RTN","ORY24303",109,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY24303",110,0)
 ;;D^DATA TYPE
"RTN","ORY24303",111,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY24303",112,0)
 ;;D^BOOLEAN
"RTN","ORY24303",113,0)
 ;;EOR^
"RTN","ORY24303",114,0)
 ;;KEY^863.4:^CLOZAPINE WBC W/IN 7 RESULT
"RTN","ORY24303",115,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY24303",116,0)
 ;;D^CLOZAPINE WBC W/IN 7 RESULT
"RTN","ORY24303",117,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY24303",118,0)
 ;;D^DATA TYPE
"RTN","ORY24303",119,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY24303",120,0)
 ;;D^NUMERIC
"RTN","ORY24303",121,0)
 ;;EOR^
"RTN","ORY24303",122,0)
 ;;KEY^863.4:^DISPENSE DRUG
"RTN","ORY24303",123,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY24303",124,0)
 ;;D^DISPENSE DRUG
"RTN","ORY24303",125,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY24303",126,0)
 ;;D^DATA TYPE
"RTN","ORY24303",127,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY24303",128,0)
 ;;D^FREE TEXT
"RTN","ORY24303",129,0)
 ;;EOR^
"RTN","ORY24303",130,0)
 ;;KEY^863.4:^FILLER
"RTN","ORY24303",131,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY24303",132,0)
 ;;D^FILLER
"RTN","ORY24303",133,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY24303",134,0)
 ;;D^DATA TYPE
"RTN","ORY24303",135,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY24303",136,0)
 ;;D^FREE TEXT
"RTN","ORY24303",137,0)
 ;;EOR^
"RTN","ORY24303",138,0)
 ;;KEY^863.4:^HL7 FILLER
"RTN","ORY24303",139,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY24303",140,0)
 ;;D^HL7 FILLER
"RTN","ORY24303",141,0)
 ;;R^"863.4:",.02,"E"
"RTN","ORY24303",142,0)
 ;;D^HL7FILLR
"RTN","ORY24303",143,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY24303",144,0)
 ;;D^DATA TYPE
"RTN","ORY24303",145,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY24303",146,0)
 ;;D^FREE TEXT
"RTN","ORY24303",147,0)
 ;;EOR^
"RTN","ORY24303",148,0)
 ;;KEY^863.4:^IEN
"RTN","ORY24303",149,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY24303",150,0)
 ;;D^IEN
"RTN","ORY24303",151,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY24303",152,0)
 ;;D^DATA TYPE
"RTN","ORY24303",153,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY24303",154,0)
 ;;D^NUMERIC
"RTN","ORY24303",155,0)
 ;;EOR^
"RTN","ORY24303",156,0)
 ;;KEY^863.4:^ORDER MODE
"RTN","ORY24303",157,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY24303",158,0)
 ;;D^ORDER MODE
"RTN","ORY24303",159,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY24303",160,0)
 ;;D^DATA TYPE
"RTN","ORY24303",161,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY24303",162,0)
 ;;D^FREE TEXT
"RTN","ORY24303",163,0)
 ;;EOR^
"RTN","ORY24303",164,0)
 ;;KEY^863.4:^ORDER PATIENT
"RTN","ORY24303",165,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY24303",166,0)
 ;;D^ORDER PATIENT
"RTN","ORY24303",167,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY24303",168,0)
 ;;D^DATA TYPE
"RTN","ORY24303",169,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY24303",170,0)
 ;;D^NUMERIC
"RTN","ORY24303",171,0)
 ;;EOR^
"RTN","ORY24303",172,0)
 ;;EOF^OCXS(863.4)^1
"RTN","ORY24303",173,0)
 ;;SOF^863.2  OCX MDD SUBJECT
"RTN","ORY24303",174,0)
 ;;KEY^863.2:^PATIENT
"RTN","ORY24303",175,0)
 ;;R^"863.2:",.01,"E"
"RTN","ORY24303",176,0)
 ;;D^PATIENT
"RTN","ORY24303",177,0)
 ;;R^"863.2:","863.21:1",.01,"E"
"RTN","ORY24303",178,0)
 ;;D^FILE
"RTN","ORY24303",179,0)
 ;;R^"863.2:","863.21:1",1,"E"
"RTN","ORY24303",180,0)
 ;;D^2
"RTN","ORY24303",181,0)
 ;;EOR^
"RTN","ORY24303",182,0)
 ;;EOF^OCXS(863.2)^1
"RTN","ORY24303",183,0)
 ;;SOF^863.3  OCX MDD LINK
"RTN","ORY24303",184,0)
 ;;KEY^863.3:^PATIENT.CLOZAPINE MED
"RTN","ORY24303",185,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY24303",186,0)
 ;;D^PATIENT.CLOZAPINE MED
"RTN","ORY24303",187,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY24303",188,0)
 ;;D^PATIENT
"RTN","ORY24303",189,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY24303",190,0)
 ;;D^CLOZAPINE MED
"RTN","ORY24303",191,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY24303",192,0)
 ;;D^3555
"RTN","ORY24303",193,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY24303",194,0)
 ;;D^OCXO EXTERNAL FUNCTION CALL
"RTN","ORY24303",195,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY24303",196,0)
 ;;D^CLOZLABS^ORKLR(|PATIENT IEN|,7,|DISP DRUG IEN|)
"RTN","ORY24303",197,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY24303",198,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY24303",199,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY24303",200,0)
 ;;D^1
"RTN","ORY24303",201,0)
 ;;EOR^
"RTN","ORY24303",202,0)
 ;;KEY^863.3:^PATIENT.CLOZ_ANC_W/IN_7_FLAG
"RTN","ORY24303",203,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY24303",204,0)
 ;;D^PATIENT.CLOZ_ANC_W/IN_7_FLAG
"RTN","ORY24303",205,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY24303",206,0)
 ;;D^PATIENT
"RTN","ORY24303",207,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY24303",208,0)
 ;;D^CLOZAPINE ANC W/IN 7 FLAG
"RTN","ORY24303",209,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY24303",210,0)
 ;;D^OCXO EXTERNAL FUNCTION CALL
"RTN","ORY24303",211,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY24303",212,0)
 ;;D^CLOZLABS^ORKLR(|PATIENT IEN|,7,|DISP DRUG IEN|)
"RTN","ORY24303",213,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY24303",214,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY24303",215,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY24303",216,0)
 ;;D^3
"RTN","ORY24303",217,0)
 ;;R^"863.3:","863.32:3",.01,"E"
"RTN","ORY24303",218,0)
 ;;D^OCXO SEMI-COLON PIECE NUMBER
"RTN","ORY24303",219,0)
 ;;R^"863.3:","863.32:3",1,"E"
"RTN","ORY24303",220,0)
 ;;D^1
"RTN","ORY24303",221,0)
 ;;EOR^
"RTN","ORY24303",222,0)
 ;;KEY^863.3:^PATIENT.CLOZ_ANC_W/IN_7_RSLT
"RTN","ORY24303",223,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY24303",224,0)
 ;;D^PATIENT.CLOZ_ANC_W/IN_7_RSLT
"RTN","ORY24303",225,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY24303",226,0)
 ;;D^PATIENT
"RTN","ORY24303",227,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY24303",228,0)
 ;;D^CLOZAPINE ANC W/IN 7 RESULT
"RTN","ORY24303",229,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY24303",230,0)
 ;;D^OCXO EXTERNAL FUNCTION CALL
"RTN","ORY24303",231,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY24303",232,0)
 ;;D^CLOZLABS^ORKLR(|PATIENT IEN|,7,|DISP DRUG IEN|)
"RTN","ORY24303",233,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY24303",234,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY24303",235,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY24303",236,0)
 ;;D^3
"RTN","ORY24303",237,0)
 ;;R^"863.3:","863.32:3",.01,"E"
"RTN","ORY24303",238,0)
 ;;D^OCXO SEMI-COLON PIECE NUMBER
"RTN","ORY24303",239,0)
 ;;R^"863.3:","863.32:3",1,"E"
"RTN","ORY24303",240,0)
 ;;D^2
"RTN","ORY24303",241,0)
 ;;EOR^
"RTN","ORY24303",242,0)
 ;;KEY^863.3:^PATIENT.CLOZ_LAB_RESULTS
"RTN","ORY24303",243,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY24303",244,0)
 ;;D^PATIENT.CLOZ_LAB_RESULTS
"RTN","ORY24303",245,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY24303",246,0)
 ;;D^PATIENT
"RTN","ORY24303",247,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY24303",248,0)
 ;;D^CLOZAPINE LAB RESULTS
"RTN","ORY24303",249,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY24303",250,0)
 ;;D^OCXO EXTERNAL FUNCTION CALL
"RTN","ORY24303",251,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY24303",252,0)
 ;;D^CLOZLABS^ORKLR(|PATIENT IEN|,"",|DISP DRUG IEN|)
"RTN","ORY24303",253,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY24303",254,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY24303",255,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY24303",256,0)
 ;;D^4
"RTN","ORY24303",257,0)
 ;;EOR^
"RTN","ORY24303",258,0)
 ;;KEY^863.3:^PATIENT.CLOZ_WBC_W/IN_7_FLAG
"RTN","ORY24303",259,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY24303",260,0)
 ;;D^PATIENT.CLOZ_WBC_W/IN_7_FLAG
"RTN","ORY24303",261,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY24303",262,0)
 ;;D^PATIENT
"RTN","ORY24303",263,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY24303",264,0)
 ;;D^CLOZAPINE WBC W/IN 7 FLAG
"RTN","ORY24303",265,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY24303",266,0)
 ;;D^999
"RTN","ORY24303",267,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY24303",268,0)
 ;;D^OCXO EXTERNAL FUNCTION CALL
"RTN","ORY24303",269,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY24303",270,0)
 ;;D^CLOZLABS^ORKLR(|PATIENT IEN|,7,|DISP DRUG IEN|)
"RTN","ORY24303",271,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY24303",272,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY24303",273,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY24303",274,0)
 ;;D^2
"RTN","ORY24303",275,0)
 ;;R^"863.3:","863.32:3",.01,"E"
"RTN","ORY24303",276,0)
 ;;D^OCXO SEMI-COLON PIECE NUMBER
"RTN","ORY24303",277,0)
 ;;R^"863.3:","863.32:3",1,"E"
"RTN","ORY24303",278,0)
 ;;D^1
"RTN","ORY24303",279,0)
 ;;EOR^
"RTN","ORY24303",280,0)
 ;;KEY^863.3:^PATIENT.CLOZ_WBC_W/IN_7_RSLT
"RTN","ORY24303",281,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY24303",282,0)
 ;;D^PATIENT.CLOZ_WBC_W/IN_7_RSLT
"RTN","ORY24303",283,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY24303",284,0)
 ;;D^PATIENT
"RTN","ORY24303",285,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY24303",286,0)
 ;;D^CLOZAPINE WBC W/IN 7 RESULT
"RTN","ORY24303",287,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY24303",288,0)
 ;;D^OCXO EXTERNAL FUNCTION CALL
"RTN","ORY24303",289,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY24303",290,0)
 ;;D^CLOZLABS^ORKLR(|PATIENT IEN|,7,|DISP DRUG IEN|)
"RTN","ORY24303",291,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY24303",292,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY24303",293,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY24303",294,0)
 ;;D^2
"RTN","ORY24303",295,0)
 ;;R^"863.3:","863.32:3",.01,"E"
"RTN","ORY24303",296,0)
 ;;D^OCXO SEMI-COLON PIECE NUMBER
"RTN","ORY24303",297,0)
 ;;R^"863.3:","863.32:3",1,"E"
"RTN","ORY24303",298,0)
 ;;D^2
"RTN","ORY24303",299,0)
 ;;EOR^
"RTN","ORY24303",300,0)
 ;;KEY^863.3:^PATIENT.HL7_FILLER
"RTN","ORY24303",301,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY24303",302,0)
 ;;D^PATIENT.HL7_FILLER
"RTN","ORY24303",303,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY24303",304,0)
 ;;D^PATIENT
"RTN","ORY24303",305,0)
 ;;R^"863.3:",.04,"E"
"RTN","ORY24303",306,0)
 ;;D^HL7
"RTN","ORY24303",307,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY24303",308,0)
 ;;D^HL7 FILLER
"RTN","ORY24303",309,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY24303",310,0)
 ;;D^OCXO VT-BAR PIECE NUMBER
"RTN","ORY24303",311,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY24303",312,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY24303",313,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY24303",314,0)
 ;;D^2
"RTN","ORY24303",315,0)
 ;;R^"863.3:","863.32:3",.01,"E"
"RTN","ORY24303",316,0)
 ;;D^OCXO VARIABLE NAME
"RTN","ORY24303",317,0)
 ;1;
"RTN","ORY24303",318,0)
 ;
"RTN","ORY24304")
0^82^B86792017
"RTN","ORY24304",1,0)
ORY24304 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*243) ;NOV 2,2006 at 12:05
"RTN","ORY24304",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17,1997;Build 242
"RTN","ORY24304",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY24304",4,0)
 ;
"RTN","ORY24304",5,0)
S ;
"RTN","ORY24304",6,0)
 ;
"RTN","ORY24304",7,0)
 D DOT^ORY243ES
"RTN","ORY24304",8,0)
 ;
"RTN","ORY24304",9,0)
 ;
"RTN","ORY24304",10,0)
 K REMOTE,LOCAL,OPCODE,REF
"RTN","ORY24304",11,0)
 F LINE=1:1:500 S TEXT=$P($T(DATA+LINE),";",2,999) Q:TEXT  I $L(TEXT) D  Q:QUIT
"RTN","ORY24304",12,0)
 .S ^TMP("OCXRULE",$J,$O(^TMP("OCXRULE",$J,"A"),-1)+1)=TEXT
"RTN","ORY24304",13,0)
 ;
"RTN","ORY24304",14,0)
 G ^ORY24305
"RTN","ORY24304",15,0)
 ;
"RTN","ORY24304",16,0)
 Q
"RTN","ORY24304",17,0)
 ;
"RTN","ORY24304",18,0)
DATA ;
"RTN","ORY24304",19,0)
 ;
"RTN","ORY24304",20,0)
 ;;R^"863.3:","863.32:3",1,"E"
"RTN","ORY24304",21,0)
 ;;D^OCXODATA("ORC",3)
"RTN","ORY24304",22,0)
 ;;R^"863.3:","863.32:4",.01,"E"
"RTN","ORY24304",23,0)
 ;;D^OCXO HL7 SEGMENT ID
"RTN","ORY24304",24,0)
 ;;R^"863.3:","863.32:5",.01,"E"
"RTN","ORY24304",25,0)
 ;;D^OCXO DATA DRIVE SOURCE
"RTN","ORY24304",26,0)
 ;;R^"863.3:","863.32:5",1,"E"
"RTN","ORY24304",27,0)
 ;;D^HL7
"RTN","ORY24304",28,0)
 ;;R^"863.3:","863.32:6",.01,"E"
"RTN","ORY24304",29,0)
 ;;D^OCXO FILE POINTER
"RTN","ORY24304",30,0)
 ;;EOR^
"RTN","ORY24304",31,0)
 ;;KEY^863.3:^PATIENT.HL7_PATIENT_ID
"RTN","ORY24304",32,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY24304",33,0)
 ;;D^PATIENT.HL7_PATIENT_ID
"RTN","ORY24304",34,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY24304",35,0)
 ;;D^PATIENT
"RTN","ORY24304",36,0)
 ;;R^"863.3:",.04,"E"
"RTN","ORY24304",37,0)
 ;;D^HL7
"RTN","ORY24304",38,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY24304",39,0)
 ;;D^IEN
"RTN","ORY24304",40,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY24304",41,0)
 ;;D^99
"RTN","ORY24304",42,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY24304",43,0)
 ;;D^OCXO HL7 SEGMENT ID
"RTN","ORY24304",44,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY24304",45,0)
 ;;D^OCXO VT-BAR PIECE NUMBER
"RTN","ORY24304",46,0)
 ;;R^"863.3:","863.32:3",.01,"E"
"RTN","ORY24304",47,0)
 ;;D^OCXO VARIABLE NAME
"RTN","ORY24304",48,0)
 ;;R^"863.3:","863.32:3",1,"E"
"RTN","ORY24304",49,0)
 ;;D^OCXODATA("PID",3)
"RTN","ORY24304",50,0)
 ;;EOR^
"RTN","ORY24304",51,0)
 ;;KEY^863.3:^PATIENT.IEN
"RTN","ORY24304",52,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY24304",53,0)
 ;;D^PATIENT.IEN
"RTN","ORY24304",54,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY24304",55,0)
 ;;D^PATIENT
"RTN","ORY24304",56,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY24304",57,0)
 ;;D^IEN
"RTN","ORY24304",58,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY24304",59,0)
 ;;D^99
"RTN","ORY24304",60,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY24304",61,0)
 ;;D^OCXO VARIABLE NAME
"RTN","ORY24304",62,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY24304",63,0)
 ;;D^DFN
"RTN","ORY24304",64,0)
 ;;EOR^
"RTN","ORY24304",65,0)
 ;;KEY^863.3:^PATIENT.OERR_ORDER_PATIENT
"RTN","ORY24304",66,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY24304",67,0)
 ;;D^PATIENT.OERR_ORDER_PATIENT
"RTN","ORY24304",68,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY24304",69,0)
 ;;D^PATIENT
"RTN","ORY24304",70,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY24304",71,0)
 ;;D^ORDER PATIENT
"RTN","ORY24304",72,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY24304",73,0)
 ;;D^5567
"RTN","ORY24304",74,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY24304",75,0)
 ;;D^OCXO VARIABLE NAME
"RTN","ORY24304",76,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY24304",77,0)
 ;;D^OCXORD
"RTN","ORY24304",78,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY24304",79,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY24304",80,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY24304",81,0)
 ;;D^1
"RTN","ORY24304",82,0)
 ;;EOR^
"RTN","ORY24304",83,0)
 ;;KEY^863.3:^PATIENT.OPS_DRUG_ID
"RTN","ORY24304",84,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY24304",85,0)
 ;;D^PATIENT.OPS_DRUG_ID
"RTN","ORY24304",86,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY24304",87,0)
 ;;D^PATIENT
"RTN","ORY24304",88,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY24304",89,0)
 ;;D^DISPENSE DRUG
"RTN","ORY24304",90,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY24304",91,0)
 ;;D^33
"RTN","ORY24304",92,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY24304",93,0)
 ;;D^OCXO VARIABLE NAME
"RTN","ORY24304",94,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY24304",95,0)
 ;;D^OCXPSD
"RTN","ORY24304",96,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY24304",97,0)
 ;;D^OCXO VT-BAR PIECE NUMBER
"RTN","ORY24304",98,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY24304",99,0)
 ;;D^2
"RTN","ORY24304",100,0)
 ;;R^"863.3:","863.32:3",.01,"E"
"RTN","ORY24304",101,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY24304",102,0)
 ;;R^"863.3:","863.32:3",1,"E"
"RTN","ORY24304",103,0)
 ;;D^4
"RTN","ORY24304",104,0)
 ;;EOR^
"RTN","ORY24304",105,0)
 ;;KEY^863.3:^PATIENT.OPS_FILLER
"RTN","ORY24304",106,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY24304",107,0)
 ;;D^PATIENT.OPS_FILLER
"RTN","ORY24304",108,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY24304",109,0)
 ;;D^PATIENT
"RTN","ORY24304",110,0)
 ;;R^"863.3:",.04,"E"
"RTN","ORY24304",111,0)
 ;;D^OPS
"RTN","ORY24304",112,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY24304",113,0)
 ;;D^FILLER
"RTN","ORY24304",114,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY24304",115,0)
 ;;D^99
"RTN","ORY24304",116,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY24304",117,0)
 ;;D^OCXO VARIABLE NAME
"RTN","ORY24304",118,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY24304",119,0)
 ;;D^OCXPSD
"RTN","ORY24304",120,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY24304",121,0)
 ;;D^OCXO VT-BAR PIECE NUMBER
"RTN","ORY24304",122,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY24304",123,0)
 ;;D^1
"RTN","ORY24304",124,0)
 ;;EOR^
"RTN","ORY24304",125,0)
 ;;KEY^863.3:^PATIENT.OPS_ORD_MODE
"RTN","ORY24304",126,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY24304",127,0)
 ;;D^PATIENT.OPS_ORD_MODE
"RTN","ORY24304",128,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY24304",129,0)
 ;;D^PATIENT
"RTN","ORY24304",130,0)
 ;;R^"863.3:",.04,"E"
"RTN","ORY24304",131,0)
 ;;D^OPS
"RTN","ORY24304",132,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY24304",133,0)
 ;;D^ORDER MODE
"RTN","ORY24304",134,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY24304",135,0)
 ;;D^99
"RTN","ORY24304",136,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY24304",137,0)
 ;;D^OCXO VARIABLE NAME
"RTN","ORY24304",138,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY24304",139,0)
 ;;D^OCXPSM
"RTN","ORY24304",140,0)
 ;;EOR^
"RTN","ORY24304",141,0)
 ;;EOF^OCXS(863.3)^1
"RTN","ORY24304",142,0)
 ;;SOF^860.9  ORDER CHECK NATIONAL TERM
"RTN","ORY24304",143,0)
 ;;KEY^860.9:^ANGIOGRAM (PERIPHERAL)
"RTN","ORY24304",144,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY24304",145,0)
 ;;D^ANGIOGRAM (PERIPHERAL)
"RTN","ORY24304",146,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY24304",147,0)
 ;;D^101.43
"RTN","ORY24304",148,0)
 ;;EOR^
"RTN","ORY24304",149,0)
 ;;KEY^860.9:^BLOOD SPECIMEN
"RTN","ORY24304",150,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY24304",151,0)
 ;;D^BLOOD SPECIMEN
"RTN","ORY24304",152,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY24304",153,0)
 ;;D^61
"RTN","ORY24304",154,0)
 ;;EOR^
"RTN","ORY24304",155,0)
 ;;KEY^860.9:^DANGEROUS MEDS FOR PTS > 64
"RTN","ORY24304",156,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY24304",157,0)
 ;;D^DANGEROUS MEDS FOR PTS > 64
"RTN","ORY24304",158,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY24304",159,0)
 ;;D^101.43
"RTN","ORY24304",160,0)
 ;;R^"860.9:",2,"E"
"RTN","ORY24304",161,0)
 ;;D^I $P($G(^ORD(100.98,$P($G(^ORD(101.43,+Y,0)),U,5),0)),U)="PHARMACY"
"RTN","ORY24304",162,0)
 ;;EOR^
"RTN","ORY24304",163,0)
 ;;KEY^860.9:^DNR
"RTN","ORY24304",164,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY24304",165,0)
 ;;D^DNR
"RTN","ORY24304",166,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY24304",167,0)
 ;;D^101.43
"RTN","ORY24304",168,0)
 ;;EOR^
"RTN","ORY24304",169,0)
 ;;KEY^860.9:^EGFR
"RTN","ORY24304",170,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY24304",171,0)
 ;;D^EGFR
"RTN","ORY24304",172,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY24304",173,0)
 ;;D^60
"RTN","ORY24304",174,0)
 ;;EOR^
"RTN","ORY24304",175,0)
 ;;KEY^860.9:^FOOD-DRUG INTERACTION MED
"RTN","ORY24304",176,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY24304",177,0)
 ;;D^FOOD-DRUG INTERACTION MED
"RTN","ORY24304",178,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY24304",179,0)
 ;;D^101.43
"RTN","ORY24304",180,0)
 ;;R^"860.9:",2,"E"
"RTN","ORY24304",181,0)
 ;;D^I $P($G(^ORD(100.98,$P($G(^ORD(101.43,+Y,0)),U,5),0)),U)="PHARMACY"
"RTN","ORY24304",182,0)
 ;;EOR^
"RTN","ORY24304",183,0)
 ;;KEY^860.9:^NPO
"RTN","ORY24304",184,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY24304",185,0)
 ;;D^NPO
"RTN","ORY24304",186,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY24304",187,0)
 ;;D^101.43
"RTN","ORY24304",188,0)
 ;;EOR^
"RTN","ORY24304",189,0)
 ;;KEY^860.9:^ONE TIME MED
"RTN","ORY24304",190,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY24304",191,0)
 ;;D^ONE TIME MED
"RTN","ORY24304",192,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY24304",193,0)
 ;;D^51.1
"RTN","ORY24304",194,0)
 ;;R^"860.9:",2,"E"
"RTN","ORY24304",195,0)
 ;;D^I $E($P(^(0),U,4),1,2)="PS"
"RTN","ORY24304",196,0)
 ;;EOR^
"RTN","ORY24304",197,0)
 ;;KEY^860.9:^PARTIAL THROMBOPLASTIN TIME
"RTN","ORY24304",198,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY24304",199,0)
 ;;D^PARTIAL THROMBOPLASTIN TIME
"RTN","ORY24304",200,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY24304",201,0)
 ;;D^101.43
"RTN","ORY24304",202,0)
 ;;EOR^
"RTN","ORY24304",203,0)
 ;;KEY^860.9:^PROTHROMBIN TIME
"RTN","ORY24304",204,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY24304",205,0)
 ;;D^PROTHROMBIN TIME
"RTN","ORY24304",206,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY24304",207,0)
 ;;D^101.43
"RTN","ORY24304",208,0)
 ;;EOR^
"RTN","ORY24304",209,0)
 ;;KEY^860.9:^SERUM CREATININE
"RTN","ORY24304",210,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY24304",211,0)
 ;;D^SERUM CREATININE
"RTN","ORY24304",212,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY24304",213,0)
 ;;D^60
"RTN","ORY24304",214,0)
 ;;EOR^
"RTN","ORY24304",215,0)
 ;;KEY^860.9:^SERUM SPECIMEN
"RTN","ORY24304",216,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY24304",217,0)
 ;;D^SERUM SPECIMEN
"RTN","ORY24304",218,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY24304",219,0)
 ;;D^61
"RTN","ORY24304",220,0)
 ;;EOR^
"RTN","ORY24304",221,0)
 ;;KEY^860.9:^SERUM UREA NITROGEN
"RTN","ORY24304",222,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY24304",223,0)
 ;;D^SERUM UREA NITROGEN
"RTN","ORY24304",224,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY24304",225,0)
 ;;D^60
"RTN","ORY24304",226,0)
 ;;EOR^
"RTN","ORY24304",227,0)
 ;;KEY^860.9:^THROMBOPLASTIN TIME PARTIAL
"RTN","ORY24304",228,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY24304",229,0)
 ;;D^THROMBOPLASTIN TIME PARTIAL
"RTN","ORY24304",230,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY24304",231,0)
 ;;D^60
"RTN","ORY24304",232,0)
 ;;EOR^
"RTN","ORY24304",233,0)
 ;;KEY^860.9:^WBC
"RTN","ORY24304",234,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY24304",235,0)
 ;;D^WBC
"RTN","ORY24304",236,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY24304",237,0)
 ;;D^60
"RTN","ORY24304",238,0)
 ;;EOR^
"RTN","ORY24304",239,0)
 ;;EOF^OCXS(860.9)^1
"RTN","ORY24304",240,0)
 ;;SOF^860.8  ORDER CHECK COMPILER FUNCTIONS
"RTN","ORY24304",241,0)
 ;;KEY^860.8:^CONVERT DATE FROM FILEMAN FORMAT TO OCX FORMAT
"RTN","ORY24304",242,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY24304",243,0)
 ;;D^CONVERT DATE FROM FILEMAN FORMAT TO OCX FORMAT
"RTN","ORY24304",244,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY24304",245,0)
 ;;D^DT2INT
"RTN","ORY24304",246,0)
 ;;R^"860.8:",1,1
"RTN","ORY24304",247,0)
 ;;D^  ;DT2INT(OCXDT) ;      This Local Extrinsic Function converts a date into an integer
"RTN","ORY24304",248,0)
 ;;R^"860.8:",1,2
"RTN","ORY24304",249,0)
 ;;D^  ; ; By taking the Years, Months, Days, Hours and Minutes converting
"RTN","ORY24304",250,0)
 ;;R^"860.8:",1,3
"RTN","ORY24304",251,0)
 ;;D^  ; ; Them into Seconds and then adding them all together into one big integer
"RTN","ORY24304",252,0)
 ;;R^"860.8:",100,1
"RTN","ORY24304",253,0)
 ;;D^  ;DT2INT(OCXDT) ;      This Local Extrinsic Function converts a date into an integer
"RTN","ORY24304",254,0)
 ;;R^"860.8:",100,2
"RTN","ORY24304",255,0)
 ;;D^  ; ; By taking the Years, Months, Days, Hours and Minutes converting
"RTN","ORY24304",256,0)
 ;;R^"860.8:",100,3
"RTN","ORY24304",257,0)
 ;;D^  ; ; Them into Seconds and then adding them all together into one big integer
"RTN","ORY24304",258,0)
 ;;R^"860.8:",100,4
"RTN","ORY24304",259,0)
 ;;D^  ; ;
"RTN","ORY24304",260,0)
 ;;R^"860.8:",100,5
"RTN","ORY24304",261,0)
 ;;D^  ; Q:'$L($G(OCXDT)) ""
"RTN","ORY24304",262,0)
 ;;R^"860.8:",100,6
"RTN","ORY24304",263,0)
 ;;D^  ; N OCXDIFF,OCXVAL S (OCXDIFF,OCXVAL)=0
"RTN","ORY24304",264,0)
 ;;R^"860.8:",100,7
"RTN","ORY24304",265,0)
 ;;D^  ; ;
"RTN","ORY24304",266,0)
 ;;R^"860.8:",100,8
"RTN","ORY24304",267,0)
 ;;D^  ; I $L(OCXDT),'OCXDT,(OCXDT[" at ") D  ; EXTERNAL EXPERT SYSTEM FORMAT 1 TO EXTERNAL FORMAT
"RTN","ORY24304",268,0)
 ;;R^"860.8:",100,9
"RTN","ORY24304",269,0)
 ;;D^  ; .N OCXHR,OCXMIN,OCXTIME
"RTN","ORY24304",270,0)
 ;;R^"860.8:",100,10
"RTN","ORY24304",271,0)
 ;;D^  ; .S OCXTIME=$P($P(OCXDT," at ",2),".",1),OCXHR=$P(OCXTIME,":",1),OCXMIN=$P(OCXTIME,":",2)
"RTN","ORY24304",272,0)
 ;;R^"860.8:",100,11
"RTN","ORY24304",273,0)
 ;;D^  ; .S:(OCXDT["Midnight") OCXHR=00
"RTN","ORY24304",274,0)
 ;;R^"860.8:",100,12
"RTN","ORY24304",275,0)
 ;;D^  ; .S:(OCXDT["PM") OCXHR=OCXHR+12
"RTN","ORY24304",276,0)
 ;;R^"860.8:",100,13
"RTN","ORY24304",277,0)
 ;;D^  ; .S OCXDT=$P(OCXDT," at ")_"@"_$E(OCXHR+100,2,3)_$E(OCXMIN+100,2,3)
"RTN","ORY24304",278,0)
 ;;R^"860.8:",100,14
"RTN","ORY24304",279,0)
 ;;D^  ; ;
"RTN","ORY24304",280,0)
 ;;R^"860.8:",100,15
"RTN","ORY24304",281,0)
 ;;D^  ; I $L(OCXDT),(OCXDT?1.2N1"/"1.2N.1" ".2N.1":".2N) D  ; EXTERNAL EXPERT SYSTEM FORMAT 2 TO EXTERNAL FORMAT
"RTN","ORY24304",282,0)
 ;;R^"860.8:",100,16
"RTN","ORY24304",283,0)
 ;;D^  ; .N OCXMON
"RTN","ORY24304",284,0)
 ;;R^"860.8:",100,17
"RTN","ORY24304",285,0)
 ;;D^  ; .S OCXMON=$P("January^February^March^April^May^June^July^August^September^October^November^December",U,$P(OCXDT,"/",1))
"RTN","ORY24304",286,0)
 ;;R^"860.8:",100,18
"RTN","ORY24304",287,0)
 ;;D^  ; .I $L($P(OCXDT," ",2)) S OCXDT=OCXMON_" "_$P($P(OCXDT," ",1),"/",2)_"@"_$TR($P(OCXDT," ",2),":","")
"RTN","ORY24304",288,0)
 ;;R^"860.8:",100,19
"RTN","ORY24304",289,0)
 ;;D^  ; .E  S OCXDT=OCXMON_" "_$P($P(OCXDT," ",1),"/",2)
"RTN","ORY24304",290,0)
 ;;R^"860.8:",100,20
"RTN","ORY24304",291,0)
 ;;D^  ; ;
"RTN","ORY24304",292,0)
 ;;R^"860.8:",100,21
"RTN","ORY24304",293,0)
 ;;D^  ; I $L(OCXDT),(OCXDT?1.2N1"/"1.2N1"/"1.2N.1" ".2N.1":".2N) D  ; EXTERNAL EXPERT SYSTEM FORMAT 3 TO EXTERNAL FORMAT
"RTN","ORY24304",294,0)
 ;;R^"860.8:",100,22
"RTN","ORY24304",295,0)
 ;;D^  ; .N OCXMON
"RTN","ORY24304",296,0)
 ;;R^"860.8:",100,23
"RTN","ORY24304",297,0)
 ;;D^  ; .S OCXMON=$P("January^February^March^April^May^June^July^August^September^October^November^December",U,$P(OCXDT,"/",1))
"RTN","ORY24304",298,0)
 ;1;
"RTN","ORY24304",299,0)
 ;
"RTN","ORY24305")
0^83^B58679499
"RTN","ORY24305",1,0)
ORY24305 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*243) ;NOV 2,2006 at 12:05
"RTN","ORY24305",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17,1997;Build 242
"RTN","ORY24305",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY24305",4,0)
 ;
"RTN","ORY24305",5,0)
S ;
"RTN","ORY24305",6,0)
 ;
"RTN","ORY24305",7,0)
 D DOT^ORY243ES
"RTN","ORY24305",8,0)
 ;
"RTN","ORY24305",9,0)
 ;
"RTN","ORY24305",10,0)
 K REMOTE,LOCAL,OPCODE,REF
"RTN","ORY24305",11,0)
 F LINE=1:1:500 S TEXT=$P($T(DATA+LINE),";",2,999) Q:TEXT  I $L(TEXT) D  Q:QUIT
"RTN","ORY24305",12,0)
 .S ^TMP("OCXRULE",$J,$O(^TMP("OCXRULE",$J,"A"),-1)+1)=TEXT
"RTN","ORY24305",13,0)
 ;
"RTN","ORY24305",14,0)
 G ^ORY24306
"RTN","ORY24305",15,0)
 ;
"RTN","ORY24305",16,0)
 Q
"RTN","ORY24305",17,0)
 ;
"RTN","ORY24305",18,0)
DATA ;
"RTN","ORY24305",19,0)
 ;
"RTN","ORY24305",20,0)
 ;;R^"860.8:",100,24
"RTN","ORY24305",21,0)
 ;;D^  ; .I $L($P(OCXDT," ",2)) S OCXDT=OCXMON_" "_$P($P(OCXDT," ",1),"/",2)_","_$P($P(OCXDT," ",1),"/",3)_"@"_$TR($P(OCXDT," ",2),":","")
"RTN","ORY24305",22,0)
 ;;R^"860.8:",100,25
"RTN","ORY24305",23,0)
 ;;D^  ; .E  S OCXDT=OCXMON_" "_$P($P(OCXDT," ",1),"/",2)_", "_$P($P(OCXDT," ",1),"/",3)
"RTN","ORY24305",24,0)
 ;;R^"860.8:",100,26
"RTN","ORY24305",25,0)
 ;;D^  ; ;
"RTN","ORY24305",26,0)
 ;;R^"860.8:",100,27
"RTN","ORY24305",27,0)
 ;;D^  ; I $L(OCXDT),'OCXDT D  ; EXTERNAL FORMAT TO INTERNAL FILEMAN FORMAT
"RTN","ORY24305",28,0)
 ;;R^"860.8:",100,28
"RTN","ORY24305",29,0)
 ;;D^  ; .I (OCXDT["@0000") S OCXDT=$P(OCXDT,"@",1),OCXDIFF=1
"RTN","ORY24305",30,0)
 ;;R^"860.8:",100,29
"RTN","ORY24305",31,0)
 ;;D^  ; .N %DT,X,Y S X=OCXDT,%DT="" S:(OCXDT["@")!(OCXDT="N") %DT="T" D ^%DT S OCXDT=+Y
"RTN","ORY24305",32,0)
 ;;R^"860.8:",100,30
"RTN","ORY24305",33,0)
 ;;D^  ; ;
"RTN","ORY24305",34,0)
 ;;R^"860.8:",100,31
"RTN","ORY24305",35,0)
 ;;D^  ; I ($L(OCXDT\1)>7) S OCXDT=$$HL7TFM^XLFDT(OCXDT)  ; HL7 FORMAT TO INTERNAL FILEMAN FORMAT
"RTN","ORY24305",36,0)
 ;;R^"860.8:",100,32
"RTN","ORY24305",37,0)
 ;;D^  ; ;
"RTN","ORY24305",38,0)
 ;;R^"860.8:",100,33
"RTN","ORY24305",39,0)
 ;;D^  ; I ($L(OCXDT\1)=7) S OCXDT=$$FMTH^XLFDT(+OCXDT)   ; INTERNAL FILEMAN FORMAT TO $H FORMAT
"RTN","ORY24305",40,0)
 ;;R^"860.8:",100,34
"RTN","ORY24305",41,0)
 ;;D^  ; ;
"RTN","ORY24305",42,0)
 ;;R^"860.8:",100,35
"RTN","ORY24305",43,0)
 ;;D^  ; I (OCXDT?5N1","1.5N) S OCXVAL=(OCXDT*86400)+$P(OCXDT,",",2)     ;  $H FORMAT TO EXPERT SYSTEM INTERNAL FORMAT
"RTN","ORY24305",44,0)
 ;;R^"860.8:",100,36
"RTN","ORY24305",45,0)
 ;;D^  ; ;
"RTN","ORY24305",46,0)
 ;;R^"860.8:",100,37
"RTN","ORY24305",47,0)
 ;;D^  ; Q OCXVAL
"RTN","ORY24305",48,0)
 ;;R^"860.8:",100,38
"RTN","ORY24305",49,0)
 ;;D^  ; ;
"RTN","ORY24305",50,0)
 ;;EOR^
"RTN","ORY24305",51,0)
 ;;KEY^860.8:^CONVERT DATE FROM OCX FORMAT TO READABLE FORMAT
"RTN","ORY24305",52,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY24305",53,0)
 ;;D^CONVERT DATE FROM OCX FORMAT TO READABLE FORMAT
"RTN","ORY24305",54,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY24305",55,0)
 ;;D^INT2DT
"RTN","ORY24305",56,0)
 ;;R^"860.8:",1,1
"RTN","ORY24305",57,0)
 ;;D^  ;INT2DT(OCXDT,OCXF) ;      This Local Extrinsic Function converts an OCX internal format
"RTN","ORY24305",58,0)
 ;;R^"860.8:",1,2
"RTN","ORY24305",59,0)
 ;;D^  ; ; date into an Externl Format (Human Readable) date.   'OCXF=SHORT FORMAT OCXF=LONG FORMAT
"RTN","ORY24305",60,0)
 ;;R^"860.8:",1,3
"RTN","ORY24305",61,0)
 ;;D^  ; ;
"RTN","ORY24305",62,0)
 ;;R^"860.8:",100,1
"RTN","ORY24305",63,0)
 ;;D^  ;INT2DT(OCXDT,OCXF) ;      This Local Extrinsic Function converts an OCX internal format
"RTN","ORY24305",64,0)
 ;;R^"860.8:",100,2
"RTN","ORY24305",65,0)
 ;;D^  ; ; date into an Externl Format (Human Readable) date.   'OCXF=SHORT FORMAT OCXF=LONG FORMAT
"RTN","ORY24305",66,0)
 ;;R^"860.8:",100,3
"RTN","ORY24305",67,0)
 ;;D^  ; ;
"RTN","ORY24305",68,0)
 ;;R^"860.8:",100,4
"RTN","ORY24305",69,0)
 ;;D^  ; Q:'$L($G(OCXDT)) "" S OCXF=+$G(OCXF)
"RTN","ORY24305",70,0)
 ;;R^"860.8:",100,5
"RTN","ORY24305",71,0)
 ;;D^  ; N OCXYR,OCXLPYR,OCXMON,OCXDAY,OCXHR,OCXMIN,OCXSEC,OCXCYR
"RTN","ORY24305",72,0)
 ;;R^"860.8:",100,6
"RTN","ORY24305",73,0)
 ;;D^  ; S (OCXYR,OCXLPYR,OCXMON,OCXDAY,OCXHR,OCXMIN,OCXSEC,OCXAP)=""
"RTN","ORY24305",74,0)
 ;;R^"860.8:",100,7
"RTN","ORY24305",75,0)
 ;;D^  ; S OCXSEC=$E(OCXDT#60+100,2,3),OCXDT=OCXDT\60
"RTN","ORY24305",76,0)
 ;;R^"860.8:",100,8
"RTN","ORY24305",77,0)
 ;;D^  ; S OCXMIN=$E(OCXDT#60+100,2,3),OCXDT=OCXDT\60
"RTN","ORY24305",78,0)
 ;;R^"860.8:",100,9
"RTN","ORY24305",79,0)
 ;;D^  ; S OCXHR=$E(OCXDT#24+100,2,3),OCXDT=OCXDT\24
"RTN","ORY24305",80,0)
 ;;R^"860.8:",100,10
"RTN","ORY24305",81,0)
 ;;D^  ; S OCXCYR=($H\1461)*4+1841+(($H#1461)\365)
"RTN","ORY24305",82,0)
 ;;R^"860.8:",100,11
"RTN","ORY24305",83,0)
 ;;D^  ; S OCXYR=(OCXDT\1461)*4+1841,OCXDT=OCXDT#1461
"RTN","ORY24305",84,0)
 ;;R^"860.8:",100,12
"RTN","ORY24305",85,0)
 ;;D^  ; S OCXLPYR=(OCXDT\365),OCXDT=OCXDT-(OCXLPYR*365),OCXYR=OCXYR+OCXLPYR
"RTN","ORY24305",86,0)
 ;;R^"860.8:",100,13
"RTN","ORY24305",87,0)
 ;;D^  ; S OCXCNT="031^059^090^120^151^181^212^243^273^304^334^365"
"RTN","ORY24305",88,0)
 ;;R^"860.8:",100,14
"RTN","ORY24305",89,0)
 ;;D^  ; S:(OCXLPYR=3) OCXCNT="031^060^091^121^152^182^213^244^274^305^335^366"
"RTN","ORY24305",90,0)
 ;;R^"860.8:",100,15
"RTN","ORY24305",91,0)
 ;;D^  ; F OCXMON=1:1:12 Q:(OCXDT<$P(OCXCNT,U,OCXMON))
"RTN","ORY24305",92,0)
 ;;R^"860.8:",100,16
"RTN","ORY24305",93,0)
 ;;D^  ; S OCXDAY=OCXDT-$P(OCXCNT,U,OCXMON-1)+1
"RTN","ORY24305",94,0)
 ;;R^"860.8:",100,17
"RTN","ORY24305",95,0)
 ;;D^  ; I OCXF S OCXMON=$P("January^February^March^April^May^June^July^August^September^October^November^December",U,OCXMON)
"RTN","ORY24305",96,0)
 ;;R^"860.8:",100,18
"RTN","ORY24305",97,0)
 ;;D^  ; E  S OCXMON=$E(OCXMON+100,2,3)
"RTN","ORY24305",98,0)
 ;;R^"860.8:",100,19
"RTN","ORY24305",99,0)
 ;;D^  ; S OCXAP=$S('OCXHR:"Midnight",(OCXHR=12):"Noon",(OCXHR<12):"AM",1:"PM")
"RTN","ORY24305",100,0)
 ;;R^"860.8:",100,20
"RTN","ORY24305",101,0)
 ;;D^  ; I OCXF S OCXHR=OCXHR#12 S:'OCXHR OCXHR=12
"RTN","ORY24305",102,0)
 ;;R^"860.8:",100,21
"RTN","ORY24305",103,0)
 ;;D^  ; Q:'OCXF $E(OCXMON+100,2,3)_"/"_$E(OCXDAY+100,2,3)_$S((OCXCYR=OCXYR):" "_OCXHR_":"_OCXMIN,1:"/"_$E(OCXYR,3,4))
"RTN","ORY24305",104,0)
 ;;R^"860.8:",100,22
"RTN","ORY24305",105,0)
 ;;D^  ; Q:(OCXHR+OCXMIN+OCXSEC) OCXMON_" "_OCXDAY_","_OCXYR_" at "_OCXHR_":"_OCXMIN_"."_OCXSEC_" "_OCXAP
"RTN","ORY24305",106,0)
 ;;R^"860.8:",100,23
"RTN","ORY24305",107,0)
 ;;D^  ; Q OCXMON_" "_OCXDAY_","_OCXYR
"RTN","ORY24305",108,0)
 ;;R^"860.8:",100,24
"RTN","ORY24305",109,0)
 ;;D^  ; ;
"RTN","ORY24305",110,0)
 ;;EOR^
"RTN","ORY24305",111,0)
 ;;KEY^860.8:^ELAPSED ORDER CHECK TIME LOGGER
"RTN","ORY24305",112,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY24305",113,0)
 ;;D^ELAPSED ORDER CHECK TIME LOGGER
"RTN","ORY24305",114,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY24305",115,0)
 ;;D^TIMELOG
"RTN","ORY24305",116,0)
 ;;R^"860.8:",100,1
"RTN","ORY24305",117,0)
 ;;D^  ;TIMELOG(OCXMODE,OCXCALL) ; Log an entry in the Elapsed time log.
"RTN","ORY24305",118,0)
 ;;R^"860.8:",100,2
"RTN","ORY24305",119,0)
 ;;D^  ; ;
"RTN","ORY24305",120,0)
 ;;R^"860.8:",100,3
"RTN","ORY24305",121,0)
 ;;D^  ; ;
"RTN","ORY24305",122,0)
 ;;R^"860.8:",100,4
"RTN","ORY24305",123,0)
 ;;D^  ; Q 0
"RTN","ORY24305",124,0)
 ;;R^"860.8:",100,5
"RTN","ORY24305",125,0)
 ;;D^  ; ;
"RTN","ORY24305",126,0)
 ;;EOR^
"RTN","ORY24305",127,0)
 ;;KEY^860.8:^EQUALS TERM OPERATOR
"RTN","ORY24305",128,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY24305",129,0)
 ;;D^EQUALS TERM OPERATOR
"RTN","ORY24305",130,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY24305",131,0)
 ;;D^EQTERM
"RTN","ORY24305",132,0)
 ;;R^"860.8:",100,1
"RTN","ORY24305",133,0)
 ;;D^  ;EQTERM(DATA,TERM) ;
"RTN","ORY24305",134,0)
 ;;R^"860.8:",100,2
"RTN","ORY24305",135,0)
 ;;D^  ; ;
"RTN","ORY24305",136,0)
 ;;R^"860.8:",100,3
"RTN","ORY24305",137,0)
 ;;D^T+; I $G(OCXTRACE) W !,"%%%%",?20," Execution trace  DATA: ",$G(DATA),"   TERM: ",$G(TERM)
"RTN","ORY24305",138,0)
 ;;R^"860.8:",100,4
"RTN","ORY24305",139,0)
 ;;D^  ; N OCXF,OCXL
"RTN","ORY24305",140,0)
 ;;R^"860.8:",100,5
"RTN","ORY24305",141,0)
 ;;D^  ; ;
"RTN","ORY24305",142,0)
 ;;R^"860.8:",100,6
"RTN","ORY24305",143,0)
 ;;D^  ; S OCXL="",OCXF=$$TERMLKUP(TERM,.OCXL)
"RTN","ORY24305",144,0)
 ;;R^"860.8:",100,7
"RTN","ORY24305",145,0)
 ;;D^T-; Q:'OCXF 0
"RTN","ORY24305",146,0)
 ;;R^"860.8:",100,8
"RTN","ORY24305",147,0)
 ;;D^T+; I 'OCXF W:$G(OCXTRACE) !,"%%%%",?20," Term '",TERM,"' not in Order Check National Term File" Q 0
"RTN","ORY24305",148,0)
 ;;R^"860.8:",100,9
"RTN","ORY24305",149,0)
 ;;D^T+; I '$O(OCXL(0)) W:$G(OCXTRACE) !,"%%%%",?20," There are no local terms listed for the National Term '",TERM,"'." Q 0
"RTN","ORY24305",150,0)
 ;;R^"860.8:",100,10
"RTN","ORY24305",151,0)
 ;;D^T+; I ($D(OCXL(DATA))!$D(OCXL("B",DATA))) W:$G(OCXTRACE) !,"%%%%",?20," Data equals Term" Q 1
"RTN","ORY24305",152,0)
 ;;R^"860.8:",100,11
"RTN","ORY24305",153,0)
 ;;D^T-; I ($D(OCXL(DATA))!$D(OCXL("B",DATA))) Q 1
"RTN","ORY24305",154,0)
 ;;R^"860.8:",100,12
"RTN","ORY24305",155,0)
 ;;D^T-; Q 0
"RTN","ORY24305",156,0)
 ;;R^"860.8:",100,13
"RTN","ORY24305",157,0)
 ;;D^T+; W:$G(OCXTRACE) !,"%%%%",?20," Data does not equal Term" Q 0
"RTN","ORY24305",158,0)
 ;;R^"860.8:",100,14
"RTN","ORY24305",159,0)
 ;;D^  ; ;
"RTN","ORY24305",160,0)
 ;;EOR^
"RTN","ORY24305",161,0)
 ;;KEY^860.8:^FILE DATA IN PATIENT ACTIVE DATA FILE
"RTN","ORY24305",162,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY24305",163,0)
 ;;D^FILE DATA IN PATIENT ACTIVE DATA FILE
"RTN","ORY24305",164,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY24305",165,0)
 ;;D^FILE
"RTN","ORY24305",166,0)
 ;;R^"860.8:",1,1
"RTN","ORY24305",167,0)
 ;;D^  ;FILE(DFN,OCXELE,OCXDFL) ;     This Local Extrinsic Function files data
"RTN","ORY24305",168,0)
 ;;R^"860.8:",1,2
"RTN","ORY24305",169,0)
 ;;D^  ; ;     in the Order Check Patient Data File
"RTN","ORY24305",170,0)
 ;;R^"860.8:",1,3
"RTN","ORY24305",171,0)
 ;;D^  ; ;
"RTN","ORY24305",172,0)
 ;;R^"860.8:",100,1
"RTN","ORY24305",173,0)
 ;;D^  ;FILE(DFN,OCXELE,OCXDFL) ;     This Local Extrinsic Function logs a validated event/element.
"RTN","ORY24305",174,0)
 ;;R^"860.8:",100,2
"RTN","ORY24305",175,0)
 ;;D^  ; ;
"RTN","ORY24305",176,0)
 ;;R^"860.8:",100,3
"RTN","ORY24305",177,0)
 ;;D^T+; I $G(OCXTRACE) W !,"%%%%",?20," Execution trace  DFN: ",DFN,"   OCXELE: ",+$G(OCXELE),"   OCXDFL: ",$G(OCXDFL)
"RTN","ORY24305",178,0)
 ;;R^"860.8:",100,4
"RTN","ORY24305",179,0)
 ;;D^  ; N OCXTIMN,OCXTIML,OCXTIMT1,OCXTIMT2,OCXDATA,OCXPC,OCXPC,OCXVAL,OCXSUB,OCXDFI
"RTN","ORY24305",180,0)
 ;;R^"860.8:",100,5
"RTN","ORY24305",181,0)
 ;;D^  ; S DFN=+$G(DFN),OCXELE=+$G(OCXELE)
"RTN","ORY24305",182,0)
 ;;R^"860.8:",100,6
"RTN","ORY24305",183,0)
 ;;D^  ; ;
"RTN","ORY24305",184,0)
 ;;R^"860.8:",100,7
"RTN","ORY24305",185,0)
 ;;D^  ; Q:'DFN 1 Q:'OCXELE 1 K OCXDATA
"RTN","ORY24305",186,0)
 ;;R^"860.8:",100,8
"RTN","ORY24305",187,0)
 ;;D^  ; ;
"RTN","ORY24305",188,0)
 ;;R^"860.8:",100,9
"RTN","ORY24305",189,0)
 ;;D^  ; S OCXDATA(DFN,OCXELE)=1
"RTN","ORY24305",190,0)
 ;;R^"860.8:",100,10
"RTN","ORY24305",191,0)
 ;;D^  ; F OCXPC=1:1:$L(OCXDFL,",") S OCXDFI=$P(OCXDFL,",",OCXPC) I OCXDFI D
"RTN","ORY24305",192,0)
 ;;R^"860.8:",100,11
"RTN","ORY24305",193,0)
 ;;D^  ; .S OCXVAL=$G(OCXDF(+OCXDFI)),OCXDATA(DFN,OCXELE,+OCXDFI)=OCXVAL
"RTN","ORY24305",194,0)
 ;;R^"860.8:",100,12
"RTN","ORY24305",195,0)
 ;;D^T+; .I $G(OCXTRACE) W !,"%%%%",?20,"   ",$P($G(^OCXS(860.4,+OCXDFI,0)),U,1)," = """,OCXVAL,""""
"RTN","ORY24305",196,0)
 ;;R^"860.8:",100,13
"RTN","ORY24305",197,0)
 ;;D^  ; ;
"RTN","ORY24305",198,0)
 ;;R^"860.8:",100,14
"RTN","ORY24305",199,0)
 ;;D^  ; M ^TMP("OCXCHK",$J,DFN)=OCXDATA(DFN)
"RTN","ORY24305",200,0)
 ;;R^"860.8:",100,15
"RTN","ORY24305",201,0)
 ;;D^  ; ;
"RTN","ORY24305",202,0)
 ;;R^"860.8:",100,16
"RTN","ORY24305",203,0)
 ;;D^  ; Q 0
"RTN","ORY24305",204,0)
 ;;R^"860.8:",100,17
"RTN","ORY24305",205,0)
 ;;D^  ; ;
"RTN","ORY24305",206,0)
 ;;EOR^
"RTN","ORY24305",207,0)
 ;;KEY^860.8:^GENERATE STRING CHECKSUM
"RTN","ORY24305",208,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY24305",209,0)
 ;;D^GENERATE STRING CHECKSUM
"RTN","ORY24305",210,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY24305",211,0)
 ;;D^CKSUM
"RTN","ORY24305",212,0)
 ;1;
"RTN","ORY24305",213,0)
 ;
"RTN","ORY24306")
0^84^B66782929
"RTN","ORY24306",1,0)
ORY24306 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*243) ;NOV 2,2006 at 12:05
"RTN","ORY24306",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17,1997;Build 242
"RTN","ORY24306",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY24306",4,0)
 ;
"RTN","ORY24306",5,0)
S ;
"RTN","ORY24306",6,0)
 ;
"RTN","ORY24306",7,0)
 D DOT^ORY243ES
"RTN","ORY24306",8,0)
 ;
"RTN","ORY24306",9,0)
 ;
"RTN","ORY24306",10,0)
 K REMOTE,LOCAL,OPCODE,REF
"RTN","ORY24306",11,0)
 F LINE=1:1:500 S TEXT=$P($T(DATA+LINE),";",2,999) Q:TEXT  I $L(TEXT) D  Q:QUIT
"RTN","ORY24306",12,0)
 .S ^TMP("OCXRULE",$J,$O(^TMP("OCXRULE",$J,"A"),-1)+1)=TEXT
"RTN","ORY24306",13,0)
 ;
"RTN","ORY24306",14,0)
 G ^ORY24307
"RTN","ORY24306",15,0)
 ;
"RTN","ORY24306",16,0)
 Q
"RTN","ORY24306",17,0)
 ;
"RTN","ORY24306",18,0)
DATA ;
"RTN","ORY24306",19,0)
 ;
"RTN","ORY24306",20,0)
 ;;R^"860.8:",100,1
"RTN","ORY24306",21,0)
 ;;D^  ;CKSUM(STR) ;
"RTN","ORY24306",22,0)
 ;;R^"860.8:",100,2
"RTN","ORY24306",23,0)
 ;;D^  ; ;
"RTN","ORY24306",24,0)
 ;;R^"860.8:",100,3
"RTN","ORY24306",25,0)
 ;;D^  ; N CKSUM,PTR,ASC S CKSUM=0
"RTN","ORY24306",26,0)
 ;;R^"860.8:",100,4
"RTN","ORY24306",27,0)
 ;;D^  ; S STR=$TR(STR,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","ORY24306",28,0)
 ;;R^"860.8:",100,5
"RTN","ORY24306",29,0)
 ;;D^  ; F PTR=$L(STR):-1:1 S ASC=$A(STR,PTR)-42 I (ASC>0),(ASC<51) S CKSUM=CKSUM*2+ASC
"RTN","ORY24306",30,0)
 ;;R^"860.8:",100,6
"RTN","ORY24306",31,0)
 ;;D^  ; Q +CKSUM
"RTN","ORY24306",32,0)
 ;;R^"860.8:",100,7
"RTN","ORY24306",33,0)
 ;;D^  ; ;
"RTN","ORY24306",34,0)
 ;;EOR^
"RTN","ORY24306",35,0)
 ;;KEY^860.8:^GET DATA FROM THE ACTIVE DATA FILE
"RTN","ORY24306",36,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY24306",37,0)
 ;;D^GET DATA FROM THE ACTIVE DATA FILE
"RTN","ORY24306",38,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY24306",39,0)
 ;;D^GETDATA
"RTN","ORY24306",40,0)
 ;;R^"860.8:",100,1
"RTN","ORY24306",41,0)
 ;;D^  ;GETDATA(DFN,OCXL,OCXDFI) ;     This Local Extrinsic Function returns runtime data
"RTN","ORY24306",42,0)
 ;;R^"860.8:",100,2
"RTN","ORY24306",43,0)
 ;;D^  ; ;
"RTN","ORY24306",44,0)
 ;;R^"860.8:",100,3
"RTN","ORY24306",45,0)
 ;;D^  ; N OCXE,VAL,PC S VAL=""
"RTN","ORY24306",46,0)
 ;;R^"860.8:",100,4
"RTN","ORY24306",47,0)
 ;;D^  ; F PC=1:1:$L(OCXL,U) S OCXE=$P(OCXL,U,PC) I OCXE S VAL=$G(^TMP("OCXCHK",$J,DFN,OCXE,OCXDFI)) Q:$L(VAL)
"RTN","ORY24306",48,0)
 ;;R^"860.8:",100,5
"RTN","ORY24306",49,0)
 ;;D^  ; Q VAL
"RTN","ORY24306",50,0)
 ;;R^"860.8:",100,6
"RTN","ORY24306",51,0)
 ;;D^  ; ;
"RTN","ORY24306",52,0)
 ;;EOR^
"RTN","ORY24306",53,0)
 ;;KEY^860.8:^IN LIST OPERATOR
"RTN","ORY24306",54,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY24306",55,0)
 ;;D^IN LIST OPERATOR
"RTN","ORY24306",56,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY24306",57,0)
 ;;D^LIST
"RTN","ORY24306",58,0)
 ;;R^"860.8:",100,1
"RTN","ORY24306",59,0)
 ;;D^  ;LIST(DATA,LIST) ;   IS THE DATA FIELD IN THE LIST
"RTN","ORY24306",60,0)
 ;;R^"860.8:",100,2
"RTN","ORY24306",61,0)
 ;;D^  ; ;
"RTN","ORY24306",62,0)
 ;;R^"860.8:",100,3
"RTN","ORY24306",63,0)
 ;;D^T+; W:$G(OCXTRACE) !,"%%%%",?20,"     $$LIST(""",DATA,""",""",LIST,""")"
"RTN","ORY24306",64,0)
 ;;R^"860.8:",100,4
"RTN","ORY24306",65,0)
 ;;D^  ; S:'($E(LIST,1)=",") LIST=","_LIST S:'($E(LIST,$L(LIST))=",") LIST=LIST_"," S DATA=","_DATA_","
"RTN","ORY24306",66,0)
 ;;R^"860.8:",100,5
"RTN","ORY24306",67,0)
 ;;D^  ; Q (LIST[DATA)
"RTN","ORY24306",68,0)
 ;;R^"860.8:",100,6
"RTN","ORY24306",69,0)
 ;;D^  ; ;
"RTN","ORY24306",70,0)
 ;;EOR^
"RTN","ORY24306",71,0)
 ;;KEY^860.8:^LOCAL TERM LOOKUP
"RTN","ORY24306",72,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY24306",73,0)
 ;;D^LOCAL TERM LOOKUP
"RTN","ORY24306",74,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY24306",75,0)
 ;;D^TERMLKUP
"RTN","ORY24306",76,0)
 ;;R^"860.8:",1,1
"RTN","ORY24306",77,0)
 ;;D^ 
"RTN","ORY24306",78,0)
 ;;R^"860.8:",1,2
"RTN","ORY24306",79,0)
 ;;D^  This function allows a local site to define to Order Checking
"RTN","ORY24306",80,0)
 ;;R^"860.8:",1,3
"RTN","ORY24306",81,0)
 ;;D^ a term specific to that site. (ie. Lab Test Name, Radiology
"RTN","ORY24306",82,0)
 ;;R^"860.8:",1,4
"RTN","ORY24306",83,0)
 ;;D^ procedure name, etc.)
"RTN","ORY24306",84,0)
 ;;R^"860.8:",1,5
"RTN","ORY24306",85,0)
 ;;D^ 
"RTN","ORY24306",86,0)
 ;;R^"860.8:",100,1
"RTN","ORY24306",87,0)
 ;;D^  ;TERMLKUP(OCXTERM,OCXFILE) ;
"RTN","ORY24306",88,0)
 ;;R^"860.8:",100,2
"RTN","ORY24306",89,0)
 ;;D^  ; ;
"RTN","ORY24306",90,0)
 ;;R^"860.8:",100,3
"RTN","ORY24306",91,0)
 ;;D^  ; Q
"RTN","ORY24306",92,0)
 ;;R^"860.8:",100,4
"RTN","ORY24306",93,0)
 ;;D^  ; ;
"RTN","ORY24306",94,0)
 ;;EOR^
"RTN","ORY24306",95,0)
 ;;KEY^860.8:^NEW RULE MESSAGE
"RTN","ORY24306",96,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY24306",97,0)
 ;;D^NEW RULE MESSAGE
"RTN","ORY24306",98,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY24306",99,0)
 ;;D^NEWRULE
"RTN","ORY24306",100,0)
 ;;R^"860.8:",100,1
"RTN","ORY24306",101,0)
 ;;D^  ;NEWRULE(OCXDFN,OCXORD,OCXRUL,OCXREL,OCXNOTF,OCXMESS) ; Has this rule already been triggered for this order number
"RTN","ORY24306",102,0)
 ;;R^"860.8:",100,2
"RTN","ORY24306",103,0)
 ;;D^  ; ;
"RTN","ORY24306",104,0)
 ;;R^"860.8:",100,3
"RTN","ORY24306",105,0)
 ;;D^L+; S OCXERR=$$TIMELOG("M","NEWRULE("_(+$G(OCXDFN))_","_(+$G(OCXORD))_","_(+$G(OCXRUL))_","_(+$G(OCXREL))_","_(+$G(OCXNOTF))_","_$G(OCXMESS)_")")
"RTN","ORY24306",106,0)
 ;;R^"860.8:",100,4
"RTN","ORY24306",107,0)
 ;;D^  ; ;
"RTN","ORY24306",108,0)
 ;;R^"860.8:",100,5
"RTN","ORY24306",109,0)
 ;;D^  ; Q:'$G(OCXDFN) 0 Q:'$G(OCXRUL) 0
"RTN","ORY24306",110,0)
 ;;R^"860.8:",100,6
"RTN","ORY24306",111,0)
 ;;D^  ; Q:'$G(OCXREL) 0  Q:'$G(OCXNOTF) 0  Q:'$L($G(OCXMESS)) 0
"RTN","ORY24306",112,0)
 ;;R^"860.8:",100,7
"RTN","ORY24306",113,0)
 ;;D^  ; S OCXORD=+$G(OCXORD),OCXDFN=+OCXDFN
"RTN","ORY24306",114,0)
 ;;R^"860.8:",100,8
"RTN","ORY24306",115,0)
 ;;D^  ; ;
"RTN","ORY24306",116,0)
 ;;R^"860.8:",100,9
"RTN","ORY24306",117,0)
 ;;D^  ; N OCXNDX,OCXDATA,OCXDFI,OCXELE,OCXGR,OCXTIME,OCXCKSUM,OCXTSP,OCXTSPL
"RTN","ORY24306",118,0)
 ;;R^"860.8:",100,10
"RTN","ORY24306",119,0)
 ;;D^  ; ;
"RTN","ORY24306",120,0)
 ;;R^"860.8:",100,11
"RTN","ORY24306",121,0)
 ;;D^  ; S OCXTIME=(+$H)
"RTN","ORY24306",122,0)
 ;;R^"860.8:",100,12
"RTN","ORY24306",123,0)
 ;;D^  ; S OCXCKSUM=$$CKSUM(OCXMESS)
"RTN","ORY24306",124,0)
 ;;R^"860.8:",100,13
"RTN","ORY24306",125,0)
 ;;D^  ; ;
"RTN","ORY24306",126,0)
 ;;R^"860.8:",100,14
"RTN","ORY24306",127,0)
 ;;D^  ; S OCXTSP=($H*86400)+$P($H,",",2)
"RTN","ORY24306",128,0)
 ;;R^"860.8:",100,15
"RTN","ORY24306",129,0)
 ;;D^  ; S OCXTSPL=($G(^OCXD(860.7,"AT",OCXTIME,OCXDFN,OCXRUL,+OCXORD,OCXCKSUM))+$G(OCXTSPI,300))
"RTN","ORY24306",130,0)
 ;;R^"860.8:",100,16
"RTN","ORY24306",131,0)
 ;;D^  ; ;
"RTN","ORY24306",132,0)
 ;;R^"860.8:",100,17
"RTN","ORY24306",133,0)
 ;;D^  ; Q:(OCXTSPL>OCXTSP) 0
"RTN","ORY24306",134,0)
 ;;R^"860.8:",100,18
"RTN","ORY24306",135,0)
 ;;D^  ; ;
"RTN","ORY24306",136,0)
 ;;R^"860.8:",100,19
"RTN","ORY24306",137,0)
 ;;D^  ; K OCXDATA
"RTN","ORY24306",138,0)
 ;;R^"860.8:",100,20
"RTN","ORY24306",139,0)
 ;;D^  ; S OCXDATA(OCXDFN,0)=OCXDFN
"RTN","ORY24306",140,0)
 ;;R^"860.8:",100,21
"RTN","ORY24306",141,0)
 ;;D^  ; S OCXDATA("B",OCXDFN,OCXDFN)=""
"RTN","ORY24306",142,0)
 ;;R^"860.8:",100,22
"RTN","ORY24306",143,0)
 ;;D^  ; S OCXDATA("AT",OCXTIME,OCXDFN,OCXRUL,+OCXORD,OCXCKSUM)=OCXTSP
"RTN","ORY24306",144,0)
 ;;R^"860.8:",100,23
"RTN","ORY24306",145,0)
 ;;D^  ; ;
"RTN","ORY24306",146,0)
 ;;R^"860.8:",100,24
"RTN","ORY24306",147,0)
 ;;D^  ; S OCXGR="^OCXD(860.7"
"RTN","ORY24306",148,0)
 ;;R^"860.8:",100,25
"RTN","ORY24306",149,0)
 ;;D^T+; D SETAP(OCXGR_")",0,"Patient",$P($G(^DPT(OCXDFN,0)),U,1),.OCXDATA,OCXDFN)
"RTN","ORY24306",150,0)
 ;;R^"860.8:",100,26
"RTN","ORY24306",151,0)
 ;;D^T-; D SETAP(OCXGR_")",0,.OCXDATA,OCXDFN)
"RTN","ORY24306",152,0)
 ;;R^"860.8:",100,27
"RTN","ORY24306",153,0)
 ;;D^  ; ;
"RTN","ORY24306",154,0)
 ;;R^"860.8:",100,28
"RTN","ORY24306",155,0)
 ;;D^  ; K OCXDATA
"RTN","ORY24306",156,0)
 ;;R^"860.8:",100,29
"RTN","ORY24306",157,0)
 ;;D^  ; S OCXDATA(OCXRUL,0)=OCXRUL_U_(OCXTIME)_U_(+OCXORD)
"RTN","ORY24306",158,0)
 ;;R^"860.8:",100,30
"RTN","ORY24306",159,0)
 ;;D^  ; S OCXDATA(OCXRUL,"M")=OCXMESS
"RTN","ORY24306",160,0)
 ;;R^"860.8:",100,31
"RTN","ORY24306",161,0)
 ;;D^  ; S OCXDATA("B",OCXRUL,OCXRUL)=""
"RTN","ORY24306",162,0)
 ;;R^"860.8:",100,32
"RTN","ORY24306",163,0)
 ;;D^  ; S OCXGR=OCXGR_","_OCXDFN_",1"
"RTN","ORY24306",164,0)
 ;;R^"860.8:",100,33
"RTN","ORY24306",165,0)
 ;;D^T+; D SETAP(OCXGR_")","860.71P","Rule",$P($G(^OCXS(860.2,OCXRUL,0)),U,1),.OCXDATA,OCXRUL)
"RTN","ORY24306",166,0)
 ;;R^"860.8:",100,34
"RTN","ORY24306",167,0)
 ;;D^T-; D SETAP(OCXGR_")","860.71P",.OCXDATA,OCXRUL)
"RTN","ORY24306",168,0)
 ;;R^"860.8:",100,35
"RTN","ORY24306",169,0)
 ;;D^  ; ;
"RTN","ORY24306",170,0)
 ;;R^"860.8:",100,36
"RTN","ORY24306",171,0)
 ;;D^  ; K OCXDATA
"RTN","ORY24306",172,0)
 ;;R^"860.8:",100,37
"RTN","ORY24306",173,0)
 ;;D^  ; S OCXDATA(OCXREL,0)=OCXREL
"RTN","ORY24306",174,0)
 ;;R^"860.8:",100,38
"RTN","ORY24306",175,0)
 ;;D^  ; S OCXDATA("B",OCXREL,OCXREL)=""
"RTN","ORY24306",176,0)
 ;;R^"860.8:",100,39
"RTN","ORY24306",177,0)
 ;;D^  ; S OCXGR=OCXGR_","_OCXRUL_",1"
"RTN","ORY24306",178,0)
 ;;R^"860.8:",100,40
"RTN","ORY24306",179,0)
 ;;D^T+; D SETAP(OCXGR_")","860.712","Relation",OCXREL,.OCXDATA,OCXREL)
"RTN","ORY24306",180,0)
 ;;R^"860.8:",100,41
"RTN","ORY24306",181,0)
 ;;D^T-; D SETAP(OCXGR_")","860.712",.OCXDATA,OCXREL)
"RTN","ORY24306",182,0)
 ;;R^"860.8:",100,42
"RTN","ORY24306",183,0)
 ;;D^  ; ;
"RTN","ORY24306",184,0)
 ;;R^"860.8:",100,43
"RTN","ORY24306",185,0)
 ;;D^  ; S OCXELE=0 F  S OCXELE=$O(^OCXS(860.2,OCXRUL,"C","C",OCXELE)) Q:'OCXELE  D
"RTN","ORY24306",186,0)
 ;;R^"860.8:",100,44
"RTN","ORY24306",187,0)
 ;;D^  ; .;
"RTN","ORY24306",188,0)
 ;;R^"860.8:",100,45
"RTN","ORY24306",189,0)
 ;;D^  ; .N OCXGR1
"RTN","ORY24306",190,0)
 ;;R^"860.8:",100,46
"RTN","ORY24306",191,0)
 ;;D^  ; .S OCXGR1=OCXGR_","_OCXREL_",1"
"RTN","ORY24306",192,0)
 ;;R^"860.8:",100,47
"RTN","ORY24306",193,0)
 ;;D^  ; .K OCXDATA
"RTN","ORY24306",194,0)
 ;;R^"860.8:",100,48
"RTN","ORY24306",195,0)
 ;;D^  ; .S OCXDATA(OCXELE,0)=OCXELE
"RTN","ORY24306",196,0)
 ;;R^"860.8:",100,49
"RTN","ORY24306",197,0)
 ;;D^  ; .S OCXDATA(OCXELE,"TIME")=OCXTIME
"RTN","ORY24306",198,0)
 ;;R^"860.8:",100,50
"RTN","ORY24306",199,0)
 ;;D^  ; .S OCXDATA(OCXELE,"LOG")=$G(OCXOLOG)
"RTN","ORY24306",200,0)
 ;;R^"860.8:",100,51
"RTN","ORY24306",201,0)
 ;;D^  ; .S OCXDATA("B",OCXELE,OCXELE)=""
"RTN","ORY24306",202,0)
 ;;R^"860.8:",100,52
"RTN","ORY24306",203,0)
 ;;D^  ; .K ^OCXD(860.7,OCXDFN,1,OCXRUL,1,OCXREL,1,OCXELE)
"RTN","ORY24306",204,0)
 ;;R^"860.8:",100,53
"RTN","ORY24306",205,0)
 ;;D^T+; .D SETAP(OCXGR1_")","860.7122P","Element",$P($G(^OCXS(860.3,OCXELE,0)),U,1),.OCXDATA,OCXELE)
"RTN","ORY24306",206,0)
 ;;R^"860.8:",100,54
"RTN","ORY24306",207,0)
 ;;D^T-; .D SETAP(OCXGR1_")","860.7122P",.OCXDATA,OCXELE)
"RTN","ORY24306",208,0)
 ;;R^"860.8:",100,55
"RTN","ORY24306",209,0)
 ;;D^  ; .;
"RTN","ORY24306",210,0)
 ;;R^"860.8:",100,56
"RTN","ORY24306",211,0)
 ;;D^  ; .S OCXDFI=0 F  S OCXDFI=$O(^TMP("OCXCHK",$J,OCXDFN,OCXELE,OCXDFI)) Q:'OCXDFI  D
"RTN","ORY24306",212,0)
 ;;R^"860.8:",100,57
"RTN","ORY24306",213,0)
 ;;D^  ; ..N OCXGR2
"RTN","ORY24306",214,0)
 ;;R^"860.8:",100,58
"RTN","ORY24306",215,0)
 ;;D^  ; ..S OCXGR2=OCXGR1_","_OCXELE_",1"
"RTN","ORY24306",216,0)
 ;;R^"860.8:",100,59
"RTN","ORY24306",217,0)
 ;;D^  ; ..K OCXDATA
"RTN","ORY24306",218,0)
 ;;R^"860.8:",100,60
"RTN","ORY24306",219,0)
 ;;D^  ; ..S OCXDATA(OCXDFI,0)=OCXDFI
"RTN","ORY24306",220,0)
 ;;R^"860.8:",100,61
"RTN","ORY24306",221,0)
 ;;D^  ; ..S OCXDATA(OCXDFI,"VAL")=^TMP("OCXCHK",$J,OCXDFN,OCXELE,OCXDFI)
"RTN","ORY24306",222,0)
 ;;R^"860.8:",100,62
"RTN","ORY24306",223,0)
 ;;D^  ; ..S OCXDATA("B",OCXDFI,OCXDFI)=""
"RTN","ORY24306",224,0)
 ;;R^"860.8:",100,63
"RTN","ORY24306",225,0)
 ;;D^T+; ..D SETAP(OCXGR2_")","860.71223P","Data Field",$P($G(^OCXS(860.4,OCXDFI,0)),U,1),.OCXDATA,OCXDFI)
"RTN","ORY24306",226,0)
 ;;R^"860.8:",100,64
"RTN","ORY24306",227,0)
 ;;D^T-; ..D SETAP(OCXGR2_")","860.71223P",.OCXDATA,OCXDFI)
"RTN","ORY24306",228,0)
 ;;R^"860.8:",100,65
"RTN","ORY24306",229,0)
 ;;D^  ; ;
"RTN","ORY24306",230,0)
 ;;R^"860.8:",100,66
"RTN","ORY24306",231,0)
 ;;D^  ; Q 1
"RTN","ORY24306",232,0)
 ;;R^"860.8:",100,67
"RTN","ORY24306",233,0)
 ;;D^  ; ;
"RTN","ORY24306",234,0)
 ;;R^"860.8:",100,68
"RTN","ORY24306",235,0)
 ;;D^T+;SETAP(ROOT,DD,ITEM,ITEMNAME,DATA,DA) ;  Set Rule Event data
"RTN","ORY24306",236,0)
 ;;R^"860.8:",100,69
"RTN","ORY24306",237,0)
 ;;D^T-;SETAP(ROOT,DD,DATA,DA) ;  Set Rule Event data
"RTN","ORY24306",238,0)
 ;;R^"860.8:",100,70
"RTN","ORY24306",239,0)
 ;;D^  ; M @ROOT=DATA
"RTN","ORY24306",240,0)
 ;;R^"860.8:",100,71
"RTN","ORY24306",241,0)
 ;;D^  ; I +$G(DD) S @ROOT@(0)="^"_($G(DD))_"^"_($P($G(@ROOT@(0)),U,3)+1)_"^"_$G(DA)
"RTN","ORY24306",242,0)
 ;;R^"860.8:",100,72
"RTN","ORY24306",243,0)
 ;;D^  ; I '$G(DD) S $P(@ROOT@(0),U,3,4)=($P($G(@ROOT@(0)),U,3)+1)_"^"_$G(DA)
"RTN","ORY24306",244,0)
 ;;R^"860.8:",100,73
"RTN","ORY24306",245,0)
 ;;D^T+; W:$G(OCXTRACE) !,"File Active Data ",$G(ITEM),": ",$G(ITEMNAME)
"RTN","ORY24306",246,0)
 ;1;
"RTN","ORY24306",247,0)
 ;
"RTN","ORY24307")
0^85^B70006769
"RTN","ORY24307",1,0)
ORY24307 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*243) ;NOV 2,2006 at 12:05
"RTN","ORY24307",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17,1997;Build 242
"RTN","ORY24307",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY24307",4,0)
 ;
"RTN","ORY24307",5,0)
S ;
"RTN","ORY24307",6,0)
 ;
"RTN","ORY24307",7,0)
 D DOT^ORY243ES
"RTN","ORY24307",8,0)
 ;
"RTN","ORY24307",9,0)
 ;
"RTN","ORY24307",10,0)
 K REMOTE,LOCAL,OPCODE,REF
"RTN","ORY24307",11,0)
 F LINE=1:1:500 S TEXT=$P($T(DATA+LINE),";",2,999) Q:TEXT  I $L(TEXT) D  Q:QUIT
"RTN","ORY24307",12,0)
 .S ^TMP("OCXRULE",$J,$O(^TMP("OCXRULE",$J,"A"),-1)+1)=TEXT
"RTN","ORY24307",13,0)
 ;
"RTN","ORY24307",14,0)
 G ^ORY24308
"RTN","ORY24307",15,0)
 ;
"RTN","ORY24307",16,0)
 Q
"RTN","ORY24307",17,0)
 ;
"RTN","ORY24307",18,0)
DATA ;
"RTN","ORY24307",19,0)
 ;
"RTN","ORY24307",20,0)
 ;;R^"860.8:",100,74
"RTN","ORY24307",21,0)
 ;;D^  ; ;
"RTN","ORY24307",22,0)
 ;;R^"860.8:",100,75
"RTN","ORY24307",23,0)
 ;;D^  ; Q
"RTN","ORY24307",24,0)
 ;;R^"860.8:",100,76
"RTN","ORY24307",25,0)
 ;;D^  ; ;
"RTN","ORY24307",26,0)
 ;;R^"860.8:",100,77
"RTN","ORY24307",27,0)
 ;;D^  ; ;
"RTN","ORY24307",28,0)
 ;;EOR^
"RTN","ORY24307",29,0)
 ;;KEY^860.8:^RETURN POINTED TO VALUE
"RTN","ORY24307",30,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY24307",31,0)
 ;;D^RETURN POINTED TO VALUE
"RTN","ORY24307",32,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY24307",33,0)
 ;;D^POINTER
"RTN","ORY24307",34,0)
 ;;R^"860.8:",1,1
"RTN","ORY24307",35,0)
 ;;D^  ;POINTER(OCXFILE,D0) ;    This Local Extrinsic Function gets the value of the name field
"RTN","ORY24307",36,0)
 ;;R^"860.8:",1,2
"RTN","ORY24307",37,0)
 ;;D^  ; ;  of record D0 in file OCXFILE
"RTN","ORY24307",38,0)
 ;;R^"860.8:",100,1
"RTN","ORY24307",39,0)
 ;;D^  ;POINTER(OCXFILE,D0) ;    This Local Extrinsic Function gets the value of the name field
"RTN","ORY24307",40,0)
 ;;R^"860.8:",100,2
"RTN","ORY24307",41,0)
 ;;D^  ; ;  of record D0 in file OCXFILE
"RTN","ORY24307",42,0)
 ;;R^"860.8:",100,3
"RTN","ORY24307",43,0)
 ;;D^T+; I $G(OCXTRACE) W !,"%%%%",?20,"   FILE: ",$G(OCXFILE),"  D0: ",$G(D0)
"RTN","ORY24307",44,0)
 ;;R^"860.8:",100,4
"RTN","ORY24307",45,0)
 ;;D^  ; Q:'$G(D0) "" Q:'$L($G(OCXFILE)) ""
"RTN","ORY24307",46,0)
 ;;R^"860.8:",100,5
"RTN","ORY24307",47,0)
 ;;D^  ; N GLREF
"RTN","ORY24307",48,0)
 ;;R^"860.8:",100,6
"RTN","ORY24307",49,0)
 ;;D^  ; I '(OCXFILE=(+OCXFILE)) S GLREF=U_OCXFILE
"RTN","ORY24307",50,0)
 ;;R^"860.8:",100,7
"RTN","ORY24307",51,0)
 ;;D^  ; E  S GLREF=$$FILE^OCXBDTD(+OCXFILE,"GLOBAL NAME") Q:'$L(GLREF) ""
"RTN","ORY24307",52,0)
 ;;R^"860.8:",100,8
"RTN","ORY24307",53,0)
 ;;D^T+; I $G(OCXTRACE) W !,"%%%%",?20," GLREF: ",GLREF,"  RESOLVES TO: ",$P($G(@(GLREF_(+D0)_",0)")),U,1)
"RTN","ORY24307",54,0)
 ;;R^"860.8:",100,9
"RTN","ORY24307",55,0)
 ;;D^  ; Q $P($G(@(GLREF_(+D0)_",0)")),U,1)
"RTN","ORY24307",56,0)
 ;;R^"860.8:",100,10
"RTN","ORY24307",57,0)
 ;;D^  ; ;
"RTN","ORY24307",58,0)
 ;;EOR^
"RTN","ORY24307",59,0)
 ;;KEY^860.8:^STRING CONTAINS ONE OF A LIST OF VALUES
"RTN","ORY24307",60,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY24307",61,0)
 ;;D^STRING CONTAINS ONE OF A LIST OF VALUES
"RTN","ORY24307",62,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY24307",63,0)
 ;;D^CLIST
"RTN","ORY24307",64,0)
 ;;R^"860.8:",100,1
"RTN","ORY24307",65,0)
 ;;D^  ;CLIST(DATA,LIST) ;   DOES THE DATA FIELD CONTAIN AN ELEMENT IN THE LIST
"RTN","ORY24307",66,0)
 ;;R^"860.8:",100,2
"RTN","ORY24307",67,0)
 ;;D^  ; ;
"RTN","ORY24307",68,0)
 ;;R^"860.8:",100,3
"RTN","ORY24307",69,0)
 ;;D^T+; W:$G(OCXTRACE) !!,"$$CLIST(",DATA,",""",LIST,""")"
"RTN","ORY24307",70,0)
 ;;R^"860.8:",100,4
"RTN","ORY24307",71,0)
 ;;D^  ; N PC F PC=1:1:$L(LIST,","),0 I PC,$L($P(LIST,",",PC)),(DATA[$P(LIST,",",PC)) Q
"RTN","ORY24307",72,0)
 ;;R^"860.8:",100,5
"RTN","ORY24307",73,0)
 ;;D^  ; Q ''PC
"RTN","ORY24307",74,0)
 ;;EOR^
"RTN","ORY24307",75,0)
 ;;EOF^OCXS(860.8)^1
"RTN","ORY24307",76,0)
 ;;SOF^860.6  ORDER CHECK DATA CONTEXT
"RTN","ORY24307",77,0)
 ;;KEY^860.6:^CPRS ORDER PRESCAN
"RTN","ORY24307",78,0)
 ;;R^"860.6:",.01,"E"
"RTN","ORY24307",79,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY24307",80,0)
 ;;R^"860.6:",.02,"E"
"RTN","ORY24307",81,0)
 ;;D^OEPS
"RTN","ORY24307",82,0)
 ;;R^"860.6:",1,"E"
"RTN","ORY24307",83,0)
 ;;D^DATA DRIVEN
"RTN","ORY24307",84,0)
 ;;EOR^
"RTN","ORY24307",85,0)
 ;;KEY^860.6:^CPRS ORDER PROTOCOL
"RTN","ORY24307",86,0)
 ;;R^"860.6:",.01,"E"
"RTN","ORY24307",87,0)
 ;;D^CPRS ORDER PROTOCOL
"RTN","ORY24307",88,0)
 ;;R^"860.6:",.02,"E"
"RTN","ORY24307",89,0)
 ;;D^OERR
"RTN","ORY24307",90,0)
 ;;R^"860.6:",1,"E"
"RTN","ORY24307",91,0)
 ;;D^DATA DRIVEN
"RTN","ORY24307",92,0)
 ;;EOR^
"RTN","ORY24307",93,0)
 ;;KEY^860.6:^DATABASE LOOKUP
"RTN","ORY24307",94,0)
 ;;R^"860.6:",.01,"E"
"RTN","ORY24307",95,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY24307",96,0)
 ;;R^"860.6:",.02,"E"
"RTN","ORY24307",97,0)
 ;;D^DL
"RTN","ORY24307",98,0)
 ;;R^"860.6:",1,"E"
"RTN","ORY24307",99,0)
 ;;D^PACKAGE LOOKUP
"RTN","ORY24307",100,0)
 ;;EOR^
"RTN","ORY24307",101,0)
 ;;KEY^860.6:^GENERIC HL7 MESSAGE ARRAY
"RTN","ORY24307",102,0)
 ;;R^"860.6:",.01,"E"
"RTN","ORY24307",103,0)
 ;;D^GENERIC HL7 MESSAGE ARRAY
"RTN","ORY24307",104,0)
 ;;R^"860.6:",.02,"E"
"RTN","ORY24307",105,0)
 ;;D^HL7
"RTN","ORY24307",106,0)
 ;;R^"860.6:",1,"E"
"RTN","ORY24307",107,0)
 ;;D^DATA DRIVEN
"RTN","ORY24307",108,0)
 ;;EOR^
"RTN","ORY24307",109,0)
 ;;EOF^OCXS(860.6)^1
"RTN","ORY24307",110,0)
 ;;SOF^860.5  ORDER CHECK DATA SOURCE
"RTN","ORY24307",111,0)
 ;;KEY^860.5:^DATABASE LOOKUP
"RTN","ORY24307",112,0)
 ;;R^"860.5:",.01,"E"
"RTN","ORY24307",113,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY24307",114,0)
 ;;R^"860.5:",.02,"E"
"RTN","ORY24307",115,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY24307",116,0)
 ;;EOR^
"RTN","ORY24307",117,0)
 ;;KEY^860.5:^HL7 COMMON ORDER SEGMENT
"RTN","ORY24307",118,0)
 ;;R^"860.5:",.01,"E"
"RTN","ORY24307",119,0)
 ;;D^HL7 COMMON ORDER SEGMENT
"RTN","ORY24307",120,0)
 ;;R^"860.5:",.02,"E"
"RTN","ORY24307",121,0)
 ;;D^GENERIC HL7 MESSAGE ARRAY
"RTN","ORY24307",122,0)
 ;;EOR^
"RTN","ORY24307",123,0)
 ;;KEY^860.5:^HL7 PATIENT ID SEGMENT
"RTN","ORY24307",124,0)
 ;;R^"860.5:",.01,"E"
"RTN","ORY24307",125,0)
 ;;D^HL7 PATIENT ID SEGMENT
"RTN","ORY24307",126,0)
 ;;R^"860.5:",.02,"E"
"RTN","ORY24307",127,0)
 ;;D^GENERIC HL7 MESSAGE ARRAY
"RTN","ORY24307",128,0)
 ;;EOR^
"RTN","ORY24307",129,0)
 ;;KEY^860.5:^OERR ORDER EVENT FLAG PROTOCOL
"RTN","ORY24307",130,0)
 ;;R^"860.5:",.01,"E"
"RTN","ORY24307",131,0)
 ;;D^OERR ORDER EVENT FLAG PROTOCOL
"RTN","ORY24307",132,0)
 ;;R^"860.5:",.02,"E"
"RTN","ORY24307",133,0)
 ;;D^CPRS ORDER PROTOCOL
"RTN","ORY24307",134,0)
 ;;EOR^
"RTN","ORY24307",135,0)
 ;;KEY^860.5:^ORDER ENTRY ORDER PRESCAN
"RTN","ORY24307",136,0)
 ;;R^"860.5:",.01,"E"
"RTN","ORY24307",137,0)
 ;;D^ORDER ENTRY ORDER PRESCAN
"RTN","ORY24307",138,0)
 ;;R^"860.5:",.02,"E"
"RTN","ORY24307",139,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY24307",140,0)
 ;;EOR^
"RTN","ORY24307",141,0)
 ;;EOF^OCXS(860.5)^1
"RTN","ORY24307",142,0)
 ;;SOF^860.4  ORDER CHECK DATA FIELD
"RTN","ORY24307",143,0)
 ;;KEY^860.4:^CLOZAPINE ANC W/IN 7 FLAG
"RTN","ORY24307",144,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY24307",145,0)
 ;;D^CLOZAPINE ANC W/IN 7 FLAG
"RTN","ORY24307",146,0)
 ;;R^"860.4:",1,"E"
"RTN","ORY24307",147,0)
 ;;D^CLOZ ANC FLAG
"RTN","ORY24307",148,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY24307",149,0)
 ;;D^BOOLEAN
"RTN","ORY24307",150,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.01,"E"
"RTN","ORY24307",151,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY24307",152,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.02,"E"
"RTN","ORY24307",153,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY24307",154,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",1,"E"
"RTN","ORY24307",155,0)
 ;;D^PATIENT.CLOZ_ANC_W/IN_7_FLAG
"RTN","ORY24307",156,0)
 ;;EOR^
"RTN","ORY24307",157,0)
 ;;KEY^860.4:^CLOZAPINE ANC W/IN 7 RESULT
"RTN","ORY24307",158,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY24307",159,0)
 ;;D^CLOZAPINE ANC W/IN 7 RESULT
"RTN","ORY24307",160,0)
 ;;R^"860.4:",1,"E"
"RTN","ORY24307",161,0)
 ;;D^CLOZ ANC RSLT
"RTN","ORY24307",162,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY24307",163,0)
 ;;D^NUMERIC
"RTN","ORY24307",164,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.01,"E"
"RTN","ORY24307",165,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY24307",166,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.02,"E"
"RTN","ORY24307",167,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY24307",168,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",1,"E"
"RTN","ORY24307",169,0)
 ;;D^PATIENT.CLOZ_ANC_W/IN_7_RSLT
"RTN","ORY24307",170,0)
 ;;EOR^
"RTN","ORY24307",171,0)
 ;;KEY^860.4:^CLOZAPINE LAB RESULTS
"RTN","ORY24307",172,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY24307",173,0)
 ;;D^CLOZAPINE LAB RESULTS
"RTN","ORY24307",174,0)
 ;;R^"860.4:",1,"E"
"RTN","ORY24307",175,0)
 ;;D^CLOZ LAB RSLTS
"RTN","ORY24307",176,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY24307",177,0)
 ;;D^FREE TEXT
"RTN","ORY24307",178,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.01,"E"
"RTN","ORY24307",179,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY24307",180,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.02,"E"
"RTN","ORY24307",181,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY24307",182,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",1,"E"
"RTN","ORY24307",183,0)
 ;;D^PATIENT.CLOZ_LAB_RESULTS
"RTN","ORY24307",184,0)
 ;;EOR^
"RTN","ORY24307",185,0)
 ;;KEY^860.4:^CLOZAPINE MED
"RTN","ORY24307",186,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY24307",187,0)
 ;;D^CLOZAPINE MED
"RTN","ORY24307",188,0)
 ;;R^"860.4:",1,"E"
"RTN","ORY24307",189,0)
 ;;D^CLOZAPINE
"RTN","ORY24307",190,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY24307",191,0)
 ;;D^BOOLEAN
"RTN","ORY24307",192,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.01,"E"
"RTN","ORY24307",193,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY24307",194,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.02,"E"
"RTN","ORY24307",195,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY24307",196,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",1,"E"
"RTN","ORY24307",197,0)
 ;;D^PATIENT.CLOZAPINE MED
"RTN","ORY24307",198,0)
 ;;EOR^
"RTN","ORY24307",199,0)
 ;;KEY^860.4:^CLOZAPINE WBC W/IN 7 FLAG
"RTN","ORY24307",200,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY24307",201,0)
 ;;D^CLOZAPINE WBC W/IN 7 FLAG
"RTN","ORY24307",202,0)
 ;;R^"860.4:",1,"E"
"RTN","ORY24307",203,0)
 ;;D^CLOZ WBC FLAG
"RTN","ORY24307",204,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY24307",205,0)
 ;;D^BOOLEAN
"RTN","ORY24307",206,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.01,"E"
"RTN","ORY24307",207,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY24307",208,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.02,"E"
"RTN","ORY24307",209,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY24307",210,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",1,"E"
"RTN","ORY24307",211,0)
 ;;D^PATIENT.CLOZ_WBC_W/IN_7_FLAG
"RTN","ORY24307",212,0)
 ;;EOR^
"RTN","ORY24307",213,0)
 ;;KEY^860.4:^CLOZAPINE WBC W/IN 7 RESULT
"RTN","ORY24307",214,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY24307",215,0)
 ;;D^CLOZAPINE WBC W/IN 7 RESULT
"RTN","ORY24307",216,0)
 ;;R^"860.4:",1,"E"
"RTN","ORY24307",217,0)
 ;;D^CLOZ WBC RSLT
"RTN","ORY24307",218,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY24307",219,0)
 ;;D^NUMERIC
"RTN","ORY24307",220,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.01,"E"
"RTN","ORY24307",221,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY24307",222,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.02,"E"
"RTN","ORY24307",223,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY24307",224,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",1,"E"
"RTN","ORY24307",225,0)
 ;;D^PATIENT.CLOZ_WBC_W/IN_7_RSLT
"RTN","ORY24307",226,0)
 ;;EOR^
"RTN","ORY24307",227,0)
 ;;KEY^860.4:^FILLER
"RTN","ORY24307",228,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY24307",229,0)
 ;;D^FILLER
"RTN","ORY24307",230,0)
 ;;R^"860.4:",1,"E"
"RTN","ORY24307",231,0)
 ;;D^FILL
"RTN","ORY24307",232,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY24307",233,0)
 ;;D^FREE TEXT
"RTN","ORY24307",234,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",.01,"E"
"RTN","ORY24307",235,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY24307",236,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",.02,"E"
"RTN","ORY24307",237,0)
 ;;D^ORDER ENTRY ORDER PRESCAN
"RTN","ORY24307",238,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",1,"E"
"RTN","ORY24307",239,0)
 ;;D^PATIENT.OPS_FILLER
"RTN","ORY24307",240,0)
 ;;R^"860.4:","860.41:GENERIC HL7 MESSAGE ARRAY^860.6",.01,"E"
"RTN","ORY24307",241,0)
 ;;D^GENERIC HL7 MESSAGE ARRAY
"RTN","ORY24307",242,0)
 ;;R^"860.4:","860.41:GENERIC HL7 MESSAGE ARRAY^860.6",.02,"E"
"RTN","ORY24307",243,0)
 ;;D^HL7 COMMON ORDER SEGMENT
"RTN","ORY24307",244,0)
 ;;R^"860.4:","860.41:GENERIC HL7 MESSAGE ARRAY^860.6",1,"E"
"RTN","ORY24307",245,0)
 ;;D^PATIENT.HL7_FILLER
"RTN","ORY24307",246,0)
 ;;EOR^
"RTN","ORY24307",247,0)
 ;;KEY^860.4:^ORDER MODE
"RTN","ORY24307",248,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY24307",249,0)
 ;;D^ORDER MODE
"RTN","ORY24307",250,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY24307",251,0)
 ;;D^FREE TEXT
"RTN","ORY24307",252,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",.01,"E"
"RTN","ORY24307",253,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY24307",254,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",.02,"E"
"RTN","ORY24307",255,0)
 ;;D^ORDER ENTRY ORDER PRESCAN
"RTN","ORY24307",256,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",1,"E"
"RTN","ORY24307",257,0)
 ;;D^PATIENT.OPS_ORD_MODE
"RTN","ORY24307",258,0)
 ;;EOR^
"RTN","ORY24307",259,0)
 ;;KEY^860.4:^PATIENT IEN
"RTN","ORY24307",260,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY24307",261,0)
 ;;D^PATIENT IEN
"RTN","ORY24307",262,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY24307",263,0)
 ;;D^NUMERIC
"RTN","ORY24307",264,0)
 ;;R^"860.4:","860.41:CPRS ORDER PROTOCOL^860.6",.01,"E"
"RTN","ORY24307",265,0)
 ;;D^CPRS ORDER PROTOCOL
"RTN","ORY24307",266,0)
 ;;R^"860.4:","860.41:CPRS ORDER PROTOCOL^860.6",.02,"E"
"RTN","ORY24307",267,0)
 ;;D^OERR ORDER EVENT FLAG PROTOCOL
"RTN","ORY24307",268,0)
 ;;R^"860.4:","860.41:CPRS ORDER PROTOCOL^860.6",1,"E"
"RTN","ORY24307",269,0)
 ;1;
"RTN","ORY24307",270,0)
 ;
"RTN","ORY24308")
0^86^B66749787
"RTN","ORY24308",1,0)
ORY24308 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*243) ;NOV 2,2006 at 12:05
"RTN","ORY24308",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17,1997;Build 242
"RTN","ORY24308",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY24308",4,0)
 ;
"RTN","ORY24308",5,0)
S ;
"RTN","ORY24308",6,0)
 ;
"RTN","ORY24308",7,0)
 D DOT^ORY243ES
"RTN","ORY24308",8,0)
 ;
"RTN","ORY24308",9,0)
 ;
"RTN","ORY24308",10,0)
 K REMOTE,LOCAL,OPCODE,REF
"RTN","ORY24308",11,0)
 F LINE=1:1:500 S TEXT=$P($T(DATA+LINE),";",2,999) Q:TEXT  I $L(TEXT) D  Q:QUIT
"RTN","ORY24308",12,0)
 .S ^TMP("OCXRULE",$J,$O(^TMP("OCXRULE",$J,"A"),-1)+1)=TEXT
"RTN","ORY24308",13,0)
 ;
"RTN","ORY24308",14,0)
 G ^ORY24309
"RTN","ORY24308",15,0)
 ;
"RTN","ORY24308",16,0)
 Q
"RTN","ORY24308",17,0)
 ;
"RTN","ORY24308",18,0)
DATA ;
"RTN","ORY24308",19,0)
 ;
"RTN","ORY24308",20,0)
 ;;D^PATIENT.OERR_ORDER_PATIENT
"RTN","ORY24308",21,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.01,"E"
"RTN","ORY24308",22,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY24308",23,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.02,"E"
"RTN","ORY24308",24,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY24308",25,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",1,"E"
"RTN","ORY24308",26,0)
 ;;D^PATIENT.IEN
"RTN","ORY24308",27,0)
 ;;R^"860.4:","860.41:GENERIC HL7 MESSAGE ARRAY^860.6",.01,"E"
"RTN","ORY24308",28,0)
 ;;D^GENERIC HL7 MESSAGE ARRAY
"RTN","ORY24308",29,0)
 ;;R^"860.4:","860.41:GENERIC HL7 MESSAGE ARRAY^860.6",.02,"E"
"RTN","ORY24308",30,0)
 ;;D^HL7 PATIENT ID SEGMENT
"RTN","ORY24308",31,0)
 ;;R^"860.4:","860.41:GENERIC HL7 MESSAGE ARRAY^860.6",1,"E"
"RTN","ORY24308",32,0)
 ;;D^PATIENT.HL7_PATIENT_ID
"RTN","ORY24308",33,0)
 ;;EOR^
"RTN","ORY24308",34,0)
 ;;KEY^860.4:^PHARMACY LOCAL ID
"RTN","ORY24308",35,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY24308",36,0)
 ;;D^PHARMACY LOCAL ID
"RTN","ORY24308",37,0)
 ;;R^"860.4:",1,"E"
"RTN","ORY24308",38,0)
 ;;D^DISP DRUG IEN
"RTN","ORY24308",39,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY24308",40,0)
 ;;D^FREE TEXT
"RTN","ORY24308",41,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",.01,"E"
"RTN","ORY24308",42,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY24308",43,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",.02,"E"
"RTN","ORY24308",44,0)
 ;;D^ORDER ENTRY ORDER PRESCAN
"RTN","ORY24308",45,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",1,"E"
"RTN","ORY24308",46,0)
 ;;D^PATIENT.OPS_DRUG_ID
"RTN","ORY24308",47,0)
 ;;EOR^
"RTN","ORY24308",48,0)
 ;;EOF^OCXS(860.4)^1
"RTN","ORY24308",49,0)
 ;;SOF^860.3  ORDER CHECK ELEMENT
"RTN","ORY24308",50,0)
 ;;KEY^860.3:^CLOZAPINE ANC < 1.5
"RTN","ORY24308",51,0)
 ;;R^"860.3:",.01,"E"
"RTN","ORY24308",52,0)
 ;;D^CLOZAPINE ANC < 1.5
"RTN","ORY24308",53,0)
 ;;R^"860.3:",.02,"E"
"RTN","ORY24308",54,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY24308",55,0)
 ;;R^"860.3:","860.31:4",.01,"E"
"RTN","ORY24308",56,0)
 ;;D^4
"RTN","ORY24308",57,0)
 ;;R^"860.3:","860.31:4",1,"E"
"RTN","ORY24308",58,0)
 ;;D^CLOZAPINE ANC W/IN 7 RESULT
"RTN","ORY24308",59,0)
 ;;R^"860.3:","860.31:4",2,"E"
"RTN","ORY24308",60,0)
 ;;D^LESS THAN
"RTN","ORY24308",61,0)
 ;;R^"860.3:","860.31:4",3,"E"
"RTN","ORY24308",62,0)
 ;;D^1.5
"RTN","ORY24308",63,0)
 ;;R^"860.3:","860.31:5",.01,"E"
"RTN","ORY24308",64,0)
 ;;D^5
"RTN","ORY24308",65,0)
 ;;R^"860.3:","860.31:5",1,"E"
"RTN","ORY24308",66,0)
 ;;D^CLOZAPINE ANC W/IN 7 FLAG
"RTN","ORY24308",67,0)
 ;;R^"860.3:","860.31:5",2,"E"
"RTN","ORY24308",68,0)
 ;;D^LOGICAL TRUE
"RTN","ORY24308",69,0)
 ;;EOR^
"RTN","ORY24308",70,0)
 ;;KEY^860.3:^CLOZAPINE ANC >= 1.5
"RTN","ORY24308",71,0)
 ;;R^"860.3:",.01,"E"
"RTN","ORY24308",72,0)
 ;;D^CLOZAPINE ANC >= 1.5
"RTN","ORY24308",73,0)
 ;;R^"860.3:",.02,"E"
"RTN","ORY24308",74,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY24308",75,0)
 ;;R^"860.3:","860.31:1",.01,"E"
"RTN","ORY24308",76,0)
 ;;D^1
"RTN","ORY24308",77,0)
 ;;R^"860.3:","860.31:1",1,"E"
"RTN","ORY24308",78,0)
 ;;D^CLOZAPINE ANC W/IN 7 RESULT
"RTN","ORY24308",79,0)
 ;;R^"860.3:","860.31:1",2,"E"
"RTN","ORY24308",80,0)
 ;;D^GREATER THAN
"RTN","ORY24308",81,0)
 ;;R^"860.3:","860.31:1",3,"E"
"RTN","ORY24308",82,0)
 ;;D^1.499
"RTN","ORY24308",83,0)
 ;;R^"860.3:","860.31:2",.01,"E"
"RTN","ORY24308",84,0)
 ;;D^2
"RTN","ORY24308",85,0)
 ;;R^"860.3:","860.31:2",1,"E"
"RTN","ORY24308",86,0)
 ;;D^CLOZAPINE ANC W/IN 7 FLAG
"RTN","ORY24308",87,0)
 ;;R^"860.3:","860.31:2",2,"E"
"RTN","ORY24308",88,0)
 ;;D^LOGICAL TRUE
"RTN","ORY24308",89,0)
 ;;EOR^
"RTN","ORY24308",90,0)
 ;;KEY^860.3:^CLOZAPINE ANC >= 1.5 & < 2.0
"RTN","ORY24308",91,0)
 ;;R^"860.3:",.01,"E"
"RTN","ORY24308",92,0)
 ;;D^CLOZAPINE ANC >= 1.5 & < 2.0
"RTN","ORY24308",93,0)
 ;;R^"860.3:",.02,"E"
"RTN","ORY24308",94,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY24308",95,0)
 ;;R^"860.3:","860.31:1",.01,"E"
"RTN","ORY24308",96,0)
 ;;D^1
"RTN","ORY24308",97,0)
 ;;R^"860.3:","860.31:1",1,"E"
"RTN","ORY24308",98,0)
 ;;D^CLOZAPINE ANC W/IN 7 RESULT
"RTN","ORY24308",99,0)
 ;;R^"860.3:","860.31:1",2,"E"
"RTN","ORY24308",100,0)
 ;;D^GREATER THAN
"RTN","ORY24308",101,0)
 ;;R^"860.3:","860.31:1",3,"E"
"RTN","ORY24308",102,0)
 ;;D^1.499
"RTN","ORY24308",103,0)
 ;;R^"860.3:","860.31:2",.01,"E"
"RTN","ORY24308",104,0)
 ;;D^2
"RTN","ORY24308",105,0)
 ;;R^"860.3:","860.31:2",1,"E"
"RTN","ORY24308",106,0)
 ;;D^CLOZAPINE ANC W/IN 7 RESULT
"RTN","ORY24308",107,0)
 ;;R^"860.3:","860.31:2",2,"E"
"RTN","ORY24308",108,0)
 ;;D^LESS THAN
"RTN","ORY24308",109,0)
 ;;R^"860.3:","860.31:2",3,"E"
"RTN","ORY24308",110,0)
 ;;D^2.0
"RTN","ORY24308",111,0)
 ;;R^"860.3:","860.31:3",.01,"E"
"RTN","ORY24308",112,0)
 ;;D^3
"RTN","ORY24308",113,0)
 ;;R^"860.3:","860.31:3",1,"E"
"RTN","ORY24308",114,0)
 ;;D^CLOZAPINE ANC W/IN 7 FLAG
"RTN","ORY24308",115,0)
 ;;R^"860.3:","860.31:3",2,"E"
"RTN","ORY24308",116,0)
 ;;D^LOGICAL TRUE
"RTN","ORY24308",117,0)
 ;;EOR^
"RTN","ORY24308",118,0)
 ;;KEY^860.3:^CLOZAPINE DRUG SELECTED
"RTN","ORY24308",119,0)
 ;;R^"860.3:",.01,"E"
"RTN","ORY24308",120,0)
 ;;D^CLOZAPINE DRUG SELECTED
"RTN","ORY24308",121,0)
 ;;R^"860.3:",.02,"E"
"RTN","ORY24308",122,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY24308",123,0)
 ;;R^"860.3:","860.31:1",.01,"E"
"RTN","ORY24308",124,0)
 ;;D^1
"RTN","ORY24308",125,0)
 ;;R^"860.3:","860.31:1",1,"E"
"RTN","ORY24308",126,0)
 ;;D^ORDER MODE
"RTN","ORY24308",127,0)
 ;;R^"860.3:","860.31:1",2,"E"
"RTN","ORY24308",128,0)
 ;;D^EQ FREE TEXT
"RTN","ORY24308",129,0)
 ;;R^"860.3:","860.31:1",3,"E"
"RTN","ORY24308",130,0)
 ;;D^SELECT
"RTN","ORY24308",131,0)
 ;;R^"860.3:","860.31:2",.01,"E"
"RTN","ORY24308",132,0)
 ;;D^2
"RTN","ORY24308",133,0)
 ;;R^"860.3:","860.31:2",1,"E"
"RTN","ORY24308",134,0)
 ;;D^FILLER
"RTN","ORY24308",135,0)
 ;;R^"860.3:","860.31:2",2,"E"
"RTN","ORY24308",136,0)
 ;;D^STARTS WITH
"RTN","ORY24308",137,0)
 ;;R^"860.3:","860.31:2",3,"E"
"RTN","ORY24308",138,0)
 ;;D^PS
"RTN","ORY24308",139,0)
 ;;R^"860.3:","860.31:5",.01,"E"
"RTN","ORY24308",140,0)
 ;;D^5
"RTN","ORY24308",141,0)
 ;;R^"860.3:","860.31:5",1,"E"
"RTN","ORY24308",142,0)
 ;;D^CLOZAPINE MED
"RTN","ORY24308",143,0)
 ;;R^"860.3:","860.31:5",2,"E"
"RTN","ORY24308",144,0)
 ;;D^LOGICAL TRUE
"RTN","ORY24308",145,0)
 ;;EOR^
"RTN","ORY24308",146,0)
 ;;KEY^860.3:^CLOZAPINE NO ANC W/IN 7 DAYS
"RTN","ORY24308",147,0)
 ;;R^"860.3:",.01,"E"
"RTN","ORY24308",148,0)
 ;;D^CLOZAPINE NO ANC W/IN 7 DAYS
"RTN","ORY24308",149,0)
 ;;R^"860.3:",.02,"E"
"RTN","ORY24308",150,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY24308",151,0)
 ;;R^"860.3:","860.31:6",.01,"E"
"RTN","ORY24308",152,0)
 ;;D^6
"RTN","ORY24308",153,0)
 ;;R^"860.3:","860.31:6",1,"E"
"RTN","ORY24308",154,0)
 ;;D^CLOZAPINE ANC W/IN 7 FLAG
"RTN","ORY24308",155,0)
 ;;R^"860.3:","860.31:6",2,"E"
"RTN","ORY24308",156,0)
 ;;D^LOGICAL FALSE
"RTN","ORY24308",157,0)
 ;;EOR^
"RTN","ORY24308",158,0)
 ;;KEY^860.3:^CLOZAPINE NO WBC W/IN 7 DAYS
"RTN","ORY24308",159,0)
 ;;R^"860.3:",.01,"E"
"RTN","ORY24308",160,0)
 ;;D^CLOZAPINE NO WBC W/IN 7 DAYS
"RTN","ORY24308",161,0)
 ;;R^"860.3:",.02,"E"
"RTN","ORY24308",162,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY24308",163,0)
 ;;R^"860.3:","860.31:4",.01,"E"
"RTN","ORY24308",164,0)
 ;;D^4
"RTN","ORY24308",165,0)
 ;;R^"860.3:","860.31:4",1,"E"
"RTN","ORY24308",166,0)
 ;;D^CLOZAPINE WBC W/IN 7 FLAG
"RTN","ORY24308",167,0)
 ;;R^"860.3:","860.31:4",2,"E"
"RTN","ORY24308",168,0)
 ;;D^LOGICAL FALSE
"RTN","ORY24308",169,0)
 ;;EOR^
"RTN","ORY24308",170,0)
 ;;KEY^860.3:^CLOZAPINE WBC < 3.0
"RTN","ORY24308",171,0)
 ;;R^"860.3:",.01,"E"
"RTN","ORY24308",172,0)
 ;;D^CLOZAPINE WBC < 3.0
"RTN","ORY24308",173,0)
 ;;R^"860.3:",.02,"E"
"RTN","ORY24308",174,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY24308",175,0)
 ;;R^"860.3:","860.31:4",.01,"E"
"RTN","ORY24308",176,0)
 ;;D^4
"RTN","ORY24308",177,0)
 ;;R^"860.3:","860.31:4",1,"E"
"RTN","ORY24308",178,0)
 ;;D^CLOZAPINE WBC W/IN 7 RESULT
"RTN","ORY24308",179,0)
 ;;R^"860.3:","860.31:4",2,"E"
"RTN","ORY24308",180,0)
 ;;D^LESS THAN
"RTN","ORY24308",181,0)
 ;;R^"860.3:","860.31:4",3,"E"
"RTN","ORY24308",182,0)
 ;;D^3.0
"RTN","ORY24308",183,0)
 ;;R^"860.3:","860.31:5",.01,"E"
"RTN","ORY24308",184,0)
 ;;D^5
"RTN","ORY24308",185,0)
 ;;R^"860.3:","860.31:5",1,"E"
"RTN","ORY24308",186,0)
 ;;D^CLOZAPINE WBC W/IN 7 FLAG
"RTN","ORY24308",187,0)
 ;;R^"860.3:","860.31:5",2,"E"
"RTN","ORY24308",188,0)
 ;;D^LOGICAL TRUE
"RTN","ORY24308",189,0)
 ;;EOR^
"RTN","ORY24308",190,0)
 ;;KEY^860.3:^CLOZAPINE WBC >= 3.0 & < 3.5
"RTN","ORY24308",191,0)
 ;;R^"860.3:",.01,"E"
"RTN","ORY24308",192,0)
 ;;D^CLOZAPINE WBC >= 3.0 & < 3.5
"RTN","ORY24308",193,0)
 ;;R^"860.3:",.02,"E"
"RTN","ORY24308",194,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY24308",195,0)
 ;;R^"860.3:","860.31:4",.01,"E"
"RTN","ORY24308",196,0)
 ;;D^4
"RTN","ORY24308",197,0)
 ;;R^"860.3:","860.31:4",1,"E"
"RTN","ORY24308",198,0)
 ;;D^CLOZAPINE WBC W/IN 7 RESULT
"RTN","ORY24308",199,0)
 ;;R^"860.3:","860.31:4",2,"E"
"RTN","ORY24308",200,0)
 ;;D^GREATER THAN
"RTN","ORY24308",201,0)
 ;;R^"860.3:","860.31:4",3,"E"
"RTN","ORY24308",202,0)
 ;;D^2.999
"RTN","ORY24308",203,0)
 ;;R^"860.3:","860.31:5",.01,"E"
"RTN","ORY24308",204,0)
 ;;D^5
"RTN","ORY24308",205,0)
 ;;R^"860.3:","860.31:5",1,"E"
"RTN","ORY24308",206,0)
 ;;D^CLOZAPINE WBC W/IN 7 RESULT
"RTN","ORY24308",207,0)
 ;;R^"860.3:","860.31:5",2,"E"
"RTN","ORY24308",208,0)
 ;;D^LESS THAN
"RTN","ORY24308",209,0)
 ;;R^"860.3:","860.31:5",3,"E"
"RTN","ORY24308",210,0)
 ;;D^3.5
"RTN","ORY24308",211,0)
 ;;R^"860.3:","860.31:6",.01,"E"
"RTN","ORY24308",212,0)
 ;;D^6
"RTN","ORY24308",213,0)
 ;;R^"860.3:","860.31:6",1,"E"
"RTN","ORY24308",214,0)
 ;;D^CLOZAPINE WBC W/IN 7 FLAG
"RTN","ORY24308",215,0)
 ;;R^"860.3:","860.31:6",2,"E"
"RTN","ORY24308",216,0)
 ;;D^LOGICAL TRUE
"RTN","ORY24308",217,0)
 ;;EOR^
"RTN","ORY24308",218,0)
 ;;KEY^860.3:^CLOZAPINE WBC >= 3.5
"RTN","ORY24308",219,0)
 ;;R^"860.3:",.01,"E"
"RTN","ORY24308",220,0)
 ;;D^CLOZAPINE WBC >= 3.5
"RTN","ORY24308",221,0)
 ;;R^"860.3:",.02,"E"
"RTN","ORY24308",222,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY24308",223,0)
 ;;R^"860.3:","860.31:1",.01,"E"
"RTN","ORY24308",224,0)
 ;;D^1
"RTN","ORY24308",225,0)
 ;;R^"860.3:","860.31:1",1,"E"
"RTN","ORY24308",226,0)
 ;;D^CLOZAPINE WBC W/IN 7 RESULT
"RTN","ORY24308",227,0)
 ;;R^"860.3:","860.31:1",2,"E"
"RTN","ORY24308",228,0)
 ;;D^GREATER THAN
"RTN","ORY24308",229,0)
 ;;R^"860.3:","860.31:1",3,"E"
"RTN","ORY24308",230,0)
 ;;D^3.499
"RTN","ORY24308",231,0)
 ;;R^"860.3:","860.31:2",.01,"E"
"RTN","ORY24308",232,0)
 ;;D^2
"RTN","ORY24308",233,0)
 ;;R^"860.3:","860.31:2",1,"E"
"RTN","ORY24308",234,0)
 ;;D^CLOZAPINE WBC W/IN 7 FLAG
"RTN","ORY24308",235,0)
 ;;R^"860.3:","860.31:2",2,"E"
"RTN","ORY24308",236,0)
 ;;D^LOGICAL TRUE
"RTN","ORY24308",237,0)
 ;;EOR^
"RTN","ORY24308",238,0)
 ;;EOF^OCXS(860.3)^1
"RTN","ORY24308",239,0)
 ;;SOF^860.2  ORDER CHECK RULE
"RTN","ORY24308",240,0)
 ;;KEY^860.2:^CLOZAPINE
"RTN","ORY24308",241,0)
 ;;R^"860.2:",.01,"E"
"RTN","ORY24308",242,0)
 ;;D^CLOZAPINE
"RTN","ORY24308",243,0)
 ;;R^"860.2:","860.21:10",.01,"E"
"RTN","ORY24308",244,0)
 ;;D^1.5 <= ANC < 2.0
"RTN","ORY24308",245,0)
 ;;R^"860.2:","860.21:10",.02,"E"
"RTN","ORY24308",246,0)
 ;;D^SIMPLE DEFINITION
"RTN","ORY24308",247,0)
 ;;R^"860.2:","860.21:10",1,"E"
"RTN","ORY24308",248,0)
 ;;D^CLOZAPINE ANC >= 1.5 & < 2.0
"RTN","ORY24308",249,0)
 ;;R^"860.2:","860.21:2",.01,"E"
"RTN","ORY24308",250,0)
 ;;D^NO WBC W/IN 7 DAYS
"RTN","ORY24308",251,0)
 ;;R^"860.2:","860.21:2",.02,"E"
"RTN","ORY24308",252,0)
 ;;D^SIMPLE DEFINITION
"RTN","ORY24308",253,0)
 ;;R^"860.2:","860.21:2",1,"E"
"RTN","ORY24308",254,0)
 ;;D^CLOZAPINE NO WBC W/IN 7 DAYS
"RTN","ORY24308",255,0)
 ;;R^"860.2:","860.21:3",.01,"E"
"RTN","ORY24308",256,0)
 ;;D^WBC < 3.0
"RTN","ORY24308",257,0)
 ;;R^"860.2:","860.21:3",.02,"E"
"RTN","ORY24308",258,0)
 ;;D^SIMPLE DEFINITION
"RTN","ORY24308",259,0)
 ;;R^"860.2:","860.21:3",1,"E"
"RTN","ORY24308",260,0)
 ;;D^CLOZAPINE WBC < 3.0
"RTN","ORY24308",261,0)
 ;;R^"860.2:","860.21:4",.01,"E"
"RTN","ORY24308",262,0)
 ;;D^ANC < 1.5
"RTN","ORY24308",263,0)
 ;;R^"860.2:","860.21:4",.02,"E"
"RTN","ORY24308",264,0)
 ;;D^SIMPLE DEFINITION
"RTN","ORY24308",265,0)
 ;;R^"860.2:","860.21:4",1,"E"
"RTN","ORY24308",266,0)
 ;;D^CLOZAPINE ANC < 1.5
"RTN","ORY24308",267,0)
 ;;R^"860.2:","860.21:5",.01,"E"
"RTN","ORY24308",268,0)
 ;;D^3.0 <= WBC < 3.5
"RTN","ORY24308",269,0)
 ;;R^"860.2:","860.21:5",.02,"E"
"RTN","ORY24308",270,0)
 ;;D^SIMPLE DEFINITION
"RTN","ORY24308",271,0)
 ;;R^"860.2:","860.21:5",1,"E"
"RTN","ORY24308",272,0)
 ;;D^CLOZAPINE WBC >= 3.0 & < 3.5
"RTN","ORY24308",273,0)
 ;;R^"860.2:","860.21:6",.01,"E"
"RTN","ORY24308",274,0)
 ;;D^NO ANC W/IN 7 DAYS
"RTN","ORY24308",275,0)
 ;;R^"860.2:","860.21:6",.02,"E"
"RTN","ORY24308",276,0)
 ;;D^SIMPLE DEFINITION
"RTN","ORY24308",277,0)
 ;;R^"860.2:","860.21:6",1,"E"
"RTN","ORY24308",278,0)
 ;;D^CLOZAPINE NO ANC W/IN 7 DAYS
"RTN","ORY24308",279,0)
 ;;R^"860.2:","860.21:7",.01,"E"
"RTN","ORY24308",280,0)
 ;;D^CLOZAPINE
"RTN","ORY24308",281,0)
 ;;R^"860.2:","860.21:7",.02,"E"
"RTN","ORY24308",282,0)
 ;;D^SIMPLE DEFINITION
"RTN","ORY24308",283,0)
 ;;R^"860.2:","860.21:7",1,"E"
"RTN","ORY24308",284,0)
 ;;D^CLOZAPINE DRUG SELECTED
"RTN","ORY24308",285,0)
 ;;R^"860.2:","860.21:8",.01,"E"
"RTN","ORY24308",286,0)
 ;;D^ANC >= 1.5
"RTN","ORY24308",287,0)
 ;;R^"860.2:","860.21:8",.02,"E"
"RTN","ORY24308",288,0)
 ;;D^SIMPLE DEFINITION
"RTN","ORY24308",289,0)
 ;;R^"860.2:","860.21:8",1,"E"
"RTN","ORY24308",290,0)
 ;;D^CLOZAPINE ANC >= 1.5
"RTN","ORY24308",291,0)
 ;;R^"860.2:","860.21:9",.01,"E"
"RTN","ORY24308",292,0)
 ;;D^WBC >= 3.5
"RTN","ORY24308",293,0)
 ;;R^"860.2:","860.21:9",.02,"E"
"RTN","ORY24308",294,0)
 ;;D^SIMPLE DEFINITION
"RTN","ORY24308",295,0)
 ;1;
"RTN","ORY24308",296,0)
 ;
"RTN","ORY24309")
0^87^B8754768
"RTN","ORY24309",1,0)
ORY24309 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*243) ;NOV 2,2006 at 12:05
"RTN","ORY24309",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17,1997;Build 242
"RTN","ORY24309",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY24309",4,0)
 ;
"RTN","ORY24309",5,0)
S ;
"RTN","ORY24309",6,0)
 ;
"RTN","ORY24309",7,0)
 D DOT^ORY243ES
"RTN","ORY24309",8,0)
 ;
"RTN","ORY24309",9,0)
 ;
"RTN","ORY24309",10,0)
 K REMOTE,LOCAL,OPCODE,REF
"RTN","ORY24309",11,0)
 F LINE=1:1:500 S TEXT=$P($T(DATA+LINE),";",2,999) Q:TEXT  I $L(TEXT) D  Q:QUIT
"RTN","ORY24309",12,0)
 .S ^TMP("OCXRULE",$J,$O(^TMP("OCXRULE",$J,"A"),-1)+1)=TEXT
"RTN","ORY24309",13,0)
 ;
"RTN","ORY24309",14,0)
 ;
"RTN","ORY24309",15,0)
 ;
"RTN","ORY24309",16,0)
 Q
"RTN","ORY24309",17,0)
 ;
"RTN","ORY24309",18,0)
DATA ;
"RTN","ORY24309",19,0)
 ;
"RTN","ORY24309",20,0)
 ;;R^"860.2:","860.21:9",1,"E"
"RTN","ORY24309",21,0)
 ;;D^CLOZAPINE WBC >= 3.5
"RTN","ORY24309",22,0)
 ;;R^"860.2:","860.22:1",.01,"E"
"RTN","ORY24309",23,0)
 ;;D^1
"RTN","ORY24309",24,0)
 ;;R^"860.2:","860.22:1",1,"E"
"RTN","ORY24309",25,0)
 ;;D^CLOZAPINE AND (NO WBC W/IN 7 DAYS OR NO ANC W/IN 7 DAYS)
"RTN","ORY24309",26,0)
 ;;R^"860.2:","860.22:1",2,"E"
"RTN","ORY24309",27,0)
 ;;D^CLOZAPINE APPROPRIATENESS
"RTN","ORY24309",28,0)
 ;;R^"860.2:","860.22:1",6,"E"
"RTN","ORY24309",29,0)
 ;;D^Clozapine orders require a CBC/Diff within past 7 days.  Please order CBC/Diff with WBC and ANC immediately.  Most recent results - |CLOZ LAB RSLTS|
"RTN","ORY24309",30,0)
 ;;R^"860.2:","860.22:2",.01,"E"
"RTN","ORY24309",31,0)
 ;;D^2
"RTN","ORY24309",32,0)
 ;;R^"860.2:","860.22:2",1,"E"
"RTN","ORY24309",33,0)
 ;;D^CLOZAPINE AND (WBC < 3.0 OR ANC < 1.5)
"RTN","ORY24309",34,0)
 ;;R^"860.2:","860.22:2",2,"E"
"RTN","ORY24309",35,0)
 ;;D^CLOZAPINE APPROPRIATENESS
"RTN","ORY24309",36,0)
 ;;R^"860.2:","860.22:2",6,"E"
"RTN","ORY24309",37,0)
 ;;D^WBC < 3.0 and/or ANC < 1.5 - pharmacy cannot fill clozapine order. Most recent results - |CLOZ LAB RSLTS|
"RTN","ORY24309",38,0)
 ;;R^"860.2:","860.22:3",.01,"E"
"RTN","ORY24309",39,0)
 ;;D^3
"RTN","ORY24309",40,0)
 ;;R^"860.2:","860.22:3",1,"E"
"RTN","ORY24309",41,0)
 ;;D^CLOZAPINE AND 3.0 <= WBC < 3.5 AND ANC >= 1.5
"RTN","ORY24309",42,0)
 ;;R^"860.2:","860.22:3",2,"E"
"RTN","ORY24309",43,0)
 ;;D^CLOZAPINE APPROPRIATENESS
"RTN","ORY24309",44,0)
 ;;R^"860.2:","860.22:3",6,"E"
"RTN","ORY24309",45,0)
 ;;D^WBC between 3.0 and 3.5 with ANC >= 1.5 - please repeat CBC/Diff including WBC and ANC immediately and twice weekly.  Most recent results - |CLOZ LAB RSLTS|
"RTN","ORY24309",46,0)
 ;;R^"860.2:","860.22:4",.01,"E"
"RTN","ORY24309",47,0)
 ;;D^4
"RTN","ORY24309",48,0)
 ;;R^"860.2:","860.22:4",1,"E"
"RTN","ORY24309",49,0)
 ;;D^CLOZAPINE AND 1.5 <= ANC < 2.0
"RTN","ORY24309",50,0)
 ;;R^"860.2:","860.22:4",2,"E"
"RTN","ORY24309",51,0)
 ;;D^CLOZAPINE APPROPRIATENESS
"RTN","ORY24309",52,0)
 ;;R^"860.2:","860.22:4",6,"E"
"RTN","ORY24309",53,0)
 ;;D^ANC between 1.5 and 2.0 - please repeat CBC/Diff including WBC and ANC immediately and twice weekly.  Most recent results - |CLOZ LAB RSLTS|
"RTN","ORY24309",54,0)
 ;;EOR^
"RTN","ORY24309",55,0)
 ;;EOF^OCXS(860.2)^1
"RTN","ORY24309",56,0)
 ;1;
"RTN","ORY24309",57,0)
 ;
"RTN","ORY2431")
0^90^B40550963
"RTN","ORY2431",1,0)
ORY2431 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*243) ;NOV 2,2006 at 12:05
"RTN","ORY2431",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17,1997;Build 242
"RTN","ORY2431",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY2431",4,0)
 ;
"RTN","ORY2431",5,0)
S ;
"RTN","ORY2431",6,0)
 ;
"RTN","ORY2431",7,0)
 Q
"RTN","ORY2431",8,0)
 ;
"RTN","ORY2431",9,0)
 ;
"RTN","ORY2431",10,0)
COMPARE(L,R) ;
"RTN","ORY2431",11,0)
 ;
"RTN","ORY2431",12,0)
 Q:$$RES("R") 1
"RTN","ORY2431",13,0)
 ;
"RTN","ORY2431",14,0)
 Q:'$L($O(L(""))) $$ADDREC^ORY2432("R")
"RTN","ORY2431",15,0)
 ;
"RTN","ORY2431",16,0)
 N C,OCXDD M C=L,C=R S OCXDD=$O(C("")) Q $$MULT("C",OCXDD)
"RTN","ORY2431",17,0)
 ;
"RTN","ORY2431",18,0)
 Q 0
"RTN","ORY2431",19,0)
 ;
"RTN","ORY2431",20,0)
RES(REF) ;
"RTN","ORY2431",21,0)
 ;
"RTN","ORY2431",22,0)
 N QUIT,SUB
"RTN","ORY2431",23,0)
 S QUIT=0
"RTN","ORY2431",24,0)
 S SUB="" F  S SUB=$O(@REF@(SUB)) Q:'$L(SUB)  I (SUB[":") D  Q:QUIT
"RTN","ORY2431",25,0)
 .N DD,DA
"RTN","ORY2431",26,0)
 .S DD=$P(SUB,":",1),DA=$P(SUB,":",2)
"RTN","ORY2431",27,0)
 .I $L(DA),'(DA=+DA) D  Q:QUIT
"RTN","ORY2431",28,0)
 ..N DANEW,SUBNEW
"RTN","ORY2431",29,0)
 ..S DANEW=$O(^OCXS($P(DA,U,2),"B",$P(DA,U,1),0))
"RTN","ORY2431",30,0)
 ..I 'DANEW W !!,$P($G(^OCXS(+$P(DA,U,2),0)),U,1),": ",$P(DA,U,1),"  could not resolve name.",!!,"    End Transport." S QUIT=1 Q
"RTN","ORY2431",31,0)
 ..S SUBNEW=DD_":"_DANEW
"RTN","ORY2431",32,0)
 ..I $D(@REF@(SUBNEW)) W !!," multiple #",DANEW," already existed." S QUIT=1 Q
"RTN","ORY2431",33,0)
 ..M @REF@(SUBNEW)=@REF@(SUB)
"RTN","ORY2431",34,0)
 ..K @REF@(SUB)
"RTN","ORY2431",35,0)
 ..S SUB=""
"RTN","ORY2431",36,0)
 .I $L(SUB),($D(@REF@(SUB))>9) S QUIT=$$RES($NA(@REF@(SUB)))
"RTN","ORY2431",37,0)
 ;
"RTN","ORY2431",38,0)
 Q QUIT
"RTN","ORY2431",39,0)
 ;
"RTN","ORY2431",40,0)
MULT(CREF,OCXDD) ;
"RTN","ORY2431",41,0)
 ;
"RTN","ORY2431",42,0)
 N OCXSUB,LREF,RREF,QUIT,OCXFLD
"RTN","ORY2431",43,0)
 S LREF="L"_$E(CREF,2,$L(CREF)),RREF="R"_$E(CREF,2,$L(CREF))
"RTN","ORY2431",44,0)
 ;
"RTN","ORY2431",45,0)
 S QUIT=0,OCXFLD="" F  S OCXFLD=$O(@CREF@(OCXDD,OCXFLD)) Q:'$L(OCXFLD)  D  Q:QUIT
"RTN","ORY2431",46,0)
 .I (OCXFLD[":") D  Q:QUIT
"RTN","ORY2431",47,0)
 ..Q:$$EXFLD(+OCXFLD,0)
"RTN","ORY2431",48,0)
 ..I '$D(@LREF@(OCXDD,OCXFLD,.01,"E")) D  M @LREF@(OCXDD,OCXFLD)=@RREF@(OCXDD,OCXFLD)
"RTN","ORY2431",49,0)
 ...D WARN("Missing multiple:",CREF,OCXDD,OCXFLD)
"RTN","ORY2431",50,0)
 ...S QUIT=$$ADDMULT^ORY2433(CREF,OCXDD,OCXFLD)
"RTN","ORY2431",51,0)
 ..I '$D(@RREF@(OCXDD,OCXFLD,.01,"E")) D  M @RREF@(OCXDD,OCXFLD)=@LREF@(OCXDD,OCXFLD)
"RTN","ORY2431",52,0)
 ...D WARN("Extra multiple:",CREF,OCXDD,OCXFLD)
"RTN","ORY2431",53,0)
 ...S QUIT=$$DELMULT^ORY2433($$APPEND(CREF,OCXDD),OCXFLD)
"RTN","ORY2431",54,0)
 .;
"RTN","ORY2431",55,0)
 .I (OCXFLD=+OCXFLD),'$$EXFLD(+OCXDD,OCXFLD) D
"RTN","ORY2431",56,0)
 ..I ($O(@CREF@(OCXDD,OCXFLD,""))="E") D  Q
"RTN","ORY2431",57,0)
 ...I $L($G(@RREF@(OCXDD,OCXFLD,"E"))),'$L($G(@LREF@(OCXDD,OCXFLD,"E"))) D  Q
"RTN","ORY2431",58,0)
 ....D WARN("Data Value Missing in "_$$NETNAME^OCXSEND,CREF,OCXDD,OCXFLD,"E")
"RTN","ORY2431",59,0)
 ....S QUIT=$$EDITFLD^ORY2434(CREF,OCXDD,OCXFLD,"E")
"RTN","ORY2431",60,0)
 ...I $L($G(@LREF@(OCXDD,OCXFLD,"E"))),'$L($G(@RREF@(OCXDD,OCXFLD,"E"))) D  Q
"RTN","ORY2431",61,0)
 ....D WARN("Extra Data Value in "_$$NETNAME^OCXSEND,CREF,OCXDD,OCXFLD,"E")
"RTN","ORY2431",62,0)
 ....S QUIT=$$DELFLD^ORY2434(CREF,OCXDD,OCXFLD,"E")
"RTN","ORY2431",63,0)
 ...I '(@LREF@(OCXDD,OCXFLD,"E")=@RREF@(OCXDD,OCXFLD,"E")) D
"RTN","ORY2431",64,0)
 ....D WARN("Inconsistent Data",CREF,OCXDD,OCXFLD,"E")
"RTN","ORY2431",65,0)
 ....S QUIT=$$EDITFLD^ORY2434(CREF,OCXDD,OCXFLD,"E")
"RTN","ORY2431",66,0)
 ..S OCXSUB=0 F  Q:QUIT  S OCXSUB=$O(@CREF@(OCXDD,OCXFLD,OCXSUB)) Q:'OCXSUB  I '($G(@RREF@(OCXDD,OCXFLD,OCXSUB))=$G(@LREF@(OCXDD,OCXFLD,OCXSUB))) D  Q
"RTN","ORY2431",67,0)
 ...D WARN("Inconsistent word Data",CREF,OCXDD,OCXFLD,OCXSUB)
"RTN","ORY2431",68,0)
 ...S QUIT=$$LOADWORD^ORY2432(RREF,OCXDD,OCXFLD,OCXSUB)
"RTN","ORY2431",69,0)
 .;
"RTN","ORY2431",70,0)
 .I 'QUIT,(OCXFLD[":") S QUIT=$$MULT($$APPEND(CREF,OCXDD),OCXFLD)
"RTN","ORY2431",71,0)
 Q QUIT
"RTN","ORY2431",72,0)
 ;
"RTN","ORY2431",73,0)
APPEND(ARRAY,OCXSUB) ;
"RTN","ORY2431",74,0)
 S:'(OCXSUB=+OCXSUB) OCXSUB=""""_OCXSUB_""""
"RTN","ORY2431",75,0)
 Q:'(ARRAY["(") ARRAY_"("_OCXSUB_")"
"RTN","ORY2431",76,0)
 Q $E(ARRAY,1,$L(ARRAY)-1)_","_OCXSUB_")"
"RTN","ORY2431",77,0)
 ;
"RTN","ORY2431",78,0)
EXFLD(FILE,OCXFLD) ;
"RTN","ORY2431",79,0)
 N OCXFNAM
"RTN","ORY2431",80,0)
 S OCXFNAM=$$FIELD^OCXSENDD(FILE,OCXFLD,"LABEL")
"RTN","ORY2431",81,0)
 I (OCXFNAM["UNIQUE OBJECT IDENTIFIER") Q 1
"RTN","ORY2431",82,0)
 I (FILE=860.2),(OCXFLD=.02) Q 1
"RTN","ORY2431",83,0)
 I (FILE=860.22),(OCXFLD=4) Q 1
"RTN","ORY2431",84,0)
 I (FILE=860.3),(OCXFLD=3) Q 1
"RTN","ORY2431",85,0)
 I (FILE=860.9),(OCXFLD=1) Q 1
"RTN","ORY2431",86,0)
 I (FILE=860.91) Q 1
"RTN","ORY2431",87,0)
 I (FILE=860.801) Q 1
"RTN","ORY2431",88,0)
 I (FILE=860.81) Q 1
"RTN","ORY2431",89,0)
 I (FILE=861.01) Q 1
"RTN","ORY2431",90,0)
 I (FILE=863.02) Q 1
"RTN","ORY2431",91,0)
 I (FILE=863.54) Q 1
"RTN","ORY2431",92,0)
 I (FILE=863.61) Q 1
"RTN","ORY2431",93,0)
 I (FILE=863.72) Q 1
"RTN","ORY2431",94,0)
 I (FILE=863.81) Q 1
"RTN","ORY2431",95,0)
 I ($E(OCXFNAM,1)="*") Q 1
"RTN","ORY2431",96,0)
 Q 0
"RTN","ORY2431",97,0)
 ;
"RTN","ORY2431",98,0)
WARN(MSG,CREF,OCXDD,OCXFLD,OCXSUB) ;
"RTN","ORY2431",99,0)
 ;
"RTN","ORY2431",100,0)
 Q:$G(OCXAUTO)
"RTN","ORY2431",101,0)
 ;
"RTN","ORY2431",102,0)
 N D0,DASH,OCXDDPTH,OCXDPTR,FILE,FILEID,LREF,OCXPTR,RREF
"RTN","ORY2431",103,0)
 ;
"RTN","ORY2431",104,0)
 S DASH="",$P(DASH,"-",(55-$L(MSG)))="-"
"RTN","ORY2431",105,0)
 W !!,"------------",MSG,DASH
"RTN","ORY2431",106,0)
 D DSPHDR(CREF,OCXDD,OCXFLD)
"RTN","ORY2431",107,0)
 I $D(OCXSUB) D DSPFLD(CREF,OCXDD,OCXFLD,OCXSUB)
"RTN","ORY2431",108,0)
 I '$D(OCXSUB) D DSPREC(CREF,OCXDD,OCXFLD)
"RTN","ORY2431",109,0)
 ;
"RTN","ORY2431",110,0)
 W ! Q
"RTN","ORY2431",111,0)
 ;
"RTN","ORY2431",112,0)
DSPREC(CREF,OCXDD,OCXFLD) ;
"RTN","ORY2431",113,0)
 ;
"RTN","ORY2431",114,0)
 N OCXDPTR,OCXDDPTH,LEVL,OCXCREF,OCXSUB
"RTN","ORY2431",115,0)
 S OCXCREF=$$APPEND($$APPEND(CREF,OCXDD),OCXFLD)
"RTN","ORY2431",116,0)
 S OCXDDPTH=$P($P(OCXCREF,"(",2),")",1),LEVL=$L(OCXDDPTH,",")
"RTN","ORY2431",117,0)
 S OCXSUB="" F  S OCXSUB=$O(@OCXCREF@(OCXSUB)) Q:'$L(OCXSUB)  D
"RTN","ORY2431",118,0)
 .;
"RTN","ORY2431",119,0)
 .I '(OCXSUB[":"),'((OCXSUB=.01)&$O(@OCXCREF@(OCXSUB))) D
"RTN","ORY2431",120,0)
 ..N LINE
"RTN","ORY2431",121,0)
 ..Q:$$EXFLD(+OCXFLD,OCXSUB)
"RTN","ORY2431",122,0)
 ..I OCXFLD W !,?(5+((LEVL)*4)),$$FIELD^OCXSENDD(+OCXFLD,OCXSUB,"LABEL"),": ",$G(@OCXCREF@(OCXSUB,"E"))
"RTN","ORY2431",123,0)
 ..S LINE=0 F  S LINE=$O(@OCXCREF@(OCXSUB,LINE)) Q:'LINE  D
"RTN","ORY2431",124,0)
 ...W !,?(5+(LEVL*4)),$J(LINE,3),">",@OCXCREF@(OCXSUB,LINE)
"RTN","ORY2431",125,0)
 .;
"RTN","ORY2431",126,0)
 .I (OCXSUB[":") D
"RTN","ORY2431",127,0)
 ..N D0,OCXDD,FILENAME
"RTN","ORY2431",128,0)
 ..S D0=+$P(OCXSUB,":",2),OCXDD=+OCXSUB
"RTN","ORY2431",129,0)
 ..S FILENAME=$$FILENAME^OCXSENDD(OCXDD)
"RTN","ORY2431",130,0)
 ..I $L(FILENAME) W !,?(5+($L(LEVL)*4)),FILENAME
"RTN","ORY2431",131,0)
 ..E  W !!,?(5+(LEVL*4)),FILENAME
"RTN","ORY2431",132,0)
 ..W " ",D0,": ",$G(@OCXCREF@(OCXSUB,.01,"E"))
"RTN","ORY2431",133,0)
 ..D DSPREC($$APPEND(CREF,OCXDD),OCXFLD,OCXSUB)
"RTN","ORY2431",134,0)
 ;
"RTN","ORY2431",135,0)
 Q
"RTN","ORY2431",136,0)
 ;
"RTN","ORY2431",137,0)
DSPHDR(CREF,OCXDD,OCXFLD) ;
"RTN","ORY2431",138,0)
 ;
"RTN","ORY2431",139,0)
 N D0,FILE,FILEID,OCXPTR,OCXDDPTH
"RTN","ORY2431",140,0)
 S OCXDDPTH=$P($P($$APPEND($$APPEND(CREF,OCXDD),OCXFLD),"(",2),")",1)
"RTN","ORY2431",141,0)
 S FILE="" F OCXPTR=1:1:$L(OCXDDPTH,",") D
"RTN","ORY2431",142,0)
 .N OCXDD,D0,FILEID
"RTN","ORY2431",143,0)
 .S FILEID=$P(OCXDDPTH,",",OCXPTR)
"RTN","ORY2431",144,0)
 .I (FILEID[":") D
"RTN","ORY2431",145,0)
 ..S D0=+$P(FILEID,":",2),OCXDD=+$E(FILEID,2,$L(FILEID))
"RTN","ORY2431",146,0)
 ..W !,?(5+(OCXPTR*4)),$$FILENAME^OCXSENDD(OCXDD)
"RTN","ORY2431",147,0)
 ..S:$L(FILE) FILE=FILE_"," S FILE=FILE_FILEID
"RTN","ORY2431",148,0)
 ..I $D(@("L("_FILE_",.01,""E"")")) W ": ",@("L("_FILE_",.01,""E"")") W:D0 " [",D0,"]"
"RTN","ORY2431",149,0)
 ..E  I $D(@("R("_FILE_",.01,""E"")")) W ": ",@("R("_FILE_",.01,""E"")") W:D0 " [",D0,"]"
"RTN","ORY2431",150,0)
 ;
"RTN","ORY2431",151,0)
 Q
"RTN","ORY2431",152,0)
 ;
"RTN","ORY2431",153,0)
DSPFLD(CREF,OCXDD,OCXFLD,OCXSUB) ;
"RTN","ORY2431",154,0)
 ;
"RTN","ORY2431",155,0)
 N OCXDPTR,LREF,RREF,OCXDDPTH
"RTN","ORY2431",156,0)
 ;
"RTN","ORY2431",157,0)
 S OCXDDPTH=$P($P($$APPEND(CREF,OCXDD),"(",2),")",1)
"RTN","ORY2431",158,0)
 S LREF="L("_OCXDDPTH_")",RREF="R("_OCXDDPTH_")"
"RTN","ORY2431",159,0)
 W !,?(5+(($L(OCXDDPTH,",")+1)*4)),$$FIELD^OCXSENDD(OCXDD,OCXFLD,"LABEL")," field [",OCXFLD,"]"
"RTN","ORY2431",160,0)
 I OCXSUB W " Line #",OCXSUB
"RTN","ORY2431",161,0)
 ;
"RTN","ORY2431",162,0)
 W:($D(@RREF@(OCXFLD,OCXSUB))) !,?(5+(($L(OCXDDPTH,",")+2)*4)),"(R) CPRS27.FO-SLC.MED.VA.GOV: ",@RREF@(OCXFLD,OCXSUB)
"RTN","ORY2431",163,0)
 W:($D(@LREF@(OCXFLD,OCXSUB))) !,?(5+(($L(OCXDDPTH,",")+2)*4)),"(L) ",$$NETNAME^OCXSEND,": ",@LREF@(OCXFLD,OCXSUB)
"RTN","ORY2431",164,0)
 ;
"RTN","ORY2431",165,0)
 Q
"RTN","ORY2431",166,0)
 ;
"RTN","ORY2431",167,0)
 W !,?10 Q 0 Q $$PAUSE
"RTN","ORY2431",168,0)
 ;
"RTN","ORY2431",169,0)
PAUSE() W "  Press Enter " R X:DTIME W ! Q (X[U)
"RTN","ORY2431",170,0)
 ;
"RTN","ORY2431",171,0)
NOW() N X,Y,%DT S X="N",%DT="T" D ^%DT S Y=$$DATE^OCXSENDD(Y) S:(Y["@") Y=$P(Y,"@",1)_" at "_$P(Y,"@",2) Q Y
"RTN","ORY2431",172,0)
 ;
"RTN","ORY2432")
0^91^B26766774
"RTN","ORY2432",1,0)
ORY2432 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*243) ;NOV 2,2006 at 12:05
"RTN","ORY2432",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17,1997;Build 242
"RTN","ORY2432",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY2432",4,0)
 ;
"RTN","ORY2432",5,0)
S ;
"RTN","ORY2432",6,0)
 ;  Record Utilities
"RTN","ORY2432",7,0)
 Q
"RTN","ORY2432",8,0)
 ;
"RTN","ORY2432",9,0)
ADDREC(OCXCREF) ;
"RTN","ORY2432",10,0)
 ;
"RTN","ORY2432",11,0)
 N QUIT,OCXDD,OCXDA,OCXGREF,OCXNAME
"RTN","ORY2432",12,0)
 S OCXDD=$O(@OCXCREF@("")) Q:'OCXDD 0
"RTN","ORY2432",13,0)
 S OCXNAME=$G(@OCXCREF@(OCXDD,.01,"E"))
"RTN","ORY2432",14,0)
 ;
"RTN","ORY2432",15,0)
 W "   record missing..."
"RTN","ORY2432",16,0)
 I (OCXFLAG["D") Q 0
"RTN","ORY2432",17,0)
 ;
"RTN","ORY2432",18,0)
 S OCXDA=0 D CREATE(OCXCREF,OCXDD,.OCXDA,0)
"RTN","ORY2432",19,0)
 S:$L(OCXNAME) ^TMP("OCXRULE",$J,"A",+OCXDD,OCXNAME)=""
"RTN","ORY2432",20,0)
 ;
"RTN","ORY2432",21,0)
 Q 0
"RTN","ORY2432",22,0)
 ;
"RTN","ORY2432",23,0)
CREATE(OCXCREF,OCXDD,OCXDA,OCXLVL) ;
"RTN","ORY2432",24,0)
 ;
"RTN","ORY2432",25,0)
 N OCXFLD,OCXGREF,OCXKEY
"RTN","ORY2432",26,0)
 ;
"RTN","ORY2432",27,0)
 I $L(OCXDA),'(OCXDA=+OCXDA) W !!,"Unresolved subscript." Q
"RTN","ORY2432",28,0)
 ;
"RTN","ORY2432",29,0)
 S OCXKEY=@OCXCREF@(OCXDD,.01,"E")
"RTN","ORY2432",30,0)
 S OCXGREF=$$GETREF(+OCXDD,.OCXDA,OCXLVL) Q:'$L(OCXGREF)
"RTN","ORY2432",31,0)
 I 'OCXDA D
"RTN","ORY2432",32,0)
 .S OCXDA=$O(^TMP("OCXRULE",$J,"B",+OCXDD,OCXKEY,0)) Q:OCXDA
"RTN","ORY2432",33,0)
 .S OCXDA=$O(@(OCXGREF_""" "")"),-1)+1
"RTN","ORY2432",34,0)
 .F OCXDA=OCXDA:1 Q:'$D(@(OCXGREF_OCXDA_",0)"))
"RTN","ORY2432",35,0)
 .I $D(@(OCXGREF_OCXDA_",0)")) S OCXDA=0
"RTN","ORY2432",36,0)
 ;
"RTN","ORY2432",37,0)
 I 'OCXDA W !!,"Error adding record..." Q
"RTN","ORY2432",38,0)
 ;
"RTN","ORY2432",39,0)
 I '$D(@(OCXGREF_"0)")) S @(OCXGREF_"0)")=U_$$FILEHDR^OCXSENDD(+OCXDD)_U_U
"RTN","ORY2432",40,0)
 ;
"RTN","ORY2432",41,0)
 S OCXFLD=0 F  S OCXFLD=$O(@OCXCREF@(OCXDD,OCXFLD)) Q:'OCXFLD  Q:(OCXFLD[":")  I '$$EXFLD^ORY2431(+OCXDD,OCXFLD) D
"RTN","ORY2432",42,0)
 .I $L($G(@OCXCREF@(OCXDD,OCXFLD,"E"))) D DIE(OCXDD,OCXGREF,OCXFLD,@OCXCREF@(OCXDD,OCXFLD,"E"),.OCXDA,OCXLVL)
"RTN","ORY2432",43,0)
 .I $O(@OCXCREF@(OCXDD,OCXFLD,0)) D WORD(OCXDD,OCXGREF,OCXFLD,.OCXDA,OCXCREF)
"RTN","ORY2432",44,0)
 ;
"RTN","ORY2432",45,0)
 D PUSH(.OCXDA)
"RTN","ORY2432",46,0)
 S OCXFLD="" F  S OCXFLD=$O(@OCXCREF@(OCXDD,OCXFLD)) Q:'$L(OCXFLD)  I (OCXFLD[":") D
"RTN","ORY2432",47,0)
 .S OCXDA=$P(OCXFLD,":",2) W ! D CREATE($$APPEND(OCXCREF,OCXDD),OCXFLD,.OCXDA,OCXLVL+1)
"RTN","ORY2432",48,0)
 D POP(.OCXDA)
"RTN","ORY2432",49,0)
 Q
"RTN","ORY2432",50,0)
 ;
"RTN","ORY2432",51,0)
LOADWORD(RREF,OCXDD,OCXFLD,OCXSUB) ;
"RTN","ORY2432",52,0)
 ;
"RTN","ORY2432",53,0)
 N QUIT,DDPATH,INDEX,OCXDA,OCXGREF
"RTN","ORY2432",54,0)
 S DDPATH=$P($P($$APPEND(RREF,OCXDD),"(",2),")",1)
"RTN","ORY2432",55,0)
 F INDEX=1:1:$L(DDPATH,",") S OCXDA($L(DDPATH,",")-INDEX)=+$P($P(DDPATH,",",INDEX),":",2)
"RTN","ORY2432",56,0)
 S OCXDA=$G(OCXDA(0)) K OCXDA(0)
"RTN","ORY2432",57,0)
 Q:(OCXFLAG["D") 0
"RTN","ORY2432",58,0)
 I (OCXFLAG["A") S QUIT=$$READ("Y"," Do you want to reload the local '"_$$FIELD^OCXSENDD(+OCXDD,+OCXFLD,"LABEL")_"' field ?","YES") Q:'QUIT (QUIT[U)
"RTN","ORY2432",59,0)
 S OCXGREF=$$GETREF(+OCXDD,.OCXDA,$L(DDPATH,",")-1) Q:'$L(OCXGREF)
"RTN","ORY2432",60,0)
 D WORD(OCXDD,OCXGREF,OCXFLD,.OCXDA,RREF)
"RTN","ORY2432",61,0)
 Q 0
"RTN","ORY2432",62,0)
 ;
"RTN","ORY2432",63,0)
GETREF(OCXDD,OCXDA,OCXLVL) ;
"RTN","ORY2432",64,0)
 ;
"RTN","ORY2432",65,0)
 Q:'OCXDD ""
"RTN","ORY2432",66,0)
 ;
"RTN","ORY2432",67,0)
 N OCXIENS,OCXERR,OCXX
"RTN","ORY2432",68,0)
 S OCXIENS=$$IENS^DILF(.OCXDA),OCXERR=""
"RTN","ORY2432",69,0)
 S OCXX=$$ROOT^DILFD(OCXDD,OCXIENS,0,OCXERR)
"RTN","ORY2432",70,0)
 Q OCXX
"RTN","ORY2432",71,0)
 ;
"RTN","ORY2432",72,0)
WORD(DD,GREF,FLD,DA,RREF) ;
"RTN","ORY2432",73,0)
 ;
"RTN","ORY2432",74,0)
 N SUB,GLROOT,LINE
"RTN","ORY2432",75,0)
 S SUB=$P($$FIELD^OCXSENDD(+DD,FLD,"GLOBAL SUBSCRIPT LOCATION"),";",1) S:'(SUB=+SUB) SUB=""""_SUB_""""
"RTN","ORY2432",76,0)
 S GLROOT=GREF_DA_","_SUB_")" K @GLROOT
"RTN","ORY2432",77,0)
 S LINE=0 F  S LINE=$O(@RREF@(DD,FLD,LINE)) Q:'LINE  D
"RTN","ORY2432",78,0)
 .S @GLROOT@($O(@GLROOT@(""),-1)+1,0)=@RREF@(DD,FLD,LINE)
"RTN","ORY2432",79,0)
 S LINE=$O(@GLROOT@(""),-1),@GLROOT@(0)=U_U_LINE_U_LINE_U_$$DATE("T")_U
"RTN","ORY2432",80,0)
 ;
"RTN","ORY2432",81,0)
 Q
"RTN","ORY2432",82,0)
 ;
"RTN","ORY2432",83,0)
DATE(X) N %DT,Y S %DT="" D ^%DT Q +Y
"RTN","ORY2432",84,0)
 ;
"RTN","ORY2432",85,0)
DIE(OCXDD,OCXDIC,OCXFLD,OCXVAL,OCXDA,OCXLVL) ;
"RTN","ORY2432",86,0)
 ;
"RTN","ORY2432",87,0)
 N DIC,DIE,X,Y,DR,DA,OCXDVAL,OCXPTR,OCXGREF,D0,OCXSCR
"RTN","ORY2432",88,0)
 S (D0,DA)=OCXDA,(DIC,DIE)=OCXDIC,DR=""
"RTN","ORY2432",89,0)
 S:OCXLVL D0=OCXDA(1),DR="S DA(1)="_(+D0)_",D0="_(+D0)_";"
"RTN","ORY2432",90,0)
 S:OCXVAL="?" OCXVAL="? " S DR=DR_OCXFLD_"///^S X=OCXVAL"
"RTN","ORY2432",91,0)
 I '(OCXVAL="@") W !,?(OCXLVL*5),$$FIELD^OCXSENDD(+OCXDD,OCXFLD,"LABEL"),": ",OCXVAL
"RTN","ORY2432",92,0)
 ;
"RTN","ORY2432",93,0)
 I '(OCXVAL="@") D
"RTN","ORY2432",94,0)
 .N OCXIEN,SHORT
"RTN","ORY2432",95,0)
 .S OCXPTR=+$P($$FIELD^OCXSENDD(+OCXDD,OCXFLD,"SPECIFIER"),"P",2)
"RTN","ORY2432",96,0)
 .Q:'OCXPTR
"RTN","ORY2432",97,0)
 .S OCXGREF="^"_$$FIELD^OCXSENDD(+OCXDD,OCXFLD,"POINTER")
"RTN","ORY2432",98,0)
 .I '($E(OCXGREF,1,4)="^OCX"),'(OCXGREF="^ORD(100.9,"),'(OCXGREF="^ORD(100.8,") Q
"RTN","ORY2432",99,0)
 .Q:$$DIC(OCXGREF,OCXVAL,0)
"RTN","ORY2432",100,0)
 .S OCXIEN=$$DIC(OCXGREF,OCXVAL,1)
"RTN","ORY2432",101,0)
 .S ^TMP("OCXRULE",$J,"B",OCXPTR,OCXVAL,OCXIEN)=""
"RTN","ORY2432",102,0)
 ;
"RTN","ORY2432",103,0)
 S OCXSCR=1
"RTN","ORY2432",104,0)
 D ^DIE
"RTN","ORY2432",105,0)
 ;
"RTN","ORY2432",106,0)
 ; I $D(Y) -> DIE FILER ERROR
"RTN","ORY2432",107,0)
 I $D(Y) W "   ^DIE filer data error..." S OCXDIER=$G(OCXDIER)+1
"RTN","ORY2432",108,0)
 I '$D(Y) W "    ...Correct data Filed"
"RTN","ORY2432",109,0)
 ;
"RTN","ORY2432",110,0)
 Q
"RTN","ORY2432",111,0)
 ;
"RTN","ORY2432",112,0)
DIC(DIC,X,OCXADD) N OCXSCR S DIC(0)="",OCXSCR=1 S:OCXADD DIC(0)="L" D ^DIC Q:(+Y>0) +Y Q 0
"RTN","ORY2432",113,0)
 ;
"RTN","ORY2432",114,0)
PUSH(OCXDA) ;
"RTN","ORY2432",115,0)
 N OCXSUB S OCXSUB="" F  S OCXSUB=$O(OCXDA(OCXSUB),-1) Q:'OCXSUB  S OCXDA(OCXSUB+1)=OCXDA(OCXSUB)
"RTN","ORY2432",116,0)
 S OCXDA(1)=OCXDA,OCXDA=0
"RTN","ORY2432",117,0)
 Q
"RTN","ORY2432",118,0)
 ;
"RTN","ORY2432",119,0)
POP(OCXDA) ;
"RTN","ORY2432",120,0)
 N OCXSUB S OCXSUB="" F  S OCXSUB=$O(OCXDA(OCXSUB)) Q:'OCXSUB  S OCXDA(OCXSUB)=$G(OCXDA(OCXSUB+1))
"RTN","ORY2432",121,0)
 S OCXDA=OCXDA(1) K OCXDA($O(OCXDA(""),-1))
"RTN","ORY2432",122,0)
 Q
"RTN","ORY2432",123,0)
 ;
"RTN","ORY2432",124,0)
APPEND(ARRAY,OCXSUB) ;
"RTN","ORY2432",125,0)
 S:'(OCXSUB=+OCXSUB) OCXSUB=""""_OCXSUB_""""
"RTN","ORY2432",126,0)
 Q:'(ARRAY["(") ARRAY_"("_OCXSUB_")"
"RTN","ORY2432",127,0)
 Q $E(ARRAY,1,$L(ARRAY)-1)_","_OCXSUB_")"
"RTN","ORY2432",128,0)
 ;
"RTN","ORY2432",129,0)
READ(OCXZ0,OCXZA,OCXZB,OCXZL) ;
"RTN","ORY2432",130,0)
 N OCXLINE,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","ORY2432",131,0)
 Q:'$L($G(OCXZ0)) U
"RTN","ORY2432",132,0)
 S DIR(0)=OCXZ0
"RTN","ORY2432",133,0)
 S:$L($G(OCXZA)) DIR("A")=OCXZA
"RTN","ORY2432",134,0)
 S:$L($G(OCXZB)) DIR("B")=OCXZB
"RTN","ORY2432",135,0)
 F OCXLINE=1:1:($G(OCXZL)-1) W !
"RTN","ORY2432",136,0)
 D ^DIR
"RTN","ORY2432",137,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","ORY2432",138,0)
 Q Y
"RTN","ORY2432",139,0)
 ;
"RTN","ORY2432",140,0)
PAUSE() W "  Press Enter " R X:DTIME W ! Q (X[U)
"RTN","ORY2432",141,0)
 ;
"RTN","ORY2433")
0^92^B12996416
"RTN","ORY2433",1,0)
ORY2433 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*243) ;NOV 2,2006 at 12:05
"RTN","ORY2433",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17,1997;Build 242
"RTN","ORY2433",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY2433",4,0)
 ;
"RTN","ORY2433",5,0)
S ;
"RTN","ORY2433",6,0)
 ;  Multiple Utilities
"RTN","ORY2433",7,0)
 Q
"RTN","ORY2433",8,0)
 ;
"RTN","ORY2433",9,0)
ADDMULT(OCXCREF,OCXDD,OCXFLD) ;
"RTN","ORY2433",10,0)
 ;
"RTN","ORY2433",11,0)
 ;
"RTN","ORY2433",12,0)
 N QUIT,OCXDA,OCXGREF,OCXNAME,DDPATH,INDEX
"RTN","ORY2433",13,0)
 ;
"RTN","ORY2433",14,0)
 S DDPATH=$P($P($$APPEND($$APPEND(OCXCREF,OCXDD),OCXFLD),"(",2),")",1)
"RTN","ORY2433",15,0)
 F INDEX=1:1:$L(DDPATH,",") S OCXDA($L(DDPATH,",")-INDEX)=+$P($P(DDPATH,",",INDEX),":",2)
"RTN","ORY2433",16,0)
 S OCXDA=$G(OCXDA(0)) K OCXDA(0)
"RTN","ORY2433",17,0)
 ;
"RTN","ORY2433",18,0)
 Q:(OCXFLAG["D") 0
"RTN","ORY2433",19,0)
 I (OCXFLAG["A") S QUIT=$$READ("Y"," Do you want to add a local '"_$$FILENAME^OCXSENDD(+OCXFLD)_"' multiple ?","YES") Q:'QUIT (QUIT[U)
"RTN","ORY2433",20,0)
 ;
"RTN","ORY2433",21,0)
 S OCXGREF=$$GETREF^ORY2432(+OCXFLD,.OCXDA,1)
"RTN","ORY2433",22,0)
 D CREATE($$APPEND(OCXCREF,OCXDD),OCXFLD,.OCXDA,1)
"RTN","ORY2433",23,0)
 ;
"RTN","ORY2433",24,0)
 Q 0
"RTN","ORY2433",25,0)
 ;
"RTN","ORY2433",26,0)
DELMULT(OCXCREF,OCXDD) ;
"RTN","ORY2433",27,0)
 ;
"RTN","ORY2433",28,0)
 N QUIT,OCXGREF,DA,INDEX,DDPATH
"RTN","ORY2433",29,0)
 ;
"RTN","ORY2433",30,0)
 Q:(OCXFLAG["D") 0
"RTN","ORY2433",31,0)
 I (OCXFLAG["A") S QUIT=$$READ("Y"," Do you want to delete the local '"_$$FILENAME^OCXSENDD(+OCXDD)_"' multiple ?","YES") Q:'QUIT (QUIT[U)
"RTN","ORY2433",32,0)
 ;
"RTN","ORY2433",33,0)
 S DDPATH=$P($P($$APPEND(OCXCREF,OCXDD),"(",2),")",1)
"RTN","ORY2433",34,0)
 F INDEX=1:1:$L(DDPATH,",") S DA($L(DDPATH,",")-INDEX)=+$P($P(DDPATH,",",INDEX),":",2)
"RTN","ORY2433",35,0)
 S DA=$G(DA(0)) K DA(0)
"RTN","ORY2433",36,0)
 S OCXGREF=$$GETREF^ORY2432(+OCXDD,.DA,1)
"RTN","ORY2433",37,0)
 ;
"RTN","ORY2433",38,0)
 D DIE^ORY2432(+OCXDD,OCXGREF,.01,"@",.DA,$L(DDPATH,",")-1)
"RTN","ORY2433",39,0)
 K @OCXCREF@(OCXDD) W !!,"  deleted..."
"RTN","ORY2433",40,0)
 ;
"RTN","ORY2433",41,0)
 Q 0
"RTN","ORY2433",42,0)
 ;
"RTN","ORY2433",43,0)
CREATE(OCXCREF,OCXDD,OCXDA,OCXLVL) ;
"RTN","ORY2433",44,0)
 ;
"RTN","ORY2433",45,0)
 N OCXFLD,OCXGREF
"RTN","ORY2433",46,0)
 ;
"RTN","ORY2433",47,0)
 S OCXGREF=$$GETREF^ORY2432(+OCXDD,.OCXDA,OCXLVL) Q:'$L(OCXGREF)  S:'OCXDA OCXDA=$O(@(OCXGREF_"""@"")"),-1)+1
"RTN","ORY2433",48,0)
 ;
"RTN","ORY2433",49,0)
 I '$D(@(OCXGREF_"0)")) S @(OCXGREF_"0)")=U_$$FILEHDR^OCXSENDD(+OCXDD)_U_U
"RTN","ORY2433",50,0)
 ;
"RTN","ORY2433",51,0)
 S OCXFLD=0 F  S OCXFLD=$O(@OCXCREF@(OCXDD,OCXFLD)) Q:'OCXFLD  Q:(OCXFLD[":")  I '$$EXFLD^ORY2431(+OCXDD,OCXFLD) D
"RTN","ORY2433",52,0)
 .I $L($G(@OCXCREF@(OCXDD,OCXFLD,"E"))) D DIE^ORY2432(OCXDD,OCXGREF,OCXFLD,@OCXCREF@(OCXDD,OCXFLD,"E"),.OCXDA,OCXLVL)
"RTN","ORY2433",53,0)
 ;
"RTN","ORY2433",54,0)
 D PUSH(.OCXDA)
"RTN","ORY2433",55,0)
 S OCXFLD="" F  S OCXFLD=$O(@OCXCREF@(OCXDD,OCXFLD)) Q:'$L(OCXFLD)  I (OCXFLD[":") D
"RTN","ORY2433",56,0)
 .S OCXDA=$P(OCXFLD,":",2) W ! D CREATE($$APPEND(OCXCREF,OCXDD),OCXFLD,.OCXDA,OCXLVL+1)
"RTN","ORY2433",57,0)
 D POP(.OCXDA)
"RTN","ORY2433",58,0)
 Q
"RTN","ORY2433",59,0)
 ;
"RTN","ORY2433",60,0)
PUSH(OCXDA) ;
"RTN","ORY2433",61,0)
 N OCXSUB S OCXSUB="" F  S OCXSUB=$O(OCXDA(OCXSUB),-1) Q:'OCXSUB  S OCXDA(OCXSUB+1)=OCXDA(OCXSUB)
"RTN","ORY2433",62,0)
 S OCXDA(1)=OCXDA,OCXDA=0
"RTN","ORY2433",63,0)
 Q
"RTN","ORY2433",64,0)
 ;
"RTN","ORY2433",65,0)
POP(OCXDA) ;
"RTN","ORY2433",66,0)
 N OCXSUB S OCXSUB="" F  S OCXSUB=$O(OCXDA(OCXSUB)) Q:'OCXSUB  S OCXDA(OCXSUB)=$G(OCXDA(OCXSUB+1))
"RTN","ORY2433",67,0)
 S OCXDA=OCXDA(1) K OCXDA($O(OCXDA(""),-1))
"RTN","ORY2433",68,0)
 Q
"RTN","ORY2433",69,0)
 ;
"RTN","ORY2433",70,0)
APPEND(ARRAY,OCXSUB) ;
"RTN","ORY2433",71,0)
 S:'(OCXSUB=+OCXSUB) OCXSUB=""""_OCXSUB_""""
"RTN","ORY2433",72,0)
 Q:'(ARRAY["(") ARRAY_"("_OCXSUB_")"
"RTN","ORY2433",73,0)
 Q $E(ARRAY,1,$L(ARRAY)-1)_","_OCXSUB_")"
"RTN","ORY2433",74,0)
 ;
"RTN","ORY2433",75,0)
READ(OCXZ0,OCXZA,OCXZB,OCXZL) ;
"RTN","ORY2433",76,0)
 N OCXLINE,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","ORY2433",77,0)
 Q:'$L($G(OCXZ0)) U
"RTN","ORY2433",78,0)
 S DIR(0)=OCXZ0
"RTN","ORY2433",79,0)
 S:$L($G(OCXZA)) DIR("A")=OCXZA
"RTN","ORY2433",80,0)
 S:$L($G(OCXZB)) DIR("B")=OCXZB
"RTN","ORY2433",81,0)
 F OCXLINE=1:1:($G(OCXZL)-1) W !
"RTN","ORY2433",82,0)
 D ^DIR
"RTN","ORY2433",83,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","ORY2433",84,0)
 Q Y
"RTN","ORY2433",85,0)
 ;
"RTN","ORY2433",86,0)
PAUSE() W "  Press Enter " R X:DTIME W ! Q (X[U)
"RTN","ORY2433",87,0)
 ;
"RTN","ORY2434")
0^93^B13526318
"RTN","ORY2434",1,0)
ORY2434 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*243) ;NOV 2,2006 at 12:05
"RTN","ORY2434",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17,1997;Build 242
"RTN","ORY2434",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY2434",4,0)
 ;
"RTN","ORY2434",5,0)
S ;
"RTN","ORY2434",6,0)
 ;  Field Utilities
"RTN","ORY2434",7,0)
 Q
"RTN","ORY2434",8,0)
 ;
"RTN","ORY2434",9,0)
EDITFLD(OCXCREF,OCXDD,OCXFLD,OCXSUB) ;
"RTN","ORY2434",10,0)
 ;
"RTN","ORY2434",11,0)
 N DDPATH,OCXDA,OCXPC,OCXLVL,QUIT
"RTN","ORY2434",12,0)
 ;
"RTN","ORY2434",13,0)
 S QUIT=0,DDPATH=$P($P($$APPEND(OCXCREF,OCXDD),"(",2),")",1)
"RTN","ORY2434",14,0)
 S OCXLVL=$L(DDPATH,",")
"RTN","ORY2434",15,0)
 F OCXPC=1:1:OCXLVL S OCXDA(OCXLVL-OCXPC)=+$P($P(DDPATH,",",OCXPC),":",2)
"RTN","ORY2434",16,0)
 S OCXDA=OCXDA(0) K OCXDA(0)
"RTN","ORY2434",17,0)
 I $L($G(@OCXCREF@(OCXDD,OCXFLD,"E"))) D
"RTN","ORY2434",18,0)
 .N RESP
"RTN","ORY2434",19,0)
 .Q:(OCXFLAG["D")
"RTN","ORY2434",20,0)
 .I (OCXFLAG["A") S RESP=$$READ("Y"," Do you want to change the local '"_$$FILENAME^OCXSENDD(+OCXDD)_"' field ?","YES") I 'RESP S QUIT=(RESP[U) Q
"RTN","ORY2434",21,0)
 .S OCXGREF=$$GETREF^ORY2432(+OCXDD,.OCXDA,OCXLVL-1) Q:'$L(OCXGREF)
"RTN","ORY2434",22,0)
 .D DIE^ORY2432(OCXDD,OCXGREF,OCXFLD,@OCXCREF@(OCXDD,OCXFLD,"E"),.OCXDA,OCXLVL-1)
"RTN","ORY2434",23,0)
 ;
"RTN","ORY2434",24,0)
 Q QUIT
"RTN","ORY2434",25,0)
 ;
"RTN","ORY2434",26,0)
DELFLD(OCXCREF,OCXDD,OCXFLD,OCXSUB) ;
"RTN","ORY2434",27,0)
 ;
"RTN","ORY2434",28,0)
 N DDPATH,OCXDA,OCXPC,OCXLVL,QUIT,RESP
"RTN","ORY2434",29,0)
 ;
"RTN","ORY2434",30,0)
 S QUIT=0,DDPATH=$P($P($$APPEND(OCXCREF,OCXDD),"(",2),")",1)
"RTN","ORY2434",31,0)
 S OCXLVL=$L(DDPATH,",")
"RTN","ORY2434",32,0)
 F OCXPC=1:1:OCXLVL S OCXDA(OCXLVL-OCXPC)=+$P($P(DDPATH,",",OCXPC),":",2)
"RTN","ORY2434",33,0)
 S OCXDA=OCXDA(0) K OCXDA(0)
"RTN","ORY2434",34,0)
 Q:(OCXFLAG["D") 0
"RTN","ORY2434",35,0)
 I (OCXFLAG["A") S RESP=$$READ("Y"," Do you want to Delete the local '"_$$FILENAME^OCXSENDD(+OCXDD)_"' value ?","YES") I 'RESP S QUIT=(RESP[U) Q QUIT
"RTN","ORY2434",36,0)
 S OCXGREF=$$GETREF^ORY2432(+OCXDD,.OCXDA,OCXLVL-1) Q:'$L(OCXGREF)
"RTN","ORY2434",37,0)
 D DIE^ORY2432(OCXDD,OCXGREF,OCXFLD,"@",.OCXDA,OCXLVL-1)
"RTN","ORY2434",38,0)
 ;
"RTN","ORY2434",39,0)
 Q QUIT
"RTN","ORY2434",40,0)
 ;
"RTN","ORY2434",41,0)
CREATE(OCXCREF,OCXDD,OCXDA,OCXLVL) ;
"RTN","ORY2434",42,0)
 ;
"RTN","ORY2434",43,0)
 N OCXFLD,OCXGREF
"RTN","ORY2434",44,0)
 ;
"RTN","ORY2434",45,0)
 S OCXGREF=$$GETREF^ORY2432(+OCXDD,.OCXDA,OCXLVL) Q:'$L(OCXGREF)  S:'OCXDA OCXDA=$O(@(OCXGREF_"""@"")"),-1)+1
"RTN","ORY2434",46,0)
 ;
"RTN","ORY2434",47,0)
 I '$D(@(OCXGREF_"0)")) S @(OCXGREF_"0)")=U_$$FILEHDR^OCXSENDD(+OCXDD)_U_U
"RTN","ORY2434",48,0)
 ;
"RTN","ORY2434",49,0)
 S OCXFLD=0 F  S OCXFLD=$O(@OCXCREF@(OCXDD,OCXFLD)) Q:'OCXFLD  Q:(OCXFLD[":")  I '$$EXFLD^ORY2431(+OCXDD,OCXFLD) D
"RTN","ORY2434",50,0)
 .I $L($G(@OCXCREF@(OCXDD,OCXFLD,"E"))) D DIE^ORY2432(OCXDD,OCXGREF,OCXFLD,@OCXCREF@(OCXDD,OCXFLD,"E"),.OCXDA,OCXLVL)
"RTN","ORY2434",51,0)
 ;
"RTN","ORY2434",52,0)
 D PUSH(.OCXDA)
"RTN","ORY2434",53,0)
 S OCXFLD="" F  S OCXFLD=$O(@OCXCREF@(OCXDD,OCXFLD)) Q:'$L(OCXFLD)  I (OCXFLD[":") D
"RTN","ORY2434",54,0)
 .S OCXDA=$P(OCXFLD,":",2) W ! D CREATE($$APPEND(OCXCREF,OCXDD),OCXFLD,.OCXDA,OCXLVL+1)
"RTN","ORY2434",55,0)
 D POP(.OCXDA)
"RTN","ORY2434",56,0)
 Q
"RTN","ORY2434",57,0)
 ;
"RTN","ORY2434",58,0)
PUSH(OCXDA) ;
"RTN","ORY2434",59,0)
 N OCXSUB S OCXSUB="" F  S OCXSUB=$O(OCXDA(OCXSUB),-1) Q:'OCXSUB  S OCXDA(OCXSUB+1)=OCXDA(OCXSUB)
"RTN","ORY2434",60,0)
 S OCXDA(1)=OCXDA,OCXDA=0
"RTN","ORY2434",61,0)
 Q
"RTN","ORY2434",62,0)
 ;
"RTN","ORY2434",63,0)
POP(OCXDA) ;
"RTN","ORY2434",64,0)
 N OCXSUB S OCXSUB="" F  S OCXSUB=$O(OCXDA(OCXSUB)) Q:'OCXSUB  S OCXDA(OCXSUB)=$G(OCXDA(OCXSUB+1))
"RTN","ORY2434",65,0)
 S OCXDA=OCXDA(1) K OCXDA($O(OCXDA(""),-1))
"RTN","ORY2434",66,0)
 Q
"RTN","ORY2434",67,0)
 ;
"RTN","ORY2434",68,0)
APPEND(ARRAY,OCXSUB) ;
"RTN","ORY2434",69,0)
 S:'(OCXSUB=+OCXSUB) OCXSUB=""""_OCXSUB_""""
"RTN","ORY2434",70,0)
 Q:'(ARRAY["(") ARRAY_"("_OCXSUB_")"
"RTN","ORY2434",71,0)
 Q $E(ARRAY,1,$L(ARRAY)-1)_","_OCXSUB_")"
"RTN","ORY2434",72,0)
 ;
"RTN","ORY2434",73,0)
READ(OCXZ0,OCXZA,OCXZB,OCXZL) ;
"RTN","ORY2434",74,0)
 N OCXLINE,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","ORY2434",75,0)
 Q:'$L($G(OCXZ0)) U
"RTN","ORY2434",76,0)
 S DIR(0)=OCXZ0
"RTN","ORY2434",77,0)
 S:$L($G(OCXZA)) DIR("A")=OCXZA
"RTN","ORY2434",78,0)
 S:$L($G(OCXZB)) DIR("B")=OCXZB
"RTN","ORY2434",79,0)
 F OCXLINE=1:1:($G(OCXZL)-1) W !
"RTN","ORY2434",80,0)
 D ^DIR
"RTN","ORY2434",81,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","ORY2434",82,0)
 Q Y
"RTN","ORY2434",83,0)
 ;
"RTN","ORY2434",84,0)
PAUSE() W "  Press Enter " R X:DTIME W ! Q (X[U)
"RTN","ORY2434",85,0)
 ;
"RTN","ORY243A")
0^208^B4754803
"RTN","ORY243A",1,0)
ORY243A ;SLCOIFO - Pre and Post-init for patch OR*3*243 ;4/25/07  14:12
"RTN","ORY243A",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORY243A",3,0)
 ;
"RTN","ORY243A",4,0)
INPQCONV ;
"RTN","ORY243A",5,0)
 N DA,DIE,DR,INPDG,TEXT,TYPE,UDDG,X0
"RTN","ORY243A",6,0)
 S TEXT(1)="Converting Inpatient Medications Quick Orders to"
"RTN","ORY243A",7,0)
 S TEXT(2)="Unit Dose Medications Quick Orders."
"RTN","ORY243A",8,0)
 D MES^XPDUTL(.TEXT)
"RTN","ORY243A",9,0)
 S UDDG=$O(^ORD(100.98,"B","UNIT DOSE MEDICATIONS","")) Q:UDDG'>0
"RTN","ORY243A",10,0)
 S INPDG=$O(^ORD(100.98,"B","INPATIENT MEDICATIONS","")) Q:INPDG'>0
"RTN","ORY243A",11,0)
 S DIE="^ORD(101.41,"
"RTN","ORY243A",12,0)
 S DA=0 F  S DA=$O(^ORD(101.41,DA)) Q:DA'>0  D
"RTN","ORY243A",13,0)
 . S X0=$G(^ORD(101.41,DA,0))
"RTN","ORY243A",14,0)
 .I $P(X0,U,4)="Q",$P(X0,U,5)=INPDG D
"RTN","ORY243A",15,0)
 ..S DR="5///^S X=UDDG" D ^DIE
"RTN","ORY243A",16,0)
 Q
"RTN","ORY243A",17,0)
 ;
"RTN","ORY243A",18,0)
IVORCON ;
"RTN","ORY243A",19,0)
 N ZTDESC,ZTDTH,ZTRTN,ZTSAVE,ZTIO,TEXT,ZTSK
"RTN","ORY243A",20,0)
 S ZTDESC="Delayed IV Order conversion"
"RTN","ORY243A",21,0)
 S TEXT=ZTDESC_" has been queued, task number "
"RTN","ORY243A",22,0)
 S ZTRTN="IVORCONQ^ORY243A"
"RTN","ORY243A",23,0)
 S ZTIO=""
"RTN","ORY243A",24,0)
 S ZTDTH=$$NOW^XLFDT
"RTN","ORY243A",25,0)
 D ^%ZTLOAD
"RTN","ORY243A",26,0)
 I $D(ZTSK) S TEXT=TEXT_ZTSK D MES^XPDUTL(.TEXT)
"RTN","ORY243A",27,0)
 Q
"RTN","ORY243A",28,0)
 ;
"RTN","ORY243A",29,0)
IVORCONQ ;
"RTN","ORY243A",30,0)
 ;This code convert pre CPRS 27 delayed IV orders to a new order.
"RTN","ORY243A",31,0)
 N DELSTAT,EVNT,FDA,MSG,IVDIAL,NODE,PAT,ORIEN
"RTN","ORY243A",32,0)
 S IVDIAL=$O(^ORD(101.41,"B","PSJI OR PAT FLUID OE","")) Q:IVDIAL'>0
"RTN","ORY243A",33,0)
 S DELSTAT=$O(^ORD(100.01,"B","DELAYED","")) Q:DELSTAT'>0
"RTN","ORY243A",34,0)
 S PAT="" F  S PAT=$O(^OR(100,"AEVNT",PAT)) Q:PAT=""  D
"RTN","ORY243A",35,0)
 .S EVNT="" F  S EVNT=$O(^OR(100,"AEVNT",PAT,EVNT)) Q:EVNT=""  D
"RTN","ORY243A",36,0)
 ..S ORIEN="" F  S ORIEN=$O(^OR(100,"AEVNT",PAT,EVNT,ORIEN)) Q:ORIEN=""  D
"RTN","ORY243A",37,0)
 ...S NODE=$G(^OR(100,ORIEN,0))
"RTN","ORY243A",38,0)
 ...I +$P(NODE,U,5)'=IVDIAL Q
"RTN","ORY243A",39,0)
 ...I $P($G(^OR(100,ORIEN,3)),U,3)'=DELSTAT Q
"RTN","ORY243A",40,0)
 ...I $D(^OR(100,ORIEN,4.5,"ID","TYPE"))>0 Q
"RTN","ORY243A",41,0)
 ...S FDA(100.045,"+2,"_ORIEN_",",.01)=20
"RTN","ORY243A",42,0)
 ...S FDA(100.045,"+2,"_ORIEN_",",.02)="OR GTX IV TYPE"
"RTN","ORY243A",43,0)
 ...S FDA(100.045,"+2,"_ORIEN_",",.03)=1
"RTN","ORY243A",44,0)
 ...S FDA(100.045,"+2,"_ORIEN_",",.04)="TYPE"
"RTN","ORY243A",45,0)
 ...S FDA(100.045,"+2,"_ORIEN_",",1)="C"
"RTN","ORY243A",46,0)
 ...D UPDATE^DIE("E","FDA","","MSG")
"RTN","ORY243A",47,0)
 Q
"RTN","ORY243A",48,0)
 ;
"RTN","ORY243ES")
0^88^B12630447
"RTN","ORY243ES",1,0)
ORY243ES ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*243) ;NOV 2,2006 at 12:05
"RTN","ORY243ES",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17,1997;Build 242
"RTN","ORY243ES",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY243ES",4,0)
 ;
"RTN","ORY243ES",5,0)
S ;
"RTN","ORY243ES",6,0)
 ;
"RTN","ORY243ES",7,0)
 N OCXDIER,QUIT,LINE,TEXT,REMOTE,LOCAL,D0,OPCODE,REF,OCXFLAG S QUIT=0
"RTN","ORY243ES",8,0)
 N OCXAUTO,OCZSCR
"RTN","ORY243ES",9,0)
 ;
"RTN","ORY243ES",10,0)
 D DOT
"RTN","ORY243ES",11,0)
 I $L($T(VERSION^OCXOCMP)),($$VERSION^OCXOCMP="ORDER CHECK EXPERT version 1.01 released OCT 29,1998"),1
"RTN","ORY243ES",12,0)
 E  D  Q
"RTN","ORY243ES",13,0)
 .W !
"RTN","ORY243ES",14,0)
 .W !,"Rule Transport aborted, version mismatch."
"RTN","ORY243ES",15,0)
 .W !,"Current Local version: ",$$VERSION^OCXOCMP
"RTN","ORY243ES",16,0)
 .W !,"   Rule Transport Version: ORDER CHECK EXPERT version 1.01 released OCT 29,1998"
"RTN","ORY243ES",17,0)
 I '$D(DTIME) W !!,"DTIME not defined !!",!! Q
"RTN","ORY243ES",18,0)
 W !!,"Order Check Expert System Rule Transporter"
"RTN","ORY243ES",19,0)
 W !," Created: NOV 2,2006 at 12:05  at  CPRS27.FO-SLC.MED.VA.GOV"
"RTN","ORY243ES",20,0)
 W !," Current Date: ",$$NOW^ORY2430,"  at  ",$$NETNAME^OCXSEND,!!
"RTN","ORY243ES",21,0)
 S LASTFILE=0 K ^TMP("OCXRULE",$J)
"RTN","ORY243ES",22,0)
 S ^TMP("OCXRULE",$J)=($P($H,",",2)+($H*86400)+(1*60*60))_" <- ^TMP ENTRY EXPIRATION DATE FOR ^OCXOPURG"
"RTN","ORY243ES",23,0)
 S OCXFLAG="O"
"RTN","ORY243ES",24,0)
 ;
"RTN","ORY243ES",25,0)
RUN ;
"RTN","ORY243ES",26,0)
 ;
"RTN","ORY243ES",27,0)
 W !,"Loading Data " D ^ORY24301
"RTN","ORY243ES",28,0)
 ;
"RTN","ORY243ES",29,0)
 S LINE=0 F  S LINE=$O(^TMP("OCXRULE",$J,LINE)) Q:'LINE   D  Q:QUIT
"RTN","ORY243ES",30,0)
 .D:'(LINE#50) STATUS^OCXOPOST(LINE,$O(^TMP("OCXRULE",$J," "),-1))
"RTN","ORY243ES",31,0)
 .S TEXT=$G(^TMP("OCXRULE",$J,LINE)) I $L(TEXT) D  Q:QUIT
"RTN","ORY243ES",32,0)
 ..S TEXT=$P(TEXT,";",2,999),OPCODE=$P(TEXT,U,1),TEXT=$P(TEXT,U,2,999)
"RTN","ORY243ES",33,0)
 ..;
"RTN","ORY243ES",34,0)
 ..I OPCODE="KEY" D DOT S LOCAL="",D0=$$GETFILE^ORY2430(+$P(TEXT,U,1),$P(TEXT,U,2),.LOCAL) S QUIT=(D0=(-10)) Q
"RTN","ORY243ES",35,0)
 ..I OPCODE="R" S REF="REMOTE("_$P(TEXT,":",1)_":"_D0_$P(TEXT,":",2,99)_")" Q
"RTN","ORY243ES",36,0)
 ..I OPCODE="D",$D(REF) S @REF=$P(TEXT,U,1,999) K REF Q
"RTN","ORY243ES",37,0)
 ..;
"RTN","ORY243ES",38,0)
 ..I OPCODE="EOR" S QUIT=$$COMPARE^ORY2431(.LOCAL,.REMOTE) K LOCAL,REMOTE Q
"RTN","ORY243ES",39,0)
 ..I OPCODE="EOF" K LOCAL,REMOTE Q
"RTN","ORY243ES",40,0)
 ..I OPCODE="SOF" W !,"  Installing '",TEXT,"' records... " Q
"RTN","ORY243ES",41,0)
 ..I OPCODE="ROOT" D  Q
"RTN","ORY243ES",42,0)
 ...N FILE,DATA
"RTN","ORY243ES",43,0)
 ...S FILE=U_$P(TEXT,U,1),DATA=$P(TEXT,U,2,3)
"RTN","ORY243ES",44,0)
 ...I ($P($G(@FILE),U,1,2)=DATA) Q
"RTN","ORY243ES",45,0)
 ...S $P(@FILE,U,1,2)=DATA
"RTN","ORY243ES",46,0)
 ...W !,"  Restoring file #",(+$P(DATA,U,2))," zero node"
"RTN","ORY243ES",47,0)
 ..;
"RTN","ORY243ES",48,0)
 ..W !,"Unknown OpCode: ",OPCODE,"  in: ",TEXT S QUIT=$$PAUSE^ORY2430 W !
"RTN","ORY243ES",49,0)
 ;
"RTN","ORY243ES",50,0)
 K ^TMP("OCXRULE",$J)
"RTN","ORY243ES",51,0)
 ;
"RTN","ORY243ES",52,0)
 I $D(^OCXS) D
"RTN","ORY243ES",53,0)
 .N FILE,DO,PD0,CNT
"RTN","ORY243ES",54,0)
 .S FILE=0 F  S FILE=$O(^OCXS(FILE)) Q:'FILE  D
"RTN","ORY243ES",55,0)
 ..S D0=0 F CNT=0:1 S PD0=D0,D0=$O(^OCXS(FILE,D0)) Q:'D0
"RTN","ORY243ES",56,0)
 ..S $P(^OCXS(FILE,0),U,3,4)=CNT_U_PD0
"RTN","ORY243ES",57,0)
 ;
"RTN","ORY243ES",58,0)
 I $G(OCXDIER) D
"RTN","ORY243ES",59,0)
 .W !!!!!!!
"RTN","ORY243ES",60,0)
 .W !,?5,"******************** Warning ******************** "
"RTN","ORY243ES",61,0)
 .W !,?7,+$G(OCXDIER)," data filing error",$S(($G(OCXDIER)=1):"",1:"s"),"."
"RTN","ORY243ES",62,0)
 .W !,?7,"Some expert system rules may be incomplete."
"RTN","ORY243ES",63,0)
 .W !,?5,"******************** Warning ******************** "
"RTN","ORY243ES",64,0)
 I '$G(OCXDIER) W !!,?5," No data filing errors."
"RTN","ORY243ES",65,0)
 W !!,"Transport Finished..."
"RTN","ORY243ES",66,0)
 ;
"RTN","ORY243ES",67,0)
 D
"RTN","ORY243ES",68,0)
 .N OCXOETIM
"RTN","ORY243ES",69,0)
 .D BMES^XPDUTL("---Creating Order Check Routines-----------------------------------")
"RTN","ORY243ES",70,0)
 .D AUTO^OCXOCMP
"RTN","ORY243ES",71,0)
 ;
"RTN","ORY243ES",72,0)
 Q
"RTN","ORY243ES",73,0)
 ;
"RTN","ORY243ES",74,0)
DOT Q:$G(OCXAUTO)  W:($X>70) ! W " ." Q
"RTN","ORY243ES",75,0)
 ;
"RTN","ORY243ES",76,0)
READ(OCXZ0,OCXZA,OCXZB,OCXZL) ;
"RTN","ORY243ES",77,0)
 N OCXLINE,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","ORY243ES",78,0)
 Q:'$L($G(OCXZ0)) U
"RTN","ORY243ES",79,0)
 S DIR(0)=OCXZ0
"RTN","ORY243ES",80,0)
 S:$L($G(OCXZA)) DIR("A")=OCXZA
"RTN","ORY243ES",81,0)
 S:$L($G(OCXZB)) DIR("B")=OCXZB
"RTN","ORY243ES",82,0)
 F OCXLINE=1:1:($G(OCXZL)-1) W !
"RTN","ORY243ES",83,0)
 D ^DIR
"RTN","ORY243ES",84,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","ORY243ES",85,0)
 Q Y
"RTN","ORY243ES",86,0)
 ;
"RTN","ORY243R")
0^209^B5847434
"RTN","ORY243R",1,0)
ORY243R  ;SLCOIFO - Pre and Post-init for patch OR*3*243 ;4/25/07  14:12
"RTN","ORY243R",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**243**;Dec 17, 1997;Build 242
"RTN","ORY243R",3,0)
 ;
"RTN","ORY243R",4,0)
 ; DBIA 2336   EN^XPAR   ^TMP($J,"XPARRSTR")
"RTN","ORY243R",5,0)
 ;
"RTN","ORY243R",6,0)
PARAM ; DO NOT REMOVE WITH VBECS - main (initial) parameter transport routine
"RTN","ORY243R",7,0)
 K ^TMP($J,"XPARRSTR")
"RTN","ORY243R",8,0)
 N ENT,IDX,ROOT,REF,VAL,I
"RTN","ORY243R",9,0)
 S ROOT=$NAME(^TMP($J,"XPARRSTR")),ROOT=$E(ROOT,1,$L(ROOT)-1)_","  ;DBIA 2336
"RTN","ORY243R",10,0)
 D LOAD
"RTN","ORY243R",11,0)
XX2 S IDX=0,ENT="PKG."_"ORDER ENTRY/RESULTS REPORTING"
"RTN","ORY243R",12,0)
 F  S IDX=$O(^TMP($J,"XPARRSTR",IDX)) Q:'IDX  D
"RTN","ORY243R",13,0)
 . N PAR,INST,ORVAL,ORERR K ORVAL
"RTN","ORY243R",14,0)
 . S PAR=$P(^TMP($J,"XPARRSTR",IDX,"KEY"),U),INST=$P(^("KEY"),U,2)
"RTN","ORY243R",15,0)
 . M ORVAL=^TMP($J,"XPARRSTR",IDX,"VAL")
"RTN","ORY243R",16,0)
 . D EN^XPAR(ENT,PAR,INST,.ORVAL,.ORERR)  ;DBIA 2336
"RTN","ORY243R",17,0)
 K ^TMP($J,"XPARRSTR")
"RTN","ORY243R",18,0)
 Q
"RTN","ORY243R",19,0)
LOAD ; load data into ^TMP (expects ROOT to be defined)
"RTN","ORY243R",20,0)
 S I=1 F  S REF=$T(DATA+I) Q:REF=""  S VAL=$T(DATA+I+1) D
"RTN","ORY243R",21,0)
 . S I=I+2,REF=$P(REF,";",3,999),VAL=$P(VAL,";",3,999)
"RTN","ORY243R",22,0)
 . S @(ROOT_REF)=VAL
"RTN","ORY243R",23,0)
 Q
"RTN","ORY243R",24,0)
 ;
"RTN","ORY243R",25,0)
DATA ; parameter data
"RTN","ORY243R",26,0)
 ;;7240,"KEY")
"RTN","ORY243R",27,0)
 ;;ORB ARCHIVE PERIOD^MEDICATIONS EXPIRING - OUTPT
"RTN","ORY243R",28,0)
 ;;7240,"VAL")
"RTN","ORY243R",29,0)
 ;;30
"RTN","ORY243R",30,0)
 ;;7241,"KEY")
"RTN","ORY243R",31,0)
 ;;ORB DELETE MECHANISM^MEDICATIONS EXPIRING - OUTPT
"RTN","ORY243R",32,0)
 ;;7241,"VAL")
"RTN","ORY243R",33,0)
 ;;All Recipients
"RTN","ORY243R",34,0)
 ;;7242,"KEY")
"RTN","ORY243R",35,0)
 ;;ORB FORWARD BACKUP REVIEWER^MEDICATIONS EXPIRING - OUTPT
"RTN","ORY243R",36,0)
 ;;7242,"VAL")
"RTN","ORY243R",37,0)
 ;;0
"RTN","ORY243R",38,0)
 ;;7243,"KEY")
"RTN","ORY243R",39,0)
 ;;ORB FORWARD SUPERVISOR^MEDICATIONS EXPIRING - OUTPT
"RTN","ORY243R",40,0)
 ;;7243,"VAL")
"RTN","ORY243R",41,0)
 ;;0
"RTN","ORY243R",42,0)
 ;;7244,"KEY")
"RTN","ORY243R",43,0)
 ;;ORB FORWARD SURROGATES^MEDICATIONS EXPIRING - OUTPT
"RTN","ORY243R",44,0)
 ;;7244,"VAL")
"RTN","ORY243R",45,0)
 ;;0
"RTN","ORY243R",46,0)
 ;;7245,"KEY")
"RTN","ORY243R",47,0)
 ;;ORB PROCESSING FLAG^MEDICATIONS EXPIRING - OUTPT
"RTN","ORY243R",48,0)
 ;;7245,"VAL")
"RTN","ORY243R",49,0)
 ;;Disabled
"RTN","ORY243R",50,0)
 ;;7246,"KEY")
"RTN","ORY243R",51,0)
 ;;ORB PROVIDER RECIPIENTS^MEDICATIONS EXPIRING - OUTPT
"RTN","ORY243R",52,0)
 ;;7246,"VAL")
"RTN","ORY243R",53,0)
 ;;OAPT
"RTN","ORY243R",54,0)
 ;;7247,"KEY")
"RTN","ORY243R",55,0)
 ;;ORB URGENCY^MEDICATIONS EXPIRING - OUTPT
"RTN","ORY243R",56,0)
 ;;7247,"VAL")
"RTN","ORY243R",57,0)
 ;;High
"RTN","ORY243R",58,0)
 ;;6064,"KEY")
"RTN","ORY243R",59,0)
 ;;ORWOR EXPIRED ORDERS^1
"RTN","ORY243R",60,0)
 ;;6064,"VAL")
"RTN","ORY243R",61,0)
 ;;72
"RTN","ORY243R",62,0)
 ;;11559,"KEY")
"RTN","ORY243R",63,0)
 ;;ORWLR LC CHANGED TO WC^1
"RTN","ORY243R",64,0)
 ;;11559,"VAL")
"RTN","ORY243R",65,0)
 ;;Please contact the ward staff to insure the specimen is collected.
"RTN","ORY243R",66,0)
 ;;11560,"KEY")
"RTN","ORY243R",67,0)
 ;;OR VBECS SUPPRESS NURS ADMIN
"RTN","ORY243R",68,0)
 ;;11560,"VAL")
"RTN","ORY243R",69,0)
 ;;0
"RTN","ORYDLG")
0^48^B14515305
"RTN","ORYDLG",1,0)
ORYDLG ;SLC/MKB -- Postinit bulletin for order dialogs ;7/28/04  08:18
"RTN","ORYDLG",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141,165,216,243**;Dec 17, 1997;Build 242
"RTN","ORYDLG",3,0)
 ;
"RTN","ORYDLG",4,0)
EN(PATCH,ORDLG,USERS) ; -- look for local copies of ORDLG(NAME) by package,
"RTN","ORYDLG",5,0)
 ;    send list in bulletin to DUZ, POSTMASTER, USERS(DUZ) when done
"RTN","ORYDLG",6,0)
 ;
"RTN","ORYDLG",7,0)
 Q:$O(ORDLG(""))=""  ;none
"RTN","ORYDLG",8,0)
 N ORZ,ORI,X,NM,I,OR0,PKG,DG,ORPKG,ORNATL,DLG,CNT,LR,PS
"RTN","ORYDLG",9,0)
 S ORZ(1)="The following nationally exported order dialogs have been modified by"
"RTN","ORYDLG",10,0)
 S X="this patch:   ",ORI=1,NM="" F  S NM=$O(ORDLG(NM)) Q:NM=""  D
"RTN","ORYDLG",11,0)
 . S ORI=ORI+1,ORZ(ORI)=X_NM,X="              "
"RTN","ORYDLG",12,0)
 . S I=+$O(^ORD(101.41,"AB",NM,0)),OR0=$G(^ORD(101.41,I,0))
"RTN","ORYDLG",13,0)
 . S PKG=+$P(OR0,U,7),DG=+$P(OR0,U,5) S:PKG ORPKG(PKG,DG)=""
"RTN","ORYDLG",14,0)
 . S:$P(NM," ")="LR" LR=1 S:"^PS^PSJ^PSO^PSH^"[(U_$P(NM," ")_U) PS=1
"RTN","ORYDLG",15,0)
 D:$G(LR) LR D:$G(PS) PS ;reset FORMAT codes in changed dialogs
"RTN","ORYDLG",16,0)
 S I=0 F I=1:1 S X=$T(NATL+I) Q:X["ZZZZZ"  S ORNATL($P(X,";",3))=""
"RTN","ORYDLG",17,0)
 S ORI=ORI+1,ORZ(ORI)="Please review and compare the following locally created order dialogs"
"RTN","ORYDLG",18,0)
 S ORI=ORI+1,ORZ(ORI)="that may be copies, for any necessary changes:",CNT=0
"RTN","ORYDLG",19,0)
 S PKG=0 F  S PKG=$O(ORPKG(PKG)) Q:PKG<1  S DLG=0 D
"RTN","ORYDLG",20,0)
 . F  S DLG=+$O(^ORD(101.41,"APKG",PKG,DLG)) Q:DLG<1  D
"RTN","ORYDLG",21,0)
 .. S OR0=$G(^ORD(101.41,DLG,0))  Q:$P(OR0,U,4)'="D"
"RTN","ORYDLG",22,0)
 .. Q:'$D(ORPKG(PKG,+$P(OR0,U,5)))  ;included DispGrp
"RTN","ORYDLG",23,0)
 .. Q:$D(ORNATL($P(OR0,U)))  S CNT=CNT+1
"RTN","ORYDLG",24,0)
 .. S ORI=ORI+1,ORZ(ORI)=$J(DLG,7)_"  "_$P(OR0,U)
"RTN","ORYDLG",25,0)
EN1 I CNT>0 D  ;local copies found -> send bulletin
"RTN","ORYDLG",26,0)
 . N XMDUZ,XMY,I,XMSUB,XMTEXT,DIFROM
"RTN","ORYDLG",27,0)
 . S XMDUZ="PATCH OR*3*"_$G(PATCH)_" POSTINIT",XMY(.5)=""
"RTN","ORYDLG",28,0)
 . S:$G(DUZ) XMY(DUZ)="" S I=0 F  S I=$O(USERS(I)) Q:I<1  S XMY(I)=""
"RTN","ORYDLG",29,0)
 . S XMSUB=XMDUZ_" COMPLETED",XMTEXT="ORZ(" D ^XMD
"RTN","ORYDLG",30,0)
 . D BMES^XPDUTL("Some national order dialogs have been modified in this patch;")
"RTN","ORYDLG",31,0)
 . D MES^XPDUTL("a bulletin has been sent to the installer listing local copies that")
"RTN","ORYDLG",32,0)
 . D MES^XPDUTL("may need to be reviewed and updated.")
"RTN","ORYDLG",33,0)
 Q
"RTN","ORYDLG",34,0)
 ;
"RTN","ORYDLG",35,0)
NATL ;;Nationally exported dialogs
"RTN","ORYDLG",36,0)
 ;;FHW1
"RTN","ORYDLG",37,0)
 ;;FHW2
"RTN","ORYDLG",38,0)
 ;;FHW3
"RTN","ORYDLG",39,0)
 ;;FHW7
"RTN","ORYDLG",40,0)
 ;;FHW8
"RTN","ORYDLG",41,0)
 ;;FHW OP MEAL
"RTN","ORYDLG",42,0)
 ;;FHW SPECIAL MEAL
"RTN","ORYDLG",43,0)
 ;;GMRAOR ALLERGY ENTER/EDIT
"RTN","ORYDLG",44,0)
 ;;GMRCOR CONSULT
"RTN","ORYDLG",45,0)
 ;;GMRCOR REQUEST
"RTN","ORYDLG",46,0)
 ;;GMRVOR
"RTN","ORYDLG",47,0)
 ;;LR OTHER LAB TESTS
"RTN","ORYDLG",48,0)
 ;;OR GWCOND CONDITION
"RTN","ORYDLG",49,0)
 ;;OR GWDIAG DIAGNOSIS
"RTN","ORYDLG",50,0)
 ;;OR GWINST DNR
"RTN","ORYDLG",51,0)
 ;;OR GXACTV OTHER ACTIVITY ORDER
"RTN","ORYDLG",52,0)
 ;;OR GXMISC GENERAL
"RTN","ORYDLG",53,0)
 ;;OR GXMOVE ADMIT PATIENT
"RTN","ORYDLG",54,0)
 ;;OR GXMOVE DISCHARGE
"RTN","ORYDLG",55,0)
 ;;OR GXMOVE EVENT
"RTN","ORYDLG",56,0)
 ;;OR GXMOVE TRANSFER
"RTN","ORYDLG",57,0)
 ;;OR GXMOVE TREATING SPECIALTY
"RTN","ORYDLG",58,0)
 ;;OR GXPARM CALL HO ON
"RTN","ORYDLG",59,0)
 ;;OR GXSKIN DRESSING CHANGE
"RTN","ORYDLG",60,0)
 ;;OR GXTEXT TEXT ONLY ORDER
"RTN","ORYDLG",61,0)
 ;;OR GXTEXT WORD PROCESSING ORDER
"RTN","ORYDLG",62,0)
 ;;ORWD GENERIC ACTIVITY
"RTN","ORYDLG",63,0)
 ;;ORWD GENERIC DIET
"RTN","ORYDLG",64,0)
 ;;ORWD GENERIC NURSING
"RTN","ORYDLG",65,0)
 ;;ORWD GENERIC VITALS
"RTN","ORYDLG",66,0)
 ;;PS MEDS
"RTN","ORYDLG",67,0)
 ;;PSH OERR
"RTN","ORYDLG",68,0)
 ;;PSJ OR PAT OE
"RTN","ORYDLG",69,0)
 ;;PSJI OR PAT FLUID OE
"RTN","ORYDLG",70,0)
 ;;PSO OERR
"RTN","ORYDLG",71,0)
 ;;PSO SUPPLY
"RTN","ORYDLG",72,0)
 ;;RA OERR EXAM
"RTN","ORYDLG",73,0)
 ;;ZZZZZ
"RTN","ORYDLG",74,0)
 ;
"RTN","ORYDLG",75,0)
PS ; -- reset FORMAT values in PS dialogs
"RTN","ORYDLG",76,0)
 N DRUG,OI,STR,DLGNM,DLG,PRMT,DA
"RTN","ORYDLG",77,0)
 S DRUG=$$PTR("OR GTX DRUG NAME")
"RTN","ORYDLG",78,0)
 S OI=$$PTR("OR GTX ORDERABLE ITEM"),STR=$$PTR("OR GTX STRENGTH")
"RTN","ORYDLG",79,0)
 F DLGNM="PS MEDS","PSJ OR PAT OE","PSO OERR","PSO SUPPLY","PSH OERR" D
"RTN","ORYDLG",80,0)
 . S DLG=$$PTR(DLGNM)
"RTN","ORYDLG",81,0)
 . F PRMT=OI,STR D
"RTN","ORYDLG",82,0)
 .. S DA=+$O(^ORD(101.41,DLG,10,"D",PRMT,0))
"RTN","ORYDLG",83,0)
 .. S:DA $P(^ORD(101.41,DLG,10,DA,2),U,2)=("@"_DRUG)
"RTN","ORYDLG",84,0)
 Q
"RTN","ORYDLG",85,0)
 ; IV dialog
"RTN","ORYDLG",86,0)
 S DLG=$$PTR("PSJI OR PAT FLUID OE"),PRMT=$$PTR("OR GTX INFUSION RATE")
"RTN","ORYDLG",87,0)
 S DA=+$O(^ORD(101.41,DLG,10,"D",PRMT,0))
"RTN","ORYDLG",88,0)
 I DA S $P(^ORD(101.41,DLG,10,DA,2),U,2)=("@"_$$PTR("OR GTX SCHEDULE"))
"RTN","ORYDLG",89,0)
 Q
"RTN","ORYDLG",90,0)
 ;
"RTN","ORYDLG",91,0)
LR ; -- reset FORMAT value in LR dialog
"RTN","ORYDLG",92,0)
 N DLG,PRMT,DA
"RTN","ORYDLG",93,0)
 S DLG=$$PTR("LR OTHER LAB TESTS"),PRMT=$$PTR("OR GTX SPECIMEN")
"RTN","ORYDLG",94,0)
 S DA=+$O(^ORD(101.41,DLG,10,"D",PRMT,0))
"RTN","ORYDLG",95,0)
 I DA S $P(^ORD(101.41,DLG,10,DA,2),U,2)=("="_$$PTR("OR GTX COLLECTION SAMPLE"))
"RTN","ORYDLG",96,0)
 Q
"RTN","ORYDLG",97,0)
 ;
"RTN","ORYDLG",98,0)
PTR(X) Q +$O(^ORD(101.41,"B",X,0))
"SEC","^DIC",101.43,101.43,0,"DD")
@
"SEC","^DIC",101.43,101.43,0,"DEL")
#
"SEC","^DIC",101.43,101.43,0,"LAYGO")
#
"SEC","^DIC",101.43,101.43,0,"WR")
#
"UP",100,100.008,-1)
100^8
"UP",100,100.008,0)
100.008
"UP",100.2,100.25,-1)
100.2^10
"UP",100.2,100.25,0)
100.25
"VER")
8.0^22.0
"^DD",100,100,39,0)
LAPSED DATE/TIME^D^^10;1^S %DT="EST" D ^%DT S X=Y K:X<1 X
"^DD",100,100,39,3)
This is the date/time when the order was lapsed.
"^DD",100,100,39,21,0)
^^2^2^3080408^
"^DD",100,100,39,21,1,0)
This field will specify when the order was Lapsed.  Lapsing takes place 
"^DD",100,100,39,21,2,0)
in routine ORTSKLPS and is part of the ORMTIME scheduled option.
"^DD",100,100,39,"DT")
3080415
"^DD",100,100,55,0)
SOUTHWEST ASIA CONDITIONS^S^1:YES;0:NO;^5;5^Q
"^DD",100,100,55,3)
Enter YES if this order is for treatment of a condition due to environmental contaminant exposure during the Persian Gulf War.
"^DD",100,100,55,21,0)
^.001^7^7^3010921^^
"^DD",100,100,55,21,1,0)
If a patient has been identified as having been treated for exposure to
"^DD",100,100,55,21,2,0)
environmental contaminants (EC) during the Persian Gulf War, then the
"^DD",100,100,55,21,3,0)
provider may be asked when signing the order if it is for treatment of a
"^DD",100,100,55,21,4,0)
condition related to EC and his/her response to this question will be
"^DD",100,100,55,21,5,0)
stored in this field.  Currently this question is only asked for
"^DD",100,100,55,21,6,0)
Outpatient Medications, and the response is passed to that package with
"^DD",100,100,55,21,7,0)
the new order.
"^DD",100,100,55,"DT")
3060911
"^DD",100,100,58,0)
SHIPBOARD HAZARD^S^1:YES;0:NO;^5;8^Q
"^DD",100,100,58,3)
Enter YES if this order is for treatment of a condition related to Shipboard Hazard.
"^DD",100,100,58,"DT")
3060824
"^DD",100,100,94,0)
BA SOUTHWEST ASIA CONDITIONS^S^1:YES;0:NO;^5.2;5^Q
"^DD",100,100,94,3)
Enter YES if this ordre is for treatmetn of a condition due to environmental contaminant exposure during the Persian Gulf War.
"^DD",100,100,94,"DT")
3060911
"^DD",100,100,97,0)
PFSS ACCOUNT REFERENCE^P375'^IBBAA(375,^5.5;1^Q
"^DD",100,100,97,21,0)
^.001^3^3^3061025^
"^DD",100,100,97,21,1,0)
The PFSS Account Reference field stores the PFSS Account Reference
"^DD",100,100,97,21,2,0)
associated with the order. The field is a pointer to the PFSS Account
"^DD",100,100,97,21,3,0)
Reference file (#375).
"^DD",100,100,97,"DT")
3061025
"^DD",100,100,98,0)
BA SHIPBOARD HAZARD^S^1:YES;0:NO;^5.2;8^Q
"^DD",100,100,98,3)
Enter YES if this order is treatment for a condition related to Shipboard Hazard.
"^DD",100,100,98,"DT")
3061025
"^DD",100,100.008,4,0)
SIGNATURE STATUS^S^0:ON CHART w/written orders;1:ELECTRONIC;2:NOT SIGNED;3:NOT REQUIRED;4:ON CHART w/printed orders;5:NOT REQUIRED due to cancel/lapse;6:SERVICE CORRECTION to signed order;7:DIGITALLY SIGNED;8:ON PARENT order;^0;4^Q
"^DD",100,100.008,4,1,0)
^.1
"^DD",100,100.008,4,1,1,0)
100^AS2^MUMPS
"^DD",100,100.008,4,1,1,1)
N ORDA S ORDA=DA(1) D S1^ORDD100(ORDA,DA)
"^DD",100,100.008,4,1,1,2)
N ORDA S ORDA=DA(1) D S2^ORDD100(ORDA,DA)
"^DD",100,100.008,4,1,1,"%D",0)
^.101^2^2^3061108^^^
"^DD",100,100.008,4,1,1,"%D",1,0)
^OR(100,"AS",ORVP,9999999-ORLOG,ORIFN,DA)
"^DD",100,100.008,4,1,1,"%D",2,0)
Allows retrieval of unsigned orders.
"^DD",100,100.008,4,1,1,"DT")
2961224
"^DD",100,100.008,4,3)
Select 0=On chart-written, 1=Electronic, 2=Not Signed, 3=Not Required, 4=On chart-printed, 5=Not Required-cancel/lapse, 6=Service Correction, 7=Digitally Signed, 8=On Parent Order
"^DD",100,100.008,4,21,0)
^.001^4^4^3040514^^^^
"^DD",100,100.008,4,21,1,0)
This is the signature status of the order.  Entries with a null value
"^DD",100,100.008,4,21,2,0)
in this field are assumed to have been entered through the back door
"^DD",100,100.008,4,21,3,0)
via specific package order entry options and do not require signature
"^DD",100,100.008,4,21,4,0)
unless so specified by the package.
"^DD",100,100.008,4,"DT")
3061108
"^DD",100,100.008,15,0)
RELEASE STATUS^S^11:unreleased;10:pre-release;13:rejected;12:dc/edit;14:lapsed;^0;15^Q
"^DD",100,100.008,15,3)
Enter the status of this action request.
"^DD",100,100.008,15,21,0)
^.001^2^2^3000712^^^
"^DD",100,100.008,15,21,1,0)
This field tracks the status of the request for this action; this is NOT
"^DD",100,100.008,15,21,2,0)
the same as the order status.
"^DD",100,100.008,15,"DT")
3061108
"^DD",100.2,100.2,14,0)
SURGERY^P130'^SRF(^1;4^Q
"^DD",100.2,100.2,14,1,0)
^.1
"^DD",100.2,100.2,14,1,1,0)
100.2^ASR
"^DD",100.2,100.2,14,1,1,1)
S ^ORE(100.2,"ASR",$E(X,1,30),DA)=""
"^DD",100.2,100.2,14,1,1,2)
K ^ORE(100.2,"ASR",$E(X,1,30),DA)
"^DD",100.2,100.2,14,1,1,"DT")
3020425
"^DD",100.2,100.2,14,3)
Enter the surgery case that satisfied this event for this patient.
"^DD",100.2,100.2,14,21,0)
^^5^5^3070606^
"^DD",100.2,100.2,14,21,1,0)
This field is a pointer to the Surgery case that satisfied this event for
"^DD",100.2,100.2,14,21,2,0)
this patient when the TIME PAT OUT OR field was entered (for events prior 
"^DD",100.2,100.2,14,21,3,0)
to the instllation of patch SR*3*157) or when the TIME PAT IN OR field 
"^DD",100.2,100.2,14,21,4,0)
was entered (for events after the installation of patch SR*3*157); any 
"^DD",100.2,100.2,14,21,5,0)
changes to this field will be tracked in the Activity log.
"^DD",100.2,100.2,14,"DT")
3020425
"^DD",100.2,100.25,4,0)
EVENT TYPE^S^A:ADMISSION;T:TRANSFER;D:DISCHARGE;O:O.R.;S:SPECIALTY CHANGE;^0;4^Q
"^DD",100.2,100.25,4,3)
Enter the type of event that was processed.
"^DD",100.2,100.25,4,21,0)
^^2^2^3070530^
"^DD",100.2,100.25,4,21,1,0)
This field is the type of event that was processed.  This could be 
"^DD",100.2,100.25,4,21,2,0)
admission, discharge, transfer, O.R. (surgery), or specialty change.
"^DD",100.2,100.25,4,"DT")
3070530
"^DD",100.21,100.21,0)
FIELD^^11^11
"^DD",100.21,100.21,0,"DDA")
N
"^DD",100.21,100.21,0,"DT")
3071115
"^DD",100.21,100.21,0,"IX","AB",100.2101,.01)

"^DD",100.21,100.21,0,"IX","AC",100.213,.01)

"^DD",100.21,100.21,0,"IX","B",100.21,.01)

"^DD",100.21,100.21,0,"IX","C",100.212,.01)

"^DD",100.21,100.21,0,"IX","D",100.21,.1)

"^DD",100.21,100.21,0,"NM","OE/RR LIST")

"^DD",100.21,100.21,0,"PT",100.241,.01)

"^DD",100.21,100.21,0,"PT",123.53,.01)

"^DD",100.21,100.21,0,"PT",123.54,2)

"^DD",100.21,100.21,0,"PT",123.57,.01)

"^DD",100.21,100.21,0,"PT",123.58,.01)

"^DD",100.21,100.21,0,"PT",183,.01)

"^DD",100.21,100.21,0,"PT",200,101.02)

"^DD",100.21,100.21,0,"PT",810.17,.01)

"^DD",100.21,100.21,0,"PT",8989.5,.01)

"^DD",100.21,100.21,0,"VRPK")
ORDER ENTRY/RESULTS REPORTING
"^DD",100.21,100.21,0,"VRRV")
1^3070905
"^DD",100.21,100.21,.01,0)
NAME^RFX^^0;1^K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E)!($D(^OR(100.21,"B",X))) X
"^DD",100.21,100.21,.01,1,0)
^.1
"^DD",100.21,100.21,.01,1,1,0)
100.21^B
"^DD",100.21,100.21,.01,1,1,1)
S ^OR(100.21,"B",$E(X,1,30),DA)=""
"^DD",100.21,100.21,.01,1,1,2)
K ^OR(100.21,"B",$E(X,1,30),DA)
"^DD",100.21,100.21,.01,1,2,0)
^^TRIGGER^100.21^.1
"^DD",100.21,100.21,.01,1,2,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^OR(100.21,D0,0)):^(0),1:"") S X=$P(Y(1),U,3),X=X S DIU=X K Y X ^DD(100.21,.01,1,2,1.1) X ^DD(100.21,.01,1,2,1.4)
"^DD",100.21,100.21,.01,1,2,1.1)
S X=DIV S X=DIV X "F %=1:1:$L(X) S:$E(X,%)?1L X=$E(X,0,%-1)_$C($A(X,%)-32)_$E(X,%+1,999)" S X=X,Y(1)=X S X=1,Y(2)=X S X=30,X=$E(Y(1),Y(2),X)
"^DD",100.21,100.21,.01,1,2,1.4)
S DIH=$S($D(^OR(100.21,DIV(0),0)):^(0),1:""),DIV=X S $P(^(0),U,3)=DIV,DIH=100.21,DIG=.1 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",100.21,100.21,.01,1,2,2)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^OR(100.21,D0,0)):^(0),1:"") S X=$P(Y(1),U,3),X=X S DIU=X K Y S X="" X ^DD(100.21,.01,1,2,2.4)
"^DD",100.21,100.21,.01,1,2,2.4)
S DIH=$S($D(^OR(100.21,DIV(0),0)):^(0),1:""),DIV=X S $P(^(0),U,3)=DIV,DIH=100.21,DIG=.1 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",100.21,100.21,.01,1,2,"CREATE VALUE")
$E(UPPERCASE(NAME),1,30)
"^DD",100.21,100.21,.01,1,2,"DELETE VALUE")
@
"^DD",100.21,100.21,.01,1,2,"DT")
2910227
"^DD",100.21,100.21,.01,1,2,"FIELD")
UPPER CASE
"^DD",100.21,100.21,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT BE WHOLLY NUMERIC OR START WITH PUNCTUATION.  IT MUST ALSO BE UNIQUE.
"^DD",100.21,100.21,.01,21,0)
^^1^1^2990818^^^^
"^DD",100.21,100.21,.01,21,1,0)
This is the name of the list being defined.
"^DD",100.21,100.21,.01,"DEL",123.5,0)
I '($E($G(XQY0),1,4)="ORLP") W !,"Deletion of Team Lists only alowed through CPRS menu options.  "
"^DD",100.21,100.21,.01,"DT")
2911220
"^DD",100.21,100.21,.1,0)
UPPER CASE^RF^^0;3^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>30!($L(X)<1) X
"^DD",100.21,100.21,.1,1,0)
^.1
"^DD",100.21,100.21,.1,1,1,0)
100.21^D
"^DD",100.21,100.21,.1,1,1,1)
S ^OR(100.21,"D",$E(X,1,30),DA)=""
"^DD",100.21,100.21,.1,1,1,2)
K ^OR(100.21,"D",$E(X,1,30),DA)
"^DD",100.21,100.21,.1,1,1,"%D",0)
^^1^1^2990818^^
"^DD",100.21,100.21,.1,1,1,"%D",1,0)
The "D" cross-reference is used to look-up list names in upper case.
"^DD",100.21,100.21,.1,1,1,"DT")
2910227
"^DD",100.21,100.21,.1,3)
Answer must be 1-30 characters in length.
"^DD",100.21,100.21,.1,5,1,0)
100.21^.01^2
"^DD",100.21,100.21,.1,9)
^
"^DD",100.21,100.21,.1,21,0)
^^1^1^2920416^^^
"^DD",100.21,100.21,.1,21,1,0)
This is the name of the list in upper case.  Used for look-up.
"^DD",100.21,100.21,.1,"DT")
2910227
"^DD",100.21,100.21,1,0)
TYPE^RS^P:PERSONAL PATIENT;TA:TEAM PATIENT AUTOLINKED;TM:TEAM PATIENT MANUAL;MRAL:MANUAL REMOVAL/AUTOLINK ADDITION;^0;2^Q
"^DD",100.21,100.21,1,1,0)
^.1
"^DD",100.21,100.21,1,1,1,0)
^^TRIGGER^100.21^1.6
"^DD",100.21,100.21,1,1,1,1)
X ^DD(100.21,1,1,1,1.3) I X S X=DIV S Y(1)=$S($D(^OR(100.21,D0,0)):^(0),1:"") S X=$P(Y(1),U,5),X=X S DIU=X K Y S X=DIV S X=DUZ X ^DD(100.21,1,1,1,1.4)
"^DD",100.21,100.21,1,1,1,1.3)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X S Y(1)=$S($D(^OR(100.21,D0,0)):^(0),1:"") S X=$S('$D(^VA(200,+$P(Y(1),U,5),0)):"",1:$P(^(0),U,1))=""
"^DD",100.21,100.21,1,1,1,1.4)
S DIH=$S($D(^OR(100.21,DIV(0),0)):^(0),1:""),DIV=X S $P(^(0),U,5)=DIV,DIH=100.21,DIG=1.6 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",100.21,100.21,1,1,1,2)
Q
"^DD",100.21,100.21,1,1,1,3)
Original creator's identity cannot be changed.
"^DD",100.21,100.21,1,1,1,"%D",0)
^^2^2^2990818^
"^DD",100.21,100.21,1,1,1,"%D",1,0)
This field is used to store the indentity of the user who created the Team
"^DD",100.21,100.21,1,1,1,"%D",2,0)
list.
"^DD",100.21,100.21,1,1,1,"CREATE CONDITION")
CREATOR=""
"^DD",100.21,100.21,1,1,1,"CREATE VALUE")
S X=DUZ
"^DD",100.21,100.21,1,1,1,"DELETE VALUE")
NO EFFECT
"^DD",100.21,100.21,1,1,1,"DT")
2990810
"^DD",100.21,100.21,1,1,1,"FIELD")
CREATOR
"^DD",100.21,100.21,1,1,2,0)
^^TRIGGER^100.21^1.65
"^DD",100.21,100.21,1,1,2,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X S Y(1)=$S($D(^OR(100.21,D0,0)):^(0),1:"") S X=$P(Y(1),U,7)="" I X S X=DIV S Y(1)=$S($D(^OR(100.21,D0,0)):^(0),1:"") S X=$P(Y(1),U,7),X=X S DIU=X K Y S X=DIV S X=DT X ^DD(100.21,1,1,2,1.4)
"^DD",100.21,100.21,1,1,2,1.4)
S DIH=$S($D(^OR(100.21,DIV(0),0)):^(0),1:""),DIV=X S $P(^(0),U,7)=DIV,DIH=100.21,DIG=1.65 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",100.21,100.21,1,1,2,2)
Q
"^DD",100.21,100.21,1,1,2,"%D",0)
^^1^1^2990818^
"^DD",100.21,100.21,1,1,2,"%D",1,0)
Trigger fills CREATION D/T field.
"^DD",100.21,100.21,1,1,2,"CREATE CONDITION")
CREATION D/T=""
"^DD",100.21,100.21,1,1,2,"CREATE VALUE")
S X=DT
"^DD",100.21,100.21,1,1,2,"DELETE VALUE")
NO EFFECT
"^DD",100.21,100.21,1,1,2,"DT")
2990818
"^DD",100.21,100.21,1,1,2,"FIELD")
CREATION D/T
"^DD",100.21,100.21,1,3)
Enter 'P' for Personal list, 'TA' for a Team Patient Autolinked list, 'TM' for a Team List manually updated list, 'MRAL' for a Team list with Autolinked additions and manual removal.
"^DD",100.21,100.21,1,21,0)
^^12^12^2990817^^^^
"^DD",100.21,100.21,1,21,1,0)
This is the type of list being defined.  List type currently includes
"^DD",100.21,100.21,1,21,2,0)
team and personal.
"^DD",100.21,100.21,1,21,3,0)
o  Team lists
"^DD",100.21,100.21,1,21,4,0)
     o  TM - Manually maintained (addition and removal)
"^DD",100.21,100.21,1,21,5,0)
     o  TA - Maintained by Autolinks for addition and removal of patients.
"^DD",100.21,100.21,1,21,6,0)
     o  MRAL - Manual removal of patients from the list with Autolink
"^DD",100.21,100.21,1,21,7,0)
        addition of patients to the list.
"^DD",100.21,100.21,1,21,8,0)
 
"^DD",100.21,100.21,1,21,9,0)
o  Personal lists
"^DD",100.21,100.21,1,21,10,0)
     o  P - Manually maintained (addition and removal)
"^DD",100.21,100.21,1,21,11,0)
 
"^DD",100.21,100.21,1,21,12,0)
 
"^DD",100.21,100.21,1,"DT")
2990818
"^DD",100.21,100.21,1.5,0)
DEVICE^P3.5'^%ZIS(1,^0;4^Q
"^DD",100.21,100.21,1.5,3)
Enter the device to be linked with this list.
"^DD",100.21,100.21,1.5,21,0)
^^1^1^2971201^
"^DD",100.21,100.21,1.5,21,1,0)
Device from the DEVICE file linked to the list.
"^DD",100.21,100.21,1.5,"DT")
2971201
"^DD",100.21,100.21,1.6,0)
CREATOR^P200'I^VA(200,^0;5^Q
"^DD",100.21,100.21,1.6,.1)
Creator of Team List
"^DD",100.21,100.21,1.6,3)
Entry in this field is handled by Fileman.
"^DD",100.21,100.21,1.6,5,1,0)
100.21^1^1
"^DD",100.21,100.21,1.6,9)
^
"^DD",100.21,100.21,1.6,21,0)
^^1^1^2990810^^^^
"^DD",100.21,100.21,1.6,21,1,0)
This is the IEN of the user who creates the Team List.
"^DD",100.21,100.21,1.6,"DT")
2990811
"^DD",100.21,100.21,1.65,0)
CREATION D/T^D^^0;7^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",100.21,100.21,1.65,3)
Date and time of list creation.
"^DD",100.21,100.21,1.65,5,1,0)
100.21^1^2
"^DD",100.21,100.21,1.65,21,0)
^^1^1^2990818^^^
"^DD",100.21,100.21,1.65,21,1,0)
This field stores the date of creation of the list.
"^DD",100.21,100.21,1.65,"DT")
2990818
"^DD",100.21,100.21,1.7,0)
SUBSCRIBE^S^Y:YES;N:NO;^0;6^Q
"^DD",100.21,100.21,1.7,3)
YES means users can add or remove themselves as team members (providers).
"^DD",100.21,100.21,1.7,21,0)
^^4^4^2990811^
"^DD",100.21,100.21,1.7,21,1,0)
This field stores either a Y or N (for YES or NO) entry and is used in
"^DD",100.21,100.21,1.7,21,2,0)
CPRS to determine whether or not individual users will be allowed to add
"^DD",100.21,100.21,1.7,21,3,0)
or remove themselves as members of the team list if it is of autolink
"^DD",100.21,100.21,1.7,21,4,0)
type.
"^DD",100.21,100.21,1.7,"DT")
2990811
"^DD",100.21,100.21,2,0)
USER^100.212PA^^1;0
"^DD",100.21,100.21,2,3)
Enter the users associated with this list.
"^DD",100.21,100.21,2,21,0)
^.001^3^3^3000316^^^^
"^DD",100.21,100.21,2,21,1,0)
These are the user(s) that belong to the list.  If the list is of type
"^DD",100.21,100.21,2,21,2,0)
TEAM PATIENT or PERSONAL PATIENT, users on the list may receive clinical 
"^DD",100.21,100.21,2,21,3,0)
notifications for patients also on the list.
"^DD",100.21,100.21,3,0)
AUTOLINK^100.213IAV^^2;0
"^DD",100.21,100.21,3,21,0)
^.001^9^9^3000411^^^^
"^DD",100.21,100.21,3,21,1,0)
This field is used to link the list with WARDs, ROOM-BEDs,
"^DD",100.21,100.21,3,21,2,0)
PROVIDERs, TREATING SPECIALTYs, or CLINICs.  This field  
"^DD",100.21,100.21,3,21,3,0)
points to the entry in the file where the link is to 
"^DD",100.21,100.21,3,21,4,0)
occur.  When ADT movement occur for patients, they are
"^DD",100.21,100.21,3,21,5,0)
added to the appropriate OE/RR lists as identified by the
"^DD",100.21,100.21,3,21,6,0)
AUTOLINK field (via "AC" cross-ref).
"^DD",100.21,100.21,3,21,7,0)
Lists with autolink providers are updated (patient added) when the PROVIDER
"^DD",100.21,100.21,3,21,8,0)
link matches the entry at the PRIMARY CARE PHYSICIAN or ATTENDING
"^DD",100.21,100.21,3,21,9,0)
PHYSICIAN prompts.
"^DD",100.21,100.21,10,0)
MEMBER^100.2101AV^^10;0
"^DD",100.21,100.21,10,3)
Enter the members for this list.
"^DD",100.21,100.21,10,21,0)
^^3^3^2971201^^^^
"^DD",100.21,100.21,10,21,1,0)
The list member is an item on the list.  The member for personal and team 
"^DD",100.21,100.21,10,21,2,0)
patient lists is a patient (if list type is P or T, this field points to
"^DD",100.21,100.21,10,21,3,0)
the patient file.)
"^DD",100.21,100.21,11,0)
VISIBILITY^RS^0:OWNER;1:ALLUSERS;^11;1^Q
"^DD",100.21,100.21,11,.1)
PATIENT LIST VISIBILITY
"^DD",100.21,100.21,11,3)
This field is used as a means to control who can see this list. If it is set to 0, then only the owner can see it. If 1 then everybody can see it. The default is owner only.
"^DD",100.21,100.21,11,21,0)
^^4^4^3071115^
"^DD",100.21,100.21,11,21,1,0)
This field is used as a means to control who can see this list and the 
"^DD",100.21,100.21,11,21,2,0)
patients that are contained within it.  If it is set to 0, then only the 
"^DD",100.21,100.21,11,21,3,0)
owner can see it.  If it is set to 1, then everybody can see it. The 
"^DD",100.21,100.21,11,21,4,0)
default is owner only.
"^DD",100.21,100.21,11,23,0)
^^1^1^3071115^^
"^DD",100.21,100.21,11,23,1,0)
SET OF CODES
"^DD",100.21,100.21,11,"DT")
3071115
"^DD",100.21,100.2101,0)
MEMBER SUB-FIELD^^2^3
"^DD",100.21,100.2101,0,"DT")
2910530
"^DD",100.21,100.2101,0,"IX","B",100.2101,.01)

"^DD",100.21,100.2101,0,"NM","MEMBER")

"^DD",100.21,100.2101,0,"UP")
100.21
"^DD",100.21,100.2101,.01,0)
MEMBER^MV^^0;1^Q
"^DD",100.21,100.2101,.01,1,0)
^.1
"^DD",100.21,100.2101,.01,1,1,0)
100.2101^B
"^DD",100.21,100.2101,.01,1,1,1)
S ^OR(100.21,DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",100.21,100.2101,.01,1,1,2)
K ^OR(100.21,DA(1),10,"B",$E(X,1,30),DA)
"^DD",100.21,100.2101,.01,1,1,3)
Required Index for Variable Pointer
"^DD",100.21,100.2101,.01,1,2,0)
100.21^AB
"^DD",100.21,100.2101,.01,1,2,1)
S ^OR(100.21,"AB",$E(X,1,30),DA(1),DA)=""
"^DD",100.21,100.2101,.01,1,2,2)
K ^OR(100.21,"AB",$E(X,1,30),DA(1),DA)
"^DD",100.21,100.2101,.01,1,2,"%D",0)
^^1^1^2920427^
"^DD",100.21,100.2101,.01,1,2,"%D",1,0)
The "AB" cross-reference is used to look-up members (patients) on a list.
"^DD",100.21,100.2101,.01,3)
If the list is a personal or team patient list, enter the patient(s) you want associated with this list.
"^DD",100.21,100.2101,.01,21,0)
^^1^1^2940427^^^^
"^DD",100.21,100.2101,.01,21,1,0)
An item on the list, member is a patient if the list type is P or T.
"^DD",100.21,100.2101,.01,"DT")
2900531
"^DD",100.21,100.2101,.01,"V",0)
^.12P^1^1
"^DD",100.21,100.2101,.01,"V",1,0)
2^PATIENT^1^PT^^n
"^DD",100.21,100.2101,1,0)
VIEW DATE/TIME^D^^0;2^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",100.21,100.2101,1,3)
Enter the Date/time this list was last viewed.
"^DD",100.21,100.2101,1,21,0)
^^1^1^2920423^^^^
"^DD",100.21,100.2101,1,21,1,0)
This is the date/time this item was last viewed.
"^DD",100.21,100.2101,1,"DT")
2900904
"^DD",100.21,100.2101,2,0)
*NOTIFICATION SELECTION^100.21019P^^100.9;0
"^DD",100.21,100.2101,2,3)
Enter the notifications you want to receive.
"^DD",100.21,100.2101,2,21,0)
^^1^1^2971201^^^^
"^DD",100.21,100.2101,2,21,1,0)
This field is unused and will be deleted post-CPRS 1.
"^DD",100.21,100.2101,2,"DT")
2971201
"^DD",100.21,100.21019,0)
*NOTIFICATION SELECTION SUB-FIELD^^.01^1
"^DD",100.21,100.21019,0,"DT")
2910530
"^DD",100.21,100.21019,0,"IX","B",100.21019,.01)

"^DD",100.21,100.21019,0,"NM","*NOTIFICATION SELECTION")

"^DD",100.21,100.21019,0,"UP")
100.2101
"^DD",100.21,100.21019,.01,0)
*NOTIFICATION SELECTION^MP100.9'^ORD(100.9,^0;1^Q
"^DD",100.21,100.21019,.01,1,0)
^.1
"^DD",100.21,100.21019,.01,1,1,0)
100.21019^B
"^DD",100.21,100.21019,.01,1,1,1)
S ^OR(100.21,DA(2),10,DA(1),100.9,"B",$E(X,1,30),DA)=""
"^DD",100.21,100.21019,.01,1,1,2)
K ^OR(100.21,DA(2),10,DA(1),100.9,"B",$E(X,1,30),DA)
"^DD",100.21,100.21019,.01,3)
Enter the notification(s) you want to receive for this patient.
"^DD",100.21,100.21019,.01,"DT")
2971201
"^DD",100.21,100.212,0)
USER SUB-FIELD^^1^2
"^DD",100.21,100.212,0,"DT")
2990512
"^DD",100.21,100.212,0,"NM","USER")

"^DD",100.21,100.212,0,"UP")
100.21
"^DD",100.21,100.212,.01,0)
USER^*P200'X^VA(200,^0;1^S DIC("S")="I +($$ACTIVE^XUSER(Y))" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X S:$G(X) DINUM=X
"^DD",100.21,100.212,.01,1,0)
^.1^^-1
"^DD",100.21,100.212,.01,1,2,0)
100.21^C
"^DD",100.21,100.212,.01,1,2,1)
S ^OR(100.21,"C",$E(X,1,30),DA(1),DA)=""
"^DD",100.21,100.212,.01,1,2,2)
K ^OR(100.21,"C",$E(X,1,30),DA(1),DA)
"^DD",100.21,100.212,.01,1,2,"%D",0)
^^1^1^2920427^
"^DD",100.21,100.212,.01,1,2,"%D",1,0)
The "C" cross-reference is used to look-up users/recipients on a list.
"^DD",100.21,100.212,.01,3)
Enter the user(s) you want associated with this list. User(s) may receive clinical notifications for patients also on the list.
"^DD",100.21,100.212,.01,12)
Screen will filter out inactive users from the selection list.
"^DD",100.21,100.212,.01,12.1)
S DIC("S")="I +($$ACTIVE^XUSER(Y))"
"^DD",100.21,100.212,.01,21,0)
^.001^3^3^3000316^^^^
"^DD",100.21,100.212,.01,21,1,0)
This is a user that belongs to the list.  If the list is of type
"^DD",100.21,100.212,.01,21,2,0)
TEAM PATIENT or PERSONAL PATIENT, users on the list may receive clinical 
"^DD",100.21,100.212,.01,21,3,0)
notifications for patients also on the list.
"^DD",100.21,100.212,.01,"DT")
2990512
"^DD",100.21,100.212,1,0)
LAST DATE/TIME USED^D^^0;2^S %DT="ETR" D ^%DT S X=Y K:Y<1 X
"^DD",100.21,100.212,1,3)
Enter the date/time last used for this user
"^DD",100.21,100.212,1,21,0)
^^1^1^2990505^^^^
"^DD",100.21,100.212,1,21,1,0)
This is the date/time that the user last used this list.
"^DD",100.21,100.212,1,"DT")
2900601
"^DD",100.21,100.213,0)
AUTOLINK SUB-FIELD^^1^2
"^DD",100.21,100.213,0,"DT")
2991215
"^DD",100.21,100.213,0,"IX","B",100.213,.01)

"^DD",100.21,100.213,0,"NM","AUTOLINK")

"^DD",100.21,100.213,0,"UP")
100.21
"^DD",100.21,100.213,.01,0)
AUTOLINK^V^^0;1^Q
"^DD",100.21,100.213,.01,1,0)
^.1
"^DD",100.21,100.213,.01,1,1,0)
100.213^B
"^DD",100.21,100.213,.01,1,1,1)
S ^OR(100.21,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",100.21,100.213,.01,1,1,2)
K ^OR(100.21,DA(1),2,"B",$E(X,1,30),DA)
"^DD",100.21,100.213,.01,1,1,3)
Required Index for Variable Pointer
"^DD",100.21,100.213,.01,1,2,0)
100.21^AC
"^DD",100.21,100.213,.01,1,2,1)
S ^OR(100.21,"AC",$E(X,1,30),DA(1),DA)=""
"^DD",100.21,100.213,.01,1,2,2)
K ^OR(100.21,"AC",$E(X,1,30),DA(1),DA)
"^DD",100.21,100.213,.01,1,2,"%D",0)
^^1^1^2920427^^
"^DD",100.21,100.213,.01,1,2,"%D",1,0)
Index allowing cross-referencing the list file by AUTOLINK.
"^DD",100.21,100.213,.01,1,2,"DT")
2920225
"^DD",100.21,100.213,.01,3)
Enter the file and entry this list will be linked to for automatic patient updates during ADT patient movements and CLINIC enrollments.
"^DD",100.21,100.213,.01,21,0)
^.001^2^2^3000411^^^^
"^DD",100.21,100.213,.01,21,1,0)
Links for automatic patient addition/removal based on ADT movements and
"^DD",100.21,100.213,.01,21,2,0)
CLINIC enrollments.
"^DD",100.21,100.213,.01,"DT")
2991215
"^DD",100.21,100.213,.01,"V",0)
^.12P^5^5
"^DD",100.21,100.213,.01,"V",1,0)
42^WARD^1^W^y^n
"^DD",100.21,100.213,.01,"V",1,1)
S DIC("S")="I '$$WINACT^ORLP3U1(+Y)"
"^DD",100.21,100.213,.01,"V",1,2)
ACTIVE WARDS
"^DD",100.21,100.213,.01,"V",2,0)
405.4^ROOM-BED^2^R^^n
"^DD",100.21,100.213,.01,"V",3,0)
200^PROVIDER^3^P^y^n
"^DD",100.21,100.213,.01,"V",3,1)
S DIC("S")="I $D(X),$D(^VA(200,""AK.PROVIDER"",$P(^(0),U))),$$ACTIVE^XUSER(+Y)"
"^DD",100.21,100.213,.01,"V",3,2)
Only active providers allowed
"^DD",100.21,100.213,.01,"V",4,0)
45.7^SPECIALTY^4^S^^n
"^DD",100.21,100.213,.01,"V",5,0)
44^CLINIC^5^C^y^n
"^DD",100.21,100.213,.01,"V",5,1)
S DIC("S")="I $D(X),$P(^SC(+Y,0),U,3)=""C"",$$ACTLOC^ORWU(+Y)=1"
"^DD",100.21,100.213,.01,"V",5,2)
Searches for active CLINICs only.
"^DD",100.21,100.213,1,0)
PRIMARY OR ATTENDING^*S^P:primary;A:attending;B:both;^0;2^Q
"^DD",100.21,100.213,1,3)
Answer with one of the above codes to link this provider to all patients for which he is their Primary Care physician, Attending physician or acts as either for all inpatients.
"^DD",100.21,100.213,1,12)
Select how provider autolink will work.
"^DD",100.21,100.213,1,12.1)
S DIC("S")="I $P(^OR(100.21,DA(1),2,DA,0),U)[""VA(200"""
"^DD",100.21,100.213,1,21,0)
^^14^14^2990506^^^^
"^DD",100.21,100.213,1,21,1,0)
This field will determine how the Autolinks for Providers will work. If the
"^DD",100.21,100.213,1,21,2,0)
field is set to;
"^DD",100.21,100.213,1,21,3,0)

"^DD",100.21,100.213,1,21,4,0)
"P" - Primary:  The autolink will add patients to the list that have the
"^DD",100.21,100.213,1,21,5,0)
pointed to provider assigned to them thru the MAS options as PROVIDER.
"^DD",100.21,100.213,1,21,6,0)

"^DD",100.21,100.213,1,21,7,0)
"A" - Attending:  The autolink will add patients to the list that have the
"^DD",100.21,100.213,1,21,8,0)
pointed to provider assigned to them thru the MAS options as ATTENDING
"^DD",100.21,100.213,1,21,9,0)
PHYSICIAN.
"^DD",100.21,100.213,1,21,10,0)

"^DD",100.21,100.213,1,21,11,0)
"B" - Both:  The autolink will add patients to the list that have the pointed
"^DD",100.21,100.213,1,21,12,0)
to provider assigned to them thru the MAS options as  'PROVIDER' and those
"^DD",100.21,100.213,1,21,13,0)
patients that have the pointed to provider assigned to them as ATTENDING
"^DD",100.21,100.213,1,21,14,0)
PHYSICIAN.
"^DD",100.21,100.213,1,23,0)
^^1^1^2990506^^^^
"^DD",100.21,100.213,1,23,1,0)
To autolink patients to either PROVIDER, ATTENDING PHYSICIAN or both.
"^DD",100.21,100.213,1,"DT")
2940428
"^DD",101.24,101.24,0)
FIELD^^.491^43
"^DD",101.24,101.24,0,"DDA")
N
"^DD",101.24,101.24,0,"DT")
3080416
"^DD",101.24,101.24,0,"ID",.23)
W:$D(^(2)) "   ",$P(^(2),U,3)
"^DD",101.24,101.24,0,"ID",.24)
W:$D(^(2)) "   ",$P(^(2),U,4)
"^DD",101.24,101.24,0,"IX","AC",101.24,.02)

"^DD",101.24,101.24,0,"IX","B",101.24,.01)

"^DD",101.24,101.24,0,"NM","OE/RR REPORT")

"^DD",101.24,101.24,0,"PT",101.24,.18)

"^DD",101.24,101.24,0,"PT",101.241,.01)

"^DD",101.24,101.24,0,"VRPK")
ORDER ENTRY/RESULTS REPORTING
"^DD",101.24,101.24,0,"VRRV")
1^3070507
"^DD",101.24,101.24,.001,0)
NUMBER^NJ5,0^^ ^K:+X'=X!(X>10000)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.24,101.24,.001,3)
Type a Number between 1 and 10000, 0 Decimal Digits
"^DD",101.24,101.24,.001,21,0)
^^1^1^3000921^
"^DD",101.24,101.24,.001,21,1,0)
This is the Number field for the file.
"^DD",101.24,101.24,.001,"DT")
3000920
"^DD",101.24,101.24,.01,0)
NAME^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",101.24,101.24,.01,1,0)
^.1^^-1
"^DD",101.24,101.24,.01,1,1,0)
101.24^B
"^DD",101.24,101.24,.01,1,1,1)
S ^ORD(101.24,"B",$E(X,1,30),DA)=""
"^DD",101.24,101.24,.01,1,1,2)
K ^ORD(101.24,"B",$E(X,1,30),DA)
"^DD",101.24,101.24,.01,3)
Answer must be 3-30 characters in length.
"^DD",101.24,101.24,.01,21,0)
^^1^1^3000921^
"^DD",101.24,101.24,.01,21,1,0)
This is the Name of the report.
"^DD",101.24,101.24,.01,"DT")
3010510
"^DD",101.24,101.24,.02,0)
ID^RF^^0;2^K:$L(X)>10!($L(X)<1) X
"^DD",101.24,101.24,.02,1,0)
^.1
"^DD",101.24,101.24,.02,1,1,0)
101.24^AC
"^DD",101.24,101.24,.02,1,1,1)
S ^ORD(101.24,"AC",$E(X,1,30),DA)=""
"^DD",101.24,101.24,.02,1,1,2)
K ^ORD(101.24,"AC",$E(X,1,30),DA)
"^DD",101.24,101.24,.02,1,1,"DT")
3001005
"^DD",101.24,101.24,.02,3)
Answer must be 1-10 characters in length.
"^DD",101.24,101.24,.02,21,0)
^^4^4^3000921^
"^DD",101.24,101.24,.02,21,1,0)
This is the code that identifies the report.  Each tab in CPRS that
"^DD",101.24,101.24,.02,21,2,0)
uses reports looks for this ID in order to process the report.
"^DD",101.24,101.24,.02,21,3,0)
Each tab also uses a unique set of ID's.  An ID of 5 on the Reports
"^DD",101.24,101.24,.02,21,4,0)
Tab may not identify the same report on a different tab.
"^DD",101.24,101.24,.02,"DT")
3001005
"^DD",101.24,101.24,.03,0)
REMOTE^S^1:YES;2:REMOTE ONLY;^0;3^Q
"^DD",101.24,101.24,.03,21,0)
^^2^2^3000921^
"^DD",101.24,101.24,.03,21,1,0)
This field is used to identify which reports allow remote access through
"^DD",101.24,101.24,.03,21,2,0)
Remote Data Views.
"^DD",101.24,101.24,.03,"DT")
3050512
"^DD",101.24,101.24,.04,0)
QUALIFIER^S^1:HSType;2:DateTime;3:Imaging;4:NutrAssess;19:MedicineProcedure;39:ListView;5:HSComponent;6:HSWPComponent;28:Surgery;^0;4^Q
"^DD",101.24,101.24,.04,21,0)
^.001^2^2^3010531^^^
"^DD",101.24,101.24,.04,21,1,0)
This field identifies which qualifier to use when processing the report.
"^DD",101.24,101.24,.04,21,2,0)
Examples of qualifiers are HSType, DateTime, Imaging and NutrAssess.
"^DD",101.24,101.24,.04,"DT")
3011004
"^DD",101.24,101.24,.05,0)
ROUTINE^FI^^0;5^K:$L(X)>8!($L(X)<1) X
"^DD",101.24,101.24,.05,3)
Answer must be 1-8 characters in length.
"^DD",101.24,101.24,.05,8.5)
@
"^DD",101.24,101.24,.05,9)
@
"^DD",101.24,101.24,.05,21,0)
^.001^1^1^3001026^^^
"^DD",101.24,101.24,.05,21,1,0)
This is the routine that is invoked to produce the report.
"^DD",101.24,101.24,.05,23,0)
^.001^2^2^3001026^^
"^DD",101.24,101.24,.05,23,1,0)
The Labs Tab does not have a value for this field.  The CPRS executable
"^DD",101.24,101.24,.05,23,2,0)
calls separate RPC's for each report.
"^DD",101.24,101.24,.05,"DT")
3040126
"^DD",101.24,101.24,.06,0)
ENTRY POINT^FI^^0;6^K:$L(X)>8!($L(X)<1) X
"^DD",101.24,101.24,.06,3)
Answer must be 1-8 characters in length.
"^DD",101.24,101.24,.06,8.5)
@
"^DD",101.24,101.24,.06,9)
@
"^DD",101.24,101.24,.06,21,0)
^.001^2^2^3001026^^
"^DD",101.24,101.24,.06,21,1,0)
This is the entry point for the ROUTINE that is invoked to produce the
"^DD",101.24,101.24,.06,21,2,0)
report.
"^DD",101.24,101.24,.06,23,0)
^.001^2^2^3001026^^
"^DD",101.24,101.24,.06,23,1,0)
The Labs Tab does not have a value for this field.  The CPRS executable
"^DD",101.24,101.24,.06,23,2,0)
calls separate RPC's for each report.
"^DD",101.24,101.24,.06,"DT")
3040126
"^DD",101.24,101.24,.07,0)
CATEGORY^S^0:FIXED;1:FIXED W/DATE;2:FIXED W/HEADER;3:FIXED W/DATE&HEADER;4:SPECIALIZED;5:GRAPHIC;6:LISTVIEW;^0;7^Q
"^DD",101.24,101.24,.07,3)
Enter a category for this report
"^DD",101.24,101.24,.07,21,0)
^^2^2^3001004^
"^DD",101.24,101.24,.07,21,1,0)
This field puts reports into a category that is evaluated by the GUI
"^DD",101.24,101.24,.07,21,2,0)
when the report is processed.
"^DD",101.24,101.24,.07,"DT")
3010215
"^DD",101.24,101.24,.08,0)
TAB^S^R:REPORTS TAB;L:LABS TAB;C:COVER SHEET;CD:COVER SHEET DETAILS;^0;8^Q
"^DD",101.24,101.24,.08,3)
Enter the appropriate code for this report.
"^DD",101.24,101.24,.08,21,0)
^.001^1^1^3001003^^
"^DD",101.24,101.24,.08,21,1,0)
This fields identifies the appropriate tab for a report in CPRS.
"^DD",101.24,101.24,.08,"DT")
3001011
"^DD",101.24,101.24,.09,0)
MIXEDCASE^S^1:YES;^0;9^Q
"^DD",101.24,101.24,.09,3)
Enter YES to display the list in mixed case
"^DD",101.24,101.24,.09,21,0)
^^2^2^3001004^
"^DD",101.24,101.24,.09,21,1,0)
This is used in the cover sheet and is used to display the returned
"^DD",101.24,101.24,.09,21,2,0)
list in mixed case.
"^DD",101.24,101.24,.09,"DT")
3001004
"^DD",101.24,101.24,.1,0)
INVERT^S^1:YES;^0;10^Q
"^DD",101.24,101.24,.1,3)
Enter YES to have the returned list inverted.
"^DD",101.24,101.24,.1,21,0)
^^1^1^3001004^
"^DD",101.24,101.24,.1,21,1,0)
This field is used to invert a list of data returned in the Cover sheet
"^DD",101.24,101.24,.1,"DT")
3001004
"^DD",101.24,101.24,.11,0)
TEXT COLOR^S^Black:BLACK;Maroon:MAROON;Green:GREEN;Olive:OLIVE;Purple:PURPLE;Teal:TEAL;Red:RED;Lime:LIME;Yellow:YELLOW;Blue:BLUE;Fuchsia:FUCHSIA;Aqua:AQUA;^0;11^Q
"^DD",101.24,101.24,.11,3)
Enter the color for the text
"^DD",101.24,101.24,.11,21,0)
^^1^1^3001004^
"^DD",101.24,101.24,.11,21,1,0)
This field determines the text color for the returned data.
"^DD",101.24,101.24,.11,"DT")
3001004
"^DD",101.24,101.24,.12,0)
TYPE^S^R:REPORT;H:HTML;L:LISTMAN ONLY;S:SELECTION LIST;V:LISTVIEW;M:MENU;G:GRAPH;^0;12^Q
"^DD",101.24,101.24,.12,3)
Enter the type for this entry.
"^DD",101.24,101.24,.12,21,0)
^.001^1^1^3001017^^
"^DD",101.24,101.24,.12,21,1,0)
This field identifies the type for an entry.
"^DD",101.24,101.24,.12,"DT")
3041208
"^DD",101.24,101.24,.13,0)
RPC^P8994'^XWB(8994,^0;13^Q
"^DD",101.24,101.24,.13,3)
Select the RPC that produces this report.
"^DD",101.24,101.24,.13,21,0)
^^1^1^3001004^
"^DD",101.24,101.24,.13,21,1,0)
This is the RPC that is called inside the GUI to produce the report.
"^DD",101.24,101.24,.13,"DT")
3001004
"^DD",101.24,101.24,.14,0)
DATE FORMAT^S^D:DATE ONLY;T:DATE WITH TIME;^0;14^Q
"^DD",101.24,101.24,.14,3)
Enter the code for the desired date format.
"^DD",101.24,101.24,.14,21,0)
^^1^1^3001004^
"^DD",101.24,101.24,.14,21,1,0)
This field determines what kind of format to display date/time fields.
"^DD",101.24,101.24,.14,"DT")
3001004
"^DD",101.24,101.24,.15,0)
DATE PIECE^NJ2,0^^0;15^K:+X'=X!(X>15)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.24,101.24,.15,3)
Type a Number between 1 and 15, 0 Decimal Digits
"^DD",101.24,101.24,.15,21,0)
^^2^2^3001004^
"^DD",101.24,101.24,.15,21,1,0)
This is used on the Cover Sheet to determine which piece the date field
"^DD",101.24,101.24,.15,21,2,0)
occupies.
"^DD",101.24,101.24,.15,"DT")
3001004
"^DD",101.24,101.24,.16,0)
TAB POSITIONS^F^^0;16^K:$L(X)>15!($L(X)<1) X
"^DD",101.24,101.24,.16,3)
Answer must be 1-15 characters in length.
"^DD",101.24,101.24,.16,21,0)
^^2^2^3001005^
"^DD",101.24,101.24,.16,21,1,0)
This is the value that will be used for the Tab property for the listbox
"^DD",101.24,101.24,.16,21,2,0)
associated with this report on the Cover Sheet.
"^DD",101.24,101.24,.16,"DT")
3001005
"^DD",101.24,101.24,.17,0)
PIECES^F^^0;17^K:$L(X)>20!($L(X)<1) X
"^DD",101.24,101.24,.17,3)
Answer must be 1-20 characters in length.
"^DD",101.24,101.24,.17,21,0)
^^2^2^3001011^
"^DD",101.24,101.24,.17,21,1,0)
This field is used by the Cover Sheet to determine what pieces of data
"^DD",101.24,101.24,.17,21,2,0)
to display in the listbox.
"^DD",101.24,101.24,.17,"DT")
3001011
"^DD",101.24,101.24,.18,0)
DETAIL REPORT^*P101.24'^ORD(101.24,^0;18^S DIC("S")="I $P(^(0),""^"",8)=""CD""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",101.24,101.24,.18,3)
Enter the report to get the details for this report.
"^DD",101.24,101.24,.18,12)
Allow only Cover sheet detail type reports
"^DD",101.24,101.24,.18,12.1)
S DIC("S")="I $P(^(0),""^"",8)=""CD"""
"^DD",101.24,101.24,.18,21,0)
^^1^1^3001011^
"^DD",101.24,101.24,.18,21,1,0)
This field is used to get the details of an item on the cover sheet.
"^DD",101.24,101.24,.18,"DT")
3001011
"^DD",101.24,101.24,.19,0)
REPORT TAG^FI^^0;19^K:$L(X)>8!($L(X)<1) X
"^DD",101.24,101.24,.19,3)
Answer must be 1-8 characters in length.
"^DD",101.24,101.24,.19,21,0)
^.001^1^1^3010503^^
"^DD",101.24,101.24,.19,21,1,0)
This is the entry point tag for a report extract.
"^DD",101.24,101.24,.19,"DT")
3080507
"^DD",101.24,101.24,.191,0)
REPORT ROUTINE^FI^^0;20^K:$L(X)>8!($L(X)<3) X
"^DD",101.24,101.24,.191,3)
Answer must be 3-8 characters in length.
"^DD",101.24,101.24,.191,21,0)
^.001^1^1^3010503^^
"^DD",101.24,101.24,.191,21,1,0)
This is the routine associated with the REPORT TAG for report extracts.
"^DD",101.24,101.24,.191,"DT")
3070507
"^DD",101.24,101.24,.192,0)
REPORT COMPONENT^P142.1'^GMT(142.1,^0;21^Q
"^DD",101.24,101.24,.192,21,0)
^.001^1^1^3010503^^
"^DD",101.24,101.24,.192,21,1,0)
This is the report component associated with this report.
"^DD",101.24,101.24,.192,"DT")
3010503
"^DD",101.24,101.24,.21,0)
PARAM 1^F^^2;1^K:$L(X)>30!($L(X)<1) X
"^DD",101.24,101.24,.21,3)
Answer must be 1-30 characters in length.
"^DD",101.24,101.24,.21,21,0)
^^1^1^3001004^
"^DD",101.24,101.24,.21,21,1,0)
This is the 1st parameter passed to the RPC, if needed.
"^DD",101.24,101.24,.21,"DT")
3001004
"^DD",101.24,101.24,.22,0)
PARAM 2^F^^2;2^K:$L(X)>30!($L(X)<1) X
"^DD",101.24,101.24,.22,3)
Answer must be 1-30 characters in length.
"^DD",101.24,101.24,.22,21,0)
^^1^1^3001004^
"^DD",101.24,101.24,.22,21,1,0)
This is the 2nd parameter passed to the RPC, if needed.
"^DD",101.24,101.24,.22,"DT")
3001004
"^DD",101.24,101.24,.23,0)
HEADING^F^^2;3^K:$L(X)>75!($L(X)<1) X
"^DD",101.24,101.24,.23,1,0)
^.1^^0
"^DD",101.24,101.24,.23,3)
Answer must be 1-75 characters in length.
"^DD",101.24,101.24,.23,21,0)
^^1^1^3001031^
"^DD",101.24,101.24,.23,21,1,0)
This is the heading used on the Cover sheet for the list of items.
"^DD",101.24,101.24,.23,"DT")
3010510
"^DD",101.24,101.24,.24,0)
DESCRIPTIVE TEXT^RF^^2;4^K:$L(X)>55!($L(X)<2) X
"^DD",101.24,101.24,.24,3)
Answer must be 2-55 characters in length.
"^DD",101.24,101.24,.24,21,0)
^.001^2^2^3010510^^
"^DD",101.24,101.24,.24,21,1,0)
This is a more descriptive name than what might be included in the 
"^DD",101.24,101.24,.24,21,2,0)
NAME field.
"^DD",101.24,101.24,.24,"DT")
3010510
"^DD",101.24,101.24,.25,0)
NODE^F^^2;5^K:$L(X)>10!($L(X)<1) X
"^DD",101.24,101.24,.25,3)
Answer must be 1-10 characters in length.
"^DD",101.24,101.24,.25,21,0)
^^2^2^3001005^
"^DD",101.24,101.24,.25,21,1,0)
This is used by the Cover Sheet routines to define the node in the ^XTMP
"^DD",101.24,101.24,.25,21,2,0)
global to store the data.
"^DD",101.24,101.24,.25,"DT")
3001005
"^DD",101.24,101.24,.26,0)
PRINT TAG^FI^^2;6^K:$L(X)>8!($L(X)<1) X
"^DD",101.24,101.24,.26,3)
Answer must be 1-8 characters in length.
"^DD",101.24,101.24,.26,21,0)
^^2^2^3010614^
"^DD",101.24,101.24,.26,21,1,0)
This is the entry point tag used when printing reports that do their own
"^DD",101.24,101.24,.26,21,2,0)
Write statements.
"^DD",101.24,101.24,.26,"DT")
3070507
"^DD",101.24,101.24,.27,0)
PRINT ROUTINE^FI^^2;7^K:$L(X)>8!($L(X)<1) X
"^DD",101.24,101.24,.27,3)
Answer must be 1-8 characters in length.
"^DD",101.24,101.24,.27,21,0)
^^2^2^3010614^
"^DD",101.24,101.24,.27,21,1,0)
This is the entry point routine used when printing reports that do their own
"^DD",101.24,101.24,.27,21,2,0)
Write statements.
"^DD",101.24,101.24,.27,"DT")
3070507
"^DD",101.24,101.24,.28,0)
EXTRACT TAG^FI^^2;8^K:$L(X)>8!($L(X)<1) X
"^DD",101.24,101.24,.28,3)
Answer must be 1-8 characters in length.
"^DD",101.24,101.24,.28,21,0)
^^2^2^3010711^
"^DD",101.24,101.24,.28,21,1,0)
This is the entry point for the extract routine that pulls the data from
"^DD",101.24,101.24,.28,21,2,0)
package API's and/or package files.
"^DD",101.24,101.24,.28,"DT")
3080318
"^DD",101.24,101.24,.29,0)
EXTRACT ROUTINE^FI^^2;9^K:$L(X)>8!($L(X)<1) X
"^DD",101.24,101.24,.29,3)
Answer must be 1-8 characters in length.
"^DD",101.24,101.24,.29,21,0)
^^2^2^3010711^
"^DD",101.24,101.24,.29,21,1,0)
This is the extract routine that pulls data from package API's and/or
"^DD",101.24,101.24,.29,21,2,0)
package files.
"^DD",101.24,101.24,.29,"DT")
3070507
"^DD",101.24,101.24,.41,0)
SORT ORDER^F^^4;1^K:$L(X)>15!($L(X)<3)!'(X?1N1":"1N) X
"^DD",101.24,101.24,.41,3)
Answer must be 3-15 characters in length.
"^DD",101.24,101.24,.41,21,0)
^^6^6^3010717^
"^DD",101.24,101.24,.41,21,1,0)
This field is used when sorting columns of data on at grid within CPRS.
"^DD",101.24,101.24,.41,21,2,0)
It determines the sort order to be used in a multi-column sort.  The
"^DD",101.24,101.24,.41,21,3,0)
primary sort column is always the column header clicked on by the user.
"^DD",101.24,101.24,.41,21,4,0)
If this field has values in the form #:#, then a multi-column sort is
"^DD",101.24,101.24,.41,21,5,0)
done, using the column numbers identified in this field for the second
"^DD",101.24,101.24,.41,21,6,0)
and third level sorting.
"^DD",101.24,101.24,.41,"DT")
3010717
"^DD",101.24,101.24,.42,0)
MAXIMUM DAYS BACK^NJ4,0^^4;2^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.24,101.24,.42,3)
Type a Number between 1 and 9999, 0 Decimal Digits
"^DD",101.24,101.24,.42,21,0)
^^1^1^3011004^
"^DD",101.24,101.24,.42,21,1,0)
This field restricts the report date range to the maximum value specified.
"^DD",101.24,101.24,.42,"DT")
3011004
"^DD",101.24,101.24,.43,0)
FHIE REPORT^F^^4;3^K:$L(X)>10!($L(X)<2) X
"^DD",101.24,101.24,.43,3)
Answer must be 2-10 characters in length.
"^DD",101.24,101.24,.43,21,0)
^.001^3^3^3040126^^^^
"^DD",101.24,101.24,.43,21,1,0)
This field identifies reports that are available through FHIE.
"^DD",101.24,101.24,.43,21,2,0)
The item in this field is the code for the report available through
"^DD",101.24,101.24,.43,21,3,0)
the FHIE server.
"^DD",101.24,101.24,.43,23,0)
^.001^3^3^3040126^^^^
"^DD",101.24,101.24,.43,23,1,0)
This field is not looked at by reports that have a 'listview' format.
"^DD",101.24,101.24,.43,23,2,0)
It is only used by straight text reports that go through the routine:
"^DD",101.24,101.24,.43,23,3,0)
  ORDV01
"^DD",101.24,101.24,.43,"DT")
3031008
"^DD",101.24,101.24,.44,0)
DIRECT^S^0:NO;1:YES;^4;4^Q
"^DD",101.24,101.24,.44,3)
ENTER YES TO MAKE DIRECT REMOTE DATA CALLS
"^DD",101.24,101.24,.44,21,0)
^^4^4^3050201^
"^DD",101.24,101.24,.44,21,1,0)
This field allows a report to make a direct remote data call to
"^DD",101.24,101.24,.44,21,2,0)
a remote site.  Use caution in setting this field to yes.  It has
"^DD",101.24,101.24,.44,21,3,0)
the effect of disabling CPRS until the remote call is finished, but
"^DD",101.24,101.24,.44,21,4,0)
also may speed up the query by bypassing taskman latency.
"^DD",101.24,101.24,.44,"DT")
3050201
"^DD",101.24,101.24,.45,0)
HDR REPORT^S^1:YES;^4;5^Q
"^DD",101.24,101.24,.45,3)
Enter 'YES' if this report comes from the HDR.
"^DD",101.24,101.24,.45,21,0)
^^1^1^3051006^
"^DD",101.24,101.24,.45,21,1,0)
This field flags reports that are generated from the HDR.
"^DD",101.24,101.24,.45,"DT")
3051006
"^DD",101.24,101.24,.46,0)
HDR ROUTINE^FI^^4;6^K:$L(X)>8!($L(X)<1) X
"^DD",101.24,101.24,.46,3)
Answer must be 1-8 characters in length.
"^DD",101.24,101.24,.46,21,0)
^^1^1^3051006^
"^DD",101.24,101.24,.46,21,1,0)
This is the HDR routine that modifies HDR data for CPRS.
"^DD",101.24,101.24,.46,"DT")
3080318
"^DD",101.24,101.24,.47,0)
HDR ENTRY POINT^FI^^4;7^K:$L(X)>8!($L(X)<1) X
"^DD",101.24,101.24,.47,3)
Answer must be 1-8 characters in length.
"^DD",101.24,101.24,.47,21,0)
^^1^1^3051006^
"^DD",101.24,101.24,.47,21,1,0)
This is the HDR entry point that modifies HDR data for CPRS.
"^DD",101.24,101.24,.47,"DT")
3080318
"^DD",101.24,101.24,.48,0)
FHIE DATA^S^1:YES;^4;8^Q
"^DD",101.24,101.24,.48,3)
Enter YES if this report gets data from DOD/FHIE
"^DD",101.24,101.24,.48,21,0)
^.001^3^3^3070208^^
"^DD",101.24,101.24,.48,21,1,0)
This field is used to tell CPRS that DOD/FHIE data can be accessed
"^DD",101.24,101.24,.48,21,2,0)
for this report.  Special code has to be written by CPRS and DOD
"^DD",101.24,101.24,.48,21,3,0)
for this to happen.
"^DD",101.24,101.24,.48,"DT")
3070208
"^DD",101.24,101.24,.49,0)
FHIE ONLY^S^1:YES;^4;9^Q
"^DD",101.24,101.24,.49,3)
Enter YES if only DOD data should be shown for this report.
"^DD",101.24,101.24,.49,21,0)
^^2^2^3080415^
"^DD",101.24,101.24,.49,21,1,0)
This field determines if a report can show local VA data and Remote DOD
"^DD",101.24,101.24,.49,21,2,0)
data. Enter YES if only DOD data should be shown for this report.
"^DD",101.24,101.24,.49,"DT")
3080415
"^DD",101.24,101.24,.491,0)
DISABLE^S^1:YES;^4;10^Q
"^DD",101.24,101.24,.491,3)
Enter YES to disable this report.
"^DD",101.24,101.24,.491,21,0)
^^1^1^3080416^
"^DD",101.24,101.24,.491,21,1,0)
This field will disable a report.
"^DD",101.24,101.24,.491,"DT")
3080416
"^DD",101.24,101.24,3,0)
COLUMN HEADERS^101.243^^3;0
"^DD",101.24,101.24,10,0)
ITEM^101.241P^^10;0
"^DD",101.24,101.241,0)
ITEM SUB-FIELD^^.03^3
"^DD",101.24,101.241,0,"DT")
3010215
"^DD",101.24,101.241,0,"IX","B",101.241,.01)

"^DD",101.24,101.241,0,"NM","ITEM")

"^DD",101.24,101.241,0,"UP")
101.24
"^DD",101.24,101.241,.01,0)
ITEM^MP101.24^ORD(101.24,^0;1^Q
"^DD",101.24,101.241,.01,1,0)
^.1
"^DD",101.24,101.241,.01,1,1,0)
101.241^B
"^DD",101.24,101.241,.01,1,1,1)
S ^ORD(101.24,DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",101.24,101.241,.01,1,1,2)
K ^ORD(101.24,DA(1),10,"B",$E(X,1,30),DA)
"^DD",101.24,101.241,.01,3)

"^DD",101.24,101.241,.01,21,0)
^^1^1^3010215^
"^DD",101.24,101.241,.01,21,1,0)
This is used in building a treeview of reports for CPRS GUI.
"^DD",101.24,101.241,.01,"DT")
3010215
"^DD",101.24,101.241,.02,0)
HEADER TEXT^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",101.24,101.241,.02,3)
Answer must be 1-30 characters in length.
"^DD",101.24,101.241,.02,21,0)
^^1^1^3010215^
"^DD",101.24,101.241,.02,21,1,0)
This is the header to be used.
"^DD",101.24,101.241,.02,"DT")
3010215
"^DD",101.24,101.241,.03,0)
SEQUENCE^NJ7,1^^0;3^K:+X'=X!(X>99999)!(X<.1)!(X?.E1"."2N.N) X
"^DD",101.24,101.241,.03,3)
Type a Number between .1 and 99999, 1 Decimal Digit
"^DD",101.24,101.241,.03,21,0)
^^1^1^3010215^
"^DD",101.24,101.241,.03,21,1,0)
This is the sequence number for this report.
"^DD",101.24,101.241,.03,"DT")
3010215
"^DD",101.24,101.243,0)
COLUMN HEADERS SUB-FIELD^^1^11
"^DD",101.24,101.243,0,"DT")
3051006
"^DD",101.24,101.243,0,"IX","B",101.243,.01)

"^DD",101.24,101.243,0,"IX","C",101.243,.03)

"^DD",101.24,101.243,0,"NM","COLUMN HEADERS")

"^DD",101.24,101.243,0,"UP")
101.24
"^DD",101.24,101.243,.01,0)
COLUMN HEADERS^MF^^0;1^K:$L(X)>60!($L(X)<1) X
"^DD",101.24,101.243,.01,1,0)
^.1
"^DD",101.24,101.243,.01,1,1,0)
101.243^B
"^DD",101.24,101.243,.01,1,1,1)
S ^ORD(101.24,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",101.24,101.243,.01,1,1,2)
K ^ORD(101.24,DA(1),3,"B",$E(X,1,30),DA)
"^DD",101.24,101.243,.01,3)
Answer must be 1-60 characters in length.
"^DD",101.24,101.243,.01,21,0)
^.001^1^1^3010709^^^^
"^DD",101.24,101.243,.01,21,1,0)
These are the column headings used on a report in ListView format.
"^DD",101.24,101.243,.01,"DT")
3010709
"^DD",101.24,101.243,.02,0)
VISIBLE^S^0:YES;1:NO;^0;2^Q
"^DD",101.24,101.243,.02,3)
Set this field to NO to hide the column.
"^DD",101.24,101.243,.02,21,0)
^^1^1^3010420^
"^DD",101.24,101.243,.02,21,1,0)
This field determines the visible property of the column.
"^DD",101.24,101.243,.02,"DT")
3010420
"^DD",101.24,101.243,.03,0)
SEQUENCE^NJ6,1^^0;3^K:+X'=X!(X>9999)!(X<.1)!(X?.E1"."2N.N) X
"^DD",101.24,101.243,.03,1,0)
^.1
"^DD",101.24,101.243,.03,1,1,0)
101.243^C
"^DD",101.24,101.243,.03,1,1,1)
S ^ORD(101.24,DA(1),3,"C",$E(X,1,30),DA)=""
"^DD",101.24,101.243,.03,1,1,2)
K ^ORD(101.24,DA(1),3,"C",$E(X,1,30),DA)
"^DD",101.24,101.243,.03,1,1,"DT")
3010321
"^DD",101.24,101.243,.03,3)
Type a Number between .1 and 9999, 1 Decimal Digit
"^DD",101.24,101.243,.03,21,0)
^^1^1^3010215^
"^DD",101.24,101.243,.03,21,1,0)
This is the sequence for the column header.
"^DD",101.24,101.243,.03,"DT")
3010321
"^DD",101.24,101.243,.04,0)
TYPE^S^0:SINGLE PIECE VALUE;1:WORD PROCESSING;^0;4^Q
"^DD",101.24,101.243,.04,3)
Enter '1' if the value of this column contains multiple lines of text.
"^DD",101.24,101.243,.04,21,0)
^^1^1^3010420^
"^DD",101.24,101.243,.04,21,1,0)
This field identifies columns that contain multiple lines of text.
"^DD",101.24,101.243,.04,"DT")
3010420
"^DD",101.24,101.243,.05,0)
INCLUDE ON DETAIL^S^0:NO;1:YES;^0;5^Q
"^DD",101.24,101.243,.05,3)
Enter YES to include this field in detailed report
"^DD",101.24,101.243,.05,21,0)
^.001^2^2^3010628^^^^
"^DD",101.24,101.243,.05,21,1,0)
This field is used to determine what data to include in the details of
"^DD",101.24,101.243,.05,21,2,0)
a report.
"^DD",101.24,101.243,.05,"DT")
3010628
"^DD",101.24,101.243,.06,0)
PRINT LENGTH^NJ2,0^^0;6^K:+X'=X!(X>20)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.24,101.243,.06,3)
Type a Number between 1 and 20, 0 Decimal Digits
"^DD",101.24,101.243,.06,21,0)
^^1^1^3010628^
"^DD",101.24,101.243,.06,21,1,0)
This is the field length used when printing this column on a report.
"^DD",101.24,101.243,.06,"DT")
3010628
"^DD",101.24,101.243,.07,0)
INCLUDE ON PRINT^S^0:NO;1:YES;^0;7^Q
"^DD",101.24,101.243,.07,21,0)
^^2^2^3010628^
"^DD",101.24,101.243,.07,21,1,0)
This field determines which columns are included when a printout is
"^DD",101.24,101.243,.07,21,2,0)
requested.
"^DD",101.24,101.243,.07,"DT")
3010628
"^DD",101.24,101.243,.08,0)
PRINT TITLE^F^^0;8^K:$L(X)>20!($L(X)<1) X
"^DD",101.24,101.243,.08,3)
Answer must be 1-20 characters in length.
"^DD",101.24,101.243,.08,21,0)
^^1^1^3010628^
"^DD",101.24,101.243,.08,21,1,0)
This field is used when printing this field in lieu of the Column Header.
"^DD",101.24,101.243,.08,"DT")
3010628
"^DD",101.24,101.243,.09,0)
DATA TYPE^S^0:FREE TEXT;1:NUMERIC;2:DATE/TIME;^0;9^Q
"^DD",101.24,101.243,.09,3)
Enter the type of data that is in this column.
"^DD",101.24,101.243,.09,21,0)
^.001^3^3^3010718^^
"^DD",101.24,101.243,.09,21,1,0)
This is the data type of the column.  It is used when sorting columns.
"^DD",101.24,101.243,.09,21,2,0)
The default data type is 0 - FREE TEXT.  If no value is entered, it is
"^DD",101.24,101.243,.09,21,3,0)
assumed to be FREE TEXT.
"^DD",101.24,101.243,.09,"DT")
3010718
"^DD",101.24,101.243,.1,0)
WIDTH^NJ4,0^^0;10^K:+X'=X!(X>4000)!(X<-2)!(X?.E1"."1N.N) X
"^DD",101.24,101.243,.1,3)
Type a Number between -2 and 4000, 0 Decimal Digits
"^DD",101.24,101.243,.1,21,0)
^^5^5^3010727^
"^DD",101.24,101.243,.1,21,1,0)
This field is for the column width.  No value needs to be entered because
"^DD",101.24,101.243,.1,21,2,0)
the value is actually obtained from a User level parameter.  The field
"^DD",101.24,101.243,.1,21,3,0)
is defined here to reserve the 10 piece of this node so that future
"^DD",101.24,101.243,.1,21,4,0)
field definitions won't break the RPC used in CPRS to get column properties
"^DD",101.24,101.243,.1,21,5,0)
where the width is stored in the 10 piece.
"^DD",101.24,101.243,.1,"DT")
3010727
"^DD",101.24,101.243,1,0)
HDR MODIFIER^K^^1;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.24,101.243,1,3)
This is Standard MUMPS code.
"^DD",101.24,101.243,1,9)
@
"^DD",101.24,101.243,1,21,0)
^^5^5^3051006^
"^DD",101.24,101.243,1,21,1,0)
This is code executed when HDR data needs to be modified.
"^DD",101.24,101.243,1,21,2,0)
When this field is executed, the variable ORX will have the value
"^DD",101.24,101.243,1,21,3,0)
passed in from the HDR.  If this value needs to be manipulated, set the
"^DD",101.24,101.243,1,21,4,0)
new value into ORX.  If the value is ignored (not to be displayed),
"^DD",101.24,101.243,1,21,5,0)
then set the value of ORX="-1-"
"^DD",101.24,101.243,1,"DT")
3051006
"^DD",101.41,101.41,0)
FIELD^^99^31
"^DD",101.41,101.41,0,"DDA")
N
"^DD",101.41,101.41,0,"DT")
3010724
"^DD",101.41,101.41,0,"IX","AB",101.41,.01)

"^DD",101.41,101.41,0,"IX","AD",101.412,2)

"^DD",101.41,101.41,0,"IX","AM",101.41,99)

"^DD",101.41,101.41,0,"IX","AM2",101.41,2)

"^DD",101.41,101.41,0,"IX","AM51",101.41,51)

"^DD",101.41,101.41,0,"IX","AM52",101.41,52)

"^DD",101.41,101.41,0,"IX","AMM",101.412,.01)

"^DD",101.41,101.41,0,"IX","AMM2",101.412,2)

"^DD",101.41,101.41,0,"IX","AMM3",101.412,3)

"^DD",101.41,101.41,0,"IX","AMM4",101.412,4)

"^DD",101.41,101.41,0,"IX","AMM5",101.412,5)

"^DD",101.41,101.41,0,"IX","APKG",101.41,7)

"^DD",101.41,101.41,0,"IX","C",101.41,2)

"^DD",101.41,101.41,0,"NM","ORDER DIALOG")

"^DD",101.41,101.41,0,"PT",100,2)

"^DD",101.41,101.41,0,"PT",100,7)

"^DD",101.41,101.41,0,"PT",100.045,.02)

"^DD",101.41,101.41,0,"PT",100.5,4)

"^DD",101.41,101.41,0,"PT",100.5,5)

"^DD",101.41,101.41,0,"PT",100.98,4)

"^DD",101.41,101.41,0,"PT",101.141,.03)

"^DD",101.41,101.41,0,"PT",101.412,1)

"^DD",101.41,101.41,0,"PT",101.412,2)

"^DD",101.41,101.41,0,"PT",101.415,2)

"^DD",101.41,101.41,0,"PT",101.416,.02)

"^DD",101.41,101.41,0,"PT",101.441,.01)

"^DD",101.41,101.41,0,"PT",801.41,15)

"^DD",101.41,101.41,0,"PT",801.4118,.01)

"^DD",101.41,101.41,0,"VRPK")
ORDER ENTRY/RESULTS REPORTING
"^DD",101.41,101.41,0,"VRRV")
1^3010724
"^DD",101.41,101.41,.01,0)
NAME^RF^^0;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>63!($L(X)<3)!'(X'?1P.E) X
"^DD",101.41,101.41,.01,1,0)
^.1^^-1
"^DD",101.41,101.41,.01,1,2,0)
101.41^AB
"^DD",101.41,101.41,.01,1,2,1)
S ^ORD(101.41,"AB",$E(X,1,63),DA)=""
"^DD",101.41,101.41,.01,1,2,2)
K ^ORD(101.41,"AB",$E(X,1,63),DA)
"^DD",101.41,101.41,.01,1,2,"%D",0)
^^1^1^2971020^
"^DD",101.41,101.41,.01,1,2,"%D",1,0)
This is a regular index on the full 63 characters of the Name field.
"^DD",101.41,101.41,.01,1,2,"DT")
2971020
"^DD",101.41,101.41,.01,3)
Answer must be 3-63 characters in length.
"^DD",101.41,101.41,.01,21,0)
^^3^3^2971219^
"^DD",101.41,101.41,.01,21,1,0)
This is the name of the dialog; entries that were converted from the
"^DD",101.41,101.41,.01,21,2,0)
Protocol file will retain the same name.  Namespacing is not required,
"^DD",101.41,101.41,.01,21,3,0)
but still encouraged.
"^DD",101.41,101.41,.01,"DT")
2971020
"^DD",101.41,101.41,2,0)
DISPLAY TEXT^FX^^0;2^K:$L(X)>80!($L(X)<3)!($$CHKNAM^ORUTL(X)) X
"^DD",101.41,101.41,2,1,0)
^.1
"^DD",101.41,101.41,2,1,1,0)
101.41^C
"^DD",101.41,101.41,2,1,1,1)
S ^ORD(101.41,"C",$$UP^XLFSTR($E(X,1,63)),DA)=""
"^DD",101.41,101.41,2,1,1,2)
K ^ORD(101.41,"C",$$UP^XLFSTR($E(X,1,63)),DA)
"^DD",101.41,101.41,2,1,1,"DT")
2950112
"^DD",101.41,101.41,2,1,2,0)
101.41^AM2^MUMPS
"^DD",101.41,101.41,2,1,2,1)
D REDOM^ORDD41
"^DD",101.41,101.41,2,1,2,2)
D REDOM^ORDD41
"^DD",101.41,101.41,2,1,2,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.41,2,1,2,"%D",1,0)
Update TIMESTAMP whenever DISPLAY TEXT is changed.
"^DD",101.41,101.41,2,1,2,"DT")
2990210
"^DD",101.41,101.41,2,3)
Answer must be 3-80 characters in length and cannot contain a semicolon (;), a comma (,), an up-arrow (^), a dash (-), or an equal sign (=). 
"^DD",101.41,101.41,2,21,0)
^.001^1^1^3010913^^^^
"^DD",101.41,101.41,2,21,1,0)
The text of this dialog's name as it appears on a menu or subheader.
"^DD",101.41,101.41,2,"DT")
3000823
"^DD",101.41,101.41,3,0)
DISABLE^F^^0;3^K:$L(X)>40!($L(X)<1) X
"^DD",101.41,101.41,3,3)
Enter a message here to disable this dialog, 1-40 characters in length.
"^DD",101.41,101.41,3,21,0)
^^3^3^2950112^
"^DD",101.41,101.41,3,21,1,0)
This field disables use of this dialog when it contains text.  The text
"^DD",101.41,101.41,3,21,2,0)
should be a short message explaining why use of this dialog has been
"^DD",101.41,101.41,3,21,3,0)
disabled, as it will be displayed if this dialog is selected.
"^DD",101.41,101.41,3,"DT")
2950112
"^DD",101.41,101.41,4,0)
TYPE^RS^P:prompt;D:dialog;Q:quick order;O:order set;M:menu;A:action;H:html;^0;4^Q
"^DD",101.41,101.41,4,3)
Specify a type for this dialog.
"^DD",101.41,101.41,4,21,0)
^^5^5^2950716^^^^
"^DD",101.41,101.41,4,21,1,0)
This field defines the type of order dialog to be processed.  Control
"^DD",101.41,101.41,4,21,2,0)
will be passed to the OE/RR Dialog Processor for dialog items; menu types
"^DD",101.41,101.41,4,21,3,0)
are used for displaying and selecting dialog items.  Action types will only
"^DD",101.41,101.41,4,21,4,0)
execute the entry and exit actions, ignoring any items that may exist; these
"^DD",101.41,101.41,4,21,5,0)
dialogs should not create entries in the Orders file.
"^DD",101.41,101.41,4,"DT")
3010430
"^DD",101.41,101.41,5,0)
DISPLAY GROUP^P100.98'^ORD(100.98,^0;5^Q
"^DD",101.41,101.41,5,3)
Enter the display group containing orderable items defined by this dialog.
"^DD",101.41,101.41,5,21,0)
^^3^3^2950112^
"^DD",101.41,101.41,5,21,1,0)
This field determines what display group this dialog has been defined for.
"^DD",101.41,101.41,5,21,2,0)
It will define which orderable items are selectable with this dialog,
"^DD",101.41,101.41,5,21,3,0)
as well as what service to send the order to when it is complete.
"^DD",101.41,101.41,5,"DT")
2950112
"^DD",101.41,101.41,6,0)
SIGNATURE REQUIRED^S^0:NONE;1:ORELSE;2:ORES;^0;6^Q
"^DD",101.41,101.41,6,3)
Enter the OR key required to sign orders created by this dialog
"^DD",101.41,101.41,6,21,0)
^^6^6^2970318^^
"^DD",101.41,101.41,6,21,1,0)
This field indicates what signature will be required for orders created by
"^DD",101.41,101.41,6,21,2,0)
this dialog, to be considered complete and ready to release to the service
"^DD",101.41,101.41,6,21,3,0)
for action.  If this flag is set to NO and the dialog contains a prompt
"^DD",101.41,101.41,6,21,4,0)
for item(s) from the Orderable Item file, the order created may still
"^DD",101.41,101.41,6,21,5,0)
require a signature if any of the items ordered are individually flagged
"^DD",101.41,101.41,6,21,6,0)
as requiring a signature.
"^DD",101.41,101.41,6,"DT")
2970318
"^DD",101.41,101.41,7,0)
PACKAGE^P9.4'^DIC(9.4,^0;7^Q
"^DD",101.41,101.41,7,1,0)
^.1
"^DD",101.41,101.41,7,1,1,0)
101.41^APKG
"^DD",101.41,101.41,7,1,1,1)
S ^ORD(101.41,"APKG",$E(X,1,30),DA)=""
"^DD",101.41,101.41,7,1,1,2)
K ^ORD(101.41,"APKG",$E(X,1,30),DA)
"^DD",101.41,101.41,7,1,1,"DT")
2970325
"^DD",101.41,101.41,7,3)
Enter the VISTA package that is to receive orders created by this dialog.
"^DD",101.41,101.41,7,21,0)
^^3^3^2950208^
"^DD",101.41,101.41,7,21,1,0)
This is the VISTA package that is intended to receive orders created by
"^DD",101.41,101.41,7,21,2,0)
this dialog; this is required for creating the HL7 messages to pass the
"^DD",101.41,101.41,7,21,3,0)
order.
"^DD",101.41,101.41,7,"DT")
2970325
"^DD",101.41,101.41,8,0)
VERIFY ORDER^S^1:YES;0:NO;^0;8^Q
"^DD",101.41,101.41,8,3)
Enter YES to have orders created by this dialog presented to the user before saving, with the opportunity to edit.
"^DD",101.41,101.41,8,21,0)
^^3^3^2950623^
"^DD",101.41,101.41,8,21,1,0)
This field is a flag, which determines if the order created by this dialog
"^DD",101.41,101.41,8,21,2,0)
will be presented to the user for verification before saving in the Orders
"^DD",101.41,101.41,8,21,3,0)
file; for most quick orders, this flag should be set to 0 (no).
"^DD",101.41,101.41,8,"DT")
2950623
"^DD",101.41,101.41,9,0)
ASK FOR ANOTHER ORDER^S^0:NO;1:YES;2:YES-DON'T ASK;^0;9^Q
"^DD",101.41,101.41,9,3)
Enter YES to have the user asked to enter another order from this dialog before exiting.
"^DD",101.41,101.41,9,21,0)
^^6^6^2970616^^^
"^DD",101.41,101.41,9,21,1,0)
This field allows the user to add another order from this dialog, when the
"^DD",101.41,101.41,9,21,2,0)
initial order is accepted and placed; if set to YES, the user will be
"^DD",101.41,101.41,9,21,3,0)
asked "Add another <dialog display text> order?" to allow for either
"^DD",101.41,101.41,9,21,4,0)
exiting the processor or adding an additional order of the same type.
"^DD",101.41,101.41,9,21,5,0)
This field can also be set to YES-DON'T ASK to force the processor to
"^DD",101.41,101.41,9,21,6,0)
automatically drop into prompting for another order without asking first.
"^DD",101.41,101.41,9,"DT")
2970616
"^DD",101.41,101.41,10,0)
ITEMS^101.412IA^^10;0
"^DD",101.41,101.41,10,21,0)
^^5^5^2990211^^^^
"^DD",101.41,101.41,10,21,1,0)
This field contains the components for dialogs:
"^DD",101.41,101.41,10,21,2,0)
     Dialogs      -> prompts
"^DD",101.41,101.41,10,21,3,0)
     Quick orders -> prompts (completed)
"^DD",101.41,101.41,10,21,4,0)
     Order sets   -> dialogs or quick orders
"^DD",101.41,101.41,10,21,5,0)
     Menus        -> dialogs, quick orders, or order sets
"^DD",101.41,101.41,11,0)
DATA TYPE^S^D:date/time;R:free text date/time;F:free text;N:numeric;S:set of codes;Y:yes/no;P:pointer;W:word processing;^1;1^Q
"^DD",101.41,101.41,11,3)
Enter the type of data to be collected at this prompt.
"^DD",101.41,101.41,11,21,0)
^^2^2^2950823^^
"^DD",101.41,101.41,11,21,1,0)
This is the type of data being prompted for; this field is used to define
"^DD",101.41,101.41,11,21,2,0)
a call to the reader (^DIR) in most cases.
"^DD",101.41,101.41,11,23,0)
^^1^1^2950823^^
"^DD",101.41,101.41,11,23,1,0)
Used with Prompt-type only.
"^DD",101.41,101.41,11,"DT")
2950407
"^DD",101.41,101.41,12,0)
DOMAIN^F^^1;2^K:$L(X)>235!($L(X)<1) X
"^DD",101.41,101.41,12,3)
Answer must be 1-235 characters in length.
"^DD",101.41,101.41,12,21,0)
^^3^3^2990225^^^^
"^DD",101.41,101.41,12,21,1,0)
This is a parameter that may be used to further specify the data type.
"^DD",101.41,101.41,12,21,2,0)
The string stored here should be appropriate for the second ^-piece of
"^DD",101.41,101.41,12,21,3,0)
DIR(0) when used with the data type field.
"^DD",101.41,101.41,12,23,0)
^^1^1^2990225^^^^
"^DD",101.41,101.41,12,23,1,0)
Used with Prompt-type only.
"^DD",101.41,101.41,12,"DT")
2990225
"^DD",101.41,101.41,13,0)
ID^F^^1;3^K:$L(X)>10!($L(X)<2) X
"^DD",101.41,101.41,13,3)
Answer must be 2-10 characters in length.
"^DD",101.41,101.41,13,21,0)
^.001^20^20^3010727^^
"^DD",101.41,101.41,13,21,1,0)
This field may contain a single word identifier which will be
"^DD",101.41,101.41,13,21,2,0)
stored with the user response in the Orders file #100, where it
"^DD",101.41,101.41,13,21,3,0)
will be indexed for quick reference to certain values in the
"^DD",101.41,101.41,13,21,4,0)
order dialog.  The following are some examples of values
"^DD",101.41,101.41,13,21,5,0)
currently in use:
"^DD",101.41,101.41,13,21,6,0)
 
"^DD",101.41,101.41,13,21,7,0)
   START      -> Start date/time
"^DD",101.41,101.41,13,21,8,0)
   STOP       -> Stop date/time
"^DD",101.41,101.41,13,21,9,0)
   SCHEDULE   -> Administration Schedule
"^DD",101.41,101.41,13,21,10,0)
   ORDERABLE  -> Orderable Item
"^DD",101.41,101.41,13,21,11,0)
   DRUG       -> Dispense Drug
"^DD",101.41,101.41,13,21,12,0)
   CANCEL     -> Cancel Future Orders flag
"^DD",101.41,101.41,13,21,13,0)
   COMMENT    -> Word processing comments
"^DD",101.41,101.41,13,21,14,0)
 
"^DD",101.41,101.41,13,21,15,0)
These values must be unique among entries within an order dialog
"^DD",101.41,101.41,13,21,16,0)
but do not need to be unique across the entire file.  Be sure to
"^DD",101.41,101.41,13,21,17,0)
check the IDs assigned to generic text entries to make sure that
"^DD",101.41,101.41,13,21,18,0)
all IDs are unique.  In order to avoid potential problems it's
"^DD",101.41,101.41,13,21,19,0)
recommended that you use unique IDs for any local entries that you
"^DD",101.41,101.41,13,21,20,0)
create.
"^DD",101.41,101.41,13,"DT")
2960215
"^DD",101.41,101.41,17,0)
VALIDATION^K^^7;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.41,17,3)
This is Standard MUMPS code.
"^DD",101.41,101.41,17,9)
@
"^DD",101.41,101.41,17,21,0)
^^3^3^2960912^
"^DD",101.41,101.41,17,21,1,0)
This is MUMPS code that will be executed at the time of releasing an
"^DD",101.41,101.41,17,21,2,0)
order created with this dialog; dialog responses may be checked again
"^DD",101.41,101.41,17,21,3,0)
here before releasing the order to the service.
"^DD",101.41,101.41,17,"DT")
2960912
"^DD",101.41,101.41,19,0)
ADDITIONAL TEXT^K^^9;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.41,19,3)
This is Standard MUMPS code.
"^DD",101.41,101.41,19,9)
@
"^DD",101.41,101.41,19,21,0)
^^3^3^2960405^^
"^DD",101.41,101.41,19,21,1,0)
This is MUMPS code that will be executed when order ORIFN created by this
"^DD",101.41,101.41,19,21,2,0)
dialog is about to be displayed; any string that should be appended to the
"^DD",101.41,101.41,19,21,3,0)
order text should be returned in Y.
"^DD",101.41,101.41,19,"DT")
2960405
"^DD",101.41,101.41,20,0)
DESCRIPTION^101.411^^2;0
"^DD",101.41,101.41,20,21,0)
^^1^1^2971219^
"^DD",101.41,101.41,20,21,1,0)
This is a description of the dialog and its uses.
"^DD",101.41,101.41,21,0)
RESPONSES^101.416^^6;0
"^DD",101.41,101.41,21,21,0)
^^2^2^2971219^
"^DD",101.41,101.41,21,21,1,0)
This multiple contains any responses to prompts that have been pre-answered
"^DD",101.41,101.41,21,21,2,0)
to create a quick order.
"^DD",101.41,101.41,30,0)
ENTRY ACTION^K^^3;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.41,30,3)
This is Standard MUMPS code.
"^DD",101.41,101.41,30,9)
@
"^DD",101.41,101.41,30,21,0)
^^4^4^2950425^
"^DD",101.41,101.41,30,21,1,0)
This is MUMPS code that will be executed at the top of a dialog, prior to
"^DD",101.41,101.41,30,21,2,0)
the execution of any prompts; it may perform functions such as listing
"^DD",101.41,101.41,30,21,3,0)
the recent Radiology exams before ordering a new one, or alerting the
"^DD",101.41,101.41,30,21,4,0)
user to an existing diet order before making a change.
"^DD",101.41,101.41,30,"DT")
2950425
"^DD",101.41,101.41,31,0)
QUICK SETUP^K^^3.1;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.41,31,3)
This is Standard MUMPS code.
"^DD",101.41,101.41,31,9)
@
"^DD",101.41,101.41,31,21,0)
^^3^3^2970113^
"^DD",101.41,101.41,31,21,1,0)
This is MUMPS code that will be executed in the place of the Entry Action
"^DD",101.41,101.41,31,21,2,0)
when creating quick orders for this dialog; variables may be set here
"^DD",101.41,101.41,31,21,3,0)
instead to bypass the usual dependence on specific patient values.
"^DD",101.41,101.41,31,"DT")
2970113
"^DD",101.41,101.41,40,0)
EXIT ACTION^K^^4;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.41,40,3)
This is Standard MUMPS code.
"^DD",101.41,101.41,40,9)
@
"^DD",101.41,101.41,40,21,0)
^^2^2^2950622^
"^DD",101.41,101.41,40,21,1,0)
This is MUMPS code that will be executed upon completion of processing the
"^DD",101.41,101.41,40,21,2,0)
dialog; it is currently used only with dialog-type entries.
"^DD",101.41,101.41,40,"DT")
2950622
"^DD",101.41,101.41,50,0)
CONTROLS^101.415A^^50;0
"^DD",101.41,101.41,51,0)
COLUMN WIDTH^NJ3,0^^5;1^K:+X'=X!(X>240)!(X<20)!(X?.E1"."1N.N) X
"^DD",101.41,101.41,51,1,0)
^.1
"^DD",101.41,101.41,51,1,1,0)
101.41^AM51^MUMPS
"^DD",101.41,101.41,51,1,1,1)
D REDO^ORDD41
"^DD",101.41,101.41,51,1,1,2)
D REDO^ORDD41
"^DD",101.41,101.41,51,1,1,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.41,51,1,1,"%D",1,0)
Update TIMESTAMP whenever COLUMN WIDTH is changed.
"^DD",101.41,101.41,51,1,1,"DT")
2990210
"^DD",101.41,101.41,51,3)
Type a Number between 20 and 240, 0 Decimal Digits
"^DD",101.41,101.41,51,21,0)
^^2^2^2950623^
"^DD",101.41,101.41,51,21,1,0)
This is the width, in characters, for each column in a menu.  For example,
"^DD",101.41,101.41,51,21,2,0)
to have 3 columns on an 80 character device, enter a width of 26.
"^DD",101.41,101.41,51,"DT")
2990210
"^DD",101.41,101.41,52,0)
MNEMONIC WIDTH^NJ1,0^^5;2^K:+X'=X!(X>9)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.41,101.41,52,1,0)
^.1
"^DD",101.41,101.41,52,1,1,0)
101.41^AM52^MUMPS
"^DD",101.41,101.41,52,1,1,1)
D REDO^ORDD41
"^DD",101.41,101.41,52,1,1,2)
D REDO^ORDD41
"^DD",101.41,101.41,52,1,1,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.41,52,1,1,"%D",1,0)
Update TIMESTAMP whenever MNEMONIC WIDTH is changed.
"^DD",101.41,101.41,52,1,1,"DT")
2990210
"^DD",101.41,101.41,52,3)
Type a Number between 1 and 9, 0 Decimal Digits
"^DD",101.41,101.41,52,21,0)
^^2^2^2950623^
"^DD",101.41,101.41,52,21,1,0)
This field allows the width of item mnemonics to be varied; the default
"^DD",101.41,101.41,52,21,2,0)
value is 5.
"^DD",101.41,101.41,52,"DT")
2990210
"^DD",101.41,101.41,53,0)
PATH SWITCH^S^1:YES;0:NO;^5;3^Q
"^DD",101.41,101.41,53,3)
Enter YES if this menu should be redisplayed when traversing back up the menu tree.
"^DD",101.41,101.41,53,21,0)
^^5^5^2950623^
"^DD",101.41,101.41,53,21,1,0)
This switch allows the user, when traversing back UP the tree of menus and
"^DD",101.41,101.41,53,21,2,0)
items, to select a new path back down the tree.  In other words, the menu
"^DD",101.41,101.41,53,21,3,0)
is redisplayed when returning to that menu's level in the tree and
"^DD",101.41,101.41,53,21,4,0)
processing back down the tree is possible from that point.  If nothing is
"^DD",101.41,101.41,53,21,5,0)
selected from the menu, the path continues back up the tree.
"^DD",101.41,101.41,53,"DT")
2950623
"^DD",101.41,101.41,54,0)
LISTBOX TEXT^F^^5;4^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.41,54,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.41,54,"DT")
2960524
"^DD",101.41,101.41,55,0)
WINDOW FORM ID^NJ4,0^^5;5^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."1N.N) X
"^DD",101.41,101.41,55,3)
Type a Number between 0 and 9999, 0 Decimal Digits
"^DD",101.41,101.41,55,21,0)
^.001^23^23^3010727^^
"^DD",101.41,101.41,55,21,1,0)
This field tells the GUI DELPHI code which form to use to process the
"^DD",101.41,101.41,55,21,2,0)
order dialog.  Each number represents a unique form.  Following are some
"^DD",101.41,101.41,55,21,3,0)
of the more common codes and their corresponding form in DELPHI.
"^DD",101.41,101.41,55,21,4,0)
 
"^DD",101.41,101.41,55,21,5,0)
    Form Name     Windows Form ID
"^DD",101.41,101.41,55,21,6,0)
    ---------     ---------------
"^DD",101.41,101.41,55,21,7,0)
  OD_ACTIVITY           100
"^DD",101.41,101.41,55,21,8,0)
  OD_ALLERGY            105
"^DD",101.41,101.41,55,21,9,0)
  OD_CONSULT            110
"^DD",101.41,101.41,55,21,10,0)
  OD_PROCEDURE          112
"^DD",101.41,101.41,55,21,11,0)
  OD_DIET_TXT           115
"^DD",101.41,101.41,55,21,12,0)
  OD_DIET               117
"^DD",101.41,101.41,55,21,13,0)
  OD_LAB                120
"^DD",101.41,101.41,55,21,14,0)
  OD_MEDINPT            130
"^DD",101.41,101.41,55,21,15,0)
  OD_MEDS               135
"^DD",101.41,101.41,55,21,16,0)
  OD_MEDOUTPT           140
"^DD",101.41,101.41,55,21,17,0)
  OD_NURSING            150
"^DD",101.41,101.41,55,21,18,0)
  OD_MISC               151
"^DD",101.41,101.41,55,21,19,0)
  OD_GENERIC            152
"^DD",101.41,101.41,55,21,20,0)
  OD_IMAGING            160
"^DD",101.41,101.41,55,21,21,0)
  OD_VITALS             171 
"^DD",101.41,101.41,55,21,22,0)
  OD_MEDIV              180
"^DD",101.41,101.41,55,21,23,0)
  OD_TEXTONLY           999
"^DD",101.41,101.41,55,"DT")
2960804
"^DD",101.41,101.41,56,0)
CREATE PARENT ORDER^S^1:YES;0:NO;^5;6^Q
"^DD",101.41,101.41,56,3)
Enter YES if a parent order should be created for this order set
"^DD",101.41,101.41,56,21,0)
^^6^6^2970227^
"^DD",101.41,101.41,56,21,1,0)
This flag indicates whether a parent order should be created to group
"^DD",101.41,101.41,56,21,2,0)
together all the orders created by this order set; this flag is only
"^DD",101.41,101.41,56,21,3,0)
valid with SET type order dialogs.  If this value is YES, a parent
"^DD",101.41,101.41,56,21,4,0)
order will be created, and only the parent will be presented on the
"^DD",101.41,101.41,56,21,5,0)
orders list for display and action; NO will prevent a parent from being
"^DD",101.41,101.41,56,21,6,0)
created and all orders will be created and displayed independently.
"^DD",101.41,101.41,56,"DT")
2970227
"^DD",101.41,101.41,57,0)
DISPLAY SUBHEADER^S^1:YES;0:NO;^5;7^Q
"^DD",101.41,101.41,57,3)
Enter YES if a subheader should be displayed as each order in this set is processed
"^DD",101.41,101.41,57,21,0)
^^3^3^2970227^
"^DD",101.41,101.41,57,21,1,0)
This flag indicates whether a subheader is to be displayed for each order
"^DD",101.41,101.41,57,21,2,0)
in this set as it is processed and placed; this flag is only valid with
"^DD",101.41,101.41,57,21,3,0)
SET type order dialogs.
"^DD",101.41,101.41,57,"DT")
2970227
"^DD",101.41,101.41,58,0)
AUTO-ACCEPT QUICK ORDER^S^1:YES;^5;8^Q
"^DD",101.41,101.41,58,3)
Enter 'Yes' if the order should be placed without displaying the dialog window.
"^DD",101.41,101.41,58,21,0)
^^2^2^2980902^
"^DD",101.41,101.41,58,21,1,0)
This can be set to yes for a quick order so that it can be placed simply
"^DD",101.41,101.41,58,21,2,0)
by clicking on it in the GUI (no ordering dialog is displayed).
"^DD",101.41,101.41,58,"DT")
2980902
"^DD",101.41,101.41,59,0)
URL^P101.14^ORD(101.14,^5;9^Q
"^DD",101.41,101.41,59,3)
Enter the URL that should be associated with this dialog.
"^DD",101.41,101.41,59,21,0)
^^3^3^3010724^
"^DD",101.41,101.41,59,21,1,0)
This points an entry in the ORDER HTML FORM file.  The URL is used to
"^DD",101.41,101.41,59,21,2,0)
tpresent the user with an HTML form that can be used to select quick
"^DD",101.41,101.41,59,21,3,0)
orders.
"^DD",101.41,101.41,59,"DT")
3010724
"^DD",101.41,101.41,99,0)
TIMESTAMP^F^^99;1^K:$L(X)>15!($L(X)<1) X
"^DD",101.41,101.41,99,1,0)
^.1
"^DD",101.41,101.41,99,1,1,0)
101.41^AM^MUMPS
"^DD",101.41,101.41,99,1,1,1)
D SET^ORDD41(DA)
"^DD",101.41,101.41,99,1,1,2)
D KILL^ORDD41(DA)
"^DD",101.41,101.41,99,1,1,"%D",0)
^^2^2^2990210^
"^DD",101.41,101.41,99,1,1,"%D",1,0)
Recompiles order dialog menus in ^XUTL("XQORM",<dialog#>_";ORD(101.41,")
"^DD",101.41,101.41,99,1,1,"%D",2,0)
whenever fields necessary to displaying the menu are changed.
"^DD",101.41,101.41,99,1,1,"DT")
2990210
"^DD",101.41,101.41,99,3)
Answer must be 1-15 characters in length.
"^DD",101.41,101.41,99,21,0)
^^2^2^2980501^
"^DD",101.41,101.41,99,21,1,0)
For menus, this contains the $H time the menu was last compiled for use
"^DD",101.41,101.41,99,21,2,0)
with the Unwinder utility (^XQOR).
"^DD",101.41,101.41,99,"DT")
2990210
"^DD",101.41,101.411,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",101.41,101.411,0,"DT")
2950407
"^DD",101.41,101.411,0,"NM","DESCRIPTION")

"^DD",101.41,101.411,0,"UP")
101.41
"^DD",101.41,101.411,.01,0)
DESCRIPTION^W^^0;1^Q
"^DD",101.41,101.411,.01,3)
Enter a description of this dialog.
"^DD",101.41,101.411,.01,21,0)
^^1^1^2950425^^
"^DD",101.41,101.411,.01,21,1,0)
This field contains a description of the content and use of this dialog.
"^DD",101.41,101.411,.01,"DT")
2950407
"^DD",101.41,101.412,0)
ITEMS SUB-FIELD^^117^37
"^DD",101.41,101.412,0,"DT")
2971117
"^DD",101.41,101.412,0,"ID","WRITE")
N OR0,ORNM S OR0=^(0) I $P(OR0,U,2) S ORNM=$P($G(^ORD(101.41,+$P(OR0,U,2),0)),U) D:$L(ORNM) EN^DDIOL(ORNM,,"?10")
"^DD",101.41,101.412,0,"IX","ATXT",101.412,21)

"^DD",101.41,101.412,0,"IX","B",101.412,.01)

"^DD",101.41,101.412,0,"IX","D",101.412,2)

"^DD",101.41,101.412,0,"IX","DAD",101.412,1)

"^DD",101.41,101.412,0,"IX","DAD1",101.412,.01)

"^DD",101.41,101.412,0,"NM","ITEMS")

"^DD",101.41,101.412,0,"UP")
101.41
"^DD",101.41,101.412,.01,0)
SEQUENCE^MNJ5,1^^0;1^K:+X'=X!(X>999.9)!(X<.1)!(X?.E1"."2N.N) X
"^DD",101.41,101.412,.01,1,0)
^.1
"^DD",101.41,101.412,.01,1,1,0)
101.412^B
"^DD",101.41,101.412,.01,1,1,1)
S ^ORD(101.41,DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",101.41,101.412,.01,1,1,2)
K ^ORD(101.41,DA(1),10,"B",$E(X,1,30),DA)
"^DD",101.41,101.412,.01,1,2,0)
101.412^DAD1^MUMPS
"^DD",101.41,101.412,.01,1,2,1)
N ORP S ORP=$P(^ORD(101.41,DA(1),10,DA,0),U,11) S:ORP ^ORD(101.41,DA(1),10,"DAD",ORP,X,DA)=""
"^DD",101.41,101.412,.01,1,2,2)
N ORP S ORP=$P(^ORD(101.41,DA(1),10,DA,0),U,11) K:ORP ^ORD(101.41,DA(1),10,"DAD",ORP,X,DA)
"^DD",101.41,101.412,.01,1,2,"%D",0)
^^1^1^2950511^
"^DD",101.41,101.412,.01,1,2,"%D",1,0)
Allows retrieval of 'child' prompts in sequence by parent.
"^DD",101.41,101.412,.01,1,2,"DT")
2950511
"^DD",101.41,101.412,.01,1,3,0)
101.41^AMM^MUMPS
"^DD",101.41,101.412,.01,1,3,1)
D REDOX^ORDD41
"^DD",101.41,101.412,.01,1,3,2)
D REDOX^ORDD41
"^DD",101.41,101.412,.01,1,3,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.412,.01,1,3,"%D",1,0)
Update TIMESTAMP whenever SEQUENCE is changed.
"^DD",101.41,101.412,.01,1,3,"DT")
2990210
"^DD",101.41,101.412,.01,3)
Type a Number between .1 and 999.9, 1 Decimal Digit
"^DD",101.41,101.412,.01,21,0)
^^2^2^2971117^^^^
"^DD",101.41,101.412,.01,21,1,0)
This field specifies the order in which this item will be displayed or
"^DD",101.41,101.412,.01,21,2,0)
processed.
"^DD",101.41,101.412,.01,"DT")
2990210
"^DD",101.41,101.412,.1,0)
INPUT TRANSFORM^K^^.1;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,.1,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,.1,9)
@
"^DD",101.41,101.412,.1,21,0)
^^2^2^2950816^
"^DD",101.41,101.412,.1,21,1,0)
This is code that will be used as the third piece of DIR(0) when asking
"^DD",101.41,101.412,.1,21,2,0)
this prompt.
"^DD",101.41,101.412,.1,"DT")
2950816
"^DD",101.41,101.412,1,0)
PARENT^P101.41'^ORD(101.41,^0;11^Q
"^DD",101.41,101.412,1,1,0)
^.1
"^DD",101.41,101.412,1,1,1,0)
101.412^DAD^MUMPS
"^DD",101.41,101.412,1,1,1,1)
S ^ORD(101.41,DA(1),10,"DAD",X,$P(^ORD(101.41,DA(1),10,DA,0),U),DA)=""
"^DD",101.41,101.412,1,1,1,2)
K ^ORD(101.41,DA(1),10,"DAD",X,$P(^ORD(101.41,DA(1),10,DA,0),U),DA)
"^DD",101.41,101.412,1,1,1,"%D",0)
^^1^1^2950511^^
"^DD",101.41,101.412,1,1,1,"%D",1,0)
Allows retrieval of 'child' prompts in sequence by parent.
"^DD",101.41,101.412,1,1,1,"DT")
2950511
"^DD",101.41,101.412,1,3)
If this prompt is subordinate to another in this dialog, enter the parent prompt here
"^DD",101.41,101.412,1,21,0)
^^4^4^2950511^
"^DD",101.41,101.412,1,21,1,0)
This field controls the behavior of this prompt.  If a parent is defined
"^DD",101.41,101.412,1,21,2,0)
here, this prompt will be asked from within the parent's dialog; when it
"^DD",101.41,101.412,1,21,3,0)
is invoked independently based on its position sequence number, the child
"^DD",101.41,101.412,1,21,4,0)
prompt will be ignored.
"^DD",101.41,101.412,1,"DT")
2950511
"^DD",101.41,101.412,2,0)
ITEM^P101.41'X^ORD(101.41,^0;2^D TREE^ORDD41
"^DD",101.41,101.412,2,1,0)
^.1
"^DD",101.41,101.412,2,1,1,0)
101.41^AD
"^DD",101.41,101.412,2,1,1,1)
S ^ORD(101.41,"AD",$E(X,1,30),DA(1),DA)=""
"^DD",101.41,101.412,2,1,1,2)
K ^ORD(101.41,"AD",$E(X,1,30),DA(1),DA)
"^DD",101.41,101.412,2,1,1,"DT")
2950123
"^DD",101.41,101.412,2,1,2,0)
101.412^D
"^DD",101.41,101.412,2,1,2,1)
S ^ORD(101.41,DA(1),10,"D",$E(X,1,30),DA)=""
"^DD",101.41,101.412,2,1,2,2)
K ^ORD(101.41,DA(1),10,"D",$E(X,1,30),DA)
"^DD",101.41,101.412,2,1,2,"DT")
2950411
"^DD",101.41,101.412,2,1,3,0)
101.41^AMM2^MUMPS
"^DD",101.41,101.412,2,1,3,1)
D REDOX^ORDD41
"^DD",101.41,101.412,2,1,3,2)
D REDOX^ORDD41
"^DD",101.41,101.412,2,1,3,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.412,2,1,3,"%D",1,0)
Update TIMESTAMP whenever ITEM is changed.
"^DD",101.41,101.412,2,1,3,"DT")
2990210
"^DD",101.41,101.412,2,3)
Enter an order dialog; a dialog that is an ancestor may not also be a sub-item.
"^DD",101.41,101.412,2,21,0)
^^3^3^2950123^
"^DD",101.41,101.412,2,21,1,0)
This field points to an order dialog which is subordinate to this dialog.
"^DD",101.41,101.412,2,21,2,0)
NOTE:  The parent dialog menu or one of its ancestors may not be entered
"^DD",101.41,101.412,2,21,3,0)
as an item.
"^DD",101.41,101.412,2,"DT")
2990217
"^DD",101.41,101.412,3,0)
MNEMONIC^FX^^0;3^K:$L(X)>4!($L(X)<1)!(+X=X&($L(X,".")>1))!($$CHKMNE^ORUTL(X)) X
"^DD",101.41,101.412,3,1,0)
^.1
"^DD",101.41,101.412,3,1,1,0)
101.41^AMM3^MUMPS
"^DD",101.41,101.412,3,1,1,1)
D REDOX^ORDD41
"^DD",101.41,101.412,3,1,1,2)
D REDOX^ORDD41
"^DD",101.41,101.412,3,1,1,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.412,3,1,1,"%D",1,0)
Update TIMESTAMP whenever MNEMONIC is changed.
"^DD",101.41,101.412,3,1,1,"DT")
2990210
"^DD",101.41,101.412,3,3)
Enter a mnemonic to be used when this dialog is displayed for selection, 1-4 characters in length with no decimal places if numeric. Standard list manager mnemonics may not be used.
"^DD",101.41,101.412,3,21,0)
^.001^2^2^3010727^^^^
"^DD",101.41,101.412,3,21,1,0)
This is a short abbreviation for this item dialog to be used when this
"^DD",101.41,101.412,3,21,2,0)
dialog is displayed for selection.
"^DD",101.41,101.412,3,"DT")
3000822
"^DD",101.41,101.412,4,0)
DISPLAY TEXT^FX^^0;4^K:$L(X)>80!($L(X)<1)!($$CHKNAM^ORUTL(X)) X
"^DD",101.41,101.412,4,1,0)
^.1
"^DD",101.41,101.412,4,1,1,0)
101.41^AMM4^MUMPS
"^DD",101.41,101.412,4,1,1,1)
D REDOX^ORDD41
"^DD",101.41,101.412,4,1,1,2)
D REDOX^ORDD41
"^DD",101.41,101.412,4,1,1,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.412,4,1,1,"%D",1,0)
Update TIMESTAMP whenever DISPLAY TEXT is changed.
"^DD",101.41,101.412,4,1,1,"DT")
2990210
"^DD",101.41,101.412,4,3)
Answer must be 1-80 characters in length and cannot contain a semicolon (;), a comma (,), an up-arrow (^), a dash (-), or an equal sign (=).
"^DD",101.41,101.412,4,21,0)
^.001^2^2^3010419^^^^
"^DD",101.41,101.412,4,21,1,0)
This field allows the text that normally appears for this item to be
"^DD",101.41,101.412,4,21,2,0)
replaced with alternate text for use in this dialog or menu.
"^DD",101.41,101.412,4,"DT")
3000823
"^DD",101.41,101.412,5,0)
DISPLAY ONLY?^S^0:NO;1:YES;2:YES-HEADER;^0;5^Q
"^DD",101.41,101.412,5,1,0)
^.1
"^DD",101.41,101.412,5,1,1,0)
101.41^AMM5^MUMPS
"^DD",101.41,101.412,5,1,1,1)
D REDOX^ORDD41
"^DD",101.41,101.412,5,1,1,2)
D REDOX^ORDD41
"^DD",101.41,101.412,5,1,1,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.412,5,1,1,"%D",1,0)
Update TIMESTAMP whenever DISPLAY ONLY? is changed.
"^DD",101.41,101.412,5,1,1,"DT")
2990210
"^DD",101.41,101.412,5,3)
Enter YES if this item is text for display only and not a selectable item.
"^DD",101.41,101.412,5,21,0)
^^3^3^2970409^^^^
"^DD",101.41,101.412,5,21,1,0)
This field identifies an item as being free text for display purposes
"^DD",101.41,101.412,5,21,2,0)
only.  The text in the Display Text field will be displayed, but it
"^DD",101.41,101.412,5,21,3,0)
is not selectable; if designated as a header, the text will be underlined.
"^DD",101.41,101.412,5,"DT")
2990210
"^DD",101.41,101.412,6,0)
REQUIRED^S^1:YES;0:NO;^0;6^Q
"^DD",101.41,101.412,6,3)
Enter YES if a response to this prompt is mandatory.
"^DD",101.41,101.412,6,21,0)
^^1^1^2950407^
"^DD",101.41,101.412,6,21,1,0)
This field indicates that the user must enter a response to this prompt.
"^DD",101.41,101.412,6,"DT")
2950407
"^DD",101.41,101.412,7,0)
MULTIPLE VALUED^S^1:YES;0:NO;^0;7^Q
"^DD",101.41,101.412,7,3)
Enter YES if this prompt is to be asked multiple times.
"^DD",101.41,101.412,7,21,0)
^^3^3^2950407^
"^DD",101.41,101.412,7,21,1,0)
This field determines if this prompt will be allowed to have multiple
"^DD",101.41,101.412,7,21,2,0)
values, or be prompted for only once; if this prompt is a sub-dialog,
"^DD",101.41,101.412,7,21,3,0)
the entire dialog will be asked once or many times, as a group.
"^DD",101.41,101.412,7,"DT")
2950407
"^DD",101.41,101.412,7.1,0)
MAX NUMBER OF MULTIPLES^NJ2,0^^0;12^K:+X'=X!(X>99)!(X<2)!(X?.E1"."1N.N) X
"^DD",101.41,101.412,7.1,3)
Type a Number between 2 and 99, 0 Decimal Digits
"^DD",101.41,101.412,7.1,21,0)
^^4^4^2950815^
"^DD",101.41,101.412,7.1,21,1,0)
This is the maximum number of values that may be entered for this prompt,
"^DD",101.41,101.412,7.1,21,2,0)
if it is flagged as being multiple-valued.  For example, a diet order may
"^DD",101.41,101.412,7.1,21,3,0)
have up to 5 diet modifications entered, where 5 is the maximum allowed
"^DD",101.41,101.412,7.1,21,4,0)
that would be entered here.
"^DD",101.41,101.412,7.1,"DT")
2950815
"^DD",101.41,101.412,7.2,0)
TITLE^F^^0;13^K:$L(X)>30!($L(X)<3) X
"^DD",101.41,101.412,7.2,3)
Answer must be 3-30 characters in length.
"^DD",101.41,101.412,7.2,21,0)
^^8^8^2970430^^
"^DD",101.41,101.412,7.2,21,1,0)
This is text that will be used in place of the prompt when the order is
"^DD",101.41,101.412,7.2,21,2,0)
displayed for place, edit, or cancel, or at the top of a multiple-valued
"^DD",101.41,101.412,7.2,21,3,0)
prompt.  The Display Text for the prompt will be used together with the
"^DD",101.41,101.412,7.2,21,4,0)
instance number to prompt for user input; for example if Title="Lab Tests:"
"^DD",101.41,101.412,7.2,21,5,0)
and Display Text="Test:" the user would see
"^DD",101.41,101.412,7.2,21,6,0)
  Lab Tests:
"^DD",101.41,101.412,7.2,21,7,0)
  1. Test:
"^DD",101.41,101.412,7.2,21,8,0)
  2. Test:
"^DD",101.41,101.412,7.2,"DT")
2950815
"^DD",101.41,101.412,7.3,0)
PROMPT^F^^0;14^K:$L(X)>10!($L(X)<1) X
"^DD",101.41,101.412,7.3,3)
Answer must be 1-10 characters in length.
"^DD",101.41,101.412,7.3,21,0)
^^3^3^2970618^
"^DD",101.41,101.412,7.3,21,1,0)
This field contains text that will be appended to the beginning of the
"^DD",101.41,101.412,7.3,21,2,0)
display text when prompting for additional values; if this field is
"^DD",101.41,101.412,7.3,21,3,0)
empty, then "Another " will be used.
"^DD",101.41,101.412,7.3,"DT")
2970618
"^DD",101.41,101.412,8,0)
ASK ON EDIT ONLY^S^1:YES;0:NO;^0;8^Q
"^DD",101.41,101.412,8,3)
Enter YES if this prompt should not be asked initially when creating this order, only if the user chooses to edit the order.
"^DD",101.41,101.412,8,21,0)
^^4^4^2960112^^^
"^DD",101.41,101.412,8,21,1,0)
This field determines the behaviour of the dialog driver for this prompt;
"^DD",101.41,101.412,8,21,2,0)
if no value or the defined default is usually correct for this prompt,
"^DD",101.41,101.412,8,21,3,0)
enter YES here to have this prompt skipped on the first pass through this
"^DD",101.41,101.412,8,21,4,0)
dialog when creating an order.
"^DD",101.41,101.412,8,"DT")
2950407
"^DD",101.41,101.412,9,0)
ASK ON ACTION^F^^0;9^K:$L(X)>3!($L(X)<1) X
"^DD",101.41,101.412,9,3)
Answer must be 1-3 characters in length.
"^DD",101.41,101.412,9,21,0)
^^6^6^2970708^^^
"^DD",101.41,101.412,9,21,1,0)
This field determines the behaviour of the dialog driver for this prompt
"^DD",101.41,101.412,9,21,2,0)
when taking a particular action on an order created by this dialog.  If
"^DD",101.41,101.412,9,21,3,0)
this string contains "R", this prompt will be asked when renewing an order;
"^DD",101.41,101.412,9,21,4,0)
if this string contains "C", this prompt will be asked when changing an
"^DD",101.41,101.412,9,21,5,0)
order; if this string contains "W", this prompt will be asked when
"^DD",101.41,101.412,9,21,6,0)
rewriting an order.
"^DD",101.41,101.412,9,"DT")
2970708
"^DD",101.41,101.412,10,0)
INDEX^F^^0;10^K:$L(X)>25!($L(X)<1) X
"^DD",101.41,101.412,10,3)
Answer must be 1-25 characters in length.
"^DD",101.41,101.412,10,21,0)
^^3^3^2950713^^^
"^DD",101.41,101.412,10,21,1,0)
For pointer-type prompts, this is the index to use when searching the file;
"^DD",101.41,101.412,10,21,2,0)
it must be in the form of a regular cross-reference.  To search on multiple
"^DD",101.41,101.412,10,21,3,0)
indices, enter a string of index names separated by semi-colons, i.e. "B;C".
"^DD",101.41,101.412,10,"DT")
2950713
"^DD",101.41,101.412,11,0)
HELP MESSAGE^F^^1;1^K:$L(X)>160!($L(X)<1) X
"^DD",101.41,101.412,11,3)
Answer must be 1-160 characters in length.
"^DD",101.41,101.412,11,21,0)
^^2^2^2970609^^
"^DD",101.41,101.412,11,21,1,0)
This field contains the help message to be presented when the user enters
"^DD",101.41,101.412,11,21,2,0)
a question mark at this prompt.
"^DD",101.41,101.412,11,"DT")
2970609
"^DD",101.41,101.412,12,0)
SPECIAL LOOKUP ROUTINE^F^^1;2^K:$L(X)>20!($L(X)<3) X
"^DD",101.41,101.412,12,3)
Enter the routine to use instead of DIC to do this lookup, as [TAG;]ROUTINE
"^DD",101.41,101.412,12,21,0)
^^3^3^2970609^
"^DD",101.41,101.412,12,21,1,0)
This field contains a routine to execute that will replace the standard
"^DD",101.41,101.412,12,21,2,0)
DIC lookup for this prompt; it must be entered here as LINETAG;ROUTINE
"^DD",101.41,101.412,12,21,3,0)
using a ; instead of ^ and where LINETAG is optional.
"^DD",101.41,101.412,12,"DT")
2970609
"^DD",101.41,101.412,13,0)
ASK ON CONDITION^K^^3;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,13,3)
This is MUMPS code that sets $T to determine if this prompt should be asked, or given a default value and bypassed.
"^DD",101.41,101.412,13,9)
@
"^DD",101.41,101.412,13,21,0)
^^5^5^2950407^
"^DD",101.41,101.412,13,21,1,0)
This is MUMPS code that sets $T to determine if this prompt should be asked
"^DD",101.41,101.412,13,21,2,0)
or simply given a default value and presented to the user for acceptance
"^DD",101.41,101.412,13,21,3,0)
or editing.  For example, the prompt "Pregnant: " may have code here to
"^DD",101.41,101.412,13,21,4,0)
check the sex of the current patient, i.e. I ORSEX="F" will allow it to be
"^DD",101.41,101.412,13,21,5,0)
asked only for female patients.
"^DD",101.41,101.412,13,"DT")
2950407
"^DD",101.41,101.412,14,0)
SCREEN^K^^4;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,14,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,14,9)
@
"^DD",101.41,101.412,14,21,0)
^^2^2^2950407^
"^DD",101.41,101.412,14,21,1,0)
For pointer-type prompts, this field may contain MUMPS code that will be
"^DD",101.41,101.412,14,21,2,0)
set into DIC("S") to screen the possible choices in the pointed-to file.
"^DD",101.41,101.412,14,"DT")
2950407
"^DD",101.41,101.412,15,0)
POST-SELECTION ACTION^K^^5;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,15,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,15,9)
@
"^DD",101.41,101.412,15,21,0)
^^3^3^2970923^^^^
"^DD",101.41,101.412,15,21,1,0)
This is code that will be executed after a response is entered to this
"^DD",101.41,101.412,15,21,2,0)
prompt; if this prompt should be re-asked, kill the variable DONE.
"^DD",101.41,101.412,15,21,3,0)
If execution of the ordering dialog should be stopped, set ORQUIT=1.
"^DD",101.41,101.412,15,"DT")
2970923
"^DD",101.41,101.412,16,0)
XECUTABLE HELP^K^^6;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,16,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,16,9)
@
"^DD",101.41,101.412,16,21,0)
^^2^2^2950407^
"^DD",101.41,101.412,16,21,1,0)
This is code that is to be executed when the user enters two or more
"^DD",101.41,101.412,16,21,2,0)
question marks at this prompt.
"^DD",101.41,101.412,16,"DT")
2950407
"^DD",101.41,101.412,17,0)
DEFAULT^K^^7;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,17,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,17,9)
@
"^DD",101.41,101.412,17,21,0)
^^2^2^2971219^^^^
"^DD",101.41,101.412,17,21,1,0)
This is code that is to be executed to determine the appropriate default
"^DD",101.41,101.412,17,21,2,0)
value for this prompt, setting Y=internal form of this value.
"^DD",101.41,101.412,17,"DT")
2950519
"^DD",101.41,101.412,18,0)
DEFAULT WORD-PROCESSING TEXT^101.41218^^8;0
"^DD",101.41,101.412,18,21,0)
^^1^1^2971219^
"^DD",101.41,101.412,18,21,1,0)
This is default text to be stuffed into this word-processing prompt.
"^DD",101.41,101.412,19,0)
ENTRY ACTION^K^^9;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,19,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,19,9)
@
"^DD",101.41,101.412,19,21,0)
^^3^3^2970609^
"^DD",101.41,101.412,19,21,1,0)
This is code that will be executed at the beginning of the processing of
"^DD",101.41,101.412,19,21,2,0)
this prompt, before the Default and Ask on Condition fields are executed;
"^DD",101.41,101.412,19,21,3,0)
any special setup required for this field should be done here.
"^DD",101.41,101.412,19,"DT")
2970609
"^DD",101.41,101.412,20,0)
EXIT ACTION^K^^10;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,20,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,20,9)
@
"^DD",101.41,101.412,20,21,0)
^^3^3^2970609^
"^DD",101.41,101.412,20,21,1,0)
This is code that will be executed at the very end of the processing of
"^DD",101.41,101.412,20,21,2,0)
this prompt, after prompting and the Validation field is executed;
"^DD",101.41,101.412,20,21,3,0)
any special cleanup should be done here.
"^DD",101.41,101.412,20,"DT")
2970609
"^DD",101.41,101.412,21,0)
ORDER TEXT SEQUENCE^NJ5,2^^2;1^K:+X'=X!(X>99.99)!(X<1)!(X?.E1"."3N.N) X
"^DD",101.41,101.412,21,1,0)
^.1
"^DD",101.41,101.412,21,1,1,0)
101.412^ATXT
"^DD",101.41,101.412,21,1,1,1)
S ^ORD(101.41,DA(1),10,"ATXT",$E(X,1,30),DA)=""
"^DD",101.41,101.412,21,1,1,2)
K ^ORD(101.41,DA(1),10,"ATXT",$E(X,1,30),DA)
"^DD",101.41,101.412,21,1,1,"%D",0)
^^1^1^2960226^
"^DD",101.41,101.412,21,1,1,"%D",1,0)
Used to build order text.
"^DD",101.41,101.412,21,1,1,"DT")
2960226
"^DD",101.41,101.412,21,3)
Enter the order in which this value should be added to the order text, as a number between 1 and 99.99; leave this field blank to prevent this value from being included
"^DD",101.41,101.412,21,21,0)
^^3^3^2970607^^^
"^DD",101.41,101.412,21,21,1,0)
This field indicates the order in which values will be concatenated
"^DD",101.41,101.412,21,21,2,0)
together to build the order text; this may differ from the prompting
"^DD",101.41,101.412,21,21,3,0)
order defined in the .01 Sequence field.
"^DD",101.41,101.412,21,"DT")
2960226
"^DD",101.41,101.412,22,0)
FORMAT^F^^2;2^K:$L(X)>10!($L(X)<1) X
"^DD",101.41,101.412,22,3)
Answer must be 1-10 characters in length.
"^DD",101.41,101.412,22,21,0)
^^15^15^2971207^^^^
"^DD",101.41,101.412,22,21,1,0)
This is a string of characters that will define any exceptions to how
"^DD",101.41,101.412,22,21,2,0)
the external form of this value is generated.  Possible values include:
"^DD",101.41,101.412,22,21,3,0)
  Pointer         -> <field #>~<piece in RPC list of field #>, default =.01
"^DD",101.41,101.412,22,21,4,0)
  Set of Codes    -> 1~<piece in RPC list of code> to use code for name
"^DD",101.41,101.412,22,21,5,0)
  Date/Time       -> Format string to pass $$FMTE^XLFDT (default = 2)
"^DD",101.41,101.412,22,21,6,0)
  
"^DD",101.41,101.412,22,21,7,0)
  Suppress value  -> @
"^DD",101.41,101.412,22,21,8,0)
  Replace value   -> @<ptr> where ptr is the Dialog IEN of the prompt
"^DD",101.41,101.412,22,21,9,0)
                      whose value, when present, supersedes this value
"^DD",101.41,101.412,22,21,10,0)
  Required value  -> *<ptr> where ptr is the Dialog IEN of the prompt
"^DD",101.41,101.412,22,21,11,0)
                      whose value is required to be present to include
"^DD",101.41,101.412,22,21,12,0)
                      this value
"^DD",101.41,101.412,22,21,13,0)
  Ignore if same  -> =<ptr> where ptr is the Dialog IEN of the prompt
"^DD",101.41,101.412,22,21,14,0)
                      whose value, if the external form is the same,
"^DD",101.41,101.412,22,21,15,0)
                      supersedes this value
"^DD",101.41,101.412,22,"DT")
2960226
"^DD",101.41,101.412,23,0)
OMIT TEXT^F^^2;3^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.412,23,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.412,23,21,0)
^^3^3^2970829^^^^
"^DD",101.41,101.412,23,21,1,0)
This is the external form of a value that is not to be included when building
"^DD",101.41,101.412,23,21,2,0)
the order text.  E.g. to include the urgency in the order text unless it
"^DD",101.41,101.412,23,21,3,0)
is routine, enter "ROUTINE" here.
"^DD",101.41,101.412,23,"DT")
2970829
"^DD",101.41,101.412,24,0)
LEADING TEXT^F^^2;4^K:$L(X)>80!($L(X)<1) X
"^DD",101.41,101.412,24,3)
Answer must be 1-80 characters in length.
"^DD",101.41,101.412,24,21,0)
^^3^3^2970724^^^^
"^DD",101.41,101.412,24,21,1,0)
This field contains text that will be appended to the order text
"^DD",101.41,101.412,24,21,2,0)
immediately in front of this value, e.g. "Instructions:".  If this text
"^DD",101.41,101.412,24,21,3,0)
is contained in a variable, enter @NAME where NAME is the variable name.
"^DD",101.41,101.412,24,"DT")
2970724
"^DD",101.41,101.412,25,0)
TRAILING TEXT^F^^2;5^K:$L(X)>80!($L(X)<1) X
"^DD",101.41,101.412,25,3)
Answer must be 1-80 characters in length.
"^DD",101.41,101.412,25,21,0)
^^3^3^2970724^^^^
"^DD",101.41,101.412,25,21,1,0)
This field contains text that will be appended to the order text
"^DD",101.41,101.412,25,21,2,0)
immediately following this value, e.g. "refills".  If this text is
"^DD",101.41,101.412,25,21,3,0)
contained in a variable, enter @NAME where NAME is the variable name.
"^DD",101.41,101.412,25,"DT")
2970724
"^DD",101.41,101.412,26,0)
START NEW LINE^S^1:YES;0:NO;^2;6^Q
"^DD",101.41,101.412,26,3)
Enter YES if this value should begin on a new line in the order text.
"^DD",101.41,101.412,26,21,0)
0^^2^2^2970911^
"^DD",101.41,101.412,26,21,1,0)
This field determines if this value is concatenated onto the current line
"^DD",101.41,101.412,26,21,2,0)
when building the order text, or if a new line is started with this value.
"^DD",101.41,101.412,26,"DT")
2970911
"^DD",101.41,101.412,27,0)
WORD-WRAP^S^1:DON'T WRAP;0:WRAP;^2;7^Q
"^DD",101.41,101.412,27,3)
Enter 'Don't Wrap' to have the text be added line-by-line as it is stored; the default formatting is 'Wrap'.
"^DD",101.41,101.412,27,21,0)
^^3^3^2970926^^^
"^DD",101.41,101.412,27,21,1,0)
This field determines if this text should be wrapped when added to the
"^DD",101.41,101.412,27,21,2,0)
order text, or appended line by line as stored in the file; this is only
"^DD",101.41,101.412,27,21,3,0)
used for word-processing type prompts.
"^DD",101.41,101.412,27,"DT")
2970926
"^DD",101.41,101.412,101,0)
WINDOWS CONTROL^F^^W;1^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.412,101,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.412,101,21,0)
^^2^2^2950715^
"^DD",101.41,101.412,101,21,1,0)
Stores the type of Windows control necessary to get the data for this
"^DD",101.41,101.412,101,21,2,0)
prompt.
"^DD",101.41,101.412,101,"DT")
2960517
"^DD",101.41,101.412,102,0)
API NAME^F^^W;2^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.412,102,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.412,102,21,0)
^^3^3^2950715^
"^DD",101.41,101.412,102,21,1,0)
This is the API that should be called when the control is used.  How the API
"^DD",101.41,101.412,102,21,2,0)
is used varys with the control.  Examples are: filling list boxes, getting
"^DD",101.41,101.412,102,21,3,0)
boilerplate text, etc.
"^DD",101.41,101.412,102,"DT")
2951002
"^DD",101.41,101.412,103,0)
API PARAMETER #1^F^^W;3^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.412,103,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.412,103,21,0)
^^1^1^2950715^
"^DD",101.41,101.412,103,21,1,0)
A parameter that is used by the API call may be stored here.
"^DD",101.41,101.412,103,"DT")
2950715
"^DD",101.41,101.412,113,0)
WINDOWS CONDITION^K^^W3;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,113,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,113,9)
@
"^DD",101.41,101.412,113,21,0)
^^3^3^2950715^
"^DD",101.41,101.412,113,21,1,0)
This is silent code that is executed when building the dialog for windows.
"^DD",101.41,101.412,113,21,2,0)
It identifies which prompts should be included in the dialog.  The condition
"^DD",101.41,101.412,113,21,3,0)
should leave $T false if the prompt should not be asked.
"^DD",101.41,101.412,113,"DT")
2950715
"^DD",101.41,101.412,117,0)
WINDOWS DEFAULT^K^^W7;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,117,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,117,9)
@
"^DD",101.41,101.412,117,21,0)
^^2^2^2950715^
"^DD",101.41,101.412,117,21,1,0)
This code should silently set the default value of a prompt when it is 
"^DD",101.41,101.412,117,21,2,0)
selected.
"^DD",101.41,101.412,117,"DT")
2950715
"^DD",101.41,101.41218,0)
DEFAULT WORD-PROCESSING TEXT SUB-FIELD^^.01^1
"^DD",101.41,101.41218,0,"DT")
2950407
"^DD",101.41,101.41218,0,"NM","DEFAULT WORD-PROCESSING TEXT")

"^DD",101.41,101.41218,0,"UP")
101.412
"^DD",101.41,101.41218,.01,0)
DEFAULT WORD-PROCESSING TEXT^W^^0;1^Q
"^DD",101.41,101.41218,.01,3)
Enter the default response for a word-processing type prompt.
"^DD",101.41,101.41218,.01,21,0)
^^2^2^2950407^
"^DD",101.41,101.41218,.01,21,1,0)
This field contains the text to be presented as the default for this prompt,
"^DD",101.41,101.41218,.01,21,2,0)
for word-processing type prompts.
"^DD",101.41,101.41218,.01,"DT")
2950407
"^DD",101.41,101.415,0)
CONTROLS SUB-FIELD^^14^14
"^DD",101.41,101.415,0,"DT")
2960202
"^DD",101.41,101.415,0,"IX","AC",101.415,3)

"^DD",101.41,101.415,0,"IX","B",101.415,.01)

"^DD",101.41,101.415,0,"NM","CONTROLS")

"^DD",101.41,101.415,0,"UP")
101.41
"^DD",101.41,101.415,.01,0)
LOGICAL NAME^MF^^0;1^K:$L(X)>8!($L(X)<1)!'(X?1.8U) X
"^DD",101.41,101.415,.01,1,0)
^.1
"^DD",101.41,101.415,.01,1,1,0)
101.415^B
"^DD",101.41,101.415,.01,1,1,1)
S ^ORD(101.41,DA(1),50,"B",$E(X,1,30),DA)=""
"^DD",101.41,101.415,.01,1,1,2)
K ^ORD(101.41,DA(1),50,"B",$E(X,1,30),DA)
"^DD",101.41,101.415,.01,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,.01,21,0)
^^1^1^2960202^
"^DD",101.41,101.415,.01,21,1,0)
This is the name by which controls can refer to each other.
"^DD",101.41,101.415,.01,"DT")
2960202
"^DD",101.41,101.415,2,0)
ITEM^P101.41'^ORD(101.41,^0;2^Q
"^DD",101.41,101.415,2,"DT")
2960202
"^DD",101.41,101.415,3,0)
CREATE SEQUENCE^NJ2,0^^0;3^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.41,101.415,3,1,0)
^.1
"^DD",101.41,101.415,3,1,1,0)
101.415^AC
"^DD",101.41,101.415,3,1,1,1)
S ^ORD(101.41,DA(1),50,"AC",$E(X,1,30),DA)=""
"^DD",101.41,101.415,3,1,1,2)
K ^ORD(101.41,DA(1),50,"AC",$E(X,1,30),DA)
"^DD",101.41,101.415,3,1,1,"%D",0)
^^2^2^2960202^
"^DD",101.41,101.415,3,1,1,"%D",1,0)
The 'AC' cross-reference puts in window controls in order by creation 
"^DD",101.41,101.415,3,1,1,"%D",2,0)
sequence.
"^DD",101.41,101.415,3,1,1,"DT")
2960202
"^DD",101.41,101.415,3,3)
Type a Number between 1 and 99, 0 Decimal Digits
"^DD",101.41,101.415,3,"DT")
2960202
"^DD",101.41,101.415,4,0)
CONTROL TYPE^S^0:Label;1:Button;2:Edit;3:Memo;4:ListBox;5:SimpleCombo;6:DropDownList;7:LongCombo;^0;4^Q
"^DD",101.41,101.415,4,"DT")
2960202
"^DD",101.41,101.415,5,0)
LABEL^F^^0;5^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.415,5,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.415,5,"DT")
2960202
"^DD",101.41,101.415,6,0)
BESIDE^F^^0;6^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,6,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,6,"DT")
2960202
"^DD",101.41,101.415,7,0)
BELOW^F^^0;7^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,7,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,7,"DT")
2960202
"^DD",101.41,101.415,8,0)
WIDTH^NJ6,4^^0;8^K:+X'=X!(X>1)!(X<0)!(X?.E1"."5N.N) X
"^DD",101.41,101.415,8,3)
Type a Number between 0 and 1, 4 Decimal Digits
"^DD",101.41,101.415,8,"DT")
2960202
"^DD",101.41,101.415,9,0)
LEFT CONTROL^F^^0;9^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,9,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,9,"DT")
2960202
"^DD",101.41,101.415,10,0)
RIGHT CONTROL^F^^0;10^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,10,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,10,"DT")
2960202
"^DD",101.41,101.415,11,0)
HEIGHT^NJ2,0^^0;11^K:+X'=X!(X>15)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.41,101.415,11,3)
Type a Number between 1 and 15, 0 Decimal Digits
"^DD",101.41,101.415,11,"DT")
2960202
"^DD",101.41,101.415,12,0)
UPPER CONTROL^F^^0;12^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,12,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,12,"DT")
2960202
"^DD",101.41,101.415,13,0)
LOWER CONTROL^F^^0;13^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,13,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,13,"DT")
2960202
"^DD",101.41,101.415,14,0)
TAB SEQUENCE^NJ2,0^^0;14^K:+X'=X!(X>89)!(X<0)!(X?.E1"."1N.N) X
"^DD",101.41,101.415,14,3)
Type a Number between 0 and 89, 0 Decimal Digits
"^DD",101.41,101.415,14,"DT")
2960202
"^DD",101.41,101.416,0)
RESPONSES SUB-FIELD^^2^5
"^DD",101.41,101.416,0,"DT")
2960717
"^DD",101.41,101.416,0,"IX","D",101.416,.02)

"^DD",101.41,101.416,0,"NM","RESPONSES")

"^DD",101.41,101.416,0,"UP")
101.41
"^DD",101.41,101.416,.01,0)
ITEM ENTRY^MNJ7,0^^0;1^K:+X'=X!(X>9999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.41,101.416,.01,1,0)
^.1^^0
"^DD",101.41,101.416,.01,3)
Type a Number between 1 and 9999999, 0 Decimal Digits
"^DD",101.41,101.416,.01,21,0)
^^2^2^2971219^^^
"^DD",101.41,101.416,.01,21,1,0)
This is the internal entry number of the prompt in the Item multiple
"^DD",101.41,101.416,.01,21,2,0)
by which this response was obtained.
"^DD",101.41,101.416,.01,"DT")
2961118
"^DD",101.41,101.416,.02,0)
DIALOG^P101.41'^ORD(101.41,^0;2^Q
"^DD",101.41,101.416,.02,1,0)
^.1
"^DD",101.41,101.416,.02,1,1,0)
101.416^D
"^DD",101.41,101.416,.02,1,1,1)
S ^ORD(101.41,DA(1),6,"D",$E(X,1,30),DA)=""
"^DD",101.41,101.416,.02,1,1,2)
K ^ORD(101.41,DA(1),6,"D",$E(X,1,30),DA)
"^DD",101.41,101.416,.02,1,1,"DT")
2961118
"^DD",101.41,101.416,.02,3)
Select the dialog prompt from which this response was generated.
"^DD",101.41,101.416,.02,21,0)
^^2^2^2960717^
"^DD",101.41,101.416,.02,21,1,0)
This is a pointer to the dialog prompt, which is in the Order Dialog file
"^DD",101.41,101.416,.02,21,2,0)
as type prompt.
"^DD",101.41,101.416,.02,"DT")
2961118
"^DD",101.41,101.416,.03,0)
INSTANCE^NJ7,0^^0;3^K:+X'=X!(X>9999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.41,101.416,.03,3)
Type a Number between 1 and 9999999, 0 Decimal Digits
"^DD",101.41,101.416,.03,21,0)
^^2^2^2960717^
"^DD",101.41,101.416,.03,21,1,0)
In the case of multiple answers for the same item, this identifies the
"^DD",101.41,101.416,.03,21,2,0)
individual instance.
"^DD",101.41,101.416,.03,"DT")
2960717
"^DD",101.41,101.416,1,0)
VALUE^FO^^1;1^K:$L(X)>245!($L(X)<1) X
"^DD",101.41,101.416,1,2)
S Y(0)=Y S Y=$$OUTPUT^ORCMEDT5(Y)
"^DD",101.41,101.416,1,2.1)
S Y=$$OUTPUT^ORCMEDT5(Y)
"^DD",101.41,101.416,1,3)
Answer must be 1-245 characters in length.
"^DD",101.41,101.416,1,21,0)
^^2^2^2971219^^
"^DD",101.41,101.416,1,21,1,0)
This contains the actual response, unless the value is a word processing
"^DD",101.41,101.416,1,21,2,0)
type.
"^DD",101.41,101.416,1,"DT")
2980717
"^DD",101.41,101.416,2,0)
TEXT^101.4162^^2;0
"^DD",101.41,101.416,2,21,0)
^^1^1^2971219^
"^DD",101.41,101.416,2,21,1,0)
This contains the actual response, for word-processing type prompts.
"^DD",101.41,101.416,2,"DT")
2960717
"^DD",101.41,101.4162,0)
TEXT SUB-FIELD^^.01^1
"^DD",101.41,101.4162,0,"DT")
2960717
"^DD",101.41,101.4162,0,"NM","TEXT")

"^DD",101.41,101.4162,0,"UP")
101.416
"^DD",101.41,101.4162,.01,0)
TEXT^WL^^0;1^Q
"^DD",101.41,101.4162,.01,21,0)
^^1^1^2960717^^
"^DD",101.41,101.4162,.01,21,1,0)
This contains responses to items that are a word processing type.
"^DD",101.41,101.4162,.01,"DT")
2960717
"^DD",101.43,101.43,0)
FIELD^^50.7^39
"^DD",101.43,101.43,0,"DDA")
N
"^DD",101.43,101.43,0,"DT")
3061122
"^DD",101.43,101.43,0,"IX","AQO",101.439,2)

"^DD",101.43,101.43,0,"IX","B",101.43,.01)

"^DD",101.43,101.43,0,"IX","B",101.432,.01)

"^DD",101.43,101.43,0,"IX","C",101.43,3)

"^DD",101.43,101.43,0,"IX","C1",101.439,.01)

"^DD",101.43,101.43,0,"IX","C2",101.43,.01)

"^DD",101.43,101.43,0,"IX","CD",101.43,.1)

"^DD",101.43,101.43,0,"IX","COMMON",101.43,71.4)

"^DD",101.43,101.43,0,"IX","COMMON1",101.43,71.3)

"^DD",101.43,101.43,0,"IX","COMMON2",101.43,.01)

"^DD",101.43,101.43,0,"IX","ID",101.43,2)

"^DD",101.43,101.43,0,"IX","S",101.439,.01)

"^DD",101.43,101.43,0,"IX","S0",101.43,.01)

"^DD",101.43,101.43,0,"IX","S1",101.43,111.1)

"^DD",101.43,101.43,0,"IX","S10",101.43,50.7)

"^DD",101.43,101.43,0,"IX","S10",101.43,6001)

"^DD",101.43,101.43,0,"IX","S11",101.43,6002)

"^DD",101.43,101.43,0,"IX","S2",101.43,71.3)

"^DD",101.43,101.43,0,"IX","S3",101.43,60.6)

"^DD",101.43,101.43,0,"IX","S4",101.43,50.1)

"^DD",101.43,101.43,0,"IX","S5",101.43,50.2)

"^DD",101.43,101.43,0,"IX","S6",101.43,50.3)

"^DD",101.43,101.43,0,"IX","S7",101.43,5)

"^DD",101.43,101.43,0,"IX","S8",101.43,50.4)

"^DD",101.43,101.43,0,"IX","S9",101.43,50.5)

"^DD",101.43,101.43,0,"IX","SD",101.43,.1)

"^DD",101.43,101.43,0,"IX","SS",101.432,.01)

"^DD",101.43,101.43,0,"IX","SS1",101.439,.01)

"^DD",101.43,101.43,0,"IX","SS2",101.43,.01)

"^DD",101.43,101.43,0,"IX","SSD",101.43,.1)

"^DD",101.43,101.43,0,"IX","SST",101.43,60.7)

"^DD",101.43,101.43,0,"IX","ST",101.43,60.7)

"^DD",101.43,101.43,0,"NM","ORDERABLE ITEMS")

"^DD",101.43,101.43,0,"PT",100,7)

"^DD",101.43,101.43,0,"PT",100.001,.01)

"^DD",101.43,101.43,0,"PT",100.68,.01)

"^DD",101.43,101.43,0,"PT",101.442,.01)

"^DD",101.43,101.43,0,"PT",801.41,17)

"^DD",101.43,101.43,0,"PT",801.43,.02)

"^DD",101.43,101.43,0,"PT",810.31,.04)

"^DD",101.43,101.43,0,"PT",810.32,.01)

"^DD",101.43,101.43,0,"PT",811.52,.01)

"^DD",101.43,101.43,0,"PT",811.902,.01)

"^DD",101.43,101.43,0,"VRPK")
ORDER ENTRY/RESULTS REPORTING
"^DD",101.43,101.43,0,"VRRV")
1^3061122
"^DD",101.43,101.43,.01,0)
NAME^RFX^^0;1^K:$L(X)>63!($L(X)<3)!($$CHKNAM^ORUTL(X,";^")) X
"^DD",101.43,101.43,.01,1,0)
^.1^^-1
"^DD",101.43,101.43,.01,1,1,0)
101.43^B
"^DD",101.43,101.43,.01,1,1,1)
S ^ORD(101.43,"B",$E(X,1,30),DA)=""
"^DD",101.43,101.43,.01,1,1,2)
K ^ORD(101.43,"B",$E(X,1,30),DA)
"^DD",101.43,101.43,.01,1,2,0)
101.43^C2^MUMPS
"^DD",101.43,101.43,.01,1,2,1)
N CD,IN S CD=$P(^ORD(101.43,DA,0),U,3),IN=$G(^(.1)) D CS^ORDD43(X,CD,IN)
"^DD",101.43,101.43,.01,1,2,2)
N CD S CD=$P(^ORD(101.43,DA,0),U,3) D CK^ORDD43(X,CD)
"^DD",101.43,101.43,.01,1,2,"%D",0)
^^1^1^2990316^^^
"^DD",101.43,101.43,.01,1,2,"%D",1,0)
Allows retrieval of items by code within Sets.
"^DD",101.43,101.43,.01,1,2,"DT")
2950713
"^DD",101.43,101.43,.01,1,3,0)
101.43^S0^MUMPS
"^DD",101.43,101.43,.01,1,3,1)
N IN,TYP S IN=$G(^ORD(101.43,DA,.1)),TYP=$P($G(^("LR")),U,7) D SS^ORDD43(X,IN,TYP)
"^DD",101.43,101.43,.01,1,3,2)
D SK^ORDD43(X)
"^DD",101.43,101.43,.01,1,3,"%D",0)
^^2^2^2990316^^^^
"^DD",101.43,101.43,.01,1,3,"%D",1,0)
Allows retrieval of orderable items via the Set "S" xrefs:
"^DD",101.43,101.43,.01,1,3,"%D",2,0)
^ORD(101.43,"S.<set>",NAME,DA)
"^DD",101.43,101.43,.01,1,3,"DT")
2950810
"^DD",101.43,101.43,.01,1,4,0)
101.43^COMMON2^MUMPS
"^DD",101.43,101.43,.01,1,4,1)
N IT,CP S IT=$P($G(^ORD(101.43,DA,"RA")),U,3),CP=$P($G(^("RA")),U,4) D SETRA^ORDD43(X,IT,CP)
"^DD",101.43,101.43,.01,1,4,2)
N IT,CP S IT=$P($G(^ORD(101.43,DA,"RA")),U,3),CP=$P($G(^("RA")),U,4) D KILLRA^ORDD43(X,IT,CP)
"^DD",101.43,101.43,.01,1,4,"%D",0)
^^2^2^2990316^^^
"^DD",101.43,101.43,.01,1,4,"%D",1,0)
Allows retrieval of Radiology common procedures alphabetically within
"^DD",101.43,101.43,.01,1,4,"%D",2,0)
imaging types.
"^DD",101.43,101.43,.01,1,4,"DT")
2950725
"^DD",101.43,101.43,.01,1,5,0)
101.43^SS2^MUMPS
"^DD",101.43,101.43,.01,1,5,1)
N IN,TYP S IN=$G(^ORD(101.43,DA,.1)),TYP=$P($G(^("LR")),U,7) D SS1^ORDD43(X,IN,TYP)
"^DD",101.43,101.43,.01,1,5,2)
D SK1^ORDD43(X)
"^DD",101.43,101.43,.01,1,5,"%D",0)
^^2^2^2990316^^^
"^DD",101.43,101.43,.01,1,5,"%D",1,0)
Allows retrieval of items by synonym via the Set "S" xrefs:
"^DD",101.43,101.43,.01,1,5,"%D",2,0)
^ORD(101.43,"S.<set>",SYNONYM,DA)
"^DD",101.43,101.43,.01,1,5,"DT")
2950810
"^DD",101.43,101.43,.01,3)
Answer must be 3-63 characters in length and cannot contain a semicolon (;) or an up-arrow (^)
"^DD",101.43,101.43,.01,21,0)
2^.001^1^1^3010510^^^^
"^DD",101.43,101.43,.01,21,1,0)
This is the name of this item that will be used for displaying and searching.
"^DD",101.43,101.43,.01,"DT")
3010419
"^DD",101.43,101.43,.01,"V",0)
^.12P^1^1
"^DD",101.43,101.43,.01,"V",1,0)
60^LABORATORY TEST^1^LAB^^n
"^DD",101.43,101.43,.1,0)
INACTIVATED^D^^.1;1^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",101.43,101.43,.1,1,0)
^.1
"^DD",101.43,101.43,.1,1,1,0)
101.43^SD^MUMPS
"^DD",101.43,101.43,.1,1,1,1)
N NM,TYP S NM=$P(^ORD(101.43,DA,0),U),TYP=$P($G(^("LR")),U,7) D SS^ORDD43(NM,X,TYP)
"^DD",101.43,101.43,.1,1,1,2)
N NM,TYP S NM=$P(^ORD(101.43,DA,0),U),TYP=$P($G(^("LR")),U,7) D SS^ORDD43(NM,,TYP)
"^DD",101.43,101.43,.1,1,1,"%D",0)
^^1^1^2960814^
"^DD",101.43,101.43,.1,1,1,"%D",1,0)
Allows retrieval of orderable items by set.
"^DD",101.43,101.43,.1,1,1,"DT")
2960814
"^DD",101.43,101.43,.1,1,2,0)
101.43^SSD^MUMPS
"^DD",101.43,101.43,.1,1,2,1)
N NM,TYP S NM=$P(^ORD(101.43,DA,0),U),TYP=$P($G(^("LR")),U,7) D SS1^ORDD43(NM,X,TYP)
"^DD",101.43,101.43,.1,1,2,2)
N NM,TYP S NM=$P(^ORD(101.43,DA,0),U),TYP=$P($G(^("LR")),U,7) D SS1^ORDD43(NM,,TYP)
"^DD",101.43,101.43,.1,1,2,"%D",0)
^^1^1^2960814^
"^DD",101.43,101.43,.1,1,2,"%D",1,0)
Allows retrieval of items by synonym via the Set "S" xrefs.
"^DD",101.43,101.43,.1,1,2,"DT")
2960814
"^DD",101.43,101.43,.1,1,3,0)
101.43^CD^MUMPS
"^DD",101.43,101.43,.1,1,3,1)
N NM,CD S NM=$P(^ORD(101.43,DA,0),U),CD=$P(^(0),U,3) D CS^ORDD43(NM,CD,X)
"^DD",101.43,101.43,.1,1,3,2)
N NM,CD S NM=$P(^ORD(101.43,DA,0),U),CD=$P(^(0),U,3) D CS^ORDD43(NM,CD)
"^DD",101.43,101.43,.1,1,3,"%D",0)
^^1^1^2960814^
"^DD",101.43,101.43,.1,1,3,"%D",1,0)
Allows retrieval of items by code within Sets.
"^DD",101.43,101.43,.1,1,3,"DT")
2960814
"^DD",101.43,101.43,.1,3)
Enter the date and time after which this item may no longer be ordered.
"^DD",101.43,101.43,.1,21,0)
^^3^3^2950303^
"^DD",101.43,101.43,.1,21,1,0)
This is a date and time for inactivating this item.  If this field has a
"^DD",101.43,101.43,.1,21,2,0)
value, this item will not ba available to select for ordering after this
"^DD",101.43,101.43,.1,21,3,0)
date.
"^DD",101.43,101.43,.1,"DT")
2960814
"^DD",101.43,101.43,.91,0)
NOTIFY ON ORDER^S^1:YES;0:NO;^.9;1^Q
"^DD",101.43,101.43,.91,3)
Enter YES if a notification should be generated whenever this item is ordered.
"^DD",101.43,101.43,.91,21,0)
^^2^2^2950523^
"^DD",101.43,101.43,.91,21,1,0)
This field is a flag to determine if a notification should be generated
"^DD",101.43,101.43,.91,21,2,0)
whenever an order for this item is placed.
"^DD",101.43,101.43,.91,"DT")
2950523
"^DD",101.43,101.43,.92,0)
NOTIFY WHEN RESULTED^S^1:YES;0:NO;^.9;2^Q
"^DD",101.43,101.43,.92,3)
Enter YES if a notification should be generated when an order for this item is resulted.
"^DD",101.43,101.43,.92,21,0)
^^2^2^2950523^
"^DD",101.43,101.43,.92,21,1,0)
This field is a flag to determine if a notification should be sent when
"^DD",101.43,101.43,.92,21,2,0)
results are posted for an order for this item.
"^DD",101.43,101.43,.92,"DT")
2950523
"^DD",101.43,101.43,1,0)
SYNONYMS^101.432A^^2;0
"^DD",101.43,101.43,1,21,0)
^^2^2^2990223^^
"^DD",101.43,101.43,1,21,1,0)
This multiple contains synonyms for this orderable item, used when
"^DD",101.43,101.43,1,21,2,0)
searching the file.
"^DD",101.43,101.43,1.1,0)
PACKAGE NAME^RF^^0;8^K:$L(X)>63!($L(X)<3) X
"^DD",101.43,101.43,1.1,1,0)
^.1^^0
"^DD",101.43,101.43,1.1,3)
Answer must be 3-63 characters in length.
"^DD",101.43,101.43,1.1,21,0)
^^1^1^2960910^^^^
"^DD",101.43,101.43,1.1,21,1,0)
This is the name of this item as defined by the filling service.
"^DD",101.43,101.43,1.1,"DT")
2960920
"^DD",101.43,101.43,2,0)
ID^RF^^0;2^K:$L(X)>30!($L(X)<3) X
"^DD",101.43,101.43,2,1,0)
^.1
"^DD",101.43,101.43,2,1,1,0)
101.43^ID
"^DD",101.43,101.43,2,1,1,1)
S ^ORD(101.43,"ID",$E(X,1,30),DA)=""
"^DD",101.43,101.43,2,1,1,2)
K ^ORD(101.43,"ID",$E(X,1,30),DA)
"^DD",101.43,101.43,2,1,1,"DT")
2950303
"^DD",101.43,101.43,2,3)
Answer must be 3-30 characters in length.
"^DD",101.43,101.43,2,21,0)
^^4^4^2950303^^
"^DD",101.43,101.43,2,21,1,0)
This is a unique identifier for this item, created from the primary key
"^DD",101.43,101.43,2,21,2,0)
passed in the Orderable Items update message from each package; it will
"^DD",101.43,101.43,2,21,3,0)
be in the form of "package code;99XXX" where XXX indicates the package
"^DD",101.43,101.43,2,21,4,0)
table originating this item (i.e. RAP, LRT, etc).
"^DD",101.43,101.43,2,"DT")
2950303
"^DD",101.43,101.43,3,0)
CODE^F^^0;3^K:$L(X)>10!($L(X)<1) X
"^DD",101.43,101.43,3,1,0)
^.1
"^DD",101.43,101.43,3,1,1,0)
101.43^C^MUMPS
"^DD",101.43,101.43,3,1,1,1)
N NM,IN S NM=$P(^ORD(101.43,DA,0),U),IN=$G(^(.1)) D CS^ORDD43(NM,X,IN)
"^DD",101.43,101.43,3,1,1,2)
N NM S NM=$P(^ORD(101.43,DA,0),U) D CK^ORDD43(NM,X)
"^DD",101.43,101.43,3,1,1,"%D",0)
^^1^1^2950713^^^^
"^DD",101.43,101.43,3,1,1,"%D",1,0)
Allows retrieval of items by code within Sets.
"^DD",101.43,101.43,3,1,1,"DT")
2950713
"^DD",101.43,101.43,3,3)
Answer must be 1-10 characters in length.
"^DD",101.43,101.43,3,21,0)
^^2^2^2950303^
"^DD",101.43,101.43,3,21,1,0)
This is the code assigned to this item by the authoritative package,
"^DD",101.43,101.43,3,21,2,0)
from a national standard coding system such as CPT or SNOMED.
"^DD",101.43,101.43,3,"DT")
2950713
"^DD",101.43,101.43,4,0)
CODING SYSTEM^S^NDF:NATIONAL DRUG FILE;CPT4:CPT4;NLT:NATIONAL LAB TEST FILE;^0;4^Q
"^DD",101.43,101.43,4,3)
Enter the coding system in which this item has been coded.
"^DD",101.43,101.43,4,21,0)
^^1^1^2960213^^
"^DD",101.43,101.43,4,21,1,0)
This is the system used to generate the code assigned in field 3.
"^DD",101.43,101.43,4,"DT")
2960213
"^DD",101.43,101.43,5,0)
DISPLAY GROUP^P100.98'^ORD(100.98,^0;5^Q
"^DD",101.43,101.43,5,1,0)
^.1
"^DD",101.43,101.43,5,1,1,0)
101.43^S7^MUMPS
"^DD",101.43,101.43,5,1,1,1)
N ORX S ORX=$P(^ORD(100.98,X,0),U,3) D:$L(ORX) SET^ORDD43(ORX,DA)
"^DD",101.43,101.43,5,1,1,2)
N ORX S ORX=$P(^ORD(100.98,X,0),U,3) D:$L(ORX) KILL^ORDD43(ORX,DA)
"^DD",101.43,101.43,5,1,1,"%D",0)
^^1^1^2950303^
"^DD",101.43,101.43,5,1,1,"%D",1,0)
Creates an entry in SET multiple.
"^DD",101.43,101.43,5,1,1,"DT")
2950303
"^DD",101.43,101.43,5,3)
Enter the display group this orderable item belongs to.
"^DD",101.43,101.43,5,21,0)
^^4^4^2950303^
"^DD",101.43,101.43,5,21,1,0)
This is the display group that this item is a menber of; this field is
"^DD",101.43,101.43,5,21,2,0)
used for a variety of purposes such as narrowing a search for an item,
"^DD",101.43,101.43,5,21,3,0)
sorting and grouping orders, and passing the order to the service
"^DD",101.43,101.43,5,21,4,0)
for filling.
"^DD",101.43,101.43,5,"DT")
2950303
"^DD",101.43,101.43,6,0)
COST^NJ10,2^^0;6^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>9999999.99)!(X<0) X
"^DD",101.43,101.43,6,3)
Type a Dollar Amount between 0 and 9999999.99, 2 Decimal Digits
"^DD",101.43,101.43,6,21,0)
^^1^1^2950303^
"^DD",101.43,101.43,6,21,1,0)
This is the [approximate] cost of filling an order for this item.
"^DD",101.43,101.43,6,"DT")
2950303
"^DD",101.43,101.43,7,0)
AUTHORIZATION^S^0:NO SIGNATURE REQUIRED;1:PHYSICIAN;2:SPECIALIST;3:SERVICE CHIEF;4:COSIGNATURE;^0;7^Q
"^DD",101.43,101.43,7,3)
Enter the level of authorization required to release an order for this item.
"^DD",101.43,101.43,7,21,0)
^^3^3^2950303^
"^DD",101.43,101.43,7,21,1,0)
This field is used to identify the level of authentication necessary to
"^DD",101.43,101.43,7,21,2,0)
release an order for this item; it will be replaced by the Clinical
"^DD",101.43,101.43,7,21,3,0)
Authorization and Subscription Utility (CASU) when it becomes available.
"^DD",101.43,101.43,7,"DT")
2950303
"^DD",101.43,101.43,8,0)
ORDER MESSAGE^101.438^^8;0
"^DD",101.43,101.43,8,21,0)
^.001^2^2^3040407^^
"^DD",101.43,101.43,8,21,1,0)
This field contains text that is to be displayed to the user whenever
"^DD",101.43,101.43,8,21,2,0)
this item is selected to be ordered.
"^DD",101.43,101.43,9,0)
SET MEMBERSHIP^101.439A^^9;0
"^DD",101.43,101.43,9,21,0)
^^3^3^2941117^
"^DD",101.43,101.43,9,21,1,0)
This field contains the names of sets to which this orderable item belongs.
"^DD",101.43,101.43,9,21,2,0)
When a set name is entered here, a cross-reference of the format "S.name"
"^DD",101.43,101.43,9,21,3,0)
is created, allowing rapid lookups on this file.
"^DD",101.43,101.43,10,0)
COMPONENTS^101.431A^^10;0
"^DD",101.43,101.43,10,21,0)
^^2^2^2960411^^^
"^DD",101.43,101.43,10,21,1,0)
This multiple contains the components of this orderable item, i.e. drug
"^DD",101.43,101.43,10,21,2,0)
ingredients or tests in a lab panel.
"^DD",101.43,101.43,50.1,0)
INPATIENT MED^S^0:NO;1:YES;2:YES-IV;^PS;1^Q
"^DD",101.43,101.43,50.1,1,0)
^.1
"^DD",101.43,101.43,50.1,1,1,0)
101.43^S4^MUMPS
"^DD",101.43,101.43,50.1,1,1,1)
D SET^ORDD43("UD RX",DA):X,SET^ORDD43("IVM RX",DA):X=2
"^DD",101.43,101.43,50.1,1,1,2)
D KILL^ORDD43("UD RX",DA):X,KILL^ORDD43("IVM RX",DA):X=2
"^DD",101.43,101.43,50.1,1,1,"%D",0)
^^1^1^2950623^^^^
"^DD",101.43,101.43,50.1,1,1,"%D",1,0)
Creates an entry in SET multiple.
"^DD",101.43,101.43,50.1,1,1,"DT")
2950623
"^DD",101.43,101.43,50.1,3)
Enter YES if this drug is selectable for an inpatient med order.
"^DD",101.43,101.43,50.1,21,0)
^^1^1^2970624^^
"^DD",101.43,101.43,50.1,21,1,0)
This field indicates if this drug is selectable for an inpatient med order.
"^DD",101.43,101.43,50.1,"DT")
2970624
"^DD",101.43,101.43,50.2,0)
OUTPATIENT MED^S^1:YES;0:NO;^PS;2^Q
"^DD",101.43,101.43,50.2,1,0)
^.1
"^DD",101.43,101.43,50.2,1,1,0)
101.43^S5^MUMPS
"^DD",101.43,101.43,50.2,1,1,1)
D:X SET^ORDD43("O RX",DA)
"^DD",101.43,101.43,50.2,1,1,2)
D:X KILL^ORDD43("O RX",DA)
"^DD",101.43,101.43,50.2,1,1,"%D",0)
^^1^1^2950112^^
"^DD",101.43,101.43,50.2,1,1,"%D",1,0)
Creates an entry in SET multiple.
"^DD",101.43,101.43,50.2,1,1,"DT")
2950112
"^DD",101.43,101.43,50.2,3)
Enter YES if this drug is selectable for an outpatient med order.
"^DD",101.43,101.43,50.2,21,0)
^^1^1^2950112^
"^DD",101.43,101.43,50.2,21,1,0)
This field indicates if this drug is selectable for an outpatient med order.
"^DD",101.43,101.43,50.2,"DT")
2950112
"^DD",101.43,101.43,50.3,0)
IV BASE^S^1:YES;0:NO;^PS;3^Q
"^DD",101.43,101.43,50.3,1,0)
^.1
"^DD",101.43,101.43,50.3,1,1,0)
101.43^S6^MUMPS
"^DD",101.43,101.43,50.3,1,1,1)
D:X SET^ORDD43("IVB RX",DA)
"^DD",101.43,101.43,50.3,1,1,2)
D:X KILL^ORDD43("IVB RX",DA)
"^DD",101.43,101.43,50.3,1,1,"%D",0)
^^1^1^2950623^^^
"^DD",101.43,101.43,50.3,1,1,"%D",1,0)
Creates an entry in SET multiple.
"^DD",101.43,101.43,50.3,1,1,"DT")
2950623
"^DD",101.43,101.43,50.3,3)
Enter YES if this drug is selectable as a base for an IV Fluid order.
"^DD",101.43,101.43,50.3,21,0)
^^2^2^2950112^
"^DD",101.43,101.43,50.3,21,1,0)
This field indicates if this drug is selectable as a base for an IV Fluid
"^DD",101.43,101.43,50.3,21,2,0)
order.
"^DD",101.43,101.43,50.3,"DT")
2950623
"^DD",101.43,101.43,50.4,0)
IV ADDITIVE^S^1:YES;0:NO;^PS;4^Q
"^DD",101.43,101.43,50.4,1,0)
^.1
"^DD",101.43,101.43,50.4,1,1,0)
101.43^S8^MUMPS
"^DD",101.43,101.43,50.4,1,1,1)
D:X SET^ORDD43("IVA RX",DA)
"^DD",101.43,101.43,50.4,1,1,2)
D:X KILL^ORDD43("IVA RX",DA)
"^DD",101.43,101.43,50.4,1,1,"%D",0)
^^1^1^2950623^^^
"^DD",101.43,101.43,50.4,1,1,"%D",1,0)
Creates an entry in SET multiple.
"^DD",101.43,101.43,50.4,1,1,"DT")
2950623
"^DD",101.43,101.43,50.4,3)
Enter YES if this drug is selectable as an additive for an IV Fluid order.
"^DD",101.43,101.43,50.4,21,0)
^^2^2^2950112^
"^DD",101.43,101.43,50.4,21,1,0)
This field indicates if this drug is selectable as an additive for an IV
"^DD",101.43,101.43,50.4,21,2,0)
Fluid order.
"^DD",101.43,101.43,50.4,"DT")
2950623
"^DD",101.43,101.43,50.5,0)
SUPPLY^S^1:YES;0:NO;^PS;5^Q
"^DD",101.43,101.43,50.5,1,0)
^.1
"^DD",101.43,101.43,50.5,1,1,0)
101.43^S9^MUMPS
"^DD",101.43,101.43,50.5,1,1,1)
D:X SET^ORDD43("SPLY",DA)
"^DD",101.43,101.43,50.5,1,1,2)
D:X KILL^ORDD43("SPLY",DA)
"^DD",101.43,101.43,50.5,1,1,"%D",0)
^^1^1^2960402^
"^DD",101.43,101.43,50.5,1,1,"%D",1,0)
Creates an entry in SET multiple.
"^DD",101.43,101.43,50.5,1,1,"DT")
2960402
"^DD",101.43,101.43,50.5,3)
Enter YES if this item is selectable for a medication supply order.
"^DD",101.43,101.43,50.5,21,0)
^^2^2^2960402^
"^DD",101.43,101.43,50.5,21,1,0)
This field indicates if this item is selectable for a medication supply
"^DD",101.43,101.43,50.5,21,2,0)
order.
"^DD",101.43,101.43,50.5,"DT")
2960402
"^DD",101.43,101.43,50.6,0)
NON-FORMULARY^S^1:YES;0:NO;^PS;6^Q
"^DD",101.43,101.43,50.6,3)
Enter YES if this orderable item in not in the local formulary.
"^DD",101.43,101.43,50.6,21,0)
^^1^1^3000828^
"^DD",101.43,101.43,50.6,21,1,0)
This field indicates if this item is available in the local formulary.
"^DD",101.43,101.43,50.6,"DT")
3000828
"^DD",101.43,101.43,50.7,0)
NON-VA MEDS^S^1:YES;0:NO;^PS;7^Q
"^DD",101.43,101.43,50.7,1,0)
^.1
"^DD",101.43,101.43,50.7,1,10,0)
101.43^S10^MUMPS
"^DD",101.43,101.43,50.7,1,10,1)
D:X SET^ORDD43("NV RX",DA)
"^DD",101.43,101.43,50.7,1,10,2)
D:X KILL^ORDD43("NV RX",DA)
"^DD",101.43,101.43,50.7,1,10,"%D",0)
^.101^1^1^3030214^^
"^DD",101.43,101.43,50.7,1,10,"%D",1,0)
Creates an entry in SET multiple.
"^DD",101.43,101.43,50.7,1,10,"DT")
3030214
"^DD",101.43,101.43,50.7,3)
Enter YES if this drug is selectable for a non-VA med order.
"^DD",101.43,101.43,50.7,21,0)
^.001^1^1^3030305^^^^
"^DD",101.43,101.43,50.7,21,1,0)
This field indicates if this drug is selectable for a non-VA med order.
"^DD",101.43,101.43,50.7,"DT")
3030214
"^DD",101.43,101.43,60.1,0)
SPECIMEN^F^^LR;1^K:$L(X)>100!($L(X)<1) X
"^DD",101.43,101.43,60.1,3)
Answer must be 1-100 characters in length.
"^DD",101.43,101.43,60.1,21,0)
^^4^4^2950509^^
"^DD",101.43,101.43,60.1,21,1,0)
This is the specimen to be collected for this test; it is in the 6-piece
"^DD",101.43,101.43,60.1,21,2,0)
HL7 format, where the first 3 pieces are the code, name, and system of
"^DD",101.43,101.43,60.1,21,3,0)
the SNOMED code for this specimen, and the last 3 pieces are similarly
"^DD",101.43,101.43,60.1,21,4,0)
from the local Site/Specimen file.
"^DD",101.43,101.43,60.1,"DT")
2950509
"^DD",101.43,101.43,60.2,0)
CAN LAB COLLECT^S^1:YES;0:NO;^LR;2^Q
"^DD",101.43,101.43,60.2,3)
Enter YES if the phlebotomy team can collect this specimen.
"^DD",101.43,101.43,60.2,21,0)
^^1^1^2950208^
"^DD",101.43,101.43,60.2,21,1,0)
This identifies which specimens the lab phlebotomy team can collect.
"^DD",101.43,101.43,60.2,"DT")
2950208
"^DD",101.43,101.43,60.3,0)
SEQUENCE^NJ2,0^^LR;3^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.43,101.43,60.3,3)
Type a Number between 1 and 99, 0 Decimal Digits
"^DD",101.43,101.43,60.3,21,0)
^^2^2^2950208^
"^DD",101.43,101.43,60.3,21,1,0)
This field indicates the order in which specimens are presented for
"^DD",101.43,101.43,60.3,21,2,0)
selection, the first being the most often selected and the default.
"^DD",101.43,101.43,60.3,"DT")
2950208
"^DD",101.43,101.43,60.4,0)
MAX ORDER FREQUENCY^NJ3,0^^LR;4^K:+X'=X!(X>120)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.43,101.43,60.4,3)
Type a Number between 1 and 120, 0 Decimal Digits
"^DD",101.43,101.43,60.4,21,0)
^^3^3^2950208^
"^DD",101.43,101.43,60.4,21,1,0)
This is used to control how often this item may be ordered within a given
"^DD",101.43,101.43,60.4,21,2,0)
time period.  This item may be ordered only once within the number of days
"^DD",101.43,101.43,60.4,21,3,0)
specified in this field.
"^DD",101.43,101.43,60.4,"DT")
2950208
"^DD",101.43,101.43,60.5,0)
DAILY ORDER MAX^NJ2,0^^LR;5^K:+X'=X!(X>50)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.43,101.43,60.5,3)
Type a Number between 1 and 50, 0 Decimal Digits
"^DD",101.43,101.43,60.5,21,0)
^^2^2^2950208^
"^DD",101.43,101.43,60.5,21,1,0)
This is the number of times within a given day that this item may be
"^DD",101.43,101.43,60.5,21,2,0)
ordered.
"^DD",101.43,101.43,60.5,"DT")
2950208
"^DD",101.43,101.43,60.6,0)
LAB SECTION^S^CH:CHEMISTRY;MI:MICROBIOLOGY;BB:BLOOD BANK;EM:ELECTRON MICROSCOPY;SP:SURGICAL PATHOLOGY;AU:AUTOPSY;CY:CYTOLOGY;^LR;6^Q
"^DD",101.43,101.43,60.6,1,0)
^.1
"^DD",101.43,101.43,60.6,1,1,0)
101.43^S3^MUMPS
"^DD",101.43,101.43,60.6,1,1,1)
N ORX S ORX=$S(X="BB":"BB",X="CH":"CH",X="MI":"CH",1:"AP") D SET^ORDD43(ORX,DA)
"^DD",101.43,101.43,60.6,1,1,2)
N ORX S ORX=$S(X="BB":"BB",X="CH":"CH",X="MI":"CH",1:"AP") D KILL^ORDD43(ORX,DA)
"^DD",101.43,101.43,60.6,1,1,"%D",0)
^^1^1^2950208^
"^DD",101.43,101.43,60.6,1,1,"%D",1,0)
Creates an entry in SET multiple.
"^DD",101.43,101.43,60.6,1,1,"DT")
2950208
"^DD",101.43,101.43,60.6,3)
Enter the lab section for this test.
"^DD",101.43,101.43,60.6,21,0)
^^2^2^2960529^^
"^DD",101.43,101.43,60.6,21,1,0)
This is the lab section to which orders for this test and sample will be
"^DD",101.43,101.43,60.6,21,2,0)
sent.
"^DD",101.43,101.43,60.6,"DT")
2960529
"^DD",101.43,101.43,60.7,0)
TYPE^S^I:input;O:output;B:both;N:neither;^LR;7^Q
"^DD",101.43,101.43,60.7,1,0)
^.1
"^DD",101.43,101.43,60.7,1,1,0)
101.43^ST^MUMPS
"^DD",101.43,101.43,60.7,1,1,1)
N NM,IN S NM=$P(^ORD(101.43,DA,0),U),IN=$G(^(.1)) D SS^ORDD43(NM,IN,X)
"^DD",101.43,101.43,60.7,1,1,2)
N NM S NM=$P(^ORD(101.43,DA,0),U) D SK^ORDD43(NM)
"^DD",101.43,101.43,60.7,1,1,"%D",0)
^^1^1^2960911^
"^DD",101.43,101.43,60.7,1,1,"%D",1,0)
Allows retrieval of orderable items by set.
"^DD",101.43,101.43,60.7,1,1,"DT")
2960911
"^DD",101.43,101.43,60.7,1,2,0)
101.43^SST^MUMPS
"^DD",101.43,101.43,60.7,1,2,1)
N NM,IN S NM=$P(^ORD(101.43,DA,0),U),IN=$G(^(.1)) D SS1^ORDD43(NM,IN,X)
"^DD",101.43,101.43,60.7,1,2,2)
N NM S NM=$P(^ORD(101.43,DA,0),U) D SK1^ORDD43(NM)
"^DD",101.43,101.43,60.7,1,2,"%D",0)
^^1^1^2960911^
"^DD",101.43,101.43,60.7,1,2,"%D",1,0)
Allows retrieval of items by synonym via the Set "S" xrefs.
"^DD",101.43,101.43,60.7,1,2,"DT")
2960911
"^DD",101.43,101.43,60.7,3)
Enter I if this test is orderable, O if it is only for results reporting, B if it may be used for both purposes, or N for neither.
"^DD",101.43,101.43,60.7,21,0)
^^2^2^2970703^^
"^DD",101.43,101.43,60.7,21,1,0)
This field indicates if this item may be selected when ordering a lab
"^DD",101.43,101.43,60.7,21,2,0)
test, and/or if it is included in this file for results reporting only.
"^DD",101.43,101.43,60.7,"DT")
2970703
"^DD",101.43,101.43,71.1,0)
CONTRAST MEDIA^F^^RA;1^K:$L(X)>7!($L(X)<1) X
"^DD",101.43,101.43,71.1,3)
Answer must be 1-7 characters in length
"^DD",101.43,101.43,71.1,21,0)
^^14^14^3050106^
"^DD",101.43,101.43,71.1,21,1,0)
This field indicates what contrast media, if any, is used by this
"^DD",101.43,101.43,71.1,21,2,0)
radiologic procedure where:
"^DD",101.43,101.43,71.1,21,3,0)
 
"^DD",101.43,101.43,71.1,21,4,0)
      I = Ionic Iodinated
"^DD",101.43,101.43,71.1,21,5,0)
      N = Non-ionic Iodinated
"^DD",101.43,101.43,71.1,21,6,0)
      L = Gadolinium
"^DD",101.43,101.43,71.1,21,7,0)
      C = Cholecystographic
"^DD",101.43,101.43,71.1,21,8,0)
      G = Gastrografin
"^DD",101.43,101.43,71.1,21,9,0)
      B = Barium
"^DD",101.43,101.43,71.1,21,10,0)
      M = Unspecified contrast media
"^DD",101.43,101.43,71.1,21,11,0)
 
"^DD",101.43,101.43,71.1,21,12,0)
This value may consist of as many of these flags as are appropriate for
"^DD",101.43,101.43,71.1,21,13,0)
this procedure; if empty, no contrast media is assumed.  This field is 
"^DD",101.43,101.43,71.1,21,14,0)
used primarily for Order Checking.
"^DD",101.43,101.43,71.1,"DT")
3050915
"^DD",101.43,101.43,71.2,0)
PROCEDURE TYPE^S^B:BROAD;D:DETAILED;S:SERIES;P:PARENT;^RA;2^Q
"^DD",101.43,101.43,71.2,3)
Enter the type of radiologic procedure for this item.
"^DD",101.43,101.43,71.2,21,0)
^^2^2^2941116^
"^DD",101.43,101.43,71.2,21,1,0)
This field identifies the procedure type for this orderable item whether
"^DD",101.43,101.43,71.2,21,2,0)
broad or detailed, a series or parent exam.
"^DD",101.43,101.43,71.2,"DT")
2941116
"^DD",101.43,101.43,71.3,0)
IMAGING TYPE^S^RAD:RADIOLOGY;CT:CT SCAN;MRI:MAGNETIC RESONANCE IMAGING;ANI:ANGIO/NEURO/INTERVENTIONAL;CARD:CARDIOLOGY STUDIES;NM:NUCLEAR MEDICINE;US:ULTRASOUND;VAS:VASCULAR LAB;MAM:MAMMOGRAPHY;^RA;3^Q
"^DD",101.43,101.43,71.3,1,0)
^.1
"^DD",101.43,101.43,71.3,1,1,0)
101.43^S2^MUMPS
"^DD",101.43,101.43,71.3,1,1,1)
D SET^ORDD43(X,DA)
"^DD",101.43,101.43,71.3,1,1,2)
D KILL^ORDD43(X,DA)
"^DD",101.43,101.43,71.3,1,1,"%D",0)
^^1^1^2950112^^
"^DD",101.43,101.43,71.3,1,1,"%D",1,0)
Creates an entry in SET multiple.
"^DD",101.43,101.43,71.3,1,1,"DT")
2950112
"^DD",101.43,101.43,71.3,1,2,0)
101.43^COMMON1^MUMPS
"^DD",101.43,101.43,71.3,1,2,1)
N CP,NM S NM=$P(^ORD(101.43,DA,0),U),CP=$P($G(^("RA")),U,4) D SETRA^ORDD43(NM,X,CP)
"^DD",101.43,101.43,71.3,1,2,2)
N CP,NM S NM=$P(^ORD(101.43,DA,0),U),CP=$P($G(^("RA")),U,4) D KILLRA^ORDD43(NM,X,CP)
"^DD",101.43,101.43,71.3,1,2,"%D",0)
^^2^2^2950725^^^
"^DD",101.43,101.43,71.3,1,2,"%D",1,0)
Allows retrieval of Radiology common procedures alphabetically within
"^DD",101.43,101.43,71.3,1,2,"%D",2,0)
imaging types.
"^DD",101.43,101.43,71.3,1,2,"DT")
2950711
"^DD",101.43,101.43,71.3,3)
Enter the type of imaging for this procedure.
"^DD",101.43,101.43,71.3,21,0)
^^1^1^2971216^^
"^DD",101.43,101.43,71.3,21,1,0)
This is the imaging type of this radiology procedure.
"^DD",101.43,101.43,71.3,"DT")
2971216
"^DD",101.43,101.43,71.4,0)
COMMON PROCEDURE^S^1:YES;0:NO;^RA;4^Q
"^DD",101.43,101.43,71.4,1,0)
^.1
"^DD",101.43,101.43,71.4,1,1,0)
101.43^COMMON^MUMPS
"^DD",101.43,101.43,71.4,1,1,1)
N IT,NM S NM=$P(^ORD(101.43,DA,0),U),IT=$P($G(^("RA")),U,3) D SETRA^ORDD43(NM,IT,X)
"^DD",101.43,101.43,71.4,1,1,2)
N IT,NM S NM=$P(^ORD(101.43,DA,0),U),IT=$P($G(^("RA")),U,3) D KILLRA^ORDD43(NM,IT,X)
"^DD",101.43,101.43,71.4,1,1,"%D",0)
^^2^2^2960910^^^^
"^DD",101.43,101.43,71.4,1,1,"%D",1,0)
Allows retrieval of Radiology common procedures alphabetically within
"^DD",101.43,101.43,71.4,1,1,"%D",2,0)
imaging types.
"^DD",101.43,101.43,71.4,1,1,"DT")
2960910
"^DD",101.43,101.43,71.4,3)
Enter YES if this is a commonly ordered procedure.
"^DD",101.43,101.43,71.4,21,0)
^^3^3^2950711^^
"^DD",101.43,101.43,71.4,21,1,0)
This field indicates that this procedure is commonly ordered from
"^DD",101.43,101.43,71.4,21,2,0)
Radiology, and is an entry in the Radiology Common Procedures file;
"^DD",101.43,101.43,71.4,21,3,0)
the number stored here is the sequence number for display.
"^DD",101.43,101.43,71.4,"DT")
2960910
"^DD",101.43,101.43,111.1,0)
DIET TYPE^S^D:DIET;T:TUBEFEEDING PRODUCT;^FH;1^Q
"^DD",101.43,101.43,111.1,1,0)
^.1
"^DD",101.43,101.43,111.1,1,1,0)
101.43^S1^MUMPS
"^DD",101.43,101.43,111.1,1,1,1)
N ORX S ORX=$S(X="T":"TF",1:"DO") D SET^ORDD43(ORX,DA)
"^DD",101.43,101.43,111.1,1,1,2)
N ORX S ORX=$S(X="T":"TF",1:"DO") D KILL^ORDD43(ORX,DA)
"^DD",101.43,101.43,111.1,1,1,"%D",0)
^^1^1^2950502^^^
"^DD",101.43,101.43,111.1,1,1,"%D",1,0)
Creates an entry in SET multiple.
"^DD",101.43,101.43,111.1,1,1,"DT")
2950502
"^DD",101.43,101.43,111.1,3)
Enter the diet type for this orderable item.
"^DD",101.43,101.43,111.1,21,0)
^^2^2^2941116^
"^DD",101.43,101.43,111.1,21,1,0)
This field identifies the diet type associated with this orderable item,
"^DD",101.43,101.43,111.1,21,2,0)
if the order is for a diet modification or a tubefeeding product.
"^DD",101.43,101.43,111.1,"DT")
2950502
"^DD",101.43,101.43,111.2,0)
PRECEDENCE^NJ2,0^^FH;2^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.43,101.43,111.2,3)
Type a Number between 1 and 99, 0 Decimal Digits
"^DD",101.43,101.43,111.2,21,0)
^^2^2^2971219^^
"^DD",101.43,101.43,111.2,21,1,0)
This field is used to avoid conflicting diet modifications; items with
"^DD",101.43,101.43,111.2,21,2,0)
the same precedence number may not be selected together.
"^DD",101.43,101.43,111.2,"DT")
2941116
"^DD",101.43,101.43,111.3,0)
ASK EXPIRATION DATE?^S^Y:YES;N:NO;^FH;3^Q
"^DD",101.43,101.43,111.3,3)
Enter YES if the user should be asked for an expiration date when this diet is ordered
"^DD",101.43,101.43,111.3,21,0)
^^2^2^2971219^
"^DD",101.43,101.43,111.3,21,1,0)
This is a flag that determines if a stop date should be prompted for
"^DD",101.43,101.43,111.3,21,2,0)
when placing an order for this diet.
"^DD",101.43,101.43,111.3,"DT")
2961101
"^DD",101.43,101.43,123.1,0)
SERVICE USAGE^S^1:GROUPER ONLY;2:TRACKING ONLY;^CS;1^Q
"^DD",101.43,101.43,123.1,3)
Enter the usage of this service if it may NOT be selectable for ordering, 1 for grouping only or 2 for tracking only.
"^DD",101.43,101.43,123.1,21,0)
^^4^4^2971023^
"^DD",101.43,101.43,123.1,21,1,0)
This field contains the usage of this consult service; a value here
"^DD",101.43,101.43,123.1,21,2,0)
indicates that this service may NOT be selectable for ordering.  Services
"^DD",101.43,101.43,123.1,21,3,0)
with a 1 are used for grouping purposes only, and a 2 indicates that
"^DD",101.43,101.43,123.1,21,4,0)
only service personnel may order or forward consults to this service.
"^DD",101.43,101.43,123.1,"DT")
2971023
"^DD",101.43,101.43,6001,0)
BLOOD COMPONENT^S^1:YES;0:NO;^VB;1^Q
"^DD",101.43,101.43,6001,1,0)
^.1
"^DD",101.43,101.43,6001,1,1,0)
101.43^S10^MUMPS
"^DD",101.43,101.43,6001,1,1,1)
D:X SET^ORDD43("VBC",DA)
"^DD",101.43,101.43,6001,1,1,2)
D:X KILL^ORDD43("VBC",DA)
"^DD",101.43,101.43,6001,1,1,"%D",0)
^^1^1^3031125^
"^DD",101.43,101.43,6001,1,1,"%D",1,0)
Creates an entry in SET multiple.
"^DD",101.43,101.43,6001,1,1,"DT")
3031125
"^DD",101.43,101.43,6001,3)
Enter YES if this orderable item is a blood component.
"^DD",101.43,101.43,6001,"DT")
3031125
"^DD",101.43,101.43,6002,0)
DIAGNOSTIC TEST^S^0:NO;1:YES;2:TAS;^VB;2^Q
"^DD",101.43,101.43,6002,1,0)
^.1
"^DD",101.43,101.43,6002,1,1,0)
101.43^S11^MUMPS
"^DD",101.43,101.43,6002,1,1,1)
D:X SET^ORDD43("VBT",DA)
"^DD",101.43,101.43,6002,1,1,2)
D:X KILL^ORDD43("VBT",DA)
"^DD",101.43,101.43,6002,1,1,"%D",0)
^^1^1^3031125^
"^DD",101.43,101.43,6002,1,1,"%D",1,0)
Creates an entry in SET multiple.
"^DD",101.43,101.43,6002,1,1,"DT")
3031125
"^DD",101.43,101.43,6002,3)
Enter YES if this item is a diagnostic test, TAS if the test is a Type & Screen.
"^DD",101.43,101.43,6002,"DT")
3031125
"^DD",101.43,101.431,0)
COMPONENTS SUB-FIELD^^4^4
"^DD",101.43,101.431,0,"DT")
2960411
"^DD",101.43,101.431,0,"IX","AID",101.431,2)

"^DD",101.43,101.431,0,"IX","B",101.431,.01)

"^DD",101.43,101.431,0,"NM","COMPONENTS")

"^DD",101.43,101.431,0,"UP")
101.43
"^DD",101.43,101.431,.01,0)
NAME^MF^^0;1^K:$L(X)>60!($L(X)<1) X
"^DD",101.43,101.431,.01,1,0)
^.1
"^DD",101.43,101.431,.01,1,1,0)
101.431^B
"^DD",101.43,101.431,.01,1,1,1)
S ^ORD(101.43,DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",101.43,101.431,.01,1,1,2)
K ^ORD(101.43,DA(1),10,"B",$E(X,1,30),DA)
"^DD",101.43,101.431,.01,3)
Answer must be 1-60 characters in length.
"^DD",101.43,101.431,.01,21,0)
^^1^1^2960411^
"^DD",101.43,101.431,.01,21,1,0)
This is the name of a component of this orderable item.
"^DD",101.43,101.431,.01,"DT")
2960411
"^DD",101.43,101.431,2,0)
ID^F^^0;2^K:$L(X)>20!($L(X)<1) X
"^DD",101.43,101.431,2,1,0)
^.1
"^DD",101.43,101.431,2,1,1,0)
101.431^AID
"^DD",101.43,101.431,2,1,1,1)
S ^ORD(101.43,DA(1),10,"AID",$E(X,1,30),DA)=""
"^DD",101.43,101.431,2,1,1,2)
K ^ORD(101.43,DA(1),10,"AID",$E(X,1,30),DA)
"^DD",101.43,101.431,2,1,1,"DT")
2960411
"^DD",101.43,101.431,2,3)
Answer must be 1-20 characters in length.
"^DD",101.43,101.431,2,21,0)
^^4^4^2960411^
"^DD",101.43,101.431,2,21,1,0)
This is an identifier for this component, created from the 6-piece coded
"^DD",101.43,101.431,2,21,2,0)
format passed in the Orderable Items update message from each package.
"^DD",101.43,101.431,2,21,3,0)
It should be stored in the form of "package code;99XXX" where XXX 
"^DD",101.43,101.431,2,21,4,0)
indicates the package table originating this item (i.e. RAP, LRT, etc.).
"^DD",101.43,101.431,2,"DT")
2960411
"^DD",101.43,101.431,3,0)
CODE^F^^0;3^K:$L(X)>10!($L(X)<1) X
"^DD",101.43,101.431,3,3)
Answer must be 1-10 characters in length.
"^DD",101.43,101.431,3,21,0)
^^2^2^2960411^
"^DD",101.43,101.431,3,21,1,0)
This is the code assigned to this item by the authoritative package from a
"^DD",101.43,101.431,3,21,2,0)
national standard coding system such as CPT or SNOMED.
"^DD",101.43,101.431,3,"DT")
2960411
"^DD",101.43,101.431,4,0)
CODING SYSTEM^S^NDF:NATIONAL DRUG FILE;CPT4:CPT4;NLT:NATIONAL LAB TEST FILE;^0;4^Q
"^DD",101.43,101.431,4,3)
Enter the coding system in which this item has been coded.
"^DD",101.43,101.431,4,21,0)
^^1^1^2960411^
"^DD",101.43,101.431,4,21,1,0)
This is the system used to generate the code assigned in field 3.
"^DD",101.43,101.431,4,"DT")
2960411
"^DD",101.43,101.432,0)
SYNONYMS SUB-FIELD^^.01^1
"^DD",101.43,101.432,0,"DT")
2950303
"^DD",101.43,101.432,0,"IX","B",101.432,.01)

"^DD",101.43,101.432,0,"NM","SYNONYMS")

"^DD",101.43,101.432,0,"UP")
101.43
"^DD",101.43,101.432,.01,0)
SYNONYM^MF^^0;1^K:$L(X)>63!($L(X)<1) X
"^DD",101.43,101.432,.01,1,0)
^.1
"^DD",101.43,101.432,.01,1,1,0)
101.432^B
"^DD",101.43,101.432,.01,1,1,1)
S ^ORD(101.43,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",101.43,101.432,.01,1,1,2)
K ^ORD(101.43,DA(1),2,"B",$E(X,1,30),DA)
"^DD",101.43,101.432,.01,1,2,0)
101.43^B^MNEMONIC
"^DD",101.43,101.432,.01,1,2,1)
S:'$D(^ORD(101.43,"B",$E(X,1,30),DA(1),DA)) ^(DA)=1
"^DD",101.43,101.432,.01,1,2,2)
I $D(^ORD(101.43,"B",$E(X,1,30),DA(1),DA)),^(DA) K ^(DA)
"^DD",101.43,101.432,.01,1,2,"DT")
2950303
"^DD",101.43,101.432,.01,1,3,0)
101.43^SS^MUMPS
"^DD",101.43,101.432,.01,1,3,1)
D SS3^ORDD43
"^DD",101.43,101.432,.01,1,3,2)
D SK3^ORDD43
"^DD",101.43,101.432,.01,1,3,"%D",0)
^^2^2^2990316^^^^
"^DD",101.43,101.432,.01,1,3,"%D",1,0)
Allows retrieval of items by synonym via the Set "S" xrefs:
"^DD",101.43,101.432,.01,1,3,"%D",2,0)
^ORD(101.43,"S.<set>",SYNONYM,DA)
"^DD",101.43,101.432,.01,1,3,"DT")
2950810
"^DD",101.43,101.432,.01,3)
Answer must be 1-63 characters in length.
"^DD",101.43,101.432,.01,21,0)
^^1^1^2990223^^
"^DD",101.43,101.432,.01,21,1,0)
This is a synonym for this orderable item.
"^DD",101.43,101.432,.01,"DT")
2990223
"^DD",101.43,101.438,0)
ORDER MESSAGE SUB-FIELD^^.01^1
"^DD",101.43,101.438,0,"DT")
2941205
"^DD",101.43,101.438,0,"NM","ORDER MESSAGE")

"^DD",101.43,101.438,0,"UP")
101.43
"^DD",101.43,101.438,.01,0)
ORDER MESSAGE^WL^^0;1^Q
"^DD",101.43,101.438,.01,3)
Enter a message to be displayed whenever this item is ordered.
"^DD",101.43,101.438,.01,21,0)
^.001^2^2^3040407^^^^
"^DD",101.43,101.438,.01,21,1,0)
This field contains text that is to be displayed to the user whenever
"^DD",101.43,101.438,.01,21,2,0)
this item is selected to be ordered.
"^DD",101.43,101.438,.01,"DT")
2941205
"^DD",101.43,101.439,0)
SET MEMBERSHIP SUB-FIELD^^2^2
"^DD",101.43,101.439,0,"DT")
2941117
"^DD",101.43,101.439,0,"IX","B",101.439,.01)

"^DD",101.43,101.439,0,"NM","SET MEMBERSHIP")

"^DD",101.43,101.439,0,"UP")
101.43
"^DD",101.43,101.439,.01,0)
SET^MF^^0;1^K:$L(X)>8!($L(X)<2) X
"^DD",101.43,101.439,.01,1,0)
^.1
"^DD",101.43,101.439,.01,1,1,0)
101.439^B
"^DD",101.43,101.439,.01,1,1,1)
S ^ORD(101.43,DA(1),9,"B",$E(X,1,30),DA)=""
"^DD",101.43,101.439,.01,1,1,2)
K ^ORD(101.43,DA(1),9,"B",$E(X,1,30),DA)
"^DD",101.43,101.439,.01,1,2,0)
101.43^S^MUMPS
"^DD",101.43,101.439,.01,1,2,1)
Q:$P($G(^ORD(101.43,DA(1),"LR")),U,7)="O"  N NM,IN S NM=$P(^(0),U),IN=$G(^(.1)) S:$L(NM) ^ORD(101.43,"S."_X,$$UP^XLFSTR(NM),DA(1))=U_NM_U_IN
"^DD",101.43,101.439,.01,1,2,2)
N NM S NM=$P(^ORD(101.43,DA(1),0),U) K:$L(NM) ^ORD(101.43,"S."_X,$$UP^XLFSTR(NM),DA(1))
"^DD",101.43,101.439,.01,1,2,"%D",0)
^^1^1^2960806^^^^
"^DD",101.43,101.439,.01,1,2,"%D",1,0)
Allows retrieval of orderable items by set.
"^DD",101.43,101.439,.01,1,2,"DT")
2960806
"^DD",101.43,101.439,.01,1,3,0)
101.43^SS1^MUMPS
"^DD",101.43,101.439,.01,1,3,1)
D SS2^ORDD43
"^DD",101.43,101.439,.01,1,3,2)
D SK2^ORDD43
"^DD",101.43,101.439,.01,1,3,"%D",0)
^^1^1^2960806^^^^
"^DD",101.43,101.439,.01,1,3,"%D",1,0)
Allows retrieval of items by synonym via the Set "S" xrefs.
"^DD",101.43,101.439,.01,1,3,"DT")
2960806
"^DD",101.43,101.439,.01,1,4,0)
101.43^C1^MUMPS
"^DD",101.43,101.439,.01,1,4,1)
N CD,NM,IN S NM=$P(^ORD(101.43,DA(1),0),U),CD=$P(^(0),U,3),IN=$G(^(.1)) S:$L(CD) ^ORD(101.43,"C."_X,$$UP^XLFSTR(CD_" "_NM),DA(1))=U_(CD_" "_NM)_U_IN
"^DD",101.43,101.439,.01,1,4,2)
N CD,NM S NM=$P(^ORD(101.43,DA(1),0),U),CD=$P(^(0),U,3) K:$L(CD) ^ORD(101.43,"C."_X,$$UP^XLFSTR(CD_" "_NM),DA(1))
"^DD",101.43,101.439,.01,1,4,"%D",0)
^^1^1^2960806^^^^
"^DD",101.43,101.439,.01,1,4,"%D",1,0)
Allows retrieval of items by code within Sets.
"^DD",101.43,101.439,.01,1,4,"DT")
2950713
"^DD",101.43,101.439,.01,3)
Answer must be 2-8 characters in length.
"^DD",101.43,101.439,.01,21,0)
^^1^1^2941117^^^^
"^DD",101.43,101.439,.01,21,1,0)
This is the name of a set to which this orderable item belongs.
"^DD",101.43,101.439,.01,"DT")
2960806
"^DD",101.43,101.439,2,0)
QO ONLY^S^1:YES;^0;2^Q
"^DD",101.43,101.439,2,1,0)
^.1
"^DD",101.43,101.439,2,1,1,0)
101.43^AQO^MUMPS
"^DD",101.43,101.439,2,1,1,1)
D QO^ORDD43(X)
"^DD",101.43,101.439,2,1,1,2)
D QO^ORDD43("")
"^DD",101.43,101.439,2,1,1,"%D",0)
^^3^3^3021106^
"^DD",101.43,101.439,2,1,1,"%D",1,0)
This index adds data to the 5th piece of the "S.xxx" xrefs to tell CPRS
"^DD",101.43,101.439,2,1,1,"%D",2,0)
GUI whether or not to allow this item to be selectable in the regular
"^DD",101.43,101.439,2,1,1,"%D",3,0)
order dialog for the set, or if it should be orderable via quick orders.
"^DD",101.43,101.439,2,1,1,"DT")
3021106
"^DD",101.43,101.439,2,3)
Enter YES if this item should only be orderable via quick orders.
"^DD",101.43,101.439,2,21,0)
^^2^2^3021106^
"^DD",101.43,101.439,2,21,1,0)
This field determines if the item may be ordered via the regular order
"^DD",101.43,101.439,2,21,2,0)
dialog for this Set, or only via predefined quick orders.
"^DD",101.43,101.439,2,"DT")
3021106
"^DIC",100.21,100.21,0)
OE/RR LIST^100.21
"^DIC",100.21,100.21,0,"GL")
^OR(100.21,
"^DIC",100.21,100.21,"%D",0)
^^2^2^2990818^^^
"^DIC",100.21,100.21,"%D",1,0)
This file contains data related to lists.  Generally these lists take the
"^DIC",100.21,100.21,"%D",2,0)
form of provider(s)/patients.
"^DIC",100.21,"B","OE/RR LIST",100.21)

"^DIC",101.24,101.24,0)
OE/RR REPORT^101.24
"^DIC",101.24,101.24,0,"GL")
^ORD(101.24,
"^DIC",101.24,101.24,"%",0)
^1.005^^0
"^DIC",101.24,101.24,"%D",0)
^1.001^7^7^3020924^^^
"^DIC",101.24,101.24,"%D",1,0)
This file contains definitions and parameters used in various reports
"^DIC",101.24,101.24,"%D",2,0)
within CPRS.
"^DIC",101.24,101.24,"%D",3,0)
 
"^DIC",101.24,101.24,"%D",4,0)
Entry numbers >1000 are reserved for national use.  Any local entries
"^DIC",101.24,101.24,"%D",5,0)
should be added to a number <1000.  If this convention is not followed,
"^DIC",101.24,101.24,"%D",6,0)
you run the risk of having your local entries overwritten by a patch
"^DIC",101.24,101.24,"%D",7,0)
or future release of CPRS.
"^DIC",101.24,"B","OE/RR REPORT",101.24)

"^DIC",101.41,101.41,0)
ORDER DIALOG^101.41
"^DIC",101.41,101.41,0,"GL")
^ORD(101.41,
"^DIC",101.41,101.41,"%D",0)
^^2^2^2960819^^
"^DIC",101.41,101.41,"%D",1,0)
This file contains the information needed to define how to prompt for each
"^DIC",101.41,101.41,"%D",2,0)
order, what values are acceptable, etc.
"^DIC",101.41,"B","ORDER DIALOG",101.41)

"^DIC",101.43,101.43,0)
ORDERABLE ITEMS^101.43
"^DIC",101.43,101.43,0,"GL")
^ORD(101.43,
"^DIC",101.43,101.43,"%D",0)
^^1^1^2941116^^^^
"^DIC",101.43,101.43,"%D",1,0)
This file contains the orderable items for use within OE/RR.
"^DIC",101.43,"B","ORDERABLE ITEMS",101.43)

**END**
**END**
