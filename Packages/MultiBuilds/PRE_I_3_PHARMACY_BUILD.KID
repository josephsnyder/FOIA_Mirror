KIDS Distribution saved on Jan 13, 2011@10:17:37
PRE COMBINED BUILD v31 01/13/11
**KIDS**:PRE_I_3_PHARMACY_BUILD 1.0^PSO*7.0*251^PSJ*5.0*181^OR*3.0*272^

**INSTALL NAME**
PRE_I_3_PHARMACY_BUILD 1.0
"BLD",7709,0)
PRE_I_3_PHARMACY_BUILD 1.0^^1^3110113^y
"BLD",7709,6.3)
19
"BLD",7709,10,0)
^9.63^3^3
"BLD",7709,10,1,0)
PSO*7.0*251^1
"BLD",7709,10,2,0)
PSJ*5.0*181^1
"BLD",7709,10,3,0)
OR*3.0*272^1
"BLD",7709,10,"B","OR*3.0*272",3)

"BLD",7709,10,"B","PSJ*5.0*181",2)

"BLD",7709,10,"B","PSO*7.0*251",1)

"MBREQ")
0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"VER")
8.0^22.0
**INSTALL NAME**
PSO*7.0*251
"BLD",7305,0)
PSO*7.0*251^OUTPATIENT PHARMACY^0^3110113^y
"BLD",7305,1,0)
^^33^33^3110103^
"BLD",7305,1,1,0)
This patch is part of a combined build, made up of the following three 
"BLD",7305,1,2,0)
patches:
"BLD",7305,1,3,0)
       OR*3.0*272           (Computerized Patient Record System)
"BLD",7305,1,4,0)
       PSJ*5.0*181           (Inpatient Medications)
"BLD",7305,1,5,0)
       PSO*7.0*251          (Outpatient Pharmacy)
"BLD",7305,1,6,0)
 
"BLD",7305,1,7,0)
These patches will replace most of current VistA medication order 
"BLD",7305,1,8,0)
checking system with version 1.0 of the new Medication Order Check 
"BLD",7305,1,9,0)
Healthcare Application (MOCHA) system that uses the First DataBank (FDB) 
"BLD",7305,1,10,0)
Drug Information Framework (DIF) interfaces and database. The VistA Drug 
"BLD",7305,1,11,0)
Interaction module will be replaced by the FDB Drug-Drug Interaction 
"BLD",7305,1,12,0)
Module (DDIM). The VistA Duplicate Class module will be replaced by the 
"BLD",7305,1,13,0)
FDB Enhanced Therapeutic Classification (ETC) System.
"BLD",7305,1,14,0)
 
"BLD",7305,1,15,0)
In addition, the following three order checks that use VistA data have
"BLD",7305,1,16,0)
been added to Inpatient Medications and Outpatient Pharmacy. These checks
"BLD",7305,1,17,0)
currently occur in Computerized Patient Record System (CPRS), but will be
"BLD",7305,1,18,0)
new to Pharmacy with the installation of these patches:
"BLD",7305,1,19,0)
     Aminoglycoside Ordered
"BLD",7305,1,20,0)
     Dangerous Meds for Patients > 64
"BLD",7305,1,21,0)
     Glucophage - Lab Results
"BLD",7305,1,22,0)
 
"BLD",7305,1,23,0)
A new Graphical User Interface (GUI) module is also being introduced 
"BLD",7305,1,24,0)
called Pharmacy Enterprise Customization System (PECS), to be used only 
"BLD",7305,1,25,0)
by members of Pharmacy Benefits Management (PBM). It will allow PBM to 
"BLD",7305,1,26,0)
customize the data provided by FDB for use in VistA.
"BLD",7305,1,27,0)
 
"BLD",7305,1,28,0)
The following three patient safety issues have also been addressed in 
"BLD",7305,1,29,0)
these patches:
"BLD",7305,1,30,0)
       Order Checks on PreMix IV Solutions (PSI-06-012)
"BLD",7305,1,31,0)
       Order Check display sequence changes (PSI-07-080)
"BLD",7305,1,32,0)
       Eliminating confusion in Inpatient Medications Order Check display 
"BLD",7305,1,33,0)
       and processing (PSI-07-080)
"BLD",7305,4,0)
^9.64PA^52.4^3
"BLD",7305,4,52,0)
52
"BLD",7305,4,52,2,0)
^9.641^52^1
"BLD",7305,4,52,2,52,0)
PRESCRIPTION  (File-top level)
"BLD",7305,4,52,2,52,1,0)
^9.6411^100.1^1
"BLD",7305,4,52,2,52,1,100.1,0)
DISCONTINUE TYPE
"BLD",7305,4,52,222)
y^y^p^^^^n^^n
"BLD",7305,4,52,224)

"BLD",7305,4,52.4,0)
52.4
"BLD",7305,4,52.4,2,0)
^9.641^52.4^1
"BLD",7305,4,52.4,2,52.4,0)
RX VERIFY  (File-top level)
"BLD",7305,4,52.4,2,52.4,1,0)
^9.6411^8^1
"BLD",7305,4,52.4,2,52.4,1,8,0)
DOSE WARNING
"BLD",7305,4,52.4,222)
y^y^p^^^^n^^n
"BLD",7305,4,52.4,224)

"BLD",7305,4,59,0)
59
"BLD",7305,4,59,2,0)
^9.641^59^1
"BLD",7305,4,59,2,59,0)
OUTPATIENT SITE  (File-top level)
"BLD",7305,4,59,2,59,1,0)
^9.6411^3.2^1
"BLD",7305,4,59,2,59,1,3.2,0)
RECENTLY DC'D/EXPIRED DAYS
"BLD",7305,4,59,222)
y^y^p^^^^n^^n
"BLD",7305,4,59,224)

"BLD",7305,4,"APDD",52,52)

"BLD",7305,4,"APDD",52,52,100.1)

"BLD",7305,4,"APDD",52.4,52.4)

"BLD",7305,4,"APDD",52.4,52.4,8)

"BLD",7305,4,"APDD",59,59)

"BLD",7305,4,"APDD",59,59,3.2)

"BLD",7305,4,"B",52,52)

"BLD",7305,4,"B",52.4,52.4)

"BLD",7305,4,"B",59,59)

"BLD",7305,6.3)
202
"BLD",7305,"ABPKG")
n
"BLD",7305,"INID")
^n
"BLD",7305,"INIT")
PSO251PO
"BLD",7305,"KRN",0)
^9.67PA^8989.52^19
"BLD",7305,"KRN",.4,0)
.4
"BLD",7305,"KRN",.4,"NM",0)
^9.68A^^
"BLD",7305,"KRN",.401,0)
.401
"BLD",7305,"KRN",.401,"NM",0)
^9.68A^^
"BLD",7305,"KRN",.402,0)
.402
"BLD",7305,"KRN",.403,0)
.403
"BLD",7305,"KRN",.5,0)
.5
"BLD",7305,"KRN",.84,0)
.84
"BLD",7305,"KRN",3.6,0)
3.6
"BLD",7305,"KRN",3.8,0)
3.8
"BLD",7305,"KRN",9.2,0)
9.2
"BLD",7305,"KRN",9.8,0)
9.8
"BLD",7305,"KRN",9.8,"NM",0)
^9.68A^84^67
"BLD",7305,"KRN",9.8,"NM",1,0)
PSOORUT1^^0^B78073421
"BLD",7305,"KRN",9.8,"NM",2,0)
PSOLMAO^^0^B1822420
"BLD",7305,"KRN",9.8,"NM",3,0)
PSOAUTOC^^0^B66695978
"BLD",7305,"KRN",9.8,"NM",4,0)
PSOCAN2^^0^B76842420
"BLD",7305,"KRN",9.8,"NM",5,0)
PSOCAN3^^0^B71472770
"BLD",7305,"KRN",9.8,"NM",6,0)
PSOHLNEW^^0^B83284791
"BLD",7305,"KRN",9.8,"NM",7,0)
PSOCPPRE^^0^B10424566
"BLD",7305,"KRN",9.8,"NM",8,0)
PSODDPR1^^0^B53867555
"BLD",7305,"KRN",9.8,"NM",9,0)
PSODDPR2^^0^B152050761
"BLD",7305,"KRN",9.8,"NM",10,0)
PSODDPR3^^0^B158305951
"BLD",7305,"KRN",9.8,"NM",11,0)
PSODDPRE^^0^B115217514
"BLD",7305,"KRN",9.8,"NM",12,0)
PSODGDGP^^0^B48532465
"BLD",7305,"KRN",9.8,"NM",18,0)
PSODDPR4^^0^B78835687
"BLD",7305,"KRN",9.8,"NM",19,0)
PSODDPR5^^0^B70994765
"BLD",7305,"KRN",9.8,"NM",20,0)
PSODRDU2^^0^B21988780
"BLD",7305,"KRN",9.8,"NM",21,0)
PSODELI^^0^B7741003
"BLD",7305,"KRN",9.8,"NM",22,0)
PSODGAL1^^0^B18486423
"BLD",7305,"KRN",9.8,"NM",23,0)
PSOVER1^^0^B108309187
"BLD",7305,"KRN",9.8,"NM",24,0)
PSOORED6^^0^B68912143
"BLD",7305,"KRN",9.8,"NM",25,0)
PSONEW2^^0^B41668970
"BLD",7305,"KRN",9.8,"NM",26,0)
PSOORROC^^0^B54619210
"BLD",7305,"KRN",9.8,"NM",27,0)
PSODRG^^0^B61621761
"BLD",7305,"KRN",9.8,"NM",28,0)
PSOORED5^^0^B59866468
"BLD",7305,"KRN",9.8,"NM",29,0)
PSOORNEW^^0^B74656936
"BLD",7305,"KRN",9.8,"NM",32,0)
PSOORNE1^^0^B73585771
"BLD",7305,"KRN",9.8,"NM",33,0)
PSORENW0^^0^B84117072
"BLD",7305,"KRN",9.8,"NM",36,0)
PSORXI^^0^B15085329
"BLD",7305,"KRN",9.8,"NM",37,0)
PSORX1^^0^B66023082
"BLD",7305,"KRN",9.8,"NM",38,0)
PSODOSUT^^0^B107545070
"BLD",7305,"KRN",9.8,"NM",39,0)
PSODOSCL^^0^B27277557
"BLD",7305,"KRN",9.8,"NM",40,0)
PSOP1^^0^B26371231
"BLD",7305,"KRN",9.8,"NM",41,0)
PSODSPL^^0^B20367519
"BLD",7305,"KRN",9.8,"NM",42,0)
PSOFUNC^^0^B6752191
"BLD",7305,"KRN",9.8,"NM",43,0)
PSON52^^0^B70712029
"BLD",7305,"KRN",9.8,"NM",45,0)
PSOORRD2^^0^B24528466
"BLD",7305,"KRN",9.8,"NM",46,0)
PSOVER^^0^B81926399
"BLD",7305,"KRN",9.8,"NM",47,0)
PSOORRDI^^0^B49421616
"BLD",7305,"KRN",9.8,"NM",48,0)
PSO251PO^^0^B7870474
"BLD",7305,"KRN",9.8,"NM",49,0)
PSOORNE2^^0^B68912310
"BLD",7305,"KRN",9.8,"NM",50,0)
PSOORNW1^^0^B44316879
"BLD",7305,"KRN",9.8,"NM",51,0)
PSODOSUN^^0^B34559589
"BLD",7305,"KRN",9.8,"NM",52,0)
PSONEW^^0^B28582823
"BLD",7305,"KRN",9.8,"NM",53,0)
PSODGDG1^^0^B41300360
"BLD",7305,"KRN",9.8,"NM",54,0)
PSODGDG2^^0^B14020404
"BLD",7305,"KRN",9.8,"NM",55,0)
PSORN52^^0^B50777957
"BLD",7305,"KRN",9.8,"NM",56,0)
PSORN52C^^0^B50060838
"BLD",7305,"KRN",9.8,"NM",57,0)
PSORXRP2^^0^B33732214
"BLD",7305,"KRN",9.8,"NM",58,0)
PSORXPR^^0^B29984044
"BLD",7305,"KRN",9.8,"NM",59,0)
PSOCAN^^0^B49079548
"BLD",7305,"KRN",9.8,"NM",60,0)
PSOVER2^^0^B13436802
"BLD",7305,"KRN",9.8,"NM",61,0)
PSOVRPT^^0^B19926932
"BLD",7305,"KRN",9.8,"NM",62,0)
PSOLLL8^^0^B27800299
"BLD",7305,"KRN",9.8,"NM",63,0)
PSOLLLI^^0^B67875911
"BLD",7305,"KRN",9.8,"NM",67,0)
PSOBUILD^^0^B42733386
"BLD",7305,"KRN",9.8,"NM",68,0)
PSOORFI4^^0^B81645508
"BLD",7305,"KRN",9.8,"NM",69,0)
PSOORED3^^0^B61521458
"BLD",7305,"KRN",9.8,"NM",70,0)
PSOORNW2^^0^B45717814
"BLD",7305,"KRN",9.8,"NM",71,0)
PSORXL^^0^B74408988
"BLD",7305,"KRN",9.8,"NM",72,0)
PSOORED2^^0^B74670919
"BLD",7305,"KRN",9.8,"NM",73,0)
PSOORED4^^0^B52076927
"BLD",7305,"KRN",9.8,"NM",76,0)
PSORXL1^^0^B52372204
"BLD",7305,"KRN",9.8,"NM",77,0)
PSOCMOP^^0^B39239270
"BLD",7305,"KRN",9.8,"NM",78,0)
PSOORDRG^^0^B43185005
"BLD",7305,"KRN",9.8,"NM",81,0)
PSODOSU2^^0^B79224153
"BLD",7305,"KRN",9.8,"NM",82,0)
PSOLBL^^0^B65338340
"BLD",7305,"KRN",9.8,"NM",83,0)
PSOLBLN^^0^B58195867
"BLD",7305,"KRN",9.8,"NM",84,0)
PSOLBLD^^0^B32921586
"BLD",7305,"KRN",9.8,"NM","B","PSO251PO",48)

"BLD",7305,"KRN",9.8,"NM","B","PSOAUTOC",3)

"BLD",7305,"KRN",9.8,"NM","B","PSOBUILD",67)

"BLD",7305,"KRN",9.8,"NM","B","PSOCAN",59)

"BLD",7305,"KRN",9.8,"NM","B","PSOCAN2",4)

"BLD",7305,"KRN",9.8,"NM","B","PSOCAN3",5)

"BLD",7305,"KRN",9.8,"NM","B","PSOCMOP",77)

"BLD",7305,"KRN",9.8,"NM","B","PSOCPPRE",7)

"BLD",7305,"KRN",9.8,"NM","B","PSODDPR1",8)

"BLD",7305,"KRN",9.8,"NM","B","PSODDPR2",9)

"BLD",7305,"KRN",9.8,"NM","B","PSODDPR3",10)

"BLD",7305,"KRN",9.8,"NM","B","PSODDPR4",18)

"BLD",7305,"KRN",9.8,"NM","B","PSODDPR5",19)

"BLD",7305,"KRN",9.8,"NM","B","PSODDPRE",11)

"BLD",7305,"KRN",9.8,"NM","B","PSODELI",21)

"BLD",7305,"KRN",9.8,"NM","B","PSODGAL1",22)

"BLD",7305,"KRN",9.8,"NM","B","PSODGDG1",53)

"BLD",7305,"KRN",9.8,"NM","B","PSODGDG2",54)

"BLD",7305,"KRN",9.8,"NM","B","PSODGDGP",12)

"BLD",7305,"KRN",9.8,"NM","B","PSODOSCL",39)

"BLD",7305,"KRN",9.8,"NM","B","PSODOSU2",81)

"BLD",7305,"KRN",9.8,"NM","B","PSODOSUN",51)

"BLD",7305,"KRN",9.8,"NM","B","PSODOSUT",38)

"BLD",7305,"KRN",9.8,"NM","B","PSODRDU2",20)

"BLD",7305,"KRN",9.8,"NM","B","PSODRG",27)

"BLD",7305,"KRN",9.8,"NM","B","PSODSPL",41)

"BLD",7305,"KRN",9.8,"NM","B","PSOFUNC",42)

"BLD",7305,"KRN",9.8,"NM","B","PSOHLNEW",6)

"BLD",7305,"KRN",9.8,"NM","B","PSOLBL",82)

"BLD",7305,"KRN",9.8,"NM","B","PSOLBLD",84)

"BLD",7305,"KRN",9.8,"NM","B","PSOLBLN",83)

"BLD",7305,"KRN",9.8,"NM","B","PSOLLL8",62)

"BLD",7305,"KRN",9.8,"NM","B","PSOLLLI",63)

"BLD",7305,"KRN",9.8,"NM","B","PSOLMAO",2)

"BLD",7305,"KRN",9.8,"NM","B","PSON52",43)

"BLD",7305,"KRN",9.8,"NM","B","PSONEW",52)

"BLD",7305,"KRN",9.8,"NM","B","PSONEW2",25)

"BLD",7305,"KRN",9.8,"NM","B","PSOORDRG",78)

"BLD",7305,"KRN",9.8,"NM","B","PSOORED2",72)

"BLD",7305,"KRN",9.8,"NM","B","PSOORED3",69)

"BLD",7305,"KRN",9.8,"NM","B","PSOORED4",73)

"BLD",7305,"KRN",9.8,"NM","B","PSOORED5",28)

"BLD",7305,"KRN",9.8,"NM","B","PSOORED6",24)

"BLD",7305,"KRN",9.8,"NM","B","PSOORFI4",68)

"BLD",7305,"KRN",9.8,"NM","B","PSOORNE1",32)

"BLD",7305,"KRN",9.8,"NM","B","PSOORNE2",49)

"BLD",7305,"KRN",9.8,"NM","B","PSOORNEW",29)

"BLD",7305,"KRN",9.8,"NM","B","PSOORNW1",50)

"BLD",7305,"KRN",9.8,"NM","B","PSOORNW2",70)

"BLD",7305,"KRN",9.8,"NM","B","PSOORRD2",45)

"BLD",7305,"KRN",9.8,"NM","B","PSOORRDI",47)

"BLD",7305,"KRN",9.8,"NM","B","PSOORROC",26)

"BLD",7305,"KRN",9.8,"NM","B","PSOORUT1",1)

"BLD",7305,"KRN",9.8,"NM","B","PSOP1",40)

"BLD",7305,"KRN",9.8,"NM","B","PSORENW0",33)

"BLD",7305,"KRN",9.8,"NM","B","PSORN52",55)

"BLD",7305,"KRN",9.8,"NM","B","PSORN52C",56)

"BLD",7305,"KRN",9.8,"NM","B","PSORX1",37)

"BLD",7305,"KRN",9.8,"NM","B","PSORXI",36)

"BLD",7305,"KRN",9.8,"NM","B","PSORXL",71)

"BLD",7305,"KRN",9.8,"NM","B","PSORXL1",76)

"BLD",7305,"KRN",9.8,"NM","B","PSORXPR",58)

"BLD",7305,"KRN",9.8,"NM","B","PSORXRP2",57)

"BLD",7305,"KRN",9.8,"NM","B","PSOVER",46)

"BLD",7305,"KRN",9.8,"NM","B","PSOVER1",23)

"BLD",7305,"KRN",9.8,"NM","B","PSOVER2",60)

"BLD",7305,"KRN",9.8,"NM","B","PSOVRPT",61)

"BLD",7305,"KRN",19,0)
19
"BLD",7305,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",7305,"KRN",19,"NM",1,0)
PSO INTERACTION VERIFY^^1^
"BLD",7305,"KRN",19,"NM",2,0)
PSO ORDER CHECKS VERIFY^^0
"BLD",7305,"KRN",19,"NM","B","PSO INTERACTION VERIFY",1)

"BLD",7305,"KRN",19,"NM","B","PSO ORDER CHECKS VERIFY",2)

"BLD",7305,"KRN",19.1,0)
19.1
"BLD",7305,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",7305,"KRN",101,0)
101
"BLD",7305,"KRN",101,"NM",0)
^9.68A^53^52
"BLD",7305,"KRN",101,"NM",1,0)
PSO HIDDEN ACTIONS #2^^2
"BLD",7305,"KRN",101,"NM",2,0)
PSO LM ACTION PROFILE^^0
"BLD",7305,"KRN",101,"NM",3,0)
PSO LM BACKDOOR SELECT ORDER^^0
"BLD",7305,"KRN",101,"NM",4,0)
PSO LM DISPLAY ORDER STATUS^^0
"BLD",7305,"KRN",101,"NM",5,0)
PSO LM HIDDEN OTHER^^0
"BLD",7305,"KRN",101,"NM",6,0)
PSO LM INPATIENT MEDICATION PROFILE^^0
"BLD",7305,"KRN",101,"NM",7,0)
PSO LM MEDICATION PROFILE^^0
"BLD",7305,"KRN",101,"NM",8,0)
PSO LM MULTI-RX PRINT^^0
"BLD",7305,"KRN",101,"NM",9,0)
PSO LM NON-VA MEDS RPT^^0
"BLD",7305,"KRN",101,"NM",10,0)
PSO LM PRINT MED INFO^^0
"BLD",7305,"KRN",101,"NM",11,0)
PSO NEW ORDER^^0
"BLD",7305,"KRN",101,"NM",12,0)
PSO PATIENT INFORMATION^^0
"BLD",7305,"KRN",101,"NM",13,0)
PSO PATIENT RECORD UPDATE^^0
"BLD",7305,"KRN",101,"NM",15,0)
PSO SPEED CANCEL^^0
"BLD",7305,"KRN",101,"NM",16,0)
PSO SPEED PULL SUSPENSE^^0
"BLD",7305,"KRN",101,"NM",17,0)
PSO SPEED REFILL^^0
"BLD",7305,"KRN",101,"NM",18,0)
PSO SPEED RELEASE^^0
"BLD",7305,"KRN",101,"NM",19,0)
PSO SPEED RENEW^^0
"BLD",7305,"KRN",101,"NM",20,0)
PSO SPEED REPRINT^^0
"BLD",7305,"KRN",101,"NM",21,0)
VALM DOWN A LINE^^0
"BLD",7305,"KRN",101,"NM",22,0)
VALM FIRST SCREEN^^0
"BLD",7305,"KRN",101,"NM",23,0)
VALM GOTO PAGE^^0
"BLD",7305,"KRN",101,"NM",24,0)
VALM LAST SCREEN^^0
"BLD",7305,"KRN",101,"NM",25,0)
VALM LEFT^^0
"BLD",7305,"KRN",101,"NM",26,0)
VALM NEXT SCREEN^^0
"BLD",7305,"KRN",101,"NM",27,0)
VALM PREVIOUS SCREEN^^0
"BLD",7305,"KRN",101,"NM",28,0)
VALM PRINT LIST^^0
"BLD",7305,"KRN",101,"NM",29,0)
VALM PRINT SCREEN^^0
"BLD",7305,"KRN",101,"NM",30,0)
VALM QUIT^^0
"BLD",7305,"KRN",101,"NM",31,0)
VALM REFRESH^^0
"BLD",7305,"KRN",101,"NM",32,0)
VALM RIGHT^^0
"BLD",7305,"KRN",101,"NM",33,0)
VALM SEARCH LIST^^0
"BLD",7305,"KRN",101,"NM",34,0)
VALM TURN ON/OFF MENUS^^0
"BLD",7305,"KRN",101,"NM",35,0)
VALM UP ONE LINE^^0
"BLD",7305,"KRN",101,"NM",36,0)
PSO HIDDEN ACTIONS #1^^2
"BLD",7305,"KRN",101,"NM",37,0)
PSO LM INTERVENTION MENU^^0
"BLD",7305,"KRN",101,"NM",38,0)
PSO LM DELETE INTERVENTION^^0
"BLD",7305,"KRN",101,"NM",39,0)
PSO LM EDIT INTERVENTION^^0
"BLD",7305,"KRN",101,"NM",40,0)
PSO LM ADD INTERVENTION^^0
"BLD",7305,"KRN",101,"NM",41,0)
PSO LM PRINT INTERVENTION^^0
"BLD",7305,"KRN",101,"NM",42,0)
PSO HIDDEN ACTIONS^^2
"BLD",7305,"KRN",101,"NM",43,0)
PSO ACTIVITY LOGS^^0
"BLD",7305,"KRN",101,"NM",44,0)
PSO LM BACKDOOR COPY^^0
"BLD",7305,"KRN",101,"NM",45,0)
PSO HOLD^^0
"BLD",7305,"KRN",101,"NM",46,0)
PSO UNHOLD^^0
"BLD",7305,"KRN",101,"NM",47,0)
PSO VERIFY^^0
"BLD",7305,"KRN",101,"NM",48,0)
PSO REPRINT^^0
"BLD",7305,"KRN",101,"NM",49,0)
PSO PULL ONE RX FROM SUSPENSE^^0
"BLD",7305,"KRN",101,"NM",50,0)
PSO DRUG RESTR/GUIDE INFO^^0
"BLD",7305,"KRN",101,"NM",51,0)
PSO REJECT DISPLAY OUTSIDE CALL^^0
"BLD",7305,"KRN",101,"NM",52,0)
PSO LM VIEW INTERVENTION^^0
"BLD",7305,"KRN",101,"NM",53,0)
PSO HIDDEN ACTIONS #3^^2
"BLD",7305,"KRN",101,"NM","B","PSO ACTIVITY LOGS",43)

"BLD",7305,"KRN",101,"NM","B","PSO DRUG RESTR/GUIDE INFO",50)

"BLD",7305,"KRN",101,"NM","B","PSO HIDDEN ACTIONS",42)

"BLD",7305,"KRN",101,"NM","B","PSO HIDDEN ACTIONS #1",36)

"BLD",7305,"KRN",101,"NM","B","PSO HIDDEN ACTIONS #2",1)

"BLD",7305,"KRN",101,"NM","B","PSO HIDDEN ACTIONS #3",53)

"BLD",7305,"KRN",101,"NM","B","PSO HOLD",45)

"BLD",7305,"KRN",101,"NM","B","PSO LM ACTION PROFILE",2)

"BLD",7305,"KRN",101,"NM","B","PSO LM ADD INTERVENTION",40)

"BLD",7305,"KRN",101,"NM","B","PSO LM BACKDOOR COPY",44)

"BLD",7305,"KRN",101,"NM","B","PSO LM BACKDOOR SELECT ORDER",3)

"BLD",7305,"KRN",101,"NM","B","PSO LM DELETE INTERVENTION",38)

"BLD",7305,"KRN",101,"NM","B","PSO LM DISPLAY ORDER STATUS",4)

"BLD",7305,"KRN",101,"NM","B","PSO LM EDIT INTERVENTION",39)

"BLD",7305,"KRN",101,"NM","B","PSO LM HIDDEN OTHER",5)

"BLD",7305,"KRN",101,"NM","B","PSO LM INPATIENT MEDICATION PROFILE",6)

"BLD",7305,"KRN",101,"NM","B","PSO LM INTERVENTION MENU",37)

"BLD",7305,"KRN",101,"NM","B","PSO LM MEDICATION PROFILE",7)

"BLD",7305,"KRN",101,"NM","B","PSO LM MULTI-RX PRINT",8)

"BLD",7305,"KRN",101,"NM","B","PSO LM NON-VA MEDS RPT",9)

"BLD",7305,"KRN",101,"NM","B","PSO LM PRINT INTERVENTION",41)

"BLD",7305,"KRN",101,"NM","B","PSO LM PRINT MED INFO",10)

"BLD",7305,"KRN",101,"NM","B","PSO LM VIEW INTERVENTION",52)

"BLD",7305,"KRN",101,"NM","B","PSO NEW ORDER",11)

"BLD",7305,"KRN",101,"NM","B","PSO PATIENT INFORMATION",12)

"BLD",7305,"KRN",101,"NM","B","PSO PATIENT RECORD UPDATE",13)

"BLD",7305,"KRN",101,"NM","B","PSO PULL ONE RX FROM SUSPENSE",49)

"BLD",7305,"KRN",101,"NM","B","PSO REJECT DISPLAY OUTSIDE CALL",51)

"BLD",7305,"KRN",101,"NM","B","PSO REPRINT",48)

"BLD",7305,"KRN",101,"NM","B","PSO SPEED CANCEL",15)

"BLD",7305,"KRN",101,"NM","B","PSO SPEED PULL SUSPENSE",16)

"BLD",7305,"KRN",101,"NM","B","PSO SPEED REFILL",17)

"BLD",7305,"KRN",101,"NM","B","PSO SPEED RELEASE",18)

"BLD",7305,"KRN",101,"NM","B","PSO SPEED RENEW",19)

"BLD",7305,"KRN",101,"NM","B","PSO SPEED REPRINT",20)

"BLD",7305,"KRN",101,"NM","B","PSO UNHOLD",46)

"BLD",7305,"KRN",101,"NM","B","PSO VERIFY",47)

"BLD",7305,"KRN",101,"NM","B","VALM DOWN A LINE",21)

"BLD",7305,"KRN",101,"NM","B","VALM FIRST SCREEN",22)

"BLD",7305,"KRN",101,"NM","B","VALM GOTO PAGE",23)

"BLD",7305,"KRN",101,"NM","B","VALM LAST SCREEN",24)

"BLD",7305,"KRN",101,"NM","B","VALM LEFT",25)

"BLD",7305,"KRN",101,"NM","B","VALM NEXT SCREEN",26)

"BLD",7305,"KRN",101,"NM","B","VALM PREVIOUS SCREEN",27)

"BLD",7305,"KRN",101,"NM","B","VALM PRINT LIST",28)

"BLD",7305,"KRN",101,"NM","B","VALM PRINT SCREEN",29)

"BLD",7305,"KRN",101,"NM","B","VALM QUIT",30)

"BLD",7305,"KRN",101,"NM","B","VALM REFRESH",31)

"BLD",7305,"KRN",101,"NM","B","VALM RIGHT",32)

"BLD",7305,"KRN",101,"NM","B","VALM SEARCH LIST",33)

"BLD",7305,"KRN",101,"NM","B","VALM TURN ON/OFF MENUS",34)

"BLD",7305,"KRN",101,"NM","B","VALM UP ONE LINE",35)

"BLD",7305,"KRN",409.61,0)
409.61
"BLD",7305,"KRN",771,0)
771
"BLD",7305,"KRN",870,0)
870
"BLD",7305,"KRN",8989.51,0)
8989.51
"BLD",7305,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",7305,"KRN",8989.52,0)
8989.52
"BLD",7305,"KRN",8994,0)
8994
"BLD",7305,"KRN","B",.4,.4)

"BLD",7305,"KRN","B",.401,.401)

"BLD",7305,"KRN","B",.402,.402)

"BLD",7305,"KRN","B",.403,.403)

"BLD",7305,"KRN","B",.5,.5)

"BLD",7305,"KRN","B",.84,.84)

"BLD",7305,"KRN","B",3.6,3.6)

"BLD",7305,"KRN","B",3.8,3.8)

"BLD",7305,"KRN","B",9.2,9.2)

"BLD",7305,"KRN","B",9.8,9.8)

"BLD",7305,"KRN","B",19,19)

"BLD",7305,"KRN","B",19.1,19.1)

"BLD",7305,"KRN","B",101,101)

"BLD",7305,"KRN","B",409.61,409.61)

"BLD",7305,"KRN","B",771,771)

"BLD",7305,"KRN","B",870,870)

"BLD",7305,"KRN","B",8989.51,8989.51)

"BLD",7305,"KRN","B",8989.52,8989.52)

"BLD",7305,"KRN","B",8994,8994)

"BLD",7305,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",7305,"QUES",0)
^9.62^^
"BLD",7305,"REQB",0)
^9.611^21^8
"BLD",7305,"REQB",1,0)
PSS*1.0*129^2
"BLD",7305,"REQB",2,0)
PSO*7.0*287^2
"BLD",7305,"REQB",4,0)
PSO*7.0*279^2
"BLD",7305,"REQB",14,0)
PSO*7.0*289^2
"BLD",7305,"REQB",18,0)
PSO*7.0*324^2
"BLD",7305,"REQB",19,0)
PSO*7.0*298^2
"BLD",7305,"REQB",20,0)
PSO*7.0*334^2
"BLD",7305,"REQB",21,0)
PSO*7.0*358^2
"BLD",7305,"REQB","B","PSO*7.0*279",4)

"BLD",7305,"REQB","B","PSO*7.0*287",2)

"BLD",7305,"REQB","B","PSO*7.0*289",14)

"BLD",7305,"REQB","B","PSO*7.0*298",19)

"BLD",7305,"REQB","B","PSO*7.0*324",18)

"BLD",7305,"REQB","B","PSO*7.0*334",20)

"BLD",7305,"REQB","B","PSO*7.0*358",21)

"BLD",7305,"REQB","B","PSS*1.0*129",1)

"FIA",52)
PRESCRIPTION
"FIA",52,0)
^PSRX(
"FIA",52,0,0)
52Is
"FIA",52,0,1)
y^y^p^^^^n^^n
"FIA",52,0,10)

"FIA",52,0,11)

"FIA",52,0,"RLRO")

"FIA",52,0,"VR")
7.0^PSO
"FIA",52,52)
1
"FIA",52,52,100.1)

"FIA",52.4)
RX VERIFY
"FIA",52.4,0)
^PS(52.4,
"FIA",52.4,0,0)
52.4PI
"FIA",52.4,0,1)
y^y^p^^^^n^^n
"FIA",52.4,0,10)

"FIA",52.4,0,11)

"FIA",52.4,0,"RLRO")

"FIA",52.4,0,"VR")
7.0^PSO
"FIA",52.4,52.4)
1
"FIA",52.4,52.4,8)

"FIA",59)
OUTPATIENT SITE
"FIA",59,0)
^PS(59,
"FIA",59,0,0)
59I
"FIA",59,0,1)
y^y^p^^^^n^^n
"FIA",59,0,10)

"FIA",59,0,11)

"FIA",59,0,"RLRO")

"FIA",59,0,"VR")
7.0^PSO
"FIA",59,59)
1
"FIA",59,59,3.2)

"INIT")
PSO251PO
"IX",52.4,52.4,"DW",0)
52.4^DW^DOSE WARNING^R^^R^IR^I^52.4^^^^^LS
"IX",52.4,52.4,"DW",1)
S ^PS(52.4,"DW",X(1),X(2),DA)=""
"IX",52.4,52.4,"DW",2)
K ^PS(52.4,"DW",X(1),X(2),DA)
"IX",52.4,52.4,"DW",2.5)
K ^PS(52.4,"DW")
"IX",52.4,52.4,"DW",11.1,0)
^.114IA^2^2
"IX",52.4,52.4,"DW",11.1,1,0)
1^F^52.4^.01^^1^F
"IX",52.4,52.4,"DW",11.1,1,3)

"IX",52.4,52.4,"DW",11.1,2,0)
2^F^52.4^8^^2^F
"IX",52.4,52.4,"DW",11.1,2,3)

"KRN",19,13807,-1)
0^2
"KRN",19,13807,0)
PSO ORDER CHECKS VERIFY^Process Order Checks^^R^^^^^^^^OUTPATIENT PHARMACY
"KRN",19,13807,1,0)
^^2^2^3090917^
"KRN",19,13807,1,1,0)
This option is used to process medications that have had drug/drug 
"KRN",19,13807,1,2,0)
interactions or dosing checks.
"KRN",19,13807,25)
PSODGDG1
"KRN",19,13807,"U")
PROCESS ORDER CHECKS
"KRN",19,13936,-1)
1^1
"KRN",19,13936,0)
PSO INTERACTION VERIFY
"KRN",101,1803,-1)
0^26
"KRN",101,1803,0)
VALM NEXT SCREEN^Next Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1803,1,0)
^^2^2^2920519^^^
"KRN",101,1803,1,1,0)
This action will allow the user to view the next screen
"KRN",101,1803,1,2,0)
of entries, if any exist.
"KRN",101,1803,2,0)
^101.02A^1^1
"KRN",101,1803,2,1,0)
NX
"KRN",101,1803,2,"B","NX",1)

"KRN",101,1803,4)

"KRN",101,1803,15)

"KRN",101,1803,20)
D NEXT^VALM4
"KRN",101,1803,99)
62080,37285
"KRN",101,1804,-1)
0^27
"KRN",101,1804,0)
VALM PREVIOUS SCREEN^Previous Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1804,1,0)
^^2^2^2920113^^
"KRN",101,1804,1,1,0)
This action will allow the user to view the previous screen
"KRN",101,1804,1,2,0)
of entries, if any exist.
"KRN",101,1804,2,0)
^101.02A^3^2
"KRN",101,1804,2,1,0)
PR
"KRN",101,1804,2,2,0)
BK
"KRN",101,1804,2,3,0)
PR
"KRN",101,1804,2,"B","BK",2)

"KRN",101,1804,2,"B","PR",1)

"KRN",101,1804,2,"B","PR",3)

"KRN",101,1804,20)
D PREV^VALM4
"KRN",101,1804,99)
62080,37285
"KRN",101,1805,-1)
0^31
"KRN",101,1805,0)
VALM REFRESH^Re-Display Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1805,1,0)
^^1^1^2911024^
"KRN",101,1805,1,1,0)
This actions allows the user to re-display the current screen.
"KRN",101,1805,2,0)
^101.02A^1^1
"KRN",101,1805,2,1,0)
RE
"KRN",101,1805,2,"B","RE",1)

"KRN",101,1805,10,0)
^101.01PA^0^0
"KRN",101,1805,20)
D RE^VALM4
"KRN",101,1805,99)
62080,37285
"KRN",101,1806,-1)
0^24
"KRN",101,1806,0)
VALM LAST SCREEN^Last Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1806,1,0)
^^1^1^2911026^
"KRN",101,1806,1,1,0)
The action will display the last items.
"KRN",101,1806,20)
D LAST^VALM4
"KRN",101,1806,99)
62080,37285
"KRN",101,1807,-1)
0^22
"KRN",101,1807,0)
VALM FIRST SCREEN^First Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1807,1,0)
^^1^1^2960619^^
"KRN",101,1807,1,1,0)
This action will display the first screen.
"KRN",101,1807,15)

"KRN",101,1807,20)
D FIRST^VALM4
"KRN",101,1807,99)
62080,37285
"KRN",101,1808,-1)
0^35
"KRN",101,1808,0)
VALM UP ONE LINE^Up a Line^^A^^^^^^^^LIST MANAGER
"KRN",101,1808,1,0)
^^1^1^2911027^
"KRN",101,1808,1,1,0)
Move up a line
"KRN",101,1808,20)
D UP^VALM40
"KRN",101,1808,99)
62080,37285
"KRN",101,1809,-1)
0^21
"KRN",101,1809,0)
VALM DOWN A LINE^Down a Line^^A^^^^^^^^LIST MANAGER
"KRN",101,1809,1,0)
^^2^2^2950628^^
"KRN",101,1809,1,1,0)
Move down a line.
"KRN",101,1809,1,2,0)

"KRN",101,1809,3,0)
^101.03P^0^0
"KRN",101,1809,20)
D DOWN^VALM40
"KRN",101,1809,99)
62080,37285
"KRN",101,1811,-1)
0^30
"KRN",101,1811,0)
VALM QUIT^Quit^^A^^^^^^^^
"KRN",101,1811,.1)
 
"KRN",101,1811,1,0)
^^1^1^2911105^
"KRN",101,1811,1,1,0)
This protocol can be used as a generic 'quit' action.
"KRN",101,1811,2,0)
^101.02A^2^2
"KRN",101,1811,2,1,0)
EXIT
"KRN",101,1811,2,2,0)
QUIT
"KRN",101,1811,2,"B","EXIT",1)

"KRN",101,1811,2,"B","QUIT",2)

"KRN",101,1811,15)

"KRN",101,1811,20)
Q
"KRN",101,1811,99)
62080,37285
"KRN",101,1812,-1)
0^29
"KRN",101,1812,0)
VALM PRINT SCREEN^Print Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1812,1,0)
^^3^3^2920113^^
"KRN",101,1812,1,1,0)
This action allows the user to print the current List Manager
"KRN",101,1812,1,2,0)
display screen.  The header and the current portion of the
"KRN",101,1812,1,3,0)
list are printed.
"KRN",101,1812,20)
D PRT^VALM1
"KRN",101,1812,99)
62080,37285
"KRN",101,1813,-1)
0^28
"KRN",101,1813,0)
VALM PRINT LIST^Print List^^A^^^^^^^^LIST MANAGER
"KRN",101,1813,1,0)
^^2^2^2920113^
"KRN",101,1813,1,1,0)
This action allws the user to print the entire list of
"KRN",101,1813,1,2,0)
entries currently being displayed.
"KRN",101,1813,20)
D PRTL^VALM1
"KRN",101,1813,99)
62080,37426
"KRN",101,1815,-1)
0^34
"KRN",101,1815,0)
VALM TURN ON/OFF MENUS^Auto-Display(On/Off)^^A^^^^^^^^LIST MANAGER
"KRN",101,1815,20)
D MENU^VALM2
"KRN",101,1815,99)
62080,37285
"KRN",101,1817,-1)
0^33
"KRN",101,1817,0)
VALM SEARCH LIST^Search List^^A^^^^^^^^LIST MANAGER
"KRN",101,1817,1,0)
^^1^1^2920303^^
"KRN",101,1817,1,1,0)
Finds text in list of entries.
"KRN",101,1817,20)
D FIND^VALM40
"KRN",101,1817,99)
62080,37285
"KRN",101,1824,-1)
0^32
"KRN",101,1824,0)
VALM RIGHT^Shift View to Right^^A^^^^^^^^LIST MANAGER
"KRN",101,1824,20)
D RIGHT^VALM40(XQORNOD(0))
"KRN",101,1824,99)
61732,50385
"KRN",101,1825,-1)
0^25
"KRN",101,1825,0)
VALM LEFT^Shift View to Left^^A^^^^^^^^LIST MANAGER
"KRN",101,1825,20)
D LEFT^VALM40(XQORNOD(0))
"KRN",101,1825,99)
61732,50385
"KRN",101,1827,-1)
0^23
"KRN",101,1827,0)
VALM GOTO PAGE^Go to Page^^A^^^^^^^^LIST MANAGER
"KRN",101,1827,1,0)
^^1^1^2930113^
"KRN",101,1827,1,1,0)

"KRN",101,1827,20)
D GOTO^VALM40
"KRN",101,1827,99)
62080,37285
"KRN",101,3778,-1)
0^13
"KRN",101,3778,0)
PSO PATIENT RECORD UPDATE^Patient Record Update^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3778,15)
W ""
"KRN",101,3778,20)
S DFN=PSODFN D EN^PSOLMPAT
"KRN",101,3778,99)
61732,50385
"KRN",101,3782,-1)
0^45
"KRN",101,3782,0)
PSO HOLD^Hold (OP)^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3782,2,0)
^101.02A^3^2
"KRN",101,3782,2,2,0)
HOLD
"KRN",101,3782,2,3,0)
HO
"KRN",101,3782,2,"B","HO",3)

"KRN",101,3782,2,"B","HOLD",2)

"KRN",101,3782,15)
W ""
"KRN",101,3782,20)
S PSOHD=1,(DA,PPL,PSDA)=$P(PSOLST($P(PSLST,",",ORD)),"^",2) D HLD^PSOHLD K PSONOOR,PSOHD,COM,DA,PPL,PSDA
"KRN",101,3782,99)
61732,50385
"KRN",101,3783,-1)
0^46
"KRN",101,3783,0)
PSO UNHOLD^Unhold (OP)^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3783,2,0)
^101.02A^2^2
"KRN",101,3783,2,1,0)
UH
"KRN",101,3783,2,2,0)
UNHOLD
"KRN",101,3783,2,"B","UH",1)

"KRN",101,3783,2,"B","UNHOLD",2)

"KRN",101,3783,15)
W ""
"KRN",101,3783,20)
S (DA,PPL,PSDA)=$P(PSOLST($P(PSLST,",",ORD)),"^",2) D UHLD^PSOHLD K COM,DA,PPL,PSDA
"KRN",101,3783,99)
61732,50385
"KRN",101,3787,-1)
0^48
"KRN",101,3787,0)
PSO REPRINT^Reprint (OP)^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3787,15)
K POERR
"KRN",101,3787,20)
S POERR=1 D BCK^PSORXRPT
"KRN",101,3787,99)
61732,50385
"KRN",101,3788,-1)
0^47
"KRN",101,3788,0)
PSO VERIFY^Verify (OP)^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3788,2,0)
^101.02A^3^2
"KRN",101,3788,2,2,0)
VERIFY
"KRN",101,3788,2,3,0)
VO
"KRN",101,3788,2,"B","VERIFY",2)

"KRN",101,3788,2,"B","VO",3)

"KRN",101,3788,15)
W ""
"KRN",101,3788,20)
N PSODFN D OERR^PSOVER
"KRN",101,3788,99)
61732,50385
"KRN",101,3789,-1)
0^11
"KRN",101,3789,0)
PSO NEW ORDER^New Order^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3789,15)
W ""
"KRN",101,3789,20)
N VALMCNT S PSOFROM="NEW" D OERR^PSONEW
"KRN",101,3789,99)
61732,50385
"KRN",101,3790,-1)
0^3
"KRN",101,3790,0)
PSO LM BACKDOOR SELECT ORDER^Select Order^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3790,15)
D BLD^PSOORUT1,RV^PSOORFL
"KRN",101,3790,20)
D SEL^PSOORNE2
"KRN",101,3790,99)
61732,50385
"KRN",101,3791,-1)
0^12
"KRN",101,3791,0)
PSO PATIENT INFORMATION^Patient Information^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3791,15)
W ""
"KRN",101,3791,20)
D EN^PSOLMPI
"KRN",101,3791,99)
61732,50385
"KRN",101,3800,-1)
0^44
"KRN",101,3800,0)
PSO LM BACKDOOR COPY^Copy (OP)^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3800,2,0)
^101.02A^2^2
"KRN",101,3800,2,1,0)
CO
"KRN",101,3800,2,2,0)
COPY
"KRN",101,3800,2,"B","CO",1)

"KRN",101,3800,2,"B","COPY",2)

"KRN",101,3800,15)

"KRN",101,3800,20)
D ^PSOORCPY
"KRN",101,3800,99)
61732,50385
"KRN",101,3801,-1)
0^43
"KRN",101,3801,0)
PSO ACTIVITY LOGS^Activity Logs (OP)^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3801,2,0)
^101.02A^3^3
"KRN",101,3801,2,1,0)
AL
"KRN",101,3801,2,2,0)
LOGS
"KRN",101,3801,2,3,0)
ACTIVITY
"KRN",101,3801,2,"B","ACTIVITY",3)

"KRN",101,3801,2,"B","AL",1)

"KRN",101,3801,2,"B","LOGS",2)

"KRN",101,3801,10,0)
^101.01PA^0^0
"KRN",101,3801,15)

"KRN",101,3801,20)
D ^PSOORAL1
"KRN",101,3801,26)

"KRN",101,3801,99)
61732,50385
"KRN",101,3805,-1)
0^7
"KRN",101,3805,0)
PSO LM MEDICATION PROFILE^Patient Medication Profile^^M^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3805,.1)
profile
"KRN",101,3805,4)
40^4
"KRN",101,3805,10,0)
^101.01PA^4^4
"KRN",101,3805,10,1,0)
3790^SO^21^
"KRN",101,3805,10,1,"^")
PSO LM BACKDOOR SELECT ORDER
"KRN",101,3805,10,2,0)
3789^NO^20^
"KRN",101,3805,10,2,"^")
PSO NEW ORDER
"KRN",101,3805,10,3,0)
3778^PU^10^
"KRN",101,3805,10,3,"^")
PSO PATIENT RECORD UPDATE
"KRN",101,3805,10,4,0)
3791^PI^11^
"KRN",101,3805,10,4,"^")
PSO PATIENT INFORMATION
"KRN",101,3805,20)
D PENTRY^PSOLMAO
"KRN",101,3805,26)
D A^PSOORUT3,SHOW^VALM S XQORM("#")=$O(^ORD(101,"B","PSO LM NEW SELECT ORDER",0))_"^1:"_PSOCNT
"KRN",101,3805,28)
Select Action: 
"KRN",101,3805,99)
61732,50385
"KRN",101,3816,-1)
2^42
"KRN",101,3816,0)
PSO HIDDEN ACTIONS^Outpatient Pharmacy Hidden Actions^^M^10000000182^^^^^^^141
"KRN",101,3816,10,0)
^101.01PA^33^33
"KRN",101,3816,10,1,0)
1803^+^^
"KRN",101,3816,10,1,"^")
VALM NEXT SCREEN
"KRN",101,3816,10,2,0)
1804^-^^
"KRN",101,3816,10,2,"^")
VALM PREVIOUS SCREEN
"KRN",101,3816,10,3,0)
1808^UP^^
"KRN",101,3816,10,3,"^")
VALM UP ONE LINE
"KRN",101,3816,10,4,0)
1809^DN^^
"KRN",101,3816,10,4,"^")
VALM DOWN A LINE
"KRN",101,3816,10,5,0)
1805^RD^^
"KRN",101,3816,10,5,"^")
VALM REFRESH
"KRN",101,3816,10,6,0)
1812^PS^^
"KRN",101,3816,10,6,"^")
VALM PRINT SCREEN
"KRN",101,3816,10,7,0)
1813^PT^^
"KRN",101,3816,10,7,"^")
VALM PRINT LIST
"KRN",101,3816,10,8,0)
1824^>^^
"KRN",101,3816,10,8,"^")
VALM RIGHT
"KRN",101,3816,10,9,0)
1825^<^^
"KRN",101,3816,10,9,"^")
VALM LEFT
"KRN",101,3816,10,10,0)
1817^SL^^
"KRN",101,3816,10,10,"^")
VALM SEARCH LIST
"KRN",101,3816,10,11,0)
1811^QU^^
"KRN",101,3816,10,11,1)
^
"KRN",101,3816,10,11,"^")
VALM QUIT
"KRN",101,3816,10,12,0)
1806^LS^^
"KRN",101,3816,10,12,"^")
VALM LAST SCREEN
"KRN",101,3816,10,13,0)
1807^FS^^
"KRN",101,3816,10,13,"^")
VALM FIRST SCREEN
"KRN",101,3816,10,14,0)
1827^GO^^
"KRN",101,3816,10,14,"^")
VALM GOTO PAGE
"KRN",101,3816,10,15,0)
3801^AL^11^
"KRN",101,3816,10,15,"^")
PSO ACTIVITY LOGS
"KRN",101,3816,10,17,0)
3800^CO^13^
"KRN",101,3816,10,17,"^")
PSO LM BACKDOOR COPY
"KRN",101,3816,10,18,0)
3782^HD^22^
"KRN",101,3816,10,18,"^")
PSO HOLD
"KRN",101,3816,10,19,0)
3783^UH^23^
"KRN",101,3816,10,19,"^")
PSO UNHOLD
"KRN",101,3816,10,20,0)
3788^VF^12^
"KRN",101,3816,10,20,"^")
PSO VERIFY
"KRN",101,3816,10,21,0)
3787^RP^21^
"KRN",101,3816,10,21,"^")
PSO REPRINT
"KRN",101,3816,10,25,0)
3791^PI^31^
"KRN",101,3816,10,25,"^")
PSO PATIENT INFORMATION
"KRN",101,3816,10,26,0)
3834^PP^32^
"KRN",101,3816,10,26,"^")
PSO PULL ONE RX FROM SUSPENSE
"KRN",101,3816,10,27,0)
3838^IP^33^
"KRN",101,3816,10,27,"^")
PSO LM INPATIENT MEDICATION PROFILE
"KRN",101,3816,10,30,0)
1815^ADPL^^
"KRN",101,3816,10,30,"^")
VALM TURN ON/OFF MENUS
"KRN",101,3816,10,31,0)
4623^DIN^66^
"KRN",101,3816,10,31,"^")
PSO DRUG RESTR/GUIDE INFO
"KRN",101,3816,10,32,0)
5450^REJ^35^
"KRN",101,3816,10,32,"^")
PSO REJECT DISPLAY OUTSIDE CALL
"KRN",101,3816,10,33,0)
5743^IN^36^
"KRN",101,3816,10,33,"^")
PSO LM INTERVENTION MENU
"KRN",101,3823,-1)
0^19
"KRN",101,3823,0)
PSO SPEED RENEW^Renew (OP)^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3823,20)
D ^PSORENW4
"KRN",101,3823,26)

"KRN",101,3823,99)
61732,50385
"KRN",101,3824,-1)
2^1
"KRN",101,3824,0)
PSO HIDDEN ACTIONS #2^Outpatient Pharmacy Hidden Actions #2^^M^10000000182^^^^^^^141
"KRN",101,3824,10,0)
^101.01PA^29^29
"KRN",101,3824,10,1,0)
1803^+^35^
"KRN",101,3824,10,1,"^")
VALM NEXT SCREEN
"KRN",101,3824,10,2,0)
1804^-^^
"KRN",101,3824,10,2,"^")
VALM PREVIOUS SCREEN
"KRN",101,3824,10,3,0)
1808^UP^^
"KRN",101,3824,10,3,"^")
VALM UP ONE LINE
"KRN",101,3824,10,4,0)
1809^DN^20^
"KRN",101,3824,10,4,"^")
VALM DOWN A LINE
"KRN",101,3824,10,5,0)
1805^RD^21^
"KRN",101,3824,10,5,"^")
VALM REFRESH
"KRN",101,3824,10,6,0)
1813^PT^22^
"KRN",101,3824,10,6,"^")
VALM PRINT LIST
"KRN",101,3824,10,7,0)
1812^PS^23^
"KRN",101,3824,10,7,"^")
VALM PRINT SCREEN
"KRN",101,3824,10,8,0)
1824^>^24^
"KRN",101,3824,10,8,"^")
VALM RIGHT
"KRN",101,3824,10,9,0)
1825^<^25^
"KRN",101,3824,10,9,"^")
VALM LEFT
"KRN",101,3824,10,10,0)
1817^SL^26^
"KRN",101,3824,10,10,"^")
VALM SEARCH LIST
"KRN",101,3824,10,11,0)
1811^QU^31^
"KRN",101,3824,10,11,"^")
VALM QUIT
"KRN",101,3824,10,12,0)
1806^LS^32^
"KRN",101,3824,10,12,"^")
VALM LAST SCREEN
"KRN",101,3824,10,13,0)
1807^FS^33^
"KRN",101,3824,10,13,"^")
VALM FIRST SCREEN
"KRN",101,3824,10,14,0)
1827^GO^34^
"KRN",101,3824,10,14,"^")
VALM GOTO PAGE
"KRN",101,3824,10,15,0)
3823^RN^11^
"KRN",101,3824,10,15,"^")
PSO SPEED RENEW
"KRN",101,3824,10,16,0)
3825^DC^12^
"KRN",101,3824,10,16,"^")
PSO SPEED CANCEL
"KRN",101,3824,10,17,0)
3826^RL^13^
"KRN",101,3824,10,17,"^")
PSO SPEED RELEASE
"KRN",101,3824,10,18,0)
3827^RP^10^
"KRN",101,3824,10,18,"^")
PSO SPEED REPRINT
"KRN",101,3824,10,19,0)
3830^RF^14^
"KRN",101,3824,10,19,"^")
PSO SPEED REFILL
"KRN",101,3824,10,20,0)
3833^PP^15^
"KRN",101,3824,10,20,"^")
PSO SPEED PULL SUSPENSE
"KRN",101,3824,10,21,0)
3838^IP^16^
"KRN",101,3824,10,21,"^")
PSO LM INPATIENT MEDICATION PROFILE
"KRN",101,3824,10,23,0)
1815^ADPL^^
"KRN",101,3824,10,23,"^")
VALM TURN ON/OFF MENUS
"KRN",101,3824,10,24,0)
3842^OTH^19^
"KRN",101,3824,10,24,"^")
PSO LM HIDDEN OTHER
"KRN",101,3824,10,29,0)
5743^IN^^
"KRN",101,3824,10,29,"^")
PSO LM INTERVENTION MENU
"KRN",101,3825,-1)
0^15
"KRN",101,3825,0)
PSO SPEED CANCEL^Discontinue (OP)^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3825,20)
D ^PSOCAN4
"KRN",101,3825,99)
61732,50385
"KRN",101,3826,-1)
0^18
"KRN",101,3826,0)
PSO SPEED RELEASE^Release (OP)^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3826,20)
D ^PSODISP3
"KRN",101,3826,99)
61732,50385
"KRN",101,3827,-1)
0^20
"KRN",101,3827,0)
PSO SPEED REPRINT^Reprint (OP)^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3827,20)
D ^PSORXRP1
"KRN",101,3827,99)
61732,50385
"KRN",101,3830,-1)
0^17
"KRN",101,3830,0)
PSO SPEED REFILL^Refill (OP)^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3830,20)
D SPEED^PSOREF
"KRN",101,3830,99)
61732,50385
"KRN",101,3832,-1)
2^53
"KRN",101,3832,0)
PSO HIDDEN ACTIONS #3^Outpatient Pharmacy Hidden Actions #3^^M^11733^^^^^^^141
"KRN",101,3832,10,0)
^101.01PA^23^23
"KRN",101,3832,10,2,0)
1803^+^^
"KRN",101,3832,10,2,"^")
VALM NEXT SCREEN
"KRN",101,3832,10,3,0)
1804^-^^
"KRN",101,3832,10,3,"^")
VALM PREVIOUS SCREEN
"KRN",101,3832,10,4,0)
1808^UP^^
"KRN",101,3832,10,4,"^")
VALM UP ONE LINE
"KRN",101,3832,10,5,0)
1809^DN^^
"KRN",101,3832,10,5,"^")
VALM DOWN A LINE
"KRN",101,3832,10,6,0)
1805^RD^^
"KRN",101,3832,10,6,"^")
VALM REFRESH
"KRN",101,3832,10,7,0)
1813^PT^^
"KRN",101,3832,10,7,"^")
VALM PRINT LIST
"KRN",101,3832,10,8,0)
1812^PS^^
"KRN",101,3832,10,8,"^")
VALM PRINT SCREEN
"KRN",101,3832,10,9,0)
1824^>^^
"KRN",101,3832,10,9,"^")
VALM RIGHT
"KRN",101,3832,10,10,0)
1825^<^^
"KRN",101,3832,10,10,"^")
VALM LEFT
"KRN",101,3832,10,11,0)
1817^SL^^
"KRN",101,3832,10,11,"^")
VALM SEARCH LIST
"KRN",101,3832,10,12,0)
1811^QT^^
"KRN",101,3832,10,12,"^")
VALM QUIT
"KRN",101,3832,10,13,0)
1806^LS^^
"KRN",101,3832,10,13,"^")
VALM LAST SCREEN
"KRN",101,3832,10,14,0)
1807^FS^^
"KRN",101,3832,10,14,"^")
VALM FIRST SCREEN
"KRN",101,3832,10,15,0)
1827^GO^^
"KRN",101,3832,10,15,"^")
VALM GOTO PAGE
"KRN",101,3832,10,20,0)
3791^PI^12^
"KRN",101,3832,10,20,"^")
PSO PATIENT INFORMATION
"KRN",101,3832,10,21,0)
1815^ADPL^^
"KRN",101,3832,10,21,"^")
VALM TURN ON/OFF MENUS
"KRN",101,3832,10,22,0)
4623^DIN^13^
"KRN",101,3832,10,22,"^")
PSO DRUG RESTR/GUIDE INFO
"KRN",101,3832,10,23,0)
5743^IN^16^
"KRN",101,3832,10,23,"^")
PSO LM INTERVENTION MENU
"KRN",101,3833,-1)
0^16
"KRN",101,3833,0)
PSO SPEED PULL SUSPENSE^Pull Rx (OP)^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3833,20)
D ^PSOSUPOE
"KRN",101,3833,99)
61732,50385
"KRN",101,3834,-1)
0^49
"KRN",101,3834,0)
PSO PULL ONE RX FROM SUSPENSE^Pull Rx (OP)^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3834,20)
D SELONE^PSOSUPOE
"KRN",101,3834,99)
61732,50385
"KRN",101,3838,-1)
0^6
"KRN",101,3838,0)
PSO LM INPATIENT MEDICATION PROFILE^Inpat. Profile (OP)^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3838,10,0)
^101.01PA
"KRN",101,3838,15)
S VALMBCK="R"
"KRN",101,3838,20)
I $T(ENOR^PSJPR)]"" D FULL^VALM1,ENOR^PSJPR(PSODFN):'$G(PSOBEDT)
"KRN",101,3838,99)
61732,50385
"KRN",101,3841,-1)
0^10
"KRN",101,3841,0)
PSO LM PRINT MED INFO^Print Medication Instructions^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3841,15)
Q
"KRN",101,3841,20)
D PRMI^PSOHELP
"KRN",101,3841,99)
61732,50385
"KRN",101,3842,-1)
0^5
"KRN",101,3842,0)
PSO LM HIDDEN OTHER^Other OP Actions^^M^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3842,10,0)
^101.01PA^10^10
"KRN",101,3842,10,6,0)
3841^MI^10^
"KRN",101,3842,10,6,"^")
PSO LM PRINT MED INFO
"KRN",101,3842,10,7,0)
3845^DO^21^
"KRN",101,3842,10,7,"^")
PSO LM DISPLAY ORDER STATUS
"KRN",101,3842,10,8,0)
3846^AP^11^
"KRN",101,3842,10,8,"^")
PSO LM ACTION PROFILE
"KRN",101,3842,10,9,0)
5115^NV^^
"KRN",101,3842,10,9,"^")
PSO LM NON-VA MEDS RPT
"KRN",101,3842,10,10,0)
5284^MR^^
"KRN",101,3842,10,10,"^")
PSO LM MULTI-RX PRINT
"KRN",101,3842,15)
S VALMBCK="R"
"KRN",101,3842,99)
61732,50385
"KRN",101,3845,-1)
0^4
"KRN",101,3845,0)
PSO LM DISPLAY ORDER STATUS^Display Orders' Statuses^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3845,20)
D DPLYOR^PSOORUT3
"KRN",101,3845,99)
61732,50385
"KRN",101,3846,-1)
0^2
"KRN",101,3846,0)
PSO LM ACTION PROFILE^Action Profile (OP)^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3846,15)
S VALMBCK="R"
"KRN",101,3846,20)
D FULL^VALM1 S DFN=PSODFN D LM^PSOSD1
"KRN",101,3846,99)
61732,50385
"KRN",101,4623,-1)
0^50
"KRN",101,4623,0)
PSO DRUG RESTR/GUIDE INFO^Drug Restr/Guide (OP)^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,4623,2,0)
^101.02A^^0
"KRN",101,4623,15)
S VALMBCK="R"
"KRN",101,4623,20)
D FULL^VALM1,DDTX^PSONFI
"KRN",101,4623,99)
61732,50385
"KRN",101,4624,-1)
2^36
"KRN",101,4624,0)
PSO HIDDEN ACTIONS #1^Outpatient Pharmacy Hidden Actions #1^^M^10000000182^^^^^^^141
"KRN",101,4624,10,0)
^101.01PA^16^16
"KRN",101,4624,10,1,0)
1803^+^11^
"KRN",101,4624,10,1,"^")
VALM NEXT SCREEN
"KRN",101,4624,10,2,0)
1804^-^12^
"KRN",101,4624,10,2,"^")
VALM PREVIOUS SCREEN
"KRN",101,4624,10,3,0)
1808^UP^13^
"KRN",101,4624,10,3,"^")
VALM UP ONE LINE
"KRN",101,4624,10,4,0)
1809^DN^14^
"KRN",101,4624,10,4,"^")
VALM DOWN A LINE
"KRN",101,4624,10,5,0)
1805^RD^24^
"KRN",101,4624,10,5,"^")
VALM REFRESH
"KRN",101,4624,10,6,0)
1812^PS^25^
"KRN",101,4624,10,6,"^")
VALM PRINT SCREEN
"KRN",101,4624,10,7,0)
1813^PT^26^
"KRN",101,4624,10,7,"^")
VALM PRINT LIST
"KRN",101,4624,10,8,0)
1824^>^15^
"KRN",101,4624,10,8,"^")
VALM RIGHT
"KRN",101,4624,10,9,0)
1825^<^16^
"KRN",101,4624,10,9,"^")
VALM LEFT
"KRN",101,4624,10,10,0)
1815^ADPL^32^
"KRN",101,4624,10,10,"^")
VALM TURN ON/OFF MENUS
"KRN",101,4624,10,11,0)
1817^SL^31^
"KRN",101,4624,10,11,"^")
VALM SEARCH LIST
"KRN",101,4624,10,12,0)
1811^QU^33^
"KRN",101,4624,10,12,"^")
VALM QUIT
"KRN",101,4624,10,13,0)
1806^LS^22^
"KRN",101,4624,10,13,"^")
VALM LAST SCREEN
"KRN",101,4624,10,14,0)
1807^FS^21^
"KRN",101,4624,10,14,"^")
VALM FIRST SCREEN
"KRN",101,4624,10,15,0)
1827^GO^23^
"KRN",101,4624,10,15,"^")
VALM GOTO PAGE
"KRN",101,4624,10,16,0)
5743^IN^10^
"KRN",101,4624,10,16,"^")
PSO LM INTERVENTION MENU
"KRN",101,5115,-1)
0^9
"KRN",101,5115,0)
PSO LM NON-VA MEDS RPT^Non-VA Meds Report^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,5115,15)
S VALMBCK="R"
"KRN",101,5115,20)
D FULL^VALM1 D HID^PSONVARP
"KRN",101,5115,99)
61732,50385
"KRN",101,5284,-1)
0^8
"KRN",101,5284,0)
PSO LM MULTI-RX PRINT^Multi-Rx Request Print^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,5284,15)
Q
"KRN",101,5284,20)
D QUEUE^PSOLLL7
"KRN",101,5284,99)
61732,50385
"KRN",101,5450,-1)
0^51
"KRN",101,5450,0)
PSO REJECT DISPLAY OUTSIDE CALL^View REJECT^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,5450,20)
S PSOREJRX=$P(PSOLST($P(PSLST,",",ORD)),"^",2) D OUT^PSOREJP1(PSOREJRX)
"KRN",101,5450,99)
61732,50385
"KRN",101,5743,-1)
0^37
"KRN",101,5743,0)
PSO LM INTERVENTION MENU^Intervention Menu^^M^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,5743,10,0)
^101.01PA^5^5
"KRN",101,5743,10,1,0)
5744^DI^^
"KRN",101,5743,10,1,"^")
PSO LM DELETE INTERVENTION
"KRN",101,5743,10,2,0)
5745^EI^^
"KRN",101,5743,10,2,"^")
PSO LM EDIT INTERVENTION
"KRN",101,5743,10,3,0)
5746^AI^^
"KRN",101,5743,10,3,"^")
PSO LM ADD INTERVENTION
"KRN",101,5743,10,4,0)
5747^PI^^
"KRN",101,5743,10,4,"^")
PSO LM PRINT INTERVENTION
"KRN",101,5743,10,5,0)
5748^VI^^
"KRN",101,5743,10,5,"^")
PSO LM VIEW INTERVENTION
"KRN",101,5743,15)
S VALMBCK="R"
"KRN",101,5743,99)
61732,50385
"KRN",101,5744,-1)
0^38
"KRN",101,5744,0)
PSO LM DELETE INTERVENTION^Delete Intervention^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,5744,20)
D FULL^VALM1,^PSODELI
"KRN",101,5744,99)
61732,50385
"KRN",101,5745,-1)
0^39
"KRN",101,5745,0)
PSO LM EDIT INTERVENTION^Edit Intervention^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,5745,20)
D FULL^VALM1,EDIT^PSODELI
"KRN",101,5745,99)
61732,50385
"KRN",101,5746,-1)
0^40
"KRN",101,5746,0)
PSO LM ADD INTERVENTION^Enter New Intervention^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,5746,20)
D FULL^VALM1,NEW^PSODELI
"KRN",101,5746,99)
61732,50385
"KRN",101,5747,-1)
0^41
"KRN",101,5747,0)
PSO LM PRINT INTERVENTION^Print Intervention^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,5747,20)
D FULL^VALM1,OUT^PSODELI
"KRN",101,5747,99)
61732,50385
"KRN",101,5748,-1)
0^52
"KRN",101,5748,0)
PSO LM VIEW INTERVENTION^View Interventions^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,5748,20)
D VIEW^PSODELI
"KRN",101,5748,99)
61732,50385
"MBREQ")
1
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",141,-1)
1^1
"PKG",141,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",141,20,0)
^9.402P^^
"PKG",141,22,0)
^9.49I^1^1
"PKG",141,22,1,0)
7.0^2971216^2980917^11712
"PKG",141,22,1,"PAH",1,0)
251^3110113^10000000182
"PKG",141,22,1,"PAH",1,1,0)
^^33^33^3110113
"PKG",141,22,1,"PAH",1,1,1,0)
This patch is part of a combined build, made up of the following three 
"PKG",141,22,1,"PAH",1,1,2,0)
patches:
"PKG",141,22,1,"PAH",1,1,3,0)
       OR*3.0*272           (Computerized Patient Record System)
"PKG",141,22,1,"PAH",1,1,4,0)
       PSJ*5.0*181           (Inpatient Medications)
"PKG",141,22,1,"PAH",1,1,5,0)
       PSO*7.0*251          (Outpatient Pharmacy)
"PKG",141,22,1,"PAH",1,1,6,0)
 
"PKG",141,22,1,"PAH",1,1,7,0)
These patches will replace most of current VistA medication order 
"PKG",141,22,1,"PAH",1,1,8,0)
checking system with version 1.0 of the new Medication Order Check 
"PKG",141,22,1,"PAH",1,1,9,0)
Healthcare Application (MOCHA) system that uses the First DataBank (FDB) 
"PKG",141,22,1,"PAH",1,1,10,0)
Drug Information Framework (DIF) interfaces and database. The VistA Drug 
"PKG",141,22,1,"PAH",1,1,11,0)
Interaction module will be replaced by the FDB Drug-Drug Interaction 
"PKG",141,22,1,"PAH",1,1,12,0)
Module (DDIM). The VistA Duplicate Class module will be replaced by the 
"PKG",141,22,1,"PAH",1,1,13,0)
FDB Enhanced Therapeutic Classification (ETC) System.
"PKG",141,22,1,"PAH",1,1,14,0)
 
"PKG",141,22,1,"PAH",1,1,15,0)
In addition, the following three order checks that use VistA data have
"PKG",141,22,1,"PAH",1,1,16,0)
been added to Inpatient Medications and Outpatient Pharmacy. These checks
"PKG",141,22,1,"PAH",1,1,17,0)
currently occur in Computerized Patient Record System (CPRS), but will be
"PKG",141,22,1,"PAH",1,1,18,0)
new to Pharmacy with the installation of these patches:
"PKG",141,22,1,"PAH",1,1,19,0)
     Aminoglycoside Ordered
"PKG",141,22,1,"PAH",1,1,20,0)
     Dangerous Meds for Patients > 64
"PKG",141,22,1,"PAH",1,1,21,0)
     Glucophage - Lab Results
"PKG",141,22,1,"PAH",1,1,22,0)
 
"PKG",141,22,1,"PAH",1,1,23,0)
A new Graphical User Interface (GUI) module is also being introduced 
"PKG",141,22,1,"PAH",1,1,24,0)
called Pharmacy Enterprise Customization System (PECS), to be used only 
"PKG",141,22,1,"PAH",1,1,25,0)
by members of Pharmacy Benefits Management (PBM). It will allow PBM to 
"PKG",141,22,1,"PAH",1,1,26,0)
customize the data provided by FDB for use in VistA.
"PKG",141,22,1,"PAH",1,1,27,0)
 
"PKG",141,22,1,"PAH",1,1,28,0)
The following three patient safety issues have also been addressed in 
"PKG",141,22,1,"PAH",1,1,29,0)
these patches:
"PKG",141,22,1,"PAH",1,1,30,0)
       Order Checks on PreMix IV Solutions (PSI-06-012)
"PKG",141,22,1,"PAH",1,1,31,0)
       Order Check display sequence changes (PSI-07-080)
"PKG",141,22,1,"PAH",1,1,32,0)
       Eliminating confusion in Inpatient Medications Order Check display 
"PKG",141,22,1,"PAH",1,1,33,0)
       and processing (PSI-07-080)
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
67
"RTN","PSO251PO")
0^48^B7870474
"RTN","PSO251PO",1,0)
PSO251PO ;BIR/RTR-Post Init for PSO*7*251 ;09/17/09
"RTN","PSO251PO",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**251**;DEC 1997;Build 202
"RTN","PSO251PO",3,0)
 ;
"RTN","PSO251PO",4,0)
 ;
"RTN","PSO251PO",5,0)
 D MNUADD D BMES^XPDUTL("Generating Mail Message....") D MAIL D BMES^XPDUTL("Mail message sent.")
"RTN","PSO251PO",6,0)
 Q
"RTN","PSO251PO",7,0)
 ;
"RTN","PSO251PO",8,0)
 ;
"RTN","PSO251PO",9,0)
MAIL ;Send mail message
"RTN","PSO251PO",10,0)
 N XMTEXT,XMY,XMSUB,XMDUZ,XMMG,XMSTRIP,XMROU,XMYBLOB,XMZ,XMDUN
"RTN","PSO251PO",11,0)
 S XMSUB="PSO*7*251 Installation Complete"
"RTN","PSO251PO",12,0)
 S XMDUZ="PSO*7*251 Install"
"RTN","PSO251PO",13,0)
 S XMTEXT="^TMP($J,""PSO125TX"","
"RTN","PSO251PO",14,0)
 I $G(DUZ) S XMY(DUZ)=""
"RTN","PSO251PO",15,0)
 S XMY("G.PSS ORDER CHECKS")=""
"RTN","PSO251PO",16,0)
 N DIFROM D ^XMD
"RTN","PSO251PO",17,0)
 K ^TMP($J,"PSO251TX")
"RTN","PSO251PO",18,0)
 Q
"RTN","PSO251PO",19,0)
 ;
"RTN","PSO251PO",20,0)
 ;
"RTN","PSO251PO",21,0)
MNUADD ;Add PSO ORDER CHECKS VERIFY to PSO MANAGER and PSO USER1 Menu options
"RTN","PSO251PO",22,0)
 N PSO251CT
"RTN","PSO251PO",23,0)
 S PSO251CT=1
"RTN","PSO251PO",24,0)
 K ^TMP($J,"PSO251TX")
"RTN","PSO251PO",25,0)
 S ^TMP($J,"PSO125TX",PSO251CT)="The installation of patch PSO*7.0*251 is complete."
"RTN","PSO251PO",26,0)
 D BMES^XPDUTL("Linking PSO ORDER CHECKS VERIFY Option....")
"RTN","PSO251PO",27,0)
 N PSOMNUA,PSOMNUAF
"RTN","PSO251PO",28,0)
 S PSOMNUAF=1
"RTN","PSO251PO",29,0)
 K PSOMNUA S PSOMNUA=$$ADD^XPDMENU("PSO MANAGER","PSO ORDER CHECKS VERIFY") I 'PSOMNUA D MNUADD1
"RTN","PSO251PO",30,0)
 K PSOMNUA S PSOMNUA=$$ADD^XPDMENU("PSO USER1","PSO ORDER CHECKS VERIFY") I 'PSOMNUA D MNUADD2
"RTN","PSO251PO",31,0)
 I PSOMNUAF D BMES^XPDUTL("All options linked successfully...")
"RTN","PSO251PO",32,0)
 Q
"RTN","PSO251PO",33,0)
 ;
"RTN","PSO251PO",34,0)
 ;
"RTN","PSO251PO",35,0)
MNUADD1 ;
"RTN","PSO251PO",36,0)
 S PSOMNUAF=0
"RTN","PSO251PO",37,0)
 D BMES^XPDUTL("Unable to link PSO ORDER CHECKS VERIFY to PSO MANAGER Menu Option...")
"RTN","PSO251PO",38,0)
 D INC S ^TMP($J,"PSO125TX",PSO251CT)="Unable to link PSO ORDER CHECKS VERIFY Option to PSO MANAGER Menu"
"RTN","PSO251PO",39,0)
 S PSO251CT=PSO251CT+1 S ^TMP($J,"PSO125TX",PSO251CT)="Please Log a Remedy Ticket and refer to this message."
"RTN","PSO251PO",40,0)
 Q
"RTN","PSO251PO",41,0)
 ;
"RTN","PSO251PO",42,0)
 ;
"RTN","PSO251PO",43,0)
MNUADD2 ;
"RTN","PSO251PO",44,0)
 S PSOMNUAF=0
"RTN","PSO251PO",45,0)
 D BMES^XPDUTL("Unable to link PSO ORDER CHECKS VERIFY to PSO USER1 Menu Option...")
"RTN","PSO251PO",46,0)
 D INC S ^TMP($J,"PSO125TX",PSO251CT)="Unable to link PSO ORDER CHECKS VERIFY Option to PSO USER1 Menu"
"RTN","PSO251PO",47,0)
 S PSO251CT=PSO251CT+1 S ^TMP($J,"PSO125TX",PSO251CT)="Please Log a Remedy Ticket and refer to this message."
"RTN","PSO251PO",48,0)
 Q
"RTN","PSO251PO",49,0)
 ;
"RTN","PSO251PO",50,0)
 ;
"RTN","PSO251PO",51,0)
INC ;
"RTN","PSO251PO",52,0)
 S PSO251CT=PSO251CT+1
"RTN","PSO251PO",53,0)
 S ^TMP($J,"PSO125TX",PSO251CT)=" "
"RTN","PSO251PO",54,0)
 S PSO251CT=PSO251CT+1
"RTN","PSO251PO",55,0)
 Q
"RTN","PSOAUTOC")
0^3^B66695978
"RTN","PSOAUTOC",1,0)
PSOAUTOC ;BIR/SAB - auto cancel rxs on admission ;08/15/94
"RTN","PSOAUTOC",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**3,24,30,36,88,146,132,223,148,249,324,251**;DEC 1997;Build 202
"RTN","PSOAUTOC",3,0)
 ;External reference to File #59.7 supported by DBIA 694
"RTN","PSOAUTOC",4,0)
 ;External reference to File #55 supported by DBIA 2228
"RTN","PSOAUTOC",5,0)
 ;External reference ^DPT(PSODFN,.1) supported by DBIA 10035
"RTN","PSOAUTOC",6,0)
 ;External reference ^DGPM("AMV1" supported by DBIA 2249
"RTN","PSOAUTOC",7,0)
 ;External reference ^DGPM("APTT1" supported by DBIA 2249
"RTN","PSOAUTOC",8,0)
 ;External reference ^PSDRUG( supported by DBIA 221
"RTN","PSOAUTOC",9,0)
 ;External reference ^PS(50.7 supported by DBIA 2223
"RTN","PSOAUTOC",10,0)
AUTO I '$P(^PS(59.7,1,40.1),"^") W $C(7),!,"Auto cancel System Parameter must be set to 'YES'",!,"before prescriptions are discontinued."
"RTN","PSOAUTOC",11,0)
 K %DT,DIC S DIC(0)="XZM",(DIE,DIC)="^DIC(19.2,",X="PSO AUTOCANCEL" D ^DIC
"RTN","PSOAUTOC",12,0)
 I +Y>0 D EDIT^XUTMOPT("PSO AUTOCANCEL") G EX
"RTN","PSOAUTOC",13,0)
 D RESCH^XUTMOPT("PSO AUTOCANCEL","","","24H","L"),EDIT^XUTMOPT("PSO AUTOCANCEL")
"RTN","PSOAUTOC",14,0)
EX K Y,C,D,D0,DI,DQ,DA,DIE,DR,DIC,X
"RTN","PSOAUTOC",15,0)
 Q
"RTN","PSOAUTOC",16,0)
TASK ;TaskMan entry point
"RTN","PSOAUTOC",17,0)
 G:'$P(^PS(59.7,1,40.1),"^") KILL S X="T-3" D ^%DT S PSOD2=Y,PSOD0=Y-.01,PSODL=Y+.3
"RTN","PSOAUTOC",18,0)
 S PSOD=PSOD0 F  S PSOD=$O(^DGPM("AMV1",PSOD)),PSODFN=0 Q:'PSOD!(PSOD>PSODL)  F PSODFN=0:0 S PSODFN=$O(^DGPM("AMV1",PSOD,PSODFN)) Q:'PSODFN  I $G(^DPT(PSODFN,.1))]"",$O(^PS(55,PSODFN,"P",0)),'$O(^DGPM("APTT1",PSODFN,PSOD)) D CAN
"RTN","PSOAUTOC",19,0)
 G KILL
"RTN","PSOAUTOC",20,0)
CAN ;discontinue Rxs
"RTN","PSOAUTOC",21,0)
 S DFN=PSODFN K VAIN D INP^VADPT I $P($G(VAIN(4)),"^"),$D(^PS(59.7,1,40.19,"B",$P($G(VAIN(4)),"^"))) Q
"RTN","PSOAUTOC",22,0)
 I $D(^PS(55,PSODFN,0)),$P($G(^PS(55,PSODFN,0)),U,6)'=2 D EN^PSOHLUP(PSODFN)
"RTN","PSOAUTOC",23,0)
 F PSORXJ=0:0 S PSORXJ=$O(^PS(55,PSODFN,"P",PSORXJ)) Q:'PSORXJ  I $D(^(PSORXJ,0)) S PSORX=^(0) D
"RTN","PSOAUTOC",24,0)
 .I $D(^PSRX(PSORX,0)) S PSO0=^(0),PSO2=$G(^(2)),STA=+^("STA") I STA<11,PSO2,$P(PSO2,"^",6)'<DT,$E(PSO2,1,7)'>PSOD2!(STA=16) D
"RTN","PSOAUTOC",25,0)
 ..S $P(^PSRX(PSORX,3),"^",5)=DT,$P(^("STA"),"^")=12,$P(^(7),"^")=1
"RTN","PSOAUTOC",26,0)
 ..D CHKCMOP^PSOUTL(PSORX,"A")
"RTN","PSOAUTOC",27,0)
 ..D REVERSE^PSOBPSU1(PSORX,,"DC",7)
"RTN","PSOAUTOC",28,0)
 ..D CAN^PSOTPCAN(PSORX)
"RTN","PSOAUTOC",29,0)
 ..D FIL^PSOCAN3
"RTN","PSOAUTOC",30,0)
 ..;remove from hold
"RTN","PSOAUTOC",31,0)
 ..I $G(^PSRX(PSORX,"H"))]"" D
"RTN","PSOAUTOC",32,0)
 ...K:$P(^PSRX(PSORX,"H"),"^") ^PSRX("AH",$P(^PSRX(PSORX,"H"),"^"),PSORX) S ^PSRX(PSORX,"H")=""
"RTN","PSOAUTOC",33,0)
 ...I '$P($G(^PSRX(PSORX,2)),"^",2),$P($G(^(3)),"^") S $P(^PSRX(PSORX,2),"^",2)=$P(^(3),"^")
"RTN","PSOAUTOC",34,0)
 ..;Add activity record
"RTN","PSOAUTOC",35,0)
 ..S ACNT=0 F SUB=0:0 S SUB=$O(^PSRX(PSORX,"A",SUB)) Q:'SUB  S ACNT=SUB
"RTN","PSOAUTOC",36,0)
 ..S RFCNT=0 F RF=0:0 S RF=$O(^PSRX(PSORX,1,RF)) Q:'RF  S RFCNT=RF S:RF>5 RFCNT=RF+1
"RTN","PSOAUTOC",37,0)
 ..D NOW^%DTC S ACNT=ACNT+1,^PSRX(PSORX,"A",0)="^52.3DA^"_ACNT_"^"_ACNT S ^PSRX(PSORX,"A",ACNT,0)=%_"^"_"C"_"^^"_RFCNT_"^"_"Auto Discontinued on Admission"
"RTN","PSOAUTOC",38,0)
 ..;delete from suspense
"RTN","PSOAUTOC",39,0)
 ..D:$O(^PS(52.5,"B",PSORX,0))
"RTN","PSOAUTOC",40,0)
 ...I $O(^PSRX(PSORX,1,0)) S DA=PSORX,SUSD=$P($G(^PS(52.5,$O(^PS(52.5,"B",PSORX,0)),0)),"^",2) D:'$G(^PS(52.5,$O(^PS(52.5,"B",PSORX,0)),"P")) REF^PSOCAN2
"RTN","PSOAUTOC",41,0)
 ...S DA=$O(^PS(52.5,"B",PSORX,0)),DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOAUTOC",42,0)
 ..;remove from non-verified file
"RTN","PSOAUTOC",43,0)
 ..I $G(^PS(52.4,PSORX,0))]"" S DIK="^PS(52.4,",DA=PSORX D ^DIK K DIK
"RTN","PSOAUTOC",44,0)
 ..S STAT="OD",PHARMST="",COM="Auto Discontinued on Admission" D EN^PSOHLSN1(PSORX,STAT,PHARMST,COM,"A")
"RTN","PSOAUTOC",45,0)
 ;auto-dc pending orders
"RTN","PSOAUTOC",46,0)
 ;F PSOIORD=0:0 S PSOIORD=$O(^PS(52.41,"AOR",PSODFN,PSOIORD)) Q:'PSOIORD  F PSORD=0:0 S PSORD=$O(^PS(52.41,"AOR",PSODFN,PSOIORD,PSORD)) Q:'PSORD  D
"RTN","PSOAUTOC",47,0)
 ;.I $P(^PS(52.41,PSORD,0),"^",3)="RF" S DA=PSORD,DIK="^PS(52.41," D ^DIK K DA,DIK Q
"RTN","PSOAUTOC",48,0)
 ;.K ^PS(52.41,"AOR",PSODFN,PSOIORD,PSORD) S $P(^PS(52.41,PSORD,0),"^",3)="DC"
"RTN","PSOAUTOC",49,0)
 ;.D EN^PSOHLSN(+^PS(52.41,PSORD,0),"OC","Auto Canceled on Admission","A")
"RTN","PSOAUTOC",50,0)
 K PSORD,PSOIORD
"RTN","PSOAUTOC",51,0)
 Q
"RTN","PSOAUTOC",52,0)
KILL K %,%H,%T,ACNT,DA,DFN,DIRUT,DTOUT,PSO,PSO0,PSO2,PSOD,PSOD0,PSOD2,PSODFN,PSODL,PSORX,PSORXJ,PSOSD,RF,RFCNT,SUB,TM,TSKDT,VAIN,X,X1,X2,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","PSOAUTOC",53,0)
 K ORD,PHARMST,STAT,COM S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOAUTOC",54,0)
 Q
"RTN","PSOAUTOC",55,0)
SETUP ;initialize nightly Rx cost compile job
"RTN","PSOAUTOC",56,0)
 K %DT,DIC,DTOUT S DIC(0)="XZM",DIC="^DIC(19.2,",X="PSO COSTDAY NIGHTJOB" D ^DIC
"RTN","PSOAUTOC",57,0)
 I +Y>0 D EDIT^XUTMOPT("PSO COSTDAY NIGHTJOB") G OUT
"RTN","PSOAUTOC",58,0)
 D RESCH^XUTMOPT("PSO COSTDAY NIGHTJOB","","","24H","L"),EDIT^XUTMOPT("PSO COSTDAY NIGHTJOB")
"RTN","PSOAUTOC",59,0)
OUT K Y,DIC,X,PSOTM,PSOOPTN,PSOPTN,%DT,DTOUT
"RTN","PSOAUTOC",60,0)
 Q
"RTN","PSOAUTOC",61,0)
 ;initialize management data compile job
"RTN","PSOAUTOC",62,0)
SETUP1 K %DT,DIC,DTOUT S DIC(0)="ZXM",DIC="^DIC(19.2,",X="PSO MGMT NIGHTLY COMPILE" D ^DIC
"RTN","PSOAUTOC",63,0)
 I +Y>0 D EDIT^XUTMOPT("PSO MGMT NIGHTLY COMPILE") G OUT
"RTN","PSOAUTOC",64,0)
 D RESCH^XUTMOPT("PSO MGMT NIGHTLY COMPILE","","","24H","L"),EDIT^XUTMOPT("PSO MGMT NIGHTLY COMPILE")
"RTN","PSOAUTOC",65,0)
 K Y,DIC,X,PSOTM,DIR,PSOOPTN,PSOPTN,%DT,DTOUT
"RTN","PSOAUTOC",66,0)
 Q
"RTN","PSOAUTOC",67,0)
APSOD(PSODFN) ;sends mail message that date of death has been deleted
"RTN","PSOAUTOC",68,0)
 I $G(PSODFN),$D(^PS(52.91,PSODFN,0)) D
"RTN","PSOAUTOC",69,0)
 .I $P(^PS(52.91,PSODFN,0),"^",3),$P(^(0),"^",4)=5 D
"RTN","PSOAUTOC",70,0)
 ..S $P(^PS(52.91,PSODFN,0),"^",3)="",$P(^PS(52.91,PSODFN,0),"^",4)=""
"RTN","PSOAUTOC",71,0)
 ..S ^PS(52.91,"AX",DT,PSODFN)=""
"RTN","PSOAUTOC",72,0)
 ..I $D(^PS(55,PSODFN,0)),$P($G(^PS(55,PSODFN,"PS")),"^")="" D
"RTN","PSOAUTOC",73,0)
 ...N PSORESPS,PSORESFG,PSORESF1 S PSORESFG=0 F PSORESPS=0:0 S PSORESPS=$O(^PS(53,PSORESPS)) Q:'PSORESPS!(PSORESFG)  D
"RTN","PSOAUTOC",74,0)
 ....S PSORESF1=$P($G(^PS(53,PSORESPS,0)),"^") S PSORESF1=$$UP^XLFSTR(PSORESF1) I PSORESF1="NON-VA" S $P(^PS(55,PSODFN,"PS"),"^")=PSORESPS,PSORESFG=1
"RTN","PSOAUTOC",75,0)
 N DI,DA,DR,DIE,DIC,X,Y
"RTN","PSOAUTOC",76,0)
 S ZTDTH=$H,ZTREQ="@",ZTSAVE("ZTREQ")="",ZTSAVE("PSODFN")="",ZTRTN="MAIL^PSOAUTOC",ZTDESC="Sends Mail Message that a Date of Death was Deleted",ZTIO="" D ^%ZTLOAD
"RTN","PSOAUTOC",77,0)
 Q
"RTN","PSOAUTOC",78,0)
MAIL ;builds mail message
"RTN","PSOAUTOC",79,0)
 S DIC=2,DA=PSODFN,DR=.351,DIQ="PTDOD" D EN^DIQ1 I PTDOD(2,DA,.351)]"" G EX1
"RTN","PSOAUTOC",80,0)
 K ^TMP("PSOHLD",$J),^TMP("PSOAD",$J),TOTRX,TOTPRX
"RTN","PSOAUTOC",81,0)
 F I=0:0 S I=$O(^PSRX("APSOD",PSODFN,I)) Q:'I  S TOTRX=$G(TOTRX)+1
"RTN","PSOAUTOC",82,0)
 F I=0:0 S I=$O(^PS(52.41,"APSOD",PSODFN,I)) Q:'I  S TOTPRX=$G(TOTPRX)+1
"RTN","PSOAUTOC",83,0)
 F I=0:0 S I=$O(^PS(55,PSODFN,"NVA","APSOD",I)) Q:'I  S TOTNVA=$G(TOTNVA)+1
"RTN","PSOAUTOC",84,0)
 K I Q:'$G(TOTRX)&('$G(TOTPRX))&('$G(TOTNVA))
"RTN","PSOAUTOC",85,0)
 S ENT=0,DFN=PSODFN D DEM^VADPT
"RTN","PSOAUTOC",86,0)
 S ENT=ENT+1,^TMP("PSOAD",$J,ENT)=$P(^DPT(PSODFN,0),"^")_" ID#: "_VA("PID")_" DOB: "_$P(VADM(3),"^",2)
"RTN","PSOAUTOC",87,0)
 S ENT=ENT+1,^TMP("PSOAD",$J,ENT)=" " S Y=DT D DD^%DT
"RTN","PSOAUTOC",88,0)
 S ENT=ENT+1,^TMP("PSOAD",$J,ENT)="This patient had a Date of Death deleted on "_Y_"."
"RTN","PSOAUTOC",89,0)
 S ENT=ENT+1,^TMP("PSOAD",$J,ENT)="When a Date of Death is entered ALL active prescriptions, pending orders, and",ENT=ENT+1,^TMP("PSOAD",$J,ENT)="Non-VA Meds are discontinued automatically. The following Outpatient"
"RTN","PSOAUTOC",90,0)
 S ENT=ENT+1,^TMP("PSOAD",$J,ENT)="Prescriptions and/or Pending Orders should be reviewed for this patient using",ENT=ENT+1,^TMP("PSOAD",$J,ENT)="the Patient Prescription Processing option."
"RTN","PSOAUTOC",91,0)
 S ENT=ENT+1,^TMP("PSOAD",$J,ENT)=" "
"RTN","PSOAUTOC",92,0)
 I $G(TOTRX) S ENT=ENT+1,^TMP("PSOAD",$J,ENT)="Total number of Prescriptions found for review is "_TOTRX D
"RTN","PSOAUTOC",93,0)
 .F I=0:0 S I=$O(^PSRX("APSOD",PSODFN,I)) Q:'I  S ^TMP("PSOHLD",$J,$P(^PSDRUG($P(^PSRX(I,0),"^",6),0),"^"),I)=I
"RTN","PSOAUTOC",94,0)
 .S DRG="" F  S DRG=$O(^TMP("PSOHLD",$J,DRG)) Q:DRG=""  F I=0:0 S I=$O(^TMP("PSOHLD",$J,DRG,I)) Q:'I  S RX=^TMP("PSOHLD",$J,DRG,I) D
"RTN","PSOAUTOC",95,0)
 ..S ENT=ENT+1,^TMP("PSOAD",$J,ENT)="Rx: "_$P(^PSRX(RX,0),"^")_"  Drug: "_DRG
"RTN","PSOAUTOC",96,0)
 N PSOLPI,PSOLPIX,PSOLPIST,PSOLPND
"RTN","PSOAUTOC",97,0)
 I $G(TOTPRX) S ENT=ENT+1,^TMP("PSOAD",$J,ENT)=" " D
"RTN","PSOAUTOC",98,0)
 .S ENT=ENT+1,^TMP("PSOAD",$J,ENT)="Total number of Pending Orders found and reinstated is "_TOTPRX
"RTN","PSOAUTOC",99,0)
 .F PSOLPI=0:0 S PSOLPI=$O(^PS(52.41,"APSOD",PSODFN,PSOLPI)) Q:'PSOLPI  D
"RTN","PSOAUTOC",100,0)
 ..S $P(^PS(52.41,PSOLPI,0),"^",3)=$P(^PS(52.41,PSOLPI,"DDSTA"),";"),^PS(52.41,"AOR",PSODFN,$P(^PS(52.41,PSOLPI,"DDSTA"),";",2),PSOLPI)=""
"RTN","PSOAUTOC",101,0)
 ..S PSOLPIX=$P($G(^PS(52.41,PSOLPI,0)),"^"),PSOLPIST=$P($G(^(0)),"^",3)
"RTN","PSOAUTOC",102,0)
 ..I PSOLPIX D
"RTN","PSOAUTOC",103,0)
 ...I PSOLPIST'="NW",PSOLPIST'="RNW",PSOLPIST'="RF" Q
"RTN","PSOAUTOC",104,0)
 ...;Reset remaining cross references
"RTN","PSOAUTOC",105,0)
 ...S PSOLPND=$G(^PS(52.41,PSOLPI,0))
"RTN","PSOAUTOC",106,0)
 ...I $P(PSOLPND,"^",12),$P(PSOLPND,"^",13) S ^PS(52.41,"ACL",$P(PSOLPND,"^",13),$P(PSOLPND,"^",12),PSOLPI)=""
"RTN","PSOAUTOC",107,0)
 ...I $P(^PS(52.41,PSOLPI,"INI"),"^"),$P(PSOLPND,"^",12) S ^PS(52.41,"AD",$P(PSOLPND,"^",12),$P(^PS(52.41,PSOLPI,"INI"),"^"),PSOLPI)=""
"RTN","PSOAUTOC",108,0)
 ...I PSOLPIST="RNW",$P(PSOLPND,"^",21) S ^PS(52.41,"AQ",$P(PSOLPND,"^",21),PSOLPI)=""
"RTN","PSOAUTOC",109,0)
 ...I PSOLPIST="RF" Q
"RTN","PSOAUTOC",110,0)
 ...;Update CPRS with Pending order information on new and renewals
"RTN","PSOAUTOC",111,0)
 ...D EN^PSOHLSN(PSOLPIX,"SC","IP")
"RTN","PSOAUTOC",112,0)
 ..K ^PS(52.41,"APSOD",PSODFN,PSOLPI),ORTYP
"RTN","PSOAUTOC",113,0)
 ..S ENT=ENT+1,ORTYP=$P(^PS(52.41,PSOLPI,0),"^",3)
"RTN","PSOAUTOC",114,0)
 ..S MED=$S($P(^PS(52.41,PSOLPI,0),"^",9):$P(^PSDRUG($P(^PS(52.41,PSOLPI,0),"^",9),0),"^"),1:$P(^PS(50.7,$P(^PS(52.41,PSOLPI,0),"^",8),0),"^"))
"RTN","PSOAUTOC",115,0)
 ..I $G(MED)']"" S MED="NO DRUG OR ORDERABLE ITEM FOUND"
"RTN","PSOAUTOC",116,0)
 ..S ^TMP("PSOAD",$J,ENT)=$S(ORTYP="RF":"Refill",ORTYP="RNW":"Renew",ORTYP="HD":"On Hold",1:"New")_" Order Request  -  "
"RTN","PSOAUTOC",117,0)
 ..S ^TMP("PSOAD",$J,ENT)=^TMP("PSOAD",$J,ENT)_"Medication: "_MED
"RTN","PSOAUTOC",118,0)
 I $G(TOTNVA) S ENT=ENT+1,^TMP("PSOAD",$J,ENT)=" " D
"RTN","PSOAUTOC",119,0)
 .N PSODD,MED,PSOOI,PSONVA,NVA S ENT=ENT+1,^TMP("PSOAD",$J,ENT)="Total number of Non-VA Med Orders found and reinstated is "_TOTNVA
"RTN","PSOAUTOC",120,0)
 .F NVA=0:0 S NVA=$O(^PS(55,PSODFN,"NVA","APSOD",NVA)) Q:'NVA  D
"RTN","PSOAUTOC",121,0)
 ..S PSOOI=$P(^PS(55,PSODFN,"NVA",NVA,0),"^"),PSODD=$P(^(0),"^",2),PLACER=$P(^(0),"^",8),LOCATION=$P(^(0),"^",12),DFN=PSODFN
"RTN","PSOAUTOC",122,0)
 ..S MED=$S(PSODD:$P($G(^PSDRUG(PSODD,0)),"^"),1:$P(^PS(50.7,+PSOOI,0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,+PSOOI,0),"^",2),0),"^"))
"RTN","PSOAUTOC",123,0)
 ..S $P(^PS(55,PSODFN,"NVA",NVA,0),"^",6)="",$P(^(0),"^",7)="" K ^PS(55,PSODFN,"NVA","APSOD",NVA)
"RTN","PSOAUTOC",124,0)
 ..S ENT=ENT+1,^TMP("PSOAD",$J,ENT)="Non-VA "_MED,REIN=1,PSONVA=NVA D REIN^PSONVNEW
"RTN","PSOAUTOC",125,0)
 ..K PSOOI,PSODD,PLACER,LOCATION,MED,REIN
"RTN","PSOAUTOC",126,0)
 S XMDUZ=.5,XMSUB="Date of Death Deleted for "_$P(^DPT(PSODFN,0),"^")_" ("_VA("BID")_")",XMTEXT="^TMP(""PSOAD"",$J," N DIFROM
"RTN","PSOAUTOC",127,0)
 F I=0:0 S I=$O(^XUSEC("PSORPH",I)) Q:'I  S XMY(I)=""
"RTN","PSOAUTOC",128,0)
 D ^XMD
"RTN","PSOAUTOC",129,0)
EX1 K ^TMP("PSOHLD",$J),XMSUB,XMTEXT,XMY,XMDUZ,^TMP("PSOAD",$J),I,TOTRX,TOTPRX,PSODFN,ENT,ORTYP,X,Y,MED,RX,PTDOD
"RTN","PSOAUTOC",130,0)
 Q
"RTN","PSOBUILD")
0^67^B42733386
"RTN","PSOBUILD",1,0)
PSOBUILD ;IHS/DSD/JCM - BUILD ARRAY OF PATIENTS CURRENT MEDS  [ 07/15/96  5:25 PM ] ;6/21/07 8:20am
"RTN","PSOBUILD",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**23,82,119,132,235,206,251**;DEC 1997;Build 202
"RTN","PSOBUILD",3,0)
 ;External reference ^PS(50.606 supported by DBIA 2174
"RTN","PSOBUILD",4,0)
 ;External reference ^PS(50.7 supported by DBIA 2223
"RTN","PSOBUILD",5,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOBUILD",6,0)
 ;External reference ^PSDRUG( supported by DBIA 221
"RTN","PSOBUILD",7,0)
 ; Input variables: PSODFN,DT,PSODTCUT
"RTN","PSOBUILD",8,0)
START N ORD K PSOSD I '$D(PSODFN)!('$D(DT)) G END
"RTN","PSOBUILD",9,0)
 D EOJ,INIT G:PSOQFLG END D BUILD
"RTN","PSOBUILD",10,0)
 S STA="ACTIVE^NON-VERIFIED^REFILL^HOLD^NON-VERIFIED^ACTIVE^^^^^^ACTIVE^DISCONTINUED^^DISCONTINUED^DISCONTINUED^HOLD"
"RTN","PSOBUILD",11,0)
 S DRG="" F I=0:0 S DRG=$O(PSOSD(DRG)) Q:DRG=""  I $G(PSOSD(DRG))]"" S PSOSD($P(STA,"^",$P(PSOSD(DRG),"^",2)+1),DRG)=PSOSD(DRG) D  K PSOSD(DRG)
"RTN","PSOBUILD",12,0)
 .S $P(PSOSD($P(STA,"^",$P(PSOSD(DRG),"^",2)+1),DRG),"^",9)=$G(^TMP("PS",$J,$P(STA,"^",$P(PSOSD(DRG),"^",2)+1),DRG))
"RTN","PSOBUILD",13,0)
 F PEN=0:0 S PEN=$O(^PS(52.41,"P",PSODFN,PEN)) Q:'PEN  S ORD=^PS(52.41,PEN,0),PSOOI=$P(ORD,"^",8),PSODD=+$P(ORD,"^",9) D:$P(ORD,"^",3)'="DC"&($P(ORD,"^",3)'="DE")&($P(ORD,"^",3)'="HD")
"RTN","PSOBUILD",14,0)
 .I 'PSODD N ZPSI,ZPSDC S (ZPSDC,ZPSI)=0 I $G(PSOOI) D
"RTN","PSOBUILD",15,0)
 ..F  S ZPSI=$O(^PSDRUG("ASP",PSOOI,ZPSI)) Q:'ZPSI  I $S('$D(^PSDRUG(ZPSI,"I")):1,'^("I"):1,DT'>^("I"):1,1:0),$S($P($G(^PSDRUG(ZPSI,2)),"^",3)'["O":0,1:1) S ZPSDC=ZPSDC+1,ZPSDC(ZPSDC)=ZPSI
"RTN","PSOBUILD",16,0)
 ..I ZPSDC=1 S PSODD=ZPSDC(1),$P(^PS(52.41,PEN,0),"^",9)=ZPSDC(1)
"RTN","PSOBUILD",17,0)
 .K ZPSI,ZPSDC
"RTN","PSOBUILD",18,0)
 .S DRG=$S(PSODD:$P($G(^PSDRUG(PSODD,0)),"^"),+PSOOI&('PSODD):$P(^PS(50.7,+PSOOI,0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,+PSOOI,0),"^",2),0),"^"),1:"") Q:DRG']""
"RTN","PSOBUILD",19,0)
 .I $D(PSOSD("PENDING",DRG)) S DRG=DRG_"^"_PEN
"RTN","PSOBUILD",20,0)
 .S PSOSD("PENDING",DRG)="*****^17^Z^Z^"_$S(PSODD:$P(^PSDRUG(PSODD,0),"^",2),1:"")_"^"_$P(^PS(52.41,PEN,0),"^",11)_"^"_$S($G(^PSDRUG(PSODD,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:"")
"RTN","PSOBUILD",21,0)
 .S PSOSD("PENDING",DRG)=PSOSD("PENDING",DRG)_"^"_$P(ORD,"^",10)_"^"_$P(ORD,"^",6)_"^"_PEN_"^"_$S($G(PSODD):$G(PSODD),1:""),PSOSD=+$G(PSOSD)+1 K PSOOI,PSODD
"RTN","PSOBUILD",22,0)
 F NVA=0:0 S NVA=$O(^PS(55,PSODFN,"NVA",NVA)) Q:'NVA  S NON=^PS(55,PSODFN,"NVA",NVA,0) D:'$P(^PS(55,PSODFN,"NVA",NVA,0),"^",7)
"RTN","PSOBUILD",23,0)
 .S PSODD=$P(NON,"^",2),PSOOI=$P(NON,"^")
"RTN","PSOBUILD",24,0)
 .S DRG=$S(PSODD:$P($G(^PSDRUG(PSODD,0)),"^"),+PSOOI&('PSODD):$P(^PS(50.7,+PSOOI,0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,+PSOOI,0),"^",2),0),"^"),1:"")
"RTN","PSOBUILD",25,0)
 .I $D(PSOSD("ZNONVA",DRG)) S DRG=DRG_"^"_NVA
"RTN","PSOBUILD",26,0)
 .S PSOSD("ZNONVA",DRG)="****^9^Z^Z^"_$S($P(NON,"^",2):$P(^PSDRUG($P(NON,"^",2),0),"^",2),1:"")_"^"_$P(NON,"^",3)_"^^"_$P(NON,"^",5)_"^"_$P(NON,"^",10)_"^"_NVA_"^"_$P(NON,"^",2)
"RTN","PSOBUILD",27,0)
 .I $P(NON,"^",2) S $P(PSOSD("ZNONVA",DRG),"^",7)=$S($G(^PSDRUG(PSODD,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:"")
"RTN","PSOBUILD",28,0)
 .S PSOSD=+$G(PSOSD)+1
"RTN","PSOBUILD",29,0)
END D EOJ
"RTN","PSOBUILD",30,0)
 Q
"RTN","PSOBUILD",31,0)
INIT ;
"RTN","PSOBUILD",32,0)
 K PSOSD,PSOMED S PSOQFLG=0,U="^",PSOBUILD("COUNT")=0 G:$D(PSODTCUT) INITX
"RTN","PSOBUILD",33,0)
 I '$D(^PS(53,"B","OUTPATIENT")) S PSOQFLG=1 G INITX
"RTN","PSOBUILD",34,0)
 S PSOX=$O(^PS(53,"B","OUTPATIENT","")) I 'PSOX S PSOQFLG=1 G INITX
"RTN","PSOBUILD",35,0)
 ;S DAYS=$S($D(DAYS360):360,1:45),X2=-$S($P($G(^PS(53,PSOX,0)),"^",3)+15>DAYS:$P($G(^(0)),"^",3)+15,1:DAYS),X1=DT D C^%DTC S PSODTCUT=X
"RTN","PSOBUILD",36,0)
 S X2=-120,X1=DT D C^%DTC S PSODTCUT=X
"RTN","PSOBUILD",37,0)
INITX K X,X1,X2,PSOX
"RTN","PSOBUILD",38,0)
 Q
"RTN","PSOBUILD",39,0)
 ;
"RTN","PSOBUILD",40,0)
BUILD ;build profiles
"RTN","PSOBUILD",41,0)
 F PSOEXPDT=(PSODTCUT-1):0 S PSOEXPDT=$O(^PS(55,PSODFN,"P","A",PSOEXPDT)) Q:'PSOEXPDT  F PSOBUILD("RX")=0:0 S PSOBUILD("RX")=$O(^PS(55,PSODFN,"P","A",PSOEXPDT,PSOBUILD("RX"))) Q:'PSOBUILD("RX")  I $D(^PSRX(PSOBUILD("RX"),0)) D GET
"RTN","PSOBUILD",42,0)
BUILDX I PSOBUILD("COUNT")>0 S PSOSD=PSOBUILD("COUNT")
"RTN","PSOBUILD",43,0)
 Q
"RTN","PSOBUILD",44,0)
GET ;data for profiles
"RTN","PSOBUILD",45,0)
 Q:'$P(^PSRX(PSOBUILD("RX"),0),"^",2)
"RTN","PSOBUILD",46,0)
 S (PSOSTF,PSOSTN)="",PSORX0=^PSRX(PSOBUILD("RX"),0),PSOST0=+^PSRX(PSOBUILD("RX"),"STA"),$P(PSORX0,"^",15)=PSOST0
"RTN","PSOBUILD",47,0)
 G:PSOST0=13 GETX S PSORX2=$G(^PSRX(PSOBUILD("RX"),2))
"RTN","PSOBUILD",48,0)
 S PSORX3=$G(^PSRX(PSOBUILD("RX"),3)) S:PSORX3="" PSORX3=$P(PSORX2,"^",2)
"RTN","PSOBUILD",49,0)
 S PSODRG=+$P(PSORX0,"^",6) G:'$D(^PSDRUG(PSODRG,0)) GETX S PSODRUG0=^PSDRUG(PSODRG,0),PSOVACL=$P(PSODRUG0,"^",2),PSODYS=$P(PSORX0,"^",8)
"RTN","PSOBUILD",50,0)
 ;
"RTN","PSOBUILD",51,0)
 I PSOST0<12!(PSOST0=16),PSOEXPDT<DT D:$P(PSORX0,"^",15)'=11
"RTN","PSOBUILD",52,0)
 .S PSOST0=11,$P(PSORX0,"^",15)=11 N DIE,DIC,DR,DA,PSOBEXDA S DIE=52,(DA,PSOBEXDA)=PSOBUILD("RX"),DR="100////11" D ^DIE K DIE,DIC,DR
"RTN","PSOBUILD",53,0)
 .D ECAN^PSOUTL(DA) K DA
"RTN","PSOBUILD",54,0)
 .S STAT="SC",PHARMST="ZE",COMM="Medication Expired on "_$E(PSOEXPDT,4,5)_"/"_$E(PSOEXPDT,6,7)_"/"_$E(PSOEXPDT,2,3) D EN^PSOHLSN1(PSOBEXDA,STAT,PHARMST,COMM) K COMM,STAT,PHARMST,PSOBEXDA
"RTN","PSOBUILD",55,0)
 I PSOST0=12,PSOEXPDT<DT S PSOST0=12
"RTN","PSOBUILD",56,0)
 I PSOST0=5 D  G GT1
"RTN","PSOBUILD",57,0)
 .I $O(^PS(52.5,"B",PSOBUILD("RX"),0)),'$D(^PS(52.5,+$O(^(0)),0)) D  Q
"RTN","PSOBUILD",58,0)
 ..S PSOST0=0 D FSTA
"RTN","PSOBUILD",59,0)
 ..K ^PS(52.5,"B",PSOBUILD("RX"),$O(^PS(52.5,"B",PSOBUILD("RX"),0)))
"RTN","PSOBUILD",60,0)
 .I '$O(^PS(52.5,"B",PSOBUILD("RX"),0)) S PSOST0=0 D FSTA
"RTN","PSOBUILD",61,0)
 I 'PSOST0 D STAT
"RTN","PSOBUILD",62,0)
GT1 G GETX:$D(NOEXP)&(PSOST0=11)
"RTN","PSOBUILD",63,0)
 I $D(^PSDRUG(PSODRG,"I")),^("I")]"",DT>^("I") S PSOSTN=PSOSTN_"A" I $P($G(PSOPAR),"^",11)']"" S PSOSTF=PSOSTF_"A"
"RTN","PSOBUILD",64,0)
 S PSONDF=$S($G(^PSDRUG(PSODRG,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)
"RTN","PSOBUILD",65,0)
 I $P($G(^PSDRUG(PSODRG,2)),"^",3)'["O" S PSOSTN=PSOSTN_"M"
"RTN","PSOBUILD",66,0)
 S CLOZPT=$S($P($G(^PSDRUG(PSODRG,"CLOZ1")),"^")="PSOCLO1":1,1:0)
"RTN","PSOBUILD",67,0)
 I 'CLOZPT,($P(PSODRUG0,"^",3)["A")&($P(PSODRUG0,"^",3)'["B") S PSOSTN=PSOSTN_"B",PSOSTF=PSOSTF_"B"
"RTN","PSOBUILD",68,0)
 K CLOZPT I ($P(PSODRUG0,"^",3)["W")!($P(PSODRUG0,"^",3)[1)!($P(PSODRUG0,"^",3)[2) S PSOSTN=PSOSTN_"C"
"RTN","PSOBUILD",69,0)
 I $D(^PS(53,+$P(PSORX0,"^",3),0)),'$P(^(0),"^",5) S PSOSTN=PSOSTN_"D"
"RTN","PSOBUILD",70,0)
 I PSOST0=1 S PSOSTN=PSOSTN_"E"
"RTN","PSOBUILD",71,0)
 S PSOLC=$P(PSORX0,"^"),PSOLC=$E(PSOLC,$L(PSOLC)) I $A(PSOLC)>90 S PSOSTN=PSOSTN_"F"
"RTN","PSOBUILD",72,0)
 I PSOST0,PSOST0'=2,PSOST0'=6 S PSOSTF=PSOSTF_"Z"
"RTN","PSOBUILD",73,0)
 I $G(PSORX("BAR CODE")),PSOST0,PSOST0'=2,PSOST0'=5,PSOST0'=6,PSOST0'=11,PSOST0'=12 S PSOSTN=PSOSTN_"Z" G BARC
"RTN","PSOBUILD",74,0)
 I PSOST0,PSOST0'=2,PSOST0'=5,PSOST0'=6,PSOST0'=11,PSOST0'=12,PSOST0'=14 S PSOSTN=PSOSTN_"Z"
"RTN","PSOBUILD",75,0)
BARC S PSORFRM=$P(PSORX0,"^",9) F PSOJ=0:0 S PSOJ=$O(^PSRX(PSOBUILD("RX"),1,PSOJ)) Q:'PSOJ  S PSORFRM=PSORFRM-1
"RTN","PSOBUILD",76,0)
 S:PSORFRM<0 PSORFRM=0 S:PSORFRM=0 PSOSTF=PSOSTF_"G"
"RTN","PSOBUILD",77,0)
 S PSODRUGN=$P(PSODRUG0,"^") I $D(PSOSD(PSODRUGN)),PSOST0>10 Q:$P(PSOSD(PSODRUGN),"^",2)<11  Q:$P(PSOSD(PSODRUGN),"^",2)>10&($P(PSORX0,"^",13)<$P(^PSRX(+$P(PSOSD(PSODRUGN),"^"),0),"^",13))
"RTN","PSOBUILD",78,0)
 S:'$D(PSOSD(PSODRUGN)) PSOBUILD("COUNT")=PSOBUILD("COUNT")+1
"RTN","PSOBUILD",79,0)
 I $D(PSOSD(PSODRUGN)),$P(PSOSD(PSODRUGN),"^",2)<10,PSOST0<10 S PSOSD(PSODRUGN_"^"_PSOBUILD("RX"))=PSOBUILD("RX")_"^"_PSOST0_"^"_PSOSTN_"^"_PSOSTF_"^"_PSOVACL_"^"_PSORFRM_"^"_PSONDF_"^"_PSODYS,PSOBUILD("COUNT")=PSOBUILD("COUNT")+1
"RTN","PSOBUILD",80,0)
 E  S PSOSD(PSODRUGN)=PSOBUILD("RX")_"^"_PSOST0_"^"_PSOSTN_"^"_PSOSTF_"^"_PSOVACL_"^"_PSORFRM_"^"_PSONDF_"^"_PSODYS
"RTN","PSOBUILD",81,0)
GETX Q
"RTN","PSOBUILD",82,0)
STAT N X S X=+$O(^PS(52.5,"B",PSOBUILD("RX"),0))
"RTN","PSOBUILD",83,0)
 I X,$D(^PS(52.5,X,0)),$P($G(^PS(52.5,X,0)),"^",7)'="X",'$G(^PS(52.5,X,"P")) S PSOST0=5
"RTN","PSOBUILD",84,0)
 I PSOST0 D FSTA
"RTN","PSOBUILD",85,0)
 Q
"RTN","PSOBUILD",86,0)
FSTA S $P(PSORX0,"^",15)=PSOST0
"RTN","PSOBUILD",87,0)
 N DIE,DR,DA S DIE=52,DA=PSOBUILD("RX"),DR="100////"_PSOST0 D ^DIE K DIE,DR,DA
"RTN","PSOBUILD",88,0)
 Q
"RTN","PSOBUILD",89,0)
 ;
"RTN","PSOBUILD",90,0)
EOJ K ORD,PSOX,PSOEXPDT,PSODRG,PSODRUG0,PSOLC,PSONDF,PSOQFLG,PSORFRM,PSORX0,PSORX2,PSORX3,PSOST0,PSOSTF,PSOSTN,PSOJ,PSODRUGN,PSOVACL,PSOBUILD,PSODYS,PEN,DRG,NON,NVA
"RTN","PSOBUILD",91,0)
 Q
"RTN","PSOBUILD",92,0)
INPAT(PSODFN) ;entry point for inpat meds to view patient's outpat. meds
"RTN","PSOBUILD",93,0)
 D FULL^VALM1
"RTN","PSOBUILD",94,0)
 S INPAT=1,X2=-120,X1=DT D C^%DTC S PSODTCUT=X D START,^PSODSPL
"RTN","PSOBUILD",95,0)
 K PSOSD,DDH,PSCNT,PSOCT,PSODD,PSOOI,PSOPAR,PSOSTA,STP,STR,PSODTCUT,PSODFN,INPAT,DRG
"RTN","PSOBUILD",96,0)
 Q
"RTN","PSOCAN")
0^59^B49079548
"RTN","PSOCAN",1,0)
PSOCAN ;BIR/JMB-Rx discontinue and reinstate ;8/3/06 12:38pm
"RTN","PSOCAN",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,21,24,27,32,37,88,117,131,185,253,251**;DEC 1997;Build 202
"RTN","PSOCAN",3,0)
 ;External reference to File #55 supported by DBIA 2228
"RTN","PSOCAN",4,0)
 ;External references L, UL, PSOL, and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOCAN",5,0)
START S WARN=0,(DAYS360,SPCANC)=1 D KCAN1^PSOCAN3 W !! S DIR("A")="Discontinue/Reinstate by Rx# or patient name",DIR(0)="SBO^R:RX NUMBER;P:PATIENT NAME"
"RTN","PSOCAN",6,0)
 S DIR("?")="Enter 'R' to discontinue/reinstate by Rx#.  Enter 'P' to discontinue/reinstate by patient name." D ^DIR K DIR
"RTN","PSOCAN",7,0)
 G:$G(DIRUT) KILL^PSOCAN1 K RP S RP=Y G:RP="P" PAT^PSOCAN1
"RTN","PSOCAN",8,0)
NUM D DCORD^PSONEW2
"RTN","PSOCAN",9,0)
 K RXSP,PSINV,PSOWUN,PSOULRX D KCAN1^PSOCAN3 S:'$D(PSOCLC) PSOCLC=DUZ S PS="Discontinue" W ! S DIR("A")="Discontinue/Reinstate Prescription(s)#"
"RTN","PSOCAN",10,0)
 S DIR(0)="FO^1:245",DIR("?")="Wand/enter barcode or enter Rx number(s) to discontinued/reinstated. If more than one, separate with commas. Do not exceed 245 characters including commas"
"RTN","PSOCAN",11,0)
 D ^DIR K DIR G:$G(DIRUT) START S OUT=0 I Y["-" D PSOINST^PSOSUPAT G:OUT NUM S (IN,X)=$P(^PSRX($P(Y,"-",2),0),"^") G NO
"RTN","PSOCAN",12,0)
 S IN=Y G RX:Y[","
"RTN","PSOCAN",13,0)
NO I '$O(^PSRX("B",Y,0)) W " Rx Not Found!",! G NUM
"RTN","PSOCAN",14,0)
 S PSPOP=0,DIC=52,DIC(0)="QEMZ" D ^DIC K DIC Q:$G(POERR)&(Y<0)
"RTN","PSOCAN",15,0)
 G:Y<0 NUM S (DA,IFN,PSOULRX)=+Y,RXNUM=Y(0,0),PSODFN=+$P(^PSRX(DA,0),"^",2)
"RTN","PSOCAN",16,0)
 S PSOWUN=1 S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY K PSOPLCK G NUM
"RTN","PSOCAN",17,0)
 K PSOPLCK D PSOL^PSSLOCK(IFN) I '$G(PSOMSG) W !!,$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order.") K PSOMSG D ULP G NUM
"RTN","PSOCAN",18,0)
 I $P($G(^PSRX(+$G(IFN),"STA")),"^")=12,$P($G(^("PKI")),"^") W !!,"Cannot be Reinstated - Digitally Signed" D ULP G NUM
"RTN","PSOCAN",19,0)
 I $P($G(^PSRX(+$G(IFN),"STA")),"^")=12 S PSOCANRZ=1
"RTN","PSOCAN",20,0)
 E  S PSOCANRD=+$P($G(^PSRX(+$G(IFN),0)),"^",4)
"RTN","PSOCAN",21,0)
 D:$P($G(^PS(55,PSODFN,0)),"^",6)'=2 EN^PSOHLUP(PSODFN)
"RTN","PSOCAN",22,0)
LMNO D CHK S:'$G(DA)&($G(IFN)) DA=IFN
"RTN","PSOCAN",23,0)
 I DEAD!$P(^PSRX(DA,"STA"),"^")'<13,$P(^("STA"),"^")'=16 S PSINV($P(^PSRX(DA,0),"^"))="" D:$G(PSOWUN) ULP,ULRX G EP1
"RTN","PSOCAN",24,0)
 I $G(PSODIV),$P($G(^PSRX(DA,2)),"^",9),$P(^(2),"^",9)'=$G(PSOSITE) S RXREC=DA D DIV D:$G(POERR)&(PSPOP) ULP,ULRX Q:$G(POERR)&(PSPOP)  D:$G(PSOWUN)&($G(PSPOP)) ULP,ULRX G:PSPOP NUM
"RTN","PSOCAN",25,0)
 D ICN^PSODPT(PSODFN)
"RTN","PSOCAN",26,0)
 S PS=$S($P(^PSRX(DA,"STA"),"^")=12:"Reinstate",1:"Discontinue")
"RTN","PSOCAN",27,0)
 I '$G(POERR) N PKIR D
"RTN","PSOCAN",28,0)
 .I $P(^PSRX(DA,"STA"),"^")=1,$P($G(^("PKI")),"^") S PKIR=""
"RTN","PSOCAN",29,0)
 .D ^PSORXPR
"RTN","PSOCAN",30,0)
 D YN S:PS="Reinstate" PS="Discontinue" Q:$G(POERR)&('%)
"RTN","PSOCAN",31,0)
 I '% D ULP,ULRX G NUM
"RTN","PSOCAN",32,0)
 D REA D:'$D(REA)&($G(PSOWUN)) ULP,ULRX Q:'$D(REA)
"RTN","PSOCAN",33,0)
 D COM^PSOCAN1 Q:$G(POERR)&('$D(INCOM))!($D(DIRUT))  I '$D(INCOM)!($D(DIRUT)) D ULP,ULRX G NUM
"RTN","PSOCAN",34,0)
 S RX=$P(^PSRX(DA,0),"^"),PSCAN(RX)=DA_"^"_REA
"RTN","PSOCAN",35,0)
 D:REA="R" REINS^PSOCAN2
"RTN","PSOCAN",36,0)
 I REA="R",'$G(PSORX("DFLG")) D DCORD^PSONEW2
"RTN","PSOCAN",37,0)
 D:$G(PSORX("DFLG")) ULP,ULRX
"RTN","PSOCAN",38,0)
 Q:$G(POERR)&($G(PSORX("DFLG")))
"RTN","PSOCAN",39,0)
 G NUM:$G(PSORX("DFLG"))
"RTN","PSOCAN",40,0)
 D:REA="C" CAN
"RTN","PSOCAN",41,0)
 Q:$G(POERR)
"RTN","PSOCAN",42,0)
 D ULP,ULRX G NUM
"RTN","PSOCAN",43,0)
YN D EN^PSOCMOPA I $G(XFLAG)]"" S %=0 K XFLAG Q
"RTN","PSOCAN",44,0)
 W ! S DIR("A")="Are you sure you want to "_PS,DIR(0)="Y",DIR("B")="NO" D ^DIR S %=Y K DIR,DUOUT,DTOUT I 'Y!$D(DIRUT) S VALMBCK="R"
"RTN","PSOCAN",45,0)
 K DIRUT Q
"RTN","PSOCAN",46,0)
REA S REA=+$P(^PSRX(DA,"STA"),"^") I REA=12 S REA="R" Q
"RTN","PSOCAN",47,0)
 I REA,REA'=11 W !?5,$C(7) D
"RTN","PSOCAN",48,0)
 .W "Rx# "_RXNUM_" was"_$S(REA=1:" Non-Verified",REA=13:" Deleted",REA=11:" Expired",REA=5:" Suspended",REA=4:" Pending Due to Drug Interactions",REA=3:" On Hold",REA=14!(REA=15):"Discontinued",REA=16:" Provider Held",1:" In Fill Status")_"."
"RTN","PSOCAN",49,0)
 I REA,REA'=1,REA'=3,REA'=5,REA'=11,REA'<13,REA'=16 K REA W !?10,"Rx Cannot Be Discontinued/Reinstated!" Q
"RTN","PSOCAN",50,0)
 S REA="C" Q
"RTN","PSOCAN",51,0)
CAN N PSODRUG D CAN1^PSOCAN3 Q
"RTN","PSOCAN",52,0)
DIV I '$P($G(PSOSYS),"^",2) W !?10,$C(7),"RX# ",$P(^PSRX(DA,0),"^")," is not a valid choice.  (Different Division)" S PSPOP=1 Q
"RTN","PSOCAN",53,0)
 I $P($G(PSOSYS),"^",3) W !?10,$C(7) S DIR("A")="RX# "_$P(^PSRX(DA,0),"^")_" is from another division.  Continue",DIR(0)="Y",DIR("B")="Y" D ^DIR K DIR S:$G(DIRUT)!('Y) PSPOP=1
"RTN","PSOCAN",54,0)
 Q
"RTN","PSOCAN",55,0)
CHK K VADM,DEAD S DFN=PSODFN D DEM^VADPT I $G(VADM(6))="" S DEAD=0 Q
"RTN","PSOCAN",56,0)
 S (PSODEATH,DEAD)=1 W !!,?10,VADM(1)_" DIED "_$P($G(VADM(6)),"^",2) D CAN^PSOCAN3 K PSODEATH
"RTN","PSOCAN",57,0)
 Q
"RTN","PSOCAN",58,0)
RX N PKI S RXCNT=0,RXSP=1 D TESTRP D COM^PSOCAN1 G:'$D(INCOM)!($D(DIRUT)) NUM K PSINV,PSCAN F II=1:1 S (EN,X)=$P(IN,",",II) Q:$P(IN,",",II)']""  S DIC=52,DIC(0)="QMZ" D ^DIC K DIC S:Y'>0 PSINV(X)="" D:Y>0
"RTN","PSOCAN",59,0)
 .S YY=Y,YY(0,0)=Y(0,0),(PSODFN,DFN)=$P(Y(0),"^",2) D:$P($G(^PS(55,PSODFN,0)),"^",6)'=2 EN^PSOHLUP(PSODFN)
"RTN","PSOCAN",60,0)
 .D:$G(DFN)>0 CHK I DEAD!($P(^PSRX(+YY,"STA"),"^")=13)!($P(^("STA"),"^")=14) S PSINV(EN)="" Q
"RTN","PSOCAN",61,0)
 .I $P(^PSRX(+YY,"STA"),"^")=12,$P($G(^("PKI")),"^") S PKI=1,PSINV(EN)="" Q
"RTN","PSOCAN",62,0)
 .S DA=+YY I $P($G(^PSRX(DA,"STA")),"^")=11!($P($G(^(2)),"^",6)<DT) D EXP
"RTN","PSOCAN",63,0)
 .S RX=YY(0,0) D:$D(^PSRX(DA,0)) SPEED1^PSOCAN1
"RTN","PSOCAN",64,0)
 .;S DA=+YY I $P($G(^PSRX(DA,"STA")),"^")=11!($P($G(^(2)),"^",6)<DT) D EXP Q
"RTN","PSOCAN",65,0)
 .;E  S RX=YY(0,0) D:$D(^PSRX(DA,0)) SPEED1^PSOCAN1
"RTN","PSOCAN",66,0)
 K YY G:'$D(PSCAN) INVALD^PSOCAN1 S RX="",RXCNT=0 F  S RX=$O(PSCAN(RX)) Q:RX=""  S DA=+PSCAN(RX),REA=$P(PSCAN(RX),"^",2),RXCNT=RXCNT+1  D SHOW^PSOCAN1
"RTN","PSOCAN",67,0)
ASK Q:'$D(PSCAN)  W ! S DIR("A")="OK to "_$S($G(RXCNT)>1:"Change Status",REA="C":"Discontinued",1:"Reinstate"),DIR(0)="Y",DIR("B")="N"
"RTN","PSOCAN",68,0)
 N PSOCNRXV S PSOCNRXV=0
"RTN","PSOCAN",69,0)
 D ^DIR K DIR Q:$G(DIRUT)  I 'Y K PSCAN D INVALD^PSOCAN1 G NUM
"RTN","PSOCAN",70,0)
 K PSOPLCKZ S RX="" F  S RX=$O(PSCAN(RX)) Q:'RX  D
"RTN","PSOCAN",71,0)
 .S PSODFN=+$P($G(^PSRX(+PSCAN(RX),0)),"^",2)
"RTN","PSOCAN",72,0)
 .S PSOPLCK=$$L^PSSLOCK(+$G(PSODFN),0) D:'$G(PSOPLCK)&('$D(PSOPLCKZ(PSODFN))) LOCK^PSOORCPY I '$G(PSOPLCK) S PSOPLCKZ(PSODFN)=PSODFN Q
"RTN","PSOCAN",73,0)
 .D PSOL^PSSLOCK(+PSCAN(RX)) I '$G(PSOMSG) D  D UL^PSSLOCK(PSODFN) Q
"RTN","PSOCAN",74,0)
 ..I $P($G(PSOMSG),"^",2)'="" W !,$P($G(PSOMSG),"^",2),!,"Order "_$P($G(^PSRX(+PSCAN(RX),0)),"^")_"." Q
"RTN","PSOCAN",75,0)
 ..W !,"Another person is editing order "_$P($G(^PSRX(+PSCAN(RX),0)),"^")_"."
"RTN","PSOCAN",76,0)
 .D ACT D PSOUL^PSSLOCK(+PSCAN(RX)),UL^PSSLOCK(PSODFN)
"RTN","PSOCAN",77,0)
 .S PSOCNRXV=1
"RTN","PSOCAN",78,0)
 K PSOPLCKZ W:$G(PSOCNRXV) !,$S($G(RXCNT)>1:"Statuses Changed",REA="C":"Prescription Discontinued",1:"Prescription Reinstated") D INVALD^PSOCAN1 G NUM
"RTN","PSOCAN",79,0)
ACT S DA=+PSCAN(RX),REA=$P(PSCAN(RX),"^",2),II=RX,PSODFN=$P(^PSRX(DA,0),"^",2) I REA="R" D REINS^PSOCAN2 Q
"RTN","PSOCAN",80,0)
 D CAN Q
"RTN","PSOCAN",81,0)
EXP ;S PSINV($P(^PSRX(DA,0),"^"))="" 
"RTN","PSOCAN",82,0)
 Q:$P(^PSRX(DA,"STA"),"^")=12
"RTN","PSOCAN",83,0)
 S $P(^PSRX(DA,"STA"),"^")=11 D ECAN^PSOUTL(DA)
"RTN","PSOCAN",84,0)
 S STAT="SC",PHARMST="ZE",COMM="Medication Expired on "_$E($P(^PSRX(DA,2),"^",6),4,5)_"/"_$E($P(^(2),"^",6),6,7)_"/"_$E($P(^(2),"^",6),2,3) D EN^PSOHLSN1(DA,STAT,PHARMST,COMM) K COMM,STAT,PHARMST
"RTN","PSOCAN",85,0)
EP1 I '$G(RXSP) D INVALD^PSOCAN1 Q:$G(POERR)  G NUM
"RTN","PSOCAN",86,0)
 Q
"RTN","PSOCAN",87,0)
PSD ;Called from Controlled Subs, PSDRX is internal Rx number
"RTN","PSOCAN",88,0)
 S PSDRFDEL=0
"RTN","PSOCAN",89,0)
 I '$G(PSDRX)!('$D(^PSRX(+$G(PSDRX),0))) Q
"RTN","PSOCAN",90,0)
 I $P($G(^PSRX(PSDRX,"STA")),"^")<12 Q
"RTN","PSOCAN",91,0)
 N DA,NODE,RF,PSOPSDAL,PSODRX,PSODTE,PSODL,SFN,RIFN,PSOSXP,PSOFILDL
"RTN","PSOCAN",92,0)
 S PSODRX=0 F PSODLP=0:0 S PSODLP=$O(^PSRX(PSDRX,1,PSODLP)) Q:'PSODLP  S:$D(^PSRX(PSDRX,1,PSODLP,0)) PSODRX=PSODLP
"RTN","PSOCAN",93,0)
 I 'PSODRX Q
"RTN","PSOCAN",94,0)
 I $P($G(^PSRX(PSDRX,1,PSODRX,0)),"^",18) Q
"RTN","PSOCAN",95,0)
 D PSDREF I $G(PSOFILDL) K PSOFILDL Q
"RTN","PSOCAN",96,0)
 K PSOFILDL,DIE S NODE=0,PSOPSDAL=1,DA(1)=PSDRX,DA=PSODRX,DIE="^PSRX("_DA(1)_",1,",DR=".01///@" D ^DIE K DIE
"RTN","PSOCAN",97,0)
 S PSDRFDEL=1
"RTN","PSOCAN",98,0)
 Q
"RTN","PSOCAN",99,0)
PSDREF ;
"RTN","PSOCAN",100,0)
 N PRDL,PSOCNODE
"RTN","PSOCAN",101,0)
 S PSOFILDL=0
"RTN","PSOCAN",102,0)
 F PRDL=0:0 S PRDL=$O(^PSRX(PSDRX,4,PRDL)) Q:'PRDL  I $G(PSODRX)=$P($G(^PSRX(PSDRX,4,PRDL,0)),"^",3) S PSOCNODE=$G(^(0))
"RTN","PSOCAN",103,0)
 I $G(PSOCNODE)="" Q
"RTN","PSOCAN",104,0)
 I +$P(PSOCNODE,"^",4)<3 S PSOFILDL=1
"RTN","PSOCAN",105,0)
 Q
"RTN","PSOCAN",106,0)
TESTRP ;
"RTN","PSOCAN",107,0)
 N PIIN,PIINFLAG S PIINFLAG=0 F PIIN=1:1 S X=$P(IN,",",PIIN) Q:$P(IN,",",PIIN)']""  K DIC S DIC=52,DIC(0)="QMZ" D ^DIC K DIC I +$G(Y) D
"RTN","PSOCAN",108,0)
 .I $P($G(^PSRX(+Y,"STA")),"^")'=12,'$G(PIINFLAG) S PSOCANRD=+$P($G(^PSRX(+Y,0)),"^",4) S PIINFLAG=1
"RTN","PSOCAN",109,0)
 I '$G(PIINFLAG) S PSOCANRZ=1
"RTN","PSOCAN",110,0)
 Q
"RTN","PSOCAN",111,0)
ULP ;
"RTN","PSOCAN",112,0)
 D UL^PSSLOCK(+$G(PSODFN))
"RTN","PSOCAN",113,0)
 Q
"RTN","PSOCAN",114,0)
ULRX ;
"RTN","PSOCAN",115,0)
 I $G(PSOULRX) D PSOUL^PSSLOCK(PSOULRX)
"RTN","PSOCAN",116,0)
 Q
"RTN","PSOCAN2")
0^4^B76842420
"RTN","PSOCAN2",1,0)
PSOCAN2 ;BHAM ISC/JMB - rx cancel with speed ability drug check ;10/23/06 11:30am
"RTN","PSOCAN2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**8,18,62,46,88,164,235,148,259,281,287,251**;DEC 1997;Build 202
"RTN","PSOCAN2",3,0)
 ;External reference to ^PSDRUG supported by dbia 221
"RTN","PSOCAN2",4,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5424
"RTN","PSOCAN2",5,0)
REINS N DODR,ORN
"RTN","PSOCAN2",6,0)
 I $P(^PSRX(DA,2),"^",6)<DT D  Q
"RTN","PSOCAN2",7,0)
 .S Y=$P(^PSRX(DA,2),"^",6) X ^DD("DD")
"RTN","PSOCAN2",8,0)
 .W !!,"Rx: "_$P(^PSRX(DA,0),"^")_" Drug: "_$S($D(^PSDRUG($P(^PSRX(DA,0),"^",6),0)):$P(^(0),"^"),1:""),!,"Expired "_Y_" and cannot be Reinstated!",!
"RTN","PSOCAN2",9,0)
 .D PAUSE^VALM1
"RTN","PSOCAN2",10,0)
 I $D(^PSRX("APSOD",$P(^PSRX(DA,0),"^",2),DA)) S PSCAN($P(^PSRX(DA,0),"^"))=DA_"^R",DODR=1 D AUTOD G ACT
"RTN","PSOCAN2",11,0)
 I $P(PSOPAR,"^",2),'$D(^XUSEC("PSORPH",DUZ)) N PSOVODA S PSOVODA=DA D DRGDRG S DA=PSOVODA Q:PSORX("DFLG")  D VERIFY D  D AREC^PSOCAN1 Q
"RTN","PSOCAN2",12,0)
 .S RX1=$P(^PSRX(DA,0),"^") S:'$D(PSCAN(RX1)) PSCAN(RX1)=DA_"^R" K RX1
"RTN","PSOCAN2",13,0)
ACT W ! F I=1:1:80 W "="
"RTN","PSOCAN2",14,0)
 D ^PSOBUILD S DRG=+$P(^PSRX(DA,0),"^",6),DRG=$S($D(^PSDRUG(DRG,0)):$P(^(0),"^"),1:""),HOLDRX=RX
"RTN","PSOCAN2",15,0)
 W !!,RX_"  "_DRG I $G(POERR) S HPOERR=POERR
"RTN","PSOCAN2",16,0)
 D DRGDRG
"RTN","PSOCAN2",17,0)
 S:$G(HPOERR) POERR=HPOERR S:$G(PSORX("DFLG"))'=1 PSORX("DFLG")=0
"RTN","PSOCAN2",18,0)
 S RX=HOLDRX K HOLDRX,HPOERR Q:$P(^PSRX(+PSCAN(RX),"STA"),"^")'=12!($G(PSORX("DFLG")))
"RTN","PSOCAN2",19,0)
 S DA=+PSCAN(RX),REA=$P(PSCAN(RX),"^",2) D CAN^PSOCAN W !
"RTN","PSOCAN2",20,0)
 N RXIEN S RXIEN=DA
"RTN","PSOCAN2",21,0)
 ;Takes action on reinstated Rx's
"RTN","PSOCAN2",22,0)
 S RFCNT=0 F RF=0:0 S RF=$O(^PSRX(DA,1,RF)) Q:'RF  S RFCNT=RF
"RTN","PSOCAN2",23,0)
 S (LPRT,LREF)="" F LL=0:0 S LL=$O(^PSRX(DA,"L",LL)) Q:'LL  S LPRT=$P($G(^PSRX(DA,"L",LL,0)),"."),LREF=$P($G(^(0)),"^",2)
"RTN","PSOCAN2",24,0)
 I 'RFCNT S FDT=$S($P($G(^PSRX(DA,2)),"^",2)'="":$P($G(^PSRX(DA,2)),"^",2),1:$P($G(^PSRX(DA,2)),"^")) S RELDT=$P(^(2),"^",13),RELDT=$P(RELDT,".")
"RTN","PSOCAN2",25,0)
 I RFCNT S FDT=$P($G(^PSRX(DA,1,RFCNT,0)),"^"),RELDT=$P(^(0),"^",18),RELDT=$P(RELDT,".")
"RTN","PSOCAN2",26,0)
 S Y=FDT D DD^%DT S XFDT=Y I RELDT'="" S Y=RELDT D DD^%DT S XRELDT=Y
"RTN","PSOCAN2",27,0)
 I LPRT'="" S Y=LPRT D DD^%DT S XLPDT=Y
"RTN","PSOCAN2",28,0)
 ;If Rx was released, do nothing
"RTN","PSOCAN2",29,0)
 I RELDT'="" W !,RX_" Reinstated -- ",!?3,$S('RFCNT:"Filled",1:"Refilled # "_LREF)_": "_XFDT,?32,"Printed: "_$S(LREF=RFCNT:XLPDT,1:""),?56,"Released: "_$G(XRELDT) H 3 Q
"RTN","PSOCAN2",30,0)
 ;If Rx not released, check fill/refill date for action
"RTN","PSOCAN2",31,0)
 I $G(PSXSYS) D REINS^PSOCMOPA I $G(XFLAG) K XFLAG Q
"RTN","PSOCAN2",32,0)
 W !,"Prescription #"_RX_" REINSTATED!"
"RTN","PSOCAN2",33,0)
 ;
"RTN","PSOCAN2",34,0)
 N PSOTRIC S PSOTRIC="",PSOTRIC=$$TRIC^PSOREJP1(RXIEN,RFCNT,PSOTRIC)
"RTN","PSOCAN2",35,0)
 D SUBMIT^PSOREJU3(RXIEN,RFCNT,PSOTRIC)
"RTN","PSOCAN2",36,0)
 ;
"RTN","PSOCAN2",37,0)
 W !?3,"Prescription #",RX_": "
"RTN","PSOCAN2",38,0)
 W !?6,$S('RFCNT:"  Filled",1:"  Refilled # "_LREF)_": "_XFDT,"  Printed: "_$S(LREF=RFCNT:XLPDT,1:""),"  Released: "_$G(XRELDT),!
"RTN","PSOCAN2",39,0)
 I FDT<DT D
"RTN","PSOCAN2",40,0)
 .Q:$$FIND^PSOREJUT(RXIEN)  ;No label for Rx's with claims rejects
"RTN","PSOCAN2",41,0)
 .Q:PSOTRIC&($$STATUS^PSOBPSUT(RXIEN,RFCNT)'["PAYABLE")  ;No labels for Tricare non-payable/in progress Rx
"RTN","PSOCAN2",42,0)
 .S DIR("A")="     ** Do you want to print the label now",DIR("B")="N",DIR(0)="Y",DIR("?")="Enter 'Y' to print the label now.  If 'N' is entered, the label may be reprinted through reprint at a later date."
"RTN","PSOCAN2",43,0)
 .D ^DIR K DIR Q:$G(DIRUT)!('Y)  S PPL=RXIEN D Q^PSORXL Q
"RTN","PSOCAN2",44,0)
 I FDT=DT D
"RTN","PSOCAN2",45,0)
 . Q:$$FIND^PSOREJUT(RXIEN)
"RTN","PSOCAN2",46,0)
 . Q:PSOTRIC&($$STATUS^PSOBPSUT(RXIEN,RFCNT)'["PAYABLE")
"RTN","PSOCAN2",47,0)
 . W !?5,"Either print the label using the reprint option "
"RTN","PSOCAN2",48,0)
 . W !?7,"or check later to see if the label has been printed." Q
"RTN","PSOCAN2",49,0)
 I FDT>DT&('$G(DODR)) W !?5,"Placing Rx on suspense.  Please wait..." D SUS
"RTN","PSOCAN2",50,0)
 K DODR
"RTN","PSOCAN2",51,0)
 Q
"RTN","PSOCAN2",52,0)
SUS ;Adds rec to suspense
"RTN","PSOCAN2",53,0)
 S ACT=1,RXN=DA,RX0=^PSRX(DA,0),RXS=$O(^PS(52.5,"B",DA,0)) I RXS S DA=RXS,DIK="^PS(52.5," D ^DIK S DA=RXN
"RTN","PSOCAN2",54,0)
 S RXP=$S($D(RXP):RXP,1:0),DIC="^PS(52.5,",DIC(0)="L",X=RXN,DIC("DR")=".02///"_FDT_";.03///"_$P(RX0,"^",2)_";.04///M;.05///"_RXP_";.06////"_$G(PSOSITE)_";2///0" K DD,DO D FILE^DICN
"RTN","PSOCAN2",55,0)
 I +$G(Y),$G(RFCNT)'="" S $P(^PS(52.5,+Y,0),"^",13)=$G(RFCNT)
"RTN","PSOCAN2",56,0)
 S DA=RXN,$P(^PSRX(DA,"STA"),"^")=5,LFD=$E($P(^PSRX(DA,3),"^"),4,5)_"-"_$E($P(^(3),"^"),6,7)_"-"_$E($P(^(3),"^"),2,3)
"RTN","PSOCAN2",57,0)
 S ACOM="RX Placed on Suspense until "_LFD D AREC^PSOCAN1 S ST="SC",PHST="ZS" D EN^PSOHLSN1(DA,ST,PHST,ACOM) K ST,PHST
"RTN","PSOCAN2",58,0)
 Q
"RTN","PSOCAN2",59,0)
DRGDRG ;Checks for drug/drug interaction, duplicate drug and class
"RTN","PSOCAN2",60,0)
 Q:$P(^PSRX(DA,2),"^",6)<DT
"RTN","PSOCAN2",61,0)
 S (PSORX("DFLG"),PSORXED("DFLG"))=0
"RTN","PSOCAN2",62,0)
 S STA="ACTIVE^NON-VERIFIED^R^HOLD^NON-VERIFIED^ACTIVE^^^^^^ACTIVE^DISCONTINUED^^DISCONTINUED^DISCONTINUED^HOLD"
"RTN","PSOCAN2",63,0)
 S STAT=$P(STA,"^",$P(^PSRX(DA,"STA"),"^")+1)
"RTN","PSOCAN2",64,0)
 S X=$P(^PSRX(DA,0),"^",6),DIC="^PSDRUG(",DIC(0)="MZO" D ^DIC K DIC Q:$D(DTOUT)!(Y<0)
"RTN","PSOCAN2",65,0)
 K HOLD S NAME=$P(Y(0),"^") I +$G(PSOSD(STAT,NAME))=+PSCAN(RX) S HOLD(STAT,NAME)=$G(PSOSD(STAT,NAME)) K PSOSD(STAT,NAME)
"RTN","PSOCAN2",66,0)
 S:$G(PSONEW("OLD VAL"))=+Y PSODRG("QFLG")=1
"RTN","PSOCAN2",67,0)
 K PSOY,PSOTECCK S PSOY=Y,PSOY(0)=Y(0)
"RTN","PSOCAN2",68,0)
 I '$D(^XUSEC("PSORPH",DUZ)) S PSOTECCK=1
"RTN","PSOCAN2",69,0)
 S PSORENW("OIRXN")=DA D SET^PSODRG,POST^PSODRG K PSOTECCK
"RTN","PSOCAN2",70,0)
 D:$$DS^PSSDSAPI&('$G(PSORX("DFLG"))) DOSCK^PSODOSUT("C")
"RTN","PSOCAN2",71,0)
 S REA=$P(PSCAN($P(^PSRX(PSORENW("OIRXN"),0),"^")),"^",2)
"RTN","PSOCAN2",72,0)
 W ! S:$G(HOLD(STAT,NAME))]"" PSOSD(STAT,NAME)=$G(HOLD(STAT,NAME)) K HOLD,STA,STAT,PSORENW("OIRXN")
"RTN","PSOCAN2",73,0)
 Q
"RTN","PSOCAN2",74,0)
VERIFY ;Put in non-verify file
"RTN","PSOCAN2",75,0)
 S PSRXDA=DA,DIC="^PS(52.4,",DLAYGO=52.4,(X,DINUM)=PSRXDA,DIC(0)="ML",DIC("DR")="1////"_PSODFN_";2////"_DUZ_";4////"_DT
"RTN","PSOCAN2",76,0)
 K DD,DO D FILE^DICN K DIC,DLAYGO,DINUM
"RTN","PSOCAN2",77,0)
 S DA=PSRXDA S $P(^PSRX(DA,"STA"),"^")=1
"RTN","PSOCAN2",78,0)
 S ST="SC",PHST="IP",VCOM="Put in non-verified status" D EN^PSOHLSN1(DA,ST,PHST,VCOM) K ST,PHST,VCOM
"RTN","PSOCAN2",79,0)
 Q
"RTN","PSOCAN2",80,0)
HLD N PSDTEST,PDA,CMOP,SUSD I $P(^PSRX(DA,"STA"),"^")=3 D
"RTN","PSOCAN2",81,0)
 .S ACOM=$S(REA="C":"Discontinued",1:"Reinstated")_" while on hold during Rx cancel. " K:$P(^PSRX(DA,"H"),"^") ^PSRX("AH",$P(^PSRX(DA,"H"),"^"),DA) S ^PSRX(DA,"H")=""
"RTN","PSOCAN2",82,0)
 .I $P(^PSRX(DA,0),"^",13),'$O(^PSRX(DA,1,0)) S DIE=52,DR="22///"_$E($P(^PSRX(DA,0),"^",13),1,7) D ^DIE K DIE,DR Q
"RTN","PSOCAN2",83,0)
 .S (IFN,SUSD)=0 F  S IFN=$O(^PSRX(DA,1,IFN)) Q:'IFN  S SUSD=IFN,RFDT=$P(^PSRX(DA,1,IFN,0),"^")
"RTN","PSOCAN2",84,0)
 .Q:'$G(SUSD)  I '$P(^PSRX(DA,1,SUSD,0),"^",18) S PSDTEST=0 D  I 'PSDTEST K ^PSRX(DA,1,SUSD),^PSRX("AD",RFDT,DA,SUSD),^PSRX(DA,1,"B",RFDT,SUSD),IFN,SUSD,RFDT
"RTN","PSOCAN2",85,0)
 ..F PDA=0:0 S PDA=$O(^PSRX(DA,"L",PDA)) Q:'PDA  I $P($G(^PSRX(DA,"L",PDA,0)),"^",2)=SUSD S PSDTEST=1
"RTN","PSOCAN2",86,0)
 ..K CMOP D ^PSOCMOPA I $G(CMOP(CMOP("L")))="",$G(CMOP("S"))'="L" Q
"RTN","PSOCAN2",87,0)
 ..S PSDTEST=1
"RTN","PSOCAN2",88,0)
 Q
"RTN","PSOCAN2",89,0)
REF S IFN=0 F  S IFN=$O(^PSRX(DA,1,IFN)) Q:'IFN  I $P($G(^PSRX(DA,1,IFN,0)),"^")=SUSD,'$P(^(0),"^",18) D
"RTN","PSOCAN2",90,0)
 .D DELREF I $G(PSORFDEL) K PSORFDEL Q
"RTN","PSOCAN2",91,0)
 .;PSO*7*259;CHECK IF REFILL RELEASED OR LABEL PRINTED
"RTN","PSOCAN2",92,0)
 .I $P($G(^PSRX(DA,1,IFN,0)),"^",18)]"" Q  ;REFILL RELEASED
"RTN","PSOCAN2",93,0)
 .N PSONODEL,PSOLBL S PSONODEL=0
"RTN","PSOCAN2",94,0)
 .I $P(^PSRX(DA,"STA"),"^")=5 D REF^PSOCAN4 Q:PSONODEL
"RTN","PSOCAN2",95,0)
 .S PSOLBL="" F  S PSOLBL=$O(^PSRX(DA,"L",PSOLBL),-1) Q:'PSOLBL  Q:PSONODEL  Q:$P(^PSRX(DA,"L",PSOLBL,0),"^",2)<IFN  I $P(^PSRX(DA,"L",PSOLBL,0),"^",2)=IFN S PSONODEL=1
"RTN","PSOCAN2",96,0)
 .Q:PSONODEL
"RTN","PSOCAN2",97,0)
 .K PSORFDEL K ^PSRX(DA,1,IFN),^PSRX("AD",SUSD,DA,IFN),^PSRX(DA,1,"B",SUSD,IFN)
"RTN","PSOCAN2",98,0)
 .S $P(^PSRX(DA,1,0),"^",4)=$P(^PSRX(DA,1,0),"^",4)-1,DA(1)=DA
"RTN","PSOCAN2",99,0)
 .S NODE=0 D SPR^PSOUTL K DA(1),RF,NODE
"RTN","PSOCAN2",100,0)
 S IFN=0 F  S IFN=$O(^PSRX(DA,1,IFN)) Q:'IFN  I '$O(^PSRX(DA,1,IFN)) S $P(^PSRX(DA,3),"^")=+$P(^PSRX(DA,1,IFN,0),"^"),$P(^(3),"^",2)=SUSD
"RTN","PSOCAN2",101,0)
 I '$O(^PSRX(DA,1,0)) S $P(^PSRX(DA,3),"^")=$P(^PSRX(DA,2),"^",2),$P(^PSRX(DA,3),"^",2)=SUSD
"RTN","PSOCAN2",102,0)
 K IFN,SUSD
"RTN","PSOCAN2",103,0)
 Q
"RTN","PSOCAN2",104,0)
KILL K %,ACNT,ACOM,ACT,ALL,BCNUM,CMOP,CNT,DA,DAYS360,DEAD,DRG,DIRUT,DR,DRUG,DTOUT,DUOUT,FDT,HOLD,I,II,IN,IT,JJ,LC,LFD,LINE,LL,LPRT,LREF,LSI,NAME,NDF,NOEXP,NSF,OUT,RXSP,EN,WARN K:'$G(POERR) INCOM
"RTN","PSOCAN2",105,0)
 K PSODRUG,PCNT,POP,PPL,PS,PSFROM,PSINV,PLINE,PSI,PSINV,PSOCAN,PSOCMOP,PSODFN,PSODRG,PSOOPT,PSOSD,PSPOP,PSRXDA,PSS,PSVC,PSONOOR
"RTN","PSOCAN2",106,0)
 K REA,RELDT,RF,RFDATE,RFCNT,RFL,RFL1,RFLL,RP,RX,RX0,RXCNT,RXDA,RXN,RXNUM,RXP,RXREC,RXREF,RXS,SDATE,SPCANC,SS,STAT,SUB,X,XFDT,XLPDT,XRELDT,Y D KVA^VADPT Q
"RTN","PSOCAN2",107,0)
DELREF ;
"RTN","PSOCAN2",108,0)
 N RDL,PSCNODE
"RTN","PSOCAN2",109,0)
 S PSORFDEL=0
"RTN","PSOCAN2",110,0)
 F RDL=0:0 S RDL=$O(^PSRX(DA,4,RDL)) Q:'RDL  I $G(IFN)=$P($G(^PSRX(DA,4,RDL,0)),"^",3) S PSCNODE=$G(^(0))
"RTN","PSOCAN2",111,0)
 I $G(PSCNODE)="" Q
"RTN","PSOCAN2",112,0)
 I +$P(PSCNODE,"^",4)<3 S PSORFDEL=1
"RTN","PSOCAN2",113,0)
 Q
"RTN","PSOCAN2",114,0)
AUTOD ;reinstates Rxs dc'd by date of death
"RTN","PSOCAN2",115,0)
 I $G(^PSRX(DA,"DDSTA"))']"" K ^PSRX("APSOD",+$P(^PSRX(DA,0),"^",2),DA),DODR Q
"RTN","PSOCAN2",116,0)
 S DODS=$P(^PSRX(DA,"DDSTA"),"^"),DODD=$P(^("DDSTA"),"^",2,245)
"RTN","PSOCAN2",117,0)
 S FILE=$P(DODS,";"),STA=$P(DODS,";",2)
"RTN","PSOCAN2",118,0)
 I FILE=52.4 D  Q
"RTN","PSOCAN2",119,0)
 .S RXN=DA,^PS(52.4,DA,0)=DODD,DIK="^PS(52.4," D IX^DIK K DIK,DA S DA=RXN,$P(^PSRX(DA,"STA"),"^")=STA
"RTN","PSOCAN2",120,0)
 .S ST="SC",PHST="IP",ACOM="Date of Death Deleted. Returned to Non-Verified status."
"RTN","PSOCAN2",121,0)
 .K ^PSRX("APSOD",$P(^PSRX(DA,0),"^",2),DA),^PSRX(DA,"DDSTA")
"RTN","PSOCAN2",122,0)
 .S DA=RXN D LOG D EN^PSOHLSN1(DA,ST,PHST,ACOM) K ST,PHST,ACOM,RXN
"RTN","PSOCAN2",123,0)
 I FILE=52.5 D  Q
"RTN","PSOCAN2",124,0)
 .;Adds rec to suspense
"RTN","PSOCAN2",125,0)
 .S RXN=DA,RXS=$O(^PS(52.5,"B",DA,0)) I RXS S DA=RXS,DIK="^PS(52.5," D ^DIK
"RTN","PSOCAN2",126,0)
 .S DIC="^PS(52.5,",DIC(0)="L",X=RXN K DD,DO D FILE^DICN S DA=+Y
"RTN","PSOCAN2",127,0)
 .S ^PS(52.5,DA,0)=DODD,^PS(52.5,DA,"P")=0,LFD=$E($P(^PS(52.5,DA,0),"^",2),4,5)_"-"_$E($P(^(0),"^",2),6,7)_"-"_$E($P(^(0),"^",2),2,3)
"RTN","PSOCAN2",128,0)
 .S DIK="^PS(52.5," D IX^DIK K DIK,DA S DA=RXN,$P(^PSRX(DA,"STA"),"^")=STA
"RTN","PSOCAN2",129,0)
 .S ACOM="Date of Death Deleted. RX Placed on Suspense until "_LFD
"RTN","PSOCAN2",130,0)
 .K ^PSRX("APSOD",PSODFN,DA),^PSRX(DA,"DDSTA")
"RTN","PSOCAN2",131,0)
 .I STA=5 S ST="SC",PHST="ZS" D LOG D EN^PSOHLSN1(DA,ST,PHST,ACOM) K ST,PHST,ACOM,LFD
"RTN","PSOCAN2",132,0)
 I FILE=52 S ^PSRX(DA,"STA")=STA I STA=3!(STA=16) D  Q
"RTN","PSOCAN2",133,0)
 .S ^PSRX(DA,"H")=DODD,^PSRX("AH",$P(^PSRX(DA,"H"),"^"),DA)=""
"RTN","PSOCAN2",134,0)
 .S ACOM="Date of Death Deleted. Medication Returned to"_$S(STA=16:" Provider",1:"")_" Hold Status "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3)_"."
"RTN","PSOCAN2",135,0)
 .D LOG,EN^PSOHLSN1(DA,"OH","",ACOM) K ACOM
"RTN","PSOCAN2",136,0)
 .K ^PSRX("APSOD",PSODFN,DA),^PSRX(DA,"DDSTA")
"RTN","PSOCAN2",137,0)
 S ACOM="Date of Death Deleted. Prescription Reinstated." D EN^PSOHLSN1(DA,"SC","CM",ACOM),LOG K ACOM
"RTN","PSOCAN2",138,0)
 K ^PSRX("APSOD",PSODFN,DA),^PSRX(DA,"DDSTA")
"RTN","PSOCAN2",139,0)
 Q
"RTN","PSOCAN2",140,0)
LOG K ACNT F SUB=0:0 S SUB=$O(^PSRX(DA,"A",SUB)) Q:'SUB  S ACNT=$G(ACNT)+1
"RTN","PSOCAN2",141,0)
 S RFCNT=0 F RF=0:0 S RF=$O(^PSRX(DA,1,RF)) Q:'RF  S RFCNT=$G(RFCNT)+1 S:RF>5 RFCNT=$G(RFCNT)+1
"RTN","PSOCAN2",142,0)
 S ACNT=$G(ACNT)+1
"RTN","PSOCAN2",143,0)
 D NOW^%DTC S ^PSRX(DA,"A",0)="^52.3DA^"_ACNT_"^"_ACNT S ^PSRX(DA,"A",ACNT,0)=%_"^R^"_DUZ_"^"_RFCNT_"^"_ACOM
"RTN","PSOCAN2",144,0)
 K ^PSRX("APSOD",PSODFN,DA),ACNT,RFCNT,RF,%
"RTN","PSOCAN2",145,0)
 S $P(^PSRX(DA,3),"^")=$P(^PSRX(DA,3),"^",5),$P(^(3),"^",2)=$P(^(3),"^",8)
"RTN","PSOCAN2",146,0)
 S $P(^PSRX(DA,3),"^",5)="",$P(^(3),"^",8)=""
"RTN","PSOCAN2",147,0)
 Q
"RTN","PSOCAN2",148,0)
NVER ;Called from PSOCAN3, needs DA defined
"RTN","PSOCAN2",149,0)
 N PSONVC,PSONVCP,PSONVCC
"RTN","PSOCAN2",150,0)
 S PSONVC="SC",PSONVCP="IP",PSONVCC="Put in non-verified status" D EN^PSOHLSN1(DA,PSONVC,PSONVCP,PSONVCC)
"RTN","PSOCAN2",151,0)
 Q
"RTN","PSOCAN2",152,0)
RMB(IDX) ;remove Rx if found in array BBRX() (Bingo Board)
"RTN","PSOCAN2",153,0)
 N ST4,ST5,ST6,K
"RTN","PSOCAN2",154,0)
 S ST4=BBRX(IDX) Q:ST4'[(DA_",")
"RTN","PSOCAN2",155,0)
 S ST6=""
"RTN","PSOCAN2",156,0)
 F K=1:1 S ST5=$P(ST4,",",K) Q:'ST5  D
"RTN","PSOCAN2",157,0)
 . S:ST5'=DA ST6=ST6_$S('ST6:"",1:",")_ST5
"RTN","PSOCAN2",158,0)
 . S:ST6]"" BBRX(IDX)=ST6_"," K:ST6="" BBRX(IDX)
"RTN","PSOCAN2",159,0)
 I '$D(BBRX) K BINGCRT
"RTN","PSOCAN2",160,0)
 Q
"RTN","PSOCAN2",161,0)
 ;
"RTN","PSOCAN3")
0^5^B71472770
"RTN","PSOCAN3",1,0)
PSOCAN3 ;BIR/RTR/SAB - auto dc rxs due to death ;2/05/97 2:59pm
"RTN","PSOCAN3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**15,24,27,32,36,94,88,117,131,146,139,132,223,235,148,249,225,324,251**;DEC 1997;Build 202
"RTN","PSOCAN3",3,0)
 ;External reference to File #55 supported by DBIA 2228
"RTN","PSOCAN3",4,0)
 ;External references to L, UL, PSOL, and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOCAN3",5,0)
 Q
"RTN","PSOCAN3",6,0)
APSOD(PSODFN) ;called from file #2 date of death xref 'APOSD'
"RTN","PSOCAN3",7,0)
 N D,DA,DB,DC,DE,DG,DH,DI,DIC,DIE,DIG,DIH,DIK,DIR,DIQ,DIU,DIV,DIW,DK,DL,DM,DP,DQ,DU,DV,DW,DR
"RTN","PSOCAN3",8,0)
 S PSODEATH=1 D CAN K PSODEATH
"RTN","PSOCAN3",9,0)
 Q
"RTN","PSOCAN3",10,0)
CAN ;discontinued rxs due to death
"RTN","PSOCAN3",11,0)
 I $G(PSODFN),$D(^PS(52.91,PSODFN,0)) D
"RTN","PSOCAN3",12,0)
 .I '$P($G(^PS(52.91,PSODFN,0)),"^",3)!($P($G(^(0)),"^",3)>DT) S $P(^PS(52.91,PSODFN,0),"^",3)=DT,$P(^PS(52.91,PSODFN,0),"^",4)=5,^PS(52.91,"AX",DT,PSODFN)="" D SET^PSOTPCAN(PSODFN)
"RTN","PSOCAN3",13,0)
 F PSORXJ=0:0 S PSORXJ=$O(^PS(55,PSODFN,"P",PSORXJ)) Q:'PSORXJ  I $D(^(PSORXJ,0)) S PSORX=^(0) S STA=$S($P($G(^PSRX(PSORX,"STA")),"^")<11:1,$P($G(^("STA")),"^")=16:1,1:0) D:STA
"RTN","PSOCAN3",14,0)
 .I $D(^PSRX(PSORX,0)),$P($G(^PSRX(PSORX,"STA")),"^")="" D SETC
"RTN","PSOCAN3",15,0)
 .D REVERSE^PSOBPSU1(PSORX,,"DC",7)
"RTN","PSOCAN3",16,0)
 .I $D(^PSRX(PSORX,0)),$P($G(^PSRX(PSORX,2)),"^",6)'<DT S PSO0=^(0),PSO2=$G(^(2)) D
"RTN","PSOCAN3",17,0)
 ..S ^PSRX(PSORX,"DDSTA")="52;"_$P(^PSRX(PSORX,"STA"),"^")
"RTN","PSOCAN3",18,0)
 ..;remove from hold
"RTN","PSOCAN3",19,0)
 ..I $G(^PSRX(PSORX,"H"))]"" D
"RTN","PSOCAN3",20,0)
 ...S ^PSRX(PSORX,"DDSTA")="52;"_$P(^PSRX(PSORX,"STA"),"^")_"^"_^PSRX(PSORX,"H")
"RTN","PSOCAN3",21,0)
 ...K:$P(^PSRX(PSORX,"H"),"^") ^PSRX("AH",$P(^PSRX(PSORX,"H"),"^"),PSORX) S ^PSRX(PSORX,"H")=""
"RTN","PSOCAN3",22,0)
 ...I '$P($G(^PSRX(PSORX,2)),"^",2),$P($G(^(3)),"^") S $P(^PSRX(PSORX,2),"^",2)=$P(^(3),"^")
"RTN","PSOCAN3",23,0)
 ...I $G(PSODEATH),$P(^PSRX(PSORX,0),"^",2) S ^PSRX("APSOD",$P(^PSRX(PSORX,0),"^",2),PSORX)=""
"RTN","PSOCAN3",24,0)
 ..;delete from non-verified file
"RTN","PSOCAN3",25,0)
 ..I $G(^PS(52.4,PSORX,0))]"" S ^PSRX(PSORX,"DDSTA")="52.4;"_$P(^PSRX(PSORX,"STA"),"^")_"^"_^PS(52.4,PSORX,0),DIK="^PS(52.4,",DA=PSORX D ^DIK K DIK
"RTN","PSOCAN3",26,0)
 ..I $G(PSODEATH),$P(^PSRX(PSORX,0),"^",2) S ^PSRX("APSOD",$P(^PSRX(PSORX,0),"^",2),PSORX)=""
"RTN","PSOCAN3",27,0)
 ..;delete from suspense
"RTN","PSOCAN3",28,0)
 ..D:$O(^PS(52.5,"B",PSORX,0))
"RTN","PSOCAN3",29,0)
 ...S DA=$O(^PS(52.5,"B",PSORX,0)) I '$G(^PS(52.5,DA,"P")),$G(PSODEATH) S ^PSRX(PSORX,"DDSTA")="52.5;5^"_^PS(52.5,DA,0),^PSRX("APSOD",$P(^PSRX(PSORX,0),"^",2),PSORX)=""
"RTN","PSOCAN3",30,0)
 ...I $O(^PSRX(PSORX,1,0)),'$G(PSODEATH) S DA=PSORX,SUSD=$P($G(^PS(52.5,$O(^PS(52.5,"B",PSORX,0)),0)),"^",2) D:'$G(^PS(52.5,$O(^PS(52.5,"B",PSORX,0)),"P")) REF^PSOCAN2
"RTN","PSOCAN3",31,0)
 ...S DA=$O(^PS(52.5,"B",PSORX,0)),DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOCAN3",32,0)
 ..D SETC
"RTN","PSOCAN3",33,0)
 ..;activity record
"RTN","PSOCAN3",34,0)
 ..S (COM,ACOM)=$S($G(PSODEATH):"Date of Death Entered by MAS",1:"Discontinued by Pharmacy")_"."
"RTN","PSOCAN3",35,0)
 ..S ACNT=0 F SUB=0:0 S SUB=$O(^PSRX(PSORX,"A",SUB)) Q:'SUB  S ACNT=SUB
"RTN","PSOCAN3",36,0)
 ..S RFCNT=0 F RF=0:0 S RF=$O(^PSRX(PSORX,1,RF)) Q:'RF  S RFCNT=RF
"RTN","PSOCAN3",37,0)
 ..D NOW^%DTC S ACNT=ACNT+1,^PSRX(PSORX,"A",0)="^52.3DA^"_ACNT_"^"_ACNT
"RTN","PSOCAN3",38,0)
 ..S ^PSRX(PSORX,"A",ACNT,0)=%_"^"_"C"_"^^"_RFCNT_"^"_"Auto Discontinued Due to Death. "_ACOM
"RTN","PSOCAN3",39,0)
 ..;check for label/release/pending release
"RTN","PSOCAN3",40,0)
 ..D FIL
"RTN","PSOCAN3",41,0)
 ..S STAT="OD",PHARMST="" D EN^PSOHLSN1(PSORX,STAT,PHARMST,COM,"A") K COMM,PHARMST,STAT
"RTN","PSOCAN3",42,0)
 ;dc pending orders
"RTN","PSOCAN3",43,0)
 F PDA=0:0 S PDA=$O(^PS(52.41,"P",PSODFN,PDA)) Q:'PDA  I $P(^PS(52.41,PDA,0),"^",3)'="DC"&($P(^(0),"^",3)'="DE") D
"RTN","PSOCAN3",44,0)
 .I $G(PSODEATH) D
"RTN","PSOCAN3",45,0)
 ..S ^PS(52.41,PDA,"DDSTA")=$P(^PS(52.41,PDA,0),"^",3)_";"_+$P($G(^PS(52.41,PDA,"INI")),"^"),^PS(52.41,"APSOD",PSODFN,PDA)=""
"RTN","PSOCAN3",46,0)
 ..S $P(^PS(52.41,PDA,4),"^")="Date of Death Entered by MAS."
"RTN","PSOCAN3",47,0)
 .S $P(^PS(52.41,PDA,0),"^",3)="DC"
"RTN","PSOCAN3",48,0)
 .K ^PS(52.41,"AOR",PSODFN,+$P($G(^PS(52.41,PDA,"INI")),"^"),PDA)
"RTN","PSOCAN3",49,0)
 .S COM=$S($G(PSODEATH):"Date of Death Entered by MAS.",1:""),PL=$P(^PS(52.41,PDA,0),"^"),$P(^(0),"^",3)="DC"
"RTN","PSOCAN3",50,0)
 .D EN^PSOHLSN(PL,"OC",COM,"A") K COM,PL
"RTN","PSOCAN3",51,0)
 ;dc non-va meds
"RTN","PSOCAN3",52,0)
 D APSOD^PSONVNEW
"RTN","PSOCAN3",53,0)
KILL K %,%H,%T,ACNT,DA,PDA,DIRUT,DTOUT,PSO,PSO0,PSO2,PSOD,PSOD0,PSODFN,PSODL,PSORX,PSORXJ,PSOSD,RF,RFCNT,SUB,TM,TSKDT,X,X1,X2,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","PSOCAN3",54,0)
 D KVAR^VADPT S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOCAN3",55,0)
 Q
"RTN","PSOCAN3",56,0)
CAN1 Q:$G(DODR)
"RTN","PSOCAN3",57,0)
 S PSOMGDFN=$G(PSODFN) ; SAVE IN CASE CANCELING RX THAT WAS MERGED TO ANOTHER DFN
"RTN","PSOCAN3",58,0)
 I $G(^PSRX(DA,"H"))]"" D HLD^PSOCAN2
"RTN","PSOCAN3",59,0)
 D REVERSE^PSOBPSU1(DA,,"DC",7)
"RTN","PSOCAN3",60,0)
 S PSCANVAR=0,RXDA=DA,DA=$O(^PS(52.5,"B",DA,0)) I DA,'$G(^PS(52.5,DA,"P")) S PSCANVAR=1 D
"RTN","PSOCAN3",61,0)
 .S SUSD=$P($G(^PS(52.5,DA,0)),"^",2)
"RTN","PSOCAN3",62,0)
 .S:+$G(^PS(52.5,DA,"P"))'=1 ACOM=$S(REA="C":"Discontinued",1:"Reinstated")_" while suspended. "_$G(COM)
"RTN","PSOCAN3",63,0)
 .S DIK="^PS(52.5," D ^DIK K DIK S DA=RXDA,RXREF=0,PSODFN=+$P(^PSRX(DA,0),"^",2)
"RTN","PSOCAN3",64,0)
 .D AREC^PSOCAN1 S DA=RXDA I $O(^PSRX(DA,1,0)) D REF^PSOCAN2
"RTN","PSOCAN3",65,0)
 I $G(REA)="C" S DA=$O(^PS(52.5,"B",RXDA,0)) I DA S DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOCAN3",66,0)
 I 'PSCANVAR S:$D(SPCANC) ACOM=$S(REA="C":"Discontinued",1:"Reinstated")_" during Rx cancel.  "
"RTN","PSOCAN3",67,0)
ADD S DA=RXDA,RXREF=0,PSODFN=+$P(^PSRX(DA,0),"^",2) S:$G(PSOOPT)=3 REA="L"
"RTN","PSOCAN3",68,0)
 D:'$G(PSCANVAR) AREC^PSOCAN1 S:REA="L" REA="C"
"RTN","PSOCAN3",69,0)
 S:REA'="C" $P(^PSRX(DA,"STA"),"^")=0,$P(^(7),"^")=""
"RTN","PSOCAN3",70,0)
 N PSOTPCNZ S PSOTPCNZ=0 I $P(^PSRX(DA,"STA"),"^")'=12 S PSOTPCNZ=1
"RTN","PSOCAN3",71,0)
 S:REA="C"&($P(^PSRX(DA,"STA"),"^")<12)!($P(^("STA"),"^")=16) $P(^PSRX(DA,"STA"),"^")=12 I $P($G(^PSRX(DA,"STA")),"^")=12,$G(PSOTPCNZ) D CAN^PSOTPCAN(DA)
"RTN","PSOCAN3",72,0)
 K PSOTPCNZ
"RTN","PSOCAN3",73,0)
 I REA="R" D
"RTN","PSOCAN3",74,0)
 .I $P(^PSRX(DA,3),"^",8) S $P(^PSRX(DA,3),"^",2)=$P(^PSRX(DA,3),"^",8),$P(^(3),"^",8)=""
"RTN","PSOCAN3",75,0)
 .S $P(^PSRX(DA,3),"^")=$S($P(^PSRX(DA,3),"^",10):$P(^(3),"^",10),$G(PSOCANHD):PSOCANHD,$P(^(3),"^",5):$P(^(3),"^",5),1:$P(^(3),"^")),$P(^(3),"^",5)="",$P(^(3),"^",10)=""
"RTN","PSOCAN3",76,0)
 I REA="C" D
"RTN","PSOCAN3",77,0)
 .S $P(^PSRX(DA,3),"^",10)=$P(^PSRX(DA,3),"^")
"RTN","PSOCAN3",78,0)
 .S:'$P(^PSRX(DA,3),"^",5) $P(^PSRX(DA,3),"^",5)=DT
"RTN","PSOCAN3",79,0)
 .I $O(^PS(52.41,"ARF",DA,0)),'$O(^PS(52.41,"APSOD",PSODFN,0)) S HLDDA=DA,DA=$O(^PS(52.41,"ARF",DA,0)),DIK="^PS(52.41," D ^DIK S DA=HLDDA K HLDDA
"RTN","PSOCAN3",80,0)
 .;check for label/release/pending release
"RTN","PSOCAN3",81,0)
 .I $G(PSOOPT)'=3 D FILX
"RTN","PSOCAN3",82,0)
 S PSONOOR=$S($D(PSONOOR):PSONOOR,1:"D"),STAT=$S(REA="C":"OD",1:"SC"),PHARMST=$S(REA="C":"",1:"CM")
"RTN","PSOCAN3",83,0)
 S COM=$S(REA="C":$S($G(PSOOPT)=3&('$G(DUP)):"Renewed",1:"Discontinued")_" by Pharmacy",1:"Reinstated by Pharmacy")
"RTN","PSOCAN3",84,0)
 D EN^PSOHLSN1(DA,STAT,PHARMST,$S(COM["Discontinued"&($D(INCOM)):INCOM,1:COM),$S($G(PSOOPT)=3&('$G(DUP)):"",1:PSONOOR)) K COM,STAT,PHARMST,PSCANVAR
"RTN","PSOCAN3",85,0)
 I REA="C" D
"RTN","PSOCAN3",86,0)
 .I $G(^PS(52.4,DA,0))]"" S PSCDA=DA,DIK="^PS(52.4," D ^DIK S DA=PSCDA K DIK,PSCDA
"RTN","PSOCAN3",87,0)
 I $G(PSOMGDFN)'="" S PSODFN=PSOMGDFN K PSOMGDFN
"RTN","PSOCAN3",88,0)
 Q:(REA="C")!($P(^PSRX(DA,2),"^",10)]"")
"RTN","PSOCAN3",89,0)
 ;Q:(REA="C")!('$P($G(PSOPAR),"^",2))!($P(^PSRX(DA,2),"^",10)]"")
"RTN","PSOCAN3",90,0)
 Q:$D(^XUSEC("PSORPH",DUZ))  S PSVC=$P(^PSRX(DA,0),"^",16) F JJ=0:0 S JJ=$O(^PS(55,PSODFN,"P",JJ)) Q:'JJ  I $D(^(JJ,0)),+^(0)=DA Q
"RTN","PSOCAN3",91,0)
 I '$D(^XUSEC("PSORPH",DUZ)),'$P(PSOPAR,"^",2),'$P(PSOPAR,"^",16) Q
"RTN","PSOCAN3",92,0)
 Q:'JJ  S PSRXIN=DA,DIC="^PS(52.4,",DLAYGO=52.4,(X,DINUM)=PSRXIN,DIC(0)="ML"
"RTN","PSOCAN3",93,0)
 S DIC("DR")="1////"_$G(PSODFN)_";2////"_DUZ_";4////"_DT
"RTN","PSOCAN3",94,0)
 K DD,DO D FILE^DICN K DD,DO,DIC,DLAYGO,DINUM
"RTN","PSOCAN3",95,0)
 K DA,DIK S DA=PSRXIN K PSRXIN S $P(^PSRX(DA,"STA"),"^")=1 D NVER^PSOCAN2
"RTN","PSOCAN3",96,0)
 W !,"Rx # "_$P(^PSRX(DA,0),"^")_" is still non-verified!"
"RTN","PSOCAN3",97,0)
 Q
"RTN","PSOCAN3",98,0)
OERR I '$D(^XUSEC("PSORPH",DUZ)),'$P($G(PSOPAR),"^",2) S VALMSG="Invalid Action Selection!",VALMBCK="" Q
"RTN","PSOCAN3",99,0)
 S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient.") K PSOPLCK S VALMBCK="" Q
"RTN","PSOCAN3",100,0)
 K PSOPLCK S PSOCANRD=+$P($G(^PSRX($P(PSOLST(ORN),"^",2),0)),"^",4),PSOCANRA=1
"RTN","PSOCAN3",101,0)
 I $P(^PSRX($P(PSOLST(ORN),"^",2),"STA"),"^"),$P(^("STA"),"^")=1!($P(^("STA"),"^")=4) S:$G(SPEED) PSONOORS=$G(PSONOOR) D DEL^PSOCAN4 S:$G(PSONOORS)'="" PSONOOR=$G(PSONOORS) K PSONOORS D KCAN D ULP Q
"RTN","PSOCAN3",102,0)
 D PSOL^PSSLOCK($P(PSOLST(ORN),"^",2)) I '$G(PSOMSG) S VALMSG=$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order."),VALMBCK="" K PSOMSG D KCAN D ULP Q
"RTN","PSOCAN3",103,0)
 I '+^PSRX($P(PSOLST(ORN),"^",2),"OR1"),$P(^("STA"),"^")=12 S VALMSG="Rx Cannot be Reinstated.  No Orderable Item." D KCAN D ULP D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) Q
"RTN","PSOCAN3",104,0)
 I $P($G(^PSRX($P(PSOLST(ORN),"^",2),"STA")),"^")=12,$P($G(^("PKI")),"^") S VALMSG="Cannot be Reinstated - Digitally Signed" D KCAN D ULP D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) Q
"RTN","PSOCAN3",105,0)
 I $P($G(^PSRX($P(PSOLST(ORN),"^",2),"STA")),"^")=12 S PSOCANRZ=1
"RTN","PSOCAN3",106,0)
 D HLDHDR^PSOLMUTL S X=$P(^PSRX($P(PSOLST(ORN),"^",2),0),"^"),PS=$S($P(^PSRX($P(PSOLST(ORN),"^",2),"STA"),"^")=12:"Reinstate: ",1:"Discontinue: ")
"RTN","PSOCAN3",107,0)
 S POERR=1,DFNHLD=PSODFN,DA=$P(PSOLST(ORN),"^",2)
"RTN","PSOCAN3",108,0)
 I $P(^PSRX(DA,3),"^",5) S PSOCANHD=$P(^PSRX(DA,3),"^",5)
"RTN","PSOCAN3",109,0)
 D LMNO D:$P($G(^PSRX($P(PSOLST(ORN),"^",2),"STA")),"^")=12 RMP
"RTN","PSOCAN3",110,0)
 D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2))
"RTN","PSOCAN3",111,0)
 K POERR,PSCAN,PSI,PSL S PSODFN=DFNHLD K DFNHLD D ULP
"RTN","PSOCAN3",112,0)
 D KCAN
"RTN","PSOCAN3",113,0)
 Q
"RTN","PSOCAN3",114,0)
ULP D UL^PSSLOCK(+$G(PSODFN))
"RTN","PSOCAN3",115,0)
 Q
"RTN","PSOCAN3",116,0)
 ;
"RTN","PSOCAN3",117,0)
LMNO ; Calls LMNO^PSOCAN
"RTN","PSOCAN3",118,0)
 N PSODFN,PSORX,RXN,RX0
"RTN","PSOCAN3",119,0)
 S PSPOP=0,RXNUM=X S PSODFN=+$P(^PSRX(DA,0),"^",2) D LMNO^PSOCAN
"RTN","PSOCAN3",120,0)
 Q
"RTN","PSOCAN3",121,0)
 ;
"RTN","PSOCAN3",122,0)
KCAN ;
"RTN","PSOCAN3",123,0)
 K PSOCANRA,PSOCANRC,PSOCANRD,PSOCANRN,PSOCANRP,PSOCANRZ,PSOMSG,PSOCANHD
"RTN","PSOCAN3",124,0)
 Q
"RTN","PSOCAN3",125,0)
 ;
"RTN","PSOCAN3",126,0)
KCAN1 ;
"RTN","PSOCAN3",127,0)
 K PSOCANRC,PSOCANRD,PSOCANRN,PSOCANRP,PSOCANRZ
"RTN","PSOCAN3",128,0)
 Q
"RTN","PSOCAN3",129,0)
 ;
"RTN","PSOCAN3",130,0)
RMP D RMP^PSOCAN3N
"RTN","PSOCAN3",131,0)
 Q
"RTN","PSOCAN3",132,0)
 ;
"RTN","PSOCAN3",133,0)
FIL Q:'$G(PSORX)
"RTN","PSOCAN3",134,0)
 S PSOFC=PSORX G FILC
"RTN","PSOCAN3",135,0)
FILX Q:'$G(DA)
"RTN","PSOCAN3",136,0)
 S PSOFC=DA
"RTN","PSOCAN3",137,0)
FILC ;
"RTN","PSOCAN3",138,0)
 N PFC,PSOFFLAG
"RTN","PSOCAN3",139,0)
 I $P($G(^PSRX(PSOFC,2)),"^",13) G FILQ
"RTN","PSOCAN3",140,0)
 S PSOFFLAG=0 F PFC=0:0 S PFC=$O(^PSRX(PSOFC,1,PFC)) Q:'PFC!(PSOFFLAG)  I $P($G(^PSRX(PSOFC,1,PFC,0)),"^",18) S PSOFFLAG=1
"RTN","PSOCAN3",141,0)
 I PSOFFLAG G FILQ
"RTN","PSOCAN3",142,0)
 F PFC=0:0 S PFC=$O(^PSRX(PSOFC,"L",PFC)) Q:'PFC!(PSOFFLAG)  I $D(^PSRX(PSOFC,"L",PFC,0)),'$P($G(^(0)),"^",5) S PSOFFLAG=1
"RTN","PSOCAN3",143,0)
 I PSOFFLAG G FILQ
"RTN","PSOCAN3",144,0)
 S PSOFCSUS=$O(^PS(52.5,"B",PSOFC,0))
"RTN","PSOCAN3",145,0)
 I $G(PSOFCSUS),$P($G(^PS(52.5,PSOFCSUS,0)),"^",7)="L"!($P($G(^(0)),"^",7)="X") G FILQ
"RTN","PSOCAN3",146,0)
 S $P(^PSRX(PSOFC,3),"^",8)=$P($G(^PSRX(PSOFC,3)),"^",2)
"RTN","PSOCAN3",147,0)
 S $P(^PSRX(PSOFC,3),"^",2)=$P($G(^PSRX(PSOFC,2)),"^",2)
"RTN","PSOCAN3",148,0)
 I $P($G(^PSRX(PSOFC,"OR1")),"^",3) S $P(^PSRX(PSOFC,3),"^")=$P($G(^PSRX($P(^PSRX(PSOFC,"OR1"),"^",3),3)),"^")
"RTN","PSOCAN3",149,0)
FILQ K PSOFC,PSOFCSUS
"RTN","PSOCAN3",150,0)
 Q
"RTN","PSOCAN3",151,0)
 ;
"RTN","PSOCAN3",152,0)
SETC ;Called from Date of Death
"RTN","PSOCAN3",153,0)
 S $P(^PSRX(PSORX,"STA"),"^")=12,$P(^PSRX(PSORX,3),"^",5)=DT,$P(^PSRX(PSORX,3),"^",10)=$P(^PSRX(PSORX,3),"^") D CAN^PSOTPCAN(PSORX)
"RTN","PSOCAN3",154,0)
 D CHKCMOP^PSOUTL(PSORX,"D")
"RTN","PSOCAN3",155,0)
 Q
"RTN","PSOCMOP")
0^77^B39239270
"RTN","PSOCMOP",1,0)
PSOCMOP ;BIR/HTW-Rx Order Entry Screen for CMOP ;6/28/07 7:35am
"RTN","PSOCMOP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**2,16,21,27,43,61,126,148,274,347,251**;DEC 1997;Build 202
"RTN","PSOCMOP",3,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOCMOP",4,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOCMOP",5,0)
 ;External reference to ^PSDRUG supported by DBIA 3165
"RTN","PSOCMOP",6,0)
 ;External reference to ^PSSHUIDG supported by DBIA 3621
"RTN","PSOCMOP",7,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5424
"RTN","PSOCMOP",8,0)
TOP ;
"RTN","PSOCMOP",9,0)
 I $G(PSOFROM)="EDIT" S PPL=$G(PSORX("PSOL",1)) Q:$G(PPL)']""  G TEST
"RTN","PSOCMOP",10,0)
 I $G(PPL) G START
"RTN","PSOCMOP",11,0)
 I '$G(RXLTOP) S PPL=$G(DA) G TEST
"RTN","PSOCMOP",12,0)
 S:'$G(PPL) PPL=$G(PSORX("PSOL",1)) G:$G(PPL)']"" D1
"RTN","PSOCMOP",13,0)
START ;          Establish CMOP PPL
"RTN","PSOCMOP",14,0)
TEST N ACT,B,C,CK,COMM,CNT,DFLG,I,FLAG,MW,NEWDT,PI,P1,P2,REL,RFD,RX,RX0,RXN
"RTN","PSOCMOP",15,0)
 N RXP,RXS,SD,VALMSG,X,X7,Y,ZD,DFN,TRX
"RTN","PSOCMOP",16,0)
 S (P1,P2)=1,FLAG=0
"RTN","PSOCMOP",17,0)
LOOP F CNT=1:1 S RX=$P($G(PPL),",",CNT) Q:RX']""  D  S:'FLAG $P(RX("PSO"),",",P1)=RX,P1=P1+1 S FLAG=0
"RTN","PSOCMOP",18,0)
 .;   PSOMC=Mail Code, PSOMDT=Mail Code Expiration Date
"RTN","PSOCMOP",19,0)
 .N DFN  ;*347
"RTN","PSOCMOP",20,0)
 .S DFN=$P(^PSRX(RX,0),"^",2),PSOMDT=$P($G(^PS(55,DFN,0)),"^",5),PSOMC=$P($G(^PS(55,DFN,0)),"^",3) K DFN  ;*347
"RTN","PSOCMOP",21,0)
 .I (PSOMC>1&(PSOMDT>DT))!(PSOMC>1&(PSOMDT<1)) K PSOMC,PSOMDT Q  ;*347
"RTN","PSOCMOP",22,0)
 .;          Get drug IEN and check if CMOP
"RTN","PSOCMOP",23,0)
 .S CK=$P($G(^PSRX(RX,0)),"^",6) Q:'$D(^PSDRUG("AQ",CK))
"RTN","PSOCMOP",24,0)
 .;          If not marked for O.P., unmark for CMOP...
"RTN","PSOCMOP",25,0)
 .I $P($G(^PSDRUG(CK,2)),"^",3)'["O" D UNMARK^PSOCMOP Q
"RTN","PSOCMOP",26,0)
 .;          Check Drug Warning >11
"RTN","PSOCMOP",27,0)
 .N WARNS,COMM S WARNS=$P(^PSDRUG(CK,0),U,8) I $L(WARNS)>11 D  Q
"RTN","PSOCMOP",28,0)
 .. S COMM(1)="Rx# "_$P(^PSRX(RX,0),"^")_" CMOP cannot dispense - Drug warnings >11 characters."
"RTN","PSOCMOP",29,0)
 .. S COMM(2)="Drug Name: "_$P(^PSDRUG(CK,0),U)_"  (IEN: # "_CK_")"
"RTN","PSOCMOP",30,0)
 .. D COMM(RX,.COMM)
"RTN","PSOCMOP",31,0)
 .;           Q:If partial or pull early
"RTN","PSOCMOP",32,0)
 .Q:$G(RXPR(RX))!($G(RXRS(RX)))
"RTN","PSOCMOP",33,0)
 .;           Q:If standard reprint but allow edit reprint
"RTN","PSOCMOP",34,0)
 .I $G(RXRP(RX))&($P($G(RXRP(RX)),"^",4)'=1) Q
"RTN","PSOCMOP",35,0)
 .;           Q:If tradename
"RTN","PSOCMOP",36,0)
 .Q:$G(^PSRX(RX,"TN"))]""
"RTN","PSOCMOP",37,0)
 .;           Q: If Cancelled, Expired, Deleted, Hold
"RTN","PSOCMOP",38,0)
 .Q:$P(^PSRX(RX,"STA"),"^")>9!($P(^("STA"),"^")=4)!($P(^("STA"),"^")=3)
"RTN","PSOCMOP",39,0)
 .;        Find last fill
"RTN","PSOCMOP",40,0)
 .S RFD=0 F X7=0:0 S X7=$O(^PSRX(RX,1,X7)) Q:'$G(X7)  S (RFD)=X7
"RTN","PSOCMOP",41,0)
 .;if original fill and a tech stop
"RTN","PSOCMOP",42,0)
 .I 'RFD,$P(^PSRX(RX,"STA"),"^")=4!($D(^PSRX(RX,"DRI"))&('$D(^XUSEC("PSORPH",DUZ)))) Q
"RTN","PSOCMOP",43,0)
 .I 'RFD,$$DS^PSSDSAPI,($G(^PS(52.4,RX,1))>0)&('$D(^XUSEC("PSORPH",DUZ))) Q
"RTN","PSOCMOP",44,0)
 .Q:$G(RXFL(RX))&(RFD)&($G(RXFL(RX))'=RFD)
"RTN","PSOCMOP",45,0)
 .I '$O(^PSRX(RX,1,0)),'$P($G(^PSRX(RX,2)),"^",13),$P($G(^(0)),"^",11)="W",$S($P($G(^PSRX(RX,2)),"^",2):$P($G(^(2)),"^",2),1:+$G(PSOX("FILL DATE")))>DT D
"RTN","PSOCMOP",46,0)
 ..S PSOCPDA=$G(DA) K DIE S DA=RX,DIE="^PSRX(",DR="11////M" D ^DIE K DIE S:$G(PSOCPDA) DA=$G(PSOCPDA) K PSOCPDA
"RTN","PSOCMOP",47,0)
 .;           Q:If not "Mail"
"RTN","PSOCMOP",48,0)
 .S MW=$S($G(RFD)>0:$P(^PSRX(RX,1,RFD,0),"^",2),1:$P(^PSRX(RX,0),"^",11)) K X7 I $G(MW)="W"  K RFD Q
"RTN","PSOCMOP",49,0)
 .;
"RTN","PSOCMOP",50,0)
 .;           Q:If fill was CMOPed and other than a '3' 'not dispensed' 
"RTN","PSOCMOP",51,0)
 .Q:'$$FILTRAN(RX,RFD)
"RTN","PSOCMOP",52,0)
 .;
"RTN","PSOCMOP",53,0)
 .;            Check if released, for use in Sus
"RTN","PSOCMOP",54,0)
 .S REL=$S(RFD=0:$P($G(^PSRX(RX,2)),"^",13),1:$P($G(^PSRX(RX,1,RFD,0)),"^",18)) K RFD
"RTN","PSOCMOP",55,0)
 .I $G(REL) Q
"RTN","PSOCMOP",56,0)
 .;           Save CMOP's in PSXPPL1
"RTN","PSOCMOP",57,0)
 .S $P(RX("CMOP"),",",P2)=RX,P2=P2+1,FLAG=1 Q
"RTN","PSOCMOP",58,0)
 K PPL S PPL=$G(RX("PSO")),RX1("CMOP")=$G(RX("CMOP")) K RX("PSO")
"RTN","PSOCMOP",59,0)
 G:$G(XFROM)="EDIT" D1 ; passed from PSXEDIT
"RTN","PSOCMOP",60,0)
RESET ;
"RTN","PSOCMOP",61,0)
 G:'$G(RX("CMOP")) D1
"RTN","PSOCMOP",62,0)
 I $G(XFROM)="REINSTATE"!($G(XFROM)="UNHOLD") Q
"RTN","PSOCMOP",63,0)
 I $G(PSOFROM)="EDIT",($G(REL)]"") S PPL=RX("CMOP") G D1
"RTN","PSOCMOP",64,0)
S ;           Auto-Suspend CMOPS
"RTN","PSOCMOP",65,0)
 N DA,Y
"RTN","PSOCMOP",66,0)
 F PI=1:1 S DA=$P($G(RX("CMOP")),",",PI) Q:'DA  D SUS
"RTN","PSOCMOP",67,0)
 S SUSPT="SUSPENSE"
"RTN","PSOCMOP",68,0)
 G D1
"RTN","PSOCMOP",69,0)
SUS ;
"RTN","PSOCMOP",70,0)
 I $G(XFROM)="REINSTATE" W !,RX_" REINSTATED -- "
"RTN","PSOCMOP",71,0)
 S ACT=1,RXN=DA,RX0=^PSRX(DA,0),SD=$S($G(ZD(DA)):$E(ZD(DA),1,7),1:$P(^(3),"^")),RXS=$O(^PS(52.5,"B",DA,0)) I RXS D  Q:$G(DFLG)
"RTN","PSOCMOP",72,0)
 .S DA=RXS,DIK="^PS(52.5," D ^DIK S DA=RXN
"RTN","PSOCMOP",73,0)
 K X7 S RFD1=0 F X7=0:0 S X7=$O(^PSRX(DA,1,X7)) Q:'$G(X7)  S (RFD1)=X7
"RTN","PSOCMOP",74,0)
LOCK S RXP=+$G(RXPR(DA)),DIC="^PS(52.5,",DIC(0)="",X=RXN
"RTN","PSOCMOP",75,0)
 S DIC("DR")=".02////"_SD_";.03////"_$P(^PSRX(DA,0),"^",2)_";.04////M;.05////"_RXP_";.06////"_PSOSITE_";2////0;3////Q;9////"_RFD1
"RTN","PSOCMOP",76,0)
 K DD,DO D FILE^DICN K DD,DO S DA=RXN I +Y S PSONAME=$P(^PSRX(DA,0),"^",2) K ^PS(52.5,"AC",PSONAME,SD,+Y),PSONAME
"RTN","PSOCMOP",77,0)
 S $P(^PSRX(RXN,"STA"),"^")=5,LFD=$E(SD,4,5)_"-"_$E(SD,6,7)_"-"_$E(SD,2,3) D ACT
"RTN","PSOCMOP",78,0)
 W !!,"RX# ",$P(^PSRX(RXN,0),"^")_" HAS BEEN SUSPENDED for CMOP Until "_LFD_"."
"RTN","PSOCMOP",79,0)
 S VALMSG="Rx# "_$P(^PSRX(RXN,0),"^")_" Has Been Suspended for CMOP Until "_LFD_"."
"RTN","PSOCMOP",80,0)
 S COMM="Rx# "_$P(^PSRX(RXN,0),"^")_" Has Been Suspended for CMOP Until "_LFD_"."
"RTN","PSOCMOP",81,0)
 D EN^PSOHLSN1(RXN,"SC","ZS",COMM) K COMM
"RTN","PSOCMOP",82,0)
 ;- Calling ECME to reverse any PAYABLE claim for the prescription/fill
"RTN","PSOCMOP",83,0)
 D REVERSE^PSOBPSU1(RXN,,"DC",3)
"RTN","PSOCMOP",84,0)
 Q
"RTN","PSOCMOP",85,0)
ACT S RXF=0 F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RXF=I S:I>5 RXF=I+1
"RTN","PSOCMOP",86,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(DA,"A",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOCMOP",87,0)
 S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSOCMOP",88,0)
 D NOW^%DTC S ^PSRX(DA,"A",IR,0)=%_"^S^"_DUZ_"^"_RXF_"^"_"RX Placed on Suspense for CMOP until "_LFD
"RTN","PSOCMOP",89,0)
 K RXF,I,FDA,DIC,DIE,DR,Y,X,%,%H,%I
"RTN","PSOCMOP",90,0)
 Q
"RTN","PSOCMOP",91,0)
D1 K CNT,COUNT,DFLG,DIRUT,DIROUT,DTOUT,DUOUT,EXDT,FLAG,FLD,L,PDUZ,PI,X7
"RTN","PSOCMOP",92,0)
 K PSOCMOP,REF,REPRINT,RFDATE,RFL1,RFLL,RXPD,SD,SUSPT,WARN,XFROM,ZY,RX1
"RTN","PSOCMOP",93,0)
 Q
"RTN","PSOCMOP",94,0)
RXL N FROM S FROM=$G(PSOFROM)
"RTN","PSOCMOP",95,0)
 I ((FROM="NEW")!(FROM="REFILL")!(FROM="CANCEL")!(FROM="BATCH")!($G(XFROM)="HOLD")!($G(XFROM)="BATCH")) G TOP
"RTN","PSOCMOP",96,0)
 Q
"RTN","PSOCMOP",97,0)
SUS1 ;
"RTN","PSOCMOP",98,0)
 N PPL
"RTN","PSOCMOP",99,0)
 S PPL=DA D TEST
"RTN","PSOCMOP",100,0)
 I $G(PPL)']"" S XFLAG=1
"RTN","PSOCMOP",101,0)
 S RX("CMOP")=$G(RX1("CMOP"))
"RTN","PSOCMOP",102,0)
 Q
"RTN","PSOCMOP",103,0)
A S:'$G(PPL) PPL=$G(PSORX("PSOL",PPL1)) G:$G(PPL)']"" D1
"RTN","PSOCMOP",104,0)
 G TEST
"RTN","PSOCMOP",105,0)
UNMARK ;Entry point to unmark drug for CMOP dispense
"RTN","PSOCMOP",106,0)
 N X,Z,%
"RTN","PSOCMOP",107,0)
 S $P(^PSDRUG(CK,3),"^",1)=0 K ^PSDRUG("AQ",CK)
"RTN","PSOCMOP",108,0)
 S:'$D(^PSDRUG(CK,4,0)) ^PSDRUG(CK,4,0)="^50.0214DA^^"
"RTN","PSOCMOP",109,0)
 S (X,Z)=0 F  S Z=$O(^PSDRUG(CK,4,Z)) Q:'Z  S X=Z
"RTN","PSOCMOP",110,0)
 S X=X+1 D NOW^%DTC S ^PSDRUG(CK,4,X,0)=%_"^E^"_DUZ_"^CMOP Dispense^"_$S($G(^PSDRUG(CK,3))=1:"YES",$G(^PSDRUG(CK,3))=0:"NO",1:"")
"RTN","PSOCMOP",111,0)
 S $P(^PSDRUG(CK,4,0),"^",3)=X,$P(^(0),"^",4)=$P(^(0),"^",4)+1
"RTN","PSOCMOP",112,0)
 I $$PATCH^XPDUTL("PSS*1.0*70") D DRG^PSSHUIDG(CK)
"RTN","PSOCMOP",113,0)
 K X,Z,%
"RTN","PSOCMOP",114,0)
 Q
"RTN","PSOCMOP",115,0)
FILTRAN(RX,RFD) ; Test fill's CMOP tran status, return 1 if OK to send
"RTN","PSOCMOP",116,0)
 N DA,CMOP
"RTN","PSOCMOP",117,0)
 S DA=RX
"RTN","PSOCMOP",118,0)
 D ^PSOCMOPA
"RTN","PSOCMOP",119,0)
 I '$D(CMOP(RFD)) Q 1
"RTN","PSOCMOP",120,0)
 I CMOP(RFD)=3 Q 1
"RTN","PSOCMOP",121,0)
 Q 0
"RTN","PSOCMOP",122,0)
COMM(RXN,COMM) ;EP process problem message to g.cmop managers
"RTN","PSOCMOP",123,0)
 N XMSUB,XMTEXT
"RTN","PSOCMOP",124,0)
 S XMTEXT="COMM(",XMY("I:G.CMOP MANAGERS")=""
"RTN","PSOCMOP",125,0)
 S XMSUB="CMOP RX PROBLEM ENCOUNTERED"
"RTN","PSOCMOP",126,0)
 D ^XMD
"RTN","PSOCMOP",127,0)
 Q
"RTN","PSOCMOP",128,0)
CMPRXTYP(SUSDA) ; given suspense record SUSDA returns RX CMOP TYPE C - CS, N -Non-CS
"RTN","PSOCMOP",129,0)
 ;used in compound index ^PS(52.5,"CMP",STAT,TYP,DIV,DATE,DFN,DA)
"RTN","PSOCMOP",130,0)
 N RXDA,DRGDA,DEA,TYP
"RTN","PSOCMOP",131,0)
 S RXDA=$P(^PS(52.5,SUSDA,0),U),DRGDA=$P(^PSRX(RXDA,0),U,6)
"RTN","PSOCMOP",132,0)
 S TYP="N",DEA=$P(^PSDRUG(DRGDA,0),U,3) F I=3,4,5 I DEA[I S TYP="C"
"RTN","PSOCMOP",133,0)
 Q TYP
"RTN","PSOCMOP",134,0)
NOW() D NOW^%DTC Q %
"RTN","PSOCMOP",135,0)
 ;
"RTN","PSOCMOP",136,0)
PIECE(REC,DLM,VP) ; VP="Variable^Piece"
"RTN","PSOCMOP",137,0)
 ; Set Variable V = piece P of REC using delimiter DLM
"RTN","PSOCMOP",138,0)
 N V,P S V=$P(VP,U),P=$P(VP,U,2),@V=$P(REC,DLM,P)
"RTN","PSOCMOP",139,0)
 Q
"RTN","PSOCMOP",140,0)
PUT(REC,DLM,VP) ; VP="Variable^Piece"
"RTN","PSOCMOP",141,0)
 ; pass by reference D PUT^PSOCMOP(.REC,DLM,VP)
"RTN","PSOCMOP",142,0)
 ; Set Variable V into piece P of REC using delimiter DLM
"RTN","PSOCMOP",143,0)
 N V,P S V=$P(VP,U),P=$P(VP,U,2)
"RTN","PSOCMOP",144,0)
 S $P(REC,DLM,P)=$G(@V)
"RTN","PSOCMOP",145,0)
 Q
"RTN","PSOCMOP",146,0)
KCMPX(SUS,VAL) ; Kill ^PS(52.5,"CMP",VAL index given SUS
"RTN","PSOCMOP",147,0)
 N SDT,TYP,DFN,DIV,RX,F,XX
"RTN","PSOCMOP",148,0)
 S F=$G(^PS(52.5,SUS,0)) Q:'+F  S TYP=$$CMPRXTYP(SUS)
"RTN","PSOCMOP",149,0)
 F XX="RX^1","SDT^2","DFN^3","DIV^6" D PIECE(F,U,XX)
"RTN","PSOCMOP",150,0)
 K ^PS(52.5,"CMP",VAL,TYP,DIV,SDT,DFN,SUS)
"RTN","PSOCMOP",151,0)
 Q
"RTN","PSOCMOP",152,0)
SCMPX(SUS,VAL) ; Set  ^PS(52.5,"CMP",VAL index given SUS
"RTN","PSOCMOP",153,0)
 N SDT,TYP,DFN,DIV,RX,F,XX
"RTN","PSOCMOP",154,0)
 S F=$G(^PS(52.5,SUS,0)) Q:'+F  S TYP=$$CMPRXTYP(SUS)
"RTN","PSOCMOP",155,0)
 F XX="RX^1","SDT^2","DFN^3","DIV^6" D PIECE(F,U,XX)
"RTN","PSOCMOP",156,0)
 S ^PS(52.5,"CMP",VAL,TYP,DIV,SDT,DFN,SUS)=""
"RTN","PSOCMOP",157,0)
 Q
"RTN","PSOCPPRE")
0^7^B10424566
"RTN","PSOCPPRE",1,0)
PSOCPPRE ;BIR/SAB - enhanced dup drug checker for copy orders ;09/21/06 11:34am
"RTN","PSOCPPRE",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**251**;DEC 1997;Build 202
"RTN","PSOCPPRE",3,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOCPPRE",4,0)
 ;External references to ^ORRDI1 supported by DBIA 4659
"RTN","PSOCPPRE",5,0)
 ;External references to ^XTMP("ORRDI" supported by DBIA 4660
"RTN","PSOCPPRE",6,0)
 ;External references to ^PSSHRQ2 supported by DBIA 5369
"RTN","PSOCPPRE",7,0)
 S LIST="PSOPEP",$P(PSONULN,"-",79)="-",(STA,DNM)="" N PSODLQT
"RTN","PSOCPPRE",8,0)
 F  S STA=$O(PSOSD(STA)) Q:STA=""  F  S DNM=$O(PSOSD(STA,DNM)) Q:DNM=""  D  Q:$G(PSORX("DFLG"))
"RTN","PSOCPPRE",9,0)
 .I STA="PENDING" D ^PSODDPR1 Q
"RTN","PSOCPPRE",10,0)
 .I STA="ZNONVA" D NVA^PSODDPR1 Q
"RTN","PSOCPPRE",11,0)
 .D:PSODRUG("NAME")=$P(DNM,"^")&('$D(^XUSEC("PSORPH",DUZ)))  Q:$G(PSORX("DFLG"))
"RTN","PSOCPPRE",12,0)
 ..I $P($G(PSOPAR),"^",16) D DUP^PSODDPRE Q:$G(PSORX("DFLG"))
"RTN","PSOCPPRE",13,0)
 ..I $P(PSOPAR,"^",2),'$P($G(PSOPAR),"^",16) D DUP^PSODDPRE Q:$G(PSORX("DFLG"))
"RTN","PSOCPPRE",14,0)
 ..I '$P(PSOPAR,"^",2),'$P($G(PSOPAR),"^",16) D DUP^PSODDPRE Q:$G(PSORX("DFLG"))
"RTN","PSOCPPRE",15,0)
 .D:PSODRUG("NAME")=$P(DNM,"^")&($D(^XUSEC("PSORPH",DUZ))) DUP^PSODDPRE
"RTN","PSOCPPRE",16,0)
 Q:$G(PSORX("DFLG"))
"RTN","PSOCPPRE",17,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSOCPPRE",18,0)
 D REMOTE
"RTN","PSOCPPRE",19,0)
 Q
"RTN","PSOCPPRE",20,0)
OBX S LIST="PSOPEPS"
"RTN","PSOCPPRE",21,0)
 K ^TMP($J,"DD"),^TMP($J,"DC"),^TMP($J,"DI"),^TMP($J,LIST),PSODLQT,DTOUT,DUOUT,DIRUT,PSODOSD
"RTN","PSOCPPRE",22,0)
 K HZVA,ZVA,ZORS,ZZDGDG,ON,DRG,SV,DGI,PSORX("INTERVENE"),DIR,ZTHER,IT
"RTN","PSOCPPRE",23,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSOCPPRE",24,0)
 S ^TMP($J,LIST,"IN","PING")="" D IN^PSSHRQ2(LIST)
"RTN","PSOCPPRE",25,0)
 I $P(^TMP($J,LIST,"OUT",0),"^")=-1 K DIR D  G EXIT
"RTN","PSOCPPRE",26,0)
 .S DIR(0)="E",DIR("A",1)="No Enhanced Order Checks can be performed."
"RTN","PSOCPPRE",27,0)
 .S DIR("A",2)="   Reason: "_$P($G(^TMP($J,LIST,"OUT",0)),"^",2)
"RTN","PSOCPPRE",28,0)
 .S DIR("A")="Press Return to continue...",DIR("?")="Press Return to continue"
"RTN","PSOCPPRE",29,0)
 .W ! D ^DIR K DIRUT,DUOUT,DIR,X,Y I ($Y+5)>IOSL W @IOF
"RTN","PSOCPPRE",30,0)
 K ^TMP($J,LIST,"IN","PING"),^TMP($J,LIST,"OUT","DRUGDRUG"),^TMP($J,LIST,"OUT","THERAPY")
"RTN","PSOCPPRE",31,0)
 W !,"Now Processing Enhanced Order Checks!  Please wait...",!
"RTN","PSOCPPRE",32,0)
 D FDB^PSODDPRE S PDRG=PSODRUG("IEN"),DO=0 D REMOTE^PSODDPR4
"RTN","PSOCPPRE",33,0)
 D IN^PSSHRQ2(LIST)    ;if patient has meds
"RTN","PSOCPPRE",34,0)
 I $P(^TMP($J,LIST,"OUT",0),"^")'=-1 D ^PSODDPR2 ;if order checks returned
"RTN","PSOCPPRE",35,0)
EXIT ;
"RTN","PSOCPPRE",36,0)
 I $G(PSODLQT)!$G(PSORX("DFLG")) S PSODOSD=1
"RTN","PSOCPPRE",37,0)
 D ^PSOBUILD K CAN,DA,DIR,DNM,DUPRX0,ISSD,J,LSTFL,MSG,PHYS,PSOCLC,PSONULN,REA,RFLS,RX0,RX2,RXREC,ST,Y,ZZ,ACT,PSOCLOZ,PSOLR,PSOLDT,PSOCD,SIG
"RTN","PSOCPPRE",38,0)
 K ^TMP($J,LIST,"IN","PING"),^TMP($J,LIST,"OUT","DRUGDRUG"),^TMP($J,LIST,"OUT","THERAPY")
"RTN","PSOCPPRE",39,0)
 K DO,LIST,DNM,PSONULN,PSORX("DFLG"),RXRECCOP,STA,Y,PSODLQT
"RTN","PSOCPPRE",40,0)
 K HZVA,ZVA,ZORS,ZZDGDG,ON,DRG,SV,DGI,PSORX("INTERVENE"),DIR,ZTHER,IT
"RTN","PSOCPPRE",41,0)
 S VALMBCK="R"
"RTN","PSOCPPRE",42,0)
 Q
"RTN","PSOCPPRE",43,0)
ULRX ;
"RTN","PSOCPPRE",44,0)
 I '$G(RXRECCOP) Q
"RTN","PSOCPPRE",45,0)
 D PSOUL^PSSLOCK(RXRECCOP)
"RTN","PSOCPPRE",46,0)
 Q
"RTN","PSOCPPRE",47,0)
 ;
"RTN","PSOCPPRE",48,0)
REMOTE ;
"RTN","PSOCPPRE",49,0)
 I $T(HAVEHDR^ORRDI1)']"" Q
"RTN","PSOCPPRE",50,0)
 I '$$HAVEHDR^ORRDI1 Q
"RTN","PSOCPPRE",51,0)
 I $D(^XTMP("ORRDI","OUTAGE INFO","DOWN")) G REMOTE2
"RTN","PSOCPPRE",52,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSOCPPRE",53,0)
 W !!,"Now doing remote order checks. Please wait...",!
"RTN","PSOCPPRE",54,0)
 D REMOTE^PSOORRDI(PSODFN,PSODRUG("IEN"))
"RTN","PSOCPPRE",55,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSOCPPRE",56,0)
 I '$D(^XUSEC("PSORPH",DUZ)),$P(PSOPAR,"^",2),$G(PSOTECCK) G REMOTE2
"RTN","PSOCPPRE",57,0)
 I $D(^TMP($J,"DD")) D DUP^PSOORRD2
"RTN","PSOCPPRE",58,0)
REMOTE2 ;
"RTN","PSOCPPRE",59,0)
 K ^TMP($J,"DD"),^TMP($J,"DC"),^TMP($J,"DI")
"RTN","PSOCPPRE",60,0)
 Q
"RTN","PSODDPR1")
0^8^B53867555
"RTN","PSODDPR1",1,0)
PSODDPR1 ;BIR/SAB - enhanced dup drug checker for pending/nva orders ;09/30/06 11:33am
"RTN","PSODDPR1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**251**;DEC 1997;Build 202
"RTN","PSODDPR1",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSODDPR1",4,0)
 ;External reference to ^PS(50.606 supported by DBIA 2174
"RTN","PSODDPR1",5,0)
 ;External reference to ^PS(51.2 supported by DBIA 2226
"RTN","PSODDPR1",6,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSODDPR1",7,0)
 ;External reference to ^SC supported by DBIA 10040
"RTN","PSODDPR1",8,0)
 ;External reference to ^PS(56 supported by DBIA 2229
"RTN","PSODDPR1",9,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSODDPR1",10,0)
 N DUP,DUPRX0,ISSD,IT,MSG,PSONV,RFLS,TY,Y
"RTN","PSODDPR1",11,0)
 S RXREC=$P(PSOSD(STA,DNM),"^",10)
"RTN","PSODDPR1",12,0)
 Q:'$D(^PS(52.41,RXREC,0))
"RTN","PSODDPR1",13,0)
 Q:$P($G(^PS(52.41,RXREC,0)),"^",3)="RF"
"RTN","PSODDPR1",14,0)
 I $G(ORD) D  K FSIG Q
"RTN","PSODDPR1",15,0)
 .D:ORD'=RXREC&($G(PSODRUG("NAME"))=$P(DNM,"^"))&('$D(^XUSEC("PSORPH",DUZ)))  Q:$G(PSORX("DFLG"))
"RTN","PSODDPR1",16,0)
 ..I $P(PSOPAR,"^",2),$G(PSOTECCK) Q
"RTN","PSODDPR1",17,0)
 ..I $P($G(PSOPAR),"^",16) D DUP Q:$G(PSORX("DFLG"))
"RTN","PSODDPR1",18,0)
 ..I $P($G(PSOPAR),"^",2),'$P(PSOPAR,"^",16) D DUP Q:$G(PSORX("DFLG"))
"RTN","PSODDPR1",19,0)
 ..I '$P(PSOPAR,"^",2),'$P(PSOPAR,"^",16) D DUP Q:$G(PSORX("DFLG"))
"RTN","PSODDPR1",20,0)
 .I $D(^XUSEC("PSORPH",DUZ)) D:ORD'=RXREC&($G(PSODRUG("NAME"))=$P(DNM,"^")) DUP Q:$G(PSORX("DFLG"))
"RTN","PSODDPR1",21,0)
 ;backdoor orders
"RTN","PSODDPR1",22,0)
 Q:'$P($G(^PS(52.41,RXREC,0)),"^",9)
"RTN","PSODDPR1",23,0)
 D:PSODRUG("NAME")=$P(DNM,"^")&('$D(^XUSEC("PSORPH",DUZ)))  I $G(PSORX("DFLG")) K FSIG Q
"RTN","PSODDPR1",24,0)
 .I $P($G(PSOPAR),"^",16) D DUP Q:$G(PSORX("DFLG"))
"RTN","PSODDPR1",25,0)
 .I $P($G(PSOPAR),"^",2),'$P(PSOPAR,"^",16) D DUP Q:$G(PSORX("DFLG"))
"RTN","PSODDPR1",26,0)
 .I '$P(PSOPAR,"^",2),'$P(PSOPAR,"^",16) D DUP Q:$G(PSORX("DFLG"))
"RTN","PSODDPR1",27,0)
 D:PSODRUG("NAME")=$P(DNM,"^")&($D(^XUSEC("PSORPH",DUZ))) DUP Q:$G(PSORX("DFLG"))
"RTN","PSODDPR1",28,0)
 K FSIG Q
"RTN","PSODDPR1",29,0)
DUP D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)  S DUP=1 W !,PSONULN,!,$C(7),"DUPLICATE DRUG in a Pending Order for",!
"RTN","PSODDPR1",30,0)
 S MSG="Discontinued During "_$S('$G(PSONV):"New Prescription Entry",1:"Verification")_" - Duplicate Drug."
"RTN","PSODDPR1",31,0)
DATA S DUPRX0=^PS(52.41,RXREC,0),RFLS=$P(DUPRX0,"^",11),ISSD=$P(DUPRX0,"^",6)
"RTN","PSODDPR1",32,0)
 S RXRECLOD=RXREC N DNM,ACT
"RTN","PSODDPR1",33,0)
 I '$P(DUPRX0,"^",9) W !,$J("Orderable Item: ",20)_$P(^PS(50.7,$P(DUPRX0,"^",8),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSODDPR1",34,0)
 E  W !,$J("Drug: ",20)_$S($P(DUPRX0,"^",9):$P(^PSDRUG($P(DUPRX0,"^",9),0),"^"),1:"No Dispense Drug Selected")
"RTN","PSODDPR1",35,0)
 S DNM=$S($P(DUPRX0,"^",9):$P(^PSDRUG($P(DUPRX0,"^",9),0),"^"),1:$P(^PS(50.7,$P(DUPRX0,"^",8),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^"))
"RTN","PSODDPR1",36,0)
 D FSIG^PSOUTLA("P",RXREC,50)
"RTN","PSODDPR1",37,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)
"RTN","PSODDPR1",38,0)
 W !,$J("SIG: ",20) F I=0:0 S I=$O(FSIG(I)) Q:'I  W $J(FSIG(I),20) I $O(FSIG(I)) W !?8
"RTN","PSODDPR1",39,0)
 W !,$J("Quantity: ",20)_$P(DUPRX0,"^",10),?35,$J("# of Refills: ",20)_$P(DUPRX0,"^",11)
"RTN","PSODDPR1",40,0)
 W !,$J("Provider: ",20)_$P(^VA(200,$P(DUPRX0,"^",5),0),"^")
"RTN","PSODDPR1",41,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)
"RTN","PSODDPR1",42,0)
 S Y=$P(DUPRX0,"^",6) X ^DD("DD") W ?30,$J("Issue Date: ",20)_Y
"RTN","PSODDPR1",43,0)
 S TY=3 D INST
"RTN","PSODDPR1",44,0)
 W !,PSONULN,! I $P($G(^PS(53,+$P($G(PSORX("PATIENT STATUS")),"^"),0)),"^")["AUTH ABS"!($G(PSORX("PATIENT STATUS"))["AUTH ABS")&'$P(PSOPAR,"^",5) W !,"PATIENT ON AUTHORIZED ABSENCE!" K RXRECLOD Q
"RTN","PSODDPR1",45,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)
"RTN","PSODDPR1",46,0)
ASKCAN  ;
"RTN","PSODDPR1",47,0)
 I '$P(PSOPAR,"^",16),'$D(^XUSEC("PSORPH",DUZ)) D  Q
"RTN","PSODDPR1",48,0)
 .S PSORX("DFLG")=1 K RXRECLOC,DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSODDPR1",49,0)
 D PSOL^PSSLOCK(RXRECLOD_"S") I '$G(PSOMSG) D  K PSOMSG,DIR,DUP,RXRECLOD S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to continue" D ^DIR K DIR S PSORX("DFLG")=1 Q
"RTN","PSODDPR1",50,0)
 .I $P($G(PSOMSG),"^",2)'="" W !!,$P(PSOMSG,"^",2),! Q
"RTN","PSODDPR1",51,0)
 .W !!,"Another person is editing this pending order.",!
"RTN","PSODDPR1",52,0)
 K PSOMSG S DIR("A")="Discontinue Pending Order for "_DNM_" Y/N",DIR(0)="Y",DIR("?")="Enter Y to Discontinue this pending order."
"RTN","PSODDPR1",53,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)
"RTN","PSODDPR1",54,0)
 D ^DIR K DIR
"RTN","PSODDPR1",55,0)
 I 'Y W !,$C(7)," Pending Order was not discontinued..." S:$G(DUP) PSORX("DFLG")=1 K DUP,CLS D ULPN Q
"RTN","PSODDPR1",56,0)
 S ACT="Discontinued while "_$S('$G(PSONV):"entering",1:"verifying")_" new RX"
"RTN","PSODDPR1",57,0)
 K ^UTILITY($J,"W") S DIWL=1,DIWR=75,DIWF=""
"RTN","PSODDPR1",58,0)
 W ! S X="Pending Order for "_DNM_" will be discontinued after the acceptance of the new order." D ^DIWP
"RTN","PSODDPR1",59,0)
 F ZX=0:0 S ZX=$O(^UTILITY($J,"W",1,ZX)) Q:'ZX  W !,^UTILITY($J,"W",1,ZX,0)
"RTN","PSODDPR1",60,0)
 K ^UTILITY($J,"W"),X,DIWL,DIWR,DIWF W ! H 2
"RTN","PSODDPR1",61,0)
 S ^TMP("PSORXDC",$J,RXREC,0)="P^"_RXREC_"^"_MSG_"^^^^"_DNM
"RTN","PSODDPR1",62,0)
 K CLS,DUP,PSOSD(STA,DNM),DNM
"RTN","PSODDPR1",63,0)
 Q
"RTN","PSODDPR1",64,0)
INST ;displays instruction and/or comments
"RTN","PSODDPR1",65,0)
 S INST=0 F  S INST=$O(^PS(52.41,RXREC,TY,INST)) Q:'INST  S MIG=^PS(52.41,RXREC,TY,INST,0) D
"RTN","PSODDPR1",66,0)
 .W !,$S(TY=2:"      Instructions: ",TY=3:" Provider Comments: ",1:"")
"RTN","PSODDPR1",67,0)
 .F SG=1:1:$L(MIG," ") W:$X+$L($P(MIG," ",SG)_" ")>IOM @$S(TY=3:"!?14",1:"!?19") W $P(MIG," ",SG)_" "
"RTN","PSODDPR1",68,0)
 K INST,TY,MIG,SG
"RTN","PSODDPR1",69,0)
 Q
"RTN","PSODDPR1",70,0)
ULPN ;
"RTN","PSODDPR1",71,0)
 I '$G(RXRECLOD) Q
"RTN","PSODDPR1",72,0)
 D PSOUL^PSSLOCK(RXRECLOD_"S") K RXRECLOD
"RTN","PSODDPR1",73,0)
 Q
"RTN","PSODDPR1",74,0)
NVA ;displays duplicate drugs and classes for non-va meds
"RTN","PSODDPR1",75,0)
 I $G(IT) D  Q
"RTN","PSODDPR1",76,0)
 .S SER=$P($G(^PS(56,IT,0)),"^",4)
"RTN","PSODDPR1",77,0)
 .W "***"_$S(SER=1:"Critical",1:"Significant")_"*** Drug Interaction with a Non-VA Med Order.",!,"Drug: "_$P(DNM,"^")
"RTN","PSODDPR1",78,0)
 .K DIR,DIRUT,DTOUT,DUOUT S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to continue" D ^DIR K DIR,DIRUT,DTOUT,DUOUT
"RTN","PSODDPR1",79,0)
 Q:'$D(^PS(55,PSODFN,"NVA",$P(PSOSD(STA,DNM),"^",10),0))
"RTN","PSODDPR1",80,0)
 I '$D(^XUSEC("PSORPH",DUZ)),$P(PSOPAR,"^",2),$G(PSOTECCK) Q
"RTN","PSODDPR1",81,0)
 S IFN=$P(PSOSD(STA,DNM),"^",10),RXREC=IFN
"RTN","PSODDPR1",82,0)
 I '$G(IT),$G(PSODRUG("NAME"))=$P(DNM,"^") D DSP Q
"RTN","PSODDPR1",83,0)
 Q
"RTN","PSODDPR1",84,0)
DSP S $P(PSONULN,"-",79)="-"
"RTN","PSODDPR1",85,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)  W !,PSONULN,!,"Duplicate Drug in a Non-VA Med Order for",!
"RTN","PSODDPR1",86,0)
 S DUPRX0=^PS(55,PSODFN,"NVA",RXREC,0)
"RTN","PSODDPR1",87,0)
 ;W !,$J("Orderable Item: ",20)_$P(^PS(50.7,$P(DUPRX0,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSODDPR1",88,0)
 W !,$J("Drug: ",20)_$S($P(DUPRX0,"^",2):$P(^PSDRUG($P(DUPRX0,"^",2),0),"^"),1:"No Dispense Drug Selected")
"RTN","PSODDPR1",89,0)
 ;W !,$J("Drug Class: ",20)_$G(PSODRUG("VA CLASS"))
"RTN","PSODDPR1",90,0)
 W !,$J("Dosage: ",20)_$S($P(DUPRX0,"^",3):$P(DUPRX0,"^",3),1:"<NOT ENTERED>")
"RTN","PSODDPR1",91,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)
"RTN","PSODDPR1",92,0)
 W !,$J("Schedule: ",20)_$S($P(DUPRX0,"^",5)]"":$P(DUPRX0,"^",5),1:"<NOT ENTERED>"),!,$J("Medication Route: ",20)_$S($P(DUPRX0,"^",4)]"":$P(DUPRX0,"^",4),1:"<NOT ENTERED>")
"RTN","PSODDPR1",93,0)
 W !,$J("Start Date: ",20)_$S($P(DUPRX0,"^",9):$$FMTE^XLFDT($P(DUPRX0,"^",9)),1:"<NOT ENTERED>")
"RTN","PSODDPR1",94,0)
 W ?40,$J("CPRS Order #: ",20)_$P(DUPRX0,"^",8)
"RTN","PSODDPR1",95,0)
 W !,$J("Documented By: ",20)_$P(^VA(200,$P(DUPRX0,"^",11),0),"^")_" on "_$$FMTE^XLFDT($P(DUPRX0,"^",10))
"RTN","PSODDPR1",96,0)
 W !,PSONULN,!
"RTN","PSODDPR1",97,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)
"RTN","PSODDPR1",98,0)
 S ^TMP($J,"PSONVADD",RXREC,0)=1
"RTN","PSODDPR1",99,0)
 K RX3,LSTFL,PSONULN,ISSD,J,LSTFD,PHYS,ST,TRM,DUPRX0,FL,FSIG,I,IFN,RFLS,RXREC,X,Y,IEN,DSC,REA,OCK,ORD1
"RTN","PSODDPR1",100,0)
 K DIR,DIRUT,DTOUT,DUOUT S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to continue" D ^DIR K DIR,DIRUT,DTOUT,DUOUT
"RTN","PSODDPR1",101,0)
 Q
"RTN","PSODDPR1",102,0)
 F I=0:0 S I=$O(^PS(55,PSODFN,"NVA",IFN,"OCK",I)) Q:'I  D  W !
"RTN","PSODDPR1",103,0)
 .I $Y+3>IOSL D  W @IOF
"RTN","PSODDPR1",104,0)
 ..K DIR,DIRUT,DUOUT S DIR(0)="E",DIR("A")="Press Return to Continue or ""^"" to Stop" D ^DIR
"RTN","PSODDPR1",105,0)
 ..I $G(DUOUT) S NVAQ=1
"RTN","PSODDPR1",106,0)
 .Q:$G(NVAQ)
"RTN","PSODDPR1",107,0)
 .S ORD1=$P(^PS(55,PSODFN,"NVA",IFN,"OCK",I,0),"^"),ORP=$P(^(0),"^",2)
"RTN","PSODDPR1",108,0)
 .W !,"Order Check #"_I_": "
"RTN","PSODDPR1",109,0)
 .K OCK,LEN I $L(ORD1)>70 S (LEN,IEN)=1 D
"RTN","PSODDPR1",110,0)
 ..F SG=1:1:$L(ORD1) S:$L($G(OCK(IEN))_" "_$P(ORD1," ",SG))>75&($P(ORD1," ",SG)]"") IEN=IEN+1 S:$P(ORD1," ",SG)'="" OCK(IEN)=$G(OCK(IEN))_" "_$P(ORD1," ",SG)
"RTN","PSODDPR1",111,0)
 ..F II=0:0 S II=$O(OCK(II)) Q:'II  W !?5,OCK(II)
"RTN","PSODDPR1",112,0)
 .W:'$G(LEN) ORD1 K LEN,SG,IEN,II,OCK,ORD1
"RTN","PSODDPR1",113,0)
 .W !,"Overriding Provider: "_$S($G(ORP):$P(^VA(200,ORP,0),"^"),1:"")
"RTN","PSODDPR1",114,0)
 .K ORP,OCK,REA W !,"Reason:" F SS=0:0 S SS=$O(^PS(55,PSODFN,"NVA",IFN,"OCK",I,"OVR",SS)) Q:'SS  S REA(SS)=^PS(55,PSODFN,"NVA",IFN,"OCK",I,"OVR",SS,0)
"RTN","PSODDPR1",115,0)
 .I '$O(REA(0)) W " <NOT ENTERED>"
"RTN","PSODDPR1",116,0)
 .S IEN=1 F II=0:0 S II=$O(REA(II)) Q:'II  D
"RTN","PSODDPR1",117,0)
 ..F SG=1:1:$L(REA(II)) S:$L($G(OCK(IEN))_" "_$P(REA(II)," ",SG))>70&($P(REA(II)," ",SG)]"") IEN=IEN+1 S:$P(REA(II)," ",SG)'="" OCK(IEN)=$G(OCK(IEN))_" "_$P(REA(II)," ",SG)
"RTN","PSODDPR1",118,0)
 ..K REA,IEN,SG F II=0:0 S II=$O(OCK(II)) Q:'II  W OCK(II) I $O(OCK(II)) W !?5
"RTN","PSODDPR1",119,0)
 .K OCK W !,"Statement/Explanation/Comments:" F SS=0:0 S SS=$O(^PS(55,PSODFN,"NVA",IFN,"DSC",SS)) Q:'SS  S DSC(SS)=^PS(55,PSODFN,"NVA",IFN,"DSC",SS,0)
"RTN","PSODDPR1",120,0)
 .S IEN=1 F II=0:0 S II=$O(DSC(II)) Q:'II  D
"RTN","PSODDPR1",121,0)
 ..F SG=1:1:$L(DSC(II)) S:$L($G(OCK(IEN))_" "_$P(DSC(II)," ",SG))>70&($P(DSC(II)," ",SG)]"") IEN=IEN+1 S:$P(DSC(II)," ",SG)'="" OCK(IEN)=$G(OCK(IEN))_" "_$P(DSC(II)," ",SG)
"RTN","PSODDPR1",122,0)
 ..K IEN,DSC,SG F II=0:0 S II=$O(OCK(II)) Q:'II  W !?5,OCK(II)
"RTN","PSODDPR1",123,0)
 Q
"RTN","PSODDPR1",124,0)
 ;
"RTN","PSODDPR2")
0^9^B152050761
"RTN","PSODDPR2",1,0)
PSODDPR2 ;BIR/SAB - display enhanced order checks ;11 May 2010  9:06 AM
"RTN","PSODDPR2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**251**;DEC 1997;Build 202
"RTN","PSODDPR2",3,0)
 ;
"RTN","PSODDPR2",4,0)
 K ^UTILITY($J),PSODRUG("BAD"),THER,THERO,^TMP($J,"PSODCOR"),PSOINTV,PSOVAG,PSODD,PSI,PSORDIT
"RTN","PSODDPR2",5,0)
 I $O(^TMP($J,LIST,"OUT","EXCEPTIONS",""))]"" D EXC^PSODDPR5 G EXIT:$G(PSODLQT)
"RTN","PSODDPR2",6,0)
 N COUNT,DRG,ON,CT,DRGI,PDRG,SEV,STX,INT,CLI,PSONULN,PSONULN1,LST,LSI,DGI,SER,SERS,DUPT,SV,PSOLINES,OLDDRG,PSOOLDD
"RTN","PSODDPR2",7,0)
 S (ON,DRG,SV,LSI,DGI,SER,SERS,PSOOLDD)="",(ZZDGDGC,CT,COUNT)=0,$P(PSONULN,"-",79)="-",$P(PSONULN1,"=",79)="=",ZHDR=1
"RTN","PSODDPR2",8,0)
 D NSRT^PSODDPR5
"RTN","PSODDPR2",9,0)
 K ^TMP("PSODGI",$J),^TMP("PSOSER",$J),^TMP("PSOSERS",$J),^TMP("PSODGS",$J),^TMP("PSOTDD",$J,1)
"RTN","PSODDPR2",10,0)
 S (ON,DRG,SV,DGI,SER,SERS,ZVA)="",(ZST,ZORS,CT,COUNT)=0
"RTN","PSODDPR2",11,0)
 ; 
"RTN","PSODDPR2",12,0)
 F  S SV=$O(ZZDGDG(SV)) Q:SV=""!$G(PSODLQT)  F  S ZST=$O(ZZDGDG(SV,ZST)) Q:'ZST!$G(PSODLQT)  F  S ZORS=$O(ZZDGDG(SV,ZST,ZORS)) Q:'ZORS!$G(PSODLQT)  D
"RTN","PSODDPR2",13,0)
 .F  S ZVA=$O(ZZDGDG(SV,ZST,ZORS,ZVA)) Q:ZVA=""!$G(PSODLQT)  F  S DRG=$O(ZZDGDG(SV,ZST,ZORS,ZVA,DRG)) Q:DRG=""!$G(PSODLQT)  S COUNT=COUNT+1 D DUP,BLD2^PSODGDGP
"RTN","PSODDPR2",14,0)
 K HZVA,ZVA,ZORS,ZZDGDG,COUNT,ON,DRG,SV,DGI,PSORX("INTERVENE"),DIR
"RTN","PSODDPR2",15,0)
 D HD() G EXIT:$G(PSODLQT)
"RTN","PSODDPR2",16,0)
 I +$G(PSOINTV) D INT
"RTN","PSODDPR2",17,0)
 I $G(PSORX("DFLG")) W:$G(COPY) !,$C(7),"RX DELETED",! S PSORX("DFLG")=1,POERR("DFLG")=1,VALMBCK="R" G EXIT  Q
"RTN","PSODDPR2",18,0)
 I '$D(^XUSEC("PSORPH",DUZ)) K PSORX("INTERVENE")
"RTN","PSODDPR2",19,0)
 I $G(PSORX("INTERVENE"))]"" D FULL^VALM1,^PSORXI S:'$G(POERR) VALMBCK="R" W !
"RTN","PSODDPR2",20,0)
 I $G(PSORX("DFLG")) G EXIT
"RTN","PSODDPR2",21,0)
 I $O(^TMP($J,LIST,"OUT","DRUGDRUG","ERROR",""))]"" D  G EXIT:PSODLQT  I ($Y+5)>IOSL W @IOF
"RTN","PSODDPR2",22,0)
 .S NODDERR=1 K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to Continue" D ^DIR
"RTN","PSODDPR2",23,0)
 .I ($D(DTOUT))!($D(DUOUT)) S PSODLQT=1,PSORX("DFLG")=1 K DIR,DTOUT,DUOUT Q
"RTN","PSODDPR2",24,0)
 .D HD() Q:$G(PSODLQT)  W !,"Drug Interaction Error(s):",! S CT=0,ON=""
"RTN","PSODDPR2",25,0)
 .F  S ON=$O(^TMP($J,LIST,"OUT","DRUGDRUG","ERROR",ON)) Q:ON=""  F  S CT=$O(^TMP($J,LIST,"OUT","DRUGDRUG","ERROR",ON,CT)) Q:'CT  D
"RTN","PSODDPR2",26,0)
 ..Q:$G(NODDERR)&($P(ON,";")'="Z")
"RTN","PSODDPR2",27,0)
 ..W ?5,$S($P(ON,";")="N":"",$P(ON,";")="R":"Remote Rx for ",$P(ON,";")="O":"Local Rx for ",1:"Prospective Rx for ")
"RTN","PSODDPR2",28,0)
 ..W " "_^TMP($J,LIST,"OUT","DRUGDRUG","ERROR",ON,CT,"MSG"),!,"   "_^TMP($J,LIST,"OUT","DRUGDRUG","ERROR",ON,CT,"TEXT"),!
"RTN","PSODDPR2",29,0)
 ..D HD() Q:$G(PSODLQT)
"RTN","PSODDPR2",30,0)
 ;therapy
"RTN","PSODDPR2",31,0)
 D HD() G EXIT:$G(PSODLQT)
"RTN","PSODDPR2",32,0)
THER I '$O(^TMP($J,LIST,"OUT","THERAPY",0)) G EXIT
"RTN","PSODDPR2",33,0)
 I '$D(^XUSEC("PSORPH",DUZ)),$P(PSOPAR,"^",2),$G(PSOTECCK) G EXIT
"RTN","PSODDPR2",34,0)
 D NSRT1^PSODDPR5
"RTN","PSODDPR2",35,0)
 N ON,DDTH,CLASS,QTHER,ZDRG,ZTHER K DUPT,THER,THERO I '$P(PSOPAR,"^",10) D NOCAN^PSODDPR5 G ERR
"RTN","PSODDPR2",36,0)
 D HD() G EXIT:$G(PSODLQT)  W @IOF,PSONULN1,! S (SUB,CT,LST,PSOZZ)=0 S THER=1,THERO=0,QTHER=1
"RTN","PSODDPR2",37,0)
 K RXDT
"RTN","PSODDPR2",38,0)
 F  S CT=$O(^TMP($J,LIST,"OUT","THERAPY",CT)) Q:'CT!$G(PSODLQT)  F  S SUB=$O(^TMP($J,LIST,"OUT","THERAPY",CT,"DRUGS",SUB)) Q:'SUB!$G(PSODLQT)  S ON=$P(^TMP($J,LIST,"OUT","THERAPY",CT,"DRUGS",SUB),"^") D
"RTN","PSODDPR2",39,0)
 .I $G(PSODCTH(ON)) Q
"RTN","PSODDPR2",40,0)
 .S RXREC=$P(ON,";",2)
"RTN","PSODDPR2",41,0)
 .I $P(ON,";")="Z" Q
"RTN","PSODDPR2",42,0)
 .I $P(ON,";")="N",$G(^TMP($J,"PSONVADD",RXREC,0)) Q
"RTN","PSODDPR2",43,0)
 .I $P(ON,";")="R",$G(^TMP($J,"PSORMDD",RXREC,0)) Q
"RTN","PSODDPR2",44,0)
 .I $P(ON,";")="O",$G(^TMP("PSORXDC",$J,RXREC,0)) Q
"RTN","PSODDPR2",45,0)
 .I $P(ON,";")="P",$G(^TMP("PSORXDC",$J,RXREC,0)) Q
"RTN","PSODDPR2",46,0)
 .I $P(ON,";")="O",$G(^TMP("PSORXDD",$J,RXREC,0)) Q
"RTN","PSODDPR2",47,0)
 .S ZOT=$S($P(ON,";")="O":1,$P(ON,";")="R":2,$P(ON,";")="P":3,1:4)
"RTN","PSODDPR2",48,0)
 .I $P(ON,";")="P" D
"RTN","PSODDPR2",49,0)
 ..I '$P(^PS(52.41,$P(ON,";",2),0),"^",9) S ZDRG=$P(^PS(50.7,$P(^PS(52.41,$P(ON,";",2),0),"^",8),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^") Q
"RTN","PSODDPR2",50,0)
 ..S ZDRG=$P(^PSDRUG($P(^PS(52.41,$P(ON,";",2),0),"^",9),0),"^")
"RTN","PSODDPR2",51,0)
 .I $P(ON,";")="O" S ZDRG=$P(^PSDRUG($P(^PSRX($P(ON,";",2),0),"^",6),0),"^")
"RTN","PSODDPR2",52,0)
 .I $P(ON,";")="N" D
"RTN","PSODDPR2",53,0)
 ..S DUPRX0=^PS(55,PSODFN,"NVA",$P(ON,";",2),0)
"RTN","PSODDPR2",54,0)
 ..I '$P(DUPRX0,"^",2) S ZDRG=$P(^PS(50.7,$P(DUPRX0,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^") Q
"RTN","PSODDPR2",55,0)
 ..S ZDRG=$P(^PSDRUG($P(DUPRX0,"^",2),0),"^")
"RTN","PSODDPR2",56,0)
 .I $P(ON,";")="R" D
"RTN","PSODDPR2",57,0)
 ..Q:'$D(^TMP($J,LIST,"OUT","REMOTE",$P(ON,";",2)))
"RTN","PSODDPR2",58,0)
 ..S RXREC=^TMP($J,LIST,"OUT","REMOTE",$P(ON,";",2)),ZDRG=$P(RXREC,"^",3)
"RTN","PSODDPR2",59,0)
 .S ZTHER(ZOT_"^"_ZDRG_"^"_ON)=ON K ZDRG
"RTN","PSODDPR2",60,0)
 I $O(ZTHER(""))]"" D
"RTN","PSODDPR2",61,0)
 .S (PSODUPF,PSODUPC,PSODUPC1)="" F  S PSODUPF=$O(ZTHER(PSODUPF)) Q:PSODUPF=""  S PSODUPC1=PSODUPC1+1
"RTN","PSODDPR2",62,0)
 .S PSODUPF=1,PSODUPC=0,PSODUPC("CLASS")="" D DUPCL S PSODUPF=0  ;get line counts for each duplicate therapy
"RTN","PSODDPR2",63,0)
 .D DUPCL K DDTH,PSODUPC,PSODUPF,PSODUPC1,PSODUPC2
"RTN","PSODDPR2",64,0)
 K PSODCTH,RXDT,PSOZZ I $P(PSOPAR,"^",10),$O(^TMP($J,"PSODCOR",0)) D DCOR^PSODDPR3 K ^TMP($J,"PSODCOR") D HD() G EXIT:$G(PSODLQT)  W !,PSONULN1,!
"RTN","PSODDPR2",65,0)
ERR I $O(^TMP($J,LIST,"OUT","THERAPY","ERROR",""))]"" D  S NODTERR=1 K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to Continue" D ^DIR K DIR,DTOUT,DUOUT
"RTN","PSODDPR2",66,0)
 .D HD() Q:$G(PSODLQT)  W !,"Drug Therapy Error(s):",! S CT=0,ON=""
"RTN","PSODDPR2",67,0)
 .F  S ON=$O(^TMP($J,LIST,"OUT","THERAPY","ERROR",ON)) Q:ON=""!$G(PSODLQT)  F  S CT=$O(^TMP($J,LIST,"OUT","THERAPY","ERROR",ON,CT)) Q:'CT!$G(PSODLQT)  D
"RTN","PSODDPR2",68,0)
 ..Q:$G(NODTERR)&($P(ON,";")'="Z")!$G(PSODLQT)
"RTN","PSODDPR2",69,0)
 ..D HD() Q:$G(PSODLQT)  W ?5,$S($P(ON,";")="P":"Pending Order: ",$P(ON,";")="N":"Non-VA Med Order: ",$P(ON,";")="R":"Remote Rx: ",$P(ON,";")="O":"Rx: ",1:"Prospective Rx: ")
"RTN","PSODDPR2",70,0)
 ..D HD() Q:$G(PSODLQT)  W " "_^TMP($J,LIST,"OUT","THERAPY","ERROR",ON,CT,"MSG"),!,"   "_^TMP($J,LIST,"OUT","THERAPY","ERROR",ON,CT,"TEXT"),!
"RTN","PSODDPR2",71,0)
 D HD()
"RTN","PSODDPR2",72,0)
EXIT ;
"RTN","PSODDPR2",73,0)
 D ^PSOBUILD
"RTN","PSODDPR2",74,0)
 K DSPL,CAN,DA,DIR,DNM,DUPRX0,ISSD,J,LSTFL,MSG,PHYS,PSOCLC,PSONULN,REA,RFLS,RX0,RX2,RXN,RXREC,ST,Y,ZZ,ACT,PSOCLOZ,PSOLR,PSOLDT,PSOCD,SIG
"RTN","PSODDPR2",75,0)
 K IT,LST,THER,THERO,^UTILITY($J),DGI,SER,SEV,SERS,BSIG,I,NODDERR,NODTERR,PDRG,DRGI,STATUS
"RTN","PSODDPR2",76,0)
 K ^UTILITY($J,"W"),X,ZX,DIWL,DIWR,DIWF,THER,THERO,PSOINTV,ZTHER,PSOVORD,PSODCTH,ZZDGDG,ZZDGDG2
"RTN","PSODDPR2",77,0)
 Q
"RTN","PSODDPR2",78,0)
DUP ;
"RTN","PSODDPR2",79,0)
 Q:$G(PSODLQT)
"RTN","PSODDPR2",80,0)
 S ZZDGDGC=ZZDGDGC+1
"RTN","PSODDPR2",81,0)
 S ON=$P(ZZDGDG(SV,ZST,ZORS,ZVA,DRG),"^"),CT=$P(ZZDGDG(SV,ZST,ZORS,ZVA,DRG),"^",2)
"RTN","PSODDPR2",82,0)
 S SEV=$G(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON,CT,"SEV")) K ISTX
"RTN","PSODDPR2",83,0)
 S IT=$S(SEV="Critical":1,SEV="Significant":2,1:0)
"RTN","PSODDPR2",84,0)
 S PDRG=$P(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON,CT),"^",4),DRGI=$P(^(CT),"^",2)
"RTN","PSODDPR2",85,0)
 D HD() Q:$G(PSODLQT)
"RTN","PSODDPR2",86,0)
 I $G(ZHDR) W @IOF,PSONULN,!,"***"_SEV_"*** Drug Interaction with Prospective Drug:",!?20,PDRG_" and",! S ZHDR=0
"RTN","PSODDPR2",87,0)
 E  W !
"RTN","PSODDPR2",88,0)
 I $P(ON,";")="N" D ^PSODDPR3 D HD():(($Y+5)>IOSL)
"RTN","PSODDPR2",89,0)
 I $P(ON,";")="P" D PEND D HD():(($Y+5)>IOSL)
"RTN","PSODDPR2",90,0)
 I $P(ON,";")="O" D DDRX D HD():(($Y+5)>IOSL)
"RTN","PSODDPR2",91,0)
 I $P(ON,";")="R" D RDI^PSODDPR3 D HD():(($Y+5)>IOSL)
"RTN","PSODDPR2",92,0)
 I '+$G(PSOINTV),IT=2 S PSOINTV=2_"^"_ON
"RTN","PSODDPR2",93,0)
 I IT=1 S PSOINTV=1_"^"_ON
"RTN","PSODDPR2",94,0)
 D HD():(($Y+5)>IOSL)
"RTN","PSODDPR2",95,0)
 I COUNT=ZZDGDG2(SV,ZVA) S COUNT=0 W ! D CL D HD():(($Y+5)>IOSL)
"RTN","PSODDPR2",96,0)
 Q
"RTN","PSODDPR2",97,0)
CL Q:$G(PSODLQT)  S ZHDR=1
"RTN","PSODDPR2",98,0)
 D HD():(($Y+5)>IOSL)
"RTN","PSODDPR2",99,0)
 I IT=2 W !?2,"*** Refer to MONOGRAPH for SIGNIFICANT INTERACTION CLINICAL EFFECTS",!
"RTN","PSODDPR2",100,0)
 I IT=1 W ! D
"RTN","PSODDPR2",101,0)
 .S CLI=$P($G(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON,CT,"CLIN")),"CLINICAL EFFECTS: ",2)
"RTN","PSODDPR2",102,0)
 .S LT=75,STX=CLI D FT F I=0:0 S I=$O(BSIG(I)) Q:'I  W ?2,BSIG(I),!
"RTN","PSODDPR2",103,0)
 D HD():(($Y+5)>IOSL)
"RTN","PSODDPR2",104,0)
 I $O(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON,CT,"PMON",0)) D MON^PSODDPR3 K X,Y
"RTN","PSODDPR2",105,0)
 D HD():(($Y+5)>IOSL)
"RTN","PSODDPR2",106,0)
 Q
"RTN","PSODDPR2",107,0)
FT ;format text
"RTN","PSODDPR2",108,0)
 D HD():(($Y+5)>IOSL)
"RTN","PSODDPR2",109,0)
 K BSIG N BBSIG,BVAR,BVAR1,III,ZNT,NNN,BLIM S BBSIG=STX S (BVAR,BVAR1)="",III=1
"RTN","PSODDPR2",110,0)
 S ZNT=0 F NNN=1:1:$L(BBSIG) I $E(BBSIG,NNN)=" "!($L(BBSIG)=NNN) S ZNT=ZNT+1 D  I $L(BVAR)>LT S BSIG(III)=BLIM_" ",III=III+1,BVAR=BVAR1
"RTN","PSODDPR2",111,0)
 .S BVAR1=$P(BBSIG," ",(ZNT)),BLIM=BVAR,BVAR=$S(BVAR="":BVAR1,1:BVAR_" "_BVAR1) D HD(6):(($Y+6)>IOSL)
"RTN","PSODDPR2",112,0)
 I $G(BVAR)'="" S BSIG(III)=BVAR
"RTN","PSODDPR2",113,0)
 I $G(BSIG(1))=""!($G(BSIG(1))=" ") S BSIG(1)=$G(BSIG(2)) K BSIG(2)
"RTN","PSODDPR2",114,0)
 K LT
"RTN","PSODDPR2",115,0)
 D HD():(($Y+5)>IOSL)
"RTN","PSODDPR2",116,0)
 Q
"RTN","PSODDPR2",117,0)
DDRX ;
"RTN","PSODDPR2",118,0)
 S RXREC=$P(ON,";",2),DUPRX0=^PSRX(RXREC,0),RFLS=$P(DUPRX0,"^",9),ISSD=$P(^PSRX(RXREC,0),"^",13),RX0=DUPRX0,RX2=^PSRX(RXREC,2),($P(RX0,"^",15),STATUS)=+$G(^PSRX(RXREC,"STA"))
"RTN","PSODDPR2",119,0)
 S J=RXREC D STAT^PSOFUNC K RX0,RX2,LSTFD S RXRECLOC=$G(RXREC),DRGNM=$P(^PSDRUG($P(DUPRX0,"^",6),0),"^")
"RTN","PSODDPR2",120,0)
 D HD() Q:$G(PSODLQT)  S:$G(PSODUPF) PSODUPC(ZCT)=PSODUPC(ZCT)+1 W:'$G(PSODUPF) !,$J("Local RX#: ",20)_$P(DUPRX0,"^"),!,$J("Drug: ",20)_DRGNM_" ("_ST_")"
"RTN","PSODDPR2",121,0)
 K FSIG,BSIG I $P($G(^PSRX(RXREC,"SIG")),"^",2) D FSIG^PSOUTLA("R",RXREC,54) F PSREV=1:1 Q:'$D(FSIG(PSREV))  S BSIG(PSREV)=FSIG(PSREV)
"RTN","PSODDPR2",122,0)
 K FSIG,PSREV I '$P($G(^PSRX(RXREC,"SIG")),"^",2) D EN2^PSOUTLA1(RXREC,54)
"RTN","PSODDPR2",123,0)
 D HD() Q:$G(PSODLQT)  S:$G(PSODUPF) PSODUPC(ZCT)=PSODUPC(ZCT)+1 W:'$G(PSODUPF) !,$J("SIG: ",20),$G(BSIG(1))
"RTN","PSODDPR2",124,0)
 I $O(BSIG(1)) F PSREV=1:0 S PSREV=$O(BSIG(PSREV)) Q:'PSREV  S:$G(PSODUPF) PSODUPC(ZCT)=PSODUPC(ZCT)+1 W:'$G(PSODUPF) !,$J("     ",20)_$G(BSIG(PSREV))
"RTN","PSODDPR2",125,0)
 K BSIG,PSREV
"RTN","PSODDPR2",126,0)
 I $G(QTHER) D HD() Q:$G(PSODLQT)  S:$G(PSODUPF) PSODUPC(ZCT)=PSODUPC(ZCT)+1 W:'$G(PSODUPF) !,$J("QTY: ",20)_$P(DUPRX0,"^",7),?44,$J("Days Supply: ",20)_$P(DUPRX0,"^",8)
"RTN","PSODDPR2",127,0)
 D PRSTAT^PSODDPRE(RXREC)
"RTN","PSODDPR2",128,0)
 S LSTFD=+^PSRX(RXREC,3) S:$G(PSODUPF) PSODUPC(ZCT)=PSODUPC(ZCT)+1 W:'$G(PSODUPF) !,$J("Last Filled On: ",20)_$E(LSTFD,4,5)_"/"_$E(LSTFD,6,7)_"/"_$E(LSTFD,2,3)
"RTN","PSODDPR2",129,0)
 Q
"RTN","PSODDPR2",130,0)
RX D HD() Q:$G(PSODLQT)  W ! S RXREC=$P(ON,";",2)
"RTN","PSODDPR2",131,0)
 S DUPRX0=^PSRX(RXREC,0),RFLS=$P(DUPRX0,"^",9),ISSD=$P(^PSRX(RXREC,0),"^",13),RX0=DUPRX0,RX2=^PSRX(RXREC,2),STATUS=+$G(^PSRX(RXREC,"STA"))
"RTN","PSODDPR2",132,0)
 S RXRECLOC=$G(RXREC)
"RTN","PSODDPR2",133,0)
 S J=RXREC D STAT^PSOFUNC K RX0,RX2
"RTN","PSODDPR2",134,0)
 I $P($G(^PS(53,+$P($G(PSORX("PATIENT STATUS")),"^"),0)),"^")["AUTH ABS"!($G(PSORX("PATIENT STATUS"))["AUTH ABS")&'$P(PSOPAR,"^",5) W !,"PATIENT ON AUTHORIZED ABSENCE!" K RXRECLOC Q
"RTN","PSODDPR2",135,0)
 I STATUS>10,STATUS'=16 K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to continue" D ^DIR K DIR,DTOUT,DUOUT,DIRUT,RXRECLOC Q
"RTN","PSODDPR2",136,0)
 I '$P(PSOPAR,"^",2),'$P(PSOPAR,"^",16),'$D(^XUSEC("PSORPH",DUZ)) S PSORX("DFLG")=1 K RXRECLOC Q
"RTN","PSODDPR2",137,0)
 I $P(PSOPAR,"^",2),'$P(PSOPAR,"^",16),'$D(^XUSEC("PSORPH",DUZ)) S PSORX("DFLG")=1 K RXRECLOC Q
"RTN","PSODDPR2",138,0)
 I STATUS=16 W !!,"Prescription "_$P($G(^PSRX(+$G(RXRECLOC),0)),"^")_" is on Provider Hold, it cannot be discontinued.",! K DUP,RXRECLOC S PSORX("DFLG")=1 Q
"RTN","PSODDPR2",139,0)
 D PSOL^PSSLOCK(RXRECLOC) I '$G(PSOMSG) D  K PSOMSG,DIR,DUP,RXRECLOC S DIR("A")="Press Return to continue",DIR(0)="E",DIR("?")="Press Return to continue" D ^DIR K DIR S PSORX("DFLG")=1 Q
"RTN","PSODDPR2",140,0)
 .I $P($G(PSOMSG),"^",2)'="" W !!,$P(PSOMSG,"^",2),! Q
"RTN","PSODDPR2",141,0)
 .W !!,"Another person is editing Rx #"_$P($G(^PSRX(RXREC,0)),"^"),!
"RTN","PSODDPR2",142,0)
 K PSOMSG S DIR("A")=$S(STATUS=12:"Reinstate",1:"Discontinue")_" RX # "_$P(^PSRX(RXREC,0),"^"),DIR(0)="Y",DIR("?")="Enter Y to "_$S(STATUS=12:"reinstate",1:"discontinue")_" this RX."
"RTN","PSODDPR2",143,0)
 D ^DIR K DIR S DA=RXREC S ACT=$S($D(SPCANC):"Reinstated during Rx cancel.",1:$S(STATUS=12:"Reinstated",1:"Discontinued")_" while "_$S('$G(PSONV):"entering",1:"verifying")_" new RX")
"RTN","PSODDPR2",144,0)
 D CMOP^PSOUTL I $G(CMOP("S"))="L" W !,"A CMOP Rx cannot be discontinued during transmission!",! S Y=0 K CMOP
"RTN","PSODDPR2",145,0)
 I 'Y W $C(7)," -Prescription was not "_$S(STATUS=12:"reinstated",1:"discontinued")_"..." D  Q
"RTN","PSODDPR2",146,0)
 .S:'$D(PSOCLC) PSOCLC=DUZ S MSG=ACT,REA=$S(STATUS=12:"R",1:"C") S:$G(DUP) PSORX("DFLG")=1 K DUP
"RTN","PSODDPR2",147,0)
 .I $D(^TMP("PSORXDC",$J,RXREC,0)) K ^TMP("PSORXDC",$J,RXREC,0)
"RTN","PSODDPR2",148,0)
 S PSOCLC=DUZ,MSG=$S($G(MSG)]"":MSG,1:ACT_" During New RX "_$S('$G(PSONV):"Entry",1:"Verification")_" - Duplicate Rx"),REA=$S(STATUS=12:"R",1:"C")
"RTN","PSODDPR2",149,0)
 W !!,"THERAPEUTIC DUPLICATIONS will be discontinued after the acceptance of the new order.",!!
"RTN","PSODDPR2",150,0)
 S ^TMP("PSORXDC",$J,RXREC,0)="52^"_DA_"^"_MSG_"^"_REA_"^"_ACT_"^"_ST_"^"_DRG,PSONOOR="D"
"RTN","PSODDPR2",151,0)
 K RXRECLOC,DUP,CLS,PSONOOR,STATUS,ACT,PSONV,REA,SPCANC
"RTN","PSODDPR2",152,0)
 Q
"RTN","PSODDPR2",153,0)
PEND N DUPRX0,RFLS,ISSD,DNM,RXREC,Y
"RTN","PSODDPR2",154,0)
 D HD() Q:$G(PSODLQT)  S RXREC=$P(ON,";",2),DNM=$P(^PS(52.41,RXREC,0),"^",9)
"RTN","PSODDPR2",155,0)
 S DUPRX0=^PS(52.41,RXREC,0),RFLS=$P(DUPRX0,"^",11),ISSD=$P(DUPRX0,"^",6)
"RTN","PSODDPR2",156,0)
 I '$P(DUPRX0,"^",9) D HD() Q:$G(PSODLQT)  S:$G(PSODUPF) PSODUPC(ZCT)=PSODUPC(ZCT)+1 W:'$G(PSODUPF) !,$J("Pending Order: ",20)_$P(^PS(50.7,$P(DUPRX0,"^",8),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSODDPR2",157,0)
 E  S:$G(PSODUPF) PSODUPC(ZCT)=PSODUPC(ZCT)+1 W:'$G(PSODUPF) !,$J("Pending Order: ",20)_$S($P(DUPRX0,"^",9):$P(^PSDRUG($P(DUPRX0,"^",9),0),"^"),1:"No Dispense Drug Selected")
"RTN","PSODDPR2",158,0)
 D FSIG^PSOUTLA("P",RXREC,IOM-20)
"RTN","PSODDPR2",159,0)
 S:$G(PSODUPF) PSODUPC(ZCT)=PSODUPC(ZCT)+1 W:'$G(PSODUPF) !,$J("SIG: ",20) F I=0:0 S I=$O(FSIG(I)) Q:'I  W FSIG(I) I $O(FSIG(I)) S:$G(PSODUPF) PSODUPC(ZCT)=PSODUPC(ZCT)+1 W:'$G(PSODUPF) !,$J("      ",20)
"RTN","PSODDPR2",160,0)
 Q
"RTN","PSODDPR2",161,0)
DUPCL ;
"RTN","PSODDPR2",162,0)
 Q:$G(PSODLQT)
"RTN","PSODDPR2",163,0)
 S:$G(PSODUPF) PSODUPC=PSODUPC+1 W:'$G(PSODUPF) @IOF,PSONULN1,!
"RTN","PSODDPR2",164,0)
 I '$G(PSODUPF) W "*** THERAPEUTIC DUPLICATION(S) *** "_PSODRUG("NAME")_" with"
"RTN","PSODDPR2",165,0)
 S:$G(PSODUPF) PSODUPC=PSODUPC+1 N PSODUPCT,PSODUPC2,PSODUPCL
"RTN","PSODDPR2",166,0)
 S (PSODUPC2,PSODUPCT)=0 S:'$G(PSODUPF) PSODUPCT=2
"RTN","PSODDPR2",167,0)
 ;displays order and therapy
"RTN","PSODDPR2",168,0)
 K DDTH S (PSODUPCL,ZSUB,ZCT)=""
"RTN","PSODDPR2",169,0)
 F  S ZCT=$O(ZTHER(ZCT)) Q:ZCT=""!($G(PSODLQT))  S ON=ZTHER(ZCT) D
"RTN","PSODDPR2",170,0)
 .S PDODCNT=0,PSODUPC2=PSODUPC2+1 I $G(PSODUPF) S PSODUPC(ZCT)=0
"RTN","PSODDPR2",171,0)
 .I PSODUPC2=PSODUPC2+1
"RTN","PSODDPR2",172,0)
 .I '$G(PSODUPF) D
"RTN","PSODDPR2",173,0)
 ..I PSODUPC2=PSODUPC1,(PSODUPCT+PSODUPC(ZCT)+PSODUPC("CLASS"))>22 D HD(15) S PSODUPCT=0
"RTN","PSODDPR2",174,0)
 ..I (PSODUPCT+PSODUPC(ZCT))>22 D HD(15) S PSODUPCT=0
"RTN","PSODDPR2",175,0)
 ..S PSODUPCT=PSODUPCT+PSODUPC(ZCT)
"RTN","PSODDPR2",176,0)
 .I $P(ON,";")="O" D HD() Q:$G(PSODLQT)  S:$G(PSODUPF) PSODUPC(ZCT)=PSODUPC(ZCT)+1 W:'$G(PSODUPF) ! D DDRX D
"RTN","PSODDPR2",177,0)
 ..Q:STATUS>5&(STATUS'=16)
"RTN","PSODDPR2",178,0)
 ..Q:$G(^TMP("PSORXDC",$J,RXREC,0))]""
"RTN","PSODDPR2",179,0)
 ..Q:$G(RXDT("O",RXREC))
"RTN","PSODDPR2",180,0)
 ..S RX0=^PSRX(RXREC,0),J=RXREC,RX2=^PSRX(RXREC,2) D STAT^PSOFUNC K RX0,RX2
"RTN","PSODDPR2",181,0)
 ..S PSOZZ=PSOZZ+1,^TMP($J,"PSODCOR",PSOZZ)="52"_"^"_RXREC_"^"_ST_"^"_DRGNM,RXDT("O",RXREC)=1
"RTN","PSODDPR2",182,0)
 .I $P(ON,";")="N" D HD() Q:$G(PSODLQT)  S:$G(PSODUPF) PSODUPC(ZCT)=PSODUPC(ZCT)+1 W:'$G(PSODUPF) ! D ^PSODDPR3
"RTN","PSODDPR2",183,0)
 .I $P(ON,";")="P" D
"RTN","PSODDPR2",184,0)
 ..D HD() Q:$G(PSODLQT)  S:$G(PSODUPF) PSODUPC(ZCT)=PSODUPC(ZCT)+1 W:'$G(PSODUPF) ! S RXREC=$P(ON,";",2) D PEND
"RTN","PSODDPR2",185,0)
 ..Q:$G(^TMP("PSORXDC",$J,RXREC,0))]""
"RTN","PSODDPR2",186,0)
 ..Q:$G(RXDT("P",RXREC))
"RTN","PSODDPR2",187,0)
 ..S PSOZZ=PSOZZ+1,DUPRX0=^PS(52.41,RXREC,0)
"RTN","PSODDPR2",188,0)
 ..S ^TMP($J,"PSODCOR",PSOZZ)="P"_"^"_RXREC_"^^"_$S($P(DUPRX0,"^",9):$P(^PSDRUG($P(DUPRX0,"^",9),0),"^"),1:$P(^PS(50.7,$P(DUPRX0,"^",8),0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,$P(DUPRX0,"^",8),0),"^",2),0),"^"))
"RTN","PSODDPR2",189,0)
 ..S ^TMP($J,"PSODCOR",PSOZZ)=^TMP($J,"PSODCOR",PSOZZ)_"^"_$S('$P(DUPRX0,"^",9):$P(^PS(50.7,$P(DUPRX0,"^",8),0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,$P(DUPRX0,"^",8),0),"^",2),0),"^"),1:$P(^PSDRUG($P(DUPRX0,"^",9),0),"^"))
"RTN","PSODDPR2",190,0)
 ..S RXDT("P",RXREC)=1
"RTN","PSODDPR2",191,0)
 .I $P(ON,";")="R" S:$G(PSODUPF) PSODUPC(ZCT)=PSODUPC(ZCT)+1 W:'$G(PSODUPF) ! D RDI^PSODDPR3 D HD() Q:$G(PSODLQT)  ;W !,PSONULN Q
"RTN","PSODDPR2",192,0)
 .I $O(ZTHER(ZCT))'="" D HD() Q:$G(PSODLQT)  S:$G(PSODUPF) PSODUPC(ZCT)=PSODUPC(ZCT)+1 W:'$G(PSODUPF) !,PSONULN
"RTN","PSODDPR2",193,0)
 D CLASSES^PSODDPR3
"RTN","PSODDPR2",194,0)
 I '$G(PSODUPF) S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSODDPR2",195,0)
 I '$G(PSODUPF),Y'=1!($D(DTOUT))!($D(DUOUT)) S PSODLQT=1,PSORX("DFLG")=1 Q
"RTN","PSODDPR2",196,0)
 I '$G(PSODUPF),($Y+5)>IOSL W @IOF
"RTN","PSODDPR2",197,0)
 Q
"RTN","PSODDPR2",198,0)
INT ;
"RTN","PSODDPR2",199,0)
 I $G(PSOVORD),$P(PSOINTV,"^")=1 D  Q
"RTN","PSODDPR2",200,0)
 .K DIR,DTOUT,DIRUT,DIROUT,DUOUT
"RTN","PSODDPR2",201,0)
 .W ! S DIR(0)="SA^1:YES;0:NO",DIR("A")="Do you want to Continue? ",DIR("B")="Y" D ^DIR
"RTN","PSODDPR2",202,0)
 .K DIR,DTOUT,DIRUT,DIROUT,DUOUT
"RTN","PSODDPR2",203,0)
 .I 'Y S PSORX("DFLG")=1 Q
"RTN","PSODDPR2",204,0)
 .S DA=PSONV,RXREC=DA,RX=$G(^PSRX(RXREC,0)),PSORX("INTERVENE")=1
"RTN","PSODDPR2",205,0)
 .D CRI^PSODGDG1
"RTN","PSODDPR2",206,0)
 .I $G(OLDDA) S DA=OLDDA K OLDDA
"RTN","PSODDPR2",207,0)
 I $P(PSOINTV,"^") S IT=$P(PSOINTV,"^"),ON=$P(PSOINTV,"^",2) D ^PSODGDGP K DIR S IT=$P(PSOINTV,"^")
"RTN","PSODDPR2",208,0)
 Q
"RTN","PSODDPR2",209,0)
 ;
"RTN","PSODDPR2",210,0)
HD(PSOLINES,OVRRID) ;
"RTN","PSODDPR2",211,0)
 S:'$G(PSODLQT) PSODLQT=0  S:'$G(OVRRID) OVRRID=0 S:'$G(PSOLINES) PSOLINES=5
"RTN","PSODDPR2",212,0)
 I '$G(OVRRID),$G(PSODLQT)!(($Y+PSOLINES)'>IOSL) Q
"RTN","PSODDPR2",213,0)
 N DIR,DTOUT,DUOUT,DIRUT,DIROUT,X,Y
"RTN","PSODDPR2",214,0)
 W ! K DIR,Y S DIR(0)="E",DIR("A")="Press return to continue" D ^DIR K DIR
"RTN","PSODDPR2",215,0)
 I Y'=1!($D(DTOUT))!($D(DUOUT)) S PSODLQT=1,PSORX("DFLG")=1 Q
"RTN","PSODDPR2",216,0)
 W @IOF
"RTN","PSODDPR2",217,0)
 K PSOLINES,OVRRID
"RTN","PSODDPR2",218,0)
 Q
"RTN","PSODDPR3")
0^10^B158305951
"RTN","PSODDPR3",1,0)
PSODDPR3 ;BIR/SAB - display NVA enhanced order checks ;10/04/06 3:38pm
"RTN","PSODDPR3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**251**;DEC 1997;Build 202
"RTN","PSODDPR3",3,0)
 ;Reference ^PSDRUG supported by DBIA 221
"RTN","PSODDPR3",4,0)
 ;Reference ^PS(55 supported by DBIA 2228
"RTN","PSODDPR3",5,0)
 ;Reference ^PS(50.7 is supported by DBIA 2223
"RTN","PSODDPR3",6,0)
 ;Reference ^PS(50.606 supported by DBIA 2174
"RTN","PSODDPR3",7,0)
NVA S DUPRX0=^PS(55,PSODFN,"NVA",$P(ON,";",2),0) N NVAQ
"RTN","PSODDPR3",8,0)
 ;D HD^PSODDPR2(5) Q:$G(PSODLQT)  
"RTN","PSODDPR3",9,0)
 S:$G(PSODUPF) PSODUPC(ZCT)=PSODUPC(ZCT)+1 W:'$G(PSODUPF) ! I '$P(DUPRX0,"^",2) W $J("Non-VA Med: ",20)_$P(^PS(50.7,$P(DUPRX0,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSODDPR3",10,0)
 E  S:$G(PSODUPF) PSODUPC(ZCT)=PSODUPC(ZCT)+1 W:'$G(PSODUPF) $J("Non-VA Med: ",20)_$P(^PSDRUG($P(DUPRX0,"^",2),0),"^")
"RTN","PSODDPR3",11,0)
 ;W " (Active)"
"RTN","PSODDPR3",12,0)
 S:$G(PSODUPF) PSODUPC(ZCT)=PSODUPC(ZCT)+1 W:'$G(PSODUPF) !,$J("Dosage: ",20)_$S($P(DUPRX0,"^",3)]"":$P(DUPRX0,"^",3),1:"<NOT ENTERED>"),$J("Schedule: ",20)_$S($P(DUPRX0,"^",5)]"":$P(DUPRX0,"^",5),1:"<NOT ENTERED>")
"RTN","PSODDPR3",13,0)
 K DSC,DSPL,CAN,DA,DIR,DNM,DUPRX0,ISSD,J,LSTFL,MSG,PHYS,PSOCLC,REA,RFLS,RX0,RX2,RXN,RXREC,ST,Y,ZZ,ACT,PSOCLOZ,PSOLR,PSOLDT,PSOCD,SIG
"RTN","PSODDPR3",14,0)
 K LST,THER,THERO,^UTILITY($J),DGI,SER,SEV,SERS,BSIG,I,NODDERR,NODTERR,PDRG,DRGI,IZ
"RTN","PSODDPR3",15,0)
 K ^UTILITY($J,"W"),X,ZX,DIWL,DIWR,DIWF
"RTN","PSODDPR3",16,0)
 Q
"RTN","PSODDPR3",17,0)
MON ;print monograph
"RTN","PSODDPR3",18,0)
 ;
"RTN","PSODDPR3",19,0)
 Q:$G(PSODLQT)
"RTN","PSODDPR3",20,0)
 N MONQ,DRGINFO,PVAGDRG,PVAGDRG,VAGDRG,MDRGCNT,MONSEV,PSOMON1,MONTITLE,FDBSEV,SMONTI,MONQ K DIR S DIR(0)="Y",DIR("A")="Display Interaction Monograph",DIR("B")="No" D ^DIR
"RTN","PSODDPR3",21,0)
 S:($D(DTOUT))!($D(DUOUT))!($G(DIRUT)) PSODLQT=1,PSORX("DFLG")=1 W:$G(PSODLQT) !,PSONULN,! K DIR,DTOUT,DUOUT,DIRUT Q:'Y!($G(PSODLQT))
"RTN","PSODDPR3",22,0)
 ;ADD OUTPUT DEVICE
"RTN","PSODDPR3",23,0)
 K IOP,%ZIS,POP S %ZIS="QM" D ^%ZIS
"RTN","PSODDPR3",24,0)
 I POP W !,"NOTHING PRINTED" Q
"RTN","PSODDPR3",25,0)
 E  W !
"RTN","PSODDPR3",26,0)
 I $D(IO("Q")) D  Q
"RTN","PSODDPR3",27,0)
 .S ZTRTN="QUE^PSODDPR3",ZTDESC="Monograph Report of Drug Interactions",ZTSAVE("PSONULN")="",ZTSAVE("SEV")="",ZTSAVE("LIST")=""
"RTN","PSODDPR3",28,0)
 .S ZTSAVE("^TMP($J,LIST,""OUT"",""DRUGDRUG"",SV,DRG,ON,")="",ZTSAVE("ON")="",ZTSAVE("DRG")="",ZTSAVE("CT")="",ZTSAVE("PDRG")=""
"RTN","PSODDPR3",29,0)
 .S ZTSAVE("^TMP($J,""OUT"",""REMOTE"",")="",ZTSAVE("SV")=""
"RTN","PSODDPR3",30,0)
 .D ^%ZTLOAD,^%ZISC W !,"Monograph Queued to Print!",!
"RTN","PSODDPR3",31,0)
 .S:$D(ZTQUEUED) ZTREQ="Q"
"RTN","PSODDPR3",32,0)
QUE   S (CT,PMON,MDRGCNT)=0 K ^TMP($J,LIST,"PMON")
"RTN","PSODDPR3",33,0)
 ;sort to attain an array of FDBSEV by drug and monograph title.  Note that the PMON array is already sorted by Vista Severity
"RTN","PSODDPR3",34,0)
 F  S CT=$O(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON,CT)) Q:'CT  D
"RTN","PSODDPR3",35,0)
 . I $D(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON,CT,"PMON",5,0)) S MONSEV="",MONSEV=^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON,CT,"PMON",5,0) D
"RTN","PSODDPR3",36,0)
 ..S FDBSEV=$P($P(MONSEV,"SEVERITY LEVEL:  ",2),"-",1),FDBSEV=$TR(FDBSEV," ","") S:'$G(FDBSEV) FDBSEV=999999999
"RTN","PSODDPR3",37,0)
 ..S MONTITLE="",MONTITLE=$G(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON,CT,"PMON",3,0)),MONTITLE=$P(MONTITLE,"MONOGRAPH TITLE:  ",2)
"RTN","PSODDPR3",38,0)
 ..S:MONTITLE="" MONTITLE="Zz No title given"
"RTN","PSODDPR3",39,0)
 ..S PSOMON1(DRG,MONTITLE,FDBSEV)=""
"RTN","PSODDPR3",40,0)
 Q:$G(PSODLQT)
"RTN","PSODDPR3",41,0)
 ;
"RTN","PSODDPR3",42,0)
 ;sort "PMON" nodes by drug and FDB severity then print monograph
"RTN","PSODDPR3",43,0)
 ;; MDRGCNT = monograph drug count - sequential number counting monographs per drug.  If multiple monographs fro same drug allows display of each.
"RTN","PSODDPR3",44,0)
 ;; PMON  = counter of # of lines in the monograph to be displayed
"RTN","PSODDPR3",45,0)
 ;; FDBSEV = FDB severity for each monograph within the Vista severity
"RTN","PSODDPR3",46,0)
 ;
"RTN","PSODDPR3",47,0)
 F  S CT=$O(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON,CT)) Q:'CT!$G(PSODLQT)  D  S PMON=PMON+1,^TMP($J,LIST,"PMON",PMON,0)=""
"RTN","PSODDPR3",48,0)
 .S DRGINFO=^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON,CT),PDRGIEN=$P(DRGINFO,"^",2),DRGIEN=$P(DRGINFO,"^",3)
"RTN","PSODDPR3",49,0)
 .S PVAGDRG=$$GET1^DIQ(50,PDRGIEN,20,"E"),VAGDRG=$$GET1^DIQ(50,DRGIEN,20,"E"),MDRGCNT=MDRGCNT+1
"RTN","PSODDPR3",50,0)
 .I PVAGDRG="" S PVAGDRG=$P(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON,CT),"^",4)
"RTN","PSODDPR3",51,0)
 .I VAGDRG="" S VAGDRG=DRG
"RTN","PSODDPR3",52,0)
 .S SMONTI=$G(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON,CT,"PMON",3,0)),SMONTI=$P(SMONTI,"MONOGRAPH TITLE:  ",2)
"RTN","PSODDPR3",53,0)
 .I $D(PSOMON1(DRG,SMONTI)) S FDBSEV="",FDBSEV=$O(PSOMON1(DRG,SMONTI,FDBSEV))
"RTN","PSODDPR3",54,0)
 .S PMON=PMON+1,^TMP($J,LIST,"PMON",FDBSEV,MDRGCNT,PMON,0)=PSONULN
"RTN","PSODDPR3",55,0)
 .S PMON=PMON+1,^TMP($J,LIST,"PMON",FDBSEV,MDRGCNT,PMON,0)="Professional Monograph",PMON=PMON+1
"RTN","PSODDPR3",56,0)
 .S ^TMP($J,LIST,"PMON",FDBSEV,MDRGCNT,PMON,0)="Drug Interaction with "_PVAGDRG_" and "_VAGDRG,PMON=PMON+1,^TMP($J,LIST,"PMON",FDBSEV,MDRGCNT,PMON,0)=""
"RTN","PSODDPR3",57,0)
 .F QX=0:0 S QX=$O(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON,CT,"PMON",QX)) Q:'QX  D FPMON
"RTN","PSODDPR3",58,0)
 Q:'$O(^TMP($J,LIST,"PMON",0))!$G(PSODLQT)
"RTN","PSODDPR3",59,0)
 K DIR,DTOUT,DUOUT,MONQ U IO W @IOF
"RTN","PSODDPR3",60,0)
 I $P(ON,";")="R" S RMRX=$P(^TMP($J,LIST,"OUT","REMOTE",$P(ON,";",2)),"^",5)
"RTN","PSODDPR3",61,0)
 F FDBSEV=0:0 S FDBSEV=$O(^TMP($J,LIST,"PMON",FDBSEV)) Q:FDBSEV=""!($G(MONQ))!$G(PSODLQT)  S PSOMONQ=0 F QXX=0:0 S QXX=$O(^TMP($J,LIST,"PMON",FDBSEV,QXX)) Q:QXX=""!($G(MONQ))!$G(PSODLQT)  D
"RTN","PSODDPR3",62,0)
 .F QX=0:0 S QX=$O(^TMP($J,LIST,"PMON",FDBSEV,QXX,QX)) Q:'QX!($G(PSOMONQ))!$G(PSODLQT)  W !,^TMP($J,LIST,"PMON",FDBSEV,QXX,QX,0) I $Y+3>IOSL D
"RTN","PSODDPR3",63,0)
 ..I $E(IOST)="C",($Y+3)>IOSL S PSOMONQ=$$PAUSE1()
"RTN","PSODDPR3",64,0)
 ..I PSOMONQ=1 W @IOF Q
"RTN","PSODDPR3",65,0)
 ..I PSOMONQ=2 S MONQ=1 Q
"RTN","PSODDPR3",66,0)
 ..W @IOF,! Q:$G(MONQ)
"RTN","PSODDPR3",67,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODDPR3",68,0)
 ;W !,PSONULN,! 
"RTN","PSODDPR3",69,0)
 K DIR,DTOUT,DUOUT,^UTILITY($J),DIWL,DIWR,DIWF,X,QX,PMON,RDI,^TMP($J,LIST,"PMON"),RMRX,PSOMON1,PSOMONQ,MONQ,FDBSEV,MONTITLE,SMONTI
"RTN","PSODDPR3",70,0)
 Q
"RTN","PSODDPR3",71,0)
PAUSE1() ;Allow "^"
"RTN","PSODDPR3",72,0)
 ;Return 0 if X=""
"RTN","PSODDPR3",73,0)
 ;Return 1 if X="^"
"RTN","PSODDPR3",74,0)
 ;Return 2 if Not null or "^"
"RTN","PSODDPR3",75,0)
 NEW DIR,DIRUT,DUOUT,X
"RTN","PSODDPR3",76,0)
 W ! K DIR S DIR("A")="Press RETURN to continue, ""^"" to display the next Monograph or ""^^"" to Exit"
"RTN","PSODDPR3",77,0)
 S DIR("?")="Enter ""^"" to go to next Monograph, ""^^"" to exit the Monograph display."
"RTN","PSODDPR3",78,0)
 S DIR(0)="FOU^^K:(X'="""")!(X'[""^"") X"
"RTN","PSODDPR3",79,0)
 D ^DIR
"RTN","PSODDPR3",80,0)
 I X="" Q 0
"RTN","PSODDPR3",81,0)
 I X="^" Q 1
"RTN","PSODDPR3",82,0)
 Q 2
"RTN","PSODDPR3",83,0)
 ;
"RTN","PSODDPR3",84,0)
RX S RXREC=$P(ON,";",2)
"RTN","PSODDPR3",85,0)
 S DUPRX0=^PSRX(RXREC,0),RFLS=$P(DUPRX0,"^",9),ISSD=$P(^PSRX(RXREC,0),"^",13),RX0=DUPRX0,RX2=^PSRX(RXREC,2),($P(RX0,"^",15),STATUS)=+$G(^PSRX(RXREC,"STA"))
"RTN","PSODDPR3",86,0)
 S RXRECLOC=$G(RXREC)
"RTN","PSODDPR3",87,0)
 ;W !,PSONULN, 
"RTN","PSODDPR3",88,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)  W !!,$J("Drug: ",24)_$P(^PSDRUG($P(DUPRX0,"^",6),0),"^"),!,$J("Status: ",24) S J=RXREC D STAT^PSOFUNC W ST K RX0,RX2 W ?40,$J("Issued: ",24),$E(ISSD,4,5)_"/"_$E(ISSD,6,7)_"/"_$E(ISSD,2,3)
"RTN","PSODDPR3",89,0)
 S DA=RXREC D ^PSOCMOPA I $G(PSOCMOP)]"" D  K CMOP,PSOTRANS,PSOREL
"RTN","PSODDPR3",90,0)
 .S PSOTRANS=$E($P(PSOCMOP,"^",2),4,5)_"/"_$E($P(PSOCMOP,"^",2),6,7)_"/"_$E($P(PSOCMOP,"^",2),2,3)
"RTN","PSODDPR3",91,0)
 .S PSOREL=$S(CMOP("L")=0:$P($G(^PSRX(DA,2)),"^",13),1:$P(^PSRX(DA,1,CMOP("L"),0),"^",18))
"RTN","PSODDPR3",92,0)
 .S PSOREL=$E(PSOREL,4,5)_"/"_$E(PSOREL,6,7)_"/"_$E(PSOREL,2,3)_"@"_$E($P(PSOREL,".",2),1,4)
"RTN","PSODDPR3",93,0)
 .D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)  W !,$J("CMOP Status: ",24)_$S($P(PSOCMOP,"^")=0!($P(PSOCMOP,"^")=2):"Transmitted to on "_PSOTRANS,$P(PSOCMOP,"^")=1:"Released by CMOP on "_PSOREL,1:"Not Dispensed")
"RTN","PSODDPR3",94,0)
 K FSIG,BSIG I $P($G(^PSRX(RXREC,"SIG")),"^",2) D FSIG^PSOUTLA("R",RXREC,54) F PSREV=1:1 Q:'$D(FSIG(PSREV))  S BSIG(PSREV)=FSIG(PSREV)
"RTN","PSODDPR3",95,0)
 K FSIG,PSREV I '$P($G(^PSRX(RXREC,"SIG")),"^",2) D EN2^PSOUTLA1(RXREC,54) W !,$J("SIG: ",24) W $G(BSIG(1))
"RTN","PSODDPR3",96,0)
 I $O(BSIG(1)) F PSREV=1:0 S PSREV=$O(BSIG(PSREV)) Q:'PSREV  W !?24,$G(BSIG(PSREV))
"RTN","PSODDPR3",97,0)
 K BSIG,PSREV
"RTN","PSODDPR3",98,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)  W !,$J("QTY: ",24)_$P(DUPRX0,"^",7),?40,$J("# of refills: ",24)_RFLS S PHYS=$S($D(^VA(200,+$P(DUPRX0,"^",4),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSODDPR3",99,0)
 W !,$J("Provider: ",24)_PHYS,?40,$J("Refills remaining: ",24),RFLS-$S($D(^PSRX(RXREC,1,0)):$P(^(0),"^",4),1:0)
"RTN","PSODDPR3",100,0)
 S LSTFL=+^PSRX(RXREC,3) W !?40,$J("Last filled on: ",24)_$E(LSTFL,4,5)_"/"_$E(LSTFL,6,7)_"/"_$E(LSTFL,2,3),!?40,$J("Days Supply: ",24)_$P(DUPRX0,"^",8)
"RTN","PSODDPR3",101,0)
 W !,PSONULN,!
"RTN","PSODDPR3",102,0)
 K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR
"RTN","PSODDPR3",103,0)
 I Y'=1!($D(DTOUT))!($D(DUOUT)) S PSODLQT=1,PSORX("DFLG")=1 K DIR,DTOUT,DUOUT,DIRUT Q
"RTN","PSODDPR3",104,0)
 I ($Y+5)>IOSL W @IOF
"RTN","PSODDPR3",105,0)
 Q
"RTN","PSODDPR3",106,0)
RDI ;RDI orders
"RTN","PSODDPR3",107,0)
 Q:'$D(^TMP($J,LIST,"OUT","REMOTE",$P(ON,";",2)))
"RTN","PSODDPR3",108,0)
 S RXREC=^TMP($J,LIST,"OUT","REMOTE",$P(ON,";",2))
"RTN","PSODDPR3",109,0)
 S:$G(PSODUPF) PSODUPC(ZCT)=PSODUPC(ZCT)+1 W:'$G(PSODUPF) !,$J("LOCATION: ",20)_$P(RXREC,"^")_"  Remote Rx: "_$P(RXREC,"^",5)
"RTN","PSODDPR3",110,0)
 S:$G(PSODUPF) PSODUPC(ZCT)=PSODUPC(ZCT)+1 W:'$G(PSODUPF) !,$J("Drug: ",20)_$P(RXREC,"^",3)_" ("_$P(RXREC,"^",4)_")"
"RTN","PSODDPR3",111,0)
 D FSIG(.FSIG)
"RTN","PSODDPR3",112,0)
 S:$G(PSODUPF) PSODUPC(ZCT)=PSODUPC(ZCT)+1 W:'$G(PSODUPF) !,$J("SIG: ",20) F I=1:1 Q:'$D(FSIG(I))  W ?20,FSIG(I)
"RTN","PSODDPR3",113,0)
 I $G(QTHER) S:$G(PSODUPF) PSODUPC(ZCT)=PSODUPC(ZCT)+1 W:'$G(PSODUPF) !,$J("QTY: ",20)_$P(RXREC,"^",8),?40,$J("Days Supply: ",24)_$P(RXREC,"^",7)
"RTN","PSODDPR3",114,0)
 S:$G(PSODUPF) PSODUPC(ZCT)=PSODUPC(ZCT)+1 W:'$G(PSODUPF) !,$J("Last Filled On: ",20)_$P(RXREC,"^",6)
"RTN","PSODDPR3",115,0)
 S ^TMP($J,"PSONRVADD",RXREC,0)=1
"RTN","PSODDPR3",116,0)
 K RXREC,I
"RTN","PSODDPR3",117,0)
 Q
"RTN","PSODDPR3",118,0)
FSIG(FSIG) ;Format sig from remote site
"RTN","PSODDPR3",119,0)
 ;returned in the FSIG array
"RTN","PSODDPR3",120,0)
 N FFF,NNN,CNT,FVAR,FVAR1,FLIM,HSIG,II,I
"RTN","PSODDPR3",121,0)
 F I=0:1 Q:'$D(^TMP($J,LIST,"OUT","REMOTE",$P(ON,";",2),"SIG",I))  S HSIG(I+1)=^(I)
"RTN","PSODDPR3",122,0)
FSTART S (FVAR,FVAR1)="",II=1
"RTN","PSODDPR3",123,0)
 F FFF=0:0 S FFF=$O(HSIG(FFF)) Q:'FFF  S CNT=0 F NNN=1:1:$L(HSIG(FFF)) I $E(HSIG(FFF),NNN)=" "!($L(HSIG(FFF))=NNN) S CNT=CNT+1 D  I $L(FVAR)>52 S FSIG(II)=FLIM_" ",II=II+1,FVAR=FVAR1
"RTN","PSODDPR3",124,0)
 .S FVAR1=$P(HSIG(FFF)," ",(CNT))
"RTN","PSODDPR3",125,0)
 .S FLIM=FVAR
"RTN","PSODDPR3",126,0)
 .S FVAR=$S(FVAR="":FVAR1,1:FVAR_" "_FVAR1)
"RTN","PSODDPR3",127,0)
 I $G(FVAR)'="" S FSIG(II)=FVAR
"RTN","PSODDPR3",128,0)
 I $G(FSIG(1))=""!($G(FSIG(1))=" ") S FSIG(1)=$G(FSIG(2)) K FSIG(2)
"RTN","PSODDPR3",129,0)
FQUIT Q
"RTN","PSODDPR3",130,0)
PEND S RXREC=$P(ON,";",2),DNM=$P(^PS(52.41,RXREC,0),"^",9)
"RTN","PSODDPR3",131,0)
 W !,PSONULN,!,"*** THERAPEUTIC DUPLICATION in a Pending Order ***"
"RTN","PSODDPR3",132,0)
 S DUPRX0=^PS(52.41,RXREC,0),RFLS=$P(DUPRX0,"^",11),ISSD=$P(DUPRX0,"^",6)
"RTN","PSODDPR3",133,0)
 W !,"Orderable Item: "_$P(^PS(50.7,$P(DUPRX0,"^",8),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSODDPR3",134,0)
 W !,"Drug: "_$S($P(DUPRX0,"^",9):$P(^PSDRUG($P(DUPRX0,"^",9),0),"^"),1:"No Dispense Drug Selected")
"RTN","PSODDPR3",135,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)  S TY=2 D INST
"RTN","PSODDPR3",136,0)
 D FSIG^PSOUTLA("P",RXREC,IOM-6)
"RTN","PSODDPR3",137,0)
 W !,"SIG: " F I=0:0 S I=$O(FSIG(I)) Q:'I  W FSIG(I),!?5 D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)
"RTN","PSODDPR3",138,0)
 W !,"Routing: "_$S($P(DUPRX0,"^",17)="W":"WINDOW",1:"MAIL"),?30,"Quantity: "_$P(DUPRX0,"^",10),!,"# of Refills: "_$P(DUPRX0,"^",11)
"RTN","PSODDPR3",139,0)
 W ?30,"Patient Status: SC",!,"Patient Location: "_$S($P(DUPRX0,"^",13):$P($G(^SC($P(DUPRX0,"^",13),0)),"^"),1:""),!,"Med Route: "_$P($G(^PS(51.2,+$P(DUPRX0,"^",15),0)),"^"),?30,"Provider: "_$P(^VA(200,$P(DUPRX0,"^",5),0),"^")
"RTN","PSODDPR3",140,0)
 S Y=$P(DUPRX0,"^",6) X ^DD("DD") W !,"Issue Date: "_Y
"RTN","PSODDPR3",141,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)  S TY=3 D INST
"RTN","PSODDPR3",142,0)
 I $P($G(^PS(53,+$P($G(PSORX("PATIENT STATUS")),"^"),0)),"^")["AUTH ABS"!($G(PSORX("PATIENT STATUS"))["AUTH ABS")&'$P(PSOPAR,"^",5) W !,"PATIENT ON AUTHORIZED ABSENCE!" K RXRECLOD Q
"RTN","PSODDPR3",143,0)
 W !,PSONULN,!
"RTN","PSODDPR3",144,0)
 K PSOMSG S DIR("A")="Discontinue Pending Order",DIR(0)="Y",DIR("?")="Enter Y to Discontinue this pending order."
"RTN","PSODDPR3",145,0)
 D ^DIR K DIR
"RTN","PSODDPR3",146,0)
 I 'Y W $C(7)," -Pending Order was not discontinued..." Q
"RTN","PSODDPR3",147,0)
 S MSG="Discontinued while entering new RX (THERAPEUTIC DUPLICATION)."
"RTN","PSODDPR3",148,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)  W !!,"THERAPEUTIC DUPLICATION will be discontinued after the acceptance of the new order.",! H 2
"RTN","PSODDPR3",149,0)
 S ^TMP("PSORXDC",$J,RXREC,0)="P^"_RXREC_"^"_MSG
"RTN","PSODDPR3",150,0)
 K RXREC,DNM,DUPRX0,RFLS,ISSD,MSG,FSIG,TY
"RTN","PSODDPR3",151,0)
 Q
"RTN","PSODDPR3",152,0)
DCOR ;dc duplicate therapy
"RTN","PSODDPR3",153,0)
 Q:'$D(^XUSEC("PSORPH",DUZ))!$G(PSODLQT)
"RTN","PSODDPR3",154,0)
 S MSG="Discontinued During "_$S('$G(PSONV):"New Prescription Entry",1:"Verification")_" - Duplicate Therapy"
"RTN","PSODDPR3",155,0)
 S ACT="Duplicate Therapy Discontinued while "_$S('$G(PSONV):"entering",1:"verifying")_" new RX"
"RTN","PSODDPR3",156,0)
 N DCN,DCRD,LST S THERO=0 F I=0:0 S I=$O(^TMP($J,"PSODCOR",I)) Q:'I  S THERO=THERO+1
"RTN","PSODDPR3",157,0)
 I THERO=1 D  Q
"RTN","PSODDPR3",158,0)
 .K DIR S DIR(0)="Y",THER(1)=^TMP($J,"PSODCOR",1)
"RTN","PSODDPR3",159,0)
 .S DIR("A")="Discontinue "_$S($P(THER(1),"^")="P":"Pending Order "_$P(THER(1),"^",4),1:"Rx #"_$P(^PSRX($P(THER(1),"^",2),0),"^")_" "_$P(THER(1),"^",4))_" Y/N "
"RTN","PSODDPR3",160,0)
 .D ^DIR K DIR,DIRUT I 'Y K DIR,THER,THERO,X,Y Q
"RTN","PSODDPR3",161,0)
 .S ^TMP("PSORXDC",$J,$P(THER(1),"^",2),0)=$P(THER(1),"^")_"^"_$P(THER(1),"^",2)_"^"_MSG
"RTN","PSODDPR3",162,0)
 .I $P(THER(1),"^")=52 S ^TMP("PSORXDC",$J,$P(THER(1),"^",2),0)=^TMP("PSORXDC",$J,$P(THER(1),"^",2),0)_"^C^"_ACT_"^"_$P(THER(1),"^",3)_"^"_$P(THER(1),"^",4),PSONOOR="D"
"RTN","PSODDPR3",163,0)
 .S $P(^TMP("PSORXDC",$J,$P(THER(1),"^",2),0),"^",10)=1
"RTN","PSODDPR3",164,0)
 .W !! K ^UTILITY($J,"W") S DIWL=1,DIWR=75,DIWF=""
"RTN","PSODDPR3",165,0)
 .S X="Duplicate Therapy "_$S($P(THER(1),"^")="P":"Pending Order ",1:"Rx #"_$P(^PSRX($P(THER(1),"^",2),0),"^"))_" "_$P(THER(1),"^",4)_" will be discontinued after the acceptance of the new order." D ^DIWP
"RTN","PSODDPR3",166,0)
 .F ZX=0:0 S ZX=$O(^UTILITY($J,"W",1,ZX)) Q:'ZX  W !,^UTILITY($J,"W",1,ZX,0)
"RTN","PSODDPR3",167,0)
 .K ^UTILITY($J,"W"),X,DIWL,DIWR,DIWF W ! H 2
"RTN","PSODDPR3",168,0)
 K DIR S DIR(0)="Y",DIR("A")="Discontinue Orders Y/N ",DIR("B")="No" D ^DIR
"RTN","PSODDPR3",169,0)
 I 'Y K DIR,X,Y Q
"RTN","PSODDPR3",170,0)
 K DIR S DIR(0)="LO^1:"_THERO
"RTN","PSODDPR3",171,0)
 F I=1:1:THERO S DIR("A",I)=I_". "_$S($P(^TMP($J,"PSODCOR",I),"^")="P":"Pending Order "_$P(^TMP($J,"PSODCOR",I),"^",4),1:"Rx #"_$P(^PSRX($P(^TMP($J,"PSODCOR",I),"^",2),0),"^")_" "_$P(^TMP($J,"PSODCOR",I),"^",4))
"RTN","PSODDPR3",172,0)
 S DIR("A")="Select Order(s)" D ^DIR K DIR,DIRUT I 'Y K THER,THERO Q
"RTN","PSODDPR3",173,0)
 S LST=Y(0) F DCRD=1:1:$L(LST,",") Q:$P(LST,",",DCRD)']""!$G(PSODLQT)  D
"RTN","PSODDPR3",174,0)
 .S DCN=$P(LST,",",DCRD),THER(DCN)=^TMP($J,"PSODCOR",DCN)
"RTN","PSODDPR3",175,0)
 .S ^TMP("PSORXDC",$J,$P(THER(DCN),"^",2),0)=$P(THER(DCN),"^")_"^"_$P(THER(DCN),"^",2)_"^"_MSG
"RTN","PSODDPR3",176,0)
 .I $P(THER(DCN),"^")=52 S ^TMP("PSORXDC",$J,$P(THER(DCN),"^",2),0)=^TMP("PSORXDC",$J,$P(THER(DCN),"^",2),0)_"^C^"_ACT_"^"_$P(THER(DCN),"^",3)_"^"_$P(THER(DCN),"^",4),PSONOOR="D"
"RTN","PSODDPR3",177,0)
 .S $P(^TMP("PSORXDC",$J,$P(THER(DCN),"^",2),0),"^",10)=1
"RTN","PSODDPR3",178,0)
 .W !! K ^UTILITY($J,"W") S DIWL=1,DIWR=75,DIWF=""
"RTN","PSODDPR3",179,0)
 .S X="Duplicate Therapy "_$S($P(THER(DCN),"^")="P":"Pending Order "_$P(THER(DCN),"^",4),1:"Rx #"_$P(^PSRX($P(THER(DCN),"^",2),0),"^"))_" "_$P(THER(DCN),"^",4)_" will be discontinued after the acceptance of the new order." D ^DIWP
"RTN","PSODDPR3",180,0)
 .F ZX=0:0 S ZX=$O(^UTILITY($J,"W",1,ZX)) Q:'ZX  W !,^UTILITY($J,"W",1,ZX,0)
"RTN","PSODDPR3",181,0)
 .K ^UTILITY($J,"W"),X,DIWL,DIWR,DIWF W ! H 2
"RTN","PSODDPR3",182,0)
 K X,Y,THER,THERO,MSG,ACT,I,DIR
"RTN","PSODDPR3",183,0)
 Q
"RTN","PSODDPR3",184,0)
FPMON ;displays instruction and/or comments
"RTN","PSODDPR3",185,0)
 S PMON=PMON+1,MG=^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON,CT,"PMON",QX,0)
"RTN","PSODDPR3",186,0)
 I MG="" S ^TMP($J,LIST,"PMON",FDBSEV,MDRGCNT,PMON,0)="",PMON=PMON+1 Q
"RTN","PSODDPR3",187,0)
 I $L(MG)>70 F SG=1:1:$L(MG," ") S:$L(($G(^TMP($J,LIST,"PMON",FDBSEV,MDRGCNT,PMON,0)))_" "_$P(MG," ",SG))>80 PMON=PMON+1 S ^TMP($J,LIST,"PMON",FDBSEV,MDRGCNT,PMON,0)=$G(^TMP($J,LIST,"PMON",FDBSEV,MDRGCNT,PMON,0))_$P(MG," ",SG)_" "
"RTN","PSODDPR3",188,0)
 E  S PMON=PMON+1,^TMP($J,LIST,"PMON",FDBSEV,MDRGCNT,PMON,0)=$G(^TMP($J,LIST,"PMON",FDBSEV,MDRGCNT,PMON,0))_MG
"RTN","PSODDPR3",189,0)
 K MG,SG
"RTN","PSODDPR3",190,0)
 Q
"RTN","PSODDPR3",191,0)
VAGEN(PSODD) ;Return the VA GENERIC name
"RTN","PSODDPR3",192,0)
 ;PSODD - IEN (file #50)
"RTN","PSODDPR3",193,0)
 N PSOIEN I '+$G(PSODD) Q ""
"RTN","PSODDPR3",194,0)
 S PSOIEN=+$G(^PSDRUG(PSODD,"ND")) D ZERO^PSN50P6(PSOIEN,,,,"PSOVAG")
"RTN","PSODDPR3",195,0)
 S PSOVAG=$G(^TMP($J,"PSOVAG",PSOIEN,.01)) K ^TMP($J,"PSOVAG")
"RTN","PSODDPR3",196,0)
 S:PSOVAG="" PSOVAG="*"
"RTN","PSODDPR3",197,0)
 Q PSOVAG
"RTN","PSODDPR3",198,0)
 ;
"RTN","PSODDPR3",199,0)
INST ;displays instruction and/or comments
"RTN","PSODDPR3",200,0)
 S INST=0 F  S INST=$O(^PS(52.41,RXREC,TY,INST)) Q:'INST  S MIG=^PS(52.41,RXREC,TY,INST,0) D
"RTN","PSODDPR3",201,0)
 .W !,$S(TY=2:"      Instructions: ",TY=3:" Provider Comments: ",1:"")
"RTN","PSODDPR3",202,0)
 .F SG=1:1:$L(MIG," ") D HD^PSODDPR2() Q:$G(PSODLQT)  W:$X+$L($P(MIG," ",SG)_" ")>IOM @$S(TY=3:"!?14",1:"!?19") W $P(MIG," ",SG)_" "
"RTN","PSODDPR3",203,0)
 K INST,TY,MIG,SG
"RTN","PSODDPR3",204,0)
 Q
"RTN","PSODDPR3",205,0)
 ;
"RTN","PSODDPR3",206,0)
CLASSES ;display therapeutic duplications classes (called from PSODDPR5 too)
"RTN","PSODDPR3",207,0)
 I '$G(PSODUPF) D
"RTN","PSODDPR3",208,0)
 .I '$G(PSODUPCT)&('$G(PSODUPC("CLASS"))) D HD^PSODDPR2() Q
"RTN","PSODDPR3",209,0)
 .I ($G(PSODUPCT)+PSODUPC("CLASS"))>22 D HD^PSODDPR2(15) S PSODUPCT=0
"RTN","PSODDPR3",210,0)
 Q:$G(PSODLQT)
"RTN","PSODDPR3",211,0)
 K ^UTILITY($J,"W") S DIWL=1,DIWR=75,DIWF="",ZCT=0 S:$G(PSODUPF) PSODUPC("CLASS")=PSODUPC("CLASS")+1 W:'$G(PSODUPF) !
"RTN","PSODDPR3",212,0)
 S X="Class(es) Involved in Therapeutic Duplication(s): " D ^DIWP
"RTN","PSODDPR3",213,0)
 S (ZCT,ZZCT,ZZZCT)=0 F  S ZZCT=$O(^TMP($J,LIST,"OUT","THERAPY",ZZCT)) Q:'ZZCT  S ZCT=0 F  S ZCT=$O(^TMP($J,LIST,"OUT","THERAPY",ZZCT,ZCT)) Q:'ZCT  D
"RTN","PSODDPR3",214,0)
 . S X=^TMP($J,LIST,"OUT","THERAPY",ZZCT,ZCT,"CLASS")
"RTN","PSODDPR3",215,0)
 . S X=^TMP($J,LIST,"OUT","THERAPY",ZZCT,ZCT,"CLASS")_$S($O(^TMP($J,LIST,"OUT","THERAPY",ZZCT))!($O(^TMP($J,LIST,"OUT","THERAPY",ZZCT,ZCT))):", ",1:" ")
"RTN","PSODDPR3",216,0)
 . D ^DIWP
"RTN","PSODDPR3",217,0)
 F ZX=0:0 S ZX=$O(^UTILITY($J,"W",1,ZX)) Q:'ZX  S:$G(PSODUPF) PSODUPC("CLASS")=PSODUPC("CLASS")+1 W:'$G(PSODUPF) !,^UTILITY($J,"W",1,ZX,0)
"RTN","PSODDPR3",218,0)
 K ^UTILITY($J,"W"),X,CLASS,DIWL,DIWR,DIWF,ZX,DRG,ZCT,ZZCT,ZZZCT
"RTN","PSODDPR3",219,0)
 S:$G(PSODUPF) PSODUPC("CLASS")=PSODUPC("CLASS")+1 W:'$G(PSODUPF) !,PSONULN1,!
"RTN","PSODDPR3",220,0)
 Q
"RTN","PSODDPR4")
0^18^B78835687
"RTN","PSODDPR4",1,0)
PSODDPR4 ;BHAM-ISC/EJW,SAB - build local OP  & RDI profiles ;07/19/07
"RTN","PSODDPR4",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**251**;DEC 1997;Build 202
"RTN","PSODDPR4",3,0)
 ;
"RTN","PSODDPR4",4,0)
 ;External references to ^ORRDI1 supported by DBIA 4659
"RTN","PSODDPR4",5,0)
 ;External references to ^XTMP("ORRDI" supported by DBIA 4660
"RTN","PSODDPR4",6,0)
 ;External reference to ^PS(50.605 supported by DBIA 696
"RTN","PSODDPR4",7,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSODDPR4",8,0)
 ;External reference to ^PS(56 supported by DBIA 2229
"RTN","PSODDPR4",9,0)
 ;External reference to ^PS(50.416 supported by DBIA 692
"RTN","PSODDPR4",10,0)
 ;External reference to DDIEX^PSNAPIS supported by DBIA 2574
"RTN","PSODDPR4",11,0)
 ;External reference to PROD0^PSNAPIS supported by DBIA 2531
"RTN","PSODDPR4",12,0)
 ;External reference to IN^PSJBLDOC supported by DBIA 5306
"RTN","PSODDPR4",13,0)
 ;External references to ^PSSDSAPM supported by DBIA 5570
"RTN","PSODDPR4",14,0)
 ;
"RTN","PSODDPR4",15,0)
BLD(PSODFN,LIST,PDRG,PTY) ;
"RTN","PSODDPR4",16,0)
 ;build OP, RDI, INP MEDS profiles
"RTN","PSODDPR4",17,0)
 ;PTY - P1;P2 where P1="I" for IP & "O" for OP (required), P2=Pharm order# (optional)
"RTN","PSODDPR4",18,0)
 I '$D(PSODFN) W !,"Patient UNDEFINED!",! Q
"RTN","PSODDPR4",19,0)
 I '$D(LIST) W !,"Input Base UNDEFINED!",! Q
"RTN","PSODDPR4",20,0)
 K ^TMP($J,LIST)
"RTN","PSODDPR4",21,0)
ORD N PSODTCUT,X1,X2,ODRG,ORTYP,ORN,DO,IEN,NAME,PROF S (PROF,CNT)=0
"RTN","PSODDPR4",22,0)
 F ZI=0:0 S ZI=$O(PDRG(ZI)) Q:'ZI  S IEN=$P(PDRG(ZI),"^"),NAME=$P(PDRG(ZI),"^",2) D DRG
"RTN","PSODDPR4",23,0)
 Q:$O(^TMP($J,LIST,"IN","PROSPECTIVE",""))=""   ;no prospective drugs to pass in
"RTN","PSODDPR4",24,0)
 S X1=DT,X2=-120 D C^%DTC S PSODTCUT=X D ^PSOBUILD,PROFILE
"RTN","PSODDPR4",25,0)
 K PSOSD D REMOTE D:$P($G(PTY),";")="I" IN^PSJBLDOC(PSODFN,LIST,.PDRG,$G(PTY))
"RTN","PSODDPR4",26,0)
 S ^TMP($J,LIST,"IN","IEN")=PSODFN,^TMP($J,LIST,"IN","DRUGDRUG")="",^TMP($J,LIST,"IN","THERAPY")=""
"RTN","PSODDPR4",27,0)
 S ^TMP($J,LIST,"IN","SOURCE")=$P($G(PTY),";")
"RTN","PSODDPR4",28,0)
 N PSOICT,PSODRUG,PSOY,CNT,ZI
"RTN","PSODDPR4",29,0)
 D IN^PSSHRQ2(LIST)
"RTN","PSODDPR4",30,0)
 Q
"RTN","PSODDPR4",31,0)
PROFILE ;build profile drug input
"RTN","PSODDPR4",32,0)
 N ID,ORTYP,DD,PSOI,ORN,RECTYP S (STA,DNM)="",DO=0
"RTN","PSODDPR4",33,0)
 F  S STA=$O(PSOSD(STA)) Q:STA=""  F  S DNM=$O(PSOSD(STA,DNM)) Q:DNM=""  D
"RTN","PSODDPR4",34,0)
 .I STA="PENDING" D  Q
"RTN","PSODDPR4",35,0)
 ..Q:$P(^PS(52.41,$P(PSOSD(STA,DNM),"^",10),0),"^",3)="RF"
"RTN","PSODDPR4",36,0)
 ..S RXREC=$P(PSOSD(STA,DNM),"^",10),ORN=$P(^PS(52.41,RXREC,0),"^"),ODRG=$P(^(0),"^",9),ORTYP="P"
"RTN","PSODDPR4",37,0)
 ..I ODRG D  K ODRG Q
"RTN","PSODDPR4",38,0)
 ...I $P($G(^PSDRUG(ODRG,0)),"^",3)["S"!($E($P($G(^PSDRUG(ODRG,0)),"^",2),1,2)="XA") Q
"RTN","PSODDPR4",39,0)
 ...S DRNM=$P(^PSDRUG(ODRG,0),"^"),DO=DO+1 D ID
"RTN","PSODDPR4",40,0)
 ..E  N PSOI,DDRG,ODRG,SEQN,DDRG S PSOI=$P(^PS(52.41,RXREC,0),"^",8) D
"RTN","PSODDPR4",41,0)
 ...S DRNM=$P(^PS(50.7,PSOI,0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSODDPR4",42,0)
 ...S DDRG=$$DRG^PSSDSAPM(PSOI,"O") I '$P(DDRG,";") D OIX Q
"RTN","PSODDPR4",43,0)
 ...I $P($G(^PSDRUG($P(DDRG,";"),0)),"^",3)["S"!($E($P($G(^PSDRUG($P(DDRG,";"),0)),"^",2),1,2)="XA") Q
"RTN","PSODDPR4",44,0)
 ...S ODRG=$P(DDRG,";"),SEQN=+$P(DDRG,";",3) K PSOI
"RTN","PSODDPR4",45,0)
 ...N ID S ID=+$$GETVUID^XTID(50.68,,+$P($G(^PSDRUG(ODRG,"ND")),"^",3)_",")
"RTN","PSODDPR4",46,0)
 ...D ID1
"RTN","PSODDPR4",47,0)
 .I STA="ZNONVA" D  Q
"RTN","PSODDPR4",48,0)
 ..S RXREC=$P(PSOSD(STA,DNM),"^",10),ODRG=$P(^PS(55,PSODFN,"NVA",RXREC,0),"^",2),ORN=$P($G(^(0)),"^",8),ORTYP="N"
"RTN","PSODDPR4",49,0)
 ..I ODRG D  K ODRG Q
"RTN","PSODDPR4",50,0)
 ...I $P($G(^PSDRUG(ODRG,0)),"^",3)["S"!($E($P($G(^PSDRUG(ODRG,0)),"^",2),1,2)="XA") Q
"RTN","PSODDPR4",51,0)
 ...S DRNM=$P(^PSDRUG(ODRG,0),"^"),DO=DO+1 D ID
"RTN","PSODDPR4",52,0)
  ..E  N PSOI,DDRG,ODRG,SEQN,DDRG,DRNM S PSOI=$P(^PS(55,PSODFN,"NVA",RXREC,0),"^") D
"RTN","PSODDPR4",53,0)
 ...S DRNM=$P(^PS(50.7,PSOI,0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSODDPR4",54,0)
 ...S DDRG=$$DRG^PSSDSAPM(PSOI,"O") I '$P(DDRG,";") D OIX Q
"RTN","PSODDPR4",55,0)
 ...I $P($G(^PSDRUG($P(DDRG,";"),0)),"^",3)["S"!($E($P($G(^PSDRUG($P(DDRG,";"),0)),"^",2),1,2)="XA") Q
"RTN","PSODDPR4",56,0)
 ...S ODRG=$P(DDRG,";"),SEQN=+$P(DDRG,";",3),DO=DO+1 K PSOI
"RTN","PSODDPR4",57,0)
 ...N ID S ID=+$$GETVUID^XTID(50.68,,+$P($G(^PSDRUG(ODRG,"ND")),"^",3)_",")
"RTN","PSODDPR4",58,0)
 ...D ID1
"RTN","PSODDPR4",59,0)
 .I $P(PSOSD(STA,DNM),"^",2)>5,$P(PSOSD(STA,DNM),"^",2)'=16 Q
"RTN","PSODDPR4",60,0)
 .S RXREC=+PSOSD(STA,DNM) I $P($G(PTY),";")="O",$P($G(PTY),";",2)=RXREC Q
"RTN","PSODDPR4",61,0)
 .I $P($G(^PSRX(RXREC,0)),"^",6) S ODRG=$P(^PSRX(RXREC,0),"^",6) D
"RTN","PSODDPR4",62,0)
 ..I $P($G(^PSDRUG(ODRG,0)),"^",3)["S"!($E($P($G(^PSDRUG(ODRG,0)),"^",2),1,2)="XA") Q
"RTN","PSODDPR4",63,0)
 ..S ORN=$P($G(^PSRX(RXREC,"OR1")),"^",2),ORTYP="O",DRNM=$P(^PSDRUG(ODRG,0),"^"),DO=DO+1 D ID
"RTN","PSODDPR4",64,0)
 K RXREC,ID,STA,DNM,SEQN,PSOI,PSODD,P1,P3,OR1,P2,PSODRUG,DD,DRNM,DDRG
"RTN","PSODDPR4",65,0)
 Q
"RTN","PSODDPR4",66,0)
ID N ID S ID=+$$GETVUID^XTID(50.68,,+$P($G(^PSDRUG(ODRG,"ND")),"^",3)_",")
"RTN","PSODDPR4",67,0)
 S P1=$P($G(^PSDRUG(ODRG,"ND")),"^"),P2=$P($G(^("ND")),"^",3),X=$$PROD0^PSNAPIS(P1,P2),SEQN=+$P(X,"^",7)
"RTN","PSODDPR4",68,0)
ID1 S ^TMP($J,LIST,"IN","PROFILE",ORTYP_";"_RXREC_";PROFILE;"_DO)=SEQN_"^"_ID_"^"_ODRG_"^"_DRNM_"^"_ORN_"^O" K ID
"RTN","PSODDPR4",69,0)
 Q
"RTN","PSODDPR4",70,0)
OIX S ^TMP($J,LIST,"IN","EXCEPTIONS","OI",DRNM)=1_"^"_ORTYP_";"_RXREC_";PROFILE;"_DO
"RTN","PSODDPR4",71,0)
 K TU
"RTN","PSODDPR4",72,0)
 Q
"RTN","PSODDPR4",73,0)
REMOTE ;
"RTN","PSODDPR4",74,0)
 I $T(HAVEHDR^ORRDI1)']"" Q
"RTN","PSODDPR4",75,0)
 I '$$HAVEHDR^ORRDI1 Q
"RTN","PSODDPR4",76,0)
 I $D(^XTMP("ORRDI","OUTAGE INFO","DOWN")) D  Q
"RTN","PSODDPR4",77,0)
 .I $T(REMOTE^PSORX1)]"" Q
"RTN","PSODDPR4",78,0)
 .D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODDPR4",79,0)
 .W !!,"Remote data not available - Only local order checks processed.",! D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODDPR4",80,0)
 I $P($G(^XTMP("ORRDI","PSOO",PSODFN,0)),"^",3)<0 W !!,"Remote data not available - Only local order checks processed." D HD^PSODDPR2():(($Y+5)'>IOSL) Q
"RTN","PSODDPR4",81,0)
 N PSORDI,RDIINST,RDIVUID,RDIRX,RDIDNAM,RDISTA,RDISIG,RDIDAYS,RDIQTY,RDIFILL,RDIEXP,RDIISS,RDIFILL,ZI
"RTN","PSODDPR4",82,0)
 N RDIREF,RDIPHYS,PSOPROD,PSOCLASS,DRNM,RDITMP,PSODC,IT,PSOICT,NDF,RDIDI,PSOPRODA,PSOFILE,PSOSIG,PSOSEQN,X
"RTN","PSODDPR4",83,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSODDPR4",84,0)
 S PSORDI=0
"RTN","PSODDPR4",85,0)
 I $T(GET^ORRDI1)]"" S PSORDI=$$GET^ORRDI1(PSODFN,"PSOO")
"RTN","PSODDPR4",86,0)
 I PSORDI<1 Q
"RTN","PSODDPR4",87,0)
 I '$D(^XTMP("ORRDI","PSOO",PSODFN)) Q
"RTN","PSODDPR4",88,0)
 K ^TMP($J,LIST,"OUT","REMOTE")
"RTN","PSODDPR4",89,0)
 D PARSE,FILTER
"RTN","PSODDPR4",90,0)
 I '$D(^TMP($J,LIST,"OUT","REMOTE")) Q
"RTN","PSODDPR4",91,0)
 N DIC D REMOTE^PSODDPR5
"RTN","PSODDPR4",92,0)
 Q
"RTN","PSODDPR4",93,0)
 ;
"RTN","PSODDPR4",94,0)
PARSE ; PULL INFORMATION FROM ^XTMP
"RTN","PSODDPR4",95,0)
 N PSORDI,LOCAL,NEWISS,BADEXP,PSOPRE,PSO30,NEWDC,NEWEXP
"RTN","PSODDPR4",96,0)
 S PSORDI=0 F  S PSORDI=$O(^XTMP("ORRDI","PSOO",PSODFN,PSORDI)) Q:'PSORDI  D
"RTN","PSODDPR4",97,0)
 .S RDISTA=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,5,0))
"RTN","PSODDPR4",98,0)
 .I RDISTA="DELETED" Q
"RTN","PSODDPR4",99,0)
 .S RDIINST=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,1,0))
"RTN","PSODDPR4",100,0)
 .S RDIDNAM=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,2,0))
"RTN","PSODDPR4",101,0)
 .S RDIVUID=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,3,0))
"RTN","PSODDPR4",102,0)
 .I RDIVUID="" Q
"RTN","PSODDPR4",103,0)
 .D GETPROD^PSOORRDI
"RTN","PSODDPR4",104,0)
 .Q:$E($G(PSOCLASS),1,2)="XA"
"RTN","PSODDPR4",105,0)
 .S RDIRX=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,4,0))
"RTN","PSODDPR4",106,0)
 .S RDIQTY=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,6,0))
"RTN","PSODDPR4",107,0)
 .S RDIDAYS=$P(RDIQTY,";",2),RDIQTY=$P(RDIQTY,";")
"RTN","PSODDPR4",108,0)
 .I $E(RDIDAYS)="D" S RDIDAYS=$P(RDIDAYS,"D",2)
"RTN","PSODDPR4",109,0)
 .S RDIEXP=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,7,0))
"RTN","PSODDPR4",110,0)
 .S RDIISS=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,8,0))
"RTN","PSODDPR4",111,0)
 .I RDIEXP?."/" S BADEXP=1 D  I BADEXP Q
"RTN","PSODDPR4",112,0)
 ..I RDIISS?."/" Q
"RTN","PSODDPR4",113,0)
 ..S PSOPRE=$E(DT) I $P(RDIISS,"/",3)>($E(DT,2,3)+1) S PSOPRE=PSOPRE-1
"RTN","PSODDPR4",114,0)
 ..S NEWISS=PSOPRE_$P(RDIISS,"/",3)_$P(RDIISS,"/")_$P(RDIISS,"/",2) I NEWISS>(DT-10000) S RDIEXP=RDIISS,BADEXP=0
"RTN","PSODDPR4",115,0)
 .I RDISTA["EXPIRE" S PSO30=0 D  I PSO30 Q
"RTN","PSODDPR4",116,0)
 ..S PSOPRE=$E(DT) I $P(RDIEXP,"/",3)>($E(DT,2,3)+1) S PSO30=1 Q
"RTN","PSODDPR4",117,0)
 ..S NEWEXP=PSOPRE_$P(RDIEXP,"/",3)_$P(RDIEXP,"/")_$P(RDIEXP,"/",2)
"RTN","PSODDPR4",118,0)
 ..S X1=NEWEXP,X2=30 D C^%DTC I X<DT S PSO30=1
"RTN","PSODDPR4",119,0)
 .I RDIRX'="" S LOCAL=0 D CHKLOCAL I LOCAL Q
"RTN","PSODDPR4",120,0)
 .S RDIFILL=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,9,0))
"RTN","PSODDPR4",121,0)
 .I RDISTA["DISCONT" S PSO30=0 D  I PSO30 Q
"RTN","PSODDPR4",122,0)
 ..S PSOPRE=$E(DT) I $P(RDIFILL,"/",3)>($E(DT,2,3)+1) S PSO30=1 Q
"RTN","PSODDPR4",123,0)
 ..S NEWDC=PSOPRE_$P(RDIFILL,"/",3)_$P(RDIFILL,"/")_$P(RDIFILL,"/",2)
"RTN","PSODDPR4",124,0)
 ..S X1=NEWDC,X2=30+RDIDAYS D C^%DTC I X<DT S PSO30=1
"RTN","PSODDPR4",125,0)
 .I RDISTA["DRUG INTERACTION" S RDISTA="NON-VERIFIED"
"RTN","PSODDPR4",126,0)
 .S RDIREF=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,10,0))
"RTN","PSODDPR4",127,0)
 .S RDIPHYS=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,11,0))
"RTN","PSODDPR4",128,0)
 .S PSOSIG="" F  S PSOSIG=$O(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,14,PSOSIG)) Q:PSOSIG=""  S PSOSIG(PSOSIG)=^(PSOSIG)
"RTN","PSODDPR4",129,0)
 .S ^TMP($J,LIST,"OUT","REMOTE",PSORDI)=RDIINST_"^"_RDIVUID_"^"_RDIDNAM_"^"_RDISTA_"^"_RDIRX_"^"_RDIFILL_"^"_RDIDAYS_"^"_RDIQTY_"^"_RDIREF_"^"_RDIEXP_"^"_RDIPHYS_"^"_RDIISS
"RTN","PSODDPR4",130,0)
 .S PSOSIG="" F  S PSOSIG=$O(PSOSIG(PSOSIG)) Q:PSOSIG=""  S ^TMP($J,LIST,"OUT","REMOTE",PSORDI,"SIG",PSOSIG)=PSOSIG(PSOSIG)
"RTN","PSODDPR4",131,0)
 Q
"RTN","PSODDPR4",132,0)
 ;
"RTN","PSODDPR4",133,0)
CHKLOCAL ; IF SAME RX NUMBER AND ISSUE DATE - LOCAL RX
"RTN","PSODDPR4",134,0)
 N PSOISS
"RTN","PSODDPR4",135,0)
 I $D(^PSRX("B",RDIRX)) D
"RTN","PSODDPR4",136,0)
 .N PSORX
"RTN","PSODDPR4",137,0)
 .S PSORX=$O(^PSRX("B",RDIRX,"")) I 'PSORX Q
"RTN","PSODDPR4",138,0)
 .S PSOISS=$P($G(^PSRX(PSORX,0)),"^",13)
"RTN","PSODDPR4",139,0)
 .S PSOISS=$E(PSOISS,4,5)_"/"_$E(PSOISS,6,7)_"/"_$E(PSOISS,2,3)
"RTN","PSODDPR4",140,0)
 .I PSOISS=RDIISS S LOCAL=1 Q
"RTN","PSODDPR4",141,0)
 Q
"RTN","PSODDPR4",142,0)
 ;
"RTN","PSODDPR4",143,0)
FILTER ; FOR SAME DRUG VUID FOR SAME SITE, KEEP 1 ENTRY - CHECK BY ACTIVE STATUS FIRST THEN BY GREATEST EXPIRATION DATE
"RTN","PSODDPR4",144,0)
 N XX,RDI,OLDEXP,RDIEXP,RDIEXP2,OLDEXP2,PSORDI,RDISTA,OLDSTA,OLDRDI,ZZ
"RTN","PSODDPR4",145,0)
 S PSORDI=0
"RTN","PSODDPR4",146,0)
 F  S PSORDI=$O(^TMP($J,LIST,"OUT","REMOTE",PSORDI)) Q:'PSORDI  D
"RTN","PSODDPR4",147,0)
 .S XX=$G(^TMP($J,LIST,"OUT","REMOTE",PSORDI)),RDIINST=$P(XX,"^"),RDIVUID=$P(XX,"^",2),RDISTA=$P(XX,"^",4),RDIEXP=$P(XX,"^",10) Q:RDIINST=""  Q:RDIVUID=""  I RDIEXP="" Q
"RTN","PSODDPR4",148,0)
 .I $D(RDI(RDIINST,RDIVUID)) S ZZ=RDI(RDIINST,RDIVUID) D  Q
"RTN","PSODDPR4",149,0)
 ..I RDISTA="ACTIVE"!(RDISTA["SUSPEN") D  Q
"RTN","PSODDPR4",150,0)
 ...S OLDSTA=$P(ZZ,"^",2) I OLDSTA["ACTIVE"!(OLDSTA["SUSPEN") D CHKEXP Q
"RTN","PSODDPR4",151,0)
 ...S OLDRDI=$P(ZZ,"^") K ^TMP($J,LIST,"OUT","REMOTE",OLDRDI) D SETRDI
"RTN","PSODDPR4",152,0)
 ..S OLDSTA=$P(ZZ,"^",2) I OLDSTA["ACTIVE"!(OLDSTA["SUSPEN") K ^TMP($J,LIST,"OUT","REMOTE",PSORDI) Q
"RTN","PSODDPR4",153,0)
 ..D CHKEXP ; ALL OTHER STATUSES - KEEP BY GREATER EXPIRATION DATE
"RTN","PSODDPR4",154,0)
 .D SETRDI
"RTN","PSODDPR4",155,0)
 Q
"RTN","PSODDPR4",156,0)
 ;
"RTN","PSODDPR4",157,0)
CHKEXP ; 
"RTN","PSODDPR4",158,0)
 N PSOPRE
"RTN","PSODDPR4",159,0)
 S OLDEXP=$P(ZZ,"^",3) D  I OLDEXP2>RDIEXP2 K ^TMP($J,"OUT","REMOTE",PSORDI) Q
"RTN","PSODDPR4",160,0)
 .S PSOPRE=$E(DT) I $P(RDIEXP,"/",3)>($E(DT,2,3)+1) S PSOPRE=PSOPRE-1
"RTN","PSODDPR4",161,0)
 .S RDIEXP2=PSOPRE_$P(RDIEXP,"/",3)_$P(RDIEXP,"/")_$P(RDIEXP,"/",2)
"RTN","PSODDPR4",162,0)
 .S PSOPRE=$E(DT) I $P(OLDEXP,"/",3)>($E(DT,2,3)+1) S PSOPRE=PSOPRE-1
"RTN","PSODDPR4",163,0)
 .S OLDEXP2=PSOPRE_$P(OLDEXP,"/",3)_$P(OLDEXP,"/")_$P(OLDEXP,"/",2)
"RTN","PSODDPR4",164,0)
 S OLDRDI=$P(ZZ,"^") K ^TMP($J,LIST,"OUT","REMOTE",OLDRDI) D SETRDI
"RTN","PSODDPR4",165,0)
 Q
"RTN","PSODDPR4",166,0)
 ;
"RTN","PSODDPR4",167,0)
SETRDI ;
"RTN","PSODDPR4",168,0)
 S RDI(RDIINST,RDIVUID)=PSORDI_"^"_RDISTA_"^"_RDIEXP
"RTN","PSODDPR4",169,0)
 Q
"RTN","PSODDPR4",170,0)
CPRS(PSODFN,LIST,PDRG,PTY) ;
"RTN","PSODDPR4",171,0)
 ;PDRG - Drug array in format of PDRG(n)=IEN (#50) ^ Drug name
"RTN","PSODDPR4",172,0)
 ;PTY - P1;P2 where P1="I" for IP & "O" for OP (required), P2=Pharm order# (optional)
"RTN","PSODDPR4",173,0)
 I '$G(PSODFN) W !,"Patient UNDEFINED!",! Q
"RTN","PSODDPR4",174,0)
 I '$O(PDRG(0)) W !,"Dispense Drug(s) UNDEFINED!",! Q
"RTN","PSODDPR4",175,0)
 I '$D(LIST) W !,"Input Base UNDEFINED!",! Q
"RTN","PSODDPR4",176,0)
 K ^TMP($J,"ORDERS"),^TMP($J,"DD"),^TMP($J,LIST) S (INDX,INDD)=0
"RTN","PSODDPR4",177,0)
 ;build patient's drug profile outpat/inpat/non-va
"RTN","PSODDPR4",178,0)
 D BLD^PSOORDRG,ENCHK^PSJORUT2(PSODFN,.INDX),NVA^PSOORDRG
"RTN","PSODDPR4",179,0)
 ;dup drug check CPRS ONLY
"RTN","PSODDPR4",180,0)
 S PSOICT="",CNT=0 F ZII=0:0 S ZII=$O(PDRG(ZII)) Q:'ZII  D
"RTN","PSODDPR4",181,0)
 .S PSOY=$P(PDRG(ZII),"^")_"^"_$P($G(^PSDRUG($P(PDRG(ZII),"^"),0)),"^"),PSOY(0)=$G(^PSDRUG(PDRG(ZII),0))
"RTN","PSODDPR4",182,0)
 .S IEN=+PSOY,NAME=$P(PSOY,"^",2),DNM=0 K PSOX1,PSOY
"RTN","PSODDPR4",183,0)
 .F  S DNM=$O(^TMP($J,"ORDERS",DNM)) Q:'DNM  I NAME=$P(^TMP($J,"ORDERS",DNM),"^",3) D
"RTN","PSODDPR4",184,0)
 ..S INDD=$G(INDD)+1,^TMP($J,"DD",INDD,0)=IEN_"^"_NAME_"^"_$P(^TMP($J,"ORDERS",DNM),"^",4)_"^"_$P(^(DNM),"^",5)
"RTN","PSODDPR4",185,0)
 K ^TMP($J,"ORDERS")
"RTN","PSODDPR4",186,0)
 D ORD
"RTN","PSODDPR4",187,0)
 Q
"RTN","PSODDPR4",188,0)
DRG ;
"RTN","PSODDPR4",189,0)
 I $P($G(^PSDRUG(IEN,0)),"^",3)["S"!($E($P($G(^PSDRUG(IEN,0)),"^",2),1,2)="XA") Q
"RTN","PSODDPR4",190,0)
 N ID,SEQN S PSODRUG("NDF")=$S($G(^PSDRUG(IEN,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)
"RTN","PSODDPR4",191,0)
 S ID=$$GETVUID^XTID(50.68,,+$P($G(PSODRUG("NDF")),"A",2)_",")
"RTN","PSODDPR4",192,0)
 S P1=$P($G(^PSDRUG(IEN,"ND")),"^"),P2=$P($G(^("ND")),"^",3),X=$$PROD0^PSNAPIS(P1,P2),SEQN=$P(X,"^",7)
"RTN","PSODDPR4",193,0)
 S CNT=$G(CNT)+1,^TMP($J,LIST,"IN","PROSPECTIVE",$P(PTY,";")_";"_$P(PTY,";",2)_";PROSPECTIVE;"_CNT)=SEQN_"^"_+ID_"^"_IEN_"^"_NAME
"RTN","PSODDPR4",194,0)
 K ID,SEQN,P1,P2,X,DNM
"RTN","PSODDPR4",195,0)
 Q
"RTN","PSODDPR5")
0^19^B70994765
"RTN","PSODDPR5",1,0)
PSODDPR5 ;BIR/SAB - displays OP/rdi/pending/nva orders ;09/320/06 11:33am
"RTN","PSODDPR5",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**251**;DEC 1997;Build 202
"RTN","PSODDPR5",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSODDPR5",4,0)
 ;External reference to ^PS(50.606 supported by DBIA 2174
"RTN","PSODDPR5",5,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSODDPR5",6,0)
 ;
"RTN","PSODDPR5",7,0)
EXC ;displays order check exceptions
"RTN","PSODDPR5",8,0)
 N Q,CT,ONT,OT,ON,TD,ERRTY,OP,OPP,ZEXC,ZREA,X,DIWL,DIWR,DIWF
"RTN","PSODDPR5",9,0)
 I ($Y+5)'>IOSL D HD^PSODDPR2() Q:$G(PSODLQT)  ;W @IOF
"RTN","PSODDPR5",10,0)
 S (CT,Q)=0,ONT=""
"RTN","PSODDPR5",11,0)
 F  S ONT=$O(^TMP($J,LIST,"OUT","EXCEPTIONS",ONT)) Q:ONT=""  F  S CT=$O(^TMP($J,LIST,"OUT","EXCEPTIONS",ONT,CT)) Q:'CT  D
"RTN","PSODDPR5",12,0)
 .S ZEXC=^TMP($J,LIST,"OUT","EXCEPTIONS",ONT,CT),ZREA=$P(^TMP($J,LIST,"OUT","EXCEPTIONS",ONT,CT),"^",10)
"RTN","PSODDPR5",13,0)
 .S OT=$P(ONT,";"),ON=$P(ONT,";",2),OP=$P(ONT,";",3),OPP=OT_";"_ON_";"_OP
"RTN","PSODDPR5",14,0)
 .I OT="Z",ZREA="Drug not matched to NDF"!($P(^TMP($J,LIST,"OUT","EXCEPTIONS",ONT,CT),"^",7)["manual check") S PSODRUG("BAD",PSODRUG("IEN"))=1
"RTN","PSODDPR5",15,0)
 .Q:$G(^TMP($J,"PSEXC","OUT",OPP))
"RTN","PSODDPR5",16,0)
 .S Q=Q+1,ERRTY=$S(OT="R":"RDI",OT="N":"Non-VA",OT="P":"Pending",OT="O":"Rx",1:"")
"RTN","PSODDPR5",17,0)
 .K ^UTILITY($J,"W") S DIWL=1,DIWR=75,DIWF=""
"RTN","PSODDPR5",18,0)
 .W ! S X=$P(^TMP($J,LIST,"OUT","EXCEPTIONS",ONT,CT),"^",7) D ^DIWP
"RTN","PSODDPR5",19,0)
 .F ZX=0:0 S ZX=$O(^UTILITY($J,"W",1,ZX)) Q:'ZX  W !,^UTILITY($J,"W",1,ZX,0)
"RTN","PSODDPR5",20,0)
 .S:OT'="Z" ^TMP($J,"PSEXC","OUT",OPP)=1
"RTN","PSODDPR5",21,0)
 .Q:ZREA=""
"RTN","PSODDPR5",22,0)
 .K ^UTILITY($J,"W") S DIWL=1,DIWR=75,DIWF=""
"RTN","PSODDPR5",23,0)
 .S X="   Reason: "_ZREA D ^DIWP
"RTN","PSODDPR5",24,0)
 .F ZX=0:0 S ZX=$O(^UTILITY($J,"W",1,ZX)) Q:'ZX  W !,^UTILITY($J,"W",1,ZX,0)
"RTN","PSODDPR5",25,0)
 .K ^UTILITY($J,"W"),X,DIWL,DIWR,DIWF
"RTN","PSODDPR5",26,0)
 .D:$O(^TMP($J,LIST,"OUT","EXCEPTIONS",ONT,CT)) HD^PSODDPR2() Q:$G(PSODLQT)
"RTN","PSODDPR5",27,0)
 W !! K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to Continue" D ^DIR S:($D(DTOUT))!($D(DUOUT)) PSODLQT=1,PSORX("DFLG")=1 K DIR,X,Y I ($Y+5)>IOSL W @IOF
"RTN","PSODDPR5",28,0)
 Q
"RTN","PSODDPR5",29,0)
NOCAN ;shows duplicate therapeutic when cancel duplicate class parameter is et to 'no'
"RTN","PSODDPR5",30,0)
 K ^UTILITY($J,"W"),DDTH,DOCPL S DIWL=1,DIWR=78,DIWF="",(CT,SUB)=0 K TCT,TCTP,TCTL,TCTI,ZZQ,ZHDR
"RTN","PSODDPR5",31,0)
 F  S CT=$O(^TMP($J,LIST,"OUT","THERAPY",CT)) Q:'CT  F  S SUB=$O(^TMP($J,LIST,"OUT","THERAPY",CT,"DRUGS",SUB)) Q:'SUB  D
"RTN","PSODDPR5",32,0)
 .S ON=$P(^TMP($J,LIST,"OUT","THERAPY",CT,"DRUGS",SUB),"^"),PDRG=$P(^(SUB),"^",3),RXREC=$P(ON,";",2)
"RTN","PSODDPR5",33,0)
 .I $G(PSODCTH(ON)) Q
"RTN","PSODDPR5",34,0)
 .I $P(ON,";")="Z" Q
"RTN","PSODDPR5",35,0)
 .I $P(ON,";")="N",$G(^TMP($J,"PSONVADD",RXREC,0)) Q
"RTN","PSODDPR5",36,0)
 .I $P(ON,";")="R",$G(^TMP($J,"PSORMDD",RXREC,0)) Q
"RTN","PSODDPR5",37,0)
 .I $P(ON,";")="O",$G(^TMP("PSORXDC",$J,RXREC,0)) Q
"RTN","PSODDPR5",38,0)
 .I $P(ON,";")="P",$G(^TMP("PSORXDC",$J,RXREC,0)) Q
"RTN","PSODDPR5",39,0)
 .I $P(ON,";")="O",$G(^TMP("PSORXDD",$J,RXREC,0)) Q
"RTN","PSODDPR5",40,0)
 .I '$G(ZHDR) D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)  W !,PSONULN,!,"*** THERAPEUTIC DUPLICATION(S) *** "_PSODRUG("NAME")_" with",! S ZHDR=1
"RTN","PSODDPR5",41,0)
 Q:'$G(ZHDR)  Q:$G(PSODLQT)
"RTN","PSODDPR5",42,0)
 N ST,STA,STAT,ORT K DOCPL
"RTN","PSODDPR5",43,0)
 S (SUB,CT)=0 F  S CT=$O(^TMP($J,LIST,"OUT","THERAPY",CT)) Q:'CT  F  S SUB=$O(^TMP($J,LIST,"OUT","THERAPY",CT,"DRUGS",SUB)) Q:'SUB  D DUPCL K DDTH
"RTN","PSODDPR5",44,0)
 D DUPCP
"RTN","PSODDPR5",45,0)
 Q
"RTN","PSODDPR5",46,0)
DUPCL ;
"RTN","PSODDPR5",47,0)
 S ON=$P(^TMP($J,LIST,"OUT","THERAPY",CT,"DRUGS",SUB),"^"),PDRG=$P(^(SUB),"^",3),RXREC=$P(ON,";",2)
"RTN","PSODDPR5",48,0)
 I $P(ON,";")="Z" Q
"RTN","PSODDPR5",49,0)
 I $P(ON,";")="N",$G(^TMP($J,"PSONVADD",RXREC,0)) Q
"RTN","PSODDPR5",50,0)
 I $P(ON,";")="R",$G(^TMP($J,"PSORMDD",RXREC,0)) Q
"RTN","PSODDPR5",51,0)
 I $P(ON,";")="O",$G(^TMP("PSORXDC",$J,RXREC,0)) Q
"RTN","PSODDPR5",52,0)
 I $P(ON,";")="P",$G(^TMP("PSORXDC",$J,RXREC,0)) Q
"RTN","PSODDPR5",53,0)
 I $P(ON,";")="O",$G(^TMP("PSORXDD",$J,RXREC,0)) Q
"RTN","PSODDPR5",54,0)
 ;Q:$G(DDTH(ON))
"RTN","PSODDPR5",55,0)
 S ORT=$S($P(ON,";")="N":4,$P(ON,";")="P":3,$P(ON,";")="R":2,1:1)
"RTN","PSODDPR5",56,0)
 S DOCPL(ORT,ON)=""
"RTN","PSODDPR5",57,0)
 Q
"RTN","PSODDPR5",58,0)
DUPCP D HD^PSODDPR2():(($Y+5)'>IOSL) S ORT=0,ON=""  F  S ORT=$O(DOCPL(ORT)) Q:'ORT!$G(PSODLQT)  F  S ON=$O(DOCPL(ORT,ON)) Q:ON=""!$G(PSODLQT)  D
"RTN","PSODDPR5",59,0)
 .I $P(ON,";")="O" D
"RTN","PSODDPR5",60,0)
 ..D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)  S ST=$P(^PSRX($P(ON,";",2),"STA"),"^")+1
"RTN","PSODDPR5",61,0)
 ..S STA="ACTIVE^NON-VERIFIED^REFILL^HOLD^NON-VERIFIED^SUSPENDED^^^^^^EXPIRED^DISCONTINUED^^DISCONTINUED BY PROVIDER^DISCONTINUE EDIT^PROVIDER HOLD"
"RTN","PSODDPR5",62,0)
 ..S STAT=$P(STA,"^",ST) W !?2,"Local Rx #"_$P(^PSRX($P(ON,";",2),0),"^")_" ("_STAT_") for "_$P(^PSDRUG($P(^PSRX($P(ON,";",2),0),"^",6),0),"^")
"RTN","PSODDPR5",63,0)
 .I $P(ON,";")="P" D
"RTN","PSODDPR5",64,0)
 ..D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)
"RTN","PSODDPR5",65,0)
 ..S RXREC=$P(ON,";",2),DNM=$P(^PS(52.41,RXREC,0),"^",9)
"RTN","PSODDPR5",66,0)
 ..S DUPRX0=^PS(52.41,RXREC,0)
"RTN","PSODDPR5",67,0)
 ..W !?2,"Pending Order for "
"RTN","PSODDPR5",68,0)
 ..I '$P(DUPRX0,"^",9) W $P(^PS(50.7,$P(DUPRX0,"^",8),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSODDPR5",69,0)
 ..E  W $P(^PSDRUG($P(DUPRX0,"^",9),0),"^")
"RTN","PSODDPR5",70,0)
 .I $P(ON,";")="R" N RXDAT D
"RTN","PSODDPR5",71,0)
 ..D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)
"RTN","PSODDPR5",72,0)
 ..S RXDAT=^TMP($J,LIST,"OUT","REMOTE",$P(ON,";",2))
"RTN","PSODDPR5",73,0)
 ..S RDIRX=$P(RXDAT,"^",5) D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)  W !?2,"Remote Rx #"_RDIRX_" ("_$P(RXDAT,"^",4)_") for "_$P(RXDAT,"^",3)
"RTN","PSODDPR5",74,0)
 .I $P(ON,";")="N" D
"RTN","PSODDPR5",75,0)
 ..Q:'$D(^PS(55,PSODFN,"NVA",$P(ON,";",2),0))
"RTN","PSODDPR5",76,0)
 ..S DUPRX0=^PS(55,PSODFN,"NVA",$P(ON,";",2),0) N NVAQ
"RTN","PSODDPR5",77,0)
 ..D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)
"RTN","PSODDPR5",78,0)
 ..W !?2,"Non-VA Med for "
"RTN","PSODDPR5",79,0)
 ..I '$P(DUPRX0,"^",2) W $P(^PS(50.7,$P(DUPRX0,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSODDPR5",80,0)
 ..E  W $P(^PSDRUG($P(DUPRX0,"^",2),0),"^")
"RTN","PSODDPR5",81,0)
 .S DDTH(ON)=1
"RTN","PSODDPR5",82,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)
"RTN","PSODDPR5",83,0)
 D CLASSES^PSODDPR3
"RTN","PSODDPR5",84,0)
 D HD^PSODDPR2(0,1) Q:$G(PSODLQT)
"RTN","PSODDPR5",85,0)
 ;K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to Continue" D ^DIR K DIR,X,Y W @IOF
"RTN","PSODDPR5",86,0)
 Q
"RTN","PSODDPR5",87,0)
REMOTE ;backdoor RDI
"RTN","PSODDPR5",88,0)
 Q:$G(PSODLQT)
"RTN","PSODDPR5",89,0)
 S PSORDI=0 F  S PSORDI=$O(^TMP($J,LIST,"OUT","REMOTE",PSORDI)) Q:'PSORDI!$G(PSODLQT)  S RDITMP=^(PSORDI) D  K PSOSEQN
"RTN","PSODDPR5",90,0)
 .I $P(RDITMP,"^",2)="" Q
"RTN","PSODDPR5",91,0)
 .S RDIVUID=$P(RDITMP,"^",2),RDIDNAM=$P(RDITMP,"^",3)
"RTN","PSODDPR5",92,0)
 .I $O(PDRG(0)) F ZI=0:0 S ZI=$O(PDRG(ZI)) Q:'ZI  I $P(^PSDRUG($P(PDRG(ZI),"^"),0),"^")=RDIDNAM S INDD=+$G(INDD)+1,^TMP($J,"DD",INDD,0)=$P(PDRG(ZI),"^")_"^"_RDIDNAM_"^^"_PSORDI_"Z;O"
"RTN","PSODDPR5",93,0)
 .S DO=$G(DO)+1 D GETIREF^XTID(50.68,.01,RDIVUID,"PSOSEQN",1) I 'PSOSEQN S ^TMP($J,LIST,"IN","PROFILE","R;"_PSORDI_";PROFILE;"_DO)=0_"^"_RDIVUID_"^0^"_RDIDNAM_"^^" Q
"RTN","PSODDPR5",94,0)
 .S SEQN="" S SEQN=$O(PSOSEQN(50.68,.01,SEQN)) Q:SEQN=""
"RTN","PSODDPR5",95,0)
 .S P3=+SEQN,SEQN=$P($$PROD0^PSNAPIS(,P3),"^",7)
"RTN","PSODDPR5",96,0)
 .S ^TMP($J,LIST,"IN","PROFILE","R;"_PSORDI_";PROFILE;"_DO)=SEQN_"^"_RDIVUID_"^0^"_RDIDNAM_"^^"
"RTN","PSODDPR5",97,0)
 Q
"RTN","PSODDPR5",98,0)
NSRT ;sort of drug interactions ; called by psoddpr2
"RTN","PSODDPR5",99,0)
 Q:$G(PSODLQT)  S COUNT=0
"RTN","PSODDPR5",100,0)
 F  S SV=$O(^TMP($J,LIST,"OUT","DRUGDRUG",SV)) Q:SV=""!$G(PSODLQT)  D  Q:$G(PSORX("DFLG"))
"RTN","PSODDPR5",101,0)
 .F  S DRG=$O(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG)) Q:DRG=""!$G(PSODLQT)  F  S ON=$O(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON)) Q:ON=""!$G(PSODLQT)  F  S CT=$O(^TMP($J,LIST,"OUT","DRUGDRUG",SV,DRG,ON,CT)) Q:'CT!$G(PSODLQT)  D
"RTN","PSODDPR5",102,0)
 ..I $P(ON,";")="O",$P(^PSRX($P(ON,";",2),"STA"),"^")>5,$P(^PSRX($P(ON,";",2),"STA"),"^")'=16 Q
"RTN","PSODDPR5",103,0)
 ..I $P(ON,";")="R" D RVAGEN Q
"RTN","PSODDPR5",104,0)
 ..I $P(ON,";")="P",'$P($G(^PS(52.41,$P(ON,";",2),0)),"^",9) S PSORDIT=$P($G(^PS(52.41,$P(ON,";",2),0)),"^",9) D:$G(PSORDIT) DVAGEN Q
"RTN","PSODDPR5",105,0)
 ..I $P(ON,";")="N",'$P($G(^PS(55,PSODFN,"NVA",$P(ON,";",2),0)),"^",2) S PSORDIT=$P($G(^PS(55,PSODFN,"NVA",$P(ON,";",2),0)),"^") D:$G(PSORDIT) DVAGEN Q
"RTN","PSODDPR5",106,0)
 ..S PSODD=$O(^PSDRUG("B",DRG,0)) D VAGEN^PSODDPR3(PSODD)
"RTN","PSODDPR5",107,0)
 ..S ZOT=$S($P(ON,";")="O":1,$P(ON,";")="R":2,$P(ON,";")="P":3,1:4)
"RTN","PSODDPR5",108,0)
 ..S ZDGDG(SV,ZOT,PSOVAG,DRG)=ON_"^"_CT
"RTN","PSODDPR5",109,0)
 ;
"RTN","PSODDPR5",110,0)
 N SV,TYP,PSOVAG,PSONAM K ZZDGDG,NSRT S (SV,TYP,PSOVAG,PSONAM)=""
"RTN","PSODDPR5",111,0)
 F  S SV=$O(ZDGDG(SV)) Q:SV=""  F  S TYP=$O(ZDGDG(SV,TYP)) Q:TYP=""  F  S PSOVAG=$O(ZDGDG(SV,TYP,PSOVAG)) Q:PSOVAG=""  D
"RTN","PSODDPR5",112,0)
 .F  S PSONAM=$O(ZDGDG(SV,TYP,PSOVAG,PSONAM)) Q:PSONAM=""  D
"RTN","PSODDPR5",113,0)
 ..I '$D(NSRT(SV,PSOVAG)) S NSRT(SV,PSOVAG)=TYP
"RTN","PSODDPR5",114,0)
 ..E  S $P(NSRT(SV,PSOVAG),"^",1)=$P(NSRT(SV,PSOVAG),"^",1)_","_TYP
"RTN","PSODDPR5",115,0)
 ;resort of zdgdg
"RTN","PSODDPR5",116,0)
 N SEV,STOP,PSOVAG,TYP,CNT,CHK
"RTN","PSODDPR5",117,0)
 K ZZDGDG S (SEV,STOP,PSOVAG,TYP)="",CNT=0
"RTN","PSODDPR5",118,0)
 F J=1:1:4 F  S SEV=$O(NSRT(SEV)) Q:SEV=""  F I=1:1:4 F  S PSOVAG=$O(NSRT(SEV,PSOVAG)) Q:PSOVAG=""  D
"RTN","PSODDPR5",119,0)
 .F TYP=1:1:$L(NSRT(SEV,PSOVAG),",") Q:$P(NSRT(SEV,PSOVAG),",",TYP)']""  D
"RTN","PSODDPR5",120,0)
 .S TYP="",TYP=","_$P(NSRT(SEV,PSOVAG),"^",1)_","
"RTN","PSODDPR5",121,0)
 .Q:TYP'[(","_J_",")
"RTN","PSODDPR5",122,0)
 .S STOP=0 F CHK=1:1:4 I TYP[(","_CHK_",")&(CHK<J) S STOP=1
"RTN","PSODDPR5",123,0)
 .Q:STOP
"RTN","PSODDPR5",124,0)
 .S CNT=CNT+1 F I=J:1:4 S TYP=I I $D(ZDGDG(SEV,TYP)) D S2(SEV,TYP,PSOVAG,CNT)
"RTN","PSODDPR5",125,0)
 K NSRT,J,F,ZDGDG,COUNT,CNT
"RTN","PSODDPR5",126,0)
 Q
"RTN","PSODDPR5",127,0)
 ;print order sort
"RTN","PSODDPR5",128,0)
S2(SEV,TYP,PSOVAG,CNT) ;
"RTN","PSODDPR5",129,0)
 N PSONAM S (PSONAM)="",COUNT2=0
"RTN","PSODDPR5",130,0)
 F  S PSONAM=$O(ZDGDG(SEV,TYP,PSOVAG,PSONAM)) Q:PSONAM=""  S COUNT2=COUNT2+1 D
"RTN","PSODDPR5",131,0)
 .S:$G(ZZDGDG2(SEV,PSOVAG)) ZZDGDG2(SEV,PSOVAG)=ZZDGDG2(SEV,PSOVAG)+1 S:'$G(ZZDGDG2(SEV,PSOVAG)) ZZDGDG2(SEV,PSOVAG)=1
"RTN","PSODDPR5",132,0)
 .S ZZDGDG(SEV,CNT,TYP,PSOVAG,PSONAM)=ZDGDG(SEV,TYP,PSOVAG,PSONAM)
"RTN","PSODDPR5",133,0)
 Q
"RTN","PSODDPR5",134,0)
 ;
"RTN","PSODDPR5",135,0)
NSRT1 ;sort out dc'd drug therapies local and remote rxs
"RTN","PSODDPR5",136,0)
 S (SUB,CT)=0 K PSODCTH N RXN
"RTN","PSODDPR5",137,0)
 F  S CT=$O(^TMP($J,LIST,"OUT","THERAPY",CT)) Q:'CT  F  S SUB=$O(^TMP($J,LIST,"OUT","THERAPY",CT,"DRUGS",SUB)) Q:'SUB  D
"RTN","PSODDPR5",138,0)
 .S ON=$P(^TMP($J,LIST,"OUT","THERAPY",CT,"DRUGS",SUB),"^")
"RTN","PSODDPR5",139,0)
 .I $P(ON,";")="O",$P($G(^PSRX($P(ON,";",2),3)),"^",5) D  Q
"RTN","PSODDPR5",140,0)
 ..S RXN=$P(ON,";",2),X1=$P($G(^PSRX($P(ON,";",2),3)),"^",5),X2=(+$P(^PSRX($P(ON,";",2),0),"^",8)+7)
"RTN","PSODDPR5",141,0)
 ..D C^%DTC I X<DT S PSODCTH(ON)=1 K X,Y,X1,X2
"RTN","PSODDPR5",142,0)
 .I $P(ON,";")="R",$P($G(^TMP($J,LIST,"OUT","REMOTE",$P(ON,";",2))),"^",4)["DISC" D
"RTN","PSODDPR5",143,0)
 ..S RXN=$P(ON,";",2) K X,Y,X1,X2
"RTN","PSODDPR5",144,0)
 ..S X=$P(^TMP($J,LIST,"OUT","REMOTE",RXN),"^",6) D ^%DT S X1=Y,X2=(+$P(^TMP($J,LIST,"OUT","REMOTE",RXN),"^",7)+7)
"RTN","PSODDPR5",145,0)
 ..D C^%DTC I X<DT S PSODCTH(ON)=1 K X,Y,X1,X2
"RTN","PSODDPR5",146,0)
 Q
"RTN","PSODDPR5",147,0)
 ;
"RTN","PSODDPR5",148,0)
RVAGEN ;va generic for remote drugs
"RTN","PSODDPR5",149,0)
 N PSOVIUD,PSONDF,PSOVAG,DIC
"RTN","PSODDPR5",150,0)
 S PSOVUID=$P(^TMP($J,"PSOPEPS","OUT","REMOTE",$P(ON,";",2)),"^",2) Q:'$G(PSOVUID)
"RTN","PSODDPR5",151,0)
 K PSORDIID S PSOVAGEN="" D GETIREF^XTID("50.68",".01",PSOVUID,"PSORDIID")
"RTN","PSODDPR5",152,0)
 S PSONDF=$O(PSORDIID(50.68,.01,"")) K PSORDIID
"RTN","PSODDPR5",153,0)
 I +PSONDF D DATA^PSN50P68(+PSONDF,,"PSONDF") S PSOVAG=$P($G(^TMP($J,"PSONDF",+PSONDF,.05)),U,2),ZDGDG(SV,2,PSOVAG,DRG)=ON_"^"_CT
"RTN","PSODDPR5",154,0)
 K ^TMP($J,"PSONDF")
"RTN","PSODDPR5",155,0)
 Q
"RTN","PSODDPR5",156,0)
 ;
"RTN","PSODDPR5",157,0)
DVAGEN ;va generic for non-va/pending meds
"RTN","PSODDPR5",158,0)
 S PSI=0 N PSID,PSODD,PSOVAG
"RTN","PSODDPR5",159,0)
 F  S PSI=$O(^PSDRUG("ASP",PSORDIT,PSI)) Q:'PSI  I $S('$D(^PSDRUG(PSI,"I")):1,'^("I"):1,DT'>^("I"):1,1:0),$S($P($G(^PSDRUG(PSI,2)),"^",3)'["O":0,1:1) S PSID=$P($G(^PSDRUG(PSI,0)),"^") Q
"RTN","PSODDPR5",160,0)
 Q:$G(PSID)']""
"RTN","PSODDPR5",161,0)
 S PSODD=$O(^PSDRUG("B",PSID,0)) D VAGEN^PSODDPR3(PSODD)
"RTN","PSODDPR5",162,0)
 Q:$G(PSOVAG)']""
"RTN","PSODDPR5",163,0)
 S ZOT=$S($P(ON,";")="O":1,$P(ON,";")="R":2,$P(ON,";")="P":3,1:4),ZDGDG(SV,ZOT,PSOVAG,DRG)=ON_"^"_CT,COUNT=COUNT+1
"RTN","PSODDPR5",164,0)
 K PSI,PSID,PSORDIT,PSODD,PSOVAG
"RTN","PSODDPR5",165,0)
 Q
"RTN","PSODDPRE")
0^11^B115217514
"RTN","PSODDPRE",1,0)
PSODDPRE ;BIR/SAB - enhanced OP order checks ;09/20/06 3:38pm
"RTN","PSODDPRE",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**324,251**;DEC 1997;Build 202
"RTN","PSODDPRE",3,0)
 ;
"RTN","PSODDPRE",4,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSODDPRE",5,0)
 ;External references to ^ORRDI1 supported by DBIA 4659
"RTN","PSODDPRE",6,0)
 ;External references to ^PSSDSAPM supported by DBIA 5570
"RTN","PSODDPRE",7,0)
 ;External references to ^PSSHRQ2 supported by DBIA 5369
"RTN","PSODDPRE",8,0)
 K IT,^TMP("PSORXDC",$J),^TMP("PSORXDD",$J),CLS,^TMP("PSOTIME IN",DT),^TMP($J,"PSONVADD"),^TMP($J,"PSONRVADD"),^TMP($J,"PSORDI"),^TMP($J,"PSORMDD")
"RTN","PSODDPRE",9,0)
 N PSONULN,PSODLQT,ZZPSODRG S LIST="PSOPEPS",$P(PSONULN,"-",79)="-",(STA,DNM)="" K ^TMP($J,LIST)
"RTN","PSODDPRE",10,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)
"RTN","PSODDPRE",11,0)
 F  S STA=$O(PSOSD(STA)) Q:STA=""  F  S DNM=$O(PSOSD(STA,DNM)) Q:DNM=""!$G(PSORX("DFLG"))  I $P(PSOSD(STA,DNM),"^")'=$G(PSORENW("OIRXN")) D  Q:$G(PSORX("DFLG"))
"RTN","PSODDPRE",12,0)
 .I STA="PENDING" D ^PSODDPR1 Q
"RTN","PSODDPRE",13,0)
 .I STA="ZNONVA" D NVA^PSODDPR1 Q
"RTN","PSODDPRE",14,0)
 .D:PSODRUG("NAME")=$P(DNM,"^")&('$D(^XUSEC("PSORPH",DUZ)))  Q:$G(PSORX("DFLG"))
"RTN","PSODDPRE",15,0)
 ..I '$P(PSOPAR,"^",2),'$P(PSOPAR,"^",16) D DUP I $G(PSOTECCK) S PSORX("DFLG")=1 Q
"RTN","PSODDPRE",16,0)
 ..I '$P(PSOPAR,"^",2),$P(PSOPAR,"^",16),$G(PSOTECCK) D DUP Q
"RTN","PSODDPRE",17,0)
 ..I $P(PSOPAR,"^",2),$G(PSOTECCK) D  Q
"RTN","PSODDPRE",18,0)
 ...S DA=+PSOSD(STA,DNM),PSOCLC=DUZ
"RTN","PSODDPRE",19,0)
 ...S MSG="Discontinued During Reinstating Prescription Entry",ACT="Discontinued during Rx Reinstate."
"RTN","PSODDPRE",20,0)
 ...S ^TMP("PSORXDC",$J,DA,0)="52^"_DA_"^"_MSG_"^C^"_ACT_"^"_STA_"^"_DNM,PSONOOR="D",^TMP("PSORXDD",$J)=DNM
"RTN","PSODDPRE",21,0)
 ..I $P($G(PSOPAR),"^",16) D DUP Q
"RTN","PSODDPRE",22,0)
 ..I $P(PSOPAR,"^",2),'$P(PSOPAR,"^",16) D DUP S PSORX("DFLG")=1 Q
"RTN","PSODDPRE",23,0)
 .D:PSODRUG("NAME")=$P(DNM,"^")&($D(^XUSEC("PSORPH",DUZ))) DUP
"RTN","PSODDPRE",24,0)
 K ^TMP($J,"DD"),^TMP($J,"DC"),^TMP($J,"DI"),^TMP($J,"PSODRDI")
"RTN","PSODDPRE",25,0)
 Q:$G(PSORX("DFLG"))
"RTN","PSODDPRE",26,0)
 M ZZPSODRG=PSODRUG
"RTN","PSODDPRE",27,0)
 S LIST="PSOPEPS" D REMOTE^PSOCPPRE
"RTN","PSODDPRE",28,0)
 M PSODRUG=ZZPSODRG
"RTN","PSODDPRE",29,0)
 Q
"RTN","PSODDPRE",30,0)
OBX  ;process enhanced order checks
"RTN","PSODDPRE",31,0)
 K ZDGDG,ZTHER,IT
"RTN","PSODDPRE",32,0)
 S LIST="PSOPEPS" K PSODLQT,DTOUT,DUOUT,DIRUT,PSODOSD
"RTN","PSODDPRE",33,0)
 S ^TMP($J,LIST,"IN","PING")="" D IN^PSSHRQ2(LIST)
"RTN","PSODDPRE",34,0)
 I $P(^TMP($J,LIST,"OUT",0),"^")=-1 K DIR D  G EXIT
"RTN","PSODDPRE",35,0)
 .S DIR(0)="E",DIR("A",1)="No Enhanced Order Checks can be performed."
"RTN","PSODDPRE",36,0)
 .S DIR("A",2)="   Reason: "_$P($G(^TMP($J,LIST,"OUT",0)),"^",2)
"RTN","PSODDPRE",37,0)
 .S DIR("A")="Press Return to continue...",DIR("?")="Press Return to continue"
"RTN","PSODDPRE",38,0)
 .W ! D ^DIR K DIRUT,DUOUT,DIR,X,Y I ($Y+5)>IOSL W @IOF
"RTN","PSODDPRE",39,0)
 K ^TMP($J,LIST,"IN","PING"),^TMP($J,LIST,"OUT","EXCEPTIONS")
"RTN","PSODDPRE",40,0)
 W !,"Now Processing Enhanced Order Checks!  Please wait...",!
"RTN","PSODDPRE",41,0)
 D FDB S PDRG=PSODRUG("IEN"),DO=0 D IN^PSSHRQ2(LIST)    ;call 2 fdb
"RTN","PSODDPRE",42,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)!($D(DTOUT))!($D(DUOUT))!($D(DIRUT))
"RTN","PSODDPRE",43,0)
 I $P(^TMP($J,LIST,"OUT",0),"^")=1 D ^PSODDPR2 ;if order checks returned
"RTN","PSODDPRE",44,0)
EXIT ;
"RTN","PSODDPRE",45,0)
 I $G(PSODLQT)!$G(PSORX("DFLG")) S PSODOSD=1
"RTN","PSODDPRE",46,0)
 D ^PSOBUILD
"RTN","PSODDPRE",47,0)
 K CAN,DA,DIR,DNM,DUPRX0,ISSD,J,LSTFL,MSG,PHYS,PSOCLC,PSONULN,REA,RFLS,RX0,RX2,RXN,RXREC,ST,Y,ZZ,ACT,PSOCLOZ,PSOLR,PSOLDT,PSOCD,SIG
"RTN","PSODDPRE",48,0)
 K DO,PDRG,IT,PSODLQT
"RTN","PSODDPRE",49,0)
 K ^TMP($J,LIST,"IN","PING"),^TMP($J,LIST,"OUT","EXCEPTIONS")
"RTN","PSODDPRE",50,0)
 Q
"RTN","PSODDPRE",51,0)
DUP S:$P(PSOSD(STA,DNM),"^",2)<10!($P(PSOSD(STA,DNM),"^",2)=16) DUP=1 W !,PSONULN,!,$C(7),"Duplicate Drug in Local Rx:",!
"RTN","PSODDPRE",52,0)
 S RXREC=+PSOSD(STA,DNM),MSG="Discontinued During "_$S('$G(PSONV):"New Prescription Entry",1:"Verification")_" - Duplicate Drug"
"RTN","PSODDPRE",53,0)
DATA S DUPRX0=^PSRX(RXREC,0),RFLS=$P(DUPRX0,"^",9),ISSD=$P(^PSRX(RXREC,0),"^",13),RX0=DUPRX0,RX2=^PSRX(RXREC,2),$P(RX0,"^",15)=+$G(^PSRX(RXREC,"STA"))
"RTN","PSODDPRE",54,0)
 S RXRECLOC=$G(RXREC)
"RTN","PSODDPRE",55,0)
 S DA=RXREC
"RTN","PSODDPRE",56,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)
"RTN","PSODDPRE",57,0)
 W !,$J("Rx: ",24)_$P(^PSRX(+PSOSD(STA,DNM),0),"^")
"RTN","PSODDPRE",58,0)
 W !,$J("Drug: ",24)_$P(DNM,"^")
"RTN","PSODDPRE",59,0)
 K FSIG,BSIG I $P($G(^PSRX(RXREC,"SIG")),"^",2) D FSIG^PSOUTLA("R",RXREC,54) F PSREV=1:1 Q:'$D(FSIG(PSREV))  S BSIG(PSREV)=FSIG(PSREV)
"RTN","PSODDPRE",60,0)
 K FSIG,PSREV I '$P($G(^PSRX(RXREC,"SIG")),"^",2) D EN2^PSOUTLA1(RXREC,54)
"RTN","PSODDPRE",61,0)
 W !,$J("SIG: ",24) W $G(BSIG(1))
"RTN","PSODDPRE",62,0)
 I $O(BSIG(1)) F PSREV=1:0 S PSREV=$O(BSIG(PSREV)) Q:'PSREV  W !?24,$G(BSIG(PSREV))
"RTN","PSODDPRE",63,0)
 K BSIG,PSREV
"RTN","PSODDPRE",64,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)
"RTN","PSODDPRE",65,0)
 W !,$J("QTY: ",24)_$P(DUPRX0,"^",7),?42,$J("Refills remaining: ",24),RFLS-$S($D(^PSRX(RXREC,1,0)):$P(^(0),"^",4),1:0)
"RTN","PSODDPRE",66,0)
 S PHYS=$S($D(^VA(200,+$P(DUPRX0,"^",4),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSODDPRE",67,0)
 W !,$J("Provider: ",24)_PHYS,?42,$J("Issued: ",24),$E(ISSD,4,5)_"/"_$E(ISSD,6,7)_"/"_$E(ISSD,2,3)
"RTN","PSODDPRE",68,0)
 W !,$J("Status: ",24) S J=RXREC D STAT^PSOFUNC W ST K RX0,RX2
"RTN","PSODDPRE",69,0)
 S LSTFL=+^PSRX(RXREC,3) W ?42,$J("Last filled: ",24)_$E(LSTFL,4,5)_"/"_$E(LSTFL,6,7)_"/"_$E(LSTFL,2,3)
"RTN","PSODDPRE",70,0)
 D PRSTAT(RXREC)
"RTN","PSODDPRE",71,0)
 W !?42,$J("Days Supply: ",24)_$P(DUPRX0,"^",8)
"RTN","PSODDPRE",72,0)
 W !,PSONULN,! I $P($G(^PS(53,+$P($G(PSORX("PATIENT STATUS")),"^"),0)),"^")["AUTH ABS"!($G(PSORX("PATIENT STATUS"))["AUTH ABS")&'$P(PSOPAR,"^",5) W !,"PATIENT ON AUTHORIZED ABSENCE!" K RXRECLOC Q
"RTN","PSODDPRE",73,0)
ASKCAN I $P(PSOSD(STA,DNM),"^",2)>10,$P(PSOSD(STA,DNM),"^",2)'=16 D  Q
"RTN","PSODDPRE",74,0)
 .K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to continue" D ^DIR S:($D(DTOUT))!($D(DUOUT)) PSODLQT=1,PSORX("DFLG")=1 K DIR,DTOUT,DUOUT,DIRUT,RXRECLOC
"RTN","PSODDPRE",75,0)
 .S ^TMP("PSORXDD",$J,RXREC,0)=1
"RTN","PSODDPRE",76,0)
 I '$P(PSOPAR,"^",16),'$D(^XUSEC("PSORPH",DUZ)) D  Q
"RTN","PSODDPRE",77,0)
 .S PSORX("DFLG")=1 K RXRECLOC,DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to continue"
"RTN","PSODDPRE",78,0)
 .D ^DIR K DIR
"RTN","PSODDPRE",79,0)
 I $P(PSOSD(STA,DNM),"^",2)=16,$G(DUP) D  Q
"RTN","PSODDPRE",80,0)
 .W !!,"Prescription "_$P($G(^PSRX(+$G(RXRECLOC),0)),"^")_" is on Provider Hold, it cannot be discontinued.",!
"RTN","PSODDPRE",81,0)
 .K DUP,DIR,RXRECLOC S PSORX("DFLG")=1 S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSODDPRE",82,0)
 D PSOL^PSSLOCK(RXRECLOC) I '$G(PSOMSG) D  K PSOMSG,DIR,DUP,RXRECLOC S DIR("A")="Press Return to continue",DIR(0)="E",DIR("?")="Press Return to continue" D ^DIR K DIR S PSORX("DFLG")=1 Q
"RTN","PSODDPRE",83,0)
 .I $P($G(PSOMSG),"^",2)'="" W !!,$P(PSOMSG,"^",2),! Q
"RTN","PSODDPRE",84,0)
 .W !!,"Another person is editing Rx "_$P($G(^PSRX(RXRECLOC,0)),"^"),!
"RTN","PSODDPRE",85,0)
 K PSOMSG S DIR("A")=$S($P(PSOSD(STA,DNM),"^",2)=12:"Reinstate",1:"Discontinue")_" RX # "_$P(^PSRX(+PSOSD(STA,DNM),0),"^")_" "_$P(DNM,"^")_" Y/N",DIR(0)="Y"
"RTN","PSODDPRE",86,0)
 S DIR("?")="Enter Y to "_$S($P(PSOSD(STA,DNM),"^",2)=12:"reinstate",1:"discontinue")_" this RX."
"RTN","PSODDPRE",87,0)
 D ^DIR K DIR S DA=RXREC S ACT=$S($D(SPCANC):"Reinstated during Rx cancel.",1:$S($P(PSOSD(STA,DNM),"^",2)=12:"Reinstated",1:"Discontinued")_" while "_$S('$G(PSONV):"entering",1:"verifying")_" new RX")
"RTN","PSODDPRE",88,0)
 D CMOP^PSOUTL I $G(CMOP("S"))="L" W !,"A CMOP Rx cannot be discontinued during transmission!",! S Y=0 K CMOP
"RTN","PSODDPRE",89,0)
 I 'Y W !,$C(7)," -Prescription was not "_$S($P(PSOSD(STA,DNM),"^",2)=12:"reinstated",1:"discontinued")_"..." D  Q
"RTN","PSODDPRE",90,0)
 .S:'$D(PSOCLC) PSOCLC=DUZ S MSG=ACT,REA=$S($P(PSOSD(STA,DNM),"^",2)=12:"R",1:"C") S:$G(DUP) PSORX("DFLG")=1 K DUP D ULRX K RXRECLOC
"RTN","PSODDPRE",91,0)
 .K ^TMP("PSORXDC",$J,RXREC,0)
"RTN","PSODDPRE",92,0)
 I $P(PSOSD(STA,DNM),"^",2)=16,$G(CLS) W !!,"Prescription "_$P($G(^PSRX(+$G(RXRECLOC),0)),"^")_" is on Provider Hold, it cannot be discontinued.",! D ULRX K CLS,DUP,RXRECLOC S PSORX("DFLG")=1 H 2 Q
"RTN","PSODDPRE",93,0)
 S PSOCLC=DUZ,MSG=$S($G(MSG)]"":MSG,1:ACT_" During New RX "_$S('$G(PSONV):"Entry",1:"Verification")_" - Duplicate Rx"),REA=$S($P(PSOSD(STA,DNM),"^",2)=12:"R",1:"C")
"RTN","PSODDPRE",94,0)
 W !! K ^UTILITY($J,"W") S DIWL=1,DIWR=75,DIWF=""
"RTN","PSODDPRE",95,0)
 S X="Rx #"_$P(^PSRX(+PSOSD(STA,DNM),0),"^")_" "_DNM_" will be discontinued after"_$S('$G(PSOTECCK):" the acceptance of the new order.",1:" reinstating the order.") D ^DIWP
"RTN","PSODDPRE",96,0)
 F ZX=0:0 S ZX=$O(^UTILITY($J,"W",1,ZX)) Q:'ZX  W !,^UTILITY($J,"W",1,ZX,0)
"RTN","PSODDPRE",97,0)
 K ^UTILITY($J,"W"),X,DIWL,DIWR,DIWF W !
"RTN","PSODDPRE",98,0)
 S ^TMP("PSORXDC",$J,RXREC,0)="52^"_DA_"^"_MSG_"^"_REA_"^"_ACT_"^"_STA_"^"_DNM,PSONOOR="D",^TMP("PSORXDD",$J)=DNM H 2
"RTN","PSODDPRE",99,0)
 K RXRECLOC,DUP,CLS,PSONOOR
"RTN","PSODDPRE",100,0)
 Q
"RTN","PSODDPRE",101,0)
FDB ;build drug check input
"RTN","PSODDPRE",102,0)
 N ID,ORTYP,PSOI,ORN S DFN=PSODFN,CT=0
"RTN","PSODDPRE",103,0)
 S ID=+$$GETVUID^XTID(50.68,,+$P(PSODRUG("NDF"),"A",2)_",")
"RTN","PSODDPRE",104,0)
 S P1=$P(PSODRUG("NDF"),"A"),P2=$P(PSODRUG("NDF"),"A",2),X=$$PROD0^PSNAPIS(P1,P2),SEQN=+$P(X,"^",7)
"RTN","PSODDPRE",105,0)
 I 'SEQN K ^TMP($J,LIST,"OUT","EXCEPTIONS"),^TMP($J,LIST,"IN")
"RTN","PSODDPRE",106,0)
 S ^TMP($J,LIST,"IN","PROSPECTIVE","Z;1;PROSPECTIVE;1")=SEQN_"^"_ID_"^"_PSODRUG("IEN")_"^"_$P(^PSDRUG(PSODRUG("IEN"),0),"^")
"RTN","PSODDPRE",107,0)
 S ^TMP($J,LIST,"IN","IEN")=PSODFN,^TMP($J,LIST,"IN","DRUGDRUG")="",^TMP($J,LIST,"IN","THERAPY")=""
"RTN","PSODDPRE",108,0)
 K ID,P1,P2 N ODRG,TU S (STA,DNM)="" I '$G(PSOCOPY),'$G(SEQN) K SEQN Q
"RTN","PSODDPRE",109,0)
 ;build profile drug order checks
"RTN","PSODDPRE",110,0)
 F  S STA=$O(PSOSD(STA)) Q:STA=""  F  S DNM=$O(PSOSD(STA,DNM)) Q:DNM=""   D  ;I $P(PSOSD(STA,DNM),"^")'=$G(PSORENW("OIRXN")) S CT=CT+1 D
"RTN","PSODDPRE",111,0)
 .Q:$P(PSOSD(STA,DNM),"^")=$G(PSORENW("OIRXN"))&('$G(PSOCOPY))
"RTN","PSODDPRE",112,0)
 .S CT=CT+1
"RTN","PSODDPRE",113,0)
 .I STA="PENDING" N DDRG D
"RTN","PSODDPRE",114,0)
 ..Q:$G(^TMP("PSORXDC",$J,$P(PSOSD(STA,DNM),"^",10),0))]""
"RTN","PSODDPRE",115,0)
 ..Q:$G(PSODRUG("IEN"))=$P(^PS(52.41,$P(PSOSD(STA,DNM),"^",10),0),"^",9)
"RTN","PSODDPRE",116,0)
 ..Q:$P(^PS(52.41,$P(PSOSD(STA,DNM),"^",10),0),"^",3)="RF"
"RTN","PSODDPRE",117,0)
 ..Q:$G(^TMP("PSORXPO",$J,$P(PSOSD(STA,DNM),"^",10),0))
"RTN","PSODDPRE",118,0)
 ..S RXREC=$P(PSOSD(STA,DNM),"^",10),ORN=$P(^PS(52.41,RXREC,0),"^"),ODRG=$P(^(0),"^",9),ORTYP="P"
"RTN","PSODDPRE",119,0)
 ..I ODRG D  K ODRG Q
"RTN","PSODDPRE",120,0)
 ...I $P($G(^PSDRUG(ODRG,0)),"^",3)["S"!($E($P($G(^PSDRUG(ODRG,0)),"^",2),1,2)="XA") Q 
"RTN","PSODDPRE",121,0)
 ...S PDNM=$P(^PSDRUG(ODRG,0),"^") D ID
"RTN","PSODDPRE",122,0)
 ..E  N PSOI,DDRG,ODRG,SEQN,DDRG S PSOI=$P(^PS(52.41,RXREC,0),"^",8) D
"RTN","PSODDPRE",123,0)
 ...S PDNM=$P(^PS(50.7,PSOI,0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSODDPRE",124,0)
 ...S DDRG=$$DRG^PSSDSAPM(PSOI,"O") I '$P(DDRG,";") D OIX Q
"RTN","PSODDPRE",125,0)
 ...I $P($G(^PSDRUG($P(DDRG,";"),0)),"^",3)["S"!($E($P($G(^PSDRUG($P(DDRG,";"),0)),"^",2),1,2)="XA") Q
"RTN","PSODDPRE",126,0)
 ...S ODRG=$P(DDRG,";"),SEQN=+$P(DDRG,";",3) K PSOI
"RTN","PSODDPRE",127,0)
 ...N ID S ID=+$$GETVUID^XTID(50.68,,+$P($G(^PSDRUG(ODRG,"ND")),"^",3)_",")
"RTN","PSODDPRE",128,0)
 ...D ID1
"RTN","PSODDPRE",129,0)
 .I STA="ZNONVA" D  Q
"RTN","PSODDPRE",130,0)
 ..Q:$G(^TMP($J,"PSONVADD",$P(PSOSD(STA,DNM),"^",10),0))]""
"RTN","PSODDPRE",131,0)
 ..S RXREC=$P(PSOSD(STA,DNM),"^",10),ODRG=$P(^PS(55,PSODFN,"NVA",RXREC,0),"^",2),ORN=$P(^(0),"^",8),ORTYP="N"
"RTN","PSODDPRE",132,0)
 ..I ODRG D  K ODRG Q
"RTN","PSODDPRE",133,0)
 ...I $P($G(^PSDRUG(ODRG,0)),"^",3)["S"!($E($P($G(^PSDRUG(ODRG,0)),"^",2),1,2)="XA") Q
"RTN","PSODDPRE",134,0)
 ...S PDNM=$P(^PSDRUG(ODRG,0),"^") D ID
"RTN","PSODDPRE",135,0)
 ..E  N PSOI,DDRG,ODRG,SEQN,DDRG S PSOI=$P(^PS(55,PSODFN,"NVA",RXREC,0),"^") D
"RTN","PSODDPRE",136,0)
 ...S PDNM=$P(^PS(50.7,PSOI,0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSODDPRE",137,0)
 ...S DDRG=$$DRG^PSSDSAPM(PSOI,"O") I '$P(DDRG,";") D OIX Q
"RTN","PSODDPRE",138,0)
 ...I $P($G(^PSDRUG($P(DDRG,";"),0)),"^",3)["S"!($E($P($G(^PSDRUG($P(DDRG,";"),0)),"^",2),1,2)="XA") Q
"RTN","PSODDPRE",139,0)
 ...S ODRG=$P(DDRG,";"),SEQN=+$P(DDRG,";",3) K PSOI
"RTN","PSODDPRE",140,0)
 ...N ID S ID=+$$GETVUID^XTID(50.68,,+$P($G(^PSDRUG(ODRG,"ND")),"^",3)_",")
"RTN","PSODDPRE",141,0)
 ...D ID1
"RTN","PSODDPRE",142,0)
 .I $P($G(^PSRX(+PSOSD(STA,DNM),0)),"^",6) D
"RTN","PSODDPRE",143,0)
 ..Q:$G(^TMP("PSORXDC",$J,$P(PSOSD(STA,DNM),"^"),0))]""
"RTN","PSODDPRE",144,0)
 ..Q:$G(^TMP("PSORXBO",$J,$P(PSOSD(STA,DNM),"^"),0))
"RTN","PSODDPRE",145,0)
 ..Q:$G(^TMP("PSORXDD",$J,$P(PSOSD(STA,DNM),"^"),0))
"RTN","PSODDPRE",146,0)
 ..;I $P(PSOSD(STA,DNM),"^",2)>5,$P(PSOSD(STA,DNM),"^",2)'=16 Q
"RTN","PSODDPRE",147,0)
 ..S RXREC=+PSOSD(STA,DNM),ODRG=$P(^PSRX(RXREC,0),"^",6),ORN=$P($G(^("OR1")),"^",2),ORTYP="O"
"RTN","PSODDPRE",148,0)
 ..I ODRG D
"RTN","PSODDPRE",149,0)
 ...I $P($G(^PSDRUG(ODRG,0)),"^",3)["S"!($E($P($G(^PSDRUG(ODRG,0)),"^",2),1,2)="XA") Q
"RTN","PSODDPRE",150,0)
 ...S PDNM=$P(^PSDRUG(ODRG,0),"^") D ID
"RTN","PSODDPRE",151,0)
 K RXREC,ID,STA,DNM,PSOI,ORN,ODRG,ORTYP,CT,PDNM,TU,DDRG
"RTN","PSODDPRE",152,0)
 Q
"RTN","PSODDPRE",153,0)
ID N ID,P1,P2 S ID=+$$GETVUID^XTID(50.68,,+$P($G(^PSDRUG(ODRG,"ND")),"^",3)_",")
"RTN","PSODDPRE",154,0)
 S P1=$P($G(^PSDRUG(ODRG,"ND")),"^"),P2=$P($G(^("ND")),"^",3),X=$$PROD0^PSNAPIS(P1,P2),SEQN=$P(X,"^",7)
"RTN","PSODDPRE",155,0)
ID1 S ^TMP($J,LIST,"IN","PROFILE",ORTYP_";"_RXREC_";PROFILE;"_CT)=SEQN_"^"_ID_"^"_ODRG_"^"_PDNM_"^"_ORN_"^O" K ID
"RTN","PSODDPRE",156,0)
 Q
"RTN","PSODDPRE",157,0)
OIX S ^TMP($J,LIST,"IN","EXCEPTIONS","OI",PDNM)=1_"^"_ORTYP_";"_RXREC_";PROFILE;"_CT
"RTN","PSODDPRE",158,0)
 Q
"RTN","PSODDPRE",159,0)
ULRX ;
"RTN","PSODDPRE",160,0)
 I '$G(RXRECLOC) Q
"RTN","PSODDPRE",161,0)
 D PSOUL^PSSLOCK(RXRECLOC)
"RTN","PSODDPRE",162,0)
 Q
"RTN","PSODDPRE",163,0)
 ;
"RTN","PSODDPRE",164,0)
PRSTAT(DA) ;Displays the prescription's status
"RTN","PSODDPRE",165,0)
 N PSOTRANS,PSOREL,PSOCMOP,RXPSTA,PSOX,RFLZRO,PSOLRD,PSORTS,CMOP
"RTN","PSODDPRE",166,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)  S RXPSTA="Processing Status: ",PSOLRD=$P($G(^PSRX(RXREC,2)),"^",13)
"RTN","PSODDPRE",167,0)
 D ^PSOCMOPA I $G(PSOCMOP)]"" D  K CMOP,PSOTRANS,PSOREL
"RTN","PSODDPRE",168,0)
 .S PSOTRANS=$E($P(PSOCMOP,"^",2),4,5)_"/"_$E($P(PSOCMOP,"^",2),6,7)_"/"_$E($P(PSOCMOP,"^",2),2,3)
"RTN","PSODDPRE",169,0)
 .S PSOREL=$S(CMOP("L")=0:$P($G(^PSRX(DA,2)),"^",13),1:$P(^PSRX(DA,1,CMOP("L"),0),"^",18))
"RTN","PSODDPRE",170,0)
 .S PSOREL=$E(PSOREL,4,5)_"/"_$E(PSOREL,6,7)_"/"_$E(PSOREL,2,3)_"@"_$E($P(PSOREL,".",2),1,4)
"RTN","PSODDPRE",171,0)
 .I '$D(IOINORM)!('$D(IOINHI)) S X="IORVOFF;IORVON;IOINHI;IOINORM" D ENDR^%ZISS
"RTN","PSODDPRE",172,0)
 .I $P($G(^PSRX(RXREC,"STA")),"^")=0 W:$$TRANCMOP^PSOUTL(RXREC) ?5,IORVON_IOINHI
"RTN","PSODDPRE",173,0)
 .S:$G(PSODUPF) PSODUPC(ZCT)=PSODUPC(ZCT)+1 W:'$G(PSODUPF) !,$J(RXPSTA,24)_$S($P(PSOCMOP,"^")=0!($P(PSOCMOP,"^")=2):"Transmitted to CMOP on "_PSOTRANS,$P(PSOCMOP,"^")=1:"Released by CMOP on "_PSOREL,1:"Not Dispensed"),IOINORM_IORVOFF
"RTN","PSODDPRE",174,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)
"RTN","PSODDPRE",175,0)
 I $G(PSOCMOP)']"" D
"RTN","PSODDPRE",176,0)
 .F PSOX=0:0 S PSOX=$O(^PSRX(RXREC,1,PSOX)) Q:'PSOX  D
"RTN","PSODDPRE",177,0)
 ..S RFLZRO=$G(^PSRX(RXREC,1,PSOX,0))
"RTN","PSODDPRE",178,0)
 ..S:$P(RFLZRO,"^",18)'="" PSOLRD=$P(RFLZRO,"^",18) I $P(RFLZRO,"^",16) S PSOLRD=PSOLRD_"^R",PSORTS=$P(RFLZRO,"^",16)
"RTN","PSODDPRE",179,0)
 .I '$O(^PSRX(RXREC,1,0)),$P(^PSRX(RXREC,2),"^",15) S PSOLRD=PSOLRD_"^R",PSORTS=$P(^PSRX(RXREC,2),"^",15)
"RTN","PSODDPRE",180,0)
 .S:$G(PSODUPF) PSODUPC(ZCT)=PSODUPC(ZCT)+1 W:'$G(PSODUPF) !,$J(RXPSTA,24)
"RTN","PSODDPRE",181,0)
 .I +$G(PSORTS) S:$G(PSODUPF) PSODUPC(ZCT)=PSODUPC(ZCT)+1 W:'$G(PSODUPF) "Returned to stock on "_$$FMTE^XLFDT(PSORTS,2) Q
"RTN","PSODDPRE",182,0)
 .S:$G(PSODUPF) PSODUPC(ZCT)=PSODUPC(ZCT)+1 W:'$G(PSODUPF) $S(PSOLRD="":"Not released locally",1:"Released locally on "_$$FMTE^XLFDT($P(PSOLRD,"^"),2)_" "_$P(PSOLRD,"^",2))_$S($P(^PSRX(RXREC,0),"^",11)="W":" (Window)",1:" (Mail)")
"RTN","PSODDPRE",183,0)
 Q
"RTN","PSODELI")
0^21^B7741003
"RTN","PSODELI",1,0)
PSODELI ;IHS/DSD/JCM - DELETE ENTRIES IN APSP INTERVENTION FILE ;03/28/93 21:15
"RTN","PSODELI",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**10,268,251**;DEC 1997;Build 202
"RTN","PSODELI",3,0)
 ;
"RTN","PSODELI",4,0)
 ; This routine is called by the option that delete entries in
"RTN","PSODELI",5,0)
 ; the APSP INTERVENTION file.
"RTN","PSODELI",6,0)
 ; These options are locked with the PSZMGR key.
"RTN","PSODELI",7,0)
 ; 
"RTN","PSODELI",8,0)
 ; External Calls : ^DIE,^DIC,^DIR
"RTN","PSODELI",9,0)
 ;-----------------------------------------------------------------
"RTN","PSODELI",10,0)
START ;
"RTN","PSODELI",11,0)
 K DIC,DR,DIE,DA
"RTN","PSODELI",12,0)
 D INTERV ; Sets up DIC and DIE calls for files
"RTN","PSODELI",13,0)
END D EOJ ; Cleans up variables
"RTN","PSODELI",14,0)
 Q
"RTN","PSODELI",15,0)
 ;------------------------------------------------------------------
"RTN","PSODELI",16,0)
INTERV ; Deletes entries from APSP INTERVENTION file
"RTN","PSODELI",17,0)
 W !,"You may only delete entries entered on the current day.",!
"RTN","PSODELI",18,0)
 S PSODELI("QFLG")=0,APSP("LOG DEL FLG")="INTERV"
"RTN","PSODELI",19,0)
 F PSODELI=0:0 S DIC(0)="QEAM",(PSODELI("DIC"),DIC)="^APSPQA(32.4,",DIC("S")="I DT=$P(^(0),U,1)" Q:PSODELI("QFLG")  D DEL
"RTN","PSODELI",20,0)
 Q
"RTN","PSODELI",21,0)
DEL ; Does actual lookup and deletion of entries
"RTN","PSODELI",22,0)
 K PSODELI("DA") D ^DIC K DIC,DA,DR
"RTN","PSODELI",23,0)
 I Y=-1 S PSODELI("QFLG")=1 G DELX
"RTN","PSODELI",24,0)
 S PSODELI("DA")=+Y,DIR(0)="Y",Y=0,DIR("A")="SURE YOU WANT TO DELETE THE ENTIRE ENTRY"
"RTN","PSODELI",25,0)
 D ^DIR K DIR G:$D(DIRUT)!('Y) DELX
"RTN","PSODELI",26,0)
 S DIE=PSODELI("DIC"),DA=PSODELI("DA"),DR=".01///@",DIDEL=9009032.4
"RTN","PSODELI",27,0)
 L +^APSPQA(32.4,PSODELI("DA")):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3)
"RTN","PSODELI",28,0)
 D ^DIE K DIE,DA,DR
"RTN","PSODELI",29,0)
 L -^APSPQA(32.4,PSODELI("DA"))
"RTN","PSODELI",30,0)
DELX ; Exit point from DEL
"RTN","PSODELI",31,0)
 K DIC,DIR,DA,X,Y,PSODELI("DIC"),DIRUT S VALMBCK="R"
"RTN","PSODELI",32,0)
 Q
"RTN","PSODELI",33,0)
EOJ ; Clean up variables
"RTN","PSODELI",34,0)
 K PSODELI,APSP("LOG DEL FLG"),X,Y,DIRUT,DTOUT,DUOUT,DIC,DIK,DA,DR,DIDEL,DIE
"RTN","PSODELI",35,0)
 Q
"RTN","PSODELI",36,0)
EDIT ;Edit Pharmacy Intervention
"RTN","PSODELI",37,0)
 N DIC,DLAYGO,DA,Y,DIE,DR
"RTN","PSODELI",38,0)
 W @IOF W !!,"Edit Existing Intervention",!!
"RTN","PSODELI",39,0)
 F  S DIC(0)="QEAM",DIC="^APSPQA(32.4,",DIC("A")="Select INTERVENTION:" D ^DIC K:Y=-1 X,DIC,DA,DIE Q:Y=-1  D
"RTN","PSODELI",40,0)
 .S DA=+Y,DIE=DIC,DR="[PSO INTERVENTION EDIT]" D ^DIE
"RTN","PSODELI",41,0)
 D EOJ S VALMBCK="R"
"RTN","PSODELI",42,0)
 Q
"RTN","PSODELI",43,0)
NEW ;Enter Pharmacy Intervention
"RTN","PSODELI",44,0)
 N DIC,DLAYGO,Y,DIE,DR,DIADD
"RTN","PSODELI",45,0)
 W @IOF W !!,"Enter Pharmacy Intervention",!!
"RTN","PSODELI",46,0)
 F  S DIC(0)="QEMAL",DIC="^APSPQA(32.4,",DLAYGO=9009032.4,DIADD="" D ^DIC K DA,DR,DIADD K:Y=-1 X,DIC,DIADD,DA,DIE Q:Y=-1  D
"RTN","PSODELI",47,0)
 .S DA=+Y,DIE=DIC,DR="[PSO INTERVENTION NEW]" K DIC D ^DIE
"RTN","PSODELI",48,0)
 D EOJ S VALMBCK="R"
"RTN","PSODELI",49,0)
 Q
"RTN","PSODELI",50,0)
OUT ; Print Pharmacy Intervention
"RTN","PSODELI",51,0)
 N L,DIC,FLDS,BY,Y
"RTN","PSODELI",52,0)
 W @IOF W !!,"Print Pharmacy Intervention",!!
"RTN","PSODELI",53,0)
 S L=0,DIC="^APSPQA(32.4,",FLDS="[PSO INTERVENTIONS]",BY="[PSO INTERVENTIONS]"
"RTN","PSODELI",54,0)
 D EN1^DIP  W !!,"Pharmacy Intervention Menu",!!
"RTN","PSODELI",55,0)
 D EOJ S VALMBCK="R"
"RTN","PSODELI",56,0)
 Q
"RTN","PSODELI",57,0)
VIEW ;View Pharmacy Interventions
"RTN","PSODELI",58,0)
 W @IOF,!!,"View Interventions",!! S PSOVWI("DIC")="^APSPQA(32.4," D ^PSOVWI
"RTN","PSODELI",59,0)
 D EOJ S VALMBCK="R"
"RTN","PSODELI",60,0)
 Q
"RTN","PSODGAL1")
0^22^B18486423
"RTN","PSODGAL1",1,0)
PSODGAL1 ;BIR/LC,SAB-enhanced DRUG ALLERGY REACTION CHECKING ;12/09/07  02:22
"RTN","PSODGAL1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**251**;DEC 1997;Build 202
"RTN","PSODGAL1",3,0)
 ;External reference to ^GMRADPT supported by DBIA 10099
"RTN","PSODGAL1",4,0)
 ;External reference to ORCHK^GMRAOR supported by DBIA 2378
"RTN","PSODGAL1",5,0)
 ;External reference to $P(^GMR(120.8,LP,3),"^",3) supp. by DBIA 2214
"RTN","PSODGAL1",6,0)
 ;External reference to ^PS(50.605 supported by DBIA 696
"RTN","PSODGAL1",7,0)
 ;External reference to EN1^GMRAOR2 supported by DBIA 2422
"RTN","PSODGAL1",8,0)
 ;External reference to GETDATA^GMRAOR supported by DBIA 4847
"RTN","PSODGAL1",9,0)
 ;External reference to ^TMP("GMRAOC" supported by DBIA 4848
"RTN","PSODGAL1",10,0)
 ;External reference to ^XUSEC("PSORPH" supported by DBIA 10076
"RTN","PSODGAL1",11,0)
 ;
"RTN","PSODGAL1",12,0)
 N PSOACK,DFN K ^TMP($J,"PSODRCLS"),DSPLQ S DFN=PSODFN
"RTN","PSODGAL1",13,0)
 I $D(PSODRUG("NDF")) S NDF=$P(PSODRUG("NDF"),"A"),TYP=$P(PSODRUG("NDF"),"A",2),PTR=NDF_"."_TYP
"RTN","PSODGAL1",14,0)
 I $G(NDF) D CHK K NDF,PTR,TYP
"RTN","PSODGAL1",15,0)
 I '$G(NDF) D CHK1
"RTN","PSODGAL1",16,0)
 I $D(PSODRUG("VA CLASS")) D CLASS
"RTN","PSODGAL1",17,0)
 ;I $G(PSOACK)=1!$G(^TMP($J,"PSODRCLS",0))]"" D
"RTN","PSODGAL1",18,0)
 I $G(PSOACK)=1!$O(^TMP($J,"PSODRCLS",0)) D
"RTN","PSODGAL1",19,0)
 .I '$D(^XUSEC("PSORPH",DUZ)) K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to continue" D ^DIR K DIR,DUOUT,DIRUT Q
"RTN","PSODGAL1",20,0)
 .S DIR("?",1)="Answer 'YES' if you DO want to enter a intervention for this medication,"
"RTN","PSODGAL1",21,0)
 .S DIR("?")="       'NO' if you DON'T want to enter a intervention for this medication,"
"RTN","PSODGAL1",22,0)
 .S DIR(0)="Y",DIR("A")="Do you want to Intervene? ",DIR("B")="Y" W ! D ^DIR
"RTN","PSODGAL1",23,0)
 .Q:'Y  D ^PSORXI
"RTN","PSODGAL1",24,0)
 K DIR,DTOUT,DIRUT,DIROUT,DUOUT,Y,DSPLQ
"RTN","PSODGAL1",25,0)
 K PSOACK,GMRAING,I,APTR,GMRA,GMRAL,LP
"RTN","PSODGAL1",26,0)
 K ^TMP($J,"PSODRCLS")
"RTN","PSODGAL1",27,0)
 Q
"RTN","PSODGAL1",28,0)
 ;
"RTN","PSODGAL1",29,0)
CHK ;matched to ndf
"RTN","PSODGAL1",30,0)
 K ^TMP("PSODAI",$J) S PSOACK=$$ORCHK^GMRAOR(DFN,"DR",PTR) D:$G(PSOACK)=1 
"RTN","PSODGAL1",31,0)
 .S ^TMP("PSODAI",$J,0)=1
"RTN","PSODGAL1",32,0)
 .S I=0 F  S I=$O(GMRAING(I)) Q:'I  S ^TMP("PSODAI",$J,I,0)=GMRAING(I)
"RTN","PSODGAL1",33,0)
 D:$G(PSOACK) DSPLY
"RTN","PSODGAL1",34,0)
 Q
"RTN","PSODGAL1",35,0)
CHK1 ;not matched to ndf
"RTN","PSODGAL1",36,0)
 K ^TMP("PSODAI",$J)
"RTN","PSODGAL1",37,0)
 S GMRA="0^0^001" D EN1^GMRADPT F LP=0:0 S LP=$O(GMRAL(LP)) Q:'LP!($G(PSOACK))  D:$D(^GMR(120.8,LP,0))
"RTN","PSODGAL1",38,0)
 .S:'$G(PSOACK) APTR=$P(^GMR(120.8,LP,0),"^",3)
"RTN","PSODGAL1",39,0)
 .I $P(APTR,";",2)="PSDRUG(",$P(APTR,";")=PSODRUG("IEN") S PSOACK=1
"RTN","PSODGAL1",40,0)
 .Q:$D(^XUSEC("PSORPH",DUZ))  S:$G(PSOACK)=1 ^TMP("PSODAI",$J,0)=1
"RTN","PSODGAL1",41,0)
 D:$G(PSOACK) DSPLY
"RTN","PSODGAL1",42,0)
 Q
"RTN","PSODGAL1",43,0)
DSPLY ;
"RTN","PSODGAL1",44,0)
 I '$G(DSPLQ) D
"RTN","PSODGAL1",45,0)
 .W $C(7),!,"A Drug-Allergy Reaction exists for this medication and/or class!",!
"RTN","PSODGAL1",46,0)
 .W !,"Drug: "_PSODRUG("NAME")
"RTN","PSODGAL1",47,0)
 .I $O(GMRAING(0)) D
"RTN","PSODGAL1",48,0)
 ..W !,?6,"Ingredients: ",?19 S I=0
"RTN","PSODGAL1",49,0)
 ..F  S I=$O(GMRAING(I)) Q:'I  W:$X+$L($G(GMRAING(I)))+2>IOM !?19 W $G(GMRAING(I))_", "
"RTN","PSODGAL1",50,0)
 S DSPLQ=1
"RTN","PSODGAL1",51,0)
 Q
"RTN","PSODGAL1",52,0)
 ;
"RTN","PSODGAL1",53,0)
CLASS ;
"RTN","PSODGAL1",54,0)
 N CPT,CLCHK,CT,AGNL,CC,GMRA,LEN S LEN=4
"RTN","PSODGAL1",55,0)
 I $E(PSODRUG("VA CLASS"),1,4)="CN10" S LEN=5 ;look at 5 chars if ANALGESICS
"RTN","PSODGAL1",56,0)
 K ^TMP($J,"PSODRCLS")
"RTN","PSODGAL1",57,0)
 I $T(GETDATA^GMRAOR)]"" G CLASS2 ; CHECK FOR EXISTENCE OF NEW ENTRY POINT BEFORE USING
"RTN","PSODGAL1",58,0)
 S CLCHK=""
"RTN","PSODGAL1",59,0)
 S GMRA="0^0^111" D EN1^GMRADPT F CC=0:0 S CC=$O(GMRAL(CC)) Q:'CC  D
"RTN","PSODGAL1",60,0)
 .K AGNL D EN1^GMRAOR2(CC,"AGNL")
"RTN","PSODGAL1",61,0)
 .I $D(AGNL("V")) F CT=0:1 S CPT=$O(AGNL("V",CT)) Q:'CPT  I $E($P($G(AGNL("V",CPT)),"^"),1,LEN)=$E(PSODRUG("VA CLASS"),1,LEN) D
"RTN","PSODGAL1",62,0)
 ..S CLCHK=$G(CLCHK)+1,^TMP($J,"PSODRCLS",CLCHK)=$P($G(AGNL("V",CPT)),"^")_" "_$P($G(AGNL("V",CPT)),"^",2)
"RTN","PSODGAL1",63,0)
 G CLASSDSP
"RTN","PSODGAL1",64,0)
CLASS2 ;
"RTN","PSODGAL1",65,0)
 N RET
"RTN","PSODGAL1",66,0)
 S RET=$$DRCL(DFN)
"RTN","PSODGAL1",67,0)
 I '$G(RET) Q
"RTN","PSODGAL1",68,0)
 S CLCHK="",CT="" F  S CT=$O(GMRADRCL(CT)) Q:CT=""  D
"RTN","PSODGAL1",69,0)
 .I $E(PSODRUG("VA CLASS"),1,LEN)=$E(CT,1,LEN) S CLCHK=$G(CLCHK)+1,^TMP($J,"PSODRCLS",CLCHK)=CT_" "_$P(GMRADRCL(CT),"^",2)
"RTN","PSODGAL1",70,0)
CLASSDSP ;
"RTN","PSODGAL1",71,0)
 I '$D(^TMP($J,"PSODRCLS")) Q
"RTN","PSODGAL1",72,0)
 W:'$G(PSOACK) $C(7),!,"A Drug-Allergy Reaction exists for this medication and/or class!",!,!,"Drug: "_PSODRUG("NAME")
"RTN","PSODGAL1",73,0)
 I $O(^TMP($J,"PSODRCLS",0)) W !?6,"Drug Class: "
"RTN","PSODGAL1",74,0)
 K ^UTILITY($J,"W") S DIWL=1,DIWR=58,DIWF=""
"RTN","PSODGAL1",75,0)
 S CT="" F  S CT=$O(^TMP($J,"PSODRCLS",CT)) Q:CT=""  S X=^TMP($J,"PSODRCLS",CT)_", " D ^DIWP
"RTN","PSODGAL1",76,0)
 F ZX=0:0 S ZX=$O(^UTILITY($J,"W",1,ZX)) Q:'ZX  W ?18,^UTILITY($J,"W",1,ZX,0),!
"RTN","PSODGAL1",77,0)
 K ^UTILITY($J,"W"),DIWL,DIWR,DIWF,CT,ZX
"RTN","PSODGAL1",78,0)
 Q
"RTN","PSODGAL1",79,0)
 ;
"RTN","PSODGAL1",80,0)
DRCL(DFN) ;
"RTN","PSODGAL1",81,0)
 N RET S RET=0 K GMRADRCL D GETDATA^GMRAOR(DFN)
"RTN","PSODGAL1",82,0)
 Q:'$D(^TMP("GMRAOC",$J,"APC")) 0
"RTN","PSODGAL1",83,0)
 N GMRACL S GMRACL="" F  S GMRACL=$O(^TMP("GMRAOC",$J,"APC",GMRACL)) Q:'$L(GMRACL)  D
"RTN","PSODGAL1",84,0)
 .N GMRANM,GMRALOC S GMRALOC=^TMP("GMRAOC",$J,"APC",GMRACL),GMRANM=$P(^PS(50.605,+$O(^PS(50.605,"B",GMRACL,0)),0),U,2)
"RTN","PSODGAL1",85,0)
 .S GMRADRCL(GMRACL)=GMRACL_U_GMRANM_" ("_GMRALOC_")",RET=RET+1
"RTN","PSODGAL1",86,0)
 K ^TMP("GMRAOC",$J)
"RTN","PSODGAL1",87,0)
 Q RET
"RTN","PSODGDG1")
0^53^B41300360
"RTN","PSODGDG1",1,0)
PSODGDG1 ;BHAM ISC/SAB - DRUG INTERACTION PROCESSOR ;02/25/94 9:14
"RTN","PSODGDG1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**251**;DEC 1997;Build 202
"RTN","PSODGDG1",3,0)
 G PROC^PSODGDG2
"RTN","PSODGDG1",4,0)
PROCESS ;verification
"RTN","PSODGDG1",5,0)
 Q:$P(^PSRX(PSONV,"STA"),"^")=13
"RTN","PSODGDG1",6,0)
 W @IOF W !,$P(^DPT(DFN,0),"^"),?40,"ID#:"_VA("PID")_"  RX #"_$P(INT,"^")
"RTN","PSODGDG1",7,0)
 D CUTDATE^PSOFUNC:'$G(PSODTCUT),^PSOBUILD:'+$G(PSOZVER),^PSODSPL
"RTN","PSODGDG1",8,0)
 S DIR("?",1)="Answer 'YES' if you DO want to "_$S($P(SER,"^",4)=1:"continue processing",1:"enter an intervention for")_" this medication,"
"RTN","PSODGDG1",9,0)
 S DIR("?",2)="       'NO' if you DON'T want to "_$S($P(SER,"^",4)=1:"continue processing",1:"enter an intervention for")_" this medication,",DIR("?")="    or 'P' to review medication profile."
"RTN","PSODGDG1",10,0)
 W $C(7),$C(7) S DIR("A",1)="",DIR("A",2)="***"_$S($P(SER,"^",4)=1:"CRITICAL",1:"SIGNIFICANT")_"*** "_"Drug Interaction with RX #"_$P(^PSRX($P($P(MED,",",INA),"^"),0),"^"),DIR("A",3)="               Drug: "_$P($G(^PSDRUG($P(^(0),"^",6),0)),"^")
"RTN","PSODGDG1",11,0)
 S DIR(0)="SA^1:YES;0:NO;P:PROFILE",DIR("A")="Do you want to "_$S($P(SER,"^",4)=1:"Continue? ",1:"Intervene? "),DIR("B")="Y" D ^DIR I Y="P" W ! K Y G PROCESS
"RTN","PSODGDG1",12,0)
 I 'Y,$P(SER,"^",4)=1 S PSVERFLG=1
"RTN","PSODGDG1",13,0)
 I Y,$P(SER,"^",4)=1 S PSORX("INTERVENE")=1 K DIR,DTOUT,DIRUT,DIROUT,DUOUT D CRI Q 
"RTN","PSODGDG1",14,0)
 I Y,$P(SER,"^",4)=2 S PSORX("INTERVENE")=2,DA=IFN D INV
"RTN","PSODGDG1",15,0)
 K DIR,DTOUT,DIRUT,DIROUT,DUOUT Q
"RTN","PSODGDG1",16,0)
 Q
"RTN","PSODGDG1",17,0)
CRI ;new interactions
"RTN","PSODGDG1",18,0)
 K DIR I $P(RX,"^",15)=4 D CRITN Q
"RTN","PSODGDG1",19,0)
 S DIR("A",1)="",DIR("A",2)="Do you want to Process or Cancel medication?"
"RTN","PSODGDG1",20,0)
 S DIR("A")="Rx #"_$P($G(^PSRX(DA,0)),"^")_"   "_"Drug: "_$P($G(^PSDRUG($P(^PSRX(DA,0),"^",6),0)),"^")_": "
"RTN","PSODGDG1",21,0)
 S DIR(0)="SA^1:PROCESS;0:CANCEL MEDICATION",DIR("B")="PROCESS"
"RTN","PSODGDG1",22,0)
 K ANSDIR
"RTN","PSODGDG1",23,0)
 S DIR("?",1)="Enter '1' or 'P' to Activate medication",DIR("?")="      '^' to EXIT Process",DIR("?",2)="      '0' or 'C' to Cancel Medication" D ^DIR K DIR
"RTN","PSODGDG1",24,0)
 I $D(DIRUT) S (PSORX("DFLG"),PSVERFLG)=1 Q
"RTN","PSODGDG1",25,0)
 S ANSDIR=Y,PSONV=DA
"RTN","PSODGDG1",26,0)
 D SIG^XUSESIG I X1="" S (PSORX("DFLG"),PSVERFLG)=1 K ANSDIR Q
"RTN","PSODGDG1",27,0)
 I 'ANSDIR N PSOHDINV D  G Q1
"RTN","PSODGDG1",28,0)
 .D NOOR^PSOCAN4 I $D(DIRUT) D UPOUT Q
"RTN","PSODGDG1",29,0)
 .S DA=PSONV D RXV S DA=PSONV,PSORX("INTERVENE")=1 D INV S DA=PSONV
"RTN","PSODGDG1",30,0)
 .D PSDEL,HLDINVS,DEL K PSORX("INTERVENE")  S PSVERFLG=1
"RTN","PSODGDG1",31,0)
 I ANSDIR&'$G(PSODIR) S DA=PSONV D HLDINV,INV S DA=PSONV D
"RTN","PSODGDG1",32,0)
 .I '$G(PSVERFLG) D ^PSODGDG2 S $P(^PSRX(PSONV,"STA"),"^")=1 S ZONE=PSONV D ONE
"RTN","PSODGDG1",33,0)
Q1 K DIK,DTOUT,DIRUT,DIROUT,DUOUT,LST,ANSDIR,PSONOOR S PSVERFLG=1
"RTN","PSODGDG1",34,0)
 Q
"RTN","PSODGDG1",35,0)
HLDINV           ;
"RTN","PSODGDG1",36,0)
 I $G(PSORX("INTERVENE")) S PSOHDINV=$G(PSORX("INTERVENE"))
"RTN","PSODGDG1",37,0)
 Q
"RTN","PSODGDG1",38,0)
 ;
"RTN","PSODGDG1",39,0)
 ;
"RTN","PSODGDG1",40,0)
HLDINVS ;
"RTN","PSODGDG1",41,0)
 I $G(PSOHDINV) S PSORX("INTERVENE")=PSOHDINV
"RTN","PSODGDG1",42,0)
 Q
"RTN","PSODGDG1",43,0)
 ;
"RTN","PSODGDG1",44,0)
CRITN ;multiple interactions
"RTN","PSODGDG1",45,0)
 S PSOTHER=$P($P(MED,",",INA),"^") N PSONV
"RTN","PSODGDG1",46,0)
 K DIR S DIR("A",1)="",DIR("A",2)="Do you want to: ",DIR("A",3)=" 1.  Cancel Rx #"_$P(INT,"^")_"  DRUG: "_$P(^PSDRUG($P(INT,"^",6),0),"^")
"RTN","PSODGDG1",47,0)
 S DIR("A",4)=" 2.  Cancel Rx #"_$P(RX,"^")_"  DRUG: "_$P(^PSDRUG($P(RX,"^",6),0),"^"),DIR("A",5)=" 3.  Cancel Both 1 and 2",DIR("A")=" 5.  Leave Both Non-verified (do nothing) ?: ",DIR("A",6)=" 4.  Process Both 1 and 2"
"RTN","PSODGDG1",48,0)
 S DIR(0)="SA^1:1 to be Canceled;2:2 to be Canceled;3:Cancel BOTH 1 and 2;4:ACTIVATE 1 and 2;5:DO NOTHING TO 1 and 2"
"RTN","PSODGDG1",49,0)
 S DIR("?",1)="Enter '1' to Cancel Rx #"_$P(INT,"^")_"  DRUG: "_$P(^PSDRUG($P(INT,"^",6),0),"^"),DIR("?",2)="      '2' to Cancel Rx #"_$P(RX,"^")_"  DRUG: "_$P(^PSDRUG($P(RX,"^",6),0),"^")
"RTN","PSODGDG1",50,0)
 S DIR("?",3)="      '3' or 'B' to Cancel Both 1 and 2",DIR("?",4)="      '4' or 'A' to Activate both RXs",DIR("?")="      '5' or 'D' to do nothing/leave both RXs in a Pending Status" D ^DIR K DIR I Y["^"!(Y=5)!($D(DIRUT)) S PSVERFLG=1 G CRIZ
"RTN","PSODGDG1",51,0)
 S PSAN=Y D SIG^XUSESIG I X1="" K PSAN S (PSORX("DFLG"),PSVERFLG)=1 G CRIZ
"RTN","PSODGDG1",52,0)
 I PSAN=1 D  D KILL Q
"RTN","PSODGDG1",53,0)
 .D NOOR^PSOCAN4 I $D(DIRUT) D UPOUT,KILL K PSONORR,PSORX("INTERVENE") Q
"RTN","PSODGDG1",54,0)
 .S DA=IFN D RXV
"RTN","PSODGDG1",55,0)
 .S DA=IFN D PSDEL,DEL
"RTN","PSODGDG1",56,0)
 .S:$G(PSOSD) PSOSD=PSOSD-1 S DA=IFN D INV S DA=$P(MED,",",INA) S DA=PSOTHER
"RTN","PSODGDG1",57,0)
 .D INV S DA=PSOTHER S $P(^PSRX(PSOTHER,"STA"),"^")=1,ZONE=PSOTHER
"RTN","PSODGDG1",58,0)
 .D ONE K PSONOOR
"RTN","PSODGDG1",59,0)
 I PSAN=2 D  D KILL K PSONOOR Q
"RTN","PSODGDG1",60,0)
 .D NOOR^PSOCAN4 I $D(DIRUT) D UPOUT,KILL K PSONOOR,PSORX("INTERVENE") Q
"RTN","PSODGDG1",61,0)
 .S DA=$P(MED,",",INA) D PSDEL,DEL
"RTN","PSODGDG1",62,0)
 .K PSONOOR S:$G(PSOSD) PSOSD=PSOSD-1 S DA=$P(MED,",",INA)
"RTN","PSODGDG1",63,0)
 .D INV S DA=IFN D INV S DA=IFN
"RTN","PSODGDG1",64,0)
 .I 'PSVERFLG,'$P(MED,",",(INA+1)) D ^PSODGDG2 S DA=IFN,$P(^PSRX(DA,"STA"),"^")=1 S ZONE=DA D ONE
"RTN","PSODGDG1",65,0)
 I PSAN=3 D  D KILL K PSONOOR Q
"RTN","PSODGDG1",66,0)
 .D NOOR^PSOCAN4 I $D(DIRUT) D UPOUT,KILL K PSONOOR,PSORX("INTERVENE") Q
"RTN","PSODGDG1",67,0)
 .F DA=$P(MED,",",INA),IFN S PSHOLDDA=DA D PSDEL,DEL S DA=PSHOLDDA D INV K DTOUT,DIROUT,DIRUT,DUOUT,PSAN,PSHOLDDA
"RTN","PSODGDG1",68,0)
 I $G(PSAN)=4 S LST=1,PPL="" D
"RTN","PSODGDG1",69,0)
 .S DA=$P(MED,",",INA) D INV S $P(^PSRX(PSOTHER,"STA"),"^")=1 S ZONE=PSOTHER S PSOTHER(PSOTHER)=PSOTHER D ONE
"RTN","PSODGDG1",70,0)
 .S DA=IFN D INV I 'PSVERFLG,'$P(MED,",",(INA+1)) D ^PSODGDG2 S DA=IFN,$P(^PSRX(DA,"STA"),"^")=1 S ZONE=DA D ONE
"RTN","PSODGDG1",71,0)
 .S:$G(PSOSD) PSOSD=PSOSD-2
"RTN","PSODGDG1",72,0)
 D KILL
"RTN","PSODGDG1",73,0)
CRIZ ;
"RTN","PSODGDG1",74,0)
 Q
"RTN","PSODGDG1",75,0)
RXV S DIK="^PS(52.4," D ^DIK Q  ;251;verify there's no dosing checks before deleting
"RTN","PSODGDG1",76,0)
INV D EN1^PSORXI(.DA) K PSORX("INTERVENE") Q
"RTN","PSODGDG1",77,0)
PSDEL Q:$G(STAT)']""
"RTN","PSODGDG1",78,0)
 S STA="ACTIVE^NON-VERIFIED^R^HOLD^NON-VERIFIED^ACTIVE^^^^^^ACTIVE^DISCONTINUE^^DISCONTINUE^DISCONTINUE^HOLD",STAT=$P(STA,"^",$P(^PSRX(DA,"STA"),"^")+1)
"RTN","PSODGDG1",79,0)
 I $P($G(PSOSD(STAT,$P(^PSDRUG($P(^PSRX(DA,0),"^",6),0),"^"))),"^")=DA K PSOSD(STAT,$P(^PSDRUG($P(^PSRX(DA,0),"^",6),0),"^"))
"RTN","PSODGDG1",80,0)
 E  K PSOSD(STAT,$P(^PSDRUG($P(^PSRX(DA,0),"^",6),0),"^")_"^"_DA)
"RTN","PSODGDG1",81,0)
 Q
"RTN","PSODGDG1",82,0)
DEL W !!,"Canceling Rx: "_$P($G(^PSRX(DA,0)),"^")_"   "_"Drug: "_$P($G(^PSDRUG($P(^PSRX(DA,0),"^",6),0)),"^"),!
"RTN","PSODGDG1",83,0)
 D ENQ^PSORXDL S PSORX("DFLG")=1
"RTN","PSODGDG1",84,0)
 S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to Continue" D ^DIR K DIR
"RTN","PSODGDG1",85,0)
 I $G(PSOPOCK) S VALMBCK="Q"
"RTN","PSODGDG1",86,0)
 Q
"RTN","PSODGDG1",87,0)
ONE S STA="ACTIVE^NON-VERIFIED^R^HOLD^NON-VERIFIED^ACTIVE^^^^^^ACTIVE^DISCONTINUE^^DISCONTINUE^DISCONTINUE^HOLD",STAT=$P(STA,"^",$P(^PSRX(ZONE,"STA"),"^")+1)
"RTN","PSODGDG1",88,0)
 I $P($G(PSOSD(STAT,$P(^PSDRUG($P(^PSRX(ZONE,0),"^",6),0),"^"))),"^")=ZONE S $P(PSOSD(STAT,$P(^PSDRUG($P(^PSRX(ZONE,0),"^",6),0),"^")),"^",2)=1
"RTN","PSODGDG1",89,0)
 E  I $G(PSOSD(STAT,$P(^PSDRUG($P(^PSRX(ZONE,0),"^",6),0),"^")_"^"_ZONE)) S $P(PSOSD(STAT,$P(^PSDRUG($P(^PSRX(ZONE,0),"^",6),0),"^")_"^"_ZONE),"^",2)=1
"RTN","PSODGDG1",90,0)
 K ZONE,STA,STAT Q
"RTN","PSODGDG1",91,0)
KILL K DIR,DIK,DTOUT,DIROUT,DIRUT,DUOUT,LST,PPL,PSAN Q
"RTN","PSODGDG1",92,0)
 ;
"RTN","PSODGDG1",93,0)
UPOUT W " ACTION NOT TAKEN!",! K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to Continue" D ^DIR K DIR S PSVERFLG=1 Q
"RTN","PSODGDG2")
0^54^B14020404
"RTN","PSODGDG2",1,0)
PSODGDG2 ;BIR/RTR-drug drug interaction continued ;8/8/96
"RTN","PSODGDG2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**27,130,251**;DEC 1997;Build 202
"RTN","PSODGDG2",3,0)
 ;External reference to ^DPT supported by DBIA 10035
"RTN","PSODGDG2",4,0)
 ;External references to U, UL, PSOL, and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSODGDG2",5,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5424
"RTN","PSODGDG2",6,0)
EN ;Activate or process an Rx
"RTN","PSODGDG2",7,0)
 Q:'$G(DA)
"RTN","PSODGDG2",8,0)
 K ^PS(52.4,"ADI",DA,1),^PSRX(DA,"DRI") F ZZZ=8,9,10 S $P(^PS(52.4,DA,0),"^",ZZZ)=""
"RTN","PSODGDG2",9,0)
 K ZZZ Q
"RTN","PSODGDG2",10,0)
PROC I '$D(PSOPAR) D ^PSOLSET I '$D(PSOPAR) W $C(7),$C(7),!!,"SITE PARAMETERS MUST BE DEFINED !",! G EX
"RTN","PSODGDG2",11,0)
 I '$D(^XUSEC("PSORPH",DUZ)) W $C(7),$C(7),!,"YOU MUST BE A PHARMACIST TO COMPLETE THIS PROCEDURE !",!! Q
"RTN","PSODGDG2",12,0)
 I $P($G(^VA(200,DUZ,20)),"^",4)']"" W $C(7),$C(7),!,"YOU DO NOT HAVE AN ELECTRONIC SIGNATURE CODE !",!! Q
"RTN","PSODGDG2",13,0)
BEG S DIC="^PS(52.4,",DIC(0)="AQXEZ",DIC("S")="I $D(^PS(52.4,""ADI"",+Y))!($D(^PS(52.4,""DW"",+Y)))"
"RTN","PSODGDG2",14,0)
 S DIC("A")=$S($$DS^PSSDSAPI:"Select RX with Order Checks: ",1:"Select RX with Drug Interaction: ")
"RTN","PSODGDG2",15,0)
 S DIC("W")="W ?$X+5,$P(^DPT($P(^PS(52.4,+Y,0),""^"",2),0),""^"")_"" "",?40,$E($P(^(0),""^"",9),1,3)_""-""_$E($P(^(0),""^"",9),4,5)_""-""_$E($P(^(0),""^"",9),6,9)"
"RTN","PSODGDG2",16,0)
 D ^DIC K DIC G:"^"[$E(X)!($D(DTOUT)) EX
"RTN","PSODGDG2",17,0)
ENT S (PSODFN,PSOVRDFN,DFN,PSDFN)=$P(Y(0),"^",2),PPL="",PSONAM=$P(^DPT(PSDFN,0),"^"),(PSONV,PSONVXX,IFN,DGDG)=+Y D STAT G:FLAGST BEG D ^PSOBUILD
"RTN","PSODGDG2",18,0)
 S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY K PSOPLCK G BEG
"RTN","PSODGDG2",19,0)
 K PSOPLCK D PSOL^PSSLOCK(PSONV) I '$G(PSOMSG) D UL^PSSLOCK(PSODFN) D  K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to Continue" D ^DIR K DIR,PSOMSG G BEG
"RTN","PSODGDG2",20,0)
 .I $P($G(PSOMSG),"^",2)'="" W !!,$P(PSOMSG,"^",2),! Q
"RTN","PSODGDG2",21,0)
 .W !!,"Another person is editing this order.",!
"RTN","PSODGDG2",22,0)
 D PID^VADPT
"RTN","PSODGDG2",23,0)
 N PSOPOCK S PSOPOCK=1 D DGDGI^PSOVER
"RTN","PSODGDG2",24,0)
 I $G(VERLFLAG) D UL^PSSLOCK(PSOVRDFN) D PSOUL^PSSLOCK(PSONVXX) K VERLFLAG G BEG
"RTN","PSODGDG2",25,0)
 D PACK^PSOVER
"RTN","PSODGDG2",26,0)
 D UL^PSSLOCK(PSOVRDFN),PSOUL^PSSLOCK(PSONVXX)
"RTN","PSODGDG2",27,0)
 W !! G BEG
"RTN","PSODGDG2",28,0)
EX D END^PSOVER K DTOUT,DIRUT,PSORX,PSOVRDFN,PSONVXX Q
"RTN","PSODGDG2",29,0)
 ;
"RTN","PSODGDG2",30,0)
STAT ;
"RTN","PSODGDG2",31,0)
 S FLAGST=0
"RTN","PSODGDG2",32,0)
 S ST00=$P($G(^PSRX(PSONV,"STA")),"^")
"RTN","PSODGDG2",33,0)
 I $P($G(^PSRX(PSONV,2)),"^",6),+$P($G(^PSRX(PSONV,2)),"^",6)<DT,ST00<12 S $P(^PSRX(PSONV,"STA"),"^")=11,ST00=11
"RTN","PSODGDG2",34,0)
 I ST00=1!(ST00=4) Q
"RTN","PSODGDG2",35,0)
 S FLAGST=1
"RTN","PSODGDG2",36,0)
 K DIK S DA=PSONV,DIK="^PS(52.4," D ^DIK K DIK
"RTN","PSODGDG2",37,0)
 I ST00>10,ST00<16,$O(^PS(52.5,"B",PSONV,0)) S DA=$O(^PS(52.5,"B",PSONV,0)),DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSODGDG2",38,0)
 I ST00>10,ST00<16,$G(^PSRX(PSONV,"H"))]"" K:$P(^PSRX(PSONV,"H"),"^") ^PSRX("AH",$P(^PSRX(PSONV,"H"),"^"),PSONV) S ^PSRX(PSONV,"H")=""
"RTN","PSODGDG2",39,0)
 S STEXT=$S(ST00=0:"Active",ST00=2:"Refill",ST00=3:"Hold",ST00=5:"Suspended",ST00=11:"Expired",ST00=12:"Canceled",ST00=13:"Deleted",ST00=14:"Discontinued",ST00=15:"Discontinued (Edit)",ST00=16:"Provider Hold",1:"Unknown")
"RTN","PSODGDG2",40,0)
 I '$G(CLFLAG) W !!?3,"Rx # ",$P($G(^PSRX(PSONV,0)),"^")," has a status of ",STEXT_".",! K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press RETURN to continue" D ^DIR W ! K DIR
"RTN","PSODGDG2",41,0)
 Q
"RTN","PSODGDGP")
0^12^B48532465
"RTN","PSODGDGP",1,0)
PSODGDGP ;BIR/SAB - drug drug interaction checker ;4/14/93
"RTN","PSODGDGP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**251**;DEC 1997;Build 202
"RTN","PSODGDGP",3,0)
 ;External reference to ^PS(56 supported by DBIA 2229
"RTN","PSODGDGP",4,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSODGDGP",5,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSODGDGP",6,0)
 ;External references to ^ORRDI1 supported by DBIA 4659
"RTN","PSODGDGP",7,0)
 ;External reference ^XTMP("ORRDI" supported by DBIA 4660
"RTN","PSODGDGP",8,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5424
"RTN","PSODGDGP",9,0)
 N DRG S (CRIT,DRG,LSI,DGI,DGS,SER,SERS,STA,PSOICT)=""
"RTN","PSODGDGP",10,0)
 D BLD Q:+$G(PSORX("DFLG"))!($G(PSODLQT))
"RTN","PSODGDGP",11,0)
 ;I $D(^XUSEC("PSORPH",DUZ)) S PSORX("PHARM")=DUZ D PHARM
"RTN","PSODGDGP",12,0)
 ;S LSI=$P(^PSRX($P(ON,";",2),0),"^")_"/"_$P(^PSDRUG($P(^PSRX($P(ON,";",2),0),"^",6),0),"^")_","_LSI
"RTN","PSODGDGP",13,0)
 I '$D(^XUSEC("PSORPH",DUZ)),$G(DGI)]"" S:$G(CRIT) PSONEW("STATUS")=4 W $C(7),!,"DRUG INTERACTON WITH RX #s: "_LSI,!
"RTN","PSODGDGP",14,0)
 I $G(PSORX("VERIFY")),(","_$G(^TMP("PSOSER",$J,0))_",")[(",1,") S:$D(^TMP("PSODGI",$J,0)) PSONEW("STATUS")=4
"RTN","PSODGDGP",15,0)
 K DRG,NDF,PSOICT,IT,LSI
"RTN","PSODGDGP",16,0)
 I +$G(PSORX("DFLG")) Q
"RTN","PSODGDGP",17,0)
 I +$G(PSODRUG("NDF"))'=0 D
"RTN","PSODGDGP",18,0)
 .I $T(HAVEHDR^ORRDI1)']"" Q
"RTN","PSODGDGP",19,0)
 .I '$$HAVEHDR^ORRDI1 Q
"RTN","PSODGDGP",20,0)
 .D HD^PSODDPR2():(($Y+5)>IOSL)
"RTN","PSODGDGP",21,0)
 .I $P($G(^XTMP("ORRDI","PSOO",PSODFN,0)),"^",3)<0 W !!,"Remote data not available - Only local order checks processed.",! D HD^PSODDPR2():(($Y+5)>IOSL) Q
"RTN","PSODGDGP",22,0)
 .I $D(^TMP($J,"DI"_PSODFN)) K ^TMP($J,"DI") M ^TMP($J,"DI")=^TMP($J,"DI"_PSODFN) D DRGINT^PSOORRD2
"RTN","PSODGDGP",23,0)
 .K ^TMP($J,"DI"_PSODFN),^TMP($J,"DI")
"RTN","PSODGDGP",24,0)
 I '$D(^XUSEC("PSORPH",DUZ)),$G(DGI)]"" K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to Continue..." D ^DIR K DIR,DUOUT,DTOUT
"RTN","PSODGDGP",25,0)
 Q
"RTN","PSODGDGP",26,0)
TECH ;add tech entry to RX VERIFY file (#52.4); called from new order/copy/renew
"RTN","PSODGDGP",27,0)
 I $$DS^PSSDSAPI,+$G(^TMP("PSODOSF",$J,0)) S ^PS(52.4,PSOX("IRXN"),1)=^TMP("PSODOSF",$J,0)
"RTN","PSODGDGP",28,0)
 I $G(^TMP("PSODGI",$J,0))'="" D
"RTN","PSODGDGP",29,0)
 . S $P(^PSRX(PSOX("IRXN"),"DRI"),"^")=^TMP("PSOSER",$J,0)_"^"_^TMP("PSODGI",$J,0)
"RTN","PSODGDGP",30,0)
 . S $P(^PS(52.4,PSOX("IRXN"),0),"^",8)=1,$P(^PS(52.4,PSOX("IRXN"),0),"^",9)=^TMP("PSOSER",$J,0),$P(^PS(52.4,PSOX("IRXN"),0),"^",10)=^TMP("PSODGI",$J,0)
"RTN","PSODGDGP",31,0)
 Q
"RTN","PSODGDGP",32,0)
BLD I $D(^XUSEC("PSORPH",DUZ)) S PSORX("PHARM")=DUZ D PHARM Q
"RTN","PSODGDGP",33,0)
BLD2 ;
"RTN","PSODGDGP",34,0)
 Q:$P(ON,";")'="O"
"RTN","PSODGDGP",35,0)
 S LSI=$P(^PSRX($P(ON,";",2),0),"^")_"/"_$P(^PSDRUG($P(^PSRX($P(ON,";",2),0),"^",6),0),"^")_","_LSI
"RTN","PSODGDGP",36,0)
 I '$D(^TMP("PSODGI",$J,0)) D
"RTN","PSODGDGP",37,0)
 . S ^TMP("PSODGI",$J,0)=$P(ON,";",2)_","_$G(^TMP("PSODGI",$J,0)),^TMP("PSOSER",$J,0)=IT_","_$G(^TMP("PSOSER",$J,0))
"RTN","PSODGDGP",38,0)
 I ^TMP("PSODGI",$J,0)'[$P(ON,";",2) D
"RTN","PSODGDGP",39,0)
 .S ^TMP("PSODGI",$J,0)=$P(ON,";",2)_","_$G(^TMP("PSODGI",$J,0))
"RTN","PSODGDGP",40,0)
 .S ^TMP("PSOSER",$J,0)=IT_","_$G(^TMP("PSOSER",$J,0))
"RTN","PSODGDGP",41,0)
 ;I $P(^PSRX($P(ON,";",2),0),"^",6),IT=1 S $P(^PSRX($P(ON,";",2),"STA"),"^")=4
"RTN","PSODGDGP",42,0)
 I IT=2 S ^TMP("PSOSERS",$J,0)=IT_","_$G(^TMP("PSOSERS",$J,0)),^TMP("PSODGS",$J,0)=$P(ON,";",2)_","_$G(^TMP("PSODGS",$J,0))
"RTN","PSODGDGP",43,0)
 S:IT=1 ^TMP("PSOTDD",$J,1)=1
"RTN","PSODGDGP",44,0)
 Q
"RTN","PSODGDGP",45,0)
PHARM ;pharmacist verification of drug interaction
"RTN","PSODGDGP",46,0)
 D PSOL^PSSLOCK($P(ON,";",2)) I '$G(PSOMSG) D  K PSOMSG S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to Continue" D ^DIR K DIR S PSORX("DFLG")=1 Q
"RTN","PSODGDGP",47,0)
 .I $P($G(PSOMSG),"^",2)'="" W !!,$P(PSOMSG,"^",2) D  Q
"RTN","PSODGDGP",48,0)
 ..W !,"Rx: "_$P($G(^PSRX($P(ON,";",2),0)),"^")_"    Drug: "_$P($G(^PSDRUG(+$P($G(^(0)),"^",6),0)),"^")
"RTN","PSODGDGP",49,0)
 ..W !,"which interacts with the drug you are entering!",!
"RTN","PSODGDGP",50,0)
 .W !!,"Another person is editing Rx "_$P($G(^PSRX($P(ON,";",2),0)),"^")_",",!,"which interacts with the drug you are entering!",!
"RTN","PSODGDGP",51,0)
 S PSODGRLX=$P(ON,";",2)
"RTN","PSODGDGP",52,0)
 S DIR("?",1)="Answer 'YES' if you DO want to "_$S(IT=1:"continue processing",1:"enter an intervention for")_" this medication,"
"RTN","PSODGDGP",53,0)
 S DIR("?")="       'NO' if you DON'T want to "_$S(IT=1:"continue processing",1:"enter an intervention for")_" this medication,"
"RTN","PSODGDGP",54,0)
 W ! S DIR(0)="SA^1:YES;0:NO",DIR("A")="Do you want to "_$S(IT=1:"Continue? ",1:"Intervene? "),DIR("B")="Y" D ^DIR
"RTN","PSODGDGP",55,0)
 I 'Y,IT=1 S PSORX("DFLG")=1,DGI="" K DIR,DTOUT,DIRUT,DIROUT,DUOUT Q
"RTN","PSODGDGP",56,0)
 I Y,IT=1 S PSORX("INTERVENE")=1,DGI="" K DIR,DTOUT,DIRUT,DIROUT,DUOUT G CRI Q
"RTN","PSODGDGP",57,0)
 I 'Y,IT=2 S:$G(DIRUT) PSORX("DFLG")=1 K DIR,DTOUT,DIRUT,DIROUT,DUOUT D ULRX Q
"RTN","PSODGDGP",58,0)
 I Y,IT=2 S PSORX("INTERVENE")=2,DGI="" K DIR,DTOUT,DIRUT,DIROUT,DUOUT
"RTN","PSODGDGP",59,0)
 D ULRX
"RTN","PSODGDGP",60,0)
 Q
"RTN","PSODGDGP",61,0)
CRI ;process new drug interactions entered by pharmacist
"RTN","PSODGDGP",62,0)
 K DIR ;G:$P(PSOSD(STA,DRG),"^",9) CRITN 
"RTN","PSODGDGP",63,0)
 S DIR("A",1)="",DIR("A",2)="Do you want to Process medication",DIR("A")=PSODRUG("NAME")_": ",DIR(0)="SA^1:PROCESS;0:ABORT ORDER ENTRY",DIR("B")="P"
"RTN","PSODGDGP",64,0)
 S DIR("?",1)="Enter '1' or 'P' to Activate medication",DIR("?")="      '0' or 'A' to Abort Order Entry process" D ^DIR K X1,DIR I 'Y S PSORX("DFLG")=1,DGI="" K DTOUT,DIRUT,DIROUT,DUOUT,PSORX("INTERVENE") D ULRX Q
"RTN","PSODGDGP",65,0)
 I IT=1 D
"RTN","PSODGDGP",66,0)
 .S PSORX("INTERVENE")=IT
"RTN","PSODGDGP",67,0)
 .D SIG^XUSESIG I X1="" K PSORX("INTERVENE") S PSORX("DFLG")=1 Q
"RTN","PSODGDGP",68,0)
 K DUOUT,DTOUT,DIRUT,DIROUT D ULRX Q
"RTN","PSODGDGP",69,0)
CRITN ;process multiple new drug interactions
"RTN","PSODGDGP",70,0)
 K X1,DIR S DIR("A",1)="",DIR("A",2)="Do you want to: ",DIR("A",3)=" 1.  Delete NEW medication "_PSODRUG("NAME"),DIR("A",4)=" 2.  Cancel ACTIVE New Rx #"_$P(^PSRX($P(ON,";",2),0),"^")_" DRUG: "_DRG
"RTN","PSODGDGP",71,0)
 S DIR("A",5)=" 3.  Delete 1 and Cancel 2",DIR("A")=" 4.  Continue ?: ",DIR(0)="SA^1:NEW MEDICATION;2:ACTIVE New Rx "_DRG_";3:BOTH;4:CONTINUE"
"RTN","PSODGDGP",72,0)
 S DIR("?",1)="Enter '1' or 'N' to Delete New Medication and Dispense Rx #"_$P(^PSRX($P(ON,";",2),0),"^")
"RTN","PSODGDGP",73,0)
 S DIR("?",2)="      '2' or 'A' to Cancel Active Rx #"_$P(^PSRX($P(ON,";",2),0),"^")_" and Dispense New Rx"
"RTN","PSODGDGP",74,0)
 S DIR("?",3)="      '3' or 'B' to Delete 1 and Cancel 2",DIR("?")="      '4' or 'C' to do nothing to either Rx" D ^DIR K DIR
"RTN","PSODGDGP",75,0)
 I Y=1 S PSORX("DFLG")=1,DGI="",PSHLDDRG=PSODRUG("IEN") D  D ULRX Q
"RTN","PSODGDGP",76,0)
 .I $G(PSORXED) D  Q
"RTN","PSODGDGP",77,0)
 ..D NOOR^PSOCAN4 I $D(DIRUT) W $C(7)," ACTION NOT TAKEN!",! S PSORX("DFLG")=1 K PSORX("INTERVENE") Q
"RTN","PSODGDGP",78,0)
 ..S DA=$P(ON,";",2) D MESS,ENQ^PSORXDL,FULL^VALM1
"RTN","PSODGDGP",79,0)
 ..K PSOSD($P(PSOLST($P(ON,";",2)),"^",3),PSODRUG("NAME")),DTOUT,DIROUT,DIRUT,DUOUT S:$G(PSOSD) PSOSD=PSOSD-1 S ZONE=1
"RTN","PSODGDGP",80,0)
 .S PSODRUG("IEN")=$P(^PSRX($P(ON,";",2),0),"^",6) D FULL^VALM1,^PSORXI
"RTN","PSODGDGP",81,0)
 .S PSODRUG("IEN")=PSHLDDRG,VALMBCK="R"
"RTN","PSODGDGP",82,0)
 .K DTOUT,DIRUT,DIROUT,DUOUT,PSHLDDRG
"RTN","PSODGDGP",83,0)
 .I $G(OR0) D
"RTN","PSODGDGP",84,0)
 ..D NOOR^PSOCAN4 I $D(DIRUT) D  Q
"RTN","PSODGDGP",85,0)
 ...W $C(7)," ACTION NOT TAKEN!",! K PSORX("INTERVENE") S PSORX("DFLG")=1
"RTN","PSODGDGP",86,0)
 ..D DC^PSOORFI2
"RTN","PSODGDGP",87,0)
 I Y=2 S (DA,PSOHOLDA)=$P(ON,";",2) D  D ULRX Q
"RTN","PSODGDGP",88,0)
 .D NOOR^PSOCAN4 I $D(DIRUT) D  Q
"RTN","PSODGDGP",89,0)
 ..W $C(7)," ACTION NOT TAKEN!",! K PSORX("INTERVENE") S PSORX("DFLG")=1
"RTN","PSODGDGP",90,0)
 .D MESS,ENQ^PSORXDL
"RTN","PSODGDGP",91,0)
 .S DA=PSOHOLDA D FULL^VALM1,EN1^PSORXI(.DA),PPL
"RTN","PSODGDGP",92,0)
 .K DTOUT,DIROUT,DIRUT,DUOUT,PSOHOLDA
"RTN","PSODGDGP",93,0)
 .S:$G(PSOSD) PSOSD=PSOSD-1 S VALMBCK="R"
"RTN","PSODGDGP",94,0)
 I Y=3 S (DA,PSOHOLDA)=$P(ON,";",2) D  S VALMBCK="R"
"RTN","PSODGDGP",95,0)
 .D NOOR^PSOCAN4 I $D(DIRUT) D  Q
"RTN","PSODGDGP",96,0)
 ..W $C(7)," ACTION NOT TAKEN!",! K PSORX("INTERVENE") S PSORX("DFLG")=1
"RTN","PSODGDGP",97,0)
 .S:$G(PSOSD) PSOSD=PSOSD-1 S PSORX("DFLG")=1 D MESS,ENQ^PSORXDL
"RTN","PSODGDGP",98,0)
 .I $G(OR0) D DC^PSOORFI2
"RTN","PSODGDGP",99,0)
 .S DA=PSOHOLDA D FULL^VALM1,EN1^PSORXI(.DA),PPL K PSOHOLDA
"RTN","PSODGDGP",100,0)
 .I $G(PSORXED) D
"RTN","PSODGDGP",101,0)
 ..S DA=$P(ON,";",2) D MESS,ENQ^PSORXDL,FULL^VALM1
"RTN","PSODGDGP",102,0)
 ..K DTOUT,DIROUT,DIRUT,DUOUT S:$G(PSOSD) PSOSD=PSOSD-1 S ZONE=1
"RTN","PSODGDGP",103,0)
 K DTOUT,DIROUT,DIRUT,DUOUT
"RTN","PSODGDGP",104,0)
 D ULRX
"RTN","PSODGDGP",105,0)
 Q
"RTN","PSODGDGP",106,0)
MESS W !!,"Canceling Rx: "_$P($G(^PSRX(DA,0)),"^")_"   "_"Drug: "_$P($G(^PSDRUG($P(^PSRX(DA,0),"^",6),0)),"^"),! Q
"RTN","PSODGDGP",107,0)
PPL F PSOSL=0:0 S PSOSL=$O(PSORX("PSOL",PSOSL)) Q:'PSOSL  S PSOX2=PSOSL
"RTN","PSODGDGP",108,0)
 I $G(PSOX2) D
"RTN","PSODGDGP",109,0)
 .F PSOSL=0:1:PSOX2 S PSOSL=$O(PSORX("PSOL",PSOSL)) Q:'PSOSL  F ENT=1:1:$L(PSORX("PSOL",PSOSL),",") I $P(PSORX("PSOL",PSOSL),",",ENT)=$P(ON,";",2) S PSOL(PSOSL,ENT)=""
"RTN","PSODGDGP",110,0)
 .F PSOL=0:0 S PSOL=$O(PSOL(PSOL)) Q:'PSOL  F ENT=0:0 S ENT=$O(PSOL(PSOL,ENT)) Q:'ENT  D
"RTN","PSODGDGP",111,0)
 ..I ENT=1,'$P(PSORX("PSOL",PSOL),",",2) K PSORX("PSOL",PSOL) Q
"RTN","PSODGDGP",112,0)
 ..I ENT=1,$P(PSORX("PSOL",PSOL),",",2) S PSORX("PSOL",PSOL)=$P(PSORX("PSOL",PSOL),",",2,99) Q
"RTN","PSODGDGP",113,0)
 ..S PSORX("PSOL",PSOL)=$P(PSORX("PSOL",PSOL),",",1,ENT-1)_","_$P(PSORX("PSOL",PSOL),",",ENT+1,99)
"RTN","PSODGDGP",114,0)
 K PSOX2,PSOSL,PSOL,ENT Q
"RTN","PSODGDGP",115,0)
ULRX ;
"RTN","PSODGDGP",116,0)
 I '$G(PSODGRLX) Q
"RTN","PSODGDGP",117,0)
 D PSOUL^PSSLOCK(PSODGRLX) K PSODGRLX
"RTN","PSODGDGP",118,0)
 Q
"RTN","PSODOSCL")
0^39^B27277557
"RTN","PSODOSCL",1,0)
PSODOSCL ;BIR/RTR-Dose Call Utility Routine ;10/07/08
"RTN","PSODOSCL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**251**;DEC 1997;Build 202
"RTN","PSODOSCL",3,0)
 ;
"RTN","PSODOSCL",4,0)
 ;Reference to PSDRUG supported by DBIA 221
"RTN","PSODOSCL",5,0)
 ;Reference to PS(50.7 supported by DBIA 2223
"RTN","PSODOSCL",6,0)
 ;PSODARTX = Literal Subscript
"RTN","PSODOSCL",7,0)
 ;PSODAR = Internal Prescription Number from Prescription (#52) File
"RTN","PSODOSCL",8,0)
 ;External reference to PSSDSAPI supported by DBIA 5424
"RTN","PSODOSCL",9,0)
 ;External reference to $$DS^PSSDSAPD supported by DBIA 5426
"RTN","PSODOSCL",10,0)
RX(PSODARTX,PSODARX) ;
"RTN","PSODOSCL",11,0)
 ;use Psodar
"RTN","PSODOSCL",12,0)
 N PSODAR1,PSODAR2,PSODARZ,PSODARL,PSODARCT,PSODAR6
"RTN","PSODOSCL",13,0)
 S PSODARZ=$G(^PSRX(PSODARX,0))
"RTN","PSODOSCL",14,0)
 I '$P(PSODARZ,"^",2)!('$P(PSODARZ,"^",6)) Q
"RTN","PSODOSCL",15,0)
 S PSODAR1("PACKAGE")="O"
"RTN","PSODOSCL",16,0)
 S PSODAR1("OI")=$P($G(^PSDRUG($P(PSODARZ,"^",6),2)),"^")
"RTN","PSODOSCL",17,0)
 S PSODARCT=0
"RTN","PSODOSCL",18,0)
 F PSODARL=0:0 S PSODARL=$O(^PSRX(PSODARX,6,PSODARL)) Q:'PSODARL  D
"RTN","PSODOSCL",19,0)
 .S PSODAR1(PSODARL,"DRUG_IEN")=$P(PSODARZ,"^",6)
"RTN","PSODOSCL",20,0)
 .S PSODAR1(PSODARL,"DRUG_NM")=$P($G(^PSDRUG($P(PSODARZ,"^",6),0)),"^")
"RTN","PSODOSCL",21,0)
 .I PSODAR1(PSODARL,"DRUG_NM")="",PSODAR1("OI") S PSODAR1(PSODARL,"DRUG_NM")=$P($G(^PS(50.7,PSODAR1("OI"),0)),"^")
"RTN","PSODOSCL",22,0)
 .S PSODAR1(PSODARL,"RX_NUM")="O;"_PSODARX_";PROSPECTIVE;"_PSODARL
"RTN","PSODOSCL",23,0)
 .S PSODAR6=$G(^PSRX(PSODARX,6,PSODARL,0))
"RTN","PSODOSCL",24,0)
 .S PSODAR2(PSODARL,"CONJ")=$P(PSODAR6,"^",6)
"RTN","PSODOSCL",25,0)
 .S PSODAR2(PSODARL,"DRATE")=$P(PSODAR6,"^",5)
"RTN","PSODOSCL",26,0)
 .D DOSE
"RTN","PSODOSCL",27,0)
 .I $P(PSODAR6,"^",8)'="" S PSODAR2(PSODARL,"SCHEDULE")=$P(PSODAR6,"^",8)
"RTN","PSODOSCL",28,0)
 .;S PSODAR1(PSODARL,"DURATION")=1
"RTN","PSODOSCL",29,0)
 .;S PSODAR1(PSODARL,"DURATION_RT")="DAY"
"RTN","PSODOSCL",30,0)
 .I $P(PSODAR6,"^",7) S PSODAR1(PSODARL,"ROUTE")=$P($$MRT^PSSDSAPI($P(PSODAR6,"^",7)),"^",2)
"RTN","PSODOSCL",31,0)
 .S PSODARCT=1
"RTN","PSODOSCL",32,0)
 I 'PSODARCT Q
"RTN","PSODOSCL",33,0)
 D DOSE^PSSDSAPD(.PSODARTX,$P(PSODARZ,"^",2),.PSODAR2,.PSODAR1)
"RTN","PSODOSCL",34,0)
 Q
"RTN","PSODOSCL",35,0)
 ;
"RTN","PSODOSCL",36,0)
 ;
"RTN","PSODOSCL",37,0)
DOSE ;
"RTN","PSODOSCL",38,0)
 N PSODARUN,PSODARUX,PSODARFL
"RTN","PSODOSCL",39,0)
 S PSODARFL=0
"RTN","PSODOSCL",40,0)
 I $P(PSODAR6,"^"),$P(PSODAR6,"^",2),$P(PSODAR6,"^",3) D
"RTN","PSODOSCL",41,0)
 .S PSODARR(PSODARL,"DOSE_AMT")=$P(PSODAR6,"^")
"RTN","PSODOSCL",42,0)
 .S PSODARUN=$P($G(^PS(50.607,+$P(PSODAR6,"^",3),0)),"^")
"RTN","PSODOSCL",43,0)
 .Q:$G(PSODARUN)=""
"RTN","PSODOSCL",44,0)
 .S PSODARUX=$$UNIT^PSSDSAPI(PSODARUN)
"RTN","PSODOSCL",45,0)
 .Q:$G(PSODARUX)=""
"RTN","PSODOSCL",46,0)
 .S PSODAR1(PSODARL,"DOSE_AMT")=$P(PSODAR6,"^")
"RTN","PSODOSCL",47,0)
 .S PSODAR1(PSODARL,"DOSE_UNIT")=PSODARUX
"RTN","PSODOSCL",48,0)
 .S PSODARFL=1
"RTN","PSODOSCL",49,0)
 Q:PSODARFL
"RTN","PSODOSCL",50,0)
 S PSODAR2(PSODARL,"DO")=$P(PSODAR6,"^")
"RTN","PSODOSCL",51,0)
 Q
"RTN","PSODOSCL",52,0)
 ;
"RTN","PSODOSCL",53,0)
PEN(PSOSARTX,PSOSARX) ;Pending Order
"RTN","PSODOSCL",54,0)
 ;Use PSOSAR
"RTN","PSODOSCL",55,0)
 ;This is currently not being called, if ever called, DRUG_NM and OI and PACKAGE
"RTN","PSODOSCL",56,0)
 N PSOSAR1,PSOSAR2,PSOSARZ,PSOSARL,PSOSARCT,PSOSAR6,PSOSAR7
"RTN","PSODOSCL",57,0)
 S PSOSARZ=$G(^PS(52.41,PSOSARX,0))
"RTN","PSODOSCL",58,0)
 I '$P(PSOSARZ,"^",2)!('$P(PSOSARZ,"^",9)) Q
"RTN","PSODOSCL",59,0)
 S PSOSARCT=0
"RTN","PSODOSCL",60,0)
 F PSOSARL=0:0 S PSOSARL=$O(^PS(52.41,PSOSARX,1,PSOSARL))  Q:'PSOSARL!(PSOSARCT)  D
"RTN","PSODOSCL",61,0)
 .S PSOSAR1(PSOSARL,"RX_NUM")=PSOSARX
"RTN","PSODOSCL",62,0)
 .S PSOSAR1(PSOSARL,"DRUG_IEN")=$P(PSOSARZ,"^",9)
"RTN","PSODOSCL",63,0)
 .S PSOSAR6=$G(^PS(52.41,PSOSARX,1,PSOSARL,1))
"RTN","PSODOSCL",64,0)
 .S PSOSAR7=$G(^PS(52.41,PSOSARX,1,PSOSARL,2))
"RTN","PSODOSCL",65,0)
 .D PDOSE
"RTN","PSODOSCL",66,0)
 .I $P(PSOSAR6,"^")'="" S PSOSAR1(PSOSARL,"FREQ")=$$FRQ^PSSDSAPI($P(PSOSAR6,"^"),,"O")
"RTN","PSODOSCL",67,0)
 .S PSOSAR1(PSOSARL,"DURATION")=1
"RTN","PSODOSCL",68,0)
 .S PSOSAR1(PSOSARL,"DURATION_RT")="DAY"
"RTN","PSODOSCL",69,0)
 .I $P(PSOSAR6,"^",8) S PSOSAR1(PSOSARL,"ROUTE")=$P($$MRT^PSSDSAPI($P(PSOSAR6,"^",8)),"^",2)
"RTN","PSODOSCL",70,0)
 .S PSOSARCT=1
"RTN","PSODOSCL",71,0)
 I 'PSOSARCT Q
"RTN","PSODOSCL",72,0)
 D DOSE^PSSDSAPD(PSOSARTX,$P(PSOSARZ,"^",2),.PSOSAR2,.PSOSAR1)
"RTN","PSODOSCL",73,0)
 Q
"RTN","PSODOSCL",74,0)
 ;
"RTN","PSODOSCL",75,0)
 ;
"RTN","PSODOSCL",76,0)
PDOSE ;
"RTN","PSODOSCL",77,0)
 N PSOSARUN,PSOSARUX,PSOSARFL
"RTN","PSODOSCL",78,0)
 S PSOSARFL=0
"RTN","PSODOSCL",79,0)
 I $P(PSOSAR7,"^"),$P(PSOSAR7,"^",2),$P(PSOSAR6,"^",9) D
"RTN","PSODOSCL",80,0)
 .S PSOSARR(PSOSARL,"DOSE_AMT")=$P(PSOSAR7,"^")
"RTN","PSODOSCL",81,0)
 .S PSOSARUN=$P($G(^PS(50.607,+$P(PSOSAR6,"^",9),0)),"^")
"RTN","PSODOSCL",82,0)
 .Q:$G(PSOSARUN)=""
"RTN","PSODOSCL",83,0)
 .S PSOSARUX=$$UNIT^PSSDSAPI(PSOSARUN)
"RTN","PSODOSCL",84,0)
 .Q:$G(PSOSARUX)=""
"RTN","PSODOSCL",85,0)
 .S PSOSAR1(PSOSARL,"DOSE_AMT")=$P(PSOSAR7,"^")
"RTN","PSODOSCL",86,0)
 .S PSOSAR1(PSOSARL,"DOSE_UNIT")=PSOSARUX
"RTN","PSODOSCL",87,0)
 .S PSOSARFL=1
"RTN","PSODOSCL",88,0)
 Q:PSOSARFL
"RTN","PSODOSCL",89,0)
 S PSOSAR2(PSOSARL,"DO")=$P(PSOSAR7,"^")
"RTN","PSODOSCL",90,0)
 Q
"RTN","PSODOSCL",91,0)
 ;
"RTN","PSODOSCL",92,0)
 ;
"RTN","PSODOSCL",93,0)
FIN(PSOXARTX,PSOXARX,PSOXARY) ;
"RTN","PSODOSCL",94,0)
 ;Set up variables and make Dose Call
"RTN","PSODOSCL",95,0)
 ;Assumes PSODFN is defined
"RTN","PSODOSCL",96,0)
 ;Don't set arrays that are passed in
"RTN","PSODOSCL",97,0)
 ;use PSOXAR
"RTN","PSODOSCL",98,0)
 N PSOXAR1,PSOXAR2,PSOXARL1,PSOXARL2
"RTN","PSODOSCL",99,0)
 I '$G(PSODFN)!('$G(PSOXARY("IEN"))) Q
"RTN","PSODOSCL",100,0)
 S PSOXAR1("PACKAGE")="O"
"RTN","PSODOSCL",101,0)
 S PSOXAR1("OI")=$P($G(^PSDRUG(PSOXARY("IEN"),2)),"^")
"RTN","PSODOSCL",102,0)
 F PSOXARL1=0:0 S PSOXARL1=$O(PSOXARX("DOSE",PSOXARL1)) Q:'PSOXARL1  D
"RTN","PSODOSCL",103,0)
 .S PSOXAR1(PSOXARL1,"RX_NUM")="O;1;PROSPECTIVE;"_PSOXARL1
"RTN","PSODOSCL",104,0)
 .S PSOXAR1(PSOXARL1,"DRUG_IEN")=PSOXARY("IEN")
"RTN","PSODOSCL",105,0)
 .S PSOXAR1(PSOXARL1,"DRUG_NM")=$P($G(^PSDRUG(PSOXARY("IEN"),0)),"^")
"RTN","PSODOSCL",106,0)
 .I PSOXAR1(PSOXARL1,"DRUG_NM")="",PSOXAR1("OI") S PSOXAR1(PSOXARL1,"DRUG_NM")=$P($G(^PS(50.7,PSOXAR1("OI"),0)),"^")
"RTN","PSODOSCL",107,0)
 .S PSOXAR2(PSOXARL1,"CONJ")=$G(PSOXARX("CONJUNCTION",PSOXARL1))
"RTN","PSODOSCL",108,0)
 .S PSOXAR2(PSOXARL1,"DRATE")=$G(PSOXARX("DURATION",PSOXARL1))
"RTN","PSODOSCL",109,0)
 .D FDOSE
"RTN","PSODOSCL",110,0)
 .I $G(PSOXARX("SCHEDULE",PSOXARL1))'="" S PSOXAR2(PSOXARL1,"SCHEDULE")=PSOXARX("SCHEDULE",PSOXARL1)
"RTN","PSODOSCL",111,0)
 .;S PSOXAR1(PSOXARL1,"DURATION")=1
"RTN","PSODOSCL",112,0)
 .;S PSOXAR1(PSOXARL1,"DURATION_RT")="DAY"
"RTN","PSODOSCL",113,0)
 .I $G(PSOXARX("ROUTE",PSOXARL1)) S PSOXAR1(PSOXARL1,"ROUTE")=$P($$MRT^PSSDSAPI(PSOXARX("ROUTE",PSOXARL1)),"^",2)
"RTN","PSODOSCL",114,0)
 D DOSE^PSSDSAPD(.PSOXARTX,PSODFN,.PSOXAR2,.PSOXAR1)
"RTN","PSODOSCL",115,0)
 Q
"RTN","PSODOSCL",116,0)
 ;
"RTN","PSODOSCL",117,0)
FDOSE ;
"RTN","PSODOSCL",118,0)
 N PSOXARUN,PSOXARUX,PSOXARFL
"RTN","PSODOSCL",119,0)
 S PSOXARFL=0
"RTN","PSODOSCL",120,0)
 I $G(PSOXARX("DOSE",PSOXARL1)),$G(PSOXARX("UNITS",PSOXARL1)),$G(PSOXARX("DOSE ORDERED",PSOXARL1)) D
"RTN","PSODOSCL",121,0)
 .S PSOXARUN=$P($G(^PS(50.607,+$G(PSOXARX("UNITS",PSOXARL1)),0)),"^")
"RTN","PSODOSCL",122,0)
 .Q:PSOXARUN=""
"RTN","PSODOSCL",123,0)
 .S PSOXARUX=$$UNIT^PSSDSAPI(PSOXARUN)
"RTN","PSODOSCL",124,0)
 .Q:$G(PSOXARUX)=""
"RTN","PSODOSCL",125,0)
 .S PSOXAR1(PSOXARL1,"DOSE_AMT")=PSOXARX("DOSE",PSOXARL1)
"RTN","PSODOSCL",126,0)
 .S PSOXAR1(PSOXARL1,"DOSE_UNIT")=PSOXARUX
"RTN","PSODOSCL",127,0)
 .S PSOXARFL=1
"RTN","PSODOSCL",128,0)
 Q:PSOXARFL
"RTN","PSODOSCL",129,0)
 S PSOXAR2(PSOXARL1,"DO")=$G(PSOXARX("DOSE",PSOXARL1))
"RTN","PSODOSCL",130,0)
 Q
"RTN","PSODOSU2")
0^81^B79224153
"RTN","PSODOSU2",1,0)
PSODOSU2 ;BIR/RTR - Dose Check Utility routine continued ;11/18/08
"RTN","PSODOSU2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**251**;DEC 1997;Build 202
"RTN","PSODOSU2",3,0)
 ;
"RTN","PSODOSU2",4,0)
DOSE ;
"RTN","PSODOSU2",5,0)
 S PSODSEQ="" F  S PSODSEQ=$O(^TMP($J,"PSOPDOSN","OUT",PSODSEQ)) Q:PSODSEQ=""  S PSODLNN1="" F  S PSODLNN1=$O(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1)) Q:PSODLNN1=""  S PSODLECT=0 D
"RTN","PSODOSU2",6,0)
 .F PSODLERA=0:0 S PSODLERA=$O(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1,"ERROR",PSODLERA)) Q:'PSODLERA  S PSODLECT=PSODLECT+1 D
"RTN","PSODOSU2",7,0)
 ..F PSODLERX="MSG","TEXT" S PSODLERB=$G(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1,"ERROR",PSODLERA,PSODLERX)) D
"RTN","PSODOSU2",8,0)
 ...S PSODLERZ=0 Q:PSODLERB=""  D HD I PSODLERF,PSODLERX="MSG" W:'PSODLQT ! D HD
"RTN","PSODOSU2",9,0)
 ...I 'PSODLERF W:'PSODLQT !
"RTN","PSODOSU2",10,0)
 ...S PSODLERF=1 D HD I PSODLERZ W:'PSODLQT !
"RTN","PSODOSU2",11,0)
 ...S PSODLERR=1 D HD W:'PSODLQT&(PSODLECT>1) ! N X,DIWL,DIWR,DIWF,PSODELXR,PSODELXF
"RTN","PSODOSU2",12,0)
 ...D HD S PSOCPXG=$P(PSODLNN1,";",4) I '$G(PSOCPXRR(PSOCPXG))&(PSOCPXB>1) D SUB^PSODOSUT W:'PSODLQT&('PSODLERZ) !
"RTN","PSODOSU2",13,0)
 ...D HD W:'PSODLQT&(PSODLECT'>1)&(PSODLERX="TEXT") ! S X=PSODLERB,DIWL=1,DIWR=$S(PSODLERX="MSG":76,1:74) K ^UTILITY($J,"W") D ^DIWP
"RTN","PSODOSU2",14,0)
 ...S PSODELXF=0 F PSODELXR=0:0 S PSODELXR=$O(^UTILITY($J,"W",DIWL,PSODELXR)) Q:'PSODELXR  D HD W:PSODELXF&('PSODLQT) ! D HD W:'PSODLQT $S(PSODLERX="MSG":"   ",1:"     ")_$G(^UTILITY($J,"W",DIWL,PSODELXR,0)) D SFD^PSODOSUT
"RTN","PSODOSU2",15,0)
 ...K ^UTILITY($J,"W")
"RTN","PSODOSU2",16,0)
 .D EXCEPT^PSODOSUT
"RTN","PSODOSU2",17,0)
 .D HD W:PSODLERF&('PSODLQT)&('$D(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1,"EXCEPTIONS")))&('$D(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1,"MESSAGE"))) ! S (PSODLERZ,PSODLERF)=0
"RTN","PSODOSU2",18,0)
 .F PSODLERA=0:0 S PSODLERA=$O(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1,"EXCEPTIONS",PSODLERA)) Q:'PSODLERA  D
"RTN","PSODOSU2",19,0)
 ..S PSODLERB=$G(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1,"EXCEPTIONS",PSODLERA)) D SBAD^PSODOSUT
"RTN","PSODOSU2",20,0)
 ..Q:PSODLERB=""  D HD I 'PSODLERF W:'PSODLQT !
"RTN","PSODOSU2",21,0)
 ..S PSODLERF=1 D HD S PSODLALZ=1 D HD
"RTN","PSODOSU2",22,0)
 ..S PSOCPXG=$P(PSODLNN1,";",4) I '$G(PSOCPXRR(PSOCPXG)),PSOCPXB>1 D HD W:'PSODLQT&(PSODLERZ) ! D SUB^PSODOSUT
"RTN","PSODOSU2",23,0)
 ..D HD W:'PSODLQT ! N X,DIWL,DIWR,DIWF,DIWL,PSODELXR,PSODELXF S PSODLEXR=1
"RTN","PSODOSU2",24,0)
 ..S DIWL=4,DIWR=76 K ^UTILITY($J,"W")
"RTN","PSODOSU2",25,0)
 ..S X=PSODLERB D ^DIWP D HD I PSODLERB["Range Check Error Summary",PSODLERZ W:'PSODLQT ! D HD
"RTN","PSODOSU2",26,0)
 ..S PSODELXF=0 F PSODELXR=0:0 S PSODELXR=$O(^UTILITY($J,"W",DIWL,PSODELXR)) Q:'PSODELXR  D HD W:PSODELXF&('PSODLQT) !?13 D HD W:'PSODLQT "   "_$G(^UTILITY($J,"W",DIWL,PSODELXR,0)) S (PSODELXF,PSODLERZ)=1
"RTN","PSODOSU2",27,0)
 ..K ^UTILITY($J,"W")
"RTN","PSODOSU2",28,0)
 .S PSODLFLG=0 I $$FEED^PSODOSUT D HD W:'PSODLQT !
"RTN","PSODOSU2",29,0)
 .S PSODLPL="" F  S PSODLPL=$O(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1,"MESSAGE",PSODLPL)) Q:PSODLPL=""  D
"RTN","PSODOSU2",30,0)
 ..F PSODLP1=0:0 S PSODLP1=$O(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1,"MESSAGE",PSODLPL,PSODLP1)) Q:'PSODLP1  D
"RTN","PSODOSU2",31,0)
 ...S PSODLMSG=$G(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1,"MESSAGE",PSODLPL,PSODLP1))
"RTN","PSODOSU2",32,0)
 ...Q:PSODLMSG=""  D HD I 'PSODLFLG W:'PSODLQT !
"RTN","PSODOSU2",33,0)
 ...S PSODLFLG=1 S PSODLEXR=0
"RTN","PSODOSU2",34,0)
 ...I PSODLPL="1_SINGLE" S PSODLINS=1
"RTN","PSODOSU2",35,0)
 ...I PSODLPL="2_RANGE" S PSODLINR=1
"RTN","PSODOSU2",36,0)
 ...;I '$G(PSOCPXF)&($G(PSOCOPY)!($D(PSORENW))) S PSOCPXG=$P(PSODLNN1,";",4) D SUMM^PSODOSUT
"RTN","PSODOSU2",37,0)
 ...S PSOCPXG=$P(PSODLNN1,";",4) D HD D:'$G(PSOCPXRR(PSOCPXG)) SUB^PSODOSUT D
"RTN","PSODOSU2",38,0)
 ....I $G(PSOCPXRR(PSOCPXG))&$P(PSODLNN1,";",5)'="" K PSODAILY
"RTN","PSODOSU2",39,0)
 ....I PSODLPL="2_RANGE",'$G(PSODAILY) D DAILY^PSODOSUT I PSOCPXG'=PSOCPXB K PSODAILY
"RTN","PSODOSU2",40,0)
 ....D HD W:'PSODLQT ! N X,DIWL,DIWR,DIWF,PSODELXR,PSODELXF S X=PSODLMSG,DIWL=1,DIWR=76 K ^UTILITY($J,"W") D ^DIWP
"RTN","PSODOSU2",41,0)
 ....S PSODELXF=0 F PSODELXR=0:0 S PSODELXR=$O(^UTILITY($J,"W",DIWL,PSODELXR)) Q:'PSODELXR  D HD W:PSODELXF&('PSODLQT) ! D HD W:'PSODLQT "   "_$G(^UTILITY($J,"W",DIWL,PSODELXR,0)) S PSODELXF=1
"RTN","PSODOSU2",42,0)
 ....K ^UTILITY($J,"W")
"RTN","PSODOSU2",43,0)
 ....D HD I 'PSODLQT S PSODELNX=$O(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1)) I '$P($G(PSODELNX),";",5)!($P($G(PSODELNX),";",4)'=PSOCPXG) W !
"RTN","PSODOSU2",44,0)
 Q
"RTN","PSODOSU2",45,0)
 ;
"RTN","PSODOSU2",46,0)
DOSEX ;
"RTN","PSODOSU2",47,0)
 S PSODSEQ="" F  S PSODSEQ=$O(^TMP($J,"PSOPDOSN","OUT",PSODSEQ)) Q:PSODSEQ=""  S PSODLQT=0 S PSODLNN1="" F  S PSODLNN1=$O(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1)) Q:PSODLNN1=""  D:$P(PSODLNN1,";",4)=PSODLXNT
"RTN","PSODOSU2",48,0)
 .F PSODLERA=0:0 S PSODLERA=$O(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1,"ERROR",PSODLERA)) Q:'PSODLERA  D
"RTN","PSODOSU2",49,0)
 ..F PSODLERX="MSG","TEXT" S PSODLERB=$G(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1,"ERROR",PSODLERA,PSODLERX)) D
"RTN","PSODOSU2",50,0)
 ...S PSODLERZ=0 I PSODLERB="" Q
"RTN","PSODOSU2",51,0)
 ...D HD I PSODLERF,PSODLERX="MSG" W:'PSODLQT ! D HD I 'PSODLERF W:'PSODLQT !
"RTN","PSODOSU2",52,0)
 ...S PSODLERF=1 D HD I PSODLERZ W:'PSODLQT !
"RTN","PSODOSU2",53,0)
 ...S PSODLERR=1 D HD W:'PSODLQT ! N X,DIWL,DIWR,DIWF,PSODELXR,PSODELXF S X=PSODLERB,DIWL=1,DIWR=$S(PSODLERX="MSG":76,1:74) K ^UTILITY($J,"W") D ^DIWP
"RTN","PSODOSU2",54,0)
 ...S PSODELXF=0 F PSODELXR=0:0 S PSODELXR=$O(^UTILITY($J,"W",DIWL,PSODELXR)) Q:'PSODELXR  D HD W:PSODELXF&('PSODLQT) ! D HD W:'PSODLQT $S(PSODLERX="MSG":"   ",1:"     ")_$G(^UTILITY($J,"W",DIWL,PSODELXR,0)) D SFD^PSODOSUT
"RTN","PSODOSU2",55,0)
 ...K ^UTILITY($J,"W")
"RTN","PSODOSU2",56,0)
 .D EXCEPT^PSODOSUT S (PSODLERZ,PSODLERF)=0
"RTN","PSODOSU2",57,0)
 .F PSODLERA=0:0 S PSODLERA=$O(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1,"EXCEPTIONS",PSODLERA)) Q:'PSODLERA  D
"RTN","PSODOSU2",58,0)
 ..S PSODLERB=$G(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1,"EXCEPTIONS",PSODLERA)) D SBAD^PSODOSUT:PSODLERB'=""
"RTN","PSODOSU2",59,0)
 ..Q:PSODLERB=""  D HD I 'PSODLERF W:'PSODLQT !
"RTN","PSODOSU2",60,0)
 ..S PSODLERF=1 D HD S PSODLALZ=1 D HD W:'PSODLQT ! N X,DIWL,DIWR,DIWF,PSODELXR,PSODELXF S DIWL=1,DIWR=76 K ^UTILITY($J,"W")
"RTN","PSODOSU2",61,0)
 ..S X=PSODLERB D ^DIWP S X=PSODLERB,DIWL=1,DIWR=76 K ^UTILITY($J,"W") D ^DIWP I PSODLERB["Range Check Error Summary",PSODLERZ W:'PSODLQT ! D HD
"RTN","PSODOSU2",62,0)
 ..S PSODELXF=0 F PSODELXR=0:0 S PSODELXR=$O(^UTILITY($J,"W",DIWL,PSODELXR)) Q:'PSODELXR  D HD W:PSODELXF&('PSODLQT) !?13 D HD W:'PSODLQT "   "_$G(^UTILITY($J,"W",DIWL,PSODELXR,0)) S (PSODELXF,PSODLERZ)=1
"RTN","PSODOSU2",63,0)
 ..K ^UTILITY($J,"W")
"RTN","PSODOSU2",64,0)
 .S PSODLFLG=0,PSODLPL="" F  S PSODLPL=$O(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1,"MESSAGE",PSODLPL)) Q:PSODLPL=""  D
"RTN","PSODOSU2",65,0)
 ..F PSODLP1=0:0 S PSODLP1=$O(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1,"MESSAGE",PSODLPL,PSODLP1)) Q:'PSODLP1  D
"RTN","PSODOSU2",66,0)
 ...S PSODLMSG=$G(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1,"MESSAGE",PSODLPL,PSODLP1))
"RTN","PSODOSU2",67,0)
 ...Q:PSODLMSG=""  D HD I 'PSODLFLG W:'PSODLQT !
"RTN","PSODOSU2",68,0)
 ...S PSODLFLG=1 I PSODLPL="1_SINGLE" S PSODLINS=1
"RTN","PSODOSU2",69,0)
 ...I PSODLPL="2_RANGE" S PSODLINR=1 S:PSODLPL="2_RANGE" PSODLINR=1 D
"RTN","PSODOSU2",70,0)
 ...D HD W:'PSODLQT ! N X,DIWL,DIWR,DIWF,PSODELXR,PSODELXF S X=PSODLMSG,DIWL=1,DIWR=76 K ^UTILITY($J,"W") D ^DIWP D
"RTN","PSODOSU2",71,0)
 ....S PSODELXF=0 F PSODELXR=0:0 S PSODELXR=$O(^UTILITY($J,"W",DIWL,PSODELXR)) Q:'PSODELXR  D HD W:PSODELXF&('PSODLQT) ! D HD W:'PSODLQT "   "_$G(^UTILITY($J,"W",DIWL,PSODELXR,0)) S PSODELXF=1
"RTN","PSODOSU2",72,0)
 ....K ^UTILITY($J,"W") D HD I 'PSODLQT S PSODELNX=$O(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1)) I '$P($G(PSODELNX),";",5) W !
"RTN","PSODOSU2",73,0)
 Q
"RTN","PSODOSU2",74,0)
 ;
"RTN","PSODOSU2",75,0)
DOSEZ ;
"RTN","PSODOSU2",76,0)
 S PSODSEQ="" F  S PSODSEQ=$O(^TMP($J,"PSOPDOSN","OUT",PSODSEQ)) Q:PSODSEQ=""  S PSODLQT=0 K PSOCPXRR S PSODLNN1="" F  S PSODLNN1=$O(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1)) Q:PSODLNN1=""  S PSODLECT=0 D
"RTN","PSODOSU2",77,0)
 .F PSODLERA=0:0 S PSODLERA=$O(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1,"ERROR",PSODLERA)) Q:'PSODLERA  S PSODLECT=PSODLECT+1 D
"RTN","PSODOSU2",78,0)
 ..F PSODLERX="MSG","TEXT" S PSODLERB=$G(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1,"ERROR",PSODLERA,PSODLERX)) D
"RTN","PSODOSU2",79,0)
 ...S PSODLERZ=0 I PSODLERB="" Q
"RTN","PSODOSU2",80,0)
 ...I PSOCPXC D HD I PSODLERF,PSODLERX="MSG" W:'PSODLQT ! D HD
"RTN","PSODOSU2",81,0)
 ...I 'PSODLERF W:'PSODLQT&(PSOCPXC) !
"RTN","PSODOSU2",82,0)
 ...S PSODLERF=1 D:PSOCPXC HD I PSODLERZ W:'PSODLQT&(PSOCPXC) !
"RTN","PSODOSU2",83,0)
 ...S PSODLERR=1 D:PSOCPXC
"RTN","PSODOSU2",84,0)
 ....D HD W:'PSODLQT&(PSODLECT>1) ! N X,DIWL,DIWR,DIWF,PSODELXR,PSODELXF
"RTN","PSODOSU2",85,0)
 ....D:PSOCPXC HD D:'PSOCPXF&(PSOCPXC) SUMM^PSODOSUT
"RTN","PSODOSU2",86,0)
 ....D:PSOCPXC HD S PSOCPXG=$P(PSODLNN1,";",4) I PSOCPXC&('$G(PSOCPXRR(PSOCPXG))) D SUB^PSODOSUT W:'PSODLQT&('PSODLERZ) !
"RTN","PSODOSU2",87,0)
 ....D:PSOCPXC HD W:'PSODLQT&(PSODLECT'>1)&(PSODLERX="TEXT")&(PSOCPXC) ! S X=PSODLERB,DIWL=1,DIWR=$S(PSODLERX="MSG":76,1:74) K ^UTILITY($J,"W") D ^DIWP
"RTN","PSODOSU2",88,0)
 ....S PSODELXF=0 F PSODELXR=0:0 S PSODELXR=$O(^UTILITY($J,"W",DIWL,PSODELXR)) Q:'PSODELXR  D:PSOCPXC HD W:PSODELXF&('PSODLQT) ! D:PSOCPXC HD W:'$G(PSODLQT) $S(PSODLERX="MSG":"   ",1:"     ")_$G(^UTILITY($J,"W",DIWL,PSODELXR,0)) D SFD^PSODOSUT
"RTN","PSODOSU2",89,0)
 ....K ^UTILITY($J,"W")
"RTN","PSODOSU2",90,0)
 .D EXCEPT^PSODOSUT
"RTN","PSODOSU2",91,0)
 .D:PSOCPXC HD W:PSODLERF&(PSOCPXC)&('PSODLQT)&('$D(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1,"EXCEPTIONS")))&('$D(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1,"MESSAGE"))) ! S (PSODLERZ,PSODLERF,PSODLESM)=0 ;do i NEED TO INITILIZE THE FIRST TWO
"RTN","PSODOSU2",92,0)
 .F PSODLERA=0:0 S PSODLERA=$O(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1,"EXCEPTIONS",PSODLERA)) Q:'PSODLERA  D
"RTN","PSODOSU2",93,0)
 ..S PSODLERB=$G(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1,"EXCEPTIONS",PSODLERA)) D SBAD^PSODOSUT:PSODLERB'=""
"RTN","PSODOSU2",94,0)
 ..Q:PSODLERB=""  D:PSOCPXC HD I 'PSODLERF W:'PSODLQT&(PSOCPXC) !
"RTN","PSODOSU2",95,0)
 ..S PSODLERF=1 D:PSOCPXC HD S PSODLALZ=1
"RTN","PSODOSU2",96,0)
 ..D:PSOCPXC
"RTN","PSODOSU2",97,0)
 ...D HD I 'PSOCPXF&(PSOCPXC) D SUMM^PSODOSUT D HD
"RTN","PSODOSU2",98,0)
 ...S PSOCPXG=$P(PSODLNN1,";",4) I PSOCPXC&('$G(PSOCPXRR(PSOCPXG))) D HD W:'PSODLQT&(PSOCPXC)&(PSODLESM) ! D SUB^PSODOSUT
"RTN","PSODOSU2",99,0)
 ...S PSODLESM=1 D HD W:'PSODLQT ! N X,DIWL,DIWR,DIWF,DIWL,PSODELXR,PSODELXF S PSODLEXR=1 S DIWL=1,DIWR=76 K ^UTILITY($J,"W")
"RTN","PSODOSU2",100,0)
 ...S X=PSODLERB D ^DIWP D HD I PSODLERB["Range Check Error Summary",PSODLERZ W:'PSODLQT ! D HD
"RTN","PSODOSU2",101,0)
 ...S X=PSODLERB,DIWL=1,DIWR=76 K ^UTILITY($J,"W") D ^DIWP I PSODLERB["Range Check Error Summary",PSODLERZ W:'PSODLQT ! D HD
"RTN","PSODOSU2",102,0)
 ...S PSODELXF=0 F PSODELXR=0:0 S PSODELXR=$O(^UTILITY($J,"W",DIWL,PSODELXR)) Q:'PSODELXR  D HD W:PSODELXF&('PSODLQT) !?13 D HD W:'PSODLQT "   "_$G(^UTILITY($J,"W",DIWL,PSODELXR,0)) S (PSODELXF,PSODLERZ)=1
"RTN","PSODOSU2",103,0)
 ...K ^UTILITY($J,"W")
"RTN","PSODOSU2",104,0)
 .S PSODLFLG=0 I $$FEED^PSODOSUT&(PSOCPXC) D HD W:'PSODLQT !
"RTN","PSODOSU2",105,0)
 .S PSODLPL="" F  S PSODLPL=$O(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1,"MESSAGE",PSODLPL)) Q:PSODLPL=""  D
"RTN","PSODOSU2",106,0)
 ..F PSODLP1=0:0 S PSODLP1=$O(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1,"MESSAGE",PSODLPL,PSODLP1)) Q:'PSODLP1  D
"RTN","PSODOSU2",107,0)
 ...S PSODLMSG=$G(^TMP($J,"PSOPDOSN","OUT",PSODSEQ,PSODLNN1,"MESSAGE",PSODLPL,PSODLP1))
"RTN","PSODOSU2",108,0)
 ...Q:PSODLMSG=""  D:PSOCPXC HD I 'PSODLFLG W:'PSODLQT&(PSOCPXC)&(PSOCPXF) !
"RTN","PSODOSU2",109,0)
 ...S PSODLFLG=1 S PSODLEXR=0
"RTN","PSODOSU2",110,0)
 ...I PSODLPL="1_SINGLE" S PSODLINS=1
"RTN","PSODOSU2",111,0)
 ...I PSODLPL="2_RANGE" S PSODLINR=1 S:PSODLPL="2_RANGE" PSODLINR=1 D
"RTN","PSODOSU2",112,0)
 ....Q:'PSODLQT&(PSOCPXC)&(PSODLESM)  I PSOCPXF&(PSOCPXC) K PSODAILY
"RTN","PSODOSU2",113,0)
 ...D:PSOCPXC HD D COMPLEX^PSODOSUT
"RTN","PSODOSU2",114,0)
 Q
"RTN","PSODOSU2",115,0)
 ;
"RTN","PSODOSU2",116,0)
HD ;
"RTN","PSODOSU2",117,0)
 I PSODLQT!(($Y+5)'>IOSL) Q
"RTN","PSODOSU2",118,0)
 N DIR,DTOUT,DUOUT,DIRUT,DIROUT,X,Y
"RTN","PSODOSU2",119,0)
 W ! K DIR,Y S DIR(0)="E",DIR("A")="Press Return to continue,'^' to exit" D ^DIR K DIR I 'Y S PSODLQT=1 Q
"RTN","PSODOSU2",120,0)
 W @IOF W !
"RTN","PSODOSU2",121,0)
 Q
"RTN","PSODOSU2",122,0)
MESG ;Write out System error heading
"RTN","PSODOSU2",123,0)
 I 'PSODLQT D HD W "Dosing Checks could not be performed:",!
"RTN","PSODOSU2",124,0)
 Q
"RTN","PSODOSUN")
0^51^B34559589
"RTN","PSODOSUN",1,0)
PSODOSUN ;BIR/RTR - Dose Check Utility routine ;11/18/08
"RTN","PSODOSUN",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**251**;DEC 1997;Build 202
"RTN","PSODOSUN",3,0)
DOSE() ;Write Dose output for renew, finish, copy, etc.
"RTN","PSODOSUN",4,0)
 N PSODLINS,PSODLINR,PSODLERA,PSODLERB,PSODLERF,PSODLERZ,PSODLPL,PSODLP1,PSODLMSG,PSODLFLG,PSODLALZ,DIR,DUOUT,DTOUT,DIROUT,DIRUT,X,Y,X1,PSODLNN1,PSODLERR,PSODLERX,PSODLQT,PSOCPXG,PSOCPXRR,PSODLEXR,PSODELNX,PSODLECT
"RTN","PSODOSUN",5,0)
 S (PSODLERF,PSODLERZ,PSODLALZ,PSODLINS,PSODLINR,PSODLERR,PSODLQT,PSOCPXG)=0
"RTN","PSODOSUN",6,0)
 W @IOF I $P($G(^TMP($J,"PSOPDOSN","OUT",0)),"^")=-1 D  S PSODLFLG=0,PSODLERR=1 G END
"RTN","PSODOSUN",7,0)
 .D HD N X,DIWL,DIWR,DIWF,PSODELXR,PSODELXF D MESG
"RTN","PSODOSUN",8,0)
 .S X="Reason: "_$P(^TMP($J,"PSOPDOSN","OUT",0),"^",2),DIWL=1,DIWR=76 K ^UTILITY($J,"W") D ^DIWP
"RTN","PSODOSUN",9,0)
 .S PSODELXF=0 F PSODELXR=0:0 S PSODELXR=$O(^UTILITY($J,"W",DIWL,PSODELXR)) Q:'PSODELXR  D HD W:PSODELXF&('PSODLQT) ! D HD W:'PSODLQT "   "_$G(^UTILITY($J,"W",DIWL,PSODELXR,0)) S PSODELXF=1
"RTN","PSODOSUN",10,0)
 .K ^UTILITY($J,"W")
"RTN","PSODOSUN",11,0)
 ;PSOCPXB = Number of Dosing Seq
"RTN","PSODOSUN",12,0)
 S PSODLQT=0 K PSOCPXRR
"RTN","PSODOSUN",13,0)
 D DOSE^PSODOSU2
"RTN","PSODOSUN",14,0)
END ;
"RTN","PSODOSUN",15,0)
 I 'PSODLALZ,'$G(PSODLFLG),'PSODLERR Q 0
"RTN","PSODOSUN",16,0)
 I 'PSODLFLG W !
"RTN","PSODOSUN",17,0)
 K PSODAILY,DIR,Y S DIR("B")="Y",DIR(0)="Y",DIR("A")="Do you want to Continue" D ^DIR K DIR
"RTN","PSODOSUN",18,0)
 I Y'=1!($D(DTOUT))!($D(DUOUT)) Q 1
"RTN","PSODOSUN",19,0)
 I '$G(PSODLINS)&'$G(PSODLINR) Q 0
"RTN","PSODOSUN",20,0)
 I '$D(^XUSEC("PSORPH",DUZ)) Q 2_"^"_$$EVAL(PSODLINS,PSODLINR)
"RTN","PSODOSUN",21,0)
 W !!,"Do you want to Process medication",! K DIR,Y S DIR("B")="P",DIR(0)="SA^1:PROCESS MEDICATION;0:CANCEL MEDICATION"
"RTN","PSODOSUN",22,0)
 S DIR("A")=$P($G(^PSDRUG(PSODRUG("IEN"),0)),"^")_": "
"RTN","PSODOSUN",23,0)
 S DIR("?",1)="Enter '1' or 'P' to Process Medication",DIR("?",2)="enter '0' or 'C' to Cancel Medication"
"RTN","PSODOSUN",24,0)
 D ^DIR K DIR
"RTN","PSODOSUN",25,0)
 I Y=0 Q 3_"^"_$S($G(PSODLINS)&($G(PSODLINR)):"MAX SINGLE DOSE & DAILY DOSE RANGE",$G(PSODLINS):"MAX SINGLE DOSE",$G(PSODLINR):"DAILY DOSE RANGE",1:"UNKNOWN")  ;need to know if user cancelled or not
"RTN","PSODOSUN",26,0)
 I Y'=1!($D(DTOUT))!($D(DUOUT)) Q 1
"RTN","PSODOSUN",27,0)
 D SIG^XUSESIG I $G(X1)="" Q 1
"RTN","PSODOSUN",28,0)
END2 ;
"RTN","PSODOSUN",29,0)
 Q 2_"^"_$S($G(PSODLINS)&($G(PSODLINR)):"MAX SINGLE DOSE & DAILY DOSE RANGE",$G(PSODLINS):"MAX SINGLE DOSE",$G(PSODLINR):"DAILY DOSE RANGE",1:"UNKNOWN")
"RTN","PSODOSUN",30,0)
 ;
"RTN","PSODOSUN",31,0)
EVAL(PSODLINS,PSODLINR) ;
"RTN","PSODOSUN",32,0)
 Q $S($G(PSODLINS)&($G(PSODLINR)):"MAX SINGLE DOSE & DAILY DOSE RANGE",$G(PSODLINS):"MAX SINGLE DOSE",$G(PSODLINR):"DAILY DOSE RANGE",1:"UNKNOWN")
"RTN","PSODOSUN",33,0)
 ;
"RTN","PSODOSUN",34,0)
DOSEX(PSODLXNT) ;Write Dose exceptions for order entry/edit
"RTN","PSODOSUN",35,0)
 N PSODLINS,PSODLINR,PSODLERA,PSODLERB,PSODLERF,PSODLERZ,PSODLPL,PSODLP1,PSODLMSG,PSODLFLG,PSODLALZ,DIR,DUOUT,DTOUT,DIROUT,DIRUT,X,Y,X1,PSODLNN1,PSODLERR,PSODLERX,PSODLQT,PSODELNX
"RTN","PSODOSUN",36,0)
 W @IOF S (PSODLERF,PSODLERZ,PSODLALZ,PSODLINS,PSODLINR,PSODLERR,PSODLQT)=0
"RTN","PSODOSUN",37,0)
 I $P($G(^TMP($J,"PSOPDOSN","OUT",0)),"^")=-1 D  S PSODLFLG=0,PSODLERR=1 G ENDX
"RTN","PSODOSUN",38,0)
 .D HD N X,DIWL,DIWR,DIWF,PSODELXR,PSODELXF D MESG
"RTN","PSODOSUN",39,0)
 .S X="Reason: "_$P(^TMP($J,"PSOPDOSN","OUT",0),"^",2),DIWL=1,DIWR=76 K ^UTILITY($J,"W") D ^DIWP
"RTN","PSODOSUN",40,0)
 .S PSODELXF=0 F PSODELXR=0:0 S PSODELXR=$O(^UTILITY($J,"W",DIWL,PSODELXR)) Q:'PSODELXR  D HD W:PSODELXF&('PSODLQT) ! D HD W:'PSODLQT "   "_$G(^UTILITY($J,"W",DIWL,PSODELXR,0)) S PSODELXF=1
"RTN","PSODOSUN",41,0)
 .K ^UTILITY($J,"W")
"RTN","PSODOSUN",42,0)
 D DOSEX^PSODOSU2
"RTN","PSODOSUN",43,0)
ENDX ;
"RTN","PSODOSUN",44,0)
 K PSOCPXRR
"RTN","PSODOSUN",45,0)
 I 'PSODLALZ,'$G(PSODLFLG),'PSODLERR Q 0
"RTN","PSODOSUN",46,0)
 I 'PSODLFLG W !
"RTN","PSODOSUN",47,0)
 I '$D(^XUSEC("PSORPH",DUZ)),$G(PSODLINS)!($G(PSODLINR))  Q 2_"^"_$$EVAL(PSODLINS,PSODLINR)
"RTN","PSODOSUN",48,0)
 Q:$G(PSOCPXV) 0
"RTN","PSODOSUN",49,0)
 I $G(PSODLBD4)&'$G(PSODLINS)&'$G(PSODLINR) S Y=1 G ENDX2
"RTN","PSODOSUN",50,0)
 K DIR,Y S DIR("B")="Y",DIR(0)="Y",DIR("A")="Do you want to Continue" D ^DIR K DIR
"RTN","PSODOSUN",51,0)
ENDX2 ;
"RTN","PSODOSUN",52,0)
 I Y'=1!($D(DTOUT))!($D(DUOUT)) Q 1
"RTN","PSODOSUN",53,0)
 W !
"RTN","PSODOSUN",54,0)
 Q 0
"RTN","PSODOSUN",55,0)
DOSEZ() ;Write Dose output summary for complex orders
"RTN","PSODOSUN",56,0)
 N PSOCPXF,PSOCPXC,PSOCPXRR,PSOCPXG,PSODLESM,PSODELNX,PSOCPXH
"RTN","PSODOSUN",57,0)
 N PSODLINS,PSODLINR,PSODLERA,PSODLERB,PSODLERF,PSODLERZ,PSODLPL,PSODLP1,PSODLMSG,PSODLFLG,PSODLALZ,DIR,DUOUT,DTOUT,DIROUT,DIRUT,X,Y,X1,PSODLNN1,PSODLERR,PSODLERX,PSODLQT,PSODLEXR,PSODLECT
"RTN","PSODOSUN",58,0)
 I '$G(PSOTOF) W @IOF
"RTN","PSODOSUN",59,0)
 S (PSODLERF,PSODLERZ,PSODLALZ,PSODLINS,PSODLINR,PSODLERR,PSOCPXF,PSOCPXC,PSODLQT,PSOCPXH)=0
"RTN","PSODOSUN",60,0)
 I PSOCPXB>3 S PSOCPXC=1
"RTN","PSODOSUN",61,0)
 I $P($G(^TMP($J,"PSOPDOSN","OUT",0)),"^")=-1 S PSODLQT=1 D  S PSODLFLG=0,PSODLERR=1 G ENDZ
"RTN","PSODOSUN",62,0)
 .D:PSOCPXC HD W:'PSODLQT&(PSOCPXC) !! N X,DIWL,DIWR,DIWF,PSODELXR,PSODELXF D MESG
"RTN","PSODOSUN",63,0)
 .S X="Reason: "_$P(^TMP($J,"PSOPDOSN","OUT",0),"^",2),DIWL=1,DIWR=76 K ^UTILITY($J,"W") D ^DIWP
"RTN","PSODOSUN",64,0)
 .S PSODELXF=0 F PSODELXR=0:0 S PSODELXR=$O(^UTILITY($J,"W",DIWL,PSODELXR)) Q:'PSODELXR  D:PSOCPXC HD W:PSODELXF&('PSODLQT)&(PSOCPXC) ! D:PSOCPXC HD W:'PSODLQT&(PSOCPXC) "   "_$G(^UTILITY($J,"W",DIWL,PSODELXR,0)) S PSODELXF=1
"RTN","PSODOSUN",65,0)
 .K ^UTILITY($J,"W")
"RTN","PSODOSUN",66,0)
 D DOSEZ^PSODOSU2
"RTN","PSODOSUN",67,0)
ENDZ ;
"RTN","PSODOSUN",68,0)
 K PSODAILY I 'PSODLALZ,'$G(PSODLFLG),'PSODLERR Q 0
"RTN","PSODOSUN",69,0)
 I 'PSODLFLG W !
"RTN","PSODOSUN",70,0)
 I '$G(PSODLINS)&('$G(PSODLINR)) Q 0
"RTN","PSODOSUN",71,0)
 K DIR,Y S DIR("B")="Y",DIR(0)="Y",DIR("A")="Do you want to Continue" D ^DIR K DIR
"RTN","PSODOSUN",72,0)
 I Y'=1!($D(DTOUT))!($D(DUOUT)) Q 1
"RTN","PSODOSUN",73,0)
 I '$D(^XUSEC("PSORPH",DUZ)),$G(PSODLINS)!($G(PSODLINR))  Q 2_"^"_$$EVAL(PSODLINS,PSODLINR)
"RTN","PSODOSUN",74,0)
 G ENDZ2:$G(PSORX("EDIT"))!$G(PSOCKCON)!$G(PSOEDDOS)!($G(PSOCOPY)&$G(PSODLBD4))
"RTN","PSODOSUN",75,0)
 W !!,"Do you want to Process medication",! K DIR,Y S DIR("B")="P",DIR(0)="SA^1:PROCESS MEDICATION;0:CANCEL MEDICATION"
"RTN","PSODOSUN",76,0)
 S DIR("A")=$P($G(^PSDRUG(PSODRUG("IEN"),0)),"^")_": "
"RTN","PSODOSUN",77,0)
 S DIR("?",1)="Enter '1' or 'P' to Process Medication",DIR("?",2)="enter '0' or 'C' to Cancel Medication"
"RTN","PSODOSUN",78,0)
 D ^DIR K DIR
"RTN","PSODOSUN",79,0)
 I Y'=1!($D(DTOUT))!($D(DUOUT)) Q 1
"RTN","PSODOSUN",80,0)
 D SIG^XUSESIG I $G(X1)="" Q 1
"RTN","PSODOSUN",81,0)
ENDZ2 ;
"RTN","PSODOSUN",82,0)
 Q 2_"^"_$S($G(PSODLINS)&($G(PSODLINR)):"MAX SINGLE DOSE & DAILY DOSE RANGE",$G(PSODLINS):"MAX SINGLE DOSE",$G(PSODLINR):"DAILY DOSE RANGE",1:"UNKNOWN")
"RTN","PSODOSUN",83,0)
HD ;
"RTN","PSODOSUN",84,0)
 I PSODLQT!(($Y+5)'>IOSL) Q
"RTN","PSODOSUN",85,0)
 N DIR,DTOUT,DUOUT,DIRUT,DIROUT,X,Y
"RTN","PSODOSUN",86,0)
 W ! K DIR,Y S DIR(0)="E",DIR("A")="Press Return to continue,'^' to exit" D ^DIR K DIR I 'Y S PSODLQT=1 Q
"RTN","PSODOSUN",87,0)
 W @IOF W !
"RTN","PSODOSUN",88,0)
 Q
"RTN","PSODOSUN",89,0)
MESG ;Write out System error heading
"RTN","PSODOSUN",90,0)
 I 'PSODLQT D HD W "Dosing Checks could not be performed:",!
"RTN","PSODOSUN",91,0)
 Q
"RTN","PSODOSUN",92,0)
 ;
"RTN","PSODOSUT")
0^38^B107545070
"RTN","PSODOSUT",1,0)
PSODOSUT ;BIR/RTR - PRE Dose Check Utility routine ;11/18/08
"RTN","PSODOSUT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**251**;DEC 1997;Build 202
"RTN","PSODOSUT",3,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5424
"RTN","PSODOSUT",4,0)
 ;
"RTN","PSODOSUT",5,0)
 ;DOSE expect PSODLQT to be defined prior to calling it.
"RTN","PSODOSUT",6,0)
 ; PSODLQT=1 means no data will be written to the screen, but a value will be returned.
"RTN","PSODOSUT",7,0)
 ; PSODLQT=0 means data will be written to the screen and a value is returned 
"RTN","PSODOSUT",8,0)
 ;
"RTN","PSODOSUT",9,0)
EVAL(PSODLINS,PSODLINR) ;
"RTN","PSODOSUT",10,0)
 Q $S($G(PSODLINS)&($G(PSODLINR)):"MAX SINGLE DOSE & DAILY DOSE RANGE",$G(PSODLINS):"MAX SINGLE DOSE",$G(PSODLINR):"DAILY DOSE RANGE",1:"UNKNOWN")
"RTN","PSODOSUT",11,0)
 ;
"RTN","PSODOSUT",12,0)
SUMM ;
"RTN","PSODOSUT",13,0)
 I 'PSODLQT W !,"   DOSING CHECK SUMMARY:",!!
"RTN","PSODOSUT",14,0)
 S PSOCPXF=1
"RTN","PSODOSUT",15,0)
 Q
"RTN","PSODOSUT",16,0)
 ;
"RTN","PSODOSUT",17,0)
SUB ;Write sub header; called from PSODOSUN
"RTN","PSODOSUT",18,0)
 ;I $G(PSOCOPY)!($D(PSORENW)) Q:PSOCPXG=PSOCPXB&(PSODLPL="2_RANGE")
"RTN","PSODOSUT",19,0)
 D HD I 'PSODLQT,$G(PSODLEXR) W ! S PSODLEXR=0
"RTN","PSODOSUT",20,0)
 D HD
"RTN","PSODOSUT",21,0)
 I 'PSODLQT W "   DOSE SEQ "_PSOCPXG_":"
"RTN","PSODOSUT",22,0)
 S PSOCPXRR(PSOCPXG)=1
"RTN","PSODOSUT",23,0)
 Q
"RTN","PSODOSUT",24,0)
 ;
"RTN","PSODOSUT",25,0)
DAILY ;
"RTN","PSODOSUT",26,0)
 I 'PSODLQT W:'$G(PSORENW)!($G(PSOCOPY))!($G(PSORXED)) ! W "   DAILY DOSE RANGE WARNING:"
"RTN","PSODOSUT",27,0)
 S PSODAILY=1
"RTN","PSODOSUT",28,0)
 Q
"RTN","PSODOSUT",29,0)
 ;
"RTN","PSODOSUT",30,0)
COMPLEX ;called from DOSEZ^PSODOSUN
"RTN","PSODOSUT",31,0)
 I 'PSOCPXF&(PSOCPXC) S PSOCPXG=$P(PSODLNN1,";",4) D SUMM K PSODAILY S:PSOCPXC&(PSOCPXG=PSOCPXB) PSOCPXH=1
"RTN","PSODOSUT",32,0)
 I PSOCPXC S PSOCPXG=$P(PSODLNN1,";",4) D HD D
"RTN","PSODOSUT",33,0)
 .I $G(PSOCPXRR(PSOCPXG))&$P(PSODLNN1,";",5)'="" K PSODAILY
"RTN","PSODOSUT",34,0)
 .I '$G(PSOCPXRR(PSOCPXG))&('$G(PSOCPXH)) D SUB I $G(PSOCOPY)!($G(PSORENW)) S:PSOCPXC&(PSOCPXG=PSOCPXB) PSOCPXH=1
"RTN","PSODOSUT",35,0)
 .I PSODLPL="2_RANGE"&PSODLINR&'$G(PSODAILY) D DAILY
"RTN","PSODOSUT",36,0)
 .D HD W:'PSODLQT ! N X,DIWL,DIWR,DIWF S X=PSODLMSG,DIWL=1,DIWR=76 K ^UTILITY($J,"W") D ^DIWP
"RTN","PSODOSUT",37,0)
 .N PSODELXF,PSODELXR S PSODELXF=0 F PSODELXR=0:0 S PSODELXR=$O(^UTILITY($J,"W",DIWL,PSODELXR)) Q:'PSODELXR  D HD W:PSODELXF&('PSODLQT) ! D HD W:'PSODLQT "   "_$G(^UTILITY($J,"W",DIWL,PSODELXR,0)) S PSODELXF=1
"RTN","PSODOSUT",38,0)
 .K ^UTILITY($J,"W")
"RTN","PSODOSUT",39,0)
 .D HD I 'PSODLQT S PSODELNX=$O(^TMP($J,"PSOPDOSN","OUT",PSODLNN1)) I '$P($G(PSODELNX),";",5)!($P($G(PSODELNX),";",4)'=PSOCPXG) W !
"RTN","PSODOSUT",40,0)
 Q
"RTN","PSODOSUT",41,0)
 ;
"RTN","PSODOSUT",42,0)
HD ;
"RTN","PSODOSUT",43,0)
 I $G(PSODLQT) Q
"RTN","PSODOSUT",44,0)
 I PSODLQT!(($Y+5)'>IOSL) Q
"RTN","PSODOSUT",45,0)
 N DIR,DTOUT,DUOUT,DIRUT,DIROUT,X,Y
"RTN","PSODOSUT",46,0)
 W ! K DIR,Y S DIR(0)="E",DIR("A")="Press Return to continue,'^' to exit" D ^DIR K DIR I 'Y S PSODLQT=1 Q
"RTN","PSODOSUT",47,0)
 W @IOF W !
"RTN","PSODOSUT",48,0)
 Q
"RTN","PSODOSUT",49,0)
 ;
"RTN","PSODOSUT",50,0)
SFD ;
"RTN","PSODOSUT",51,0)
 S PSODELXF=1 S:PSODLERX="TEXT" PSODLERZ=1
"RTN","PSODOSUT",52,0)
 Q
"RTN","PSODOSUT",53,0)
 ;
"RTN","PSODOSUT",54,0)
SBAD ;Set Bad Drug flag just in case not set in enhanced check, possibly because Dosage edits are done first
"RTN","PSODOSUT",55,0)
 N PSODLBD1,PSODLBD3
"RTN","PSODOSUT",56,0)
 I PSODLERB["GCNSEQNO"!(PSODLERB["Drug not matched to NDF") D
"RTN","PSODOSUT",57,0)
 .S PSODLBD1=$O(^TMP($J,"PSOPDOSA","OUT","EXCEPTIONS","DOSE",PSODLNN1,"")) I PSODLBD1 D
"RTN","PSODOSUT",58,0)
 ..S PSODLBD3=$P($G(^TMP($J,"PSOPDOSA","OUT","EXCEPTIONS","DOSE",PSODLNN1,PSODLBD1)),"^",3) I PSODLBD3 S PSODRUG("BAD",PSODLBD3)=1
"RTN","PSODOSUT",59,0)
 Q
"RTN","PSODOSUT",60,0)
 ;
"RTN","PSODOSUT",61,0)
EXCEPT ;don't show "not matched to NDF" or "no GCNSEQNO" errors for dosing
"RTN","PSODOSUT",62,0)
 N PSODLER1,PSODLER2
"RTN","PSODOSUT",63,0)
 F PSODLER1=0:0 S PSODLER1=$O(^TMP($J,"PSOPDOSN","OUT",PSODLNN1,"EXCEPTIONS",PSODLER1)) Q:'PSODLER1  D
"RTN","PSODOSUT",64,0)
 .S PSODLER2=$G(^TMP($J,"PSOPDOSN","OUT",PSODLNN1,"EXCEPTIONS",PSODLER1))
"RTN","PSODOSUT",65,0)
 .I PSODLER2["Drug not matched to NDF"!(PSODLER2["GCNSEQNO") K ^TMP($J,"PSOPDOSN","OUT",PSODLNN1,"EXCEPTIONS",PSODLER1)
"RTN","PSODOSUT",66,0)
 S PSODLER1=1 I '$O(^TMP($J,"PSOPDOSN","OUT",PSODLNN1,"EXCEPTIONS",PSODLER1)) K ^TMP($J,"PSOPDOSN","OUT",PSODLNN1,"EXCEPTIONS",1)
"RTN","PSODOSUT",67,0)
 Q
"RTN","PSODOSUT",68,0)
 ;
"RTN","PSODOSUT",69,0)
FEED() ; Write Line feed after Exceptions if no message globals follow, and next order has no errors or exceptions, only a message
"RTN","PSODOSUT",70,0)
 I PSODLQT Q 0
"RTN","PSODOSUT",71,0)
 N PSODLNN2
"RTN","PSODOSUT",72,0)
 I $D(^TMP($J,"PSOPDOSN","OUT",PSODLNN1,"MESSAGE")) Q 0
"RTN","PSODOSUT",73,0)
 S PSODLNN2=$O(^TMP($J,"PSOPDOSN","OUT",PSODLNN1))
"RTN","PSODOSUT",74,0)
 I PSODLNN2="" Q 0
"RTN","PSODOSUT",75,0)
 I $D(^TMP($J,"PSOPDOSN","OUT",PSODLNN2,"ERROR")) Q 0
"RTN","PSODOSUT",76,0)
 I $D(^TMP($J,"PSOPDOSN","OUT",PSODLNN2,"EXCEPTIONS")) Q 0
"RTN","PSODOSUT",77,0)
 Q 1
"RTN","PSODOSUT",78,0)
 ;
"RTN","PSODOSUT",79,0)
DCHKL(MSG) ;Dose check; called from PSOLLL8 and PSOLLLI ;returns dose value
"RTN","PSODOSUT",80,0)
 N PSODRUG,PSODOSF,PSOVERFL
"RTN","PSODOSUT",81,0)
 I '$D(PSODRUG("IEN")) S PSODRUG("IEN")=$$GET1^DIQ(52,RX,6,"I")
"RTN","PSODOSUT",82,0)
 Q:$$EXMT^PSSDSAPI(PSODRUG("IEN")) ""
"RTN","PSODOSUT",83,0)
 Q:$G(PSODRUG("BAD",PSODRUG("IEN"))) ""
"RTN","PSODOSUT",84,0)
 S PSOCPXB=0,PSOVERFL=1
"RTN","PSODOSUT",85,0)
 F PSOCPXA=0:0 S PSOCPXA=$O(^PSRX(RX,6,PSOCPXA)) Q:'PSOCPXA  I $P($G(^PSRX(RX,6,PSOCPXA,0)),"^")'="" S PSOCPXB=PSOCPXB+1
"RTN","PSODOSUT",86,0)
 D RX^PSODOSCL(.PSODLBS1,RX)
"RTN","PSODOSUT",87,0)
 S PSODLNNN=RX,PSODLQT=1  ;PSODLQT should be set to 1 so that nothing is displayed
"RTN","PSODOSUT",88,0)
 S PSODLNVL=$$DOSE^PSODOSUN K ^TMP($J,"PSOPDOSN"),^TMP($J,"PSOPDOSA") I $P($G(PSODLNVL),"^")=1 S PSORX("DFLG")=1 Q MSG
"RTN","PSODOSUT",89,0)
 I '$G(PSODLNVL) Q ""
"RTN","PSODOSUT",90,0)
 S PSODLNVT=$P(PSODLNVL,"^",2)
"RTN","PSODOSUT",91,0)
 S MSG=PSODLNVT
"RTN","PSODOSUT",92,0)
 Q MSG
"RTN","PSODOSUT",93,0)
 ;
"RTN","PSODOSUT",94,0)
DCHKN ;Called from PSOORNEW, PSOORNE1 & PSOORNEW; Dose Check for Copying an Order
"RTN","PSODOSUT",95,0)
 F PSOCPXA=0:0 S PSOCPXA=$O(PSONEW("DOSE",PSOCPXA)) Q:'PSOCPXA  S PSOCPXB=PSOCPXB+1
"RTN","PSODOSUT",96,0)
 D FIN^PSODOSCL(.PSODLBS1,.PSONEW,.PSODRUG)
"RTN","PSODOSUT",97,0)
 S PSODLNVL=$$DOSE^PSODOSUN K ^TMP($J,"PSOPDOSN") K ^TMP($J,"PSOPDOSA")
"RTN","PSODOSUT",98,0)
 I $P($G(PSODLNVL),"^")=1 S PSORX("DFLG")=1 Q
"RTN","PSODOSUT",99,0)
 I '$G(PSODLNVL) Q
"RTN","PSODOSUT",100,0)
 I '$D(^XUSEC("PSORPH",DUZ)) S:$P($G(PSODLNVL),"^") ^TMP("PSODOSF",$J,0)=1 Q
"RTN","PSODOSUT",101,0)
 S PSODLNVT=$P(PSODLNVL,"^",2)
"RTN","PSODOSUT",102,0)
 I +PSODLNVL=3 S PSORX("DFLG")=1 Q
"RTN","PSODOSUT",103,0)
 ;I +PSODLNVL=3 D CANCEL(PSONEW("OIRXN")) Q  ;CR2724
"RTN","PSODOSUT",104,0)
 I $$EN3^PSORXI(PSODLNVT) W !!,"Unable to log intervention, cannot find intervention type.",! K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSODOSUT",105,0)
 Q
"RTN","PSODOSUT",106,0)
 ;
"RTN","PSODOSUT",107,0)
DCHKR ;Renewal Dose Check; Called from PSORENW0
"RTN","PSODOSUT",108,0)
 F PSOCPXA=0:0 S PSOCPXA=$O(PSORENW("DOSE",PSOCPXA)) Q:'PSOCPXA  S PSOCPXB=PSOCPXB+1
"RTN","PSODOSUT",109,0)
 D FIN^PSODOSCL(.PSODLBS1,.PSORENW,.PSODRUG)
"RTN","PSODOSUT",110,0)
 S PSODLNVL=$$DOSE^PSODOSUN
"RTN","PSODOSUT",111,0)
 I '$D(^XUSEC("PSORPH",DUZ)) S:$P($G(PSODLNVL),"^") ^TMP("PSODOSF",$J,0)=1
"RTN","PSODOSUT",112,0)
 K ^TMP($J,"PSOPDOSN") K ^TMP($J,"PSOPDOSA") I $P($G(PSODLNVL),"^")=1 S PSORX("DFLG")=1 Q
"RTN","PSODOSUT",113,0)
 D DOSIV
"RTN","PSODOSUT",114,0)
 Q
"RTN","PSODOSUT",115,0)
 ;
"RTN","PSODOSUT",116,0)
DCHKC ;Dose Check on reinstate; Called from PSOCAN2
"RTN","PSODOSUT",117,0)
 I '$D(PSODRUG("IEN")) S:$D(PSORENW("OIRXN")) PSODRUG("IEN")=$$GET1^DIQ(52,PSORENW("OIRXN"),6,"I")
"RTN","PSODOSUT",118,0)
 F PSOCPXA=0:0 S PSOCPXA=$O(^PSRX(PSORENW("OIRXN"),6,PSOCPXA)) Q:'PSOCPXA  I $P($G(^PSRX(PSORENW("OIRXN"),6,PSOCPXA,0)),"^")'="" S PSOCPXB=PSOCPXB+1
"RTN","PSODOSUT",119,0)
 D RX^PSODOSCL(.PSODLBS1,PSORENW("OIRXN"))
"RTN","PSODOSUT",120,0)
 S PSODLNNN=PSORENW("OIRXN")
"RTN","PSODOSUT",121,0)
 S PSODLNVL=$$DOSE^PSODOSUN K ^TMP($J,"PSOPDOSN"),^TMP($J,"PSOPDOSA")
"RTN","PSODOSUT",122,0)
 I $P($G(PSODLNVL),"^")=1 S PSORX("DFLG")=1 Q
"RTN","PSODOSUT",123,0)
 D DOSIV
"RTN","PSODOSUT",124,0)
 I +PSODLNVL=3 S PSORX("DFLG")=1
"RTN","PSODOSUT",125,0)
 Q
"RTN","PSODOSUT",126,0)
 ;
"RTN","PSODOSUT",127,0)
DCHK() ;Dose check after entering Null at the conjunction prompt
"RTN","PSODOSUT",128,0)
 ;For complex Dosing, they will eventually enter null too, so change to call if it was not a complex order, and null was entered
"RTN","PSODOSUT",129,0)
 Q:$G(PSORX("DFLG")) 0
"RTN","PSODOSUT",130,0)
 D HD^PSODDPR2():(($Y+5)>IOSL)
"RTN","PSODOSUT",131,0)
 N PSODLNNN,PSODLENT,PSODLNVL,PSODLNVT,X,Y,DIR,DTOUT,DUOUT,DIRUT,DIROUT,PSODLBS1,PSODLENT,PSOCPXA,PSOCPXV,PSOTOF,PSOCPXB
"RTN","PSODOSUT",132,0)
 ;Need to make sure Drug Name is what you set in the API
"RTN","PSODOSUT",133,0)
 ;Either pass in name here, or set in PSODOSCL to array name that PSSDSAPD uses, which is still the .01 of File 50
"RTN","PSODOSUT",134,0)
 I $$EXMT^PSSDSAPI(PSODRUG("IEN")) Q 0
"RTN","PSODOSUT",135,0)
 I $G(PSODRUG("BAD",PSODRUG("IEN"))) Q 0
"RTN","PSODOSUT",136,0)
 ;Currently only one prospective drug at a time for Outpatient Dose Check
"RTN","PSODOSUT",137,0)
 ;S PSODLNNN="O;1;PROSPECTIVE;1"
"RTN","PSODOSUT",138,0)
 K ^TMP("PSODOSF",$J)
"RTN","PSODOSUT",139,0)
 K ^TMP($J,"PSOPDOSA") K ^TMP($J,"PSOPDOSN") S PSODLBS1(1)="PSOPDOSA",PSODLBS1(3)="PSOPDOSN"
"RTN","PSODOSUT",140,0)
 D FIN^PSODOSCL(.PSODLBS1,.PSORXED,.PSODRUG)
"RTN","PSODOSUT",141,0)
 S PSODLENT=ENT,PSOCPXV=1,PSOCPXB=0
"RTN","PSODOSUT",142,0)
 ;F PSOCPXA=0:0 S PSOCPXA=$O(PSONEW("DOSE",PSOCPXA)) Q:'PSOCPXA  S PSOCPXB=PSOCPXB+1
"RTN","PSODOSUT",143,0)
 S PSODLNVL=$$DOSEX^PSODOSUN(PSODLENT) S PSOTOF=1 I '$D(^XUSEC("PSORPH",DUZ)) S:$P($G(PSODLNVL),"^") ^TMP("PSODOSF",$J,0)=1
"RTN","PSODOSUT",144,0)
 D HD^PSODDPR2():(($Y+5)>IOSL)
"RTN","PSODOSUT",145,0)
 I $P($G(PSODLNVL),"^")=1 K ^TMP($J,"PSOPDOSA") K ^TMP($J,"PSOPDOSN") Q 1
"RTN","PSODOSUT",146,0)
DCHK2 ;Finishing of a complex order
"RTN","PSODOSUT",147,0)
 N PSOCPXC
"RTN","PSODOSUT",148,0)
 K PSODLNVL
"RTN","PSODOSUT",149,0)
 S (PSOCPXA,PSOCPXB)=0
"RTN","PSODOSUT",150,0)
 F PSOCPXA=0:0 S PSOCPXA=$O(PSONEW("DOSE",PSOCPXA)) Q:'PSOCPXA  S PSOCPXB=PSOCPXB+1
"RTN","PSODOSUT",151,0)
 S PSODLNVL=$$DOSEZ^PSODOSUN K ^TMP($J,"PSOPDOSA") K ^TMP($J,"PSOPDOSN")
"RTN","PSODOSUT",152,0)
 D HD^PSODDPR2():(($Y+5)>IOSL)
"RTN","PSODOSUT",153,0)
 I $P($G(PSODLNVL),"^")=1 Q 1
"RTN","PSODOSUT",154,0)
 I '$D(^XUSEC("PSORPH",DUZ)) S:$P($G(PSODLNVL),"^")=2 ^TMP("PSODOSF",$J,0)=$$CONVMSG($P(PSODLNVL,"^",2)) W ! Q 0
"RTN","PSODOSUT",155,0)
 I '$G(PSODLNVL) Q 0
"RTN","PSODOSUT",156,0)
 S PSODLNVT=$P(PSODLNVL,"^",2)
"RTN","PSODOSUT",157,0)
 I $D(PSORX("EDIT"))!($G(PSOCKCON))!$G(PSOEDDOS)!($G(PSOCOPY)&$G(PSODLBD4)) Q 0
"RTN","PSODOSUT",158,0)
 I $$EN3^PSORXI(PSODLNVT) W !!,"Unable to log intervention, cannot find intervention type.",! K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSODOSUT",159,0)
 W !
"RTN","PSODOSUT",160,0)
 Q 0
"RTN","PSODOSUT",161,0)
 ;
"RTN","PSODOSUT",162,0)
DCHK1 ;Dose check after entering a value at the Conjunction prompt
"RTN","PSODOSUT",163,0)
 Q:$G(PSORX("DFLG"))!($G(PSODLQT))
"RTN","PSODOSUT",164,0)
 I '$$DS^PSSDSAPI Q
"RTN","PSODOSUT",165,0)
 D HD^PSODDPR2():(($Y+5)>IOSL)
"RTN","PSODOSUT",166,0)
 N PSODLNNN,PSODLNVL,PSODLNVT,X,Y,DIR,DTOUT,DUOUT,DIRUT,DIROUT,PSODLBS1,PSODLENT
"RTN","PSODOSUT",167,0)
 ;Need to make sure Drug Name is what you set in the API
"RTN","PSODOSUT",168,0)
 ;Either pass in name here, or set in PSODOSCL to array name that PSSDSAPD uses, which is still the .01 of File 50
"RTN","PSODOSUT",169,0)
 I $$EXMT^PSSDSAPI(PSODRUG("IEN")) Q
"RTN","PSODOSUT",170,0)
 I $G(PSODRUG("BAD",PSODRUG("IEN"))) Q
"RTN","PSODOSUT",171,0)
 ;Currently only one prospective drug at a time for Outpatient Dose Check
"RTN","PSODOSUT",172,0)
 ;S PSODLNNN="O;1;PROSPECTIVE;1"
"RTN","PSODOSUT",173,0)
 K ^TMP($J,"PSOPDOSA") K ^TMP($J,"PSOPDOSN") S PSODLBS1(1)="PSOPDOSA",PSODLBS1(3)="PSOPDOSN"
"RTN","PSODOSUT",174,0)
 D FIN^PSODOSCL(.PSODLBS1,.PSORXED,.PSODRUG)
"RTN","PSODOSUT",175,0)
 S PSODLENT=ENT
"RTN","PSODOSUT",176,0)
 S PSODLNVL=$$DOSEX^PSODOSUN(PSODLENT)
"RTN","PSODOSUT",177,0)
 D HD^PSODDPR2():(($Y+5)>IOSL)
"RTN","PSODOSUT",178,0)
 K ^TMP($J,"PSOPDOSA") K ^TMP($J,"PSOPDOSN") I $P($G(PSODLNVL),"^")=1 S PSORXED("DFLG")=1 Q
"RTN","PSODOSUT",179,0)
 I '$G(PSODLNVL) Q
"RTN","PSODOSUT",180,0)
 I '$D(^XUSEC("PSORPH",DUZ)) S:$P($G(PSODLNVL),"^")=2 ^TMP("PSODOSF",$J,0)=$$CONVMSG($P(PSODLNVL,"^",2)) W ! Q
"RTN","PSODOSUT",181,0)
 S PSODLNVT=$P(PSODLNVL,"^",2)
"RTN","PSODOSUT",182,0)
 I $$EN3^PSORXI(PSODLNVT) W !!,"Unable to log intervention, cannot find intervention type.",! K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSODOSUT",183,0)
 W !
"RTN","PSODOSUT",184,0)
 Q
"RTN","PSODOSUT",185,0)
 ;
"RTN","PSODOSUT",186,0)
CONVMSG(MESS) ;Convert DOSE CHECK message to numeric value for field 8 of ^PS(52.4
"RTN","PSODOSUT",187,0)
 N PSODOSF
"RTN","PSODOSUT",188,0)
 S PSODOSF=$S(MESS="MAX SINGLE DOSE & DAILY DOSE RANGE":3,MESS="MAX SINGLE DOSE":2,MESS="DAILY DOSE RANGE":1,1:"")
"RTN","PSODOSUT",189,0)
 Q PSODOSF
"RTN","PSODOSUT",190,0)
 ;
"RTN","PSODOSUT",191,0)
DCHKV ;Dose check when verifying an order
"RTN","PSODOSUT",192,0)
 N PSODOSF,PSOLINE,PSOVERFL,PSOVCAN
"RTN","PSODOSUT",193,0)
 S PSOVERFL=1
"RTN","PSODOSUT",194,0)
 F PSOCPXA=0:0 S PSOCPXA=$O(^PSRX(PSONV,6,PSOCPXA)) Q:'PSOCPXA  I $P($G(^PSRX(PSONV,6,PSOCPXA,0)),"^")'="" S PSOCPXB=PSOCPXB+1
"RTN","PSODOSUT",195,0)
 D RX^PSODOSCL(.PSODLBS1,PSONV)
"RTN","PSODOSUT",196,0)
 S $P(PSOLINE,"-",79)="-"
"RTN","PSODOSUT",197,0)
 S PSODLNNN=PSONV
"RTN","PSODOSUT",198,0)
 S PSODLNVL=$$DOSE^PSODOSUN K ^TMP($J,"PSOPDOSN") K ^TMP($J,"PSOPDOSA") I $P($G(PSODLNVL),"^")=1 S PSORX("DFLG")=1 Q
"RTN","PSODOSUT",199,0)
 I '$D(^XUSEC("PSORPH",DUZ)) S:$P($G(PSODLNVL),"^")=2 ^TMP("PSODOSF",$J,0)=$$CONVMSG($P(PSODLNVL,"^",2))
"RTN","PSODOSUT",200,0)
 I '$G(PSODLNVL) Q
"RTN","PSODOSUT",201,0)
 I +PSODLNVL=3 D  Q:PSOVCAN
"RTN","PSODOSUT",202,0)
 . D SIG^XUSESIG I X1="" S (PSORX("DFLG"),PSVERFLG)=1 Q
"RTN","PSODOSUT",203,0)
 . D NOOR^PSOCAN4
"RTN","PSODOSUT",204,0)
 . I $G(DIRUT) D UPOUT^PSODGDG1,KILL^PSODGDG1 K PSONORR,PSORX("INTERVENE") Q
"RTN","PSODOSUT",205,0)
 . S PSOVCAN=1
"RTN","PSODOSUT",206,0)
 . S DA=PSONV D RXV^PSODGDG1 S DA=PSONV D INV^PSODGDG1 S DA=PSONV D PSDEL^PSODGDG1,DEL^PSODGDG1
"RTN","PSODOSUT",207,0)
 . K DIK,LST,PSONOOR S PSVERFLG=1
"RTN","PSODOSUT",208,0)
 S PSODLNVT=$P(PSODLNVL,"^",2),PSODOSF=1
"RTN","PSODOSUT",209,0)
 I +PSODLNVL=3 S PSORX("DFLG")=1 Q
"RTN","PSODOSUT",210,0)
 S DA=PSONV,RX=$G(^PSRX(PSONV,0)) D DOSIV  ;CRI^PSODGDG1
"RTN","PSODOSUT",211,0)
 Q
"RTN","PSODOSUT",212,0)
 ;
"RTN","PSODOSUT",213,0)
DOSIV ;DOSE INTERVETION
"RTN","PSODOSUT",214,0)
 I PSOFROM="C",'$D(^XUSEC("PSORPH",DUZ)) Q
"RTN","PSODOSUT",215,0)
 I '$D(^XUSEC("PSORPH",DUZ)) S:$P($G(PSODLNVL),"^")=2 ^TMP("PSODOSF",$J,0)=$$CONVMSG($P(PSODLNVL,"^",2)) Q
"RTN","PSODOSUT",216,0)
 I '$G(PSODLNVL) Q
"RTN","PSODOSUT",217,0)
 S PSODLNVT=$P(PSODLNVL,"^",2)
"RTN","PSODOSUT",218,0)
DOSIV1 ;
"RTN","PSODOSUT",219,0)
 I $$EN3^PSORXI(PSODLNVT) D
"RTN","PSODOSUT",220,0)
 . W !!,"Unable to log intervention, cannot find intervention type.",!
"RTN","PSODOSUT",221,0)
 . K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSODOSUT",222,0)
 Q
"RTN","PSODOSUT",223,0)
 ;
"RTN","PSODOSUT",224,0)
CANCEL(PSONV) ;CR2724 -  where PSONV = RXIEN 
"RTN","PSODOSUT",225,0)
 D SIG^XUSESIG I X1="" S PSORX("DFLG")=1 Q
"RTN","PSODOSUT",226,0)
 D NOOR^PSOCAN4
"RTN","PSODOSUT",227,0)
 I $G(DIRUT) D UPOUT^PSODGDG1,KILL^PSODGDG1 K PSONORR,PSORX("INTERVENE") Q
"RTN","PSODOSUT",228,0)
 S DA=PSONV D INV^PSODGDG1 S DA=PSONV D PSDEL^PSODGDG1,DEL^PSODGDG1
"RTN","PSODOSUT",229,0)
 K DIK,LST,PSONOOR
"RTN","PSODOSUT",230,0)
 Q
"RTN","PSODOSUT",231,0)
 ;
"RTN","PSODOSUT",232,0)
DOSCK(PSOFROM,MSG) ;
"RTN","PSODOSUT",233,0)
 I $G(PSORX("DFLG"))!($G(PSODOSD)) S PSORX("DFLG")=1 K PSODOSD Q
"RTN","PSODOSUT",234,0)
 N PSODLNNN,PSODLNVL,PSODLNVT,X,Y,DIR,DTOUT,DUOUT,DIRUT,DIROUT,PSODLBS1,PSOCPXA,PSOCPXB,PSOCPXC
"RTN","PSODOSUT",235,0)
 Q:$$EXMT^PSSDSAPI(PSODRUG("IEN"))
"RTN","PSODOSUT",236,0)
 Q:$G(PSODRUG("BAD",PSODRUG("IEN")))
"RTN","PSODOSUT",237,0)
 K ^TMP($J,"PSOPDOSN"),^TMP($J,"PSOPDOSA"),^TMP("PSODOSF",$J) S PSODLBS1(1)="PSOPDOSA",PSODLBS1(3)="PSOPDOSN"
"RTN","PSODOSUT",238,0)
 D HD^PSODDPR2() I ($D(DTOUT))!($D(DUOUT))!($G(DIRUT))!(PSODLQT) K PSODLQT,DTOUT,DUOUT,DIRUT,PSORX("DFLG") Q
"RTN","PSODOSUT",239,0)
 ;D CLEAR^VALM1
"RTN","PSODOSUT",240,0)
 S PSOCPXB=0
"RTN","PSODOSUT",241,0)
 I PSOFROM="V" D DCHKV Q  ;PSOVER1 - verification 
"RTN","PSODOSUT",242,0)
 I PSOFROM="N" D DCHKN Q  ;PSOORNE1 & PSOORNEW - new & copy
"RTN","PSODOSUT",243,0)
 I PSOFROM="R" D DCHKR Q  ;PSORENW0 - renewal
"RTN","PSODOSUT",244,0)
 I PSOFROM="C" D DCHKC Q  ;PSOCAN2 - cancel
"RTN","PSODOSUT",245,0)
 Q
"RTN","PSODRDU2")
0^20^B21988780
"RTN","PSODRDU2",1,0)
PSODRDU2 ;BHAM ISC/SAB - dup drug/class display for outpatient orders ;9/23/97 8:40am
"RTN","PSODRDU2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**132,251**;DEC 1997;Build 202
"RTN","PSODRDU2",3,0)
 ;External reference ^PS(50.7 - 2223
"RTN","PSODRDU2",4,0)
 ;External reference ^PS(50.606 - 2174
"RTN","PSODRDU2",5,0)
 ;External reference ^PSDRUG( - 221
"RTN","PSODRDU2",6,0)
 ;External reference to ^PS(55 - 2228
"RTN","PSODRDU2",7,0)
EN(PSODFN,ORN,LIST) ;psodfn=patient's ifn, orn=ordertype;order#;drugtype;counter
"RTN","PSODRDU2",8,0)
 N DUPRXO,I,ISSD,J,BSIG,RFLS,RXREC,ST,PSONULN,LSTFL
"RTN","PSODRDU2",9,0)
 S $P(PSONULN,"-",79)="-"
"RTN","PSODRDU2",10,0)
 I $P(ORN,";")="O" G RX
"RTN","PSODRDU2",11,0)
 I $P(ORN,";")="P" G PND
"RTN","PSODRDU2",12,0)
 I $P(ORN,";")="N" G NVA
"RTN","PSODRDU2",13,0)
 I $P(ORN,";")="R" G RDI
"RTN","PSODRDU2",14,0)
 Q
"RTN","PSODRDU2",15,0)
RX ;Rx info
"RTN","PSODRDU2",16,0)
 Q:'$D(^PSRX($P(ORN,";",2),0))  N ISSD,LSTFLD S RXREC=$P(ORN,";",2)
"RTN","PSODRDU2",17,0)
 S DUPRX0=^PSRX(RXREC,0),RFLS=$P(DUPRX0,"^",9),ISSD=$P(^PSRX(RXREC,0),"^",13),ISSD=$E(ISSD,4,5)_"/"_$E(ISSD,6,7)_"/"_$E(ISSD,2,3)
"RTN","PSODRDU2",18,0)
 S LSTFL=(+^PSRX(RXREC,3)),LSTFL=$E(LSTFL,4,5)_"/"_$E(LSTFL,6,7)_"/"_$E(LSTFL,2,3),RX0=DUPRX0,RX2=^PSRX(RXREC,2)
"RTN","PSODRDU2",19,0)
 S STA="ACTIVE^NON-VERIFIED^REFILL^HOLD^DRUG INTERACTIONS^SUSPENDED^^^^^DONE^EXPIRED^DISCONTINUED^DELETED^DISCONTINUED BY PROVIDER^DISCONTINUED (EDIT)^HELD BY PROVIDER"
"RTN","PSODRDU2",20,0)
 S ST=$P(STA,"^",(+$P(^PSRX(RXREC,"STA"),"^")+1)) K STA
"RTN","PSODRDU2",21,0)
 W !,"Local Rx #"_$P(DUPRX0,"^")_" ("_ST_") for "_$P(^PSDRUG($P(DUPRX0,"^",6),0),"^")
"RTN","PSODRDU2",22,0)
 K FSIG,BSIG I $P($G(^PSRX(RXREC,"SIG")),"^",2) D FSIG^PSOUTLA("R",RXREC,60) F PSREV=1:1 Q:'$D(FSIG(PSREV))  S BSIG(PSREV)=FSIG(PSREV)
"RTN","PSODRDU2",23,0)
 K FSIG,PSREV I '$P($G(^PSRX(RXREC,"SIG")),"^",2) D EN2^PSOUTLA1(RXREC,60)
"RTN","PSODRDU2",24,0)
 W !,"SIG: "_$G(BSIG(1)) I $O(BSIG(1)) F PSREV=1:0 S PSREV=$O(BSIG(PSREV)) Q:'PSREV  W !?20,$G(BSIG(PSREV))
"RTN","PSODRDU2",25,0)
 D PRSTAT(RXREC) W !
"RTN","PSODRDU2",26,0)
 Q
"RTN","PSODRDU2",27,0)
PND ;op pending orders
"RTN","PSODRDU2",28,0)
 Q:'$D(^PS(52.41,$P(ORN,";",2),0))
"RTN","PSODRDU2",29,0)
 N DUPRX0,FSIG
"RTN","PSODRDU2",30,0)
 S DUPRX0=^PS(52.41,$P(ORN,";",2),0)
"RTN","PSODRDU2",31,0)
 W !,"Pending Outpatient Drug for "_$S('$P(DUPRX0,"^",9):$P(^PS(50.7,$P(DUPRX0,"^",8),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^"),1:$P(^PSDRUG($P(DUPRX0,"^",9),0),"^"))
"RTN","PSODRDU2",32,0)
 D FSIG^PSOUTLA("P",$P(ORN,";",2),IOM-6)
"RTN","PSODRDU2",33,0)
 W !,"SIG: " F I=0:0 S I=$O(FSIG(I)) Q:'I  W FSIG(I),!?5
"RTN","PSODRDU2",34,0)
 Q
"RTN","PSODRDU2",35,0)
NVA ;non-va meds
"RTN","PSODRDU2",36,0)
 Q:'$D(^PS(55,PSODFN,"NVA",$P(ORN,";",2),0))
"RTN","PSODRDU2",37,0)
 S DUPRX0=^PS(55,PSODFN,"NVA",$P(ORN,";",2),0)
"RTN","PSODRDU2",38,0)
 W !,"NON-VA Med: "_$S('$P(DUPRX0,"^",2):$P(^PS(50.7,$P(DUPRX0,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^"),1:$P(^PSDRUG($P(DUPRX0,"^",2),0),"^")) ;_" (ACTIVE)"
"RTN","PSODRDU2",39,0)
 W !,"Dosage: "_$P(DUPRX0,"^",3),?25,"Schedule: "_$P(DUPRX0,"^",5)
"RTN","PSODRDU2",40,0)
 W !
"RTN","PSODRDU2",41,0)
 ;W !?3,"Date Documented: "_$E($P(DUPRX0,"^",10),4,5)_"/"_$E($P(DUPRX0,"^",10),6,7)_"/"_$E($P(DUPRX0,"^",10),2,3),?30,"Status: Active",!
"RTN","PSODRDU2",42,0)
 K DUPRX0
"RTN","PSODRDU2",43,0)
 Q
"RTN","PSODRDU2",44,0)
RDI ;RDI orders
"RTN","PSODRDU2",45,0)
 Q:'$D(^TMP($J,LIST,"OUT","REMOTE",$P(ORN,";",2)))
"RTN","PSODRDU2",46,0)
 S RXREC=^TMP($J,LIST,"OUT","REMOTE",$P(ORN,";",2))
"RTN","PSODRDU2",47,0)
 W !,"Remote Rx #"_$P(RXREC,"^",5)_" from "_$P(RXREC,"^")_" for "_$P(RXREC,"^",3)
"RTN","PSODRDU2",48,0)
 W !,"SIG: " S I="" F  S I=$O(^TMP($J,LIST,"OUT","REMOTE",$P(ORN,";",2),"SIG",I)) Q:I=""  W ^TMP($J,LIST,"OUT","REMOTE",$P(ORN,";",2),"SIG",I),!
"RTN","PSODRDU2",49,0)
 W "Last Filled On: "_$P(RXREC,"^",6),!
"RTN","PSODRDU2",50,0)
 K RXREC,I
"RTN","PSODRDU2",51,0)
 Q
"RTN","PSODRDU2",52,0)
PRSTAT(DA) ;Displays the prescription's status
"RTN","PSODRDU2",53,0)
 N PSOTRANS,PSOREL,PSOCMOP,RXPSTA,PSOX,RFLZRO,PSOLRD,PSORTS,CMOP
"RTN","PSODRDU2",54,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)  S RXPSTA="Processing Status: ",PSOLRD=$P($G(^PSRX(RXREC,2)),"^",13)
"RTN","PSODRDU2",55,0)
 D ^PSOCMOPA I $G(PSOCMOP)]"" D  K CMOP,PSOTRANS,PSOREL
"RTN","PSODRDU2",56,0)
 .S PSOTRANS=$E($P(PSOCMOP,"^",2),4,5)_"/"_$E($P(PSOCMOP,"^",2),6,7)_"/"_$E($P(PSOCMOP,"^",2),2,3)
"RTN","PSODRDU2",57,0)
 .S PSOREL=$S(CMOP("L")=0:$P($G(^PSRX(DA,2)),"^",13),1:$P(^PSRX(DA,1,CMOP("L"),0),"^",18))
"RTN","PSODRDU2",58,0)
 .S PSOREL=$E(PSOREL,4,5)_"/"_$E(PSOREL,6,7)_"/"_$E(PSOREL,2,3)_"@"_$E($P(PSOREL,".",2),1,4)
"RTN","PSODRDU2",59,0)
 .I '$D(IOINORM)!('$D(IOINHI)) S X="IORVOFF;IORVON;IOINHI;IOINORM" D ENDR^%ZISS
"RTN","PSODRDU2",60,0)
 .I $P($G(^PSRX(RXREC,"STA")),"^")=0 W:$$TRANCMOP^PSOUTL(RXREC) ?5,IORVON_IOINHI
"RTN","PSODRDU2",61,0)
 .W !,RXPSTA_$S($P(PSOCMOP,"^")=0!($P(PSOCMOP,"^")=2):"Transmitted to CMOP on "_PSOTRANS,$P(PSOCMOP,"^")=1:"Released by CMOP on "_PSOREL,1:"Not Dispensed"),IOINORM_IORVOFF
"RTN","PSODRDU2",62,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL) Q:$G(PSODLQT)
"RTN","PSODRDU2",63,0)
 I $G(PSOCMOP)']"" D
"RTN","PSODRDU2",64,0)
 .F PSOX=0:0 S PSOX=$O(^PSRX(RXREC,1,PSOX)) Q:'PSOX  D
"RTN","PSODRDU2",65,0)
 ..S RFLZRO=$G(^PSRX(RXREC,1,PSOX,0))
"RTN","PSODRDU2",66,0)
 ..S:$P(RFLZRO,"^",18)'="" PSOLRD=$P(RFLZRO,"^",18) I $P(RFLZRO,"^",16) S PSOLRD=PSOLRD_"^R",PSORTS=$P(RFLZRO,"^",16)
"RTN","PSODRDU2",67,0)
 .I '$O(^PSRX(RXREC,1,0)),$P(^PSRX(RXREC,2),"^",15) S PSOLRD=PSOLRD_"^R",PSORTS=$P(^PSRX(RXREC,2),"^",15)
"RTN","PSODRDU2",68,0)
 .W !,RXPSTA I +$G(PSORTS) W "Returned to stock on "_$$FMTE^XLFDT(PSORTS,2) Q
"RTN","PSODRDU2",69,0)
 .W $S(PSOLRD="":"Not released locally",1:"Released locally on "_$$FMTE^XLFDT($P(PSOLRD,"^"),2)_" "_$P(PSOLRD,"^",2))_$S($P(^PSRX(RXREC,0),"^",11)="W":" (Window)",1:" (Mail)")
"RTN","PSODRDU2",70,0)
 Q
"RTN","PSODRG")
0^27^B61621761
"RTN","PSODRG",1,0)
PSODRG ;IHS/DSD/JCM-ORDER ENTRY DRUG SELECTION ;03/30/93
"RTN","PSODRG",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**20,23,36,53,54,46,112,139,207,148,243,268,324,251**;DEC 1997;Build 202
"RTN","PSODRG",3,0)
 ;Reference ^PSDRUG supported by DBIA 221
"RTN","PSODRG",4,0)
 ;Reference ^PS(50.7 supported by DBIA 2223
"RTN","PSODRG",5,0)
 ;Reference to PSSDIN supported by DBIA 3166
"RTN","PSODRG",6,0)
 ;Reference to $$NDCFMT^PSSNDCUT supported by IA 4707
"RTN","PSODRG",7,0)
 ;Reference to OROCAPI supported by IA 5367
"RTN","PSODRG",8,0)
 ;Reference to $$OITM^ORX8 supported by IA 5469
"RTN","PSODRG",9,0)
 ;----------------------------------------------------------
"RTN","PSODRG",10,0)
START ;
"RTN","PSODRG",11,0)
 S (PSONEW("DFLG"),PSONEW("FIELD"),PSODRG("QFLG"))=0 K PSORX("DFLG")
"RTN","PSODRG",12,0)
 D @($S(+$G(PSOEDIT)=1&('$D(DA)):"SELECT^PSODRGN",1:"SELECT"))
"RTN","PSODRG",13,0)
 G:$G(PSORXED("DFLG")) END ; Select Drug
"RTN","PSODRG",14,0)
 I $G(PSORX("EDIT")),$G(PSOY),$G(PSODRUG("IEN"))=+PSOY D  G:$G(PSORXED("DFLG")) END
"RTN","PSODRG",15,0)
 . N NDC D NDC(+$G(PSORXED("IRXN")),0,+PSOY,.NDC) I $G(NDC)="^" S PSORXED("DFLG")=1 Q
"RTN","PSODRG",16,0)
 . I $G(NDC)'="" S (PSODRUG("NDC"),PSORXED("FLD",27))=NDC
"RTN","PSODRG",17,0)
 ;
"RTN","PSODRG",18,0)
 I $G(PSORX("EDIT"))]"",'PSONEW("FIELD") D TRADE
"RTN","PSODRG",19,0)
 G:$G(PSONEW("DFLG"))!($G(PSODRG("QFLG")))!($G(PSORXED("DFLG"))) END
"RTN","PSODRG",20,0)
 D SET ; Set various drug information
"RTN","PSODRG",21,0)
 D NFI ; Display dispense drug/orderable item text
"RTN","PSODRG",22,0)
 D:'$G(PSOEDIT) POST I $G(PSORX("DFLG")) S PSONEW("DFLG")=1 K:'$G(PSORX("EDIT")) PSORX("DFLG") ; Do any post selection action
"RTN","PSODRG",23,0)
END ;D EOJ
"RTN","PSODRG",24,0)
 Q
"RTN","PSODRG",25,0)
 ;------------------------------------------------------------
"RTN","PSODRG",26,0)
 ;
"RTN","PSODRG",27,0)
SELECT ;
"RTN","PSODRG",28,0)
 K:'$G(PSORXED) CLOZPAT
"RTN","PSODRG",29,0)
 K IT,DIC,X,Y,PSODRUG("TRADE NAME"),PSODRUG("NDC"),PSODRUG("DAW"),PSODRUG("BAD") S:$G(POERR)&($P($G(OR0),"^",9)) Y=$P(^PSDRUG($P(OR0,"^",9),0),"^")
"RTN","PSODRG",30,0)
 I $G(PSODRUG("IEN"))]"" S Y=PSODRUG("NAME"),PSONEW("OLD VAL")=PSODRUG("IEN")
"RTN","PSODRG",31,0)
 W !,"DRUG: "_$S($G(Y)]"":Y_"// ",1:"") R X:$S($D(DTIME):DTIME,1:300) I '$T S DTOUT=1
"RTN","PSODRG",32,0)
 I X="",$G(Y)]"" S:Y X=Y S:'X X=$G(PSODRUG("IEN")) S:X X="`"_X
"RTN","PSODRG",33,0)
 G:X="" SELECT
"RTN","PSODRG",34,0)
 I X?1."?" W !!,"Answer with DRUG NUMBER, or GENERIC NAME, or VA PRODUCT NAME, or",!,"NATIONAL DRUG CLASS, or SYNONYM" G SELECT
"RTN","PSODRG",35,0)
 I $G(PSORXED),X["^" S PSORXED("DFLG")=1 G SELECTX
"RTN","PSODRG",36,0)
 I X="^"!(X["^^")!($D(DTOUT)) S PSONEW("DFLG")=1 G SELECTX
"RTN","PSODRG",37,0)
 I '$G(POERR),X[U,$L(X)>1 S PSODIR("FLD")=PSONEW("FLD") D JUMP^PSODIR1 S:$G(PSODIR("FIELD")) PSONEW("FIELD")=PSODIR("FIELD") K PSODIR S PSODRG("QFLG")=1 G SELECTX
"RTN","PSODRG",38,0)
 S DIC=50,DIC(0)="EMQZVT",DIC("T")="",D="B^C^VAPN^VAC"
"RTN","PSODRG",39,0)
 S DIC("S")="I $S('$D(^PSDRUG(+Y,""I"")):1,'^(""I""):1,DT'>^(""I""):1,1:0),$S($P($G(^PSDRUG(+Y,2)),""^"",3)'[""O"":0,1:1),$D(^PSDRUG(""ASP"",+$G(^(2)),+Y))"
"RTN","PSODRG",40,0)
 D MIX^DIC1 K DIC,D
"RTN","PSODRG",41,0)
 I $D(DTOUT) S PSONEW("DFLG")=1 G SELECTX
"RTN","PSODRG",42,0)
 I $D(DUOUT) K DUOUT G SELECT
"RTN","PSODRG",43,0)
 I Y<0 G SELECT
"RTN","PSODRG",44,0)
 S:$G(PSONEW("OLD VAL"))=+Y&('$G(PSOEDIT)) PSODRG("QFLG")=1
"RTN","PSODRG",45,0)
 K PSOY S PSOY=Y,PSOY(0)=Y(0)
"RTN","PSODRG",46,0)
 I $P(PSOY(0),"^")="OTHER DRUG"!($P(PSOY(0),"^")="OUTSIDE DRUG") D TRADE
"RTN","PSODRG",47,0)
SELECTX K X,Y,DTOUT,DUOUT,PSONEW("OLD VAL")
"RTN","PSODRG",48,0)
 Q
"RTN","PSODRG",49,0)
 ;
"RTN","PSODRG",50,0)
NDC(RX,RFL,DRG,NDC) ; Editing NDC for ECME Released Rx's
"RTN","PSODRG",51,0)
 S NDC=$S($G(NDC)'="":$G(NDC),1:$$GETNDC^PSONDCUT(RX,.RFL))
"RTN","PSODRG",52,0)
 I $$STATUS^PSOBPSUT(RX,RFL)="" Q
"RTN","PSODRG",53,0)
 I '$$RXRLDT^PSOBPSUT(RX,RFL) Q
"RTN","PSODRG",54,0)
 ;
"RTN","PSODRG",55,0)
 S NDC=$S($G(NDC)'="":$G(NDC),1:$$GETNDC^PSONDCUT(RX,.RFL))
"RTN","PSODRG",56,0)
 D NDCEDT^PSONDCUT(RX,.RFL,$G(DRG),$G(PSOSITE),.NDC)
"RTN","PSODRG",57,0)
 Q
"RTN","PSODRG",58,0)
 ;
"RTN","PSODRG",59,0)
TRADE ;
"RTN","PSODRG",60,0)
 K DIR,DIC,DA,X,Y
"RTN","PSODRG",61,0)
 S DIR(0)="52,6.5" S:$G(PSOTRN)]"" DIR("B")=$G(PSOTRN) D ^DIR K DIR,DIC
"RTN","PSODRG",62,0)
 I X="@" S Y=X K DIRUT
"RTN","PSODRG",63,0)
 I $D(DIRUT) S:$D(DUOUT)!$D(DTOUT)&('$D(PSORX("EDIT"))) PSONEW("DFLG")=1 G TRADEX
"RTN","PSODRG",64,0)
 S PSODRUG("TRADE NAME")=Y
"RTN","PSODRG",65,0)
TRADEX I $G(PSORXED("DFLG")),$D(DIRUT) S PSORXED("DFLG")=1
"RTN","PSODRG",66,0)
 K DIRUT,DTOUT,DUOUT,X,Y,DA,DR,DIE
"RTN","PSODRG",67,0)
 Q
"RTN","PSODRG",68,0)
SET ;
"RTN","PSODRG",69,0)
 N STAT S PSODRUG("IEN")=+PSOY,PSODRUG("VA CLASS")=$P(PSOY(0),"^",2)
"RTN","PSODRG",70,0)
 S PSODRUG("NAME")=$P(PSOY(0),"^")
"RTN","PSODRG",71,0)
 S:+$G(^PSDRUG(+PSOY,2)) PSODRUG("OI")=+$G(^(2)),PSODRUG("OIN")=$P(^PS(50.7,+$G(^(2)),0),"^")
"RTN","PSODRG",72,0)
 S PSODRUG("NDF")=$S($G(^PSDRUG(+PSOY,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)
"RTN","PSODRG",73,0)
 S PSODRUG("MAXDOSE")=$P(PSOY(0),"^",4),PSODRUG("DEA")=$P(PSOY(0),"^",3)
"RTN","PSODRG",74,0)
 S PSODRUG("CLN")=$S($D(^PSDRUG(+PSOY,"ND")):+$P(^("ND"),"^",6),1:0)
"RTN","PSODRG",75,0)
 S PSODRUG("SIG")=$P(PSOY(0),"^",5)
"RTN","PSODRG",76,0)
 I $G(PSODRUG("NDC"))="" S PSODRUG("NDC")=$$GETNDC^PSSNDCUT(+PSOY,$G(PSOSITE))
"RTN","PSODRG",77,0)
 S PSODRUG("DAW")=+$$GET1^DIQ(50,+PSOY,81)
"RTN","PSODRG",78,0)
 S PSODRUG("STKLVL")=$G(^PSDRUG(+PSOY,660.1))
"RTN","PSODRG",79,0)
 G:$G(^PSDRUG(+PSOY,660))']"" SETX
"RTN","PSODRG",80,0)
 S PSOX1=$G(^PSDRUG(+PSOY,660))
"RTN","PSODRG",81,0)
 S PSODRUG("COST")=$P($G(PSOX1),"^",6)
"RTN","PSODRG",82,0)
 S PSODRUG("UNIT")=$P($G(PSOX1),"^",8)
"RTN","PSODRG",83,0)
 S PSODRUG("EXPIRATION DATE")=$P($G(PSOX1),"^",9)
"RTN","PSODRG",84,0)
SETX K PSOX1,PSOY
"RTN","PSODRG",85,0)
 Q
"RTN","PSODRG",86,0)
NFI ;display restriction/guidelines
"RTN","PSODRG",87,0)
 D EN^PSSDIN(PSODRUG("OI"),PSODRUG("IEN")) S NFI=$$PROMPT^PSSDIN
"RTN","PSODRG",88,0)
 I NFI]"","ODY"[NFI D TD^PSONFI
"RTN","PSODRG",89,0)
 K NFI Q
"RTN","PSODRG",90,0)
POST ;order checks
"RTN","PSODRG",91,0)
 K PSODOSD
"RTN","PSODRG",92,0)
 G:$G(PSORX("DFLG"))!($G(PSORXED("DFLG"))) POSTX
"RTN","PSODRG",93,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",94,0)
 K ZDGDG,ZTHER,IT N LIST S LIST="PSOPEPS"
"RTN","PSODRG",95,0)
 K PSORX("INTERVENE") N STAT,SIG,PTR,NDF,VAP S PSORX("DFLG")=0
"RTN","PSODRG",96,0)
 W !! D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",97,0)
 D ^PSOBUILD
"RTN","PSODRG",98,0)
 D @$S($G(COPY):"^PSOCPPRE",1:"^PSODDPRE") ; Duplicate drug check
"RTN","PSODRG",99,0)
 G:$G(PSORX("DFLG")) POSTX
"RTN","PSODRG",100,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",101,0)
 I $P($G(^PSDRUG(PSODRUG("IEN"),"CLOZ1")),"^")="PSOCLO1" W !,"Now doing Clozapine Order checks.  Please wait...",! D CLOZ
"RTN","PSODRG",102,0)
 G:PSORX("DFLG") POSTX
"RTN","PSODRG",103,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",104,0)
 W !,"Now doing allergy checks.  Please wait...",!
"RTN","PSODRG",105,0)
 S PSONOAL="" D ALLERGY^PSOORUT2 D:PSONOAL'="" NOALRGY K PSONOAL
"RTN","PSODRG",106,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",107,0)
 G:PSORX("DFLG") POSTX
"RTN","PSODRG",108,0)
 D ^PSODGAL1 K PSORX("INTERVENE")
"RTN","PSODRG",109,0)
 ;aminoglycoside
"RTN","PSODRG",110,0)
 N AOC
"RTN","PSODRG",111,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",112,0)
 S AOC=$$AOC^OROCAPI(PSODFN,$P(PSODRUG("NDF"),"A",2)) I $P(AOC,"^",4)]"" D
"RTN","PSODRG",113,0)
 .W !!,"***Aminoglycoside Ordered***",!!
"RTN","PSODRG",114,0)
 .K ^UTILITY($J,"W") S DIWL=1,DIWR=78,DIWF="" S X=$P(AOC,"^",4) D ^DIWP
"RTN","PSODRG",115,0)
 .W !! F ZX=0:0 S ZX=$O(^UTILITY($J,"W",1,ZX)) Q:'ZX  W ?2,^UTILITY($J,"W",1,ZX,0),! D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",116,0)
 .K ^UTILITY($J,"W")
"RTN","PSODRG",117,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",118,0)
 ;dangerous meds for pat >64
"RTN","PSODRG",119,0)
 I $G(PSODRUG("OI")) D
"RTN","PSODRG",120,0)
 .N OI,OIR S OI=$$OITM^ORX8(PSODRUG("OI"),"99PSP") Q:'OI
"RTN","PSODRG",121,0)
 .S OIR=$$DOC^OROCAPI(PSODFN,OI) I $P(OIR,"^",4)]"" D
"RTN","PSODRG",122,0)
 ..D HD^PSODDPR2():(($Y+5)'>IOSL) W !!,"***Dangerous Meds for Patient >64***",!! S DFN=PSODFN D DEM^VADPT
"RTN","PSODRG",123,0)
 ..K ^UTILITY($J,"W") S DIWL=1,DIWR=78,DIWF="" S X=$P(OIR,"^",4) D ^DIWP
"RTN","PSODRG",124,0)
 ..F ZX=0:0 S ZX=$O(^UTILITY($J,"W",1,ZX)) Q:'ZX  W ?2,^UTILITY($J,"W",1,ZX,0),! D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",125,0)
 ..K ^UTILITY($J,"W")
"RTN","PSODRG",126,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",127,0)
 ;metformin lab results
"RTN","PSODRG",128,0)
 N GOC S GOC=$$GOC^OROCAPI(PSODFN,PSODRUG("NAME")) I $P(GOC,"^",4)]"" D
"RTN","PSODRG",129,0)
 .W !!,"***Metformin Lab Results***",!!
"RTN","PSODRG",130,0)
 .K ^UTILITY($J,"W") S DIWL=1,DIWR=78,DIWF="" S X=$P(GOC,"^",4) D ^DIWP
"RTN","PSODRG",131,0)
 .F ZX=0:0 S ZX=$O(^UTILITY($J,"W",1,ZX)) Q:'ZX  W ?2,^UTILITY($J,"W",1,ZX,0),! D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",132,0)
 .K ^UTILITY($J,"W")
"RTN","PSODRG",133,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",134,0)
 K DIWF,DIWL,DIWR,ZX,DFN
"RTN","PSODRG",135,0)
 I $G(PSODRUG("DEA"))["S"!($E($G(PSODRUG("VA CLASS")),1,2)="XA") D  G POSTX ;stops if drug is supply
"RTN","PSODRG",136,0)
 .W !,"Now Processing Enhanced Order Checks!  Please wait...",! H 1
"RTN","PSODRG",137,0)
 ;enhanced OC
"RTN","PSODRG",138,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",139,0)
 W ! D @$S($G(COPY):"OBX^PSOCPPRE",1:"OBX^PSODDPRE") ; Set PSORX("DFLG")=1 if process to stop new enhanced order checks
"RTN","PSODRG",140,0)
POSTX ;
"RTN","PSODRG",141,0)
 K IT,^TMP($J,"DI"),PSORX("INTERVENE"),DA,^TMP($J,"PSODRDI"),ZDGDG,ZTHER K ^TMP($J,"DI"_PSODFN)
"RTN","PSODRG",142,0)
 Q
"RTN","PSODRG",143,0)
 ;
"RTN","PSODRG",144,0)
EOJ ;
"RTN","PSODRG",145,0)
 K PSODRG
"RTN","PSODRG",146,0)
 Q
"RTN","PSODRG",147,0)
WAIT ;
"RTN","PSODRG",148,0)
 K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to continue..." W !
"RTN","PSODRG",149,0)
 D ^DIR K DIRUT,DUOUT,DIR,X,Y
"RTN","PSODRG",150,0)
 Q
"RTN","PSODRG",151,0)
 ;
"RTN","PSODRG",152,0)
CLOZ ;
"RTN","PSODRG",153,0)
 S ANQRTN=$P(^PSDRUG(PSODRUG("IEN"),"CLOZ1"),"^"),ANQX=0
"RTN","PSODRG",154,0)
 S P(5)=PSODRUG("IEN"),DFN=PSODFN,X=ANQRTN
"RTN","PSODRG",155,0)
 X ^%ZOSF("TEST") I  D @("^"_ANQRTN) S:$G(ANQX) PSORX("DFLG")=1
"RTN","PSODRG",156,0)
 K P(5),ANQRTN,ANQX,X,DFN
"RTN","PSODRG",157,0)
 Q
"RTN","PSODRG",158,0)
 ;
"RTN","PSODRG",159,0)
EN(DRG) ;returns lab test identified for clozapine order checking
"RTN","PSODRG",160,0)
 K LAB I $P($G(^PSDRUG(DRG,"CLOZ1")),"^")'="PSOCLO1" S LAB("NOT")=0 Q
"RTN","PSODRG",161,0)
 I $P($G(^PSDRUG(DRG,"CLOZ1")),"^")="PSOCLO1" D
"RTN","PSODRG",162,0)
 .S (CNT,I)=0 F  S I=$O(^PSDRUG(DRG,"CLOZ2",I)) Q:'I  S CNT=$G(CNT)+1
"RTN","PSODRG",163,0)
 .I CNT'=2 S LAB("BAD TEST")=0 K CNT Q
"RTN","PSODRG",164,0)
 .K CNT F I=0:0 S I=$O(^PSDRUG(DRG,"CLOZ2",I)) Q:'I  D
"RTN","PSODRG",165,0)
 ..S LABT=$S($P(^PSDRUG(DRG,"CLOZ2",I,0),"^",4)=1:"WBC",1:"ANC"),LAB(LABT)=$P(^PSDRUG(DRG,"CLOZ2",I,0),"^")_"^"_$P(^(0),"^",3)_"^"_$P(^(0),"^",4)
"RTN","PSODRG",166,0)
 K LABT,I
"RTN","PSODRG",167,0)
 Q
"RTN","PSODRG",168,0)
NOALRGY ;
"RTN","PSODRG",169,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSODRG",170,0)
 N DIR S DIR(0)="SA^1:YES;0:NO"
"RTN","PSODRG",171,0)
 I $D(^TMP($J,"PSOINTERVENE",+PSODFN)) D  Q
"RTN","PSODRG",172,0)
 .S DIR("A")="No Allergy Assessment - Do you want to duplicate Intervention?: ",DIR("B")="Yes"
"RTN","PSODRG",173,0)
 .D ^DIR
"RTN","PSODRG",174,0)
 .I 'Y D  Q
"RTN","PSODRG",175,0)
 ..I Y=0 D ^PSORXI Q
"RTN","PSODRG",176,0)
 ..S PSORX("DFLG")=1
"RTN","PSODRG",177,0)
 .D DUPINV^PSORXI
"RTN","PSODRG",178,0)
 W $C(7),!,"There is no allergy assessment on file for this patient."
"RTN","PSODRG",179,0)
 W !,"You will be prompted to intervene if you continue with this prescription"
"RTN","PSODRG",180,0)
 S DIR("A")="Do you want to Continue?: ",DIR("B")="N" D ^DIR
"RTN","PSODRG",181,0)
 I 'Y D  Q
"RTN","PSODRG",182,0)
 .I $D(PSONV) S PSZZQUIT=1 Q
"RTN","PSODRG",183,0)
 .S PSORX("DFLG")=1
"RTN","PSODRG",184,0)
 I $D(PSONV) S PSORX("INTERVENE")=0 D EN1^PSORXI(PSONV) Q
"RTN","PSODRG",185,0)
 D ^PSORXI
"RTN","PSODRG",186,0)
 Q
"RTN","PSODSPL")
0^41^B20367519
"RTN","PSODSPL",1,0)
PSODSPL ;IHS/DSD/JCM - DISPLAY RX PROFILE TO SCREEN ;03/07/93 18:11
"RTN","PSODSPL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**132,251**;DEC 1997;Build 202
"RTN","PSODSPL",3,0)
 ; Input Variables: PSOSD(,
"RTN","PSODSPL",4,0)
 ; Optional Input Variables: PSOOPT
"RTN","PSODSPL",5,0)
 ;
"RTN","PSODSPL",6,0)
 ; display profiles needs PSOOPT=3 from new PSOOPT=4 from refill, 
"RTN","PSODSPL",7,0)
 ; or PSOOPT=0 from anywhere
"RTN","PSODSPL",8,0)
 ; PSOOPT=-1 to get numbered list but no refill/renew message
"RTN","PSODSPL",9,0)
 ;---------------------------------------------------------------
"RTN","PSODSPL",10,0)
START ;
"RTN","PSODSPL",11,0)
 I '$G(PSOSD) W $C(7),!!,"This patient has no prescriptions",! G END
"RTN","PSODSPL",12,0)
 D EOJ,SHOW
"RTN","PSODSPL",13,0)
END D EOJ
"RTN","PSODSPL",14,0)
 Q
"RTN","PSODSPL",15,0)
 ;-----------------------------------------------------------------
"RTN","PSODSPL",16,0)
SHOW ;
"RTN","PSODSPL",17,0)
 N PSODRUG,PSOSTA,PSODATA,PSOQFLG,PSOCT,PSOCNT
"RTN","PSODSPL",18,0)
 S PSOPENFL=0
"RTN","PSODSPL",19,0)
 S (PSOSTA,PSODRUG)="",(PSOCNT,PSOQFLG)=0
"RTN","PSODSPL",20,0)
 D HD^PSODDPR2() Q:$G(PSODLQT)
"RTN","PSODSPL",21,0)
 D HD F PSCNT=0:0 S PSOSTA=$O(PSOSD(PSOSTA)) Q:PSOSTA=""!($G(PSOQFLG))  D STA F PSOCT=0:0 S PSODRUG=$O(PSOSD(PSOSTA,PSODRUG)) Q:PSODRUG=""  Q:PSOCNT>1000!PSOQFLG  D
"RTN","PSODSPL",22,0)
 .S PSODATA=PSOSD(PSOSTA,PSODRUG),PSOCNT=PSOCNT+1 I PSOSTA="PENDING" D PEN Q
"RTN","PSODSPL",23,0)
 .I PSOSTA="ZNONVA" D  Q
"RTN","PSODSPL",24,0)
 ..W !,"  "_$P(PSODRUG,"^")_" "_$P(PSODATA,"^",6)_" "_$P(PSODATA,"^",8)
"RTN","PSODSPL",25,0)
 ..I ($L("  "_$P(PSODRUG,"^")_" "_$P(PSODATA,"^",6)_" "_$P(PSODATA,"^",8))+20)>70 W !
"RTN","PSODSPL",26,0)
 ..W ?50,"Date Documented: "_$E($P(PSODATA,"^",9),4,5)_"/"_$E($P(PSODATA,"^",9),6,7)_"/"_$E($P(PSODATA,"^",9),2,3)
"RTN","PSODSPL",27,0)
 .S:'$D(^PSRX(+PSODATA,0)) PSOCNT=PSOCNT-1 D:$D(^(0)) DISPL
"RTN","PSODSPL",28,0)
 I PSOQFLG G SHOWX
"RTN","PSODSPL",29,0)
 D HD^PSODDPR2() Q:$G(PSODLQT) 
"RTN","PSODSPL",30,0)
 ;K DIR S DIR(0)="EA",DIR("A")="Press RETURN to continue: " D ^DIR ;S:'$D(DFN) DFN=PSODFN D:'$G(INPAT) GMRA^PSODEM
"RTN","PSODSPL",31,0)
SHOWX W ! K DIRUT,DTOUT,DUOUT,DIROUT S PSOCNT=PSOCNT-1 ;K PSODRUG
"RTN","PSODSPL",32,0)
 Q
"RTN","PSODSPL",33,0)
 ;
"RTN","PSODSPL",34,0)
HD ;
"RTN","PSODSPL",35,0)
 I $Y+5>IOSL S (DX,DY)=0 X ^%ZOSF("XY") K DX,DY
"RTN","PSODSPL",36,0)
 Q:$G(PSOPENFL)  K LINE
"RTN","PSODSPL",37,0)
 W !!,?61,"ISSUE",?68,"LAST",?73,"REF DAY",!,?4,"RX #",?17,"DRUG",?54,"QTY",?58,"ST",?62,"DATE",?68,"FILL",?73,"REM",?77,"SUP" S $P(LINE,"-",80)="-" W !,LINE K LINE
"RTN","PSODSPL",38,0)
 Q
"RTN","PSODSPL",39,0)
DISPL W ! I $G(PSOOPT) W $J(PSOCNT,2)
"RTN","PSODSPL",40,0)
 S PSODQLZ=$L($P(PSODRUG,"^"))+$L($P(^PSRX(+PSODATA,0),"^",7))
"RTN","PSODSPL",41,0)
 W ?3,$P(^PSRX(+PSODATA,0),"^")_$S($G(^PSRX(+PSODATA,"IB")):"$",1:"")
"RTN","PSODSPL",42,0)
 S PSOQTLZ=57-$L($P(^PSRX(+PSODATA,0),"^",7)) I PSODQLZ<39 W ?17,$P(PSODRUG,"^"),?PSOQTLZ,$P(^PSRX(+PSODATA,0),"^",7)
"RTN","PSODSPL",43,0)
 E  W ?17,$P(PSODRUG,"^")
"RTN","PSODSPL",44,0)
 N PSOCMOP,STATL
"RTN","PSODSPL",45,0)
 I $D(^PSDRUG("AQ",$P(^PSRX(+PSODATA,0),"^",6))) S PSOCMOP=">"
"RTN","PSODSPL",46,0)
 N X S X="PSXOPUTL" X ^%ZOSF("TEST") K X I $T D
"RTN","PSODSPL",47,0)
 .N DA S DA=+PSODATA D ^PSXOPUTL K DA
"RTN","PSODSPL",48,0)
 .I $G(PSXZ(PSXZ("L")))=0!($G(PSXZ(PSXZ("L")))=2) S PSOCMOP="T"
"RTN","PSODSPL",49,0)
 .K PSXZ
"RTN","PSODSPL",50,0)
 S STA="A^N^R^H^N^S^^^^^^E^DC^^DP^DE^HP^P^"
"RTN","PSODSPL",51,0)
 S STATL=$P(STA,"^",$P(PSODATA,"^",2)+1) D
"RTN","PSODSPL",52,0)
 .I $G(^PSRX(+PSODATA,"DDSTA"))]"" S STATL="DD" Q
"RTN","PSODSPL",53,0)
 .S STATL=$S($P($G(^PSRX(+PSODATA,7)),"^")=1:"DA",$P($G(^PSRX(+PSODATA,7)),"^")=2:"DF",1:STATL)
"RTN","PSODSPL",54,0)
 W ?58,STATL W $G(PSOCMOP) K STA
"RTN","PSODSPL",55,0)
 S PSOID=$P(^PSRX(+PSODATA,0),"^",13),PSOLF=+^(3) W ?61,$E(PSOID,4,5)_"-"_$E(PSOID,6,7)
"RTN","PSODSPL",56,0)
 F PSOX=0:0 S PSOX=$O(^PSRX(+PSODATA,1,PSOX)) Q:'PSOX  I +^PSRX(+PSODATA,1,PSOX,0)=PSOLF,$P(^PSRX(+PSODATA,1,PSOX,0),"^",16) S PSOLF=PSOLF_"^R"
"RTN","PSODSPL",57,0)
 I '$O(^PSRX(+PSODATA,1,0)),$P(^PSRX(+PSODATA,2),"^",15) S PSOLF=PSOLF_"^R"
"RTN","PSODSPL",58,0)
 W ?67,$S(+PSOLF:$E(PSOLF,4,5)_"-"_$E(PSOLF,6,7),1:"  -  "),$P(PSOLF,"^",2)
"RTN","PSODSPL",59,0)
 W ?74,$J($P(PSODATA,"^",6),2)
"RTN","PSODSPL",60,0)
 W ?78,$J($P(PSODATA,"^",8),2)
"RTN","PSODSPL",61,0)
 I PSODQLZ>38 S PSOQTLZ=PSOQTLZ-5 W !?PSOQTLZ,"Qty: ",$P(^PSRX(+PSODATA,0),"^",7)
"RTN","PSODSPL",62,0)
 K PSODQLZ,PSOQTLZ,PSODATA,PSOID,PSOLF,PSOX
"RTN","PSODSPL",63,0)
 ;
"RTN","PSODSPL",64,0)
EOF I $Y+5>IOSL,$O(PSOSD(PSOSTA,PSODRUG))]"" K DIR S DIR(0)="E" D ^DIR K DIR S:$D(DUOUT) PSOHI=PSOCNT,PSOQFLG=1 K DIRUT,DTOUT,DUOUT,DIROUT D:'PSOQFLG HD,STA
"RTN","PSODSPL",65,0)
 ;
"RTN","PSODSPL",66,0)
 Q
"RTN","PSODSPL",67,0)
STA ;
"RTN","PSODSPL",68,0)
 Q:$G(PSOQFLG)
"RTN","PSODSPL",69,0)
 I PSOSTA="ZNONVA" S ZSTA=PSOSTA,PSOSTA="Non-VA MEDS (Not dispensed by VA)"
"RTN","PSODSPL",70,0)
 S STR=($L(PSOSTA)+IOM/2)-$L(PSOSTA),STP=IOM-(STR+$L(PSOSTA)) W ! F I=1:1:STR W "-"
"RTN","PSODSPL",71,0)
 W PSOSTA F I=1:1:STP W "-"
"RTN","PSODSPL",72,0)
 I $G(ZSTA)]"" W "-" S PSOSTA=ZSTA K ZSTA
"RTN","PSODSPL",73,0)
 Q
"RTN","PSODSPL",74,0)
EOJ ;
"RTN","PSODSPL",75,0)
 K PSOHI,PSOQFLG,PSODATA,PSOID,PSOLF,PSOCNT,PSOLO1,PSOPENFL
"RTN","PSODSPL",76,0)
 Q
"RTN","PSODSPL",77,0)
PEN ;
"RTN","PSODSPL",78,0)
 N PSCMOPR S PSCMOPR=0 I $P($G(PSODATA),"^",11),$D(^PSDRUG("AQ",$P(PSODATA,"^",11))) S PSCMOPR=1
"RTN","PSODSPL",79,0)
 W ! I $G(PSOOPT) W $J(PSOCNT,2)
"RTN","PSODSPL",80,0)
 S PSOPENFL=1
"RTN","PSODSPL",81,0)
 S PSODQLZ=$L($P(PSODRUG,"^")),PSOQTLZ=$L($P(PSODATA,"^",8))
"RTN","PSODSPL",82,0)
 W ?3,$P(PSODRUG,"^") I +$G(PSODQLZ)>37 W !
"RTN","PSODSPL",83,0)
 ;W ?49,"ISDT: ",$S('$P(PSODATA,"^",9):"     ",1:$E($P(PSODATA,"^",9),4,5)_"-"_$E($P(PSODATA,"^",9),6,7))_"  QTY: "_$S(PSOQTLZ=1:"  ",PSOQTLZ=2:" ",1:"")_$P(PSODATA,"^",8)_"  REF: "_$J($P(PSODATA,"^",6),2)
"RTN","PSODSPL",84,0)
 W ?42,"QTY: ",$P(PSODATA,"^",8),?59,"ISDT: ",$S('$P(PSODATA,"^",9):"     ",1:$E($P(PSODATA,"^",9),4,5)_"-"_$E($P(PSODATA,"^",9),6,7))_$S($G(PSCMOPR):"> ",1:"  ")_"REF: "_$J($P(PSODATA,"^",6),2)
"RTN","PSODSPL",85,0)
 K PSODATA,PSOID,PSOLF,PSODQLZ,PSOQTLZ D EOF
"RTN","PSODSPL",86,0)
 Q
"RTN","PSOFUNC")
0^42^B6752191
"RTN","PSOFUNC",1,0)
PSOFUNC ;BHAM ISC/DRI - functions moved from the psf global ;10/26/92 11:49
"RTN","PSOFUNC",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**146,223,249,251**;DEC 1997;Build 202
"RTN","PSOFUNC",3,0)
STAT ;gets status of rx
"RTN","PSOFUNC",4,0)
 S ST0=+$P(RX0,"^",15) I ST0<12,$O(^PS(52.5,"B",J,0)),$D(^PS(52.5,+$O(^(0)),0)),'$G(^("P")) S ST0=5
"RTN","PSOFUNC",5,0)
 I ST0<12,$P(RX2,"^",6)<DT S ST0=11
"RTN","PSOFUNC",6,0)
 S ST=$P("Error^Active^Non-Verified^Refill^Hold^Non-Verified^Suspended^^^^^Done^Expired^Discontinued^Deleted^Discontinued By Provider^Discontinued (Edit)^Provider Hold^","^",ST0+2),$P(RX0,"^",15)=ST0
"RTN","PSOFUNC",7,0)
 Q
"RTN","PSOFUNC",8,0)
CUTDATE ;calculates exp/cancel cutoff date in PSODTCUT
"RTN","PSOFUNC",9,0)
 S X1=DT,X2=-120 D C^%DTC S PSODTCUT=X,PSOPRPAS=$P($G(PSOPAR),"^",7) Q
"RTN","PSOFUNC",10,0)
 ;
"RTN","PSOFUNC",11,0)
FIXEXPDT ;calculate expiration date on rx's missing them
"RTN","PSOFUNC",12,0)
 F J=0:0 S J=$O(^PSRX(J)) Q:'J  I $D(^(J,0))#2 S RX0=^(0),RX2=$S($D(^(2))#2:^(2),1:"") D ^PSOEXDT:'$P(RX2,"^",6)
"RTN","PSOFUNC",13,0)
 Q
"RTN","PSOFUNC",14,0)
 ;
"RTN","PSOFUNC",15,0)
INP526 ;input transform for drug field (#6) in prescription file (#52)
"RTN","PSOFUNC",16,0)
 ;
"RTN","PSOFUNC",17,0)
 S PSODFN=+$P(^PSRX(DA,0),"^",2) F I=0:0 S I=$O(^PS(55,PSODFN,"P",I)) Q:'I  S RX=+^(I,0) I RX'=DA,$D(^PSRX(RX,0)),+$P(^(0),"^",6)=X,'$P(^("STA"),"^") S XS=X,X2=$P(^(0),"^",13),X1=$P(^PSRX(DA,0),"^",13) D ^%DTC D:X<180 INP5261 Q:'$D(X)  S X=XS
"RTN","PSOFUNC",18,0)
 Q
"RTN","PSOFUNC",19,0)
INP5261 D EN^DDIOL("Duplicate Drug in Rx #"_$P(^PSRX(RX,0),"^")_" . Discontinue? (Y/N): ","","$C(7),?10") R ZX:DTIME
"RTN","PSOFUNC",20,0)
 I ZX["^" D EN^DDIOL("NO UP ARROW ALLOWED","","!") S ZX="?"
"RTN","PSOFUNC",21,0)
 I ZX["?" D EN^DDIOL("Enter Y to discontinue this Prescription","","!") D EN^DDIOL(" ","","!") G INP5261
"RTN","PSOFUNC",22,0)
 S ZX=ZX?1"Y".E I ZX S $P(^PSRX(RX,"STA"),"^")=12,$P(^PSRX(RX,3),"^",5)=DT D CAN^PSOTPCAN(RX) D EN^DDIOL("     Discontinued") Q
"RTN","PSOFUNC",23,0)
 K X,XS,ZS Q
"RTN","PSOHLNEW")
0^6^B83284791
"RTN","PSOHLNEW",1,0)
PSOHLNEW ;BIR/RTR - CPRS orders ;11/30/06 11:49am
"RTN","PSOHLNEW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,7,15,46,71,98,111,124,117,131,146,132,143,223,235,148,239,249,225,324,251**;DEC 1997;Build 202
"RTN","PSOHLNEW",3,0)
 ;40.8-728,50-221,SC-2675,100-2219,50.7-2223,EN^ORERR-2187
"RTN","PSOHLNEW",4,0)
EN(MSG) ;
"RTN","PSOHLNEW",5,0)
 N PSODDRUG,ENTERED,LOCATION,PLACER,PSOOC,ROUTE,NATURE,PREV,ROUTING,OO,OR,STAT,ZZ,DFN,COMM,QCOUNT,OCOUNT,Q1I,QTARRAY,QTARRAY2,EE,PP,XOFLAG,PSODYSPL,PSOFILNM
"RTN","PSOHLNEW",6,0)
 N ONEFLAG,SERV,WPCT,EFFECT,PROV,PENDING,RRX,PSOLQ1I,PSOLQ1II,PSOQWX,PSOLQ1IX,PSONVA,PSOICD,PSOSCP,EEE
"RTN","PSOHLNEW",7,0)
 N OBXAR,AA,II,SIG1,FILLER,COMM,GG,FF,JJ,JJJ,CT,LIM,VAR,VAR1,QQQ,PSRNFLAG,PSRNQFLG,RCOMM,XOFLAGZ,NWFLAG,PFLAG,PSINPTR,INPTRX,PSOIBN,PSOIBY
"RTN","PSOHLNEW",8,0)
 N DSIG,PSOCHFFL,PSOCVI,PSOMO,PSOXRP,NN,LL,LLL,WPARRAY,QTVAR,POVAR,POVAR1,ORCSEG,NNN,OOO,AAA,NNNN,POLIM,NNCK,PRIOR,IPPLACER,PLACERXX,EER,PSERRPID,PSERRPV1,PSERRORC,PSOEXFLG,PSOMSORR,PDFN,VAL
"RTN","PSOHLNEW",9,0)
 S (SEND,PSOSND,OCOUNT)=0 K PSOPLC,PSOFFL,PSORSO,PSOSUSZ
"RTN","PSOHLNEW",10,0)
 F OO=0:0 S OO=$O(MSG(OO)) Q:'OO!(SEND)!(PSOSND)  D:$P(MSG(OO),"|")="PID" SPDFN I $P(MSG(OO),"|")="ORC",$P(MSG(OO),"|",2)'="NW",$P(MSG(OO),"|",2)'="XO" D
"RTN","PSOHLNEW",11,0)
 .S OR("STAT")=$P(MSG(OO),"|",2),OR("PLACE")=+$P(MSG(OO),"|",3),PLACERXX=+$P($P(MSG(OO),"|",3),";",2),OR("COMM")=$P(MSG(OO),"|",17),OR("USER")=$P(MSG(OO),"|",11) I $P(MSG(OO),"|",2)'="DE",$P(MSG(OO),"|",2)'="NA" S SEND=1 D FILL Q
"RTN","PSOHLNEW",12,0)
 .S PSOPLC=+$P(MSG(OO),"|",3),PSOFFL=+$P(MSG(OO),"|",4),PSOSND=1,PSOCHFFL=$P($P(MSG(OO),"|",4),"^")
"RTN","PSOHLNEW",13,0)
 I $G(OR("COMM"))["^" S OR("COMM")=$P(OR("COMM"),"^",5)
"RTN","PSOHLNEW",14,0)
 I PSOSND,$G(PSOCHFFL)["S",$G(OR("STAT"))="NA" D CHCS^PSOHLNE1 Q
"RTN","PSOHLNEW",15,0)
 I PSOSND,'$D(^PSRX(+$G(PSOFFL),0)) S COMM="Order was not located by Pharmacy" D EN^ORERR(COMM,.MSG) D KL Q
"RTN","PSOHLNEW",16,0)
 I PSOSND,$G(PDFN),PDFN'=+$P($G(^PSRX(+$G(PSOFFL),0)),"^",2) S COMM="Patient does not match" D EN^ORERR(COMM,.MSG) D KL Q
"RTN","PSOHLNEW",17,0)
 I PSOSND,$G(OR("STAT"))'="DE" N PSONAS S PSONAS=$S($P($G(^PSRX(PSOFFL,"OR1")),"^",2)="":1,1:0) S $P(^PSRX(PSOFFL,"OR1"),"^",2)=PSOPLC,^PSRX("APL",PSOPLC,PSOFFL)="" D:PSONAS EN^PSOHDR("PRES",PSOFFL) D KL Q
"RTN","PSOHLNEW",18,0)
 D KL
"RTN","PSOHLNEW",19,0)
 I SEND,$G(OR("STAT"))="Z@" G PURGE^PSOHLNE2
"RTN","PSOHLNEW",20,0)
 I SEND,$G(OR("STAT"))="ZF" G REF^PSOHLNE2
"RTN","PSOHLNEW",21,0)
 I SEND,$G(OR("STAT"))'="CA",$G(OR("STAT"))'="DC",$G(OR("STAT"))'="HD",$G(OR("STAT"))'="RL",$G(OR("STAT"))'="SS" S RCOMM="Invalid Order Control Code" D EN^ORERR(RCOMM,.MSG) Q
"RTN","PSOHLNEW",22,0)
 I SEND K SEND G:$G(OR("STAT"))="SS" ESTAT D EN^PSOORUTL(.OR) S PLACER=OR("PLACE"),STAT=OR("STAT"),COMM=OR("COMM") S PSOMSORR=1 D  K PSOMSORR Q
"RTN","PSOHLNEW",23,0)
 .I $G(OR("FILLER"))="" D  D ERROR^PSOHLSN Q
"RTN","PSOHLNEW",24,0)
 ..F EER=0:0 S EER=$O(MSG(EER)) Q:'EER  S:$P(MSG(EER),"|")="PV1" PSERRPV1=MSG(EER) S:$P(MSG(EER),"|")="PID" PSERRPID=MSG(EER) S:$P(MSG(EER),"|")="ORC"&($G(PSERRORC)="") PSERRORC=MSG(EER)
"RTN","PSOHLNEW",25,0)
 .I $P(OR("FILLER"),"^",2)="R" S FILLER=$P(OR("FILLER"),"^") D EN^PSOHLSN1(FILLER,STAT,$G(OR("PHARMST")),COMM) K:$G(PSOEXFLG) PSOMSORR,PLACERXX D:$G(PSOEXFLG) EN^PSOHLSN1(FILLER,"SC","ZE","") D:$G(PSOSUSZ) SUS^PSOORUT1 K PSOSUSZ Q
"RTN","PSOHLNEW",26,0)
 .D EN^PSOHLSN(PLACER,STAT,COMM) Q
"RTN","PSOHLNEW",27,0)
 D KL^PSOHLSIH S RRX=1 F ZZ=0:0 S ZZ=$O(MSG(ZZ)) Q:'ZZ  S PSOSEG=$G(MSG(ZZ)),PSOTYPE=$P(PSOSEG,"|") S PSOSEG=$E(PSOSEG,5,$L(PSOSEG)) I PSOTYPE'="NTE" D @PSOTYPE
"RTN","PSOHLNEW",28,0)
 I $G(PSRNFLAG) S PSOMO=0 D MISRN^PSOHLNE1 I $G(PSOMO) Q
"RTN","PSOHLNEW",29,0)
 S PSRNQFLG=0 I $G(PSRNFLAG),$G(PREV) D  I $G(PSRNQFLG) S RCOMM="Duplicate Renewal Request. Order rejected by Pharmacy." D EN^ORERR(RCOMM,.MSG) D RERROR^PSOHLSN D KL^PSOHLSIH Q
"RTN","PSOHLNEW",30,0)
 .I $P($G(^PSRX(PREV,"OR1")),"^",4) S PSRNQFLG=1 Q
"RTN","PSOHLNEW",31,0)
 .I $O(^PS(52.41,"AQ",PREV,0)) S PSRNQFLG=1
"RTN","PSOHLNEW",32,0)
 .I $G(XOFLAG),$G(DFN)'=$S($G(PFLAG):$P($G(^PS(52.41,+$G(PREV),0)),"^",2),1:$P($G(^PSRX(+$G(PREV),0)),"^",2)) S RCOMM="Patient mismatch on previous order." D EN^ORERR(RCOMM,.MSG) S XOFLAGZ=1 D RERROR^PSOHLSN D KL^PSOHLSIH Q
"RTN","PSOHLNEW",33,0)
 I $G(PLACER) I $G(DFN)'=+$P($G(^OR(100,+PLACER,0)),"^",2) G MISX^PSOHLNE1
"RTN","PSOHLNEW",34,0)
 I $G(PLACER) D NFILE
"RTN","PSOHLNEW",35,0)
 D KL^PSOHLSIH
"RTN","PSOHLNEW",36,0)
 Q
"RTN","PSOHLNEW",37,0)
ESTAT ;
"RTN","PSOHLNEW",38,0)
 D EXP^PSOHLNE1
"RTN","PSOHLNEW",39,0)
 Q
"RTN","PSOHLNEW",40,0)
MSH Q
"RTN","PSOHLNEW",41,0)
PID S DFN=+$P(PSOSEG,"|",3)
"RTN","PSOHLNEW",42,0)
 Q
"RTN","PSOHLNEW",43,0)
PV1 S LOCATION=+$P(+$P(PSOSEG,"|",3),"^")
"RTN","PSOHLNEW",44,0)
 S:'$D(^SC(LOCATION,0)) LOCATION=""
"RTN","PSOHLNEW",45,0)
 S INPTRX=0 I $G(LOCATION) S PSINPTR=$P($G(^SC(LOCATION,0)),"^",4) I PSINPTR Q
"RTN","PSOHLNEW",46,0)
 I $G(LOCATION) S INPTRX=$P($G(^SC(LOCATION,0)),"^",15)
"RTN","PSOHLNEW",47,0)
 I '$G(INPTRX) S INPTRX=$O(^DG(40.8,0))
"RTN","PSOHLNEW",48,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSOHLNEW",49,0)
 S PSINPTR=+$$SITE^VASITE(DT,INPTRX)
"RTN","PSOHLNEW",50,0)
 Q
"RTN","PSOHLNEW",51,0)
OBR ;This segment is used to pass flagging information from CPRS.
"RTN","PSOHLNEW",52,0)
 D OBR^PSOHLNE4
"RTN","PSOHLNEW",53,0)
 Q
"RTN","PSOHLNEW",54,0)
DG1 S $P(PSOICD($P(PSOSEG,"|",1)),"^")=$P($P(PSOSEG,"|",3),"^")
"RTN","PSOHLNEW",55,0)
 Q
"RTN","PSOHLNEW",56,0)
ORC ;
"RTN","PSOHLNEW",57,0)
 Q:$P(PSOSEG,"|")="DE"
"RTN","PSOHLNEW",58,0)
 S:$P(PSOSEG,"|")="XO" XOFLAG=1 D ^PSOHLNE1 S:$G(PRIOR)="A" PRIOR="E" S:$G(PRIOR)="" PRIOR="R"
"RTN","PSOHLNEW",59,0)
 Q
"RTN","PSOHLNEW",60,0)
 ;
"RTN","PSOHLNEW",61,0)
RXO I $O(MSG(ZZ,0)) D ^PSOHLNE2 G RXOPS
"RTN","PSOHLNEW",62,0)
 S PSORDITE=$P($P(PSOSEG,"|"),"^",4)
"RTN","PSOHLNEW",63,0)
 S PSODDRUG=$P($P(PSOSEG,"|",10),"^",4) I $G(PSODDRUG) S:'$D(^PSDRUG(PSODDRUG,0)) PSODDRUG=""
"RTN","PSOHLNEW",64,0)
 I '$P($P(PSOSEG,"|",10),"^",4) N PSI,PSDC S (PSDC,PSI)=0 D
"RTN","PSOHLNEW",65,0)
 .F  S PSI=$O(^PSDRUG("ASP",PSORDITE,PSI)) Q:'PSI  I $S('$D(^PSDRUG(PSI,"I")):1,'^("I"):1,DT'>^("I"):1,1:0),$S($P($G(^PSDRUG(PSI,2)),"^",3)'["O":0,1:1) S PSDC=PSDC+1,PSDC(PSDC)=PSI
"RTN","PSOHLNEW",66,0)
 .I PSDC=1 S PSODDRUG=PSDC(1)
"RTN","PSOHLNEW",67,0)
 S PSOXQTY=$P(PSOSEG,"|",11)
"RTN","PSOHLNEW",68,0)
 S PSOREFIL=$P(PSOSEG,"|",13)
"RTN","PSOHLNEW",69,0)
 S PSODYSPL=$P(PSOSEG,"|",17)
"RTN","PSOHLNEW",70,0)
RXOPS S ONEFLAG=0,WPCT=1,LL=ZZ+1
"RTN","PSOHLNEW",71,0)
 I $P($G(MSG(LL)),"|")="NTE" D
"RTN","PSOHLNEW",72,0)
 .S ONEFLAG=1,WORDP=$S($P(MSG(LL),"|",2):$P(MSG(LL),"|",2),1:$P(MSG(LL),"|",3)) S:$P(MSG(LL),"|",4)'="" WPARRAY(WORDP,WPCT)=$P(MSG(LL),"|",4) S:$P(MSG(LL),"|",4)'="" WPCT=WPCT+1 F LLL=0:0 S LLL=$O(MSG(LL,LLL)) Q:'LLL  D
"RTN","PSOHLNEW",73,0)
 ..I $G(MSG(LL,LLL))'="" S WPARRAY(WORDP,WPCT)=$G(MSG(LL,LLL)),WPCT=WPCT+1
"RTN","PSOHLNEW",74,0)
 I ONEFLAG S LL=LL+1 I $P($G(MSG(LL)),"|")="NTE" D NTE^PSOHLNE1
"RTN","PSOHLNEW",75,0)
 K WORDP
"RTN","PSOHLNEW",76,0)
 Q
"RTN","PSOHLNEW",77,0)
RXR I $P($P(PSOSEG,"|"),"^",4) S ROUTE(RRX)=$P($P(PSOSEG,"|"),"^",4) S RRX=RRX+1
"RTN","PSOHLNEW",78,0)
 Q
"RTN","PSOHLNEW",79,0)
OBX I $O(MSG(ZZ,0)) D OBXX^PSOHLNE2 G OBXNTE
"RTN","PSOHLNEW",80,0)
 S OCOUNT=OCOUNT+1
"RTN","PSOHLNEW",81,0)
 S OBXAR(OCOUNT,1)=$P(PSOSEG,"|",5)
"RTN","PSOHLNEW",82,0)
OBXNTE ;
"RTN","PSOHLNEW",83,0)
 D OBXNTE^PSOHLNE3
"RTN","PSOHLNEW",84,0)
 Q
"RTN","PSOHLNEW",85,0)
ZRN S PSODSC=1_"^"_$P(PSOSEG,"|",2)
"RTN","PSOHLNEW",86,0)
 I $O(MSG(ZZ,0)) F T=0:0 S T=$O(MSG(ZZ,T)) Q:'T  S PSODSC(T)=MSG(ZZ,T)
"RTN","PSOHLNEW",87,0)
 K T
"RTN","PSOHLNEW",88,0)
 Q
"RTN","PSOHLNEW",89,0)
 ;
"RTN","PSOHLNEW",90,0)
ZRX D ZRX^PSOHLNE1
"RTN","PSOHLNEW",91,0)
 Q
"RTN","PSOHLNEW",92,0)
 ;
"RTN","PSOHLNEW",93,0)
ZCL D ZCL^PSOHLNE1
"RTN","PSOHLNEW",94,0)
 Q
"RTN","PSOHLNEW",95,0)
ZSC D CP^PSOHLNE1
"RTN","PSOHLNEW",96,0)
 Q
"RTN","PSOHLNEW",97,0)
NFILE ;
"RTN","PSOHLNEW",98,0)
 I $G(PSODSC) D ^PSONVNEW Q  ;adds non-va med to #55
"RTN","PSOHLNEW",99,0)
 ;
"RTN","PSOHLNEW",100,0)
 K DD,DO,DIC S DLAYGO="52.41",DIC="^PS(52.41,",DIC(0)="L",X=PLACER,DIC("DR")="1////"_DFN_";2////"_PSOOC_";6////"_$G(EFFECT)_";12////"_$G(PSOXQTY)_";25////"_$G(PRIOR)
"RTN","PSOHLNEW",101,0)
 S DIC("DR")=DIC("DR")_";22////"_$G(PSORSO)_";22.1////"_$G(PREV)_";19////"_$G(ROUTING)_";17////"_$$UNESC^ORHLESC($G(SERV))_";7////"_$G(NATURE)_";13////"_$G(PSOREFIL)_";1.1////"_$G(LOCATION)_";117////"_$G(DSIG)
"RTN","PSOHLNEW",102,0)
 D FILE^DICN K DIC,DR I Y<0 Q
"RTN","PSOHLNEW",103,0)
 S PENDING=+Y
"RTN","PSOHLNEW",104,0)
 S $P(^PS(52.41,PENDING,0),"^",4)=$S($G(ENTERED):+$G(ENTERED),1:""),$P(^(0),"^",5)=$S($G(PROV):+$G(PROV),1:""),$P(^(0),"^",8)=$S($G(PSORDITE):+$G(PSORDITE),1:""),$P(^(0),"^",9)=$S($G(PSODDRUG):+$G(PSODDRUG),1:""),$P(^(0),"^",15)=$G(ROUTE)
"RTN","PSOHLNEW",105,0)
 S ^PS(52.41,PENDING,"IBQ")=$G(PSOIBY)
"RTN","PSOHLNEW",106,0)
 I $G(PSODYSPL)'="",$E(PSODYSPL)?1A S PSODYSPL=$E(PSODYSPL,2,$L(PSODYSPL))
"RTN","PSOHLNEW",107,0)
 S $P(^PS(52.41,PENDING,"INI"),"^")=$G(PSINPTR),$P(^(0),"^",12)=$G(PSOLOG),$P(^(0),"^",22)=$G(PSODYSPL)
"RTN","PSOHLNEW",108,0)
 I $G(QCOUNT) S ^PS(52.41,PENDING,1,0)="^52.413^"_QCOUNT_"^"_QCOUNT
"RTN","PSOHLNEW",109,0)
 S PSOQWX=$G(PSODDRUG) D:'$G(PSOQWX) OID^PSOHLNE1
"RTN","PSOHLNEW",110,0)
 F PP=0:0 S PP=$O(Q1I(PP)) Q:'PP  S VAL=$S($G(PSOQWX)&($G(PSOLQ1II(PP))):Q1I(PP),$G(PSOQWX)&($G(PSOLQ1IX(PP))'="")&('$G(PSOLQ1II(PP))):PSOLQ1IX(PP),1:PSOLQ1I(PP)) S ^PS(52.41,PENDING,1,PP,0)=$$UNESC^ORHLESC(VAL)
"RTN","PSOHLNEW",111,0)
 F EE=0:0 S EE=$O(QTARRAY(EE)) Q:'EE  S ^PS(52.41,PENDING,1,EE,1)=$$UNESC^ORHLESC(QTARRAY(EE)) S VAL=$S($G(PSOQWX)&($G(PSOLQ1II(EE))):$G(QTARRAY2(EE)),$G(PSOQWX)&($G(PSOLQ1IX(EE))'="")&('$G(PSOLQ1II(EE))):PSOLQ1IX(EE),1:$G(PSOLQ1I(EE))) D
"RTN","PSOHLNEW",112,0)
 .S ^PS(52.41,PENDING,1,EE,2)=$$UNESC^ORHLESC(VAL) S $P(^PS(52.41,PENDING,1,EE,1),"^",8)=+$G(ROUTE(EE))
"RTN","PSOHLNEW",113,0)
 S:$P($G(^PS(52.41,PENDING,1,1,1)),"^",3) $P(^PS(52.41,PENDING,0),"^",18)=$E($P($G(^PS(52.41,PENDING,1,1,1)),"^",3),1,7)
"RTN","PSOHLNEW",114,0)
 D STUFF^PSOHLNE2
"RTN","PSOHLNEW",115,0)
 D ^PSOHLPII
"RTN","PSOHLNEW",116,0)
 S LL=0 I $O(WPARRAY(6,0)) F LLL=0:0 S LLL=$O(WPARRAY(6,LLL)) Q:'LLL  S LL=LL+1 S ^PS(52.41,PENDING,3,LL,0)=$$UNESC^ORHLESC($G(WPARRAY(6,LLL)))
"RTN","PSOHLNEW",117,0)
 I LL S ^PS(52.41,PENDING,3,0)="^52.42^"_LL_"^"_LL
"RTN","PSOHLNEW",118,0)
 S LL=0 I $O(WPARRAY(7,0)) F LLL=0:0 S LLL=$O(WPARRAY(7,LLL)) Q:'LLL  S LL=LL+1 S ^PS(52.41,PENDING,"INS1",LL,0)=$$UNESC^ORHLESC($G(WPARRAY(7,LLL)))
"RTN","PSOHLNEW",119,0)
 I LL S ^PS(52.41,PENDING,"INS1",0)="^^"_LL_"^"_LL_"^"_$G(DT)_"^"
"RTN","PSOHLNEW",120,0)
 I $P($G(^PS(50.7,+$G(PSORDITE),"INS")),"^")'="" S $P(^PS(52.41,PENDING,"INS"),"^",2)=$S($O(^PS(52.41,PENDING,"INS1",0)):1,1:0)
"RTN","PSOHLNEW",121,0)
 I $G(OCOUNT) S ^PS(52.41,PENDING,"OBX",0)="^52.4118A^"_OCOUNT_"^"_OCOUNT F OCOUNT=1:1:OCOUNT D
"RTN","PSOHLNEW",122,0)
 .S ^PS(52.41,PENDING,"OBX",OCOUNT,0)=$$UNESC^ORHLESC($G(OBXAR(OCOUNT,1)))
"RTN","PSOHLNEW",123,0)
 .D USER^PSOORFI2(+$G(PROV)) S ^PS(52.41,PENDING,"OBX",OCOUNT,1)=$$UNESC^ORHLESC(USER1) K USER1
"RTN","PSOHLNEW",124,0)
 .S PSOBCT=1 F LLL=2:1 Q:'$D(OBXAR(OCOUNT,LLL))  S ^PS(52.41,PENDING,"OBX",OCOUNT,2,PSOBCT,0)=$$UNESC^ORHLESC(OBXAR(OCOUNT,LLL)),^PS(52.41,PENDING,"OBX",OCOUNT,2,0)="^^"_PSOBCT_"^"_PSOBCT_"^"_$G(DT)_"^"
"RTN","PSOHLNEW",125,0)
 D ^PSOHLPIS
"RTN","PSOHLNEW",126,0)
 K DIK S DIK="^PS(52.41,",DA=PENDING D IX^DIK
"RTN","PSOHLNEW",127,0)
 I $G(PSOOC)="RNW",$G(PREV),$D(^PSRX(+$G(PREV),0)) D EN^PSOHLSN1(PREV,"SC","ZZ","")
"RTN","PSOHLNEW",128,0)
 S PSOMSORR=1,IPPLACER=$P($G(^PS(52.41,PENDING,0)),"^") I IPPLACER D
"RTN","PSOHLNEW",129,0)
 .I '$G(XOFLAG) D EN^PSOHLSN(IPPLACER,"OK","IP") Q
"RTN","PSOHLNEW",130,0)
 .D EN^PSOHLSN(IPPLACER,"XR","IP") I $G(PFLAG) D DCP^PSOHLSN Q
"RTN","PSOHLNEW",131,0)
 .K PSOMSORR I $D(^PSRX(+$G(PREV),0)) D  D EN^PSOHLSN1(PREV,"RP","","","A")
"RTN","PSOHLNEW",132,0)
 ..S $P(^PSRX(PREV,"STA"),"^")=15,$P(^(3),"^",5)=DT,$P(^(3),"^",10)=$P(^(3),"^"),$P(^(7),"^")=2
"RTN","PSOHLNEW",133,0)
 ..D CHKCMOP^PSOUTL(PREV)
"RTN","PSOHLNEW",134,0)
 ..D REVERSE^PSOBPSU1(PREV,,"DC",7),CAN^PSOTPCAN(PREV),CAN^PSOUTL(PREV)
"RTN","PSOHLNEW",135,0)
 ..D CNT^PSOHLNE1
"RTN","PSOHLNEW",136,0)
 ..D:$G(^PS(52.41,PENDING,1,1,0))=""&($P($G(^PS(52.41,PENDING,1,1,1)),"^")="")&($G(^PS(52.41,PENDING,"SIG",1,0))="")
"RTN","PSOHLNEW",137,0)
 ...N FSIG,BSIG
"RTN","PSOHLNEW",138,0)
 ...I '$P($G(^PSRX(PREV,"SIG")),"^",2),$P($G(^("SIG")),"^")'="" D
"RTN","PSOHLNEW",139,0)
 ....D EN3^PSOUTLA1(PREV,70)
"RTN","PSOHLNEW",140,0)
 ....I $G(BSIG(1))'="" S ^PS(52.41,PENDING,"SIG",1,0)=$$UNESC^ORHLESC($G(BSIG(1))) I $O(BSIG(1)) F EE=1:0 S EE=$O(BSIG(EE)) Q:'EE  S ^PS(52.41,PENDING,"SIG",EE,0)=$$UNESC^ORHLESC($G(BSIG(EE)))
"RTN","PSOHLNEW",141,0)
 ...I $P($G(^PSRX(PREV,"SIG")),"^",2),$G(^PSRX(PREV,"SIG1",1,0))'="" D
"RTN","PSOHLNEW",142,0)
 ....D FSIG^PSOUTLA("R",PREV,70)
"RTN","PSOHLNEW",143,0)
 ....I $G(FSIG(1))'="" S ^PS(52.41,PENDING,"SIG",1,0)=$$UNESC^ORHLESC($G(FSIG(1))) I $O(FSIG(1)) F EE=1:0 S EE=$O(FSIG(EE)) Q:'EE  S ^PS(52.41,PENDING,"SIG",EE,0)=$$UNESC^ORHLESC($G(FSIG(EE)))
"RTN","PSOHLNEW",144,0)
 ...F EE=0:0 S EE=$O(^PS(52.41,PENDING,"SIG",EE)) Q:'EE  S ^PS(52.41,PENDING,"SIG",0)="^52.4124A^"_EE_"^"_EE
"RTN","PSOHLNEW",145,0)
 D CSET^PSODIAG
"RTN","PSOHLNEW",146,0)
 Q
"RTN","PSOHLNEW",147,0)
SPDFN S PDFN=$P($G(MSG(OO)),"|",4) Q
"RTN","PSOHLNEW",148,0)
KL K PSOPLC,PSOFFL,PSOSND
"RTN","PSOHLNEW",149,0)
 Q
"RTN","PSOHLNEW",150,0)
FILL ;
"RTN","PSOHLNEW",151,0)
 S (PSOFILNM,OR("PSOFILNM"))=$P($P(MSG(OO),"|",4),"^")
"RTN","PSOHLNEW",152,0)
 Q
"RTN","PSOLBL")
0^82^B65338340
"RTN","PSOLBL",1,0)
PSOLBL ;BIR/SAB/RTR-BOTTLE LABEL ;11/20/08 12:14pm
"RTN","PSOLBL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**8,19,30,36,47,71,92,120,157,244,206,225,303,266,326,251**;DEC 1997;Build 202
"RTN","PSOLBL",3,0)
 ;DBIAs PSDRUG-221, PS(55-2228, IBARX-125, PSXSRP-2201, %ZIS-3435, DPT-3097
"RTN","PSOLBL",4,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5424
"RTN","PSOLBL",5,0)
 ;
"RTN","PSOLBL",6,0)
 ;*244 rem test for part fill when testing status > 11
"RTN","PSOLBL",7,0)
 ;
"RTN","PSOLBL",8,0)
DQ I $D(PSOIOS),PSOIOS]"" D DEVBAR^PSOBMST
"RTN","PSOLBL",9,0)
 I $G(PSOBAR0)]"",$G(PSOBAR1)]"",$D(^PS(59,PSOSITE,1)) S PSOBARS=1
"RTN","PSOLBL",10,0)
DQ1 D ^PSOLBL4
"RTN","PSOLBL",11,0)
 I $G(IOST(0)),$D(^%ZIS(2,IOST(0),55,"B","LL")) G ^PSOLLLI
"RTN","PSOLBL",12,0)
 G:'$D(PPL) HLEX G:($P($G(PSOPAR),"^",30)=2)&('$G(PSOEXREP)) HLEX K RXFLX S PSOCKHN=","_$G(PPL) S PSRESOLV=+PPL D CHECK F PI=1:1  D  S RX=$P(PPL,",",PI) D C Q:$G(PSOLAPPL)  D:$G(PSDFNFLG) TRAIL^PSOLBL2 K RXP,REPRINT
"RTN","PSOLBL",13,0)
 .S (PSDFNFLG,PSOLAPPL)=0 S NEXTRX=$P(PPL,",",(PI+1)) I NEXTRX=""!(NEXTRX=",") S PSOLAPPL=1 Q
"RTN","PSOLBL",14,0)
 .I PSOPDFN'=$P(^PSRX(NEXTRX,0),"^",2) S PSDFNFLG=1,PSOPDFN=$P(^PSRX(NEXTRX,0),"^",2) Q
"RTN","PSOLBL",15,0)
 I $P(^PS(59,PSOSITE,1),"^",28) D ^PSOLBLN2
"RTN","PSOLBL",16,0)
 D:'$P(^PS(59,PSOSITE,1),"^",28) ^PSOLBLS
"RTN","PSOLBL",17,0)
DQ5 I $D(^TMP($J,"PSOCP",DFN)),'$P(^PS(59,PSOSITE,1),"^",28) D INV^PSOCPE
"RTN","PSOLBL",18,0)
HLEX K RXPI,PSORX,RXP,PSOIOS,PSOLAPPL,XXX,COPAYVAR,TECH,PHYS,MFG,NURSE,STATE,SIDE,COPIES,EXDT,ISD,PSOINST,RXN,RXY,VADT,DEA,WARN,FDT,QTY,PATST,PDA,PS,PS1,PS2,PSL,PSNP,INRX,RR,XTYPE,SSNP,SSNPN,PNM,ADDR,PSODBQ,PSOLASTF,PSRESOLV,PSOEXREP,PSOSXQ
"RTN","PSOLBL",19,0)
 K ^TMP($J,"PSOCP",+$G(PSOCPN)),PSOCPN,PSOLBLDR,PSOLBLPS,PSOLBLCP,RXPR,RXRP,RXRS,PSOCKHN,RXFLX,PSOLAPPL,PSOPDFN,PSDFNFLG,PSOZERO,NEXTRX,PSOBLALL,STA S:'$G(PSOSUREP)&('$G(PSOSUSPR)) ZTREQ="@" Q
"RTN","PSOLBL",20,0)
C I $G(IOST(0)),$D(^%ZIS(2,IOST(0),55,"B","LL")) G C^PSOLLLI
"RTN","PSOLBL",21,0)
 U IO S X=$S('$P(^PS(59,PSOSITE,1),"^",28):132,1:158) X ^%ZOSF("RM") Q:'$D(^PSRX(RX,0))
"RTN","PSOLBL",22,0)
 S:$G(PSOBLALL) PSOBLRX=RX
"RTN","PSOLBL",23,0)
 S:$D(RXRP(RX)) REPRINT=1 S:$D(RXPR(RX)) RXP=RXPR(RX)
"RTN","PSOLBL",24,0)
 I $G(PSOSUREP)!($G(PSOEXREP)) S REPRINT=1 S:'$G(RXRP(RX)) RXRP(RX)=1
"RTN","PSOLBL",25,0)
 S RXY=^PSRX(RX,0),RXSTA=$P(^PSRX(RX,"STA"),"^") I RXSTA>11 D AL("QT") K RXY,RXP,REPRINT Q         ;*244
"RTN","PSOLBL",26,0)
 I RXSTA=3 D AL("QT") K RXY,RXP,REPRINT Q
"RTN","PSOLBL",27,0)
 I $G(RXPR(RX)),'$D(^PSRX(RX,"P",RXP,0)) K RXY,RXP,REPRINT Q
"RTN","PSOLBL",28,0)
 I $P($G(RXFL(RX)),"^"),'$D(^PSRX(RX,1,$P($G(RXFL(RX)),"^"),0)) K RXY,RXP,REPRINT Q
"RTN","PSOLBL",29,0)
 I $G(PSODBQ)!($G(RXRS(RX))) S RR=$O(^PS(52.5,"B",RX,0)) Q:'RR  I $G(^PS(52.5,RR,"P"))=1 K RXY,RXP,REPRINT Q
"RTN","PSOLBL",30,0)
 I $G(RXRS(RX))!($G(PSOPULL)) S PSOSXQ=0 N DR,DA,DIE D  I $G(PSOSXQ) K RXY,RXP,REPRINT Q
"RTN","PSOLBL",31,0)
 .S DA=$O(^PS(52.5,"B",RX,0)) Q:'DA  S A=$P($G(^PS(52.5,DA,0)),"^",7) Q:A=""
"RTN","PSOLBL",32,0)
 .I A="Q" S DIE="^PS(52.5,",DR="3////P" D ^DIE Q
"RTN","PSOLBL",33,0)
 .K RXRS(RX) S PSOSXQ=1
"RTN","PSOLBL",34,0)
 I $G(PSRESOLV)=RX D ENLBL^PSOBSET K PSRESOLV
"RTN","PSOLBL",35,0)
 I RXSTA'=4 D:$G(PSOSUSPR) AREC^PSOSUTL D:$G(PSOPULL)!($G(RXRS(RX))) AREC1^PSOSUTL D:$G(PSOSUREP) AREC^PSOSUSRP D:$G(PSXREP) AREC^PSXSRP
"RTN","PSOLBL",36,0)
 K ^UTILITY("DIQ1",$J) S DA=$P($$SITE^VASITE(),"^") I $G(DA) S DIC=4,DIQ(0)="I",DR="99" D EN^DIQ1 S PSOINST=$G(^UTILITY("DIQ1",$J,4,DA,99,"I")) K ^UTILITY("DIQ1",$J),DA,DR,DIC
"RTN","PSOLBL",37,0)
 S RXN=$P(RXY,"^"),ISD=$P(RXY,"^",13),RXF=0,DFN=+$P(RXY,"^",2),SIG=$P($G(^PSRX(RX,"SIG")),"^"),ISD=$E(ISD,4,5)_"/"_$E(ISD,6,7)_"/"_($E(ISD,1,3)+1700),ZY=0,$P(LINE,"_",28)="_"
"RTN","PSOLBL",38,0)
 S PSOLBLPS=+$P(RXY,"^",3),PSOLBLDR=+$P(RXY,"^",6)
"RTN","PSOLBL",39,0)
 S NURSE=$S($P($G(^DPT(DFN,"NHC")),"^")="Y":1,$P($G(^PS(55,DFN,40)),"^"):1,1:0) S FDT=$P(^PSRX(RX,2),"^",2),PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:""),PS1=$S($D(^(1)):^(1),1:""),PSOSITE7=$P(^("IB"),"^")
"RTN","PSOLBL",40,0)
 S PS2=$P(PS,"^")_"^"_$P(PS,"^",6)
"RTN","PSOLBL",41,0)
 S (EXPDT,EXDT)=$P(^PSRX(RX,2),"^",6),EXDT=$S('EXDT:"",1:$E(EXDT,4,5)_"/"_$E(EXDT,6,7)_"/"_($E(EXDT,1,3)+1700))
"RTN","PSOLBL",42,0)
 S COPIES=$S($P($G(RXRP(RX)),"^",2):$P($G(RXRP(RX)),"^",2),$P(RXY,"^",18)]"":$P(RXY,"^",18),1:1)
"RTN","PSOLBL",43,0)
 K PSOCKHNX S PSOCKHL=$L(RX),PSOCKHN=$E($G(PSOCKHN),(PSOCKHL+2),999) D  K PSOCKHNX,PSOCKHL,PSOCKHA
"RTN","PSOLBL",44,0)
 .S PSOCKHA=","_RX_","
"RTN","PSOLBL",45,0)
 .I PSOCKHN'[PSOCKHA Q
"RTN","PSOLBL",46,0)
 .S PSOCKHA=$E(PSOCKHA,1,($L(PSOCKHA)-1))
"RTN","PSOLBL",47,0)
 .S PSOCKHNX=$L(PSOCKHN,PSOCKHA)-1
"RTN","PSOLBL",48,0)
 .I +$G(PSOCKHNX)>0 D DOUB
"RTN","PSOLBL",49,0)
 I $O(^PSRX(RX,1,0)),$G(RXFL(RX))'=0 S $P(^PSRX(RX,3),"^",6)="" K ^PSRX(RX,"DAI"),^PSRX(RX,"DRI")
"RTN","PSOLBL",50,0)
 I '$G(RXP),'$O(^PSRX(RX,1,0)) S RXFL(RX)=0
"RTN","PSOLBL",51,0)
 I '$G(RXP) D OSET I '$O(^PSRX(RX,1,0))!($G(RXFL(RX))=0) G ORIG
"RTN","PSOLBL",52,0)
 I $O(^PSRX(RX,1,0)),'$G(RXP),'$G(RXFL(RX)) S XTYPE=1 D REF G STA
"RTN","PSOLBL",53,0)
 I $O(^PSRX(RX,1,0)),'$G(RXP),$G(RXFL(RX)) G STA
"RTN","PSOLBL",54,0)
 I $G(RXP) S XTYPE="P" D REF G STA
"RTN","PSOLBL",55,0)
ORIG S TECH=$P($G(^VA(200,+$P(^PSRX(RX,0),"^",16),0)),"^"),QTY=$P(^PSRX(RX,0),"^",7),PHYS=$S($D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UKN") D 6^VADPT,PID^VADPT S SSNPN=""
"RTN","PSOLBL",56,0)
 S DAYS=$P(^PSRX(RX,0),"^",8),MFG="________",LOT="________"
"RTN","PSOLBL",57,0)
STA S STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UKN")
"RTN","PSOLBL",58,0)
 S DRUG=$$ZZ^PSOSUTL(RX),DEA=$P($G(^PSDRUG(+$P(RXY,"^",6),0)),"^",3),WARN=$P($G(^(0)),"^",8)
"RTN","PSOLBL",59,0)
 S SIDE=$S($P($G(RXRP(RX)),"^",3):1,1:0)
"RTN","PSOLBL",60,0)
 I $G(^PSRX(RX,"P",+$G(RXP),0))]"" S RXPI=RXP D
"RTN","PSOLBL",61,0)
 .S RXP=^PSRX(RX,"P",RXP,0)
"RTN","PSOLBL",62,0)
 .S RXY=$P(RXP,"^")_"^"_$P(RXY,"^",2,6)_"^"_$P(RXP,"^",4)_"^"_$P(RXP,"^",10)_"^"_$P(RXY,"^",9)_"^"_$P($G(^PSRX(RX,"SIG")),"^",2)_"^"_$P(RXP,"^",2)_"^"_$P(RXY,"^",12,14)_"^"_$P(^PSRX(RX,"STA"),"^")_"^"_$P(RXP,"^",7)_"^"_$P(RXY,"^",17,99)
"RTN","PSOLBL",63,0)
 .S FDT=$P(RXP,"^")
"RTN","PSOLBL",64,0)
 S MW=$P(RXY,"^",11) I $G(RXFL(RX))'=0 D:$G(RXFL(RX))  I '$G(RXFL(RX)) F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  S RXF=RXF+1 S:'$G(RXP) MW=$P(^PSRX(RX,1,I,0),"^",2) I +^PSRX(RX,1,I,0)'<FDT S FDT=+^(0)
"RTN","PSOLBL",65,0)
 .I $G(RXFL(RX)),'$D(^PSRX(RX,1,RXFL(RX),0)) K RXFL(RX) Q
"RTN","PSOLBL",66,0)
 .;PSO*7*266
"RTN","PSOLBL",67,0)
 .S RXF=RXFL(RX) S:'$G(RXP) MW=$P($G(^PSRX(RX,1,RXF,0)),"^",2) F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  I +^PSRX(RX,1,I,0)'<FDT S FDT=+^(0)
"RTN","PSOLBL",68,0)
 I MW="W" S PSMP=$G(^PSRX(RX,"MP")) I PSMP]"" D
"RTN","PSOLBL",69,0)
 .S PSJ=0 F PSI=1:1:$L(PSMP) S PSMP(PSI)="",PSJ=PSJ+1 F PSJ=PSJ:1 S PSMP(PSI)=PSMP(PSI)_$P(PSMP," ",PSJ)_" " Q:($L(PSMP(PSI))+$L($P(PSMP," ",PSJ+1))>30)
"RTN","PSOLBL",70,0)
 .K PSMP(PSI)
"RTN","PSOLBL",71,0)
 S X=$S($D(^PS(55,DFN,0)):^(0),1:""),PSCAP=$P(X,"^",2),PS55=$P($G(X),"^",3),PS55X=$P($G(X),"^",5)
"RTN","PSOLBL",72,0)
 I (($G(PS55X)]"")&(PS55>1)&(PS55X<DT)) S PS55=0
"RTN","PSOLBL",73,0)
 S:MW="M" MW=$S((PS55=1!(PS55=4)):"R",1:MW)
"RTN","PSOLBL",74,0)
 S MW=$S(MW="M":"REGULAR",MW="R":"CERTIFIED",1:"WINDOW")
"RTN","PSOLBL",75,0)
 I ($G(PSMP(1))']""&($G(PS55)=2)) S PSMP(1)=$G(SSNPN)
"RTN","PSOLBL",76,0)
 S DATE=$E(FDT,1,7),REF=$P(RXY,"^",9)-RXF S:'$G(RXP) $P(^PSRX(RX,3),"^")=FDT S:REF<1 REF=0 D ^PSOLBL2 S II=RX D ^PSORFL,RFLDT^PSORFL
"RTN","PSOLBL",77,0)
 S PATST=$G(^PS(53,+$P(RXY,"^",3),0)) S PRTFL=1 I REF=0 S:('$P(PATST,"^",5))!(DEA["W")!(DEA[1)!(DEA[2) PRTFL=0
"RTN","PSOLBL",78,0)
 S VRPH=$P(^PSRX(RX,2),"^",10),PSCLN=+$P(RXY,"^",5),PSCLN=$S($D(^SC(PSCLN,0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLBL",79,0)
 S PATST=$P(PATST,"^",2),X1=DT,X2=$P(RXY,"^",8)-10 D C^%DTC:REF I $D(^PSRX(RX,2)),$P(^(2),"^",6),REF,X'<$P(^(2),"^",6) S REF=0,VRPH=$P(^(2),"^",10)
"RTN","PSOLBL",80,0)
 I $G(PSOCHAMP),$G(PSOTRAMT) S COPAYVAR="CHAMPUS" G LBL
"RTN","PSOLBL",81,0)
 I $G(RXP) S COPAYVAR="" G LBL
"RTN","PSOLBL",82,0)
 I $P($G(^PS(53,+$G(PSOLBLPS),0)),"^",7) D SNO G LBL
"RTN","PSOLBL",83,0)
 I $P($G(^PSDRUG(+$G(PSOLBLDR),0)),"^",3)["I"!($P($G(^(0)),"^",3)["S")!($P($G(^(0)),"^",3)["N") D SNO G LBL
"RTN","PSOLBL",84,0)
 I $P(^PSRX(RX,"STA"),"^")>0,$P(^("STA"),"^")'=2,'$G(PSODBQ) D SNO G LBL
"RTN","PSOLBL",85,0)
 I $G(PSOLBLCP)="" D IBCP
"RTN","PSOLBL",86,0)
 N PSOQI S PSOQI=$G(^PSRX(RX,"IBQ")) I $G(PSOLBLCP)=0 D SNO G LBL
"RTN","PSOLBL",87,0)
 I $G(PSOLBLCP)=1 I $P(PSOQI,"^",2)!($P(PSOQI,"^",3))!($P(PSOQI,"^",4))!($P(PSOQI,"^",5))!($P(PSOQI,"^",6))!($P(PSOQI,"^",7))!($P(PSOQI,"^",8)) D SNO G LBL
"RTN","PSOLBL",88,0)
 I $G(PSOLBLCP)=2 I $P(PSOQI,"^")!($P(PSOQI,"^",2))!($P(PSOQI,"^",3))!($P(PSOQI,"^",4))!($P(PSOQI,"^",5))!($P(PSOQI,"^",6))!($P(PSOQI,"^",7))!($P(PSOQI,"^",8)) D SNO G LBL
"RTN","PSOLBL",89,0)
 I $G(PSOLBLCP)=2,'$P($G(^PSRX(RX,"IB")),"^") D SNO G LBL
"RTN","PSOLBL",90,0)
 S PSOCPN=$P(^PSRX(RX,0),"^",2),INRX=$P(^(0),"^") I $G(^TMP($J,"PSOCP",PSOCPN))="" S ^(PSOCPN)=PSOCPN
"RTN","PSOLBL",91,0)
 S ^TMP($J,"PSOCP",PSOCPN,INRX)=INRX_"^"_$$ZZ^PSOSUTL(RX)_"^"_+$G(DAYS) S COPAYVAR="COPAY" K ZDRUG
"RTN","PSOLBL",92,0)
LBL G ^PSOLBLD:$P(^PSRX(RX,"STA"),"^")=4!($$DS^PSSDSAPI&'$G(RXF)&'$G(RXP)&$D(^PS(52.4,RX,1)))
"RTN","PSOLBL",93,0)
 D ^PSOLBLD:$D(^PSRX(RX,"DRI"))&('$G(RXF))&('$G(RXP)) D:$P($G(^PSRX(RX,3)),"^",6)&('$G(RXF))&('$G(RXP)) ^PSOLBLD1 G ^PSOLBL1:'$P(^PS(59,PSOSITE,1),"^",28)
"RTN","PSOLBL",94,0)
 I $$DS^PSSDSAPI,'$G(RXF),'$G(RXP) Q:$D(^PS(52.4,RX,1))
"RTN","PSOLBL",95,0)
 Q:($P(^PSRX(RX,"STA"),"^")=4)!($D(^PSRX(RX,"DRI"))&('$G(RXF))&('$G(RXP)))
"RTN","PSOLBL",96,0)
 S:'$G(COPIES) COPIES=1 G ^PSOLBLN
"RTN","PSOLBL",97,0)
REF F XXX=0:0 S XXX=$O(^PSRX(RX,XTYPE,XXX)) Q:+XXX'>0  D
"RTN","PSOLBL",98,0)
 .S TECH=$S($D(^VA(200,+$P(^PSRX(RX,XTYPE,XXX,0),"^",7),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSOLBL",99,0)
 .S QTY=$P(^PSRX(RX,XTYPE,XXX,0),"^",4),PHYS=$S($D(^VA(200,+$P(^PSRX(RX,XTYPE,XXX,0),"^",17),0)):$P(^(0),"^"),$D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UNKNOWN") D 6^VADPT,PID^VADPT S SSNPN=""
"RTN","PSOLBL",100,0)
 .S DAYS=$P(^PSRX(RX,XTYPE,XXX,0),"^",10),LOT="________",MFG="________"
"RTN","PSOLBL",101,0)
 Q
"RTN","PSOLBL",102,0)
CHECK S PSDFNFLG=0,PSOZERO=$P(PPL,","),PSOPDFN=$P(^PSRX(PSOZERO,0),"^",2)
"RTN","PSOLBL",103,0)
 Q
"RTN","PSOLBL",104,0)
OSET D OSET^PSOLBL1
"RTN","PSOLBL",105,0)
 Q
"RTN","PSOLBL",106,0)
DOUB Q:'$D(RXFL(RX))  I +$G(RXFL(RX))-PSOCKHNX<0 Q
"RTN","PSOLBL",107,0)
 S RXFLX(RX)=$G(RXFL(RX)),RXFL(RX)=$G(RXFL(RX))-PSOCKHNX
"RTN","PSOLBL",108,0)
 Q
"RTN","PSOLBL",109,0)
AL(T) N I,IR,RF,USR,TY,DES S USR=""
"RTN","PSOLBL",110,0)
 I T="UT" D
"RTN","PSOLBL",111,0)
 .N J,RX S USR=$G(DUZ),TY="B",DES="Label never queued to print by User"
"RTN","PSOLBL",112,0)
 .F J=1:1  S RX=+$P(PPL,",",J) Q:'RX  D AL1
"RTN","PSOLBL",113,0)
 I T="QT" D
"RTN","PSOLBL",114,0)
 .S I=+$P(^PSRX(RX,"STA"),"^"),TY=$S((I=3)!(I=16):"H",I=13:"D",1:"C")
"RTN","PSOLBL",115,0)
 .S DES=I_" "_$S((I=3)!(I=16):"HOLD"_$S(I=16:"(PROVIDER)",1:""),(I=12)!(I=14)!(I=15):"DISCONTINUED"_$S(I=14:"(PROVIDER)",I=15:"(EDIT)",1:""),I=13:"DELETED",1:"")
"RTN","PSOLBL",116,0)
 .S DES="Queued label terminated - "_DES D AL1
"RTN","PSOLBL",117,0)
 K %,%H,%I Q
"RTN","PSOLBL",118,0)
AL1 S (IR,I,RF)=0 F  S I=$O(^PSRX(RX,1,I)) Q:'I  S RF=I S:I>5 RF=I+1
"RTN","PSOLBL",119,0)
 S I=0 F  S I=$O(^PSRX(RX,"A",I)) Q:'I  S IR=I
"RTN","PSOLBL",120,0)
 S IR=IR+1,^PSRX(RX,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSOLBL",121,0)
 D NOW^%DTC S ^PSRX(RX,"A",IR,0)=%_"^"_TY_"^"_USR_"^"_$S($G(RXPR(RX)):6,1:RF)_"^"_DES
"RTN","PSOLBL",122,0)
 Q
"RTN","PSOLBL",123,0)
IBCP N X,Y,PSOJJ,PSOLL
"RTN","PSOLBL",124,0)
 S PSOLBLCP="",X=$P($G(^PS(59,+$G(PSOSITE),"IB")),"^")_"^"_$G(DFN) D XTYPE^IBARX
"RTN","PSOLBL",125,0)
 S PSOJJ="" F  S PSOJJ=$O(Y(PSOJJ)) Q:'PSOJJ  S PSOLL="" F  S PSOLL=$O(Y(PSOJJ,PSOLL)) Q:PSOLL=""  S:PSOLL>0 PSOLBLCP=PSOLL
"RTN","PSOLBL",126,0)
 I '$G(PSOLBLCP) S PSOLBLCP=0
"RTN","PSOLBL",127,0)
 Q
"RTN","PSOLBL",128,0)
SNO S COPAYVAR="NO COPAY" Q
"RTN","PSOLBLD")
0^84^B32921586
"RTN","PSOLBLD",1,0)
PSOLBLD ;BHAM ISC/RTR - PRINTS LABEL ;4/14/93
"RTN","PSOLBLD",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**117,251**;DEC 1997;Build 202
"RTN","PSOLBLD",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOLBLD",4,0)
 S HOLDCOPY=COPIES
"RTN","PSOLBLD",5,0)
 N PSODOSEW,PSODRGI S (PSODOSEW,PSODRGI)=0
"RTN","PSOLBLD",6,0)
START ;
"RTN","PSOLBLD",7,0)
 K PSOSERV
"RTN","PSOLBLD",8,0)
 S COPIES=COPIES-1,Y=$P(^PSRX(RX,2),"^",6) X ^DD("DD") S EXPDT=Y,Y=$P(^PSRX(RX,0),"^",13) X ^DD("DD") S ISD=Y
"RTN","PSOLBLD",9,0)
 S Y=DATE X ^DD("DD") S DATE1=Y D NOW^%DTC S Y=% X ^DD("DD") S NOW=Y
"RTN","PSOLBLD",10,0)
 S:'$P($G(^PS(59,+$G(PSOSITE),1)),"^",28) TB1=38,TB2=50,TB3=83 S:$P($G(^PS(59,+$G(PSOSITE),1)),"^",28) TB1=54,TB2=66,TB3=102
"RTN","PSOLBLD",11,0)
 I '$D(^PS(52.4,RX,0)),$P(^PSRX(RX,"STA"),"^")=4 D UNKNOWN D  Q
"RTN","PSOLBLD",12,0)
 .I $P(PSOPAR,"^",31),$P($G(^PSRX(RX,"STA")),"^")=4 D BLANK W @IOF
"RTN","PSOLBLD",13,0)
L1 W !,"***********************************",?TB3 W:$G(RXRP(RX)) "(REPRINT)" I '$G(RXRP(RX)) W $P(PS2,"^",2)," ","("_$P(RXY,"^",16)_"/"_$S(+$G(VRPH):VRPH,1:" ")_")"_" ",$P(NOW,":",1,2)
"RTN","PSOLBLD",14,0)
L2 W !,"* THIS PRESCRIPTION HAS CAUSED A  *",?TB1,"PRESCRIPTION # "_RXN_" HAS",?TB3,RXN,"  ",DATE1,"  Fill ",RXF+1," of ",1+$P(RXY,"^",9)
"RTN","PSOLBLD",15,0)
 I ($P(^PSRX(RX,"STA"),"^")=4)!($D(^PSRX(RX,"DRI"))&('$G(RXF))&('$G(RXP))) D
"RTN","PSOLBLD",16,0)
 .W !,"*     DRUG-DRUG INTERACTION       *",?TB1,"CAUSED A DRUG-DRUG INTERACTION",?TB3,PNM,"  ",SSNP S PSODRGI=1
"RTN","PSOLBLD",17,0)
 .W !,"***********************************",?TB1,"WITH THE FOLLOWING PRESCRIPTION(S):",?TB3,$S($G(OSGY(1))]"":OSGY(1),1:$G(SGY(1)))
"RTN","PSOLBLD",18,0)
 I $$DS^PSSDSAPI&'$G(RXF)&'$G(RXP)&$D(^PS(52.4,RX,1))&'(($P(^PSRX(RX,"STA"),"^")=4)!($D(^PSRX(RX,"DRI"))&('$G(RXF))&('$G(RXP)))) D
"RTN","PSOLBLD",19,0)
 .W !,"*          DOSE WARNING           *",?TB1,"CAUSED A DOSE WARNING:        ",?TB3,PNM,"  ",SSNP S PSODOSEW=1
"RTN","PSOLBLD",20,0)
 .W !,"***********************************",?TB3,$S($G(OSGY(1))]"":OSGY(1),1:$G(SGY(1)))
"RTN","PSOLBLD",21,0)
L5 W !,?TB3,$S($G(OSGY(2))]"":OSGY(2),1:$G(SGY(2)))
"RTN","PSOLBLD",22,0)
 I $G(SGY(3))'="" F SSG=3:1 Q:$G(SGY(SSG))=""  W !,?TB3,$S($G(OSGY(SSG))]"":OSGY(SSG),1:$G(SGY(SSG)))
"RTN","PSOLBLD",23,0)
L6 I $D(^PS(52.4,RX,0)) S SCRIPT=$P(^PS(52.4,RX,0),"^",10),SEV=$P(^PS(52.4,RX,0),"^",9) F X=1:1 S RXX(X)=$P(SCRIPT,",",X),SEV(X)=$P(SEV,",",X) Q:RXX(X)=""  D
"RTN","PSOLBLD",24,0)
 .S SER=SEV(X) S:$G(SER)=1 PSOSERV=1 W !?TB1,$P($G(^PSRX(RXX(X),0)),"^"),?TB2,$S(SER=1:"CRITICAL",SER=2:"SIGNIFICANT",1:"UNKNOWN")," INTERACTION",!?TB1,"  ",$P(^PSDRUG($P(^PSRX(RXX(X),0),"^",6),0),"^") S:SER=1 PSODRGI=1
"RTN","PSOLBLD",25,0)
 I '$D(^PS(52.4,RX,0)),$D(^PSRX(RX,"DRI")) S SCRIPT=$P(^PSRX(RX,"DRI"),"^",2),SEV=$P(^PSRX(RX,"DRI"),"^") F X=1:1 S RXX(X)=$P(SCRIPT,",",X),SEV(X)=$P(SEV,",",X) Q:RXX(X)=""  D
"RTN","PSOLBLD",26,0)
 .S SER=SEV(X) W !,?TB1,$P($G(^PSRX(RXX(X),0)),"^"),?TB2,$S(SER=1:"CRITICAL",SER=2:"SIGNIFICANT",1:"UNKNOWN")," INTERACTION",!?TB1,"  ",$P(^PSDRUG($P(^PSRX(RXX(X),0),"^",6),0),"^") S:SER=1 PSODRGI=1
"RTN","PSOLBLD",27,0)
 I $$DS^PSSDSAPI,($D(^PS(52.4,RX,1))) S T="",T=$P(^PS(52.4,RX,1),"^") D  W !,?TB1,T
"RTN","PSOLBLD",28,0)
 . S T=$S(T=3:"MAX SINGLE DOSE & DAILY DOSE RANGE",T=2:"MAX SINGLE DOSE",T=1:"DAILY DOSE RANGE",1:"") S:T>0 PSODOSEW=1
"RTN","PSOLBLD",29,0)
L7 W !
"RTN","PSOLBLD",30,0)
L8 W !,?TB1,"THIS PRESCRIPTION WAS ENTERED BY: ",?TB3,"Qty: "_$G(QTY),"   ",$G(PHYS)
"RTN","PSOLBLD",31,0)
L9 W !,?TB1,TECH,?TB3,"Tech__________RPh__________"
"RTN","PSOLBLD",32,0)
L10 W !,?TB1,"THIS PRESCRIPTION ",$S('$G(PSOSERV):"MAY REQUIRE",1:"REQUIRES"),?TB3,DRUG
"RTN","PSOLBLD",33,0)
L11 W !,?TB1,$S('$G(PSOSERV):"REVIEWING BY A PHARMACIST",1:"INTERVENTION BY A PHARMACIST"),?TB3,"Routing: "_$S("W"[$E(MW):MW,1:MW_" MAIL")
"RTN","PSOLBLD",34,0)
L12 W !,?TB3,"Days supply: ",$G(DAYS)," Cap: "_$S(PSCAP:"**NON-SFTY**",1:"SAFETY")
"RTN","PSOLBLD",35,0)
L13 W !,?TB3,"Isd: ",ISD," Exp: ",EXPDT
"RTN","PSOLBLD",36,0)
L14 W !,?TB3,"Last Fill: ",$G(PSOLASTF)
"RTN","PSOLBLD",37,0)
L15 W !,?TB3,"Pat. Stat ",PATST," Clinic: ",PSCLN
"RTN","PSOLBLD",38,0)
L16 W !,@IOF
"RTN","PSOLBLD",39,0)
 I COPIES>0 G START
"RTN","PSOLBLD",40,0)
 S COPIES=HOLDCOPY K HOLDCOPY
"RTN","PSOLBLD",41,0)
STORE ;LABEL PRINT NODE
"RTN","PSOLBLD",42,0)
 D NOW^%DTC S NOW=% K %,%H,%I I $G(RXF)="" S RXF=0 F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  S RXF=I
"RTN","PSOLBLD",43,0)
 F IR=0 F FDA=0:0 S FDA=$O(^PSRX(RX,"L",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOLBLD",44,0)
 S IR=IR+1,^PSRX(RX,"L",0)="^52.032DA^"_IR_"^"_IR,PSRXSET=""
"RTN","PSOLBLD",45,0)
 S PSRXSET=NOW_"^"_RXF_"^"_$S($G(PCOMX)]"":$G(PCOMX),1:"From RX number "_$P(^PSRX(RX,0),"^"))
"RTN","PSOLBLD",46,0)
 S PSRXSET=PSRXSET_$S(PSODRGI&(PSODOSEW)&$$DS^PSSDSAPI:" Drug-Drug interaction/dose warning",PSODRGI:" Drug-Drug interaction",PSODOSEW&$$DS^PSSDSAPI:" Dose Warning",1:"")_$S($G(RXRP(RX)):" (Reprint)",1:"")_"^"_PDUZ_"^1"
"RTN","PSOLBLD",47,0)
 S ^PSRX(RX,"L",IR,0)=PSRXSET K PSRXSET
"RTN","PSOLBLD",48,0)
 K:$D(^PS(52.4,RX,0)) RXF,IR,FDA,NOW,I
"RTN","PSOLBLD",49,0)
 I '$D(PSSPND),$P(PSOPAR,"^",18),$D(^PS(52.4,RX,0)) D CHCK2^PSOTRLBL
"RTN","PSOLBLD",50,0)
 I $P(PSOPAR,"^",31),$P($G(^PSRX(RX,"STA")),"^")=4 D BLANK W @IOF
"RTN","PSOLBLD",51,0)
END K:$D(^PS(52.4,RX,0)) PSCLN,DATE1,DRUG,RFLMSG,COPIES,DRUG,LMI,LINE,PS,PS1,PS2,INT,ISD,I1,MW,STATE,SIDE,SGY,PATST,PRTFL,PHYS,SGC,VRPH,NLWS,X1,X2,X,Y,TECH,EXPDT,NURSE,SEV,SCRIPT,RXX,SGY,SER,SSG,RXY,SIGPH,PS55,PS55X K TB1,TB2,TB3,PSOSERV
"RTN","PSOLBLD",52,0)
 Q
"RTN","PSOLBLD",53,0)
UNKNOWN W !!!,"***********************************",?TB1,"PRESCRIPTION # ",$P(^PSRX(RX,0),"^")
"RTN","PSOLBLD",54,0)
 W !,"* THIS PRESCRIPTION HAS CAUSED A  *",?TB1,"  ",$P(^PSDRUG($P(^PSRX(RX,0),"^",6),0),"^"),?TB3,$P(PS2,"^",2)_" ("_$P(RXY,"^",16)_"/"_$S(+$G(VRPH):VRPH,1:" ")_")"_" ",$P($P(NOW,":",1,2),"@")
"RTN","PSOLBLD",55,0)
 W !,"*     DRUG-DRUG INTERACTION       *",?TB3,RXN,"  ",DATE1," Fill ",RXF+1," of ",1+$P(RXY,"^",9)
"RTN","PSOLBLD",56,0)
 W !,"***********************************",?TB1,"The above prescription has a status",?TB3,PNM,"  ",SSNP
"RTN","PSOLBLD",57,0)
 W !,?TB1,"of PENDING due to a DRUG-DRUG INTERACTION.",?TB3,$S($G(OSGY(1))]"":OSGY(1),1:$G(SGY(1)))
"RTN","PSOLBLD",58,0)
 I $G(SGY(2))'="" F SSG=2:1 Q:$G(SGY(SSG))=""  W !,?TB3,$S($G(OSGY(SSG))]"":OSGY(SSG),1:$G(SGY(SSG)))
"RTN","PSOLBLD",59,0)
 W !,?TB1,"Please review printouts of all labels"
"RTN","PSOLBLD",60,0)
 W !,?TB1,"for this patient that follow." D STORE
"RTN","PSOLBLD",61,0)
 W @IOF K PSCLN,DATE1,DRUG,RFLMSG,COPIES,DRUG,LMI,LINE,PS,PS1,PS2,INT,ISD,I1,MW,STATE,SIDE,SIGPH,SGY,PATST,PRTFL,PHYS,SGC,VRPH,NLWS,X1,X2,X,Y,TECH,EXPDT,NURSE,SEV,SCRIPT,RXX,SGY,SER,SSG,RXY,TB1,TB2,TB3,PSOSERV Q
"RTN","PSOLBLD",62,0)
 ;
"RTN","PSOLBLD",63,0)
BLANK ;label between patients
"RTN","PSOLBLD",64,0)
 F ZBLANK=1:1:10 W !
"RTN","PSOLBLD",65,0)
 W !,"**********************NEXT PATIENT*************",?54,"*********NEXT PATIENT***********NEXT PATIENT***"
"RTN","PSOLBLD",66,0)
 K ZBLANK Q
"RTN","PSOLBLN")
0^83^B58195867
"RTN","PSOLBLN",1,0)
PSOLBLN ;BIR/RTR-NEW PRINTS LABEL ;11/18/92
"RTN","PSOLBLN",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**16,36,71,107,110,117,135,233,251**;DEC 1997;Build 202
"RTN","PSOLBLN",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOLBLN",4,0)
 ;External reference to ^VA(200 supported by DBIA 224
"RTN","PSOLBLN",5,0)
 K PSOSTLK,ZTKDRUG I $L($T(PSOSTALK^PSOTALK1)) D PSOSTALK^PSOTALK1 S PSOSTLK=1 ; PRINT SCRIPTALK LABEL IF APPLICABLE
"RTN","PSOLBLN",6,0)
 I $G(IOS),$G(PSOBARS) I $G(PSOBAR0)=""!($G(PSOBAR1)="") S PSOIOS=IOS D DEVBAR^PSOBMST
"RTN","PSOLBLN",7,0)
 I $G(DFN) D ADD^VADPT
"RTN","PSOLBLN",8,0)
 I '$G(COPIES) S COPIES=""
"RTN","PSOLBLN",9,0)
 S ADDR(33)=$G(VAPA(4))_", "_$P($G(VAPA(5)),"^",2)_"  "_$S($G(VAPA(11))]"":$P($G(VAPA(11)),"^",2),1:$G(VAPA(6))),ADDR(22)=""
"RTN","PSOLBLN",10,0)
 S:$G(VAPA(2))]"" ADDR(22)=$G(VAPA(2))_" "_$G(VAPA(3)),ADDR(22)=$E(ADDR(22),1,46) S:ADDR(22)="" ADDR(22)=ADDR(33),ADDR(33)=""
"RTN","PSOLBLN",11,0)
 S ADDR(4)=$S(ADDR(33)="":ADDR(22),1:ADDR(33)) I $G(VAPA(2))="",$G(VAPA(3))="" S ADDR(2)=ADDR(4),ADDR(3)="",ADDR(4)="" G ST
"RTN","PSOLBLN",12,0)
 I $G(VAPA(2))'="",$G(VAPA(3))="" S ADDR(2)=VAPA(2),ADDR(3)=ADDR(4),ADDR(4)="" G ST
"RTN","PSOLBLN",13,0)
 I $G(VAPA(2))="",$G(VAPA(3))'="" S ADDR(2)=VAPA(3),ADDR(3)=ADDR(4),ADDR(4)="" G ST
"RTN","PSOLBLN",14,0)
 S ADDR(2)=$G(VAPA(2)),ADDR(3)=$G(VAPA(3))
"RTN","PSOLBLN",15,0)
ST I $P($G(^PSRX(RX,3)),"^",3) S PSOPROV=+$P(^(0),"^",4) S PSOPROV=$S($G(RXP):+$P($G(RXP),"^",17),$G(RXF):+$P($G(^PSRX(RX,1,RXF,0)),"^",17),1:PSOPROV) S:'$G(PSOPROV) PSOPROV=+$P(^PSRX(RX,0),"^",4) D
"RTN","PSOLBLN",16,0)
 .I +$P($G(^VA(200,PSOPROV,"PS")),"^",7) S:'$P($G(PHYS),"/",2) PHYS=$G(PHYS)_"/"_+$P($G(^PSRX(RX,3)),"^",3)
"RTN","PSOLBLN",17,0)
 ;
"RTN","PSOLBLN",18,0)
 S RXY=^PSRX(RX,0),RXSTA=$P(^PSRX(RX,"STA"),"^")
"RTN","PSOLBLN",19,0)
 S RXN=$P(RXY,"^"),ISD=$P(RXY,"^",13),RXF=0,DFN=+$P(RXY,"^",2),SIG=$P($G(^PSRX(RX,"SIG")),"^"),ISD=$E(ISD,4,5)_"/"_$E(ISD,6,7)_"/"_($E(ISD,1,3)+1700),ZY=0,$P(LINE,"_",28)="_"
"RTN","PSOLBLN",20,0)
 S PSOLBLPS=+$P(RXY,"^",3),PSOLBLDR=+$P(RXY,"^",6)
"RTN","PSOLBLN",21,0)
 S NURSE=$S($P($G(^DPT(DFN,"NHC")),"^")="Y":1,$P($G(^PS(55,DFN,40)),"^"):1,1:0) S FDT=$P(^PSRX(RX,2),"^",2),PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:""),PS1=$S($D(^(1)):^(1),1:""),PSOSITE7=$P(^("IB"),"^")
"RTN","PSOLBLN",22,0)
 S PS2=$P(PS,"^")_"^"_$P(PS,"^",6)
"RTN","PSOLBLN",23,0)
 S (EXPDT,EXDT)=$P(^PSRX(RX,2),"^",6),EXDT=$S('EXDT:"",1:$E(EXDT,4,5)_"/"_$E(EXDT,6,7)_"/"_($E(EXDT,1,3)+1700))
"RTN","PSOLBLN",24,0)
 S COPIES=$S($P($G(RXRP(RX)),"^",2):$P($G(RXRP(RX)),"^",2),$P(RXY,"^",18)]"":$P(RXY,"^",18),1:1)
"RTN","PSOLBLN",25,0)
 S STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UKN")
"RTN","PSOLBLN",26,0)
 S DRUG=$$ZZ^PSOSUTL(RX),DEA=$P($G(^PSDRUG(+$P(RXY,"^",6),0)),"^",3),WARN=$P($G(^(0)),"^",8)
"RTN","PSOLBLN",27,0)
  I $G(^PSRX(RX,"P",+$G(RXP),0))]"" S RXPI=RXP D
"RTN","PSOLBLN",28,0)
 .S RXP=^PSRX(RX,"P",RXP,0)
"RTN","PSOLBLN",29,0)
 .S RXY=$P(RXP,"^")_"^"_$P(RXY,"^",2,6)_"^"_$P(RXP,"^",4)_"^"_$P(RXP,"^",10)_"^"_$P(RXY,"^",9)_"^"_$P($G(^PSRX(RX,"SIG")),"^",2)_"^"_$P(RXP,"^",2)_"^"_$P(RXY,"^",12,14)_"^"_$P(^PSRX(RX,"STA"),"^")_"^"_$P(RXP,"^",7)_"^"_$P(RXY,"^",17,99)
"RTN","PSOLBLN",30,0)
 .S FDT=$P(RXP,"^")
"RTN","PSOLBLN",31,0)
 S MW=$P(RXY,"^",11) I $G(RXFL(RX))'=0 D:$G(RXFL(RX))  I '$G(RXFL(RX)) F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  S RXF=RXF+1 S:'$G(RXP) MW=$P(^PSRX(RX,1,I,0),"^",2) I +^PSRX(RX,1,I,0)'<FDT S FDT=+^(0)
"RTN","PSOLBLN",32,0)
 .I $G(RXFL(RX)),'$D(^PSRX(RX,1,RXFL(RX),0)) K RXFL(RX) Q
"RTN","PSOLBLN",33,0)
 .;PSO*7*266
"RTN","PSOLBLN",34,0)
 .S RXF=RXFL(RX) S:'$G(RXP) MW=$P($G(^PSRX(RX,1,RXF,0)),"^",2) F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  I +^PSRX(RX,1,I,0)'<FDT S FDT=+^(0)
"RTN","PSOLBLN",35,0)
 I MW="W" S PSMP=$G(^PSRX(RX,"MP")) I PSMP]"" D
"RTN","PSOLBLN",36,0)
 .S PSJ=0 F PSI=1:1:$L(PSMP) S PSMP(PSI)="",PSJ=PSJ+1 F PSJ=PSJ:1 S PSMP(PSI)=PSMP(PSI)_$P(PSMP," ",PSJ)_" " Q:($L(PSMP(PSI))+$L($P(PSMP," ",PSJ+1))>30)
"RTN","PSOLBLN",37,0)
 .K PSMP(PSI)
"RTN","PSOLBLN",38,0)
 S X=$S($D(^PS(55,DFN,0)):^(0),1:""),PSCAP=$P(X,"^",2),PS55=$P($G(X),"^",3),PS55X=$P($G(X),"^",5)
"RTN","PSOLBLN",39,0)
 I (($G(PS55X)]"")&(PS55>1)&(PS55X<DT)) S PS55=0
"RTN","PSOLBLN",40,0)
 S:MW="M" MW=$S((PS55=1!(PS55=4)):"R",1:MW)
"RTN","PSOLBLN",41,0)
 S MW=$S(MW="M":"REGULAR",MW="R":"CERTIFIED",1:"WINDOW")
"RTN","PSOLBLN",42,0)
 I ($G(PSMP(1))']""&($G(PS55)=2)) S PSMP(1)=$G(SSNPN)
"RTN","PSOLBLN",43,0)
 S DATE=$E(FDT,1,7),REF=$P(RXY,"^",9)-RXF S:'$G(RXP) $P(^PSRX(RX,3),"^")=FDT S:REF<1 REF=0 D ^PSOLBL2 S II=RX D ^PSORFL,RFLDT^PSORFL
"RTN","PSOLBLN",44,0)
 S PATST=$G(^PS(53,+$P(RXY,"^",3),0)) S PRTFL=1 I REF=0 S:('$P(PATST,"^",5))!(DEA["W")!(DEA[1)!(DEA[2) PRTFL=0
"RTN","PSOLBLN",45,0)
 S VRPH=$P(^PSRX(RX,2),"^",10),PSCLN=+$P(RXY,"^",5),PSCLN=$S($D(^SC(PSCLN,0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLBLN",46,0)
 S PATST=$P(PATST,"^",2),X1=DT,X2=$P(RXY,"^",8)-10 D C^%DTC:REF I $D(^PSRX(RX,2)),$P(^(2),"^",6),REF,X'<$P(^(2),"^",6) S REF=0,VRPH=$P(^(2),"^",10)
"RTN","PSOLBLN",47,0)
 ;
"RTN","PSOLBLN",48,0)
 S COPIES=COPIES-1,$P(ULN,"_",34)="",PSOTRAIL=1 I $G(SIDE) D REP^PSOLBL2 G REP
"RTN","PSOLBLN",49,0)
 S (Y,X1)=EXPDT X ^DD("DD") S EXPDT=Y,Y=$P(^PSRX(RX,0),"^",13) X ^DD("DD") S ISD=Y,X2=DT D ^%DTC S DIFF=X
"RTN","PSOLBLN",50,0)
 S Y=DATE X ^DD("DD") S DATE=Y D NOW^%DTC S Y=% X ^DD("DD") S NOW=Y
"RTN","PSOLBLN",51,0)
 S TECH="("_$S($P($G(^PSRX(+$G(RX),"OR1")),"^",5):$P($G(^PSRX(+$G(RX),"OR1")),"^",5),1:$P(RXY,"^",16))_"/"_$S($G(VRPH)&($P(PSOPAR,"^",32)):VRPH,1:" ")_")"
"RTN","PSOLBLN",52,0)
 S PSZIP=$P(PS,"^",5) S PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLBLN",53,0)
L1 W ?3,"VAMC ",$P(PS,"^",7),", ",STATE,"  ",$G(PSOHZIP),?54,"VAMC ",$P(PS,"^",7),", ",STATE,"  ",$G(PSOHZIP),?102 W $S($D(REPRINT)&($G(PSOBLALL)):"(GROUP REPRINT)",$D(REPRINT):"(REPRINT)",1:"") W:$G(RXP) "(PARTIAL)"
"RTN","PSOLBLN",54,0)
 W !?3,$P(PS2,"^",2),"  ",$P(PS,"^",3),"-",$P(PS,"^",4),"   ",TECH,?54,$P(PS2,"^",2),"  ",$P(PS,"^",3),"-",$P(PS,"^",4),"   ",TECH,?102,$P(PS2,"^",2)," ",TECH," ",NOW
"RTN","PSOLBLN",55,0)
 W !,"Rx# ",RXN,"  ",DATE,"  Fill ",RXF+1," of ",1+$P(RXY,"^",9),?54,"Rx# ",RXN,"  ",DATE,"  Fill ",RXF+1," of ",1+$P(RXY,"^",9),?102,"Rx# ",RXN,"  ",DATE,"  Fill ",RXF+1," of ",1+$P(RXY,"^",9)
"RTN","PSOLBLN",56,0)
 W !,PNM,"  ",$G(SSNPN),?54,PNM,"  ",$G(SSNPN),?102,PNM,"  ",$G(SSNPN)
"RTN","PSOLBLN",57,0)
 F DR=1:1 Q:$G(SGY(DR))=""  D:DR=4!(DR=7)!(DR=10)!(DR=13)  W !,$G(SGY(DR)),?54,$G(SGY(DR)),?102,$S($G(OSGY(DR))]"":OSGY(DR),1:$G(SGY(DR)))
"RTN","PSOLBLN",58,0)
 .F GG=1:1:27 W !
"RTN","PSOLBLN",59,0)
 I DR>4 S KK=$S(DR=5!(DR=8)!(DR=11):2,(DR=6)!(DR=9)!(DR=12):1,1:0) I KK F HH=1:1:KK W !
"RTN","PSOLBLN",60,0)
 I DR=2 W !!
"RTN","PSOLBLN",61,0)
 I DR=3 W !
"RTN","PSOLBLN",62,0)
 W !,$G(PHYS),?54,$G(PHYS),?102,$G(PHYS)
"RTN","PSOLBLN",63,0)
 S PSMF=$S($G(NURSE):"Mfg______Exp______",1:""),PSDU=$P($G(^PSDRUG($P($G(^PSRX(RX,0)),"^",6),660)),"^",8),PSDU=$S(PSDU="":"      "_PSMF,1:PSDU_" "_PSMF)
"RTN","PSOLBLN",64,0)
 W !,"Qty: "_$G(QTY),"  ",$G(PSDU),?54,"Qty: "_$G(QTY),"  ",$G(PSDU),?102,"Qty: "_$G(QTY),"  ",$G(PSDU)
"RTN","PSOLBLN",65,0)
 S ZTKDRUG="XXXXXX   SCRIPTALK RX   XXXXXX"
"RTN","PSOLBLN",66,0)
 I '$G(PSOSTLK) K PSDU,PSMF W !,DRUG,?54,DRUG,?102,DRUG
"RTN","PSOLBLN",67,0)
 I $G(PSOSTLK) K PSDU,PSMF W !,$S($G(PSOSTALK):ZTKDRUG,1:DRUG),?54,DRUG,?102,DRUG
"RTN","PSOLBLN",68,0)
 I $P(RXY,"^",9)-RXF'>0 D ^PSOLBLN1 G L13
"RTN","PSOLBLN",69,0)
 G:DIFF<30 L11
"RTN","PSOLBLN",70,0)
 W !?54,$P(RXY,"^",9)-RXF," Refills remain prior to ",EXPDT,?102,"Mfg "_$G(MFG)_" Lot# "_$G(LOT) G L12
"RTN","PSOLBLN",71,0)
L11 W !?54,"Last fill prior to ",$G(EXPDT),?102,"Mfg "_$G(MFG)_" Lot# "_$G(LOT)
"RTN","PSOLBLN",72,0)
L12 W !,$P(PS,"^",2),?54,$S($L($G(COPAYVAR)):$G(COPAYVAR)_"     ",1:""),"Days Supply: ",$G(DAYS),?102,"Tech__________RPh_________",!,$P(PS,"^",7),", ",STATE,"  ",$G(PSOHZIP)
"RTN","PSOLBLN",73,0)
 ;send a CR for OPTIFIL (P-MT661BC)
"RTN","PSOLBLN",74,0)
 I $G(PSOBARS),$P(PSOPAR,"^",19)'=1 S X="S",X2=PSOINST_"-"_RX S X1=$X W ?54,@PSOBAR1,X2,@PSOBAR0,$C(13) S $X=0 W:IOST["P-MT661BC" !
"RTN","PSOLBLN",75,0)
 E  W !!!
"RTN","PSOLBLN",76,0)
 W !,"FORWARDING SERVICE REQUESTED" W:"C"[$E(MW) !,?21,"CERTIFIED MAIL" W !?54,$G(VAPA(1))
"RTN","PSOLBLN",77,0)
 W !,$S($G(PS55)=2:"***DO NOT MAIL***",1:"***CRITICAL MEDICAL SHIPMENT***"),?54,$G(ADDR(2)),?102,"Routing: "_$S("W"[$E(MW):MW,1:MW_" MAIL")
"RTN","PSOLBLN",78,0)
 W !?54,$G(ADDR(3)),?102,"Days supply: ",$G(DAYS)," Cap: ",$S(PSCAP:"**NON-SFTY**",1:"SAFETY")
"RTN","PSOLBLN",79,0)
 W !?54,$G(ADDR(4)),?102,"Isd: ",ISD," Exp: ",EXPDT
"RTN","PSOLBLN",80,0)
 W !,PNM,?54,"*Indicate address change on back of this form",?102,"Last Fill: ",$G(PSOLASTF)
"RTN","PSOLBLN",81,0)
 W !,$S($D(PSMP(1)):PSMP(1),1:$G(VAPA(1))),?54,"[ ] Permanent",?102,"Pat. Stat ",PATST," Clinic: ",PSCLN
"RTN","PSOLBLN",82,0)
 W !,$S($D(PSMP(2)):PSMP(2),$D(PSMP(1)):"",1:$G(ADDR(2))),?54,"[ ] Temporary until ",$S($P($G(VAPA(10)),"^",2)]"":$P($G(VAPA(10)),"^",2),1:"__/__/__"),?102,$S($G(WARN)'="":"DRUG WARNING "_$G(WARN),1:"")
"RTN","PSOLBLN",83,0)
 W !,$S($D(PSMP(3)):PSMP(3),$D(PSMP(1)):"",1:$G(ADDR(3))),!,$S($D(PSMP(4)):PSMP(4),$D(PSMP(1)):"",1:$G(ADDR(4))),?54,"Signature",ULN
"RTN","PSOLBLN",84,0)
 I $G(PSOBARS) S X="S",X2=PSOINST_"-"_RX S X1=$X W ?102,@PSOBAR1,X2,@PSOBAR0,$C(13) S $X=0
"RTN","PSOLBLN",85,0)
L13 I $G(WARN)'="",'$G(PSOBLALL) I '$G(PSDFNFLG),'$G(PSOLAPPL) D WARN^PSOLBL2
"RTN","PSOLBLN",86,0)
 W @IOF
"RTN","PSOLBLN",87,0)
REP I COPIES>0 S SIDE=1 G ST
"RTN","PSOLBLN",88,0)
 D NOW^%DTC S NOW=% K %,%H,%I I $G(RXF)="" S RXF=0 F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  S RXF=I
"RTN","PSOLBLN",89,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(RX,"L",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOLBLN",90,0)
 S IR=IR+1,^PSRX(RX,"L",0)="^52.032DA^"_IR_"^"_IR
"RTN","PSOLBLN",91,0)
 S ^PSRX(RX,"L",IR,0)=NOW_"^"_$S($G(RXP):99-RXPI,1:RXF)_"^"_$S($G(PCOMX)]"":$G(PCOMX),$G(PCOMH(RX))]"":PCOMH(RX),1:"From RX number "_$P(^PSRX(RX,0),"^"))_$S($G(RXP):" (Partial)",1:"")_$S($D(REPRINT):" (Reprint)",1:"")_"^"_PDUZ
"RTN","PSOLBLN",92,0)
 N PSOBADR,PSOTEMP
"RTN","PSOLBLN",93,0)
 S PSOBADR=$$CHKRX^PSOBAI(RX)
"RTN","PSOLBLN",94,0)
 I $G(PSOBADR) S PSOTEMP=$P(PSOBADR,"^",2),PSOBADR=$P(PSOBADR,"^")
"RTN","PSOLBLN",95,0)
 I $G(PSOBADR),'$G(PSOTEMP) D
"RTN","PSOLBLN",96,0)
 .S IR=IR+1,^PSRX(RX,"L",0)="^52.032DA^"_IR_"^"_IR
"RTN","PSOLBLN",97,0)
 .S ^PSRX(RX,"L",IR,0)=NOW_"^"_$S($G(RXP):99-RXPI,1:RXF)_"^"_"ROUTING="_$G(MW)_" (BAD ADDRESS)"_"^"_PDUZ
"RTN","PSOLBLN",98,0)
 S ^PSRX(RX,"TYPE")=0 K RXF,IR,FDA,NOW,I,PCOMH(RX)
"RTN","PSOLBLN",99,0)
 I $G(WARN)'="" I $G(PSDFNFLG)!($G(PSOLAPPL)) D ALLWARN^PSOLBLN1
"RTN","PSOLBLN",100,0)
 I $G(WARN)="" I $G(PSDFNFLG)!($G(PSOLAPPL)) D ALL^PSOLBLS
"RTN","PSOLBLN",101,0)
 I $G(PSOBLALL) D:$G(WARN)="" ALL^PSOLBLS D:$G(WARN)'="" ALLWARN^PSOLBLN1
"RTN","PSOLBLN",102,0)
 I '$D(PSSPND),$P(PSOPAR,"^",18) I $G(PSDFNFLG)!($G(PSOLAPPL))!($G(PSOBLALL)) D CHCK2^PSOTRLBL
"RTN","PSOLBLN",103,0)
 D:$G(PSOBLALL) TRAIL^PSOLBL2
"RTN","PSOLBLN",104,0)
END ;
"RTN","PSOLBLN",105,0)
 I $D(RXFLX(RX)) S RXFL(RX)=$G(RXFLX(RX)) K RXFLX
"RTN","PSOLBLN",106,0)
 D KILL^PSOLBL2 Q
"RTN","PSOLLL8")
0^62^B27800299
"RTN","PSOLLL8",1,0)
PSOLLL8 ;BIR/JLC - LASER LABEL - CRITICAL INTERACTION ;12/13/02
"RTN","PSOLLL8",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,251**;DEC 1997;Build 202
"RTN","PSOLLL8",3,0)
 ;Reference to PS(56 supported by DBIA 2229
"RTN","PSOLLL8",4,0)
 ;Reference to PSDRUG supported by DBIA 221
"RTN","PSOLLL8",5,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5424
"RTN","PSOLLL8",6,0)
 ;
"RTN","PSOLLL8",7,0)
 S HOLDCOPY=COPIES
"RTN","PSOLLL8",8,0)
START ;
"RTN","PSOLLL8",9,0)
 I $G(PSOIO("CDII"))]"" X PSOIO("CDII")
"RTN","PSOLLL8",10,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL8",11,0)
 K PSOSERV N PSODOSEW,PSODRGI,PSRXSET S (PSODOSEW,PSODRGI)=0
"RTN","PSOLLL8",12,0)
 S COPIES=COPIES-1,Y=$P(^PSRX(RX,2),"^",6) X ^DD("DD") S EXPDT=Y,Y=$P(^PSRX(RX,0),"^",13) X ^DD("DD") S ISD=Y
"RTN","PSOLLL8",13,0)
 S Y=DATE X ^DD("DD") S DATE1=Y D NOW^%DTC S Y=% X ^DD("DD") S NOW=Y
"RTN","PSOLLL8",14,0)
 I '$D(^PS(52.4,RX,0)),$P(^PSRX(RX,"STA"),"^")=4 D UNKNOWN Q
"RTN","PSOLLL8",15,0)
 I '$G(RXRP(RX)) S T=$P(PS2,"^",2)_" "_"("_$P(RXY,"^",16)_"/"_$S(+$G(VRPH):VRPH,1:" ")_")"_" "_$P(NOW,":",1,2) D PRINT(T)
"RTN","PSOLLL8",16,0)
2 ;
"RTN","PSOLLL8",17,0)
 I $D(^PSRX(RX,"DRI")) D M1 S SCRIPT=$P(^PSRX(RX,"DRI"),"^",2),SEV=$P(^PSRX(RX,"DRI"),"^") F X=1:1 S RXX(X)=$P(SCRIPT,",",X),SEV(X)=$P(SEV,",",X) Q:RXX(X)=""  D
"RTN","PSOLLL8",18,0)
 .S:SEV(X)=1 PSOSERV=1
"RTN","PSOLLL8",19,0)
 .S T=$P($G(^PSRX(RXX(X),0)),"^")_"  "_$S(SEV(X)=1:"CRITICAL",SEV(X)=2:"SIGNIFICANT",1:"UNKNOWN")_" INTERACTION   "_$P(^PSDRUG($P(^PSRX(RXX(X),0),"^",6),0),"^") S:SEV(X)=1 PSODRGI=1 D PRINT(T)
"RTN","PSOLLL8",20,0)
 I '$D(^PSRX(RX,"DRI")),$D(^PS(52.4,RX,0)) S SCRIPT=$P(^PS(52.4,RX,0),"^",10),SEV=$P(^PS(52.4,RX,0),"^",9) D M2:SCRIPT="" I SCRIPT'="" D M1 F X=1:1 S RXX(X)=$P(SCRIPT,",",X),SEV(X)=$P(SEV,",",X) Q:RXX(X)=""  D
"RTN","PSOLLL8",21,0)
 .S:SEV(X)=1 PSOSERV=1
"RTN","PSOLLL8",22,0)
 .S T=$P($G(^PSRX(RXX(X),0)),"^")_"     "_$S(SEV(X)=1:"CRITICAL",SEV(X)=2:"SIGNIFICANT",1:"UNKNOWN")_" INTERACTION    "_$P(^PSDRUG($P(^PSRX(RXX(X),0),"^",6),0),"^") S:SEV(X)=1 PSODRGI=1 D PRINT(T)
"RTN","PSOLLL8",23,0)
 I $$DS^PSSDSAPI,($D(^PS(52.4,RX,1))) S T="",T=$P(^PS(52.4,RX,1),"^") D  D:T'="" PRINT(T)
"RTN","PSOLLL8",24,0)
 . S T=$S(T=3:"MAX SINGLE DOSE & DAILY DOSE RANGE",T=2:"MAX SINGLE DOSE",T=1:"DAILY DOSE RANGE",1:""),PSODOSEW=1
"RTN","PSOLLL8",25,0)
 S T="This prescription was entered by: "_TECH_"." D PRINT(T)
"RTN","PSOLLL8",26,0)
 S T="This prescription "_$S('$G(PSOSERV):"may require",1:"requires")_" "_$S('$G(PSOSERV):"reviewing",1:"intervention")_" by a pharmacist." D PRINT(T)
"RTN","PSOLLL8",27,0)
 S T=DATE1_"  Fill "_(RXF+1)_" of "_(1+$P(RXY,"^",9)) D PRINT(T)
"RTN","PSOLLL8",28,0)
 S T=PNM_"  "_SSNP D PRINT(T)
"RTN","PSOLLL8",29,0)
 F SSG=1:1 Q:$G(SGY(SSG))=""  S T=SGY(SSG) D PRINT(T)
"RTN","PSOLLL8",30,0)
 S T="Qty: "_$G(QTY)_"   "_$G(PHYS) D PRINT(T)
"RTN","PSOLLL8",31,0)
 S T="Tech__________RPh__________" D PRINT(T)
"RTN","PSOLLL8",32,0)
 S T=DRUG D PRINT(T)
"RTN","PSOLLL8",33,0)
 S T="Routing: "_$S("W"[$E(MW):MW,1:MW_" MAIL") D PRINT(T)
"RTN","PSOLLL8",34,0)
 S T="Days supply: "_$G(DAYS)_" Cap: "_$S(PSCAP:"**NON-SFTY**",1:"SAFETY") D PRINT(T)
"RTN","PSOLLL8",35,0)
 S T="Isd: "_ISD_" Exp: "_EXPDT D PRINT(T)
"RTN","PSOLLL8",36,0)
 S T="Last Fill: "_$G(PSOFLAST) D PRINT(T)
"RTN","PSOLLL8",37,0)
 S T="Pat. Stat "_PATST_" Clinic: "_PSCLN D PRINT(T)
"RTN","PSOLLL8",38,0)
 W @IOF
"RTN","PSOLLL8",39,0)
 I COPIES>0 G START
"RTN","PSOLLL8",40,0)
 S COPIES=HOLDCOPY K HOLDCOPY
"RTN","PSOLLL8",41,0)
STORE ;LABEL PRINT NODE
"RTN","PSOLLL8",42,0)
 D NOW^%DTC S NOW=% K %,%H,%I I $G(RXF)="" S RXF=0 F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  S RXF=I
"RTN","PSOLLL8",43,0)
 F IR=0 F FDA=0:0 S FDA=$O(^PSRX(RX,"L",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOLLL8",44,0)
 ;S IR=IR+1,^PSRX(RX,"L",0)="^52.032DA^"_IR_"^"_IR,^PSRX(RX,"L",IR,0)=NOW_"^"_RXF_"^"_$S($G(PCOMX)]"":$G(PCOMX),1:"From RX number "_$P(^PSRX(RX,0),"^"))_" Drug-Drug interaction"_$S($G(RXRP(RX)):" (Reprint)",1:"")_"^"_PDUZ_"^1"
"RTN","PSOLLL8",45,0)
 S IR=IR+1,PSRXSET="^52.032DA^"_IR_"^"_IR
"RTN","PSOLLL8",46,0)
 S PSRXSET=NOW_"^"_RXF_"^"_$S($G(PCOMX)]"":$G(PCOMX),1:"From RX number "_$P(^PSRX(RX,0),"^"))
"RTN","PSOLLL8",47,0)
 S PSRXSET=PSRXSET_$S(PSODRGI&(PSODOSEW)&$$DS^PSSDSAPI:" Drug-Drug interaction/dose warning",PSODRGI:" Drug-Drug interaction",PSODOSEW&$$DS^PSSDSAPI:" Dose Warning",1:"")_$S($G(RXRP(RX)):" (Reprint)",1:"")_"^"_PDUZ_"^1"
"RTN","PSOLLL8",48,0)
 S ^PSRX(RX,"L",IR,0)=PSRXSET
"RTN","PSOLLL8",49,0)
 K:$D(^PS(52.4,RX,0)) RXF,IR,FDA,NOW,I
"RTN","PSOLLL8",50,0)
END K:$D(^PS(52.4,RX,0)) PSCLN,DATE1,DRUG,RFLMSG,COPIES,DRUG,LMI,LINE,PS,PS1,PS2,INT,ISD,I1,MW,STATE,SIDE,SGY,PATST,PRTFL,PHYS,SGC,VRPH,NLWS,X1,X2,X,Y,TECH,EXPDT,NURSE,SEV,SCRIPT,RXX,SGY,SER,SSG,RXY,SIGPH,PS55,PS55X K PSOSERV
"RTN","PSOLLL8",51,0)
 Q
"RTN","PSOLLL8",52,0)
UNKNOWN S PSOY=PSOY+(3*PSOYI),T="",$P(T,"*",100)="" D PRINT(T)
"RTN","PSOLLL8",53,0)
 S T="THIS PRESCRIPTION HAS CAUSED A DRUG-DRUG INTERACTION " D PRINT(T)
"RTN","PSOLLL8",54,0)
 S T="",$P(T,"*",100)="" D PRINT(T)
"RTN","PSOLLL8",55,0)
 S T="PRESCRIPTION # "_$P(^PSRX(RX,0),"^")_"  "_$P(^PSDRUG($P(^PSRX(RX,0),"^",6),0),"^") D PRINT(T)
"RTN","PSOLLL8",56,0)
 S T="The above prescription has a status of PENDING due to a DRUG-DRUG INTERACTION." D PRINT(T)
"RTN","PSOLLL8",57,0)
 S T=PNM_"  "_SSNP D PRINT(T)
"RTN","PSOLLL8",58,0)
 S T=$P(PS2,"^",2)_" ("_$P(RXY,"^",16)_"/"_$S(+$G(VRPH):VRPH,1:" ")_")"_" "_$P($P(NOW,":",1,2),"@") D PRINT(T)
"RTN","PSOLLL8",59,0)
 S T=RXN_"  "_DATE1_" Fill "_(RXF+1)_" of "_(1+$P(RXY,"^",9)) D PRINT(T)
"RTN","PSOLLL8",60,0)
 F SSG=1:1 Q:$G(SGY(SSG))=""  S T=SGY(SSG) D PRINT(T)
"RTN","PSOLLL8",61,0)
 S PSOY=PSOY+PSOYI,T="Please review printouts of all labels for this patient that follow." D PRINT(T),STORE
"RTN","PSOLLL8",62,0)
 W @IOF K PSCLN,DATE1,DRUG,RFLMSG,COPIES,DRUG,LMI,LINE,PS,PS1,PS2,INT,ISD,I1,MW,STATE,SIDE,SIGPH,SGY,PATST,PRTFL,PHYS,SGC,VRPH,NLWS,X1,X2,X,Y,TECH,EXPDT,NURSE,SEV,SCRIPT,RXX,SGY,SER,SSG,RXY,PSOSERV Q
"RTN","PSOLLL8",63,0)
 ;
"RTN","PSOLLL8",64,0)
PRINT(T) ;
"RTN","PSOLLL8",65,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL8",66,0)
 W T,!
"RTN","PSOLLL8",67,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL8",68,0)
 Q
"RTN","PSOLLL8",69,0)
 ;
"RTN","PSOLLL8",70,0)
M1 ;
"RTN","PSOLLL8",71,0)
 S PSOY=PSOY+PSOYI,T="Rx# "_RXN_" has caused a DRUG-DRUG INTERACTION with the following prescription(s):" D PRINT(T)
"RTN","PSOLLL8",72,0)
 Q 
"RTN","PSOLLL8",73,0)
M2 ;
"RTN","PSOLLL8",74,0)
 S PSOY=PSOY+PSOYI,T="",T="Rx# "_RXN D PRINT(T)
"RTN","PSOLLL8",75,0)
 Q
"RTN","PSOLLLI")
0^63^B67875911
"RTN","PSOLLLI",1,0)
PSOLLLI ;BIR/JLC - LASER LABELS INITIALIZATION ;11/20/08 12:17pm
"RTN","PSOLLLI",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,157,189,161,244,200,206,225,303,266,326,251**;DEC 1997;Build 202
"RTN","PSOLLLI",3,0)
 ;DBIAs PSDRUG-221, PS(55-2228, SC-10040, IBARX-125, PSXSRP-2201, %ZIS-3435, DPT-3097, ^TMP($J,"PSNPPIO"-3794
"RTN","PSOLLLI",4,0)
 ;External reference to DRUG^PSSWRNA supported by DBIA 4449
"RTN","PSOLLLI",5,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5424
"RTN","PSOLLLI",6,0)
 ;
"RTN","PSOLLLI",7,0)
 ;*244 remove test for partial fill when testing status > 11
"RTN","PSOLLLI",8,0)
 ;
"RTN","PSOLLLI",9,0)
DQ N PSOBIO S (I,PSOIO)=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSOIO($P(X0,"^"))=^(1),PSOIO=1
"RTN","PSOLLLI",10,0)
DQ1 I '$D(PPL) G HLEX
"RTN","PSOLLLI",11,0)
 I $P($G(PSOPAR),"^",30)=2,'$G(PSOEXREP) G HLEX
"RTN","PSOLLLI",12,0)
 K RXFLX S PSOCKHN=","_$G(PPL),PSRESOLV=+PPL D CHECK
"RTN","PSOLLLI",13,0)
 S PSOINT=1 F PI=1:1 S RX=$P(PPL,",",PI) Q:RX=""  D
"RTN","PSOLLLI",14,0)
 . S RXY=$G(^PSRX(RX,0)) Q:RXY=""  I PSOPDFN'=$P(RXY,"^",2),'PSOINT D TRAIL^PSOLLL1 S PSOPDFN=$P(RXY,"^",2)
"RTN","PSOLLLI",15,0)
 . K RXP,REPRINT D C
"RTN","PSOLLLI",16,0)
 I 'PSOINT D TRAIL^PSOLLL1
"RTN","PSOLLLI",17,0)
HLEX K RXPI,PSORX,RXP,PSOIOS,PSOLAPPL,XXX,COPAYVAR,TECH,PHYS,MFG,NURSE,STATE,SIDE,COPIES,EXDT,ISD,PSOINST,RXN,RXY,VADT,DEA,WARN,FDT,QTY,PATST,PDA,PS,PS1,RXP,REPRINT
"RTN","PSOLLLI",18,0)
 K SGY,OSGY,PS2,PSL,PSNP,INRX,RR,XTYPE,SSNP,SSNPN,PNM,ADDR,PSODBQ,PSOLASTF,PSRESOLV,PSOEXREP,PSOSXQ
"RTN","PSOLLLI",19,0)
 K DATE,DR,DRUG,LINE,MW,PRTFL,VRPH,EXPDT,X2,DIFF,DAYS,PSZIP,PSOHZIP,PS55,PS55X
"RTN","PSOLLLI",20,0)
 K ^TMP($J,"PSNPMI"),^TMP($J,"PSOCP",+$G(PSOCPN)),PSOCPN,PSOLBLDR,PSOLBLPS,PSOLBLCP,RXPR,RXRP,RXRS,PSOCKHN,RXFLX,PSOLAPPL,PSOPDFN,PSDFNFLG,PSOZERO,NEXTRX,PSOBLALL,STA
"RTN","PSOLLLI",21,0)
 I '$G(PSOSUREP),'$G(PSOSUSPR) S ZTREQ="@"
"RTN","PSOLLLI",22,0)
 Q
"RTN","PSOLLLI",23,0)
C N PSOBIO S (I,PSOIO)=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSOIO($P(X0,"^"))=^(1),PSOIO=1
"RTN","PSOLLLI",24,0)
 U IO Q:'$D(^PSRX(RX,0))  S RXY=^(0),RX2=^(2),RXSTA=^("STA") K SGY,OSGY
"RTN","PSOLLLI",25,0)
 S (SIGM,PFM,PMIM,L2,L3,L4,L5,FILLCONT,BOTTLBL)=0
"RTN","PSOLLLI",26,0)
 K SIGF,PFF,PMIF S (SIGF,PFF,PMIF)=0 F I="DR","T" S (SIGF(I),PFF(I))=1
"RTN","PSOLLLI",27,0)
 F I="A","B","I" S PMIF(I)=1
"RTN","PSOLLLI",28,0)
 D NOW^%DTC S Y=$P(%,"."),PSOFNOW=% X ^DD("DD") S PSONOW=Y,Y=PSOFNOW X ^DD("DD") S PSONOWT=Y
"RTN","PSOLLLI",29,0)
 S:$G(PSOBLALL) PSOBLRX=RX S:$D(RXRP(RX)) REPRINT=1 S:$D(RXPR(RX)) RXP=RXPR(RX)
"RTN","PSOLLLI",30,0)
 I $G(PSOSUREP)!($G(PSOEXREP)) S REPRINT=1 I '$G(RXRP(RX)) S RXRP(RX)=1
"RTN","PSOLLLI",31,0)
 S A=$P(RXSTA,"^") I A>11 D AL^PSOLBL("QT") K RXP,REPRINT Q      ;*244
"RTN","PSOLLLI",32,0)
 I A=3 D AL^PSOLBL("QT") K RXP,REPRINT Q
"RTN","PSOLLLI",33,0)
 I $G(RXPR(RX)),'$D(^PSRX(RX,"P",RXP,0)) K RXP,REPRINT Q
"RTN","PSOLLLI",34,0)
 I $P($G(RXFL(RX)),"^"),'$D(^PSRX(RX,1,$P($G(RXFL(RX)),"^"),0)) K RXP,REPRINT Q
"RTN","PSOLLLI",35,0)
 I $G(PSODBQ)!($G(RXRS(RX))) S RR=$O(^PS(52.5,"B",RX,0)) Q:'RR  I $G(^PS(52.5,RR,"P"))=1 K RXP,REPRINT Q
"RTN","PSOLLLI",36,0)
 I $G(RXRS(RX))!($G(PSOPULL)) S PSOSXQ=0 N DR,DA,DIE D  I $G(PSOSXQ) K RXP,REPRINT Q
"RTN","PSOLLLI",37,0)
 . S DA=$O(^PS(52.5,"B",RX,0)) Q:'DA
"RTN","PSOLLLI",38,0)
 . S A=$P($G(^PS(52.5,DA,0)),"^",7) I A="" Q
"RTN","PSOLLLI",39,0)
 . I A="Q" S DIE="^PS(52.5,",DR="3////P" D ^DIE Q
"RTN","PSOLLLI",40,0)
 . K RXRS(RX) S PSOSXQ=1
"RTN","PSOLLLI",41,0)
 I $G(PSRESOLV)=RX D ENLBL^PSOBSET K PSRESOLV
"RTN","PSOLLLI",42,0)
 I $P(RXSTA,"^")'=4 D
"RTN","PSOLLLI",43,0)
 . I $G(PSOSUSPR) D AREC^PSOSUTL
"RTN","PSOLLLI",44,0)
 . I $G(PSOPULL)!($G(RXRS(RX))) D AREC1^PSOSUTL
"RTN","PSOLLLI",45,0)
 . I $G(PSOSUREP) D AREC^PSOSUSRP
"RTN","PSOLLLI",46,0)
 . I $G(PSXREP) D AREC^PSXSRP
"RTN","PSOLLLI",47,0)
 S RXY=^PSRX(RX,0),RX2=^(2),RXSTA=^("STA")
"RTN","PSOLLLI",48,0)
 K ^UTILITY("DIQ1",$J) S DA=$P($$SITE^VASITE(),"^")
"RTN","PSOLLLI",49,0)
 I $G(DA) S DIC=4,DIQ(0)="I",DR="99" D EN^DIQ1 S PSOINST=$G(^UTILITY("DIQ1",$J,4,DA,99,"I")) K ^UTILITY("DIQ1",$J),DA,DR,DIC
"RTN","PSOLLLI",50,0)
 S RXN=$P(RXY,"^"),DFN=+$P(RXY,"^",2),PSOLBLPS=+$P(RXY,"^",3),PSOLBLDR=+$P(RXY,"^",6)
"RTN","PSOLLLI",51,0)
 S ISD=$P(RXY,"^",13),RXF=0,SIG=$P($G(^PSRX(RX,"SIG")),"^"),ISD=$E(ISD,4,5)_"/"_$E(ISD,6,7)_"/"_($E(ISD,1,3)+1700),ZY=0,$P(LINE,"_",28)="_"
"RTN","PSOLLLI",52,0)
 S NURSE=$S($P($G(^DPT(DFN,"NHC")),"^")="Y":1,$P($G(^PS(55,DFN,40)),"^"):1,1:0)
"RTN","PSOLLLI",53,0)
 S FDT=$P(RX2,"^",2),PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:""),PS1=$S($D(^(1)):^(1),1:""),PSOSITE7=$P(^("IB"),"^")
"RTN","PSOLLLI",54,0)
 S PS2=$P(PS,"^")_"^"_$P(PS,"^",6)
"RTN","PSOLLLI",55,0)
 S EXPDT=$P(RX2,"^",6),EXDT=$S('EXPDT:"",1:$E(EXPDT,4,5)_"/"_$E(EXPDT,6,7)_"/"_($E(EXPDT,1,3)+1700))
"RTN","PSOLLLI",56,0)
 S COPIES=$S($P($G(RXRP(RX)),"^",2):$P($G(RXRP(RX)),"^",2),$P(RXY,"^",18)]"":$P(RXY,"^",18),1:1)
"RTN","PSOLLLI",57,0)
 K PSOCKHNX S PSOCKHL=$L(RX),PSOCKHN=$E($G(PSOCKHN),(PSOCKHL+2),999) D  K PSOCKHNX,PSOCKHL,PSOCKHA
"RTN","PSOLLLI",58,0)
 .S PSOCKHA=","_RX_","
"RTN","PSOLLLI",59,0)
 .I PSOCKHN'[PSOCKHA Q
"RTN","PSOLLLI",60,0)
 .S PSOCKHA=$E(PSOCKHA,1,($L(PSOCKHA)-1))
"RTN","PSOLLLI",61,0)
 .S PSOCKHNX=$L(PSOCKHN,PSOCKHA)-1
"RTN","PSOLLLI",62,0)
 .I +$G(PSOCKHNX)>0 D DOUB
"RTN","PSOLLLI",63,0)
 I $O(^PSRX(RX,1,0)),$G(RXFL(RX))'=0 S $P(^PSRX(RX,3),"^",6)="" K ^PSRX(RX,"DAI"),^PSRX(RX,"DRI")
"RTN","PSOLLLI",64,0)
 I '$G(RXP),'$O(^PSRX(RX,1,0)) S RXFL(RX)=0
"RTN","PSOLLLI",65,0)
 I '$G(RXP) D OSET I '$O(^PSRX(RX,1,0))!($G(RXFL(RX))=0) G ORIG
"RTN","PSOLLLI",66,0)
 I $O(^PSRX(RX,1,0)),'$G(RXP) D  G STA
"RTN","PSOLLLI",67,0)
 . I '$G(RXFL(RX)) S XTYPE=1 D REF
"RTN","PSOLLLI",68,0)
 I $G(RXP) S XTYPE="P" D REF G STA
"RTN","PSOLLLI",69,0)
ORIG S TECH=$P($G(^VA(200,+$P(RXY,"^",16),0)),"^"),PHYS=$S($D(^VA(200,+$P(RXY,"^",4),0)):$P(^(0),"^"),1:"UKN")
"RTN","PSOLLLI",70,0)
 S DAYS=$P(RXY,"^",8),QTY=$P(RXY,"^",7)
"RTN","PSOLLLI",71,0)
 D 6^VADPT,PID^VADPT6 S SSNPN=""
"RTN","PSOLLLI",72,0)
STA S STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UKN")
"RTN","PSOLLLI",73,0)
 S DRUG=$$ZZ^PSOSUTL(RX),DEA=$P($G(^PSDRUG(+$P(RXY,"^",6),0)),"^",3),WARN=$P($G(^(0)),"^",8)
"RTN","PSOLLLI",74,0)
 S WARN=$$DRUG^PSSWRNA(+$P(RXY,"^",6),+$P(RXY,"^",2))
"RTN","PSOLLLI",75,0)
 S SIDE=$S($P($G(RXRP(RX)),"^",3):1,1:0)
"RTN","PSOLLLI",76,0)
 I $G(^PSRX(RX,"P",+$G(RXP),0))]"" S RXPI=RXP D
"RTN","PSOLLLI",77,0)
 .S RXP=^PSRX(RX,"P",RXP,0)
"RTN","PSOLLLI",78,0)
 .S RXY=$P(RXP,"^")_"^"_$P(RXY,"^",2,6)_"^"_$P(RXP,"^",4)_"^"_$P(RXP,"^",10)_"^"_$P(RXY,"^",9)_"^"_$P($G(^PSRX(RX,"SIG")),"^",2)_"^"_$P(RXP,"^",2)_"^"_$P(RXY,"^",12,14)_"^"_$P(^PSRX(RX,"STA"),"^")_"^"_$P(RXP,"^",7)_"^"_$P(RXY,"^",17,99)
"RTN","PSOLLLI",79,0)
 .S FDT=$P(RXP,"^")
"RTN","PSOLLLI",80,0)
 S MW=$P(RXY,"^",11) I $G(RXFL(RX))'=0 D:$G(RXFL(RX))  I '$G(RXFL(RX)) F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  S RXF=RXF+1 S:'$G(RXP) MW=$P(^PSRX(RX,1,I,0),"^",2) I +^PSRX(RX,1,I,0)'<FDT S FDT=+^(0)
"RTN","PSOLLLI",81,0)
 .I $G(RXFL(RX)),'$D(^PSRX(RX,1,RXFL(RX),0)) K RXFL(RX) Q
"RTN","PSOLLLI",82,0)
 .;PSO*7*266
"RTN","PSOLLLI",83,0)
 .S RXF=RXFL(RX) S:'$G(RXP) MW=$P($G(^PSRX(RX,1,RXF,0)),"^",2) F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  I +^PSRX(RX,1,I,0)'<FDT S FDT=+^(0)
"RTN","PSOLLLI",84,0)
 I MW="W",$G(^PSRX(RX,"MP"))]"" D
"RTN","PSOLLLI",85,0)
 .S PSMP=^PSRX(RX,"MP"),PSJ=0 F PSI=1:1:$L(PSMP) S PSMP(PSI)="",PSJ=PSJ+1 F PSJ=PSJ:1 S PSMP(PSI)=PSMP(PSI)_$P(PSMP," ",PSJ)_" " Q:($L(PSMP(PSI))+$L($P(PSMP," ",PSJ+1))>30)
"RTN","PSOLLLI",86,0)
 .K PSMP(PSI)
"RTN","PSOLLLI",87,0)
 ;New mail codes for CMOP
"RTN","PSOLLLI",88,0)
 S MAILCOM=""
"RTN","PSOLLLI",89,0)
 S X=$G(^PS(55,DFN,0)),PSCAP=$P(X,"^",2),PS55=$P(X,"^",3),PS55X=$P(X,"^",5)
"RTN","PSOLLLI",90,0)
 I PS55X]"",PS55>1,PS55X<DT S PS55=0
"RTN","PSOLLLI",91,0)
 S:MW="M" MW=$S((PS55=1!(PS55=4)):"R",1:MW)
"RTN","PSOLLLI",92,0)
 S MAILCOM=$P($G(^PS(59,PSOSITE,9)),"^")
"RTN","PSOLLLI",93,0)
 S MW=$S(MW="M":"REGULAR",MW="R":"CERTIFIED",1:"WINDOW")
"RTN","PSOLLLI",94,0)
 I $G(PSMP(1))="",$G(PS55)=2 S PSMP(1)=$G(SSNPN)
"RTN","PSOLLLI",95,0)
 S DATE=$E(FDT,1,7),REF=$P(RXY,"^",9)-RXF S:'$G(RXP) $P(^PSRX(RX,3),"^")=FDT S:REF<1 REF=0 D ^PSOLBL2 S II=RX D ^PSORFL,RFLDT^PSORFL
"RTN","PSOLLLI",96,0)
 S (X,PSOFLAST)=$G(PSOLASTF) I X?1N.E D ^%DT X ^DD("DD") S PSOFLAST=Y
"RTN","PSOLLLI",97,0)
 S PATST=$G(^PS(53,+$P(RXY,"^",3),0)) S PRTFL=1 I REF=0 S:('$P(PATST,"^",5))!(DEA["W")!(DEA[1)!(DEA[2) PRTFL=0
"RTN","PSOLLLI",98,0)
 S VRPH=$P(RX2,"^",10),PSCLN=+$P(RXY,"^",5),PSCLN=$G(^SC(PSCLN,0)),PSCLN=$S($P(PSCLN,"^",2)'="":$P(PSCLN,"^",2),1:$E($P(PSCLN,"^"),1,7)) I PSCLN="" S PSCLN="UNKNOWN"
"RTN","PSOLLLI",99,0)
 S PATST=$P(PATST,"^",2),X1=DT,X2=$P(RXY,"^",8)-10 D C^%DTC:REF I $D(^PSRX(RX,2)),$P(^(2),"^",6),REF,X'<$P(^(2),"^",6) S REF=0,VRPH=$P(^(2),"^",10)
"RTN","PSOLLLI",100,0)
 I $G(PSOCHAMP),$G(PSOTRAMT) S COPAYVAR="CHAMPUS" G LBL
"RTN","PSOLLLI",101,0)
 I $G(RXP) S COPAYVAR="" G LBL
"RTN","PSOLLLI",102,0)
 I $P($G(^PS(53,+$G(PSOLBLPS),0)),"^",7) D SNO G LBL
"RTN","PSOLLLI",103,0)
 I DEA["I"!(DEA["S")!(DEA["N") D SNO G LBL
"RTN","PSOLLLI",104,0)
 I $P(^PSRX(RX,"STA"),"^")>0,$P(^("STA"),"^")'=2,'$G(PSODBQ) D SNO G LBL
"RTN","PSOLLLI",105,0)
 I $G(PSOLBLCP)="" D IBCP
"RTN","PSOLLLI",106,0)
 N PSOQI S PSOQI=$G(^PSRX(RX,"IBQ"))
"RTN","PSOLLLI",107,0)
 I $G(PSOLBLCP)=0 D SNO G LBL
"RTN","PSOLLLI",108,0)
 I $G(PSOLBLCP)=1 I $P(PSOQI,"^",2)!($P(PSOQI,"^",3))!($P(PSOQI,"^",4))!($P(PSOQI,"^",5))!($P(PSOQI,"^",6))!($P(PSOQI,"^",7))!($P(PSOQI,"^",8)) D SNO G LBL
"RTN","PSOLLLI",109,0)
 I $G(PSOLBLCP)=2 I $P(PSOQI,"^")!($P(PSOQI,"^",2))!($P(PSOQI,"^",3))!($P(PSOQI,"^",4))!($P(PSOQI,"^",5))!($P(PSOQI,"^",6))!($P(PSOQI,"^",7))!($P(PSOQI,"^",8)) D SNO G LBL
"RTN","PSOLLLI",110,0)
 I $G(PSOLBLCP)=2,'$P($G(^PSRX(RX,"IB")),"^") D SNO G LBL
"RTN","PSOLLLI",111,0)
 S PSOCPN=$P(RXY,"^",2),INRX=$P(RXY,"^")
"RTN","PSOLLLI",112,0)
 I $G(^TMP($J,"PSOCP",PSOCPN))="" S ^(PSOCPN)=PSOCPN
"RTN","PSOLLLI",113,0)
 S ^TMP($J,"PSOCP",PSOCPN,INRX)=INRX_"^"_$$ZZ^PSOSUTL(RX)_"^"_+$G(DAYS),COPAYVAR="COPAY" K ZDRUG
"RTN","PSOLLLI",114,0)
LBL I $G(PSOIO("LLI"))]"" X PSOIO("LLI")
"RTN","PSOLLLI",115,0)
 I $P(RXSTA,"^")=4!($D(^PS(52.4,RX,0))) D ^PSOLLL8 Q  ;for a critical interaction entered by a tech - don't allow a label to be printed
"RTN","PSOLLLI",116,0)
 I $D(^PSRX(RX,"DRI")),'$G(RXF),'$G(RXP) D ^PSOLLL8 Q
"RTN","PSOLLLI",117,0)
 I $$DS^PSSDSAPI,($G(^PS(52.4,RX,1))>0),'$G(RXF),'$G(RXP) D ^PSOLLL8 Q  ;DOSE CHECK
"RTN","PSOLLLI",118,0)
 ;N PSODOSCK I $$DS^PSSDSAPI,'$G(RXF),'$G(RXP) S PSODOSCK="",PSODOSCK=$$DCHKL^PSODOSUT(PSODOSCK) I PSODOSCK'="" D ^PSOLLL8 Q  ; DOSE CHECK
"RTN","PSOLLLI",119,0)
 I $P($G(^PSRX(RX,3)),"^",6),'$G(RXF),'$G(RXP) D ^PSOLLL9
"RTN","PSOLLLI",120,0)
 S PSOINT=0 G ^PSOLLL1
"RTN","PSOLLLI",121,0)
REF F XXX=0:0 S XXX=$O(^PSRX(RX,XTYPE,XXX)) Q:+XXX'>0  D
"RTN","PSOLLLI",122,0)
 .S TECH=$S($D(^VA(200,+$P(^PSRX(RX,XTYPE,XXX,0),"^",7),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSOLLLI",123,0)
 .S QTY=$P(^PSRX(RX,XTYPE,XXX,0),"^",4),PHYS=$S($D(^VA(200,+$P(^PSRX(RX,XTYPE,XXX,0),"^",17),0)):$P(^(0),"^"),$D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UNKNOWN") D 6^VADPT,PID^VADPT6 S SSNPN=""
"RTN","PSOLLLI",124,0)
 .S DAYS=$P(^PSRX(RX,XTYPE,XXX,0),"^",10)
"RTN","PSOLLLI",125,0)
 Q
"RTN","PSOLLLI",126,0)
CHECK S PSDFNFLG=0,PSOZERO=$P(PPL,","),PSOPDFN=$P(^PSRX(PSOZERO,0),"^",2)
"RTN","PSOLLLI",127,0)
 Q
"RTN","PSOLLLI",128,0)
OSET ;
"RTN","PSOLLLI",129,0)
 N A
"RTN","PSOLLLI",130,0)
 I $G(RXFL(RX))']""!($G(RXFL(RX))=0) D  Q
"RTN","PSOLLLI",131,0)
 .S A=^PSRX(RX,0)
"RTN","PSOLLLI",132,0)
 .S TECH=$P($G(^VA(200,+$P(A,"^",16),0)),"^"),QTY=$P(A,"^",7),PHYS=$S($D(^VA(200,+$P(A,"^",4),0)):$P(^(0),"^"),1:"UKN") D 6^VADPT,PID^VADPT6 S SSNPN=""
"RTN","PSOLLLI",133,0)
 .S DAYS=$P(A,"^",8)
"RTN","PSOLLLI",134,0)
 I '$D(^PSRX(RX,1,RXFL(RX),0)) K RXFL(RX) Q
"RTN","PSOLLLI",135,0)
 S A=^PSRX(RX,1,RXFL(RX),0)
"RTN","PSOLLLI",136,0)
 S TECH=$S($D(^VA(200,+$P(A,"^",7),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSOLLLI",137,0)
 S QTY=$P(A,"^",4),PHYS=$S($D(^VA(200,+$P(A,"^",17),0)):$P(^(0),"^"),$D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UNKNOWN") D 6^VADPT,PID^VADPT6 S SSNPN=""
"RTN","PSOLLLI",138,0)
 S DAYS=$P(A,"^",10)
"RTN","PSOLLLI",139,0)
 Q
"RTN","PSOLLLI",140,0)
DOUB ;
"RTN","PSOLLLI",141,0)
 Q:'$D(RXFL(RX))
"RTN","PSOLLLI",142,0)
 I +$G(RXFL(RX))-PSOCKHNX<0 Q
"RTN","PSOLLLI",143,0)
 S RXFLX(RX)=$G(RXFL(RX))
"RTN","PSOLLLI",144,0)
 S RXFL(RX)=$G(RXFL(RX))-PSOCKHNX
"RTN","PSOLLLI",145,0)
 Q
"RTN","PSOLLLI",146,0)
IBCP ;
"RTN","PSOLLLI",147,0)
 N X,Y,PSOJJ,PSOLL
"RTN","PSOLLLI",148,0)
 S PSOLBLCP=""
"RTN","PSOLLLI",149,0)
 S X=$P($G(^PS(59,+$G(PSOSITE),"IB")),"^")_"^"_$G(DFN) D XTYPE^IBARX
"RTN","PSOLLLI",150,0)
 S PSOJJ="" F  S PSOJJ=$O(Y(PSOJJ)) Q:'PSOJJ  S PSOLL="" F  S PSOLL=$O(Y(PSOJJ,PSOLL)) Q:PSOLL=""  S:PSOLL>0 PSOLBLCP=PSOLL
"RTN","PSOLLLI",151,0)
 I '$G(PSOLBLCP) S PSOLBLCP=0
"RTN","PSOLLLI",152,0)
 Q
"RTN","PSOLLLI",153,0)
SNO ;
"RTN","PSOLLLI",154,0)
 S COPAYVAR="NO COPAY"
"RTN","PSOLLLI",155,0)
 Q
"RTN","PSOLMAO")
0^2^B1822420
"RTN","PSOLMAO",1,0)
PSOLMAO ;BHAM ISC/LC - ACTIVE ORDERS ; 14-MAR-1995
"RTN","PSOLMAO",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**225,251**;DEC 1997;Build 202
"RTN","PSOLMAO",3,0)
EN ; -- main entry point for PSO LM ACTION ORDER
"RTN","PSOLMAO",4,0)
 D EN^VALM("PSO LM ACTIVE ORDERS")
"RTN","PSOLMAO",5,0)
 Q
"RTN","PSOLMAO",6,0)
 ;
"RTN","PSOLMAO",7,0)
HDR ; -- header code
"RTN","PSOLMAO",8,0)
 D HDR^PSOLMUTL
"RTN","PSOLMAO",9,0)
 Q
"RTN","PSOLMAO",10,0)
 ;
"RTN","PSOLMAO",11,0)
INIT ; -- init variables and list array
"RTN","PSOLMAO",12,0)
 S VALMCNT=PSOPF D RV^PSOORFL
"RTN","PSOLMAO",13,0)
 Q
"RTN","PSOLMAO",14,0)
 ;
"RTN","PSOLMAO",15,0)
HELP ; -- help code
"RTN","PSOLMAO",16,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","PSOLMAO",17,0)
 Q
"RTN","PSOLMAO",18,0)
 ;
"RTN","PSOLMAO",19,0)
EXIT ; -- exit code
"RTN","PSOLMAO",20,0)
 D KILL^VALM10() K PSODCREV S PSOQFLG=1
"RTN","PSOLMAO",21,0)
 Q
"RTN","PSOLMAO",22,0)
 ;
"RTN","PSOLMAO",23,0)
EXPND ; -- expand code
"RTN","PSOLMAO",24,0)
 Q
"RTN","PSOLMAO",25,0)
 ;
"RTN","PSOLMAO",26,0)
PENTRY ;
"RTN","PSOLMAO",27,0)
 D KILL^VALM10()
"RTN","PSOLMAO",28,0)
 N PSORVIEN
"RTN","PSOLMAO",29,0)
 I $O(PSODCREV(0)) F PSORVIEN=0:0 S PSORVIEN=$O(PSODCREV(PSORVIEN)) Q:'PSORVIEN  D
"RTN","PSOLMAO",30,0)
 .I '$D(IORVON),$D(IOST(0)) D ENS^%ZISS,TERM^VALM0
"RTN","PSOLMAO",31,0)
 .D CNTRL^VALM10(PSORVIEN,1,80,IORVON,IORVOFF,0)
"RTN","PSOLMAO",32,0)
 K PSORVIEN
"RTN","PSOLMAO",33,0)
 S VALMCNT=$G(PSOPF)
"RTN","PSOLMAO",34,0)
 Q:'$G(VALMCNT)
"RTN","PSOLMAO",35,0)
 N PSLIST S PSLIST=0 F PSLIST=1:1:VALMCNT I $D(^TMP("PSOPF",$J,PSLIST,"RV")) D
"RTN","PSOLMAO",36,0)
 . D CNTRL^VALM10(PSLIST,1,3,IORVON,IORVOFF,0)
"RTN","PSOLMAO",37,0)
 Q
"RTN","PSON52")
0^43^B70712029
"RTN","PSON52",1,0)
PSON52 ;BIR/DSD - files new entries in prescription file ;08/09/93
"RTN","PSON52",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,16,23,27,32,46,71,111,124,117,131,139,157,143,219,148,239,201,268,260,225,303,358,251**;DEC 1997;Build 202
"RTN","PSON52",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSON52",4,0)
 ;External reference to PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSON52",5,0)
 ;External reference to ^XUSEC supported by DBIA 10076
"RTN","PSON52",6,0)
 ;External reference SWSTAT^IBBAPI supported by DBIA 4663
"RTN","PSON52",7,0)
 ;External reference SAVNDC^PSSNDCUT supported by DBIA 4707
"RTN","PSON52",8,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5424
"RTN","PSON52",9,0)
EN(PSOX) ;Entry Point
"RTN","PSON52",10,0)
START ;
"RTN","PSON52",11,0)
 D:$D(XRTL) T0^%ZOSV ; Start RT Monitor
"RTN","PSON52",12,0)
 D INIT G:PSON52("QFLG") END D NFILE Q:$G(PSONEW("DFLG"))
"RTN","PSON52",13,0)
 D PS55,DIK
"RTN","PSON52",14,0)
 S:$D(XRT0) XRTN=$T(+0) D:$D(XRT0) T1^%ZOSV ; Stop RT Monitor
"RTN","PSON52",15,0)
 D FINISH
"RTN","PSON52",16,0)
 I $P(^PSRX(PSOX("IRXN"),0),"^",11)="W",$G(^("IB")) S ^PSRX("ACP",$P(^PSRX(PSOX("IRXN"),0),"^",2),$P(^(2),"^",2),0,PSOX("IRXN"))=""
"RTN","PSON52",17,0)
END D EOJ
"RTN","PSON52",18,0)
 Q
"RTN","PSON52",19,0)
INIT ;
"RTN","PSON52",20,0)
 K X,%DT S:$G(PSOID) PSOX("ISSUE DATE")=PSOID
"RTN","PSON52",21,0)
 S PSOX("CS")=0
"RTN","PSON52",22,0)
 F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S $P(PSOX("CS"),"^")=1 S:$E(+PSODRUG("DEA"),DEA)=2 $P(PSOX("CS"),"^",2)=1
"RTN","PSON52",23,0)
 S PSON52("QFLG")=0,X1=PSOX("ISSUE DATE"),X2=PSOX("DAYS SUPPLY")*(PSOX("# OF REFILLS")+1)\1
"RTN","PSON52",24,0)
 I $D(CLOZPAT) S X2=$S(X2=14:14,X2=7:7,1:X2) G DT
"RTN","PSON52",25,0)
 S X2=$S(PSOX("DAYS SUPPLY")=X2:X2,+$G(PSOX("CS")):184,+$G(DEA("CS")):184,1:366)
"RTN","PSON52",26,0)
 I X2<30 D
"RTN","PSON52",27,0)
 . N % S %=$P($G(PSORX("PATIENT STATUS")),"^"),X2=30
"RTN","PSON52",28,0)
 . S:%?.N %=$P($G(^PS(53,+%,0)),"^") I %["AUTH ABS" S X2=5
"RTN","PSON52",29,0)
DT D C^%DTC S PSOX("STOP DATE")=$P(X,".") K X
"RTN","PSON52",30,0)
 I PSOX("# OF REFILLS")>0 S X1=PSOX("FILL DATE"),X2=$S((PSOX("DAYS SUPPLY")-10\1)<1:1,1:PSOX("DAYS SUPPLY")-10\1) D C^%DTC S PSOX("NEXT POSSIBLE REFILL")=$P(X,".") K X
"RTN","PSON52",31,0)
 S PSOX("TYPE OF RX")=0,PSOX("DISPENSED DATE")=PSOX("FILL DATE") D NOW^%DTC S PSOX("LOGIN DATE")=$S($P($G(OR0),"^",12):$P($G(OR0),"^",12),1:%) K %,X
"RTN","PSON52",32,0)
 S PSOX("STATUS")=$S($G(PSOX("STATUS"))]"":PSOX("STATUS"),$D(PSORX("VERIFY")):1,1:0)
"RTN","PSON52",33,0)
 S PSOX("COPIES")=$S($G(PSOX("COPIES"))]"":PSOX("COPIES"),1:1)
"RTN","PSON52",34,0)
 I $G(PSORX("PHARM"))]"" S PSOX("PHARMACIST")=PSORX("PHARM") K PSORX("PHARM")
"RTN","PSON52",35,0)
INITX Q
"RTN","PSON52",36,0)
 ;
"RTN","PSON52",37,0)
NFILE I $G(OR0) D  Q:$G(PSONEW("DFLG"))
"RTN","PSON52",38,0)
 .D NOOR^PSONEW Q:$G(PSONEW("DFLG"))
"RTN","PSON52",39,0)
 .I $G(PSOSIGFL)!($G(PSODRUG("OI"))'=$P(OR0,"^",8)) S PSONEW("CLERK CODE")=DUZ,PSONEW("REMARKS")=$G(PSONEW("REMARKS"))_" CPRS Order #"_$P(OR0,"^")_" Edited."
"RTN","PSON52",40,0)
 S DIC="^PSRX(",DLAYGO=52,DIC(0)="L",X=PSOX("RX #") K DD,DO D FILE^DICN S PSOX("IRXN")=+Y K DLAYGO,X,Y,DIC,DD,DO
"RTN","PSON52",41,0)
 F PSOX1=0:1 S PSON52=$P($T(DD+PSOX1),";;",2,4) Q:PSON52=""  K PSOY S PSOY=$P(PSON52,";;") I $G(@PSOY)]"" S $P(PSON52(PSOX("IRXN"),$P(PSON52,";;",2)),"^",$P(PSON52,";;",3))=@PSOY
"RTN","PSON52",42,0)
 F I=1:1:PSOX("ENT") S ^PSRX(PSOX("IRXN"),6,I,0)=PSOX("DOSE",I)_"^"_$G(PSOX("DOSE ORDERED",I))_"^"_$G(PSOX("UNITS",I))_"^"_$G(PSOX("NOUN",I))_"^" D
"RTN","PSON52",43,0)
 .S ^PSRX(PSOX("IRXN"),6,I,0)=^PSRX(PSOX("IRXN"),6,I,0)_$G(PSOX("DURATION",I))_"^"_$G(PSOX("CONJUNCTION",I))_"^"_$G(PSOX("ROUTE",I))_"^"_$G(PSOX("SCHEDULE",I))_"^"_$G(PSOX("VERB",I))
"RTN","PSON52",44,0)
 .I $G(PSOX("ODOSE",I))]"" S ^PSRX(PSOX("IRXN"),6,I,1)=PSOX("ODOSE",I)
"RTN","PSON52",45,0)
 I '$G(PSORX("VERIFY")),($P($G(PSOPAR),"^",2)),$$DS^PSSDSAPI&+$G(^TMP("PSODOSF",$J,0)) S PSORX("VERIFY")=1,PSOX("STATUS")=4,PSON52(PSOX("IRXN"),"STA")=4
"RTN","PSON52",46,0)
 S ^PSRX(PSOX("IRXN"),6,0)="^52.0113^"_PSOX("ENT")_"^"_PSOX("ENT")
"RTN","PSON52",47,0)
 K PSOX1,PSOY
"RTN","PSON52",48,0)
 S PSOX1="" F  S PSOX1=$O(PSON52(PSOX("IRXN"),PSOX1)) Q:PSOX1=""  S ^PSRX(PSOX("IRXN"),PSOX1)=$G(PSON52(PSOX("IRXN"),PSOX1))
"RTN","PSON52",49,0)
 I $O(PSOX("SIG",0)) D
"RTN","PSON52",50,0)
 .S D=0 F  S D=$O(PSOX("SIG",D)) Q:'D  S ^PSRX(PSOX("IRXN"),"INS1",D,0)=PSOX("SIG",D),TP=$G(TP)+1
"RTN","PSON52",51,0)
 .S ^PSRX(PSOX("IRXN"),"INS1",0)="^52.0115^"_TP_"^"_TP_"^"_DT_"^^" K TP,D
"RTN","PSON52",52,0)
 I $G(PSOX("SINS"))]"" S ^PSRX(PSOX("IRXN"),"INSS")=PSOX("SINS")
"RTN","PSON52",53,0)
 I $G(SIGOK) D
"RTN","PSON52",54,0)
 .S $P(^PSRX(PSOX("IRXN"),"SIG"),"^",2)=1,^PSRX(PSOX("IRXN"),"SIG1",0)="^52.04A^^"
"RTN","PSON52",55,0)
 .S D=0 F  S D=$O(SIG(D)) Q:'D  S ^PSRX(PSOX("IRXN"),"SIG1",D,0)=SIG(D),$P(^PSRX(PSOX("IRXN"),"SIG1",0),"^",3)=+$P(^PSRX(PSOX("IRXN"),"SIG1",0),"^",3)+1,$P(^(0),"^",4)=+$P(^(0),"^",4)+1 Q:'$O(SIG(D))
"RTN","PSON52",56,0)
 .K SIG
"RTN","PSON52",57,0)
 I $D(PSOINSFL) S ^PSRX(PSOX("IRXN"),"A",0)="^52.3DA^1^1",^PSRX(PSOX("IRXN"),"A",1,0)=DT_"^G^^0^Patient Instructions "_$S(PSOINSFL=1:"",1:"Not ")_"Sent By Provider."
"RTN","PSON52",58,0)
 I $G(OR0) S:$P(OR0,"^",24) ^PSRX(PSOX("IRXN"),"PKI")=1
"RTN","PSON52",59,0)
 K PSOX1,PSOFINFL,HLDSIG,D,PSOINSFL,D
"RTN","PSON52",60,0)
 D:$G(^TMP("PSODAI",$J,0))
"RTN","PSON52",61,0)
 .S $P(^PSRX(PSOX("IRXN"),3),"^",6)=1
"RTN","PSON52",62,0)
 .I $O(^TMP("PSODAI",$J,0)) S DAI=0 F  S DAI=$O(^TMP("PSODAI",$J,DAI)) Q:'DAI  D
"RTN","PSON52",63,0)
 ..S:'$D(^PSRX(PSOX("IRXN"),"DAI",0)) ^PSRX(PSOX("IRXN"),"DAI",0)="^52.03^^" S ^PSRX(PSOX("IRXN"),"DAI",DAI,0)=^TMP("PSODAI",$J,DAI,0)
"RTN","PSON52",64,0)
 ..S $P(^PSRX(PSOX("IRXN"),"DAI",0),"^",3)=+$P(^PSRX(PSOX("IRXN"),"DAI",0),"^",3)+1,$P(^(0),"^",4)=+$P(^(0),"^",4)+1
"RTN","PSON52",65,0)
 .K ^TMP("PSODAI",$J),DAI
"RTN","PSON52",66,0)
 I $G(PSOX("CHCS NUMBER"))'="" S $P(^PSRX(PSOX("IRXN"),"EXT"),"^")=$G(PSOX("CHCS NUMBER"))
"RTN","PSON52",67,0)
 I $G(PSOX("EXTERNAL SYSTEM"))'="" S $P(^PSRX(PSOX("IRXN"),"EXT"),"^",2)=$G(PSOX("EXTERNAL SYSTEM"))
"RTN","PSON52",68,0)
 I $G(PSOX("NEWCOPAY")) S ^PSRX(PSOX("IRXN"),"IB")=$G(PSOX("NEWCOPAY"))
"RTN","PSON52",69,0)
 ;Next line, set SC question based on Copay status?
"RTN","PSON52",70,0)
IBQ ;I $G(PSOBILL)=2 S ^PSRX(PSOX("IRXN"),"IBQ")=$S($G(PSOX("NEWCOPAY")):0,1:1)
"RTN","PSON52",71,0)
 N PSOSCFLD S PSOSCFLD=$S(PSOSCP'="":$G(PSOANSQ("SC")),1:"")_"^"_$G(PSOANSQ("MST"))_"^"_$G(PSOANSQ("VEH"))_"^"_$G(PSOANSQ("RAD"))_"^"_$G(PSOANSQ("PGW"))_"^"_$G(PSOANSQ("HNC"))_"^"_$G(PSOANSQ("CV"))_"^"_$G(PSOANSQ("SHAD"))
"RTN","PSON52",72,0)
 I PSOSCP<50&($TR(PSOSCFLD,"^")'="")&($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)'=1) D
"RTN","PSON52",73,0)
 . S ^PSRX(PSOX("IRXN"),"IBQ")=PSOSCFLD K PSOSCFLD  ;don't set if SC % is null or 0, just set it in ICD node
"RTN","PSON52",74,0)
 D ICD^PSODIAG
"RTN","PSON52",75,0)
 D:$$SWSTAT^IBBAPI() GACT^PSOPFSU0(PSOX("IRXN"),0)
"RTN","PSON52",76,0)
 K PSOANSQ,PSOANSQD,PSOX("NEWCOPAY")
"RTN","PSON52",77,0)
 L -^PSRX("B",PSOX("IRXN"))
"RTN","PSON52",78,0)
 Q
"RTN","PSON52",79,0)
 ;
"RTN","PSON52",80,0)
PS55 ;
"RTN","PSON52",81,0)
 L +^PS(55,PSODFN,"P"):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3)
"RTN","PSON52",82,0)
 S:'$D(^PS(55,PSODFN,"P",0)) ^(0)="^55.03PA^^"
"RTN","PSON52",83,0)
 F PSOX1=$P(^PS(55,PSODFN,"P",0),"^",3):1 Q:'$D(^PS(55,PSODFN,"P",PSOX1))
"RTN","PSON52",84,0)
 S PSOX("55 IEN")=PSOX1
"RTN","PSON52",85,0)
 S ^PS(55,PSODFN,"P",PSOX1,0)=PSOX("IRXN"),$P(^PS(55,PSODFN,"P",0),"^",3,4)=PSOX1_"^"_($P(^PS(55,PSODFN,"P",0),"^",4)+1)
"RTN","PSON52",86,0)
 S ^PS(55,PSODFN,"P","A",PSONEW("STOP DATE"),PSOX("IRXN"))=""
"RTN","PSON52",87,0)
PS55X L -^PS(55,PSODFN,"P")
"RTN","PSON52",88,0)
 K PSOX1
"RTN","PSON52",89,0)
 Q
"RTN","PSON52",90,0)
DIK ;
"RTN","PSON52",91,0)
 I $D(^XUSEC("PSORPH",DUZ)) S DA=PSOX("IRXN"),DIE=52,DR="41////"_PSOCOU_";S:'X Y=""@1"";42////"_PSOCOUU_";@1" D ^DIE K DIE,DR
"RTN","PSON52",92,0)
 K DIK,DA S DIK="^PSRX(",DA=PSOX("IRXN") D IX1^DIK K DIK
"RTN","PSON52",93,0)
 S DA=PSOX("IRXN") D ORC^PSORN52C
"RTN","PSON52",94,0)
 Q
"RTN","PSON52",95,0)
FINISH ;
"RTN","PSON52",96,0)
ANQ I $G(ANQDATA)]"" D NOW^%DTC G:$D(^PS(52.52,"B",%)) ANQ D
"RTN","PSON52",97,0)
 .K DD,DO S DIC="^PS(52.52,",DIC(0)="L",DLAYGO=52.52,X=% D FILE^DICN K DIC,DLAYGO,DD,DO
"RTN","PSON52",98,0)
 .S ^PS(52.52,+Y,0)=$P(Y,"^",2)_"^"_PSOX("IRXN")_"^"_ANQDATA,^PS(52.52,"A",PSOX("IRXN"),+Y)="" K ANQDATA,X,Y,%,ANQREM
"RTN","PSON52",99,0)
 ;
"RTN","PSON52",100,0)
 ;I '$G(PSORX("VERIFY")),$$DS^PSSDSAPI&+$G(^TMP("PSODOSF",$J,0)) S PSORX("VERIFY")=1,PSOX("STATUS")=4
"RTN","PSON52",101,0)
 I $G(PSORX("VERIFY")),($P($G(PSOPAR),"^",2)) D  G FINISHP:+$G(^TMP("PSODGS",$J,0))!($D(^TMP("PSODGI",$J,0)))!($D(^TMP("PSODOSF",$J,0))) G FINISHX
"RTN","PSON52",102,0)
 .K DIC,DLAYGO,DINUM,DIADD,X,DD,DO S DIC="^PS(52.4,",DLAYGO=52.4,DINUM=PSOX("IRXN"),DIC(0)="ML",X=PSOX("IRXN")
"RTN","PSON52",103,0)
 .D FILE^DICN K DD,DO,DIC,DLAYGO,DINUM S ^PS(52.4,PSOX("IRXN"),0)=PSOX("IRXN")_"^"_PSODFN_"^"_DUZ_"^"_"^"_$E(PSOX("LOGIN DATE"),1,7)_"^"_PSOX("IRXN")_"^"_PSOX("STOP DATE")
"RTN","PSON52",104,0)
 .I +$G(^TMP("PSODGS",$J,0))!($D(^TMP("PSODGI",$J,0)))!($D(^TMP("PSODOSF",$J,0))) D TECH^PSODGDGP
"RTN","PSON52",105,0)
 .K DIK,DA S DIK="^PS(52.4,",DA=PSOX("IRXN") D IX^DIK K DIK,DA
"RTN","PSON52",106,0)
 G:PSOX("STATUS")=4 FINISHP
"RTN","PSON52",107,0)
 ;
"RTN","PSON52",108,0)
 I PSOX("FILL DATE")>DT,$P(PSOPAR,"^",6) S DA=PSOX("IRXN"),RXFL(PSOX("IRXN"))=0 D SUS^PSORXL K DA G FINISHX
"RTN","PSON52",109,0)
 ;
"RTN","PSON52",110,0)
 ; - Calling ECME for claims generation and transmission / REJECT handling
"RTN","PSON52",111,0)
 N ACTION,PSOERX
"RTN","PSON52",112,0)
 S PSOERX=PSOX("IRXN")
"RTN","PSON52",113,0)
 I $$SUBMIT^PSOBPSUT(PSOERX,0) D  I ACTION="Q"!(ACTION="^") Q
"RTN","PSON52",114,0)
 . S ACTION="" D ECMESND^PSOBPSU1(PSOERX,0,PSOX("FILL DATE"),"OF")
"RTN","PSON52",115,0)
 . ; Quit if there is an unresolved Tricare non-billable reject code, PSO*7*358
"RTN","PSON52",116,0)
 . I $$PSOET^PSOREJP3(PSOERX,0) S ACTION="Q" Q
"RTN","PSON52",117,0)
 . I $$FIND^PSOREJUT(PSOERX,0) D
"RTN","PSON52",118,0)
 . . S ACTION=$$HDLG^PSOREJU1(PSOERX,0,"79,88","OF","IOQ","Q")
"RTN","PSON52",119,0)
 . I $$STATUS^PSOBPSUT(PSOERX,0)="E PAYABLE" D
"RTN","PSON52",120,0)
 . . D SAVNDC^PSSNDCUT(+$$GET1^DIQ(52,PSOERX,6,"I"),$G(PSOSITE),$$GETNDC^PSONDCUT(PSOERX,0))
"RTN","PSON52",121,0)
 ;
"RTN","PSON52",122,0)
FINISHP ;
"RTN","PSON52",123,0)
 I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=PSOX("IRXN")_",",RXFL(PSOX("IRXN"))=0 G FINISHX
"RTN","PSON52",124,0)
 F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSON52",125,0)
 I $L(PSORX("PSOL",PSOX2))+$L(PSOX("IRXN"))<220 S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_PSOX("IRXN")_","
"RTN","PSON52",126,0)
 E  S PSORX("PSOL",PSOX2+1)=PSOX("IRXN")_","
"RTN","PSON52",127,0)
 S RXFL(PSOX("IRXN"))=0
"RTN","PSON52",128,0)
FINISHX ;call to build Rx array for bingo board
"RTN","PSON52",129,0)
 I $G(PSORX("MAIL/WINDOW"))["W" S BINGCRT=1,BINGRTE="W",BBFLG=1 D BBRX^PSORN52C
"RTN","PSON52",130,0)
 K PSOX1,PSOX2
"RTN","PSON52",131,0)
 K ^TMP("PSODGI",$J),^TMP("PSOSER",$J),^TMP("PSOSERS",$J),^TMP("PSODGS",$J),^TMP("PSOTDD",$J),^TMP("PSODOSF",$J)
"RTN","PSON52",132,0)
 Q
"RTN","PSON52",133,0)
EOJ ;
"RTN","PSON52",134,0)
 ;B xref locked in routine PSONRXN
"RTN","PSON52",135,0)
 L -^PSRX("B",PSOX("IRXN")) K OTHDOS,DA,PSON52,PSOPRC,RTE,SCH,PSOX("INS"),PSONEW("INS"),PSORXED("INS"),PSONEW("ENT"),PSORXED("ENT"),OLENT
"RTN","PSON52",136,0)
 D PSOUL^PSSLOCK(PSOX("IRXN"))
"RTN","PSON52",137,0)
 Q
"RTN","PSON52",138,0)
 ;
"RTN","PSON52",139,0)
 ;;PSOX("SIG");;SIG;;1
"RTN","PSON52",140,0)
DD ;;PSOX("RX #");;0;;1
"RTN","PSON52",141,0)
 ;;PSOX("ISSUE DATE");;0;;13
"RTN","PSON52",142,0)
 ;;PSODFN;;0;;2
"RTN","PSON52",143,0)
 ;;PSOX("PATIENT STATUS");;0;;3
"RTN","PSON52",144,0)
 ;;PSOX("PROVIDER");;0;;4
"RTN","PSON52",145,0)
 ;;PSOX("CLINIC");;0;;5
"RTN","PSON52",146,0)
 ;;PSODRUG("IEN");;0;;6
"RTN","PSON52",147,0)
 ;;PSODRUG("TRADE NAME");;TN;;1
"RTN","PSON52",148,0)
 ;;PSOX("QTY");;0;;7
"RTN","PSON52",149,0)
 ;;PSOX("DAYS SUPPLY");;0;;8
"RTN","PSON52",150,0)
 ;;PSOX("# OF REFILLS");;0;;9
"RTN","PSON52",151,0)
 ;;PSOX("COPIES");;0;;18
"RTN","PSON52",152,0)
 ;;PSOX("MAIL/WINDOW");;0;;11
"RTN","PSON52",153,0)
 ;;PSOX("REMARKS");;3;;7
"RTN","PSON52",154,0)
 ;;PSOX("CLERK CODE");;0;;16
"RTN","PSON52",155,0)
 ;;PSODRUG("COST");;0;;17
"RTN","PSON52",156,0)
 ;;PSOSITE;;2;;9
"RTN","PSON52",157,0)
 ;;PSOX("LOGIN DATE");;2;;1
"RTN","PSON52",158,0)
 ;;PSOX("FILL DATE");;2;;2
"RTN","PSON52",159,0)
 ;;PSOX("PHARMACIST");;2;;3
"RTN","PSON52",160,0)
 ;;PSOX("LOT #");;2;;4
"RTN","PSON52",161,0)
 ;;PSOX("DISPENSED DATE");;2;;5
"RTN","PSON52",162,0)
 ;;PSOX("STOP DATE");;2;;6
"RTN","PSON52",163,0)
 ;;PSODRUG("NDC");;2;;7
"RTN","PSON52",164,0)
 ;;PSODRUG("DAW");;EPH;;1
"RTN","PSON52",165,0)
 ;;PSODRUG("MANUFACTURER");;2;;8
"RTN","PSON52",166,0)
 ;;PSOX("EXPIRATION DATE");;2;;11
"RTN","PSON52",167,0)
 ;;PSOX("GENERIC PROVIDER");;2;;12
"RTN","PSON52",168,0)
 ;;PSOX("RELEASED DATE/TIME");;2;;13
"RTN","PSON52",169,0)
 ;;PSOX("METHOD OF PICK-UP");;MP;;1
"RTN","PSON52",170,0)
 ;;PSOX("STATUS");;STA;;1
"RTN","PSON52",171,0)
 ;;PSOX("LAST DISPENSED DATE");;3;;1
"RTN","PSON52",172,0)
 ;;PSOX("NEXT POSSIBLE REFILL");;3;;2
"RTN","PSON52",173,0)
 ;;PSOX("COSIGNING PROVIDER");;3;;3
"RTN","PSON52",174,0)
 ;;PSOX("TYPE OF RX");;TYPE;;1
"RTN","PSON52",175,0)
 ;;PSOX("SAND");;SAND;;1
"RTN","PSON52",176,0)
 ;;PSOX("POE");;POE;;1
"RTN","PSON52",177,0)
 ;;PSOX("INS");;INS;;1
"RTN","PSONEW")
0^52^B28582823
"RTN","PSONEW",1,0)
PSONEW ;BIR/SAB-new rx order main driver ;07/26/96
"RTN","PSONEW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,27,32,46,94,130,268,225,251**;DEC 1997;Build 202
"RTN","PSONEW",3,0)
 ;External references L and UL^PSSLOCK supported by DBIA 2789
"RTN","PSONEW",4,0)
 ;External reference to ^VA(200 supported by DBIA 224
"RTN","PSONEW",5,0)
 ;External reference to ^XUSEC supported by DBIA 10076
"RTN","PSONEW",6,0)
 ;External reference to ^ORX1 supported by DBIA 2186
"RTN","PSONEW",7,0)
 ;External reference to ^ORX2 supported by DBIA 867
"RTN","PSONEW",8,0)
 ;External reference to ^TIUEDIT supported by DBIA 2410
"RTN","PSONEW",9,0)
 ;---------------------------------------------------------------
"RTN","PSONEW",10,0)
OERR ;backdoor new rx for v7
"RTN","PSONEW",11,0)
 K PSOREEDT,COPY,SPEED,PSOEDIT,DUR,DRET N PSOCKCON
"RTN","PSONEW",12,0)
 S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient.") K PSOPLCK S VALMBCK="" Q
"RTN","PSONEW",13,0)
 K PSOPLCK S X=PSODFN_";DPT(" D LK^ORX2 I 'Y S VALMSG="Another person is entering orders for this patient.",VALMBCK="" D UL^PSSLOCK(PSODFN) Q
"RTN","PSONEW",14,0)
AGAIN N VALMCNT K PSODRUG,PSOCOU,PSOCOUU,PSONOOR,PSORX("FN"),PSORX("DFLG")
"RTN","PSONEW",15,0)
 W ! D HLDHDR^PSOLMUTL S (PSONEW("QFLG"),PSONEW("DFLG"))=0,PSOFROM="NEW",PSONOEDT=1
"RTN","PSONEW",16,0)
 K ORD D FULL^VALM1,^PSONEW1 ; Continue order entry
"RTN","PSONEW",17,0)
 I PSONEW("QFLG") G END
"RTN","PSONEW",18,0)
 I PSONEW("DFLG") W !,$C(7),"RX DELETED",! S:$G(POERR) POERR("DFLG")=1,VALMBCK="Q" G END
"RTN","PSONEW",19,0)
 D:$P($G(PSOPAR),"^",7)=1 AUTO^PSONRXN I $P($G(PSOPAR),"^",7)'=1 S PSOX=PSONEW("RX #") D CHECK^PSONRXN
"RTN","PSONEW",20,0)
 I PSONEW("DFLG")!PSONEW("QFLG") D DEL S:$G(POERR) POERR("DFLG")=1,VALMBCK="R" G END
"RTN","PSONEW",21,0)
 D NOOR I PSONEW("DFLG") D DEL G END
"RTN","PSONEW",22,0)
 D ^PSONEW2 I PSONEW("DFLG") D DEL S:$G(POERR) POERR("DFLG")=1,VALMBCK="R" G END ; Asks if correct
"RTN","PSONEW",23,0)
 G:$G(PSORX("FN")) END
"RTN","PSONEW",24,0)
 D EN^PSON52(.PSONEW) ; Files entry in File 52
"RTN","PSONEW",25,0)
 D NPSOSD^PSOUTIL(.PSONEW) ; Adds newly added rx to PSOSD array
"RTN","PSONEW",26,0)
 S VALMBCK="R"
"RTN","PSONEW",27,0)
END D EOJ ; Clean up          
"RTN","PSONEW",28,0)
 I '$G(PSORX("FN")) W ! K DIR,DIRUT,DUOUT,DTOUT S DIR(0)="Y",DIR("B")="YES",DIR("A")="Another New Order for "_PSORX("NAME") D ^DIR K DIR,DIRUT,DUOUT,DTOUT I Y K PSONEW,PSDRUG,ORD G AGAIN
"RTN","PSONEW",29,0)
 D ^PSOBUILD,BLD^PSOORUT1 S X=PSODFN_";DPT(" D ULK^ORX2 D UL^PSSLOCK(PSODFN)
"RTN","PSONEW",30,0)
 D RV^PSOORFL
"RTN","PSONEW",31,0)
 S VALMBCK="R" K PSORX("FN") Q
"RTN","PSONEW",32,0)
 ;----------------------------------------------------------------
"RTN","PSONEW",33,0)
DEL ;
"RTN","PSONEW",34,0)
 W !,$C(7),"RX DELETED",!
"RTN","PSONEW",35,0)
 I $P($G(PSOPAR),"^",7)=1 D
"RTN","PSONEW",36,0)
 . S DIE="^PS(59,",DA=PSOSITE,PSOY=$O(PSONEW("OLD LAST RX#",""))
"RTN","PSONEW",37,0)
 . S PSOX=PSONEW("OLD LAST RX#",PSOY)
"RTN","PSONEW",38,0)
 . L +^PS(59,+PSOSITE,PSOY):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3)
"RTN","PSONEW",39,0)
 . S DR=$S(PSOY=8:"2003////"_PSOX,PSOY=3:"1002.1////"_PSOX,1:"2003////"_PSOX)
"RTN","PSONEW",40,0)
 . D:PSOX<$P(^PS(59,+PSOSITE,PSOY),"^",3) ^DIE K DIE,X,Y
"RTN","PSONEW",41,0)
 . L -^PS(59,+PSOSITE,PSOY)
"RTN","PSONEW",42,0)
 . K PSOX,PSOY Q
"RTN","PSONEW",43,0)
EOJ ;
"RTN","PSONEW",44,0)
 I $D(PSONEW("RX #")) L -^PSRX("B",PSONEW("RX #")) ; +Lock set in PSONRXN
"RTN","PSONEW",45,0)
 K PSONOEDT,PSONEW,PSODRUG,ANQDATA,LSI,C,MAX,MIN,NDF,REF,SIG,SER,PSOFLAG,PSOHI,PSOLO,PSONOOR,PSOCOUU,PSOCOU,PSORX("EDIT")
"RTN","PSONEW",46,0)
 D CLEAN^PSOVER1
"RTN","PSONEW",47,0)
 K ^TMP("PSORXDC",$J),RORD,ACOM,ACNT,CRIT,DEF,F1,GG,I1,IEN,INDT,LAST,MSG,NIEN,STA,DUR,DRET,PSOPRC
"RTN","PSONEW",48,0)
 S RXN=$O(^TMP("PSORXN",$J,0)) I RXN D
"RTN","PSONEW",49,0)
 .S RXN1=^TMP("PSORXN",$J,RXN) D EN^PSOHLSN1(RXN,$P(RXN1,"^"),$P(RXN1,"^",2),"",$P(RXN1,"^",3))
"RTN","PSONEW",50,0)
 .I $P(^PSRX(RXN,"STA"),"^")=5 D EN^PSOHLSN1(RXN,"SC","ZS","")
"RTN","PSONEW",51,0)
 K RXN,RXN1,^TMP("PSORXN",$J)
"RTN","PSONEW",52,0)
 I $G(PSONOTE) D FULL^VALM1,MAIN^TIUEDIT(3,.TIUDA,PSODFN,"","","","",1)
"RTN","PSONEW",53,0)
 K PSONOTE,PSOCKCON
"RTN","PSONEW",54,0)
 ;W !! K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to Continue" D ^DIR K DIR,DTOUT,DUOUT
"RTN","PSONEW",55,0)
 Q
"RTN","PSONEW",56,0)
NOOR ;asks nature of order
"RTN","PSONEW",57,0)
 N PSONOODF
"RTN","PSONEW",58,0)
 S PSONOODF=0
"RTN","PSONEW",59,0)
 I $G(OR0) D  G NOORX ;front door
"RTN","PSONEW",60,0)
 .S PSOI=$S($G(PSOSIGFL):1,$G(PSODRUG("OI"))'=$P(OR0,"^",8):1,1:0) I 'PSOI S PSONOOR="" D:$D(^XUSEC("PSORPH",DUZ)) COUN Q  ;NoO $P(OR0,"^",7)
"RTN","PSONEW",61,0)
 .S PSONOODF=1
"RTN","PSONEW",62,0)
 .D DIR I $D(DIRUT) S PSONEW("DFLG")=1 Q
"RTN","PSONEW",63,0)
 .S PSONOOR=Y D:$D(^XUSEC("PSORPH",DUZ)) COUN K DIR,DTOUT,DTOUT,DIRUT
"RTN","PSONEW",64,0)
 ;backdoor order
"RTN","PSONEW",65,0)
 D DIR I $D(DIRUT) S PSONEW("DFLG")=1,VALMBCK="Q" Q
"RTN","PSONEW",66,0)
 S PSONOOR=Y K DIK,DA,DIE,DR,PSOI,DIR,DUOUT,DTOUT,DIRUT
"RTN","PSONEW",67,0)
 G:'$D(^XUSEC("PSORPH",DUZ)) NOORX
"RTN","PSONEW",68,0)
COUN ;patient counseling
"RTN","PSONEW",69,0)
 G:$G(PSORX("EDIT"))&('$G(PSOSIGFL)) NOORX K DIR,DUOUT,DTOUT,DIRUT
"RTN","PSONEW",70,0)
 S DIR("B")="NO",DIR(0)="52,41" D ^DIR S PSOCOU=$S(Y:Y,1:0)
"RTN","PSONEW",71,0)
 I $D(DIRUT)!('PSOCOU) S PSOCOUU=0 D:'$G(SPEED) PRONTE Q
"RTN","PSONEW",72,0)
 K:'$G(PSOCOU) PSOCOUU K DIR,DUOUT,DTOUT,DIRUT I Y S DIR(0)="52,42",DIR("B")="NO" D ^DIR S PSOCOUU=$S(Y:Y,1:0)
"RTN","PSONEW",73,0)
PRONTE K PSONOTE,DIR,DIRUT,DUOUT
"RTN","PSONEW",74,0)
 I $T(MAIN^TIUEDIT)]"",'$G(SPEED) D  K DIR,DIRUT,DUOUT
"RTN","PSONEW",75,0)
 .S DIR(0)="Y",DIR("B")="No",DIR("A")="Do you want to enter a Progress Note",DIR("A",1)="" D ^DIR K DIR
"RTN","PSONEW",76,0)
 .S PSONOTE=+Y Q  ;I 'Y!($D(DIRUT)) Q
"RTN","PSONEW",77,0)
NOORX K X,Y,DIR,DUOUT,DTOUT,DIRUT
"RTN","PSONEW",78,0)
 Q
"RTN","PSONEW",79,0)
DIR ;ask nature of order
"RTN","PSONEW",80,0)
 K DIR,DTOUT,DTOUT,DIRUT I $T(NA^ORX1)]""  D  Q
"RTN","PSONEW",81,0)
 .S PSONOOR=$$NA^ORX1($S($G(PSONOODF)!($G(PSONOBCK)):"S",1:"W"),0,"B","Nature of Order",0,"WPSDIVR"_$S(+$G(^VA(200,DUZ,"PS")):"E",1:""))
"RTN","PSONEW",82,0)
 .I +PSONOOR S (Y,PSONOOR)=$P(PSONOOR,"^",3) Q
"RTN","PSONEW",83,0)
 .S DIRUT=1 K PSONOOR
"RTN","PSONEW",84,0)
 I $D(PSONOOR) S DF=PSONOOR,PSONODF=$S(DF="E":"PROVIDER ENTERED",DF="V":"VERBAL",DF="P":"TELEPHONE",DF="D":"DUPLICATE",DF="S":"SERVICE CORRECTED",DF="I":"POLICY",DF="R":"SERVICE REJECTED",1:"WRITTEN")
"RTN","PSONEW",85,0)
 K DIR,DTOUT,DTOUT,DIRUT S DIR("A")="Nature of Order: ",DIR("B")=$S($D(PSONOOR):PSONODF,1:"WRITTEN")
"RTN","PSONEW",86,0)
 S DIR(0)="SA^W:WRITTEN;V:VERBAL;P:TELEPHONE;S:SERVICE CORRECTED;D:DUPLICATE;I:POLICY;R:SERVICE REJECTED"_$S(+$G(^VA(200,DUZ,"PS")):";E:PROVIDER ENTERED",1:"")
"RTN","PSONEW",87,0)
 D ^DIR K DF,PSONODF Q:$D(DIRUT)  S PSONOOR=Y
"RTN","PSONEW",88,0)
DIRX Q
"RTN","PSONEW",89,0)
 ;
"RTN","PSONEW",90,0)
NOORE(PSONEW) ;entry point for renew
"RTN","PSONEW",91,0)
 D NOOR I $D(DIRUT) S PSONEW("DFLG")=1 Q
"RTN","PSONEW",92,0)
 S PSONEW("NOO")=PSONOOR
"RTN","PSONEW",93,0)
 Q
"RTN","PSONEW2")
0^25^B41668970
"RTN","PSONEW2",1,0)
PSONEW2 ;BIR/DSD - displays new rx information for edit ;7/17/06 6:59pm
"RTN","PSONEW2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**32,37,46,71,94,124,139,157,143,226,237,239,225,251**;DEC 1997;Build 202
"RTN","PSONEW2",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSONEW2",4,0)
 ;External reference to ^DPT supported by DBIA 10035
"RTN","PSONEW2",5,0)
 ;External reference to PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSONEW2",6,0)
 ;External reference VADPT supported by DBIA 10061
"RTN","PSONEW2",7,0)
 ; This routine displays the entered new rx information and
"RTN","PSONEW2",8,0)
 ; asks if correct, if not allows editing of the data.
"RTN","PSONEW2",9,0)
 ;------------------------------------------------------------
"RTN","PSONEW2",10,0)
 ;PSO*237 issue expired error message
"RTN","PSONEW2",11,0)
 ;
"RTN","PSONEW2",12,0)
START ;
"RTN","PSONEW2",13,0)
 S (PSONEW("DFLG"),PSONEW2("QFLG"))=0
"RTN","PSONEW2",14,0)
 D STOP
"RTN","PSONEW2",15,0)
 D DISPLAY ; Displays information
"RTN","PSONEW2",16,0)
 ;Copay exemption checks
"RTN","PSONEW2",17,0)
 D SCP^PSORN52D
"RTN","PSONEW2",18,0)
 S PSONEWFF=1,PSOFLAG=1 K PSOANSQ,PSOANSQD S PSOCPZ("DFLG")=0,PSONEW("NEWCOPAY")=0
"RTN","PSONEW2",19,0)
 ;can't check PSOSCA for <50 here because of PSOBILL check in PSOCPB
"RTN","PSONEW2",20,0)
 I (PSOSCP<50&($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)'=1)),$G(DUZ("AG"))="V" D COPAY^PSOCPB W !
"RTN","PSONEW2",21,0)
 I PSOSCA&(PSOSCP>49)!((PSOSCA!(PSOBILL=2))&($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1))!(PSOSCP>49&(PSOBILL=2)) D SC^PSOMLLD2
"RTN","PSONEW2",22,0)
 I $G(PSOCPZ("DFLG")) K PSONEWFF,PSOANSQD,PSOCPZ("DFLG"),PSONEW("NEWCOPAY") S DIRUT="",PSONEW("DFLG")=1 D ASKX G END
"RTN","PSONEW2",23,0)
 ;IF MILL BILL, AND COPAY (*******TEST THE COPAY CHECK)
"RTN","PSONEW2",24,0)
 I $$DT^PSOMLLDT D  I $G(PSOCPZ("DFLG")) K PSONEWFF,PSOANSQD,PSOANSQ,PSOCPZ("DFLG"),PSONEW("NEWCOPAY") S DIRUT="",PSONEW("DFLG")=1 D ASKX G END
"RTN","PSONEW2",25,0)
 .;New prompts Quit after first '^'
"RTN","PSONEW2",26,0)
 .I $D(PSOIBQS(PSODFN,"CV")) D CV^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("CV"))) K PSONEW("NEWCOPAY")
"RTN","PSONEW2",27,0)
 .I $D(PSOIBQS(PSODFN,"VEH")) D VEH^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("VEH"))) K PSONEW("NEWCOPAY")
"RTN","PSONEW2",28,0)
 .I $D(PSOIBQS(PSODFN,"RAD")) D RAD^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("RAD"))) K PSONEW("NEWCOPAY")
"RTN","PSONEW2",29,0)
 .I $D(PSOIBQS(PSODFN,"PGW")) D PGW^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("PGW"))) K PSONEW("NEWCOPAY")
"RTN","PSONEW2",30,0)
 .I $D(PSOIBQS(PSODFN,"SHAD")) D SHAD^PSOMLLD2 I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("SHAD"))) K PSONEW("NEWCOPAY")
"RTN","PSONEW2",31,0)
 .I $D(PSOIBQS(PSODFN,"MST")) D MST^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("MST"))) K PSONEW("NEWCOPAY")
"RTN","PSONEW2",32,0)
 .I $D(PSOIBQS(PSODFN,"HNC")) D HNC^PSOMLLDT I $G(PSOCPZ("DFLG"))!($G(PSOANSQ("HNC"))) K PSONEW("NEWCOPAY")
"RTN","PSONEW2",33,0)
 K PSOCPZ("DFLG"),PSONEWFF
"RTN","PSONEW2",34,0)
 D ASK K:$G(PSONEW("DFLG")) PSOANSQ G:PSONEW2("QFLG")!PSONEW("DFLG") END
"RTN","PSONEW2",35,0)
 S PSORX("EDIT")=1 D EN^PSOORNE1(.PSONEW),FULL^VALM1 G:$G(PSORX("FN")) END  I '$G(PSORX("FN")) S PSONEW("DFLG")=1 K PSOANSQ G END ;D EDIT
"RTN","PSONEW2",36,0)
 G:'$G(PSONEW("DFLG")) START
"RTN","PSONEW2",37,0)
 S PSONEW("QFLG")=1,PSONEW("DFLG")=0
"RTN","PSONEW2",38,0)
END D EOJ
"RTN","PSONEW2",39,0)
 Q
"RTN","PSONEW2",40,0)
 ;------------------------------------------------------------
"RTN","PSONEW2",41,0)
STOP K PSEXDT,X,%DT S PSON52("QFLG")=0
"RTN","PSONEW2",42,0)
 S X1=PSOID,X2=PSONEW("DAYS SUPPLY")*(PSONEW("# OF REFILLS")+1)\1
"RTN","PSONEW2",43,0)
 S X2=$S(PSONEW("DAYS SUPPLY")=X2:X2,+$G(PSONEW("CS")):184,1:366)
"RTN","PSONEW2",44,0)
 I X2<30 D
"RTN","PSONEW2",45,0)
 . N % S %=$P($G(PSORX("PATIENT STATUS")),"^"),X2=30
"RTN","PSONEW2",46,0)
 . S:%?.N %=$P($G(^PS(53,+%,0)),"^") I %["AUTH ABS" S X2=5
"RTN","PSONEW2",47,0)
 D C^%DTC I PSONEW("FILL DATE")>$P(X,".") S PSEXDT=1_"^"_$P(X,".")
"RTN","PSONEW2",48,0)
 K X1,X2,X,%DT
"RTN","PSONEW2",49,0)
 Q
"RTN","PSONEW2",50,0)
DISPLAY ;
"RTN","PSONEW2",51,0)
 W !!,"Rx # ",PSONEW("RX #")
"RTN","PSONEW2",52,0)
 W ?23,$E(PSONEW("FILL DATE"),4,5),"/",$E(PSONEW("FILL DATE"),6,7),"/",$E(PSONEW("FILL DATE"),2,3),!,$G(PSORX("NAME")),?30,"#",PSONEW("QTY")
"RTN","PSONEW2",53,0)
 I $G(SIGOK),$O(SIG(0)) D  K D G TRN
"RTN","PSONEW2",54,0)
 .F D=0:0 S D=$O(SIG(D)) W !,SIG(D) Q:'$O(SIG(D))
"RTN","PSONEW2",55,0)
 E  S X=PSONEW("SIG") D SIGONE^PSOHELP W !,$G(INS1)
"RTN","PSONEW2",56,0)
TRN ;I $G(PSOPRC) F I=0:0 S I=$O(PRC(I)) Q:'I  W !,PRC(I)
"RTN","PSONEW2",57,0)
 W !!,$S($G(PSODRUG("TRADE NAME"))]"":PSODRUG("TRADE NAME"),1:PSODRUG("NAME"))
"RTN","PSONEW2",58,0)
 W !,PSONEW("PROVIDER NAME"),?25,PSORX("CLERK CODE"),!,"# of Refills: ",PSONEW("# OF REFILLS"),!
"RTN","PSONEW2",59,0)
 Q
"RTN","PSONEW2",60,0)
 ;
"RTN","PSONEW2",61,0)
ASK ;
"RTN","PSONEW2",62,0)
 K DIR,X,Y S DIR("A")="Is this correct"
"RTN","PSONEW2",63,0)
 S DIR(0)="Y",DIR("B")="YES" D ^DIR K DIR I $D(DIRUT) S PSONEW("DFLG")=1 G ASKX
"RTN","PSONEW2",64,0)
ASK1 I Y D  S PSONEW2("QFLG")=1
"RTN","PSONEW2",65,0)
 .S:$G(PSONEW("MAIL/WINDOW"))["W" BINGCRT=Y,BINGRTE="W"
"RTN","PSONEW2",66,0)
 .D:+$G(PSEXDT)
"RTN","PSONEW2",67,0)
 ..S Y=PSONEW("FILL DATE") X ^DD("DD") W !!,$C(7),Y_" fill date is greater than possible expiration date of " S Y=$P(PSEXDT,"^",2) X ^DD("DD") W Y_"."
"RTN","PSONEW2",68,0)
 .D DCORD K RORD,^TMP("PSORXDC",$J)
"RTN","PSONEW2",69,0)
ASKX I $D(DIRUT) D
"RTN","PSONEW2",70,0)
 .I +$G(PSEXDT) K DIRUT S (PSONEW2("QFLG"),PSONEW2("DFLG"),PSONEW("DFLG"),Y)=1
"RTN","PSONEW2",71,0)
 K X,Y,DIRUT,DTOUT,DUOUT
"RTN","PSONEW2",72,0)
 D:+$G(PSEXDT) PAUSE^VALM1
"RTN","PSONEW2",73,0)
 Q
"RTN","PSONEW2",74,0)
DCORD ;dc rxs and pending orders after new order is entered
"RTN","PSONEW2",75,0)
 I $G(PSORX("DFLG")) K ^TMP("PSORXDC",$J) Q
"RTN","PSONEW2",76,0)
 F RORD=0:0 S RORD=$O(^TMP("PSORXDC",$J,RORD)) Q:'RORD  D @$S($P(^TMP("PSORXDC",$J,RORD,0),"^")="P":"PEN",1:"RX52")
"RTN","PSONEW2",77,0)
 I $G(PSORX("FN")) S VALMBCK="Q",PSOFROM="NEW"
"RTN","PSONEW2",78,0)
 K RORD H 2
"RTN","PSONEW2",79,0)
 Q
"RTN","PSONEW2",80,0)
PEN ;pending ^tmp("psorxdc",$j,rord,0)="p^"_rord_"^"_msg
"RTN","PSONEW2",81,0)
 N PSOR,DNM S PSOR=^PS(52.41,RORD,0) S $P(^PS(52.41,RORD,0),"^",3)="DC",^PS(52.41,RORD,4)=$P(^TMP("PSORXDC",$J,RORD,0),"^",3)
"RTN","PSONEW2",82,0)
 K ^PS(52.41,"AOR",PSODFN,+$P($G(^PS(52.41,RORD,"INI")),"^"),RORD)
"RTN","PSONEW2",83,0)
 S DNM=$S($P(PSOR,"^",9):$P($G(^PSDRUG($P(PSOR,"^",9),0)),"^"),1:$P(^PS(50.7,$P(PSOR,"^",8),0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,$P(PSOR,"^",8),0),"^",2),0),"^"))
"RTN","PSONEW2",84,0)
 D EN^PSOHLSN($P(^PS(52.41,RORD,0),"^"),"OC",$P(^TMP("PSORXDC",$J,RORD,0),"^",3),"D")
"RTN","PSONEW2",85,0)
 G:'$D(^XUSEC("PSORPH",DUZ)) PENX
"RTN","PSONEW2",86,0)
 W $C(7),! K ^UTILITY($J,"W") S DIWL=1,DIWR=75,DIWF=""
"RTN","PSONEW2",87,0)
 S X=" Duplicate "_$S($P(^TMP("PSORXDC",$J,RORD,0),"^",10):"Therapy",1:"Drug")_" Pending Order "_DNM_" has been discontinued..." D ^DIWP
"RTN","PSONEW2",88,0)
 F ZX=0:0 S ZX=$O(^UTILITY($J,"W",1,ZX)) Q:'ZX  W !,^UTILITY($J,"W",1,ZX,0)
"RTN","PSONEW2",89,0)
PENX K ^UTILITY($J,"W"),X,DIWL,DIWR,DIWF W !
"RTN","PSONEW2",90,0)
 D PSOUL^PSSLOCK(RORD_"S") K ^TMP("PSORXDC",$J,RORD,0)
"RTN","PSONEW2",91,0)
 Q
"RTN","PSONEW2",92,0)
RX52 ;rxs in file 52 ^tmp("psorxdc",$j,rord,0)=52^rord^msg^rea^act^sta^dnm
"RTN","PSONEW2",93,0)
 S PSCAN($P(^PSRX(RORD,0),"^"))=RORD_"^"_$P(^TMP("PSORXDC",$J,RORD,0),"^",4)
"RTN","PSONEW2",94,0)
 S MSG=$P(^TMP("PSORXDC",$J,RORD,0),"^",3),REA=$P(^(0),"^",4),ACT=$P(^(0),"^",5)
"RTN","PSONEW2",95,0)
 N PSONOOR S PSONOOR="D",DUP=1,DA=RORD D CAN^PSOCAN K PSONOOR
"RTN","PSONEW2",96,0)
 G:'$D(^XUSEC("PSORPH",DUZ)) RX52X
"RTN","PSONEW2",97,0)
 W $C(7),! K ^UTILITY($J,"W") S DIWL=1,DIWR=75,DIWF=""
"RTN","PSONEW2",98,0)
 S X=" Duplicate "_$S($P(^TMP("PSORXDC",$J,RORD,0),"^",10):"Therapy",1:"Drug")_" Rx #"_$P(^PSRX(RORD,0),"^")_" "_$P(^TMP("PSORXDC",$J,RORD,0),"^",7)_" has been discontinued..." D ^DIWP
"RTN","PSONEW2",99,0)
 F ZX=0:0 S ZX=$O(^UTILITY($J,"W",1,ZX)) Q:'ZX  W !,^UTILITY($J,"W",1,ZX,0)
"RTN","PSONEW2",100,0)
RX52X K ^UTILITY($J,"W"),X,DIWL,DIWR,DIWF W !
"RTN","PSONEW2",101,0)
 K PSOSD($P(^TMP("PSORXDC",$J,RORD,0),"^",6),$P(^TMP("PSORXDC",$J,RORD,0),"^",7))
"RTN","PSONEW2",102,0)
 D PSOUL^PSSLOCK(RORD) K ^TMP("PSORXDC",$J,RORD,0)
"RTN","PSONEW2",103,0)
 Q
"RTN","PSONEW2",104,0)
 ;
"RTN","PSONEW2",105,0)
EDIT ;
"RTN","PSONEW2",106,0)
 S PSORX("EDIT")=1
"RTN","PSONEW2",107,0)
 D ^PSONEW3
"RTN","PSONEW2",108,0)
 S PSONEW("DFLG")=$S($G(PSORX("DFLG")):1,1:0)
"RTN","PSONEW2",109,0)
 Q
"RTN","PSONEW2",110,0)
 ;
"RTN","PSONEW2",111,0)
EOJ ;
"RTN","PSONEW2",112,0)
 K PSONEW2,PSORX("EDIT"),PSORX("DFLG"),PSOEDIT,PSOSCA
"RTN","PSONEW2",113,0)
 Q
"RTN","PSONEW2",114,0)
 ;
"RTN","PSONEW2",115,0)
EN1(PSONEW2) ; Entry point to just display and ask if okay
"RTN","PSONEW2",116,0)
 S PSONEW("DFLG")=0
"RTN","PSONEW2",117,0)
 I $G(^PSRX(PSONEW2("IRXN"),0))']"" S PSONEW("DFLG")=1 G EN1X
"RTN","PSONEW2",118,0)
 S PSOX=^PSRX(PSONEW2("IRXN"),0),PSONEW("TRADE NAME")=$G(^("TN")),PSONEW("FILL DATE")=$P($G(^(2)),"^",2)
"RTN","PSONEW2",119,0)
 S PSONEW("RX #")=$P(PSOX,"^"),PSORX("NAME")=$P(^DPT($P(PSOX,"^",2),0),"^")
"RTN","PSONEW2",120,0)
 S PSONEW("QTY")=$P(PSOX,"^",7),PSODRUG("NAME")=$P(^PSDRUG($P(PSOX,"^",6),0),"^"),PSONEW("# OF REFILLS")=$P(PSOX,"^",9)
"RTN","PSONEW2",121,0)
 S PSORX("CLERK CODE")=$P(^VA(200,$P(PSOX,"^",16),0),"^")
"RTN","PSONEW2",122,0)
 S:$G(PSONEW("PROVIDER NAME"))="" PSONEW("PROVIDER NAME")=$P(^VA(200,$P(PSOX,"^",4),0),"^")
"RTN","PSONEW2",123,0)
 S PSONEW("SIG")=$P($G(^PSRX(PSONEW2("IRXN"),"SIG")),"^")
"RTN","PSONEW2",124,0)
 D DISPLAY
"RTN","PSONEW2",125,0)
 D ASK
"RTN","PSONEW2",126,0)
 I PSONEW("DFLG")=1 S PSONEW2("DFLG")=1
"RTN","PSONEW2",127,0)
EN1X ;
"RTN","PSONEW2",128,0)
 Q
"RTN","PSONEW2",129,0)
 ;
"RTN","PSONEW2",130,0)
EXPR ;Display Expired error message                               ;PSO*237
"RTN","PSONEW2",131,0)
 S PSONEW("DFLG")=1
"RTN","PSONEW2",132,0)
 W $C(7)
"RTN","PSONEW2",133,0)
 S VALMSG="Order is older than 365 days and can't be finished"
"RTN","PSONEW2",134,0)
 S XQORM("B")="DC"
"RTN","PSONEW2",135,0)
 Q
"RTN","PSOORDRG")
0^78^B43185005
"RTN","PSOORDRG",1,0)
PSOORDRG ;BIR/SAB - order entry drug selection ;11/13/97
"RTN","PSOORDRG",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**3,29,49,46,81,105,134,144,132,188,207,148,243,251**;DEC 1997;Build 202
"RTN","PSOORDRG",3,0)
 ;External references to ^PSJORUT2 supported by DBIA 2376
"RTN","PSOORDRG",4,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSOORDRG",5,0)
 ;External reference to ^PS(50.605 supported by DBIA 696
"RTN","PSOORDRG",6,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORDRG",7,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOORDRG",8,0)
 ;External reference to ^PS(56 supported by DBIA 2229
"RTN","PSOORDRG",9,0)
 ;External reference to ^PS(50.416 supported by DBIA 692
"RTN","PSOORDRG",10,0)
 ;External reference to DDIEX^PSNAPIS supported by DBIA 2574
"RTN","PSOORDRG",11,0)
 ;External references to ^ORRDI1 supported by DBIA 4659
"RTN","PSOORDRG",12,0)
 ;Reference to $$GETNDC^PSSNDCUT supported by IA 4707
"RTN","PSOORDRG",13,0)
 ;
"RTN","PSOORDRG",14,0)
EN(PSODFN,DREN) ;
"RTN","PSOORDRG",15,0)
 K ^TMP($J,"DI"),^TMP($J,"DD"),^TMP($J,"DC"),^TMP($J,"DI"_PSODFN),PSOPHI S INDX=0
"RTN","PSOORDRG",16,0)
 ;build patient's drug profile outpat/inpat/non-va
"RTN","PSOORDRG",17,0)
 D BLD,ENCHK^PSJORUT2(PSODFN,.INDX),NVA
"RTN","PSOORDRG",18,0)
 ;collect drug info
"RTN","PSOORDRG",19,0)
DRG ;S X=DREN,DIC="^PSDRUG(",DIC(0)="MQNZO" D ^DIC K DIC,PSOY Q:Y<1  S PSOY=Y,PSOY(0)=Y(0) K X,Y
"RTN","PSOORDRG",20,0)
 N PSOICT S PSOICT=""
"RTN","PSOORDRG",21,0)
 S PSOY=DREN_"^"_$P($G(^PSDRUG(DREN,0)),"^"),PSOY(0)=$G(^PSDRUG(DREN,0)) K X,Y
"RTN","PSOORDRG",22,0)
 S PSODRUG("IEN")=+PSOY,PSODRUG("VA CLASS")=$P(PSOY(0),"^",2),PSODRUG("NAME")=$P(PSOY(0),"^")
"RTN","PSOORDRG",23,0)
 S:+$G(^PSDRUG(+PSOY,2)) PSODRUG("OI")=+$G(^(2)),PSODRUG("OIN")=$P(^PS(50.7,+$G(^(2)),0),"^")
"RTN","PSOORDRG",24,0)
 S PSODRUG("NDF")=$S($G(^PSDRUG(+PSOY,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)
"RTN","PSOORDRG",25,0)
 S PSODRUG("MAXDOSE")=$P(PSOY(0),"^",4),PSODRUG("DEA")=$P(PSOY(0),"^",3),PSODRUG("CLN")=$S($D(^PSDRUG(+PSOY,"ND")):+$P(^("ND"),"^",6),1:0)
"RTN","PSOORDRG",26,0)
 S PSODRUG("SIG")=$P(PSOY(0),"^",5),PSODRUG("NDC")=$$GETNDC^PSSNDCUT(+PSOY,$G(PSOSITE))
"RTN","PSOORDRG",27,0)
 S PSODRUG("DAW")=$$GET1^DIQ(50,+PSOY,81)
"RTN","PSOORDRG",28,0)
 S PSOX1=$G(^PSDRUG(+PSOY,660)),PSODRUG("COST")=$P($G(PSOX1),"^",6),PSODRUG("UNIT")=$P($G(PSOX1),"^",8),PSODRUG("EXPIRATION DATE")=$P($G(PSOX1),"^",9)
"RTN","PSOORDRG",29,0)
 K PSOX1,PSOY Q:$G(POERR)
"RTN","PSOORDRG",30,0)
 ;dup drug/class check
"RTN","PSOORDRG",31,0)
 S DNM=0 F  S DNM=$O(^TMP($J,"ORDERS",DNM)) Q:'DNM  D
"RTN","PSOORDRG",32,0)
 .S DRNM=$P(^TMP($J,"ORDERS",DNM),"^",3)
"RTN","PSOORDRG",33,0)
 .I PSODRUG("NAME")=DRNM S DD=$G(DD)+1,^TMP($J,"DD",DD,0)=PSODRUG("IEN")_"^"_PSODRUG("NAME")_"^"_$P(^TMP($J,"ORDERS",DNM),"^",4)_"^"_$P(^(DNM),"^",5) Q:'$G(PSOPHI)
"RTN","PSOORDRG",34,0)
 .I PSODRUG("VA CLASS")]"",$E(PSODRUG("VA CLASS"),1,4)=$E($P(^TMP($J,"ORDERS",DNM),"^"),1,4),DRNM'=PSODRUG("NAME") D
"RTN","PSOORDRG",35,0)
 ..I $E(PSODRUG("VA CLASS"),1,2)="HA",$E($P(^TMP($J,"ORDERS",DNM),"^"),1,2)="HA" Q
"RTN","PSOORDRG",36,0)
 ..S PSODC=$O(^PS(50.605,"B",PSODRUG("VA CLASS"),0)) Q:'PSODC
"RTN","PSOORDRG",37,0)
 ..S DC=$G(DC)+1,^TMP($J,"DC",DC,0)=PSODRUG("VA CLASS")
"RTN","PSOORDRG",38,0)
 ..S PSODC=$P(^PS(50.605,PSODC,0),"^",2),^TMP($J,"DC",DC,0)=^TMP($J,"DC",DC,0)_"^"_PSODC_"^"_$O(^PSDRUG("B",DRNM,0))_"^"_DRNM_"^"_$P(^TMP($J,"ORDERS",DNM),"^",4)_"^"_$P(^(DNM),"^",5)
"RTN","PSOORDRG",39,0)
 ;drug interaction check
"RTN","PSOORDRG",40,0)
 S DRG=0
"RTN","PSOORDRG",41,0)
 F  S DRG=$O(^TMP($J,"ORDERS",DRG)) Q:'DRG  S NDF=$P(^TMP($J,"ORDERS",DRG),"^",2) D
"RTN","PSOORDRG",42,0)
 .S IT=0,PSOICT=""
"RTN","PSOORDRG",43,0)
 .F  S IT=$O(^PS(56,"APD",NDF,PSODRUG("NDF"),IT)) Q:'IT  D
"RTN","PSOORDRG",44,0)
 ..Q:$$DDIEX^PSNAPIS($P(NDF,"A"),$P(NDF,"A",2))
"RTN","PSOORDRG",45,0)
 ..Q:$$DDIEX^PSNAPIS($P(PSODRUG("NDF"),"A"),$P(PSODRUG("NDF"),"A",2))
"RTN","PSOORDRG",46,0)
 ..Q:$P(^PS(56,IT,0),"^",7)&($P(^PS(56,IT,0),"^",7)<DT)
"RTN","PSOORDRG",47,0)
 ..I 'PSOICT S PSOICT=IT Q
"RTN","PSOORDRG",48,0)
 ..I $P($G(^PS(56,IT,0)),"^",4)=1 S PSOICT=IT Q
"RTN","PSOORDRG",49,0)
 ..Q
"RTN","PSOORDRG",50,0)
 .I 'PSOICT Q
"RTN","PSOORDRG",51,0)
 .S IT=PSOICT
"RTN","PSOORDRG",52,0)
 .S DRNM=$P(^TMP($J,"ORDERS",DRG),"^",3),ORN=$P(^(DRG),"^",4),RXN=$P(^(DRG),"^",5)
"RTN","PSOORDRG",53,0)
 .S DI=$G(DI)+1,^TMP($J,"DI",DI,0)=$O(^PSDRUG("B",DRNM,0))_"^"_DRNM_"^"_IT_"^"_$S($P(^PS(56,IT,0),"^",4)=1:"CRITICAL",1:"SIGNIFICANT")_"^"
"RTN","PSOORDRG",54,0)
 .S ^TMP($J,"DI",DI,0)=^TMP($J,"DI",DI,0)_$P(^PS(50.416,$P(^PS(56,IT,0),"^",2),0),"^")_"^"_$P(^PS(50.416,$P(^PS(56,IT,0),"^",3),0),"^")_"^"_ORN_"^"_RXN
"RTN","PSOORDRG",55,0)
 D REMOTE
"RTN","PSOORDRG",56,0)
 Q:$G(PSOPHI)
"RTN","PSOORDRG",57,0)
EXIT K ^TMP($J,"ORDERS"),DFN,DA,DNM,DUPRX0,RX,Y,ZZ,PSOCLOZ,PSOY,DRG,DNM,DD,DI,DC,IT,PSODRUG,PSOY,ORN,DRNM
"RTN","PSOORDRG",58,0)
 K PSOX,EXPDT,PSODRUG0,PSORX0,PSORX2,PSORX3,PSOST0,PSOVACL,X,Y,X1,X2,RXN
"RTN","PSOORDRG",59,0)
 Q
"RTN","PSOORDRG",60,0)
BLD K ^TMP($J,"ORDERS") I '$D(PSODFN)!('$D(DT)) G EXIT
"RTN","PSOORDRG",61,0)
 S X1=DT,X2=-120 D C^%DTC S PSODTCUT=X D BUILD G GETX
"RTN","PSOORDRG",62,0)
 Q
"RTN","PSOORDRG",63,0)
BUILD ;build profiles
"RTN","PSOORDRG",64,0)
 S EXPDT=PSODTCUT-1,RX=0
"RTN","PSOORDRG",65,0)
 F  S EXPDT=$O(^PS(55,PSODFN,"P","A",EXPDT)) Q:'EXPDT  F  S RX=$O(^PS(55,PSODFN,"P","A",EXPDT,RX)) Q:'RX  I $D(^PSRX(RX,0)) D GET
"RTN","PSOORDRG",66,0)
 S EN=0
"RTN","PSOORDRG",67,0)
 F PSOEN=0:0 S PSOEN=$O(^PS(52.41,"AOR",PSODFN,PSOEN)) Q:'PSOEN  D
"RTN","PSOORDRG",68,0)
 .F  S EN=$O(^PS(52.41,"AOR",PSODFN,PSOEN,EN)) Q:'EN  D
"RTN","PSOORDRG",69,0)
 ..Q:'$P(^PS(52.41,EN,0),"^",8)
"RTN","PSOORDRG",70,0)
 ..S PSOOI=^PS(52.41,EN,0)
"RTN","PSOORDRG",71,0)
 ..I $P(PSOOI,"^",3)'="DC"&($P(PSOOI,"^",3)'="DE") D
"RTN","PSOORDRG",72,0)
 ...D:'$P(^PS(52.41,EN,0),"^",9) BLDOI Q
"RTN","PSOORDRG",73,0)
 ...S PSODD=+$P(PSOOI,"^",9) D SETTMP
"RTN","PSOORDRG",74,0)
 D BUILDX
"RTN","PSOORDRG",75,0)
 Q
"RTN","PSOORDRG",76,0)
 ;
"RTN","PSOORDRG",77,0)
BLDOI ;If no DD/non-standard dose, get all drugs for OI
"RTN","PSOORDRG",78,0)
 N PSOI S PSOI=$P(PSOOI,"^",8) Q:'PSOOI
"RTN","PSOORDRG",79,0)
 S PSODD="" F  S PSODD=$O(^PSDRUG("ASP",PSOI,PSODD)) Q:'PSODD  D SETTMP
"RTN","PSOORDRG",80,0)
 Q
"RTN","PSOORDRG",81,0)
 ;
"RTN","PSOORDRG",82,0)
SETTMP ;Create ^TMP($J,"ORDERS"
"RTN","PSOORDRG",83,0)
 Q:$P(PSOOI,"^",3)="RF"
"RTN","PSOORDRG",84,0)
 S DRG=$S(PSODD:$P($G(^PSDRUG(PSODD,0)),"^"),1:"") Q:DRG']""
"RTN","PSOORDRG",85,0)
 S INDX=$G(INDX)+1,^TMP($J,"ORDERS",INDX)=$S(PSODD:$P(^PSDRUG(PSODD,0),"^",2),1:"")_"^"_$S($G(^PSDRUG(PSODD,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)_"^"_DRG_"^"_$P(^PS(52.41,EN,0),"^")_"^"_EN_"P;O"
"RTN","PSOORDRG",86,0)
 Q
"RTN","PSOORDRG",87,0)
 ;
"RTN","PSOORDRG",88,0)
BUILDX K EN,PSOOI,PSODD,PSOEN Q
"RTN","PSOORDRG",89,0)
 ;
"RTN","PSOORDRG",90,0)
GET ;data for profiles
"RTN","PSOORDRG",91,0)
 S PSORX0=^PSRX(RX,0),PSOST0=+^("STA") Q:PSOST0>5&(PSOST0'=16)
"RTN","PSOORDRG",92,0)
 S PSORX2=$G(^PSRX(RX,2)),PSORX3=$G(^(3)),ORN=$P($G(^("OR1")),"^",2) S:PSORX3="" PSORX3=$P(PSORX2,"^",2)
"RTN","PSOORDRG",93,0)
 S PSODRUG=+$P(PSORX0,"^",6) Q:'$D(^PSDRUG(PSODRUG,0))
"RTN","PSOORDRG",94,0)
 S PSODRUG0=^PSDRUG(PSODRUG,0),PSOVACL=$P(PSODRUG0,"^",2)
"RTN","PSOORDRG",95,0)
 ;
"RTN","PSOORDRG",96,0)
 I EXPDT<DT D
"RTN","PSOORDRG",97,0)
 .N DIE,DIC,DR,DA S STAT="SC",DIE=52,DA=RX,DR="100////11" D ^DIE K DIE,DIC,DR,DA
"RTN","PSOORDRG",98,0)
 .D ECAN^PSOUTL(RX) S DA=RX
"RTN","PSOORDRG",99,0)
 .S COMM="Prescription Expired",PHARMST="ZE" D EN^PSOHLSN1(DA,STAT,PHARMST,COMM)
"RTN","PSOORDRG",100,0)
 S INDX=$G(INDX)+1
"RTN","PSOORDRG",101,0)
 S ^TMP($J,"ORDERS",INDX)=PSOVACL_"^"_$S($G(^PSDRUG(PSODRUG,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)_"^"_$P(^PSDRUG(PSODRUG,0),"^")_"^"_ORN_"^"_RX_"R;O"
"RTN","PSOORDRG",102,0)
 Q
"RTN","PSOORDRG",103,0)
GETX ;
"RTN","PSOORDRG",104,0)
 K PSOX,EXPDT,PSODRUG,PSODRUG0,PSORX0,PSORX2,PSORX3,PSOST0,PSOVACL,X,Y,X1,X2,ORN
"RTN","PSOORDRG",105,0)
 Q
"RTN","PSOORDRG",106,0)
CLOZ ;
"RTN","PSOORDRG",107,0)
 S ANQRTN=$P(^PSDRUG(PSODRUG("IEN"),"CLOZ1"),"^"),ANQX=0,P(5)=PSODRUG("IEN"),DFN=PSODFN,X=ANQRTN
"RTN","PSOORDRG",108,0)
 X ^%ZOSF("TEST") I  D @("^"_ANQRTN) S:$G(ANQX) PSORX("DFLG")=1
"RTN","PSOORDRG",109,0)
 K P(5),ANQRTN,ANQX,X
"RTN","PSOORDRG",110,0)
 Q
"RTN","PSOORDRG",111,0)
DRGCHK(PSODFN,DREN,DDRUG)    ;Only check DREN against drug in DDRG()
"RTN","PSOORDRG",112,0)
 ;* PSODFN = Patient's DFN
"RTN","PSOORDRG",113,0)
 ;* DREN   = Dispense drug to be checked against the drug in the array
"RTN","PSOORDRG",114,0)
 ;* DDRUG  = The array of dispense drug in the buffer.
"RTN","PSOORDRG",115,0)
 ;*
"RTN","PSOORDRG",116,0)
 K ^TMP($J,"DI"),^TMP($J,"DD"),^TMP($J,"DC")
"RTN","PSOORDRG",117,0)
 NEW DDRUG0,DDRUGND,COD,PSJINX S COD="",PSJINX=0
"RTN","PSOORDRG",118,0)
 S DDRUG=0 F  S DDRUG=$O(DDRUG(DDRUG)) Q:'DDRUG  D DDRUG^PSJORUT2
"RTN","PSOORDRG",119,0)
 D DRG
"RTN","PSOORDRG",120,0)
 Q
"RTN","PSOORDRG",121,0)
OIDRG(PSODFN,PSOI) ;checks every drug tied to orderable item passed by package use
"RTN","PSOORDRG",122,0)
 K ^TMP($J,"DI"),^TMP($J,"DD"),^TMP($J,"DC"),DD,DC,DI N DREN S INDX=0,PSOPHI=1
"RTN","PSOORDRG",123,0)
 ;build patient's drug profile inpat/outpat/non-va
"RTN","PSOORDRG",124,0)
 D BLD,ENCHK^PSJORUT2(PSODFN,.INDX),NVA
"RTN","PSOORDRG",125,0)
 F DREN=0:0 S DREN=$O(^PSDRUG("ASP",PSOI,DREN)) Q:'DREN  I $D(^PSDRUG(DREN,O)) D DRG
"RTN","PSOORDRG",126,0)
 K PSOPHI D EXIT
"RTN","PSOORDRG",127,0)
 Q
"RTN","PSOORDRG",128,0)
NVA ;checks existing nva
"RTN","PSOORDRG",129,0)
 F I=0:0 S I=$O(^PS(55,PSODFN,"NVA",I)) Q:'I  D:$D(^PS(55,PSODFN,"NVA",I,0))
"RTN","PSOORDRG",130,0)
 .Q:$P(^PS(55,PSODFN,"NVA",I,0),"^",7)
"RTN","PSOORDRG",131,0)
 .S PSOI=$P(^PS(55,PSODFN,"NVA",I,0),"^"),DRG=$P(^(0),"^",2),ORN=$P(^(0),"^",8)
"RTN","PSOORDRG",132,0)
 .I DRG,$G(^PSDRUG(DRG,0))]"" D NVA1 K DRG Q
"RTN","PSOORDRG",133,0)
 .K DRG F DRG=0:0 S DRG=$O(^PSDRUG("ASP",PSOI,DRG)) Q:'DRG  D:$D(^PSDRUG(DRG,0)) NVA1
"RTN","PSOORDRG",134,0)
 K I,PSOOTC,ORN,PSOI,DRG,DRGN,PSOY,VACL,NDF
"RTN","PSOORDRG",135,0)
 Q
"RTN","PSOORDRG",136,0)
NVA1 S PSOY=$G(^PSDRUG(DRG,0)),DRGN=$P(PSOY,"^"),VACL=$P(PSOY,"^",2)
"RTN","PSOORDRG",137,0)
 S NDF=$S($G(^PSDRUG(DRG,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)
"RTN","PSOORDRG",138,0)
 S INDX=$G(INDX)+1,^TMP($J,"ORDERS",INDX)=VACL_"^"_NDF_"^"_DRGN_"^"_ORN_"^"_I_"N;O"
"RTN","PSOORDRG",139,0)
 Q
"RTN","PSOORDRG",140,0)
 ;
"RTN","PSOORDRG",141,0)
REMOTE ;
"RTN","PSOORDRG",142,0)
 I $T(HAVEHDR^ORRDI1)']"" Q
"RTN","PSOORDRG",143,0)
 I '$$HAVEHDR^ORRDI1 Q
"RTN","PSOORDRG",144,0)
 D REMOTE^PSOORRDI(PSODFN,DREN)
"RTN","PSOORDRG",145,0)
 K ^TMP($J,"DI"_PSODFN) ;THIS LEVEL ONLY NEEDED FOR BACKDOOR OUTPATIENT PHARMACY CHECKS
"RTN","PSOORDRG",146,0)
 Q
"RTN","PSOORDRG",147,0)
 ;
"RTN","PSOORED2")
0^72^B74670919
"RTN","PSOORED2",1,0)
PSOORED2 ;ISC-BHAM/SAB-edit orders from backdoor con't ;03/06/95 10:24
"RTN","PSOORED2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**2,51,46,78,102,114,117,133,159,148,247,260,281,289,276,358,251**;DEC 1997;Build 202
"RTN","PSOORED2",3,0)
 ;Reference to $$DIVNCPDP^BPSBUTL supported by IA 4719
"RTN","PSOORED2",4,0)
 ;Reference to $$ECMEON^BPSUTIL supported by IA 4410
"RTN","PSOORED2",5,0)
 ;called from psooredt. cmop edit checks.
"RTN","PSOORED2",6,0)
 Q
"RTN","PSOORED2",7,0)
ISDT D CHK K RF I $G(CMRL) W !,"Released by CMOP.  No editing allowed on Issue Date." D PAUSE^VALM1 K CMRL Q
"RTN","PSOORED2",8,0)
 S %DT="AEX",%DT(0)=-$P(^PSRX(DA,2),"^",2),Y=$P(RX0,"^",13) X ^DD("DD") S %DT("A")="ISSUE DATE: ",%DT("B")=Y D ^%DT I "^"[$E(X) K X,Y,%DT,DTOUT,DUOUT Q
"RTN","PSOORED2",9,0)
 G:Y=-1 ISDT S PSORXED("FLD",1)=Y
"RTN","PSOORED2",10,0)
 ;S DR="1///"_Y,DIE=52 D ^DIE
"RTN","PSOORED2",11,0)
 D KV K X,Y,%DT
"RTN","PSOORED2",12,0)
 Q
"RTN","PSOORED2",13,0)
FLDT D CHK K RF I $G(CMRL) W !,"Released by CMOP.  No editing allowed on Fill Date." D PAUSE^VALM1 K CMRL Q
"RTN","PSOORED2",14,0)
 D KV S Y=$P(^PSRX(DA,2),"^",2) X ^DD("DD") S DIR("A")="FILL DATE",DIR("B")=Y
"RTN","PSOORED2",15,0)
 S DIR(0)="D^"_$P(RX0,"^",13)_":"_$P(PSORXED("RX2"),"^",6)_":EX"
"RTN","PSOORED2",16,0)
 S DIR("?",1)="The earliest fill date allowed is determined by the Issue Date,",DIR("?",2)="the Fill Date cannot be before the Issue Date or past the Expiration Date."
"RTN","PSOORED2",17,0)
 S DIR("?")="Both the month and day are required." D ^DIR
"RTN","PSOORED2",18,0)
 I $D(DIRUT) D KV K PSORXED("FLD",22),X,Y Q
"RTN","PSOORED2",19,0)
 S PSORXED("FLD",22)=Y ;S DR="22R///"_Y,DIE=52 D ^DIE
"RTN","PSOORED2",20,0)
 K X,Y
"RTN","PSOORED2",21,0)
KV K DIR,DUOUT,DTOUT,DIRUT
"RTN","PSOORED2",22,0)
 Q
"RTN","PSOORED2",23,0)
CHK I $D(^PSRX("AR",+$P(PSORXED("RX2"),"^",13),PSORXED("IRXN"))) S CMRL=1 Q
"RTN","PSOORED2",24,0)
 F RF=0:0 S RF=$O(^PSRX(PSORXED("IRXN"),1,RF)) Q:'RF  I $D(^PSRX("AR",+$P(^PSRX(PSORXED("IRXN"),1,RF,0),"^",18),PSORXED("IRXN"))) S CMRL=1
"RTN","PSOORED2",25,0)
 Q
"RTN","PSOORED2",26,0)
CHK1 I +^PSRX(PSORXED("IRXN"),"STA")=5 D  Q:'$G(CMRL)
"RTN","PSOORED2",27,0)
 .S SURX=$O(^PS(52.5,PSORXED("IRXN"),0)) Q:'SURX  I $P(^PS(52.5,SURX,0),"^",7)']""!($P(^(0),"^",7)="Q") S CMRL=1
"RTN","PSOORED2",28,0)
 .E  S CMRL=0
"RTN","PSOORED2",29,0)
 F FEV=0:0 S FEV=$O(^PSRX(PSORXED("IRXN"),4,FEV)) Q:'FEV  I '$P(^PSRX(PSORXED("IRXN"),4,FEV,0),"^",3),$P(^(0),"^",4)<3 S CMRL=0
"RTN","PSOORED2",30,0)
 Q
"RTN","PSOORED2",31,0)
REF ;shows refill info
"RTN","PSOORED2",32,0)
 S RFN=0 F N=0:0 S N=$O(^PSRX(PSORXED("IRXN"),1,N)) Q:'N  S RFM=N,RFN=RFN+1
"RTN","PSOORED2",33,0)
 ;G:RFM=1 SRF 
"RTN","PSOORED2",34,0)
 W ! K DA,DR D KV S DIR(0)="Y",DIR("B")="No",DIR("A")="There "_$S(RFN>1:"are ",1:"is ")_RFN_" refill"_$S(RFN>1:"s.",1:".")_"  Do you want to edit"
"RTN","PSOORED2",35,0)
 D ^DIR D KV Q:'Y
"RTN","PSOORED2",36,0)
SRF W !!,"#  Log Date   Refill Date  Qty               Routing  Lot #       Pharmacist",! F I=1:1:80 W "="
"RTN","PSOORED2",37,0)
 F N=0:0 S N=$O(^PSRX(PSORXED("IRXN"),1,N)) Q:'N  S P1=^(N,0) D
"RTN","PSOORED2",38,0)
 .S DTT=$P(P1,"^",8)\1 D DAT S LOG=DAT,DTT=$P(P1,"^"),$P(RN," ",10)=" " D DAT
"RTN","PSOORED2",39,0)
 .W !,N_"  "_LOG_"   "_DAT_"      "_$P(P1,"^",4)_$E("               ",$L($P(P1,"^",4))+1,15)_"  "_$S($P(P1,"^",2)="M":"MAIL  ",1:"WINDOW")_"   "_$P(P1,"^",6)_$E(RN,$L($P(P1,"^",6))+1,12)
"RTN","PSOORED2",40,0)
 .W $E($S($D(^VA(200,+$P(P1,"^",5),0)):$P(^(0),"^"),1:""),1,16)
"RTN","PSOORED2",41,0)
 .S PSDIV=$S($D(^PS(59,+$P(P1,"^",9),0)):$P(^(0),"^",6),1:"Unknown") W !,"Division: "_PSDIV_$E("        ",$L(PSDIV)+1,8)_"  "
"RTN","PSOORED2",42,0)
 .W "Dispensed: "_$S($P(P1,"^",19):$E($P(P1,"^",19),4,5)_"/"_$E($P(P1,"^",19),6,7)_"/"_$E($P(P1,"^",19),2,3),1:"")_"  "
"RTN","PSOORED2",43,0)
 .S RTS=$S($P(P1,"^",16):" Returned to Stock: "_$E($P(P1,"^",16),4,5)_"/"_$E($P(P1,"^",16),6,7)_"/"_$E($P(P1,"^",16),2,3),1:" Released: "_$S($P(P1,"^",18):$E($P(P1,"^",18),4,5)_"/"_$E($P(P1,"^",18),6,7)_"/"_$E($P(P1,"^",18),2,3),1:""))
"RTN","PSOORED2",44,0)
 .W RTS W:$P(P1,"^",3)]"" !,"   Remarks: "_$P(P1,"^",3)
"RTN","PSOORED2",45,0)
 S DA(1)=PSORXED("IRXN") I RFN=1 S Y=RFM G RFM
"RTN","PSOORED2",46,0)
 W ! D KV S DIR("A")="Select a Refill",DIR(0)="NO^1:"_RFM_":0" D ^DIR Q:$D(DIRUT)
"RTN","PSOORED2",47,0)
RFM I '$D(^PSRX(PSORXED("IRXN"),1,Y,0)) W !,$C(7),"Invalid selection.",! G SRF
"RTN","PSOORED2",48,0)
 S CMRL=0 I $D(^PSRX("AR",+$P(^PSRX(PSORXED("IRXN"),1,Y,0),"^",18),PSORXED("IRXN"),Y)) S CMRL=1 G RFX
"RTN","PSOORED2",49,0)
 F FEV=0:0 S FEV=$O(^PSRX(PSORXED("IRXN"),4,FEV)) Q:'FEV  I $P(^PSRX(PSORXED("IRXN"),4,FEV,0),"^",3)=Y,$P(^(0),"^",4)<3 S CMRL=1
"RTN","PSOORED2",50,0)
RFX N RFL,NDC,DAW,FLDS,QUIT,CHGNDC,CHANGED
"RTN","PSOORED2",51,0)
 W ! S DA=Y,DIE="^PSRX("_DA(1)_",1,",DR=$S('CMRL:".01;1.1",1:"1.2:5;8")
"RTN","PSOORED2",52,0)
 D GETS^DIQ(52.1,DA_","_DA(1)_",",".01;1;1.1;8;11;81","I","FLDS")
"RTN","PSOORED2",53,0)
 S:$D(^PSRX(DA(1),1,DA,0)) PSORXED("RX1")=^PSRX(DA(1),1,DA,0),(RFED,RFL)=DA
"RTN","PSOORED2",54,0)
 I $G(ST)=11!($G(ST)=12)!($G(ST)=14)!($G(ST)=15),$$STATUS^PSOBPSUT(PSORXED("IRXN"),RFL)'="" S QUIT=0 D RFE Q  ;short circuit for DC'd/Expired ECME RXs
"RTN","PSOORED2",55,0)
 N PSORFILL S PSORFILL=DA   ;*276
"RTN","PSOORED2",56,0)
 D ^DIE S QUIT=$D(Y)
"RTN","PSOORED2",57,0)
 ;*276
"RTN","PSOORED2",58,0)
 I '$D(^PSRX(PSORXED("IRXN"),1,PSORFILL)),'$G(PSOSFN) D
"RTN","PSOORED2",59,0)
 .N DA,NOW,IR,FDA
"RTN","PSOORED2",60,0)
 .S DA=$G(PSORXED("IRXN")) Q:'DA
"RTN","PSOORED2",61,0)
 .S (FDA,IR)=0 F  S FDA=$O(^PSRX(DA,"A",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOORED2",62,0)
 .S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSOORED2",63,0)
 .D NOW^%DTC S NOW=%
"RTN","PSOORED2",64,0)
 .S ^PSRX(DA,"A",IR,0)=NOW_"^D^"_DUZ_"^"_$S(PSORFILL>0&(PSORFILL<6):PSORFILL,1:PSORFILL+1)_"^Refill deleted during Rx edit"
"RTN","PSOORED2",65,0)
 K FEV,RFN,RFM,X,Y,DR
"RTN","PSOORED2",66,0)
 I '$G(DA) D REVERSE^PSOBPSU1(PSORXED("IRXN"),RFL,"DE",5) K CMRL,RFED D:$D(PSORX("PSOL"))&($G(DI)=.01) RFD Q
"RTN","PSOORED2",67,0)
 I 'CMRL,'QUIT S DR="1;1.2:5;8" D ^DIE S QUIT=$D(Y)
"RTN","PSOORED2",68,0)
RFE I '$D(^PSRX(PSORXED("IRXN"),1,RFL)) Q
"RTN","PSOORED2",69,0)
 I 'QUIT,$$STATUS^PSOBPSUT(PSORXED("IRXN"),RFL)'="" D
"RTN","PSOORED2",70,0)
 . S NDC=$$GETNDC^PSONDCUT(PSORXED("IRXN"),RFL)
"RTN","PSOORED2",71,0)
 . D EDTDAW^PSODAWUT(PSORXED("IRXN"),RFL,.DAW) I $G(DAW)="^" Q
"RTN","PSOORED2",72,0)
 . D SAVDAW^PSODAWUT(PSORXED("IRXN"),RFL,+$G(DAW))
"RTN","PSOORED2",73,0)
 . D NDC^PSODRG(PSORXED("IRXN"),RFL,,.NDC) I $G(NDC)="^",$G(NDC)="" Q
"RTN","PSOORED2",74,0)
 . I NDC'=$$GETNDC^PSONDCUT(PSORXED("IRXN"),RFL) D
"RTN","PSOORED2",75,0)
 . . S CHGNDC=1 D RXACT^PSOBPSU2(PSORXED("IRXN"),RFL,"NDC changed from "_$$GETNDC^PSONDCUT(PSORXED("IRXN"),RFL)_" to "_NDC_".","E")
"RTN","PSOORED2",76,0)
 . D SAVNDC^PSONDCUT(PSORXED("IRXN"),RFL,NDC)
"RTN","PSOORED2",77,0)
 S CHANGED=$$CHANGED(PSORXED("IRXN"),RFL,.FLDS)
"RTN","PSOORED2",78,0)
 I CHANGED D
"RTN","PSOORED2",79,0)
 . I $P(CHANGED,"^",2),'$$ECMEON^BPSUTIL($$RXSITE^PSOBPSUT(PSORXED("IRXN"),RFL)) D  Q
"RTN","PSOORED2",80,0)
 . . D REVERSE^PSOBPSU1(PSORXED("IRXN"),RFL,"DC",99,"REFILL DIVISION CHANGED",1)
"RTN","PSOORED2",81,0)
 . I $$SUBMIT^PSOBPSUT(PSORXED("IRXN"),RFL,1,1) D
"RTN","PSOORED2",82,0)
 . . N RX S RX=PSORXED("IRXN")
"RTN","PSOORED2",83,0)
 . . I '$P(CHANGED,"^",2),$$STATUS^PSOBPSUT(RX,RFL)="" Q
"RTN","PSOORED2",84,0)
 . . D ECMESND^PSOBPSU1(RX,RFL,,"ED",$$GETNDC^PSONDCUT(RX,RFL),,$S($P(CHANGED,"^",2):"REFILL DIVISION CHANGED",1:"REFILL EDITED"),,+$G(CHGNDC))
"RTN","PSOORED2",85,0)
 . . ; Quit if there is an unresolved Tricare non-billable reject code, PSO*7*358
"RTN","PSOORED2",86,0)
 . . I $$PSOET^PSOREJP3(RX,RFL) S X="Q" Q
"RTN","PSOORED2",87,0)
 . . ;- Checking/Handling DUR/79 Rejects
"RTN","PSOORED2",88,0)
 . . I $$FIND^PSOREJUT(RX,RFL) S X=$$HDLG^PSOREJU1(RX,RFL,"79,88","ED","IOQ","Q")
"RTN","PSOORED2",89,0)
 K DIE,CMRL,DA,DR
"RTN","PSOORED2",90,0)
 Q
"RTN","PSOORED2",91,0)
CHANGED(RX,RFL,PRIOR) ; - Check if fields have changed and should for 3rd Party Claim resubmission
"RTN","PSOORED2",92,0)
 ;Input:  (r) RX    - Rx IEN
"RTN","PSOORED2",93,0)
 ;        (r) RFL   - Refill #
"RTN","PSOORED2",94,0)
 ;        (r) PRIOR - Array with fields
"RTN","PSOORED2",95,0)
 ;Output:  CHANGED  - 0 - Not changed / 1 - Refill field changed ^ Rx Division changed (1 - YES)
"RTN","PSOORED2",96,0)
 N CHANGED,SAVED
"RTN","PSOORED2",97,0)
 S CHANGED=0 D GETS^DIQ(52.1,RFL_","_RX_",",".01;1;1.1;8;11;81","I","SAVED")
"RTN","PSOORED2",98,0)
 F I=.01,1,1.1,11,81 I $G(PRIOR(52.1,RFL_","_RX_",",I,"I"))'=$G(SAVED(52.1,RFL_","_RX_",",I,"I")) S CHANGED=1 Q
"RTN","PSOORED2",99,0)
 I $$DIVNCPDP^BPSBUTL(+$G(PRIOR(52.1,RFL_","_RX_",",8,"I")))'=$$DIVNCPDP^BPSBUTL(+$G(SAVED(52.1,RFL_","_RX_",",8,"I"))) S CHANGED="1^1"
"RTN","PSOORED2",100,0)
 Q CHANGED
"RTN","PSOORED2",101,0)
 ;
"RTN","PSOORED2",102,0)
DAT S DAT="",DTT=DTT\1 Q:DTT'?7N  S DAT=$E(DTT,4,5)_"/"_$E(DTT,6,7)_"/"_$E(DTT,2,3)
"RTN","PSOORED2",103,0)
 Q
"RTN","PSOORED2",104,0)
DIE S DIE=52 D ^DIE I $D(Y) S PSORXED("DFLG")=1
"RTN","PSOORED2",105,0)
 K DIE,DR,X,Y
"RTN","PSOORED2",106,0)
 Q
"RTN","PSOORED2",107,0)
RFD ;check for deleted refill
"RTN","PSOORED2",108,0)
 M PSOZ1("PSOL")=PSORX("PSOL") N I,J,K,PSOX2,PSOX3,PSOX9 S (I,K)=0 D
"RTN","PSOORED2",109,0)
 .F  S I=$O(PSOZ1("PSOL",I)) Q:'I!(K)  S PSOX2=PSOZ1("PSOL",I) I PSOX2[(PSORXED("IRXN")_",") S PSOX9="" D
"RTN","PSOORED2",110,0)
 ..F J=1:1 S PSOX3=$P(PSOX2,",",J) Q:'PSOX3  D
"RTN","PSOORED2",111,0)
 ...I 'K,PSOX3=PSORXED("IRXN") S K=1
"RTN","PSOORED2",112,0)
 ...E  S PSOX9=PSOX9_$S('PSOX9:"",1:",")_PSOX3
"RTN","PSOORED2",113,0)
 ..I K S:PSOX9]"" PSORX("PSOL",I)=PSOX9_"," K:PSOX9="" PSORX("PSOL",I)
"RTN","PSOORED2",114,0)
 K PSOZ1("PSOL")
"RTN","PSOORED2",115,0)
 Q
"RTN","PSOORED2",116,0)
EDTDOSE ;edit med instructions fields
"RTN","PSOORED2",117,0)
 S PSOEDDOS=1 ; identifies origin of call to PSOORED3 for dosing
"RTN","PSOORED2",118,0)
 I '$O(^PSRX(PSORXED("IRXN"),6,0)) D DOSE^PSOORED5 Q
"RTN","PSOORED2",119,0)
 D ^PSOORED3
"RTN","PSOORED2",120,0)
 K PSOEDDOS
"RTN","PSOORED2",121,0)
 Q
"RTN","PSOORED2",122,0)
UPD ;updates dosing array
"RTN","PSOORED2",123,0)
 S HENT=ENT
"RTN","PSOORED2",124,0)
UPD1 I $G(PSORXED("CONJUNCTION",(HENT+1)))]"",'$D(PSORXED("DOSE",(HENT+2))) K PSORXED("CONJUNCTION",(HENT+1)) Q
"RTN","PSOORED2",125,0)
 I $G(PSORXED("CONJUNCTION",(HENT+1)))]"" S PSORXED("CONJUNCTION",HENT)=PSORXED("CONJUNCTION",(HENT+1)) D  G UPD1
"RTN","PSOORED2",126,0)
 .K PSORXED("CONJUNCTION",(HENT+1))
"RTN","PSOORED2",127,0)
 .F  Q:'$D(PSORXED("DOSE",(HENT+2)))  D
"RTN","PSOORED2",128,0)
 ..S PSORXED("DOSE",(HENT+1))=PSORXED("DOSE",(HENT+2))
"RTN","PSOORED2",129,0)
 ..S PSORXED("DOSE ORDERED",(HENT+1))=$G(PSORXED("DOSE ORDERED",(HENT+2)))
"RTN","PSOORED2",130,0)
 ..S PSORXED("UNITS",(HENT+1))=$G(PSORXED("UNITS",(HENT+2)))
"RTN","PSOORED2",131,0)
 ..S PSORXED("NOUN",(HENT+1))=$G(PSORXED("NOUN",(HENT+2)))
"RTN","PSOORED2",132,0)
 ..S PSORXED("DURATION",(HENT+1))=$G(PSORXED("DURATION",(HENT+2)))
"RTN","PSOORED2",133,0)
 ..S PSORXED("CONJUNCTION",(HENT+1))=$G(PSORXED("CONJUNCTION",(HENT+2)))
"RTN","PSOORED2",134,0)
 ..S PSORXED("ROUTE",(HENT+1))=$G(PSORXED("ROUTE",(HENT+2)))
"RTN","PSOORED2",135,0)
 ..S PSORXED("SCHEDULE",(HENT+1))=$G(PSORXED("SCHEDULE",(HENT+2)))
"RTN","PSOORED2",136,0)
 ..S PSORXED("ODOSE",(HENT+1))=$G(PSORXED("ODOSE",(HENT+2)))
"RTN","PSOORED2",137,0)
 ..S HENT=HENT+1
"RTN","PSOORED2",138,0)
 ..I $G(PSORXED("CONJUNCTION",(HENT+2)))]"" Q
"RTN","PSOORED2",139,0)
 ..K PSORXED("UNITS",(HENT+1)),PSORXED("NOUN",(HENT+1)),PSORXED("DURATION",(HENT+1)),PSORXED("CONJUNCTION",(HENT+1)),PSORXED("ROUTE",(HENT+1)),PSORXED("SCHEDULE",(HENT+1)),PSORXED("DOSE",(HENT+1)),PSORXED("DOSE ORDERED",(HENT+1))
"RTN","PSOORED2",140,0)
 ..K PSORXED("VERB",(HENT+1)),PSORXED("ODOSE",(HENT+1))
"RTN","PSOORED2",141,0)
 S PSORXED("ENT")=HENT K HENT,SENT D EN^PSOFSIG(.PSORXED)
"RTN","PSOORED2",142,0)
 Q
"RTN","PSOORED2",143,0)
UPD2 I $G(PSORXED("CONJUNCTION",(HENT+1)))]"",'$D(PSORXED("DOSE",(HENT+2))) K PSORXED("CONJUNCTION",(HENT+1)) Q
"RTN","PSOORED2",144,0)
 I $G(PSORXED("CONJUNCTION",(HENT+1)))]"" S PSORXED("CONJUNCTION",HENT)=PSORXED("CONJUNCTION",(HENT+1)) D  G UPD1
"RTN","PSOORED2",145,0)
 .K PSORXED("CONJUNCTION",(HENT+1)) I $D(PSORXED("DOSE",(HENT+2))) D
"RTN","PSOORED2",146,0)
 ..S PSORXED("DOSE",(HENT+1))=PSORXED("DOSE",(HENT+2))
"RTN","PSOORED2",147,0)
 ..S PSORXED("DOSE ORDERED",(HENT+1))=$G(PSORXED("DOSE ORDERED",(HENT+2)))
"RTN","PSOORED2",148,0)
 ..S PSORXED("UNITS",(HENT+1))=$G(PSORXED("UNITS",(HENT+2)))
"RTN","PSOORED2",149,0)
 ..S PSORXED("NOUN",(HENT+1))=$G(PSORXED("NOUN",(HENT+2)))
"RTN","PSOORED2",150,0)
 ..S PSORXED("VERB",(HENT+1))=$G(PSORXED("VERB",(HENT+2)))
"RTN","PSOORED2",151,0)
 ..S PSORXED("DURATION",(HENT+1))=$G(PSORXED("DURATION",(HENT+2)))
"RTN","PSOORED2",152,0)
 ..S PSORXED("CONJUNCTION",(HENT+1))=$G(PSORXED("CONJUNCTION",(HENT+2)))
"RTN","PSOORED2",153,0)
 ..S PSORXED("ROUTE",(HENT+1))=$G(PSORXED("ROUTE",(HENT+2)))
"RTN","PSOORED2",154,0)
 ..S PSORXED("SCHEDULE",(HENT+1))=$G(PSORXED("SCHEDULE",(HENT+2)))
"RTN","PSOORED2",155,0)
 ..S PSORXED("ODOSE",(HENT+1))=$G(PSORXED("ODOSE",(HENT+2)))
"RTN","PSOORED2",156,0)
 ..S HENT=HENT+1
"RTN","PSOORED2",157,0)
 ..I $G(PSORXED("CONJUNCTION",(HENT+1)))]"" Q
"RTN","PSOORED2",158,0)
 ..K PSORXED("UNITS",(HENT+1)),PSORXED("NOUN",(HENT+1)),PSORXED("DURATION",(HENT+1)),PSORXED("ROUTE",(HENT+1)),PSORXED("SCHEDULE",(HENT+1)),PSORXED("DOSE",(HENT+1)),PSORXED("DOSE ORDERED",(HENT+1)),PSORXED("VERB",(HENT+1))
"RTN","PSOORED2",159,0)
 ..K PSORXED("ODOSE",(HENT+1))
"RTN","PSOORED2",160,0)
 F I=0:0 S I=$O(PSORXED("DOSE",I)) Q:'I  S SENT=$G(SENT)+1
"RTN","PSOORED2",161,0)
 S PSORXED("ENT")=SENT K HENT,SENT D EN^PSOFSIG(.PSORXED)
"RTN","PSOORED2",162,0)
 Q
"RTN","PSOORED3")
0^69^B61521458
"RTN","PSOORED3",1,0)
PSOORED3 ;BIR/SAB-edit finished orders through backdoor ;10/20/06 11:09am
"RTN","PSOORED3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**46,78,99,117,133,148,249,251**;DEC 1997;Build 202
"RTN","PSOORED3",3,0)
 ;External reference to PS(51.2 supported by DBIA 2226
"RTN","PSOORED3",4,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5424
"RTN","PSOORED3",5,0)
 ;called from psoored2
"RTN","PSOORED3",6,0)
 D DOLST
"RTN","PSOORED3",7,0)
 ;
"RTN","PSOORED3",8,0)
DOSE ;adds dosing info
"RTN","PSOORED3",9,0)
 I '$G(PSORXED("ENT")) F  S I=$O(PSORXED("DOSE",I)) Q:'I  S PSORXED("ENT")=$G(PSORXED("ENT"))+1
"RTN","PSOORED3",10,0)
 K ROU,UNITN,STRE,PSODOSE,RTE,NOUN,VERB M PSODOSE=PSORXED
"RTN","PSOORED3",11,0)
 D KV K FIELD,DOSEOR,DOOR,X,Y,UNITS S ENT=1
"RTN","PSOORED3",12,0)
ASK S ROU="PSOORED3" D ASK^PSOBKDED K ROU I $G(JUMP) K JUMP G JUMP
"RTN","PSOORED3",13,0)
 G:$D(DIRUT) EXQ
"RTN","PSOORED3",14,0)
 I $G(QUIT)]"" K QUIT,ROU Q
"RTN","PSOORED3",15,0)
 ;
"RTN","PSOORED3",16,0)
 I $G(VERB)]"" S PSORXED("VERB",ENT)=VERB G DUPD
"RTN","PSOORED3",17,0)
VER D VER^PSOOREDX I X[U,$L(X)>1 S FIELD="VER" G JUMP
"RTN","PSOORED3",18,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED3",19,0)
 I X="@" K PSORXED("VERB",ENT),VERB G DUPD
"RTN","PSOORED3",20,0)
 S:X'="" (PSORXED("VERB",ENT),VERB)=X
"RTN","PSOORED3",21,0)
DUPD ;
"RTN","PSOORED3",22,0)
 I $G(PSORXED("DOSE",ENT))'?.N&($G(PSORXED("DOSE",ENT))'?.N1".".N)!'DOSE("LD") K PSORXED("DOSE ORDERED",ENT),DUPD G NOU1
"RTN","PSOORED3",23,0)
 D DUPD^PSOOREDX
"RTN","PSOORED3",24,0)
 S DIR("B")=$S($G(PSORXED("DOSE ORDERED",ENT))]"":PSORXED("DOSE ORDERED",ENT),1:"") S:$E($G(DIR("B")),1)="." DIR("B")="0"_$G(DIR("B")) K:DIR("B")="" DIR("B")
"RTN","PSOORED3",25,0)
 D ^DIR I X[U,$L(X)>1 S FIELD="DUPD" G JUMP
"RTN","PSOORED3",26,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED3",27,0)
 I X="@"!(X=0) W !,"Dispense Units Per Dose is Required!!",! G DUPD
"RTN","PSOORED3",28,0)
 D STR^PSOOREDX
"RTN","PSOORED3",29,0)
NOU1 G:'$G(PSORXED("DOSE ORDERED",ENT)) RTE
"RTN","PSOORED3",30,0)
 D CNON
"RTN","PSOORED3",31,0)
 N PSONDEF
"RTN","PSOORED3",32,0)
 I $G(NOUN)]"" S PSORXED("NOUN",ENT)=NOUN
"RTN","PSOORED3",33,0)
NOU D NOU^PSOOREDX I X[U,$L(X)>1 S FIELD="NOU" G JUMP
"RTN","PSOORED3",34,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED3",35,0)
 I X="@" K PSORXED("NOUN",ENT),NOUN G RTE
"RTN","PSOORED3",36,0)
 I X'="",$G(PSONDEF)="" S NOUN=X
"RTN","PSOORED3",37,0)
 I X'="",$G(PSONDEF)'=X S NOUN=X
"RTN","PSOORED3",38,0)
 S:X'="" PSORXED("NOUN",ENT)=X
"RTN","PSOORED3",39,0)
RTE S:$G(PSORXED("ROUTE",ENT))']"" DRET=1
"RTN","PSOORED3",40,0)
 K JUMP S ROU="PSOORED3" D RTE^PSOBKDED K ROU
"RTN","PSOORED3",41,0)
 I $G(JUMP) K JUMP G JUMP
"RTN","PSOORED3",42,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED3",43,0)
 I $G(QUIT) K QUIT,ROU Q
"RTN","PSOORED3",44,0)
 ;
"RTN","PSOORED3",45,0)
SCH D SCH^PSOBKDED I X[U,$L(X)>1 S FIELD="SCH" G JUMP
"RTN","PSOORED3",46,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED3",47,0)
 S SCH=Y D SCH^PSOSIG I $G(SCH)']"" G SCH
"RTN","PSOORED3",48,0)
 S PSORXED("SCHEDULE",ENT)=SCH W " ("_SCHEX_")" K SCH,SCHEX,X,Y,PSOSCH
"RTN","PSOORED3",49,0)
 S:PSORXED("ENT")<ENT PSORXED("ENT")=ENT
"RTN","PSOORED3",50,0)
 ;
"RTN","PSOORED3",51,0)
DUR D KV K EXP S DIR(0)="52.0113,4",DIR("A")="LIMITED DURATION (IN MONTHS, WEEKS, DAYS, HOURS OR MINUTES)"
"RTN","PSOORED3",52,0)
 S DIR("B")=$S($G(DUR)]"":DUR,$G(PSORXED("DURATION",ENT))]"":PSORXED("DURATION",ENT),1:"") K:DIR("B")="" DIR("B")
"RTN","PSOORED3",53,0)
 D ^DIR I X[U,$L(X)>1 S FIELD="DUR" G JUMP
"RTN","PSOORED3",54,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED3",55,0)
 D DUR1^PSOOREDX
"RTN","PSOORED3",56,0)
 ;
"RTN","PSOORED3",57,0)
CON D CON^PSOOREDX I X[U,$L(X)>1 S FIELD="CON" G JUMP
"RTN","PSOORED3",58,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED3",59,0)
 I X="@",$G(PSORXED("CONJUNCTION",ENT))="" W !,?10,"Invalid Entry - nothing to delete!!" G CON
"RTN","PSOORED3",60,0)
 S:X'=""&(X'="@") PSORXED("CONJUNCTION",ENT)=Y
"RTN","PSOORED3",61,0)
 I X="@" D CON1^PSOOREDX G:$D(DIRUT) EXQ G:'Y CON N CKX S CKX=1 D UPD^PSOOREDX G CON
"RTN","PSOORED3",62,0)
 ;
"RTN","PSOORED3",63,0)
 N PSODLBD4 S PSOSAVX=X,PSODLBD4=1
"RTN","PSOORED3",64,0)
 I $G(PSORXED("CONJUNCTION",ENT))]"" D:$$DS^PSSDSAPI DCHK1^PSODOSUT S PSOCKCON=1 G:$G(PSORXED("DFLG"))!($G(PSORX("DFLG"))) EXQ S ENT=ENT+1 K DIR G ASK
"RTN","PSOORED3",65,0)
 E  D  I $$DS^PSSDSAPI,$$DCHK^PSODOSUT S PSORX("DFLG")=1,PSORXED("DFLG")=1 G EXQ
"RTN","PSOORED3",66,0)
 . Q:$G(PSORXED)!($G(PSOEDDOS))
"RTN","PSOORED3",67,0)
 . K PSOCKCON
"RTN","PSOORED3",68,0)
 I PSOSAVX="",$G(PSORXED)!($D(PSOEDDOS)) K PSOCKCON
"RTN","PSOORED3",69,0)
 K PSOSAVX
"RTN","PSOORED3",70,0)
 ;
"RTN","PSOORED3",71,0)
 S DENT=$O(PSORXED("DOSE",ENT)) I DENT,(ENT+1)'=DENT D
"RTN","PSOORED3",72,0)
 .K PSORXED("DOSE",DENT),PSORXED("NOUN",DENT),PSORXED("VERB",DENT),PSORXED("DOSE ORDERED",DENT),PSORXED("ROUTE",DENT),PSORXED("ODOSE",DENT)
"RTN","PSOORED3",73,0)
 .K PSORXED("SCHEDULE",DENT),PSORXED("DURATION",DENT),PSORXED("CONJUNCTION",DENT),DENT
"RTN","PSOORED3",74,0)
 I $G(FIELD)]"" K FIELD S QUIT=1
"RTN","PSOORED3",75,0)
 I $O(^PSRX(PSORXED("IRXN"),"INS1",0)) D
"RTN","PSOORED3",76,0)
 .F D=0:0 S D=$O(^PSRX(PSORXED("IRXN"),"INS1",D)) Q:'D  S PSORXED("SIG",D)=^PSRX(PSORXED("IRXN"),"INS1",D,0)
"RTN","PSOORED3",77,0)
 D EN^PSOFSIG(.PSORXED) D VER^PSOORED7:'$G(PSOVER) I $G(CKX),'$G(PSOSIGFL) D M1 K CKX
"RTN","PSOORED3",78,0)
 I $G(PSOSIGFL)=1 S PSORXED("ENT")=ENT,SIGOK=1 G EX1
"RTN","PSOORED3",79,0)
 K QTY,QTYHLD S:$G(PSORXED("QTY")) QTYHLD=PSORXED("QTY") D QTY^PSOSIG(.PSORXED) I $G(PSORXED("QTY")) S QTY=1
"RTN","PSOORED3",80,0)
 I $G(QTYHLD),'$G(PSORXED("QTY")) S PSORXED("QTY")=QTYHLD
"RTN","PSOORED3",81,0)
 K QTYHLD Q:$G(PSOVER)!($G(PSOREEDQ))
"RTN","PSOORED3",82,0)
UDSIG I $O(SIG(0)) D
"RTN","PSOORED3",83,0)
 .S D=0 F  S D=$O(SIG(D)) Q:'D  S ^PSRX(PSORXED("IRXN"),"SIG1",D,0)=SIG(D),$P(^PSRX(PSORXED("IRXN"),"SIG1",0),"^",3)=+$P($G(^PSRX(PSORXED("IRXN"),"SIG1",0)),"^",3)+1,$P(^(0),"^",4)=+$P($G(^(0)),"^",4)+1 Q:'$O(SIG(D))
"RTN","PSOORED3",84,0)
 .S (A,I)=0 F  S I=$O(^PSRX(PSORXED("IRXN"),"A",I)) Q:'I  S A=A+1
"RTN","PSOORED3",85,0)
 .D NOW^%DTC I $G(QTY) S A=A+1,^PSRX(PSORXED("IRXN"),"A",A,0)=%_"^E^"_DUZ_"^0^Quantity Updated "_"("_$P(^PSRX(PSORXED("IRXN"),0),"^",7)_")",$P(^PSRX(PSORXED("IRXN"),0),"^",7)=$G(PSORXED("QTY")) K QTY
"RTN","PSOORED3",86,0)
 .S A=A+1,^PSRX(PSORXED("IRXN"),"A",A,0)=%_"^E^"_DUZ_"^0^New Dosing Instructions Added",^PSRX(PSORXED("IRXN"),"A",A,1)="ORIGINAL SIG^" D
"RTN","PSOORED3",87,0)
 ..I '$P($G(^PSRX(PSORXED("IRXN"),"SIG")),"^",2) S $P(^PSRX(PSORXED("IRXN"),"A",A,1),"^",2)=$P($G(^PSRX(PSORXED("IRXN"),"SIG")),"^") Q
"RTN","PSOORED3",88,0)
 ..F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),"SIG1",I)) Q:'I  S ^PSRX(PSORXED("IRXN"),"A",A,2,I,0)=^PSRX(PSORXED("IRXN"),"SIG1",I,0),^PSRX(PSORXED("IRXN"),"A",A,2,0)="^52.34A^"_I_"^"_I
"RTN","PSOORED3",89,0)
 .S ^PSRX(PSORXED("IRXN"),"SIG")="^1"
"RTN","PSOORED3",90,0)
 .K SIG,A,I
"RTN","PSOORED3",91,0)
 S ^PSRX(PSORXED("IRXN"),6,0)="^52.0113^"_ENT_"^"_ENT
"RTN","PSOORED3",92,0)
 F I=1:1:ENT S ^PSRX(PSORXED("IRXN"),6,I,0)=PSORXED("DOSE",I)_"^"_$G(PSORXED("DOSE ORDERED",I))_"^"_$G(PSORXED("UNITS",I))_"^"_$G(PSORXED("NOUN",I))_"^" D
"RTN","PSOORED3",93,0)
 .S ^PSRX(PSORXED("IRXN"),6,I,0)=^PSRX(PSORXED("IRXN"),6,I,0)_$G(PSORXED("DURATION",I))_"^"_$G(PSORXED("CONJUNCTION",I))_"^"_$G(PSORXED("ROUTE",I))_"^"_$G(PSORXED("SCHEDULE",I))_"^"_$G(PSORXED("VERB",I))
"RTN","PSOORED3",94,0)
 .S ^PSRX(PSORXED("IRXN"),6,I,1)=$G(PSORXED("ODOSE",I))
"RTN","PSOORED3",95,0)
 S ^PSRX(PSORXED("IRXN"),"POE")=1
"RTN","PSOORED3",96,0)
 G EX
"RTN","PSOORED3",97,0)
 Q
"RTN","PSOORED3",98,0)
EX ;
"RTN","PSOORED3",99,0)
 K PSORXED("DOSE"),DOSE,DUPD,SCH,PSORXED("NOUN"),PSORXED("VERB"),VERB,NOUN,PSORXED("DOSE ORDERED"),DOSEOR,PSORXED("ROUTE"),ENT,PSORTE,SIG,PSODOSE
"RTN","PSOORED3",100,0)
 K PSORXED("SCHEDULE"),PSORXED("DURATION"),PSORXED("CONJUNCTION"),DURA,X,Y,PSORXED("ODOSE")
"RTN","PSOORED3",101,0)
EX1 K STRE,UNITN,DOSE,DUPD,SCH,VERB,NOUN,DOSEOR,RTE,DUR,X,Y,ENTS,PSOSCH,ERTE,ROU
"RTN","PSOORED3",102,0)
KV K DIR,DIRUT,DUOUT,DTOUT
"RTN","PSOORED3",103,0)
 Q
"RTN","PSOORED3",104,0)
EXQ K PSORXED,PSOSIGFL M PSORXED=PSODOSE D EN^PSOFSIG(.PSORXED) S PSORXED("DFLG")=1 D M1 G EX
"RTN","PSOORED3",105,0)
 Q
"RTN","PSOORED3",106,0)
M1 D M1^PSOOREDX
"RTN","PSOORED3",107,0)
 Q
"RTN","PSOORED3",108,0)
DOLST1(PSORXED) ;
"RTN","PSOORED3",109,0)
 ;
"RTN","PSOORED3",110,0)
DOLST F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),6,I)) Q:'I  S INST=^(I,0) D
"RTN","PSOORED3",111,0)
 .S PSORXED("DOSE",I)=$P(INST,"^"),PSORXED("DOSE ORDERED",I)=$P(INST,"^",2),PSORXED("UNITS",I)=$P(INST,"^",3),PSORXED("NOUN",I)=$P(INST,"^",4)
"RTN","PSOORED3",112,0)
 .I $P(INST,"^",5)]"" D
"RTN","PSOORED3",113,0)
 ..S PSORXED("DURATION",I)=$S($E($P(INST,"^",5),1)'?.N:$E($P(INST,"^",5),2,99)_$E($P(INST,"^",5),1),1:$P(INST,"^",5))
"RTN","PSOORED3",114,0)
 .S PSORXED("ROUTE",I)=$P(INST,"^",7),PSORXED("SCHEDULE",I)=$P(INST,"^",8)
"RTN","PSOORED3",115,0)
 .S PSORXED("CONJUNCTION",I)=$P(INST,"^",6),PSORXED("VERB",I)=$P(INST,"^",9),OLENT=I
"RTN","PSOORED3",116,0)
 .S PSORXED("ODOSE",I)=$G(^PSRX(PSORXED("IRXN"),6,I,1))
"RTN","PSOORED3",117,0)
 K:'$O(PSORXED("DOSE",0)) PSORXED("ENT"),OLENT
"RTN","PSOORED3",118,0)
 S PSORXED("INS")=$G(^PSRX(PSORXED("IRXN"),"INS"))
"RTN","PSOORED3",119,0)
 Q
"RTN","PSOORED3",120,0)
UPDSIG ;updates sig
"RTN","PSOORED3",121,0)
 K ^PSRX(PSORXED("IRXN"),"SIG1") S ^PSRX(PSORXED("IRXN"),"SIG1",0)="^52.04A^^"
"RTN","PSOORED3",122,0)
 S D=0 F  S D=$O(SIG(D)) Q:'D  S ^PSRX(PSORXED("IRXN"),"SIG1",D,0)=SIG(D),$P(^PSRX(PSORXED("IRXN"),"SIG1",0),"^",3)=+$P($G(^PSRX(PSORXED("IRXN"),"SIG1",0)),"^",3)+1,$P(^(0),"^",4)=+$P($G(^(0)),"^",4)+1
"RTN","PSOORED3",123,0)
 S ^PSRX(PSORXED("IRXN"),"SIG")="^1"
"RTN","PSOORED3",124,0)
 Q
"RTN","PSOORED3",125,0)
JUMP ;jump to fields
"RTN","PSOORED3",126,0)
 I $L($E(X,2,99))<3 W !,"Field Name Must Be At Least 3 Characters in Length",! G @FIELD
"RTN","PSOORED3",127,0)
 D FNM^PSOOREDX
"RTN","PSOORED3",128,0)
 I FLDNM']"" K X,NM,FLDNM W !,"INVALID FIELD NAME.  PLEASE TRY AGAIN!",! G @FIELD
"RTN","PSOORED3",129,0)
 F AR=1:1:PSORXED("ENT") W !,AR_". "_$P(FLDNM,"^",2)_": "_$S(NM="ROU"&($G(PSORXED($P(FLDNM,"^"),AR))):$P(^PS(51.2,PSORXED($P(FLDNM,"^"),AR),0),"^"),1:$G(PSORXED($P(FLDNM,"^"),AR))) S AR1=AR
"RTN","PSOORED3",130,0)
 D KV S DIR("A",1)="* Indicates which fields will create a New Order",DIR("A")="Select Field to Edit by number",DIR(0)="NO^1:"_AR1 D ^DIR G:$D(DIRUT) @FIELD
"RTN","PSOORED3",131,0)
 D JFN^PSOOREDX G:FLDNM="" @FIELD G @FLDNM
"RTN","PSOORED3",132,0)
 G EX
"RTN","PSOORED3",133,0)
 Q
"RTN","PSOORED3",134,0)
 ;
"RTN","PSOORED3",135,0)
CNON ;
"RTN","PSOORED3",136,0)
 I $G(NOUN)'="" Q
"RTN","PSOORED3",137,0)
 I '$G(PSORXED("DOSE ORDERED",ENT)) Q
"RTN","PSOORED3",138,0)
 N PSONLT,PSONLL,PSONLG
"RTN","PSOORED3",139,0)
 S PSONLL=$P($G(DOSE("DD",+$G(PSODRUG("IEN")))),"^",9) I PSONLL="" Q
"RTN","PSOORED3",140,0)
 S PSONLG=$L(PSONLL)
"RTN","PSOORED3",141,0)
 I PSONLG'>3 Q
"RTN","PSOORED3",142,0)
 S PSONLT=$E(PSONLL,(PSONLG-2),PSONLG)
"RTN","PSOORED3",143,0)
 I PSONLT'="(S)",PSONLT'="(s)" Q
"RTN","PSOORED3",144,0)
 ;test noun of (S)
"RTN","PSOORED3",145,0)
 K NOUN ; NOT SURE ABOUT THIS???
"RTN","PSOORED3",146,0)
 I $G(PSORXED("DOSE ORDERED",ENT))>1 S PSORXED("NOUN",ENT)=$E(PSONLL,1,(PSONLG-3))_$E(PSONLT,2) Q
"RTN","PSOORED3",147,0)
 S PSORXED("NOUN",ENT)=$E(PSONLL,1,(PSONLG-3))
"RTN","PSOORED3",148,0)
 Q
"RTN","PSOORED4")
0^73^B52076927
"RTN","PSOORED4",1,0)
PSOORED4 ;BIR/SAB - Edit front door dosing ;07/13/00
"RTN","PSOORED4",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**46,91,78,99,111,117,133,159,148,251**;DEC 1997;Build 202
"RTN","PSOORED4",3,0)
 ;External reference ^PS(51 supported by DBIA 2224
"RTN","PSOORED4",4,0)
 ;External reference to PS(51.2 supported by DBIA 2226
"RTN","PSOORED4",5,0)
 ;External reference to PS(51.1 supported by DBIA 2225
"RTN","PSOORED4",6,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5424
"RTN","PSOORED4",7,0)
 ;called from psoornew
"RTN","PSOORED4",8,0)
 ;
"RTN","PSOORED4",9,0)
DOSE(PSORXED) ;
"RTN","PSOORED4",10,0)
 I '$G(PSODRUG("IEN")) W !,"DRUG NAME REQUIRED!" D 2^PSOORNW1 I '$G(PSODRUG("IEN")) S VALMSG="No Dispense Drug Selected" Q
"RTN","PSOORED4",11,0)
 K ROU,STRE,UNITN,PSODOSE M PSODOSE=PSORXED
"RTN","PSOORED4",12,0)
 D KV K FIELD,DOSEOR,DUPD,X,Y,UNITS S ENT=1,OLENT=PSORXED("ENT")
"RTN","PSOORED4",13,0)
ASK I $G(ORD) W !!,"Possible SIG: " D
"RTN","PSOORED4",14,0)
 .;Coded only for outside orders with no Patient Instructions
"RTN","PSOORED4",15,0)
 .I $O(SIG(""))="",$G(ORD),$P($G(^PS(52.41,ORD,"EXT")),"^")'="" D SIGS^PSOHCPRS
"RTN","PSOORED4",16,0)
 .S INST=0 F  S INST=$O(SIG(INST)) Q:'INST  S MIG=SIG(INST) D
"RTN","PSOORED4",17,0)
 ..F SG=1:1:$L(MIG," ") W:$X+$L($P(MIG," ",SG)_" ")>IOM !?14 W $P(MIG," ",SG)_" "
"RTN","PSOORED4",18,0)
 K SG,INST,MIG
"RTN","PSOORED4",19,0)
 S ROU="PSOORED4",II=ENT D ASK^PSOBKDED K ROU,II I $G(JUMP) K JUMP G JUMP
"RTN","PSOORED4",20,0)
 G:$D(DIRUT) EXQ
"RTN","PSOORED4",21,0)
 ;
"RTN","PSOORED4",22,0)
 I $G(VERB)]"" S PSORXED("VERB",ENT)=VERB G DUPD
"RTN","PSOORED4",23,0)
VER D VER^PSOOREDX I X[U,$L(X)>1 S FIELD="VER" G JUMP
"RTN","PSOORED4",24,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED4",25,0)
 I X="@" K PSORXED("VERB",ENT),VERB G DUPD
"RTN","PSOORED4",26,0)
 S:X'="" (PSORXED("VERB",ENT),VERB)=X
"RTN","PSOORED4",27,0)
DUPD ;
"RTN","PSOORED4",28,0)
 I $G(PSORXED("DOSE",ENT))'?.N&($G(PSORXED("DOSE",ENT))'?.N1".".N)!'DOSE("LD") K PSORXED("DOSE ORDERED",ENT),DUPD G NOU1
"RTN","PSOORED4",29,0)
 D DUPD^PSOOREDX
"RTN","PSOORED4",30,0)
 S DIR("B")=$S($G(PSORXED("DOSE ORDERED",ENT))]"":PSORXED("DOSE ORDERED",ENT),1:1) S:$E($G(DIR("B")),1)="." DIR("B")="0"_$G(DIR("B")) K:DIR("B")="" DIR("B")
"RTN","PSOORED4",31,0)
 D ^DIR I X[U,$L(X)>1 S FIELD="DUPD" G JUMP
"RTN","PSOORED4",32,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED4",33,0)
 I X="@"!(X=0) W !,"Dispense Units Per Dose is Required!!",! G DUPD
"RTN","PSOORED4",34,0)
 D STR^PSOOREDX
"RTN","PSOORED4",35,0)
NOU1 G:'$G(PSORXED("DOSE ORDERED",ENT)) RTE
"RTN","PSOORED4",36,0)
 D CNON^PSOORED3
"RTN","PSOORED4",37,0)
 N PSONDEF
"RTN","PSOORED4",38,0)
 I $G(NOUN)]"" S PSORXED("NOUN",ENT)=NOUN
"RTN","PSOORED4",39,0)
NOU D NOU^PSOOREDX I X[U,$L(X)>1 S FIELD="NOU" G JUMP
"RTN","PSOORED4",40,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED4",41,0)
 I X="@" K PSORXED("NOUN",ENT),NOUN G RTE
"RTN","PSOORED4",42,0)
 I X'="",$G(PSONDEF)="" S NOUN=X
"RTN","PSOORED4",43,0)
 I X'="",$G(PSONDEF)'=X S NOUN=X
"RTN","PSOORED4",44,0)
 S:X'="" PSORXED("NOUN",ENT)=X
"RTN","PSOORED4",45,0)
 ;
"RTN","PSOORED4",46,0)
RTE K JUMP S ROU="PSOORED4" D RTE^PSOBKDED K ROU
"RTN","PSOORED4",47,0)
 I $G(JUMP) K JUMP G JUMP
"RTN","PSOORED4",48,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED4",49,0)
 ;
"RTN","PSOORED4",50,0)
SCH D SCH^PSOBKDED I X[U,$L(X)>1 S FIELD="SCH" G JUMP
"RTN","PSOORED4",51,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED4",52,0)
 S SCH=Y D SCH^PSOSIG I $G(SCH)']"" G SCH
"RTN","PSOORED4",53,0)
 S PSORXED("SCHEDULE",ENT)=SCH W " ("_SCHEX_")" K SCH,SCHEX,X,Y,PSOSCH
"RTN","PSOORED4",54,0)
 S:PSORXED("ENT")<ENT PSORXED("ENT")=ENT
"RTN","PSOORED4",55,0)
 ;
"RTN","PSOORED4",56,0)
DUR D KV K EXP S DIR(0)="52.0113,4",DIR("A")="LIMITED DURATION (IN DAYS, HOURS OR MINUTES)"
"RTN","PSOORED4",57,0)
 S DIR("B")=$S($G(PSORXED("DURATION",ENT))]"":PSORXED("DURATION",ENT),1:"") K:DIR("B")="" DIR("B")
"RTN","PSOORED4",58,0)
 D ^DIR I X[U,$L(X)>1 S FIELD="DUR" G JUMP
"RTN","PSOORED4",59,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED4",60,0)
 D DUR1^PSOOREDX
"RTN","PSOORED4",61,0)
 ;
"RTN","PSOORED4",62,0)
CON D CON^PSOOREDX I X[U,$L(X)>1 S FIELD="CON" G JUMP
"RTN","PSOORED4",63,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED4",64,0)
 I X="@",$G(PSORXED("CONJUNCTION",ENT))="" W !,?10,"Invalid Entry - nothing to delete!!" G CON
"RTN","PSOORED4",65,0)
 S:X'=""&(X'="@") PSORXED("CONJUNCTION",ENT)=Y
"RTN","PSOORED4",66,0)
 I X="@",$D(PSORXED("CONJUNCTION",ENT)) D CON1^PSOOREDX G:$D(DIRUT) EXQ G:'Y CON N CKX S CKX=1 D UPD^PSOOREDX G CON
"RTN","PSOORED4",67,0)
 ;
"RTN","PSOORED4",68,0)
 N PSODLBD4 S PSOSAVX=X,PSODLBD4=1,PSOEDDOS=1
"RTN","PSOORED4",69,0)
 I $G(PSORXED("CONJUNCTION",ENT))]"" D:$$DS^PSSDSAPI DCHK1^PSODOSUT S PSOCKCON=1 G:$G(PSONEW("DFLG")) EX S ENT=ENT+1 K DIR G ASK
"RTN","PSOORED4",70,0)
 E  D  I $$DS^PSSDSAPI,$$DCHK^PSODOSUT S PSORX("DFLG")=1,PSONEW("DFLG")=1 G EX
"RTN","PSOORED4",71,0)
 . Q:$G(PSORXED)!$G(PSOEDDOS)
"RTN","PSOORED4",72,0)
 . K PSOCKCON
"RTN","PSOORED4",73,0)
 I PSOSAVX="",$G(PSORXED) K PSOCKCON,PSOEDDOS
"RTN","PSOORED4",74,0)
 K PSOSAVX
"RTN","PSOORED4",75,0)
 ;
"RTN","PSOORED4",76,0)
 S X=$G(PSORXED("INS")) D SIG^PSOHELP S:$G(INS1)]"" PSORXED("SIG")=$E(INS1,2,9999999)
"RTN","PSOORED4",77,0)
 D EN^PSOFSIG(.PSORXED),VERI I $G(CKX),'$G(PSOSIGFL) D MP1 K CKX
"RTN","PSOORED4",78,0)
 I $G(PSOSIGFL)=1 S PSORXED("ENT")=ENT,SIGOK=1,VALMSG="This change will create a new prescription!",NCPDPFLG=1
"RTN","PSOORED4",79,0)
 K QTYHLD S:$G(PSORXED("QTY")) QTYHLD=PSORXED("QTY") D QTY^PSOSIG(.PSORXED) I $G(PSORXED("QTY")) S QTY=1
"RTN","PSOORED4",80,0)
 I $G(QTYHLD),'$G(PSORXED("QTY")) S PSORXED("QTY")=QTYHLD
"RTN","PSOORED4",81,0)
 K QTYHLD
"RTN","PSOORED4",82,0)
 I '$G(PSORXED("QTY")),$P(OR0,"^",10) S PSORXED("QTY")=$P(OR0,"^",10)
"RTN","PSOORED4",83,0)
EX ;
"RTN","PSOORED4",84,0)
 K PSOBDR,PSOBDRG,PSOSCH,DUPD,STRE,UNITN,SCH,VERB,NOUN,DOSEOR,RTE,DUR,X,Y,ENTS,PSODOSE,OLENT,FIELD,FLDNM,AR,NM,ENT,STRE,UNITN,PSODOSE,ERTE,ROU
"RTN","PSOORED4",85,0)
KV K DTOUT,DUOUT,DIR,DIRUT
"RTN","PSOORED4",86,0)
 Q
"RTN","PSOORED4",87,0)
EXQ ;
"RTN","PSOORED4",88,0)
 K PSORXED,PSOSIGFL M PSORXED=PSODOSE D EN^PSOFSIG(.PSORXED) D MP1
"RTN","PSOORED4",89,0)
 I $D(PSOBDR) M PSODRUG=PSOBDR K PSOBDR,PSOBDRG
"RTN","PSOORED4",90,0)
 G EX Q
"RTN","PSOORED4",91,0)
MP1 D MP1^PSOOREDX
"RTN","PSOORED4",92,0)
 Q
"RTN","PSOORED4",93,0)
VERI ;checks for changes to dosing instructions
"RTN","PSOORED4",94,0)
 S ENTS=0
"RTN","PSOORED4",95,0)
 F I=0:0 S I=$O(PSORXED("DOSE",I)) Q:'I  S ENTS=$G(ENTS)+1
"RTN","PSOORED4",96,0)
 I ENTS<OLENT!(ENTS>OLENT) S PSOSIGFL=1 Q
"RTN","PSOORED4",97,0)
 F I=1:1:OLENT D
"RTN","PSOORED4",98,0)
 .I PSODOSE("DOSE",I)'=$G(PSORXED("DOSE",I)) S PSOSIGFL=1
"RTN","PSOORED4",99,0)
 .I $G(PSODOSE("DURATION",I))]"" D
"RTN","PSOORED4",100,0)
 ..S DURATION=$S($E(PSODOSE("DURATION",I),1)'?.N:$E(PSODOSE("DURATION",I),2,99)_$E(PSODOSE("DURATION",I),1),1:PSODOSE("DURATION",I))
"RTN","PSOORED4",101,0)
 ..I +DURATION'=+$G(PSORXED("DURATION",I)) S PSOSIGFL=1
"RTN","PSOORED4",102,0)
 .I $G(PSODOSE("CONJUNCTION",I))'=$G(PSORXED("CONJUNCTION",I)) S PSOSIGFL=1
"RTN","PSOORED4",103,0)
 .I PSODOSE("ROUTE",I)'=$G(PSORXED("ROUTE",I)) S PSOSIGFL=1
"RTN","PSOORED4",104,0)
 .I PSODOSE("SCHEDULE",I)'=$G(PSORXED("SCHEDULE",I)) S PSOSIGFL=1
"RTN","PSOORED4",105,0)
 K DURATION Q
"RTN","PSOORED4",106,0)
JUMP ;jump to fields
"RTN","PSOORED4",107,0)
 I $L($E(X,2,99))<3 W !,"Field Name Must Be At Least 3 Characters in Length",! G @FIELD
"RTN","PSOORED4",108,0)
 D FNM^PSOOREDX
"RTN","PSOORED4",109,0)
 I FLDNM']"" K X,NM,FLDNM W !,"INVALID FIELD NAME.  PLEASE TRY AGAIN!",! G @FIELD
"RTN","PSOORED4",110,0)
 F AR=1:1:PSORXED("ENT") W !,AR_". "_$P(FLDNM,"^",2)_": "_$S(NM="ROU"&($G(PSORXED($P(FLDNM,"^"),AR))):$P(^PS(51.2,PSORXED($P(FLDNM,"^"),AR),0),"^"),1:$G(PSORXED($P(FLDNM,"^"),AR))) S AR1=AR
"RTN","PSOORED4",111,0)
 D KV S DIR("A",1)="* Indicates which fields will create a New Order",DIR("A")="Select Field to Edit by number",DIR(0)="NO^1:"_AR1 D ^DIR G:$D(DIRUT) @FIELD
"RTN","PSOORED4",112,0)
 D JFN^PSOOREDX G:FLDNM="" @FIELD G @FLDNM
"RTN","PSOORED4",113,0)
 G EX
"RTN","PSOORED4",114,0)
 Q
"RTN","PSOORED4",115,0)
HLP ;help text for med route
"RTN","PSOORED4",116,0)
 D FULL^VALM1 W !,"Please enter how patient will use the medication!"
"RTN","PSOORED4",117,0)
 S DIC=51.2,X="??",DIC(0)="M",DIC("S")="I $P(^PS(51.2,+Y,0),""^"",4)" D ^DIC K DIC,X,Y
"RTN","PSOORED4",118,0)
 Q
"RTN","PSOORED4",119,0)
SCHLP ;
"RTN","PSOORED4",120,0)
 D FULL^VALM1 W !,"You can choose an entry from the Administration Schedule File (#51.1),",!,"Medication Instruction File (#51) or enter free text."
"RTN","PSOORED4",121,0)
 W !,"The free text entry cannot contain more than 2 spaces or be greater than 20",!,"characters in length."
"RTN","PSOORED4",122,0)
 W ! S DIR(0)="S^A:Administration Schedule File;M:Medication Instruction File;B:Both;F:Free Text",DIR("B")="Both"
"RTN","PSOORED4",123,0)
 S DIR("A")="Do you want to list from" D ^DIR I Y="F"!($G(DIRUT)) K X,Y G X
"RTN","PSOORED4",124,0)
 S LBL=Y G @LBL
"RTN","PSOORED4",125,0)
A ;display 51.1 entries only
"RTN","PSOORED4",126,0)
B K X,Y,DIC S X="??",DIC="^PS(51.1,",DIC(0)="QES",DIC("W")="D DICW^PSOORED4",D="APPSJ" W ! D IX^DIC
"RTN","PSOORED4",127,0)
 K DIC,X I LBL="A"!($G(DTOUT)) K LBL G X
"RTN","PSOORED4",128,0)
 I Y=-1!($G(DUOUT)) K DIR,DTOUT,DUOUT S DIR(0)="Y",DIR("B")="No",DIR("A")="Do you want to continue with the Medication Instruction File"
"RTN","PSOORED4",129,0)
 D ^DIR I 'Y!($G(DTOUT)) K DIR,X,Y G X
"RTN","PSOORED4",130,0)
M K X,Y,DIC S DIC=51,X="??",DIC(0)="M" D ^DIC K DIC,X,Y,DTOUT,DUOUT,LBL
"RTN","PSOORED4",131,0)
X S DIR("?")="^D SCHLP^PSOORED4",DIR("A")="Schedule: ",DIR(0)="FA^1:20^I X[""""""""!(X?.E1C.E)!($A(X)=45)!($L(X,"" "")>3)!($L(X)>20)!($L(X)<1) K X"
"RTN","PSOORED4",132,0)
 S DIR("B")=$S($D(PSOSCH)&('$D(PSORXED("SCHEDULE",ENT))):PSOSCH,$G(PSORXED("SCHEDULE",ENT))]"":PSORXED("SCHEDULE",ENT),1:"") K:DIR("B")="" DIR("B")
"RTN","PSOORED4",133,0)
 Q
"RTN","PSOORED4",134,0)
DICW ;
"RTN","PSOORED4",135,0)
 S Z=$P(^PS(51.1,+Y,0),"^",5),Z=$S(Z="O":-1,Z="S":1,Z="R":-2,1:0) W:Z "  ",$S(Z>0:"SHIFT",Z=-2:"RANGE",1:"ONE-TIME")
"RTN","PSOORED4",136,0)
 I Z'<0,$D(PSJW),$D(^(PSJPP'="PSJ"+1,PSJW,0)),$P(^(0),"^",Z+2)]"" W "  ",$P(^(0),"^",Z+2)
"RTN","PSOORED4",137,0)
 ;Naked reference on DICW+2 is from DICW+1, ^PS(51.1,+Y,0)
"RTN","PSOORED4",138,0)
 Q
"RTN","PSOORED5")
0^28^B59866468
"RTN","PSOORED5",1,0)
PSOORED5 ;BIR/SAB-Rxs without dosing info ;07/20/00
"RTN","PSOORED5",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**46,75,78,100,99,117,133,251**;DEC 1997;Build 202
"RTN","PSOORED5",3,0)
 ;^PS(51.2 - DBIA 2226
"RTN","PSOORED5",4,0)
 ;^PS(50.7 - DBIA 2223
"RTN","PSOORED5",5,0)
 ;^PSDRUG - DBIA 221
"RTN","PSOORED5",6,0)
 ;^PS(55 - DBIA 2228
"RTN","PSOORED5",7,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5424
"RTN","PSOORED5",8,0)
 ;called by psoored2 and psodir
"RTN","PSOORED5",9,0)
 ;pre-poe rxs and new backdoor rxs
"RTN","PSOORED5",10,0)
DOSE1(PSORXED) ;for new rxs
"RTN","PSOORED5",11,0)
DOSE ;pre-poe rx
"RTN","PSOORED5",12,0)
 D KV K ROU,STRE,FIELD,DOSEOR,DUPD,X,Y,UNITS S ENT=1,OLENT=ENT
"RTN","PSOORED5",13,0)
ASK S ROU="PSOORED5" D ASK^PSOBKDED K ROU G:$D(DIRUT) EX
"RTN","PSOORED5",14,0)
 I $G(JUMP) K JUMP G JUMP
"RTN","PSOORED5",15,0)
 I $G(QUIT)]"" K QUIT,ROU Q
"RTN","PSOORED5",16,0)
 ;
"RTN","PSOORED5",17,0)
 I $G(VERB)]"" S PSORXED("VERB",ENT)=VERB G DUPD
"RTN","PSOORED5",18,0)
 I $G(PSORX("EDIT"))']"" W:$G(PSORXED("VERB",ENT))]"" !,"VERB: "_PSORXED("VERB",ENT) G DUPD
"RTN","PSOORED5",19,0)
VER D VER^PSOOREDX
"RTN","PSOORED5",20,0)
 I X[U,$L(X)>1 S FIELD="VER" G JUMP
"RTN","PSOORED5",21,0)
 G:$D(DTOUT)!($D(DUOUT)) EX I X="@" K PSORXED("VERB",ENT),VERB G DUPD
"RTN","PSOORED5",22,0)
 S:X'="" (PSORXED("VERB",ENT),VERB)=X
"RTN","PSOORED5",23,0)
DUPD ;
"RTN","PSOORED5",24,0)
 I $G(PSORXED("DOSE",ENT))'?.N&($G(PSORXED("DOSE",ENT))'?.N1".".N)!'DOSE("LD") K PSORXED("DOSE ORDERED",ENT),DUPD G NOU1
"RTN","PSOORED5",25,0)
 D KV S DIR(0)="52.0113,1",DIR("A")="DISPENSE UNITS PER DOSE"_$S($G(PSORXED("NOUN",ENT))]"":"("_PSORXED("NOUN",ENT)_")",1:"")
"RTN","PSOORED5",26,0)
 I '$G(PSORXED("DOSE",ENT)),$G(PSORXED("DOSE",ENT-1)) S PSORXED("DOSE",ENT)=PSORXED("DOSE",ENT-1)
"RTN","PSOORED5",27,0)
 S DIR("B")=$S($G(PSORXED("DOSE ORDERED",ENT))]"":PSORXED("DOSE ORDERED",ENT),$G(DUPD)]"":DUPD,1:"") S:$E($G(DIR("B")),1)="." DIR("B")="0"_$G(DIR("B")) K:DIR("B")="" DIR("B")
"RTN","PSOORED5",28,0)
 D ^DIR I X[U,$L(X)>1 S FIELD="DUPD" G JUMP
"RTN","PSOORED5",29,0)
 G:$D(DTOUT)!($D(DUOUT)) EX
"RTN","PSOORED5",30,0)
 I X="@"!(X=0) W !,"Dispense Units Per Dose is Required!!",! G DUPD
"RTN","PSOORED5",31,0)
 D STR^PSOOREDX
"RTN","PSOORED5",32,0)
 ;
"RTN","PSOORED5",33,0)
NOU1 G:'$D(DUPD) RTE D CNON^PSOORED3 N PSONDEF
"RTN","PSOORED5",34,0)
 I $G(NOUN)]"",$G(PSORX("EDIT"))']"" S PSORXED("NOUN",ENT)=NOUN W !,"NOUN: "_$G(NOUN) G RTE
"RTN","PSOORED5",35,0)
 I $G(PSORX("EDIT"))']"",$G(PSORXED("NOUN",ENT))]"" W !,"NOUN: "_PSORXED("NOUN",ENT) G RTE
"RTN","PSOORED5",36,0)
NOU D NOU^PSOOREDX I X[U,$L(X)>1 S FIELD="NOU" G JUMP
"RTN","PSOORED5",37,0)
 G:$D(DTOUT)!($D(DUOUT)) EX I X="@" K PSORXED("NOUN",ENT),NOUN G RTE
"RTN","PSOORED5",38,0)
 I X'="",$G(PSONDEF)="" S NOUN=X
"RTN","PSOORED5",39,0)
 I X'="",$G(PSONDEF)'=X S NOUN=X
"RTN","PSOORED5",40,0)
 S:X'="" PSORXED("NOUN",ENT)=X
"RTN","PSOORED5",41,0)
 ;
"RTN","PSOORED5",42,0)
RTE I $G(ENT)>1,$G(PSORX("EDIT"))']"",$G(PSORXED("ROUTE",ENT-1)),$G(PSORXED("ROUTE",ENT))']"" S PSORXED("ROUTE",ENT)=PSORXED("ROUTE",ENT-1) G SCH
"RTN","PSOORED5",43,0)
 I '$G(DRET),'$G(PSORXED("ROUTE",ENT)),$P(^PS(50.7,PSODRUG("OI"),0),"^",6) S PSORXED("ROUTE",ENT)=$P(^PS(50.7,PSODRUG("OI"),0),"^",6)
"RTN","PSOORED5",44,0)
 I $G(DRET) S PSORXED("ROUTE",ENT)=""
"RTN","PSOORED5",45,0)
 I $G(RTE) K RTE
"RTN","PSOORED5",46,0)
 D KV S DIR(0)="FO^2:45",DIR("A")="ROUTE",DIR("?")="^D HLP^PSOORED4"
"RTN","PSOORED5",47,0)
 S DIR("B")=$S($G(PSORXED("ROUTE",ENT)):$P(^PS(51.2,PSORXED("ROUTE",ENT),0),"^"),$G(RTE)]"":RTE,$G(DRET):"",1:"PO") K:DIR("B")="" DIR("B")
"RTN","PSOORED5",48,0)
 D ^DIR I X[U,$L(X)>1 S FIELD="RTE" G JUMP
"RTN","PSOORED5",49,0)
 I $D(DTOUT)!($D(DUOUT)) S PSODIR("DFLG")=1 Q
"RTN","PSOORED5",50,0)
 I X="@"!(X="") K RTE,ERTE S DRET=1,PSORXED("ROUTE",ENT)="" G SCH
"RTN","PSOORED5",51,0)
 K DRET I X=$P($G(^PS(51.2,+$G(PSORXED("ROUTE",ENT)),0)),"^") S RTE=$P(^PS(51.2,PSORXED("ROUTE",ENT),0),"^") W X_" "_$G(ERTE) G SCH
"RTN","PSOORED5",52,0)
 S DIC=51.2,DIC(0)="QEZM",DIC("S")="I $P(^(0),""^"",4)" D ^DIC Q:X[U  G:Y=-1 RTE W "  "_$P(Y(0),"^",2)
"RTN","PSOORED5",53,0)
 S:X'="" PSORXED("ROUTE",ENT)=+Y,RTE=Y(0,0),ERTE=$P(Y(0),"^",2)
"RTN","PSOORED5",54,0)
 ;
"RTN","PSOORED5",55,0)
SCH D SCH^PSOBKDED I X[U,$L(X)>1 S FIELD="SCH" G JUMP
"RTN","PSOORED5",56,0)
 G:$D(DTOUT)!($D(DUOUT)) EX S SCH=Y D SCH^PSOSIG I $G(SCH)']"" G SCH
"RTN","PSOORED5",57,0)
 S PSORXED("SCHEDULE",ENT)=SCH W " ("_SCHEX_")" K SCH,SCHEX,X,Y,PSOSCH
"RTN","PSOORED5",58,0)
 S:$G(PSORXED("ENT"))<ENT PSORXED("ENT")=ENT
"RTN","PSOORED5",59,0)
 ;
"RTN","PSOORED5",60,0)
DUR D KV K EXP S DIR(0)="52.0113,4",DIR("A")="LIMITED DURATION (IN DAYS, HOURS OR MINUTES)"
"RTN","PSOORED5",61,0)
 S DIR("B")=$S($D(DUR):DUR,$G(PSORXED("DURATION",ENT))]"":PSORXED("DURATION",ENT),1:"") K:DIR("B")="" DIR("B")
"RTN","PSOORED5",62,0)
 D ^DIR I X[U,$L(X)>1 S FIELD="DUR" G JUMP
"RTN","PSOORED5",63,0)
 G:$D(DTOUT)!($D(DUOUT)) EX
"RTN","PSOORED5",64,0)
 D DUR1^PSOOREDX
"RTN","PSOORED5",65,0)
 ;
"RTN","PSOORED5",66,0)
CON D CON^PSOOREDX I X[U,$L(X)>1 S FIELD="CON" G JUMP
"RTN","PSOORED5",67,0)
 G:$D(DTOUT)!($D(DUOUT)) EX
"RTN","PSOORED5",68,0)
 I X="@",$G(PSORXED("CONJUNCTION",ENT))="" W !,?10,"Invalid Entry - nothing to delete!!" G CON
"RTN","PSOORED5",69,0)
 S:X'=""&(X'="@") PSORXED("CONJUNCTION",ENT)=Y
"RTN","PSOORED5",70,0)
 I X="@" D CON1^PSOOREDX G:$D(DIRUT) EX G:'Y CON S:'$G(COPY) PSOSIGFL=1 D UPD^PSOOREDX G CON
"RTN","PSOORED5",71,0)
 ;
"RTN","PSOORED5",72,0)
 N PSODLBD4 S PSOSAVX=X,PSODLBD4=1
"RTN","PSOORED5",73,0)
 I $G(PSORXED("CONJUNCTION",ENT))]"",'$G(PSOCKDOS) D:$$DS^PSSDSAPI DCHK1^PSODOSUT S PSOCKCON=1 G:$G(PSORXED("DFLG"))!($G(PSORX("DFLG"))) EX S ENT=ENT+1 K DIR G ASK
"RTN","PSOORED5",74,0)
 E  D  I $$DS^PSSDSAPI,$$DCHK^PSODOSUT S PSORXED("DFLG")=1,PSORX("DFLG")=1 G EX
"RTN","PSOORED5",75,0)
 . Q:$G(PSOCOPY)!($G(PSOEDDOS))
"RTN","PSOORED5",76,0)
 . K PSOCKCON
"RTN","PSOORED5",77,0)
 I PSOSAVX="",$G(PSORXED)!($D(PSOEDDOS)) K PSOCKCON
"RTN","PSOORED5",78,0)
 K PSOSAVX
"RTN","PSOORED5",79,0)
 ;
"RTN","PSOORED5",80,0)
 S X=$G(PSORXED("INS")) D SIG^PSOHELP S:$G(INS1)]"" PSORXED("SIG")=$E(INS1,2,9999999)
"RTN","PSOORED5",81,0)
 D EN^PSOFSIG(.PSORXED) I $O(SIG(0)) S PSORXED("ENT")=ENT,SIGOK=1
"RTN","PSOORED5",82,0)
 Q:$G(PSOREEDT)!($G(PSOORRNW))
"RTN","PSOORED5",83,0)
 K QTYHLD S:$G(PSORXED("QTY")) QTYHLD=PSORXED("QTY") D QTY^PSOSIG(.PSORXED) I $G(PSORXED("QTY")) S QTY=1
"RTN","PSOORED5",84,0)
 I $G(QTYHLD),'$G(PSORXED("QTY")) S PSORXED("QTY")=QTYHLD
"RTN","PSOORED5",85,0)
 K QTYHLD Q:$G(PSOFROM)="NEW"!($G(COPY))!($G(PSOFROM))!($G(PSOREEDT))
"RTN","PSOORED5",86,0)
 Q:$G(PSOSIGFL)  D
"RTN","PSOORED5",87,0)
 .S D=0 F  S D=$O(SIG(D)) Q:'D  S ^PSRX(PSORXED("IRXN"),"SIG1",D,0)=SIG(D),$P(^PSRX(PSORXED("IRXN"),"SIG1",0),"^",3)=+$P($G(^PSRX(PSORXED("IRXN"),"SIG1",0)),"^",3)+1,$P(^(0),"^",4)=+$P($G(^(0)),"^",4)+1 Q:'$O(SIG(D))
"RTN","PSOORED5",88,0)
 .S (A,I)=0 F  S I=$O(^PSRX(PSORXED("IRXN"),"A",I)) Q:'I  S A=A+1
"RTN","PSOORED5",89,0)
 .S:'$D(^PSRX(PSORXED("IRXN"),"A",0)) ^PSRX(PSORXED("IRXN"),"A",0)="^52.3DA^"
"RTN","PSOORED5",90,0)
 .S $P(^PSRX(PSORXED("IRXN"),"A",0),"^",3)=$P($G(^PSRX(PSORXED("IRXN"),"A",0)),"^",3)+1,$P(^(0),"^",4)=$P($G(^(0)),"^",4)+1
"RTN","PSOORED5",91,0)
 .D NOW^%DTC S A=A+1,^PSRX(PSORXED("IRXN"),"A",A,0)=%_"^E^"_DUZ_"^0^New Dosing Instructions Added",^PSRX(PSORXED("IRXN"),"A",A,1)="ORIGINAL SIG^" D
"RTN","PSOORED5",92,0)
 ..I '$P(^PSRX(PSORXED("IRXN"),"SIG"),"^",2) S $P(^PSRX(PSORXED("IRXN"),"A",A,1),"^",2)=$P(^PSRX(PSORXED("IRXN"),"SIG"),"^") Q
"RTN","PSOORED5",93,0)
 ..F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),"SIG1",I)) Q:'I  S ^PSRX(PSORXED("IRXN"),"A",A,2,I,0)=^PSRX(PSORXED("IRXN"),"SIG1",I,0),^PSRX(PSORXED("IRXN"),"A",A,2,0)="^52.34A^"_I_"^"_I
"RTN","PSOORED5",94,0)
 .S ^PSRX(PSORXED("IRXN"),"SIG")="^1" K SIG,A,I
"RTN","PSOORED5",95,0)
 S ^PSRX(PSORXED("IRXN"),6,0)="^52.0113^"_ENT_"^"_ENT
"RTN","PSOORED5",96,0)
 F I=1:1:ENT S ^PSRX(PSORXED("IRXN"),6,I,0)=PSORXED("DOSE",I)_"^"_$G(PSORXED("DOSE ORDERED",I))_"^"_$G(PSORXED("UNITS",I))_"^"_$G(PSORXED("NOUN",I))_"^" D
"RTN","PSOORED5",97,0)
 .S ^PSRX(PSORXED("IRXN"),6,I,0)=^PSRX(PSORXED("IRXN"),6,I,0)_$G(PSORXED("DURATION",I))_"^"_$G(PSORXED("CONJUNCTION",I))_"^"_$G(PSORXED("ROUTE",I))_"^"_$G(PSORXED("SCHEDULE",I))_"^"_$G(PSORXED("VERB",I))
"RTN","PSOORED5",98,0)
 .I $G(PSORXED("DOSE",I))]"" S ^PSRX(PSORXED("IRXN"),6,I,1)=PSORXED("DOSE",I)
"RTN","PSOORED5",99,0)
 S ^PSRX(PSORXED("IRXN"),"POE")=1 G EX
"RTN","PSOORED5",100,0)
 Q
"RTN","PSOORED5",101,0)
EX I $D(DUOUT)!($D(DTOUT)) S PSONEW("DFLG")=1
"RTN","PSOORED5",102,0)
 ;I $D(DUOUT)!($D(DTOUT)) S:'$G(PSORX("EDIT")) PSONEW("DFLG")=1
"RTN","PSOORED5",103,0)
 G:$G(PSOSIGFL)!($G(PSORX("EDIT")))!($G(PSORXED))!($G(PSOREEDT)) EX1
"RTN","PSOORED5",104,0)
 K PSORXED("DOSE"),PSORXED("NOUN"),PSORXED("VERB"),PSORXED("DOSE ORDERED"),PSORXED("ROUTE"),SIG,PSORXED("SCHEDULE"),PSORXED("DURATION"),PSORXED("CONJUNCTION"),PSORXED("ODOSE")
"RTN","PSOORED5",105,0)
EX1 K UNITN,STRE,DOSE,DUPD,SCH,VERB,NOUN,DOSEOR,RTE,DUR,X,Y,ENTS,PSOSCH,ENT,PSORTE,DURA,ERTE,ROU
"RTN","PSOORED5",106,0)
KV K DIR,DIRUT,DTOUT,DUOUT
"RTN","PSOORED5",107,0)
 Q
"RTN","PSOORED5",108,0)
UPD ;updates dosing array
"RTN","PSOORED5",109,0)
 D UPD^PSOORED6
"RTN","PSOORED5",110,0)
 Q
"RTN","PSOORED5",111,0)
JUMP ;
"RTN","PSOORED5",112,0)
 I $G(PSORXED("SCHEDULE",1))']"" W $C(7),!!,"All Dosing Instructions must be entered before Jumping to other Fields!",!! G @FIELD
"RTN","PSOORED5",113,0)
 I $L($E(X,2,99))<3 W !,"Field Name Must Be At Least 3 Characters in Length",! G @FIELD
"RTN","PSOORED5",114,0)
 D FNM^PSOOREDX
"RTN","PSOORED5",115,0)
 I FLDNM']"" K X,NM,FLDNM W !,"INVALID FIELD NAME.  PLEASE TRY AGAIN!",! G @FIELD
"RTN","PSOORED5",116,0)
 F AR=1:1:PSORXED("ENT") W !,AR_". "_$P(FLDNM,"^",2)_": "_$S(NM="ROU"&($G(PSORXED($P(FLDNM,"^"),AR))):$P(^PS(51.2,PSORXED($P(FLDNM,"^"),AR),0),"^"),1:$G(PSORXED($P(FLDNM,"^"),AR))) S AR1=AR
"RTN","PSOORED5",117,0)
 D KV
"RTN","PSOORED5",118,0)
 I $G(PSOFROM)'="NEW",'$G(COPY) S DIR("A",1)="* Indicates which fields will create a New Order"
"RTN","PSOORED5",119,0)
 S DIR("A")="Select Field by number",DIR(0)="NO^1:"_AR1 D ^DIR G:$D(DIRUT) @FIELD
"RTN","PSOORED5",120,0)
 D JFN^PSOOREDX G:FLDNM="" @FIELD G @FLDNM
"RTN","PSOORED5",121,0)
 G EX
"RTN","PSOORED5",122,0)
 Q
"RTN","PSOORED5",123,0)
LAN ;
"RTN","PSOORED5",124,0)
 Q:'$G(PSODRUG("IEN"))
"RTN","PSOORED5",125,0)
 I $G(OR0),'$G(PSONEW("DOSE ORDERED",II)),$P($G(^PS(55,PSODFN,"LAN")),"^") D  K QI,QII Q
"RTN","PSOORED5",126,0)
 .Q:$G(OTHDOS(II))
"RTN","PSOORED5",127,0)
 .F QI=0:0 S QI=$O(^PSDRUG(PSODRUG("IEN"),"DOS2",QI)) Q:'QI  D  Q:$G(QII)
"RTN","PSOORED5",128,0)
 ..Q:$G(PSONEW("DOSE",II))']""
"RTN","PSOORED5",129,0)
 ..I PSONEW("DOSE",II)=$P(^PSDRUG(PSODRUG("IEN"),"DOS2",QI,0),"^") S PSONEW("ODOSE",II)=$P(^PSDRUG(PSODRUG("IEN"),"DOS2",QI,0),"^",4),QII=1
"RTN","PSOORED5",130,0)
 I $G(Y),$P($G(DOSE(Y)),"^",13)]"" S PSORXED("ODOSE",ENT)=$P(DOSE(Y),"^",13) Q
"RTN","PSOORED5",131,0)
 K QII F I=0:0 S I=$O(^PSDRUG(PSODRUG("IEN"),"DOS2",I)) Q:'I  I DOSE=$P(^PSDRUG(PSODRUG("IEN"),"DOS2",I,0),"^") D  Q:$G(QII)
"RTN","PSOORED5",132,0)
 .S PSORXED("ODOSE",ENT)=$P(^PSDRUG(PSODRUG("IEN"),"DOS2",I,0),"^",4),QII=1
"RTN","PSOORED5",133,0)
 K QII,I
"RTN","PSOORED5",134,0)
 Q
"RTN","PSOORED5",135,0)
 ;
"RTN","PSOORED6")
0^24^B68912143
"RTN","PSOORED6",1,0)
PSOORED6 ;BIR/SAB - edit orders from backdoor ;03/06/96
"RTN","PSOORED6",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**78,104,117,133,143,219,148,247,268,260,269,251**;DEC 1997;Build 202
"RTN","PSOORED6",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORED6",4,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSOORED6",5,0)
 ;External reference ^PS(50.606 supported by DBIA 2174
"RTN","PSOORED6",6,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5424
"RTN","PSOORED6",7,0)
DRG ;select drug
"RTN","PSOORED6",8,0)
 S PSORX("EDIT")=1,RX0HLD=RX0
"RTN","PSOORED6",9,0)
 S PSODRUG("IEN")=$S($G(PSODRUG("IEN"))]"":PSODRUG("IEN"),1:$P(RX0,"^",6)),PSODRUG("NAME")=$S($G(PSODRUG("NAME"))]"":PSODRUG("NAME"),1:$P(^PSDRUG($P(RX0,"^",6),0),"^"))
"RTN","PSOORED6",10,0)
 D ^PSODRG I PSODRUG("IEN")=$P(RX0,"^",6) K PSORXED("FLD",6)
"RTN","PSOORED6",11,0)
 D:PSODRUG("IEN")'=$P(RX0,"^",6)  I $G(PSORX("DFLG")) K PSORXED("FLD",6) S PSORXED("DFLG")=1 Q
"RTN","PSOORED6",12,0)
 .S ^TMP("PSORXBO",$J,RX0,0)=1
"RTN","PSOORED6",13,0)
 .D POST^PSODRG
"RTN","PSOORED6",14,0)
 .I '$O(^PSRX(PSORXED("IRXN"),1,0)) S PSORXED("FLD",17)=$G(PSODRUG("COST"))
"RTN","PSOORED6",15,0)
 .I $G(PSORX("DFLG")) K PSORXED("FLD",6),PSODRUG,PSOOIFLG,PSOSIGFL,VALMSG Q
"RTN","PSOORED6",16,0)
 .D KV S DIR(0)="Y",DIR("B")="YES"
"RTN","PSOORED6",17,0)
 .S DIR("A",1)="You have changed the dispense drug from"
"RTN","PSOORED6",18,0)
 .S DIR("A",2)=$P(^PSDRUG($P(PSORXED("RX0"),"^",6),0),"^")_" to "_$P(^PSDRUG(PSODRUG("IEN"),0),"^")_"."
"RTN","PSOORED6",19,0)
 .I $P($G(^PSRX(PSORXED("IRXN"),"SIG")),"^",2),$O(^PSRX(PSORXED("IRXN"),"SIG1",0)) S DIR("A",3)="" D
"RTN","PSOORED6",20,0)
 ..F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),"SIG1",I)) Q:'I  S DIR("A",3+I)=$S(I=1:"Current SIG: ",1:"")_$G(^PSRX(PSORXED("IRXN"),"SIG1",I,0))
"RTN","PSOORED6",21,0)
 .S DIR("A")="Do You want to Edit the SIG"
"RTN","PSOORED6",22,0)
 .D ^DIR K DIR I $D(DIRUT) S PSORX("DFLG")=1 D M1
"RTN","PSOORED6",23,0)
 .Q:$D(DIRUT)
"RTN","PSOORED6",24,0)
 .I 'Y D  D DOLST^PSOORED3 D:$$DS^PSSDSAPI DCHK1^PSODOSUT Q
"RTN","PSOORED6",25,0)
 .. I '$G(PSORXED("ENT")) F  S I=$O(PSORXED("DOSE",I)) Q:'I  S PSORXED("ENT")=$G(PSORXED("ENT"))+1
"RTN","PSOORED6",26,0)
 .. S ENT=1
"RTN","PSOORED6",27,0)
 .S PSOREEDQ=1 D DOLST^PSOORED3,DOSE^PSOORED3 K PSOREEDQ
"RTN","PSOORED6",28,0)
 .I '$O(PSORXED("DOSE",0)) S PSORX("DFLG")=1 Q
"RTN","PSOORED6",29,0)
 .D:$G(PSOSIGFL) M2
"RTN","PSOORED6",30,0)
 S RX0=RX0HLD K RX0HLD I $G(PSODRUG("OI"))=$G(PSOI) D  Q
"RTN","PSOORED6",31,0)
 .D:$O(^TMP("PSORXDC",$J,0))
"RTN","PSOORED6",32,0)
 ..W !!,"This edit will discontinue the duplicate Rx & change the dispensed drug!"
"RTN","PSOORED6",33,0)
 ..K DIR,X,Y S DIR("A")="Do You Want to Proceed",DIR("B")="NO",DIR(0)="Y"
"RTN","PSOORED6",34,0)
 ..D ^DIR K DIR S:'Y!($D(DIRUT)) PSORXED("DFLG")=1 D:Y DCORD^PSONEW2
"RTN","PSOORED6",35,0)
 .Q:$G(PSORXED("DFLG"))
"RTN","PSOORED6",36,0)
 .I PSODRUG("IEN")'=$P(RX0,"^",6) D
"RTN","PSOORED6",37,0)
 ..S PSORXED("FLD",6)=PSODRUG("IEN"),PSORXED("FLD",39.2)=PSOI
"RTN","PSOORED6",38,0)
 .S:$G(PSODRUG("TRADE NAME"))]"" PSORXED("FLD",6.5)=PSODRUG("TRADE NAME")
"RTN","PSOORED6",39,0)
 .S:$G(PSODRUG("NDC"))]"" PSORXED("FLD",27)=PSODRUG("NDC")
"RTN","PSOORED6",40,0)
 .S:$G(PSODRUG("DAW"))]"" PSORXED("FLD",81)=PSODRUG("DAW")
"RTN","PSOORED6",41,0)
 W !!,"New Orderable Item selected. This edit will create a new prescription!",! D PAUSE^VALM1 S VALMSG="New Orderable Item selected. This edit will create a new prescription!" S (PSOOIFLG,PSOSIGFL)=1
"RTN","PSOORED6",42,0)
 Q
"RTN","PSOORED6",43,0)
PSOCOU ;patient counseling
"RTN","PSOORED6",44,0)
 K DIC,DIQ S DIC=52,DA=PSORXED("IRXN"),DIQ="PSORXED",DR=41 D EN^DIQ1 K DIC,DIQ
"RTN","PSOORED6",45,0)
 D KV S DIR(0)="52,41" S:$G(PSORXED(52,DA,DR))]"" DIR("B")=PSORXED(52,DA,DR) D ^DIR K DIR,PSORXED(52,DA,DR)
"RTN","PSOORED6",46,0)
 I $D(DIRUT) K PSORXED("FLD",41) D KV Q
"RTN","PSOORED6",47,0)
 S PSORXED("FLD",DR)=Y D  K DIRUT
"RTN","PSOORED6",48,0)
 .I Y D  Q
"RTN","PSOORED6",49,0)
 ..K DIC,DIQ S DIC=52,DA=PSORXED("IRXN"),DIQ="PSORXED",DR=42 D EN^DIQ1 K DIC,DIQ
"RTN","PSOORED6",50,0)
 ..K DIR,DIRUT S DIR(0)="52,42" S:$G(PSORXED(52,DA,DR))]"" DIR("B")=PSORXED(52,DA,DR) D ^DIR K DIR,PSORXED(52,DA,DR)
"RTN","PSOORED6",51,0)
 ..I $D(DIRUT) K PSORXED("FLD",41),DUOUT,DTOUT Q
"RTN","PSOORED6",52,0)
 ..S PSORXED("FLD",42)=Y
"RTN","PSOORED6",53,0)
 .S PSORXED("FLD",41)=0,PSORXED("FLD",42)="@"
"RTN","PSOORED6",54,0)
 Q
"RTN","PSOORED6",55,0)
PSOI ;select orderable item
"RTN","PSOORED6",56,0)
 W !!,"Current Orderable Item: "_$P(^PS(50.7,PSOI,0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSOORED6",57,0)
 S DIC("B")=$P(^PS(50.7,PSOI,0),"^"),DIC="^PS(50.7,",DIC(0)="AEMQZ"
"RTN","PSOORED6",58,0)
 S DIC("S")="I '$P(^PS(50.7,+Y,0),""^"",4)!($P(^(0),""^"",4)'<DT) N PSOF,PSOL S (PSOF,PSOL)=0 F  S PSOL=$O(^PSDRUG(""ASP"",+Y,PSOL)) Q:PSOF!'PSOL  "
"RTN","PSOORED6",59,0)
 S DIC("S")=DIC("S")_"I $P($G(^PSDRUG(PSOL,2)),U,3)[""O"",'$G(^(""I""))!($G(^(""I""))'<DT) S PSOF=1"
"RTN","PSOORED6",60,0)
 S D="B^C" D MIX^DIC1 I "^"[X S PSORXED("DFLG")=1 Q
"RTN","PSOORED6",61,0)
 G:Y<1 PSOI Q:PSOI=+Y
"RTN","PSOORED6",62,0)
 S PSODRUG("OI")=+Y,PSODRUG("OIN")=Y(0,0) K DIC
"RTN","PSOORED6",63,0)
 I PSOI'=PSODRUG("OI") W !!,"New Orderable Item selected. This edit will create a new prescription!",! D  K PSHOLDD Q
"RTN","PSOORED6",64,0)
 .D PAUSE^VALM1 I ($D(DTOUT))!($D(DUOUT))!($G(DIRUT)) S PSORX("DFLG")=1 D M1 Q
"RTN","PSOORED6",65,0)
 .D M2
"RTN","PSOORED6",66,0)
 .S PSHOLDD=$G(PSODRUG("IEN")) K PSODRUG("IEN"),PSODRUG("NAME") S PSODRUG("DEA")="",(PSOOIFLG,PSOSIGFL)=1
"RTN","PSOORED6",67,0)
 .D DREN^PSOORNW2
"RTN","PSOORED6",68,0)
 .I $G(PSHOLDD),$G(PSODRUG("IEN")),$G(PSHOLDD)'=$G(PSODRUG("IEN")) D  Q:$G(PSORX("DFLG"))
"RTN","PSOORED6",69,0)
 ..I $G(PSORX("DFLG")) K PSODRUG S PSODRUG("IEN")=$G(PSHOLDD),PSODRUG("NAME")=$P($G(^PSDRUG(PSODRUG("IEN"),0)),"^") K PSOOIFLG,PSOSIGFL S VALMSG=""
"RTN","PSOORED6",70,0)
 .I '$G(PSODRUG("IEN")) W !!,"DRUG NAME REQUIRED!" D 2^PSOORNW1
"RTN","PSOORED6",71,0)
 .I '$G(PSODRUG("IEN")) K PSORXED("FLD"),INDEL,^TMP($J,"INS1"),PSOSIGFL,VALMSG S PSORXED("DFLG")=1,VALMSG="Dispense Drug NOT Selected!" Q
"RTN","PSOORED6",72,0)
 .D FULL^VALM1,POST^PSODRG S VALMBCK="R"
"RTN","PSOORED6",73,0)
 .I PSORX("DFLG") K PSORXED("FLD"),INDEL,^TMP($J,"INS1"),PSOSIGFL,VALMSG Q
"RTN","PSOORED6",74,0)
 .D KV S DIR(0)="Y",DIR("B")="NO",DIR("A",1)="You have changed the Orderable Item from"
"RTN","PSOORED6",75,0)
 .S DIR("A",2)=$P(^PS(50.7,PSOI,0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,PSOI,0),"^",2),0),"^")_" to "_PSODRUG("OIN")_" "_$P(^PS(50.606,$P(^PS(50.7,PSODRUG("OI"),0),"^",2),0),"^"),DIR("A")="Do You want to Edit the SIG"
"RTN","PSOORED6",76,0)
 .D ^DIR K DIR I $D(DIRUT) K PSODRUG("OIN"),PSOOIFLG,PSOSIGFL S PSODRUG("OI")=PSOI,VALMSG="",PSORX("DFLG")=1 Q
"RTN","PSOORED6",77,0)
 .I 'Y S PSORX("DFLG")=1 Q
"RTN","PSOORED6",78,0)
 .S PSOREEDQ=1 D DOLST^PSOORED3,DOSE^PSOORED3 K PSOREEDQ
"RTN","PSOORED6",79,0)
 .I '$O(PSORXED("DOSE",0)) S PSORX("DFLG")=1 Q
"RTN","PSOORED6",80,0)
 .D:$G(PSOSIGFL) M2
"RTN","PSOORED6",81,0)
 S PSORXED("FLD",39.2)=PSOI
"RTN","PSOORED6",82,0)
 Q
"RTN","PSOORED6",83,0)
NCPDP ;Reverse previously billed Rx on an edited orderable item or drug. 
"RTN","PSOORED6",84,0)
 N RX,NPSOY
"RTN","PSOORED6",85,0)
 S RX=$G(PSORXED("IRXN")) I RX="" D
"RTN","PSOORED6",86,0)
 . S NPSOY=$O(PSONEW("OLD LAST RX#","")),NPSOY=$G(PSONEW("OLD LAST RX#",NPSOY)),RX=$O(^PSRX("B",NPSOY,RX))
"RTN","PSOORED6",87,0)
 I 'RX Q
"RTN","PSOORED6",88,0)
 D REVERSE^PSOBPSU1(RX,,"DC",7) S NCPDPFLG=0
"RTN","PSOORED6",89,0)
 Q
"RTN","PSOORED6",90,0)
UPDATE ;add new data to file
"RTN","PSOORED6",91,0)
 N RXREF,UPDATE,FLDS,CHGNDC
"RTN","PSOORED6",92,0)
 Q:'$G(PSORXED("IRXN"))
"RTN","PSOORED6",93,0)
 I $O(PSORXED("FLD",0))!($G(^TMP($J,"INS1",0))]"")!($G(INSDEL))!($O(PSORXED("ODOSE",0))) D  G:'Y UPDX
"RTN","PSOORED6",94,0)
 .K DIR,DIRUT,DTOUT,DUOUT
"RTN","PSOORED6",95,0)
 .S DIR(0)="Y",DIR("A")="Are You Sure You Want to Update Rx "_$P(^PSRX(PSORXED("IRXN"),0),"^"),DIR("B")="Yes"
"RTN","PSOORED6",96,0)
 .D ^DIR K DIR I 'Y D M1 Q
"RTN","PSOORED6",97,0)
 .I $D(^PSRX(PSORXED("IRXN"),1,0))  D
"RTN","PSOORED6",98,0)
 ..S RXREF=$P(^PSRX(PSORXED("IRXN"),0),"^",9)-$P(^PSRX(PSORXED("IRXN"),1,0),"^",4)
"RTN","PSOORED6",99,0)
 .E  S RXREF=0
"RTN","PSOORED6",100,0)
 .K X,DIRUT,DUOUT,DTOUT
"RTN","PSOORED6",101,0)
 I $D(PSORXED("FLD",39.3)) D UPDATE^PSODIAG  ;update ICD's after edit
"RTN","PSOORED6",102,0)
 ; - Retrieving fields before changes that are relevant for 3rd Party Billing
"RTN","PSOORED6",103,0)
 D GETS^DIQ(52,PSORXED("IRXN")_",","4;7;8;20;22;27;81","I","FLDS")
"RTN","PSOORED6",104,0)
 K Y S DA=PSORXED("IRXN"),DIE="^PSRX(",FLD=0
"RTN","PSOORED6",105,0)
 F  S FLD=$O(PSORXED("FLD",FLD)) Q:'FLD  D
"RTN","PSOORED6",106,0)
 .I FLD=12!(FLD=24)!(FLD=35) D  Q
"RTN","PSOORED6",107,0)
 ..I FLD=12,PSORXED("FLD",12)="@" S $P(^PSRX(DA,3),"^",7)="" Q
"RTN","PSOORED6",108,0)
 ..I FLD=12,PSORXED("FLD",12)]"" S $P(^PSRX(DA,3),"^",7)=PSORXED("FLD",12) Q
"RTN","PSOORED6",109,0)
 ..I FLD=24,PSORXED("FLD",24)="@" S $P(^PSRX(DA,2),"^",4)="" Q
"RTN","PSOORED6",110,0)
 ..I FLD=24,PSORXED("FLD",24)]"" S $P(^PSRX(DA,2),"^",4)=PSORXED("FLD",24) Q
"RTN","PSOORED6",111,0)
 ..I FLD=35,PSORXED("FLD",35)="@" S $P(^PSRX(DA,"MP"),"^")="" Q
"RTN","PSOORED6",112,0)
 ..I FLD=35,PSORXED("FLD",35)]"" S $P(^PSRX(DA,"MP"),"^")=PSORXED("FLD",35) Q
"RTN","PSOORED6",113,0)
 .I FLD=114 D  Q
"RTN","PSOORED6",114,0)
 ..I PSORXED("FLD",114)="@" K ^PSRX(DA,"INS"),^PSRX(DA,"INS1")
"RTN","PSOORED6",115,0)
 ..I PSORXED("FLD",114)'="@" D
"RTN","PSOORED6",116,0)
 ...S ^PSRX(DA,"INS")=PSORXED("FLD",114)
"RTN","PSOORED6",117,0)
 ...S X=PSORXED("FLD",114) D SIG^PSOHELP Q:$G(INS1)']""
"RTN","PSOORED6",118,0)
 ...S PSORXED("SIG",1)=$E(INS1,2,9999999) K ^PSRX(DA,"INS1")
"RTN","PSOORED6",119,0)
 ...S ^PSRX(DA,"INS1",0)="^52.0115^1^1^"_DT_"^^"
"RTN","PSOORED6",120,0)
 ...S ^PSRX(DA,"INS1",1,0)=PSORXED("SIG",1)
"RTN","PSOORED6",121,0)
 ..D DOLST^PSOORED3 K:PSORXED("FLD",114)="@" PSORXED("SIG") D EN^PSOFSIG(.PSORXED),UPDSIG^PSOORED3
"RTN","PSOORED6",122,0)
 .I FLD=27 D  Q
"RTN","PSOORED6",123,0)
 ..I PSORXED("FLD",27)'=$$GETNDC^PSONDCUT(DA,0) D
"RTN","PSOORED6",124,0)
 ...S CHGNDC=1
"RTN","PSOORED6",125,0)
 ...D RXACT^PSOBPSU2(DA,0,"NDC changed from "_$$GETNDC^PSONDCUT(DA,0)_" to "_PSORXED("FLD",27)_".","E")
"RTN","PSOORED6",126,0)
 ..D SAVNDC^PSONDCUT(DA,0,PSORXED("FLD",27),0,1)
"RTN","PSOORED6",127,0)
 .I FLD=81 D SAVDAW^PSODAWUT(DA,0,PSORXED("FLD",81)) Q
"RTN","PSOORED6",128,0)
 .S DR=FLD_"////"_PSORXED("FLD",FLD) D ^DIE
"RTN","PSOORED6",129,0)
 .I FLD=4 D UDPROV^PSOOREDT Q
"RTN","PSOORED6",130,0)
 ;
"RTN","PSOORED6",131,0)
 ; - Re-submitting Rx to ECME due to edits
"RTN","PSOORED6",132,0)
 D RESUB^PSOORED7
"RTN","PSOORED6",133,0)
 ;
"RTN","PSOORED6",134,0)
 I $G(INSDEL) K ^PSRX(DA,"INS"),^PSRX(DA,"INS1") D DOLST^PSOORED3 K PSORXED("SIG") D EN^PSOFSIG(.PSORXED),UPDSIG^PSOORED3 G UPDX
"RTN","PSOORED6",135,0)
 I $O(^TMP($J,"INS1",0)) D
"RTN","PSOORED6",136,0)
 .K ^PSRX(DA,"INS"),^PSRX(DA,"INS1"),DD,PSORXED("SIG")
"RTN","PSOORED6",137,0)
 .F I=0:0 S I=$O(^TMP($J,"INS1",I)) Q:'I  S (PSORXED("SIG",I),^PSRX(DA,"INS1",I,0))=^TMP($J,"INS1",I,0),DD=$G(DD)+1
"RTN","PSOORED6",138,0)
 .S ^PSRX(DA,"INS1",0)=^TMP($J,"INS1",0)
"RTN","PSOORED6",139,0)
 .I DD=1 S ^PSRX(DA,"INS")=^PSRX(DA,"INS1",1,0)
"RTN","PSOORED6",140,0)
 .D DOLST^PSOORED3,EN^PSOFSIG(.PSORXED),UPDSIG^PSOORED3
"RTN","PSOORED6",141,0)
 ;
"RTN","PSOORED6",142,0)
UPDX ;
"RTN","PSOORED6",143,0)
 K DIE,DA,DR,FLD,X,Y,PSORXED("FLD"),DD,^TMP($J,"INS1")
"RTN","PSOORED6",144,0)
KV K DIR,DIRUT,DTOUT,DUOUT
"RTN","PSOORED6",145,0)
 Q
"RTN","PSOORED6",146,0)
UPD ;updates dosing array
"RTN","PSOORED6",147,0)
 S HENT=ENT
"RTN","PSOORED6",148,0)
UPD1 ;
"RTN","PSOORED6",149,0)
 I $G(PSORXED("CONJUNCTION",(HENT+1)))]"" S PSORXED("CONJUNCTION",HENT)=PSORXED("CONJUNCTION",(HENT+1)) D  G UPD
"RTN","PSOORED6",150,0)
 .K PSORXED("CONJUNCTION",(HENT+1))
"RTN","PSOORED6",151,0)
 .I $D(PSORXED("DOSE",(HENT+2))) D
"RTN","PSOORED6",152,0)
 ..S PSORXED("DOSE",(HENT+1))=PSORXED("DOSE",(HENT+2))
"RTN","PSOORED6",153,0)
 ..S PSORXED("ODOSE",(HENT+1))=$G(PSORXED("ODOSE",(HENT+2)))
"RTN","PSOORED6",154,0)
 ..S PSORXED("DOSE ORDERED",(HENT+1))=$G(PSORXED("DOSE ORDERED",(HENT+2)))
"RTN","PSOORED6",155,0)
 ..S PSORXED("UNITS",(HENT+1))=$G(PSORXED("UNITS",(HENT+2)))
"RTN","PSOORED6",156,0)
 ..S PSORXED("NOUN",(HENT+1))=$G(PSORXED("NOUN",(HENT+2)))
"RTN","PSOORED6",157,0)
 ..S PSORXED("DURATION",(HENT+1))=$G(PSORXED("DURATION",(HENT+2)))
"RTN","PSOORED6",158,0)
 ..S PSORXED("CONJUNCTION",(HENT+1))=$G(PSORXED("CONJUNCTION",(HENT+2)))
"RTN","PSOORED6",159,0)
 ..S PSORXED("ROUTE",(HENT+1))=$G(PSORXED("ROUTE",(HENT+2)))
"RTN","PSOORED6",160,0)
 ..S PSORXED("SCHEDULE",(HENT+1))=$G(PSORXED("SCHEDULE",(HENT+2)))
"RTN","PSOORED6",161,0)
 ..S PSORXED("VERB",(HENT+1))=$G(PSORXED("VERB",(HENT+2)))
"RTN","PSOORED6",162,0)
 ..K PSORXED("DOSE",(HENT+2)),PSORXED("ODOSE",(HENT+2)),PSORXED("DOSE ORDERED",(HENT+2))
"RTN","PSOORED6",163,0)
 ..K PSORXED("UNITS",(HENT+2)),PSORXED("NOUN",(HENT+2)),PSORXED("DURATION",(HENT+2)),PSORXED("ROUTE",(HENT+2)),PSORXED("SCHEDULE",(HENT+2)),PSORXED("VERB",(HENT+2))
"RTN","PSOORED6",164,0)
 .S HENT=HENT+1
"RTN","PSOORED6",165,0)
 F I=0:0 S I=$O(PSORXED("DOSE",I)) Q:'I  S SENT=$G(SENT)+1
"RTN","PSOORED6",166,0)
 Q
"RTN","PSOORED6",167,0)
 ;
"RTN","PSOORED6",168,0)
M1 D M1^PSOOREDX
"RTN","PSOORED6",169,0)
 Q
"RTN","PSOORED6",170,0)
M2 D M2^PSOOREDX
"RTN","PSOORED6",171,0)
 Q
"RTN","PSOORFI4")
0^68^B81645508
"RTN","PSOORFI4",1,0)
PSOORFI4 ;BIR/SAB-CPRS order checks and display con't ;6/17/09 1:11pm
"RTN","PSOORFI4",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**46,74,78,99,117,131,207,258,274,300,308,251**;DEC 1997;Build 202
"RTN","PSOORFI4",3,0)
 ;External reference to ^PS(51.2 supported by DBIA 2226
"RTN","PSOORFI4",4,0)
 ;External reference to ^PS(50.607 supported by DBIA 2221
"RTN","PSOORFI4",5,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOORFI4",6,0)
 ;External reference to ^PS(50.7 is supported by DBIA 2223
"RTN","PSOORFI4",7,0)
 ;
"RTN","PSOORFI4",8,0)
ORCHK D ORCHK^PSOORNE6
"RTN","PSOORFI4",9,0)
 Q
"RTN","PSOORFI4",10,0)
INST ;displays patient instructions
"RTN","PSOORFI4",11,0)
 I $O(PSONEW("SIG",0)) G INST1
"RTN","PSOORFI4",12,0)
 S INST=0 F  S INST=$O(^PS(52.41,ORD,"INS1",INST)) Q:'INST  S (MIG,PSONEW("SIG",INST))=^PS(52.41,ORD,"INS1",INST,0) D
"RTN","PSOORFI4",13,0)
 .F SG=1:1:$L(MIG," ") S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P(MIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",20)=" " S ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P(MIG," ",SG)
"RTN","PSOORFI4",14,0)
 I $P($G(^PS(55,PSODFN,"LAN")),"^"),$O(^PS(52.41,ORD,"INS1",0)) D
"RTN","PSOORFI4",15,0)
 .I $G(^PS(50.7,PSODRUG("OI"),"INS1"))]"" S (X,PSONEW("SINS"))=^PS(50.7,PSODRUG("OI"),"INS1") D SSIG^PSOHELP
"RTN","PSOORFI4",16,0)
 .I $G(SINS1)]"" S PSONEW("SINS")=$E(SINS1,2,250)
"RTN","PSOORFI4",17,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" Other Pat Instruct: "_$S($G(PSONEW("SINS"))]"":PSONEW("SINS"),1:"")
"RTN","PSOORFI4",18,0)
 K INST,TY,MIG,SG,SINS1
"RTN","PSOORFI4",19,0)
 Q
"RTN","PSOORFI4",20,0)
INST1 ;
"RTN","PSOORFI4",21,0)
 S INS=0 F  S INS=$O(PSONEW("SIG",INS)) Q:'INS  S MIG=PSONEW("SIG",INS) D
"RTN","PSOORFI4",22,0)
 .F SG=1:1:$L(MIG," ") S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P(MIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",20)=" " S ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P(MIG," ",SG)
"RTN","PSOORFI4",23,0)
 K INST,TY,MIG,SG
"RTN","PSOORFI4",24,0)
 I $P($G(^PS(55,PSODFN,"LAN")),"^") S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" Other Pat Instruct: "_$S($G(PSONEW("SINS"))]"":PSONEW("SINS"),1:"")
"RTN","PSOORFI4",25,0)
 Q
"RTN","PSOORFI4",26,0)
PROVCOM ;
"RTN","PSOORFI4",27,0)
 I $G(PKI1)=1,'$G(PSORX("VERIFY")) D REA^PSOPKIV1 Q:$G(PSORX("DFLG"))
"RTN","PSOORFI4",28,0)
 I $O(PRC(0)),'$G(PSOPRC) D  D KV^PSOVER1
"RTN","PSOORFI4",29,0)
 .D EN^DDIOL("Provider Comments: ","","!")
"RTN","PSOORFI4",30,0)
 .F I=0:0 S I=$O(PRC(I)) Q:'I  D EN^DDIOL(PRC(I),"","!")
"RTN","PSOORFI4",31,0)
 .D KV^PSOVER1 S DIR(0)="Y",DIR("A")="Copy Provider Comments into the Patient Instructions",DIR("B")="No"
"RTN","PSOORFI4",32,0)
 .D ^DIR Q:'Y!($D(DIRUT))
"RTN","PSOORFI4",33,0)
 .;Check Provider Comments.  If any line contains more than 32
"RTN","PSOORFI4",34,0)
 .;characters with no spaces, display error message and quit.
"RTN","PSOORFI4",35,0)
 .;*308
"RTN","PSOORFI4",36,0)
 .I $$CHKCOM(.PRC) D  Q
"RTN","PSOORFI4",37,0)
 ..N X,Y,DIR,DIRUT,DUOUT,MSG
"RTN","PSOORFI4",38,0)
 ..S MSG(1)="*** Provider Comments CANNOT be copied ***"
"RTN","PSOORFI4",39,0)
 ..S MSG(1,"F")="!,$C(7)"
"RTN","PSOORFI4",40,0)
 ..S MSG(2)="They contain a word longer than 32 characters, which is not allowed in"
"RTN","PSOORFI4",41,0)
 ..S MSG(3)="the Patient Instructions.  You need to enter this manually."
"RTN","PSOORFI4",42,0)
 ..D EN^DDIOL(.MSG)
"RTN","PSOORFI4",43,0)
 ..S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR
"RTN","PSOORFI4",44,0)
 .S PSOPRC=1,NI=0 F I=0:0 S I=$O(PSONEW("SIG",I)) Q:'I  S NI=I
"RTN","PSOORFI4",45,0)
 .S NC=0 F I=0:0 S I=$O(PRC(I)) Q:'I  S NC=NC+1
"RTN","PSOORFI4",46,0)
 .I NI'>1,NC=1,($L($G(PSONEW("SIG",NI)))+$L(PRC(1)))'>250 D  Q 
"RTN","PSOORFI4",47,0)
 ..S X=PRC(1) D SIGONE^PSOHELP
"RTN","PSOORFI4",48,0)
 ..S PSONEW("SIG",1)=$G(PSONEW("SIG",NI))_INS1 K INS1,X
"RTN","PSOORFI4",49,0)
 ..S:$E(PSONEW("SIG",1))=" " PSONEW("SIG",1)=$E(PSONEW("SIG",1),2,250) S PSONEW("INS")=PSONEW("SIG",1) D EN^PSOFSIG(.PSONEW,1) K NI,NC
"RTN","PSOORFI4",50,0)
 .F I=0:0 S I=$O(PRC(I)) Q:'I  S NI=NI+1,(PSONEW("INS",NI),X)=PRC(I) D SIGONE^PSOHELP S PSONEW("SIG",NI)=INS1 K INS1
"RTN","PSOORFI4",51,0)
 .I $E(PSONEW("SIG",1))=" " S PSONEW("SIG",1)=$E(PSONEW("SIG",1),2,250)
"RTN","PSOORFI4",52,0)
 .D EN^PSOFSIG(.PSONEW,1) K NI,NC,X
"RTN","PSOORFI4",53,0)
 Q
"RTN","PSOORFI4",54,0)
CHKCOM(PRC) ;Check provider comments array PRC. If any comment line is longer than 32 characters with no spaces, return 1
"RTN","PSOORFI4",55,0)
 ;*308
"RTN","PSOORFI4",56,0)
 ;INPUT:  PRC( = Provider Comments array
"RTN","PSOORFI4",57,0)
 ;OUTPUT: PSOERR  = O - OK
"RTN","PSOORFI4",58,0)
 ;                = 1 - Error (Comments > 32 chars. w/ no spaces)
"RTN","PSOORFI4",59,0)
 N PSOX,PSOY,PSOZ,PSOERR
"RTN","PSOORFI4",60,0)
 S PSOERR=0
"RTN","PSOORFI4",61,0)
 I '$D(PRC) Q PSOERR
"RTN","PSOORFI4",62,0)
 S PSOX=0
"RTN","PSOORFI4",63,0)
 F  S PSOX=$O(PRC(PSOX)) Q:PSOX=""!PSOERR  I $L(PRC(PSOX))>32 D
"RTN","PSOORFI4",64,0)
 .S PSOZ=$L(PRC(PSOX)," ") F PSOY=1:1:PSOZ I $L($P(PRC(PSOX)," ",PSOY))>32 S PSOERR=1 Q
"RTN","PSOORFI4",65,0)
 Q PSOERR
"RTN","PSOORFI4",66,0)
DOSE ;displays dosing info for pending orders.  called from psoorfi1
"RTN","PSOORFI4",67,0)
 K II,UNITS S DS=1
"RTN","PSOORFI4",68,0)
 I '$O(^PS(52.41,ORD,1,0)) S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (3)        *Dosage:" G DOSEX
"RTN","PSOORFI4",69,0)
 F I=0:0 S I=$O(^PS(52.41,ORD,1,I)) Q:'I  S DOSE=$G(^PS(52.41,ORD,1,I,1)),DOSE1=$G(^(2)) D  D DOSE1
"RTN","PSOORFI4",70,0)
 .S II=$G(II)+1 K PSONEW("UNITS",II)
"RTN","PSOORFI4",71,0)
 .S PSONEW("DOSE",II)=$P(DOSE1,"^"),PSONEW("DOSE ORDERED",II)=$P(DOSE1,"^",2),PSONEW("UNITS",II)=$P(DOSE,"^",9),PSONEW("NOUN",II)=$P(DOSE,"^",5)
"RTN","PSOORFI4",72,0)
 .S:$P(DOSE,"^",9) UNITS=$P(^PS(50.607,$P(DOSE,"^",9),0),"^")
"RTN","PSOORFI4",73,0)
 .S PSONEW("VERB",II)=$P(DOSE,"^",10),PSONEW("ROUTE",II)=$P(DOSE,"^",8)
"RTN","PSOORFI4",74,0)
 .S:$P(DOSE,"^",8) ROUTE=$P(^PS(51.2,$P(DOSE,"^",8),0),"^")
"RTN","PSOORFI4",75,0)
 .S PSONEW("SCHEDULE",II)=$P(DOSE,"^"),PSONEW("DURATION",II)=$P(DOSE,"^",2)
"RTN","PSOORFI4",76,0)
 .S DOENT=$G(DOENT)+1 I $P(DOSE,"^",6)]"" S PSONEW("CONJUNCTION",II)=$S($P(DOSE,"^",6)="S":"T",$P(DOSE,"^",6)="X":"X",1:"A")
"RTN","PSOORFI4",77,0)
 .I 'PSONEW("DOSE ORDERED",II),$G(PSONEW("VERB",II))]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="               Verb: "_$G(PSONEW("VERB",II))
"RTN","PSOORFI4",78,0)
 .S:$G(DS) IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (3)"
"RTN","PSOORFI4",79,0)
DOSEX S PSONEW("ENT")=+$G(II) K DOSE,DOSE1,II,I,UNITS,ROUTE,DG
"RTN","PSOORFI4",80,0)
 Q
"RTN","PSOORFI4",81,0)
DOSE1 I $G(DS)=1 S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"        *Dosage:" D FMD^PSOORFI3 G DU
"RTN","PSOORFI4",82,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="            *Dosage:" D FMD^PSOORFI3
"RTN","PSOORFI4",83,0)
DU I 'PSONEW("DOSE ORDERED",I),$P($G(^PS(55,PSODFN,"LAN")),"^") S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" *Oth. Lang. Dosage: "_$G(PSONEW("ODOSE",I))
"RTN","PSOORFI4",84,0)
 I PSONEW("DOSE ORDERED",II),$G(PSONEW("VERB",II))]"" D
"RTN","PSOORFI4",85,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="               Verb: "_$G(PSONEW("VERB",II))
"RTN","PSOORFI4",86,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="     Dispense Units: "_$S($E(PSONEW("DOSE ORDERED",II),1)=".":"0",1:"")_PSONEW("DOSE ORDERED",II)
"RTN","PSOORFI4",87,0)
 I PSONEW("NOUN",II)]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="               Noun: "_PSONEW("NOUN",II)
"RTN","PSOORFI4",88,0)
 I $G(ROUTE)]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="             *Route: "_$G(ROUTE)
"RTN","PSOORFI4",89,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="          *Schedule: "_PSONEW("SCHEDULE",II)
"RTN","PSOORFI4",90,0)
 I $G(PSONEW("DURATION",II))]"" D
"RTN","PSOORFI4",91,0)
 .S PSONEW("DURATION",II)=$S($E(PSONEW("DURATION",II),1)'?.N:$E(PSONEW("DURATION",II),2,99)_$E(PSONEW("DURATION",II),1),1:PSONEW("DURATION",II))
"RTN","PSOORFI4",92,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="          *Duration: "_PSONEW("DURATION",II)_" ("_$S(PSONEW("DURATION",II)["M":"MINUTES",PSONEW("DURATION",II)["H":"HOURS",PSONEW("DURATION",II)["L":"MONTHS",PSONEW("DURATION",II)["W":"WEEKS",1:"DAYS")_")"
"RTN","PSOORFI4",93,0)
 I $G(PSONEW("CONJUNCTION",II))]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="       *Conjunction: "_$S(PSONEW("CONJUNCTION",II)="T":"THEN",PSONEW("CONJUNCTION",II)="X":"EXCEPT",1:"AND")
"RTN","PSOORFI4",94,0)
 Q
"RTN","PSOORFI4",95,0)
DOSE2 ;displays pending order after edits.  called from psoornew
"RTN","PSOORFI4",96,0)
 I '$O(PSONEW("DOSE",0))!($O(PSONEW("DOSE",0))="") S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (3)        *Dosage:" Q
"RTN","PSOORFI4",97,0)
 S DS=1
"RTN","PSOORFI4",98,0)
 F I=1:1:PSONEW("ENT") Q:'I  D  D DOSE3 K COJ
"RTN","PSOORFI4",99,0)
 .S:$G(PSONEW("UNITS",I))]"" UNITS=$P(^PS(50.607,PSONEW("UNITS",I),0),"^")
"RTN","PSOORFI4",100,0)
 .I $G(PSONEW("ROUTE",I))]"",$G(^PS(51.2,PSONEW("ROUTE",I),0))]"" S ROUTE=$P(^PS(51.2,PSONEW("ROUTE",I),0),"^")
"RTN","PSOORFI4",101,0)
 .S DUR=$G(PSONEW("DURATION",I)) S:$G(PSONEW("CONJUNCTION",I))]"" COJ=PSONEW("CONJUNCTION",I)
"RTN","PSOORFI4",102,0)
 .S NOUN=$G(PSONEW("NOUN",I)),VERB=$G(PSONEW("VERB",I))
"RTN","PSOORFI4",103,0)
 .I '$G(PSONEW("DOSE ORDERED",I)),$G(PSONEW("VERB",I))]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="               Verb: "_$G(PSONEW("VERB",I))
"RTN","PSOORFI4",104,0)
 .S:$G(DS) IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (3)"
"RTN","PSOORFI4",105,0)
 K I,UNITS,ROUTE,DUR,COJ,VERB,NOUN,DG
"RTN","PSOORFI4",106,0)
 Q
"RTN","PSOORFI4",107,0)
DOSE3 I $G(DS)=1 S II=I,^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"        *Dosage:" D FMD^PSOORFI3 G DO
"RTN","PSOORFI4",108,0)
 S II=I,IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="            *Dosage:" D FMD^PSOORFI3
"RTN","PSOORFI4",109,0)
DO I '$G(PSONEW("DOSE ORDERED",I)),$P($G(^PS(55,PSODFN,"LAN")),"^") S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" *Oth. Lang. Dosage: "_$G(PSONEW("ODOSE",I))
"RTN","PSOORFI4",110,0)
 I $G(PSONEW("DOSE ORDERED",I)),$G(PSONEW("VERB",I))]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="               Verb: "_$G(PSONEW("VERB",I))
"RTN","PSOORFI4",111,0)
 I $G(PSONEW("DOSE ORDERED",I)) S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="     Dispense Units: "_$S($E(PSONEW("DOSE ORDERED",I),1)=".":"0",1:"")_PSONEW("DOSE ORDERED",I)
"RTN","PSOORFI4",112,0)
 I $G(PSONEW("NOUN",I))]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="               NOUN: "_PSONEW("NOUN",I)
"RTN","PSOORFI4",113,0)
 I $G(ROUTE)]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="             *Route: "_$G(ROUTE)
"RTN","PSOORFI4",114,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="          *Schedule: "_PSONEW("SCHEDULE",I)
"RTN","PSOORFI4",115,0)
 I $G(PSONEW("DURATION",I))]"" D
"RTN","PSOORFI4",116,0)
 .S PSONEW("DURATION",I)=$S($E(PSONEW("DURATION",I),1)'?.N:$E(PSONEW("DURATION",I),2,99)_$E(PSONEW("DURATION",I),1),1:PSONEW("DURATION",I))
"RTN","PSOORFI4",117,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="          *Duration: "_PSONEW("DURATION",I)_" ("_$S(PSONEW("DURATION",I)["M":"MINUTES",PSONEW("DURATION",I)["H":"HOURS",PSONEW("DURATION",I)["L":"MONTHS",PSONEW("DURATION",I)["W":"WEEKS",1:"DAYS")_")"
"RTN","PSOORFI4",118,0)
 I $G(PSONEW("CONJUNCTION",I))]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="       *Conjunction: "_$S(PSONEW("CONJUNCTION",I)="T":"THEN",PSONEW("CONJUNCTION",I)="X":"EXCEPT",1:"AND")
"RTN","PSOORFI4",119,0)
 Q
"RTN","PSOORFI4",120,0)
OBX ;formats obx section
"RTN","PSOORFI4",121,0)
 N COM,II
"RTN","PSOORFI4",122,0)
 D:$G(PKI1) L1^PSOPKIV1
"RTN","PSOORFI4",123,0)
 I $O(^PS(52.41,ORD,"OBX",0)) S (T,IEN)=0,IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="CPRS Order Checks:" F  S T=$O(^PS(52.41,ORD,"OBX",T)) Q:'T  D  S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" "
"RTN","PSOORFI4",124,0)
 .S COM=$G(^PS(52.41,ORD,"OBX",T,0))
"RTN","PSOORFI4",125,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="     " F II=1:1:$L(COM," ") D
"RTN","PSOORFI4",126,0)
 ..I $L(^TMP("PSOPO",$J,IEN,0)_" "_$P(COM," ",II))>80 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="     "
"RTN","PSOORFI4",127,0)
 ..S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_" "_$P(COM," ",II)
"RTN","PSOORFI4",128,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="     Overriding Provider: "_$G(^PS(52.41,ORD,"OBX",T,1))
"RTN","PSOORFI4",129,0)
 .I $O(^PS(52.41,ORD,"OBX",T,2,0)) S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="     Overriding Reason:"
"RTN","PSOORFI4",130,0)
 .F T1=0:0 S T1=$O(^PS(52.41,ORD,"OBX",T,2,T1)) Q:'T1  D
"RTN","PSOORFI4",131,0)
 ..S MIG=^PS(52.41,ORD,"OBX",T,2,T1,0)
"RTN","PSOORFI4",132,0)
 ..F SG=1:1:$L(MIG," ") S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P(MIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",23)=" " S ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P(MIG," ",SG)
"RTN","PSOORFI4",133,0)
 Q
"RTN","PSOORFI4",134,0)
PP S PSODFN=PAT D NOW^%DTC S TM=$E(%,1,12),TM1=$P(TM,".",2)
"RTN","PSOORFI4",135,0)
 Q
"RTN","PSOORFI4",136,0)
SPL K PSOFIN S POERR("QFLG")=0 S PSONOLCK=1,PSOPTLOK=PAT
"RTN","PSOORFI4",137,0)
 Q
"RTN","PSOORFI4",138,0)
CLQTY ;
"RTN","PSOORFI4",139,0)
 K PSONEW("QTY")
"RTN","PSOORFI4",140,0)
 D QTY^PSOSIG(.PSONEW)
"RTN","PSOORFI4",141,0)
 S:'$G(PSONEW("QTY")) PSONEW("QTY")=0
"RTN","PSOORFI4",142,0)
 Q
"RTN","PSOORFI4",143,0)
PQTY ;
"RTN","PSOORFI4",144,0)
 S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_", days supply of "_+$P(OR0,"^",22)_" and a qty of "_+$P(OR0,"^",10)
"RTN","PSOORFI4",145,0)
 Q
"RTN","PSOORFI4",146,0)
REF Q:$G(PSODRUG("DEA"))']""
"RTN","PSOORFI4",147,0)
 S CS=0 F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S CS=1
"RTN","PSOORFI4",148,0)
 S PTRF=PSONEW("# OF REFILLS"),PSDAYS=PSONEW("DAYS SUPPLY")
"RTN","PSOORFI4",149,0)
 I CS D
"RTN","PSOORFI4",150,0)
 .S PSOX1=$S(PTRF>5:5,1:PTRF),PSOX=$S(PSOX1=5:5,1:PSOX1)
"RTN","PSOORFI4",151,0)
 .S PSOX=$S('PSOX:0,PSDAYS=90:1,1:PSOX),PSDY1=$S(PSDAYS<60:5,PSDAYS'<60&(PSDAYS'>89):2,PSDAYS=90:1,1:0)
"RTN","PSOORFI4",152,0)
 E  D
"RTN","PSOORFI4",153,0)
 .S PSOX1=PTRF,PSOX=$S(PSOX1=11:11,1:PSOX1),PSOX=$S('PSOX:0,PSDAYS=90:3,1:PSOX)
"RTN","PSOORFI4",154,0)
 .S PSDY1=$S(PSDAYS<60:11,PSDAYS'<60&(PSDAYS'>89):5,PSDAYS=90:3,1:0)
"RTN","PSOORFI4",155,0)
 S PSONEW("# OF REFILLS")=$S(PSONEW("# OF REFILLS")>PSDY1:PSDY1,1:PSONEW("# OF REFILLS"))
"RTN","PSOORFI4",156,0)
 Q
"RTN","PSOORNE1")
0^32^B73585771
"RTN","PSOORNE1",1,0)
PSOORNE1 ;BIR/SAB - Display new orders from backdoor ;03/06/95
"RTN","PSOORNE1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,21,27,32,37,46,71,94,104,117,133,148,279,251**;DEC 1997;Build 202
"RTN","PSOORNE1",3,0)
 ;External reference to ^PS(55 is supported by DBIA 2228
"RTN","PSOORNE1",4,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5424
"RTN","PSOORNE1",5,0)
EN(PSONEW) D DSPL^PSOORNE3,^PSOLMPO2
"RTN","PSOORNE1",6,0)
 Q
"RTN","PSOORNE1",7,0)
EDT N FLD,LST K DIR,DUOUT,DIRUT S DIR("A")="Select Field to Edit by number",DIR(0)="LO^1:14" D ^DIR I $D(DTOUT)!($D(DUOUT)) K DIR,DIRUT,DTOUT,DTOUT S VALMBCK="" Q
"RTN","PSOORNE1",8,0)
EDTSEL S:'$G(COPY) PSOEDIT=1 S (PSONEW("DFLG"),PSONEW("FIELD"),PSONEW3)=0
"RTN","PSOORNE1",9,0)
 I +Y S LST=Y D HLDHDR^PSOLMUTL D  Q:$G(PSORX("DFLG"))!($G(PSORX("QFLG")))  S VALMBCK="R" G DSPL^PSOORNE3
"RTN","PSOORNE1",10,0)
 .F FLD=1:1:$L(LST,",") Q:$P(LST,",",FLD)']""  D @(+$P(LST,",",FLD)) Q:$G(PSODIR("DFLG"))!($G(PSODIR("QFLG")))
"RTN","PSOORNE1",11,0)
 E  S VALMBCK="" D FULL^VALM1
"RTN","PSOORNE1",12,0)
 D RDSPL G DSPL^PSOORNE3
"RTN","PSOORNE1",13,0)
 Q
"RTN","PSOORNE1",14,0)
ACP K VALMSG,DIR,PSORX("DFLG") D VER I $G(PSONEW2("QFLG"))!($G(PSORX("DFLG"))) S VALMBCK="Q" K PSONEW2 Q
"RTN","PSOORNE1",15,0)
 N PSONOBCK S PSONOBCK=$S($G(PSOSIGFL):1,1:0)
"RTN","PSOORNE1",16,0)
 D NOOR^PSONEW I $D(DIRUT) S PSONEW("DFLG")=1 K DIR,X,Y,DIRUT,DUOUT,DTOUT Q
"RTN","PSOORNE1",17,0)
 D RXNCHK,RDSPL
"RTN","PSOORNE1",18,0)
 I $G(PSONEW("QFLG")) S PSONEW("DFLG")=1 K DIR,X,Y,DIRUT,DUOUT,DTOUT Q
"RTN","PSOORNE1",19,0)
 D DISPLAY^PSONEW2
"RTN","PSOORNE1",20,0)
 D ^PSONEWG I $G(PSOCPZ("DFLG")) S PSONEW("DFLG")=1 K PSOANSQ,DIR,X,Y,DIRUT,DUOUT,DTOUT,PSOCPZ("DFLG"),PSOANSQD Q
"RTN","PSOORNE1",21,0)
 K PSOCPZ("DFLG")
"RTN","PSOORNE1",22,0)
 K DIR,DIRUT,X,Y S DIR(0)="Y",DIR("B")="YES",DIR("A")="Is this correct" D ^DIR
"RTN","PSOORNE1",23,0)
 I $D(DIRUT) S PSONEW("DFLG")=1 K PSOANSQ,PSOANSQD,DIR,X,Y,DIRUT,DUOUT,DTOUT Q
"RTN","PSOORNE1",24,0)
 I 'Y S VALMBCK="R" K PSOANSQ,DIR,X,Y,DIRUT,DUOUT,DTOUT D DSPL^PSOORNE3 Q
"RTN","PSOORNE1",25,0)
 W "..." K PSOANSQD,DIR,X,Y,DIRUT,DUOUT,DTOUT D DCORD^PSONEW2
"RTN","PSOORNE1",26,0)
 I $G(NCPDPFLG) D NCPDP^PSOORED6
"RTN","PSOORNE1",27,0)
 K:$G(COPY)!($G(PSOSIGFL)) PRC,PHI
"RTN","PSOORNE1",28,0)
 S:'$G(PSOID) PSOID=DT S (PSORX("FN"),PSONEW("POE"))=1 D EN^PSON52(.PSONEW) ; Files entry in File 52
"RTN","PSOORNE1",29,0)
 I $G(PSOBEDT) D
"RTN","PSOORNE1",30,0)
 .I '$D(^TMP("PSOBEDT",$J,PSODFN,0)) S ^TMP("PSOBEDT",$J,PSODFN,0)=PSORXED("IRXN") S:$G(PSONEW("MAIL/WINDOW"))["W" ^TMP("PSOBEDT",$J,PSODFN,1)=1 Q
"RTN","PSOORNE1",31,0)
 .S ^TMP("PSOBEDT",$J,PSODFN,0)=^TMP("PSOBEDT",$J,PSODFN,0)_","_PSORXED("IRXN")
"RTN","PSOORNE1",32,0)
 .I $G(PSONEW("MAIL/WINDOW"))["W" S ^TMP("PSOBEDT",$J,PSODFN,1)=1
"RTN","PSOORNE1",33,0)
 D NPSOSD^PSOUTIL(.PSONEW) ; Adds newly added rx to PSOSD array
"RTN","PSOORNE1",34,0)
 D ^PSOBUILD S VALMBCK="Q"
"RTN","PSOORNE1",35,0)
 K PSONEW("# OF REFILLS"),PSONEW("DAYS SUPPLY"),SDA,SEG1,SSN1,STA,Z4,ZDA
"RTN","PSOORNE1",36,0)
 Q:$G(COPY)  S PSONEW("DFLG")=0
"RTN","PSOORNE1",37,0)
 Q
"RTN","PSOORNE1",38,0)
VER I $G(PSOAC),$G(PSODRUG("NAME"))']"" D FULL^VALM1,2^PSOORNW1
"RTN","PSOORNE1",39,0)
 I $G(PSODRUG("NAME"))']"" S VALMSG="A Dispense Drug Must be Chosen!" S PSONEW2("QFLG")=1 Q
"RTN","PSOORNE1",40,0)
 I '$G(PSONEW("ENT")) W !,"Dosing Instruction Missing!!",! D  I PSONEW("DFLG")=1 S PSONEW2("QFLG")=1 Q
"RTN","PSOORNE1",41,0)
 .S PSOORRNW=1
"RTN","PSOORNE1",42,0)
 .K VALMSG D FULL^VALM1 W !,"Drug: "_PSODRUG("NAME")
"RTN","PSOORNE1",43,0)
 .I $O(SIG(0)) F I=1:1 Q:$G(SIG(I))']""  W !,SIG(I)
"RTN","PSOORNE1",44,0)
 .E   I $G(^PSRX(PSONEW("OIRXN"),"SIG"))]"" S X=$P(^PSRX(PSONEW("OIRXN"),"SIG"),"^") D SIGONE^PSOHELP W !,$E($G(INS1),2,250)
"RTN","PSOORNE1",45,0)
 .W ! D 5 K PSOORRNW I PSONEW("DFLG")=1 D M3 Q
"RTN","PSOORNE1",46,0)
 .D 6 D:PSONEW("DFLG")=1 M3
"RTN","PSOORNE1",47,0)
 D:$G(COPY) PROV^PSOUTIL(.PSORENW) I PSONEW("DFLG")=1 S PSONEW2("QFLG")=1 Q
"RTN","PSOORNE1",48,0)
 N PSODOSD D FULL^VALM1,POST^PSODRG:'$G(PSOSIGFL)
"RTN","PSOORNE1",49,0)
 I $G(POERR("DFLG"))=1 S (PSONEW("DFLG"),PSONEW2("QFLG"))=1 Q
"RTN","PSOORNE1",50,0)
 I $G(PSODOSD) S (PSONEW("DFLG"),PSONEW2("QFLG"))=1 Q
"RTN","PSOORNE1",51,0)
 D:$$DS^PSSDSAPI&('$G(PSORX("DFLG"))) DOSCK^PSODOSUT("N") K PSONOOR I $G(PSORX("DFLG")) S VALMBCK="Q" Q
"RTN","PSOORNE1",52,0)
 I +$G(PSEXDT) D
"RTN","PSOORNE1",53,0)
 .D FULL^VALM1 S:$G(PSONEW("MAIL/WINDOW"))["W" BINGCRT="Y",BINGRTE="W"
"RTN","PSOORNE1",54,0)
 .D:+$G(PSEXDT)
"RTN","PSOORNE1",55,0)
 ..S Y=PSONEW("FILL DATE") X ^DD("DD") W !!,$C(7),Y_" fill date is greater than possible expiration date of " S Y=$P(PSEXDT,"^",2) X ^DD("DD") W Y_"."
"RTN","PSOORNE1",56,0)
 .S PSONEW2("QFLG")=1,VALMBCK="R" D PAUSE^VALM1
"RTN","PSOORNE1",57,0)
 Q
"RTN","PSOORNE1",58,0)
1 I $G(PSOSIGFL) S PSOAC=1 D 2^PSOORNW1 K PSOAC D RDSPL G DSPL^PSOORNE3 Q
"RTN","PSOORNE1",59,0)
 D 6^PSOBKDED D RDSPL G DSPL^PSOORNE3 Q
"RTN","PSOORNE1",60,0)
 ;
"RTN","PSOORNE1",61,0)
2 D 3^PSOBKDED Q
"RTN","PSOORNE1",62,0)
 ;
"RTN","PSOORNE1",63,0)
3 D 1^PSOBKDED Q
"RTN","PSOORNE1",64,0)
 ;
"RTN","PSOORNE1",65,0)
4 D 2^PSOBKDED Q
"RTN","PSOORNE1",66,0)
 ;
"RTN","PSOORNE1",67,0)
5 I '$G(PSODRUG("IEN")) W !,"DRUG NAME REQUIRED!" D 2^PSOORNW1 I '$G(PSODRUG("IEN")) S VALMSG="No Dispense Drug Selected" Q
"RTN","PSOORNE1",68,0)
 W !!,"Drug: "_PSODRUG("NAME") D 10^PSOBKDED Q
"RTN","PSOORNE1",69,0)
 ;
"RTN","PSOORNE1",70,0)
6 D INS^PSOBKDED Q:$G(PSONEW("DFLG"))  I $P($G(^PS(55,PSODFN,"LAN")),"^") D SINS^PSODIR(.PSONEW)
"RTN","PSOORNE1",71,0)
 Q
"RTN","PSOORNE1",72,0)
 ;
"RTN","PSOORNE1",73,0)
7 D 8^PSOBKDED Q
"RTN","PSOORNE1",74,0)
 ;
"RTN","PSOORNE1",75,0)
8 D 7^PSOBKDED Q
"RTN","PSOORNE1",76,0)
 ;
"RTN","PSOORNE1",77,0)
9 D 9^PSOBKDED Q
"RTN","PSOORNE1",78,0)
 ;
"RTN","PSOORNE1",79,0)
10 D 12^PSOBKDED Q
"RTN","PSOORNE1",80,0)
 ;
"RTN","PSOORNE1",81,0)
11 D 5^PSOBKDED Q
"RTN","PSOORNE1",82,0)
 ;
"RTN","PSOORNE1",83,0)
12 D 4^PSOBKDED Q
"RTN","PSOORNE1",84,0)
 ;
"RTN","PSOORNE1",85,0)
13 D 11^PSOBKDED Q
"RTN","PSOORNE1",86,0)
 ;
"RTN","PSOORNE1",87,0)
14 D 13^PSOBKDED Q
"RTN","PSOORNE1",88,0)
 ;
"RTN","PSOORNE1",89,0)
SUMM ;print break down of orders to be finished
"RTN","PSOORNE1",90,0)
 K ^TMP($J,"PSOCZT"),^TMP($J,"PSODPAT"),PAT,RT,DIR,DUOUT,DIRUT,PSZLQUIT
"RTN","PSOORNE1",91,0)
 S DIR("A")="Do you want an Order Summary",DIR(0)="Y",DIR("B")="No"
"RTN","PSOORNE1",92,0)
 D ^DIR K DIR I 'Y!($D(DIRUT)) K Y,X,DIRUT Q
"RTN","PSOORNE1",93,0)
 K PSOINPRT,DIQ,^UTILITY("DIQ1",$J) I $G(PSOPINST) S DA=PSOPINST,DIC=4,DIQ(0)="E",DR=".01" D EN^DIQ1 S PSOINPRT=$G(^UTILITY("DIQ1",$J,4,DA,.01,"E")) K ^UTILITY("DIQ1",$J),DA,DR,DIC,DIQ
"RTN","PSOORNE1",94,0)
 I $D(^PS(52.41,"ACL")) N PSOCLSUM D SUMMCL I $G(PSOCLSUM) K PSOINPRT Q
"RTN","PSOORNE1",95,0)
 F PSI=0:0 S PSI=$O(^PS(52.41,"AOR",PSI)) Q:'PSI  F PSID=0:0 S PSID=$O(^PS(52.41,"AOR",PSI,PSID)) Q:'PSID  F PIN=0:0 S PIN=$O(^PS(52.41,"AOR",PSI,PSID,PIN)) Q:'PIN  D
"RTN","PSOORNE1",96,0)
 .I '$D(^TMP($J,"PSOCZT",PSID,"PAT")) F PZA="PAT","WIN","MAIL","CLIN" S ^TMP($J,"PSOCZT",PSID,PZA)=0
"RTN","PSOORNE1",97,0)
 .I '$D(^TMP($J,"PSODPAT",PSID,PSI)) S ^TMP($J,"PSODPAT",PSID,PSI)=1,^TMP($J,"PSOCZT",PSID,"PAT")=^TMP($J,"PSOCZT",PSID,"PAT")+1
"RTN","PSOORNE1",98,0)
 .S PZROUT=$P($G(^PS(52.41,PIN,0)),"^",17) I PZROUT'="" S ^TMP($J,"PSOCZT",PSID,$S(PZROUT="C":"CLIN",PZROUT="M":"MAIL",1:"WIN"))=^TMP($J,"PSOCZT",PSID,$S(PZROUT="C":"CLIN",PZROUT="M":"MAIL",1:"WIN"))+1
"RTN","PSOORNE1",99,0)
 W @IOF W !?20,"Pending Outpatient Medication Orders",! I $G(PSZCNT)>1 W ?20,"(signed in under "_$G(PSOINPRT)_")",!
"RTN","PSOORNE1",100,0)
 F PSOINL=0:0 S PSOINL=$O(^TMP($J,"PSOCZT",PSOINL)) Q:'PSOINL!($G(PSZLQUIT))  D
"RTN","PSOORNE1",101,0)
 .I ($Y+6)>IOSL K DIR S DIR(0)="E" D ^DIR K DIR D:$G(Y)  I '$G(Y) S PSZLQUIT=1 W ! Q
"RTN","PSOORNE1",102,0)
 ..W @IOF W !?20,"Pending Outpatient Medication Orders",! I $G(PSZCNT)>1 W ?20,"(signed in under "_$G(PSOINPRT)_")",!
"RTN","PSOORNE1",103,0)
 .K ^UTILITY("DIQ1",$J),DIQ,PSOINPRX S DA=$G(PSOINL),DIC=4,DIQ(0)="E",DR=".01" D EN^DIQ1 S PSOINPRX=$G(^UTILITY("DIQ1",$J,4,DA,.01,"E")) K ^UTILITY("DIQ1",$J),DA,DR,DIC,DIQ
"RTN","PSOORNE1",104,0)
 .;PSO*7*279 Change division to Institution
"RTN","PSOORNE1",105,0)
 .W !,"Institution: ",$G(PSOINPRX)
"RTN","PSOORNE1",106,0)
 .W !,"Patients: "_$G(^TMP($J,"PSOCZT",PSOINL,"PAT"))_"  Window: "_$G(^("WIN"))_"  Mail: "_$G(^("MAIL"))_"  Clinic: "_$G(^("CLIN")),!
"RTN","PSOORNE1",107,0)
 K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to Continue" D ^DIR K DIR
"RTN","PSOORNE1",108,0)
 K ^TMP($J,"PSOCZT"),^TMP($J,"PSODPAT"),RT,PSOINPRT,PSOINPRX,PSI,PSID,PIN,PZA,PZROUT,PSOINL,PSZLQUIT
"RTN","PSOORNE1",109,0)
 Q
"RTN","PSOORNE1",110,0)
SUMMCL ;
"RTN","PSOORNE1",111,0)
 ;PSO*7*279 Change Division to Institution
"RTN","PSOORNE1",112,0)
 W ! K DIR S DIR(0)="SMB^I:INSTITUTION;C:CLINIC",DIR("A")="Do you want the summary by Institution or Clinic",DIR("B")="Institution",DIR("?")=" "
"RTN","PSOORNE1",113,0)
 S DIR("?",1)="Enter 'I' to see the summary by Institution, and within Institution the orders",DIR("?",2)="shown by Mail, Window, or Administered in Clinic.",DIR("?",3)="Enter 'C' to see the summary by Clinic, along with Clinic Sort Groups."
"RTN","PSOORNE1",114,0)
 D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) S PSOCLSUM=1 Q
"RTN","PSOORNE1",115,0)
 Q:$G(Y)="I"
"RTN","PSOORNE1",116,0)
 S PSOCLSUM=1
"RTN","PSOORNE1",117,0)
 K ^TMP($J,"PSOLOC"),^TMP($J,"PSOLOCP") N PSCX,PSCXL,PSLX,PSCIN,PSCPT,PSCNDE,PSNCL,PSNPAT,PSCLOUT,PSCSFLAG,PCCNT,PSOCAG
"RTN","PSOORNE1",118,0)
 F PSCX=0:0 S PSCX=$O(^PS(52.41,"ACL",PSCX)) Q:'PSCX  F PSLX=0:0 S PSLX=$O(^PS(52.41,"ACL",PSCX,PSLX)) Q:'PSLX  F PSCIN=0:0 S PSCIN=$O(^PS(52.41,"ACL",PSCX,PSLX,PSCIN)) Q:'PSCIN  S PSCPT=+$P($G(^PS(52.41,PSCIN,0)),"^",2) D:PSCPT
"RTN","PSOORNE1",119,0)
 .S PSCNDE=$G(^PS(52.41,PSCIN,0))
"RTN","PSOORNE1",120,0)
 .I $P(PSCNDE,"^",3)'="NW",$P(PSCNDE,"^",3)'="RNW",$P(PSCNDE,"^",3)'="RF" Q
"RTN","PSOORNE1",121,0)
 .I $P(PSCNDE,"^",13)="" Q
"RTN","PSOORNE1",122,0)
 .S PSNCL=+$P(PSCNDE,"^",13),PSNPAT=+$P(PSCNDE,"^",2)
"RTN","PSOORNE1",123,0)
 .I '$D(^TMP($J,"PSOLOC",PSNCL)) S ^TMP($J,"PSOLOC",PSNCL)="1^1",^TMP($J,"PSOLOCP",PSNCL,PSNPAT)="" Q
"RTN","PSOORNE1",124,0)
 .S $P(^TMP($J,"PSOLOC",PSNCL),"^",2)=$P(^TMP($J,"PSOLOC",PSNCL),"^",2)+1
"RTN","PSOORNE1",125,0)
 .I '$D(^TMP($J,"PSOLOCP",PSNCL,PSNPAT)) S $P(^TMP($J,"PSOLOC",PSNCL),"^")=$P(^TMP($J,"PSOLOC",PSNCL),"^")+1
"RTN","PSOORNE1",126,0)
 .S ^TMP($J,"PSOLOCP",PSNCL,PSNPAT)=""
"RTN","PSOORNE1",127,0)
 I '$O(^TMP($J,"PSOLOC",0)) G SUMMQ
"RTN","PSOORNE1",128,0)
 W @IOF W !?20,"Pending Outpatient Medication Orders" I $G(PSZCNT)>1 W !?20,"(signed in under "_$G(PSOINPRT)_")"
"RTN","PSOORNE1",129,0)
 F PSCXL=0:0 S PSCXL=$O(^TMP($J,"PSOLOC",PSCXL)) Q:'PSCXL!($G(PSCLOUT))  D
"RTN","PSOORNE1",130,0)
 .I ($Y+7)>IOSL D CLDIR Q:$G(PSCLOUT)
"RTN","PSOORNE1",131,0)
 .W !!,"Clinic:   ",$P($G(^SC(+PSCXL,0)),"^")
"RTN","PSOORNE1",132,0)
 .W !,"Patients: ",$P($G(^TMP($J,"PSOLOC",PSCXL)),"^"),?16,"Orders: ",$P($G(^TMP($J,"PSOLOC",PSCXL)),"^",2)
"RTN","PSOORNE1",133,0)
 .W !,"In Sort Groups:"
"RTN","PSOORNE1",134,0)
 .S (PCCNT,PSCSFLAG)=0 F PSCSORT=0:0 S PSCSORT=$O(^PS(59.8,PSCSORT)) Q:'PSCSORT!($G(PSCLOUT))  I $D(^PS(59.8,PSCSORT,1,"B",PSCXL)) S PSOCAG=0 D
"RTN","PSOORNE1",135,0)
 ..S PSCSFLAG=1 S:($Y+5)>IOSL&(PCCNT) PSOCAG=1 D:($Y+5)>IOSL&(PCCNT) CLDIR Q:$G(PSCLOUT)  W:$G(PSOCAG) !,"Clinic: "_$P($G(^SC(PSCXL,0)),"^")_"   cont." W:$G(PCCNT)>0 ! W ?16,$P($G(^PS(59.8,PSCSORT,0)),"^") S PCCNT=1
"RTN","PSOORNE1",136,0)
 .I '$G(PSCSFLAG) W ?16,"*** NO CLINIC SORT GROUPS ***"
"RTN","PSOORNE1",137,0)
 I '$G(PSCLOUT) K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press <RET> to continue"  D ^DIR K DIR
"RTN","PSOORNE1",138,0)
SUMMQ K ^TMP($J,"PSOLOC"),^TMP($J,"PSOLOCP")
"RTN","PSOORNE1",139,0)
 Q
"RTN","PSOORNE1",140,0)
CLDIR K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press <RET> to continue, '^' to exit" D ^DIR K DIR I Y'=1 S PSCLOUT=1 Q
"RTN","PSOORNE1",141,0)
 W @IOF
"RTN","PSOORNE1",142,0)
 Q
"RTN","PSOORNE1",143,0)
RXNCHK I $G(PSONEW("RX #"))']"" D RXNCHK^PSOORNE5
"RTN","PSOORNE1",144,0)
 Q
"RTN","PSOORNE1",145,0)
RDSPL D RDSPL^PSOORNE5
"RTN","PSOORNE1",146,0)
 Q
"RTN","PSOORNE1",147,0)
M3 D M3^PSOOREDX
"RTN","PSOORNE1",148,0)
 Q
"RTN","PSOORNE1",149,0)
 ;
"RTN","PSOORNE2")
0^49^B68912310
"RTN","PSOORNE2",1,0)
PSOORNE2 ;BIR/SAB-display finished orders from backdoor ;9/11/06 10:24am
"RTN","PSOORNE2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,21,23,27,32,37,46,84,103,117,131,146,156,210,148,222,238,264,281,289,251**;DEC 1997;Build 202
"RTN","PSOORNE2",3,0)
 ;^PSDRUG( -  221
"RTN","PSOORNE2",4,0)
 ;^YSCL(603.01 - 2697
"RTN","PSOORNE2",5,0)
 ;^PS(50.606 - 2174
"RTN","PSOORNE2",6,0)
 ;^PS(50.7 - 2223
"RTN","PSOORNE2",7,0)
 ;PSO*210 add call to WORDWRAP api
"RTN","PSOORNE2",8,0)
 ;$$DAWEXT^PSSDAWUT - 4708
"RTN","PSOORNE2",9,0)
 ;
"RTN","PSOORNE2",10,0)
SEL N ORN,ORD I '$G(PSOCNT) S VALMSG="This patient has no Prescriptions!" S VALMBCK="" Q
"RTN","PSOORNE2",11,0)
 D K1^PSOORNE6 S DIR("A")="Select Orders by number",DIR(0)="LO^1:"_PSOCNT D ^DIR I $D(DIRUT) D KV^PSOVER1 S VALMBCK="" Q
"RTN","PSOORNE2",12,0)
NEWSEL N ORN,ORD D K2^PSOORNE6
"RTN","PSOORNE2",13,0)
 ;
"RTN","PSOORNE2",14,0)
 I +Y S PSOOELSE=1,PSLST=Y K PSOREEDT F ORD=1:1:$L(PSLST,",") Q:$P(PSLST,",",ORD)']""  D  D UL1 K ^TMP("PSORXPO",$J) I $G(PSOQUIT) K PSOQUIT Q
"RTN","PSOORNE2",15,0)
 .S ORN=+$P(PSLST,",",ORD) D @$S(+PSOLST(ORN)=52:"ACT",1:"PEN^PSOORNE5")
"RTN","PSOORNE2",16,0)
 .K PSOREEDT,PSOSIGFL,PSONACT,SIGOK,PSOFDR,DRET,SIG,INS1
"RTN","PSOORNE2",17,0)
 K PRC,PHI,RTE I '$G(PSOOELSE) S VALMBCK=""
"RTN","PSOORNE2",18,0)
 K PSONACT,PSOOELSE,CLOZPAT D ^PSOBUILD,BLD^PSOORUT1,K3^PSOORNE6
"RTN","PSOORNE2",19,0)
 Q
"RTN","PSOORNE2",20,0)
 ;
"RTN","PSOORNE2",21,0)
ACT N REF K ^TMP("PSOAO",$J),PCOMX,PDA,PHI,PRC,ACOM,ANS,PSOFDR,CLOZPAT,ANQREM,DUR,DRET
"RTN","PSOORNE2",22,0)
 S RXN=$P(PSOLST(ORN),"^",2),RX0=^PSRX(RXN,0),RX2=$G(^(2)),RX3=$G(^(3)),ST=+$G(^("STA")),RXOR=$G(^("OR1")),POE=$G(^("POE")),EXDT=$S($P($G(^(2)),"^",6)>DT:1,1:0)
"RTN","PSOORNE2",23,0)
 I 'RX3 S RX3=$P(RX2,"^",2),$P(^PSRX(RXN,3),"^")=$P(RX2,"^",2)
"RTN","PSOORNE2",24,0)
 S PSODRG=+$P(RX0,"^",6),PSODRUG0=^PSDRUG(PSODRG,0),INDT=$G(^("I"))
"RTN","PSOORNE2",25,0)
 ;PSO*7*238;SET PSODRUG ARRAY ; PSOY KILLED AT END OF SET^PSODRG
"RTN","PSOORNE2",26,0)
 K PSODRUG
"RTN","PSOORNE2",27,0)
 S PSOY=PSODRG,PSOY(0)=PSODRUG0 D SET^PSODRG
"RTN","PSOORNE2",28,0)
 I 'RXOR,$P(^PSDRUG(PSODRG,2),"^") S $P(^PSRX(RXN,"OR1"),"^")=$P(^PSDRUG(PSODRG,2),"^"),RXOR=$P(^PSDRUG(PSODRG,2),"^")
"RTN","PSOORNE2",29,0)
 I $P($G(^PSDRUG(PSODRG,"CLOZ1")),"^")="PSOCLO1" D
"RTN","PSOORNE2",30,0)
 .S CLOZPAT=$O(^YSCL(603.01,"C",PSODFN,0)) Q:'CLOZPAT
"RTN","PSOORNE2",31,0)
 .;S CLOZPAT=$S($P(^YSCL(603.01,CLOZPAT,0),"^",3)="B":1,1:0)
"RTN","PSOORNE2",32,0)
 .S CLOZPAT=$P(^YSCL(603.01,CLOZPAT,0),"^",3)
"RTN","PSOORNE2",33,0)
 .S CLOZPAT=$S(CLOZPAT="M":2,CLOZPAT="B":1,1:0)
"RTN","PSOORNE2",34,0)
 I $D(^XUSEC("PSORPH",DUZ)) S RPH=1 D
"RTN","PSOORNE2",35,0)
 .S PSOACT=$S('ST&($G(INDT)]"")&(DT>$G(INDT)):"DHPLATC",ST=1:"DVE",ST=4:"DV",ST=3:"DU",ST=5:"ELTD",ST=11:"ETDPCL",ST=12&EXDT:"EDCL",ST=12&'EXDT:"ECL",(ST=14!(ST=15))&'EXDT:"ECL",ST=13:"L",ST=16:"DL",1:"DHPEATCL")
"RTN","PSOORNE2",36,0)
 .D GET^PSOORNE5 S PSOACT=PSOACT_$S(ACTREN:"N",1:""),PSOACT=PSOACT_$S(ACTREF:"R",1:"")
"RTN","PSOORNE2",37,0)
 .I ST=5 S SURX=$O(^PS(52.5,"B",RXN,0)) I SURX,$P($G(^PS(52.5,SURX,0)),"^",7)="L" S PSOACT="TL" K SURX Q
"RTN","PSOORNE2",38,0)
 .S:ST'=12&('$D(^PS(50.7,+$P(RXOR,"^"),0))) PSOACT="DL",VALMSG="No Pharmacy Orderable Item !",PSONACT=1
"RTN","PSOORNE2",39,0)
 .S:ST=12&('$D(^PS(50.7,+$P(RXOR,"^"),0))) PSOACT="L",VALMSG="No Pharmacy Orderable Item !",PSONACT=1
"RTN","PSOORNE2",40,0)
 .;I ST=14!(ST=15) S VALMSG="Rx Discontinued By "_$S(ST=14:"Provider",1:"Edit")_". Cannot be Reinstated."
"RTN","PSOORNE2",41,0)
 .S:ST=16 VALMSG="Rx Placed on HOLD by Provider."
"RTN","PSOORNE2",42,0)
 E  D
"RTN","PSOORNE2",43,0)
 .I ST=5 S SURX=$O(^PS(52.5,"B",RXN,0)) I SURX,$P($G(^PS(52.5,SURX,0)),"^",7)="L" S PSOACT="TL" Q
"RTN","PSOORNE2",44,0)
 .S PSOACT=$S(ST'<1&(ST'>4)!(ST>12):"",ST=12&EXDT&($P($G(PSOPAR),"^",2)):"CDPLT",1:"CPLT")
"RTN","PSOORNE2",45,0)
 .D GET^PSOORNE5 S PSOACT=PSOACT_$S(ACTREN:"N",1:""),PSOACT=PSOACT_$S(ACTREF:"R",1:"")
"RTN","PSOORNE2",46,0)
 .S:'$D(^PS(50.7,+$P(RXOR,"^"),0)) PSOACT="L",PSONACT=1,VALMSG="No Pharmacy Orderable Item !"
"RTN","PSOORNE2",47,0)
 ;K PSOLKFL D PSOL^PSSLOCK(RXN) I '$G(PSOMSG) K PSOMSG S PSOLKFL=1 S PSOACT="",VALMSG="This Order is being edited by another user."
"RTN","PSOORNE2",48,0)
 K PSOMSG S IEN=0,$P(RN," ",12)=" "
"RTN","PSOORNE2",49,0)
 I $G(RPH),ST=1,$P($G(^PSRX(RXN,"PKI")),"^") N PKI,PKI1,PKIR,PKIE,DA S DA=RXN D CER^PSOPKIV1 K DA D:$G(PKI1) L1^PSOPKIV1
"RTN","PSOORNE2",50,0)
 D DIN^PSONFI(+RXOR,$P(RX0,"^",6))
"RTN","PSOORNE2",51,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=$S($P($G(^PSRX(RXN,"TPB")),"^"):"            TPB Rx #: ",1:"                Rx #: ")
"RTN","PSOORNE2",52,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_$P(RX0,"^")_$S($G(^PSRX(RXN,"IB")):"$",1:"")_$$ECME^PSOBPSUT(RXN)_$E(RN,$L($P(RX0,"^")_$S($G(^PSRX(RXN,"IB")):"$",1:"")_$$ECME^PSOBPSUT(RXN))+1,12)
"RTN","PSOORNE2",53,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" ("_$S($P(PSOPAR,"^",3):1,1:"#")_")"_" *Orderable Item: "_$S($D(^PS(50.7,$P(+RXOR,"^"),0)):$P(^PS(50.7,$P(+RXOR,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^"),1:"")_NFIO
"RTN","PSOORNE2",54,0)
 S:NFIO["<DIN>" NFIO=IEN_","_($L(^TMP("PSOAO",$J,IEN,0))-4)
"RTN","PSOORNE2",55,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" ("_$S($P(PSOPAR,"^",3):2,1:"#")_")"_$S($D(^PSDRUG("AQ",$P(RX0,"^",6))):"       CMOP ",1:"            ")_"Drug: "_$P(^PSDRUG($P(RX0,"^",6),0),"^")_NFID
"RTN","PSOORNE2",56,0)
 S:NFID["<DIN>" NFID=IEN_","_($L(^TMP("PSOAO",$J,IEN,0))-4)
"RTN","PSOORNE2",57,0)
 I $$STATUS^PSOBPSUT(RXN,0)'="",$$RXRLDT^PSOBPSUT(RXN,0) D
"RTN","PSOORNE2",58,0)
 . S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" "_$S('$P(PSOPAR,"^",3):"(2)",1:"   ")_"             NDC: "_$$GETNDC^PSONDCUT(RXN,0)
"RTN","PSOORNE2",59,0)
 S:$G(^PSRX(RXN,"TN"))]"" IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="          Trade Name: "_$G(^PSRX(RXN,"TN"))
"RTN","PSOORNE2",60,0)
 D DOSE^PSOORNE5
"RTN","PSOORNE2",61,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" (4)Pat Instructions:" D INS^PSOORNE5
"RTN","PSOORNE2",62,0)
 D PC^PSOORNE5
"RTN","PSOORNE2",63,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="                 SIG:"
"RTN","PSOORNE2",64,0)
 I '$P($G(^PSRX(RXN,"SIG")),"^",2) S SIGOK=0 D  G PTST
"RTN","PSOORNE2",65,0)
 .S X=$P($G(^PSRX(RXN,"SIG")),"^") D SIGONE^PSOHELP S SIG=$E($G(INS1),2,250)
"RTN","PSOORNE2",66,0)
 .F SG=1:1:$L(SIG) S:$L(^TMP("PSOAO",$J,IEN,0)_" "_$P(SIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOAO",$J,IEN,0)," ",21)=" " S:$P(SIG," ",SG)'="" ^TMP("PSOAO",$J,IEN,0)=$G(^TMP("PSOAO",$J,IEN,0))_" "_$P(SIG," ",SG)
"RTN","PSOORNE2",67,0)
 S SIGOK=1
"RTN","PSOORNE2",68,0)
 F I=0:0 S I=$O(^PSRX(RXN,"SIG1",I)) Q:'I  D                  ;PSO*210
"RTN","PSOORNE2",69,0)
 . S MIG=$P(^PSRX(RXN,"SIG1",I,0),"^")
"RTN","PSOORNE2",70,0)
 . D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOAO",$J)),21)
"RTN","PSOORNE2",71,0)
 S SIGOK=1 K MIG,SG
"RTN","PSOORNE2",72,0)
PTST S $P(RN," ",25)=" ",PTST=$S($G(^PS(53,+$P(RX0,"^",3),0))]"":$P($G(^PS(53,+$P(RX0,"^",3),0)),"^"),1:""),IEN=IEN+1
"RTN","PSOORNE2",73,0)
 S ^TMP("PSOAO",$J,IEN,0)=" (5)  Patient Status: "_PTST_$E(RN,$L(PTST)+1,25)
"RTN","PSOORNE2",74,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" (6)      Issue Date: "_$E($P(RX0,"^",13),4,5)_"/"_$E($P(RX0,"^",13),6,7)_"/"_$E($P(RX0,"^",13),2,3)
"RTN","PSOORNE2",75,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_"               (7)  Fill Date: "_$E($P(RX2,"^",2),4,5)_"/"_$E($P(RX2,"^",2),6,7)_"/"_$E($P(RX2,"^",2),2,3)
"RTN","PSOORNE2",76,0)
 S ROU=$S($P(RX0,"^",11)="W":"Window",1:"Mail")
"RTN","PSOORNE2",77,0)
 S REFL=$P(RX0,"^",9),I=0 F  S I=$O(^PSRX(RXN,1,I)) Q:'I  S REFL=REFL-1,ROU=$S($P(^PSRX(RXN,1,I,0),"^",2)="W":"Window",1:"Mail")
"RTN","PSOORNE2",78,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="      Last Fill Date: "_$E($P(RX3,"^"),4,5)_"/"_$E($P(RX3,"^"),6,7)_"/"_$E($P(RX3,"^"),2,3)
"RTN","PSOORNE2",79,0)
 D CMOP^PSOORNE3
"RTN","PSOORNE2",80,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_" ("_ROU_$S($G(PSOCMOP)]"":", "_PSOCMOP,1:"")_")" K ROU,PSOCMOP
"RTN","PSOORNE2",81,0)
 S IEN=IEN+1 I $P(RX2,"^",15) S ^TMP("PSOAO",$J,IEN,0)="   Returned to Stock: "_$E($P(RX2,"^",15),4,5)_"/"_$E($P(RX2,"^",15),6,7)_"/"_$E($P(RX2,"^",15),2,3)_$S($P(RX2,"^",14):" (Reprinted)",1:"")
"RTN","PSOORNE2",82,0)
 E  S ^TMP("PSOAO",$J,IEN,0)="   Last Release Date: " D
"RTN","PSOORNE2",83,0)
 .S RLD=$S($P(RX2,"^",13):$E($P(RX2,"^",13),4,5)_"/"_$E($P(RX2,"^",13),6,7)_"/"_$E($P(RX2,"^",13),2,3),1:"")
"RTN","PSOORNE2",84,0)
 .I $O(^PSRX(RXN,1,0)) F I=0:0 S I=$O(^PSRX(RXN,1,I)) Q:'I  D
"RTN","PSOORNE2",85,0)
 ..I $P(^PSRX(RXN,1,I,0),"^",18) S RLD=$E($P(^(0),"^",18),4,5)_"/"_$E($P(^(0),"^",18),6,7)_"/"_$E($P(^(0),"^",18),2,3)
"RTN","PSOORNE2",86,0)
 .S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_$S($G(RLD)]"":RLD,1:"        ")
"RTN","PSOORNE2",87,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_"               (8)      Lot #: "_$P($G(RX2),"^",4)
"RTN","PSOORNE2",88,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="             Expires: "_$E($P(RX2,"^",6),4,5)_"/"_$E($P(RX2,"^",6),6,7)_"/"_$E($P(RX2,"^",6),2,3)
"RTN","PSOORNE2",89,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_"                          MFG: "_$P($G(RX2),"^",8)
"RTN","PSOORNE2",90,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(9)      Days Supply: "_$P(RX0,"^",8)_$S($L($P(RX0,"^",8))=1:" ",1:"")
"RTN","PSOORNE2",91,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_"                    (10)  QTY"_$S($P($G(^PSDRUG($P(RX0,"^",6),660)),"^",8)]"":" ("_$P($G(^PSDRUG($P(RX0,"^",6),660)),"^",8)_")",1:" (  )")_": "_$P(RX0,"^",7)
"RTN","PSOORNE2",92,0)
 I $P($G(^PSDRUG($P(RX0,"^",6),5)),"^")]"" D
"RTN","PSOORNE2",93,0)
 .S $P(RN," ",79)=" ",IEN=IEN+1
"RTN","PSOORNE2",94,0)
 .S ^TMP("PSOAO",$J,IEN,0)=$E(RN,$L("QTY DSP MSG: "_$P(^PSDRUG($P(RX0,"^",6),5),"^"))+1,79)_"QTY DSP MSG: "_$P(^PSDRUG($P(RX0,"^",6),5),"^") K RN
"RTN","PSOORNE2",95,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(11)    # of Refills: "_$P(RX0,"^",9)_$S($L($P(RX0,"^",9))=1:" ",1:"")_"                          Remaining: "_REFL
"RTN","PSOORNE2",96,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(12)        Provider: "_$S($D(^VA(200,$P(RX0,"^",4),0)):$P(^VA(200,$P(RX0,"^",4),0),"^"),1:"UNKNOWN")
"RTN","PSOORNE2",97,0)
 I $P(RX3,"^",3) S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="        Cos-Provider: "_$P(^VA(200,$S($G(PSORX("COSIGNING PROVIDER")):PSORX("COSIGNING PROVIDER"),1:$P(RX3,"^",3)),0),"^")
"RTN","PSOORNE2",98,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(13)         Routing: "_$S($P(RX0,"^",11)="M":"MAIL",1:"WINDOW")_"                  (14)     Copies: "_$S($P(RX0,"^",18):$P(RX0,"^",18),1:1)
"RTN","PSOORNE2",99,0)
 S:$P(RX0,"^",11)="W"&($P(PSOPAR,"^",12)) IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="    Method of Pickup: "_$G(^PSRX(RXN,"MP"))
"RTN","PSOORNE2",100,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(15)          Clinic: "_$S($D(^SC(+$P(RX0,"^",5),0)):$P(^SC($P(RX0,"^",5),0),"^"),1:"Not on File")
"RTN","PSOORNE2",101,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(16)        Division: "_$S($G(^PS(59,+$P(RX2,"^",9),0))]"":$P(^PS(59,$P(RX2,"^",9),0),"^")_" ("_$P(^(0),"^",6)_")",1:"UNKNOWN")
"RTN","PSOORNE2",102,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(17)      Pharmacist: "_$S($P(RX2,"^",3):$P(^VA(200,$P(RX2,"^",3),0),"^"),1:"")
"RTN","PSOORNE2",103,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(18)         Remarks:" D RMK^PSOORNE3
"RTN","PSOORNE2",104,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(19)      Counseling: "_$S($P($G(^PSRX(RXN,"PC")),"^"):"YES",1:"NO")_"                      "_$S($P($G(^PSRX(RXN,"PC")),"^"):"Was Counseling Understood: "_$S($P($G(^PSRX(RXN,"PC")),"^",2):"YES",1:"NO"),1:"")
"RTN","PSOORNE2",105,0)
 S:$O(^PSRX(RXN,1,0)) REF=1,IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(20)     Refill Data"
"RTN","PSOORNE2",106,0)
 I $$STATUS^PSOBPSUT(RXN,0)'="" D
"RTN","PSOORNE2",107,0)
 . N DAW S IEN=IEN+1,DAW=$$GETDAW^PSODAWUT(RXN,0)
"RTN","PSOORNE2",108,0)
 . S ^TMP("PSOAO",$J,IEN,0)="(21)        DAW Code: "_DAW_" - "_$$DAWEXT^PSSDAWUT(DAW)
"RTN","PSOORNE2",109,0)
 D DISP^PSOORNE6
"RTN","PSOORNE2",110,0)
 I $G(PSOBEDT),PSOACT["E" S PSOACT="E"
"RTN","PSOORNE2",111,0)
 I $G(PSOBEDT),PSOACT'["E" S PSOACT=""
"RTN","PSOORNE2",112,0)
 Q:$G(PSORXED)!($G(COPY))!($G(UPMI))
"RTN","PSOORNE2",113,0)
 S:$G(PSOBEDT) (PSOEDIT,PSORXED)=1
"RTN","PSOORNE2",114,0)
RENERR S PSORERR=0 D ^PSOLMLST ; I '$G(PSOLKFL) D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2))
"RTN","PSOORNE2",115,0)
 I PSORERR=1 S:$G(PSOBEDT) (PSOEDIT,PSORXED)=1 G RENERR
"RTN","PSOORNE2",116,0)
 K DRET,SIG
"RTN","PSOORNE2",117,0)
 Q
"RTN","PSOORNE2",118,0)
UL1 ;
"RTN","PSOORNE2",119,0)
 ;I +PSOLST(ORN)=52 D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) Q
"RTN","PSOORNE2",120,0)
 ;I $D(^PS(52.41,$P(PSOLST(ORN),"^",2),0)) D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)_"S")
"RTN","PSOORNE2",121,0)
 Q
"RTN","PSOORNEW")
0^29^B74656936
"RTN","PSOORNEW",1,0)
PSOORNEW ;BIR/SAB - display orders from oerr ;6/19/06 3:53pm
"RTN","PSOORNEW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,23,27,32,55,46,71,90,94,106,131,133,143,237,222,258,206,225,251**;DEC 1997;Build 202
"RTN","PSOORNEW",3,0)
 ;^PS(50.7 -2223
"RTN","PSOORNEW",4,0)
 ;^PSDRUG -221
"RTN","PSOORNEW",5,0)
 ;^PS(50.606 -2174
"RTN","PSOORNEW",6,0)
 ;^PS(55 -2228
"RTN","PSOORNEW",7,0)
 ;EN1^ORCFLAG -3620
"RTN","PSOORNEW",8,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5424
"RTN","PSOORNEW",9,0)
 ;
"RTN","PSOORNEW",10,0)
 ;PSO*237 quit Finish if Today > Issue date + 365
"RTN","PSOORNEW",11,0)
 ;
"RTN","PSOORNEW",12,0)
DSPL I $G(PSODSPL) S VALMBCK="Q" K PSODSPL,PSOANSQD Q
"RTN","PSOORNEW",13,0)
 Q:'$D(PSOLMC)  K ^TMP("PSOPO",$J) S PSOLMC=PSOLMC+1
"RTN","PSOORNEW",14,0)
 I $D(CLOZPAT) S PSONEW("DAYS SUPPLY")=$S($G(PSONEW("DAYS SUPPLY")):PSONEW("DAYS SUPPLY"),1:7) G OI
"RTN","PSOORNEW",15,0)
 S PSONEW("DAYS SUPPLY")=$S($G(PSONEW("DAYS SUPPLY")):PSONEW("DAYS SUPPLY"),+$G(^PS(55,PSODFN,"PS"))&($P(^PS(53,+$G(^PS(55,PSODFN,"PS")),0),"^",3))&('$G(PSONEW("DAYS SUPPLY"))):$P(^PS(53,+$G(^PS(55,PSODFN,"PS")),0),"^",3),1:30)
"RTN","PSOORNEW",16,0)
OI I '$G(PSODRUG("OI")) D
"RTN","PSOORNEW",17,0)
 .S (OI,PSODRUG("OI"))=$P(OR0,"^",8),PSODRUG("OIN")=$P(^PS(50.7,$P(OR0,"^",8),0),"^"),OID=$P(OR0,"^",9)
"RTN","PSOORNEW",18,0)
 .I $P($G(OR0),"^",9) S POERR=1,DREN=$P(OR0,"^",9) D DRG^PSOORDRG K POERR
"RTN","PSOORNEW",19,0)
 I '$D(CLOZPAT) I $G(PSODRUG("DEA"))["A",$G(PSODRUG("DEA"))'["B"!($G(PSODRUG("DEA"))["F") S PSONEW("# OF REFILLS")=0
"RTN","PSOORNEW",20,0)
 I $D(CLOZPAT) S PSONEW("# OF REFILLS")=$S($D(PSONEW("# OF REFILLS")):PSONEW("# OF REFILLS"),$G(CLOZPAT)=2&($P(OR0,"^",11)>2):3,$G(CLOZPAT)&($P(OR0,"^",11)>1):1,1:0)
"RTN","PSOORNEW",21,0)
 S IEN=0 D OBX^PSOORFI1,DIN^PSONFI(PSODRUG("OI"),$S($G(PSODRUG("IEN")):PSODRUG("IEN"),1:""))
"RTN","PSOORNEW",22,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="*(1) Orderable Item: "_$P(^PS(50.7,PSODRUG("OI"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")_NFIO
"RTN","PSOORNEW",23,0)
 S:NFIO["<DIN>" NFIO=IEN_","_($L(^TMP("PSOPO",$J,IEN,0))-4)
"RTN","PSOORNEW",24,0)
 K LST I $G(PSODRUG("NAME"))]"" D  G PT
"RTN","PSOORNEW",25,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (2)"_$S($D(^PSDRUG("AQ",PSODRUG("IEN"))):"      CMOP ",1:"           ")_"Drug: "_PSODRUG("NAME")_NFID
"RTN","PSOORNEW",26,0)
 .S:NFID["<DIN>" NFID=IEN_","_($L(^TMP("PSOPO",$J,IEN,0))-4)
"RTN","PSOORNEW",27,0)
 .I $P($G(^PSDRUG(PSODRUG("IEN"),0)),"^",10)]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="       Drug Message:" D DRGMSG
"RTN","PSOORNEW",28,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (2)           Drug: No Dispense Drug Selected"
"RTN","PSOORNEW",29,0)
PT D DOSE2^PSOORFI4
"RTN","PSOORNEW",30,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (4)   Pat Instruct:" D:$O(PSONEW("SIG",0)) INST^PSOORFI4
"RTN","PSOORNEW",31,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  Provider Comments:" S TY=3 D INST^PSOORFI1
"RTN","PSOORNEW",32,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="       Instructions:" S TY=2 D INST^PSOORFI1
"RTN","PSOORNEW",33,0)
 K PSOELSE S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="                SIG:"
"RTN","PSOORNEW",34,0)
 F I=0:0 S I=$O(SIG(I)) Q:'I  S SIG=SIG(I) D
"RTN","PSOORNEW",35,0)
 .F SG=1:1:$L(SIG) S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P(SIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",20)=" " S:$P(SIG," ",SG)'="" ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P(SIG," ",SG)
"RTN","PSOORNEW",36,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (5) Patient Status: "_$P($G(^PS(53,+PSONEW("PATIENT STATUS"),0)),"^")
"RTN","PSOORNEW",37,0)
 K PSOELSE I $G(PSONEW("ISSUE DATE"))']"" S PSOELSE=1 S IEN=IEN+1,(PSOID,Y)=$E($P(OR0,"^",6),1,7) X ^DD("DD") S PSONEW("ISSUE DATE")=Y,^TMP("PSOPO",$J,IEN,0)=" (4)     Issue Date: "_Y
"RTN","PSOORNEW",38,0)
 I '$G(PSOELSE) S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (6)     Issue Date: "_PSONEW("ISSUE DATE")
"RTN","PSOORNEW",39,0)
 K PSOELSE I $G(PSORX("FILL DATE"))']"" S PSOELSE=1 D
"RTN","PSOORNEW",40,0)
 .S (Y,PSORX("FILL DATE"))=$S($E($P(OR0,"^",6),1,7)<DT:DT,1:$E($P(OR0,"^",6),1,7)) X ^DD("DD") S PSONEW("FILL DATE")=Y,^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"                  (5) Fill Date: "_Y
"RTN","PSOORNEW",41,0)
 I '$G(PSOELSE) S Y=PSORX("FILL DATE") X ^DD("DD") S PSORX("FILL DATE")=Y,^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"       (7) Fill Date: "_PSORX("FILL DATE")
"RTN","PSOORNEW",42,0)
 I $P(OR0,"^",18) S IEN=IEN+1,Y=$P(OR0,"^",18) X ^DD("DD") S $P(^TMP("PSOPO",$J,IEN,0)," ",39)="Effective Date: "_Y
"RTN","PSOORNEW",43,0)
 I $D(CLOZPAT) D ELIG^PSOORFI2 S:'$D(PSONEW("QTY")) PSONEW("QTY")=0
"RTN","PSOORNEW",44,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (8)    Days Supply: "_PSONEW("DAYS SUPPLY")
"RTN","PSOORNEW",45,0)
 S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"               (9)   QTY"_$S($P($G(^PSDRUG(+$G(PSODRUG("IEN")),660)),"^",8)]"":" ("_$P($G(^PSDRUG(+PSODRUG("IEN"),660)),"^",8)_")",1:" (  )")
"RTN","PSOORNEW",46,0)
 S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_": "_$S($G(PSONEW("QTY"))]"":PSONEW("QTY"),1:$P(OR0,"^",10))
"RTN","PSOORNEW",47,0)
 I $P($G(^PSDRUG(+$G(PSODRUG("IEN")),5)),"^")]"" D
"RTN","PSOORNEW",48,0)
 .S $P(RN," ",79)=" ",IEN=IEN+1
"RTN","PSOORNEW",49,0)
 .S ^TMP("PSOPO",$J,IEN,0)=$E(RN,$L("QTY DSP MSG: "_$P(^PSDRUG(PSODRUG("IEN"),5),"^"))+1,79)_"QTY DSP MSG: "_$P(^PSDRUG(PSODRUG("IEN"),5),"^") K RN
"RTN","PSOORNEW",50,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="       Provider ordered "_+$P(OR0,"^",11)_" refills"
"RTN","PSOORNEW",51,0)
 D:$D(CLOZPAT) PQTY^PSOORFI4
"RTN","PSOORNEW",52,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(10)   # of Refills: "_$S($G(PSONEW("# OF REFILLS"))]"":PSONEW("# OF REFILLS"),1:$P(OR0,"^",11))_"               (11)   Routing: "_$S($G(PSONEW("MAIL/WINDOW"))="M":"MAIL",1:"WINDOW")
"RTN","PSOORNEW",53,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(12)         Clinic: "_PSORX("CLINIC")
"RTN","PSOORNEW",54,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(13)       Provider: "_PSONEW("PROVIDER NAME")
"RTN","PSOORNEW",55,0)
 I $P($G(^VA(200,$S($G(PSONEW("PROVIDER")):PSONEW("PROVIDER"),1:$P(OR0,"^",5)),"PS")),"^",7)&($P($G(^("PS")),"^",8)) D
"RTN","PSOORNEW",56,0)
 .S IEN=IEN+1,PSONEW("COSIGNING PROVIDER")=$S($G(PSONEW("COSIGNING PROVIDER")):PSONEW("COSIGNING PROVIDER"),1:$P(^("PS"),"^",8))
"RTN","PSOORNEW",57,0)
 .S ^TMP("PSOPO",$J,IEN,0)="       Cos-Provider: "_$P(^VA(200,PSONEW("COSIGNING PROVIDER"),0),"^")
"RTN","PSOORNEW",58,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(14)         Copies: "_$S($G(PSONEW("COPIES")):PSONEW("COPIES"),1:1)
"RTN","PSOORNEW",59,0)
 S PSONEW("REMARKS")=$S($G(PSONEW("REMARKS"))]"":PSONEW("REMARKS"),$P(OR0,"^",17)="C":"Administered in Clinic.",1:"")
"RTN","PSOORNEW",60,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(15)        Remarks:"
"RTN","PSOORNEW",61,0)
 I $G(PSONEW("REMARKS"))]"" D
"RTN","PSOORNEW",62,0)
 .F SG=1:1:$L(PSONEW("REMARKS")) S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P(PSONEW("REMARKS")," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",20)=" " D
"RTN","PSOORNEW",63,0)
 ..S:$P(PSONEW("REMARKS")," ",SG)'="" ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P(PSONEW("REMARKS")," ",SG)
"RTN","PSOORNEW",64,0)
 I $G(PSOSIGFL)!(PSODRUG("OI")'=$P(OR0,"^",8)) S PSONEW("CLERK CODE")=DUZ,PSORX("CLERK CODE")=$P(^VA(200,DUZ,0),"^"),VALMSG="This change will create a new prescription!"
"RTN","PSOORNEW",65,0)
 S $P(RN," ",35)=" ",IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="   Entry By: "_$P(^VA(200,PSONEW("CLERK CODE"),0),"^")_$E(RN,$L($P(^VA(200,PSONEW("CLERK CODE"),0),"^"))+1,35)
"RTN","PSOORNEW",66,0)
 S Y=$P(OR0,"^",12) X ^DD("DD") S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"Entry Date: "_$E($P(OR0,"^",12),4,5)_"/"_$E($P(OR0,"^",12),6,7)_"/"_$E($P(OR0,"^",12),2,3)_" "_$P(Y,"@",2) K RN
"RTN","PSOORNEW",67,0)
 I PSOLMC<2 D ^PSOLMPO1 S VALMBCK="Q",PSOLMC=0
"RTN","PSOORNEW",68,0)
 S:PSOLMC>1 VALMBCK="R"
"RTN","PSOORNEW",69,0)
 Q
"RTN","PSOORNEW",70,0)
ORCHK D PROVCOM^PSOORFI4,ORCHK^PSOORFI4
"RTN","PSOORNEW",71,0)
 Q
"RTN","PSOORNEW",72,0)
EDT D KV S DIR("A",1)="* Indicates which fields will create an new Order",DIR("A")="Select Field to Edit by number",DIR(0)="LO^1:15" D ^DIR Q:$D(DTOUT)!($D(DUOUT))
"RTN","PSOORNEW",73,0)
EDTSEL N LST,FLD,OUT D KV S OUT=0
"RTN","PSOORNEW",74,0)
 I +Y S LST=Y D FULL^VALM1 N PSODOSE M PSODOSE=PSONEW D  G DSPL
"RTN","PSOORNEW",75,0)
 .F FLD=1:1:$L(LST,",") Q:$P(LST,",",FLD)']""!(OUT)  D @(+$P(LST,",",FLD)) D:$P(LST,",",FLD)=8 REF D KV
"RTN","PSOORNEW",76,0)
 E  S VALMBCK="" Q
"RTN","PSOORNEW",77,0)
 Q
"RTN","PSOORNEW",78,0)
ACP ;
"RTN","PSOORNEW",79,0)
 I $G(ORD),+$P($G(^PS(52.41,+ORD,0)),"^",23)=1 D  Q:$D(DIRUT)!'Y  D EN1^ORCFLAG(+$P($G(^PS(52.41,ORD,0)),"^")) H 1
"RTN","PSOORNEW",80,0)
 . D FULL^VALM1 D KV
"RTN","PSOORNEW",81,0)
 . S DIR("A",1)="This Order is flagged. In order to finish it"
"RTN","PSOORNEW",82,0)
 . S DIR("A",2)="you must unflag it first."
"RTN","PSOORNEW",83,0)
 . S DIR("A",3)=""
"RTN","PSOORNEW",84,0)
 . S DIR(0)="Y",DIR("A")="Unflag Order",DIR("B")="NO"
"RTN","PSOORNEW",85,0)
 . W ! D ^DIR I $D(DIRUT)!'Y S VALMBCK="Q"
"RTN","PSOORNEW",86,0)
 I $G(ORD),+$P($G(^PS(52.41,+ORD,0)),"^",23)=1 Q
"RTN","PSOORNEW",87,0)
 ;
"RTN","PSOORNEW",88,0)
 I $D(CLOZPAT),+$G(PSONEW("QTY"))=0 S VALMSG="Unable to calculate the quantity, enter a quantity" G DSPL
"RTN","PSOORNEW",89,0)
 S (PSODIR("DFLG"),PSORX("DFLG"),PSODIR("QFLD"))=0,ACP=1 D ORCHK
"RTN","PSOORNEW",90,0)
 G:$G(PSONEW("QFLG")) DSPL
"RTN","PSOORNEW",91,0)
 I $G(PSODIR("DFLG"))!$G(PSORX("DFLG")) Q
"RTN","PSOORNEW",92,0)
 I $G(PSONEW("FLD"))!($G(PSODRUG("NAME"))']"")!('$O(SIG(0))) G DSPL
"RTN","PSOORNEW",93,0)
 I $G(PSODRUG("NAME"))]"",'$G(ORCHK)!($G(ORDRG)'=PSODRUG("NAME")) D  I $G(PSORX("DFLG")) D CLEAN^PSOVER1 G DSPL
"RTN","PSOORNEW",94,0)
 . D POST^PSODRG S:'$G(PSORX("DFLG")) ORCHK=1,ORDRG=PSODRUG("NAME")
"RTN","PSOORNEW",95,0)
 D:$$DS^PSSDSAPI&('$G(PSORX("DFLG"))) DOSCK^PSODOSUT("N") I $G(PSORX("DFLG")) D CLEAN^PSOVER1 G DSPL
"RTN","PSOORNEW",96,0)
 I '$D(PSONEW("RX #")) S PSOFROM="NEW",RTN=$S($P($G(PSOPAR),"^",7):"AUTO^PSONRXN",1:"MANUAL^PSONRXN") D @RTN Q:PSONEW("QFLG")  I '$P($G(PSOPAR),"^",7) S PSOX=PSONEW("RX #") D CHECK^PSONRXN
"RTN","PSOORNEW",97,0)
 D RXNCHK^PSOORNE1 I $G(PSONEW("QFLG")) S PSONEW("DFLG")=1 Q
"RTN","PSOORNEW",98,0)
 I DT>$$FMADD^XLFDT($P(OR0,"^",6),365) D EXPR^PSONEW2 G DSPL
"RTN","PSOORNEW",99,0)
 D STOP^PSONEW2,DISPLAY^PSONEW2,^PSONEWF
"RTN","PSOORNEW",100,0)
 I $G(PSOCPZ("DFLG")) W !!,"No action taken!",! K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to continue" D ^DIR,KV K PSOCPZ("DFLG"),DRET,PSOANSQD S VALMBCK="Q" Q
"RTN","PSOORNEW",101,0)
 ;
"RTN","PSOORNEW",102,0)
 K PSOCPZ("DFLG") D KV S DIR(0)="Y",DIR("A")="Are you sure you want to Accept this Order",DIR("B")="NO" D ^DIR I $D(DIRUT) D KV K DRET,PSOANSQ,PSOANSQD S VALMBCK="Q" Q
"RTN","PSOORNEW",103,0)
 D KV I 'Y K PSOANSQ G DSPL
"RTN","PSOORNEW",104,0)
 I $G(PSONEW("MAIL/WINDOW"))["W" D:$P($G(PSOPAR),"^",12)  S BINGCRT="Y",BINGRTE="W",PSORX("MAIL/WINDOW")="WINDOW" K RTN
"RTN","PSOORNEW",105,0)
 .W ! K DIR,DIRUT S DIR(0)="52,35O"
"RTN","PSOORNEW",106,0)
 .S:$G(PSORX("METHOD OF PICK-UP"))]"" DIR("B")=PSORX("METHOD OF PICK-UP") D ^DIR I $D(DIRUT) K DIR,DIRUT Q
"RTN","PSOORNEW",107,0)
 .S (PSONEW("METHOD OF PICK-UP"),PSORX("METHOD OF PICK-UP"))=Y K X,Y
"RTN","PSOORNEW",108,0)
 S PSONEW("POE")=1 D EN^PSON52(.PSONEW) G:$G(PSONEW("DFLG")) ABORT D DCORD^PSONEW2
"RTN","PSOORNEW",109,0)
 D NPSOSD^PSOUTIL(.PSONEW),FULL^VALM1 K PSORX("MAIL/WINDOW")
"RTN","PSOORNEW",110,0)
 D EOJ^PSONEW
"RTN","PSOORNEW",111,0)
ABORT S VALMBCK="Q",DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to Continue" D ^DIR,CLEAN^PSOVER1,KV
"RTN","PSOORNEW",112,0)
 Q
"RTN","PSOORNEW",113,0)
KV K DIRUT,DUOUT,DTOUT,DIR
"RTN","PSOORNEW",114,0)
 Q
"RTN","PSOORNEW",115,0)
REF D REF^PSOORFI4
"RTN","PSOORNEW",116,0)
 Q
"RTN","PSOORNEW",117,0)
1 N PSOBDR,PSOBDRG S PSOBDRG=1 D 1^PSOORNW2 Q  ;oi
"RTN","PSOORNEW",118,0)
 ;
"RTN","PSOORNEW",119,0)
4 D INS^PSOORNW2 Q
"RTN","PSOORNEW",120,0)
 ;
"RTN","PSOORNEW",121,0)
3 D DOSE^PSOORED4(.PSONEW) Q
"RTN","PSOORNEW",122,0)
 ;
"RTN","PSOORNEW",123,0)
6 D 4^PSOORNW2 Q  ;idt
"RTN","PSOORNEW",124,0)
 ;
"RTN","PSOORNEW",125,0)
7 D 5^PSOORNW2 Q  ;fdt
"RTN","PSOORNEW",126,0)
 ;
"RTN","PSOORNEW",127,0)
5 D 3^PSOORNW2 Q  ;pstat
"RTN","PSOORNEW",128,0)
 ;
"RTN","PSOORNEW",129,0)
13 D 12^PSOORNW2 Q  ;doc
"RTN","PSOORNEW",130,0)
 ;
"RTN","PSOORNEW",131,0)
12 D 11^PSOORNW2 Q  ;cli
"RTN","PSOORNEW",132,0)
 ;
"RTN","PSOORNEW",133,0)
2 N PSOCSIG I '$G(PSOBDRG) N PSOBDR,PSOBDRG S PSOBDRG=1
"RTN","PSOORNEW",134,0)
 D 2^PSOORNW1 Q:$G(PSOQFLG)  D EN^PSODIAG  ;drg/ICD
"RTN","PSOORNEW",135,0)
 I $G(PSOCSIG) K PSOCSIG G 3
"RTN","PSOORNEW",136,0)
 Q
"RTN","PSOORNEW",137,0)
 ;
"RTN","PSOORNEW",138,0)
9 D 8^PSOORNW2 Q  ;qty
"RTN","PSOORNEW",139,0)
 ;
"RTN","PSOORNEW",140,0)
8 D 7^PSOORNW2 Q  ;ds
"RTN","PSOORNEW",141,0)
 ;
"RTN","PSOORNEW",142,0)
10 D 9^PSOORNW2 Q  ;#rfs
"RTN","PSOORNEW",143,0)
 ;
"RTN","PSOORNEW",144,0)
14 D 13^PSOORNW2 Q  ;cop
"RTN","PSOORNEW",145,0)
 ;
"RTN","PSOORNEW",146,0)
11 D 10^PSOORNW2 Q  ;m/w
"RTN","PSOORNEW",147,0)
 ;
"RTN","PSOORNEW",148,0)
15 D 14^PSOORNW2 Q  ;rem
"RTN","PSOORNEW",149,0)
 ;
"RTN","PSOORNEW",150,0)
DRGMSG ;
"RTN","PSOORNEW",151,0)
 F SG=1:1:$L($P(^PSDRUG(PSODRUG("IEN"),0),"^",10)) S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P($P(^PSDRUG(PSODRUG("IEN"),0),"^",10)," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",20)=" " D
"RTN","PSOORNEW",152,0)
 .S:$P($P(^PSDRUG(PSODRUG("IEN"),0),"^",10)," ",SG)'="" ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P($P(^PSDRUG(PSODRUG("IEN"),0),"^",10)," ",SG)
"RTN","PSOORNEW",153,0)
 K SG
"RTN","PSOORNEW",154,0)
 Q
"RTN","PSOORNEW",155,0)
 ;
"RTN","PSOORNW1")
0^50^B44316879
"RTN","PSOORNW1",1,0)
PSOORNW1 ;ISC BHAM/SAB - continuation of finish of new order ;5/10/07 8:30am
"RTN","PSOORNW1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**23,46,78,117,131,133,172,148,222,268,206,251**;DEC 1997;Build 202
"RTN","PSOORNW1",3,0)
 ;Reference ^YSCL(603.01 supported by DBIA 2697
"RTN","PSOORNW1",4,0)
 ;Reference ^PS(55 supported by DBIA 2228
"RTN","PSOORNW1",5,0)
 ;Reference ^PSDRUG( supported by DBIA 221
"RTN","PSOORNW1",6,0)
 ;Reference to $$GETNDC^PSSNDCUT supported by IA 4707
"RTN","PSOORNW1",7,0)
 ;
"RTN","PSOORNW1",8,0)
2 I $G(ORD) D
"RTN","PSOORNW1",9,0)
 .S INST=0 F  S INST=$O(^PS(52.41,ORD,2,INST)) Q:'INST  S (MIG,INST(INST))=^PS(52.41,ORD,2,INST,0) D
"RTN","PSOORNW1",10,0)
 ..W !!,"Instructions: "
"RTN","PSOORNW1",11,0)
 ..F SG=1:1:$L(MIG," ") W:$X+$L($P(MIG," ",SG)_" ")>IOM !?14 W $P(MIG," ",SG)_" "
"RTN","PSOORNW1",12,0)
 .S:'$D(PSODRUG("OI")) PSODRUG("OI")=$P(OR0,"^",8)
"RTN","PSOORNW1",13,0)
 .K INST,TY,MIG,SG
"RTN","PSOORNW1",14,0)
 S (PSDC,PSI)=0 W !!,"The following Drug(s) are available for selection:"
"RTN","PSOORNW1",15,0)
 F PSI=0:0 S PSI=$O(^PSDRUG("ASP",PSODRUG("OI"),PSI)) Q:'PSI  I $S('$D(^PSDRUG(PSI,"I")):1,'^("I"):1,DT'>^("I"):1,1:0),$S($P($G(^PSDRUG(PSI,2)),"^",3)'["O":0,1:1) D
"RTN","PSOORNW1",16,0)
 .S PSDC=PSDC+1 W !,PSDC_". "_$P(^PSDRUG(PSI,0),"^")_$S($P(^(0),"^",9):"     (N/F)",1:"")
"RTN","PSOORNW1",17,0)
 .S PSDC(PSDC)=PSI
"RTN","PSOORNW1",18,0)
 I PSDC=0 D
"RTN","PSOORNW1",19,0)
 . N X,DRG
"RTN","PSOORNW1",20,0)
 . S DRG=+$P($G(^PS(52.41,+$G(ORD),0)),"^",9)
"RTN","PSOORNW1",21,0)
 . S X=$$GET1^DIQ(50,DRG,100)
"RTN","PSOORNW1",22,0)
 . I X'="",(DT>X) D
"RTN","PSOORNW1",23,0)
 . . W !!,"   This Dispense Drug is now Inactive. You may select a"
"RTN","PSOORNW1",24,0)
 . . W !,"    new Orderable Item, or you can enter a new Order with"
"RTN","PSOORNW1",25,0)
 . . W !,"    an Active Drug.",!
"RTN","PSOORNW1",26,0)
 . E  W !!,"No drugs available!",!
"RTN","PSOORNW1",27,0)
 . K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press return to continue"
"RTN","PSOORNW1",28,0)
 . D ^DIR K DIR
"RTN","PSOORNW1",29,0)
 G:'PSDC ETX I $G(PSOBDRG),'$D(PSOBDR) M PSOBDR=PSODRUG
"RTN","PSOORNW1",30,0)
 I PSDC'=1 D
"RTN","PSOORNW1",31,0)
 .I $P($G(^PSDRUG(+$G(PSODRUG("IEN")),2)),"^")=$G(PSODRUG("OI")) Q
"RTN","PSOORNW1",32,0)
 .K PSODRUG("NAME"),PSODRUG("IEN")
"RTN","PSOORNW1",33,0)
 W ! D KV S DIR(0)="N^1:"_PSDC,DIR("A")="Select Drug by number" D ^DIR
"RTN","PSOORNW1",34,0)
 I $D(DIRUT) S OUT=1 G EX
"RTN","PSOORNW1",35,0)
 D KV K PSOY S PSOY=PSDC(Y),PSOY(0)=^PSDRUG(PSOY,0),PSOCSIG=0
"RTN","PSOORNW1",36,0)
 I $G(PSOBDR("IEN")),PSOBDR("IEN")'=+PSOY D:$G(ORD)  G:$D(DIRUT) EX
"RTN","PSOORNW1",37,0)
 .D KV S DIR(0)="Y",DIR("B")="YES",DIR("A",1)="You have changed the dispense drug from",DIR("A",2)=PSOBDR("NAME")_" to "_$P(^PSDRUG(+PSOY,0),"^")_".",DIR("A")="Do You want to Edit the SIG"
"RTN","PSOORNW1",38,0)
 .D ^DIR I $D(DIRUT) S OUT=1 Q
"RTN","PSOORNW1",39,0)
 .S:Y PSOCSIG=1
"RTN","PSOORNW1",40,0)
 .I 'Y D URX I $D(DIRUT) S OUT=1 Q
"RTN","PSOORNW1",41,0)
 D KV
"RTN","PSOORNW1",42,0)
CT1 I $P($G(^PSDRUG(PSOY,"CLOZ1")),"^")="PSOCLO1",'$O(^YSCL(603.01,"C",PSODFN,0)) D  Q
"RTN","PSOORNW1",43,0)
 .S VALMSG="Patient Not Registered in Clozapine Program",VALMBCK="Q" K PSOY,PSDC
"RTN","PSOORNW1",44,0)
 I $G(ORD) S ^TMP("PSORXPO",$J,ORD,0)=1
"RTN","PSOORNW1",45,0)
 S PSODRUG("IEN")=+PSOY,PSODRUG("VA CLASS")=$P(PSOY(0),"^",2),PSODRUG("NAME")=$P(PSOY(0),"^")
"RTN","PSOORNW1",46,0)
 S PSODRUG("NDF")=$S($G(^PSDRUG(+PSOY,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)
"RTN","PSOORNW1",47,0)
 S PSODRUG("MAXDOSE")=$P(PSOY(0),"^",4),PSODRUG("DEA")=$P(PSOY(0),"^",3),PSODRUG("CLN")=$S($D(^PSDRUG(+PSOY,"ND")):+$P(^("ND"),"^",6),1:0)
"RTN","PSOORNW1",48,0)
 S PSODRUG("SIG")=$P(PSOY(0),"^",5),PSODRUG("NDC")=$$GETNDC^PSSNDCUT(+PSOY,$G(PSOSITE)),PSODRUG("STKLVL")=$G(^PSDRUG(+PSOY,660.1))
"RTN","PSOORNW1",49,0)
 S PSODRUG("DAW")=+$$GET1^DIQ(50,+PSOY,81)
"RTN","PSOORNW1",50,0)
 ;I $G(^PSDRUG(+PSOY,660))']"" D:'$G(PSOFIN)&('$G(PSOCOPY)) POST^PSODRG G ETX
"RTN","PSOORNW1",51,0)
 S PSOX1=$G(^PSDRUG(+PSOY,660)),PSODRUG("COST")=$P($G(PSOX1),"^",6),PSODRUG("UNIT")=$P($G(PSOX1),"^",8),PSODRUG("EXPIRATION DATE")=$P($G(PSOX1),"^",9)
"RTN","PSOORNW1",52,0)
 ;D:'$G(PSOFIN)&('$G(PSOCOPY)) POST^PSODRG
"RTN","PSOORNW1",53,0)
 I $G(PSORX("DFLG")) K PSODRUG N LST Q:$G(PSOAC)!($G(NEWEDT))  D DSPL^PSOORFI1 S VALMBCK="Q" Q
"RTN","PSOORNW1",54,0)
ETX D REF S VALMBCK="R" I 'PSDC S VALMSG="NO dispense drugs tied to this orderable item!" S PSOQFLG=1
"RTN","PSOORNW1",55,0)
TX D KV K PSDC,PSI,X,Y,PSOX1,PSOY
"RTN","PSOORNW1",56,0)
 Q
"RTN","PSOORNW1",57,0)
EX M PSODRUG=PSOBDR K PSOBDR,PSOBDRG S PSOQFLG=1,VALMBCK="R" D MP1^PSOOREDX
"RTN","PSOORNW1",58,0)
 D TX Q
"RTN","PSOORNW1",59,0)
URX D KV S DIR(0)="Y",DIR("A")="Are You Sure You Want to Update Rx",DIR("B")="Yes"
"RTN","PSOORNW1",60,0)
 D ^DIR S:$D(DIRUT)!('Y) DIRUT=1
"RTN","PSOORNW1",61,0)
 I Y S ^TMP("PSORXPO",$J,ORD,0)=1 ;screens 4 order checks
"RTN","PSOORNW1",62,0)
 Q
"RTN","PSOORNW1",63,0)
REF Q:'$D(PSODRUG("DEA"))!('$G(PSODRUG("IEN")))!('$G(^PS(55,PSODFN,"PS")))
"RTN","PSOORNW1",64,0)
 S PSONEW("CS")=0,PTRF=$S(+$G(^PS(55,PSODFN,"PS"))&($P(^PS(53,+$G(^PS(55,PSODFN,"PS")),0),"^",4)]""):$P(^PS(53,+$G(^PS(55,PSODFN,"PS")),0),"^",4),1:5)
"RTN","PSOORNW1",65,0)
 F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S $P(PSONEW("CS"),"^")=1 S:$E(+PSODRUG("DEA"),DEA)=2 $P(PSONEW("CS"),"^",2)=1
"RTN","PSOORNW1",66,0)
 I $P($G(PSONEW("CS")),"^",2)=1 S PSONEW("# OF REFILLS")=0 Q
"RTN","PSOORNW1",67,0)
 I +PSONEW("CS") D
"RTN","PSOORNW1",68,0)
 .S PSOX=$S($P($G(OR0),"^",11)>5:5,1:+$P($G(OR0),"^",11))
"RTN","PSOORNW1",69,0)
 .S PSOX=$S(PSOX>PTRF:PTRF,1:PSOX)
"RTN","PSOORNW1",70,0)
 .S PSONEW("# OF REFILLS")=PSOX
"RTN","PSOORNW1",71,0)
 E  D
"RTN","PSOORNW1",72,0)
 .S PSOX=$S($P($G(OR0),"^",11)'>PTRF&($P($G(OR0),"^",11)'>11):11,1:PTRF)
"RTN","PSOORNW1",73,0)
 I '$D(CLOZPAT) I PSODRUG("DEA")["A"&(PSODRUG("DEA")'["B")!(PSODRUG("DEA")["F")!(PSODRUG("DEA")[1)!(PSODRUG("DEA")[2) S PSOX=0,PSONEW("# OF REFILLS")=0 K PSDY,PSDY1,PTRF Q
"RTN","PSOORNW1",74,0)
 I $D(CLOZPAT) S (PSOX,PSONEW("N# REF"),PSONEW("# OF REFILLS"))=$S(CLOZPAT=2&($G(PSONEW("# OF REFILLS"))>2):3,CLOZPAT&($G(PSONEW("# OF REFILLS"))>1):1,1:0),PSONEW("DAYS SUPPLY")=7,ORCHK=1 K PSDY,PSDY1,PTRF Q
"RTN","PSOORNW1",75,0)
 S PSONEW("# OF REFILLS")=$S($G(PSONEW("# OF REFILLS"))'="":$G(PSONEW("# OF REFILLS")),1:PSOX) K PSDY,PSDY1,PTRF
"RTN","PSOORNW1",76,0)
 Q
"RTN","PSOORNW1",77,0)
EDNEW K PSMAX,PSFMAX F DEA=1:1 Q:$E(PSODEA,DEA)=""  I $E(+PSODEA,DEA)>1,$E(+PSODEA,DEA)<6 S CS=1
"RTN","PSOORNW1",78,0)
 I CS D
"RTN","PSOORNW1",79,0)
 .S PSOX1=$S(PTRF>5:5,1:PTRF),PSOX=$S(PSOX1=5:5,1:PSOX1)
"RTN","PSOORNW1",80,0)
 .S PSOX=$S('PSOX:0,PSDAYS=90:1,1:PSOX),PSDY1=$S(PSDAYS<60:5,PSDAYS'<60&(PSDAYS'>89):2,PSDAYS=90:1,1:0) S MAX=$S(PSOX'>PSDY1:PSOX,1:PSDY1)
"RTN","PSOORNW1",81,0)
 E  D
"RTN","PSOORNW1",82,0)
 .S PSOX1=PTRF,PSOX=$S(PSOX1=11:11,1:PSOX1),PSOX=$S('PSOX:0,PSDAYS=90:3,1:PSOX)
"RTN","PSOORNW1",83,0)
 .S PSDY1=$S(PSDAYS<60:11,PSDAYS'<60&(PSDAYS'>89):5,PSDAYS=90:3,1:0) S MAX=$S(PSOX'>PSDY1:PSOX,1:PSDY1)
"RTN","PSOORNW1",84,0)
 I PSRF>MAX D
"RTN","PSOORNW1",85,0)
 .W $C(7),!!,PSRF_" refills are not correct for a "_PSDAYS_" day supply.",!,"Please enter correct # of refills for a "_PSDAYS_" day supply. Max refills allowed is "_MAX_".",!
"RTN","PSOORNW1",86,0)
 .S (PSMAX("MAX"),PSFMAX("MAX"))=MAX,(PSMAX("RF"),PSFMAX("RF"))=PSRF,(PSMAX("DAYS"),PSFMAX("DAYS"))=PSDAYS,(PSMAX,PSFMAX)=1
"RTN","PSOORNW1",87,0)
 K PSTMAX D EDSTAT
"RTN","PSOORNW1",88,0)
 Q
"RTN","PSOORNW1",89,0)
STATDAY K PSMAX,PSRMAX,PSFMAX,PSTMAX S PSDAYS=$P(^PSRX(DA,0),"^",8),PSRF=$P(^PSRX(DA,0),"^",9),PTST=$P(^PS(53,X,0),"^"),PTDY=$P(^(0),"^",3),PTRF=$P(^(0),"^",4)
"RTN","PSOORNW1",90,0)
EDSTAT I PSRF>PTRF W !,$C(7),PSRF_" refills are greater than "_PTRF_" allowed for "_$P(PTST,"^")_" Rx Patient Status.",! S PSTMAX=1,PSTMAX("PTRF")=PTRF,PSTMAX("PSRF")=PSRF,PSTMAX("PT")=$P(PTST,"^")
"RTN","PSOORNW1",91,0)
 Q
"RTN","PSOORNW1",92,0)
OERF S DIR(0)="N^0:"_PSOX,DIR("A")="# OF REFILLS"
"RTN","PSOORNW1",93,0)
 S DIR("B")=$S($G(POERR):PSONEW("# OF REFILLS"),$G(PSONEW("N# REF"))]"":PSONEW("N# REF"),$G(PSONEW("# OF REFILLS"))]"":PSONEW("# OF REFILLS"),$G(PSOX1)]""&(PSOX>PSOX1):PSOX1,1:PSOX)
"RTN","PSOORNW1",94,0)
 S DIR("?")="Enter a whole number.  The maximum is set by the Rx Patient Status because there is no Dispense Drug."
"RTN","PSOORNW1",95,0)
 D ^DIR G:$D(DIRUT) REFX
"RTN","PSOORNW1",96,0)
 S (PSONEW("N# REF"),PSONEW("# OF REFILLS"))=Y
"RTN","PSOORNW1",97,0)
REFX S:'$D(PSONEW("# OF REFILLS")) PSONEW("# OF REFILLS")=$S($G(PSONEW("N# REF"))]"":PSONEW("N# REF"),$G(PSOX1)]""&($G(PSOX)>PSOX1):PSOX1,1:PSOX)
"RTN","PSOORNW1",98,0)
 K X,Y,PSOX,PSOX1,PSDY,PSDY1,DEA
"RTN","PSOORNW1",99,0)
KV K DIR,DIRUT,DUOUT,DTOUT
"RTN","PSOORNW1",100,0)
 Q
"RTN","PSOORNW2")
0^70^B45717814
"RTN","PSOORNW2",1,0)
PSOORNW2 ;ISC-BHAM/SAB - edit orders from oerr ; 6/28/07 11:36am
"RTN","PSOORNW2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**10,23,37,46,117,131,133,148,222,269,206,251**;DEC 1997;Build 202
"RTN","PSOORNW2",3,0)
 ;Reference to ^YSCL(603.01 supported by DBIA 2697
"RTN","PSOORNW2",4,0)
 ;Reference to ^PS(55 supported by DBIA 2228
"RTN","PSOORNW2",5,0)
 ;Reference to ^PSDRUG( supported by DBIA 221
"RTN","PSOORNW2",6,0)
 ;Reference to ^PS(50.606 supported by DBIA 2174
"RTN","PSOORNW2",7,0)
 ;Reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSOORNW2",8,0)
 ;Reference to $$GETNDC^PSSNDCUT supported by IA 4707
"RTN","PSOORNW2",9,0)
 ;
"RTN","PSOORNW2",10,0)
1 I $G(PSODRUG("OI")) M:$G(PSOBDRG) PSOBDR=PSODRUG W !!,"Current Orderable Item: "_$P(^PS(50.7,PSODRUG("OI"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSOORNW2",11,0)
 S DIC("B")=$S($G(PSODRUG("OIN"))]"":PSODRUG("OIN"),1:""),DIC="^PS(50.7,",DIC(0)="AEMQZ"
"RTN","PSOORNW2",12,0)
 S DIC("S")="I '$P(^PS(50.7,+Y,0),""^"",4)!($P(^(0),""^"",4)'<DT) N PSOF,PSOL S (PSOF,PSOL)=0 F  S PSOL=$O(^PSDRUG(""ASP"",+Y,PSOL)) Q:PSOF!'PSOL  "
"RTN","PSOORNW2",13,0)
 S DIC("S")=DIC("S")_"I $P($G(^PSDRUG(PSOL,2)),U,3)[""O"",'$G(^(""I""))!($G(^(""I""))'<DT) S PSOF=1"
"RTN","PSOORNW2",14,0)
 ;BHW;PSO*7*269;Modify ^DIC call to call MIX^DIC to use only the B and C Cross-References.
"RTN","PSOORNW2",15,0)
 S D="B^C" D MIX^DIC1 K DIC,D I X["^"!($D(DTOUT)) S OUT=1 Q
"RTN","PSOORNW2",16,0)
 S PSOY=Y
"RTN","PSOORNW2",17,0)
 I +Y'=OI D  I 'Y!($D(DIRUT)) D KV,MP1^PSOOREDX K DIC,Y,PSOY S OUT=1 Q
"RTN","PSOORNW2",18,0)
 .D KV S DIR(0)="Y",DIR("B")="NO",DIR("A",1)="",DIR("A")="This edit will create a new order.  Do you want to continue" D ^DIR
"RTN","PSOORNW2",19,0)
 G:Y<1 1 S PSODRUG("OI")=+PSOY,PSODRUG("OIN")=$P(PSOY,"^",2),PSONEW("CLERK CODE")=DUZ D KV K DIC,PSOY
"RTN","PSOORNW2",20,0)
 N PSOIC S PSOIC=1 D DREN
"RTN","PSOORNW2",21,0)
 D 2^PSOORNEW Q
"RTN","PSOORNW2",22,0)
4 S PSONEW("FLD")=1 D ISSDT^PSODIR2(.PSONEW) ; Issue Date
"RTN","PSOORNW2",23,0)
 I PSOID>PSONEW("FILL DATE") S PSONEW("FILL DATE")=PSOID,PSORX("FILL DATE")=PSORX("ISSUE DATE")
"RTN","PSOORNW2",24,0)
 Q
"RTN","PSOORNW2",25,0)
 ;
"RTN","PSOORNW2",26,0)
5 S PSONEW("FLD")=2 D FILLDT^PSODIR2(.PSONEW) ; Fill date
"RTN","PSOORNW2",27,0)
 Q
"RTN","PSOORNW2",28,0)
 ;
"RTN","PSOORNW2",29,0)
INS S PSONEW("FLD")=114 D INS^PSODIR(.PSONEW) ; Pat Inst
"RTN","PSOORNW2",30,0)
 I $P($G(^PS(55,PSODFN,"LAN")),"^") D SINS^PSODIR(.PSONEW)
"RTN","PSOORNW2",31,0)
 Q
"RTN","PSOORNW2",32,0)
 ;
"RTN","PSOORNW2",33,0)
3 S PSONEW("FLD")=3 D PTSTAT^PSODIR1(.PSONEW) ; Get Patient Status
"RTN","PSOORNW2",34,0)
 I +$G(^PS(55,PSODFN,"PS")) S RXPT=+^("PS") I $G(^PS(53,RXPT,0))]"" D  Q
"RTN","PSOORNW2",35,0)
 .S PSONEW("# OF REFILLS")=$S(+$P(OR0,"^",11)>+$P(^PS(53,RXPT,0),"^",4):+$P(^PS(53,RXPT,0),"^",4),1:+$P(OR0,"^",11)),PSOMAX=+$P(^PS(53,RXPT,0),"^",4)
"RTN","PSOORNW2",36,0)
 .S PSOMAX=$S($G(PSOCS):5,1:11),PSOMAX=$S(PSOMAX>+$P(^PS(53,RXPT,0),"^",4):+$P(^PS(53,RXPT,0),"^",4),1:PSOMAX)
"RTN","PSOORNW2",37,0)
 .S PSONEW("# OF REFILLS")=$S(PSONEW("# OF REFILLS")>PSOMAX:PSOMAX,1:PSONEW("# OF REFILLS"))
"RTN","PSOORNW2",38,0)
 I $G(PSOMAX) S PSONEW("# OF REFILLS")=$S(+$P(OR0,"^",11)>PSOMAX:PSOMAX,1:+$P(OR0,"^",11))
"RTN","PSOORNW2",39,0)
 I $G(PSODRUG("DEA"))["A"&($G(PSODRUG("DEA"))'["B")!($G(PSODRUG("DEA"))["F")!($G(PSODRUG("DEA"))[1)!($G(PSODRUG("DEA"))[2) D
"RTN","PSOORNW2",40,0)
 .S PSONEW("# OF REFILLS")=0,VALMSG="No refills allowed on "_$S(PSODRUG("DEA")["A":"this narcotic drug.",1:"this drug.")
"RTN","PSOORNW2",41,0)
 Q
"RTN","PSOORNW2",42,0)
 ;
"RTN","PSOORNW2",43,0)
12 S PSONEW("FLD")=4 D PROV^PSODIR(.PSONEW) ; Get Provider
"RTN","PSOORNW2",44,0)
 Q
"RTN","PSOORNW2",45,0)
 ;
"RTN","PSOORNW2",46,0)
11 S PSONEW("FLD")=5 D CLINIC^PSODIR2(.PSONEW) ; Get Clinic
"RTN","PSOORNW2",47,0)
 Q
"RTN","PSOORNW2",48,0)
 ;
"RTN","PSOORNW2",49,0)
8 S PSONEW("FLD")=7 D QTY^PSODIR1(.PSONEW) ; Get quantity
"RTN","PSOORNW2",50,0)
 Q
"RTN","PSOORNW2",51,0)
 ;
"RTN","PSOORNW2",52,0)
7 I '$G(PSODRUG("IEN")) W $C(7),!!,"No Dispense Drug!",! K DIR,DUOUT,DIRUT,DTOUT D 2^PSOORNW1
"RTN","PSOORNW2",53,0)
 I '$G(PSODRUG("IEN")) W !,$C(7),"No Dispense Drug Selected! A new Orderable Item may need to be selected.",! Q
"RTN","PSOORNW2",54,0)
 S PSONEW("FLD")=8 D DAYS^PSODIR1(.PSONEW) ; Get days supply
"RTN","PSOORNW2",55,0)
 Q:'$G(PSONEW("PATIENT STATUS"))
"RTN","PSOORNW2",56,0)
 K PSDY,PSDY1,PSMAX,PSTMAX S PSDAYS=PSONEW("DAYS SUPPLY"),PSRF=PSONEW("# OF REFILLS"),PTST=$P(^PS(53,PSONEW("PATIENT STATUS"),0),"^"),PTDY=$P(^(0),"^",3),PTRF=$P(^(0),"^",4),PSODEA=PSODRUG("DEA"),CS=0 ;D EDNEW^PSOORNW1
"RTN","PSOORNW2",57,0)
 Q
"RTN","PSOORNW2",58,0)
9 ;
"RTN","PSOORNW2",59,0)
 I '$G(PSONEW("PATIENT STATUS")) W !!,"Rx Patient Status required!",! D 3 I '$G(PSONEW("PATIENT STATUS")) S VALMSG="Rx Patient Status required!",VALMBCK="R" Q
"RTN","PSOORNW2",60,0)
 I +$G(^PS(55,PSODFN,"PS")) S RXPT=+^("PS") I $G(^PS(53,RXPT,0))]"" D  G ASK
"RTN","PSOORNW2",61,0)
 .S PSOMAX=$S($G(CLOZPAT)=2:3,$G(CLOZPAT)=1:1,$G(CLOZPAT)=0:0,1:+$P(^PS(53,RXPT,0),"^",4)) K RXPT
"RTN","PSOORNW2",62,0)
 .S:'$G(PSONEW("# OF REFILLS")) PSONEW("# OF REFILLS")=$S(+$P(OR0,"^",11)>PSOMAX:PSOMAX,1:+$P(OR0,"^",11))
"RTN","PSOORNW2",63,0)
 .S (PSONEW("N# REF"),PSONEW("# OF REFILLS"))=$S(PSONEW("# OF REFILLS")>PSOMAX:PSOMAX,1:PSONEW("# OF REFILLS"))
"RTN","PSOORNW2",64,0)
 .I '$D(CLOZPAT) I $G(PSODRUG("DEA"))["A"&($G(PSODRUG("DEA"))'["B")!($G(PSODRUG("DEA"))["F")!($G(PSODRUG("DEA"))[1)!($G(PSODRUG("DEA"))[2) D  Q
"RTN","PSOORNW2",65,0)
 ..S (PSOMAX,PSONEW("N# REF"),PSONEW("# OF REFILLS"))=0,VALMSG="No refills allowed on "_$S(PSODRUG("DEA")["A":"this narcotic drug.",1:"this drug.")
"RTN","PSOORNW2",66,0)
 .I $D(PSODRUG("DEA")) F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S PSOMAX=5
"RTN","PSOORNW2",67,0)
 I '$D(CLOZPAT) I $G(PSODRUG("DEA"))["A"&($G(PSODRUG("DEA"))'["B")!($G(PSODRUG("DEA"))["F")!($G(PSODRUG("DEA"))[1)!($G(PSODRUG("DEA"))[2) D  Q
"RTN","PSOORNW2",68,0)
 .S (PSONEW("N# REF"),PSONEW("# OF REFILLS"))=0,VALMSG="No refills allowed on "_$S(PSODRUG("DEA")["A":"this narcotic drug.",1:"this drug.")
"RTN","PSOORNW2",69,0)
 S (PSONEW("N# REF"),PSOMAX,PSONEW("# OF REFILLS"))=+$P(OR0,"^",11)
"RTN","PSOORNW2",70,0)
ASK S PSONEW("FLD")=9 D REFILL^PSODIR1(.PSONEW) ; Get # of refills
"RTN","PSOORNW2",71,0)
 K PSOMAX,PSMAX,PSTMAX S PSDAYS=PSONEW("DAYS SUPPLY"),PSRF=PSONEW("# OF REFILLS"),PTST=$P(^PS(53,PSONEW("PATIENT STATUS"),0),"^"),PTDY=$P(^(0),"^",3),PTRF=$P(^(0),"^",4),PSODEA=$G(PSODRUG("DEA")),CS=0 D EDNEW^PSOORNW1
"RTN","PSOORNW2",72,0)
 Q
"RTN","PSOORNW2",73,0)
 ;
"RTN","PSOORNW2",74,0)
6 Q  K DA S PSONEW("FLD")=10 D SIG^PSODIR1(.PSONEW) ; Get sig
"RTN","PSOORNW2",75,0)
 I $G(PSONEW("SIG"))]"" D EN^PSOSIGNO(ORD,PSONEW("SIG")) S SIG(1)=PSONEW("SIG")
"RTN","PSOORNW2",76,0)
 I $G(PSOSIGFL) D
"RTN","PSOORNW2",77,0)
 .K DIRUT,DUOUT,DTOUT,DIR S DIR(0)="Y",DIR("B")="NO",DIR("A",1)="",DIR("A")="This edit will create a new order.  Do you want to continue" D ^DIR
"RTN","PSOORNW2",78,0)
 .I 'Y!($D(DIRUT)) K DIR,DIRUT,DUOUT,DTOUT,DIC,Y,PSOSIGFL,PSONEW("SIG") S SIGOK=1
"RTN","PSOORNW2",79,0)
 S PSONEW("CLERK CODE")=DUZ K DIR,DIRUT,DUOUT,DTOUT,DIC,Y
"RTN","PSOORNW2",80,0)
 Q
"RTN","PSOORNW2",81,0)
 ;
"RTN","PSOORNW2",82,0)
13 S PSONEW("FLD")=11 D COPIES^PSODIR1(.PSONEW) ; Get # of copies
"RTN","PSOORNW2",83,0)
 Q
"RTN","PSOORNW2",84,0)
 ;
"RTN","PSOORNW2",85,0)
10 S PSONEW("FLD")=12 D MW^PSODIR2(.PSONEW) ; Get Mail/Window Info
"RTN","PSOORNW2",86,0)
 Q
"RTN","PSOORNW2",87,0)
 ;
"RTN","PSOORNW2",88,0)
14 S PSONEW("FLD")=13 D RMK^PSODIR2(.PSONEW) ; Get Remarks
"RTN","PSOORNW2",89,0)
 Q
"RTN","PSOORNW2",90,0)
DREN ;
"RTN","PSOORNW2",91,0)
 N PSDC,PSI S (PSDC,PSI)=0
"RTN","PSOORNW2",92,0)
 F  S PSI=$O(^PSDRUG("ASP",PSODRUG("OI"),PSI)) Q:'PSI  I $S('$D(^PSDRUG(PSI,"I")):1,'^("I"):1,DT'>^("I"):1,1:0),$S($P($G(^PSDRUG(PSI,2)),"^",3)'["O":0,1:1) S PSDC=PSDC+1,PSDC(PSDC)=PSI
"RTN","PSOORNW2",93,0)
 Q:PSDC=0
"RTN","PSOORNW2",94,0)
 I $G(PSDC),PSDC'=1 D  G DRENX
"RTN","PSOORNW2",95,0)
 .I $P($G(^PSDRUG(+$G(PSODRUG("IEN")),2)),"^")=$G(PSODRUG("OI")) Q
"RTN","PSOORNW2",96,0)
 .K PSODRUG("NAME"),PSODRUG("IEN")
"RTN","PSOORNW2",97,0)
 K PSOY S PSI=PSDC(1),PSOY=^PSDRUG(PSI,0)
"RTN","PSOORNW2",98,0)
 I $P($G(^PSDRUG(PSI,"CLOZ1")),"^")="PSOCLO1",'$O(^YSCL(603.01,"C",PSODFN,0)) K PSOY,PSI Q
"RTN","PSOORNW2",99,0)
 S PSODRUG("IEN")=+PSI,PSODRUG("VA CLASS")=$P(PSOY,"^",2),PSODRUG("NAME")=$P(PSOY,"^")
"RTN","PSOORNW2",100,0)
 S PSODRUG("NDF")=$S($G(^PSDRUG(PSI,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)
"RTN","PSOORNW2",101,0)
 S PSODRUG("MAXDOSE")=$P(PSOY,"^",4),PSODRUG("DEA")=$P(PSOY,"^",3),PSODRUG("CLN")=$S($D(^PSDRUG(+PSI,"ND")):+$P(^("ND"),"^",6),1:0)
"RTN","PSOORNW2",102,0)
 S PSODRUG("SIG")=$P(PSOY,"^",5),PSODRUG("NDC")=$$GETNDC^PSSNDCUT(+PSI,$G(PSOSITE)),PSODRUG("STKLVL")=$G(^PSDRUG(+PSI,660.1))
"RTN","PSOORNW2",103,0)
 S PSODRUG("DAW")=+$$GET1^DIQ(50,+PSI,81)
"RTN","PSOORNW2",104,0)
 G:$G(^PSDRUG(+PSI,660))']"" DRENX
"RTN","PSOORNW2",105,0)
 S PSOX1=$G(^PSDRUG(+PSI,660)),PSODRUG("COST")=$P($G(PSOX1),"^",6),PSODRUG("UNIT")=$P($G(PSOX1),"^",8),PSODRUG("EXPIRATION DATE")=$P($G(PSOX1),"^",9)
"RTN","PSOORNW2",106,0)
DRENX K PSDC,PSI,PSOY,Y,PSOXI,X
"RTN","PSOORNW2",107,0)
 Q
"RTN","PSOORNW2",108,0)
KV K DIR,DIRUT,DUOUT,DTOUT
"RTN","PSOORNW2",109,0)
 Q
"RTN","PSOORRD2")
0^45^B24528466
"RTN","PSOORRD2",1,0)
PSOORRD2 ;BHAM-ISC/EJW - Remote Data Interoperabilty Order Checks - backdoor ;06/26/05
"RTN","PSOORRD2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**207,251**;DEC 1997;Build 202
"RTN","PSOORRD2",3,0)
 ;
"RTN","PSOORRD2",4,0)
DUP ;Remote order - duplicate drug
"RTN","PSOORRD2",5,0)
 N PSOD0,PSOD1,PSOREMX,RDIINST,FSIG,PSOULN,PSOLF,PSORDI
"RTN","PSOORRD2",6,0)
 S $P(PSOULN,"-",79)="",PSOT="DD"
"RTN","PSOORRD2",7,0)
 S PSORDI=0 F  S PSORDI=$O(^TMP($J,"DD",PSORDI)) Q:'PSORDI  S PSOD0=^TMP($J,"DD",PSORDI,0),PSOD1=^(1),PSOREMX=$P($P(PSOD0,"^",4),";"),RDIINST=$P(PSOD0,"^",5),PSOLF=$P(PSOD1,"^",3) D
"RTN","PSOORRD2",8,0)
 .W !,PSOULN,!
"RTN","PSOORRD2",9,0)
 .W "Duplicate Drug in Remote Rx:",!
"RTN","PSOORRD2",10,0)
 .W $J("Location Name: ",20)_RDIINST,!
"RTN","PSOORRD2",11,0)
 .W $J("Rx #: ",20)_$E(PSOREMX,1,$L(PSOREMX)-1),!
"RTN","PSOORRD2",12,0)
 .W $J("Drug: ",20)_$P(PSOD1,"^"),!
"RTN","PSOORRD2",13,0)
 .D FSIG(.FSIG)
"RTN","PSOORRD2",14,0)
 .W $J("SIG: ",20) F I=1:1 Q:'$D(FSIG(I))  W ?20,FSIG(I),!
"RTN","PSOORRD2",15,0)
 .W $J("QTY: ",20)_$P(PSOD1,"^",5),?44,$J("Refills remaining: ",20)_$P(PSOD1,"^",6)
"RTN","PSOORRD2",16,0)
 .W !,$J("Provider: ",20)_$P(PSOD1,"^",8),?44,$J("Issued: ",20)_$P(PSOD1,"^",9)
"RTN","PSOORRD2",17,0)
 .W !,$J("Status: ",20)_$P(PSOD1,"^",2),?44,$J("Last filled on: ",20)_PSOLF
"RTN","PSOORRD2",18,0)
 .W !?44,$J("Days Supply: ",20)_$P(PSOD1,"^",4)
"RTN","PSOORRD2",19,0)
 .W !,PSOULN,!
"RTN","PSOORRD2",20,0)
 .D PAUSE
"RTN","PSOORRD2",21,0)
 .S ^TMP($J,"PSORMDD",PSORDI,0)=1
"RTN","PSOORRD2",22,0)
 K PSOT
"RTN","PSOORRD2",23,0)
 Q
"RTN","PSOORRD2",24,0)
 ;
"RTN","PSOORRD2",25,0)
CLS ;Remote order - duplicate drug class
"RTN","PSOORRD2",26,0)
 N PSOD0,PSOD1,PSOREMX,RDIINST,FSIG,PSOULN,PSOLF,PSORDI
"RTN","PSOORRD2",27,0)
 S $P(PSOULN,"-",79)="",PSOT="DC"
"RTN","PSOORRD2",28,0)
 S PSORDI=0 F  S PSORDI=$O(^TMP($J,"DC",PSORDI)) Q:'PSORDI  S PSOD0=^TMP($J,"DC",PSORDI,0),PSOD1=^(1),PSOREMX=$P($P(PSOD0,"^",6),";"),RDIINST=$P(PSOD0,"^",7),PSOLF=$P(PSOD1,"^",3) D
"RTN","PSOORRD2",29,0)
 .W !,PSOULN,!
"RTN","PSOORRD2",30,0)
 .W "     *** SAME CLASS *** OF DRUG IN REMOTE RX FOR ",$P(PSOD1,"^"),!
"RTN","PSOORRD2",31,0)
 .W ">> ",RDIINST,!
"RTN","PSOORRD2",32,0)
 .W "CLASS: ",$P(PSOD0,"^"),!
"RTN","PSOORRD2",33,0)
 .W $J("Rx #: ",20)_$E(PSOREMX,1,$L(PSOREMX)-1),!
"RTN","PSOORRD2",34,0)
 .W $J("Status: ",20),$P(PSOD1,"^",2)
"RTN","PSOORRD2",35,0)
 .W ?44,$J("Issued: ",20),$P(PSOD1,"^",9)
"RTN","PSOORRD2",36,0)
 .D FSIG(.FSIG)
"RTN","PSOORRD2",37,0)
 .W !,$J("SIG: ",20) F I=1:1 Q:'$D(FSIG(I))  W ?20,FSIG(I),!
"RTN","PSOORRD2",38,0)
 .W $J("QTY: ",20),$P(PSOD1,"^",5),!
"RTN","PSOORRD2",39,0)
 .W $J("Provider: ",20),$P(PSOD1,"^",8)
"RTN","PSOORRD2",40,0)
 .W ?44,$J("Refills remaining: ",20),$P(PSOD1,"^",6)
"RTN","PSOORRD2",41,0)
 .W !?44,$J("Last filled on: ",20),PSOLF
"RTN","PSOORRD2",42,0)
 .W !?44,$J("Days Supply: ",20),$P(PSOD1,"^",4)
"RTN","PSOORRD2",43,0)
 .D PAUSE
"RTN","PSOORRD2",44,0)
 K PSOT
"RTN","PSOORRD2",45,0)
 Q
"RTN","PSOORRD2",46,0)
FSIG(FSIG) ;Format sig from remote site
"RTN","PSOORRD2",47,0)
 ;returned in the FSIG array
"RTN","PSOORRD2",48,0)
 N FFF,NNN,CNT,FVAR,FVAR1,FLIM,HSIG,II,I
"RTN","PSOORRD2",49,0)
 F I=0:1 Q:'$D(^TMP($J,PSOT,PSORDI,1,I))  S HSIG(I+1)=^(I)
"RTN","PSOORRD2",50,0)
FSTART S (FVAR,FVAR1)="",II=1
"RTN","PSOORRD2",51,0)
 F FFF=0:0 S FFF=$O(HSIG(FFF)) Q:'FFF  S CNT=0 F NNN=1:1:$L(HSIG(FFF)) I $E(HSIG(FFF),NNN)=" "!($L(HSIG(FFF))=NNN) S CNT=CNT+1 D  I $L(FVAR)>52 S FSIG(II)=FLIM_" ",II=II+1,FVAR=FVAR1
"RTN","PSOORRD2",52,0)
 .S FVAR1=$P(HSIG(FFF)," ",(CNT))
"RTN","PSOORRD2",53,0)
 .S FLIM=FVAR
"RTN","PSOORRD2",54,0)
 .S FVAR=$S(FVAR="":FVAR1,1:FVAR_" "_FVAR1)
"RTN","PSOORRD2",55,0)
 I $G(FVAR)'="" S FSIG(II)=FVAR
"RTN","PSOORRD2",56,0)
 I $G(FSIG(1))=""!($G(FSIG(1))=" ") S FSIG(1)=$G(FSIG(2)) K FSIG(2)
"RTN","PSOORRD2",57,0)
FQUIT Q
"RTN","PSOORRD2",58,0)
SIGNIF ;
"RTN","PSOORRD2",59,0)
 S DIR(0)="SA^1:YES;0:NO",DIR("A")="Do you want to Intervene? ",DIR("B")="Y" W ! D ^DIR
"RTN","PSOORRD2",60,0)
 I Y I '$D(PSORX("INTERVENE")) S PSORX("INTERVENE")=2
"RTN","PSOORRD2",61,0)
 I '$G(Y) K DIR,DTOUT,DIRUT,DIROUT,DUOUT,Y Q
"RTN","PSOORRD2",62,0)
 Q
"RTN","PSOORRD2",63,0)
 ;
"RTN","PSOORRD2",64,0)
PAUSE ;
"RTN","PSOORRD2",65,0)
 K DIR W ! S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to continue..." D ^DIR W ! K DIR
"RTN","PSOORRD2",66,0)
 Q
"RTN","PSOORRD2",67,0)
DRGINT ;DRUG-DRUG INTERACTION WITH ORDER FROM REMOTE SITE
"RTN","PSOORRD2",68,0)
 N PSOD0,PSOD1,PSOREMX,RDIINST,FSIG,PSOULN,PSOLF,PSOINT,PSORDI
"RTN","PSOORRD2",69,0)
 S $P(PSOULN,"-",79)="",PSOT="DI"
"RTN","PSOORRD2",70,0)
 S PSORDI=0 F  S PSORDI=$O(^TMP($J,"DI",PSORDI)) Q:'PSORDI  Q:$G(PSORX("DFLG"))  S PSOD0=^TMP($J,"DI",PSORDI,0),PSOD1=^(1),PSOREMX=$P($P(PSOD0,"^",8),";"),RDIINST=$P(PSOD0,"^",9),PSOLF=$P(PSOD1,"^",3) D
"RTN","PSOORRD2",71,0)
 .S PSOINT=$P(PSOD0,"^",4)
"RTN","PSOORRD2",72,0)
 .W !,PSOULN,!
"RTN","PSOORRD2",73,0)
 .W ">> ",RDIINST,!
"RTN","PSOORRD2",74,0)
 .W ?5,"** ",PSOINT," ** DRUG-DRUG interaction ",$P(PSOD0,"^",5)," & ",$P(PSOD0,"^",6),!
"RTN","PSOORRD2",75,0)
 .W ?5,"Remote RX # ",$E(PSOREMX,1,$L(PSOREMX)-1)," Drug: ",$P(PSOD1,"^"),!
"RTN","PSOORRD2",76,0)
 .W $J("Status: ",20),$P(PSOD1,"^",2)
"RTN","PSOORRD2",77,0)
 .W ?44,$J("Issued: ",20),$P(PSOD1,"^",9)
"RTN","PSOORRD2",78,0)
 .D FSIG(.FSIG)
"RTN","PSOORRD2",79,0)
 .W !,$J("SIG: ",20) F I=1:1 Q:'$D(FSIG(I))  W ?20,FSIG(I),!
"RTN","PSOORRD2",80,0)
 .W $J("QTY: ",20),$P(PSOD1,"^",5),!
"RTN","PSOORRD2",81,0)
 .W $J("Provider: ",20),$P(PSOD1,"^",8)
"RTN","PSOORRD2",82,0)
 .W !?44,$J("Refills remaining: ",20),$P(PSOD1,"^",6)
"RTN","PSOORRD2",83,0)
 .W !?44,$J("Last filled on: ",20),PSOLF
"RTN","PSOORRD2",84,0)
 .W !?44,$J("Days Supply: ",20),$P(PSOD1,"^",4)
"RTN","PSOORRD2",85,0)
 .I '$D(^XUSEC("PSORPH",DUZ)) Q  ; CLERK/TECH ENTRY
"RTN","PSOORRD2",86,0)
 .I PSOINT'="CRITICAL" D SIGNIF
"RTN","PSOORRD2",87,0)
 .I PSOINT="CRITICAL" D CRI
"RTN","PSOORRD2",88,0)
 K PSOT,PSORDI
"RTN","PSOORRD2",89,0)
 Q
"RTN","PSOORRD2",90,0)
 ;
"RTN","PSOORRD2",91,0)
CRI ;process new drug interactions entered by pharmacist
"RTN","PSOORRD2",92,0)
 K DIR S DIR("A",1)="",DIR("A",2)="Do you want to Process medication",DIR("A")=PSODRUG("NAME")_": ",DIR(0)="SA^1:PROCESS;0:ABORT ORDER ENTRY",DIR("B")="P"
"RTN","PSOORRD2",93,0)
 S DIR("?",1)="Enter '1' or 'P' to Activate medication",DIR("?")="      '0' or 'A' to Abort Order Entry process" D ^DIR K X1,DIR I 'Y S PSORX("DFLG")=1,DGI="" K DTOUT,DIRUT,DIROUT,DUOUT,PSORX("INTERVENE") Q
"RTN","PSOORRD2",94,0)
 D SIG^XUSESIG I X1="" K PSORX("INTERVENE") S PSORX("DFLG")=1 Q
"RTN","PSOORRD2",95,0)
 S PSORX("INTERVENE")=1
"RTN","PSOORRD2",96,0)
 K DUOUT,DTOUT,DIRUT,DIROUT
"RTN","PSOORRD2",97,0)
 Q
"RTN","PSOORRDI")
0^47^B49421616
"RTN","PSOORRDI",1,0)
PSOORRDI ;BHAM-ISC/EJW - Remote Data Interoperability Order Checks ;04/25/05
"RTN","PSOORRDI",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**207,243,251**;DEC 1997;Build 202
"RTN","PSOORRDI",3,0)
 ;
"RTN","PSOORRDI",4,0)
 ;External references to ^ORRDI1 supported by DBIA 4659
"RTN","PSOORRDI",5,0)
 ;External references to ^XTMP("ORRDI" supported by DBIA 4660
"RTN","PSOORRDI",6,0)
 ;External reference to ^PS(50.605 supported by DBIA 696
"RTN","PSOORRDI",7,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORRDI",8,0)
 ;External reference to ^PS(56 supported by DBIA 2229
"RTN","PSOORRDI",9,0)
 ;External reference to ^PS(50.416 supported by DBIA 692
"RTN","PSOORRDI",10,0)
 ;External reference to DDIEX^PSNAPIS supported by DBIA 2574
"RTN","PSOORRDI",11,0)
REMOTE(PSODFN,DREN) ;
"RTN","PSOORRDI",12,0)
 ; Input: DFN: PATIENT file (#2) IEN
"RTN","PSOORRDI",13,0)
 ;      : DREN: DRUG file (#50) IEN of order being checked
"RTN","PSOORRDI",14,0)
 I $T(HAVEHDR^ORRDI1)']"" Q
"RTN","PSOORRDI",15,0)
 I '$$HAVEHDR^ORRDI1 Q
"RTN","PSOORRDI",16,0)
 I $D(^XTMP("ORRDI","OUTAGE INFO","DOWN")) D  Q
"RTN","PSOORRDI",17,0)
 .I $T(REMOTE^PSORX1)]"" Q
"RTN","PSOORRDI",18,0)
 .W !!,"Remote data not available - Only local order checks processed." D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSOORRDI",19,0)
 I $P($G(^XTMP("ORRDI","PSOO",PSODFN,0)),"^",3)<0 W !!,"Remote data not available - Only local order checks processed." D HD^PSODDPR2():(($Y+5)'>IOSL) Q
"RTN","PSOORRDI",20,0)
 N PSORDI,RDIINST,RDIVUID,RDIRX,RDIDNAM,RDISTA,RDISIG,RDIDAYS,RDIQTY,RDIFILL,RDIEXP,RDIISS,RDIFILL,RDIREF,RDIPHYS,PSOPROD,PSOCLASS,DRNM,RDITMP,PSODC,IT,PSOICT,NDF,RDIDI,PSOPRODA,PSOFILE,PSOSIG
"RTN","PSOORRDI",21,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSOORRDI",22,0)
 S (DD,PSORDI)=0
"RTN","PSOORRDI",23,0)
 I $T(GET^ORRDI1)]"" S PSORDI=$$GET^ORRDI1(PSODFN,"PSOO")
"RTN","PSOORRDI",24,0)
 I PSORDI<1 Q
"RTN","PSOORRDI",25,0)
 I '$D(^XTMP("ORRDI","PSOO",PSODFN)) Q
"RTN","PSOORRDI",26,0)
 K ^TMP($J,"PSORDI")
"RTN","PSOORRDI",27,0)
 D PARSE,FILTER
"RTN","PSOORRDI",28,0)
 I '$D(^TMP($J,LIST,"OUT","REMOTE")) Q
"RTN","PSOORRDI",29,0)
 ;D DRGNAME ; GET VA PRODUCT FILE NAME FOR FILE 50 DRUG BEING CHECKED
"RTN","PSOORRDI",30,0)
 S PSORDI="" F  S PSORDI=$O(^TMP($J,LIST,"OUT","REMOTE",PSORDI)) Q:'PSORDI  S RDITMP=^(PSORDI) D
"RTN","PSOORRDI",31,0)
 .S RDIINST=$P(RDITMP,"^")
"RTN","PSOORRDI",32,0)
 .S RDIVUID=$P(RDITMP,"^",2)
"RTN","PSOORRDI",33,0)
 .I RDIVUID="" Q
"RTN","PSOORRDI",34,0)
 .S RDIDNAM=$P(RDITMP,"^",3)
"RTN","PSOORRDI",35,0)
 .S RDISTA=$P(RDITMP,"^",4)
"RTN","PSOORRDI",36,0)
 .S RDIRX=$P(RDITMP,"^",5)
"RTN","PSOORRDI",37,0)
 .S RDIFILL=$P(RDITMP,"^",6)
"RTN","PSOORRDI",38,0)
 .S RDIDAYS=$P(RDITMP,"^",7) I $E(RDIDAYS)="D" S RDIDAYS=$P(RDIDAYS,"D",2)
"RTN","PSOORRDI",39,0)
 .S RDIQTY=$P(RDITMP,"^",8)
"RTN","PSOORRDI",40,0)
 .S RDIREF=$P(RDITMP,"^",9)
"RTN","PSOORRDI",41,0)
 .S RDIEXP=$P(RDITMP,"^",10)
"RTN","PSOORRDI",42,0)
 .S RDIPHYS=$P(RDITMP,"^",11)
"RTN","PSOORRDI",43,0)
 .S RDIISS=$P(RDITMP,"^",12)
"RTN","PSOORRDI",44,0)
 .K ^TMP($J,"PSOPROD")
"RTN","PSOORRDI",45,0)
 D REMOTE^PSODDPR5
"RTN","PSOORRDI",46,0)
 Q
"RTN","PSOORRDI",47,0)
 ;
"RTN","PSOORRDI",48,0)
PARSE ; PULL INFORMATION FROM ^XTMP
"RTN","PSOORRDI",49,0)
 N PSORDI,LOCAL,NEWISS,BADEXP,PSOPRE,PSO30,NEWDC,NEWEXP
"RTN","PSOORRDI",50,0)
 S PSORDI=0
"RTN","PSOORRDI",51,0)
 F  S PSORDI=$O(^XTMP("ORRDI","PSOO",PSODFN,PSORDI)) Q:'PSORDI  D
"RTN","PSOORRDI",52,0)
 .S RDISTA=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,5,0))
"RTN","PSOORRDI",53,0)
 .I RDISTA="DELETED" Q
"RTN","PSOORRDI",54,0)
 .S RDIINST=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,1,0))
"RTN","PSOORRDI",55,0)
 .S RDIDNAM=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,2,0))
"RTN","PSOORRDI",56,0)
 .S RDIVUID=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,3,0))
"RTN","PSOORRDI",57,0)
 .I RDIVUID="" Q
"RTN","PSOORRDI",58,0)
 .S RDIRX=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,4,0))
"RTN","PSOORRDI",59,0)
 .S RDIQTY=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,6,0)),RDIDAYS=$P(RDIQTY,";",2),RDIQTY=$P(RDIQTY,";")
"RTN","PSOORRDI",60,0)
 .I $E(RDIDAYS)="D" S RDIDAYS=$P(RDIDAYS,"D",2)
"RTN","PSOORRDI",61,0)
 .S RDIEXP=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,7,0))
"RTN","PSOORRDI",62,0)
 .S RDIISS=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,8,0))
"RTN","PSOORRDI",63,0)
 .I RDIEXP?."/" S BADEXP=1 D  I BADEXP Q
"RTN","PSOORRDI",64,0)
 ..I RDIISS?."/" Q
"RTN","PSOORRDI",65,0)
 ..S PSOPRE=$E(DT) I $P(RDIISS,"/",3)>($E(DT,2,3)+1) S PSOPRE=PSOPRE-1
"RTN","PSOORRDI",66,0)
 ..S NEWISS=PSOPRE_$P(RDIISS,"/",3)_$P(RDIISS,"/")_$P(RDIISS,"/",2) I NEWISS>(DT-10000) S RDIEXP=RDIISS,BADEXP=0
"RTN","PSOORRDI",67,0)
 .I RDISTA["EXPIRE" S PSO30=0 D  I PSO30 Q
"RTN","PSOORRDI",68,0)
 ..S PSOPRE=$E(DT) I $P(RDIEXP,"/",3)>($E(DT,2,3)+1) S PSO30=1 Q
"RTN","PSOORRDI",69,0)
 ..S NEWEXP=PSOPRE_$P(RDIEXP,"/",3)_$P(RDIEXP,"/")_$P(RDIEXP,"/",2)
"RTN","PSOORRDI",70,0)
 ..S X1=NEWEXP,X2=30 D C^%DTC I X<DT S PSO30=1
"RTN","PSOORRDI",71,0)
 .I RDIRX'="" S LOCAL=0 D CHKLOCAL I LOCAL Q
"RTN","PSOORRDI",72,0)
 .S RDIFILL=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,9,0))
"RTN","PSOORRDI",73,0)
 .I RDISTA["DISCONT" S PSO30=0 D  I PSO30 Q
"RTN","PSOORRDI",74,0)
 ..S PSOPRE=$E(DT) I $P(RDIFILL,"/",3)>($E(DT,2,3)+1) S PSO30=1 Q
"RTN","PSOORRDI",75,0)
 ..S NEWDC=PSOPRE_$P(RDIFILL,"/",3)_$P(RDIFILL,"/")_$P(RDIFILL,"/",2)
"RTN","PSOORRDI",76,0)
 ..S X1=NEWDC,X2=30+RDIDAYS D C^%DTC I X<DT S PSO30=1
"RTN","PSOORRDI",77,0)
 ..I RDISTA["DRUG INTERACTION" S RDISTA="NON-VERIFIED"
"RTN","PSOORRDI",78,0)
 .S RDIREF=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,10,0))
"RTN","PSOORRDI",79,0)
 .S RDIPHYS=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,11,0))
"RTN","PSOORRDI",80,0)
 .I PSODRUG("NAME")=RDIDNAM S DD=$G(DD)+1,^TMP($J,"DD",DD,0)=PSODRUG("IEN")_"^"_PSODRUG("NAME")_"^"_"^"_RDIRX_"R;O"_"^"_RDIINST D  Q:'$G(PSOPHI)
"RTN","PSOORRDI",81,0)
 ..S ^TMP($J,"DD",DD,1)=RDIDNAM_"^"_RDISTA_"^"_RDIFILL_"^"_RDIDAYS_"^"_RDIQTY_"^"_RDIREF_"^"_RDIEXP_"^"_RDIPHYS_"^"_RDIISS
"RTN","PSOORRDI",82,0)
 ..S PSOSIG="" F  S PSOSIG=$O(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,14,PSOSIG)) Q:PSOSIG=""  S PSOSIG(PSOSIG)=^(PSOSIG)
"RTN","PSOORRDI",83,0)
 ..S PSOSIG="" F  S PSOSIG=$O(PSOSIG(PSOSIG)) Q:PSOSIG=""  S ^TMP($J,"DD",DD,1,PSOSIG)=PSOSIG(PSOSIG)
"RTN","PSOORRDI",84,0)
 ..S ^TMP($J,"PSORMDD",PSORDI,0)=1
"RTN","PSOORRDI",85,0)
 .D GETPROD
"RTN","PSOORRDI",86,0)
 .Q:$E($G(PSOCLASS),1,2)="XA"
"RTN","PSOORRDI",87,0)
 .S PSOSIG="" F  S PSOSIG=$O(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,14,PSOSIG)) Q:PSOSIG=""  S PSOSIG(PSOSIG)=^(PSOSIG)
"RTN","PSOORRDI",88,0)
 .S ^TMP($J,LIST,"OUT","REMOTE",PSORDI)=RDIINST_"^"_RDIVUID_"^"_RDIDNAM_"^"_RDISTA_"^"_RDIRX_"^"_RDIFILL_"^"_RDIDAYS_"^"_RDIQTY_"^"_RDIREF_"^"_RDIEXP_"^"_RDIPHYS_"^"_RDIISS
"RTN","PSOORRDI",89,0)
 .S PSOSIG="" F  S PSOSIG=$O(PSOSIG(PSOSIG)) Q:PSOSIG=""  S ^TMP($J,LIST,"OUT","REMOTE",PSORDI,"SIG",PSOSIG)=PSOSIG(PSOSIG)
"RTN","PSOORRDI",90,0)
 Q
"RTN","PSOORRDI",91,0)
 ;
"RTN","PSOORRDI",92,0)
CHKLOCAL ; IF SAME RX NUMBER AND ISSUE DATE - LOCAL RX
"RTN","PSOORRDI",93,0)
 N PSOISS
"RTN","PSOORRDI",94,0)
 I $D(^PSRX("B",RDIRX)) D
"RTN","PSOORRDI",95,0)
 .N PSORX
"RTN","PSOORRDI",96,0)
 .S PSORX=$O(^PSRX("B",RDIRX,"")) I 'PSORX Q
"RTN","PSOORRDI",97,0)
 .S PSOISS=$P($G(^PSRX(PSORX,0)),"^",13)
"RTN","PSOORRDI",98,0)
 .S PSOISS=$E(PSOISS,4,5)_"/"_$E(PSOISS,6,7)_"/"_$E(PSOISS,2,3)
"RTN","PSOORRDI",99,0)
 .I PSOISS=RDIISS S LOCAL=1 Q
"RTN","PSOORRDI",100,0)
 Q
"RTN","PSOORRDI",101,0)
 ;
"RTN","PSOORRDI",102,0)
VAPROD(PSOPROD) ; GET VA PRODUCT FILE NAME AND DRUG CLASS
"RTN","PSOORRDI",103,0)
 S PSOCLASS=$$DCLCODE^PSNAPIS(,PSOPROD)
"RTN","PSOORRDI",104,0)
 S DRNM=$P($$PROD0^PSNAPIS(,PSOPROD),"^")
"RTN","PSOORRDI",105,0)
 Q
"RTN","PSOORRDI",106,0)
 ;
"RTN","PSOORRDI",107,0)
DRGNAME ; 
"RTN","PSOORRDI",108,0)
 N PSOY,PSODRUG
"RTN","PSOORRDI",109,0)
 S PSOY=DREN_"^"_$P($G(^PSDRUG(DREN,0)),"^"),PSOY(0)=$G(^PSDRUG(DREN,0))
"RTN","PSOORRDI",110,0)
 S PSODRUG("IEN")=+PSOY,PSODRUG("VA CLASS")=$P(PSOY(0),"^",2)
"RTN","PSOORRDI",111,0)
 S PSODRUG("NDF")=$S($G(^PSDRUG(+PSOY,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)
"RTN","PSOORRDI",112,0)
 I PSODRUG("NDF")=0 Q
"RTN","PSOORRDI",113,0)
 S PSOPROD=$P(PSODRUG("NDF"),"A",2) I PSOPROD D VAPROD(PSOPROD) S PSODRUG("NAME")=DRNM
"RTN","PSOORRDI",114,0)
 Q
"RTN","PSOORRDI",115,0)
 ;
"RTN","PSOORRDI",116,0)
FILTER ; FOR SAME DRUG VUID FOR SAME SITE, KEEP 1 ENTRY - CHECK BY ACTIVE STATUS FIRST THEN BY GREATEST EXPIRATION DATE
"RTN","PSOORRDI",117,0)
 N XX,RDI,OLDEXP,RDIEXP,RDIEXP2,OLDEXP2,PSORDI,RDISTA,OLDSTA,OLDRDI,ZZ
"RTN","PSOORRDI",118,0)
 S PSORDI=0
"RTN","PSOORRDI",119,0)
 F  S PSORDI=$O(^TMP($J,"PSORDI",PSORDI)) Q:'PSORDI  D
"RTN","PSOORRDI",120,0)
 .S XX=$G(^TMP($J,"PSORDI",PSORDI)),RDIINST=$P(XX,"^"),RDIVUID=$P(XX,"^",2),RDISTA=$P(XX,"^",4),RDIEXP=$P(XX,"^",10) Q:RDIINST=""  Q:RDIVUID=""  I RDIEXP="" Q
"RTN","PSOORRDI",121,0)
 .I $D(RDI(RDIINST,RDIVUID)) S ZZ=RDI(RDIINST,RDIVUID) D  Q
"RTN","PSOORRDI",122,0)
 ..I RDISTA="ACTIVE"!(RDISTA["SUSPEN") D  Q
"RTN","PSOORRDI",123,0)
 ...S OLDSTA=$P(ZZ,"^",2) I OLDSTA["ACTIVE"!(OLDSTA["SUSPEN") D CHKEXP Q
"RTN","PSOORRDI",124,0)
 ...S OLDRDI=$P(ZZ,"^") K ^TMP($J,"PSORDI",OLDRDI) D SETRDI
"RTN","PSOORRDI",125,0)
 ..S OLDSTA=$P(ZZ,"^",2) I OLDSTA["ACTIVE"!(OLDSTA["SUSPEN") K ^TMP($J,"PSORDI",PSORDI) Q
"RTN","PSOORRDI",126,0)
 ..D CHKEXP ; ALL OTHER STATUSES - KEEP BY GREATER EXPIRATION DATE
"RTN","PSOORRDI",127,0)
 .D SETRDI
"RTN","PSOORRDI",128,0)
 Q
"RTN","PSOORRDI",129,0)
 ;
"RTN","PSOORRDI",130,0)
CHKEXP ; 
"RTN","PSOORRDI",131,0)
 N PSOPRE
"RTN","PSOORRDI",132,0)
 S OLDEXP=$P(ZZ,"^",3) D  I OLDEXP2>RDIEXP2 K ^TMP($J,"PSORDI",PSORDI) Q
"RTN","PSOORRDI",133,0)
 .S PSOPRE=$E(DT) I $P(RDIEXP,"/",3)>($E(DT,2,3)+1) S PSOPRE=PSOPRE-1
"RTN","PSOORRDI",134,0)
 .S RDIEXP2=PSOPRE_$P(RDIEXP,"/",3)_$P(RDIEXP,"/")_$P(RDIEXP,"/",2)
"RTN","PSOORRDI",135,0)
 .S PSOPRE=$E(DT) I $P(OLDEXP,"/",3)>($E(DT,2,3)+1) S PSOPRE=PSOPRE-1
"RTN","PSOORRDI",136,0)
 .S OLDEXP2=PSOPRE_$P(OLDEXP,"/",3)_$P(OLDEXP,"/")_$P(OLDEXP,"/",2)
"RTN","PSOORRDI",137,0)
 S OLDRDI=$P(ZZ,"^") K ^TMP($J,"PSORDI",OLDRDI) D SETRDI
"RTN","PSOORRDI",138,0)
 Q
"RTN","PSOORRDI",139,0)
 ;
"RTN","PSOORRDI",140,0)
SETRDI ;
"RTN","PSOORRDI",141,0)
 S RDI(RDIINST,RDIVUID)=PSORDI_"^"_RDISTA_"^"_RDIEXP
"RTN","PSOORRDI",142,0)
 Q
"RTN","PSOORRDI",143,0)
 ;
"RTN","PSOORRDI",144,0)
GETPROD ;
"RTN","PSOORRDI",145,0)
 S PSOFILE=50.68
"RTN","PSOORRDI",146,0)
 S DRNM="",PSOCLASS="",PSOPROD=0
"RTN","PSOORRDI",147,0)
 N PSOPR
"RTN","PSOORRDI",148,0)
 K PSOPRODA
"RTN","PSOORRDI",149,0)
 N DIC
"RTN","PSOORRDI",150,0)
 D GETIREF^XTID(PSOFILE,.01,RDIVUID,"PSOPRODA",1) I 'PSOPRODA Q
"RTN","PSOORRDI",151,0)
 S PSOPR="" F  S PSOPR=$O(PSOPRODA(PSOFILE,.01,PSOPR)) Q:PSOPR=""  D  Q:DRNM'=""  Q:PSOCLASS'=""
"RTN","PSOORRDI",152,0)
 .I +(PSOPRODA(PSOFILE,.01,PSOPR)) S PSOPROD=+PSOPR D VAPROD(PSOPROD) Q
"RTN","PSOORRDI",153,0)
 .I +(PSOPRODA(PSOFILE,.01,PSOPR))=0 I '$O(PSOPRODA(PSOFILE,.01,PSOPR)) S PSOPROD=+PSOPR D VAPROD(PSOPROD) ; USE LAST ENTRY IF ALL ARE INACTIVE
"RTN","PSOORRDI",154,0)
 Q
"RTN","PSOORRDI",155,0)
 ;
"RTN","PSOORROC")
0^26^B54619210
"RTN","PSOORROC",1,0)
PSOORROC ;BHAM-ISC/EJW,SAB - Remote Data Interoperability Order Checks ;05/28/08
"RTN","PSOORROC",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**251**;DEC 1997;Build 202
"RTN","PSOORROC",3,0)
 ;
"RTN","PSOORROC",4,0)
 ;External references to ^ORRDI1 supported by DBIA 4659
"RTN","PSOORROC",5,0)
 ;External references to ^XTMP("ORRDI" supported by DBIA 4660
"RTN","PSOORROC",6,0)
 ;External reference to ^PS(50.605 supported by DBIA 696
"RTN","PSOORROC",7,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORROC",8,0)
 ;External reference to ^PS(56 supported by DBIA 2229
"RTN","PSOORROC",9,0)
 ;External reference to ^PS(50.416 supported by DBIA 692
"RTN","PSOORROC",10,0)
 ;External reference to DDIEX^PSNAPIS supported by DBIA 2574
"RTN","PSOORROC",11,0)
REMOTE(PSODFN,DREN) ;
"RTN","PSOORROC",12,0)
 ; Input: DFN: PATIENT file (#2) IEN
"RTN","PSOORROC",13,0)
 ;      : DREN: DRUG file (#50) IEN of order being checked
"RTN","PSOORROC",14,0)
 I $T(HAVEHDR^ORRDI1)']"" Q
"RTN","PSOORROC",15,0)
 I '$$HAVEHDR^ORRDI1 Q
"RTN","PSOORROC",16,0)
 I $D(^XTMP("ORRDI","OUTAGE INFO","DOWN")) Q
"RTN","PSOORROC",17,0)
 N PSORDI,RDIINST,RDIVUID,RDIRX,RDIDNAM,RDISTA,RDISIG,RDIDAYS,RDIQTY,RDIFILL,RDIEXP,RDIISS,RDIFILL,RDIREF,RDIPHYS,PSOPROD,PSOCLASS,DRNM,RDITMP,PSODC,IT,PSOICT,NDF,RDIDI,PSOPRODA,PSOFILE,PSOSIG
"RTN","PSOORROC",18,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSOORROC",19,0)
 S PSORDI=0
"RTN","PSOORROC",20,0)
 I $T(GET^ORRDI1)]"" S PSORDI=$$GET^ORRDI1(PSODFN,"PSOO")
"RTN","PSOORROC",21,0)
 I PSORDI<1 Q
"RTN","PSOORROC",22,0)
 I '$D(^XTMP("ORRDI","PSOO",PSODFN)) Q
"RTN","PSOORROC",23,0)
 K ^TMP($J,"PSORDI")
"RTN","PSOORROC",24,0)
 D PARSE,FILTER
"RTN","PSOORROC",25,0)
 I '$D(^TMP($J,"PSORDI")) Q
"RTN","PSOORROC",26,0)
 D DRGNAME ; GET VA PRODUCT FILE NAME FOR FILE 50 DRUG BEING CHECKED
"RTN","PSOORROC",27,0)
 S PSORDI="" F  S PSORDI=$O(^TMP($J,"PSORDI",PSORDI)) Q:'PSORDI  S RDITMP=^(PSORDI) D
"RTN","PSOORROC",28,0)
 .S RDIINST=$P(RDITMP,"^")
"RTN","PSOORROC",29,0)
 .S RDIVUID=$P(RDITMP,"^",2)
"RTN","PSOORROC",30,0)
 .I RDIVUID="" Q
"RTN","PSOORROC",31,0)
 .S RDIDNAM=$P(RDITMP,"^",3)
"RTN","PSOORROC",32,0)
 .S RDISTA=$P(RDITMP,"^",4)
"RTN","PSOORROC",33,0)
 .S RDIRX=$P(RDITMP,"^",5)
"RTN","PSOORROC",34,0)
 .S RDIFILL=$P(RDITMP,"^",6)
"RTN","PSOORROC",35,0)
 .S RDIDAYS=$P(RDITMP,"^",7) I $E(RDIDAYS)="D" S RDIDAYS=$P(RDIDAYS,"D",2)
"RTN","PSOORROC",36,0)
 .S RDIQTY=$P(RDITMP,"^",8)
"RTN","PSOORROC",37,0)
 .S RDIREF=$P(RDITMP,"^",9)
"RTN","PSOORROC",38,0)
 .S RDIEXP=$P(RDITMP,"^",10)
"RTN","PSOORROC",39,0)
 .S RDIPHYS=$P(RDITMP,"^",11)
"RTN","PSOORROC",40,0)
 .S RDIISS=$P(RDITMP,"^",12)
"RTN","PSOORROC",41,0)
 .S DRNM=$G(PSODRUG("NAME"))
"RTN","PSOORROC",42,0)
 .D GETPROD
"RTN","PSOORROC",43,0)
 .I DRNM'="" I PSODRUG("NAME")=DRNM S DD=$G(DD)+1,^TMP($J,"DD",DD,0)=PSODRUG("IEN")_"^"_PSODRUG("NAME")_"^"_"^"_RDIRX_"R;O"_"^"_RDIINST D  Q:'$G(PSOPHI)
"RTN","PSOORROC",44,0)
 ..S ^TMP($J,"DD",DD,1)=RDIDNAM_"^"_RDISTA_"^"_RDIFILL_"^"_RDIDAYS_"^"_RDIQTY_"^"_RDIREF_"^"_RDIEXP_"^"_RDIPHYS_"^"_RDIISS
"RTN","PSOORROC",45,0)
 ..M ^TMP($J,"DD",DD,1)=^TMP($J,"PSORDI",PSORDI,"SIG")
"RTN","PSOORROC",46,0)
 Q
"RTN","PSOORROC",47,0)
 ;
"RTN","PSOORROC",48,0)
PARSE ; PULL INFORMATION FROM ^XTMP
"RTN","PSOORROC",49,0)
 N PSORDI,LOCAL,NEWISS,BADEXP,PSOPRE,PSO30,NEWDC,NEWEXP
"RTN","PSOORROC",50,0)
 S PSORDI=0 F  S PSORDI=$O(^XTMP("ORRDI","PSOO",PSODFN,PSORDI)) Q:'PSORDI  D
"RTN","PSOORROC",51,0)
 .S RDISTA=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,5,0))
"RTN","PSOORROC",52,0)
 .I RDISTA="DELETED" Q
"RTN","PSOORROC",53,0)
 .S RDIINST=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,1,0))
"RTN","PSOORROC",54,0)
 .S RDIDNAM=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,2,0))
"RTN","PSOORROC",55,0)
 .S RDIVUID=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,3,0))
"RTN","PSOORROC",56,0)
 .I RDIVUID="" Q
"RTN","PSOORROC",57,0)
 .S RDIRX=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,4,0))
"RTN","PSOORROC",58,0)
 .S RDIQTY=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,6,0)),RDIDAYS=$P(RDIQTY,";",2),RDIQTY=$P(RDIQTY,";")
"RTN","PSOORROC",59,0)
 .I $E(RDIDAYS)="D" S RDIDAYS=$P(RDIDAYS,"D",2)
"RTN","PSOORROC",60,0)
 .S RDIEXP=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,7,0))
"RTN","PSOORROC",61,0)
 .S RDIISS=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,8,0))
"RTN","PSOORROC",62,0)
 .I RDIEXP?."/" S BADEXP=1 D  I BADEXP Q
"RTN","PSOORROC",63,0)
 ..I RDIISS?."/" Q
"RTN","PSOORROC",64,0)
 ..S PSOPRE=$E(DT) I $P(RDIISS,"/",3)>($E(DT,2,3)+1) S PSOPRE=PSOPRE-1
"RTN","PSOORROC",65,0)
 ..S NEWISS=PSOPRE_$P(RDIISS,"/",3)_$P(RDIISS,"/")_$P(RDIISS,"/",2) I NEWISS>(DT-10000) S RDIEXP=RDIISS,BADEXP=0
"RTN","PSOORROC",66,0)
 .I RDISTA["EXPIRE" S PSO30=0 D  I PSO30 Q
"RTN","PSOORROC",67,0)
 ..S PSOPRE=$E(DT) I $P(RDIEXP,"/",3)>($E(DT,2,3)+1) S PSO30=1 Q
"RTN","PSOORROC",68,0)
 ..S NEWEXP=PSOPRE_$P(RDIEXP,"/",3)_$P(RDIEXP,"/")_$P(RDIEXP,"/",2)
"RTN","PSOORROC",69,0)
 ..S X1=NEWEXP,X2=30 D C^%DTC I X<DT S PSO30=1
"RTN","PSOORROC",70,0)
 .I RDIRX'="" S LOCAL=0 D CHKLOCAL I LOCAL Q
"RTN","PSOORROC",71,0)
 .S RDIFILL=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,9,0))
"RTN","PSOORROC",72,0)
 .I RDISTA["DISCONT" S PSO30=0 D  I PSO30 Q
"RTN","PSOORROC",73,0)
 ..S PSOPRE=$E(DT) I $P(RDIFILL,"/",3)>($E(DT,2,3)+1) S PSO30=1 Q
"RTN","PSOORROC",74,0)
 ..S NEWDC=PSOPRE_$P(RDIFILL,"/",3)_$P(RDIFILL,"/")_$P(RDIFILL,"/",2)
"RTN","PSOORROC",75,0)
 ..S X1=NEWDC,X2=30+RDIDAYS D C^%DTC I X<DT S PSO30=1
"RTN","PSOORROC",76,0)
 .S RDIREF=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,10,0))
"RTN","PSOORROC",77,0)
 .S RDIPHYS=$G(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,11,0))
"RTN","PSOORROC",78,0)
 .S PSOSIG="" F  S PSOSIG=$O(^XTMP("ORRDI","PSOO",PSODFN,PSORDI,14,PSOSIG)) Q:PSOSIG=""  S PSOSIG(PSOSIG)=^(PSOSIG)
"RTN","PSOORROC",79,0)
 .S ^TMP($J,"PSORDI",PSORDI)=RDIINST_"^"_RDIVUID_"^"_RDIDNAM_"^"_RDISTA_"^"_RDIRX_"^"_RDIFILL_"^"_RDIDAYS_"^"_RDIQTY_"^"_RDIREF_"^"_RDIEXP_"^"_RDIPHYS_"^"_RDIISS
"RTN","PSOORROC",80,0)
 .S PSOSIG="" F  S PSOSIG=$O(PSOSIG(PSOSIG)) Q:PSOSIG=""  S ^TMP($J,"PSORDI",PSORDI,"SIG",PSOSIG)=PSOSIG(PSOSIG)
"RTN","PSOORROC",81,0)
 Q
"RTN","PSOORROC",82,0)
 ;
"RTN","PSOORROC",83,0)
CHKLOCAL ; IF SAME RX NUMBER AND ISSUE DATE - LOCAL RX
"RTN","PSOORROC",84,0)
 N PSOISS
"RTN","PSOORROC",85,0)
 I $D(^PSRX("B",RDIRX)) D
"RTN","PSOORROC",86,0)
 .N PSORX
"RTN","PSOORROC",87,0)
 .S PSORX=$O(^PSRX("B",RDIRX,"")) I 'PSORX Q
"RTN","PSOORROC",88,0)
 .S PSOISS=$P($G(^PSRX(PSORX,0)),"^",13)
"RTN","PSOORROC",89,0)
 .S PSOISS=$E(PSOISS,4,5)_"/"_$E(PSOISS,6,7)_"/"_$E(PSOISS,2,3)
"RTN","PSOORROC",90,0)
 .I PSOISS=RDIISS S LOCAL=1 Q
"RTN","PSOORROC",91,0)
 Q
"RTN","PSOORROC",92,0)
 ;
"RTN","PSOORROC",93,0)
VAPROD(PSOPROD) ; GET VA PRODUCT FILE NAME AND DRUG CLASS
"RTN","PSOORROC",94,0)
 S PSOCLASS=$$DCLCODE^PSNAPIS(,PSOPROD)
"RTN","PSOORROC",95,0)
 S DRNM=$P($$PROD0^PSNAPIS(,PSOPROD),"^")
"RTN","PSOORROC",96,0)
 Q
"RTN","PSOORROC",97,0)
 ;
"RTN","PSOORROC",98,0)
DRGNAME ; 
"RTN","PSOORROC",99,0)
 N PSOY
"RTN","PSOORROC",100,0)
 S PSOY=DREN_"^"_$P($G(^PSDRUG(DREN,0)),"^"),PSOY(0)=$G(^PSDRUG(DREN,0))
"RTN","PSOORROC",101,0)
 S PSODRUG("IEN")=+PSOY,PSODRUG("VA CLASS")=$P(PSOY(0),"^",2)
"RTN","PSOORROC",102,0)
 S PSODRUG("NDF")=$S($G(^PSDRUG(+PSOY,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)
"RTN","PSOORROC",103,0)
 I PSODRUG("NDF")=0 Q
"RTN","PSOORROC",104,0)
 S PSOPROD=$P(PSODRUG("NDF"),"A",2) I PSOPROD D VAPROD(PSOPROD) S PSODRUG("NAME")=DRNM
"RTN","PSOORROC",105,0)
 Q
"RTN","PSOORROC",106,0)
 ;
"RTN","PSOORROC",107,0)
FILTER ; FOR SAME DRUG VUID FOR SAME SITE, KEEP 1 ENTRY - CHECK BY ACTIVE STATUS FIRST THEN BY GREATEST EXPIRATION DATE
"RTN","PSOORROC",108,0)
 N XX,RDI,OLDEXP,RDIEXP,RDIEXP2,OLDEXP2,PSORDI,RDISTA,OLDSTA,OLDRDI,ZZ
"RTN","PSOORROC",109,0)
 S PSORDI=0
"RTN","PSOORROC",110,0)
 F  S PSORDI=$O(^TMP($J,"PSORDI",PSORDI)) Q:'PSORDI  D
"RTN","PSOORROC",111,0)
 .S XX=$G(^TMP($J,"PSORDI",PSORDI)),RDIINST=$P(XX,"^"),RDIVUID=$P(XX,"^",2),RDISTA=$P(XX,"^",4),RDIEXP=$P(XX,"^",10) Q:RDIINST=""  Q:RDIVUID=""  I RDIEXP="" Q
"RTN","PSOORROC",112,0)
 .I $D(RDI(RDIINST,RDIVUID)) S ZZ=RDI(RDIINST,RDIVUID) D  Q
"RTN","PSOORROC",113,0)
 ..I RDISTA="ACTIVE"!(RDISTA["SUSPEN") D  Q
"RTN","PSOORROC",114,0)
 ...S OLDSTA=$P(ZZ,"^",2) I OLDSTA["ACTIVE"!(OLDSTA["SUSPEN") D CHKEXP Q
"RTN","PSOORROC",115,0)
 ...S OLDRDI=$P(ZZ,"^") K ^TMP($J,"PSORDI",OLDRDI) D SETRDI
"RTN","PSOORROC",116,0)
 ..S OLDSTA=$P(ZZ,"^",2) I OLDSTA["ACTIVE"!(OLDSTA["SUSPEN") K ^TMP($J,"PSORDI",PSORDI) Q
"RTN","PSOORROC",117,0)
 ..D CHKEXP ; ALL OTHER STATUSES - KEEP BY GREATER EXPIRATION DATE
"RTN","PSOORROC",118,0)
 .D SETRDI
"RTN","PSOORROC",119,0)
 Q
"RTN","PSOORROC",120,0)
 ;
"RTN","PSOORROC",121,0)
CHKEXP ; 
"RTN","PSOORROC",122,0)
 N PSOPRE
"RTN","PSOORROC",123,0)
 S OLDEXP=$P(ZZ,"^",3) D  I OLDEXP2>RDIEXP2 K ^TMP($J,"PSORDI",PSORDI) Q
"RTN","PSOORROC",124,0)
 .S PSOPRE=$E(DT) I $P(RDIEXP,"/",3)>($E(DT,2,3)+1) S PSOPRE=PSOPRE-1
"RTN","PSOORROC",125,0)
 .S RDIEXP2=PSOPRE_$P(RDIEXP,"/",3)_$P(RDIEXP,"/")_$P(RDIEXP,"/",2)
"RTN","PSOORROC",126,0)
 .S PSOPRE=$E(DT) I $P(OLDEXP,"/",3)>($E(DT,2,3)+1) S PSOPRE=PSOPRE-1
"RTN","PSOORROC",127,0)
 .S OLDEXP2=PSOPRE_$P(OLDEXP,"/",3)_$P(OLDEXP,"/")_$P(OLDEXP,"/",2)
"RTN","PSOORROC",128,0)
 S OLDRDI=$P(ZZ,"^") K ^TMP($J,"PSORDI",OLDRDI) D SETRDI
"RTN","PSOORROC",129,0)
 Q
"RTN","PSOORROC",130,0)
 ;
"RTN","PSOORROC",131,0)
SETRDI ;
"RTN","PSOORROC",132,0)
 S RDI(RDIINST,RDIVUID)=PSORDI_"^"_RDISTA_"^"_RDIEXP
"RTN","PSOORROC",133,0)
 Q
"RTN","PSOORROC",134,0)
 ;
"RTN","PSOORROC",135,0)
GETPROD ;
"RTN","PSOORROC",136,0)
 S PSOFILE=50.68
"RTN","PSOORROC",137,0)
 S DRNM="",PSOCLASS="",PSOPROD=0
"RTN","PSOORROC",138,0)
 N PSOPR
"RTN","PSOORROC",139,0)
 K PSOPRODA
"RTN","PSOORROC",140,0)
 N DIC
"RTN","PSOORROC",141,0)
 D GETIREF^XTID(PSOFILE,.01,RDIVUID,"PSOPRODA",1) I 'PSOPRODA Q
"RTN","PSOORROC",142,0)
 S PSOPR="" F  S PSOPR=$O(PSOPRODA(PSOFILE,.01,PSOPR)) Q:PSOPR=""  D  Q:DRNM'=""  Q:PSOCLASS'=""
"RTN","PSOORROC",143,0)
 .I +(PSOPRODA(PSOFILE,.01,PSOPR)) S PSOPROD=+PSOPR D VAPROD(PSOPROD) Q
"RTN","PSOORROC",144,0)
 .I +(PSOPRODA(PSOFILE,.01,PSOPR))=0 I '$O(PSOPRODA(PSOFILE,.01,PSOPR)) S PSOPROD=+PSOPR D VAPROD(PSOPROD) ; USE LAST ENTRY IF ALL ARE INACTIVE
"RTN","PSOORROC",145,0)
 Q
"RTN","PSOORROC",146,0)
 ;
"RTN","PSOORROC",147,0)
RDUP ;display Remote orders - duplicate drug
"RTN","PSOORROC",148,0)
 N PSOD0,PSOD1,PSOREMX,RDIINST,FSIG,PSOULN,PSOLF,PSORDI
"RTN","PSOORROC",149,0)
 S $P(PSOULN,"-",79)="",PSOT="DD"
"RTN","PSOORROC",150,0)
 S PSORDI=0 F  S PSORDI=$O(^TMP($J,"DD",PSORDI)) Q:'PSORDI  S PSOD0=^TMP($J,"DD",PSORDI,0),PSOD1=^(1),PSOREMX=$P($P(PSOD0,"^",4),";"),RDIINST=$P(PSOD0,"^",5),PSOLF=$P(PSOD1,"^",3) D
"RTN","PSOORROC",151,0)
 .W !,PSOULN,!,"Duplicate Drug in Remote Rx",!!
"RTN","PSOORROC",152,0)
 .W "Remote Location "_RDIINST,!,$J("Rx #: ",20)_$E(PSOREMX,1,$L(PSOREMX)-1),!,$J("Drug: ",20)_$P(PSOD1,"^")
"RTN","PSOORROC",153,0)
 .D FSIG^PSOORRD2(.FSIG)
"RTN","PSOORROC",154,0)
 .W !,$J("SIG: ",20) F I=1:1 Q:'$D(FSIG(I))  W ?20,FSIG(I),!
"RTN","PSOORROC",155,0)
 .W $J("QTY: ",20)_$P(PSOD1,"^",5),?44,$J("Refills remaining: ",20)_$P(PSOD1,"^",6)
"RTN","PSOORROC",156,0)
 .W !,$J("Provider: ",20)_$P(PSOD1,"^",8),?44,$J("Issued: ",20)_$P(PSOD1,"^",9)
"RTN","PSOORROC",157,0)
 .W !,$J("Status: ",20)_$P(PSOD1,"^",2),?44,$J("Last filled on: ",20)_PSOLF
"RTN","PSOORROC",158,0)
 .W !?44,$J("Days Supply: ",20)_$P(PSOD1,"^",4)
"RTN","PSOORROC",159,0)
 .K DIR W ! S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to continue..." D ^DIR W !
"RTN","PSOORROC",160,0)
 K PSOT,DIR,X,Y
"RTN","PSOORROC",161,0)
 Q
"RTN","PSOORUT1")
0^1^B78073421
"RTN","PSOORUT1",1,0)
PSOORUT1 ;BIR/SAB - Utility routine for oerr interface ;02/22/95
"RTN","PSOORUT1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,14,30,46,132,148,233,274,225,305,289,251**;DEC 1997;Build 202
"RTN","PSOORUT1",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORUT1",4,0)
 ;External reference to ^PSXOPUTL supported by DBIA 2203
"RTN","PSOORUT1",5,0)
 ;called from HD^PSOORUTL
"RTN","PSOORUT1",6,0)
REL ;removed order from hold
"RTN","PSOORUT1",7,0)
 S ACT=1,ORS=0
"RTN","PSOORUT1",8,0)
 I POERR("PSOFILNM")["S" S DA=+POERR("PSOFILNM") D  G EXIT^PSOORUTL
"RTN","PSOORUT1",9,0)
 .Q:'$D(^PS(52.41,DA,0))  Q:$P(^PS(52.41,DA,0),"^",3)="RF"
"RTN","PSOORUT1",10,0)
 .S $P(^PS(52.41,DA,0),"^",3)="NW",POERR("STAT")="OR",POERR("FILLER")=DA_"^P"
"RTN","PSOORUT1",11,0)
 .S:$G(POERR("COMM"))']"" POERR("COMM")="Order RELEASED from HOLD by OE/RR before finished." S $P(^PS(52.41,DA,4),"^")=POERR("COMM"),ORS=1
"RTN","PSOORUT1",12,0)
 S DA=POERR("PSOFILNM") I $D(^PSRX(DA,0)) S ORS=1,PSDA=DA D  G EXIT^PSOORUTL
"RTN","PSOORUT1",13,0)
 .S POERR("FILLER")=DA_"^R",POERR("STAT")="OR"
"RTN","PSOORUT1",14,0)
 .S:'$D(POERR("COMM")) POERR("COMM")="Prescription Released from HOLD by OE/RR"
"RTN","PSOORUT1",15,0)
 .I DT>$P(^PSRX(DA,2),"^",6) D
"RTN","PSOORUT1",16,0)
 ..S EXP=$P(^PSRX(DA,2),"^",6) S:$P(^PSRX(DA,"STA"),"^")<12 $P(^PSRX(DA,"STA"),"^")=11,PSOEXFLG=1 S POERR("STAT")="UR",POERR("COMM")="Medication Expired on "_$E(EXP,4,5)_"/"_$E(EXP,6,7)_"/"_$E(EXP,2,3)_".",POERR("PHARMST")="" D ECAN^PSOUTL(DA) Q
"RTN","PSOORUT1",17,0)
 .I $P(^PSRX(DA,"STA"),"^")'=16 S POERR("STAT")="UR",POERR("COMM")="Unable to Release from Hold" Q
"RTN","PSOORUT1",18,0)
 .S RXFL(DA)=0,FDT=$P(^PSRX(DA,2),"^",2)
"RTN","PSOORUT1",19,0)
 .I $O(^PSRX(DA,1,0)) F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S FDT=$P(^PSRX(DA,1,I,0),"^"),RXFL(DA)=I
"RTN","PSOORUT1",20,0)
 .I FDT>DT N PSOSITEZ,ZPSOPAR6 S PSOSITEZ=$S($P($G(^PSRX(DA,2)),"^",9):$P(^(2),"^",9),1:$O(^PS(59,0))),ZPSOPAR6=$P($G(^PS(59,PSOSITEZ,1)),"^",6) I ZPSOPAR6 D  Q
"RTN","PSOORUT1",21,0)
 ..S RXXDA=DA,DA=$O(^PS(52.5,"B",RXXDA,0)) I DA S DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOORUT1",22,0)
 ..S DA=RXXDA
"RTN","PSOORUT1",23,0)
 ..S DIC="^PS(52.5,",DIC(0)="L",DLAYGO=52.5,X=RXXDA,DIC("DR")=".02///"_FDT_";.03////"_$P(^PSRX(DA,0),"^",2)_";.04///M;.05///0;.06////"_PSOSITEZ_";2///0;9///"_RXFL(DA) K DD,DO D FILE^DICN K RXFL,DD,DO
"RTN","PSOORUT1",24,0)
 ..S DA=RXXDA K RXXDA S $P(^PSRX(DA,"STA"),"^")=5,LFD=$E(FDT,4,5)_"-"_$E(FDT,6,7)_"-"_$E(FDT,2,3) D ACT1
"RTN","PSOORUT1",25,0)
 ..S PSOSUSZ=1
"RTN","PSOORUT1",26,0)
 .E  S $P(^PSRX(DA,"STA"),"^")=0
"RTN","PSOORUT1",27,0)
 .S RXF=0 F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RXF=I S:I>5 RXF=I+1
"RTN","PSOORUT1",28,0)
 .D ACT^PSOORUTL
"RTN","PSOORUT1",29,0)
 .I $$SUBMIT^PSOBPSUT(DA) D ECMESND^PSOBPSU1(DA,,$$RXFLDT^PSOBPSUT(DA),$S('$O(^PSRX(DA,1,0)):"OF",1:"RF"))
"RTN","PSOORUT1",30,0)
 G EXIT^PSOORUTL
"RTN","PSOORUT1",31,0)
ACT1 I '$D(RXF) S RXF=0 F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RXF=I S:I>5 RXF=I+1
"RTN","PSOORUT1",32,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(DA,"A",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOORUT1",33,0)
 S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSOORUT1",34,0)
 D NOW^%DTC S ^PSRX(DA,"A",IR,0)=%_"^S^"_POERR("USER")_"^"_RXF_"^"_"RX Placed on Suspense until "_LFD
"RTN","PSOORUT1",35,0)
 Q
"RTN","PSOORUT1",36,0)
SUS ;
"RTN","PSOORUT1",37,0)
 I $P($G(^PSRX(+$G(FILLER),"STA")),"^")=5 N PSOMSORR,PLACERXX D EN^PSOHLSN1(+$G(FILLER),"SC","ZS","")
"RTN","PSOORUT1",38,0)
 Q
"RTN","PSOORUT1",39,0)
BLD ;builds med profile for Listman
"RTN","PSOORUT1",40,0)
 K PSODCREV,^TMP("PSOPF",$J),PSOLST S:$G(PSOOPT)'=3 PSOOPT=0 I '$G(PSOSD) S ^TMP("PSOPF",$J,1,0)="This patient has no prescriptions" S PSOCNT=0,PSOPF=1 Q
"RTN","PSOORUT1",41,0)
 D EOJ,SHOW
"RTN","PSOORUT1",42,0)
EOJ ;
"RTN","PSOORUT1",43,0)
 K PSOQFLG,PSODRG,PSODATA,PSOLF
"RTN","PSOORUT1",44,0)
 Q
"RTN","PSOORUT1",45,0)
 ;-----------------------------------------------------------------
"RTN","PSOORUT1",46,0)
SHOW ;
"RTN","PSOORUT1",47,0)
 ; - ePharmacy modification to create a section for Rx with REJECTs
"RTN","PSOORUT1",48,0)
 N PSOTMP,PSOSTS,PSODRNM,I,PSORX
"RTN","PSOORUT1",49,0)
 S (PSOSTS,PSODRNM)=""
"RTN","PSOORUT1",50,0)
 F  S PSOSTS=$O(PSOSD(PSOSTS)) Q:PSOSTS=""  D
"RTN","PSOORUT1",51,0)
 . F  S PSODRNM=$O(PSOSD(PSOSTS,PSODRNM)) Q:PSODRNM=""  D
"RTN","PSOORUT1",52,0)
 . . S PSORX=+$G(PSOSD(PSOSTS,PSODRNM))
"RTN","PSOORUT1",53,0)
 . . I PSOSTS="ACTIVE",$$FIND^PSOREJUT(PSORX,,,"79,88") D  Q
"RTN","PSOORUT1",54,0)
 . . . S PSOTMP(" REJECT",PSODRNM)=PSOSTS
"RTN","PSOORUT1",55,0)
 . . S PSOTMP(PSOSTS,PSODRNM)=PSOSTS
"RTN","PSOORUT1",56,0)
 ;
"RTN","PSOORUT1",57,0)
 S (PSOSTS,PSODRG)="",(PSOCNT,PSOQFLG,IEN)=0
"RTN","PSOORUT1",58,0)
 K RN,DL S $P(RN," ",12)=" ",$P(DL," ",40)=" "
"RTN","PSOORUT1",59,0)
 F PSCNT=0:0 S PSOSTS=$O(PSOTMP(PSOSTS)) Q:PSOSTS=""  D
"RTN","PSOORUT1",60,0)
 . D STA
"RTN","PSOORUT1",61,0)
 . F PSOCT=0:0 S PSODRG=$O(PSOTMP(PSOSTS,PSODRG)) Q:PSODRG=""  Q:PSOCNT>1000!PSOQFLG  D
"RTN","PSOORUT1",62,0)
 . . S PSOSTA=PSOTMP(PSOSTS,PSODRG)
"RTN","PSOORUT1",63,0)
 . . S PSODATA=PSOSD(PSOSTA,PSODRG) I PSOSTA="ZNONVA" D NVA Q
"RTN","PSOORUT1",64,0)
 . . S PSOCNT=PSOCNT+1 I PSOSTA="PENDING" D PEN Q
"RTN","PSOORUT1",65,0)
 . . S:'$D(^PSRX(+PSODATA,0)) PSOCNT=PSOCNT-1 D:$D(^(0)) DISPL
"RTN","PSOORUT1",66,0)
 S (VALMCNT,PSOPF)=IEN
"RTN","PSOORUT1",67,0)
SHOWX K DIRUT,DTOUT,DUOUT,DIROUT,PSODRG
"RTN","PSOORUT1",68,0)
 Q
"RTN","PSOORUT1",69,0)
 ;
"RTN","PSOORUT1",70,0)
DISPL S IEN=IEN+1 N PSOID,PSOCMOP,STATLTH,ECME
"RTN","PSOORUT1",71,0)
 K PSOLNT,PSOQTL,PSOLSP S PSOLRX=$S($G(^PSRX(+PSODATA,"IB")):13,1:14)-$L($P(^PSRX(+PSODATA,0),"^")),$P(PSOLNT," ",PSOLRX)=" ",PSODQL=$L($P(PSODRG,"^"))+$L($P(^PSRX(+PSODATA,0),"^",7))
"RTN","PSOORUT1",72,0)
 I PSODQL<39 S $P(PSOQTL," ",(40-PSODQL))=" "
"RTN","PSOORUT1",73,0)
 E  S $P(PSOQTL," ",(52-$L($P(^PSRX(+PSODATA,0),"^",7))))=" ",$P(PSOLSP," ",(41-$L($P(PSODRG,"^"))))=" "
"RTN","PSOORUT1",74,0)
 S ECME=$$ECME^PSOBPSUT(+PSODATA) I ECME'="" S PSOLNT=$E(PSOLNT,1,$L(PSOLNT)-1)
"RTN","PSOORUT1",75,0)
 S ^TMP("PSOPF",$J,IEN,0)=$J(PSOCNT,2)_$S($L(PSOCNT)<3:" ",1:"")_$P(^PSRX(+PSODATA,0),"^")_$S($G(^PSRX(+PSODATA,"IB")):"$",1:"")_ECME_PSOLNT_$P(PSODRG,"^")_$S(PSODQL<39:PSOQTL_$P(^PSRX(+PSODATA,0),"^",7)_" ",1:$G(PSOLSP))
"RTN","PSOORUT1",76,0)
 S STA="A^N^R^H^N^S^^^^^^E^DC^^DP^DE^HP^P^"
"RTN","PSOORUT1",77,0)
 S PSOCMOP=""
"RTN","PSOORUT1",78,0)
 I $D(^PSDRUG("AQ",$P(^PSRX(+PSODATA,0),"^",6))) S PSOCMOP=">"
"RTN","PSOORUT1",79,0)
 N X S X="PSXOPUTL" X ^%ZOSF("TEST") K X I $T D
"RTN","PSOORUT1",80,0)
 .N DA S DA=+PSODATA D ^PSXOPUTL K DA
"RTN","PSOORUT1",81,0)
 .I $G(PSXZ(PSXZ("L")))=0!($G(PSXZ(PSXZ("L")))=2) S PSOCMOP="T"
"RTN","PSOORUT1",82,0)
 .K PSXZ
"RTN","PSOORUT1",83,0)
 N PSOBADR
"RTN","PSOORUT1",84,0)
 S PSOBADR=$O(^PSRX(+PSODATA,"L",9999),-1)
"RTN","PSOORUT1",85,0)
 I PSOBADR'="" S PSOBADR=$G(^PSRX(+PSODATA,"L",PSOBADR,0)) I PSOBADR["(BAD ADDRESS)" S PSOBADR="B"
"RTN","PSOORUT1",86,0)
 I PSOBADR'="B" S PSOBADR=""
"RTN","PSOORUT1",87,0)
 S (STA,STATLTH)=$P(STA,"^",$P(PSODATA,"^",2)+1) D
"RTN","PSOORUT1",88,0)
 .I $G(^PSRX(+PSODATA,"DDSTA"))]"" S (STATLTH,STA)="DD" Q
"RTN","PSOORUT1",89,0)
 .S (STATLTH,STA)=$S($P($G(^PSRX(+PSODATA,7)),"^")=1:"DA",$P($G(^PSRX(+PSODATA,7)),"^")=2:"DF",1:STA)
"RTN","PSOORUT1",90,0)
 S STAPRT=STA_PSOCMOP_PSOBADR,STATLTH=$L(STAPRT)
"RTN","PSOORUT1",91,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_STAPRT_$S(STATLTH=0:"   ",STATLTH=1:"  ",STATLTH=2:" ",1:"")
"RTN","PSOORUT1",92,0)
 S PSOID=$P(^PSRX(+PSODATA,0),"^",13),PSOLF=+$G(^(3)),^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$E(PSOID,4,5)_"-"_$E(PSOID,6,7)_" "
"RTN","PSOORUT1",93,0)
 N RFLZRO,PSOLRD S PSOLRD=$P($G(^PSRX(+PSODATA,2)),"^",13)
"RTN","PSOORUT1",94,0)
 F PSOX=0:0 S PSOX=$O(^PSRX(+PSODATA,1,PSOX)) Q:'PSOX  D
"RTN","PSOORUT1",95,0)
 . S RFLZRO=$G(^PSRX(+PSODATA,1,PSOX,0))
"RTN","PSOORUT1",96,0)
 . I +RFLZRO=PSOLF,$P(RFLZRO,"^",16) S PSOLF=PSOLF_"^R"
"RTN","PSOORUT1",97,0)
 . S:$P(RFLZRO,"^",18)'="" PSOLRD=$P(RFLZRO,"^",18) I $P(RFLZRO,"^",16) S PSOLRD=PSOLRD_"^R"
"RTN","PSOORUT1",98,0)
 K PSOX
"RTN","PSOORUT1",99,0)
 I '$O(^PSRX(+PSODATA,1,0)),$P(^PSRX(+PSODATA,2),"^",15) S PSOLF=PSOLF_"^R",PSOLRD=PSOLRD_"^R"
"RTN","PSOORUT1",100,0)
 S PSOLF=$S($G(PSOLF):$E(PSOLF,4,5),1:"  ")_"-"_$S($G(PSOLF):$E(PSOLF,6,7),1:"  ")_$S($P(PSOLF,"^",2)="R":"R ",1:"  ")
"RTN","PSOORUT1",101,0)
 S PSOLRD=$S($G(PSOLRD):$E(PSOLRD,4,5),1:"  ")_"-"_$S($G(PSOLRD):$E(PSOLRD,6,7),1:"  ")_$S($P(PSOLRD,"^",2)="R":"R ",1:"  ")
"RTN","PSOORUT1",102,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$G(PSOLF) ;_$S($P(PSOLF,"^",2)="R":"R ",1:"  ")
"RTN","PSOORUT1",103,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$J($P(PSODATA,"^",6),2)_" "_$J($P(PSODATA,"^",8),3)
"RTN","PSOORUT1",104,0)
 ;recently dc'd rxs
"RTN","PSOORUT1",105,0)
 I $P($G(^PSRX(+PSODATA,3)),"^",5) D  K X
"RTN","PSOORUT1",106,0)
 .S X2=$S($P(PSOPAR,"^",33):$P(PSOPAR,"^",33),1:7),X1=$P(^PSRX(+PSODATA,3),"^",5) D C^%DTC
"RTN","PSOORUT1",107,0)
 .I DT<X S PSODCREV(IEN)=IEN
"RTN","PSOORUT1",108,0)
 ;recently expired rxs
"RTN","PSOORUT1",109,0)
 I $P($G(^PSRX(+PSODATA,2)),"^",6)<DT,'$P($G(^PSRX(+PSODATA,3)),"^",5) D  K X
"RTN","PSOORUT1",110,0)
 .S X2=$S($P(PSOPAR,"^",33):$P(PSOPAR,"^",33),1:7),X1=$P(^PSRX(+PSODATA,2),"^",6) D C^%DTC
"RTN","PSOORUT1",111,0)
 .I DT<X S PSODCREV(IEN)=IEN
"RTN","PSOORUT1",112,0)
 ;
"RTN","PSOORUT1",113,0)
 I PSODQL>38 S IEN=IEN+1 S ^TMP("PSOPF",$J,IEN,0)=PSOQTL_"Qty: "_$P(^PSRX(+PSODATA,0),"^",7)
"RTN","PSOORUT1",114,0)
 K PSOLNT,PSOQTL,PSOLSP,PSOLRX,PSODQL
"RTN","PSOORUT1",115,0)
 S PSOLST(PSOCNT)="52^"_+PSODATA_"^"_PSOSTA
"RTN","PSOORUT1",116,0)
 K PSODATA,PSOLF S PSOPF=IEN
"RTN","PSOORUT1",117,0)
 Q
"RTN","PSOORUT1",118,0)
 ;
"RTN","PSOORUT1",119,0)
STA N LABEL,LINE,POS
"RTN","PSOORUT1",120,0)
 S LABEL=PSOSTS,IEN=IEN+1
"RTN","PSOORUT1",121,0)
 I PSOSTS="ZNONVA" S LABEL="Non-VA MEDS (Not dispensed by VA)"
"RTN","PSOORUT1",122,0)
 I PSOSTS=" REJECT" S LABEL="REFILL TOO SOON/DUR REJECTS (Third Party)"
"RTN","PSOORUT1",123,0)
 S POS=80-$L(LABEL)/2,$P(LINE,"-",81)="",$E(LINE,POS+1,POS+$L(LABEL))=LABEL
"RTN","PSOORUT1",124,0)
 S ^TMP("PSOPF",$J,IEN,0)=LINE
"RTN","PSOORUT1",125,0)
 Q
"RTN","PSOORUT1",126,0)
PENX S PSOLST(PSOCNT)="52.41^"_$P(PSODATA,"^",10)_"^"_PSOSTA
"RTN","PSOORUT1",127,0)
 K PSODATA,PSOLF,RN,PSOLSP,PSOQTL,PSOLNT
"RTN","PSOORUT1",128,0)
 Q
"RTN","PSOORUT1",129,0)
PEN ;
"RTN","PSOORUT1",130,0)
 N PSOQTL,PSOLNT,PSOLNTZ,PSOQTLX,PSCMOPF,SPACEZ
"RTN","PSOORUT1",131,0)
 Q:'$D(^PS(52.41,$P(PSODATA,"^",10),0))
"RTN","PSOORUT1",132,0)
 S PSCMOPF=0 I $P($G(PSODATA),"^",11),$D(^PSDRUG("AQ",$P(PSODATA,"^",11))) S PSCMOPF=1
"RTN","PSOORUT1",133,0)
 S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)=$J(PSOCNT,2)_$S($L(PSOCNT)<3:" ",1:"")_$P(PSODRG,"^")
"RTN","PSOORUT1",134,0)
 I $P($G(^PS(52.41,+$P(PSODATA,"^",10),0)),"^",23)=1 S ^TMP("PSOPF",$J,IEN,"RV")=""
"RTN","PSOORUT1",135,0)
 S PSOLNT=$L($P(PSODRG,"^")),PSOLNTZ=$L($P(PSODATA,"^",8))
"RTN","PSOORUT1",136,0)
 S $P(PSOQTLX," ",(11-PSOLNTZ))=" "
"RTN","PSOORUT1",137,0)
 S:PSOLNT<37 $P(PSOQTL," ",(37-PSOLNT))=" "
"RTN","PSOORUT1",138,0)
 I PSOLNT<38 D  G PENX
"RTN","PSOORUT1",139,0)
 .I PSOLNT=37 S PSOQTL=""
"RTN","PSOORUT1",140,0)
 .I $P(^PS(52.41,$P(PSODATA,"^",10),0),"^",3)="RF" S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$G(PSOQTL)_"  Refill Request   Rx #: "_$P(^PSRX($P(^PS(52.41,$P(PSODATA,"^",10),0),"^",19),0),"^") Q
"RTN","PSOORUT1",141,0)
 .S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$G(PSOQTL)_"  "_"QTY: "_$P(PSODATA,"^",8)_$G(PSOQTLX)_" ISDT: "_$S('$P(PSODATA,"^",9):"     ",1:$E($P(PSODATA,"^",9),4,5)_"-"_$E($P(PSODATA,"^",9),6,7))_$S($G(PSCMOPF):"> ",1:"  ")
"RTN","PSOORUT1",142,0)
 .S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_"REF: "_$S($L($P(PSODATA,"^",6))>1:"",1:" ")_$P(PSODATA,"^",6)
"RTN","PSOORUT1",143,0)
 S IEN=IEN+1,$P(SPACEZ," ",42)=" "
"RTN","PSOORUT1",144,0)
 I $P(^PS(52.41,$P(PSODATA,"^",10),0),"^",3)="RF" S ^TMP("PSOPF",$J,IEN,0)=SPACEZ_"Refill Request   Rx #: "_$P(^PSRX($P(^PS(52.41,$P(PSODATA,"^",10),0),"^",19),0),"^") G PENX
"RTN","PSOORUT1",145,0)
 S ^TMP("PSOPF",$J,IEN,0)=SPACEZ_"QTY: "_$P(PSODATA,"^",8)_$G(PSOQTLX)_" ISDT: "_$S('$P(PSODATA,"^",9):"     ",1:$E($P(PSODATA,"^",9),4,5)_"-"_$E($P(PSODATA,"^",9),6,7))_$S($G(PSCMOPF):"> ",1:"  ")_"REF: "_$S($L($P(PSODATA,"^",6))>1:"",1:" ")
"RTN","PSOORUT1",146,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$P(PSODATA,"^",6)
"RTN","PSOORUT1",147,0)
 G PENX
"RTN","PSOORUT1",148,0)
 ;
"RTN","PSOORUT1",149,0)
NVA ; Setting the Non-VA Meds on the Medication Profile Screen (ListMan)
"RTN","PSOORUT1",150,0)
 S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)="  "_$P(PSODRG,"^")_" "
"RTN","PSOORUT1",151,0)
 I ($L(^TMP("PSOPF",$J,IEN,0))+$L($P(PSODATA,"^",6))>70) S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)="    "
"RTN","PSOORUT1",152,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$P(PSODATA,"^",6)_" "
"RTN","PSOORUT1",153,0)
 I ($L(^TMP("PSOPF",$J,IEN,0))+$L($P(PSODATA,"^",8))>70) S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)="    "
"RTN","PSOORUT1",154,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$P(PSODATA,"^",8)
"RTN","PSOORUT1",155,0)
 I ($L(^TMP("PSOPF",$J,IEN,0))+20)>70 D  Q
"RTN","PSOORUT1",156,0)
 . S IEN=IEN+1,$P(^TMP("PSOPF",$J,IEN,0)," ",51)="Date Documented: "_$E($P(PSODATA,"^",9),4,5)_"/"_$E($P(PSODATA,"^",9),6,7)_"/"_$E($P(PSODATA,"^",9),2,3)
"RTN","PSOORUT1",157,0)
 F I=0:0 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_" " Q:$L(^TMP("PSOPF",$J,IEN,0))>49
"RTN","PSOORUT1",158,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_"Date Documented: "_$E($P(PSODATA,"^",9),4,5)_"/"_$E($P(PSODATA,"^",9),6,7)_"/"_$E($P(PSODATA,"^",9),2,3)
"RTN","PSOORUT1",159,0)
 Q
"RTN","PSOP1")
0^40^B26371231
"RTN","PSOP1",1,0)
PSOP1 ;BHAM ISC/SAB - prints short medication profile ;02/25/94
"RTN","PSOP1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**15,46,103,132,148,233,326,251**;DEC 1997;Build 202
"RTN","PSOP1",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOP1",4,0)
 ;External reference to ^PS(50.605 supported by DBIA 696
"RTN","PSOP1",5,0)
 K RX,DTOUT,DIRUT,DIROUT,DUOUT
"RTN","PSOP1",6,0)
 D HD S DRUG="" F I=0:0 S DRUG=$O(^TMP($J,DRUG)) Q:DRUG=""!($G(PQT))  D  G:$D(DTOUT)!($D(DUOUT))!($D(DIROUT)) Q
"RTN","PSOP1",7,0)
 .F J=0:0 S J=$O(^TMP($J,DRUG,J)) Q:'J!($G(PQT))  S RX0=^(J),RX2=$G(^PSRX(J,2)),$P(RX0,"^",15)=$G(^("STA")),CP=$S(+$G(^PSRX(J,"IB")):"$",1:" ") S:$P(RX2,"^",15)&($P(RX2,"^",2)) RST($P(RX2,"^",2))=1 S:$P(RX0,"^",15)="" $P(RX0,"^",15)=-1 D W
"RTN","PSOP1",8,0)
 D:'$G(PQT) PEND^PSOP2,NVA^PSOP2
"RTN","PSOP1",9,0)
Q D ^%ZISC K ^TMP($J),PQT,PSODTCT,ST,D0,DIC,DIR,DIRUT,DUOUT,G,II,K,RXD,RXF,ZX,DRUG,X,DFN,PHYS,PSRT,CT,AL,I1,PLS,REF
"RTN","PSOP1",10,0)
 K LMI,PI,FN,Y,I,J,RX,DRX,ST,RX0,RX2,DA,PPPSTAT,PPP,EEEE,PPPCNT,PENDREX,PSOPEND,PPDIS,PPOI,PCOUNT,PP,FSIG,ZZZZ
"RTN","PSOP1",11,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOP1",12,0)
 Q
"RTN","PSOP1",13,0)
W I $Y+6>IOSL,$E(IOST)="C" D DIR W @IOF Q:$D(PQT)  D HD
"RTN","PSOP1",14,0)
 N PSOBADR
"RTN","PSOP1",15,0)
 U IO I IO'=IO(0),$Y+6>IOSL W @IOF D HD
"RTN","PSOP1",16,0)
 I $E(IOST)'="C",$Y+6>IOSL W @IOF D HD
"RTN","PSOP1",17,0)
 D STAT^PSOFUNC S STA="A^N^R^H^N^S^^^^^^E^DC^^DP^DE^PH",ST=$P(STA,"^",(ST0+1)) K STA
"RTN","PSOP1",18,0)
 S PSOBADR=$O(^PSRX(J,"L",9999),-1)
"RTN","PSOP1",19,0)
 I PSOBADR'="" S PSOBADR=$G(^PSRX(J,"L",PSOBADR,0)) I PSOBADR["(BAD ADDRESS)" S PSOBADR="B"
"RTN","PSOP1",20,0)
 I PSOBADR'="B" S PSOBADR=""
"RTN","PSOP1",21,0)
 S ST=ST_PSOBADR
"RTN","PSOP1",22,0)
 W !,CP_$P(RX0,"^"),$$ECME^PSOBPSUT(J),?13,$S($D(^PSDRUG(+$P(RX0,"^",6),0)):$P(^(0),"^"),1:"NOT ON FILE"),?54,$S($L(ST)=1:" "_ST,1:ST)
"RTN","PSOP1",23,0)
 S RXD=$P($G(^PSRX(J,3)),"^"),RXF=$P(RX0,"^",9) F II=0:0 S II=$O(^PSRX(J,1,II)) Q:'II  S RXF=RXF-1 S:$P(^PSRX(J,1,II,0),"^",16) RST($P(^(0),"^"))=1
"RTN","PSOP1",24,0)
 W ?58,$S($L(RXF)=1:" "_RXF,1:RXF)
"RTN","PSOP1",25,0)
 W ?61,$E($P(RX0,"^",13),4,5)_"-"_$E($P(RX0,"^",13),6,7)_"-"_$E($P(RX0,"^",13),2,3) W:RXD ?70,$E(RXD,4,5)_"-"_$E(RXD,6,7)_"-"_$E(RXD,2,3)_$S($G(RST(RXD)):"R",1:"")
"RTN","PSOP1",26,0)
 S PSOPRSIG=$P($G(^PSRX(J,"SIG")),"^",2) K FSIG,BSIG D
"RTN","PSOP1",27,0)
 .I PSOPRSIG D FSIG^PSOUTLA("R",J,50) Q
"RTN","PSOP1",28,0)
 .D EN2^PSOUTLA1(J,50) F GGGG=0:0 S GGGG=$O(BSIG(GGGG)) Q:'GGGG  S FSIG(GGGG)=BSIG(GGGG)
"RTN","PSOP1",29,0)
 K PSOPRSIG,GGGG,BSIG
"RTN","PSOP1",30,0)
 W !?5,"QTY: ",$P(RX0,"^",7),?24,"SIG: ",$G(FSIG(1)) D:$O(FSIG(1))
"RTN","PSOP1",31,0)
 .F GGGG=1:0 S GGGG=$O(FSIG(GGGG)) Q:'GGGG!($G(PQT))  W !,?29,$G(FSIG(GGGG)) D:$Y+5>IOSL&($E(IOST)="C") DIR Q:$G(PQT)  I '$G(PQT),($Y+5>IOSL) W @IOF D HD
"RTN","PSOP1",32,0)
 K GGGG,FSIG Q:$G(PQT)
"RTN","PSOP1",33,0)
 ;D SIG
"RTN","PSOP1",34,0)
 K RST Q
"RTN","PSOP1",35,0)
HD D:PAGE>1
"RTN","PSOP1",36,0)
 .W !,"Patient: "_$P(^DPT(DFN,0),"^")_" ("_$E($P(^DPT(DFN,0),"^",9),6,9)_")",?70,"Page: "_PAGE
"RTN","PSOP1",37,0)
 .W !?(80-$L("Medication Profile Sorted by "_HDR))/2,"Medication Profile Sorted by "_HDR W:$G(FR)]"" !?(80-$L(FR_" to "_TO))/2,FR_" to "_TO
"RTN","PSOP1",38,0)
 W !?57,"REF",!?1,"Rx#",?13,"Drug",?54,"ST",?57,"REM",?62,"Issued",?70,"Last Fill",!,PSOPLINE S PAGE=PAGE+1
"RTN","PSOP1",39,0)
 Q
"RTN","PSOP1",40,0)
SORT K DIR,DUOUT,DTOUT
"RTN","PSOP1",41,0)
 S DIR("B")="All",DIR("A",1)=" ",DIR("A")="All Medications or Selection (A/S): ",DIR(0)="SAM^A:All;S:Select Range",DIR("?",1)="Enter 'A' to Print Entire Medication Profile",DIR("?")="   or 'S' for Selection Range" D ^DIR
"RTN","PSOP1",42,0)
 K DIR Q:$D(DIRUT)!(Y="A")!(Y="E")  D @PSRT
"RTN","PSOP1",43,0)
 Q
"RTN","PSOP1",44,0)
DATE ;asks date range
"RTN","PSOP1",45,0)
 W ! K %DT S %DT="AEX",%DT("A")="Starting Date: " D ^%DT  I "^"[X S DUOUT=1 Q
"RTN","PSOP1",46,0)
 G:Y<0 DATE S SDT=+Y,%DT(0)=SDT,FR=$E(SDT,4,5)_"/"_$E(SDT,6,7)_"/"_$E(SDT,2,3)
"RTN","PSOP1",47,0)
EDT S %DT("A")="Ending Date: " D ^%DT  I "^"[X S DUOUT=1 Q
"RTN","PSOP1",48,0)
 G:Y<0 EDT S EDT=+Y,DTS=1,TO=$E(EDT,4,5)_"/"_$E(EDT,6,7)_"/"_$E(EDT,2,3)
"RTN","PSOP1",49,0)
 K %DT Q
"RTN","PSOP1",50,0)
DRUG ;asks drug list
"RTN","PSOP1",51,0)
 W ! S DIC("A")="Start with Drug: ",DIC(0)="AEMQ",DIC=50
"RTN","PSOP1",52,0)
 S DIC("S")="I $S('$D(^PSDRUG(Y,""I"")):1,'^(""I""):1,DT'>^(""I""):1,1:0),$S('$D(^PSDRUG(Y,2)):1,$P(^(2),""^"",3)'[""O"":0,1:1)"
"RTN","PSOP1",53,0)
 D ^DIC I "^"[X S DUOUT=1 K DIC Q
"RTN","PSOP1",54,0)
 G:Y<0 DRUG S FR=$P(Y,"^",2)
"RTN","PSOP1",55,0)
 F %=$L($E(FR,1,30)):-1:1 S M=$A(FR,%) I M>32 S Y1=$E(FR,1,%-1)_$C(M-1)_$C(122) Q
"RTN","PSOP1",56,0)
 S PSFR=Y1 K Y1,Y,X
"RTN","PSOP1",57,0)
TO S DIC("A")="To Drug: " D ^DIC I "^"[X S DUOUT=1 K DIC Q
"RTN","PSOP1",58,0)
 G:Y<0 TO I FR]$P(Y,"^",2) W !,$C(7),"Less Than 'Start' Value" K X,Y G TO
"RTN","PSOP1",59,0)
 S TO=$P(Y,"^",2),DRS=1
"RTN","PSOP1",60,0)
 F %=$L($E(TO,1,30)):-1:1 S M=$A(TO,%) I M>32 S Y1=$E(TO,1,%-1)_$C(M+1)_$C(122) Q
"RTN","PSOP1",61,0)
 S PSTO=Y1 K Y1,Y,X,DIC
"RTN","PSOP1",62,0)
 Q
"RTN","PSOP1",63,0)
CLSS ;asks drug class list
"RTN","PSOP1",64,0)
 W ! S DIC("A")="Start with Drug Class: ",DIC(0)="AEQ",DIC=50.605 D ^DIC I "^"[X S DUOUT=1 Q
"RTN","PSOP1",65,0)
 G:Y<0 CLSS S FR=$P(Y,"^",2)
"RTN","PSOP1",66,0)
 F %=$L($E(FR,1,30)):-1:1 S M=$A(FR,%) I M>32 S Y1=$E(FR,1,%-1)_$C(M-1)_$C(122) Q
"RTN","PSOP1",67,0)
 S PSFR=Y1 K Y1,Y,X
"RTN","PSOP1",68,0)
TO1 S DIC("A")="To Drug Class: " D ^DIC I "^"[X S DUOUT=1 Q
"RTN","PSOP1",69,0)
 G:Y<0 TO1 I FR]$P(Y,"^",2) W !,$C(7),"Less Than 'Start' Value" K X,Y G TO1
"RTN","PSOP1",70,0)
 S TO=$P(Y,"^",2)
"RTN","PSOP1",71,0)
 F %=$L($E(TO,1,30)):-1:1 S M=$A(TO,%) I M>32 S Y1=$E(TO,1,%-1)_$C(M+1)_$C(122) Q
"RTN","PSOP1",72,0)
 S PSTO=Y1,CLS=1 K Y,Y1,X
"RTN","PSOP1",73,0)
 Q
"RTN","PSOP1",74,0)
DIR K PQT,DTOUT,DUOUT,DIR,DIRUT S DIR(0)="E" D ^DIR S:$D(DUOUT)!($D(DTOUT)) PQT=1 Q
"RTN","PSOP1",75,0)
SIG I '$P(^PSRX(J,"SIG"),"^",2) D  Q
"RTN","PSOP1",76,0)
 .S X=$P(^PSRX(J,"SIG"),"^") D SIGONE^PSOHELP S SIG=$E($G(INS1),2,250)
"RTN","PSOP1",77,0)
 .F SG=1:1:$L(SIG) W:($X+$L($P(SIG," ",SG)_" "))>$S(IOST["C-":IOM,1:70) !?6 W:$P(SIG," ",SG)]"" $P(SIG," ",SG)_" "
"RTN","PSOP1",78,0)
 S MIG=$P(^PSRX(J,"SIG"),"^"),SIGOK=1 D
"RTN","PSOP1",79,0)
 .F SG=1:1:$L(MIG) Q:$P(MIG," ",SG)=""  W:($X+$L($P(MIG," ",SG)_" "))>$S(IOST["C-":IOM,1:70) !?6 W $P(MIG," ",SG)_" "
"RTN","PSOP1",80,0)
 F I=0:0 S I=$O(^PSRX(RXN,"SIG1",I)) Q:'I  S MIG=$P(^PSRX(RXN,"SIG1",I,0),"^") D
"RTN","PSOP1",81,0)
 .F SG=1:1:$L(MIG) Q:$P(MIG," ",SG)=""  W:($X+$L($P(MIG," ",SG)_" "))>$S(IOST["C-":IOM,1:70) !?6 W $P(MIG," ",SG)_" "
"RTN","PSOP1",82,0)
 Q
"RTN","PSORENW0")
0^33^B84117072
"RTN","PSORENW0",1,0)
PSORENW0 ;IHS/DSD/JCM-renew main driver continuation ;2/8/06 8:40am
"RTN","PSORENW0",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,27,32,59,64,46,71,96,100,130,237,206,251**;DEC 1997;Build 202
"RTN","PSORENW0",3,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSORENW0",4,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSORENW0",5,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSORENW0",6,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5424
"RTN","PSORENW0",7,0)
 ;
"RTN","PSORENW0",8,0)
 ;PSO*237 was not adding to Clozapine Override file, fix
"RTN","PSORENW0",9,0)
PROCESS ;
"RTN","PSORENW0",10,0)
 D ^PSORENW1
"RTN","PSORENW0",11,0)
 D INST2^PSORENW
"RTN","PSORENW0",12,0)
 I $D(PSORX("BAR CODE")),PSODFN'=PSORENW("PSODFN") D NEWPT
"RTN","PSORENW0",13,0)
 S PSORENW("DFLG")=0,PSORENW("FILL DATE")=PSORNW("FILL DATE")
"RTN","PSORENW0",14,0)
 I $G(PSORNW("MAIL/WINDOW"))]"" S PSORENW("MAIL/WINDOW")=PSORNW("MAIL/WINDOW")
"RTN","PSORENW0",15,0)
 W !!,"Now Renewing Rx # "_PSORENW("ORX #")_"   Drug: "_$P($G(^PSDRUG(+$G(PSORENW("DRUG IEN")),0)),"^"),!
"RTN","PSORENW0",16,0)
 D CHECK G:PSORENW("DFLG") PROCESSX
"RTN","PSORENW0",17,0)
 D FILDATE
"RTN","PSORENW0",18,0)
 D DRUG G:PSORENW("DFLG")!PSORX("DFLG") PROCESSX
"RTN","PSORENW0",19,0)
 D RXN G:PSORENW("DFLG") PROCESSX
"RTN","PSORENW0",20,0)
 D STOP^PSORENW1,OERR^PSORENW1:$G(PSOFDR)
"RTN","PSORENW0",21,0)
DSPL K PSOEDT,PSOLM D DSPLY^PSORENW3 G:PSORENW("DFLG") PROCESSX
"RTN","PSORENW0",22,0)
 S PSORENW("QFLG")=0 D:'$G(PSOFDR) EDIT
"RTN","PSORENW0",23,0)
 G:PSORENW("DFLG")!$G(PSORX("FN")) PROCESSX
"RTN","PSORENW0",24,0)
 G:'$G(PSORX("FN"))&('$G(PSORENW("QFLG"))) DSPL
"RTN","PSORENW0",25,0)
 D:$D(^XUSEC("PSORPH",DUZ))!('$P(PSOPAR,"^",2)) VER1^PSOORNE4(.PSORENW) I PSORENW("DFLG")=1 G PROCESSX
"RTN","PSORENW0",26,0)
 I $G(NEWDOSE),PSORENW("ENT")>0 K NEWDOSE G DSPL
"RTN","PSORENW0",27,0)
 D EN^PSORN52(.PSORENW)
"RTN","PSORENW0",28,0)
 D RNPSOSD^PSOUTIL
"RTN","PSORENW0",29,0)
 D CAN,DCORD^PSONEW2
"RTN","PSORENW0",30,0)
 S BBRN="",BBRN1=$O(^PSRX("B",PSORENW("NRX #"),BBRN)) I $P($G(^PSRX(BBRN1,0)),"^",11)["W" S BINGCRT="Y",BINGRTE="W"
"RTN","PSORENW0",31,0)
 ;PSO*237 add to Clozapine Override file
"RTN","PSORENW0",32,0)
ANQ I $G(ANQDATA)]"" D NOW^%DTC G:$D(^PS(52.52,"B",%)) ANQ D
"RTN","PSORENW0",33,0)
 . K DD,DO S DIC="^PS(52.52,",DIC(0)="L",DLAYGO=52.52,X=%
"RTN","PSORENW0",34,0)
 . D FILE^DICN K DIC,DLAYGO,DD,DO,DA,DR
"RTN","PSORENW0",35,0)
 . N PS52 S (PS52,DA)=+Y,DIE="^PS(52.52,",DR="1////"_PSORENW("IRXN")
"RTN","PSORENW0",36,0)
 . D ^DIE K DIE,DA,DR
"RTN","PSORENW0",37,0)
 . S $P(^PS(52.52,PS52,0),"^",3,6)=ANQDATA
"RTN","PSORENW0",38,0)
 . K ANQDATA,X,Y,%,ANQREM
"RTN","PSORENW0",39,0)
 ;
"RTN","PSORENW0",40,0)
PROCESSX I PSORENW("DFLG")!$G(PSRX("DFLG")) S PSOBBCLK=1 W:'$G(POERR) !,$C(7),"RENEWED RX DELETED",! S PSORERR=1 D:$P($G(PSOLST(+$G(ORN))),"^",2) PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) S POERR("DFLG")=1 D CLEAN^PSOVER1 D
"RTN","PSORENW0",41,0)
 .W !! K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to Continue" D ^DIR K DIR,DTOUT,DUOUT
"RTN","PSORENW0",42,0)
 D:$G(PSORENW("OLD FILL DATE"))]"" SUSDATEK^PSOUTIL(.PSORENW)
"RTN","PSORENW0",43,0)
 K PRC,PHI,PSOQUIT,BBRN,BBRN1,PSORENW,PSODRUG,PSORX("PROVIDER NAME"),PSORX("CLINIC"),PSORX("FN")
"RTN","PSORENW0",44,0)
 K PSOEDT,PSOLM S:$G(PSORENW("FROM"))="" (PSORENW("DFLG"),PSORENW("QFLG"))=0
"RTN","PSORENW0",45,0)
 D CLEAN^PSOVER1
"RTN","PSORENW0",46,0)
 Q
"RTN","PSORENW0",47,0)
 ;
"RTN","PSORENW0",48,0)
CHECK ;
"RTN","PSORENW0",49,0)
 I '$D(PSORX("BAR CODE")),PSORENW("PSODFN")'=PSODFN D  G CHECKX
"RTN","PSORENW0",50,0)
 .W !!,?5,$C(7),"Can't renew Rx # "_$P(PSORENW("RX0"),"^")_", it is not for this patient." S PSORENW("DFLG")=1
"RTN","PSORENW0",51,0)
 .S:$G(POERR) VALMSG="Can't renew Rx # "_$P(PSORENW("RX0"),"^")_", not for this patient.",VALMBCK="R"
"RTN","PSORENW0",52,0)
 ;Invalid dosage check
"RTN","PSORENW0",53,0)
 N PSOOCPRX,PSOOLPF,PSOOLPD,PSONOSIG S PSOOCPRX=PSORENW("OIRXN") D CDOSE
"RTN","PSORENW0",54,0)
 I PSOOLPF!(PSONOSIG) D  G CHECKX
"RTN","PSORENW0",55,0)
 .S PSORENW("DFLG")=1
"RTN","PSORENW0",56,0)
 .W !!,$C(7),"Cannot renew Rx # "_$P(PSORENW("RX0"),"^")_$S(PSOOLPF:", invalid dosage of "_$G(PSOOLPD),1:", Missing Sig")
"RTN","PSORENW0",57,0)
 .S:$G(POERR) VALMSG="Cannot renew Rx # "_$P(PSORENW("RX0"),"^")_$S(PSOOLPF:", invalid Dosage of "_$G(PSOOLPD),1:", Missing Sig") S VALMBCK="R"
"RTN","PSORENW0",58,0)
 .I '$G(PSORNSPD) W ! K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to Continue" D ^DIR K DIR
"RTN","PSORENW0",59,0)
 .I $G(PSORNSPD) W !
"RTN","PSORENW0",60,0)
 ;
"RTN","PSORENW0",61,0)
 S (PSOS,PSOX,PSOY)="" K ACOM,DIR,DIRUT,DIRUT,DUOUT
"RTN","PSORENW0",62,0)
 I $G(PSOSD) F  S PSOS=$O(PSOSD(PSOS)) Q:PSOS=""  F  S PSOX=$O(PSOSD(PSOS,PSOX)) Q:PSOX']""!(PSORENW("DFLG"))  I PSORENW("OIRXN")=+PSOSD(PSOS,PSOX) S PSOY=PSOSD(PSOS,PSOX) I $TR($P(PSOY,"^",3),"B")]"" D  K ACOM,DIR,DIRUT,DIRUT,DUOUT
"RTN","PSORENW0",63,0)
 . S PSORENW("DFLG")=1
"RTN","PSORENW0",64,0)
 . W !,$C(7),"Cannot renew Rx # ",$P(PSORENW("RX0"),"^")
"RTN","PSORENW0",65,0)
 . S PSOREA=$P(PSOY,"^",3),PSOSTAT=+PSORENW("STA")
"RTN","PSORENW0",66,0)
 . D STATUS^PSOUTIL(PSOREA,PSOSTAT) K PSOREA,PSOSTAT
"RTN","PSORENW0",67,0)
 .I $G(ACOM)]"" D
"RTN","PSORENW0",68,0)
 ..S DRG=$P(^PSDRUG($P(^PSRX(PSORENW("OIRXN"),0),"^",6),0),"^")
"RTN","PSORENW0",69,0)
 ..W ! S DIR(0)="Y",DIR("A",1)="Do you want to Discontinue this Pending Order",DIR("A")="for "_DRG,DIR("B")="No"
"RTN","PSORENW0",70,0)
 ..D ^DIR I 'Y!($D(DIRUT)) Q
"RTN","PSORENW0",71,0)
 ..D NOOR^PSOCAN4 Q:$D(DIRUT)  D DE^PSOORFI2
"RTN","PSORENW0",72,0)
 .Q
"RTN","PSORENW0",73,0)
 I PSOY="",'$G(PSOORRNW) D
"RTN","PSORENW0",74,0)
 .W !,$C(7),"Cannot renew Rx # ",$P(PSORENW("RX0"),"^")," later Rx exists." S PSORENW("DFLG")=1
"RTN","PSORENW0",75,0)
 .S:$G(POERR) VALMSG="Cannot renew Rx # "_$P(PSORENW("RX0"),"^")_" later Rx exists.",VALMBCK="R"
"RTN","PSORENW0",76,0)
 K PSOX,PSOY G:PSORENW("DFLG") CHECKX
"RTN","PSORENW0",77,0)
 ;
"RTN","PSORENW0",78,0)
 I $A($E(PSORENW("ORX #"),$L(PSORENW("ORX #"))))'<90 D  Q
"RTN","PSORENW0",79,0)
 . W !,$C(7),"Cannot renew Rx # "_PSORENW("ORX #")_", Max number of renewals reached."
"RTN","PSORENW0",80,0)
 .S:$G(POERR)!('$G(SPEED)) (ACOM,VALMSG)="Cannot renew Rx # "_PSORENW("ORX #")_", Max number reached.",VALMBCK="R"
"RTN","PSORENW0",81,0)
 . S PSORENW("DFLG")=1
"RTN","PSORENW0",82,0)
 .I $G(OR0)]"" D
"RTN","PSORENW0",83,0)
 ..S DRG=$P(^PSDRUG($P(^PSRX(PSORENW("OIRXN"),0),"^",6),0),"^")
"RTN","PSORENW0",84,0)
 ..W ! S DIR(0)="Y",DIR("A",1)="Do you want to Discontinue this Pending Order",DIR("A")="for "_DRG,DIR("B")="No"
"RTN","PSORENW0",85,0)
 ..D ^DIR I 'Y!($D(DIRUT)) Q
"RTN","PSORENW0",86,0)
 ..D NOOR^PSOCAN4 Q:$D(DIRUT)  D DE^PSOORFI2
"RTN","PSORENW0",87,0)
 .K ACOM Q
"RTN","PSORENW0",88,0)
 D CHKDIV G:PSORENW("DFLG") CHECKX
"RTN","PSORENW0",89,0)
 ;
"RTN","PSORENW0",90,0)
 D CHKPRV^PSOUTIL
"RTN","PSORENW0",91,0)
CHECKX Q
"RTN","PSORENW0",92,0)
 ;
"RTN","PSORENW0",93,0)
CHKDIV ;
"RTN","PSORENW0",94,0)
 G:$P(PSORENW("RX2"),"^",9)=+PSOSITE CHKDIVX
"RTN","PSORENW0",95,0)
 W !?5,$C(7),"RX # ",$P(PSORENW("RX0"),"^")," is for (",$P(^PS(59,$P(PSORENW("RX2"),"^",9),0),"^"),") division."
"RTN","PSORENW0",96,0)
 I '$P($G(PSOSYS),"^",2) S PSORENW("DFLG")=1 G CHKDIVX
"RTN","PSORENW0",97,0)
 D:$P($G(PSOSYS),"^",3) DIR
"RTN","PSORENW0",98,0)
CHKDIVX Q
"RTN","PSORENW0",99,0)
 ;
"RTN","PSORENW0",100,0)
DRUG ;
"RTN","PSORENW0",101,0)
 K PSOY
"RTN","PSORENW0",102,0)
 S PSOY=PSORENW("DRUG IEN"),PSOY(0)=^PSDRUG(PSOY,0)
"RTN","PSORENW0",103,0)
 I '$P($G(^PSDRUG(PSOY,2)),"^") D  Q:$G(PSORX("DFLG"))
"RTN","PSORENW0",104,0)
 .I $P($G(^PSRX(PSORENW("OIRXN"),"OR1")),"^") S PSODRUG("OI")=$P(^PSRX(PSORENW("OIRXN"),"OR1"),"^"),PSODRUG("OIN")=$P(^PS(50.7,+^("OR1"),0),"^") Q
"RTN","PSORENW0",105,0)
 .W !!,"Cannot Renew!!  No Pharmacy Orderable Item!" S VALMSG="Cannot Renew!!  No Pharmacy Orderable Item!",PSORX("DFLG")=1
"RTN","PSORENW0",106,0)
 D SET^PSODRG
"RTN","PSORENW0",107,0)
 D POST^PSODRG D:$$DS^PSSDSAPI&('PSORX("DFLG")) DOSCK^PSODOSUT("R") S:$G(PSORX("DFLG")) PSORENW("DFLG")=1 ;remove order checks for v7. do allergy checks only
"RTN","PSORENW0",108,0)
 S PSONOOR=PSORENW("NOO")
"RTN","PSORENW0",109,0)
 K PSORX("INTERVENE")
"RTN","PSORENW0",110,0)
 S:$D(PSONEW("STATUS")) PSORENW("STATUS")=PSONEW("STATUS")
"RTN","PSORENW0",111,0)
 K PSOY,PSONEW("STATUS")
"RTN","PSORENW0",112,0)
 Q
"RTN","PSORENW0",113,0)
 ;
"RTN","PSORENW0",114,0)
RXN ;
"RTN","PSORENW0",115,0)
 K PSOX
"RTN","PSORENW0",116,0)
 S PSOX=$E(PSORENW("ORX #"),$L(PSORENW("ORX #")))
"RTN","PSORENW0",117,0)
 S PSORENW("NRX #")=$S(PSOX?1N:PSORENW("ORX #")_"A",1:$E(PSORENW("ORX #"),1,$L(PSORENW("ORX #"))-1)_$C($A(PSOX)+1))
"RTN","PSORENW0",118,0)
RETRY I $O(^PSRX("B",PSORENW("NRX #"),0)) D  G:'$G(PSORENW("DFLG")) RETRY
"RTN","PSORENW0",119,0)
 .W:$A($E(PSORENW("NRX #"),$L(PSORENW("ORX #"))))'=90 !,"Rx # "_PSORENW("NRX #")_" is already on file."
"RTN","PSORENW0",120,0)
 .S:$G(PSOFDR) VALMSG="Rx # "_PSORENW("NRX #")_" is already on file."
"RTN","PSORENW0",121,0)
 .I $A($E(PSORENW("NRX #"),$L(PSORENW("ORX #"))))=90 D
"RTN","PSORENW0",122,0)
 ..W !,"Rx # "_PSORENW("NRX #")_" is already on file. Cannot renew Rx #"_PSORENW("ORX #")_".",!,"A new Rx must be entered.",!
"RTN","PSORENW0",123,0)
 ..S:$G(PSOFDR) VALMSG="Rx # "_PSORENW("NRX #")_" is already on file. Cannot renew Rx #"_PSORENW("ORX #")_". A new Rx must be entered."
"RTN","PSORENW0",124,0)
 ..K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to Continue" D ^DIR K DIR
"RTN","PSORENW0",125,0)
 ..S:$G(POERR)!($G(PSOFDR)) VALMSG="Cannot renew Rx # "_PSORENW("ORX #")_", Max number reached.",VALMBCK="R" S PSORENW("DFLG")=1
"RTN","PSORENW0",126,0)
 .S PSOX=$E(PSORENW("NRX #"),$L(PSORENW("NRX #")))
"RTN","PSORENW0",127,0)
 .S PSORENW("NRX #")=$S(PSOX?1N:PSORENW("NRX #")_"A",1:$E(PSORENW("NRX #"),1,$L(PSORENW("NRX #"))-1)_$C($A(PSOX)+1))
"RTN","PSORENW0",128,0)
RXNX K PSOX
"RTN","PSORENW0",129,0)
 Q
"RTN","PSORENW0",130,0)
 ;
"RTN","PSORENW0",131,0)
FILDATE ;
"RTN","PSORENW0",132,0)
 S PSORENW("IRXN")=PSORENW("OIRXN")
"RTN","PSORENW0",133,0)
 D NEXT^PSOUTIL(.PSORENW)
"RTN","PSORENW0",134,0)
 I PSORENW("FILL DATE")<$P(PSORENW("RX3"),"^",2) D
"RTN","PSORENW0",135,0)
 .D RENFDT^PSOUTIL(.PSORENW)
"RTN","PSORENW0",136,0)
 .I PSORENW("FILL DATE")<DT,PSORENW("FILL DATE")<PSORNW("FILL DATE") S (Y,PSORENW("FILL DATE"))=DT X ^DD("DD") S PSORX("FILL DATE")=Y K Y
"RTN","PSORENW0",137,0)
 K PSORENW("IRXN")
"RTN","PSORENW0",138,0)
 Q
"RTN","PSORENW0",139,0)
 ;
"RTN","PSORENW0",140,0)
EDIT ;
"RTN","PSORENW0",141,0)
 K DIR,X,Y
"RTN","PSORENW0",142,0)
 S DIR(0)="Y",DIR("B")=$S($G(DUZ("AG"))'="I":"Y",$G(PSEXDT):"Y",1:"N")
"RTN","PSORENW0",143,0)
 S DIR("A")="Edit renewed Rx ",DIR("?")="Answer YES to edit the renewed Rx, NO not to."
"RTN","PSORENW0",144,0)
 D ^DIR K DIR S:$D(DIRUT) PSORENW("DFLG")=1
"RTN","PSORENW0",145,0)
 G:PSORENW("DFLG") EDITX
"RTN","PSORENW0",146,0)
 K PSOQUIT,PSORX("FN") I Y D INIT^PSORENW3,EN^PSOORNE4(.PSORENW) S:$G(PSOQUIT) PSORENW("DFLG")=1 I '$G(PSORX("FN")) D FULL^VALM1 Q
"RTN","PSORENW0",147,0)
 Q:$G(PSORX("FN"))
"RTN","PSORENW0",148,0)
EDITX S PSOEDT=1,VALMBCK="Q" K X,Y,DIRUT,DTOUT,DUOUT S PSORENW("QFLG")=1
"RTN","PSORENW0",149,0)
 Q
"RTN","PSORENW0",150,0)
 ;
"RTN","PSORENW0",151,0)
DELETE ;
"RTN","PSORENW0",152,0)
 K DA,DIK
"RTN","PSORENW0",153,0)
 S DA=$O(^PS(52.5,"B",PSORENW("OIRXN"),0)),DIK="^PS(52.5,"
"RTN","PSORENW0",154,0)
 D ^DIK K DIK,DIC
"RTN","PSORENW0",155,0)
 Q
"RTN","PSORENW0",156,0)
 ;
"RTN","PSORENW0",157,0)
CAN ;
"RTN","PSORENW0",158,0)
 K REA,DA,MSG
"RTN","PSORENW0",159,0)
 S REA="C",DA=PSORENW("OIRXN")
"RTN","PSORENW0",160,0)
 S MSG="Renewed"_$S($G(PSOFDR):" from CPRS",1:"")
"RTN","PSORENW0",161,0)
 S PSCAN(PSORENW("ORX #"))=DA_"^C"
"RTN","PSORENW0",162,0)
 D CAN^PSOCAN
"RTN","PSORENW0",163,0)
 K REA,DA,MSG,PSCAN
"RTN","PSORENW0",164,0)
 Q
"RTN","PSORENW0",165,0)
 ;
"RTN","PSORENW0",166,0)
DIR ;
"RTN","PSORENW0",167,0)
 S DIR(0)="Y",DIR("A")="CONTINUE ",DIR("B")="N"
"RTN","PSORENW0",168,0)
 S DIR("?")="Answer YES to Continue, NO to bypass"
"RTN","PSORENW0",169,0)
 D ^DIR K DIR
"RTN","PSORENW0",170,0)
 S:$D(DIRUT)!('Y) PSORENW("DFLG")=1
"RTN","PSORENW0",171,0)
DIRX K DIRUT,DTOUT,DUOUT,X,Y
"RTN","PSORENW0",172,0)
 Q
"RTN","PSORENW0",173,0)
NEWPT ;
"RTN","PSORENW0",174,0)
 S PSOQFLG=0
"RTN","PSORENW0",175,0)
 S PSODFN=PSORENW("PSODFN")
"RTN","PSORENW0",176,0)
 D ^PSOPTPST I PSOQFLG S PSORENW("DFLG")=1,PSOQFLG=0 G NEWPTX
"RTN","PSORENW0",177,0)
 D PROFILE^PSOREF1
"RTN","PSORENW0",178,0)
NEWPTX Q
"RTN","PSORENW0",179,0)
 ;
"RTN","PSORENW0",180,0)
EN(PSORENW)        ; Entry Point for Batch Barcode Option
"RTN","PSORENW0",181,0)
 S PSORENRX=$G(PSOBBC("OIRXN"))
"RTN","PSORENW0",182,0)
 I $G(PSORENRX) D PSOL^PSSLOCK(PSORENRX) I '$G(PSOMSG) D  K DIR,PSOMSG W ! S DIR("A")="Press Return to continue",DIR(0)="E",DIR("?")="Press Return to continue" D ^DIR K DIR W ! Q
"RTN","PSORENW0",183,0)
 .I $P($G(PSOMSG),"^",2)'="" W $C(7),!!,$P(PSOMSG,"^",2) Q
"RTN","PSORENW0",184,0)
 .W $C(7),!!,"Another person is editing Rx "_$P($G(^PSRX(PSORENRX,0)),"^")
"RTN","PSORENW0",185,0)
 K PSOMSG,PSOBBCLK S PSOBARCD=1 D PROCESS K PSOBARCD
"RTN","PSORENW0",186,0)
 D KLIB^PSORENW1
"RTN","PSORENW0",187,0)
 I $G(PSORENRX),$G(PSOBBCLK) D PSOUL^PSSLOCK(PSORENRX)
"RTN","PSORENW0",188,0)
 K PSORENRX,PSOBBCLK
"RTN","PSORENW0",189,0)
 Q
"RTN","PSORENW0",190,0)
CDOSE ;Validate Dosage field on Renewal, Copy, Edit
"RTN","PSORENW0",191,0)
 ;PSOOCPRX must be set to internal Rx number
"RTN","PSORENW0",192,0)
 Q:'$G(PSOOCPRX)
"RTN","PSORENW0",193,0)
 N PSOOLP,PSOOKZ
"RTN","PSORENW0",194,0)
 S PSOOLP="",(PSOOLPF,PSONOSIG)=0 F  S PSOOLP=$O(^PSRX(PSOOCPRX,6,PSOOLP)) Q:PSOOLP=""!(PSOOLPF)  I $P($G(^PSRX(PSOOCPRX,6,PSOOLP,0)),"^")["0.." S PSOOLPD=$P($G(^(0)),"^"),PSOOLPF=1
"RTN","PSORENW0",195,0)
 Q:PSOOLPF
"RTN","PSORENW0",196,0)
 S PSOOKZ=0
"RTN","PSORENW0",197,0)
 I $P($G(^PSRX(PSOOCPRX,"SIG")),"^",2) S PSOOLP="" F  S PSOOLP=$O(^PSRX(PSOOCPRX,"SIG1",PSOOLP)) Q:PSOOLP=""!(PSOOKZ)  I $G(^PSRX(PSOOCPRX,"SIG1",PSOOLP,0))'="" S PSOOKZ=1
"RTN","PSORENW0",198,0)
 I '$P($G(^PSRX(PSOOCPRX,"SIG")),"^",2),$P($G(^("SIG")),"^")'="" S PSOOKZ=1
"RTN","PSORENW0",199,0)
 I 'PSOOKZ S PSONOSIG=1
"RTN","PSORENW0",200,0)
 Q
"RTN","PSORENW0",201,0)
 ;
"RTN","PSORN52")
0^55^B50777957
"RTN","PSORN52",1,0)
PSORN52 ;BIR/DSD - files renewal entries in prescription file ;08/09/93
"RTN","PSORN52",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,11,27,37,46,79,71,100,117,157,143,219,148,239,201,225,303,358,251**;DEC 1997;Build 202
"RTN","PSORN52",3,0)
 ;Ext ref to ^PS(55 sup by DBIA 2228
"RTN","PSORN52",4,0)
 ;Ext ref to PSOUL^PSSLOCK sup by DBIA 2789
"RTN","PSORN52",5,0)
 ;Ext ref to ^VA(200 sup by DBIA 10060
"RTN","PSORN52",6,0)
 ;Ext ref to SWSTAT^IBBAPI sup by DBIA 4663
"RTN","PSORN52",7,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5424
"RTN","PSORN52",8,0)
EN(PSOX) ;EP
"RTN","PSORN52",9,0)
START ;
"RTN","PSORN52",10,0)
 D:$D(XRTL) T0^%ZOSV ; Start RT Mon
"RTN","PSORN52",11,0)
 N PSOIBHLD,PSOSCOTH,PSOSCOTX S (PSOSCOTH,PSOSCOTX)=0 S PSOIBHLD="" I $G(PSOFDR),$G(ORD) D
"RTN","PSORN52",12,0)
 .S PSOIBHLD=$S($P($G(^PS(52.41,ORD,0)),"^",16)="SC":1,$P($G(^(0)),"^",16)="NSC":0,1:"")
"RTN","PSORN52",13,0)
 .I '$$DT^PSOMLLDT Q
"RTN","PSORN52",14,0)
 .N PSOIBHLX S PSOIBHLX=$G(^PS(52.41,ORD,"IBQ"))
"RTN","PSORN52",15,0)
 .S PSOIBHLD=PSOIBHLD_"^"_$S($P(PSOIBHLX,"^")=1:1,$P(PSOIBHLX,"^")=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",2)=1:1,$P(PSOIBHLX,"^",2)=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",3)=1:1,$P(PSOIBHLX,"^",3)=0:0,1:"")
"RTN","PSORN52",16,0)
 .S PSOIBHLD=PSOIBHLD_"^"_$S($P(PSOIBHLX,"^",4)=1:1,$P(PSOIBHLX,"^",4)=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",5)=1:1,$P(PSOIBHLX,"^",5)=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",6)=1:1,$P(PSOIBHLX,"^",6)=0:0,1:"")
"RTN","PSORN52",17,0)
 .S PSOIBHLD=PSOIBHLD_"^"_$S($P(PSOIBHLX,"^",7)=1:1,$P(PSOIBHLX,"^",7)=0:0,1:"")
"RTN","PSORN52",18,0)
 .I $P(PSOIBHLX,"^")=1!($P(PSOIBHLX,"^",2)=1)!($P(PSOIBHLX,"^",3)=1)!($P(PSOIBHLX,"^",4)=1)!($P(PSOIBHLX,"^",5)=1)!($P(PSOIBHLX,"^",6)=1)!($P(PSOIBHLX,"^",7)=1) S PSOSCOTH=1
"RTN","PSORN52",19,0)
 I $G(PSOSCOTH)!($G(PSORX("SC"))="SC")!($G(PSORX("SC"))="NSC") S PSOSCOTX=1
"RTN","PSORN52",20,0)
 S PSOANSQ("SC>50")="" D SCP^PSORN52D
"RTN","PSORN52",21,0)
 I $G(PSOFDR),$G(ORD) I $D(^PS(52.41,ORD,"ICD")) S FILE=52.41 D GET^PSORN52D
"RTN","PSORN52",22,0)
 ;Set ans to renew from Rx, only if no ans from Pend file
"RTN","PSORN52",23,0)
 I $G(PSORENW("OIRXN")) D
"RTN","PSORN52",24,0)
 .N PSOLDIBQ S PSOLDIBQ=$G(^PSRX(PSORENW("OIRXN"),"IBQ"))
"RTN","PSORN52",25,0)
 .I $P(PSOIBHLD,"^")="" D
"RTN","PSORN52",26,0)
 ..I $P($G(^PSRX(PSORENW("OIRXN"),"IB")),"^")=2 S $P(PSOIBHLD,"^")=0
"RTN","PSORN52",27,0)
 .I '$$DT^PSOMLLDT Q
"RTN","PSORN52",28,0)
 .I PSOLDIBQ="" Q
"RTN","PSORN52",29,0)
 .D IBHLD^PSORN52A
"RTN","PSORN52",30,0)
 D INIT G:PSORN52("QFLG") END D FILE^PSORN52A
"RTN","PSORN52",31,0)
 S:$D(XRT0) XRTN=$T(+0) D:$D(XRT0) T1^%ZOSV ; Stop RT Mon
"RTN","PSORN52",32,0)
 K PSOANSQ,PSOANSQD,PSONEWFF
"RTN","PSORN52",33,0)
 I $G(PSOIBHLD)'="" D
"RTN","PSORN52",34,0)
 .;Set answers based on Pend Renew, prior to Phar call
"RTN","PSORN52",35,0)
 .Q:'$G(PSOX("IRXN"))
"RTN","PSORN52",36,0)
 .I $P(PSOIBHLD,"^")=1!($P(PSOIBHLD,"^")=0) S PSOANSQ("SC")=$P(PSOIBHLD,"^")
"RTN","PSORN52",37,0)
 .I '$$DT^PSOMLLDT Q
"RTN","PSORN52",38,0)
 .I $P(PSOIBHLD,"^",2)=1!($P(PSOIBHLD,"^",2)=0) S PSOANSQ(PSOX("IRXN"),"MST")=$P(PSOIBHLD,"^",2)
"RTN","PSORN52",39,0)
 .I $P(PSOIBHLD,"^",3)=1!($P(PSOIBHLD,"^",3)=0) S PSOANSQ(PSOX("IRXN"),"VEH")=$P(PSOIBHLD,"^",3)
"RTN","PSORN52",40,0)
 .I $P(PSOIBHLD,"^",4)=1!($P(PSOIBHLD,"^",4)=0) S PSOANSQ(PSOX("IRXN"),"RAD")=$P(PSOIBHLD,"^",4)
"RTN","PSORN52",41,0)
 .I $P(PSOIBHLD,"^",5)=1!($P(PSOIBHLD,"^",5)=0) S PSOANSQ(PSOX("IRXN"),"PGW")=$P(PSOIBHLD,"^",5)
"RTN","PSORN52",42,0)
 .I $P(PSOIBHLD,"^",6)=1!($P(PSOIBHLD,"^",6)=0) S PSOANSQ(PSOX("IRXN"),"HNC")=$P(PSOIBHLD,"^",6)
"RTN","PSORN52",43,0)
 .I $P(PSOIBHLD,"^",7)=1!($P(PSOIBHLD,"^",7)=0) S PSOANSQ(PSOX("IRXN"),"CV")=$P(PSOIBHLD,"^",7)
"RTN","PSORN52",44,0)
 .I $P(PSOIBHLD,"^",8)=1!($P(PSOIBHLD,"^",8)=0) S PSOANSQ(PSOX("IRXN"),"SHAD")=$P(PSOIBHLD,"^",8)
"RTN","PSORN52",45,0)
 K PSOIBHLD
"RTN","PSORN52",46,0)
 I '$G(PSOFDR) I $G(PSORENW("OIRXN")) S FILE=52 D GET^PSORN52D
"RTN","PSORN52",47,0)
 S PSONEW("NEWCOPAY")=""
"RTN","PSORN52",48,0)
 I (PSOSCP<50&('$P($G(^PS(53,+$P(^PSRX(PSOX("IRXN"),0),"^",3),0)),"^",7))),$G(DUZ("AG"))="V" S PSOFLAG=0 D COPAY^PSOCPB
"RTN","PSORN52",49,0)
 ;I PSOSCP>49!($P($G(^PS(53,+$P(^PSRX(PSOX("IRXN"),0),"^",3),0)),"^",7)=1) S PSOFLAG=0 D SC^PSOMLLD2
"RTN","PSORN52",50,0)
 I PSOSCA&(PSOSCP>49)!((PSOSCA!(PSOBILL=2))&($P($G(^PS(53,+$P(^PSRX(PSOX("IRXN"),0),"^",3),0)),"^",7)=1)) S PSOFLAG=0 D SC^PSOMLLD2
"RTN","PSORN52",51,0)
 I $$DT^PSOMLLDT D
"RTN","PSORN52",52,0)
 .I $D(PSOIBQS(PSODFN,"CV")) D MESS D CV^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"CV")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",53,0)
 .I $D(PSOIBQS(PSODFN,"VEH")) D MESS D VEH^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"VEH")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",54,0)
 .I $D(PSOIBQS(PSODFN,"RAD")) D MESS D RAD^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"RAD")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",55,0)
 .I $D(PSOIBQS(PSODFN,"PGW")) D MESS D PGW^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"PGW")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",56,0)
 .I $D(PSOIBQS(PSODFN,"SHAD")) D MESS D SHAD^PSOMLLD2 I $G(PSOANSQ(PSOX("IRXN"),"SHAD")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",57,0)
 .I $D(PSOIBQS(PSODFN,"MST")) D MESS D MST^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"MST")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",58,0)
 .I $D(PSOIBQS(PSODFN,"HNC")) D MESS D HNC^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"HNC")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",59,0)
 K PSOSCOTH,PSOSCOTX
"RTN","PSORN52",60,0)
 I $G(PSONEW("NEWCOPAY")) S ^PSRX(PSOX("IRXN"),"IB")=PSONEW("NEWCOPAY")
"RTN","PSORN52",61,0)
 ;
"RTN","PSORN52",62,0)
 D FINISH,ACP^PSOUTIL
"RTN","PSORN52",63,0)
 ;
"RTN","PSORN52",64,0)
 N PSOSCFLD S PSOSCFLD=$S(PSOSCP'="":$G(PSOANSQ("SC")),1:"")_"^"_$G(PSOANSQ(PSOX("IRXN"),"MST"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"VEH"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"RAD"))
"RTN","PSORN52",65,0)
 S PSOSCFLD=PSOSCFLD_"^"_$G(PSOANSQ(PSOX("IRXN"),"PGW"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"HNC"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"CV"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"SHAD"))
"RTN","PSORN52",66,0)
 I PSOSCP<50&($TR(PSOSCFLD,"^")'="")&('$P($G(^PS(53,+$P(^PSRX(PSOX("IRXN"),0),"^",3),0)),"^",7)) S ^PSRX(PSOX("IRXN"),"IBQ")=PSOSCFLD K PSOSCFLD
"RTN","PSORN52",67,0)
 ;
"RTN","PSORN52",68,0)
 D FILE2^PSORN52D
"RTN","PSORN52",69,0)
 D:$$SWSTAT^IBBAPI() GACT^PSOPFSU0(PSOX("IRXN"),0)
"RTN","PSORN52",70,0)
 K PSONEW("NEWCOPAY"),PSOANSQ
"RTN","PSORN52",71,0)
END D EOJ
"RTN","PSORN52",72,0)
 Q
"RTN","PSORN52",73,0)
INIT S PSORN52("QFLG")=0 S:'$D(PSOX("DAYS SUPPLY")) PSOX("DAYS SUPPLY")=$P(PSOX("RX0"),"^",8)
"RTN","PSORN52",74,0)
 S:'$D(PSOX("# OF REFILLS")) PSOX("# OF REFILLS")=$P(PSOX("RX0"),"^",9) S:'$D(PSOX("ISSUE DATE")) PSOX("ISSUE DATE")=DT
"RTN","PSORN52",75,0)
 D INIT^PSON52 K PSON52
"RTN","PSORN52",76,0)
 Q
"RTN","PSORN52",77,0)
 ;
"RTN","PSORN52",78,0)
FINISH ;
"RTN","PSORN52",79,0)
 I $$DS^PSSDSAPI&+$G(^TMP("PSODOSF",$J,0)) S PSORX("VERIFY")=1,PSOX("STATUS")=4  ;DOSING
"RTN","PSORN52",80,0)
 I $D(PSORX("VERIFY")) D  G FINISHP:+$G(^TMP("PSODGS",$J,0))!($D(^TMP("PSODGI",$J,0)))!($D(^TMP("PSODOSF",$J,0))) G FINISHX
"RTN","PSORN52",81,0)
 .K DIC,DLAYGO,DINUM,DIADD,X,DD,DO S DIC="^PS(52.4,",DLAYGO=52.4,DINUM=PSOX("IRXN"),DIC(0)="ML"
"RTN","PSORN52",82,0)
 .S X=PSOX("IRXN") D FILE^DICN K DD,DO,DIC,DLAYGO,DINUM,X
"RTN","PSORN52",83,0)
 .S ^PS(52.4,PSOX("IRXN"),0)=PSOX("IRXN")_"^"_$P(PSOX("NRX0"),"^",2)_"^"_DUZ_"^"_$G(PSOX("OIRXN"))_"^"_$E(PSOX("LOGIN DATE"),1,7)_"^"_PSOX("IRXN")_"^"_PSOX("STOP DATE")
"RTN","PSORN52",84,0)
 .I +$G(^TMP("PSODGS",$J,0))!($D(^TMP("PSODGI",$J,0)))!($D(^TMP("PSODOSF",$J,0))) D TECH^PSODGDGP
"RTN","PSORN52",85,0)
 .K DIK,DA S DIK="^PS(52.4,",DA=PSOX("IRXN") D IX^DIK K DIK,DA
"RTN","PSORN52",86,0)
 G:PSOX("STATUS")=4 FINISHP
"RTN","PSORN52",87,0)
 ;
"RTN","PSORN52",88,0)
 I $G(PSOX("QS"))="S",$G(PSOBARCD) S DA=PSOX("IRXN"),RXFL(PSOX("IRXN"))=0 D SUS^PSORXL K DA G FINISHX
"RTN","PSORN52",89,0)
 ;
"RTN","PSORN52",90,0)
 I PSOX("FILL DATE")>DT,$P(PSOPAR,"^",6) S DA=PSOX("IRXN"),RXFL(PSOX("IRXN"))=0 D SUS^PSORXL K DA G FINISHX
"RTN","PSORN52",91,0)
 ;
"RTN","PSORN52",92,0)
 ; - Submitting Rx to ECME for 3rd Party Billing
"RTN","PSORN52",93,0)
 N ACTION
"RTN","PSORN52",94,0)
 I $$SUBMIT^PSOBPSUT(PSOX("IRXN"),0) D  I ACTION="Q"!(ACTION="^") Q
"RTN","PSORN52",95,0)
 . S ACTION="" D ECMESND^PSOBPSU1(PSOX("IRXN"),0,PSOX("FILL DATE"),"RN")
"RTN","PSORN52",96,0)
 .; Quit if there is an unresolved Tricare non-billable reject code, PSO*7*358
"RTN","PSORN52",97,0)
 . I $$PSOET^PSOREJP3(PSOX("IRXN"),0) S ACTION="Q" Q
"RTN","PSORN52",98,0)
 . I $$FIND^PSOREJUT(PSOX("IRXN"),0) D
"RTN","PSORN52",99,0)
 . . S ACTION=$$HDLG^PSOREJU1(PSOX("IRXN"),0,"79,88","RN","IOQ","Q")
"RTN","PSORN52",100,0)
 ;
"RTN","PSORN52",101,0)
 I $G(PSOX("QS"))="Q",$G(PSOBARCD) D  G FINISHX
"RTN","PSORN52",102,0)
 . N PSOFROM S PSOFROM="BATCH" I $G(PPL),$L(PPL_PSOX("IRXN")_",")>240 D TRI^PSOBBC D Q^PSORXL K PPL,RXFL
"RTN","PSORN52",103,0)
 .S RXFL(PSOX("IRXN"))=0
"RTN","PSORN52",104,0)
 . I $G(PPL) S PPL=PPL_PSOX("IRXN")_","
"RTN","PSORN52",105,0)
 . E  S PPL=PSOX("IRXN")_","
"RTN","PSORN52",106,0)
 . Q
"RTN","PSORN52",107,0)
FINISHP I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=PSOX("IRXN")_",",RXFL(PSOX("IRXN"))=0 G FINISHX
"RTN","PSORN52",108,0)
 F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSORN52",109,0)
 I $L(PSORX("PSOL",PSOX2))+$L(PSOX("IRXN"))<220 S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_PSOX("IRXN")_","
"RTN","PSORN52",110,0)
 E  S PSORX("PSOL",PSOX2+1)=PSOX("IRXN")_","
"RTN","PSORN52",111,0)
 S RXFL(PSOX("IRXN"))=0
"RTN","PSORN52",112,0)
FINISHX ;
"RTN","PSORN52",113,0)
 ;call to build bingo board Rx array
"RTN","PSORN52",114,0)
 S:'$G(PSORX("MAIL/WINDOW")) PSORX("MAIL/WINDOW")=$P(PSORENW("NRX0"),"^",11)
"RTN","PSORN52",115,0)
 I $G(PSORX("MAIL/WINDOW"))["W" S BINGCRT=1,BINGRTE="W",BBFLG=1 D BBRX^PSORN52C
"RTN","PSORN52",116,0)
 K PSOX1,PSOX2,^TMP("PSODOSF")
"RTN","PSORN52",117,0)
 Q
"RTN","PSORN52",118,0)
EOJ ;
"RTN","PSORN52",119,0)
 L -^PSRX("B",PSOX("IRXN")) K PSORN52,PSOX("INS"),PSORENW("INS"),PSORXED("INS"),PSONEW("ENT"),PSORXED("ENT"),OLENT,PSOIBHLD,PSOX("SINS"),PSORENW("SINS"),PSORXED("SINS"),FILE
"RTN","PSORN52",120,0)
 D PSOUL^PSSLOCK(PSOX("IRXN")) D PSOUL^PSSLOCK(PSOX("OIRXN"))
"RTN","PSORN52",121,0)
 Q
"RTN","PSORN52",122,0)
MESS ;
"RTN","PSORN52",123,0)
 I $G(PSOSCOTX)=1&(PSOSCP<50) W:$G(PSODRUG("DEA"))'["S"&($G(PSODRUG("DEA"))'["I") !!,"This Rx has been flagged by the provider as: "_$S($G(PSOSCOTH):"NO COPAY",$G(PSORX("SC"))="SC":"NO COPAY",1:"COPAY"),! S PSOSCOTX=2
"RTN","PSORN52",124,0)
 Q
"RTN","PSORN52C")
0^56^B50060838
"RTN","PSORN52C",1,0)
PSORN52C ;BIR/SAB-files renewal entries con't ;08/09/93
"RTN","PSORN52C",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,7,11,27,46,75,87,100,111,124,117,131,146,148,200,225,251**;DEC 1997;Build 202
"RTN","PSORN52C",3,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSORN52C",4,0)
 S DIC="^PSRX(",DLAYGO=52,DIC(0)="L",X=PSOX("NRX #") K DD,DO
"RTN","PSORN52C",5,0)
 D FILE^DICN S PSOX("IRXN")=+Y K DLAYGO,X,Y,DIC,DD,DO
"RTN","PSORN52C",6,0)
 D:+$G(DGI) TECH^PSODGDGI ; L +^PSRX(PSOX("IRXN")):0
"RTN","PSORN52C",7,0)
 D:$G(^TMP("PSODAI",$J,0))
"RTN","PSORN52C",8,0)
 .S $P(^PSRX(PSOX("IRXN"),3),"^",6)=1
"RTN","PSORN52C",9,0)
 .I $O(^TMP("PSODAI",$J,0)) S DAI=0 F  S DAI=$O(^TMP("PSODAI",$J,DAI)) Q:'DAI  D
"RTN","PSORN52C",10,0)
 ..S:'$D(^PSRX(PSOX("IRXN"),"DAI",0)) ^PSRX(PSOX("IRXN"),"DAI",0)="^52.03^^" S ^PSRX(PSOX("IRXN"),"DAI",DAI,0)=^TMP("PSODAI",$J,DAI,0)
"RTN","PSORN52C",11,0)
 ..S $P(^PSRX(PSOX("IRXN"),"DAI",0),"^",3)=+$P(^PSRX(PSOX("IRXN"),"DAI",0),"^",3)+1,$P(^(0),"^",4)=+$P(^(0),"^",4)+1
"RTN","PSORN52C",12,0)
 .K ^TMP("PSODAI",$J),DAI
"RTN","PSORN52C",13,0)
 S PSORN52(PSOX("IRXN"),0)=PSOX("NRX0"),PSORN52(PSOX("IRXN"),2)=PSOX("NRX2"),PSORN52(PSOX("IRXN"),3)=PSOX("NRX3")
"RTN","PSORN52C",14,0)
 S PSORN52(PSOX("IRXN"),"EPH")=PSOX("EPH")
"RTN","PSORN52C",15,0)
 S:'$G(PSOX("ENT")) PSORN52(PSOX("IRXN"),"SIG")=PSOX("SIG")
"RTN","PSORN52C",16,0)
 S PSORN52(PSOX("IRXN"),"STA")=PSOX("STA")
"RTN","PSORN52C",17,0)
 S:$G(PSOX("TN"))]"" PSORN52(PSOX("IRXN"),"TN")=PSOX("TN")
"RTN","PSORN52C",18,0)
 I $G(PSOX("METHOD OF PICK-UP"))]"",PSOX("FILL DATE")'>DT S PSORN52(PSOX("IRXN"),"MP")=PSOX("METHOD OF PICK-UP")
"RTN","PSORN52C",19,0)
 S PSORN52(PSOX("IRXN"),"TYPE")=0
"RTN","PSORN52C",20,0)
 S PSOX1="" F  S PSOX1=$O(PSORN52(PSOX("IRXN"),PSOX1)) Q:PSOX1=""  S ^PSRX(PSOX("IRXN"),PSOX1)=$G(PSORN52(PSOX("IRXN"),PSOX1))
"RTN","PSORN52C",21,0)
 I $O(SIG(0)) D  G ENT
"RTN","PSORN52C",22,0)
 .S II=0 F I=0:0 S I=$O(SIG(I)) Q:'I  S ^PSRX(PSOX("IRXN"),"SIG1",I,0)=SIG(I),II=II+1
"RTN","PSORN52C",23,0)
 .S ^PSRX(PSOX("IRXN"),"SIG1",0)="^52.04A^"_II_"^"_II,$P(^PSRX(PSOX("IRXN"),"SIG"),"^",2)=1 K I,II
"RTN","PSORN52C",24,0)
 .S $P(^PSRX(PSOX("IRXN"),"SIG"),"^",2)=1
"RTN","PSORN52C",25,0)
ENT S ^PSRX(PSOX("IRXN"),"POE")=1,^PSRX(PSOX("IRXN"),"INS")=$G(PSOX("INS"))
"RTN","PSORN52C",26,0)
 I $G(OR0) S:$P(OR0,"^",24) ^PSRX(PSOX("IRXN"),"PKI")=1
"RTN","PSORN52C",27,0)
 I $G(PSOX("SIG",1))]"",'$O(PSOX("SIG",1)) S ^PSRX(PSOX("IRXN"),"INS1",1,0)=PSOX("SIG",1),^PSRX(PSOX("IRXN"),"INS1",0)="^52.0115^1^1^"_DT_"^^"
"RTN","PSORN52C",28,0)
 I $O(^PSRX(PSOX("OIRXN"),"INS1",0)) D
"RTN","PSORN52C",29,0)
 .F D=0:0 S D=$O(^PSRX(PSOX("OIRXN"),"INS1",D)) Q:'D  S ^PSRX(PSOX("IRXN"),"INS1",D,0)=^PSRX(PSOX("OIRXN"),"INS1",D,0)
"RTN","PSORN52C",30,0)
 .S ^PSRX(PSOX("IRXN"),"INS1",0)=^PSRX(PSOX("OIRXN"),"INS1",0)
"RTN","PSORN52C",31,0)
TNT F I=1:1:PSOX("ENT") S ^PSRX(PSOX("IRXN"),6,I,0)=PSOX("DOSE",I)_"^"_$G(PSOX("DOSE ORDERED",I))_"^"_$G(PSOX("UNITS",I))_"^"_$G(PSOX("NOUN",I))_"^" D
"RTN","PSORN52C",32,0)
 .S ^PSRX(PSOX("IRXN"),6,I,0)=^PSRX(PSOX("IRXN"),6,I,0)_$G(PSOX("DURATION",I))_"^"_$G(PSOX("CONJUNCTION",I))_"^"_$G(PSOX("ROUTE",I))_"^"_$G(PSOX("SCHEDULE",I))_"^"_$G(PSOX("VERB",I))
"RTN","PSORN52C",33,0)
 .I $G(PSOX("ODOSE",I))]"" S ^PSRX(PSOX("IRXN"),6,I,1)=PSOX("ODOSE",I)
"RTN","PSORN52C",34,0)
 S:$G(PSOX("ENT")) ^PSRX(PSOX("IRXN"),6,0)="^52.0113^"_PSOX("ENT")_"^"_PSOX("ENT")
"RTN","PSORN52C",35,0)
 Q
"RTN","PSORN52C",36,0)
ORC ;
"RTN","PSORN52C",37,0)
 D MARK^PSOTPCAN
"RTN","PSORN52C",38,0)
 K PSORDEDT,GG,PSOHD,PSOID,PTST,PTDY,PTRF,RFCNT,RN,SEG1,SIG,SIGOK,DIC
"RTN","PSORN52C",39,0)
 K ST0,STA,STP,STR,JJ,LSI,MM,ORDG,ORIG,PHARMST,PSCAN,PSCNT,PSOI,GMRAL,DIC,DIE,HDR,IEN,NAME D KVA^VADPT
"RTN","PSORN52C",40,0)
 I $G(PSOFDR) D 
"RTN","PSORN52C",41,0)
 .I $G(PKI1)=1,$G(PKIR)]"" D ACT^PSOPKIV1(PSOX("IRXN"))
"RTN","PSORN52C",42,0)
 .S $P(^PSRX(PSOX("IRXN"),"OR1"),"^",2)=$P(OR0,"^"),^PSRX("APL",$P(OR0,"^"),PSOX("IRXN"))=""
"RTN","PSORN52C",43,0)
 .I $P($G(^PS(52.41,+$G(ORD),"EXT")),"^")="" I $G(PSOSIGFL)!($G(PSODRUG("OI"))'=$P(OR0,"^",8)) K:'$G(PSOPRC) PRC K PHI
"RTN","PSORN52C",44,0)
 .I $O(PRC(0)) S T=0 F  S T=$O(PRC(T)) Q:'T  S ^PSRX(PSOX("IRXN"),"PRC",T,0)=PRC(T),^PSRX(PSOX("IRXN"),"PRC",0)="^^"_T_"^"_T_"^"_DT_"^"
"RTN","PSORN52C",45,0)
 .I $O(PHI(0)) S T=0 F  S T=$O(PHI(T)) Q:'T  S ^PSRX(PSOX("IRXN"),"PI",T,0)=PHI(T),^PSRX(PSOX("IRXN"),"PI",0)="^^"_T_"^"_T_"^"_DT_"^"
"RTN","PSORN52C",46,0)
 .I $G(PSOSIGFL)!($G(PSODRUG("OI"))'=$P(OR0,"^",8)) D  S PSOI=1 Q
"RTN","PSORN52C",47,0)
 ..S POERR("PLACER")=$P(^PS(52.41,ORD,0),"^"),PSORDEDT=ORD
"RTN","PSORN52C",48,0)
 ..K ^PS(52.41,"AOR",PSODFN,+$P($G(^PS(52.41,ORD,"INI")),"^"),ORD)
"RTN","PSORN52C",49,0)
 ..S DA=ORD,DIK="^PS(52.41," D ^DIK
"RTN","PSORN52C",50,0)
 ..S $P(^PSRX(PSOX("IRXN"),"OR1"),"^")=$G(PSODRUG("OI"))
"RTN","PSORN52C",51,0)
 .E  S $P(^PSRX(PSOX("IRXN"),"OR1"),"^")=$P(OR0,"^",8)
"RTN","PSORN52C",52,0)
 .D PSOUL^PSSLOCK(ORD_"S") S DIK="^PS(52.41,",DA=ORD D ^DIK K DIK,DA
"RTN","PSORN52C",53,0)
 I $G(PSOX("OIRXN")),'$G(COPY) S $P(^PSRX(PSOX("IRXN"),"OR1"),"^",3)=PSOX("OIRXN"),$P(^PSRX(PSOX("OIRXN"),"OR1"),"^",4)=PSOX("IRXN"),^PSRX("AQ",PSOX("IRXN"),PSOX("OIRXN"))="" K PRC
"RTN","PSORN52C",54,0)
 I $O(PRC(0)) S T=0 F  S T=$O(PRC(T)) Q:'T  S ^PSRX(PSOX("IRXN"),"PRC",T,0)=PRC(T),^PSRX(PSOX("IRXN"),"PRC",0)="^^"_T_"^"_T_"^"_DT_"^"
"RTN","PSORN52C",55,0)
 I $O(PHI(0)) S T=0 F  S T=$O(PHI(T)) Q:'T  S ^PSRX(PSOX("IRXN"),"PI",T,0)=PHI(T),^PSRX(PSOX("IRXN"),"PI",0)="^^"_T_"^"_T_"^"_DT_"^"
"RTN","PSORN52C",56,0)
 S $P(^PSRX(PSOX("IRXN"),"OR1"),"^",5)=DUZ
"RTN","PSORN52C",57,0)
 S $P(^PSRX(PSOX("IRXN"),"OR1"),"^",8)=$$NOW^XLFDT D
"RTN","PSORN52C",58,0)
 . N DA,DIK S DA=PSOX("IRXN"),DIK="^PSRX(",DIK(1)=38.3 D EN1^DIK K DIK,DA
"RTN","PSORN52C",59,0)
 S PHARMST="",$P(^PSRX(PSOX("IRXN"),"OR1"),"^")=$G(PSODRUG("OI"))
"RTN","PSORN52C",60,0)
 S RXN=PSOX("IRXN") D SAVE
"RTN","PSORN52C",61,0)
 S STAT=$S($G(OR0)]""&('$G(PSOI)):"SC",$G(PSOI):"RO",1:"SN") S PHARMST=$S('$G(PSORX("VERIFY")):"CM",1:"IP") ;D EN^PSOHLSN1(RXN,STAT,PHARMST,"",PSONOOR)
"RTN","PSORN52C",62,0)
 S ^TMP("PSORXN",$J,RXN)=STAT_"^"_PHARMST_"^"_PSONOOR D PSOL^PSSLOCK(RXN)
"RTN","PSORN52C",63,0)
 D RESTORE K PSORDEDT,PHI,PRC,STAT,COMM,PSOI,OR2,OR1,PHARMST,RXN,DRG,STA,ACT,OCXR,OCXD1,OCXDT,OCXI
"RTN","PSORN52C",64,0)
 Q
"RTN","PSORN52C",65,0)
BBRX ;build bingo board Rx array; called by PSON52,PSOR52,PSORN52
"RTN","PSORN52C",66,0)
 I $G(BBRX(1))']"" S BBRX(1)=PSOX("IRXN")_"," Q
"RTN","PSORN52C",67,0)
 F PSOX1=0:0 S PSOX1=$O(BBRX(PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSORN52C",68,0)
 I $L(BBRX(PSOX2))+$L(PSOX("IRXN"))<220 S BBRX(PSOX2)=BBRX(PSOX2)_PSOX("IRXN")_","
"RTN","PSORN52C",69,0)
 E  S BBRX(PSOX2+1)=PSOX("IRXN")_","
"RTN","PSORN52C",70,0)
 Q
"RTN","PSORN52C",71,0)
SAVE ;this module will be used to save PSO arrays
"RTN","PSORN52C",72,0)
 K ^TMP("PSOLST",$J) F I=0:0 S I=$O(PSOLST(I)) Q:'I  S ^TMP("PSOLST",$J,I,0)=PSOLST(I)
"RTN","PSORN52C",73,0)
 K ^TMP("PSOSD",$J) S (STA,DRG)="" F  S STA=$O(PSOSD(STA)) Q:STA=""  F  S DRG=$O(PSOSD(STA,DRG)) Q:DRG=""  S ^TMP("PSOSD",$J,STA,DRG)=PSOSD(STA,DRG)
"RTN","PSORN52C",74,0)
 I $G(PSOSD) S ^TMP("PSOSD",$J,0)=PSOSD
"RTN","PSORN52C",75,0)
 I $G(PSODRUG("NAME"))]"" K ^TMP("PSODRUG",$J) S STA=""  F  S STA=$O(PSODRUG(STA)) Q:STA=""  D
"RTN","PSORN52C",76,0)
 .Q:STA="BAD"
"RTN","PSORN52C",77,0)
 .S ^TMP("PSODRUG",$J,STA)=PSODRUG(STA)
"RTN","PSORN52C",78,0)
 I $G(PSOX("# OF REFILLS"))]"" K ^TMP("PSOX",$J),^TMP("PSORENW",$J),^TMP("PSONEW",$J),^TMP("PSORXED",$J) D
"RTN","PSORN52C",79,0)
 .S STA="" F  S STA=$O(PSOX(STA)) Q:STA=""  S ^TMP("PSOX",$J,STA)=$G(PSOX(STA)) D
"RTN","PSORN52C",80,0)
 ..I STA="OLD LAST RX#",$O(PSOX(STA,"")) K ^TMP("PSOX",$J,STA) S ^TMP("PSOX",$J,STA,$O(PSOX(STA,"")))=PSOX(STA,$O(PSOX(STA,""))) D  Q
"RTN","PSORN52C",81,0)
 ...I $O(PSONEW(STA,"")) S ^TMP("PSONEW",$J,STA,$O(PSONEW(STA,"")))=PSONEW(STA,$O(PSONEW(STA,"")))
"RTN","PSORN52C",82,0)
 ...I $O(PSORENW(STA,"")) S ^TMP("PSORENW",$J,STA,$O(PSORENW(STA,"")))=PSORENW(STA,$O(PSORENW(STA,"")))
"RTN","PSORN52C",83,0)
 ...I $O(PSORXED(STA,"")) S ^TMP("PSORXED",$J,STA,$O(PSORXED(STA,"")))=PSORXED(STA,$O(PSORXED(STA,"")))
"RTN","PSORN52C",84,0)
 ..F ACT="PSORENW","PSONEW","PSORXED" I $G(@(ACT_"("""_STA_""")"))]"" S ^TMP(ACT,$J,STA)=@(ACT_"("""_STA_""")")
"RTN","PSORN52C",85,0)
 K PSOPTPST,PSOSD,PSONEW,PSOLST,PSORENW,PSORXED,PSODRUG
"RTN","PSORN52C",86,0)
 Q
"RTN","PSORN52C",87,0)
RESTORE ;this module restore saved arrays
"RTN","PSORN52C",88,0)
 S STA=0 F  S STA=$O(^TMP("PSOLST",$J,STA)) Q:'STA  S PSOLST(STA)=^TMP("PSOLST",$J,STA,0)
"RTN","PSORN52C",89,0)
 I $G(^TMP("PSOSD",$J,0)) S PSOSD=$G(^TMP("PSOSD",$J,0))
"RTN","PSORN52C",90,0)
 S (STA,DRG)="" F  S STA=$O(^TMP("PSOSD",$J,STA)) Q:STA=""  F  S DRG=$O(^TMP("PSOSD",$J,STA,DRG)) Q:DRG=""  S PSOSD(STA,DRG)=^TMP("PSOSD",$J,STA,DRG)
"RTN","PSORN52C",91,0)
 S STA="" F  S STA=$O(^TMP("PSODRUG",$J,STA)) Q:STA=""  S PSODRUG(STA)=^TMP("PSODRUG",$J,STA)
"RTN","PSORN52C",92,0)
 S STA="" F ACT="PSOX","PSORENW","PSONEW","PSORXED" D:$O(^TMP(ACT,$J,STA))]""
"RTN","PSORN52C",93,0)
 .F  S STA=$O(^TMP(ACT,$J,STA)) Q:STA=""  I STA'="OLD LAST RX#" S @(ACT_"("""_STA_""")")=^TMP(ACT,$J,STA)
"RTN","PSORN52C",94,0)
 I $O(^TMP("PSOX",$J,"OLD LAST RX#","")) S PSOX("OLD LAST RX#",$O(^TMP("PSOX",$J,"OLD LAST RX#","")))=^TMP("PSOX",$J,"OLD LAST RX#",$O(^TMP("PSOX",$J,"OLD LAST RX#","")))
"RTN","PSORN52C",95,0)
 I $O(^TMP("PSONEW",$J,"OLD LAST RX#","")) S PSONEW("OLD LAST RX#",$O(^TMP("PSONEW",$J,"OLD LAST RX#","")))=^TMP("PSONEW",$J,"OLD LAST RX#",$O(^TMP("PSONEW",$J,"OLD LAST RX#","")))
"RTN","PSORN52C",96,0)
 I $O(^TMP("PSORENW",$J,"OLD LAST RX#","")) S PSORENW("OLD LAST RX#",$O(^TMP("PSORENW",$J,"OLD LAST RX#","")))=^TMP("PSORENW",$J,"OLD LAST RX#",$O(^TMP("PSORENW",$J,"OLD LAST RX#","")))
"RTN","PSORN52C",97,0)
 I $O(^TMP("PSORXED",$J,"OLD LAST RX#","")) S PSORXED("OLD LAST RX#",$O(^TMP("PSORXED",$J,"OLD LAST RX#","")))=^TMP("PSORXED",$J,"OLD LAST RX#",$O(^TMP("PSORXED",$J,"OLD LAST RX#","")))
"RTN","PSORN52C",98,0)
 K ^TMP("PSOSD",$J),^TMP("PSODRUG",$J),^TMP("PSOX",$J),^TMP("PSORENW",$J),^TMP("PSONEW",$J),^TMP("PSORXED",$J),^TMP("PSOLST",$J)
"RTN","PSORN52C",99,0)
 Q
"RTN","PSORX1")
0^37^B66023082
"RTN","PSORX1",1,0)
PSORX1 ;BIR/SAB-medication processing driver ;3/28/05 1:14pm
"RTN","PSORX1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**7,22,23,57,62,46,74,71,90,95,115,117,146,139,135,182,195,233,268,300,170,320,326,324,334,251**;DEC 1997;Build 202
"RTN","PSORX1",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSORX1",4,0)
 ;External reference ^DIC(31 supported by DBIA 658
"RTN","PSORX1",5,0)
 ;External reference ^DPT(D0,.372 supported by DBIA 1476
"RTN","PSORX1",6,0)
 ;External reference DISPPRF^DGPFAPI supported by DBIA #4563
"RTN","PSORX1",7,0)
 ;External reference ^ORRDI1 is supported by DBIA 4659
"RTN","PSORX1",8,0)
 ;External reference ^XTMP("ORRDI" is supported by DBIA 4660
"RTN","PSORX1",9,0)
 ;External reference ^PSUHL supported by DBIA 4803
"RTN","PSORX1",10,0)
 ;
"RTN","PSORX1",11,0)
 ;PSO*195 add call to display Patient Record Flag (DISPPRF^DGPFAPI)
"RTN","PSORX1",12,0)
 ;
"RTN","PSORX1",13,0)
START K PSOQFLG,PSOID,PSOFIN,PSOQUIT,PSODRUG,^TMP($J,"PSOTDD"),^TMP("PSORXPO",$J),^TMP("PSORXBO",$J)
"RTN","PSORX1",14,0)
 D EOJ S (PSOBCK,PSOERR)=1 D INIT G:PSORX("QFLG") END
"RTN","PSORX1",15,0)
 D PT G:$G(PSORX("QFLG")) END D FULL^VALM1 I $G(NOPROC) K NOPROC G NX
"RTN","PSORX1",16,0)
 ;call to add bingo board data to file 52.11
"RTN","PSORX1",17,0)
 F SLPPL=0:0 S SLPPL=$O(RXRS(SLPPL)) Q:'SLPPL  D
"RTN","PSORX1",18,0)
 .I $P($G(^PSRX(SLPPL,"STA")),"^")'=5 K RXRS(SLPPL) Q
"RTN","PSORX1",19,0)
 .S RXREC=SLPPL D WIND^PSOSUPOE I $G(PBINGRTE) D BBADD^PSOSUPOE S (BINGCRT,BINGRTE)=1 S:$G(PSOFROM)'="NEW" PSOFROM="REFILL"
"RTN","PSORX1",20,0)
 K TM,TM1 I $G(PSORX("PSOL",1))]""!($D(RXRS)) D ^PSORXL K PSORX
"RTN","PSORX1",21,0)
 G:$G(NOBG) NX
"RTN","PSORX1",22,0)
 S TM=$P(^TMP("PSOBB",$J),"^"),TM1=$P(^TMP("PSOBB",$J),"^",2) K ^TMP("PSOBB",$J)
"RTN","PSORX1",23,0)
 I $G(PSOFROM)="NEW"!($G(PSOFROM)="REFILL")!($G(PSOFROM)="PARTIAL") D:$D(BINGCRT)&($D(BINGRTE)&($D(DISGROUP))) ^PSOBING1 K BINGCRT,BINGRTE,BBRX,BBFLG
"RTN","PSORX1",24,0)
NX I $G(POERR("DEAD"))!$G(PSOQFLG) D EOJ G START
"RTN","PSORX1",25,0)
 D EOJ G START
"RTN","PSORX1",26,0)
END Q
"RTN","PSORX1",27,0)
 ;---------------------------------------------------------
"RTN","PSORX1",28,0)
INIT ;
"RTN","PSORX1",29,0)
 S PSORX("QFLG")=0
"RTN","PSORX1",30,0)
 D:'$D(PSOPAR) ^PSOLSET I '$D(PSOPAR) S PSORX("QFLG")=1
"RTN","PSORX1",31,0)
 I $P($G(PSOPAR),"^",2),'$D(^XUSEC("PSORPH",DUZ)) S PSORX("VERIFY")=1
"RTN","PSORX1",32,0)
INITX Q
"RTN","PSORX1",33,0)
 ;
"RTN","PSORX1",34,0)
PT ;
"RTN","PSORX1",35,0)
 K ^TMP("PSORXDC",$J),^TMP($J,"PSEXC","OUT"),CLOZPAT,DIC,PSODFN,PSOPTLK
"RTN","PSORX1",36,0)
 S PSORX("QFLG")=0,DIC(0)="QEAM" D EN^PSOPATLK S Y=PSOPTLK
"RTN","PSORX1",37,0)
 I +Y'>0 S PSORX("QFLG")=1 G PTX
"RTN","PSORX1",38,0)
OERR N:$G(MEDP) PAT,POERR K PSOXFLG S (DFN,PSODFN)=+Y,PSORX("NAME")=$P(Y,"^",2)
"RTN","PSORX1",39,0)
 K NPPROC,PSOQFLG,DIC,DR,DIQ S DIC=2,DA=PSODFN,DR=.351,DIQ="PSOPTPST" D EN^DIQ1
"RTN","PSORX1",40,0)
 K DIC,DA,DR,DIQ D DEAD^PSOPTPST I $G(PSOQFLG) S NOPROC=1 Q
"RTN","PSORX1",41,0)
 ;PSO*195 move SSN write to here and add DISPPRF call
"RTN","PSORX1",42,0)
 S SSN=$P(^DPT(PSODFN,0),"^",9) W !!?10,$C(7),PSORX("NAME")
"RTN","PSORX1",43,0)
 W " ("_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)_")" K SSN
"RTN","PSORX1",44,0)
 I $G(XQY0)["PSO LMOE FINISH",'$G(MEDP),$D(^TMP($J,"PSOFLPO",PSODFN)) D
"RTN","PSORX1",45,0)
 .I '$D(IOINORM)!('$D(IOINHI)) S X="IORVOFF;IORVON;IOINHI;IOINORM" D ENDR^%ZISS
"RTN","PSORX1",46,0)
 .W "  ",IORVON_IOINHI,"<This patient has flagged orders>",IOINORM_IORVOFF
"RTN","PSORX1",47,0)
 S PSONOAL="" D ALLERGY^PSOORUT2 D  I PSONOAL'="" D PAUSE
"RTN","PSORX1",48,0)
 .I PSONOAL'="" W !,$C(7),"     No Allergy Assessment!"
"RTN","PSORX1",49,0)
 D REMOTE
"RTN","PSORX1",50,0)
 N PSOUPDT
"RTN","PSORX1",51,0)
 S PSOUPDT=1
"RTN","PSORX1",52,0)
 I $G(XQY0)["PSO LMOE FINISH" S PSOUPDT=0
"RTN","PSORX1",53,0)
 D CHKADDR^PSOBAI(PSODFN,1,PSOUPDT)
"RTN","PSORX1",54,0)
 D:($G(XQY0)["PSO LMOE FINISH")&('$G(SNGLPAT)) DISPPRF^DGPFAPI(PSODFN)
"RTN","PSORX1",55,0)
 ;
"RTN","PSORX1",56,0)
 I $P($G(^PS(55,PSODFN,"LAN")),"^") W !?10,"Patient has another language preference!",! H 3
"RTN","PSORX1",57,0)
 I $G(^PS(55,"ASTALK",PSODFN)) W !,"Patient is enrolled to receive ScripTalk 'talking' prescription labels.",! H 2 D MAIL
"RTN","PSORX1",58,0)
 D NOW^%DTC S TM=$E(%,1,12),TM1=$P(TM,".",2) S ^TMP("PSOBB",$J)=TM_"^"_TM1
"RTN","PSORX1",59,0)
 ;Call to display remote/local prescriptions
"RTN","PSORX1",60,0)
 I '$G(PSOFIN) D RDICHK^PSORMRX(PSODFN)
"RTN","PSORX1",61,0)
 S PSOQFLG=0,DIC="^PS(55,",DLAYGO=55
"RTN","PSORX1",62,0)
 I '$D(^PS(55,PSODFN,0)) D
"RTN","PSORX1",63,0)
 .K DD,DO S DIC(0)="L",(DINUM,X)=PSODFN D FILE^DICN D:Y<1  K DIC,DA,DR,DD,DO
"RTN","PSORX1",64,0)
 ..S $P(^PS(55,PSODFN,0),"^")=PSODFN K DIK S DA=PSODFN,DIK="^PS(55,",DIK(1)=.01 D EN^DIK K DIK
"RTN","PSORX1",65,0)
 D RXSTA
"RTN","PSORX1",66,0)
 S PSOLOUD=1 D:$P($G(^PS(55,PSODFN,0)),"^",6)'=2 EN^PSOHLUP(PSODFN) K PSOLOUD
"RTN","PSORX1",67,0)
 I $G(^PS(55,PSODFN,"PS"))']"" D  I $G(POERR("QFLG")) G EOJ
"RTN","PSORX1",68,0)
 .L +^PS(55,PSODFN):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3) I '$T W $C(7),!!,"Patient Data is Being Edited by Another User!",! S POERR("QFLG")=1 S:$G(PSOFIN) PSOQUIT=1 Q
"RTN","PSORX1",69,0)
 .S PSOXFLG=1,SSN=$P(^DPT(PSODFN,0),"^",9) W !!?10,$C(7),PSORX("NAME")_" ("_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)_")",! K SSN
"RTN","PSORX1",70,0)
 .S DIE=55,DR=".02;.03;.04;.05;1;D ELIG^PSORX1;3;50;106;106.1",DA=PSODFN W !!,?5,">>PHARMACY PATIENT DATA<<",! D ^DIE L -^PS(55,PSODFN)
"RTN","PSORX1",71,0)
 S PSOX=$G(^PS(55,PSODFN,"PS")) I PSOX]"" S PSORX("PATIENT STATUS")=$P($G(^PS(53,PSOX,0)),"^")
"RTN","PSORX1",72,0)
 I $G(^PS(55,PSODFN,"PS"))']"" D  I $G(POERR("QFLG")) G EOJ
"RTN","PSORX1",73,0)
 .W !!,"Patient Status Required!!",! D ELIG
"RTN","PSORX1",74,0)
 .W ! K POERR("QFLG"),DIC,DR,DIE S DIC("A")="RX PATIENT STATUS: ",DIC(0)="QEAMZ",DIC=53 D ^DIC K DIC
"RTN","PSORX1",75,0)
 .I $D(DIRUT)!(Y=-1) D  Q
"RTN","PSORX1",76,0)
 ..W $C(7),"Required Data!",! S POERR("QFLG")=1 S:$G(PSOFIN) PSOQUIT=1
"RTN","PSORX1",77,0)
 ..I $O(^PS(55,PSODFN,0))="" S DA=PSODFN,DIK="^PS(55," D ^DIK
"RTN","PSORX1",78,0)
 .S ^PS(55,PSODFN,"PS")=+Y,PSORX("PATIENT STATUS")=$P(^PS(53,+Y,0),"^")
"RTN","PSORX1",79,0)
 .K DIRUT,DTOUT,DUOUT,X,Y,DA
"RTN","PSORX1",80,0)
 Q:$G(PSOFIN)
"RTN","PSORX1",81,0)
 D ^PSOBUILD
"RTN","PSORX1",82,0)
 F PT="GET","DEAD","INP","CNH","TPB","ADDRESS","COPAY" S RTN=PT_"^PSOPTPST" D @RTN Q:$G(POERR("DEAD"))!($G(PSOQFLG))
"RTN","PSORX1",83,0)
 I $G(POERR("DEAD")) S POERR("QFLG")=1 F II=0:0 S II=$O(^PS(52.41,"P",PSODFN,II)) D:$P($G(^PS(52.41,II,0)),"^",3)'="DC"&($P($G(^(0)),"^",3)'="DE") DC^PSOORFI2
"RTN","PSORX1",84,0)
 K PSOERR("DEAD"),II I $G(PSOQFLG) S POERR("QFLG")=1 G EOJ Q
"RTN","PSORX1",85,0)
 S (PAT,PSOXXDFN)=PSODFN,POERR=1 D ^PSOORUT2,BLD^PSOORUT1,EN^PSOLMUTL
"RTN","PSORX1",86,0)
 D CLEAR^VALM1 G:$G(PSOQUIT) PTX D EN^PSOLMAO
"RTN","PSORX1",87,0)
 S (DFN,PSODFN)=PSOXXDFN K DIE,DIC,DLAYGO,DR,DA,PSOX,PSORXED
"RTN","PSORX1",88,0)
 I $O(RXFL("")),$P(^PS(55,PSODFN,0),"^",7)="" D
"RTN","PSORX1",89,0)
 . N %
"RTN","PSORX1",90,0)
 . D NOW^%DTC
"RTN","PSORX1",91,0)
 . S $P(^PS(55,PSODFN,0),"^",7)=$E(%,1,12),$P(^(0),"^",8)="A" D LOGDFN^PSUHL(PSODFN)
"RTN","PSORX1",92,0)
PTX ;
"RTN","PSORX1",93,0)
 K X,Y,^TMP("PS",$J),^TMP($J,"PSEXC","OUT"),C,DEA,PRC,PSCNT,PSOACT,PSOCLC,PSOCS,PSOCT,PSOFINFL,PSOHD,PSOLST,PSOOPT,PSOPF,PSOX,PSOX1,PSOXXDFN,SIGOK,STP,STR,PSOPTLK
"RTN","PSORX1",94,0)
 Q
"RTN","PSORX1",95,0)
EOJ ;
"RTN","PSORX1",96,0)
 I $G(PSODFN) K ^TMP($J,"PSOINTERVENE",PSODFN)
"RTN","PSORX1",97,0)
 K PSOERR,PSOMED,PSORX,PSOSD,PSODRUG,PSODFN,PSOOPT,PSOBILL,PSOIBQS,PSOCPAY,PSOPF,PSOPI,COMM,DGI,DGS,PT,PTDY,PTRF,RN,RTN,SERS,ST0,STAT,DFN,STOP,SLPPL,RXREC
"RTN","PSORX1",98,0)
 K:'$G(MEDP) PSOQFLG
"RTN","PSORX1",99,0)
 D KVA^VADPT,FULL^VALM1 K PSOLST,PSOXFLG,PSCNT,PSDIS,PSOAL,P1,LOG,%,%DT,%I,D0,DAT,DFN,DRG,ORX,PSON,PSOPTPST,PSORX,PTST,PSOBCK,PSOID,PSOBXPUL
"RTN","PSORX1",100,0)
 K INCOM,SIG,SG,STP,RX0,RXN,RX2,RX3,RTS,C,DEAD,PS,PSOCLC,PSOCNT,PSOCT,PSODA,PSOFROM,PSOHD,R3,REA,RF,RFD,RFM,RLD,RXNUM,RXP,RXPR,RXRP,RXRS,STR,POERR,VALMSG
"RTN","PSORX1",101,0)
 K ^TMP("PSORXDD",$J),^TMP("PSORXDC",$J),^TMP("PSOAL",$J),^TMP("PSOAO",$J),^TMP("PSOSF",$J),^TMP("PSOPF",$J),^TMP("PSOPI",$J),^TMP("PSOPO",$J),^TMP("PSOHDR",$J),^TMP("PSORXPO",$J)
"RTN","PSORX1",102,0)
 I '$G(MEDP),'$G(PSOQUIT) K PAT
"RTN","PSORX1",103,0)
 K ^TMP("PSORXBO",$J),PSORX,RFN,PSOXXDFN,VALM,VALMKEY,PSOBCK,SPOERR,PSOFLAG,VALMBCK,D,GMRA,GMRAL,GMRAREC,PSOSTA,PSODT,RXFL,NOBG,BBRX,BBFLG,^TMP($J,"PSOFLPO")
"RTN","PSORX1",104,0)
 K PPL,PPL1,PSOQFLAG ;*334 ADDED KILLS
"RTN","PSORX1",105,0)
 Q
"RTN","PSORX1",106,0)
ELIG ; shows eligibility and disabilities
"RTN","PSORX1",107,0)
 D ELIG^VADPT W !,"Eligibility: "_$P(VAEL(1),"^",2)_$S(+VAEL(3):"     SC%: "_$P(VAEL(3),"^",2),1:"") S N=0 F  S N=$O(VAEL(1,N)) Q:'N  W !,?10,$P(VAEL(1,N),"^",2)
"RTN","PSORX1",108,0)
 W !,"Disabilities: " F I=0:0 S I=$O(^DPT(DFN,.372,I)) Q:'I  S I1=$S($D(^DPT(DFN,.372,I,0)):^(0),1:"") D:+I1
"RTN","PSORX1",109,0)
 .S PSDIS=$S($P($G(^DIC(31,+I1,0)),"^")]""&($P($G(^(0)),"^",4)']""):$P(^(0),"^"),$P($G(^DIC(31,+I1,0)),"^",4)]"":$P(^(0),"^",4),1:""),PSCNT=$P(I1,"^",2)
"RTN","PSORX1",110,0)
 .W:$L(PSDIS_"-"_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), ")>80 !,?15
"RTN","PSORX1",111,0)
 .W $S($G(PSDIS)]"":PSDIS_"-",1:"")_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), "
"RTN","PSORX1",112,0)
 K N
"RTN","PSORX1",113,0)
 Q
"RTN","PSORX1",114,0)
PROFILE ;
"RTN","PSORX1",115,0)
 S (PSORX("REFILL"),PSORX("RENEW"))=0,PSOX="" D ^PSOBUILD
"RTN","PSORX1",116,0)
 I '$G(PSOSD) W !,"This patient has no prescriptions" S:'$D(DFN) DFN=PSODFN D GMRA^PSODEM G PROFILEX
"RTN","PSORX1",117,0)
 S (PSODRG,PSOX)="" F  S PSODRG=$O(PSOSD(PSODRG)) Q:PSODRG=""  F  S PSOX=$O(PSOSD(PSODRG,PSOX)) Q:PSOX=""  S:$P(PSOSD(PSODRG,PSOX),"^",3)="" PSORX("RENEW")=1 S:$P(PSOSD(PSODRG,PSOX),"^",4)="" PSORX("REFILL")=1
"RTN","PSORX1",118,0)
 K PSOX
"RTN","PSORX1",119,0)
PROFILEX Q
"RTN","PSORX1",120,0)
 ;
"RTN","PSORX1",121,0)
MAIL ; MAKE SURE MAIL STATUS IS COMPATIBLE WITH SCRIPTALK PATIENT
"RTN","PSORX1",122,0)
 I $P($G(^PS(59,PSOSITE,"STALK")),"^")="" Q  ; NO SCRIPTALK PRINTER SET UP FOR THIS DIVISION
"RTN","PSORX1",123,0)
 N MAIL
"RTN","PSORX1",124,0)
 S MAIL=$G(^PS(55,PSODFN,0)) I $P(MAIL,"^",3)>1 Q
"RTN","PSORX1",125,0)
MAILP W !!,"REMINDER: CMOP does not fill ScripTalk prescriptions. Please select mail"
"RTN","PSORX1",126,0)
 W !,"status:  2 (DO NOT MAIL), 3 (LOCAL REGULAR MAIL) or 4 (LOCAL CERTFIED MAIL)."
"RTN","PSORX1",127,0)
 R !,"MAIL: ",MAIL:120
"RTN","PSORX1",128,0)
 I MAIL?1"^".E Q
"RTN","PSORX1",129,0)
 I MAIL<2!(MAIL>4) W !,"INVALID MAIL SETTING - ENTER 2,3, OR 4" G MAILP
"RTN","PSORX1",130,0)
 W "  ",$S(MAIL=2:"DO NOT MAIL",MAIL=3:"LOCAL REGULAR MAIL",1:"LOCAL CERTIFIED MAIL")
"RTN","PSORX1",131,0)
 S $P(^PS(55,PSODFN,0),"^",3)=MAIL
"RTN","PSORX1",132,0)
 Q
"RTN","PSORX1",133,0)
REMOTE ; 
"RTN","PSORX1",134,0)
 I $T(HAVEHDR^ORRDI1)']"" Q
"RTN","PSORX1",135,0)
 I '$$HAVEHDR^ORRDI1 Q
"RTN","PSORX1",136,0)
 D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSORX1",137,0)
 I $D(^XTMP("ORRDI","OUTAGE INFO","DOWN")) W !!,"Remote data not available - Only local order checks processed.",! D HD^PSODDPR2():(($Y+5)'>IOSL) Q
"RTN","PSORX1",138,0)
 Q
"RTN","PSORX1",139,0)
PAUSE ;
"RTN","PSORX1",140,0)
 W ! K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSORX1",141,0)
 Q
"RTN","PSORX1",142,0)
 ;
"RTN","PSORX1",143,0)
RXSTA ; DISPLAY ELIGIBILITY & PROMPT FOR RX PATIENT STATUS
"RTN","PSORX1",144,0)
 N DA,PSOSTA
"RTN","PSORX1",145,0)
 I '$G(PSODFN) Q
"RTN","PSORX1",146,0)
 S DA=PSODFN,PSOSTA=$G(^PS(55,PSODFN,"PS"))
"RTN","PSORX1",147,0)
 I $G(XQY0)["PSO LMOE FINISH"!(XQY0["PSO LM BACKDOOR ORDERS") I PSOSTA]"" D
"RTN","PSORX1",148,0)
 .D ELIG^VADPT W !,"Eligibility: "_$P(VAEL(1),"^",2)_$S(+VAEL(3):"     SC%: "_$P(VAEL(3),"^",2),1:"")
"RTN","PSORX1",149,0)
 .S N=0 F  S N=$O(VAEL(1,N)) Q:'N  W !,?10,$P(VAEL(1,N),"^",2)
"RTN","PSORX1",150,0)
 .S DIC("A")="RX PATIENT STATUS: ",DIC("B")=PSOSTA,DIC(0)="QEAMZ",DIC=53 D ^DIC K DIC
"RTN","PSORX1",151,0)
 .I +Y>0,+Y'=PSOSTA S DIE="^PS(55,",DR="3////"_+Y D ^DIE
"RTN","PSORX1",152,0)
 Q
"RTN","PSORXI")
0^36^B15085329
"RTN","PSORXI",1,0)
PSORXI ;IHS/DSD/JCM - logs pharmacy interventions ;03/19/93 11:56
"RTN","PSORXI",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**268,324,251**;DEC 1997;Build 202
"RTN","PSORXI",3,0)
 ; This routine is used to create entries in the APSP INTERVENTION file.
"RTN","PSORXI",4,0)
START ;  
"RTN","PSORXI",5,0)
 D INIT,DIC G:PSORXI("QFLG") END
"RTN","PSORXI",6,0)
 D EDIT
"RTN","PSORXI",7,0)
 S:'$D(PSONEW("PROVIDER")) PSONEW("PROVIDER")=$P(^APSPQA(32.4,PSORXI("DA"),0),"^",3)
"RTN","PSORXI",8,0)
END D EOJ
"RTN","PSORXI",9,0)
 Q
"RTN","PSORXI",10,0)
INIT ;
"RTN","PSORXI",11,0)
 W !!,"Now creating Pharmacy Intervention",!
"RTN","PSORXI",12,0)
 I $G(PSODRUG("IEN")) W "for  "_$P($G(^PSDRUG(PSODRUG("IEN"),0)),"^"),!
"RTN","PSORXI",13,0)
 K PSORXI S PSORXI("QFLG")=0
"RTN","PSORXI",14,0)
 Q
"RTN","PSORXI",15,0)
DIC ;
"RTN","PSORXI",16,0)
 K DIC,DR,DA,X,Y,DD,DO S DIC="^APSPQA(32.4,",DLAYGO=9009032.4,DIC(0)="L",X=DT
"RTN","PSORXI",17,0)
 S DIC("DR")=".02////"_+PSODFN_";.04////"_DUZ_";.05////"_PSODRUG("IEN")_";.06///PHARMACY"
"RTN","PSORXI",18,0)
 S DIC("DR")=DIC("DR")_";.07"_$S($G(PSOIVDSN):"////"_$G(PSOIVDSN),$G(PSORX("INTERVENE"))=1:"////18",$G(PSORX("INTERVENE"))=2:"////19",1:"////6")_";.14////0"_";.16////"_$S($G(PSOSITE)]"":PSOSITE,1:"")
"RTN","PSORXI",19,0)
 D FILE^DICN K DIC,DR,DA
"RTN","PSORXI",20,0)
 I Y>0 S PSORXI("DA")=+Y
"RTN","PSORXI",21,0)
 E  S PSORXI("QFLG")=1 G DICX
"RTN","PSORXI",22,0)
 D DIE
"RTN","PSORXI",23,0)
DICX K X,Y
"RTN","PSORXI",24,0)
 Q
"RTN","PSORXI",25,0)
DIE ;
"RTN","PSORXI",26,0)
 K DIE,DIC,DR,DA
"RTN","PSORXI",27,0)
 S DIE="^APSPQA(32.4,",DA=PSORXI("DA"),DR=$S($G(PSORXI("EDIT"))]"":".03:1600",1:".03;.08")
"RTN","PSORXI",28,0)
 L +^APSPQA(32.4,PSORXI("DA")):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3) D ^DIE K DIE,DIC,DR,X,Y,DA L -^APSPQA(32.4,PSORXI("DA"))
"RTN","PSORXI",29,0)
 W $C(7),!!,"See 'Pharmacy Intervention Menu' if you want to delete this",!,"intervention or for more options.",!
"RTN","PSORXI",30,0)
 Q
"RTN","PSORXI",31,0)
EDIT ;
"RTN","PSORXI",32,0)
 K DIR W ! S DIR(0)="Y",DIR("A")="Would you like to edit this intervention ",DIR("B")="N" D ^DIR K DIR I $D(DIRUT)!'Y G EDITX
"RTN","PSORXI",33,0)
 S PSORXI("EDIT")=1 D DIE G EDIT
"RTN","PSORXI",34,0)
EDITX W ! K X,Y
"RTN","PSORXI",35,0)
 Q
"RTN","PSORXI",36,0)
DUPINV ;Duplicate and file intervention
"RTN","PSORXI",37,0)
 N PSOARY,PSOARYC,PSOMSG,PSODA,DUP,DIC,DA,DLAYGO,Y,X
"RTN","PSORXI",38,0)
 S DUP=^TMP($J,"PSOINTERVENE",+PSODFN),DIC="^APSPQA(32.4,",DIC(0)="AEQM"
"RTN","PSORXI",39,0)
 D GETS^DIQ(9009032.4,DUP,"**","I","PSOARY","PSOMSG")
"RTN","PSORXI",40,0)
 I $D(PSOMSG) W !,"Error Retrieving Last Duplicate..." G START
"RTN","PSORXI",41,0)
 L +^APSPQA(32.4):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3)
"RTN","PSORXI",42,0)
 K DIC,DR,DA,X,Y,DD,DO
"RTN","PSORXI",43,0)
 S DIC="^APSPQA(32.4,",DLAYGO=9009032.4,DIC(0)="",X=DT
"RTN","PSORXI",44,0)
 D FILE^DICN
"RTN","PSORXI",45,0)
 L -^APSPQA(32.4)
"RTN","PSORXI",46,0)
 I Y<1 W !,"Error Encountered Filing Duplicate..." Q
"RTN","PSORXI",47,0)
 S DA=+Y,PSORXI("DA")=+Y,X=0,^TMP($J,"PSOINTERVENE",PSODFN)=+Y
"RTN","PSORXI",48,0)
 F  S X=$O(PSOARY(9009032.4,DUP_",",X)) Q:'X  D
"RTN","PSORXI",49,0)
 .S PSOARYC(9009032.4,DA_",",X)=PSOARY(9009032.4,DUP_",",X,"I")
"RTN","PSORXI",50,0)
 S PSOARYC(9009032.4,DA_",",.05)=PSODRUG("IEN")
"RTN","PSORXI",51,0)
 S PSOARYC(9009032.4,DA_",",.15)=""
"RTN","PSORXI",52,0)
 D FILE^DIE("K","PSOARYC","PSOMSG") I $D(PSOMSG) D  G START
"RTN","PSORXI",53,0)
 .W !,"Error Encountered Filing Duplicate..."
"RTN","PSORXI",54,0)
 .N DIK S DA=PSORXI("DA"),DIK="^APSPQA(32.4," D ^DIK
"RTN","PSORXI",55,0)
 W ! D EN^DIQ,EDIT
"RTN","PSORXI",56,0)
 Q
"RTN","PSORXI",57,0)
EOJ ;
"RTN","PSORXI",58,0)
 K PSORXI
"RTN","PSORXI",59,0)
 Q
"RTN","PSORXI",60,0)
EN1(PSOX) ; Entry Point if have internal rx #
"RTN","PSORXI",61,0)
 N PSODFN,PSONEW,PSODRUG,PSOY
"RTN","PSORXI",62,0)
 I $G(^PSRX(+$G(PSOX),0))']"" W !,$C(7),"No prescription data" G EN1X
"RTN","PSORXI",63,0)
 S PSORXI("IRXN")=PSOX K PSOY S PSOY=^PSRX(PSORXI("IRXN"),0)
"RTN","PSORXI",64,0)
 S PSODFN=$P(PSOY,"^",2),PSONEW("PROVIDER")=$P(PSOY,"^",4),PSODRUG("IEN")=$P(PSOY,"^",6)
"RTN","PSORXI",65,0)
 D START
"RTN","PSORXI",66,0)
EN1X ;
"RTN","PSORXI",67,0)
 Q
"RTN","PSORXI",68,0)
 ;
"RTN","PSORXI",69,0)
EN2(PSOIVDST,PSOX) ; Entry Point for dose interventions with a prescription
"RTN","PSORXI",70,0)
 ;PSOIVDST = Dosing intervention text
"RTN","PSORXI",71,0)
 ;PSOX = Internal prescription Number
"RTN","PSORXI",72,0)
 N PSOIVDSN S PSOIVDSN=0
"RTN","PSORXI",73,0)
 D LOOK I 'PSOIVDSN Q 1
"RTN","PSORXI",74,0)
 N PSODFN,PSONEW,PSODRUG,PSOY
"RTN","PSORXI",75,0)
 I $G(^PSRX(+$G(PSOX),0))']"" W !,$C(7),"No prescription data" G EN2X
"RTN","PSORXI",76,0)
 S PSORXI("IRXN")=PSOX K PSOY S PSOY=^PSRX(PSORXI("IRXN"),0)
"RTN","PSORXI",77,0)
 S PSODFN=$P(PSOY,"^",2),PSONEW("PROVIDER")=$P(PSOY,"^",4),PSODRUG("IEN")=$P(PSOY,"^",6)
"RTN","PSORXI",78,0)
 D START K PSOIVDSN
"RTN","PSORXI",79,0)
EN2X Q 0
"RTN","PSORXI",80,0)
 ;
"RTN","PSORXI",81,0)
EN3(PSOIVDST) ; Entry Point for dose interventions without a prescription
"RTN","PSORXI",82,0)
 ;PSOIVDST = Dosing intervention text
"RTN","PSORXI",83,0)
 N PSOIVDSN S PSOIVDSN=0
"RTN","PSORXI",84,0)
 D LOOK I 'PSOIVDSN Q 1
"RTN","PSORXI",85,0)
 D START K PSOIVDSN
"RTN","PSORXI",86,0)
EN3X Q 0
"RTN","PSORXI",87,0)
 ;
"RTN","PSORXI",88,0)
LOOK ;Find Internal Number of 32.3 file
"RTN","PSORXI",89,0)
 S PSOIVDSN=$$FIND1^DIC(9009032.3,"","X",PSOIVDST,"B")
"RTN","PSORXI",90,0)
 Q
"RTN","PSORXL")
0^71^B74408988
"RTN","PSORXL",1,0)
PSORXL ;BHAM ISC/SAB - action to be taken on prescriptions ;10/15/08 2:12pm
"RTN","PSORXL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**8,21,24,32,47,135,148,287,334,251**;DEC 1997;Build 202
"RTN","PSORXL",3,0)
 ;External reference to File #50 supported by DBIA 221
"RTN","PSORXL",4,0)
 ;External references CHPUS^IBACUS and TRI^IBACUS supported by DBIA 2030
"RTN","PSORXL",5,0)
 I $G(PSOTRVV),$G(PPL) S PSORX("PSOL",1)=PPL K PPL
"RTN","PSORXL",6,0)
 N SLBL,PSOSONE,PSOKLRXS
"RTN","PSORXL",7,0)
 S:'$G(PPL) PPL=$G(PSORX("PSOL",1)) G:$P(PSOPAR,"^",26) P
"RTN","PSORXL",8,0)
LBL ;
"RTN","PSORXL",9,0)
 I $G(PPL) N PSOCKDC S PSOCKDC=1 D ECME^PSORXL1 I '$G(PPL) S PPL="" G RXSQUIT  ;*334 ;don't prompt to print labels for DC'ed Rx's
"RTN","PSORXL",10,0)
 W !! S DIR("A",1)="Label Printer: "_$S($G(SUSPT):PSLION,1:$G(PSOLAP))
"RTN","PSORXL",11,0)
 S DIR("A")="LABEL: QUEUE/CHANGE PRINTER"_$S($P(PSOPAR,"^",23):"/HOLD",1:"")_$S($P(PSOPAR,"^",24):"/SUSPEND",1:"")_$S($P(PSOPAR,"^",26):"/LABEL",1:"")_" or '^' to bypass "
"RTN","PSORXL",12,0)
 S DIR("?",1)="Enter 'Q' to queue labels to print",DIR("?")="Enter '^' to bypass label functions",DIR("?",4)="Enter 'S' to suspend labels to print later"
"RTN","PSORXL",13,0)
 S DIR("?",2)="Enter 'H' to hold label until Rx can be filled",DIR("?",3)="Enter 'P' for Rx profile"
"RTN","PSORXL",14,0)
 S DIR("?",5)="Enter 'C' to select another label printer"
"RTN","PSORXL",15,0)
 S:$P(PSOPAR,"^",26) DIR("?",5)="Enter 'L' to print labels without queuing"
"RTN","PSORXL",16,0)
TRI ;Tricare
"RTN","PSORXL",17,0)
 S X="IBACUS" X ^%ZOSF("TEST") K X I '$T G PASS
"RTN","PSORXL",18,0)
 I '$$TRI^IBACUS() G PASS
"RTN","PSORXL",19,0)
 I '$D(PSORX("PSOL",1))!($G(PSOSUREP))!($G(PSOEXREP)) G PASS
"RTN","PSORXL",20,0)
 N GGG,PBILL,PSTRD,PSTRDZ,PSTRF,PSTRP,TRXI,TRIRX,PSTRIVAR,VV,VVV,VVCT
"RTN","PSORXL",21,0)
 D DEV^PSOCPTRI
"RTN","PSORXL",22,0)
 K ^TMP($J,"PSONOB"),^TMP($J,"PSOBILL")
"RTN","PSORXL",23,0)
 S VVCT=0 F VV=0:0 S VV=$O(PSORX("PSOL",VV)) Q:'VV  F VVV=1:1 S TRXI=$P(PSORX("PSOL",VV),",",VVV) Q:'TRXI  D
"RTN","PSORXL",24,0)
 .I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSORXL",25,0)
 .I $P($G(^PSRX(+TRXI,"STA")),"^")=3 Q
"RTN","PSORXL",26,0)
 .S PSTRP=$P($G(^PSRX(+TRXI,0)),"^",2),PSTRD=+$G(PSOSITE),PSTRDZ=+$G(DUZ)
"RTN","PSORXL",27,0)
 .S PSTRF=0 F GGG=0:0 S GGG=$O(^PSRX(+TRXI,1,GGG)) Q:'GGG  S PSTRF=GGG
"RTN","PSORXL",28,0)
 .S VVCT=VVCT+1
"RTN","PSORXL",29,0)
 .I $G(RXRP(TRXI))!($G(RXPR(TRXI)))!($G(RXRH(TRXI))) S ^TMP($J,"PSONOB",VVCT)=TRXI Q
"RTN","PSORXL",30,0)
 .S PBILL=$$CHPUS^IBACUS(PSTRP,DT,TRXI,PSTRF,PSOLAP,PSTRD,PSTRDZ) S ^TMP($J,$S($G(PBILL):"PSOBILL",1:"PSONOB"),VVCT)=TRXI
"RTN","PSORXL",31,0)
 I '$D(^TMP($J,"PSOBILL")) K ^TMP($J,"PSONOB") G PASS
"RTN","PSORXL",32,0)
 I '$D(^TMP($J,"PSONOB")),$D(^TMP($J,"PSOBILL")) S (Y,LBL)="H" G H1
"RTN","PSORXL",33,0)
 ;If some Rx's are billable, and some are not
"RTN","PSORXL",34,0)
SETP K PSORX("PSOL"),PPL S VVCT=1 F VV=0:0 S VV=$O(^TMP($J,$S($G(PSTRIVAR):"PSONOB",1:"PSOBILL"),VV)) Q:'VV  S TRIRX=^TMP($J,$S($G(PSTRIVAR):"PSONOB",1:"PSOBILL"),VV) I +TRIRX D
"RTN","PSORXL",35,0)
 .I $G(PSORX("PSOL",1))="" S PSORX("PSOL",1)=TRIRX_"," Q
"RTN","PSORXL",36,0)
 .I $L(PSORX("PSOL",VVCT))+$L(TRIRX)<220 S PSORX("PSOL",VVCT)=PSORX("PSOL",VVCT)_TRIRX_"," Q
"RTN","PSORXL",37,0)
 .S VVCT=VVCT+1 S PSORX("PSOL",VVCT)=TRIRX_","
"RTN","PSORXL",38,0)
 I '$G(PSTRIVAR) S (Y,LBL)="H" S PSOKLRXS=1 K PSORSAVE,PSOPSAVE,PSOHSAVE D RSAVE D H1 D RREST K PSORSAVE,PSOPSAVE,PSOHSAVE K PSOKLRXS S PSTRIVAR=1 G SETP
"RTN","PSORXL",39,0)
 K ^TMP($J,"PSONOB") S PPL=$G(PSORX("PSOL",1))
"RTN","PSORXL",40,0)
PASS ;
"RTN","PSORXL",41,0)
 I $E($G(DIR("A")),1,6)'="LABEL:" D RESDIR^PSOCPTRI
"RTN","PSORXL",42,0)
 S DIR(0)="SA^P:PROFILE;Q:QUEUE;C:CHANGE PRINTER"_$S($P(PSOPAR,"^",23):";H:HOLD",1:"")_$S($P(PSOPAR,"^",24):";S:SUSPENSE",1:"")_$S($P(PSOPAR,"^",26):";L:PRINT",1:""),DIR("B")="Q" D ^DIR D  G:$D(DIRUT)!($D(DUOUT)) EX
"RTN","PSORXL",43,0)
 .I $D(DIRUT)!($D(DUOUT)) D AL^PSOLBL("UT") I $G(PSOEXREP) S PSOEXREX=1
"RTN","PSORXL",44,0)
 .I $G(PSOPULL) I $D(DIRUT)!($D(DUOUT)) S PSOQFLAG=1
"RTN","PSORXL",45,0)
 S:$G(PSOBEDT) NOPP=Y
"RTN","PSORXL",46,0)
 I $G(Y)="C" K PSOCLBL,%ZIS("B") S PSOCLBL=1 D @$S('$D(PSOPAR):"^PSOLSET",1:"PLBL^PSOLSET") K PSOCLBL G LBL
"RTN","PSORXL",47,0)
 I $G(Y)="Q",$D(RXRS),'$G(PSOPULL) D PPLADD^PSOSUPOE
"RTN","PSORXL",48,0)
 I $G(PSXSYS),($G(Y)'="H"),($G(Y)'="P"),('$G(PSOEXREP)) S LBL=Y,(RXLTOP,PPL1)=1 S:'$G(PSOPULL) SLBL=Y D A^PSOCMOP G:'$G(PPL) D1
"RTN","PSORXL",49,0)
 K DIR S LBL=Y S:'$G(PSOPULL) SLBL=Y G Q:Y="Q",S:Y="S",H1:Y="H",P:Y="L" I Y="P" W ! S PSDFN=DFN,PSFROM="" D ^PSODSPL K PSDFN,PSFROM G LBL
"RTN","PSORXL",50,0)
EX I $D(DUOUT)!$D(DIRUT) K BINGCRT,BINGRTE,BBRX,BBFLG S:$D(RXRS) SLBL="^" G:$D(RXRS) RXS K DIR,X,DIRUT,DUOUT,ACT,Y,DTOUT,PPL,REPRINT S NOBG=1 G RXSQUIT  ;*334
"RTN","PSORXL",51,0)
Q S PPL1=1 G:$G(PPL)']"" D1 S PSNP=0,PSL=1 D  I $G(PSOFROM)="NEW",$P(PSOPAR,"^",8) S PSNP=1
"RTN","PSORXL",52,0)
 .Q:'$P(PSOPAR,"^",8)!($G(PSONOPRT))
"RTN","PSORXL",53,0)
 .F SLPPL=0:0 S SLPPL=$O(RXRS(SLPPL)) Q:'SLPPL!($G(PSNP))  I '$O(^PSRX(SLPPL,1,0)),'$D(RXPR(SLPPL)) S PSNP=1
"RTN","PSORXL",54,0)
 I $G(PSOLAP)]"",$G(PSOLAP)'=ION G QLBL
"RTN","PSORXL",55,0)
Q1 W ! K POP S %ZIS("B")="",%ZIS="MNQ",%ZIS("A")="Select LABEL DEVICE: " D ^%ZIS S PSLION=ION K %ZIS("A")
"RTN","PSORXL",56,0)
 G:$G(POP)&($G(PSPARTXX)) RXSQUIT G:$G(POP)&($G(PSOSONE)) RXSQ D:$G(POP)&($G(PSONOPRT))
"RTN","PSORXL",57,0)
 .S PSOQFLAG=1
"RTN","PSORXL",58,0)
 G:$G(PSOQFLAG) RXSQUIT G:POP!(IO=IO(0)) LBL S PSOLAP=ION  ;*334
"RTN","PSORXL",59,0)
 N PSOIOS S PSOIOS=IOS D DEVBAR^PSOBMST
"RTN","PSORXL",60,0)
 S PSOBARS=PSOBAR1]""&(PSOBAR0]"")&$P(PSOPAR,"^",10)
"RTN","PSORXL",61,0)
 D ^%ZISC S PSL=0
"RTN","PSORXL",62,0)
QLBL I $G(PSXSYS),('$G(RXLTOP)),('$G(PSOEXREP)) D RXL^PSOCMOP G:'$G(PPL) D1
"RTN","PSORXL",63,0)
 ;
"RTN","PSORXL",64,0)
 ;- Submitting list of Rx to ECME for DUR/79 REJECT check and possible submission to 3rd Pary Payer
"RTN","PSORXL",65,0)
 D ECME^PSORXL1 I '$G(PPL) W !!,"No Label(s) printed.",!! S PSOQFLAG=1 G RXSQUIT  ;*334
"RTN","PSORXL",66,0)
 ;
"RTN","PSORXL",67,0)
 S ZTRTN="DQ^PSOLBL",ZTIO=$S($G(SUSPT):PSLION,1:PSOLAP),ZTDESC="Outpatient Pharmacy "_$S($G(SUSPT):"SUSPENSE ",$G(DG):"DRUG INTERACTION ",1:"")_"LABELS OUTPUT ROUTINE",ZTDTH=$S($G(PSOTIME):PSOTIME,1:$H),PDUZ=DUZ
"RTN","PSORXL",68,0)
 F G="PPL1","PSOSYS","DFN","PSOPAR","PDUZ","PCOMX",$S($G(SUSPT):"PFION",1:"PSOLAP"),"PPL","PSOSITE","RXY","COPIES","SIDE","PSOSUSPR","PSOBARS","PSOBAR1","PSOBAR0","PSODELE","PSOPULL","PSTAT","PSODBQ","PSOEXREP","PSOTREP" S:$D(@G) ZTSAVE(G)=""
"RTN","PSORXL",69,0)
 S ZTSAVE("PSORX(")="",ZTSAVE("RXRP(")="",ZTSAVE("RXPR(")="",ZTSAVE("RXRS(")="",ZTSAVE("RXFL(")="",ZTSAVE("PCOMH(")=""
"RTN","PSORXL",70,0)
 D ^%ZISC,^%ZTLOAD K:$G(PSOSONE) RXRS W:$D(ZTSK)&('$G(SUSPT))&('$G(PSOEXREP)) !!,"LABEL(S) QUEUED TO PRINT",!!
"RTN","PSORXL",71,0)
 G:$G(PSPARTXX) RXSQUIT K G,PDUZ K:'$G(SUSPT) ZTSK G:$G(DG) RXSQUIT  ;*334
"RTN","PSORXL",72,0)
 G:'$G(PSNP) QUEUP G:$G(PSOPRFLG) QUEUP S HOLDRPAS=$G(PSOPRPAS),PSOPRPAS=$P(PSOPAR,"^",13)
"RTN","PSORXL",73,0)
PLBL S PSOION=ION
"RTN","PSORXL",74,0)
 I '$D(PSOPROP)!($G(PSOPROP)=ION) W $C(7),!,"PROFILES MUST BE SENT TO PRINTER !!",! K IOP,%ZIS,IO("Q"),POP S %ZIS="MNQ",%ZIS("A")="Select PROFILE DEVICE: " D ^%ZIS K %ZIS("A") G:POP QUEUP G:$E(IOST)["C"!(PSOION=ION) PLBL S PSOPROP=ION
"RTN","PSORXL",75,0)
QPRF S ZTRTN="DQ^PSOPRF",ZTIO=PSOPROP,ZTDESC="Outpatient Pharmacy "_$S($G(SUSPT):"SUSPENSE ",1:"")_"PATIENT PROFILES",ZTDTH=$S($G(PSOTIME):PSOTIME,1:$H)
"RTN","PSORXL",76,0)
 F G="PSOPAR","PSODTCUT","PSOPRPAS","DFN","PSOSITE","NEW1","NEW11","PSOBMST","PFIO","PPL" S:$D(@G) ZTSAVE(G)=""
"RTN","PSORXL",77,0)
 D ^%ZTLOAD W:$D(ZTSK)&('$G(SUSPT))&('$G(PSOEXREP)) !,"PROFILE IS QUEUED TO PRINT",!! K G K:'$G(SUSPT) ZTSK D ^%ZISC
"RTN","PSORXL",78,0)
QUEUP D:$G(POP)&($G(PSONOPRT))  G:$G(PSOQFLAG) RXSQUIT S PSNP=0,PSOPRPAS=$G(HOLDRPAS) K:PSOPRPAS']"" PSOPRPAS K HOLDRPAS G D1  ;*334
"RTN","PSORXL",79,0)
 .S PSOQFLAG=1
"RTN","PSORXL",80,0)
 Q
"RTN","PSORXL",81,0)
 ;
"RTN","PSORXL",82,0)
S G S^PSORXL1
"RTN","PSORXL",83,0)
SUS S X="IBACUS" X ^%ZOSF("TEST") K X I '$T G SUSL1
"RTN","PSORXL",84,0)
 N TRIDA S TRIDA=DA I '$$TRI^IBACUS() S DA=TRIDA G SUSL1
"RTN","PSORXL",85,0)
 I $G(RXRP(TRIDA))!($G(RXPR(TRIDA)))!($G(RXRH(TRIDA))) S DA=TRIDA G SUSL1
"RTN","PSORXL",86,0)
 N PBILL,PSTRD,PSTRDZ,PSTRF,PSTRP,GGG
"RTN","PSORXL",87,0)
 D DEV^PSOCPTRI
"RTN","PSORXL",88,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSORXL",89,0)
 S PSTRP=$P($G(^PSRX(+TRIDA,0)),"^",2),PSTRD=+$G(PSOSITE),PSTRDZ=+$G(DUZ)
"RTN","PSORXL",90,0)
 S PSTRF=0 F GGG=0:0 S GGG=$O(^PSRX(+TRIDA,1,GGG)) Q:'GGG  S PSTRF=GGG
"RTN","PSORXL",91,0)
 S PBILL=$$CHPUS^IBACUS(PSTRP,DT,TRIDA,PSTRF,PSOLAP,PSTRD,PSTRDZ)
"RTN","PSORXL",92,0)
 I '$G(PBILL) S DA=TRIDA G SUSL1
"RTN","PSORXL",93,0)
 S FLD(99)="99",FLD(99.1)="Awaiting CHAMPUS billing approval"
"RTN","PSORXL",94,0)
 N RSDT,ACT,PSUS,RXF,RFN,I,PSDA,NOW,IR,FDA
"RTN","PSORXL",95,0)
 S DA=TRIDA D H^PSOCPTRH
"RTN","PSORXL",96,0)
 Q
"RTN","PSORXL",97,0)
SUSL1 G SUS^PSORXL1
"RTN","PSORXL",98,0)
H1 S PPL1=1 S:'$G(PPL) PPL=$G(PSORX("PSOL",PPL1))
"RTN","PSORXL",99,0)
 D:'$D(^TMP($J,"PSOBILL")) NOOR^PSOHLD I $D(DIRUT) K DIRUT G PSORXL
"RTN","PSORXL",100,0)
 I $D(^TMP($J,"PSOBILL")) S FLD(99)="99",FLD(99.1)="Awaiting CHAMPUS billing approval" G H
"RTN","PSORXL",101,0)
 G:$G(PPL)']"" D1 D FLD^PSOHLD I $D(DUOUT)!($D(DIRUT)) K DIRUT,DUOUT,FLD,DIR G LBL
"RTN","PSORXL",102,0)
H K SPPL G:$D(DTOUT) D1 S SPPL="" F PI=1:1 Q:$P(PPL,",",PI)=""  D
"RTN","PSORXL",103,0)
 .S DA=$P(PPL,",",PI) I $P(^PSRX(DA,"STA"),"^")<10,$P(^("STA"),"^")'=4 D @$S($D(^TMP($J,"PSOBILL")):"H^PSOCPTRH",1:"H^PSOHLD") Q
"RTN","PSORXL",104,0)
 .I $P(^PSRX(DA,"STA"),"^")=4 S SPPL=SPPL_DA_"," Q
"RTN","PSORXL",105,0)
 I $G(SPPL)]"" D
"RTN","PSORXL",106,0)
 .W !!,$C(7),"Drug Interaction Rx(s) " F I=1:1 Q:$P(SPPL,",",I)=""  W $P(^PSRX($P(SPPL,",",I),0),"^")_", "
"RTN","PSORXL",107,0)
 .S PPL=SPPL,DG=1 D Q K DG,SPPL
"RTN","PSORXL",108,0)
D1 K RXLTOP I $G(PPL1),$O(PSORX("PSOL",$G(PPL1))) S PPL1=$O(PSORX("PSOL",PPL1)),PPL=PSORX("PSOL",PPL1) G @$S(LBL="H":"H",LBL="L":"P1",1:"QLBL")
"RTN","PSORXL",109,0)
RXS I $D(RXRS),'$G(PSOKLRXS) I $G(SLBL)="H"!($G(SLBL)="S")!($G(SLBL)="^")!($G(SLBL)="") D  G:$G(PPL)'="" Q
"RTN","PSORXL",110,0)
 .K PPL,PSORX("PSOL") S PSOSONE=1 D PPLADD^PSOSUPOE
"RTN","PSORXL",111,0)
 .Q:$G(PPL)=""  W !!,"You have selected the following Rx(s) to be pulled from suspense:",!
"RTN","PSORXL",112,0)
 .F RXSS=0:0 S RXSS=$O(RXRS(RXSS)) Q:'RXSS  W !," Rx # ",$P($G(^PSRX(+$G(RXSS),0)),"^"),?23,$P($G(^PSDRUG(+$P($G(^PSRX(+$G(RXSS),0)),"^",6),0)),"^")
"RTN","PSORXL",113,0)
 .K DIR W ! S DIR(0)="Y",DIR("B")="YES",DIR("A")="Do you still want to pull these Rx(s) from suspense" D ^DIR K DIR I Y'=1 W !!,"Rx(s) will remain in Suspense!",! D RESET^PSOSUPOE K RXRS,PPL
"RTN","PSORXL",114,0)
RXSQUIT K:'$G(PSOKLRXS) RXRS K ^TMP($J,"PSOBILL"),RXPR,RXRP,RXRH,RXSS,LBL,PPL1,PPL,DIR,%DT,%,SD,COUNT,EXDT,L,PDUZ,REF,REPRINT,RFDATE,RFL1,RFLL,RXN,WARN,ZY,FLD,PI,ZD,ACT,X,Y,DIRUT,DUOUT,DTOUT,DIROUT Q  ;*334 ADDED TAG NAME
"RTN","PSORXL",115,0)
P S PPL1=1 S:'$G(PPL) PPL=$G(PSORX("PSOL",1)) G:$G(PPL)']"" D1
"RTN","PSORXL",116,0)
 I $G(PSOLAP)']"" W ! K POP,ZTSK S %ZIS="M",%ZIS("A")="Select LABEL DEVICE: " D ^%ZIS K %ZIS("A") G:POP LBL S PSOLAP=ION
"RTN","PSORXL",117,0)
 S IOP=PSOLAP D ^%ZIS
"RTN","PSORXL",118,0)
 N PSOIOS S PSOIOS=IOS D DEVBAR^PSOBMST
"RTN","PSORXL",119,0)
P1 S PSOBARS=PSOBAR1]""&(PSOBAR0]"")&$P(PSOPAR,"^",10),PDUZ=DUZ D DQ1^PSOLBL,^%ZISC
"RTN","PSORXL",120,0)
 G:'$P(PSOPAR,"^",8)!(+$G(REPRINT))!($G(PSOFROM)'="NEW") D1 I $G(PSOPROP)']"" S PSOION=ION,%ZIS="M",%ZIS("A")="Select PROFILE DEVICE: " D ^%ZIS K %ZIS("A") G:POP D1 S PSOPROP=ION
"RTN","PSORXL",121,0)
 S IOP=PSOPROP D ^%ZIS D DQ^PSOPRF,^%ZISC G D1
"RTN","PSORXL",122,0)
 Q
"RTN","PSORXL",123,0)
RXSQ K RXRS G RXS
"RTN","PSORXL",124,0)
 Q
"RTN","PSORXL",125,0)
RSAVE N PMX
"RTN","PSORXL",126,0)
 S PMX="" F  S PMX=$O(RXRP(PMX)) Q:PMX=""  S PSORSAVE(PMX)=RXRP(PMX)
"RTN","PSORXL",127,0)
 S PMX="" F  S PMX=$O(RXPR(PMX)) Q:PMX=""  S PSOPSAVE(PMX)=RXPR(PMX)
"RTN","PSORXL",128,0)
 S PMX="" F  S PMX=$O(RXRH(PMX)) Q:PMX=""  S PSOHSAVE(PMX)=RXRH(PMX)
"RTN","PSORXL",129,0)
 Q
"RTN","PSORXL",130,0)
RREST N PMXZ
"RTN","PSORXL",131,0)
 S PMXZ="" F  S PMXZ=$O(PSORSAVE(PMXZ)) Q:PMXZ=""  S RXRP(PMXZ)=PSORSAVE(PMXZ)
"RTN","PSORXL",132,0)
 S PMXZ="" F  S PMXZ=$O(PSOPSAVE(PMXZ)) Q:PMXZ=""  S RXPR(PMXZ)=PSOPSAVE(PMXZ)
"RTN","PSORXL",133,0)
 S PSMX="" F  S PMXZ=$O(PSOHSAVE(PMXZ)) Q:PMXZ=""  S RXRH(PMXZ)=PSOHSAVE(PMXZ)
"RTN","PSORXL",134,0)
 Q
"RTN","PSORXL1")
0^76^B52372204
"RTN","PSORXL1",1,0)
PSORXL1 ;BIR/SAB-action to be taken on prescriptions ;10/5/07 2:40pm
"RTN","PSORXL1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**36,46,148,260,274,287,289,358,251**;DEC 1997;Build 202
"RTN","PSORXL1",3,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5424
"RTN","PSORXL1",4,0)
S S SPPL="",PPL1=1 S:'$G(PPL) PPL=$G(PSORX("PSOL",PPL1)) G:$G(PPL)']"" D1
"RTN","PSORXL1",5,0)
S1 F PI=1:1 Q:$P(PPL,",",PI)=""  S DA=$P(PPL,",",PI) D
"RTN","PSORXL1",6,0)
 .S PSORFD1=0 F PSOX7=0:0 S PSOX7=$O(^PSRX(DA,1,PSOX7)) Q:'$G(PSOX7)  S (PSORFD1)=PSOX7
"RTN","PSORXL1",7,0)
 .I 'PSORFD1,$$DS^PSSDSAPI,($G(^PS(52.4,DA,1))>0)&('$D(^XUSEC("PSORPH",DUZ))) S SPPL=SPPL_DA_"," Q
"RTN","PSORXL1",8,0)
 .I 'PSORFD1,$P(^PSRX(DA,"STA"),"^")=4!($D(^PSRX(DA,"DRI"))&('$D(^XUSEC("PSORPH",DUZ)))) S SPPL=SPPL_DA_"," Q
"RTN","PSORXL1",9,0)
 .I $P(^PSRX(DA,"STA"),"^")<10,$P(^("STA"),"^")'=4 D SUS Q
"RTN","PSORXL1",10,0)
 .K PSORFD1,PSOX7
"RTN","PSORXL1",11,0)
 I $G(SPPL)]"" D  K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR,DUOUT,DTOUT,DIRUT
"RTN","PSORXL1",12,0)
 .W !!,$C(7),"Drug Interaction Rx(s) and/or Dose Warning: " F I=1:1 Q:$P(SPPL,",",I)=""  W $P(^PSRX($P(SPPL,",",I),0),"^")_", "
"RTN","PSORXL1",13,0)
 .I $G(PSOLAP)=""!($G(PSOLAP)=$G(ION)) W !,"Label device must be selected for Drug Interaction or dose warning label!"
"RTN","PSORXL1",14,0)
 .S PPL=SPPL,DG=1 N PPL1 D Q^PSORXL K DG,SPPL
"RTN","PSORXL1",15,0)
 S SUSPT="SUSPENSE" G D1
"RTN","PSORXL1",16,0)
 Q
"RTN","PSORXL1",17,0)
SUS S ACT=1,RXN=DA,RX0=^PSRX(DA,0),SD=$S($G(ZD(DA)):$E(ZD(DA),1,7),1:$P(^(3),"^")),RXS=$O(^PS(52.5,"B",DA,0)) I RXS S RXCMOP=$P($G(^PS(52.5,RXS,0)),"^",7) D  Q:$G(DFLG)!($G(PSOWFLG))
"RTN","PSORXL1",18,0)
 .;checks to see if future fill exists
"RTN","PSORXL1",19,0)
 .S PSOWFLG=0 I '$G(RXPR(DA)),$P($G(^PS(52.5,RXS,"P")),"^")=0,$P($G(^PSRX(DA,"STA")),"^")=5 D SWARN Q:$G(PSOWFLG)
"RTN","PSORXL1",20,0)
 .K PSOWFLG I $G(RXPR(DA)),'$P($G(^PS(52.5,RXS,"P")),"^") D WARN Q:$G(DFLG)
"RTN","PSORXL1",21,0)
 .S DA=RXS,DIK="^PS(52.5," D ^DIK S DA=RXN I $P($G(^PSRX(RXN,"STA")),"^")=5 S $P(^("STA"),"^")=0
"RTN","PSORXL1",22,0)
 G:$G(RXRP(DA))!($G(RXPR(DA))) LOCK
"RTN","PSORXL1",23,0)
 I $G(PSXSYS) D SUS1^PSOCMOP I $G(XFLAG)=1 K XFLAG Q
"RTN","PSORXL1",24,0)
LOCK I $P($G(^PSRX(RXN,"STA")),"^")=3 G SUSQ
"RTN","PSORXL1",25,0)
 S RXP=+$G(RXPR(DA)),DIC="^PS(52.5,",DIC(0)="L",X=RXN,DIC("DR")=".02///"_SD_";.03////"_$P(^PSRX(DA,0),"^",2)_";.04///M;.05///"_RXP_";.06////"_PSOSITE_";2///0" K DD,DO D FILE^DICN D  I +Y,'$G(RXP),$G(RXRP(RXN)) S $P(^PS(52.5,+Y,0),"^",12)=1
"RTN","PSORXL1",26,0)
 .K DD,DO I +Y,$G(PSOEXREP) S $P(^PS(52.5,+Y,0),"^",12)=1
"RTN","PSORXL1",27,0)
 .I +Y S $P(^PS(52.5,+Y,0),"^",13)=$G(RXFL(RXN))
"RTN","PSORXL1",28,0)
 S $P(^PSRX(RXN,"STA"),"^")=5,LFD=$E(SD,4,5)_"-"_$E(SD,6,7)_"-"_$E(SD,2,3) D ACT
"RTN","PSORXL1",29,0)
 W !!,$S(RXP:"Partial ",1:"")_"RX# ",$P(^PSRX(RXN,0),"^")_" has been suspended until "_LFD_"."
"RTN","PSORXL1",30,0)
 S VALMSG=$S(RXP:"Partial ",1:"")_"Rx# "_$P(^PSRX(RXN,0),"^")_" Has Been Suspended Until "_LFD_"."_$S($G(RXRP(RXN))&('$G(RXP)):" (Reprint)",1:"")
"RTN","PSORXL1",31,0)
 S COMM=$S(RXP:"Partial ",1:"")_"Rx# "_$P(^PSRX(RXN,0),"^")_" Has Been Suspended Until "_LFD_"."_$S($G(RXRP(RXN))&('$G(RXP)):" (Reprint)",1:"")
"RTN","PSORXL1",32,0)
 D:'$D(^TMP("PSORXN",$J,RXN)) EN^PSOHLSN1(RXN,"SC","ZS",COMM)
"RTN","PSORXL1",33,0)
 S:$D(^TMP("PSORXN",$J,RXN)) $P(^TMP("PSORXN",$J,RXN),"^",4)=COMM
"RTN","PSORXL1",34,0)
 ;
"RTN","PSORXL1",35,0)
 ; - If not a PARTIAL, reverse ECME Claim, if necessary
"RTN","PSORXL1",36,0)
 I '$G(RXFL(RXN)) S RXFL(RXN)=$$LSTRFL^PSOBPSU1(RXN)
"RTN","PSORXL1",37,0)
 I '$G(RXP),'$G(PSONPROG) D REVERSE^PSOBPSU1(RXN,,"DC",3)  ;PSONPROG - Tricare in progress, don't reverse
"RTN","PSORXL1",38,0)
 K COMM
"RTN","PSORXL1",39,0)
SUSQ Q
"RTN","PSORXL1",40,0)
 ;PSO*7*274 always recalculate RXF
"RTN","PSORXL1",41,0)
ACT S RXF=0 F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RXF=I S:I>5 RXF=I+1
"RTN","PSORXL1",42,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(DA,"A",FDA)) Q:'FDA  S IR=FDA
"RTN","PSORXL1",43,0)
 S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSORXL1",44,0)
 D NOW^%DTC S ^PSRX(DA,"A",IR,0)=%_"^S^"_DUZ_"^"_RXF_"^"_$S(RXP:"Partial ",1:"")_"RX "_$S($G(RXRP(DA))&('$G(RXP)):"Reprint ",1:"")_"Placed on Suspense until "_LFD K RXF,I,FDA,DIC,DIE,DR,Y,X,%,%H,%I
"RTN","PSORXL1",45,0)
 Q
"RTN","PSORXL1",46,0)
D1 I $O(PSORX("PSOL",$G(PPL1))) S PPL1=$O(PSORX("PSOL",$G(PPL1))),PPL=PSORX("PSOL",PPL1) G S1
"RTN","PSORXL1",47,0)
 G:$D(RXRS) RXS^PSORXL
"RTN","PSORXL1",48,0)
 K LBL,PPL1,PPL,DIR,%DT,%,SD,COUNT,EXDT,L,PDUZ,REF,REPRINT,RFDATE,RFL1,RFLL,RXN,WARN,ZY,FLD,PI,ZD,ACT,X,Y,DIRUT,DUOUT,DTOUT,DIROUT,DFLG,RXPD,PSOWFLG
"RTN","PSORXL1",49,0)
 Q
"RTN","PSORXL1",50,0)
WARN W ! K DIR,DIRUT,DUOUT,DTOUT,DFLG S Y=$P(^PS(52.5,RXS,0),"^",2) X ^DD("DD") S RXPD=Y,DIR(0)="SA^S:SUSPEND;Q:QUEUE;E:EXIT"
"RTN","PSORXL1",51,0)
 S DIR("A",1)="Rx #"_$P(^PSRX(DA,0),"^")_" is suspended "_$S($G(RXCMOP)]"":"for CMOP ",1:"")_"until "_RXPD
"RTN","PSORXL1",52,0)
 I $G(RXCMOP)]"" D  G WARN1
"RTN","PSORXL1",53,0)
 .W !!,"A partial entered for this Rx cannot be suspended."
"RTN","PSORXL1",54,0)
 .W !,"You may pull this fill from suspense or print the label now.",!!
"RTN","PSORXL1",55,0)
 .S DIR("A",2)=" ",DIR("A",3)="   Do you want to Queue to print",DIR("A")="                or Exit: "
"RTN","PSORXL1",56,0)
 S DIR("A",2)=" ",DIR("A",3)="   Do you want to: Suspend Partial",DIR("A",4)="                   Queue to print",DIR("A")="                or Exit:  "
"RTN","PSORXL1",57,0)
WARN1 S DIR("B")="EXIT",DIR("?")="^D HLP^PSORXL1" D ^DIR K DIR
"RTN","PSORXL1",58,0)
 I Y="E"!($D(DIRUT))!(Y="S"&($G(RXCMOP)]"")) S DA(1)=DA,DA=RXPR(DA),DIK="^PSRX("_DA(1)_",""P""," D ^DIK S ^PSRX(DA(1),"TYPE")=0,DFLG=1 W $C(7)," Partial Removed!" Q
"RTN","PSORXL1",59,0)
 I Y="Q" S DPPL=PPL,HOLDPPL1=$G(PPL1),DPI=PI,RXLTOP=1 S PPL=$G(RXN)_"," S PSPARTXX=1 D Q^PSORXL K PSPARTXX S DFLG=1,PPL=DPPL,PI=DPI,PPL1=$G(HOLDPPL1) K HOLDPPL1,DPPL,DPPI,DPI,RXLTOP Q
"RTN","PSORXL1",60,0)
 Q
"RTN","PSORXL1",61,0)
HLP I $G(RXCMOP)']"" W !!,"If you choose to suspend this partial Rx, the current suspended fill will",!,"be replaced by the partial.  You may want to pull this fill early instead.",!
"RTN","PSORXL1",62,0)
 I $G(RXCMOP)]"" W !!,"You cannot suspend a partial when a CMOP fill is in suspense, because the partial will replace the CMOP fill in suspense."
"RTN","PSORXL1",63,0)
 W !,"If you choose to queue this partial, the label will printout on the previous",!,"selected label printer.",!
"RTN","PSORXL1",64,0)
 W !,"You may exit without printing or suspending this partial.  This will also delete",!,"the partial Rx entered."
"RTN","PSORXL1",65,0)
 Q
"RTN","PSORXL1",66,0)
SWARN ;
"RTN","PSORXL1",67,0)
 S PSORXLDA=$G(DA),PSORXZD=$P($G(^PS(52.5,RXS,0)),"^",2)
"RTN","PSORXL1",68,0)
 W $C(7),!!,"Rx "_$P($G(^PSRX(DA,0)),"^")_" is already suspended "_$S($G(RXCMOP)]"":"for CMOP ",1:"")_"until "_$E(PSORXZD,4,5)_"-"_$E(PSORXZD,6,7)_"-"_$E(PSORXZD,2,3)_"." K PSORXZD
"RTN","PSORXL1",69,0)
 W !,"By suspending this fill, the fill that is already suspended will be overwritten",!,"and a label will not print for that fill!",!
"RTN","PSORXL1",70,0)
 N PSORF,PSOTRIC D TRIC(DA)
"RTN","PSORXL1",71,0)
 I PSOTRIC,$$STATUS^PSOBPSUT(DA,PSORF)'["PAYABLE" S PSOQFLAG=1 Q
"RTN","PSORXL1",72,0)
 K DIR S DIR(0)="SA^Q:QUEUE;S:SUSPEND",DIR("B")="Q",DIR("A")="Do you want to Queue to print or Suspend Rx "_$P($G(^PSRX(DA,0)),"^")_": " D ^DIR K DIR
"RTN","PSORXL1",73,0)
 I $G(Y)="S" K RXFL(PSORXLDA) G SWARNQ
"RTN","PSORXL1",74,0)
 I $G(Y)="Q" D  G SWARNQ
"RTN","PSORXL1",75,0)
 . S PSOKSPPL=$G(PPL),PSOZXPPL=$G(PPL1),PSOZXPI=$G(PI),RXLTOP=1
"RTN","PSORXL1",76,0)
 . S PPL=$G(RXN)_"," D SWARS D Q^PSORXL S PSOWFLG=1,PPL=PSOKSPPL
"RTN","PSORXL1",77,0)
 . S PI=PSOZXPI,PPL1=PSOZXPPL K PSOKSPPL,PSOZXPPL,PSOZXPI,RXLTOP,RXFL(+$G(PSORXLDA))
"RTN","PSORXL1",78,0)
 W !!,"Nothing queued to print for Rx "_$P($G(^PSRX(PSORXLDA,0)),"^"),! S PSOWFLG=1
"RTN","PSORXL1",79,0)
SWARNQ ;
"RTN","PSORXL1",80,0)
 S DA=$G(PSORXLDA) K PSORXLDA
"RTN","PSORXL1",81,0)
 Q
"RTN","PSORXL1",82,0)
SWARS ;
"RTN","PSORXL1",83,0)
 S PSOZXFL(PSORXLDA)=+$P($G(^PS(52.5,+$G(RXS),0)),"^",13) I '$G(PSOZXFL(PSORXLDA)) K PSOZXFL Q
"RTN","PSORXL1",84,0)
 S PSOZXFPL=$P(PSOKSPPL,",",+$G(PI),99)
"RTN","PSORXL1",85,0)
 S PSOZXFPN=$L(PSOZXFPL,PPL)-1
"RTN","PSORXL1",86,0)
 I $G(PSOZXFL(PSORXLDA)),$G(PSOZXFPN) S RXFL(PSORXLDA)=$G(PSOZXFL(PSORXLDA))-$G(PSOZXFPN)
"RTN","PSORXL1",87,0)
 K PSOZXFL,PSOZXFPL,PSOZXFPN
"RTN","PSORXL1",88,0)
 Q
"RTN","PSORXL1",89,0)
TRIC(PSORX) ;
"RTN","PSORXL1",90,0)
 S PSORF=$$LSTRFL^PSOBPSU1(PSORX)
"RTN","PSORXL1",91,0)
 S PSOTRIC="",PSOTRIC=$$TRIC^PSOREJP1(PSORX,PSORF,.PSOTRIC)
"RTN","PSORXL1",92,0)
 Q
"RTN","PSORXL1",93,0)
ECME ; - Looks for DUR/79 REJECTS and send Mail Rx's to ECME that have not been SUSPENDED
"RTN","PSORXL1",94,0)
 N PSOI,PSOJ,PSORX,PSORF,PSOACT,BWH,PPLTMP,PSOSTA,PSOTRIC,ESTAT,EACTION
"RTN","PSORXL1",95,0)
 S PPLTMP=$G(PPL)
"RTN","PSORXL1",96,0)
 F PSOI=1:1 S PSORX=+$P($G(PPLTMP),",",PSOI) Q:'PSORX  D
"RTN","PSORXL1",97,0)
 . D TRIC(PSORX) S ESTAT=$P($$STATUS^PSOBPSUT(PSORX,PSORF),"^")
"RTN","PSORXL1",98,0)
 . I PSOTRIC S EACTION=$S(ESTAT["PAYABLE":1,ESTAT["Inactive ECME Tricare":1,ESTAT="":1,1:0)
"RTN","PSORXL1",99,0)
 . I $G(PSOCKDC) D  Q  ;PSOCKDC variable is set in PSORXL and is used to eliminate label print for DC'ed Rx's
"RTN","PSORXL1",100,0)
 . . S PSOSTA=$$GET1^DIQ(52,PSORX,100,"I") I PSOSTA=12!(PSOSTA=11),'$G(RXPR(PSORX)),$G(PPL) D RMV(PSORX,.PPL)
"RTN","PSORXL1",101,0)
 . I $G(RXPR(PSORX)) Q
"RTN","PSORXL1",102,0)
 . S PSOACT="",BWH=$S(PSORF:"RF",1:"OF")
"RTN","PSORXL1",103,0)
 . I $$FIND^PSOREJUT(PSORX,PSORF) D  I PSOACT="Q" D RMV(PSORX,.PPL) Q
"RTN","PSORXL1",104,0)
 . . S PSOACT=$$HDLG^PSOREJU1(PSORX,PSORF,"79,88",BWH,"OIQ","Q")
"RTN","PSORXL1",105,0)
 Q
"RTN","PSORXL1",106,0)
RMV(RX,PPL) ; Remove the Rx from the label print queue
"RTN","PSORXL1",107,0)
 N XPPL,I
"RTN","PSORXL1",108,0)
 S XPPL=PPL,PPL="" F I=1:1:$L(XPPL,",") I $P(XPPL,",",I)'="",$P(XPPL,",",I)'=RX S PPL=PPL_$P(XPPL,",",I)_","
"RTN","PSORXL1",109,0)
 I PPL="" K PPL
"RTN","PSORXL1",110,0)
 Q
"RTN","PSORXPR")
0^58^B29984044
"RTN","PSORXPR",1,0)
PSORXPR ;BHAM ISC/SAB - view individual prescription ;08/23/96  8:15 am
"RTN","PSORXPR",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**131,156,148,251**;DEC 1997;Build 202
"RTN","PSORXPR",3,0)
 ;Reference to ^PS(55 supported by DBIA 2228
"RTN","PSORXPR",4,0)
 ;Reference ^PSDRUG( supported by DBIA 221
"RTN","PSORXPR",5,0)
 ;Reference to ^SC supported by DBIA 10040
"RTN","PSORXPR",6,0)
 ;Reference to ^PSXVIEW supported by DBIA 2204
"RTN","PSORXPR",7,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5424
"RTN","PSORXPR",8,0)
GET S RX0=^PSRX(DA,0),J=DA,$P(RX0,"^",15)=+$G(^("STA")),RX2=$G(^(2)),R3=$G(^(3)),RTN=$G(^("TN")) S (DFN,P0)=+$P(RX0,"^",2) S:$D(^DPT(P0,0)) P0=^(0) S FFX=0
"RTN","PSORXPR",9,0)
 S PSDIV=$S($D(^PS(59,+$P(RX2,"^",9),0)):$P(^(0),"^")_" ("_$P(^(0),"^",6)_")",1:"UNKNOWN"),PSDIV=$E(PSDIV,1,28),PSEXDT=$P(RX2,"^",6),PSEXDT=$S(PSEXDT]"":$E(PSEXDT,4,5)_"/"_$E(PSEXDT,6,7)_"/"_$E(PSEXDT,2,3),1:"UNKNOWN")
"RTN","PSORXPR",10,0)
PR D STAT^PSOFUNC I 'ST0,$D(^PS(52.4,"AREF",DFN,DA)) S ST="UNPRINTED"
"RTN","PSORXPR",11,0)
 ;S:$G(PSLSTVER)&($P($G(^PSRX(+$G(PSONV),"STA")),"^")=4) ST="PENDING DUE TO DRUG INTERACTION"
"RTN","PSORXPR",12,0)
 D PID^VADPT W @IOF,"RX: ",$P(RX0,"^"),?20,"PATIENT: "_$P(P0,"^")_" (",VA("PID")_") "
"RTN","PSORXPR",13,0)
 I $$DS^PSSDSAPI D DRIDOSE^PSOVER1(DA,RX0)
"RTN","PSORXPR",14,0)
 W !,"STATUS: "_ST_"   "_$S($P($G(^PSRX(DA,"IB")),"^")]"":"CO-PAY STATUS",1:"") I ($D(PS)#2),PS="DISCONTINUE",ST["DISCONTINUE" S PS="REINSTATE"
"RTN","PSORXPR",15,0)
 ;W @IOF,!,"RX: ",$P(RX0,"^"),?20,"PATIENT: ",$P(P0,"^")," (",$P(P0,"^",9),") ",!,"STATUS: ",ST_"   "_$S($P($G(^PSRX(DA,"IB")),"^")]"":"CO-PAY STATUS",1:"") I ($D(PS)#2),PS="DISCONTINUE",ST["DISCONTINUE" S PS="REINSTATE"
"RTN","PSORXPR",16,0)
 I $G(PKI1)!($G(PKI)) N PKIT D  W !,PKIT
"RTN","PSORXPR",17,0)
 .I '$D(IORVON) S X="IORVOFF;IORVON" D ENDR^%ZISS S PKIT=IORVON_PKIE_IORVOFF K IORVOFF,IORVON,X Q
"RTN","PSORXPR",18,0)
 .S PKIT=IORVON_PKIE_IORVOFF
"RTN","PSORXPR",19,0)
 S MED=+$P(RX0,"^",6),M1="" S:$D(^PSDRUG(MED,0)) M1=^(0) W !,$S($P(M1,"^",3)["S":"      ITEM: ",1:"      DRUG: "),$S(RTN'="":RTN,1:$P(M1,"^"))_$S('$D(^("I")):"",^("I")']"":"",1:" - (inactivated)")
"RTN","PSORXPR",20,0)
 W !?6," QTY: ",$P(RX0,"^",7),"     ",$S($P(RX0,"^",8)?1N.N:$P(RX0,"^",8),1:"??")," DAY SUPPLY"
"RTN","PSORXPR",21,0)
 K FSIG,BSIG I $P($G(^PSRX(DA,"SIG")),"^",2) D FSIG^PSOUTLA("R",DA,66) F PSREV=1:1 Q:'$D(FSIG(PSREV))  S BSIG(PSREV)=FSIG(PSREV)
"RTN","PSORXPR",22,0)
 K FSIG,PSREV I '$P($G(^PSRX(DA,"SIG")),"^",2) D EN3^PSOUTLA1(DA,66)
"RTN","PSORXPR",23,0)
 W !?7,"SIG: ",$G(BSIG(1))
"RTN","PSORXPR",24,0)
 I $O(BSIG(1)) F PSREV=1:0 S PSREV=$O(BSIG(PSREV)) Q:'PSREV  W !?12,$G(BSIG(PSREV))
"RTN","PSORXPR",25,0)
 K BSIG,PSREV
"RTN","PSORXPR",26,0)
 S II=J D LAST^PSORFL W !?4,"LATEST: ",RFLL,?37,"# OF REFILLS: ",$P(RX0,"^",9) S PL=0 D:$O(^PSRX(DA,1,0))  W "  REMAINING: ",$P(RX0,"^",9)-PL K IFN
"RTN","PSORXPR",27,0)
 .S IFN=0 F  S IFN=$O(^PSRX(DA,1,IFN)) Q:'IFN  S PL=PL+1
"RTN","PSORXPR",28,0)
DTT S DTT=$P(RX0,"^",13) D DAT W !?4,"ISSUED: ",DAT
"RTN","PSORXPR",29,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=+$P(R3,"^",3) D ^DIC
"RTN","PSORXPR",30,0)
 S PHYS=$S(+Y:$P(Y,"^",2),1:"UNKNOWN") W ?41,"PROVIDER: "_PHYS S DTT=$P(RX2,"^")\1
"RTN","PSORXPR",31,0)
 I $P(R3,"^",3),+Y W !?41,"COSIGNER: "_$P(Y,"^",2)
"RTN","PSORXPR",32,0)
 D DAT W !?4,"LOGGED: ",DAT,?43,"CLINIC: ",$S($D(^SC(+$P(RX0,"^",5),0)):$P(^(0),"^"),1:"NOT ON FILE")
"RTN","PSORXPR",33,0)
 W !?3,"EXPIRES: ",PSEXDT,?41,"DIVISION: ",PSDIV,!?7,"CAP: ",$P("NON-^","^",$S($D(^PS(55,DFN,0)):+$P(^(0),"^",2),1:0)),"SAFETY",?42,"ROUTING: " S X=$F("MWI",$P(RX0,"^",11))-1 W:X $P("MAIL^WINDOW^INPATIENT","^",X)
"RTN","PSORXPR",34,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=+$P(RX0,"^",16) D ^DIC
"RTN","PSORXPR",35,0)
 W !?2,"ENTRY BY: ",$S(+Y:$P(Y,"^",2),1:$P(RX0,"^",16))
"RTN","PSORXPR",36,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=+$P(RX2,"^",10) D ^DIC
"RTN","PSORXPR",37,0)
 W:+Y ?38,"VERIFIED BY: ",$S(+Y:$P(Y,"^",2),1:$P(RX2,"^",10))
"RTN","PSORXPR",38,0)
 G:$D(PSOZVER) REM K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=+$P(RX2,"^",3) D ^DIC
"RTN","PSORXPR",39,0)
 W !!,"FILLED: "_RFL,?20,"PHARMACIST: "_$S(+Y:$P(Y,"^",2),1:""),?52,"LOT #: "_$P(RX2,"^",4)
"RTN","PSORXPR",40,0)
 W !," DISPENSED: "_$S($P(RX2,"^",5):$E($P(RX2,"^",5),4,5)_"/"_$E($P(RX2,"^",5),6,7)_"/"_$E($P(RX2,"^",5),2,3),1:"")
"RTN","PSORXPR",41,0)
 W ?$X+10,$S($P(RX2,"^",15):" RETURNED TO STOCK: "_$E($P(RX2,"^",15),4,5)_"/"_$E($P(RX2,"^",15),6,7)_"/"_$E($P(RX2,"^",15),2,3),1:" RELEASED: "_$S($P(RX2,"^",13):$E($P(RX2,"^",13),4,5)_"/"_$E($P(RX2,"^",13),6,7)_"/"_$E($P(RX2,"^",13),2,3),1:""))
"RTN","PSORXPR",42,0)
REM W:$P($G(^PSRX(DA,3)),"^",7)]"" !?3,"REMARKS: ",$P($G(^PSRX(DA,3)),"^",7) W:$P($G(^PSRX(DA,"D")),"^")]"" !,"DELETION COMMENT: "_$P(^("D"),"^")
"RTN","PSORXPR",43,0)
 D:$G(^PSRX(DA,"H"))]""&($G(ST)="HOLD") HLD^PSORXPR1
"RTN","PSORXPR",44,0)
 W ! D:PL RF^PSORXPR1 G Q:$D(DIRUT)  D PAR^PSORXPR1 G Q:$D(DIRUT)
"RTN","PSORXPR",45,0)
ACT I $O(^PSRX(DA,"A",0)) D CON:$Y>20 G Q:$D(DIRUT) D H1 F N=0:0 S N=$O(^PSRX(DA,"A",N)) Q:'N  S P1=^(N,0),DTT=P1\1 D A1 Q:$D(DIRUT)
"RTN","PSORXPR",46,0)
 G Q:$D(DIRUT) I $O(^PSRX(DA,"L",0)) D:$Y>20 CON Q:$D(DIRUT)  D L1 F L1=0:0 S L1=$O(^PSRX(DA,"L",L1)) Q:'L1  S LBL=^PSRX(DA,"L",L1,0),DTT=$P(^(0),"^") D DAT,LG Q:$D(DIRUT)
"RTN","PSORXPR",47,0)
 N X S X="PSXVIEW" X ^%ZOSF("TEST") K X I $T D ^PSXVIEW
"RTN","PSORXPR",48,0)
 G Q
"RTN","PSORXPR",49,0)
LG I $Y>20 D CON Q:$D(DIRUT)  D L1
"RTN","PSORXPR",50,0)
 W !,L1,?3,DAT,?14,$S($P(LBL,"^",2):"REFILL "_$P(^PSRX(DA,"L",L1,0),"^",2),1:"ORIGINAL")
"RTN","PSORXPR",51,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=$P(^PSRX(DA,"L",L1,0),"^",4) D ^DIC
"RTN","PSORXPR",52,0)
 W ?40,$P(Y,"^",2),!,"COMMENTS: "_$P(^PSRX(DA,"L",L1,0),"^",3) K DIC,X,Y
"RTN","PSORXPR",53,0)
 Q
"RTN","PSORXPR",54,0)
A1 D CON:$Y>20 Q:$D(DIRUT)  D H1:FFX,DAT W !,N,?3,DAT,?14
"RTN","PSORXPR",55,0)
 S X=$P(P1,"^",2),X=$F("HUCELPRWSIVDABXGKNM",X)-1
"RTN","PSORXPR",56,0)
 W:X $P("HOLD^UNHOLD^DISCONTINUED ^EDIT^RENEWED^PARTIAL^REINSTATE^REPRINT^SUSPENSE^RETURNED^INTERVENTION^DELETED^DRUG INTERACTION^PROCESSED^X-INTERFACE^PATIENT INST.^PKI/DEA^DISPENSE COMPLETED^ECME^","^",X)
"RTN","PSORXPR",57,0)
 W ?25 S X=+$P(P1,"^",4) W $S(X>0&(X<6):"REFILL "_X,X=6:"PARTIAL",X>6:"REFILL "_(X-1),1:"ORIGINAL")
"RTN","PSORXPR",58,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=+$P(P1,"^",3) D ^DIC
"RTN","PSORXPR",59,0)
 W ?40,$S(+Y:$P(Y,"^",2),1:$P(P1,"^",3)) K DIC,X,Y
"RTN","PSORXPR",60,0)
 W:$P(P1,"^",5)]"" !,"COMMENTS: ",$P(P1,"^",5) Q
"RTN","PSORXPR",61,0)
Q K ST0,RFL,RFLL,RFL1,ST,II,J,N,PHYS,L1,DIRUT,PSDIV,PSEXDT,MED,M1,FFX,DTT,DAT,RX0,RX2,R3,RTN,SIG,STA,P1,PL,P0,Z0,Z1,EXDT,IFN,DIR,DUOUT,DTOUT
"RTN","PSORXPR",62,0)
 K LBL,I,RFDATE,%H,%I K:$G(PS)="VIEW" DFN Q
"RTN","PSORXPR",63,0)
H1 I FFX W @IOF
"RTN","PSORXPR",64,0)
 W !!,"ACTIVITY LOG:",!,"#",?3,"DATE",?14,"REASON",?25,"RX REF",?40,"INITIATOR OF ACTIVITY",! F I=1:1:79 W "="
"RTN","PSORXPR",65,0)
 S FFX=0 W ! Q
"RTN","PSORXPR",66,0)
L1 I FFX W @IOF
"RTN","PSORXPR",67,0)
 W !!,"LABEL LOG:",!,"#",?3,"DATE",?14,"RX REF",?40,"PRINTED BY",! F I=1:1:79 W "="
"RTN","PSORXPR",68,0)
 S FFX=0 W ! Q
"RTN","PSORXPR",69,0)
CON Q:$D(PSOAC)  K DTOUT,DIRUT,DUOUT,DIR S DIR(0)="E" D ^DIR S FFX=1 Q
"RTN","PSORXPR",70,0)
 Q
"RTN","PSORXPR",71,0)
DAT S DAT="",DTT=DTT\1 Q:DTT'?7N  S DAT=$E(DTT,4,5)_"/"_$E(DTT,6,7)_"/"_$E(DTT,2,3)
"RTN","PSORXPR",72,0)
 Q
"RTN","PSORXPR",73,0)
EN ; Entry Point for PSORXED
"RTN","PSORXPR",74,0)
 D PSORXPR K PHYS,RFDATE,RFL,RFL1,ST,ST0,RFLL
"RTN","PSORXPR",75,0)
 Q
"RTN","PSORXRP2")
0^57^B33732214
"RTN","PSORXRP2",1,0)
PSORXRP2 ;BIR/SAB-main menu entry reprint of a Rx label ;10/5/07 7:45am
"RTN","PSORXRP2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,27,120,138,135,156,185,280,251**;DEC 1997;Build 202
"RTN","PSORXRP2",3,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSORXRP2",4,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSORXRP2",5,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSORXRP2",6,0)
 I '$D(PSOPAR) D ^PSOLSET I '$D(PSOPAR) G KILL
"RTN","PSORXRP2",7,0)
LRP N PSODISP
"RTN","PSORXRP2",8,0)
 K REPRINT W !! S DIC("S")="I $P($G(^(0)),""^"",2),$D(^(""STA"")),$P($G(^(""STA"")),""^"")<10",DIC="^PSRX(",DIC("A")="Reprint Prescription Label: ",DIC(0)="QEAZ" D ^DIC K P,DIC("A") I Y<0!("^"[X) K PCOM,PCOMX G KILL
"RTN","PSORXRP2",9,0)
 S (PPL,DA,RX,PSORPRX)=+Y,PDA=Y(0),RXF=0,ZD(DA)=DT,REPRINT=1,STA=+$G(^PSRX(+Y,"STA"))
"RTN","PSORXRP2",10,0)
 D PSOL^PSSLOCK(PSORPRX) I '$G(PSOMSG) W !!,$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order."),! K PSOMSG G LRP
"RTN","PSORXRP2",11,0)
 I $P(^PSRX(RX,"STA"),"^")=14 W $C(7),!,"Cannot Reprint! Discontinued by Provider." D ULR,KILL Q
"RTN","PSORXRP2",12,0)
 I $P(^PSRX(RX,"STA"),"^")=15 W $C(7),!,"Cannot Reprint! Discontinued due to editing." D ULR,KILL Q
"RTN","PSORXRP2",13,0)
 I $P(^PSRX(RX,"STA"),"^")=16 W $C(7),!,"Cannot Reprint! Placed on HOLD by Provider." D ULR,KILL Q
"RTN","PSORXRP2",14,0)
 I DT>$P(^PSRX(RX,2),"^",6) D  D ULR,KILL G LRP
"RTN","PSORXRP2",15,0)
 .W !,$C(7),"Medication Expired on "_$E($P(^PSRX(RX,2),"^",6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3) I $P(^PSRX(DA,"STA"),"^")<11 S $P(^PSRX(DA,"STA"),"^")=11 D
"RTN","PSORXRP2",16,0)
 ..S COMM="Medication Expired on "_$E($P(^PSRX(RX,2),"^",6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3) D EN^PSOHLSN1(DA,"SC","ZE",COMM) K COMM
"RTN","PSORXRP2",17,0)
 S DFN=$P(PDA,"^",2) D DEM^VADPT I $P(VADM(6),"^",2)]"" D  G LRP
"RTN","PSORXRP2",18,0)
 .W $C(7),!!,$P(^DPT($P(PDA,"^",2),0),"^")_" Died "_$P(VADM(6),"^",2)_".",!
"RTN","PSORXRP2",19,0)
 .S $P(^PSRX(RX,"STA"),"^")=12,PCOM="Patient Expired "_$P(VADM(6),"^",2),ST="C" D EN^PSOHLSN1(RX,"OD","",PCOM,"A")
"RTN","PSORXRP2",20,0)
 .D ACT1,ULR,KILL
"RTN","PSORXRP2",21,0)
 S X=$O(^PS(52.5,"B",DA,0)) I X,'$G(^PS(52.5,X,"P")) W !,$C(7),"Rx may NOT be printed using this option, use SUSPENSE FUNCTIONS Options." K X D ULR,KILL G LRP
"RTN","PSORXRP2",22,0)
 I $G(X)'>0 G GOOD
"RTN","PSORXRP2",23,0)
 S XX=$P($G(^PS(52.5,X,0)),U,7) I $G(XX)']"" G GOOD
"RTN","PSORXRP2",24,0)
 I $G(XX)="Q" W !,"RX CAN NOT BE PRINTED using this option, use SUSPENSE FUNCTIONS Options." K X,XX D ULR,KILL G LRP
"RTN","PSORXRP2",25,0)
 I $G(XX)="L" W !,"RX is being transmitted to the CMOP and can not be reprinted now." K X,XX D ULR,KILL G LRP
"RTN","PSORXRP2",26,0)
GOOD K X
"RTN","PSORXRP2",27,0)
 I $D(^PS(52.4,DA)) W !,"Prescription is Non-Verified",!! D ULR,KILL G LRP
"RTN","PSORXRP2",28,0)
 S DFN=$P(^PSRX(DA,0),"^",2) I $D(^PS(52.4,"AREF",DFN,DA)) W !,"Prescription is waiting for others to be verified",!! D ULR,KILL G LRP
"RTN","PSORXRP2",29,0)
 I $G(PSODIV),$D(^PSRX(DA,2)),+$P(^(2),"^",9),+$P(^(2),"^",9)'=PSOSITE S PSPOP=0,PSPRXN=DA D CHK1^PSOUTLA I PSPOP D ULR,KILL G LRP
"RTN","PSORXRP2",30,0)
 I STA=3 W !?3,"Prescription is on Hold" D ULR,KILL G LRP
"RTN","PSORXRP2",31,0)
 I STA=4 W !?3,"Prescription is Pending Due to Drug Interactions" D ULR,KILL G LRP
"RTN","PSORXRP2",32,0)
 I STA=12 W !?3,"Prescription is Discontinued" D ULR,KILL G LRP
"RTN","PSORXRP2",33,0)
 I $G(^PS(55,"ASTALK",DFN)) W !,"Patient is a ScripTalk patient. Use ScripTalk label for prescription bottle.",!
"RTN","PSORXRP2",34,0)
 D ICN^PSODPT(DFN)
"RTN","PSORXRP2",35,0)
 S COPIES=$S($P(PDA,"^",18)]"":$P(PDA,"^",18),1:1)
"RTN","PSORXRP2",36,0)
 K DIR S DIR("A")="Number of Copies? ",DIR("B")=COPIES,DIR(0)="N^1:99:0",DIR("?")="Enter the number of copies you want (1 TO 99)"
"RTN","PSORXRP2",37,0)
 D ^DIR K DIR I $D(DIRUT) D ULR,KILL G LRP
"RTN","PSORXRP2",38,0)
 S COPIES=Y
"RTN","PSORXRP2",39,0)
 K DIR S DIR("A")="Print adhesive portion of label only? ",DIR(0)="Y",DIR("B")="No",DIR("?",1)="If entire label, including trailers are to print press RETURN for default."
"RTN","PSORXRP2",40,0)
 S DIR("?")="Else if only bottle and mailing labels are to print enter Y or YES." D ^DIR K DIR I $D(DUOUT) D ULR,KILL G LRP
"RTN","PSORXRP2",41,0)
 I $D(DIRUT) D ULR G KILL
"RTN","PSORXRP2",42,0)
 S SIDE=Y
"RTN","PSORXRP2",43,0)
 I $P(PSOPAR,"^",30),$$GET1^DIQ(59,PSOSITE_",",105,"I")=2.4 D
"RTN","PSORXRP2",44,0)
 .I $S($P(PSOPAR,"^",30)=3:1,$P(PSOPAR,"^",30)=4:1,1:0),'$$GET1^DIQ(50,$P(PDA,"^",6),28,"I") Q
"RTN","PSORXRP2",45,0)
 .K DIR,DIRUT S DIR("A")="Do you want to resend to Dispensing System Device",DIR(0)="Y",DIR("B")="No" D ^DIR K DIR Q:$D(DIRUT)  S PSODISP=$S(Y:0,1:1)
"RTN","PSORXRP2",46,0)
 I $D(DIRUT) D ULR,KILL G LRP
"RTN","PSORXRP2",47,0)
 D ACT I $D(DIRUT) D ULR,KILL G LRP
"RTN","PSORXRP2",48,0)
 I $D(PCOM) D ULR,KILL G LRP
"RTN","PSORXRP2",49,0)
 F I=1,2,4,6,7,9,13,16 S P(I)=$P(PDA,"^",I)
"RTN","PSORXRP2",50,0)
 S P(6)=+P(6) I $D(^PSRX(DA,"TN")),^("TN")]"" S P(6)=^("TN")
"RTN","PSORXRP2",51,0)
 W !!,"Rx # "_P(1),?23,$E(P(13),4,5)_"/"_$E(P(13),6,7)_"/"_$E(P(13),2,3),!,$S($D(^DPT(+P(2),0)):$P(^(0),"^"),1:"Not on File"),?30,"#"_P(7),!
"RTN","PSORXRP2",52,0)
 I $P($G(^PSRX(DA,"SIG")),"^",2) S D=0 D  K D,FSIG
"RTN","PSORXRP2",53,0)
 .D FSIG^PSOUTLA("R",DA,75) F  S D=$O(FSIG(D)) W !,FSIG(D) Q:'$O(FSIG(D))
"RTN","PSORXRP2",54,0)
 E  D EN3^PSOUTLA1(DA,75) S D=0 F  S D=$O(BSIG(D)) W !,BSIG(D) Q:'$O(BSIG(D))
"RTN","PSORXRP2",55,0)
 K D,BSIG
"RTN","PSORXRP2",56,0)
 ;PSO*7*280 If Trade name, don't lookup in ^PSDRUG
"RTN","PSORXRP2",57,0)
 W !!,$S($G(^PSRX(DA,"TN"))]"":P(6),(P(6)=+P(6))&$D(^PSDRUG(P(6),0)):$P(^(0),"^"),1:P(6)),! S PHYS=$S($D(^VA(200,+P(4),0)):$P(^(0),"^"),1:"Unknown") W PHYS K PHYS
"RTN","PSORXRP2",58,0)
 W ?25,$S($D(^VA(200,+P(16),0)):$P(^(0),"^"),1:"Unknown"),!,"# of Refills: "_$G(P(9))
"RTN","PSORXRP2",59,0)
 I $G(RX) D
"RTN","PSORXRP2",60,0)
 .S RXRP(RX)=1_"^"_COPIES_"^"_SIDE
"RTN","PSORXRP2",61,0)
 .I $G(PSODISP)=1 S RXRP(RX,"RP")=1
"RTN","PSORXRP2",62,0)
 .S RXFL(RX)=0 F ZZZ=0:0 S ZZZ=$O(^PSRX(RX,1,ZZZ)) Q:'ZZZ  S RXFL(RX)=ZZZ
"RTN","PSORXRP2",63,0)
 D @$S($P($G(PSOPAR),"^",26):"^PSORXL",1:"Q^PSORXL") K PSPOP,PPL,COPIES,SIDE,REPRINT,PCOM,IOP,PSL,PSNP,ZZZ,RXFL(+$G(RX)) D ULR,KILL G LRP
"RTN","PSORXRP2",64,0)
 ;
"RTN","PSORXRP2",65,0)
ACT K DIR S DIR("A")="Comments: ",DIR(0)="FA^5:60",DIR("?")="5-60 characters input required for activity log." S:$G(PCOMX)]"" DIR("B")=$G(PCOMX)
"RTN","PSORXRP2",66,0)
 D ^DIR K DIR Q:$D(DIRUT)!($D(DIROUT))  S (PCOM,PCOMX)=X
"RTN","PSORXRP2",67,0)
 I '$D(PSOCLC) S PSOCLC=DUZ
"RTN","PSORXRP2",68,0)
ACT1 S RXF=0 F J=0:0 S J=$O(^PSRX(DA,1,J)) Q:'J  S RXF=J S:J>5 RXF=J+1
"RTN","PSORXRP2",69,0)
 S IR=0 F J=0:0 S J=$O(^PSRX(DA,"A",J)) Q:'J  S IR=J
"RTN","PSORXRP2",70,0)
 S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSORXRP2",71,0)
 D NOW^%DTC S ^PSRX(DA,"A",IR,0)=%_"^"_$S($G(ST)'="C":"W",1:"C")_"^"_DUZ_"^"_RXF_"^"_PCOM_$S($G(ST)'="C":" ("_COPIES_" COPIES)",1:""),PCOMX=PCOM K PC,IR,PS,PCOM,XX,%,%H,%I,RXF
"RTN","PSORXRP2",72,0)
 S:$P(^PSRX(DA,2),"^",15)&($G(ST)'="C") $P(^PSRX(DA,2),"^",14)=1
"RTN","PSORXRP2",73,0)
 Q
"RTN","PSORXRP2",74,0)
 ;
"RTN","PSORXRP2",75,0)
KILL K %,DIR,DUOUT,DTOUT,DIROUT,DIRUT,C,DA,DIC,I,J,JJJ,K,RX,RXF,X,Y,Z,ZD,DFN,P,PDA,PSPRXN,COPIES,SIDE,PPL,REPRINT,PSXSTAT,PSORPRX,PSOMSG D KVA^VADPT Q
"RTN","PSORXRP2",76,0)
 ;
"RTN","PSORXRP2",77,0)
ULR ;
"RTN","PSORXRP2",78,0)
 I $G(PSORPRX) D PSOUL^PSSLOCK(PSORPRX)
"RTN","PSORXRP2",79,0)
 Q
"RTN","PSOVER")
0^46^B81926399
"RTN","PSOVER",1,0)
PSOVER ;BIR/SAB-verify rx's by clerk ;07/03/95
"RTN","PSOVER",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**16,21,27,117,131,146,251**;DEC 1997;Build 202
"RTN","PSOVER",3,0)
 ;External references L, UL, PSOL, and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOVER",4,0)
 ;External reference to ^PS(56 supported by DBIA 2229
"RTN","PSOVER",5,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5424
"RTN","PSOVER",6,0)
 D:'$D(PSOPAR) ^PSOLSET I '$D(PSOPAR) W $C(7),!!,"Pharmacy Division Must be Selected!",! Q
"RTN","PSOVER",7,0)
 Q:'$D(^XUSEC("PSORPH",DUZ))  S PSOZVER=1
"RTN","PSOVER",8,0)
PAT K PSOTT,PSOACT,PSOVER,PSOQUIT,PSORX("DFLG"),DTOUT,DIRUT,PSOVQUIT W !! S DIC("A")="Enter PATIENT NAME (or ^C to verify for a clerk): ",DIC="^DPT(",DIC("S")="I $D(^PS(52.4,""C"",+Y))",DIC(0)="QEAMZ" D ^DIC K DIC G CLERK:$E(X,1,2)="^C",END:Y'>0
"RTN","PSOVER",9,0)
 S PSONV=0,(DFN,PSDFN,PSODFN)=+Y,PPL="",PSONAM=$P(^DPT(PSDFN,0),"^") D ^PSOBUILD
"RTN","PSOVER",10,0)
L1 D PID^VADPT S PSONV=$O(^PS(52.4,"C",PSDFN,PSONV)) I 'PSONV D:$$GET1^DIQ(52,PSONV,100,"I")'=13 PACK G PAT
"RTN","PSOVER",11,0)
 F DGDG=0:0 S DGDG=$O(^PS(52.4,"C",PSDFN,DGDG)) S PSONV=DGDG K PSOSIG,PSOTHER Q:'DGDG!($G(PSOQUIT))  D  Q:$G(DIRUT)
"RTN","PSOVER",12,0)
 .I $D(^PS(52.4,"ADI",DGDG,1)) S PSONV=DGDG D DGDGI Q
"RTN","PSOVER",13,0)
 .I $D(^PSRX(PSONV,"DRI")) S PSOSIG=1 D DGDGI Q
"RTN","PSOVER",14,0)
 .D:'$D(^PS(52.4,"ADI",PSONV,1))&('$D(^PSRX(PSONV,"DRI"))) DSPL Q
"RTN","PSOVER",15,0)
 G QUIT:$D(PSOSD)
"RTN","PSOVER",16,0)
 ;
"RTN","PSOVER",17,0)
SHOW I '$D(PSOSD) W !,$C(7),"This patient has no prescriptions on file",!! Q
"RTN","PSOVER",18,0)
 I $$DS^PSSDSAPI W !,$P(^DPT(DFN,0),"^"),?40,"ID#:"_VA("PID") W:$D(INT)!$D(PSONV) "  RX#: "_$S($D(INT):$P(INT,"^"),$D(^PSRX(PSONV)):$P(^PSRX(PSONV,0),"^"),1:"")
"RTN","PSOVER",19,0)
 D ^PSODSPL
"RTN","PSOVER",20,0)
SHOW2 ;
"RTN","PSOVER",21,0)
 I ($Y+5)>IOSL D HD^PSODDPR2() Q
"RTN","PSOVER",22,0)
 Q:$Y<5
"RTN","PSOVER",23,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","PSOVER",24,0)
 K DIR W ! S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOVER",25,0)
 W @IOF
"RTN","PSOVER",26,0)
 Q
"RTN","PSOVER",27,0)
 ;
"RTN","PSOVER",28,0)
CLERK D:'$D(PSOPAR) ^PSOLSET I '$D(PSOPAR) W $C(7),!!,"Pharmacy Division Must be Selected!",! G END
"RTN","PSOVER",29,0)
 K PSOVERPL,PSOVERPX,PSOVERPH,PSOVERLX,PSOVERQ,PSORX("DFLG"),DIRUT,DTOUT,PSOVQUIT
"RTN","PSOVER",30,0)
 K PSOQUIT,PSOCQ,PSOVORD,PSOINTV S PSOCLK=1 W ! S DIC="^VA(200,",DIC(0)="AEQM",DIC("S")="I $D(^PS(52.4,""D"",+Y))",DIC("A")="Enter Clerk Name: "
"RTN","PSOVER",31,0)
 D ^DIC K DIC K:Y'>0!($D(DTOUT)) PSORX G END:Y'>0!($D(DTOUT))
"RTN","PSOVER",32,0)
 S PSOTT=+Y,(PSONV,PSDFN0)=0,PPL="" K PSOVER,PSONAM
"RTN","PSOVER",33,0)
CL1 F DGDG=0:0 S DGDG=$O(^PS(52.4,"D",PSOTT,DGDG)) Q:'DGDG!($G(PSOQUIT))!($G(PSOCQ))  D  Q:$D(DIRUT)
"RTN","PSOVER",34,0)
 .S PSOVQUIT=0,(DFN,PSOVERPX,PSDFN,PSODFN)=$P(^PS(52.4,DGDG,0),"^",2),PSONV=DGDG D PATCHK K PSOSIG,PSOTHER
"RTN","PSOVER",35,0)
 .S CLFLAG=1 D STAT^PSODGDG2 K CLFLAG D:'$G(FLAGST)  Q:$D(DIRUT)
"RTN","PSOVER",36,0)
 ..S PSONVXX=PSONV I $G(PSOVERPH)=$G(PSOVERPX),$G(PSOVERLX) Q
"RTN","PSOVER",37,0)
 ..I $G(PSOVERPH)'=$G(PSOVERPX) K PSOVERLX D:$G(PSOVERPH)&('$G(PSOVERPL)) ULP S PSOVERPH=PSOVERPX D LPAT I $G(PSOVERPL) Q
"RTN","PSOVER",38,0)
 ..S PSDFN0=PSDFN D LRX I '$G(PSOMSG) Q
"RTN","PSOVER",39,0)
 ..K PSOMSG I $D(^PS(52.4,"ADI",DGDG,1)) S PSONV=DGDG D DSPL D PSOUL^PSSLOCK(PSONVXX) Q
"RTN","PSOVER",40,0)
 ..I $D(^PSRX(PSONV,"DRI")) S PSOSIG=1 D DSPL D PSOUL^PSSLOCK(PSONVXX) Q
"RTN","PSOVER",41,0)
 ..D:'$D(^PS(52.4,"ADI",PSONV,1))&('$D(^PSRX(PSONV,"DRI"))) DSPL D PSOUL^PSSLOCK(PSONVXX) Q
"RTN","PSOVER",42,0)
 D:$G(PSOVERPH)&('$G(PSOVERPL)) ULP
"RTN","PSOVER",43,0)
CL2 D:$$GET1^DIQ(52,PSONV,100,"I")'=13 PACK G CLERK
"RTN","PSOVER",44,0)
PATCHK I $D(PSOVER),PSDFN0,PSDFN0'=DFN S (DFN,PSDFN)=PSDFN0 D PACK S (DFN,PSDFN)=PSODFN D ^PSOBUILD,PID^VADPT S PSONAM=$P(^DPT(DFN,0),"^") Q
"RTN","PSOVER",45,0)
 I PSDFN0'=DFN D ^PSOBUILD,PID^VADPT S PSONAM=$P(^DPT(DFN,0),"^")
"RTN","PSOVER",46,0)
 Q
"RTN","PSOVER",47,0)
PACK Q:$$GET1^DIQ(52,PSONV,100,"I")=13  S PPL="" F J=0:0 S J=$O(PSOVER(J)) Q:'J  S PPL=PPL_J_","
"RTN","PSOVER",48,0)
 I PPL]"" S PSOOPT=3,PSOTRVV=1 D ^PSORXL K PSOOPT,PSOTRVV
"RTN","PSOVER",49,0)
 K PSD,PSOVER S PPL="" Q
"RTN","PSOVER",50,0)
QUIT D PACK
"RTN","PSOVER",51,0)
END K CAN,CLS,DA,DEA1,DEA2,DIC,DIE,DR,DRG,DRGG,DUP,DUPRX,DUPRX0,FLDT,I,ISDT,ISSD,J,LSTFL,PHYS,PPL,PSC,PSD,PSDFN,PSDFN0,PSDNEW,PSDOLD,PSMSG,PSOQUIT,PSOTT,PSOVER,PSREA,PSRFLS,PSRX,PSRX1,PSRX2,PSRXREF,PSVERFLG,RFLS,RX0,RX2,RX3,ST,ST0,STAR,X
"RTN","PSOVER",52,0)
 K D0,DQ,N,PHY,RFL,PSI,PSOTHER,PSS,PSOZVER,PI,PTST,SD,PSONAM,PSONULN,RFDATE,RFL1,RXF,Z,DRUG,II,RFLL,DRGX,DIPGM,PSOCNT,A1,C,ST00,FLAGST,STEXT,PSOCLK,PSOCQ,PSOVERPL,PSOVERPX,PSOVERPH,PSOVERLX,VERLFLAG,PSONVXX D KVA^VADPT
"RTN","PSOVER",53,0)
 K PSONOOR,PSOSIG,DIR,DUOUT,DTOUT,DIRUT,DIROUT,INA,MED,SER1,PSOVORD,PSOINTV,PSOVQUIT,PSVFLAG ;K:'$G(POERR) PSOSD
"RTN","PSOVER",54,0)
 Q
"RTN","PSOVER",55,0)
DSPL ;
"RTN","PSOVER",56,0)
 Q:$P(^PSRX(PSONV,"STA"),"^")=13
"RTN","PSOVER",57,0)
 S DA=PSONV I $P($G(^PSRX(DA,"PKI")),"^") N PKI,PKI1,PKIR,PKIE D CER^PSOPKIV1
"RTN","PSOVER",58,0)
 ;I $G(PSOCLK)=1 D  I $D(DIRUT) S PSOQUIT=1 Q
"RTN","PSOVER",59,0)
 ;.D ^PSORXPR
"RTN","PSOVER",60,0)
 ;.W !,"PATIENT STATUS : ",$P(^PS(53,$P(^PSRX(DA,0),"^",3),0),"^")
"RTN","PSOVER",61,0)
 ;.W:+$P(^PSRX(DA,0),"^",18)'=0 ?42,"COPIES : ",$P(^(0),"^",18)
"RTN","PSOVER",62,0)
 ;.W:$D(^PSRX(DA,"MP")) !,"METHOD OF PICKUP : ",^("MP"),!
"RTN","PSOVER",63,0)
 ;.W !
"RTN","PSOVER",64,0)
 S PSVFLAG=1 D ^PSOVER1 I $G(PSORX("DFLG")) K PSVFLAG
"RTN","PSOVER",65,0)
 Q
"RTN","PSOVER",66,0)
DGDGI ;process drug interaction for non verified rxs
"RTN","PSOVER",67,0)
 K DIRUT,DTOUT,PSORX("DFLG")
"RTN","PSOVER",68,0)
 S SER1=$S('$G(PSOSIG):$P(^PS(52.4,PSONV,0),"^",9),1:$P(^PSRX(PSONV,"DRI"),"^"))
"RTN","PSOVER",69,0)
 S MED=$S('$G(PSOSIG):$P(^PS(52.4,PSONV,0),"^",10),1:$P(^PSRX(PSONV,"DRI"),"^",2))
"RTN","PSOVER",70,0)
 K LOCKARRY,PSOVMSGX S VERLFLAG=0 I $G(MED) F LOCKINA=1:1 S PSOLKVRX=$P(MED,",",LOCKINA) Q:$G(PSOLKVRX)=""!($G(VERLFLAG))  D LK1
"RTN","PSOVER",71,0)
 I $G(MED) I $G(VERLFLAG) D:$D(LOCKARRY) ULK1 W !!,"Cannot process this prescription, one of the interacting medications is",!,"being edited.",! D  G DONEX
"RTN","PSOVER",72,0)
 .I $G(PSOVMSGX)'="" W PSOVMSGX,!
"RTN","PSOVER",73,0)
 .K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to continue"
"RTN","PSOVER",74,0)
 .D ^DIR K DIR,PSOVMSGX
"RTN","PSOVER",75,0)
 K PSOVMSGX
"RTN","PSOVER",76,0)
 S PSVERFLG=0,IFN=PSONV,INT=^PSRX(IFN,0)
"RTN","PSOVER",77,0)
 F INA=1:1 S PSODFN=DFN Q:$P(SER1,",",INA)=""!($G(MED)="")  D  Q:$G(PSOVQUIT)!$G(PSORX("DFLG"))
"RTN","PSOVER",78,0)
 .I $P(SER1,",",INA) S SER=^PS(56,$P(SER1,",",INA),0)
"RTN","PSOVER",79,0)
 .E  S $P(SER,"^",4)=$S($P(SER1,",",INA)="Critical":1,1:2)
"RTN","PSOVER",80,0)
 .S RX=^PSRX(PSONV,0),STA=+$G(^("STA")),$P(RX,"^",15)=STA,PSOOPT=1
"RTN","PSOVER",81,0)
 .I $$DS^PSSDSAPI W !!!,$P(^DPT(DFN,0),"^"),?39,"ID#: ",$E($P(^(0),"^",9),1,3)_"-"_$E($P(^(0),"^",9),4,5)_"-"_$E($P(^(0),"^",9),6,9),?57,"RX: ",$P(^PSRX(PSONV,0),"^")
"RTN","PSOVER",82,0)
 .I STA'=13 D FULL^VALM1 D ^PSOVER1  ;PROCESS^PSODGDG1
"RTN","PSOVER",83,0)
 Q:$G(PSORX("DFLG"))  Q:$G(DIRUT)!($G(DTOUT))
"RTN","PSOVER",84,0)
 I '$G(PSVERFLG),$P(^PSRX(PSONV,"STA"),"^")=4!($P(^("STA"),"^")=1) S $P(^PSRX(PSONV,"STA"),"^")=1 D DSPL G DONE
"RTN","PSOVER",85,0)
 I '$D(^PS(52.4,"ADI",PSONV,1)),$P(^PSRX(PSONV,"STA"),"^")=1 D DSPL G DONEX:$G(DIRUT)!($G(DTOUT)) G DONE
"RTN","PSOVER",86,0)
DONE K PSOVORD I $P(^PSRX(PSONV,"STA"),"^")'=1,$P(^("STA"),"^")'=4 K ^PSRX(PSONV,"DRI")
"RTN","PSOVER",87,0)
 S PSOTHER="" F  S PSOTHER=$O(PSOTHER(PSOTHER)) Q:PSOTHER=""  D
"RTN","PSOVER",88,0)
 .I $G(PSOTHER),$P($G(^PSRX(PSOTHER,"STA")),"^")=1,$P($G(^PS(52.4,PSOTHER,0)),"^",10)="" S PSONV=PSOTHER D DSPL
"RTN","PSOVER",89,0)
 D:$D(LOCKARRY) ULK1
"RTN","PSOVER",90,0)
DONEX K PSOOPT,SER,LOCKARRY,LOCKINA,PSOLKVRX,DTOUT,DIRUT,PSORX("DFLG")
"RTN","PSOVER",91,0)
 Q
"RTN","PSOVER",92,0)
OERR ;
"RTN","PSOVER",93,0)
 N PSOEDITF,PSOVEDIT,PSOOORN,XQORNOD,Y S PSOVEDIT=0
"RTN","PSOVER",94,0)
 K PSONOOR,PSOVER,PSVERFLG,PSOVORD,PSOSIG I $G(PSONACT) W $C(7),$C(7) S VALMSG="No Pharmacy Orderable Item!",VALMBCK="" Q
"RTN","PSOVER",95,0)
 I $G(PSOTPBFG) N PSOTPPEN,PSOTPPEX,PSOTPPE9 S PSOTPPEN=$P(PSOLST($P(PSLST,",",ORD)),"^",2),PSOTPPEX=0,PSOTPPE9=1 D VOPN^PSOTPCAN I PSOTPPEX S VALMBCK="" K PSOTPPEN,PSOTPPEX,PSOTPPE9 Q
"RTN","PSOVER",96,0)
 K PSOTPPEN,PSOTPPEX,PSOTPPE9,PSORX("DFLG")
"RTN","PSOVER",97,0)
 I $G(PSOBEDT) W $C(7),$C(7) S VALMSG="Invalid Action at this time !",VALMBCK="" Q
"RTN","PSOVER",98,0)
 I '$D(^XUSEC("PSORPH",DUZ)) S VALMSG="Unauthorized Action!",VALMBCK="" Q
"RTN","PSOVER",99,0)
 S PSOVRXN=$P(PSOLST($P(PSLST,",",ORD)),"^",2),PSOVDFN=$P($G(^PSRX(PSOVRXN,0)),"^",2)
"RTN","PSOVER",100,0)
 S PSOPLCK=$$L^PSSLOCK(PSOVDFN,0) I '$G(PSOPLCK) S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is editing orders for this patient.") S VALMBCK="" K PSOPLCK Q
"RTN","PSOVER",101,0)
 K PSOPLCK D PSOL^PSSLOCK(PSOVRXN) I '$G(PSOMSG) D UL^PSSLOCK(PSOVDFN) S VALMSG=$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order.") K PSOMSG S VALMBCK="" Q
"RTN","PSOVER",102,0)
 N PSODFN S (PSOZVER,PSLSTVER)=1
"RTN","PSOVER",103,0)
 D FULL^VALM1 S (PSONV,X,DA)=$P(PSOLST($P(PSLST,",",ORD)),"^",2) K DIC S DIC(0)="NZ",DIC=52.4 D ^DIC K DIC I Y<1 D  D:'$G(PSLSTVER) ULB Q:'$G(PSLSTVER)
"RTN","PSOVER",104,0)
 .I $P($G(^PSRX(+PSONV,"STA")),"^")'=1,$P($G(^("STA")),"^")'=4 K PSONV,DA,X,Y,PSOZVER,PSLSTVER S VALMSG="Invalid Action Selection!",VALMBCK="" Q
"RTN","PSOVER",105,0)
 .S PSLSTVER=2
"RTN","PSOVER",106,0)
 .S DIC="^PS(52.4,",DLAYGO=52.4,(DINUM,X)=PSONV,DIC(0)="L" K DD,DO D FILE^DICN K DD,DO,DIC,DINUM,DLAYGO
"RTN","PSOVER",107,0)
 .S ^PS(52.4,PSONV,0)=PSONV_"^"_$P(^PSRX(PSONV,0),"^",2)_"^"_+$P(^(0),"^",16)_"^^"_$E($P($G(^(2)),"^"),1,7)_"^"_PSONV_"^"_$E($P($G(^(2)),"^",6),1,7)
"RTN","PSOVER",108,0)
 .S DIK="^PS(52.4,",DA=PSONV D IX^DIK K DIK S Y(0)=^PS(52.4,PSONV,0),(X,DA)=PSONV
"RTN","PSOVER",109,0)
 D STAT^PSODGDG2 G:FLAGST EOJ
"RTN","PSOVER",110,0)
 N LST S (DFN,PSDFN,PSODFN)=$P(^PSRX(PSONV,0),"^",2),PPL="",PSONAM=$P(^DPT(PSDFN,0),"^")
"RTN","PSOVER",111,0)
 D PID^VADPT S PSOVORD=PSONV
"RTN","PSOVER",112,0)
 I $D(^PS(52.4,"ADI",PSONV,1)) D DGDGI G:$G(PSOVQUIT)!$G(PSORX("DFLG")) EOJ G PPL
"RTN","PSOVER",113,0)
 I $D(^PSRX(PSONV,"DRI")) S PSOSIG=1 D DGDGI G:$G(PSOVQUIT)!$G(PSORX("DFLG")) EOJ G PPL
"RTN","PSOVER",114,0)
 G:$G(PSORX("DFLG")) EOJ D DSPL
"RTN","PSOVER",115,0)
PPL I $G(PSLSTVER)=2,$D(^PS(52.4,PSONV,0)) S DA=PSONV,DIK="^PS(52.4," D ^DIK K DIK,DA
"RTN","PSOVER",116,0)
 G EOJ:'$O(PSOVER(0))
"RTN","PSOVER",117,0)
 S PSONVLP="" F  S PSONVLP=$O(PSOVER(PSONVLP)) Q:PSONVLP=""  D
"RTN","PSOVER",118,0)
 .D MARKV^PSOTPCAN
"RTN","PSOVER",119,0)
 .I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=PSONVLP_"," Q
"RTN","PSOVER",120,0)
 .F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSOVER",121,0)
 .I $L(PSORX("PSOL",PSOX2))+$L(PSONVLP)<220 S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_PSONVLP_","
"RTN","PSOVER",122,0)
 .E  S PSORX("PSOL",PSOX2+1)=PSONVLP_","
"RTN","PSOVER",123,0)
EOJ D ULB,END
"RTN","PSOVER",124,0)
 K D,DGDG,MW,PSONVLP,P,PCOMX,PDA,PSPRXN,RX,PSD,PSOSTA,PSLSTVER,PSOVORD,PSVFLAG
"RTN","PSOVER",125,0)
 I $G(PSOCLK),$G(PSLST) K PSLST
"RTN","PSOVER",126,0)
 I $G(PSOCLK)!($G(PSOPOCK)) D FULL^VALM1 K VALMBCK D ^PSOBUILD,BLD^PSOORUT1 S Y=0 F  S Y=$O(PSOLST(Y)) Q:Y=""  I $P(PSOLST(Y),"^",2)=PSONV S PSLST=","_Y Q
"RTN","PSOVER",127,0)
 I $G(^PSRX(PSONV,"STA"))'=1&($G(^PSRX(PSONV,"STA"))'=4) S VALMBCK="Q" G EOJ2
"RTN","PSOVER",128,0)
 I '$G(PSOCLK)!('$G(PSOPOCK)) S VALMBCK="R"
"RTN","PSOVER",129,0)
EOJ2 ;
"RTN","PSOVER",130,0)
 K PSONV,Y
"RTN","PSOVER",131,0)
 L -^PSRX($P(PSOLST(ORN),"^",2))
"RTN","PSOVER",132,0)
 Q
"RTN","PSOVER",133,0)
LPAT ;
"RTN","PSOVER",134,0)
 K PSOVERPL
"RTN","PSOVER",135,0)
 I '$G(PSOVERPX) Q
"RTN","PSOVER",136,0)
 S PSOPLCK=$$L^PSSLOCK(PSOVERPX,0) I '$G(PSOPLCK) D LOCK^PSOORCPY S (PSOVERPL,PSOVERLX)=1
"RTN","PSOVER",137,0)
 K PSOPLCK
"RTN","PSOVER",138,0)
 Q
"RTN","PSOVER",139,0)
ULP ;
"RTN","PSOVER",140,0)
 I '$G(PSOVERPH) Q
"RTN","PSOVER",141,0)
 D UL^PSSLOCK(PSOVERPH) K PSOVERPH
"RTN","PSOVER",142,0)
 Q
"RTN","PSOVER",143,0)
LRX ;
"RTN","PSOVER",144,0)
 K PSOMSG I '$G(PSONV) Q
"RTN","PSOVER",145,0)
 D PSOL^PSSLOCK(PSONV) I '$G(PSOMSG) W !!,$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order."),! D  K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to Continue" D ^DIR K DIR
"RTN","PSOVER",146,0)
 .I $G(PSDFN) W "for patient "_$P($G(^DPT(PSDFN,0)),"^")_".",!
"RTN","PSOVER",147,0)
 Q
"RTN","PSOVER",148,0)
ULRX ;
"RTN","PSOVER",149,0)
 I '$G(PSONV) Q
"RTN","PSOVER",150,0)
 D PSOUL^PSSLOCK(PSONV)
"RTN","PSOVER",151,0)
 Q
"RTN","PSOVER",152,0)
LK1 ;
"RTN","PSOVER",153,0)
 I '$G(PSOLKVRX) Q
"RTN","PSOVER",154,0)
 D PSOL^PSSLOCK(PSOLKVRX) I '$G(PSOMSG) S VERLFLAG=1,PSOVMSGX=$P($G(PSOMSG),"^",2) Q
"RTN","PSOVER",155,0)
 S LOCKARRY(PSOLKVRX)=PSOLKVRX
"RTN","PSOVER",156,0)
 Q
"RTN","PSOVER",157,0)
ULK1 ;
"RTN","PSOVER",158,0)
 I '$D(LOCKARRY) Q
"RTN","PSOVER",159,0)
 S PSOVOLK="" F  S PSOVOLK=$O(LOCKARRY(PSOVOLK)) Q:$G(PSOVOLK)=""  D PSOUL^PSSLOCK(PSOVOLK)
"RTN","PSOVER",160,0)
 K PSOVOLK
"RTN","PSOVER",161,0)
 Q
"RTN","PSOVER",162,0)
ULB ;
"RTN","PSOVER",163,0)
 I $G(PSOVDFN) D UL^PSSLOCK(PSOVDFN)
"RTN","PSOVER",164,0)
 I $G(PSOVRXN) D PSOUL^PSSLOCK(PSOVRXN)
"RTN","PSOVER",165,0)
 K PSOVDFN,PSOVRXN
"RTN","PSOVER",166,0)
 Q
"RTN","PSOVER1")
0^23^B108309187
"RTN","PSOVER1",1,0)
PSOVER1 ;BHAM ISC/SAB - verify one rx ;3/9/05 12:53pm
"RTN","PSOVER1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**32,46,90,131,202,207,148,243,268,281,324,358,251**;DEC 1997;Build 202
"RTN","PSOVER1",3,0)
 ;External reference ^PSDRUG( supported by DBIA 221
"RTN","PSOVER1",4,0)
 ;External reference to PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOVER1",5,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOVER1",6,0)
 ;External reference to PSSORPH is supported by DBIA 3234
"RTN","PSOVER1",7,0)
 ;External references to ^ORRDI1 supported by DBIA 4659
"RTN","PSOVER1",8,0)
 ;External reference ^XTMP("ORRDI" supported by DBIA 4660
"RTN","PSOVER1",9,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5424
"RTN","PSOVER1",10,0)
REDO ;
"RTN","PSOVER1",11,0)
 I '$G(PSOCLK) Q:$G(PSVERFLG)
"RTN","PSOVER1",12,0)
 S (DRG,PSODRUG("NAME"))=$P(^PSDRUG(+$P(^PSRX(PSONV,0),"^",6),0),"^"),PSODRUG("VA CLASS")=$P(^(0),"^",2)
"RTN","PSOVER1",13,0)
 S PSOVQUIT=0,PSODRUG("IEN")=$P(^PSRX(PSONV,0),"^",6)
"RTN","PSOVER1",14,0)
 S PSOY(0)=^PSDRUG(PSODRUG("IEN"),0),PSOY=PSODRUG("IEN")_"^"_$P(PSOY(0),"^")
"RTN","PSOVER1",15,0)
 D SET^PSODRG
"RTN","PSOVER1",16,0)
 I '$D(PSODFN) S PSODFN=$P(^PSRX(PSONV,0),"^",2)
"RTN","PSOVER1",17,0)
 ;
"RTN","PSOVER1",18,0)
EDIT ;
"RTN","PSOVER1",19,0)
 S (PSDNEW,PSDOLD)="",PSDOLD=$P(^PSDRUG($P(^PSRX(PSONV,0),"^",6),0),"^")_"^"_PSONV
"RTN","PSOVER1",20,0)
 S DA=PSONV D ^PSORXPR
"RTN","PSOVER1",21,0)
 I $G(PKI1)=2 D DCV1^PSOPKIV1 G OUT
"RTN","PSOVER1",22,0)
 K PSDTSTOP S DIR("A")="EDIT",DIR("B")="N",DIR(0)="SB^Y:YES;N:NO;P:PROFILE",DIR("?")="Enter Y to change this RX, P to see a profile, or N to proceed with verification and order checks."
"RTN","PSOVER1",23,0)
 D ^DIR K DIR W ! G OUT:$G(DIRUT)!($G(DTOUT))
"RTN","PSOVER1",24,0)
 ;PSOPOCK=1 called from Process Order Check option; PSOCLK=1 means initiated from Rx verify by clerk.
"RTN","PSOVER1",25,0)
 I Y="Y",($G(PSOCLK)!($G(PSOPOCK))) D FULLEDT S VALMBCK="R" G KILL:$$CHECK(PSONV) G EDIT
"RTN","PSOVER1",26,0)
 I Y="Y",$G(PSOACT)]"" S VALMBCK="R",PSVERFLG=1 G OUT  ;this pops the user back to the med profile screen when verify is called from Patient Prescription Processing
"RTN","PSOVER1",27,0)
 I $D(DIRUT),$G(PSOCLK) S PSOCQ=1 G OUT
"RTN","PSOVER1",28,0)
 I $D(DIRUT),$G(PSOACT)]"" S VALMBCK="R" G OUT
"RTN","PSOVER1",29,0)
 G ORDCHK:Y="N",PROF:Y="P",OUT:"YNP"'[$E(Y)
"RTN","PSOVER1",30,0)
 ;
"RTN","PSOVER1",31,0)
CHANGE ;S DA=PSONV,(PSRX1,PSRX2)=$P(^PSRX(PSONV,0),"^",6)
"RTN","PSOVER1",32,0)
 ;S DIE="^PSRX(",DR="7;8;9;4;5;12;1;22;11;"_$S($P(PSOPAR,"^",12):"35;",1:"")_$S($P(PSOPAR,"^",15):"10.6",1:"")_";@2" D ^DIE
"RTN","PSOVER1",33,0)
 ;I PSRX1'=PSRX2,DEA1'=DEA2 S DR="6////"_PSRX1 D ^DIE
"RTN","PSOVER1",34,0)
 ;
"RTN","PSOVER1",35,0)
 D EXPIRE K DIE,DR,DEA1,DEA2,P(5),PSRX1,PSRX2
"RTN","PSOVER1",36,0)
 K PSD(PSDOLD) S PSDNEW="",PSDNEW=$P(^PSDRUG($P(^PSRX(PSONV,0),"^",6),0),"^")_"^"_PSONV,PSD(PSDNEW)=PSONV_"^*^1^"_$P(^PSDRUG($P(^PSRX(PSONV,0),"^",6),0),"^",2)
"RTN","PSOVER1",37,0)
 ;
"RTN","PSOVER1",38,0)
 S DA=$S($D(PSORXED("IRXN")):PSORXED("IRXN"),1:PSONV) D ^PSORXPR G OUT:$G(DIRUT)
"RTN","PSOVER1",39,0)
 G OUT:$D(DIRUT)!($D(DTOUT))
"RTN","PSOVER1",40,0)
 I '$G(PSOCLK) S DA=$S($D(PSORXED("IRXN")):PSORXED("IRXN"),1:PSONV) W !,"CHANGE",! D ^PSORXPR G OUT:$D(DIRUT)!($D(DTOUT)) G EDIT
"RTN","PSOVER1",41,0)
 G EDIT:PSDNEW=PSDOLD,REDO
"RTN","PSOVER1",42,0)
PROF I '$D(PSOSD) W !,$C(7),"This patient has no other prescriptions on file",!! G EDIT Q
"RTN","PSOVER1",43,0)
 W !!,$P(^DPT(DFN,0),"^"),?40,"ID#:"_VA("PID") W:$D(INT)!$D(PSONV) "  RX#: "_$S($D(INT):$P(INT,"^"),$D(^PSRX(PSONV)):$P(^PSRX(PSONV,0),"^"),1:"")
"RTN","PSOVER1",44,0)
 D HD^PSODDPR2() D ^PSODSPL D SHOW2^PSOVER G EDIT Q
"RTN","PSOVER1",45,0)
 ;
"RTN","PSOVER1",46,0)
EXPIRE S RX0=^PSRX(DA,0),X1=$P($P(RX0,"^",13),"."),X2=$P(RX0,"^",9)+1*$P(RX0,"^",8),X2=$S($P(RX0,"^",8)=X2:X2,X2<181:184,X2=360:366,1:X2),X=X1 D:X1&X2 C^%DTC
"RTN","PSOVER1",47,0)
 K ^PS(55,PSDFN,"P","A",+$P(^PSRX(DA,2),"^",6),DA) S ^PS(55,PSDFN,"P","A",X,DA)="",$P(^PSRX(DA,2),"^",6)=X,$P(^PS(4,DA,0),"^",7)=X Q
"RTN","PSOVER1",48,0)
 ;
"RTN","PSOVER1",49,0)
ORDCHK ;
"RTN","PSOVER1",50,0)
 S RX0=^PSRX(PSONV,0)
"RTN","PSOVER1",51,0)
 D ORDCK
"RTN","PSOVER1",52,0)
 I $G(PSOVQUIT)!$G(PSORX("DFLG")) G OUT
"RTN","PSOVER1",53,0)
 ;------
"RTN","PSOVER1",54,0)
VERIFY ; 
"RTN","PSOVER1",55,0)
 D FULL^VALM1 G:'$P(PSOPAR,"^",2) VERY
"RTN","PSOVER1",56,0)
 S DIR("A")="VERIFY FOR "_PSONAM_" ? (Y/N/Delete/Quit): ",DIR("B")="Y",DIR(0)="SA^Y:YES;N:NO;D:DELETE;Q:QUIT"
"RTN","PSOVER1",57,0)
 S DIR("?",1)="Enter Y (or return) to verify this prescription",DIR("?",2)="N to leave this prescription non-verified and to end this session of verification",DIR("?")="D to delete this prescription"
"RTN","PSOVER1",58,0)
 D ^DIR K DIR I Y="N" S PSORX("DFLG")=1 G OUT
"RTN","PSOVER1",59,0)
 G QUIT:"Q^"[$E(Y),DELETE:Y="D"
"RTN","PSOVER1",60,0)
VERY I $G(PKI1)=1 D REA^PSOPKIV1 G:'$D(PKIR) VERIFY
"RTN","PSOVER1",61,0)
 K ^PSRX(PSONV,"DAI") S $P(^PSRX(PSONV,3),"^",6)=""
"RTN","PSOVER1",62,0)
 K ^PSRX(PSONV,"DRI"),SPFL
"RTN","PSOVER1",63,0)
 I '$O(^PSRX(PSONV,6,0)) D  I $D(DUOUT)!($D(DTOUT)) W !!,"Rx: "_$P(^PSRX(DA,0),"^")_" not Verified!!",! H 2 G OUT
"RTN","PSOVER1",64,0)
 .W !!,"Dosing Instructions Missing. Please add!",!
"RTN","PSOVER1",65,0)
 .I $P($G(^PSRX(PSONV,"SIG")),"^")]"",'$P($G(^("SIG")),"^",2) W "SIG: "_$P(^PSRX(PSONV,"SIG"),"^"),!
"RTN","PSOVER1",66,0)
 .I $P($G(^PSRX(PSONV,"SIG")),"^",2),$O(^PSRX(PSONV,"SIG1",0)) D  K I
"RTN","PSOVER1",67,0)
 ..W "SIG: " F I=0:0 S I=$O(^PSRX(PSONV,"SIG1",I)) Q:'I  W ^PSRX(PSONV,"SIG1",I,0),!
"RTN","PSOVER1",68,0)
 .S DA=PSONV,PSOVER=1 K DIR,DIRUT,DUOUT,DTOUT
"RTN","PSOVER1",69,0)
 .S PSODRUG("IEN")=$P(^PSRX(DA,0),"^",6),PSODFN=$P(^(0),"^",2),PSORXED("IRXN")=DA,PSODRUG("OI")=$P(^PSRX(DA,"OR1"),"^")
"RTN","PSOVER1",70,0)
 .D DOSE^PSSORPH(.DOSE,PSODRUG("IEN"),"O",PSODFN),^PSOORED3
"RTN","PSOVER1",71,0)
 .K PSODFN,PSODRUG("IEN"),DOSE,PSOVER
"RTN","PSOVER1",72,0)
 .I '$G(ENT) S DUOUT=1
"RTN","PSOVER1",73,0)
 .Q:$D(DUOUT)!($D(DTOUT))
"RTN","PSOVER1",74,0)
 .K DIR,DIRUT,DUOUT,DTOUT S DIE=52,DR=114 D ^DIE K DIE,DR,DTOUT
"RTN","PSOVER1",75,0)
 .I X'="" D SIG^PSOHELP D:$G(INS1)]"" EN^DDIOL($E(INS1,2,9999999)) S PSORXED("SIG",1)=$E(INS1,2,9999999)
"RTN","PSOVER1",76,0)
 .D EN^PSOFSIG(.PSORXED,1),UDSIG^PSOORED3 H 2
"RTN","PSOVER1",77,0)
 S DA=PSONV,$P(^PSRX(DA,2),"^",10)=DUZ,DRG=$P(^PSDRUG($P(^PSRX(DA,0),"^",6),0),"^")
"RTN","PSOVER1",78,0)
 I $P(^PSRX(DA,2),"^",2)>DT,$P(PSOPAR,"^",6) D  G KILL
"RTN","PSOVER1",79,0)
 .S (SPFL1,PSOVER)="",PSORX("FILL DATE")=$P(^(2),"^",2),RXF=0
"RTN","PSOVER1",80,0)
 .D UPSUS S PSTRIVER=1 D SUS^PSORXL
"RTN","PSOVER1",81,0)
 .K PSORX("FILL DATE"),PSTRIVER
"RTN","PSOVER1",82,0)
 S PSOVER(PSONV)="" S $P(^PSRX(PSONV,"STA"),"^")=0,DRG=$P(^PSDRUG($P(^PSRX(DA,0),"^",6),0),"^")
"RTN","PSOVER1",83,0)
 S $P(PSOSD("NON-VERIFIED",DRG),"^",2)=0,PSOSD("ACTIVE",DRG)=PSOSD("NON-VERIFIED",DRG)
"RTN","PSOVER1",84,0)
 I $G(PKI1)=1,$G(PKIR)]"" D ACT^PSOPKIV1(DA)
"RTN","PSOVER1",85,0)
 K PSOSD("NON-VERIFIED",DRG) D EN^PSOHLSN1(PSONV,"SC","CM","") ;S VALMBCK=""
"RTN","PSOVER1",86,0)
 ;
"RTN","PSOVER1",87,0)
 ; - Calling ECME for claims generation and transmission / REJECT handling
"RTN","PSOVER1",88,0)
 N ACTION
"RTN","PSOVER1",89,0)
 I $$SUBMIT^PSOBPSUT(PSONV) D  I ACTION="Q"!(ACTION="^") Q
"RTN","PSOVER1",90,0)
 . S ACTION="" D ECMESND^PSOBPSU1(PSONV,,,$S($O(^PSRX(PSONV,1,0)):"RF",1:"OF"))
"RTN","PSOVER1",91,0)
 . ; Quit if there is an unresolved Tricare non-billable reject code, PSO*7*358
"RTN","PSOVER1",92,0)
 . I $$PSOET^PSOREJP3(PSONV) S ACTION="Q" Q
"RTN","PSOVER1",93,0)
 . I $$FIND^PSOREJUT(PSONV) D
"RTN","PSOVER1",94,0)
 . . S ACTION=$$HDLG^PSOREJU1(PSONV,0,"79,88","OF","IOQ","Q")
"RTN","PSOVER1",95,0)
 ;
"RTN","PSOVER1",96,0)
KILL S DA=PSONV,DIK="^PS(52.4," D ^DIK K DA,DIK D DCORD^PSONEW2
"RTN","PSOVER1",97,0)
OUT ;
"RTN","PSOVER1",98,0)
 I '$G(PSOCLK) S:$G(DIRUT)!($G(DTOUT)) PSORX("DFLG")=1 K DIRUT,DTOUT,DUOUT,UPFLAGX D CLEAN S VALMBCK="Q" Q
"RTN","PSOVER1",99,0)
 I $G(PSOCLK) S PSORX("DFLG")=0 K UPFLAGX D CLEAN Q
"RTN","PSOVER1",100,0)
DELETE K UPFLAGX D DELETE^PSOVER2 G:$G(UPFLAGX) OUT K PSOSD("NON-VERIFIED",$G(DRG)) Q
"RTN","PSOVER1",101,0)
QUIT S PSOQUIT="" D CLEAN Q
"RTN","PSOVER1",102,0)
UPSUS S $P(PSOSD("NON-VERIFIED",DRG),"^",2)=5,PSOSD("ACTIVE",DRG)=PSOSD("NON-VERIFIED",DRG) K PSOSD("NON-VERIFIED",DRG) D EN^PSOHLSN1(PSONV,"SC","CM","")
"RTN","PSOVER1",103,0)
 Q
"RTN","PSOVER1",104,0)
CLEAN ;cleans up tmp("psorxdc") global
"RTN","PSOVER1",105,0)
 I $O(^TMP("PSORXDC",$J,0)) F RORD=0:0 S RORD=$O(^TMP("PSORXDC",$J,RORD)) Q:'RORD  D
"RTN","PSOVER1",106,0)
 .D PSOUL^PSSLOCK(RORD_$S($P(^TMP("PSORXDC",$J,RORD,0),"^")="P":"S",1:""))
"RTN","PSOVER1",107,0)
 .I $P(^TMP("PSORXDC",$J,RORD,0),"^")="P" D  Q
"RTN","PSOVER1",108,0)
 ..S PSOR=^PS(52.41,RORD,0)
"RTN","PSOVER1",109,0)
 ..S DNM=$S($P(PSOR,"^",9):$P($G(^PSDRUG($P(PSOR,"^",9),0)),"^"),1:$P(^PS(50.7,$P(PSOR,"^",8),0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,$P(PSOR,"^",8),0),"^",2),0),"^"))
"RTN","PSOVER1",110,0)
 ..W $C(7),!," Duplicate "_$S($P(^TMP("PSORXDC",$J,RORD,0),"^",10):"Therapy",1:"Drug")_" Pending Order "_DNM_" NOT Discontinued."
"RTN","PSOVER1",111,0)
 .W !," Duplicate "_$S($P(^TMP("PSORXDC",$J,RORD,0),"^",10):"Therapy",1:"Drug")_" Rx #"_$P(^PSRX(RORD,0),"^")_" "_$P(^TMP("PSORXDC",$J,RORD,0),"^",7)_" NOT Discontinued.",!
"RTN","PSOVER1",112,0)
 K ^TMP("PSORXDC",$J),RORD,PRNXZ,ORNZZ,PSOR
"RTN","PSOVER1",113,0)
 Q
"RTN","PSOVER1",114,0)
KV1 ;
"RTN","PSOVER1",115,0)
 K PSOANSQD,DRET,LST,PSOQUIT,PSODRUG,PSONEW,SIG,PSODIR,PHI,PRC,ORCHK,ORDRG,PSOSIGFL,PSORX("ISSUE DATE"),PSORX("FILL DATE"),CLOZPAT
"RTN","PSOVER1",116,0)
KV K DIR,DIRUT,DTOUT,DUOUT
"RTN","PSOVER1",117,0)
 Q
"RTN","PSOVER1",118,0)
NVA ;
"RTN","PSOVER1",119,0)
 I $P(PSOSD(STA,DNM),"^",11) D NVA^PSODRDU1 Q
"RTN","PSOVER1",120,0)
 N PSOOI,CLASS,FLG,X,Y,RXREC,IFN
"RTN","PSOVER1",121,0)
 S (Y,FLG)=""
"RTN","PSOVER1",122,0)
 S RXREC=$P(PSOSD(STA,DNM),"^",10),PSOOI=+$G(^PS(55,DFN,"NVA",RXREC,0)),IFN=RXREC N DNM
"RTN","PSOVER1",123,0)
 F  S Y=$O(^PSDRUG("ASP",PSOOI,Y)) Q:Y=""!(FLG)  S DNM=$P(^PSDRUG(Y,0),"^"),CLASS=$P(^PSDRUG(Y,0),"^",2) I PSODRUG("NAME")=DNM!(CLASS=PSODRUG("VA CLASS")) D DSP^PSODRDU1 S FLG=1 Q
"RTN","PSOVER1",124,0)
 Q
"RTN","PSOVER1",125,0)
REMOTE ; 
"RTN","PSOVER1",126,0)
 K ^TMP($J,"DD"),^TMP($J,"DC"),^TMP($J,"DI"),^TMP($J,"DI"_PSODFN) D
"RTN","PSOVER1",127,0)
 .I $T(HAVEHDR^ORRDI1)']"" Q
"RTN","PSOVER1",128,0)
 .I '$$HAVEHDR^ORRDI1 Q
"RTN","PSOVER1",129,0)
 .D HD^PSODDPR2():(($Y+5)'>IOSL)
"RTN","PSOVER1",130,0)
 .I $D(^XTMP("ORRDI","OUTAGE INFO","DOWN")) D  Q
"RTN","PSOVER1",131,0)
 ..I $T(REMOTE^PSORX1)]"" Q
"RTN","PSOVER1",132,0)
 ..W !!,"Remote data not available - Only local order checks processed.",! D HD^PSODDPR2():(($Y+5)>IOSL) ; D PAUSE^PSOORRD2
"RTN","PSOVER1",133,0)
 .W !!,"Now doing remote order checks. Please wait..."
"RTN","PSOVER1",134,0)
 .D REMOTE^PSOORRDI(PSODFN,+$P($G(^PSRX(PSONV,0)),"^",6))
"RTN","PSOVER1",135,0)
 .I $P($G(^XTMP("ORRDI","PSOO",PSODFN,0)),"^",3)<0 W !!,"Remote data not available - Only local order checks processed.",! D HD^PSODDPR2():(($Y+5)>IOSL) ;D PAUSE^PSOORRD2 Q
"RTN","PSOVER1",136,0)
 .I $D(^TMP($J,"DD")) D DUP^PSOORRD2
"RTN","PSOVER1",137,0)
 .I $D(^TMP($J,"DC")) D CLS^PSOORRD2
"RTN","PSOVER1",138,0)
 .I $D(^TMP($J,"DI"_PSODFN)) K ^TMP($J,"DI") M ^TMP($J,"DI")=^TMP($J,"DI"_PSODFN) D DRGINT^PSOORRD2
"RTN","PSOVER1",139,0)
 K ^TMP($J,"DD"),^TMP($J,"DC"),^TMP($J,"DI"),^TMP($J,"DI"_PSODFN)
"RTN","PSOVER1",140,0)
 Q
"RTN","PSOVER1",141,0)
NOALRGY ;
"RTN","PSOVER1",142,0)
 N PSODFN,PSODRUG
"RTN","PSOVER1",143,0)
 S PSODFN=$P(^PSRX(PSONV,0),"^",2),PSODRUG("IEN")=$P(^PSRX(PSONV,0),"^",6)
"RTN","PSOVER1",144,0)
 D NOALRGY^PSODRG
"RTN","PSOVER1",145,0)
 Q
"RTN","PSOVER1",146,0)
 ;
"RTN","PSOVER1",147,0)
ORDCK ;
"RTN","PSOVER1",148,0)
 N ORN,ORNZZ,PSOLST,Y S ORN=PSONV,PSOLST(PSONV)=PSONV_"^"_PSONV,PSOVORD=1
"RTN","PSOVER1",149,0)
 N DRG,ON,CT,DRGI,PDRG,SEV,STX,INT,CLI,PSONULN,PSONULN1,LST,LSI,DGI,SER,SERS,DUPT,SV
"RTN","PSOVER1",150,0)
 S ORNZZ=ORN,PRNXZ(ORN)=PSOLST(ORN),PSORENW("OIRXN")=PSONV
"RTN","PSOVER1",151,0)
 I '$D(PSODFN) S PSODFN=$P(^PSRX(PSONV,0),"^",2)
"RTN","PSOVER1",152,0)
 D SHOW^PSOVER D HD^PSODDPR2():(($Y+5)>IOSL)
"RTN","PSOVER1",153,0)
 ;I '$$DS^PSSDSAPI 
"RTN","PSOVER1",154,0)
 D
"RTN","PSOVER1",155,0)
 .S (PSODRUG("IEN"),PSDRUG("IEN"))=$P(^PSRX(PSONV,0),"^",6)
"RTN","PSOVER1",156,0)
 .N PSOVINF S PSOVINF=^PSDRUG(PSDRUG("IEN"),0),PSODRUG("VA CLASS")=$P(^(0),"^",2)
"RTN","PSOVER1",157,0)
 .S PSODRUG("VA CLASS")=$P(PSOVINF,"^",2),(DRG,PSODRUG("NAME"))=$P(^PSDRUG(PSDRUG("IEN"),0),"^")
"RTN","PSOVER1",158,0)
 .S PSODRUG("NDF")=$S($G(^PSDRUG(PSDRUG("IEN"),"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)
"RTN","PSOVER1",159,0)
 .S PSODRUG("MAXDOSE")=$P(PSOVINF,"^",4),PSODRUG("DEA")=$P(PSOVINF,"^",3),PSODRUG("CLN")=$S($D(^PSDRUG(PSDRUG("IEN"),"ND")):+$P(^("ND"),"^",6),1:0)
"RTN","PSOVER1",160,0)
 .S PSODRUG("SIG")=$P(PSOVINF,"^",5),PSODRUG("NDC")=$$GETNDC^PSSNDCUT(PSDRUG("IEN"),$G(PSOSITE)),PSODRUG("STKLVL")=$G(^PSDRUG(PSDRUG("IEN"),660.1))
"RTN","PSOVER1",161,0)
 .S PSODRUG("DAW")=+$$GET1^DIQ(50,PSONV,81)
"RTN","PSOVER1",162,0)
 .K PSOVINF
"RTN","PSOVER1",163,0)
 D POST^PSODRG
"RTN","PSOVER1",164,0)
 I $$GET1^DIQ(52,PSONV,100,"I")=13 S PSORX("DFLG")=1 Q
"RTN","PSOVER1",165,0)
 I $G(PSVERFLG),$G(PSOCLK) S PSVERFLG=0
"RTN","PSOVER1",166,0)
 I $G(PSOCLK),$G(PSORX("DFLG")) S PSOVQUIT=1 K PSORX("DFLG"),DIRUT,DTOUT Q
"RTN","PSOVER1",167,0)
 Q:PSORX("DFLG")
"RTN","PSOVER1",168,0)
 D:$$DS^PSSDSAPI&('$G(PSORX("DFLG"))) DOSCK^PSODOSUT("V")
"RTN","PSOVER1",169,0)
 I $$GET1^DIQ(52,PSONV,100,"I")=13 S PSORX("DFLG")=1 Q
"RTN","PSOVER1",170,0)
 I $G(PSOCLK),$G(PSORX("DFLG")) S PSOVQUIT=1 K PSORX("DFLG"),DIRUT,DTOUT Q
"RTN","PSOVER1",171,0)
 Q:PSORX("DFLG")
"RTN","PSOVER1",172,0)
 S PSOLST(ORNZZ)=PRNXZ(ORNZZ),ORN=ORNZZ K PSORENW("OIRXN")
"RTN","PSOVER1",173,0)
 Q
"RTN","PSOVER1",174,0)
 ;
"RTN","PSOVER1",175,0)
FULLEDT  ;
"RTN","PSOVER1",176,0)
 D FULL^VALM1
"RTN","PSOVER1",177,0)
 N RX,FILL,OPSOLST,OPSLST,OLDDA,PSODRUG,REJ
"RTN","PSOVER1",178,0)
 S (RX,PSORXED("IRXN"))=PSONV
"RTN","PSOVER1",179,0)
 M OPSOLST=PSOLST,OPSLST=PSLST,ODA=DA
"RTN","PSOVER1",180,0)
 N PSOSITE,ORN,PSOPAR,PSOLIST,PSOSD ;,PSD,PSDNEW,PSDOLD,DA,PSOSD,RX0,X1,X2,PSOQUIT
"RTN","PSOVER1",181,0)
 S PSOSITE=$$RXSITE^PSOBPSUT(RX,""),ORN=RX
"RTN","PSOVER1",182,0)
 S PSOPAR=$G(^PS(59,PSOSITE,1)),PSOLIST(1)=ORN_","
"RTN","PSOVER1",183,0)
 D EPH^PSORXEDT
"RTN","PSOVER1",184,0)
 M PSOLST=OPSOLST,PSLST=OPSLST S VALMBCK="R" S:$D(OLDDA) DA=OLDDA
"RTN","PSOVER1",185,0)
 Q
"RTN","PSOVER1",186,0)
 ;
"RTN","PSOVER1",187,0)
DRIDOSE(DA,RX0) ;where DA is RXIEN and RX0 is zero node of file 52 for the RXIEN
"RTN","PSOVER1",188,0)
 N T,RXN,RXX,SCRIPT,SEV,X,SER,PSOSERV,PSOSCPT,PSODOSF,RX
"RTN","PSOVER1",189,0)
 S RX=RX0
"RTN","PSOVER1",190,0)
 S RXN=$P(RX0,"^")
"RTN","PSOVER1",191,0)
 I $D(^PS(52.4,RX,0))!($D(^PSRX(RX,"DRI"))) D
"RTN","PSOVER1",192,0)
 . Q:'$P($G(^PS(52.4,RX,0)),"^",8)&('$D(^PSRX(RX,"DRI")))
"RTN","PSOVER1",193,0)
 .W !!,"*** During order, there were DRUG-DRUG INTERACTION for the following RX(s):"
"RTN","PSOVER1",194,0)
 I $P($G(^PS(52.4,RX,0)),"^",8) S SCRIPT=$P(^PS(52.4,RX,0),"^",10),SEV=$P(^PS(52.4,RX,0),"^",9) F X=1:1 S RXX(X)=$P(SCRIPT,",",X),SEV(X)=$P(SEV,",",X) Q:RXX(X)=""  D
"RTN","PSOVER1",195,0)
 . S SER=$P(^PS(56,SEV(X),0),"^",4) S:$G(SER)=1 PSOSERV=1
"RTN","PSOVER1",196,0)
 . S PSOSCPT(RXX(X))="     "_$S(SER=1:"CRITICAL",SER=2:"SIGNIFICANT",1:"UNKNOWN")_" INTERACTION    "_$P(^PSDRUG($P(^PSRX(RXX(X),0),"^",6),0),"^")
"RTN","PSOVER1",197,0)
 I $D(^PSRX(RX,"DRI")) S SCRIPT=$P(^PSRX(RX,"DRI"),"^",2),SEV=$P(^PSRX(RX,"DRI"),"^") F X=1:1 S RXX(X)=$P(SCRIPT,",",X),SEV(X)=$P(SEV,",",X) Q:RXX(X)=""  D
"RTN","PSOVER1",198,0)
 .S SER=$P(^PS(56,SEV(X),0),"^",4)
"RTN","PSOVER1",199,0)
 .S PSOSCPT(RXX(X))="     "_$P($G(^PSRX(RXX(X),0)),"^")_"  "_$S(SER=1:"CRITICAL",SER=2:"SIGNIFICANT",1:"UNKNOWN")_" INTERACTION  "_$P(^PSDRUG($P(^PSRX(RXX(X),0),"^",6),0),"^")
"RTN","PSOVER1",200,0)
 S SCRIPT="" F  S SCRIPT=$O(PSOSCPT(SCRIPT)) Q:SCRIPT=""  W !,PSOSCPT(SCRIPT)
"RTN","PSOVER1",201,0)
 I $$DS^PSSDSAPI,$D(^PS(52.4,RX,1)) S T=$P(^PS(52.4,RX,1),"^") D  W:PSODOSF'="" !,"*** Dose Warning: ",PSODOSF
"RTN","PSOVER1",202,0)
 . S PSODOSF="",PSODOSF=$S(T=3:"MAX SINGLE DOSE & DAILY DOSE RANGE",T=2:"MAX SINGLE DOSE",T=1:"DAILY DOSE RANGE",1:"")
"RTN","PSOVER1",203,0)
 W !
"RTN","PSOVER1",204,0)
 Q
"RTN","PSOVER1",205,0)
CHECK(PSONV) ;
"RTN","PSOVER1",206,0)
 N PSOSTAT S PSOSTAT=$$GET1^DIQ(52,PSONV,100,"I")
"RTN","PSOVER1",207,0)
 I ",11,12,13,14,15,"[(","_PSOSTAT_",") Q 1
"RTN","PSOVER1",208,0)
 Q 0
"RTN","PSOVER2")
0^60^B13436802
"RTN","PSOVER2",1,0)
PSOVER2 ;BHAM ISC/SAB - edit and/or discontinue unverified rx's ;07/03/95 9:32
"RTN","PSOVER2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**131,251**;DEC 1997;Build 202
"RTN","PSOVER2",3,0)
 ;Reference ^PSDRUG( supported by DBIA 221
"RTN","PSOVER2",4,0)
 S DIR("B")="C",DIR("A")="Do you want to DELETE or EDIT Rx # "_$P(^PSRX(PSONV,0),"^")_" or Discontinue "_$P(DUPRX0,"^")_" ",DIR("?",1)="This is a duplicate drug.  Your options are to :"
"RTN","PSOVER2",5,0)
 S DIR("?",2)="   (1) - Discontinue the old Rx ("_$P(DUPRX0,"^")_")",DIR("?",3)="   (2) - DELETE this Rx ("_$P(^PSRX(PSONV,0),"^")_")"
"RTN","PSOVER2",6,0)
 S DIR("?",4)="or (3) - EDIT this Rx ("_$P(^PSRX(PSONV,0),"^")_")",DIR("?")="You MUST select one of the 3 actions!"
"RTN","PSOVER2",7,0)
 S DIR(0)="SA^1:DISCONTINUE;2:DELETE;3:EDIT" D ^DIR K DIR G CANOLD^PSOVERC:Y=1,DELETE:Y=2,CHANGE:Y=3,QUIT^PSOVER1:"123"'[$E(Y)
"RTN","PSOVER2",8,0)
CHANGE S DA=PSONV,PSDOLD=DRGG,GOOF=0,(PSRX1,PSRX2)=$P(^PSRX(PSONV,0),"^",6)
"RTN","PSOVER2",9,0)
 S DIE="^PSRX(",DR="@1;3;S PSRX1=$P(D,""^"",6);6;S PSRX2=X D:PSRX1=PSRX2 MUST^PSOVER2 D:PSRX1'=PSRX2 NO^PSOVER2;10;7;8;9;4;5;12;1;22;11;"_$S($P(PSOPAR,"^",12):"35;",1:"")_$S($P(PSOPAR,"^",15):"10.6",1:"")_";@2" D ^DIE
"RTN","PSOVER2",10,0)
 I GOOF=1 S DR="6////"_PSRX1 D ^DIE G PSOVER2
"RTN","PSOVER2",11,0)
 I GOOF=2 G PSOVER2
"RTN","PSOVER2",12,0)
 K DIE,DR,DEA1,DEA2,PSRX1,PSRX2,GOOF G REDO^PSOVER1
"RTN","PSOVER2",13,0)
 ;
"RTN","PSOVER2",14,0)
NO ;called by `dr strings' at change+1^psover2 and at change^psover1
"RTN","PSOVER2",15,0)
 I $P($G(^PSDRUG(PSRX1,2)),"^")'=$P($G(^PSDRUG(PSRX2,2)),"^") D  G OITEM
"RTN","PSOVER2",16,0)
 .W !!,"You MUST select a drug with the same Orderable Item!",! K DIR S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR
"RTN","PSOVER2",17,0)
 S DEA1=$P(^PSDRUG(PSRX1,0),"^",3)["A",DEA2=$P(^PSDRUG(PSRX2,0),"^",3)["A"
"RTN","PSOVER2",18,0)
 I DEA1&DEA2!('DEA1&'DEA2) Q
"RTN","PSOVER2",19,0)
 W !,$C(7),?12,"You CANNOT change a "_$S(DEA1:"",1:"NON-")_"Narcotic Drug to a "_$S(DEA2:"",1:"Non-"),"Narcotic Drug",!?13,"You must discontinue this prescription and enter a new one",!
"RTN","PSOVER2",20,0)
 W ?5,"Use the DELETE option rather than the EDIT option on this prescription",!!,$C(7) K DIR S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR
"RTN","PSOVER2",21,0)
OITEM S Y="@2",GOOF=1 Q
"RTN","PSOVER2",22,0)
 ;
"RTN","PSOVER2",23,0)
MUST ;called by `dr string' at change+1^psover2
"RTN","PSOVER2",24,0)
 W !!!,$C(7),"This is a duplicate drug for an existing prescription",!!,"You MUST either CHANGE the drug in this prescription",!,?16,"DELETE this prescription",!,?13,"or DISCONTINUE the existing prescription",!!,$C(7) S Y="@2",GOOF=2 Q
"RTN","PSOVER2",25,0)
 ;
"RTN","PSOVER2",26,0)
DELETE ;
"RTN","PSOVER2",27,0)
 I '$G(DRG) S DRG=$P(^PSRX(PSONV,0),"^",6)
"RTN","PSOVER2",28,0)
 D NOOR^PSOCAN4 I $D(DIRUT) D DR Q
"RTN","PSOVER2",29,0)
 K PSD(DRG_"^"_PSONV) S DA=PSONV I $G(PKI1) D DCV^PSOPKIV1 G:$D(PKIR) KILL D DR Q
"RTN","PSOVER2",30,0)
 D ENQ^PSORXDL
"RTN","PSOVER2",31,0)
KILL S DA=PSONV,DIK="^PS(52.4," D ^DIK K DA,DIK
"RTN","PSOVER2",32,0)
 K Z,Z1,Z2,PSOKL,PSOKL1,PSOKL2,PSOKL3,PSOKL6,PSOKL7,PSONOOR,DA
"RTN","PSOVER2",33,0)
 Q
"RTN","PSOVER2",34,0)
DR W $C(7)," ACTION NOT TAKEN!",!
"RTN","PSOVER2",35,0)
 K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR
"RTN","PSOVER2",36,0)
 S UPFLAGX=1 Q
"RTN","PSOVER2",37,0)
 ;
"RTN","PSOVRPT")
0^61^B19926932
"RTN","PSOVRPT",1,0)
PSOVRPT ;BHAM ISC/SAB - log of non-verified rx's sorted by patient or user code ;06/29/92 16:56
"RTN","PSOVRPT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**251**;DEC 1997;Build 202
"RTN","PSOVRPT",3,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5424
"RTN","PSOVRPT",4,0)
SORT S DIR("A")="Sort By Patient or Clerk: ",DIR("B")="P",DIR(0)="SA^P:PATIENT;C:CLERK" D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) S PSOQUIT=1 G END
"RTN","PSOVRPT",5,0)
 S PSRT=Y
"RTN","PSOVRPT",6,0)
 K IOP,%ZIS S PSOION=ION,%ZIS="MQ" D ^%ZIS I POP S IOP=PSOION D ^%ZIS K PSOION S PSOQUIT=1 G END
"RTN","PSOVRPT",7,0)
 I $D(IO("Q")) S ZTRTN="START^PSOVRPT",ZTDESC="REPORT OF NON-VERIFIED RXs SORTED BY PATIENT OR CLERK",ZTSAVE("PSRT")="" D ^%ZTLOAD W:$D(ZTSK) !,"Task Queued " K PSOION,ZTSK S PSOQUIT=1 G END
"RTN","PSOVRPT",8,0)
START U IO
"RTN","PSOVRPT",9,0)
 N PAGE,PSOQUIT,LINE,ZPAT,CLERK,RDATE,ZCLK,ZZZZ,PNAME,COUNT,ZZZ,ZSORT,PATNAME,EOFLAG,IDATE,CLNAME,CLINT,PNODE,PSOCT,SSS,PSORX
"RTN","PSOVRPT",10,0)
 K ^TMP($J,"PSOVR"),^TMP($J,"PSOCR") S PAGE=1,PSOQUIT=0,$P(LINE,"-",79)=""
"RTN","PSOVRPT",11,0)
 D NOW^%DTC S Y=% X ^DD("DD") S RDATE=Y
"RTN","PSOVRPT",12,0)
 I $G(PSRT)="C" G CLERK
"RTN","PSOVRPT",13,0)
PAT ;sort by patient
"RTN","PSOVRPT",14,0)
 F ZPAT=0:0 S ZPAT=$O(^PS(52.4,"C",ZPAT)) Q:'ZPAT  S COUNT=0 F ZZZ=0:0 S ZZZ=$O(^PS(52.4,"C",ZPAT,ZZZ)) Q:'ZZZ  S PATNAME=$P($G(^DPT(ZPAT,0)),"^") D:PATNAME'=""&($D(^PS(52.4,ZZZ,0)))
"RTN","PSOVRPT",15,0)
 .I $G(ZSORT),$P($G(^PS(52.4,ZZZ,0)),"^",3)'=$G(CLINT) Q
"RTN","PSOVRPT",16,0)
 .I $D(^PSRX(ZZZ,0)) S COUNT=COUNT+1,^TMP($J,"PSOVR",PATNAME,COUNT)=ZZZ_"^"_$P($G(^PSDRUG(+$P(^PSRX(ZZZ,0),"^",6),0)),"^")_"^"_$P(^PSRX(ZZZ,0),"^",13)_"^"_$P(^PS(52.4,ZZZ,0),"^",3)
"RTN","PSOVRPT",17,0)
 I $G(ZSORT) Q
"RTN","PSOVRPT",18,0)
 D HD I '$D(^TMP($J,"PSOVR")) W !!,"NO NON-VERIFIED PRESCRIPTIONS TO PRINT.",! D:$E(IOST)="C"  G END
"RTN","PSOVRPT",19,0)
 .K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOVRPT",20,0)
CLPT ;
"RTN","PSOVRPT",21,0)
 S PNAME="" F  S PNAME=$O(^TMP($J,"PSOVR",PNAME)) Q:PNAME=""!(PSOQUIT)  S PSOCT=0 F SSS=0:0 S SSS=$O(^TMP($J,"PSOVR",PNAME,SSS)) Q:'SSS!(PSOQUIT)  D
"RTN","PSOVRPT",22,0)
 .S PSOCT=PSOCT+1,PNODE=^TMP($J,"PSOVR",PNAME,SSS)
"RTN","PSOVRPT",23,0)
 .S EOFLAG=0 I ($Y+5)>IOSL D  Q:PSOQUIT
"RTN","PSOVRPT",24,0)
 ..I $E(IOST)="C" W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue,'^' to exit" D ^DIR K DIR S:'Y PSOQUIT=1 I 'PSOQUIT S EOFLAG=1 D HD
"RTN","PSOVRPT",25,0)
 ..I $E(IOST)'="C" S EOFLAG=1 D HD
"RTN","PSOVRPT",26,0)
 .S ZZZZ=0 I PSOCT=1 W !!?3,PNAME S ZZZZ=1
"RTN","PSOVRPT",27,0)
 .I 'ZZZZ,$G(EOFLAG) W !!?3,PNAME_" (continued)"
"RTN","PSOVRPT",28,0)
 .W !,$P($G(^PSRX(+$P(PNODE,"^"),0)),"^")
"RTN","PSOVRPT",29,0)
 .S IDATE=$P(PNODE,"^",3),PSORX="",PSORX=$O(^PS(52.4,"B",+$P(PNODE,"^")))
"RTN","PSOVRPT",30,0)
 .W ?13,$E(IDATE,4,5)_"/"_$E(IDATE,6,7)_"/"_$E(IDATE,2,3)
"RTN","PSOVRPT",31,0)
 .W ?22,$S($O(^PS(52.4,"ADI",+$P(PNODE,"^"),0))!($$DS^PSSDSAPI&($$GET1^DIQ(52.4,+PNODE,8,"I"))):"#",1:" "),$P(PNODE,"^",2)
"RTN","PSOVRPT",32,0)
 .I $G(PSRT)="P" W ?63,$J(+$P(PNODE,"^",4),15)
"RTN","PSOVRPT",33,0)
 Q:$G(PSRT)="C"
"RTN","PSOVRPT",34,0)
 G END
"RTN","PSOVRPT",35,0)
 ;
"RTN","PSOVRPT",36,0)
CLERK ;sort by clerk
"RTN","PSOVRPT",37,0)
 F ZCLK=0:0 S ZCLK=$O(^PS(52.4,"D",ZCLK)) Q:'ZCLK  S COUNT=0 F ZZZ=0:0 S ZZZ=$O(^PS(52.4,"D",ZCLK,ZZZ)) Q:'ZZZ  D:$P($G(^VA(200,ZCLK,0)),"^")'=""&($D(^PS(52.4,ZZZ,0)))
"RTN","PSOVRPT",38,0)
 .S CLERK=$P($G(^VA(200,+$P($G(^PS(52.4,ZZZ,0)),"^",3),0)),"^")
"RTN","PSOVRPT",39,0)
 .I $D(^PSRX(ZZZ,0)),CLERK'="" S ^TMP($J,"PSOCR",CLERK,ZCLK)=""
"RTN","PSOVRPT",40,0)
 I '$D(^TMP($J,"PSOCR")) D HD W !!,"NO NON-VERIFIED PRESCRIPTIONS TO PRINT.",! D:$E(IOST)="C"  G END
"RTN","PSOVRPT",41,0)
 .K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOVRPT",42,0)
 S CLNAME="" F  S CLNAME=$O(^TMP($J,"PSOCR",CLNAME)) Q:CLNAME=""!(PSOQUIT)  S CLINT=$O(^TMP($J,"PSOCR",CLNAME,0)) D
"RTN","PSOVRPT",43,0)
 .S ZSORT=1 D PAT D:$D(^TMP($J,"PSOVR")) HD D:$D(^TMP($J,"PSOVR")) CLPT D:$E(IOST)="C"&('$G(PSOQUIT))  K ZSORT,^TMP($J,"PSOVR")
"RTN","PSOVRPT",44,0)
 ..K DIR W ! S DIR(0)="E",DIR("A")="Press Return to continue,'^' to exit" D ^DIR K DIR S:Y'=1 PSOQUIT=1 Q
"RTN","PSOVRPT",45,0)
END D:$E(IOST)="C"&($G(PSRT)="P")&('$G(PSOQUIT))  K ^TMP($J,"PSOVR"),^TMP($J,"PSOCR") K PSRT W:$E(IOST)="P" @IOF D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","PSOVRPT",46,0)
 .W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOVRPT",47,0)
 ;
"RTN","PSOVRPT",48,0)
HD W:$G(PAGE)'=1!($E(IOST)="C") @IOF W !?29,"NON-VERIFIED PRESCRIPTIONS",!?29,"AS OF "_$G(RDATE),!,?34,"SORTED BY "_$S($G(PSRT)="P":"PATIENT",1:"CLERK")
"RTN","PSOVRPT",49,0)
 I $$DS^PSSDSAPI W !?30,"(# indicates Order Check)"
"RTN","PSOVRPT",50,0)
 E  W !?23,"(# indicates Critical Drug Interaction)"
"RTN","PSOVRPT",51,0)
 W !?3,"Patient name",?70,"Page: ",$G(PAGE),!,"Rx #",?13,"Issued",?23,"Drug" D:$G(PSRT)="C"  W:$G(PSRT)="P" ?70,"Entry By" W !,LINE S PAGE=PAGE+1
"RTN","PSOVRPT",52,0)
 .W ?35,"CLERK-> "_$G(CLNAME)
"RTN","PSOVRPT",53,0)
 Q
"VER")
8.0^22.0
"^DD",52,52,100.1,0)
DISCONTINUE TYPE^S^1:HOSPITAL ADMISSION;2:EDITED BY PROVIDER;^7;1^Q
"^DD",52,52,100.1,3)
Data should not be entered directly with FileMan.
"^DD",52,52,100.1,21,0)
^.001^2^2^3090223^^^^
"^DD",52,52,100.1,21,1,0)
This field is used to distinguish what type of external discontinue
"^DD",52,52,100.1,21,2,0)
action occurred.
"^DD",52,52,100.1,23,0)
^.001^1^1^3090223^^^^
"^DD",52,52,100.1,23,1,0)
set of codes.
"^DD",52,52,100.1,"DT")
3070510
"^DD",52.4,52.4,8,0)
DOSE WARNING^S^0:UNKNOWN;1:DAILY DOSE RANGE;2:MAX SINGLE DOSE;3:MAX SINGLE DOSE & DAILY DOSE RANGE;^1;1^Q
"^DD",52.4,52.4,8,1,0)
^.1^^0
"^DD",52.4,52.4,8,3)
Enter 1 FOR DAILY DOSE RANGE, 2 FOR MAX SINGLE DOSE, OR 3 FOR BOTH.
"^DD",52.4,52.4,8,"DT")
3100304
"^DD",59,59,3.2,0)
RECENTLY DC'D/EXPIRED DAYS^NJ2,0^^1;33^K:+X'=X!(X>45)!(X<7)!(X?.E1"."1N.N) X
"^DD",59,59,3.2,3)
Type a Number between 7 and 45, 0 Decimal Digits
"^DD",59,59,3.2,21,0)
^.001^2^2^3090223^^
"^DD",59,59,3.2,21,1,0)
This field indicates the number of days a discontinued or expired med order
"^DD",59,59,3.2,21,2,0)
appears in reverse video on a patient's med profile.
"^DD",59,59,3.2,"DT")
3070510
**INSTALL NAME**
PSJ*5.0*181
"BLD",7150,0)
PSJ*5.0*181^INPATIENT MEDICATIONS^0^3110113^y
"BLD",7150,1,0)
^^4^4^3080808^^
"BLD",7150,1,1,0)
 
"BLD",7150,1,2,0)
1. Data Dictionary changes:
"BLD",7150,1,3,0)
   Added the "HOURS OF RECENTLY DC/EXPIRED" field (#7) to the INPATIENT
"BLD",7150,1,4,0)
   WARD PARAMETERS file (#59.6).
"BLD",7150,4,0)
^9.64PA^59.6^1
"BLD",7150,4,59.6,0)
59.6
"BLD",7150,4,59.6,2,0)
^9.641^59.6^1
"BLD",7150,4,59.6,2,59.6,0)
INPATIENT WARD PARAMETERS  (File-top level)
"BLD",7150,4,59.6,2,59.6,1,0)
^9.6411^7^1
"BLD",7150,4,59.6,2,59.6,1,7,0)
HOURS OF RECENTLY DC/EXPIRED
"BLD",7150,4,59.6,222)
y^y^p^^^^n^^n
"BLD",7150,4,59.6,224)

"BLD",7150,4,"APDD",59.6,59.6)

"BLD",7150,4,"APDD",59.6,59.6,7)

"BLD",7150,4,"B",59.6,59.6)

"BLD",7150,6.3)
190
"BLD",7150,"ABPKG")
n
"BLD",7150,"KRN",0)
^9.67PA^8989.52^19
"BLD",7150,"KRN",.4,0)
.4
"BLD",7150,"KRN",.4,"NM",0)
^9.68A^^
"BLD",7150,"KRN",.401,0)
.401
"BLD",7150,"KRN",.402,0)
.402
"BLD",7150,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",7150,"KRN",.402,"NM",1,0)
PSJ IWP EDIT    FILE #59.6^59.6^0
"BLD",7150,"KRN",.402,"NM","B","PSJ IWP EDIT    FILE #59.6",1)

"BLD",7150,"KRN",.403,0)
.403
"BLD",7150,"KRN",.5,0)
.5
"BLD",7150,"KRN",.84,0)
.84
"BLD",7150,"KRN",3.6,0)
3.6
"BLD",7150,"KRN",3.8,0)
3.8
"BLD",7150,"KRN",9.2,0)
9.2
"BLD",7150,"KRN",9.8,0)
9.8
"BLD",7150,"KRN",9.8,"NM",0)
^9.68A^104^73
"BLD",7150,"KRN",9.8,"NM",1,0)
PSGFILED^^0^B24429385
"BLD",7150,"KRN",9.8,"NM",2,0)
PSJP^^0^B20677558
"BLD",7150,"KRN",9.8,"NM",4,0)
PSJLMHED^^0^B30170338
"BLD",7150,"KRN",9.8,"NM",5,0)
PSIV^^0^B24224990
"BLD",7150,"KRN",9.8,"NM",6,0)
PSIVPRO^^0^B36988166
"BLD",7150,"KRN",9.8,"NM",7,0)
PSJAC^^0^B14319225
"BLD",7150,"KRN",9.8,"NM",8,0)
PSJHL5^^0^B32301721
"BLD",7150,"KRN",9.8,"NM",9,0)
PSJHL6^^0^B31795642
"BLD",7150,"KRN",9.8,"NM",10,0)
PSJLMPRU^^0^B14487092
"BLD",7150,"KRN",9.8,"NM",11,0)
PSJLMPRI^^0^B19651424
"BLD",7150,"KRN",9.8,"NM",12,0)
PSIVORFB^^0^B61355252
"BLD",7150,"KRN",9.8,"NM",13,0)
PSJADT0^^0^B33159772
"BLD",7150,"KRN",9.8,"NM",14,0)
PSIVOPT^^0^B57204242
"BLD",7150,"KRN",9.8,"NM",16,0)
PSGP^^0^B11885377
"BLD",7150,"KRN",9.8,"NM",17,0)
PSIVACT^^0^B16650605
"BLD",7150,"KRN",9.8,"NM",18,0)
PSJO^^0^B23069149
"BLD",7150,"KRN",9.8,"NM",19,0)
PSJO1^^0^B32562541
"BLD",7150,"KRN",9.8,"NM",20,0)
PSIVUTL^^0^B28169331
"BLD",7150,"KRN",9.8,"NM",21,0)
PSGO^^0^B25195352
"BLD",7150,"KRN",9.8,"NM",23,0)
PSGOU^^0^B31799973
"BLD",7150,"KRN",9.8,"NM",26,0)
PSIVOPT2^^0^B36149205
"BLD",7150,"KRN",9.8,"NM",27,0)
PSJGMRA^^0^B17486425
"BLD",7150,"KRN",9.8,"NM",29,0)
PSGSICHK^^0^B80627011
"BLD",7150,"KRN",9.8,"NM",30,0)
PSJOC^^0^B19432161
"BLD",7150,"KRN",9.8,"NM",31,0)
PSJLIFN^^0^B28386650
"BLD",7150,"KRN",9.8,"NM",33,0)
PSJMISC^^0^B44078587
"BLD",7150,"KRN",9.8,"NM",34,0)
PSIVORC1^^0^B45810564
"BLD",7150,"KRN",9.8,"NM",39,0)
PSJMON^^0^B33274000
"BLD",7150,"KRN",9.8,"NM",40,0)
PSIVEDT^^0^B49813774
"BLD",7150,"KRN",9.8,"NM",41,0)
PSIVOC^^0^B12227272
"BLD",7150,"KRN",9.8,"NM",42,0)
PSJBLDOC^^0^B34049037
"BLD",7150,"KRN",9.8,"NM",43,0)
PSIVEDRG^^0^B44643985
"BLD",7150,"KRN",9.8,"NM",44,0)
PSJLIACT^^0^B42251773
"BLD",7150,"KRN",9.8,"NM",45,0)
PSJOCDI^^0^B82259996
"BLD",7150,"KRN",9.8,"NM",46,0)
PSJOCDT^^0^B28304577
"BLD",7150,"KRN",9.8,"NM",47,0)
PSJOCDS^^0^B61757941
"BLD",7150,"KRN",9.8,"NM",49,0)
PSJRXI^^0^B11564101
"BLD",7150,"KRN",9.8,"NM",50,0)
PSJOCOR^^0^B3349794
"BLD",7150,"KRN",9.8,"NM",51,0)
PSJOCDC^^0^B1499223
"BLD",7150,"KRN",9.8,"NM",52,0)
PSJHVARS^^0^B74499296
"BLD",7150,"KRN",9.8,"NM",53,0)
PSJLIFNI^^0^B11257196
"BLD",7150,"KRN",9.8,"NM",58,0)
PSJCOMR^^0^B75920625
"BLD",7150,"KRN",9.8,"NM",59,0)
PSGOD^^0^B21325344
"BLD",7150,"KRN",9.8,"NM",64,0)
PSJOCERR^^0^B3747914
"BLD",7150,"KRN",9.8,"NM",67,0)
PSIVOCDS^^0^B112584128
"BLD",7150,"KRN",9.8,"NM",68,0)
PSJOCDSD^^0^B19852742
"BLD",7150,"KRN",9.8,"NM",69,0)
PSIVORE^^0^B42579774
"BLD",7150,"KRN",9.8,"NM",70,0)
PSIVOD^^0^B13557709
"BLD",7150,"KRN",9.8,"NM",71,0)
PSJLMUT1^^0^B67028323
"BLD",7150,"KRN",9.8,"NM",72,0)
PSJOE^^0^B83867833
"BLD",7150,"KRN",9.8,"NM",73,0)
PSJOE1^^0^B27457189
"BLD",7150,"KRN",9.8,"NM",74,0)
PSGOE^^0^B26201410
"BLD",7150,"KRN",9.8,"NM",75,0)
PSGOE7^^0^B19204515
"BLD",7150,"KRN",9.8,"NM",76,0)
PSGOE82^^0^B20946655
"BLD",7150,"KRN",9.8,"NM",77,0)
PSGOEC^^0^B67778509
"BLD",7150,"KRN",9.8,"NM",78,0)
PSGOECS^^0^B48391335
"BLD",7150,"KRN",9.8,"NM",79,0)
PSGOEE^^0^B73215103
"BLD",7150,"KRN",9.8,"NM",81,0)
PSGOEF^^0^B92772116
"BLD",7150,"KRN",9.8,"NM",83,0)
PSGOES^^0^B21797415
"BLD",7150,"KRN",9.8,"NM",84,0)
PSGOESF^^0^B31588811
"BLD",7150,"KRN",9.8,"NM",88,0)
PSJLMUDE^^0^B62710638
"BLD",7150,"KRN",9.8,"NM",92,0)
PSGSETU^^0^B13243102
"BLD",7150,"KRN",9.8,"NM",93,0)
PSJOCVAR^^0^B55813758
"BLD",7150,"KRN",9.8,"NM",94,0)
PSJAPIDS^^0^B29473329
"BLD",7150,"KRN",9.8,"NM",95,0)
PSIVOPT1^^0^B44616556
"BLD",7150,"KRN",9.8,"NM",96,0)
PSIVORC2^^0^B56200056
"BLD",7150,"KRN",9.8,"NM",98,0)
PSGOEF1^^0^B29780196
"BLD",7150,"KRN",9.8,"NM",99,0)
PSGOER^^0^B79614016
"BLD",7150,"KRN",9.8,"NM",100,0)
PSGOER0^^0^B22183476
"BLD",7150,"KRN",9.8,"NM",101,0)
PSGOERI^^0^B17021979
"BLD",7150,"KRN",9.8,"NM",102,0)
PSJLIVFD^^0^B39326819
"BLD",7150,"KRN",9.8,"NM",103,0)
PSJMISC2^^0^B11318290
"BLD",7150,"KRN",9.8,"NM",104,0)
PSJHLU^^0^B34870321
"BLD",7150,"KRN",9.8,"NM","B","PSGFILED",1)

"BLD",7150,"KRN",9.8,"NM","B","PSGO",21)

"BLD",7150,"KRN",9.8,"NM","B","PSGOD",59)

"BLD",7150,"KRN",9.8,"NM","B","PSGOE",74)

"BLD",7150,"KRN",9.8,"NM","B","PSGOE7",75)

"BLD",7150,"KRN",9.8,"NM","B","PSGOE82",76)

"BLD",7150,"KRN",9.8,"NM","B","PSGOEC",77)

"BLD",7150,"KRN",9.8,"NM","B","PSGOECS",78)

"BLD",7150,"KRN",9.8,"NM","B","PSGOEE",79)

"BLD",7150,"KRN",9.8,"NM","B","PSGOEF",81)

"BLD",7150,"KRN",9.8,"NM","B","PSGOEF1",98)

"BLD",7150,"KRN",9.8,"NM","B","PSGOER",99)

"BLD",7150,"KRN",9.8,"NM","B","PSGOER0",100)

"BLD",7150,"KRN",9.8,"NM","B","PSGOERI",101)

"BLD",7150,"KRN",9.8,"NM","B","PSGOES",83)

"BLD",7150,"KRN",9.8,"NM","B","PSGOESF",84)

"BLD",7150,"KRN",9.8,"NM","B","PSGOU",23)

"BLD",7150,"KRN",9.8,"NM","B","PSGP",16)

"BLD",7150,"KRN",9.8,"NM","B","PSGSETU",92)

"BLD",7150,"KRN",9.8,"NM","B","PSGSICHK",29)

"BLD",7150,"KRN",9.8,"NM","B","PSIV",5)

"BLD",7150,"KRN",9.8,"NM","B","PSIVACT",17)

"BLD",7150,"KRN",9.8,"NM","B","PSIVEDRG",43)

"BLD",7150,"KRN",9.8,"NM","B","PSIVEDT",40)

"BLD",7150,"KRN",9.8,"NM","B","PSIVOC",41)

"BLD",7150,"KRN",9.8,"NM","B","PSIVOCDS",67)

"BLD",7150,"KRN",9.8,"NM","B","PSIVOD",70)

"BLD",7150,"KRN",9.8,"NM","B","PSIVOPT",14)

"BLD",7150,"KRN",9.8,"NM","B","PSIVOPT1",95)

"BLD",7150,"KRN",9.8,"NM","B","PSIVOPT2",26)

"BLD",7150,"KRN",9.8,"NM","B","PSIVORC1",34)

"BLD",7150,"KRN",9.8,"NM","B","PSIVORC2",96)

"BLD",7150,"KRN",9.8,"NM","B","PSIVORE",69)

"BLD",7150,"KRN",9.8,"NM","B","PSIVORFB",12)

"BLD",7150,"KRN",9.8,"NM","B","PSIVPRO",6)

"BLD",7150,"KRN",9.8,"NM","B","PSIVUTL",20)

"BLD",7150,"KRN",9.8,"NM","B","PSJAC",7)

"BLD",7150,"KRN",9.8,"NM","B","PSJADT0",13)

"BLD",7150,"KRN",9.8,"NM","B","PSJAPIDS",94)

"BLD",7150,"KRN",9.8,"NM","B","PSJBLDOC",42)

"BLD",7150,"KRN",9.8,"NM","B","PSJCOMR",58)

"BLD",7150,"KRN",9.8,"NM","B","PSJGMRA",27)

"BLD",7150,"KRN",9.8,"NM","B","PSJHL5",8)

"BLD",7150,"KRN",9.8,"NM","B","PSJHL6",9)

"BLD",7150,"KRN",9.8,"NM","B","PSJHLU",104)

"BLD",7150,"KRN",9.8,"NM","B","PSJHVARS",52)

"BLD",7150,"KRN",9.8,"NM","B","PSJLIACT",44)

"BLD",7150,"KRN",9.8,"NM","B","PSJLIFN",31)

"BLD",7150,"KRN",9.8,"NM","B","PSJLIFNI",53)

"BLD",7150,"KRN",9.8,"NM","B","PSJLIVFD",102)

"BLD",7150,"KRN",9.8,"NM","B","PSJLMHED",4)

"BLD",7150,"KRN",9.8,"NM","B","PSJLMPRI",11)

"BLD",7150,"KRN",9.8,"NM","B","PSJLMPRU",10)

"BLD",7150,"KRN",9.8,"NM","B","PSJLMUDE",88)

"BLD",7150,"KRN",9.8,"NM","B","PSJLMUT1",71)

"BLD",7150,"KRN",9.8,"NM","B","PSJMISC",33)

"BLD",7150,"KRN",9.8,"NM","B","PSJMISC2",103)

"BLD",7150,"KRN",9.8,"NM","B","PSJMON",39)

"BLD",7150,"KRN",9.8,"NM","B","PSJO",18)

"BLD",7150,"KRN",9.8,"NM","B","PSJO1",19)

"BLD",7150,"KRN",9.8,"NM","B","PSJOC",30)

"BLD",7150,"KRN",9.8,"NM","B","PSJOCDC",51)

"BLD",7150,"KRN",9.8,"NM","B","PSJOCDI",45)

"BLD",7150,"KRN",9.8,"NM","B","PSJOCDS",47)

"BLD",7150,"KRN",9.8,"NM","B","PSJOCDSD",68)

"BLD",7150,"KRN",9.8,"NM","B","PSJOCDT",46)

"BLD",7150,"KRN",9.8,"NM","B","PSJOCERR",64)

"BLD",7150,"KRN",9.8,"NM","B","PSJOCOR",50)

"BLD",7150,"KRN",9.8,"NM","B","PSJOCVAR",93)

"BLD",7150,"KRN",9.8,"NM","B","PSJOE",72)

"BLD",7150,"KRN",9.8,"NM","B","PSJOE1",73)

"BLD",7150,"KRN",9.8,"NM","B","PSJP",2)

"BLD",7150,"KRN",9.8,"NM","B","PSJRXI",49)

"BLD",7150,"KRN",19,0)
19
"BLD",7150,"KRN",19,"NM",0)
^9.68A^^0
"BLD",7150,"KRN",19.1,0)
19.1
"BLD",7150,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",7150,"KRN",101,0)
101
"BLD",7150,"KRN",101,"NM",0)
^9.68A^24^3
"BLD",7150,"KRN",101,"NM",1,0)
PSJ LM PROFILE HIDDEN ACTIONS^^2
"BLD",7150,"KRN",101,"NM",23,0)
PSJ LM PHARMACY INTERVENTION MENU^^3^
"BLD",7150,"KRN",101,"NM",24,0)
PSJ LM ORDER VIEW HIDDEN ACTIONS^^2
"BLD",7150,"KRN",101,"NM","B","PSJ LM ORDER VIEW HIDDEN ACTIONS",24)

"BLD",7150,"KRN",101,"NM","B","PSJ LM PHARMACY INTERVENTION MENU",23)

"BLD",7150,"KRN",101,"NM","B","PSJ LM PROFILE HIDDEN ACTIONS",1)

"BLD",7150,"KRN",409.61,0)
409.61
"BLD",7150,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",7150,"KRN",771,0)
771
"BLD",7150,"KRN",870,0)
870
"BLD",7150,"KRN",8989.51,0)
8989.51
"BLD",7150,"KRN",8989.52,0)
8989.52
"BLD",7150,"KRN",8994,0)
8994
"BLD",7150,"KRN","B",.4,.4)

"BLD",7150,"KRN","B",.401,.401)

"BLD",7150,"KRN","B",.402,.402)

"BLD",7150,"KRN","B",.403,.403)

"BLD",7150,"KRN","B",.5,.5)

"BLD",7150,"KRN","B",.84,.84)

"BLD",7150,"KRN","B",3.6,3.6)

"BLD",7150,"KRN","B",3.8,3.8)

"BLD",7150,"KRN","B",9.2,9.2)

"BLD",7150,"KRN","B",9.8,9.8)

"BLD",7150,"KRN","B",19,19)

"BLD",7150,"KRN","B",19.1,19.1)

"BLD",7150,"KRN","B",101,101)

"BLD",7150,"KRN","B",409.61,409.61)

"BLD",7150,"KRN","B",771,771)

"BLD",7150,"KRN","B",870,870)

"BLD",7150,"KRN","B",8989.51,8989.51)

"BLD",7150,"KRN","B",8989.52,8989.52)

"BLD",7150,"KRN","B",8994,8994)

"BLD",7150,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",7150,"QUES",0)
^9.62^^
"BLD",7150,"REQB",0)
^9.611^24^16
"BLD",7150,"REQB",1,0)
PSJ*5.0*60^2
"BLD",7150,"REQB",2,0)
PSJ*5.0*98^2
"BLD",7150,"REQB",3,0)
PSJ*5.0*137^2
"BLD",7150,"REQB",5,0)
PSJ*5.0*147^2
"BLD",7150,"REQB",6,0)
PSJ*5.0*148^2
"BLD",7150,"REQB",7,0)
PSJ*5.0*149^2
"BLD",7150,"REQB",9,0)
PSJ*5.0*155^2
"BLD",7150,"REQB",10,0)
PSJ*5.0*162^2
"BLD",7150,"REQB",11,0)
PSJ*5.0*168^2
"BLD",7150,"REQB",13,0)
PSJ*5.0*186^2
"BLD",7150,"REQB",14,0)
PSJ*5.0*198^2
"BLD",7150,"REQB",17,0)
PSJ*5.0*221^2
"BLD",7150,"REQB",18,0)
PSJ*5.0*161^2
"BLD",7150,"REQB",22,0)
PSJ*5.0*184^2
"BLD",7150,"REQB",23,0)
PSJ*5.0*185^2
"BLD",7150,"REQB",24,0)
PSJ*5.0*179^2
"BLD",7150,"REQB","B","PSJ*5.0*137",3)

"BLD",7150,"REQB","B","PSJ*5.0*147",5)

"BLD",7150,"REQB","B","PSJ*5.0*148",6)

"BLD",7150,"REQB","B","PSJ*5.0*149",7)

"BLD",7150,"REQB","B","PSJ*5.0*155",9)

"BLD",7150,"REQB","B","PSJ*5.0*161",18)

"BLD",7150,"REQB","B","PSJ*5.0*162",10)

"BLD",7150,"REQB","B","PSJ*5.0*168",11)

"BLD",7150,"REQB","B","PSJ*5.0*179",24)

"BLD",7150,"REQB","B","PSJ*5.0*184",22)

"BLD",7150,"REQB","B","PSJ*5.0*185",23)

"BLD",7150,"REQB","B","PSJ*5.0*186",13)

"BLD",7150,"REQB","B","PSJ*5.0*198",14)

"BLD",7150,"REQB","B","PSJ*5.0*221",17)

"BLD",7150,"REQB","B","PSJ*5.0*60",1)

"BLD",7150,"REQB","B","PSJ*5.0*98",2)

"FIA",59.6)
INPATIENT WARD PARAMETERS
"FIA",59.6,0)
^PS(59.6,
"FIA",59.6,0,0)
59.6P
"FIA",59.6,0,1)
y^y^p^^^^n^^n
"FIA",59.6,0,10)

"FIA",59.6,0,11)

"FIA",59.6,0,"RLRO")

"FIA",59.6,0,"VR")
5.0^PSJ
"FIA",59.6,59.6)
1
"FIA",59.6,59.6,7)

"KRN",.402,1356,-1)
0^1
"KRN",.402,1356,0)
PSJ IWP EDIT^3070306.1545^ ^59.6^^^3100824
"KRN",.402,1356,"%D",0)
^^3^3^3090619^
"KRN",.402,1356,"%D",1,0)
  Used by the Inpatient Medications package to allow the Inpatient
"KRN",.402,1356,"%D",2,0)
Supervisor to tailor various aspects of the package on a ward-by-ward
"KRN",.402,1356,"%D",3,0)
basis.
"KRN",.402,1356,"DR",1,59.6)
.03;S X="";3;.04;.07;.05;.08;7;.12;.19;.16;.2;.15;.18;.11;1;2;.24;4;5;6;
"KRN",101,3918,-1)
3^23
"KRN",101,3918,0)
PSJ LM PHARMACY INTERVENTION MENU^Intervention Menu^^M^^PSJ RPHARM^^^^^^INPATIENT MEDICATIONS
"KRN",101,3918,1,0)
^^1^1^2960403^^^^
"KRN",101,3918,1,1,0)
This is the main menu for the Pharmacy Intervention options.
"KRN",101,3918,4)
40
"KRN",101,3918,10,0)
^101.01PA^15^15
"KRN",101,3918,15)
S VALMBCK="R"
"KRN",101,3918,99)
61303,45802
"KRN",101,3938,-1)
2^1
"KRN",101,3938,0)
PSJ LM PROFILE HIDDEN ACTIONS^Profile Hidden Actions Menu^^M^20131^^^^^^^197
"KRN",101,3938,10,0)
^101.01PA^29^29
"KRN",101,3938,10,29,0)
3918^IN^^
"KRN",101,3938,10,29,"^")
PSJ LM PHARMACY INTERVENTION MENU
"KRN",101,3939,-1)
2^24
"KRN",101,3939,0)
PSJ LM ORDER VIEW HIDDEN ACTIONS^Order View Hidden Actions Menu^^M^20131^^^^^^^197
"KRN",101,3939,10,0)
^101.01PA^28^28
"KRN",101,3939,10,28,0)
3918^IN^^
"KRN",101,3939,10,28,"^")
PSJ LM PHARMACY INTERVENTION MENU
"MBREQ")
1
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
181^3110113^20131
"PKG",197,22,1,"PAH",1,1,0)
^^4^4^3110113
"PKG",197,22,1,"PAH",1,1,1,0)
 
"PKG",197,22,1,"PAH",1,1,2,0)
1. Data Dictionary changes:
"PKG",197,22,1,"PAH",1,1,3,0)
   Added the "HOURS OF RECENTLY DC/EXPIRED" field (#7) to the INPATIENT
"PKG",197,22,1,"PAH",1,1,4,0)
   WARD PARAMETERS file (#59.6).
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
73
"RTN","PSGFILED")
0^1^B24429385
"RTN","PSGFILED",1,0)
PSGFILED ;BIR/CML3-VARIOUS FILES' UPKEEP ;16 Mar 99 / 10:22 AM
"RTN","PSGFILED",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**20,50,63,119,110,111,112,154,184,181**;16 DEC 97;Build 190
"RTN","PSGFILED",3,0)
 ;
"RTN","PSGFILED",4,0)
 ; Reference to ^PS(50.606 supported by DBIA# 2174.
"RTN","PSGFILED",5,0)
 ; Reference to ^PSDRUG supported by DBIA# 2192.
"RTN","PSGFILED",6,0)
 ; Reference to ^PS(59.7 is supported by DBIA# 2181.
"RTN","PSGFILED",7,0)
 ; Reference to ^PS(51 is supported by DBIA# 2176.
"RTN","PSGFILED",8,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSGFILED",9,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGFILED",10,0)
 ;
"RTN","PSGFILED",11,0)
DONE D ENKV^PSGSETU K D0,D1,D2,PSGRBS Q
"RTN","PSGFILED",12,0)
 ;
"RTN","PSGFILED",13,0)
GED ; generic edit
"RTN","PSGFILED",14,0)
 S DA=+Y,DR=".01;1" W ! D ^DIE Q
"RTN","PSGFILED",15,0)
 ;
"RTN","PSGFILED",16,0)
ENAT ; team file
"RTN","PSGFILED",17,0)
 F  S DIC="^PS(57.7,",DIC(0)="QEAMIL",DLAYGO=57.7,DIC("A")="Select WARD: " W ! D ^DIC K DIC,DLAYGO Q:Y'>0  S DA=+Y,DIE="^PS(57.7,",DR="[PSJUMATE]" D ^DIE
"RTN","PSGFILED",18,0)
 G DONE
"RTN","PSGFILED",19,0)
 ;
"RTN","PSGFILED",20,0)
ENAS ; schedules file - no longer used
"RTN","PSGFILED",21,0)
 ;
"RTN","PSGFILED",22,0)
ENMR ; med route file
"RTN","PSGFILED",23,0)
 NEW MRNO,MR K DIE,DIC,DR,Y
"RTN","PSGFILED",24,0)
 F  S DIC="^PS(51.2,",DIC(0)="QEAMIL",DLAYGO=51.2 W ! D ^DIC K DIC,DLAYGO Q:+Y'>0  S MRNO=+Y,MR=$P(Y,U,2),DA=+Y,DIE="^PS(51.2,",DR=".01;1;3;4" D ^DIE D DF
"RTN","PSGFILED",25,0)
 G DONE
"RTN","PSGFILED",26,0)
 ;
"RTN","PSGFILED",27,0)
ENWG ; ward group file
"RTN","PSGFILED",28,0)
 F  S DIC="^PS(57.5,",DIC(0)="QEAMIL",DLAYGO=57.5 W ! D ^DIC K DA,DIC,DR Q:+Y'>0  S DA=+Y,DIE="^PS(57.5,",DR="[PSJU WG]" D ^DIE
"RTN","PSGFILED",29,0)
 G DONE
"RTN","PSGFILED",30,0)
 ;
"RTN","PSGFILED",31,0)
ENMI ; medication instruction file
"RTN","PSGFILED",32,0)
 F  S DIC="^PS(51,",DIC(0)="QEAMIL",DLAYGO=51 W ! D ^DIC K DIC Q:+Y'>0  S DIE="^PS(51,",DA=+Y,DR=".01;1;30" D ^DIE
"RTN","PSGFILED",33,0)
 G DONE
"RTN","PSGFILED",34,0)
 ;
"RTN","PSGFILED",35,0)
ENDRG ; standard drug fields
"RTN","PSGFILED",36,0)
 D NOW^%DTC S PSGDT=% F  S DIC="^PSDRUG(",DIC(0)="AEIMOQ",DIC("A")="Select DISPENSE DRUG: " W ! D ^DIC K DIC Q:+Y'>0  D DE
"RTN","PSGFILED",37,0)
 K PSIUA,PSIUDA,PSIUX G DONE
"RTN","PSGFILED",38,0)
 ;
"RTN","PSGFILED",39,0)
DE ;
"RTN","PSGFILED",40,0)
 I $D(^PSDRUG(+Y,"I")),^("I"),^("I")<PSGDT W $C(7),$C(7),!!?3,"*** WARNING, THIS DRUG IS INACTIVE. ***",!
"RTN","PSGFILED",41,0)
 W ! S DIE="^PSDRUG(",(DA,PSIUDA)=+Y,DR="[PSJ FILED]"
"RTN","PSGFILED",42,0)
 S PSIUX="U^UNIT DOSE PHARMACY^1" D ^PSGIU,^DIE:PSIUA'["^" K DA,DIE,DR Q
"RTN","PSGFILED",43,0)
 ;
"RTN","PSGFILED",44,0)
ENOSE ; order set enter/edit
"RTN","PSGFILED",45,0)
 K DIC F  S DLAYGO=53.2,DIC="^PS(53.2,",DIC(0)="QEAML",DIC("A")="Select ORDER SET: " W ! D ^DIC K DIC Q:Y'>0  S DA=+Y S DIE="^PS(53.2,",DR="[PSJUOSE]" D ^DIE K D0,D1,DA,DIE,DR,PSGNEDFD,PSGS0XT,PSGS0Y
"RTN","PSGFILED",46,0)
 G DONE
"RTN","PSGFILED",47,0)
 ;
"RTN","PSGFILED",48,0)
RBCHK ; used to validate room-bed
"RTN","PSGFILED",49,0)
 ;No longer used.
"RTN","PSGFILED",50,0)
 ;F Z0=0:0 S Z0=$O(^PS(57.7,DA(2),1,Z0)) Q:'Z0  I Z0'=DA(1),$D(^(Z0,1,"B",X)) W !?19,X," is already under ",$S('$D(^PS(57.7,DA(2),1,Z0,0)):"another team ("_Z0_")!",$P(^(0),"^")]"":$P(^(0),"^")_"!",1:"another team ("_Z0_")!") Q
"RTN","PSGFILED",51,0)
 ;I 'Z0,$D(^DIC(42,DA(2),2,+$O(^DIC(42,DA(2),2,"B",$P(X,"-"),0)),1,"B",$P(X,"-",2))) K Z0 Q
"RTN","PSGFILED",52,0)
 ;K X,Z0 Q
"RTN","PSGFILED",53,0)
 ;
"RTN","PSGFILED",54,0)
RBQ ; show room-beds for a ward
"RTN","PSGFILED",55,0)
 ;No longer used.
"RTN","PSGFILED",56,0)
 Q
"RTN","PSGFILED",57,0)
 ;
"RTN","PSGFILED",58,0)
RBNP W """^"" TO STOP: " R Z3:DTIME W:'$T $C(7) S:'$T Z3="^" W $C(13),"            ",$C(13) Q
"RTN","PSGFILED",59,0)
 ;
"RTN","PSGFILED",60,0)
ENPPD ; edit pharmacy patient data
"RTN","PSGFILED",61,0)
 ; W !!?3,"...This option is still under development...",! Q
"RTN","PSGFILED",62,0)
 ;
"RTN","PSGFILED",63,0)
ENCPDD ; edit patient's default stop date (wall)
"RTN","PSGFILED",64,0)
 D ENCV^PSGSETU I $D(XQUIT) Q
"RTN","PSGFILED",65,0)
 F  D ENAO^PSGGAO Q:PSGP'>0  D
"RTN","PSGFILED",66,0)
 .S WDN=$P($G(^DPT(PSGP,.1)),"^") W:WDN="" !!?2,"The patient is not currently on a ward."
"RTN","PSGFILED",67,0)
 .I WDN]"" S WD=$O(^DIC(42,"B",WDN,0)),WD=$O(^PS(59.6,"B",+WD,0)) I $S('WD:1,1:'$P($G(^PS(59.6,WD,0)),"^",4)) S X="PLEASE NOTE: The 'SAME STOP DATE' parameter for the ward ("_WDN_") is not turned on.  Any date entered here will be ignored "
"RTN","PSGFILED",68,0)
 .I  S X=X_"until the parameter is turned on for this ward." W $C(7),!!?2 F Y=1:1:$L(X," ") S X(1)=$P(X," ",Y) W:$L(X(1))+$X>78 ! W X(1)," "
"RTN","PSGFILED",69,0)
 .S DA=PSGP,DR="62.01T",DIE="^PS(55," W !! D ^DIE
"RTN","PSGFILED",70,0)
 K WD,WDN G DONE
"RTN","PSGFILED",71,0)
 ;
"RTN","PSGFILED",72,0)
ENSYS ; edit system file
"RTN","PSGFILED",73,0)
 ;/S DIE="^PS(59.7,",DA=1,DR="21;26;26.3;26.4;26.2;20.412ALLOW THE CHANGE OF ORDER TYPES ON ORDERS FROM OERR;32"
"RTN","PSGFILED",74,0)
 S DIE="^PS(59.7,",DA=1,DR="21;26;26.3;26.4;26.2;26.5;26.6;26.7;26.8;34;27;27.1"
"RTN","PSGFILED",75,0)
 W ! D ^DIE K DIE,DA,DR Q
"RTN","PSGFILED",76,0)
 ;
"RTN","PSGFILED",77,0)
ENPLSP ; edit pick list site parameters
"RTN","PSGFILED",78,0)
 ;
"RTN","PSGFILED",79,0)
ENCS ; change current site & parameters
"RTN","PSGFILED",80,0)
 I $D(PSJSYSW0)#2 W !!,"Current site: ",$P(PSJSYSW0,"^")
"RTN","PSGFILED",81,0)
 S PSGCSF=1 D ^PSGSET,ENKV^PSGSETU W:$D(XQUIT) !!?5,"(The Inpatient site you are currently working under has not changed.)" K PSGCSF,PSGORSET,XQUIT Q
"RTN","PSGFILED",82,0)
 ;
"RTN","PSGFILED",83,0)
DF ; Add/edit Med route, instruction... to the Dosage form file.
"RTN","PSGFILED",84,0)
 S DIR("A")="Would you like to update the Dosage Form file"
"RTN","PSGFILED",85,0)
 S DIR("?")="If your answer is Yes, you will be able to Add/edit the Med routes, Instructions, Verb, Noun and Preposition that associate with this Dosage form."
"RTN","PSGFILED",86,0)
 S DIR(0)="Y",DIR("B")="Y" D ^DIR Q:Y'=1
"RTN","PSGFILED",87,0)
 NEW Y,DFNO K DIE,DIC,DA,DR
"RTN","PSGFILED",88,0)
 F  S DIC="^PS(50.606,",DIC(0)="QEAMI" D ^DIC Q:+Y'>0  S DFNO=+Y D
"RTN","PSGFILED",89,0)
 . I $G(MR)]"",'$D(^PS(50.606,DFNO,"MR","B",MRNO)) S DIE="^PS(50.606,",DR="1///"_MR,DA=DFNO D ^DIE
"RTN","PSGFILED",90,0)
 . K DIE,DIC,DR,MR S DIE="^PS(50.606,",DR="1;3;4;5",DA=DFNO D ^DIE
"RTN","PSGFILED",91,0)
 ;. K DIE,DIC,DR,MR S DIE="^PS(50.606,",DR="1;2;3;4;5",DA=DFNO D ^DIE
"RTN","PSGFILED",92,0)
 Q
"RTN","PSGFILED",93,0)
ENCD ;edit Clinic Definitions file
"RTN","PSGFILED",94,0)
 F  K DIC S DIC="^PS(53.46,",DIC(0)="AELMQ",DIC("A")="Select CLINIC: ",DLAYGO=53.46 D ^DIC K DIC Q:Y<0  D
"RTN","PSGFILED",95,0)
 . S DIE="^PS(53.46,",DA=+Y,DR="1;2;3" D ^DIE K DIE,DA,DR Q
"RTN","PSGFILED",96,0)
 Q
"RTN","PSGFILED",97,0)
ENCG ; ward group file0
"RTN","PSGFILED",98,0)
 F  S DIC="^PS(57.8,",DIC(0)="QEAMIL",DLAYGO=57.8 W ! D ^DIC K DA,DIC,DR Q:+Y'>0  S DA=+Y,DIE="^PS(57.8,",DR=".01;1" D ^DIE
"RTN","PSGFILED",99,0)
 G DONE
"RTN","PSGFILED",100,0)
 ;
"RTN","PSGO")
0^21^B25195352
"RTN","PSGO",1,0)
PSGO ;BIR/CML3,MV-PRINTS PATIENT'S ORDERS ;10 Feb 98 / 1:32 PM
"RTN","PSGO",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**4,58,110,181**;16 DEC 97;Build 190
"RTN","PSGO",3,0)
 ;
"RTN","PSGO",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGO",5,0)
 ;
"RTN","PSGO",6,0)
 K ^TMP("PSJON",$J),PSGONF S PSGOH="U N I T   D O S E   P R O F I L E" D ENGORD^PSGOU
"RTN","PSGO",7,0)
 ;
"RTN","PSGO",8,0)
EN ;
"RTN","PSGO",9,0)
 S CML=IO'=IO(0)!($E(IOST,1,2)'="C-"),NP="" N RB
"RTN","PSGO",10,0)
 U IO D GET I '$D(^TMP("PSG",$J)) W !,SLS,SLS,$E(SLS,1,24),!?22,"NO ORDERS FOUND" W:"SL"[PSGOL " FOR A ",$S(PSGOL="S":"SHORT",1:"LONG")," PROFILE."
"RTN","PSGO",11,0)
 G:NP["^" DONE
"RTN","PSGO",12,0)
 E  S (C,DRG)="",LD=0
"RTN","PSGO",13,0)
 E  D DRG G:NP["^" DONE
"RTN","PSGO",14,0)
 I CML,$S('$D(PSGPRP):1,1:PSGPRP="P") D BOT
"RTN","PSGO",15,0)
 ;
"RTN","PSGO",16,0)
DONE ;
"RTN","PSGO",17,0)
 I $S('$D(PSGPRP):1,1:PSGPRP="P") K ^TMP("PSG",$J)
"RTN","PSGO",18,0)
 S PSGON=$S('CML:ON,1:0) K:'$D(PSGVBW) PSGODT
"RTN","PSGO",19,0)
 ;
"RTN","PSGO",20,0)
D1 ;
"RTN","PSGO",21,0)
 K C,CML,DN,DO,DRG,F,GIVE,HDT,LN2,NF,ND,ND4,ND6,NP,O,ON,PF,PG,PSGHD,PSGOH,PSJTEAM,RCT,RF,RTE,S,SCH,SD,SLS,SM,ST,STS,TF,UDU,V,WD,WS,WT Q
"RTN","PSGO",22,0)
 ;
"RTN","PSGO",23,0)
DRG ;
"RTN","PSGO",24,0)
 I PSGOL'="N" F  S C=$O(^TMP("PSG",$J,C)) Q:C=""!(NP["^")  D:$S(C="BA":1,C="CC":1,C="CD":1,C["C":TF,1:1) TF F ST="C","O","OC","P","R","z" D
"RTN","PSGO",25,0)
 .F  S DRG=$O(^TMP("PSG",$J,C,ST,DRG)) Q:DRG=""!(NP["^")  S NF=^(DRG),O=$P(DRG,"^",2),DN=$P(DRG,"^") D:$Y+4>IOSL NP Q:NP["^"  D P
"RTN","PSGO",26,0)
 I PSGOL="N" F  S LD=$O(^TMP("PSG",$J,LD)) Q:'LD  S X=^(LD),NF=$P(X,U),C=$P(X,U,2),ST=$P(X,U,3),DN=$P(X,U,4),O=$P(LD,U,2) D P
"RTN","PSGO",27,0)
 Q
"RTN","PSGO",28,0)
 ;
"RTN","PSGO",29,0)
P ;Display drug data stored in ^TMP("PSG",$J
"RTN","PSGO",30,0)
 S ON=ON+1 I 'CML S ^TMP("PSJON",$J,ON)=+O_$S(C["CD":"",C["C":"P",C["BD":"",C["B":"P",1:"U") S:C'["O" PSGONC=ON
"RTN","PSGO",31,0)
 Q:PSGOL="N"
"RTN","PSGO",32,0)
 W !,$J(ON,4),?5
"RTN","PSGO",33,0)
 I C["CD" N PSJO,OO S PSJO=O,OO=0 F  S OO=$O(^PS(53.1,"ACX",PSJO,OO)) Q:'OO  S O=OO D P2 W !
"RTN","PSGO",34,0)
 I C["BD" N PSJO,OO S PSJO=O,OO=0 F  S OO=$O(^PS(53.1,"ACX",PSJO,OO)) Q:'OO  S O=OO D P2 W !
"RTN","PSGO",35,0)
 Q:C["BD"  Q:C["CD" 
"RTN","PSGO",36,0)
 ; naked references below refer to full reference inside indirection @(F_+O_".0)" for either file 53.1 or 55
"RTN","PSGO",37,0)
P2 S ND=$G(@(F_+O_",0)")),SCH=$G(^(2)),ND4=$G(^(4)),ND6=$G(^(6)),DO=$G(^(.2))
"RTN","PSGO",38,0)
 I C="A",PSJSYSU,'$P(ND4,"^",+PSJSYSU),$P(ND4,"^",+PSJSYSU=1+9) S PSGONV=ON
"RTN","PSGO",39,0)
 I C="A"!(C="O") S:$P(ND,"^",9)'="H"&'CML PSGONR=ON D
"RTN","PSGO",40,0)
 .S V='$P(ND4,"^",UDU),V=$S(+PSJSYSU=1&V:1,+PSJSYSU=3&V:1,1:0)
"RTN","PSGO",41,0)
 .W $S(ND4="":" ",$P(ND4,"^",12):"D",V!$P(ND4,"^",19)&$P(ND4,"^",18):"H",V!$P(ND4,"^",23)&$P(ND4,"^",22):"H",V!$P(ND4,"^",16)&$P(ND4,"^",15):"R",1:" ")
"RTN","PSGO",42,0)
 .W $S($P(DO,U,4)="D":"d",1:" ")_$S(V:"->",1:"  ")
"RTN","PSGO",43,0)
 ;I C="CA"!(C["B") W $S($P(ND4,"^",12):"D",1:" "),$S(PSJSYSU:"->",1:"") I C["B" S PSGONF=$S('$G(PSGONF):ON_U_ON,1:+PSGONF_U_ON)
"RTN","PSGO",44,0)
 I C="CA"!(C["B") W $S($P(ND4,"^",12):"D",1:" ") I C["B" S PSGONF=$S('$G(PSGONF):ON_U_ON,1:+PSGONF_U_ON)
"RTN","PSGO",45,0)
 S SM=2-$S('$P(ND,"^",5):2,1:$P(ND,"^",6)),STS=$S($P(ND,U,28)]"":$P(ND,U,28),$P(ND,"^",9)]"":$P(ND,"^",9),1:"NF"),PF=$E("*",$P(ND,"^",20)>0),PSGID=$P(SCH,"^",2),SD=$P(SCH,"^",4) I C["C" S (PSGID,SD)="",PSGOD="********"
"RTN","PSGO",46,0)
 I STS="A",($P(ND,U,27)="R") S STS="R"
"RTN","PSGO",47,0)
 S WS=0,PSGOD=$$ENDTC^PSGMI(PSGID)
"RTN","PSGO",48,0)
 S:PSJPWD WS=$$WS^PSJO(PSJPWD,PSGP,F,+O)
"RTN","PSGO",49,0)
 NEW MARX
"RTN","PSGO",50,0)
 D DRGDISP^PSJLMUT1(PSGP,+O_$S(C["B":"P",C["C":"P",1:"U"),40,54,.MARX,0)
"RTN","PSGO",51,0)
 NEW X F X=0:0 S X=$O(MARX(X)) Q:'X  W @($S(X=1:"?9",1:"!?11")) W MARX(X) D:X=1
"RTN","PSGO",52,0)
 . N RNDT,O2 S O2=O S:+O2=O O2=O2_"P" S RNDT=$$LASTREN^PSJLMPRI(PSGP,O2) I RNDT]"" S RNDT=$E($$ENDTC^PSGMI(RNDT),1,5)
"RTN","PSGO",53,0)
 . W ?50,$S(C["C":"?",ST'="z":ST,1:"?"),?53,$E(PSGOD,1,5)
"RTN","PSGO",54,0)
 . S SD=$$ENDTC^PSGMI(SD) W ?60,$E(SD,1,5),?67,STS
"RTN","PSGO",55,0)
 . I NF!WS!SM!PF!RNDT W ?71 W:NF "NF " W:WS "WS " W:RNDT RNDT_" " W:SM $E("HSM",SM,3) W:PF ?79,"*"
"RTN","PSGO",56,0)
 I ND6]"" S Y=$$ENSET^PSGSICHK($P(ND6,"^")) W !?11 F X=1:1:$L(Y," ") S V=$P(Y," ",X) W:$L(V)+$X>66 !?11 W V_" "
"RTN","PSGO",57,0)
 Q
"RTN","PSGO",58,0)
 ;
"RTN","PSGO",59,0)
TF ;
"RTN","PSGO",60,0)
 NEW SLS S SLS="",$P(SLS," -",40)=""
"RTN","PSGO",61,0)
 S LN2=$S(C="A":$$TXT^PSJO("A"),C["CC":$$TXT^PSJO("PR"),C["CD":$$TXT^PSJO("PC"),C["C":$$TXT^PSJO("P"),C["BD":$$TXT^PSJO("NC"),C["B":$$TXT^PSJO("N"),C="DF":$$TXT^PSJO("DF"),1:$$TXT^PSJO("NA"))
"RTN","PSGO",62,0)
 W:$D(^TMP("PSG",$J,C)) !,$E($E(SLS,1,(80-$L(LN2))/2)_" "_LN2_$E(SLS,1,(80-$L(LN2))/2),1,80)
"RTN","PSGO",63,0)
 S F="^PS("_$S(C["C":"53.1,",C["B":"53.1,",1:"55,"_PSGP_",5,",1:"53.1,") S TF=$S(C["C":0,1:TF)
"RTN","PSGO",64,0)
 Q
"RTN","PSGO",65,0)
 ;
"RTN","PSGO",66,0)
GET ;
"RTN","PSGO",67,0)
 S $P(LN2,"-",81)="",PG=$D(PSGVWA),(ON,PSGONC,PSGONR,PSGONV,SLS)="",$P(SLS," -",15)="",TF=1,RB=$S(PSJPRB]"":PSJPRB,1:"*NF*"),WD=$S(PSJPWDN]"":PSJPWDN,PSJPWD:PSJPWD_";DIC(42,",1:"*NF*")
"RTN","PSGO",68,0)
 ;
"RTN","PSGO",69,0)
NP I ON,'CML W $C(7) R !," '^' TO QUIT ",NP:DTIME W:'$T $C(7) S:'$T NP="^" W:NP'["^" $C(13),"                     ",$C(13),# Q
"RTN","PSGO",70,0)
 I ON,CML D BOT
"RTN","PSGO",71,0)
 Q:$G(PSGOL)="N"
"RTN","PSGO",72,0)
 ;
"RTN","PSGO",73,0)
HEADER ;
"RTN","PSGO",74,0)
 S PG=PG+1
"RTN","PSGO",75,0)
 S:'$D(PSJOPC) PSJOPC=1 S PSJTEAM=$S($D(PSJSEL("TM")):1,1:0)
"RTN","PSGO",76,0)
 D ENTRY^PSJHEAD(PSGP,PSJOPC,PG,$G(PSJNARC),PSJTEAM)
"RTN","PSGO",77,0)
 W:PG>1 !,$E(LN2,1,80) Q
"RTN","PSGO",78,0)
 ;
"RTN","PSGO",79,0)
BOT ;
"RTN","PSGO",80,0)
 F Q=$Y:1:IOSL-4 W !
"RTN","PSGO",81,0)
 W !,?2,$P(PSGP(0),"^"),?40,PSJPPID,?70,$E($P(PSJPDOB,"^",2),1,8) Q
"RTN","PSGO",82,0)
 ;
"RTN","PSGO",83,0)
ENHEAD ;
"RTN","PSGO",84,0)
 K LN2,PSGPR,PSGPRP D NOW^%DTC S HDT=$$ENDTC^PSGMI(+$E(%,1,12)),PSGVWA=1,PSGOH="U N I T   D O S E   P R O F I L E" D GET
"RTN","PSGO",85,0)
 D D1 K PSGONC,PSGONR,PSGONV,PSGVWA Q
"RTN","PSGO",86,0)
 ;
"RTN","PSGO",87,0)
ENVBW ;
"RTN","PSGO",88,0)
 S PSGOH=$S(PSGVBWTO=1:"N O N - V E R I F I E D   O R D E R S",PSGVBWTO=2:"P E N D I N G   O R D E R S",1:"N O N - V E R I F I E D / P E N D I N G   O R D E R S")
"RTN","PSGO",89,0)
 D EN Q
"RTN","PSGO",90,0)
ENPR ;
"RTN","PSGO",91,0)
 S PSGOH="U N I T  D O S E  P R O F I L E" G GET
"RTN","PSGO",92,0)
 Q
"RTN","PSGOD")
0^59^B21325344
"RTN","PSGOD",1,0)
PSGOD ;BIR/CML3-CREATES NEW ORDER FROM OLD ONE ;22 SEP 97 / 2:56 PM 
"RTN","PSGOD",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**67,58,111,133,181**;16 DEC 97;Build 190
"RTN","PSGOD",3,0)
 ;
"RTN","PSGOD",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGOD",5,0)
 ;
"RTN","PSGOD",6,0)
 I $P($G(^PS(55,PSGP,5,+PSJORD,0)),"^",22) D  Q
"RTN","PSGOD",7,0)
 .W !,"This order is marked 'Not To Be Given' and can't be copied!" H 2
"RTN","PSGOD",8,0)
 F  W !!,"Do you want to copy this order" S %=2 D YN^DICN Q:%  D CH
"RTN","PSGOD",9,0)
 G:%'=1 DONE
"RTN","PSGOD",10,0)
 ;
"RTN","PSGOD",11,0)
 W !!,"...copying..." N OLDON
"RTN","PSGOD",12,0)
 K PSGORQF
"RTN","PSGOD",13,0)
 N PSGPDRG
"RTN","PSGOD",14,0)
 S PSGOEPR=$P($G(^PS(55,PSGP,5.1)),"^",2),OLDON=PSGORD
"RTN","PSGOD",15,0)
 ;K PSGODN S F=$S((PSGORD["N")!(PSGORD["P"):"^PS(53.1,"_+PSGORD_",",1:"^PS(55,"_PSGP_",5,"_+PSGORD_",") F N=0,.2,2,6 S PSGODN(N)=$G(@(F_N_")"))
"RTN","PSGOD",16,0)
 K PSGODN S F=$S(PSGORD["P":"^PS(53.1,"_+PSGORD_",",1:"^PS(55,"_PSGP_",5,"_+PSGORD_",") F N=0,.2,2,6 S PSGODN(N)=$G(@(F_N_")"))
"RTN","PSGOD",17,0)
 S PSGPR=$P(PSGODN(0),"^",2),PSGMR=$P(PSGODN(0),"^",3),PSGSM=$P(PSGODN(0),"^",5),PSGHSM=$P(PSGODN(0),"^",6),PSGST=$P(PSGODN(0),"^",7)
"RTN","PSGOD",18,0)
 S PSGPDRG=+PSGODN(.2),PSGDO=$P(PSGODN(.2),"^",2)
"RTN","PSGOD",19,0)
 S PSGSI=PSGODN(6)
"RTN","PSGOD",20,0)
 ; The naked reference below refers to the full reference inside indirection to ^PS(55,PSGP,5,+PSGORD, or ^PS(55,PSGP,"IV",+PSGORD, or ^PS(53.1,+PSGORD
"RTN","PSGOD",21,0)
 S PSGODN(3)=0 F Q=0:0 S Q=$O(@(F_"3,"_Q_")")) Q:'Q  I $D(^(Q,0)) S PSGODN(3,Q)=^(0),PSGODN(3)=PSGODN(3)+1 S ^PS(53.45,PSJSYSP,1,Q,0)=^(0)
"RTN","PSGOD",22,0)
 ;S:PSGODN(12)>0 ^PS(53.45,PSJSYSP,4,0)="^53.4504" S:PSGODN(3)>0 ^PS(53.45,PSJSYSP,1,0)="^53.4501"
"RTN","PSGOD",23,0)
 S:PSGODN(3)>0 ^PS(53.45,PSJSYSP,1,0)="^53.4501"
"RTN","PSGOD",24,0)
 ; The naked reference below refers to the full reference inside indirection to ^PS(55,PSGP,5,+PSGORD, or ^PS(55,PSGP,"IV",+PSGORD, or ^PS(53.1,+PSGORD  
"RTN","PSGOD",25,0)
 S (PSGODN(1),Q)=0 F  S Q=$O(@(F_"1,"_Q_")")) Q:'Q  S ND=$G(^(Q,0)) I ND,'$P(ND,"^",3) S PSGODN(1)=PSGODN(1)+1,PSGODN(1,PSGODN(1))=$P(ND,"^",1,2) S ^PS(53.45,PSJSYSP,2,PSGODN(1),0)=^(0)
"RTN","PSGOD",26,0)
 S PSGS0Y=$P(PSGODN(2),"^",5),PSGS0XT=$P(PSGODN(2),"^",6),PSGNESD="",PSGSCH=$P(PSGODN(2),U)
"RTN","PSGOD",27,0)
 S PSGODF=1,PSGNEDFD=$P($$GTNEDFD^PSGOE7("U",+PSGPDRG),U)_"^^"_PSGST_"^"_PSGSCH
"RTN","PSGOD",28,0)
 W "." D ^PSGNE3
"RTN","PSGOD",29,0)
 K PSGEFN,PSGOEEF,PSGOEE,PSGOEOS S PSGEFN="1:13" F X=1:1:13 S PSGEFN(X)=""
"RTN","PSGOD",30,0)
 S PSGPDN=$$OINAME^PSJLMUTL(PSGPDRG),PSGOINST="",PSGSDN=$$ENDD^PSGMI(PSGNESD)_U_$$ENDTC^PSGMI(PSGNESD),PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC^PSGMI(PSGNEFD)
"RTN","PSGOD",31,0)
 S PSGAT=PSGS0Y,PSGEBN=DUZ,PSGLIN=$$ENDD^PSGMI(PSGDT)_U_$$ENDTC^PSGMI(PSGDT),PSGEBN=$$ENNPN^PSGMI(DUZ),PSGSTAT=$S(PSGOEAV:"ACTIVE",1:"NON-VERIFIED")
"RTN","PSGOD",32,0)
 W "." D CHK^PSGOEV("^^"_PSGMR_"^^^^"_PSGST,PSGPDRG_U_PSGDO,PSGSCH_U_PSGNESD_"^^"_PSGNEFD)
"RTN","PSGOD",33,0)
 I $G(PSGSCH)]"" D
"RTN","PSGOD",34,0)
 .N X S X=PSGSCH N SWD,SDW,XABB,QX D ENOS^PSGS0 I $G(X)=""!$G(PSJNSS) S CHK=1 K PSJNSS Q
"RTN","PSGOD",35,0)
 .I $G(PSGAT)="",$G(PSGS0Y) S PSGAT=PSGS0Y
"RTN","PSGOD",36,0)
 .I $G(PSGAT),($G(PSGS0Y)="") S PSGS0Y=PSGAT
"RTN","PSGOD",37,0)
 .I $G(PSGS0XT)="D",$G(PSGS0Y)="" S CHK=1 D  K PSJNSS
"RTN","PSGOD",38,0)
 ..W ! K DIR S DIR(0)="FOA",DIR("A")="   WARNING - Admin times are required for DAY OF WEEK schedules    " D ^DIR K DIR
"RTN","PSGOD",39,0)
 S PSGSD=PSGNESD,PSGFD=PSGNEFD
"RTN","PSGOD",40,0)
 K PSJACEPT S VALMBCK="Q" D:$D(Y) EN^VALM("PSJU LM ACCEPT")
"RTN","PSGOD",41,0)
 I $G(PSJACEPT)=1 D OC S:$D(PSGORQF) PSJACEPT=0 S:$G(PSJACEPT)=1 VALMBCK="",PSJNOO=$$ENNOO^PSJUTL5("N")
"RTN","PSGOD",42,0)
 I '$G(PSJACEPT)!($G(PSJNOO)<0) W !!,"Order not copied." D PAUSE^VALM1 G ORIG
"RTN","PSGOD",43,0)
 S PSGNESD=PSGSD,PSGNEFD=PSGFD
"RTN","PSGOD",44,0)
 K PSGOEE D ^PSGOETO S PSJORD=PSGORD I PSGOEAV D
"RTN","PSGOD",45,0)
 .I '$D(PSGOEE),+PSJSYSU=3 D EN^PSGPEN(PSGORD)
"RTN","PSGOD",46,0)
 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),^PSGOE1,EN^VALM("PSJ LM UD ACTION")
"RTN","PSGOD",47,0)
 ;
"RTN","PSGOD",48,0)
 S PSGCANFL=0,(PSGORD,PSJORD)=OLDON W !!,"You are finished with the new order.",!,"The following ACTION prompt is for the original order."
"RTN","PSGOD",49,0)
 K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSGOD",50,0)
ORIG ;Redisplay original order
"RTN","PSGOD",51,0)
 D GETUD^PSJLMGUD(PSGP,OLDON),INIT^PSJLMUDE(PSGP,OLDON)
"RTN","PSGOD",52,0)
DONE ;
"RTN","PSGOD",53,0)
 K %,%H,%I,DA,F,N,PSGODN,PSGODF,PSGS0XT,PSGS0Y,PSGNESD,PSGTOL,PSGTOO,PSGUOW,X,Y,^PS(53.45,PSJSYSP,1),^PS(53.45,PSJSYSP,2)
"RTN","PSGOD",54,0)
 K PSGPR,PSGMR,PSGSM,PSGHSM,PSGST,PSGPDRG,PSGDO,PSGNEDFD,PSGSCH,PSGNEFD
"RTN","PSGOD",55,0)
 Q
"RTN","PSGOD",56,0)
 ;
"RTN","PSGOD",57,0)
CH ;
"RTN","PSGOD",58,0)
 W !!?2,"Answer 'YES' to have a new, non-verified order created for this patient,",!,"using the information from this order.  (The START and STOP dates will be",!,"recalculated.)  Enter 'NO' (or '^') to stop now." Q
"RTN","PSGOD",59,0)
 ;
"RTN","PSGOD",60,0)
WH ;
"RTN","PSGOD",61,0)
 W !!?2,"Answer 'YES' to take action on this new order.  Enter 'NO' (or '^') to return",!,"to the original order now." Q
"RTN","PSGOD",62,0)
 ;
"RTN","PSGOD",63,0)
OC ;Perform order checks
"RTN","PSGOD",64,0)
 NEW PSJDD,X,PSJALLGY
"RTN","PSGOD",65,0)
 F X=0:0 S X=$O(PSGODN(1,X)) Q:'X  D
"RTN","PSGOD",66,0)
 . S PSJDD=$G(PSGODN(1,X))
"RTN","PSGOD",67,0)
 . I +PSJDD S PSJALLGY(+PSJDD)=""
"RTN","PSGOD",68,0)
 ;S X=+$O(PSGODN(1,0)) Q:'X  S PSJDD=+$G(PSGODN(1,X)) Q:'PSJDD
"RTN","PSGOD",69,0)
 S PSJDD=+$O(PSJALLGY(0)) Q:'PSJDD
"RTN","PSGOD",70,0)
 D FULL^VALM1
"RTN","PSGOD",71,0)
 D ENDDC^PSGSICHK($G(PSGP),PSJDD) Q:$D(PSGORQF)
"RTN","PSGOD",72,0)
 D IN^PSJOCDS($G(PSGORD),"UD",PSJDD)
"RTN","PSGOD",73,0)
 Q
"RTN","PSGOE")
0^74^B26201410
"RTN","PSGOE",1,0)
PSGOE ;BIR/CML3-PROFILE AND ORDER ENTRY (MAIN DRIVER) ;24 Feb 99 / 10:40 AM
"RTN","PSGOE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**22,29,56,72,95,80,133,181**;16 DEC 97;Build 190
"RTN","PSGOE",3,0)
 ;
"RTN","PSGOE",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSGOE",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSGOE",6,0)
 ;
"RTN","PSGOE",7,0)
 ;N PSJNEW,PSGPTMP,PPAGE S PSJNEW=1
"RTN","PSGOE",8,0)
 ;
"RTN","PSGOE",9,0)
EN ;
"RTN","PSGOE",10,0)
 N PSJLK,PSJPROT,XQORS,VALMEVL,PSJSYSO D ENCV^PSGSETU Q:$D(XQUIT)
"RTN","PSGOE",11,0)
 S (PSGOL,PSGOP,PSGNEF,PSGOEAV,PSGPXN)="" I $P(PSJSYSU,";",2)&($P(PSJSYSU,";")'=3) S PSGION=ION D DDEV D ^%ZISC I DDEV="^" G DONE
"RTN","PSGOE",12,0)
 K PSGVBY L +^PS(53.45,PSJSYSP):1 E  D LOCKERR^PSJOE G DONE
"RTN","PSGOE",13,0)
 F  S (PSJLMCON,PSGPTMP)=0 D ENDPT^PSGP,HK Q:PSGP'>0  D   I PSJLK D UL^PSSLOCK(PSGP)
"RTN","PSGOE",14,0)
 .K ^TMP("PSJ",$J)
"RTN","PSGOE",15,0)
 .S PSJLK=$$L^PSSLOCK(PSGP,1) I 'PSJLK W !,$C(7),$P(PSJLK,U,2) Q
"RTN","PSGOE",16,0)
 .N NXTPT S NXTPT=0  ;NXTPT=1 indicates OE is complete for this patient
"RTN","PSGOE",17,0)
 .K PSJLMPRO S PSJLMCON=0
"RTN","PSGOE",18,0)
 .S PSJPROT=1,DFN=PSGP D EN^VALM("PSJ LM BRIEF PATIENT INFO")
"RTN","PSGOE",19,0)
 .F  Q:$G(NXTPT)  D
"RTN","PSGOE",20,0)
 ..K PSGRDTX
"RTN","PSGOE",21,0)
 ..I $G(PSJLMCON)!$G(PSJNEWOE) D
"RTN","PSGOE",22,0)
 ...S PSJOL=$S(",S,L,"[(","_$G(PSJOL)_","):PSJOL,1:"S")
"RTN","PSGOE",23,0)
 ...S PSJLMPRO=1,PSJLMCON=1,PSJNEWOE=0 D EN^VALM("PSJU LM OE")
"RTN","PSGOE",24,0)
 ..I $G(PSJNEWOE)!($G(VALMBCK)="Q") S PSJNEWOE=0 Q
"RTN","PSGOE",25,0)
 ..I $G(PSJLMCON)&$G(PSJLMPRO)&'$D(^TMP("PSJ",$J)) D  Q
"RTN","PSGOE",26,0)
 ...S PSJLMCON=0,PSJLMPRO=0 D EN^VALM("PSJ LM BRIEF PATIENT INFO")
"RTN","PSGOE",27,0)
 ...I $G(PSJNEWOE) S NXTPT=0 Q
"RTN","PSGOE",28,0)
 ...S NXTPT=1
"RTN","PSGOE",29,0)
 ..S NXTPT=1,PSJNEWOE=0 ; Go on to next patient
"RTN","PSGOE",30,0)
 .I $G(PSGPXN),$P(PSJSYSW0,U,29)]"" S PSGPXPT=PSGP D  K PSGPXPT S PSGPXN=0
"RTN","PSGOE",31,0)
 ..N DFN,PSGP S (PSGP,DFN)=PSGPXPT D ^PSGPER
"RTN","PSGOE",32,0)
 .D ENCV^PSGSETU
"RTN","PSGOE",33,0)
 K PSJLMPRO,^TMP("PSJPRO",$J),^TMP("PSJ",$J),^TMP("PSJON",$J)
"RTN","PSGOE",34,0)
 ;
"RTN","PSGOE",35,0)
DONE ;
"RTN","PSGOE",36,0)
 I PSGOP,$P(PSJSYSL,"^",2)]"" D ENQL^PSGLW
"RTN","PSGOE",37,0)
 I $D(PSJSYSO),PSGOP,$O(^PS(53.44,DUZ,1,PSGOP,1,0)) S PSGOEPOF="" D ^PSGOEPO
"RTN","PSGOE",38,0)
 K PSJEXCPT,PSJOCER,^TMP($J,"PSJPRE")
"RTN","PSGOE",39,0)
 K D0,DDEV,FQC,J,MRN,ND,ND2,PSGNEF,PSGNEFDO,PSGNESDO,PSGOE,PSGOEA,PSGOEAV,PSGOEDMR,PSGOENOF,PSGOEPOF,PSGOL,PSGOP,PSGPX,PSGTOL,PSGTOO,PSGUOW,PSJOPC,PSJORTOU,PSJORVP,PRI,PX,XX L -^PS(53.45,PSJSYSP)
"RTN","PSGOE",40,0)
 K PSGOEORF,ORIFN,ORETURN,PSJORL,PSJORPCL,PSJORPV,PSJNOO,DDH,DDN,DRGI,FQ,HF,I1,ND1,NF,PDRG,PSGACTO,PSGAL,PSGCANFL,PSGDA,PSGPEN,PSGPENWS,PSGY
"RTN","PSGOE",41,0)
 G:$G(PSGPXN) ^PSGPER1 D ENKV^PSGSETU K ND1,PSG25,PSG26,PSGEB,PSBEBN,PSGNODE,PSGOAT,PSGSTAT,DDN,I2 Q
"RTN","PSGOE",42,0)
 Q
"RTN","PSGOE",43,0)
 ;
"RTN","PSGOE",44,0)
HK ; Housekeeping (a nice COBOL term)
"RTN","PSGOE",45,0)
 S PSGOENOF=0 I +PSJSYSU=1 D NOW^%DTC F Q=%:0 Q:PSGOENOF  S Q=$O(^PS(55,PSGP,5,"AUS",Q)) Q:'Q  F QQ=0:0 S QQ=$O(^PS(55,PSGP,5,"AUS",Q,QQ)) Q:'QQ  I $D(^PS(55,PSGP,5,QQ,4)),$P(^(4),"^",10) S PSGOENOF=1 Q
"RTN","PSGOE",46,0)
 I PSGOP,PSGOP'=PSGP D
"RTN","PSGOE",47,0)
 .N PSJACPF,PSJACNWP,PSJPWD,PSJSYSL,PSJSYSW,PSJSYSW0,DFN,VAIN,VAERR S DFN=PSGOP
"RTN","PSGOE",48,0)
 .D INP^VADPT S PSJPWD=+VAIN(4) I PSJPWD S PSJACPF=10 D WP^PSJAC D:$P(PSJSYSL,"^",2)]"" ENQL^PSGLW
"RTN","PSGOE",49,0)
 I $D(PSJSYSO),PSGOP,PSGOP'=PSGP S PSGOEPOF="" D ^PSGOEPO
"RTN","PSGOE",50,0)
 S:PSGP>0 PSJORVP=PSGP_";DPT(",PSJORL=$$ENORL^PSJUTL(PSJPWD),PSGOP=PSGP,X=""
"RTN","PSGOE",51,0)
 Q
"RTN","PSGOE",52,0)
 ;
"RTN","PSGOE",53,0)
ORSU ; Oe/Rr Set-Up ;Not used anymore
"RTN","PSGOE",54,0)
 ;K %ZIS,IO("Q") S IOP="HOME" D ^%ZIS
"RTN","PSGOE",55,0)
 ;S PSGOEORF=$O(^DIC(9.4,"B","INPATIENT MEDICATIONS",0)) I PSGOEORF S PSGOEORF=$S($D(^ORD(100.99,1,20,PSGOEORF,0)):$P(^(0),"^",2),1:0)
"RTN","PSGOE",56,0)
 ;I PSGOEORF S PSJORTOU=$O(^ORD(100.98,"B","INPATIENT MEDICATIONS",0)),PSJORPCL=$O(^ORD(101,"B","PSJ OR PAT OE",0)),PSJORPCL=PSJORPCL_";ORD(101,"
"RTN","PSGOE",57,0)
 Q
"RTN","PSGOE",58,0)
 ;
"RTN","PSGOE",59,0)
DDEV ;
"RTN","PSGOE",60,0)
 F  S POP=1 R !!,"Select Device to print ORDERS (10-1158): ",DDEV:DTIME W:'$T $C(7) S:'$T DDEV="^" Q:DDEV="^"!(DDEV=".")  D:DDEV?1."?" DDH K %ZIS,IO("Q") S %ZIS="NQ",IOP=DDEV D ^%ZIS Q:'POP
"RTN","PSGOE",61,0)
 S:DDEV="^" %=-1 Q:POP  I $E(IOST)'="P"!(PSGION=ION) W $C(7),!!?2,"The device you have selected is not a printer.  You must select a printer." W:PSGION=ION !,"You cannot print the orders to your terminal." G DDEV
"RTN","PSGOE",62,0)
 S PSJSYSO=ION_"^"_IO W:$S(DDEV=" ":1,$L(DDEV)'<$L(ION):0,1:DDEV=$E(ION,1,$L(DDEV))) $S(DDEV=" ":"  "_ION,1:$E(ION,$L(DDEV)+1,$L(ION)))
"RTN","PSGOE",63,0)
 F Q=0:0 S Q=$O(^PS(53.44,DUZ,1,Q)) Q:'Q  I $O(^(Q,1,0)) Q
"RTN","PSGOE",64,0)
 Q:'Q  W !!?2,"You have unprinted orders.  If you do not print them now, you will not be",!,"able to print them from here later."
"RTN","PSGOE",65,0)
 F  W !!,"Do you want to print them now" S %=1 D YN^DICN Q:%  W !!?2,"Enter 'YES' to print the orders now.  If you enter 'NO', you will not be",!,"able to print them from here later.  (Enter '^' to exit this option.)"
"RTN","PSGOE",66,0)
 Q:%<0  I %=1 S PSGOEPOF="A" D ^PSGOEPO S %=0 Q
"RTN","PSGOE",67,0)
 S DA=DUZ,DIK="^PS(53.44," D ^DIK S %=0 Q
"RTN","PSGOE",68,0)
 ;
"RTN","PSGOE",69,0)
DDH ;
"RTN","PSGOE",70,0)
 W !!?2,"Select a device to print each patient's orders (VA Form 10-1158) after you",!,"have entered them.  If you do not select a device, no orders will print." Q
"RTN","PSGOE",71,0)
 ;
"RTN","PSGOE",72,0)
CHUCK ;
"RTN","PSGOE",73,0)
 D ENCV^PSGSETU Q:$D(XQUIT)  R !!,"PSJSYSU: ",PSJSYSU:DTIME S:'$T PSJSYSU="^" I "^"'[PSJSYSU G EN
"RTN","PSGOE",74,0)
 Q
"RTN","PSGOE7")
0^75^B19204515
"RTN","PSGOE7",1,0)
PSGOE7 ;BIR/CML3-SELECT DRUG ;15 MAY 00 / 1:43 PM
"RTN","PSGOE7",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**9,26,34,52,55,50,87,111,181**;16 DEC 97;Build 190
"RTN","PSGOE7",3,0)
 ;
"RTN","PSGOE7",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180
"RTN","PSGOE7",5,0)
 ; Reference to ^PS(59.7 is supported by DBIA 2181
"RTN","PSGOE7",6,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192
"RTN","PSGOE7",7,0)
 ; NFI-UD chgs for FR#: 1
"RTN","PSGOE7",8,0)
 ; 
"RTN","PSGOE7",9,0)
 ;S PSGDICS="U"_$S($D(PSJOERR):",I",1:"")
"RTN","PSGOE7",10,0)
 S PSGDICS="U"
"RTN","PSGOE7",11,0)
 ;
"RTN","PSGOE7",12,0)
AD ; Ask Drug
"RTN","PSGOE7",13,0)
 K PSJDOSE,PSJDOX ;var array use in ^PSJDOSE
"RTN","PSGOE7",14,0)
 K PSGODO
"RTN","PSGOE7",15,0)
 K DIC S DIC="^PS(50.7,",DIC(0)="EMQZVT",D="B^C" I '$P(PSJSYSU,";",4) S DIC("S")="I $$ENOISC^PSJUTL(Y,""U"")"
"RTN","PSGOE7",16,0)
 E  S DIC("T")="",DIC="^PSDRUG(",DIC("S")="I +$G(^PSDRUG(+Y,2)),$P($G(^PSDRUG(+Y,2)),""^"",3)[""U"" S X(1)=+$G(^(""I"")) I $S('X(1):1,1:X(1)'<DT)",D="B^C^VAPN^VAC^NDC^XATC"
"RTN","PSGOE7",17,0)
 ;
"RTN","PSGOE7",18,0)
AD1 ;
"RTN","PSGOE7",19,0)
 K PSGORD,PSJORD,PSJALLGY
"RTN","PSGOE7",20,0)
 S PSGORQF=0 R !!,"Select DRUG: ",X:DTIME I '$T W $C(7) S X="^"
"RTN","PSGOE7",21,0)
 I ("^"[X)!(X="") S PSGORQF=1 G DONE
"RTN","PSGOE7",22,0)
 G:X?1"S."1.E DONE
"RTN","PSGOE7",23,0)
 I X?1."?" W !!?2,"Select the medication you wish the patient to receive." W:PSJSYSU<3 "  You should consult",!,"with your pharmacy before ordering any non-formulary medication." W !
"RTN","PSGOE7",24,0)
 D MIX^DIC1 G:X?1."?" AD1 G:"^"[X!(Y'>0) AD1 S (PSGDO,PSGDRG,PSGDRGN,PSGNEDFD,PSGPDRG,PSGPDRGN)=""
"RTN","PSGOE7",25,0)
 I $P(PSJSYSU,";",4) D  G DO
"RTN","PSGOE7",26,0)
 .S PSGDRG=+Y,PSGDRGN=Y(0,0)
"RTN","PSGOE7",27,0)
 .D DIN^PSJDIN(+$G(^PSDRUG(PSGDRG,2)),PSGDRG)
"RTN","PSGOE7",28,0)
 .I $P(Y(0),"^",9) D NF S:Y>0 PSGDRG=+Y(0),PSGDRGN=Y(0,0) D SNFM
"RTN","PSGOE7",29,0)
 .S PSGPDRG=+$G(^PSDRUG(PSGDRG,2)),PSGPDRGN=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE7",30,0)
 S PSGPDRG=+Y,PSGPDRGN=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE7",31,0)
 ;F Q=1:1:$L(PSGDICS) S X=$P(PSGDICS,",",Q) Q:X=""  S PSJLUAPP=$O(^PS(50.3,PSGPDRG,1,"B",X,0)) I PSJLUAPP S X=$G(^PS(50.3,PSGPDRG,1,PSJLUAPP,0)) Q
"RTN","PSGOE7",32,0)
 S X=$O(^PSDRUG("ASP",PSGPDRG,0)) I X,'$O(^(X)) S PSGDRG=X,PSGDRGN=$$ENDDN^PSGMI(X)
"RTN","PSGOE7",33,0)
 ;
"RTN","PSGOE7",34,0)
DO ; dosage ordered
"RTN","PSGOE7",35,0)
 NEW PSJALLGY
"RTN","PSGOE7",36,0)
 S PSGNEDFD=$$GTNEDFD("U",PSGPDRG)
"RTN","PSGOE7",37,0)
 I $G(PSGDRG),$P(PSJSYSU,";",4) S PSJALLGY(PSGDRG)="" D ENDDC^PSGSICHK(PSGP,PSGDRG) G:$G(PSGORQF) AD
"RTN","PSGOE7",38,0)
 I '$P(PSJSYSU,";",4) S PSGX=PSGPDRG D END^PSGSICHK G:Y<0 AD
"RTN","PSGOE7",39,0)
 ;S PSGNEDFD="" I PSGPDRG S PSGX=PSGPDRG D END^PSGSICHK
"RTN","PSGOE7",40,0)
 S PSGDO=""
"RTN","PSGOE7",41,0)
 ;I PSGDO]"",'PSGDO,PSGDO?.E1N.E F  S PSGDO=$E(PSGDO,2,999) Q:PSGDO  Q:PSGDO=""
"RTN","PSGOE7",42,0)
 ;G:Y<0 AD
"RTN","PSGOE7",43,0)
 ;
"RTN","PSGOE7",44,0)
DONE ;
"RTN","PSGOE7",45,0)
 K DIC,%,%Y,PSGDICS,PSJLUAPP,Q1,Q2,Q3,Z,PSJALLGY Q
"RTN","PSGOE7",46,0)
 ;
"RTN","PSGOE7",47,0)
 ;
"RTN","PSGOE7",48,0)
NF ;
"RTN","PSGOE7",49,0)
 S Y=0 W $C(7),!!,"PLEASE NOTE: The selected item is not currently on your medical center's",!?13,"formulary." Q:'$P(PSJSYSU,";",2)
"RTN","PSGOE7",50,0)
 N CNT S CNT=0 F Q1=0:0 S Q1=$O(^PSDRUG(PSGDRG,65,Q1)) Q:'Q1  I $$CHKDRG(+$G(^(Q1,0))) S CNT=CNT+1
"RTN","PSGOE7",51,0)
 I CNT=0 W !!,"There are no formulary alternatives entered for this item." W:PSJSYSU>2 "  You should consult",!,"with your pharmacy before ordering this item." S Y=0 Q
"RTN","PSGOE7",52,0)
 I CNT=1 S Q1=$O(^PSDRUG(PSGDRG,65,0)),Q1=+$G(^(Q1,0)),Q3=$P(^PSDRUG(Q1,0),"^") W !!,Q3," has been entered as a formulary " W:$X>67 ! W "alternative."
"RTN","PSGOE7",53,0)
 I  F Q=1:1 S %=2 W !!,"Is ",$S(Q=1:"this",1:Q3)," acceptable" D YN^DICN Q:%  D NFOH
"RTN","PSGOE7",54,0)
 I CNT=1 S:%=1 (Y(0),Y)=Q1,Y(0,0)=Q3 S:%<0 Y=-1 Q
"RTN","PSGOE7",55,0)
 K DA,DIC S DA(1)=PSGDRG,DIC="^PSDRUG("_PSGDRG_",65,",DIC(0)="AEMQZ",DIC("A")="Select FORMULARY ALTERNATIVE: " W ! D ^DIC K DIC Q
"RTN","PSGOE7",56,0)
 ;
"RTN","PSGOE7",57,0)
NFOH ;
"RTN","PSGOE7",58,0)
 S X="Answer 'YES' to order this formulary alternative ("_Q3_") for the patient instead of the non-formulary item originally selected.  Answer 'NO' to use the drug originally selected."
"RTN","PSGOE7",59,0)
 W !!?2 F Y=1:1:$L(X," ") S Z=$P(X," ",Y) W:$L(Z)+$X+2>IOM ! W Z," "
"RTN","PSGOE7",60,0)
 Q
"RTN","PSGOE7",61,0)
CHKDRG(DRG) ; Determine if dispense drug is valid for Unit Dose.
"RTN","PSGOE7",62,0)
 I $D(^PSDRUG(DRG,0)),$P($G(^(2)),U,3)["U" S X=+$G(^("I")) I 'X!(X>DT) Q DRG
"RTN","PSGOE7",63,0)
 Q 0
"RTN","PSGOE7",64,0)
 ;
"RTN","PSGOE7",65,0)
SNFM ; show non-formulary message
"RTN","PSGOE7",66,0)
 S Y=1 Q:PSJSYSU=3!'$O(^PS(59.7,1,21,0))  W $C(7),! S Q=0 F  S Q=$O(^PS(59.7,1,21,Q)) Q:'Q  W !,$G(^(Q,0))
"RTN","PSGOE7",67,0)
 W ! D READ^PSJUTL S Y=1 Q
"RTN","PSGOE7",68,0)
 ;
"RTN","PSGOE7",69,0)
GTNEDFD(APP,PDRG) ; Find defaults from Orderable Item.
"RTN","PSGOE7",70,0)
 Q $P($G(^PS(50.7,+PDRG,0)),"^",5,8)
"RTN","PSGOE7",71,0)
 N Q,X S X=""
"RTN","PSGOE7",72,0)
 F Q=1:1:$L(APP) S X=$E(APP,Q) Q:X=""  S X=$O(^PS(50.3,+PDRG,1,"B",X,0)) I X S X=$P($G(^PS(50.3,+PDRG,1,X,0)),"^",5,8) Q
"RTN","PSGOE7",73,0)
 Q X
"RTN","PSGOE82")
0^76^B20946655
"RTN","PSGOE82",1,0)
PSGOE82 ;BIR/CML3-NON-VERIFIED ORDER EDIT (CONT.) ;27 Jan 98 / 9:32 AM
"RTN","PSGOE82",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**2,35,50,67,58,81,127,168,181**;16 DEC 97;Build 190
"RTN","PSGOE82",3,0)
 ;
"RTN","PSGOE82",4,0)
 ; Reference to ^DD(53.1 is supported by DBIA #2256.
"RTN","PSGOE82",5,0)
 ; Reference to ^VA(200 is supported by DBIA #10060.
"RTN","PSGOE82",6,0)
 ; Reference to ^DIE is supported by DBIA #10018.
"RTN","PSGOE82",7,0)
 ; Reference to ^DIC is supported by DBIA #10006.
"RTN","PSGOE82",8,0)
 ; Reference to ^DICN is supported by DBIA #10009.
"RTN","PSGOE82",9,0)
 ;
"RTN","PSGOE82",10,0)
1 ; provider
"RTN","PSGOE82",11,0)
 S MSG=0,PSGF2=1 S:PSGOEEF(PSGF2) BACK="1^PSGOE82"
"RTN","PSGOE82",12,0)
A1 I $G(PSGORD)["P",$G(PSGP) I $$LASTREN^PSJLMPRI(PSGP,PSGORD) D  Q
"RTN","PSGOE82",13,0)
 . W !?5,"This order has been renewed. Provider may not be edited at this point. " D PAUSE^VALM1
"RTN","PSGOE82",14,0)
 W !,"PROVIDER: ",$S(PSGPR:PSGPRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE82",15,0)
 I $S(X="":'PSGPR,1:X="@") W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,1) G A1
"RTN","PSGOE82",16,0)
 I X="",PSGPR S X=PSGPRN I PSGPR'=PSGPRN,$D(^VA(200,PSGPR,"PS")) W:0 "    "_$P(^("PS"),"^",2)_"    "_$P(^("PS"),"^",3) G DONE
"RTN","PSGOE82",17,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,1)
"RTN","PSGOE82",18,0)
 I $E(X)="^" D ENFF G:Y>0 @Y G A1
"RTN","PSGOE82",19,0)
 K DIC S DIC="^VA(200,",DIC(0)="EMQZ",DIC("S")="I $D(^(""PS"")),^(""PS""),$S('$P(^(""PS""),""^"",4):1,1:$P(^(""PS""),""^"",4)>DT)" D ^DIC K DIC I Y'>0 G A1
"RTN","PSGOE82",20,0)
 S PSGPR=+Y,PSGPRN=Y(0,0) G DONE
"RTN","PSGOE82",21,0)
 ;
"RTN","PSGOE82",22,0)
5 ; self med
"RTN","PSGOE82",23,0)
 S MSG=0,PSGF2=5 S:PSGOEEF(PSGF2) BACK="5^PSGOE82" K PSGOEEF(6) S:PSGSM PSGOEEF(6)=1
"RTN","PSGOE82",24,0)
A5 W !,"SELF MED: " W $P("NO^YES","^",PSGSM+1),"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE82",25,0)
 ;I "01"[X,$L(X)<2 S:PSGSM=""&(X]"") PSGSM=X W:PSGSM]"" "  (",$P("NO^YES","^",PSGSM+1),")" G:'PSGSM DONE S PSGOEEF(6)=1 G 6
"RTN","PSGOE82",26,0)
 I "01"[X,$L(X)<2 S:X]"" PSGSM=+X W:PSGSM]"" "  (",$P("NO^YES","^",PSGSM+1),")" G:'PSGSM DONE S PSGOEEF(6)=1 G 6
"RTN","PSGOE82",27,0)
 I X="@" W $C(7),"  (Required)" G A5
"RTN","PSGOE82",28,0)
 I X?1"^".E D ENFF G:Y>0 @Y G A5
"RTN","PSGOE82",29,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,5) G A5
"RTN","PSGOE82",30,0)
 D YN I  S PSGSM=$E(X)="Y" K PSGOEEF(6) G:'PSGSM DONE S PSGOEEF(6)=1 G 6
"RTN","PSGOE82",31,0)
 W $C(7) D ENHLP^PSGOEM(53.1,5) G A5
"RTN","PSGOE82",32,0)
 ;
"RTN","PSGOE82",33,0)
6 ; hospital supplied self med
"RTN","PSGOE82",34,0)
 S MSG=0,PSGF2=6 S:PSGOEEF(PSGF2) BACK="6^PSGOE82"
"RTN","PSGOE82",35,0)
A6 W !,"HOSPITAL SUPPLIED SELF MED: " W:PSGHSM]"" $P("NO^YES","^",PSGHSM+1),"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE82",36,0)
 I "01"[X,$L(X)=1 S:X]"" PSGHSM=+X W "  (",$P("NO^YES","^",PSGHSM+1),")" S MSG=0,PSGF2=5 G DONE
"RTN","PSGOE82",37,0)
 I X="@" W $C(7),"  (Required)" G A6
"RTN","PSGOE82",38,0)
 I X?1"^".E D ENFF G:Y>0 @Y G A6
"RTN","PSGOE82",39,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,6) G A6
"RTN","PSGOE82",40,0)
 D YN I  S PSGHSM=$E(X)="Y" S MSG=0,PSGF2=5 G DONE
"RTN","PSGOE82",41,0)
 W $C(7) D ENHLP^PSGOEM(53.1,6) G A6
"RTN","PSGOE82",42,0)
 ;
"RTN","PSGOE82",43,0)
2 ; dispense drug multiple
"RTN","PSGOE82",44,0)
 S MSG=0,PSGF2=2,BACK="2^PSGOE82" K PSGOEEND
"RTN","PSGOE82",45,0)
 N PSGX,PSGXX F PSGXX=0:0 S PSGX=PSGXX,PSGXX=$O(^PS(53.45,PSJSYSP,2,PSGXX)) Q:'PSGXX
"RTN","PSGOE82",46,0)
 N PSJPNDRN I $G(PSGORD) I $E(PSGORD,$L(PSGORD))="P",$P($G(^PS(53.1,+PSGORD,0)),"^",24)="R" S PSJPNDRN=1 D
"RTN","PSGOE82",47,0)
 .S $P(PSJPNDRN,"^",2)="Dispense drugs for renewal orders cannot be deleted, but can be given an INACTIVE DATE.  "
"RTN","PSGOE82",48,0)
 N DA,DIC,DIE,DR,DIR S DIE="^PS(53.45,",DA=PSJSYSP,DR=2,DR(2,53.4502)=".01;.02"_$S($G(PSJPNDRN):";.03",1:"") D ^DIE
"RTN","PSGOE82",49,0)
 I '$O(^PS(53.45,PSJSYSP,2,0)) W $C(7),!!,"WARNING: This order must have at least one dispense drug before pharmacy can",!?9,"verify it!",! S MSG=1
"RTN","PSGOE82",50,0)
 D DDOC(PSGX)
"RTN","PSGOE82",51,0)
 NEW PSJDOSE
"RTN","PSGOE82",52,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOE82",53,0)
 I +$G(PSJDSFLG) D DSPWARN^PSJDOSE S PSGOEEF(109)=1
"RTN","PSGOE82",54,0)
 G DONE
"RTN","PSGOE82",55,0)
 ;
"RTN","PSGOE82",56,0)
40 ; comments
"RTN","PSGOE82",57,0)
 S MSG=0,PSGF2=40,BACK="40^PSGOE82",DA=PSJSYSP,DR=1,DIE="^PS(53.45," D ^DIE W ! G DONE
"RTN","PSGOE82",58,0)
 ;
"RTN","PSGOE82",59,0)
66 ; provider comments
"RTN","PSGOE82",60,0)
 ;S MSG=0,PSGF2=66,BACK="66^PSGOE82",DA=PSJSYSP,DR=4,DIE="^PS(53.45," D ^DIE W ! G DONE
"RTN","PSGOE82",61,0)
 ;
"RTN","PSGOE82",62,0)
DONE ;
"RTN","PSGOE82",63,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE82",64,0)
 K F,F0,PSGF2,F3,PSG,SDT Q
"RTN","PSGOE82",65,0)
 ;
"RTN","PSGOE82",66,0)
ENFF ; up-arrow to another field
"RTN","PSGOE82",67,0)
 S Y=-1 I '$D(PSGOEEF)!(X?1"^"1.9N) W $C(7),"  ??" Q
"RTN","PSGOE82",68,0)
 S X=$E(X,2,99) I X=+X S Y=$S($D(PSGOEEF(X)):X,1:-1) W "  " W:Y>0 $$CODES2^PSIVUTL(53.1,X) W:Y'>0 $C(7),"??" Q
"RTN","PSGOE82",69,0)
 K DIC S DIC="^DD(53.1,",DIC(0)="QEM",DIC("S")="I $D(PSGOEEF(+Y))" D ^DIC K DIC S Y=+Y S:Y>0 Y=$P($T(@("F"_Y)),";",3) Q
"RTN","PSGOE82",70,0)
 ;
"RTN","PSGOE82",71,0)
DEL ; delete entry
"RTN","PSGOE82",72,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE82",73,0)
 Q
"RTN","PSGOE82",74,0)
 ;
"RTN","PSGOE82",75,0)
YN ; yes/no as a set of codes
"RTN","PSGOE82",76,0)
 I X'?.U F Y=1:1:$L(X) I $E(X,Y)?1L S X=$E(X,1,Y-1)_$C($A(X,Y)-32)_$E(X,Y+1,$L(X))
"RTN","PSGOE82",77,0)
 F Y="NO","YES" I $P(Y,X)="" W $P(Y,X,2) Q
"RTN","PSGOE82",78,0)
 Q
"RTN","PSGOE82",79,0)
DDOC(PSGX) ; Order check on additional dispense drug for allergy and adv. reactions.
"RTN","PSGOE82",80,0)
 N PSGY,PSGND1,PSGND3,PSJALLGY
"RTN","PSGOE82",81,0)
 S PSGY=0 F  S PSGX=$O(^PS(53.45,PSJSYSP,2,PSGX)) Q:'PSGX  S PSGY=$P($G(^PS(53.45,PSJSYSP,2,PSGX,0)),"^") Q:PSGY=""  D
"RTN","PSGOE82",82,0)
 . N INTERVEN,PSJDDI,PSJIREQ,PSJRXREQ,PSJDD,PSGORQF,PSJPDRG S PSJDD=PSGY
"RTN","PSGOE82",83,0)
 . S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)=""
"RTN","PSGOE82",84,0)
 . I '$G(PSJALGY1) S PSJALLGY(PSJDD)="" D ALLERGY^PSJOC
"RTN","PSGOE82",85,0)
 . ;D IVSOL^PSGSICHK
"RTN","PSGOE82",86,0)
 . I ($D(PSGORQF)) D
"RTN","PSGOE82",87,0)
 .. K ^PS(53.45,PSJSYSP,2,PSGX),^PS(53.45,PSJSYSP,2,"B",PSGY)
"RTN","PSGOE82",88,0)
 Q
"RTN","PSGOE82",89,0)
 ;
"RTN","PSGOE82",90,0)
F101 ;;101^PSGOE8
"RTN","PSGOE82",91,0)
F109 ;;109^PSGOE8
"RTN","PSGOE82",92,0)
F3 ;;3^PSGOE8
"RTN","PSGOE82",93,0)
F7 ;;7^PSGOE8
"RTN","PSGOE82",94,0)
PSGF26 ;;26^PSGOE8
"RTN","PSGOE82",95,0)
F39 ;;39^PSGOE81
"RTN","PSGOE82",96,0)
F8 ;;8^PSGOE81
"RTN","PSGOE82",97,0)
F10 ;;10^PSGOE81
"RTN","PSGOE82",98,0)
PSGF25 ;;25^PSGOE81
"RTN","PSGOE82",99,0)
F1 ;;1^PSGOE82
"RTN","PSGOE82",100,0)
F5 ;;5^PSGOE82
"RTN","PSGOE82",101,0)
PSGF2 ;;2^PSGOE82
"RTN","PSGOEC")
0^77^B67778509
"RTN","PSGOEC",1,0)
PSGOEC ;BIR/CML3-CANCEL ORDERS ;02 Mar 99 / 9:29 AM
"RTN","PSGOEC",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**23,58,110,175,201,134,181**;16 DEC 97;Build 190
"RTN","PSGOEC",3,0)
 ;
"RTN","PSGOEC",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGOEC",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA 2789.
"RTN","PSGOEC",6,0)
 ; 
"RTN","PSGOEC",7,0)
ENA ; all orders
"RTN","PSGOEC",8,0)
 D ENCV^PSGSETU Q:$D(XQUIT)  S CF=$P(PSJSYSP0,U,5) N ND,ND1 S ND="$D(^PS(55,PSGP,5,PSGDA,4)),$P(^(4),U,12),$P(^(4),U,13)",ND1="$D(^PS(53.1,PSGDA,4)),$P(^(4),U,12),$P(^(4),U,13)"
"RTN","PSGOEC",9,0)
 F  W !!,"Do you want to ",$S(CF:"discontinue",1:"mark for discontinuation")," all of this patient's orders" S %=1 D YN^DICN Q:%  D ENCAM^PSGOEM
"RTN","PSGOEC",10,0)
 S PSGCF=0 Q:%<0  S PSGCF=1,T=$E("T",'PSJSYSU) G:%=1 ENCA F T=0:0 S T=$O(^PS(55,PSGP,5,"AUS",T)) Q:'T  F PSGDA=0:0 S PSGDA=$O(^PS(55,PSGP,5,"AUS",T,PSGDA)) Q:'PSGDA  I @ND Q
"RTN","PSGOEC",11,0)
 E  F PSGDA=0:0 S PSGDA=$O(^PS(53.1,"AC",PSGP,PSGDA)) Q:'PSGDA  I @ND1 Q
"RTN","PSGOEC",12,0)
 E  G DONE
"RTN","PSGOEC",13,0)
 W !!,"SOME OR ALL OF THESE ORDERS HAVE" D ENUMK^PSGOEM Q:%'=1
"RTN","PSGOEC",14,0)
 W !!,"...a few moments, please..." S PSGAL("C")=PSJSYSU*10+21400
"RTN","PSGOEC",15,0)
 F T=PSGDT:0 S T=$O(^PS(55,PSGP,5,"AUS",T)) Q:'T  F PSGDA=0:0 S PSGDA=$O(^PS(55,PSGP,5,"AUS",T,PSGDA)) Q:'PSGDA  I @ND W "." D RS,^PSGAL5
"RTN","PSGOEC",16,0)
 F PSGDA=0:0 S PSGDA=$O(^PS(53.1,"AC",PSGP,PSGDA)) Q:'PSGDA  I @ND1 W "." D RS
"RTN","PSGOEC",17,0)
 W " . . . DONE!" G DONE
"RTN","PSGOEC",18,0)
ENCA ;
"RTN","PSGOEC",19,0)
 D NOW^%DTC S (Q1,PSGDT)=+$E(%,1,12) F  S Q1=$O(^PS(55,PSGP,5,"AUS",Q1)) Q:'Q1  F Q2=0:0 S Q2=$O(^PS(55,PSGP,5,"AUS",Q1,Q2)) Q:'Q2  I $P($G(^PS(55,PSGP,5,Q2,0)),"^",21) Q
"RTN","PSGOEC",20,0)
 E  F Q2=0:0 S Q2=$O(^PS(53.1,"AC",PSGP,Q2)) Q:'Q2  I $P($G(^PS(53.1,Q2,0)),U,21) Q
"RTN","PSGOEC",21,0)
 I  S PSJNOO=$$ENNOO^PSJUTL5("D") I PSJNOO<0!('$$REQPROV) D  G DONE
"RTN","PSGOEC",22,0)
 .W !!,$C(7),"No changes made to this order." D PAUSE^VALM1
"RTN","PSGOEC",23,0)
 S PSGALR=$S('$D(PSGALO):20,PSGALO?4N&($E(PSGALO)=1):10,1:20) I $P(PSJSYSP0,U,5) D ENHE^PSJADT0 S PSGOP=PSGP D ASET
"RTN","PSGOEC",24,0)
 F SD=PSGDT:0 S SD=$O(^PS(55,PSGP,5,"AUS",SD)) Q:'SD  F PSGORD=0:0 S PSGORD=$O(^PS(55,PSGP,5,"AUS",SD,PSGORD)) Q:'PSGORD  S PSGORD=+PSGORD_"A" D AC
"RTN","PSGOEC",25,0)
 D NSET S CF=$P(PSJSYSP0,U,5) F PSGORD=0:0 S PSGORD=$O(^PS(53.1,"AC",PSGP,PSGORD)) Q:'PSGORD  S PSGORD=+PSGORD_"N" D NC
"RTN","PSGOEC",26,0)
 W " . . . DONE!" K PSGORD G DONE
"RTN","PSGOEC",27,0)
ENO(PSGP,PSGORD) ; single order
"RTN","PSGOEC",28,0)
 I PSGSTAT="D" W !,"This order has already been DISCONTINUED." D PAUSE^VALM1 Q
"RTN","PSGOEC",29,0)
 S CF=$S($P(PSJSYSP0,U,5):1,PSGORD["U":0,1:($P($G(^PS(53.1,+PSGORD,0)),U,25)=""&($P($G(^(4)),U,7)=DUZ)))
"RTN","PSGOEC",30,0)
 S PSJCOM=+$S(PSGORD["U":$P($G(^PS(55,PSGP,5,+PSGORD,.2)),"^",8),1:$P($G(^PS(53.1,+PSGORD,.2)),"^",8))
"RTN","PSGOEC",31,0)
 I 'CF,PSJCOM W !!,"This order is part of a complex order and CANNOT be marked for discontinuation." Q
"RTN","PSGOEC",32,0)
 I $$PNDRNOK(PSGORD) N PSJDCTYP S PSJDCTYP=$$PNDRNA(PSGORD) D:(PSJDCTYP=1!(PSJDCTYP=2)) PNDRN($G(PSJDCTYP),PSGORD) G DONE
"RTN","PSGOEC",33,0)
 I PSJCOM W !!,"This order is part of a complex order. If you discontinue this order the",!,"following orders will be discontinued too (unless the stop date has already",!,"been reached)." D CMPLX^PSJCOM1(PSGP,PSJCOM,PSGORD)
"RTN","PSGOEC",34,0)
 F  W !!,"Do you want to ",$S(PSJCOM:"discontinue this series of complex orders",CF:"discontinue this order",1:"mark this order for discontinuation") S %=$S($G(PSJOCFLG):2,1:1) D YN^DICN Q:%  D ENCOM^PSGOEM
"RTN","PSGOEC",35,0)
 I %<0 S VALMBCK="" Q
"RTN","PSGOEC",36,0)
 G:%=1 SOC I $S(PSGORD["U":$D(^PS(55,PSGP,5,+PSGORD,4)),1:$D(^PS(53.1,+PSGORD,4))),$P(^(4),U,12) W !!,"THIS ORDER HAS"
"RTN","PSGOEC",37,0)
 I  D ENUMK^PSGOEM I %=1 W "..." K DA S:PSGORD["A" PSGAL("C")=PSJSYSU*10+21400,DA=+PSGORD,DA(1)=PSGP D RS,^PSGAL5:PSGORD["A" W " . . . DONE!"
"RTN","PSGOEC",38,0)
 G DONE
"RTN","PSGOEC",39,0)
SOC ;
"RTN","PSGOEC",40,0)
 I 'CF,'$P($S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,0)),1:$G(^PS(53.1,+PSGORD,0))),U,21) W !!,"...one moment, please..."
"RTN","PSGOEC",41,0)
 E  I CF,'($G(PSJDCTYP)=2) S PSJNOO=$$ENNOO^PSJUTL5("D") I PSJNOO<0 D ABORT^PSGOEE G DONE
"RTN","PSGOEC",42,0)
 ; prompt for requesting provider
"RTN","PSGOEC",43,0)
 I '($G(PSJDCTYP)=2) I CF,'$$REQPROV D ABORT^PSGOEE G DONE
"RTN","PSGOEC",44,0)
 K DA D NOW^%DTC S PSGDT=%,T=$E("T",'PSJSYSU),PSGALR=20,DA=+PSGORD,DA(1)=PSGP
"RTN","PSGOEC",45,0)
 I 'PSJCOM D
"RTN","PSGOEC",46,0)
 .I PSGORD["U" D ASET:CF,AC
"RTN","PSGOEC",47,0)
 .I PSGORD'["U" D NSET:CF,NC
"RTN","PSGOEC",48,0)
 I PSJCOM N COMFLG S COMFLG=0 D
"RTN","PSGOEC",49,0)
 . I PSGORD["P" Q:('$$LOCK^PSJOEA(PSGP,PSJCOM))  D 
"RTN","PSGOEC",50,0)
 .. N O S O="" F  S O=$O(^PS(53.1,"ACX",PSJCOM,O)) Q:O=""  S (PSGORD,PSJORD)=O_"P" D NSET,NC
"RTN","PSGOEC",51,0)
 .I PSGORD["U" N O,OO S O=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  Q:COMFLG  D
"RTN","PSGOEC",52,0)
 .. Q:OO=PSGORD  I '$$LS^PSSLOCK(DFN,OO) S COMFLG=1 Q
"RTN","PSGOEC",53,0)
 I PSJCOM Q:COMFLG  N O,OO S O=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  D
"RTN","PSGOEC",54,0)
 . I OO["V" S ON55=OO D D1^PSIVOPT2 S PSIVALT=1,PSIVALCK="STOP",PSIVREA="D",ON=ON55,P(3)=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3) D
"RTN","PSGOEC",55,0)
 .. D LOG^PSIVORAL N PSJORD S PSJORD=ON55,P(3)=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3),P("NAT")=PSJNOO D HL^PSIVORA
"RTN","PSGOEC",56,0)
 . I OO["U" N PSGORD,PSJORD S (PSGORD,PSJORD)=OO D ASET^PSGOEC,AC^PSGOEC
"RTN","PSGOEC",57,0)
 Q
"RTN","PSGOEC",58,0)
D1 N %,DA,DIE,DIU,STP,NSTOP
"RTN","PSGOEC",59,0)
 D NOW^%DTC S NSTOP=+$E(%,1,12),STP=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3),NSTOP=+$S(STP>NSTOP:NSTOP,1:STP),P(17)="D"
"RTN","PSGOEC",60,0)
 S DA(1)=DFN,DA=+ON55,DIE="^PS(55,"_DFN_",""IV"",",DR="109////"_NSTOP_$S('$P($G(^PS(55,DFN,"IV",+ON55,2)),U,7):";116////"_STP,1:"")_";100///D;.03////"_NSTOP,PSIVACT=1 D ^DIE
"RTN","PSGOEC",61,0)
 I $S($G(PSIVAC)="OD":0,$G(PSIVAC)'="AD":1,$G(PSGALO)<1060:0,1:$P($G(PSJSYSW0),U,15)) S X=$S($G(PSIVAC)="AD":1,1:2) D ENLBL^PSIVOPT(X,$S(X=1:+$G(PSGUOW),1:DUZ),DFN,3,+ON55,$E("AD",1,3-X))
"RTN","PSGOEC",62,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN Q:'PSJIVORF  ;* S ORIFN=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,21) Q:'ORIFN
"RTN","PSGOEC",63,0)
 Q
"RTN","PSGOEC",64,0)
OUT ;
"RTN","PSGOEC",65,0)
 W $S(PSJCOM:"...ORDER ",1:"...ORDERS "),$S(CF:"DISCONTINUED!",1:"MARKED!") S PSGCANFL=1
"RTN","PSGOEC",66,0)
DONE ;
"RTN","PSGOEC",67,0)
 K CF,DA,DIE,DP,DR,ORIFN,ORETURN,PSGAL,PSGALR,PSGDA,SD,ST,T,UCF,Y,PSJDCTYP Q
"RTN","PSGOEC",68,0)
ASET ;
"RTN","PSGOEC",69,0)
 S DIE="^PS(55,"_PSGP_",5,",DR="136////@;28////"_$S($P($G(^PS(55,PSGP,5,+$G(PSJORD),0)),U,27)="E":"DE",$D(PSGEDIT):"DE",1:"D")_";Q;34////"_PSGDT_$S(T]"":";49////1",1:"")
"RTN","PSGOEC",70,0)
 Q
"RTN","PSGOEC",71,0)
NSET ;
"RTN","PSGOEC",72,0)
 S DIE="^PS(53.1,",DR="28////"_$S($P($G(^PS(53.1,+$G(PSJORD),0)),U,27)="E":"DE",$D(PSGEDIT):"DE",1:"D")_$S(T]"":";42////1",1:"")_";25////"_PSGDT Q
"RTN","PSGOEC",73,0)
AC ;
"RTN","PSGOEC",74,0)
 I 'CF K DA S $P(^PS(55,PSGP,5,+PSGORD,4),U,11,14)="^1^"_DUZ_U_PSGDT,PSGAL("C")=13040,DA=+PSGORD,DA(1)=PSGP D ^PSGAL5
"RTN","PSGOEC",75,0)
 I 'CF,$D(PSJSYSO) S PSGORD=+PSGORD_"A",PSGPOSA="C",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOEC",76,0)
 Q:'CF  K DA,ORIFN S PSGAL("C")=PSJSYSU*10+4000,DA=+PSGORD,DA(1)=PSGP D ^PSGAL5 S $P(^(2),U,3)=$P(^PS(55,PSGP,5,+PSGORD,2),U,4) D ^DIE S ^PS(55,"AUE",PSGP,+PSGORD)=""
"RTN","PSGOEC",77,0)
 I PSJSYSL K DA S $P(^PS(55,PSGP,5,+PSGORD,7),U,1,2)=PSGDT_U_$S($D(PSGEDIT):"DE",1:"D"),PSGTOL=2,PSGUOW=DUZ,PSGTOO=1,DA=+PSGORD,DA(1)=PSGP D ENL^PSGVDS
"RTN","PSGOEC",78,0)
 S ORIFN=$P($G(^PS(55,PSGP,5,+PSGORD,0)),U,21) D:ORIFN DCOR^PSGOECS
"RTN","PSGOEC",79,0)
 Q
"RTN","PSGOEC",80,0)
NC ;
"RTN","PSGOEC",81,0)
 I 'CF S $P(^PS(53.1,+PSGORD,4),"^",11,14)="^1^"_DUZ_U_PSGDT
"RTN","PSGOEC",82,0)
 I 'CF,$D(PSJSYSO) S PSGORD=+PSGORD_"N",PSGPOSA="C",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOEC",83,0)
 Q:'CF  S PSGSTAT=$P($G(^PS(53.1,+PSGORD,0)),U,9),PSGORIFN=$P($G(^(0)),U,21)
"RTN","PSGOEC",84,0)
 I PSGSTAT'="U" K DA,ORIFN S DA=+PSGORD D ^DIE I PSJSYSL,PSJSYSL<3,(PSGSTAT'="P") S $P(^PS(53.1,+PSGORD,7),U,1,2)=PSGDT_U_$S($D(PSGEDIT):"DE",1:"D"),PSGTOO=2,PSGUOW=DUZ,PSGTOL=2 D ENL^PSGVDS
"RTN","PSGOEC",85,0)
 I PSGSTAT="U" K DA S DA=+PSGORD,DIK="^PS(53.1," D ^DIK
"RTN","PSGOEC",86,0)
 I PSGORIFN S ORIFN=PSGORIFN D DCOR^PSGOECS
"RTN","PSGOEC",87,0)
 Q
"RTN","PSGOEC",88,0)
T ;
"RTN","PSGOEC",89,0)
 F  W !!,"Is this due to the patient being transferred" S %=2 D YN^DICN Q:%  D ENCTM^PSGOEM1
"RTN","PSGOEC",90,0)
 S T=$S(%<0:"^",1:$E("T",%=1)) Q
"RTN","PSGOEC",91,0)
RS ;
"RTN","PSGOEC",92,0)
 ; naked ref below is from variable ND1, ^PS(53.1,PSGDA,4)
"RTN","PSGOEC",93,0)
 S $P(^(4),U,11,14)="^^^" Q
"RTN","PSGOEC",94,0)
 ;
"RTN","PSGOEC",95,0)
REQPROV()          ;
"RTN","PSGOEC",96,0)
 I $G(PSJDCTYP)=2 Q 1
"RTN","PSGOEC",97,0)
 K PSJDCPRV,DIC,DUOUT,DTOUT,Y
"RTN","PSGOEC",98,0)
 N PROVIDER,PROVNAME,RESULT,RSB S RESULT=0
"RTN","PSGOEC",99,0)
 S PROVIDER=+$P($G(^PS(55,DFN,5.1)),"^",2),PROVNAME=""
"RTN","PSGOEC",100,0)
 I PROVIDER>0 D
"RTN","PSGOEC",101,0)
 .S DIC=200,DR="53.1;53.4",DIQ="RSB",DIQ(0)="I",DA=PROVIDER D EN^DIQ1
"RTN","PSGOEC",102,0)
 .K DIC,DR,DA,DIQ
"RTN","PSGOEC",103,0)
 .I $G(RSB(200,PROVIDER,53.1,"I"))="1"&(($G(RSB(200,PROVIDER,53.4,"I"))="")!($G(RSB(200,PROVIDER,53.4,"I"))>DT)) D
"RTN","PSGOEC",104,0)
 ..S DIC=200,DA=PROVIDER,DR=".01",DIQ="RSB",DIQ(0)="E" D EN^DIQ1
"RTN","PSGOEC",105,0)
 ..S PROVNAME=$G(RSB(200,PROVIDER,.01,"E")) K DA,DIQ,DR
"RTN","PSGOEC",106,0)
 K DIC S DIC=200,DIC(0)="AEMQZ"
"RTN","PSGOEC",107,0)
 S:PROVNAME]"" DIC("B")=PROVNAME
"RTN","PSGOEC",108,0)
 S DIC("A")="Requesting PROVIDER: "
"RTN","PSGOEC",109,0)
 S DIC("S")="I $D(^(""PS"")),^(""PS""),$S('$P(^(""PS""),""^"",4):1,1:$P(^(""PS""),""^"",4)>DT)" D ^DIC K DIC
"RTN","PSGOEC",110,0)
 I +Y>0,'$D(DUOUT),'$D(DTOUT) S RESULT=1,PSJDCPRV=+Y
"RTN","PSGOEC",111,0)
 Q RESULT
"RTN","PSGOEC",112,0)
 ;
"RTN","PSGOEC",113,0)
PNDRNA(ORDER) ; Ask Discontinue Pending Renewal only, or both Pending Renew and Renewed Order
"RTN","PSGOEC",114,0)
 ; Perform this action only for pending renewals
"RTN","PSGOEC",115,0)
 I '$G(ORDER)!'($G(ORDER)["P") Q 3
"RTN","PSGOEC",116,0)
 ; Quit if original order is no longer active
"RTN","PSGOEC",117,0)
 N ORIGORD,ORIGSTOP S ORIGORD=$P($G(^PS(53.1,+ORDER,0)),"^",25) Q:'ORIGORD  D  I ORIGSTOP<$G(PSGDT) Q 1
"RTN","PSGOEC",118,0)
 .S ORIGSTOP=$S(ORIGORD["U":$P($G(^PS(55,PSGP,5,+ORIGORD,2)),"^",4),ORIGORD["V":$P($G(^PS(55,PSGP,"IV",+ORIGORD,0)),"^",3),1:"")
"RTN","PSGOEC",119,0)
 N NDP2
"RTN","PSGOEC",120,0)
 S NDP2=^PS(53.1,+ORDER,.2) S DRG=NDP2,DO=$P(DRG,"^",2) S DRG=$$ENPDN^PSGMI($P(DRG,"^"))
"RTN","PSGOEC",121,0)
 S ND2=^PS(53.1,+ORDER,2) S SCH=$P(ND2,"^"),START=$P(ND2,"^",2),START=$$FMTE^XLFDT(START,2)
"RTN","PSGOEC",122,0)
 W !!?5,DRG_" "_DO
"RTN","PSGOEC",123,0)
 W !?5,"This order has a pending status. If this pending order"
"RTN","PSGOEC",124,0)
 W !?5,"is discontinued, the original order may still be active."
"RTN","PSGOEC",125,0)
 S DIR("A")="Select order(s) to discontinue"
"RTN","PSGOEC",126,0)
 S DIR(0)="S^1:DC BOTH Orders;2:DC Pending Order;3:Cancel - No Action Taken"
"RTN","PSGOEC",127,0)
 S DIR("L",1)="1 - DC BOTH Orders"
"RTN","PSGOEC",128,0)
 S DIR("L",2)="2 - DC Pending Order"
"RTN","PSGOEC",129,0)
 S DIR("L",3)="3 - Cancel - No Action Taken" D ^DIR
"RTN","PSGOEC",130,0)
 ; Reverse order - Y=1 - Pending only  Y=2:BOTH
"RTN","PSGOEC",131,0)
 S Y=$S(Y=1:2,Y=2:1,1:3)
"RTN","PSGOEC",132,0)
 Q Y
"RTN","PSGOEC",133,0)
 ;
"RTN","PSGOEC",134,0)
PNDRN(PSJDCTYP,ORDER) ; Perform Discontinue action for Pending order only or both Pending and Renewed
"RTN","PSGOEC",135,0)
 ; Perform this action only for pending renewals
"RTN","PSGOEC",136,0)
 N PSGORD S PSGORD=ORDER
"RTN","PSGOEC",137,0)
 Q:'$G(PSGORD)!'($G(PSGORD)["P")
"RTN","PSGOEC",138,0)
 I PSJDCTYP=1 G SOC
"RTN","PSGOEC",139,0)
 I PSJDCTYP=2 S PSJDCTYP=1 D SOC Q:'$G(PSJDCTYP)  D
"RTN","PSGOEC",140,0)
 .I ($G(PSJNOO)<0) Q
"RTN","PSGOEC",141,0)
 .N ND5310 S ND5310=$G(^PS(53.1,+PSGORD,0))
"RTN","PSGOEC",142,0)
 .N PSGORD S PSGORD=$P(ND5310,"^",25) I PSGORD S PSJDCTYP=2 D SOC K PSJDCTYP
"RTN","PSGOEC",143,0)
 Q
"RTN","PSGOEC",144,0)
 ;
"RTN","PSGOEC",145,0)
PNDRNOK(ORDER) ; Execute DC Pending Renew enhancement only if 
"RTN","PSGOEC",146,0)
 ;                  1) Renewal order is pending/non-verified, and 
"RTN","PSGOEC",147,0)
 ;                  2) Original order is not DC'd or Expired
"RTN","PSGOEC",148,0)
 Q:'$G(PSGORD)!'($G(PSGORD)["P") 0
"RTN","PSGOEC",149,0)
 N ORIGORD,ORIGSTOP S ORIGORD=$P($G(^PS(53.1,+ORDER,0)),"^",25) Q:'ORIGORD 0  D  I ORIGSTOP<$G(PSGDT) Q 0
"RTN","PSGOEC",150,0)
 .S ORIGSTOP=$S(ORIGORD["U":$P($G(^PS(55,PSGP,5,+ORIGORD,2)),"^",4),ORIGORD["V":$P($G(^PS(55,PSGP,"IV",+ORIGORD,0)),"^",3),1:"")
"RTN","PSGOEC",151,0)
 Q:'($P($G(^PS(53.1,+PSGORD,0)),U,24)="R") 0
"RTN","PSGOEC",152,0)
 Q 1
"RTN","PSGOECS")
0^78^B48391335
"RTN","PSGOECS",1,0)
PSGOECS ;BIR/CML3-CANCEL SELECTED ORDERS ;02 Mar 99 / 9:29 AM
"RTN","PSGOECS",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**23,29,44,58,81,110,134,181**;16 DEC 97;Build 190
"RTN","PSGOECS",3,0)
 ;
"RTN","PSGOECS",4,0)
 ; Reference to FULL^VALM1 is supported by DBIA# 10116.
"RTN","PSGOECS",5,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGOECS",6,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789.
"RTN","PSGOECS",7,0)
 ;
"RTN","PSGOECS",8,0)
AM ;
"RTN","PSGOECS",9,0)
 W !,"...marking ",$P(X,U),"..." S $P(^PS(55,PSGP,5,DA,4),"^",11,14)="^1^"_DUZ_"^"_PSGDT,PSGAL("C")=13040 W "." D ^PSGAL5 W "."
"RTN","PSGOECS",10,0)
 I $D(PSJSYSO) S PSGORD=+PSGORD_"A",PSGPOSA="C",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOECS",11,0)
 Q
"RTN","PSGOECS",12,0)
 ;
"RTN","PSGOECS",13,0)
NM ;
"RTN","PSGOECS",14,0)
 W !,"...marking ",$P(X,U),"..." S $P(^PS(53.1,DA,4),"^",11,14)="^1^"_DUZ_"^"_PSGDT W "."
"RTN","PSGOECS",15,0)
 I $D(PSJSYSO) S PSGORD=+PSGORD_"N",PSGPOSD=PSGDT,PSGPOSA="C" D ENPOS^PSGVDS
"RTN","PSGOECS",16,0)
 Q
"RTN","PSGOECS",17,0)
 ;
"RTN","PSGOECS",18,0)
AC ; discontinue active order
"RTN","PSGOECS",19,0)
 K DA S DA(1)=PSGP,DA=+PSGORD
"RTN","PSGOECS",20,0)
 S X=$G(^PS(55,PSGP,5,DA,.2))
"RTN","PSGOECS",21,0)
 I $P(X,U,4)="D" W !,$P($$DRUGNAME^PSJLMUTL(DFN,PSGORD),U,1),!,"NO ACTION WAS TAKEN ON DONE ORDER",!,$C(7) HANG 1 Q 
"RTN","PSGOECS",22,0)
 NEW XX S XX=$P(^PS(55,PSGP,5,DA,0),U,9)
"RTN","PSGOECS",23,0)
 I $S(XX="E":1,XX="D":1,XX="DE":1,1:0) W !,$P($$DRUGNAME^PSJLMUTL(DFN,PSGORD),U,1),!,"NO ACTION WAS TAKEN ON "_$$CODES^PSIVUTL(XX,55.06,28)_" ORDER",!,$C(7) HANG 1 Q
"RTN","PSGOECS",24,0)
 S X=$$DRUGNAME^PSJLMUTL(PSGP,PSGORD)
"RTN","PSGOECS",25,0)
 I '$P(PSJSYSP0,"^",5) D AM Q
"RTN","PSGOECS",26,0)
 W !,"...discontinuing ",$P(X,U),"...",! S PSGAL("C")=PSJSYSU*10+4000 D ^PSGAL5
"RTN","PSGOECS",27,0)
 S PSGALR=20,DIE="^PS(55,"_PSGP_",5,",DR="136////@;28////D;Q;34////"_PSGDT_$S(PSJSYSU:"",1:";49////1"),DP=55.06,$P(^(2),"^",3)=$P(^PS(55,PSGP,5,DA,2),"^",4) D ^DIE S ^PS(55,"AUE",PSGP,DA)=""
"RTN","PSGOECS",28,0)
 D EN1^PSJHL2(PSGP,"OD",PSGORD) S DA(1)=PSGP,DA=+PSGORD
"RTN","PSGOECS",29,0)
 I PSJSYSL S $P(^PS(55,PSGP,5,DA,7),"^",1,2)=PSGDT_"^D",PSGTOL=2,PSGUOW=DUZ,PSGTOO=1 D ENL^PSGVDS
"RTN","PSGOECS",30,0)
 Q
"RTN","PSGOECS",31,0)
 ;
"RTN","PSGOECS",32,0)
NC ; discontinue non-verified order
"RTN","PSGOECS",33,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S PSJDCTYP=$$PNDRNA^PSGOEC(PSGORD) I $G(PSJDCTYP)'=1 D PNDRN($G(PSJDCTYP)) Q
"RTN","PSGOECS",34,0)
NC2 ; Called from PNDRN to discontinue both pending renewal and original order
"RTN","PSGOECS",35,0)
 K DA S DA=+PSGORD,X=$G(^PS(53.1,DA,.2)),X=$$DRUGNAME^PSJLMUTL(PSGP,PSGORD)
"RTN","PSGOECS",36,0)
 I $S($P(PSJSYSP0,"^",5):0,'$D(^PS(53.1,DA,4)):1,1:$P(^(4),"^",7)'=DUZ) D NM Q
"RTN","PSGOECS",37,0)
 W !,"...discontinuing ",$P(X,U),"...",! S DIE="^PS(53.1,",DR="28////D"_$S(PSJSYSU:"",1:";42////1") D ^DIE
"RTN","PSGOECS",38,0)
 D EN1^PSJHL2(PSGP,"OC",PSGORD)
"RTN","PSGOECS",39,0)
 S DA=+PSGORD I PSJSYSL,PSJSYSL<3 S $P(^PS(53.1,DA,7),"^",1,2)=PSGDT_"^D",PSGTOO=2,PSGUOW=DUZ,PSGTOL=2 D ENL^PSGVDS
"RTN","PSGOECS",40,0)
 I $G(PSJDCTYP) D UNL^PSSLOCK(DFN,PSGORD)
"RTN","PSGOECS",41,0)
 Q
"RTN","PSGOECS",42,0)
 ;
"RTN","PSGOECS",43,0)
EN ; enter here
"RTN","PSGOECS",44,0)
 I $G(PSJIVPRF) D ^PSIVSPDC Q  ;Use for Speed DC in IV Order Profile
"RTN","PSGOECS",45,0)
 D FULL^VALM1
"RTN","PSGOECS",46,0)
EN1 ;
"RTN","PSGOECS",47,0)
 S (PSGONC,PSGLMT)=PSJOCNT,PSGONW="C" D ENWO^PSGON I "^"[X K X G RESET
"RTN","PSGOECS",48,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12)
"RTN","PSGOECS",49,0)
 W ! F PSGOECS=1:1:PSGODDD F PSGOECS1=1:1 S PSGOECS2=$P(PSGODDD(PSGOECS),",",PSGOECS1) Q:'PSGOECS2  D
"RTN","PSGOECS",50,0)
 .S PSGORD=^TMP("PSJON",$J,PSGOECS2) ; I $P($G(@($S((PSGORD["A")!(PSGORD["U"):"^PS(55,"_PSGP_",5,",(PSGORD["V"):"^PS(55,"_PSGP_",""IV"",",1:"^PS(53.1,")_(+PSGORD)_",0)")),"^",21) Q
"RTN","PSGOECS",51,0)
 S PSJNOO=$$ENNOO^PSJUTL5("D") G:PSJNOO<0 EN1
"RTN","PSGOECS",52,0)
 ;Prompt for requesting provider
"RTN","PSGOECS",53,0)
 W ! I '$$REQPROV^PSGOEC G EN1
"RTN","PSGOECS",54,0)
 W !
"RTN","PSGOECS",55,0)
 ;
"RTN","PSGOECS",56,0)
 ;F PSGOECS=1:1:PSGODDD F PSGOECS1=1:1 S PSGOECS2=$P(PSGODDD(PSGOECS),",",PSGOECS1) Q:'PSGOECS2  S (ON,PSGORD)=^TMP("PSJON",$J,PSGOECS2) D:(PSGORD["U") AC D:(PSGORD["P") NC D:(PSGORD["V") SPDCIV^PSIVSPDC
"RTN","PSGOECS",57,0)
 ;Replaced above line with block structure below.
"RTN","PSGOECS",58,0)
 N COMFLG,PSJCOM S (EXITLOOP,PSJCOM)=0
"RTN","PSGOECS",59,0)
 F PSGOECS=1:1:PSGODDD D
"RTN","PSGOECS",60,0)
 .F PSGOECS1=1:1 D  Q:EXITLOOP=1
"RTN","PSGOECS",61,0)
 ..S PSGOECS2=$P(PSGODDD(PSGOECS),",",PSGOECS1)
"RTN","PSGOECS",62,0)
 ..I 'PSGOECS2 S EXITLOOP=1 Q
"RTN","PSGOECS",63,0)
 ..S (ON,PSGORD)=^TMP("PSJON",$J,PSGOECS2)
"RTN","PSGOECS",64,0)
 ..I PSGORD=+PSGORD D DCCOM Q
"RTN","PSGOECS",65,0)
 ..I '$$LS^PSSLOCK(DFN,PSGORD) D  Q
"RTN","PSGOECS",66,0)
 ... W:PSGORD'["V" !,$P($$DRUGNAME^PSJLMUTL(DFN,PSGORD),"^",1),!,"NO ACTION WAS TAKEN",!,$C(7) HANG 1 Q
"RTN","PSGOECS",67,0)
 ... W ! I PSGORD["V" N PSJLINE S PSJLINE=1 D DSPLORDV^PSJLMUT1(PSGP,PSGORD) D  W !,"NO ACTION WAS TAKEN",!,$C(7) HANG 1
"RTN","PSGOECS",68,0)
 ....F X=0:0 S X=$O(PSJOC(ON,X)) Q:'X  D
"RTN","PSGOECS",69,0)
 .....W !,$G(PSJOC(ON,X))
"RTN","PSGOECS",70,0)
 ..D CHKCOM I COMFLG  D
"RTN","PSGOECS",71,0)
 ... I PSGORD'["V" W !,$P($$DRUGNAME^PSJLMUTL(DFN,PSGORD),"^",1),!,"NO ACTION WAS TAKEN",!,$C(7) HANG 1 Q
"RTN","PSGOECS",72,0)
 ... W ! I PSGORD["V" N PSJLINE S PSJLINE=1 D DSPLORDV^PSJLMUT1(PSGP,PSGORD) D  W !,"NO ACTION WAS TAKEN",!,$C(7) HANG 1
"RTN","PSGOECS",73,0)
 ....F X=0:0 S X=$O(PSJOC(ON,X)) Q:'X  D
"RTN","PSGOECS",74,0)
 .....W !,$G(PSJOC(ON,X))
"RTN","PSGOECS",75,0)
 ..Q:PSJCOM
"RTN","PSGOECS",76,0)
 ..D:(PSGORD["U") AC
"RTN","PSGOECS",77,0)
 ..D:(PSGORD["P") NC
"RTN","PSGOECS",78,0)
 ..D:(PSGORD["V") SPDCIV^PSIVSPDC
"RTN","PSGOECS",79,0)
 ..; Call the unlock procedure
"RTN","PSGOECS",80,0)
 ..D UNL^PSSLOCK(DFN,PSGORD)
"RTN","PSGOECS",81,0)
 S X=""
"RTN","PSGOECS",82,0)
RESET ;
"RTN","PSGOECS",83,0)
 I $G(PSGORD)["V" D INIT^PSJLMHED(3) S VALMBK="R" G DONE
"RTN","PSGOECS",84,0)
 D INIT^PSJLMHED(1) S VALMBCK="R"
"RTN","PSGOECS",85,0)
 ;
"RTN","PSGOECS",86,0)
DONE ;
"RTN","PSGOECS",87,0)
 K DA,DIE,DP,DR,PSGAL,PSGALR,PSGLMT,PSGODDD,PSGOECS,PSGOECS1,PSGOECS2,PSGONW,PSGORD,PSGPOSA,PSGPOSD,PSGTOL,PSGTOO,PSGUOW,ORIFN,ORETURN,ORNATR
"RTN","PSGOECS",88,0)
 Q
"RTN","PSGOECS",89,0)
 ;
"RTN","PSGOECS",90,0)
DCOR ; Create DC order/update stop date in OE/RR.
"RTN","PSGOECS",91,0)
 S PSOC=$S(PSGORD["P":"OC",PSGORD["N":"OC",1:"OD")
"RTN","PSGOECS",92,0)
 D EN1^PSJHL2(PSGP,PSOC,PSGORD)
"RTN","PSGOECS",93,0)
 Q
"RTN","PSGOECS",94,0)
 ;
"RTN","PSGOECS",95,0)
ENOR ;
"RTN","PSGOECS",96,0)
 K DA S PSGEDIT=$S($D(PSGEDIT):PSGEDIT,1:"D"),CF=1,PSGALR=20,DA=+PSGORD,T="" I PSGORD'["U",(PSGORD'["O") D:CF NSET^PSGOEC D NC^PSGOEC D ENOR2 G DONE^PSGOEC
"RTN","PSGOECS",97,0)
 S DA(1)=PSGP D:CF ASET^PSGOEC D AC^PSGOEC
"RTN","PSGOECS",98,0)
 G DONE^PSGOEC
"RTN","PSGOECS",99,0)
 ;
"RTN","PSGOECS",100,0)
ENOR2 ;Check to see if order being DC'd is a Pending Renewal and is being DC'd due to edit.
"RTN","PSGOECS",101,0)
 I PSGEDIT="DE",$P(^PS(53.1,+PSGORD,0),U,25),$P(^PS(53.1,+PSGORD,0),U,24)="R",PSGSD<$P($G(^PS(55,PSGP,5,+$P(^PS(53.1,+PSGORD,0),U,25),2)),U,4) D
"RTN","PSGOECS",102,0)
 .K DA,DR S DA(1)=PSGP,DA=+$P(^PS(53.1,+PSGORD,0),U,25),DIE="^PS(55,"_PSGP_",5,",DR="34////"_PSGSD_";25////"_$P($G(^PS(55,PSGP,5,+$P(^PS(53.1,+PSGORD,0),U,25),2)),U,4)
"RTN","PSGOECS",103,0)
 .D ^DIE,EN1^PSJHL2(PSGP,"XX",$P(^PS(53.1,+PSGORD,0),U,25))
"RTN","PSGOECS",104,0)
 Q
"RTN","PSGOECS",105,0)
 ;
"RTN","PSGOECS",106,0)
CHKCOM ;Check to see if order is part of complex order series.
"RTN","PSGOECS",107,0)
 S PSJCOM=$S(PSGORD["V":$P($G(^PS(55,PSGP,"IV",+PSGORD,.2)),U,8),PSGORD["U":$P($G(^PS(55,PSGP,5,+PSGORD,.2)),U,8),1:$P($G(^PS(53.1,+PSGORD,.2)),U,8)),COMFLG=0
"RTN","PSGOECS",108,0)
 N PSJSTAT S PSJSTAT=$S(PSGORD["V":$P($G(^PS(55,PSGP,"IV",+PSGORD,0)),"^",17),PSGORD["U":$P($G(^PS(55,PSGP,5,+PSGORD,0)),"^",9),1:$P($G(^PS(53.1,+PSGORD,0)),"^",9))
"RTN","PSGOECS",109,0)
 Q:'PSJCOM  I "DE"[PSJSTAT Q
"RTN","PSGOECS",110,0)
 W ! I PSGORD["V" N PSJLINE S PSJLINE=1 D DSPLORDV^PSJLMUT1(PSGP,PSGORD) D
"RTN","PSGOECS",111,0)
 .F X=0:0 S X=$O(PSJOC(ON,X)) Q:'X  D
"RTN","PSGOECS",112,0)
 ..W !,$G(PSJOC(ON,X))
"RTN","PSGOECS",113,0)
 I PSGORD["U" W !,$P($$DRUGNAME^PSJLMUTL(PSGP,PSGORD),"^",1) D
"RTN","PSGOECS",114,0)
 .W !!,"is part of a complex order. If you discontinue this order the following orders",!,"will be discontinued too (unless the stop date has already been reached)." D CMPLX^PSJCOM1(PSGP,PSJCOM,PSGORD)
"RTN","PSGOECS",115,0)
 F  W !!,"Do you want to discontinue this series of complex orders" S %=1 D YN^DICN Q:%
"RTN","PSGOECS",116,0)
 I %'=1 S COMFLG=1 Q
"RTN","PSGOECS",117,0)
 N O,OO S O=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  D  Q:COMFLG
"RTN","PSGOECS",118,0)
 .Q:OO=PSGORD  I '$$LS^PSSLOCK(DFN,OO) S COMFLG=1 Q
"RTN","PSGOECS",119,0)
 Q:COMFLG
"RTN","PSGOECS",120,0)
 N O,OO S O=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  D
"RTN","PSGOECS",121,0)
 .I (OO["U") N PSGORD S PSGORD=OO D AC
"RTN","PSGOECS",122,0)
 .I (OO["V") N PSGORD S (ON,PSGORD)=OO D SPDCIV^PSIVSPDC
"RTN","PSGOECS",123,0)
 .D UNL^PSSLOCK(DFN,PSGORD)
"RTN","PSGOECS",124,0)
 Q
"RTN","PSGOECS",125,0)
 ;
"RTN","PSGOECS",126,0)
DCCOM ;DC pending/non-verified complex order
"RTN","PSGOECS",127,0)
 I '$$LOCK^PSJOEA(DFN,PSGORD) W !,"Order # ",PSGOECS2," could not be discontinued.",!,$C(7) HANG 1 Q
"RTN","PSGOECS",128,0)
 N PSGORD1 S PSGORD1=PSGORD
"RTN","PSGOECS",129,0)
 N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSGORD1,PSJO)) Q:'PSJO  S PSGORD=PSJO_"P" D NC
"RTN","PSGOECS",130,0)
 Q
"RTN","PSGOECS",131,0)
PNDRN(PSJDCTYP) ; Discontinue both pending renewal and original order
"RTN","PSGOECS",132,0)
 N TMPORD S TMPORD=$G(PSGORD)
"RTN","PSGOECS",133,0)
 I PSJDCTYP=2 S PSJDCTYP=1 D NC2 Q:'$G(PSJDCTYP)  D
"RTN","PSGOECS",134,0)
 .I ($G(PSJNOO)<0) Q
"RTN","PSGOECS",135,0)
 .N ND5310 S ND5310=$G(^PS(53.1,+PSGORD,0))
"RTN","PSGOECS",136,0)
 .N PSGORD S PSGORD=$P(ND5310,"^",25) I PSGORD S PSJDCTYP=2 D
"RTN","PSGOECS",137,0)
 ..I '$$LS^PSSLOCK(DFN,PSGORD) K PSJDCTYP Q
"RTN","PSGOECS",138,0)
 ..D @$S(PSGORD["U":"AC",PSGORD["V":"SPDCIV^PSIVSPDC",1:"")
"RTN","PSGOECS",139,0)
 S PSGORD=TMPORD
"RTN","PSGOECS",140,0)
 Q
"RTN","PSGOEE")
0^79^B73215103
"RTN","PSGOEE",1,0)
PSGOEE ;BIR/CML3-EDIT ACTIVE OR NON-VERIFIED ORDERS ; 8/12/10 5:59pm
"RTN","PSGOEE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**4,7,29,47,64,58,82,91,110,111,112,142,179,181**;16 DEC 97;Build 190
"RTN","PSGOEE",3,0)
 ;
"RTN","PSGOEE",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGOEE",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA# 2789.
"RTN","PSGOEE",6,0)
 ;
"RTN","PSGOEE",7,0)
 D NOW^%DTC S PSGDT=% K PSGEFN,PSGOEEF S PSGOEEF=0 I PSGORD["A"!(PSGORD["O") G ACT
"RTN","PSGOEE",8,0)
531 ; edit orders in 53.1
"RTN","PSGOEE",9,0)
ENF ;
"RTN","PSGOEE",10,0)
 D EN2^PSGOEEW
"RTN","PSGOEE",11,0)
 K PSJACEPT D EDLOOP G:'$G(PSJACEPT) OUT
"RTN","PSGOEE",12,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",13,0)
 . N PSGOEENO S PSGOEENO=1 D NEW
"RTN","PSGOEE",14,0)
 E  D
"RTN","PSGOEE",15,0)
 . N PSGOEENO S PSGOEENO=0 D UPD
"RTN","PSGOEE",16,0)
 I $G(PSGOEAV) D ACT1 Q
"RTN","PSGOEE",17,0)
 D DONE1
"RTN","PSGOEE",18,0)
 S PSGOEEF=0,PSJORD=PSGORD D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD)
"RTN","PSGOEE",19,0)
 Q
"RTN","PSGOEE",20,0)
ACT ;
"RTN","PSGOEE",21,0)
 NEW PSJALGY1
"RTN","PSGOEE",22,0)
 K PSGOEER
"RTN","PSGOEE",23,0)
 D EN2^PSGOEEW,EDLOOP G:'$G(PSJACEPT) OUT
"RTN","PSGOEE",24,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",25,0)
 . N PSGOEENO S PSGOEENO=1 D NEW
"RTN","PSGOEE",26,0)
 E  D
"RTN","PSGOEE",27,0)
 . N PSGOEENO S PSGOEENO=0 D UPD
"RTN","PSGOEE",28,0)
 S:$D(PSGOEF)!$G(PSGOEENO) PSGCANFL=-1
"RTN","PSGOEE",29,0)
ACT1 ;I 'PSGOEAV,PSJSYSL>1 S $P(@($S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSGORD_",7)"),"^",1,2)=PSGDT_"^"_$E("D",PSGOEENO)_"E",PSGTOL=2,PSGUOW=DUZ,PSGTOO=PSGORD'["U"+1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOEE",30,0)
 D DONE1
"RTN","PSGOEE",31,0)
 S PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD) D:PSGOEAV UNL^PSSLOCK(PSGP,PSGORD)
"RTN","PSGOEE",32,0)
 Q
"RTN","PSGOEE",33,0)
EDIT ;
"RTN","PSGOEE",34,0)
 D FULL^VALM1
"RTN","PSGOEE",35,0)
 W ! S PSGOEER="" F Q=1:1 S Q1=$P(Y,",",Q) Q:'Q1  S X=$P($T(@(PSGOEEG_Q1)),";",3),PSGOEER=PSGOEER_X_";",PSGOEEF(+X)=Q S:Q1=1 PSJALGY1=1
"RTN","PSGOEE",36,0)
 S LIMIT=$L(PSGOEER,";")-1,(PSGDEF,PSGOEE)=0 F  S PSGOEE=PSGOEE+1 Q:PSGOEE>LIMIT  I +$P(PSGOEER,";",PSGOEE)=101 S PSGDEF=1
"RTN","PSGOEE",37,0)
 S PSGOEER=$E(PSGOEER,1,$L(PSGOEER)-1),(MSG,PSGOEE)=0 F  S PSGOEE=PSGOEE+1 Q:PSGOEE>$L(PSGOEER,";")  S F1=$S(PSGOEEG=3:53.1,1:55.06) I 'PSGDEF!((PSGDEF)&(+$P(PSGOEER,";",PSGOEE)'=2)) D @$P(PSGOEER,";",PSGOEE) Q:'PSGOEE
"RTN","PSGOEE",38,0)
 Q
"RTN","PSGOEE",39,0)
EDLOOP ; Continue prompting for fields to edit.
"RTN","PSGOEE",40,0)
 K PSJNOO
"RTN","PSGOEE",41,0)
 D:$G(Y) EDIT
"RTN","PSGOEE",42,0)
 D ENNOU^PSGOEE0 I '$G(PSGOEENO),DR="" S VALMBCK="R" Q
"RTN","PSGOEE",43,0)
 K VALMSG
"RTN","PSGOEE",44,0)
 I '$G(PSGOEENO),$G(PSGPDNX) D CKDT
"RTN","PSGOEE",45,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",46,0)
 .S VALMSG="This change will cause a new order to be created." D GTSTATUS,CHKDD,CKDT
"RTN","PSGOEE",47,0)
 .S PSGEBN=$$ENNPN^PSGMI(DUZ),PSGLIN=$$ENDD^PSGMI(PSGDT)_U_$$ENDTC^PSGMI(PSGDT)
"RTN","PSGOEE",48,0)
 D CHK^PSGOEV("^^"_PSGMR_"^^^^"_PSGST,PSGPDRG_U_PSGDO,PSGSCH_U_PSGSD_"^^"_PSGFD)
"RTN","PSGOEE",49,0)
 K VALMBCK,PSJACEPT,PSGPDNX D EN^VALM("PSJU LM ACCEPT") Q:'$G(PSJACEPT)
"RTN","PSGOEE",50,0)
 I $G(PSGS0XT)="D",'$G(PSGS0Y) I ((",P,R,")'[(","_$G(PSGST)_",")) D  Q
"RTN","PSGOEE",51,0)
 .S PSJACEPT=0 W !!,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D PAUSE^VALM1
"RTN","PSGOEE",52,0)
 I ($G(PSGOEER)["26^PSGOE9")!($G(PSGOEER)["26^PSGOE8")!($G(PSGOEER)["109^PSGOE9")!($G(PSGOEER)["109^PSGOE8")!($G(PSGOEER)["3^PSGOE9")!($G(PSGOEER)["3^PSGOE8")!($G(PSGOEER)["101^PSGOE9")!($G(PSGOEER)["101^PSGOE8") S PSGOEENO=1
"RTN","PSGOEE",53,0)
 I $G(PSGOEENO)!($G(PSGOEER)["2^PSGOE92")!($G(PSGOEER)["2^PSGOE82") D OC
"RTN","PSGOEE",54,0)
 I $G(PSGORQF) S PSJNOO=-1
"RTN","PSGOEE",55,0)
 I '$G(PSJNOO),$G(PSGOEENO) S PSJNOO=$$ENNOO^PSJUTL5("E")
"RTN","PSGOEE",56,0)
 D K1 S PSJACEPT=$S($G(PSJNOO)<0:0,1:1)
"RTN","PSGOEE",57,0)
 S VALMBCK=$S('PSJACEPT:"R",'PSGOEAV:"R",1:"Q")
"RTN","PSGOEE",58,0)
 Q
"RTN","PSGOEE",59,0)
OC ;Perform OC (only when OI was edited) & dosing check
"RTN","PSGOEE",60,0)
 NEW PSJDD,PSJALLGY
"RTN","PSGOEE",61,0)
 K PSGORQF
"RTN","PSGOEE",62,0)
 D FULL^VALM1
"RTN","PSGOEE",63,0)
 S PSJDD=+$$DD53P45^PSJMISC() I 'PSJDD S PSGORQF=1 Q
"RTN","PSGOEE",64,0)
 I $G(PSJALGY1),$G(PSGOEENO) D
"RTN","PSGOEE",65,0)
 . D ENDDC^PSGSICHK(PSGP,PSJDD)
"RTN","PSGOEE",66,0)
 D:'$G(PSGORQF) IN^PSJOCDS($G(PSGORD),"UD",PSJDD)
"RTN","PSGOEE",67,0)
 Q
"RTN","PSGOEE",68,0)
CHKDD ;*** Check inactive Dispense drug within the order.
"RTN","PSGOEE",69,0)
 D CHKDRG^PSGOE2
"RTN","PSGOEE",70,0)
 Q
"RTN","PSGOEE",71,0)
CKDT ; Check if new start/stop dates should be calculated.
"RTN","PSGOEE",72,0)
 S PSGS0Y=$S($D(PSGS0Y):PSGS0Y,1:$G(PSGAT))
"RTN","PSGOEE",73,0)
 ;PSJ*5*179 Recalc start date if Before last given
"RTN","PSGOEE",74,0)
 I ($P($G(PSBSTR),"^")>PSGSD)!('$G(PSGNEWDT)&(PSGSD=$G(PSGOSD))&(PSGFD=$G(PSGOFD)))!($G(PSGOST)'=PSGST)!(PSGSCH'=$G(PSGOSCH))!($G(PSGPDNX)) D
"RTN","PSGOEE",75,0)
 .N PSGOES S PSGOES=1,PSGOFD=PSGFD D ^PSGNE3 I $G(PSGOFD) S PSGNEFD=PSGFD
"RTN","PSGOEE",76,0)
 .S PSGSD=PSGNESD,PSGSDN=$$ENDD^PSGMI(PSGNESD)_U_$$ENDTC^PSGMI(PSGNESD),PSGFD=PSGNEFD,PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC^PSGMI(PSGNEFD),PSGNEWDT=1
"RTN","PSGOEE",77,0)
 .I $D(PSGOFD),PSGOFD]"",PSGFD'=PSGOFD S PSGOEEF(25)=1
"RTN","PSGOEE",78,0)
 .I $D(PSGOSD),PSGOSD]"",PSGSD'=PSGOSD S PSGOEEF(10)=1
"RTN","PSGOEE",79,0)
 ;BHW;PSJ*5*179;Add EFD call here, removed from PSGOE91
"RTN","PSGOEE",80,0)
 D EFDACT^PSJUTL
"RTN","PSGOEE",81,0)
 Q
"RTN","PSGOEE",82,0)
NEW3 ;
"RTN","PSGOEE",83,0)
 ;S:PSGOEAV PSGOEAV="0^1"
"RTN","PSGOEE",84,0)
NEW ;
"RTN","PSGOEE",85,0)
 W !,"...discontinuing original order..."
"RTN","PSGOEE",86,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D NEW^PSJCOM1 Q
"RTN","PSGOEE",87,0)
 ;DC and Unlock order.
"RTN","PSGOEE",88,0)
 S PSGEDIT="DE" D ENOR^PSGOECS,UNL^PSSLOCK(PSGP,PSGORD) K PSGEDIT
"RTN","PSGOEE",89,0)
 W !!," ...creating new order..." W:'PSGOEAV "(you will now work on this new order)"
"RTN","PSGOEE",90,0)
 S PSGS0Y=PSGAT,PSGNESD=PSGSD,PSGNEFD=PSGFD,PSGOEPR=PSGPR,PSGPDRG=PSGPD,PSGPDRGN=PSGPDN,PSGOEE="E"
"RTN","PSGOEE",91,0)
 S PSGOORD=PSGORD D ^PSGOETO K PSGOEOS
"RTN","PSGOEE",92,0)
 I PSGOORD["U" S $P(^PS(55,PSGP,5,+PSGOORD,0),"^",26,27)=PSGORD_"^E"
"RTN","PSGOEE",93,0)
 E  S $P(^PS(53.1,+PSGOORD,0),"^",26,27)=PSGORD_"^E"
"RTN","PSGOEE",94,0)
 I 'PSGOEAV,($G(PSGORD)["P"),'$G(^PS(53.1,+PSGORD,2.5)),$G(^PS(53.1,+PSGORD,0)) D
"RTN","PSGOEE",95,0)
 . N DUR S DUR=$$GETDUR^PSJLIVMD(PSGP,PSGORD,$S(PSGORD["P":"P",1:5),1) I DUR]"" K DA,DR,DIE S DIE="^PS(53.1,",DA=+PSGORD,DR="116////"_DUR D ^DIE
"RTN","PSGOEE",96,0)
 I PSGOEAV,+PSJSYSU=3,'$D(PSGOES) D EN^PSGPEN(PSGORD),UNL^PSSLOCK(PSGP,PSGORD) Q
"RTN","PSGOEE",97,0)
 S PSJORD=PSGORD,PSGACT=$$ENACTION^PSGOE1(PSGP,PSGORD)
"RTN","PSGOEE",98,0)
 Q
"RTN","PSGOEE",99,0)
UPD ;
"RTN","PSGOEE",100,0)
 K DA W !!,"...updating order..."
"RTN","PSGOEE",101,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D UPD^PSJCOM Q
"RTN","PSGOEE",102,0)
 ; Set trigger for FIELD (12) Dispense Drug to print a updated pick list.
"RTN","PSGOEE",103,0)
 I PSGORD["U",$D(^PS(53.45,PSJSYSP,2,1,0)),$D(^PS(55,PSGP,5,+PSGORD,1,1,0)) D
"RTN","PSGOEE",104,0)
 .N PSJX12,PSJF12 S PSJF12=0
"RTN","PSGOEE",105,0)
 .F PSJX12=0:1 S PSJX12=$O(^PS(53.45,PSJSYSP,2,PSJX12)) Q:+PSJX12=0  S:$G(^PS(53.45,PSJSYSP,2,PSJX12,0))'=$G(^PS(55,PSGP,5,+PSGORD,1,PSJX12,0)) PSJF12=1
"RTN","PSGOEE",106,0)
 .S:PSJF12 ^PS(55,"AUE",PSGP,+PSGORD)=""
"RTN","PSGOEE",107,0)
 N TMP,PSGSIF S TMP=PSGOEENO N PSGOEENO S PSGOEENO=TMP
"RTN","PSGOEE",108,0)
 N II F II=1:1:$L($G(DR),";") I $E($P($G(DR),";",II),1,7)="122////" S PSGSIF=$P(PSGSI,"^",2),PSGSI=$P(PSGSI,"^") Q
"RTN","PSGOEE",109,0)
 I $G(PSJCOM),$G(PSJCOMSI) K PSJCOMSI N PSJCHILD,PSJOEORD S PSJOEORD=0 F  S PSJOEORD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD)) Q:'PSJOEORD  D
"RTN","PSGOEE",110,0)
 . S PSJCHILD=0 F  S PSJCHILD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD,PSJCHILD)) Q:'PSJCHILD  D
"RTN","PSGOEE",111,0)
 .. Q:PSJCHILD=PSGORD  N DR,DA,DIE,ORD S DR=$S(PSJCHILD["V":"31////"_$G(P("OPI")),1:"8////"_$G(PSGSI)) S DR=DR_";"_$S(PSJCHILD["V":146,1:122)_"////"_+$G(PSGSIF)
"RTN","PSGOEE",112,0)
 .. ;PSJ*5*179 Comment edits
"RTN","PSGOEE",113,0)
 .. S DR=$TR(DR,"*") I DR'="" S DA=+PSJCHILD,DIE=$S(PSJCHILD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,") S:DIE["^PS(55," DA(1)=PSGP D ^DIE W "." D EN1^PSJHL2(PSGP,"XX",+PSJCHILD_"U")
"RTN","PSGOEE",114,0)
 S DR=$TR(DR,"*") I DR'="" S DA=+PSGORD,DIE=$S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,") S:DIE["^PS(55," DA(1)=PSGP D ^DIE W "."
"RTN","PSGOEE",115,0)
 F Q=1,3 K @(PSGOEEWF_Q_")") S %X="^PS(53.45,"_PSJSYSP_","_$S(Q=1:2,1:1)_",",%Y=PSGOEEWF_Q_"," K @(PSGOEEWF_Q_")") D %XY^%RCR W "."
"RTN","PSGOEE",116,0)
 S $P(@(PSGOEEWF_"1,0)"),"^",2)=$S(PSGORD["U":55.07,1:53.11)_"P"
"RTN","PSGOEE",117,0)
 ; Naked reference on the line below refers to full reference using indirection to either ^PS(55 or ^PS(53.1,
"RTN","PSGOEE",118,0)
 S ND=$G(@($S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSGORD_",0)")) I $P(ND,"^",21) S ORIFN=$P(ND,"^",21),ND1=$G(^(.2)),ND2=$G(^(2)) W !,"...updating OE/RR..." D EN1^PSJHL2(PSGP,"XX",PSGORD)
"RTN","PSGOEE",119,0)
 I $$ENACTION^PSGOE1(PSGP,PSGORD)["V" S VALMBCK="R"
"RTN","PSGOEE",120,0)
 I PSJSYSL,PSJSYSL<3 S $P(@($S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSGORD_",7)"),"^",1,2)=PSGDT_"^"_$E("D",PSGOEENO)_"E",PSGTOL=2,PSGUOW=DUZ,PSGTOO=PSGORD'["U"+1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOEE",121,0)
 Q
"RTN","PSGOEE",122,0)
OUT ;
"RTN","PSGOEE",123,0)
 D ABORT K PSGNEWDT S PSGCANFL=1 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),INIT^PSJLMUDE(PSGP,PSGORD)
"RTN","PSGOEE",124,0)
 Q
"RTN","PSGOEE",125,0)
DONE ;
"RTN","PSGOEE",126,0)
 I PSGORD["P",'$D(PSGOEF),PSGSCH]"",$O(^PS(53.1,+PSGORD,1,0)) D ENF^PSGOEE0
"RTN","PSGOEE",127,0)
DONE1 ;
"RTN","PSGOEE",128,0)
 I PSGORD["U" S X=+PSGORD L -^PS(55,PSGP,5,X)
"RTN","PSGOEE",129,0)
 E  L -^PS(53.1,+PSGORD)
"RTN","PSGOEE",130,0)
 K ^PS(53.45,+PSJSYSP,1),^(2)
"RTN","PSGOEE",131,0)
 I '$D(PSGOEF) K PSGSD,PSGSCH,PSGST,PSGFD
"RTN","PSGOEE",132,0)
 K DA,DIE,DIR,DP,DR,DRG,ND,ND0,ND1,ND2,ORIFN,PSGAL,PSGALEF,PSGAT,PSGOEE,PSGOEEF,PSGOEEG,PSGOEEWF,PSGEFN,PSGTOL,PSGTOO,PSGUOW,XREF,PSGEFN,PSGMR,PSGMRN,PSGOROE1,PSGPD,PSGPDN,PSGSI,PSGPR,PSGSM,PSGHSM,PSGSTN,PSGSDN,PSGFDN,PSGPRN
"RTN","PSGOEE",133,0)
 K PSGDO,PSGOEENO Q
"RTN","PSGOEE",134,0)
K1 ;
"RTN","PSGOEE",135,0)
 K BACK,F1,F2,PSGF2,MSG,PSGEFN,PSGNEWDT,PSGOEEND,PSGOPD,PSGOPDN,PSGOMR,PSGOMRN,PSGOSCH,PSGOSI,PSGOPR,PSGOSM,PSGOHSM,PSGOSD,PSGOFD,PSGOST,PSGOPRN,PSGOSTN,PSGOSDN,PSGOFDN,PSGODO,PSGPDRG,PSGPDRGN,PSGOEER
"RTN","PSGOEE",136,0)
 Q
"RTN","PSGOEE",137,0)
 ;
"RTN","PSGOEE",138,0)
ABORT ; Display no change message and pause.
"RTN","PSGOEE",139,0)
 S (PSGDI,PSGDFLG)='$$DDOK^PSGOE2(PSGOEEWF_"1,",+$G(@(PSGOEEWF_".2)")))
"RTN","PSGOEE",140,0)
 S PSGPFLG='$$OIOK^PSGOE2(+$G(@(PSGOEEWF_".2)")))
"RTN","PSGOEE",141,0)
 W !!,$C(7),"No changes made to this order." D PAUSE^VALM1 K PSGOEEF S PSGOEEF=0
"RTN","PSGOEE",142,0)
 Q
"RTN","PSGOEE",143,0)
 ;
"RTN","PSGOEE",144,0)
GTSTATUS ; Determine status of new order and set LM title.
"RTN","PSGOEE",145,0)
 S PSGSTAT=$S($P($G(PSJSYSP0),U,9):"ACTIVE",1:"NON-VERIFIED")
"RTN","PSGOEE",146,0)
 S VALM("TITLE")=PSGSTAT_" UNIT DOSE "_$S(PSGSTAT="PENDING":"("_PSGPRIO_")",1:"")
"RTN","PSGOEE",147,0)
 Q
"RTN","PSGOEE",148,0)
 ;
"RTN","PSGOEE",149,0)
FIELDS ;
"RTN","PSGOEE",150,0)
31 ;;101^PSGOE8;PSGOPD;PSGPD;101;1
"RTN","PSGOEE",151,0)
32 ;;109^PSGOE8;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEE",152,0)
33 ;;10^PSGOE81;PSGOSD;PSGSD;10;0
"RTN","PSGOEE",153,0)
34 ;;3^PSGOE8;PSGOMR;PSGMR;3;1
"RTN","PSGOEE",154,0)
35 ;;25^PSGOE81;PSGOFD;PSGFD;25;0
"RTN","PSGOEE",155,0)
36 ;;7^PSGOE8;PSGOST;PSGST;7;0
"RTN","PSGOEE",156,0)
37 ;;5^PSGOE82;PSGOSM;PSGSM;5;0
"RTN","PSGOEE",157,0)
38 ;;26^PSGOE8;PSGOSCH;PSGSCH;26;1
"RTN","PSGOEE",158,0)
39 ;;39^PSGOE81;PSGOAT;PSGAT;39;0
"RTN","PSGOEE",159,0)
310 ;;1^PSGOE82;PSGOPR;PSGPR;1;1
"RTN","PSGOEE",160,0)
311 ;;8^PSGOE81;PSGOSI;PSGSI;8;0
"RTN","PSGOEE",161,0)
312 ;;2^PSGOE82;;;2;0
"RTN","PSGOEE",162,0)
313 ;;40^PSGOE82;;;40;0
"RTN","PSGOEE",163,0)
51 ;;101^PSGOE9;PSGOPD;PSGPD;101;1
"RTN","PSGOEE",164,0)
52 ;;109^PSGOE9;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEE",165,0)
53 ;;10^PSGOE91;PSGOSD;PSGSD;10;1
"RTN","PSGOEE",166,0)
54 ;;3^PSGOE9;PSGOMR;PSGMR;3;1
"RTN","PSGOEE",167,0)
55 ;;34^PSGOE91;PSGOFD;PSGFD;34;1 
"RTN","PSGOEE",168,0)
56 ;;7^PSGOE9;PSGOST;PSGST;7;0
"RTN","PSGOEE",169,0)
57 ;;5^PSGOE92;PSGOSM;PSGSM;5;0
"RTN","PSGOEE",170,0)
58 ;;26^PSGOE9;PSGOSCH;PSGSCH;26;1
"RTN","PSGOEE",171,0)
59 ;;41^PSGOE91;PSGOAT;PSGAT;41;0
"RTN","PSGOEE",172,0)
510 ;;1^PSGOE92;PSGOPR;PSGPR;1;1
"RTN","PSGOEE",173,0)
511 ;;8^PSGOE91;PSGOSI;PSGSI;8;0
"RTN","PSGOEE",174,0)
512 ;;2^PSGOE92;;;2;0
"RTN","PSGOEE",175,0)
513 ;;15^PSGOE92;;;15;0
"RTN","PSGOEF")
0^81^B92772116
"RTN","PSGOEF",1,0)
PSGOEF ;BIR/CML3-FINISH ORDERS ENTERED THROUGH OE/RR ;14 May 98 / 2:17 PM
"RTN","PSGOEF",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,30,29,35,39,47,50,56,80,116,110,111,133,153,134,222,113,181**;16 DEC 97;Build 190
"RTN","PSGOEF",3,0)
 ;
"RTN","PSGOEF",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSGOEF",5,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192
"RTN","PSGOEF",6,0)
 ; Reference to DOSE^PSSORPH is supported by DBIA 3234.
"RTN","PSGOEF",7,0)
 ;
"RTN","PSGOEF",8,0)
START ;
"RTN","PSGOEF",9,0)
 I '$D(^PS(53.1,+PSGORD)) W $C(7),!?3,"Cannot find this pending order (#",+PSGORD,")." Q
"RTN","PSGOEF",10,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12) K PSGFDX,PSGEFN,PSGOEEF,PSGOES,PSGONF,PSGRDTX S PSGOES=1,(PSGOEF,PSGOEEF)=0,PSGOEEG=3
"RTN","PSGOEF",11,0)
 I $D(PSJTUD) S PSGDO=$P($G(^PS(53.1,+PSGORD,.3)),U),(PSGPDRG,PSGPD)=PSJCOI,(PSGPDRGN,PSGPDN)=$$OINAME^PSJLMUTL(PSGPD)
"RTN","PSGOEF",12,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S X=PSGSCH D EN^PSGORS0 D
"RTN","PSGOEF",13,0)
 . S:($D(X)&($P($G(^PS(53.1,+PSGORD,2)),"^",5)="")&($P($G(^PS(53.1,+PSGORD,0)),"^",24)="N")) PSGAT=PSGS0Y
"RTN","PSGOEF",14,0)
 . NEW PSJDOX,PSJDOSE,PSJPIECE,PSJUNIT,PSJX,X
"RTN","PSGOEF",15,0)
 . S X=$G(^PS(53.1,+PSGORD,1,1,0)) Q:'+X
"RTN","PSGOEF",16,0)
 . D DOSE^PSSORPH(.PSJDOX,+X,"U")
"RTN","PSGOEF",17,0)
 . I $S('$D(PSJDOX):1,1:+PSJDOX(1)=-1) Q
"RTN","PSGOEF",18,0)
 . S PSJPIECE=$S($P(PSJDOX(1),U)="":3,1:1)
"RTN","PSGOEF",19,0)
 . S X=^PS(53.1,+PSGORD,.2)
"RTN","PSGOEF",20,0)
 . S:PSJPIECE=3 PSJDOSE=$P(X,U,2)
"RTN","PSGOEF",21,0)
 . S:PSJPIECE=1 PSJDOSE=$P(X,U,5),PSJUNIT=$P(X,U,6)
"RTN","PSGOEF",22,0)
 . F X=0:0 S X=$O(PSJDOX(X)) Q:+$G(PSJX)!'X  D
"RTN","PSGOEF",23,0)
 .. I PSJPIECE=3,($P(PSJDOX(X),U,3)'=PSJDOSE) Q
"RTN","PSGOEF",24,0)
 .. I PSJPIECE=1,($P(PSJDOX(X),U,1)_$P(PSJDOX(X),U,2)'=(PSJDOSE_PSJUNIT)) Q
"RTN","PSGOEF",25,0)
 .. S:+$P(PSJDOX(X),U,12) $P(^PS(53.45,PSJSYSP,2,1,0),U,2)=+$P(PSJDOX(X),U,12),PSJX=1
"RTN","PSGOEF",26,0)
 I PSGEB'=PSGOPR F X=7,11 S Y=$T(@(3_X)),@("PSGEFN("_X_")="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))="",PSGOEEF=PSGOEEF+1
"RTN","PSGOEF",27,0)
 D GTST^PSGOE6(+PSGORD)
"RTN","PSGOEF",28,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S PSGSD="" D:PSGS0Y]""
"RTN","PSGOEF",29,0)
 .N PSJX S PSJX=$P($G(^PS(53.1,+PSGORD,0)),U,25) I PSJX="" Q
"RTN","PSGOEF",30,0)
 .I PSJX["U" S PSGSD=$P($G(^PS(55,DFN,5,+PSJX,2)),U,2) Q
"RTN","PSGOEF",31,0)
 .I PSJX["V" S PSGSD=$P($G(^PS(55,DFN,"IV",+PSJX,0)),U,2) Q
"RTN","PSGOEF",32,0)
 .I PSJX["P" S PSGSD=$P($G(^PS(53.1,+PSJX,2)),U,2)
"RTN","PSGOEF",33,0)
 S:PSGSD="" PSGSD=PSGLI
"RTN","PSGOEF",34,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",+PSGPD)
"RTN","PSGOEF",35,0)
 S:$P($G(PSGNEDFD),U,3)="" $P(PSGNEDFD,U,3)=PSGST  ; N PSGOEA S PSGOEA="R"
"RTN","PSGOEF",36,0)
 S (PSGNESD,PSGSD)=$$ENSD^PSGNE3(PSGSCH,PSGS0Y,PSGLI,PSGSD)
"RTN","PSGOEF",37,0)
 ;if this is a renewal order, ignore any 'requested start date' received.  Use the system calculated start date.
"RTN","PSGOEF",38,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" D
"RTN","PSGOEF",39,0)
 . D REQDT^PSJLIVMD(PSGORD)
"RTN","PSGOEF",40,0)
 E  D
"RTN","PSGOEF",41,0)
 . S X=$$DSTART^PSJDCU(DFN,$P(^PS(53.1,+PSGORD,0),U,25)) I X]"" S (PSGNESD,PSGSD)=X K PSGRSD
"RTN","PSGOEF",42,0)
 D   ; Extend the Default Stop Date if needed for the first renewed order.
"RTN","PSGOEF",43,0)
 .N PSGOEAO,PSGWALLO
"RTN","PSGOEF",44,0)
 .I $P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S PSGOEAO=PSGOEA,PSGOEA="R",PSGWALLO=$P(^PS(55,DFN,5.1),U)
"RTN","PSGOEF",45,0)
 .D ENFD^PSGNE3(PSGLI) S PSGFD=$S($G(PSGRDTX(+PSGORD,"PSGFD")):PSGRDTX(+PSGORD,"PSGFD"),1:PSGNEFD)
"RTN","PSGOEF",46,0)
 .I $P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S PSGOEA=PSGOEAO,$P(^PS(55,DFN,5.1),U)=PSGWALLO
"RTN","PSGOEF",47,0)
 N DUR,PSGRNSD S PSGRNSD=+$$LASTREN^PSJLMPRI(DFN,PSGORD) I PSGRNSD S DUR=$$GETDUR^PSJLIVMD(DFN,PSGORD,"P",1) I DUR]"" D
"RTN","PSGOEF",48,0)
 . N DURMIN S DURMIN=$$DURMIN^PSJLIVMD(DUR) I DURMIN S PSGFD=$$FMADD^XLFDT(PSGRNSD,,,DURMIN)
"RTN","PSGOEF",49,0)
 S PSGOFD="",PSGSDN=$$ENDD^PSGMI(PSGSD)_U_$$ENDTC^PSGMI(PSGSD),PSGFDN=$$ENDD^PSGMI(PSGFD)_U_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOEF",50,0)
 S PSGLIN=$$ENDD^PSGMI(PSGLI)_U_$$ENDTC^PSGMI(PSGLI)
"RTN","PSGOEF",51,0)
 I '$O(^PS(53.45,PSJSYSP,2,0)) N DRG,DRGCNT S DRGCNT=0 D
"RTN","PSGOEF",52,0)
 .F X=0:0 S X=$O(^PSDRUG("ASP",+PSGPD,X)) Q:'X!(DRGCNT>1)  S:$P($G(^PSDRUG(+X,2)),U,3)["U" DRGCNT=DRGCNT+1,DRG=+X
"RTN","PSGOEF",53,0)
 .I DRGCNT=1 K ^PS(53.45,PSJSYSP,2) S ^PS(53.45,PSJSYSP,2,1,0)=DRG_U_1,^PS(53.45,PSJSYSP,2,0)="^53.4502^1^1",PS(53.45,PSJSYSP,2,"B",+DRG,1)=""
"RTN","PSGOEF",54,0)
 Q
"RTN","PSGOEF",55,0)
FINISH ;
"RTN","PSGOEF",56,0)
 ; force display of second screen if CPRS order checks exist
"RTN","PSGOEF",57,0)
 N NSFF,PSGOEF39,PSGEDTOI S NSFF=1 K PSJNSS,PSGEDTOI,PSGOEER
"RTN","PSGOEF",58,0)
 I $G(PSGORD),$D(PSGRDTX(+PSGORD)) D  K PSGRDTX
"RTN","PSGOEF",59,0)
 . ;PSJOCDSC stores the default start & stop date ^ cal start & stop date (use in dosing calculation for duration)
"RTN","PSGOEF",60,0)
 . ;for some reasons PSGSD & PSGFD are reset to the cal dates if order has duration defined
"RTN","PSGOEF",61,0)
 . S PSJOCDSC("CX","PSGSD",+PSGORD)=$G(PSGSD)_U_$G(PSGRDTX(+PSGORD,"PSGRSD"))
"RTN","PSGOEF",62,0)
 . S PSJOCDSC("CX","PSGFD",+PSGORD)=$G(PSGFD)_U_$G(PSGRDTX(+PSGORD,"PSGRFD"))
"RTN","PSGOEF",63,0)
 . S:$G(PSGRDTX(+PSGORD,"PSGRSD")) PSGSD=PSGRDTX(+PSGORD,"PSGRSD")
"RTN","PSGOEF",64,0)
 . S:$G(PSGRDTX(+PSGORD,"PSGRFD")) PSGFD=$S($G(PSGRDTX(+PSGORD,"PSGRFD")):PSGRDTX(+PSGORD,"PSGRFD"),1:$G(PSGNEFD))
"RTN","PSGOEF",65,0)
 N PSJCOM S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8)
"RTN","PSGOEF",66,0)
 ; 
"RTN","PSGOEF",67,0)
 ; PSJ*5*222
"RTN","PSGOEF",68,0)
 ; PSJCT1 is a counter variable.  Every piece of a complex order calls PSGOEF.
"RTN","PSGOEF",69,0)
 ; The only time this code is to look for overlapping admin times is when the
"RTN","PSGOEF",70,0)
 ; first part of a complex order is being finished.  This variable will keep track
"RTN","PSGOEF",71,0)
 ; of how many "parts" of the complex order have been checked.
"RTN","PSGOEF",72,0)
 ; 
"RTN","PSGOEF",73,0)
 ; Also, since the user can select multiple complex orders to finish, like selecting
"RTN","PSGOEF",74,0)
 ; orders 1-2 or 1-3 from the profile, PSJCT1A will keep track of whether the parent
"RTN","PSGOEF",75,0)
 ; order number is the same as the first parent order number selected for finishing.
"RTN","PSGOEF",76,0)
 ; Since the PSJCT1 counter variable will still be set if multiple complex orders
"RTN","PSGOEF",77,0)
 ; are selected, PSJCT1 will be re-set to 1 if the parent complex order number (PSJCT1A) is
"RTN","PSGOEF",78,0)
 ; not equal to the original parent order number (PSJCOM).
"RTN","PSGOEF",79,0)
 ; 
"RTN","PSGOEF",80,0)
 S PSJCT1=$G(PSJCT1)+1
"RTN","PSGOEF",81,0)
 I PSJCT1=1 S PSJCT1A=PSJCOM
"RTN","PSGOEF",82,0)
 I $G(PSJCT1A)'=PSJCOM S PSJCT1=1,PSJCT1A=PSJCOM
"RTN","PSGOEF",83,0)
 ; End of flag setting for PSJ*5*222
"RTN","PSGOEF",84,0)
 ;PRE UAT group requested to not show the second screen since FDB OC has more text and provider override reason appears after 2nd screen 
"RTN","PSGOEF",85,0)
 ;I $O(^PS(53.1,+PSGORD,12,0))!$O(^PS(53.1,+PSGORD,10,0)) D
"RTN","PSGOEF",86,0)
 ;.Q:$G(PSJLMX)=1  ; there's no second screen to display
"RTN","PSGOEF",87,0)
 ;.S VALMBG=16 D RE^VALM4,PAUSE^VALM1
"RTN","PSGOEF",88,0)
 D FULL^VALM1
"RTN","PSGOEF",89,0)
 I '$D(IOINORM)!('$D(IOINHI)) S X="IORVOFF;IORVON;IOINHI;IOINORM" D ENDR^%ZISS
"RTN","PSGOEF",90,0)
 I $G(PSJCOM)'="",$G(PSJCT1)=1 D
"RTN","PSGOEF",91,0)
 . D OVERLAP^PSGOEF2 I $G(PSJOVRLP)=1 D
"RTN","PSGOEF",92,0)
 . . N X,X1,DIR
"RTN","PSGOEF",93,0)
 . . W !!,"**WARNING**"
"RTN","PSGOEF",94,0)
 . . W !,"The highlighted admin times for these portions of this complex order overlap.",!!
"RTN","PSGOEF",95,0)
 . . S (X,X1)="" F  S X=$O(^TMP("PSJATOVR",$J,X)) Q:X=""  D
"RTN","PSGOEF",96,0)
 . . . S X1=$G(^TMP("PSJATOVR",$J,X))
"RTN","PSGOEF",97,0)
 . . . W $S($P(X1,"^",4)=1:IORVON,1:""),"Part "_X,IORVOFF," has a schedule of "_$P(X1,"^",2)_" and admin time(s) of "
"RTN","PSGOEF",98,0)
 . . . W $S($P(X1,"^",4)=1:IORVON,1:""),$P(X1,"^",3),IORVOFF
"RTN","PSGOEF",99,0)
 . . . W !
"RTN","PSGOEF",100,0)
 . . . W $S($G(PSJOVR("CONJ",X))="A":"AND",$G(PSJOVR("CONJ",X))="T":"THEN",1:""),!
"RTN","PSGOEF",101,0)
 . . W !,"Please ensure the schedules and administration times are appropriate.",!
"RTN","PSGOEF",102,0)
 . . S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR W !
"RTN","PSGOEF",103,0)
 K ^TMP("PSJATOVR",$J)
"RTN","PSGOEF",104,0)
 I $G(PSJPROT)=3,'$D(PSJTUD),'$$ENIVUD^PSGOEF1(PSGORD) Q
"RTN","PSGOEF",105,0)
 I $G(PSGOSCH)]"" D  S:$G(PSGS0XT)'="" $P(^PS(53.1,+PSGORD,2),"^",6)=PSGS0XT
"RTN","PSGOEF",106,0)
 .N PSGOES,PSGS0Y,PSGSCH S X=PSGOSCH K:$G(PSJTUD) NSFF D ENOS^PSGS0
"RTN","PSGOEF",107,0)
 .I '($G(PSGORD)["P"&($P($G(^PS(53.1,+PSGORD,0)),"^",24)="R")) I $G(X)]""&$G(PSGS0Y) S:$G(PSGAT)="" PSGAT=PSGS0Y
"RTN","PSGOEF",108,0)
 .I $G(PSJNSS) S PSGOSCH="" K PSJNSS
"RTN","PSGOEF",109,0)
 .I $G(PSGORD)["P",$G(PSGAT),$G(PSGS0Y),($G(PSGOSCH)]"") I PSGAT'=PSGS0Y D
"RTN","PSGOEF",110,0)
 ..S PSGNSTAT=1 W $C(7),!!,"PLEASE NOTE:  This order's admin times (",PSGAT,")"
"RTN","PSGOEF",111,0)
 ..W !?13," do not match the ward times (",PSGS0Y,")"
"RTN","PSGOEF",112,0)
 ..W !?13," for this administration schedule (",PSGOSCH,")",!
"RTN","PSGOEF",113,0)
 ..S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR K DIR  W !
"RTN","PSGOEF",114,0)
 I $G(PSGS0XT)="" S $P(^PS(53.1,+PSGORD,2),"^",6)=$S($P($G(ZZND),"^",3)'="":$P(ZZND,"^",3),1:"")
"RTN","PSGOEF",115,0)
 S CHK=0 S:$P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" PSGSI=$$ENPC^PSJUTL("U",+PSJSYSP,180,PSGSI)
"RTN","PSGOEF",116,0)
 I '$G(PSJTUD),$G(PSJNSS),($G(PSGOSCH)]"") D NSSCONT^PSGS0(PSGOSCH,PSGS0XT) K PSJNSS S PSGOSCH=""
"RTN","PSGOEF",117,0)
 S PSGOEFF=PSGOSCH=""+('$O(^PS(53.45,PSJSYSP,2,0))*10)
"RTN","PSGOEF",118,0)
 I PSGOEFF S X=$S(PSGOEFF#2:" a SCHEDULE",1:"")_$S(PSGOEFF=11:" and",1:"")_$S(PSGOEFF>9:" at least one DISPENSE DRUG",1:"")
"RTN","PSGOEF",119,0)
 I 'PSGOEFF I (($G(PSGS0XT)="D")&($G(PSGAT)="")) S X=" Admin Times",PSGOEFF=1,PSGOEF39=1
"RTN","PSGOEF",120,0)
 I PSGOEFF,X]"" S X=X_" before it can be finished."
"RTN","PSGOEF",121,0)
 I PSGOEFF S CHK=1 W $C(7),!!,"PLEASE NOTE: This order must have" F Q=1:1:$L(X," ") S Y=$P(X," ",Q) W:$L(Y)+$X>78 ! W Y," "
"RTN","PSGOEF",122,0)
 I $G(PSGOEF39) S PSGOEE=0,PSGOEFF=0 D  I 'PSGOEE D REFRESH^VALM G DONE
"RTN","PSGOEF",123,0)
 .S F1=53.1,MSG=0,Y=$T(39),@("PSGFN(39)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEEF,PSGOEE)=1 W ! D @$P($T(39),";",3) S CHK=0
"RTN","PSGOEF",124,0)
 I PSGOEFF=1 S F1=53.1,MSG=0,Y=$T(38),@("PSGFN(38)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(38),";",3) S CHK=0 G:'PSGOEE DONE
"RTN","PSGOEF",125,0)
 I PSGOEFF=11 S F1=53.1,MSG=0,Y=$T(32),@("PSGFN(32)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(32),";",3) D  G:'PSGOEE DONE
"RTN","PSGOEF",126,0)
 .S F1=53.1,MSG=0,Y=$T(38),@("PSGFN(38)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(38),";",3) S CHK=0
"RTN","PSGOEF",127,0)
 I PSGOEFF>9 S CHK=7 D ENDRG^PSGOEF1(+PSGPD,0) I CHK D ABORTACC Q
"RTN","PSGOEF",128,0)
 I 'PSGOEFF D OC531^PSGOESF ; check every dispense drug from CPRS
"RTN","PSGOEF",129,0)
 S VALMBG=1
"RTN","PSGOEF",130,0)
 I 'PSGOEFF&($D(PSGORQF)) D RE^VALM4 Q
"RTN","PSGOEF",131,0)
 I $G(MSG) K DIR S DIR(0)="E" W !! D ^DIR
"RTN","PSGOEF",132,0)
 I PSGOEFF D:PSGST="" GTST^PSGOE6(+PSGORD)
"RTN","PSGOEF",133,0)
 S PSJLMFIN=1
"RTN","PSGOEF",134,0)
 K PSJACEPT I $O(^PS(53.1,+PSGORD,12,0)) S PSJLMP2=1
"RTN","PSGOEF",135,0)
 S PSGOEENO=0,PSGSTAT=$S($P(PSJSYSP0,U,9):"ACTIVE",1:"NON-VERIFIED")
"RTN","PSGOEF",136,0)
 NEW PSJDOSE,PSJDOX,PSJDSFLG
"RTN","PSGOEF",137,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOEF",138,0)
 S:+$G(PSJDSFLG) VALMSG="Dosage Ordered & Dispense Drug are not compatible"
"RTN","PSGOEF",139,0)
 I PSGODO=PSGDO S PSGOEEF(109)=""
"RTN","PSGOEF",140,0)
 I PSGODO'=PSGDO S PSGOEENO=1,VALMSG="This change will cause a new order to be created  "
"RTN","PSGOEF",141,0)
 D EN^VALM("PSJU LM ACCEPT")
"RTN","PSGOEF",142,0)
 I $G(PSJNSS) D  S PSGOEEF(26)="" K PSJACEPT,PSJNSS
"RTN","PSGOEF",143,0)
 .K DIR S DIR(0)="FOA",DIR("A")="Invalid Schedule" D ^DIR K DIR
"RTN","PSGOEF",144,0)
 I $G(PSGS0XT)="D",'$G(PSGS0Y),'$G(PSGAT),((",P,R,")'[(","_$G(PSGST)_",")) D  S PSGOEEF(39)="" K PSJACEPT
"RTN","PSGOEF",145,0)
 .K DIR S DIR(0)="FOA",DIR("A")="   WARNING - Admin times are required for DAY OF WEEK schedules  " D ^DIR K DIR
"RTN","PSGOEF",146,0)
 ;***PSJ*5*113
"RTN","PSGOEF",147,0)
 I $G(PSGAT)="",(PSGST="C"!(PSGST="R")) D
"RTN","PSGOEF",148,0)
 .I $G(PSGS0XT) Q:$$ODD^PSGS0(PSGS0XT)
"RTN","PSGOEF",149,0)
 .Q:$$PRNOK^PSGS0($G(PSGSCH))
"RTN","PSGOEF",150,0)
 .Q:($P($G(ZZND),"^",5)'="C")
"RTN","PSGOEF",151,0)
 .K PSJACEPT
"RTN","PSGOEF",152,0)
 .K DIR S DIR(0)="FOA",DIR("A")="  WARNING - Admin times are required for CONTINUOUS orders " D ^DIR K DIR
"RTN","PSGOEF",153,0)
 ;***
"RTN","PSGOEF",154,0)
 I '$G(PSJACEPT) D ABORTACC Q
"RTN","PSGOEF",155,0)
 I $G(PSJRNF),$G(^PS(53.1,+PSGORD,4)) D
"RTN","PSGOEF",156,0)
 . W $C(7),!!,"ACCEPTING THIS ORDER WILL CHANGE THE STATUS TO ACTIVE."
"RTN","PSGOEF",157,0)
 . S DIR(0)="Y",DIR("A")="Do you wish to make this order Active",DIR("?",1)="Enter ""N"" if you wish to exit without Activating this order,"
"RTN","PSGOEF",158,0)
 . S DIR("?")="or ""Y"" to continue with the Activation process." D ^DIR S:'Y Y=-1 K DIR
"RTN","PSGOEF",159,0)
 I $G(PSJRNF),$G(Y)=-1 S PSJACEPT=0 D ABORTACC Q
"RTN","PSGOEF",160,0)
 I $G(PSJRNF),$G(Y)=1 S PSGOEAV=1
"RTN","PSGOEF",161,0)
 I $G(PSGEDTOI) D OC^PSJOE1
"RTN","PSGOEF",162,0)
 I $S($G(PSGORQF):0,$G(PSGEDTOI):0,$G(PSGOEER)["109^PSGOE8":1,$G(PSGOEER)["3^PSGOE8":1,$G(PSGOEER)["26^PSGOE8":1,$G(PSGOEER)["10^PSGOE81":1,$G(PSGOEER)["25^PSGOE81":1,1:0) D
"RTN","PSGOEF",163,0)
 . NEW PSJDD S PSJDD=+$$DD53P45^PSJMISC()
"RTN","PSGOEF",164,0)
 . D:$G(PSJDD) IN^PSJOCDS($G(PSGORD),"UD",PSJDD)
"RTN","PSGOEF",165,0)
 I $G(PSGORQF) S PSGOEENO=0,PSJACEPT=0
"RTN","PSGOEF",166,0)
 I PSGOEENO S PSJNOO=$$ENNOO^PSJUTL5("E"),PSJACEPT=$S(PSJNOO<0:0,1:1)
"RTN","PSGOEF",167,0)
ACCEPT ;
"RTN","PSGOEF",168,0)
 S VALMBCK=$S($G(PSJACEPT):"Q",1:"R")
"RTN","PSGOEF",169,0)
 I '$G(PSJACEPT) D ABORTACC Q
"RTN","PSGOEF",170,0)
 K PSGOES,PSGRSD,PSGRSDN D:PSGOEENO NEW3^PSGOEE D:'PSGOEENO UPD^PSGOEF1 I $D(PSGOEF)!PSGOEENO S PSGCANFL=-1
"RTN","PSGOEF",171,0)
 D DONE1^PSGOEE
"RTN","PSGOEF",172,0)
 D DONE
"RTN","PSGOEF",173,0)
 Q
"RTN","PSGOEF",174,0)
BYPASS ;
"RTN","PSGOEF",175,0)
 S PSGCANFL=1
"RTN","PSGOEF",176,0)
 ;
"RTN","PSGOEF",177,0)
DONE ;
"RTN","PSGOEF",178,0)
 K CHK,DA,DIE,DR,DRG,MSG,Q1,Q2,PSGNSTAT,PSGEDTOI,PSGOEER
"RTN","PSGOEF",179,0)
 K PSJOVR
"RTN","PSGOEF",180,0)
 Q
"RTN","PSGOEF",181,0)
ABORTACC ; Abort Accept process.
"RTN","PSGOEF",182,0)
 K PSJCT1,PSJOVR,PSJOVRLP,PSJCT1A
"RTN","PSGOEF",183,0)
 D ABORT^PSGOEE K PSGOEEF D GETUD^PSJLMGUD(PSGP,PSGORD),^PSGOEF,ENSFE^PSGOEE0(PSGP,PSGORD),INIT^PSJLMUDE(PSGP,PSGORD) S VALMBCK="R",PSGSD=PSGNESD,PSGFD=PSGNEFD Q
"RTN","PSGOEF",184,0)
 ;
"RTN","PSGOEF",185,0)
 ;
"RTN","PSGOEF",186,0)
31 ;;101^PSGOE8;PSGOPD;PSGPD;101;1
"RTN","PSGOEF",187,0)
32 ;;109^PSGOE8;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEF",188,0)
33 ;;10^PSGOE81;PSGOSD;PSGSD;10;0
"RTN","PSGOEF",189,0)
34 ;;3^PSGOE8;PSGOMR;PSGMR;3;1
"RTN","PSGOEF",190,0)
35 ;;25^PSGOE81;PSGOFD;PSGFD;25;0
"RTN","PSGOEF",191,0)
36 ;;7^PSGOE8;PSGOST;PSGST;7;0
"RTN","PSGOEF",192,0)
37 ;;5^PSGOE82;PSGOSM;PSGSM;5;0
"RTN","PSGOEF",193,0)
38 ;;26^PSGOE8;PSGOSCH;PSGSCH;26;1      
"RTN","PSGOEF",194,0)
39 ;;39^PSGOE81;PSGOAT;PSGAT;39;0
"RTN","PSGOEF",195,0)
310 ;;1^PSGOE82;PSGOPR;PSGPR;1;1
"RTN","PSGOEF",196,0)
311 ;;8^PSGOE81;PSGOSI;PSGSI;8;0
"RTN","PSGOEF",197,0)
312 ;;2^PSGOE82;;;2;0
"RTN","PSGOEF",198,0)
313 ;;40^PSGOE82;;;40;0
"RTN","PSGOEF",199,0)
 ;
"RTN","PSGOEF",200,0)
AH ;
"RTN","PSGOEF",201,0)
 W !!?2,"Answer 'YES' to accept this order as a NON-VERIFIED UNIT DOSE order.  Answer",!,"'NO' to edit this order now.  Enter '^' to BYPASS this order, leaving it as",!,"a PENDING INPATIENT order."
"RTN","PSGOEF",202,0)
 Q
"RTN","PSGOEF1")
0^98^B29780196
"RTN","PSGOEF1",1,0)
PSGOEF1 ;BIR/CML3-FINISH ORDERS ENTERED THROUGH OE/RR (CONT) ;02 Feb 2001  12:20 PM
"RTN","PSGOEF1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**2,7,35,39,45,47,50,63,67,58,95,110,186,181**;16 DEC 97;Build 190
"RTN","PSGOEF1",3,0)
 ;
"RTN","PSGOEF1",4,0)
 ; Reference to ^VALM1 is supported by DBIA# 10116.
"RTN","PSGOEF1",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGOEF1",6,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSGOEF1",7,0)
 ; Reference to ^%DTC is supported by DBIA 10000.
"RTN","PSGOEF1",8,0)
 ; Reference to ^%RCR is supported by DBIA 10022.
"RTN","PSGOEF1",9,0)
 ; Reference to ^DIE is supported by DBIA 10018.
"RTN","PSGOEF1",10,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSGOEF1",11,0)
 ;
"RTN","PSGOEF1",12,0)
UPD ;
"RTN","PSGOEF1",13,0)
 W !!,"...accepting order..."
"RTN","PSGOEF1",14,0)
 I PSGST="",(PSGSCH="NOW"!(PSGSCH="ONCE")) S PSGST="O"
"RTN","PSGOEF1",15,0)
 I PSJCOM D UPD^PSJCOM Q
"RTN","PSGOEF1",16,0)
 K DA,DR S DA=+PSGORD,DIE="^PS(53.1,",DR="28////N;4////U"_";7////"_PSGST_";10////"_PSGSD_";25////"_PSGFD
"RTN","PSGOEF1",17,0)
 I $D(PSGSI),$P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S ^PS(53.1,DA,6)=PSGSI
"RTN","PSGOEF1",18,0)
 I $D(PSGSI),$P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S $P(^PS(53.1,DA,6),U)=$P(PSGSI,U) I $P(^PS(53.1,DA,6),U)="" S $P(^PS(53.1,DA,6),U,2)=""
"RTN","PSGOEF1",19,0)
 S:PSGOEFF#2 DR=DR_";26////"_PSGSCH
"RTN","PSGOEF1",20,0)
 I PSGSM,PSGOHSM'=PSGHSM S DR=DR_";5////"_PSGSM_";6////"_PSGHSM
"RTN","PSGOEF1",21,0)
 D ^DIE W "."
"RTN","PSGOEF1",22,0)
 F Q=1,3 K @(PSGOEEWF_Q_")") S %X="^PS(53.45,"_PSJSYSP_","_$S(Q=1:2,1:1)_",",%Y=PSGOEEWF_Q_"," K @(PSGOEEWF_Q_")") D %XY^%RCR W "."  ;MOU-0100-30945
"RTN","PSGOEF1",23,0)
 ;;I $O(^PS(53.45,PSJSYSP,2,0)) S %X="^PS(53.45,"_PSJSYSP_",2,",%Y="^PS(53.1,"_+PSGORD_",1," D %XY^%RCR W "." S $P(^PS(53.1,+PSGORD,1,0),"^",2)=53.11
"RTN","PSGOEF1",24,0)
 S PSGND=$G(^PS(53.1,+PSGORD,0)),X=$P(PSGND,U,24)
"RTN","PSGOEF1",25,0)
 I $S(X="R":1,+$G(^PS(55,PSGP,5.1))>PSGDT:0,1:X'="E") S X=$G(^PS(53.1,DA,2)) D ENWALL^PSGNE3(+$P(X,U,2),+$P(X,U,4),PSGP)
"RTN","PSGOEF1",26,0)
 I $P(PSGND,U,24)="R",$P(PSGND,U,25),PSGSD<$P($G(^PS(55,PSGP,5,+$P(PSGND,U,25),2)),U,4) D
"RTN","PSGOEF1",27,0)
 .K DA,DR S DA(1)=PSGP,DA=+$P(PSGND,U,25),DIE="^PS(55,"_PSGP_",5,",DR="34////"_PSGFD_";25////"_$P($G(^PS(55,PSGP,5,+$P(PSGND,U,25),2)),U,4)
"RTN","PSGOEF1",28,0)
 .D ^DIE,EN1^PSJHL2(PSGP,"XX",$P(PSGND,U,25))
"RTN","PSGOEF1",29,0)
 S $P(^PS(53.1,+PSGORD,.2),U,2)=PSGDO,$P(^PS(53.1,+PSGORD,2),U,5)=PSGAT S:$G(PSGS0XT) $P(^(2),U,6)=PSGS0XT
"RTN","PSGOEF1",30,0)
 I 'PSGOEAV D NEWNVAL^PSGAL5(PSGORD,$S(+PSJSYSU=3:22005,1:22000))
"RTN","PSGOEF1",31,0)
 I PSGOEAV,+PSJSYSU=3 D VFY^PSGOEV Q
"RTN","PSGOEF1",32,0)
 I PSGOEAV,$G(PSJRNF) D VFY^PSGOEV
"RTN","PSGOEF1",33,0)
 Q
"RTN","PSGOEF1",34,0)
 ;
"RTN","PSGOEF1",35,0)
ENDRG(PSGPDRG,DRGDA) ; enter dispense drug for order w/o one
"RTN","PSGOEF1",36,0)
 NEW PSJALLGY
"RTN","PSGOEF1",37,0)
 K PSGORQF
"RTN","PSGOEF1",38,0)
 D NOW^%DTC K DRG S (DRG,Q)=0 F  S Q=$O(^PSDRUG("ASP",+PSGPDRG,Q)) Q:'Q  I $D(^PSDRUG(Q,0)),$P($G(^(2)),U,3)["U" S X=+$G(^("I")) I 'X!(X>%) S DRG=DRG+1,DRG(DRG)=Q_"^"_^(0)
"RTN","PSGOEF1",39,0)
 I 'DRG W $C(7),!!,"No dispense drugs were found for this order's Orderable Item." K DIR S DIR(0)="E" D ^DIR K DIR S CHK=-1 Q
"RTN","PSGOEF1",40,0)
 S:DRG=1 Y(0)=1
"RTN","PSGOEF1",41,0)
 I DRG>1 D  I 'Y S DRG=0,CHK=-1 Q
"RTN","PSGOEF1",42,0)
 .W !!,"CHOOSE FROM:" F Q=1:1:DRG W !?3,$J(Q,3),". ",$P(DRG(Q),"^",2)
"RTN","PSGOEF1",43,0)
 .N DIR S DIR(0)="LAO^1:"_DRG_U_"I X#1!(X[""."") K X",DIR("A")="Select DISPENSE DRUG(S) for this order: " S:DRG=1 DIR("B")=1 S DIR("?")="^D DRGH^PSGOEF1" W ! D ^DIR
"RTN","PSGOEF1",44,0)
 ;
"RTN","PSGOEF1",45,0)
 S DRG=Y(0) F Q1=1:1 S Q2=$P(DRG,",",Q1) Q:'Q2  D
"RTN","PSGOEF1",46,0)
 . S PSJALLGY(+DRG(Q2))=""
"RTN","PSGOEF1",47,0)
 I 'DRGDA S ^PS(53.45,PSJSYSP,2,0)="^53.4502P"
"RTN","PSGOEF1",48,0)
 F Q1=1:1 S Q2=$P(DRG,",",Q1) Q:'Q2  D
"RTN","PSGOEF1",49,0)
 .;I '$$ENCKDD(PSGP,+DRG(Q2),Q1) S DRGDA=DRGDA+1,^PS(53.45,PSJSYSP,2,DRGDA,0)=+DRG(Q2),^PS(53.45,PSJSYSP,2,"B",+DRG(Q2),DRGDA)="",DA(1)=PSJSYSP,DA=DRGDA,DIE="^PS(53.45,"_PSJSYSP_",2,",DR=".02//1" W !!,$P(DRG(Q2),U,2) D ^DIE
"RTN","PSGOEF1",50,0)
 . S DRGDA=DRGDA+1,^PS(53.45,PSJSYSP,2,DRGDA,0)=+DRG(Q2),^PS(53.45,PSJSYSP,2,"B",+DRG(Q2),DRGDA)=""
"RTN","PSGOEF1",51,0)
 . S DA(1)=PSJSYSP,DA=DRGDA,DIE="^PS(53.45,"_PSJSYSP_",2,",DR=".02//1" W !!,$P(DRG(Q2),U,2) D ^DIE
"RTN","PSGOEF1",52,0)
 D ENCKDD(PSGP,+$O(PSJALLGY(0))) Q:$G(PSGORQF)
"RTN","PSGOEF1",53,0)
 S PSGDI=0
"RTN","PSGOEF1",54,0)
 S:DRGDA>0 $P(^PS(53.45,PSJSYSP,2,0),"^",3,4)=DRGDA_"^"_DRGDA,CHK=0 Q
"RTN","PSGOEF1",55,0)
 Q
"RTN","PSGOEF1",56,0)
 ;
"RTN","PSGOEF1",57,0)
DRGH ;
"RTN","PSGOEF1",58,0)
 W !!?2,"This order must have at least one dispense drug before it can be completed.",!,"Select one or more items listed.  For each item selected, you will be",!,"prompted for the UNITS PER DOSE for the item."
"RTN","PSGOEF1",59,0)
 Q
"RTN","PSGOEF1",60,0)
ENIVUD(PSJORD)     ;
"RTN","PSGOEF1",61,0)
 ;Determine if user should be prompted to transfer the order to IV.
"RTN","PSGOEF1",62,0)
 ;  INPUT: PSJORD - IEN in 53.1_order location code.
"RTN","PSGOEF1",63,0)
 ; OUTPUT: 1 - Order not transferred, process as always.
"RTN","PSGOEF1",64,0)
 ;         0 - User selected to transfer order and quit upon return.
"RTN","PSGOEF1",65,0)
 ;
"RTN","PSGOEF1",66,0)
 NEW DIR,DIRUT,PSJCOI,PSJND0,Y
"RTN","PSGOEF1",67,0)
 S PSJND0=$G(^PS(53.1,+PSJORD,0)),PSJCOI=+$G(^PS(53.1,+PSJORD,.2))
"RTN","PSGOEF1",68,0)
 I $P(PSJND0,U,4)="F" Q 1
"RTN","PSGOEF1",69,0)
 D FULL^VALM1
"RTN","PSGOEF1",70,0)
 I $S($P(PSJND0,U,24)="R":1,1:'$P(PSJND0,U,13)) Q 1
"RTN","PSGOEF1",71,0)
 S DIR(0)="SAB^I:IV;U:UNIT DOSE",DIR("A")="COMPLETE THIS ORDER AS IV OR UNIT DOSE? ",DIR("B")=$S($P(PSJND0,U,4)="I":"IV",1:"UNIT DOSE")
"RTN","PSGOEF1",72,0)
 S DIR("??")="^D THELP^PSGOEF1("""_$S(DIR("B")="IV":"UNIT DOSE",1:"IV")_""","_PSJCOI_")"
"RTN","PSGOEF1",73,0)
 D ^DIR K DIR
"RTN","PSGOEF1",74,0)
 I $D(DTOUT)!$D(DUOUT) Q 0
"RTN","PSGOEF1",75,0)
 I Y="I" D  Q 0
"RTN","PSGOEF1",76,0)
 . I +PSJSYSU=1,'$G(PSJIRNF) W !!!!,"You need the PSJI RNFINISH key to finish this order as IV!" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","PSGOEF1",77,0)
 . D IV^PSJLIFNI(PSJORD,PSJCOI)
"RTN","PSGOEF1",78,0)
 I Y="U" D  Q 0
"RTN","PSGOEF1",79,0)
 . I +PSJSYSU=1,'$G(PSJRNF) W !!!!,"You need the PSJ RNFINISH key to finish this order as Unit Dose!" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","PSGOEF1",80,0)
 . I $G(PSJITECH),($P(PSJSYSU,";",3)'=3) W !!!!,"You may not finish this order as Unit Dose!" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","PSGOEF1",81,0)
 . D ENUD^PSGOEF1(PSJORD,PSJCOI)
"RTN","PSGOEF1",82,0)
 Q 1
"RTN","PSGOEF1",83,0)
 ;
"RTN","PSGOEF1",84,0)
ENUD(PSJORD,PSGPD)       ;
"RTN","PSGOEF1",85,0)
 N PSJTUD S PSJTUD=1,DFN=$P($G(^PS(53.1,+PSJORD,0)),U,15)
"RTN","PSGOEF1",86,0)
 K DRG,DRGOC,DRGT,DRGTMP,ERR,ON,ON55,P,PSJSTAR,PSJTIM,UL80
"RTN","PSGOEF1",87,0)
 D DISACTIO^PSJOE(DFN,PSJORD,$G(PSJPNV)) S VALMBCK="Q"
"RTN","PSGOEF1",88,0)
 I +$G(PSGORQF) S VALMBCK="R"
"RTN","PSGOEF1",89,0)
 Q
"RTN","PSGOEF1",90,0)
THELP(PKG,COI) ;
"RTN","PSGOEF1",91,0)
 W !,"Choose the package this order should be completed as a IV or Unit Dose order",!
"RTN","PSGOEF1",92,0)
 Q
"RTN","PSGOEF1",93,0)
 ;
"RTN","PSGOEF1",94,0)
ENCKDD(PSGP,PSJDRG) ;
"RTN","PSGOEF1",95,0)
 ;If the OI is edited, the OC is done in ^PSGOEE (PSGOE8 - Non-VFY; PSGOE9 - Active)
"RTN","PSGOEF1",96,0)
 Q:$G(PSGOEER)["101^PSGOE8"
"RTN","PSGOEF1",97,0)
 Q:$G(PSGOEER)["101^PSGOE9"
"RTN","PSGOEF1",98,0)
 N DRG
"RTN","PSGOEF1",99,0)
 S PSGORQF=0
"RTN","PSGOEF1",100,0)
 D ENDDC^PSGSICHK(PSGP,PSJDRG) Q:$G(PSGORQF)
"RTN","PSGOEF1",101,0)
 D IN^PSJOCDS($G(PSGORD),"UD",+PSJDRG)
"RTN","PSGOEF1",102,0)
 Q
"RTN","PSGOER")
0^99^B79614016
"RTN","PSGOER",1,0)
PSGOER ;BIR/CML3-RENEW A SINGLE ORDER ;07 MAR 96 / 1:23 PM
"RTN","PSGOER",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**11,30,29,35,70,58,95,110,111,133,141,198,181**;16 DEC 97;Build 190
"RTN","PSGOER",3,0)
 ;
"RTN","PSGOER",4,0)
 ; Reference to ^PS(51.1 supported by DBIA 2177.
"RTN","PSGOER",5,0)
 ; Reference to ^PS(55 supported by DBIA 2191.
"RTN","PSGOER",6,0)
 ; Reference to ^PSSLOCK is supported by DBIA 2789.
"RTN","PSGOER",7,0)
 ; Reference to ^PSBAPIPM is supported by DBIA 3564.
"RTN","PSGOER",8,0)
 ; Reference to ^PS(59.7 is supported by DBIA 2181.
"RTN","PSGOER",9,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSGOER",10,0)
 ;
"RTN","PSGOER",11,0)
 ; renew a single order
"RTN","PSGOER",12,0)
 I $G(PSJCOM) D ^PSJCOMR Q
"RTN","PSGOER",13,0)
 N PSJEXPIR S PSJEXPIR=$$EXPIRED(PSGP,PSGORD) I PSJEXPIR D  Q
"RTN","PSGOER",14,0)
 .W !!?3,"  THIS ORDER" W:PSJEXPIR'=2 " HAS BEEN INACTIVE FOR ONE OR MORE SCHEDULED",!?8," ADMINISTRATIONS AND"
"RTN","PSGOER",15,0)
 .W " CANNOT BE RENEWED!" D PAUSE^VALM1
"RTN","PSGOER",16,0)
 I $G(PSGSCH)]"",($G(PSGS0XT)="D"),($G(PSGAT)="") D  Q
"RTN","PSGOER",17,0)
 .N SWD,SDW,XABB,X,QX S X=$G(PSGSCH) D DW^PSGS0 Q:($G(X)="")  I $G(PSGS0XT)="" S PSGS0XT="D"
"RTN","PSGOER",18,0)
 .Q:((",P,R,")[(","_$G(PSGST)_","))
"RTN","PSGOER",19,0)
 .I $G(PSGS0XT)="D",$G(PSGAT)="" S CHK=1 W !!?3,"This order contains a 'DAY OF THE WEEK' schedule without admin times"
"RTN","PSGOER",20,0)
 .W !?11," and CANNOT be renewed!" D PAUSE^VALM1
"RTN","PSGOER",21,0)
 I $G(PSGSCH)]"",'$$DOW^PSIVUTL(PSGSCH),'$$PRNOK^PSGS0(PSGSCH) I '$D(^PS(51.1,"AC","PSJ",PSGSCH)) D  Q
"RTN","PSGOER",22,0)
 .W !!?3,"This order contains an invalid schedule and CANNOT be renewed!" D PAUSE^VALM1
"RTN","PSGOER",23,0)
 W !! K DIR S DIR(0)="Y",DIR("A")=$S($P(PSJSYSP0,"^",3):"RENEW THIS ORDER",1:"MARK THIS ORDER FOR RENEWAL"),DIR("B")="YES"
"RTN","PSGOER",24,0)
 S DIR("?")="Answer 'YES' to "_$S($P(PSJSYSP0,"^",3):"renew this order",1:"mark this order for renewal")_".  Answer 'NO' (or '^') to stop now." D ^DIR
"RTN","PSGOER",25,0)
 I '$D(DIRUT),Y D NEW S PSGCANFL=1 D DONE Q
"RTN","PSGOER",26,0)
 I '$D(DIRUT),PSJSYSU S PSGND4=$G(^PS(55,PSGP,5,+PSGORD,4)) I $P(PSGND4,"^",15),$P(PSGND4,"^",16) D UNMARK,DONE Q
"RTN","PSGOER",27,0)
 D DONE,ABORT^PSGOEE
"RTN","PSGOER",28,0)
 Q
"RTN","PSGOER",29,0)
 ;
"RTN","PSGOER",30,0)
UNMARK ;  
"RTN","PSGOER",31,0)
 W !!,"THIS ORDER HAS BEEN 'MARKED FOR RENEWAL'.",! K DIR S DIR(0)="Y",DIR("A")="DO YOU WANT TO 'UNMARK IT'",DIR("B")="NO"
"RTN","PSGOER",32,0)
 S DIR("?",1)="  Answer 'YES' to unmark this order.  Answer 'NO' (or '^') to leave the order",DIR("?")="marked.  (An answer is required.)" D ^DIR
"RTN","PSGOER",33,0)
 I 'Y D ABORT^PSGOEE G DONE
"RTN","PSGOER",34,0)
 S DA(1)=PSGP,DA=+PSGORD,PSGAL("C")=21180+PSJSYSU D ^PSGAL5 S $P(PSGND4,"^",15,17)="^^",^PS(55,PSGP,5,DA,4)=PSGND4 W "...DONE!"
"RTN","PSGOER",35,0)
 ;
"RTN","PSGOER",36,0)
DONE ;
"RTN","PSGOER",37,0)
 K %DT,DA,DIE,DIR,DR,FDSD,PSGAL,PSGALR,PSGDL,PSGDLS,PSGFD,PSGFOK,PSGND4,PSGOEE,PSGOER0,PSGOER1,PSGOER2,PSGOERDP,PSGOPR,PSGOSD,PSGPOSA,PSGPOSD,PSGPR,PSGPX,PSGRD,PSGSD,PSGTOL,PSGTOO,PSGUOW,PSGWLL,RF Q
"RTN","PSGOER",38,0)
 ;
"RTN","PSGOER",39,0)
NEW ; get info, write record
"RTN","PSGOER",40,0)
EXTEND ; extend stop date on renewal order
"RTN","PSGOER",41,0)
 N DUOUT,PSJABT,PSGDRG,PSJREN,PSGOREAS S PSGDRG=$P($G(^PS(55,PSGP,5,+PSGORD,1,1,0)),"^"),PSJREN=1
"RTN","PSGOER",42,0)
 I $G(PSGST)="O" N ACT S ACT=$$EN^PSBAPIPM(PSGP,PSGORD) I $P(ACT,"^",2),($P(ACT,"^",3)="G") I $P(ACT,"^",2)>$P($G(^PS(55,PSGP,5,+PSGORD,2)),"^",2) D  Q
"RTN","PSGOER",43,0)
 . W !!?5,"THIS ONE-TIME ORDER HAS ALREADY BEEN GIVEN AND CANNOT BE RENEWED",! S (DIRUT,PSGORQF)=1 D READ
"RTN","PSGOER",44,0)
 ;D OC55
"RTN","PSGOER",45,0)
 ;Q:$D(PSGORQF)  ; quit if not to continue
"RTN","PSGOER",46,0)
 D NOW^%DTC S PSGDT=%,PSGND4=$G(^PS(55,PSGP,5,+PSGORD,4)) I '$P(PSJSYSP0,"^",3) D MARK Q
"RTN","PSGOER",47,0)
 S PSGWLL=$S('$P(PSJSYSW0,"^",4):0,1:+$G(^PS(55,PSGP,5.1))),PSGOEE="R" K PSGOEOS
"RTN","PSGOER",48,0)
 K ^PS(53.45,PSJSYSP,1),^(2) D MOVE(3,1),MOVE(1,2)
"RTN","PSGOER",49,0)
 D DATE^PSGOER0(PSGP,PSGORD,PSGDT) I ($G(X)="^")!'$D(PSGFOK(106))!$G(DUOUT) D DONE,ABORT^PSGOEE S VALMBCK="R",COMQUIT=1 Q
"RTN","PSGOER",50,0)
 ;D OC55
"RTN","PSGOER",51,0)
 ;I $G(PSGORQF) D DONE,ABORT^PSGOEE S VALMBCK="R",COMQUIT=1 Q
"RTN","PSGOER",52,0)
SPEED ;
"RTN","PSGOER",53,0)
 I +$G(PSJSYSU)=3 D EN^PSGPEN(PSGORD)
"RTN","PSGOER",54,0)
 Q:$G(DUOUT)
"RTN","PSGOER",55,0)
 N PSGOEAV S PSGOEAV=+PSJSYSU
"RTN","PSGOER",56,0)
 W !!,"...updating order..." K DA S DA(1)=PSGP,DA=+PSGORD,PSGAL("C")=PSJSYSU*10+18000 D ^PSGAL5 W "."
"RTN","PSGOER",57,0)
 I $$LS^PSSLOCK(PSGP,PSGORD) D UPDREN(PSGORD,PSGDT,PSGOEPR,PSGOFD,PSJNOO),UPDRENOE(PSGP,PSGORD,PSGDT) D UNL^PSSLOCK(PSGP,PSGORD)
"RTN","PSGOER",58,0)
 ;
"RTN","PSGOER",59,0)
 I 'PSGOERDP,$P(PSJSYSW0,"^",4),PSGFD'<PSGWLL S $P(^PS(55,PSGP,5.1),"^")=+PSGFD
"RTN","PSGOER",60,0)
 W ".DONE!" S VALMBCK="Q" Q
"RTN","PSGOER",61,0)
 ;
"RTN","PSGOER",62,0)
MARK ;
"RTN","PSGOER",63,0)
 I $P(PSGND4,"^",15),$P(PSGND4,"^",16) W $C(7),!!?3,"...THIS ORDER IS ALREADY MARKED FOR RENEWAL!..." Q
"RTN","PSGOER",64,0)
 K DA S $P(PSGND4,"^",15,17)="1^"_DUZ_"^"_PSGDT,^PS(55,PSGP,5,+PSGORD,4)=PSGND4,PSGAL("C")=13180,DA(1)=PSGP,DA=+PSGORD W "." D ^PSGAL5
"RTN","PSGOER",65,0)
 I $D(PSJSYSO) S PSGORD=+PSGORD_"A",PSGPOSA="R",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOER",66,0)
 Q
"RTN","PSGOER",67,0)
MOVE(X,Y) ; Move comments/dispense drugs from 55 to 53.45.
"RTN","PSGOER",68,0)
 S Q=0 F  S Q=$O(^PS(55,PSGP,5,+PSGORD,X,Q)) Q:'Q  S ^PS(53.45,PSJSYSP,Y,Q,0)=$G(^(Q,0))
"RTN","PSGOER",69,0)
 S:Q ^PS(53.45,Y,0)="^53.450"_Y_"P^"_Q_U_Q
"RTN","PSGOER",70,0)
 Q
"RTN","PSGOER",71,0)
OC55 ;* Order checks for Speed finish and regular finish
"RTN","PSGOER",72,0)
 ;PSJ*5*181 - no longer use (OC will be triggered from OC^PSGOER0)
"RTN","PSGOER",73,0)
 Q
"RTN","PSGOER",74,0)
NEWOC55 ;
"RTN","PSGOER",75,0)
 N INTERVEN,PSJDDI,PSJIREQ,PSJRXREQ,PSJPDRG,PSJDD,PSJDD0,PSJALLGY
"RTN","PSGOER",76,0)
 S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)=""
"RTN","PSGOER",77,0)
 F PSGDDI=0:0 S PSGDDI=$O(^PS(55,PSGP,5,+PSGORD,1,PSGDDI)) Q:'+PSGDDI  D
"RTN","PSGOER",78,0)
 . S PSJDD0=$G(^PS(55,PSGP,5,+PSGORD,1,PSGDDI,0))
"RTN","PSGOER",79,0)
 . S PSJX=$P(PSJDD0,U,3) I PSJX]"",(PSJX'>$G(PSGDT)) Q
"RTN","PSGOER",80,0)
 . S PSJDD=+PSJDD0
"RTN","PSGOER",81,0)
 . S PSJX=$S('$D(^PSDRUG(+PSJDD,0)):1,$P($G(^(2)),U,3)'["U":1,$G(^("I"))="":0,1:^("I")'>$G(PSGDT))
"RTN","PSGOER",82,0)
 . Q:PSJX
"RTN","PSGOER",83,0)
 . S PSJALLGY(PSJDD)=""
"RTN","PSGOER",84,0)
 S PSJDD=$O(PSJALLGY(0))
"RTN","PSGOER",85,0)
 I '+PSJDD W !!,"No active dispense drug was found" D PAUSE^PSJLMUT1 Q
"RTN","PSGOER",86,0)
 K PSGORQF D ENDDC^PSGSICHK(PSGP,PSJDD)
"RTN","PSGOER",87,0)
 D:'$G(PSGORQF) IN^PSJOCDS(PSGORD,"UD",PSJDD) Q:$G(PSGORQF)
"RTN","PSGOER",88,0)
 Q
"RTN","PSGOER",89,0)
UPDREN(PSGORD,RNWDT,PSGOEPR,PSGOFD,PSJNOO,RDUZ) ; update renewed order
"RTN","PSGOER",90,0)
 N DR,DA,DIC,DIE,DD,DO,PSGRZERO,PSGRFOUR,PSGOORD
"RTN","PSGOER",91,0)
 S DR="",PSGOEENO=0,PSGOORD=PSGORD,PSGNESD=PSGSD Q:'PSGORD!'RNWDT!'PSGOEPR!'PSGOFD  S PSJNOO=$S($G(PSJNOO)]"":$G(PSJNOO),1:"E")
"RTN","PSGOER",92,0)
 S PSGRZERO="^PS(55,"_PSGP_",5,"_+PSGORD_",0)",PSGOEORD=$P(@PSGRZERO,"^",21)
"RTN","PSGOER",93,0)
 ; PSJ*5*141 - changed PSGOEPR to PSGPR for field 1 of the DR string below.
"RTN","PSGOER",94,0)
 S DA(1)=PSGP,DA=+PSGORD,DIE="^PS(55,"_PSGP_",5," S DR="34////^S X=PSGFD" S:$G(PSGPR) DR=DR_";1////"_PSGPR_";110////"_PSJNOO D ^DIE
"RTN","PSGOER",95,0)
 K DR,DA,DIC,DIE,DD,DO S DIC="^PS(55,"_PSGP_",5,"_+PSGORD_",14,",DIC(0)="L",DIC("P")="55.6114DA",ND14=$G(@(DIC_"0)")),DINUM=$P(ND14,"^",3)+1,DA(2)=PSGP,DA(1)=+PSGORD D
"RTN","PSGOER",96,0)
 . S DIC("DR")=".01////"_$G(RNWDT)_";1////"_$S($G(RDUZ):RDUZ,1:$G(DUZ))_";2////"_$G(PSGOEPR)_";3////"_$G(PSGOFD)_";4////"_+PSGOEORD,X=$G(RNWDT) D FILE^DICN
"RTN","PSGOER",97,0)
 K DR,DA,DIC,DIE,DD,DO S DA(1)=PSGP,DA=+PSGORD,DIE="^PS(55,"_PSGP_",5,",DR="28////A;105////@;107////@"
"RTN","PSGOER",98,0)
 ;PSJ*5*198
"RTN","PSGOER",99,0)
 S PSGRFOUR="^PS(55,"_PSGP_",5,"_+PSGORD_",4)",PSGRFOUR=@PSGRFOUR I $P(PSGRFOUR,"^",2)<RNWDT S DR=DR_";16////@;17////@" I $G(PSJORD)["P",+PSJSYSU=1 S DR=DR_";18////@;19////@"
"RTN","PSGOER",100,0)
 I '$G(PSJSPEED) I $G(PSGAT)]"",$G(PSGAT)'=$P($G(@(DIE_+PSGORD_",2)")),"^",5) S DR=DR_";41////"_PSGAT
"RTN","PSGOER",101,0)
 D ^DIE
"RTN","PSGOER",102,0)
 Q
"RTN","PSGOER",103,0)
UPDRENOE(PSGP,PSGORD,RDATE) ;
"RTN","PSGOER",104,0)
 D EXPOE(PSGP,PSGORD,$G(RDATE)) ; expire original Orders File order
"RTN","PSGOER",105,0)
 I PSGORD'["P" K DA,DR,DIE S DA(1)=DFN,DA=+PSGORD,DIE="^PS(55,"_DFN_$S(PSGORD="U":",5,",1:",""IV"","),DR=$S(DIE["IV":110,1:66)_"////@" D ^DIE
"RTN","PSGOER",106,0)
 D ENUDTX^PSJOREN(PSGP,PSGORD,"NR")
"RTN","PSGOER",107,0)
 D EN1^PSJHL2(PSGP,"SN",PSGORD,"ORDER RENEWED")
"RTN","PSGOER",108,0)
 Q
"RTN","PSGOER",109,0)
READ ; hold screen
"RTN","PSGOER",110,0)
 I $D(IOST) Q:$E(IOST)'="C"
"RTN","PSGOER",111,0)
 W !?5,"Press return to continue  " R X:$S($D(DTIME):DTIME,1:300)
"RTN","PSGOER",112,0)
 Q
"RTN","PSGOER",113,0)
EXPOE(DFN,PSJORDER,EXPDT) ; expire old Orders File entry
"RTN","PSGOER",114,0)
 I PSJORDER["P" S FILE="^PS(53.1,"_+PSJORDER_",0)",PSJORDER=$P(@FILE,"^",25)
"RTN","PSGOER",115,0)
 I (PSJORDER'["U"),(PSJORDER'["V") Q
"RTN","PSGOER",116,0)
 N CURDAT D NOW^%DTC S CURDAT=$$DATE2^PSJUTL2(%)
"RTN","PSGOER",117,0)
 S PSJEXPOE=$S($G(EXPDT):EXPDT,1:CURDAT) D EN1^PSJHL2(DFN,"SC",PSJORDER) K PSJEXPOE
"RTN","PSGOER",118,0)
 Q
"RTN","PSGOER",119,0)
EXPIRED(PSJX,PSJY) ;
"RTN","PSGOER",120,0)
 ; INPUT 
"RTN","PSGOER",121,0)
 ;       PSJX - Pharmacy Patient, pointer to ^PS(55
"RTN","PSGOER",122,0)
 ;       PSJY - Inpatient Order Number(appended with "V" or "U")
"RTN","PSGOER",123,0)
 ; OUTPUT
"RTN","PSGOER",124,0)
 ;   0  -  Order has not exceeded the Expired Time Limit 
"RTN","PSGOER",125,0)
 ;   1  -  Order has exceeded the Expired Time Limit
"RTN","PSGOER",126,0)
 N STOP,STATUS,NOW,CUTOFF,FREQ,LAST,ST,X,DFN,U,PSGDT,SD,WD,PSJPSTO,PSGDW,PSGOC,ZZND,LASTAT,LSTSTR,PSBCNT S DFN=PSJX,U="^",CUTOFF=0
"RTN","PSGOER",127,0)
 S STATUS=$S(PSJY["U":$P($G(^PS(55,PSJX,5,+PSJY,0)),"^",9),PSJY["V":$P($G(^PS(55,PSJX,"IV",+PSJY,0)),"^",17),1:"")
"RTN","PSGOER",128,0)
 S NOW=$S($G(PSGDT):PSGDT,1:$$DATE^PSJUTL2())
"RTN","PSGOER",129,0)
 S STOP=$S(PSJY["U":$P($G(^PS(55,PSJX,5,+PSJY,2)),U,4),1:$P($G(^PS(55,PSJX,"IV",+PSJY,0)),"^",3))
"RTN","PSGOER",130,0)
 I NOW<STOP Q 0
"RTN","PSGOER",131,0)
 I PSJY["U" N ND2,ND0 S ND0=$G(^PS(55,PSJX,5,+PSJY,0)),ND2=$G(^PS(55,PSJX,5,+PSJY,2)),FREQ=$P(ND2,"^",6) D
"RTN","PSGOER",132,0)
 .N SCHED S SCHED=$P($G(^PS(55,PSJX,5,+PSJY,2)),"^") I SCHED["PRN" S FREQ=$$PRNFREQ(SCHED)
"RTN","PSGOER",133,0)
 .S LSTSTR=$P(ND2,"^",2)_"^"_$P(ND2,"^",4)_"^"_SCHED_"^"_$P(ND0,"^",7)_"^^"_$P(ND2,"^",5)
"RTN","PSGOER",134,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I LAST,($P(ND0,"^",7)="O"),($P(LAST,"^",3)="G") I LAST>$P(ND2,"^",2) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",135,0)
 .I 'LAST!(LAST>$P(ND2,"^",4)) S LAST=$$LASTAT^PSJORP2(DFN,LSTSTR) S:LAST CUTOFF=$$FMADD^XLFDT(LAST,,,FREQ) Q
"RTN","PSGOER",136,0)
 .I SCHED["PRN",($P(LSTSTR,"^",6)="") S CUTOFF=$$FMADD^XLFDT(LAST,,,FREQ) Q
"RTN","PSGOER",137,0)
 .I $$DOW^PSIVUTL(SCHED) S CUTOFF=$$NXTDOW(DFN,$P(LSTSTR,"^"),$P(LSTSTR,"^",2),$P(LSTSTR,"^",3),$P(LSTSTR,"^",6)) Q
"RTN","PSGOER",138,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I 'LAST!(LAST>$P(ND2,"^",4)) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",139,0)
 .S $P(LSTSTR,"^")=$$FMADD^XLFDT(LAST,,,,1),$P(LSTSTR,"^",2)=$$FMADD^XLFDT(PSGDT,,,FREQ) S CUTOFF=$$ENQ^PSJORP2(PSJX,LSTSTR)
"RTN","PSGOER",140,0)
 I PSJY["V" N LIMIT S LIMIT=$P($G(^PS(59.7,1,31)),"^",4) S LIMIT=$S((LIMIT]""):+LIMIT,1:24) S CUTOFF=$$FMADD^XLFDT(STOP,,LIMIT) D
"RTN","PSGOER",141,0)
 .I '($G(P(4))]"") N P,YP,XP S YP=$G(^PS(55,DFN,"IV",+PSJY,0)) F XP=1:1:23 S P(XP)=$P(YP,U,XP)
"RTN","PSGOER",142,0)
 .Q:'($G(P(4))]"")
"RTN","PSGOER",143,0)
 .Q:'$$SCHREQ^PSJLIVFD(.P)
"RTN","PSGOER",144,0)
 .N INTERVAL,LSTSTR,ND0,SCHED,IVSTYP S ND0=$G(^PS(55,PSJX,"IV",+PSJY,0)),INTERVAL=$P(ND0,"^",15),SCHED=$P(ND0,"^",9) Q:SCHED=""
"RTN","PSGOER",145,0)
 .S IVSTYP=$S($$DOW^PSIVUTL(SCHED):"D",INTERVAL="O":"O",1:"C"),LSTSTR=$P(ND0,"^",2)_"^"_$P(ND0,"^",3)_"^"_SCHED_"^"_IVSTYP_"^^"_$P(ND0,"^",11)
"RTN","PSGOER",146,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I LAST,IVSTYP="O",LAST>$P(ND0,"^",2),($P(LAST,"^",3)="G") S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",147,0)
 .I 'LAST!(LAST>$P(ND0,"^",3))!(LAST&(IVSTYP="O")) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",148,0)
 .I IVSTYP="D" S CUTOFF=$$NXTDOW(LAST,SCHED,$G(P(2)),$P($G(P(9)),"@"),$G(P(11))) Q
"RTN","PSGOER",149,0)
 .I SCHED["PRN" S FREQ=$$PRNFREQ(SCHED) S CUTOFF=$$FMADD^XLFDT(LAST,,,FREQ) Q
"RTN","PSGOER",150,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I 'LAST!(LAST>$P(ND0,"^",3)) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",151,0)
 .S $P(LSTSTR,"^")=$$FMADD^XLFDT(LAST,,,,1),$P(LSTSTR,"^",2)=$$FMADD^XLFDT(PSGDT,31) S CUTOFF=$$ENQ^PSJORP2(PSJX,LSTSTR)
"RTN","PSGOER",152,0)
 K LYN,PSBDT,PSBFLAG,PSBSTR
"RTN","PSGOER",153,0)
 Q $S(CUTOFF<NOW:1,1:0)
"RTN","PSGOER",154,0)
 ;
"RTN","PSGOER",155,0)
NXTDOW(DOWDFN,DOWSD,DOWFD,DOWSCH,DOWAT) ;
"RTN","PSGOER",156,0)
 N NXTADM,DOWSTR S DOWSTR=$$FMADD^XLFDT(DOWFD,,,,1)_"^"_$$FMADD^XLFDT(DOWFD,7)_"^"_DOWSCH_"^D^^"_DOWAT S NXTADM=$$ENQ^PSJORP2(DOWDFN,DOWSTR)
"RTN","PSGOER",157,0)
 Q $S(NXTADM:NXTADM,1:DOWSD)
"RTN","PSGOER",158,0)
 ;
"RTN","PSGOER",159,0)
PRNFREQ(SCHED) ;
"RTN","PSGOER",160,0)
 N ZZND,D,DA,X,PSGAT,PSGOES,PSGST,PSJNSS,PSJPWD,TEST,VALMBCK,PSGS0XT,PSGS0Y,PSGDT
"RTN","PSGOER",161,0)
 F X=$P(SCHED,"PRN"),$P(SCHED,"PRN",2),$P(SCHED," PRN"),$P(SCHED,"PRN ",2) Q:$P($G(ZZND),"^",4)  D ADMIN^PSJORPOE
"RTN","PSGOER",162,0)
 Q $S($G(PSGS0XT):PSGS0XT,1:1440)
"RTN","PSGOER0")
0^100^B22183476
"RTN","PSGOER0",1,0)
PSGOER0 ;BIR/CML3-EDIT FIELDS FOR RENEWAL ;05 May 98 / 10:58 AM
"RTN","PSGOER0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**11,45,47,50,63,64,70,69,58,80,110,127,136,181**;16 DEC 97;Build 190
"RTN","PSGOER0",3,0)
 ;
"RTN","PSGOER0",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGOER0",5,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSGOER0",6,0)
 ; Reference to ^DD(55.06 is supported by DBIA 2253.
"RTN","PSGOER0",7,0)
 ; Reference to ^%DT is supported by DBIA 10003.
"RTN","PSGOER0",8,0)
 ; Reference to ^DIC is supported by DBIA 10006.
"RTN","PSGOER0",9,0)
 ;
"RTN","PSGOER0",10,0)
DATE(PSGP,PSGORD,PSGDT) ;
"RTN","PSGOER0",11,0)
 K PSGFOK,PSJNOO S F1=55.06,PSGWLL=+$G(^PS(55,PSGP,5.1)),PSGOER0=$G(^PS(55,PSGP,5,+PSGORD,0)),PSGPDRG=+$G(^(.2)),PSGOER2=$G(^(2))
"RTN","PSGOER0",12,0)
 NEW XX S XX=$$ACTIVE^PSJORREN(PSGP,PSGORD) S:+XX=2 PSGPDRG=$P(XX,U,2)
"RTN","PSGOER0",13,0)
 I '+XX W !,"No active Orderable Item was found.",! G DONE
"RTN","PSGOER0",14,0)
 S (PSGNEDFD,PSGOERDP)=$P($$GTNEDFD^PSGOE7("U",PSGPDRG),U)
"RTN","PSGOER0",15,0)
 S PSGSCH=$P(PSGOER2,"^"),PSGST=$P(PSGOER0,"^",7),PSGS0Y=$P(PSGOER2,"^",5),PSGS0XT=$P(PSGOER2,"^",6)
"RTN","PSGOER0",16,0)
 S PSGOEPR=+$P(PSGOER0,"^",2),(PSGOPR,PSGPR)=$S($P(PSJSYSU,";",2):DUZ,1:+PSGOEPR)
"RTN","PSGOER0",17,0)
 I $G(PSJSPEED) S PSGPR=$S($P(ND,"^",2):$P(ND,"^",2),1:+PSGOEPR)
"RTN","PSGOER0",18,0)
 S PSGOSD=+$P(PSGOER2,"^",2) S PSGOFD=+$P(PSGOER2,"^",4),PSGPRN=$P($G(^VA(200,PSGPR,0)),"^"),PSGPRI=$S($P(PSJSYSU,";",2):0,1:$P($G(^("PS")),"^",4)),PSGRO=0 S:PSGPRI PSGPRI=PSGPRI'>DT I PSGPRI S (PSGOPR,PSGPR,PSGPRN)=""
"RTN","PSGOER0",19,0)
 S PSGRNSD=$S($G(PSGLI):PSGLI,1:$G(PSGDT))
"RTN","PSGOER0",20,0)
 S PSGSD=$G(PSGOSD)
"RTN","PSGOER0",21,0)
 I PSGSD="" S PSJREN=1,PSGSD=$$ENSD^PSGNE3($S(PSGST["P":"PRN",1:$P(PSGOER2,U)),PSGS0Y,PSGDT,PSGOSD) S:PSGOSD>PSGSD PSGSD=PSGOSD K PSJREN
"RTN","PSGOER0",22,0)
 S PSGSDN=$$ENDD^PSGMI(PSGSD)
"RTN","PSGOER0",23,0)
10 ;
"RTN","PSGOER0",24,0)
 ;W !,"START DATE/TIME: "_PSGSDN
"RTN","PSGOER0",25,0)
O25 ;
"RTN","PSGOER0",26,0)
 N PSGSD,PSGNEFD S PSGSD=PSGDT
"RTN","PSGOER0",27,0)
 D ENWALL^PSGNE3(PSGSD,0,PSGP)
"RTN","PSGOER0",28,0)
 S:'$G(PSGDT) PSGDT=$$DATE2^PSJUTL2($$NOW^XLFDT)
"RTN","PSGOER0",29,0)
 N PSGNESD S PSGNESD=PSGDT D ENFD^PSGNE3(PSGNESD) I $G(PSGNEFD) S (Y,PSGFD)=PSGNEFD
"RTN","PSGOER0",30,0)
 S PSGFOK(10)="" I PSGST="O" S PSGFD=$$ENOSD^PSJDCU(PSJSYSW0,PSGRNSD,PSGP) I PSGFD]"" S Y=PSGRNSD,X=0 G 1
"RTN","PSGOER0",31,0)
D25 K DUR,DURMIN N PKGFLG S PKGFLG=$S(PSGORD["U":5,PSGORD["V":"IV",PSGORD["P":"P",1:"") I PKGFLG]"" S DUR=$$GETDUR^PSJLIVMD(PSGP,+$G(PSGORD),PKGFLG,1) I DUR]"" D
"RTN","PSGOER0",32,0)
 .S DURMIN=($$DURMIN^PSJLIVMD(DUR)\1) I DURMIN>1 S Y=$$FMADD^XLFDT(PSGRNSD,,,DURMIN) I Y>PSGRNSD S PSGFD=Y,X=0
"RTN","PSGOER0",33,0)
 I $P($G(PSGOER2),"^",4)>PSGFD S Y=$P(PSGOER2,"^",4)
"RTN","PSGOER0",34,0)
 I $G(DUR)]"",($G(PSGORD)'["P") S DURMIN=$$DURMIN^PSJLIVMD(DUR)\1 S Y=$$FMADD^XLFDT(PSGDT,,,DURMIN)
"RTN","PSGOER0",35,0)
 S:X&$P(PSJSYSW0,"^",7) $P(Y,".",2)=$P(PSJSYSW0,"^",7) S PSGFD=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)
"RTN","PSGOER0",36,0)
25 W !,"STOP DATE/TIME: "_PSGFDN_"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S:'$T X="^" S PSGRO=1,COMQUIT=1 G DONE
"RTN","PSGOER0",37,0)
 I X="" W "   "_PSGFDN G W25
"RTN","PSGOER0",38,0)
 I $E(X)="^" D FF G:Y>0 @Y G 25
"RTN","PSGOER0",39,0)
 S PSGF2=25 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,25)
"RTN","PSGOER0",40,0)
 I X=+X,X>0,X'>2000000 G 25:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X,ND2=PSGOER2,$P(ND2,"^",2)=PSGRNSD W " ...dose limit..." D ENGO^PSGDL
"RTN","PSGOER0",41,0)
 K %DT S %DT="ERTX" D ^%DT K %DT G:Y'>0 25 S PSGFD=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)
"RTN","PSGOER0",42,0)
W25 I PSGFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",!
"RTN","PSGOER0",43,0)
 I PSGFD<PSGSD W $C(7),!!?3,"*** The STOP date must be AFTER the START date. ***" G 25
"RTN","PSGOER0",44,0)
 S PSGFOK(25)=""
"RTN","PSGOER0",45,0)
 ;Display Expected First Dose;BHW;PSJ*5*136
"RTN","PSGOER0",46,0)
 D EFDNEW^PSJUTL
"RTN","PSGOER0",47,0)
 I $G(PSGONF),(+$G(PSGODDD(1))'<+$G(PSGONF)) S PSGFOK(1)="" Q
"RTN","PSGOER0",48,0)
1 ; provider
"RTN","PSGOER0",49,0)
 G:+PSJSYSU<3&$P(PSJSYSU,";",2) CHKDD S PSGF2=1
"RTN","PSGOER0",50,0)
A1 ;
"RTN","PSGOER0",51,0)
 W !,"PROVIDER: ",$S(PSGPR:PSGPRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S:'$T X="^" S PSGRO=1,COMQUIT=1 G DONE
"RTN","PSGOER0",52,0)
 I $S(X="":'PSGPR,1:X="@") W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,1) G A1
"RTN","PSGOER0",53,0)
 I X="",PSGPR S X=PSGPRN I PSGPR'=PSGPRN,$D(^VA(200,PSGPR,"PS")) W "    "_$P(^("PS"),"^",2)_"    "_$P(^("PS"),"^",3) S PSGFOK(1)="" G OC55
"RTN","PSGOER0",54,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,1)
"RTN","PSGOER0",55,0)
 I $E(X)="^" D FF G:Y>0 @Y G A1
"RTN","PSGOER0",56,0)
 K DIC S DIC="^VA(200,",DIC(0)="EMQZ",DIC("S")="S X(1)=$G(^(""PS"")) I X(1),$S('$P((X(1)),""^"",4):1,1:DT<$P((X(1)),""^"",4))" D ^DIC K DIC I Y'>0 G A1
"RTN","PSGOER0",57,0)
 S PSGPR=+Y,PSGPRN=$P(Y(0,0),"^"),PSGFOK(1)=""
"RTN","PSGOER0",58,0)
OC55 ;
"RTN","PSGOER0",59,0)
 ;Order check for Speed finish is triggered from OC531^PSGOESF
"RTN","PSGOER0",60,0)
 I $G(PSGORD)]"P",$G(PSJSPEED) Q
"RTN","PSGOER0",61,0)
 D NEWOC55^PSGOER
"RTN","PSGOER0",62,0)
 I $G(PSGORQF) S COMQUIT=1 G DONE
"RTN","PSGOER0",63,0)
CHKDD ;
"RTN","PSGOER0",64,0)
 G:$G(PSGRENEW) 106
"RTN","PSGOER0",65,0)
 I PSGORD["P"!$$DDOK^PSGOE2("^PS(55,"_PSGP_",5,"_+PSGORD_",1,",PSGPDRG) G 106
"RTN","PSGOER0",66,0)
 ;I PSGORD["P"!'$$CHKDD^PSGOE2("^PS(55,"_PSGP_",5,"_+PSGORD_",") G 106
"RTN","PSGOER0",67,0)
 I $P(PSJSYSU,";")'=3,'$P(PSJSYSP0,U,2) W !!,"This order's dispense drug is invalid, a pharmacist must renew this order." Q
"RTN","PSGOER0",68,0)
 K ^PS(53.45,PSJSYSP,1),^(2)
"RTN","PSGOER0",69,0)
 W !!,"THE DISPENSE DRUG IS MISSING FROM THIS ORDER."
"RTN","PSGOER0",70,0)
 D ENDRG^PSGOEF1(+^PS(55,PSGP,5,+PSGORD,.2),0)
"RTN","PSGOER0",71,0)
 I $G(DUOUT)!'$G(DRG) S COMQUIT=1 Q
"RTN","PSGOER0",72,0)
106 ; nature of order
"RTN","PSGOER0",73,0)
 S PSJNOO=$$ENNOO^PSJUTL5("R") S:PSJNOO<0 COMQUIT=1
"RTN","PSGOER0",74,0)
 S:PSJNOO'<0 PSGFOK(106)=""
"RTN","PSGOER0",75,0)
DONE ;
"RTN","PSGOER0",76,0)
 K F,F0,F1,PSGF2,F3,ND2,PSGDL,PSGDLS,PSGOROE1,PSGRO,SDT Q
"RTN","PSGOER0",77,0)
FF ; "^" to another field
"RTN","PSGOER0",78,0)
 K DIC S DIC="^DD(55.06,",DIC(0)="EQ",DIC("S")="I $D(PSGFOK(+Y))",X=$E(X,2,255) D ^DIC K DIC
"RTN","PSGOER0",79,0)
 S Y=+Y Q
"RTN","PSGOERI")
0^101^B17021979
"RTN","PSGOERI",1,0)
PSGOERI ;BIR/CML3-REINSTATE A DC'D ORDER ;06 Aug 98 / 2:17 PM
"RTN","PSGOERI",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**17,27,31,88,110,137,181**;16 DEC 97;Build 190
"RTN","PSGOERI",3,0)
 ;
"RTN","PSGOERI",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSGOERI",5,0)
 ;
"RTN","PSGOERI",6,0)
ENRI ;
"RTN","PSGOERI",7,0)
 S PSGALR=80,PSGFD=$P($G(^PS(55,PSGP,5,+PSGORD,2)),"^",3) I 'PSGFD W:'$D(PSJUNDC) $C(7),$C(7),!?3,"I CANNOT REINSTATE THIS ORDER!  THE OLD STOP DATE IS MISSING!" Q
"RTN","PSGOERI",8,0)
 I PSGFD'>PSGDT Q:$D(PSJUNDC)  W !!,"This order has technically expired as of ",$$ENDTC^PSGMI,"." F  S %=1 W !!,"Do you want to RENEW this order" D YN^DICN Q:%  D
"RTN","PSGOERI",9,0)
 .W !!?2,"This order has expired, and cannot be renewed.  But the order can be",!,"reinstated.  Answer 'YES' to reinstate the order now.  Answer 'NO' (or '^') if",!,"you do not want to reinstate this order now."
"RTN","PSGOERI",10,0)
 I PSGFD'>PSGDT G:%'=1 DONE S PSGRRF=0 D NEW^PSGOER,DONE^PSGOER G DONE
"RTN","PSGOERI",11,0)
 W:'$D(PSJUNDC) !!,"...reinstating this order..."
"RTN","PSGOERI",12,0)
 ;Create a list of recipients beyond normal mail group
"RTN","PSGOERI",13,0)
 D:$D(PSJUNDC)  ;  do only if from movement deletion 
"RTN","PSGOERI",14,0)
 .I $P(^PS(55,PSGP,5,+PSGORD,4),U,1)'="" S PSJSENTO($J,$P(^PS(55,PSGP,5,+PSGORD,4),U,1))="" ; Record verifying Nurse
"RTN","PSGOERI",15,0)
 .I $P(^PS(55,PSGP,5,+PSGORD,4),U,3)'="" S PSJSENTO($J,$P(^PS(55,PSGP,5,+PSGORD,4),U,3))="" ; Record verifying Pharmacist
"RTN","PSGOERI",16,0)
 .I $P(^PS(55,PSGP,5,+PSGORD,4),U,5)'="" S PSJSENTO($J,$P(^PS(55,PSGP,5,+PSGORD,4),U,5))="" ; Record Physician
"RTN","PSGOERI",17,0)
 .I $P(^PS(55,PSGP,5,+PSGORD,0),U,2)'="" S PSJSENTO($J,$P(^PS(55,PSGP,5,+PSGORD,0),U,2))="" ; Record Provider
"RTN","PSGOERI",18,0)
 ;If a duplicate order exists do not reinstate the older one.  Record in ^TMP for later advice in auto e-mail (PSJADT2)
"RTN","PSGOERI",19,0)
 D NOW^%DTC
"RTN","PSGOERI",20,0)
 I $D(PSJUNDC) I $$CHECKDUP^PSGOERI(PSGP,+PSGORD) S ^TMP("PSJNOTUNDC",$J,PSGP,PSGORD_"U")="" G DONE
"RTN","PSGOERI",21,0)
 ;S DR=$S(+$P($G(^PS(55,PSGP,5,+PSGORD,4)),U,18)=1:"28///H",+$P($G(^(4)),U,26)=1:"28///H",1:"28////A")_";34////"_PSGFD_";136////@"
"RTN","PSGOERI",22,0)
 S DR=$S(+$P($G(^PS(55,PSGP,5,+PSGORD,4)),U,26)=1:"28///H;136////HP",+$P($G(^(4)),U,18)=1:"28///H;136////@",1:"28////A;136////@")_";34////"_PSGFD
"RTN","PSGOERI",23,0)
 S Z=$G(^PS(55,PSGP,5,+PSGORD,4)),$P(Z,U,11)="",$P(Z,"^",15,17)="^^" S:'$D(PSJUNDC) $P(Z,"^",PSJSYSU,PSJSYSU+1)=DUZ_"^"_PSGDT S ^(4)=Z W "."
"RTN","PSGOERI",24,0)
 N CHKIT S CHKIT=$G(^PS(55,PSGP,5,+PSGORD,0)) I $P(CHKIT,U,26)["P",($P(CHKIT,U,27)="R") S DR=DR_";105///@;107///@"
"RTN","PSGOERI",25,0)
 S DIE="^PS(55,"_PSGP_",5,",DA(1)=PSGP,DA=+PSGORD,PSGAL("C")=$S($D(PSJUNDC):40,1:(PSJSYSU*10))+18500 D ^PSGAL5 W "." D ^DIE W "."
"RTN","PSGOERI",26,0)
 S X=$P(^PS(55,PSGP,5,+PSGORD,0),"^",20),$P(^(0),"^",20)="" K:X ^PS(55,"AUDDD",X,PSGP,+PSGORD) ;Removed cross reference after reinstate order.
"RTN","PSGOERI",27,0)
 ;S X=$O(^ORD(101,"B","PS EVSEND OR",0))_";ORD(101,",PSOC="SC",PSJORDER=$$ORDER^PSJHLU(PSGORD) D EN1^XQOR:X K X
"RTN","PSGOERI",28,0)
 S ^TMP("PSJUNDC",$J,PSGP,PSGORD_"U")=""
"RTN","PSGOERI",29,0)
 D EN1^PSJHL2(PSGP,"SC",PSGORD_"U",$S($D(PSJUNDC):"AUTO REINSTATED",1:"REINSTATED"))
"RTN","PSGOERI",30,0)
 Q:$S('$D(PSJUNDC):0,PSGALO=18540:1,1:'$P($G(PSJSYSW0),U,15))
"RTN","PSGOERI",31,0)
 S PSGTOL=$S($D(PSJUNDC):3,1:2),PSGUOW=$S($D(PSJUNDC):PSJUOW,1:DUZ)
"RTN","PSGOERI",32,0)
 I $D(^PS(53.41,1,1,+PSGUOW,1,PSGP,1,1,1,+PSGORD)) K DIK,DA S DIK="^PS(53.41,"_1_",1,"_+PSGUOW_",1,"_PSGP_",1,1,1,",DA=+PSGORD,DA(1)=1,DA(2)=PSGP,DA(3)=+PSGUOW,DA(4)=1 D ^DIK
"RTN","PSGOERI",33,0)
 E  D
"RTN","PSGOERI",34,0)
 .S X=0 S:$D(PSJUNDC) X=$O(^PS(59.6,"B",+PSGUOW,0)),X=$P($G(^PS(59.6,+X,0)),U,15)
"RTN","PSGOERI",35,0)
 .I $S(X:1,'PSJSYSL:0,PSJSYSL<3:1,1:$P(^PS(55,PSGP,5,DA,4),"^",+PSJSYSU'=3+9)) D
"RTN","PSGOERI",36,0)
 ..K DA S DA=+PSGORD,DA(1)=PSGP,$P(^PS(55,PSGP,5,DA,7),"^",1,2)=PSGDT_"^RE",PSGTOO=1,PSGUOW=$S($D(PSJUNDC):+PSJUOW,1:DUZ) D ENL^PSGVDS W "."
"RTN","PSGOERI",37,0)
 W:'$D(PSJUNDC) ".DONE!" Q
"RTN","PSGOERI",38,0)
 ;
"RTN","PSGOERI",39,0)
DONE ;
"RTN","PSGOERI",40,0)
 K DA,DIE,DR,PSGAL,PSGALR,PSGFD,PSGID,PSGOD,RF,Z
"RTN","PSGOERI",41,0)
 Q
"RTN","PSGOERI",42,0)
CHECKDUP(PSGP,PSGORD) ;
"RTN","PSGOERI",43,0)
 N Z,ZZ,PSJCOM
"RTN","PSGOERI",44,0)
 S FOUND=0
"RTN","PSGOERI",45,0)
 S PSGX=+$G(^PS(55,PSGP,5,+PSGORD,.2)),PSJCOM=+$P($G(^(.2)),"^",8)
"RTN","PSGOERI",46,0)
 I PSGX'="" D
"RTN","PSGOERI",47,0)
 .F Z=%:0 S Z=$O(^PS(55,+PSGP,5,"AUS",Z)) Q:'Z!FOUND  D
"RTN","PSGOERI",48,0)
 ..F ZZ=0:0 S ZZ=$O(^PS(55,+PSGP,5,"AUS",Z,ZZ)) Q:'ZZ!FOUND  D
"RTN","PSGOERI",49,0)
 ...I PSJCOM>0 Q:+$P($G(^PS(55,+PSGP,5,ZZ,.2)),"^",8)=PSJCOM
"RTN","PSGOERI",50,0)
 ...I +$G(^PS(55,+PSGP,5,ZZ,.2))=PSGX D
"RTN","PSGOERI",51,0)
 ....S FOUND=1
"RTN","PSGOERI",52,0)
 Q FOUND
"RTN","PSGOES")
0^83^B21797415
"RTN","PSGOES",1,0)
PSGOES ;BIR/CML3-CREATE ORDERS USING ORDER SET ;19 Feb 99 / 12:53 PM
"RTN","PSGOES",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**12,22,30,34,50,58,111,181**;16 DEC 97;Build 190
"RTN","PSGOES",3,0)
 ;
"RTN","PSGOES",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSGOES",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGOES",6,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSGOES",7,0)
 ;
"RTN","PSGOES",8,0)
 K DIC,PSGOEOS S X=$P(X,"S.",2),DIC="^PS(53.2,",DIC(0)="QEM" D ^DIC K DIC G:Y'>0 DONE W "  (ORDER SET)" S PSGOESDA=+Y,PSGOES=1
"RTN","PSGOES",9,0)
 I '$D(^PS(53.2,+Y,2)) W "    Invalid Order Set" Q
"RTN","PSGOES",10,0)
 I $P(PSJSYSU,";",2) S PSGOESPR=DUZ
"RTN","PSGOES",11,0)
 E  D  G:Y'>0 DONE
"RTN","PSGOES",12,0)
 .S DIC="^VA(200,",DIC(0)="QEAM",DIC("A")="Select PROVIDER: ",X=$P($G(^PS(55,PSGP,5.1)),"^",2) I X S X=$P($G(^VA(200,X,0)),"^") I X]"" S Y=^("PS") I Y,$S('$P(Y,"^",4):1,1:$P(Y,"^",4)>DT) S DIC("B")=X
"RTN","PSGOES",13,0)
 .S DIC("S")="S X(1)=$G(^(""PS"")) I X(1),$S('$P(X(1),""^"",4):1,1:$P(X(1),""^"",4)>DT)" W ! D ^DIC K DIC I Y'>0 W $C(7),!!,"Provider is required for order sets." Q
"RTN","PSGOES",14,0)
 .S PSGOESPR=+Y S:$P($G(^PS(55,PSGP,5.1)),"^",2)'=+Y $P(^(5.1),"^",2)=+Y
"RTN","PSGOES",15,0)
 S PSJNOO=$$ENNOO^PSJUTL5("N")
"RTN","PSGOES",16,0)
 I $G(PSJNOO)<0 W !,$C(7),"...order set not entered..." G DONE
"RTN","PSGOES",17,0)
 F PSGOESN=0:0 S PSGOESN=$O(^PS(53.2,PSGOESDA,2,PSGOESN)) Q:'PSGOESN  I $D(^(PSGOESN,0)) S OSND=^(0) I $S($P(OSND,"^",3)="":0,$P(OSND,"^",4)="":0,$P(OSND,"^",4)="OC":1,1:$P(OSND,"^",5)]"") S PSGSI=$P($G(^(1)),"^") D GND Q:PSGQUIT
"RTN","PSGOES",18,0)
 ;
"RTN","PSGOES",19,0)
DONE ;
"RTN","PSGOES",20,0)
 K PSJNOON,PSJNOO
"RTN","PSGOES",21,0)
 S X="S.X" K %DT,N,OSND,PSGOESDA,PSGDDRG,PSGOESI,PSGOES,PSGOEOS,PSGOESN,PSGOESPR,PSGQUIT,PSGX,SDT,STDAY,X1,X2 Q
"RTN","PSGOES",22,0)
 ;
"RTN","PSGOES",23,0)
GND ;
"RTN","PSGOES",24,0)
 NEW PSJOCDS,PSJALLGY,PSJMULDD
"RTN","PSGOES",25,0)
 K PSGOEE,PSGSCH,PSGORD
"RTN","PSGOES",26,0)
 S (PSGPDRG,PSGX)=+OSND,PSGPDRGN=$P($G(^PS(50.7,PSGPDRG,0)),"^") S:PSGPDRGN="" PSGPDRGN=PSGPDRG W !!,"...entering ",$S(PSGPDRGN'=PSGPDRG:PSGPDRGN,1:"** UNKNOWN **"),"..." K Y,DIRUT D END^PSGSICHK S PSGQUIT=$D(DIRUT) Q:$G(Y)<0
"RTN","PSGOES",27,0)
 S PSGNEDFD=$P(OSND,"^",2,5),PSGMR=$P(OSND,"^",3),PSGST=$P(OSND,"^",4),PSGDO=$P(OSND,"^",9),PSGMRN=$$ENMRN^PSGMI(PSGMR)
"RTN","PSGOES",28,0)
 S:PSGMRN="" PSGMRN=PSGMR D NOW^%DTC S PSGDT=+$E(%,1,12) I PSGST="OC" S PSGSCH="ON CALL",(PSGS0XT,PSGS0Y)=""
"RTN","PSGOES",29,0)
 E  S X=$P(OSND,"^",5) W "." S:X X="`"_X D ENOS^PSGS0 S:$D(X) PSGSCH=X I '$D(X) S (PSGSCH,PSGS0XT,PSGS0Y)=""
"RTN","PSGOES",30,0)
 S (PSGNESD,PSGNEFD)="" W "." I $P(OSND,"^",11)]"" S %DT="T",X=$P(OSND,"^",11) D ^%DT S PSGNESD=Y D ENFD^PSGNE3(PSGDT)
"RTN","PSGOES",31,0)
 D:$P(OSND,"^",11)="" ^PSGNE3 K PSGDRG,PSGORQF,^PS(53.45,PSJSYSP,1),^(2) S (N,Q)=0
"RTN","PSGOES",32,0)
 K PSJALLGY
"RTN","PSGOES",33,0)
 ;If PSJMULDD >1 then the order has mutliple DD and it will flag ENDDC^PSGSICHK to display the OI name instead of DD name
"RTN","PSGOES",34,0)
 S PSJMULDD=0
"RTN","PSGOES",35,0)
 F  S Q=$O(^PS(53.2,PSGOESDA,2,PSGOESN,2,Q)) Q:'Q!$D(PSGORQF)  S PSGDRG=$G(^(Q,0)) I PSGDRG D
"RTN","PSGOES",36,0)
 .S PSJALLGY(+PSGDRG)="",PSJMULDD=PSJMULDD+1
"RTN","PSGOES",37,0)
 .;D ENDDC^PSGSICHK(PSGP,+PSGDRG) Q:$D(PSGORQF)
"RTN","PSGOES",38,0)
 .;D IN^PSJOCDS($G(PSGORD),"UD",+PSGDRG) Q:$D(PSGORQF)
"RTN","PSGOES",39,0)
 .;D CONT^PSJOCDT Q:$D(PSGORQF)
"RTN","PSGOES",40,0)
 .S:$P(PSGDRG,U,2)="" $P(PSGDRG,U,2)=1
"RTN","PSGOES",41,0)
 .S N=N+1,^PS(53.45,PSJSYSP,2,N,0)=PSGDRG,^PS(53.45,PSJSYSP,2,"B",+PSGDRG,N)="" W "."
"RTN","PSGOES",42,0)
 .I $P(^PSDRUG(+PSGDRG,2),U,3)'["U"!($S('+$G(^PSDRUG(+PSGDRG,"I")):0,^("I")'>DT:1,1:0)) S PSGOEAV="0^1" W:PSJSYSU $C(7),!?5,"...AS NON-VERIFIED - DATA INCOMPLETE..."
"RTN","PSGOES",43,0)
 S PSGDRG=$O(PSJALLGY(0)) Q:'+PSGDRG
"RTN","PSGOES",44,0)
 D FULL^VALM1
"RTN","PSGOES",45,0)
 D ENDDC^PSGSICHK(PSGP,+PSGDRG) Q:$D(PSGORQF)
"RTN","PSGOES",46,0)
 D IN^PSJOCDS($G(PSGORD),"UD",+PSGDRG) Q:$D(PSGORQF)
"RTN","PSGOES",47,0)
 D CONT^PSJOCDT Q:$D(PSGORQF)
"RTN","PSGOES",48,0)
 I N S ^PS(53.45,PSJSYSP,2,0)="^53.4502P^"_N_"^"_N
"RTN","PSGOES",49,0)
 I $G(PSGORQF) W !,?5,"...ORDER FOR ",PSGPDRGN," NOT ENTERED...",! Q
"RTN","PSGOES",50,0)
 ;I PSGOEAV,$S($D(PSGOEOS):1,'PSGPDRG:1,PSGPDRG=PSGPDRGN:1,'PSGMR:1,PSGMR=PSGMRN:1,PSGSCH="":1,PSGST="":1,'PSGNESD:1,'PSGNEFD:1,+PSJSYSU=3:'N,1:0) S PSGOEAV="0^1" W:('$D(PSGOEOS)&PSJSYSU) $C(7),!?5,"...AS NON-VERIFIED - DATA INCOMPLETE..."
"RTN","PSGOES",51,0)
 I PSGOEAV,$S('PSGPDRG:1,PSGPDRG=PSGPDRGN:1,'PSGMR:1,PSGMR=PSGMRN:1,PSGSCH="":1,PSGST="":1,'PSGNESD:1,'PSGNEFD:1,+PSJSYSU=3:'N,1:0) S PSGOEAV="0^1" W:('$D(PSGOES)&PSJSYSU) $C(7),!?5,"...AS NON-VERIFIED - DATA INCOMPLETE..."
"RTN","PSGOES",52,0)
 S (PSGHSM,PSGSM)="",PSGPR=PSGOESPR D ^PSGOETO S PSGOEAV=$P(PSJSYSP0,"^",9)&PSJSYSU
"RTN","PSGOES",53,0)
 ; pharmacist label check, build label for order set only if auto verify turned on
"RTN","PSGOES",54,0)
 I PSJSYSL>0,(PSGOEAV),($P($G(^PS(55,PSGP,5,$S($D(DA):DA,1:+PSGORD),0)),U,9)="A") D
"RTN","PSGOES",55,0)
 .S $P(^PS(55,PSGP,5,$S($D(DA):DA,1:+PSGORD),7),U)=PSGDT S:$P(^(7),U,2)="" $P(^(7),U,2)="N" S PSGTOL=2,PSGUOW=DUZ,PSGTOO=1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOES",56,0)
 ; ward clerk label check 
"RTN","PSGOES",57,0)
 I PSJSYSL>0,$P(PSJSYSU,";",3)<3,"12"[$P(PSJSYSW0,"^",12),'(PSGOEAV) D
"RTN","PSGOES",58,0)
 .I PSGORD["P" S $P(^PS(53.1,$S($D(DA):DA,1:+PSGORD),7),U)=PSGDT S:$P(^(7),U,2)="" $P(^(7),U,2)="N"
"RTN","PSGOES",59,0)
 .I PSGORD'["P" S $P(^PS(55,PSGP,5,$S($D(DA):DA,1:+PSGORD),7),U)=PSGDT S:$P(^(7),U,2)="" $P(^(7),U,2)="N"
"RTN","PSGOES",60,0)
 .S PSGTOL=2,PSGUOW=DUZ,PSGTOO=2,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOES",61,0)
 Q
"RTN","PSGOESF")
0^84^B31588811
"RTN","PSGOESF",1,0)
PSGOESF ;BIR/MLM-SPEED FINISH ORDERS ENTERED THROUGH OE/RR ;10 Mar 98 / 2:35 PM
"RTN","PSGOESF",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,11,29,35,127,133,221,181**;16 DEC 97;Build 190
"RTN","PSGOESF",3,0)
 ;
"RTN","PSGOESF",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSGOESF",5,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192
"RTN","PSGOESF",6,0)
 ; Reference to ^PSSLOCK is supported by DBIA 2789
"RTN","PSGOESF",7,0)
 ;
"RTN","PSGOESF",8,0)
EN ;
"RTN","PSGOESF",9,0)
 I '$$HIDDEN^PSJLMUTL("SPEED") S VALMBCK="R" Q
"RTN","PSGOESF",10,0)
 ;PSJ*5*221 Account for pending orders being below pending renewals
"RTN","PSGOESF",11,0)
 N CODE,ST,DRG,ON,PSGONF,PSGONF2,PSGSFD,PENDCT
"RTN","PSGOESF",12,0)
 D FULL^VALM1 S PSGLMT=PSJOCNT,(PSGONF,PSGONF2,PENDCT)=0
"RTN","PSGOESF",13,0)
 S CODE="" F  S CODE=$O(^TMP("PSJ",$J,CODE)) Q:CODE=""  D
"RTN","PSGOESF",14,0)
 .S ST="" F  S ST=$O(^TMP("PSJ",$J,CODE,ST)) Q:ST=""  D
"RTN","PSGOESF",15,0)
 ..S DRG="" F  S DRG=$O(^TMP("PSJ",$J,CODE,ST,DRG)) Q:DRG=""  D
"RTN","PSGOESF",16,0)
 ...S ON="" F  S ON=$O(^TMP("PSJ",$J,CODE,ST,DRG,ON)) Q:ON=""  S PSGONF=PSGONF+1 D
"RTN","PSGOESF",17,0)
 ....I CODE="CC" S:$G(PSGONF2)=0 PSGONF2=PSGONF S PSGRLAST=PSGONF ;gets first renewal #
"RTN","PSGOESF",18,0)
 ....;PSJ*5*221 count pending orders to offset SF selection
"RTN","PSGOESF",19,0)
 ....I CODE="CB" S PENDCT=PENDCT+1
"RTN","PSGOESF",20,0)
 I PENDCT,$G(PSGRLAST) S PSGRLAST=PSGRLAST-PENDCT,PSGONF2=PSGONF2-PENDCT
"RTN","PSGOESF",21,0)
 I PSGONF2'>0 W !,"There are no orders which can be Speed Finished at this time.",!,"Only PENDING RENEWALS can be Speed Finished." D PAUSE^VALM1 Q
"RTN","PSGOESF",22,0)
 S PSGONF=PSGONF2_"^"_PSGRLAST
"RTN","PSGOESF",23,0)
 N DIR,L1,L2 S L1=+PSGONF,L2=$P(PSGONF,U,2),DIR(0)="LAO^"_L1_":"_L2,DIR("A")="FINISH which orders ("_L1_"-"_L2_"): ",DIR("?",1)="Select order"_$E("s",L1'=L2)_"to finish: ",DIR("??")="^D HELP^PSGOESF"
"RTN","PSGOESF",24,0)
 D ^DIR K DIR I $D(DIRUT) K X G DONE
"RTN","PSGOESF",25,0)
 I X?1N1"-" Q:$P(PSGONF,U,2)<X  S Y="" F L1=+X:1 S Y=Y_L1_"," Q:L1=$P(PSGONF,U,2)
"RTN","PSGOESF",26,0)
 I 'Y W $C(7),!!,"??" G EN
"RTN","PSGOESF",27,0)
ENCHK ;
"RTN","PSGOESF",28,0)
 S PSJSPEED=1
"RTN","PSGOESF",29,0)
 K PSGODDD S PSGODDD=1,PSGODDD(1)="" F Q=1:1:$L(Y,",") S X1=$P(Y,",",Q) D SET^PSGON Q:'$D(X)
"RTN","PSGOESF",30,0)
 S PSGOSD=0 F PSGOERS=1:1:PSGODDD F PSGOERS1=1:1 S PSGOERS2=$P(PSGODDD(PSGOERS),",",PSGOERS1) Q:'PSGOERS2  S Y=+^TMP("PSJON",$J,PSGOERS2),F=$G(^PS(53.1,Y,0)),D=$G(^(.2)) D HMSG^PSGOERS I F G EN
"RTN","PSGOESF",31,0)
 I $P(PSJSYSP0,"^",3) D  I '$D(PSGFOK) S X="" G DONE
"RTN","PSGOESF",32,0)
 .S PSGORD=^TMP("PSJON",$J,+PSGODDD(1)),PSGOFD=$P($G(^PS(53.1,+PSGORD,2)),U,4),DA=+PSGORD,DA(1)=PSGP,PSGSFD=$P($G(^PS(53.1,+PSGORD,0)),U,16)
"RTN","PSGOESF",33,0)
 .S PSGORD=$P(^PS(53.1,+PSGORD,0),U,25)
"RTN","PSGOESF",34,0)
 .S PSGWLL=$S($P(PSJSYSW0,"^",4):+$G(^PS(55,PSGP,5.1)),1:0),PSGOEE="R" W ! D DATE^PSGOER0(PSGP,PSGORD,PSGSFD)
"RTN","PSGOESF",35,0)
 .I '$D(PSGFOK(1)) W $C(7),!,"...order",$E("s",$L(PSGODDD(1),",")>2)," NOT finished..." K PSGFOK Q
"RTN","PSGOESF",36,0)
 .I 'PSGNEDFD,$P(PSJSYSW0,"^",4) D ENWALL^PSGNE3(PSGSD,PSGFD,PSGP)
"RTN","PSGOESF",37,0)
 W ! F PSGOERS=1:1:PSGODDD F PSGOERS1=1:1 S PSGOERS2=$P(PSGODDD(PSGOERS),",",PSGOERS1) Q:'PSGOERS2  S PSGORD=^TMP("PSJON",$J,PSGOERS2),PSGOEFF=0 D
"RTN","PSGOESF",38,0)
 .I '$$LS^PSSLOCK(PSGP,PSGORD) W !,"  ",PSGOERS2,". ",$P($$DRUGNAME^PSJLMUTL(PSGP,PSGORD),"^")," ",$P($G(^PS(53.1,+PSGORD,.2)),"^",2),!,"...No action taken on this order...",! H 1 Q
"RTN","PSGOESF",39,0)
 .;K PSGORQF D ENDDC^PSGSICHK(PSGP,+$G(^PS(53.1,+PSGORD,1,1,0)))
"RTN","PSGOESF",40,0)
 .;I '$D(PSGORQF) K PSGORQF,^TMP($J,"DI") D
"RTN","PSGOESF",41,0)
 .;. F PSGDDI=1:0 S PSGDDI=$O(^PS(53.1,+PSGORD,1,PSGDDI)) Q:'PSGDDI  S PSJDD=+$G(^PS(53.1,+PSGORD,1,PSGDDI,0)) D IVSOL^PSGSICHK
"RTN","PSGOESF",42,0)
 .S X=$G(^PS(53.1,+PSGORD,.2)),PSGPDRGN=$$ENPDN^PSGMI(+X),PSGDO=$P(X,U,2),X=$G(^PS(53.1,+PSGORD,0)),PSGMRN=$$ENMRN^PSGMI($P(X,U,3)),PSGST=$P(X,U,7)
"RTN","PSGOESF",43,0)
 .S PSGSCH=$P($G(^PS(53.1,+PSGORD,2)),U),PSGSI=$G(^(6))
"RTN","PSGOESF",44,0)
 .D OC531
"RTN","PSGOESF",45,0)
 .I 'PSGOEFF&($D(PSGORQF)) W !!,"  ",PSGOERS2,". ",$P($$DRUGNAME^PSJLMUTL(PSGP,PSGORD),"^")," ",$P($G(^PS(53.1,+PSGORD,.2)),"^",2),!,"...No action taken on this order...",! H 1 Q
"RTN","PSGOESF",46,0)
 .;S X=$G(^PS(53.1,+PSGORD,.2)),PSGPDRGN=$$ENPDN^PSGMI(+X),PSGDO=$P(X,U,2),X=$G(^PS(53.1,+PSGORD,0)),PSGMRN=$$ENMRN^PSGMI($P(X,U,3)),PSGST=$P(X,U,7)
"RTN","PSGOESF",47,0)
 .;S PSGSCH=$P($G(^PS(53.1,+PSGORD,2)),U),PSGSI=$G(^(6))
"RTN","PSGOESF",48,0)
 .S $P(^PS(53.1,+PSGORD,2),U,2)=PSGSD,$P(^(2),U,4)=PSGFD,X=+$P($G(^PS(53.1,+PSGORD,0)),U,25)
"RTN","PSGOESF",49,0)
 .I $P($G(^PS(55,PSGP,5,+X,2)),U,4)>PSGSD S $P(^(2),U,3)=$P(^(2),U,4) K DA,DIE,DR S DA(1)=PSGP,DA=X,DR="34////"_PSGSD,DIE="^PS(55,"_DA(1)_",5," D ^DIE
"RTN","PSGOESF",50,0)
 .W !!,"  ",PSGOERS2,". ",$P($$DRUGNAME^PSJLMUTL(PSGP,PSGORD),"^")," "
"RTN","PSGOESF",51,0)
 .W $P($G(^PS(53.1,+PSGORD,.2)),"^",2)
"RTN","PSGOESF",52,0)
 .D UPDATE
"RTN","PSGOESF",53,0)
 .D EN^PSGOEV(PSGORD)
"RTN","PSGOESF",54,0)
 .D UNL^PSSLOCK(PSGP,PSGORD)
"RTN","PSGOESF",55,0)
 ;
"RTN","PSGOESF",56,0)
DONE ; Kill and exit.
"RTN","PSGOESF",57,0)
 S DIR(0)="E" D ^DIR K DIR
"RTN","PSGOESF",58,0)
 I $G(PSGPXN) D ^PSGPER1
"RTN","PSGOESF",59,0)
 K PSJSPEED,PSGODDD,PSGOERS,PSGORD,PSGOERS2,PSGPDRGN,PSGDO,PSGSCH,PSGSI,NF,Y,PSGRLAST
"RTN","PSGOESF",60,0)
 Q
"RTN","PSGOESF",61,0)
HELP    ; Display help text for select order to be finished prompt."
"RTN","PSGOESF",62,0)
 W !!,"  Select the orders to be speed finished. Only orders listed under the PENDING",!,"RENEWALS heading are selectable. The start and stop date/times specified will"
"RTN","PSGOESF",63,0)
  W !,"be used for all orders selected to be finished using this function.",!
"RTN","PSGOESF",64,0)
 Q
"RTN","PSGOESF",65,0)
UPDATE        ;
"RTN","PSGOESF",66,0)
 N LOOP K ^PS(53.45,PSJSYSP,2)
"RTN","PSGOESF",67,0)
 F LOOP=0:0 S LOOP=$O(^PS(53.1,+PSGORD,1,LOOP)) Q:'LOOP  D
"RTN","PSGOESF",68,0)
 .S ^PS(53.45,PSJSYSP,2,LOOP,0)=^PS(53.1,+PSGORD,1,LOOP,0)
"RTN","PSGOESF",69,0)
 .S PSJJDRUG=$P(^PS(53.1,+PSGORD,1,LOOP,0),"^")
"RTN","PSGOESF",70,0)
 .S ^PS(53.45,PSJSYSP,2,"B",PSJJDRUG,LOOP)=""
"RTN","PSGOESF",71,0)
 .S ^PS(53.45,PSJSYSP,2,0)="^53.4502P"_"^"_LOOP_"^"_LOOP K PSJJDRUG
"RTN","PSGOESF",72,0)
 Q
"RTN","PSGOESF",73,0)
OC531 ;* Order checks for Speed finish and regular finish
"RTN","PSGOESF",74,0)
 ;PSJOCDS("ON_TYPE") - Order type of either "UD" or "IV"
"RTN","PSGOESF",75,0)
 ;PSJOCDS - 0/1 (O - will exclude dose check.  1 - include the dose check for the prospective)
"RTN","PSGOESF",76,0)
 N INTERVEN,PSJDDI,PSJIREQ,PSJRXREQ,PSJPDRG,PSJDD,PSJALLGY,PSJOCDS,PSJX,PSGDT,%
"RTN","PSGOESF",77,0)
 D NOW^%DTC S PSGDT=%
"RTN","PSGOESF",78,0)
 S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)=""
"RTN","PSGOESF",79,0)
 ;K PSGORQF D ENDDC^PSGSICHK(PSGP,+$G(^PS(53.1,+PSGORD,1,1,0)))
"RTN","PSGOESF",80,0)
 ;I '$D(PSGORQF) K PSGORQF,^TMP($J,"DI") D
"RTN","PSGOESF",81,0)
 ;. F PSGDDI=1:0 S PSGDDI=$O(^PS(53.1,+PSGORD,1,PSGDDI)) Q:'PSGDDI  S PSJDD=+$G(^PS(53.1,+PSGORD,1,PSGDDI,0)) K PSJPDRG D IVSOL^PSGSICHK
"RTN","PSGOESF",82,0)
 I $G(PSJSPEED) D
"RTN","PSGOESF",83,0)
 . F PSGDDI=0:0 S PSGDDI=$O(^PS(53.1,+PSGORD,1,PSGDDI)) Q:'PSGDDI  D
"RTN","PSGOESF",84,0)
 .. S PSJDD=+$G(^PS(53.1,+PSGORD,1,PSGDDI,0))
"RTN","PSGOESF",85,0)
 .. S PSJX=$S('$D(^PSDRUG(+PSJDD,0)):1,$P($G(^(2)),U,3)'["U":1,$G(^("I"))="":0,1:^("I")'>$G(PSGDT))
"RTN","PSGOESF",86,0)
 .. Q:PSJX
"RTN","PSGOESF",87,0)
 .. S PSJALLGY(PSJDD)=""
"RTN","PSGOESF",88,0)
 I '+$G(PSJSPEED) S PSJDD=$$DD53P45^PSJMISC()
"RTN","PSGOESF",89,0)
 S PSJDD=$O(PSJALLGY(0)) Q:'+PSJDD
"RTN","PSGOESF",90,0)
 K PSGORQF D ENDDC^PSGSICHK(PSGP,PSJDD)
"RTN","PSGOESF",91,0)
 ;Only do dosing check for speed finish. Regular finish will do dosing check at ENCKDD^PSGOEF1
"RTN","PSGOESF",92,0)
 I '+$G(PSJSPEED),$G(PSGOEFF) Q
"RTN","PSGOESF",93,0)
 ;For some reasons PSGMR is not define when SF a UD order
"RTN","PSGOESF",94,0)
 ;If user was not required to enter a DD (order was able to default a DD), need to get dosing check
"RTN","PSGOESF",95,0)
 NEW PSGMR I ($G(PSGORD)["P") S PSGMR=$P($G(^PS(53.1,+PSGORD,0)),U,3)
"RTN","PSGOESF",96,0)
 D:'$G(PSGORQF) IN^PSJOCDS($G(PSGORD),"UD",+PSJDD)
"RTN","PSGOESF",97,0)
 Q
"RTN","PSGOU")
0^23^B31799973
"RTN","PSGOU",1,0)
PSGOU ;BIR/CML3,MV-PROFILE UTILITIES ;19 SEP 96 / 3:59 PM
"RTN","PSGOU",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**34,110,181**;16 DEC 97;Build 190
"RTN","PSGOU",3,0)
 ;
"RTN","PSGOU",4,0)
 ; Reference to ^PS(51.1 is supported by DBIA# 2177
"RTN","PSGOU",5,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGOU",6,0)
 ;
"RTN","PSGOU",7,0)
ECHK ;
"RTN","PSGOU",8,0)
 D NOW^%DTC N PSGDT S PSGDT=% ;***Store PSGDT with seconds.
"RTN","PSGOU",9,0)
 S C="A",ON=O_"U" G:SD>PSGDT DS S ND=$G(^PS(55,PSGP,5,O,0)) G:$S($P(ND,"^",9)="":1,1:"DE"'[$P(ND,"^",9)) DS S ND4=$G(^(4))
"RTN","PSGOU",10,0)
 I ST'="O",SD'<PSGODT,$P(ND,"^",9)="E",$P(ND4,"^",16) G DS
"RTN","PSGOU",11,0)
 I ST="O",$P(ND,"^",9)'["D",$S('$P(ND4,"^",UDU):1,SD<PSGODT:0,1:$P(ND4,"^",16)) G DS
"RTN","PSGOU",12,0)
 I PSGOL="S",(SD>$P($G(PSJDCEXP),U,2)) S C="DF" G DS
"RTN","PSGOU",13,0)
 Q:PSGOL="S"  S C="O"
"RTN","PSGOU",14,0)
 ;
"RTN","PSGOU",15,0)
DS ;
"RTN","PSGOU",16,0)
 NEW DRUGNAME D DRGDISP^PSJLMUT1(PSGP,+O_"U",80,0,.DRUGNAME,1) S DRG=DRUGNAME(1)
"RTN","PSGOU",17,0)
 ;
"RTN","PSGOU",18,0)
SET ;
"RTN","PSGOU",19,0)
 I ON["P",$G(P("PRNTON"))]"",$G(PRNTON)=+P("PRNTON") Q
"RTN","PSGOU",20,0)
 I ON["P",$G(P("PRNTON"))]"" S PRNTON=+P("PRNTON"),ON=+P("PRNTON")
"RTN","PSGOU",21,0)
 S ^TMP("PSG",$J,C,ST,DRG_"^"_ON)=$G(NF)
"RTN","PSGOU",22,0)
 Q
"RTN","PSGOU",23,0)
 ;
"RTN","PSGOU",24,0)
ENS F S=0:0 R !!,"Sort by DATE or MEDICATION:  M// ",PSGOS:DTIME D SCHK Q:CHK
"RTN","PSGOU",25,0)
 Q
"RTN","PSGOU",26,0)
 ;
"RTN","PSGOU",27,0)
ENL ;
"RTN","PSGOU",28,0)
 F  W !!,"SHORT, LONG, or NO Profile?  ",$S('$D(PSJPDD):"SHORT",'PSJPDD:"SHORT",1:"LONG"),"// " R PSGOL:DTIME W:'$T $C(7) S:'$T PSGOL="^" Q:PSGOL="^"  D LCHK Q:"^SLN"[PSGOL&($L(PSGOL)=1)
"RTN","PSGOU",29,0)
 Q
"RTN","PSGOU",30,0)
 ;
"RTN","PSGOU",31,0)
SCHK ;
"RTN","PSGOU",32,0)
 I '$T!(PSGOS["^") S PSGOS="^",CHK=1 Q
"RTN","PSGOU",33,0)
 S CHK=0 D:PSGOS["?" SM Q:PSGOS["?"  I PSGOS="" S PSGOS="M",CHK=1 W "MEDICATION" Q
"RTN","PSGOU",34,0)
 F X="DATE","MEDICATION" I $P(X,PSGOS)="" W $P(X,PSGOS,2) S PSGOS=$E(PSGOS),CHK=1 Q
"RTN","PSGOU",35,0)
 W:'CHK $C(7),"  ??" Q
"RTN","PSGOU",36,0)
 ;
"RTN","PSGOU",37,0)
SM W !!?3,"Enter 'MEDICATION' (or 'M', or press the RETURN key to have this patient's   orders shown alphabetically by drug name.  Enter 'DATE' (or 'D') to have this   patient's orders shown by start date (the newest orders showing first)."
"RTN","PSGOU",38,0)
 W "  Enter  a '^' to not show this patient's orders." Q
"RTN","PSGOU",39,0)
 ;
"RTN","PSGOU",40,0)
LCHK ;
"RTN","PSGOU",41,0)
 I PSGOL?1."?" D LM Q
"RTN","PSGOU",42,0)
 I PSGOL="" S PSGOL=$S('$D(PSJPDD):"S",'PSJPDD:"S",1:"L") W $S('$D(PSJPDD):"  SHORT",'PSJPDD:"  SHORT",1:"  LONG") Q
"RTN","PSGOU",43,0)
 I PSGOL?.E1L.E F Q=1:1:$L(PSGOL) I $E(PSGOL,Q)?1L S PSGOL=$E(PSGOL,1,Q-1)_$C($A(PSGOL,Q)-32)_$E(PSGOL,Q+1,$L(PSGOL))
"RTN","PSGOU",44,0)
 F X="NO PROFILE","LONG","SHORT" I $P(X,PSGOL)="" W $P(X,PSGOL,2) S PSGOL=$E(PSGOL) Q
"RTN","PSGOU",45,0)
 W:'$T $C(7),"  ??" Q
"RTN","PSGOU",46,0)
 ;
"RTN","PSGOU",47,0)
LM W !!?3,"Enter 'SHORT' (or 'S', or press the RETURN key) to exclude this patient's",!,"discontinued and expired orders in the following profile.  Enter 'LONG' (or 'L') to include those orders."
"RTN","PSGOU",48,0)
 W "  Enter 'NO' (or 'N') to bypass the profile com-",!,"pletely.  Enter '^' if you wish to go no further with this patient." Q
"RTN","PSGOU",49,0)
 ;
"RTN","PSGOU",50,0)
ENU ; update status field to reflect expired orders, if necessary
"RTN","PSGOU",51,0)
 W !!,"...a few moments, I have some updating to do..."
"RTN","PSGOU",52,0)
ENUNM ;
"RTN","PSGOU",53,0)
 D NOW^%DTC S PSGDT=%
"RTN","PSGOU",54,0)
 S PSJDCEXP=$$RECDCEXP^PSJP()
"RTN","PSGOU",55,0)
 F PSGO2=+PSJPAD:0 S PSGO2=$O(^PS(55,PSGP,5,"AUS",PSGO2)) Q:'PSGO2  Q:PSGO2>PSGDT  F PSGO3=0:0 S PSGO3=$O(^PS(55,PSGP,5,"AUS",PSGO2,PSGO3)) Q:'PSGO3  S PSGO4=$G(^PS(55,PSGP,5,PSGO3,0)) D
"RTN","PSGOU",56,0)
 .I PSGO4]"",$S($E($G(PSGALO),1,2)="10":"AHR"[$E($P(PSGO4,"^",9)),1:"AR"[$E($P(PSGO4,"^",9))) D ENUH
"RTN","PSGOU",57,0)
 K PSGO1,PSGO2,PSGO3,PSGO4,UD Q
"RTN","PSGOU",58,0)
 ;
"RTN","PSGOU",59,0)
ENGORD ; get and sort orders
"RTN","PSGOU",60,0)
 D NOW^%DTC S PSGDT=%,X1=$P(%,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1),HDT=$$ENDTC^PSGMI(PSGDT),UDU=$S($P(PSJSYSU,";",3)>1:3,1:1) K ^TMP("PSG",$J)
"RTN","PSGOU",61,0)
 W:'$D(PSGPR) !!,"...a few moments, please..." D ENUNM
"RTN","PSGOU",62,0)
 F ST="C","O","OC","P","R" F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD  F O=0:0 S O=$O(^PS(55,PSGP,5,"AU",ST,SD,O)) Q:'O  D ECHK
"RTN","PSGOU",63,0)
 Q:$D(PSGONNV)
"RTN","PSGOU",64,0)
 NEW DRUGNAME
"RTN","PSGOU",65,0)
 N PRNTON F SD="I","N" S (PRNTON,O)=0 F  S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=+O_"P",ND=$G(^PS(53.1,O,0)) I $P(ND,"^",4)="U" D
"RTN","PSGOU",66,0)
 . S ST=$P(ND,"^",7),P("PRNTON")=$P($G(^PS(53.1,O,.2)),"^",8) S:ST="" ST="z"
"RTN","PSGOU",67,0)
 . D DRGDISP^PSJLMUT1(PSGP,+O_"P",80,0,.DRUGNAME,1) S DRG=DRUGNAME(1)
"RTN","PSGOU",68,0)
 . S C=$S(P("PRNTON")]"":"BD",1:"BA") D SET
"RTN","PSGOU",69,0)
 Q:+PSJSYSU'=3  S SD="P",O=0
"RTN","PSGOU",70,0)
 N PRNTON F  S (PRNTON,O)=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=+O_"P",ND=$G(^PS(53.1,O,0)) I $P(ND,"^",4)="U" D
"RTN","PSGOU",71,0)
 . S ST=$P(ND,"^",7),P("PRNTON")=$P($G(^PS(53.1,O,.2)),"^",8) S:ST="" ST="z"
"RTN","PSGOU",72,0)
 . D DRGDISP^PSJLMUT1(PSGP,+O_"P",80,0,.DRUGNAME,1) S DRG=DRUGNAME(1)
"RTN","PSGOU",73,0)
 . S C=$$CKPC^PSGOU(PSGP,$P(ND,U,25),O)
"RTN","PSGOU",74,0)
 . I C="CB",$P($G(^PS(53.1,O,.2)),U,4)="S" S C="CA"
"RTN","PSGOU",75,0)
 . I P("PRNTON")]"" S C="CD"
"RTN","PSGOU",76,0)
 . D SET
"RTN","PSGOU",77,0)
 Q
"RTN","PSGOU",78,0)
 ;
"RTN","PSGOU",79,0)
MAE ; change status to expired
"RTN","PSGOU",80,0)
ENUH ;
"RTN","PSGOU",81,0)
 S $P(^PS(55,PSGP,5,PSGO3,0),"^",9)="E",ORIFN=$P(PSGO4,"^",21) I ORIFN D EN1^PSJHL2(PSGP,"SC",PSGO3_"U")
"RTN","PSGOU",82,0)
 Q
"RTN","PSGOU",83,0)
 ;
"RTN","PSGOU",84,0)
CKPC(DFN,OLDON,NEWON) ; Compare old provider comments to new for speed finish.
"RTN","PSGOU",85,0)
 N X,Y,Q,QQ,PSGOEEWF,PSJFLAG
"RTN","PSGOU",86,0)
 I $P($G(^PS(53.1,+NEWON,0)),U,24)'="R" Q "CB"
"RTN","PSGOU",87,0)
 S PSJFLAG=0,PSGOEEWF="^PS(55,"_DFN_","_$S(OLDON["V":"""IV""",1:5)_","_+OLDON_","
"RTN","PSGOU",88,0)
 S (Q,QQ)=0 F  S Q=$O(^PS(53.1,NEWON,12,Q)) Q:'Q  S QQ=Q,X=$G(^(Q,0)),Y=$G(@(PSGOEEWF_"12,"_Q_",0)")) I X'=Y S PSJFLAG=1 Q
"RTN","PSGOU",89,0)
 I PSJFLAG!$O(@(PSGOEEWF_"12,"_QQ_")")) Q "CB"
"RTN","PSGOU",90,0)
 S (Q,QQ)=0 F  S Q=$O(@(PSGOEEWF_"12,"_Q_")")) Q:'Q  S QQ=Q,X=$G(^(Q,0)),Y=$G(^PS(53.1,NEWON,12,Q,0)) I X'=Y S PSJFLAG=1 Q
"RTN","PSGOU",91,0)
 I PSJFLAG!$O(^PS(53.1,+NEWON,12,QQ)) Q "CB"
"RTN","PSGOU",92,0)
 Q "CC"
"RTN","PSGOU",93,0)
 ;
"RTN","PSGOU",94,0)
ENRNAT(OWD,NWD,SC,OAT) ; Determine admin times for renewal orders.
"RTN","PSGOU",95,0)
 ;OWD=ORIGINAL W, NWD=NEW WD LOCATION, SC=SCHEDULE, OAT=ORDER ADMIN TIMES
"RTN","PSGOU",96,0)
 N OWAT,SCP,X,Y
"RTN","PSGOU",97,0)
 S OOAT=OAT,SCP=+$O(^PS(51.1,"APPSJ",+SC,0)),WAT=$P($G(^PS(51.1,SCP,1,+$G(OWD),0)),U,2)
"RTN","PSGOU",98,0)
 F X="WAT","OAT" F Y=1:1 Q:$L(@X)>240!($P(@X,"-",Y)="")  S $P(@X,"-",Y)=$P(@X,"-",Y)_$E("0000",1,4-$L($P(@X,"-",Y)))
"RTN","PSGOU",99,0)
 I OAT'=WAT Q OOAT
"RTN","PSGOU",100,0)
 S X=$P($G(^PS(51.1,+SCP,1,NWD,0)),U,2) I X Q X
"RTN","PSGOU",101,0)
 Q OOAT
"RTN","PSGP")
0^16^B11885377
"RTN","PSGP",1,0)
PSGP ;BIR/CML3-PATIENT LOOK-UP ;15 Apr 98 / 9:05 AM
"RTN","PSGP",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**10,53,111,181**;16 DEC 97;Build 190
"RTN","PSGP",3,0)
 ;
"RTN","PSGP",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGP",5,0)
 ; Reference to ^SDAMA203 is supported by DBIA 4133.
"RTN","PSGP",6,0)
 ;
"RTN","PSGP",7,0)
ENDPT ; get any patient
"RTN","PSGP",8,0)
 N HIT
"RTN","PSGP",9,0)
 K DIC,PSGP,Y W !!,"Select "_$S($D(PSGDICA):PSGDICA_" ",1:"")_"PATIENT: " R X:DTIME S:X["^" PSJSTOP=1 I "^"[X S (Y,PSGP)=-1 G DONE
"RTN","PSGP",10,0)
 D EN^PSJDPT
"RTN","PSGP",11,0)
 I Y'>0 G ENDPT
"RTN","PSGP",12,0)
 K DIC
"RTN","PSGP",13,0)
 ;
"RTN","PSGP",14,0)
CHK ;
"RTN","PSGP",15,0)
 ;Clean up arrays use in order checks
"RTN","PSGP",16,0)
 K PSJEXCPT,PSJOCER
"RTN","PSGP",17,0)
 S (DFN,PSGP)=+Y,VA200=1 D INP^VADPT
"RTN","PSGP",18,0)
 I VAIN(4) S PSJPCAF=1_"^"_VAIN(1),PSJPWD=+VAIN(4),PSJPWDN=$P(VAIN(4),"^",2),PSJPTS=+VAIN(3),PSJPTSP=+VAIN(2),PSJPRB=VAIN(5),PSJPAD=+VAIN(7),PSJPDX=VAIN(9),PSJPTD=$P($G(^PS(55,PSGP,5.1)),"^",4),PSJPDD="" G CNV
"RTN","PSGP",19,0)
 S PSJPCAF="",VAIP("D")="L" D IN5^VADPT I 'VAIP(13,1) W $C(7),!!?3,"PATIENT HAS NEVER BEEN ADMITTED." D COP I 'HIT G ENDPT
"RTN","PSGP",20,0)
 S PSJPAD=VAIP(13,1),PSGID=+VAIP(3),X=+VAIP(4)=12!(+VAIP(4)=38),PSGOD=$$ENDTC^PSGMI(PSGID) W $C(7),!!?3,"PATIENT IS FOUND TO BE D",$P("ISCHARG^ECEAS","^",X+1),"ED AS OF ",PSGOD,"." D COP I 'HIT G:'$D(PSGRETF) ENDPT
"RTN","PSGP",21,0)
 S PSJPAD=VAIP(13,1),PSJPWD=+VAIP(5),PSJPWDN=$P(VAIP(5),"^",2),PSJPRB=$P(VAIP(6),"^",2),PSJPTSP=+VAIP(7),PSJPTS=+VAIP(8),PSJPDX=VAIP(9),PSJPTD="",PSJPDD=PSGID_"^"_PSGOD S:X PSJPDD=PSJPDD_"^1"
"RTN","PSGP",22,0)
 ;
"RTN","PSGP",23,0)
CNV ;
"RTN","PSGP",24,0)
 D DEM^VADPT,PID^VADPT,HTWT^PSJAC(DFN)
"RTN","PSGP",25,0)
 S PSGP(0)=VADM(1),PSJPSSN=VADM(2),PSJPDOB=+VADM(3),PSJPAGE=VADM(4),PSJPSEX=$S(VADM(5)]"":VADM(5),1:"?^____"),PSJPPID=VA("PID"),PSJPBID=VA("BID")
"RTN","PSGP",26,0)
 F X="PSJPAD","PSJPDOB","PSJPTD" I +@X S $P(@X,"^",2)=$$ENDTC^PSGMI(+@X)
"RTN","PSGP",27,0)
 ;
"RTN","PSGP",28,0)
WP ; ward parameters
"RTN","PSGP",29,0)
 S PSJSYSW0="",PSJSYSW=0 I PSJPWD S PSJSYSW=+$O(^PS(59.6,"B",PSJPWD,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSGP",30,0)
 ;S PSJSYSL="",X=$P(PSJSYSU,";",3)>1,PSJSYSL=$P(PSJSYSW0,"^",X*4+12)
"RTN","PSGP",31,0)
 S PSJSYSL="",X=$P(PSJSYSU,";",3)>1,PSJSYSL=$S(X=0:$P(PSJSYSW0,"^",12),1:$P(PSJSYSW0,"^",16))
"RTN","PSGP",32,0)
 S PSJDCEXP=$$RECDCEXP^PSJP()
"RTN","PSGP",33,0)
 I PSJSYSL D
"RTN","PSGP",34,0)
 .S:X X='$P(PSJSYSP0,"^",10) S IOP=$S($P(PSJSYSP0,"^",13)]"":$P(PSJSYSP0,"^",13),$P(PSJSYSW0,"^",19+X)]"":$P(PSJSYSW0,"^",19+X),1:"") I IOP]"" D
"RTN","PSGP",35,0)
 ..S IOP="`"_IOP K %ZIS S %ZIS="NQ" D ^%ZIS S:'POP $P(PSJSYSL,"^",2,3)=ION_"^"_IO D ^%ZISC
"RTN","PSGP",36,0)
 ;
"RTN","PSGP",37,0)
DONE ;
"RTN","PSGP",38,0)
 K DA,DIC,NB,ND,NS,PSGID,PSGOD,VA200,VADM,VAIN,VAIP,VAMT,X,Y(0),Y(0,0) Q
"RTN","PSGP",39,0)
 ;
"RTN","PSGP",40,0)
COP ;check for appointments in clinics that allowed inpatient orders
"RTN","PSGP",41,0)
 S HIT=0 Q:'$$PATCH^XPDUTL("SD*5.3*285")
"RTN","PSGP",42,0)
 N SQ,A,VAIP,X,PSJF
"RTN","PSGP",43,0)
 D IN5^VADPT
"RTN","PSGP",44,0)
 D NOW^%DTC S (PSJF,VASD("F"))=$P(%,".")-1
"RTN","PSGP",45,0)
 D SDA^VADPT
"RTN","PSGP",46,0)
 S SQ=0 F  S SQ=$O(^UTILITY("VASD",$J,SQ)) Q:'SQ  S A=^(SQ,"I") I $$SDIMO^SDAMA203($P(A,"^",2),DFN)>0 S HIT=1 Q
"RTN","PSGP",47,0)
 I $O(^PS(55,DFN,5,"AUN",PSJF))!($O(^PS(55,DFN,"IV","AIN",PSJF))) S HIT=1
"RTN","PSGP",48,0)
 Q 
"RTN","PSGSETU")
0^92^B13243102
"RTN","PSGSETU",1,0)
PSGSETU ;BIR/CML3-PACKAGE UTILITIES ;10 Mar 99 / 10:53 AM
"RTN","PSGSETU",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,11,26,39,58,115,133,181**;16 DEC 97;Build 190
"RTN","PSGSETU",3,0)
 ;
"RTN","PSGSETU",4,0)
 ; Reference to TERM^VALM0 is supported by DBIA #2615.
"RTN","PSGSETU",5,0)
 ; Reference to $$BROKER^XWBLIB is supported by DBIA #2198.
"RTN","PSGSETU",6,0)
 ;
"RTN","PSGSETU",7,0)
ENIVKV ; kill IV variables
"RTN","PSGSETU",8,0)
 K CHK,PSIVPL,PSIVPR,PSIVSITE,PSIVSN,PSIVBR,PSIVENO
"RTN","PSGSETU",9,0)
 ;
"RTN","PSGSETU",10,0)
ENKV ; when exiting package
"RTN","PSGSETU",11,0)
 K PSGP,PSJPAD,PSJPAGE,PSJPBID,PSJPCAF,PSJPDD,PSJPDOB,PSJPDX,PSJPFWD,PSJPHT,PSJPHTD,PSJPPID,PSJPPR,PSJPRB,PSJPSEX,PSJPSSN,PSJPTD,PSJPTS,PSJPTSP,PSJPWD,PSJPWDN,PSJPWT,PSJPWTD,PSJDCEXP
"RTN","PSGSETU",12,0)
 I '$D(PSJNKF) K DFN,VA,VADM,VAERR,VAIN,VAIP
"RTN","PSGSETU",13,0)
 K PSJNKF,%,%DT,%H,%I,%T,%X,%Y,%ZIS,D,D0,D1,D2,DA,DI,DIC,DICR,DIE,DIG,DIH,DIK,DIR,DIRUT,DIQ,DISYS,DIU,DIV,DIW,DLAYGO,DP,DR,DQ,DTOUT,DUOUT,DZ,IO("Q"),IOP,POP,X,X1,X2,Y,XX,ZTSK
"RTN","PSGSETU",14,0)
 K PSGDT,PSGID,PSGION,PSGOD,Q,QQ,PSJSYSL,PSJSYSW0,PSJSYSW,PSJSYSP,PSJSYSP0,PSJSYSU,PSJOCNT,PSJRNF,PSJIRNF,PSJITECH,PSGPXDEV,PSGDDI,PSJORPVN,PSJPN
"RTN","PSGSETU",15,0)
 Q
"RTN","PSGSETU",16,0)
 ;
"RTN","PSGSETU",17,0)
ENCV ; check for (and set) package variables
"RTN","PSGSETU",18,0)
 K %DT,%ZIS,DIC,IOP D ^%ZISC,HOME^%ZIS
"RTN","PSGSETU",19,0)
 I '$D(ZTQUEUED),'$D(VALMWD) D
"RTN","PSGSETU",20,0)
 .S X="XWBLIB" X ^%ZOSF("TEST") I $T,($$BROKER^XWBLIB) Q
"RTN","PSGSETU",21,0)
 .D TERM^VALM0
"RTN","PSGSETU",22,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12)
"RTN","PSGSETU",23,0)
 I $D(^TMP("PSJUSER",$J,"PSG",0)),$D(^(1)),$D(PSJSYSU) D  K %,%H,%I,X Q
"RTN","PSGSETU",24,0)
 .; naked ref below is from line above
"RTN","PSGSETU",25,0)
 .S %=^(0),PSJSYSU=$P(%,"^"),PSJSYSP=$P(%,"^",2),PSJSYSP0=^(1),PSJSYSL=$P(PSJSYSP0,"^",7)]""_"^"_$P(PSJSYSP0,"^",7),%=$G(^VA(200,DUZ,"PS")),$P(PSJSYSU,";",2)=$S('%:"",'$P(%,"^",4):1,1:$P(%,"^",4)\1>DT)
"RTN","PSGSETU",26,0)
 .I 'PSJSYSL,$G(PSJSYSW0) D SYSL
"RTN","PSGSETU",27,0)
 S PSJSYSU="",%=$G(^VA(200,DUZ,"PS")) I %,$S('$P(%,"^",4):1,1:$P(%,"^",4)>DT) S $P(PSJSYSU,";",2)=1
"RTN","PSGSETU",28,0)
 I $D(^XUSEC("PSJ RNURSE",DUZ)) D
"RTN","PSGSETU",29,0)
 .S:$D(^XUSEC("PSJ RNFINISH",DUZ)) PSJRNF=1
"RTN","PSGSETU",30,0)
 .S:$D(^XUSEC("PSJI RNFINISH",DUZ)) PSJIRNF=1
"RTN","PSGSETU",31,0)
 S:$D(^XUSEC("PSJI PHARM TECH",DUZ)) PSJITECH=1
"RTN","PSGSETU",32,0)
 S DIC="^PS(53.45,",DIC(0)="LNZ",DLAYGO=53.45,(DINUM,X)="`"_+DUZ D ^DIC
"RTN","PSGSETU",33,0)
 S PSJSYSP=+Y,PSJSYSP0=Y(0) F X=3,1,2 I $D(^XUSEC("PSJ "_$P("RNURSE^PHARM TECH^RPHARM","^",X),DUZ)) S $P(PSJSYSU,";",3)=X Q
"RTN","PSGSETU",34,0)
 I $P(PSJSYSU,";",3),"13"[$P(PSJSYSU,";",3) S $P(PSJSYSU,";")=$P(PSJSYSU,";",3)
"RTN","PSGSETU",35,0)
 S $P(PSJSYSU,";",4)=+PSJSYSU=3!$P(PSJSYSP0,"^",2)!$D(^XUSEC("PSJ RNFINISH",DUZ)),PSJSYSL=$P(PSJSYSP0,"^",7)]""_"^"_$P(PSJSYSP0,"^",7)
"RTN","PSGSETU",36,0)
 I 'PSJSYSL,$G(PSJSYSW0) D SYSL
"RTN","PSGSETU",37,0)
 I PSJSYSU S $P(PSJSYSP0,"^",3)=1,$P(PSJSYSP0,"^",4)=1,$P(PSJSYSP0,"^",5)=1
"RTN","PSGSETU",38,0)
 S ^TMP("PSJUSER",$J,"PSG",0)=PSJSYSU_"^"_PSJSYSP,^(1)=PSJSYSP0 K %,%H,%I,DA,DIC,DLAYGO,X,Y Q
"RTN","PSGSETU",39,0)
 ;
"RTN","PSGSETU",40,0)
ENDTC(Y) ; convert FM internal date/time to user readable format
"RTN","PSGSETU",41,0)
 I Y S Y=Y_$E(".",Y'[".")_"0000",Y=$E(Y,4,5)_"/"_$E(Y,6,7)_"/"_$E(Y,2,3)_"  "_$E(Y,9,10)_":"_$E(Y,11,12)
"RTN","PSGSETU",42,0)
 E  S Y="********"
"RTN","PSGSETU",43,0)
 Q Y
"RTN","PSGSETU",44,0)
 ;
"RTN","PSGSETU",45,0)
SYSL ;
"RTN","PSGSETU",46,0)
 Q:$G(PSJSYSL)!'$G(PSJSYSW0)
"RTN","PSGSETU",47,0)
 S X=$P($G(PSJSYSU),";",3)>1 S PSJSYSL=$S(X=0:$P(PSJSYSW0,"^",12),1:$P(PSJSYSW0,"^",16)) I PSJSYSL D
"RTN","PSGSETU",48,0)
 .S:X X='$P(PSJSYSP0,"^",10) S IOP=$S($P(PSJSYSP0,"^",13)]"":$P(PSJSYSP0,"^",13),$P(PSJSYSW0,"^",19+X)]"":$P(PSJSYSW0,"^",19+X),1:"") I IOP]"" D
"RTN","PSGSETU",49,0)
 ..S IOP="`"_IOP K %ZIS S %ZIS="NQ" D ^%ZIS S:'POP $P(PSJSYSL,"^",2,3)=ION_"^"_IO D HOME^%ZIS
"RTN","PSGSETU",50,0)
 Q
"RTN","PSGSICHK")
0^29^B80627011
"RTN","PSGSICHK",1,0)
PSGSICHK ;BIR/CML3-CHECKS SPECIAL INSTRUCTIONS ;17 Aug 98 / 8:33 AM
"RTN","PSGSICHK",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,9,26,29,44,49,59,110,139,146,160,175,201,185,181**;16 DEC 97;Build 190
"RTN","PSGSICHK",3,0)
 ;
"RTN","PSGSICHK",4,0)
 ; Reference to ^PS(50.605 is supported by DBIA 696.
"RTN","PSGSICHK",5,0)
 ; Reference to EN^PSOORDRG is supported by DBIA 2190.
"RTN","PSGSICHK",6,0)
 ; Reference to ^PSI(58.1 is supported by DBIA 2284.
"RTN","PSGSICHK",7,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSGSICHK",8,0)
 ; Reference to ^PSD(58.8 is supported by DBIA 2283.
"RTN","PSGSICHK",9,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGSICHK",10,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSGSICHK",11,0)
 ; Reference to ^PS(51 is supported by DBIA 2176.
"RTN","PSGSICHK",12,0)
 ; Reference to ^ORRDI1 is supported by DBIA 4659.
"RTN","PSGSICHK",13,0)
 ; Reference to ^XTMP("ORRDI" is supported by DBIA 4660.
"RTN","PSGSICHK",14,0)
 ; Reference to GETDATA^GMRAOR supported by DBIA 4847.
"RTN","PSGSICHK",15,0)
 ; Reference to ^TMP("GMRAOC" supported by DBIA 4848.
"RTN","PSGSICHK",16,0)
 ;
"RTN","PSGSICHK",17,0)
START ;
"RTN","PSGSICHK",18,0)
 I $S(X'?.ANP:1,X["^":1,1:$L(X)>180) K X Q
"RTN","PSGSICHK",19,0)
 S Y="" F Y(1)=1:1:$L(X," ") S Y(2)=$P(X," ",Y(1)) I Y(2)]"" D CHK Q:'$D(X)
"RTN","PSGSICHK",20,0)
 I $D(X),Y]"",X'=$E(Y,1,$L(Y)-1) D EN^DDIOL("EXPANDS TO: ") W Y F Y(1)=1:1 S Y(2)=$P(Y," ",Y(1)) Q:Y(2)=""  D:$L(Y(2))+$X>78 EN^DDIOL(Y(2)_" ")
"RTN","PSGSICHK",21,0)
 Q
"RTN","PSGSICHK",22,0)
 ;
"RTN","PSGSICHK",23,0)
CHK ;
"RTN","PSGSICHK",24,0)
 I $L(Y(2))<31,$D(^PS(51,+$O(^PS(51,"B",Y(2),0)),0)),$P(^(0),"^",2)]"",$P(^(0),"^",4) S Y(2)=$P(^(0),"^",2)
"RTN","PSGSICHK",25,0)
 I $L(Y)+$L(Y(2))>180 K X Q
"RTN","PSGSICHK",26,0)
 S Y=Y_Y(2)_" " Q
"RTN","PSGSICHK",27,0)
 ;
"RTN","PSGSICHK",28,0)
ENSET(X) ; expands the SPECIAL INSTRUCTIONS field contained in X into Y
"RTN","PSGSICHK",29,0)
 N X1,X2,Y S Y=""
"RTN","PSGSICHK",30,0)
 ;BHW;PSJ*5*185;Modified Logic below to NOT strip spaces and allow existing logic to flow.
"RTN","PSGSICHK",31,0)
 ;             ;Removed code I X2]"" Before Set of Y and created argumentless DO structure.
"RTN","PSGSICHK",32,0)
 F X1=1:1:$L(X," ") S X2=$P(X," ",X1) D
"RTN","PSGSICHK",33,0)
 . I X2']"" S Y=Y_" " Q  ;if multiple spaces in text and were $P'ing through text, X2 will="" so just add space and continue
"RTN","PSGSICHK",34,0)
 . S Y=Y_$S($L(X2)>30:X2,'$D(^PS(51,+$O(^PS(51,"B",X2,0)),0)):X2,$P(^(0),"^",2)]""&$P(^(0),"^",4):$P(^(0),"^",2),1:X2)_" "
"RTN","PSGSICHK",35,0)
 . Q
"RTN","PSGSICHK",36,0)
 ;BHW;Modified stripping of spaces at end of string
"RTN","PSGSICHK",37,0)
 F X1=$L(Y):-1:0 Q:$E(Y,X1,X1)'=" "  S Y=$E(Y,1,X1-1)
"RTN","PSGSICHK",38,0)
 Q Y
"RTN","PSGSICHK",39,0)
 ;
"RTN","PSGSICHK",40,0)
END ; used by DRUG (55.06,101 & 53.1,101) x-refs to warn user if patient is receiving or about to receive the drug just ordered
"RTN","PSGSICHK",41,0)
 Q:$D(PSJHLSKP)
"RTN","PSGSICHK",42,0)
 ;
"RTN","PSGSICHK",43,0)
 ;***This module is no longer used after PSJ*5*181***
"RTN","PSGSICHK",44,0)
 Q
"RTN","PSGSICHK",45,0)
 ;
"RTN","PSGSICHK",46,0)
 N Z,ZZ,STATUSNP I $G(PSJPWD)&($P($G(PSJSYSU),";")=3)&($G(PSGDRG)) I ($D(^PSI(58.1,"D",PSGDRG,PSJPWD)))!($D(^PSD(58.8,"D",PSGDRG,PSJPWD))) D EN^DDIOL("                         *** A WARD STOCK ITEM ***")
"RTN","PSGSICHK",47,0)
 D NOW^%DTC
"RTN","PSGSICHK",48,0)
 N PSJDCHK F Z=%:0 S Z=$O(^PS(55,+PSGP,5,"AUS",Z)) Q:'Z!$D(DUOUT)  F ZZ=0:0 S ZZ=$O(^PS(55,+PSGP,5,"AUS",Z,ZZ)) Q:'ZZ!$D(DUOUT)  I +$G(^PS(55,+PSGP,5,ZZ,.2))=PSGX D PDWCHK(+PSGP,ZZ_"U") S PSJDCHK=1
"RTN","PSGSICHK",49,0)
 F STATUSNP="N","P" F Z=0:0 S Z=$O(^PS(53.1,"AS",STATUSNP,+PSGP,Z)) Q:'Z!$D(DUOUT)  I +$G(^PS(53.1,+Z,.2))=PSGX D PDWCHK(+PSGP,Z_"P") S PSJDCHK=1
"RTN","PSGSICHK",50,0)
 I $D(PSJDCHK) N DIR D
"RTN","PSGSICHK",51,0)
 .S DIR(0)="Y",DIR("A")="Do you wish to continue entering this order",DIR("?",1)="Enter ""N"" if you wish to exit without creating a new order,"
"RTN","PSGSICHK",52,0)
 .S DIR("?")="or ""Y"" to continue with the order entry process." D ^DIR S:'Y Y=-1,X="^"
"RTN","PSGSICHK",53,0)
 K Z,ZZ
"RTN","PSGSICHK",54,0)
 Q
"RTN","PSGSICHK",55,0)
 ;
"RTN","PSGSICHK",56,0)
ENDDC(PSGP,PSJDD) ; Perform Duplicate Drug, Duplicate Class
"RTN","PSGSICHK",57,0)
 ;Using FDB OC
"RTN","PSGSICHK",58,0)
 NEW PSPDRG,PSJDSPNM,X
"RTN","PSGSICHK",59,0)
 K ^TMP($J,"PSJPRE")
"RTN","PSGSICHK",60,0)
 S PSJDSPNM=""
"RTN","PSGSICHK",61,0)
 ;If it is an active or pending order then check for multiple dispense drugs.
"RTN","PSGSICHK",62,0)
 I $G(PSJMULDD)>1!($G(PSGORD)]"") S PSJDSPNM=$$DRGNM()
"RTN","PSGSICHK",63,0)
 S PSPDRG(1)=PSJDD_U_$S(PSJDSPNM]"":PSJDSPNM,1:$$DN^PSJMISC(+PSJDD))
"RTN","PSGSICHK",64,0)
 I $$SUP^PSSDSAPI(+PSJDD) D DISPLAY^PSJOC Q
"RTN","PSGSICHK",65,0)
 D OC^PSJOC(.PSPDRG,"I;"_$G(PSGORD))
"RTN","PSGSICHK",66,0)
 Q 
"RTN","PSGSICHK",67,0)
DRGNM() ;
"RTN","PSGSICHK",68,0)
 ;Return the OI name + Dosage form if more than one DD in the order
"RTN","PSGSICHK",69,0)
 NEW PSJCNT,PSJDSPNM,X
"RTN","PSGSICHK",70,0)
 S PSJCNT=0,PSJDSPNM=""
"RTN","PSGSICHK",71,0)
 F X=0:0 S X=$O(^PS(53.45,+$G(PSJSYSP),2,X)) Q:'X  S PSJCNT=PSJCNT+1
"RTN","PSGSICHK",72,0)
 I PSJCNT>1,+$G(PSGPDRG) S PSJDSPNM=$$OIDF^PSJLMUT1(+PSGPDRG)
"RTN","PSGSICHK",73,0)
 Q PSJDSPNM
"RTN","PSGSICHK",74,0)
 ;
"RTN","PSGSICHK",75,0)
ENDDCOLD(PSGP,PSJDD) ; Perform Duplicate Drug, Duplicate Class,
"RTN","PSGSICHK",76,0)
 ;*** The following codes are no longer used after PSJ*5*181 ***
"RTN","PSGSICHK",77,0)
 ; Drug-Drug interaction check, Drug-Allergy interaction check.
"RTN","PSGSICHK",78,0)
 Q
"RTN","PSGSICHK",79,0)
 N PSJLINE,Z,ZZ,PSJFST
"RTN","PSGSICHK",80,0)
 S (PSJLINE,PSJFST)=0
"RTN","PSGSICHK",81,0)
 I $G(PSJPWD)&($P($G(PSJSYSU),";")=3)&($G(PSJDD)) I ($D(^PSI(58.1,"D",PSJDD,PSJPWD)))!($D(^PSD(58.8,"D",PSJDD,PSJPWD))) W !?25,"*** A WARD STOCK ITEM ***"
"RTN","PSGSICHK",82,0)
 D EN^PSOORDRG(PSGP,PSJDD) K PSJPDRG N INTERVEN,PSJIREQ,PSJRXREQ S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)="" S DFN=PSGP
"RTN","PSGSICHK",83,0)
 I $T(HAVEHDR^ORRDI1)]"",$$HAVEHDR^ORRDI1,'$D(^XTMP("ORRDI","OUTAGE INFO","DOWN")) D
"RTN","PSGSICHK",84,0)
 . I $P($G(^XTMP("ORRDI","PSOO",PSGP,0)),"^",3)<0 W !,"Remote data not available - Only local order checks processed." D PAUSE^PSJLMUT1
"RTN","PSGSICHK",85,0)
 I $D(^TMP($J,"DD")) D ORDCHK^PSJLMUT1(PSGP,"DD",4)
"RTN","PSGSICHK",86,0)
 I $D(^TMP($J,"DC")) D ORDCHK^PSJLMUT1(PSGP,"DC",6)
"RTN","PSGSICHK",87,0)
IVSOL ;*** Start order check for IV solution at this point.
"RTN","PSGSICHK",88,0)
 I '$D(PSJFST) N PSJFST S PSJFST=0
"RTN","PSGSICHK",89,0)
 I $D(^TMP($J,"DI")) S INTERVEN=1 D ORDCHK^PSJLMUT1(PSGP,"DI",8)
"RTN","PSGSICHK",90,0)
 ;*** Allergy/adverse reaction check.
"RTN","PSGSICHK",91,0)
 N PTR,X
"RTN","PSGSICHK",92,0)
 S PTR=$P($G(^PSDRUG(PSJDD,"ND")),U)_"."_$P($G(^PSDRUG(PSJDD,"ND")),U,3)
"RTN","PSGSICHK",93,0)
 K ^TMP("PSJDAI",$J) S PSJACK=$$ORCHK^GMRAOR(DFN,"DR",PTR) D:$G(PSJACK)=1
"RTN","PSGSICHK",94,0)
 .S ^TMP("PSJDAI",$J,0)=1
"RTN","PSGSICHK",95,0)
 .S I=0 F  S I=$O(GMRAING(I)) Q:'I  S ^TMP("PSJDAI",$J,I,0)=GMRAING(I)
"RTN","PSGSICHK",96,0)
 I $D(^TMP("PSJDAI",$J)) S PSJPDRG=1 D
"RTN","PSGSICHK",97,0)
 .W $C(7),!!,"A Drug-Allergy Reaction exists for this medication!",!!
"RTN","PSGSICHK",98,0)
 .W !?7,"Drug: "_$P($G(^PSDRUG(PSJDD,0)),"^") I $O(^TMP("PSJDAI",$J)) W !,"Ingredients: " D
"RTN","PSGSICHK",99,0)
 ..S I=0 F  S I=$O(^TMP("PSJDAI",$J,I)) Q:'I  W:$X+$L($G(^(I,0)))+2>IOM !?19 W:I=1 $G(^TMP("PSJDAI",$J,I,0)) W:I>1 ", ",$G(^TMP("PSJDAI",$J,I,0))
"RTN","PSGSICHK",100,0)
 .W !!
"RTN","PSGSICHK",101,0)
 K PSJACK,GMRAING,I,^TMP($J)
"RTN","PSGSICHK",102,0)
 D ALGCLASS
"RTN","PSGSICHK",103,0)
CONT ; Ask user if they wish to continue in spite of an order check.
"RTN","PSGSICHK",104,0)
 Q:'$D(PSJPDRG)  N DIR S DIR(0)="Y",DIR("A")="Do you wish to continue entering this order",DIR("?",1)="Enter ""N"" if you wish to exit without creating a new order,"
"RTN","PSGSICHK",105,0)
 S DIR("?")="or ""Y"" to continue with the order entry process.",DIR("B")="NO" D ^DIR I 'Y S PSGORQF=1,X="^",COMQUIT=1 Q
"RTN","PSGSICHK",106,0)
 I 'INTERVEN!($P(PSJSYSU,";")'=3) Q
"RTN","PSGSICHK",107,0)
 NEW PSJY
"RTN","PSGSICHK",108,0)
 W:PSJIREQ !!,"This is a CRITICAL interaction, you must enter an intervention log to continue"
"RTN","PSGSICHK",109,0)
 S DIR(0)="Y",DIR("A")="Do you wish to log an intervention",DIR("?",1)="Enter ""N"" if you do not wish to log an intervention,",DIR("?")="or ""Y"" to log an intervention." D ^DIR S PSJY=Y D:Y ^PSJRXI
"RTN","PSGSICHK",110,0)
 I 'PSJY,PSJIREQ S PSGORQF=1,COMQUIT=1
"RTN","PSGSICHK",111,0)
 Q
"RTN","PSGSICHK",112,0)
 ;
"RTN","PSGSICHK",113,0)
ENDL ; used by PSGTRAIN DRUG LOOK-UP option
"RTN","PSGSICHK",114,0)
 D ENCV^PSGSETU Q:$D(XQUIT)
"RTN","PSGSICHK",115,0)
 F  S DIC="^PSDRUG(",DIC(0)="AEIMOQZ",DIC("A")="Select DRUG: " W ! D ^DIC K DIC Q:+Y'>0  D SF
"RTN","PSGSICHK",116,0)
 D ENKV^PSGSETU K N5,ND,Q,Y Q
"RTN","PSGSICHK",117,0)
 ;
"RTN","PSGSICHK",118,0)
SF ;
"RTN","PSGSICHK",119,0)
 S Y=+Y,ND=$G(^PSDRUG(Y,0)),PSGID=+$G(^("I")) I PSGID W !!,"THIS DRUG IS INACTIVE AS OF ",$E($$ENDTC^PSGMI(PSGID),1,8)
"RTN","PSGSICHK",120,0)
 W !!,$S($P(ND,"^",9):"NON-",1:""),"FORMULARY ITEM" W:$P(ND,"^",10)]"" !,$P(ND,"^",10)
"RTN","PSGSICHK",121,0)
 S ND=$P($G(^PSDRUG(Y,2)),"^",3)["U" W !,$P("NOT^","^",ND+1)," A UNIT DOSE DRUG" W ! S ND=$G(^(8)),N5=$G(^(8.5)) W !?2,"DAY (nD) or DOSE (nL) LIMIT: " I ND W $P(ND,"^")
"RTN","PSGSICHK",122,0)
 W !?10,"UNIT DOSE MED ROUTE: " I $P(ND,"^",2) W $S($D(^PS(51.2,$P(ND,"^",2),0)):$P(^(0),"^"),1:$P(ND,"^",2))
"RTN","PSGSICHK",123,0)
 ; NAKED REF below refers to ^PS(51.2, on line above.
"RTN","PSGSICHK",124,0)
 W !?6,"UNIT DOSE SCHEDULE TYPE: " I $P(ND,"^",3)]"" W $P($P(";"_$P(^(0),"^",3),";"_$P(ND,"^",3)_":",2),";")
"RTN","PSGSICHK",125,0)
 W !?11,"UNIT DOSE SCHEDULE: " I $P(ND,"^",4)]"" W $P(ND,"^",4)
"RTN","PSGSICHK",126,0)
 W !,"CORRESPONDING OUTPATIENT DRUG: " I $P(ND,"^",5) W $S('$D(^PSDRUG(+$P(ND,"^",5),0)):$P(ND,"^",5),$P(^(0),"^")]"":$P(^(0),"^"),1:$P(ND,"^",5))
"RTN","PSGSICHK",127,0)
 W !?17,"ATC MNEMONIC: " I $P(N5,"^",2)]"" W $P(N5,"^",2)
"RTN","PSGSICHK",128,0)
 W !?17,"ATC CANISTER: " F Q=0:0 S Q=$O(^PSDRUG(Y,212,Q)) Q:'Q  S ND=$G(^(Q,0)) I ND,$P(ND,"^",2) W ?31,$S('$D(^PS(57.5,+ND,0)):+ND_";PS(57.5,",$P(^(0),"^")]"":$P(^(0),"^"),1:+ND_";PS(57.5,"),?56,$P(ND,"^",2),!
"RTN","PSGSICHK",129,0)
 Q
"RTN","PSGSICHK",130,0)
 ;
"RTN","PSGSICHK",131,0)
OCHK ; Add drugs in current order to ^TMP("ORDERS" and call order checker.
"RTN","PSGSICHK",132,0)
 ; Set PSJOCHK=1 so OP order check doesn't Kill array.
"RTN","PSGSICHK",133,0)
 ;
"RTN","PSGSICHK",134,0)
 K ^TMP($J,"ORDERS")
"RTN","PSGSICHK",135,0)
 N PSJOCHK S PSJOCHK=1
"RTN","PSGSICHK",136,0)
PDWCHK(DFN,ON) ; Print Dup Drug order.
"RTN","PSGSICHK",137,0)
 N ND,ND0,ND2,X
"RTN","PSGSICHK",138,0)
 W:'$D(PSJDCHK) $C(7),$C(7),!!,"WARNING! THIS PATIENT HAS THE FOLLOWING ORDER(S) FOR THIS MEDICATION:",!!
"RTN","PSGSICHK",139,0)
 S ND=$$DRUGNAME^PSJLMUTL(DFN,ON)
"RTN","PSGSICHK",140,0)
 S F=$S(ON["P":"^PS(53.1,",1:"^PS(55,"_DFN_",5,"),ND0=$G(@(F_+ON_",0)")),ND2=$G(^(2)),X=$P(ND,U,2),X=$S(X=.2:$P($G(^(.2)),U,2),1:$G(^(.3)))
"RTN","PSGSICHK",141,0)
 W ?10,$P(ND,U),!,?13,"Give: ",X," ",$$ENMRN^PSGMI(+$P(ND0,U,3))," ",$P(ND2,U),!!
"RTN","PSGSICHK",142,0)
 Q
"RTN","PSGSICHK",143,0)
ALGCLASS ; checks any Drug allergies or reactions to see if
"RTN","PSGSICHK",144,0)
 ;         the new drug is the same class
"RTN","PSGSICHK",145,0)
 ; this call can be removed by commenting out the call on IVSOL+16
"RTN","PSGSICHK",146,0)
 N PSJLIST,CT,CLS,CLCHK,CNT,PSJL,LIST,DCCNT,PSCLASS,LEN
"RTN","PSGSICHK",147,0)
 S PSCLASS=$P($G(^PSDRUG(PSJDD,0)),"^",2),LEN=4 I $E(PSCLASS,1,4)="CN10" S LEN=5 ;look at 5 chars if ANALGESICS
"RTN","PSGSICHK",148,0)
 I $T(GETDATA^GMRAOR)]"" G ALGC2
"RTN","PSGSICHK",149,0)
 S GMRA="0^0^111" D EN1^GMRADPT
"RTN","PSGSICHK",150,0)
 F PSJLIST=0:0 S PSJLIST=$O(GMRAL(PSJLIST)) Q:'PSJLIST  D
"RTN","PSGSICHK",151,0)
 .K PSJAGL D EN1^GMRAOR2(PSJLIST,"PSJAGL")
"RTN","PSGSICHK",152,0)
 .; is the allergy/reaction drug class first four digits the same as the
"RTN","PSGSICHK",153,0)
 .; class for the drug being entered?
"RTN","PSGSICHK",154,0)
 .S (CT,CLS)="",DCCNT=0
"RTN","PSGSICHK",155,0)
 .I $D(PSJAGL("V")) D
"RTN","PSGSICHK",156,0)
 ..F  S DCCNT=$O(PSJAGL("V",DCCNT)) Q:'DCCNT  S:$E($P($G(PSJAGL("V",DCCNT)),"^"),1,LEN)=$E(PSCLASS,1,LEN) (PSJPDRG,CLCHK)=1,CNT=$S('$D(CNT):1,1:CNT+1),LIST(CNT)=$P($G(PSJAGL),"^")_"^"_$P($G(PSJAGL("V",DCCNT)),"^",2)
"RTN","PSGSICHK",157,0)
 D:$G(CLCHK)
"RTN","PSGSICHK",158,0)
 .W !!,$C(7),"A Drug-Allergy Reaction exists for this medication and/or class!"
"RTN","PSGSICHK",159,0)
 .F PSJL=0:0 S PSJL=$O(LIST(PSJL)) Q:'PSJL  D
"RTN","PSGSICHK",160,0)
 ..W !?6,"Drug: "_$P(LIST(PSJL),"^"),!,"Drug Class: "_$P(LIST(PSJL),"^",2),!
"RTN","PSGSICHK",161,0)
 Q
"RTN","PSGSICHK",162,0)
ALGC2 ;
"RTN","PSGSICHK",163,0)
 K GMRADRCL
"RTN","PSGSICHK",164,0)
 D GETDATA^GMRAOR(DFN) Q:'$D(^TMP("GMRAOC",$J,"APC"))
"RTN","PSGSICHK",165,0)
 N GMRACL,RET
"RTN","PSGSICHK",166,0)
 S RET=0,GMRACL="" F  S GMRACL=$O(^TMP("GMRAOC",$J,"APC",GMRACL)) Q:'$L(GMRACL)  D
"RTN","PSGSICHK",167,0)
 .N GMRANM,GMRALOC
"RTN","PSGSICHK",168,0)
 .S GMRALOC=^TMP("GMRAOC",$J,"APC",GMRACL)
"RTN","PSGSICHK",169,0)
 .S GMRANM=$P(^PS(50.605,+$O(^PS(50.605,"B",GMRACL,0)),0),U,2)
"RTN","PSGSICHK",170,0)
 .S GMRADRCL(GMRACL)=GMRACL_U_GMRANM_" ("_GMRALOC_")"
"RTN","PSGSICHK",171,0)
 .S RET=RET+1
"RTN","PSGSICHK",172,0)
 Q:'RET  K ^TMP("GMRAOC",$J)
"RTN","PSGSICHK",173,0)
 S CLCHK="",CT="" F  S CT=$O(GMRADRCL(CT)) Q:CT=""  D
"RTN","PSGSICHK",174,0)
 .I $E(PSCLASS,1,LEN)=$E(CT,1,LEN) S CLCHK=$G(CLCHK)+1,^TMP($J,"PSJDRCLS",CLCHK)=CT_" "_$P(GMRADRCL(CT),"^",2)
"RTN","PSGSICHK",175,0)
CLASSDSP ;
"RTN","PSGSICHK",176,0)
 I '$D(^TMP($J,"PSJDRCLS")) Q
"RTN","PSGSICHK",177,0)
 W $C(7),!,"A Drug-Allergy Reaction exists for this medication and/or class!",!
"RTN","PSGSICHK",178,0)
 W !,"Drug: "_$P($G(^PSDRUG(PSJDD,0)),"^")
"RTN","PSGSICHK",179,0)
 S CT="" F  S CT=$O(^TMP($J,"PSJDRCLS",CT)) Q:CT=""  W !,"Drug Class: "_^TMP($J,"PSJDRCLS",CT)
"RTN","PSGSICHK",180,0)
 K ^TMP($J,"PSJDRCLS")
"RTN","PSGSICHK",181,0)
 S DIR("?",1)="Answer 'YES' if you DO want to enter a reaction for this medication,"
"RTN","PSGSICHK",182,0)
 S DIR("?")="       'NO' if you DON'T want to enter a reaction for this medication,"
"RTN","PSGSICHK",183,0)
 S DIR(0)="SA^1:YES;0:NO",DIR("A")="Do you want to Intervene? ",DIR("B")="Y" W ! D ^DIR
"RTN","PSGSICHK",184,0)
 I Y D ^PSJRXI
"RTN","PSGSICHK",185,0)
 I '$G(Y) K DIR,DTOUT,DIRUT,DIROUT,DUOUT,Y Q
"RTN","PSGSICHK",186,0)
 Q
"RTN","PSIV")
0^5^B24224990
"RTN","PSIV",1,0)
PSIV ;BIR/PR,MLM-MISC UTILITIES ;19 Mar 99 / 9:45 AM
"RTN","PSIV",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,16,29,38,53,56,72,58,110,181**;16 DEC 97;Build 190
"RTN","PSIV",3,0)
 ;
"RTN","PSIV",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIV",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA 2789
"RTN","PSIV",6,0)
 ; Reference to ^%DTC is supported by DBIA 10000
"RTN","PSIV",7,0)
 ; Reference to ^DIC is supported by DBIA 10006
"RTN","PSIV",8,0)
 ; Reference to ^DIE is supported by DBIA 10018
"RTN","PSIV",9,0)
 ; Reference to ^DIR is supported by DBIA 10026
"RTN","PSIV",10,0)
 ; Reference to ^VALM is supported by DBIA 10118
"RTN","PSIV",11,0)
 ; Reference to ^VALM1 is supported by DBIA 10116
"RTN","PSIV",12,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSIV",13,0)
 ;
"RTN","PSIV",14,0)
ENGETP ;Enter here to select patient.
"RTN","PSIV",15,0)
 K DIC S DIC("W")="W ""  "",$P(^(0),""^"",9) W:$D(^(.1)) ""  "",^(.1)",DIC="^DPT(",DIC(0)="QEM"
"RTN","PSIV",16,0)
 D FULL^VALM1
"RTN","PSIV",17,0)
GETP1 ;
"RTN","PSIV",18,0)
 ;NEW arrays use in order checks
"RTN","PSIV",19,0)
 NEW PSJEXCPT,PSJOCER
"RTN","PSIV",20,0)
 S PSGPTMP=0,PPAGE=1,DFN=-1,X="Select PATIENT:^^^^1" D ENQ Q:"^"[X
"RTN","PSIV",21,0)
 D EN^PSJDPT
"RTN","PSIV",22,0)
 I Y<0 G ENGETP
"RTN","PSIV",23,0)
 N PSGP,PSJACNWP S (PSGP,DFN)=+Y D ENBOTH^PSJAC S PSJORL=$$ENORL^PSJUTL($G(VAIN(4)))
"RTN","PSIV",24,0)
 Q
"RTN","PSIV",25,0)
 ;
"RTN","PSIV",26,0)
ENYN ;Enter here for yes/no responses. This is a general reader that I have
"RTN","PSIV",27,0)
 ;been phasing out with ^DICN
"RTN","PSIV",28,0)
 S X=X_"^Y:YES;N:NO^YES,NO"
"RTN","PSIV",29,0)
 ;
"RTN","PSIV",30,0)
ENQ ;Enter here to read X. This is the general reader that I have
"RTN","PSIV",31,0)
 ;been slowly phasing out
"RTN","PSIV",32,0)
 S QUD=$P(X,"^",2) W !!,$P(X,"^")," " W:QUD]"" QUD,"// " R QUX:DTIME W:'$T $C(7) S:'$T QUX="^" S:QUX="" QUX=QUD I QUX["^"!(QUX["?") G KILL
"RTN","PSIV",33,0)
 I $L(QUX)>500 W "    ??" G ENQ
"RTN","PSIV",34,0)
 S:QUX?1L QUX=$C($A(QUX)-32)
"RTN","PSIV",35,0)
 S QUD=";"_$P(X,"^",3)_";" G:QUD'[(";"_QUX_":") VAR S QUX1=$E(QUD,$F(QUD,QUX_":"),($F(QUD,";",$F(QUD,QUX_":"))-2)) G:QUX1[":" VAR W "    ",QUX1 G KILL
"RTN","PSIV",36,0)
VAR F QUX1=1:1 S QUD=$P($P(X,"^",4),",",QUX1) Q:QUD=""  I $P(QUD,QUX)="" W $S($P(X,"^",2)=QUX:"    "_QUX,1:"")_$P(QUD,QUX,2,99) S QUX=QUD G KILL
"RTN","PSIV",37,0)
PAT I $P(X,"^",5)]"",@$P(X,"^",5,999) G KILL
"RTN","PSIV",38,0)
 W $C(7)," ???" G ENQ
"RTN","PSIV",39,0)
KILL S X=QUX K QUX,QUX1,QUD,PSJDCEXP Q
"RTN","PSIV",40,0)
 ;
"RTN","PSIV",41,0)
ENADM ;Edit administration schedules.
"RTN","PSIV",42,0)
 S DIC="^PS(51.1,",DIC(0)="QEAML",DLAYGO=51.1 D ^DIC K:+Y<0 %,DA,D0,DIC,DIE,DLAYGO,DR,Z,Y Q:'$D(Y)  S DIE=DIC,DR=".01;1",DA=+Y K DIC D ^DIE G ENADM
"RTN","PSIV",43,0)
 ;
"RTN","PSIV",44,0)
ENOW D NOW^%DTC S Y=% K %,%H,%I
"RTN","PSIV",45,0)
 Q
"RTN","PSIV",46,0)
 ;
"RTN","PSIV",47,0)
ENC ;Get unit of measure for drug selected.
"RTN","PSIV",48,0)
 S X=$P($P(";"_$P(Y,U,3),";"_X_":",2),";")
"RTN","PSIV",49,0)
 Q
"RTN","PSIV",50,0)
 ;
"RTN","PSIV",51,0)
ENCHS ;Needs PSIVBR (Branch point)
"RTN","PSIV",52,0)
 D ENGETP G:DFN<0 Q
"RTN","PSIV",53,0)
 ;* Lock patient if calling FROM PSJI DELETE ORDER.
"RTN","PSIV",54,0)
 ;* I PSIVBR="D ENT^PSIVPGE" S X=DFN_";DPT(" D LK^ORX2 Q:'Y
"RTN","PSIV",55,0)
 I PSIVBR="D ENT^PSIVPGE",('$$L^PSSLOCK(DFN,1)) Q
"RTN","PSIV",56,0)
OE N CONT S CONT=0
"RTN","PSIV",57,0)
 F  Q:CONT  D ENCHS1
"RTN","PSIV",58,0)
 Q:$D(ORVP)
"RTN","PSIV",59,0)
 G ENCHS
"RTN","PSIV",60,0)
ENCHS1 ;
"RTN","PSIV",61,0)
 S PSJORQF=0,CONT=0
"RTN","PSIV",62,0)
 S PSJPROT=2,PSJOL="",(PSGOP,PSGP)=DFN
"RTN","PSIV",63,0)
 K PSJLMPRO D EN^VALM("PSJ LM BRIEF PATIENT INFO")
"RTN","PSIV",64,0)
 S VALMCNT=30
"RTN","PSIV",65,0)
 I PSIVBR="D PROCESS^PSIVRD",(PSJOL="N") D ORDNO^PSIVRD Q
"RTN","PSIV",66,0)
 I $G(PSJNEWOE) S PSJOL="S"
"RTN","PSIV",67,0)
 I PSJOL="S"!(PSJOL="L") F  Q:CONT  S P("PT")=PSJOL D
"RTN","PSIV",68,0)
 . S PSJORQF=0,PSJNEWOE=0
"RTN","PSIV",69,0)
 . D ENNB^PSIVACT
"RTN","PSIV",70,0)
 . I '$D(^TMP("PSIV",$J)) D FULL^VALM1 W !!,?30,"NO ORDERS FOUND",! K DIR S DIR(0)="E" D ^DIR W @IOF S CONT=0
"RTN","PSIV",71,0)
 . NEW PSJIVPRF S PSJIVPRF=1
"RTN","PSIV",72,0)
 . S PSJOL=$S(",S,L,"[(","_$G(PSJOL)_","):PSJOL,1:"S")
"RTN","PSIV",73,0)
 . D EN^VALM("PSJ LM IV OE")
"RTN","PSIV",74,0)
 . I $G(VALMBCK)="Q" Q
"RTN","PSIV",75,0)
 . S CONT=1
"RTN","PSIV",76,0)
 ;* Unlock patient if come from PSJI DELETE ORDER
"RTN","PSIV",77,0)
 ;* I PSIVBR="D ENT^PSIVPGE" S X=DFN_";DPT(" D ULK^ORX2
"RTN","PSIV",78,0)
 I '$G(PSJORQF) S CONT=1
"RTN","PSIV",79,0)
 I PSIVBR="D ENT^PSIVPGE" D UL^PSSLOCK(DFN)
"RTN","PSIV",80,0)
 K PSJLMPRO
"RTN","PSIV",81,0)
 Q
"RTN","PSIV",82,0)
SELSO ;SELECT ORDER USING "SO" OPTION
"RTN","PSIV",83,0)
 S PSGLMT=^TMP("PSJPRO",$J,0) D ENASR^PSGON,OV
"RTN","PSIV",84,0)
 Q
"RTN","PSIV",85,0)
SELNUM ;SELECT ORDERS WITH NUMBERS
"RTN","PSIV",86,0)
 S PSGLMT=^TMP("PSJPRO",$J,0),X=$P(XQORNOD(0),"=",2) D ENCHK^PSGON,OV
"RTN","PSIV",87,0)
 Q
"RTN","PSIV",88,0)
OV ;
"RTN","PSIV",89,0)
 I '$D(PSGODDD) S VALMBCK="R" Q
"RTN","PSIV",90,0)
 N DONE
"RTN","PSIV",91,0)
 F PSIVOV1=1:1:PSGODDD F PSIVOV2=1:1:$L(PSGODDD(PSIVOV1),",")-1 D
"RTN","PSIV",92,0)
 .S ON=+$P(PSGODDD(PSIVOV1),",",PSIVOV2)
"RTN","PSIV",93,0)
 .S ON=$$GTON(ON)
"RTN","PSIV",94,0)
 .Q:'ON!$G(DONE)
"RTN","PSIV",95,0)
 .D OV1
"RTN","PSIV",96,0)
 S VALMBCK="Q"
"RTN","PSIV",97,0)
 Q
"RTN","PSIV",98,0)
GTON(X) ;
"RTN","PSIV",99,0)
 ;Return the ON node from ^Tmp
"RTN","PSIV",100,0)
 I $G(X)="" Q ""
"RTN","PSIV",101,0)
 I $D(^TMP("PSIV",$J,"AB",X)) Q ^(X)
"RTN","PSIV",102,0)
 I $D(^TMP("PSIV",$J,"NB",X)) Q ^(X)
"RTN","PSIV",103,0)
 I $D(^TMP("PSIV",$J,"PB",X)) Q ^(X)
"RTN","PSIV",104,0)
 I $D(^TMP("PSIV",$J,"XB",X)) Q ^(X)
"RTN","PSIV",105,0)
 I $D(^TMP("PSIV",$J,"NDB",X)) Q ^(X)
"RTN","PSIV",106,0)
 I $D(^TMP("PSIV",$J,"PDB",X)) Q ^(X)
"RTN","PSIV",107,0)
 I $D(^TMP("PSIV",$J,"RDB",X)) Q ^(X)
"RTN","PSIV",108,0)
 Q ""
"RTN","PSIV",109,0)
OV1 ;
"RTN","PSIV",110,0)
 S (ON,ON55,P("PON"))=9999999999-ON_$S(ON["V":"V",1:"P")
"RTN","PSIV",111,0)
 I PSIVBR["D ^PSIVVW1" D
"RTN","PSIV",112,0)
 . S VALMSG="Select either ""AL"" , ""LL"" or ""AL,LL"" for both"
"RTN","PSIV",113,0)
 . S PSJORD=ON D EN^PSJLIPRF
"RTN","PSIV",114,0)
 E  D
"RTN","PSIV",115,0)
 . I PSIVBR="D ^PSIVOPT",'($$LS^PSSLOCK(PSGP,ON)) Q
"RTN","PSIV",116,0)
 . X PSIVBR
"RTN","PSIV",117,0)
 . D:PSIVBR="D ^PSIVOPT" UNL^PSSLOCK(PSGP,ON)
"RTN","PSIV",118,0)
 ;K:'$D(DUOUT) DONE
"RTN","PSIV",119,0)
 K:'$D(DUOUT)&($G(Y)'=-1) DONE
"RTN","PSIV",120,0)
 Q
"RTN","PSIV",121,0)
 ;
"RTN","PSIV",122,0)
 ;
"RTN","PSIV",123,0)
ENU ;Get IV additive strength. Called from templates.
"RTN","PSIV",124,0)
 N Y S Y=+^PS(55,DA(2),"IV",DA(1),"AD",DA,0),PSIVSTR=$$ENU^PSIVUTL(Y)
"RTN","PSIV",125,0)
 Q
"RTN","PSIV",126,0)
Q ;
"RTN","PSIV",127,0)
 ;K PSJEXCPT,PSJOCER,^TMP($J,"PSJPRE")
"RTN","PSIV",128,0)
 K ^TMP($J,"PSJPRE")
"RTN","PSIV",129,0)
 K ^TMP("PSIV",$J),^TMP("PSJ",$J),^TMP("PSJPRO",$J),^TMP("PSJALL",$J),^TMP("PSJI",$J),^TMP("PSJON",$J)
"RTN","PSIV",130,0)
 K DRG,DRGI,DRGN,DRGT,ERR,I,JJ,MI,N,N2,ON,ON55,P,P1,P3,P16,P17,PNOW,PS,PSGODD,PSGODDD,PSIV,PSIVAAT,PSIVACT,PSIVADM,PSIVAT
"RTN","PSIV",131,0)
 K PSIVC,PSIVDT,PSIVFLAG,PSIVLN,PSIVNOW,PSIVNU,PSIVON,PSIVOV1,PSIVOV2,PSIVREA,PSIVSTR,PSIVSTRT,PSIVNOL,PSIVTYPE,PSJNKF
"RTN","PSIV",132,0)
 K PSJORF,PSJORIFN,RDWARD,START,STOP,SCHED,USER,V,XT
"RTN","PSIV",133,0)
 K %,%I,DIC,PSIVC,PSIVNU,PSIVON,PSIVREA,PSIVOV1,PSIVOV2,RDWARD,V,VAERR,VW,X,X2,Y,Y1,Z,Z1,Z2
"RTN","PSIV",134,0)
 ;D KVAR^VADPT ;ENKV^PSGSETU
"RTN","PSIV",135,0)
 Q
"RTN","PSIVACT")
0^17^B16650605
"RTN","PSIVACT",1,0)
PSIVACT ;BIR/PR,MLM-UPDATE ORDER STATUS AFTER PATIENT SELECTION ;16 Jul 98 / 12:51 PM
"RTN","PSIVACT",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**15,38,58,110,181**;16 DEC 97;Build 190
"RTN","PSIVACT",3,0)
 ;
"RTN","PSIVACT",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIVACT",5,0)
 ;
"RTN","PSIVACT",6,0)
ENNA ; Inpatient entry point.
"RTN","PSIVACT",7,0)
 D:$D(XRTL) T0^%ZOSV
"RTN","PSIVACT",8,0)
 D NOW^%DTC S PSFDT=%,PS=0 D L D:'$G(PSIVRD) PEND
"RTN","PSIVACT",9,0)
 I $D(XRT0) S XRTN="PSIVACT" D T1^%ZOSV
"RTN","PSIVACT",10,0)
 Q
"RTN","PSIVACT",11,0)
 ;
"RTN","PSIVACT",12,0)
ENNB ; Ask profile type, gather orders.
"RTN","PSIVACT",13,0)
 D NOW^%DTC S PSFDT=%,PS=0 K ^TMP("PSIV",$J),^TMP("PSJPRO",$J)
"RTN","PSIVACT",14,0)
 S PSIVNV=$S(+PSJSYSU=1:"ANIV",+PSJSYSU=3:"APIV",1:"")
"RTN","PSIVACT",15,0)
 ;D @P("PT") D:PSIVNV]"" NVACT D:'$G(PSIVRD) PEND
"RTN","PSIVACT",16,0)
 D @P("PT") D:'$G(PSIVRD) PEND
"RTN","PSIVACT",17,0)
 I P("PT")="L",$D(XRT0) S XRTN="PSIVACT" D T1^%ZOSV
"RTN","PSIVACT",18,0)
 Q
"RTN","PSIVACT",19,0)
 ;
"RTN","PSIVACT",20,0)
L ; Long profile
"RTN","PSIVACT",21,0)
 S:'$D(PSJSYSU) PSJSYSU=""
"RTN","PSIVACT",22,0)
 F ON=0:0 K Y S ON=$O(^PS(55,DFN,"IV",+ON)) Q:'ON  D SETP
"RTN","PSIVACT",23,0)
 Q
"RTN","PSIVACT",24,0)
 ;
"RTN","PSIVACT",25,0)
S ; Short profile.
"RTN","PSIVACT",26,0)
 S PSJDCEXP=$$RECDCEXP^PSJP()
"RTN","PSIVACT",27,0)
 I '+$P(PSJDCEXP,U,2) S $P(PSJDCEXP,U,2)=PSFDT
"RTN","PSIVACT",28,0)
 F PSIVDT=$P($G(PSJDCEXP),U,2):0 S PSIVDT=$O(^PS(55,DFN,"IV","AIS",PSIVDT)) Q:'PSIVDT  F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",PSIVDT,+ON)) Q:'ON  S ON=ON_"V",P(17)=$P($G(^PS(55,DFN,"IV",+ON,0)),U,17) D ACTO
"RTN","PSIVACT",29,0)
 I +PSJSYSU=3 S PSIVNV="APIV" D NVACT K PSIVNV
"RTN","PSIVACT",30,0)
 Q
"RTN","PSIVACT",31,0)
 ;
"RTN","PSIVACT",32,0)
NVACT ; Non-verified but have active status
"RTN","PSIVACT",33,0)
 NEW ON
"RTN","PSIVACT",34,0)
 F ON=0:0 S ON=$O(^PS(55,PSIVNV,DFN,ON)) Q:'ON  D
"RTN","PSIVACT",35,0)
 . I $P($G(^PS(55,DFN,"IV",ON,0)),U,17)="E",($P($G(^(.2)),U,4)="D") S ^TMP("PSIV",$J,"A",9999999999-ON)=""
"RTN","PSIVACT",36,0)
 Q
"RTN","PSIVACT",37,0)
 ;
"RTN","PSIVACT",38,0)
PEND ; Get pending and non-verified orders from 53.1
"RTN","PSIVACT",39,0)
 N PSJCOM,PSJCOM1 S (PSJCOM,PSJCOM1)=0
"RTN","PSIVACT",40,0)
 F ON=0:0 S ON=$O(^PS(53.1,"AS","P",DFN,ON)) Q:'ON  D  S PSJCOM1=PSJCOM
"RTN","PSIVACT",41,0)
 . NEW X S X=$P($G(^PS(53.1,ON,.2)),U,4),X=$S(X="S":1,X="A":2,X="R":3,X="P":4,1:5)
"RTN","PSIVACT",42,0)
 . S PSJCOM=$P($G(^PS(53.1,ON,.2)),U,8) I PSJCOM Q:'$$COMCHK^PSJO1(PSJCOM,2)  Q:PSJCOM=PSJCOM1
"RTN","PSIVACT",43,0)
 . I $G(^PS(53.1,ON,0)),$P(^PS(53.1,ON,0),U,4)'="U" S ^TMP("PSIV",$J,$S('PSJCOM:"P",1:"PD"),X_9999999999-ON)=""
"RTN","PSIVACT",44,0)
 F ON=0:0 S ON=$O(^PS(53.1,"AS","N",DFN,ON)) Q:'ON  D  S PSJCOM1=PSJCOM
"RTN","PSIVACT",45,0)
 . NEW X S X=$P($G(^PS(53.1,ON,.2)),U,4),X=$S(X="S":1,X="A":2,X="R":3,X="P":4,1:5)
"RTN","PSIVACT",46,0)
 . S PSJCOM=$P($G(^PS(53.1,ON,.2)),U,8) I PSJCOM Q:'$$COMCHK^PSJO1(PSJCOM,2)  Q:PSJCOM=PSJCOM1
"RTN","PSIVACT",47,0)
 . I $G(^PS(53.1,ON,0)),$P(^PS(53.1,ON,0),U,4)'="U" S ^TMP("PSIV",$J,$S('PSJCOM:"N",1:"ND"),X_9999999999-ON)=""
"RTN","PSIVACT",48,0)
 .; S:$P(^PS(53.1,ON,0),U,4)'="U" ^TMP("PSIV",$J,"P",X_9999999999-ON)=""
"RTN","PSIVACT",49,0)
 ;
"RTN","PSIVACT",50,0)
QUIT ; Kill and exit.
"RTN","PSIVACT",51,0)
 K PSIVCWD,PSIVFLAG,PSIVWD,PSDFN,PSON1,PSFDT,YHOLD,JJ,XHOLD
"RTN","PSIVACT",52,0)
 Q
"RTN","PSIVACT",53,0)
 ;
"RTN","PSIVACT",54,0)
SETP ; Get partial P array,
"RTN","PSIVACT",55,0)
 S ON=ON_"V",Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,17,21 S P(X)=$P(Y,U,X)
"RTN","PSIVACT",56,0)
 S P(2)=+P(2),P(3)=+P(3) S Y(P(2))="",Y(P(3))=""
"RTN","PSIVACT",57,0)
 I P(2),P(3),P(17)'="P" D CHK
"RTN","PSIVACT",58,0)
 Q
"RTN","PSIVACT",59,0)
 ;
"RTN","PSIVACT",60,0)
CHK ; Check if order is active or expired and save accordingly.
"RTN","PSIVACT",61,0)
 S PS=PS+1 I P(17)="H" S ^TMP("PSIV",$J,"A",9999999999-ON)="" Q
"RTN","PSIVACT",62,0)
 I $O(Y(PSFDT))=P(3) D ACTO Q
"RTN","PSIVACT",63,0)
 I $O(Y(PSFDT))="" D NACTO Q
"RTN","PSIVACT",64,0)
 S:"ARO"[P(17) ^TMP("PSIV",$J,"A",9999999999-ON)="" S:"ED"[P(17) ^TMP("PSIV",$J,"X",9999999999-ON)="" S:"E"[P(17) PSIVREA="A",$P(^PS(55,DFN,"IV",+ON,0),U,17)="A",PS("A",9999999999-ON)=""
"RTN","PSIVACT",65,0)
 Q
"RTN","PSIVACT",66,0)
 ;
"RTN","PSIVACT",67,0)
ACTO ; Active orders
"RTN","PSIVACT",68,0)
 ;I "AE"[P(17) S ^TMP("PSIV",$J,"A",9999999999-ON)="" S:P(17)="E" $P(^PS(55,DFN,"IV",+ON,0),U,17)="A" Q ;;mv-not sure why setting status back to "A"???
"RTN","PSIVACT",69,0)
 I "A"[P(17) S ^TMP("PSIV",$J,"A",9999999999-ON)="" Q
"RTN","PSIVACT",70,0)
 I "HOR"[P(17) S ^TMP("PSIV",$J,"A",9999999999-ON)="" Q
"RTN","PSIVACT",71,0)
 I "DE"[P(17) S ^TMP("PSIV",$J,"RD",9999999999-ON)=""
"RTN","PSIVACT",72,0)
 Q
"RTN","PSIVACT",73,0)
 ;
"RTN","PSIVACT",74,0)
NACTO ; Inactive orders
"RTN","PSIVACT",75,0)
 ;I "AER"[P(17) S ^TMP("PSIV",$J,"X",9999999999-ON)="" I "AR"[P(17) S $P(^PS(55,DFN,"IV",+ON,0),U,17)="E" D EXPIR^PSIVOE Q
"RTN","PSIVACT",76,0)
 I "AER"[P(17) D
"RTN","PSIVACT",77,0)
 . Q:$P(^PS(55,DFN,"IV",+ON,0),U,3)=""
"RTN","PSIVACT",78,0)
 . I +PSJSYSU=3,($P($G(^PS(55,DFN,"IV",+ON,.2)),U,4)="D"),'+$P($G(^(4)),U,4) S ^TMP("PSIV",$J,"A",9999999999-ON)="" Q
"RTN","PSIVACT",79,0)
 . S ^TMP("PSIV",$J,"X",9999999999-ON)=""
"RTN","PSIVACT",80,0)
 I "AR"[P(17) S $P(^PS(55,DFN,"IV",+ON,0),U,17)="E" D EXPIR^PSIVOE
"RTN","PSIVACT",81,0)
 I "OD"[P(17) S ^TMP("PSIV",$J,"X",9999999999-ON)=""
"RTN","PSIVACT",82,0)
 Q
"RTN","PSIVACT",83,0)
 ;
"RTN","PSIVACT",84,0)
DCOR ; Auto-cancel IV orders
"RTN","PSIVACT",85,0)
 ;NEED TO NEW VARIABLES LATER.
"RTN","PSIVACT",86,0)
 NEW DA,DIR,DG,ON,ON55,P,PSIVAC,PSIVACT,PSIVLN,PSIVREA,PSIVRES,PSGALO,PSGP,PSJDCDT,PSJIVDCF,PSJIVON,PSJIVORF,PSJORF,VA,VADM,VAERR
"RTN","PSIVACT",87,0)
 S PSGP=DFN,PSIVRES="Auto DC due to Surgery Package"
"RTN","PSIVACT",88,0)
 D NOW^%DTC S PSJDCDT=+%
"RTN","PSIVACT",89,0)
 D ENIV^PSJADT0
"RTN","PSIVACT",90,0)
 Q
"RTN","PSIVEDRG")
0^43^B44643985
"RTN","PSIVEDRG",1,0)
PSIVEDRG ;BIR/MLM-ENTER/EDIT DRUGS FOR IV ORDER ;16 Mar 99 / 2:14 PM
"RTN","PSIVEDRG",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**21,33,50,65,74,84,128,147,181**;16 DEC 97;Build 190
"RTN","PSIVEDRG",3,0)
 ;
"RTN","PSIVEDRG",4,0)
 ; References to ^PS(52.6 supported by DBIA# 1231.
"RTN","PSIVEDRG",5,0)
 ; References to ^PS(52.7 supported by DBIA# 2173.
"RTN","PSIVEDRG",6,0)
 ; Reference to EN^PSOORDRG supported by DBIA# 2190.
"RTN","PSIVEDRG",7,0)
 ;
"RTN","PSIVEDRG",8,0)
DRG ; Edit Additive/Solution data
"RTN","PSIVEDRG",9,0)
 NEW DRGOC,PSGORQF K PSGORQF ;If PSGORQF=1 abort order after order check.
"RTN","PSIVEDRG",10,0)
 K PSIVOLD S DRG(2)="" I $D(DRG(DRGT)) S DRGI=+$O(DRG(DRGT,0)) I DRGI S PSIVOLD=1 D SETDRG
"RTN","PSIVEDRG",11,0)
DRG1 ;
"RTN","PSIVEDRG",12,0)
 Q:$G(PSGORQF)
"RTN","PSIVEDRG",13,0)
 I $G(X)="?" K DUOUT
"RTN","PSIVEDRG",14,0)
 D FULL^VALM1
"RTN","PSIVEDRG",15,0)
 W !,"Select ",DRGTN,": "
"RTN","PSIVEDRG",16,0)
 I DRGT=$G(PSIVOI),($G(PSIVOI("DILIST",0))>1) D GTADSOL Q
"RTN","PSIVEDRG",17,0)
 W:DRG(2)]"" DRG(2),"//" R X:DTIME S:'$T X="^" S:X=U DONE=1 Q:X["^"!(X=""&(DRG(2)=""))
"RTN","PSIVEDRG",18,0)
DRG1A I X="" W !,DRGTN,": ",DRG(2),"//" R X:DTIME S:'$T X="^" Q:X="^"  I X="" S Y=1 D DRG3 G:DRGT="AD"!($G(P(4))="H") DRG1 Q
"RTN","PSIVEDRG",19,0)
 I X="@",DRG(2)]"" D DEL G:%'=1 DRG1A K DRG(DRGT,DRGI) S DRGI=+$O(DRG(DRGT,0)) S:'DRGI DRG(DRGT,0)=0 D SETDRG G DRG1
"RTN","PSIVEDRG",20,0)
 I X["???",($E(P("OT"))="M"),(PSIVAC["C") D ORFLDS^PSIVEDT1 G DRG1
"RTN","PSIVEDRG",21,0)
 I X'["?" S %=0 D:$D(DRG(DRGT)) CHK G:%=1 DRG1A D DRG2 Q:$G(Y)>0&($G(P(4))'="H"&(DRGT="SOL"))  G DRG1
"RTN","PSIVEDRG",22,0)
 I $D(DRG(DRGT)) W !,"This order includes the following ",DRGTN,"S:",! F Y=0:0 S Y=$O(DRG(DRGT,Y)) Q:'Y  W !,$P(DRG(DRGT,Y),U,2)
"RTN","PSIVEDRG",23,0)
 W !,"YOU MAY ENTER A NEW ",DRGTN,", IF YOU WISH",! D GTSCRN(X) S DIC(0)="EQM" D ^DIC K DIC G DRG1
"RTN","PSIVEDRG",24,0)
 Q
"RTN","PSIVEDRG",25,0)
 ;
"RTN","PSIVEDRG",26,0)
SETDRG ; Put Drug data into DRG(x).
"RTN","PSIVEDRG",27,0)
 F X=1:1:6 S DRG(X)=$P(DRG(DRGT,DRGI),U,X)
"RTN","PSIVEDRG",28,0)
 S X="" I DRG(2)="",DRG(1) S DRG(2)="*** Undefined ***"
"RTN","PSIVEDRG",29,0)
 Q
"RTN","PSIVEDRG",30,0)
DRG2 ;
"RTN","PSIVEDRG",31,0)
 D GTSCRN(X) N PSIVX S PSIVX=X,DIC(0)="EQMZ" D ^DIC K DIC Q:Y<0
"RTN","PSIVEDRG",32,0)
 S PSJIVIEN=+Y
"RTN","PSIVEDRG",33,0)
 NEW PSJNF D NFIV^PSJDIN($S(DRGT="AD":52.6,1:52.7),+PSJIVIEN,.PSJNF)
"RTN","PSIVEDRG",34,0)
 W PSJNF("NF")
"RTN","PSIVEDRG",35,0)
 S PSIVNEW=1,DRGTMP=+Y_U_$P(Y(0),U)_U_$S(DRGT="SOL":$P(Y(0),U,3),1:"")_U_U_$P(Y(0),U,13)_U_$P(Y(0),U,11)
"RTN","PSIVEDRG",36,0)
 I '$D(ON55) NEW ON55 S ON55=ON
"RTN","PSIVEDRG",37,0)
 D ORDERCHK(DFN,ON55,1) I $G(PSGORQF) S X=U,DONE=1 Q
"RTN","PSIVEDRG",38,0)
 D DINIV^PSJDIN($S(DRGT="AD":52.6,1:52.7),+DRGTMP)
"RTN","PSIVEDRG",39,0)
 S (DRG(DRGT,0),DRGI)=$G(DRG(DRGT,0))+1,DRG(DRGT,DRGI)=DRGTMP K PSIVOLD
"RTN","PSIVEDRG",40,0)
 I (PSIVAC="PN"!(PSIVAC="CF")),(DRGT="AD"),$D(^PS(52.6,"C",PSIVX,+DRGTMP)) D ^PSIVQUI Q:$G(PSIVSTR)="QUICK CODE"!$G(PSGORQF)
"RTN","PSIVEDRG",41,0)
DRG3 ;
"RTN","PSIVEDRG",42,0)
 D:DRG(2)]"" DINIV^PSJDIN(FIL,+DRG(1))
"RTN","PSIVEDRG",43,0)
 D SETDRG
"RTN","PSIVEDRG",44,0)
 I DRGT="AD" S X=$P($G(^PS(FIL,+DRG(1),0)),U,3) W !!,"(The units of strength for this additive are in ",$$ENU^PSIVUTL(DRG(1)),")"
"RTN","PSIVEDRG",45,0)
AMT ;
"RTN","PSIVEDRG",46,0)
 I DRGT="SOL",'$G(PSIVOLD),($G(P(4))_$G(P(23))'["S") G DRG4
"RTN","PSIVEDRG",47,0)
1 ; Strength/Volume
"RTN","PSIVEDRG",48,0)
 W !,$S(DRGT="AD":"Strength: ",1:"Volume: ") W:+DRG(3) DRG(3),"//" R X:DTIME S:'$T X="^" Q:X="^"  G:X=""&DRG(3) 2 I X="" W $C(7),$S(DRGT="AD":"Strength",1:"Volume")," is REQUIRED!" G 1
"RTN","PSIVEDRG",49,0)
 D:$D(X) IT G:'$D(X)!($G(X)["?") AMT S DRG(3)=X I X="" D FIELD^DID($S(DRGT="AD":53.157,1:53.158),1,"","XECUTABLE HELP","PSJEX") X PSJEX("XECUTABLE HELP") K PSJEX G AMT
"RTN","PSIVEDRG",50,0)
2 I DRGT="AD",$G(P("DTYP"))>1,P(4)'="S",P(23)'="S" K DIR S DIR(0)="53.157,2" S:DRG(4)]"" DIR("B")=DRG(4) D ^DIR Q:$D(DTOUT)!$D(DUOUT)  S:Y DRG(4)=Y
"RTN","PSIVEDRG",51,0)
DRG4 ;
"RTN","PSIVEDRG",52,0)
 F X=1:1:6 S $P(DRG(DRGT,DRGI),U,X)=DRG(X)
"RTN","PSIVEDRG",53,0)
 S DRG(2)=""
"RTN","PSIVEDRG",54,0)
 Q
"RTN","PSIVEDRG",55,0)
 ;
"RTN","PSIVEDRG",56,0)
GTSCRN(PSIVX) ;Set DIC("S") if MD OE or matching drug has already been selected.
"RTN","PSIVEDRG",57,0)
 D:"?"[PSIVX HOLDHDR^PSJOE
"RTN","PSIVEDRG",58,0)
 S X=PSIVX
"RTN","PSIVEDRG",59,0)
 K DA,DIC S DIC=FIL,DIC("S")=$$IVDRGSC^PSIVUTL
"RTN","PSIVEDRG",60,0)
 I $E(PSIVAC)'="P",($P(P("OT"),U)="F") S X(1)=" I $P(X(1),U,13)",DIC("S")=$G(DIC("S"))_$S(DRGT="AD":X(1),$E(PSIVAC)="O":X(1),1:"")
"RTN","PSIVEDRG",61,0)
 Q
"RTN","PSIVEDRG",62,0)
 ;
"RTN","PSIVEDRG",63,0)
IT ; Input Transform for Strength/Volume.
"RTN","PSIVEDRG",64,0)
 I X?1.N,$L(X)>20 S X="?"
"RTN","PSIVEDRG",65,0)
 I X["?" W $C(7) S F1=53.15_$S(DRGT="AD":7,1:8),F2=1 D ENHLP^PSIVORC1 Q
"RTN","PSIVEDRG",66,0)
 I DRGT="AD" K:X'?.6N0.1".".8N!('X) X I $D(X) S:(X<1)&($P(X,".")'=0) X=0_X S X=X_" "_$$ENU^PSIVUTL(DRG(1)) W "   ",X Q
"RTN","PSIVEDRG",67,0)
 I $D(X) K:X=""!(X'?.N0.1".".N)!(X>9999)!(X<.01) X I $D(X) S:(X<1)&($P(X,".")'=0) X=0_X S X=X_" ML" W "   ",X
"RTN","PSIVEDRG",68,0)
 W:'$D(X) $C(7),"??"
"RTN","PSIVEDRG",69,0)
 Q
"RTN","PSIVEDRG",70,0)
 ;
"RTN","PSIVEDRG",71,0)
ORDERCHK(DFN,ON,X) ; Do order check
"RTN","PSIVEDRG",72,0)
 ;* If X is define, include the DRG(X) to the order check
"RTN","PSIVEDRG",73,0)
 ;This module is no longer used as of PSJ*5*181
"RTN","PSIVEDRG",74,0)
 Q
"RTN","PSIVEDRG",75,0)
 I X M:$D(DRG) DRGOC(ON)=DRG
"RTN","PSIVEDRG",76,0)
 NEW TMPDRG,X,XX,Y,PSIVNEW,PSGDRG,PSGDRGN,PSJDD,PSGP
"RTN","PSIVEDRG",77,0)
 D SAVEDRG(.TMPDRG,.DRG) ;Store DRG array in TMPDRG array
"RTN","PSIVEDRG",78,0)
 S PSIVNEW=1,PSGDRGN=$P($G(DRGTMP),U,2)
"RTN","PSIVEDRG",79,0)
 S (PSJDD,PSGDRG)=$P(^PS(FIL,+DRGTMP,0),U,2),PSGP=DFN
"RTN","PSIVEDRG",80,0)
 I FIL="52.6"  D ENDDC^PSGSICHK(DFN,PSGDRG)
"RTN","PSIVEDRG",81,0)
 I FIL="52.7" D
"RTN","PSIVEDRG",82,0)
 . D EN^PSOORDRG(DFN,PSGDRG)
"RTN","PSIVEDRG",83,0)
 . N INTERVEN,PSJIREQ,PSJRXREQ S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)=""
"RTN","PSIVEDRG",84,0)
 . S DFN=PSGP K PSJPDRG
"RTN","PSIVEDRG",85,0)
 . D IVSOL^PSGSICHK
"RTN","PSIVEDRG",86,0)
 D SAVEDRG(.DRG,.TMPDRG) ;Restore DRG array from TMPDRG array
"RTN","PSIVEDRG",87,0)
 D ENSTOP^PSIVCAL
"RTN","PSIVEDRG",88,0)
 Q
"RTN","PSIVEDRG",89,0)
SAVEDRG(NEW,OLD)   ;Store/restore DRG array.
"RTN","PSIVEDRG",90,0)
 K NEW
"RTN","PSIVEDRG",91,0)
 S:$G(OLD) NEW=OLD
"RTN","PSIVEDRG",92,0)
 F X=0:0 S X=$O(OLD(X)) Q:'X  S NEW(X)=OLD(X)
"RTN","PSIVEDRG",93,0)
 F XX="AD","SOL" D
"RTN","PSIVEDRG",94,0)
 . I $D(OLD(XX,0))#10=1 S NEW(XX,0)=OLD(XX,0)
"RTN","PSIVEDRG",95,0)
 . F X=0:0 S X=$O(OLD(XX,X)) Q:'X  S NEW(XX,X)=OLD(XX,X)
"RTN","PSIVEDRG",96,0)
 Q
"RTN","PSIVEDRG",97,0)
 ;
"RTN","PSIVEDRG",98,0)
CHK ; Check if drug is already part of order
"RTN","PSIVEDRG",99,0)
 N DDONE,I,TDRG,TDRGP F TDRG=0:0 S TDRG=$O(DRG(DRGT,TDRG)) Q:'TDRG!$G(DDONE)  D
"RTN","PSIVEDRG",100,0)
 .I $$UPPER^VALM1($E($P(DRG(DRGT,+TDRG),U,2),1,$L(X)))=$$UPPER^VALM1(X) W $P($$UPPER^VALM1($P(DRG(DRGT,+TDRG),U,2)),$$UPPER^VALM1(X),2) D ASKCHK Q
"RTN","PSIVEDRG",101,0)
 .S TDRGP=$P(DRG(DRGT,TDRG),U) F J=0:0 S J=$O(^PS(FIL,TDRGP,3,J)) Q:'J!$G(DDONE)  I $$UPPER^VALM1($E($P(^PS(FIL,TDRGP,3,J,0),U),1,$L(X)))=$$UPPER^VALM1(X) D  D ASKCHK Q
"RTN","PSIVEDRG",102,0)
 ..W $P($$UPPER^VALM1($P(^PS(FIL,TDRGP,3,J,0),U)),$$UPPER^VALM1(X),2)," ",$P(DRG(DRGT,TDRG),U,2)
"RTN","PSIVEDRG",103,0)
 Q
"RTN","PSIVEDRG",104,0)
 ;
"RTN","PSIVEDRG",105,0)
ASKCHK ; Do you want a drug that was previously selected.
"RTN","PSIVEDRG",106,0)
 S I=DRG(DRGT,TDRG) W " ",$P(I,U,3),$S($P(I,U,4):" ("_$P(I,U,4)_")",1:""),!,"...OK" S %=1 D YN^DICN
"RTN","PSIVEDRG",107,0)
 I %=1 S X="",DRGI=TDRG,(DDONE,PSIVOLD)=1 D SETDRG Q
"RTN","PSIVEDRG",108,0)
 W !,X
"RTN","PSIVEDRG",109,0)
 Q
"RTN","PSIVEDRG",110,0)
 ;
"RTN","PSIVEDRG",111,0)
DEL ;
"RTN","PSIVEDRG",112,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN S X="" I %'=1 W "  <NOTHING DELETED>"
"RTN","PSIVEDRG",113,0)
 Q
"RTN","PSIVEDRG",114,0)
GTADSOL ;Prompt for an ad/sol if there were multiple ad/sol matched to an OI
"RTN","PSIVEDRG",115,0)
 ;PSIVOI array is defined in GTIVDRG^PSIVORC2
"RTN","PSIVEDRG",116,0)
 NEW DIR,ND,X,Y
"RTN","PSIVEDRG",117,0)
 S DIR(0)="LA^1:"_+PSIVOI("DILIST",0)
"RTN","PSIVEDRG",118,0)
 S DIR("?")="Please select "_$S(PSIVOI="AD":"an Additive or Quick Code",1:"a Solution")_" from the list"
"RTN","PSIVEDRG",119,0)
 F X=0:0 S X=$O(PSIVOI("DILIST",X)) Q:'X  D
"RTN","PSIVEDRG",120,0)
 . S DIR("A",X)="  "_X_"  "_$S($P(PSIVOI("DILIST",X,0),U,4)="QC":"  - "_$P(PSIVOI("DILIST",X,0),U,2)_" -",1:$P(PSIVOI("DILIST",X,0),U,2))_$S(PSIVOI="SOL":"  "_$P(PSIVOI("DILIST",X,0),U,3),1:"")
"RTN","PSIVEDRG",121,0)
 S DIR("A")="Select (1 - "_+PSIVOI("DILIST",0)_"): "
"RTN","PSIVEDRG",122,0)
 D ^DIR
"RTN","PSIVEDRG",123,0)
 I +Y D
"RTN","PSIVEDRG",124,0)
 . NEW PSIVOIND S PSIVOIND=PSIVOI("DILIST",+Y,0)
"RTN","PSIVEDRG",125,0)
 . W "  "_$P(PSIVOIND,U,2)_$S(PSIVOI="SOL":"  "_$P(PSIVOIND,U,3),1:"")
"RTN","PSIVEDRG",126,0)
 . S ND=$G(^PS($S(PSIVOI="AD":52.6,1:52.7),+PSIVOIND,0))
"RTN","PSIVEDRG",127,0)
 . S DRG(PSIVOI,0)=1
"RTN","PSIVEDRG",128,0)
 . S DRG(PSIVOI,1)=+PSIVOIND_U_$P(ND,U)_U_$S(PSIVOI="SOL":$P(ND,U,3),1:"")_U_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSIVEDRG",129,0)
 . S DRGI=1 D SETDRG
"RTN","PSIVEDRG",130,0)
 . I $P(PSIVOI("DILIST",+Y,0),U,4)="QC",DRGT="AD",$D(^PS(52.6,"C",$P(PSIVOI("DILIST",+Y,0),U,2),+PSIVOI("DILIST",+Y,0))) D   Q:$G(PSIVSTR)="QUICK CODE"!$G(PSGORQF)
"RTN","PSIVEDRG",131,0)
 .. S (X,PSIVX)=$P(PSIVOI("DILIST",+Y,0),U,2),(PSJIVIEN,Y)=+PSIVOI("DILIST",+Y,0) D
"RTN","PSIVEDRG",132,0)
 ... N PSJNF D NFIV^PSJDIN(52.6,+PSJIVIEN,.PSJNF) W PSJNF("NF")
"RTN","PSIVEDRG",133,0)
 ... S DRGTMP=DRG(DRGT,1)
"RTN","PSIVEDRG",134,0)
 ... I '$D(ON55) N ON55 S ON55=ON
"RTN","PSIVEDRG",135,0)
 ... D ORDERCHK(DFN,ON55,1) I $G(PSGORQF) S X=U,DONE=1 Q
"RTN","PSIVEDRG",136,0)
 ... D DINIV^PSJDIN(52.6,+DRGTMP)
"RTN","PSIVEDRG",137,0)
 ... D ^PSIVQUI
"RTN","PSIVEDRG",138,0)
 . I $P(PSIVOI("DILIST",+Y,0),U,4)'="QC" S DRGTMP=DRG(DRGT,1) D ORDERCHK(DFN,ON55,1) I $G(PSGORQF) S X=U,DONE=1 Q
"RTN","PSIVEDRG",139,0)
 . I PSIVOI="AD" D
"RTN","PSIVEDRG",140,0)
 .. N FIL S FIL=52.6 D DRG3
"RTN","PSIVEDRG",141,0)
 K PSIVOI
"RTN","PSIVEDRG",142,0)
 Q
"RTN","PSIVEDT")
0^40^B49813774
"RTN","PSIVEDT",1,0)
PSIVEDT ;BIR/MLM-EDIT IV ORDER ;10 Feb 98 / 3:23 PM
"RTN","PSIVEDT",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**4,110,127,133,134,181**;16 DEC 97;Build 190
"RTN","PSIVEDT",3,0)
 ;
"RTN","PSIVEDT",4,0)
 ; Reference to ^DD(53.1 is supported by DBIA 2256.
"RTN","PSIVEDT",5,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVEDT",6,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSIVEDT",7,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSIVEDT",8,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSIVEDT",9,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVEDT",10,0)
 ;
"RTN","PSIVEDT",11,0)
EDIT ;
"RTN","PSIVEDT",12,0)
 ;Store the DRG array.  If it changed then to do an OC
"RTN","PSIVEDT",13,0)
 NEW TMPDRG,PSJFLG57
"RTN","PSIVEDT",14,0)
 D SAVEDRG^PSIVEDRG(.TMPDRG,.DRG)
"RTN","PSIVEDT",15,0)
 I $G(DFN)&($G(PSJORD)["V") I $$COMPLEX^PSJOE(DFN,PSJORD) D
"RTN","PSIVEDT",16,0)
 . N X,Y,PARENT,P2ND S P2ND=$S($G(^PS(55,PSGP,"IV",+PSJORD,.2)):$G(^PS(55,PSGP,"IV",+PSJORD,.2)),1:$G(^PS(55,PSGP,5,+PSJORD,.2)))
"RTN","PSIVEDT",17,0)
 . S PARENT=$P(P2ND,"^",8)
"RTN","PSIVEDT",18,0)
 . I PARENT D FULL^VALM1 W !!?5,"This order is part of a complex order. Please review the following ",!?5,"associated orders before changing this order." D CMPLX^PSJCOM1(PSGP,PARENT,PSJORD)
"RTN","PSIVEDT",19,0)
 S DONE=0
"RTN","PSIVEDT",20,0)
 F PSIVE=1:1 S:DONE&$E(PSIVAC)="C" OREND=1 Q:PSIVE>$L(EDIT,U)!(DONE)  Q:'$L($P(EDIT,U,PSIVE))  D @($P(EDIT,U,PSIVE)) S:$E(PSIVAC,2)="N" PSIVOK=PSIVOK_U_$P(EDIT,U,PSIVE) I $E(X)=U,$L(X)>1 S:PSIVE>1 PSIVE=PSIVE-1 F  D FF Q:Y<0  D @Y Q:$E(X)'=U
"RTN","PSIVEDT",21,0)
 I $G(PSJOCCHK) K PSJOCCHK D OC^PSIVOC
"RTN","PSIVEDT",22,0)
 K EDIT,PSIVOK,PSGDI
"RTN","PSIVEDT",23,0)
 ;If quit then restore DRG( to pre-edit state
"RTN","PSIVEDT",24,0)
 I $G(PSGORQF) D SAVEDRG^PSIVEDRG(.DRG,.TMPDRG)
"RTN","PSIVEDT",25,0)
 Q
"RTN","PSIVEDT",26,0)
 ;
"RTN","PSIVEDT",27,0)
1 ; Provider.
"RTN","PSIVEDT",28,0)
 I $G(P("RES"))="R" I $G(PSJORD)["P",$P($G(^PS(53.1,+$G(ON),0)),"^",24)="R" D  Q
"RTN","PSIVEDT",29,0)
 . W !!?5,"This is Renewal order. Provider may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",30,0)
 I $G(DFN)&($G(ON)["V") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT",31,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Provider may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",32,0)
 S P(6)=$S('$G(^VA(200,+P(6),"PS")):"",'$P(^("PS"),U,4):P(6),$P(^("PS"),U,4)<DT:"",1:P(6))
"RTN","PSIVEDT",33,0)
 W !,"PROVIDER: "_$S($P(P(6),U,2)]"":$P(P(6),U,2)_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $E(X)=U!(X=""&P(6)) Q
"RTN","PSIVEDT",34,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS^PSIVEDT1 G 1
"RTN","PSIVEDT",35,0)
 I X]"" K DIC S DIC=200,DIC(0)="EQMZ",DIC("S")="I $D(^(""PS"")),^(""PS""),$S('$P(^(""PS""),U,4):1,$P(^(""PS""),U,4)>DT:1,1:0)" D ^DIC K DIC I Y>0 S P(6)=+Y_U_Y(0,0) Q
"RTN","PSIVEDT",36,0)
 S F1=53.1,F2=1 D ENHLP^PSIVORC1 W $C(7),!!,"A Provider must be entered.",!! G 1
"RTN","PSIVEDT",37,0)
 Q
"RTN","PSIVEDT",38,0)
 ;
"RTN","PSIVEDT",39,0)
3 ; Med Route.
"RTN","PSIVEDT",40,0)
 I $G(P("RES"))="R" I $G(PSJORD)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT",41,0)
 . W !!?5,"Med Route may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",42,0)
 I $G(DFN)&($G(ON)["V") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT",43,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Med Route may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",44,0)
 S P(6)=$S('$G(^VA(200,+P(6),"PS")):"",'$P(^("PS"),U,4):P(6),$P(^("PS"),U,4)<DT:"",1:P(6))
"RTN","PSIVEDT",45,0)
 I P("MR")="" D
"RTN","PSIVEDT",46,0)
 .N AD,SOL,OI,RT,RTCNT
"RTN","PSIVEDT",47,0)
 .S AD=0 F  S AD=$O(DRG("AD",AD)) Q:'AD  S OI=$P(DRG("AD",AD),"^",6) I OI S OI(OI)=""
"RTN","PSIVEDT",48,0)
 .S SOL=0 F  S SOL=$O(DRG("SOL",SOL)) Q:'SOL  S OI=$P(DRG("SOL",SOL),"^",6) I OI S OI(OI)=""
"RTN","PSIVEDT",49,0)
 .S OI="" F  S OI=$O(OI(OI)) Q:'OI  S RT=$P(^PS(50.7,OI,0),"^",6) S:RT="" RT="NONE" S RT(RT)=$P($G(^PS(51.2,+RT,0)),"^",3)
"RTN","PSIVEDT",50,0)
 .S RT="" F RTCNT=0:1 S RT=$O(RT(RT)) Q:RT=""
"RTN","PSIVEDT",51,0)
 .Q:RTCNT>1
"RTN","PSIVEDT",52,0)
 .S RT=$O(RT("")) I RT]"" S P("MR")=RT_"^"_$G(RT(RT))
"RTN","PSIVEDT",53,0)
 W !,"MED ROUTE: "_$S($P(P("MR"),U,2)]"":$P(P("MR"),U,2)_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I X=U!(X=""&P("MR"))!($E(X)=U) Q
"RTN","PSIVEDT",54,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS^PSIVEDT1 G 3
"RTN","PSIVEDT",55,0)
 I X]"" K DIC S DIC=51.2,DIC(0)="EQMZ",DIC("S")="I $P(^(0),U,4)" D ^DIC K DIC I Y>0 S P("MR")=+Y_U_$P(Y(0),U,3) Q
"RTN","PSIVEDT",56,0)
 S F1=53.1,F2=3 D ENHLP^PSIVORC1 W $C(7),!!,"A Med Route must be entered." G 3
"RTN","PSIVEDT",57,0)
 Q
"RTN","PSIVEDT",58,0)
 ;
"RTN","PSIVEDT",59,0)
10 ; Start Date.
"RTN","PSIVEDT",60,0)
 D 10^PSIVEDT1
"RTN","PSIVEDT",61,0)
 Q
"RTN","PSIVEDT",62,0)
 ;
"RTN","PSIVEDT",63,0)
25 ; Stop Date.
"RTN","PSIVEDT",64,0)
 D 25^PSIVEDT1
"RTN","PSIVEDT",65,0)
 Q
"RTN","PSIVEDT",66,0)
26 ; Schedule
"RTN","PSIVEDT",67,0)
 D 26^PSIVEDT1
"RTN","PSIVEDT",68,0)
 Q
"RTN","PSIVEDT",69,0)
 ;
"RTN","PSIVEDT",70,0)
39 ; Admin Times.
"RTN","PSIVEDT",71,0)
 D 39^PSIVEDT1
"RTN","PSIVEDT",72,0)
 Q
"RTN","PSIVEDT",73,0)
 ;
"RTN","PSIVEDT",74,0)
57 ; Additive.
"RTN","PSIVEDT",75,0)
 I $G(P("RES"))="R" I $G(PSJORD)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT",76,0)
 . W !!?5,"Additive may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",77,0)
 I $G(DFN)&($G(ON)["V") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT",78,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Provider may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",79,0)
 I $E(PSIVAC)="O" W !!,"Only additives marked for use in IV Fluid Order Entry may be selected."
"RTN","PSIVEDT",80,0)
 S FIL=52.6,DRGT="AD",DRGTN="ADDITIVE" D DRG^PSIVEDRG,DKILL
"RTN","PSIVEDT",81,0)
 ;I $G(X)="^" G DKILL
"RTN","PSIVEDT",82,0)
 ;If Solution prompt is next then wait to do dose checks after all solutions are entered.
"RTN","PSIVEDT",83,0)
 ;PSJFLG57 is set so OC is triggered when the user entered ^ADDITIVE.
"RTN","PSIVEDT",84,0)
 ;I $G(X)']"^",($$COMPARE^PSJMISC(.DRG,.TMPDRG)),($G(EDIT)'["58") D OC^PSIVOC
"RTN","PSIVEDT",85,0)
 I $$COMPARE^PSJMISC(.DRG,.TMPDRG),$S($G(PSJFLG57):1,($G(EDIT)'["58"):1,1:0) K PSJFLG57,PSJOCCHK D OC^PSIVOC
"RTN","PSIVEDT",86,0)
 I $G(X)="^" G DKILL
"RTN","PSIVEDT",87,0)
 Q
"RTN","PSIVEDT",88,0)
 ;
"RTN","PSIVEDT",89,0)
58 ; Solution.
"RTN","PSIVEDT",90,0)
 NEW PSJCMPFG
"RTN","PSIVEDT",91,0)
 I $G(P("RES"))="R" I $G(PSJORD)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT",92,0)
 . W !!?5,"Solution may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",93,0)
 S FIL=52.7,DRGT="SOL",DRGTN="SOLUTION" D DRG^PSIVEDRG
"RTN","PSIVEDT",94,0)
 ;I $G(X)="^" G DKILL
"RTN","PSIVEDT",95,0)
 ;I $G(X)']"^",$$COMPARE^PSJMISC(.DRG,.TMPDRG) D OC^PSIVOC
"RTN","PSIVEDT",96,0)
 S PSJCMPFG=$$COMPARE^PSJMISC(.DRG,.TMPDRG)
"RTN","PSIVEDT",97,0)
 I 'PSJCMPFG,$$COMPARE^PSJMISC(.DRG,.TMPDRG,1) D
"RTN","PSIVEDT",98,0)
 . NEW X,PSJALLGY
"RTN","PSIVEDT",99,0)
 . K PSJALLGY
"RTN","PSIVEDT",100,0)
 . D SETDD^PSIVOC(1)
"RTN","PSIVEDT",101,0)
 . D GMRAOC^PSJOC
"RTN","PSIVEDT",102,0)
 . K PSJALLGY
"RTN","PSIVEDT",103,0)
 I PSJCMPFG K PSJOCCHK D OC^PSIVOC
"RTN","PSIVEDT",104,0)
 K PSJCMPFG
"RTN","PSIVEDT",105,0)
 I $G(X)="^" G DKILL
"RTN","PSIVEDT",106,0)
 ;
"RTN","PSIVEDT",107,0)
DKILL ; Kill for drug edit.
"RTN","PSIVEDT",108,0)
 K DRGI,DRGN,DRGT,DRGTN,FIL,PSIVSTR
"RTN","PSIVEDT",109,0)
 Q
"RTN","PSIVEDT",110,0)
 ;
"RTN","PSIVEDT",111,0)
59 ; Infusion Rate.
"RTN","PSIVEDT",112,0)
 D 59^PSIVEDT1
"RTN","PSIVEDT",113,0)
 Q
"RTN","PSIVEDT",114,0)
 ;
"RTN","PSIVEDT",115,0)
62 ; IV Room.
"RTN","PSIVEDT",116,0)
 N DIR S DIR(0)="PA^59.5",DIR("A")="IV Room: ",DIR("??")="^S F1=59.5,F2=.01 D ENHLP^PSIVORC1" S:P("IVRM") DIR("B")=$P(P("IVRM"),U,2)
"RTN","PSIVEDT",117,0)
 D ^DIR Q:$D(DIRUT)  I Y>0 S P("IVRM")=Y W $P($P(Y,U,2),X,2)
"RTN","PSIVEDT",118,0)
 Q
"RTN","PSIVEDT",119,0)
 ;
"RTN","PSIVEDT",120,0)
63 ; Remarks.
"RTN","PSIVEDT",121,0)
 D 63^PSIVEDT1
"RTN","PSIVEDT",122,0)
 Q
"RTN","PSIVEDT",123,0)
 ;
"RTN","PSIVEDT",124,0)
64 ; Other Print Info.
"RTN","PSIVEDT",125,0)
 D 64^PSIVEDT1
"RTN","PSIVEDT",126,0)
 Q
"RTN","PSIVEDT",127,0)
 ;
"RTN","PSIVEDT",128,0)
66 ; Provider's comments.
"RTN","PSIVEDT",129,0)
 N DA,DIE,DIR S DA=PSIVUP,DIE="^PS(53.45,",DR=4 D ^DIE S PSGSI=X,Y=1
"RTN","PSIVEDT",130,0)
 Q
"RTN","PSIVEDT",131,0)
 ;
"RTN","PSIVEDT",132,0)
101 ; Orderable Item.
"RTN","PSIVEDT",133,0)
 I $G(P("RES"))="R" I $G(PSJORD)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT",134,0)
 . W !!?5,"This is Renewal order. Orderable Item may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",135,0)
 I $G(DFN)&($G(ON)["V") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT",136,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Orderable Item may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",137,0)
 W !,"Orderable Item: "_$S(P("PD"):$P(P("PD"),U,2)_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $E(X)=U!(X=""&P("PD")) Q
"RTN","PSIVEDT",138,0)
 I X]"" N DIC S DIC="^PS(50.7,",DIC(0)="EMQZ",DIC("B")=$S(P("PD")]"":+$P(("PD"),U),1:""),DIC("S")="S PSJSCT=1 I $$DRGSC^PSIVUTL(Y,PSJSCT) K PSJSCT" D ^DIC K DIC I Y>0 S P("PD")=Y Q
"RTN","PSIVEDT",139,0)
 W $C(7),!!,"Orderable Item is required!",!! G 101
"RTN","PSIVEDT",140,0)
 Q
"RTN","PSIVEDT",141,0)
109 ; Dosage Ordered.
"RTN","PSIVEDT",142,0)
 W !,"DOSAGE ORDERED: "_$S(P("DO")]"":P("DO")_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $E(X)=U!(P("DO")]""&(X="")) Q
"RTN","PSIVEDT",143,0)
 I X="???" D ORFLDS^PSIVEDT1 G 109
"RTN","PSIVEDT",144,0)
 D:X]"" CHK^DIE(53.1,109,"",X,.X) I $G(X)="^" W $C(7),!!,"Enter the dosage in which the Orderable Item entered should be dispensed.",! W "Answer must be 1-20 characters in length." G 109
"RTN","PSIVEDT",145,0)
 S P("DO")=X
"RTN","PSIVEDT",146,0)
 Q
"RTN","PSIVEDT",147,0)
 ;
"RTN","PSIVEDT",148,0)
FF ; up-arrow to another field.
"RTN","PSIVEDT",149,0)
 N DIC S X=$P(X,U,2),DIC="^DD(53.1,",DIC(0)="QEM",DIC("S")="I U_PSIVOK_U[(U_+Y_U)" D ^DIC K DIC S Y=+Y
"RTN","PSIVEDT",150,0)
 I Y=57 S PSJFLG57=1
"RTN","PSIVEDT",151,0)
 Q
"RTN","PSIVEDT",152,0)
 ;
"RTN","PSIVEDT",153,0)
NEWDRG ; Ask if adding a new drug.
"RTN","PSIVEDT",154,0)
 K DIR S DIR(0)="Y",DIR("A")="Are you adding "_$P(TDRG,U,2)_" as a new "_$S(DRGT="AD":"additive",1:"solution")_" for this order",DIR("B")="NO" D ^DIR I $D(DTOUT)!$D(DUOUT) Q
"RTN","PSIVEDT",155,0)
 I Y S (DRGI,DRG(DRGT,0))=DRG(DRGT,0)+1,DRG=TDRG,DRG(DRGT,+DRGI)=+DRG_U_$P(DRG,U,2) I DRGT="SOL" S X=$G(^PS(52.7,+DRG,0)),$P(DRG(DRGT,DRG),U,3)=$P(X,U,3)
"RTN","PSIVEDT",156,0)
 Q
"RTN","PSIVOC")
0^41^B12227272
"RTN","PSIVOC",1,0)
PSIVOC ;BIR/MV - NEW ORDER CHECKS DRIVER ;6 Jun 07 / 3:37 PM
"RTN","PSIVOC",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**181**;16 DEC 97;Build 190
"RTN","PSIVOC",3,0)
 ;
"RTN","PSIVOC",4,0)
 ; Reference to ^PSSDSAPI is supported by DBIA #5425.
"RTN","PSIVOC",5,0)
 ;
"RTN","PSIVOC",6,0)
OC ;
"RTN","PSIVOC",7,0)
 ;Setup input drug list in PSPDRG array for IV order check (DD, DT). DRG array is expected
"RTN","PSIVOC",8,0)
 NEW FIL,PSIVIEN,PSIVNM,PSIVAS,PSIVX,PSJCNT,PSJDD,PSJDSE,PSJO,PSJORIEN,PSPDRG,TMPDRG1,PSJALLGY
"RTN","PSIVOC",9,0)
 ;If OC already done when FN action was used to finish pending IV, the K PSJOCCHK to ensure OC is not trigger again when edit on non * field
"RTN","PSIVOC",10,0)
 K PSGORQF,PSIVEDIT,PSJALLGY,PSJOCCHK
"RTN","PSIVOC",11,0)
 ;The variable PSIVEDIT is set in ^PSJLIFN.  If the finishing IV order without editing, the OC will get 
"RTN","PSIVOC",12,0)
 ;triggered. Otherwise ^PSIVEDT will set off the OC.
"RTN","PSIVOC",13,0)
 ;
"RTN","PSIVOC",14,0)
 ;^PSOBUILD kills the DRG array.  The SAVEDRG will store DRG in temp and restore it as it's done /w OC.
"RTN","PSIVOC",15,0)
 D SAVEDRG^PSIVEDRG(.TMPDRG1,.DRG) ;Store DRG array in TMPDRG array
"RTN","PSIVOC",16,0)
 K ^TMP($J,"PSJPRE")
"RTN","PSIVOC",17,0)
 D SETDD()
"RTN","PSIVOC",18,0)
 ;Reset PSPDRG(n)=DD ien ^ Add/Sol name _ Unit
"RTN","PSIVOC",19,0)
 D NMUNIT
"RTN","PSIVOC",20,0)
 ;Perform enhance OC
"RTN","PSIVOC",21,0)
 I $O(PSPDRG(0)) D OC^PSJOC(.PSPDRG,"I;"_$G(ON55))
"RTN","PSIVOC",22,0)
 I '$O(PSPDRG(0)) D GMRAOC^PSJOC
"RTN","PSIVOC",23,0)
 D SAVEDRG^PSIVEDRG(.DRG,.TMPDRG1) ;Restore DRG array from TMPDRG array
"RTN","PSIVOC",24,0)
 I $G(PSGORQF) S X=U,DONE=1
"RTN","PSIVOC",25,0)
 Q
"RTN","PSIVOC",26,0)
DRGADD() ;Add the strength(no bottle only)/volume together for the same drug
"RTN","PSIVOC",27,0)
 ;PSJFLG = Return 1 if it's the same drug
"RTN","PSIVOC",28,0)
 I PSIVAS="SOL" Q 0
"RTN","PSIVOC",29,0)
 NEW PSJFLG,PSJDD0,X,PSJSTVOL,PSJBOT1,PSJSVOL1,PSJSVOL2,PSJUNIT1,PSJUNIT2
"RTN","PSIVOC",30,0)
 S PSJFLG=0
"RTN","PSIVOC",31,0)
 F X=0:0 S X=$O(PSPDRG(X)) Q:'X  S PSJDD0=PSPDRG(X) D  Q:PSJFLG
"RTN","PSIVOC",32,0)
 . I $P(PSJDD0,U,4)]"" Q
"RTN","PSIVOC",33,0)
 . S PSJBOT1=$P(DRG(PSIVAS,PSIVX),U,4)
"RTN","PSIVOC",34,0)
 . S PSJSVOL1=$P(DRG(PSIVAS,PSIVX),U,3)
"RTN","PSIVOC",35,0)
 . S PSJSVOL2=$P(PSJDD0,U,3)
"RTN","PSIVOC",36,0)
 . S PSJUNIT1=$P(PSJSVOL1," ",2)
"RTN","PSIVOC",37,0)
 . S PSJUNIT2=$P(PSJSVOL2," ",2)
"RTN","PSIVOC",38,0)
 . I (+PSJDD0=PSJDD),(PSJBOT1=""),(PSJUNIT1=PSJUNIT2) D
"RTN","PSIVOC",39,0)
 .. S PSJSTVOL=(+PSJSVOL1)+(+PSJSVOL2)
"RTN","PSIVOC",40,0)
 .. S $P(PSPDRG(X),U,3)=PSJSTVOL_" "_PSJUNIT1
"RTN","PSIVOC",41,0)
 .. S PSJFLG=1
"RTN","PSIVOC",42,0)
 Q PSJFLG
"RTN","PSIVOC",43,0)
NMUNIT ;Combine name & unit to 2nd piece
"RTN","PSIVOC",44,0)
 NEW PSJDD0,X
"RTN","PSIVOC",45,0)
 F X=0:0 S X=$O(PSPDRG(X)) Q:'X  S PSJDD0=PSPDRG(X) D
"RTN","PSIVOC",46,0)
 . S $P(PSJDD0,U,2)=$P(PSJDD0,U,2)_" "_$P(PSJDD0,U,3)
"RTN","PSIVOC",47,0)
 . S $P(PSJDD0,U,3,4)=""
"RTN","PSIVOC",48,0)
 . S PSPDRG(X)=PSJDD0
"RTN","PSIVOC",49,0)
 Q
"RTN","PSIVOC",50,0)
SETDD(PSJOCDS) ;
"RTN","PSIVOC",51,0)
 ;PSJOCDS - Set to 1 if doing a dosing checks
"RTN","PSIVOC",52,0)
 NEW PSJCNT,PSIVAS,FIL,PSIVX,PSIVIEN,PSJDUNIT
"RTN","PSIVOC",53,0)
 K PSIVDDSV
"RTN","PSIVOC",54,0)
 S PSJCNT=0
"RTN","PSIVOC",55,0)
 F PSIVAS="AD","SOL" S FIL=$S(PSIVAS="AD":52.6,1:52.7) D
"RTN","PSIVOC",56,0)
 . F PSIVX=0:0 S PSIVX=$O(DRG(PSIVAS,PSIVX)) Q:'PSIVX!($G(PSGORQF))  D
"RTN","PSIVOC",57,0)
 .. S PSIVIEN=$P(DRG(PSIVAS,PSIVX),U)
"RTN","PSIVOC",58,0)
 .. S PSJDD=$$IVDDRG^PSJMISC(PSIVAS,PSIVIEN)
"RTN","PSIVOC",59,0)
 .. S PSJALLGY(PSJDD)=""
"RTN","PSIVOC",60,0)
 .. S PSIVNM=$P(DRG(PSIVAS,PSIVX),U,2)_U_$P(DRG(PSIVAS,PSIVX),U,3)
"RTN","PSIVOC",61,0)
 .. ;if it is not a premix, don't add to the prospective list
"RTN","PSIVOC",62,0)
 .. I PSIVAS="SOL" D  Q:'$$PREMIX^PSJMISC(PSIVIEN)
"RTN","PSIVOC",63,0)
 ... S PSIVDDSV("TOT_VOL")=$G(PSIVDDSV("TOT_VOL"))+$P(DRG(PSIVAS,PSIVX),U,3)
"RTN","PSIVOC",64,0)
 .. ;If same drug then add the strength/volume together
"RTN","PSIVOC",65,0)
 .. Q:$$DRGADD()
"RTN","PSIVOC",66,0)
 .. D NONDS
"RTN","PSIVOC",67,0)
 D:$G(PSJOCDS) DS
"RTN","PSIVOC",68,0)
 Q
"RTN","PSIVOC",69,0)
NONDS ;Set dispense drug list for DD, & DT (screen out supply items)
"RTN","PSIVOC",70,0)
 ;PSPDRG(n) here has 4 pieces - DD ien ^ Add/Sol Name ^ Dose & Unit ^ bottle #
"RTN","PSIVOC",71,0)
 I '$G(PSJOCDS),$$SUP^PSSDSAPI(PSJDD) Q
"RTN","PSIVOC",72,0)
 I $G(PSJOCDS),$$EXMT^PSSDSAPI(PSJDD) Q
"RTN","PSIVOC",73,0)
 S PSJCNT=PSJCNT+1
"RTN","PSIVOC",74,0)
 S PSPDRG(PSJCNT)=PSJDD_U_PSIVNM_U_$P(DRG(PSIVAS,PSIVX),U,4)_$S($G(PSJOCDS):"^"_PSIVAS,1:"")
"RTN","PSIVOC",75,0)
 Q
"RTN","PSIVOC",76,0)
DS ;Set PSIVDDSV array for the dose check (screen out dose exempted items)
"RTN","PSIVOC",77,0)
 ;PSIVDDSV= see def in ^PSIVOCDS
"RTN","PSIVOC",78,0)
 NEW PSJX,PSJX0,PSJDOSE,PSJUNIT,PSJUNIT1
"RTN","PSIVOC",79,0)
 F PSJX=0:0 S PSJX=$O(PSPDRG(PSJX)) Q:'PSJX  D
"RTN","PSIVOC",80,0)
 . S PSJX0=$G(PSPDRG(PSJX))
"RTN","PSIVOC",81,0)
 . S PSJDOSE=+$P(PSJX0,U,3)
"RTN","PSIVOC",82,0)
 . S PSJUNIT1=$P($P(PSJX0,U,3)," ",2)
"RTN","PSIVOC",83,0)
 . S PSJUNIT=$$UNIT^PSSDSAPI(PSJUNIT1)
"RTN","PSIVOC",84,0)
 . S:$P(PSJX0,U,5)]"" PSIVDDSV($P(PSJX0,U,5),PSJX)=$P(PSJX0,U)_U_$P(PSJX0,U,2)_U_$P(PSJX0,U,3)_U_$P(PSJX0,U,4)_U_U_U_U_PSJDOSE_U_PSJUNIT
"RTN","PSIVOC",85,0)
 Q
"RTN","PSIVOCDS")
0^67^B112584128
"RTN","PSIVOCDS",1,0)
PSIVOCDS ;BIR/MV - PROCESS DOSING ORDER CHECKS FOR IV;6 Jun 07 / 3:37 PM
"RTN","PSIVOCDS",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**181**;16 DEC 97;Build 190
"RTN","PSIVOCDS",3,0)
 ;
"RTN","PSIVOCDS",4,0)
 ; Reference to ^PS(51.1 is supported by DBIA #2177
"RTN","PSIVOCDS",5,0)
 ; Reference to ^PSDRUG is supported by DBIA #2192.
"RTN","PSIVOCDS",6,0)
 ; Reference to ^PSSDSAPI is supported by DBIA #5425.
"RTN","PSIVOCDS",7,0)
 ; Reference to ^PSSFDBRT is supported by DBIA #5496.
"RTN","PSIVOCDS",8,0)
 ; Reference to $$CONV^PSSDSAPK is supported by DBIA #5497.
"RTN","PSIVOCDS",9,0)
 ;
"RTN","PSIVOCDS",10,0)
IN(PSJBASE) ;
"RTN","PSIVOCDS",11,0)
 ;PSJBASE - Base(Literal value for TMP global)- Required
"RTN","PSIVOCDS",12,0)
 ;PSIVDDSV(AD/SOL,CNT)=P1..P9
"RTN","PSIVOCDS",13,0)
 ; P1=Drug IEN; P2=Dspl name(add/sol or CPRS OI; P3=Numeric dose & unit; P4=Bottle #
"RTN","PSIVOCDS",14,0)
 ; P5=""; P6=""; P7=""; P8=Strength/Vol; P9=Unit
"RTN","PSIVOCDS",15,0)
 ;
"RTN","PSIVOCDS",16,0)
 ;These two flags below are set when stuff freq, duration to 1 & Duration rate = dose rate
"RTN","PSIVOCDS",17,0)
 ;They are used by the output routine to generate the appropriate output messages.
"RTN","PSIVOCDS",18,0)
 ;PSJFDB(PSJCNT,"INF_ERROR")="" & PSJFDB(PSJCNT,"FRQ_ERROR")=""
"RTN","PSIVOCDS",19,0)
 ;
"RTN","PSIVOCDS",20,0)
 NEW ON,PSJCNT,PSJCNTX,PSJONEFG,PSJRT,PSIVAS,PSIVAS0,PSIVDDSV,PSPDRG,PSJALLGY,X,PSJP8,PSJP8NUM,PSJP8UNT,PSJP8TME,PSJOIX
"RTN","PSIVOCDS",21,0)
 K PSJOCDS,PSJFDB,PSIVDDSV,PSPDRG,PSJALLGY
"RTN","PSIVOCDS",22,0)
 S PSJCNT=0
"RTN","PSIVOCDS",23,0)
 S PSJRT=$P($$MRT^PSSDSAPI(+P("MR")),U,2)
"RTN","PSIVOCDS",24,0)
 ;Set Flag to indicate CPRS OI had no active AD/SOL.
"RTN","PSIVOCDS",25,0)
 S PSJOIX="" F  S PSJOIX=$O(PSJIV("OI_ERROR",PSJOIX)) Q:PSJOIX=""  D
"RTN","PSIVOCDS",26,0)
 . S PSJCNT=PSJCNT+1
"RTN","PSIVOCDS",27,0)
 . S PSJFDB(PSJCNT,"RX_NUM")="I;;PROSPECTIVE;"_PSJCNT
"RTN","PSIVOCDS",28,0)
 . S PSJFDB(PSJCNT,"DRUG_NM")=PSJOIX
"RTN","PSIVOCDS",29,0)
 . S PSJFDB(PSJCNT,"OI")=$P(PSJIV("OI_ERROR",PSJOIX),U,2)
"RTN","PSIVOCDS",30,0)
 . S PSJFDB(PSJCNT,"OI_ERROR",PSJOIX)=$P(PSJIV("OI_ERROR",PSJOIX),U)_U_"I;;PROSPECTIVE;"_PSJCNT
"RTN","PSIVOCDS",31,0)
 D SETDD^PSIVOC(1)
"RTN","PSIVOCDS",32,0)
 I ($G(PSIVDDSV("TOT_VOL"))=""),($G(PSJIV("TOT_VOL"))]"") S PSIVDDSV("TOT_VOL")=PSJIV("TOT_VOL")
"RTN","PSIVOCDS",33,0)
 F PSIVAS="AD","SOL" F PSJCNTX=0:0 S PSJCNTX=$O(PSIVDDSV(PSIVAS,PSJCNTX)) Q:'PSJCNTX  D
"RTN","PSIVOCDS",34,0)
 . S PSIVAS0=$G(PSIVDDSV(PSIVAS,PSJCNTX))
"RTN","PSIVOCDS",35,0)
 . I PSIVAS="SOL" S X=$$LITER($P(PSIVAS0,U,8)) I X]"" D
"RTN","PSIVOCDS",36,0)
 .. S $P(PSIVAS0,U,8)=$P(X,U)
"RTN","PSIVOCDS",37,0)
 .. S $P(PSIVAS0,U,9)=$P(X,U,2)
"RTN","PSIVOCDS",38,0)
 . S PSJCNT=PSJCNT+1
"RTN","PSIVOCDS",39,0)
 . D COMMON
"RTN","PSIVOCDS",40,0)
 . I P("DTYP")=1 D IVPB
"RTN","PSIVOCDS",41,0)
 . I P("DTYP")>1 D IV
"RTN","PSIVOCDS",42,0)
 Q
"RTN","PSIVOCDS",43,0)
IV ;Setup input data for Continuous IV (admixture, hyperal)
"RTN","PSIVOCDS",44,0)
 NEW PSJXRT,PSJP8ERR
"RTN","PSIVOCDS",45,0)
 S PSJP8=$$P8^PSJMISC2(P(8))
"RTN","PSIVOCDS",46,0)
 D BASIC
"RTN","PSIVOCDS",47,0)
 ;I PSJP8="" D FREEDOSE Q
"RTN","PSIVOCDS",48,0)
 S PSJP8NUM=+$P(PSJP8,U)
"RTN","PSIVOCDS",49,0)
 S PSJP8UNT=$P(PSJP8,U,2)
"RTN","PSIVOCDS",50,0)
 S PSJP8TME=$P(PSJP8,U,3)
"RTN","PSIVOCDS",51,0)
 ;All premix are using the "Continuous Infusion" Route logic. This is so Potassium gets both single
"RTN","PSIVOCDS",52,0)
 ;and max dosing checks.  Cisplatin premix won't work since FDB can't process as "Continuous Infusion"
"RTN","PSIVOCDS",53,0)
 I PSIVAS="SOL" D PREMIX Q
"RTN","PSIVOCDS",54,0)
 I PSJP8="" D FREEDOSE Q
"RTN","PSIVOCDS",55,0)
 S PSJXRT=$$RTESCRN(PSJRT)
"RTN","PSIVOCDS",56,0)
 I $$ISONEAD(),('$$CLASS(PSJFDB(PSJCNT,"DRUG_IEN"))),(PSJXRT'=0),$$FDBRT(PSJFDB(PSJCNT,"DRUG_IEN"),PSJXRT) D ONEAD(PSJXRT) Q
"RTN","PSIVOCDS",57,0)
 D CONTIV
"RTN","PSIVOCDS",58,0)
 Q
"RTN","PSIVOCDS",59,0)
IVPB ;Setup input data for Schedule IV
"RTN","PSIVOCDS",60,0)
 NEW X,PSJP9,PSJP15
"RTN","PSIVOCDS",61,0)
 S PSJOCDS(PSJCNT,"DRUG_AMT")=$P(PSIVAS0,U,8)
"RTN","PSIVOCDS",62,0)
 S PSJOCDS(PSJCNT,"DRUG_UNIT")=$P(PSIVAS0,U,9)
"RTN","PSIVOCDS",63,0)
 I '+$G(PSJIV("DUR")) D
"RTN","PSIVOCDS",64,0)
 . S X=$$DURATION()
"RTN","PSIVOCDS",65,0)
 . S PSJOCDS(PSJCNT,"DRATE")=$S(+X:X_"M",1:"")
"RTN","PSIVOCDS",66,0)
 I +$G(PSJIV("DUR"))<1440,(+$G(PSJIV("DUR"))>0) S PSJOCDS(PSJCNT,"DRATE")=PSJIV("DUR")
"RTN","PSIVOCDS",67,0)
 S PSJOCDS(PSJCNT,"MR_IEN")=+P("MR")
"RTN","PSIVOCDS",68,0)
 S PSJOCDS(PSJCNT,"DO")=""
"RTN","PSIVOCDS",69,0)
 S PSJOCDS(PSJCNT,"SCHEDULE")=P(9)
"RTN","PSIVOCDS",70,0)
 ;
"RTN","PSIVOCDS",71,0)
 S PSJFDB(PSJCNT,"DOSE_AMT")=$S('+$P(PSIVAS0,U,8):"",1:$P(PSIVAS0,U,8))
"RTN","PSIVOCDS",72,0)
 S PSJFDB(PSJCNT,"DOSE_RATE")="DAY"
"RTN","PSIVOCDS",73,0)
 S PSJFDB(PSJCNT,"DOSE_UNIT")=$P(PSIVAS0,U,9)
"RTN","PSIVOCDS",74,0)
 ;
"RTN","PSIVOCDS",75,0)
 S PSJONEFG=0
"RTN","PSIVOCDS",76,0)
 I $$ONE^PSJORPOE(P(9))!$$ONCALL^PSJMISC(P(9)) S PSJONEFG=1 D SINGLE Q
"RTN","PSIVOCDS",77,0)
 I +$G(PSJIV("DOSE_CNT")) S PSJFDB(PSJCNT,"FREQ")=$G(PSJIV("DOSE_CNT")) Q
"RTN","PSIVOCDS",78,0)
 I +$G(PSJOCDS(PSJCNT,"DRATE")) D UND24HRS^PSJOCDS(+PSJOCDS(PSJCNT,"DRATE"),$G(P(11)),$G(P(15)),$G(P(2)),$G(P(3)),$G(P(9))) Q
"RTN","PSIVOCDS",79,0)
 I 'PSJONEFG D
"RTN","PSIVOCDS",80,0)
 . S X="",PSJP9=P(9)
"RTN","PSIVOCDS",81,0)
 . S PSJP15=P(15)
"RTN","PSIVOCDS",82,0)
 . I (P(9)["PRN"),'$O(^PS(51.1,"AC","PSJ",P(9),0)) S PSJP15=""
"RTN","PSIVOCDS",83,0)
 . I P(15)="D",(P(11)]"") S $P(PSJP9,"@",2)=P(11)
"RTN","PSIVOCDS",84,0)
 . I P(9)]"" S X=$P($$FRQ^PSSDSAPI(PSJP9,PSJP15,"I"),U)
"RTN","PSIVOCDS",85,0)
 . I X="" S X=1 S PSJFDB(PSJCNT,"FRQ_ERROR")=""
"RTN","PSIVOCDS",86,0)
 . S PSJFDB(PSJCNT,"FREQ")=X
"RTN","PSIVOCDS",87,0)
 . S PSJFDB(PSJCNT,"DURATION")=1
"RTN","PSIVOCDS",88,0)
 . S PSJFDB(PSJCNT,"DURATION_RT")="DAY"
"RTN","PSIVOCDS",89,0)
 Q
"RTN","PSIVOCDS",90,0)
SINGLE ;Set fields needed for Single Dose type
"RTN","PSIVOCDS",91,0)
 ; Can't get FDB to return correct data for Continuous Infusion /w Single dose so all Continuous will be sent in as Maintenance.
"RTN","PSIVOCDS",92,0)
 I PSJFDB(PSJCNT,"ROUTE")=("CONTINUOUS INFUSION") Q
"RTN","PSIVOCDS",93,0)
 S PSJFDB(PSJCNT,"DOSE_TYPE")="SINGLE DOSE"
"RTN","PSIVOCDS",94,0)
 S PSJFDB(PSJCNT,"FREQ")=1
"RTN","PSIVOCDS",95,0)
 S PSJFDB(PSJCNT,"DURATION")=1
"RTN","PSIVOCDS",96,0)
 S PSJFDB(PSJCNT,"DURATION_RT")=PSJFDB(PSJCNT,"DOSE_RATE")
"RTN","PSIVOCDS",97,0)
 Q
"RTN","PSIVOCDS",98,0)
COMMON ;Set common data for all IV types
"RTN","PSIVOCDS",99,0)
 S PSJFDB(PSJCNT,"RX_NUM")="I;"_$G(PSJPON)_";PROSPECTIVE;"_PSJCNT
"RTN","PSIVOCDS",100,0)
 ;Set Flag to indicate CPRS OI had no active AD/SOL.
"RTN","PSIVOCDS",101,0)
 ;S PSJOIX="" F  S PSJOIX=$O(PSJIV("OI_ERROR",PSJOIX)) Q:PSJOIX=""  S PSJFDB("OI_ERROR",PSJOIX)=$P(PSJIV("OI_ERROR",PSJOIX),U)_U_PSJFDB(PSJCNT,"RX_NUM")
"RTN","PSIVOCDS",102,0)
 S PSJFDB(PSJCNT,"DRUG_IEN")=$P(PSIVAS0,U)
"RTN","PSIVOCDS",103,0)
 ;S PSJFDB(PSJCNT,"DRUG_IEN")=$$IVDDRG^PSJMISC(PSIVAS,$P(PSIVAS0,U))
"RTN","PSIVOCDS",104,0)
 S PSJFDB(PSJCNT,"DRUG_NM")=$P(PSIVAS0,U,2)_" "_$P(PSIVAS0,U,3)
"RTN","PSIVOCDS",105,0)
 S PSJFDB(PSJCNT,"DOSE_UNIT")=$P(PSIVAS0,U,9)
"RTN","PSIVOCDS",106,0)
 S PSJFDB(PSJCNT,"ROUTE")=PSJRT
"RTN","PSIVOCDS",107,0)
 S PSJFDB(PSJCNT,"DOSE_TYPE")="MAINTENANCE"
"RTN","PSIVOCDS",108,0)
 S PSJFDB(PSJCNT,"SPECIFIC")=1
"RTN","PSIVOCDS",109,0)
 ;This is set when CPRS sends Duration without entering a solution.
"RTN","PSIVOCDS",110,0)
 I $D(PSJIV("FRQ_ERROR")) S PSJFDB(PSJCNT,"FRQ_ERROR")="",PSJFDB(PSJCNT,"FREQ")=1
"RTN","PSIVOCDS",111,0)
 Q
"RTN","PSIVOCDS",112,0)
BASIC ;Set basic data for non schedule IVs
"RTN","PSIVOCDS",113,0)
 S PSJFDB(PSJCNT,"DOSE_RATE")="DAY"
"RTN","PSIVOCDS",114,0)
 S PSJFDB(PSJCNT,"FREQ")=""
"RTN","PSIVOCDS",115,0)
 S PSJFDB(PSJCNT,"DURATION")=1
"RTN","PSIVOCDS",116,0)
 S PSJFDB(PSJCNT,"DURATION_RT")="DAY"
"RTN","PSIVOCDS",117,0)
 ; SDA is set to the additive strength or volume of the solution.
"RTN","PSIVOCDS",118,0)
 S PSJFDB(PSJCNT,"DOSE_AMT")=$P(PSIVAS0,U,8)
"RTN","PSIVOCDS",119,0)
 ;*I PSIVAS="SOL" S PSJFDB(PSJCNT,"DOSE_UNIT")=$$UNIT^PSSDSAPI("ML")
"RTN","PSIVOCDS",120,0)
 Q
"RTN","PSIVOCDS",121,0)
FREEDOSE ;Set data for free text dose
"RTN","PSIVOCDS",122,0)
 ;"GENERAL" info only needed to pass in Dose Route and Dose Type.
"RTN","PSIVOCDS",123,0)
 ;"Exception" node sets here to get the specified error back for free text dosing.
"RTN","PSIVOCDS",124,0)
 S PSJFDB(PSJCNT,"FREQ")=1
"RTN","PSIVOCDS",125,0)
 S PSJFDB(PSJCNT,"DURATION")=1
"RTN","PSIVOCDS",126,0)
 S PSJFDB(PSJCNT,"DURATION_RT")=PSJFDB(PSJCNT,"DOSE_RATE")
"RTN","PSIVOCDS",127,0)
 ;S:$G(PSJP8ERR)=1 PSJFDB(PSJCNT,"INF_ERROR")=""
"RTN","PSIVOCDS",128,0)
 S PSJFDB(PSJCNT,"INF_ERROR")=""
"RTN","PSIVOCDS",129,0)
 I $G(PSJP8ERR)=2!($G(PSJP8ERR)=4) S PSJFDB(PSJCNT,"WT_ERROR")=""
"RTN","PSIVOCDS",130,0)
 I $G(PSJP8ERR)=3!($G(PSJP8ERR)=4) S PSJFDB(PSJCNT,"HT_ERROR")=""
"RTN","PSIVOCDS",131,0)
 Q
"RTN","PSIVOCDS",132,0)
ONEAD(PSJRT) ;Setup data for 'Continuous Infusion' IV type
"RTN","PSIVOCDS",133,0)
 NEW PSJCLASS,PSJX
"RTN","PSIVOCDS",134,0)
 ;PSJRT - FDB converted routes from $$RTESCRN
"RTN","PSIVOCDS",135,0)
 ;If the route is not specified in FDB for this drug then default to value set in BASIC^PSIVOCDS
"RTN","PSIVOCDS",136,0)
 ;I '$$FDBRT(PSJFDB(PSJCNT,"DRUG_IEN"),PSJRT) Q
"RTN","PSIVOCDS",137,0)
 ;S PSJRT=$$RTESCRN(PSJRT)
"RTN","PSIVOCDS",138,0)
 ;
"RTN","PSIVOCDS",139,0)
 I $G(PSJRT)=0!($G(PSJRT)="") Q
"RTN","PSIVOCDS",140,0)
 ;I PSJP8UNT'="MILLILITERS" D FREEDOSE Q
"RTN","PSIVOCDS",141,0)
 ;I PSJP8TME'="HOUR" D FREEDOSE Q
"RTN","PSIVOCDS",142,0)
 ;Check to make sure the infusion rate is in form of "ml/hr" before applying the calculation
"RTN","PSIVOCDS",143,0)
 S PSJFDB(PSJCNT,"FREQ")=1
"RTN","PSIVOCDS",144,0)
 S PSJFDB(PSJCNT,"DURATION")=1
"RTN","PSIVOCDS",145,0)
 S PSJFDB(PSJCNT,"ROUTE")=PSJRT
"RTN","PSIVOCDS",146,0)
 S PSJFDB(PSJCNT,"DOSE_RATE")=PSJP8TME
"RTN","PSIVOCDS",147,0)
 S PSJFDB(PSJCNT,"DURATION_RT")=PSJP8TME
"RTN","PSIVOCDS",148,0)
 I PSJP8UNT="MILLILITERS",(PSJP8TME="HOUR") D
"RTN","PSIVOCDS",149,0)
 . S PSJFDB(PSJCNT,"DOSE_AMT")=$$SDACI()
"RTN","PSIVOCDS",150,0)
 . S PSJFDB(PSJCNT,"DOSE_UNIT")=$P(PSIVAS0,U,9)
"RTN","PSIVOCDS",151,0)
 I PSJP8UNT'="MILLILITERS" D
"RTN","PSIVOCDS",152,0)
 . S PSJFDB(PSJCNT,"FREQ")=1
"RTN","PSIVOCDS",153,0)
 . S PSJFDB(PSJCNT,"DOSE_AMT")=PSJP8NUM
"RTN","PSIVOCDS",154,0)
 . S PSJFDB(PSJCNT,"DOSE_UNIT")=PSJP8UNT
"RTN","PSIVOCDS",155,0)
 . S PSJFDB(PSJCNT,"DOSE_RATE")=PSJP8TME
"RTN","PSIVOCDS",156,0)
 . S PSJFDB(PSJCNT,"DURATION_RT")=PSJP8TME
"RTN","PSIVOCDS",157,0)
 . ;S PSJFDB(PSJCNT,"DOSE_AMT")=$P(PSIVAS0,U,8)
"RTN","PSIVOCDS",158,0)
 . ;S PSJFDB(PSJCNT,"DOSE_UNIT")=PSJP8UNT
"RTN","PSIVOCDS",159,0)
 ;S PSJFDB(PSJCNT,"FRQ_ERROR")=""
"RTN","PSIVOCDS",160,0)
 Q
"RTN","PSIVOCDS",161,0)
CONTIV ;Set data needed for continuous IV with multiple drugs
"RTN","PSIVOCDS",162,0)
 NEW PSJFREQ,PSJDIFF
"RTN","PSIVOCDS",163,0)
 S PSJDIFF=+$$DURATION()
"RTN","PSIVOCDS",164,0)
 ; Order has duration <24 hrs
"RTN","PSIVOCDS",165,0)
 I PSJDIFF D UND24HRS
"RTN","PSIVOCDS",166,0)
 ; Order has duration >= 24 hrs
"RTN","PSIVOCDS",167,0)
 I 'PSJDIFF S PSJFDB(PSJCNT,"FREQ")=$$IVFREQ
"RTN","PSIVOCDS",168,0)
 ;
"RTN","PSIVOCDS",169,0)
 S PSJFDB(PSJCNT,"DURATION")=1
"RTN","PSIVOCDS",170,0)
 S PSJFDB(PSJCNT,"DOSE_RATE")="DAY"
"RTN","PSIVOCDS",171,0)
 S PSJFDB(PSJCNT,"DURATION_RT")="DAY"
"RTN","PSIVOCDS",172,0)
 Q
"RTN","PSIVOCDS",173,0)
ISONEAD() ;Return 1 if there's only one additive
"RTN","PSIVOCDS",174,0)
 NEW X,PSJX
"RTN","PSIVOCDS",175,0)
 I $D(PSIVDDSV("AD")),$D(PSIVDDSV("SOL")) Q 0
"RTN","PSIVOCDS",176,0)
 I $O(PSIVDDSV("SOL",0)) Q 0
"RTN","PSIVOCDS",177,0)
 S PSJX=0
"RTN","PSIVOCDS",178,0)
 F X=0:0 S X=$O(PSIVDDSV("AD",X)) Q:'X  S PSJX=PSJX+1 Q:PSJX>1
"RTN","PSIVOCDS",179,0)
 I PSJX>1 Q 0
"RTN","PSIVOCDS",180,0)
 Q 1
"RTN","PSIVOCDS",181,0)
ISNOADD() ;Return 1 if there's no additives
"RTN","PSIVOCDS",182,0)
 NEW X,PSJX
"RTN","PSIVOCDS",183,0)
 ;I $D(PSIVDDSV("AD")),$D(PSIVDDSV("SOL")) Q 0
"RTN","PSIVOCDS",184,0)
 I $O(PSIVDDSV("AD",0)) Q 0
"RTN","PSIVOCDS",185,0)
 ;S PSJX=0
"RTN","PSIVOCDS",186,0)
 ;F X=0:0 S X=$O(PSIVDDSV("SOL",X)) Q:'X  S PSJX=PSJX+1 Q:PSJX>1
"RTN","PSIVOCDS",187,0)
 ;I PSJX>1 Q 0
"RTN","PSIVOCDS",188,0)
 I $D(PSIVDDSV("SOL")) Q 1
"RTN","PSIVOCDS",189,0)
 Q 0
"RTN","PSIVOCDS",190,0)
PREMIX ;The route is always set to "Continuous Infusion" & the FREQUENCY must set to 1
"RTN","PSIVOCDS",191,0)
 NEW X
"RTN","PSIVOCDS",192,0)
 S PSJFDB(PSJCNT,"ROUTE")="CONTINUOUS INFUSION"
"RTN","PSIVOCDS",193,0)
 I PSJP8="" D FREEDOSE Q
"RTN","PSIVOCDS",194,0)
 S PSJFDB(PSJCNT,"FREQ")=1
"RTN","PSIVOCDS",195,0)
 S PSJFDB(PSJCNT,"DOSE_AMT")=PSJP8NUM
"RTN","PSIVOCDS",196,0)
 S PSJFDB(PSJCNT,"DOSE_UNIT")=PSJP8UNT
"RTN","PSIVOCDS",197,0)
 S PSJFDB(PSJCNT,"DOSE_RATE")=PSJP8TME
"RTN","PSIVOCDS",198,0)
 S PSJFDB(PSJCNT,"DURATION_RT")=PSJP8TME
"RTN","PSIVOCDS",199,0)
 ;S PSJFDB(PSJCNT,"ROUTE")="CONTINUOUS INFUSION"
"RTN","PSIVOCDS",200,0)
 I PSJP8UNT="MILLILITERS" S X=$$LITER(PSJP8NUM) I X]"" D
"RTN","PSIVOCDS",201,0)
 . S PSJFDB(PSJCNT,"DOSE_AMT")=$P(X,U)
"RTN","PSIVOCDS",202,0)
 . S PSJFDB(PSJCNT,"DOSE_UNIT")=$P(X,U,2)
"RTN","PSIVOCDS",203,0)
 Q
"RTN","PSIVOCDS",204,0)
SDACI() ;Return Single Dose Amount for ad for 'CONTINUOUS INFUSION' FDB Route (Not classed at "VT" or "TN")
"RTN","PSIVOCDS",205,0)
 ;Single Dose Amount(PSJSDA):
"RTN","PSIVOCDS",206,0)
 ; For Additive - PSJSDA=(Strength/Tot vol)*Infusion Rate
"RTN","PSIVOCDS",207,0)
 ; If can't calculate then return null
"RTN","PSIVOCDS",208,0)
 NEW PSJSDA,X
"RTN","PSIVOCDS",209,0)
 S PSJSDA=""
"RTN","PSIVOCDS",210,0)
 I $D(PSIVDDSV("AD")) D
"RTN","PSIVOCDS",211,0)
 . S X=+$G(PSIVDDSV("TOT_VOL")) Q:'X
"RTN","PSIVOCDS",212,0)
 . S PSJSDA=($P(PSIVAS0,U,8)/X)*PSJP8NUM
"RTN","PSIVOCDS",213,0)
 I '+PSJSDA S PSJSDA=$P(PSIVAS0,U,8),PSJFDB(PSJCNT,"INF_ERROR")=""
"RTN","PSIVOCDS",214,0)
 Q PSJSDA
"RTN","PSIVOCDS",215,0)
CLASS(PSJDD) ;Check if the Drug contains "VT" & "TN" classes
"RTN","PSIVOCDS",216,0)
 ;Return 1 if "VT" or "TN"
"RTN","PSIVOCDS",217,0)
 ;Return 0 if not
"RTN","PSIVOCDS",218,0)
 Q:'+$G(PSJDD) 0
"RTN","PSIVOCDS",219,0)
 NEW PSJCLASS
"RTN","PSIVOCDS",220,0)
 S PSJCLASS=$P($G(^PSDRUG(+PSJDD,0)),U,2)
"RTN","PSIVOCDS",221,0)
 I (PSJCLASS["TN")!(PSJCLASS["VT") Q 1
"RTN","PSIVOCDS",222,0)
 Q 0
"RTN","PSIVOCDS",223,0)
IVFREQ() ;Return the frequency for an continuous IV
"RTN","PSIVOCDS",224,0)
 ; Hours needed to run a bag is defined as: Total Volume / Infusion rate
"RTN","PSIVOCDS",225,0)
 ; # of bags needed for a day is defined as: 24 / Hours need to run a bag
"RTN","PSIVOCDS",226,0)
 ; PSJFREQ is either in Q#H or N for # of admin per day
"RTN","PSIVOCDS",227,0)
 NEW PSJFREQ,PSJBOT,PSJX,X,PSJTOTBG,PSJTOTBT,PSJTOTV,PSJBAGX
"RTN","PSIVOCDS",228,0)
 S (PSJFREQ,PSJTOTBG,PSJTOTBT)=0
"RTN","PSIVOCDS",229,0)
 S PSJTOTV=+$G(PSIVDDSV("TOT_VOL"))
"RTN","PSIVOCDS",230,0)
 ;CONV^PSSDSAPK converts # of hours to run a bag to either Q#H or n for number of admin per day
"RTN","PSIVOCDS",231,0)
 I +PSJTOTV,PSJP8NUM D
"RTN","PSIVOCDS",232,0)
 . I $P(PSIVAS0,U,4)="",(+PSJTOTV#PSJP8NUM) D
"RTN","PSIVOCDS",233,0)
 .. S PSJFDB(PSJCNT,"DOSE_AMT")=$$ADJSDA(+PSJTOTV,PSJP8NUM,+PSJFDB(PSJCNT,"DOSE_AMT"))
"RTN","PSIVOCDS",234,0)
 .. ;S X=$J(+PSJTOTV/+P(8),"",0)
"RTN","PSIVOCDS",235,0)
 .. ;S PSJFDB(PSJCNT,"DOSE_AMT")=((+P(8)*X)/(+PSJTOTV))*PSJFDB(PSJCNT,"DOSE_AMT")
"RTN","PSIVOCDS",236,0)
 . S PSJBAGX=PSJTOTV/PSJP8NUM
"RTN","PSIVOCDS",237,0)
 . I PSJBAGX<1 S PSJFREQ="Q1H"
"RTN","PSIVOCDS",238,0)
 . S:PSJBAGX'<1 PSJFREQ=$$CONV^PSSDSAPK(PSJTOTV/PSJP8NUM)
"RTN","PSIVOCDS",239,0)
 . S PSJTOTBG=24/(+PSJTOTV/PSJP8NUM)
"RTN","PSIVOCDS",240,0)
 I PSIVAS="AD" D BOTTLE(PSJTOTBG,$P(PSIVAS0,U,4))
"RTN","PSIVOCDS",241,0)
 I PSJFREQ=""!(PSJFREQ=0) S PSJFREQ=1 S PSJFDB(PSJCNT,"FRQ_ERROR")=""
"RTN","PSIVOCDS",242,0)
 Q PSJFREQ
"RTN","PSIVOCDS",243,0)
ADJSDA(PSJTOTV,PSJINFRT,PSJSDA) ;Adjust SDA
"RTN","PSIVOCDS",244,0)
 NEW PSJBAGX,X
"RTN","PSIVOCDS",245,0)
 I $S(+PSJTOTV:0,+PSJINFRT:0,+PSJSDA:0,1:1) Q ""
"RTN","PSIVOCDS",246,0)
 S PSJBAGX=+PSJTOTV/PSJP8NUM
"RTN","PSIVOCDS",247,0)
 I PSJBAGX<1 S PSJSDA=PSJSDA/PSJBAGX
"RTN","PSIVOCDS",248,0)
 I PSJBAGX'<1 D
"RTN","PSIVOCDS",249,0)
 . S X=$J(PSJBAGX,"",0)
"RTN","PSIVOCDS",250,0)
 . S PSJSDA=((PSJP8NUM*X)/(+PSJTOTV))*PSJSDA
"RTN","PSIVOCDS",251,0)
 . S PSJFDB(PSJCNT,"ADJ_MSG")="PLEASE NOTE: The single dose of the IV Additive has been adjusted to reflect the amount of drug infused over the nearest whole number of hours ("_(X*PSJINFRT)_" ML over "_X_" hours)."
"RTN","PSIVOCDS",252,0)
 Q PSJSDA
"RTN","PSIVOCDS",253,0)
UND24HRS ;Calculate freq for order <24 hrs
"RTN","PSIVOCDS",254,0)
 NEW PSJTOTV,PSJBAG,PSJMNBAG,PSJTOTBG,PSJFREQ,PSJHRS
"RTN","PSIVOCDS",255,0)
 ;PSJFREQ,PSJBOT,PSJX,X,PSJTOTBG,PSJTOTBT,PSJTOTV,PSJMNBAG,PSJDIFF
"RTN","PSIVOCDS",256,0)
 S (PSJFREQ,PSJBAG,PSJMNBAG)=0
"RTN","PSIVOCDS",257,0)
 S PSJTOTV=+$G(PSIVDDSV("TOT_VOL"))
"RTN","PSIVOCDS",258,0)
 I +PSJTOTV,PSJP8NUM D
"RTN","PSIVOCDS",259,0)
 . S PSJHRS=PSJTOTV/PSJP8NUM
"RTN","PSIVOCDS",260,0)
 . S PSJMNBAG=PSJHRS*60
"RTN","PSIVOCDS",261,0)
 . S PSJTOTBG=24/PSJHRS
"RTN","PSIVOCDS",262,0)
 I '+PSJMNBAG D  Q
"RTN","PSIVOCDS",263,0)
 . S PSJFDB(PSJCNT,"FREQ")=1
"RTN","PSIVOCDS",264,0)
 . S PSJFDB(PSJCNT,"FRQ_ERROR")=""
"RTN","PSIVOCDS",265,0)
 S:+PSJMNBAG PSJBAG=PSJDIFF/PSJMNBAG
"RTN","PSIVOCDS",266,0)
 ; If the order is for < 24 hrs & Freq < 1 then adjust the SDA & Freq set to 1
"RTN","PSIVOCDS",267,0)
 I PSJBAG<1 D  Q
"RTN","PSIVOCDS",268,0)
 . S PSJFDB(PSJCNT,"FREQ")=1
"RTN","PSIVOCDS",269,0)
 . S PSJFDB(PSJCNT,"DOSE_AMT")=PSJBAG*(PSJFDB(PSJCNT,"DOSE_AMT"))
"RTN","PSIVOCDS",270,0)
 ;
"RTN","PSIVOCDS",271,0)
 S PSJFREQ=$J(PSJBAG,"",0)
"RTN","PSIVOCDS",272,0)
 I PSIVAS="AD" D BOTTLE(PSJFREQ,$P(PSIVAS0,U,4))
"RTN","PSIVOCDS",273,0)
 S PSJFDB(PSJCNT,"FREQ")=PSJFREQ
"RTN","PSIVOCDS",274,0)
 Q
"RTN","PSIVOCDS",275,0)
 ;
"RTN","PSIVOCDS",276,0)
BOTTLE(PSJTOTBG,PSJBOT) ;Set freq to either specified bottle or # needed for the duration/24hrs of the order
"RTN","PSIVOCDS",277,0)
 NEW PSJTOTBT,X,PSJX
"RTN","PSIVOCDS",278,0)
 Q:'+$G(PSJTOTBG)
"RTN","PSIVOCDS",279,0)
 ;
"RTN","PSIVOCDS",280,0)
 ;If a bag is run for >24 hours then set the freq=1 & adjust SDA
"RTN","PSIVOCDS",281,0)
 I PSJTOTBG<1 D  Q
"RTN","PSIVOCDS",282,0)
 . S PSJFREQ=1
"RTN","PSIVOCDS",283,0)
 . S PSJFDB(PSJCNT,"DOSE_AMT")=$G(PSJFDB(PSJCNT,"DOSE_AMT"))*PSJTOTBG
"RTN","PSIVOCDS",284,0)
 ;
"RTN","PSIVOCDS",285,0)
 Q:$G(PSJBOT)=""
"RTN","PSIVOCDS",286,0)
 S PSJTOTBT=0
"RTN","PSIVOCDS",287,0)
 F X=1:1:$L(PSJBOT,",") S PSJX=$P(PSJBOT,",",X) S:+PSJX PSJTOTBT=PSJTOTBT+1
"RTN","PSIVOCDS",288,0)
 ;S PSJFREQ=$$CONV^PSSDSAPK($S(PSJTOTBT>PSJTOTBG:PSJTOTBG,1:PSJTOTBT))
"RTN","PSIVOCDS",289,0)
 S PSJFREQ=$S(PSJTOTBT>PSJTOTBG:PSJTOTBG,1:PSJTOTBT)
"RTN","PSIVOCDS",290,0)
 I PSJTOTV#PSJP8NUM,(PSJTOTBT>PSJTOTBG) D
"RTN","PSIVOCDS",291,0)
 . ;S PSJFDB(PSJCNT,"DOSE_AMT")=$$ADJSDA(+PSJTOTV,PSJP8NUM,+PSJFDB(PSJCNT,"DOSE_AMT"))
"RTN","PSIVOCDS",292,0)
 . S PSJFREQ=$$CONV^PSSDSAPK(PSJTOTV/PSJP8NUM)
"RTN","PSIVOCDS",293,0)
 I PSJFREQ=0 S PSJFREQ=1 S PSJFDB(PSJCNT,"FRQ_ERROR")=""
"RTN","PSIVOCDS",294,0)
 Q
"RTN","PSIVOCDS",295,0)
DURATION() ;
"RTN","PSIVOCDS",296,0)
 ;If PSJIV("DUR") is passed in from CPRS then return the minutes if <1440 otherwise return ""
"RTN","PSIVOCDS",297,0)
 ;If not call from CPRS then calculate from start, stop date
"RTN","PSIVOCDS",298,0)
 NEW PSJX,X,PSJP8X
"RTN","PSIVOCDS",299,0)
 S PSJX=""
"RTN","PSIVOCDS",300,0)
 I +$G(PSJIV("DUR")) D  Q X
"RTN","PSIVOCDS",301,0)
 .S PSJX=+$G(PSJIV("DUR"))
"RTN","PSIVOCDS",302,0)
 .S X=$S(PSJX<1440:PSJX,1:"")
"RTN","PSIVOCDS",303,0)
 I +$G(PSJIV("TOT_VOL")) D  Q X
"RTN","PSIVOCDS",304,0)
 . S PSJP8X=$S(+$G(PSJP8NUM):PSJP8NUM,+P(8):+P(8),1:0)
"RTN","PSIVOCDS",305,0)
 . S:PSJP8X PSJX=(+PSJIV("TOT_VOL")/PSJP8X)*60
"RTN","PSIVOCDS",306,0)
 . S X=$S(PSJX<1440:PSJX,1:"")
"RTN","PSIVOCDS",307,0)
 S X=$$DURATION^PSJOCDS($G(P(2)),$G(P(3)))
"RTN","PSIVOCDS",308,0)
 Q X
"RTN","PSIVOCDS",309,0)
FDBRT(PSJDD,PSJRT) ;Check if the ordered route can be admin by FDB for this drug
"RTN","PSIVOCDS",310,0)
 ;PSJDD = Drug IEN
"RTN","PSIVOCDS",311,0)
 ;PSJRT = Route entered for the order that mapped to FDB route
"RTN","PSIVOCDS",312,0)
 ;Return 1 if the route can admin by FDB; 0 if this route is not specify for this drug
"RTN","PSIVOCDS",313,0)
 NEW PSJFDBRT
"RTN","PSIVOCDS",314,0)
 I '+$G(PSJDD)!$G(PSJRT)="" Q 0
"RTN","PSIVOCDS",315,0)
 D GROUTE^PSSFDBRT(PSJDD,.PSJFDBRT)
"RTN","PSIVOCDS",316,0)
 I $D(PSJFDBRT(PSJRT)) Q 1
"RTN","PSIVOCDS",317,0)
 Q 0
"RTN","PSIVOCDS",318,0)
RTESCRN(PSJRT) ; Screen routes for none "VT or "TN"
"RTN","PSIVOCDS",319,0)
 ;Return 0 or FDB equivalent if the ordered route is one of the six below.
"RTN","PSIVOCDS",320,0)
 ;PSJRT - Ordered route
"RTN","PSIVOCDS",321,0)
 I PSJRT="INTRA-ARTERIAL" Q "CONT INTRAARTER INF"
"RTN","PSIVOCDS",322,0)
 I PSJRT="INTERTHECAL"  Q "CONT INTRATHECAL INF"
"RTN","PSIVOCDS",323,0)
 I PSJRT="NEBULIZATION" Q "CONT NEBULIZATION"
"RTN","PSIVOCDS",324,0)
 I PSJRT="SUBCUTANEOUS" Q "CONT SUBCUTAN INFUSI"
"RTN","PSIVOCDS",325,0)
 I PSJRT="EPIDURAL" Q "CONTINUOUS EPIDURAL"
"RTN","PSIVOCDS",326,0)
 I PSJRT="INTRAVENOUS" Q "CONTINUOUS INFUSION"
"RTN","PSIVOCDS",327,0)
 Q 0
"RTN","PSIVOCDS",328,0)
LITER(PSJVOLP8) ; Convert the unit from ML to L for premix contains potassium
"RTN","PSIVOCDS",329,0)
 ; FDB only accept Liter for this type for drug
"RTN","PSIVOCDS",330,0)
 ; PSJVOLP8 - Either = volume or the infusion rate
"RTN","PSIVOCDS",331,0)
 NEW PSJVAGEN,PSJSDA,PSJUNIT
"RTN","PSIVOCDS",332,0)
 Q:$G(PSJVOLP8)=""
"RTN","PSIVOCDS",333,0)
 S PSJVAGEN=$$VAGEN^PSJMISC($P(PSIVAS0,U))
"RTN","PSIVOCDS",334,0)
 I PSJVAGEN["POTASSIUM" D
"RTN","PSIVOCDS",335,0)
 . S PSJSDA=+(PSJVOLP8/1000)
"RTN","PSIVOCDS",336,0)
 . S PSJUNIT="L"
"RTN","PSIVOCDS",337,0)
 I '+$G(PSJSDA)!($G(PSJUNIT)="") Q ""
"RTN","PSIVOCDS",338,0)
 Q PSJSDA_U_PSJUNIT
"RTN","PSIVOD")
0^70^B13557709
"RTN","PSIVOD",1,0)
PSIVOD ;BIR/JCH-CREATE NEW IV ORDER FROM OLD ONE ;25 Nov 98 / 3:34 PM
"RTN","PSIVOD",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**110,127,181**;16 DEC 97;Build 190
"RTN","PSIVOD",3,0)
 ;
"RTN","PSIVOD",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVOD",5,0)
 ; Reference to ^ORX2 is supported by DBIA 867.
"RTN","PSIVOD",6,0)
 ;
"RTN","PSIVOD",7,0)
COPY(DFN,OLDON) ;Ask to enter new order.
"RTN","PSIVOD",8,0)
 N PSIVOORD,OLDP,PSIVCOPY,PSGCOPY M OLDP=P
"RTN","PSIVOD",9,0)
 Q:'$$HIDDEN^PSJLMUTL("COPY")  D ^PSJHVARS
"RTN","PSIVOD",10,0)
 I $P($G(^PS(55,PSGP,"IV",+PSGORD,.2)),U,4)="D",'$P($G(^(4)),"^",3) D  G Q
"RTN","PSIVOD",11,0)
 .W !!,"Nurse verified orders with a priority of DONE may not be Copied." D PAUSE^VALM1 Q
"RTN","PSIVOD",12,0)
 S PSGOEAV=$P(PSJSYSP0,U,9)&PSJSYSU S PSIVOORD=PSJORD
"RTN","PSIVOD",13,0)
 D FULL^VALM1
"RTN","PSIVOD",14,0)
 F  W !!,"Do you want to copy this order" S %=2 D YN^DICN Q:%  D CH
"RTN","PSIVOD",15,0)
 G:%'=1 Q
"RTN","PSIVOD",16,0)
 S P("RES")="N",PSIVAC="PN",P("PON")=ON55,PSIVUP=+$$GTPCI^PSIVUTL,PSJORD=ON55,PSGORD=PSJORD
"RTN","PSIVOD",17,0)
 N OLDACT,PSIVCHG S OLDACT=PSGACT S PSGACT=PSGACT_"E",P(17)="N",(P("LOG"),P("LF"))="",P(21)="" K P("NAT")
"RTN","PSIVOD",18,0)
 S:'$G(PSGDT) PSGDT=$$DATE^PSJUTL2() S P("LOG")=PSGDT,P("PRNTON")=""
"RTN","PSIVOD",19,0)
 D ENT^PSIVCAL,ENSTOP^PSIVCAL S ND4="^^^^" F I=5,6,8,9 S $P(ND2,"^",I)=""
"RTN","PSIVOD",20,0)
 S P(17)=$S($G(PSGOEAV):"A",1:"N") S P("CLRK")=DUZ_"^"_$P($G(^VA(200,+DUZ,0)),"^")
"RTN","PSIVOD",21,0)
 S PSIVCHG=0,PSJNEWOE=0,PSIVCOPY=1,VALMBCK="Q" K PSIVACEP
"RTN","PSIVOD",22,0)
 NEW PSGORQF K PSGORQF D OC^PSIVOC G:$G(PSGORQF) Q
"RTN","PSIVOD",23,0)
 N PSGORD,ON,ON55,PSJORD D NEW55^PSIVORFB S (PSJORD,ON)=ON55,PSIVCOPY=2
"RTN","PSIVOD",24,0)
 D EN^VALM("PSJ LM IV AC/EDIT")
"RTN","PSIVOD",25,0)
 I $G(P("NAT"))=""&($G(PSJORNAT)="") D  G Q
"RTN","PSIVOD",26,0)
 .D FULL^VALM1 W !!,"Order not copied" D PAUSE^VALM1
"RTN","PSIVOD",27,0)
 W !!,"...copying..."
"RTN","PSIVOD",28,0)
 ;
"RTN","PSIVOD",29,0)
 I '$G(PSGOEAV) D INMED
"RTN","PSIVOD",30,0)
 ;
"RTN","PSIVOD",31,0)
 D FULL^VALM1 W !!?5,"You are finished with the new order.",!,"The following ACTION prompt is for the original order." D PAUSE^VALM1
"RTN","PSIVOD",32,0)
Q ; Kill and exit.
"RTN","PSIVOD",33,0)
 L:'$D(PSJOE) -^PS(53.45,DUZ) S PSJNKF=1 D Q^PSIV
"RTN","PSIVOD",34,0)
 K FIL,I1,ND,PC,PDM,PSGDT,PSGID,PSGLMT,PSGSI,PSJNARC,PSIVAC,PSIVCHG,PSIVUP,PSIVX,PSJOPC
"RTN","PSIVOD",35,0)
 S VALMBCK="R"
"RTN","PSIVOD",36,0)
 I '$G(PSGDT) S PSGDT=$$DATE^PSJUTL2
"RTN","PSIVOD",37,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSIVOORD) ; resets PSGACT after copy
"RTN","PSIVOD",38,0)
 D RESTORE^PSJHVARS
"RTN","PSIVOD",39,0)
 K P M P=OLDP
"RTN","PSIVOD",40,0)
 Q
"RTN","PSIVOD",41,0)
 ;
"RTN","PSIVOD",42,0)
INMED ;
"RTN","PSIVOD",43,0)
 K PSJACEPT S VALMBCK="Q",PSIVCOPY=2,PSIVCHG=0 ;D ACEDIT^PSJLIACT
"RTN","PSIVOD",44,0)
 N ON55TMP,P21TMP S ON55TMP=ON55,P21TMP=$G(P(21)) S P(21)="" I $G(ON55)["P",($G(PSJORD)["V") S ON55=PSJORD
"RTN","PSIVOD",45,0)
 D DEL55^PSIVORE2 I $G(ON55TMP)]"" S ON55=ON55TMP,P(21)=P21TMP
"RTN","PSIVOD",46,0)
 ;S (PSJORNAT,P("NAT"))="W"
"RTN","PSIVOD",47,0)
 ;D OK^PSIVORE
"RTN","PSIVOD",48,0)
 D EN^VALM("PSJ LM IV INPT ACTIVE")
"RTN","PSIVOD",49,0)
 L -^PS(55,DFN,"IV",+ON55) D ULK
"RTN","PSIVOD",50,0)
 I $G(P("NAT"))="" D  G Q
"RTN","PSIVOD",51,0)
 .D FULL^VALM1 W !!,"Order not copied" D PAUSE^VALM1
"RTN","PSIVOD",52,0)
 Q
"RTN","PSIVOD",53,0)
ULK ;
"RTN","PSIVOD",54,0)
 Q:'$G(PSJLSORX)  ;If NEW^PSIVORE did not lock, don't kill it here.
"RTN","PSIVOD",55,0)
 NEW X S X=DFN_";DPT(" D ULK^ORX2 K PSJLSORX
"RTN","PSIVOD",56,0)
 Q
"RTN","PSIVOD",57,0)
HK ;Queue job to print MAR labels generated for this patient.
"RTN","PSIVOD",58,0)
 I PSGOP,PSGOP'=DFN D
"RTN","PSIVOD",59,0)
 .N PSJACPF,PSJACNWP,PSJPWD,PSJSYSL,PSJSYSW,PSJSYSW0,DFN,VAIN,VAERR S DFN=PSGOP
"RTN","PSIVOD",60,0)
 .D INP^VADPT S PSJPWD=+VAIN(4) I PSJPWD S PSJACPF=10 S PSJACPF=10 D WP^PSJAC D:$P(PSJSYSL,U,2)]"" ENQL^PSGLW
"RTN","PSIVOD",61,0)
 S PSGOP=DFN
"RTN","PSIVOD",62,0)
 Q
"RTN","PSIVOD",63,0)
 ;
"RTN","PSIVOD",64,0)
SPSOL S SPSOL=0 F XXX=0:0 S XXX=$O(^PS(55,DFN,"IV",+ON55,"SOL",XXX)) Q:'XXX  S SPSOL=SPSOL+$P(^(XXX,0),U,2)
"RTN","PSIVOD",65,0)
 K XXX Q
"RTN","PSIVOD",66,0)
CH ;
"RTN","PSIVOD",67,0)
 W !!?2,"Answer 'YES' to have a new, non-verified order created for this patient,"
"RTN","PSIVOD",68,0)
 W !,"using the information from this order.  (The START and STOP dates will be",!,"recalculated.)  Enter 'NO' (or '^') to stop now."
"RTN","PSIVOD",69,0)
 Q
"RTN","PSIVOPT")
0^14^B57204242
"RTN","PSIVOPT",1,0)
PSIVOPT ;BIR/PR,MLM-OPTION DRIVER ;06 Aug 98 / 2:17 PM
"RTN","PSIVOPT",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**17,27,58,88,104,110,155,181**;16 DEC 97;Build 190
"RTN","PSIVOPT",3,0)
 ;
"RTN","PSIVOPT",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSIVOPT",5,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192        
"RTN","PSIVOPT",6,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231
"RTN","PSIVOPT",7,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173
"RTN","PSIVOPT",8,0)
 ;
"RTN","PSIVOPT",9,0)
 NEW PSIVLOCK S PSIVLOCK=0
"RTN","PSIVOPT",10,0)
 ;I ON["P" L +^PS(53.1,+ON):1 S:'$T PSIVLOCK=1
"RTN","PSIVOPT",11,0)
 I ON["V" L +^PS(55,DFN,"IV",+ON55):1 S:'$T PSIVLOCK=1
"RTN","PSIVOPT",12,0)
 I PSIVLOCK W !,$C(7),$C(7),"This order is being edited by another user. Try later." G K
"RTN","PSIVOPT",13,0)
 ;W ! L +^PS(55,DFN,"IV",+ON55):1 I '$T W !,$C(7),$C(7),"This order is being edited by another user. Try later." G K
"RTN","PSIVOPT",14,0)
 I PSIVAC="O"!(PSIVAC="H") S PSIVAC=PSIVAC_"(DFN,ON,P(17),P(3))"
"RTN","PSIVOPT",15,0)
 S TEX="Active order ***" I $D(UWLFLAG),UWLFLAG="1.001" S XED=0 D @PSIVAC G K
"RTN","PSIVOPT",16,0)
 S DONE=0 F  D ACT Q:DONE
"RTN","PSIVOPT",17,0)
 ;
"RTN","PSIVOPT",18,0)
UNLOCK ; Unlock order.
"RTN","PSIVOPT",19,0)
 ;I ON["P" L -^PS(53.1,+ON)
"RTN","PSIVOPT",20,0)
 ;E  L -^PS(55,DFN,"IV",+ON55)
"RTN","PSIVOPT",21,0)
 I ON["V" L -^PS(55,DFN,"IV",+ON55)
"RTN","PSIVOPT",22,0)
 ;
"RTN","PSIVOPT",23,0)
K ; Kill variables.
"RTN","PSIVOPT",24,0)
 K %,DA,DIE,DIK,DLAYGO,DNE,DR,DRG,DRGI,DRGT,ERR,HELP,J,OD,P,P16,PSIVAL,PSIVC,PSIVLOG,PSIVNOL,PSIVOK,PSIVOPT,PSIVREA,SCRNPRO,TEX,XED
"RTN","PSIVOPT",25,0)
 Q
"RTN","PSIVOPT",26,0)
ACT ; Prompt for order action.
"RTN","PSIVOPT",27,0)
 K PSJIVBD NEW PSGFDX,PSGSDX S (PSJORD,ON)=ON55
"RTN","PSIVOPT",28,0)
 S PSJCOM=$S(ON["V":$P($G(^PS(55,DFN,"IV",+ON,.2)),"^",8),1:$P($G(^PS(53.1,+ON,.2)),"^",8))
"RTN","PSIVOPT",29,0)
 D:ON["V" EN^PSJLIORD(DFN,ON)
"RTN","PSIVOPT",30,0)
 I ON["P",($P($G(^PS(53.1,+ON,0)),U,9)="N"),'PSJCOM D GT531^PSIVORFA(DFN,ON),VF^PSIVORC2 S DONE=1 Q
"RTN","PSIVOPT",31,0)
 I ON["P",PSJCOM Q:'$$LOCK^PSJOEA(DFN,PSJCOM)  N PSJO,ON,PSJORD S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJCOM,PSJO)) Q:'PSJO  Q:$G(Y)="Q"  S (PSJORD,ON)=PSJO_"P" D
"RTN","PSIVOPT",32,0)
 .D:($P($G(^PS(53.1,+ON,0)),U,9)="N") GT531^PSIVORFA(DFN,ON),VF^PSIVORC2
"RTN","PSIVOPT",33,0)
 .D:($P($G(^PS(53.1,+ON,0)),U,9)="P") EN^PSJLIFN
"RTN","PSIVOPT",34,0)
 I $G(PSJCOM) N PSJORD S PSJORD=PSJCOM D CHK^PSJOEA1
"RTN","PSIVOPT",35,0)
 I ON'["V",'+$G(PSJCOM) D EN^PSJLIFN
"RTN","PSIVOPT",36,0)
 S DONE=1
"RTN","PSIVOPT",37,0)
 Q
"RTN","PSIVOPT",38,0)
 ;
"RTN","PSIVOPT",39,0)
CK ; Check if drugs are still valid.
"RTN","PSIVOPT",40,0)
 F DRGT="AD","SOL" S FIL=$S(DRGT="AD":52.6,1:52.7) F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI  D
"RTN","PSIVOPT",41,0)
 .S DRG=+$P(DRG(DRGT,DRGI),U),X=$G(^PS(FIL,DRG,"I")) I $S('X:0,DT<X:0,1:1)!$S('$G(^PSDRUG(+$P($G(^PS(FIL,DRG,0)),U,2),"I")):0,^("I")>DT:0,1:1) S ERR=1
"RTN","PSIVOPT",42,0)
 Q
"RTN","PSIVOPT",43,0)
 ;
"RTN","PSIVOPT",44,0)
D ; Discontinue order.
"RTN","PSIVOPT",45,0)
 D D^PSIVOPT2
"RTN","PSIVOPT",46,0)
 Q
"RTN","PSIVOPT",47,0)
 ;
"RTN","PSIVOPT",48,0)
O(DFN,ON,STAT,STOP) ; On/Off Call
"RTN","PSIVOPT",49,0)
 D NOW^%DTC I STAT="H",STOP<% D EXPIR Q
"RTN","PSIVOPT",50,0)
 I "OA"'[STAT W !,$C(7),"Only active orders may be placed on hold." Q
"RTN","PSIVOPT",51,0)
 S PSIVALT=1,PSIVREA=$S(STAT'="O":"O",1:"C"),(P(17),STAT)=$S(PSIVREA="O":"O",1:"A") W:PSIVREA="C" ?$X+4,$C(7),TEX
"RTN","PSIVOPT",52,0)
 D UPSTAT,LOG^PSIVORAL D:STAT="A" CKO^PSIVCHK
"RTN","PSIVOPT",53,0)
 Q
"RTN","PSIVOPT",54,0)
 ;
"RTN","PSIVOPT",55,0)
E ; Entry for Pharmacy edit
"RTN","PSIVOPT",56,0)
 N PSJEDIT1 D E^PSIVOPT1
"RTN","PSIVOPT",57,0)
 Q
"RTN","PSIVOPT",58,0)
 ;
"RTN","PSIVOPT",59,0)
R ; Renew order.
"RTN","PSIVOPT",60,0)
 D R^PSIVOPT2
"RTN","PSIVOPT",61,0)
 Q
"RTN","PSIVOPT",62,0)
 ;
"RTN","PSIVOPT",63,0)
H(DFN,ON,STAT,STOP)          ; Place order on hold.
"RTN","PSIVOPT",64,0)
 D NOW^%DTC I STAT="H" I STOP<% D EXPIR Q
"RTN","PSIVOPT",65,0)
 I "HA"'[STAT W !,$C(7),"Only active orders may be placed on hold." Q
"RTN","PSIVOPT",66,0)
 D NATURE^PSIVOREN I '$D(P("NAT")) W !!,"Order unchanged." Q
"RTN","PSIVOPT",67,0)
 S PSIVALT=1,PSIVREA=$S(STAT'="H":"H",1:"U"),(P(17),STAT)=$S(PSIVREA="H":"H",1:"A") W:PSIVREA="U" ?$X+4,$C(7),TEX
"RTN","PSIVOPT",68,0)
 D UPSTAT,LOG^PSIVORAL,HOLD^PSIVOE,ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,$S(PSIVREA="H":"H1",1:"H0")) D:STAT="A" CKO^PSIVCHK
"RTN","PSIVOPT",69,0)
 Q
"RTN","PSIVOPT",70,0)
 ;
"RTN","PSIVOPT",71,0)
S ; View order.
"RTN","PSIVOPT",72,0)
 D @$S(ON55["V":"GT55^PSIVORFB",1:"GT531^PSIVORFA("_DFN_","""_ON55_""")") W @IOF D EN^PSIVORV2
"RTN","PSIVOPT",73,0)
 Q
"RTN","PSIVOPT",74,0)
 ;
"RTN","PSIVOPT",75,0)
EXPIR ; Update status of expired orders.
"RTN","PSIVOPT",76,0)
 I STAT="H" S PSIVREA="H",P(17)="E"
"RTN","PSIVOPT",77,0)
 S STAT="E" D UPSTAT,EXPIR^PSIVOE W $C(7),"  This order has expired."
"RTN","PSIVOPT",78,0)
 Q
"RTN","PSIVOPT",79,0)
 ;
"RTN","PSIVOPT",80,0)
UPSTAT ; Update orders status.
"RTN","PSIVOPT",81,0)
 N DA,DR,DIE,PSIVACT S PSIVACT=1,DA=+ON55,DA(1)=DFN,DIE="^PS(55,"_DFN_",""IV"",",DR="100///"_P(17)_$S($G(PSIVREA)="H":";149///1",$G(PSIVREA)="U":";149///@",1:"") D ^DIE
"RTN","PSIVOPT",82,0)
 Q
"RTN","PSIVOPT",83,0)
 ;
"RTN","PSIVOPT",84,0)
ENIN ; Entry for inpatient order entry/profile options.
"RTN","PSIVOPT",85,0)
 N DFN,ON,P,PSIVAC S PSIVAC="C" I PSJORD["P" S (P("PON"),ON)=+PSJORD_"P",DFN=PSGP D SHOW1^PSIVORC Q
"RTN","PSIVOPT",86,0)
 S (P("PON"),ON,ON55)=+PSJORD_"V",DFN=PSGP D GT55^PSIVORFB,EN^PSIVORV2,PSIVOPT:'$D(PSJPRF)
"RTN","PSIVOPT",87,0)
 L -^PS(55,DFN,"IV",+PSJORD)
"RTN","PSIVOPT",88,0)
 Q
"RTN","PSIVOPT",89,0)
 ;
"RTN","PSIVOPT",90,0)
ENARI(DFN,ON,PSGUOW,PSIVAL) ; Auto-reinstate IV orders if movement is deleted.
"RTN","PSIVOPT",91,0)
 ;Create a list of recipients beyond normal mail group
"RTN","PSIVOPT",92,0)
 S PSGORNUM=$S($G(PSGORD):PSGORD,$G(PSJORD):PSJORD,$G(OR55):OR55,1:"")
"RTN","PSIVOPT",93,0)
 I $G(PSGORNUM) D
"RTN","PSIVOPT",94,0)
 .I $D(^PS(55,PSGP,"IV",+PSGORNUM,0)),$P(^PS(55,PSGP,"IV",+PSGORNUM,0),U,6)'="" S PSJSENTO($J,$P(^PS(55,PSGP,"IV",+PSGORNUM,0),U,6))="" ; Provider
"RTN","PSIVOPT",95,0)
 .I $D(^PS(55,PSGP,"IV",+PSGORNUM,2)),$P(^PS(55,PSGP,"IV",+PSGORNUM,2),U,11)'="" S PSJSENTO($J,$P(^PS(55,PSGP,"IV",+PSGORNUM,2),U,11))="" ; Entered by
"RTN","PSIVOPT",96,0)
 .I $D(^PS(55,PSGP,"IV",+PSGORNUM,4)),$P(^PS(55,PSGP,"IV",+PSGORNUM,4),U,1)'="" S PSJSENTO($J,$P(^PS(55,PSGP,"IV",+PSGORNUM,4),U,1))="" ; Verifying Nurse
"RTN","PSIVOPT",97,0)
 ; find pharmacist that finished the IV order
"RTN","PSIVOPT",98,0)
 N PSJX,ENTBY S PSJX=$G(^PS(55,PSGP,"IV",+ON,"A",1,0))
"RTN","PSIVOPT",99,0)
 I $P(PSJX,U,2)="F" S ENTBY=$$VA200($P(PSJX,U,3)) I ENTBY'="" S PSJSENTO($J,ENTBY)=""
"RTN","PSIVOPT",100,0)
 ;
"RTN","PSIVOPT",101,0)
 I $G(PSGALO)'=18530,$G(PSGORNUM),$$IVDUPADD^PSIVOPT(PSGP,+PSGORNUM) S ^TMP("PSJNOTUNDC",$J,PSGP,+PSGORNUM_"V")="" Q
"RTN","PSIVOPT",102,0)
 N DA,DR,DIE,DIK,PSIVREA,PSIVALCK,PSIVOPT,PSIVALT,X,Y
"RTN","PSIVOPT",103,0)
 S X=$G(^PS(55,DFN,"IV",+ON,"ADC")) I X K ^PS(55,"ADC",X,DFN,+ON),^PS(55,DFN,"IV",+ON,"ADC")
"RTN","PSIVOPT",104,0)
 ;S PSIVACT=1,DR=$S(+$P($G(^PS(55,DFN,"IV",+ON,4)),U,18)=1:"100///H",+$P($G(^PS(55,DFN,"IV",+ON,0)),U,10)=1:"100///H",1:"100///A")_";.03////"_+$P($G(^PS(55,DFN,"IV",+ON,2)),U,7)_";109///@;116///@;121///@;157////@"
"RTN","PSIVOPT",105,0)
 S PSIVACT=1,DR=$S(+$P($G(^PS(55,DFN,"IV",+ON,0)),U,10)=1:"100///H;157///HP",+$P($G(^PS(55,DFN,"IV",+ON,4)),U,18)=1:"100///H;157///@",1:"100///A;157///@")_";.03////"_+$P($G(^PS(55,DFN,"IV",+ON,2)),U,7)_";109///@;116///@;121///@"
"RTN","PSIVOPT",106,0)
 S DIE="^PS(55,"_DFN_",""IV"",",DA=+ON,DA(1)=DFN
"RTN","PSIVOPT",107,0)
 N CHKIT S CHKIT=$G(^PS(55,DFN,"IV",+ON,2)) I $P(CHKIT,U,6)["P",($P(CHKIT,U,9)="R") S DR=DR_";114///@;123///@"
"RTN","PSIVOPT",108,0)
 D ^DIE
"RTN","PSIVOPT",109,0)
 S ^TMP("PSJUNDC",$J,DFN,ON_"V")=""
"RTN","PSIVOPT",110,0)
 S ON55=ON,P(17)="A",PSIVREA=$S($D(PSJUNDC):"AI",1:"I"),PSIVALCK="STOP",(PSIVOPT,PSIVALT)=1,PSIVAL=$P($G(^PS(53.3,+PSIVAL,0)),U) D LOG^PSIVORAL
"RTN","PSIVOPT",111,0)
 ;* S Y=^PS(55,DFN,"IV",+ON,0),P(3)=+$P(Y,U,3),ORIFN=$P(Y,U,21),P(12)="" D:'$D(PSJIVORF) ORPARM^PSIVOREN I PSJIVORF D
"RTN","PSIVOPT",112,0)
 S Y=^PS(55,DFN,"IV",+ON,0),P(3)=+$P(Y,U,3),P(12)="" D:'$D(PSJIVORF) ORPARM^PSIVOREN I PSJIVORF D
"RTN","PSIVOPT",113,0)
 .D EN1^PSJHL2(DFN,"SC",+ON55_"V","AUTO REINSTATED")
"RTN","PSIVOPT",114,0)
 S PSGTOL=$S($D(PSJUNDC):3,1:2)
"RTN","PSIVOPT",115,0)
 Q:$S('$D(PSJUNDC):0,PSGALO=18540:1,1:'$P($G(PSJSYSW0),U,15))
"RTN","PSIVOPT",116,0)
 I $D(^PS(53.41,1,1,PSGUOW,1,DFN,1,3,1,+ON)) K DIK,DA S DIK="^PS(53.41,1,1,"_PSGUOW_",1,"_DFN_",1,3,1,",DA=+ON,DA(1)=1,DA(2)=PSGP,DA(3)=PSGUOW,DA(4)=3 D ^DIK
"RTN","PSIVOPT",117,0)
 E  K DA D ENLBL^PSIVOPT(PSGTOL,PSGUOW,DFN,3,+ON,"RE")
"RTN","PSIVOPT",118,0)
 Q
"RTN","PSIVOPT",119,0)
 ;
"RTN","PSIVOPT",120,0)
ENINP(DFN,ON) ; Entry from Inpatient Profile.
"RTN","PSIVOPT",121,0)
 N PSIVAC,ON55 S PSIVAC="PRO" D @($S(ON["V":"GT55^PSIVORFB",1:"GT531^PSIVORFA("_DFN_","""_ON_""")")),ENNH^PSIVORV2(ON)
"RTN","PSIVOPT",122,0)
 Q
"RTN","PSIVOPT",123,0)
ENLBL(PSGTOL,PSGUOW,PSGP,PSGTOO,DA,RES) ;
"RTN","PSIVOPT",124,0)
 ;Queue MAR labels for IV orders.
"RTN","PSIVOPT",125,0)
 Q:'$D(^DPT(PSGP,.1))  I '$D(PSJSYSW0) N PSJACPF,PSJACNWP S PSJACPF=11 D WP^PSJAC Q:'PSJSYSL
"RTN","PSIVOPT",126,0)
 N P,X,Y
"RTN","PSIVOPT",127,0)
 S X=$P(PSJSYSW0,U,2),Y=$P($G(^PS(55,PSGP,"IV",DA,0)),U,4)
"RTN","PSIVOPT",128,0)
 S Y=$S(Y="A":4,Y="H":5,Y="C":6,1:3) I X=1!(X[Y) D NOW^%DTC S PSGDT=% D ENL^PSGVDS S ^PS(55,DFN,"IV",DA,7)=PSGDT_U_RES
"RTN","PSIVOPT",129,0)
 Q
"RTN","PSIVOPT",130,0)
 ;
"RTN","PSIVOPT",131,0)
IVDUPADD(PSGP,ORDERNUM) ;
"RTN","PSIVOPT",132,0)
 N PSJCOM
"RTN","PSIVOPT",133,0)
 S DUPLOOP=0
"RTN","PSIVOPT",134,0)
 S DUPFOUND=0
"RTN","PSIVOPT",135,0)
 ;Loop through the additives of order to reinstate
"RTN","PSIVOPT",136,0)
 S PSJCOM=+$P($G(^PS(55,+PSGP,"IV",ORDERNUM,.2)),"^",8) F  S DUPLOOP=$O(^PS(55,PSGP,"IV",ORDERNUM,"AD",DUPLOOP)) Q:((DUPLOOP="")!(DUPFOUND))  D
"RTN","PSIVOPT",137,0)
 .;Get the additive code no.
"RTN","PSIVOPT",138,0)
 .S TARGET=$P(^PS(55,PSGP,"IV",ORDERNUM,"AD",DUPLOOP,0),"^",1)
"RTN","PSIVOPT",139,0)
 .D NOW^%DTC
"RTN","PSIVOPT",140,0)
 .S DATELOOP=%
"RTN","PSIVOPT",141,0)
 .;Loop through the current orders for the patient by date
"RTN","PSIVOPT",142,0)
 .F  S DATELOOP=$O(^PS(55,PSGP,"IV","AIS",DATELOOP)) Q:((DATELOOP="")!(DUPFOUND))  D
"RTN","PSIVOPT",143,0)
 ..S EXISTORD=""
"RTN","PSIVOPT",144,0)
 ..;Loop through the orders for date by order number
"RTN","PSIVOPT",145,0)
 ..F  S EXISTORD=$O(^PS(55,PSGP,"IV","AIS",DATELOOP,EXISTORD)) Q:((EXISTORD="")!(DUPFOUND))  D
"RTN","PSIVOPT",146,0)
 ...;Loop through additives for the existing order
"RTN","PSIVOPT",147,0)
 ...I PSJCOM>0 Q:+$P($G(^PS(55,+PSGP,"IV",EXISTORD,.2)),"^",8)
"RTN","PSIVOPT",148,0)
 ...S EXISTADD=0
"RTN","PSIVOPT",149,0)
 ...F  S EXISTADD=$O(^PS(55,PSGP,"IV",EXISTORD,"AD",EXISTADD)) Q:((EXISTADD="")!(DUPFOUND))  D 
"RTN","PSIVOPT",150,0)
 ....;Extract the Additive Code number for the Order
"RTN","PSIVOPT",151,0)
 ....S MATCHADD=$P(^PS(55,PSGP,"IV",EXISTORD,"AD",EXISTADD,0),"^",1)
"RTN","PSIVOPT",152,0)
 ....;If the existing order and the order to be reinstated have the same additive code then return FOUND=TRUE
"RTN","PSIVOPT",153,0)
 ....I MATCHADD=TARGET D
"RTN","PSIVOPT",154,0)
 .....S DUPFOUND=1
"RTN","PSIVOPT",155,0)
 Q DUPFOUND
"RTN","PSIVOPT",156,0)
 ;
"RTN","PSIVOPT",157,0)
VA200(X) ;Return the IEN for the user.
"RTN","PSIVOPT",158,0)
 ; X = User name
"RTN","PSIVOPT",159,0)
 NEW DIC,Y S DIC="^VA(200,",DIC(0)="NZ" D ^DIC
"RTN","PSIVOPT",160,0)
 I +Y=-1 Q ""
"RTN","PSIVOPT",161,0)
 Q $P(Y,U)
"RTN","PSIVOPT1")
0^95^B44616556
"RTN","PSIVOPT1",1,0)
PSIVOPT1 ;BIR/MLM-EDIT/DC ORDER (BACKDOOR) ;22 OCT 97 / 3:14 PM
"RTN","PSIVOPT1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**29,58,101,110,127,181**;16 DEC 97;Build 190
"RTN","PSIVOPT1",3,0)
 ;
"RTN","PSIVOPT1",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIVOPT1",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSIVOPT1",6,0)
 ;
"RTN","PSIVOPT1",7,0)
E ; Edit order through Pharmacy.
"RTN","PSIVOPT1",8,0)
 NEW PSJEDFLG
"RTN","PSIVOPT1",9,0)
 D GSTRING^PSIVORE1,GTFLDS^PSIVORFE
"RTN","PSIVOPT1",10,0)
 I '$G(PSIVENO) S PSIVENO=1 D EN^VALM("PSJ LM IV AC/EDIT") S VALMBCK="Q"
"RTN","PSIVOPT1",11,0)
 Q
"RTN","PSIVOPT1",12,0)
ACCEPT ; To be called by ACCEPT^PSJLIACT
"RTN","PSIVOPT1",13,0)
 NEW PSIVDSFG
"RTN","PSIVOPT1",14,0)
 I $G(PSJEDFLG) S VALMBCK="" Q
"RTN","PSIVOPT1",15,0)
 ;I '$G(PSJEDIT1) D CKNEW I PSIVCHG D
"RTN","PSIVOPT1",16,0)
 D CKNEW
"RTN","PSIVOPT1",17,0)
 D:'$G(PSGORQF) DOSING
"RTN","PSIVOPT1",18,0)
 Q:$G(PSGORQF)
"RTN","PSIVOPT1",19,0)
 ;Don't create new order if Inf rate changed not supposed too set PSIVCHG=1
"RTN","PSIVOPT1",20,0)
 I PSIVCHG,'$G(PSJEDIT1) D
"RTN","PSIVOPT1",21,0)
 .S P("OLDON")=ON55,Y=$G(^PS(55,DFN,"IV",+ON55,0)) D NOW^%DTC S P("LOG")=$E(%,1,12)
"RTN","PSIVOPT1",22,0)
 .S P("CLRK")=DUZ_U_$P($G(^VA(200,DUZ,0)),U)
"RTN","PSIVOPT1",23,0)
 .I $G(PSGSDX)!$G(PSGFDX) Q
"RTN","PSIVOPT1",24,0)
 .I $P(Y,U,2)=P(2),$P(Y,U,3)=P(3) D ENT^PSIVCAL S X=P(2),%DT="T" D ^%DT S P(2)=$E(Y,1,12),PSJEDIT1=1 D ENSTOP^PSIVCAL
"RTN","PSIVOPT1",25,0)
 K PSJEDFLG
"RTN","PSIVOPT1",26,0)
 I $G(PSGORQF) S VALMBCK="Q" W !,"Order unchanged." D PAUSE^PSJMISC(1,) Q
"RTN","PSIVOPT1",27,0)
 D OK^PSIVOPT2
"RTN","PSIVOPT1",28,0)
 I X["N" S VALMBCK="R" Q
"RTN","PSIVOPT1",29,0)
 I X["^" D GT55^PSIVORFB W !,"Order unchanged." Q
"RTN","PSIVOPT1",30,0)
 ;;I $G(P(21))]"" D CKNEW,@$S(PSIVCHG:"NEWORD",1:"UPDATE") Q:$D(X)
"RTN","PSIVOPT1",31,0)
 I $G(P("21FLG"))]"" D CKNEW,@$S(PSIVCHG:"NEWORD",1:"UPDATE") Q:$D(X)
"RTN","PSIVOPT1",32,0)
 ;;S PSJORL=$$ENORL^PSJUTL($G(VAIN(4))) S ON=ON55,OD=P(2) D EN^PSIVORE,^PSIVORE1
"RTN","PSIVOPT1",33,0)
 S PSJORL=$$ENORL^PSJUTL($G(VAIN(4))) S ON=ON55,OD=P(2)
"RTN","PSIVOPT1",34,0)
 ;D:ON["V" EN^PSIVORE,^PSIVORE1
"RTN","PSIVOPT1",35,0)
 D:ON["V" EN^PSIVORE
"RTN","PSIVOPT1",36,0)
 ;;I $G(PSJIVORF),PSIVCHG D EN1^PSJHL2(DFN,"SN",+ON55_"V","NEW ORDER") NEW PSIVXX S PSIVXX=$$LS^PSSLOCK(DFN,+ON55_"V")
"RTN","PSIVOPT1",37,0)
 I $G(PSJIVORF),PSIVCHG D EN1^PSJHL2(DFN,"SN",ON55,"NEW ORDER") NEW PSIVXX S PSIVXX=$$LS^PSSLOCK(DFN,ON55)
"RTN","PSIVOPT1",38,0)
 S PSIVACEP=1
"RTN","PSIVOPT1",39,0)
 Q
"RTN","PSIVOPT1",40,0)
 ;
"RTN","PSIVOPT1",41,0)
DOSING ;
"RTN","PSIVOPT1",42,0)
 NEW TMPDRG
"RTN","PSIVOPT1",43,0)
 ;PSIVDSFG is set when changes to fields (except Schedule for continuous IV type) that caused a new order to create.
"RTN","PSIVOPT1",44,0)
 D TMPDRG^PSJMISC(DFN,$G(ON55),.TMPDRG)
"RTN","PSIVOPT1",45,0)
 I $S($G(PSIVDSFG):0,$G(PSIVCHG):1,1:0)!$$COMPARE^PSJMISC(.DRG,.TMPDRG,$S(P("DTYP")=1:0,1:1))!$$INFRATE^PSJMISC(DFN,ON55,P(8),P("DTYP")) D
"RTN","PSIVOPT1",46,0)
 . D IN^PSJOCDS($G(ON),"IV","")
"RTN","PSIVOPT1",47,0)
 I $G(PSGORQF) S VALMBCK="Q"
"RTN","PSIVOPT1",48,0)
 Q
"RTN","PSIVOPT1",49,0)
CKNEW ; Check if new order is to be created.
"RTN","PSIVOPT1",50,0)
 N DNE,ND,TDRG,PSJCHG,TMPDRG S (DNE,PSIVCHG,PSIVDSFG)=0
"RTN","PSIVOPT1",51,0)
 Q:PSIVCHG
"RTN","PSIVOPT1",52,0)
 D TMPDRG^PSJMISC(DFN,$G(ON55),.TMPDRG)
"RTN","PSIVOPT1",53,0)
 I $$COMPARE^PSJMISC(.DRG,.TMPDRG,$S(P("DTYP")=1:0,1:1)) S PSIVCHG=1
"RTN","PSIVOPT1",54,0)
 K TMPDRG
"RTN","PSIVOPT1",55,0)
 Q:PSIVCHG
"RTN","PSIVOPT1",56,0)
 F DRGT="AD","SOL" F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI  I $P(P("OT"),U)="F",'$P(DRG(DRGT,DRGI),U,5) S P("OT")="I"
"RTN","PSIVOPT1",57,0)
 ;I $G(DRG("AD",0))+$S(P("DTYP")=1:0,1:+$G(DRG("SOL",0)))'=DRG("DRGC") S PSIVCHG=1 Q
"RTN","PSIVOPT1",58,0)
 S ND(0)=$G(^PS(55,DFN,"IV",+ON55,0)),ND("PD")=$G(^PS(55,DFN,"IV",+ON55,.2))
"RTN","PSIVOPT1",59,0)
 N X S X=$S($P(ND(0),U,8)["@":$P($P(ND(0),U,8),"@"),1:$P(ND(0),U,8))
"RTN","PSIVOPT1",60,0)
 S ND=$S($E(P("OT"))="I":$P(ND("PD"),U,1,2)_U,1:"")_$P(ND("PD"),U,3)_U_$S($E(P("OT"))'="I":X_U,1:"")_+$P(ND(0),U,6)_U_$P(ND(0),U,2)_U_$P(ND(0),U,3)
"RTN","PSIVOPT1",61,0)
 S:ND'=($S($E(P("OT"))="I":+P("PD")_U_$G(P("DO"))_U,1:"")_+P("MR")_U_$S($E(P("OT"))'="I":$S(P(8)["@":$P(P(8),"@"),1:P(8))_U,1:"")_+P(6)_U_P(2)_U_P(3)) PSIVCHG=1
"RTN","PSIVOPT1",62,0)
 I 'PSIVCHG I $P(ND(0),U,9)'=P(9) S:(P("DTYP")'=1) PSIVDSFG=1 S PSIVCHG=1
"RTN","PSIVOPT1",63,0)
 ;S ND=$S($E(P("OT"))="I":$P(ND("PD"),U,1,2)_U,1:"")_$P(ND("PD"),U,3)_U_$S($E(P("OT"))'="I":X_U,1:"")_+$P(ND(0),U,6)_U_$P(ND(0),U,2)_U_$P(ND(0),U,3)_U_$P(ND(0),U,9)
"RTN","PSIVOPT1",64,0)
 ;S:ND'=($S($E(P("OT"))="I":+P("PD")_U_$G(P("DO"))_U,1:"")_+P("MR")_U_$S($E(P("OT"))'="I":$S(P(8)["@":$P(P(8),"@"),1:P(8))_U,1:"")_+P(6)_U_P(2)_U_P(3)_U_P(9)) PSIVCHG=1
"RTN","PSIVOPT1",65,0)
 ;* S ND=$S($E(P("OT"))="I":$P(ND("PD"),U,1,2)_U,1:"")_$P(ND("PD"),U,3)_U_$S($E(P("OT"))'="I":$P(ND(0),U,8)_U,1:"")_+$P(ND(0),U,6)_U_$P(ND(0),U,2)_U_$P(ND(0),U,3)_U_$P(ND(0),U,9)
"RTN","PSIVOPT1",66,0)
 ;* S:ND'=($S($E(P("OT"))="I":+P("PD")_U_$G(P("DO"))_U,1:"")_+P("MR")_U_$S($E(P("OT"))'="I":P(8)_U,1:"")_+P(6)_U_P(2)_U_P(3)_U_P(9)) PSIVCHG=1
"RTN","PSIVOPT1",67,0)
 Q
"RTN","PSIVOPT1",68,0)
 ;
"RTN","PSIVOPT1",69,0)
UPDATE ; Update original order.
"RTN","PSIVOPT1",70,0)
 S PSIVALT=1,PSIVALCK="EN",PSIVREA="E",ON=ON55 K P("OLDON") D LOG^PSIVORAL
"RTN","PSIVOPT1",71,0)
 D SET55^PSIVORFB,ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,"E")
"RTN","PSIVOPT1",72,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN K X Q:'PSJIVORF
"RTN","PSIVOPT1",73,0)
 S PSJORIFN=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,21) Q:'PSJORIFN
"RTN","PSIVOPT1",74,0)
 S P("NAT")=""
"RTN","PSIVOPT1",75,0)
 D EN1^PSJHL2(DFN,"XX",+ON55_"V","UPDATED ORDER")
"RTN","PSIVOPT1",76,0)
 K X
"RTN","PSIVOPT1",77,0)
 Q
"RTN","PSIVOPT1",78,0)
 ;
"RTN","PSIVOPT1",79,0)
NEWORD ; DC orig. order, get new order no.
"RTN","PSIVOPT1",80,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN I PSJIVORF D NATURE^PSIVOREN I '$D(P("NAT")) S X=1 W !,"Order unchanged." Q
"RTN","PSIVOPT1",81,0)
 ;;S P("RES")="E",P("OLDON")=ON55,P(16)="" K ON55 D NEW55^PSIVORFB S (P("PON"),P("NEWON"),ON)=ON55,ON55=P("OLDON")
"RTN","PSIVOPT1",82,0)
 S P("RES")="E",P("OLDON")=ON55,P(16)=""
"RTN","PSIVOPT1",83,0)
 Q:$$NONVF()
"RTN","PSIVOPT1",84,0)
 I '($G(PSIVCOPY)=2) K ON55 D NEW55^PSIVORFB
"RTN","PSIVOPT1",85,0)
 S (P("PON"),P("NEWON"),ON)=ON55,ON55=P("OLDON") S:($G(PSIVCOPY)=2) P("OLDON")=""
"RTN","PSIVOPT1",86,0)
 I $P($G(^PS(55,DFN,"IV",+P("OLDON"),0)),U,17)="A" D D1^PSIVOPT2 D
"RTN","PSIVOPT1",87,0)
 . I PSJIVORF,$P($G(^PS(55,DFN,"IV",+ON55,0)),U,21) D EN1^PSJHL2(DFN,"OD",+ON55_"V","ORDER DISCONTINUED")
"RTN","PSIVOPT1",88,0)
 . ;;S P(21)="" W !!,"Original order discontinued...",!!
"RTN","PSIVOPT1",89,0)
 . S P("21FLG")="" W !!,"Original order discontinued...",!!
"RTN","PSIVOPT1",90,0)
 . D UNL^PSSLOCK(DFN,+ON55_"V")
"RTN","PSIVOPT1",91,0)
 F ON55=P("NEWON"),P("OLDON") K DA,DIE,DR D
"RTN","PSIVOPT1",92,0)
 .S DA(1)=DFN,DA=+ON55,DIE="^PS(55,"_DFN_",""IV"",",DR=$S((ON55=P("NEWON")&(+ON55'=+P("OLDON"))):"113////"_P("OLDON")_";122////E",1:"114////"_P("NEWON")_";123////E") D ^DIE
"RTN","PSIVOPT1",93,0)
 .I ON55=P("NEWON") N CLINAPPT S CLINAPPT=$G(^PS(55,DFN,"IV",+P("OLDON"),"DSS")) D
"RTN","PSIVOPT1",94,0)
 ..S:CLINAPPT DR=DR_";136////"_+CLINAPPT S:$P(CLINAPPT,"^",2) DR=DR_";139////"_$P(CLINAPPT,"^",2)
"RTN","PSIVOPT1",95,0)
 .D ^DIE
"RTN","PSIVOPT1",96,0)
 .Q:ON55=P("OLDON")&($P($G(^PS(55,DFN,"IV",+P("OLDON"),0)),U,17)'="D")
"RTN","PSIVOPT1",97,0)
 .D:ON55=P("NEWON") SET55^PSIVORFB
"RTN","PSIVOPT1",98,0)
 .D:ON55=P("NEWON") VF1^PSJLIACT("","",0)
"RTN","PSIVOPT1",99,0)
 .D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,$S(ON55=P("NEWON"):"N",1:"DE"))
"RTN","PSIVOPT1",100,0)
 .S PSIVREA="E",PSIVAL="Order "_$S(ON55=P("OLDON"):"discontinued",1:"created")_" due to edit" S:ON55=P("OLDON") PSIVALCK="STOP" D LOG^PSIVORAL
"RTN","PSIVOPT1",101,0)
 L -^PS(55,DFN,"IV",+P("OLDON")) ;D NEWENT^PSIVORFE
"RTN","PSIVOPT1",102,0)
 K X S ON55=P("NEWON"),P(17)="A" Q:'PSJIVORF  D SET^PSIVORFE
"RTN","PSIVOPT1",103,0)
 Q
"RTN","PSIVOPT1",104,0)
 ;
"RTN","PSIVOPT1",105,0)
NEWSTOP ; Set stop date for DC and renewals.
"RTN","PSIVOPT1",106,0)
 S ND=$G(^PS(55,DFN,"IV",+ON55,0)),Y=+$P(ND,U,3),$P(^PS(55,DFN,"IV",+P("OLDON"),2),U,7)=Y,NSTOP=$S(NSTOP>Y:Y,1:NSTOP),$P(^PS(55,DFN,"IV",+ON55,0),U,3)=NSTOP
"RTN","PSIVOPT1",107,0)
 K DA,DIK S DIK="^PS(55,"_DFN_",""IV"",",DA(1)=DFN,DA=+P("OLDON") D IX^DIK K DA,DIK
"RTN","PSIVOPT1",108,0)
 Q
"RTN","PSIVOPT1",109,0)
NONVF()   ;
"RTN","PSIVOPT1",110,0)
 NEW PSGOEAV S PSGOEAV=+$P(PSJSYSP0,U,9)
"RTN","PSIVOPT1",111,0)
 I +PSJSYSU=3,PSGOEAV Q 0
"RTN","PSIVOPT1",112,0)
 I +PSJSYSU=1,PSGOEAV Q 0
"RTN","PSIVOPT1",113,0)
 K DA D ENGNN^PSGOETO S (ON,P("NEWON"))=DA_"P",P(17)="N"
"RTN","PSIVOPT1",114,0)
 S (P("DO"),P("PD"))=""
"RTN","PSIVOPT1",115,0)
 D GTPD^PSIVORE2,PUT531^PSIVORFA
"RTN","PSIVOPT1",116,0)
 I $P($G(^PS(55,DFN,"IV",+P("OLDON"),0)),U,17)="A" D D1^PSIVOPT2 D
"RTN","PSIVOPT1",117,0)
 . I PSJIVORF,$P($G(^PS(55,DFN,"IV",+P("OLDON"),0)),U,21) D EN1^PSJHL2(DFN,"OD",+ON55_"V","ORDER DISCONTINUED")
"RTN","PSIVOPT1",118,0)
 . S P("21FLG")="" W !!,"Original order discontinued...",!!
"RTN","PSIVOPT1",119,0)
 . D UNL^PSSLOCK(DFN,+P("OLDON")_"V")
"RTN","PSIVOPT1",120,0)
 F ON55=P("NEWON"),P("OLDON") K DA,DIE,DR D
"RTN","PSIVOPT1",121,0)
 . S DA=+ON55
"RTN","PSIVOPT1",122,0)
 . S:ON55=P("NEWON") DIE="^PS(53.1,",DR="104////"_P("OLDON")_";103////E"
"RTN","PSIVOPT1",123,0)
 . S:ON55=P("OLDON") DA(1)=DFN,DIE="^PS(55,"_DFN_",""IV"",",DR="114////"_P("NEWON")_";123////E"
"RTN","PSIVOPT1",124,0)
 . D ^DIE
"RTN","PSIVOPT1",125,0)
 . Q:ON55=P("OLDON")&($P($G(^PS(55,DFN,"IV",+P("OLDON"),0)),U,17)'="D")
"RTN","PSIVOPT1",126,0)
 . I ON55=P("OLDON") D
"RTN","PSIVOPT1",127,0)
 .. D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,$S(ON55=P("NEWON"):"N",1:"DE"))
"RTN","PSIVOPT1",128,0)
 .. S PSIVALT="",PSIVREA="E",PSIVAL="Order discontinued due to edit" S PSIVALCK="STOP" D LOG^PSIVORAL
"RTN","PSIVOPT1",129,0)
 . D:ON55=P("NEWON") NEWNVAL^PSGAL5(ON55,4100,"","")
"RTN","PSIVOPT1",130,0)
 L -^PS(55,DFN,"IV",+P("OLDON"))
"RTN","PSIVOPT1",131,0)
 K X S (ON,ON55)=P("NEWON")
"RTN","PSIVOPT1",132,0)
 D EN1^PSJHL2(DFN,"SN",ON,"ORDER CREATED")
"RTN","PSIVOPT1",133,0)
 S X=$$LS^PSSLOCK(DFN,ON)
"RTN","PSIVOPT1",134,0)
 D GT531^PSIVORFA(DFN,ON)
"RTN","PSIVOPT1",135,0)
 I ON["P" N CLINAPPT S CLINAPPT=$G(^PS(55,DFN,"IV",+ON,"DSS")) I CLINAPPT D  K DIE,DA,DR
"RTN","PSIVOPT1",136,0)
 . S:CLINAPPT DR="136////"_+CLINAPPT_";" S:$P(CLINAPPT,"^",2) DR=DR_"139////"_$P(CLINAPPT,"^",2)_";" D ^DIE
"RTN","PSIVOPT1",137,0)
 S VALMBCK="Q"
"RTN","PSIVOPT1",138,0)
 S PSGACT="EL"
"RTN","PSIVOPT1",139,0)
 I P(17)="N",(P("OLDON")=""),(P("CLRK")=DUZ) S PSGACT="ELD"
"RTN","PSIVOPT1",140,0)
 I +PSJSYSU=3!(+PSJSYSU=1) S PSGACT="DELV"
"RTN","PSIVOPT1",141,0)
 Q 1
"RTN","PSIVOPT2")
0^26^B36149205
"RTN","PSIVOPT2",1,0)
PSIVOPT2 ;BIR/PR,MLM-OPTION DRIVER (CONT) ;02 Mar 99 / 9:27 AM
"RTN","PSIVOPT2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**23,29,58,110,127,133,135,157,181**;16 DEC 97;Build 190
"RTN","PSIVOPT2",3,0)
 ;
"RTN","PSIVOPT2",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSIVOPT2",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSIVOPT2",6,0)
 ;
"RTN","PSIVOPT2",7,0)
D ; Discontinue order.
"RTN","PSIVOPT2",8,0)
 D NATURE^PSIVOREN I '$D(P("NAT")) W !,$C(7),"Order Unchanged." S COMQUIT=1 Q
"RTN","PSIVOPT2",9,0)
 ;* 8/2* D EN1^PSJHL2(DFN,"OD",+ON55_"V","ORDER DISCONTINUED"),D1
"RTN","PSIVOPT2",10,0)
 I '$$REQPROV^PSGOEC W !,$C(7),"Order Unchanged." S COMQUIT=1 Q
"RTN","PSIVOPT2",11,0)
 I 'PSJCOM D
"RTN","PSIVOPT2",12,0)
 .D D1
"RTN","PSIVOPT2",13,0)
 .S PSIVALT=1,PSIVALCK="STOP",PSIVREA="D",ON=ON55 D LOG^PSIVORAL S P(3)=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3)
"RTN","PSIVOPT2",14,0)
 I PSJCOM N COMFLG S COMFLG=0 D
"RTN","PSIVOPT2",15,0)
 .I ON55'["P" N COMFLG,O,OO S (COMFLG,O)=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  Q:COMFLG  D
"RTN","PSIVOPT2",16,0)
 .. Q:OO=ON55  I '$$LS^PSSLOCK(DFN,OO) S COMFLG=1 Q
"RTN","PSIVOPT2",17,0)
 I PSJCOM Q:COMFLG  N O,OO S O=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  D
"RTN","PSIVOPT2",18,0)
 .I OO["V" S ON55=OO D D1 S PSIVALT=1,PSIVALCK="STOP",PSIVREA="D",ON=ON55 D LOG^PSIVORAL N PSJORD S P(3)=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3),PSJORD=ON55 D HL^PSIVORA Q
"RTN","PSIVOPT2",19,0)
 .I OO["U" N PSGORD,PSJORD,PSJNOO K DA D NOW^%DTC S PSGDT=%,T=$E("T",'PSJSYSU),PSGALR=20,PSGP=DFN,DA=+OO,DA(1)=PSGP,(PSGORD,PSJORD)=OO,PSJNOO=P("NAT") D
"RTN","PSIVOPT2",20,0)
 ..S CF=$S($P(PSJSYSP0,U,5):1,PSGORD["U":0,1:($P($G(^PS(53.1,+PSGORD,0)),U,25)=""&($P($G(^(4)),U,7)=DUZ)))  D ASET^PSGOEC,AC^PSGOEC
"RTN","PSIVOPT2",21,0)
 Q
"RTN","PSIVOPT2",22,0)
D1 N %,DA,DIE,DIU,STP,NSTOP
"RTN","PSIVOPT2",23,0)
 S NSTOP=$$DATE^PSJUTL2(),STP=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3),NSTOP=+$S(STP>NSTOP:NSTOP,1:STP),P(17)="D"
"RTN","PSIVOPT2",24,0)
 K TMP
"RTN","PSIVOPT2",25,0)
 S TMP(55.01,""_+ON55_","_DFN_","_"",109)=NSTOP
"RTN","PSIVOPT2",26,0)
 S:'$P($G(^PS(55,DFN,"IV",+ON55,2)),U,7) TMP(55.01,""_+ON55_","_DFN_","_"",116)=STP
"RTN","PSIVOPT2",27,0)
 S TMP(55.01,""_+ON55_","_DFN_","_"",100)="D"
"RTN","PSIVOPT2",28,0)
 S TMP(55.01,""_+ON55_","_DFN_","_"",157)=""
"RTN","PSIVOPT2",29,0)
 S TMP(55.01,""_+ON55_","_DFN_","_"",.03)=NSTOP
"RTN","PSIVOPT2",30,0)
 S PSIVACT=1
"RTN","PSIVOPT2",31,0)
 D FILE^DIE("","TMP")
"RTN","PSIVOPT2",32,0)
 K TMP
"RTN","PSIVOPT2",33,0)
 I $S($G(PSIVAC)="OD":0,$G(PSIVAC)'="AD":1,$G(PSGALO)<1060:0,1:$P($G(PSJSYSW0),U,15)) S X=$S($G(PSIVAC)="AD":1,1:2) D ENLBL^PSIVOPT(X,$S(X=1:+$G(PSGUOW),1:DUZ),DFN,3,+ON55,$E("AD",1,3-X))
"RTN","PSIVOPT2",34,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN Q:'PSJIVORF  ;* S ORIFN=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,21) Q:'ORIFN
"RTN","PSIVOPT2",35,0)
 Q
"RTN","PSIVOPT2",36,0)
 ;
"RTN","PSIVOPT2",37,0)
R ; Renew order.
"RTN","PSIVOPT2",38,0)
 ;I PSJCOM D RIV^PSJCOMR Q
"RTN","PSIVOPT2",39,0)
 I PSJCOM D ^PSJCOMR Q
"RTN","PSIVOPT2",40,0)
 I P(17)="D",P(12) N ERR D RI W:$G(ERR)=1 $C(7),"  Order unchanged." I $G(ERR)<2 S COMQUIT=1 Q
"RTN","PSIVOPT2",41,0)
 I $G(PSGORQF) S COMQUIT=1 Q
"RTN","PSIVOPT2",42,0)
 ;PSJOCFLG is killed of after the OC is performed.  The Dosing is still need to trigger(again) if the 
"RTN","PSIVOPT2",43,0)
 ;  user said "no" at OK prompt and a new stop date is entered.
"RTN","PSIVOPT2",44,0)
 NEW PSJOCFLG S PSJOCFLG=1
"RTN","PSIVOPT2",45,0)
 ;
"RTN","PSIVOPT2",46,0)
R1 ;
"RTN","PSIVOPT2",47,0)
 I $$EXPIRED^PSGOER(DFN,ON55) D  Q
"RTN","PSIVOPT2",48,0)
 .W !?3,"  THIS ORDER HAS BEEN INACTIVE FOR ONE OR MORE SCHEDULED ADMINISTRATIONS"
"RTN","PSIVOPT2",49,0)
 .W !?20,"  AND CANNOT BE RENEWED!"
"RTN","PSIVOPT2",50,0)
 N PSJRNWDT,PSJOSTOP,OREASON S PSJRNWDT=$$DATE2^PSJUTL2(PSGDT) S:$G(ON55) PSJOSTOP=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3) I '(PSJOSTOP>P(2)),$G(PSGDT) S PSJOSTOP=PSGDT
"RTN","PSIVOPT2",51,0)
 S (PSIVOK,EDIT)="25^1" S P2=P(2),P(2)=PSJRNWDT D EDIT^PSIVEDT S P(2)=P2 K P2 I X="^" Q
"RTN","PSIVOPT2",52,0)
 NEW PSGORQF K PSGORQF S PSIVRNFG=1 D:$G(PSJOCFLG) OC^PSIVOC K PSJOCFLG D:'$G(PSGORQF) IN^PSJOCDS($G(ON55),"IV","") K PSIVRNFG W ! Q:$G(PSGORQF)
"RTN","PSIVOPT2",53,0)
 S P(11)=$$ENRNAT^PSGOU($P($G(^PS(55,DFN,"IV",+ON55,2)),U,10),+VAIN(4),P(9),P(11))
"RTN","PSIVOPT2",54,0)
 D OK G:X["N" R1 I X=U D RD Q
"RTN","PSIVOPT2",55,0)
 S PSIVCHG=2
"RTN","PSIVOPT2",56,0)
 S P(17)="A",OREASON=P("RES"),P("RES")="R",P("FRES")="" D:'$D(PSJIVORF) ORPARM^PSIVOREN I PSJIVORF D  Q:'$D(P("NAT"))
"RTN","PSIVOPT2",57,0)
 .D NATURE^PSIVOREN I '$D(P("NAT")) D RD Q
"RTN","PSIVOPT2",58,0)
 .S ON=ON55
"RTN","PSIVOPT2",59,0)
 S P(16)="",PSJORIFN="",PSIVACT=1,P("21FLG")="",P("RES")=OREASON D SET55^PSIVORFB
"RTN","PSIVOPT2",60,0)
 D:$P(^PS(55,DFN,"IV",+ON55,0),U,17)="A" RUPDATE^PSIVOREN(DFN,ON55,P(2))
"RTN","PSIVOPT2",61,0)
 I PSJIVORF,$P(^PS(55,DFN,"IV",+ON55,0),U,17)'="A" S X=$$LS^PSSLOCK(DFN,+ON55_"V") D
"RTN","PSIVOPT2",62,0)
 .D EXPOE^PSGOER(DFN,ON55)
"RTN","PSIVOPT2",63,0)
 .S P("RES")="R",PSJREN=1
"RTN","PSIVOPT2",64,0)
 .D ENUDTX^PSJOREN(DFN,ON55,"NR"),EN1^PSJHL2(DFN,"SN",+ON55_"V","ORDER RENEWED"),UPDREN(DFN,ON55,PSJRNWDT,P(6),PSJOSTOP,P("NAT"))
"RTN","PSIVOPT2",65,0)
 S OD=P(2)
"RTN","PSIVOPT2",66,0)
 D VF1^PSJLIACT("","",1),UNL^PSSLOCK(DFN,+ON55_"V")
"RTN","PSIVOPT2",67,0)
 D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,"R")
"RTN","PSIVOPT2",68,0)
 I $G(PSJOSTOP),$G(ON55),$G(DFN) D STIX^PSIVOREN(PSJOSTOP,ON55,DFN)
"RTN","PSIVOPT2",69,0)
 Q
"RTN","PSIVOPT2",70,0)
 ;
"RTN","PSIVOPT2",71,0)
RD ; Delete for renew.
"RTN","PSIVOPT2",72,0)
 ;Q:'$G(PSJVFY)
"RTN","PSIVOPT2",73,0)
 ;D DEL55^PSIVORE2 S (ON55,P("OLDON"))=P("PON") D GT55^PSIVORFB
"RTN","PSIVOPT2",74,0)
 Q
"RTN","PSIVOPT2",75,0)
 ;
"RTN","PSIVOPT2",76,0)
OK ;Print example label, run order through checker, ask if it is ok.
"RTN","PSIVOPT2",77,0)
 S P16=0,PSIVEXAM=1,(PSIVNOL,PSIVCT)=1 D GTOT^PSIVUTL(P(4)) I ($G(P("PD"))="") D GTPD^PSIVORE2
"RTN","PSIVOPT2",78,0)
 D ^PSIVCHK I $D(DUOUT) S X="^",COMQUIT=1 Q
"RTN","PSIVOPT2",79,0)
 I ERR=1 S X="N",COMQUIT=1 Q
"RTN","PSIVOPT2",80,0)
 W ! D ^PSIVORLB K PSIVEXAM S Y=P(2) W !,"Start date: " X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),?30," Stop date: " S Y=P(3) X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),!
"RTN","PSIVOPT2",81,0)
 ;PSJ*5*157 EFD FOR IV
"RTN","PSIVOPT2",82,0)
 D EFDIV^PSJUTL($G(ZZND))
"RTN","PSIVOPT2",83,0)
 I $G(PSIVCHG),($G(PSIVREA)'="R") W !,"*** This change will cause a new order to be created. ***"
"RTN","PSIVOPT2",84,0)
 S X="Is this O.K.: ^"_$S(ERR:"N",1:"Y")_"^^NO"_$S(ERR'=1:",YES",1:"") D ENQ^PSIV I X["?" S HELP="OK" D ^PSIVHLP G OK
"RTN","PSIVOPT2",85,0)
 Q
"RTN","PSIVOPT2",86,0)
 ;
"RTN","PSIVOPT2",87,0)
RI ; Reinstate Auto-DC'ed order.
"RTN","PSIVOPT2",88,0)
 N DA,DIE,DIR,DIU,DR,PSIVACT,PSIVALT,PSIVALCK,PSIVREA W !!,$C(7),"This order has been Auto-DC'ed."
"RTN","PSIVOPT2",89,0)
 S DIR(0)="Y",DIR("A")="Reinstate this order" D ^DIR K DIR I 'Y S ERR=1 Q
"RTN","PSIVOPT2",90,0)
 D NOW^%DTC I %>$P($G(^PS(55,DFN,"IV",+ON55,2)),U,7) D
"RTN","PSIVOPT2",91,0)
 .K DIR S ERR=1,DIR(0)="Y",DIR("A",1)="The original stop date of this order has past.",DIR("A")="Do you wish to renew this order" D ^DIR K DIR S ERR=$S(Y:2,1:1)
"RTN","PSIVOPT2",92,0)
 Q:$G(ERR)  S X=$G(^VA(200,+P(6),"PS")) I $S('X:1,'$P(X,U,4):0,DT<$P(X,U,4):0,1:1) S ERR=1
"RTN","PSIVOPT2",93,0)
 I $G(ERR) W !!,$C(7),"This order's provider is no longer valid. Please enter a valid provider." S (EDIT,PSIVOK)=1 D EDIT^PSIVEDT I $G(DONE) W $C(7),"Order unchanged." S ERR=1 Q
"RTN","PSIVOPT2",94,0)
 N PSGALO S PSGALO=18530 D ENARI^PSIVOPT(DFN,ON,DUZ,PSGALO)
"RTN","PSIVOPT2",95,0)
 Q
"RTN","PSIVOPT2",96,0)
 ;
"RTN","PSIVOPT2",97,0)
UPDREN(DFN,ORD,RNWDT,PROV,OSTOPDT,PSJNOO) ;
"RTN","PSIVOPT2",98,0)
 Q:'DFN!'ORD!'RNWDT!'PROV!'OSTOPDT!(PSJNOO="")
"RTN","PSIVOPT2",99,0)
 K DR,DA,DIC,DIE,DD,DO N ND0,PSGOEORD
"RTN","PSIVOPT2",100,0)
 S DIC="^PS(55,"_DFN_",""IV"","_+ORD S ND0=$G(@(DIC_",0)")),PSGOEORD=$P(ND0,"^",21) I $G(ON)["P",$G(PSGOLDOE) S PSGOEORD=PSGOLDOE
"RTN","PSIVOPT2",101,0)
 S DIC=DIC_",14,",DIC(0)="L",DIC("P")="55.1138DA",ND14=$G(@(DIC_"0)")),DINUM=$P(ND14,"^",3)+1,DA(2)=DFN,DA(1)=+ORD D
"RTN","PSIVOPT2",102,0)
 .S DIC("DR")=".01////"_$G(RNWDT)_";1////"_$G(DUZ)_";2////"_$G(PROV)_";3////"_$G(OSTOPDT)_";4////"_+PSGOEORD,X=$G(RNWDT) D FILE^DICN
"RTN","PSIVOPT2",103,0)
 .Q
"RTN","PSIVOPT2",104,0)
 K DO,DINUM
"RTN","PSIVORC1")
0^34^B45810564
"RTN","PSIVORC1",1,0)
PSIVORC1 ;BIR/MLM-PROCESS INCOMPLETE IV ORDER - CONT ;13 Jan 98 / 11:36 AM
"RTN","PSIVORC1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,37,69,110,157,134,181**;16 DEC 97;Build 190
"RTN","PSIVORC1",3,0)
 ;
"RTN","PSIVORC1",4,0)
 ; Reference to ^DD("DD" is supported by DBIA 10017.
"RTN","PSIVORC1",5,0)
 ; Reference to ^DD( is supported by DBIA 2255.
"RTN","PSIVORC1",6,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSIVORC1",7,0)
 ; Reference to ^%DT is supported by DBIA 10003.
"RTN","PSIVORC1",8,0)
 ; Reference to ^%DTC is supported by DBIA 10000.
"RTN","PSIVORC1",9,0)
 ; Reference to ^DID is supported by DBIA 2052.
"RTN","PSIVORC1",10,0)
 ; Reference to ^VALM is supported by DBIA 10118.
"RTN","PSIVORC1",11,0)
 ; Reference to ^PS(51.1 supported by DBIA #2177.
"RTN","PSIVORC1",12,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSIVORC1",13,0)
 ;
"RTN","PSIVORC1",14,0)
53 ; IV Type
"RTN","PSIVORC1",15,0)
 I $G(PSGORD)["P",$G(PSGAT),($G(P(9))]"") D
"RTN","PSIVORC1",16,0)
 .N X,PSGS0Y,ZZ,LYN,ZZND,ZZNDW S X=P(9) S PSGS0Y="",ZZ=0 D FIND^DIC(51.1,,,,X,,"APPSJ",,,"LYN")
"RTN","PSIVORC1",17,0)
 .S ZZ=$O(LYN("DILIST",2,ZZ)) I ZZ S ZZ=+LYN("DILIST",2,ZZ) I ZZ S ZZND=$G(^PS(51.1,ZZ,0)) S PSGST=$P(ZZND,U,5),PSGS0XT=$P(ZZND,U,3) I $G(PSJPWD) D
"RTN","PSIVORC1",18,0)
 ..N ZZNDW S ZZNDW=$G(^PS(51.1,ZZ,1,PSJPWD,0)) I $P(ZZNDW,"^",2)]"" S PSGS0Y=$P(ZZNDW,"^",2),$P(ZZND,"^",2)=PSGS0Y
"RTN","PSIVORC1",19,0)
 .S ZZ=0 F  S ZZ=$O(LYN("DILIST",1,ZZ)) Q:'ZZ  I $G(LYN("DILIST",1,ZZ))'=X K LYN("DILIST",1,ZZ),LYN("DILIST",2,ZZ),LYN("DILIST","ID",ZZ,1)
"RTN","PSIVORC1",20,0)
 .I $D(PSJPWD) S ZZ=0 F  S ZZ=$O(LYN("DILIST",2,ZZ)) Q:'ZZ  I $P($G(^PS(51.1,+LYN("DILIST",2,ZZ),1,+PSJPWD,0)),U,2)]"" S PSGS0Y=$P($G(^(0)),U,2)
"RTN","PSIVORC1",21,0)
 .I '$G(PSGS0Y) S ZZ=0 F  S ZZ=$O(LYN("DILIST",2,ZZ)) Q:'ZZ  Q:PSGS0Y]""  I $G(LYN("DILIST","ID",ZZ,1))]"" S PSGS0Y=$G(LYN("DILIST","ID",ZZ,1))
"RTN","PSIVORC1",22,0)
 .Q:(PSGS0Y=PSGAT)!'$G(PSGS0Y)!($G(IVCAT)="C")
"RTN","PSIVORC1",23,0)
 .S PSGNSTAT=1 W $C(7),!!,"PLEASE NOTE:  This order's admin times (",PSGAT,")"
"RTN","PSIVORC1",24,0)
 .W !?13," do not match the ward times (",PSGS0Y,")"
"RTN","PSIVORC1",25,0)
 .W !?13," for this administration schedule (",P(9),")",!
"RTN","PSIVORC1",26,0)
 .S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR K DIR  W !
"RTN","PSIVORC1",27,0)
 S DONE=0 N DIR S DIR(0)="SNA^A:ADMIXTURE;C:CHEMOTHERAPY;H:HYPERAL;P:PIGGYBACK;S:SYRINGE",DIR("A")="IV TYPE: "
"RTN","PSIVORC1",28,0)
 I $G(P("RES"))'="R",$G(PSGORD)["P" N IVCAT,IVTYPTMP S IVCAT=$P($G(^PS(53.1,+PSGORD,2.5)),"^",5) S IVTYPTMP=$S((P(9)]""):"P",$G(P(5)):"P",$G(P(23))="P":"P",1:"")
"RTN","PSIVORC1",29,0)
 S DIR("B")=$S($G(IVCAT)="C"!($G(IVTYPTMP)="A"):"ADMIXTURE",$G(IVCAT)="I"!($G(IVTYPTMP)="P"):"PIGGYBACK",1:"ADMIXTURE")
"RTN","PSIVORC1",30,0)
 D DIRQ,^DIR S:$D(DTOUT)!(X="^") DONE=1 Q:DONE  G:$E(X)="^" 53 S P(4)=Y D:"CS"[P(4) @P(4)
"RTN","PSIVORC1",31,0)
 I PSIVAC'="PN" D ENT^PSIVCAL K %DT S X=P(2),%DT="RTX" D ^%DT S P(2)=+Y D ENSTOP^PSIVCAL K %DT S X=P(3),%DT="RTX" D ^%DT S P(3)=+Y
"RTN","PSIVORC1",32,0)
OTYP ; Get order type, display type.
"RTN","PSIVORC1",33,0)
 S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3) S:PSIVAC'="CF" P("OT")=$S(P(4)="A":"F",P(4)="H":"H",1:"I")
"RTN","PSIVORC1",34,0)
 Q
"RTN","PSIVORC1",35,0)
 ;
"RTN","PSIVORC1",36,0)
C ; Edit Chemo order
"RTN","PSIVORC1",37,0)
 N DIR S DIR(0)="SA^A:ADMIXTURE;P:PIGGYBACK;S:SYRINGE",DIR("A")="CHEMOTHERAPY TYPE: " D DIRQ,^DIR S:$D(DTOUT)!(X=U) DONE=1 Q:$E(X)="^"!(DONE)  S P(23)=Y D:P(23)["S" S
"RTN","PSIVORC1",38,0)
 Q
"RTN","PSIVORC1",39,0)
 ;
"RTN","PSIVORC1",40,0)
S ; Edit Syringe order
"RTN","PSIVORC1",41,0)
56 ; Intermittent Syringe
"RTN","PSIVORC1",42,0)
 N DIR S DIR(0)="Y",DIR("??")="^S F1=53.1,F2=56 D ENHLP^PSIVORC1",DIR("A")="INTERMITTENT SYRINGE" D ^DIR Q:$D(DIRUT)  S P(5)=Y
"RTN","PSIVORC1",43,0)
 ;
"RTN","PSIVORC1",44,0)
55 ; Syringe Size
"RTN","PSIVORC1",45,0)
 N DA,DIR S DIR(0)="53.1,55" D ^DIR I $D(DTOUT)!$D(DUOUT) S DONE=1 Q
"RTN","PSIVORC1",46,0)
 S P("SYRS")=Y
"RTN","PSIVORC1",47,0)
 Q
"RTN","PSIVORC1",48,0)
 ;
"RTN","PSIVORC1",49,0)
DIRQ ; Set DIR("?") for IV Type prompt.
"RTN","PSIVORC1",50,0)
 S DIR("?")="Enter a code from the list above.",DIR("??")="^S F1=55.01,F2="_$S(DIR("A")["CHEMO":106,1:.04)_" D ENHLP^PSIVORC1"
"RTN","PSIVORC1",51,0)
 S DIR("?",1)="CHOOSE FROM:",Y=$P(DIR(0),U,2) F X=1:1:5 S DIR("?",X+1)="              "_$P($P(Y,";",X),":")_"    "_$P($P(Y,";",X),":",2)
"RTN","PSIVORC1",52,0)
 Q
"RTN","PSIVORC1",53,0)
 ;
"RTN","PSIVORC1",54,0)
CKFLDS ; Find required fields missing data.
"RTN","PSIVORC1",55,0)
 NEW PSIVASX,PSIVASY,FIL,DRGTMP
"RTN","PSIVORC1",56,0)
 S EDIT="" F PSIVASX="AD","SOL" D
"RTN","PSIVORC1",57,0)
 .I '$D(DRG(PSIVASX)) S EDIT=EDIT_U_$S(PSIVASX="AD":57,1:58) Q
"RTN","PSIVORC1",58,0)
 .S DNE=0 F PSIVASY=0:0 S PSIVASY=$O(DRG(PSIVASX,PSIVASY)) Q:'PSIVASY!DNE  D
"RTN","PSIVORC1",59,0)
 .. I $P(DRG(PSIVASX,PSIVASY),U,3)="" S EDIT=EDIT_U_$S(PSIVASX="AD":57,1:58),DNE=1
"RTN","PSIVORC1",60,0)
 S:'P("MR") EDIT=EDIT_U_3 F X=8,6,2,3 I P(X)="" S EDIT=EDIT_U_$S(X=8:59,X=6:1,X=2:10,X=3:25,1:"")
"RTN","PSIVORC1",61,0)
 I P("DTYP")=1 S:P(9)="" EDIT=EDIT_U_26 S:P(11)="" EDIT=EDIT_U_39
"RTN","PSIVORC1",62,0)
 S:$E(EDIT,1)=U EDIT=$E(EDIT,2,999)
"RTN","PSIVORC1",63,0)
 Q
"RTN","PSIVORC1",64,0)
 ;
"RTN","PSIVORC1",65,0)
DONE ; Kill variables and exit
"RTN","PSIVORC1",66,0)
 K ACTION,AD,DFN,DNE,DONE,DONE1,DRG,DRGI,DRGN,DRGT,DRGTN,EDIT,ERR,F1,F2,FIL,HDT,J,LN,LN2,ND,ON,ON1,ON55,ORIFN,P,P16,PC,PDM,PG,PN,PNME,PNOW,PSGLMT,PSGODDD
"RTN","PSIVORC1",67,0)
 K PSGSS,PSGSSH,PSIV,PSIVAC,PSIVAT,PSIVCV,PSIVE,PSIVHD,PSIVLN,PSIVOK,PSIVOLD,PSIVORUT,PSIVREA,PSIVSC1,PSIVSTR,PSIVSTRT,PSIVTYPE,PSIVUP,PSIVX,PSIVX1
"RTN","PSIVORC1",68,0)
 K PSJIVORF,PSJORF,PSJORIFN,PSJORL,PSJORNP,PSJORPF,PSJORSTS,PSJIVOF,PSJNKF,PSJORD,RB,RF,SOL,STOP,TYP,UL80,WD,WDN,WG,^TMP("PSIV",$J) D ENIVKV^PSGSETU
"RTN","PSIVORC1",69,0)
 Q
"RTN","PSIVORC1",70,0)
ENHLP ; order entry fields' help
"RTN","PSIVORC1",71,0)
 N PSJHP,PSJX,PSJD
"RTN","PSIVORC1",72,0)
 ;From within this routine, F1 and F2 will refer to file 53.1,field 56, file 55.01,field 106, or file 55.01,field .04
"RTN","PSIVORC1",73,0)
 D FIELD^DID(F1,F2,"","HELP-PROMPT","PSJHP")
"RTN","PSIVORC1",74,0)
 I X="?",$D(PSJHP("HELP-PROMPT")) S F=$G(PSJHP("HELP-PROMPT")) W !?5 F F0=1:1:$L(F," ") S F3=$P(F," ",F0) W:$L(F3)+$X>78 !?5 W F3_" "
"RTN","PSIVORC1",75,0)
 ;
"RTN","PSIVORC1",76,0)
 W:$D(^DD(F1,F2,12)) !,"("_^(12)_")" D FIELD^DID(F1,F2,"","XECUTABLE HELP","PSJX") I $D(PSJX("XECUTABLE HELP")) X PSJX("XECUTABLE HELP")
"RTN","PSIVORC1",77,0)
 ;
"RTN","PSIVORC1",78,0)
 ; new code
"RTN","PSIVORC1",79,0)
 D FIELD^DID(F1,F2,"","DESCRIPTION","PSJD")
"RTN","PSIVORC1",80,0)
 G:$S($G(X)="?":1,1:'$O(PSJD("DESCRIPTION",0))) SC F F=0:0 S F=$O(PSJD("DESCRIPTION",F)) Q:'F  I $D(PSJD("DESCRIPTION",F)) W !?2,PSJD("DESCRIPTION",F)
"RTN","PSIVORC1",81,0)
SC ;
"RTN","PSIVORC1",82,0)
 I F2=5!(F2=6) W !,"CHOOSE FROM:",!?8,0,?16,"NO",!?8,1,?16,"YES" Q
"RTN","PSIVORC1",83,0)
 Q
"RTN","PSIVORC1",84,0)
COMPLTE ;
"RTN","PSIVORC1",85,0)
 NEW PSIVDSFG S PSIVDSFG=0
"RTN","PSIVORC1",86,0)
 S P16=0,PSIVEXAM=1,(PSIVNOL,PSIVCT)=1 D GTOT^PSIVUTL(P(4)) D ^PSIVCHK I $D(DUOUT) W $C(7),!,"Order Unchanged.",! Q
"RTN","PSIVORC1",87,0)
 G:'$D(PSIVFN1) EDIT1
"RTN","PSIVORC1",88,0)
 I ERR=1 S Y=0 G EDIT1
"RTN","PSIVORC1",89,0)
 D CKORD^PSIVORC2 I $G(PSJFNDS)!$S($G(PSIVDSFG):0,PSIVCHG:1,1:0)!$$INFRATE^PSJMISC(DFN,ON,P(8),P("DTYP")) D
"RTN","PSIVORC1",90,0)
 . K PSJFNDS
"RTN","PSIVORC1",91,0)
 . D IN^PSJOCDS($G(ON),"IV","")
"RTN","PSIVORC1",92,0)
 . Q:$G(PSGORQF)
"RTN","PSIVORC1",93,0)
 . Q:'PSIVCHG
"RTN","PSIVORC1",94,0)
 D NOW^%DTC S P("LOG")=$E(%,1,12),P("CLRK")=DUZ_U_$P($G(^VA(200,DUZ,0)),U),P("INS")=""
"RTN","PSIVORC1",95,0)
 Q:$G(PSGORQF)
"RTN","PSIVORC1",96,0)
 W ! D ^PSIVORLB K PSIVEXAM S Y=P(2)
"RTN","PSIVORC1",97,0)
 W !,"Start date: " X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),?30," Stop date: " S Y=P(3) X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),!
"RTN","PSIVORC1",98,0)
EDIT ;
"RTN","PSIVORC1",99,0)
 I ERR=1 W !,"Please re-edit this order" K DIR S DIR(0)="E" D ^DIR K DIR W:'Y $C(7),"order unchanged." Q:'Y  S Y=0 G EDIT1
"RTN","PSIVORC1",100,0)
 ;PSJ*5*157 EFD FOR IV
"RTN","PSIVORC1",101,0)
 D EFDIV^PSJUTL($G(ZZND))
"RTN","PSIVORC1",102,0)
 W:$G(PSIVCHG) !,"*** This change will cause a new order to be created. ***"
"RTN","PSIVORC1",103,0)
 K DIR S DIR(0)="Y",DIR("A")="Is this O.K.",DIR("B")=$S(ERR:"NO",1:"YES"),DIR("?",1)="Enter ""Y"" to make this an active order (only allowed if no errors were"
"RTN","PSIVORC1",104,0)
 S DIR("?")="found in order), ""N"" to edit the order, or ""^"" to leave order unchanged.",DIR("??")="^S HELP=""EDIT"" D ^PSIVHLP"
"RTN","PSIVORC1",105,0)
 D ^DIR K DIR I $D(DIRUT) K DIRUT W $C(7),"Order unchanged." Q
"RTN","PSIVORC1",106,0)
 ;*  Kill Unit dose variables when calling from ^PSJLIFNI.
"RTN","PSIVORC1",107,0)
 I +Y,$G(PSJLIFNI) D
"RTN","PSIVORC1",108,0)
 . K ND,ND4,ND6,NDP2
"RTN","PSIVORC1",109,0)
 . K PSGAT,PSGCANFL,PSGDI,PSGDO,PSGDT,PSGEB,PSGEBN,PSGEFN,PSGFD,PSGFDN
"RTN","PSIVORC1",110,0)
 . K PSGHSM,PSGLI,PSGLIN,PSGLMT,PSGMR,PSGMRN,PSGNEDFD,PSGNEF,PSGNEFD
"RTN","PSIVORC1",111,0)
 . K PSGNESD,PSGOAT,PSGODO,PSGODT,PSGEA,PSGOEAV,PSGOEEF
"RTN","PSIVORC1",112,0)
 . K PSGOEEWF,PSGOEEG,PSGOEF,PSGOENG,PSGOES,PSGOFD,PSGOFDN,PSGOHSM
"RTN","PSIVORC1",113,0)
 . K PSGOINST,PSGOMR,PSGOMRN,PSGONC
"RTN","PSIVORC1",114,0)
 . K PSGOPD,PSOPDN,PSGOPR,PSGOPRN,PSGOSD,PSGOSDN,PSGOSI,PSGOSM
"RTN","PSIVORC1",115,0)
 . K PSGOST,PSGOSTN
"RTN","PSIVORC1",116,0)
 . K PSGPD,PSGPDN,PSGPDRG,PSGDRGN,PSGPFLG,PSGPI,PSGPR,PSGPRIO,PSGPRN
"RTN","PSIVORC1",117,0)
 . K PSGPTMP,PSGRRF,PSG0XT,PSGS0Y,PSGSCH,PSGSD,PSGSDN,PSGSI,PSGSM
"RTN","PSIVORC1",118,0)
 . K PSGST,PSGSTAT,PSGSTN,PSJACNWP,PSJACOK,PSJCOI
"RTN","PSIVORC1",119,0)
EDIT1 ;
"RTN","PSIVORC1",120,0)
 NEW XFLG,PSIVY S PSIVY=$G(Y)
"RTN","PSIVORC1",121,0)
 NEW X S X=$G(^TMP("PSJI",$J,0)),VALMBG=$S((X<17):1,1:(X-(X#16)))
"RTN","PSIVORC1",122,0)
 I PSIVY=0!'$G(PSIVFN1) S PSIVFN1=1 D EN^VALM("PSJ LM IV AC/EDIT") Q
"RTN","PSIVORC1",123,0)
 S PSIVCHG=0 D EDCHK^PSIVORC2 K PSIVCHG
"RTN","PSIVORC1",124,0)
 S VALMBCK="Q",PSIVACEP=1
"RTN","PSIVORC1",125,0)
 Q
"RTN","PSIVORC2")
0^96^B56200056
"RTN","PSIVORC2",1,0)
PSIVORC2 ;BIR/MLM-PROCESS INCOMPLETE IV ORDER - CONT ;22 OCT 97 / 3:16 PM
"RTN","PSIVORC2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**29,49,50,65,58,85,101,110,127,151,181**;16 DEC 97;Build 190
"RTN","PSIVORC2",3,0)
 ;
"RTN","PSIVORC2",4,0)
 ; Reference to ^ORD(101 is supported by DBIA #872
"RTN","PSIVORC2",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA #2178
"RTN","PSIVORC2",6,0)
 ; Reference to ^PS(55 is supported by DBIA #2191
"RTN","PSIVORC2",7,0)
 ; Reference to ^PS(52.6 is supported by DBIA #1231.
"RTN","PSIVORC2",8,0)
 ; Reference to ^PS(52.7 is supported by DBIA #2173.
"RTN","PSIVORC2",9,0)
 ; Reference to EN1^ORCFLAG is supported by DBIA #3620.
"RTN","PSIVORC2",10,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSIVORC2",11,0)
 ;
"RTN","PSIVORC2",12,0)
EDCHK ;Update or create new order in 55.
"RTN","PSIVORC2",13,0)
 D CKORD D:'$G(PSJIVORF) ORPARM^PSIVOREN I 'PSJIVORF W !,"Either the Inpatient Medications or the IV Medications package is not on, please check the Order Parameters file" Q
"RTN","PSIVORC2",14,0)
 I PSIVCHG,PSJIVORF D NATURE^PSIVOREN I '$D(P("NAT")) W $C(7),"Order unchanged" Q
"RTN","PSIVORC2",15,0)
 ;;S:PSIVCHG P(21)=""
"RTN","PSIVORC2",16,0)
 S:PSIVCHG P("21FLG")=""
"RTN","PSIVORC2",17,0)
 I $G(PSJCOM) D IV^PSJCOMV Q
"RTN","PSIVORC2",18,0)
 Q:$$NONVF()
"RTN","PSIVORC2",19,0)
ACTIVE ;
"RTN","PSIVORC2",20,0)
 S PSJCOM=P("PRNTON")
"RTN","PSIVORC2",21,0)
 I PSJCOM D VFYIV^PSJCOMV Q
"RTN","PSIVORC2",22,0)
 S P("RES")=$P($G(^PS(53.1,+ON,0)),U,24)
"RTN","PSIVORC2",23,0)
 I P("RES")="R" S P("NEWON")=P("OLDON") S PSJOSTOP="" D RUPDATE^PSIVOREN(DFN,ON,P(2))
"RTN","PSIVORC2",24,0)
 I P("RES")'="R" S PSJORD=ON,P(17)="A",ORSTS=6,PSJORNP=P(6) D SETNEW^PSIVORFB S P("NEWON")=ON55 D @$S(PSIVCHG:"NEWORD",1:"OLDORD")
"RTN","PSIVORC2",25,0)
 S (ON55,ON)=P("NEWON"),OD=P(2) D EN^PSIVORE
"RTN","PSIVORC2",26,0)
 D VF1^PSJLIACT("F","ORDER VERIFIED BY ",1)
"RTN","PSIVORC2",27,0)
 D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,"N")
"RTN","PSIVORC2",28,0)
 I $G(^PS(55,DFN,"IV",+ON55,4)) D EN1^PSJHL2(DFN,"ZV",ON55)
"RTN","PSIVORC2",29,0)
 L -^PS(53.1,+$G(PSJORD)) L -^PS(55,DFN,"IV",+ON55)
"RTN","PSIVORC2",30,0)
 Q
"RTN","PSIVORC2",31,0)
 ;
"RTN","PSIVORC2",32,0)
CKORD ;Check if new order is to be created.
"RTN","PSIVORC2",33,0)
 I $G(PSIVCOPY) S PSIVCHG=0 Q
"RTN","PSIVORC2",34,0)
 N ND,PSJCHG S PSIVCHG=0,ND(0)=$G(^PS(53.1,+ON,0)),ND("PD")=$G(^PS(53.1,+ON,.2))_U_$P(ND(0),U,3)
"RTN","PSIVORC2",35,0)
 N X S X=$P($G(^PS(53.1,+ON,8)),U,5),X=$S(P(8)["@":$P(X,"@"),1:X)
"RTN","PSIVORC2",36,0)
 ;S ND=$S($E(P("OT"))="I":P(8)_U_$P($G(^PS(53.1,+ON,2)),U)_U_$P(ND(0),U,3)_U_+$P(ND("PD"),U),1:X_U_$P($G(^PS(53.1,+ON,2)),U)_U_+P("MR")_U_+P("PD"))
"RTN","PSIVORC2",37,0)
 S ND=$S($E(P("OT"))="I":P(8)_U_$P(ND(0),U,3)_U_+$P(ND("PD"),U),1:X_U_+P("MR")_U_+P("PD"))
"RTN","PSIVORC2",38,0)
 S ND=ND_U_$S($P(ND(0),U,2)=+P("CLRK"):+$P(ND(0),U,2),1:+P(6))
"RTN","PSIVORC2",39,0)
 ;I ND'=($S($E(P("OT"))="I":P(8),P(8)["@":$P(P(8),"@"),1:P(8))_U_P(9)_U_+P("MR")_U_+P("PD")_U_+P(6)) S PSIVCHG=1  Q
"RTN","PSIVORC2",40,0)
 I ND'=($S($E(P("OT"))="I":P(8),P(8)["@":$P(P(8),"@"),1:P(8))_U_+P("MR")_U_+P("PD")_U_+P(6)) S PSIVCHG=1
"RTN","PSIVORC2",41,0)
 I 'PSIVCHG I $P($G(^PS(53.1,+ON,2)),U)'=P(9) S:($G(P("DTYP"))'=1) PSIVDSFG=1 S PSIVCHG=1
"RTN","PSIVORC2",42,0)
 ;Q:P(17)="P"
"RTN","PSIVORC2",43,0)
 N ND,TDRG,TMPDRG
"RTN","PSIVORC2",44,0)
 Q:PSIVCHG
"RTN","PSIVORC2",45,0)
 D TMPDRG1^PSJMISC(DFN,$G(ON),.TMPDRG)
"RTN","PSIVORC2",46,0)
 I $$COMPARE^PSJMISC(.DRG,.TMPDRG,$S(P("DTYP")=1:0,1:1)) S PSIVCHG=1
"RTN","PSIVORC2",47,0)
 K TMPDRG
"RTN","PSIVORC2",48,0)
 Q:PSIVCHG
"RTN","PSIVORC2",49,0)
 ;F DRGT="AD","SOL" F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI  I $P(P("OT"),U)="F",'$P(DRG(DRGT,DRGI),U,5) S P("OT")="I"
"RTN","PSIVORC2",50,0)
 Q
"RTN","PSIVORC2",51,0)
CKPC ;
"RTN","PSIVORC2",52,0)
 ;PSJ*5*181 Note - No longer use by *181
"RTN","PSIVORC2",53,0)
 ;
"RTN","PSIVORC2",54,0)
 Q:PSIVCHG  I $E(P("OT"))'="I" D
"RTN","PSIVORC2",55,0)
 .;
"RTN","PSIVORC2",56,0)
 .; Check IV drugs for changes.
"RTN","PSIVORC2",57,0)
 .S DNE=0 F DRGT="AD","SOL" I $D(DRG(DRGT)) S FIL="52."_$S(DRGT="AD":6,1:7) D
"RTN","PSIVORC2",58,0)
 ..N ND,TDRG F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI!DNE  S TDRG(+$P(DRG(DRGT,DRGI),U),DRGI)=DRGI,TDRG("CNT")=+$G(TDRG("CNT"))+1
"RTN","PSIVORC2",59,0)
 ..F ON1=0:0 S ON1=$O(^PS(53.1,+ON,DRGT,ON1)) Q:'+ON1!DNE  S ND=$G(^PS(53.1,+ON,DRGT,ON1,0)),ND("CNT")=$G(ND("CNT"))+1 D
"RTN","PSIVORC2",60,0)
 ...S DRG=+$P(ND,U) S:'$D(TDRG(+DRG)) (DNE,PSIVCHG)=1 F DRGI=0:0 S DRGI=$O(TDRG(+DRG,DRGI)) Q:'DRGI!DNE  I $P($G(DRG(DRGT,DRGI)),U)_U_$P($G(DRG(DRGT,DRGI)),U,3)'=$P(ND,U,1,2) S (DNE,PSIVCHG)=1
"RTN","PSIVORC2",61,0)
 ..S:$G(ND("CNT"))'=$G(TDRG("CNT")) (DNE,PSIVCHG)=1 K ND,TDRG
"RTN","PSIVORC2",62,0)
 Q
"RTN","PSIVORC2",63,0)
 ;
"RTN","PSIVORC2",64,0)
OLDORD ; Update old order, update order links.
"RTN","PSIVORC2",65,0)
 Q:P("RES")="R"
"RTN","PSIVORC2",66,0)
 S P("OLDON")=$P($G(^PS(53.1,+ON,0)),U,25) I P("OLDON")'=ON55 S $P(^PS(55,DFN,"IV",+ON55,2),U,8)=P("RES"),$P(^(2),U,5)=P("OLDON") I P("OLDON") D
"RTN","PSIVORC2",67,0)
 .I P("OLDON")["V",$D(^PS(55,DFN,"IV",+P("OLDON"),0)) S $P(^(2),U,6)=ON55,$P(^(2),U,9)=P("RES")
"RTN","PSIVORC2",68,0)
 .I P("OLDON")["A",$D(^PS(55,DFN,5,+P("OLDON"),0)) S $P(^(0),U,26,27)=ON55_U_P("RES")
"RTN","PSIVORC2",69,0)
 .;I P("OLDON")["P",$D(^PS(53.1,+P("OLDON"),0)) S $P(^(0),U,26,27)=ON55_U_P("RES")
"RTN","PSIVORC2",70,0)
 .I $S(P("OLDON")["P":1,P("OLDON")["N":1,1:0),$D(^PS(53.1,+P("OLDON"),0)) S $P(^(0),U,26,27)=ON55_U_P("RES")
"RTN","PSIVORC2",71,0)
 D PUT531^PSIVORFA S $P(^PS(53.1,+ON,0),U,25,26)="^",ON=ON55 D UPD100^PSIVORFA
"RTN","PSIVORC2",72,0)
 Q
"RTN","PSIVORC2",73,0)
 ;
"RTN","PSIVORC2",74,0)
NEWORD ; Create new order, update order links.
"RTN","PSIVORC2",75,0)
 Q:P("RES")="R"
"RTN","PSIVORC2",76,0)
 S $P(^PS(53.1,+ON,0),U,26,27)=P("NEWON")_U_"E",PSIVAC="CE",PSJORNAT=P("NAT") D DC^PSIVORA
"RTN","PSIVORC2",77,0)
 S P("NEWON")=$P($G(^PS(53.1,+PSJORD,0)),U,26),$P(^PS(55,DFN,"IV",+P("NEWON"),2),U,5)=PSJORD,$P(^(2),U,8)="E",ON=ON55
"RTN","PSIVORC2",78,0)
 ;;I PSJIVORF D SET^PSIVORFE D EN1^PSJHL2(DFN,"SN",+ON55_"V","NEW ORDER CREATED")
"RTN","PSIVORC2",79,0)
 I PSJIVORF D EN1^PSJHL2(DFN,"SN",+ON55_"V","NEW ORDER CREATED")
"RTN","PSIVORC2",80,0)
 Q
"RTN","PSIVORC2",81,0)
 ;
"RTN","PSIVORC2",82,0)
GTIVDRG ; Try to find an IV drug from the Orderable Item.
"RTN","PSIVORC2",83,0)
 ; If there is only 1 match to OI then stuff in DRG otherwise prompt user to select which
"RTN","PSIVORC2",84,0)
 ; ad/sol matched to OI
"RTN","PSIVORC2",85,0)
 K PSIVOI NEW FIL,ND,SCR,PSJNOW
"RTN","PSIVORC2",86,0)
 D NOW^%DTC S PSJNOW=%
"RTN","PSIVORC2",87,0)
 S SCR("S")="S ND=$P($G(^(""I"")),U) I ND=""""!(ND>PSJNOW)"
"RTN","PSIVORC2",88,0)
 F FIL=52.6,52.7 D FIND^DIC(FIL,,"@;.01;2","QXP",+P("PD"),,"AOI",SCR("S"),,"PSIVOI") I +PSIVOI("DILIST",0)>0 D  Q
"RTN","PSIVORC2",89,0)
 . S DRGT=$S(FIL=52.6:"AD",1:"SOL"),PSIVOI=DRGT
"RTN","PSIVORC2",90,0)
 . I PSIVOI="AD" D
"RTN","PSIVORC2",91,0)
 .. N XX,XXX,QC S XX=0 F  S XX=$O(PSIVOI("DILIST",XX)) Q:XX=""  S XXX=+PSIVOI("DILIST",XX,0) D LIST^DIC(52.61,","_XXX_",","@;.01","PQ",,,,,,,"PSIVQC") D
"RTN","PSIVORC2",92,0)
 ... I +$G(PSIVQC("DILIST",0))>0 S QC=0 F  S QC=$O(PSIVQC("DILIST",QC)) Q:QC=""  S PSIVOI("DILIST",XX,QC,0)=PSIVQC("DILIST",QC,0)
"RTN","PSIVORC2",93,0)
 ... K PSIVQC("DILIST",0),PSIVQC("DILIST",0,"MAP")
"RTN","PSIVORC2",94,0)
 .. D RESET
"RTN","PSIVORC2",95,0)
 . I +PSIVOI("DILIST",0)=1 D
"RTN","PSIVORC2",96,0)
 .. S DRG=+PSIVOI("DILIST",1,0)
"RTN","PSIVORC2",97,0)
 .. S DNE=1,DRG(DRGT,0)=1,ND=$G(^PS(FIL,+DRG,0)),DRG(DRGT,1)=+DRG_U_$P(ND,U)_U_$S(FIL=52.7:$P(ND,U,3),1:"")_U_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSIVORC2",98,0)
 K:+PSIVOI("DILIST",0)<2 PSIVOI
"RTN","PSIVORC2",99,0)
 Q
"RTN","PSIVORC2",100,0)
 ;
"RTN","PSIVORC2",101,0)
EDIT ; Edit incomplete order
"RTN","PSIVORC2",102,0)
 K PSIVENO
"RTN","PSIVORC2",103,0)
 S PSIVAC="CE"
"RTN","PSIVORC2",104,0)
 I $E(P("OT"))="I",'$D(DRG("AD")),('$D(DRG("SOL"))) D GTIVDRG
"RTN","PSIVORC2",105,0)
 I P(4)="" D 53^PSIVORC1 Q:P(4)=""  D ^PSIVORV2
"RTN","PSIVORC2",106,0)
 D GSTRING^PSIVORE1,GTFLDS^PSIVORFE ;S (PSIVOK,EDIT)="57^58^59^3"_$S(P("DTYP")=1:"^26^39",1:"")_"^63^64^"_$S($E(P("OT"))="I":"101^109^",1:"")_"10^25"_$S(+P(6)'=+P("CLRK"):"^1",1:"") D GTFLDS^PSIVORFE
"RTN","PSIVORC2",107,0)
 Q:$G(DONE)
"RTN","PSIVORC2",108,0)
 ;I $G(^ORD(101,+$P($G(VALM("PROTOCOL")),";"),0))["PSJ PC IV AC/EDIT ACTION" S PSIVENO=1
"RTN","PSIVORC2",109,0)
 I '$G(PSIVENO) S PSIVENO=1 D EN^VALM("PSJ LM IV AC/EDIT") S VALMBCK="Q"
"RTN","PSIVORC2",110,0)
 ;;K ON55 D COMPLTE^PSIVORC1
"RTN","PSIVORC2",111,0)
 Q
"RTN","PSIVORC2",112,0)
 ;
"RTN","PSIVORC2",113,0)
FINISH ; Ask only for missing data in incomplete IV order.
"RTN","PSIVORC2",114,0)
 S P("OPI")=$$ENPC^PSJUTL("V",+PSIVUP,60,P("OPI")) I $E(P("OT"))="I",'$D(DRG("AD")),('$D(DRG("SOL"))) S DNE=0 D GTIVDRG
"RTN","PSIVORC2",115,0)
 D:P(4)="" 53^PSIVORC1 Q:P(4)=""  S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSIVORC2",116,0)
 I 'P(2) D ENT^PSIVCAL K %DT S X=P(2),%DT="RTX" D ^%DT S P(2)=+Y
"RTN","PSIVORC2",117,0)
 I 'P(3) D ENSTOP^PSIVCAL K %DT S X=P(3),%DT="RTX" D ^%DT S P(3)=+Y
"RTN","PSIVORC2",118,0)
 I 'P("MR") S P("MR")=$O(^PS(51.2,"B","INTRAVENOUS",0))_"^IV"
"RTN","PSIVORC2",119,0)
 S PSIVOK="1^3^10^25^26^39^57^58^59^63^64" D CKFLDS^PSIVORC1 D:EDIT]"" EDIT^PSIVEDT G COMPLTE^PSIVORC1
"RTN","PSIVORC2",120,0)
 Q
"RTN","PSIVORC2",121,0)
NONVF() ; Updated 53.1 status to non-verified after finish.
"RTN","PSIVORC2",122,0)
 NEW PSGOEAV S PSGOEAV=+$P(PSJSYSP0,U,9)
"RTN","PSIVORC2",123,0)
 I +PSJSYSU=3,PSGOEAV Q 0
"RTN","PSIVORC2",124,0)
 I +PSJSYSU=1,PSGOEAV Q 0
"RTN","PSIVORC2",125,0)
 I PSIVCHG D NWNONVF Q 1
"RTN","PSIVORC2",126,0)
 S P(17)="N",P("REN")=0
"RTN","PSIVORC2",127,0)
 D GTPD^PSIVORE2
"RTN","PSIVORC2",128,0)
 W !,"...transcribing this non-verified order...."
"RTN","PSIVORC2",129,0)
 S $P(^PS(53.1,+ON,.2),U)=""
"RTN","PSIVORC2",130,0)
 D PUT531^PSIVORFA
"RTN","PSIVORC2",131,0)
 D NEWNVAL^PSGAL5(ON,$S(+PSJSYSU=1:22000,+PSJSYSU=3:22005,1:22006),"","")
"RTN","PSIVORC2",132,0)
 NEW PSIVORFA S PSIVORFA=1 D:ON["V" DEL55^PSIVORE2
"RTN","PSIVORC2",133,0)
 D EN1^PSJHL2(DFN,"XX",ON,"UPDATED ORDER")
"RTN","PSIVORC2",134,0)
 D VF
"RTN","PSIVORC2",135,0)
 Q 1
"RTN","PSIVORC2",136,0)
NWNONVF ;Create non-verified due to edit
"RTN","PSIVORC2",137,0)
 ;D NATURE^PSIVOREN I '$D(P("NAT")) Q
"RTN","PSIVORC2",138,0)
 K DA D ENGNN^PSGOETO S P("NEWON")=DA_"P",P(17)="N",P("REN")=0
"RTN","PSIVORC2",139,0)
 S PSJORD=ON,$P(^PS(53.1,+ON,0),U,26,27)=P("NEWON")_U_"E",PSIVAC="CE",PSJORNAT=P("NAT") D DC^PSIVORA
"RTN","PSIVORC2",140,0)
 S P("OLDON")=ON,ON=P("NEWON")
"RTN","PSIVORC2",141,0)
 S P("RES")="E"
"RTN","PSIVORC2",142,0)
 ;D:P("DO")="" GTPD^PSIVORE2 ;Get dosage order if not defined for IPM IV
"RTN","PSIVORC2",143,0)
 S P("DO")="" D GTPD^PSIVORE2 ;Get dosage order if not defined for IPM IV
"RTN","PSIVORC2",144,0)
 D PUT531^PSIVORFA
"RTN","PSIVORC2",145,0)
 S $P(^PS(53.1,+ON,0),U,25,26)=P("OLDON")_U_""
"RTN","PSIVORC2",146,0)
 D NEWNVAL^PSGAL5(ON,$S(+PSJSYSU=1:22000,+PSJSYSU=3:22005,1:22006),"","")
"RTN","PSIVORC2",147,0)
 D EN1^PSJHL2(DFN,"SN",ON,"SEND ORDER NUMBER")
"RTN","PSIVORC2",148,0)
 S:$D(PSGP)#10 PSJNOL=$$LS^PSSLOCK(PSGP,ON)
"RTN","PSIVORC2",149,0)
 D VF
"RTN","PSIVORC2",150,0)
 Q
"RTN","PSIVORC2",151,0)
VF ; Display Verify screen
"RTN","PSIVORC2",152,0)
 Q:ON'["P"
"RTN","PSIVORC2",153,0)
 K PSJIVBD
"RTN","PSIVORC2",154,0)
 D GT531^PSIVORFA(DFN,ON)
"RTN","PSIVORC2",155,0)
 S PSGACT="EL"
"RTN","PSIVORC2",156,0)
 I P(17)="N",(P("OLDON")=""),(+P("CLRK")=DUZ) S PSGACT="ELD"
"RTN","PSIVORC2",157,0)
 I +PSJSYSU=3!(+PSJSYSU=1) S PSGACT="DELV"
"RTN","PSIVORC2",158,0)
 I +PSJSYSU=3,$L($T(EN1^ORCFLAG)) S PSGACT=PSGACT_"G"
"RTN","PSIVORC2",159,0)
 I P("OT")="I" S PSJSTAR="(1)^(5)^(7)^(9)^(10)"
"RTN","PSIVORC2",160,0)
 I P("OT")'="I" S PSJSTAR="(1)^(2)^(3)^(5)^(7)^(9)"
"RTN","PSIVORC2",161,0)
 D EN^VALM("PSJ LM IV INPT ACTIVE")
"RTN","PSIVORC2",162,0)
 Q
"RTN","PSIVORC2",163,0)
 ;
"RTN","PSIVORC2",164,0)
RESET ;Reset PSIVOI("DILIST") for additives with quick codes
"RTN","PSIVORC2",165,0)
 N XX,XXX,CNT S CNT=0
"RTN","PSIVORC2",166,0)
 S XX=0 F  S XX=$O(PSIVOI("DILIST",XX)) Q:XX=""  S CNT=CNT+1,LYN(CNT)=PSIVOI("DILIST",XX,0) D
"RTN","PSIVORC2",167,0)
 . S XXX=0 F  S XXX=$O(PSIVOI("DILIST",XX,XXX)) Q:XXX=""  S CNT=CNT+1,LYN(CNT)=$P(PSIVOI("DILIST",XX,0),"^")_"^"_$P(PSIVOI("DILIST",XX,XXX,0),"^",2)_"^"_$P(PSIVOI("DILIST",XX,XXX,0),"^")_"^"_"QC"
"RTN","PSIVORC2",168,0)
 K PSIVOI("DILIST")
"RTN","PSIVORC2",169,0)
 S PSIVOI("DILIST",0)=CNT_"^*^0^"
"RTN","PSIVORC2",170,0)
 S XX=0 F  S XX=$O(LYN(XX)) Q:'XX  S PSIVOI("DILIST",XX,0)=LYN(XX)
"RTN","PSIVORC2",171,0)
 K LYN
"RTN","PSIVORC2",172,0)
 Q
"RTN","PSIVORE")
0^69^B42579774
"RTN","PSIVORE",1,0)
PSIVORE ;BIR/PR,MLM-ORDER ENTRY ; 4/1/08 2:37pm
"RTN","PSIVORE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**18,29,50,56,58,81,110,127,133,157,203,213,181**;16 DEC 97;Build 190
"RTN","PSIVORE",3,0)
 ;
"RTN","PSIVORE",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIVORE",5,0)
 ; Reference to ^ORX2 is supported by DBIA #867
"RTN","PSIVORE",6,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSIVORE",7,0)
 ; Reference to ^DICN is supported by DBIA 10009.
"RTN","PSIVORE",8,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSIVORE",9,0)
 ; Reference to EN^VALM is supported by DBIA 10118.
"RTN","PSIVORE",10,0)
 ; Reference to ^VADPT is supported by DBIA 10061.
"RTN","PSIVORE",11,0)
 ;
"RTN","PSIVORE",12,0)
 N PSJNEW,PSJOUT,PSGPTMP,PPAGE,FLAG S PSJNEW=1
"RTN","PSIVORE",13,0)
 ;
"RTN","PSIVORE",14,0)
 D SITE Q:'$G(PSIVQ)  K PSIVQ S PSGOP=""
"RTN","PSIVORE",15,0)
 ;
"RTN","PSIVORE",16,0)
BEG ;Get patient and make sure he is living.
"RTN","PSIVORE",17,0)
 L +^PS(53.45,DUZ):1 E  D LOCKERR^PSJOE G Q
"RTN","PSIVORE",18,0)
 ;* F  K WSCHADM S PSGPTMP=0,PPAGE=1 D ENGETP^PSIV Q:DFN<0  D ASK
"RTN","PSIVORE",19,0)
 ;* F  K WSCHADM S PSGPTMP=0,PPAGE=1 D ENGETP^PSIV Q:DFN<0  S X=DFN_";DPT(" D LK^ORX2 Q:'Y  D ASK S X=DFN_";DPT(" D ULK^ORX2
"RTN","PSIVORE",20,0)
 NEW PSJLK
"RTN","PSIVORE",21,0)
 F  K WSCHADM S PSGPTMP=0,PPAGE=1 D ENGETP^PSIV Q:DFN<0  S PSJLK='$$L^PSSLOCK(DFN,1) Q:PSJLK  D ASK,UL^PSSLOCK(DFN)
"RTN","PSIVORE",22,0)
 I PSGOP,$P(PSJSYSL,"^",2)]"" D ENQL^PSGLW
"RTN","PSIVORE",23,0)
 G Q
"RTN","PSIVORE",24,0)
 ;
"RTN","PSIVORE",25,0)
ASK ;See if patient has been admitted.
"RTN","PSIVORE",26,0)
 I VADM(6) W !?5,"Patient has died." Q
"RTN","PSIVORE",27,0)
 I 'VAIN(4) K DIK S DIR(0)="Y",DIR("A")="Do you wish to continue",DIR("B")="NO",DIR("??")="^S HELP=""ADMYN"" D ^PSIVHLP1" W !,"This patient has not been admitted." D ^DIR K DIR Q:'Y
"RTN","PSIVORE",28,0)
 S:VAIN(4) WSCHADM=+VAIN(4)
"RTN","PSIVORE",29,0)
 ;
"RTN","PSIVORE",30,0)
SETN ;Set up patient 0 node if needed.
"RTN","PSIVORE",31,0)
 I '$D(^PS(55,DFN,0)) K DO,DA,DD,DIC,PSIVFN S:$D(^(5.1)) PSIVFN=^(5.1) K:$D(PSIVFN) ^(5.1) S (DINUM,X)=DFN,DIC(0)="L",DIC="^PS(55," D FILE^DICN S:$D(PSIVFN) ^PS(55,DFN,5.1)=PSIVFN D  K DIC,PSIVFN,DO,DA,DD,DINUM
"RTN","PSIVORE",32,0)
 .; Mark PSJ and PSO as converted
"RTN","PSIVORE",33,0)
 .S $P(^PS(55,DFN,5.1),"^",11)=2
"RTN","PSIVORE",34,0)
 S PSJNARC=1
"RTN","PSIVORE",35,0)
 S PSGP=DFN,PSJPWD=+VAIN(4),PSIVAC="P",PSIVBR="D ^PSIVOPT" D HK,ENCHS1^PSIV Q:'$D(DFN)
"RTN","PSIVORE",36,0)
 Q
"RTN","PSIVORE",37,0)
 ;
"RTN","PSIVORE",38,0)
NEW ;Ask to enter new order.
"RTN","PSIVORE",39,0)
 D:'$D(VADM(1)) DEM^VADPT
"RTN","PSIVORE",40,0)
 K P,PSIVCHG,PSIVTYPE,PSJOE,DIR S DIR(0)="Y",DIR("A")="New order for "_VADM(1),DIR("B")="YES",DIR("??")="^S HELP=""NEWORD"" D ^PSIVHLP" D ^DIR K DIR Q:'Y
"RTN","PSIVORE",41,0)
 NEW X S X=DFN_";DPT(" D LK^ORX2 Q:'Y  S PSJLSORX=1
"RTN","PSIVORE",42,0)
INMED K ON55,PSJOUT S (P(4),P("OT"),P("FRES"))="" D NEW55^PSIVORFB I '$D(ON55) D ULK G:'$D(PSJOE)&('$D(PSJOUT)) NEW G Q
"RTN","PSIVORE",43,0)
 S P("RES")="N",PSIVAC="PN",P("PON")=ON55,PSIVUP=+$$GTPCI^PSIVUTL D NEW^PSIVORE2 I $G(P(2))="" D DEL55^PSIVORE2 D ULK G:'$D(PSJOE) NEW Q
"RTN","PSIVORE",44,0)
 D OK L -^PS(55,DFN,"IV",+ON55) D ULK G:'$D(PSJOE) NEW
"RTN","PSIVORE",45,0)
 ;
"RTN","PSIVORE",46,0)
Q ; Kill and exit.
"RTN","PSIVORE",47,0)
 L:'$D(PSJOE) -^PS(53.45,DUZ) S PSJNKF=1 D Q^PSIV
"RTN","PSIVORE",48,0)
 K FIL,I1,ND,PC,PDM,PSGDT,PSGID,PSGLMT,PSGSI,PSJNARC,PSIVAC,PSIVCHG,PSIVUP,PSIVX,PSJOPC
"RTN","PSIVORE",49,0)
 Q
"RTN","PSIVORE",50,0)
 ;
"RTN","PSIVORE",51,0)
ULK ;
"RTN","PSIVORE",52,0)
 Q:'$G(PSJLSORX)  ;If NEW^PSIVORE did not lock, don't kill it here.
"RTN","PSIVORE",53,0)
 NEW X S X=DFN_";DPT(" D ULK^ORX2 K PSJLSORX
"RTN","PSIVORE",54,0)
 Q
"RTN","PSIVORE",55,0)
HK ;Queue job to print MAR labels generated for this patient.
"RTN","PSIVORE",56,0)
 I PSGOP,PSGOP'=DFN D
"RTN","PSIVORE",57,0)
 .N PSJACPF,PSJACNWP,PSJPWD,PSJSYSL,PSJSYSW,PSJSYSW0,DFN,VAIN,VAERR S DFN=PSGOP
"RTN","PSIVORE",58,0)
 .D INP^VADPT S PSJPWD=+VAIN(4) I PSJPWD S PSJACPF=10 S PSJACPF=10 D WP^PSJAC D:$P(PSJSYSL,U,2)]"" ENQL^PSGLW
"RTN","PSIVORE",59,0)
 S PSGOP=DFN
"RTN","PSIVORE",60,0)
 Q
"RTN","PSIVORE",61,0)
 ;
"RTN","PSIVORE",62,0)
SITE ;See if site parameters are ok.
"RTN","PSIVORE",63,0)
 K PSIVQ D ^PSIVXU Q:$D(XQUIT)
"RTN","PSIVORE",64,0)
 I '$D(PSIVSN)!('$D(PSIVSITE)) W $C(7),$C(7),!!,"You have no IV ROOM parameters ... PLEASE ... PLEASE ...",!,"Exit this package and reenter properly !!",!! Q
"RTN","PSIVORE",65,0)
 D ORPARM^PSIVOREN S PSIVQ=1
"RTN","PSIVORE",66,0)
 Q
"RTN","PSIVORE",67,0)
 ;
"RTN","PSIVORE",68,0)
OK ;Print example label, run order through checker, ask if it is ok.
"RTN","PSIVORE",69,0)
 S P16=0,PSIVEXAM=1,(PSIVNOL,PSIVCT)=1 D GTOT^PSIVUTL(P(4)) I $G(P("PD"))="" D GTPD^PSIVORE2
"RTN","PSIVORE",70,0)
 D ^PSIVCHK I $D(DUOUT) S X="^" G DOA
"RTN","PSIVORE",71,0)
 I ERR=1 S X="N" G BAD
"RTN","PSIVORE",72,0)
 W ! D ^PSIVORLB K PSIVEXAM S Y=P(2) W !,"Start date: " X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),?30," Stop date: " S Y=P(3) X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),!
"RTN","PSIVORE",73,0)
 ;PSJ*5*157 EFD for IVs
"RTN","PSIVORE",74,0)
 D EFDIV^PSJUTL($G(ZZND))
"RTN","PSIVORE",75,0)
 D:'$G(PSGORQF) IN^PSJOCDS($G(ON55),"IV","") Q:$G(PSGORQF)
"RTN","PSIVORE",76,0)
 W:$G(PSIVCHG) !,"*** This change will cause a new order to be created. ***"
"RTN","PSIVORE",77,0)
 I '$G(PSIVCOPY) G:PSIVAC["R" OK1 S X="Is this O.K.: ^"_$S(ERR:"NO",1:"YES")_"^^NO"_$S(ERR'=1:",YES",1:"") D ENQ^PSIV
"RTN","PSIVORE",78,0)
 S PSJIVBD=1 ;var use to indicate order enter from back door
"RTN","PSIVORE",79,0)
BAD ;; I X["N" D GSTRING^PSIVORE1,^PSIVORV2,GTFLDS^PSIVORFE G OK
"RTN","PSIVORE",80,0)
 I ON55["V",($G(P(21))="") S P(17)="N"
"RTN","PSIVORE",81,0)
 I X["N" NEW PSGEBN,PSGLI S (P("INS"),PSGEBN,PSGLI)="",(PSJORD,ON)=ON55 D EN^VALM("PSJ LM IV AC/EDIT") S VALMBCK="Q" Q
"RTN","PSIVORE",82,0)
 I X["?" S HELP="OK" D ^PSIVHLP G OK
"RTN","PSIVORE",83,0)
DOA I X["^" D DEL55^PSIVORE2 Q
"RTN","PSIVORE",84,0)
 Q:$$NONVF("SN")
"RTN","PSIVORE",85,0)
OK1 S PSJORL=$$ENORL^PSJUTL($G(VAIN(4))),P(17)="A",ORSTS=6,ON=ON55,PSJORNP=+P(6)
"RTN","PSIVORE",86,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN
"RTN","PSIVORE",87,0)
 I PSJIVORF D NATURE^PSIVOREN I '$D(P("NAT")) D DEL55^PSIVORE2 Q
"RTN","PSIVORE",88,0)
 D SET55^PSIVORFB
"RTN","PSIVORE",89,0)
 I PSJIVORF,($G(P(22))=.5) D CLINIC^PSIVOREN
"RTN","PSIVORE",90,0)
 I PSJIVORF D SET^PSIVORFE S ORNATR=P("NAT"),ON=+ON55,OD=P(2) D EN1^PSJHL2(DFN,"SN",+ON55_"V","SEND ORDER NUMBER") ;,EN1^PSJHL2(DFN,"SC",+ON55_"V","NEW ORDER CREATED")
"RTN","PSIVORE",91,0)
 D VF1^PSJLIACT("V","ORDER ENTERED AS ACTIVE BY ",1)
"RTN","PSIVORE",92,0)
 D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,"N")
"RTN","PSIVORE",93,0)
 ;
"RTN","PSIVORE",94,0)
CAL ;Calculate doses.
"RTN","PSIVORE",95,0)
 ;S OD=P(2) D EN,^PSIVORE1,^PSIVOPT
"RTN","PSIVORE",96,0)
 S OD=P(2) D EN,^PSIVOPT
"RTN","PSIVORE",97,0)
 Q
"RTN","PSIVORE",98,0)
 ;
"RTN","PSIVORE",99,0)
EN ;Update schedule interval P(15) only on continuous orders.
"RTN","PSIVORE",100,0)
 ;This includes Hyp/Adm/Continuous Syringes/Chemos =>P(5)=0
"RTN","PSIVORE",101,0)
 Q:'$D(DFN)!('$D(ON55))  Q:$P(^PS(55,DFN,"IV",+ON55,0),U,4)="P"!($P(^(0),U,5))!($P(^(0),U,23)="P")
"RTN","PSIVORE",102,0)
 D SPSOL S XXX=$P(^PS(55,DFN,"IV",+ON55,0),U,8) G:'SPSOL ENQ I XXX?1N.N.1".".N1" ml/hr"!(XXX?1"0."1N1" ml/hr") S P(15)=$S('XXX:0,1:SPSOL\XXX*60+(SPSOL#XXX/XXX*60+.5)\1),$P(^PS(55,DFN,"IV",+ON55,0),U,15)=P(15) G ENQ
"RTN","PSIVORE",103,0)
 S P(15)=$S('$P(XXX,"@",2):0,1:1440/$P(XXX,"@",2)\1),$P(^PS(55,DFN,"IV",+ON55,0),U,15)=P(15)
"RTN","PSIVORE",104,0)
ENQ K SPSOL,XXX Q
"RTN","PSIVORE",105,0)
SPSOL S SPSOL=0 F XXX=0:0 S XXX=$O(^PS(55,DFN,"IV",+ON55,"SOL",XXX)) Q:'XXX  S SPSOL=SPSOL+$P(^(XXX,0),U,2)
"RTN","PSIVORE",106,0)
 K XXX Q
"RTN","PSIVORE",107,0)
ENIN ;Entry for Combined IV/UD order entry. Called by PSJOE0.
"RTN","PSIVORE",108,0)
 D HOLDHDR^PSJOE
"RTN","PSIVORE",109,0)
 W !
"RTN","PSIVORE",110,0)
 N PSJOUT S (DONE,FLAG)=0,PSIVAC="PN"
"RTN","PSIVORE",111,0)
ENIN1 ;
"RTN","PSIVORE",112,0)
 N DA,DIR,PSJOE,PSJPCAF,PSJSYSL,WSCHADM,PSJALLGY S:$G(VAIN(4)) WSCHADM=VAIN(4)
"RTN","PSIVORE",113,0)
 K P,PSIVCHG,PSJCOM
"RTN","PSIVORE",114,0)
 S PSJOE=1,DIR(0)="55.01,.04O",DIR("A")="Select IV TYPE" D ^DIR
"RTN","PSIVORE",115,0)
 I X]"",X'="^",$P("^PROFILE",X)="" S PSJOEPF=X Q
"RTN","PSIVORE",116,0)
 S:$D(DTOUT) X="^" I "^"[X S PSJORQF=PSJORQF+$S(X="^":2,$G(FLAG):0,1:1),X="." Q
"RTN","PSIVORE",117,0)
 S FLAG=1,PSIVTYPE=Y,(P(5),P(23))="" I "SC"[Y D @(Y_"^PSIVORC1") S $P(PSIVTYPE,U,2)=P(23)
"RTN","PSIVORE",118,0)
 D INMED G:'$D(PSJOUT) ENIN S:$D(PSJOUT) PSJORQF=2
"RTN","PSIVORE",119,0)
 Q
"RTN","PSIVORE",120,0)
NONVF(PSJOC)  ;If file at NonVF then quit with 1
"RTN","PSIVORE",121,0)
 NEW PSGOEAV S PSGOEAV=+$P(PSJSYSP0,U,9)
"RTN","PSIVORE",122,0)
 I +PSJSYSU=3,PSGOEAV Q 0
"RTN","PSIVORE",123,0)
 I +PSJSYSU=1,PSGOEAV Q 0
"RTN","PSIVORE",124,0)
 K DA D ENGNN^PSGOETO S ON=DA_"P",P(17)="N",P("REN")=0
"RTN","PSIVORE",125,0)
 D GTPD^PSIVORE2
"RTN","PSIVORE",126,0)
 D NATURE^PSIVOREN I '$D(P("NAT")) D:ON55["V" DEL55 Q 1
"RTN","PSIVORE",127,0)
 D:$G(VAIN(4))="" CLINIC^PSIVOREN
"RTN","PSIVORE",128,0)
 W !,"...transcribing this non-verified order...."
"RTN","PSIVORE",129,0)
 D PUT531^PSIVORFA
"RTN","PSIVORE",130,0)
 D:$G(PSJOC)]"" EN1^PSJHL2(DFN,PSJOC,ON,"SEND ORDER NUMBER")
"RTN","PSIVORE",131,0)
 D:ON55["V" DEL55
"RTN","PSIVORE",132,0)
 NEW PSJORD S (ON55,PSJORD)=ON
"RTN","PSIVORE",133,0)
 D VF^PSIVORC2
"RTN","PSIVORE",134,0)
 Q 1
"RTN","PSIVORE",135,0)
DEL55 ;
"RTN","PSIVORE",136,0)
 Q:ON55["P"
"RTN","PSIVORE",137,0)
 S X=$G(^PS(55,DFN,"IV",+ON55,0))
"RTN","PSIVORE",138,0)
 I $P(X,U,21)]"",($G(^PS(55,DFN,"IV",+ON55,2))]"") S $P(^(2),U,6)=ON,$P(^PS(53.1,+ON,0),U,25)=ON55 Q
"RTN","PSIVORE",139,0)
 NEW PSIVORFA S PSIVORFA=1
"RTN","PSIVORE",140,0)
 D DEL55^PSIVORE2
"RTN","PSIVORE",141,0)
 Q 
"RTN","PSIVORFB")
0^12^B61355252
"RTN","PSIVORFB",1,0)
PSIVORFB ;BIR/MLM-FILE/RETRIEVE ORDERS IN ^PS(55 ;25 Sep 98 / 2:24 PM
"RTN","PSIVORFB",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,18,28,68,58,85,110,111,120,134,213,161,181**;16 DEC 97;Build 190
"RTN","PSIVORFB",3,0)
 ;
"RTN","PSIVORFB",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA #2180.
"RTN","PSIVORFB",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA #2178.
"RTN","PSIVORFB",6,0)
 ; Reference to ^PS(52.6 is supported by DBIA #1231.
"RTN","PSIVORFB",7,0)
 ; Reference to ^PS(52.7 is supported by DBIA #2173.
"RTN","PSIVORFB",8,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSIVORFB",9,0)
 ; Reference to ^PS(51.1 is supported by DBIA #2177.
"RTN","PSIVORFB",10,0)
 ; Reference to ^PSUHL is supported by DBIA #4803.
"RTN","PSIVORFB",11,0)
 ; 
"RTN","PSIVORFB",12,0)
NEW55 ; Get new order number in 55.
"RTN","PSIVORFB",13,0)
 N DA,DD,DO,DIC,DLAYGO,X,Y,PSIVLIM,MINS,PSJDSTP1,PSJDSTP2,A,PSJCLIN,PSJDNM,PSJPROV,PSJWARD,PSJPAO,PSJALRT
"RTN","PSIVORFB",14,0)
 I $D(^PS(55,+DFN)),'$D(^PS(55,+DFN,0)) D ENSET0^PSGNE3(+DFN)
"RTN","PSIVORFB",15,0)
 I $G(PSJORD)["V"!($G(PSJORD)["P"),$G(P(2))]"" D LIMSTOP(.PSJDSTP1,.PSJDSTP2)
"RTN","PSIVORFB",16,0)
 I ($G(PSJORD)["P"!($G(PSJORD)["V"))&$G(PSIVLIM) I $$CMPLIM(PSJORD,PSJDSTP1,PSJDSTP2) D
"RTN","PSIVORFB",17,0)
 . D
"RTN","PSIVORFB",18,0)
 .. S PSJPROV=DUZ I PSJORD["P" S PSJPROV=$P($G(^PS(53.1,+PSJORD,0)),"^",2)
"RTN","PSIVORFB",19,0)
 .. I PSJORD["V" S PSJPROV=$P($G(^PS(55,DFN,"IV",+PSJORD,0)),"^",6)
"RTN","PSIVORFB",20,0)
 .. D NOW^%DTC S XQA(PSJPROV)="",XQAID="PSJ,"_DFN_";"_PSJPROV_";"_%,XQADATA=""
"RTN","PSIVORFB",21,0)
 .. D
"RTN","PSIVORFB",22,0)
 ... I PSJORD["P" S A=$G(^PS(53.1,+PSJORD,"DSS"))
"RTN","PSIVORFB",23,0)
 ... I PSJORD["V" S A=$G(^PS(55,PSGP,"IV",+PSJORD,"DSS"))
"RTN","PSIVORFB",24,0)
 ... S PSJCLIN=$P(A,"^") I PSJCLIN]"" S PSJCLIN=$P(^SC(PSJCLIN,0),"^")
"RTN","PSIVORFB",25,0)
 .. S A=$G(^DPT(DFN,0)),PSJWARD=$G(^(.1))
"RTN","PSIVORFB",26,0)
 .. S XQAMSG=$P(A,"^")_" ("_$E($P(A,"^"))_$E($P(A,"^",9),6,9)_"): ["_$S(PSJWARD]"":$E(PSJWARD,1,10),$G(PSJCLIN)]"":$E(PSJCLIN,1,10),1:"UNKNOWN")_"] "
"RTN","PSIVORFB",27,0)
 .. S A=$O(DRG("AD",0)) I A]"" S A=DRG("AD",A)
"RTN","PSIVORFB",28,0)
 .. I A="" S A=$O(DRG("SOL",0)) I A]"" S A=DRG("SOL",A)
"RTN","PSIVORFB",29,0)
 .. S PSJDNM=$P(^PS(50.7,+$P(A,"^",6),0),"^")
"RTN","PSIVORFB",30,0)
 .. S XQAMSG=XQAMSG_PSJDNM_" your DURATION not used for stop date/time"
"RTN","PSIVORFB",31,0)
 .. D SETUP^XQALERT
"RTN","PSIVORFB",32,0)
 .. S PSJALRT=$$FMTDUR^PSJLIVMD($S(PSJORD["P":$P($G(^PS(53.1,+PSJORD,2.5)),"^",4),PSJORD["IV":$P($G(^PS(55,DFN,"IV",+PSJORD,2.5)),"^",4),1:"UNK"))
"RTN","PSIVORFB",33,0)
 S DIC="^PS(55,",DIC(0)="LN",DLAYGO=55,(DINUM,X)=+DFN D ^DIC Q:Y<0
"RTN","PSIVORFB",34,0)
LOCK0 F  L +^PS(55,DFN,"IV",0):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  Q
"RTN","PSIVORFB",35,0)
 S ND=$S($D(^PS(55,DFN,"IV",0)):^(0),1:"^55.01") F DA=$P(ND,"^",3)+1:1 W "." I '$D(^PS(55,DFN,"IV",DA)) S $P(ND,"^",3)=DA,$P(ND,"^",4)=$P(ND,"^",4)+1,^PS(55,DFN,"IV",0)=ND Q
"RTN","PSIVORFB",36,0)
 L +^PS(55,DFN,"IV",+DA):$S($G(DILOCKTM)>0:DILOCKTM,1:3) E  G LOCK0
"RTN","PSIVORFB",37,0)
 S ^PS(55,DFN,"IV",+DA,0)=+DA,^PS(55,DFN,"IV","B",+DA,+DA)=""
"RTN","PSIVORFB",38,0)
 L -^PS(55,DFN,"IV",0) S ON55=+DA_"V"
"RTN","PSIVORFB",39,0)
 I $G(PSJALRT)]"" S PSIVAL="IV LIMIT OVERRIDDEN ("_$G(PSJALRT)_"): ALERT SENT",PSIVALT="",PSIVREA="E" D
"RTN","PSIVORFB",40,0)
 .D LOG^PSIVORAL S P("LIMIT")="",P("OVRIDE")=1 K IVLIM,IVLIMIT
"RTN","PSIVORFB",41,0)
 .S $P(^PS(55,DFN,"IV",+ON55,2.5),"^",4)="" S:$G(PSJORD)["P" $P(^PS(53.1,+PSJORD,2.5),"^",4)=""
"RTN","PSIVORFB",42,0)
 .K PSIVAL,PSIVREA,PSIVALT
"RTN","PSIVORFB",43,0)
 Q
"RTN","PSIVORFB",44,0)
SET55 ; Move data from local variables to 55.
"RTN","PSIVORFB",45,0)
 I '$D(ON55) W !,"*** Can't create this order at this time ***" Q
"RTN","PSIVORFB",46,0)
 N DA,DIK,ND,PSIVACT,PSIVDUR
"RTN","PSIVORFB",47,0)
 S:'$D(P(21)) (P(21),P("21FLG"))="" S ND(0)=+ON55,P(22)=$S(VAIN(4):+VAIN(4),1:.5) F X=2:1:23 I $D(P(X)) S $P(ND(0),U,X)=P(X)
"RTN","PSIVORFB",48,0)
 S ND(.3)=$G(P("INS")),ND(2.5)="" N X S X=$S($G(PSGORD):PSGORD,1:$G(ON)) I X D
"RTN","PSIVORFB",49,0)
 .N PKG S PKG=$E(X,$L(X)) S PKG=$S(PKG="V":"""IV""",PKG="U":5,PKG="P":"P",1:"") Q:PKG=""
"RTN","PSIVORFB",50,0)
 .S PSIVDUR=$$GETDUR^PSJLIVMD(DFN,+X,$E(X,$L(X)),1) Q:PSIVDUR=""
"RTN","PSIVORFB",51,0)
 .I $G(IVLIMIT) S ND(2.5)="^^^"_PSIVDUR K IVLIMIT Q
"RTN","PSIVORFB",52,0)
 S $P(ND(0),U,17)="A",ND(1)=P("REM"),ND(3)=P("OPI"),ND(.2)=$P($G(P("PD")),U)_U_$G(P("DO"))_U_+P("MR")_U_$G(P("PRY"))_U_$G(P("NAT"))_U_U_U_$G(P("PRNTON"))
"RTN","PSIVORFB",53,0)
 F X=0,1,2.5,3,.2,.3 S ^PS(55,DFN,"IV",+ON55,X)=ND(X)
"RTN","PSIVORFB",54,0)
 ; PSJ*5*213 - if Piggyback, intermittent syringe, or
"RTN","PSIVORFB",55,0)
 ; intermittent chemotherapy, and frequency is null, attempt to
"RTN","PSIVORFB",56,0)
 ; set frequency again based on P(15),PSGS0XT, and piece 3 of ZZND if they exist.
"RTN","PSIVORFB",57,0)
 ; If this still is null, attempt to re-set based upon the schedule name.
"RTN","PSIVORFB",58,0)
 I $G(P("IVCAT"))="I"!($P($G(ND(0)),U,4)?1(1"P",1"S",1"C"))&($P($G(ND(0)),U,15)="") D
"RTN","PSIVORFB",59,0)
 . I $P($G(ND(0)),U,4)="S",$P($G(ND(0)),U,5)'=1 Q  ;Not intermittent syringe
"RTN","PSIVORFB",60,0)
 . I $P($G(ND(0)),U,4)="C",$P($G(ND(0)),U,23)?1(1"A",1"H") Q  ;Not chemo piggyback or syringe
"RTN","PSIVORFB",61,0)
 . I $P($G(ND(0)),U,4)="C",$P($G(ND(0)),U,23)="S",$P($G(ND(0)),U,5)'=1 Q  ;Not intermitent chemo syringe
"RTN","PSIVORFB",62,0)
 . S $P(^PS(55,DFN,"IV",+ON55,0),U,15)=$S($G(P(15))'="":P(15),$G(PSGS0XT)'="":PSGS0XT,$P($G(ZZND),"^",3)'="":$P(ZZND,"^",3),1:$$GETFRQ($P($G(ND(0)),U,9))) K PSJFRQ,PSJSKED
"RTN","PSIVORFB",63,0)
 S $P(^PS(55,DFN,"IV",+ON55,2),U,1,4)=P("LOG")_U_+P("IVRM")_U_U_P("SYRS"),$P(^(2),U,8,10)=P("RES")_U_$G(P("FRES"))_U_$S($G(VAIN(4)):+VAIN(4),1:"")
"RTN","PSIVORFB",64,0)
 S X=^PS(55,DFN,0) I $P(X,"^",7)="" S $P(X,"^",7)=$P($P(P("LOG"),"^"),"."),$P(X,"^",8)="A",^(0)=X D LOGDFN^PSUHL(DFN)
"RTN","PSIVORFB",65,0)
 S $P(^PS(55,DFN,"IV",+ON55,2),U,11)=+P("CLRK")
"RTN","PSIVORFB",66,0)
 S:+$G(P("CLIN")) $P(^PS(55,DFN,"IV",+ON55,"DSS"),"^")=P("CLIN")
"RTN","PSIVORFB",67,0)
 S:+$G(P("APPT")) $P(^PS(55,DFN,"IV",+ON55,"DSS"),"^",2)=P("APPT")
"RTN","PSIVORFB",68,0)
 S:+$G(P("NINIT")) ^PS(55,DFN,"IV",+ON55,4)=P("NINIT")_U_P("NINITDT")
"RTN","PSIVORFB",69,0)
 I '$G(PSIVCHG)!($G(PSJREN)&($G(PSIVCHG)=2)) I $G(P("PON")),P("PON")'=ON55 D
"RTN","PSIVORFB",70,0)
 . N X S X=$S(P("PON")["P":"^PS(53.1,+P(""PON""),12,0)",P("PON")["V"&$G(PSJREN):"^PS(55,DFN,""IV"",+P(""PON""),5,0)",1:"") Q:X=""
"RTN","PSIVORFB",71,0)
 . I $O(@X) S %X=X,%Y="^PS(55,"_DFN_",""IV"","_+ON55_",5," D %XY^%RCR
"RTN","PSIVORFB",72,0)
 F DRGT="AD","SOL" D PUTD55
"RTN","PSIVORFB",73,0)
 K DA,DIK S DA(1)=DFN,DA=+ON55,DIK="^PS(55,"_DA(1)_",""IV"",",PSIVACT=1 D IX^DIK
"RTN","PSIVORFB",74,0)
 I $G(PSJCOM),$G(PSJCOMSI),$G(PSJORD)["V" K PSJCOMSI N PSJCHILD,PSJOEORD S PSJOEORD=0 F  S PSJOEORD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD)) Q:'PSJOEORD  D
"RTN","PSIVORFB",75,0)
 . N PSJCHILD S PSJCHILD=0 F  S PSJCHILD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD,PSJCHILD)) Q:'PSJCHILD  S PSJCHILD(+PSJCHILD)=PSJCOM
"RTN","PSIVORFB",76,0)
 . S PSJCHILD=0 F  S PSJCHILD=$O(PSJCHILD(PSJCHILD)) Q:'PSJCHILD  D
"RTN","PSIVORFB",77,0)
 .. Q:PSJCHILD=PSJORD  K DR,DA,DIE,ORD S DR="31////"_$P($G(P("OPI")),"^",1,2),DA(1)=DFN
"RTN","PSIVORFB",78,0)
 .. N ON,ON55 S (ON,ON55)=+PSJCHILD_"V" S:+$G(PSJPINIT)'>0 PSJPINIT=DUZ S PSIVALT=1,PSIVAL="COMPLEX ORDER" D ENTACT^PSIVAL D
"RTN","PSIVORFB",79,0)
 ... I $P($G(^PS(55,DFN,"IV",+ON55,3)),"^")'=$P(P("OPI"),"^") S P("FC")="OTHER PRINT INFO^"_$P($G(^(3)),"^")_U_$P(P("OPI"),"^") D GTFC^PSIVORAL
"RTN","PSIVORFB",80,0)
 ... I $D(^PS(55,DFN,"IV",+ON55,0)) S ^PS(55,DFN,"IV",+ON55,3)=P("OPI") D EN1^PSJHL2(DFN,"XX",ON55)
"RTN","PSIVORFB",81,0)
 Q
"RTN","PSIVORFB",82,0)
 ;
"RTN","PSIVORFB",83,0)
PUTD55 ; Move drug data from local array into 55
"RTN","PSIVORFB",84,0)
 K ^PS(55,DFN,"IV",+ON55,DRGT) S ^PS(55,DFN,"IV",+ON55,DRGT,0)=$S(DRGT="AD":"^55.02PA",1:"^55.11IPA")
"RTN","PSIVORFB",85,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSIVORFB",86,0)
 .S Y=^PS(55,DFN,"IV",+ON55,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSIVORFB",87,0)
 .S ^PS(55,DFN,"IV",+ON55,DRGT,0)=Y,Y=$P(DRG(DRGT,X),U)_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^PS(55,DFN,"IV",+ON55,DRGT,+DRG,0)=Y
"RTN","PSIVORFB",88,0)
 Q
"RTN","PSIVORFB",89,0)
GT55 ; Retrieve data from 55 into local array
"RTN","PSIVORFB",90,0)
 K DRG,DRGN,P S:'$D(ON55) ON55=ON S P("REN")="",Y=$G(^PS(55,DFN,"IV",+ON55,0)) F X=1:1:25 S P(X)=$P(Y,U,X)
"RTN","PSIVORFB",91,0)
 S P("21FLG")=P(21)
"RTN","PSIVORFB",92,0)
 S P("PON")=ON55,PSJORIFN=P(21),P(6)=P(6)_U_$P($G(^VA(200,+P(6),0)),U),(DRG,DRGN)="",P("REM")=$G(^PS(55,DFN,"IV",+ON55,1))
"RTN","PSIVORFB",93,0)
 S Y=$G(^PS(55,DFN,"IV",+ON55,2)),P("LOG")=$P(Y,U),P("IVRM")=$P(Y,U,2)_U_$P($G(^PS(59.5,+$P(Y,U,2),0)),U)
"RTN","PSIVORFB",94,0)
 S P("CLRK")=$P(Y,U,11)_U_$P($G(^VA(200,+$P(Y,U,11),0)),U),P("RES")=$P(Y,U,8),P("FRES")=$P(Y,U,9),P("SYRS")=$P(Y,U,4),P("OPI")=$G(^PS(55,DFN,"IV",+ON55,3))
"RTN","PSIVORFB",95,0)
 S P("INS")=$G(^PS(55,DFN,"IV",+ON55,.3))
"RTN","PSIVORFB",96,0)
 S P("CLIN")=$P($G(^PS(55,DFN,"IV",+ON55,"DSS")),"^"),P("APPT")=$P($G(^PS(55,DFN,"IV",+ON55,"DSS")),"^",2)
"RTN","PSIVORFB",97,0)
 S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSIVORFB",98,0)
 D:'$D(PSJLABEL) GTPC(ON55) S ND=$G(^PS(55,DFN,"IV",+ON55,.2)),P("PD")=$S($P(ND,U):$P(ND,U)_U_$$OIDF^PSJLMUT1(+ND)_U_$P($G(^PS(50.7,+ND,0)),U),1:""),P("DO")=$P(ND,U,2),P("PRY")=$P(ND,U,4),P("NAT")=$P(ND,U,5),(PSJCOM,P("PRNTON"))=$P(ND,U,8)
"RTN","PSIVORFB",99,0)
 I P("PRY")="D",'+P("IVRM") S P("IVRM")=+$G(PSIVSN)_U_$P($G(^PS(59.5,+$G(PSIVSN),0)),U)
"RTN","PSIVORFB",100,0)
 S P("MR")=$P(ND,U,3),ND=$G(^PS(51.2,+P("MR"),0)),P("MR")=P("MR")_U_$S($P(ND,U,3)]"":$P(ND,U,3),1:$P(ND,U)) D GTCUM
"RTN","PSIVORFB",101,0)
 D GTDRG,GTOT^PSIVUTL(P(4))
"RTN","PSIVORFB",102,0)
 N ND2P5 S ND2P5=$G(^PS(55,DFN,"IV",+ON55,2.5)) D
"RTN","PSIVORFB",103,0)
 .S P("DUR")=$P(ND2P5,"^",2)
"RTN","PSIVORFB",104,0)
 .S P("LIMIT")=$P(ND2P5,"^",4)
"RTN","PSIVORFB",105,0)
 .S P("IVCAT")=$P(ND2P5,"^",5)
"RTN","PSIVORFB",106,0)
K ; Kill and exit.
"RTN","PSIVORFB",107,0)
 K FIL,ND
"RTN","PSIVORFB",108,0)
 Q
"RTN","PSIVORFB",109,0)
GTDRG ; Get drug info and place in DRG(.
"RTN","PSIVORFB",110,0)
 F DRGT="AD","SOL" S FIL=$S(DRGT="AD":52.6,1:52.7) F Y=0:0 S Y=$O(^PS(55,DFN,"IV",+ON55,DRGT,Y)) Q:'Y  D
"RTN","PSIVORFB",111,0)
 .; naked ref below refers to line above
"RTN","PSIVORFB",112,0)
 .S DRG=$G(^(Y,0)),ND=$G(^PS(FIL,+DRG,0)),(DRGI,DRG(DRGT,0))=$G(DRG(DRGT,0))+1
"RTN","PSIVORFB",113,0)
 .S DRG(DRGT,+DRGI)=+DRG_U_$P(ND,U)_U_$P(DRG,U,2)_U_$P(DRG,U,3)_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSIVORFB",114,0)
 Q
"RTN","PSIVORFB",115,0)
 ;
"RTN","PSIVORFB",116,0)
GTCUM ; Retrieve dispensing info.
"RTN","PSIVORFB",117,0)
 S ND=$G(^PS(55,DFN,"IV",+ON55,9)),P("LF")=$P(ND,U),P("LFA")=$P(ND,U,2),P("CUM")=$P(ND,U,3)
"RTN","PSIVORFB",118,0)
 Q
"RTN","PSIVORFB",119,0)
 ;
"RTN","PSIVORFB",120,0)
GTPC(ON) ; Retrieve Provider Comments and create "scratch" fields to edit
"RTN","PSIVORFB",121,0)
 Q
"RTN","PSIVORFB",122,0)
 ;
"RTN","PSIVORFB",123,0)
SETNEW ; Create new order and set
"RTN","PSIVORFB",124,0)
 D NEW55,SET55
"RTN","PSIVORFB",125,0)
 Q
"RTN","PSIVORFB",126,0)
 ;
"RTN","PSIVORFB",127,0)
CMPLIM(PSJORD,PSJDSTP1,PSJDSTP2) ; Compare stop date of order against IV Limit
"RTN","PSIVORFB",128,0)
 I $P($G(^PS(53.1,+PSJORD,0)),"^",25)]"" D CHKD Q:PSJPAO 0
"RTN","PSIVORFB",129,0)
 I $G(PSJDSTP1),$E(+PSJDSTP1,1,11)'=$E(+P(3),1,11),+PSJDSTP2'=+P(3) Q 1
"RTN","PSIVORFB",130,0)
 Q 0
"RTN","PSIVORFB",131,0)
 ;
"RTN","PSIVORFB",132,0)
LIMSTOP(PSJDSTP1,PSJDSTP2) ; Calculate default stop date using IV Limit
"RTN","PSIVORFB",133,0)
 ;      Output: PSJDSTP1 - Default stop using duration only
"RTN","PSIVORFB",134,0)
 ;              PSJDSTP2 - Default stop using duration and IV parameters for time
"RTN","PSIVORFB",135,0)
 S PSIVLIM=$$GETLIM^PSIVCAL(DFN,PSJORD)
"RTN","PSIVORFB",136,0)
 I 'PSIVLIM,PSIVLIM]"" S PSIVLIM=$$GETMIN^PSIVCAL(PSIVLIM,DFN,PSJORD)
"RTN","PSIVORFB",137,0)
 I PSIVLIM]"" D
"RTN","PSIVORFB",138,0)
 . S MINS=$$GETMIN^PSIVCAL(PSIVLIM,DFN,PSJORD),PSJDSTP1=$$FMADD^XLFDT(P(2),,,MINS)
"RTN","PSIVORFB",139,0)
 . S X=$P(PSJDSTP1,"."),PSJDSTP2=X_$S($P(PSIVSITE,"^",14)="":.2359,1:"."_$P(PSIVSITE,"^",14))
"RTN","PSIVORFB",140,0)
 Q
"RTN","PSIVORFB",141,0)
 ;
"RTN","PSIVORFB",142,0)
GETFRQ(PSJSKED) ;Get frequency using name of schedule
"RTN","PSIVORFB",143,0)
 I PSJSKED="" K PSJSKED Q ""
"RTN","PSIVORFB",144,0)
 S (PSJCNTX,PSJFRQ)=""
"RTN","PSIVORFB",145,0)
 I $D(^PS(51.1,"APPSJ",PSJSKED)) F  S PSJCNTX=$O(^PS(51.1,"APPSJ",PSJSKED,PSJCNTX)) Q:PSJCNTX=""  D  Q:$G(PSJFRQ)'=""
"RTN","PSIVORFB",146,0)
 . I $P($G(^PS(51.1,PSJCNTX,0)),U,3)'="" S PSJFRQ=$P(^PS(51.1,PSJCNTX,0),U,3)
"RTN","PSIVORFB",147,0)
 K PSJCNTX
"RTN","PSIVORFB",148,0)
 Q PSJFRQ
"RTN","PSIVORFB",149,0)
 ;
"RTN","PSIVORFB",150,0)
CHKD ;Check for a previous active order and compare the duration
"RTN","PSIVORFB",151,0)
 N PSJPO,A,PSJDUR
"RTN","PSIVORFB",152,0)
 S PSJDUR=$$GETLIM^PSIVCAL(DFN,PSJORD)
"RTN","PSIVORFB",153,0)
 S PSJPAO=0,PSJPO=PSJORD
"RTN","PSIVORFB",154,0)
CHKDR S PSJPO=$P($G(^PS(53.1,+PSJPO,0)),"^",25) Q:PSJPO=""
"RTN","PSIVORFB",155,0)
 I PSJPO["P" G CHKDR
"RTN","PSIVORFB",156,0)
 I PSJPO["V" S PSIVLIM=$$GETLIM^PSIVCAL(DFN,PSJPO) I PSJDUR'=PSIVLIM S PSJPAO=1 Q
"RTN","PSIVORFB",157,0)
 G CHKDR
"RTN","PSIVPRO")
0^6^B36988166
"RTN","PSIVPRO",1,0)
PSIVPRO ;BIR/PR,MLM-PROFILE AN ORDER ;01 OCT 96 / 9:48 AM
"RTN","PSIVPRO",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**38,58,85,110,181**;16 DEC 97;Build 190
"RTN","PSIVPRO",3,0)
 ;
"RTN","PSIVPRO",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIVPRO",5,0)
 ;        
"RTN","PSIVPRO",6,0)
 ;Needs DFN and ^TMP("PSIV",$J) array
"RTN","PSIVPRO",7,0)
 S PSJLN=1,PSIVX2=0
"RTN","PSIVPRO",8,0)
 S PSIVST=$O(^TMP("PSIV",$J,0)),X="",(PSIVON,PS)=0 D REACT I PSIVST]"" F PSIVX1=1:1 D PSIVST Q:'PSIVON  D PR
"RTN","PSIVPRO",9,0)
 S ^TMP("PSJPRO",$J,0)=PSIVX2,VALMCNT=PSJLN-1
"RTN","PSIVPRO",10,0)
 I $G(PSIVBR)="D ^PSIVOPT" S VALM("TITLE")="IV Order Entry"
"RTN","PSIVPRO",11,0)
 E  S VALM("TITLE")="IV Profile"
"RTN","PSIVPRO",12,0)
QUIT ; Kill and exit.
"RTN","PSIVPRO",13,0)
 S ON=X K ADM,AL,DRG,GMRA,GMRAL,PSIVST,PSIVX1,PSIVX2,Y,NAD,N0,X3,X4,X5
"RTN","PSIVPRO",14,0)
 Q
"RTN","PSIVPRO",15,0)
 ;
"RTN","PSIVPRO",16,0)
PSIVST ;
"RTN","PSIVPRO",17,0)
 S PSIVON=$O(^TMP("PSIV",$J,PSIVST,PSIVON)) I 'PSIVON S PSIVST=$O(^TMP("PSIV",$J,PSIVST_"Z")) I PSIVST]"" S PSIVON=$O(^TMP("PSIV",$J,PSIVST,0)) D HDL
"RTN","PSIVPRO",18,0)
 Q
"RTN","PSIVPRO",19,0)
REACT ;
"RTN","PSIVPRO",20,0)
 S PSJL="#   Additive",PSJL=$$SETSTR^VALM1("Last fill",PSJL,32,9)
"RTN","PSIVPRO",21,0)
 S PSJL=$$SETSTR^VALM1("Type",PSJL,49,4),PSJL=$$SETSTR^VALM1(" Start   Stop  Stat",PSJL,54,19)
"RTN","PSIVPRO",22,0)
 S PSJL=$$SETSTR^VALM1("Renew",PSJL,74,5)
"RTN","PSIVPRO",23,0)
 D SETTMP^PSJLMPRI
"RTN","PSIVPRO",24,0)
HDL ; Display type heading.
"RTN","PSIVPRO",25,0)
 S PSJL=""
"RTN","PSIVPRO",26,0)
 D ACL:PSIVST="A",DPL:PSIVST="RD",POL:PSIVST="P",POCL:PSIVST="PD",NVL:PSIVST="N",NVCL:PSIVST="ND",NOL:PSIVST="X",NOC:PSIVST="" S X=""
"RTN","PSIVPRO",27,0)
 S PSJL=$E(PSJL,1,79) D SETTMP^PSJLMPRI
"RTN","PSIVPRO",28,0)
 Q
"RTN","PSIVPRO",29,0)
 ;
"RTN","PSIVPRO",30,0)
PR ; Get & display order.
"RTN","PSIVPRO",31,0)
 S (ON,ON55)=9999999999-($S(PSIVST["P":$E(PSIVON,2,11),PSIVST["N":$E(PSIVON,2,11),1:PSIVON))_$S(PSIVST["P":"P",PSIVST["N":"P",1:"V") D @$S(PSIVST["P":"GT531^PSIVORFA(DFN,ON)",PSIVST["N":"GT531^PSIVORFA(DFN,ON)",1:"GT55^PSIVORFB")
"RTN","PSIVPRO",32,0)
 S X="",PS=PSIVX1 K ^TMP("PSIV",$J,PSIVST,PSIVON) S ^TMP("PSIV",$J,PSIVST_"B",PSIVX1)=$S(PSIVST["P":$E(PSIVON,2,11),PSIVST["N":$E(PSIVON,2,11),1:PSIVON)_$S(PSIVST["P":"P",PSIVST["N":"P",1:"V")
"RTN","PSIVPRO",33,0)
 I PSIVST="RD" D ENPL Q
"RTN","PSIVPRO",34,0)
 I PSIVST["D" N PSJO,PSIVX3 S PSIVX3=PSIVX1,PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJCOM,PSJO)) Q:'PSJO  S ON=PSJO_"P" D GT531^PSIVORFA(DFN,ON),ENPL S PSIVX1=""
"RTN","PSIVPRO",35,0)
 I PSIVST["D" S PSIVX1=PSIVX3 Q
"RTN","PSIVPRO",36,0)
 ;
"RTN","PSIVPRO",37,0)
ENPL ;
"RTN","PSIVPRO",38,0)
 NEW MARX,DRUGNAME,X,XX
"RTN","PSIVPRO",39,0)
 S PSJL=$J(PSIVX1,4) I ON["P",(P("OT")'="F"),P(4)'="H" D  Q
"RTN","PSIVPRO",40,0)
 . I $D(VALMEVL) D
"RTN","PSIVPRO",41,0)
 .. N PSJFLAG
"RTN","PSIVPRO",42,0)
 .. S PSJFLAG=$P($S(ON["V":$G(^PS(55,DFN,"IV",+ON,.2)),1:$G(^PS(53.1,+ON,.2))),U,7)
"RTN","PSIVPRO",43,0)
 .. I PSJFLAG D CNTRL^VALM10(PSJLN,1,4,IORVON,IORVOFF,0)
"RTN","PSIVPRO",44,0)
 . D DRGDISP^PSJLMUT1(DFN,ON,34,59,.DRUGNAME,0)
"RTN","PSIVPRO",45,0)
 . NEW X F X=0:0 S X=$O(DRUGNAME(X)) Q:'X  S:X>1 PSJL="" S PSJL=$$SETSTR^VALM1(DRUGNAME(X),PSJL,$S(X=1:6,1:7),$S(X=1:34,1:65)) D:X=1 V D SETTMP^PSJLMPRI
"RTN","PSIVPRO",46,0)
 S X=$J(PSIVX1,4)_$S(P("PRY")="D":" d",1:"  ")
"RTN","PSIVPRO",47,0)
 I ON["V" S XX=$G(^PS(55,DFN,"IV",+ON,4)) D
"RTN","PSIVPRO",48,0)
 . I +PSJSYSU=1,'+XX S X=X_"->"
"RTN","PSIVPRO",49,0)
 . I +PSJSYSU=3,'+$P(XX,U,4) S X=X_"->"
"RTN","PSIVPRO",50,0)
 S PSJL=X
"RTN","PSIVPRO",51,0)
 I $D(VALMEVL) D
"RTN","PSIVPRO",52,0)
 . N PSJFLAG
"RTN","PSIVPRO",53,0)
 . S PSJFLAG=$P($S(ON["V":$G(^PS(55,DFN,"IV",+ON,.2)),1:$G(^PS(53.1,+ON,.2))),U,7)
"RTN","PSIVPRO",54,0)
 . I PSJFLAG D CNTRL^VALM10(PSJLN,1,4,IORVON,IORVOFF,0)
"RTN","PSIVPRO",55,0)
 D AD,SOL
"RTN","PSIVPRO",56,0)
 Q
"RTN","PSIVPRO",57,0)
SOL ;
"RTN","PSIVPRO",58,0)
 NEW NAME,PSJNOAD,L ;S PSJNOAD=0,L=34
"RTN","PSIVPRO",59,0)
 S NAD=0 F  S NAD=$O(DRG("SOL",NAD)) Q:'NAD  D
"RTN","PSIVPRO",60,0)
 . K NAME S L=34,PSJNOAD=0
"RTN","PSIVPRO",61,0)
 . I '$D(DRG("AD",1)),NAD=1 S PSJNOAD=1,L=27
"RTN","PSIVPRO",62,0)
 . S:NAD=1 PSJL=$$SETSTR^VALM1("in",PSJL,6,11)
"RTN","PSIVPRO",63,0)
 . D NAME^PSIVUTL(DRG("SOL",NAD),L,.NAME,0)
"RTN","PSIVPRO",64,0)
 . F X=0:0 S X=$O(NAME(X)) Q:'X  S:(NAD>1!(X>1)) PSJL="" S PSJL=$$SETSTR^VALM1(NAME(X),PSJL,9,34) D:X=1&PSJNOAD V D SETTMP^PSJLMPRI
"RTN","PSIVPRO",65,0)
 . S PSJL=""
"RTN","PSIVPRO",66,0)
 Q
"RTN","PSIVPRO",67,0)
AD ;
"RTN","PSIVPRO",68,0)
 NEW NAME
"RTN","PSIVPRO",69,0)
 S NAD=0 F  S NAD=$O(DRG("AD",NAD)) Q:'NAD  D
"RTN","PSIVPRO",70,0)
 . K NAME
"RTN","PSIVPRO",71,0)
 . D NAME^PSIVUTL(DRG("AD",NAD),30,.NAME,1)
"RTN","PSIVPRO",72,0)
 . F X=0:0 S X=$O(NAME(X)) Q:'X  S:(NAD>1!(X>1)) PSJL="" S PSJL=$$SETSTR^VALM1(NAME(X),PSJL,6,34) D:(NAD=1&(X=1)) V D SETTMP^PSJLMPRI
"RTN","PSIVPRO",73,0)
 . S PSJL=""
"RTN","PSIVPRO",74,0)
 Q
"RTN","PSIVPRO",75,0)
 ;
"RTN","PSIVPRO",76,0)
V S Y=$S(ON["V":$P($G(^PS(55,DFN,"IV",+ON,9)),U),1:"")
"RTN","PSIVPRO",77,0)
 I +Y>0 X ^DD("DD") S Y=$P(Y,",")_" "_$P($P(Y,"@",2),":",1,2)
"RTN","PSIVPRO",78,0)
 E  S Y="**   N/P  **"
"RTN","PSIVPRO",79,0)
 S PSJL=$$SETSTR^VALM1(Y,PSJL,33,12)
"RTN","PSIVPRO",80,0)
 S PSJL=$$SETSTR^VALM1(" #"_$S(ON["V":+$P($G(^PS(55,DFN,"IV",+ON,9)),U,2),1:0),PSJL,46,3)
"RTN","PSIVPRO",81,0)
 S:PSIVX1]"" PSIVX2=PSIVX2+1
"RTN","PSIVPRO",82,0)
 D REST
"RTN","PSIVPRO",83,0)
 Q
"RTN","PSIVPRO",84,0)
ACL ;
"RTN","PSIVPRO",85,0)
 F X3=1:1:71 S PSJL=PSJL_"-" S:X3=34 PSJL=PSJL_" A c t i v e "
"RTN","PSIVPRO",86,0)
 Q
"RTN","PSIVPRO",87,0)
NVL ;
"RTN","PSIVPRO",88,0)
 F X3=1:1:71 S PSJL=PSJL_"-" S:X3=34 PSJL=PSJL_" N o n - V e r i f i e d "
"RTN","PSIVPRO",89,0)
 Q
"RTN","PSIVPRO",90,0)
NVCL ;
"RTN","PSIVPRO",91,0)
 F X3=1:1:71 S PSJL=PSJL_"-" S:X3=34 PSJL=PSJL_" N o n - V e r i f i e d  C o m p l e x "
"RTN","PSIVPRO",92,0)
 Q
"RTN","PSIVPRO",93,0)
POL ;
"RTN","PSIVPRO",94,0)
 F X3=1:1:71 S PSJL=PSJL_"-" S:X3=34 PSJL=PSJL_" P e n d i n g "
"RTN","PSIVPRO",95,0)
 Q
"RTN","PSIVPRO",96,0)
POCL ;
"RTN","PSIVPRO",97,0)
 F X3=1:1:66 S PSJL=PSJL_"-" S:X3=34 PSJL=PSJL_" P e n d i n g  C o m p l e x "
"RTN","PSIVPRO",98,0)
 Q
"RTN","PSIVPRO",99,0)
NOL ;
"RTN","PSIVPRO",100,0)
 F X3=1:1:66 S PSJL=PSJL_"-" S:X3=34 PSJL=PSJL_" N o t   A c t i v e "
"RTN","PSIVPRO",101,0)
 Q
"RTN","PSIVPRO",102,0)
DPL ;Recently dc/expired header
"RTN","PSIVPRO",103,0)
 S PSJDCEXP=$$RECDCEXP^PSJP()
"RTN","PSIVPRO",104,0)
 F X3=1:1:71 S PSJL=PSJL_"-" S:X3=15 PSJL=PSJL_"Recently Discontinued/Expired (Last "_+$G(PSJDCEXP)_" hours)"
"RTN","PSIVPRO",105,0)
 Q
"RTN","PSIVPRO",106,0)
NOC ;
"RTN","PSIVPRO",107,0)
 F X3=1:1:66 S PSJL=PSJL_"-" S:X3=34 PSJL=PSJL_" No current IV information "
"RTN","PSIVPRO",108,0)
 ;
"RTN","PSIVPRO",109,0)
 S PSJL=""
"RTN","PSIVPRO",110,0)
 Q
"RTN","PSIVPRO",111,0)
REST ;
"RTN","PSIVPRO",112,0)
 S PSJL=$$SETSTR^VALM1(P(4),PSJL,52,1)
"RTN","PSIVPRO",113,0)
 S PSJL=$$SETSTR^VALM1($E($$ENDTC^PSGMI(P(2)),1,5),PSJL,55,5)
"RTN","PSIVPRO",114,0)
 S PSJL=$$SETSTR^VALM1($E($$ENDTC^PSGMI(P(3)),1,5),PSJL,62,5)
"RTN","PSIVPRO",115,0)
 S PSJL=$$SETSTR^VALM1($S(P(17)="R"&(ON'["V"):"R/I",$G(P(25))]"":P(25),1:P(17)),PSJL,69,2)
"RTN","PSIVPRO",116,0)
 S PSJL=$$SETSTR^VALM1($S(ON["P":P("PRY"),1:""),PSJL,71,1)
"RTN","PSIVPRO",117,0)
 N PSJLRN S PSJLRN=$$LASTREN^PSJLMPRI(DFN,ON55) I PSJLRN S PSJLRN=$E($$ENDTC^PSGMI(PSJLRN),1,5) S PSJL=$$SETSTR^VALM1(PSJLRN,PSJL,74,5)
"RTN","PSIVPRO",118,0)
 Q
"RTN","PSIVPRO",119,0)
XCHK ;
"RTN","PSIVPRO",120,0)
 I $E(X)="?" W !!?2,"Select order",$E("s",PS'=1)," (1" W:PS>1 "-",PS W ")."
"RTN","PSIVPRO",121,0)
 I $E(X)="?" W:$S($O(^TMP("PSIV",$J,PSIVST,ON)):1,1:$O(^TMP("PSIV",$J,PSIVST))]"") "  Press RETURN to view more orders, or enter '^' to abort",!,"the profile, or 'A' to view Allergies." D:$E(X,1,2)="??" H2^PSGON K X Q
"RTN","PSIVPRO",122,0)
 S PSGLMT=PS D ^PSGON Q
"RTN","PSIVPRO",123,0)
 ;
"RTN","PSIVPRO",124,0)
PSPD S Y=$S(PSIVST'="P":$P($G(^PS(55,DFN,"IV",+ON,9)),U),1:"")
"RTN","PSIVPRO",125,0)
 X ^DD("DD") S:Y="" PSJL=$$SETSTR^VALM1("**   N/P  **",PSJL,36,12)
"RTN","PSIVPRO",126,0)
 S:Y'="" PSJL=$$SETSTR^VALM1($P(Y,","),PSJL,36,7),PSJL=$$SETSTR^VALM1($P($P(Y,"@",2),":",1,2),PSJL,43,45)
"RTN","PSIVPRO",127,0)
 S PSJL=PSJL_" #"_$S(Y="":0,1:$P(^PS(55,DFN,"IV",+ON,9),U,2))
"RTN","PSIVPRO",128,0)
 D REST
"RTN","PSIVPRO",129,0)
 Q
"RTN","PSIVUTL")
0^20^B28169331
"RTN","PSIVUTL",1,0)
PSIVUTL ;BIR/MLM-IV UTILITIES ;07 SEP 97 / 2:17 PM 
"RTN","PSIVUTL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**69,58,81,85,110,133,181**;16 DEC 97;Build 190
"RTN","PSIVUTL",3,0)
 ;
"RTN","PSIVUTL",4,0)
 ; Reference to ^DD("DD" is supported by DBIA 10017.
"RTN","PSIVUTL",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSIVUTL",6,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSIVUTL",7,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVUTL",8,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVUTL",9,0)
 ; Reference to ^DIC is supported by DBIA 10006.
"RTN","PSIVUTL",10,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177.
"RTN","PSIVUTL",11,0)
 ;
"RTN","PSIVUTL",12,0)
DRGSC(Y,PSJSCT) ; Called to set DIC("S") when selecting  Orderable Items.
"RTN","PSIVUTL",13,0)
 N OK,ND,NDU,NDI S OK=0
"RTN","PSIVUTL",14,0)
 S ND=$G(^PS(50.7,+Y,0))
"RTN","PSIVUTL",15,0)
 ;I $P(ND,U,3) S OK=$S('$P(ND,U,4):1,$P(ND,U,4)>DT:1,1:0)
"RTN","PSIVUTL",16,0)
 S OK=$S('$P(ND,U,4):1,$P(ND,U,4)>DT:1,1:0)
"RTN","PSIVUTL",17,0)
 Q OK
"RTN","PSIVUTL",18,0)
 ;
"RTN","PSIVUTL",19,0)
IVDRGSC(Y) ; Set DIC("S") for IV additive/solution selection.
"RTN","PSIVUTL",20,0)
 ; Naked reference below refers to full reference in Y, which is either ^PS(52.6, or ^PS(52.7
"RTN","PSIVUTL",21,0)
 N Y S Y="S X(1)=$G(^(0)),X(2)=$G(^(""I"")) I $S('X(2):1,X(2)>DT:1,1:0),$D(^PSDRUG(+$P(X(1),U,2),0)) S X(2)=$G(^(""I"")) I $S('+$P(X(1),U,11):0,'X(2):1,X(2)>DT:1,1:0)"
"RTN","PSIVUTL",22,0)
 Q Y
"RTN","PSIVUTL",23,0)
 ;
"RTN","PSIVUTL",24,0)
ENU(Y) ;Get IV additive strength.
"RTN","PSIVUTL",25,0)
 N X S X=$P(^PS(52.6,+Y,0),U,3),Y=$$CODES^PSIVUTL(X,52.6,2)
"RTN","PSIVUTL",26,0)
 Q Y
"RTN","PSIVUTL",27,0)
 ;
"RTN","PSIVUTL",28,0)
CODES(PSJCD,PSJF,PSJFLD) ; Get name from code. 
"RTN","PSIVUTL",29,0)
 ; PSJF = one of following files: ^PS(55, ^PS(53.1, ^PS(52.6
"RTN","PSIVUTL",30,0)
 D FIELD^DID(PSJF,PSJFLD,"","POINTER","PSJDD")
"RTN","PSIVUTL",31,0)
 S Y=$G(PSJDD("POINTER")) K PSJDD
"RTN","PSIVUTL",32,0)
 S Y=$P($P(";"_Y,";"_PSJCD_":",2),";")
"RTN","PSIVUTL",33,0)
 Q Y
"RTN","PSIVUTL",34,0)
 ;
"RTN","PSIVUTL",35,0)
CODES1(PSJCD,PSJF,PSJFLD)       ;Check to see if code is valid.
"RTN","PSIVUTL",36,0)
 ; PSJF = one of following files: ^PS(55, ^PS(53.1, ^PS(52.6
"RTN","PSIVUTL",37,0)
 D FIELD^DID(PSJF,PSJFLD,"","POINTER","PSJDD")
"RTN","PSIVUTL",38,0)
 I PSJDD("POINTER")'[PSJCD_":"  K PSJDD Q 0
"RTN","PSIVUTL",39,0)
 K PSJDD Q 1
"RTN","PSIVUTL",40,0)
 ;
"RTN","PSIVUTL",41,0)
CODES2(PSJF,PSJFLD)     ;Get field name
"RTN","PSIVUTL",42,0)
 ; PSJF = one of following files: ^PS(55, ^PS(53.1, ^PS(52.6
"RTN","PSIVUTL",43,0)
 D FIELD^DID(PSJF,PSJFLD,"","LABEL","PSJDD")
"RTN","PSIVUTL",44,0)
 Q PSJDD("LABEL")
"RTN","PSIVUTL",45,0)
 ;
"RTN","PSIVUTL",46,0)
GTPCI(Y) ; Set up "work" area for provider comments.
"RTN","PSIVUTL",47,0)
 N DIC,DINUM,DLAYGO,X S DIC="^PS(53.45,",DIC(0)="LNZ",DLAYGO=53.45,(DINUM,X)=+DUZ D ^DIC
"RTN","PSIVUTL",48,0)
 Q Y
"RTN","PSIVUTL",49,0)
 ;
"RTN","PSIVUTL",50,0)
WDTE(Y) ; Format and print date.
"RTN","PSIVUTL",51,0)
 I 'Y S Y="******"
"RTN","PSIVUTL",52,0)
 E  X ^DD("DD") S Y=$P(Y,"@")_" "_$P($P(Y,"@",2),":",1,2)
"RTN","PSIVUTL",53,0)
 Q Y
"RTN","PSIVUTL",54,0)
GTOT(Y) ; Get order type & protocol
"RTN","PSIVUTL",55,0)
 S P("OT")=$S(Y="A":"F",Y="H":"H",1:"I")
"RTN","PSIVUTL",56,0)
 I P("OT")="F" F DRGT="AD","SOL" F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI  I '$P(DRG(DRGT,DRGI),U,5) S P("OT")="I" Q
"RTN","PSIVUTL",57,0)
 Q
"RTN","PSIVUTL",58,0)
 ;
"RTN","PSIVUTL",59,0)
PIV(ON) ; Display IV orders.
"RTN","PSIVUTL",60,0)
 N DRG,ON55,P,PSJORIFN,TYP,X,Y S TYP="?" I ON["V" D
"RTN","PSIVUTL",61,0)
 .S Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,4,5,8,9,17,23,25 S P(X)=$P(Y,U,X)
"RTN","PSIVUTL",62,0)
 .S TYP=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I TYP'="O" S TYP="C"
"RTN","PSIVUTL",63,0)
 .S ON55=ON,P("OT")=$S(P(4)="A":"F",P(4)="H":"H",1:"I") D GTDRG^PSIVORFB,GTOT^PSIVUTL(P(4))
"RTN","PSIVUTL",64,0)
 .W $S($P($G(^PS(55,DFN,"IV",+ON,.2)),U,4)="D":" d",1:"  ")
"RTN","PSIVUTL",65,0)
 .S X=$G(^PS(55,DFN,"IV",+ON,4)) I +PSJSYSU,'+$P(X,U,$S(+PSJSYSU=3:4,1:++PSJSYSU)) W "->"
"RTN","PSIVUTL",66,0)
 I ON=+ON N O S O="" F  S O=$O(^PS(53.1,"ACX",ON,O)) Q:O=""  D
"RTN","PSIVUTL",67,0)
 . S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+O,0)),U,9),Y=$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U) D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4)) D PIV(O_"P") W !
"RTN","PSIVUTL",68,0)
 I ON["P" S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+ON,0)),U,9),Y=$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U) D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4)) I $E(P("OT"))="I" D  Q
"RTN","PSIVUTL",69,0)
 . NEW MARX,PSIVX D DRGDISP^PSJLMUT1(PSGP,+ON_"P",40,54,.MARX,0)
"RTN","PSIVUTL",70,0)
 . F PSIVX=0:0 S PSIVX=$O(MARX(PSIVX)) Q:'PSIVX  W @($S(PSIVX=1:"?9",1:"!?11")),MARX(PSIVX) D:PSIVX=1 PIV1
"RTN","PSIVUTL",71,0)
 NEW DRGX S DRGX=0 F  S DRGX=$O(DRG("AD",DRGX)) Q:'DRGX  D PIVAD
"RTN","PSIVUTL",72,0)
SOL ;
"RTN","PSIVUTL",73,0)
 NEW NAME
"RTN","PSIVUTL",74,0)
 S DRGX=0 F  S DRGX=$O(DRG("SOL",DRGX)) Q:'DRGX  D
"RTN","PSIVUTL",75,0)
 . D NAME(DRG("SOL",DRGX),39,.NAME,0)
"RTN","PSIVUTL",76,0)
 . W:($D(DRG("AD",1))!(DRGX>1)) ! W:DRGX=1 ?9,"in "
"RTN","PSIVUTL",77,0)
 . F X=0:0 S X=$O(NAME(X)) Q:'X  W ?12 W NAME(X) I X=1,DRGX=1,'$D(DRG("AD",1)) D PIV1
"RTN","PSIVUTL",78,0)
 Q
"RTN","PSIVUTL",79,0)
PIVAD ; Print IV Additives.
"RTN","PSIVUTL",80,0)
 NEW NAME,PSGX
"RTN","PSIVUTL",81,0)
 D NAME(DRG("AD",DRGX),39,.NAME,1)
"RTN","PSIVUTL",82,0)
 F PSGX=0:0 S PSGX=$O(NAME(PSGX)) Q:'PSGX  W:(DRGX'=1!(PSGX'=1)) ! W ?9,NAME(PSGX) I PSGX=1,DRGX=1 D PIV1
"RTN","PSIVUTL",83,0)
 Q
"RTN","PSIVUTL",84,0)
 ;
"RTN","PSIVUTL",85,0)
PIV1 ; Print Sched type, start/stop dates, and status.
"RTN","PSIVUTL",86,0)
 F X=2,3 S P(X)=$E($$ENDTC^PSGMI(P(X)),1,$S($D(PSJEXTP):8,1:5))
"RTN","PSIVUTL",87,0)
 I '$D(PSJEXTP) W ?50,TYP,?53,P(2),?60,P(3),?67,$S($G(P(25))]"":P(25),1:P(17)) Q
"RTN","PSIVUTL",88,0)
 W ?50,TYP,?53,P(2),?63,P(3),?73,$S($G(P(25))]"":P(25),1:P(17))
"RTN","PSIVUTL",89,0)
 Q
"RTN","PSIVUTL",90,0)
59 ; Validate the Infusion rate entered using IV Quick order code.
"RTN","PSIVUTL",91,0)
 N I F I=2,3,5,7,8,9,11,15,23 S P(I)=""
"RTN","PSIVUTL",92,0)
 S P(4)="A",P(8)=$P($G(^PS(57.1,PSJQO,1)),U,5)
"RTN","PSIVUTL",93,0)
 I $G(^PS(57.1,PSJQO,4,1,0)) S DRG("SOL",1)=^(0),DRG("SOL",0)=1
"RTN","PSIVUTL",94,0)
 I X["?" S F1=53.1,F2=59 D ENHLP^PSIVORC1 G 59
"RTN","PSIVUTL",95,0)
 I X]"" D ENI^PSIVSP S:$D(X) P(8)=X
"RTN","PSIVUTL",96,0)
 Q
"RTN","PSIVUTL",97,0)
WRTDRG(X,L)       ; Format and print drug name, strength and bottle no.
"RTN","PSIVUTL",98,0)
 N Y S Y=" "_$P(X,U,3) S:$P(X,U,4) Y=Y_" ("_$P(X,U,4)_")"
"RTN","PSIVUTL",99,0)
 Q $E($P(X,U,2),1,(L-$L(Y)))_Y
"RTN","PSIVUTL",100,0)
 ;
"RTN","PSIVUTL",101,0)
NAME(X,L,MARX,AD)        ; Format Additive display.
"RTN","PSIVUTL",102,0)
 ;INPUT : X=DRG("AD",DRG)  L=Display length   AD=for Additive(1/0)
"RTN","PSIVUTL",103,0)
 ;OUTPUT: AD(X)  if X=2 that means there is a second line to display
"RTN","PSIVUTL",104,0)
 N Y K MARX S Y=$P(X,U,3) S:(AD&$P(X,U,4)) Y=Y_" ("_$P(X,U,4)_")"
"RTN","PSIVUTL",105,0)
 ;* S:'AD Y=Y_" "_$S(P(4)="P"!($G(P(23))="P")!$G(P(5)):P(9),1:$P(P(8),"@"))
"RTN","PSIVUTL",106,0)
 I 'AD!('$O(DRG("SOL",0))) D
"RTN","PSIVUTL",107,0)
 .I $G(PSJL)["  in" S Y=Y_" "_$S(P(4)="P"!($G(P(23))="P")!$G(P(5)):P(9),1:$P(P(8),"@")) Q
"RTN","PSIVUTL",108,0)
 .I $G(DRGX)]"",DRGX'>1 S Y=Y_"  "_$S(P(4)="P"!($G(P(23))="P")!$G(P(5)):P(9),1:$P(P(8),"@")) Q
"RTN","PSIVUTL",109,0)
 ;I ($L($P(X,U,2))+$L(Y)+1)>L S NAME(1)=$P(X,U,2),NAME(2)="   "_Y Q
"RTN","PSIVUTL",110,0)
 I ($L($P(X,U,2))+$L(Y)+1)>L D TXT^PSGMUTL($P(X,U,2)_" "_Y,L) S:AD MARX(2)="   "_MARX(2) Q
"RTN","PSIVUTL",111,0)
 S MARX(1)=$P(X,U,2)_" "_Y
"RTN","PSIVUTL",112,0)
 Q
"RTN","PSIVUTL",113,0)
 ;
"RTN","PSIVUTL",114,0)
INTERVAL(IVAR) ;
"RTN","PSIVUTL",115,0)
 N P,X,PSGOES M P=IVAR S X=$G(P(9)),PSGOES=1
"RTN","PSIVUTL",116,0)
 D EN^PSIVSP S IVAR(15)=$S($G(P(15)):P(15),1:1440)
"RTN","PSIVUTL",117,0)
 Q IVAR(15)
"RTN","PSIVUTL",118,0)
 ;
"RTN","PSIVUTL",119,0)
DOW(SCHED) ;
"RTN","PSIVUTL",120,0)
 Q:SCHED="" 0
"RTN","PSIVUTL",121,0)
 N P9,PSIVX,X S PSIVX=0 S P9=SCHED
"RTN","PSIVUTL",122,0)
 ; Use schedule validator
"RTN","PSIVUTL",123,0)
 S X=SCHED D DW^PSGS0 I $G(X)="" Q 0
"RTN","PSIVUTL",124,0)
 I +$O(^PS(51.1,"APPSJ",SCHED,0)) S PSIVX=1 S P9=$P(SCHED,"@") F X=1:1:$L(P9,"-") D  Q:'$G(PSIVX)
"RTN","PSIVUTL",125,0)
 . I '("MON,TUE,WED,THU,FRI,SAT,SUN"[$P(P9,"-",X)) S PSIVX=0 Q
"RTN","PSIVUTL",126,0)
 Q:PSIVX +PSIVX
"RTN","PSIVUTL",127,0)
 I '$D(^PS(51.1,"APPSJ",SCHED)) S PSIVX=1,P9=$P(SCHED,"@") F X=1:1:$L(P9,"-") D  Q:'$G(PSIVX)
"RTN","PSIVUTL",128,0)
 . I '(",MO,TU,WE,TH,FR,SA,SU,"[(","_$P(P9,"-",X)_",")) S PSIVX=0 Q
"RTN","PSIVUTL",129,0)
 Q +PSIVX
"RTN","PSJAC")
0^7^B14319225
"RTN","PSJAC",1,0)
PSJAC ;BIR/CML3-INPATIENT INFORMATION ;28 Apr 98 / 9:02 AM
"RTN","PSJAC",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**8,10,50,127,181**;16 DEC 97;Build 190
"RTN","PSJAC",3,0)
 ;
"RTN","PSJAC",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJAC",5,0)
 ;
"RTN","PSJAC",6,0)
 S DFN=PSGP,PSJACPF=1 G CHK
"RTN","PSJAC",7,0)
 ;
"RTN","PSJAC",8,0)
ENBOTH ;
"RTN","PSJAC",9,0)
 S PSJACPF=11 G CHK
"RTN","PSJAC",10,0)
 ;
"RTN","PSJAC",11,0)
ENIV ;
"RTN","PSJAC",12,0)
 N I,J,JJ,ON,PSJRBXX,X,X1,X2,X,Y S PSJACPF=10,PSGP=DFN
"RTN","PSJAC",13,0)
 ;
"RTN","PSJAC",14,0)
CHK ;
"RTN","PSJAC",15,0)
 ;Check if 5.0 order conversion should be run for the selected patient.
"RTN","PSJAC",16,0)
 ;I '$P($G(^PS(55,DFN,5.1)),U,11) D CONVERT^PSJUTL1(DFN,$S($E(IOST,1)="C":1,1:0))
"RTN","PSJAC",17,0)
 ;/Commented out in PSJ*5*50.  No longer needed
"RTN","PSJAC",18,0)
 ;/F  S PSJRBXX=$$OTF^OR3CONV(DFN,$S($E(IOST,1)="C":0,1:1)) Q:+PSJRBXX'<0  D
"RTN","PSJAC",19,0)
 ;/.I +PSJRBXX=-1 W:$E(IOST,1)="C" !,$P(PSJRBXX,"^",2) H 4
"RTN","PSJAC",20,0)
 ;Converting IV order to new OI with POE if not done so when installed PSJ*5*50
"RTN","PSJAC",21,0)
 D CNIV^PSJUTL1(DFN)
"RTN","PSJAC",22,0)
 ;I $D(^PS(55,DFN,0)),'$P($G(^PS(55,DFN,0)),U,6) D EN^PSOHLUP(DFN)
"RTN","PSJAC",23,0)
 S VA200=1 D INP^VADPT
"RTN","PSJAC",24,0)
 I VAIN(4) S:PSJACPF#2 PSJPCAF=1_"^"_VAIN(1),PSJPWD=+VAIN(4),PSJPWDN=$P(VAIN(4),"^",2),PSJPTS=+VAIN(3),PSJPTSP=+VAIN(2),PSJPRB=VAIN(5),PSJPAD=+VAIN(7),PSJPDX=VAIN(9),PSJPTD=$S($D(^PS(55,PSGP,5.1)):$P(^(5.1),"^",4),1:""),PSJPDD="" G CNV
"RTN","PSJAC",25,0)
 S VAIP("D")="L" D IN5^VADPT G:PSJACPF[0 CNV
"RTN","PSJAC",26,0)
 S PSJPCAF="",PSJPAD=+VAIP(13,1)
"RTN","PSJAC",27,0)
 S PSGID=+VAIP(3),X=+VAIP(4)=12!(+VAIP(4)=38),PSJPWD=+VAIP(5),PSJPWDN=$P(VAIP(5),"^",2),PSJPRB=$P(VAIP(6),"^",2),PSJPTSP=+VAIP(7),PSJPTS=+VAIP(8),PSJPDX=VAIP(9),PSJPTD="",PSJPDD=PSGID_"^"_$$ENDTC^PSGMI(PSGID) S:X PSJPDD=PSJPDD_"^1"
"RTN","PSJAC",28,0)
 ;
"RTN","PSJAC",29,0)
CNV ;
"RTN","PSJAC",30,0)
 D DEM^VADPT,HTWT(PSGP)
"RTN","PSJAC",31,0)
 I PSJACPF#2 S PSGP(0)=VADM(1),PSJPSSN=VADM(2),PSJPDOB=+VADM(3),PSJPAGE=VADM(4),PSJPSEX=$S(VADM(5)]"":VADM(5),1:"?^____"),PSJPPID=VA("PID"),PSJPBID=VA("BID")
"RTN","PSJAC",32,0)
 I PSJACPF#2 D
"RTN","PSJAC",33,0)
 .I $D(PSJY2K) D  Q
"RTN","PSJAC",34,0)
 ..F X="PSJPAD","PSJPDOB","PSJPTD" I @X S $P(@X,"^",2)=$$ENDTC2^PSGMI(+@X)
"RTN","PSJAC",35,0)
 .F X="PSJPAD","PSJPDOB","PSJPTD" I @X S $P(@X,"^",2)=$$ENDTC^PSGMI(+@X)
"RTN","PSJAC",36,0)
 ;
"RTN","PSJAC",37,0)
WP ; ward parameters
"RTN","PSJAC",38,0)
 G:$D(PSJACNWP) DONE S PSJSYSW0="",PSJSYSW=0 I $G(PSJPWD) S PSJSYSW=+$O(^PS(59.6,"B",PSJPWD,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJAC",39,0)
 ;S PSJSYSL="",X=$P(PSJSYSU,";",3)>1 S PSJSYSL=$P(PSJSYSW0,"^",X*4+12) G:$D(PSJACND) DONE
"RTN","PSJAC",40,0)
 S PSJSYSL="",X=$P(PSJSYSU,";",3)>1 S PSJSYSL=$S(X=0:$P(PSJSYSW0,"^",12),1:$P(PSJSYSW0,"^",16)) G:$D(PSJACND) DONE
"RTN","PSJAC",41,0)
 ;S PSJDCEXP=$$RECDCEXP^PSJP()
"RTN","PSJAC",42,0)
 I PSJSYSL D
"RTN","PSJAC",43,0)
 .S:X X='$P($G(PSJSYSP0),"^",10) S IOP=$S($P($G(PSJSYSP0),"^",13)]"":$P($G(PSJSYSP0),"^",13),$P(PSJSYSW0,"^",19+X)]"":$P(PSJSYSW0,"^",19+X),1:"") I IOP]"" D
"RTN","PSJAC",44,0)
 ..S IOP="`"_IOP K %ZIS S %ZIS="NQ" D ^%ZIS S:'POP $P(PSJSYSL,"^",2,3)=ION_"^"_IO D HOME^%ZIS
"RTN","PSJAC",45,0)
 ;
"RTN","PSJAC",46,0)
DONE ;
"RTN","PSJAC",47,0)
 I PSJACPF<10 K VADM,VAIN,VAIP
"RTN","PSJAC",48,0)
 K PSJACPF,PSGID,PSGOD,VA200,X
"RTN","PSJAC",49,0)
 Q
"RTN","PSJAC",50,0)
HTWT(DFN) ; Get patient's height and weight from Vitals.
"RTN","PSJAC",51,0)
 S (PSJPWTD,PSJPHTD)=""
"RTN","PSJAC",52,0)
 S X="GMRVUTL" X ^%ZOSF("TEST") I  S GMRVSTR="HT" D
"RTN","PSJAC",53,0)
 . D EN6^GMRVUTL S PSJPHT=$P(X,U,8) S:PSJPHT PSJPHT=$J(2.54*PSJPHT,0,2),PSJPHTD="("_$S($D(PSJY2K):$E($$ENDTC2^PSGMI($P(X,U)),1,10),1:$E($$ENDTC^PSGMI($P(X,U)),1,8))_")"
"RTN","PSJAC",54,0)
 . S GMRVSTR="WT" D EN6^GMRVUTL S PSJPWT=$P(X,U,8) S:PSJPWT PSJPWT=$J(PSJPWT/2.2,0,2),PSJPWTD="("_$S($D(PSJY2K):$E($$ENDTC2^PSGMI($P(X,U)),1,10),1:$E($$ENDTC^PSGMI($P(X,U)),1,8))_")"
"RTN","PSJAC",55,0)
 F X="PSJPWT","PSJPHT" S:'$G(@X) @X="______"
"RTN","PSJAC",56,0)
 F X="PSJPWTD","PSJPHTD" S:$G(@X)="" @X="(________)"
"RTN","PSJAC",57,0)
 Q
"RTN","PSJAC",58,0)
PSJAC2(PSJY2K)     ;
"RTN","PSJAC",59,0)
 D PSJAC Q
"RTN","PSJADT0")
0^13^B33159772
"RTN","PSJADT0",1,0)
PSJADT0 ;BIR/CML3,PR,MLM-AUTO DC/HOLD CANCEL ;11 Aug 98 / 8:25 AM
"RTN","PSJADT0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**17,111,112,135,181**;16 DEC 97;Build 190
"RTN","PSJADT0",3,0)
 ;
"RTN","PSJADT0",4,0)
 ;Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSJADT0",5,0)
 ;
"RTN","PSJADT0",6,0)
ENDC ; dc active orders first, then non-verified orders
"RTN","PSJADT0",7,0)
 W:'$D(PSJQUIET)&'$D(DGQUIET) !,"...discontinuing Inpatient Medication orders..."
"RTN","PSJADT0",8,0)
 S $P(PSJPIND,"^")=""
"RTN","PSJADT0",9,0)
 D NOW^%DTC N PSJDCDT S (PSJDCDT,PSGDT)=+%,PSJSYSW0="" I PSJFW S PSJSYSW=$O(^PS(59.6,"B",PSJFW,0)) S:PSJSYSW PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJADT0",10,0)
 I PSGALO=1010!(PSGALO=1030)!(PSGALO=1050) D AUDDD
"RTN","PSJADT0",11,0)
 D ENUNM^PSGOU S PSGALR=10,DIE="^PS(55,"_PSGP_",5," S:PSJFW PSGTOL=1,PSGUOW=PSJFW,PSGTOO=1
"RTN","PSJADT0",12,0)
 F PSJS=PSGDT:0 S PSJS=$O(^PS(55,PSGP,5,"AUS",PSJS)) Q:'PSJS  F PSJDA=0:0 S PSJDA=$O(^PS(55,PSGP,5,"AUS",PSJS,PSJDA)) Q:'PSJDA  D
"RTN","PSJADT0",13,0)
 .Q:'$$DCIMO(PSGP,PSJDA,"U") 
"RTN","PSJADT0",14,0)
 .;first naked reference below refers to the full global reference to the right of the = sign (inside the $S)
"RTN","PSJADT0",15,0)
 .K DA S DA(1)=PSGP,DA=PSJDA,PSGAL("C")=0,$P(^(2),"^",3)=$S($D(^PS(55,PSGP,5,DA,2)):$P(^(2),"^",4),1:"")
"RTN","PSJADT0",16,0)
 .D ^PSGAL5
"RTN","PSJADT0",17,0)
 .K TMP
"RTN","PSJADT0",18,0)
 .S TMP(55.06,""_PSJDA_","_PSGP_","_"",28)="D"
"RTN","PSJADT0",19,0)
 .S TMP(55.06,""_PSJDA_","_PSGP_","_"",136)=$S(PSGALO=1010:"DD",1:"DA")
"RTN","PSJADT0",20,0)
 .D FILE^DIE("","TMP")
"RTN","PSJADT0",21,0)
 .K TMP
"RTN","PSJADT0",22,0)
 .S TMP(55.06,""_PSJDA_","_PSGP_","_"",34)=PSJDCDT
"RTN","PSJADT0",23,0)
 .S TMP(55.06,""_PSJDA_","_PSGP_","_"",49)=1
"RTN","PSJADT0",24,0)
 .D FILE^DIE("","TMP")
"RTN","PSJADT0",25,0)
 .K TMP
"RTN","PSJADT0",26,0)
 .D EN1^PSJHL2(PSGP,"OD",PSJDA_"U","AUTO DC")
"RTN","PSJADT0",27,0)
 .I PSGALO'=1050 S DA=PSJDA,^PS(55,"AUE",PSGP,DA)="" I $P(PSJSYSW0,"^",15),(PSGALO'<1060) S $P(^PS(55,PSGP,5,PSJDA,7),"^",1,2)=PSJDCDT_"^D" D ENL^PSGVDS
"RTN","PSJADT0",28,0)
 S PSGTOO=2 F PSJDA=0:0 S PSJDA=$O(^PS(53.1,"AC",PSGP,PSJDA)) Q:'PSJDA  D
"RTN","PSJADT0",29,0)
 .Q:'$$DCIMO(PSGP,PSJDA,"P")
"RTN","PSJADT0",30,0)
 .I PSGALO'<1060,$P(PSJSYSW0,U,15),$P($G(^PS(53.1,PSJDA,0)),U,9)="N" K DA D ENLBL^PSIVOPT(PSGTOL,PSGUOW,DFN,2,+PSJDA,"AD")
"RTN","PSJADT0",31,0)
 .K DA S DA=PSJDA D  I $P($G(^PS(53.1,DA,0)),"^",21) D EN1^PSJHL2(PSGP,"OC",PSJDA_"P","AUTO DC")
"RTN","PSJADT0",32,0)
 ..K TMP
"RTN","PSJADT0",33,0)
 ..S TMP(53.1,""_PSJDA_","_"",28)="D"
"RTN","PSJADT0",34,0)
 ..S TMP(53.1,""_PSJDA_","_"",42)=1
"RTN","PSJADT0",35,0)
 ..D FILE^DIE("","TMP")
"RTN","PSJADT0",36,0)
 ..K TMP
"RTN","PSJADT0",37,0)
 ;
"RTN","PSJADT0",38,0)
ENIV ;
"RTN","PSJADT0",39,0)
 S DFN=PSGP F PSJIVON=0:0 S PSJIVON=$O(^PS(55,DFN,"IV",PSJIVON)) Q:'PSJIVON  S Y=$G(^(PSJIVON,0)) I "PDEN"'[$P(Y,U,17) S P(17)=$P(Y,U,17),P(3)=$P(Y,U,3) D DC
"RTN","PSJADT0",40,0)
 Q
"RTN","PSJADT0",41,0)
DC ;
"RTN","PSJADT0",42,0)
 Q:'$$DCIMO(DFN,PSJIVON,"V")
"RTN","PSJADT0",43,0)
 S (ON,ON55)=PSJIVON_"V" D NOW^%DTC I P(17)="H",P(3)<% D  D EXPIR^PSIVOE Q
"RTN","PSJADT0",44,0)
 .K TMP
"RTN","PSJADT0",45,0)
 .S TMP(55.01,""_+ON_","_DFN_","_"",100)="E"
"RTN","PSJADT0",46,0)
 .D FILE^DIE("","TMP")
"RTN","PSJADT0",47,0)
 .K TMP
"RTN","PSJADT0",48,0)
 K PSIVALT S PSIVAC="AD",PSIVALCK="STOP",PSIVREA="D",PSIVAL=$S('+$G(PSGALO):$G(PSIVRES),1:$P($G(^PS(53.3,+PSGALO,0)),U)) D D1^PSIVOPT2,LOG^PSIVORAL
"RTN","PSJADT0",49,0)
 K TMP
"RTN","PSJADT0",50,0)
 S TMP(55.01,""_+ON_","_DFN_","_"",157)=$S(PSGALO=1010:"DD",1:"DA")
"RTN","PSJADT0",51,0)
 S TMP(55.01,""_+ON_","_DFN_","_"",.03)=PSJDCDT
"RTN","PSJADT0",52,0)
 S TMP(55.01,""_+ON_","_DFN_","_"",121)=1
"RTN","PSJADT0",53,0)
 D FILE^DIE("","TMP")
"RTN","PSJADT0",54,0)
 K TMP
"RTN","PSJADT0",55,0)
 D EN1^PSJHL2(DFN,"OD",+ON_"V","AUTO DC")
"RTN","PSJADT0",56,0)
 S PSJIVDCF=1
"RTN","PSJADT0",57,0)
 Q
"RTN","PSJADT0",58,0)
 ;
"RTN","PSJADT0",59,0)
SIVDIE ; Setup DIE,DA for IV
"RTN","PSJADT0",60,0)
 K DA,DIE,DR S DA=+ON,DA(1)=DFN,DIE="^PS(55,"_DFN_",""IV"","
"RTN","PSJADT0",61,0)
 Q
"RTN","PSJADT0",62,0)
 ;
"RTN","PSJADT0",63,0)
AUDDD ; set up orders for discharge report and purging
"RTN","PSJADT0",64,0)
 S DIS=+VAIP(17,1) I $S('DIS:1,1:$D(^PS(55,"AUDDD",DIS,PSGP))) Q
"RTN","PSJADT0",65,0)
 S X=$$EN^PSGCT(+VAIP(13,1),-1)
"RTN","PSJADT0",66,0)
 F Q=X:0 S Q=$O(^PS(55,PSGP,5,"AUS",Q)) Q:'Q  F QQ=0:0 S QQ=$O(^PS(55,PSGP,5,"AUS",Q,QQ)) Q:'QQ  I $S($D(^PS(55,PSGP,5,QQ,0)):'$P(^(0),"^",20),1:1) S $P(^(0),"^",20)=DIS,^PS(55,"AUDDD",DIS,PSGP,QQ)=""
"RTN","PSJADT0",67,0)
 Q
"RTN","PSJADT0",68,0)
 ;
"RTN","PSJADT0",69,0)
ENHE ; status from hold to expired
"RTN","PSJADT0",70,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12),DIE="^PS(55,"_PSGP_",5,"
"RTN","PSJADT0",71,0)
 F PSJS=+PSJPAD:0 S PSJS=$O(^PS(55,PSGP,5,"AUS",PSJS)) Q:'PSJS  Q:PSJS>PSGDT  F PSJDA=0:0 S PSJDA=$O(^PS(55,PSGP,5,"AUS",PSJS,PSJDA)) Q:'PSJDA  K DA S DA(1)=PSGP,DA=PSJDA I $D(^PS(55,PSGP,5,DA,0)),$P(^(0),"^",9)="H" S DR="28////E" D ^DIE
"RTN","PSJADT0",72,0)
 Q
"RTN","PSJADT0",73,0)
 ;
"RTN","PSJADT0",74,0)
ENUNDC(PSJDCDT,PSGP,PSJUOW,PSGALO) ; Auto-reinstate orders DC'ed due to a patient movement.
"RTN","PSJADT0",75,0)
 N PSJSYSW0 D NOW^%DTC S PSJUNDC=1,PSGDT=%,PSJFIRST='$D(PSJQUIET),PSJSYSW0=$G(^PS(59.6,+$O(^PS(59.6,"B",+PSJUOW,0)),0))
"RTN","PSJADT0",76,0)
 S PSJS=$O(^PS(55,PSGP,5,"AUS",PSJDCDT-.0002)) F PSGORD=0:0 S PSGORD=$O(^PS(55,PSGP,5,"AUS",+PSJS,PSGORD)) Q:'PSGORD  D
"RTN","PSJADT0",77,0)
 .I $P($G(^PS(55,PSGP,5,PSGORD,0)),U,9)["D",$P($G(^(4)),U,11) D DISREIN,ENRI^PSGOERI
"RTN","PSJADT0",78,0)
 .S ^PS(55,"AUE",PSGP,PSGORD)=""
"RTN","PSJADT0",79,0)
 ;
"RTN","PSJADT0",80,0)
 S:PSJS="" PSJS=$O(^PS(55,PSGP,"IV","AIS",PSJDCDT-.0002))
"RTN","PSJADT0",81,0)
 F PSGORD=0:0 S PSGORD=$O(^PS(55,PSGP,"IV","AIS",+PSJS,PSGORD)) Q:'PSGORD  D
"RTN","PSJADT0",82,0)
 .I $P($G(^PS(55,PSGP,"IV",PSGORD,0)),U,12),$P($G(^(2)),U,7)>PSGDT S P(3)=$P($G(^(0)),U,3) D DISREIN,ENARI^PSIVOPT(PSGP,PSGORD,+PSJUOW,PSGALO)
"RTN","PSJADT0",83,0)
 I $D(^TMP("PSJUNDC")) S ^TMP("PSJUNDC",$J,DFN)=$P(^DPT(DFN,0),"^")_"^"_$G(^DPT(PSGP,.1))_"^"_PSGALO D ^PSJADT2
"RTN","PSJADT0",84,0)
 ;
"RTN","PSJADT0",85,0)
ENKL ;
"RTN","PSJADT0",86,0)
 F UW=0:0 S UW=$O(^PS(53.41,1,1,UW)) Q:'UW  D  I '$O(^PS(53.41,1,1,0)) K DA S DA=1,DIK="^PS(53.41," D ^DIK
"RTN","PSJADT0",87,0)
 .F PSGP=0:0 S PSGP=$O(^PS(53.41,1,1,UW,1,PSGP)) Q:'PSGP  D  I '$O(^PS(53.41,1,1,UW,1,0)) K DA S DIK="^PS(53.41,1,1,",DA(1)=1,DA=UW D ^DIK
"RTN","PSJADT0",88,0)
 ..F TO=0:0 S TO=$O(^PS(53.41,1,1,UW,1,PSGP,1,TO)) Q:'TO  D  I '$O(^PS(53.41,1,1,UW,1,PSGP,1,0)) K DA S DA(2)=1,DA(1)=UW,DA=PSGP,DIK="^PS(53.41,1,1,"_UW_",1," D ^DIK
"RTN","PSJADT0",89,0)
 ...I '$O(^PS(53.41,1,1,UW,1,PSGP,1,TO,1,0))  K DA S DA(3)=1,DA(2)=UW,DA(1)=PSGP,DA=TO,DIK="^PS(53.41,1,1,"_UW_",1,"_PSGP_",1," D ^DIK
"RTN","PSJADT0",90,0)
 K DA,DIK,P,PSGDT,PSGP,PSGORD,PSJS,PSJUNDC,TO,UW
"RTN","PSJADT0",91,0)
 Q
"RTN","PSJADT0",92,0)
 ;
"RTN","PSJADT0",93,0)
DISREIN ; Display reinstate msg. for first order.
"RTN","PSJADT0",94,0)
 W:PSJFIRST&'$D(DGQUIET) !,"...reinstating Inpatient Medication orders..." S PSJFIRST=0
"RTN","PSJADT0",95,0)
 Q
"RTN","PSJADT0",96,0)
 ;
"RTN","PSJADT0",97,0)
DCIMO(DFN,ON,TYP) ; Check parameter before DC'ing clinic order
"RTN","PSJADT0",98,0)
 N GLO,IMOND,A,CLINIC,APPT,B,C S GLO=$S(TYP="P":"^PS(53.1,",TYP="U":"^PS(55,"_DFN_",5,",TYP="V":"^PS(55,"_PSGP_",""IV"",",1:"") I TYP="" Q 1
"RTN","PSJADT0",99,0)
 S IMOND=$S(TYP="P"!(TYP="V"):"""DSS""",TYP="U":8,1:"") I IMOND="" Q 1
"RTN","PSJADT0",100,0)
 S GLO=GLO_+ON_","_IMOND_")",A=$G(@GLO),CLINIC=$P(A,"^"),APPT=$P(A,"^",2)
"RTN","PSJADT0",101,0)
 Q:'$$CLINIC^PSJBCMA(A) 1
"RTN","PSJADT0",102,0)
 I '$D(^PS(53.46,"B",CLINIC)) Q 1
"RTN","PSJADT0",103,0)
 S B=$O(^PS(53.46,"B",CLINIC,"")),C=+$P(^PS(53.46,B,0),"^",3) Q C
"RTN","PSJAPIDS")
0^94^B29473329
"RTN","PSJAPIDS",1,0)
PSJAPIDS ;BIR/MV - API TO PROCESS DOSING ORDER CHECKS FOR IV ;6 Jun 07 / 3:37 PM
"RTN","PSJAPIDS",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**181**;16 DEC 97;Build 190
"RTN","PSJAPIDS",3,0)
 ;
"RTN","PSJAPIDS",4,0)
 ; Reference to ^PS(51.1 is supported by DBIA# 2177.
"RTN","PSJAPIDS",5,0)
 ;
"RTN","PSJAPIDS",6,0)
IVBAG(PSIVINRT,PSIVVOL,PSIVTDUR) ;
"RTN","PSJAPIDS",7,0)
 ;Return the number of IV bags needed for a 24 hours period
"RTN","PSJAPIDS",8,0)
 ;If the order is < 24 hrs, the return the max bags allow for the time frame
"RTN","PSJAPIDS",9,0)
 ;
"RTN","PSJAPIDS",10,0)
 ;PSIVINRT - Infusion Rate (ex: 125 ML/HR) (required)
"RTN","PSJAPIDS",11,0)
 ;PSIVVOL - The volume entered for the IV Solution (ex: 1000 ML) (required)
"RTN","PSJAPIDS",12,0)
 ;PSIVTDUR - The total volume (ex: 3000 ML)(optional), or
"RTN","PSJAPIDS",13,0)
 ;           Duration of the order (ex: 4D or 36H) (optional)
"RTN","PSJAPIDS",14,0)
 ;Return # of IV bags require for 24 hour time frame UNLESS:
"RTN","PSJAPIDS",15,0)
 ;       the value is <1 then return a 1, for free text infusion rate, or
"RTN","PSJAPIDS",16,0)
 ;       there's no volume, or bad Dur/Tot volume then return null
"RTN","PSJAPIDS",17,0)
 ;       
"RTN","PSJAPIDS",18,0)
 NEW PSIVBAG,PSIVDUR,PSIVDUR1,PSIVTVOL
"RTN","PSJAPIDS",19,0)
 I '+$G(PSIVINRT)!'+$G(PSIVVOL)!'+$G(PSIVTDUR) Q ""
"RTN","PSJAPIDS",20,0)
 S (PSIVDUR,PSIVTVOL)=""
"RTN","PSJAPIDS",21,0)
 I $G(PSIVTDUR)]"" D
"RTN","PSJAPIDS",22,0)
 . S PSIVTDUR=$$UP^XLFSTR(PSIVTDUR)
"RTN","PSJAPIDS",23,0)
 . I PSIVTDUR["H"!(PSIVTDUR["D") S PSIVDUR=PSIVTDUR Q
"RTN","PSJAPIDS",24,0)
 . I $P(PSIVTDUR," ",2)="L" S PSIVTVOL=+PSIVTDUR*1000
"RTN","PSJAPIDS",25,0)
 . I $P(PSIVTDUR," ",2)="ML" S PSIVTVOL=+PSIVTDUR
"RTN","PSJAPIDS",26,0)
 S PSIVBAG=1
"RTN","PSJAPIDS",27,0)
 ;Calculate # of bags needed if Duration is passed in
"RTN","PSJAPIDS",28,0)
 I $G(PSIVDUR)]"" D  Q $S(PSIVBAG<1:1,1:PSIVBAG)
"RTN","PSJAPIDS",29,0)
 . S PSIVDUR1=+$$DRT^PSSDSAPD(PSIVDUR)
"RTN","PSJAPIDS",30,0)
 . I PSIVDUR1=-1 Q
"RTN","PSJAPIDS",31,0)
 . I PSIVDUR1>=1440 S PSIVTVOL=+PSIVINRT*24
"RTN","PSJAPIDS",32,0)
 . I +PSIVDUR1,(PSIVDUR1<1440) S PSIVTVOL=+PSIVINRT*PSIVDUR1/60
"RTN","PSJAPIDS",33,0)
 . S:+PSIVVOL PSIVBAG=PSIVTVOL\+PSIVVOL
"RTN","PSJAPIDS",34,0)
 ;Calculate # of bags needed if Total volume is passed in
"RTN","PSJAPIDS",35,0)
 I +PSIVTVOL S PSIVBAG=+PSIVTVOL\+PSIVVOL Q $S(PSIVBAG<1:1,1:PSIVBAG)
"RTN","PSJAPIDS",36,0)
 S:+PSIVVOL PSIVBAG=(+PSIVINRT*24)\+PSIVVOL
"RTN","PSJAPIDS",37,0)
 Q $S(PSIVBAG<1:1,1:PSIVBAG)
"RTN","PSJAPIDS",38,0)
 ;
"RTN","PSJAPIDS",39,0)
DOSE(PSJBASE,DFN,PSJIV) ;
"RTN","PSJAPIDS",40,0)
 ;PSJBASE(1)=PSJBASE - Base1(Literal value for TMP global)- Required
"RTN","PSJAPIDS",41,0)
 ;PSJBASE(3)=PSJBASE1 - Base2(Literal value for Screened display TMP global)- Required
"RTN","PSJAPIDS",42,0)
 ;PSJDFN - Patient Internal Entry Number
"RTN","PSJAPIDS",43,0)
 ;PSJIV(Px) - See DBIA #5385...P4 can be "ALL", "See Comments", or bottle number(s)
"RTN","PSJAPIDS",44,0)
 ;PSJIV("TVOL_VOL") - Contains nUnit where n is # & Unit is either H,D,L,M, or DOSES 
"RTN","PSJAPIDS",45,0)
 NEW DRG,P,PSIVAS,PSIVNM,PSJDD,PSJFDB,PSJOCDS,PSIVTDUR,PSJTOTVL,X
"RTN","PSJAPIDS",46,0)
 I $$PING()=-1 Q
"RTN","PSJAPIDS",47,0)
 Q:$G(PSJIV("IV_TYPE"))=""
"RTN","PSJAPIDS",48,0)
 Q:'+$G(DFN)
"RTN","PSJAPIDS",49,0)
 S PSJTOTVL=0
"RTN","PSJAPIDS",50,0)
 F X=0:0 S X=$O(PSJBASE(X)) Q:'X  K:PSJBASE(X)]"" ^TMP($J,PSJBASE(1))
"RTN","PSJAPIDS",51,0)
 S P("DTYP")=+PSJIV("IV_TYPE")
"RTN","PSJAPIDS",52,0)
 S P("MR")=$G(PSJIV("MR_IEN"))
"RTN","PSJAPIDS",53,0)
 S P(8)=$G(PSJIV("INF_RATE"))
"RTN","PSJAPIDS",54,0)
 S P(9)=$G(PSJIV("SCHEDULE"))
"RTN","PSJAPIDS",55,0)
 ;Admin times and Freq are not available from CPRS
"RTN","PSJAPIDS",56,0)
 S P(11)=""
"RTN","PSJAPIDS",57,0)
 S P(15)=""
"RTN","PSJAPIDS",58,0)
 D SETDRG
"RTN","PSJAPIDS",59,0)
 S PSJIV("DUR")="",PSJIV("TOT_VOL")=""
"RTN","PSJAPIDS",60,0)
 I PSJIV("TVOL_DUR")]"" D
"RTN","PSJAPIDS",61,0)
 . S PSIVTDUR=$$UP^XLFSTR(PSJIV("TVOL_DUR"))
"RTN","PSJAPIDS",62,0)
 . I PSIVTDUR["M" S PSJIV("TOT_VOL")=+PSIVTDUR
"RTN","PSJAPIDS",63,0)
 . I PSIVTDUR["L" S PSJIV("TOT_VOL")=+PSIVTDUR*1000,PSIVTDUR=PSJIV("TOT_VOL")_"M"
"RTN","PSJAPIDS",64,0)
 . ;get dose count for intermittent
"RTN","PSJAPIDS",65,0)
 . I P("DTYP")=1 D DURATION(PSIVTDUR,P(9)) Q
"RTN","PSJAPIDS",66,0)
 . ;Convert PSJIV("DUR") to minutes
"RTN","PSJAPIDS",67,0)
 . I P("DTYP")=2,$S(PSIVTDUR["H":1,PSIVTDUR["D":1,1:0) S PSJIV("DUR")=$$DRT^PSSDSAPD(PSIVTDUR)
"RTN","PSJAPIDS",68,0)
 D IN^PSIVOCDS(PSJBASE(1))
"RTN","PSJAPIDS",69,0)
 D DOSE^PSSDSAPD(.PSJBASE,DFN,.PSJOCDS,.PSJFDB)
"RTN","PSJAPIDS",70,0)
 K ^TMP($J,"PSJPRE")
"RTN","PSJAPIDS",71,0)
 Q
"RTN","PSJAPIDS",72,0)
SETDRG ;
"RTN","PSJAPIDS",73,0)
 NEW PSIVX,PSIVX0,PSJDD,PSGDT,PSJCNT,%
"RTN","PSJAPIDS",74,0)
 D NOW^%DTC S PSGDT=%
"RTN","PSJAPIDS",75,0)
 F PSIVAS="AD","SOL" S PSJCNT=0 F PSIVX=0:0 S PSIVX=$O(PSJIV(PSIVAS,PSIVX)) Q:'PSIVX  D
"RTN","PSJAPIDS",76,0)
 .S PSIVX0=$G(PSJIV(PSIVAS,PSIVX))
"RTN","PSJAPIDS",77,0)
 .D:PSIVAS="AD" SETAD(+PSIVX0,$P(PSIVX0,U,2))
"RTN","PSJAPIDS",78,0)
 .D:PSIVAS="SOL" SETSOL(+PSIVX0,$P(PSIVX0,U,2))
"RTN","PSJAPIDS",79,0)
 Q
"RTN","PSJAPIDS",80,0)
SETAD(PSJOI,PSJOINM) ;Check if additive is active then set the DRG array
"RTN","PSJAPIDS",81,0)
 ;PSJOI - 50.7 ien
"RTN","PSJAPIDS",82,0)
 ;PSJOINM - CPRS OI name
"RTN","PSJAPIDS",83,0)
 Q:'+$G(PSJOI)
"RTN","PSJAPIDS",84,0)
 NEW PSJOK,PSIVIEN,PSJINACT
"RTN","PSJAPIDS",85,0)
 S PSJOK=0
"RTN","PSJAPIDS",86,0)
 F PSIVIEN=0:0 S PSIVIEN=$O(^PS(52.6,"AOI",PSJOI,PSIVIEN)) Q:'PSIVIEN  Q:PSJOK  D
"RTN","PSJAPIDS",87,0)
 . S PSJINACT=$G(^PS(52.6,PSIVIEN,"I"))
"RTN","PSJAPIDS",88,0)
 . I PSJINACT]"",(PSJINACT'>PSGDT) Q
"RTN","PSJAPIDS",89,0)
 . I $G(^PS(52.6,PSIVIEN,0))]"" D
"RTN","PSJAPIDS",90,0)
 .. S PSJOK=1
"RTN","PSJAPIDS",91,0)
 .. S PSJCNT=PSJCNT+1
"RTN","PSJAPIDS",92,0)
 .. S DRG("AD",PSJCNT)=PSIVIEN_U_$P(PSIVX0,U,2)_U_$P(PSIVX0,U,3)_U_$S('+$P(PSIVX0,U,4):"",1:$P(PSIVX0,U,4))
"RTN","PSJAPIDS",93,0)
 I 'PSJOK,($G(PSJOINM)]"") S PSJIV("OI_ERROR",PSJOINM)=4_U_PSJOI
"RTN","PSJAPIDS",94,0)
 Q
"RTN","PSJAPIDS",95,0)
SETSOL(PSJOI,PSJOINM) ;Check if solution is active then set then DRG array
"RTN","PSJAPIDS",96,0)
 ;PSJOI - 50.7 ien
"RTN","PSJAPIDS",97,0)
 ;PSJOINM - CPRS OI name
"RTN","PSJAPIDS",98,0)
 Q:'+$G(PSJOI)
"RTN","PSJAPIDS",99,0)
 NEW PSJOK,PSIVIEN,PSJINACT,PSJPREMX
"RTN","PSJAPIDS",100,0)
 S PSJOK=0,PSJPREMX=0
"RTN","PSJAPIDS",101,0)
 F PSIVIEN=0:0 S PSIVIEN=$O(^PS(52.7,"AOI",PSJOI,PSIVIEN)) Q:'PSIVIEN  Q:PSJOK  D
"RTN","PSJAPIDS",102,0)
 . I '+$P($G(^PS(52.7,+PSIVIEN,0)),U,2) Q
"RTN","PSJAPIDS",103,0)
 . S PSJINACT=$G(^PS(52.7,PSIVIEN,"I"))
"RTN","PSJAPIDS",104,0)
 . I PSJINACT]"",(PSJINACT'>PSGDT) Q
"RTN","PSJAPIDS",105,0)
 . I '$$PREMIX^PSJMISC(+PSIVIEN) S PSJPREMX=1
"RTN","PSJAPIDS",106,0)
 . I $G(^PS(52.7,PSIVIEN,0))]"" D
"RTN","PSJAPIDS",107,0)
 .. S PSJOK=1
"RTN","PSJAPIDS",108,0)
 .. S PSJCNT=PSJCNT+1
"RTN","PSJAPIDS",109,0)
 .. S DRG("SOL",PSJCNT)=PSIVIEN_U_$P(PSIVX0,U,2)_U_$P(PSIVX0,U,3)
"RTN","PSJAPIDS",110,0)
 .. S PSJTOTVL=PSJTOTVL+(+$P(PSIVX0,U,3))
"RTN","PSJAPIDS",111,0)
 I 'PSJOK,($G(PSJOINM)]"") S PSJIV("OI_ERROR",PSJOINM)=4_U_PSJOI
"RTN","PSJAPIDS",112,0)
 Q
"RTN","PSJAPIDS",113,0)
DURATION(PSJDUR,PSJSCH) ;Figure out date dose limit send by CPRS
"RTN","PSJAPIDS",114,0)
 ;Set PSJIV("DOSE_CNT") only for duratin < 24 hrs & set PSJIV("DUR") to # minutes specified in the duration field
"RTN","PSJAPIDS",115,0)
 NEW PSJDOW,PSJCNT,PSJDUR1,PSJCNT1
"RTN","PSJAPIDS",116,0)
 I $G(PSJDUR)="" Q
"RTN","PSJAPIDS",117,0)
 I $G(PSJSCH)="" Q
"RTN","PSJAPIDS",118,0)
 S PSJDUR1=0,PSJCNT1=""
"RTN","PSJAPIDS",119,0)
 S PSJDOW=$$DOW(PSJSCH)
"RTN","PSJAPIDS",120,0)
 ; PSJDUR1 - Duration in minutes (#_M)
"RTN","PSJAPIDS",121,0)
 I $S(PSJDUR["DOSES":0,PSJDUR["H":1,PSJDUR["D":1,1:0) S PSJDUR1=$$DRT^PSSDSAPD(PSJDUR)_"M" S PSJIV("DUR")=+PSJDUR1
"RTN","PSJAPIDS",122,0)
 ;
"RTN","PSJAPIDS",123,0)
 S PSJCNT=$$FRQ^PSSDSAPI(PSJSCH,PSJDOW,"I",PSJDUR1)
"RTN","PSJAPIDS",124,0)
 ; PSJCNT1 - Dose count from Duration
"RTN","PSJAPIDS",125,0)
 I PSJDUR["DOSES" S PSJCNT1=+PSJDUR
"RTN","PSJAPIDS",126,0)
 I PSJDUR["M" D
"RTN","PSJAPIDS",127,0)
 . I '+$G(PSJTOTVL) S PSJIV("FRQ_ERROR")="" Q
"RTN","PSJAPIDS",128,0)
 . I +PSJDUR>(PSJTOTVL*(+$P(PSJCNT,U,2))) S PSJIV("DUR")=""
"RTN","PSJAPIDS",129,0)
 . S PSJCNT1=(+PSJDUR)/PSJTOTVL
"RTN","PSJAPIDS",130,0)
 ; Set dose count to the less between Duration or schedule
"RTN","PSJAPIDS",131,0)
 I PSJCNT1,(PSJCNT1<+PSJCNT) D
"RTN","PSJAPIDS",132,0)
 . I PSJCNT1'=$J(PSJCNT1,"",0) S PSJIV("FRQ_ERROR")="" Q
"RTN","PSJAPIDS",133,0)
 . S PSJIV("DOSE_CNT")=PSJCNT1
"RTN","PSJAPIDS",134,0)
 . S:+$P(PSJCNT,U,2) PSJIV("DUR")=(1440/$P(PSJCNT,U,2))*PSJCNT1
"RTN","PSJAPIDS",135,0)
 ; Set dose count for duratin in day/hour
"RTN","PSJAPIDS",136,0)
 I +PSJDUR1,($P(PSJCNT,U)<$P(PSJCNT,U,2)) S PSJIV("DOSE_CNT")=+PSJCNT
"RTN","PSJAPIDS",137,0)
 Q
"RTN","PSJAPIDS",138,0)
DOW(PSJSCH) ;Check if Schedule is a date of week
"RTN","PSJAPIDS",139,0)
 ;Return "D" if date of week
"RTN","PSJAPIDS",140,0)
 NEW PSJSCHNO,PSJDOW,PSJFOUND
"RTN","PSJAPIDS",141,0)
 I $G(PSJSCH)="" Q ""
"RTN","PSJAPIDS",142,0)
 S PSJDOW=0,PSJFOUND=0
"RTN","PSJAPIDS",143,0)
 F PSJSCHNO=0:0 S PSJSCHNO=$O(^PS(51.1,"APPSJ",PSJSCH,PSJSCHNO)) Q:'PSJSCHNO!(PSJDOW)  D
"RTN","PSJAPIDS",144,0)
 .I $P($G(^PS(51.1,PSJSCHNO,0)),"^",5)="D" S PSJDOW=1
"RTN","PSJAPIDS",145,0)
 .I $D(^PS(51.1,PSJSCHNO,0)) S PSJFOUND=1
"RTN","PSJAPIDS",146,0)
 I PSJDOW Q "D"
"RTN","PSJAPIDS",147,0)
 I PSJFOUND Q ""
"RTN","PSJAPIDS",148,0)
 I PSJSCH["@" Q "D"
"RTN","PSJAPIDS",149,0)
 Q ""
"RTN","PSJAPIDS",150,0)
PING() ;Return -1 if the system is down.
"RTN","PSJAPIDS",151,0)
 S ^TMP($J,"PSJPRE","IN","PING")=""
"RTN","PSJAPIDS",152,0)
 D IN^PSSHRQ2("PSJPRE")
"RTN","PSJAPIDS",153,0)
 Q +$G(^TMP($J,"PSJPRE","OUT",0))
"RTN","PSJBLDOC")
0^42^B34049037
"RTN","PSJBLDOC",1,0)
PSJBLDOC ;BIR/MV - API to build ^TMP for prospective and PSJ profile drugs ;03 Aug 98 / 8:42 AM
"RTN","PSJBLDOC",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**181**;16 DEC 97;Build 190
"RTN","PSJBLDOC",3,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJBLDOC",4,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJBLDOC",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJBLDOC",6,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192.
"RTN","PSJBLDOC",7,0)
 ;
"RTN","PSJBLDOC",8,0)
IN(DFN,LIST,PDRG,PTYP) ;
"RTN","PSJBLDOC",9,0)
 ;Build the IPM profiles and the prospective drugs list for both PSO & PSJ if PDRG is passed in.
"RTN","PSJBLDOC",10,0)
 ;DFN - PATIENT DFN
"RTN","PSJBLDOC",11,0)
 ;LIST - BASE
"RTN","PSJBLDOC",12,0)
 ;PDRG - Drug array in format of PDRG(n)=IEN (#50) ^ Drug name
"RTN","PSJBLDOC",13,0)
 ;       Where n is a sequential number.  Drug name can be OI, Generic name from #50 or Additive/sol name
"RTN","PSJBLDOC",14,0)
 ;PTYP - P1;P2 where P1="I" for Inpatient & "O" for Outpatient, P2= PSJ order#
"RTN","PSJBLDOC",15,0)
 NEW PSJONCNT,PSJDCNT,PSJDRGND,PSJWON
"RTN","PSJBLDOC",16,0)
 S PSJONCNT=0
"RTN","PSJBLDOC",17,0)
 S PSJWON=$P($G(PTYP),";",2)
"RTN","PSJBLDOC",18,0)
 D PROFILE(DFN,PSJWON)
"RTN","PSJBLDOC",19,0)
 Q
"RTN","PSJBLDOC",20,0)
PROFILE(DFN,PSJWON)     ; Setup ^TMP for the active meds to be on the OC profile list.
"RTN","PSJBLDOC",21,0)
 ;DFN:    Patient internal entry number
"RTN","PSJBLDOC",22,0)
 ;PSJWON: The current order number being working on.  It can be null.
"RTN","PSJBLDOC",23,0)
 ;        It is the order being work on (RN, FN..) and should be on the prospective list.
"RTN","PSJBLDOC",24,0)
 ;Output: ^TMP($J,"ORDERS",PSJINX)=DRUG CLASS^NATIONAL DRUG FILE ENTRY
"RTN","PSJBLDOC",25,0)
 ;        _"A"_PSNDFA PRODUCT NAME ENTRY_DISPENSE DRUG NAME^OE/RR #
"RTN","PSJBLDOC",26,0)
 ;        _ORDER NUMBER(P/I/V)_";I"
"RTN","PSJBLDOC",27,0)
 ;
"RTN","PSJBLDOC",28,0)
 NEW BDT,COD,DDRUG,DDRUGND,EDT,F,ON,ON1,PST,WBDT,X,PSJORIEN,%
"RTN","PSJBLDOC",29,0)
 S PSJWON=$G(PSJWON)
"RTN","PSJBLDOC",30,0)
 D NOW^%DTC S (BDT,WBDT)=%,EDT=9999999
"RTN","PSJBLDOC",31,0)
 S F="^PS(55,DFN,5," F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  S COD=ON_"U" D:COD'=PSJWON UD
"RTN","PSJBLDOC",32,0)
 S F="^PS(53.1," F PST="P","N" F ON=0:0 S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  D
"RTN","PSJBLDOC",33,0)
 . S COD=ON_"P" Q:COD=PSJWON
"RTN","PSJBLDOC",34,0)
 . I $G(PSJCOM),($G(PSJWON)["P") Q:$D(^PS(53.1,"ACX",PSJCOM,+ON))
"RTN","PSJBLDOC",35,0)
 . I $O(^PS(53.1,+ON,"AD",0))!$O(^PS(53.1,+ON,"SOL",0)) D PIV Q
"RTN","PSJBLDOC",36,0)
 . D UD
"RTN","PSJBLDOC",37,0)
 S WBDT=BDT F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  S COD=ON_"V" D:COD'=PSJWON IV
"RTN","PSJBLDOC",38,0)
 K PSJWON
"RTN","PSJBLDOC",39,0)
 Q
"RTN","PSJBLDOC",40,0)
UD ;*** Get the dispense drugs for the Unit Dose orders.
"RTN","PSJBLDOC",41,0)
 NEW X,PSJQUIT,PSJCNT,DDRUG,DDRUGN,PSJX,PSJOI,PSJEXPDD
"RTN","PSJBLDOC",42,0)
 S X=@(F_ON_",0)")
"RTN","PSJBLDOC",43,0)
 Q:$P(X,U,9)="R"
"RTN","PSJBLDOC",44,0)
 Q:$P(X,U,9)="D"
"RTN","PSJBLDOC",45,0)
 Q:$P(X,U,9)="E"
"RTN","PSJBLDOC",46,0)
 S PSJORIEN=$P(X,U,21),DDRUG=0
"RTN","PSJBLDOC",47,0)
 ;
"RTN","PSJBLDOC",48,0)
 ; Use the first active DD within the order.  If >1 DD, use OI_Dosage form for display name
"RTN","PSJBLDOC",49,0)
 S ON1=0,PSJCNT=0 F  S ON1=$O(@(F_ON_",1,"_ON1_")")) Q:'ON1  S PSJCNT=PSJCNT+1
"RTN","PSJBLDOC",50,0)
 S PSJOI=+$G(@(F_ON_",.2)"))
"RTN","PSJBLDOC",51,0)
 S ON1=0,PSJQUIT=0 F  S ON1=$O(@(F_ON_",1,"_ON1_")")) Q:'+ON1!PSJQUIT  S DDRUG=@(F_ON_",1,"_ON1_",0)") D
"RTN","PSJBLDOC",52,0)
 . Q:'+DDRUG
"RTN","PSJBLDOC",53,0)
 . S PSJX=$P(DDRUG,U,3)
"RTN","PSJBLDOC",54,0)
 . I PSJX]"",(PSJX'>BDT) S PSJEXPDD(+DDRUG)="" Q
"RTN","PSJBLDOC",55,0)
 . S PSJX=$S('$D(^PSDRUG(+DDRUG,0)):1,$P($G(^(2)),U,3)'["U":1,$G(^("I"))="":0,1:^("I")'>$G(BDT))
"RTN","PSJBLDOC",56,0)
 . Q:PSJX
"RTN","PSJBLDOC",57,0)
 . D SETIN("PROFILE",$S(PSJCNT>1:$$OIDF^PSJLMUT1(+$G(PSJOI)),1:$P($G(^PSDRUG(DDRUG,0)),U)),+DDRUG,COD) S PSJQUIT=1
"RTN","PSJBLDOC",58,0)
 Q:+$G(PSJQUIT)
"RTN","PSJBLDOC",59,0)
 ;
"RTN","PSJBLDOC",60,0)
 ; Just in case there are no active OI
"RTN","PSJBLDOC",61,0)
 I '+PSJOI D SETIN("PROFILE","NOT FOUND: "_COD,"",COD,1) Q
"RTN","PSJBLDOC",62,0)
 S PSJX=$P($G(^PS(50.7,+PSJOI,0)),U,4)
"RTN","PSJBLDOC",63,0)
 I PSJX]"",(PSJX'>$G(BDT)) D SETIN("PROFILE",$$OIDF^PSJLMUT1(+$G(PSJOI)),"",COD,1) Q
"RTN","PSJBLDOC",64,0)
 ;
"RTN","PSJBLDOC",65,0)
 ; If no active DD, use the first active DD ties to OI that is marked for "U"
"RTN","PSJBLDOC",66,0)
 S DDRUG="",PSJQUIT=0 F  S DDRUG=$O(^PSDRUG("ASP",PSJOI,DDRUG)) Q:'DDRUG!PSJQUIT  D
"RTN","PSJBLDOC",67,0)
 . S PSJX=$S($D(PSJEXPDD(+DDRUG)):1,'$D(^PSDRUG(+DDRUG,0)):1,$P($G(^(2)),U,3)'["U":1,$G(^("I"))="":0,1:^("I")'>$G(BDT))
"RTN","PSJBLDOC",68,0)
 . Q:PSJX
"RTN","PSJBLDOC",69,0)
 . D SETIN("PROFILE",$$OIDF^PSJLMUT1(+$G(PSJOI)),DDRUG,COD) S PSJQUIT=1
"RTN","PSJBLDOC",70,0)
 Q:+$G(PSJQUIT)
"RTN","PSJBLDOC",71,0)
 ;
"RTN","PSJBLDOC",72,0)
 ;If the pending order can be finsihed as UD or IV, check for active DD marked for "I"
"RTN","PSJBLDOC",73,0)
 I F="^PS(53.1,",($P(@(F_ON_",0)"),U,4)="I") D
"RTN","PSJBLDOC",74,0)
 . S DDRUG="",PSJQUIT=0 F  S DDRUG=$O(^PSDRUG("ASP",PSJOI,DDRUG)) Q:'DDRUG!PSJQUIT  D
"RTN","PSJBLDOC",75,0)
 .. S PSJX=$S('$D(^PSDRUG(+DDRUG,0)):1,$P($G(^(2)),U,3)'["I":1,$G(^("I"))="":0,1:^("I")'>$G(BDT))
"RTN","PSJBLDOC",76,0)
 .. Q:PSJX
"RTN","PSJBLDOC",77,0)
 .. D SETIN("PROFILE",$$OIDF^PSJLMUT1(+$G(PSJOI)),DDRUG,COD) S PSJQUIT=1
"RTN","PSJBLDOC",78,0)
 Q:+$G(PSJQUIT)
"RTN","PSJBLDOC",79,0)
 ;
"RTN","PSJBLDOC",80,0)
 ; Use the first active DD ties to OI
"RTN","PSJBLDOC",81,0)
 S DDRUG="",PSJQUIT=0 F  S DDRUG=$O(^PSDRUG("ASP",PSJOI,DDRUG)) Q:'DDRUG!PSJQUIT  D
"RTN","PSJBLDOC",82,0)
 . S PSJX=$S('$D(^PSDRUG(+DDRUG,0)):1,$G(^("I"))="":0,1:^("I")'>$G(BDT))
"RTN","PSJBLDOC",83,0)
 . Q:PSJX
"RTN","PSJBLDOC",84,0)
 . D SETIN("PROFILE",$$OIDF^PSJLMUT1(+$G(PSJOI)),DDRUG,COD) S PSJQUIT=1
"RTN","PSJBLDOC",85,0)
 Q:+$G(PSJQUIT)
"RTN","PSJBLDOC",86,0)
 ;
"RTN","PSJBLDOC",87,0)
 ; Set exception for NO DD found
"RTN","PSJBLDOC",88,0)
 D SETIN("PROFILE",$$OIDF^PSJLMUT1(+$G(PSJOI)),"",COD,1)
"RTN","PSJBLDOC",89,0)
 Q
"RTN","PSJBLDOC",90,0)
PIV ;*** Get the dispense drugs for the Pending IV orders.
"RTN","PSJBLDOC",91,0)
 NEW PSJ0,PSJX,DDRUG,PSJNM
"RTN","PSJBLDOC",92,0)
 S PSJX=^PS(53.1,+ON,0),PSJORIEN=$P(PSJX,U,21) Q:$P(PSJX,U,27)="R"
"RTN","PSJBLDOC",93,0)
 S ON1=0 F  S ON1=$O(^PS(53.1,+ON,"AD",ON1)) Q:'ON1  D
"RTN","PSJBLDOC",94,0)
 . S PSJX=^PS(53.1,+ON,"AD",ON1,0),PSJ0=$$IV0("AD",+PSJX)
"RTN","PSJBLDOC",95,0)
 . S PSJNM=$P(PSJ0,U)_" "_$P(PSJX,U,2),DDRUG=$P(PSJ0,U,2)
"RTN","PSJBLDOC",96,0)
 . I '+DDRUG D SETIN("PROFILE",PSJNM,"",COD,4) Q
"RTN","PSJBLDOC",97,0)
 . D SETIN("PROFILE",$P(PSJ0,U)_" "_$P(PSJX,U,2),$P(PSJ0,U,2),COD)
"RTN","PSJBLDOC",98,0)
 S ON1=0 F  S ON1=$O(^PS(53.1,+ON,"SOL",ON1)) Q:'ON1  D
"RTN","PSJBLDOC",99,0)
 . S PSJX=^PS(53.1,+ON,"SOL",ON1,0) D
"RTN","PSJBLDOC",100,0)
 . I $$PREMIX^PSJMISC(+PSJX) D
"RTN","PSJBLDOC",101,0)
 .. S PSJ0=$$IV0("",+PSJX)
"RTN","PSJBLDOC",102,0)
 .. S PSJNM=$P(PSJ0,U)_" "_$P(PSJX,U,2),DDRUG=$P(PSJ0,U,2)
"RTN","PSJBLDOC",103,0)
 .. I '+DDRUG D SETIN("PROFILE",PSJNM,"",COD,4) Q
"RTN","PSJBLDOC",104,0)
 .. D SETIN("PROFILE",$P(PSJ0,U)_" "_$P(PSJX,U,2),$P(PSJ0,U,2),COD)
"RTN","PSJBLDOC",105,0)
 Q
"RTN","PSJBLDOC",106,0)
IV ;*** Get the dispense drugs for the IV orders.
"RTN","PSJBLDOC",107,0)
 NEW PSJ0,PSJX,DDRUG,PSJNM
"RTN","PSJBLDOC",108,0)
 S PSJX=^PS(55,DFN,"IV",ON,0),PSJORIEN=$P(PSJX,U,21)
"RTN","PSJBLDOC",109,0)
 Q:$P(PSJX,U,17)="R"
"RTN","PSJBLDOC",110,0)
 Q:$P(PSJX,U,17)="D"
"RTN","PSJBLDOC",111,0)
 Q:$P(PSJX,U,17)="E"
"RTN","PSJBLDOC",112,0)
 S ON1=0 F  S ON1=$O(^PS(55,DFN,"IV",ON,"AD",ON1)) Q:'ON1  D
"RTN","PSJBLDOC",113,0)
 . S PSJX=^PS(55,DFN,"IV",ON,"AD",ON1,0),PSJ0=$$IV0("AD",+PSJX)
"RTN","PSJBLDOC",114,0)
 . S PSJNM=$P(PSJ0,U)_" "_$P(PSJX,U,2),DDRUG=$P(PSJ0,U,2)
"RTN","PSJBLDOC",115,0)
 . I '+DDRUG D SETIN("PROFILE",PSJNM,"",COD,4) Q
"RTN","PSJBLDOC",116,0)
 . D SETIN("PROFILE",PSJNM,DDRUG,COD)
"RTN","PSJBLDOC",117,0)
 ; Only include Pre-mix in the OC.
"RTN","PSJBLDOC",118,0)
 S ON1=0 F  S ON1=$O(^PS(55,DFN,"IV",ON,"SOL",ON1)) Q:'ON1  D
"RTN","PSJBLDOC",119,0)
 . S PSJX=^PS(55,DFN,"IV",ON,"SOL",ON1,0)
"RTN","PSJBLDOC",120,0)
 . I $$PREMIX^PSJMISC(+PSJX) D
"RTN","PSJBLDOC",121,0)
 .. S PSJ0=$$IV0("",+PSJX)
"RTN","PSJBLDOC",122,0)
 .. S PSJNM=$P(PSJ0,U)_" "_$P(PSJX,U,2),DDRUG=$P(PSJ0,U,2)
"RTN","PSJBLDOC",123,0)
 .. I '+DDRUG D SETIN("PROFILE",PSJNM,"",COD,4) Q
"RTN","PSJBLDOC",124,0)
 .. D SETIN("PROFILE",PSJNM,DDRUG,COD)
"RTN","PSJBLDOC",125,0)
 Q
"RTN","PSJBLDOC",126,0)
SETIN(PSJFLG,PSJNM,DDRUG,ON,PSJCODE) ;*** Set ^TMP($J,"PSJPRE,"IN" arrays.
"RTN","PSJBLDOC",127,0)
 ;ON = ON with "U/V/P"
"RTN","PSJBLDOC",128,0)
 ;PSJFLG = "PROSPECTIVE" or "PROFILE"
"RTN","PSJBLDOC",129,0)
 ;PSJNM = This should be the AD/SOL print name or IV order.  Use Dispense drug name if U/D order
"RTN","PSJBLDOC",130,0)
 ;PSJPON = 4 piece pharmacy order #
"RTN","PSJBLDOC",131,0)
 NEW PSJPON
"RTN","PSJBLDOC",132,0)
 Q:$G(PSJFLG)=""
"RTN","PSJBLDOC",133,0)
 S PSJONCNT=$G(PSJONCNT)+1
"RTN","PSJBLDOC",134,0)
 S PSJPON="I;"_ON_";"_PSJFLG_";"_PSJONCNT
"RTN","PSJBLDOC",135,0)
 I '+$G(DDRUG) D  Q
"RTN","PSJBLDOC",136,0)
 . I +$G(PSJCODE) D NODD($G(PSJCODE),PSJNM,PSJPON,"PSJPRE")
"RTN","PSJBLDOC",137,0)
 Q:$$SUP^PSSDSAPI(+DDRUG)
"RTN","PSJBLDOC",138,0)
 I $G(PSJNM)="" S PSJNM=$P($G(^PSDRUG(+DDRUG,0)),U)
"RTN","PSJBLDOC",139,0)
 S ^TMP($J,LIST,"IN",PSJFLG,PSJPON)=+$$GCN^PSJMISC(+DDRUG)_U_$$GTVUID^PSJMISC(+DDRUG)_U_+DDRUG_U_PSJNM_U_$G(PSJORIEN)_U_"I"
"RTN","PSJBLDOC",140,0)
 Q
"RTN","PSJBLDOC",141,0)
 ;
"RTN","PSJBLDOC",142,0)
IV0(PSJAD,PSIVIEN) ;Return ad/sol zero node
"RTN","PSJBLDOC",143,0)
 ;PSJAD = "AD" is passed in if it additive, otherwise it's null
"RTN","PSJBLDOC",144,0)
 I PSJAD="AD" Q $G(^PS(52.6,+$G(PSIVIEN),0))
"RTN","PSJBLDOC",145,0)
 I $G(PSJAD)="" Q $G(^PS(52.7,+$G(PSIVIEN),0))
"RTN","PSJBLDOC",146,0)
 Q ""
"RTN","PSJBLDOC",147,0)
 ;
"RTN","PSJBLDOC",148,0)
NODD(PSJCODE,PSJOIDF,PSJPON,PSJBASE) ;Set ^TMP for OI without a dispense drug
"RTN","PSJBLDOC",149,0)
 ;PSJCODE - A numeric code to trigger the appropriate exception message 
"RTN","PSJBLDOC",150,0)
 ;PSJOIDF - Orderable Item name_Dose form (can be CPRS OI)
"RTN","PSJBLDOC",151,0)
 ;PSJPON - Pharmacy order #
"RTN","PSJBLDOC",152,0)
 ;PSJBASE - Base subscript
"RTN","PSJBLDOC",153,0)
 Q:$G(PSJOIDF)=""
"RTN","PSJBLDOC",154,0)
 Q:$G(PSJBASE)=""
"RTN","PSJBLDOC",155,0)
 Q:'+$G(PSJCODE)
"RTN","PSJBLDOC",156,0)
 ;S PSJIV("OI_ERROR",PSJOIDF)=$G(PSJCODE)_U_$G(PSJPON)
"RTN","PSJBLDOC",157,0)
 S ^TMP($J,PSJBASE,"IN","EXCEPTIONS","OI",PSJOIDF)=PSJCODE_U_$G(PSJPON)
"RTN","PSJBLDOC",158,0)
 Q
"RTN","PSJCOMR")
0^58^B75920625
"RTN","PSJCOMR",1,0)
PSJCOMR ;BIR/CML3-RENEW A COMPLEX ORDER SERIES ;07 MAR 96 / 1:23 PM
"RTN","PSJCOMR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**110,127,136,157,181**;16 DEC 97;Build 190
"RTN","PSJCOMR",3,0)
 ;
"RTN","PSJCOMR",4,0)
 ; Reference to ^PS(55 supported by DBIA 2191.
"RTN","PSJCOMR",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA 2789.
"RTN","PSJCOMR",6,0)
 ; Reference to NOW^%DTC is supported by DBIA 10000.
"RTN","PSJCOMR",7,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJCOMR",8,0)
 ;
"RTN","PSJCOMR",9,0)
 ; renew a complex order series
"RTN","PSJCOMR",10,0)
 Q:'PSJCOM  K COMQUIT,PSGORQF
"RTN","PSJCOMR",11,0)
 W !!,"This order is part of a complex order. If you "_$S($P(PSJSYSP0,"^",3):"RENEW",1:"MARK")_" this order the",!,"following orders will be "_$S($P(PSJSYSP0,"^",3):"RENEWED",1:"MARKED")_" too." D CMPLX^PSJCOM1(PSGP,PSJCOM,PSGORD)
"RTN","PSJCOMR",12,0)
 W !! K DIR S DIR(0)="Y",DIR("A")=$S($P(PSJSYSP0,"^",3):"RENEW THIS COMPLEX ORDER SERIES",1:"MARK THIS COMPLEX ORDER SERIES FOR RENEWAL"),DIR("B")="YES"
"RTN","PSJCOMR",13,0)
 S DIR("?")="Answer 'YES' to "_$S($P(PSJSYSP0,"^",3):"renew this complex order series",1:"mark this complex order series for renewal")_".  Answer 'NO' (or '^') to stop now." D ^DIR K DIR
"RTN","PSJCOMR",14,0)
 I 'Y N DIR D ABORT G DONE
"RTN","PSJCOMR",15,0)
 I '$D(DIRUT),Y D NEW S PSGCANFL=1 D DONE Q
"RTN","PSJCOMR",16,0)
 I '$D(DIRUT),PSJSYSU I $P(PSGND4,"^",15),$P(PSGND4,"^",16) D UNMARK,DONE Q
"RTN","PSJCOMR",17,0)
 D DONE,ABORT^PSGOEE
"RTN","PSJCOMR",18,0)
 Q
"RTN","PSJCOMR",19,0)
 ;
"RTN","PSJCOMR",20,0)
UNMARK ;  
"RTN","PSJCOMR",21,0)
 W !!,"THIS COMPLEX ORDER SERIES HAS BEEN 'MARKED FOR RENEWAL'.",! K DIR S DIR(0)="Y",DIR("A")="DO YOU WANT TO 'UNMARK IT'",DIR("B")="NO"
"RTN","PSJCOMR",22,0)
 S DIR("?",1)="  Answer 'YES' to unmark this complex order series.  Answer 'NO' (or '^') to leave the complex",DIR("?")="order series marked.  (An answer is required.)" D ^DIR
"RTN","PSJCOMR",23,0)
 I 'Y N DIR D ABORT^PSGOEE G DONE
"RTN","PSJCOMR",24,0)
 N PSGORD,XX,X S XX=0,X="" F  S XX=$O(^PS(55,"ACX",PSJCOM,XX)) Q:'XX  F  S X=$O(^PS(55,"ACX",PSJCOM,XX,X)) Q:X=""  S PSGORD=X D
"RTN","PSJCOMR",25,0)
 .S PSGND4=$G(^PS(55,PSGP,5,+PSGORD,4))
"RTN","PSJCOMR",26,0)
 .S DA(1)=PSGP,DA=+PSGORD,PSGAL("C")=21180+PSJSYSU D ^PSGAL5 S $P(PSGND4,"^",15,17)="^^",^PS(55,PSGP,5,DA,4)=PSGND4 W "...DONE!"
"RTN","PSJCOMR",27,0)
 ;
"RTN","PSJCOMR",28,0)
DONE ;
"RTN","PSJCOMR",29,0)
 K %DT,DA,DIE,DIR,DR,FDSD,PSGAL,PSGALR,PSGDL,PSGDLS,PSGFD,PSGFOK,PSGND4,PSGOEE,PSGOER0,PSGOER1,PSGOER2,PSGOERDP,PSGOPR,PSGOSD,PSGPOSA,PSGPOSD,PSGPR,PSGPX,PSGRD,PSGSD,PSGTOL,PSGTOO,PSGUOW,PSGWLL,RF Q
"RTN","PSJCOMR",30,0)
 ;
"RTN","PSJCOMR",31,0)
NEW ; get info, write record
"RTN","PSJCOMR",32,0)
 K ^TMP("PSJCOMR",$J)
"RTN","PSJCOMR",33,0)
 N DUOUT,PSGORD,TMPP,TMPO,PS55ACX,TMPDUZ,TMPOE,COMQUIT S TMPP=0 K PS55ACX M PS55ACX(55,"ACX",PSJCOM)=^PS(55,"ACX",PSJCOM)
"RTN","PSJCOMR",34,0)
 F  S TMPP=$O(PS55ACX(55,"ACX",PSJCOM,TMPP)) Q:'TMPP!$G(COMQUIT)  D
"RTN","PSJCOMR",35,0)
 . S TMPO=0 F  S TMPO=$O(PS55ACX(55,"ACX",PSJCOM,TMPP,TMPO)) Q:TMPO=""!$G(COMQUIT)  S PSGORD=TMPO D:PSGORD["U" NEWUD  I PSGORD["V" D NEWIV
"RTN","PSJCOMR",36,0)
 I $G(COMQUIT)!$G(DUOUT)  W !!,"By not verifying all the orders, none of the orders will be verified." D PAUSE^VALM1 Q
"RTN","PSJCOMR",37,0)
 I '$G(COMQUIT)&'$G(DUOUT) S TMPOE=0 F  S TMPOE=$O(^PS(55,"ACX",PSJCOM,TMPOE)) Q:TMPOE=""  S TMPO=0 F  S TMPO=$O(^PS(55,"ACX",PSJCOM,TMPOE,TMPO)) Q:'TMPO!$G(COMQUIT)  S PSGORD=TMPO D
"RTN","PSJCOMR",38,0)
 . K VSTRING S VSTRING=$G(^TMP("PSJCOMR",$J,PSJCOM,TMPO)) I PSGORD'=$P(VSTRING,"^",2) S COMQUIT=1 Q
"RTN","PSJCOMR",39,0)
 . S PSGP=$P(VSTRING,"^"),PSGDT=$P(VSTRING,"^",3),PSGOEPR=$P(VSTRING,"^",4),PSGOFD=$P(VSTRING,"^",5),PSGFD=$P(VSTRING,"^",6),PSJNOO=$P(VSTRING,"^",7),TMPDUZ=$P(VSTRING,"^",8)
"RTN","PSJCOMR",40,0)
 . D:PSGORD["U" FILEUD D:PSGORD["V" FILEIV
"RTN","PSJCOMR",41,0)
 K ^TMP("PSJCOMR",$J),VSTRING
"RTN","PSJCOMR",42,0)
 Q
"RTN","PSJCOMR",43,0)
NEWUD N PSJABT,PSGDRG,PSJREN,X,XX,PSGORDP,UDSTRING S PSGDRG=$P($G(^PS(55,PSGP,5,+PSGORD,1,1,0)),"^"),PSJREN=1
"RTN","PSJCOMR",44,0)
 ;D OC55
"RTN","PSJCOMR",45,0)
 Q:$D(PSGORQF)  ; quit if not to continue
"RTN","PSJCOMR",46,0)
 D NOW^%DTC S PSGDT=%,PSGND4=$G(^PS(55,PSGP,5,+PSGORD,4)) I '$P(PSJSYSP0,"^",3) D MARK Q
"RTN","PSJCOMR",47,0)
 S PSGWLL=$S('$P(PSJSYSW0,"^",4):0,1:+$G(^PS(55,PSGP,5.1))),PSGOEE="R" K PSGOEOS
"RTN","PSJCOMR",48,0)
 K ^PS(53.45,PSJSYSP,1),^(2) D MOVE(3,1),MOVE(1,2)
"RTN","PSJCOMR",49,0)
 D DATE^PSGOER0(PSGP,PSGORD,PSGDT) I '$D(PSGFOK(106)) D DONE,ABORT^PSGOEE S VALMBCK="R" Q
"RTN","PSJCOMR",50,0)
 W !!,"...updating order..." N PSGOEAV S PSGOEAV=+PSJSYSU,PSGOORD=PSGORD,PSGOER1=$G(^PS(55,PSGP,5,+PSGORD,.2)),PSGSI=$G(^(6)) W "."
"RTN","PSJCOMR",51,0)
 S PSGMR=$P(PSGOER0,"^",3),PSGSM=$P(PSGOER0,"^",5),PSGHSM=$P(PSGOER0,"^",6)
"RTN","PSJCOMR",52,0)
 S PSGMRN=$$ENMRN^PSGMI(PSGMR),PSGPDRGN=$$ENPDN^PSGMI(PSGPDRG),PSGDO=$P(PSGOER1,"^",2),PSGSCH=$P(PSGOER2,"^")
"RTN","PSJCOMR",53,0)
 S PSGS0Y=$P(PSGOER2,"^",5),PSGS0XT=$P(PSGOER2,"^",6),PSGNESD=PSGSD,PSGNEFD=PSGFD
"RTN","PSJCOMR",54,0)
 S:PSJPWD'=$P(PSGOER2,U,10) PSGS0Y=$$ENRNAT^PSGOU($P(PSGOER2,U,10),+PSJPWD,PSGSCH,PSGS0Y)
"RTN","PSJCOMR",55,0)
 S UDSTRING=PSGP_"^"_PSGORD_"^"_PSGDT_"^"_PSGOEPR_"^"_PSGOFD_"^"_PSGFD_"^"_PSJNOO F II=1:1:$L(UDSTRING,"^") I $P(UDSTRING,"^",II)="" K UDSTRING
"RTN","PSJCOMR",56,0)
 I '$D(UDSTRING) S COMQUIT=1 Q
"RTN","PSJCOMR",57,0)
 S:$G(DUZ) UDSTRING=UDSTRING_"^"_DUZ D TEMP(UDSTRING)
"RTN","PSJCOMR",58,0)
 Q
"RTN","PSJCOMR",59,0)
 ;
"RTN","PSJCOMR",60,0)
FILEUD ;
"RTN","PSJCOMR",61,0)
 ;Changed the reference to the type "O" for order numbers previously in v4.5
"RTN","PSJCOMR",62,0)
 N X,PSJORD,PSGOERDP,PSGOREAS,PSGRZERO S PSJORD=PSGORD K PSJPREX
"RTN","PSJCOMR",63,0)
 ;Make sure Admin times for parent don't carry to children;BHW;PSJ*5*136
"RTN","PSJCOMR",64,0)
 S X=$$LS^PSSLOCK(PSGP,PSGORD)  S PSGRTWO=^PS(55,+$G(PSGP),5,+PSGORD,2) S PSGRZERO="^PS(55,"_PSGP_",5,"_+PSGORD_",0)",PSGOREAS=$P(@(PSGRZERO),"^",24) D
"RTN","PSJCOMR",65,0)
 . S (PSGAT,PSGS0Y)=$P(PSGRTWO,"^",5)
"RTN","PSJCOMR",66,0)
 . S $P(@PSGRZERO,"^",24)="R" D UPDREN^PSGOER(PSGORD,PSGDT,PSGOEPR,PSGOFD,PSJNOO,$G(TMPDUZ)),UPDRENOE^PSGOER(PSGP,PSGORD) S $P(@PSGRZERO,"^",24)=PSGOREAS
"RTN","PSJCOMR",67,0)
 I +$G(PSJSYSU)=3,$G(PSJCOM) D CMPLX2^PSJCOM1(PSGP,PSJCOM,PSGORD) I $G(PSGPXN) S PSJPREX=1
"RTN","PSJCOMR",68,0)
 W !!,"...updating order..." K DA S DA(1)=PSGP,DA=+PSGORD,PSGAL("C")=PSJSYSU*10+18000 D ^PSGAL5 W "."
"RTN","PSJCOMR",69,0)
 I '$G(PSGOERDP),$P(PSJSYSW0,"^",4) I $G(PSGFD),$G(PSGWLL),(PSGFD'<PSGWLL) S $P(^PS(55,PSGP,5.1),"^")=+PSGFD
"RTN","PSJCOMR",70,0)
 D UNL^PSSLOCK(PSGP,PSGORD)
"RTN","PSJCOMR",71,0)
 W ".DONE!" S VALMBCK="Q"
"RTN","PSJCOMR",72,0)
 Q
"RTN","PSJCOMR",73,0)
 ;
"RTN","PSJCOMR",74,0)
MARK ;
"RTN","PSJCOMR",75,0)
 I $P(PSGND4,"^",15),$P(PSGND4,"^",16) W $C(7),!!?3,"...THIS ORDER IS ALREADY MARKED FOR RENEWAL!..." Q
"RTN","PSJCOMR",76,0)
 K DA S $P(PSGND4,"^",15,17)="1^"_DUZ_"^"_PSGDT,^PS(55,PSGP,5,+PSGORD,4)=PSGND4,PSGAL("C")=13180,DA(1)=PSGP,DA=+PSGORD W "." D ^PSGAL5
"RTN","PSJCOMR",77,0)
 I $D(PSJSYSO) S PSGORD=+PSGORD_"A",PSGPOSA="R",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSJCOMR",78,0)
 Q
"RTN","PSJCOMR",79,0)
MOVE(X,Y) ; Move comments/dispense drugs from 55 to 53.45.
"RTN","PSJCOMR",80,0)
 S Q=0 F  S Q=$O(^PS(55,PSGP,5,+PSGORD,X,Q)) Q:'Q  S ^PS(53.45,PSJSYSP,Y,Q,0)=$G(^(Q,0))
"RTN","PSJCOMR",81,0)
 S:Q ^PS(53.45,Y,0)="^53.450"_Y_"P^"_Q_U_Q
"RTN","PSJCOMR",82,0)
 Q
"RTN","PSJCOMR",83,0)
OC55 ;* Order checks for Speed finish and regular finish
"RTN","PSJCOMR",84,0)
 N INTERVEN,PSJDDI,PSJIREQ,PSJRXREQ,PSJPDRG,PSJDD,PSJALLGY
"RTN","PSJCOMR",85,0)
 S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)=""
"RTN","PSJCOMR",86,0)
 F PSGDDI=0:0 S PSGDDI=$O(^PS(55,PSGP,5,+PSGORD,1,PSGDDI)) Q:'PSGDDI  D
"RTN","PSJCOMR",87,0)
 . S PSJDD=+$G(^PS(55,PSGP,5,+PSGORD,1,PSGDDI,0))
"RTN","PSJCOMR",88,0)
 . S PSJALLGY(PSJDD)=""
"RTN","PSJCOMR",89,0)
 K PSGORQF D ENDDC^PSGSICHK(PSGP,PSJDD)
"RTN","PSJCOMR",90,0)
 Q
"RTN","PSJCOMR",91,0)
 ;
"RTN","PSJCOMR",92,0)
RIV ; Renew order.
"RTN","PSJCOMR",93,0)
 Q:'PSJCOM  N PSGORD,TMPP,TMPO S (TMPP,TMPO)=0 K PS55ACX M PS55ACX(55,"ACX",PSJCOM)=^PS(55,"ACX",PSJCOM)
"RTN","PSJCOMR",94,0)
 F  S TMPP=$O(PS55ACX(55,"ACX",PSJCOM,TMPP)) Q:'TMPP  S TMPO=0 F  S TMPO=$O(PS55ACX(55,"ACX",PSJCOM,TMPP,TMPO)) Q:TMPO=""  D
"RTN","PSJCOMR",95,0)
 . S PSGORD=TMPO D:PSGORD["U" NEWUD  D:PSGORD["V" NEWIV
"RTN","PSJCOMR",96,0)
 Q
"RTN","PSJCOMR",97,0)
NEWIV ;Renew complex IV orders
"RTN","PSJCOMR",98,0)
 N X,XX
"RTN","PSJCOMR",99,0)
 I P(17)="D",P(12) N ERR D RI W:$G(ERR)=1 $C(7),"  Order unchanged." Q:$G(ERR)<2
"RTN","PSJCOMR",100,0)
 K PSGORQF S PSIVRNFG=1 D ORDCHK^PSJLIFN K PSIVRNFG Q:$G(PSGORQF)  W !
"RTN","PSJCOMR",101,0)
 I $G(PSGORD)["V" S ON55=PSGORD S P("OLDON")=$P(^PS(55,DFN,"IV",+PSGORD,2),"^",5) S:'P("OLDON") P("OLDON")=ON55
"RTN","PSJCOMR",102,0)
 ;
"RTN","PSJCOMR",103,0)
R1 N PSIVND0,PSIVND2,PSIVREAS,PSIVOFD,IVSTRING,P2,PSJBKDR S PSJBKDR=1
"RTN","PSJCOMR",104,0)
 S P("NEWON")=ON55,(PSIVOK,EDIT)="25^1",P2=P(2) S P(2)=$$DATE^PSJUTL2 D EDIT^PSIVEDT S P(2)=P2 I X="^" D RD Q
"RTN","PSJCOMR",105,0)
 S:+VAIN(4)'=$P($G(^PS(55,DFN,"IV",+P("OLDON"),2)),U,10) P(11)=$$ENRNAT^PSGOU($P($G(^PS(55,DFN,"IV",+P("OLDON"),2)),U,10),+VAIN(4),P(9),P(11))
"RTN","PSJCOMR",106,0)
 S PSIVCHG=2
"RTN","PSJCOMR",107,0)
 D OK G:X["N" R1 I X=U D RD Q
"RTN","PSJCOMR",108,0)
 S P(17)="A",P("RES")="R",P("FRES")="" D:'$D(PSJIVORF) ORPARM^PSIVOREN I PSJIVORF D  Q:'$D(P("NAT"))
"RTN","PSJCOMR",109,0)
 .D NATURE^PSIVOREN I '$D(P("NAT")) D RD S COMQUIT=1 Q
"RTN","PSJCOMR",110,0)
 .S ON=ON55 ;D SET^PSIVORFE
"RTN","PSJCOMR",111,0)
 S P(16)="",PSJORIFN="",PSIVACT=1,P("21FLG")="",PSIVOFD=$P($G(^PS(55,DFN,"IV",+PSGORD,0)),"^",3)
"RTN","PSJCOMR",112,0)
 S IVSTRING=DFN_"^"_ON55_"^"_$$DATE^PSJUTL2()_"^"_+$G(P(6))_"^"_PSIVOFD_"^"_P(3)_"^"_P("NAT") F II=1:1:$L(IVSTRING,"^") I $P(IVSTRING,"^",II)="" K IVSTRING
"RTN","PSJCOMR",113,0)
 I '$D(IVSTRING) S COMQUIT=1 Q
"RTN","PSJCOMR",114,0)
 S:$G(DUZ) IVSTRING=IVSTRING_"^"_DUZ D TEMP(IVSTRING)
"RTN","PSJCOMR",115,0)
 Q
"RTN","PSJCOMR",116,0)
 ;
"RTN","PSJCOMR",117,0)
FILEIV ;
"RTN","PSJCOMR",118,0)
 N X,ON,ON55,PSJORD,P,PSIVTMP,PSIVZERO,OREAS
"RTN","PSJCOMR",119,0)
 S X=$$LS^PSSLOCK(DFN,+PSGORD_"V") S PSIVZERO="^PS(55,"_DFN_",""IV"","_+PSGORD_",0)" S PSIVTMP0=$G(@PSIVZERO) Q:'PSIVTMP0
"RTN","PSJCOMR",120,0)
 S PSIVTMP2="^PS(55,"_DFN_",""IV"","_+PSGORD_",2)",OREAS=$P(PSIVTMP2,"^",8),$P(@PSIVTMP2,"^",8)="R"
"RTN","PSJCOMR",121,0)
 F I=1:1:$L(PSIVTMP0,"^") S P(I)=$P(PSIVTMP0,"^",I)
"RTN","PSJCOMR",122,0)
 S (ON,ON55,PSJORD)=PSGORD,P(3)=PSGFD,P(6)=PSGOEPR,P("NAT")=PSJNOO,PSIVOFD=PSGOFD D RUPDATE^PSIVOREN(DFN,ON55,P(2))
"RTN","PSJCOMR",123,0)
 Q:'PSJIVORF
"RTN","PSJCOMR",124,0)
 D EN1^PSJHL2(DFN,"SN",+ON55_"V","ORDER RENEWED")
"RTN","PSJCOMR",125,0)
 S OD=P(2) D EN^PSIVORE
"RTN","PSJCOMR",126,0)
 D VF1^PSJLIACT("","",0),UNL^PSSLOCK(DFN,+ON55_"V") S $P(@PSIVTMP2,"^",8)=OREAS
"RTN","PSJCOMR",127,0)
 D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,"R")
"RTN","PSJCOMR",128,0)
 Q
"RTN","PSJCOMR",129,0)
 ;
"RTN","PSJCOMR",130,0)
TEMP(VARS) ;
"RTN","PSJCOMR",131,0)
 Q:'PSJCOM  S ^TMP("PSJCOMR",$J,PSJCOM,PSGORD)=VARS
"RTN","PSJCOMR",132,0)
 Q
"RTN","PSJCOMR",133,0)
 ;
"RTN","PSJCOMR",134,0)
RD ; Delete for renew.
"RTN","PSJCOMR",135,0)
 D DEL55^PSIVORE2 S (ON55,P("PON"))=P("OLDON") D GT55^PSIVORFB
"RTN","PSJCOMR",136,0)
 Q
"RTN","PSJCOMR",137,0)
 ;
"RTN","PSJCOMR",138,0)
OK ;Print example label, run order through checker, ask if it is ok.
"RTN","PSJCOMR",139,0)
 S P16=0,PSIVEXAM=1,(PSIVNOL,PSIVCT)=1 D GTOT^PSIVUTL(P(4)) I ($G(P("PD"))="") D GTPD^PSIVORE2
"RTN","PSJCOMR",140,0)
 D ^PSIVCHK I $D(DUOUT) S X="^" Q
"RTN","PSJCOMR",141,0)
 I ERR=1 S X="N" Q
"RTN","PSJCOMR",142,0)
 W ! D ^PSIVORLB K PSIVEXAM S Y=P(2) W !,"Start date: " X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),?30," Stop date: " S Y=P(3) X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),!
"RTN","PSJCOMR",143,0)
 D EFDIV^PSJUTL($G(ZZND))
"RTN","PSJCOMR",144,0)
 S X="Is this O.K.: ^"_$S(ERR:"N",1:"Y")_"^^NO"_$S(ERR'=1:",YES",1:"") D ENQ^PSIV I X["?" S HELP="OK" D ^PSIVHLP G OK
"RTN","PSJCOMR",145,0)
 Q
"RTN","PSJCOMR",146,0)
 ;
"RTN","PSJCOMR",147,0)
RI ; Reinstate Auto-DC'ed order.
"RTN","PSJCOMR",148,0)
 N DA,DIE,DIR,DIU,DR,PSIVACT,PSIVALT,PSIVALCK,PSIVREA W !!,$C(7),"This order has been Auto-DC'ed."
"RTN","PSJCOMR",149,0)
 S DIR(0)="Y",DIR("A")="Reinstate this order" D ^DIR K DIR I 'Y S ERR=1 Q
"RTN","PSJCOMR",150,0)
 D NOW^%DTC I %>$P($G(^PS(55,DFN,"IV",+ON55,2)),U,7) D
"RTN","PSJCOMR",151,0)
 .K DIR S ERR=1,DIR(0)="Y",DIR("A",1)="The original stop date of this order has past.",DIR("A")="Do you wish to renew this order" D ^DIR K DIR S ERR=$S(Y:2,1:1)
"RTN","PSJCOMR",152,0)
 Q:$G(ERR)  S X=$G(^VA(200,+P(6),"PS")) I $S('X:1,'$P(X,U,4):0,DT<$P(X,U,4):0,1:1) S ERR=1
"RTN","PSJCOMR",153,0)
 I $G(ERR) W !!,$C(7),"This order's provider is no longer valid. Please enter a valid provider." S (EDIT,PSIVOK)=1 D EDIT^PSIVEDT I $G(DONE) W $C(7),"Order unchanged." S ERR=1 Q
"RTN","PSJCOMR",154,0)
 N PSGALO S PSGALO=18530 D ENARI^PSIVOPT(DFN,ON,DUZ,PSGALO)
"RTN","PSJCOMR",155,0)
 Q
"RTN","PSJCOMR",156,0)
 ;
"RTN","PSJCOMR",157,0)
ABORT ; No changes
"RTN","PSJCOMR",158,0)
 W !!,$C(7),"No changes made to this order." D PAUSE^VALM1 K PSGOEEF S PSGOEEF=0
"RTN","PSJCOMR",159,0)
 Q
"RTN","PSJGMRA")
0^27^B17486425
"RTN","PSJGMRA",1,0)
PSJGMRA ;BIR/MV - Retrieve and display Allergy data ;6 Jun 07 / 3:37 PM
"RTN","PSJGMRA",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**181**;16 DEC 97;Build 190
"RTN","PSJGMRA",3,0)
 ;
"RTN","PSJGMRA",4,0)
 ; Reference to ^PS(50.605 is supported by DBIA 696.
"RTN","PSJGMRA",5,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSJGMRA",6,0)
 ; Reference to ^TMP("GMRAOC" supported by DBIA 4848.
"RTN","PSJGMRA",7,0)
 ; Reference to GETDATA^GMRAOR supported by DBIA 4847.
"RTN","PSJGMRA",8,0)
 ;
"RTN","PSJGMRA",9,0)
EN(DFN,PSJDD) ;
"RTN","PSJGMRA",10,0)
 ;DFN - Patient IEN
"RTN","PSJGMRA",11,0)
 ;PSJDD - ^PSDRUG IEN
"RTN","PSJGMRA",12,0)
 NEW PTR,GMRAING,PSJACK,PSJCLCNT,PSJFLG,PSJVACL,DIW,DIWF,DIWI,DIWL,DIWR,DIWT,DIWTC,DIWX,PSJNEW
"RTN","PSJGMRA",13,0)
 Q:'+$G(DFN)
"RTN","PSJGMRA",14,0)
 Q:'+$G(PSJDD)
"RTN","PSJGMRA",15,0)
 K ^TMP("GMRAOC",$J),^TMP($J,"PSJCLS"),PSJVACL
"RTN","PSJGMRA",16,0)
 S PSJACK=0
"RTN","PSJGMRA",17,0)
 S PTR=$P($G(^PSDRUG(PSJDD,"ND")),U)_"."_$P($G(^PSDRUG(PSJDD,"ND")),U,3)
"RTN","PSJGMRA",18,0)
 I +PTR S PSJACK=$$NDF()
"RTN","PSJGMRA",19,0)
 S PSJCLCNT=$$CLASS()
"RTN","PSJGMRA",20,0)
 D DISP
"RTN","PSJGMRA",21,0)
 K ^TMP("GMRAOC",$J),^TMP($J,"PSJCLS")
"RTN","PSJGMRA",22,0)
 Q
"RTN","PSJGMRA",23,0)
NDF() ;Process NDF drug
"RTN","PSJGMRA",24,0)
 NEW PSJLP
"RTN","PSJGMRA",25,0)
 S PSJACK=0
"RTN","PSJGMRA",26,0)
 K ^TMP("GMRAOC",$J)
"RTN","PSJGMRA",27,0)
 S PSJACK=$$ORCHK^GMRAOR(DFN,"DR",PTR)
"RTN","PSJGMRA",28,0)
 Q PSJACK
"RTN","PSJGMRA",29,0)
CLASS() ;
"RTN","PSJGMRA",30,0)
 NEW PSJLEN,PSJLOC,PSJCLCHK,PSJCLNM,PSJDDCL
"RTN","PSJGMRA",31,0)
 S PSJDDCL=$P($G(^PSDRUG(+PSJDD,0)),U,2)
"RTN","PSJGMRA",32,0)
 S PSJLEN=4,PSJCLCNT=0
"RTN","PSJGMRA",33,0)
 I $E(PSJDDCL,1,4)="CN10" S PSJLEN=5 ;look at 5 chars if ANALGESICS
"RTN","PSJGMRA",34,0)
 ;
"RTN","PSJGMRA",35,0)
 K GMRADRCL,^TMP("GMRAOC",$J,"APC"),^TMP($J,"PSJCLS")
"RTN","PSJGMRA",36,0)
 D GETDATA^GMRAOR(DFN)
"RTN","PSJGMRA",37,0)
 I '$D(^TMP("GMRAOC",$J,"APC")) Q 0
"RTN","PSJGMRA",38,0)
 ;
"RTN","PSJGMRA",39,0)
 S PSJVACL="" F  S PSJVACL=$O(^TMP("GMRAOC",$J,"APC",PSJVACL)) Q:PSJVACL=""  D
"RTN","PSJGMRA",40,0)
 . S PSJLOC=^TMP("GMRAOC",$J,"APC",PSJVACL),PSJCLNM=$P(^PS(50.605,+$O(^PS(50.605,"B",PSJVACL,0)),0),U,2)
"RTN","PSJGMRA",41,0)
 . S PSJVACL(PSJVACL)=PSJVACL_U_PSJCLNM_" ("_PSJLOC_")"
"RTN","PSJGMRA",42,0)
 . S PSJCLCNT=PSJCLCNT+1
"RTN","PSJGMRA",43,0)
 ;
"RTN","PSJGMRA",44,0)
 S PSJCLCHK=0,PSJVACL="" F  S PSJVACL=$O(PSJVACL(PSJVACL)) Q:PSJVACL=""  D
"RTN","PSJGMRA",45,0)
 .I $E(PSJDDCL,1,PSJLEN)=$E(PSJVACL,1,PSJLEN) D
"RTN","PSJGMRA",46,0)
 .. S PSJCLCHK=PSJCLCHK+1
"RTN","PSJGMRA",47,0)
 .. S ^TMP($J,"PSJCLS",PSJCLCHK)=PSJVACL_" "_$P(PSJVACL(PSJVACL),"^",2)
"RTN","PSJGMRA",48,0)
 K ^TMP("GMRAOC",$J)
"RTN","PSJGMRA",49,0)
 Q PSJCLCHK
"RTN","PSJGMRA",50,0)
DISP ;
"RTN","PSJGMRA",51,0)
 NEW PSJLOC,PSJNIEN,PSJNM,PSJVACL,X,PSJX
"RTN","PSJGMRA",52,0)
 S PSJFLG=0
"RTN","PSJGMRA",53,0)
 S PSJX=$O(^TMP("GMRAOC",$J,"APC",""))
"RTN","PSJGMRA",54,0)
 I '$G(PSJACK)&'$G(PSJCLCNT) Q
"RTN","PSJGMRA",55,0)
 S PSJFLG=1
"RTN","PSJGMRA",56,0)
 W $C(7),!!,"A Drug-Allergy Reaction exists for this medication and/or class!"
"RTN","PSJGMRA",57,0)
 W !!,?3,"Drug: "_$P($G(^PSDRUG(PSJDD,0)),"^")
"RTN","PSJGMRA",58,0)
 I PSJACK D
"RTN","PSJGMRA",59,0)
 . S PSJX=""
"RTN","PSJGMRA",60,0)
 . F X=0:0 S X=$O(GMRAING(X)) Q:'X  D
"RTN","PSJGMRA",61,0)
 .. S PSJX=PSJX_$S(PSJX="":"",1:", ")_GMRAING(X)
"RTN","PSJGMRA",62,0)
 . I PSJX]"" W !?6,"Ingredients: " D MYWRITE^PSJMISC(PSJX,19,75)
"RTN","PSJGMRA",63,0)
 D:PSJCLCNT DISPCL
"RTN","PSJGMRA",64,0)
 D:PSJFLG INTERV("ALLERGY")
"RTN","PSJGMRA",65,0)
 Q
"RTN","PSJGMRA",66,0)
DISPCL ;Display class(es)
"RTN","PSJGMRA",67,0)
 NEW PSJX,X
"RTN","PSJGMRA",68,0)
 Q:'$D(^TMP($J,"PSJCLS"))
"RTN","PSJGMRA",69,0)
 S PSJX=""
"RTN","PSJGMRA",70,0)
 S PSJVACL="" F  S PSJVACL=$O(^TMP($J,"PSJCLS",PSJVACL)) Q:PSJVACL=""  D
"RTN","PSJGMRA",71,0)
 . S PSJX=PSJX_$S(PSJX="":"",1:", ")_^TMP($J,"PSJCLS",PSJVACL)
"RTN","PSJGMRA",72,0)
 . S PSJFLG=1
"RTN","PSJGMRA",73,0)
 I PSJX]"" D
"RTN","PSJGMRA",74,0)
 . W !,?6,"Drug Class: "
"RTN","PSJGMRA",75,0)
 . D MYWRITE^PSJMISC(PSJX,19,75)
"RTN","PSJGMRA",76,0)
 Q
"RTN","PSJGMRA",77,0)
 ;
"RTN","PSJGMRA",78,0)
INTERV(PSJRXREQ,PSJDD1) ;Prompt if user to log an intervention for significant interaction
"RTN","PSJGMRA",79,0)
 ;PSPRXREQ - intervention type
"RTN","PSJGMRA",80,0)
 ;PSJDD1 - Prospective drug name
"RTN","PSJGMRA",81,0)
 NEW DIR,DTOUT,DIRUT,DIROUT,DUOUT,Y,X
"RTN","PSJGMRA",82,0)
 I $G(PSGORQF)=1 Q
"RTN","PSJGMRA",83,0)
 S DIR(0)="SA^1:YES;0:NO",DIR("A")="Do you want to Intervene? ",DIR("B")="NO"
"RTN","PSJGMRA",84,0)
 I $G(PSJDD1)]"" S DIR("A")="Do you want to Intervene with "_PSJDD1_"? "
"RTN","PSJGMRA",85,0)
 W ! D ^DIR
"RTN","PSJGMRA",86,0)
 S DIR("?",1)="Answer 'YES' if you DO want to enter an intervention for this medication,"
"RTN","PSJGMRA",87,0)
 S DIR("?")="       'NO' if you DON'T want to enter an intervention for this medication,"
"RTN","PSJGMRA",88,0)
 I Y S PSGP=DFN D ^PSJRXI W !
"RTN","PSJGMRA",89,0)
 Q 
"RTN","PSJGMRA",90,0)
RINTERV(PSJRXREQ,PSJDD1) ;Prompt user to log an intervention for critical interaction
"RTN","PSJGMRA",91,0)
 ;PSPRXREQ - intervention type
"RTN","PSJGMRA",92,0)
 ;PSJDD1 - Prospective drug name
"RTN","PSJGMRA",93,0)
 NEW DIR,DTOUT,DIRUT,DIROUT,DUOUT,Y,X
"RTN","PSJGMRA",94,0)
 K PSGORQF
"RTN","PSJGMRA",95,0)
 S DIR(0)="SA^1:YES;0:NO",DIR("A")="Do you want to Continue? ",DIR("B")="NO"
"RTN","PSJGMRA",96,0)
 I $G(PSJDD1)]"" S DIR("A")="Do you want to Continue with "_PSJDD1_"? "
"RTN","PSJGMRA",97,0)
 S DIR("?",1)="Enter 'NO' if you wish to exit without continuing with the order,",DIR("?")="or 'YES' to continue with the order entry process."
"RTN","PSJGMRA",98,0)
 D ^DIR
"RTN","PSJGMRA",99,0)
 I 'Y S PSGORQF=1 S VALMBCK="R" Q
"RTN","PSJGMRA",100,0)
 I Y S PSGP=DFN D ^PSJRXI W !
"RTN","PSJGMRA",101,0)
 Q
"RTN","PSJHL5")
0^8^B32301721
"RTN","PSJHL5",1,0)
PSJHL5 ;BIR/LDT-ACTIONS ON HL7 MESSAGES FROM OE/RR ;28 Jan 98 / 3:34 PM
"RTN","PSJHL5",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,28,39,40,42,84,85,95,80,173,134,181**;16 DEC 97;Build 190
"RTN","PSJHL5",3,0)
 ;
"RTN","PSJHL5",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL5",5,0)
 ; Reference to EN^ORERR is supported by DBIA# 2187.
"RTN","PSJHL5",6,0)
 ; Reference to NURV^ALPBCBU is supported by DBIA# 4120.
"RTN","PSJHL5",7,0)
 ; Reference to UNESC^ORHLESC is supported by DBIA# 4922
"RTN","PSJHL5",8,0)
 ;
"RTN","PSJHL5",9,0)
ASSIGN ; number assigned, update ORDERS FILE ENTRY
"RTN","PSJHL5",10,0)
 S RXORDER=RXORDER_"0)"
"RTN","PSJHL5",11,0)
 I '$P($G(@RXORDER),U) S ORDCON="Invalid Pharmacy order number/Number Assign Msg" S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(ORDCON,.PSJMSG) Q
"RTN","PSJHL5",12,0)
 Q:'$P($G(@RXORDER),U)
"RTN","PSJHL5",13,0)
 I RXON["P",PSJHLDFN'=$P($G(@(RXORDER)),U,15) S ORDCON="Patient does not match/Number Assign Msg" S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(ORDCON,.PSJMSG) Q
"RTN","PSJHL5",14,0)
 I RXON["P",PSJHLDFN'=$P($G(@(RXORDER)),U,15) Q
"RTN","PSJHL5",15,0)
 S $P(@RXORDER,"^",21)=PSJORDER
"RTN","PSJHL5",16,0)
 Q
"RTN","PSJHL5",17,0)
 ;
"RTN","PSJHL5",18,0)
NURSEACK ;Nurse Acknowledgement of Pending Orders
"RTN","PSJHL5",19,0)
 I '$P($G(@(RXORDER_"0)")),U) S ORDCON="Invalid Pharmacy order number/Nurse Acknowledgement Msg" S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(ORDCON,.PSJMSG) Q
"RTN","PSJHL5",20,0)
 Q:'$P($G(@(RXORDER_"0)")),U)
"RTN","PSJHL5",21,0)
 I RXON["P",PSJHLDFN'=$P($G(@(RXORDER_"0)")),U,15) S ORDCON="Patient does not match/Nurse Acknowledgement Msg" S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(ORDCON,.PSJMSG) Q
"RTN","PSJHL5",22,0)
 I RXON["P",PSJHLDFN'=$P($G(@(RXORDER_"0)")),U,15) Q
"RTN","PSJHL5",23,0)
 I RXON["P" N STATUS S STATUS=$P($G(@(RXORDER_"0)")),U,9) D:STATUS="N" EN^PSJHLV(PSJHLDFN,RXON)
"RTN","PSJHL5",24,0)
 I RXON["P" N STATUS S STATUS=$P($G(@(RXORDER_"0)")),U,9) Q:STATUS="A"
"RTN","PSJHL5",25,0)
 N DIE,DA
"RTN","PSJHL5",26,0)
 S DIE=$S(RXON["N"!(RXON["P"):"^PS(53.1,",RXON["V":"^PS(55,"_PSJHLDFN_",""IV"",",1:"^PS(55,"_PSJHLDFN_",5,"),DA=+RXON,DA(1)=PSJHLDFN
"RTN","PSJHL5",27,0)
 S DR="16////"_NURSEACK_";17////"_ACKDATE S:RXON["U" DR=DR_";51////1" S:RXON["V" DR=DR_";143////1",PSIVACT=""
"RTN","PSJHL5",28,0)
 I RXON["U" D NEWUDAL^PSGAL5(PSJHLDFN,RXON,22010)
"RTN","PSJHL5",29,0)
 I RXON["P" D NEWNVAL^PSGAL5(RXON,22010)
"RTN","PSJHL5",30,0)
 S PSGNVF=1 D ^DIE
"RTN","PSJHL5",31,0)
 I RXON["V" NEW ON55,DFN,PSIVAL,PSIVREA,PSIVLN K PSIVACT D
"RTN","PSJHL5",32,0)
 . S ON55=RXON,DFN=PSJHLDFN,PSIVAL="ORDER VERIFIED BY NURSE",PSIVALT="",PSIVREA="V"
"RTN","PSJHL5",33,0)
 . D LOG^PSIVORAL
"RTN","PSJHL5",34,0)
 D:RXON["P" EN^PSJLOI(PSJHLDFN,RXON) D:RXON["U" EN2^PSJLOI(PSJHLDFN,RXON)
"RTN","PSJHL5",35,0)
 K:RXON["U" ^PS(55,"ANV",PSJHLDFN,+RXON)
"RTN","PSJHL5",36,0)
 I $T(NURV^ALPBCBU)'="" D NURV^ALPBCBU(PSJHLDFN,RXON)
"RTN","PSJHL5",37,0)
 Q
"RTN","PSJHL5",38,0)
 ;
"RTN","PSJHL5",39,0)
EDIT ;Edit orders thru OE/RR
"RTN","PSJHL5",40,0)
 N DA,DR,DIE,PREORDER,STPDT,PSIVACT,PSIVALT,ON55,PSIVREA,PSIVALCK,P,PSJFLD1,PSJFLD2,PSJFLD3
"RTN","PSJHL5",41,0)
 S PREORDER=$S((PREON["N")!(PREON["P"):"^PS(53.1,"_+PREON_",2)",PREON["V":"^PS(55,"_PSJHLDFN_",""IV"","_+PREON_",0)",1:"^PS(55,"_PSJHLDFN_",5,"_+PREON_",2)")
"RTN","PSJHL5",42,0)
 S STPDT=$S(PREON["V":$P($G(@PREORDER),"^",3),1:$P($G(@PREORDER),"^",4))
"RTN","PSJHL5",43,0)
 D NOW^%DTC
"RTN","PSJHL5",44,0)
 S DIE=$S(PREON["N"!(PREON["P"):"^PS(53.1,",PREON["V":"^PS(55,"_PSJHLDFN_",""IV"",",1:"^PS(55,"_PSJHLDFN_",5,"),DA=+PREON,DA(1)=+PSJHLDFN
"RTN","PSJHL5",45,0)
 S PSJFLD1="100////D;157////DF;116////^S X=STPDT;123////E;114////"_PSJORDER_";.03////"_%
"RTN","PSJHL5",46,0)
 S PSJFLD2="25////"_%_";28////DE;107////E;105////"_PSJORDER_";32////"_STPDT
"RTN","PSJHL5",47,0)
 S PSJFLD3="25////"_STPDT_";28////DE;136////DF;107////E;105////"_PSJORDER_";34////"_%
"RTN","PSJHL5",48,0)
 S DR=$S(PREON["V":PSJFLD1,((PREON["P")!(PREON["N")):PSJFLD2,1:PSJFLD3)
"RTN","PSJHL5",49,0)
 I PREON["U"!(PREON["A") S PSGAL("C")=4100 D ^PSGAL5
"RTN","PSJHL5",50,0)
 I PREON["V" S PSIVACT=1,PSIVALT=2,ON55=PREON,PSIVREA="D",PSIVALCK="STOP",P(3)=STPDT
"RTN","PSJHL5",51,0)
 D ^DIE,AUE^PSJHL6(PSJHLDFN,PREON)
"RTN","PSJHL5",52,0)
 I PREON["V" N DFN S DFN=PSJHLDFN D LOG^PSIVORAL
"RTN","PSJHL5",53,0)
 S PSJHLMTN="ORM",PSOC=$S((PREON["N")!(PREON["P"):"OC",1:"OD") D EN1^PSJHL2(PSJHLDFN,PSOC,PREON) S PSJHLMTN="ORR",PSOC="XO"
"RTN","PSJHL5",54,0)
 Q
"RTN","PSJHL5",55,0)
 ;
"RTN","PSJHL5",56,0)
EDITCK ;Check to see if PSJHLDFN passed matches PSJHLDFN in pending order.
"RTN","PSJHL5",57,0)
 I (PREON["N")!(PREON["P"),PSJHLDFN'=$P($G(^PS(53.1,+PREON,0)),U,15) D
"RTN","PSJHL5",58,0)
 . S ORDCON="Patient does not match/Edit Msg" S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(ORDCON,.PSJMSG)
"RTN","PSJHL5",59,0)
 . D EN1^PSJHLERR(PSJHLDFN,"UX",$P(ORDER,"^"),ORDCON) S QFLG=1
"RTN","PSJHL5",60,0)
 Q
"RTN","PSJHL5",61,0)
 ;        
"RTN","PSJHL5",62,0)
STATUS ;Check status of an order in response to a send order status request from CPRS.
"RTN","PSJHL5",63,0)
 N STATUS,STPDT,NODE,NODE2
"RTN","PSJHL5",64,0)
 S NODE=$G(@(RXORDER_"0)")),NODE2=$G(@(RXORDER_"2)"))
"RTN","PSJHL5",65,0)
 I 'NODE S PSREASON="Invalid Pharmacy order number" D  Q
"RTN","PSJHL5",66,0)
 .S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(PSREASON_"/Status Check",.PSJMSG)
"RTN","PSJHL5",67,0)
 .D EN1^PSJHLERR(PSJHLDFN,"DE",$P(ORDER,U),PSREASON)
"RTN","PSJHL5",68,0)
 S $P(@(RXORDER_"0)"),"^",21)=$P(ORDER,"^")
"RTN","PSJHL5",69,0)
 S STATUS=$S(RXON["V":$P(NODE,"^",17),1:$P(NODE,"^",9))
"RTN","PSJHL5",70,0)
 S STPDT=$S(RXON["V":$P(NODE,"^",3),1:$P(NODE2,"^",4))
"RTN","PSJHL5",71,0)
 D NOW^%DTC I RXON'["P" I "DEH"'[STATUS I STPDT<% D EXPIR^PSJHL6 Q
"RTN","PSJHL5",72,0)
 D EN1^PSJHL2(PSJHLDFN,"SC",RXON)
"RTN","PSJHL5",73,0)
 Q
"RTN","PSJHL5",74,0)
 ;
"RTN","PSJHL5",75,0)
FLAG ;Flag/Unflag orders
"RTN","PSJHL5",76,0)
 I '$P($G(@(RXORDER_"0)")),U) S ORDCON="Invalid Pharmacy order number/Flag Msg" S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(ORDCON,.PSJMSG) Q
"RTN","PSJHL5",77,0)
 Q:'$P($G(@(RXORDER_"0)")),U)
"RTN","PSJHL5",78,0)
 S DIE=$S(RXON["N"!(RXON["P"):"^PS(53.1,",RXON["V":"^PS(55,"_PSJHLDFN_",""IV"",",1:"^PS(55,"_PSJHLDFN_",5,"),DA=+RXON,DA(1)=PSJHLDFN
"RTN","PSJHL5",79,0)
 S DR=$S(PSJFLAG="FL":$S(RXON["V":"148////1",1:"124////1"),1:$S(RXON["V":"148////@",1:"124////@"))
"RTN","PSJHL5",80,0)
 D ^DIE
"RTN","PSJHL5",81,0)
 I $G(FLCMNT)]"" S FLCMNT=$$UNESC^ORHLESC(FLCMNT)
"RTN","PSJHL5",82,0)
 I RXON["U" S FLCMNT="COMMENTS: "_FLCMNT S:$L(FLCMNT)>52 FLCMNT=$E(FLCMNT,1,49)_"..." D NEWUDAL^PSGAL5(PSJHLDFN,+RXON,$S((PSJFLAG="FL")&(PSJYN="PHR"):7000,(PSJFLAG="UF")&(PSJYN="PHR"):7010,(PSJFLAG="FL")&(PSJYN=""):7020,1:7030),FLCMNT)
"RTN","PSJHL5",83,0)
 I RXON["V" N DFN,ON55,PSIVREA,PSIVAL S DFN=PSJHLDFN S PSIVALT="",ON55=RXON,PSIVREA=$S(PSJFLAG="FL":"G",1:"UG"),PSIVAL=$S(PSJYN="PHR":"FLAGGED BY PHARMACIST ",1:"FLAGGED BY CPRS ")_FLCMNT D LOG^PSIVORAL
"RTN","PSJHL5",84,0)
 I RXON["P" S FLCMNT="COMMENTS: "_FLCMNT S:$L(FLCMNT)>52 FLCMNT=$E(FLCMNT,1,49)_"..." D NEWNVAL^PSGAL5(+RXON,$S((PSJFLAG="FL")&(PSJYN="PHR"):7000,(PSJFLAG="UF")&(PSJYN="PHR"):7010,(PSJFLAG="FL")&(PSJYN=""):7020,1:7030),FLCMNT)
"RTN","PSJHL5",85,0)
 ;The ... on Unit Dose and Pending orders is because of the limitations in the DD of 53.1.
"RTN","PSJHL5",86,0)
 Q
"RTN","PSJHL6")
0^9^B31795642
"RTN","PSJHL6",1,0)
PSJHL6 ;BIR/LDT-ACTIONS ON HL7 MESSAGES FROM OE/RR (CONT) ;02 Mar 99 / 9:26 AM
"RTN","PSJHL6",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,11,27,34,40,42,51,59,88,98,181**;16 DEC 97;Build 190
"RTN","PSJHL6",3,0)
 ;
"RTN","PSJHL6",4,0)
 ; Reference to EN^ORERR is supported by DBIA# 2187.
"RTN","PSJHL6",5,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL6",6,0)
 ;
"RTN","PSJHL6",7,0)
CANCEL ;Cancel or Discontinue orders thru OE/RR
"RTN","PSJHL6",8,0)
 N DA,DR,DIE,STATUS,STPDT,NODE,NODE2,PSREASON,PSIVACT,PSIVALT,ON55,PSIVREA,PSIVALCK,P,PSJADC
"RTN","PSJHL6",9,0)
 S NODE=$G(@(RXORDER_"0)")),NODE2=$G(@(RXORDER_"2)"))
"RTN","PSJHL6",10,0)
 I 'NODE S PSREASON="Invalid Pharmacy order number" D  Q
"RTN","PSJHL6",11,0)
 .S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(PSREASON_"/DC Msg",.PSJMSG)
"RTN","PSJHL6",12,0)
 .D EN1^PSJHLERR(PSJHLDFN,$S(PSOC="CA":"UC",1:"UD"),$P(ORDER,U),PSREASON)
"RTN","PSJHL6",13,0)
 I RXON["P",PSJHLDFN'=$P(NODE,U,15) S ORDCON="Patient does not match/Discontinue Msg" D  Q
"RTN","PSJHL6",14,0)
 .S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(ORDCON,.PSJMSG)
"RTN","PSJHL6",15,0)
 .D EN1^PSJHLERR(PSJHLDFN,$S(PSOC="CA":"UC",1:"UD"),$P(ORDER,U),ORDCON)
"RTN","PSJHL6",16,0)
 S $P(@(RXORDER_"0)"),"^",21)=$P(ORDER,"^",1)
"RTN","PSJHL6",17,0)
 S STATUS=$S(RXON["V":$P(NODE,"^",17),1:$P(NODE,"^",9))
"RTN","PSJHL6",18,0)
 S STPDT=$S(RXON["V":$P(NODE,"^",3),1:$P(NODE2,"^",4))
"RTN","PSJHL6",19,0)
 I "AHNOPR"'[STATUS D @STATUS S PSREASON=PSREASON_" orders may not be "_$S(PSOC="CA":"cancelled",1:"discontinued") D EN1^PSJHL2(PSJHLDFN,$S(PSOC="CA":"UC",1:"UD"),RXON,PSREASON) Q
"RTN","PSJHL6",20,0)
 S:(RXON["A")!(RXON["U")!(RXON["V") DA(1)=PSJHLDFN,DA=+RXON
"RTN","PSJHL6",21,0)
 S PSJADC=$S($G(ORDCON)="A":"DA",1:"DP")
"RTN","PSJHL6",22,0)
 D NOW^%DTC
"RTN","PSJHL6",23,0)
 S DIE=$S(RXON["V":"^PS(55,"_PSJHLDFN_",""IV"",",(RXON["N")!(RXON["P"):"^PS(53.1,",1:"^PS(55,"_PSJHLDFN_",5,"),DA=+RXON
"RTN","PSJHL6",24,0)
 S DR=$S(RXON["V":"100////D;157////"_PSJADC_";116////^S X=STPDT;.03////",(RXON["N")!(RXON["P"):"28////D;25////",1:"25////^S X=STPDT;28////D;136////"_PSJADC_";34////")_$S($G(ORDCON)="A"&($G(PSJASTP)'=""):$G(PSJASTP),1:%)
"RTN","PSJHL6",25,0)
 I RXON["A"!(RXON["U") S PSGAL("C")=$S($G(ORDCON)="A":1040,1:4000) D ^PSGAL5
"RTN","PSJHL6",26,0)
 I RXON["V" S PSIVACT=1,PSIVALT=$S($G(ORDCON)="A":"",1:2),PSIVAL=$S($G(ORDCON)="A":"AUTO DISCONTINUED  (TREATING SPECIALTY TRANSFER)",1:""),ON55=RXON,PSIVREA="D",P(3)=STPDT
"RTN","PSJHL6",27,0)
 S:$G(ORDCON)="A" DR=$S(RXON["V":DR_";121////1",RXON["N"!(RXON["P"):DR_";42////1",1:DR_";49////1")
"RTN","PSJHL6",28,0)
 D ^DIE
"RTN","PSJHL6",29,0)
 S:$G(ORDCON)="A" $P(^PS(55,PSJHLDFN,5.1),"^")=""
"RTN","PSJHL6",30,0)
 I RXON["V" N DFN S DFN=PSJHLDFN D LOG^PSIVORAL
"RTN","PSJHL6",31,0)
 D EN1^PSJHL2(PSJHLDFN,$S(PSOC="CA":"CR",1:"DR"),RXON)
"RTN","PSJHL6",32,0)
 D NOW^%DTC I "ANR"[STATUS I STPDT<% D EXPIR Q
"RTN","PSJHL6",33,0)
 D AUE(PSJHLDFN,RXON)
"RTN","PSJHL6",34,0)
 Q
"RTN","PSJHL6",35,0)
 ;
"RTN","PSJHL6",36,0)
HOLD ;Place orders on hold thru OE/RR and check for expired orders
"RTN","PSJHL6",37,0)
 N DA,DR,DIE,STATUS,STPDT,NODE,NODE2,PSREASON,PSIVACT,PSIVALT,PSIVREA,ON55
"RTN","PSJHL6",38,0)
 S NODE=$G(@(RXORDER_"0)")),NODE2=$G(@(RXORDER_"2)"))
"RTN","PSJHL6",39,0)
 I 'NODE S PSREASON="Invalid Pharmacy order number" D  Q
"RTN","PSJHL6",40,0)
 .S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(PSREASON_"/Hold Msg",.PSJMSG)
"RTN","PSJHL6",41,0)
 .D EN1^PSJHLERR(PSJHLDFN,"UH",$P(ORDER,U),PSREASON)
"RTN","PSJHL6",42,0)
 S $P(@(RXORDER_"0)"),"^",21)=$P(ORDER,"^",1)
"RTN","PSJHL6",43,0)
 S STATUS=$S(RXON["V":$P(NODE,"^",17),1:$P(NODE,"^",9))
"RTN","PSJHL6",44,0)
 S STPDT=$S(RXON["V":$P(NODE,"^",3),1:$P(NODE2,"^",4))
"RTN","PSJHL6",45,0)
 D NOW^%DTC I "ANR"[STATUS I STPDT<% D EXPIR
"RTN","PSJHL6",46,0)
 I STATUS'="A" D @STATUS S PSREASON=PSREASON_" orders may not be placed on hold" D EN1^PSJHL2(PSJHLDFN,"UH",RXON,PSREASON) Q
"RTN","PSJHL6",47,0)
 I STATUS="A" D
"RTN","PSJHL6",48,0)
 .S DA(1)=PSJHLDFN,DA=+RXON
"RTN","PSJHL6",49,0)
 .S DIE=$S(RXON["V":"^PS(55,"_PSJHLDFN_",""IV"",",1:"^PS(55,"_PSJHLDFN_",5,")
"RTN","PSJHL6",50,0)
 .S DR=$S(RXON["V":"100////H;157////HP;120////1;149////1",1:"28////H;136////HP;56////1;59////A;59.1////1;60////@;61////@;62////@;58////"_%)
"RTN","PSJHL6",51,0)
 I RXON["A"!(RXON["U") S PSGAL("C")=8500 D ^PSGAL5
"RTN","PSJHL6",52,0)
 S:RXON["V" PSIVACT=1,PSIVALT=2,PSIVREA="H",ON55=RXON
"RTN","PSJHL6",53,0)
 D ^DIE
"RTN","PSJHL6",54,0)
 I RXON["V" N DFN S DFN=PSJHLDFN D LOG^PSIVORAL
"RTN","PSJHL6",55,0)
 D EN1^PSJHL2(PSJHLDFN,"HR",RXON)
"RTN","PSJHL6",56,0)
 D NOW^%DTC I "ANR"[STATUS I STPDT<% D EXPIR Q
"RTN","PSJHL6",57,0)
 D AUE(PSJHLDFN,RXON)
"RTN","PSJHL6",58,0)
 Q
"RTN","PSJHL6",59,0)
 ;
"RTN","PSJHL6",60,0)
UNHOLD ;Change status of orders placed on hold thru OE/RR & check for expired orders
"RTN","PSJHL6",61,0)
 N DA,DR,DIE,STATUS,STPDT,NODE,NODE2,NODE4,HFLAG,PSREASON,PSIVACT,PSIVALT,PSIVREA,ON55
"RTN","PSJHL6",62,0)
 S NODE=$G(@(RXORDER_"0)")),NODE2=$G(@(RXORDER_"2)")),NODE4=$G(@(RXORDER_"4)"))
"RTN","PSJHL6",63,0)
 I 'NODE S PSREASON="Invalid Pharmacy order number" D  Q
"RTN","PSJHL6",64,0)
 .S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(PSREASON_"/Unhold Msg",.PSJMSG)
"RTN","PSJHL6",65,0)
 .D EN1^PSJHLERR(PSJHLDFN,"UR",$P(ORDER,U),PSREASON)
"RTN","PSJHL6",66,0)
 S $P(@(RXORDER_"0)"),"^",21)=$P(ORDER,"^",1)
"RTN","PSJHL6",67,0)
 S STATUS=$S(RXON["V":$P(NODE,"^",17),1:$P(NODE,"^",9))
"RTN","PSJHL6",68,0)
 S STPDT=$S(RXON["V":$P(NODE,"^",3),1:$P(NODE2,"^",4))
"RTN","PSJHL6",69,0)
 S HFLAG=$S(RXON["V":$P(NODE,"^",10),1:$P(NODE4,"^",26))
"RTN","PSJHL6",70,0)
 I 'HFLAG S PSREASON="Orders placed on hold by Pharmacy may not be removed from hold through CPRS." D EN1^PSJHL2(PSJHLDFN,"UR",RXON,PSREASON) Q
"RTN","PSJHL6",71,0)
 I "H"'[STATUS D @STATUS S PSREASON=PSREASON_" orders may not be taken off hold" D EN1^PSJHL2(PSJHLDFN,"UR",RXON,PSREASON) Q
"RTN","PSJHL6",72,0)
 I STATUS="H" S DA(1)=PSJHLDFN,DA=+RXON,DIE=$S(RXON["V":"^PS(55,"_PSJHLDFN_",""IV"",",1:"^PS(55,"_PSJHLDFN_",5,")
"RTN","PSJHL6",73,0)
 D NOW^%DTC
"RTN","PSJHL6",74,0)
 S DR=$S(RXON["V":"100////A;157////;120////@;149////@",1:"28////A;136////@;56////@;57////@;58////@;59////@;59.1////@;60////1;62////"_%)
"RTN","PSJHL6",75,0)
 I RXON["A"!(RXON["U") S PSGAL("C")=8000 D ^PSGAL5
"RTN","PSJHL6",76,0)
 S:RXON["V" PSIVACT=1,PSIVALT=2,PSIVREA="U",ON55=RXON
"RTN","PSJHL6",77,0)
 D ^DIE
"RTN","PSJHL6",78,0)
 I RXON["V" N DFN S DFN=PSJHLDFN D LOG^PSIVORAL
"RTN","PSJHL6",79,0)
 D EN1^PSJHL2(PSJHLDFN,"OR",RXON)
"RTN","PSJHL6",80,0)
 D NOW^%DTC I "A"[STATUS I STPDT<% D EXPIR Q
"RTN","PSJHL6",81,0)
 D AUE(PSJHLDFN,RXON)
"RTN","PSJHL6",82,0)
 Q
"RTN","PSJHL6",83,0)
EXPIR ;Change status of order to expired and send notice to OE/RR
"RTN","PSJHL6",84,0)
 N DA,DIE,DR,PSGPO,PSIVACT
"RTN","PSJHL6",85,0)
 S STATUS="E",(PSGPO,PSIVACT)=1,DA=+RXON,DA(1)=PSJHLDFN,DIE=$S(RXON["V":"^PS(55,"_PSJHLDFN_",""IV"",",1:"^PS(55,"_PSJHLDFN_",5,"),DR=$S(RXON["V":"100////E",1:"28////E") D ^DIE
"RTN","PSJHL6",86,0)
 S PSJHLMTN="ORM" D EN1^PSJHL2(PSJHLDFN,"SC",RXON) S PSJHLMTN="ORR"
"RTN","PSJHL6",87,0)
 ;D AUE(PSJHLDFN,RXON)
"RTN","PSJHL6",88,0)
 Q
"RTN","PSJHL6",89,0)
AUE(PSJHLDFN,ON)        ; Set "AUE" xref for 55.06 if hold/unhold
"RTN","PSJHL6",90,0)
 I ON["A"!(ON["U") S ^PS(55,"AUE",PSJHLDFN,+ON)=""
"RTN","PSJHL6",91,0)
 Q
"RTN","PSJHL6",92,0)
 ;
"RTN","PSJHL6",93,0)
A S PSREASON="Active" Q
"RTN","PSJHL6",94,0)
D S PSREASON="Discontinued" Q
"RTN","PSJHL6",95,0)
I S PSREASON="Incomplete" Q
"RTN","PSJHL6",96,0)
N S PSREASON="Non-verified" Q
"RTN","PSJHL6",97,0)
U S PSREASON="Unreleased" Q
"RTN","PSJHL6",98,0)
P S PSREASON="Pending" Q
"RTN","PSJHL6",99,0)
DE S PSREASON="Discontinued (edit)" Q
"RTN","PSJHL6",100,0)
E S PSREASON="Expired" Q
"RTN","PSJHL6",101,0)
H S PSREASON="Hold" Q
"RTN","PSJHL6",102,0)
R S PSREASON="Renewed" Q
"RTN","PSJHL6",103,0)
RE S PSREASON="Reinstated" Q
"RTN","PSJHL6",104,0)
DR S PSREASON="Discontinued (renewal)" Q
"RTN","PSJHL6",105,0)
O S PSREASON="On call" Q
"RTN","PSJHLU")
0^104^B34870321
"RTN","PSJHLU",1,0)
PSJHLU ;BIR/RLW-UTILITIES USED IN BUILDING HL7 SEGMENTS ;20 Apr 98 / 9:58 AM
"RTN","PSJHLU",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,56,72,102,134,181**;16 DEC 97;Build 190
"RTN","PSJHLU",3,0)
 ;
"RTN","PSJHLU",4,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJHLU",5,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJHLU",6,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSJHLU",7,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHLU",8,0)
 ;
"RTN","PSJHLU",9,0)
INIT ; set up HL7 application variables
"RTN","PSJHLU",10,0)
 S PSJHLSDT="PS",PSJHINST=$P($$SITE^VASITE(),"^")
"RTN","PSJHLU",11,0)
 S PSJCLEAR="K FIELD F J=0:1:LIMIT S FIELD(J)="""""
"RTN","PSJHLU",12,0)
 Q
"RTN","PSJHLU",13,0)
 ;
"RTN","PSJHLU",14,0)
SEGMENT(LIMIT) ;
"RTN","PSJHLU",15,0)
 K SEGMENT
"RTN","PSJHLU",16,0)
 N SUBSEG,SEGLENGT S SUBSEG=0,SEGMENT="" F J=0:1:LIMIT D
"RTN","PSJHLU",17,0)
 .I SEGMENT']"" S SEGMENT=FIELD(J) Q
"RTN","PSJHLU",18,0)
 .S SEGMENT=SEGMENT_"|"_FIELD(J)
"RTN","PSJHLU",19,0)
 F  S SEGLENGT=$L(SEGMENT) D  Q:$L(SEGMENT)'>246
"RTN","PSJHLU",20,0)
 .I SEGLENGT'>246 S SEGMENT(SUBSEG)=SEGMENT
"RTN","PSJHLU",21,0)
 .I SEGLENGT>245 S SEGMENT(SUBSEG)=$E(SEGMENT,1,245),SUBSEG=SUBSEG+1 D
"RTN","PSJHLU",22,0)
 ..S SEGMENT=$E(SEGMENT,246,SEGLENGT),SEGMENT(SUBSEG)=$E(SEGMENT,1,245)
"RTN","PSJHLU",23,0)
SET S PSJI=PSJI+1,^TMP("PSJHLS",$J,PSJHLSDT,PSJI)=SEGMENT(0)
"RTN","PSJHLU",24,0)
 F J=1:1 Q:'$D(SEGMENT(J))  S ^TMP("PSJHLS",$J,PSJHLSDT,PSJI,J)=SEGMENT(J)
"RTN","PSJHLU",25,0)
 Q
"RTN","PSJHLU",26,0)
 ;
"RTN","PSJHLU",27,0)
SEGMENT2 ; Retrieve text fields
"RTN","PSJHLU",28,0)
 K SEGMENT S JJ=0 F  S JJ=$O(@(PSJORDER_"12,"_JJ_")")) Q:'JJ  S SEGMENT(JJ-1)=$G(@(PSJORDER_"12,"_JJ_",0)"))
"RTN","PSJHLU",29,0)
 I $D(SEGMENT(0)) S SEGMENT(0)="NTE|6|L|"_$S($G(PSJBCBU):SEGMENT(0),1:$$ESC^ORHLESC(SEGMENT(0))) D
"RTN","PSJHLU",30,0)
 .D SET^PSJHLU K SEGMENT,JJ
"RTN","PSJHLU",31,0)
 I $P($G(@(PSJORDER_"6)")),"^")]"" K SEGMENT S SEGMENT(0)="NTE|21|L|"_$S($G(PSJBCBU):$P($G(@(PSJORDER_"6)")),"^"),1:$$ESC^ORHLESC($P($G(@(PSJORDER_"6)")),"^"))) D
"RTN","PSJHLU",32,0)
 .D SET^PSJHLU K SEGMENT
"RTN","PSJHLU",33,0)
 I PSJORDER["P",$P($G(@(PSJORDER_"9)")),"^",2)]"" K SEGMENT S SEGMENT(0)="NTE|21|L|"_$S($G(PSJBCBU):$P($G(@(PSJORDER_"9)")),"^",2),1:$$ESC^ORHLESC($P($G(@(PSJORDER_"9)")),"^",2))) D
"RTN","PSJHLU",34,0)
 .D SET^PSJHLU K SEGMENT
"RTN","PSJHLU",35,0)
 Q
"RTN","PSJHLU",36,0)
 ;
"RTN","PSJHLU",37,0)
CALL(HLEVN) ; call DHCP HL7 package -or- protocol, to pass Orders
"RTN","PSJHLU",38,0)
 ; HLEVN = number of segments in message
"RTN","PSJHLU",39,0)
 K CLERK,DDIEN,DDNUM,DOSEFORM,DOSEOR,FIELD,IVTYPE,LIMIT,NAME,NDNODE,NODE1,NODE2,PRODNAME,PROVIDER,PSGS0Y,PSJHINST,PSJHLSDT,PSJI,PSJORDER,PSOC,PSREASON,ROOMBED,SPDIEN,SEGMENT
"RTN","PSJHLU",40,0)
 I $G(PSJBCBU)=1 M PSJNAME=^TMP("PSJHLS",$J,"PS") Q
"RTN","PSJHLU",41,0)
 S PSJMSG="^TMP(""PSJHLS"",$J,""PS"")"
"RTN","PSJHLU",42,0)
 D MSG^XQOR("PS EVSEND OR",.PSJMSG)
"RTN","PSJHLU",43,0)
 Q
"RTN","PSJHLU",44,0)
 ;
"RTN","PSJHLU",45,0)
IVTYPE(PSJORDER) ; check whether a back-door order is Inpatient IV or IV fluid
"RTN","PSJHLU",46,0)
 I RXORDER["V",$P($G(@(PSJORDER_"0)")),"^",4)'="A" Q "I"
"RTN","PSJHLU",47,0)
 I RXORDER["P" I $P($G(@(PSJORDER_"0)")),"^",4)'="F" S IVTYPE="" Q IVTYPE
"RTN","PSJHLU",48,0)
 N SUB,AD,SOL,IVTYPE,NODE1 S SUB=0,IVTYPE="F"
"RTN","PSJHLU",49,0)
 ;naked reference on line below refers to the full indirect reference of PSJORDER_ which is from ^PS(55,DFN,"IV",PSJORD
"RTN","PSJHLU",50,0)
 F TYPE="AD","SOL" S SUB=0 F  S SUB=$O(@(PSJORDER_""""_TYPE_""""_","_SUB_")")) Q:(SUB="")!(IVTYPE="I")  S NODE1=$G(^(SUB,0)) Q:NODE1=""  D  Q:IVTYPE="I"
"RTN","PSJHLU",51,0)
 .I TYPE="AD" D
"RTN","PSJHLU",52,0)
 ..I '$P($G(^PS(52.6,$P(NODE1,"^"),0)),"^",13) S IVTYPE="I"
"RTN","PSJHLU",53,0)
 .D:TYPE="SOL"
"RTN","PSJHLU",54,0)
 ..S:'$P($G(^PS(52.7,$P(NODE1,"^"),0)),"^",13) IVTYPE="I"
"RTN","PSJHLU",55,0)
 Q IVTYPE
"RTN","PSJHLU",56,0)
ENI ;Calculate Frequency for IV orders
"RTN","PSJHLU",57,0)
 N INFUSE
"RTN","PSJHLU",58,0)
 I X?.E1L.E S INFUSE=$$ENLU^PSGMI(X) Q:(INFUSE="TITRATE")!(INFUSE="BOLUS")!($P(INFUSE," ")="INFUSE")!($P(INFUSE," ")="Infuse")
"RTN","PSJHLU",59,0)
 Q:(X="TITRATE")!(X="BOLUS")!($P(X," ")="INFUSE")!($P(X," ")="Infuse")
"RTN","PSJHLU",60,0)
 Q:$$INTRMT(X)
"RTN","PSJHLU",61,0)
 K:$L(X)<1!($L(X)>30)!(X["""")!($A(X)=45) X I '$D(X) Q
"RTN","PSJHLU",62,0)
 I X["=" D  Q   ; NOIS LOU-0501-42191
"RTN","PSJHLU",63,0)
 .N X2,X1 S X1=$P(X,"="),X2=$P(X,"=",2)
"RTN","PSJHLU",64,0)
 .I X1["ML/HR",(+X1=$P(X1,"ML/HR"))!(+X1=$P(X1," ML/HR")) D
"RTN","PSJHLU",65,0)
 ..S X1=$TR(X1,"ML/HR","ml/hr")
"RTN","PSJHLU",66,0)
 .I X2["ML/HR",(+X2=$P(X2,"ML/HR"))!(+X2=$P(X2," ML/HR")) D
"RTN","PSJHLU",67,0)
 ..S X2=$TR(X2,"ML/HR","ml/hr")
"RTN","PSJHLU",68,0)
 .I X1[" ml/hr",(+X1=$P(X1," ml/hr")) D
"RTN","PSJHLU",69,0)
 ..S X1=$P(X1," ml/hr")_$P(X1," ml/hr",2,9999)
"RTN","PSJHLU",70,0)
 .I X2[" ml/hr",(+X2=$P(X2," ml/hr")) D
"RTN","PSJHLU",71,0)
 ..S X2=$P(X2," ml/hr")_$P(X2," ml/hr",2,9999)
"RTN","PSJHLU",72,0)
 .I X1["ml/hr",(+X1=$P(X1,"ml/hr")) D
"RTN","PSJHLU",73,0)
 ..S X1=$P(X1,"ml/hr")_$P(X1,"ml/hr",2,9999)
"RTN","PSJHLU",74,0)
 .I X2["ml/hr",(+X2=$P(X2,"ml/hr")) D
"RTN","PSJHLU",75,0)
 ..S X2=$P(X2,"ml/hr")_$P(X2,"ml/hr",2,9999)
"RTN","PSJHLU",76,0)
 .I X2'=+X2 D
"RTN","PSJHLU",77,0)
 ..I ($P(X2,"@",2,999)'=+$P(X2,"@",2,999)!(+$P(X2,"@",2,999)<0)) K X Q
"RTN","PSJHLU",78,0)
 .I X1=+X1 S X1=X1_" ml/hr"
"RTN","PSJHLU",79,0)
 .I X2=+X2 S X2=X2_" ml/hr"
"RTN","PSJHLU",80,0)
 .S:$P(X2,"@")=+X2 $P(X2,"@")=$P(X2,"@")_" ml/hr"
"RTN","PSJHLU",81,0)
 .S X=X1_"="_X2
"RTN","PSJHLU",82,0)
 I X'=+X,($P($TR(X," ml/hr",""),"@",2,999)'=+$P($TR(X," ml/hr",""),"@",2,999)!(+$P(X,"@",2,999)<0)),($P(X," ml/hr")'=+$P(X," ml/hr")!(+$P(X," ml/hr")<0)) Q:(X>0&($E(X)=0))  K X Q
"RTN","PSJHLU",83,0)
 I X=+X!(X>0&($E(X)=0)) S:$S(X'["ml/hr":0,X["@":0,1:1) X=X_" ml/hr" D SPSOL S FREQ=$S('X:0,1:SPSOL\X*60+(SPSOL#X/X*60+.5)\1) K SPSOL Q
"RTN","PSJHLU",84,0)
 I X[" ml/hr" D SPSOL S FREQ=$S('X:0,1:SPSOL\X*60+(SPSOL#X/X*60+.5)\1) K SPSOL Q
"RTN","PSJHLU",85,0)
 S SPSOL=$P(X,"@",2) S:$P(X,"@")=+X $P(X,"@")=$P(X,"@")_" ml/hr" S FREQ=$S('SPSOL:0,1:1440/SPSOL\1) K SPSOL
"RTN","PSJHLU",86,0)
 Q
"RTN","PSJHLU",87,0)
SPSOL S SPSOL=+TVOLUME Q
"RTN","PSJHLU",88,0)
INTRMT(X) ;
"RTN","PSJHLU",89,0)
 Q:'$P(X," ") 0
"RTN","PSJHLU",90,0)
 Q:$P(X," ",2)="Minutes" 1
"RTN","PSJHLU",91,0)
 Q:$P(X," ",2)="Hours" 1
"RTN","PSJHLU",92,0)
 Q 0
"RTN","PSJHLU",93,0)
IVCAT(DFN,PSJORD,PARRAY) ; This returns the IV CATEGORY based on the IV TYPE and CHEMO TYPE (not what is already in the IV CATEGORY field)
"RTN","PSJHLU",94,0)
 ;  Passed in:  PSJORDER (file root of order)
"RTN","PSJHLU",95,0)
 N NODE,TYP,CHEMTYP,INTSYR,ND2P5
"RTN","PSJHLU",96,0)
 S (CHEMTYP,INTSYR)=""
"RTN","PSJHLU",97,0)
 S TYP=$G(P(4)),INTSYR=$G(P(5)),CHEMTYP=$G(P(23))
"RTN","PSJHLU",98,0)
 I TYP="",$G(PSJORD)["V" S NODE=$G(^PS(55,DFN,"IV",+PSJORD,0)) S TYP=$P(NODE,"^",4),INTSYR=$P(NODE,"^",5),CHEMTYP=$P(NODE,"^",23)
"RTN","PSJHLU",99,0)
 I TYP="",$G(PSJORD)["P" S NODE=$G(^PS(53.1,+PSJORD,8)) S TYP=$P(NODE,"^"),INTSYR=$P(NODE,"^",4),CHEMTYP=$P(NODE,"^",2)
"RTN","PSJHLU",100,0)
 I TYP="" S TYP=$G(PARRAY(4)),INTSYR=$G(PARRAY(5)),CHEMTYP=$G(PARRAY(23))
"RTN","PSJHLU",101,0)
 Q:$G(TYP)="" ""
"RTN","PSJHLU",102,0)
 S CAT=$S(",A,H,"[(","_TYP_","):"C",TYP="C"&(",A,H,S,"[(","_CHEMTYP_",")&'INTSYR):"C",TYP="C"&(CHEMTYP="P"):"I",TYP="S"&'INTSYR:"C",TYP="P":"I",$G(INTSYR):"I",1:"")
"RTN","PSJHLU",103,0)
 Q CAT
"RTN","PSJHLU",104,0)
ZRX ; Perform outbound processing
"RTN","PSJHLU",105,0)
 S LIMIT=6 X PSJCLEAR
"RTN","PSJHLU",106,0)
 S FIELD(0)="ZRX"
"RTN","PSJHLU",107,0)
 I '$G(PSJREN) N PREON,PSJREN I $G(PSJORD)["U"&($P(NODE1,"^",24)="R") S PSJREN=1
"RTN","PSJHLU",108,0)
 I $G(PSJORD)["V"&($P(NODE2,"^",8)="R") S PSJREN=1
"RTN","PSJHLU",109,0)
 S PREON=$S($G(PSJREN):$G(PSJORD),PSJORDER["IV":$P(NODE2,"^",5),1:$P(NODE1,"^",25))
"RTN","PSJHLU",110,0)
 S FIELD(1)=$S(PREON["P":$P($G(^PS(53.1,+PREON,0)),"^",21),PREON["V":$P($G(^PS(55,PSJHLDFN,"IV",+PREON,0)),"^",21),1:$P($G(^PS(55,PSJHLDFN,5,+PREON,0)),"^",21))
"RTN","PSJHLU",111,0)
 S FIELD(2)=$S(PSJORDER["IV":$G(P("NAT")),1:$G(PSJNOO))
"RTN","PSJHLU",112,0)
 S FIELD(3)=$S($G(PSJREN):"R",PSJORDER["IV":$P(NODE2,"^",8),1:$P(NODE1,"^",24))
"RTN","PSJHLU",113,0)
 I FIELD(3)="" I PSOC="SN" S FIELD(3)="N"
"RTN","PSJHLU",114,0)
 I $D(P)>1 S FIELD(6)=$$IVCAT^PSJHLU(PSJHLDFN,RXORDER,.P)
"RTN","PSJHLU",115,0)
 S NAME=$P($G(^VA(200,DUZ,0)),"^")
"RTN","PSJHLU",116,0)
 S FIELD(5)=DUZ_"^"_$S($G(PSJBCBU):NAME,1:$$ESC^ORHLESC(NAME))_"^"_"99NP"
"RTN","PSJHLU",117,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHLU",118,0)
 Q
"RTN","PSJHVARS")
0^52^B74499296
"RTN","PSJHVARS",1,0)
PSJHVARS ;BIR/RSB-SAVE/RESTORE VARIABLES FOR HIDDEN MENUS  ;24 Feb 99 / 10:42 AM
"RTN","PSJHVARS",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**16,22,30,58,181**;16 DEC 97;Build 190
"RTN","PSJHVARS",3,0)
 ;
"RTN","PSJHVARS",4,0)
 ; Reference to ^ORD(101 is supported by DBIA 872.
"RTN","PSJHVARS",5,0)
 ; Reference to ^%RCR is supported by DBIA 10022.
"RTN","PSJHVARS",6,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJHVARS",7,0)
 ;
"RTN","PSJHVARS",8,0)
 ; PSJ*5*181 added: P(24),P(25) & PSGS0Y (it's zero & not O)
"RTN","PSJHVARS",9,0)
 ;PSJHIDFG will be defined if the user already in the hidden menu.
"RTN","PSJHVARS",10,0)
 I $$HIDCHK() D  Q
"RTN","PSJHVARS",11,0)
 . W !,"HIDDEN MENUS MAY NOT BE CALLED RECURSIVELY!" S XQORQUIT=1
"RTN","PSJHVARS",12,0)
 . N DIR S DIR(0)="E" D ^DIR
"RTN","PSJHVARS",13,0)
 ;  saves the variables in ^TMP
"RTN","PSJHVARS",14,0)
 K ^TMP("PSJVARS",$J),^TMP("PSJ_ON_HIDDEN",$J)
"RTN","PSJHVARS",15,0)
 F PSJRSB1=1:1 S PSJRSBV=$P($T(LIST+PSJRSB1),";;",2) Q:PSJRSBV=""  D
"RTN","PSJHVARS",16,0)
 .I $D(@PSJRSBV) S:$D(@PSJRSBV)'=10 ^TMP("PSJVARS",$J,PSJRSBV)=@PSJRSBV
"RTN","PSJHVARS",17,0)
 I $D(DRG) MERGE ^TMP("PSJHDRG",$J)=DRG
"RTN","PSJHVARS",18,0)
 ;save off ^TMP("PSJON",$J) because it gets killed down in hidden options
"RTN","PSJHVARS",19,0)
 F PSJRSB1L=0:0 S PSJRSB1L=$O(^TMP("PSJON",$J,PSJRSB1L)) Q:'PSJRSB1L  D
"RTN","PSJHVARS",20,0)
 .S ^TMP("PSJ_ON_HIDDEN",$J,PSJRSB1L)=^TMP("PSJON",$J,PSJRSB1L)
"RTN","PSJHVARS",21,0)
 K PSJRSB1,PSJRSB1L,PSJRSBV
"RTN","PSJHVARS",22,0)
 NEW PSJX
"RTN","PSJHVARS",23,0)
 F PSJX="P(","PSGEFN(","PSGVADR(","PSGVALG(","VADM(","VAIN(","VAIP(" D SVARRAY
"RTN","PSJHVARS",24,0)
 I $D(^TMP("PSIV",$J)) S %X="^TMP(""PSIV"",$J,",%Y="^TMP(""PSJHTMP"",$J,""PSIV""," D %XY^%RCR
"RTN","PSJHVARS",25,0)
 I $D(^TMP("PSJALL",$J)) S %X="^TMP(""PSJALL"",$J,",%Y="^TMP(""PSJHTMP"",$J,""PSJALL""," D %XY^%RCR
"RTN","PSJHVARS",26,0)
 I $D(^TMP("PSJI",$J)) S %X="^TMP(""PSJI"",$J,",%Y="^TMP(""PSJHTMP"",$J,""PSJI""," D %XY^%RCR
"RTN","PSJHVARS",27,0)
 I $D(^TMP("PSJPRO",$J)) S %X="^TMP(""PSJPRO"",$J,",%Y="^TMP(""PSJHTMP"",$J,""PSJPRO""," D %XY^%RCR
"RTN","PSJHVARS",28,0)
 D SAVEPS ; Save the ^PS(53.45,DUZ,2) entry
"RTN","PSJHVARS",29,0)
 Q
"RTN","PSJHVARS",30,0)
SVARRAY ;  Save array to ^TMP
"RTN","PSJHVARS",31,0)
 NEW PSJVARX,X S PSJVARX=PSJX_"X)"
"RTN","PSJHVARS",32,0)
 S X="" F  S X=$O(@PSJVARX) Q:X=""  S ^TMP("PSJVARS",$J,PSJX_$S(+X=X:X,1:""""_X_"""")_")")=@PSJVARX
"RTN","PSJHVARS",33,0)
 Q
"RTN","PSJHVARS",34,0)
RESTORE ;  restores the variables from ^TMP
"RTN","PSJHVARS",35,0)
 Q:$G(PSJHIDFG)
"RTN","PSJHVARS",36,0)
 S PSJRSBV="" F  S PSJRSBV=$O(^TMP("PSJVARS",$J,PSJRSBV)) Q:PSJRSBV=""  D
"RTN","PSJHVARS",37,0)
 .S @PSJRSBV=^TMP("PSJVARS",$J,PSJRSBV)
"RTN","PSJHVARS",38,0)
 I $D(^TMP("PSJHDRG",$J)) K DRG MERGE DRG=^TMP("PSJHDRG",$J)
"RTN","PSJHVARS",39,0)
 ;restore ^TMP("PSJON",$J) if it is not there
"RTN","PSJHVARS",40,0)
 I '$D(^TMP("PSJON",$J)) D
"RTN","PSJHVARS",41,0)
 .F PSJRSB1=0:0 S PSJRSB1=$O(^TMP("PSJ_ON_HIDDEN",$J,PSJRSB1)) Q:'PSJRSB1  D
"RTN","PSJHVARS",42,0)
 ..S ^TMP("PSJON",$J,PSJRSB1)=^TMP("PSJ_ON_HIDDEN",$J,PSJRSB1)
"RTN","PSJHVARS",43,0)
 I $D(^TMP("PSJHTMP",$J,"PSIV")) S %X="^TMP(""PSJHTMP"",$J,""PSIV"",",%Y="^TMP(""PSIV"",$J," D %XY^%RCR K ^TMP("PSJHTMP",$J,"PSIV")
"RTN","PSJHVARS",44,0)
 I $D(^TMP("PSJHTMP",$J,"PSJALL")) S %X="^TMP(""PSJHTMP"",$J,""PSJALL"",",%Y="^TMP(""PSJALL"",$J," D %XY^%RCR K ^TMP("PSJHTMP",$J,"PSJALL")
"RTN","PSJHVARS",45,0)
 I $D(^TMP("PSJHTMP",$J,"PSJI")) S %X="^TMP(""PSJHTMP"",$J,""PSJI"",",%Y="^TMP(""PSJI"",$J," D %XY^%RCR K ^TMP("PSJHTMP",$J,"PSJI")
"RTN","PSJHVARS",46,0)
 I $D(^TMP("PSJHTMP",$J,"PSJPRO")) S %X="^TMP(""PSJHTMP"",$J,""PSJPRO"",",%Y="^TMP(""PSJPRO"",$J," D %XY^%RCR K ^TMP("PSJHTMP",$J,"PSJPRO")
"RTN","PSJHVARS",47,0)
 K ^TMP("PSJVARS",$J),^TMP("PSJ_ON_HIDDEN",$J),^TMP("PSJHDRG",$J)
"RTN","PSJHVARS",48,0)
 K PSJRSBV,PSJRSB1
"RTN","PSJHVARS",49,0)
 D RESPS ; Restore any saved ^PS(53.45,DUZ,2) and ^PS(53.45,DUZ,4) entries
"RTN","PSJHVARS",50,0)
 Q
"RTN","PSJHVARS",51,0)
HIDCHK() ;  XQORNEST(X) contains a list of selected protocols.
"RTN","PSJHVARS",52,0)
 K ^TMP("PSJHIDCHK",$J) N PSJ,X,Y
"RTN","PSJHVARS",53,0)
 F X=0:0 S X=$O(XQORNEST(X)) Q:'X  S ^TMP("PSJHIDCHK",$J,+$P(XQORNEST(X),";"))=""
"RTN","PSJHVARS",54,0)
 S X=+$O(^ORD(101,"B","PSJI LM LBLI",0))
"RTN","PSJHVARS",55,0)
 S Y=+$O(^ORD(101,"B","PSJ LM RETURNS/DESTROYED MENU",0))
"RTN","PSJHVARS",56,0)
 S PSJ=$S($D(^TMP("PSJHIDCHK",$J,X)):1,$D(^TMP("PSJHIDCHK",$J,Y)):1,1:0)
"RTN","PSJHVARS",57,0)
 K ^TMP("PSJHIDCHK",$J)
"RTN","PSJHVARS",58,0)
 Q PSJ
"RTN","PSJHVARS",59,0)
SAVEPS ; Save the ^PS(53.45,DUZ,2) entry
"RTN","PSJHVARS",60,0)
 ; Save the 2,0) node
"RTN","PSJHVARS",61,0)
 I $D(^PS(53.45,DUZ,2,0)) D
"RTN","PSJHVARS",62,0)
 .S ^TMP("PSJ5345",$J,DUZ,2,0)=^PS(53.45,DUZ,2,0)
"RTN","PSJHVARS",63,0)
 ;Save the 2,n,0) nodes
"RTN","PSJHVARS",64,0)
 S PSJLOOP=0
"RTN","PSJHVARS",65,0)
 F PSJLOOP=$O(^PS(53.45,DUZ,2,PSJLOOP)) Q:(PSJLOOP="")!(PSJLOOP="B")  D
"RTN","PSJHVARS",66,0)
 .S ^TMP("PSJ5345",$J,DUZ,2,PSJLOOP,0)=^PS(53.45,DUZ,2,PSJLOOP,0)
"RTN","PSJHVARS",67,0)
 ;Save the 2,"B" node
"RTN","PSJHVARS",68,0)
 I $D(^PS(53.45,DUZ,2,"B")) D
"RTN","PSJHVARS",69,0)
 .S PSJBLOOP=""
"RTN","PSJHVARS",70,0)
 .F PSJBLOOP=$O(^PS(53.45,DUZ,2,"B",PSJBLOOP)) Q:PSJBLOOP=""  D
"RTN","PSJHVARS",71,0)
 ..S PSJCOUNT=""
"RTN","PSJHVARS",72,0)
 ..F PSJCOUNT=$O(^PS(53.45,DUZ,2,"B",PSJBLOOP,PSJCOUNT)) Q:PSJCOUNT=""  D
"RTN","PSJHVARS",73,0)
 ...S ^TMP("PSJ5345",$J,DUZ,2,"B",PSJBLOOP,PSJCOUNT)=^PS(53.45,DUZ,2,"B",PSJBLOOP,PSJCOUNT)
"RTN","PSJHVARS",74,0)
 ; Save the 4,0) node
"RTN","PSJHVARS",75,0)
 ;I $D(^PS(53.45,DUZ,4,0)) D
"RTN","PSJHVARS",76,0)
 ;.S ^TMP("PSJ5345",$J,DUZ,4,0)=^PS(53.45,DUZ,4,0)
"RTN","PSJHVARS",77,0)
 ; Save the 4,n,0) nodes
"RTN","PSJHVARS",78,0)
 ;S PSJLOOP=0
"RTN","PSJHVARS",79,0)
 ;F PSJLOOP=$O(^PS(53.45,DUZ,4,PSJLOOP)) Q:PSJLOOP=""  D
"RTN","PSJHVARS",80,0)
 ;.S ^TMP("PSJ5345",$J,DUZ,4,PSJLOOP,0)=^PS(53.45,DUZ,4,PSJLOOP,0)
"RTN","PSJHVARS",81,0)
 Q
"RTN","PSJHVARS",82,0)
RESPS ; Restore any saved ^PS(53.45,DUZ,2) entry
"RTN","PSJHVARS",83,0)
 ;Restore the 2,0 node
"RTN","PSJHVARS",84,0)
 I $D(^TMP("PSJ5345",$J,DUZ,2,0)) D
"RTN","PSJHVARS",85,0)
 .S ^PS(53.45,DUZ,2,0)=^TMP("PSJ5345",$J,DUZ,2,0)
"RTN","PSJHVARS",86,0)
 ;Restore the 2,n,o) nodes
"RTN","PSJHVARS",87,0)
 S PSJLOOP=0
"RTN","PSJHVARS",88,0)
 F PSJLOOP=$O(^TMP("PSJ5345",$J,DUZ,2,PSJLOOP)) Q:(PSJLOOP="")!(PSJLOOP="B")  D
"RTN","PSJHVARS",89,0)
 .S ^PS(53.45,DUZ,2,PSJLOOP,0)=^TMP("PSJ5345",$J,DUZ,2,PSJLOOP,0)
"RTN","PSJHVARS",90,0)
 ;Restore the 2,"B" nodes
"RTN","PSJHVARS",91,0)
 I $D(^TMP("PSJ5345",$J,DUZ,2,"B")) D
"RTN","PSJHVARS",92,0)
 .S PSJBLOOP=""
"RTN","PSJHVARS",93,0)
 .F PSJBLOOP=$O(^TMP("PSJ5345",$J,DUZ,2,"B",PSJBLOOP)) Q:PSJBLOOP=""  D
"RTN","PSJHVARS",94,0)
 ..S PSJCOUNT=""
"RTN","PSJHVARS",95,0)
 ..F PSJCOUNT=$O(^TMP("PSJ5345",$J,DUZ,2,"B",PSJBLOOP,PSJCOUNT)) Q:PSJCOUNT=""  D
"RTN","PSJHVARS",96,0)
 ...S ^PS(53.45,DUZ,2,"B",PSJBLOOP,PSJCOUNT)=^TMP("PSJ5345",$J,DUZ,2,"B",PSJBLOOP,PSJCOUNT)
"RTN","PSJHVARS",97,0)
 ;Restore the 4,0) node
"RTN","PSJHVARS",98,0)
 ;I $D(^TMP("PSJ5345",$J,DUZ,4,0)) D
"RTN","PSJHVARS",99,0)
 ;.S ^PS(53.45,DUZ,4,0)=^TMP("PSJ5345",$J,DUZ,4,0)
"RTN","PSJHVARS",100,0)
 ;Restore the 4,n,0) nodes
"RTN","PSJHVARS",101,0)
 ;S PSJLOOP=0
"RTN","PSJHVARS",102,0)
 ;F PSJLOOP=$O(^TMP("PSJ5345",$J,DUZ,4,PSJLOOP)) Q:PSJLOOP=""  D
"RTN","PSJHVARS",103,0)
 ;.S ^PS(53.45,DUZ,4,PSJLOOP,0)=^TMP("PSJ5345",$J,DUZ,4,PSJLOOP,0)
"RTN","PSJHVARS",104,0)
 K ^TMP("PSJ5345",$J,DUZ)
"RTN","PSJHVARS",105,0)
 Q
"RTN","PSJHVARS",106,0)
LIST ;
"RTN","PSJHVARS",107,0)
 ;;ADM
"RTN","PSJHVARS",108,0)
 ;;AL
"RTN","PSJHVARS",109,0)
 ;;C
"RTN","PSJHVARS",110,0)
 ;;CHK
"RTN","PSJHVARS",111,0)
 ;;DDH
"RTN","PSJHVARS",112,0)
 ;;DFN
"RTN","PSJHVARS",113,0)
 ;;DN
"RTN","PSJHVARS",114,0)
 ;;DRGI
"RTN","PSJHVARS",115,0)
 ;;DRGN
"RTN","PSJHVARS",116,0)
 ;;DRGT
"RTN","PSJHVARS",117,0)
 ;;DX
"RTN","PSJHVARS",118,0)
 ;;DY
"RTN","PSJHVARS",119,0)
 ;;FIL
"RTN","PSJHVARS",120,0)
 ;;FQ
"RTN","PSJHVARS",121,0)
 ;;GMRA
"RTN","PSJHVARS",122,0)
 ;;GMRAL
"RTN","PSJHVARS",123,0)
 ;;HDT
"RTN","PSJHVARS",124,0)
 ;;I
"RTN","PSJHVARS",125,0)
 ;;INFUSE
"RTN","PSJHVARS",126,0)
 ;;J
"RTN","PSJHVARS",127,0)
 ;;LIMIT
"RTN","PSJHVARS",128,0)
 ;;LINE
"RTN","PSJHVARS",129,0)
 ;;LOC
"RTN","PSJHVARS",130,0)
 ;;N
"RTN","PSJHVARS",131,0)
 ;;NAD
"RTN","PSJHVARS",132,0)
 ;;ND
"RTN","PSJHVARS",133,0)
 ;;ND0
"RTN","PSJHVARS",134,0)
 ;;ND2
"RTN","PSJHVARS",135,0)
 ;;ND4
"RTN","PSJHVARS",136,0)
 ;;ND6
"RTN","PSJHVARS",137,0)
 ;;NDP2
"RTN","PSJHVARS",138,0)
 ;;NEXT
"RTN","PSJHVARS",139,0)
 ;;NF
"RTN","PSJHVARS",140,0)
 ;;NO
"RTN","PSJHVARS",141,0)
 ;;O
"RTN","PSJHVARS",142,0)
 ;;ON
"RTN","PSJHVARS",143,0)
 ;;ON55
"RTN","PSJHVARS",144,0)
 ;;ORIFN
"RTN","PSJHVARS",145,0)
 ;;P16
"RTN","PSJHVARS",146,0)
 ;;P17
"RTN","PSJHVARS",147,0)
 ;;P(2)
"RTN","PSJHVARS",148,0)
 ;;P(3)
"RTN","PSJHVARS",149,0)
 ;;P(4)
"RTN","PSJHVARS",150,0)
 ;;P(5)
"RTN","PSJHVARS",151,0)
 ;;P(6)
"RTN","PSJHVARS",152,0)
 ;;P(7)
"RTN","PSJHVARS",153,0)
 ;;P(8)
"RTN","PSJHVARS",154,0)
 ;;P(9)
"RTN","PSJHVARS",155,0)
 ;;P(10)
"RTN","PSJHVARS",156,0)
 ;;P(11)
"RTN","PSJHVARS",157,0)
 ;;P(12)
"RTN","PSJHVARS",158,0)
 ;;P(13)
"RTN","PSJHVARS",159,0)
 ;;P(14)
"RTN","PSJHVARS",160,0)
 ;;P(15)
"RTN","PSJHVARS",161,0)
 ;;P(16)
"RTN","PSJHVARS",162,0)
 ;;P(17)
"RTN","PSJHVARS",163,0)
 ;;P(18)
"RTN","PSJHVARS",164,0)
 ;;P(19)
"RTN","PSJHVARS",165,0)
 ;;P(20)
"RTN","PSJHVARS",166,0)
 ;;P(21)
"RTN","PSJHVARS",167,0)
 ;;P(22)
"RTN","PSJHVARS",168,0)
 ;;P(23)
"RTN","PSJHVARS",169,0)
 ;;P(24)
"RTN","PSJHVARS",170,0)
 ;;P(25)
"RTN","PSJHVARS",171,0)
 ;;P("21FLG")
"RTN","PSJHVARS",172,0)
 ;;P("CLRK")
"RTN","PSJHVARS",173,0)
 ;;P("CUM")
"RTN","PSJHVARS",174,0)
 ;;P("DO")
"RTN","PSJHVARS",175,0)
 ;;P("DTYP")
"RTN","PSJHVARS",176,0)
 ;;P("FRES")
"RTN","PSJHVARS",177,0)
 ;;P("INS")
"RTN","PSJHVARS",178,0)
 ;;P("IVRM")
"RTN","PSJHVARS",179,0)
 ;;P("LF")
"RTN","PSJHVARS",180,0)
 ;;P("LFA")
"RTN","PSJHVARS",181,0)
 ;;P("LOG")
"RTN","PSJHVARS",182,0)
 ;;P("MR")
"RTN","PSJHVARS",183,0)
 ;;P("NEWON")
"RTN","PSJHVARS",184,0)
 ;;P("OLDON")
"RTN","PSJHVARS",185,0)
 ;;P("OPI")
"RTN","PSJHVARS",186,0)
 ;;P("OT")
"RTN","PSJHVARS",187,0)
 ;;P("PD")
"RTN","PSJHVARS",188,0)
 ;;P("PON")
"RTN","PSJHVARS",189,0)
 ;;P("PRY")
"RTN","PSJHVARS",190,0)
 ;;P("REM")
"RTN","PSJHVARS",191,0)
 ;;P("REN")
"RTN","PSJHVARS",192,0)
 ;;P("RES")
"RTN","PSJHVARS",193,0)
 ;;P("SYRS")
"RTN","PSJHVARS",194,0)
 ;;PF
"RTN","PSJHVARS",195,0)
 ;;PPAGE
"RTN","PSJHVARS",196,0)
 ;;PPN
"RTN","PSJHVARS",197,0)
 ;;PROVIDER
"RTN","PSJHVARS",198,0)
 ;;PS
"RTN","PSJHVARS",199,0)
 ;;PSFDT
"RTN","PSJHVARS",200,0)
 ;;PSGACT
"RTN","PSJHVARS",201,0)
 ;;PSGADR
"RTN","PSJHVARS",202,0)
 ;;PSGADR(1)
"RTN","PSJHVARS",203,0)
 ;;PSGAT
"RTN","PSJHVARS",204,0)
 ;;PSGCANFL
"RTN","PSJHVARS",205,0)
 ;;PSGDFLG
"RTN","PSJHVARS",206,0)
 ;;PSGDI
"RTN","PSJHVARS",207,0)
 ;;PSGDRG
"RTN","PSJHVARS",208,0)
 ;;PSGDRGN
"RTN","PSJHVARS",209,0)
 ;;PSGDO
"RTN","PSJHVARS",210,0)
 ;;PSGDT
"RTN","PSJHVARS",211,0)
 ;;PSGEB
"RTN","PSJHVARS",212,0)
 ;;PSGEBN
"RTN","PSJHVARS",213,0)
 ;;PSGEFN
"RTN","PSJHVARS",214,0)
 ;;PSGF
"RTN","PSJHVARS",215,0)
 ;;PSGFD
"RTN","PSJHVARS",216,0)
 ;;PSGFDN
"RTN","PSJHVARS",217,0)
 ;;PSGHSM
"RTN","PSJHVARS",218,0)
 ;;PSGID
"RTN","PSJHVARS",219,0)
 ;;PSGIVAC
"RTN","PSJHVARS",220,0)
 ;;PSGIVBR
"RTN","PSJHVARS",221,0)
 ;;PSGLAD
"RTN","PSJHVARS",222,0)
 ;;PSGLAGE
"RTN","PSJHVARS",223,0)
 ;;PSGLBID
"RTN","PSJHVARS",224,0)
 ;;PSGLBSS
"RTN","PSJHVARS",225,0)
 ;;PSGLDOB
"RTN","PSJHVARS",226,0)
 ;;PSGLDT
"RTN","PSJHVARS",227,0)
 ;;PSGLDX
"RTN","PSJHVARS",228,0)
 ;;PSGLI
"RTN","PSJHVARS",229,0)
 ;;PSGLIN
"RTN","PSJHVARS",230,0)
 ;;PSGLPID
"RTN","PSJHVARS",231,0)
 ;;PSGLPN
"RTN","PSJHVARS",232,0)
 ;;PSGLPR
"RTN","PSJHVARS",233,0)
 ;;PSGLRB
"RTN","PSJHVARS",234,0)
 ;;PSGLSEX
"RTN","PSJHVARS",235,0)
 ;;PSGLSSN
"RTN","PSJHVARS",236,0)
 ;;PSGLTM
"RTN","PSJHVARS",237,0)
 ;;PSGLTS
"RTN","PSJHVARS",238,0)
 ;;PSGLWD
"RTN","PSJHVARS",239,0)
 ;;PSGLWDN
"RTN","PSJHVARS",240,0)
 ;;PSGLWGN
"RTN","PSJHVARS",241,0)
 ;;PSGLWP1
"RTN","PSJHVARS",242,0)
 ;;PSGLWP2
"RTN","PSJHVARS",243,0)
 ;;PSGMR
"RTN","PSJHVARS",244,0)
 ;;PSGMRN
"RTN","PSJHVARS",245,0)
 ;;PSGNEDFD
"RTN","PSJHVARS",246,0)
 ;;PSGNEF
"RTN","PSJHVARS",247,0)
 ;;PSGNESD
"RTN","PSJHVARS",248,0)
 ;;PSGOAT
"RTN","PSJHVARS",249,0)
 ;;PSGOD
"RTN","PSJHVARS",250,0)
 ;;PSGODDD
"RTN","PSJHVARS",251,0)
 ;;PSGODDD(1)
"RTN","PSJHVARS",252,0)
 ;;PSGODO
"RTN","PSJHVARS",253,0)
 ;;PSGODT
"RTN","PSJHVARS",254,0)
 ;;PSGOEA
"RTN","PSJHVARS",255,0)
 ;;PSGOEAV
"RTN","PSJHVARS",256,0)
 ;;PSGOEDMR
"RTN","PSJHVARS",257,0)
 ;;PSGOEEG
"RTN","PSJHVARS",258,0)
 ;;PSGOEEND
"RTN","PSJHVARS",259,0)
 ;;PSGOEEWF
"RTN","PSJHVARS",260,0)
 ;;PSGOENG
"RTN","PSJHVARS",261,0)
 ;;PSGOENOF
"RTN","PSJHVARS",262,0)
 ;;PSGOEPR
"RTN","PSJHVARS",263,0)
 ;;PSGOFD
"RTN","PSJHVARS",264,0)
 ;;PSGOFDN
"RTN","PSJHVARS",265,0)
 ;;PSGOHSM
"RTN","PSJHVARS",266,0)
 ;;PSGOINST
"RTN","PSJHVARS",267,0)
 ;;PSGOL
"RTN","PSJHVARS",268,0)
 ;;PSGOMR
"RTN","PSJHVARS",269,0)
 ;;PSGOMRN
"RTN","PSJHVARS",270,0)
 ;;PSGONC
"RTN","PSJHVARS",271,0)
 ;;PSGOP
"RTN","PSJHVARS",272,0)
 ;;PSGOPD
"RTN","PSJHVARS",273,0)
 ;;PSGOPDN
"RTN","PSJHVARS",274,0)
 ;;PSGOPR
"RTN","PSJHVARS",275,0)
 ;;PSGOPRN
"RTN","PSJHVARS",276,0)
 ;;PSGORD
"RTN","PSJHVARS",277,0)
 ;;PSGOSCH
"RTN","PSJHVARS",278,0)
 ;;PSGOSD
"RTN","PSJHVARS",279,0)
 ;;PSGOSDN
"RTN","PSJHVARS",280,0)
 ;;PSGOSI
"RTN","PSJHVARS",281,0)
 ;;PSGOSM
"RTN","PSJHVARS",282,0)
 ;;PSGOST
"RTN","PSJHVARS",283,0)
 ;;PSGOSTN
"RTN","PSJHVARS",284,0)
 ;;PSGP
"RTN","PSJHVARS",285,0)
 ;;PSGP(0)
"RTN","PSJHVARS",286,0)
 ;;PSGPD
"RTN","PSJHVARS",287,0)
 ;;PSGPDN
"RTN","PSJHVARS",288,0)
 ;;PSGPDRG
"RTN","PSJHVARS",289,0)
 ;;PSGPDRGN
"RTN","PSJHVARS",290,0)
 ;;PSGPI
"RTN","PSJHVARS",291,0)
 ;;PSGPR
"RTN","PSJHVARS",292,0)
 ;;PSGPRIO
"RTN","PSJHVARS",293,0)
 ;;PSGPRN
"RTN","PSJHVARS",294,0)
 ;;PSGPTMP
"RTN","PSJHVARS",295,0)
 ;;PSGPTS
"RTN","PSJHVARS",296,0)
 ;;PSGPXN
"RTN","PSJHVARS",297,0)
 ;;PSGRRF
"RTN","PSJHVARS",298,0)
 ;;PSGSCH
"RTN","PSJHVARS",299,0)
 ;;PSGSD
"RTN","PSJHVARS",300,0)
 ;;PSGSDN
"RTN","PSJHVARS",301,0)
 ;;PSGSI
"RTN","PSJHVARS",302,0)
 ;;PSGSM
"RTN","PSJHVARS",303,0)
 ;;PSGSOXT
"RTN","PSJHVARS",304,0)
 ;;PSGSOY
"RTN","PSJHVARS",305,0)
 ;;PSGS0Y
"RTN","PSJHVARS",306,0)
 ;;PSGSS
"RTN","PSJHVARS",307,0)
 ;;PSGSSH
"RTN","PSJHVARS",308,0)
 ;;PSGST
"RTN","PSJHVARS",309,0)
 ;;PSGSTAT
"RTN","PSJHVARS",310,0)
 ;;PSGSTN
"RTN","PSJHVARS",311,0)
 ;;PSGVADR
"RTN","PSJHVARS",312,0)
 ;;PSGVALG
"RTN","PSJHVARS",313,0)
 ;;PSGVBPN
"RTN","PSJHVARS",314,0)
 ;;PSGVBTM
"RTN","PSJHVARS",315,0)
 ;;PSGVBWN
"RTN","PSJHVARS",316,0)
 ;;PSGVBWW
"RTN","PSJHVARS",317,0)
 ;;PSGVBY
"RTN","PSJHVARS",318,0)
 ;;PSIVAC
"RTN","PSJHVARS",319,0)
 ;;PSIVBR
"RTN","PSJHVARS",320,0)
 ;;PSIVDT
"RTN","PSJHVARS",321,0)
 ;;PSIVON
"RTN","PSJHVARS",322,0)
 ;;PSIVOF
"RTN","PSJHVARS",323,0)
 ;;PSIVOV1
"RTN","PSJHVARS",324,0)
 ;;PSIVOV2
"RTN","PSJHVARS",325,0)
 ;;PSIV
"RTN","PSJHVARS",326,0)
 ;;PSIVORF
"RTN","PSJHVARS",327,0)
 ;;PSIVPL
"RTN","PSJHVARS",328,0)
 ;;PSIVPR
"RTN","PSJHVARS",329,0)
 ;;PSIVRD
"RTN","PSJHVARS",330,0)
 ;;PSIVREA
"RTN","PSJHVARS",331,0)
 ;;PSIVSITE
"RTN","PSJHVARS",332,0)
 ;;PSIVSN
"RTN","PSJHVARS",333,0)
 ;;PSIVST
"RTN","PSJHVARS",334,0)
 ;;PSIVUP
"RTN","PSJHVARS",335,0)
 ;;PSIVX1
"RTN","PSJHVARS",336,0)
 ;;PSIVX2
"RTN","PSJHVARS",337,0)
 ;;PSJ
"RTN","PSJHVARS",338,0)
 ;;PSJAC
"RTN","PSJHVARS",339,0)
 ;;PSJACND
"RTN","PSJHVARS",340,0)
 ;;PSJACNWP
"RTN","PSJHVARS",341,0)
 ;;PSJACOK
"RTN","PSJHVARS",342,0)
 ;;PSJACPF
"RTN","PSJHVARS",343,0)
 ;;PSJASK
"RTN","PSJHVARS",344,0)
 ;;PSJCNT
"RTN","PSJHVARS",345,0)
 ;;PSJF
"RTN","PSJHVARS",346,0)
 ;;PSJHLMTN
"RTN","PSJHVARS",347,0)
 ;;PSJINDEX
"RTN","PSJHVARS",348,0)
 ;;PSJIVOF
"RTN","PSJHVARS",349,0)
 ;;PSJIVORF
"RTN","PSJHVARS",350,0)
 ;;PSJL
"RTN","PSJHVARS",351,0)
 ;;PSJLABEL
"RTN","PSJHVARS",352,0)
 ;;PSJLK
"RTN","PSJHVARS",353,0)
 ;;PSJLM
"RTN","PSJHVARS",354,0)
 ;;PSJLMCON
"RTN","PSJHVARS",355,0)
 ;;PSJLMPRO
"RTN","PSJHVARS",356,0)
 ;;PSJLN
"RTN","PSJHVARS",357,0)
 ;;PSJNARC
"RTN","PSJHVARS",358,0)
 ;;PSJNV
"RTN","PSJHVARS",359,0)
 ;;PSJO
"RTN","PSJHVARS",360,0)
 ;;PSJOCNT
"RTN","PSJHVARS",361,0)
 ;;PSJOE
"RTN","PSJHVARS",362,0)
 ;;PSJOEPF
"RTN","PSJHVARS",363,0)
 ;;PSJOL
"RTN","PSJHVARS",364,0)
 ;;PSJORD
"RTN","PSJHVARS",365,0)
 ;;PSJORF
"RTN","PSJHVARS",366,0)
 ;;PSJORIFN
"RTN","PSJHVARS",367,0)
 ;;PSJORL
"RTN","PSJHVARS",368,0)
 ;;PSJORQF
"RTN","PSJHVARS",369,0)
 ;;PSJORVP
"RTN","PSJHVARS",370,0)
 ;;PSJOS
"RTN","PSJHVARS",371,0)
 ;;PSJPAC
"RTN","PSJHVARS",372,0)
 ;;PSJPAD
"RTN","PSJHVARS",373,0)
 ;;PSJPAGE
"RTN","PSJHVARS",374,0)
 ;;PSJPBID
"RTN","PSJHVARS",375,0)
 ;;PSJPCAF
"RTN","PSJHVARS",376,0)
 ;;PSJPDD
"RTN","PSJHVARS",377,0)
 ;;PSJPDOB
"RTN","PSJHVARS",378,0)
 ;;PSJPDT
"RTN","PSJHVARS",379,0)
 ;;PSJPDX
"RTN","PSJHVARS",380,0)
 ;;PSJPEN
"RTN","PSJHVARS",381,0)
 ;;PSJPHT
"RTN","PSJHVARS",382,0)
 ;;PSJPHTD
"RTN","PSJHVARS",383,0)
 ;;PSJPN
"RTN","PSJHVARS",384,0)
 ;;PSJPPID
"RTN","PSJHVARS",385,0)
 ;;PSJPRB
"RTN","PSJHVARS",386,0)
 ;;PSJPROT
"RTN","PSJHVARS",387,0)
 ;;PSJPSEX
"RTN","PSJHVARS",388,0)
 ;;PSJPSSN
"RTN","PSJHVARS",389,0)
 ;;PSJP
"RTN","PSJHVARS",390,0)
 ;;PSJPTS
"RTN","PSJHVARS",391,0)
 ;;PSJPTSP
"RTN","PSJHVARS",392,0)
 ;;PSJPWD
"RTN","PSJHVARS",393,0)
 ;;PSJPWDN
"RTN","PSJHVARS",394,0)
 ;;PSJPWT
"RTN","PSJHVARS",395,0)
 ;;PSJPWTD
"RTN","PSJHVARS",396,0)
 ;;PSJSCHT
"RTN","PSJHVARS",397,0)
 ;;PSJSEL
"RTN","PSJHVARS",398,0)
 ;;PSJSEL1
"RTN","PSJHVARS",399,0)
 ;;PSJSTOP
"RTN","PSJHVARS",400,0)
 ;;PSJSYSL
"RTN","PSJHVARS",401,0)
 ;;PSJSYSP
"RTN","PSJHVARS",402,0)
 ;;PSJSYSP0
"RTN","PSJHVARS",403,0)
 ;;PSJSYSU
"RTN","PSJHVARS",404,0)
 ;;PSJSYSW
"RTN","PSJHVARS",405,0)
 ;;PSJSYSW0
"RTN","PSJHVARS",406,0)
 ;;PSJTF
"RTN","PSJHVARS",407,0)
 ;;PSJTOO
"RTN","PSJHVARS",408,0)
 ;;PSJUDPRF
"RTN","PSJHVARS",409,0)
 ;;PSJX
"RTN","PSJHVARS",410,0)
 ;;PSSPSP0
"RTN","PSJHVARS",411,0)
 ;;Q
"RTN","PSJHVARS",412,0)
 ;;QQ
"RTN","PSJHVARS",413,0)
 ;;QUD
"RTN","PSJHVARS",414,0)
 ;;QUX1
"RTN","PSJHVARS",415,0)
 ;;RTE
"RTN","PSJHVARS",416,0)
 ;;SCH
"RTN","PSJHVARS",417,0)
 ;;SD
"RTN","PSJHVARS",418,0)
 ;;SEGMENT(0)
"RTN","PSJHVARS",419,0)
 ;;SM
"RTN","PSJHVARS",420,0)
 ;;ST
"RTN","PSJHVARS",421,0)
 ;;START
"RTN","PSJHVARS",422,0)
 ;;STAT
"RTN","PSJHVARS",423,0)
 ;;STATUS
"RTN","PSJHVARS",424,0)
 ;;STOP
"RTN","PSJHVARS",425,0)
 ;;STT
"RTN","PSJHVARS",426,0)
 ;;SUB
"RTN","PSJHVARS",427,0)
 ;;TYPE
"RTN","PSJHVARS",428,0)
 ;;UDU
"RTN","PSJHVARS",429,0)
 ;;V
"RTN","PSJHVARS",430,0)
 ;;VA200
"RTN","PSJHVARS",431,0)
 ;;VADM
"RTN","PSJHVARS",432,0)
 ;;VAIN
"RTN","PSJHVARS",433,0)
 ;;VAIP
"RTN","PSJHVARS",434,0)
 ;;VALMCNT
"RTN","PSJHVARS",435,0)
 ;;VALM("TITLE")
"RTN","PSJHVARS",436,0)
 ;;WRD
"RTN","PSJHVARS",437,0)
 ;;WS
"RTN","PSJHVARS",438,0)
 ;;X
"RTN","PSJHVARS",439,0)
 ;;X3
"RTN","PSJHVARS",440,0)
 ;;X4
"RTN","PSJHVARS",441,0)
 ;;X5
"RTN","PSJHVARS",442,0)
 ;;XRTN
"RTN","PSJHVARS",443,0)
 ;;Y
"RTN","PSJLIACT")
0^44^B42251773
"RTN","PSJLIACT",1,0)
PSJLIACT ;BIR/MV-IV ACTION ;28 Jul 98 / 8:50 AM
"RTN","PSJLIACT",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**15,47,62,58,82,97,80,110,111,134,181**;16 DEC 97;Build 190
"RTN","PSJLIACT",3,0)
 ;
"RTN","PSJLIACT",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJLIACT",5,0)
 ; Reference to MAIN^TIUEDIT is supported by DBIA 2410.
"RTN","PSJLIACT",6,0)
 ;
"RTN","PSJLIACT",7,0)
DC ; Discontinue order
"RTN","PSJLIACT",8,0)
 K PSGORQF
"RTN","PSJLIACT",9,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",10,0)
 S PSJCOM=+$S(PSJORD["V":$P($G(^PS(55,DFN,"IV",+PSJORD,.2)),"^",8),1:$P($G(^PS(53.1,+PSJORD,.2)),"^",8))
"RTN","PSJLIACT",11,0)
 I PSJCOM W !!,"This order is part of a complex order. If you discontinue this order the",!,"following orders will be discontinued too (unless the stop date has already",!,"been reached)." D CMPLX^PSJCOM1(PSGP,PSJCOM,PSJORD)
"RTN","PSJLIACT",12,0)
 I PSJCOM F  W !!,"Do you want to discontinue this order" S %=1 D YN^DICN Q:%  D ENCOM^PSGOEM
"RTN","PSJLIACT",13,0)
 I PSJCOM,%'=1 S VALMBK="" Q
"RTN","PSJLIACT",14,0)
 I PSJORD["V" D DC^PSIVORA D:'$G(PSJOCFLG) EN^PSJLIORD(DFN,ON) Q
"RTN","PSJLIACT",15,0)
 D:PSJORD["P" DISCONT^PSIVORC
"RTN","PSJLIACT",16,0)
 S VALMBCK="Q"
"RTN","PSJLIACT",17,0)
 Q
"RTN","PSJLIACT",18,0)
ACEDIT ; Display LM screen and AC and EDit actions
"RTN","PSJLIACT",19,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",20,0)
 S VALMBCK=$S($G(PSIVACEP):"Q",1:"R")
"RTN","PSJLIACT",21,0)
 Q
"RTN","PSJLIACT",22,0)
AEEXIT ; Call for EXIT CODE in PSJ LM IV AC/EDIT
"RTN","PSJLIACT",23,0)
 K PSGORQF
"RTN","PSJLIACT",24,0)
 D:ON["V" GT55^PSIVORFB
"RTN","PSJLIACT",25,0)
 I ON["P" D GT531^PSIVORFA(DFN,ON) D:P("OT")'="I" GTDATA^PSJLIFN
"RTN","PSJLIACT",26,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",27,0)
 K PSIVENO
"RTN","PSJLIACT",28,0)
 Q
"RTN","PSJLIACT",29,0)
EDIT ; Edit order
"RTN","PSJLIACT",30,0)
 K PSIVFN1 NEW PSIVNBD
"RTN","PSJLIACT",31,0)
 I $D(PSGACT),PSGACT'["E" W !,"This order may not be edited." D PAUSE^VALM1 Q
"RTN","PSJLIACT",32,0)
 D EDIT1
"RTN","PSJLIACT",33,0)
 Q:$D(PSIVNBD)!($G(PSIVCOPY)&'$G(PSIVENO))
"RTN","PSJLIACT",34,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",35,0)
 S VALMBCK=$S($G(PSIVFN1):"Q",1:"R")
"RTN","PSJLIACT",36,0)
 Q
"RTN","PSJLIACT",37,0)
EDIT1 ;
"RTN","PSJLIACT",38,0)
 K PSGORQF
"RTN","PSJLIACT",39,0)
 ;Ensure P() is defined
"RTN","PSJLIACT",40,0)
 I $D(P)<10 S XQORQUIT=1,P("PON")="",PSIVNBD=1 D  Q
"RTN","PSJLIACT",41,0)
 .W !,"WARNING: An error has occurred. Changes will not be saved"
"RTN","PSJLIACT",42,0)
 .D PAUSE^VALM1
"RTN","PSJLIACT",43,0)
 .S VALMBCK="Q"
"RTN","PSJLIACT",44,0)
 I "ANP"'[P(17) W !,"You cannot edit an inactive order" D PAUSE^VALM1 Q
"RTN","PSJLIACT",45,0)
 S:$G(ON55)="" ON55=$G(PSJORD)
"RTN","PSJLIACT",46,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",47,0)
 ;* Edit a new back door order
"RTN","PSJLIACT",48,0)
 I ($G(ON55)["V"&($G(P("21FLG"))="")) D  Q
"RTN","PSJLIACT",49,0)
 . D GSTRING^PSIVORE1,GTFLDS^PSIVORFE
"RTN","PSJLIACT",50,0)
 . I $G(ON55)["V",'$G(DONE) D OK^PSIVORE
"RTN","PSJLIACT",51,0)
 . S VALMBCK="Q",PSIVNBD=1
"RTN","PSJLIACT",52,0)
 ;* Edit an active order
"RTN","PSJLIACT",53,0)
 I $G(ON55)["V" NEW PSJEDIT1 D E^PSIVOPT1 D  Q
"RTN","PSJLIACT",54,0)
 . I $G(PSJIVBD) K PSJIVBD D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",55,0)
 I $G(ON55)["P" D EDIT^PSIVORC ;Edit incomplete order.
"RTN","PSJLIACT",56,0)
 K P("OVRIDE")
"RTN","PSJLIACT",57,0)
 Q
"RTN","PSJLIACT",58,0)
ACCEPT ; Accept order
"RTN","PSJLIACT",59,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",60,0)
 ;Accept IV from back door.
"RTN","PSJLIACT",61,0)
 I $G(PSJIVBD) K PSJIVBD D OK^PSIVORE S VALMBCK="Q" Q
"RTN","PSJLIACT",62,0)
 ;D:'$G(PSGORQF) IN^PSJOCDS($G(ON),"IV","") Q:$G(PSGORQF)
"RTN","PSJLIACT",63,0)
 I ON["V" D ACCEPT^PSIVOPT1 Q
"RTN","PSJLIACT",64,0)
 S PSIVFN1=1
"RTN","PSJLIACT",65,0)
 D COMPLTE^PSIVORC1
"RTN","PSJLIACT",66,0)
 S VALMBCK="Q"
"RTN","PSJLIACT",67,0)
 Q
"RTN","PSJLIACT",68,0)
R ; Renewal
"RTN","PSJLIACT",69,0)
 K PSGORQF
"RTN","PSJLIACT",70,0)
 S PSJREN=1
"RTN","PSJLIACT",71,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",72,0)
 NEW PSIVAC S PSIVAC="PR" K PSGFDX
"RTN","PSJLIACT",73,0)
 D R^PSIVOPT
"RTN","PSJLIACT",74,0)
 D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",75,0)
 K PSJREN
"RTN","PSJLIACT",76,0)
 Q
"RTN","PSJLIACT",77,0)
H ; Hold
"RTN","PSJLIACT",78,0)
 K PSGORQF
"RTN","PSJLIACT",79,0)
 NEW TEX S TEX="Active order ***"
"RTN","PSJLIACT",80,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",81,0)
 D H^PSIVOPT(DFN,ON,P(17),P(3))
"RTN","PSJLIACT",82,0)
 D:P(17)="A" PAUSE^VALM1
"RTN","PSJLIACT",83,0)
 D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",84,0)
 Q
"RTN","PSJLIACT",85,0)
L ; Activity Log
"RTN","PSJLIACT",86,0)
 NEW PSIVLAB,PSIVLOG,PSJHIS S (PSIVLAB,PSIVLOG)=1
"RTN","PSJLIACT",87,0)
 D EN^PSIVVW1
"RTN","PSJLIACT",88,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",89,0)
 S VALMBCK="R"
"RTN","PSJLIACT",90,0)
 Q
"RTN","PSJLIACT",91,0)
O ; On Call
"RTN","PSJLIACT",92,0)
 K PSGORQF
"RTN","PSJLIACT",93,0)
 NEW TEX S TEX="Active order ***"
"RTN","PSJLIACT",94,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",95,0)
 D O^PSIVOPT(DFN,ON,P(17),P(3))
"RTN","PSJLIACT",96,0)
 D:P(17)="A" PAUSE^VALM1
"RTN","PSJLIACT",97,0)
 D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",98,0)
 Q
"RTN","PSJLIACT",99,0)
VF ; Make the order active
"RTN","PSJLIACT",100,0)
 NEW PSIVCHG S PSIVCHG=0
"RTN","PSJLIACT",101,0)
 I ON["V" S ON55=ON D VF1("V","ORDER VERIFIED BY ",1) Q
"RTN","PSJLIACT",102,0)
 D ACTIVE^PSIVORC2
"RTN","PSJLIACT",103,0)
 Q
"RTN","PSJLIACT",104,0)
VF1(PSIVREA,PSIVAL,PSIVLOG) ;
"RTN","PSJLIACT",105,0)
 ;Update 4 node and set activity log.
"RTN","PSJLIACT",106,0)
 ;PSIVREA: the reason use by LOG^PSIVORAL
"RTN","PSJLIACT",107,0)
 ;PSIVAL : the description reason
"RTN","PSJLIACT",108,0)
 ;PSIVLOG: Log an activity if = 1
"RTN","PSJLIACT",109,0)
 K PSGORQF
"RTN","PSJLIACT",110,0)
 I '+$G(OD)!($L($G(OD))>16) K OD
"RTN","PSJLIACT",111,0)
 D:+PSJSYSU=3 ^PSIVORE1
"RTN","PSJLIACT",112,0)
 NEW DIE,DA,DR,PSJX,XX,PSIVACT,PSJRQND
"RTN","PSJLIACT",113,0)
 S PSIVACT=1
"RTN","PSJLIACT",114,0)
 S PSJX=$G(^PS(55,DFN,"IV",+ON55,4)),XX=""
"RTN","PSJLIACT",115,0)
 I $P(PSJX,U)="" S XX=";143////0"
"RTN","PSJLIACT",116,0)
 I $P(PSJX,U,4)="" S XX=XX_U_";142////0"
"RTN","PSJLIACT",117,0)
 D NOW^%DTC
"RTN","PSJLIACT",118,0)
 S DIE="^PS(55,"_DFN_",""IV"",",DA=+ON55,DA(1)=DFN
"RTN","PSJLIACT",119,0)
 I +PSJSYSU=3 S DR="140////"_DUZ_";141////"_$E(%,1,12)_";142////1"_$P(XX,U)
"RTN","PSJLIACT",120,0)
 I +PSJSYSU=1 S DR="16////"_DUZ_";17////"_$E(%,1,12)_";143////1"_$P(XX,U,2)
"RTN","PSJLIACT",121,0)
 I $G(P("PRY"))="D" S DR=DR_";.22////"_+P("IVRM")
"RTN","PSJLIACT",122,0)
 D ^DIE
"RTN","PSJLIACT",123,0)
 ; If pending IV renew is edited during finish, go back and DE the original active order left in RENEWED status
"RTN","PSJLIACT",124,0)
 S PREREN=$S(ON55["V":$G(@(DIE_"+ON55,2)")),1:""),PREREN=$P(PREREN,"^",5) I PREREN D  K PREREN
"RTN","PSJLIACT",125,0)
 . I PREREN["P" S PREREN=$G(@("^PS(53.1,+PREREN,0)")),PREREN=$P(PREREN,"^",25)
"RTN","PSJLIACT",126,0)
 . I PREREN["V" N PRERENOD S PRERENOD=$G(@("^PS(55,DFN,""IV"",+PREREN,0)")) I $P(PRERENOD,"^",17)="R",($G(P("RES"))="E") D
"RTN","PSJLIACT",127,0)
 ..  S DIE="^PS(55,"_DFN_",""IV"",",DA=+PREREN,DA(1)=DFN
"RTN","PSJLIACT",128,0)
 ..  S DR="100////D;.03////"_PSGDT S ORIGSTOP=$P($G(@("^PS(55,DFN,""IV"",+PREREN,2)")),"^",3) I ORIGSTOP S DR=DR_";116////"_ORIGSTOP
"RTN","PSJLIACT",129,0)
 ..  D ^DIE D EN1^PSJHL2(DFN,"SC",PREREN)
"RTN","PSJLIACT",130,0)
 K DR,DIE,DA
"RTN","PSJLIACT",131,0)
 I (+PSJSYSU=3)&($G(P("PRY"))="D") D
"RTN","PSJLIACT",132,0)
 .N DIR W ! S DIR(0)="S^Y:Yes;N:No",DIR("A")="Do you want to enter a Progress Note",DIR("B")="No" D ^DIR
"RTN","PSJLIACT",133,0)
 .Q:Y="N"
"RTN","PSJLIACT",134,0)
 .D MAIN^TIUEDIT(3,.TIUDA,DFN,"","","","",1)
"RTN","PSJLIACT",135,0)
 Q:'$G(PSIVLOG)
"RTN","PSJLIACT",136,0)
 I $G(P("PACT"))]"",+$P(P("PACT"),U,2),+$P(P("PACT"),U,3) D
"RTN","PSJLIACT",137,0)
 . NEW DIC,DA,X,Y,XX,DO D NAME^PSJBCMA1($P(P("PACT"),U,2),.XX)
"RTN","PSJLIACT",138,0)
 . S DIC(0)="L",DA(1)=DFN,DA(2)=+ON55,X=1
"RTN","PSJLIACT",139,0)
 . S DIC="^PS(55,"_DA(1)_",""IV"","_DA(2)_",""A"","
"RTN","PSJLIACT",140,0)
 . S DIC("DR")=".02////F;.03////"_XX_";.04////"_$P($G(^PS(53.3,+$P(P("PACT"),U,3),0)),U)_";.05////"_$P(P("PACT"),U)_";.06////"_$P(P("PACT"),U,2)
"RTN","PSJLIACT",141,0)
 . D FILE^DICN
"RTN","PSJLIACT",142,0)
 NEW PSIVALCK
"RTN","PSJLIACT",143,0)
 S PSIVREA="V",PSIVALT=""
"RTN","PSJLIACT",144,0)
 S PSIVAL=PSIVAL_$S(+PSJSYSU=3:"PHARMACIST",1:"NURSE")
"RTN","PSJLIACT",145,0)
 D LOG^PSIVORAL K PSIVAL,PSIVREA,PSIVLN
"RTN","PSJLIACT",146,0)
 I $G(PSJORD)["P" S PSIVREA="V",PSIVALT="",PSGRDTX=$G(^PS(53.1,+PSJORD,2.5)) D
"RTN","PSJLIACT",147,0)
 . I $G(PSGRDTX) S PSIVAL="Requested Start Date: "_$$ENDTC^PSGMI($$DATE2^PSJUTL2($P(PSGRDTX,U))) D LOG^PSIVORAL
"RTN","PSJLIACT",148,0)
 . I $P(PSGRDTX,U,3) S PSIVREA="V",PSIVALT="" S PSIVAL="Requested Stop Date: "_$$ENDTC^PSGMI($$DATE2^PSJUTL2($P(PSGRDTX,U,3))) D LOG^PSIVORAL
"RTN","PSJLIACT",149,0)
 N DUR I $G(PSJORD) S DUR=$$GETDUR^PSJLIVMD(DFN,+PSJORD,$S(PSJORD["P":"P",1:"IV"),1) I DUR]""  D
"RTN","PSJLIACT",150,0)
 . K DR S DIE="^PS(55,"_DFN_",""IV"",",DA=+ON55,DA(1)=DFN
"RTN","PSJLIACT",151,0)
 . S DR=$S($G(IVLIMIT):"152////"_DUR,1:"151////"_DUR) K IVLIMIT
"RTN","PSJLIACT",152,0)
 . D ^DIE
"RTN","PSJLIACT",153,0)
 D EN1^PSJHL2(DFN,"SC",ON55)
"RTN","PSJLIACT",154,0)
 D:+PSJSYSU=1 EN1^PSJHL2(DFN,"ZV",ON55)
"RTN","PSJLIACT",155,0)
 D GT55^PSIVORFB S OLDON=$P($G(^PS(55,DFN,"IV",+ON55,2)),"^",5),P("OLDON")=OLDON
"RTN","PSJLIACT",156,0)
 N PSJPRIO,PSJSCH,NODE0,NODEP2 S NODE0=$G(^PS(55,DFN,"IV",+ON55,0)),NODEP2=$G(^PS(55,DFN,"IV",+ON55,.2))
"RTN","PSJLIACT",157,0)
 S PSJPRIO=$P(NODEP2,"^",4),PSJSCH=$P(NODE0,"^",9)
"RTN","PSJLIACT",158,0)
 I (",S,A,")[(","_$G(PSJPRIO)_",")!($G(PSJSCH)="NOW")!($G(PSJSCH)["STAT") D NOTIFY^PSJHL4(ON55,DFN,$G(PSJPRIO),$G(PSJSCH))
"RTN","PSJLIACT",159,0)
 Q
"RTN","PSJLIFN")
0^31^B28386650
"RTN","PSJLIFN",1,0)
PSJLIFN ;BIR/MV-IV FINISH USING LM ;13 Jan 98 / 11:32 AM
"RTN","PSJLIFN",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,29,34,37,42,47,50,56,94,80,116,110,181**;16 DEC 97;Build 190
"RTN","PSJLIFN",3,0)
 ;
"RTN","PSJLIFN",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA #2178.
"RTN","PSJLIFN",5,0)
 ; Reference to ^PS(52.6 supported by DBIA #1231.
"RTN","PSJLIFN",6,0)
 ; Reference to ^PS(52.7 supported by DBIA #2173.
"RTN","PSJLIFN",7,0)
 ; Reference to ^PSDRUG( is supported by DBIA #2192.
"RTN","PSJLIFN",8,0)
 ; Reference to ^PSOORDRG is supported by DBIA #2190.
"RTN","PSJLIFN",9,0)
 ; Reference to ^%DT is supported by DBIA #10003.
"RTN","PSJLIFN",10,0)
 ; Reference to ^VALM is supported by DBIA #10118.
"RTN","PSJLIFN",11,0)
 ; Reference to ^VALM1 is supported by DBIA #10116.
"RTN","PSJLIFN",12,0)
 ; Reference to RE^VALM4 is supported by DBIA #10120.
"RTN","PSJLIFN",13,0)
 ;
"RTN","PSJLIFN",14,0)
EN ; Display order with numbers.
"RTN","PSJLIFN",15,0)
 L +^PS(53.1,+PSJORD):1 I '$T W !,$C(7),$C(7),"This order is being edited by another user. Try later." D PAUSE^VALM1 Q
"RTN","PSJLIFN",16,0)
 D PENDING K PSJREN
"RTN","PSJLIFN",17,0)
 L -^PS(53.1,+PSJORD)
"RTN","PSJLIFN",18,0)
 Q
"RTN","PSJLIFN",19,0)
PENDING ; Process pending order.
"RTN","PSJLIFN",20,0)
 ;* PSIVFN1 is used so it will display the AC/Edit screen
"RTN","PSJLIFN",21,0)
 ;* instead of go to the "IS this O.K." prompt
"RTN","PSJLIFN",22,0)
 ;* PSIVACEP only when accept the order. Original screen won't redisp.
"RTN","PSJLIFN",23,0)
 ;* PSJLMX is defined in WRTDRG^PSIVUTL and it was being call in PSJLIVMD & PSJLIVFD
"RTN","PSJLIFN",24,0)
 ;*        to count # of AD/SOL 
"RTN","PSJLIFN",25,0)
 NEW PSIVFN1,PSIVACEP,PSJLMX,PSIVOI,PSJOCCHK,PSJFNDS
"RTN","PSJLIFN",26,0)
 K PSJIVBD ;This varable was left over from the new backdoor order entry.
"RTN","PSJLIFN",27,0)
 ; PSJOCCHK is set so if EDIT was use instead of FN to finish order the OC is triggered
"RTN","PSJLIFN",28,0)
 S PSJOCCHK=1
"RTN","PSJLIFN",29,0)
 ;* PSJFNDS is set so dosing is trigger during finishing without changes to the add/sol
"RTN","PSJLIFN",30,0)
 S PSJFNDS=1
"RTN","PSJLIFN",31,0)
 S PSIVAC="CF" S (P("PON"),ON)=+PSJORD_"P",DFN=PSGP
"RTN","PSJLIFN",32,0)
 S PSIVUP=+$$GTPCI^PSIVUTL D GT531^PSIVORFA(DFN,ON)
"RTN","PSJLIFN",33,0)
 D:'$D(P("OT")) GTOT^PSIVUTL(P(4))
"RTN","PSJLIFN",34,0)
 NEW PSJL
"RTN","PSJLIFN",35,0)
 N PSIVNUM,PSJSTAR S PSIVNUM=1
"RTN","PSJLIFN",36,0)
 Q:ON'=PSJORD
"RTN","PSJLIFN",37,0)
 I $G(PSJLYN)]"" Q:ON'=PSJLYN
"RTN","PSJLIFN",38,0)
 S PSJMAI=ON
"RTN","PSJLIFN",39,0)
 I P("OT")="I" D  Q
"RTN","PSJLIFN",40,0)
 . S PSJSTAR="(5)^(7)^(9)^(10)"
"RTN","PSJLIFN",41,0)
 . D EN^VALM("PSJ LM IV INPT PENDING") ;; ^PSJLIVMD
"RTN","PSJLIFN",42,0)
 S PSJSTAR="(1)^(2)^(3)^(5)^(7)^(9)"
"RTN","PSJLIFN",43,0)
 D GTDATA D EN^VALM("PSJ LM IV PENDING") ;; ^PSJLIVFD
"RTN","PSJLIFN",44,0)
 K PSJMAI Q
"RTN","PSJLIFN",45,0)
 ;
"RTN","PSJLIFN",46,0)
DISPLAY ;
"RTN","PSJLIFN",47,0)
 S PSGACT=""
"RTN","PSJLIFN",48,0)
 S VALMSG="Press Return to continue"
"RTN","PSJLIFN",49,0)
 D:$E(P("OT"))="I" EN^VALM("PSJ LM IV INPT DISPLAY")
"RTN","PSJLIFN",50,0)
 D:$E(P("OT"))'="I" EN^VALM("PSJ LM IV DISPLAY")
"RTN","PSJLIFN",51,0)
 K PSJDISP
"RTN","PSJLIFN",52,0)
 S:'$G(PSJHIS) VALMBCK=""
"RTN","PSJLIFN",53,0)
 Q
"RTN","PSJLIFN",54,0)
GTDATA ;
"RTN","PSJLIFN",55,0)
 ;* D:P(4)="" 53^PSIVORC1 Q:P(4)=""  S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSJLIFN",56,0)
 S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSJLIFN",57,0)
 I 'P(2) D
"RTN","PSJLIFN",58,0)
 .I P("RES")="R" S PSJREN=1
"RTN","PSJLIFN",59,0)
 .D ENT^PSIVCAL K %DT S X=P(2),%DT="RTX" D ^%DT S P(2)=+Y
"RTN","PSJLIFN",60,0)
 I 'P(3) D ENSTOP^PSIVCAL K %DT S X=P(3),%DT="RTX" D ^%DT S P(3)=+Y
"RTN","PSJLIFN",61,0)
 I 'P("MR") S P("MR")=$O(^PS(51.2,"B","INTRAVENOUS",0))_"^IV"
"RTN","PSJLIFN",62,0)
 Q
"RTN","PSJLIFN",63,0)
FINISH ; Prompt for missing data
"RTN","PSJLIFN",64,0)
 ;* Ord chk for Inpat. pending only. Pend renew should not be checked.
"RTN","PSJLIFN",65,0)
 ;* PSIVOCON needed so this order will be excluded from the order
"RTN","PSJLIFN",66,0)
 ;*          list(ORDCHK^PSJLMUT1)
"RTN","PSJLIFN",67,0)
 ;* PSGORQF defined means cancel the order due to order check.
"RTN","PSJLIFN",68,0)
 ;Q:'$$LS^PSSLOCK(DFN,PSJORD)
"RTN","PSJLIFN",69,0)
 N PSJCOM,PSIVEDIT S PSJCOM=+$P($G(^PS(53.1,+PSJORD,.2)),"^",8)
"RTN","PSJLIFN",70,0)
 K PSJIVBD,PSGRDTX,PSIVEDIT
"RTN","PSJLIFN",71,0)
 N FIL,PSIVS,DRGOC,PSIVXD,DRGTMP,PSIVOCON,PSGORQF,ON55,NSFF K PSGORQF S NSFF=1
"RTN","PSJLIFN",72,0)
 S (ON,PSIVOCON,ON55,PSGORD)=PSJORD Q:PSJORD'=PSJMAI  I $G(PSJLYN)]"" Q:PSJORD'=PSJLYN
"RTN","PSJLIFN",73,0)
 D UDVARS^PSJLIORD
"RTN","PSJLIFN",74,0)
 I $G(PSJPROT)=3,'$$ENIVUD^PSGOEF1(PSJORD) K NSFF Q
"RTN","PSJLIFN",75,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIFN",76,0)
 ;PRE UAT group requested to not show the second screen since FDB OC has more text and provider override reason appears after 2nd screen 
"RTN","PSJLIFN",77,0)
 ; force the display of the second screen if CPRS order checks exist
"RTN","PSJLIFN",78,0)
 ;I $O(^PS(53.1,+PSJORD,12,0))!$O(^PS(53.1,+PSJORD,10,0)) D
"RTN","PSJLIFN",79,0)
 ;.Q:$G(PSJLMX)=1   ;no second screen to display
"RTN","PSJLIFN",80,0)
 ;.S VALMBG=16 D RE^VALM4,PAUSE^VALM1 S VALMBG=1
"RTN","PSJLIFN",81,0)
 S P("OPI")=$$ENPC^PSJUTL("V",+PSIVUP,60,P("OPI"))
"RTN","PSJLIFN",82,0)
 ;I $E(P("OT"))="I" D GTDATA Q:P(4)=""
"RTN","PSJLIFN",83,0)
 ;I $E(P("OT"))="I",'$D(DRG("AD")),('$D(DRG("SOL"))) D
"RTN","PSJLIFN",84,0)
 I $G(P("RES"))'="R" D 53^PSIVORC1
"RTN","PSJLIFN",85,0)
 I $G(P(4))]"",$G(P(15))]"",$G(P(9))]"",$$SCHREQ^PSJLIVFD(.P) D
"RTN","PSJLIFN",86,0)
 . N PSGS0XT,X,PSJNSS S PSJNSS=1,X=P(9),PSGS0XT=P(15) D Q2^PSGS0
"RTN","PSJLIFN",87,0)
 I P(4)="" D RE^VALM4 Q
"RTN","PSJLIFN",88,0)
 I $E(P("OT"))="I" D GTDATA  D
"RTN","PSJLIFN",89,0)
 . I '$D(DRG("AD")),('$D(DRG("SOL"))) S DNE=0 D GTIVDRG^PSIVORC2 S P(3)="" D ENSTOP^PSIVCAL
"RTN","PSJLIFN",90,0)
 S VALMBG=1
"RTN","PSJLIFN",91,0)
 I $E(P("OT"))="F" S DNE=0 I $G(PSGORQF) D RE^VALM4 Q
"RTN","PSJLIFN",92,0)
 I $G(PSGORQF) S VALMBCK="R",P(4)="" K DRG Q
"RTN","PSJLIFN",93,0)
 S PSIVEDIT=""
"RTN","PSJLIFN",94,0)
 S PSIVOK="1^3^10^25^26^39^57^58^59^63^64" D CKFLDS^PSIVORC1 I EDIT]"" D EDIT^PSIVEDT
"RTN","PSJLIFN",95,0)
 ;S PSIVOK="1^3^10^25^26^39^57^58^59^63^64" D CKFLDS^PSIVORC1 I EDIT]"" S PSIVEDIT=EDIT D EDIT^PSIVEDT
"RTN","PSJLIFN",96,0)
 ;I $G(EDIT)="" D OC^PSIVOC D:'$G(PSGORQF) IN^PSJOCDS($G(ON),"IV","") Q:$G(PSGORQF)
"RTN","PSJLIFN",97,0)
 I $D(PSIVEDIT) D OC^PSIVOC
"RTN","PSJLIFN",98,0)
 ;D:'$G(PSGORQF) IN^PSJOCDS($G(ON),"IV","")
"RTN","PSJLIFN",99,0)
 I $G(PSGORQF) D GT531^PSIVORFA(DFN,ON) Q
"RTN","PSJLIFN",100,0)
 I $G(DONE) S VALMBCK="R" Q
"RTN","PSJLIFN",101,0)
 ;* PSJFNDS is set so dosing is trigger during finishing without changes to the add/sol
"RTN","PSJLIFN",102,0)
 ;S PSJFNDS=1
"RTN","PSJLIFN",103,0)
 D COMPLTE^PSIVORC1
"RTN","PSJLIFN",104,0)
 S:$G(PSIVACEP) VALMBCK="Q"
"RTN","PSJLIFN",105,0)
 ;Reset PSJFNDS so if FN again, the dosing check is triggered.
"RTN","PSJLIFN",106,0)
 S:'$G(PSIVACEP) PSJFNDS=1
"RTN","PSJLIFN",107,0)
 I $G(PSGORQF) S VALMBG=1 D RE^VALM4
"RTN","PSJLIFN",108,0)
 K NSFF
"RTN","PSJLIFN",109,0)
 Q
"RTN","PSJLIFN",110,0)
ORDCHK ;* Do order check for Inpatient Meds IV.
"RTN","PSJLIFN",111,0)
 ; PSGORQF is defined (CONT^PSGSICHK) if not log an intervention
"RTN","PSJLIFN",112,0)
 ; No longer use after PSJ*5*181
"RTN","PSJLIFN",113,0)
 K PSGORQF
"RTN","PSJLIFN",114,0)
 Q
"RTN","PSJLIFN",115,0)
 ;NEW DRGOC
"RTN","PSJLIFN",116,0)
 ;D OCORD Q:$G(PSGORQF) 
"RTN","PSJLIFN",117,0)
 ;D GTIVDRG^PSIVORC2 S P(3)="" D ENSTOP^PSIVCAL
"RTN","PSJLIFN",118,0)
ORDCHKA ;* Do order check against existing orders on the profile
"RTN","PSJLIFN",119,0)
 ;No longer use as of PSJ*5*181
"RTN","PSJLIFN",120,0)
 Q
"RTN","PSJLIFN",121,0)
 F PSIVAS="AD","SOL" Q:$G(PSGORQF)  S FIL=$S(PSIVAS="AD":52.6,1:52.7) D
"RTN","PSJLIFN",122,0)
 . F PSIVX=0:0 S PSIVX=$O(DRG(PSIVAS,PSIVX)) Q:'PSIVX!($G(PSGORQF))  D
"RTN","PSJLIFN",123,0)
 .. S DRGTMP=DRG(PSIVAS,PSIVX)
"RTN","PSJLIFN",124,0)
 .. ;* Do only 1 duplicate warning when order has >1 of the same additive
"RTN","PSJLIFN",125,0)
 .. Q:$D(PSJADTMP(+DRGTMP))
"RTN","PSJLIFN",126,0)
 .. D ORDERCHK^PSIVEDRG(PSGP,ON,$D(DRGOC(ON)))
"RTN","PSJLIFN",127,0)
 .. S DRGOC(ON,PSIVAS,PSIVX)=DRG(PSIVAS,PSIVX)
"RTN","PSJLIFN",128,0)
 .. S PSJADTMP(+DRGTMP)=""
"RTN","PSJLIFN",129,0)
 K PSJADTMP
"RTN","PSJLIFN",130,0)
 Q
"RTN","PSJLIFN",131,0)
OCORD ;* Do order check for each drug against the drugs within the order.
"RTN","PSJLIFN",132,0)
 ;OCORD was called by ORDCHK.  This entry point is no longer use as of PSJ*5*181
"RTN","PSJLIFN",133,0)
 Q
"RTN","PSJLIFN",134,0)
 NEW X,Y,DDRUG,PSIVX,PSJAD,PSJSOL,TMPDRG
"RTN","PSJLIFN",135,0)
 D SAVEDRG^PSIVEDRG(.TMPDRG,.DRG)
"RTN","PSJLIFN",136,0)
 ; Find the corresponding DD for the additive within the order
"RTN","PSJLIFN",137,0)
 F X=0:0 S X=$O(DRG("AD",X)) Q:'X  D
"RTN","PSJLIFN",138,0)
 . S DDRUG=$P($G(^PS(52.6,+DRG("AD",X),0)),U,2)
"RTN","PSJLIFN",139,0)
 . S:+DDRUG (DDRUG(DDRUG),PSJAD(DDRUG))=$D(DDRUG(DDRUG))+1
"RTN","PSJLIFN",140,0)
 ;
"RTN","PSJLIFN",141,0)
 ; Find the corresponding DD for the solution
"RTN","PSJLIFN",142,0)
 ;
"RTN","PSJLIFN",143,0)
 F X=0:0 S X=$O(DRG("SOL",X)) Q:'X  D
"RTN","PSJLIFN",144,0)
 . S DDRUG=$P($G(^PS(52.7,+DRG("SOL",X),0)),U,2)
"RTN","PSJLIFN",145,0)
 . S:+DDRUG (DDRUG(DDRUG),PSJSOL(DDRUG))=$D(DDRUG(DDRUG))+1
"RTN","PSJLIFN",146,0)
 ;
"RTN","PSJLIFN",147,0)
 ; Loop thru each additive to check for DD,DI & DC against the
"RTN","PSJLIFN",148,0)
 ; order's dispense drugs
"RTN","PSJLIFN",149,0)
 ;
"RTN","PSJLIFN",150,0)
 NEW PSJDFN,INTERVEN S INTERVEN=""
"RTN","PSJLIFN",151,0)
 S PSJDFN=DFN ;DFN will be killed when call ^PSOORDRG
"RTN","PSJLIFN",152,0)
 F PSIVX=0:0 S PSIVX=$O(PSJAD(PSIVX)) Q:'PSIVX  D
"RTN","PSJLIFN",153,0)
 . K DDRUG(PSIVX) D DRGCHK^PSOORDRG(PSJDFN,PSIVX,.DDRUG)
"RTN","PSJLIFN",154,0)
 . I PSJAD(PSIVX)>1 S ^TMP($J,"DD",1,0)=PSIVX_U_$P($G(^PSDRUG(PSIVX,0)),U)_"^^"_ON_";I"
"RTN","PSJLIFN",155,0)
 . NEW TYPE F TYPE="DD","DI","DC" D ORDCHK^PSJLIFNI(PSJDFN,TYPE)
"RTN","PSJLIFN",156,0)
 F PSIVX=0:0 S PSIVX=$O(PSJSOL(PSIVX)) Q:'PSIVX  D
"RTN","PSJLIFN",157,0)
 . K DDRUG(PSIVX) D DRGCHK^PSOORDRG(PSJDFN,PSIVX,.DDRUG)
"RTN","PSJLIFN",158,0)
 . NEW TYPE F TYPE="DI" D ORDCHK^PSJLIFNI(PSJDFN,TYPE)
"RTN","PSJLIFN",159,0)
 S DFN=PSJDFN
"RTN","PSJLIFN",160,0)
 D SAVEDRG^PSIVEDRG(.DRG,.TMPDRG)
"RTN","PSJLIFN",161,0)
 Q
"RTN","PSJLIFNI")
0^53^B11257196
"RTN","PSJLIFNI",1,0)
PSJLIFNI ;BIR/MV-U/D ORDER FINISHES AS IV ;13 Jan 98 / 11:32 AM
"RTN","PSJLIFNI",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,29,34,37,50,94,116,110,111,181**;16 DEC 97;Build 190
"RTN","PSJLIFNI",3,0)
 ;
"RTN","PSJLIFNI",4,0)
IV(PSJORD,OI) ; Prompt for missing data to be finished as IV.
"RTN","PSJLIFNI",5,0)
 L +^PS(53.1,+PSJORD):1 I '$T W !,$C(7),$C(7),"This order is being edited by another user. Try later." D PAUSE^VALM1 Q
"RTN","PSJLIFNI",6,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIFNI",7,0)
 ;** PSIVFN1 is used so it will display the AC/Edit screen
"RTN","PSJLIFNI",8,0)
 ;** instead of go to the "IS this O.K." prompt
"RTN","PSJLIFNI",9,0)
 ;** PSJLIFNI is a flag to indicate U/D finishes as IV.
"RTN","PSJLIFNI",10,0)
 K PSJIVBD
"RTN","PSJLIFNI",11,0)
 NEW PSIVFN1,ON55,PSGORQF,PSIVACEP,DRGOC,PSJLIFNI,PSIVOI
"RTN","PSJLIFNI",12,0)
 K PSGORQF
"RTN","PSJLIFNI",13,0)
 S PSJLIFNI=1
"RTN","PSJLIFNI",14,0)
 S PSIVAC="CF" S (P("PON"),ON,ON55)=+PSJORD_"P",DFN=PSGP
"RTN","PSJLIFNI",15,0)
 S PSIVUP=+$$GTPCI^PSIVUTL D GT531^PSIVORFA(DFN,ON) S P("PD")=OI_U_$$OIDF^PSJLMUT1(+OI)
"RTN","PSJLIFNI",16,0)
 D:'$D(P("OT")) GTOT^PSIVUTL(P(4))
"RTN","PSJLIFNI",17,0)
 S P("OPI")=$$ENPC^PSJUTL("V",+PSIVUP,60,P("OPI"))
"RTN","PSJLIFNI",18,0)
 D 53^PSIVORC1
"RTN","PSJLIFNI",19,0)
 I $E(P("OT"))="I" D GTDATA^PSJLIFN Q:P(4)=""
"RTN","PSJLIFNI",20,0)
 ;I $$SCHREQ^PSJLIVFD(.P),(P(9))]"",'$$PRNOK^PSGS0(P(9)) N PSGOES,X,PSGS0XT,PSJNSS S PSJNSS=1,PSGOES=1,X=P(9),PSGS0XT=P(15) D Q2^PSGS0
"RTN","PSJLIFNI",21,0)
 I $$SCHREQ^PSJLIVFD(.P),(P(9))]"",'$$PRNOK^PSGS0(P(9)) N PSJNSS,PSGOES,PSGS0XT,PSGS0Y,PSGAT S X=P(9),PSGS0XT=P(15),PSGAT=P(11) D
"RTN","PSJLIFNI",22,0)
 .D EN^PSGS0 I $G(X)="" S PSGORQF=1 Q
"RTN","PSJLIFNI",23,0)
 .I $G(PSGS0Y)>1 S P(11)=PSGS0Y
"RTN","PSJLIFNI",24,0)
 I $E(P("OT"))="I",'$D(DRG("AD")),('$D(DRG("SOL"))) S DNE=0 D GTIVDRG^PSIVORC2 S P(3)="" D ENSTOP^PSIVCAL
"RTN","PSJLIFNI",25,0)
 I $D(PSGORQF) S VALMBCK="R",P(4)="" K DRG Q
"RTN","PSJLIFNI",26,0)
 S ^TMP("PSJI",$J,0)=""
"RTN","PSJLIFNI",27,0)
 S PSIVOK="1^3^10^25^26^39^57^58^59^63^64" D CKFLDS^PSIVORC1 I EDIT]"" D EDIT^PSIVEDT
"RTN","PSJLIFNI",28,0)
 ;I $G(EDIT)="" D OC^PSIVOC
"RTN","PSJLIFNI",29,0)
 I $G(DONE) S VALMBCK="R" D EXIT Q
"RTN","PSJLIFNI",30,0)
 D COMPLTE^PSIVORC1
"RTN","PSJLIFNI",31,0)
 S:$D(PSIVACEP) VALMBCK="Q"
"RTN","PSJLIFNI",32,0)
EXIT ;
"RTN","PSJLIFNI",33,0)
 L -^PS(53.1,+PSJORD)
"RTN","PSJLIFNI",34,0)
 Q
"RTN","PSJLIFNI",35,0)
ORDCHK(DFN,TYPE) ;
"RTN","PSJLIFNI",36,0)
 ;TYPE ="DD" - Duplicate drug
"RTN","PSJLIFNI",37,0)
 ;     ="DC" - Duplicate class
"RTN","PSJLIFNI",38,0)
 ;     -"DI" - Drug Interaction
"RTN","PSJLIFNI",39,0)
 ;
"RTN","PSJLIFNI",40,0)
 NEW ON,PSJL,PSIVX,PSJOC,PSJORIEN,PSJPACK,PSJLINE
"RTN","PSJLIFNI",41,0)
 S PSJOC=0,PSJLINE=1
"RTN","PSJLIFNI",42,0)
 F PSIVX=0:0 S PSIVX=$O(^TMP($J,TYPE,PSIVX)) Q:'PSIVX  D
"RTN","PSJLIFNI",43,0)
 . I TYPE="DI",($P(^TMP($J,TYPE,PSIVX,0),U,4)="CRITICAL") S PSJIREQ=1
"RTN","PSJLIFNI",44,0)
 . D WRITE(TYPE),CONT^PSGSICHK
"RTN","PSJLIFNI",45,0)
 .; I ON["V" D
"RTN","PSJLIFNI",46,0)
 .;. I '$O(^PS(55,DFN,"IV",+ON,0)) D SETPSJOC Q
"RTN","PSJLIFNI",47,0)
 .;. D DSPLORDV(DFN,ON) S PSJOC=PSJOC+1
"RTN","PSJLIFNI",48,0)
 .; I ON'["V" D DSPLORDU(DFN,ON) S PSJOC=PSJOC+1
"RTN","PSJLIFNI",49,0)
 .; S PSJOC(ON,PSJLINE)="",PSJLINE=PSJLINE+1
"RTN","PSJLIFNI",50,0)
 ;D:PSJOC WRITE(TYPE)
"RTN","PSJLIFNI",51,0)
 ;S ON="" F  S ON=$O(PSJOC(ON)) Q:ON=""  W ! S PSJLINE=PSJLINE+1 D
"RTN","PSJLIFNI",52,0)
 ;. F PSIVX=0:0 S PSIVX=$O(PSJOC(ON,PSIVX)) Q:'PSIVX  W !,PSJOC(ON,PSIVX)  S PSJLINE=PSJLINE+1 D:'(PSIVX#6) PAUSE
"RTN","PSJLIFNI",53,0)
 ;W !
"RTN","PSJLIFNI",54,0)
 Q
"RTN","PSJLIFNI",55,0)
WRITE(TYPE) ;Display order check description
"RTN","PSJLIFNI",56,0)
 S PSJPDRG=1
"RTN","PSJLIFNI",57,0)
 I TYPE="DD" W !!,"There are duplicate ",$P(^TMP($J,TYPE,PSIVX,0),U,2),!,"medications prescribed for this order.",! Q
"RTN","PSJLIFNI",58,0)
 I TYPE="DC" W !!,"This medication: ",$P(^TMP($J,TYPE,PSIVX,0),U,4),!,"is in the same class as the following medication(s) within this order: "
"RTN","PSJLIFNI",59,0)
 I TYPE="DI" W !!,"This medication: ",$P(^TMP($J,TYPE,PSIVX,0),U,2),!,"has an interaction with the following medication(s) within this order: "
"RTN","PSJLIFNI",60,0)
 F X=0:0 S X=$O(^TMP($J,TYPE,X)) Q:'X  W !,$S(TYPE="DC":$P(^TMP($J,TYPE,X,0),U,4),TYPE="DI":$P(^TMP($J,TYPE,X,0),U,6),1:$P(^TMP($J,TYPE,X,0),U,2)),!
"RTN","PSJLIFNI",61,0)
 Q
"RTN","PSJLIVFD")
0^102^B39326819
"RTN","PSJLIVFD",1,0)
PSJLIVFD ;BIR/MV-SETUP LM TEMPLATE FOR IV FLUID ;4 Aug 00 / 2:37 PM
"RTN","PSJLIVFD",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,50,63,64,58,81,91,80,116,110,111,180,134,181**;16 DEC 97;Build 190
"RTN","PSJLIVFD",3,0)
 ;
"RTN","PSJLIVFD",4,0)
 ; Reference to ^VALM0 is supported by DBIA # 2615.
"RTN","PSJLIVFD",5,0)
 ;
"RTN","PSJLIVFD",6,0)
 ;NFI changes for FR# 3@AD+4
"RTN","PSJLIVFD",7,0)
 ;
"RTN","PSJLIVFD",8,0)
EN ; Build LM template to display IV order.
"RTN","PSJLIVFD",9,0)
 K ^TMP("PSJI",$J)
"RTN","PSJLIVFD",10,0)
 S UL80="",$P(UL80,"=",80)=""
"RTN","PSJLIVFD",11,0)
 S PSJLN=1
"RTN","PSJLIVFD",12,0)
AD ;
"RTN","PSJLIVFD",13,0)
 NEW VALMEVL S VALMEVL=1
"RTN","PSJLIVFD",14,0)
 S PSJL="" D FLDNO^PSJLIUTL("(1)",1)
"RTN","PSJLIVFD",15,0)
 S PSJL=PSJL_"Additives:"
"RTN","PSJLIVFD",16,0)
 S:$G(P("PON"))["V"&(P(17)'="N") PSJL=$$SETSTR^VALM1("Order number:",PSJL,30,14)_+P("PON")
"RTN","PSJLIVFD",17,0)
 S PSJL=$$SETSTR^VALM1("Type:",PSJL,57,6)_$$TYPE^PSJLIUTL
"RTN","PSJLIVFD",18,0)
 NEW PSJVD S PSJVD=$$DINFLIV^PSJDIN(.DRG)
"RTN","PSJLIVFD",19,0)
 S PSJL=$$SETSTR^VALM1(PSJVD,PSJL,75,6)
"RTN","PSJLIVFD",20,0)
 I '$D(IORVON),$D(IOST(0)) D ENS^%ZISS,TERM^VALM0
"RTN","PSJLIVFD",21,0)
 I $D(IORVON),(PSJVD]"") D CNTRL^VALM10(1,76,5,IORVON,IORVOFF,0) K PSJVD
"RTN","PSJLIVFD",22,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",23,0)
 D:+$G(PSJLMX) CLRDSPL^PSJLIVMD
"RTN","PSJLIVFD",24,0)
 ;PSJLMX count number of lines needed to display the add/sol
"RTN","PSJLIVFD",25,0)
 S PSJLMX=0 D WRTDRG^PSJLIUTL("AD")
"RTN","PSJLIVFD",26,0)
SOL ;
"RTN","PSJLIVFD",27,0)
 S PSJL="" D FLDNO^PSJLIUTL("(2)",1)
"RTN","PSJLIVFD",28,0)
 S PSJL=PSJL_"Solutions:"
"RTN","PSJLIVFD",29,0)
 I P("SYRS")]"" D
"RTN","PSJLIVFD",30,0)
 . S PSJL=$$SETSTR^VALM1("Syr. Size:",PSJL,52,10)_$E(P("SYRS"),1,13)
"RTN","PSJLIVFD",31,0)
 . S:$L(P("SYRS"))>13 PSJL=PSJL_"..."
"RTN","PSJLIVFD",32,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",33,0)
 D WRTDRG^PSJLIUTL("SOL")
"RTN","PSJLIVFD",34,0)
DUR ;
"RTN","PSJLIVFD",35,0)
 S PSJL=""
"RTN","PSJLIVFD",36,0)
 N DUROUT,IVLIMIT S DUROUT=$$GETDUR^PSJLIVMD(PSGP,+PSJORD,$S(PSJORD["P":"P",1:"IV"))
"RTN","PSJLIVFD",37,0)
 I $G(PSJORD)["P" N ND25 S ND25=$G(^PS(53.1,+PSJORD,2.5)),IVLIMIT=$P(ND25,"^",4) D
"RTN","PSJLIVFD",38,0)
 .S IVLIMIT=$S(IVLIMIT]"":$$FMTDUR^PSJLIVMD(IVLIMIT),1:"") S:IVLIMIT]"" DUROUT=IVLIMIT
"RTN","PSJLIVFD",39,0)
 S LABEL=$S($G(IVLIMIT):"IV Limit: ",1:"Duration: ") K IVLIMIT
"RTN","PSJLIVFD",40,0)
 S PSJL=$$SETSTR^VALM1(LABEL,PSJL,12,10)
"RTN","PSJLIVFD",41,0)
 S PSJL=PSJL_DUROUT
"RTN","PSJLIVFD",42,0)
START ;
"RTN","PSJLIVFD",43,0)
 D FLDNO^PSJLIUTL("(4)",47)
"RTN","PSJLIVFD",44,0)
 S PSJL=$$SETSTR^VALM1("Start:",PSJL,56,7)_$$STARTDT^PSJLIUTL
"RTN","PSJLIVFD",45,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",46,0)
 NEW PSGRSD,PSGRSDN,PSGRFD,PSGRFDN
"RTN","PSJLIVFD",47,0)
 S PSJL="" I $G(PSJORD)["P",$G(PSGRDTX) D
"RTN","PSJLIVFD",48,0)
 . N RSDLABL,PSJRQB,PSJRQL,PSGRSD,PSGSRSDN
"RTN","PSJLIVFD",49,0)
 . S RSDLABL="     REQUESTED START: ",PSJRQB=41,PSJRQL=39,PSGRSD="",PSGRSDN=""
"RTN","PSJLIVFD",50,0)
 . I $G(PSGRDTX(+$G(PSJORD),"PSGRSD")),$G(P(2)) S PSJRQB=51,PSJRQL=29 D
"RTN","PSJLIVFD",51,0)
 .. S PSGRSD=PSGRDTX(+$G(PSJORD),"PSGRSD"),PSGRSDN=$$ENDTC^PSGMI(+PSGRSD),RSDLABL="Calc Start: "
"RTN","PSJLIVFD",52,0)
 . I '$G(P(2)),'$P(PSGRDTX,U,3) S PSGRSD=+PSGRDTX,PSGRSDN=$$ENDTC^PSGMI(PSGRSD)
"RTN","PSJLIVFD",53,0)
 . I $G(PSGRSD),($G(PSGRSDN)]"") D DSPLYDT^PSJLIVMD(PSJLMX+5,.PSGRSD,.PSGRSDN,RSDLABL,1,PSJRQB,PSJRQL),SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",54,0)
INFRATE ;
"RTN","PSJLIVFD",55,0)
 S PSJL="" D FLDNO^PSJLIUTL("(3)",1)
"RTN","PSJLIVFD",56,0)
 S PSJL=$$SETSTR^VALM1("Infusion Rate:",PSJL,7,15)
"RTN","PSJLIVFD",57,0)
 D LONG^PSJLIUTL(P(8),22,24)
"RTN","PSJLIVFD",58,0)
LASTREN ;
"RTN","PSJLIVFD",59,0)
 N PSGRNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,$S($G(PSJORD):PSJORD,1:$G(ON))) I PSGRNDT D
"RTN","PSJLIVFD",60,0)
 . S PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,54,32)
"RTN","PSJLIVFD",61,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",62,0)
MR ;
"RTN","PSJLIVFD",63,0)
 S PSJL="" D FLDNO^PSJLIUTL("(5)",1)
"RTN","PSJLIVFD",64,0)
 S PSJL=$$SETSTR^VALM1("Med Route:",PSJL,11,11)
"RTN","PSJLIVFD",65,0)
 S PSJL=PSJL_$P(P("MR"),U,2)
"RTN","PSJLIVFD",66,0)
STOP ;
"RTN","PSJLIVFD",67,0)
 D FLDNO^PSJLIUTL("(6)",47)
"RTN","PSJLIVFD",68,0)
 ;PSJ*5*180 - If Invalid Duration/Limit - Cannot Calculate Stop Date
"RTN","PSJLIVFD",69,0)
 S PSJL=$$SETSTR^VALM1("Stop:",PSJL,57,6)_$S($G(PSJBADD)=1:"CANNOT CALCULATE",1:$$STOPDT^PSJLIUTL)
"RTN","PSJLIVFD",70,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",71,0)
 S PSJL=""
"RTN","PSJLIVFD",72,0)
 N PSJBCMA S PSJBCMA=$$BCMALG^PSJUTL2(DFN,PSJORD)
"RTN","PSJLIVFD",73,0)
 I $G(PSJBCMA)]"" S PSJL=$$SETSTR^VALM1(PSJBCMA,PSJL,1,52)
"RTN","PSJLIVFD",74,0)
 I $G(PSGRDTX(+PSJORD,"PSGRFD")) S PSGRFD=PSGRDTX(+PSJORD,"PSGRFD"),PSGRFDN=$$ENDTC^PSGMI(PSGRFD) D
"RTN","PSJLIVFD",75,0)
 . D DSPLYDT^PSJLIVMD(PSJLMX+7,.PSGRFD,.PSGRFDN," Calc Stop: ",0,51,29)
"RTN","PSJLIVFD",76,0)
 D:($G(PSJBCMA)]"")!($G(PSGRFD)]"") SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",77,0)
SCH ;
"RTN","PSJLIVFD",78,0)
 S PSJL="" D FLDNO^PSJLIUTL("(7)",1)
"RTN","PSJLIVFD",79,0)
 S PSJL=$$SETSTR^VALM1("Schedule:",PSJL,12,11)
"RTN","PSJLIVFD",80,0)
 D LONG^PSJLIUTL(P(9),22,32) S PSJL=PSJL_$S(P(7):"@0 labels a day",1:"")
"RTN","PSJLIVFD",81,0)
LASTFL ;
"RTN","PSJLIVFD",82,0)
 S PSJL=$$SETSTR^VALM1("Last Fill:",PSJL,52,11)
"RTN","PSJLIVFD",83,0)
 S PSJL=PSJL_$$ENDTC^PSGMI(P("LF"))
"RTN","PSJLIVFD",84,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",85,0)
ADM ;
"RTN","PSJLIVFD",86,0)
 S PSJL="" D FLDNO^PSJLIUTL("(8)",1)
"RTN","PSJLIVFD",87,0)
 S PSJL=$$SETSTR^VALM1("Admin Times:",PSJL,9,14)
"RTN","PSJLIVFD",88,0)
 D LONG^PSJLIUTL(P(11),22,30)
"RTN","PSJLIVFD",89,0)
QTY ;
"RTN","PSJLIVFD",90,0)
 S PSJL=$$SETSTR^VALM1("Quantity:",PSJL,53,10)_+P("LFA")
"RTN","PSJLIVFD",91,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",92,0)
PROVIDER ;
"RTN","PSJLIVFD",93,0)
 S PSJL="" D FLDNO^PSJLIUTL("(9)",1)
"RTN","PSJLIVFD",94,0)
 S PSJL=$$SETSTR^VALM1("Provider:",PSJL,12,10)_$$PROVIDER^PSJLIUTL
"RTN","PSJLIVFD",95,0)
CUMDOSES ;
"RTN","PSJLIVFD",96,0)
 S PSJL=$$SETSTR^VALM1("Cum. Doses:",PSJL,51,12)_P("CUM")
"RTN","PSJLIVFD",97,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",98,0)
OPI ;
"RTN","PSJLIVFD",99,0)
 S PSJL="" D FLDNO^PSJLIUTL("(10)",1)
"RTN","PSJLIVFD",100,0)
 S PSJL=$$SETSTR^VALM1("Other Print"_$S($P(P("OPI"),"^",2)=1:"!: ",1:": "),PSJL,9,13)_$P(P("OPI"),"^")
"RTN","PSJLIVFD",101,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",102,0)
PC ;
"RTN","PSJLIVFD",103,0)
 S PSJL=""
"RTN","PSJLIVFD",104,0)
 S PSJL=$$SETSTR^VALM1("Provider Comments:",PSJL,3,18) D WTPC^PSJLIUTL
"RTN","PSJLIVFD",105,0)
REMARK ;
"RTN","PSJLIVFD",106,0)
 D SETTMP^PSJLMPRU("PSJI","")
"RTN","PSJLIVFD",107,0)
 S PSJL="" D FLDNO^PSJLIUTL("(11)",1)
"RTN","PSJLIVFD",108,0)
 S PSJL=$$SETSTR^VALM1("Remarks :",PSJL,8,10)
"RTN","PSJLIVFD",109,0)
 D LONG^PSJLIUTL(P("REM"),18,62)
"RTN","PSJLIVFD",110,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",111,0)
IVROOM ;
"RTN","PSJLIVFD",112,0)
 S PSJL=""
"RTN","PSJLIVFD",113,0)
 S PSJL=$$SETSTR^VALM1("IV Room:",PSJL,9,9)_$P(P("IVRM"),U,2)
"RTN","PSJLIVFD",114,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",115,0)
ENTRY ;
"RTN","PSJLIVFD",116,0)
 S PSJL="",PSJL=$$SETSTR^VALM1("Entry By:",PSJL,8,10)
"RTN","PSJLIVFD",117,0)
 S PSJL=PSJL_$S($P(P("CLRK"),U,2)]"":$E($P(P("CLRK"),U,2),1,18),1:"*** Undefined")
"RTN","PSJLIVFD",118,0)
 S PSJL=$$SETSTR^VALM1("Entry Date:",PSJL,51,12)_$$ENDTC^PSGMI(P("LOG"))
"RTN","PSJLIVFD",119,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",120,0)
 S PSJL="" S PSGLRN=$$LASTRNBY^PSJLMPRI(DFN,$S($G(PSJORD):PSJORD,1:$G(ON))) I PSGLRN D
"RTN","PSJLIVFD",121,0)
 . S PSJL=$$SETSTR^VALM1("Renewed By: ",PSJL,6,12)_$$ENNPN^PSGMI(PSGLRN) D SETTMP^PSJLMPRU("PSJI",PSJL) K PSGLRN
"RTN","PSJLIVFD",122,0)
 S VALM("TITLE")=$$CODES^PSIVUTL(P(17),$S($G(ON)["P":53.1,1:55.01),$S(ON["P":28,1:100))_" IV "
"RTN","PSJLIVFD",123,0)
 I $G(P("PRY"))="D"!($G(P("PON"))["P") S VALM("TITLE")=VALM("TITLE")_$S($G(P("PRY"))="":"",1:"("_$$CODES^PSIVUTL(P("PRY"),53.1,.24)_")")
"RTN","PSJLIVFD",124,0)
 I $G(P("PON"))["P" D ORDCHK
"RTN","PSJLIVFD",125,0)
 S VALMCNT=PSJLN-1,^TMP("PSJI",$J,0)=VALMCNT
"RTN","PSJLIVFD",126,0)
 Q
"RTN","PSJLIVFD",127,0)
 ;
"RTN","PSJLIVFD",128,0)
ORDCHK ;Display order check for pending order
"RTN","PSJLIVFD",129,0)
 Q:'$O(^PS(53.1,+ON,10,0))
"RTN","PSJLIVFD",130,0)
 NEW PSJIVX,PSJIVXX
"RTN","PSJLIVFD",131,0)
 F PSJIVX=0:0 S PSJIVX=$O(^PS(53.1,+ON,10,PSJIVX)) Q:'PSJIVX  D
"RTN","PSJLIVFD",132,0)
 . D SETTMP^PSJLMPRU("PSJI","")
"RTN","PSJLIVFD",133,0)
 . S PSJL="CPRS Order Checks  :" D LONG^PSJLIUTL($G(^PS(53.1,+ON,10,PSJIVX,0)),22,60)
"RTN","PSJLIVFD",134,0)
 . D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",135,0)
 . S PSJL="Overriding Provider: "_$P($G(^PS(53.1,+ON,10,PSJIVX,1)),U)
"RTN","PSJLIVFD",136,0)
 . D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",137,0)
 . S PSJL="Overriding Reason  : "
"RTN","PSJLIVFD",138,0)
 . F PSJIVXX=0:0 S PSJIVXX=$O(^PS(53.1,+ON,10,PSJIVX,2,PSJIVXX)) Q:'PSJIVXX  D
"RTN","PSJLIVFD",139,0)
 .. D LONG^PSJLIUTL($G(^PS(53.1,+ON,10,PSJIVX,2,PSJIVXX,0)),22,60)
"RTN","PSJLIVFD",140,0)
 .. D SETTMP^PSJLMPRU("PSJI",PSJL) S PSJL=""
"RTN","PSJLIVFD",141,0)
 Q
"RTN","PSJLIVFD",142,0)
 ;
"RTN","PSJLIVFD",143,0)
SCHREQ(IVAR) ;
"RTN","PSJLIVFD",144,0)
 I $G(IVAR(4))="P"!($G(IVAR(23))="P")!($G(IVAR(5))) Q 1
"RTN","PSJLIVFD",145,0)
 Q 0
"RTN","PSJLMHED")
0^4^B30170338
"RTN","PSJLMHED",1,0)
PSJLMHED ;BIR/MLM-BUILD LM HEADERS ;28 Jan 98 / 2:18 PM
"RTN","PSJLMHED",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**4,58,85,110,148,181**;16 DEC 97;Build 190
"RTN","PSJLMHED",3,0)
 ;
"RTN","PSJLMHED",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJLMHED",5,0)
 ; Reference to CWAD^ORQPT2 is supported by DBIA 2831.
"RTN","PSJLMHED",6,0)
 ; Reference to ^SC is supported by DBIA 10040.
"RTN","PSJLMHED",7,0)
 ;
"RTN","PSJLMHED",8,0)
HDR(DFN) ; -- list screen header
"RTN","PSJLMHED",9,0)
 ;   input:       DFN := ifn of pat
"RTN","PSJLMHED",10,0)
 ;  output:  VALMHDR() := hdr array
"RTN","PSJLMHED",11,0)
 ;
"RTN","PSJLMHED",12,0)
 K VAIN,VADM,GMRA,PSJACNWP,PSJ,VAERR,VA,X
"RTN","PSJLMHED",13,0)
 S PSJACNWP=1 D ENBOTH^PSJAC
"RTN","PSJLMHED",14,0)
 D HDRO(DFN)
"RTN","PSJLMHED",15,0)
 S PSJ="   Sex: "_$P(PSJPSEX,U,2),VALMHDR(4)=$$SETSTR^VALM1($S(PSJPDD:"Last ",1:"     ")_"Admitted: "_$P(PSJPAD,U,2),PSJ,45,23)
"RTN","PSJLMHED",16,0)
 S PSJ="    Dx: "_PSJPDX
"RTN","PSJLMHED",17,0)
 S:PSJPDD VALMHDR(5)=$$SETSTR^VALM1("Discharged: "_$E($P(PSJPDD,U,2),1,8),PSJ,48,26)
"RTN","PSJLMHED",18,0)
 S:'PSJPDD VALMHDR(5)=$$SETSTR^VALM1("Last transferred: "_$$ENDTC^PSGMI(PSJPTD),PSJ,42,26)
"RTN","PSJLMHED",19,0)
 Q
"RTN","PSJLMHED",20,0)
 ;
"RTN","PSJLMHED",21,0)
HDRO(DFN) ; Standardized part of profile header.
"RTN","PSJLMHED",22,0)
 N PSJCLIN,PSJAPPT,PSJCLINN,RMORDT S (PSJCLIN,PSJAPPT)=0,(RMORDAT,PSJCLINN)="" I $G(PSJORD) D
"RTN","PSJLMHED",23,0)
 . S PSJCLIN=$S($G(PSJORD)["V":$G(^PS(55,DFN,"IV",+PSJORD,"DSS")),$G(PSJORD)["U":$G(^PS(55,DFN,5,+PSJORD,8)),$G(PSJORD)["P":$G(^PS(53.1,+PSJORD,"DSS")),1:"")
"RTN","PSJLMHED",24,0)
 . S:PSJCLIN PSJAPPT=$P($G(PSJCLIN),U,2) I PSJCLIN,PSJAPPT S PSJCLINN=$P($G(^SC(+PSJCLIN,0)),U)
"RTN","PSJLMHED",25,0)
 K VALMHDR I PSJCLINN]"" S PSJ=VADM(1),PSJ=$$SETSTR^VALM1("   Clinic: "_PSJCLINN,PSJ,28,26)
"RTN","PSJLMHED",26,0)
 I PSJCLINN="" S PSJ=VADM(1),PSJ=$$SETSTR^VALM1($S('PSJPDD:"     ",1:"Last ")_"Ward: "_PSJPWDN,PSJ,30,18)
"RTN","PSJLMHED",27,0)
 S X=$$CWAD^ORQPT2(DFN)
"RTN","PSJLMHED",28,0)
 S:X]"" X=IORVON_X_IORVOFF,PSJ=$$SETSTR^VALM1(X,PSJ,80-$L(X),80) S VALMHDR(1)=PSJ
"RTN","PSJLMHED",29,0)
 S PSJ="   PID: "_$P(PSJPSSN,U,2)
"RTN","PSJLMHED",30,0)
 S RMORDT=$S($G(PSJPDD):"Last ",1:"     ")_"Room-Bed: "_$G(PSJPRB)
"RTN","PSJLMHED",31,0)
 I PSJCLINN]"",PSJAPPT S RMORDT="Clinic Date: "_$$ENDTC^PSGMI(PSJAPPT),RMORDT=$P(RMORDT,"  ")_" "_$P(RMORDT,"  ",2)
"RTN","PSJLMHED",32,0)
 S PSJ=$$SETSTR^VALM1(RMORDT,PSJ,26,28),VALMHDR(2)=$$SETSTR^VALM1("Ht(cm): "_PSJPHT_" "_PSJPHTD,PSJ,55,25)
"RTN","PSJLMHED",33,0)
 S PSJ="   DOB: "_$P($P(PSJPDOB,U,2)," ")_" ("_PSJPAGE_")",VALMHDR(3)=$$SETSTR^VALM1("Wt(kg): "_PSJPWT_" "_PSJPWTD,PSJ,55,25)
"RTN","PSJLMHED",34,0)
 Q
"RTN","PSJLMHED",35,0)
 ;
"RTN","PSJLMHED",36,0)
INIT(PSJPROT) ; -- init bld vars
"RTN","PSJLMHED",37,0)
 ; PSJPROT=1:UD ONLY; 2:IV ONLY; 3:BOTH
"RTN","PSJLMHED",38,0)
 K PSJUDPRF,^TMP("PSJ",$J),^TMP("PSJON",$J),^TMP("PSJPRO",$J)
"RTN","PSJLMHED",39,0)
 S:PSJPROT=1 PSJUDPRF=1
"RTN","PSJLMHED",40,0)
 D KILL^VALM10(),EN^PSJO1(PSJPROT)
"RTN","PSJLMHED",41,0)
 I '$D(^TMP("PSJ",$J)) W !!,?22,"NO ORDERS FOUND FOR "_$S(PSJOL="S":"SHORT",1:"LONG")_" PROFILE." S VALMQUIT=1 D PAUSE^PSJLMUTL Q
"RTN","PSJLMHED",42,0)
 S PSJTF=0,PSJLN=1,PSJEN=1,PSJC="" F  S PSJC=$O(^TMP("PSJ",$J,PSJC)) Q:PSJC=""  D
"RTN","PSJLMHED",43,0)
 .S PSJF="^PS("_$S("AO"[PSJC:"55,"_PSGP_",5,",PSJC="DF":"55,"_PSGP_",5,",1:"53.1,")
"RTN","PSJLMHED",44,0)
 .I PSJTF'=$E(PSJC,1)!(PSJC="CC")!(PSJC="CD")!(PSJC="BD") Q:PSJC="CB"  Q:PSJC="O"  Q:PSJC="DF"  D TF S PSJTF=$E(PSJC,1)    ;DAM 8-29-07 Added Q:PSJC="CB"  Q:PSJC="O"
"RTN","PSJLMHED",45,0)
 .S PSJST="" F  S PSJST=$O(^TMP("PSJ",$J,PSJC,PSJST)) Q:PSJST=""  D
"RTN","PSJLMHED",46,0)
 .. S PSJS="" F  S PSJS=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS)) Q:PSJS=""  Q:PSJC="CB"  Q:PSJC="O"  Q:PSJC="DF"  D ON      ;DAM 8-29-07  Added Q:PSJC="CB"  Q:PSJC="O"
"RTN","PSJLMHED",47,0)
 .;
"RTN","PSJLMHED",48,0)
 .;DAM 8-29-07   New code to place Pending Orders after Pending Renewal Orders on the roll and scroll display.  Non-Active Orders appear last.
"RTN","PSJLMHED",49,0)
 S PSJTF=0,PSJC="" F  S PSJC=$O(^TMP("PSJ",$J,PSJC)) Q:PSJC=""  D
"RTN","PSJLMHED",50,0)
 . S PSJF="^PS("_$S("AO"[PSJC:"55,"_PSGP_",5,",PSJC="DF":"55,"_PSGP_",5,",1:"53.1,")
"RTN","PSJLMHED",51,0)
 . I PSJC="CB" D TF S PSJTF=$E(PSJC,1)                            ;These are Pending Orders
"RTN","PSJLMHED",52,0)
 . I PSJC="CB" S PSJST="" F  S PSJST=$O(^TMP("PSJ",$J,PSJC,PSJST)) Q:PSJST=""  D
"RTN","PSJLMHED",53,0)
 . . S PSJS="" F  S PSJS=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS)) Q:PSJS=""   D ON
"RTN","PSJLMHED",54,0)
 . I PSJC="DF" D TF S PSJTF=$E(PSJC,1)                              ;These are recently DC Orders (mv)
"RTN","PSJLMHED",55,0)
 . I PSJC="DF" S PSJST="" F  S PSJST=$O(^TMP("PSJ",$J,PSJC,PSJST)) Q:PSJST=""  D
"RTN","PSJLMHED",56,0)
 . . S PSJS="" F  S PSJS=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS)) Q:PSJS=""   D ON
"RTN","PSJLMHED",57,0)
 . I PSJC="O" D TF S PSJTF=$E(PSJC,1)                              ;These are Non-Active Orders
"RTN","PSJLMHED",58,0)
 . I PSJC="O" S PSJST="" F  S PSJST=$O(^TMP("PSJ",$J,PSJC,PSJST)) Q:PSJST=""  D
"RTN","PSJLMHED",59,0)
 . . S PSJS="" F  S PSJS=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS)) Q:PSJS=""   D ON
"RTN","PSJLMHED",60,0)
 .; END DAM changes
"RTN","PSJLMHED",61,0)
 .;
"RTN","PSJLMHED",62,0)
 S VALMCNT=PSJLN-1
"RTN","PSJLMHED",63,0)
DONE ;
"RTN","PSJLMHED",64,0)
 K PSJC,PSJEN,PSJLN,PSJST,PSJS,CNT,PSJPRI
"RTN","PSJLMHED",65,0)
 Q
"RTN","PSJLMHED",66,0)
 ;
"RTN","PSJLMHED",67,0)
ON ;
"RTN","PSJLMHED",68,0)
 S PSJSCHT=$S(PSJOS:PSJS,1:PSJST)
"RTN","PSJLMHED",69,0)
 S PSJO="" F FQ=0:0 S PSJO=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS,PSJO)) Q:PSJO=""  S DN=^(PSJO)   D
"RTN","PSJLMHED",70,0)
 .N PRJPRI S PSJPRI=$S(PSJO["V":$P($G(^PS(55,PSGP,"IV",+PSJO,.2)),"^",4),PSJO["U":$P($G(^PS(55,PSGP,5,+PSJO,.2)),"^",4),1:$P($G(^PS(53.1,+PSJO,.2)),"^",4))
"RTN","PSJLMHED",71,0)
 .S ^TMP("PSJON",$J,PSJEN)=PSJO,PSJL=$J(PSJEN,4) D @$S(PSJO["V":"PIV^PSJLMPRI(PSGP,PSJO,PSJF,DN)",PSJO["U":"PUD^PSJLMPRU(PSGP,PSJO,PSJF,DN)",1:"PIV^PSJLMPRI(PSGP,PSJO,PSJF,DN)") S ^TMP("PSJPRO",$J,0)=PSJEN,PSJEN=PSJEN+1
"RTN","PSJLMHED",72,0)
 Q
"RTN","PSJLMHED",73,0)
 ;
"RTN","PSJLMHED",74,0)
TF ; Set up order type header
"RTN","PSJLMHED",75,0)
 NEW PSJDFHDR
"RTN","PSJLMHED",76,0)
 I $D(^TMP("PSJ",$J,PSJC)) D
"RTN","PSJLMHED",77,0)
 .S PSJDCEXP=$$RECDCEXP^PSJP()
"RTN","PSJLMHED",78,0)
 .S PSJDFHDR="RECENTLY DISCONTINUED/EXPIRED (LAST "_+$G(PSJDCEXP)_" HOURS)"
"RTN","PSJLMHED",79,0)
 .N C,X,Y S C=PSJC,Y="",$P(Y," -",40)=""
"RTN","PSJLMHED",80,0)
 .S X=$S(C="A":$$TXT^PSJO("A"),C["CC":$$TXT^PSJO("PR"),C["CD":$$TXT^PSJO("PC"),C["C":$$TXT^PSJO("P"),C["BD":$$TXT^PSJO("NC"),C["B":$$TXT^PSJO("N"),C["DF":PSJDFHDR,1:$$TXT^PSJO("NA"))
"RTN","PSJLMHED",81,0)
 .S ^TMP("PSJPRO",$J,PSJLN,0)=$E($E(Y,1,(80-$L(X))/2)_" "_X_$E(Y,1,(80-$L(X))/2),1,80),PSJLN=PSJLN+1
"RTN","PSJLMHED",82,0)
 Q
"RTN","PSJLMHED",83,0)
TEST ;
"RTN","PSJLMHED",84,0)
 N X,Y S Y="",$P(Y," -",40)=""
"RTN","PSJLMHED",85,0)
 F X="A C T I V E","P E N D I N G   R E N E W A L S","P E N D I N G ","N O N - V E R I F I E D","N O N - A C T I V E" W !,$E($E(Y,1,(80-$L(X))/2)_" "_X_$E(Y,1,(80-$L(X))/2),1,80)
"RTN","PSJLMHED",86,0)
 Q
"RTN","PSJLMPRI")
0^11^B19651424
"RTN","PSJLMPRI",1,0)
PSJLMPRI ;BIR/MLM-INPATIENT LISTMAN IV PROFILE UTILITIES ;01 JUL 96 / 2:24 PM
"RTN","PSJLMPRI",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**58,85,118,110,133,154,181**;16 DEC 97;Build 190
"RTN","PSJLMPRI",3,0)
 ;
"RTN","PSJLMPRI",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJLMPRI",5,0)
 ;
"RTN","PSJLMPRI",6,0)
PIV(DFN,ON,PSJF,DN)       ;Setup LM display for IV order. 
"RTN","PSJLMPRI",7,0)
 N ND14,DRG,ON55,P,PSJORIFN,TYP,V,X,Y,PSJFLAG S TYP="?" I ON["V" D
"RTN","PSJLMPRI",8,0)
 .S Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,4,5,8,9,17,23,25 S P(X)=$P(Y,U,X)
"RTN","PSJLMPRI",9,0)
 .S TYP=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I TYP'="O" S TYP="C"
"RTN","PSJLMPRI",10,0)
 .S ON55=ON,P("OT")=$S(P(4)="A":"F",P(4)="H":"H",1:"I") D GTDRG^PSIVORFB,GTOT^PSIVUTL(P(4))
"RTN","PSJLMPRI",11,0)
 .S P("PRY")=$P($G(^PS(55,DFN,"IV",+ON,.2)),U,4),PSJFLAG=$P($G(^(.2)),U,7)
"RTN","PSJLMPRI",12,0)
 .S ND4=$G(^PS(55,DFN,"IV",+ON,4)),V=$S(P("PRY")="D":"d",1:" ")_$S((+PSJSYSU=1&'+$P(ND4,U)):"->",(+PSJSYSU=3&'+$P(ND4,U,4)):"->",1:"") I PSJFLAG D CNTRL^VALM10(PSJLN,1,4,IORVON,IORVOFF,0)
"RTN","PSJLMPRI",13,0)
 .S PSJL=$$SETSTR^VALM1(V,PSJL,6,3)
"RTN","PSJLMPRI",14,0)
 .S ND14=$G(^PS(55,DFN,"IV",+ON,14,0)),ND14=$P(ND14,U,3) S:ND14 ND14=+$G(^(ND14,0))
"RTN","PSJLMPRI",15,0)
 I ON=+ON N PSJEN2,O S PSJEN2=PSJEN,O="" F  S O=$O(^PS(53.1,"ACX",ON,O)) Q:O=""  D
"RTN","PSJLMPRI",16,0)
 .I PSJEN2'=PSJEN S PSJL=$J(PSJEN2,4)
"RTN","PSJLMPRI",17,0)
 .S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+O,O)),U,9),Y=+$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U),PSJFLAG=$P($G(^(.2)),U,7)
"RTN","PSJLMPRI",18,0)
 .D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4)) D @$S($E(P("OT"))'="F":"PUD^PSJLMPRU(DFN,O_""P"",PSJF,DN)",1:"PIV^PSJLMPRI(DFN,O_""P"",PSJF,DN)") S PSJEN2=""
"RTN","PSJLMPRI",19,0)
 I ON["P" S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+ON,0)),U,9),Y=$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U),PSJFLAG=$P($G(^(.2)),U,7) D  I $E(P("OT"))'="F" D PUD^PSJLMPRU(DFN,ON,PSJF,DN) Q
"RTN","PSJLMPRI",20,0)
 . D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4))
"RTN","PSJLMPRI",21,0)
 . S ND14=$G(^PS(53.1,+ON,14,0)),ND14=$P(ND14,U,3) S:ND14 ND14=+$G(^(ND14,0))
"RTN","PSJLMPRI",22,0)
 I $G(PSJFLAG) D CNTRL^VALM10(PSJLN,1,4,IORVON,IORVOFF,0)
"RTN","PSJLMPRI",23,0)
 NEW PSJIVFLG S PSJIVFLG=1
"RTN","PSJLMPRI",24,0)
 S DRG=+$O(DRG("AD",0)) D:DRG PIVAD F  S DRG=$O(DRG("AD",DRG)) Q:'DRG  S PSJL="" D PIVAD
"RTN","PSJLMPRI",25,0)
SOL ;
"RTN","PSJLMPRI",26,0)
 S PSJL=$S($G(PSJIVFLG):PSJL_$S(ON["V":"in",1:"    in"),1:"        in")
"RTN","PSJLMPRI",27,0)
 NEW DRGX,NAME
"RTN","PSJLMPRI",28,0)
 S DRG=0 F  S DRG=+$O(DRG("SOL",DRG)) Q:'DRG  D NAME^PSIVUTL(DRG("SOL",DRG),37,.NAME,0) S DRGX=0 F  S DRGX=$O(NAME(DRGX)) Q:'DRGX  S PSJL=$$SETSTR^VALM1(NAME(DRGX),PSJL,12,60) D:$G(PSJIVFLG) PIV1 D SETTMP,SETSTAT S PSJL="      "
"RTN","PSJLMPRI",29,0)
 ;S DRG=0 F  S DRG=+$O(DRG("SOL",DRG)) Q:'DRG  D NAME^PSIVUTL(DRG("SOL",DRG),39,.NAME,0) S DRGX=0 F  S DRGX=$O(NAME(DRGX)) Q:'DRGX  S PSJL=$$SETSTR^VALM1(NAME(DRGX),PSJL,12,60) D:'$G(PSJIVFLG) SETTMP D:$G(PSJIVFLG) PIV1 S PSJL="      "
"RTN","PSJLMPRI",30,0)
 Q
"RTN","PSJLMPRI",31,0)
PIVAD ; Print IV Additives.
"RTN","PSJLMPRI",32,0)
 NEW NAME
"RTN","PSJLMPRI",33,0)
 D NAME^PSIVUTL(DRG("AD",DRG),39,.NAME,1)
"RTN","PSJLMPRI",34,0)
 I $D(NAME(2)) S PSJL=$$SETSTR^VALM1(NAME(1),PSJL,9,60) D:$G(PSJIVFLG) PIV1 D SETTMP,SETSTAT S PSJL="",PSJL=$$SETSTR^VALM1(NAME(2),PSJL,9,60) D SETTMP,SETSTAT
"RTN","PSJLMPRI",35,0)
 I '$D(NAME(2)) S PSJL=$$SETSTR^VALM1(NAME(1),PSJL,9,60) D:$G(PSJIVFLG) PIV1 D SETTMP,SETSTAT
"RTN","PSJLMPRI",36,0)
 Q
"RTN","PSJLMPRI",37,0)
 ;
"RTN","PSJLMPRI",38,0)
PIV1 ; Print Sched type, start/stop dates, and status.
"RTN","PSJLMPRI",39,0)
 K PSJIVFLG
"RTN","PSJLMPRI",40,0)
 F X=2,3 S P(X)=$E($$ENDTC^PSGMI(P(X)),1,$S($D(PSJEXTP):8,1:5))
"RTN","PSJLMPRI",41,0)
 I '$D(PSJEXTP) S PSJL=$$SETSTR^VALM1(TYP,PSJL,50,1),PSJL=$$SETSTR^VALM1(P(2),PSJL,53,7),PSJL=$$SETSTR^VALM1(P(3),PSJL,60,7),PSJL=$$SETSTR^VALM1($S($G(P(25))]"":P(25),1:P(17)),PSJL,66,2)
"RTN","PSJLMPRI",42,0)
 E  S PSJL=$$SETSTR^VALM1(TYP,PSJL,50,1),PSJL=$$SETSTR^VALM1(P(2),53,7),PSJL=$$SETSTR^VALM1(P(3),PSJL,63,7),PSJL=$$SETSTR^VALM1($S(PSJOL'="L"&($G(P(25))]""):P(25),1:P(17)),PSJL,73,2)
"RTN","PSJLMPRI",43,0)
 I $G(ND14) S ND14=$$ENDTC^PSGMI((ND14)) S PSJL=$$SETSTR^VALM1(ND14,PSJL,$S($D(PSJEXTP):75,1:72),5) K ND14
"RTN","PSJLMPRI",44,0)
 ;* D SETTMP
"RTN","PSJLMPRI",45,0)
 Q
"RTN","PSJLMPRI",46,0)
SETTMP ;
"RTN","PSJLMPRI",47,0)
 S ^TMP($S($G(PSIVLBNM)]"":PSIVLBNM,1:"PSJPRO"),$J,PSJLN,0)=PSJL,PSJLN=PSJLN+1
"RTN","PSJLMPRI",48,0)
 Q
"RTN","PSJLMPRI",49,0)
 ;
"RTN","PSJLMPRI",50,0)
SETSTAT ;
"RTN","PSJLMPRI",51,0)
 I ON["P",$P($G(^PS(53.1,+ON,.2)),"^",4)="S" D CNTRL^VALM10((PSJLN-1),9,9+$L(PSJL),IOINHI_IOBON,IOINORM,0)
"RTN","PSJLMPRI",52,0)
 Q
"RTN","PSJLMPRI",53,0)
 ; 
"RTN","PSJLMPRI",54,0)
LASTREN(DFN,ON) ;
"RTN","PSJLMPRI",55,0)
 N FIL,RNDT,ND0,ND14 S ND14="" I '$G(ON)!'$G(DFN) Q 0
"RTN","PSJLMPRI",56,0)
 S FIL=$S(ON["P":"^PS(53.1,"_+ON_",14,0)",ON["V":"^PS(55,"_DFN_",""IV"","_+ON_",14,0)",ON["U":"^PS(55,"_DFN_",5,"_+ON_",14,0)",1:"")
"RTN","PSJLMPRI",57,0)
 ; Naked reference below refers to either ^PS(53.1,+ON,14,0), ^PS(55,+ON,5,14,0), or ^PS(55,+ON,5,14,0) created using indirection in variable FIL.
"RTN","PSJLMPRI",58,0)
 Q:FIL="" 0
"RTN","PSJLMPRI",59,0)
 S ND14=$G(@(FIL)) I $P(ND14,"^",3) S ND14=$G(^($P(ND14,"^",3),0))
"RTN","PSJLMPRI",60,0)
 Q ND14
"RTN","PSJLMPRI",61,0)
 ;
"RTN","PSJLMPRI",62,0)
LASTRNBY(DFN,ON) ;
"RTN","PSJLMPRI",63,0)
 N FIL,RNBY,ND0,ND14 S RNBY=""
"RTN","PSJLMPRI",64,0)
 S FIL=$S(ON["P":"^PS(53.1,"_+ON_",14,0)",ON["V":"^PS(55,"_DFN_",""IV"","_+ON_",14,0)",ON["U":"^PS(55,"_DFN_",5,"_+ON_",14,0)",1:"")
"RTN","PSJLMPRI",65,0)
 ; Naked reference below refers to either ^PS(53.1,+ON,14,0), ^PS(55,+ON,5,14,0), or ^PS(55,+ON,5,14,0) created using indirection in variable FIL.
"RTN","PSJLMPRI",66,0)
 Q:FIL="" 0
"RTN","PSJLMPRI",67,0)
 S ND14=$G(@(FIL)) I $P(ND14,"^",3) S ND14=$G(^($P(ND14,"^",3),0)),RNBY=$P(ND14,"^",2)
"RTN","PSJLMPRI",68,0)
 Q RNBY
"RTN","PSJLMPRU")
0^10^B14487092
"RTN","PSJLMPRU",1,0)
PSJLMPRU ;BIR/MLM-INPATIENT LISTMAN UD PROFILE UTILITIES ;27 Aug 98 / 8:45 AM
"RTN","PSJLMPRU",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**16,58,85,110,185,181**;16 DEC 97;Build 190
"RTN","PSJLMPRU",3,0)
 ;
"RTN","PSJLMPRU",4,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJLMPRU",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJLMPRU",6,0)
 ;
"RTN","PSJLMPRU",7,0)
PUD(DFN,ON,PSJF,DN) ; Setup LM profile view for UD
"RTN","PSJLMPRU",8,0)
 N PSJFLAG,PSJV
"RTN","PSJLMPRU",9,0)
 ; Naked references on the two lines below refer to full reference ^PS(55,DFN,5,+ON in PSJF using indirection.
"RTN","PSJLMPRU",10,0)
 S ND=$G(@(PSJF_+ON_",0)")),SCH=$G(^(2)),ND4=$G(^(4)),ND6=$G(^(6)),NDP2=$G(^(.2)),PSJFLAG=$P(NDP2,U,7),X=$P(DN,U,2),DO=$S('X:"",1:$G(^(+X))) S:X=.2 DO=$P(DO,U,2)
"RTN","PSJLMPRU",11,0)
 S ND14=$G(@(PSJF_+ON_",14,0)")),RNDT="" I $P(ND14,"^",3) S ND14=$G(^($P(ND14,"^",3),0)),RNDT=$P(ND14,"^")
"RTN","PSJLMPRU",12,0)
 I ("AO"[PSJC)!(PSJC="DF") D
"RTN","PSJLMPRU",13,0)
 .;S V='$P(ND4,"^",UDU),PSJL=$$SETSTR^VALM1($S(ND4="":" ",$P(ND4,"^",12):"D",$P(ND4,"^",18)&($P(ND4,"^",19)!V):"H",$P(ND4,"^",22)&($P(ND4,"^",23)!V):"H",$P(ND4,"^",15)&($P(ND4,"^",16)!V):"R",1:" "),PSJL,5,1)
"RTN","PSJLMPRU",14,0)
 .S V='$P(ND4,"^",UDU),PSJL=$$SETSTR^VALM1($S(ND4="":" ",$P(ND4,"^",12):"D",$P(ND4,"^",19)&$P(ND4,"^",18):"H",$P(ND4,"^",23)&$P(ND4,"^",22):"H",$P(ND4,"^",15)&($P(ND4,"^",16)!V):"R",1:" "),PSJL,5,1)
"RTN","PSJLMPRU",15,0)
 .;S X=$S(+PSJSYSU=1&V:1,+PSJSYSU=3&V:1,1:0)
"RTN","PSJLMPRU",16,0)
 .S PSJV=$S($P(NDP2,U,4)="D":"d",1:" ")_$S(+PSJSYSU=1&V:"->",+PSJSYSU=3&V:"->",1:"   ") I PSJFLAG D CNTRL^VALM10(PSJLN,1,4,IORVON,IORVOFF,0)
"RTN","PSJLMPRU",17,0)
 .S PSJL=$$SETSTR^VALM1(PSJV,PSJL,6,3)
"RTN","PSJLMPRU",18,0)
 ;I $S(PSJC["C":0,1:PSJC["B") S PSJL=$$SETSTR^VALM1($S($P(ND4,"^",12):"D",1:" ")_$S($P(ND,U,4)="I":"",PSJSYSU:"->",1:""),PSJL,6,3)
"RTN","PSJLMPRU",19,0)
 ;I $S(PSJC["C":0,1:PSJC["B") S PSJL=$$SETSTR^VALM1($S($P(ND4,"^",12):"D",1:" ")
"RTN","PSJLMPRU",20,0)
 S RTE=$P(ND,"^",3),SM=$S('$P(ND,"^",5):0,$P(ND,"^",6):1,1:2),STAT=$S($P(ND,U,28)]"":$P(ND,U,28),$P(ND,"^",9)]"":$P(ND,"^",9),1:"NF"),PF=$E("*",$P(ND,"^",20)>0),PSGID=$P(SCH,"^",2),SD=$P(SCH,"^",4),SCH=$P(SCH,"^")
"RTN","PSJLMPRU",21,0)
 I STAT="A",$P(ND,U,27)="R" S STAT="R"
"RTN","PSJLMPRU",22,0)
 ;S NF=$P(DN,"^",3),WS=$S(PSJPWD:$$WS^PSJO(PSJPWD,PSGP,PSJF,+ON),1:0)
"RTN","PSJLMPRU",23,0)
 S NF="",WS=$S(PSJPWD:$$WS^PSJO(PSJPWD,PSGP,PSJF,+ON),1:0)
"RTN","PSJLMPRU",24,0)
 N PSJDISP F PSJDISP=0:0 S PSJDISP=$O(@(PSJF_+ON_",1,"_PSJDISP_")")) Q:'PSJDISP  D
"RTN","PSJLMPRU",25,0)
 .I $P($G(^PSDRUG(+$P($G(@(PSJF_+ON_",1,"_PSJDISP_",0)")),"^"),0)),"^",9)=1 S NF=1
"RTN","PSJLMPRU",26,0)
 NEW DRUGNAME,PSGID1,SD1,LEN,PSGID1,SD1 S LEN=$S($D(PSJEXPT):8,1:5)
"RTN","PSJLMPRU",27,0)
 F X="PSGID","SD" S @(X_1)=$S(PSJC["C":"*****",1:$E($$ENDTC^PSGMI(@X),1,LEN))
"RTN","PSJLMPRU",28,0)
 D DRGDISP^PSJLMUT1(PSGP,ON,39,54,.DRUGNAME,0)
"RTN","PSJLMPRU",29,0)
 F PSJX=0:0 S PSJX=$O(DRUGNAME(PSJX)) Q:'PSJX  D
"RTN","PSJLMPRU",30,0)
 . I PSJX=1 D
"RTN","PSJLMPRU",31,0)
 ..I PSJFLAG D CNTRL^VALM10(PSJLN,1,4,IORVON,IORVOFF,0)
"RTN","PSJLMPRU",32,0)
 ..S PSJL=$$SETSTR^VALM1($S($E(PSJS)="*":$P(PSJS,"^"),1:DRUGNAME(PSJX)),PSJL,9,39)
"RTN","PSJLMPRU",33,0)
 ..S PSJL=$$SETSTR^VALM1($S(PSJC["C":"?",PSJSCHT'="z":PSJSCHT,1:"?"),PSJL,50,3)
"RTN","PSJLMPRU",34,0)
 ..S PSJL=PSJL_PSGID1_"  "_SD1_" "_$E(STAT,1,2)_$S($L(STAT)=1:"     ",1:"    ")_$S($G(RNDT):$E($$ENDTC^PSGMI(RNDT),1,LEN),1:"")
"RTN","PSJLMPRU",35,0)
 ..I NF!WS!SM!PF S PSJL=$$SETSTR^VALM1($S(NF:"NF ",WS:"WS ",SM:$E("HSM",SM,3),1:""),PSJL,69,3) S:PF PSJL=$$SETSTR^VALM1("*",PSJL,79,1)
"RTN","PSJLMPRU",36,0)
 . I PSJX>1 S PSJL="",PSJL=$$SETSTR^VALM1(DRUGNAME(PSJX),PSJL,11,66)
"RTN","PSJLMPRU",37,0)
 . D SETTMP("PSJPRO",PSJL) I ($P(NDP2,U,4)="S"),STAT="P" D CNTRL^VALM10((PSJLN-1),9,9+$L(PSJL),IOINHI_IOBON,IOINORM,0)
"RTN","PSJLMPRU",38,0)
 D:$P(ND6,"^")]"" PTXT($P(ND6,"^"),"PSJPRO",10,66)
"RTN","PSJLMPRU",39,0)
 Q
"RTN","PSJLMPRU",40,0)
 ;
"RTN","PSJLMPRU",41,0)
PTXT(TXT,SUB,LM,RM) ; Display Instructions/dosage ordered.
"RTN","PSJLMPRU",42,0)
 ;* Input:       TXT = Text to display.
"RTN","PSJLMPRU",43,0)
 ;                       SUB = First subscript for ^TMP node, ** MUST be PSJ namespace **
"RTN","PSJLMPRU",44,0)
 ;                       LM  = Begin display of text after LM spaces.
"RTN","PSJLMPRU",45,0)
 ;                       RM  = Length of display text.
"RTN","PSJLMPRU",46,0)
 ;                       
"RTN","PSJLMPRU",47,0)
 ;BHW;PSJ*5*185;Extra spaces causes display to "skip" part of the field. 
"RTN","PSJLMPRU",48,0)
 ;S PSJL="",$P(PSJL," ",LM)="" F X=1:1 S WRD=$P(TXT," ",X) Q:WRD=""  D
"RTN","PSJLMPRU",49,0)
 S PSJL="",$P(PSJL," ",LM)=""
"RTN","PSJLMPRU",50,0)
 F X=1:1:$L(TXT," ") S WRD=$P(TXT," ",X) D
"RTN","PSJLMPRU",51,0)
 .;BHW;PSJ*5*185;check if end of string or just extra space
"RTN","PSJLMPRU",52,0)
 .I WRD="" S PSJL=PSJL_" " Q 
"RTN","PSJLMPRU",53,0)
 .I $L(PSJL_" "_WRD)'<RM D SETTMP(SUB,PSJL) S PSJL="",$P(PSJL," ",10)=""
"RTN","PSJLMPRU",54,0)
 .I $L(PSJL_" "_WRD)'<RM S PSJL=PSJL_" "_$E(WRD,1,(RM-10)) D SETTMP(SUB,PSJL) S PSJL="",$P(PSJL," ",10)="",WRD=$E(WRD,(RM-9),$L(WRD))
"RTN","PSJLMPRU",55,0)
 .S PSJL=PSJL_" "_WRD
"RTN","PSJLMPRU",56,0)
 D SETTMP(SUB,PSJL)
"RTN","PSJLMPRU",57,0)
 Q
"RTN","PSJLMPRU",58,0)
SETTMP(SUB,PSJL) ;
"RTN","PSJLMPRU",59,0)
 S ^TMP(SUB,$J,PSJLN,0)=PSJL,PSJLN=PSJLN+1
"RTN","PSJLMPRU",60,0)
 Q
"RTN","PSJLMUDE")
0^88^B62710638
"RTN","PSJLMUDE",1,0)
PSJLMUDE ;BIR/MLM-SHOW FIELDS FOR EDIT (LISTMAN STYLE) ;01 JUNE 00 / 2:40 PM
"RTN","PSJLMUDE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,47,50,63,64,58,80,116,110,111,164,175,201,181**;16 DEC 97;Build 190
"RTN","PSJLMUDE",3,0)
 ;
"RTN","PSJLMUDE",4,0)
 ;NFI-UD Fr#:2 chgs@init+4 to display non-formulary (N/F)
"RTN","PSJLMUDE",5,0)
 ;also chgs @init+23
"RTN","PSJLMUDE",6,0)
 ;
"RTN","PSJLMUDE",7,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSJLMUDE",8,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192
"RTN","PSJLMUDE",9,0)
 ;
"RTN","PSJLMUDE",10,0)
INIT(PSGP,PSGORD) ;
"RTN","PSJLMUDE",11,0)
 N D,ND,PSJBCMA,PSJL,PSJLM,PSJLN,Q,QQ,PSJDUR K ^TMP("PSJUDE",$J)
"RTN","PSJLMUDE",12,0)
 K:$G(PSJNORD) PSGOEEF S PSJLN=1
"RTN","PSJLMUDE",13,0)
 D CLEAN^VALM10
"RTN","PSJLMUDE",14,0)
 S PSJL=$S($D(PSGEFN(1)):$E(" *",PSGEFN(1)+1)_"(1)",1:"   "),PSJL=$$SETSTR^VALM1("Orderable Item: "_PSGPDN_$$OINF^PSJDIN(PSGPD),PSJL,5,74) D  D SETTMP D:$G(PSGOEEF(108))!($G(PSGOEEF(101))) HILITE(1)
"RTN","PSJLMUDE",15,0)
 . NEW Q,PSJDDA,PSJVD F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,2,Q)) Q:'Q  S PSJDDA(+$G(^(Q,0)))=""
"RTN","PSJLMUDE",16,0)
 . S PSJVD=$$DINFLUD^PSJDIN(PSGPD,.PSJDDA)
"RTN","PSJLMUDE",17,0)
 . S PSJL=$$SETSTR^VALM1(PSJVD,PSJL,75,80)
"RTN","PSJLMUDE",18,0)
 . D:PSJVD]"" CNTRL^VALM10(1,75,5,IORVON,IORVOFF,0)
"RTN","PSJLMUDE",19,0)
 I $G(PSJORD)["P" D REQDT^PSJLIVMD(PSJORD)
"RTN","PSJLMUDE",20,0)
 S PSJL="Instructions: "_PSGOINST D PTXT^PSJLMPRU(PSJL,"PSJUDE",6,80)
"RTN","PSJLMUDE",21,0)
 S PSJL=$S($D(PSGEFN(2)):$E(" *",PSGEFN(2)+1)_"(2)",1:"    "),PSJL=$$SETSTR^VALM1("Dosage Ordered: "_PSGDO,PSJL,5,76) D SETTMP D:$G(PSGOEEF(109)) HILITE(2)
"RTN","PSJLMUDE",22,0)
 I $G(PSGRDTX) S PSJDUR=$$FMTDUR^PSJLIVMD($P($G(PSGRDTX),U,2))
"RTN","PSJLMUDE",23,0)
 I $G(PSJORD),($G(PSJDUR)="") S P=$S(PSJORD["U":5,PSJORD["V":"IV",PSJORD["P":"P",1:-1) S PSJDUR=$$GETDUR^PSJLIVMD(PSGP,+PSJORD,P)
"RTN","PSJLMUDE",24,0)
 S PSJL=$$SETSTR^VALM1("Duration: "_$G(PSJDUR),PSJL,11,25)
"RTN","PSJLMUDE",25,0)
 S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(3)):$E(" *",PSGEFN(3)+1)_"(3)",1:"    ")_"Start: "_$P(PSGSDN,U,2),PSJL,54,26) D:$G(PSGOEEF(10)) HILITE(3)
"RTN","PSJLMUDE",26,0)
 I $G(PSGORD)["P" N ND0,OLDO S ND0=@(PSGOEEWF_"0)") I $P(ND0,"^",24)="R" S OLDO=$P(ND0,"^",25) I OLDO,(OLDO["U") D
"RTN","PSJLMUDE",27,0)
 . N OSTRT,OSTRTN S OSTRT=$G(@("^PS(55,"_PSGP_",5,"_+OLDO_",2)")),OSTRT=$P(OSTRT,"^",2) Q:'OSTRT  S OSTRTN=$$ENDTC^PSGMI(+OSTRT)
"RTN","PSJLMUDE",28,0)
 . S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(3)):$E(" *",PSGEFN(3)+1)_"(3)",1:"    ")_"Start: "_OSTRTN,PSJL,54,26)
"RTN","PSJLMUDE",29,0)
 D SETTMP
"RTN","PSJLMUDE",30,0)
 S PSJL=$S($D(PSGEFN(4)):$E(" *",PSGEFN(4)+1)_"(4)",1:"    "),PSJL=$$SETSTR^VALM1("Med Route: "_PSGMRN,PSJL,10,35) D:$G(PSGOEEF(3)) HILITE(4)
"RTN","PSJLMUDE",31,0)
 I $G(PSJORD)["P" N PSGRNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,PSGORD) S:PSGRNDT PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,56,32)
"RTN","PSJLMUDE",32,0)
 I '$G(PSGRNDT),$G(PSGRDTX) D
"RTN","PSJLMUDE",33,0)
 . I $D(PSGRDTX)<10 S PSGRSDN=$$ENDTC^PSGMI(+PSGRDTX),PSJL=$$SETSTR^VALM1("REQUESTED START: "_PSGRSDN,PSJL,48,32) Q
"RTN","PSJLMUDE",34,0)
 . I $G(PSGRDTX(+$G(PSJORD),"PSGRSD")),$P($G(PSGSDN),U,2) S PSGRSDN=$$ENDTC^PSGMI(PSGRDTX(+PSJORD,"PSGRSD")),PSJL=$$SETSTR^VALM1("Calc Start: "_PSGRSDN,PSJL,53,32) D
"RTN","PSJLMUDE",35,0)
 .. I PSGSD'=PSGRDTX(+PSJORD,"PSGRSD") D CNTRL^VALM10(5,53,80,IORVON,IORVOFF)
"RTN","PSJLMUDE",36,0)
 ; Indirect reference in PSGOEEWF below refers to either ^PS(53.1 or ^PS(55,DFN,5,. Naked reference refers to full indirect reference
"RTN","PSJLMUDE",37,0)
 I $G(PSJORD)["U" N ND14 S ND14=$G(@(PSGOEEWF_"14,0)")) I ND14]"" S ND14=$G(^($P(ND14,"^",3),0)),RNDT=$P(ND14,"^") I RNDT D
"RTN","PSJLMUDE",38,0)
 . N PSGRNDT S PSGRNDT=$$ENDTC^PSGMI(+RNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,56,32)
"RTN","PSJLMUDE",39,0)
 D SETTMP
"RTN","PSJLMUDE",40,0)
 I PSGORD]"" S PSJBCMA=$$BCMALG^PSJUTL2(PSGP,PSGORD)
"RTN","PSJLMUDE",41,0)
 I $G(PSJBCMA)]"" S PSJL=$$SETSTR^VALM1(PSJBCMA,PSJL,1,52)
"RTN","PSJLMUDE",42,0)
 S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(5)):$E(" *",PSGEFN(5)+1)_"(5)",1:"     ")_" Stop: "_$P(PSGFDN,U,2),PSJL,54,26) D SETTMP D:$G(PSGOEEF(25))!($G(PSGOEEF(34))) HILITE(5)
"RTN","PSJLMUDE",43,0)
 S PSJL=$S($D(PSGEFN(6)):$E(" *",PSGEFN(6)+1)_"(6)",1:"   "),PSJL=$$SETSTR^VALM1("Schedule Type: "_PSGSTN,PSJL,6,45) D:$G(PSGOEEF(7)) HILITE(6)
"RTN","PSJLMUDE",44,0)
 I $G(PSJORD)["P",$G(PSGRDTX(+$G(PSJORD),"PSGRFD")),$P($G(PSGFDN),U,2) S PSGRFDN=$$ENDTC^PSGMI(PSGRDTX(+PSJORD,"PSGRFD")),PSJL=$$SETSTR^VALM1("Calc Stop: "_PSGRFDN,PSJL,54,26) D
"RTN","PSJLMUDE",45,0)
 . I PSGFD'=PSGRDTX(+PSJORD,"PSGRFD") D CNTRL^VALM10(7,54,80,IORVON,IORVOFF)
"RTN","PSJLMUDE",46,0)
 D SETTMP
"RTN","PSJLMUDE",47,0)
 S PSGSMN=$P("NO^YES",U,PSGSM+1)
"RTN","PSJLMUDE",48,0)
 S PSJL=$S($D(PSGEFN(8)):$E(" *",PSGEFN(8)+1)_"(8)",1:"   "),PSJL=$$SETSTR^VALM1("Schedule: "_PSGSCH_$G(SCHMSG),PSJL,11,68) D SETTMP D:$G(PSGOEEF(26)) HILITE(8)
"RTN","PSJLMUDE",49,0)
 S PSJL=$S($D(PSGEFN(9)):$E(" *",PSGEFN(9)+1)_"(9)",1:"   "),PSJL=$$SETSTR^VALM1("Admin Times: "_PSGAT,PSJL,8,71) D SETTMP D:$G(PSGOEEF(39))!($G(PSGOEEF(41))) HILITE(9)
"RTN","PSJLMUDE",50,0)
 S PSJL=$S($D(PSGEFN(10)):$E(" *",PSGEFN(10)+1)_"(10)",1:"   "),PSJL=$$SETSTR^VALM1("Provider: "_PSGPRN,PSJL,11,68) D:$G(PSGOEEF(1)) HILITE(10) D SETTMP
"RTN","PSJLMUDE",51,0)
 ;S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(7)):$E(" *",PSGEFN(7)+1)_"(7)",1:"   ")_"Self Med: "_PSGSMN,PSJL,56,24) S:PSGSM&PSGHSM PSJL=$$SETSTR^VALM1("  (HS)",PSJL,71,7) D SETTMP D:$G(PSGOEEF(5)) HILITE(7)
"RTN","PSJLMUDE",52,0)
 S PSJL=$S($D(PSGEFN(11)):$E(" *",PSGEFN(11))_"(11)",1:"   ")_" Special Instructions"_$S($P(PSGSI,"^",2)=1:"!: ",1:": ")_$P(PSGSI,"^") D PTXT^PSJLMPRU(PSJL,"PSJUDE",1,80)
"RTN","PSJLMUDE",53,0)
 S PSJL="" D SETTMP D:$G(PSGOEEF(8)) HILITE(11)
"RTN","PSJLMUDE",54,0)
 ; E3R 16130
"RTN","PSJLMUDE",55,0)
 I $O(^PS(53.45,PSJSYSP,2,1)) F  S PSJL="" D SETTMP Q:PSJLN>15
"RTN","PSJLMUDE",56,0)
 S PSJL=$S($D(PSGEFN(12)):$E(" *",PSGEFN(12))_" (12)",1:"   ")_" Dispense Drug",PSJL=$$SETSTR^VALM1("U/D",PSJL,54,60),PSJL=$$SETSTR^VALM1("Inactive Date",PSJL,65,16) D SETTMP,CNTRL^VALM10(13,1,80,IOUON,IOUOFF,0)
"RTN","PSJLMUDE",57,0)
 ;S $P(PSJL,"-",80)="" D SETTMP
"RTN","PSJLMUDE",58,0)
 NEW PSJX
"RTN","PSJLMUDE",59,0)
 F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,2,Q)) Q:'Q  S ND=$G(^(Q,0)) D
"RTN","PSJLMUDE",60,0)
 .S D=$P(ND,"^"),PSGID=$P(ND,"^",3) I PSGID S PSGID=$$ENDTC^PSGMI(PSGID)
"RTN","PSJLMUDE",61,0)
 .S D=$S(D="":"NOT FOUND",'$D(^PSDRUG(D,0)):D,$P(^(0),"^")]"":$P(^(0),"^"),1:D_";PSDRUG(")
"RTN","PSJLMUDE",62,0)
 .S PSJL="      "_D_$$DDNF^PSJDIN(+ND),PSJL=$$SETSTR^VALM1($S($P(ND,"^",2):$S($P(ND,"^",2)=.5:"1/2",$P(ND,"^",2)=.25:"1/4",1:$P(ND,"^",2)),$P(ND,"^",2)=0:0,1:1),PSJL,54,63) S:PSGID PSJL=$$SETSTR^VALM1(PSGID,PSJL,65,16) D  D SETTMP
"RTN","PSJLMUDE",63,0)
 ..S PSJX=$G(PSJX)+1
"RTN","PSJLMUDE",64,0)
 ..I $G(PSGOEEF(109)) D CNTRL^VALM10(13+PSJX,7,73,IORVON_IOBON,IORVOFF_IOBOFF,0)
"RTN","PSJLMUDE",65,0)
 I $S(PSGORD["P":$O(^PS(53.1,+$G(PSGORD),12,0)),1:$O(^PS(55,PSGP,5,+PSGORD,12,0))) S PSJL="Provider Comments:" D SETTMP S PSJL="" D
"RTN","PSJLMUDE",66,0)
 .F Q=0:0 S Q=$S(PSGORD["P":$O(^PS(53.1,+$G(PSGORD),12,Q)),1:$O(^PS(55,PSGP,5,+PSGORD,12,Q))) Q:'Q  S PSJL=$G(^(Q,0)) D SETTMP
"RTN","PSJLMUDE",67,0)
 D SETTMP S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(7)):$E(" *",PSGEFN(7)+1)_"(7)",1:"   ")_"Self Med: "_PSGSMN,PSJL,1,24)
"RTN","PSJLMUDE",68,0)
 S:PSGSM&PSGHSM PSJL=$$SETSTR^VALM1("  (HS)",PSJL,16,7) D SETTMP D:$G(PSGOEEF(5)) HILITE(7)
"RTN","PSJLMUDE",69,0)
 D SETTMP S PSJL="Entry By: "_PSGEBN,PSJL=$$SETSTR^VALM1("Entry Date: "_$P(PSGLIN,U,2),PSJL,51,39) D SETTMP
"RTN","PSJLMUDE",70,0)
 I $G(PSGLRN) D SETTMP S PSJL="Renewed By: "_$$ENNPN^PSGMI($P(PSGLRN,"^",2)) D SETTMP
"RTN","PSJLMUDE",71,0)
 D SETTMP S PSJL="(13)"_" Comments:"
"RTN","PSJLMUDE",72,0)
 D:'$O(^PS(53.45,PSJSYSP,1,0)) SETTMP
"RTN","PSJLMUDE",73,0)
 D SETTMP F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,1,Q)) Q:'Q  S PSJWPL=PSJL_$S($E(PSJL)=" ":"",1:" ")_$G(^(Q,0)),PSJL="" D DISPLAY
"RTN","PSJLMUDE",74,0)
 D SETTMP
"RTN","PSJLMUDE",75,0)
 I PSGORD["P",($P($G(^PS(53.1,+PSGORD,0)),U,9)="P"),$O(^PS(53.1,+PSGORD,10,0)) D
"RTN","PSJLMUDE",76,0)
 .D SETTMP S PSJL="CPRS Order Checks:" D SETTMP
"RTN","PSJLMUDE",77,0)
 .F Q=0:0 S Q=$O(^PS(53.1,+PSGORD,10,Q)) Q:'Q  D
"RTN","PSJLMUDE",78,0)
 ..;S PSJL="" D SETTMP S PSJL=$G(^PS(53.1,+PSGORD,10,Q,0)) D SETTMP
"RTN","PSJLMUDE",79,0)
 ..S PSJL="" D SETTMP
"RTN","PSJLMUDE",80,0)
 ..D FORMATTX($G(^PS(53.1,+PSGORD,10,Q,0)))
"RTN","PSJLMUDE",81,0)
 ..S PSJL="Overriding Provider: "_$P($G(^PS(53.1,+PSGORD,10,Q,1)),U) D SETTMP
"RTN","PSJLMUDE",82,0)
 ..S PSJL="Overriding Reason: " F X=0:0 S X=$O(^PS(53.1,+PSGORD,10,Q,2,X)) Q:'X   D
"RTN","PSJLMUDE",83,0)
 ...S PSJL=PSJL_$G(^PS(53.1,+PSGORD,10,Q,2,X,0)) D SETTMP S PSJL="                   "
"RTN","PSJLMUDE",84,0)
ACTFLG ;
"RTN","PSJLMUDE",85,0)
 S ND4=$S(PSGORD["P":$G(^PS(53.1,+PSGORD,4)),1:$G(^PS(55,PSGP,5,+PSGORD,4)))
"RTN","PSJLMUDE",86,0)
 S AT="",Y="12,13,D,18,19,H1,22,23,H0,15,16,R" F X=1:3:12 I $P(ND4,"^",$P(Y,",",X)),$P(ND4,"^",$P(Y,",",X+1)) S AT=$P(Y,",",X+2) Q
"RTN","PSJLMUDE",87,0)
 I AT="",'$P(ND4,"^",$S($P(PSJSYSU,";",3)>1:3,1:1)) S AT="V"_$S($P(ND4,"^",18):"H1",$P(ND4,"^",22):"H0",$P(ND4,"^",15):"R",1:"")
"RTN","PSJLMUDE",88,0)
 I AT]"" D
"RTN","PSJLMUDE",89,0)
 .S PSJL="" D SETTMP
"RTN","PSJLMUDE",90,0)
 .S PSJL="ORDER "_$S(AT["V":"NOT VERIFIED"_$S($P(AT,"V",2)="":"",1:" ("_$S(AT["H1":"ON HOLD",AT["H0":"OFF HOLD",1:"RENEWAL")_")"),1:"MARKED TO BE "_$S(AT["D":"CANCELLED",AT["H1":"PLACED ON HOLD",AT["H0":"TAKEN OFF OF HOLD",1:"RENEWED"))
"RTN","PSJLMUDE",91,0)
 I AT'["V",AT["H1",$D(^PS(55,PSGP,5.1)) S AT=^(5.1) I $P(AT,"^",7),$P(AT,"^",10)]"" S PSJL=PSJL_"  ("_$P(AT,"^",10)_")"
"RTN","PSJLMUDE",92,0)
 D SETTMP
"RTN","PSJLMUDE",93,0)
 S VALMCNT=PSJLN-1
"RTN","PSJLMUDE",94,0)
 K PSGSMN,Q,Y,Y1,Y2,PSGLRN
"RTN","PSJLMUDE",95,0)
 S VALM("TITLE")=PSGSTAT_" UNIT DOSE "_$S((PSGSTAT="PENDING")&($G(PSGPRIO)]""):"("_PSGPRIO_")",$G(PSGPRIO)="DONE":"("_PSGPRIO_")",1:"") I $D(PSJLMP2) S VALMBG=16 K PSJLMP2
"RTN","PSJLMUDE",96,0)
TEST ;
"RTN","PSJLMUDE",97,0)
 I $G(PSGPFLG) S VALMSG="INVALID ORDERABLE ITEM"
"RTN","PSJLMUDE",98,0)
 I $G(PSGDI) S VALMSG=$S($G(VALMSG)="":"INVALID",1:VALMSG_",")_" DISPENSE DRUG"
"RTN","PSJLMUDE",99,0)
 I $G(PSGPI) S VALMSG=$S($G(VALMSG)="":"INVALID",1:VALMSG_",")_" PROVIDER"
"RTN","PSJLMUDE",100,0)
 Q
"RTN","PSJLMUDE",101,0)
DISPLAY ;
"RTN","PSJLMUDE",102,0)
 S PSJL=PSJWPL D SETTMP
"RTN","PSJLMUDE",103,0)
 ;F X=1:1 S WRD=$P(PSJWPL," ",X) Q:WRD=""  D
"RTN","PSJLMUDE",104,0)
 ;.I $L(PSJL_" "_WRD)'<80 D SETTMP S PSJL=$P(PSJWPL,PSJL,2) S:$E(PSJL,1)=" " PSJL=$E(PSJL,2,999),PSJWPL="" Q
"RTN","PSJLMUDE",105,0)
 ;.S PSJL=PSJL_$S(PSJL="":"",1:" ")_WRD
"RTN","PSJLMUDE",106,0)
 Q
"RTN","PSJLMUDE",107,0)
 ;
"RTN","PSJLMUDE",108,0)
SETTMP ;
"RTN","PSJLMUDE",109,0)
 S ^TMP("PSJUDE",$J,PSJLN,0)=PSJL,PSJLN=PSJLN+1,PSJL=""
"RTN","PSJLMUDE",110,0)
 Q
"RTN","PSJLMUDE",111,0)
 ;
"RTN","PSJLMUDE",112,0)
HILITE(FLD) ; 
"RTN","PSJLMUDE",113,0)
 N COL,LIN,WID,X
"RTN","PSJLMUDE",114,0)
 ;Q:'$G(PSGOEENO)
"RTN","PSJLMUDE",115,0)
 S X="$T("_FLD_"^PSJLMUDE)",@("X="_X),X=$P(X,";;",2),LIN=+X,COL=$P(X,",",2),LAB=$P(X,",",3),X=$P(X,",",4),WID=(LAB+$L(@X))
"RTN","PSJLMUDE",116,0)
 ;D CNTRL^VALM10(LIN,COL,WID,IORVON_IOBON,IOINORM,0)
"RTN","PSJLMUDE",117,0)
 I FLD=7 S LIN=+$G(PSJLN)-1 Q:LIN<13
"RTN","PSJLMUDE",118,0)
 D CNTRL^VALM10(LIN,COL,WID,IORVON_IOBON,IORVOFF_IOBOFF,0)
"RTN","PSJLMUDE",119,0)
 Q
"RTN","PSJLMUDE",120,0)
 ;
"RTN","PSJLMUDE",121,0)
FORMATTX(PSJX) ;
"RTN","PSJLMUDE",122,0)
 NEW PSJX1,Y,Y1
"RTN","PSJLMUDE",123,0)
 S PSJX1=""
"RTN","PSJLMUDE",124,0)
 F Y=1:1:$L(PSJX," ") S Y1=$P(PSJX," ",Y) D
"RTN","PSJLMUDE",125,0)
 . I ($L(PSJX1)+$L(Y1)+1)>79 S:$E(PSJX1,1,1)=" " PSJX1=$E(PSJX1,2,$L(PSJX1)) S PSJL=PSJX1,PSJX1="" D SETTMP
"RTN","PSJLMUDE",126,0)
 . S PSJX1=PSJX1_Y1_" "
"RTN","PSJLMUDE",127,0)
 I PSJX1]"" S PSJL=PSJX1 D SETTMP
"RTN","PSJLMUDE",128,0)
 K PSJX1
"RTN","PSJLMUDE",129,0)
 Q
"RTN","PSJLMUDE",130,0)
 ;
"RTN","PSJLMUDE",131,0)
1 ;;1,5,16,PSGPDN
"RTN","PSJLMUDE",132,0)
2 ;;3,5,16,PSGDO
"RTN","PSJLMUDE",133,0)
3 ;;4,58,7,PSGSDN
"RTN","PSJLMUDE",134,0)
4 ;;5,10,11,PSGMRN
"RTN","PSJLMUDE",135,0)
5 ;;6,59,6,PSGFDN
"RTN","PSJLMUDE",136,0)
6 ;;7,6,15,PSGSTN
"RTN","PSJLMUDE",137,0)
7 ;;18,5,14,PSGSMN
"RTN","PSJLMUDE",138,0)
8 ;;8,11,12,PSGSCH
"RTN","PSJLMUDE",139,0)
9 ;;9,8,13,PSGAT
"RTN","PSJLMUDE",140,0)
10 ;;10,11,10,PSGPRN
"RTN","PSJLMUDE",141,0)
11 ;;11,7,22,PSGSI
"RTN","PSJLMUDE",142,0)
ENKILL ;
"RTN","PSJLMUDE",143,0)
 K PSGAT,PSGEB,PSGEFN,PSGFD,PSGHSM,PSGNEFD,PSGNESD,PSGOEEF,PSGOEER,PSGOFD,PSGOHSM,PSGOMR,PSGOMRN,PSGOPD,PSGOPDN,PSGOPR,PSGOSCH,PSGOSD,PSGOSM,PSGOST,PSGPD,PSGPDN,PSGPR,PSGSD,PSGSM Q
"RTN","PSJLMUT1")
0^71^B67028323
"RTN","PSJLMUT1",1,0)
PSJLMUT1 ;BIR/MLM-DRUG NAME DISPLAY ;05 Feb 98 / 1:39 PM
"RTN","PSJLMUT1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**4,27,29,49,58,107,110,146,175,201,181**;16 DEC 97;Build 190
"RTN","PSJLMUT1",3,0)
 ;
"RTN","PSJLMUT1",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJLMUT1",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJLMUT1",6,0)
 ; Reference to ^PS(50.606 is supported by DBIA# 2174.
"RTN","PSJLMUT1",7,0)
 ; Reference to EN^PSODRDU2 is supported by DBIA# 2189.
"RTN","PSJLMUT1",8,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSJLMUT1",9,0)
 ;
"RTN","PSJLMUT1",10,0)
DRGDISP(DFN,ON,NL,GL,NAME,DRUGONLY)       ;
"RTN","PSJLMUT1",11,0)
 ;; DRUGONLY = 1/0 - Only the drug name will be returned.
"RTN","PSJLMUT1",12,0)
 ;; NL       = The drug name display length
"RTN","PSJLMUT1",13,0)
 ;; GL       = The give line display length, total length-6 ("Give: ")
"RTN","PSJLMUT1",14,0)
 ;; NAME(X)  = Drug name and give line in displayable format.
"RTN","PSJLMUT1",15,0)
 ;; ON       = IEN#_U/P (U=Unit Dose; P=Pending)
"RTN","PSJLMUT1",16,0)
 ;
"RTN","PSJLMUT1",17,0)
 NEW F,OIND,MARX,MR,NOTGV,SCH,PSGUPDDO,PSGGV,X,PSGX,PSGINS,DRUGNAME
"RTN","PSJLMUT1",18,0)
 K NAME S PSGINS=""
"RTN","PSJLMUT1",19,0)
 S:ON["U" F="^PS(55,DFN,5,+ON,"
"RTN","PSJLMUT1",20,0)
 I ON["P" S F="^PS(53.1,+ON,",X=$G(@(F_".3)")),PSGINS=$S(X]"":X,1:"")
"RTN","PSJLMUT1",21,0)
 I $G(@(F_"0)"))="" S NAME(1)="NOT FOUND" Q
"RTN","PSJLMUT1",22,0)
 S OIND=$G(@(F_".2)")),PSGUPDDO=$P(OIND,U,2),X=@(F_"0)"),NOTGV=$P(X,U,22),MR=$$ENMRN^PSGMI(+$P(X,U,3))
"RTN","PSJLMUT1",23,0)
 I '+OIND,($P(X,U,4)'="U") NEW DRG D GTDRG^PSIVORFA F X="AD","SOL" Q:+OIND  F PSGX=0:0 S PSGX=$O(DRG(X,PSGX)) Q:'PSGX  S OIND=$P(DRG(X,PSGX),U,6) Q:+OIND
"RTN","PSJLMUT1",24,0)
 S SCH=$P($G(@(F_"2)")),U)
"RTN","PSJLMUT1",25,0)
 I +$O(@(F_"1,0)")),'+$O(@(F_"1,1)")),PSGUPDDO="" D DD(F,.DRUGNAME)
"RTN","PSJLMUT1",26,0)
 S:($G(DRUGNAME)=""!($G(DRUGNAME)["NOT FOUND")) DRUGNAME=$$OIDF(OIND)
"RTN","PSJLMUT1",27,0)
 ;S PSGGV=$S(NOTGV:"*** NOT TO BE GIVEN *** ",1:"")_PSGINS_PSGUPDDO_" "_MR_" "_SCH
"RTN","PSJLMUT1",28,0)
 S PSGGV=$S(NOTGV:"*** NOT TO BE GIVEN *** ",1:"")_$S(('$D(PSJPDDDP)&('$L(PSGUPDDO))):PSGINS,1:PSGUPDDO)_" "_MR_" "_SCH
"RTN","PSJLMUT1",29,0)
 S PSGX=0 K PSJPDDDP
"RTN","PSJLMUT1",30,0)
 D TXT^PSGMUTL(DRUGNAME,NL) F X=0:0 S X=$O(MARX(X)) Q:'X  S NAME(X)=$S(X>1:"  ",1:"")_MARX(X),PSGX=X
"RTN","PSJLMUT1",31,0)
 Q:+DRUGONLY
"RTN","PSJLMUT1",32,0)
 D TXT^PSGMUTL(PSGGV,GL) F X=0:0 S X=$O(MARX(X)) Q:'X  D
"RTN","PSJLMUT1",33,0)
 . I X=1 S NAME(PSGX+X)="Give: "_MARX(X) Q
"RTN","PSJLMUT1",34,0)
 . S NAME(PSGX+X)=$S(X>1:"      ",1:"")_MARX(X)
"RTN","PSJLMUT1",35,0)
 Q
"RTN","PSJLMUT1",36,0)
OIDF(OIND)    ; Return Orderable Item name and Dosage form.
"RTN","PSJLMUT1",37,0)
 ;; +OIND = orderable item IEN
"RTN","PSJLMUT1",38,0)
 NEW X,NAME
"RTN","PSJLMUT1",39,0)
 S X=$G(^PS(50.7,+OIND,0))
"RTN","PSJLMUT1",40,0)
 S:$P(X,U)]"" NAME=$P(X,U)_" "_$P($G(^PS(50.606,+$P(X,U,2),0)),U)
"RTN","PSJLMUT1",41,0)
 Q $S($G(NAME)]"":NAME,1:"NOT FOUND "_+OIND_";PS(50.7")
"RTN","PSJLMUT1",42,0)
 ;
"RTN","PSJLMUT1",43,0)
DD(F,NAME)        ; Return Dispense drug name.
"RTN","PSJLMUT1",44,0)
 ;; F = "^PS(55,DFN,5,+ON," or "^PS(53.1,+ON,"
"RTN","PSJLMUT1",45,0)
 NEW X K NAME
"RTN","PSJLMUT1",46,0)
 S X=$O(@(F_"1,0)")),X=$G(@(F_"1,"_+X_",0)"))
"RTN","PSJLMUT1",47,0)
 I $P(X,U)]"" S NAME=$P($G(^PSDRUG(+X,0)),U)
"RTN","PSJLMUT1",48,0)
 E  S NAME="NOT FOUND "_+X_";PSDRUG"
"RTN","PSJLMUT1",49,0)
 I '$O(@(F_"1,1)")),+$P(X,U,2)>1 S PSGUPDDO=+$P(X,U,2)
"RTN","PSJLMUT1",50,0)
 S PSJPDDDP=1
"RTN","PSJLMUT1",51,0)
 Q
"RTN","PSJLMUT1",52,0)
DSPLORDU(PSGP,ON)   ; Display UD order for order check as in the Inpat Profile.
"RTN","PSJLMUT1",53,0)
 NEW DRUGNAME,F,NODE0,NODE2,PSJID,PSJX,SCH,SD,STAT,X,Y
"RTN","PSJLMUT1",54,0)
 S F=$S(ON["U":"^PS(55,PSGP,5,"_+ON_",",1:"^PS(53.1,"_+ON_",")
"RTN","PSJLMUT1",55,0)
 S NODE0=$G(@(F_"0)")),NODE2=$G(@(F_"2)"))
"RTN","PSJLMUT1",56,0)
 D DRGDISP^PSJLMUT1(PSGP,ON,39,54,.DRUGNAME,0)
"RTN","PSJLMUT1",57,0)
 I ON["P",$P(NODE0,U,4)="F" D DSPLORDV(PSGP,ON) Q
"RTN","PSJLMUT1",58,0)
 S SCH=$P(NODE0,U,7)
"RTN","PSJLMUT1",59,0)
 S STAT=$P(NODE0,U,9) I STAT="A",$P(NODE0,U,27)="R" S STAT="R"
"RTN","PSJLMUT1",60,0)
 I STAT'="P" S PSJID=$E($$ENDTC^PSGMI($P(NODE2,U,2)),1,5),SD=$E($$ENDTC^PSGMI($P(NODE2,U,4)),1,5)
"RTN","PSJLMUT1",61,0)
 I STAT="P" S (PSJID,SD)="*****",SCH="?"
"RTN","PSJLMUT1",62,0)
 F PSJX=0:0 S PSJX=$O(DRUGNAME(PSJX)) Q:'PSJX  D
"RTN","PSJLMUT1",63,0)
 . S:PSJX=1 X=SCH_"  "_PSJID_"  "_SD_"  "_$E(STAT,1)
"RTN","PSJLMUT1",64,0)
 . S:PSJX=1 DRUGNAME(1)=$$SETSTR^VALM1(X,$E(DRUGNAME(1),1,40),42,20)
"RTN","PSJLMUT1",65,0)
 . S PSJOC(ON,PSJLINE)="        "_DRUGNAME(PSJX)
"RTN","PSJLMUT1",66,0)
 . S PSJLINE=PSJLINE+1
"RTN","PSJLMUT1",67,0)
 Q
"RTN","PSJLMUT1",68,0)
DSPLORDV(DFN,ON)   ; Display IV order for order check as in the Inpat Profile.
"RTN","PSJLMUT1",69,0)
 N DRG,DRGI,DRGT,DRGX,FIL,ND,ON55,P,PSJIVFLG,PSJORIFN,TYP,X,Y
"RTN","PSJLMUT1",70,0)
 S TYP="?" I ON["V" D
"RTN","PSJLMUT1",71,0)
 .S Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,4,5,8,9,17,23 S P(X)=$P(Y,U,X)
"RTN","PSJLMUT1",72,0)
 .S TYP=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I TYP'="O" S TYP="C"
"RTN","PSJLMUT1",73,0)
 .S ON55=ON,P("OT")=$S(P(4)="A":"F",P(4)="H":"H",1:"I") D GTDRG^PSIVORFB,GTOT^PSIVUTL(P(4))
"RTN","PSJLMUT1",74,0)
 S PSJCT=0,PSJL=""
"RTN","PSJLMUT1",75,0)
 I ON'["V" S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+ON,0)),U,9),Y=$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U) D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4))
"RTN","PSJLMUT1",76,0)
 S PSJIVFLG=1 D PIVAD,SOL
"RTN","PSJLMUT1",77,0)
 Q
"RTN","PSJLMUT1",78,0)
SOL ;
"RTN","PSJLMUT1",79,0)
 S PSJL=$S($G(PSJIVFLG):PSJL,1:"")_"        in"
"RTN","PSJLMUT1",80,0)
 S DRG=0 F  S DRG=+$O(DRG("SOL",DRG)) Q:'DRG  D NAME^PSIVUTL(DRG("SOL",DRG),37,.NAME,0) S DRGX=0 F  S DRGX=$O(NAME(DRGX)) Q:'DRGX  S PSJL=$$SETSTR^VALM1(NAME(DRGX),PSJL,12,60) D:$G(PSJIVFLG) PIV1 D SETTMP S PSJL="      "
"RTN","PSJLMUT1",81,0)
 Q
"RTN","PSJLMUT1",82,0)
PIVAD ; Print IV Additives.
"RTN","PSJLMUT1",83,0)
 F DRG=0:0 S DRG=$O(DRG("AD",DRG)) Q:'DRG  D NAME^PSIVUTL(DRG("AD",DRG),39,.NAME,1) F DRGX=0:0 S DRGX=$O(NAME(DRGX)) Q:'DRGX  S PSJL=$$SETSTR^VALM1(NAME(DRGX),PSJL,9,60) D:$G(PSJIVFLG) PIV1 D SETTMP
"RTN","PSJLMUT1",84,0)
 Q
"RTN","PSJLMUT1",85,0)
 ;
"RTN","PSJLMUT1",86,0)
PIV1 ; Print Sched type, start/stop dates, and status.
"RTN","PSJLMUT1",87,0)
 K PSJIVFLG
"RTN","PSJLMUT1",88,0)
 F X=2,3 S P(X)=$E($$ENDTC^PSGMI(P(X)),1,$S($D(PSJEXTP):8,1:5))
"RTN","PSJLMUT1",89,0)
 I '$D(PSJEXTP) S PSJL=$$SETSTR^VALM1(TYP,PSJL,50,1),PSJL=$$SETSTR^VALM1(P(2),PSJL,53,7),PSJL=$$SETSTR^VALM1(P(3),PSJL,60,7),PSJL=$$SETSTR^VALM1(P(17),PSJL,67,1)
"RTN","PSJLMUT1",90,0)
 E  S PSJL=$$SETSTR^VALM1(TYP,PSJL,50,1),PSJL=$$SETSTR^VALM1(P(2),53,7),PSJL=$$SETSTR^VALM1(P(3),PSJL,63,7),PSJL=$$SETSTR^VALM1(P(17),PSJL,73,1)
"RTN","PSJLMUT1",91,0)
 Q
"RTN","PSJLMUT1",92,0)
SETTMP ;
"RTN","PSJLMUT1",93,0)
 S PSJOC(ON,PSJLINE)=PSJL,PSJLINE=PSJLINE+1
"RTN","PSJLMUT1",94,0)
 Q
"RTN","PSJLMUT1",95,0)
ORDCHK(DFN,TYPE,PIECE)   ;
"RTN","PSJLMUT1",96,0)
 ;TYPE ="DD" - Duplicate drug
"RTN","PSJLMUT1",97,0)
 ;     ="DC" - Duplicate class
"RTN","PSJLMUT1",98,0)
 ;     -"DI" - Drug Interaction
"RTN","PSJLMUT1",99,0)
 ;PIECE = The piece order number is return from ^TMP($J,"DD"...
"RTN","PSJLMUT1",100,0)
 ;PSJOC(ON,x) = Array of inpatient orders to be displayed
"RTN","PSJLMUT1",101,0)
 ;
"RTN","PSJLMUT1",102,0)
 NEW ON,PSJL,PSIVX,PSJOC,PSJORIEN,PSJPACK,PSJLINE
"RTN","PSJLMUT1",103,0)
 S PSJOC=0,PSJLINE=1
"RTN","PSJLMUT1",104,0)
 F PSIVX=0:0 S PSIVX=$O(^TMP($J,TYPE,PSIVX)) Q:'PSIVX  D
"RTN","PSJLMUT1",105,0)
 . S PSJPACK=$P(^TMP($J,TYPE,PSIVX,0),U,PIECE)
"RTN","PSJLMUT1",106,0)
 . I $G(PSGORD) S PSJORD=PSGORD ; Set PSJORD if PSGORD exists and is not Null
"RTN","PSJLMUT1",107,0)
 . I $G(PSJORD)]"" I $S($D(PSJORD):$G(PSJORD),1:$G(PSGORD))'["V",$P(PSJPACK,";")=$S($D(PSJORD):$G(PSJORD),1:$G(PSGORD)) Q  ; don't flag order that is being renewed as duplicate, only checks Unit Dose orders
"RTN","PSJLMUT1",108,0)
 . I $G(PSJCOM),($G(PSJORD)["P") Q:$D(^PS(53.1,"ACX",PSJCOM,+PSJPACK))
"RTN","PSJLMUT1",109,0)
 . ; Don't flag if pending renewal from CPRS
"RTN","PSJLMUT1",110,0)
 . I $G(PSJORD)]"",(PSJORD["P"),($P($G(^PS(53.1,+PSJORD,0)),"^",24)="R"),($P(PSJPACK,";")["U"),($P($G(^PS(55,DFN,5,+$P(PSJPACK,";"),0)),"^",27)="R"),($P($G(^PS(55,DFN,5,+$P(PSJPACK,";"),0)),"^",26)=PSJORD) Q
"RTN","PSJLMUT1",111,0)
 . I $G(PSIVRNFG),$G(ON55)["V",$P(PSJPACK,";")=$G(ON55) Q  ;PSIVRNFG set and kill in R+2^PSIVOPT2. Needed to do dupl. check on new order but not renew.
"RTN","PSJLMUT1",112,0)
 . S PSJORIEN=$P(^TMP($J,TYPE,PSIVX,0),U,PIECE-1)
"RTN","PSJLMUT1",113,0)
 . I TYPE="DI",($P(^TMP($J,TYPE,PSIVX,0),U,4)="CRITICAL") S PSJIREQ=1
"RTN","PSJLMUT1",114,0)
 . ; Adding Drug Interactions check for use in Intervention defaults in PSJRXI.
"RTN","PSJLMUT1",115,0)
 . I TYPE="DI" S PSJRXREQ=$S($P(^TMP($J,TYPE,PSIVX,0),U,4)="CRITICAL":"CRITICAL DRUG INTERACTION",1:"SIGNIFICANT DRUG INTERACTION")
"RTN","PSJLMUT1",116,0)
 . ;I $P(PSJPACK,";",2)["O" D  Q
"RTN","PSJLMUT1",117,0)
 . N X S X=$P(PSJPACK,";",2) I X["O" D  Q
"RTN","PSJLMUT1",118,0)
 ..  D:PSJFST=1 PAUSE
"RTN","PSJLMUT1",119,0)
 ..  W !!,"The patient has this "_$S($P(PSJPACK,";")["N":"Non-VA Meds",$P(PSJPACK,";",2)["O":"Outpatient",1:"")_" order:",!
"RTN","PSJLMUT1",120,0)
 ..  I $D(^TMP($J,TYPE,PSIVX,1)) D SHOR^PSJLMUT2(TYPE,PSIVX),PAUSE S PSJFST=$S(PSJFST=0:PSJFST+2,1:PSJFST+1) Q
"RTN","PSJLMUT1",121,0)
 ..  D EN^PSODRDU2(DFN,PSJPACK,"PSJPRE"),PAUSE S PSJPDRG=1,PSJFST=$S(PSJFST=0:PSJFST+2,1:PSJFST+1)
"RTN","PSJLMUT1",122,0)
 . S ON=$P(PSJPACK,";") Q:$D(PSJOC(ON))
"RTN","PSJLMUT1",123,0)
 . I ON=$G(PSIVOCON),+PSJORIEN Q
"RTN","PSJLMUT1",124,0)
 . I ON=$G(PSIVOCON),'+PSJORIEN D SETPSJOC Q
"RTN","PSJLMUT1",125,0)
 . ;S PSJOC=PSJOC+1,PSJPDRG=1 D:PSJOC=1 WRITE(TYPE)
"RTN","PSJLMUT1",126,0)
 . I ON["V" D
"RTN","PSJLMUT1",127,0)
 .. I '$O(^PS(55,DFN,"IV",+ON,0)) D SETPSJOC Q
"RTN","PSJLMUT1",128,0)
 .. D DSPLORDV(DFN,ON) S PSJOC=PSJOC+1
"RTN","PSJLMUT1",129,0)
 . I ON'["V" D DSPLORDU(DFN,ON) S PSJOC=PSJOC+1
"RTN","PSJLMUT1",130,0)
 . S PSJOC(ON,PSJLINE)="",PSJLINE=PSJLINE+1
"RTN","PSJLMUT1",131,0)
 D:PSJOC WRITE(TYPE)
"RTN","PSJLMUT1",132,0)
 S ON="" F  S ON=$O(PSJOC(ON)) Q:ON=""  W ! S PSJLINE=PSJLINE+1,PSJFST=PSJFST+1 D
"RTN","PSJLMUT1",133,0)
 . F PSIVX=0:0 S PSIVX=$O(PSJOC(ON,PSIVX)) Q:'PSIVX  W !,PSJOC(ON,PSIVX) S PSJLINE=PSJLINE+1 D:'(PSIVX#6) PAUSE
"RTN","PSJLMUT1",134,0)
 W !
"RTN","PSJLMUT1",135,0)
 Q
"RTN","PSJLMUT1",136,0)
SETPSJOC ;Set PSJOC array to be displayed later
"RTN","PSJLMUT1",137,0)
 NEW PIECE S PIECE=$S(TYPE="DC":4,1:2)
"RTN","PSJLMUT1",138,0)
 S X=$$SETSTR^VALM1($P(^TMP($J,TYPE,PSIVX,0),U,PIECE),"",9,40)
"RTN","PSJLMUT1",139,0)
 S X=$$SETSTR^VALM1("* EXISTS IN CURRENT ORDER *",X,50,27)
"RTN","PSJLMUT1",140,0)
 S PSJOC(ON,PSJLINE)=X,PSJLINE=PSJLINE+1,PSJOC=PSJOC+1
"RTN","PSJLMUT1",141,0)
 Q
"RTN","PSJLMUT1",142,0)
WRITE(TYPE)        ;Display order check description
"RTN","PSJLMUT1",143,0)
 S PSJPDRG=1
"RTN","PSJLMUT1",144,0)
 I TYPE="DD" W !!,"This patient is already receiving the following order",$S(PSJOC>1:"s",1:"")," for ",$S($G(PSJDD)]"":$P($G(^PSDRUG(PSJDD,0)),U),1:"this drug"),":",!
"RTN","PSJLMUT1",145,0)
 I TYPE="DC" W !!,"This patient is already receiving ",$S(PSJOC>1:"orders",1:"an order")," for the following drug",$S(PSJOC>1:"s",1:"")," in the same",!,"class as ",$S($G(PSJDD)]"":$P($G(^PSDRUG(PSJDD,0)),U),1:"the drug selected"),":",!
"RTN","PSJLMUT1",146,0)
 I TYPE="DI" W !!,"This patient is receiving the following medication",$S(PSJOC>1:"s",1:"")," that ha",$S(PSJOC>1:"ve",1:"s")," an interaction",!,"with ",$P($G(^PSDRUG(PSJDD,0)),U),":",!
"RTN","PSJLMUT1",147,0)
 Q
"RTN","PSJLMUT1",148,0)
PAUSE ;
"RTN","PSJLMUT1",149,0)
 K DIR W ! S DIR(0)="EA",DIR("A")="Press Return to continue...",DIR("?")="Press Return to continue..." D ^DIR W !
"RTN","PSJLMUT1",150,0)
 Q
"RTN","PSJMISC")
0^33^B44078587
"RTN","PSJMISC",1,0)
PSJMISC ;BIR/MV - MISC. SUB-ROUTINES ;03 Aug 98 / 8:42 AM
"RTN","PSJMISC",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**181**;16 DEC 97;Build 190
"RTN","PSJMISC",3,0)
 ;
"RTN","PSJMISC",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJMISC",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJMISC",6,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJMISC",7,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJMISC",8,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192.
"RTN","PSJMISC",9,0)
 ;
"RTN","PSJMISC",10,0)
GCN(PSJDD) ;Return GCNSEQNO for a dispense drug
"RTN","PSJMISC",11,0)
 ;PSJDD - IEN (file #50)
"RTN","PSJMISC",12,0)
 NEW PSJDDND,X
"RTN","PSJMISC",13,0)
 I '+$G(PSJDD) Q ""
"RTN","PSJMISC",14,0)
 S PSJDDND=$G(^PSDRUG(+PSJDD,"ND"))
"RTN","PSJMISC",15,0)
 I PSJDDND="" Q ""
"RTN","PSJMISC",16,0)
 S X=$$PROD0^PSNAPIS($P(PSJDDND,U),$P(PSJDDND,U,3))
"RTN","PSJMISC",17,0)
 Q $P(X,U,7)
"RTN","PSJMISC",18,0)
GTVUID(PSJDD) ;Return the VUID for a dispense drug
"RTN","PSJMISC",19,0)
 ;PSJDD - IEN (file #50)
"RTN","PSJMISC",20,0)
 NEW PSJND,PSJVUID,DIC
"RTN","PSJMISC",21,0)
 I '+$G(PSJDD) Q ""
"RTN","PSJMISC",22,0)
 S PSJVUID=""
"RTN","PSJMISC",23,0)
 S PSJND=$P($G(^PSDRUG(+PSJDD,"ND")),U,3)
"RTN","PSJMISC",24,0)
 I +PSJND S PSJVUID=$$GETVUID^XTID(50.68,,PSJND_",")
"RTN","PSJMISC",25,0)
 Q PSJVUID
"RTN","PSJMISC",26,0)
VAGEN(PSJDD) ;Return the VA GENERIC name
"RTN","PSJMISC",27,0)
 ;PSJDD - IEN (file #50)
"RTN","PSJMISC",28,0)
 NEW PSJIEN,PSJVAGEN
"RTN","PSJMISC",29,0)
 I '+$G(PSJDD) Q ""
"RTN","PSJMISC",30,0)
 S PSJIEN=+$G(^PSDRUG(PSJDD,"ND"))
"RTN","PSJMISC",31,0)
 D ZERO^PSN50P6(PSJIEN,,,,"PSJVAGEN")
"RTN","PSJMISC",32,0)
 S PSJVAGEN=$G(^TMP($J,"PSJVAGEN",PSJIEN,.01))
"RTN","PSJMISC",33,0)
 K ^TMP($J,"PSJVAGEN")
"RTN","PSJMISC",34,0)
 Q PSJVAGEN
"RTN","PSJMISC",35,0)
 ;
"RTN","PSJMISC",36,0)
GENVUID(PSJVUID) ;Return the VA GENERIC name
"RTN","PSJMISC",37,0)
 ;PSJVUID - #50.68
"RTN","PSJMISC",38,0)
 ;PSJRDIID - Array returning from ^XTID call
"RTN","PSJMISC",39,0)
 ;PSJNDF - #50.68 ien
"RTN","PSJMISC",40,0)
 ;GETIREF^XTID - will not return the .01 name if DIC is defined. 
"RTN","PSJMISC",41,0)
 I '+$G(PSJVUID) Q ""
"RTN","PSJMISC",42,0)
 NEW PSJNDF,PSJVAGEN,DIC
"RTN","PSJMISC",43,0)
 K PSJRDIID
"RTN","PSJMISC",44,0)
 S PSJVAGEN=""
"RTN","PSJMISC",45,0)
 D GETIREF^XTID("50.68",".01",PSJVUID,"PSJRDIID")
"RTN","PSJMISC",46,0)
 S PSJNDF=$O(PSJRDIID(50.68,.01,""))
"RTN","PSJMISC",47,0)
 K PSJRDIID
"RTN","PSJMISC",48,0)
 I +PSJNDF D
"RTN","PSJMISC",49,0)
 . D DATA^PSN50P68(+PSJNDF,,"PSJNDF")
"RTN","PSJMISC",50,0)
 . S PSJVAGEN=$P($G(^TMP($J,"PSJNDF",+PSJNDF,.05)),U,2)
"RTN","PSJMISC",51,0)
 K ^TMP($J,"PSJNDF")
"RTN","PSJMISC",52,0)
 Q PSJVAGEN
"RTN","PSJMISC",53,0)
 ;
"RTN","PSJMISC",54,0)
CLASS(PSJDD) ;Return the VA CLASS
"RTN","PSJMISC",55,0)
 Q:'+$G(PSJDD) ""
"RTN","PSJMISC",56,0)
 NEW PSJCLASS
"RTN","PSJMISC",57,0)
 S PSJCLASS=$P($G(^PSDRUG(+PSJDD,0)),U,2)
"RTN","PSJMISC",58,0)
 Q PSJCLASS
"RTN","PSJMISC",59,0)
 ;
"RTN","PSJMISC",60,0)
PREMIX(X) ;Check if the solution is flag as a Pre-mix
"RTN","PSJMISC",61,0)
 ;X - ien from 52.7
"RTN","PSJMISC",62,0)
 ;Return 0 if not flag as premix.
"RTN","PSJMISC",63,0)
 I '+$G(X) Q 0
"RTN","PSJMISC",64,0)
 Q +$P($G(^PS(52.7,+X,0)),U,14)
"RTN","PSJMISC",65,0)
 ;
"RTN","PSJMISC",66,0)
IVDDRG(PSIVAS,PSJIEN) ;Return corresponding dispense drug IEN for ad/sol
"RTN","PSJMISC",67,0)
 ;PSJIEN - ien from 52.6 or 52.7
"RTN","PSJMISC",68,0)
 ;PSIVAS - "AD" or "SOL"
"RTN","PSJMISC",69,0)
 NEW DDRUG
"RTN","PSJMISC",70,0)
 I PSIVAS="AD" S DDRUG=$P($G(^PS(52.6,+PSJIEN,0)),U,2)
"RTN","PSJMISC",71,0)
 I PSIVAS="SOL" S DDRUG=$P($G(^PS(52.7,+PSJIEN,0)),U,2)
"RTN","PSJMISC",72,0)
 Q DDRUG
"RTN","PSJMISC",73,0)
 ;
"RTN","PSJMISC",74,0)
WRITE(X,DIWL,DIWR) ;Start a new line before writing
"RTN","PSJMISC",75,0)
 NEW DN
"RTN","PSJMISC",76,0)
 I '$G(DIWL) S DIWL=1
"RTN","PSJMISC",77,0)
 I '$G(DIWR) S DIWR=75
"RTN","PSJMISC",78,0)
 K ^UTILITY($J,"W") D ^DIWP D ^DIWW
"RTN","PSJMISC",79,0)
 Q
"RTN","PSJMISC",80,0)
 ;
"RTN","PSJMISC",81,0)
MYWRITE(X,DIWL,DIWR) ;Continue writing on the same line
"RTN","PSJMISC",82,0)
 NEW DN,PSJCNT
"RTN","PSJMISC",83,0)
 I '$G(DIWL) S DIWL=1
"RTN","PSJMISC",84,0)
 I '$G(DIWR) S DIWR=75
"RTN","PSJMISC",85,0)
 K ^UTILITY($J,"W") D ^DIWP
"RTN","PSJMISC",86,0)
 F PSJCNT=0:0 S PSJCNT=$O(^UTILITY($J,"W",DIWL,PSJCNT)) Q:'PSJCNT  W:PSJCNT'=1 ! W ?DIWL,^UTILITY($J,"W",DIWL,PSJCNT,0)
"RTN","PSJMISC",87,0)
 Q
"RTN","PSJMISC",88,0)
 ;
"RTN","PSJMISC",89,0)
COMPARE(DRG,TMPDRG,PSJNPRMX) ;
"RTN","PSJMISC",90,0)
 ;PSJNPRMX is set to consider non-premix solution.
"RTN","PSJMISC",91,0)
 ;Compare the DRG array if it has changed
"RTN","PSJMISC",92,0)
 ;Returning 1 will cause OC to be performed due to add/sol changes or new OE
"RTN","PSJMISC",93,0)
 I '$D(DRG) Q 0
"RTN","PSJMISC",94,0)
 I $D(DRG),('$D(TMPDRG)) Q 1
"RTN","PSJMISC",95,0)
 NEW PSJDIFF,PSJX,X
"RTN","PSJMISC",96,0)
 S PSJDIFF=0
"RTN","PSJMISC",97,0)
 F X=0:0 S X=$O(DRG("AD",X)) Q:'X!PSJDIFF  S PSJX=DRG("AD",X) D
"RTN","PSJMISC",98,0)
 . I DRG("AD",X)'=$G(TMPDRG("AD",X)) S PSJDIFF=1 Q
"RTN","PSJMISC",99,0)
 I PSJDIFF Q 1
"RTN","PSJMISC",100,0)
 F X=0:0 S X=$O(DRG("SOL",X)) Q:'X!PSJDIFF  S PSJX=DRG("SOL",X) D
"RTN","PSJMISC",101,0)
 . I '+$G(PSJNPRMX),'$$PREMIX(+PSJX) Q
"RTN","PSJMISC",102,0)
 . I DRG("SOL",X)'=$G(TMPDRG("SOL",X)) S PSJDIFF=1 Q
"RTN","PSJMISC",103,0)
 I PSJDIFF Q 1
"RTN","PSJMISC",104,0)
 F X=0:0 S X=$O(TMPDRG("AD",X)) Q:'X!PSJDIFF  S PSJX=TMPDRG("AD",X) D
"RTN","PSJMISC",105,0)
 . I TMPDRG("AD",X)'=$G(DRG("AD",X)) S PSJDIFF=1 Q
"RTN","PSJMISC",106,0)
 I PSJDIFF Q 1
"RTN","PSJMISC",107,0)
 F X=0:0 S X=$O(TMPDRG("SOL",X)) Q:'X!PSJDIFF  S PSJX=TMPDRG("SOL",X) D
"RTN","PSJMISC",108,0)
 . I '+$G(PSJNPRMX),'$$PREMIX(+PSJX) Q
"RTN","PSJMISC",109,0)
 . I TMPDRG("SOL",X)'=$G(DRG("SOL",X)) S PSJDIFF=1 Q
"RTN","PSJMISC",110,0)
 Q PSJDIFF
"RTN","PSJMISC",111,0)
DN(X) ;
"RTN","PSJMISC",112,0)
 ;Return the drug name from file 50
"RTN","PSJMISC",113,0)
 Q $P($G(^PSDRUG(+X,0)),U)
"RTN","PSJMISC",114,0)
OI(X) ;
"RTN","PSJMISC",115,0)
 ;Return the Orderable name from file 50.7
"RTN","PSJMISC",116,0)
 NEW PSJX
"RTN","PSJMISC",117,0)
 S PSJX=$P($G(^PS(50.7,+X,0)),U)
"RTN","PSJMISC",118,0)
 Q $S(PSJX="":"Invalid Orderable Item",1:PSJX)
"RTN","PSJMISC",119,0)
LINE(PSJLINE,PSJLEN) ;Display a line
"RTN","PSJMISC",120,0)
 ;PSJLINE - type of line (ex: '-', '=")
"RTN","PSJMISC",121,0)
 ;PSJLEN - the length of line
"RTN","PSJMISC",122,0)
 S X="",$P(X,PSJLINE,PSJLEN)=""
"RTN","PSJMISC",123,0)
 W X
"RTN","PSJMISC",124,0)
 Q
"RTN","PSJMISC",125,0)
DD53P45() ;Return the zero node of the first dispense drug found in 53.45
"RTN","PSJMISC",126,0)
 ;Calling routine needs to clean up PSJALLGY array.
"RTN","PSJMISC",127,0)
 NEW PSJDD,PSJDD1,PSJDD0,X,PSJX,PSGDT,%
"RTN","PSJMISC",128,0)
 D NOW^%DTC S PSGDT=%
"RTN","PSJMISC",129,0)
 S PSJDD="",PSJDD1=""
"RTN","PSJMISC",130,0)
 I '+$G(PSJSYSP) Q ""
"RTN","PSJMISC",131,0)
 F X=0:0 S X=$O(^PS(53.45,+PSJSYSP,2,X)) Q:'+X  D
"RTN","PSJMISC",132,0)
 . S PSJDD0=$G(^PS(53.45,PSJSYSP,2,X,0))
"RTN","PSJMISC",133,0)
 . S PSJX=$P(PSJDD0,U,3) I PSJX]"",(PSJX'>$G(PSGDT)) S PSJDD0="" Q
"RTN","PSJMISC",134,0)
 . S PSJDD=+PSJDD0
"RTN","PSJMISC",135,0)
 . S PSJX=$S('$D(^PSDRUG(+PSJDD,0)):1,$P($G(^(2)),U,3)'["U":1,$G(^("I"))="":0,1:^("I")'>$G(PSGDT))
"RTN","PSJMISC",136,0)
 . I PSJX S PSJDD0="",PSJDD="" Q
"RTN","PSJMISC",137,0)
 . S PSJALLGY(PSJDD)=""
"RTN","PSJMISC",138,0)
 . S:PSJDD1="" PSJDD1=PSJDD0
"RTN","PSJMISC",139,0)
 Q $G(PSJDD1)
"RTN","PSJMISC",140,0)
RETQUIT() ;
"RTN","PSJMISC",141,0)
 ;Return 1 If enter "^"
"RTN","PSJMISC",142,0)
 NEW DIR,DIROUT,DTOUT,DUOUT,PSJQUIT
"RTN","PSJMISC",143,0)
 S PSJQUIT=0
"RTN","PSJMISC",144,0)
 S DIR(0)="FO^1:1",DIR("A")="Press RETURN to continue or '^' to exit"
"RTN","PSJMISC",145,0)
 S DIR("?")="Enter '^' to quit or any keys to continue"
"RTN","PSJMISC",146,0)
 D ^DIR
"RTN","PSJMISC",147,0)
 I $S($D(DIROUT):1,$D(DUOUT):1,$D(DTOUT):1,1:0) S PSJQUIT=1
"RTN","PSJMISC",148,0)
 Q PSJQUIT
"RTN","PSJMISC",149,0)
PAUSE(PSJFIRST,PSJLAST) ;
"RTN","PSJMISC",150,0)
 ;PSJFIRST - Print a blank line before the pause prompt
"RTN","PSJMISC",151,0)
 ;PSJLAST - Print a blank line after the pause prompt
"RTN","PSJMISC",152,0)
 K DIR W:+$G(PSJFIRST) ! S DIR(0)="EA",DIR("A")="Press Return to continue...",DIR("?")="Press Return to continue..." D ^DIR W:+$G(PSJLAST) !
"RTN","PSJMISC",153,0)
 Q
"RTN","PSJMISC",154,0)
PAUSE1() ;Allow "^"
"RTN","PSJMISC",155,0)
 ;Return 0 if X=""
"RTN","PSJMISC",156,0)
 ;Return 1 if X="^"
"RTN","PSJMISC",157,0)
 ;Return 2 if Not null or "^"
"RTN","PSJMISC",158,0)
 NEW DIR,DIRUT,DUOUT,X
"RTN","PSJMISC",159,0)
 K DIR S DIR("A")="Press RETURN to continue or ""^"" to display the next Monograph or ""^^"" to Exit"
"RTN","PSJMISC",160,0)
 S DIR("?")="Enter ""^"" to go to next Monograph, ""^^"" to exit the Monograph display."
"RTN","PSJMISC",161,0)
 S DIR(0)="FOU^^K:(X'="""")!(X'[""^"") X"
"RTN","PSJMISC",162,0)
 D ^DIR
"RTN","PSJMISC",163,0)
 I X="" Q 0
"RTN","PSJMISC",164,0)
 I X="^" Q 1
"RTN","PSJMISC",165,0)
 Q 2
"RTN","PSJMISC",166,0)
ONCALL(PSJSCH,PSJSTYPE) ;
"RTN","PSJMISC",167,0)
 ; PSJSCH = Admin Schedule
"RTN","PSJMISC",168,0)
 ; PSJSTYPE = schedule type (optional)
"RTN","PSJMISC",169,0)
 ; Returns 0 = Not an "ON CALL" schedule.
"RTN","PSJMISC",170,0)
 ;         1 = For schedule ="ON CALL" or schedule type = "OC".
"RTN","PSJMISC",171,0)
 Q:$G(PSJSTYPE)="OC" 1
"RTN","PSJMISC",172,0)
 Q:$G(PSJSCH)="" 0
"RTN","PSJMISC",173,0)
 I PSJSCH="ON CALL"!(PSJSCH="ONCALL")!(PSJSCH="ON-CALL") Q 1
"RTN","PSJMISC",174,0)
 Q 0
"RTN","PSJMISC",175,0)
TMPDRG(DFN,ON,TMPDRG) ;Set TMPDRG array from the order in 55
"RTN","PSJMISC",176,0)
 ;ON - IV order #
"RTN","PSJMISC",177,0)
 NEW DRGT,FIL,Y,ND,DRG,DRGI
"RTN","PSJMISC",178,0)
 Q:'+$G(ON)
"RTN","PSJMISC",179,0)
 F DRGT="AD","SOL" S FIL=$S(DRGT="AD":52.6,1:52.7) F Y=0:0 S Y=$O(^PS(55,DFN,"IV",+ON,DRGT,Y)) Q:'Y  D
"RTN","PSJMISC",180,0)
 .; naked ref below refers to line above
"RTN","PSJMISC",181,0)
 .S DRG=$G(^(Y,0)),ND=$G(^PS(FIL,+DRG,0)),(DRGI,TMPDRG(DRGT,0))=$G(TMPDRG(DRGT,0))+1
"RTN","PSJMISC",182,0)
 .S TMPDRG(DRGT,+DRGI)=+DRG_U_$P(ND,U)_U_$P(DRG,U,2)_U_$P(DRG,U,3)_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSJMISC",183,0)
 Q
"RTN","PSJMISC",184,0)
TMPDRG1(DFN,ON,TMPDRG) ;Set TMPDRG array from the order in 53.1
"RTN","PSJMISC",185,0)
 ;ON - IV order #
"RTN","PSJMISC",186,0)
 NEW DRGT,FIL,Y,ND,DRG,DRGI
"RTN","PSJMISC",187,0)
 Q:'+$G(ON)
"RTN","PSJMISC",188,0)
 I $P(^PS(53.1,+ON,0),U,15)'=DFN Q
"RTN","PSJMISC",189,0)
 F DRGT="AD","SOL" S FIL=$S(DRGT="AD":52.6,1:52.7) F Y=0:0 S Y=$O(^PS(53.1,+ON,DRGT,Y)) Q:'Y  D
"RTN","PSJMISC",190,0)
 .; naked ref below refers to line above
"RTN","PSJMISC",191,0)
 .S DRG=$G(^(Y,0)),ND=$G(^PS(FIL,+DRG,0)),(DRGI,TMPDRG(DRGT,0))=$G(TMPDRG(DRGT,0))+1
"RTN","PSJMISC",192,0)
 .S TMPDRG(DRGT,+DRGI)=+DRG_U_$P(ND,U)_U_$P(DRG,U,2)_U_$P(DRG,U,3)_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSJMISC",193,0)
 Q
"RTN","PSJMISC",194,0)
INFRATE(DFN,ON,PSJIR,PSJDTYP) ;Check if the infusion rate has changed
"RTN","PSJMISC",195,0)
 ;ON - ON_P/V
"RTN","PSJMISC",196,0)
 ;PSJIR - infusion rate
"RTN","PSJMISC",197,0)
 ;PSJDTYP - IV type.  Only check infusion rate on continuous IV type
"RTN","PSJMISC",198,0)
 NEW X,PSJONIR
"RTN","PSJMISC",199,0)
 I '$D(PSJDTYP)!(+$G(PSJDTYP)=1) Q 0
"RTN","PSJMISC",200,0)
 I '+$G(ON) Q 0
"RTN","PSJMISC",201,0)
 I '+$G(PSJIR) Q 0
"RTN","PSJMISC",202,0)
 I ON["V" S X=$G(^PS(55,DFN,"IV",+ON,0)) S PSJONIR=$P(X,U,8)
"RTN","PSJMISC",203,0)
 I ON["P" S X=$G(^PS(53.1,+ON,8)) S PSJONIR=$P(X,U,5)
"RTN","PSJMISC",204,0)
 I PSJONIR="" Q 0
"RTN","PSJMISC",205,0)
 I PSJIR'=PSJONIR Q 1
"RTN","PSJMISC",206,0)
 Q 0
"RTN","PSJMISC2")
0^103^B11318290
"RTN","PSJMISC2",1,0)
PSJMISC2 ;BIR/MV - MISC. CALLS FOR IV DOSING CHECKS;6 Jun 07 / 3:37 PM
"RTN","PSJMISC2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**181**;16 DEC 97;Build 190
"RTN","PSJMISC2",3,0)
 ; Reference to ^PSSDSAPI is supported by DBIA #5425
"RTN","PSJMISC2",4,0)
 ;
"RTN","PSJMISC2",5,0)
P8(PSJINFRT) ;Set infusion rate in term of numeric, dose unit over time unit
"RTN","PSJMISC2",6,0)
 ;PSJINFRT - Infusion Rate
"RTN","PSJMISC2",7,0)
 ;Return either Null or numeric^doseUnit^timeUnit
"RTN","PSJMISC2",8,0)
 ;PWJP8ERR - Must be clean up by calling routine.
"RTN","PSJMISC2",9,0)
 ;PSJP8ERR = 1 - "FRQ_ERROR"
"RTN","PSJMISC2",10,0)
 ;PSJP8ERR = 2 - "WT_ERROR"
"RTN","PSJMISC2",11,0)
 ;PSJP8ERR = 3 - "HT_ERROR"
"RTN","PSJMISC2",12,0)
 ;PSJP8ERR = 4 - Set both WT & HT error
"RTN","PSJMISC2",13,0)
 ;
"RTN","PSJMISC2",14,0)
 I $G(PSJINFRT)="" Q ""
"RTN","PSJMISC2",15,0)
 NEW X,PSJBSA,PSJBSAFG,PSJHT,PSJWT,PSJWTFG,PSJTIME,PSJUNIT,PSJP1,PSJP2,PSJNUT,PSJUP8
"RTN","PSJMISC2",16,0)
 K PSJP8ERR
"RTN","PSJMISC2",17,0)
 S PSJUP8=$$UP^XLFSTR(PSJINFRT)
"RTN","PSJMISC2",18,0)
 I PSJUP8["TITRATE" S PSJP8ERR=1 Q ""
"RTN","PSJMISC2",19,0)
 I PSJUP8["BOLUS" S PSJP8ERR=1 Q ""
"RTN","PSJMISC2",20,0)
 S PSJP1=$P(PSJUP8,"@")
"RTN","PSJMISC2",21,0)
 S:PSJP1["INFUSE OVER " PSJP1=$P(PSJP1,"INFUSE OVER ",2)
"RTN","PSJMISC2",22,0)
 S:PSJP1["INFUSE AT" PSJP1=$P(PSJP1,"INFUSE AT ",2)
"RTN","PSJMISC2",23,0)
 S:PSJP1["INFUSE " PSJP1=$P(PSJP1,"INFUSE ",2)
"RTN","PSJMISC2",24,0)
 S:PSJP1["OVER " PSJP1=$P(PSJP1,"OVER ",2)
"RTN","PSJMISC2",25,0)
 I PSJP1[" TO " S PSJP8ERR=1 Q ""
"RTN","PSJMISC2",26,0)
 S:PSJP1["," PSJP1=$TR(PSJP1,",","")
"RTN","PSJMISC2",27,0)
 S PSJP1=$TR(PSJP1," ")
"RTN","PSJMISC2",28,0)
 I '+PSJP1 S PSJP8ERR=1 Q ""
"RTN","PSJMISC2",29,0)
 ;
"RTN","PSJMISC2",30,0)
 S PSJP2=$P(PSJUP8,"@",2)
"RTN","PSJMISC2",31,0)
 I PSJUP8["@",$S(PSJP2=0:0,'+PSJP2:1,1:0) S PSJP8ERR=1 Q ""
"RTN","PSJMISC2",32,0)
 ;
"RTN","PSJMISC2",33,0)
 I PSJP1'["/" S PSJP8ERR=1 Q ""
"RTN","PSJMISC2",34,0)
 ;Process ml/hr, mg/day... types
"RTN","PSJMISC2",35,0)
 NEW PSJUOTME
"RTN","PSJMISC2",36,0)
 I $S(PSJP1["/KG/":0,PSJP1["/M2/":0,1:1) S PSJUOTME=$$UNTOTME(PSJP1) Q PSJUOTME
"RTN","PSJMISC2",37,0)
 ;
"RTN","PSJMISC2",38,0)
 ;If Infusion rate contains /KG/, /M2/ and also contains ML/HR
"RTN","PSJMISC2",39,0)
 I PSJP1["ML/HR" S PSJP8ERR=1 Q ""
"RTN","PSJMISC2",40,0)
 ;
"RTN","PSJMISC2",41,0)
 ;Set patient parameter
"RTN","PSJMISC2",42,0)
 S X=$$BSA^PSSDSAPI($G(DFN))
"RTN","PSJMISC2",43,0)
 S PSJHT=+$P(X,U),PSJWT=+$P(X,U,2),PSJBSA=+$P(X,U,3)
"RTN","PSJMISC2",44,0)
 S PSJTIME=$P(PSJP1,"/",3)
"RTN","PSJMISC2",45,0)
 S PSJTIME=$$TIME(PSJTIME)
"RTN","PSJMISC2",46,0)
 S X=$P(PSJP1,"/"),PSJUNIT=$P(X,+X,2)
"RTN","PSJMISC2",47,0)
 I PSJP1["." S PSJUNIT=$$UNIT(PSJUNIT)
"RTN","PSJMISC2",48,0)
 S PSJUNIT=$$UNIT^PSSDSAPI(PSJUNIT)
"RTN","PSJMISC2",49,0)
 ;
"RTN","PSJMISC2",50,0)
 ;Calculate SDA using weight
"RTN","PSJMISC2",51,0)
 I PSJP1["/KG/" S PSJWTFG=$$WT() Q PSJWTFG
"RTN","PSJMISC2",52,0)
 ;
"RTN","PSJMISC2",53,0)
 ;Calculate SDA using  BSA
"RTN","PSJMISC2",54,0)
 I PSJP1["/M2/" S PSJBSAFG=$$BSA() Q PSJBSAFG
"RTN","PSJMISC2",55,0)
 ;
"RTN","PSJMISC2",56,0)
 Q ""
"RTN","PSJMISC2",57,0)
WT() ;
"RTN","PSJMISC2",58,0)
 NEW X
"RTN","PSJMISC2",59,0)
 I $S(PSJUNIT="":1,PSJTIME="":1,'PSJWT:1,'+PSJP1:1,1:0) S PSJP8ERR=2 Q ""
"RTN","PSJMISC2",60,0)
 S X=(+PSJP1*PSJWT)_U_PSJUNIT_U_PSJTIME
"RTN","PSJMISC2",61,0)
 Q X
"RTN","PSJMISC2",62,0)
BSA() ;
"RTN","PSJMISC2",63,0)
 NEW X
"RTN","PSJMISC2",64,0)
 I $S(PSJUNIT="":1,PSJTIME="":1,'PSJBSA:1,'+PSJP1:1,1:0) D  Q ""
"RTN","PSJMISC2",65,0)
 . I $G(PSJHT)=0,($G(PSJWT)=0) S PSJP8ERR=4 Q
"RTN","PSJMISC2",66,0)
 . I $G(PSJHT)=0 S PSJP8ERR=3 Q
"RTN","PSJMISC2",67,0)
 . I $G(PSJWT)=0 S PSJP8ERR=2
"RTN","PSJMISC2",68,0)
 S X=(+PSJP1*PSJBSA)_U_PSJUNIT_U_PSJTIME
"RTN","PSJMISC2",69,0)
 Q X
"RTN","PSJMISC2",70,0)
UNTOTME(PSJINF) ;Process Infusion rate for format of Num Unit/time. Ex: 8MG/HR, 125ML/HR, 1000UNITS/HR@TITRATE
"RTN","PSJMISC2",71,0)
 ;Return n^unit^time if infusion rate contain numeric + Unit over time (8MG/HR;125ML/HR) format in p1^p2^p3
"RTN","PSJMISC2",72,0)
 ;Otherwise return null
"RTN","PSJMISC2",73,0)
 ;PSJINF is already have "OVER" and whatever from "@" removed
"RTN","PSJMISC2",74,0)
 NEW PSJNUM,PSJP1S1,PSJP1S2,PSJUNIT,PSJTIME
"RTN","PSJMISC2",75,0)
 I $G(PSJINF)="" S PSJP8ERR=1 Q ""
"RTN","PSJMISC2",76,0)
 S PSJNUM=+PSJINF
"RTN","PSJMISC2",77,0)
 I 'PSJNUM S PSJP8ERR=1 Q ""
"RTN","PSJMISC2",78,0)
 S PSJP1S1=$P(PSJINF,"/")
"RTN","PSJMISC2",79,0)
 S PSJP1S2=$P(PSJINF,"/",2)
"RTN","PSJMISC2",80,0)
 ; Should be free text if in format: "8MG/HRML/HR" PSJP1S2="HRML/HR"
"RTN","PSJMISC2",81,0)
 I PSJP1S2["ML/HR" S PSJP8ERR=1 Q ""
"RTN","PSJMISC2",82,0)
 S PSJUNIT=$P(PSJP1S1,PSJNUM,2)
"RTN","PSJMISC2",83,0)
 S PSJUNIT=$$UNIT^PSSDSAPI(PSJUNIT)
"RTN","PSJMISC2",84,0)
 I PSJUNIT="" S PSJP8ERR=1 Q ""
"RTN","PSJMISC2",85,0)
 S PSJTIME=$$TIME(PSJP1S2)
"RTN","PSJMISC2",86,0)
 I PSJTIME="" S PSJP8ERR=1 Q ""
"RTN","PSJMISC2",87,0)
 Q PSJNUM_U_PSJUNIT_U_PSJTIME
"RTN","PSJMISC2",88,0)
TIME(PSJTIME) ;
"RTN","PSJMISC2",89,0)
 Q:$G(PSJTIME)="" ""
"RTN","PSJMISC2",90,0)
 I PSJTIME="MIN" Q "MINUTE"
"RTN","PSJMISC2",91,0)
 I PSJTIME="MINUTE" Q "MINUTE"
"RTN","PSJMISC2",92,0)
 I PSJTIME="MINUTES" Q "MINUTE"
"RTN","PSJMISC2",93,0)
 I PSJTIME="HR" Q "HOUR"
"RTN","PSJMISC2",94,0)
 I PSJTIME="HOUR" Q "HOUR"
"RTN","PSJMISC2",95,0)
 I PSJTIME="HOURS" Q "HOUR"
"RTN","PSJMISC2",96,0)
 I PSJTIME="DAY" Q "DAY"
"RTN","PSJMISC2",97,0)
 I PSJTIME="DAYS" Q "DAY"
"RTN","PSJMISC2",98,0)
 Q ""
"RTN","PSJMISC2",99,0)
UNIT(PSJUNIT) ;Remove extra zero after decimal point
"RTN","PSJMISC2",100,0)
 NEW PSJX
"RTN","PSJMISC2",101,0)
 I $G(PSJUNIT)=""!($G(PSJUNIT)=0) Q ""
"RTN","PSJMISC2",102,0)
 F  S PSJX=$E(PSJUNIT,1,1) Q:PSJX'=0  S:PSJX=0 PSJUNIT=$E(PSJUNIT,2,$L(PSJUNIT))
"RTN","PSJMISC2",103,0)
 Q PSJUNIT
"RTN","PSJMON")
0^39^B33274000
"RTN","PSJMON",1,0)
PSJMON ;BIR/MV - Display/Print Monograph ;6 Jun 07 / 3:37 PM
"RTN","PSJMON",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**181**;16 DEC 97;Build 190
"RTN","PSJMON",3,0)
 ;
"RTN","PSJMON",4,0)
MON(PSJMON) ;Process monographs
"RTN","PSJMON",5,0)
 NEW PSJPRTFL,PSJIOF,PSJSERVR
"RTN","PSJMON",6,0)
 S PSJPRTFL=0,PSJIOF=1
"RTN","PSJMON",7,0)
 Q:'$$ASK()
"RTN","PSJMON",8,0)
 D LSTMON(.PSJMON)
"RTN","PSJMON",9,0)
 D:PSJPRTFL DSPMON
"RTN","PSJMON",10,0)
 K PSJMON,^TMP($J,"PSJPMON")
"RTN","PSJMON",11,0)
 Q
"RTN","PSJMON",12,0)
 ;
"RTN","PSJMON",13,0)
ASK(X) ;Ask if user want to see the monograph
"RTN","PSJMON",14,0)
 NEW PSJX,DIR,DTOUT,DUOUT,DIRUT,Y
"RTN","PSJMON",15,0)
 S PSJX=$S($G(X):"(s)",1:"")
"RTN","PSJMON",16,0)
 K DIR S DIR(0)="Y",DIR("A")="Display Professional Interaction Monograph(s)"_PSJX,DIR("B")="NO" D ^DIR
"RTN","PSJMON",17,0)
 I 'Y K PSJMON W !
"RTN","PSJMON",18,0)
 Q Y
"RTN","PSJMON",19,0)
DSPMON ;
"RTN","PSJMON",20,0)
 NEW ZTDESC,ZTRTN,ZTSAVE
"RTN","PSJMON",21,0)
 K IOP,%ZIS,POP S %ZIS="QM" D ^%ZIS
"RTN","PSJMON",22,0)
 I POP K SEL,DIR,DTOUT,DUOUT,DIRUT,MONT W !,"NOTHING PRINTED" Q
"RTN","PSJMON",23,0)
 I $D(IO("Q")) D  Q
"RTN","PSJMON",24,0)
 .S ZTRTN="OUT^PSJMON",ZTDESC="Monograph Report of Drug Interactions"
"RTN","PSJMON",25,0)
 .S ZTSAVE("LIST")="",ZTSAVE("^TMP($J,""PSJPMON"",")=""
"RTN","PSJMON",26,0)
 .D ^%ZTLOAD,^%ZISC W !,"Monograph Queued to Print!",! S:$D(ZTQUEUED) ZTREQ="Q"
"RTN","PSJMON",27,0)
 D OUT,^%ZISC
"RTN","PSJMON",28,0)
 Q
"RTN","PSJMON",29,0)
OUT ;Print the Professional Monograph
"RTN","PSJMON",30,0)
 NEW PSJMONV,PSJPN,PSJQUIT,PSJNUM
"RTN","PSJMON",31,0)
 U IO
"RTN","PSJMON",32,0)
 S PSJQUIT=0
"RTN","PSJMON",33,0)
 F PSJNUM=0:0 S PSJNUM=$O(^TMP($J,"PSJPMON",PSJNUM)) Q:'PSJNUM  D
"RTN","PSJMON",34,0)
 .S PSJSERVR="" F  S PSJSERVR=$O(^TMP($J,"PSJPMON",PSJNUM,PSJSERVR)) Q:PSJSERVR=""  F PSJPN=0:0 S PSJPN=$O(^TMP($J,"PSJPMON",PSJNUM,PSJSERVR,PSJPN)) Q:'PSJPN  Q:PSJQUIT=2  D
"RTN","PSJMON",35,0)
 .. S PSJMONV=^TMP($J,"PSJPMON",PSJNUM,PSJSERVR,PSJPN)
"RTN","PSJMON",36,0)
 .. I PSJMONV="Professional Monograph " S PSJQUIT=0 D
"RTN","PSJMON",37,0)
 ... I $G(PSJIOF) K PSJIOF W !! W @IOF Q
"RTN","PSJMON",38,0)
 ... ;Ignore 1 "^" and display the next mon.
"RTN","PSJMON",39,0)
 ... I '$G(PSJIOF) W !! S:$E(IOST)="C" PSJQUIT=$$PAUSE1^PSJMISC() S:PSJQUIT=1 PSJQUIT=0 W @IOF
"RTN","PSJMON",40,0)
 .. I PSJQUIT Q
"RTN","PSJMON",41,0)
 .. W !,PSJMONV
"RTN","PSJMON",42,0)
 .. I $Y+4>IOSL,$E(IOST)="C" W ! S PSJQUIT=$$PAUSE1^PSJMISC() W @IOF S:PSJQUIT=1 PSJIOF=1
"RTN","PSJMON",43,0)
 W !
"RTN","PSJMON",44,0)
 Q
"RTN","PSJMON",45,0)
LSTMON(PSJMON) ;Display a list of monographs to the user & store mon for printing to screen/printer
"RTN","PSJMON",46,0)
 ;PSJMON(ProfileVaGEN+ProspectiveDrugname,monographTitle)=P1...P11 (PSJMON array groups the same drug pair and title into one selectable choice)
"RTN","PSJMON",47,0)
 ;PSJMONS(seq no,monographTitle)=P1...P11 (a drug pair may have 1 or more titles.  This array is to store title 2 and subsequence)
"RTN","PSJMON",48,0)
 ;PSJMONLI(n)=P1...P11 (PSJMONLI array keeps the drug pair/monograph in a numeric list)
"RTN","PSJMON",49,0)
 ;P1 : Sequential #
"RTN","PSJMON",50,0)
 ;P2 : Drug name (profile)
"RTN","PSJMON",51,0)
 ;P3 : Profile Drug IEN file 50
"RTN","PSJMON",52,0)
 ;P4 : Drug name of order being worked on
"RTN","PSJMON",53,0)
 ;p5 : Drug IEN file 50 from order being worked on
"RTN","PSJMON",54,0)
 ;P6 : Pharmacy order # (Package;ON;PROFILE/PROSPECTIVE;SEQ # (I;29V;PROFILE;1)
"RTN","PSJMON",55,0)
 ;P7 : Severity (C: critical, S: significant)
"RTN","PSJMON",56,0)
 ;P8 : Use by PSJMONLI array (extra PMON for the same pair)
"RTN","PSJMON",57,0)
 ;P9 : If set to 1, the display will be "CRITICAL/SIGNIFICANT" for severity in the selection drug pair display
"RTN","PSJMON",58,0)
 ;P10: If set to 1, the package display will be "IO" in the selection drug pair display
"RTN","PSJMON",59,0)
 ;P11: VA GENERIC name (profile)
"RTN","PSJMON",60,0)
 NEW DIR,DIRUT,DTOUT,DUOUT,PSJCNT,PSJPON1,PSJMONV,PSJMONTI,PSJDNM,PSJN,PSJPN,PSJS,PSJSEV1,PSJX,PSJX1,PSJY,X,Y
"RTN","PSJMON",61,0)
 NEW PSJMONLI,PSJMONS
"RTN","PSJMON",62,0)
 K ^TMP($J,"PSJPMON")
"RTN","PSJMON",63,0)
 D NUMLST
"RTN","PSJMON",64,0)
 S PSJY=$O(PSJMONLI(""),-1)
"RTN","PSJMON",65,0)
 I PSJY>1 S PSJY=$$SELLST(.PSJMONLI)
"RTN","PSJMON",66,0)
 Q:'+PSJY
"RTN","PSJMON",67,0)
 S PSJPRTFL=1
"RTN","PSJMON",68,0)
 S PSJCNT=0
"RTN","PSJMON",69,0)
 F PSJX1=1:1:$L(PSJY) S PSJX=$P(PSJY,",",PSJX1) Q:PSJX=""  D
"RTN","PSJMON",70,0)
 . S PSJMONV=PSJMONLI(PSJX)
"RTN","PSJMON",71,0)
 . D SETMON(PSJX1,PSJMONV)
"RTN","PSJMON",72,0)
 . I +$P(PSJMONV,U,8) S PSJMONTI="" F  S PSJMONTI=$O(PSJMONS(PSJX,PSJMONTI)) Q:PSJMONTI=""  D
"RTN","PSJMON",73,0)
 .. S PSJMONV=PSJMONS(PSJX,PSJMONTI) D SETMON(PSJX1,PSJMONV)
"RTN","PSJMON",74,0)
 Q
"RTN","PSJMON",75,0)
SELLST(PSJMONLI) ;Only present selection pair if there are more than 1 pair in the list
"RTN","PSJMON",76,0)
 NEW DIR,DIRUT,DTOUT,DUOUT,PSJPON1,PSJMONV,PSJS,PSJSEV1,PSJX,X,Y
"RTN","PSJMON",77,0)
 W !
"RTN","PSJMON",78,0)
 F PSJX=0:0 S PSJX=$O(PSJMONLI(PSJX)) Q:'PSJX  D
"RTN","PSJMON",79,0)
 . S PSJMONV=PSJMONLI(PSJX)
"RTN","PSJMON",80,0)
 . F X=1:1:11 S PSJS(X)=$P(PSJMONV,U,X)
"RTN","PSJMON",81,0)
 . S PSJSEV1=$S(PSJS(9):"CRITICAL/SIGNIFICANT",PSJS(7)="C":"CRITICAL",PSJS(7)="S":"SIGNIFICANT",1:"")
"RTN","PSJMON",82,0)
 . S PSJPON1=$S(PSJS(10):"IO",$P(PSJS(6),";")="I":"I",1:"O")
"RTN","PSJMON",83,0)
 . W !,PSJX,".  ",$$VAGEN^PSJMISC(PSJS(5))," and ",$P(PSJS(11),"+")," ("_PSJSEV1_" - "_PSJPON1_")"
"RTN","PSJMON",84,0)
 W !
"RTN","PSJMON",85,0)
 K DIR S DIR(0)="LO^1:"_$O(PSJMONLI(""),-1),DIR("A")="Select Monograph(s) for printing by number" D ^DIR
"RTN","PSJMON",86,0)
 Q Y
"RTN","PSJMON",87,0)
SETMON(PSJNUM,PSJMONV) ;Setup monograph for screen/prt
"RTN","PSJMON",88,0)
 ;PSJNUM - selected # from monograph's list
"RTN","PSJMON",89,0)
 NEW PSJPN,PSJS,X
"RTN","PSJMON",90,0)
 I $G(PSJMONV)="" Q
"RTN","PSJMON",91,0)
 Q:'$G(PSJNUM)
"RTN","PSJMON",92,0)
 F X=1:1:11 S PSJS(X)=$P(PSJMONV,U,X)
"RTN","PSJMON",93,0)
 S X=$G(^TMP($J,"PSJPRE","OUT","DRUGDRUG",PSJS(7),PSJS(2),PSJS(6),PSJS(1),"PMON",5,0))
"RTN","PSJMON",94,0)
 S X=$P(X,"SEVERITY LEVEL:  ",2)
"RTN","PSJMON",95,0)
 S PSJSERVR=PSJS(11)_$E(X,1,1)
"RTN","PSJMON",96,0)
 D STOREMON("Professional Monograph",PSJSERVR)
"RTN","PSJMON",97,0)
 S PSJMONV="Drug Interaction with "_$P(PSJS(11),"+")_" and "_$$VAGEN^PSJMISC(PSJS(5))
"RTN","PSJMON",98,0)
 D STOREMON(PSJMONV,PSJSERVR),STOREMON("",PSJSERVR)
"RTN","PSJMON",99,0)
 F PSJPN=0:0 S PSJPN=$O(^TMP($J,"PSJPRE","OUT","DRUGDRUG",PSJS(7),PSJS(2),PSJS(6),PSJS(1),"PMON",PSJPN)) Q:'PSJPN  D
"RTN","PSJMON",100,0)
 . S PSJMONV=$G(^TMP($J,"PSJPRE","OUT","DRUGDRUG",PSJS(7),PSJS(2),PSJS(6),PSJS(1),"PMON",PSJPN,0))
"RTN","PSJMON",101,0)
 . S PSJCNT=PSJCNT+1
"RTN","PSJMON",102,0)
 . D STOREMON(PSJMONV,PSJSERVR)
"RTN","PSJMON",103,0)
 Q
"RTN","PSJMON",104,0)
NUMLST ;Set the monograph into a number selectable list
"RTN","PSJMON",105,0)
 NEW PSJDNM,PSJMONTI,PSJMFLG,PSJN,PSJON1,PSJON2,PSJONFG
"RTN","PSJMON",106,0)
 S PSJN=0
"RTN","PSJMON",107,0)
 S PSJDNM="" F  S PSJDNM=$O(PSJMON(PSJDNM)) Q:PSJDNM=""  S PSJMONTI="",PSJMFLG=0 F  S PSJMONTI=$O(PSJMON(PSJDNM,PSJMONTI)) Q:PSJMONTI=""  D
"RTN","PSJMON",108,0)
 . I 'PSJMFLG S PSJN=PSJN+1 S PSJMONLI(PSJN)=PSJMON(PSJDNM,PSJMONTI)
"RTN","PSJMON",109,0)
 . I PSJMFLG D
"RTN","PSJMON",110,0)
 .. S PSJMONLI(PSJN)=PSJMONLI(PSJN)_"^^"_PSJN
"RTN","PSJMON",111,0)
 .. S $P(PSJMONLI(PSJN),U,8)=1
"RTN","PSJMON",112,0)
 .. S PSJMONS(PSJN,PSJMONTI)=PSJMON(PSJDNM,PSJMONTI)
"RTN","PSJMON",113,0)
 .. S PSJON1=$P($P(PSJMONLI(PSJN),U,6),";")
"RTN","PSJMON",114,0)
 .. S PSJON2=$P($P(PSJMONS(PSJN,PSJMONTI),U,6),";")
"RTN","PSJMON",115,0)
 .. S PSJONFG=0
"RTN","PSJMON",116,0)
 .. I PSJON1="I",PSJON1'="I" S PSJONFG=1
"RTN","PSJMON",117,0)
 .. I PSJON1'="I",PSJON1="I" S PSJONFG=1
"RTN","PSJMON",118,0)
 .. S:PSJONFG $P(PSJMONLI(PSJN),U,10)=1
"RTN","PSJMON",119,0)
 .. I $P(PSJMONLI(PSJN),U,7)'=$P(PSJMONS(PSJN,PSJMONTI),U,7) S $P(PSJMONLI(PSJN),U,9)=1
"RTN","PSJMON",120,0)
 . S PSJMFLG=1
"RTN","PSJMON",121,0)
 K PSJON1,PSJON2,PSJONFG
"RTN","PSJMON",122,0)
 Q
"RTN","PSJMON",123,0)
STOREMON(PSJX,PSJSERVR) ;Store the formatted Monograph
"RTN","PSJMON",124,0)
 NEW PSJX1,X,Y,Y1
"RTN","PSJMON",125,0)
 Q:'$G(PSJNUM)
"RTN","PSJMON",126,0)
 I $G(PSJSERVR)="" S PSJSERVR=1
"RTN","PSJMON",127,0)
 S PSJCNT=$G(PSJCNT)+1
"RTN","PSJMON",128,0)
 S X="REFERENCES:"
"RTN","PSJMON",129,0)
 I $E(PSJX,1,$L(X))=X S ^TMP($J,"PSJPMON",PSJNUM,PSJSERVR,PSJCNT)=X,PSJCNT=PSJCNT+1 S PSJX=$P(PSJX,X,2)
"RTN","PSJMON",130,0)
 S PSJX1=""
"RTN","PSJMON",131,0)
 F Y=1:1:$L(PSJX," ") S Y1=$P(PSJX," ",Y) D
"RTN","PSJMON",132,0)
 . I ($L(PSJX1)+$L(Y1)+1)>73 S:$E(PSJX1,1,1)=" " PSJX1=$E(PSJX1,2,$L(PSJX1)) S ^TMP($J,"PSJPMON",PSJNUM,PSJSERVR,PSJCNT)=PSJX1,PSJX1="",PSJCNT=PSJCNT+1
"RTN","PSJMON",133,0)
 . S PSJX1=PSJX1_Y1_" "
"RTN","PSJMON",134,0)
 I PSJX1]"" S ^TMP($J,"PSJPMON",PSJNUM,PSJSERVR,PSJCNT)=PSJX1
"RTN","PSJMON",135,0)
 K PSJX1
"RTN","PSJMON",136,0)
 Q
"RTN","PSJO")
0^18^B23069149
"RTN","PSJO",1,0)
PSJO ;BIR/CML3,PR-GET AND PRINT INPATIENT ORDERS ;28 Jun 99 / 10:20 AM
"RTN","PSJO",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**31,58,110,181**;16 DEC 97;Build 190
"RTN","PSJO",3,0)
 ;
"RTN","PSJO",4,0)
 ; Reference to ^PSD(58.8 supported by DBIA #2283.
"RTN","PSJO",5,0)
 ; Reference to ^PSI(58.1 supported by DBIA #2284.
"RTN","PSJO",6,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSJO",7,0)
 ;
"RTN","PSJO",8,0)
 K ^TMP("PSJON",$J),^TMP("PSJ",$J) D @$S($D(PSJEXTP):"EN^PSJH1",1:"EN^PSJO1(3)")
"RTN","PSJO",9,0)
 S PSJDEV=IO'=IO(0)!($E(IOST,1,2)'="C-"),(NP,PSGON,PSJON)=""
"RTN","PSJO",10,0)
 U IO D ENGET^PSJO3 I '$D(^TMP("PSJ",$J)) W !,SLS,SLS,$E(SLS,1,25),!!?22,"NO ORDERS FOUND FOR ",$S(PSJOL="S":"SHORT",1:"LONG")," PROFILE."
"RTN","PSJO",11,0)
 E  S (PSJC,PSJS,PSJO,PSJST)="" F  S PSJC=$O(^TMP("PSJ",$J,PSJC)) Q:PSJC=""  D  G:NP["^" DONE
"RTN","PSJO",12,0)
 .D:$S((PSJC["B"&'TF):0,PSJC'["A":1,1:1) TF
"RTN","PSJO",13,0)
 .F  S PSJST=$O(^TMP("PSJ",$J,PSJC,PSJST)) Q:PSJST=""  F  S PSJS=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS)) Q:PSJS=""!(NP[U)  D ON
"RTN","PSJO",14,0)
 G:NP[U DONE I PSJDEV,$S('$D(PSJPRP):1,1:PSJPRP="P") D BOT
"RTN","PSJO",15,0)
 ;
"RTN","PSJO",16,0)
DONE ;
"RTN","PSJO",17,0)
 I $S('$D(PSJPRP):1,1:PSJPRP="P") K ^TMP("PSJ",$J)
"RTN","PSJO",18,0)
 S PSGON=PSJON K:'$D(PSGVBW) PSGODT K %,%H,%I,C,DN,DO,DRG,FQ,GIVE,HDT,I,JJ,LN2,N,ND,ND4,ND6,NF,NP,O,ON,ORIFN,ORTX,P,PF,PG,PS,PSGID,PSGOD,PSIVSC,PSIVST,PSIVTY,PSJC,PSJDEV,PSJF,PSJO,PSJOS,PSJS,PSJSCHT,PSJST,QQ,RB,RTE,SCH,SD,SLS,SM
"RTN","PSJO",19,0)
 K ST,START,STAT,SUB,TF,TYP,UDU,UPD,V,WS,X,X1,X2,Y Q
"RTN","PSJO",20,0)
 ;
"RTN","PSJO",21,0)
ON ;
"RTN","PSJO",22,0)
 S PSJSCHT=$S(PSJOS:PSJS,1:PSJST)
"RTN","PSJO",23,0)
 F FQ=0:0 S PSJO=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS,PSJO)) Q:PSJO=""  S DN=^(PSJO) D:$Y+6>IOSL ENNP^PSJO3 Q:NP["^"  D  ;
"RTN","PSJO",24,0)
 .S PSJON=PSJON+1 S:'PSJDEV ^TMP("PSJON",$J,PSJON)=PSJO W !,$J(PSJON,4),?5 D @$S(PSJO["V":"PIV^PSIVUTL(PSJO)",PSJO["U":"PUD",1:"PIV^PSIVUTL(PSJO)")
"RTN","PSJO",25,0)
 Q
"RTN","PSJO",26,0)
 ;
"RTN","PSJO",27,0)
PUD ; print unit dose
"RTN","PSJO",28,0)
 ; Naked reference below refers to full reference ^PS(53.1,+PSJO,0) or ^PS(55,DFN,5,+PSJO,0) using indirection.
"RTN","PSJO",29,0)
 S ND=$S($D(@(PSJF_+PSJO_",0)")):^(0),1:""),SCH=$G(^(2)),ND4=$G(^(4)),ND6=$P($G(^(6)),"^"),DO=$S($P(DN,"^",2)=.2:$P($G(@(PSJF_+PSJO_",.2)")),"^",2),1:$G(@(PSJF_+PSJO_",.3)")))
"RTN","PSJO",30,0)
 ;I PSJC["A" S V='$P(ND4,"^",UDU) W $S(ND4="":" ",$P(ND4,"^",12):"D",$P(ND4,"^",18)&($P(ND4,"^",19)!V):"H",$P(ND4,"^",22)&($P(ND4,"^",23)!V):"H",$P(ND4,"^",15)&($P(ND4,"^",16)!V):"R",1:" ") W:V&(PSJSYSU) "->"
"RTN","PSJO",31,0)
 I ("AO"[PSJC)!(PSJC="DF") D
"RTN","PSJO",32,0)
 .S V='$P(ND4,"^",UDU),V=$S(+PSJSYSU=1&V:1,+PSJSYSU=3&V:1,1:0)
"RTN","PSJO",33,0)
 .W $S(ND4="":" ",$P(ND4,"^",12):"D",$P(ND4,"^",18)&($P(ND4,"^",19)!V):"H",$P(ND4,"^",22)&($P(ND4,"^",23)!V):"H",$P(ND4,"^",15)&($P(ND4,"^",16)!V):"R",1:" ")
"RTN","PSJO",34,0)
 .W $S($P($G(@(PSJF_+PSJO_",.2)")),"^",4)="D":"d",1:" ")_$S(V:"->",1:"  ")
"RTN","PSJO",35,0)
 ;I $S(PSJC["NZ":0,1:PSJC["N") W $S($P(ND4,"^",12):"D",1:" "),$S(PSJSYSU:"->",1:"")
"RTN","PSJO",36,0)
 I $S(PSJC["NZ":0,1:PSJC["N") W $S($P(ND4,"^",12):"D",1:" ")
"RTN","PSJO",37,0)
 S RTE=$P(ND,"^",3),SM=$S('$P(ND,"^",5):0,$P(ND,"^",6):1,1:2),STAT=$S($P(ND,"^",28)]"":$P(ND,"^",28),$P(ND,"^",9)]"":$P(ND,"^",9),1:"NF")
"RTN","PSJO",38,0)
 S PF=$E("*",$P(ND,"^",20)>0),PSGID=$P(SCH,"^",2),SD=$P(SCH,"^",4),SCH=$P(SCH,"^")
"RTN","PSJO",39,0)
 I STAT="A",$P(ND,U,27)="R" S STAT="R"
"RTN","PSJO",40,0)
 S NF=$P(DN,"^",2),WS=$S(PSJPWD:$$WS(PSJPWD,PSGP,PSJF,PSJO),1:0)
"RTN","PSJO",41,0)
 NEW MARX,PSJRNDT
"RTN","PSJO",42,0)
 S PSJRNDT=$$LASTREN^PSJLMPRI(DFN,PSJO) S:PSJRNDT PSJRNDT=$E($$ENDTC^PSGMI(+PSJRNDT),1,5)
"RTN","PSJO",43,0)
 D DRGDISP^PSJLMUT1(PSGP,+PSJO_$S(PSJC["A":"U",PSJC["O":"U",PSJC="DF":"U",1:"P"),40,54,.MARX,0)
"RTN","PSJO",44,0)
 F X=0:0 S X=$O(MARX(X)) Q:'X  W @($S(X=1:"?9",1:"!?11")),$S($E(PSJS)="*":$P(PSJS,"^"),1:MARX(X)) D:X=1
"RTN","PSJO",45,0)
 . W ?50,$S(PSJC["NZ":"?",PSJSCHT'="z":PSJSCHT,1:"?")
"RTN","PSJO",46,0)
 . W:'$D(PSJEXTP) ?53,$S(PSJC["NZ":"*****",1:$E($$ENDTC^PSGMI(PSGID),1,5)),?60,$S(PSJC["NZ":"*****",1:$E($$ENDTC^PSGMI(SD),1,5)),?67,STAT
"RTN","PSJO",47,0)
 . W:$D(PSJEXTP) ?53,$S(PSJC["NZ":"*****",1:$E($$ENDTC^PSGMI(PSGID),1,8)),?63,$S(PSJC["NZ":"*****",1:$E($$ENDTC^PSGMI(SD),1,8)),?73,STAT
"RTN","PSJO",48,0)
 . I NF!WS!SM!PF!(PSJRNDT]"") W ?71 W:NF "NF " W:WS "WS " W:SM $E("HSM",SM,3) W:$G(PSJRNDT) PSJRNDT W:PF ?79,"*"
"RTN","PSJO",49,0)
 I ND6]"" S Y=$$ENSET^PSGSICHK(ND6) W !?11 F X=1:1:$L(Y," ") S V=$P(Y," ",X) W:$L(V)+$X>66 !?11 W V_" "
"RTN","PSJO",50,0)
 Q
"RTN","PSJO",51,0)
 ;
"RTN","PSJO",52,0)
TF ;
"RTN","PSJO",53,0)
 NEW SLS,C S SLS="",C=PSJC,$P(SLS," -",40)=""
"RTN","PSJO",54,0)
 S LN2=$S(C="A":$$TXT(C),C["CC":$$TXT("PR"),C["CD":$$TXT("PC"),C["BD":$$TXT("NC"),C["C":$$TXT("P"),C["B":$$TXT("N"),C["NX":$$TXT("N"),C["DF":$$TXT("DF"),C["NZ":$$TXT("P"),1:$$TXT("NA"))
"RTN","PSJO",55,0)
 W:$D(^TMP("PSJ",$J,PSJC)) !,$E($E(SLS,1,(80-$L(LN2))/2)_" "_LN2_$E(SLS,1,(80-$L(LN2))/2),1,80)
"RTN","PSJO",56,0)
 S PSJF="^PS("_$S(PSJC'["C":"55,"_PSGP_",5,",1:"53.1,") S TF=$S(PSJC["C":0,1:TF)
"RTN","PSJO",57,0)
 Q
"RTN","PSJO",58,0)
 ;
"RTN","PSJO",59,0)
 ;
"RTN","PSJO",60,0)
TXT(X) ;
"RTN","PSJO",61,0)
 I $G(X)="" Q ""
"RTN","PSJO",62,0)
 I X="A" Q "A C T I V E"
"RTN","PSJO",63,0)
 S PSJDCEXP=$$RECDCEXP^PSJP()
"RTN","PSJO",64,0)
 I X="DF" Q "RECENTLY DISCONTINUED/EXPIRED (LAST "_+$G(PSJDCEXP)_" HOURS)"
"RTN","PSJO",65,0)
 I X="N" Q "N O N - V E R I F I E D"
"RTN","PSJO",66,0)
 I X="NA" Q "N O N - A C T I V E"
"RTN","PSJO",67,0)
 I X="NC" Q "N O N - V E R I F I E D  C O M P L E X"
"RTN","PSJO",68,0)
 I X="P" Q "P E N D I N G"
"RTN","PSJO",69,0)
 I X="PC" Q "P E N D I N G  C O M P L E X"
"RTN","PSJO",70,0)
 I X="PR" Q "P E N D I N G   R E N E W A L S"
"RTN","PSJO",71,0)
 Q ""
"RTN","PSJO",72,0)
 ;
"RTN","PSJO",73,0)
BOT ; print name, ssn, and dob on bottom of page
"RTN","PSJO",74,0)
 F Q=$Y:1:IOSL-4 W !
"RTN","PSJO",75,0)
 W !,?2,$P(PSGP(0),"^"),?40,PSJPPID,?70,$E($P(PSJPDOB,"^",2),1,8)
"RTN","PSJO",76,0)
 Q
"RTN","PSJO",77,0)
WS(PSJPWD,PSGP,PSJF,PSJO) ; - WARD STOCK flag, input=(ward,dfn,file root,order)
"RTN","PSJO",78,0)
 ; Naked reference below refers to full reference ^PS(55,DFN,5,+PSJO,1,"B",PSWS) using indirection.
"RTN","PSJO",79,0)
 S WS=0,PSJF=PSJF_+PSJO_",1,""B"")" I $D(@PSJF) N PSWS S PSWS=0 F  S PSWS=$O(^("B",PSWS)) Q:'PSWS  S WS=$$WSCHK(PSJPWD,PSWS) Q:WS
"RTN","PSJO",80,0)
 Q WS
"RTN","PSJO",81,0)
 ;
"RTN","PSJO",82,0)
WSCHK(PSJPWD,PSWS) ; Determine if drug is ward stock item.
"RTN","PSJO",83,0)
 Q $S(PSJPWD:$S($D(^PSI(58.1,"D",PSWS,PSJPWD)):1,$D(^PSD(58.8,"D",PSWS,PSJPWD)):1,1:0),1:0)
"RTN","PSJO1")
0^19^B32562541
"RTN","PSJO1",1,0)
PSJO1 ;BIR/CML3,PR-GET UNIT DOSE/IV ORDERS FOR INPATIENT ;15 May 98 / 9:28 AM
"RTN","PSJO1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,47,56,58,109,110,127,162,181**;16 DEC 97;Build 190
"RTN","PSJO1",3,0)
 ;
"RTN","PSJO1",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJO1",5,0)
 ; Reference to ^%DTC is supported by DBIA# 10000.
"RTN","PSJO1",6,0)
 ; Reference to ^%ZOSV is supported by DBIA# 10097.
"RTN","PSJO1",7,0)
 ; Reference to XLFDT is supported by DBIA# 10103.
"RTN","PSJO1",8,0)
 ;
"RTN","PSJO1",9,0)
ECHK ;
"RTN","PSJO1",10,0)
 S C="A",ON=+O_"U",START=$G(^PS(55,PSGP,5,+O,2)),STOP=$P(START,U,4),START=$P(START,U,2) S:PSJOS START=-START
"RTN","PSJO1",11,0)
 I +START>PSGDT,(STOP>PSGDT) G SET
"RTN","PSJO1",12,0)
 S ND=$G(^PS(55,PSGP,5,+O,0)) G:$S($P(ND,"^",9)="":1,1:"DE"'[$P(ND,"^",9)) SET S ND4=$G(^PS(55,PSGP,5,+O,4)) I ST'="O",SD'<PSGODT,$S($P(ND,"^",9)="E":$P(ND4,"^",16),1:0)
"RTN","PSJO1",13,0)
 E  I ST="O",$P(ND,"^",9)="E",$S('$P(ND4,"^",UDU):1,SD<PSGODT:0,1:$P(ND4,"^",16))
"RTN","PSJO1",14,0)
 E  I PSJOL="S",(STOP>$P($G(PSJDCEXP),U,2)) S C="DF" G SET
"RTN","PSJO1",15,0)
 E  Q:PSJOL="S"  S C="O"
"RTN","PSJO1",16,0)
 ;
"RTN","PSJO1",17,0)
SET ;
"RTN","PSJO1",18,0)
 I ON["P",($D(PRNTON)!($D(P("PRNTON")))) N PSJOK S PSJOK=$$COMCHK($S($G(P("PRNTON"))]"":P("PRNTON"),$G(PRNTON)]"":PRNTON,1:""),PSJPTYP) Q:'PSJOK
"RTN","PSJO1",19,0)
 NEW DRUGNAME D DRGDISP^PSJLMUT1(PSGP,ON,40,0,.DRUGNAME,1)
"RTN","PSJO1",20,0)
 S DN=DRUGNAME(1),SUB=$S(PSJOS:START,1:$E(DN,1,40))
"RTN","PSJO1",21,0)
 I ON["P",$G(P("PRNTON"))]"",$G(PRNTON)=+P("PRNTON") Q
"RTN","PSJO1",22,0)
 I ON["P",$G(P("PRNTON"))]"" S PRNTON=+P("PRNTON"),ON=+P("PRNTON")
"RTN","PSJO1",23,0)
 S ^TMP("PSJ",$J,C,$S(PSJOS:SUB,1:ST),$S(PSJOS:ST,1:SUB),ON)=DN_"^"_$G(NF),PSJOCNT=PSJOCNT+1 Q
"RTN","PSJO1",24,0)
 ;
"RTN","PSJO1",25,0)
IVSET ;Set IV data in ^TMP("PSJ",$J,.
"RTN","PSJO1",26,0)
 N DRG,DRGT,ON55,ORTX,P,STAT,TYP,X,Y,NAME,ND
"RTN","PSJO1",27,0)
 I ON["V" S ON55=ON,Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,4,9,17 S P(X)=$P(Y,U,X)
"RTN","PSJO1",28,0)
 I ON["V",(P(2)=""),(P(3)="") Q
"RTN","PSJO1",29,0)
 I ON'["V" S ND=$G(^PS(53.1,+ON,0)) I 'ND K ^PS(53.1,"AS",SD,PSGP,+ON) Q
"RTN","PSJO1",30,0)
 I ON'["V",ND S P(17)=$P($G(^PS(53.1,+ON,0)),U,9),Y=$G(^PS(53.1,+ON,2)),P(9)=$P(Y,U),P(2)=$P(Y,U,2),P(3)=$P(Y,U,4),P(4)=$P($G(^PS(53.1,+ON,8)),U),P("PRNTON")=$P($G(^PS(53.1,+ON,.2)),U,8)
"RTN","PSJO1",31,0)
 I ON'["V",P("PRNTON")]"" N PSJOK S PSJOK=$$COMCHK(P("PRNTON"),PSJPTYP) Q:'PSJOK
"RTN","PSJO1",32,0)
 D @$S(ON["V":"GTDRG^PSIVORFB",1:"GTDRG^PSIVORFA"),GTOT^PSIVUTL(P(4))
"RTN","PSJO1",33,0)
 I $G(DRG) S DRGT=$S($G(DRG("AD",1))]"":$P($G(DRG("AD",1)),U,2),1:$P($G(DRG("SOL",1)),U,2)),ORTX=DRGT
"RTN","PSJO1",34,0)
 I $G(ORTX)="",(ON'["V") D DRGDISP^PSJLMUT1(PSGP,+ON_"P",40,"",.NAME,1) S ORTX=NAME(1)
"RTN","PSJO1",35,0)
 ;* I $G(ORTX)=""!(ON'["V") D DRGDISP^PSJLMUT1(PSGP,+ON_"P",40,"",.NAME,1) S ORTX=NAME(1)
"RTN","PSJO1",36,0)
 S:$G(ORTX)="" ORTX="NOT FOUND"
"RTN","PSJO1",37,0)
 ;
"RTN","PSJO1",38,0)
IVSET1 ;
"RTN","PSJO1",39,0)
 ;* S TYP=$S(P(2)=P(3):"O",1:"C"),STAT=$S("ED"[P(17):"O",P(17)="P":"P",1:"A")
"RTN","PSJO1",40,0)
 S TYP=$$ONE^PSJBCMA(PSGP,ON,P(9),P(2),P(3)) I TYP'="O" S TYP=$S(ON["P":"z",1:"C")
"RTN","PSJO1",41,0)
 S STAT=$S($G(PSJPRI)="D":"A","ED"[P(17):"O",P(17)="P":"P",1:"A")
"RTN","PSJO1",42,0)
 I P(17)="P" S STAT="C"_$S($P($G(^PS(53.1,+ON,.2)),U,8)]"":"D",$P($G(^PS(53.1,+ON,.2)),U,4)="S":"A",$P($G(^(0)),U,24)="R":"C",1:"B")
"RTN","PSJO1",43,0)
 I PSJOL="S",(STAT="O"),(P(3)>$P($G(PSJDCEXP),U,2)) S STAT="DF"
"RTN","PSJO1",44,0)
 I ON["P",$G(P("PRNTON"))]"",PRNTON=+P("PRNTON") Q
"RTN","PSJO1",45,0)
 I ON["P",$G(P("PRNTON"))]"" S PRNTON=+P("PRNTON"),ON=+P("PRNTON")
"RTN","PSJO1",46,0)
 S ^TMP("PSJ",$J,STAT,$S(PSJOS:-P(2),1:TYP),$S(PSJOS:TYP,1:ORTX),ON)="^F",PSJOCNT=PSJOCNT+1
"RTN","PSJO1",47,0)
 Q
"RTN","PSJO1",48,0)
 ;
"RTN","PSJO1",49,0)
ENU ; update status field to reflect expired orders, if necessary
"RTN","PSJO1",50,0)
 W !!,"...a few moments, I have some updating to do..."
"RTN","PSJO1",51,0)
ENUNM ;
"RTN","PSJO1",52,0)
 F Q=+PSJPAD:0 S Q=$O(^PS(55,PSGP,5,"AUS",Q)) Q:'Q!(Q>PSGDT)  S UPD=Q F QQ=0:0 S QQ=$O(^PS(55,PSGP,5,"AUS",Q,QQ)) Q:'QQ  I $D(^PS(55,PSGP,5,QQ,0)),"DEH"'[$E($P(^(0),"^",9)) D
"RTN","PSJO1",53,0)
 .; naked ref below refers to line above
"RTN","PSJO1",54,0)
 .S $P(^(0),"^",9)="E",ORIFN=$P(^(0),"^",21) D EN1^PSJHL2(PSGP,"SC",QQ_"U")
"RTN","PSJO1",55,0)
 K UPD Q
"RTN","PSJO1",56,0)
 ;
"RTN","PSJO1",57,0)
EN(PSJPTYP) ; enter here
"RTN","PSJO1",58,0)
 ; PSJPTYP=1:UD ONLY, 2:IV ONLY, 3:BOTH
"RTN","PSJO1",59,0)
 N PSJX,PSJY
"RTN","PSJO1",60,0)
 S PSJDCEXP=$$RECDCEXP^PSJP()
"RTN","PSJO1",61,0)
 S PSJOL=$G(PSJOL)  ; Initialize if no 'View Profile' option selected
"RTN","PSJO1",62,0)
 I PSJOL="L",$D(XRTL) D T0^%ZOSV
"RTN","PSJO1",63,0)
 K ^TMP("PSJ",$J) D NOW^%DTC S PSGDT=+$E(%,1,12),DT=$$DT^XLFDT,PSJOS=$P(PSJSYSP0,"^",11),UDU=$S($P(PSJSYSU,";",3)>1:3,1:1)
"RTN","PSJO1",64,0)
 S PSJOCNT=0 I PSJPTYP>1 F PSJORD=0:0 S PSJORD=$O(^PS(55,DFN,"IV",PSJORD)) Q:'PSJORD  D
"RTN","PSJO1",65,0)
 .S PSJX=$G(^PS(55,DFN,"IV",+PSJORD,0))
"RTN","PSJO1",66,0)
 .S PSJY=$P(PSJX,U,17)
"RTN","PSJO1",67,0)
 .I $P(PSJX,U,3)<PSGDT,"AR"[PSJY S $P(^PS(55,DFN,"IV",+PSJORD,0),U,17)="E",PSJY="E",ON=+PSJORD D EXPIR^PSIVOE
"RTN","PSJO1",68,0)
 .I +PSJSYSU=3,('+$P($G(^PS(55,DFN,"IV",+PSJORD,4)),U,4)),($P($G(^(.2)),U,4)="D") S PSJPRI="D"
"RTN","PSJO1",69,0)
 .I $S($G(PSJPRI)="D":1,PSJY="P":0,PSJOL="L":1,$P(PSJX,U,3)>$P($G(PSJDCEXP),U,2):1,1:"DPE"'[PSJY) S ON=+PSJORD_"V" D IVSET K PSJPRI,ON
"RTN","PSJO1",70,0)
 D NOW^%DTC S PSJIVOF=PSJOCNT,PSGDT=%,(X1,DT)=$P(%,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1),HDT=$$ENDTC^PSGMI(PSGDT)
"RTN","PSJO1",71,0)
 D ENUNM
"RTN","PSJO1",72,0)
 I PSJPTYP'=2 F ST="C","O","OC","P","R" F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD  F O=0:0 S O=$O(^PS(55,PSGP,5,"AU",ST,SD,O)) Q:'O  D ECHK
"RTN","PSJO1",73,0)
 Q:$D(PSGONNV)
"RTN","PSJO1",74,0)
 ;I PSJPTYP'=2 F SD="I","N" S O=0 F  S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=+O_"P",X=$P($G(^PS(53.1,+O,0)),U,4) I $S(PSJPTYP=3:1,PSJPTYP=1&("FI"[X):0,1:1) D NVSET
"RTN","PSJO1",75,0)
 N PRNTON F SD="I","N" S (PRNTON,O)=0 F  S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=+O_"P",X=$P($G(^PS(53.1,+O,0)),U,4) I $S(PSJPTYP=3:1,PSJPTYP=1&("FI"[X):0,1:1) D NVSET
"RTN","PSJO1",76,0)
 ;I $S(+PSJSYSU=3:1,1:$D(PSGLPF)) S O=0,SD="P" F  S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=O_"P",X=$P($G(^PS(53.1,+O,0)),U,4) I $S(PSJPTYP=3:1,PSJPTYP=1&("FI"[X):0,1:1) D @$S("FI"[X:"IVSET",1:"NVSET")
"RTN","PSJO1",77,0)
 N PRNTON S (PRNTON,O)=0,SD="P" F  S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=O_"P",X=$P($G(^PS(53.1,+O,0)),U,4) I $S(PSJPTYP=3:1,PSJPTYP=1&("FI"[X):0,1:1) D @$S("FI"[X:"IVSET",1:"NVSET")
"RTN","PSJO1",78,0)
 I PSJOL="L",$D(XRT0) S XRTN="PSJO1" D T1^%ZOSV
"RTN","PSJO1",79,0)
 Q
"RTN","PSJO1",80,0)
 ;
"RTN","PSJO1",81,0)
NVSET ; Set up orders from 53.1.
"RTN","PSJO1",82,0)
 N ND S ND=$G(^PS(53.1,O,0)) I 'ND D  Q
"RTN","PSJO1",83,0)
 .K ^PS(53.1,"AS",SD,PSGP,O)
"RTN","PSJO1",84,0)
 I $P(ND,U,15),$G(PSGP) I PSGP'=$P(ND,U,15) D  Q
"RTN","PSJO1",85,0)
 .K ^PS(53.1,"AS",SD,PSGP,O)
"RTN","PSJO1",86,0)
 I $P(ND,U,9)["D" D  Q
"RTN","PSJO1",87,0)
 .K ^PS(53.1,"AS",SD,PSGP,O)
"RTN","PSJO1",88,0)
 .N ND2 S ND2=$G(^PS(53.1,O,.2)) I $P(ND2,U,8) K ^PS(53.1,"ACX",$P(ND2,U,8))
"RTN","PSJO1",89,0)
 S ST=$P($G(^PS(53.1,O,0)),U,7),START=-$P($G(^(2)),U,2),P("PRNTON")=$P($G(^PS(53.1,O,.2)),"^",8) S:ST="" ST="z"
"RTN","PSJO1",90,0)
 S C=$S(((SD="N")&($P($G(^PS(53.1,O,.2)),U,8)]"")):"BD",SD="N":"BA",SD="I":"BB",$P($G(^PS(53.1,O,.2)),U,8)]"":"CD",$P($G(^PS(53.1,O,.2)),U,4)="S":"CA",$P($G(^(0)),U,24)="R":"CC",1:"CB")
"RTN","PSJO1",91,0)
 ;I C="CC" S C=$$CKPC^PSGOU(PSGP,+$P($G(^PS(53.1,O,0)),U,25),O)
"RTN","PSJO1",92,0)
 D SET
"RTN","PSJO1",93,0)
 Q
"RTN","PSJO1",94,0)
 ;
"RTN","PSJO1",95,0)
KILL ;
"RTN","PSJO1",96,0)
 K P,STAT,TYP,ORTX,N,JJ
"RTN","PSJO1",97,0)
 Q
"RTN","PSJO1",98,0)
COMCHK(PSJCOM,PSJPTYP) ;Check complex orders for order type
"RTN","PSJO1",99,0)
 S OK=0
"RTN","PSJO1",100,0)
 I PSJCOM=0 S OK=1 Q OK
"RTN","PSJO1",101,0)
 I PSJCOM=""  Q OK
"RTN","PSJO1",102,0)
 I PSJPTYP="" Q OK
"RTN","PSJO1",103,0)
 I '$D(^PS(53.1,"ACX",PSJCOM)) Q OK
"RTN","PSJO1",104,0)
 S OK=1 I PSJPTYP=3 Q OK
"RTN","PSJO1",105,0)
 N PSJON S PSJON=""
"RTN","PSJO1",106,0)
 F  S PSJON=$O(^PS(53.1,"ACX",PSJCOM,PSJON)) Q:'PSJON  D  Q:OK=0
"RTN","PSJO1",107,0)
 .I $P($G(^PS(53.1,PSJON,0)),"^",9)["D" K ^PS(53.1,"ACX",PSJCOM)
"RTN","PSJO1",108,0)
 .I $P($G(^PS(53.1,PSJON,0)),"^",4)'="U",PSJPTYP=1 S OK=0 Q
"RTN","PSJO1",109,0)
 .I $P($G(^PS(53.1,PSJON,0)),"^",4)="U",PSJPTYP=2 S OK=0 Q
"RTN","PSJO1",110,0)
 Q OK
"RTN","PSJOC")
0^30^B19432161
"RTN","PSJOC",1,0)
PSJOC ;BIR/MV - NEW ORDER CHECKS DRIVER ;6 Jun 07 / 3:37 PM
"RTN","PSJOC",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**181**;16 DEC 97;Build 190
"RTN","PSJOC",3,0)
 ;
"RTN","PSJOC",4,0)
 ; Reference to ^PSODDPR4 is supported by DBIA# 5366.
"RTN","PSJOC",5,0)
 ; Reference to ^PSSHRQ2 is supported by DBIA# 5369.
"RTN","PSJOC",6,0)
 ;
"RTN","PSJOC",7,0)
OC(PSPDRG,PSJPTYP) ;
"RTN","PSJOC",8,0)
 ;PSPDRG - Drug array in format of PDRG(n)=IEN (#50) ^ Drug Name
"RTN","PSJOC",9,0)
 ;Where n is a sequential number.  The Drug Name can be OI, Generic name form #50, or Add/Sol name
"RTN","PSJOC",10,0)
 ;PSJPTYP - P1 ; P2
"RTN","PSJOC",11,0)
 ; Where P1 is "I" for Inpatient, "O" for Outpatient
"RTN","PSJOC",12,0)
 ;       P2 is the Inpatient Order Number (for PSJ use only)
"RTN","PSJOC",13,0)
 ;PSJOCERR(DRUG NAME)="Reason text". Where Drug Name can be either OI name or AD/SOL name.
"RTN","PSJOC",14,0)
 NEW PSJOCERR
"RTN","PSJOC",15,0)
 ;Quit OC if FDB link is down.  PSGORQF is defined if user wish to stop the order process
"RTN","PSJOC",16,0)
 I $$SYS^PSJOCERR() Q
"RTN","PSJOC",17,0)
 ;
"RTN","PSJOC",18,0)
 D BLD^PSODDPR4(DFN,"PSJPRE",.PSPDRG,PSJPTYP)
"RTN","PSJOC",19,0)
 D DISPLAY
"RTN","PSJOC",20,0)
 K ^TMP($J,"PSJPRE")
"RTN","PSJOC",21,0)
 Q
"RTN","PSJOC",22,0)
DISPLAY ;
"RTN","PSJOC",23,0)
 NEW PSJPAUSE,PSJOLDSV,PSJDNM,PSJMON,PSJOC,PSJOCDT,PSJOCDTL,PSJOCLST,PSJP,PSJS,PSJPON,PSJDN,PSJSEV,PSJECNT
"RTN","PSJOC",24,0)
 D GMRAOC
"RTN","PSJOC",25,0)
 Q:'$$DSPSERR()
"RTN","PSJOC",26,0)
 D FULL^VALM1
"RTN","PSJOC",27,0)
 W @IOF,"Now Processing Enhanced Order Checks!  Please wait...",!
"RTN","PSJOC",28,0)
 ; If there are no OC or errors to display, this var will trigger a pause before continue /w the order
"RTN","PSJOC",29,0)
 S PSJPAUSE=1
"RTN","PSJOC",30,0)
 D DRUGERR
"RTN","PSJOC",31,0)
 ;Process drug interaction & drug interception
"RTN","PSJOC",32,0)
 D DI^PSJOCDI
"RTN","PSJOC",33,0)
 Q:$G(PSGORQF)
"RTN","PSJOC",34,0)
 D DSPERR^PSJOCERR("DRUGDRUG")
"RTN","PSJOC",35,0)
 ;Process duplicate therapy order checks
"RTN","PSJOC",36,0)
 D DT^PSJOCDT
"RTN","PSJOC",37,0)
 D:'$G(PSGORQF) DSPERR^PSJOCERR("THERAPY")
"RTN","PSJOC",38,0)
 Q:$G(PSGORQF)
"RTN","PSJOC",39,0)
 D:$G(PSJPAUSE) PAUSE^PSJLMUT1
"RTN","PSJOC",40,0)
 Q
"RTN","PSJOC",41,0)
 ;
"RTN","PSJOC",42,0)
GMRAOC ;Display allergy & CPRS OC regardless if FDB is connected
"RTN","PSJOC",43,0)
 D ALLERGY
"RTN","PSJOC",44,0)
 D CPRS^PSJOCOR(.PSPDRG)
"RTN","PSJOC",45,0)
 Q
"RTN","PSJOC",46,0)
ALLERGY ;Do allergy order check
"RTN","PSJOC",47,0)
 ;The allergy check will be processed for each of the dispense drug stores in the PSJALLGY array
"RTN","PSJOC",48,0)
 ;PSJALLGY(X)="" Where X is the disp drug IEN.  PSJALLGY array store all dispense drugs use in an order
"RTN","PSJOC",49,0)
 ;
"RTN","PSJOC",50,0)
 NEW PSJDD
"RTN","PSJOC",51,0)
 F PSJDD=0:0 S PSJDD=$O(PSJALLGY(PSJDD)) Q:'PSJDD  D EN^PSJGMRA(DFN,PSJDD)
"RTN","PSJOC",52,0)
 Q
"RTN","PSJOC",53,0)
DSPORD(ON,PSJNLST) ;Display the order data
"RTN","PSJOC",54,0)
 ;ON - ON_U/V/P ex: 21V
"RTN","PSJOC",55,0)
 ;PSJNLST - It's number list and also use to trigger pg break, line break
"RTN","PSJOC",56,0)
 NEW PSJCOL,PSJX,PSJOC,PSJLINE,X
"RTN","PSJOC",57,0)
 Q:ON=""
"RTN","PSJOC",58,0)
 S PSJLINE=1,PSJCOL=1
"RTN","PSJOC",59,0)
 I ON'["V" D DSPLORDU^PSJLMUT1(DFN,ON)
"RTN","PSJOC",60,0)
 I ON["V" D DSPLORDV^PSJLMUT1(DFN,ON)
"RTN","PSJOC",61,0)
 F PSJX=0:0 S PSJX=$O(PSJOC(ON,PSJX)) Q:'PSJX  D
"RTN","PSJOC",62,0)
 . I $G(PSJNLST)="",(($Y+6)>IOSL) D PAUSE^PSJLMUT1 W @IOF
"RTN","PSJOC",63,0)
 . W !
"RTN","PSJOC",64,0)
 . I $G(PSJNLST) W:(PSJX=1) PSJNLST W:(PSJX>1) ?$L(PSJNLST)
"RTN","PSJOC",65,0)
 . S X=PSJOC(ON,PSJX)
"RTN","PSJOC",66,0)
 . W $E(X,9,$L(X))
"RTN","PSJOC",67,0)
 W !
"RTN","PSJOC",68,0)
 Q
"RTN","PSJOC",69,0)
 ;
"RTN","PSJOC",70,0)
DRUGERR ;Display drug level errors
"RTN","PSJOC",71,0)
 NEW PSJPON,PSJN,PSJNV,PSJDSPFG,PSJPERR,PSJX
"RTN","PSJOC",72,0)
 ;Only display the exceptions once per patient.
"RTN","PSJOC",73,0)
 ;PSJEXCPT(PSJDNM_REASON) - Array for invalid drugs that already display to once within a pt selection
"RTN","PSJOC",74,0)
 S PSJDSPFG=0
"RTN","PSJOC",75,0)
 S PSJPERR=$$PROSPERR()
"RTN","PSJOC",76,0)
 S PSJPON="" F  S PSJPON=$O(^TMP($J,"PSJPRE","OUT","EXCEPTIONS",PSJPON)) Q:PSJPON=""  D
"RTN","PSJOC",77,0)
 . F PSJN=0:0 S PSJN=$O(^TMP($J,"PSJPRE","OUT","EXCEPTIONS",PSJPON,PSJN)) Q:'PSJN  D
"RTN","PSJOC",78,0)
 .. S PSJNV=$G(^TMP($J,"PSJPRE","OUT","EXCEPTIONS",PSJPON,PSJN))
"RTN","PSJOC",79,0)
 .. I ($P(PSJPON,";",3)="PROSPECTIVE") S PSJX='$$ERRCHK("PROSPECTIVE",$P(PSJNV,U,3)_$P(PSJNV,U,10))
"RTN","PSJOC",80,0)
 .. I PSJPERR,($P(PSJPON,";",3)="PROFILE") Q
"RTN","PSJOC",81,0)
 .. I ($P(PSJPON,";",3)="PROFILE"),'$$ERRCHK("PROFILE",$P(PSJNV,U,3)_$P(PSJNV,U,10)) Q
"RTN","PSJOC",82,0)
 .. D DSPDRGER()
"RTN","PSJOC",83,0)
 I PSJDSPFG D PAUSE^PSJLMUT1 W @IOF
"RTN","PSJOC",84,0)
 Q
"RTN","PSJOC",85,0)
DSPDRGER(PSJDSFLG) ;
"RTN","PSJOC",86,0)
 NEW PSJTXT
"RTN","PSJOC",87,0)
 S PSJTXT=$P(PSJNV,U,7)
"RTN","PSJOC",88,0)
 S X="Enhanced Order Checks cannot "
"RTN","PSJOC",89,0)
 I $G(PSJDSFLG),(PSJTXT[X) S PSJTXT="Dosing Checks could not "_$P(PSJTXT,X,2)
"RTN","PSJOC",90,0)
 S PSJDSPFG=1
"RTN","PSJOC",91,0)
 K PSJPAUSE
"RTN","PSJOC",92,0)
 I ($Y+6)>IOSL D PAUSE^PSJLMUT1 W @IOF
"RTN","PSJOC",93,0)
 W !
"RTN","PSJOC",94,0)
 D WRITE^PSJMISC(PSJTXT,,79)
"RTN","PSJOC",95,0)
 D:$P(PSJNV,U,10)]"" WRITE^PSJMISC("Reason: "_$P(PSJNV,U,10),3,79)
"RTN","PSJOC",96,0)
 W !
"RTN","PSJOC",97,0)
 Q
"RTN","PSJOC",98,0)
ERRCHK(PSJTYPE,PSJX) ;
"RTN","PSJOC",99,0)
 ;PSJTYPE - Either "PROFILE" or "PROSPECTIVE"
"RTN","PSJOC",100,0)
 ;PSJX - Drug name_Error reason
"RTN","PSJOC",101,0)
 ;Return 1 if this error drug has not displayed to the user.
"RTN","PSJOC",102,0)
 I $G(PSJX)="" Q 0
"RTN","PSJOC",103,0)
 I $G(PSJTYPE)="" Q 0
"RTN","PSJOC",104,0)
 I PSJTYPE="PROFILE",'$D(PSJEXCPT(PSJTYPE,PSJX)) S PSJEXCPT(PSJTYPE,PSJX)="" Q 1
"RTN","PSJOC",105,0)
 I PSJTYPE="PROSPECTIVE",'$D(PSJEXCPT(PSJTYPE,PSJX)) S PSJEXCPT(PSJTYPE,PSJX)="" Q 1
"RTN","PSJOC",106,0)
 Q 0
"RTN","PSJOC",107,0)
PING(PSJMSG) ;Check if FDB is down.  Return 0 if it is
"RTN","PSJOC",108,0)
 ;pass in a message to customize the display
"RTN","PSJOC",109,0)
 S ^TMP($J,"PSJPRE","IN","PING")=""
"RTN","PSJOC",110,0)
 D IN^PSSHRQ2("PSJPRE")
"RTN","PSJOC",111,0)
 Q $$DSPSERR($G(PSJMSG))
"RTN","PSJOC",112,0)
DSPSERR(PSJMSG) ;Display system errors
"RTN","PSJOC",113,0)
 NEW X
"RTN","PSJOC",114,0)
 S X=$G(^TMP($J,"PSJPRE","OUT",0))
"RTN","PSJOC",115,0)
 I $P(X,U)=-1 D NOFDB($P(X,U,2),$G(PSJMSG))
"RTN","PSJOC",116,0)
 Q $S($P(X,U)=-1:0,1:1)
"RTN","PSJOC",117,0)
NOFDB(PSJX,PSJMSG) ;Display connection down message
"RTN","PSJOC",118,0)
 Q:$G(PSJX)=""
"RTN","PSJOC",119,0)
 I $G(PSJMSG)]"" W !!,"No dosing checks can be performed"
"RTN","PSJOC",120,0)
 I $G(PSJMSG)="" W !!,"No Enhanced Order Checks can be performed."
"RTN","PSJOC",121,0)
 W !,"   Reason: ",PSJX,!!
"RTN","PSJOC",122,0)
 K PSJX
"RTN","PSJOC",123,0)
 Q
"RTN","PSJOC",124,0)
PROSPERR() ;Return 1 if only prospective exception should be displayed.
"RTN","PSJOC",125,0)
 NEW PSJPERR,PSJPON
"RTN","PSJOC",126,0)
 S PSJPERR=1
"RTN","PSJOC",127,0)
 ;If all prospectives are caught in the exception then display them only and omit the profile drugs
"RTN","PSJOC",128,0)
 S PSJPON="" F  S PSJPON=$O(^TMP($J,"PSJPRE","IN","PROSPECTIVE",PSJPON)) Q:PSJPON=""  Q:'PSJPERR  D
"RTN","PSJOC",129,0)
 . I $D(^TMP($J,"PSJPRE","OUT","EXCEPTIONS",PSJPON)) Q
"RTN","PSJOC",130,0)
 . S PSJPERR=0
"RTN","PSJOC",131,0)
 Q PSJPERR
"RTN","PSJOCDC")
0^51^B1499223
"RTN","PSJOCDC",1,0)
PSJOCDC ;BIR/MV - NEW ORDER CHECKS MISC. ;6 Jun 07 / 3:37 PM
"RTN","PSJOCDC",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**181**;16 DEC 97;Build 190
"RTN","PSJOCDC",3,0)
 ;
"RTN","PSJOCDC",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJOCDC",5,0)
 ;
"RTN","PSJOCDC",6,0)
DC(PSGP,PSJORD) ;DC orders during Duplicate Therapy order checks
"RTN","PSJOCDC",7,0)
 ;PSGP - Patient DFN
"RTN","PSJOCDC",8,0)
 ;PSJORD - Order #_u/v/p
"RTN","PSJOCDC",9,0)
 ;Save local arrays and variables to be restored after DC order(s)
"RTN","PSJOCDC",10,0)
 Q:'$D(PSJORD)
"RTN","PSJOCDC",11,0)
 D ^PSJOCVAR
"RTN","PSJOCDC",12,0)
 NEW ON S ON=PSJORD
"RTN","PSJOCDC",13,0)
 I $$DSPORD(PSJORD) D DCORD
"RTN","PSJOCDC",14,0)
 D RESTORE^PSJOCVAR
"RTN","PSJOCDC",15,0)
 Q
"RTN","PSJOCDC",16,0)
DCORD ;DC order according to order type
"RTN","PSJOCDC",17,0)
 ;PSJOCFLG is used in DC^PSJLIACT so the newly DC order during DT will not redisplay.
"RTN","PSJOCDC",18,0)
 NEW PSJOCFLG S PSJOCFLG=1
"RTN","PSJOCDC",19,0)
 I PSJORD["U" D DCUD Q
"RTN","PSJOCDC",20,0)
 ; DC pending, active IV and complex orders
"RTN","PSJOCDC",21,0)
 D DC^PSJLIACT
"RTN","PSJOCDC",22,0)
 Q
"RTN","PSJOCDC",23,0)
DSPORD(PSJORD) ;Display the order about to DC and check if the user wish to DC to order
"RTN","PSJOCDC",24,0)
 ;Returns 1 if continuing with DC the duplicate order.
"RTN","PSJOCDC",25,0)
 ;Returns 0 if not to DC.
"RTN","PSJOCDC",26,0)
 ; 
"RTN","PSJOCDC",27,0)
 NEW %
"RTN","PSJOCDC",28,0)
 D DSPORD^PSJOC(PSJORD)
"RTN","PSJOCDC",29,0)
 ;DC^PSJOE does the DC prompt
"RTN","PSJOCDC",30,0)
 I PSJORD["U" Q 1
"RTN","PSJOCDC",31,0)
 W !!,"Do you want to discontinue this order" S %=2 D YN^DICN
"RTN","PSJOCDC",32,0)
 W !
"RTN","PSJOCDC",33,0)
 I %=1 Q 1
"RTN","PSJOCDC",34,0)
 Q 0
"RTN","PSJOCDC",35,0)
DCUD ;DC a U/D order
"RTN","PSJOCDC",36,0)
 ;Setup necessary variables needed by DC^PSJOE
"RTN","PSJOCDC",37,0)
 NEW PSGOEEWF,PSGSTAT,DIR,PSJDCFLG
"RTN","PSJOCDC",38,0)
 S PSJDCFLG=1
"RTN","PSJOCDC",39,0)
 S PSGSTAT=$P($G(^PS(55,PSGP,5,+PSJORD,0)),U,9)
"RTN","PSJOCDC",40,0)
 S PSGOEEWF="^PS(55,"_PSGP_",5,"_+PSJORD_","
"RTN","PSJOCDC",41,0)
 D SYSL^PSGSETU
"RTN","PSJOCDC",42,0)
 D DC^PSJOE(PSGP,PSJORD)
"RTN","PSJOCDC",43,0)
 K PSJDCFLG
"RTN","PSJOCDC",44,0)
 Q
"RTN","PSJOCDI")
0^45^B82259996
"RTN","PSJOCDI",1,0)
PSJOCDI ;BIR/MV - DISPLAY DRUG INTERACTION ORDER CHECKS ;6 Jun 07 / 3:37 PM
"RTN","PSJOCDI",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**181**;16 DEC 97;Build 190
"RTN","PSJOCDI",3,0)
 ;
"RTN","PSJOCDI",4,0)
DI ;
"RTN","PSJOCDI",5,0)
 NEW PSJDN,PSJDNM,PSJMON,PSJOCLST,PSJPON,PSJSEV,PSJHDR,PSJRDI,PSJ2,PSJONFLG,PSJCRTCL,PSJSORT,PSJGROUP
"RTN","PSJOCDI",6,0)
 ;If interception occurred, display message to user
"RTN","PSJOCDI",7,0)
 ;
"RTN","PSJOCDI",8,0)
 ;Store VUID from Remote data in PSJRDI(PSJON)=VUID.
"RTN","PSJOCDI",9,0)
 D RDIVUID
"RTN","PSJOCDI",10,0)
 S PSJ2=0
"RTN","PSJOCDI",11,0)
 ;Loop through drug drug order checks output
"RTN","PSJOCDI",12,0)
 S PSJSEV="" F  S PSJSEV=$O(^TMP($J,"PSJPRE","OUT","DRUGDRUG",PSJSEV)) Q:PSJSEV=""!($G(PSGORQF))  D
"RTN","PSJOCDI",13,0)
 . S PSJDNM="" F  S PSJDNM=$O(^TMP($J,"PSJPRE","OUT","DRUGDRUG",PSJSEV,PSJDNM)) Q:PSJDNM=""!($G(PSGORQF))  D
"RTN","PSJOCDI",14,0)
 .. S PSJPON="" F  S PSJPON=$O(^TMP($J,"PSJPRE","OUT","DRUGDRUG",PSJSEV,PSJDNM,PSJPON)) Q:PSJPON=""!($G(PSGORQF))  D
"RTN","PSJOCDI",15,0)
 ... F PSJDN=0:0 S PSJDN=$O(^TMP($J,"PSJPRE","OUT","DRUGDRUG",PSJSEV,PSJDNM,PSJPON,PSJDN)) Q:'PSJDN!($G(PSGORQF))  D SORTORD
"RTN","PSJOCDI",16,0)
 I $O(PSJOCLST(""))="" Q
"RTN","PSJOCDI",17,0)
 D CRITICAL
"RTN","PSJOCDI",18,0)
 D DSPLOC
"RTN","PSJOCDI",19,0)
 I $D(^TMP($J,"PSJPRE","OUT","DRUGDRUG","S")) D
"RTN","PSJOCDI",20,0)
 . W !,"*** REFER TO MONOGRAPH FOR SIGNIFICANT INTERACTION CLINICAL EFFECTS",!
"RTN","PSJOCDI",21,0)
 D LINE^PSJMISC("=",81)
"RTN","PSJOCDI",22,0)
 W !
"RTN","PSJOCDI",23,0)
 D MON^PSJMON(.PSJMON)
"RTN","PSJOCDI",24,0)
 D:$G(PSJONFLG) INTERV
"RTN","PSJOCDI",25,0)
 Q
"RTN","PSJOCDI",26,0)
DSPLOC ;Display drug drug interaction - sorted by severity, prospective drug (50,.01), profile drug (VAgen name), package, seq#
"RTN","PSJOCDI",27,0)
 NEW PSJDN,PSJDNV,PSJPON,PSJP,PSJX,X,PSJXSEV,PSJXNM,PSJXNM1,PSJXSORT,PSJXDN,PSJSORT,PSJPSPEC,PSJPROFL,PSJ2,PSJSEV,PSJHDRS,PSJDSPON
"RTN","PSJOCDI",28,0)
 ;
"RTN","PSJOCDI",29,0)
 K PSJPAUSE
"RTN","PSJOCDI",30,0)
 ;Get the last drug in the sort list so a '=' line is printed instead of '.'
"RTN","PSJOCDI",31,0)
 S PSJLINE=".",PSJHDRS=""
"RTN","PSJOCDI",32,0)
 S PSJXSEV=$O(PSJOCLST(""),-1)
"RTN","PSJOCDI",33,0)
 S PSJXNM=$O(PSJOCLST(PSJXSEV,""),-1)
"RTN","PSJOCDI",34,0)
 S PSJXNM1=$O(PSJOCLST(PSJXSEV,PSJXNM,""),-1)
"RTN","PSJOCDI",35,0)
 S PSJXSORT=$O(PSJOCLST(PSJXSEV,PSJXNM,PSJXNM1,""),-1)
"RTN","PSJOCDI",36,0)
 S PSJXDN=$O(PSJOCLST(PSJXSEV,PSJXNM,PSJXNM1,PSJXSORT,""),-1)
"RTN","PSJOCDI",37,0)
 ;
"RTN","PSJOCDI",38,0)
 ;S PSJSEV="" F  S PSJSEV=$O(PSJOCLST(PSJSEV)) Q:PSJSEV=""  D
"RTN","PSJOCDI",39,0)
 ;Displaying Critical orders
"RTN","PSJOCDI",40,0)
 S PSJSEV="C"
"RTN","PSJOCDI",41,0)
 I $D(PSJCRTCL) D LINE^PSJMISC("=",81)
"RTN","PSJOCDI",42,0)
 F PSJSORT=0:0 S PSJSORT=$O(PSJCRTCL(PSJSORT)) Q:'PSJSORT  D
"RTN","PSJOCDI",43,0)
 . F PSJGROUP=0:0 S PSJGROUP=$O(PSJCRTCL(PSJSORT,PSJGROUP)) Q:'PSJGROUP  D
"RTN","PSJOCDI",44,0)
 .. S X=$G(PSJCRTCL(PSJSORT,PSJGROUP))
"RTN","PSJOCDI",45,0)
 .. D DSPCRTCL($P(X,U),$P(X,U,2))
"RTN","PSJOCDI",46,0)
 ;Displaying Significant orders
"RTN","PSJOCDI",47,0)
 K PSJDSPON
"RTN","PSJOCDI",48,0)
 S PSJSEV="S"
"RTN","PSJOCDI",49,0)
 S PSJPSPEC="" F  S PSJPSPEC=$O(PSJOCLST(PSJSEV,PSJPSPEC)) Q:PSJPSPEC=""  D
"RTN","PSJOCDI",50,0)
 . D LINE^PSJMISC("=",81)
"RTN","PSJOCDI",51,0)
 . F PSJSORT=0:0 S PSJSORT=$O(PSJOCLST(PSJSEV,PSJPSPEC,PSJSORT)) Q:'PSJSORT  D
"RTN","PSJOCDI",52,0)
 .. F PSJ2=0:0 S PSJ2=$O(PSJOCLST(PSJSEV,PSJPSPEC,PSJSORT,PSJ2)) Q:'PSJ2  D
"RTN","PSJOCDI",53,0)
 ... S PSJDNV=PSJOCLST(PSJSEV,PSJPSPEC,PSJSORT,PSJ2)
"RTN","PSJOCDI",54,0)
 ... D DISPON
"RTN","PSJOCDI",55,0)
 . W !
"RTN","PSJOCDI",56,0)
 Q
"RTN","PSJOCDI",57,0)
DSPCRTCL(PSJPSPEC,PSJPROFL) ;Display Critical orders
"RTN","PSJOCDI",58,0)
 NEW PSJSORT,PSJ2
"RTN","PSJOCDI",59,0)
 Q:$G(PSJPSPEC)=""
"RTN","PSJOCDI",60,0)
 Q:$G(PSJPROFL)=""
"RTN","PSJOCDI",61,0)
 F PSJSORT=0:0 S PSJSORT=$O(PSJOCLST("C",PSJPSPEC,PSJPROFL,PSJSORT)) Q:'PSJSORT  D
"RTN","PSJOCDI",62,0)
 . F PSJ2=0:0 S PSJ2=$O(PSJOCLST("C",PSJPSPEC,PSJPROFL,PSJSORT,PSJ2)) Q:'PSJ2  D
"RTN","PSJOCDI",63,0)
 .. S PSJDNV=PSJOCLST("C",PSJPSPEC,PSJPROFL,PSJSORT,PSJ2)
"RTN","PSJOCDI",64,0)
 .. D DISPON
"RTN","PSJOCDI",65,0)
 Q
"RTN","PSJOCDI",66,0)
DISPON ; Display orders & clin effects if applied.
"RTN","PSJOCDI",67,0)
 F X=1:1:10 S PSJP(X)=$P(PSJDNV,U,X)
"RTN","PSJOCDI",68,0)
 I ($G(PSJHDR)'=$P(PSJDNV,U,3))!(PSJHDRS'=PSJSEV) S PSJHDR=$P(PSJDNV,U,3),PSJHDRS=PSJSEV K PSJDSPON D HDR(PSJHDR)
"RTN","PSJOCDI",69,0)
 I ($Y+8)>IOSL D PAUSE^PSJMISC(1,0) W @IOF
"RTN","PSJOCDI",70,0)
 I PSJSORT=10 S PSJONFLG=1 D DSPDRG(PSJP(4),$P(PSJDNV,U,2))
"RTN","PSJOCDI",71,0)
 I ($Y+6)>IOSL D PAUSE^PSJMISC(1,0) W @IOF
"RTN","PSJOCDI",72,0)
 I PSJSORT>10 S PSJONFLG=1 D
"RTN","PSJOCDI",73,0)
 . I $D(PSJDSPON(PSJP(4))) Q
"RTN","PSJOCDI",74,0)
 . S PSJDSPON(PSJP(4))=""
"RTN","PSJOCDI",75,0)
 . D EN^PSODRDU2(DFN,PSJP(4),"PSJPRE")
"RTN","PSJOCDI",76,0)
 I ($Y+6)>IOSL D PAUSE^PSJMISC(1,0) W @IOF
"RTN","PSJOCDI",77,0)
 I PSJSEV=PSJXSEV,(PSJPSPEC=PSJXNM),(PSJSORT=PSJXSORT),(PSJ2=PSJXDN) S PSJLINE="="
"RTN","PSJOCDI",78,0)
 I PSJSEV="C",$$DSPLCLIN(PSJ2) D CLIN(PSJP(5),PSJP(2),PSJP(4),PSJP(1),PSJLINE)
"RTN","PSJOCDI",79,0)
 I ($Y+6)>IOSL D PAUSE^PSJMISC() W @IOF
"RTN","PSJOCDI",80,0)
 Q
"RTN","PSJOCDI",81,0)
SORTORD ;Sort drug drug output to display in order of: Inpatient, Active Rx, Remote Rx, Pending Rx, Non_VA
"RTN","PSJOCDI",82,0)
 NEW PDJDNV,PSJX
"RTN","PSJOCDI",83,0)
 S PSJDNV=$G(^TMP($J,"PSJPRE","OUT","DRUGDRUG",PSJSEV,PSJDNM,PSJPON,PSJDN))
"RTN","PSJOCDI",84,0)
 I $E(PSJPON,1,1)'="I" D
"RTN","PSJOCDI",85,0)
 . S PSJX=$E($P(PSJPON,";"),1,1)
"RTN","PSJOCDI",86,0)
 . D OCLST($S(PSJX="O":20,PSJX="R":30,PSJX="P":40,PSJX="N":50,1:""))
"RTN","PSJOCDI",87,0)
 I $E(PSJPON,1,1)="I" D OCLST(10)
"RTN","PSJOCDI",88,0)
 Q
"RTN","PSJOCDI",89,0)
OCLST(PSJ1) ;Sort orders into array to display later
"RTN","PSJOCDI",90,0)
 ;PSJOCLST(PSJSEV("C",PSJPSPEC,PSJPROFL,PSJ1-package,PSJ2)=P1...P6 (P1=SEQ NO, P2=Drug Name(Profile), P3=Drug Name(Prospective)
"RTN","PSJOCDI",91,0)
 ;  (P4=Pharm order# ,P5=Severity, P6=P3 IEN)
"RTN","PSJOCDI",92,0)
 ;PSJOCLST(PSJSEV("S",PSJPSPEC,PSJ1-package,PSJ2)=P1...P6 (P1=SEQ NO, P2=Drug Name(Profile), P3=Drug Name(Prospective)
"RTN","PSJOCDI",93,0)
 ;  (P4=Pharm order# ,P5=Severity, P6=P3 IEN)
"RTN","PSJOCDI",94,0)
 ;PSJSEV: Sort first by severity
"RTN","PSJOCDI",95,0)
 ;PSJ1: 10=PSJ Order
"RTN","PSJOCDI",96,0)
 ;      20=PSO Active Rx
"RTN","PSJOCDI",97,0)
 ;      30=Remote Rx
"RTN","PSJOCDI",98,0)
 ;      40=PSO pending
"RTN","PSJOCDI",99,0)
 ;      50=Non-VA
"RTN","PSJOCDI",100,0)
 ;PSJ2: A counter
"RTN","PSJOCDI",101,0)
 NEW PSJDNV,PSJMONTI,PSJMONV,PSJVAGEN,PSJON1,PSJON2,PSJONFG,PSJPSPEC,PSJPROFL
"RTN","PSJOCDI",102,0)
 Q:'$G(PSJ1)
"RTN","PSJOCDI",103,0)
 S PSJ2=$G(PSJ2)+1
"RTN","PSJOCDI",104,0)
 S PSJDNV=$G(^TMP($J,"PSJPRE","OUT","DRUGDRUG",PSJSEV,PSJDNM,PSJPON,PSJDN))
"RTN","PSJOCDI",105,0)
 S PSJPSPEC=$P(PSJDNV,U,4) S:PSJPSPEC="" PSJPSPEC="UNKNOWN DRUG NAME"
"RTN","PSJOCDI",106,0)
 ; Criticals are grouped by profile VAGEN name and then package type
"RTN","PSJOCDI",107,0)
 I PSJSEV="C" D
"RTN","PSJOCDI",108,0)
 . S PSJVAGEN=$$VAGEN^PSJMISC(+$P(PSJDNV,U,3)) I PSJVAGEN="" S PSJVAGEN=PSJDNM
"RTN","PSJOCDI",109,0)
 . S PSJOCLST(PSJSEV,PSJPSPEC,PSJVAGEN,PSJ1,PSJ2)=PSJDN_U_$G(PSJDNM)_U_$P(PSJDNV,U,4)_U_PSJPON_U_PSJSEV_U_$P(PSJDNV,U,2)
"RTN","PSJOCDI",110,0)
 ; Significants are grouped by package type so Inpatient orders display first
"RTN","PSJOCDI",111,0)
 I PSJSEV="S" D 
"RTN","PSJOCDI",112,0)
 . S PSJOCLST(PSJSEV,PSJPSPEC,PSJ1,PSJ2)=PSJDN_U_$G(PSJDNM)_U_$P(PSJDNV,U,4)_U_PSJPON_U_PSJSEV_U_$P(PSJDNV,U,2)
"RTN","PSJOCDI",113,0)
 S PSJMONTI=$G(^TMP($J,"PSJPRE","OUT","DRUGDRUG",PSJSEV,PSJDNM,PSJPON,PSJDN,"PMON",3,0))
"RTN","PSJOCDI",114,0)
 S PSJMONTI=$P(PSJMONTI,"MONOGRAPH TITLE:  ",2) Q:PSJMONTI=""
"RTN","PSJOCDI",115,0)
 S PSJVAGEN=$$VAGEN^PSJMISC(+$P(PSJDNV,U,3))
"RTN","PSJOCDI",116,0)
 I PSJVAGEN="",'+$P(PSJDNV,U,3) S PSJVAGEN=$$GENVUID^PSJMISC($G(PSJRDI(PSJPON)))
"RTN","PSJOCDI",117,0)
 Q:PSJVAGEN=""
"RTN","PSJOCDI",118,0)
 S PSJVAGEN=PSJVAGEN_"+"_$P(PSJDNV,U,4)
"RTN","PSJOCDI",119,0)
 S PSJMONV=$G(PSJMON(PSJVAGEN,PSJMONTI))
"RTN","PSJOCDI",120,0)
 I PSJMONTI]"" D
"RTN","PSJOCDI",121,0)
 . S $P(PSJMON(PSJVAGEN,PSJMONTI),U,1,7)=PSJDN_U_$G(PSJDNM)_U_+$P(PSJDNV,U,3)_U_$P(PSJDNV,U,4)_U_+$P(PSJDNV,U,2)_U_PSJPON_U_PSJSEV
"RTN","PSJOCDI",122,0)
 . S $P(PSJMON(PSJVAGEN,PSJMONTI),U,11)=PSJVAGEN
"RTN","PSJOCDI",123,0)
 I PSJMONV]"" D
"RTN","PSJOCDI",124,0)
 . I $P(PSJMONV,U,7)'=PSJSEV S $P(PSJMON(PSJVAGEN,PSJMONTI),U,9)=1
"RTN","PSJOCDI",125,0)
 . S PSJONFG=0
"RTN","PSJOCDI",126,0)
 . S PSJON1=$P($P(PSJMONV,U,6),";")
"RTN","PSJOCDI",127,0)
 . S PSJON2=$P(PSJPON,";")
"RTN","PSJOCDI",128,0)
 . I PSJON1="I",PSJON2'="I" S PSJONFG=1
"RTN","PSJOCDI",129,0)
 . I PSJON1'="I",PSJON2="I" S PSJONFG=1
"RTN","PSJOCDI",130,0)
 . I PSJONFG S $P(PSJMON(PSJVAGEN,PSJMONTI),U,10)=1
"RTN","PSJOCDI",131,0)
 K PSJON1,PSJON2,PSJONFG
"RTN","PSJOCDI",132,0)
 Q
"RTN","PSJOCDI",133,0)
CLIN(PSJSEV,PSJDNM,PSJPON,PSJDN,PSJLINE) ;
"RTN","PSJOCDI",134,0)
 ;No longer need to display the clinical effect for Significant
"RTN","PSJOCDI",135,0)
 Q:PSJSEV="S"
"RTN","PSJOCDI",136,0)
 NEW PSJCLINV,PSJX
"RTN","PSJOCDI",137,0)
 I $G(PSJLINE)="" S PSJLINE="."
"RTN","PSJOCDI",138,0)
 S PSJCLINV=$G(^TMP($J,"PSJPRE","OUT","DRUGDRUG",PSJSEV,PSJDNM,PSJPON,PSJDN,"CLIN"))
"RTN","PSJOCDI",139,0)
 W !
"RTN","PSJOCDI",140,0)
 S PSJX=$P(PSJCLINV,"CLINICAL EFFECTS:  ",2) I ($Y+($L(PSJX)\65)+4)>IOSL D PAUSE^PSJMISC(1,0) W @IOF
"RTN","PSJOCDI",141,0)
 D WRITE^PSJMISC(PSJX)
"RTN","PSJOCDI",142,0)
 W !
"RTN","PSJOCDI",143,0)
 I ($Y+8)>IOSL D PAUSE^PSJMISC(0,0) W @IOF
"RTN","PSJOCDI",144,0)
 Q
"RTN","PSJOCDI",145,0)
INTERV ;Log intervention.  Required for Critical.
"RTN","PSJOCDI",146,0)
 ;Critical interaction MUST log an intervention before continue with the order
"RTN","PSJOCDI",147,0)
 ;Only log one intervention for a prospective drug & log it for the higher severity
"RTN","PSJOCDI",148,0)
 NEW PSJSEV,PSJDD,PSJDN,PSJNDV,PSJTYPE,PSJINTVD,PSJPROFL
"RTN","PSJOCDI",149,0)
 K PSJDDSV,PSJINTVD
"RTN","PSJOCDI",150,0)
 ;Required intervention for each of the prospective drug with critical interactions
"RTN","PSJOCDI",151,0)
 F PSJSEV="C" Q:$G(PSGORQF)  S PSJPSPEC="" F  S PSJPSPEC=$O(PSJOCLST(PSJSEV,PSJPSPEC)) Q:PSJPSPEC=""  D
"RTN","PSJOCDI",152,0)
 . S PSJPROFL="" F  S PSJPROFL=$O(PSJOCLST(PSJSEV,PSJPSPEC,PSJPROFL)) Q:PSJPROFL=""  D
"RTN","PSJOCDI",153,0)
 .. F PSJTYPE=0:0 S PSJTYPE=$O(PSJOCLST(PSJSEV,PSJPSPEC,PSJPROFL,PSJTYPE)) Q:'PSJTYPE  D
"RTN","PSJOCDI",154,0)
 ... F PSJDN=0:0 S PSJDN=$O(PSJOCLST(PSJSEV,PSJPSPEC,PSJPROFL,PSJTYPE,PSJDN)) Q:'PSJDN  Q:$G(PSGORQF)  D
"RTN","PSJOCDI",155,0)
 .... S PSJNDV=$G(PSJOCLST(PSJSEV,PSJPSPEC,PSJPROFL,PSJTYPE,PSJDN)),PSJDD=$P(PSJNDV,U,6)
"RTN","PSJOCDI",156,0)
 .... ;I ($P($P(PSJNDV,U,4),";",1)="I"),('$D(PSJINTVD($P(PSJNDV,U,3)))) D
"RTN","PSJOCDI",157,0)
 .... I '$D(PSJINTVD($P(PSJNDV,U,3))) D
"RTN","PSJOCDI",158,0)
 ..... S (PSJINTVD($P(PSJNDV,U,3)))=""
"RTN","PSJOCDI",159,0)
 ..... D RINTERV^PSJGMRA("CRITICAL DRUG INTERACTION",$P(PSJNDV,U,3))
"RTN","PSJOCDI",160,0)
 ;
"RTN","PSJOCDI",161,0)
 ; Optional intervention for each of the prospective drug(not the same as critical) with significant interactions
"RTN","PSJOCDI",162,0)
 F PSJSEV="S" Q:$G(PSGORQF)  S PSJPSPEC="" F  S PSJPSPEC=$O(PSJOCLST(PSJSEV,PSJPSPEC)) Q:PSJPSPEC=""  D
"RTN","PSJOCDI",163,0)
 . F PSJTYPE=0:0 S PSJTYPE=$O(PSJOCLST(PSJSEV,PSJPSPEC,PSJTYPE)) Q:'PSJTYPE  D
"RTN","PSJOCDI",164,0)
 .. F PSJDN=0:0 S PSJDN=$O(PSJOCLST(PSJSEV,PSJPSPEC,PSJTYPE,PSJDN)) Q:'PSJDN  Q:$G(PSGORQF)  D
"RTN","PSJOCDI",165,0)
 ... S PSJNDV=$G(PSJOCLST(PSJSEV,PSJPSPEC,PSJTYPE,PSJDN)),PSJDD=$P(PSJNDV,U,6)
"RTN","PSJOCDI",166,0)
 ... I '$D(PSJINTVD($P(PSJNDV,U,3))) D
"RTN","PSJOCDI",167,0)
 .... S (PSJINTVD($P(PSJNDV,U,3)))=""
"RTN","PSJOCDI",168,0)
 .... D INTERV^PSJGMRA("SIGNIFICANT DRUG INTERACTION",$P(PSJNDV,U,3))
"RTN","PSJOCDI",169,0)
 Q
"RTN","PSJOCDI",170,0)
HDR(PSJDNM) ;Display the intro text on drug interaction
"RTN","PSJOCDI",171,0)
 W !,"This patient is receiving the following order(s) that have a "
"RTN","PSJOCDI",172,0)
 W $S($G(PSJSEV)="C":"CRITICAL",$G(PSJSEV)="S":"SIGNIFICANT",1:"")_" Drug"
"RTN","PSJOCDI",173,0)
 W !,"Interaction with "_$G(PSJDNM)_":",!
"RTN","PSJOCDI",174,0)
 Q
"RTN","PSJOCDI",175,0)
DSPDRG(PSJPON,PSJDNM) ;Display order info or drug name from prospective.
"RTN","PSJOCDI",176,0)
 Q:$G(PSJPON)=""
"RTN","PSJOCDI",177,0)
 I $P(PSJPON,";",3)="PROSPECTIVE" W !?8,$G(PSJDNM),! Q
"RTN","PSJOCDI",178,0)
 I $D(PSJDSPON(PSJPON)) Q
"RTN","PSJOCDI",179,0)
 S PSJDSPON(PSJPON)=""
"RTN","PSJOCDI",180,0)
 I ($Y+8)>IOSL D PAUSE^PSJMISC(1,0) W @IOF
"RTN","PSJOCDI",181,0)
 D DSPORD^PSJOC($P(PSJPON,";",2))
"RTN","PSJOCDI",182,0)
 Q
"RTN","PSJOCDI",183,0)
RDIVUID ;Loop thru the "IN" global to store the VUID for remote Rx
"RTN","PSJOCDI",184,0)
 NEW PSJPON,PSJVUID
"RTN","PSJOCDI",185,0)
 K PSJRDI
"RTN","PSJOCDI",186,0)
 S PSJPON=""
"RTN","PSJOCDI",187,0)
 F  S PSJPON=$O(^TMP($J,"PSJPRE","IN","PROFILE",PSJPON)) Q:PSJPON=""  I $E(PSJPON,1,1)="R" D
"RTN","PSJOCDI",188,0)
 . S PSJVUID=$P($G(^TMP($J,"PSJPRE","IN","PROFILE",PSJPON)),U,2)
"RTN","PSJOCDI",189,0)
 . S:+PSJVUID PSJRDI(PSJPON)=PSJVUID
"RTN","PSJOCDI",190,0)
 Q
"RTN","PSJOCDI",191,0)
DSPLCLIN(PSJ2) ;If the next drug on the list is diff the flag to display the clin effects.
"RTN","PSJOCDI",192,0)
 NEW PSJCLINC,PSJCLINN,PSJDNVC,PSJDNVN,PSJPC,PSJPN,PSJ2N,PSJSORTN
"RTN","PSJOCDI",193,0)
 I $G(PSJ2)="" Q 0
"RTN","PSJOCDI",194,0)
 S PSJDNVC=PSJOCLST(PSJSEV,PSJPSPEC,PSJPROFL,PSJSORT,PSJ2)
"RTN","PSJOCDI",195,0)
 F X=1:1:10 S PSJPC(X)=$P(PSJDNVC,U,X)
"RTN","PSJOCDI",196,0)
 S PSJ2N=$O(PSJOCLST(PSJSEV,PSJPSPEC,PSJPROFL,PSJSORT,PSJ2))
"RTN","PSJOCDI",197,0)
 I 'PSJ2N S PSJSORTN=$O(PSJOCLST(PSJSEV,PSJPSPEC,PSJPROFL,PSJSORT)) Q:'PSJSORTN 1
"RTN","PSJOCDI",198,0)
 S PSJ2N=$O(PSJOCLST(PSJSEV,PSJPSPEC,PSJPROFL,PSJSORT,0)) Q:'PSJ2N 1
"RTN","PSJOCDI",199,0)
 S PSJDNVN=PSJOCLST(PSJSEV,PSJPSPEC,PSJPROFL,PSJSORT,PSJ2N)
"RTN","PSJOCDI",200,0)
 F X=1:1:10 S PSJPN(X)=$P(PSJDNVN,U,X)
"RTN","PSJOCDI",201,0)
 I $S(PSJPC(5)="":1,PSJPC(2)="":1,PSJPC(4)="":1,'+PSJPC(1):1,PSJPN(5)="":1,PSJPN(2)="":1,PSJPN(4)="":1,'+PSJPN(1):1,1:0) Q 0
"RTN","PSJOCDI",202,0)
 S PSJCLINC=$G(^TMP($J,"PSJPRE","OUT","DRUGDRUG",PSJPC(5),PSJPC(2),PSJPC(4),PSJPC(1),"CLIN"))
"RTN","PSJOCDI",203,0)
 S PSJCLINN=$G(^TMP($J,"PSJPRE","OUT","DRUGDRUG",PSJPN(5),PSJPN(2),PSJPN(4),PSJPN(1),"CLIN"))
"RTN","PSJOCDI",204,0)
 I (PSJCLINC'=PSJCLINN) Q 1
"RTN","PSJOCDI",205,0)
 Q 0
"RTN","PSJOCDI",206,0)
CRITICAL ;
"RTN","PSJOCDI",207,0)
 NEW PSJGROUP,PSJNEXT
"RTN","PSJOCDI",208,0)
 S PSJGROUP=0,PSJNEXT=0
"RTN","PSJOCDI",209,0)
 S PSJSEV="C"
"RTN","PSJOCDI",210,0)
 S PSJPSPEC="" F  S PSJPSPEC=$O(PSJOCLST(PSJSEV,PSJPSPEC)) Q:PSJPSPEC=""  D
"RTN","PSJOCDI",211,0)
 . S PSJPROFL="" F  S PSJPROFL=$O(PSJOCLST(PSJSEV,PSJPSPEC,PSJPROFL)) Q:PSJPROFL=""  D
"RTN","PSJOCDI",212,0)
 .. S PSJNEXT=0
"RTN","PSJOCDI",213,0)
 .. S PSJGROUP=PSJGROUP+1
"RTN","PSJOCDI",214,0)
 .. F PSJSORT=0:0 S PSJSORT=$O(PSJOCLST(PSJSEV,PSJPSPEC,PSJPROFL,PSJSORT)) Q:'PSJSORT  D
"RTN","PSJOCDI",215,0)
 ... Q:PSJNEXT
"RTN","PSJOCDI",216,0)
 ... F PSJ2=0:0 S PSJ2=$O(PSJOCLST(PSJSEV,PSJPSPEC,PSJPROFL,PSJSORT,PSJ2)) Q:'PSJ2  D
"RTN","PSJOCDI",217,0)
 .... Q:PSJNEXT
"RTN","PSJOCDI",218,0)
 .... S PSJCRTCL(PSJSORT,PSJGROUP)=PSJPSPEC_U_PSJPROFL
"RTN","PSJOCDI",219,0)
 .... S PSJNEXT=1
"RTN","PSJOCDI",220,0)
 Q
"RTN","PSJOCDS")
0^47^B61757941
"RTN","PSJOCDS",1,0)
PSJOCDS ;BIR/MV - SET INPUT DATA FOR DOSING ORDER CHECKS ;6 Jun 07 / 3:37 PM
"RTN","PSJOCDS",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**181**;16 DEC 97;Build 190
"RTN","PSJOCDS",3,0)
 ;
"RTN","PSJOCDS",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJOCDS",5,0)
 ; Reference to ^PSSORPH is supported by DBIA #3234.
"RTN","PSJOCDS",6,0)
 ; Reference to ^PSSDSAPI is supported by DBIA #5425.
"RTN","PSJOCDS",7,0)
 ; Reference to ^PSSDSAPD is supported by DBIA #5426.
"RTN","PSJOCDS",8,0)
 ; Reference to FULL^VALM1 and PAUSE^VALM1 is supported by DBIA #10116.
"RTN","PSJOCDS",9,0)
 ;
"RTN","PSJOCDS",10,0)
 ;The Dose API will be processed separately than the DD & DT order checks
"RTN","PSJOCDS",11,0)
 ;
"RTN","PSJOCDS",12,0)
IN(PSJPON,PSJTYPE,PSJDD) ;
"RTN","PSJOCDS",13,0)
 ;PSJPON - Order number
"RTN","PSJOCDS",14,0)
 ;PSJPTYPE - UD/IV
"RTN","PSJOCDS",15,0)
 ;PSJDD - Dispense drug IEN (for UD order only)
"RTN","PSJOCDS",16,0)
 ;
"RTN","PSJOCDS",17,0)
 ;PSJOVR array is defined when OVERLAP^PSGOEF2 is called.
"RTN","PSJOCDS",18,0)
 ;
"RTN","PSJOCDS",19,0)
 Q:'$$DS^PSSDSAPI()
"RTN","PSJOCDS",20,0)
 NEW PSJOCDS,PSJFDB,PSJBASE,PSJOVR,PSJOVRLP
"RTN","PSJOCDS",21,0)
 K PSJOCDS,PSJFDB
"RTN","PSJOCDS",22,0)
 D FULL^VALM1
"RTN","PSJOCDS",23,0)
 I '$$PING^PSJOC("No dosing checks can be performed") Q
"RTN","PSJOCDS",24,0)
 K ^TMP($J,"PSJPRE"),^TMP($J,"PSJPRE1")
"RTN","PSJOCDS",25,0)
 S PSJBASE(1)="PSJPRE",PSJBASE(3)="PSJPRE1"
"RTN","PSJOCDS",26,0)
 ;
"RTN","PSJOCDS",27,0)
 ;;**** Commmented out complex dosing
"RTN","PSJOCDS",28,0)
 ;;PSJOCDSC("CX","PSJCOM") is to flag if dosing checks needs to handle comlex orders.
"RTN","PSJOCDS",29,0)
 ;;*I '$D(PSJOCDSC("CX","PSJCOM")) D
"RTN","PSJOCDS",30,0)
 ;;*. I $G(PSJCOM),$$CONJ^PSJOCDSC() S PSJOCDSC("CX","PSJCOM")=1
"RTN","PSJOCDS",31,0)
 ;;*I $G(PSJOCDSC("CX","PSJCOM")),'$D(PSJOCDSC("CX","ACX")) D SETLST^PSJOCDSC(PSJPON)
"RTN","PSJOCDS",32,0)
 ;;*I PSJTYPE="UD" D UD I $G(PSJOCDSC("CX","PSJCOM")) D COMPLEX^PSJOCDSC Q
"RTN","PSJOCDS",33,0)
 ;;*I PSJTYPE="IV" D IN^PSIVOCDS("PSJPRE") D:$G(PSJOCDSC("CX","PSJCOM")) IV^PSJOCDSC(PSJPON),UPDLST^PSJOCDSC(PSJPON,2)
"RTN","PSJOCDS",34,0)
 ;;**** End Complex dosing
"RTN","PSJOCDS",35,0)
 ;
"RTN","PSJOCDS",36,0)
 ;;****To be removed when complex dosing is ready
"RTN","PSJOCDS",37,0)
 I PSJTYPE="UD" D UD
"RTN","PSJOCDS",38,0)
 I PSJTYPE="IV" D IN^PSIVOCDS("PSJPRE")
"RTN","PSJOCDS",39,0)
 ;;****END
"RTN","PSJOCDS",40,0)
 ;
"RTN","PSJOCDS",41,0)
 I '$D(PSJFDB) Q
"RTN","PSJOCDS",42,0)
 D DOSE^PSSDSAPD(.PSJBASE,DFN,.PSJOCDS,.PSJFDB)
"RTN","PSJOCDS",43,0)
 D DISPLAY^PSJOCDSD
"RTN","PSJOCDS",44,0)
 ;;*I '$G(PSGORQF),(PSJTYPE="IV"),$G(PSJOCDSC("CX","PSJCOM")) D NODAILY^PSJOCDSP(PSJPON)
"RTN","PSJOCDS",45,0)
 K ^TMP($J,"PSJPRE"),^TMP($J,"PSJPRE1")
"RTN","PSJOCDS",46,0)
 Q
"RTN","PSJOCDS",47,0)
UD ;Process data from a UD order
"RTN","PSJOCDS",48,0)
 NEW PSJDS,PSJFREQ,X
"RTN","PSJOCDS",49,0)
 ;At this state a dispense drug should be selected already.  But just incase...
"RTN","PSJOCDS",50,0)
 Q:'+PSJDD
"RTN","PSJOCDS",51,0)
 K PSJOCDS,PSJFDB
"RTN","PSJOCDS",52,0)
 ;If the drug is to be exempted then exclude it from the dose check
"RTN","PSJOCDS",53,0)
 Q:$$EXMT^PSSDSAPI(PSJDD)
"RTN","PSJOCDS",54,0)
 S PSJCNT=1
"RTN","PSJOCDS",55,0)
 S PSJDS=""
"RTN","PSJOCDS",56,0)
 ;
"RTN","PSJOCDS",57,0)
 S X=$$DOSE()
"RTN","PSJOCDS",58,0)
 S PSJOCDS(PSJCNT,"DRG_AMT")=$P(X,U)
"RTN","PSJOCDS",59,0)
 S PSJOCDS(PSJCNT,"DRG_UNIT")=$P(X,U,2)
"RTN","PSJOCDS",60,0)
 S PSJOCDS(PSJCNT,"DO")=$P(X,U,3)
"RTN","PSJOCDS",61,0)
 ;
"RTN","PSJOCDS",62,0)
 S X=$$DATES(PSJPON)
"RTN","PSJOCDS",63,0)
 S X=$$DURATION($P(X,U),$P(X,U,2))
"RTN","PSJOCDS",64,0)
 ;S X=$$DURATION($G(PSGSD),$G(PSGFD))
"RTN","PSJOCDS",65,0)
 S PSJOCDS(PSJCNT,"DRATE")=$S(+X:X_"M",1:"")
"RTN","PSJOCDS",66,0)
 ;S PSJOCDS(PSJCNT,"DUR")=X
"RTN","PSJOCDS",67,0)
 ;S PSJOCDS(PSJCNT,"DUR_RT")=$S(+X:"MINUTE",1:"")
"RTN","PSJOCDS",68,0)
 S PSJOCDS(PSJCNT,"MR_IEN")=$G(PSGMR)
"RTN","PSJOCDS",69,0)
 S PSJOCDS(PSJCNT,"SCHEDULE")=$G(PSGSCH)
"RTN","PSJOCDS",70,0)
 D FDBDATA
"RTN","PSJOCDS",71,0)
 D LITTER
"RTN","PSJOCDS",72,0)
 Q
"RTN","PSJOCDS",73,0)
FDBDATA ;Set data needed by FDB's Dose API
"RTN","PSJOCDS",74,0)
 ;Use the OI + Dosage form when display drug name.  If OI IEN doesn't exist, use DD name
"RTN","PSJOCDS",75,0)
 NEW PSJOINM,PSJXSCH,X
"RTN","PSJOCDS",76,0)
 S PSJFDB(PSJCNT,"RX_NUM")="I;"_PSJPON_";PROSPECTIVE;"_PSJCNT
"RTN","PSJOCDS",77,0)
 S PSJFDB(PSJCNT,"DRUG_IEN")=PSJDD
"RTN","PSJOCDS",78,0)
 S PSJOINM=$$DRGNM^PSGSICHK()
"RTN","PSJOCDS",79,0)
 S PSJFDB(PSJCNT,"DRUG_NM")=$S(PSJOINM]"":PSJOINM,1:$$DN^PSJMISC(+PSJDD))
"RTN","PSJOCDS",80,0)
 I PSJOCDS(PSJCNT,"DO")=(PSJOCDS(PSJCNT,"DRG_AMT")_PSJOCDS(PSJCNT,"DRG_UNIT")) D
"RTN","PSJOCDS",81,0)
 . Q:PSJOCDS(PSJCNT,"DO")=""
"RTN","PSJOCDS",82,0)
 .;Strip off leading zero otherwise FDB triggers an "Invalid or Undefined Dose"
"RTN","PSJOCDS",83,0)
 . S X=PSJOCDS(PSJCNT,"DRG_AMT")
"RTN","PSJOCDS",84,0)
 . S PSJFDB(PSJCNT,"DOSE_AMT")=$S(+X=0:X,1:+X)
"RTN","PSJOCDS",85,0)
 . S PSJFDB(PSJCNT,"DOSE_UNIT")=$$UNIT^PSSDSAPI(PSJOCDS(PSJCNT,"DRG_UNIT"))
"RTN","PSJOCDS",86,0)
 S PSJFDB(PSJCNT,"DOSE_RATE")="DAY"
"RTN","PSJOCDS",87,0)
 ;
"RTN","PSJOCDS",88,0)
 S X="",PSJXSCH=PSGSCH
"RTN","PSJOCDS",89,0)
 I $G(PSGS0XT)="" S PSGS0XT=$$DOW^PSJAPIDS(PSGSCH)
"RTN","PSJOCDS",90,0)
 I $G(PSGS0XT)="D",$G(PSGS0Y)]"" S $P(PSJXSCH,"@",2)=$G(PSGS0Y)
"RTN","PSJOCDS",91,0)
 I $G(PSGSCH)]"" S X=$P($$FRQ^PSSDSAPI(PSJXSCH,$G(PSGS0XT),"I"),U)
"RTN","PSJOCDS",92,0)
 I X="" S X=1 S PSJFDB(PSJCNT,"FRQ_ERROR")=""
"RTN","PSJOCDS",93,0)
 S PSJFDB(PSJCNT,"FREQ")=X
"RTN","PSJOCDS",94,0)
 S PSJFDB(PSJCNT,"DURATION")=1
"RTN","PSJOCDS",95,0)
 S PSJFDB(PSJCNT,"DURATION_RT")="DAY"
"RTN","PSJOCDS",96,0)
 S PSJFDB(PSJCNT,"ROUTE")=$P($$MRT^PSSDSAPI($G(PSGMR)),U,2)
"RTN","PSJOCDS",97,0)
 S PSJFDB(PSJCNT,"DOSE_TYPE")="MAINTENANCE"
"RTN","PSJOCDS",98,0)
 S PSJFDB(PSJCNT,"SPECIFIC")=1
"RTN","PSJOCDS",99,0)
 ;Set data for onetime or <24 hours order
"RTN","PSJOCDS",100,0)
 S X=$$ONE^PSJORPOE($G(PSGSCH))
"RTN","PSJOCDS",101,0)
 I +X!($G(PSGST)="O")!+$$ONCALL^PSJMISC($G(PSGSCH),$G(PSGST)) D  Q
"RTN","PSJOCDS",102,0)
 . K PSJFDB(PSJCNT,"FRQ_ERROR")
"RTN","PSJOCDS",103,0)
 . S PSJFDB(PSJCNT,"DOSE_TYPE")="SINGLE DOSE"
"RTN","PSJOCDS",104,0)
 . S PSJFDB(PSJCNT,"DURATION")=1
"RTN","PSJOCDS",105,0)
 . S PSJFDB(PSJCNT,"DURATION_RT")=PSJFDB(PSJCNT,"DURATION_RT")
"RTN","PSJOCDS",106,0)
 . S PSJFDB(PSJCNT,"FREQ")=1
"RTN","PSJOCDS",107,0)
 I +PSJOCDS(PSJCNT,"DRATE") D UND24HRS(+PSJOCDS(PSJCNT,"DRATE"),$G(PSGAT),$G(PSGS0XT),PSGSD,PSGFD,PSGSCH)
"RTN","PSJOCDS",108,0)
 Q
"RTN","PSJOCDS",109,0)
LITTER ;FDB requires "L" instead of ML for the particular conditions below
"RTN","PSJOCDS",110,0)
 NEW PSJXDO
"RTN","PSJOCDS",111,0)
 Q:'$G(PSJDD)
"RTN","PSJOCDS",112,0)
 Q:$G(PSJFDB(1,"ROUTE"))'="INTRAVENOUS"
"RTN","PSJOCDS",113,0)
 Q:$G(PSGST)'="R"
"RTN","PSJOCDS",114,0)
 Q:$$VAGEN^PSJMISC(PSJDD)'["POTASSIUM"
"RTN","PSJOCDS",115,0)
 Q:$$CLASS^PSJMISC(PSJDD)'="TN102"
"RTN","PSJOCDS",116,0)
 S PSJXDO=PSJOCDS(PSJCNT,"DO")
"RTN","PSJOCDS",117,0)
 I PSJXDO["ML" D
"RTN","PSJOCDS",118,0)
 . Q:'+PSJXDO
"RTN","PSJOCDS",119,0)
 . S (PSJOCDS(PSJCNT,"DRG_AMT"),PSJFDB(PSJCNT,"DOSE_AMT"))=+(+PSJXDO/1000)
"RTN","PSJOCDS",120,0)
 . S (PSJOCDS(1,"DRG_UNIT"),PSJFDB(PSJCNT,"DOSE_UNIT"))="L"
"RTN","PSJOCDS",121,0)
 Q
"RTN","PSJOCDS",122,0)
UND24HRS(PSJDUR,PSGAT,PSGS0XT,PSGSD,PSGFD,PSGSCH) ;
"RTN","PSJOCDS",123,0)
 ;*** This line tag is called by ^PSIVOCDS also ***
"RTN","PSJOCDS",124,0)
 ;PSJDUR - order duration in minutes
"RTN","PSJOCDS",125,0)
 ;PSGAT - admin times
"RTN","PSJOCDS",126,0)
 ;PSGS0XT - Order Frequency
"RTN","PSJOCDS",127,0)
 NEW PSJNDOSE,PSJFRQ1,PSJFRQ2,PSJFRQX
"RTN","PSJOCDS",128,0)
 Q:'+$G(PSJDUR)
"RTN","PSJOCDS",129,0)
 ; Set frequency to # of amdin times
"RTN","PSJOCDS",130,0)
 I ($G(PSGAT)]"") D  Q
"RTN","PSJOCDS",131,0)
 . S PSJNDOSE=$$CNTDOSE(PSGSD,PSGFD)
"RTN","PSJOCDS",132,0)
 . I PSJNDOSE S PSJFDB(PSJCNT,"FREQ")=PSJNDOSE Q
"RTN","PSJOCDS",133,0)
 ; Set frequency based on frequency(51.1)
"RTN","PSJOCDS",134,0)
 S PSJFRQ2=+$P($$FRQ^PSSDSAPI($G(PSGSCH),$G(PSGS0XT),"I"),U)
"RTN","PSJOCDS",135,0)
 I +$G(PSGS0XT)!PSJFRQ2 D  Q
"RTN","PSJOCDS",136,0)
 . S PSJFRQX=$S(+$G(PSGS0XT):+PSGS0XT,1:(PSJFRQ2*60))
"RTN","PSJOCDS",137,0)
 . S PSJFRQ1=(+PSJDUR)/PSJFRQX
"RTN","PSJOCDS",138,0)
 . S PSJFDB(PSJCNT,"FREQ")=$J(PSJFRQ1,"",0)
"RTN","PSJOCDS",139,0)
 ; If no admin times or frequency(51.1) set error
"RTN","PSJOCDS",140,0)
 S PSJFDB(PSJCNT,"FREQ")=1
"RTN","PSJOCDS",141,0)
 S PSJFDB(PSJCNT,"FRQ_ERROR")=""
"RTN","PSJOCDS",142,0)
 Q
"RTN","PSJOCDS",143,0)
CNTDOSE(PSGSD,PSGFD) ;Count # of admins to set the Freq to
"RTN","PSJOCDS",144,0)
 ;only do this if the start & stop dates are within 24 hours.
"RTN","PSJOCDS",145,0)
 NEW PSJX,PSJADMIN,PSJCNT,PSJSTRTM,PSJSTPTM,PSJDTFLG
"RTN","PSJOCDS",146,0)
 I $G(PSGAT)="" Q 0
"RTN","PSJOCDS",147,0)
 I $G(PSGSD)="" Q 0
"RTN","PSJOCDS",148,0)
 I $G(PSGFD)="" Q 0
"RTN","PSJOCDS",149,0)
 I ($$FMDIFF^XLFDT(PSGFD,PSGSD,2)/60)>1440 Q 0
"RTN","PSJOCDS",150,0)
 S PSJCNT=0
"RTN","PSJOCDS",151,0)
 S PSJSTRTM=$E($P(PSGSD,".",2)_"0000",1,4)
"RTN","PSJOCDS",152,0)
 S PSJSTPTM=$E($P(PSGFD,".",2)_"0000",1,4)
"RTN","PSJOCDS",153,0)
 S PSJDTFLG=0
"RTN","PSJOCDS",154,0)
 I $P(PSGSD,".")=$P(PSGFD,".") S PSJDTFLG=1
"RTN","PSJOCDS",155,0)
 F PSJX=1:1 S PSJADMIN=$P(PSGAT,"-",PSJX) Q:PSJADMIN=""  D
"RTN","PSJOCDS",156,0)
 . S PSJADMIN=$E($P(PSGAT,"-",PSJX)_"0000",1,4)
"RTN","PSJOCDS",157,0)
 . I PSJDTFLG D  Q
"RTN","PSJOCDS",158,0)
 .. I (PSJSTRTM'>PSJADMIN),(PSJADMIN<PSJSTPTM) S PSJCNT=PSJCNT+1
"RTN","PSJOCDS",159,0)
 . I (PSJSTRTM'>PSJADMIN) S PSJCNT=PSJCNT+1
"RTN","PSJOCDS",160,0)
 . I (PSJSTPTM>PSJADMIN) S PSJCNT=PSJCNT+1
"RTN","PSJOCDS",161,0)
 Q PSJCNT
"RTN","PSJOCDS",162,0)
DURATION(PSGSD,PSGFD) ;Figure out the duration from the start, stop dates
"RTN","PSJOCDS",163,0)
 ;Return the diff between Stop - Start date in minutes.  If > 1 day then return null
"RTN","PSJOCDS",164,0)
 NEW PSJDIFF
"RTN","PSJOCDS",165,0)
 I '$D(PSGFD)!'$D(PSGSD) Q ""
"RTN","PSJOCDS",166,0)
 S PSJDIFF=$$FMDIFF^XLFDT(PSGFD,PSGSD,2)/60
"RTN","PSJOCDS",167,0)
 I (PSJDIFF<1440) Q PSJDIFF
"RTN","PSJOCDS",168,0)
 Q ""
"RTN","PSJOCDS",169,0)
DOSE() ;Figure out the dose, unit, & dosage Ordered
"RTN","PSJOCDS",170,0)
 ;Return 3 pieces: Numeric Dose ^ Unit ^ Dosage Ordered
"RTN","PSJOCDS",171,0)
 NEW PSJDS,PSJND0,PSJND2,X,PSJX,PSJXDOX,PSJNDS,PSJALLGY
"RTN","PSJOCDS",172,0)
 S PSJDS=""
"RTN","PSJOCDS",173,0)
 ;Subsequence orders in the Complex order has the PSGDO from the first order. Get new PSGDO
"RTN","PSJOCDS",174,0)
 I $G(PSJCOM),$G(PSJPON)["U" S PSGDO=$P($G(^PS(55,DFN,5,+PSJPON,.2)),U,2)
"RTN","PSJOCDS",175,0)
 ;If the dose & unit exist use them
"RTN","PSJOCDS",176,0)
 I $G(PSJDOSE("DO")) Q PSJDOSE("DO")_U_$G(PSGDO)
"RTN","PSJOCDS",177,0)
 ;Get dd, dose, unit from the order
"RTN","PSJOCDS",178,0)
 I $G(PSGORD)]"",'+$G(PSJDD) D
"RTN","PSJOCDS",179,0)
 . I PSGORD["P" S PSJND2=$G(^PS(53.1,+PSGORD,.2)),PSJDD=$O(^PS(53.1,+PSGORD,1,"B",0))
"RTN","PSJOCDS",180,0)
 . I PSGORD["U" S PSJND2=$G(^PS(55,DFN,5,+PSGORD,.2)),PSJDD=$O(^PS(53.1,+DFN,5,+PSGORD,1,"B",0))
"RTN","PSJOCDS",181,0)
 ;If no numeric dose and there is a dosage ordered then get dose & unit from the order
"RTN","PSJOCDS",182,0)
 I $D(PSGORD),$G(PSGDO)]"" D
"RTN","PSJOCDS",183,0)
 . S PSJDS=$P($G(PSJND2),U,5,6)
"RTN","PSJOCDS",184,0)
 Q:+PSJDS PSJDS_U_$G(PSGDO)
"RTN","PSJOCDS",185,0)
 ;Get dispense unit per dose and figure out numeric and unit
"RTN","PSJOCDS",186,0)
 I +$G(PSJDD),($G(PSGDO)]"") D
"RTN","PSJOCDS",187,0)
 . S PSJDS=$$DOSE1()
"RTN","PSJOCDS",188,0)
 . I $P($G(PSJXDOX(1)),U,11)=$$UP^XLFSTR(PSGDO) Q:+PSJDS
"RTN","PSJOCDS",189,0)
 . S PSJDS=""
"RTN","PSJOCDS",190,0)
 . S PSJX=$G(PSJXDOX(1))
"RTN","PSJOCDS",191,0)
 . I +PSJX S X=+PSGDO/+PSJX S PSJDS=$$DOSE1(X)
"RTN","PSJOCDS",192,0)
 . I $P($G(PSJXDOX(1)),U,11)=$$UP^XLFSTR(PSGDO) Q:+PSJDS
"RTN","PSJOCDS",193,0)
 . S PSJDS=""
"RTN","PSJOCDS",194,0)
 Q:+PSJDS PSJDS
"RTN","PSJOCDS",195,0)
 I +$G(PSJDD),($G(PSGDO)=""),($G(PSGORD)="") D
"RTN","PSJOCDS",196,0)
 . S PSJDS=$$DOSE1($S(+$G(PSGUD):PSGUD,1:1))
"RTN","PSJOCDS",197,0)
 Q:+PSJDS PSJDS
"RTN","PSJOCDS",198,0)
 ;Figure out dose & unit from the dispense drug.  Dosage Ordered is required for multiple dispense drugs
"RTN","PSJOCDS",199,0)
 I $G(PSGDO)="" D
"RTN","PSJOCDS",200,0)
 . S PSJND0=$$DD53P45^PSJMISC()
"RTN","PSJOCDS",201,0)
 . I PSJND0="" S PSJND0=$G(PSGDRG)
"RTN","PSJOCDS",202,0)
 . S X=+$P(PSJND0,U,2) S PSJDS=$$DOSE1($S(X:X,1:1))
"RTN","PSJOCDS",203,0)
 Q:+PSJDS PSJDS
"RTN","PSJOCDS",204,0)
 Q "^^"_$G(PSGDO)
"RTN","PSJOCDS",205,0)
DOSE1(PSJDUP) ;
"RTN","PSJOCDS",206,0)
 ;PSJDUP - Dispense unit per dose
"RTN","PSJOCDS",207,0)
 NEW PSJDS
"RTN","PSJOCDS",208,0)
 Q:'+$G(PSJDD)
"RTN","PSJOCDS",209,0)
 K PSJXDOX
"RTN","PSJOCDS",210,0)
 S PSJDS=""
"RTN","PSJOCDS",211,0)
 D DOSE^PSSORPH(.PSJXDOX,+PSJDD,"U",,$G(PSJDUP))
"RTN","PSJOCDS",212,0)
 S:$G(PSJXDOX(1)) PSJDS=$P(PSJXDOX(1),U,1,2)_U_$P(PSJXDOX(1),U)_$P(PSJXDOX(1),U,2)
"RTN","PSJOCDS",213,0)
 Q PSJDS
"RTN","PSJOCDS",214,0)
DATES(PSJPON) ;Check the correct Start, Stop dates to use
"RTN","PSJOCDS",215,0)
 ;PSJOCDSC("CX",PSGsd/PSGfd,on)=default PSGsd/PSGfd date _^_ PSGsd/PSGfd _^_PSJFLG
"RTN","PSJOCDS",216,0)
 ; PSJFLG=1 if start or stop date has changed.
"RTN","PSJOCDS",217,0)
 ;For some reaons, PSGSD redefined to cal start date for Complex order (one with duration),
"RTN","PSJOCDS",218,0)
 ; PSGFD redefined to cal stop date.  These 2 fields reflect the default start, stop dates if they
"RTN","PSJOCDS",219,0)
 ; were edited.
"RTN","PSJOCDS",220,0)
 ;
"RTN","PSJOCDS",221,0)
 NEW PSJXSD,PSJXFD,PSJP1,PSJP2,PSJFLG
"RTN","PSJOCDS",222,0)
 I '+$G(PSJPON) Q $G(PSGSD)_U_$G(PSGFD)_U_0
"RTN","PSJOCDS",223,0)
 S PSJFLG=0
"RTN","PSJOCDS",224,0)
 S PSJP1=$G(PSGSD),PSJP2=$G(PSGFD)
"RTN","PSJOCDS",225,0)
 I $D(PSJOCDSC("CX","PSGSD")) D
"RTN","PSJOCDS",226,0)
 . S PSJXSD=$G(PSJOCDSC("CX","PSGSD",+PSJPON))
"RTN","PSJOCDS",227,0)
 . S PSJXFD=$G(PSJOCDSC("CX","PSGFD",+PSJPON))
"RTN","PSJOCDS",228,0)
 . I PSGSD=$P(PSJXSD,U,2) S PSJP1=$P(PSJXSD,U)
"RTN","PSJOCDS",229,0)
 .;
"RTN","PSJOCDS",230,0)
 . I $P(PSJXFD,U,2)]"",(PSGFD=$P(PSJXFD,U,2)) S PSJP2=$P(PSJXFD,U)
"RTN","PSJOCDS",231,0)
 . I $P(PSJXFD,U,2)="" S $P(PSJXFD,U,2)=PSGFD,PSJP2=PSGFD
"RTN","PSJOCDS",232,0)
 .;
"RTN","PSJOCDS",233,0)
 .; I $P(PSJXFD,U,2)="" S $P(PSJXFD,U,2)=PSGFD
"RTN","PSJOCDS",234,0)
 .; I PSGFD=$P(PSJXFD,U,2) S PSJP2=$P(PSJXFD,U)
"RTN","PSJOCDS",235,0)
 . I (PSJXSD]"")!(PSJXFD]"") D
"RTN","PSJOCDS",236,0)
 .. I $S($G(PSGSD)'=$P(PSJXSD,U,2):1,$G(PSGFD)'=$P(PSJXFD,U,2):1,1:0) S PSJFLG=1
"RTN","PSJOCDS",237,0)
 Q PSJP1_U_PSJP2_U_PSJFLG
"RTN","PSJOCDSD")
0^68^B19852742
"RTN","PSJOCDSD",1,0)
PSJOCDSD ;BIR/MV - PROCESS DOSING ORDER CHECKS ;6 Jun 07 / 3:37 PM
"RTN","PSJOCDSD",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**181**;16 DEC 97;Build 190
"RTN","PSJOCDSD",3,0)
 ;
"RTN","PSJOCDSD",4,0)
DISPLAY ;Display dose checks
"RTN","PSJOCDSD",5,0)
 NEW PSJPON,PSJDSPFG,PSJCNT0
"RTN","PSJOCDSD",6,0)
 D FULL^VALM1
"RTN","PSJOCDSD",7,0)
 Q:'$$DSPSERR^PSJOC("No dosing checks can be performed")
"RTN","PSJOCDSD",8,0)
 D EXCEPTN2
"RTN","PSJOCDSD",9,0)
 K PSJDSPFG
"RTN","PSJOCDSD",10,0)
 F PSJCNT0=0:0 S PSJCNT0=$O(^TMP($J,"PSJPRE1","OUT",PSJCNT0)) Q:'PSJCNT0  Q:$G(PSGORQF)  D
"RTN","PSJOCDSD",11,0)
 . S PSJPON="" F  S PSJPON=$O(^TMP($J,"PSJPRE1","OUT",PSJCNT0,PSJPON)) Q:PSJPON=""  Q:$G(PSGORQF)  D
"RTN","PSJOCDSD",12,0)
 .. Q:PSJPON=0
"RTN","PSJOCDSD",13,0)
 .. D ERROR
"RTN","PSJOCDSD",14,0)
 .. D EXCEPTN
"RTN","PSJOCDSD",15,0)
 .. D WARNING
"RTN","PSJOCDSD",16,0)
 .. I +$G(PSJDSPFG) D PAUSE^PSJLMUT1 W @IOF
"RTN","PSJOCDSD",17,0)
 K PSJDSPFG
"RTN","PSJOCDSD",18,0)
 Q
"RTN","PSJOCDSD",19,0)
WARNING ;Display warning messages
"RTN","PSJOCDSD",20,0)
 NEW PSJSGLE,PSJRNGE,PSJMSG,PSJDD,PSJTYPE
"RTN","PSJOCDSD",21,0)
 S PSJMSG=""
"RTN","PSJOCDSD",22,0)
 S (PSJSGLE,PSJRNGE)=0
"RTN","PSJOCDSD",23,0)
 I '$O(^TMP($J,"PSJPRE1","OUT",PSJCNT0,PSJPON,"EXCEPTIONS",0)),'$O(^TMP($J,"PSJPRE1","OUT",PSJCNT0,PSJPON,"ERROR",0)) W !
"RTN","PSJOCDSD",24,0)
 S PSJTYPE="" F  S PSJTYPE=$O(^TMP($J,"PSJPRE1","OUT",PSJCNT0,PSJPON,"MESSAGE",PSJTYPE)) Q:PSJTYPE=""  D
"RTN","PSJOCDSD",25,0)
 . W !
"RTN","PSJOCDSD",26,0)
 . F PSJDD=0:0 S PSJDD=$O(^TMP($J,"PSJPRE1","OUT",PSJCNT0,PSJPON,"MESSAGE",PSJTYPE,PSJDD)) Q:'PSJDD  D
"RTN","PSJOCDSD",27,0)
 .. Q:$G(PSGORQF)
"RTN","PSJOCDSD",28,0)
 .. S PSJMSG=$G(^TMP($J,"PSJPRE1","OUT",PSJCNT0,PSJPON,"MESSAGE",PSJTYPE,PSJDD))
"RTN","PSJOCDSD",29,0)
 .. I ($Y+6)>IOSL D PAUSE^PSJLMUT1 W @IOF
"RTN","PSJOCDSD",30,0)
 .. D WRITE^PSJMISC(PSJMSG,3)
"RTN","PSJOCDSD",31,0)
 .. S:PSJTYPE["1_SINGLE" PSJSGLE=1_U_PSJDD
"RTN","PSJOCDSD",32,0)
 .. S:PSJTYPE["2_RANGE" PSJRNGE=1_U_PSJDD
"RTN","PSJOCDSD",33,0)
 .. S:PSJTYPE["3_GENERAL" PSJDSPFG=1
"RTN","PSJOCDSD",34,0)
 Q:$G(PSGORQF)
"RTN","PSJOCDSD",35,0)
 D INTERV
"RTN","PSJOCDSD",36,0)
 Q
"RTN","PSJOCDSD",37,0)
INTERV ;Process intervention for dosing check
"RTN","PSJOCDSD",38,0)
 NEW PSJDD
"RTN","PSJOCDSD",39,0)
 S PSJDD=$S(+PSJSGLE:$P(PSJSGLE,U,2),1:$P(PSJRNGE,U,2))
"RTN","PSJOCDSD",40,0)
 I 'PSJDD S PSJDSPFG=1 Q
"RTN","PSJOCDSD",41,0)
 K PSJDSPFG
"RTN","PSJOCDSD",42,0)
 W !
"RTN","PSJOCDSD",43,0)
 I +PSJSGLE,+PSJRNGE D RINTERV^PSJGMRA("MAX SINGLE DOSE & DAILY DOSE RANGE") Q
"RTN","PSJOCDSD",44,0)
 I +PSJRNGE D RINTERV^PSJGMRA("DAILY DOSE RANGE") Q
"RTN","PSJOCDSD",45,0)
 I +PSJSGLE D RINTERV^PSJGMRA("MAX SINGLE DOSE") Q
"RTN","PSJOCDSD",46,0)
 Q
"RTN","PSJOCDSD",47,0)
ERROR ; Process errors
"RTN","PSJOCDSD",48,0)
 NEW PSJCNT,PSJNV
"RTN","PSJOCDSD",49,0)
 ;PSJDSPFG - Display pause if there were errors
"RTN","PSJOCDSD",50,0)
 ;Check for system error one more time.
"RTN","PSJOCDSD",51,0)
 S PSJDSPFG=0
"RTN","PSJOCDSD",52,0)
 I $O(^TMP($J,"PSJPRE1","OUT",PSJCNT0,PSJPON,"ERROR",0)) W !!
"RTN","PSJOCDSD",53,0)
 F PSJCNT=0:0 S PSJCNT=$O(^TMP($J,"PSJPRE1","OUT",PSJCNT0,PSJPON,"ERROR",PSJCNT)) Q:'PSJCNT  D
"RTN","PSJOCDSD",54,0)
 . S PSJDSPFG=1
"RTN","PSJOCDSD",55,0)
 . W !
"RTN","PSJOCDSD",56,0)
 . S PSJNV=$G(^TMP($J,"PSJPRE1","OUT",PSJCNT0,PSJPON,"ERROR",PSJCNT,"MSG"))
"RTN","PSJOCDSD",57,0)
 . D:PSJNV]"" WRITE^PSJMISC(PSJNV,1)
"RTN","PSJOCDSD",58,0)
 . S PSJNV=$G(^TMP($J,"PSJPRE1","OUT",PSJCNT0,PSJPON,"ERROR",PSJCNT,"TEXT"))
"RTN","PSJOCDSD",59,0)
 . D:PSJNV]"" WRITE^PSJMISC(PSJNV,3)
"RTN","PSJOCDSD",60,0)
 Q
"RTN","PSJOCDSD",61,0)
EXCEPTN ; Process exceptions
"RTN","PSJOCDSD",62,0)
 NEW PSJCNT,PSJNV,PSJSPACE,PSJQFLG1
"RTN","PSJOCDSD",63,0)
 ;PSJDSPFG - Display pause if there were errors
"RTN","PSJOCDSD",64,0)
 ;Check for system error one more time.
"RTN","PSJOCDSD",65,0)
 S PSJDSPFG=0,PSJSPACE=0
"RTN","PSJOCDSD",66,0)
 I $O(^TMP($J,"PSJPRE1","OUT",PSJCNT0,PSJPON,"EXCEPTIONS",0)) W !!
"RTN","PSJOCDSD",67,0)
 F PSJCNT=0:0 S PSJCNT=$O(^TMP($J,"PSJPRE1","OUT",PSJCNT0,PSJPON,"EXCEPTIONS",PSJCNT)) Q:'PSJCNT  D
"RTN","PSJOCDSD",68,0)
 . S PSJQFLG1=0
"RTN","PSJOCDSD",69,0)
 . I $G(^TMP($J,"PSJPRE1","OUT",PSJCNT0,PSJPON,"EXCEPTIONS",PSJCNT))["Dosing Checks could not be performed",($G(^TMP($J,"PSJPRE1","OUT",PSJCNT0,PSJPON,"EXCEPTIONS",PSJCNT+1))["Drug not matched to NDF") Q
"RTN","PSJOCDSD",70,0)
 . I $G(^TMP($J,"PSJPRE1","OUT",PSJCNT0,PSJPON,"EXCEPTIONS",PSJCNT))["Drug not matched to NDF" Q
"RTN","PSJOCDSD",71,0)
 . I $G(^TMP($J,"PSJPRE1","OUT",PSJCNT0,PSJPON,"EXCEPTIONS",PSJCNT))["Order Checks could not be done" Q
"RTN","PSJOCDSD",72,0)
 . S PSJDSPFG=1
"RTN","PSJOCDSD",73,0)
 . S PSJNV=$G(^TMP($J,"PSJPRE1","OUT",PSJCNT0,PSJPON,"EXCEPTIONS",PSJCNT))
"RTN","PSJOCDSD",74,0)
 . I PSJNV]"" D
"RTN","PSJOCDSD",75,0)
 .. I ($Y+6)>IOSL D PAUSE^PSJLMUT1 W @IOF
"RTN","PSJOCDSD",76,0)
 .. ;If the output has 13 leading spaces, strip it off so the display is indenting correctly
"RTN","PSJOCDSD",77,0)
 .. I $E(PSJNV,1,13)="             " S PSJSPACE=13,PSJNV=$P(PSJNV,"             ",2)
"RTN","PSJOCDSD",78,0)
 .. D WRITE^PSJMISC(PSJNV,PSJSPACE+3)
"RTN","PSJOCDSD",79,0)
 Q
"RTN","PSJOCDSD",80,0)
EXCEPTN2 ; Process exceptions on prospective drug
"RTN","PSJOCDSD",81,0)
 NEW PSJPON,PSJN,PSJNV
"RTN","PSJOCDSD",82,0)
 K PSJDSPFG
"RTN","PSJOCDSD",83,0)
 S PSJPON="" F  S PSJPON=$O(^TMP($J,"PSJPRE","OUT","EXCEPTIONS",PSJPON)) Q:PSJPON=""  D
"RTN","PSJOCDSD",84,0)
 . F PSJN=0:0 S PSJN=$O(^TMP($J,"PSJPRE","OUT","EXCEPTIONS",PSJPON,PSJN)) Q:'PSJN  D
"RTN","PSJOCDSD",85,0)
 .. S PSJNV=$G(^TMP($J,"PSJPRE","OUT","EXCEPTIONS",PSJPON,PSJN))
"RTN","PSJOCDSD",86,0)
 .. I $P(PSJPON,";",3)="PROFILE" Q
"RTN","PSJOCDSD",87,0)
 .. I '$$ERRCHK^PSJOC("PROSPECTIVE",$P(PSJNV,U,3)_$P(PSJNV,U,10)) Q
"RTN","PSJOCDSD",88,0)
 .. W !
"RTN","PSJOCDSD",89,0)
 .. D DSPDRGER^PSJOC(1)
"RTN","PSJOCDSD",90,0)
 I $G(PSJDSPFG) D PAUSE^PSJLMUT1 W @IOF
"RTN","PSJOCDSD",91,0)
 Q
"RTN","PSJOCDT")
0^46^B28304577
"RTN","PSJOCDT",1,0)
PSJOCDT ;BIR/MV - PROCESS DUPLICATE THERAPY ORDER CHECKS ;6 Jun 07 / 3:37 PM
"RTN","PSJOCDT",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**181**;16 DEC 97;Build 190
"RTN","PSJOCDT",3,0)
 ;
"RTN","PSJOCDT",4,0)
 ; Reference to EN^PSODRDU2 is supported by DBIA# 2189.
"RTN","PSJOCDT",5,0)
 ;
"RTN","PSJOCDT",6,0)
DT ;
"RTN","PSJOCDT",7,0)
 NEW PSJN1,PSJCLASS,PSJDNCNT,PSJNDV,PSJPROSP,PSJOCDT
"RTN","PSJOCDT",8,0)
 S PSJCLASS=""
"RTN","PSJOCDT",9,0)
 F PSJN1=0:0 S PSJN1=$O(^TMP($J,"PSJPRE","OUT","THERAPY",PSJN1)) Q:'PSJN1  D
"RTN","PSJOCDT",10,0)
 . D SETCLASS
"RTN","PSJOCDT",11,0)
 . F PSJDNCNT=0:0 S PSJDNCNT=$O(^TMP($J,"PSJPRE","OUT","THERAPY",PSJN1,"DRUGS",PSJDNCNT)) Q:'PSJDNCNT  D
"RTN","PSJOCDT",12,0)
 .. S PSJNDV=$G(^TMP($J,"PSJPRE","OUT","THERAPY",PSJN1,"DRUGS",PSJDNCNT))
"RTN","PSJOCDT",13,0)
 .. D SETOC
"RTN","PSJOCDT",14,0)
 I '$D(PSJPROSP) Q
"RTN","PSJOCDT",15,0)
 D DSPOC
"RTN","PSJOCDT",16,0)
 Q
"RTN","PSJOCDT",17,0)
DSPOC ;
"RTN","PSJOCDT",18,0)
 ;PSJDSPON(ON) - Is set after the order is displayed so the same order is not displayed again
"RTN","PSJOCDT",19,0)
 NEW PSJTYPE,PSJDNM,PSPON,PSJPONX,PSJX,PSJDSPON
"RTN","PSJOCDT",20,0)
 D HDR
"RTN","PSJOCDT",21,0)
 F PSJTYPE=0:0 S PSJTYPE=$O(PSJOCDT(PSJTYPE)) Q:'PSJTYPE  D
"RTN","PSJOCDT",22,0)
 . S PSJDNM="" F  S PSJDNM=$O(PSJOCDT(PSJTYPE,PSJDNM)) Q:PSJDNM=""  D
"RTN","PSJOCDT",23,0)
 .. S PSJPON="" F  S PSJPON=$O(PSJOCDT(PSJTYPE,PSJDNM,PSJPON)) Q:PSJPON=""  D
"RTN","PSJOCDT",24,0)
 ... I ($Y+6)>IOSL D PAUSE^PSJMISC(1,) W @IOF
"RTN","PSJOCDT",25,0)
 ... S PSJPONX=$P(PSJPON,";",2)
"RTN","PSJOCDT",26,0)
 ... I PSJTYPE=10,+PSJPONX D
"RTN","PSJOCDT",27,0)
 .... I '$D(PSJDSPON(PSJPONX)) D DSPORD^PSJOC(PSJPONX)
"RTN","PSJOCDT",28,0)
 .... S PSJDSPON(PSJPONX)=""
"RTN","PSJOCDT",29,0)
 ... I ($Y+8)>IOSL D PAUSE^PSJMISC(1,) W @IOF
"RTN","PSJOCDT",30,0)
 ... I PSJTYPE>10 D EN^PSODRDU2(DFN,PSJPON,"PSJPRE")
"RTN","PSJOCDT",31,0)
 ;Break the display text this way so the info on classes are indented correctly
"RTN","PSJOCDT",32,0)
 S PSJCLASS=" Involved in Therapeutic Duplication(s): "_PSJCLASS
"RTN","PSJOCDT",33,0)
 S PSJX=$L(PSJCLASS)\65 I ($Y+PSJX+4)>IOSL D PAUSE^PSJMISC(1,) W @IOF
"RTN","PSJOCDT",34,0)
 W !,"Class(es)"
"RTN","PSJOCDT",35,0)
 D MYWRITE^PSJMISC(PSJCLASS,3,67)
"RTN","PSJOCDT",36,0)
 I ($Y+8)>IOSL D PAUSE^PSJMISC(1,) W @IOF
"RTN","PSJOCDT",37,0)
 W !
"RTN","PSJOCDT",38,0)
 ;D LINE^PSJMISC($S($G(PSJOLDN):PSJLINE,1:"="),81)
"RTN","PSJOCDT",39,0)
 D LINE^PSJMISC("=",81)
"RTN","PSJOCDT",40,0)
 I '$D(PSJOCDT(10)),$D(PSJOCDT) K PSJPAUSE D PAUSE^PSJLMUT1 W @IOF Q
"RTN","PSJOCDT",41,0)
 ;I ($Y+8)>IOSL D PAUSE^PSJMISC(1,) W @IOF
"RTN","PSJOCDT",42,0)
 D CONT
"RTN","PSJOCDT",43,0)
 Q:$G(PSGORQF)
"RTN","PSJOCDT",44,0)
 S PSJY=$$SORTLST()
"RTN","PSJOCDT",45,0)
 K PSJPAUSE
"RTN","PSJOCDT",46,0)
 I PSJY=1 D  Q
"RTN","PSJOCDT",47,0)
 . W !!
"RTN","PSJOCDT",48,0)
 . D PROCLST(PSJY)
"RTN","PSJOCDT",49,0)
 I (PSJY>1),+$$DCPROMPT() D
"RTN","PSJOCDT",50,0)
 . W !
"RTN","PSJOCDT",51,0)
 . S PSJY=$$LST() W !
"RTN","PSJOCDT",52,0)
 . D PROCLST(PSJY)
"RTN","PSJOCDT",53,0)
 Q
"RTN","PSJOCDT",54,0)
HDR ;
"RTN","PSJOCDT",55,0)
 NEW PSJHDR,PSJDNM
"RTN","PSJOCDT",56,0)
 I $D(^TMP($J,"PSJPRE","OUT","DRUGDRUG")) W @IOF
"RTN","PSJOCDT",57,0)
 D LINE^PSJMISC("=",81)
"RTN","PSJOCDT",58,0)
 S PSJHDR="This patient is already receiving the following INPATIENT and/or OUTPATIENT order(s) for a drug in the same therapeutic class(es)"
"RTN","PSJOCDT",59,0)
 S PSJDNM=$O(PSJPROSP("UD",""))
"RTN","PSJOCDT",60,0)
 I PSJDNM]"" S PSJHDR=PSJHDR_" as "_PSJDNM_":" D WRITE^PSJMISC(PSJHDR,1,77) Q
"RTN","PSJOCDT",61,0)
 D WRITE^PSJMISC(PSJHDR_":",1,77)
"RTN","PSJOCDT",62,0)
 W !,"Drug(s) Ordered:"
"RTN","PSJOCDT",63,0)
 S PSJDNM="" F  S PSJDNM=$O(PSJPROSP("IV",PSJDNM)) Q:PSJDNM=""  D
"RTN","PSJOCDT",64,0)
 . W !,?3,PSJDNM
"RTN","PSJOCDT",65,0)
 . I ($Y+8)>IOSL D PAUSE^PSJMISC() W @IOF
"RTN","PSJOCDT",66,0)
 W !
"RTN","PSJOCDT",67,0)
 Q
"RTN","PSJOCDT",68,0)
SETCLASS ;Store all classes to display at the end.
"RTN","PSJOCDT",69,0)
 NEW PSJN2,PSJCLS
"RTN","PSJOCDT",70,0)
 F PSJN2=0:0 S PSJN2=$O(^TMP($J,"PSJPRE","OUT","THERAPY",PSJN1,PSJN2)) Q:'PSJN2  D
"RTN","PSJOCDT",71,0)
 . S PSJCLS=$G(^TMP($J,"PSJPRE","OUT","THERAPY",PSJN1,PSJN2,"CLASS"))
"RTN","PSJOCDT",72,0)
 . S PSJCLASS=PSJCLASS_$S(PSJCLASS="":"",1:", ")_PSJCLS
"RTN","PSJOCDT",73,0)
 Q
"RTN","PSJOCDT",74,0)
SETOC ;Set PSJOCDT array to sort by Package(Inpt, Outpt: Active, Remote, Pending, Non-VA
"RTN","PSJOCDT",75,0)
 ;PSJPROSP(UD/IV,drugname)="" - This is used to display the header
"RTN","PSJOCDT",76,0)
 ;PSJOCDT(package,drugname,Pharm ord#)=""
"RTN","PSJOCDT",77,0)
 NEW PSJPON,PSJPKG,PSJTYPE,PSJDNM,PSJPONX
"RTN","PSJOCDT",78,0)
 S PSJPON=$P(PSJNDV,U) Q:PSJPON=""
"RTN","PSJOCDT",79,0)
 S PSJPONX=$P(PSJPON,";",2)
"RTN","PSJOCDT",80,0)
 S PSJTYPE=$P(PSJPON,";") Q:PSJTYPE=""
"RTN","PSJOCDT",81,0)
 S PSJDNM=$P(PSJNDV,U,3) Q:PSJDNM=""
"RTN","PSJOCDT",82,0)
 S PSJPKG=$S(PSJTYPE="I":10,PSJTYPE="O":20,PSJTYPE="R":30,PSJTYPE="P":40,PSJTYPE="N":50,1:"")
"RTN","PSJOCDT",83,0)
 ; Set prospective drug name array to display in the header.
"RTN","PSJOCDT",84,0)
 I PSJPKG=10,($P(PSJPON,";",3)="PROSPECTIVE") D  Q
"RTN","PSJOCDT",85,0)
 . I PSJPONX["V" S PSJPROSP("IV",PSJDNM)="" Q
"RTN","PSJOCDT",86,0)
 . I PSJPONX["P",+$G(PSJLIFNI) S PSJPROSP("IV",PSJDNM)="" Q
"RTN","PSJOCDT",87,0)
 . I PSJPONX["P",($P($G(^PS(53.1,+PSJPONX,8)),U)]"") S PSJPROSP("IV",PSJDNM)="" Q
"RTN","PSJOCDT",88,0)
 . S PSJPROSP("UD",PSJDNM)=""
"RTN","PSJOCDT",89,0)
 S PSJOCDT(PSJPKG,PSJDNM,PSJPON)=""
"RTN","PSJOCDT",90,0)
 Q
"RTN","PSJOCDT",91,0)
CONT ;Display the continue prompt.
"RTN","PSJOCDT",92,0)
 NEW DIR,DTOUT,DIRUT,DIROUT,DUOUT,Y,X
"RTN","PSJOCDT",93,0)
 W !
"RTN","PSJOCDT",94,0)
 S DIR(0)="Y",DIR("B")="YES",DIR("A")="Do you wish to continue with the current order"
"RTN","PSJOCDT",95,0)
 S DIR("?",1)="Enter 'NO' if you wish to not continue with the order,",DIR("?")="or 'YES' to continue with the current order."
"RTN","PSJOCDT",96,0)
 D ^DIR
"RTN","PSJOCDT",97,0)
 I 'Y S PSGORQF=1 S VALMBCK="R"
"RTN","PSJOCDT",98,0)
 Q
"RTN","PSJOCDT",99,0)
DCPROMPT() ;Prompt if user wants to DC order(s)
"RTN","PSJOCDT",100,0)
 NEW DIR,DTOUT,DIRUT,DIROUT,DUOUT,Y,X
"RTN","PSJOCDT",101,0)
 W !
"RTN","PSJOCDT",102,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="Do you wish to DISCONTINUE any of the listed INPATIENT orders"
"RTN","PSJOCDT",103,0)
 S DIR("?",1)="Enter 'NO' if you don't wish to discontinue any of the order(s),",DIR("?")="or 'YES' to discontinue selected order(s)."
"RTN","PSJOCDT",104,0)
 D ^DIR
"RTN","PSJOCDT",105,0)
 Q Y
"RTN","PSJOCDT",106,0)
SORTLST() ;Sort orders into a numeric list
"RTN","PSJOCDT",107,0)
 NEW DIR,DIRUT,DTOUT,DUOUT,PSJN,PSJPON1,PSJMONV,PSJS,PSJSEV1,PSJX,X,Y,PSJDNM,PSJPONX,PSJDSPON
"RTN","PSJOCDT",108,0)
 ;Sort orders into a numeric list
"RTN","PSJOCDT",109,0)
 Q:'$D(PSJOCDT(10)) 0
"RTN","PSJOCDT",110,0)
 S PSJN=0,PSJDNM=""
"RTN","PSJOCDT",111,0)
 F  S PSJDNM=$O(PSJOCDT(10,PSJDNM)) Q:PSJDNM=""  S PSJS="" F  S PSJS=$O(PSJOCDT(10,PSJDNM,PSJS)) Q:PSJS=""  D
"RTN","PSJOCDT",112,0)
 . S PSJPONX=$P(PSJS,";",2)
"RTN","PSJOCDT",113,0)
 . I $D(PSJDSPON(PSJPONX)) Q
"RTN","PSJOCDT",114,0)
 . S PSJDSPON(PSJPONX)=""
"RTN","PSJOCDT",115,0)
 . S PSJN=PSJN+1
"RTN","PSJOCDT",116,0)
 . S PSJOCDTL(PSJN)=PSJPONX
"RTN","PSJOCDT",117,0)
 Q PSJN
"RTN","PSJOCDT",118,0)
LST() ;
"RTN","PSJOCDT",119,0)
 ;Only present the list if there are more than 1 orders the list
"RTN","PSJOCDT",120,0)
 F PSJX=0:0 S PSJX=$O(PSJOCDTL(PSJX)) Q:'PSJX  D
"RTN","PSJOCDT",121,0)
 . I ($Y+6)>IOSL D PAUSE^PSJMISC(1,) W @IOF
"RTN","PSJOCDT",122,0)
 . D DSPORD^PSJOC(PSJOCDTL(PSJX),PSJX_".  ")
"RTN","PSJOCDT",123,0)
 W !
"RTN","PSJOCDT",124,0)
 K DIR S DIR(0)="LO^1:"_$O(PSJOCDTL(""),-1) D ^DIR
"RTN","PSJOCDT",125,0)
 Q Y
"RTN","PSJOCDT",126,0)
PROCLST(PSJY) ;DC the orders selected by user
"RTN","PSJOCDT",127,0)
 NEW PSJX,PSJX1,PSJON
"RTN","PSJOCDT",128,0)
 F PSJX1=1:1:$L(PSJY) S PSJX=$P(PSJY,",",PSJX1) Q:PSJX=""  D
"RTN","PSJOCDT",129,0)
 . I ($Y+8)>IOSL D PAUSE^PSJMISC() W @IOF
"RTN","PSJOCDT",130,0)
 . I '$D(PSJOCDTL(PSJX)) Q
"RTN","PSJOCDT",131,0)
 . S PSJON=PSJOCDTL(PSJX)
"RTN","PSJOCDT",132,0)
 . D DC^PSJOCDC(PSGP,PSJON)
"RTN","PSJOCDT",133,0)
 . W !
"RTN","PSJOCDT",134,0)
 Q
"RTN","PSJOCERR")
0^64^B3747914
"RTN","PSJOCERR",1,0)
PSJOCERR ;BIR/MV - ERROR HANDLING FOR ORDER CHECKS ;6 Jun 07 / 3:37 PM
"RTN","PSJOCERR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**181**;16 DEC 97;Build 190
"RTN","PSJOCERR",3,0)
 ;
"RTN","PSJOCERR",4,0)
SYS() ;
"RTN","PSJOCERR",5,0)
 ;If the system is down, pause and continue with Allergy and CPRS OC
"RTN","PSJOCERR",6,0)
 I '$$PING^PSJOC() D  Q 1
"RTN","PSJOCERR",7,0)
 . K ^TMP($J,"PSJPRE")
"RTN","PSJOCERR",8,0)
 . D PAUSE^PSJMISC(1,1)
"RTN","PSJOCERR",9,0)
 . D GMRAOC^PSJOC
"RTN","PSJOCERR",10,0)
 Q 0
"RTN","PSJOCERR",11,0)
DRUG ;
"RTN","PSJOCERR",12,0)
 Q
"RTN","PSJOCERR",13,0)
ORDER ;
"RTN","PSJOCERR",14,0)
 Q
"RTN","PSJOCERR",15,0)
SETERR(PSJBASE,PSJPON,PSJCODE,PSJDNM) ;
"RTN","PSJOCERR",16,0)
 ;PSJBASE - Base(Literal value for TMP global)
"RTN","PSJOCERR",17,0)
 ;PSJPON - 4th pieces pharmacy order #
"RTN","PSJOCERR",18,0)
 ;PSJCODE - Exception code for a specific error message to be returned
"RTN","PSJOCERR",19,0)
 ;PSJDNM - Display drug name (DD or AD/SOL)
"RTN","PSJOCERR",20,0)
 I $G(PSJBASE)="" Q
"RTN","PSJOCERR",21,0)
 I $G(PSJPON)="" Q
"RTN","PSJOCERR",22,0)
 I '$G(PSJCODE) Q
"RTN","PSJOCERR",23,0)
 S ^TMP($J,PSJBASE,"IN","EXCEPTIONS","DOSE",PSJPON)=PSJCODE_U_$G(PSJDNM)
"RTN","PSJOCERR",24,0)
 Q
"RTN","PSJOCERR",25,0)
DSPERR(PSJTYPE) ;Display drug level errors
"RTN","PSJOCERR",26,0)
 ;PSJTYPE = "DRUGDRUG" or "THERAPY"
"RTN","PSJOCERR",27,0)
 ;PSJOCER(MSG_TEXT) - Array to keep track of errors that already displayed
"RTN","PSJOCERR",28,0)
 ;PSJDSPFG - If 1 then display a Pause if an error was displayed.
"RTN","PSJOCERR",29,0)
 Q:$G(PSJTYPE)=""
"RTN","PSJOCERR",30,0)
 NEW ON,PSJPON,PSJCNT,PSJMSG
"RTN","PSJOCERR",31,0)
 S PSJDSPFG=0
"RTN","PSJOCERR",32,0)
 S PSJPON="" F  S PSJPON=$O(^TMP($J,"PSJPRE","OUT",PSJTYPE,"ERROR",PSJPON)) Q:PSJPON=""  D
"RTN","PSJOCERR",33,0)
 . F PSJCNT=0:0 S PSJCNT=$O(^TMP($J,"PSJPRE","OUT",PSJTYPE,"ERROR",PSJPON,PSJCNT)) Q:'PSJCNT  D
"RTN","PSJOCERR",34,0)
 .. S PSJMSG=$G(^TMP($J,"PSJPRE","OUT",PSJTYPE,"ERROR",PSJPON,PSJCNT,"MSG"))
"RTN","PSJOCERR",35,0)
 .. S PSJTXT=$G(^TMP($J,"PSJPRE","OUT",PSJTYPE,"ERROR",PSJPON,PSJCNT,"TEXT"))
"RTN","PSJOCERR",36,0)
 .. I '$$ERRCHK(PSJMSG_PSJTXT) Q
"RTN","PSJOCERR",37,0)
 .. S PSJDSPFG=1
"RTN","PSJOCERR",38,0)
 .. K PSJPAUSE
"RTN","PSJOCERR",39,0)
 .. I ($Y+6)>IOSL D PAUSE^PSJMISC(1,1) W @IOF
"RTN","PSJOCERR",40,0)
 .. I PSJMSG]"" W !! D WRITE^PSJMISC(PSJMSG)
"RTN","PSJOCERR",41,0)
 .. I PSJTXT]"" D WRITE^PSJMISC("  Reason: "_PSJTXT)
"RTN","PSJOCERR",42,0)
 I PSJDSPFG D PAUSE^PSJMISC(1,1) W @IOF
"RTN","PSJOCERR",43,0)
 Q
"RTN","PSJOCERR",44,0)
ERRCHK(PSJX) ;
"RTN","PSJOCERR",45,0)
 ;PSJX - Drug name_Error reason
"RTN","PSJOCERR",46,0)
 ;Return 1 if this error drug has not displayed to the user.
"RTN","PSJOCERR",47,0)
 I $G(PSJX)="" Q 0
"RTN","PSJOCERR",48,0)
 I '$D(PSJOCER(PSJX)) S PSJOCER(PSJX)="" Q 1
"RTN","PSJOCERR",49,0)
 Q 0
"RTN","PSJOCOR")
0^50^B3349794
"RTN","PSJOCOR",1,0)
PSJOCOR ;BIR/MV - DISPLAY CPRS ORDER CHECKS ;6 Jun 07 / 3:37 PM
"RTN","PSJOCOR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**181**;16 DEC 97;Build 190
"RTN","PSJOCOR",3,0)
 ;
"RTN","PSJOCOR",4,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192.
"RTN","PSJOCOR",5,0)
 ; Reference to ^OROCAPI is supported by DBIA# 5367.
"RTN","PSJOCOR",6,0)
 ;
"RTN","PSJOCOR",7,0)
CPRS(PSPDRG) ;Perform Aminoglycoside checks for IV drugs
"RTN","PSJOCOR",8,0)
 ;PSPDRG - Drug array in format of PDRG(n)=IEN (#50) ^ Drug name
"RTN","PSJOCOR",9,0)
 ;Only need to display AMinoglycoside once for an order.  If PSJQUIT is set that means it already displayed
"RTN","PSJOCOR",10,0)
 NEW PSJDD,PSJQUIT,PSJPAUSE,PSJCNT,VAIN
"RTN","PSJOCOR",11,0)
 S PSJPAUSE=0
"RTN","PSJOCOR",12,0)
 W !!
"RTN","PSJOCOR",13,0)
 F PSJCNT=0:0 S PSJCNT=$O(PSPDRG(PSJCNT)) Q:'PSJCNT  Q:$G(PSJQUIT)  S PSJDD=+PSPDRG(PSJCNT) D
"RTN","PSJOCOR",14,0)
 .  D DOC(DFN,$$OROI(+PSJDD))
"RTN","PSJOCOR",15,0)
 .  D GOC(DFN,($P(PSPDRG(PSJCNT),U,2)))
"RTN","PSJOCOR",16,0)
 .  D AOC(DFN,$$VAPROD(+PSJDD))
"RTN","PSJOCOR",17,0)
 D:PSJPAUSE PAUSE^PSJMISC()
"RTN","PSJOCOR",18,0)
 Q
"RTN","PSJOCOR",19,0)
 ;
"RTN","PSJOCOR",20,0)
OROI(PSJDD) ;Get CPRS OI
"RTN","PSJOCOR",21,0)
 ;PSJDD - Drug IEN(#50)
"RTN","PSJOCOR",22,0)
 NEW PSJOI
"RTN","PSJOCOR",23,0)
 Q:'+$G(PSJDD)
"RTN","PSJOCOR",24,0)
 S PSJOI=+$P($G(^PSDRUG(+PSJDD,2)),U)
"RTN","PSJOCOR",25,0)
 Q:'PSJOI
"RTN","PSJOCOR",26,0)
 Q $$OITM^ORX8(PSJOI,"99PSP")
"RTN","PSJOCOR",27,0)
 ;
"RTN","PSJOCOR",28,0)
DOC(DFN,PSJOROI) ;DANGEREOUS MEDS FOR PAT > 64 ORDER CHECK
"RTN","PSJOCOR",29,0)
 ;DFN - Patient IEN
"RTN","PSJOCOR",30,0)
 ;PSJOROI - CPRS orderable item IEN
"RTN","PSJOCOR",31,0)
 NEW X
"RTN","PSJOCOR",32,0)
 S X=$P($$DOC^OROCAPI(DFN,+PSJOROI),U,4)
"RTN","PSJOCOR",33,0)
 I X]"" S PSJPAUSE=1 W "***Dangerous Meds for Patient >64***",!! D WRITE^PSJMISC(X)
"RTN","PSJOCOR",34,0)
 Q
"RTN","PSJOCOR",35,0)
 ;
"RTN","PSJOCOR",36,0)
GOC(DFN,PSJDNM) ;GLUCOPHAGE LAB RESULTS ORDER CHECK
"RTN","PSJOCOR",37,0)
 ;PSJDNM - Drug name from file 50
"RTN","PSJOCOR",38,0)
 NEW X
"RTN","PSJOCOR",39,0)
 S X=$P($$GOC^OROCAPI(DFN,PSJDNM),U,4)
"RTN","PSJOCOR",40,0)
 I X]"" S PSJPAUSE=1,PSJQUIT=1 W "***Metformin Lab Results***",!! D WRITE^PSJMISC(X)
"RTN","PSJOCOR",41,0)
 Q
"RTN","PSJOCOR",42,0)
 ;
"RTN","PSJOCOR",43,0)
AOC(DFN,PSJPROD) ;AMINOGLYCOSIDE ORDERED ORDER CHECK
"RTN","PSJOCOR",44,0)
 ;PSJPROD - VA Product File (#50.68) IEN.
"RTN","PSJOCOR",45,0)
 ;PSJQUIT is set so Aminoglycosid is only warn once per session.
"RTN","PSJOCOR",46,0)
 NEW X
"RTN","PSJOCOR",47,0)
 S X=$P($$AOC^OROCAPI(DFN,+PSJPROD),U,4)
"RTN","PSJOCOR",48,0)
 I X]"" S PSJPAUSE=1,PSJQUIT=1 W "***Aminoglycoside Ordered****",!! D WRITE^PSJMISC(X)
"RTN","PSJOCOR",49,0)
 Q
"RTN","PSJOCOR",50,0)
 ;
"RTN","PSJOCOR",51,0)
VAPROD(PSJDD) ;Return VA PRODUCT IEN (50.68)
"RTN","PSJOCOR",52,0)
 ;PSJDD - Dispense drug IEN (50)
"RTN","PSJOCOR",53,0)
 Q $P($G(^PSDRUG(+PSJDD,"ND")),U,3)
"RTN","PSJOCOR",54,0)
 ; 
"RTN","PSJOCVAR")
0^93^B55813758
"RTN","PSJOCVAR",1,0)
PSJOCVAR ;BIR/RSB-SAVE/RESTORE VARIABLES FOR OC  ;24 Feb 99 / 10:42 AM
"RTN","PSJOCVAR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**16,22,30,58,181**;16 DEC 97;Build 190
"RTN","PSJOCVAR",3,0)
 ;
"RTN","PSJOCVAR",4,0)
 NEW PSJVAR,PSJVAR1,PSJX
"RTN","PSJOCVAR",5,0)
 ; saves the variables in ^TMP
"RTN","PSJOCVAR",6,0)
 K ^TMP("PSJOCVAR",$J),^TMP("PSJOCVAR_DRG",$J),^TMP("PSJOCVAR_PS5345",$J)
"RTN","PSJOCVAR",7,0)
 F PSJVAR1=1:1 S PSJVAR=$P($T(LIST+PSJVAR1),";;",2) Q:PSJVAR=""  D
"RTN","PSJOCVAR",8,0)
 .I $D(@PSJVAR) S:$D(@PSJVAR)'=10 ^TMP("PSJOCVAR",$J,PSJVAR)=@PSJVAR
"RTN","PSJOCVAR",9,0)
 I $D(DRG) MERGE ^TMP("PSJOCVAR_DRG",$J)=DRG
"RTN","PSJOCVAR",10,0)
 ;save off local array
"RTN","PSJOCVAR",11,0)
 F PSJX="P(","PSGEFN(","PSGVADR(","PSGVALG(","VADM(","VAIN(","VAIP(" D SVARRAY
"RTN","PSJOCVAR",12,0)
 D SAVEPS ; Save the ^PS(53.45,DUZ,2) entry
"RTN","PSJOCVAR",13,0)
 Q
"RTN","PSJOCVAR",14,0)
SVARRAY ;  Save array to ^TMP
"RTN","PSJOCVAR",15,0)
 NEW PSJVARX,X
"RTN","PSJOCVAR",16,0)
 S PSJVARX=PSJX_"X)"
"RTN","PSJOCVAR",17,0)
 S X="" F  S X=$O(@PSJVARX) Q:X=""  S ^TMP("PSJOCVAR",$J,PSJX_$S(+X=X:X,1:""""_X_"""")_")")=@PSJVARX
"RTN","PSJOCVAR",18,0)
 Q
"RTN","PSJOCVAR",19,0)
RESTORE ;  restores the variables from ^TMP
"RTN","PSJOCVAR",20,0)
 NEW PSJVAR
"RTN","PSJOCVAR",21,0)
 S PSJVAR="" F  S PSJVAR=$O(^TMP("PSJOCVAR",$J,PSJVAR)) Q:PSJVAR=""  D
"RTN","PSJOCVAR",22,0)
 .S @PSJVAR=^TMP("PSJOCVAR",$J,PSJVAR)
"RTN","PSJOCVAR",23,0)
 I $D(^TMP("PSJOCVAR_DRG",$J)) K DRG MERGE DRG=^TMP("PSJOCVAR_DRG",$J)
"RTN","PSJOCVAR",24,0)
 K ^TMP("PSJOCVAR",$J),^TMP("PSJOCVAR_DRG",$J),^TMP("PSJOCVAR_PS5345",$J,DUZ)
"RTN","PSJOCVAR",25,0)
 D RESPS ; Restore any saved ^PS(53.45,DUZ,2) and ^PS(53.45,DUZ,4) entries
"RTN","PSJOCVAR",26,0)
 Q
"RTN","PSJOCVAR",27,0)
SAVEPS ; Save the ^PS(53.45,DUZ,2) entry
"RTN","PSJOCVAR",28,0)
 NEW PSJLOOP,PSJBLOOP
"RTN","PSJOCVAR",29,0)
 ; Save the 2,0) node
"RTN","PSJOCVAR",30,0)
 I $D(^PS(53.45,DUZ,2,0)) D
"RTN","PSJOCVAR",31,0)
 .S ^TMP("PSJOCVAR_PS5345",$J,DUZ,2,0)=^PS(53.45,DUZ,2,0)
"RTN","PSJOCVAR",32,0)
 ;Save the 2,n,0) nodes
"RTN","PSJOCVAR",33,0)
 S PSJLOOP=0
"RTN","PSJOCVAR",34,0)
 F PSJLOOP=$O(^PS(53.45,DUZ,2,PSJLOOP)) Q:(PSJLOOP="")!(PSJLOOP="B")  D
"RTN","PSJOCVAR",35,0)
 .S ^TMP("PSJOCVAR_PS5345",$J,DUZ,2,PSJLOOP,0)=^PS(53.45,DUZ,2,PSJLOOP,0)
"RTN","PSJOCVAR",36,0)
 ;Save the 2,"B" node
"RTN","PSJOCVAR",37,0)
 I $D(^PS(53.45,DUZ,2,"B")) D
"RTN","PSJOCVAR",38,0)
 .S PSJBLOOP=""
"RTN","PSJOCVAR",39,0)
 .F PSJBLOOP=$O(^PS(53.45,DUZ,2,"B",PSJBLOOP)) Q:PSJBLOOP=""  D
"RTN","PSJOCVAR",40,0)
 ..S PSJCOUNT=""
"RTN","PSJOCVAR",41,0)
 ..F PSJCOUNT=$O(^PS(53.45,DUZ,2,"B",PSJBLOOP,PSJCOUNT)) Q:PSJCOUNT=""  D
"RTN","PSJOCVAR",42,0)
 ...S ^TMP("PSJOCVAR_PS5345",$J,DUZ,2,"B",PSJBLOOP,PSJCOUNT)=^PS(53.45,DUZ,2,"B",PSJBLOOP,PSJCOUNT)
"RTN","PSJOCVAR",43,0)
 Q
"RTN","PSJOCVAR",44,0)
RESPS ; Restore any saved ^PS(53.45,DUZ,2) entry
"RTN","PSJOCVAR",45,0)
 NEW PSJLOOP,PSJBLOOP,PSJCOUNT
"RTN","PSJOCVAR",46,0)
 ;Restore the 2,0 node
"RTN","PSJOCVAR",47,0)
 I $D(^TMP("PSJOCVAR_PS5345",$J,DUZ,2,0)) D
"RTN","PSJOCVAR",48,0)
 .S ^PS(53.45,DUZ,2,0)=^TMP("PSJOCVAR_PS5345",$J,DUZ,2,0)
"RTN","PSJOCVAR",49,0)
 ;Restore the 2,n,o) nodes
"RTN","PSJOCVAR",50,0)
 S PSJLOOP=0
"RTN","PSJOCVAR",51,0)
 F PSJLOOP=$O(^TMP("PSJOCVAR_PS5345",$J,DUZ,2,PSJLOOP)) Q:(PSJLOOP="")!(PSJLOOP="B")  D
"RTN","PSJOCVAR",52,0)
 .S ^PS(53.45,DUZ,2,PSJLOOP,0)=^TMP("PSJOCVAR_PS5345",$J,DUZ,2,PSJLOOP,0)
"RTN","PSJOCVAR",53,0)
 ;Restore the 2,"B" nodes
"RTN","PSJOCVAR",54,0)
 I $D(^TMP("PSJOCVAR_PS5345",$J,DUZ,2,"B")) D
"RTN","PSJOCVAR",55,0)
 .S PSJBLOOP=""
"RTN","PSJOCVAR",56,0)
 .F PSJBLOOP=$O(^TMP("PSJOCVAR_PS5345",$J,DUZ,2,"B",PSJBLOOP)) Q:PSJBLOOP=""  D
"RTN","PSJOCVAR",57,0)
 ..S PSJCOUNT=""
"RTN","PSJOCVAR",58,0)
 ..F PSJCOUNT=$O(^TMP("PSJOCVAR_PS5345",$J,DUZ,2,"B",PSJBLOOP,PSJCOUNT)) Q:PSJCOUNT=""  D
"RTN","PSJOCVAR",59,0)
 ...S ^PS(53.45,DUZ,2,"B",PSJBLOOP,PSJCOUNT)=^TMP("PSJOCVAR_PS5345",$J,DUZ,2,"B",PSJBLOOP,PSJCOUNT)
"RTN","PSJOCVAR",60,0)
 K ^TMP("PSJOCVAR_PS5345",$J,DUZ)
"RTN","PSJOCVAR",61,0)
 Q
"RTN","PSJOCVAR",62,0)
LIST ;
"RTN","PSJOCVAR",63,0)
 ;;ADM
"RTN","PSJOCVAR",64,0)
 ;;AL
"RTN","PSJOCVAR",65,0)
 ;;C
"RTN","PSJOCVAR",66,0)
 ;;CHK
"RTN","PSJOCVAR",67,0)
 ;;DDH
"RTN","PSJOCVAR",68,0)
 ;;DFN
"RTN","PSJOCVAR",69,0)
 ;;DN
"RTN","PSJOCVAR",70,0)
 ;;DRGI
"RTN","PSJOCVAR",71,0)
 ;;DRGN
"RTN","PSJOCVAR",72,0)
 ;;DRGT
"RTN","PSJOCVAR",73,0)
 ;;DX
"RTN","PSJOCVAR",74,0)
 ;;DY
"RTN","PSJOCVAR",75,0)
 ;;FIL
"RTN","PSJOCVAR",76,0)
 ;;FQ
"RTN","PSJOCVAR",77,0)
 ;;GMRA
"RTN","PSJOCVAR",78,0)
 ;;GMRAL
"RTN","PSJOCVAR",79,0)
 ;;HDT
"RTN","PSJOCVAR",80,0)
 ;;I
"RTN","PSJOCVAR",81,0)
 ;;INFUSE
"RTN","PSJOCVAR",82,0)
 ;;J
"RTN","PSJOCVAR",83,0)
 ;;LIMIT
"RTN","PSJOCVAR",84,0)
 ;;LINE
"RTN","PSJOCVAR",85,0)
 ;;LOC
"RTN","PSJOCVAR",86,0)
 ;;N
"RTN","PSJOCVAR",87,0)
 ;;NAD
"RTN","PSJOCVAR",88,0)
 ;;ND
"RTN","PSJOCVAR",89,0)
 ;;ND0
"RTN","PSJOCVAR",90,0)
 ;;ND2
"RTN","PSJOCVAR",91,0)
 ;;ND4
"RTN","PSJOCVAR",92,0)
 ;;ND6
"RTN","PSJOCVAR",93,0)
 ;;NDP2
"RTN","PSJOCVAR",94,0)
 ;;NEXT
"RTN","PSJOCVAR",95,0)
 ;;NF
"RTN","PSJOCVAR",96,0)
 ;;NO
"RTN","PSJOCVAR",97,0)
 ;;O
"RTN","PSJOCVAR",98,0)
 ;;ON
"RTN","PSJOCVAR",99,0)
 ;;ON55
"RTN","PSJOCVAR",100,0)
 ;;ORIFN
"RTN","PSJOCVAR",101,0)
 ;;P16
"RTN","PSJOCVAR",102,0)
 ;;P17
"RTN","PSJOCVAR",103,0)
 ;;P(2)
"RTN","PSJOCVAR",104,0)
 ;;P(3)
"RTN","PSJOCVAR",105,0)
 ;;P(4)
"RTN","PSJOCVAR",106,0)
 ;;P(5)
"RTN","PSJOCVAR",107,0)
 ;;P(6)
"RTN","PSJOCVAR",108,0)
 ;;P(7)
"RTN","PSJOCVAR",109,0)
 ;;P(8)
"RTN","PSJOCVAR",110,0)
 ;;P(9)
"RTN","PSJOCVAR",111,0)
 ;;P(10)
"RTN","PSJOCVAR",112,0)
 ;;P(11)
"RTN","PSJOCVAR",113,0)
 ;;P(12)
"RTN","PSJOCVAR",114,0)
 ;;P(13)
"RTN","PSJOCVAR",115,0)
 ;;P(14)
"RTN","PSJOCVAR",116,0)
 ;;P(15)
"RTN","PSJOCVAR",117,0)
 ;;P(16)
"RTN","PSJOCVAR",118,0)
 ;;P(17)
"RTN","PSJOCVAR",119,0)
 ;;P(18)
"RTN","PSJOCVAR",120,0)
 ;;P(19)
"RTN","PSJOCVAR",121,0)
 ;;P(20)
"RTN","PSJOCVAR",122,0)
 ;;P(21)
"RTN","PSJOCVAR",123,0)
 ;;P(22)
"RTN","PSJOCVAR",124,0)
 ;;P(23)
"RTN","PSJOCVAR",125,0)
 ;;P(24)
"RTN","PSJOCVAR",126,0)
 ;;P(25)
"RTN","PSJOCVAR",127,0)
 ;;P("21FLG")
"RTN","PSJOCVAR",128,0)
 ;;P("CLRK")
"RTN","PSJOCVAR",129,0)
 ;;P("CUM")
"RTN","PSJOCVAR",130,0)
 ;;P("DO")
"RTN","PSJOCVAR",131,0)
 ;;P("DTYP")
"RTN","PSJOCVAR",132,0)
 ;;P("FRES")
"RTN","PSJOCVAR",133,0)
 ;;P("INS")
"RTN","PSJOCVAR",134,0)
 ;;P("IVRM")
"RTN","PSJOCVAR",135,0)
 ;;P("LF")
"RTN","PSJOCVAR",136,0)
 ;;P("LFA")
"RTN","PSJOCVAR",137,0)
 ;;P("LOG")
"RTN","PSJOCVAR",138,0)
 ;;P("MR")
"RTN","PSJOCVAR",139,0)
 ;;P("NEWON")
"RTN","PSJOCVAR",140,0)
 ;;P("OLDON")
"RTN","PSJOCVAR",141,0)
 ;;P("OPI")
"RTN","PSJOCVAR",142,0)
 ;;P("OT")
"RTN","PSJOCVAR",143,0)
 ;;P("PD")
"RTN","PSJOCVAR",144,0)
 ;;P("PON")
"RTN","PSJOCVAR",145,0)
 ;;P("PRY")
"RTN","PSJOCVAR",146,0)
 ;;P("REM")
"RTN","PSJOCVAR",147,0)
 ;;P("REN")
"RTN","PSJOCVAR",148,0)
 ;;P("RES")
"RTN","PSJOCVAR",149,0)
 ;;P("SYRS")
"RTN","PSJOCVAR",150,0)
 ;;PF
"RTN","PSJOCVAR",151,0)
 ;;PPAGE
"RTN","PSJOCVAR",152,0)
 ;;PPN
"RTN","PSJOCVAR",153,0)
 ;;PROVIDER
"RTN","PSJOCVAR",154,0)
 ;;PS
"RTN","PSJOCVAR",155,0)
 ;;PSFDT
"RTN","PSJOCVAR",156,0)
 ;;PSGACT
"RTN","PSJOCVAR",157,0)
 ;;PSGADR
"RTN","PSJOCVAR",158,0)
 ;;PSGADR(1)
"RTN","PSJOCVAR",159,0)
 ;;PSGAT
"RTN","PSJOCVAR",160,0)
 ;;PSGCANFL
"RTN","PSJOCVAR",161,0)
 ;;PSGDFLG
"RTN","PSJOCVAR",162,0)
 ;;PSGDI
"RTN","PSJOCVAR",163,0)
 ;;PSGDRG
"RTN","PSJOCVAR",164,0)
 ;;PSGDRGN
"RTN","PSJOCVAR",165,0)
 ;;PSGDO
"RTN","PSJOCVAR",166,0)
 ;;PSGDT
"RTN","PSJOCVAR",167,0)
 ;;PSGEB
"RTN","PSJOCVAR",168,0)
 ;;PSGEBN
"RTN","PSJOCVAR",169,0)
 ;;PSGEFN
"RTN","PSJOCVAR",170,0)
 ;;PSGF
"RTN","PSJOCVAR",171,0)
 ;;PSGFD
"RTN","PSJOCVAR",172,0)
 ;;PSGFDN
"RTN","PSJOCVAR",173,0)
 ;;PSGHSM
"RTN","PSJOCVAR",174,0)
 ;;PSGID
"RTN","PSJOCVAR",175,0)
 ;;PSGIVAC
"RTN","PSJOCVAR",176,0)
 ;;PSGIVBR
"RTN","PSJOCVAR",177,0)
 ;;PSGLAD
"RTN","PSJOCVAR",178,0)
 ;;PSGLAGE
"RTN","PSJOCVAR",179,0)
 ;;PSGLBID
"RTN","PSJOCVAR",180,0)
 ;;PSGLBSS
"RTN","PSJOCVAR",181,0)
 ;;PSGLDOB
"RTN","PSJOCVAR",182,0)
 ;;PSGLDT
"RTN","PSJOCVAR",183,0)
 ;;PSGLDX
"RTN","PSJOCVAR",184,0)
 ;;PSGLI
"RTN","PSJOCVAR",185,0)
 ;;PSGLIN
"RTN","PSJOCVAR",186,0)
 ;;PSGLPID
"RTN","PSJOCVAR",187,0)
 ;;PSGLPN
"RTN","PSJOCVAR",188,0)
 ;;PSGLPR
"RTN","PSJOCVAR",189,0)
 ;;PSGLRB
"RTN","PSJOCVAR",190,0)
 ;;PSGLSEX
"RTN","PSJOCVAR",191,0)
 ;;PSGLSSN
"RTN","PSJOCVAR",192,0)
 ;;PSGLTM
"RTN","PSJOCVAR",193,0)
 ;;PSGLTS
"RTN","PSJOCVAR",194,0)
 ;;PSGLWD
"RTN","PSJOCVAR",195,0)
 ;;PSGLWDN
"RTN","PSJOCVAR",196,0)
 ;;PSGLWGN
"RTN","PSJOCVAR",197,0)
 ;;PSGLWP1
"RTN","PSJOCVAR",198,0)
 ;;PSGLWP2
"RTN","PSJOCVAR",199,0)
 ;;PSGMR
"RTN","PSJOCVAR",200,0)
 ;;PSGMRN
"RTN","PSJOCVAR",201,0)
 ;;PSGNEDFD
"RTN","PSJOCVAR",202,0)
 ;;PSGNEF
"RTN","PSJOCVAR",203,0)
 ;;PSGNESD
"RTN","PSJOCVAR",204,0)
 ;;PSGOAT
"RTN","PSJOCVAR",205,0)
 ;;PSGOD
"RTN","PSJOCVAR",206,0)
 ;;PSGODDD
"RTN","PSJOCVAR",207,0)
 ;;PSGODDD(1)
"RTN","PSJOCVAR",208,0)
 ;;PSGODO
"RTN","PSJOCVAR",209,0)
 ;;PSGODT
"RTN","PSJOCVAR",210,0)
 ;;PSGOEA
"RTN","PSJOCVAR",211,0)
 ;;PSGOEAV
"RTN","PSJOCVAR",212,0)
 ;;PSGOEDMR
"RTN","PSJOCVAR",213,0)
 ;;PSGOEEG
"RTN","PSJOCVAR",214,0)
 ;;PSGOEEND
"RTN","PSJOCVAR",215,0)
 ;;PSGOEEWF
"RTN","PSJOCVAR",216,0)
 ;;PSGOENG
"RTN","PSJOCVAR",217,0)
 ;;PSGOENOF
"RTN","PSJOCVAR",218,0)
 ;;PSGOEPR
"RTN","PSJOCVAR",219,0)
 ;;PSGOFD
"RTN","PSJOCVAR",220,0)
 ;;PSGOFDN
"RTN","PSJOCVAR",221,0)
 ;;PSGOHSM
"RTN","PSJOCVAR",222,0)
 ;;PSGOINST
"RTN","PSJOCVAR",223,0)
 ;;PSGOL
"RTN","PSJOCVAR",224,0)
 ;;PSGOMR
"RTN","PSJOCVAR",225,0)
 ;;PSGOMRN
"RTN","PSJOCVAR",226,0)
 ;;PSGONC
"RTN","PSJOCVAR",227,0)
 ;;PSGOP
"RTN","PSJOCVAR",228,0)
 ;;PSGOPD
"RTN","PSJOCVAR",229,0)
 ;;PSGOPDN
"RTN","PSJOCVAR",230,0)
 ;;PSGOPR
"RTN","PSJOCVAR",231,0)
 ;;PSGOPRN
"RTN","PSJOCVAR",232,0)
 ;;PSGORD
"RTN","PSJOCVAR",233,0)
 ;;PSGOSCH
"RTN","PSJOCVAR",234,0)
 ;;PSGOSD
"RTN","PSJOCVAR",235,0)
 ;;PSGOSDN
"RTN","PSJOCVAR",236,0)
 ;;PSGOSI
"RTN","PSJOCVAR",237,0)
 ;;PSGOSM
"RTN","PSJOCVAR",238,0)
 ;;PSGOST
"RTN","PSJOCVAR",239,0)
 ;;PSGOSTN
"RTN","PSJOCVAR",240,0)
 ;;PSGP
"RTN","PSJOCVAR",241,0)
 ;;PSGP(0)
"RTN","PSJOCVAR",242,0)
 ;;PSGPD
"RTN","PSJOCVAR",243,0)
 ;;PSGPDN
"RTN","PSJOCVAR",244,0)
 ;;PSGPDRG
"RTN","PSJOCVAR",245,0)
 ;;PSGPDRGN
"RTN","PSJOCVAR",246,0)
 ;;PSGPI
"RTN","PSJOCVAR",247,0)
 ;;PSGPR
"RTN","PSJOCVAR",248,0)
 ;;PSGPRIO
"RTN","PSJOCVAR",249,0)
 ;;PSGPRN
"RTN","PSJOCVAR",250,0)
 ;;PSGPTMP
"RTN","PSJOCVAR",251,0)
 ;;PSGPTS
"RTN","PSJOCVAR",252,0)
 ;;PSGPXN
"RTN","PSJOCVAR",253,0)
 ;;PSGRRF
"RTN","PSJOCVAR",254,0)
 ;;PSGSCH
"RTN","PSJOCVAR",255,0)
 ;;PSGSD
"RTN","PSJOCVAR",256,0)
 ;;PSGSDN
"RTN","PSJOCVAR",257,0)
 ;;PSGSI
"RTN","PSJOCVAR",258,0)
 ;;PSGSM
"RTN","PSJOCVAR",259,0)
 ;;PSGSOXT
"RTN","PSJOCVAR",260,0)
 ;;PSGSOY
"RTN","PSJOCVAR",261,0)
 ;;PSGS0Y
"RTN","PSJOCVAR",262,0)
 ;;PSGSS
"RTN","PSJOCVAR",263,0)
 ;;PSGSSH
"RTN","PSJOCVAR",264,0)
 ;;PSGST
"RTN","PSJOCVAR",265,0)
 ;;PSGSTAT
"RTN","PSJOCVAR",266,0)
 ;;PSGSTN
"RTN","PSJOCVAR",267,0)
 ;;PSGVADR
"RTN","PSJOCVAR",268,0)
 ;;PSGVALG
"RTN","PSJOCVAR",269,0)
 ;;PSGVBPN
"RTN","PSJOCVAR",270,0)
 ;;PSGVBTM
"RTN","PSJOCVAR",271,0)
 ;;PSGVBWN
"RTN","PSJOCVAR",272,0)
 ;;PSGVBWW
"RTN","PSJOCVAR",273,0)
 ;;PSGVBY
"RTN","PSJOCVAR",274,0)
 ;;PSIVAC
"RTN","PSJOCVAR",275,0)
 ;;PSIVBR
"RTN","PSJOCVAR",276,0)
 ;;PSIVDT
"RTN","PSJOCVAR",277,0)
 ;;PSIVON
"RTN","PSJOCVAR",278,0)
 ;;PSIVOF
"RTN","PSJOCVAR",279,0)
 ;;PSIVOV1
"RTN","PSJOCVAR",280,0)
 ;;PSIVOV2
"RTN","PSJOCVAR",281,0)
 ;;PSIV
"RTN","PSJOCVAR",282,0)
 ;;PSIVORF
"RTN","PSJOCVAR",283,0)
 ;;PSIVPL
"RTN","PSJOCVAR",284,0)
 ;;PSIVPR
"RTN","PSJOCVAR",285,0)
 ;;PSIVRD
"RTN","PSJOCVAR",286,0)
 ;;PSIVREA
"RTN","PSJOCVAR",287,0)
 ;;PSIVSITE
"RTN","PSJOCVAR",288,0)
 ;;PSIVSN
"RTN","PSJOCVAR",289,0)
 ;;PSIVST
"RTN","PSJOCVAR",290,0)
 ;;PSIVUP
"RTN","PSJOCVAR",291,0)
 ;;PSIVX1
"RTN","PSJOCVAR",292,0)
 ;;PSIVX2
"RTN","PSJOCVAR",293,0)
 ;;PSJ
"RTN","PSJOCVAR",294,0)
 ;;PSJAC
"RTN","PSJOCVAR",295,0)
 ;;PSJACND
"RTN","PSJOCVAR",296,0)
 ;;PSJACNWP
"RTN","PSJOCVAR",297,0)
 ;;PSJACOK
"RTN","PSJOCVAR",298,0)
 ;;PSJACPF
"RTN","PSJOCVAR",299,0)
 ;;PSJASK
"RTN","PSJOCVAR",300,0)
 ;;PSJCNT
"RTN","PSJOCVAR",301,0)
 ;;PSJCOM
"RTN","PSJOCVAR",302,0)
 ;;PSJF
"RTN","PSJOCVAR",303,0)
 ;;PSJHLMTN
"RTN","PSJOCVAR",304,0)
 ;;PSJINDEX
"RTN","PSJOCVAR",305,0)
 ;;PSJIVOF
"RTN","PSJOCVAR",306,0)
 ;;PSJIVORF
"RTN","PSJOCVAR",307,0)
 ;;PSJL
"RTN","PSJOCVAR",308,0)
 ;;PSJLABEL
"RTN","PSJOCVAR",309,0)
 ;;PSJLK
"RTN","PSJOCVAR",310,0)
 ;;PSJLM
"RTN","PSJOCVAR",311,0)
 ;;PSJLMCON
"RTN","PSJOCVAR",312,0)
 ;;PSJLMPRO
"RTN","PSJOCVAR",313,0)
 ;;PSJLN
"RTN","PSJOCVAR",314,0)
 ;;PSJNARC
"RTN","PSJOCVAR",315,0)
 ;;PSJNV
"RTN","PSJOCVAR",316,0)
 ;;PSJO
"RTN","PSJOCVAR",317,0)
 ;;PSJOCNT
"RTN","PSJOCVAR",318,0)
 ;;PSJOE
"RTN","PSJOCVAR",319,0)
 ;;PSJOEPF
"RTN","PSJOCVAR",320,0)
 ;;PSJOL
"RTN","PSJOCVAR",321,0)
 ;;PSJORD
"RTN","PSJOCVAR",322,0)
 ;;PSJORF
"RTN","PSJOCVAR",323,0)
 ;;PSJORIFN
"RTN","PSJOCVAR",324,0)
 ;;PSJORL
"RTN","PSJOCVAR",325,0)
 ;;PSJORQF
"RTN","PSJOCVAR",326,0)
 ;;PSJORVP
"RTN","PSJOCVAR",327,0)
 ;;PSJOS
"RTN","PSJOCVAR",328,0)
 ;;PSJPAC
"RTN","PSJOCVAR",329,0)
 ;;PSJPAD
"RTN","PSJOCVAR",330,0)
 ;;PSJPAGE
"RTN","PSJOCVAR",331,0)
 ;;PSJPBID
"RTN","PSJOCVAR",332,0)
 ;;PSJPCAF
"RTN","PSJOCVAR",333,0)
 ;;PSJPDD
"RTN","PSJOCVAR",334,0)
 ;;PSJPDOB
"RTN","PSJOCVAR",335,0)
 ;;PSJPDT
"RTN","PSJOCVAR",336,0)
 ;;PSJPDX
"RTN","PSJOCVAR",337,0)
 ;;PSJPEN
"RTN","PSJOCVAR",338,0)
 ;;PSJPHT
"RTN","PSJOCVAR",339,0)
 ;;PSJPHTD
"RTN","PSJOCVAR",340,0)
 ;;PSJPN
"RTN","PSJOCVAR",341,0)
 ;;PSJPPID
"RTN","PSJOCVAR",342,0)
 ;;PSJPRB
"RTN","PSJOCVAR",343,0)
 ;;PSJPROT
"RTN","PSJOCVAR",344,0)
 ;;PSJPSEX
"RTN","PSJOCVAR",345,0)
 ;;PSJPSSN
"RTN","PSJOCVAR",346,0)
 ;;PSJP
"RTN","PSJOCVAR",347,0)
 ;;PSJPTS
"RTN","PSJOCVAR",348,0)
 ;;PSJPTSP
"RTN","PSJOCVAR",349,0)
 ;;PSJPWD
"RTN","PSJOCVAR",350,0)
 ;;PSJPWDN
"RTN","PSJOCVAR",351,0)
 ;;PSJPWT
"RTN","PSJOCVAR",352,0)
 ;;PSJPWTD
"RTN","PSJOCVAR",353,0)
 ;;PSJSCHT
"RTN","PSJOCVAR",354,0)
 ;;PSJSEL
"RTN","PSJOCVAR",355,0)
 ;;PSJSEL1
"RTN","PSJOCVAR",356,0)
 ;;PSJSTOP
"RTN","PSJOCVAR",357,0)
 ;;PSJSYSL
"RTN","PSJOCVAR",358,0)
 ;;PSJSYSP
"RTN","PSJOCVAR",359,0)
 ;;PSJSYSP0
"RTN","PSJOCVAR",360,0)
 ;;PSJSYSU
"RTN","PSJOCVAR",361,0)
 ;;PSJSYSW
"RTN","PSJOCVAR",362,0)
 ;;PSJSYSW0
"RTN","PSJOCVAR",363,0)
 ;;PSJTF
"RTN","PSJOCVAR",364,0)
 ;;PSJTOO
"RTN","PSJOCVAR",365,0)
 ;;PSJUDPRF
"RTN","PSJOCVAR",366,0)
 ;;PSJX
"RTN","PSJOCVAR",367,0)
 ;;PSSPSP0
"RTN","PSJOCVAR",368,0)
 ;;Q
"RTN","PSJOCVAR",369,0)
 ;;QQ
"RTN","PSJOCVAR",370,0)
 ;;QUD
"RTN","PSJOCVAR",371,0)
 ;;QUX1
"RTN","PSJOCVAR",372,0)
 ;;RTE
"RTN","PSJOCVAR",373,0)
 ;;SCH
"RTN","PSJOCVAR",374,0)
 ;;SD
"RTN","PSJOCVAR",375,0)
 ;;SEGMENT(0)
"RTN","PSJOCVAR",376,0)
 ;;SM
"RTN","PSJOCVAR",377,0)
 ;;ST
"RTN","PSJOCVAR",378,0)
 ;;START
"RTN","PSJOCVAR",379,0)
 ;;STAT
"RTN","PSJOCVAR",380,0)
 ;;STATUS
"RTN","PSJOCVAR",381,0)
 ;;STOP
"RTN","PSJOCVAR",382,0)
 ;;STT
"RTN","PSJOCVAR",383,0)
 ;;SUB
"RTN","PSJOCVAR",384,0)
 ;;TYPE
"RTN","PSJOCVAR",385,0)
 ;;UDU
"RTN","PSJOCVAR",386,0)
 ;;V
"RTN","PSJOCVAR",387,0)
 ;;VA200
"RTN","PSJOCVAR",388,0)
 ;;VADM
"RTN","PSJOCVAR",389,0)
 ;;VAIN
"RTN","PSJOCVAR",390,0)
 ;;VAIP
"RTN","PSJOCVAR",391,0)
 ;;VALMCNT
"RTN","PSJOCVAR",392,0)
 ;;VALM("TITLE")
"RTN","PSJOCVAR",393,0)
 ;;WRD
"RTN","PSJOCVAR",394,0)
 ;;WS
"RTN","PSJOCVAR",395,0)
 ;;X
"RTN","PSJOCVAR",396,0)
 ;;X3
"RTN","PSJOCVAR",397,0)
 ;;X4
"RTN","PSJOCVAR",398,0)
 ;;X5
"RTN","PSJOCVAR",399,0)
 ;;XRTN
"RTN","PSJOCVAR",400,0)
 ;;Y
"RTN","PSJOE")
0^72^B83867833
"RTN","PSJOE",1,0)
PSJOE ;BIR/MLM-INPATIENT ORDER ENTRY ;23 Jun 98 / 1:46 PM
"RTN","PSJOE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,26,29,33,42,50,56,72,58,85,95,80,110,111,133,140,151,149,181**;16 DEC 97;Build 190
"RTN","PSJOE",3,0)
 ;
"RTN","PSJOE",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJOE",5,0)
 ; Reference to EN^VALM is supported by DBIA #10118.
"RTN","PSJOE",6,0)
 ; Reference to FULL^VALM1 and PAUSE^VALM1 is supported by DBIA #10116.
"RTN","PSJOE",7,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSJOE",8,0)
 ; Reference to ^DPT is supported by DBIA #10035.
"RTN","PSJOE",9,0)
 ; Reference to ^ORCFLAG is supported by DBIA #3620.
"RTN","PSJOE",10,0)
 ; Reference to ^SDAMA203 is supported by DBIA #4133.
"RTN","PSJOE",11,0)
 ;
"RTN","PSJOE",12,0)
EN ; Start Inpatient LM OE
"RTN","PSJOE",13,0)
 N PSJLK,PSJNEWOE,PSJLMCON,PSJPROT,XQORS,VALMEVL D ENCV^PSGSETU,^PSIVXU
"RTN","PSJOE",14,0)
 I $D(XQUIT) K XQUIT G DONE
"RTN","PSJOE",15,0)
 K PSGVBY,PSJPR S (PSJOL,PSJACOK,PSGOP,PSGNEF,PSGOEAV,PSGPXN)="" L +^PS(53.45,PSJSYSP):1 E  D LOCKERR^PSJOE G DONE^PSJOE
"RTN","PSJOE",16,0)
 F  S (PSJLMCON,PSGPTMP)=0 D ^PSJP,HK Q:PSGP'>0  S PSJPROT=3,DFN=PSGP D ^PSJAC D  I PSJLK D UL^PSSLOCK(PSGP)
"RTN","PSJOE",17,0)
 .K ^TMP("PSJ",$J)
"RTN","PSJOE",18,0)
 .S PSJLK=$$L^PSSLOCK(PSGP,1) I 'PSJLK W !,$C(7),$P(PSJLK,U,2) Q
"RTN","PSJOE",19,0)
 .K PSJLMPRO D EN^VALM("PSJ LM BRIEF PATIENT INFO")
"RTN","PSJOE",20,0)
 .N NXTPT S NXTPT=0 F  Q:$G(NXTPT)  D
"RTN","PSJOE",21,0)
 ..K PSGRDTX
"RTN","PSJOE",22,0)
 ..I $G(PSJLMCON)!$G(PSJNEWOE) D
"RTN","PSJOE",23,0)
 ...S PSJOL=$S(",S,L,"[(","_$G(PSJOL)_","):PSJOL,1:"S")
"RTN","PSJOE",24,0)
 ...S PSJLMPRO=1,PSJLMCON=1,PSJNEWOE=0 D EN^VALM("PSJ LM OE")
"RTN","PSJOE",25,0)
 ..I $G(PSJNEWOE)!($G(VALMBCK)="Q") S PSJNEWOE=0 Q
"RTN","PSJOE",26,0)
 ..I $G(PSJLMCON)&$G(PSJLMPRO)&'$D(^TMP("PSJ",$J)) D  Q
"RTN","PSJOE",27,0)
 ...S PSJLMCON=0,PSJLMPRO=0 D EN^VALM("PSJ LM BRIEF PATIENT INFO")
"RTN","PSJOE",28,0)
 ...I $G(PSJNEWOE) S NXTPT=0 Q
"RTN","PSJOE",29,0)
 ...S NXTPT=1
"RTN","PSJOE",30,0)
 ..S NXTPT=1,PSJNEWOE=0
"RTN","PSJOE",31,0)
 .S PSJOL="S"
"RTN","PSJOE",32,0)
 .I $G(PSGPXN) I $P(PSJSYSW0,U,29)]""!($G(PSJCOM)) S PSGPXPT=PSGP D  K PSGPXPT S PSGPXN=0
"RTN","PSJOE",33,0)
 ..N DFN,PSGP,PSJPXDP
"RTN","PSJOE",34,0)
 ..I $P(PSJSYSW0,U,29)="" S PSJPDXP=1 D
"RTN","PSJOE",35,0)
 ...;N IO,ION,IOS D HOME^%ZIS S $P(PSJSYSW0,U,29)=+$G(IOS)
"RTN","PSJOE",36,0)
 ...D HOME^%ZIS S $P(PSJSYSW0,U,29)=+$G(IOS)
"RTN","PSJOE",37,0)
 ..S (PSGP,DFN)=PSGPXPT D ^PSGPER S:$G(PSJPDXP) $P(PSJSYSW0,U,29)="" K PSJPDXP
"RTN","PSJOE",38,0)
 .D ENCV^PSGSETU,^PSIVXU
"RTN","PSJOE",39,0)
 K PSJLMPRO,^TMP("PSJPRO",$J),^TMP("PSJ",$J),^TMP("PSJON",$J)
"RTN","PSJOE",40,0)
DONE ;
"RTN","PSJOE",41,0)
 K PSJEXCPT,PSJOCER,^TMP($J,"PSJPRE")
"RTN","PSJOE",42,0)
 K AC,ACTION,D1,D2,MI,N,ON,P3,PNOW,PSIVAT,PSIVLN,PSIVSTR L -^PS(53.45,PSJSYSP)
"RTN","PSJOE",43,0)
 K DA,DRG,NE,PSGCF,PSGCANFL,PSGNEDFD,PSGNEF,PSGNEFD,PSGNEPR,PSGNESD,PSJACOK,PSJOE,PSJOECNT,PSJOEPF,PSJORD,PSGOEA,PSGOEAV,PSGOL,PSGOS,PSGON,PSGOP,PSGORD,PSGS0XT,PSGS0Y,RCT,ST,WD,XREF,Z,PSJIVORF,PSJIVPCL
"RTN","PSJOE",44,0)
 K PSGOEORF,PSIVREA,PSJOPC,PSJORL,PSJORPCL,PSJORTOI,RF,WSCHADM,PSJLM,PSJCT
"RTN","PSJOE",45,0)
 K DIU,DRGI,FLAG,FQC,ND2,PRI,PSGOE,PSGPRI,PSGSDN,PSGOEDMR,PSGOEPR,PSGPTS,PSGTOL,PSGTOO,PSGUOW,PSJIVOF,PSJOCNT,PSJON,PSJORQF,PSJORTOU,PSJORVP
"RTN","PSJOE",46,0)
 G:$G(PSGPXN) ^PSGPER1 D ENIVKV^PSGSETU
"RTN","PSJOE",47,0)
 Q
"RTN","PSJOE",48,0)
HK ; Housekeeping (a nice COBOL term)
"RTN","PSJOE",49,0)
 I PSGOP,PSGOP'=PSGP D
"RTN","PSJOE",50,0)
 .N PSJACPF,PSJACNWP,PSJPWD,PSJSYSL,PSJSYSW,PSJSYSW0,DFN,VAIN,VAERR S DFN=PSGOP
"RTN","PSJOE",51,0)
 .D INP^VADPT S PSJPWD=+VAIN(4) I PSJPWD S PSJACPF=10 D WP^PSJAC D:$P(PSJSYSL,"^",2)]"" ENQL^PSGLW
"RTN","PSJOE",52,0)
 Q:PSGP<0
"RTN","PSJOE",53,0)
 S (DFN,PSGOP)=PSGP,X=""
"RTN","PSJOE",54,0)
 Q
"RTN","PSJOE",55,0)
SELECT ; Select order from list
"RTN","PSJOE",56,0)
 ;Variable PSJOCDSC is used in Complex order dosing checks
"RTN","PSJOE",57,0)
 N PSGLMT,PSGODDD,PSJLMQT,PSJLMFIN,PSJUDPRF,PSGRDTX,PSJOCDSC K ^TMP("PSJCOM",$J),^TMP("PSJCOM2",$J)
"RTN","PSJOE",58,0)
 S PSGONC=1,PSGLMT=^TMP("PSJPRO",$J,0) D ENASR^PSGON
"RTN","PSJOE",59,0)
 I "^"[X S VALMQUIT=1 Q
"RTN","PSJOE",60,0)
 S PSJLM=1,PSJSEL=0 F  S PSJSEL=$O(PSGODDD(PSJSEL)) Q:'PSJSEL!($G(Y)<0)  F PSJSEL1=1:1:$L(PSGODDD(PSJSEL),",")-1 D
"RTN","PSJOE",61,0)
 .K PSJOCDSC
"RTN","PSJOE",62,0)
 .S PSJORD=$G(^TMP("PSJON",$J,+$P(PSGODDD(PSJSEL),",",PSJSEL1))) D:PSJORD=+PSJORD SELECT^PSJOEA Q:PSJORD=""!($G(Y)<0)  Q:PSJORD=+PSJORD  D
"RTN","PSJOE",63,0)
 ..Q:('$$LS^PSSLOCK(PSGP,PSJORD))
"RTN","PSJOE",64,0)
 ..Q:PSJORD=+PSJORD
"RTN","PSJOE",65,0)
 ..S PSGORD=""
"RTN","PSJOE",66,0)
 ..D DISACTIO(PSGP,PSJORD,"") S:PSJORD["V" PSJORD=ON
"RTN","PSJOE",67,0)
 ..D UNL^PSSLOCK(PSGP,PSJORD) Q:$G(Y)<0
"RTN","PSJOE",68,0)
 S VALMBCK="Q"
"RTN","PSJOE",69,0)
 K PSJLM,PSJOCDSC
"RTN","PSJOE",70,0)
 Q
"RTN","PSJOE",71,0)
DISACTIO(DFN,PSJORD,PSJPNV)       ; Display UD order and allow actions.
"RTN","PSJOE",72,0)
 ; PSJORD - Order #_location Code (P:53.1,V:55.01,U:55.06)
"RTN","PSJOE",73,0)
 ; PSJPNV - Invoked from Pending/NV option; (gets different hidden menu)
"RTN","PSJOE",74,0)
 N PSGP,PSJIVFLG,PSGSDX,PSGFDX,PSJXX1,ON55
"RTN","PSJOE",75,0)
 D OLDCOM^PSJOE0(DFN,PSJORD)
"RTN","PSJOE",76,0)
 S PSGP=DFN D ENIV^PSJAC I PSJORD["V" D EN^PSJLIORD(DFN,PSJORD) Q
"RTN","PSJOE",77,0)
 D GETUD^PSJLMGUD(DFN,PSJORD)
"RTN","PSJOE",78,0)
 S PSGOEAV=$P(PSJSYSP0,"^",9)&PSJSYSU
"RTN","PSJOE",79,0)
 S:$G(PSJTUD) PSGPD=$G(PSJCOI),PSGPDN=$$OINAME^PSJLMUTL(+PSGPD)
"RTN","PSJOE",80,0)
 K PSGOENG I '$D(PSGPRF) D  Q:$G(PSGOENG)
"RTN","PSJOE",81,0)
 . I PSJORD["U" L +^PS(55,PSGP,5,+PSJORD):1 E  S PSGOENG=1
"RTN","PSJOE",82,0)
 . I PSJORD["P" L +^PS(53.1,+PSJORD):1 E  S PSGOENG=1
"RTN","PSJOE",83,0)
 . I $G(PSGOENG) W !,"This order is being edited by another terminal.",! S PSGOENG=1 K DIR S DIR(0)="E" D ^DIR K DIR Q
"RTN","PSJOE",84,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSJORD)
"RTN","PSJOE",85,0)
 I PSJORD["P" S PSJXX1=$G(^PS(53.1,+PSJORD,0)) I PSGP'=$P(PSJXX1,U,15)!(DFN'=$P(PSJXX1,U,15)) L -^PS(53.1,+PSJORD) Q
"RTN","PSJOE",86,0)
 I PSJORD["P" D  S PSJXX1=$P($G(^PS(53.1,+PSJORD,0)),U,9) I $S($G(PSJIVFLG):1,$G(Y)<0:1,"PADE"[PSJXX1:1,1:0) L -^PS(53.1,+PSJORD) Q
"RTN","PSJOE",87,0)
 .I $P(PSJXX1,U,9)="N",($P(PSJXX1,U,4)'="U") D  Q
"RTN","PSJOE",88,0)
 .. S P("PON")=PSJORD,PSIVFLG=1
"RTN","PSJOE",89,0)
 .. N ON S ON=PSJORD D VF^PSIVORC2
"RTN","PSJOE",90,0)
 .I $P(PSJXX1,U,9)="P" D  Q
"RTN","PSJOE",91,0)
 ..S:$G(PSJTUD) $P(PSJXX1,U,4)="U"
"RTN","PSJOE",92,0)
 ..I $P(PSJXX1,U,4)="U" D  Q:$G(PSJIVFLG)
"RTN","PSJOE",93,0)
 ... N VAIP S CLINIC=$G(^PS(53.1,+PSJORD,"DSS")),APPT=$P(CLINIC,"^",2),CLINIC=$P(CLINIC,"^") I $$PATCH^XPDUTL("SD*5.3*285"),$$SDIMO^SDAMA203(CLINIC,DFN)>-1 Q
"RTN","PSJOE",94,0)
 ... Q:'PSJPDD  W !!,"Cannot process an Out-patient Unit Dose order for ",$P($G(^DPT(+PSGP,0)),U) D PAUSE^VALM1 S PSJIVFLG=1
"RTN","PSJOE",95,0)
 ..NEW PSGRSD,PSGRSDN,PSGRFD,PSGRFDN
"RTN","PSJOE",96,0)
 ..D REQDT^PSJLIVMD(PSJORD)
"RTN","PSJOE",97,0)
 ..I $P(PSJXX1,U,4)="U",($G(PSGSCH)="") W !!,"Invalid schedule, can't finish this order" D PAUSE^VALM1 Q
"RTN","PSJOE",98,0)
 ..I $P(PSJXX1,U,4)="U" N PSJLM S PSJLM=1,PSGORD=PSJORD D START^PSGOEF,ENSFE^PSGOEE0(PSGP,PSGORD),@$S($G(PSJTUD):"FINISH^PSGOEF",1:"EN^VALM(""PSJ LM PENDING EDIT"")") Q
"RTN","PSJOE",99,0)
 ..I $P(PSJXX1,U,4)'="U",PSGP=$P(PSJXX1,U,15),DFN=$P(PSJXX1,U,15) S PSJLYN=PSJORD D EN^PSJLIFN S PSJIVFLG=1 K PSJLYN,PSJMAI
"RTN","PSJOE",100,0)
 I $G(PSIVFLG) K PSIVFLG Q
"RTN","PSJOE",101,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSJORD),PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSJORD),ENSFE^PSGOEE0(PSGP,PSJORD),EN^VALM("PSJ LM UD ACTION")
"RTN","PSJOE",102,0)
 I PSJORD["P" L -^PS(53.1,+PSJORD)
"RTN","PSJOE",103,0)
 I PSJORD["U" L -^PS(55,PSGP,5,+PSJORD)
"RTN","PSJOE",104,0)
 ;Send SN to CPRS if auto-verify OFF and Order Set Entry and no 21st piece
"RTN","PSJOE",105,0)
 S PSGOEAV=$P(PSJSYSP0,"^",9)&PSJSYSU
"RTN","PSJOE",106,0)
 I $D(PSGOES),'PSGOEAV,$D(PSGORD),PSGORD["P",$P($G(^PS(53.1,+PSGORD,0)),"^",21)']"" D ORSET^PSGOETO1
"RTN","PSJOE",107,0)
 D UNL^PSSLOCK(PSGP,PSJORD)
"RTN","PSJOE",108,0)
 Q
"RTN","PSJOE",109,0)
EDIT(PSGP,PSGORD,PROMPT) ;
"RTN","PSJOE",110,0)
 I "DE"[$$GTSTATUS(PSGP,PSGORD) W !,"This order may not be edited." D PAUSE^VALM1 Q
"RTN","PSJOE",111,0)
 I PSGACT'["E" W !,"This order may not be edited." D PAUSE^VALM1 Q
"RTN","PSJOE",112,0)
 S PSGNEDFD="" D HOLDHDR,@$S('PROMPT:"ENEFA2^PSGON",1:"ENEFA^PSGON") I 'Y D ABORT^PSGOEE Q
"RTN","PSJOE",113,0)
 I PSGORD["P" D ENF^PSGOEE Q
"RTN","PSJOE",114,0)
 D ACT^PSGOEE
"RTN","PSJOE",115,0)
 Q
"RTN","PSJOE",116,0)
RENEW(PSGP,PSGORD) ;
"RTN","PSJOE",117,0)
 D HOLDHDR
"RTN","PSJOE",118,0)
 I 'PSJSYSU,$P($G(^PS(55,PSGP,5,+PSGORD,4)),U,15),$P($G(^(4)),U,16) W !!,"This order is already marked for renewal!" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","PSJOE",119,0)
 I 'PSGRRF D ^PSGOER Q
"RTN","PSJOE",120,0)
 D ^PSGOERI
"RTN","PSJOE",121,0)
 Q
"RTN","PSJOE",122,0)
GTSTATUS(DFN,ON)   ;
"RTN","PSJOE",123,0)
 I ON["P" Q $P($G(^PS(53.1,+ON,0)),U,9)
"RTN","PSJOE",124,0)
 I ON["U" Q $P($G(^PS(55,DFN,5,+ON,0)),U,9)
"RTN","PSJOE",125,0)
 Q $P($G(^PS(55,DFN,"IV",+ON,0)),U,17)
"RTN","PSJOE",126,0)
DC(DFN,PSJORD) ; DC IV, UD, or pending orders.
"RTN","PSJOE",127,0)
 D HOLDHDR
"RTN","PSJOE",128,0)
 S X=$$GTSTATUS(DFN,PSJORD) I X="D"!(X="DE")!(X="R") W !,$S(X="R":"This order has a pending renewal and cannot be DISCONTINUED.",1:"This order has already been DISCONTINUED.") D PAUSE^VALM1 Q
"RTN","PSJOE",129,0)
 D ENO^PSGOEC(DFN,PSJORD) ;,GETUD^PSJLMGUD(DFN,PSJORD),INIT^PSJLMUDE(DFN,PSJORD) S VALMBCK="Q"
"RTN","PSJOE",130,0)
 S VALMBCK="Q"
"RTN","PSJOE",131,0)
 Q
"RTN","PSJOE",132,0)
HOLD(DFN,PSJORD) ; Change order's status from ACTIVE<->HOLD
"RTN","PSJOE",133,0)
 D HOLDHDR
"RTN","PSJOE",134,0)
 I PSJORD["V" D H^PSIVOPT(DFN,PSJORD,P(17),P(3))
"RTN","PSJOE",135,0)
 I PSJORD'["V" D H^PSGOE1(DFN,PSJORD)
"RTN","PSJOE",136,0)
 D GETUD^PSJLMGUD(DFN,PSJORD),INIT^PSJLMUDE(DFN,PSJORD) S PSGACT=$$ENACTION^PSGOE1(DFN,PSJORD),VALMBCK="R"
"RTN","PSJOE",137,0)
 Q
"RTN","PSJOE",138,0)
COPY(PSGP,PSGORD)  ; Copy an order (does not discontinue original order)
"RTN","PSJOE",139,0)
 I $D(PSGCOPY) W !!,"You cannot copy the order at this time" D PAUSE^VALM1 Q
"RTN","PSJOE",140,0)
 I PSGORD["P" W !!,"You cannot copy this "_$S($G(PSGSTAT)]"":PSGSTAT,1:"PENDING IV")_" order." D PAUSE^VALM1 Q
"RTN","PSJOE",141,0)
 I PSGORD["V" D  Q
"RTN","PSJOE",142,0)
 .I $G(PSIVCOPY) W !!,"You cannot copy the order at this time" D PAUSE^VALM1 Q
"RTN","PSJOE",143,0)
 .D COPY^PSIVOD(PSGP,PSGORD) Q
"RTN","PSJOE",144,0)
 Q:'$$HIDDEN^PSJLMUTL("COPY")
"RTN","PSJOE",145,0)
 D ^PSJHVARS
"RTN","PSJOE",146,0)
 I $P($G(^PS(55,PSGP,5,+PSGORD,.2)),U,4)="D",'$P($G(^(4)),"^",3) W !!,"Nurse verified orders with a priority of DONE may not be Copied." D PAUSE^VALM1 Q
"RTN","PSJOE",147,0)
 S PSGOEAV=$P(PSJSYSP0,U,9)&PSJSYSU
"RTN","PSJOE",148,0)
 S PSGCOPY=1
"RTN","PSJOE",149,0)
 D FULL^VALM1,^PSGOD
"RTN","PSJOE",150,0)
 S VALMBCK="R"
"RTN","PSJOE",151,0)
 K PSGCOPY
"RTN","PSJOE",152,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSGORD) ; resets PSGACT after copy
"RTN","PSJOE",153,0)
 I $G(PSGPXN) N PSGTMPXN S PSGTMPXN=PSGPXN
"RTN","PSJOE",154,0)
 D RESTORE^PSJHVARS I $G(PSGTMPXN) S PSGPXN=PSGTMPXN
"RTN","PSJOE",155,0)
 Q
"RTN","PSJOE",156,0)
UPDATE ; Refresh array, actions, & display.
"RTN","PSJOE",157,0)
 D GETUD^PSJLMGUD(DFN,ON),INIT^PSJLMUDE(DFN,ON) S VALMBCK="R"
"RTN","PSJOE",158,0)
 Q
"RTN","PSJOE",159,0)
FINISH ;
"RTN","PSJOE",160,0)
 D FINISH^PSGOEF,PAUSE^VALM1
"RTN","PSJOE",161,0)
 Q
"RTN","PSJOE",162,0)
LOG(DFN,PSGORD)        ;
"RTN","PSJOE",163,0)
 D FULL^VALM1,ENLM^PSGOEL(DFN,PSGORD),PAUSE^VALM1 S VALMBCK="R"
"RTN","PSJOE",164,0)
 Q
"RTN","PSJOE",165,0)
NEWSEL ;
"RTN","PSJOE",166,0)
 N PSGLMT,PSGODDD,PSJLMQT,PSJLMFIN,PSJUDPRF,PSGRDTX,PSJOCDSC K ^TMP("PSJCOM",$J),^TMP("PSJCOM2",$J)
"RTN","PSJOE",167,0)
 S X=$P(XQORNOD(0),"=",2)
"RTN","PSJOE",168,0)
 S PSGONC=1,PSGLMT=^TMP("PSJPRO",$J,0)
"RTN","PSJOE",169,0)
 D ENCHK^PSGON I '$O(PSGODDD(0)) S VALMQUIT=1 Q
"RTN","PSJOE",170,0)
 S PSJLM=1,PSJSEL=0 F  S PSJSEL=$O(PSGODDD(PSJSEL)) Q:'PSJSEL  F PSJSEL1=1:1:$L(PSGODDD(PSJSEL),",")-1 D
"RTN","PSJOE",171,0)
 .K PSJOCDSC
"RTN","PSJOE",172,0)
 .S PSJORD=$G(^TMP("PSJON",$J,+$P(PSGODDD(PSJSEL),",",PSJSEL1))) D:PSJORD=+PSJORD SELECT^PSJOEA
"RTN","PSJOE",173,0)
 .Q:PSJORD=+PSJORD 
"RTN","PSJOE",174,0)
 .Q:PSJORD=""!($G(Y)<0)  Q:('$$LS^PSSLOCK(PSGP,PSJORD))  D
"RTN","PSJOE",175,0)
 ..S PSGORD=""
"RTN","PSJOE",176,0)
 ..S ON=PSJORD
"RTN","PSJOE",177,0)
 ..D DISACTIO(PSGP,PSJORD,$G(PSJPNV)) S:PSJORD["V" PSJORD=ON
"RTN","PSJOE",178,0)
 ..D UNL^PSSLOCK(PSGP,PSJORD)
"RTN","PSJOE",179,0)
 ..I $G(PSJNOL) K PSJNOL I $D(ON),ON'=PSJORD D UNL^PSSLOCK(PSGP,ON)
"RTN","PSJOE",180,0)
 ..Q:$G(Y)<0
"RTN","PSJOE",181,0)
 S VALMBCK="Q"
"RTN","PSJOE",182,0)
 K PSJLM,PSJOCDSC
"RTN","PSJOE",183,0)
 Q
"RTN","PSJOE",184,0)
HOLDHDR ; Freeze header text while processing order actions
"RTN","PSJOE",185,0)
 I $D(VALM("TM")) S IOTM=VALM("TM"),IOBM=IOSL W IOSC W @IOSTBM W IORC
"RTN","PSJOE",186,0)
 Q
"RTN","PSJOE",187,0)
LOCKERR ;
"RTN","PSJOE",188,0)
 W !!,$C(7),"You are entering or editing an Inpatient Medication order in another session.",!,"Only one order entry/edit session is allowed for a user at a time.",!! N DIR S DIR(0)="E" D ^DIR
"RTN","PSJOE",189,0)
 Q
"RTN","PSJOE",190,0)
FLAG(DFN,PSJORD) ;Flag order through CPRS entry point.
"RTN","PSJOE",191,0)
 N ORIFN,NODE0
"RTN","PSJOE",192,0)
 S NODE0=$S(PSJORD["V":$G(^PS(55,DFN,"IV",+PSJORD,0)),PSJORD["U":$G(^PS(55,DFN,5,+PSJORD,0)),1:^PS(53.1,+PSJORD,0))
"RTN","PSJOE",193,0)
 S ORIFN=$P(NODE0,"^",21)
"RTN","PSJOE",194,0)
 D EN1^ORCFLAG(ORIFN)
"RTN","PSJOE",195,0)
 D PAUSE^VALM1
"RTN","PSJOE",196,0)
 Q
"RTN","PSJOE",197,0)
COMPLEX(DFN,ON) ;
"RTN","PSJOE",198,0)
 N NDP2,COM
"RTN","PSJOE",199,0)
 S NDP2=$S(ON["P":$G(^PS(53.1,+ON,.2)),ON["U":$G(^PS(55,DFN,5,+ON,.2)),ON["V":$G(^PS(55,DFN,"IV",+ON,.2)),1:"")
"RTN","PSJOE",200,0)
 S COM=$P(NDP2,"^",8) I COM Q 1
"RTN","PSJOE",201,0)
 Q 0
"RTN","PSJOE1")
0^73^B27457189
"RTN","PSJOE1",1,0)
PSJOE1 ;BIR/CML3-UD OE FOR COMBINED OE ;29 JAN 99 / 9:44 AM
"RTN","PSJOE1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**2,7,25,30,47,56,64,179,181**;16 DEC 97;Build 190
"RTN","PSJOE1",3,0)
 ;
"RTN","PSJOE1",4,0)
 ; Reference to ^DICN is supported by DBIA# 10009
"RTN","PSJOE1",5,0)
 ; Reference to ^VALM is supported by DBIA# 10118
"RTN","PSJOE1",6,0)
 ;
"RTN","PSJOE1",7,0)
 S PC=0 G AD
"RTN","PSJOE1",8,0)
 ;
"RTN","PSJOE1",9,0)
EN ;
"RTN","PSJOE1",10,0)
 S PC=0
"RTN","PSJOE1",11,0)
 ;
"RTN","PSJOE1",12,0)
AD ; Ask Drug
"RTN","PSJOE1",13,0)
 N PSJNORD,PSGORQF,PSGSDX,PSGFDX,PSGNEFDO,PSGEDTOI S PSJNORD=1 I $D(VALM("TM")) S IOTM=VALM("TM"),IOBM=IOSL W IOSC,@IOSTBM,IORC
"RTN","PSJOE1",14,0)
 K PSGORQF
"RTN","PSJOE1",15,0)
 D ^PSGOE7
"RTN","PSJOE1",16,0)
 I $G(PSGORQF) S PSJORQF=1 G DONE
"RTN","PSJOE1",17,0)
 S PC=1,PSJORQF=0 I X?1"S."1.E D ^PSGOES G AD
"RTN","PSJOE1",18,0)
 D ^PSGOE4:'$P(PSJSYSP0,"^",12),^PSGOE3:$P(PSJSYSP0,"^",12)
"RTN","PSJOE1",19,0)
 G:$G(PSGOROE1)=1 AD
"RTN","PSJOE1",20,0)
 K PSGEFN,PSGOEEF,PSGOEE,PSGOEOS S PSGEFN="1:13" F X=1:1:13 S PSGEFN(X)=""
"RTN","PSJOE1",21,0)
 S PSGPDN=$$OINAME^PSJLMUTL(PSGPDRG),PSGPD=PSGPDRG,PSGOINST="",PSGSDN=$$ENDD^PSGMI(PSGNESD)_U_$$ENDTC^PSGMI(PSGNESD),PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC^PSGMI(PSGNEFD)
"RTN","PSJOE1",22,0)
 S PSGAT=PSGS0Y,PSGLIN=$$ENDD^PSGMI(PSGDT)_U_$$ENDTC^PSGMI(PSGDT),PSGLI=PSGDT,PSGEBN=$$ENNPN^PSGMI(DUZ),PSGSTAT=$S(PSGOEAV:"ACTIVE",1:"NON-VERIFIED")
"RTN","PSJOE1",23,0)
 D CHK^PSGOEV("^^"_PSGMR_"^^^^"_PSGST,PSGPDRG_U_PSGDO,PSGSCH_U_PSGNESD_"^^"_PSGNEFD)
"RTN","PSJOE1",24,0)
 S PSGSD=PSGNESD,PSGFD=PSGNEFD
"RTN","PSJOE1",25,0)
 K PSJACEPT S VALMBCK="Q" D:$D(Y) EN^VALM("PSJU LM ACCEPT")
"RTN","PSJOE1",26,0)
 I $G(PSJACEPT)=1 D
"RTN","PSJOE1",27,0)
 . D OC
"RTN","PSJOE1",28,0)
 . ;D:'$G(PSGORQF) IN^PSJOCDS($G(PSGORD),"UD",+$G(PSGDRG))
"RTN","PSJOE1",29,0)
 ;If intervention is not log then quit
"RTN","PSJOE1",30,0)
 I $G(PSGORQF)=1 S PSJACEPT=0
"RTN","PSJOE1",31,0)
 S PSJNOO=-1 I $G(PSJACEPT)=1 S PSJNOO=$$ENNOO^PSJUTL5("N")
"RTN","PSJOE1",32,0)
 I $G(PSJNOO)<0 K PSJACEPT W !,"No order created." G AD
"RTN","PSJOE1",33,0)
 K PSGOEE D ^PSGOETO S PSJORD=PSGORD I PSGOEAV D  G AD
"RTN","PSJOE1",34,0)
 .I '$D(PSGOEE),+PSJSYSU=3 D EN^PSGPEN(PSGORD)
"RTN","PSJOE1",35,0)
 S PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),^PSGOE1,EN^VALM("PSJ LM UD ACTION")
"RTN","PSJOE1",36,0)
 G AD
"RTN","PSJOE1",37,0)
 Q
"RTN","PSJOE1",38,0)
OC ;
"RTN","PSJOE1",39,0)
 NEW PSJDD,PSJALLGY,PSJALGY1
"RTN","PSJOE1",40,0)
 K PSGORQF
"RTN","PSJOE1",41,0)
 D FULL^VALM1
"RTN","PSJOE1",42,0)
 S PSJDD=+$$DD53P45^PSJMISC() I 'PSJDD S PSGORQF=1 Q
"RTN","PSJOE1",43,0)
 I +$G(PSGEDTOI) D
"RTN","PSJOE1",44,0)
 . S PSJALGY1=1
"RTN","PSJOE1",45,0)
 . D ENDDC^PSGSICHK($G(PSGP),PSJDD)
"RTN","PSJOE1",46,0)
 D:'$G(PSGORQF) IN^PSJOCDS($G(PSGORD),"UD",PSJDD)
"RTN","PSJOE1",47,0)
 Q
"RTN","PSJOE1",48,0)
EDIT(PROMPT) ;
"RTN","PSJOE1",49,0)
 ; Edit fields in a UD order.
"RTN","PSJOE1",50,0)
 ; PROMPT=0 - Select fields to edit by number.
"RTN","PSJOE1",51,0)
 ; PROMPT=1 - Prompt to select fields for editing.
"RTN","PSJOE1",52,0)
 ;
"RTN","PSJOE1",53,0)
 ;* D @$S('PROMPT:"ENEFA2^PSGON",1:"ENEFA^PSGON") Q:'Y  S PSGOEEG=3 D EDIT^PSGOEE ;$S(PSGOEEWF[53.1:3,1:5) D:Y EDIT^PSGOEE
"RTN","PSJOE1",54,0)
 D @$S('PROMPT:"ENEFA2^PSGON",1:"ENEFA^PSGON") Q:'Y  S:$G(PSJNEWOE) PSGOEEWF="^PS(53.1," S PSGOEEG=$S('$D(PSGOEEWF):3,PSGOEEWF[53.1:3,1:5) D EDIT^PSGOEE
"RTN","PSJOE1",55,0)
 I $G(PSJNEWOE) S PSGOEENO=0,DR="",VALMBCK="R"
"RTN","PSJOE1",56,0)
 I '$G(PSJNEWOE) D ENNOU^PSGOEE0 I 'PSGOEENO,DR="" S VALMBCK="R" Q
"RTN","PSJOE1",57,0)
 I 'PSGOEENO,$D(PSGOES) D ENNOU^PSGOEE0  ; only update on order sets
"RTN","PSJOE1",58,0)
 ;*179 No longer call CKDT^PSGOEE from here.
"RTN","PSJOE1",59,0)
 ;I 'PSGOEENO,$G(PSGPDNX)=1 D CKDT^PSGOEE
"RTN","PSJOE1",60,0)
 I $G(PSGOEER)["101^PSGOE8" S PSGEDTOI=1
"RTN","PSJOE1",61,0)
 K VALMSG I PSGOEENO D
"RTN","PSJOE1",62,0)
 .S VALMSG="This change will cause a new order to be created." D GTSTATUS^PSGOEE,CHKDD^PSGOEE
"RTN","PSJOE1",63,0)
 .S PSGEBN=$$ENNPN^PSGMI(DUZ),PSGLIN=$$ENDD^PSGMI(PSGDT)_U_$$ENDTC^PSGMI(PSGDT),PSGLI=PSGDT
"RTN","PSJOE1",64,0)
 D CHK^PSGOEV("^^"_PSGMR_"^^^^"_PSGST,PSGPDRG_U_PSGDO,PSGSCH_U_PSGSD_"^^"_PSGFD)
"RTN","PSJOE1",65,0)
 D INIT^PSJLMUDE(PSGP,$G(PSGORD))
"RTN","PSJOE1",66,0)
 Q
"RTN","PSJOE1",67,0)
DONE ;
"RTN","PSJOE1",68,0)
 K %,DA,DIC,DIE,DR,DRG,DRGN,DRGO,ND,OC,ORIFN,ORIT,ORPK,ORSTOP,ORSTRT,ORSTS,ORTX,PC,PSGDO,PSGMR,PSGMRN,PSGNEDFD,PSGNEFD,PSGNESD,PSGOES,PSGOROE1,PSGORD,PSGS0XT,PSGS0Y,PSGSCH,PSGSI,PSGX,Y,Z Q
"RTN","PSJOE1",69,0)
 K PSGEDTOI
"RTN","PSJOE1",70,0)
 ;
"RTN","PSJOE1",71,0)
GDO ;
"RTN","PSJOE1",72,0)
 W !!,"Drug is not found in Formulary List." F  S %=1 W !,"Would you like to try to search the list again" D YN^DICN Q:%  D TAM
"RTN","PSJOE1",73,0)
 Q:%<2
"RTN","PSJOE1",74,0)
FTD ;
"RTN","PSJOE1",75,0)
 R !!,"Enter FREE TEXT DRUG: ",PSGDRGN:DTIME E  W $C(7) S PSGDRGN="^" Q
"RTN","PSJOE1",76,0)
 Q:"^"[PSGDRGN  S X=$S(PSGDRGN'?.ANP:"Control character(s)",PSGDRGN["^":"Up-arrow ('^') in text",$L(PSGDRGN)>39:"Response longer than 39 characters",1:"") I X]"" W $C(7),"  ??",!?2,"(",X," not allowed.)" G FTD
"RTN","PSJOE1",77,0)
 Q:PSGDRGN'?1."?"
"RTN","PSJOE1",78,0)
 W !!?2,"ENTER DRUG ORDERED (1-39 CHARACTERS).",!?2,"Since the drug cannot be found in the DRUG file, enter the drug name here",!,"exactly as ordered.  Press the RETURN key (or enter an '^') to skip over this",!,"drug, or to again search the"
"RTN","PSJOE1",79,0)
 W " DRUG file for this one." G FTD
"RTN","PSJOE1",80,0)
 ;
"RTN","PSJOE1",81,0)
TAM ; Try Again Message
"RTN","PSJOE1",82,0)
 W !!,"  Enter a 'Y' to try again to find the drug ordered from the Formulary.  (The",!,"order cannot become active until a Formulary drug has been entered.)  Enter 'N'",!,"to enter the drug ordered as free text for later reference."
"RTN","PSJOE1",83,0)
 W "  Enter '^' to exit.",! Q
"RTN","PSJP")
0^2^B20677558
"RTN","PSJP",1,0)
PSJP ;BIR/CML3-INPATIENT LOOK-UP ; 15 Apr 98 / 9:05 AM
"RTN","PSJP",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**10,53,60,181**;16 DEC 97;Build 190
"RTN","PSJP",3,0)
 ;
"RTN","PSJP",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSJP",5,0)
 ; Reference to ^PS(59.7 is supported by DBIA 2181
"RTN","PSJP",6,0)
 ; Reference to ^%ZIS is supported by DBIA 10086
"RTN","PSJP",7,0)
 ; Reference to ^DICN is supported by DBIA 10009
"RTN","PSJP",8,0)
 ; Reference to ^DIR is supported by DBIA 10026
"RTN","PSJP",9,0)
 ; Reference to ^VADPT is supported by DBIA 10061
"RTN","PSJP",10,0)
 ;
"RTN","PSJP",11,0)
ENDPT ; get any patient
"RTN","PSJP",12,0)
 K DIC,PSGP,Y W !!,"Select "_$S($D(PSGDICA):PSGDICA_" ",1:"")_"PATIENT: " R X:DTIME S:'$T X="^" W:'$T $C(7) I "^"[X S (Y,PSGP)=-1 S QFLG=1 G DONE
"RTN","PSJP",13,0)
 D EN^PSJDPT
"RTN","PSJP",14,0)
 I Y'>0 G ENDPT
"RTN","PSJP",15,0)
 K DIC
"RTN","PSJP",16,0)
 ;
"RTN","PSJP",17,0)
CHK ;
"RTN","PSJP",18,0)
 ;Clean out arrays use in order checks
"RTN","PSJP",19,0)
 K PSJEXCPT,PSJOCER
"RTN","PSJP",20,0)
 S (DFN,PSGP)=+Y,VA200=1 D INP^VADPT
"RTN","PSJP",21,0)
 I VAIN(4) S PSJPCAF=1_"^"_VAIN(1),PSJPWD=+VAIN(4),PSJPWDN=$P(VAIN(4),"^",2),PSJPTS=+VAIN(3),PSJPTSP=+VAIN(2),PSJPRB=VAIN(5),PSJPAD=+VAIN(7),PSJPDX=VAIN(9),PSJPTD=$S($D(^PS(55,PSGP,5.1)):$P(^(5.1),"^",4),1:""),PSJPDD="" G CNV
"RTN","PSJP",22,0)
 S PSJPCAF="",VAIP("D")="L" D IN5^VADPT I 'VAIP(13,1) W $C(7),!!?3,"PATIENT HAS NEVER BEEN ADMITTED." D ENCONT G:%'=1 ENDPT S PSJPDD=""
"RTN","PSJP",23,0)
 S PSGID=+VAIP(3),X=+VAIP(4)=12!(+VAIP(4)=38),PSGOD=$$ENDTC^PSGMI(PSGID)
"RTN","PSJP",24,0)
 I $S(X:1,1:VAIP(13,1)) W $C(7),!!?3,"PATIENT IS FOUND TO BE ",$P("DISCHARGED^DECEASED","^",X+1)," AS OF ",PSGOD,"." S PSJH=$S(X:2,1:3),PSJPDD=PSGID_"^"_PSGOD S:X PSJPDD=PSJPDD_"^1" D ENCONT G:%'=1 ENDPT
"RTN","PSJP",25,0)
 S PSJPAD=VAIP(13,1),PSJPWD=+VAIP(5),PSJPWDN=$P(VAIP(5),"^",2),PSJPRB=$P(VAIP(6),"^",2),PSJPTSP=+VAIP(7),PSJPTS=+VAIP(8),PSJPDX=VAIP(9),PSJPTD=""
"RTN","PSJP",26,0)
 ;
"RTN","PSJP",27,0)
CNV ;
"RTN","PSJP",28,0)
 I $D(PSJEXTP) W ! K DIR S DIR(0)="DO",DIR("A")="Date to start searching from (optional)",DIR("?")="Enter a date to start searching from, or <RETURN> for all orders" D ^DIR S PSJHDATE=Y K DIR
"RTN","PSJP",29,0)
 D DEM^VADPT,PID^VADPT,HTWT^PSJAC(DFN)
"RTN","PSJP",30,0)
 S PSGP(0)=VADM(1),PSJPSSN=VADM(2),PSJPDOB=+VADM(3),PSJPAGE=VADM(4),PSJPSEX=$S(VADM(5)]"":VADM(5),1:"?^____"),PSJPPID=VA("PID"),PSJPBID=VA("BID")
"RTN","PSJP",31,0)
 F X="PSJPAD","PSJPDOB","PSJPTD" I @X S $P(@X,"^",2)=$$ENDTC^PSGMI(+@X)
"RTN","PSJP",32,0)
 ;
"RTN","PSJP",33,0)
WP ; ward parameters
"RTN","PSJP",34,0)
 S PSJSYSW0="",PSJSYSW=0 I $G(PSJPWD) S PSJSYSW=+$O(^PS(59.6,"B",PSJPWD,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJP",35,0)
 ; *OLD CODE* S PSJSYSL="",X=$P(PSJSYSU,";",3)>1,PSJSYSL=$P(PSJSYSW0,"^",X*4+12)
"RTN","PSJP",36,0)
 S PSJSYSL="",X=$P(PSJSYSU,";",3)>1,PSJSYSL=$S(X=0:$P(PSJSYSW0,"^",12),1:$P(PSJSYSW0,"^",16))
"RTN","PSJP",37,0)
 S PSJDCEXP=$$RECDCEXP()
"RTN","PSJP",38,0)
 I PSJSYSL D
"RTN","PSJP",39,0)
 .S:X X='$P(PSJSYSP0,"^",10) S IOP=$S($P(PSJSYSP0,"^",13)]"":$P(PSJSYSP0,"^",13),$P(PSJSYSW0,"^",19+X)]"":$P(PSJSYSW0,"^",19+X),1:"") I IOP]"" D
"RTN","PSJP",40,0)
 ..S IOP="`"_IOP K %ZIS S %ZIS="NQ" D ^%ZIS S:'POP $P(PSJSYSL,"^",2,3)=ION_"^"_IO D HOME^%ZIS
"RTN","PSJP",41,0)
 ;
"RTN","PSJP",42,0)
DONE ;
"RTN","PSJP",43,0)
 K DA,DIC,NB,ND,NS,PSGID,PSGOD,VA200,VAIP,VAMT,X,Y(0),Y(0,0),QFLG Q
"RTN","PSJP",44,0)
 ;
"RTN","PSJP",45,0)
ENCONT ;
"RTN","PSJP",46,0)
 I $D(PSGH) S %=1 Q
"RTN","PSJP",47,0)
 F FQ=0:0 W !!,"Do you wish to continue with this patient" S %=0 D YN^DICN Q:%  W:%Y'?1."?" $C(7) W "  (A 'YES' or 'NO' response is required.)" D:%Y?1."?" @("CH"_PSJH)
"RTN","PSJP",48,0)
 S:%'=1 Y=-1 Q
"RTN","PSJP",49,0)
 ;
"RTN","PSJP",50,0)
CH1 ;
"RTN","PSJP",51,0)
 W !!?2,"The patient selected has never been admitted to this medical facility.  You",!,"will be able to enter IV orders for this patient but NOT Unit Dose orders." Q
"RTN","PSJP",52,0)
CH2 ;
"RTN","PSJP",53,0)
 W !!?2,"This patient is shown as deceased.  You will not be able to enter orders for",!,"this patient." Q
"RTN","PSJP",54,0)
CH3 ;
"RTN","PSJP",55,0)
 W !!?2,"This patient is shown to be currently discharged.  You will be able to enter",!,"IV orders for this patient but NOT Unit Dose orders." Q
"RTN","PSJP",56,0)
 Q
"RTN","PSJP",57,0)
RECDCEXP() ;
"RTN","PSJP",58,0)
 ;Determent the Hours to display Recently DC/Expired orders on the short profile
"RTN","PSJP",59,0)
 ;Returning P1^P2
"RTN","PSJP",60,0)
 ;P1 = Number of hours defined in 59.6 or 59.7.  Set to 24 if no value set in either file.
"RTN","PSJP",61,0)
 ;P2 = Date.time from Now - P1 hours
"RTN","PSJP",62,0)
 ;
"RTN","PSJP",63,0)
 NEW PSJDCEXP,PSJWD,PSJWD1,PSJSYS,X,%
"RTN","PSJP",64,0)
 S PSJWD1=$S(+$G(PSJPWD):PSJPWD,+$G(VAIN(4)):+VAIN(4),1:0)
"RTN","PSJP",65,0)
 S:PSJWD1 X=$O(^PS(59.6,"B",PSJWD1,0))
"RTN","PSJP",66,0)
 S:+$G(X) PSJWD=$P($G(^PS(59.6,X,0)),U,33)
"RTN","PSJP",67,0)
 S PSJSYS=+$P($G(^PS(59.7,1,26)),U,8)
"RTN","PSJP",68,0)
 S PSJDCEXP=$S($G(PSJWD):PSJWD,PSJSYS:PSJSYS,1:24)
"RTN","PSJP",69,0)
 D NOW^%DTC
"RTN","PSJP",70,0)
 S X=$$FMADD^XLFDT(%,0,-PSJDCEXP,0,0)
"RTN","PSJP",71,0)
 Q PSJDCEXP_U_X
"RTN","PSJRXI")
0^49^B11564101
"RTN","PSJRXI",1,0)
PSJRXI ;IHS/DSD/JCM/RLW-LOGS PHARMACY INTERVENTIONS ; 15 May 98 / 9:28 AM
"RTN","PSJRXI",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,181**;16 DEC 97;Build 190
"RTN","PSJRXI",3,0)
 ;
"RTN","PSJRXI",4,0)
 ; Reference to ^APSPQA(32.4 is supported by DBIA #2179
"RTN","PSJRXI",5,0)
 ; Reference to ^PSDRUG supported by DBIA# 2192
"RTN","PSJRXI",6,0)
 ;
"RTN","PSJRXI",7,0)
 ; This routine is used to create entries in the APSP INTERVENTION file.
"RTN","PSJRXI",8,0)
 ;---------------------------------------------------------------
"RTN","PSJRXI",9,0)
START ;   
"RTN","PSJRXI",10,0)
 N SAVEX,SAVEY S SAVEX=X,SAVEY=Y
"RTN","PSJRXI",11,0)
 D INIT
"RTN","PSJRXI",12,0)
 D DIC G:PSJRXI("QFLG") END
"RTN","PSJRXI",13,0)
 D EDIT
"RTN","PSJRXI",14,0)
 S:'$D(PSJNEW("PROVIDER")) PSJNEW("PROVIDER")=$P(^APSPQA(32.4,PSJRXI("DA"),0),"^",3)
"RTN","PSJRXI",15,0)
END D EOJ
"RTN","PSJRXI",16,0)
 Q
"RTN","PSJRXI",17,0)
 ;---------------------------------------------------------------
"RTN","PSJRXI",18,0)
INIT ;
"RTN","PSJRXI",19,0)
 W !!,"Now creating Pharmacy Intervention",!
"RTN","PSJRXI",20,0)
 ;I $G(PSJDRUG("IEN")) W "For  ",$P($G(^PSDRUG(PSJDRUG("IEN"),0)),"^"),!
"RTN","PSJRXI",21,0)
 I $G(PSJDD) W "For ",$P($G(^PSDRUG(PSJDD,0)),"^"),!
"RTN","PSJRXI",22,0)
 K PSJRXI
"RTN","PSJRXI",23,0)
 S PSJRXI("QFLG")=0
"RTN","PSJRXI",24,0)
 Q
"RTN","PSJRXI",25,0)
 ;
"RTN","PSJRXI",26,0)
DIC ;
"RTN","PSJRXI",27,0)
 N DIC,DR,DA,X,DD,DO,Y,PSJY,PSJRXIEN
"RTN","PSJRXI",28,0)
 I $G(PSJRXREQ)="" S PSJRXREQ="ALLERGY"
"RTN","PSJRXI",29,0)
 D FIND^DIC(9009032.3,"","@;.01","",PSJRXREQ,1,"B","","","PSJRXIEN")
"RTN","PSJRXI",30,0)
 S PSJRXIEN=$G(PSJRXIEN("DILIST",2,1))
"RTN","PSJRXI",31,0)
 I 'PSJRXIEN S PSJY=-1 G DICX
"RTN","PSJRXI",32,0)
 S DIC="^APSPQA(32.4,",DLAYGO=9009032.4,DIC(0)="L",X=DT
"RTN","PSJRXI",33,0)
 S DIC("DR")=".02////"_PSGP_";.04////"_DUZ_";.05////"_PSJDD_";.06///PHARMACY"
"RTN","PSJRXI",34,0)
 ;S DIC("DR")=DIC("DR")_$S($G(PSJRX("INTERVENE"))=1:";.07////18",$G(PSJRX("INTERVENE"))=2:";.07////19",1:"")_";.14////0"_";.16////"_$S($G(PSJSITE)]"":PSJSITE,1:"")
"RTN","PSJRXI",35,0)
 S DIC("DR")=DIC("DR")_";.07////"_$G(PSJRXIEN)_";.14////1"_";.16////"_$S($G(PSJSITE)]"":PSJSITE,1:"")
"RTN","PSJRXI",36,0)
 D FILE^DICN K DIC,DR,DA
"RTN","PSJRXI",37,0)
 S PSJY=Y
"RTN","PSJRXI",38,0)
 I Y>0 S PSJRXI("DA")=+Y
"RTN","PSJRXI",39,0)
 E  S PSJRXI("QFLG")=1 G DICX
"RTN","PSJRXI",40,0)
 D DIE
"RTN","PSJRXI",41,0)
DICX ;
"RTN","PSJRXI",42,0)
 I $G(PSJY)=-1 D
"RTN","PSJRXI",43,0)
 . W !!,"Unable to log an intervention for ",$G(PSJRXREQ)
"RTN","PSJRXI",44,0)
 . D PAUSE^PSJLMUT1
"RTN","PSJRXI",45,0)
 K X,Y
"RTN","PSJRXI",46,0)
 Q
"RTN","PSJRXI",47,0)
DIE ;
"RTN","PSJRXI",48,0)
 K DIE,DIC,DR,DA
"RTN","PSJRXI",49,0)
 S DIE="^APSPQA(32.4,",DA=PSJRXI("DA"),DR=$S($G(PSJRXI("EDIT"))]"":".03:1600",1:".03;.08")
"RTN","PSJRXI",50,0)
 ;L +^APSPQA(32.4,PSJRXI("DA")) D ^DIE K DIE,DIC,DR,X,Y,DA L -^APSPQA(32.4,PSJRXI("DA"))
"RTN","PSJRXI",51,0)
 L +^APSPQA(32.4,PSJRXI("DA")):1 E  W !,"Sorry, someone else is editing this intervention!" Q
"RTN","PSJRXI",52,0)
 D ^DIE K DIE,DIC,DR,X,Y,DA L -^APSPQA(32.4,PSJRXI("DA"))
"RTN","PSJRXI",53,0)
 W $C(7),!!,"See 'Pharmacy Intervention Menu' if you want to delete this",!,"intervention or for more options.",!
"RTN","PSJRXI",54,0)
 Q
"RTN","PSJRXI",55,0)
EDIT ;
"RTN","PSJRXI",56,0)
 K DIR W ! S DIR(0)="Y",DIR("A")="Would you like to edit this intervention",DIR("B")="N" D ^DIR K DIR I $D(DIRUT)!'Y G EDITX
"RTN","PSJRXI",57,0)
 S PSJRXI("EDIT")=1 D DIE
"RTN","PSJRXI",58,0)
 G EDIT
"RTN","PSJRXI",59,0)
EDITX K X,Y
"RTN","PSJRXI",60,0)
 Q
"RTN","PSJRXI",61,0)
 ;
"RTN","PSJRXI",62,0)
EOJ ;
"RTN","PSJRXI",63,0)
 K PSJRXI S X=SAVEX,Y=SAVEY
"RTN","PSJRXI",64,0)
 Q
"RTN","PSJRXI",65,0)
 ;
"RTN","PSJRXI",66,0)
EN1(PSJORDER) ; Entry Point if have internal rx #
"RTN","PSJRXI",67,0)
 I PSJX']"" W !,$C(7),"No prescription data" Q
"RTN","PSJRXI",68,0)
 S PSJORDER=$S((PSJORDER["N")!(PSJORDER["P"):"^PS(53.1,"_+PSJORDER,PSJORDER["V":"^PS(55,"_DFN_",""IV"","_+PSJORDER,1:"^PS(55,"_DFN_",5,"_+PSJORDER)_","
"RTN","PSJRXI",69,0)
 N PSJDFN,PSJNEW,PSJDRUG,PSJY
"RTN","PSJRXI",70,0)
 I $G(^PS(53.1,PSJX,0))']"" W !,$C(7),"No prescription data" G EN1X
"RTN","PSJRXI",71,0)
 S PSJRXI("IRXN")=PSJORDER
"RTN","PSJRXI",72,0)
 K PSJY S PSJY=@(PSJORDER_",0)")
"RTN","PSJRXI",73,0)
 S PSJDFN=$P(PSJY,"^",15),PSJNEW("PROVIDER")=$P(PSJY,"^",2)
"RTN","PSJRXI",74,0)
 S PSJDRUG=0,PSJDRUG=$O(^PS(53.1,PSJRXI("IRXN"),1,PSJDRUG)) Q:'PSJDRUG  S PSJDRUG("IEN")=$G(@(PSJORDER_","_PSJDRUG),"^")
"RTN","PSJRXI",75,0)
 D START
"RTN","PSJRXI",76,0)
EN1X Q
"VER")
8.0^22.0
"^DD",59.6,59.6,7,0)
HOURS OF RECENTLY DC/EXPIRED^NJ3,0^^0;33^K:+X'=X!(X>120)!(X<1)!(X?.E1"."1.N) X
"^DD",59.6,59.6,7,3)
Enter a number between 1 and 120.  Any orders discontinued/expired within the hours specified here will be displayed on the patient profile.
"^DD",59.6,59.6,7,21,0)
^^4^4^3060707^
"^DD",59.6,59.6,7,21,1,0)
The Inpatient Meds profiles will display the recently 
"^DD",59.6,59.6,7,21,2,0)
discontinued/expired orders that fall within the hours specified in this 
"^DD",59.6,59.6,7,21,3,0)
field.  The value defined in this field will take precedence over the 
"^DD",59.6,59.6,7,21,4,0)
Inpatient System parameter.
"^DD",59.6,59.6,7,"DT")
3090121
**INSTALL NAME**
OR*3.0*272
"BLD",7322,0)
OR*3.0*272^ORDER ENTRY/RESULTS REPORTING^0^3110113^y
"BLD",7322,4,0)
^9.64PA^^0
"BLD",7322,6)
25^
"BLD",7322,6.3)
53
"BLD",7322,"ABPKG")
n
"BLD",7322,"INIT")
POST^ORY272
"BLD",7322,"KRN",0)
^9.67PA^8989.52^19
"BLD",7322,"KRN",.4,0)
.4
"BLD",7322,"KRN",.401,0)
.401
"BLD",7322,"KRN",.402,0)
.402
"BLD",7322,"KRN",.403,0)
.403
"BLD",7322,"KRN",.5,0)
.5
"BLD",7322,"KRN",.84,0)
.84
"BLD",7322,"KRN",3.6,0)
3.6
"BLD",7322,"KRN",3.8,0)
3.8
"BLD",7322,"KRN",9.2,0)
9.2
"BLD",7322,"KRN",9.8,0)
9.8
"BLD",7322,"KRN",9.8,"NM",0)
^9.68A^9^7
"BLD",7322,"KRN",9.8,"NM",1,0)
OROCAPI^^0^B1276161
"BLD",7322,"KRN",9.8,"NM",2,0)
ORKCHK4^^0^B22903679
"BLD",7322,"KRN",9.8,"NM",3,0)
ORKCHK6^^0^B26186989
"BLD",7322,"KRN",9.8,"NM",4,0)
ORKPS^^0^B59221403
"BLD",7322,"KRN",9.8,"NM",5,0)
ORKPS1^^0^B67186878
"BLD",7322,"KRN",9.8,"NM",8,0)
ORY272^^0^B1468191
"BLD",7322,"KRN",9.8,"NM",9,0)
ORX8^^0^B14076092
"BLD",7322,"KRN",9.8,"NM","B","ORKCHK4",2)

"BLD",7322,"KRN",9.8,"NM","B","ORKCHK6",3)

"BLD",7322,"KRN",9.8,"NM","B","ORKPS",4)

"BLD",7322,"KRN",9.8,"NM","B","ORKPS1",5)

"BLD",7322,"KRN",9.8,"NM","B","OROCAPI",1)

"BLD",7322,"KRN",9.8,"NM","B","ORX8",9)

"BLD",7322,"KRN",9.8,"NM","B","ORY272",8)

"BLD",7322,"KRN",19,0)
19
"BLD",7322,"KRN",19.1,0)
19.1
"BLD",7322,"KRN",101,0)
101
"BLD",7322,"KRN",409.61,0)
409.61
"BLD",7322,"KRN",771,0)
771
"BLD",7322,"KRN",870,0)
870
"BLD",7322,"KRN",8989.51,0)
8989.51
"BLD",7322,"KRN",8989.52,0)
8989.52
"BLD",7322,"KRN",8994,0)
8994
"BLD",7322,"KRN","B",.4,.4)

"BLD",7322,"KRN","B",.401,.401)

"BLD",7322,"KRN","B",.402,.402)

"BLD",7322,"KRN","B",.403,.403)

"BLD",7322,"KRN","B",.5,.5)

"BLD",7322,"KRN","B",.84,.84)

"BLD",7322,"KRN","B",3.6,3.6)

"BLD",7322,"KRN","B",3.8,3.8)

"BLD",7322,"KRN","B",9.2,9.2)

"BLD",7322,"KRN","B",9.8,9.8)

"BLD",7322,"KRN","B",19,19)

"BLD",7322,"KRN","B",19.1,19.1)

"BLD",7322,"KRN","B",101,101)

"BLD",7322,"KRN","B",409.61,409.61)

"BLD",7322,"KRN","B",771,771)

"BLD",7322,"KRN","B",870,870)

"BLD",7322,"KRN","B",8989.51,8989.51)

"BLD",7322,"KRN","B",8989.52,8989.52)

"BLD",7322,"KRN","B",8994,8994)

"BLD",7322,"QUES",0)
^9.62^^
"BLD",7322,"REQB",0)
^9.611^3^2
"BLD",7322,"REQB",2,0)
OR*3.0*280^2
"BLD",7322,"REQB",3,0)
OR*3.0*316^2
"BLD",7322,"REQB","B","OR*3.0*280",2)

"BLD",7322,"REQB","B","OR*3.0*316",3)

"INIT")
POST^ORY272
"MBREQ")
1
"PKG",170,-1)
1^1
"PKG",170,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",170,22,0)
^9.49I^1^1
"PKG",170,22,1,0)
3.0^2971217^2980917^11712
"PKG",170,22,1,"PAH",1,0)
272^3110113^636
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","ORKCHK4")
0^2^B22903679
"RTN","ORKCHK4",1,0)
ORKCHK4 ; slc/CLA - Support routine called by ORKCHK to do SELECT mode order checks ;12/13/10  07:18
"RTN","ORKCHK4",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**6,32,74,87,94,123,162,190,249,272**;Dec 17, 1997;Build 53
"RTN","ORKCHK4",3,0)
 Q
"RTN","ORKCHK4",4,0)
 ;
"RTN","ORKCHK4",5,0)
EN(ORKS,ORKDFN,ORKA,ORENT,ORKTMODE) ;perform order checking for orderable item selection
"RTN","ORKCHK4",6,0)
 Q:$$GET^XPAR("DIV^SYS^PKG","ORK SYSTEM ENABLE/DISABLE",1,"I")="D"
"RTN","ORKCHK4",7,0)
 ;
"RTN","ORKCHK4",8,0)
 N OI,ORKDG,HL7,ODT,ORNUM,HL7NPTR,HL7NTXT,HL7NCOD,HL7LPTR,HL7LTXT,HL7LCOD
"RTN","ORKCHK4",9,0)
 N ORKMSG,ORKT,ORKTXT
"RTN","ORKCHK4",10,0)
 ;
"RTN","ORKCHK4",11,0)
 S OI=$P(ORKA,"|"),ORKDG=$P(ORKA,"|",2)
"RTN","ORKCHK4",12,0)
 S HL7=$P(ORKA,"|",3),ODT=$P(ORKA,"|",4),ORNUM=$P(ORKA,"|",5)
"RTN","ORKCHK4",13,0)
 S HL7NPTR=$P(HL7,U),HL7NTXT=$P(HL7,U,2),HL7NCOD=$P(HL7,U,3)
"RTN","ORKCHK4",14,0)
 S HL7LPTR=$P(HL7,U,4),HL7LTXT=$P(HL7,U,5),HL7LCOD=$P(HL7,U,6)
"RTN","ORKCHK4",15,0)
 ;
"RTN","ORKCHK4",16,0)
 I $E(ORKDG,1,2)="PS" D PHARM
"RTN","ORKCHK4",17,0)
 I $E(ORKDG,1,2)'="PS" D MLM^ORKCHK2(.ORKS,ORKDFN,ORKA,ORENT,"SELECT")
"RTN","ORKCHK4",18,0)
 Q
"RTN","ORKCHK4",19,0)
 ;
"RTN","ORKCHK4",20,0)
PHARM ;process pharmacy order checks:
"RTN","ORKCHK4",21,0)
 N ORPSPKG,ORPSA,ORKDD
"RTN","ORKCHK4",22,0)
 N ORCRITN,ORCRITF,ORCRITD,ORSIGN,ORSIGF,ORSIGD,ORDUPN,ORDUPF,ORDUPD,ORDUPCN,ORDUPCF,ORDUPCD
"RTN","ORKCHK4",23,0)
 ;
"RTN","ORKCHK4",24,0)
 D PARAMS("CRITICAL DRUG INTERACTION",.ORCRITN,.ORCRITF,.ORCRITD)
"RTN","ORKCHK4",25,0)
 D PARAMS("SIGNIFICANT DRUG INTERACTION",.ORSIGN,.ORSIGF,.ORSIGD)
"RTN","ORKCHK4",26,0)
 D PARAMS("DUPLICATE DRUG ORDER",.ORDUPN,.ORDUPF,.ORDUPD)
"RTN","ORKCHK4",27,0)
 D PARAMS("DUPLICATE DRUG THERAPY",.ORDUPCN,.ORDUPCF,.ORDUPCD)
"RTN","ORKCHK4",28,0)
 ;
"RTN","ORKCHK4",29,0)
 ;dispense drug selected:
"RTN","ORKCHK4",30,0)
 I $L($G(HL7LPTR)),($G(HL7LCOD)="99PSD") D
"RTN","ORKCHK4",31,0)
 .D RXOCS
"RTN","ORKCHK4",32,0)
 .D MLM^ORKCHK2(.ORKS,ORKDFN,ORKA,ORENT,"SELECT")
"RTN","ORKCHK4",33,0)
 ;
"RTN","ORKCHK4",34,0)
 ;dispense drug NOT selected, split OI into dispense drugs:
"RTN","ORKCHK4",35,0)
 I '$L($G(HL7LPTR)) D
"RTN","ORKCHK4",36,0)
 .S ORPSPKG=$E(ORKDG,3)
"RTN","ORKCHK4",37,0)
 .I ORPSPKG="H" S ORPSPKG="X"  ;change to "X" if "H"erbal/non-VA med
"RTN","ORKCHK4",38,0)
 .I "IOX"[ORPSPKG D OI2DD^ORKPS(.ORPSA,OI,ORPSPKG)
"RTN","ORKCHK4",39,0)
 .S ORKDD=0 F  S ORKDD=$O(ORPSA(ORKDD)) Q:'ORKDD  D
"RTN","ORKCHK4",40,0)
 ..;S HL7LTXT=ORPSA(ORKDD)
"RTN","ORKCHK4",41,0)
 ..S HL7LTXT=$P($G(^ORD(101.43,OI,0)),U)
"RTN","ORKCHK4",42,0)
 ..S HL7NPTR=$P(ORKDD,";",2)
"RTN","ORKCHK4",43,0)
 ..S HL7LPTR=+ORKDD
"RTN","ORKCHK4",44,0)
 ..S HL7LCOD="99PSD",HL7NCOD="99NDF"
"RTN","ORKCHK4",45,0)
 ..S $P(HL7,U)=HL7NPTR,$P(HL7,U,3)=HL7NCOD
"RTN","ORKCHK4",46,0)
 ..S $P(HL7,U,4)=HL7LPTR,$P(HL7,U,5)=HL7LTXT,$P(HL7,U,6)=HL7LCOD
"RTN","ORKCHK4",47,0)
 ..S $P(ORKA,"|",3)=HL7  ;set these for MLM OCX call
"RTN","ORKCHK4",48,0)
 ..D RXOCS
"RTN","ORKCHK4",49,0)
 ..D MLM^ORKCHK2(.ORKS,ORKDFN,ORKA,ORENT,"SELECT")
"RTN","ORKCHK4",50,0)
 Q
"RTN","ORKCHK4",51,0)
 ;
"RTN","ORKCHK4",52,0)
RXOCS ;drug-drug interaction, duplicate drug order, duplicate drug class
"RTN","ORKCHK4",53,0)
 Q:ORCRITF_ORSIGF_ORDUPF_ORDUPCF'["E"  ;quit if none are "E"nabled
"RTN","ORKCHK4",54,0)
 N ORKRX,ORPSNUM
"RTN","ORKCHK4",55,0)
 D CHECK^ORKPS(.ORKRX,ORKDFN,HL7LPTR_U_HL7LTXT,OI,ORKDG)
"RTN","ORKCHK4",56,0)
 N CHK,XX S CHK=0,XX=""
"RTN","ORKCHK4",57,0)
 F  S CHK=$O(ORKRX(CHK)) Q:'CHK  D
"RTN","ORKCHK4",58,0)
 .S XX=ORKRX(CHK)
"RTN","ORKCHK4",59,0)
 .;
"RTN","ORKCHK4",60,0)
 .;get errors/exceptions/checks not done
"RTN","ORKCHK4",61,0)
 .I $P(XX,U)="ERR" D
"RTN","ORKCHK4",62,0)
 ..S ORKS("ORK",2_$E($P(XX,U,2),1,225))=ORNUM_U_25_U_3_U_$P(XX,U,2)
"RTN","ORKCHK4",63,0)
 .;
"RTN","ORKCHK4",64,0)
 .;critical drug interaction:
"RTN","ORKCHK4",65,0)
 .I $P(XX,U)="DI",$P(XX,U,2)="CRITICAL" D
"RTN","ORKCHK4",66,0)
 ..Q:ORCRITF="D"
"RTN","ORKCHK4",67,0)
 ..S ORPSNUM=$P(XX,U,3)
"RTN","ORKCHK4",68,0)
 ..S ORKTXT=$P(XX,U,2)_" drug-drug interaction: "_$P(XX,U,5)
"RTN","ORKCHK4",69,0)
 ..S ORKMSG=$P(XX,U,2)_" drug-drug interaction: "_$P(XX,U,6)
"RTN","ORKCHK4",70,0)
 ..S ORKS("ORK",ORCRITD_","_$G(ORNUM)_","_ORPSNUM_","_$E(ORKMSG,1,225))=ORNUM_U_ORCRITN_U_ORCRITD_U_ORKTXT
"RTN","ORKCHK4",71,0)
 .;
"RTN","ORKCHK4",72,0)
 .;significant drug interaction:
"RTN","ORKCHK4",73,0)
 .I $P(XX,U)="DI",$P(XX,U,2)="SIGNIFICANT" D
"RTN","ORKCHK4",74,0)
 ..Q:ORSIGF="D"
"RTN","ORKCHK4",75,0)
 ..S ORPSNUM=$P(XX,U,3)
"RTN","ORKCHK4",76,0)
 ..S ORKTXT=$P(XX,U,2)_" drug-drug interaction: "_$P(XX,U,5)
"RTN","ORKCHK4",77,0)
 ..S ORKMSG=$P(XX,U,2)_" drug-drug interaction: "_$P(XX,U,6)
"RTN","ORKCHK4",78,0)
 ..S ORKS("ORK",ORSIGD_","_$G(ORNUM)_","_ORPSNUM_","_$E(ORKMSG,1,225))=ORNUM_U_ORSIGN_U_ORSIGD_U_ORKTXT
"RTN","ORKCHK4",79,0)
 .;
"RTN","ORKCHK4",80,0)
 .;duplicate drug:
"RTN","ORKCHK4",81,0)
 .I $P(XX,U)="DD" D
"RTN","ORKCHK4",82,0)
 ..Q:ORDUPF="D"
"RTN","ORKCHK4",83,0)
 ..S ORPSNUM=$P(XX,U,4)  ;get the associated order number
"RTN","ORKCHK4",84,0)
 ..I $L(ORPSNUM),$G(^OR(100,+ORPSNUM,0)) S ORKT=$$FULLTEXT^ORQOR1(+ORPSNUM),ORKTXT=$P(ORKT,U)_" ["_$P(ORKT,U,2)_"]"
"RTN","ORKCHK4",85,0)
 ..E  S ORKTXT=$P(XX,U,3)
"RTN","ORKCHK4",86,0)
 ..S ORKMSG="Duplicate drug order: "_ORKTXT
"RTN","ORKCHK4",87,0)
 ..S ORKS("ORK",ORDUPD_","_$G(ORNUM)_","_ORPSNUM_",Duplicate drug order: "_$E($P(XX,U,3),1,200))=ORNUM_U_ORDUPN_U_ORDUPD_U_ORKMSG_U_$G(ORPSNUM)
"RTN","ORKCHK4",88,0)
 .;
"RTN","ORKCHK4",89,0)
 .;duplicate class: NOW DRUG THERAPY
"RTN","ORKCHK4",90,0)
 .I $P(XX,U)="DC" D
"RTN","ORKCHK4",91,0)
 ..Q:ORDUPCF="D"
"RTN","ORKCHK4",92,0)
 ..S ORPSNUM=$P(XX,U,2)  ;get the associated order number
"RTN","ORKCHK4",93,0)
 ..S ORKMSG=$P(XX,U,4)
"RTN","ORKCHK4",94,0)
 ..S ORKS("ORK",ORDUPCD_","_$G(ORNUM)_","_ORPSNUM_","_$E(ORKMSG,1,225))=ORNUM_U_ORDUPCN_U_ORDUPCD_U_ORKMSG
"RTN","ORKCHK4",95,0)
 Q
"RTN","ORKCHK4",96,0)
 ;
"RTN","ORKCHK4",97,0)
OI2DD(ORPSA,OROI,ORPSPKG)       ;rtn dispense drugs for a PS OI
"RTN","ORKCHK4",98,0)
 N PSOI
"RTN","ORKCHK4",99,0)
 Q:'$D(^ORD(101.43,OROI,0))
"RTN","ORKCHK4",100,0)
 S PSOI=$P($P(^ORD(101.43,OROI,0),U,2),";")
"RTN","ORKCHK4",101,0)
 Q:+$G(PSOI)<1
"RTN","ORKCHK4",102,0)
 D DRG^PSSUTIL1(.ORPSA,PSOI,ORPSPKG)
"RTN","ORKCHK4",103,0)
 Q
"RTN","ORKCHK4",104,0)
 ;
"RTN","ORKCHK4",105,0)
PARAMS(ORKNAME,ORKNUM,ORKFLAG,ORKDNGR) ; get parameter values for an order chk
"RTN","ORKCHK4",106,0)
 S ORKNUM=0,ORKNUM=$O(^ORD(100.8,"B",ORKNAME,ORKNUM))
"RTN","ORKCHK4",107,0)
 S ORKFLAG=$$GET^XPAR(ORENT,"ORK PROCESSING FLAG",ORKNUM,"I")
"RTN","ORKCHK4",108,0)
 S ORKDNGR=$$GET^XPAR("DIV^SYS^PKG","ORK CLINICAL DANGER LEVEL",ORKNUM,"I")
"RTN","ORKCHK4",109,0)
 Q
"RTN","ORKCHK6")
0^3^B26186989
"RTN","ORKCHK6",1,0)
ORKCHK6 ; slc/CLA - Support routine called by ORKCHK to do SESSION mode order checks ;12/07/10  19:26
"RTN","ORKCHK6",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**6,32,74,87,94,123,162,190,249,280,272**;Dec 17, 1997;Build 53
"RTN","ORKCHK6",3,0)
 Q
"RTN","ORKCHK6",4,0)
 ;
"RTN","ORKCHK6",5,0)
EN(ORKS,ORKDFN,ORKA,ORENT,ORKTMODE) ;perform order checking for entire ordering session
"RTN","ORKCHK6",6,0)
 Q:$$GET^XPAR("DIV^SYS^PKG","ORK SYSTEM ENABLE/DISABLE",1,"I")="D"
"RTN","ORKCHK6",7,0)
 ;
"RTN","ORKCHK6",8,0)
 N OI,ORKDG,HL7,ODT,ORNUM,HL7NPTR,HL7NTXT,HL7NCOD,HL7LPTR,HL7LTXT,HL7LCOD
"RTN","ORKCHK6",9,0)
 N ORKMSG,ORKDGI,ORKT,ORKTXT,ORKPDATA,ORIFN
"RTN","ORKCHK6",10,0)
 ;
"RTN","ORKCHK6",11,0)
 S OI=$P(ORKA,"|"),ORKDG=$P(ORKA,"|",2),HL7=$P(ORKA,"|",3)
"RTN","ORKCHK6",12,0)
 S ODT=$P(ORKA,"|",4),ORNUM=$P(ORKA,"|",5),ORKPDATA=$P(ORKA,"|",6)
"RTN","ORKCHK6",13,0)
 S HL7NPTR=$P(HL7,U),HL7NTXT=$P(HL7,U,2),HL7NCOD=$P(HL7,U,3)
"RTN","ORKCHK6",14,0)
 S HL7LPTR=$P(HL7,U,4),HL7LTXT=$P(HL7,U,5),HL7LCOD=$P(HL7,U,6)
"RTN","ORKCHK6",15,0)
 S ORIFN=ORNUM
"RTN","ORKCHK6",16,0)
 ;
"RTN","ORKCHK6",17,0)
 S:ORKDG="PSJ" ORKDG="PSI"
"RTN","ORKCHK6",18,0)
 I $E(ORKDG,1,2)="PS" D PHARM
"RTN","ORKCHK6",19,0)
 I $E(ORKDG,1,2)'="PS" D MLM^ORKCHK2(.ORKS,ORKDFN,ORKA,ORENT,"SESSION")
"RTN","ORKCHK6",20,0)
 Q
"RTN","ORKCHK6",21,0)
 ;
"RTN","ORKCHK6",22,0)
PHARM ;process pharmacy order checks:
"RTN","ORKCHK6",23,0)
 N ORPSPKG,ORPSA,ORKDD
"RTN","ORKCHK6",24,0)
 N ORCRITN,ORCRITF,ORCRITD,ORSIGN,ORSIGF,ORSIGD,ORDUPN,ORDUPF,ORDUPD,ORDUPC,ORDUPCF,ORDUPCD,ORALLRN,ORALLRF,ORALLRD
"RTN","ORKCHK6",25,0)
 ;
"RTN","ORKCHK6",26,0)
 D PARAMS("ALLERGY-DRUG INTERACTION",.ORALLRN,.ORALLRF,.ORALLRD)
"RTN","ORKCHK6",27,0)
 D PARAMS("CRITICAL DRUG INTERACTION",.ORCRITN,.ORCRITF,.ORCRITD)
"RTN","ORKCHK6",28,0)
 D PARAMS("SIGNIFICANT DRUG INTERACTION",.ORSIGN,.ORSIGF,.ORSIGD)
"RTN","ORKCHK6",29,0)
 D PARAMS("DUPLICATE DRUG ORDER",.ORDUPN,.ORDUPF,.ORDUPD)
"RTN","ORKCHK6",30,0)
 D PARAMS("DUPLICATE DRUG THERAPY",.ORDUPCN,.ORDUPCF,.ORDUPCD)
"RTN","ORKCHK6",31,0)
 ;
"RTN","ORKCHK6",32,0)
 ;dispense drug selected:
"RTN","ORKCHK6",33,0)
 I $L($G(HL7LPTR)),($G(HL7LCOD)="99PSD") D
"RTN","ORKCHK6",34,0)
 .D RXOCS
"RTN","ORKCHK6",35,0)
 .D MLM^ORKCHK2(.ORKS,ORKDFN,ORKA,ORENT,"SESSION")
"RTN","ORKCHK6",36,0)
 ;
"RTN","ORKCHK6",37,0)
 ;dispense drug NOT selected, split OI into dispense drugs:
"RTN","ORKCHK6",38,0)
 I '$L($G(HL7LPTR)) D
"RTN","ORKCHK6",39,0)
 .S ORPSPKG=$E(ORKDG,3)
"RTN","ORKCHK6",40,0)
 .I ORPSPKG="H" S ORPSPKG="X"  ;change to "X" if "H"erbal/non-VA med
"RTN","ORKCHK6",41,0)
 .I "IOX"[ORPSPKG D OI2DD^ORKPS(.ORPSA,OI,ORPSPKG)
"RTN","ORKCHK6",42,0)
 .S ORKDD=0 F  S ORKDD=$O(ORPSA(ORKDD)) Q:'ORKDD  D
"RTN","ORKCHK6",43,0)
 ..;S HL7LTXT=ORPSA(ORKDD)
"RTN","ORKCHK6",44,0)
 ..S HL7LTXT=$P($G(^ORD(101.43,OI,0)),U)
"RTN","ORKCHK6",45,0)
 ..S HL7NPTR=$P(ORKDD,";",2)
"RTN","ORKCHK6",46,0)
 ..S HL7LPTR=+ORKDD
"RTN","ORKCHK6",47,0)
 ..S HL7LCOD="99PSD",HL7NCOD="99NDF"
"RTN","ORKCHK6",48,0)
 ..S $P(HL7,U)=HL7NPTR,$P(HL7,U,3)=HL7NCOD
"RTN","ORKCHK6",49,0)
 ..S $P(HL7,U,4)=HL7LPTR,$P(HL7,U,5)=HL7LTXT,$P(HL7,U,6)=HL7LCOD
"RTN","ORKCHK6",50,0)
 ..S $P(ORKA,"|",3)=HL7  ;set these for MLM OCX call
"RTN","ORKCHK6",51,0)
 ..D RXOCS
"RTN","ORKCHK6",52,0)
 ..D MLM^ORKCHK2(.ORKS,ORKDFN,ORKA,ORENT,"SESSION")
"RTN","ORKCHK6",53,0)
 Q
"RTN","ORKCHK6",54,0)
 ;
"RTN","ORKCHK6",55,0)
RXOCS ;drug-drug interaction, duplicate drug order, duplicate drug class
"RTN","ORKCHK6",56,0)
 Q:ORCRITF_ORSIGF_ORDUPF_ORDUPCF_ORALLRF'["E"  ;quit if none are "E"nabled
"RTN","ORKCHK6",57,0)
 N ORKRX,ORPSNUM
"RTN","ORKCHK6",58,0)
 I $L($G(HL7LPTR)),($G(HL7LCOD)="99PSD") D
"RTN","ORKCHK6",59,0)
 .D CHKSESS^ORKPS(.ORKRX,ORKDFN,HL7LPTR_U_HL7LTXT,OI,ORKPDATA,ORKDG)
"RTN","ORKCHK6",60,0)
 .N CHK,XX S CHK=0,XX=""
"RTN","ORKCHK6",61,0)
 .F  S CHK=$O(ORKRX(CHK)) Q:'CHK  D
"RTN","ORKCHK6",62,0)
 ..S XX=ORKRX(CHK)
"RTN","ORKCHK6",63,0)
 ..;
"RTN","ORKCHK6",64,0)
 ..;get errors/exceptions/checks not done
"RTN","ORKCHK6",65,0)
 ..I $P(XX,U)="ERR" S ORKS("ORK",2_$E($P(XX,U,2),1,225))=ORNUM_U_25_U_3_U_$P(XX,U,2)
"RTN","ORKCHK6",66,0)
 ..;
"RTN","ORKCHK6",67,0)
 ..;critical drug interaction:
"RTN","ORKCHK6",68,0)
 ..I $P(XX,U)="DI",$P(XX,U,2)="CRITICAL" D
"RTN","ORKCHK6",69,0)
 ...Q:ORCRITF="D"
"RTN","ORKCHK6",70,0)
 ...S ORPSNUM=$P(XX,U,3)
"RTN","ORKCHK6",71,0)
 ...S ORKTXT=$P(XX,U,2)_" drug-drug interaction: "_$P(XX,U,5)
"RTN","ORKCHK6",72,0)
 ...S ORKMSG=$P(XX,U,2)_" drug-drug interaction: "_$P(XX,U,6)
"RTN","ORKCHK6",73,0)
 ...S ORKS("ORK",ORCRITD_","_$G(ORNUM)_","_ORPSNUM_","_$E(ORKMSG,1,225))=ORNUM_U_ORCRITN_U_ORCRITD_U_ORKTXT
"RTN","ORKCHK6",74,0)
 ..;
"RTN","ORKCHK6",75,0)
 ..;significant drug interaction:
"RTN","ORKCHK6",76,0)
 ..I $P(XX,U)="DI",$P(XX,U,2)="SIGNIFICANT" D
"RTN","ORKCHK6",77,0)
 ...Q:ORSIGF="D"
"RTN","ORKCHK6",78,0)
 ...S ORPSNUM=$P(XX,U,3)
"RTN","ORKCHK6",79,0)
 ...S ORKTXT=$P(XX,U,2)_" drug-drug interaction: "_$P(XX,U,5)
"RTN","ORKCHK6",80,0)
 ...S ORKMSG=$P(XX,U,2)_" drug-drug interaction: "_$P(XX,U,6)
"RTN","ORKCHK6",81,0)
 ...S ORKS("ORK",ORSIGD_","_$G(ORNUM)_","_ORPSNUM_","_$E(ORKMSG,1,225))=ORNUM_U_ORSIGN_U_ORSIGD_U_ORKTXT
"RTN","ORKCHK6",82,0)
 ..;
"RTN","ORKCHK6",83,0)
 ..;duplicate drug:
"RTN","ORKCHK6",84,0)
 ..I $P(XX,U)="DD" D
"RTN","ORKCHK6",85,0)
 ...Q:ORDUPF="D"
"RTN","ORKCHK6",86,0)
 ...S ORPSNUM=$P(XX,U,4)  ;get the associated order number
"RTN","ORKCHK6",87,0)
 ...I $L(ORPSNUM),$G(^OR(100,+ORPSNUM,0)) S ORKT=$$FULLTEXT^ORQOR1(+ORPSNUM),ORKTXT=$P(ORKT,U)_" ["_$P(ORKT,U,2)_"]"
"RTN","ORKCHK6",88,0)
 ...E  S ORKTXT=$P(XX,U,3)
"RTN","ORKCHK6",89,0)
 ...S ORKMSG="Duplicate drug order: "_ORKTXT
"RTN","ORKCHK6",90,0)
 ...S ORKS("ORK",ORDUPD_","_$G(ORNUM)_","_ORPSNUM_",Duplicate drug order: "_$E($P(XX,U,3),1,200))=ORNUM_U_ORDUPN_U_ORDUPD_U_ORKMSG_U_$G(ORPSNUM)
"RTN","ORKCHK6",91,0)
 ..;
"RTN","ORKCHK6",92,0)
 ..;duplicate class: NOW DRUG THERAPY
"RTN","ORKCHK6",93,0)
 ..I $P(XX,U)="DC" D
"RTN","ORKCHK6",94,0)
 ...Q:ORDUPCF="D"
"RTN","ORKCHK6",95,0)
 ...S ORPSNUM=$P(XX,U,2)  ;get the associated order number
"RTN","ORKCHK6",96,0)
 ...S ORKMSG=$P(XX,U,4)
"RTN","ORKCHK6",97,0)
 ...S ORKS("ORK",ORDUPCD_","_$G(ORNUM)_","_ORPSNUM_","_$E(ORKMSG,1,225))=ORNUM_U_ORDUPCN_U_ORDUPCD_U_ORKMSG
"RTN","ORKCHK6",98,0)
 Q:ORALLRF="D"
"RTN","ORKCHK6",99,0)
 N ORKAL
"RTN","ORKCHK6",100,0)
 I $L($G(HL7NPTR)),($G(HL7NCOD)="99NDF") D
"RTN","ORKCHK6",101,0)
 .D RXN^ORQQAL(.ORKAL,ORKDFN,"DR",HL7NPTR,$G(HL7LPTR)) I (ORKAL>0) D
"RTN","ORKCHK6",102,0)
 ..Q:$L($P(ORKAL,U,2))<1
"RTN","ORKCHK6",103,0)
 ..S ORKMSG="Previous adverse reaction to: "_$P(ORKAL,U,2)
"RTN","ORKCHK6",104,0)
 ..S ORKS("ORK",ORALLRD_","_$G(ORNUM)_","_$E(ORKMSG,1,225))=ORNUM_U_ORALLRN_U_ORALLRD_U_ORKMSG
"RTN","ORKCHK6",105,0)
 Q
"RTN","ORKCHK6",106,0)
 ;
"RTN","ORKCHK6",107,0)
PARAMS(ORKNAME,ORKNUM,ORKFLAG,ORKDNGR) ; get parameter values for an order chk
"RTN","ORKCHK6",108,0)
 S ORKNUM=0,ORKNUM=$O(^ORD(100.8,"B",ORKNAME,ORKNUM))
"RTN","ORKCHK6",109,0)
 S ORKFLAG=$$GET^XPAR(ORENT,"ORK PROCESSING FLAG",ORKNUM,"I")
"RTN","ORKCHK6",110,0)
 S ORKDNGR=$$GET^XPAR("DIV^SYS^PKG","ORK CLINICAL DANGER LEVEL",ORKNUM,"I")
"RTN","ORKCHK6",111,0)
 Q
"RTN","ORKPS")
0^4^B59221403
"RTN","ORKPS",1,0)
ORKPS ; slc/CLA - Order checking support procedures for medications ;12/14/10  08:57
"RTN","ORKPS",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**6,32,74,94,123,141,190,232,316,272**;Dec 17, 1997;Build 53
"RTN","ORKPS",3,0)
 Q
"RTN","ORKPS",4,0)
CHECK(YY,DFN,MED,OI,ORKDG) ; return drug order checks
"RTN","ORKPS",5,0)
 ;YY:    returned array of data
"RTN","ORKPS",6,0)
 ;DFN:   patient id
"RTN","ORKPS",7,0)
 ;MED:   drug ien [file #50]
"RTN","ORKPS",8,0)
 ;OI:    orderable item ien [file #101.43
"RTN","ORKPS",9,0)
 ;ORKDG: display group (should be PSI, PSIV, PSO or PSH)
"RTN","ORKPS",10,0)
 ; returned info: varies for ^TMP($J x-ref - refer to listings below
"RTN","ORKPS",11,0)
 K ^TMP($J,"OROCOUT"),^TMP($J,"DD")
"RTN","ORKPS",12,0)
 N ORDFN,ORKA,ORPTY,ORPHOI S ORDFN=DFN
"RTN","ORKPS",13,0)
 S ORPHOI=+$P($G(^ORD(101.43,+OI,0)),U,2)
"RTN","ORKPS",14,0)
 S ORPTY=$S($G(ORKDG)="PSI":"I;",$G(ORKDG)="PSIV":"I;",$G(ORKDG)="PSO":"O;",$G(ORKDG)="PSH":"O;",1:"O;")
"RTN","ORKPS",15,0)
 I $$PRE^PSSDSAPK(ORPHOI)=0,($$SOLUT^ORKPS(OI)) Q  ; Dont do checks if the drug is a solution but not a premix
"RTN","ORKPS",16,0)
 S ORKA(1)=MED_U_$$GETPSNM(+MED) D CPRS^PSODDPR4(ORDFN,"OROCOUT",.ORKA,ORPTY_+$G(^OR(100,+$G(ORIFN),4)))
"RTN","ORKPS",17,0)
 D PROCESS^ORKPS1(OI,ORDFN,ORKDG,+ORKA(1))
"RTN","ORKPS",18,0)
 K ^TMP($J,"OROCOUT"),^TMP($J,"DD")
"RTN","ORKPS",19,0)
 Q
"RTN","ORKPS",20,0)
CHKSESS(YY,DFN,MED,OI,ORKPDATA,ORKDG) ; return drug order checks for session
"RTN","ORKPS",21,0)
 N ORKDGI,ORKDRUG,ORKDRUGA,ORKORN,HOR,SEQ,CNT,CNTX,ORKOI,ORPHOI
"RTN","ORKPS",22,0)
 N ORKFLG,ORSESS,ORPSPKG,ORPSA,ORKDD,ORSNUM,ORNUM,DUPX,DUPORN,ORPTY
"RTN","ORKPS",23,0)
 N ORDFN S ORDFN=DFN
"RTN","ORKPS",24,0)
 S ORKFLG=0
"RTN","ORKPS",25,0)
 S ORNUM=$P(ORKA,"|",5)
"RTN","ORKPS",26,0)
 S ORPHOI=+$P($G(^ORD(101.43,+OI,0)),U,2)
"RTN","ORKPS",27,0)
 I $$PRE^PSSDSAPK(ORPHOI)=0,($$SOLUT^ORKPS(OI)) Q  ; Dont do checks if the drug is a solution but not a premix
"RTN","ORKPS",28,0)
 ;
"RTN","ORKPS",29,0)
 ;get other session med orders:
"RTN","ORKPS",30,0)
 I $D(^TMP("ORKA",$J)) D
"RTN","ORKPS",31,0)
 .S CNT=^TMP("ORKA",$J) F CNTX=1:1:CNT D
"RTN","ORKPS",32,0)
 ..S ORSESS=$G(^TMP("ORKA",$J,CNTX))
"RTN","ORKPS",33,0)
 ..Q:'$L(ORSESS)
"RTN","ORKPS",34,0)
 ..S ORPSPKG=$P(ORSESS,"|",2)
"RTN","ORKPS",35,0)
 ..Q:'$L(ORPSPKG)
"RTN","ORKPS",36,0)
 ..Q:$E(ORPSPKG,1,2)'="PS"
"RTN","ORKPS",37,0)
 ..S ORSNUM=$P(ORSESS,"|",5)
"RTN","ORKPS",38,0)
 ..S ORKOI=$P(ORSESS,"|")
"RTN","ORKPS",39,0)
 ..;quit if same order/oi:
"RTN","ORKPS",40,0)
 ..Q:((+$G(ORNUM)=+$G(ORSNUM))&(+$G(OI)=+$G(ORKOI)))
"RTN","ORKPS",41,0)
 ..S:ORPSPKG="PSJ" ORPSPKG="PSI"
"RTN","ORKPS",42,0)
 ..S ORKDRUG=$P($P(ORSESS,"|",3),U,4)
"RTN","ORKPS",43,0)
 ..;
"RTN","ORKPS",44,0)
 ..;if no disp drug selected get disp drug(s) from OI:
"RTN","ORKPS",45,0)
 ..I +$G(ORKDRUG)<1,$L(ORKOI) D
"RTN","ORKPS",46,0)
 ...I "IOH"[$E(ORPSPKG,3) D OI2DD(.ORPSA,ORKOI,$E(ORPSPKG,3)) D
"RTN","ORKPS",47,0)
 ....S ORKDD=0 F  S ORKDD=$O(ORPSA(ORKDD)) Q:'ORKDD  D
"RTN","ORKPS",48,0)
 .....S ORKDRUG=+ORKDD
"RTN","ORKPS",49,0)
 .....S:+$G(ORKDRUG)>0 ORKDRUGA(ORKDRUG_";"_ORPSPKG_";"_ORSNUM)=ORSNUM_U_$P($G(^ORD(101.43,ORKOI,0)),U),ORKDRUG=0
"RTN","ORKPS",50,0)
 ...K ORPSA  ;need to clean out between calls to OI2DD
"RTN","ORKPS",51,0)
 ..;
"RTN","ORKPS",52,0)
 ..Q:+$G(ORKDRUG)<1
"RTN","ORKPS",53,0)
 ..;if dispense drug selected add to array:
"RTN","ORKPS",54,0)
 ..S ORKDRUGA(ORKDRUG_";"_ORPSPKG_";"_ORSNUM)=ORSNUM_U_$$GETPSNM(+ORKDRUG)
"RTN","ORKPS",55,0)
 ;
"RTN","ORKPS",56,0)
 ;get unsigned medication orders:
"RTN","ORKPS",57,0)
 S HOR=0,SEQ=0
"RTN","ORKPS",58,0)
 S HOR=$O(^TMP("ORR",$J,HOR)) I +$G(HOR)>0 D
"RTN","ORKPS",59,0)
 .F  S SEQ=$O(^TMP("ORR",$J,HOR,SEQ)) Q:+SEQ<1  D
"RTN","ORKPS",60,0)
 ..S ORKORN=+$P(^TMP("ORR",$J,HOR,SEQ),U),DUPORN=0
"RTN","ORKPS",61,0)
 ..Q:+$G(ORKORN)<1
"RTN","ORKPS",62,0)
 ..Q:+ORKORN=+ORNUM
"RTN","ORKPS",63,0)
 ..Q:$P(^OR(100,+ORKORN,8,$P(^OR(100,+ORKORN,8,0),U,3),0),U,2)="DC"
"RTN","ORKPS",64,0)
 ..Q:$P(^ORD(100.01,$P(^OR(100,+ORKORN,3),U,3),0),U)="DISCONTINUED"
"RTN","ORKPS",65,0)
 ..S ORKDRUG=$$VALUE^ORCSAVE2(+ORKORN,"DRUG") ;get disp drug for order
"RTN","ORKPS",66,0)
 ..;only process vs. unsigned med order if disp drug is assoc w/order:
"RTN","ORKPS",67,0)
 ..Q:+$G(ORKDRUG)<1
"RTN","ORKPS",68,0)
 ..S ORPSPKG=$$DGRX^ORQOR2(+ORKORN)
"RTN","ORKPS",69,0)
 ..S ORPSPKG=$S(ORPSPKG="UNIT DOSE MEDICATIONS":"PSI",ORPSPKG="OUTPATIENT MEDICATIONS":"PSO",ORPSPKG="IV MEDICATIONS":"PSIV",ORPSPKG="NON-VA MEDICATIONS":"PSH",1:"")
"RTN","ORKPS",70,0)
 ..S DUPX="" F  S DUPX=$O(ORKDRUGA(DUPX)) Q:'DUPX!(DUPORN=1)  D
"RTN","ORKPS",71,0)
 ...S:ORKORN=ORKDRUGA(DUPX) DUPORN=1
"RTN","ORKPS",72,0)
 ..Q:DUPORN=1  ;quit if already processed drug order
"RTN","ORKPS",73,0)
 ..S ORKDRUGA(+ORKDRUG_";"_ORPSPKG_";"_ORKORN)=ORKORN_U_$$GETPSNM(+ORKDRUG)
"RTN","ORKPS",74,0)
 S ORPTY=$S($G(ORKDG)="PSI":"I;",$G(ORKDG)="PSIV":"I;",$G(ORKDG)="PSO":"O;",$G(ORKDG)="PSH":"O;",1:"O;")
"RTN","ORKPS",75,0)
 K ^TMP($J,"DD"),^TMP($J,"OROCOUT")
"RTN","ORKPS",76,0)
 N ORPROSP,CNT
"RTN","ORKPS",77,0)
 S CNT=1
"RTN","ORKPS",78,0)
 S ORPROSP(CNT)=MED_U_$$GETPSNM(+MED)
"RTN","ORKPS",79,0)
 ;N I S I="" F  S I=$O(ORKDRUGA(I)) Q:'I  S CNT=CNT+1,ORPROSP(CNT)=+I_U_$$GETPSNM(+I)
"RTN","ORKPS",80,0)
 N I S I="" F  S I=$O(ORKDRUGA(I)) Q:'I  S CNT=CNT+1,ORPROSP(CNT)=+I_U_$P(ORKDRUGA(I),U,2)
"RTN","ORKPS",81,0)
 D CPRS^PSODDPR4(DFN,"OROCOUT",.ORPROSP,ORPTY_+$G(^OR(100,+$G(ORNUM),4)))
"RTN","ORKPS",82,0)
 D PROCESS^ORKPS1(OI,ORDFN,ORKDG,+ORPROSP(1))
"RTN","ORKPS",83,0)
 K ^TMP($J,"DD"),^TMP($J,"OROCOUT")
"RTN","ORKPS",84,0)
 Q
"RTN","ORKPS",85,0)
GETPSNM(ORIEN) ;GET THE FILE 50 .01 FIELD FROM A FILE 50 IEN
"RTN","ORKPS",86,0)
 N RET K ^TMP($J,"ORRETNM")
"RTN","ORKPS",87,0)
 D NDF^PSS50(ORIEN,,,,,"ORRETNM") S RET=$G(^TMP($J,"ORRETNM",ORIEN,.01))
"RTN","ORKPS",88,0)
 K ^TMP($J,"ORRETNM")
"RTN","ORKPS",89,0)
 Q RET
"RTN","ORKPS",90,0)
TAKEMED(ORKDFN,ORKMED) ;extrinsic function returns med orderable item if any
"RTN","ORKPS",91,0)
 ;active med patient is taking contains any piece of ORKMED
"RTN","ORKPS",92,0)
 ;ORKDFN   patient DFN
"RTN","ORKPS",93,0)
 ;ORKMED   meds to check vs. active med list in format MED1^MED2^MED3...
"RTN","ORKPS",94,0)
 Q:'$L($G(ORKDFN)) "0^Patient not identified."
"RTN","ORKPS",95,0)
 Q:'$L($G(ORKMED)) "0^Medication not identified."
"RTN","ORKPS",96,0)
 N ORKARX,ORKY,ORI,ORJ,ORCNT,ORKMEDP,ORKRSLT
"RTN","ORKPS",97,0)
 D LIST^ORQQPS(.ORKY,ORKDFN,"","")
"RTN","ORKPS",98,0)
 Q:$P(ORKY(1),U)="" "0^No active meds found."
"RTN","ORKPS",99,0)
 S ORKRSLT="0^No matching meds found."
"RTN","ORKPS",100,0)
 S ORCNT=$L(ORKMED,U)
"RTN","ORKPS",101,0)
 S ORI=0 F  S ORI=$O(ORKY(ORI)) Q:ORI<1  D
"RTN","ORKPS",102,0)
 .S ORKARX=$P(ORKY(ORI),U,2)
"RTN","ORKPS",103,0)
 .F ORJ=1:1:ORCNT S ORKMEDP=$P(ORKMED,U,ORJ) D
"RTN","ORKPS",104,0)
 ..I $L(ORKMEDP),($$UP^XLFSTR(ORKARX)[ORKMEDP) S ORKRSLT="1^"_ORKARX ;DJE/VM *316 use uppercase in comparison
"RTN","ORKPS",105,0)
 Q ORKRSLT
"RTN","ORKPS",106,0)
SOLUT(OI) ;extrinsic function returns 1 (true) if the orderable item is
"RTN","ORKPS",107,0)
 ; a solution (IV Base)
"RTN","ORKPS",108,0)
 Q:+$G(OI)<1 ""
"RTN","ORKPS",109,0)
 N OITEXT
"RTN","ORKPS",110,0)
 S OITEXT=$G(^ORD(101.43,OI,0))
"RTN","ORKPS",111,0)
 Q:'$L(OITEXT) ""
"RTN","ORKPS",112,0)
 S OITEXT=$P(OITEXT,U)
"RTN","ORKPS",113,0)
 Q:$D(^ORD(101.43,"S.IVB RX",OITEXT)) 1
"RTN","ORKPS",114,0)
 Q ""
"RTN","ORKPS",115,0)
POLYRX(DFN) ;extrins funct rtns 1 if patient exceeds polypharmacy, 0 if not
"RTN","ORKPS",116,0)
 N ORSLT,ORENT,ORLOC,ORPAR,ORMEDS
"RTN","ORKPS",117,0)
 S ORSLT=0
"RTN","ORKPS",118,0)
 Q:'$L(DFN) ORSLT
"RTN","ORKPS",119,0)
 S VA200="" D OERR^VADPT
"RTN","ORKPS",120,0)
 S ORLOC=+$G(^DIC(42,+VAIN(4),44))
"RTN","ORKPS",121,0)
 K VA200,VAIN
"RTN","ORKPS",122,0)
 S ORENT=+$G(ORLOC)_";SC(^DIV^SYS^PKG"
"RTN","ORKPS",123,0)
 S ORPAR=$$GET^XPAR(ORENT,"ORK POLYPHARMACY",1,"I")
"RTN","ORKPS",124,0)
 S ORMEDS=$$NUMRX(DFN)
"RTN","ORKPS",125,0)
 I $G(ORMEDS)>$G(ORPAR) S ORSLT=1
"RTN","ORKPS",126,0)
 Q ORSLT
"RTN","ORKPS",127,0)
GLCREAT(DFN) ;extrinsic function returns patient's (DFN) most recent serum
"RTN","ORKPS",128,0)
 ; creatinine within # of days from parameter ORK GLUCOPHAGE CREATININE
"RTN","ORKPS",129,0)
 ; results format: test id^result units flag ref range collect d/t^result
"RTN","ORKPS",130,0)
 ; used by order check GLUCOPHAGE-LAB RESULTS
"RTN","ORKPS",131,0)
 N ORLOC,ORPAR,ORDAYS
"RTN","ORKPS",132,0)
 N BDT,CDT,ORY,ORX,ORZ,TEST,ORI,ORJ,CREARSLT,LABFILE,SPECFILE,SPECIMEN
"RTN","ORKPS",133,0)
 Q:'$L(DFN) "0^"
"RTN","ORKPS",134,0)
 S ORDAYS=$$GCDAYS(DFN)
"RTN","ORKPS",135,0)
 Q:'$L(ORDAYS) "0^"
"RTN","ORKPS",136,0)
 D NOW^%DTC
"RTN","ORKPS",137,0)
 S BDT=$$FMADD^XLFDT(%,"-"_ORDAYS,"","","")
"RTN","ORKPS",138,0)
 K %
"RTN","ORKPS",139,0)
 Q:'$L($G(BDT)) "0^"
"RTN","ORKPS",140,0)
 S LABFILE=$$TERMLKUP^ORB31(.ORY,"SERUM CREATININE")
"RTN","ORKPS",141,0)
 Q:'$D(ORY) "0^" ;no link between SERUM CREATININE and local lab test
"RTN","ORKPS",142,0)
 Q:$G(LABFILE)'=60 "0^"
"RTN","ORKPS",143,0)
 S SPECFILE=$$TERMLKUP^ORB31(.ORX,"SERUM SPECIMEN")
"RTN","ORKPS",144,0)
 Q:'$D(ORX) "0^" ;no link between SERUM SPECIMEN and local specimen
"RTN","ORKPS",145,0)
 Q:$G(SPECFILE)'=61 "0^"
"RTN","ORKPS",146,0)
 F ORI=1:1:ORY I +$G(CREARSLT)<1 D
"RTN","ORKPS",147,0)
 .S TEST=$P(ORY(ORI),U)
"RTN","ORKPS",148,0)
 .Q:+$G(TEST)<1
"RTN","ORKPS",149,0)
 .F ORJ=1:1:ORX I +$G(CREARSLT)<1 D
"RTN","ORKPS",150,0)
 ..S SPECIMEN=$P(ORX(ORJ),U)
"RTN","ORKPS",151,0)
 ..Q:+$G(SPECIMEN)<1
"RTN","ORKPS",152,0)
 ..S ORZ=$$LOCL^ORQQLR1(DFN,TEST,SPECIMEN)
"RTN","ORKPS",153,0)
 ..Q:'$L($G(ORZ))
"RTN","ORKPS",154,0)
 ..S CDT=$P(ORZ,U,7)
"RTN","ORKPS",155,0)
 ..I CDT'<BDT S CREARSLT=1
"RTN","ORKPS",156,0)
 Q:+$G(CREARSLT)<1 "0^"
"RTN","ORKPS",157,0)
 Q $P(ORZ,U)_U_$P(ORZ,U,3)_" "_$P(ORZ,U,4)_" "_$P(ORZ,U,5)_" ("_$P(ORZ,U,6)_")  "_$$FMTE^XLFDT(CDT,"2P")_U_$P(ORZ,U,3)
"RTN","ORKPS",158,0)
GCDAYS(DFN) ;extrinsic function to return number of days to look for
"RTN","ORKPS",159,0)
 ; glucophage serum creatinine result
"RTN","ORKPS",160,0)
 Q:'$L(DFN) ""
"RTN","ORKPS",161,0)
 N ORLOC,ORENT,ORDAYS
"RTN","ORKPS",162,0)
 ;get patient's location flag (INPATIENT ONLY - outpt locations cannot be
"RTN","ORKPS",163,0)
 ;reliably determined, and many simultaneous outpt locations can occur):
"RTN","ORKPS",164,0)
 S VA200="" D OERR^VADPT
"RTN","ORKPS",165,0)
 S ORLOC=+$G(^DIC(42,+VAIN(4),44))
"RTN","ORKPS",166,0)
 K VA200,VAIN
"RTN","ORKPS",167,0)
 S ORENT=+$G(ORLOC)_";SC(^DIV^SYS^PKG"
"RTN","ORKPS",168,0)
 S ORDAYS=$$GET^XPAR(ORENT,"ORK GLUCOPHAGE CREATININE",1,"I")
"RTN","ORKPS",169,0)
 Q:$L(ORDAYS) ORDAYS
"RTN","ORKPS",170,0)
 Q ""
"RTN","ORKPS",171,0)
SUPPLY(OI) ;extrinsic function returns 1 (true) if the orderable item is
"RTN","ORKPS",172,0)
 ; a supply
"RTN","ORKPS",173,0)
 Q:+$G(OI)<1 ""
"RTN","ORKPS",174,0)
 N OITEXT
"RTN","ORKPS",175,0)
 S OITEXT=$G(^ORD(101.43,OI,0))
"RTN","ORKPS",176,0)
 Q:'$L(OITEXT) ""
"RTN","ORKPS",177,0)
 S OITEXT=$P(OITEXT,U)
"RTN","ORKPS",178,0)
 Q:$D(^ORD(101.43,"S.SPLY",OITEXT)) 1
"RTN","ORKPS",179,0)
 Q ""
"RTN","ORKPS",180,0)
NUMRX(DFN) ;extrinsic funct returns number of active meds patient is taking
"RTN","ORKPS",181,0)
 N NUMRX,ORPTYPE,ORX,ORY,ORS,ORNUM,ORPRENEW
"RTN","ORKPS",182,0)
 S NUMRX=0
"RTN","ORKPS",183,0)
 Q:+$G(DFN)<1 NUMRX
"RTN","ORKPS",184,0)
 ;
"RTN","ORKPS",185,0)
 ;check to determine if inpatient or outpatient:
"RTN","ORKPS",186,0)
 D ADM^VADPT2
"RTN","ORKPS",187,0)
 S ORPTYPE=$S(+$G(VADMVT)>0:"I",1:"O")
"RTN","ORKPS",188,0)
 ;
"RTN","ORKPS",189,0)
 K ^TMP("PS",$J)
"RTN","ORKPS",190,0)
 D OCL^PSOORRL(DFN,"","")  ;if no date range, returns active meds for pt
"RTN","ORKPS",191,0)
 N X
"RTN","ORKPS",192,0)
 S X=0
"RTN","ORKPS",193,0)
 F  S X=$O(^TMP("PS",$J,X)) Q:X<1  D
"RTN","ORKPS",194,0)
 .S ORX=$G(^TMP("PS",$J,X,0))
"RTN","ORKPS",195,0)
 .S ORY=$P(ORX,U)
"RTN","ORKPS",196,0)
 .S ORNUM=$P(ORX,U,8) ;order entry order number
"RTN","ORKPS",197,0)
 .S ORS=$P(ORX,U,9) ;medication status from pharmacy
"RTN","ORKPS",198,0)
 .S ORPRENEW=$P(ORX,U,14)  ;pending renewal flag (1: pending renewal)
"RTN","ORKPS",199,0)
 .Q:+ORX<1
"RTN","ORKPS",200,0)
 .Q:$P(ORY,";",2)'=ORPTYPE  ;quit if med is not pt type (inpt/outpt)
"RTN","ORKPS",201,0)
 .;quit if status is a non-active type:
"RTN","ORKPS",202,0)
 .Q:$G(ORS)="EXPIRED"
"RTN","ORKPS",203,0)
 .Q:$G(ORS)["DISCONTINUE"
"RTN","ORKPS",204,0)
 .Q:$G(ORS)="DELETED"
"RTN","ORKPS",205,0)
 .Q:+$G(ORPRENEW)>0
"RTN","ORKPS",206,0)
 .Q:$$SUPPLY($$OI^ORQOR2(ORNUM))=1  ;quit if a supply
"RTN","ORKPS",207,0)
 .S NUMRX=NUMRX+1
"RTN","ORKPS",208,0)
 K ^TMP("PS",$J)
"RTN","ORKPS",209,0)
 Q NUMRX
"RTN","ORKPS",210,0)
OI2DD(ORPSA,OROI,ORPSPKG)       ;rtn dispense drugs for a PS OI
"RTN","ORKPS",211,0)
 N PSOI,ORTMP1,ORTMP2,ORRET
"RTN","ORKPS",212,0)
 Q:'$D(^ORD(101.43,OROI,0))
"RTN","ORKPS",213,0)
 S PSOI=$P($P(^ORD(101.43,OROI,0),U,2),";")
"RTN","ORKPS",214,0)
 Q:+$G(PSOI)<1
"RTN","ORKPS",215,0)
 S:ORPSPKG="H" ORPSPKG="X"  ;if non-va med need to pass api "X"
"RTN","ORKPS",216,0)
 S ORRET=$$DRG^PSSDSAPM(PSOI,ORPSPKG)
"RTN","ORKPS",217,0)
 I +ORRET S ORPSA(ORRET)=""
"RTN","ORKPS",218,0)
 Q
"RTN","ORKPS1")
0^5^B67186878
"RTN","ORKPS1",1,0)
ORKPS1 ; slc/CLA - Order checking support procedures for medications ;12/14/10  08:56
"RTN","ORKPS1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**232,272**;Dec 17, 1997;Build 53
"RTN","ORKPS1",3,0)
 Q
"RTN","ORKPS1",4,0)
PROCESS(OI,DFN,ORKDG,ORPROSP) ;process data from pharmacy order check API
"RTN","ORKPS1",5,0)
 ;ORPROSP = the med that is being checked
"RTN","ORKPS1",6,0)
 Q:'$D(^TMP($J))
"RTN","ORKPS1",7,0)
 ;K ^TMP($J,"ORMONOGRAPH")
"RTN","ORKPS1",8,0)
 N II,XX,ZZ,ZZD,ORMTYPE,ORN,ORZ,RCNT,GL,I,J,K,L,M,TDATA,VADMVT,ORX,ORY
"RTN","ORKPS1",9,0)
 S II=1,XX=0,ZZ="",ZZD="",RCNT=0
"RTN","ORKPS1",10,0)
 I $G(^TMP($J,"OROCOUT","OUT",0))<0 D  Q
"RTN","ORKPS1",11,0)
 .S YY(II)="ERR^Drug-Drug order checks (Duplicate Therapy, Duplicate Drug, Drug Interaction) were not able to be performed. "_$P($G(^TMP($J,"OROCOUT","OUT",0)),U,2)
"RTN","ORKPS1",12,0)
 .S II=II+1
"RTN","ORKPS1",13,0)
 I $D(^TMP($J,"OROCOUT","OUT","EXCEPTIONS")) D
"RTN","ORKPS1",14,0)
 .S ORX="" F  S ORX=$O(^TMP($J,"OROCOUT","OUT","EXCEPTIONS",ORX)) Q:'$L(ORX)  D
"RTN","ORKPS1",15,0)
 ..S ORY=0 F  S ORY=$O(^TMP($J,"OROCOUT","OUT","EXCEPTIONS",ORX,ORY)) Q:'ORY  D
"RTN","ORKPS1",16,0)
 ...S YY(II)="ERR^"_$P($G(^TMP($J,"OROCOUT","OUT","EXCEPTIONS",ORX,ORY)),U,7)
"RTN","ORKPS1",17,0)
 ...I $L($P($G(^TMP($J,"OROCOUT","OUT","EXCEPTIONS",ORX,ORY)),U,10))>0 S YY(II)=YY(II)_"("_$P($G(^TMP($J,"OROCOUT","OUT","EXCEPTIONS",ORX,ORY)),U,10)_")"
"RTN","ORKPS1",18,0)
 ...S II=II+1
"RTN","ORKPS1",19,0)
 S ORX="" F ORX="DRUGDRUG","THERAPY" D
"RTN","ORKPS1",20,0)
 .Q:'$D(^TMP($J,"OROCOUT","OUT",ORX,"ERROR"))
"RTN","ORKPS1",21,0)
 .S ORY="" F  S ORY=$O(^TMP($J,"OROCOUT","OUT",ORX,"ERROR",ORY)) Q:'$L(ORY)  D
"RTN","ORKPS1",22,0)
 ..S ORZ=0 F  S ORZ=$O(^TMP($J,"OROCOUT","OUT",ORX,"ERROR",ORY,ORZ)) Q:'ORZ  D
"RTN","ORKPS1",23,0)
 ...S YY(II)="ERR^"_$$UPPER^ORWDPS32($G(^TMP($J,"OROCOUT","OUT",ORX,"ERROR",ORY,ORZ,"SEV")))_": "_$P($G(^TMP($J,"OROCOUT","OUT",ORX,"ERROR",ORY,ORZ,0)),U)_" - "_$G(^TMP($J,"OROCOUT","OUT",ORX,"ERROR",ORY,ORZ,"TEXT"))
"RTN","ORKPS1",24,0)
 ...S II=II+1
"RTN","ORKPS1",25,0)
 ;set info about the drug being ordered
"RTN","ORKPS1",26,0)
 S TDATA("NEW","TXT")=""
"RTN","ORKPS1",27,0)
 S I="" F  S I=$O(^TMP($J,"OROCOUT","IN","PROSPECTIVE",I)) Q:'$L(I)  D
"RTN","ORKPS1",28,0)
 .I $P(I,";",4)=1 S TDATA("NEW","TXT")=$P($G(^TMP($J,"OROCOUT","IN","PROSPECTIVE",I)),U,4)
"RTN","ORKPS1",29,0)
 I $L(ORKDG) S TDATA("NEW","PTYPE")=$S($G(ORKDG)="PSI":"I",$G(ORKDG)="PSO":"O",$G(ORKDG)="PSIV":"I",$G(ORKDG)="PSH":"O",1:"")
"RTN","ORKPS1",30,0)
 I '$L(TDATA("NEW","PTYPE")) D  ;if no display group
"RTN","ORKPS1",31,0)
 .D ADM^VADPT2
"RTN","ORKPS1",32,0)
 .S TDATA("NEW","PTYPE")=$S(+$G(VADMVT)>0:"I",1:"O")
"RTN","ORKPS1",33,0)
 .K VADMVT
"RTN","ORKPS1",34,0)
 S TDATA("NEW","OTYPE")=TDATA("NEW","PTYPE")
"RTN","ORKPS1",35,0)
 I $L(ORKDG) S TDATA("NEW","OTYPE")=$S($G(ORKDG)="PSI":"UD",$G(ORKDG)="PSO":"OP",$G(ORKDG)="PSIV":"IV",$G(ORKDG)="PSH":"NV",1:"")
"RTN","ORKPS1",36,0)
 D DI(.TDATA),DD(.TDATA),DT(.TDATA)
"RTN","ORKPS1",37,0)
 Q
"RTN","ORKPS1",38,0)
 ;
"RTN","ORKPS1",39,0)
DI(TDATA) ;add drug interaction checks
"RTN","ORKPS1",40,0)
 N GL
"RTN","ORKPS1",41,0)
 S GL=$NA(^TMP($J,"OROCOUT","OUT","DRUGDRUG"))
"RTN","ORKPS1",42,0)
 S J="" F  S J=$O(@GL@(J)) Q:'$L(J)  D
"RTN","ORKPS1",43,0)
 .S K="" F  S K=$O(@GL@(J,K)) Q:'$L(K)  D
"RTN","ORKPS1",44,0)
 ..S L=0 F  S L=$O(@GL@(J,K,L)) Q:'$L(L)  D
"RTN","ORKPS1",45,0)
 ...S M=0 F  S M=$O(@GL@(J,K,L,M)) Q:'M  D
"RTN","ORKPS1",46,0)
 ....N ORTXT,ORNUM,ORSEV,ORDNAME,ORZ,CNT,ORSTAT,ORMON,ORWHICH
"RTN","ORKPS1",47,0)
 ....S ORWHICH=""
"RTN","ORKPS1",48,0)
 ....I $P($P(@GL@(J,K,L,M),U),";",3,4)="PROSPECTIVE;1" D
"RTN","ORKPS1",49,0)
 .....S ORWHICH=K
"RTN","ORKPS1",50,0)
 .....I $P(L,";",3)="PROSPECTIVE" S ORWHICH=ORWHICH_" [UNRELEASED]" Q
"RTN","ORKPS1",51,0)
 .....S ORWHICH=ORWHICH_" ["_$$PHSTAT(DFN,$P(L,";",1,2))_"]"
"RTN","ORKPS1",52,0)
 ....I $P(L,";",3,4)="PROSPECTIVE;1" D
"RTN","ORKPS1",53,0)
 .....S ORWHICH=$P(@GL@(J,K,L,M),U,4)
"RTN","ORKPS1",54,0)
 .....I $P($P(@GL@(J,K,L,M),U),";",3)="PROSPECTIVE" S ORWHICH=ORWHICH_" [UNRELEASED]" Q
"RTN","ORKPS1",55,0)
 .....S ORWHICH=ORWHICH_" ["_$$PHSTAT(DFN,$P($P(@GL@(J,K,L,M),U),";",1,2))_"]"
"RTN","ORKPS1",56,0)
 ....Q:$L(ORWHICH)<2
"RTN","ORKPS1",57,0)
 ....;get the associated order number
"RTN","ORKPS1",58,0)
 ....S ORNUM=$P(L,";",1,2)
"RTN","ORKPS1",59,0)
 ....;get text
"RTN","ORKPS1",60,0)
 ....S ORTXT=TDATA("NEW","TXT")_" and "_ORWHICH_" - "_$P($G(@GL@(J,K,L,M,"CLIN")),"CLINICAL EFFECTS:  ",2)
"RTN","ORKPS1",61,0)
 ....;loop through the PMON nodes to get the CLINICAL EFFECTS
"RTN","ORKPS1",62,0)
 ....;N PMON S PMON=0 F  S PMON=$O(@GL@(J,K,L,M,"PMON",PMON)) Q:'PMON  D
"RTN","ORKPS1",63,0)
 ....;.I $L($G(@GL@(J,K,L,M,"PMON",PMON,0)),"CLINICAL EFFECTS:  ")>1 S ORTXT=TDATA("NEW","TXT")_" & "_K_$S($P(L,";")="P":"[PENDING]",ORNUM:"["_$$PHSTAT(DFN,ORNUM)_"]",1:"")_" - "_$P(@GL@(J,K,L,M,"PMON",PMON,0),"CLINICAL EFFECTS:  ",2)
"RTN","ORKPS1",64,0)
 ....;set the monograph into the temp global
"RTN","ORKPS1",65,0)
 ....I $D(@GL@(J,K,L,M,"PMON")) D
"RTN","ORKPS1",66,0)
 .....S ^TMP($J,"ORMONOGRAPH")=1+$G(^TMP($J,"ORMONOGRAPH"))
"RTN","ORKPS1",67,0)
 .....S ORMON=^TMP($J,"ORMONOGRAPH")
"RTN","ORKPS1",68,0)
 .....S ^TMP($J,"ORMONOGRAPH",ORMON,"OC")=ORTXT
"RTN","ORKPS1",69,0)
 .....S ^TMP($J,"ORMONOGRAPH",ORMON,"INT")=@GL@(J,K,L,M,"INT")
"RTN","ORKPS1",70,0)
 .....M ^TMP($J,"ORMONOGRAPH",ORMON,"DATA")=@GL@(J,K,L,M,"PMON")
"RTN","ORKPS1",71,0)
 ....;get the severity
"RTN","ORKPS1",72,0)
 ....S ORSEV=$$UPPER^ORU($G(@GL@(J,K,L,M,"SEV")))
"RTN","ORKPS1",73,0)
 ....;get the drug name
"RTN","ORKPS1",74,0)
 ....S ORDNAME=K
"RTN","ORKPS1",75,0)
 ....;if the status of the associated order is DISCONTINUED then don't add
"RTN","ORKPS1",76,0)
 ....S ORSTAT=$$PHSTAT(DFN,ORNUM)
"RTN","ORKPS1",77,0)
 ....Q:ORSTAT="DISCONTINUED"
"RTN","ORKPS1",78,0)
 ....;set info into order check array
"RTN","ORKPS1",79,0)
 ....S YY(II)="DI^"_ORSEV_U_ORNUM_U_ORDNAME_U_ORTXT_" - Monograph Available"_U_$G(@GL@(J,K,L,M,"INT"))
"RTN","ORKPS1",80,0)
 ....S II=II+1
"RTN","ORKPS1",81,0)
 Q
"RTN","ORKPS1",82,0)
 ;
"RTN","ORKPS1",83,0)
DD(TDATA) ;add duplicate drug checks
"RTN","ORKPS1",84,0)
 Q:$$SOLUT^ORKPS(OI)  ;quit if the orderable item is a solution
"RTN","ORKPS1",85,0)
 ;require that we do not perform dup drug/class OCs for solutions)
"RTN","ORKPS1",86,0)
 S XX=0,ZZ=""
"RTN","ORKPS1",87,0)
 F  S XX=$O(^TMP($J,"DD",XX)) Q:XX<1  D
"RTN","ORKPS1",88,0)
 .N ORREM
"RTN","ORKPS1",89,0)
 .S ZZ=$G(^TMP($J,"DD",XX,0)),ORMTYPE=$P($P(ZZ,U,4),";",2)
"RTN","ORKPS1",90,0)
 .S ORREM=$P($P(ZZ,U,4),";") I (ORREM["Z"),$D(^TMP($J,"OROCOUT","OUT","REMOTE",+ORREM)) D
"RTN","ORKPS1",91,0)
 ..N ORTXT,ORREM1,ORREMSIG
"RTN","ORKPS1",92,0)
 ..S ORREM1=$G(^TMP($J,"OROCOUT","OUT","REMOTE",+ORREM))
"RTN","ORKPS1",93,0)
 ..S ORREMSIG=$G(^TMP($J,"OROCOUT","OUT","REMOTE",+ORREM,"SIG",0))
"RTN","ORKPS1",94,0)
 ..S ORTXT=" "_ORREMSIG_" ["_$P(ORREM1,U,4)_" -  Last Fill: "_$P(ORREM1,U,6)_"  Quantity Dispensed: "_$P(ORREM1,U,8)_"] >>"_$P(ORREM1,U)
"RTN","ORKPS1",95,0)
 ..S $P(ZZ,U,2)=$P(ZZ,U,2)_ORTXT
"RTN","ORKPS1",96,0)
 .I $G(TDATA("NEW","PTYPE"))'=$G(ORMTYPE),'$L($G(^TMP($J,"DD",XX,1))) Q
"RTN","ORKPS1",97,0)
 .S ORN=$P($P(ZZ,U,3),";"),ORZ=""
"RTN","ORKPS1",98,0)
 .I $L($G(ORN))>0,+$G(ORN)=+$G(ORIFN) Q  ;QUIT if dup med ord # = current ord #
"RTN","ORKPS1",99,0)
 .I +$G(ORIFN),+$G(ORN)=$P(^OR(100,+ORIFN,3),U,5) Q  ;QUIT if dup med ord # = the current order #'s REPLACED ORDER (changing an order)
"RTN","ORKPS1",100,0)
 .Q:ORPROSP'=+ZZ
"RTN","ORKPS1",101,0)
 .I $L(ORN),$D(^OR(100,ORN,8,0)) S ORZ=^OR(100,ORN,8,0)
"RTN","ORKPS1",102,0)
 .I $L($G(ORZ)),($P(^OR(100,ORN,8,$P(ORZ,U,3),0),U,2)="DC") Q
"RTN","ORKPS1",103,0)
 .I $L(ORN),$P(^ORD(100.01,$P(^OR(100,ORN,3),U,3),0),U)="DISCONTINUED" Q
"RTN","ORKPS1",104,0)
 .I ZZ'="" S YY(II)="DD^"_ZZ,II=II+1
"RTN","ORKPS1",105,0)
 .S ^TMP($J,"DD",XX,"OC")="" ;set this if this DD entry turned into an OC
"RTN","ORKPS1",106,0)
 Q
"RTN","ORKPS1",107,0)
 ;
"RTN","ORKPS1",108,0)
DT(TDATA) ;add duplicate therapy checks
"RTN","ORKPS1",109,0)
 N I
"RTN","ORKPS1",110,0)
 Q:$$SUPPLY^ORKPS(OI)  ;quit if the orderable item is a supply
"RTN","ORKPS1",111,0)
 S GL=$NA(^TMP($J,"OROCOUT","OUT","THERAPY"))
"RTN","ORKPS1",112,0)
 S I=0 F  S I=$O(@GL@(I)) Q:'I  D
"RTN","ORKPS1",113,0)
 .;get all drug names
"RTN","ORKPS1",114,0)
 .N ORDRUGS,ORCLASS,ORF,ORPROSCNT,ORPROFCNT,DRUGS,ORRETSTR S ORDRUGS="",ORCLASS="",ORF=0,ORPROSCNT=0,ORPROFCNT=0
"RTN","ORKPS1",115,0)
 .S J=0 F  S J=$O(@GL@(I,"DRUGS",J)) Q:'J  D
"RTN","ORKPS1",116,0)
 ..;keep count of PROSPECTIVE drugs
"RTN","ORKPS1",117,0)
 ..I $P($P($G(@GL@(I,"DRUGS",J)),U),";",3,4)="PROSPECTIVE;1" S ORF=1
"RTN","ORKPS1",118,0)
 ..I $P($P($G(@GL@(I,"DRUGS",J)),U),";",3)="PROSPECTIVE" D
"RTN","ORKPS1",119,0)
 ...S ORPROSCNT=1+$G(ORPROSCNT)
"RTN","ORKPS1",120,0)
 ...I $P($P($G(@GL@(I,"DRUGS",J)),U),";",4)'=1 S ORDRUGS=ORDRUGS_$S($L(ORDRUGS):", ",1:"")_$P($G(@GL@(I,"DRUGS",J)),U,3)_" [UNRELEASED]",DRUGS($P($G(@GL@(I,"DRUGS",J)),U,3))=""
"RTN","ORKPS1",121,0)
 ..;-check each PROFILE drug to see if it is not the same order as the prospective (ORIFN)
"RTN","ORKPS1",122,0)
 ..I $P($P($G(@GL@(I,"DRUGS",J)),U),";",3)="PROFILE" D
"RTN","ORKPS1",123,0)
 ...;if not the same then set ORNUM=THE PROFILE DRUG "O;PSNUM"
"RTN","ORKPS1",124,0)
 ...I $P($P($G(@GL@(I,"DRUGS",J)),U),";",2)'=$G(^OR(100,+$G(ORIFN),4)) D
"RTN","ORKPS1",125,0)
 ....I $L($P($G(@GL@(I,"DRUGS",J)),U,4))>0,(+$P($G(@GL@(I,"DRUGS",J)),U,4)=$P($G(^OR(100,+$G(ORIFN),3)),U,5)) Q
"RTN","ORKPS1",126,0)
 ....I $L($P($G(@GL@(I,"DRUGS",J)),U,4))>0,(+$P($G(@GL@(I,"DRUGS",J)),U,4)=+$G(ORIFN)) Q
"RTN","ORKPS1",127,0)
 ....I $E($G(@GL@(I,"DRUGS",J)),1)="R" S $P(@GL@(I,"DRUGS",J),U,5)="O"
"RTN","ORKPS1",128,0)
 ....I $G(TDATA("NEW","PTYPE"))'=$P($G(@GL@(I,"DRUGS",J)),U,5) Q
"RTN","ORKPS1",129,0)
 ....S ORNUM=$P($P($G(@GL@(I,"DRUGS",J)),U),";",1,2)
"RTN","ORKPS1",130,0)
 ....S ORDRUGS=ORDRUGS_$S($L(ORDRUGS):", ",1:"")_$P($G(@GL@(I,"DRUGS",J)),U,3)_" ["_$$PHSTAT(DFN,ORNUM)_"]"
"RTN","ORKPS1",131,0)
 ....S DRUGS($P($G(@GL@(I,"DRUGS",J)),U,3))="",ORPROFCNT=ORPROFCNT+1
"RTN","ORKPS1",132,0)
 .Q:'$$CHKDD(.DRUGS)
"RTN","ORKPS1",133,0)
 .;quit if ORNUM is not set and PROSPECTIVE count <=1
"RTN","ORKPS1",134,0)
 .Q:('$L($G(ORNUM))&(ORPROSCNT<2))
"RTN","ORKPS1",135,0)
 .;get all classes
"RTN","ORKPS1",136,0)
 .I ORF S J=0 F  S J=$O(@GL@(I,J)) Q:'J  D
"RTN","ORKPS1",137,0)
 ..S ORCLASS=ORCLASS_$S($L(ORCLASS):", ",1:"")_$G(@GL@(I,J,"CLASS"))
"RTN","ORKPS1",138,0)
 .;assemble return string ("DC"+ORNUM_U_Classes_U_Classes (drugs))
"RTN","ORKPS1",139,0)
 .S ORRETSTR="Duplicate Therapy: Order(s) exist for {"_ORDRUGS_"} in the same therapeutic categor(ies): "_ORCLASS
"RTN","ORKPS1",140,0)
 .I ORF S YY(II)="DC"_U_$G(ORNUM)_U_ORCLASS_U_ORRETSTR,II=II+1
"RTN","ORKPS1",141,0)
 Q
"RTN","ORKPS1",142,0)
 ;
"RTN","ORKPS1",143,0)
PHSTAT(DFN,ORNUM) ;get the status of the order
"RTN","ORKPS1",144,0)
 N RET,J,I
"RTN","ORKPS1",145,0)
 S RET=""
"RTN","ORKPS1",146,0)
 I $P(ORNUM,";")="P" Q "PENDING"
"RTN","ORKPS1",147,0)
 I $P(ORNUM,";")="N" Q "NON-VA"
"RTN","ORKPS1",148,0)
 I $P(ORNUM,";")="O" D  Q RET
"RTN","ORKPS1",149,0)
 .K ^TMP($J,"OROCLST") D RX^PSO52API(DFN,"OROCLST",$P(ORNUM,";",2),,"ST")
"RTN","ORKPS1",150,0)
 .S RET=$P($G(^TMP($J,"OROCLST",DFN,$P(ORNUM,";",2),100)),U,2)
"RTN","ORKPS1",151,0)
 .K ^TMP($J,"OROCLST")
"RTN","ORKPS1",152,0)
 I $P(ORNUM,";")="I" D  Q RET
"RTN","ORKPS1",153,0)
 .N ORLAST,ORPHNUM
"RTN","ORKPS1",154,0)
 .S ORLAST=$E(ORNUM,$L(ORNUM))
"RTN","ORKPS1",155,0)
 .I ORLAST="P" S RET="PENDING" Q
"RTN","ORKPS1",156,0)
 .S ORPHNUM=+$P(ORNUM,";",2)
"RTN","ORKPS1",157,0)
 .I ORLAST="U" D  Q
"RTN","ORKPS1",158,0)
 ..K ^TMP($J,"OR GET STATUS") D PSS431^PSS55(DFN,ORPHNUM,"","","OR GET STATUS")
"RTN","ORKPS1",159,0)
 ..S RET=$P($G(^TMP($J,"OR GET STATUS",ORPHNUM,28)),U,2)
"RTN","ORKPS1",160,0)
 .I ORLAST="V" D  Q
"RTN","ORKPS1",161,0)
 ..K ^TMP($J,"OR GET STATUS") D PSS436^PSS55(DFN,ORPHNUM,"OR GET STATUS")
"RTN","ORKPS1",162,0)
 ..S RET=$P($G(^TMP($J,"OR GET STATUS",ORPHNUM,100)),U,2)
"RTN","ORKPS1",163,0)
 I $P(ORNUM,";")="R" D  Q RET
"RTN","ORKPS1",164,0)
 .N ORREMOTE S ORREMOTE=$G(^TMP($J,"OROCOUT","OUT","REMOTE",$P(ORNUM,";",2)))
"RTN","ORKPS1",165,0)
 .S RET=$P(ORREMOTE,U,4)_" >> "_$P(ORREMOTE,U)
"RTN","ORKPS1",166,0)
 Q RET
"RTN","ORKPS1",167,0)
 ;
"RTN","ORKPS1",168,0)
CHKDD(DARRAY) ;check the duplicate drug OCs returned
"RTN","ORKPS1",169,0)
 ;if all drugs in DARRAY are already displayed in a DD OC then don't show the DT OC (return 0)
"RTN","ORKPS1",170,0)
 ;check the ^TMP($J,"DD"I,"OC") node to see if the DD entry turned into an OC
"RTN","ORKPS1",171,0)
 N I S I=0 F  S I=$O(^TMP($J,"DD",I)) Q:'I  D
"RTN","ORKPS1",172,0)
 .I $D(DARRAY($P($G(^TMP($J,"DD",I,0)),U,2))),$D(^TMP($J,"DD",I,"OC")) D
"RTN","ORKPS1",173,0)
 ..K DARRAY($P($G(^TMP($J,"DD",I,0)),U,2))
"RTN","ORKPS1",174,0)
 Q $D(DARRAY)
"RTN","ORKPS1",175,0)
 ;
"RTN","OROCAPI")
0^1^B1276161
"RTN","OROCAPI",1,0)
OROCAPI ; JMH - ORDER CHECK APIs;8/24/07 ;3/19/08  12:17
"RTN","OROCAPI",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**272**;Dec 17, 1997;Build 53
"RTN","OROCAPI",3,0)
 ;;
"RTN","OROCAPI",4,0)
DOC(DFN,OI) ;DANGEREOUS MEDS FOR PAT > 64 ORDER CHECK
"RTN","OROCAPI",5,0)
 ;DFN=FILE2 IEN
"RTN","OROCAPI",6,0)
 ;OI=FILE 101.43 IEN
"RTN","OROCAPI",7,0)
 N RET,VAL,I,IN,MODE
"RTN","OROCAPI",8,0)
 S MODE="ACCEPT"
"RTN","OROCAPI",9,0)
 S IN=OI_"|PS|^^99NDF^^^99PSD"
"RTN","OROCAPI",10,0)
 D EN^OCXOEPS(.RET,DFN,IN,MODE)
"RTN","OROCAPI",11,0)
 S I=0 F  S I=$O(RET(I)) Q:'I  D
"RTN","OROCAPI",12,0)
 .I $P(RET(I),U,2)=30 S VAL=RET(I)
"RTN","OROCAPI",13,0)
 Q $G(VAL)
"RTN","OROCAPI",14,0)
GOC(DFN,MEDTXT) ;GLUCOPHAGE LAB RESULTS ORDER CHECK
"RTN","OROCAPI",15,0)
 ;DFN=FILE 2 IEN
"RTN","OROCAPI",16,0)
 ;MEDTXT=FILE 50 LOCAL DRUG TEXT
"RTN","OROCAPI",17,0)
 N RET,IN,MODE,VAL,I
"RTN","OROCAPI",18,0)
 S MODE="SELECT"
"RTN","OROCAPI",19,0)
 S IN="|PS|^^99NDF^^"_MEDTXT_"^99PSD"
"RTN","OROCAPI",20,0)
 D EN^OCXOEPS(.RET,DFN,IN,MODE)
"RTN","OROCAPI",21,0)
 S I=0 F  S I=$O(RET(I)) Q:'I  D
"RTN","OROCAPI",22,0)
 .I $P(RET(I),U,2)=28 S VAL=RET(I)
"RTN","OROCAPI",23,0)
 Q $G(VAL)
"RTN","OROCAPI",24,0)
AOC(DFN,ORPROD) ;AMINOGLYCOSIDE ORDERED ORDER CHECK
"RTN","OROCAPI",25,0)
 ;DFN=FILE 2 IEN
"RTN","OROCAPI",26,0)
 ;ORPROD=FILE 50.68 IEN (VA PRODUCT)
"RTN","OROCAPI",27,0)
 N VAL,RET,I,ORPS,IN,MODE
"RTN","OROCAPI",28,0)
 S MODE="SESSION"
"RTN","OROCAPI",29,0)
 S IN="|PS|."_ORPROD_"^^99NDF^^^99PSD"
"RTN","OROCAPI",30,0)
 D EN^OCXOEPS(.RET,DFN,IN,MODE)
"RTN","OROCAPI",31,0)
 S I=0 F  S I=$O(RET(I)) Q:'I  D
"RTN","OROCAPI",32,0)
 .I $P(RET(I),U,2)=20 S VAL=RET(I)
"RTN","OROCAPI",33,0)
 Q $G(VAL)
"RTN","OROCAPI",34,0)
 ;
"RTN","ORX8")
0^9^B14076092
"RTN","ORX8",1,0)
ORX8 ; slc/dcm,MKB - OE/RR Orders file extracts ;12/16/10  11:18
"RTN","ORX8",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**13,21,48,68,92,141,163,272**;Dec 17, 1997;Build 53
"RTN","ORX8",3,0)
 ;
"RTN","ORX8",4,0)
EN(ORIFN) ;Returns data from file 100 in the ORUPCHUK array [DBIA#871]
"RTN","ORX8",5,0)
 Q:'$D(ORIFN)  Q:'$D(^OR(100,+ORIFN,0))  K ORUPCHUK
"RTN","ORX8",6,0)
 D A
"RTN","ORX8",7,0)
 K ORTX,X0,X3,%X,%Y,J,ORINDX,X
"RTN","ORX8",8,0)
 Q
"RTN","ORX8",9,0)
A S X0=^OR(100,ORIFN,0),X3=^(3),ORUPCHUK("ORPK")=$S($D(^(4)):^(4),1:"")
"RTN","ORX8",10,0)
 S ORUPCHUK("ORVP")=$P(X0,"^",2),ORUPCHUK("ORPCL")=$P(X0,"^",5),X=$P(X0,"^",6),ORUPCHUK("ORDUZ")=X_"^"_$$GET1^DIQ(200,+X,.01),ORUPCHUK("ORODT")=$P(X0,"^",7),ORUPCHUK("ORSTOP")=$P(X0,"^",9),ORUPCHUK("ORL")=$P(X0,"^",10)
"RTN","ORX8",11,0)
 S X=$P(X0,"^",11),ORUPCHUK("ORTO")=X_"^"_$S($D(^ORD(100.98,+X,0)):$P(^(0),"^"),1:"")
"RTN","ORX8",12,0)
 S X=$P(X3,"^",3),ORUPCHUK("ORSTS")=X_"^"_$P(^ORD(100.01,X,0),"^"),ORUPCHUK("ORSTRT")=$P(X0,"^",8),X=$P(X0,"^",4),(ORUPCHUK("ORNP"),ORUPCHUK("ORPV"))=X_"^"_$S(X:$$GET1^DIQ(200,+X,.01),1:"")
"RTN","ORX8",13,0)
 D TEXT^ORQ12(.ORTX,ORIFN,$G(ORLENGTH))
"RTN","ORX8",14,0)
 I $O(ORTX(0)) S %X="ORTX(",%Y="ORUPCHUK(""ORTX""," D %XY^%RCR
"RTN","ORX8",15,0)
 Q
"RTN","ORX8",16,0)
 ;
"RTN","ORX8",17,0)
VALUE(IFN,ID,INST,FORMAT) ; -- Returns value of prompt by ID
"RTN","ORX8",18,0)
 N PRMT
"RTN","ORX8",19,0)
 I '$G(IFN)!('$D(^OR(100,+$G(IFN),0)))!($G(ID)="") Q ""
"RTN","ORX8",20,0)
 N I,Y S I=0,Y="" S:'$G(INST) INST=1
"RTN","ORX8",21,0)
 F  S I=$O(^OR(100,+IFN,4.5,"ID",ID,I)) Q:I'>0  I $P($G(^OR(100,+IFN,4.5,+I,0)),U,3)=INST S PRMT=+$P(^(0),U,2),Y=$G(^(1)) Q
"RTN","ORX8",22,0)
 I $L(Y),$G(PRMT),$G(FORMAT)="E" D  ; get external form of Y
"RTN","ORX8",23,0)
 . N ORDIALOG S ORDIALOG(PRMT,0)=$G(^ORD(101.41,PRMT,1))
"RTN","ORX8",24,0)
 . S ORDIALOG(PRMT,1)=Y,Y=$$EXT^ORCD(PRMT,1)
"RTN","ORX8",25,0)
 Q Y
"RTN","ORX8",26,0)
 ;
"RTN","ORX8",27,0)
OI(IFN) ; -- Returns [first] orderable item for order IFN in the format
"RTN","ORX8",28,0)
 ;    ifn ^ name ^ pkg id   [DBIA#2467]
"RTN","ORX8",29,0)
 I '$G(IFN)!('$D(^OR(100,+$G(IFN),0))) Q ""
"RTN","ORX8",30,0)
 N I,X,Y S I=$O(^OR(100,+IFN,.1,0)),X=$G(^(+I,0)),Y=""
"RTN","ORX8",31,0)
 I X,$D(^ORD(101.43,+X,0)) S Y=+X_U_$P(^(0),U,1,2)
"RTN","ORX8",32,0)
 Q Y
"RTN","ORX8",33,0)
 ;
"RTN","ORX8",34,0)
LATEST(ORPAT,ORIT,ORY) ; -- Return most recent orders for ORPAT,ORIT as
"RTN","ORX8",35,0)
 ;        ORY = total number of orders found (or 0 if none found)
"RTN","ORX8",36,0)
 ; ORY(ORSTS) = ORIFN ^ Ord'd By ^ Entered ^ StartDt ^ StopDt ^ Loc ^ Sts
"RTN","ORX8",37,0)
 ; where ORSTS is the ien in the Order Status file #100.01  [DBIA#2842]
"RTN","ORX8",38,0)
 ;
"RTN","ORX8",39,0)
 N ORVP,ORIDT,ORIFN,OR0,OR3,ORSTS,ORSTSNM
"RTN","ORX8",40,0)
 S ORVP=+ORPAT_";DPT(",ORY=0 Q:'$G(ORPAT)  Q:'$G(ORIT)  ;invalid input
"RTN","ORX8",41,0)
 S ORIDT=0 F  S ORIDT=$O(^OR(100,"AOI",+ORIT,ORVP,ORIDT)) Q:ORIDT'>0  D
"RTN","ORX8",42,0)
 . S ORIFN=0 F  S ORIFN=$O(^OR(100,"AOI",+ORIT,ORVP,ORIDT,ORIFN)) Q:ORIFN'>0  D
"RTN","ORX8",43,0)
 .. S OR0=$G(^OR(100,+ORIFN,0)),OR3=$G(^(3)),ORSTS=+$P(OR3,U,3)
"RTN","ORX8",44,0)
 .. Q:ORSTS'>0  Q:$G(ORY(ORSTS))  ;return only latest order per status
"RTN","ORX8",45,0)
 .. S ORSTSNM=$$LOW^XLFSTR($P($G(^ORD(100.01,ORSTS,0)),U))
"RTN","ORX8",46,0)
 .. S ORY=ORY+1,ORY(ORSTS)=ORIFN_U_$P(OR0,U,4)_U_$P(OR0,U,7,10)_U_ORSTSNM
"RTN","ORX8",47,0)
 Q
"RTN","ORX8",48,0)
 ;
"RTN","ORX8",49,0)
DELAYED(ORY,ORDER) ; -- Return delayed order(s) with same OrdItem as ORDER
"RTN","ORX8",50,0)
 ;    in ORY(ORIFN) = PatEventPtr ^ EventName
"RTN","ORX8",51,0)
 ;
"RTN","ORX8",52,0)
 N ORI,ORIT,ORIFN,EVT,PTEVT S (ORY,ORI)=0
"RTN","ORX8",53,0)
 F  S ORI=$O(^OR(100,+ORDER,.1,ORI)) Q:ORI'>0  S ORIT=+$G(^(ORI,0)) D
"RTN","ORX8",54,0)
 . S EVT=0 F  S EVT=$O(^ORE(100.2,"AE",+ORVP,EVT)) Q:EVT<1  S PTEVT=+$O(^(EVT,0)) D  ;pending events
"RTN","ORX8",55,0)
 .. S ORIFN=0 F  S ORIFN=+$O(^OR(100,"AEVNT",ORVP,PTEVT,ORIFN)) Q:ORIFN<1  D  ;delayed orders
"RTN","ORX8",56,0)
 ... Q:ORIFN=+ORDER  Q:'$D(^OR(100,ORIFN,.1,"B",ORIT))
"RTN","ORX8",57,0)
 ... Q:"^1^2^7^12^13^14^"[(U_$P($G(^OR(100,ORIFN,3)),U,3)_U)  ;terminated
"RTN","ORX8",58,0)
 ... S ORY=ORY+1,ORY(ORIFN)=PTEVT_U_$P($G(^ORD(100.5,EVT,0)),U)
"RTN","ORX8",59,0)
 Q
"RTN","ORX8",60,0)
 ;
"RTN","ORX8",61,0)
PKGID(ORIFN) ; -- Return package identifier for order ORIFN  [DBIA#3071]
"RTN","ORX8",62,0)
 Q $G(^OR(100,+$G(ORIFN),4))
"RTN","ORX8",63,0)
 ;
"RTN","ORX8",64,0)
ES(ORDER) ; -- Returns the signature status of ORDER [DBIA#3632]
"RTN","ORX8",65,0)
 ;  -1 = invalid order#
"RTN","ORX8",66,0)
 ;  "" = no signature required
"RTN","ORX8",67,0)
 ;   0 = not signed (needs ES)
"RTN","ORX8",68,0)
 ;   1 = electronically or digitally signed
"RTN","ORX8",69,0)
 ;   2 = signed on chart
"RTN","ORX8",70,0)
 ;   3 = corrected or canceled order
"RTN","ORX8",71,0)
 N X,Y,DA I '$G(ORDER)!'$D(^OR(100,+$G(ORDER),0)) Q -1
"RTN","ORX8",72,0)
 S DA=+$P(ORDER,";",2) S:DA<1 DA=+$P($G(^OR(100,+ORDER,3)),U,7)
"RTN","ORX8",73,0)
 S X=$P($G(^OR(100,+ORDER,8,DA,0)),U,4)
"RTN","ORX8",74,0)
 S Y=$S(X=2:0,X=1!(X=7):1,X=0!(X=4):2,X=5!(X=6):3,1:"")
"RTN","ORX8",75,0)
 Q Y
"RTN","ORX8",76,0)
 ;
"RTN","ORX8",77,0)
AND(DAD) ; -- Return 1 or 0, if all conjunctions are AND [DBIA#3632]
"RTN","ORX8",78,0)
 N I,Y S I=0,Y=1
"RTN","ORX8",79,0)
 F  S I=+$O(^OR(100,+$G(DAD),4.5,"ID","CONJ",I)) Q:I<1  I $E($G(^OR(100,+$G(DAD),4.5,I,1)))'="A" S Y=0 Q
"RTN","ORX8",80,0)
 Q Y
"RTN","ORX8",81,0)
OITM(IEN,FILE) ; -- Return 101.43 ien for package IEN;FILE
"RTN","ORX8",82,0)
 ;    where FILE = "99xxx" as passed in HL7 messages
"RTN","ORX8",83,0)
 Q $O(^ORD(101.43,"ID",+$G(IEN)_";"_$G(FILE),0))
"RTN","ORY272")
0^8^B1468191
"RTN","ORY272",1,0)
ORY272 ;SLC/JMH - post install routine for patch OR*3*272; ;07/12/10  07:28
"RTN","ORY272",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**272**;Dec 17, 1997;Build 53
"RTN","ORY272",3,0)
 ;
"RTN","ORY272",4,0)
POST ;
"RTN","ORY272",5,0)
 N ORERR
"RTN","ORY272",6,0)
 S ^ORD(100.8,17,0)="DUPLICATE DRUG THERAPY"
"RTN","ORY272",7,0)
 K ^ORD(100.8,"B","DUPLICATE DRUG CLASS ORDER",17)
"RTN","ORY272",8,0)
 S ^ORD(100.8,"B","DUPLICATE DRUG THERAPY",17)=""
"RTN","ORY272",9,0)
 S ^ORD(100.8,17,1,3,0)="is currently receiving a med that is in the same Theraputic "
"RTN","ORY272",10,0)
 S ^ORD(100.8,17,1,4,0)="Category, the order check occurs."
"RTN","ORY272",11,0)
 D EN^XPAR("PKG","ORK PROCESSING FLAG","DUPLICATE DRUG THERAPY","Enabled",.ORERR)
"RTN","ORY272",12,0)
 D EN^XPAR("PKG","ORK CLINICAL DANGER LEVEL","DUPLICATE DRUG THERAPY","High",.ORERR)
"RTN","ORY272",13,0)
 Q
"RTN","ORY272",14,0)
 ;
"VER")
8.0^22.0
**END**
**END**
