Released PRCA*4.5*219 SEQ #235
Extracted from mail message
**KIDS**:PRCA*4.5*219^

**INSTALL NAME**
PRCA*4.5*219
"BLD",5702,0)
PRCA*4.5*219^ACCOUNTS RECEIVABLE^0^3090514^y
"BLD",5702,1,0)
^^5^5^3090514^
"BLD",5702,1,1,0)
This patch addresses two related issues that involve the patient statement
"BLD",5702,1,2,0)
print functionality. First, the third statement is now printed when
"BLD",5702,1,3,0)
necessary even if there has been no activity except interest/admin
"BLD",5702,1,4,0)
charges.  Second, the messages from option [PRCA ACCOUNT CHECK] have
"BLD",5702,1,5,0)
been adjusted to be consistent with the above.
"BLD",5702,4,0)
^9.64PA^^0
"BLD",5702,6.3)
18
"BLD",5702,"ABPKG")
n
"BLD",5702,"INID")
^
"BLD",5702,"INIT")

"BLD",5702,"KRN",0)
^9.67PA^8989.52^19
"BLD",5702,"KRN",.4,0)
.4
"BLD",5702,"KRN",.4,"NM",0)
^9.68A^^
"BLD",5702,"KRN",.401,0)
.401
"BLD",5702,"KRN",.402,0)
.402
"BLD",5702,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",5702,"KRN",.403,0)
.403
"BLD",5702,"KRN",.5,0)
.5
"BLD",5702,"KRN",.84,0)
.84
"BLD",5702,"KRN",3.6,0)
3.6
"BLD",5702,"KRN",3.8,0)
3.8
"BLD",5702,"KRN",9.2,0)
9.2
"BLD",5702,"KRN",9.8,0)
9.8
"BLD",5702,"KRN",9.8,"NM",0)
^9.68A^8^7
"BLD",5702,"KRN",9.8,"NM",1,0)
PRCAGDR^^0^B10035785
"BLD",5702,"KRN",9.8,"NM",3,0)
PRCAGDT^^0^B20730755
"BLD",5702,"KRN",9.8,"NM",4,0)
RCCPCPS^^0^B71238973
"BLD",5702,"KRN",9.8,"NM",5,0)
RCCPCSTM^^0^B8969116
"BLD",5702,"KRN",9.8,"NM",6,0)
PRCAGU^^0^B11613288
"BLD",5702,"KRN",9.8,"NM",7,0)
PRCA219P^^0^B12720778
"BLD",5702,"KRN",9.8,"NM",8,0)
PRCAGT^^0^B19865936
"BLD",5702,"KRN",9.8,"NM","B","PRCA219P",7)

"BLD",5702,"KRN",9.8,"NM","B","PRCAGDR",1)

"BLD",5702,"KRN",9.8,"NM","B","PRCAGDT",3)

"BLD",5702,"KRN",9.8,"NM","B","PRCAGT",8)

"BLD",5702,"KRN",9.8,"NM","B","PRCAGU",6)

"BLD",5702,"KRN",9.8,"NM","B","RCCPCPS",4)

"BLD",5702,"KRN",9.8,"NM","B","RCCPCSTM",5)

"BLD",5702,"KRN",19,0)
19
"BLD",5702,"KRN",19,"NM",0)
^9.68A^^
"BLD",5702,"KRN",19.1,0)
19.1
"BLD",5702,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",5702,"KRN",101,0)
101
"BLD",5702,"KRN",101,"NM",0)
^9.68A^^
"BLD",5702,"KRN",409.61,0)
409.61
"BLD",5702,"KRN",409.61,"NM",0)
^9.68A^^0
"BLD",5702,"KRN",771,0)
771
"BLD",5702,"KRN",771,"NM",0)
^9.68A^^
"BLD",5702,"KRN",870,0)
870
"BLD",5702,"KRN",870,"NM",0)
^9.68A^^
"BLD",5702,"KRN",8989.51,0)
8989.51
"BLD",5702,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",5702,"KRN",8989.52,0)
8989.52
"BLD",5702,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",5702,"KRN",8994,0)
8994
"BLD",5702,"KRN",8994,"NM",0)
^9.68A^^
"BLD",5702,"KRN","B",.4,.4)

"BLD",5702,"KRN","B",.401,.401)

"BLD",5702,"KRN","B",.402,.402)

"BLD",5702,"KRN","B",.403,.403)

"BLD",5702,"KRN","B",.5,.5)

"BLD",5702,"KRN","B",.84,.84)

"BLD",5702,"KRN","B",3.6,3.6)

"BLD",5702,"KRN","B",3.8,3.8)

"BLD",5702,"KRN","B",9.2,9.2)

"BLD",5702,"KRN","B",9.8,9.8)

"BLD",5702,"KRN","B",19,19)

"BLD",5702,"KRN","B",19.1,19.1)

"BLD",5702,"KRN","B",101,101)

"BLD",5702,"KRN","B",409.61,409.61)

"BLD",5702,"KRN","B",771,771)

"BLD",5702,"KRN","B",870,870)

"BLD",5702,"KRN","B",8989.51,8989.51)

"BLD",5702,"KRN","B",8989.52,8989.52)

"BLD",5702,"KRN","B",8994,8994)

"BLD",5702,"PRE")

"BLD",5702,"QDEF")
^^^^^^^^^^YES
"BLD",5702,"QUES",0)
^9.62^^
"BLD",5702,"REQB",0)
^9.611^9^3
"BLD",5702,"REQB",5,0)
PRCA*4.5*198^2
"BLD",5702,"REQB",7,0)
PRCA*4.5*237^2
"BLD",5702,"REQB",9,0)
PRCA*4.5*169^2
"BLD",5702,"REQB","B","PRCA*4.5*169",9)

"BLD",5702,"REQB","B","PRCA*4.5*198",5)

"BLD",5702,"REQB","B","PRCA*4.5*237",7)

"MBREQ")
0
"PKG",142,-1)
1^1
"PKG",142,0)
ACCOUNTS RECEIVABLE^PRCA^BILL COLLECTIONS
"PKG",142,20,0)
^9.402P^1^1
"PKG",142,20,1,0)
2^^PRCAMRG
"PKG",142,20,1,1)

"PKG",142,20,"B",2,1)

"PKG",142,22,0)
^9.49I^1^1
"PKG",142,22,1,0)
4.5^^2950320
"PKG",142,22,1,"PAH",1,0)
219^3090514
"PKG",142,22,1,"PAH",1,1,0)
^^5^5^3090514
"PKG",142,22,1,"PAH",1,1,1,0)
This patch addresses two related issues that involve the patient statement
"PKG",142,22,1,"PAH",1,1,2,0)
print functionality. First, the third statement is now printed when
"PKG",142,22,1,"PAH",1,1,3,0)
necessary even if there has been no activity except interest/admin
"PKG",142,22,1,"PAH",1,1,4,0)
charges.  Second, the messages from option [PRCA ACCOUNT CHECK] have
"PKG",142,22,1,"PAH",1,1,5,0)
been adjusted to be consistent with the above.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","PRCA219P")
0^7^B12720778^n/a
"RTN","PRCA219P",1,0)
PRCA219P ;ALB/RRG - REPORT LIKELY BILLS TO PRINT;;
"RTN","PRCA219P",2,0)
 ;;4.5;Accounts Receivable;**219**;Mar 20, 1995;Build 18
"RTN","PRCA219P",3,0)
 Q
"RTN","PRCA219P",4,0)
 ;
"RTN","PRCA219P",5,0)
REPORT ;
"RTN","PRCA219P",6,0)
 ;
"RTN","PRCA219P",7,0)
 W !,"This is a report of older bills that will likely print at the next print cycle"
"RTN","PRCA219P",8,0)
 N X1,X2
"RTN","PRCA219P",9,0)
 K ^XTMP("PRCA219P",$J)
"RTN","PRCA219P",10,0)
 S X1=DT,X2=90 D C^%DTC
"RTN","PRCA219P",11,0)
 S ^XTMP("PRCA219P",$J,0)=X_"^"_DT_"^LIKELY BILLS TO PRINT"
"RTN","PRCA219P",12,0)
 I $$DEVICE() D ENTER
"RTN","PRCA219P",13,0)
 Q
"RTN","PRCA219P",14,0)
 ;
"RTN","PRCA219P",15,0)
ENTER ;
"RTN","PRCA219P",16,0)
 ;
"RTN","PRCA219P",17,0)
 D BILLFIND
"RTN","PRCA219P",18,0)
 D ^%ZISC
"RTN","PRCA219P",19,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","PRCA219P",20,0)
 K ^XTMP("PRCA219P",$J)
"RTN","PRCA219P",21,0)
 Q
"RTN","PRCA219P",22,0)
DEVICE() ;
"RTN","PRCA219P",23,0)
 ;Description: allows the user to select a device.
"RTN","PRCA219P",24,0)
 ;
"RTN","PRCA219P",25,0)
 ;Output:
"RTN","PRCA219P",26,0)
 ;  Function Value - Returns 0 if the user decides not to print or to
"RTN","PRCA219P",27,0)
 ;       queue the report, 1 otherwise.
"RTN","PRCA219P",28,0)
 ;
"RTN","PRCA219P",29,0)
 N OK,IOP,POP,%ZIS
"RTN","PRCA219P",30,0)
 S OK=1
"RTN","PRCA219P",31,0)
 S %ZIS="MQ"
"RTN","PRCA219P",32,0)
 D ^%ZIS
"RTN","PRCA219P",33,0)
 S:POP OK=0
"RTN","PRCA219P",34,0)
 D:OK&$D(IO("Q"))
"RTN","PRCA219P",35,0)
 .N ZTRTN,ZTDESC,ZTSKM,ZTREQ,ZTSTOP
"RTN","PRCA219P",36,0)
 .S ZTRTN="BILLFIND^PRCA219P",ZTDESC="Likely Bills to Print"
"RTN","PRCA219P",37,0)
 .D ^%ZTLOAD
"RTN","PRCA219P",38,0)
 .W !,$S($D(ZTSK):"REQUEST QUEUED TASK="_ZTSK,1:"REQUEST CANCELLED")
"RTN","PRCA219P",39,0)
 .D HOME^%ZIS
"RTN","PRCA219P",40,0)
 .S OK=0
"RTN","PRCA219P",41,0)
 Q OK
"RTN","PRCA219P",42,0)
 ;
"RTN","PRCA219P",43,0)
BILLFIND ;
"RTN","PRCA219P",44,0)
 ; Find older bills that will most likely print next cycle after *219 installed
"RTN","PRCA219P",45,0)
 ; Categories are: Adult Day Health Care, C(Means Test), Geriatric Eval-Institutional, Geriatric Eval-Non-Institutional,
"RTN","PRCA219P",46,0)
 ;      Respite Care-Institutional, Respite Care-Non-Institional, RX Co-Payment/SC Vet, RX Co-Payment/NSC Vet, Hospital Care (NSC),
"RTN","PRCA219P",47,0)
 ;      Hospital Care Per Diem, Nursing Home Care Per Diem, Nursing Home Care (NSC), Nursing Home Care-LTC, Outpatient Care (NSC),
"RTN","PRCA219P",48,0)
 ;      Current Employee, Emergency/Humanitarian, Ineligible Hospital, Ex-Employee, Vendor, ChampVA Subsistence, Tricare Patient
"RTN","PRCA219P",49,0)
 ; 
"RTN","PRCA219P",50,0)
 N BILLDFN,CAT,LETTER2,LETTER3,CURBAL,PNAME,Z,X,Y,I,COUNT
"RTN","PRCA219P",51,0)
 S COUNT=0,BILLDFN=0
"RTN","PRCA219P",52,0)
 F  S BILLDFN=$O(^PRCA(430,"AC",16,BILLDFN)) Q:'BILLDFN  D
"RTN","PRCA219P",53,0)
 . S Z=$S($D(^PRCA(430,BILLDFN,7)):^(7),1:"") S Y=$P(Z,"^",1)+$P(Z,"^",2)+$P(Z,"^",3)+$P(Z,"^",4)+$P(Z,"^",5)
"RTN","PRCA219P",54,0)
 . S CURBAL=$J(Y,0,2) Q:CURBAL'>0
"RTN","PRCA219P",55,0)
 . S LETTER2=$P($G(^PRCA(430,BILLDFN,6)),"^",2) Q:LETTER2=""
"RTN","PRCA219P",56,0)
 . S %H=+$H-30  D YMD^%DTC Q:LETTER2>X
"RTN","PRCA219P",57,0)
 . S LETTER3=$P($G(^PRCA(430,BILLDFN,6)),"^",3) Q:LETTER3'=""
"RTN","PRCA219P",58,0)
 . S CAT=$P(^PRCA(430,BILLDFN,0),"^",2),CAT=","_CAT_","
"RTN","PRCA219P",59,0)
 . S I=",33,18,37,38,35,36,23,22,5,25,24,3,39,4,"
"RTN","PRCA219P",60,0)
 . I I'[CAT Q
"RTN","PRCA219P",61,0)
 . S CAT=$TR(CAT,",","")
"RTN","PRCA219P",62,0)
 . S ^XTMP("PRCA219P",$J,CAT,BILLDFN)=$P(^PRCA(430,BILLDFN,0),U,1)
"RTN","PRCA219P",63,0)
 . S COUNT=COUNT+1
"RTN","PRCA219P",64,0)
 ;
"RTN","PRCA219P",65,0)
 ;
"RTN","PRCA219P",66,0)
PRINT ;
"RTN","PRCA219P",67,0)
 U IO
"RTN","PRCA219P",68,0)
 N PRCADDT,PRCAQUIT,PRCAPG,BILLNO
"RTN","PRCA219P",69,0)
 S PRCADDT=$$FMTE^XLFDT($$NOW^XLFDT,"D")
"RTN","PRCA219P",70,0)
 S (PRCAQUIT,PRCAPG)=0
"RTN","PRCA219P",71,0)
 D HEAD
"RTN","PRCA219P",72,0)
 I '$G(COUNT) D  Q
"RTN","PRCA219P",73,0)
 .W !!!,?20,"*** No bills to report ***"
"RTN","PRCA219P",74,0)
 W !!,"*** COUNT OF LIKELY BILLS TO PRINT    "_COUNT," ***",!!
"RTN","PRCA219P",75,0)
 S CAT=0
"RTN","PRCA219P",76,0)
 F  S CAT=$O(^XTMP("PRCA219P",$J,CAT)) Q:'CAT!PRCAQUIT  S BILLDFN=0 D
"RTN","PRCA219P",77,0)
 . F  S BILLDFN=$O(^XTMP("PRCA219P",$J,CAT,BILLDFN)) Q:'BILLDFN  D  Q:PRCAQUIT
"RTN","PRCA219P",78,0)
 . . I $Y>(IOSL-4) D HEAD
"RTN","PRCA219P",79,0)
 . . S BILLNO=$P($G(^XTMP("PRCA219P",$J,CAT,BILLDFN)),U)
"RTN","PRCA219P",80,0)
 . . W !,?2,$P(^PRCA(430.2,CAT,0),U,1),?25,BILLNO
"RTN","PRCA219P",81,0)
 ;
"RTN","PRCA219P",82,0)
 I PRCAQUIT W:$D(ZTQUEUED) !!,"Report stopped at user's request" Q
"RTN","PRCA219P",83,0)
 I $G(PRCAPG)>0,$E(IOST)="C" K DIR S DIR(0)="E" D ^DIR K DIR S:+Y=0 PRCAQUIT=1
"RTN","PRCA219P",84,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","PRCA219P",85,0)
 Q
"RTN","PRCA219P",86,0)
 ;
"RTN","PRCA219P",87,0)
HEAD ;
"RTN","PRCA219P",88,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S (ZTSTOP,PRCAQUIT)=1 Q
"RTN","PRCA219P",89,0)
 I $G(PRCAPG)>0,$E(IOST)="C" K DIR S DIR(0)="E" D ^DIR K DIR S:+Y=0 PRCAQUIT=1
"RTN","PRCA219P",90,0)
 Q:PRCAQUIT
"RTN","PRCA219P",91,0)
 S PRCAPG=$G(PRCAPG)+1
"RTN","PRCA219P",92,0)
 W @IOF,!,PRCADDT,?15,"PRCA*4.5*219 Older Bills Most Likely to Print",?70,"Page:",$J(PRCAPG,5),! K X S $P(X,"-",81)="" W X,!
"RTN","PRCA219P",93,0)
 W !
"RTN","PRCA219P",94,0)
 W !,?2,"Category",?25,"Bill Number",!
"RTN","PRCA219P",95,0)
 S $P(X,"-",81)="" W X,!
"RTN","PRCA219P",96,0)
 Q
"RTN","PRCAGDR")
0^1^B10035785^B9334228
"RTN","PRCAGDR",1,0)
PRCAGDR ;WASH-ISC@ALTOONA,PA/CMS - BALANCE DISCREPANCY REPORT ;12/3/93  9:40 AM
"RTN","PRCAGDR",2,0)
V ;;4.5;Accounts Receivable;**78,198,219**;Mar 20, 1995;Build 18
"RTN","PRCAGDR",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCAGDR",4,0)
 N CHK,DAT,DEB,DIC,LN1,LN2,NAM,SSN,STD,PG,POP,Y,X,%ZIS S COMM=0
"RTN","PRCAGDR",5,0)
PAT ;select patient
"RTN","PRCAGDR",6,0)
 N DPTNOFZY,DPTNOFZK S (DPTNOFZY,DPTNOFZK)=1
"RTN","PRCAGDR",7,0)
 W ! S DIC="^DPT(",DIC(0)="AENMQ",DIC("A")="Select Patient: " D ^DIC G:Y<1 OUT S DEB=$O(^RCD(340,"B",+Y_";DPT(",0)) I 'DEB W *7," No AR Information exists!" G PAT
"RTN","PRCAGDR",8,0)
 S $P(LN1,"_",80)="",$P(LN2,"=",80)="",NAM=$$NAM^RCFN01(DEB),SSN=$E($$SSN^RCFN01(DEB),6,9),STD=$$PST^RCAMFN01(DEB) S:STD<1 STD="UNKNOWN"
"RTN","PRCAGDR",9,0)
 S PG=0 D HD
"RTN","PRCAGDR",10,0)
 I '$$EN^PRCAMRKC(DEB) W !!,"This patient's account is currently in balance!"
"RTN","PRCAGDR",11,0)
 E  W !!,"This account is out-of-balance!"
"RTN","PRCAGDR",12,0)
 D ST
"RTN","PRCAGDR",13,0)
 D ASK I CHK=1 D DEV
"RTN","PRCAGDR",14,0)
 G PAT
"RTN","PRCAGDR",15,0)
DEV W ! S IOP="Q",%ZIS="QN",%ZIS("B")="" D ^%ZIS G:POP OUT
"RTN","PRCAGDR",16,0)
 I '$D(IO("Q")) W !!,*7,"YOU MUST QUEUE THIS REPORT!!",! G DEV
"RTN","PRCAGDR",17,0)
 S ZTSAVE("DEB")="",ZTSAVE("NAM")="",ZTSAVE("SSN")="",ZTSAVE("STD")="",ZTRTN="EN^PRCAGDR",ZTDESC="AR DISCREPANCY REPORT" D ^%ZTLOAD G OUT
"RTN","PRCAGDR",18,0)
 Q
"RTN","PRCAGDR",19,0)
OUT D ^%ZISC
"RTN","PRCAGDR",20,0)
 K ^XTMP("PRCAGU",$J),COMM
"RTN","PRCAGDR",21,0)
 Q
"RTN","PRCAGDR",22,0)
CONT ;Ask to Continue
"RTN","PRCAGDR",23,0)
 ;N Y
"RTN","PRCAGDR",24,0)
 ;W !! S DIR(0)="E" D ^DIR I Y'=1 S DTOUT=1 Q
"RTN","PRCAGDR",25,0)
 Q
"RTN","PRCAGDR",26,0)
HD ;PAGE HEADING
"RTN","PRCAGDR",27,0)
 N DIR,Y S PG=PG+1
"RTN","PRCAGDR",28,0)
 W @IOF,!!,?3,NAM,"(",$E(NAM,1),SSN,")   ACCOUNT BALANCE DISCREPANCY REPORT"
"RTN","PRCAGDR",29,0)
 N %,%H,%I,X,Y
"RTN","PRCAGDR",30,0)
 D NOW^%DTC S Y=% D DD^%DT
"RTN","PRCAGDR",31,0)
 W !,?3,"STATEMENT DAY: ",STD,?46,Y,"    PAGE ",PG,!,LN2
"RTN","PRCAGDR",32,0)
HDQ Q
"RTN","PRCAGDR",33,0)
ASK ;Ask print statement
"RTN","PRCAGDR",34,0)
 N DIR,X,Y
"RTN","PRCAGDR",35,0)
 W ! S DIR("A")="Print example of patient statement",DIR(0)="Y" D ^DIR S CHK=Y
"RTN","PRCAGDR",36,0)
 Q
"RTN","PRCAGDR",37,0)
EN ;Enter here to print statement from queue
"RTN","PRCAGDR",38,0)
 N BN,DAT,PAGE,X,Y S PG=0,PAGE=0,$P(LN1,"_",80)="",$P(LN2,"=",80)=""
"RTN","PRCAGDR",39,0)
 D HD,ST
"RTN","PRCAGDR",40,0)
 Q
"RTN","PRCAGDR",41,0)
ST ;Start here find bills
"RTN","PRCAGDR",42,0)
 NEW BBAL,BEG,CHK,END,LDT3,PBAL,PDAT,PEND,SITE,TBAL,X,Y
"RTN","PRCAGDR",43,0)
 I 'STD D 9^PRCAGDT Q
"RTN","PRCAGDR",44,0)
 K ^TMP("PRCAGT",$J) D SITE^PRCAGU
"RTN","PRCAGDR",45,0)
 D NOW^%DTC S END=%,CHK=1,PBAL=0,DAT=$E(DT,1,5)_$S($L(STD)=1:0_STD,1:STD)
"RTN","PRCAGDR",46,0)
 S LDT3=$$FPS^RCAMFN01(DAT,-3)
"RTN","PRCAGDR",47,0)
 S BEG=$$LST^RCFN01(DEB,2) I $P(BEG,".")'<$P(DAT,".") D 8^PRCAGDT(BEG) Q
"RTN","PRCAGDR",48,0)
 I BEG<1 S PDAT="",BEG=0,PBAL=0
"RTN","PRCAGDR",49,0)
 I BEG S PDAT=BEG,BEG=9999999.999999-BEG D PBAL^PRCAGU(DEB,.BEG,.PBAL)
"RTN","PRCAGDR",50,0)
 D EN^PRCAGT(DEB,BEG,.END)
"RTN","PRCAGDR",51,0)
 S TBAL=0 D TBAL^PRCAGT(DEB,.TBAL)
"RTN","PRCAGDR",52,0)
 S BBAL=0 D BBAL^PRCAGU(DEB,.BBAL)
"RTN","PRCAGDR",53,0)
 W !!,"Patient Statement Check:",!!
"RTN","PRCAGDR",54,0)
 S X=$$PRE^PRCAGU(DEB) S PEND=$P(X,U,2),X=+X
"RTN","PRCAGDR",55,0)
 I X,BBAL D 3^PRCAGDT Q
"RTN","PRCAGDR",56,0)
 I BBAL=0,PEND,-PEND=PBAL+TBAL D 2^PRCAGDT Q
"RTN","PRCAGDR",57,0)
 I BBAL'=(PBAL+TBAL) D 1^PRCAGDT(DEB,BBAL,.TBAL,PBAL,BEG) Q
"RTN","PRCAGDR",58,0)
 I BBAL=0,$G(SITE("ZERO")) D 4^PRCAGDT Q
"RTN","PRCAGDR",59,0)
 I BBAL'>0,'$D(^TMP("PRCAGT",$J,DEB)) D 5^PRCAGDT Q
"RTN","PRCAGDR",60,0)
 I BBAL<0,BBAL>-.99 D 6^PRCAGDT Q
"RTN","PRCAGDR",61,0)
 I BBAL'<0,'$D(^XTMP("PRCAGU",$J,DEB)),'COMM D 10^PRCAGDT Q  ;third letter printed, not comment
"RTN","PRCAGDR",62,0)
 I CHK=1 D OK^PRCAGDT
"RTN","PRCAGDR",63,0)
 K ^TMP("PRCAGT",$J)
"RTN","PRCAGDR",64,0)
 Q
"RTN","PRCAGDT")
0^3^B20730755^B19643780
"RTN","PRCAGDT",1,0)
PRCAGDT ;WASH-ISC@ALTOONA,PA/CMS - BALANCE DISCREPANCY REPORT TEXT ;12/3/93  10:36 AM
"RTN","PRCAGDT",2,0)
V ;;4.5;Accounts Receivable;**219**;Mar 20, 1995;Build 18
"RTN","PRCAGDT",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCAGDT",4,0)
 Q
"RTN","PRCAGDT",5,0)
OK ;Statement should print
"RTN","PRCAGDT",6,0)
 N X,Y
"RTN","PRCAGDT",7,0)
 W !!,"Everything is Okay!  This patient's statement will print."
"RTN","PRCAGDT",8,0)
 S CHK=1
"RTN","PRCAGDT",9,0)
 I $D(ZTQUEUED) W !!! D ^PRCAGST1
"RTN","PRCAGDT",10,0)
 Q
"RTN","PRCAGDT",11,0)
1(DEB,BBAL,TBAL,PBAL,BEG) ;;balance discrepancy
"RTN","PRCAGDT",12,0)
 N X,Y
"RTN","PRCAGDT",13,0)
 W !!,"The balance of the outstanding AR bills is: ",?50,"$",$J(BBAL,10,2)
"RTN","PRCAGDT",14,0)
 W !,"The Patient Statement balance (*amount due) is: ",?50,"$",$J((TBAL+PBAL),10,2)
"RTN","PRCAGDT",15,0)
 W !,"The difference between these two balances is: ",?50,"$",$J((BBAL-(TBAL+PBAL)),10,2)
"RTN","PRCAGDT",16,0)
 W !!,"The *amount due balance on the Patient Statement contains:"
"RTN","PRCAGDT",17,0)
 S Y=BEG X ^DD("DD")
"RTN","PRCAGDT",18,0)
 W !,"Previous Statement balance of $",$J(PBAL,0,2),$S(Y'=0:" (all activity through "_Y_")",1:"")
"RTN","PRCAGDT",19,0)
 W !,?23,"+ New activity $",$J(TBAL,0,2)
"RTN","PRCAGDT",20,0)
 W !!,"Please create the appropriate transactions to get the overall account balance",!,"to equal the Patient Statement balance. Then review all bills to ensure the",!,"patient is being billed accurately."
"RTN","PRCAGDT",21,0)
 G OUT
"RTN","PRCAGDT",22,0)
2 ;Total amount due is in an unprocessed status
"RTN","PRCAGDT",23,0)
 W !!,"This patient's statement will not print at this time because the total",!,"outstanding amount of this account is in an unprocessed status.",!,"The unprocessed status may be Refund Review or Pending Calm Code."
"RTN","PRCAGDT",24,0)
 W !!,"You should process all unprocessed bills!"
"RTN","PRCAGDT",25,0)
 G OUT
"RTN","PRCAGDT",26,0)
3 ;outstanding bills and unprocessed Prepay bills
"RTN","PRCAGDT",27,0)
 W !!,"This patient's statement will not print at this time because it has an Open",!,"or Active bill and an unprocessed Prepayment bill.  The unprocessed status",!,"may be Refund Review or Pending Calm Code."
"RTN","PRCAGDT",28,0)
 W !!,"You should process all unprocessed bills!"
"RTN","PRCAGDT",29,0)
 G OUT
"RTN","PRCAGDT",30,0)
4 ;Site parameter says not to print zero balance statements
"RTN","PRCAGDT",31,0)
 W !!,"This patient's statement will not print at this time because it has a zero",!,"balance and the site parameter 'Suppress Zero Balance' field is set to Yes."
"RTN","PRCAGDT",32,0)
 G OUT
"RTN","PRCAGDT",33,0)
5 ;no amt due and no activity, might have prepay with no activity
"RTN","PRCAGDT",34,0)
 W !!,"This patient's statement will not print at this time because either there is",!,"no amount due and no new activity or this account has a credit balance with",!,"no new activity."
"RTN","PRCAGDT",35,0)
 G OUT
"RTN","PRCAGDT",36,0)
6 ;refund amount is less than $1.00
"RTN","PRCAGDT",37,0)
 W !!,"This patient's statement will not print because it has a refund balance",!,"less than a dollar."
"RTN","PRCAGDT",38,0)
 G OUT
"RTN","PRCAGDT",39,0)
7 ;no new activity (something other than int/admin charges) since the last three statement dates
"RTN","PRCAGDT",40,0)
 W !!,"This patient's statement will not print because it has no new activity",!,"for the past three statement dates other than int/admin charges."
"RTN","PRCAGDT",41,0)
 G OUT
"RTN","PRCAGDT",42,0)
8(BEG) ;statement print on or after this date
"RTN","PRCAGDT",43,0)
 N Y
"RTN","PRCAGDT",44,0)
 W !!,"This patient's statement will not print at this time because it printed",!
"RTN","PRCAGDT",45,0)
 S Y=BEG X ^DD("DD") W "on ",Y," and will not print until the next statement date."
"RTN","PRCAGDT",46,0)
 G OUT
"RTN","PRCAGDT",47,0)
9 ;statement date is unknown
"RTN","PRCAGDT",48,0)
 W !!,"Patient Statement Day is UNKNOWN!"
"RTN","PRCAGDT",49,0)
 G OUT
"RTN","PRCAGDT",50,0)
10 ;third letter already printed
"RTN","PRCAGDT",51,0)
 W !!,"This patient's statement will not print because the third letter has",!,"already been printed."
"RTN","PRCAGDT",52,0)
 W !!,"If you want to force a statement to print you can create a comment",!,"transaction and mark it so that it will appear on the statement."
"RTN","PRCAGDT",53,0)
 G OUT
"RTN","PRCAGDT",54,0)
OUT ;Exit here if account will not print statement
"RTN","PRCAGDT",55,0)
 S CHK=0
"RTN","PRCAGDT",56,0)
 I STD,$D(PDAT),$D(ZTQUEUED) W !!! D ^PRCAGST1
"RTN","PRCAGDT",57,0)
 Q
"RTN","PRCAGT")
0^8^B19865936^B19589638
"RTN","PRCAGT",1,0)
PRCAGT ;WASH-ISC@ALTOONA,PA/CMS-Patient Statement Build Tran List ;8/19/93
"RTN","PRCAGT",2,0)
V ;;4.5;Accounts Receivable;**100,162,165,169,219**;Mar 20, 1995;Build 18
"RTN","PRCAGT",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCAGT",4,0)
 ;SEND (DEB=340-IFN,BEG,END,TRANTYPE=430.3-IFN)
"RTN","PRCAGT",5,0)
 ;BUILD ^TMP("PRCAGT",$J,DEB,DATE,BILL,TN)=TAMT^TTY
"RTN","PRCAGT",6,0)
 ;IF (TN,TTY)=0 TAMT=BILL'S ORIG AMT
"RTN","PRCAGT",7,0)
 ;CALLER MUST KILL ^TMP
"RTN","PRCAGT",8,0)
EN(DEB,BEG,END,TTY) ;*CALLER MUST KILL ^TMP("PRCAGT",$J)
"RTN","PRCAGT",9,0)
 NEW Y K ^TMP("PRCAGT",$J)
"RTN","PRCAGT",10,0)
 S:$G(BEG)="" BEG=0 I $G(END)="" D NOW^%DTC S END=%
"RTN","PRCAGT",11,0)
 S TTY=$G(TTY) I TTY="" D F430
"RTN","PRCAGT",12,0)
 D F433
"RTN","PRCAGT",13,0)
Q Q
"RTN","PRCAGT",14,0)
F430 ;
"RTN","PRCAGT",15,0)
 NEW DAT,BN
"RTN","PRCAGT",16,0)
 S DAT=BEG F  S DAT=$O(^PRCA(430,"ATD",DEB,DAT)) Q:('DAT)!(DAT>END)  S BN=0 F  S BN=$O(^PRCA(430,"ATD",DEB,DAT,BN)) Q:'BN  D
"RTN","PRCAGT",17,0)
 .I $P(^PRCA(430,BN,0),U,3) S ^TMP("PRCAGT",$J,DEB,DAT,BN,0)=$P(^PRCA(430,BN,0),"^",3)_"^0"
"RTN","PRCAGT",18,0)
 Q
"RTN","PRCAGT",19,0)
F433 ;
"RTN","PRCAGT",20,0)
 NEW DAT,TN,TN0,TN1 S COMM=0
"RTN","PRCAGT",21,0)
 F DAT=BEG:0 S DAT=$O(^PRCA(433,"ATD",DEB,DAT)) Q:('DAT)!(DAT>END)  F TN=0:0 S TN=$O(^PRCA(433,"ATD",DEB,DAT,TN)) Q:'TN  D
"RTN","PRCAGT",22,0)
 .S TN0=$G(^PRCA(433,TN,0)) Q:TN0=""  S TN1=$G(^PRCA(433,TN,1))
"RTN","PRCAGT",23,0)
 .I $P(TN1,U,2)=45 S COMM=1
"RTN","PRCAGT",24,0)
 .I $G(TTY)'="" Q:TTY'=$P(TN1,U,2)
"RTN","PRCAGT",25,0)
 .I TTY="",",3,4,5,6,7,24,25,30,"[(","_$P(TN1,U,2)_",") Q
"RTN","PRCAGT",26,0)
 .I ($P(TN0,U,2)="")!($P(TN0,U,4)'=2) Q
"RTN","PRCAGT",27,0)
 .I $G(PRCAHIST)="THIST",$P(TN1,U,2)=45 G F433A
"RTN","PRCAGT",28,0)
 .I $P(TN0,U,10)=1 Q
"RTN","PRCAGT",29,0)
 .;
"RTN","PRCAGT",30,0)
 .;  if transaction type not 46 (unsuspended) and not 47 (suspended)
"RTN","PRCAGT",31,0)
 .;  then check to see if the bill was suspended or unsuspended at the
"RTN","PRCAGT",32,0)
 .;  time the transaction was entered.  if the bill is suspended, then
"RTN","PRCAGT",33,0)
 .;  the transaction should not be counted.  if the bill is unsuspended
"RTN","PRCAGT",34,0)
 .;  then the transaction should be counted.
"RTN","PRCAGT",35,0)
 .I $P(TN1,"^",2)'=46,$P(TN1,"^",2)'=47 D  I TN1="" Q
"RTN","PRCAGT",36,0)
 .   .   N RCTRANDA,RCSTOP,TRANTYPE
"RTN","PRCAGT",37,0)
 .   .   ;  check to see if bill was unsuspended when transaction was created
"RTN","PRCAGT",38,0)
 .   .   ;  if so, count the transaction
"RTN","PRCAGT",39,0)
 .   .   S RCSTOP=0
"RTN","PRCAGT",40,0)
 .   .   S RCTRANDA=TN F  S RCTRANDA=$O(^PRCA(433,"C",+$P(TN0,"^",2),RCTRANDA),-1) Q:'RCTRANDA  D  I RCSTOP Q
"RTN","PRCAGT",41,0)
 .   .   .   ;  transaction not complete
"RTN","PRCAGT",42,0)
 .   .   .   I $P($G(^PRCA(433,RCTRANDA,0)),"^",4)'=2 Q
"RTN","PRCAGT",43,0)
 .   .   .   S TRANTYPE=$P($G(^PRCA(433,RCTRANDA,1)),"^",2)
"RTN","PRCAGT",44,0)
 .   .   .   ;  transaction type is unsuspended (46) meaning the bill
"RTN","PRCAGT",45,0)
 .   .   .   ;  was unsuspended when the transaction was created.  the
"RTN","PRCAGT",46,0)
 .   .   .   ;  transaction should be counted.
"RTN","PRCAGT",47,0)
 .   .   .   I TRANTYPE=46 S RCSTOP=1 Q
"RTN","PRCAGT",48,0)
 .   .   .   ;  transaction type is suspended (47) meaning the bill
"RTN","PRCAGT",49,0)
 .   .   .   ;  was suspended when the transaction was created.  the
"RTN","PRCAGT",50,0)
 .   .   .   ;  transaction should not be counted.
"RTN","PRCAGT",51,0)
 .   .   .   I TRANTYPE=47 S RCSTOP=1,TN1="" Q
"RTN","PRCAGT",52,0)
 .;
"RTN","PRCAGT",53,0)
 .I TTY="",+$P(TN1,U,5)=0,$P(TN1,U,2)'=45 Q
"RTN","PRCAGT",54,0)
F433A .S ^TMP("PRCAGT",$J,DEB,DAT,$P(TN0,U,2),TN)=+$P(TN1,U,5)_U_$P(TN1,U,2)
"RTN","PRCAGT",55,0)
 S DAT=0 F  S DAT=$O(^TMP("PRCAGT",$J,DEB,DAT)) Q:'DAT  S END=DAT
"RTN","PRCAGT",56,0)
 Q
"RTN","PRCAGT",57,0)
TBAL(DEB,TBAL) ;get balance of transactions
"RTN","PRCAGT",58,0)
 NEW BN,CH,DAT,PC,RF,RR,TAMT,TN,TTY
"RTN","PRCAGT",59,0)
 S RR=+$O(^PRCA(430.2,"AC",33,0)),(CH,RF,PC)=0
"RTN","PRCAGT",60,0)
 I '$D(^TMP("PRCAGT",$J,DEB)) G TBALQ
"RTN","PRCAGT",61,0)
 F DAT=0:0 S DAT=$O(^TMP("PRCAGT",$J,DEB,DAT)) Q:'DAT  F BN=0:0 S BN=$O(^TMP("PRCAGT",$J,DEB,DAT,BN)) Q:'BN  D
"RTN","PRCAGT",62,0)
 .I $D(^TMP("PRCAGT",$J,DEB,DAT,BN,0)) S CH=CH+^(0)
"RTN","PRCAGT",63,0)
 .F TN=0:0 S TN=$O(^TMP("PRCAGT",$J,DEB,DAT,BN,TN)) Q:'TN  S TAMT=^(TN),TTY=$P(TAMT,U,2) I TTY'=45 D
"RTN","PRCAGT",64,0)
 ..I TTY=12 S:TAMT<0 PC=PC+TAMT S:TAMT'<0 CH=CH+TAMT
"RTN","PRCAGT",65,0)
 ..;  interest and admin charges may be negative
"RTN","PRCAGT",66,0)
 ..;  this was added in patch 165
"RTN","PRCAGT",67,0)
 ..I TTY'=13 S TAMT=$TR(+TAMT,"-")
"RTN","PRCAGT",68,0)
 ..I $P(^PRCA(430,BN,0),U,2)=RR S:TTY=1 PC=PC-TAMT S:TTY=35 CH=CH+TAMT S:TTY=41 RF=RF+TAMT Q
"RTN","PRCAGT",69,0)
 ..I ",2,8,9,10,11,14,19,47,34,35,29,"[(","_TTY_",") S PC=PC-TAMT Q
"RTN","PRCAGT",70,0)
 ..I ",1,13,46,43,"[(","_TTY_",") S CH=CH+TAMT
"RTN","PRCAGT",71,0)
 ;
"RTN","PRCAGT",72,0)
TBALQ S TBAL("RF")=RF,TBAL("CH")=CH,TBAL("PC")=PC,TBAL=RF+CH+PC
"RTN","PRCAGT",73,0)
 Q
"RTN","PRCAGT",74,0)
ACT(DEB,DAT) ;Quit 1 if debtor has activity other than interest
"RTN","PRCAGT",75,0)
 NEW BN,DATT,TN,TN0,TN1
"RTN","PRCAGT",76,0)
 S TN=0 F DATT=$P($G(DAT),"."):0 S DATT=$O(^PRCA(430,"ATD",DEB,DATT)) Q:'DATT!(TN)  F BN=0:0 S BN=$O(^PRCA(430,"ATD",DEB,DATT,BN)) Q:'BN!(TN)  S TN=1 Q
"RTN","PRCAGT",77,0)
 I TN=1 G Q1
"RTN","PRCAGT",78,0)
 S BN=0 F DATT=$P($G(DAT),"."):0 S DATT=$O(^PRCA(433,"ATD",DEB,DATT)) Q:'DATT!(BN)  F TN=0:0 S TN=$O(^PRCA(433,"ATD",DEB,DATT,TN)) Q:'TN!(BN)  D
"RTN","PRCAGT",79,0)
 .S TN0=$G(^PRCA(433,TN,0)) Q:TN0=""  S TN1=$G(^PRCA(433,TN,1))
"RTN","PRCAGT",80,0)
 .I ($P(TN0,U,4)=1)!($P(TN0,U,10)=1) Q
"RTN","PRCAGT",81,0)
 .I +$P(TN1,U,5)=0,$P(TN1,U,2)'=45 Q
"RTN","PRCAGT",82,0)
 .I +$P(TN1,U,2)'=13 S BN=1 Q
"RTN","PRCAGT",83,0)
 I BN=1 G Q1
"RTN","PRCAGT",84,0)
Q0 Q 0
"RTN","PRCAGT",85,0)
Q1 Q 1
"RTN","PRCAGU")
0^6^B11613288^B11143306
"RTN","PRCAGU",1,0)
PRCAGU ;WASH-ISC@ALTOONA,PA/CMS-Patient Statement Utility ;8/23/94  8:06 AM
"RTN","PRCAGU",2,0)
V ;;4.5;Accounts Receivable;**181,219**;Mar 20, 1995;Build 18
"RTN","PRCAGU",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCAGU",4,0)
 Q  ;This routine should not be called from the top
"RTN","PRCAGU",5,0)
SITE ;Set statement variables from Site Parameter File
"RTN","PRCAGU",6,0)
 NEW SP0,SP2
"RTN","PRCAGU",7,0)
 S SP0=$G(^RC(342,1,0)) I SP0="" G SITEQ
"RTN","PRCAGU",8,0)
 S SP2=$G(^RC(342,1,2))
"RTN","PRCAGU",9,0)
 S SITE("SUP")=+$P(SP0,U,2) ;suppres right&oblig
"RTN","PRCAGU",10,0)
 S SITE("DETL")=+$P(SP0,U,5) ;Copay info 1-brief or 2-expanded
"RTN","PRCAGU",11,0)
 S SITE("COM1")=$P($G(SP2),U,1) ;statement comment 1
"RTN","PRCAGU",12,0)
 S SITE("COM2")="" ; statement comment 2 disabled with GMT patch ;($P($G(SP2),U,2))
"RTN","PRCAGU",13,0)
 S SITE("SCAN")=$G(^RC(342,1,5)) ;mark for auto stuffer
"RTN","PRCAGU",14,0)
 S SITE("ZERO")=$P($G(SP0),U,9) ;suppress zero balance
"RTN","PRCAGU",15,0)
SITEQ Q
"RTN","PRCAGU",16,0)
PBAL(DEB,DAT,PBAL) ;get previous balance and date of last transaction
"RTN","PRCAGU",17,0)
 N EVN,I,Y G:'DEB PBALQ
"RTN","PRCAGU",18,0)
 S EVN=$O(^RC(341,"AD",DEB,+$O(^RC(341.1,"AC",2,0)),DAT,0))
"RTN","PRCAGU",19,0)
 I '$G(EVN) G PBALQ
"RTN","PRCAGU",20,0)
 S Y=$G(^RC(341,EVN,1)) F I=1:1:5 S PBAL=PBAL+$P(Y,U,I)
"RTN","PRCAGU",21,0)
 S DAT=$P($G(^RC(341,EVN,0)),U,6)
"RTN","PRCAGU",22,0)
PBALQ Q
"RTN","PRCAGU",23,0)
BBAL(DEB,BBAL) ;get bills balances return array
"RTN","PRCAGU",24,0)
 NEW ADM,AC,BAL,CT,I,INT,MF,OP,PB,PRE,STAT
"RTN","PRCAGU",25,0)
 S (BBAL,PB,INT,ADM,MF,CT)=0,LET3=""
"RTN","PRCAGU",26,0)
 G:'DEB BBALQ
"RTN","PRCAGU",27,0)
 S AC=+$O(^PRCA(430.3,"AC",102,0)),OP=+$O(^PRCA(430.3,"AC",112,0)),PRE=+$O(^PRCA(430.2,"AC",33,0))
"RTN","PRCAGU",28,0)
 F STAT=AC,OP F BN=0:0 S BN=$O(^PRCA(430,"AS",DEB,STAT,BN)) Q:'BN  D
"RTN","PRCAGU",29,0)
 .S BAL=$G(^PRCA(430,BN,7))
"RTN","PRCAGU",30,0)
 .I $D(^PRCA(430,BN,6)) S LET3=$P(^(6),U,3) I LET3="" S ^XTMP("PRCAGU",$J,DEB,BN)=""
"RTN","PRCAGU",31,0)
 .I $P(^PRCA(430,BN,0),U,2)=PRE S PB=PB-BAL Q
"RTN","PRCAGU",32,0)
 .S PB=PB+$P(BAL,U,1),INT=INT+$P(BAL,U,2),ADM=ADM+$P(BAL,U,3),MF=MF+$P(BAL,U,4),CT=CT+$P(BAL,U,5)
"RTN","PRCAGU",33,0)
 S BBAL=PB+INT+ADM+MF+CT
"RTN","PRCAGU",34,0)
 F X="PB","INT","ADM","MF","CT" S BBAL(X)=@X
"RTN","PRCAGU",35,0)
BBALQ Q
"RTN","PRCAGU",36,0)
UPDAT(DEB,DAT) ;update bill file 430 letter fields
"RTN","PRCAGU",37,0)
 NEW BN,DA,DIE,DR,II,LET,NOT,X,Y
"RTN","PRCAGU",38,0)
 G:'DEB UPDATQ
"RTN","PRCAGU",39,0)
 S:$G(DAT)="" DAT=DT S DIE="^PRCA(430,",NOT=0,BN=0
"RTN","PRCAGU",40,0)
 F  S BN=$O(^PRCA(430,"AS",DEB,16,BN)) Q:'BN  S DA=BN D
"RTN","PRCAGU",41,0)
 .S LET=$G(^PRCA(430,BN,6))
"RTN","PRCAGU",42,0)
 .F II=1:1:4 Q:$P(LET,U,II)=DAT  I $P(LET,U,II)="" S NOT=II,DR=$S(II=1:61,II=2:62,II=3:63,1:68)_"////^S X="_DAT_";68.1////^S X="_DAT D ^DIE Q
"RTN","PRCAGU",43,0)
UPDATQ Q
"RTN","PRCAGU",44,0)
BEVN(DEB,DAT) ;set event for non patient letters
"RTN","PRCAGU",45,0)
 NEW BAL,BN,DA,DIE,DR,EVN,I,NOT,X,Y
"RTN","PRCAGU",46,0)
 G:'DEB BEVNQ
"RTN","PRCAGU",47,0)
 S:$G(DAT)="" DAT=DT S DIE="^RC(341,",NOT=0,BN=0
"RTN","PRCAGU",48,0)
 F  S BN=$O(^PRCA(430,"AS",DEB,16,BN)) Q:'BN  D
"RTN","PRCAGU",49,0)
 .F I=1:1:3 I $P($G(^PRCA(430,BN,6)),U,I)=DAT S NOT=I Q
"RTN","PRCAGU",50,0)
 .S:'NOT NOT=4 S BAL=$G(^PRCA(430,BN,7)),ERR="",EVN=""
"RTN","PRCAGU",51,0)
 .D OPEN^RCEVDRV1(10,$P(^RCD(340,DEB,0),U),DAT,DUZ,$$SITE^RCMSITE,.ERR,.EVN,+BAL_U_$P(BAL,U,2)_U_$P(BAL,U,3)_U_$P(BAL,U,4)_U_$P(BAL,U,5))
"RTN","PRCAGU",52,0)
 .I EVN S DA=EVN,DR="5.01////^S X="_BN_";5.02////^S X="_NOT D ^DIE D CLOSE^RCEVDRV1(EVN)
"RTN","PRCAGU",53,0)
BEVNQ Q
"RTN","PRCAGU",54,0)
PRE(DEB) ;check for prepay bills in Refund review or Pending Calm
"RTN","PRCAGU",55,0)
 NEW BAL,BN,PEN,PRE,RR,STAT,Y
"RTN","PRCAGU",56,0)
 S (BAL,Y)=0 G:'DEB PREQ
"RTN","PRCAGU",57,0)
 S RR=+$O(^PRCA(430.3,"AC",113,0)),PEN=+$O(^PRCA(430.3,"AC",107,0)),PRE=+$O(^PRCA(430.2,"AC",33,0))
"RTN","PRCAGU",58,0)
 F STAT=RR,PEN F BN=0:0 S BN=$O(^PRCA(430,"AS",DEB,STAT,BN)) Q:'BN  D
"RTN","PRCAGU",59,0)
 .I $P($G(^PRCA(430,BN,0)),U,2)=PRE S Y=BN,BAL=BAL+$G(^PRCA(430,BN,7))
"RTN","PRCAGU",60,0)
PREQ Q Y_U_BAL
"RTN","PRCAGU",61,0)
LST(DEB,EVN,BDT) ;get last statement date before the statement date sent
"RTN","PRCAGU",62,0)
 NEW BEG,DAT,Y
"RTN","PRCAGU",63,0)
 S BDT=0 I 'DEB G LSTQ
"RTN","PRCAGU",64,0)
 S Y=+$O(^RC(341.1,"AC",2,0)),BEG=$P($G(^RC(341,EVN,0)),U,7) I 'BEG G LSTQ
"RTN","PRCAGU",65,0)
 S BEG=9999999.999999-BEG
"RTN","PRCAGU",66,0)
 F DAT=BEG:0 S DAT=$O(^RC(341,"AD",DEB,Y,DAT)) Q:'DAT  S BDT=DAT Q
"RTN","PRCAGU",67,0)
 ;return BDT in inverse date
"RTN","PRCAGU",68,0)
LSTQ Q
"RTN","RCCPCPS")
0^4^B71238973^B70423807
"RTN","RCCPCPS",1,0)
RCCPCPS ;WASH-ISC@ALTOONA,PA/NYB-Build Patient Statement File ;12/19/96  4:14 PM
"RTN","RCCPCPS",2,0)
V ;;4.5;Accounts Receivable;**34,70,80,48,104,116,149,170,181,190,223,237,219**;Mar 20, 1995;Build 18
"RTN","RCCPCPS",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCCPCPS",4,0)
EN N CCPC,CNT,DAT,DEB,DIK,END,INADFL,LDT1,LDT3,PCC,PRN,RCDATE,RCT,SVADM,SVAMT,SVINT,SVOTH,SITE,TXT,VAR,X,%
"RTN","RCCPCPS",5,0)
 N RCINFULL,RCINPART S COMM=0
"RTN","RCCPCPS",6,0)
 K ^RCPS(349.2)
"RTN","RCCPCPS",7,0)
 F X="PA","IS" S RCT=$O(^RCT(349.1,"B",X,0)) Q:'RCT  K ^RCT(349.1,+RCT,4),^RCT(349.1,+RCT,5)
"RTN","RCCPCPS",8,0)
 K ^XTMP("RCCPC")
"RTN","RCCPCPS",9,0)
 D DT^DICRW,SITE^PRCAGU
"RTN","RCCPCPS",10,0)
 I '$D(SITE) W !!,"AR SITE PARAMETER ENTRIES NOT DEFINED!",?50 D NOW^%DTC S Y=% D DD^%DT W Y W !!,"COULD NOT PROCESS AR PATIENT STATEMENTS" Q
"RTN","RCCPCPS",11,0)
 D NOW^%DTC S END=%
"RTN","RCCPCPS",12,0)
 S LDT1=$$FPS^RCAMFN01(DT,-1),RCDATE=DT
"RTN","RCCPCPS",13,0)
 S (CNT,DEB)=0,PRN=1
"RTN","RCCPCPS",14,0)
 F  S DEB=$O(^RCD(340,"AB","DPT(",DEB)) Q:DEB=""  D
"RTN","RCCPCPS",15,0)
 .   N AMT,BBAL,BEG,BN,CAT,DESC,ETY,FC,ND,PAT,PBAL,PC
"RTN","RCCPCPS",16,0)
 .   N PDAT,PEND,ST,SVINT,SVADM,SVOTH,ADDR
"RTN","RCCPCPS",17,0)
 .   I $L(+$$SSN^RCFN01(DEB))<5 Q
"RTN","RCCPCPS",18,0)
 .   ;Check for Emergency Response Indicator (ERI) Flag.
"RTN","RCCPCPS",19,0)
 .   N RCDFN S RCDFN=$P($G(^RCD(340,DEB,0)),"^",1) I $$EMERES^PRCAUTL(+RCDFN)]"" Q
"RTN","RCCPCPS",20,0)
 .   S INADFL=0
"RTN","RCCPCPS",21,0)
 .   S (SVADM,SVAMT,SVINT,SVOTH)=0
"RTN","RCCPCPS",22,0)
 .   N REF,SBAL,SDT,TBAL,TN,TTY,X,Y
"RTN","RCCPCPS",23,0)
 .   K ^TMP("PRCAGT",$J)
"RTN","RCCPCPS",24,0)
 .   S BEG=+$$LST^RCFN01(DEB,2)
"RTN","RCCPCPS",25,0)
 .   S LDT3=$S(BEG>0:$$FPS^RCAMFN01($P(BEG,"."),-3),1:0)
"RTN","RCCPCPS",26,0)
 .   I $P(BEG,".")'<$P(RCDATE,".") Q
"RTN","RCCPCPS",27,0)
 .   D NOW^%DTC S END=%
"RTN","RCCPCPS",28,0)
 .   I BEG<1 S PDAT="",BEG=0,PBAL=0
"RTN","RCCPCPS",29,0)
 .   I BEG S PDAT=BEG,BEG=9999999.999999-BEG,PBAL=0 D PBAL^PRCAGU(DEB,.BEG,.PBAL) ;get prev bal
"RTN","RCCPCPS",30,0)
 .   D EN^PRCAGT(DEB,BEG,.END)
"RTN","RCCPCPS",31,0)
 .   S TBAL=0 D TBAL^PRCAGT(DEB,.TBAL) ;get trans bal
"RTN","RCCPCPS",32,0)
 .   S BBAL=0 D BBAL^PRCAGU(DEB,.BBAL) ;get bill bal
"RTN","RCCPCPS",33,0)
 .   S X=$$PRE^PRCAGU(DEB) S PEND=$P(X,U,2),X=+X I X,BBAL D REF^PRCAGD(DEB,X,$G(REP)) Q
"RTN","RCCPCPS",34,0)
 .   I BBAL=0,PEND,-PEND=PBAL+TBAL Q
"RTN","RCCPCPS",35,0)
 .   I BBAL'=(PBAL+TBAL) D EN^PRCAGD(DEB,BBAL,TBAL,PBAL,BEG,$G(REP)) Q
"RTN","RCCPCPS",36,0)
 .   I BBAL'>0,'$D(^TMP("PRCAGT",$J,DEB)) Q
"RTN","RCCPCPS",37,0)
 .   I BBAL=0,$G(SITE("ZERO")) Q
"RTN","RCCPCPS",38,0)
 .   I BBAL<0,BBAL>-.99 Q
"RTN","RCCPCPS",39,0)
 .   I BBAL'<0,'$D(^XTMP("PRCAGU",$J,DEB)),'COMM Q  ;third letter printed,not comment
"RTN","RCCPCPS",40,0)
 .   S TBAL=TBAL+PBAL
"RTN","RCCPCPS",41,0)
 .   I '$D(^RCPS(349.2,0)) S ^(0)="AR CCPC STATEMENTS RECORDS^349.2I^"
"RTN","RCCPCPS",42,0)
 .   S ^RCPS(349.2,DEB,0)=DEB_"^"_$$SSN^RCFN01(DEB)_"^"
"RTN","RCCPCPS",43,0)
 .   S ADDR=$$DADD^RCAMADD(DEB,1) ;get patient's address, confidential if applicable
"RTN","RCCPCPS",44,0)
 .   S ^RCPS(349.2,DEB,1)=$P(ADDR,"^",1,6)
"RTN","RCCPCPS",45,0)
 .   S ST=$P(ADDR,"^",5)
"RTN","RCCPCPS",46,0)
 .   S ^RCPS(349.2,DEB,7)=$P(^RCD(340,DEB,0),U,7) ;large print
"RTN","RCCPCPS",47,0)
 .   I $G(ST)'="" S ST=$O(^DIC(5,"C",ST,0))
"RTN","RCCPCPS",48,0)
 .   I $G(ST)>90 S FC=$P($G(^DIC(5,ST,0)),"^")
"RTN","RCCPCPS",49,0)
 .   S $P(^RCPS(349.2,DEB,1),"^",7)=$G(FC) S:$G(FC)]"" $P(^RCPS(349.2,DEB,1),"^",5)="FX"
"RTN","RCCPCPS",50,0)
 .   S:$G(FC)]"" $P(^RCPS(349.2,DEB,1),"^",6)=$P(ADDR,"^",8)
"RTN","RCCPCPS",51,0)
 .   D NOW^%DTC S $P(^RCPS(349.2,DEB,0),"^",10)=%
"RTN","RCCPCPS",52,0)
 .   S $P(^RCPS(349.2,DEB,0),"^",3)=$$NAM^RCFN01(DEB)
"RTN","RCCPCPS",53,0)
 .   S $P(^RCPS(349.2,DEB,0),"^",4,7)=$S(TBAL'>0:0,1:TBAL)_"^"_PBAL_"^"_TBAL("CH")_"^"_TBAL("PC"),$P(^(0),"^",8)=PBAL+TBAL("CH")+TBAL("PC")+TBAL("RF")
"RTN","RCCPCPS",54,0)
 .   S $P(^RCPS(349.2,DEB,0),"^",13,17)=BBAL("PB")_"^"_BBAL("INT")_"^"_BBAL("ADM")_"^"_BBAL("MF")_"^"_BBAL("CT")
"RTN","RCCPCPS",55,0)
 .   ;
"RTN","RCCPCPS",56,0)
 .   N RCBILLDA,RCDATA1,RCDEBTDA,RCDESC,RCPSDA,RCTOTAL,RCTRANDA,RCTRDATE,VALUE,RCCOM1,RCCOM2,RCCOM3
"RTN","RCCPCPS",57,0)
 .   S RCDEBTDA=DEB
"RTN","RCCPCPS",58,0)
 .   I '$D(^RCPS(349.2,RCDEBTDA,2,0)) S ^(0)="^349.21DA^^"
"RTN","RCCPCPS",59,0)
 .   ;
"RTN","RCCPCPS",60,0)
 .   S RCCOM1=$E($TR($G(SITE("COM1")),"~|^",""),1,80),(RCCOM2,RCCOM3)=""
"RTN","RCCPCPS",61,0)
 .   ; Add second comment line for the GMT-reduced status
"RTN","RCCPCPS",62,0)
 .   I $$GMT^PRCAGST(RCDEBTDA) S RCCOM2="REDUCTION OF INPATIENT COPAYMENT DUE TO GEOGRAPHIC MEANS TEST STATUS"
"RTN","RCCPCPS",63,0)
 .   I TBAL'>0 S RCCOM3=" *THIS IS NOT A BILL*"
"RTN","RCCPCPS",64,0)
 .   I RCCOM1'="",RCCOM2'="" S $E(RCCOM1,80)=" " ;Make sure GMT message will be printed on separate line.
"RTN","RCCPCPS",65,0)
 .   S ^RCPS(349.2,RCDEBTDA,3)=RCCOM1_RCCOM2_RCCOM3
"RTN","RCCPCPS",66,0)
 .   ;
"RTN","RCCPCPS",67,0)
 .   S RCPSDA=0 ; this variable used to set the description on the PS segment
"RTN","RCCPCPS",68,0)
 .   S RCTRDATE=0 F  S RCTRDATE=$O(^TMP("PRCAGT",$J,RCDEBTDA,RCTRDATE)) Q:'RCTRDATE  S RCBILLDA=0 F  S RCBILLDA=$O(^TMP("PRCAGT",$J,RCDEBTDA,RCTRDATE,RCBILLDA)) Q:'RCBILLDA  D
"RTN","RCCPCPS",69,0)
 .   .   I $P($G(^RCPS(349.2,RCDEBTDA,0)),"^",8)<0 S PC(75)=75
"RTN","RCCPCPS",70,0)
 .   .   I $P($G(^PRCA(430,RCBILLDA,6)),"^",2)]"",($P($G(^PRCA(430,RCBILLDA,7)),"^")>0) S PC(1)="01"
"RTN","RCCPCPS",71,0)
 .   .   S CAT=$P($G(^PRCA(430,RCBILLDA,0)),"^",2)
"RTN","RCCPCPS",72,0)
 .   .   S PC=$P($G(^PRCA(430.2,CAT,0)),"^",14)
"RTN","RCCPCPS",73,0)
 .   .   F X=1:1:100 I $P(PC,",",X)'="" S PCC=$P(PC,",",X),PC(+PCC)=PCC Q:PCC=""
"RTN","RCCPCPS",74,0)
 .   .   S PC="",X=0 F  S X=$O(PC(X)) Q:X=""  I $G(PC(X))'="" S PC=PC_PC(X)
"RTN","RCCPCPS",75,0)
 .   .   S $P(^RCPS(349.2,RCDEBTDA,4),"^")=PC
"RTN","RCCPCPS",76,0)
 .   .   ;
"RTN","RCCPCPS",77,0)
 .   .   I $D(^TMP("PRCAGT",$J,RCDEBTDA,RCTRDATE,RCBILLDA,0)) S AMT=+^(0) I AMT D
"RTN","RCCPCPS",78,0)
 .   .   .   ;  get the description for the bill
"RTN","RCCPCPS",79,0)
 .   .   .   K RCDESC D BILLDESC^RCCPCPS1(RCBILLDA)
"RTN","RCCPCPS",80,0)
 .   .   .   ;
"RTN","RCCPCPS",81,0)
 .   .   .   ;  store the description in file 349.2, PS segment
"RTN","RCCPCPS",82,0)
 .   .   .   S RCPSDA=RCPSDA+1
"RTN","RCCPCPS",83,0)
 .   .   .   S $P(^RCPS(349.2,RCDEBTDA,2,RCPSDA,0),"^",1,4)=$P(RCTRDATE,".")_"^"_$G(RCDESC(1))_"^"_$G(AMT)_"^"_$P(^PRCA(430,RCBILLDA,0),"^")
"RTN","RCCPCPS",84,0)
 .   .   .   F X=2:1 Q:$G(RCDESC(X))=""  S RCPSDA=RCPSDA+1,^RCPS(349.2,RCDEBTDA,2,RCPSDA,0)="^"_RCDESC(X)_"^^"
"RTN","RCCPCPS",85,0)
 .   .   ;
"RTN","RCCPCPS",86,0)
 .   .   S RCTRANDA=0 F  S RCTRANDA=$O(^TMP("PRCAGT",$J,RCDEBTDA,RCTRDATE,RCBILLDA,RCTRANDA)) D:'RCTRANDA NO Q:'RCTRANDA  D
"RTN","RCCPCPS",87,0)
 .   .   .   ;  get the description for the transaction
"RTN","RCCPCPS",88,0)
 .   .   .   K RCDESC D TRANDESC^RCCPCPS1(RCTRANDA),RCDESC
"RTN","RCCPCPS",89,0)
 .   .   .   ;  if it is an interest/admin charge, summarize it below
"RTN","RCCPCPS",90,0)
 .   .   .   I $G(RCDESC(1))["INTEREST" Q
"RTN","RCCPCPS",91,0)
 .   .   .   ;  get the value of the transaction for the statement
"RTN","RCCPCPS",92,0)
 .   .   .   S VALUE=$$TRANVALU^RCDPBTLM(RCTRANDA)
"RTN","RCCPCPS",93,0)
 .   .   .   S VALUE=$P(VALUE,"^",2)+$P(VALUE,"^",3)+$P(VALUE,"^",4)+$P(VALUE,"^",5)+$P(VALUE,"^",6)
"RTN","RCCPCPS",94,0)
 .   .   .   ;  if it is a suspended (47) or unsuspended (46) transaction, show value
"RTN","RCCPCPS",95,0)
 .   .   .   ;  make suspended charges appear as negative
"RTN","RCCPCPS",96,0)
 .   .   .   S RCDATA1=$G(^PRCA(433,RCTRANDA,1))
"RTN","RCCPCPS",97,0)
 .   .   .   I $P(RCDATA1,"^",2)=47!($P(RCDATA1,"^",2)=46) S VALUE=$P(RCDATA1,"^",5) I $P(RCDATA1,"^",2)=47 S VALUE=-VALUE
"RTN","RCCPCPS",98,0)
 .   .   .   ;  if it is an amended bill, show value
"RTN","RCCPCPS",99,0)
 .   .   .   I $P(RCDATA1,"^",2)=33 S VALUE=$P(RCDATA1,"^",5)
"RTN","RCCPCPS",100,0)
 .   .   .   ;  store the description in file 349.2, PS segment
"RTN","RCCPCPS",101,0)
 .   .   .   S RCPSDA=RCPSDA+1
"RTN","RCCPCPS",102,0)
 .   .   .   S $P(^RCPS(349.2,RCDEBTDA,2,RCPSDA,0),"^",1,5)=$P(RCTRDATE,".")_"^"_$G(RCDESC(1))_"^"_VALUE_"^"_$P(^PRCA(430,RCBILLDA,0),"^")
"RTN","RCCPCPS",103,0)
 .   .   .   F X=2:1 Q:$G(RCDESC(X))=""  S RCPSDA=RCPSDA+1,^RCPS(349.2,RCDEBTDA,2,RCPSDA,0)="^"_RCDESC(X)_"^^"
"RTN","RCCPCPS",104,0)
 .   .   .   ;
"RTN","RCCPCPS",105,0)
 .   .   .   ;  for comment transaction ... not sure what this is for ?
"RTN","RCCPCPS",106,0)
 .   .   .   I $P(RCDATA1,"^",2)=45,$P($G(^PRCA(433,RCTRANDA,5)),"^",2)["your waiver rights" S ^RCPS(349.2,+RCDEBTDA,4)="0150"
"RTN","RCCPCPS",107,0)
 .   ;
"RTN","RCCPCPS",108,0)
 .   ;  if interest, admin, or other, add them here
"RTN","RCCPCPS",109,0)
 .   S X=$G(RCTOTAL("INT"))+$G(RCTOTAL("ADM"))+$G(RCTOTAL("OTH"))
"RTN","RCCPCPS",110,0)
 .   I X>0 D
"RTN","RCCPCPS",111,0)
 .   .   S RCDESC="INTEREST/ADM. CHARGE (Int:"_$J($G(RCTOTAL("INT")),1,2)_" Adm:"_$J($G(RCTOTAL("ADM")),1,2)_" Other:"_$J($G(RCTOTAL("OTH")),1,2)_")"
"RTN","RCCPCPS",112,0)
 .   .   S RCPSDA=RCPSDA+1
"RTN","RCCPCPS",113,0)
 .   .   S ^RCPS(349.2,RCDEBTDA,2,RCPSDA,0)="^"_RCDESC_"^"_$J(X,1,2)
"RTN","RCCPCPS",114,0)
 .   .   S ^RCPS(349.2,RCDEBTDA,2,0)="^349.21DA^"_RCPSDA_"^"_RCPSDA
"RTN","RCCPCPS",115,0)
 .   ;
"RTN","RCCPCPS",116,0)
 .   ;  set 0th node
"RTN","RCCPCPS",117,0)
 .   I RCPSDA S ^RCPS(349.2,RCDEBTDA,2,0)="^349.21DA^"_RCPSDA_"^"_RCPSDA
"RTN","RCCPCPS",118,0)
 .   ;
"RTN","RCCPCPS",119,0)
 .   I RCPSDA'<287 S ^XTMP("RCCPC",0)=DT,^XTMP("RCCPC",RCDEBTDA)="" Q
"RTN","RCCPCPS",120,0)
 .   D NO
"RTN","RCCPCPS",121,0)
 ;
"RTN","RCCPCPS",122,0)
 S DIK="^RCPS(349.2," D IXALL^DIK
"RTN","RCCPCPS",123,0)
 S DEB=0 S DEB=$O(^RCPS(349.2,DEB)) Q:DEB=""  S $P(^(DEB,0),"^",18)=1
"RTN","RCCPCPS",124,0)
 K ^XTMP("PRCAGU",$J,DEB),COMM
"RTN","RCCPCPS",125,0)
 ;
"RTN","RCCPCPS",126,0)
OSTM ;Process old statements
"RTN","RCCPCPS",127,0)
 S DIK="^RCPS(349.2,",DA=0 F  S DA=$O(^XTMP("RCCPC",DA)) Q:'DA  D ^DIK
"RTN","RCCPCPS",128,0)
 K DA
"RTN","RCCPCPS",129,0)
 ;
"RTN","RCCPCPS",130,0)
STATMNT ;Print patient statements
"RTN","RCCPCPS",131,0)
 N IOP,ZTIO,ZTSAVE,ZTRTN,ZTDESC,ZTASK,%ZIS,ZTDTH,PRCADEV
"RTN","RCCPCPS",132,0)
 S (IOP,PRCADEV)=$P($G(^RC(342,1,0)),"^",8)
"RTN","RCCPCPS",133,0)
 I IOP]"" D
"RTN","RCCPCPS",134,0)
 .S ZTRTN="STM^RCCPCSTM",ZTDTH=$H,ZTDESC="Print old AR Statements"
"RTN","RCCPCPS",135,0)
 .S %ZIS="N0" D ^%ZIS Q:POP
"RTN","RCCPCPS",136,0)
 .S ZTSAVE("PRCADEV")="" D ^%ZTLOAD,^%ZISC
"RTN","RCCPCPS",137,0)
 Q
"RTN","RCCPCPS",138,0)
 ;
"RTN","RCCPCPS",139,0)
NO ;If there is no activity
"RTN","RCCPCPS",140,0)
 I $G(^RCPS(349.2,+DEB,4))["0150" D
"RTN","RCCPCPS",141,0)
 .S ^RCPS(349.2,+DEB,2,1,0)="^NOTICE: You now have delinquent charges. Please^^"
"RTN","RCCPCPS",142,0)
 .S ^RCPS(349.2,+DEB,2,2,0)="^review Enforcement of Involuntary Collections^^"
"RTN","RCCPCPS",143,0)
 .S ^RCPS(349.2,+DEB,2,3,0)="^on reverse.^^"
"RTN","RCCPCPS",144,0)
 .S ^RCPS(349.2,+DEB,2,0)="^^3^3"
"RTN","RCCPCPS",145,0)
 I $G(^RCPS(349.2,DEB,2,1,0))="" D
"RTN","RCCPCPS",146,0)
 .S ^RCPS(349.2,DEB,2,1,0)="^No Activity in the Last 30 Days!^^"
"RTN","RCCPCPS",147,0)
 .S ^RCPS(349.2,DEB,2,2,0)="^Please refer to previous statement of rights.^^"
"RTN","RCCPCPS",148,0)
 .S ^RCPS(349.2,DEB,2,0)="^^2^2"
"RTN","RCCPCPS",149,0)
 .I $G(^RCPS(349.2,DEB,4))="" S ^(4)="90"
"RTN","RCCPCPS",150,0)
 Q
"RTN","RCCPCPS",151,0)
BUILD ;This is the entry point from the BUILD CCPC file option
"RTN","RCCPCPS",152,0)
 N TDT,QDT,ZTDESC,ZTASK,ZTSK,ZDTDTH,ZTIO,ZTRTN
"RTN","RCCPCPS",153,0)
 S TDT=$O(^RCPS(349.2,0)) I TDT D
"RTN","RCCPCPS",154,0)
 .S TDT=$$ASOF^RCCPCFN($P($G(^RCPS(349.2,+TDT,0)),"^",10))
"RTN","RCCPCPS",155,0)
 .S TDT=$TR($$SLH^RCFN01(TDT),"/","")
"RTN","RCCPCPS",156,0)
 .S TDT("T")=$P($G(^RCT(349,1,0)),"^",10),TDT("T")=$E(TDT("T"),1,4)_$E(TDT("T"),7,8)
"RTN","RCCPCPS",157,0)
 .I TDT("T")=TDT D
"RTN","RCCPCPS",158,0)
 ..W *7,!,"The current file reflects activity as of ",$E(TDT,1,2)_"/"_$E(TDT,3,4)_"/"_$E(TDT,5,8)_".",!
"RTN","RCCPCPS",159,0)
 ..W !,"IT WAS TRANSMITTED ON ",$TR($P($P($G(^RCT(349,1,0)),"^"),".",2,4),".","/"),!
"RTN","RCCPCPS",160,0)
 ..S TDT=$P($G(^RCT(349,1,0)),"^",9)
"RTN","RCCPCPS",161,0)
 ..W !,"For statement date: ",$E(TDT,1,2)_"/"_$E(TDT,3,4)_"/"_$E(TDT,5,8)
"RTN","RCCPCPS",162,0)
 ..W !!,"PLEASE CONTACT CUSTOMER SUPPORT BEFORE PROCEEDING.",!!
"RTN","RCCPCPS",163,0)
TIME S ZTIO="",ZTRTN="EN^RCCPCPS",ZTDESC="Build CCPC Statement File"
"RTN","RCCPCPS",164,0)
 S ZTDTH="" D ^%ZTLOAD Q:$G(ZTSK)=""
"RTN","RCCPCPS",165,0)
 S %H=ZTSK("D") D YMD^%DTC S QDT=X_%
"RTN","RCCPCPS",166,0)
 I (QDT>DT_"."_0800)&(QDT<(DT_"."_1801)) D  G TIME
"RTN","RCCPCPS",167,0)
 .W !!,*7,"You Can Not Queue this Job Between 8:00am and 6:00pm.",!
"RTN","RCCPCPS",168,0)
 .D KILL^%ZTLOAD
"RTN","RCCPCPS",169,0)
 W !,"Queued for Building."
"RTN","RCCPCPS",170,0)
 Q
"RTN","RCCPCPS",171,0)
 ;
"RTN","RCCPCPS",172,0)
RCDESC ;Remove "IN PART" & "IN FULL" from the the bill description
"RTN","RCCPCPS",173,0)
 QUIT:$G(RCDESC(1))=""
"RTN","RCCPCPS",174,0)
 S RCINFULL=" (IN FULL)"
"RTN","RCCPCPS",175,0)
 S RCINPART=" (IN PART)"
"RTN","RCCPCPS",176,0)
 I RCDESC(1)[RCINFULL S RCDESC(1)=$P(RCDESC(1),RCINFULL)_$P(RCDESC(1),RCINFULL,2)
"RTN","RCCPCPS",177,0)
 I RCDESC(1)[RCINPART S RCDESC(1)=$P(RCDESC(1),RCINPART)_$P(RCDESC(1),RCINPART,2)
"RTN","RCCPCPS",178,0)
 Q
"RTN","RCCPCSTM")
0^5^B8969116^B8662408
"RTN","RCCPCSTM",1,0)
RCCPCSTM ;WASH-ISC@ALTOONA,PA/LDB-Patient Statement ;2/14/97  5:12 PM
"RTN","RCCPCSTM",2,0)
V ;;4.5;Accounts Receivable;**70,219**;Mar 20, 1995;Build 18
"RTN","RCCPCSTM",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCCPCSTM",4,0)
 ;ENTRY FROM NIGHTLY PROCESS
"RTN","RCCPCSTM",5,0)
 NEW HDAT,DEB
"RTN","RCCPCSTM",6,0)
STM ;called by RCCPCPS to print >32K at site
"RTN","RCCPCSTM",7,0)
 NEW DAT,END,LDT1,LDT3,SDT,SITE,PRNT,X1,X2 S COMM=0
"RTN","RCCPCSTM",8,0)
 D DT^DICRW,SITE^PRCAGU
"RTN","RCCPCSTM",9,0)
 S:$G(HDAT)="" HDAT=DT S SDT=+$E(HDAT,6,7),DAT=HDAT
"RTN","RCCPCSTM",10,0)
 D NOW^%DTC S END=%
"RTN","RCCPCSTM",11,0)
 S LDT1=$$FPS^RCAMFN01(HDAT,-1)
"RTN","RCCPCSTM",12,0)
 S LDT3=$$FPS^RCAMFN01(HDAT,-3)
"RTN","RCCPCSTM",13,0)
 S DEB=0 F  S DEB=$O(^XTMP("RCCPC",DEB)) Q:'DEB  D STS
"RTN","RCCPCSTM",14,0)
 K ^XTMP("RCCPC")
"RTN","RCCPCSTM",15,0)
 Q
"RTN","RCCPCSTM",16,0)
STS ;start statement process
"RTN","RCCPCSTM",17,0)
 NEW BBAL,BEG,PBAL,PDAT,PEND,SBAL,SDT,TBAL,X,Y
"RTN","RCCPCSTM",18,0)
 K ^TMP("PRCAGT",$J)
"RTN","RCCPCSTM",19,0)
 D NOW^%DTC S END=%
"RTN","RCCPCSTM",20,0)
 S BEG=+$$LST^RCFN01(DEB,2) I $P(BEG,".")'<$P(DAT,".") G STSQ ;statement printed on or after this date
"RTN","RCCPCSTM",21,0)
 I BEG<1 S PDAT="",BEG=0,PBAL=0 ;get last date/time event occurred
"RTN","RCCPCSTM",22,0)
 I BEG S PDAT=BEG,BEG=9999999.999999-BEG,PBAL=0 D PBAL^PRCAGU(DEB,.BEG,.PBAL) ;Get previous bal and prev date of last transaction
"RTN","RCCPCSTM",23,0)
 D EN^PRCAGT(DEB,BEG,.END) ;get transactions reset END to last tran
"RTN","RCCPCSTM",24,0)
 S TBAL=0 D TBAL^PRCAGT(DEB,.TBAL) ;get trans bal
"RTN","RCCPCSTM",25,0)
 S BBAL=0 D BBAL^PRCAGU(DEB,.BBAL) ;get bill bal
"RTN","RCCPCSTM",26,0)
 S X=$$PRE^PRCAGU(DEB) S PEND=$P(X,U,2),X=+X I X,BBAL D REF^PRCAGD(DEB,X,$G(REP)) G STSQ ;unprocessed refund and outstand bills send disc
"RTN","RCCPCSTM",27,0)
 I BBAL=0,PEND,-PEND=PBAL+TBAL G STSQ ;all of the amount due is prepayment pending or refund review status
"RTN","RCCPCSTM",28,0)
 I BBAL'=(PBAL+TBAL) D EN^PRCAGD(DEB,BBAL,TBAL,PBAL,BEG,$G(REP)) G STSQ ;send disc
"RTN","RCCPCSTM",29,0)
 I BBAL=0,$G(SITE("ZERO")) G STSQ ;zero balance
"RTN","RCCPCSTM",30,0)
 I BBAL'>0,'$D(^TMP("PRCAGT",$J,DEB)) G STSQ ;no amt due no activity
"RTN","RCCPCSTM",31,0)
 I BBAL<0,BBAL>-.99 G STSQ ;refund less than 1.00
"RTN","RCCPCSTM",32,0)
 I BBAL'<0,'$D(^XTMP("PRCAGU",$J,DEB)),'COMM G STSQ ;third letter printed,not comment
"RTN","RCCPCSTM",33,0)
 S TBAL=TBAL+PBAL
"RTN","RCCPCSTM",34,0)
 D EN^PRCAGST(DEB,.TBAL,PDAT,PBAL) S SITE("SCAN")="" ;print statement
"RTN","RCCPCSTM",35,0)
 D EN^PRCAGF(DEB,TBAL) S ERR="" ;get forms and print
"RTN","RCCPCSTM",36,0)
 D OPEN^RCEVDRV1(2,$P(^RCD(340,DEB,0),U),END,DUZ,$$SITE^RCMSITE,.ERR,.EVN,BBAL("PB")_U_BBAL("INT")_U_BBAL("ADM")_U_BBAL("CT")_U_BBAL("MF"))
"RTN","RCCPCSTM",37,0)
 I EVN D CLOSE^RCEVDRV1(EVN)
"RTN","RCCPCSTM",38,0)
 D UPDAT^PRCAGU(DEB,DT) ;set bill letter field
"RTN","RCCPCSTM",39,0)
 S SITE("SCAN")=$G(^RC(342,1,5))
"RTN","RCCPCSTM",40,0)
STSQ ;
"RTN","RCCPCSTM",41,0)
 K ^XTMP("PRCAGU",$J),COMM
"RTN","RCCPCSTM",42,0)
 Q
"VER")
8.0^22.0
"BLD",5702,6)
^235
**END**
**END**
