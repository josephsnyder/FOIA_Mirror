Released PRCA*4.5*256 SEQ #228
Extracted from mail message
**KIDS**:PRCA*4.5*256^

**INSTALL NAME**
PRCA*4.5*256
"BLD",7491,0)
PRCA*4.5*256^ACCOUNTS RECEIVABLE^0^3080129^y
"BLD",7491,1,0)
^^3^3^3080110^
"BLD",7491,1,1,0)
This patch is addressing the issue regarding all the Third Party bills
"BLD",7491,1,2,0)
associated with only revenue codes for pharmacy that are missed in
"BLD",7491,1,3,0)
the CBO AR Data Extract process.
"BLD",7491,4,0)
^9.64PA^^0
"BLD",7491,6.3)
6
"BLD",7491,"KRN",0)
^9.67PA^8989.52^19
"BLD",7491,"KRN",.4,0)
.4
"BLD",7491,"KRN",.401,0)
.401
"BLD",7491,"KRN",.402,0)
.402
"BLD",7491,"KRN",.403,0)
.403
"BLD",7491,"KRN",.5,0)
.5
"BLD",7491,"KRN",.84,0)
.84
"BLD",7491,"KRN",3.6,0)
3.6
"BLD",7491,"KRN",3.8,0)
3.8
"BLD",7491,"KRN",9.2,0)
9.2
"BLD",7491,"KRN",9.8,0)
9.8
"BLD",7491,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",7491,"KRN",9.8,"NM",1,0)
RCXVDC^^0^B6124708
"BLD",7491,"KRN",9.8,"NM",2,0)
RCXVDC4^^0^B17274468
"BLD",7491,"KRN",9.8,"NM",3,0)
RCXVFTP^^0^B4726496
"BLD",7491,"KRN",9.8,"NM","B","RCXVDC",1)

"BLD",7491,"KRN",9.8,"NM","B","RCXVDC4",2)

"BLD",7491,"KRN",9.8,"NM","B","RCXVFTP",3)

"BLD",7491,"KRN",19,0)
19
"BLD",7491,"KRN",19.1,0)
19.1
"BLD",7491,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",7491,"KRN",101,0)
101
"BLD",7491,"KRN",409.61,0)
409.61
"BLD",7491,"KRN",771,0)
771
"BLD",7491,"KRN",870,0)
870
"BLD",7491,"KRN",8989.51,0)
8989.51
"BLD",7491,"KRN",8989.52,0)
8989.52
"BLD",7491,"KRN",8994,0)
8994
"BLD",7491,"KRN","B",.4,.4)

"BLD",7491,"KRN","B",.401,.401)

"BLD",7491,"KRN","B",.402,.402)

"BLD",7491,"KRN","B",.403,.403)

"BLD",7491,"KRN","B",.5,.5)

"BLD",7491,"KRN","B",.84,.84)

"BLD",7491,"KRN","B",3.6,3.6)

"BLD",7491,"KRN","B",3.8,3.8)

"BLD",7491,"KRN","B",9.2,9.2)

"BLD",7491,"KRN","B",9.8,9.8)

"BLD",7491,"KRN","B",19,19)

"BLD",7491,"KRN","B",19.1,19.1)

"BLD",7491,"KRN","B",101,101)

"BLD",7491,"KRN","B",409.61,409.61)

"BLD",7491,"KRN","B",771,771)

"BLD",7491,"KRN","B",870,870)

"BLD",7491,"KRN","B",8989.51,8989.51)

"BLD",7491,"KRN","B",8989.52,8989.52)

"BLD",7491,"KRN","B",8994,8994)

"BLD",7491,"QUES",0)
^9.62^^
"BLD",7491,"REQB",0)
^9.611^1^1
"BLD",7491,"REQB",1,0)
PRCA*4.5*251^2
"BLD",7491,"REQB","B","PRCA*4.5*251",1)

"MBREQ")
0
"PKG",142,-1)
1^1
"PKG",142,0)
ACCOUNTS RECEIVABLE^PRCA^BILL COLLECTIONS
"PKG",142,20,0)
^9.402P^1^1
"PKG",142,20,1,0)
2^^PRCAMRG
"PKG",142,20,1,1)

"PKG",142,20,"B",2,1)

"PKG",142,22,0)
^9.49I^1^1
"PKG",142,22,1,0)
4.5^^2950320
"PKG",142,22,1,"PAH",1,0)
256^3080129
"PKG",142,22,1,"PAH",1,1,0)
^^3^3^3080129
"PKG",142,22,1,"PAH",1,1,1,0)
This patch is addressing the issue regarding all the Third Party bills
"PKG",142,22,1,"PAH",1,1,2,0)
associated with only revenue codes for pharmacy that are missed in
"PKG",142,22,1,"PAH",1,1,3,0)
the CBO AR Data Extract process.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","RCXVDC")
0^1^B6124708^B5579270
"RTN","RCXVDC",1,0)
RCXVDC ;DAOU/ALA-AR Data Extraction Data Creation ;02-JUL-03
"RTN","RCXVDC",2,0)
 ;;4.5;Accounts Receivable;**201,228,256**;Mar 20, 1995;Build 6
"RTN","RCXVDC",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCXVDC",4,0)
 ;
"RTN","RCXVDC",5,0)
 Q
"RTN","RCXVDC",6,0)
EN ; Entry Point
"RTN","RCXVDC",7,0)
 NEW RCXVD0,RCXVEVDT,RCXVBCN
"RTN","RCXVDC",8,0)
 NEW RCXVI,RCXVCP,RCXVPC,RCXVPFDT,RCXVPTDT
"RTN","RCXVDC",9,0)
 NEW RCXVBLNA,RCXVBLNB,RCXVICN
"RTN","RCXVDC",10,0)
 I DFN="" S DFN=$P($G(^PRCA(430,RCXVBLN,0)),U,7) ; 
"RTN","RCXVDC",11,0)
 K ^TMP($J)
"RTN","RCXVDC",12,0)
 D D430^RCXVDC1
"RTN","RCXVDC",13,0)
 I DFN'="" D D2^RCXVDC2
"RTN","RCXVDC",14,0)
 D D399^RCXVDC3
"RTN","RCXVDC",15,0)
 D D399PC^RCXVDC4
"RTN","RCXVDC",16,0)
 D D350^RCXVDC5
"RTN","RCXVDC",17,0)
 D D3625^RCXVDC7
"RTN","RCXVDC",18,0)
 I RCXVRT="D"!(RCXVRT="C")!(RCXVRT="E") D D433^RCXVDC6
"RTN","RCXVDC",19,0)
 I RCXVRT="H" D D433B^RCXVDC6
"RTN","RCXVDC",20,0)
 ;
"RTN","RCXVDC",21,0)
FILE ;
"RTN","RCXVDC",22,0)
 W "REC:"_RCXVBLNA,!
"RTN","RCXVDC",23,0)
 W "430:"_$G(^TMP($J,RCXVBLN,"1-430A"))_RCXVU
"RTN","RCXVDC",24,0)
 W $G(^TMP($J,RCXVBLN,"1-430B"))_RCXVU
"RTN","RCXVDC",25,0)
 W $G(^TMP($J,RCXVBLN,"1-430C"))
"RTN","RCXVDC",26,0)
 W !
"RTN","RCXVDC",27,0)
 I DFN'="" W "2:"_$G(^TMP($J,RCXVBLN,"2-2A"))_RCXVU_$G(^TMP($J,RCXVBLN,"2-2B")),!
"RTN","RCXVDC",28,0)
 I $G(^TMP($J,RCXVBLN,"3-399A"))'="" W "399:"_^TMP($J,RCXVBLN,"3-399A")_RCXVU_^TMP($J,RCXVBLN,"3-399B")_RCXVU_^TMP($J,RCXVBLN,"3-399C")_RCXVU_^TMP($J,RCXVBLN,"3-399D"),!
"RTN","RCXVDC",29,0)
 S RCXVPC=0
"RTN","RCXVDC",30,0)
 F  S RCXVPC=$O(^TMP($J,RCXVBLN,"4-399A",RCXVPC))  Q:'RCXVPC  D
"RTN","RCXVDC",31,0)
 . I $G(^TMP($J,RCXVBLN,"4-399A",RCXVPC))'="" D
"RTN","RCXVDC",32,0)
 .. W "399.0304:"
"RTN","RCXVDC",33,0)
 .. W $G(^TMP($J,RCXVBLN,"4-399A",RCXVPC))
"RTN","RCXVDC",34,0)
 .. W RCXVU
"RTN","RCXVDC",35,0)
 .. F RCXVCP=1:1 Q:('$D(^TMP($J,RCXVBLN,"4-399A",RCXVPC,RCXVCP)))  D
"RTN","RCXVDC",36,0)
 ... I RCXVCP>1 W "~"
"RTN","RCXVDC",37,0)
 ... W $G(^TMP($J,RCXVBLN,"4-399A",RCXVPC,RCXVCP))
"RTN","RCXVDC",38,0)
 ... Q
"RTN","RCXVDC",39,0)
 .. W !
"RTN","RCXVDC",40,0)
 . I $G(^TMP($J,RCXVBLN,"4-399B",RCXVPC))'="" W "399.042:"_$G(^TMP($J,RCXVBLN,"4-399B",RCXVPC)),!
"RTN","RCXVDC",41,0)
 . Q
"RTN","RCXVDC",42,0)
 S RCXVI=""
"RTN","RCXVDC",43,0)
 F  S RCXVI=$O(^TMP($J,RCXVBLN,"5-350A",RCXVI)) Q:RCXVI=""  D
"RTN","RCXVDC",44,0)
 . W "350:"_^TMP($J,RCXVBLN,"5-350A",RCXVI),!
"RTN","RCXVDC",45,0)
 S RCXVI=""
"RTN","RCXVDC",46,0)
 F  S RCXVI=$O(^TMP($J,RCXVBLN,"7-362.5A",RCXVI)) Q:RCXVI=""  D
"RTN","RCXVDC",47,0)
 . W "362.5:"_^TMP($J,RCXVBLN,"7-362.5A",RCXVI),!
"RTN","RCXVDC",48,0)
 ; LOOP THRU ^TMP($J,RCXVBLN,"6-433A",RCXVI)
"RTN","RCXVDC",49,0)
 S RCXVI=""
"RTN","RCXVDC",50,0)
 F  S RCXVI=$O(^TMP($J,RCXVBLN,"6-433A",RCXVI)) Q:RCXVI=""  D 
"RTN","RCXVDC",51,0)
 . W "433:"_$G(^TMP($J,RCXVBLN,"6-433A",RCXVI)),!
"RTN","RCXVDC",52,0)
 . Q
"RTN","RCXVDC",53,0)
 Q
"RTN","RCXVDC4")
0^2^B17274468^B11074749
"RTN","RCXVDC4",1,0)
RCXVDC4 ;DAOU/ALA-AR Data Extraction Data Creation ;02-JUL-03
"RTN","RCXVDC4",2,0)
 ;;4.5;Accounts Receivable;**201,227,228,248,251,256**;Mar 20, 1995;Build 6
"RTN","RCXVDC4",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCXVDC4",4,0)
 ;
"RTN","RCXVDC4",5,0)
 ; Procedures 
"RTN","RCXVDC4",6,0)
 Q
"RTN","RCXVDC4",7,0)
D399PC ;
"RTN","RCXVDC4",8,0)
 I RCXVD0="" Q
"RTN","RCXVDC4",9,0)
 N RCXVD,RCXVDA,RCXVB,RCXVPC,RCXVP1,RCXVP2,RCXVP3,RCXVMULT
"RTN","RCXVDC4",10,0)
 N RCXVDT3,RCXVCP,RCXVPCDT,RCXVPS1,RCXVPS2,RCXVPS,RCXVPSER,RCXVNPI,RCXVCNT,RCXVMH
"RTN","RCXVDC4",11,0)
 ;RCXVPC=PROC. CODE IEN, RCXVCP=CPT CODE IEN
"RTN","RCXVDC4",12,0)
 ; LOOP THRU PROC.
"RTN","RCXVDC4",13,0)
 S RCXVMH="",(RCXVPC,RCXVCNT)=0
"RTN","RCXVDC4",14,0)
 F  S RCXVPC=$O(^DGCR(399,RCXVD0,"CP",RCXVPC)) Q:'RCXVPC  D D399PCA
"RTN","RCXVDC4",15,0)
 S RCXVPC=0
"RTN","RCXVDC4",16,0)
 F  S RCXVPC=$O(^DGCR(399,RCXVD0,"RC",RCXVPC)) Q:'RCXVPC  D D39942
"RTN","RCXVDC4",17,0)
 Q
"RTN","RCXVDC4",18,0)
D399PCA ;
"RTN","RCXVDC4",19,0)
 S RCXVD=$G(^DGCR(399,RCXVD0,"CP",RCXVPC,0)) Q:RCXVD=""
"RTN","RCXVDC4",20,0)
 S RCXVP1=$P(RCXVD,U,1),RCXVVP="",RCXVVP1=""
"RTN","RCXVDC4",21,0)
 I RCXVP1'="" S RCXVVP="^"_$P(RCXVP1,";",2)_$P(RCXVP1,";",1)_",0)"
"RTN","RCXVDC4",22,0)
 I RCXVVP'="" S RCXVVP1=$P($G(@RCXVVP),U,1) I RCXVVP1="" D
"RTN","RCXVDC4",23,0)
 . NEW CT
"RTN","RCXVDC4",24,0)
 . S CT=$G(^TMP("RCXVBREC",$J,0))+1,^TMP("RCXVBREC",$J,0)=CT
"RTN","RCXVDC4",25,0)
 . S ^TMP("RCXVBREC",$J,CT,0)="Bill # "_$P($G(^DGCR(399,RCXVD0,0)),"^",1)_" has a bad CPT code at IEN # "_RCXVPC_" check ^DGCR(399,"_RCXVD0_",""CP"","_RCXVPC_",0)"
"RTN","RCXVDC4",26,0)
 S RCXVDA=RCXVBLNA_RCXVU_RCXVVP1 ; PROC.
"RTN","RCXVDC4",27,0)
 S RCXVDT=$P(RCXVD,U,2)
"RTN","RCXVDC4",28,0)
 S RCXVPCDT=$E($$HLDATE^HLFNC(RCXVDT),1,8)
"RTN","RCXVDC4",29,0)
 S RCXVDA=RCXVDA_RCXVU_RCXVPCDT ; DT 
"RTN","RCXVDC4",30,0)
 S RCXVP1=$P(RCXVD,U,11),RCXVP2=""
"RTN","RCXVDC4",31,0)
 I RCXVP1'="" S RCXVP1=$P($G(^IBA(362.3,RCXVP1,0)),U,1)
"RTN","RCXVDC4",32,0)
 I RCXVP1'="" S RCXVP2=$P($G(^ICD9(RCXVP1,0)),U,1)
"RTN","RCXVDC4",33,0)
 S RCXVDA=RCXVDA_RCXVU_RCXVP2 ; ASSOC DXN (1)
"RTN","RCXVDC4",34,0)
 S RCXVP1=$P(RCXVD,U,7),RCXVP2=""
"RTN","RCXVDC4",35,0)
 I RCXVP1'="" S RCXVP2=$P($G(^SC(RCXVP1,0)),U,1)
"RTN","RCXVDC4",36,0)
 S RCXVDA=RCXVDA_RCXVU_RCXVP2 ; ASSC. CLNC (P) 
"RTN","RCXVDC4",37,0)
 S RCXVP1=$P(RCXVD,U,18),(RCXVP2,RCXVPS,RCXVPSER,RCXVNPI)=""
"RTN","RCXVDC4",38,0)
 I RCXVP1'="" S RCXVP2=$$GET1^DIQ(200,RCXVP1_",",.01,"E"),RCXVNPI=$P($$NPI^XUSNPI("Individual_ID",RCXVP1),RCXVU,1) S:+RCXVNPI<1 RCXVNPI="" D
"RTN","RCXVDC4",39,0)
 . S RCXVPS=$$GET^XUA4A72(RCXVP1,RCXVDT)
"RTN","RCXVDC4",40,0)
 . S RCXVPS=$P(RCXVPS,U,3)
"RTN","RCXVDC4",41,0)
 . S RCXVPSER=$$GET1^DIQ(200,RCXVP1_",",29,"E")
"RTN","RCXVDC4",42,0)
 . Q
"RTN","RCXVDC4",43,0)
 ;provider^provider npi^specialty^service/section
"RTN","RCXVDC4",44,0)
 S RCXVDA=RCXVDA_RCXVU_RCXVP2_RCXVU_RCXVNPI_RCXVU_RCXVPS_RCXVU_RCXVPSER
"RTN","RCXVDC4",45,0)
 S RCXVCNT=RCXVCNT+1,^TMP($J,RCXVBLN,"4-399A",RCXVCNT)=RCXVDA
"RTN","RCXVDC4",46,0)
 ; LOOP THRU CPT
"RTN","RCXVDC4",47,0)
 S RCXVCP=0,RCXVMULT=0
"RTN","RCXVDC4",48,0)
 F  S RCXVCP=$O(^DGCR(399,RCXVD0,"CP",RCXVPC,"MOD",RCXVCP)) Q:'RCXVCP  D
"RTN","RCXVDC4",49,0)
 .  Q:'($D(^DGCR(399,RCXVD0,"CP",RCXVPC,"MOD",RCXVCP,0)))
"RTN","RCXVDC4",50,0)
 . ; ^DGCR(399,D0,CP,D1,MOD,D2,0)= (#.01) CPT MODIFIER SEQUENCE [1N]
"RTN","RCXVDC4",51,0)
 . ; (#.02) CPT ==>MODIFIER [2P:81.3]
"RTN","RCXVDC4",52,0)
 . S RCXVP1=$P($G(^DGCR(399,RCXVD0,"CP",RCXVPC,"MOD",RCXVCP,0)),U,2)
"RTN","RCXVDC4",53,0)
 . Q:RCXVP1=""
"RTN","RCXVDC4",54,0)
 . S RCXVMULT=RCXVMULT+1
"RTN","RCXVDC4",55,0)
 . S RCXVP2=$P($G(^DIC(81.3,RCXVP1,0)),U,1)
"RTN","RCXVDC4",56,0)
 . S ^TMP($J,RCXVBLN,"4-399A",RCXVCNT,RCXVMULT)=RCXVP2
"RTN","RCXVDC4",57,0)
 . Q
"RTN","RCXVDC4",58,0)
 ;
"RTN","RCXVDC4",59,0)
 ; *256 - loop through 399.042 to find CPT procedure
"RTN","RCXVDC4",60,0)
MATCH N RCXVCPT1,RCXVFND,X
"RTN","RCXVDC4",61,0)
 S RCXVCPT1=$P(RCXVD,";",1)  ;proc
"RTN","RCXVDC4",62,0)
 S (RCXVFND,RCXVCP)=0
"RTN","RCXVDC4",63,0)
 F  S RCXVCP=$O(^DGCR(399,RCXVD0,"RC",RCXVCP)) Q:'RCXVCP!RCXVFND  D
"RTN","RCXVDC4",64,0)
 . Q:$F(RCXVMH,";"_RCXVCP)  ;quit if CPT proc match
"RTN","RCXVDC4",65,0)
 . S RCXVD1=$G(^DGCR(399,RCXVD0,"RC",RCXVCP,0))
"RTN","RCXVDC4",66,0)
 . Q:RCXVD1=""
"RTN","RCXVDC4",67,0)
 . S X=$P(RCXVD1,U,6)  ;CPT proc
"RTN","RCXVDC4",68,0)
 . I RCXVCPT1'="",X'="",RCXVCPT1=X D
"RTN","RCXVDC4",69,0)
 .. S RCXVFND=1
"RTN","RCXVDC4",70,0)
 .. S X=$P(RCXVD1,U)
"RTN","RCXVDC4",71,0)
 .. S RCXVDB=RCXVBLNA_RCXVU_$$GET1^DIQ(399.2,X_",",.01,"E") ; Revenue Code
"RTN","RCXVDC4",72,0)
 .. S X=$P(RCXVD1,U,6)
"RTN","RCXVDC4",73,0)
 .. S RCXVDB=RCXVDB_RCXVU_$$GET1^DIQ(81,X_",",.01,"E") ; Procedures [P]
"RTN","RCXVDC4",74,0)
 .. S RCXVDB=RCXVDB_RCXVU_RCXVPCDT ; PROC. DT
"RTN","RCXVDC4",75,0)
 .. S RCXVDB=RCXVDB_RCXVU_$P(RCXVD1,U,2) ; Charges
"RTN","RCXVDC4",76,0)
 .. S ^TMP($J,RCXVBLN,"4-399B",RCXVCNT)=RCXVDB
"RTN","RCXVDC4",77,0)
 .. S RCXVMH=RCXVMH_";"_RCXVCP
"RTN","RCXVDC4",78,0)
 I 'RCXVFND S ^TMP($J,RCXVBLN,"4-399B",RCXVCNT)=""
"RTN","RCXVDC4",79,0)
 Q
"RTN","RCXVDC4",80,0)
 ;  
"RTN","RCXVDC4",81,0)
D39942 ; charge
"RTN","RCXVDC4",82,0)
 N X
"RTN","RCXVDC4",83,0)
 Q:$F(RCXVMH,";"_RCXVPC)
"RTN","RCXVDC4",84,0)
 S RCXVD1=$G(^DGCR(399,RCXVD0,"RC",RCXVPC,0))
"RTN","RCXVDC4",85,0)
 Q:RCXVD1=""
"RTN","RCXVDC4",86,0)
 S X=$P(RCXVD1,U)
"RTN","RCXVDC4",87,0)
 S RCXVDB=RCXVBLNA_RCXVU_$$GET1^DIQ(399.2,X_",",.01,"E") ; Revenue Code
"RTN","RCXVDC4",88,0)
 S RCXVDB=RCXVDB_RCXVU_""  ;No CPT proc
"RTN","RCXVDC4",89,0)
 S RCXVDB=RCXVDB_RCXVU_"" ; No proc dt
"RTN","RCXVDC4",90,0)
 S RCXVDB=RCXVDB_RCXVU_$P(RCXVD1,U,2) ; Charges
"RTN","RCXVDC4",91,0)
 S RCXVCNT=RCXVCNT+1
"RTN","RCXVDC4",92,0)
 S ^TMP($J,RCXVBLN,"4-399A",RCXVCNT)=""
"RTN","RCXVDC4",93,0)
 S ^TMP($J,RCXVBLN,"4-399B",RCXVCNT)=RCXVDB
"RTN","RCXVDC4",94,0)
 Q
"RTN","RCXVDC4",95,0)
 ;
"RTN","RCXVFTP")
0^3^B4726496^B4723718
"RTN","RCXVFTP",1,0)
RCXVFTP ;DAOU/ALA-FTP AR Data Extract Batch Files ;08-SEP-03
"RTN","RCXVFTP",2,0)
 ;;4.5;Accounts Receivable;**201,256**;Mar 20, 1995;Build 6
"RTN","RCXVFTP",3,0)
 ;
"RTN","RCXVFTP",4,0)
 ;**Program Description**
"RTN","RCXVFTP",5,0)
 ;  This code will ftp a batch file
"RTN","RCXVFTP",6,0)
 ;
"RTN","RCXVFTP",7,0)
EN(FILE,DIREC) ;
"RTN","RCXVFTP",8,0)
 ;  Input Parameter
"RTN","RCXVFTP",9,0)
 ;    FILE = Filename
"RTN","RCXVFTP",10,0)
 ;    DIREC = Directory
"RTN","RCXVFTP",11,0)
 S RCXVPTH=$S($G(DIREC)'="":DIREC,1:RCXVDIR)
"RTN","RCXVFTP",12,0)
 ;
"RTN","RCXVFTP",13,0)
SYS ;  Get system type
"RTN","RCXVFTP",14,0)
 S RCXVSYS=$$VERSION^%ZOSV(1)
"RTN","RCXVFTP",15,0)
 I RCXVSYS["DSM" S RCXVSYS="VMS",RCXVSYT="DSM"
"RTN","RCXVFTP",16,0)
 I RCXVSYS["MSM" D
"RTN","RCXVFTP",17,0)
 . I RCXVSYS["NT"!(RCXVSYS["PC") S RCXVSYS="MSM",RCXVSYT="MSM" Q
"RTN","RCXVFTP",18,0)
 . E  S RCXVSYS="UNIX",RCXVSYT="MSM"
"RTN","RCXVFTP",19,0)
 I RCXVSYS["Cache" D
"RTN","RCXVFTP",20,0)
 . I RCXVSYS["VMS" S RCXVSYS="VMS",RCXVSYT="CACHE" Q
"RTN","RCXVFTP",21,0)
 . S RCXVSYS="CACHE",RCXVSYT="CACHE"
"RTN","RCXVFTP",22,0)
 ;
"RTN","RCXVFTP",23,0)
 I RCXVSYS="VMS" S RCXVNME=FILE_";1"
"RTN","RCXVFTP",24,0)
 I RCXVSYS'="VMS" S RCXVNME=FILE
"RTN","RCXVFTP",25,0)
 ;
"RTN","RCXVFTP",26,0)
ARC ;  Directly FTP to the Boston Allocation Resource Center
"RTN","RCXVFTP",27,0)
 I $$GET1^DIQ(342,"1,",20.06,"I")="P" D
"RTN","RCXVFTP",28,0)
 . S RCXVIP="MORPHEUS.ARC.MED.VA.GOV"
"RTN","RCXVFTP",29,0)
 . S RCXVUSR="mccf"
"RTN","RCXVFTP",30,0)
 . S RCXVPAS="1qaz2wsx"
"RTN","RCXVFTP",31,0)
 ;
"RTN","RCXVFTP",32,0)
 I $$GET1^DIQ(342,"1,",20.06,"I")'="P" D
"RTN","RCXVFTP",33,0)
 . S RCXVIP="MORPHEUS.ARC.MED.VA.GOV"
"RTN","RCXVFTP",34,0)
 . S RCXVUSR="cbotest1"
"RTN","RCXVFTP",35,0)
 . S RCXVPAS="1qaz2wsx"
"RTN","RCXVFTP",36,0)
 ;
"RTN","RCXVFTP",37,0)
 I RCXVSYS="VMS" D ^RCXVFTV
"RTN","RCXVFTP",38,0)
 I RCXVSYS'="VMS" D ^RCXVFTC
"RTN","RCXVFTP",39,0)
 ;
"RTN","RCXVFTP",40,0)
 S RCXVARRY(RCXVTXT)="",RCXVARRY(RCXVBAT)="",RCXVARRY(RCXVNME)=""
"RTN","RCXVFTP",41,0)
 S Y=$$DEL^%ZISH(RCXVPTH,$NA(RCXVARRY))
"RTN","RCXVFTP",42,0)
 K RCXVARRY,%ZISHF,%ZISHO,%ZISUB,DIREC,FILE,I,RCXCT,RCXI,RCXOKAY,RCXVBAT
"RTN","RCXVFTP",43,0)
 K RCXVFTP,RCXVHNDL,RCXVIP,RCXVNME,RCXVOUT,RCXVPAS,RCXVPTH,RCXVSCR,XMY
"RTN","RCXVFTP",44,0)
 K RCXVSYS,RCXVSYT,RCXVTXT,RCXVUSR,RCXVVMS,CNT,QER,QFL,RCXMGRP,XMSUB
"RTN","RCXVFTP",45,0)
 K VALMSG,RCXVROOT
"RTN","RCXVFTP",46,0)
 Q
"RTN","RCXVFTP",47,0)
 ;
"RTN","RCXVFTP",48,0)
FCK ;  Check that file is ready to read
"RTN","RCXVFTP",49,0)
 S QFL=0,CNT=0,QER=0
"RTN","RCXVFTP",50,0)
FQT I QFL Q
"RTN","RCXVFTP",51,0)
 D OPEN^%ZISH(RCXVHNDL,RCXVPTH,RCXVSCR,"R")
"RTN","RCXVFTP",52,0)
 I POP D  G FQT
"RTN","RCXVFTP",53,0)
 . HANG 5
"RTN","RCXVFTP",54,0)
 . S CNT=CNT+1
"RTN","RCXVFTP",55,0)
 . I CNT>10 S QFL=1,QER=1 D CLOSE^%ZISH(RCXVHNDL)
"RTN","RCXVFTP",56,0)
 S QFL=1 D CLOSE^%ZISH(RCXVHNDL)
"RTN","RCXVFTP",57,0)
 G FQT
"RTN","RCXVFTP",58,0)
 ;
"VER")
8.0^22.0
"BLD",7491,6)
^228
**END**
**END**
