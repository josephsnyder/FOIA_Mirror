Released PRCA*4.5*260 SEQ #262
Extracted from mail message
**KIDS**:PRCA*4.5*260^

**INSTALL NAME**
PRCA*4.5*260
"BLD",8070,0)
PRCA*4.5*260^ACCOUNTS RECEIVABLE^0^3090707^y
"BLD",8070,1,0)
^^6^6^3090707^^^^
"BLD",8070,1,1,0)
This patch will add "THANK YOU FOR YOUR PAYMENT" to the bottom of the 
"BLD",8070,1,2,0)
payment receipt.
"BLD",8070,1,3,0)
 
"BLD",8070,1,4,0)
The second item this patch will fix is replacing special characters in 
"BLD",8070,1,5,0)
the transaction description of the PD segment that caused the CCPC 
"BLD",8070,1,6,0)
transmission rejected by AAC.
"BLD",8070,4,0)
^9.64PA^^
"BLD",8070,6.3)
2
"BLD",8070,"ABPKG")
n
"BLD",8070,"KRN",0)
^9.67PA^779.2^20
"BLD",8070,"KRN",.4,0)
.4
"BLD",8070,"KRN",.401,0)
.401
"BLD",8070,"KRN",.402,0)
.402
"BLD",8070,"KRN",.403,0)
.403
"BLD",8070,"KRN",.5,0)
.5
"BLD",8070,"KRN",.84,0)
.84
"BLD",8070,"KRN",3.6,0)
3.6
"BLD",8070,"KRN",3.8,0)
3.8
"BLD",8070,"KRN",9.2,0)
9.2
"BLD",8070,"KRN",9.8,0)
9.8
"BLD",8070,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",8070,"KRN",9.8,"NM",1,0)
RCDPRECT^^0^B18968174
"BLD",8070,"KRN",9.8,"NM",2,0)
RCCPCML^^0^B47881024
"BLD",8070,"KRN",9.8,"NM","B","RCCPCML",2)

"BLD",8070,"KRN",9.8,"NM","B","RCDPRECT",1)

"BLD",8070,"KRN",19,0)
19
"BLD",8070,"KRN",19.1,0)
19.1
"BLD",8070,"KRN",101,0)
101
"BLD",8070,"KRN",409.61,0)
409.61
"BLD",8070,"KRN",771,0)
771
"BLD",8070,"KRN",779.2,0)
779.2
"BLD",8070,"KRN",870,0)
870
"BLD",8070,"KRN",8989.51,0)
8989.51
"BLD",8070,"KRN",8989.52,0)
8989.52
"BLD",8070,"KRN",8994,0)
8994
"BLD",8070,"KRN","B",.4,.4)

"BLD",8070,"KRN","B",.401,.401)

"BLD",8070,"KRN","B",.402,.402)

"BLD",8070,"KRN","B",.403,.403)

"BLD",8070,"KRN","B",.5,.5)

"BLD",8070,"KRN","B",.84,.84)

"BLD",8070,"KRN","B",3.6,3.6)

"BLD",8070,"KRN","B",3.8,3.8)

"BLD",8070,"KRN","B",9.2,9.2)

"BLD",8070,"KRN","B",9.8,9.8)

"BLD",8070,"KRN","B",19,19)

"BLD",8070,"KRN","B",19.1,19.1)

"BLD",8070,"KRN","B",101,101)

"BLD",8070,"KRN","B",409.61,409.61)

"BLD",8070,"KRN","B",771,771)

"BLD",8070,"KRN","B",779.2,779.2)

"BLD",8070,"KRN","B",870,870)

"BLD",8070,"KRN","B",8989.51,8989.51)

"BLD",8070,"KRN","B",8989.52,8989.52)

"BLD",8070,"KRN","B",8994,8994)

"BLD",8070,"QDEF")
^^^^NO^^^^NO^^YES
"BLD",8070,"QUES",0)
^9.62^^
"BLD",8070,"REQB",0)
^9.611^2^2
"BLD",8070,"REQB",1,0)
PRCA*4.5*223^1
"BLD",8070,"REQB",2,0)
PRCA*4.5*244^1
"BLD",8070,"REQB","B","PRCA*4.5*223",1)

"BLD",8070,"REQB","B","PRCA*4.5*244",2)

"MBREQ")
0
"PKG",142,-1)
1^1
"PKG",142,0)
ACCOUNTS RECEIVABLE^PRCA^BILL COLLECTIONS
"PKG",142,20,0)
^9.402P^1^1
"PKG",142,20,1,0)
2^^PRCAMRG
"PKG",142,20,1,1)

"PKG",142,20,"B",2,1)

"PKG",142,22,0)
^9.49I^1^1
"PKG",142,22,1,0)
4.5^^2950320
"PKG",142,22,1,"PAH",1,0)
260^3090707
"PKG",142,22,1,"PAH",1,1,0)
^^6^6^3090707
"PKG",142,22,1,"PAH",1,1,1,0)
This patch will add "THANK YOU FOR YOUR PAYMENT" to the bottom of the 
"PKG",142,22,1,"PAH",1,1,2,0)
payment receipt.
"PKG",142,22,1,"PAH",1,1,3,0)
 
"PKG",142,22,1,"PAH",1,1,4,0)
The second item this patch will fix is replacing special characters in 
"PKG",142,22,1,"PAH",1,1,5,0)
the transaction description of the PD segment that caused the CCPC 
"PKG",142,22,1,"PAH",1,1,6,0)
transmission rejected by AAC.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","RCCPCML")
0^2^B47881024^B45438721
"RTN","RCCPCML",1,0)
RCCPCML ;WASH-ISC@ALTOONA,PA/LDB-Send CCPC transmission ;12/19/96  4:16 PM
"RTN","RCCPCML",2,0)
V ;;4.5;Accounts Receivable;**34,80,93,118,133,140,160,165,187,195,206,223,260**;Mar 20, 1995;Build 2
"RTN","RCCPCML",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCCPCML",4,0)
TRAN ;called from RCCPC TRANSMIT option to interactively allow transmission of CCPC mesages
"RTN","RCCPCML",5,0)
 N %DT,DTOUT,SDT,X,Y,ZTRTN,ZTSAVE,ZTDESC,ZTIO
"RTN","RCCPCML",6,0)
 I '$D(^XUSEC("RCCPC TRANSMIT",DUZ)) W *7,*7,!,"You do not have access to do this." Q
"RTN","RCCPCML",7,0)
 S %DT="AEXP"
"RTN","RCCPCML",8,0)
 S %DT("A")="Enter statement date as it will appear on these statements: "
"RTN","RCCPCML",9,0)
 S SDT=$O(^RCPS(349.2,0)) I 'SDT W !,"You need to build the CCPC file." Q
"RTN","RCCPCML",10,0)
 S SDT=$P($P($G(^RCPS(349.2,SDT,0)),"^",10),".") I 'SDT W !,"Your CCPC statement file (349.2) is corrupted. Please rebuild it." Q
"RTN","RCCPCML",11,0)
 S SDT=$E(SDT,1,5)_$$STDY^RCCPCFN
"RTN","RCCPCML",12,0)
 S %DT("B")=$$FMTE^XLFDT(SDT)
"RTN","RCCPCML",13,0)
 D ^%DT Q:(X="^")!($D(DTOUT))!(Y=-1)
"RTN","RCCPCML",14,0)
 S SDT=$E(Y,1,5)_$$STDY^RCCPCFN,SDT=$$STDT^RCCPCFN(SDT)
"RTN","RCCPCML",15,0)
 S ZTSAVE("SDT")="",ZTRTN="RETRAN^RCCPCML",ZTIO="",ZTDESC="Re-transmit CCPC patient statements -user activated"
"RTN","RCCPCML",16,0)
 D ^%ZTLOAD
"RTN","RCCPCML",17,0)
 Q
"RTN","RCCPCML",18,0)
 ;
"RTN","RCCPCML",19,0)
EN ;called from background job
"RTN","RCCPCML",20,0)
 N DA,DIK,LPRINT
"RTN","RCCPCML",21,0)
 S SDT=$$STDT^RCCPCFN("")
"RTN","RCCPCML",22,0)
RETRAN N DA,DIK,ERROR,RCT,X
"RTN","RCCPCML",23,0)
 S (ERROR,X)=0 F  S X=$O(^RCPS(349.2,X)) Q:'X  I $G(^(X,6)) S ERROR=1,NM=0 D ERROR Q
"RTN","RCCPCML",24,0)
 I $G(ERROR) D EXIT Q
"RTN","RCCPCML",25,0)
 K ^TMP($J)
"RTN","RCCPCML",26,0)
 S X=0 F  S X=$O(^RCT(349,"B",X)) Q:X=""  I $P(X,".")="PS" S DA=$O(^RCT(349,"B",X,0)),DIK="^RCT(349," D ^DIK
"RTN","RCCPCML",27,0)
 F X="PA","IS","IT" S RCT=$O(^RCT(349.1,"B",X,0)) I RCT K ^RCT(349.1,+RCT,4)
"RTN","RCCPCML",28,0)
 N %,ADD,AMT,ERROR,L,LN,M,MSG,MCT,MPT1,MTOT,NM,P,PD,PD0,PSN,PT,PT0,PHCT,RCM,RTY,TAMT,TMSG,SZ,TRDESC
"RTN","RCCPCML",29,0)
 D DT^DICRW
"RTN","RCCPCML",30,0)
 S (ERROR,RTY)=0
"RTN","RCCPCML",31,0)
 S X=$O(^RCT(349.1,"B","PS",0))
"RTN","RCCPCML",32,0)
 I X,$P($G(^RCT(349.1,+X,0)),"^",3) S X=$P($G(^RCT(349.1,+X,3)),"^",3)
"RTN","RCCPCML",33,0)
 I X']"" S ERROR=6,NM=0 D ERROR,EXIT Q
"RTN","RCCPCML",34,0)
 D PHCT I 'PHCT S ERROR=1,NM=0 D ERROR,EXIT Q
"RTN","RCCPCML",35,0)
 S MTOT=$O(^TMP($J,"MCT",""),-1)
"RTN","RCCPCML",36,0)
 S MCT=0 F  S MCT=$O(^TMP($J,"MCT",MCT)) Q:'MCT  D PS
"RTN","RCCPCML",37,0)
EXIT D ERRML^RCCPCML1
"RTN","RCCPCML",38,0)
 K SDT,^TMP($J)
"RTN","RCCPCML",39,0)
 Q
"RTN","RCCPCML",40,0)
 ;
"RTN","RCCPCML",41,0)
F349 ;Get PS segment entry
"RTN","RCCPCML",42,0)
 N DA,D0,DIC,DLAYGO,X
"RTN","RCCPCML",43,0)
 S ERROR=0 K DD,DO S DIC="^RCT(349,",DIC(0)="L",DLAYGO=349,X="PS."_$TR($$FMTE^XLFDT(DT,"2D"),"/",".")_"."_RCM D FILE^DICN
"RTN","RCCPCML",44,0)
 I Y<0 S RTY=RTY+1 G F349:RTY<4 S ERROR=2,NM=0 D ERROR Q
"RTN","RCCPCML",45,0)
 S PSN=+Y
"RTN","RCCPCML",46,0)
 Q
"RTN","RCCPCML",47,0)
 ;
"RTN","RCCPCML",48,0)
PS ;Build PS,PH,PD segments and messages
"RTN","RCCPCML",49,0)
 S PSN=$O(^TMP($J,"MCT",MCT,0))
"RTN","RCCPCML",50,0)
 S $P(^RCT(349,+PSN,0),"^",3,10)=MCT_"^"_MTOT_"^"_$$SITE^RCMSITE()_"^"_$$FP^RCCPCFN_"^"_+^TMP($J,"MCT",MCT)_"^"_$P(^TMP($J,"MCT",MCT),"^",2)_"^"_SDT_"^"_$$STM^RCCPCFN
"RTN","RCCPCML",51,0)
 S LN=+PSN,^TMP($J,"MSG",LN)=$P($G(^RCT(349,+PSN,0)),"^",2,10)_"^|"
"RTN","RCCPCML",52,0)
 S MPT1=$P(^TMP($J,"MCT",MCT),"^",3)
"RTN","RCCPCML",53,0)
 S PT=$S(MCT=1:0,1:$P(^TMP($J,"MCT",MCT-1),"^",3))
"RTN","RCCPCML",54,0)
 F  S PT=$O(^RCPS(349.2,PT)) Q:PT=$O(^RCPS(349.2,+($P(^TMP($J,"MCT",MCT),"^",3))))  D
"RTN","RCCPCML",55,0)
 .Q:$D(^TMP($J,"ERRPT",+PT))
"RTN","RCCPCML",56,0)
 .S PT0=^RCPS(349.2,+PT,0)
"RTN","RCCPCML",57,0)
 .S LN=LN+1 S ^TMP($J,"MSG",LN)="PH^"_$$SITE^RCMSITE_$$KEY^RCCPCFN(+PT)_"^"_$$NM^RCCPCFN(+PT)_"^"
"RTN","RCCPCML",58,0)
 .S ADD=$G(^RCPS(349.2,+PT,1))
"RTN","RCCPCML",59,0)
 .;
"RTN","RCCPCML",60,0)
 .;Remove special characters causing problems (WIM-0402-20728)
"RTN","RCCPCML",61,0)
 .I ADD["~" S ADD=$TR(ADD,"~","") ;Remove tilde
"RTN","RCCPCML",62,0)
 .I ADD["|" S ADD=$TR(ADD,"|","") ;Remove the pipe symbol
"RTN","RCCPCML",63,0)
 .;
"RTN","RCCPCML",64,0)
 .;Debtor needs large print (font) IF LPRINT=1
"RTN","RCCPCML",65,0)
 .S LPRINT=$G(^RCPS(349.2,+PT,7)) S:LPRINT="" LPRINT=0
"RTN","RCCPCML",66,0)
 .;
"RTN","RCCPCML",67,0)
 .F P=1:1:7 S $P(^TMP($J,"MSG",LN),"^",P+5)=$S($P(ADD,"^",P)]"":$P(ADD,"^",P),1:"")
"RTN","RCCPCML",68,0)
 .S ^TMP($J,"MSG",LN)=^TMP($J,"MSG",LN)_"^"
"RTN","RCCPCML",69,0)
 .S LN=LN+1
"RTN","RCCPCML",70,0)
 .F X=4:1:8 S $P(AMT,"^",X-3)=$$HEX^RCCPCFN($P(PT0,"^",X))
"RTN","RCCPCML",71,0)
 .;S ^TMP($J,"MSG",LN)=AMT_"^"_$G(^RCPS(349.2,+PT,3))_"^"_$G(^RCPS(349.2,+PT,4))_"^"_$P(^RCPS(349.2,+PT,2,0),"^",4)_"^|"
"RTN","RCCPCML",72,0)
 .S ^TMP($J,"MSG",LN)=AMT_"^"_$G(^RCPS(349.2,+PT,3))_"^"_$G(^RCPS(349.2,+PT,4))_"^"_$O(^RCPS(349.2,+PT,2,""),-1)
"RTN","RCCPCML",73,0)
 .S LN=LN+1 I $P($G(^RCD(340,+PT,0)),";") S ^TMP($J,"MSG",LN)="^"_$$SITE^RCMSITE_$$RJ^XLFSTR($TR($P(^RCD(340,+PT,0),";"),".",""),13,0)
"RTN","RCCPCML",74,0)
 .S ^TMP($J,"MSG",LN)=$G(^TMP($J,"MSG",LN))_"^"_LPRINT_"^|"
"RTN","RCCPCML",75,0)
 .S $P(^RCPS(349.2,+PT,0),"^",11)=+PSN
"RTN","RCCPCML",76,0)
 .S PD=0 F  S PD=$O(^RCPS(349.2,+PT,2,PD)) Q:'PD  I $D(^(PD,0)) S PD0=^(0) D
"RTN","RCCPCML",77,0)
 ..S AMT(0)=$$HEX^RCCPCFN($P(PD0,"^",3))
"RTN","RCCPCML",78,0)
 ..;Replace special characters causing problem (PRCA*260)
"RTN","RCCPCML",79,0)
 ..S TRDESC=$P(PD0,"^",2)
"RTN","RCCPCML",80,0)
 ..I TRDESC["~" S TRDESC=$TR(TRDESC,"~"," ")  ;Replace tilde
"RTN","RCCPCML",81,0)
 ..I TRDESC["|" S TRDESC=$TR(TRDESC,"|"," ")  ;Replace the pipe symbol
"RTN","RCCPCML",82,0)
 ..S LN=LN+1,^TMP($J,"MSG",LN)="PD^"_$$DAT^RCCPCFN(+PD0)_"^"_TRDESC_"^"_AMT(0)_"^"_$P(PD0,"^",4)_"^|"
"RTN","RCCPCML",83,0)
 S LN=LN+1,^TMP($J,"MSG",LN)="~"
"RTN","RCCPCML",84,0)
 ;
"RTN","RCCPCML",85,0)
MAIL ;set up mail message
"RTN","RCCPCML",86,0)
 N L,XMDUZ,XMSUB,XMY,XMZ,Z
"RTN","RCCPCML",87,0)
 S XMSUB=$$SITE^RCMSITE()_" CCPC TRANSMISSION "_SDT
"RTN","RCCPCML",88,0)
 S XMDUZ="AR PACKAGE"
"RTN","RCCPCML",89,0)
 I $O(^XMB(3.8,"B","RCCPC STATEMENTS","")),$P($G(^RC(342,1,0)),"^",12) S XMY("G.RCCPC STATEMENTS")=""
"RTN","RCCPCML",90,0)
 S X=$O(^RCT(349.1,"B","PS",0))
"RTN","RCCPCML",91,0)
 I X,$P($G(^RCT(349.1,+X,0)),"^",3) S X=$P($G(^RCT(349.1,+X,3)),"^")_"@"_$P($G(^RCT(349.1,+X,3)),"^",3) S:$P(X,"@",2)]"" XMY(X)=""
"RTN","RCCPCML",92,0)
 I $P(X,"@",2)']"" D  Q
"RTN","RCCPCML",93,0)
 .S ERROR=6,NM=0 D ERROR
"RTN","RCCPCML",94,0)
 S XMDUZ="AR PACKAGE"
"RTN","RCCPCML",95,0)
 D XMZ^XMA2
"RTN","RCCPCML",96,0)
 I XMZ<1 S RTY=RTY+1 G MAIL:RTY<4 S ERROR=5,NM=0 D ERROR Q
"RTN","RCCPCML",97,0)
 S $P(^RCT(349,+PSN,0),"^",11,12)=DT_"^"_XMZ
"RTN","RCCPCML",98,0)
 S (L,L(1))=0 F  S L(1)=$O(^TMP($J,"MSG",L(1))) Q:'L(1)  S L=L+1,^XMB(3.9,+XMZ,2,L,0)=^TMP($J,"MSG",L(1))
"RTN","RCCPCML",99,0)
 ;S L=$O(^TMP($J,"MSG",""),-1)
"RTN","RCCPCML",100,0)
 S ^XMB(3.9,XMZ,2,0)="^3.92A^"_L_"^"_L_"^"_DT
"RTN","RCCPCML",101,0)
 D ENT1^XMD
"RTN","RCCPCML",102,0)
 D NOW^%DTC
"RTN","RCCPCML",103,0)
 S $P(^RCT(349,+PSN,0),"^",11,12)=%_"^"_XMZ
"RTN","RCCPCML",104,0)
 K ^TMP($J,"MSG")
"RTN","RCCPCML",105,0)
 ;D KILL^XM
"RTN","RCCPCML",106,0)
 Q
"RTN","RCCPCML",107,0)
 ;
"RTN","RCCPCML",108,0)
PHCT ;PH count
"RTN","RCCPCML",109,0)
 S (ERROR,PT,PHCT,TAMT,SZ)=0,RCM=1
"RTN","RCCPCML",110,0)
 F  S PT=$O(^RCPS(349.2,PT)) Q:'PT  S ERROR=0 D  I ERROR,(ERROR<3) Q
"RTN","RCCPCML",111,0)
 .S SZ(1)=0 D ERRCHK Q:ERROR
"RTN","RCCPCML",112,0)
 .S PT0=^RCPS(349.2,+PT,0)
"RTN","RCCPCML",113,0)
 .S PHCT=PHCT+1
"RTN","RCCPCML",114,0)
 .S SZ=550+SZ,SZ(1)=550
"RTN","RCCPCML",115,0)
 .S:$G(^RCPS(349.2,+PT,1))]"" SZ=SZ+$L(^(1)),SZ(1)=SZ(1)+$L(^(1))
"RTN","RCCPCML",116,0)
 .S:$G(^RCPS(349.2,+PT,3))]"" SZ=SZ+$L(^(3))+1,SZ(1)=SZ(1)+$L(^(3))+1
"RTN","RCCPCML",117,0)
 .S:$G(^RCPS(349.2,+PT,4))]"" SZ=SZ+$L(^(4))+1,SZ(1)=SZ(1)+$L(^(4))+1
"RTN","RCCPCML",118,0)
 .S X=0 F  S X=$O(^RCPS(349.2,+PT,2,X)) Q:'X  I $D(^(X,0)) S SZ=$L(^(0))+SZ,SZ(1)=SZ(1)+$L(^(0))
"RTN","RCCPCML",119,0)
 .S TAMT=TAMT+$P(^RCPS(349.2,+PT,0),"^",8)
"RTN","RCCPCML",120,0)
 .I SZ>27000 D
"RTN","RCCPCML",121,0)
 ..S RTY=0 D F349 Q:ERROR
"RTN","RCCPCML",122,0)
 ..S TAMT=TAMT-$P(PT0,"^",8)
"RTN","RCCPCML",123,0)
 ..S TAMT=$$HEX^RCCPCFN(TAMT)
"RTN","RCCPCML",124,0)
 ..S ^TMP($J,"MCT",RCM)=(PHCT-1)_"^"_TAMT_"^"_$O(^RCPS(349.2,PT),-1)_"^"_(SZ-SZ(1))
"RTN","RCCPCML",125,0)
 ..S ^TMP($J,"MCT",RCM,+PSN)=""
"RTN","RCCPCML",126,0)
 ..S RCM=RCM+1,PHCT=1
"RTN","RCCPCML",127,0)
 ..S SZ=SZ(1)
"RTN","RCCPCML",128,0)
 ..S TAMT=$P(PT0,"^",8)
"RTN","RCCPCML",129,0)
 I 'PT,$O(^RCPS(349.2,0)) D
"RTN","RCCPCML",130,0)
 .S RTY=0 D F349 Q:ERROR  S ^TMP($J,"MCT",RCM)=PHCT_"^"_$$HEX^RCCPCFN(TAMT)_"^"_$O(^RCPS(349.2,PT),-1)
"RTN","RCCPCML",131,0)
 .S ^TMP($J,"MCT",RCM,+PSN)=""
"RTN","RCCPCML",132,0)
 Q
"RTN","RCCPCML",133,0)
 ;
"RTN","RCCPCML",134,0)
ERROR ;ERROR FILE
"RTN","RCCPCML",135,0)
 I NM=0 S ^TMP($J,"ERROR",ERROR,NM)="" Q
"RTN","RCCPCML",136,0)
 S ^TMP($J,"ERROR",ERROR,NM,$$SSN^RCFN01(+PT))=""
"RTN","RCCPCML",137,0)
 Q
"RTN","RCCPCML",138,0)
 ;
"RTN","RCCPCML",139,0)
ERRCHK ;Error check
"RTN","RCCPCML",140,0)
 I '$D(^RCPS(349.2,+PT,0)) S ERROR=1,NM=0 D ERROR Q
"RTN","RCCPCML",141,0)
 S PT(1)=PT,PT=$O(^RCPS(349.2,0)) I '$P(^RCPS(349.2,PT,0),"^",18) S ERROR=1,NM=0 D ERROR S PT=PT(1) Q
"RTN","RCCPCML",142,0)
 S PT=PT(1)
"RTN","RCCPCML",143,0)
 I $$KEY^RCCPCFN(+PT)']"" S ERROR=4,NM=$$NAM^RCFN01(+PT) D ERROR S ^TMP($J,"ERRPT",+PT)="" Q
"RTN","RCCPCML",144,0)
 I '$D(^RCPS(349.2,"AKEY",$$KEY^RCCPCFN(+PT))) S ERROR=4,NM=$$NAM^RCFN01(+PT) D ERROR S ^TMP($J,"ERRPT",+PT)="" Q
"RTN","RCCPCML",145,0)
 S ADD=$G(^RCPS(349.2,+PT,1))
"RTN","RCCPCML",146,0)
 F P=1:1:7 S ADD(P)=$S($P(ADD,"^",P)]"":$P(ADD,"^",P),1:"")
"RTN","RCCPCML",147,0)
 I ADD(1)="",ADD(2)="",ADD(3)="",ADD(4)="",ADD(5)="",ADD(6)="" S ERROR=8,NM=$$NAM^RCFN01(+PT) D ERROR S ^TMP($J,"ERRPT",+PT)="" Q
"RTN","RCCPCML",148,0)
 I ADD(1)="",(ADD(2)=""),(ADD(3)=""),(ADD(6)="") S ERROR=8,NM=$$NAM^RCFN01(+PT) D ERROR S ^TMP($J,"ERRPT",+PT)="" Q
"RTN","RCCPCML",149,0)
 I ADD(4)=""!(ADD(5)="")!(ADD(6)="") S ERROR=8,NM=$$NAM^RCFN01(+PT) D ERROR S ^TMP($J,"ERRPT",+PT)=""
"RTN","RCCPCML",150,0)
 F ADD=1:1:6 I ADD(ADD)'?.ANP S ERROR=10,NM=$$NAM^RCFN01(+PT),^TMP($J,"ERRPT",+PT)="" D ERROR Q
"RTN","RCCPCML",151,0)
 I $P($G(^RCD(340,+PT,1)),"^",9) S ^TMP($J,"ERRPT",+PT)="",ERROR=9,NM=$$NAM^RCFN01(+PT) D ERROR
"RTN","RCCPCML",152,0)
 Q
"RTN","RCDPRECT")
0^1^B18968174^B18445207
"RTN","RCDPRECT",1,0)
RCDPRECT ;WISC/RFJ-print a receipt ;1 Jun 99
"RTN","RCDPRECT",2,0)
 ;;4.5;Accounts Receivable;**114,148,217,244,260**;Mar 20, 1995;Build 2
"RTN","RCDPRECT",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPRECT",4,0)
 Q
"RTN","RCDPRECT",5,0)
 ;
"RTN","RCDPRECT",6,0)
 ;
"RTN","RCDPRECT",7,0)
RECEIPT(RCRECTDA,RCTRANDA) ;  control printing of receipt for device selection
"RTN","RCDPRECT",8,0)
 N %,IOP,PRINT
"RTN","RCDPRECT",9,0)
 S PRINT=$$OPTCK^RCDPRPL2("RECEIPT",2)_"^"_$$OPTCK^RCDPRPL2("RECEIPT",3)
"RTN","RCDPRECT",10,0)
 ;  if not defined by user, ask for the device
"RTN","RCDPRECT",11,0)
 I PRINT="" S PRINT=2
"RTN","RCDPRECT",12,0)
 ;
"RTN","RCDPRECT",13,0)
 ;  never print receipt
"RTN","RCDPRECT",14,0)
 I $P(PRINT,"^")=0 Q
"RTN","RCDPRECT",15,0)
 ;
"RTN","RCDPRECT",16,0)
 ;  always print receipt to default device
"RTN","RCDPRECT",17,0)
 I $P(PRINT,"^")=1 D
"RTN","RCDPRECT",18,0)
 .   ;  test device without opening it
"RTN","RCDPRECT",19,0)
 .   S IOP=$P(PRINT,"^",2) I IOP="" S PRINT=2 Q
"RTN","RCDPRECT",20,0)
 .   S %ZIS="N"
"RTN","RCDPRECT",21,0)
 .   D ^%ZIS I POP S PRINT=2 Q
"RTN","RCDPRECT",22,0)
 .   D QUEUEIT
"RTN","RCDPRECT",23,0)
 ;
"RTN","RCDPRECT",24,0)
 ;  ask to print receipt
"RTN","RCDPRECT",25,0)
 I $P(PRINT,"^")=2 S %=$$DEVICE
"RTN","RCDPRECT",26,0)
 Q
"RTN","RCDPRECT",27,0)
 ;
"RTN","RCDPRECT",28,0)
 ;
"RTN","RCDPRECT",29,0)
DEVICE() ;  select the device and print receipt
"RTN","RCDPRECT",30,0)
 ;  returns 0 if not successful
"RTN","RCDPRECT",31,0)
 S %ZIS("A")="Print Receipt on DEVICE: "
"RTN","RCDPRECT",32,0)
 S %ZIS("B")=$$OPTCK^RCDPRPL2("RECEIPT",3)
"RTN","RCDPRECT",33,0)
 S %ZIS="Q"
"RTN","RCDPRECT",34,0)
 W ! D ^%ZIS
"RTN","RCDPRECT",35,0)
 I POP D ^%ZISC Q 0
"RTN","RCDPRECT",36,0)
 I $D(IO("Q")) D QUEUEIT Q "Print Receipt Queued"
"RTN","RCDPRECT",37,0)
 D PRINT
"RTN","RCDPRECT",38,0)
 Q "Receipt Printed"
"RTN","RCDPRECT",39,0)
 ;
"RTN","RCDPRECT",40,0)
 ;
"RTN","RCDPRECT",41,0)
QUEUEIT ;  queue printing receipt
"RTN","RCDPRECT",42,0)
 N ZTSK
"RTN","RCDPRECT",43,0)
 S ZTDTH=$H,ZTDESC="Print Payment Receipt",ZTRTN="PRINT^RCDPRECT"
"RTN","RCDPRECT",44,0)
 S ZTSAVE("RCRECTDA")="",ZTSAVE("RCTRANDA")="",ZTSAVE("ZTREQ")="@"
"RTN","RCDPRECT",45,0)
 D ^%ZTLOAD
"RTN","RCDPRECT",46,0)
 D ^%ZISC
"RTN","RCDPRECT",47,0)
 Q
"RTN","RCDPRECT",48,0)
 ;
"RTN","RCDPRECT",49,0)
 ;
"RTN","RCDPRECT",50,0)
PRINT ;  print a receipt
"RTN","RCDPRECT",51,0)
 ;  requires variables rcrectda and rctranda
"RTN","RCDPRECT",52,0)
 N %,%H,%I,ADDRESS,DATA,LINE,RCTYPE,X,Y,MSG
"RTN","RCDPRECT",53,0)
 U IO
"RTN","RCDPRECT",54,0)
 ;
"RTN","RCDPRECT",55,0)
 ;  print address for station at top
"RTN","RCDPRECT",56,0)
 S ADDRESS=$$SADD^RCFN01(1)
"RTN","RCDPRECT",57,0)
 W !?25,"Department Of Veterans Affairs"
"RTN","RCDPRECT",58,0)
 F %=1,2,3 I $P(ADDRESS,"^",%)'="" W !?((80-$L($P(ADDRESS,"^",%)))/2),$P(ADDRESS,"^",%)
"RTN","RCDPRECT",59,0)
 S ADDRESS=$P(ADDRESS,"^",4)_", "_$P(ADDRESS,"^",5)_"  "_$P(ADDRESS,"^",6)
"RTN","RCDPRECT",60,0)
 I $TR(ADDRESS,", ")'="" W !?((80-$L(ADDRESS))/2),ADDRESS
"RTN","RCDPRECT",61,0)
 ;
"RTN","RCDPRECT",62,0)
 S LINE="",$P(LINE,"-",80)=""
"RTN","RCDPRECT",63,0)
 W !,LINE
"RTN","RCDPRECT",64,0)
 ;
"RTN","RCDPRECT",65,0)
 S %="*** Payment Receipt ***"
"RTN","RCDPRECT",66,0)
 W !!?((80-$L(%))/2),%
"RTN","RCDPRECT",67,0)
 ;
"RTN","RCDPRECT",68,0)
 ;  account and name
"RTN","RCDPRECT",69,0)
 S DATA=$G(^RCY(344,RCRECTDA,1,RCTRANDA,0))
"RTN","RCDPRECT",70,0)
 I $P(DATA,"^",3)'="" D
"RTN","RCDPRECT",71,0)
 .   W !
"RTN","RCDPRECT",72,0)
 .   ;  account from patient file
"RTN","RCDPRECT",73,0)
 .   I $P(DATA,"^",3)[";DPT(" D  Q
"RTN","RCDPRECT",74,0)
 .   .   W $P($G(^DPT(+$P(DATA,"^",3),0)),"^")
"RTN","RCDPRECT",75,0)
 .   .   S %=$$SSN^RCFN01($P(DATA,"^",3))
"RTN","RCDPRECT",76,0)
 .   .   I $E(%,6,9)'="" W " (",$E(%,6,9),")"
"RTN","RCDPRECT",77,0)
 .   ;
"RTN","RCDPRECT",78,0)
 .   ;  account from bill file
"RTN","RCDPRECT",79,0)
 .   W $P($G(^PRCA(430,+$P(DATA,"^",3),0)),"^")
"RTN","RCDPRECT",80,0)
 .   W "  "
"RTN","RCDPRECT",81,0)
 .   W $$NAM^RCFN01($P($G(^PRCA(430,+$P(DATA,"^",3),0)),"^",9))
"RTN","RCDPRECT",82,0)
 .   S %=$$SSN^RCFN01($P($G(^PRCA(430,+$P(DATA,"^",3),0)),"^",9))
"RTN","RCDPRECT",83,0)
 .   I $E(%,6,9)'="" W " (",$E(%,6,9),")"
"RTN","RCDPRECT",84,0)
 ;
"RTN","RCDPRECT",85,0)
 W !,"     Receipt #: ",$P(^RCY(344,RCRECTDA,0),"^"),"/",$P(DATA,"^")
"RTN","RCDPRECT",86,0)
 D NOW^%DTC S Y=X D DD^%DT
"RTN","RCDPRECT",87,0)
 W ?53,"Date: ",Y
"RTN","RCDPRECT",88,0)
 W !,"  Payment Type: ",$P($G(^RC(341.1,+$P(^RCY(344,RCRECTDA,0),"^",4),0)),"^")
"RTN","RCDPRECT",89,0)
 S Y=$P(DATA,"^",6) I Y D DD^%DT
"RTN","RCDPRECT",90,0)
 W ?45,"Payment Date: ",Y
"RTN","RCDPRECT",91,0)
 ;
"RTN","RCDPRECT",92,0)
 S RCTYPE=$P($G(^RC(341.1,+$P(^RCY(344,RCRECTDA,0),"^",4),0)),"^",2)
"RTN","RCDPRECT",93,0)
 ;  type = 3 (district counsel), 4 (check), 5 (dept of justice)
"RTN","RCDPRECT",94,0)
 I RCTYPE=3!(RCTYPE=4)!(RCTYPE=5) D
"RTN","RCDPRECT",95,0)
 .   W !,"       Check #: ",$P(DATA,"^",7)
"RTN","RCDPRECT",96,0)
 .   S Y=$P(DATA,"^",10) I Y D DD^%DT
"RTN","RCDPRECT",97,0)
 .   W ?47,"Check Date: ",Y
"RTN","RCDPRECT",98,0)
 .   W !,"        Bank #: ",$P(DATA,"^",8)
"RTN","RCDPRECT",99,0)
 ;
"RTN","RCDPRECT",100,0)
 ;  type = 7 (credit card)
"RTN","RCDPRECT",101,0)
 I RCTYPE=7 D
"RTN","RCDPRECT",102,0)
 .   W !," Last 4 of Credit Card #: ",$E($P(DATA,"^",11),$L($P(DATA,"^",11))-3,$L($P(DATA,"^",11)))
"RTN","RCDPRECT",103,0)
 .   W !," Confirmation#: ",$P(DATA,"^",2)
"RTN","RCDPRECT",104,0)
 ;
"RTN","RCDPRECT",105,0)
 W !,"Payment Amount: $ ",$J($P(DATA,"^",4),0,2)
"RTN","RCDPRECT",106,0)
 W ?42,"Account Balance: $ ",$J($$BAL^PRCAFN($S($P(DATA,"^",3)[";PRCA(430":$P(^PRCA(430,+$P(DATA,"^",3),0),"^",9),1:$P(DATA,"^",3))),0,2)
"RTN","RCDPRECT",107,0)
 ;
"RTN","RCDPRECT",108,0)
 W !!,"IMPORTANT"
"RTN","RCDPRECT",109,0)
 W !!,"Note that checks or drafts are not valid until paid by your bank."
"RTN","RCDPRECT",110,0)
 W !!,"This receipt should be retained for your records."
"RTN","RCDPRECT",111,0)
 W !,"A detailed listing of how your payment has been applied to your"
"RTN","RCDPRECT",112,0)
 W !,"account will be provided on your patient statement, which you"
"RTN","RCDPRECT",113,0)
 W !,"will receive in the mail at a later date."
"RTN","RCDPRECT",114,0)
 S MSG="THANK YOU FOR YOUR PAYMENT"
"RTN","RCDPRECT",115,0)
 W !!,?((80-$L(MSG))/2),MSG
"RTN","RCDPRECT",116,0)
 W !!,LINE
"RTN","RCDPRECT",117,0)
 D ^%ZISC
"RTN","RCDPRECT",118,0)
 Q
"VER")
8.0^22.0
"BLD",8070,6)
^262
**END**
**END**
