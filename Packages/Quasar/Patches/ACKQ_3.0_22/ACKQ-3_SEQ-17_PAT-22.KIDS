Released ACKQ*3*22 SEQ #17
Extracted from mail message
**KIDS**:ACKQ*3.0*22^

**INSTALL NAME**
ACKQ*3.0*22
"BLD",9481,0)
ACKQ*3.0*22^QUASAR^0^3130904^y
"BLD",9481,1,0)
^^5^5^3130904^
"BLD",9481,1,1,0)
This patch addresses one issue:
"BLD",9481,1,2,0)
 
"BLD",9481,1,3,0)
This patch will update all direct file reads to the ICD DIAGNOSIS (#80) 
"BLD",9481,1,4,0)
file,CPT MODIFIER (#81.3) file, and the CPT FILE (#81) file in the Quasar 
"BLD",9481,1,5,0)
application to the new associated API's.
"BLD",9481,4,0)
^9.64PA^^
"BLD",9481,6.3)
5
"BLD",9481,"KRN",0)
^9.67PA^779.2^20
"BLD",9481,"KRN",.4,0)
.4
"BLD",9481,"KRN",.401,0)
.401
"BLD",9481,"KRN",.402,0)
.402
"BLD",9481,"KRN",.403,0)
.403
"BLD",9481,"KRN",.5,0)
.5
"BLD",9481,"KRN",.84,0)
.84
"BLD",9481,"KRN",3.6,0)
3.6
"BLD",9481,"KRN",3.8,0)
3.8
"BLD",9481,"KRN",9.2,0)
9.2
"BLD",9481,"KRN",9.8,0)
9.8
"BLD",9481,"KRN",9.8,"NM",0)
^9.68A^9^9
"BLD",9481,"KRN",9.8,"NM",1,0)
ACKQASU^^0^B23317920
"BLD",9481,"KRN",9.8,"NM",2,0)
ACKQASU4^^0^B47495608
"BLD",9481,"KRN",9.8,"NM",3,0)
ACKQDWLP^^0^B86446562
"BLD",9481,"KRN",9.8,"NM",4,0)
ACKQNQ^^0^B28737008
"BLD",9481,"KRN",9.8,"NM",5,0)
ACKQR2^^0^B84001886
"BLD",9481,"KRN",9.8,"NM",6,0)
ACKQR3^^0^B79522688
"BLD",9481,"KRN",9.8,"NM",7,0)
ACKQUTL4^^0^B89569144
"BLD",9481,"KRN",9.8,"NM",8,0)
ACKQUTL5^^0^B64186800
"BLD",9481,"KRN",9.8,"NM",9,0)
ACKQUTL7^^0^B27877671
"BLD",9481,"KRN",9.8,"NM","B","ACKQASU",1)

"BLD",9481,"KRN",9.8,"NM","B","ACKQASU4",2)

"BLD",9481,"KRN",9.8,"NM","B","ACKQDWLP",3)

"BLD",9481,"KRN",9.8,"NM","B","ACKQNQ",4)

"BLD",9481,"KRN",9.8,"NM","B","ACKQR2",5)

"BLD",9481,"KRN",9.8,"NM","B","ACKQR3",6)

"BLD",9481,"KRN",9.8,"NM","B","ACKQUTL4",7)

"BLD",9481,"KRN",9.8,"NM","B","ACKQUTL5",8)

"BLD",9481,"KRN",9.8,"NM","B","ACKQUTL7",9)

"BLD",9481,"KRN",19,0)
19
"BLD",9481,"KRN",19.1,0)
19.1
"BLD",9481,"KRN",101,0)
101
"BLD",9481,"KRN",409.61,0)
409.61
"BLD",9481,"KRN",771,0)
771
"BLD",9481,"KRN",779.2,0)
779.2
"BLD",9481,"KRN",870,0)
870
"BLD",9481,"KRN",8989.51,0)
8989.51
"BLD",9481,"KRN",8989.52,0)
8989.52
"BLD",9481,"KRN",8994,0)
8994
"BLD",9481,"KRN","B",.4,.4)

"BLD",9481,"KRN","B",.401,.401)

"BLD",9481,"KRN","B",.402,.402)

"BLD",9481,"KRN","B",.403,.403)

"BLD",9481,"KRN","B",.5,.5)

"BLD",9481,"KRN","B",.84,.84)

"BLD",9481,"KRN","B",3.6,3.6)

"BLD",9481,"KRN","B",3.8,3.8)

"BLD",9481,"KRN","B",9.2,9.2)

"BLD",9481,"KRN","B",9.8,9.8)

"BLD",9481,"KRN","B",19,19)

"BLD",9481,"KRN","B",19.1,19.1)

"BLD",9481,"KRN","B",101,101)

"BLD",9481,"KRN","B",409.61,409.61)

"BLD",9481,"KRN","B",771,771)

"BLD",9481,"KRN","B",779.2,779.2)

"BLD",9481,"KRN","B",870,870)

"BLD",9481,"KRN","B",8989.51,8989.51)

"BLD",9481,"KRN","B",8989.52,8989.52)

"BLD",9481,"KRN","B",8994,8994)

"BLD",9481,"QDEF")
^^^^^^^^^^YES
"BLD",9481,"QUES",0)
^9.62^^
"BLD",9481,"REQB",0)
^9.611^2^2
"BLD",9481,"REQB",1,0)
ACKQ*3.0*16^2
"BLD",9481,"REQB",2,0)
ACKQ*3.0*18^2
"BLD",9481,"REQB","B","ACKQ*3.0*16",1)

"BLD",9481,"REQB","B","ACKQ*3.0*18",2)

"MBREQ")
0
"PKG",473,-1)
1^1
"PKG",473,0)
QUASAR^ACKQ^Quality: Audiology and Speech Pathology Audit and Review
"PKG",473,20,0)
^9.402P^^
"PKG",473,22,0)
^9.49I^1^1
"PKG",473,22,1,0)
3.0^3000211^3000224^66481
"PKG",473,22,1,"PAH",1,0)
22^3130904
"PKG",473,22,1,"PAH",1,1,0)
^^5^5^3130904
"PKG",473,22,1,"PAH",1,1,1,0)
This patch addresses one issue:
"PKG",473,22,1,"PAH",1,1,2,0)
 
"PKG",473,22,1,"PAH",1,1,3,0)
This patch will update all direct file reads to the ICD DIAGNOSIS (#80) 
"PKG",473,22,1,"PAH",1,1,4,0)
file,CPT MODIFIER (#81.3) file, and the CPT FILE (#81) file in the Quasar 
"PKG",473,22,1,"PAH",1,1,5,0)
application to the new associated API's.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
9
"RTN","ACKQASU")
0^1^B23317920^B22208442
"RTN","ACKQASU",1,0)
ACKQASU ;HCIOFO/BH-New/Edit Visit Utilities  ;  04/01/99
"RTN","ACKQASU",2,0)
 ;;3.0;QUASAR;**8,15,16,22**;Feb 11, 2000;Build 5
"RTN","ACKQASU",3,0)
 ;Per VHA Directive 2004-038, this routine SHOULD NOT be modified.
"RTN","ACKQASU",4,0)
 ;
"RTN","ACKQASU",5,0)
 ;  Reference/ICR
"RTN","ACKQASU",6,0)
 ;  $$ICDDX^ICDCODE - 3990
"RTN","ACKQASU",7,0)
 ;
"RTN","ACKQASU",8,0)
 ;
"RTN","ACKQASU",9,0)
ELIGCHK() ; Checks to see if there is a Primary Eligibility (which there
"RTN","ACKQASU",10,0)
 ; always should be) if there's not (i.e. data error) pass back zero.
"RTN","ACKQASU",11,0)
 ;         
"RTN","ACKQASU",12,0)
 N ACKFLG
"RTN","ACKQASU",13,0)
 D ELIG^VADPT S:VAEL(1)="" ACKFLG="0"  S:VAEL(1)'="" ACKFLG=1
"RTN","ACKQASU",14,0)
 K VAEL
"RTN","ACKQASU",15,0)
 Q ACKFLG
"RTN","ACKQASU",16,0)
 ;
"RTN","ACKQASU",17,0)
DISP ;  Displays headings and Patient Appointments 
"RTN","ACKQASU",18,0)
 ;
"RTN","ACKQASU",19,0)
 ;  CLEAR SCREEN WRITE FROM TOP 
"RTN","ACKQASU",20,0)
 D ENS^%ZISS
"RTN","ACKQASU",21,0)
 W @IOF
"RTN","ACKQASU",22,0)
 ;  Get date for display
"RTN","ACKQASU",23,0)
 D NOW^%DTC S Y=% D DD^%DT S ACKDDT1=$TR(Y,"@"," "),ACKDDT2=X
"RTN","ACKQASU",24,0)
 S ACKSSN=$$GET1^DIQ(2,ACKPAT,".09")
"RTN","ACKQASU",25,0)
 W "                            - ",IOUON,"APPOINTMENT LIST",IOUOFF," -",!
"RTN","ACKQASU",26,0)
 W !," Name : "_$$GET1^DIQ(2,ACKPAT,".01")
"RTN","ACKQASU",27,0)
 W ?38,"SSN    : ",$E(ACKSSN,1,3)_"-"_$E(ACKSSN,4,5)_"-"_$E(ACKSSN,6,9)
"RTN","ACKQASU",28,0)
 W !," Date : "_$E(ACKDDT2,4,5)_"/"_$E(ACKDDT2,6,7)_"/"_$E(ACKDDT2,2,3)
"RTN","ACKQASU",29,0)
 W ?38,"Clinic : "_$$GET1^DIQ(44,ACKCLIN,.01)
"RTN","ACKQASU",30,0)
 W !,IOUON,"                                                                                ",IOUOFF
"RTN","ACKQASU",31,0)
 ;
"RTN","ACKQASU",32,0)
 ;
"RTN","ACKQASU",33,0)
 W !!,"    ",IOUON,"Appt Date/Time",IOUOFF,"     ",IOUON,"Status",IOUOFF,"                    ",IOUON,"Appointment Type",IOUOFF
"RTN","ACKQASU",34,0)
 K ACKDDT1,ACKDDT2,ACKSSN
"RTN","ACKQASU",35,0)
 ;
"RTN","ACKQASU",36,0)
 S ACKK3=""
"RTN","ACKQASU",37,0)
 F  S ACKK3=$O(^UTILITY("VASD",$J,ACKK3)) Q:ACKK3=""  D
"RTN","ACKQASU",38,0)
 . S ACKSTRIN=^UTILITY("VASD",$J,ACKK3,"E")
"RTN","ACKQASU",39,0)
 . W !!," "_ACKK3_"."
"RTN","ACKQASU",40,0)
 . W ?4,$P($P(ACKSTRIN,U,1),"@",1)_" "_$P($P(ACKSTRIN,U,1),"@",2)
"RTN","ACKQASU",41,0)
 . W ?23,$S($P(ACKSTRIN,U,3)'="":$P(ACKSTRIN,U,3),1:"NO ACTION TAKEN")
"RTN","ACKQASU",42,0)
 . W ?49,$P(ACKSTRIN,U,4)
"RTN","ACKQASU",43,0)
 W !!!
"RTN","ACKQASU",44,0)
 Q
"RTN","ACKQASU",45,0)
 ;
"RTN","ACKQASU",46,0)
KILL ;  Kill off values at end of processing
"RTN","ACKQASU",47,0)
 K ACK0,ACK2,ACKCAT,ACKCD,ACKCDN,ACKCLN,ACKCNT,ACKCP,ACKDA,ACKDC,ACKDUP
"RTN","ACKQASU",48,0)
 K ACKDUPN,ACKECSC,ACKESITE,ACKFLD,ACKFLG1,ACKFLG2,ACKGEN,ACKI,ACKLAYGO
"RTN","ACKQASU",49,0)
 K ACKMOD,ACKMON,ACKQCPS,ACKQCPT,ACKQRAW,ACKRAW,ACKREQ,ACKSEL,ACKSTF
"RTN","ACKQASU",50,0)
 K ACKSIG,ACKTM,ACKVD,ACKY,ACKDEF,ACKDIVN,ACKCSC,ACKCPNO,ACKCLNO,ACKCLIN
"RTN","ACKQASU",51,0)
 K ACKL1,ACKL2,ACKL3,ACKL4,ACKR1,ACKR2,ACKR3,ACKR4,ACKTITL,%,%DT,%I,%X
"RTN","ACKQASU",52,0)
 K %Y,C,D0,DA,DFN,DIC,DIE,DIK,DIRUT,DLAYGO,DR,DTOUT,DUOUT,I,J,VA,VADM
"RTN","ACKQASU",53,0)
 K VAERR,X,X1,X4,Y,ACKELIG,ACKIEN,ACKK2,ACKLAMD,ACKLOSS,ACKN,ACKPCE
"RTN","ACKQASU",54,0)
 K ACKVISIT,ACKPAT,ACKVIEN,ACKDIV,ACLCLIN,ACKCHK,ACKVIEN,ACKAO,ACKSC
"RTN","ACKQASU",55,0)
 K CLINVAR,DIVARR,ACKRAD,ACKENV,ACKPROV,ACKDIAGD,ACKCPTDS,ACKDIRUT
"RTN","ACKQASU",56,0)
 K ACKPCENO,VSAD,DIVARR,DIV,CLINVARR,ACKTME,ACKSCR,ACKELGCT,ACKELG1
"RTN","ACKQASU",57,0)
 K ACKTRGT,ACKDVN,ACKACKBA,ACKAUDIO,ACKATS,ACKQUIT,ACKMSG,ACKQTST
"RTN","ACKQASU",58,0)
 K ACKQSER,ACKQORG,ACKQIR,ACKQECON,ACKAPMNT,ICPTVDT,ICDVDT,ACKHNC,ACKCV
"RTN","ACKQASU",59,0)
 Q
"RTN","ACKQASU",60,0)
 ;
"RTN","ACKQASU",61,0)
 ;
"RTN","ACKQASU",62,0)
DC ;  CHECK OUT DIAGNOSTIC CONDITION - ENTER IF NEEDED
"RTN","ACKQASU",63,0)
 N ACKY
"RTN","ACKQASU",64,0)
 Q:$D(^ACK(509850.2,DFN,1,"B",ACKDC))
"RTN","ACKQASU",65,0)
 ;ACKQ*3.0*22 updated api
"RTN","ACKQASU",66,0)
 S ACKY=Y D DEM^VADPT S Y=ACKY,X=$P($$ICDDX^ICDCODE(ACKDC),U,2),ACKLN=$P(VADM(1),","),ACKSX=$P(VADM(5),U)
"RTN","ACKQASU",67,0)
 I $G(ACKBGRD)'="1" D
"RTN","ACKQASU",68,0)
 . W !!,X,"   ",$$DIAGTXT^ACKQUTL8(ACKDC,ACKVD)
"RTN","ACKQASU",69,0)
 . W !,"We have no previous record of diagnostic condition ",X," for ",$S(ACKSX="F":"Ms.",1:"Mr.")," ",ACKLN,"." D ADCODE
"RTN","ACKQASU",70,0)
 . W !,"Ok, I've added this code to ",$S(ACKSX="F":"her",1:"his")," permanent record !",!
"RTN","ACKQASU",71,0)
 I $G(ACKBGRD)=1 D ADCODE
"RTN","ACKQASU",72,0)
 K ACK0,ACKLN,ACKSX,VA,VADM,VAERR,X Q
"RTN","ACKQASU",73,0)
 ;
"RTN","ACKQASU",74,0)
ADCODE ;  Adds ICD to permanent record.
"RTN","ACKQASU",75,0)
 N D,D0,D1,DA,DB,DC,DD,DDTM,DE,DF,DG,DH,DI,DIC,DIE,DIEL,DIFLD,DIOV,DIP,DJ,DK,DL,DM,DN,DO,DP,DQ,DR,DU,DV,DW,DXS,DZ,I,Y ;we're calling this from FM
"RTN","ACKQASU",76,0)
 F  L +^ACK(509850.2,DFN,1,0):$G(DILOCKTM,3) Q:$T  W:$G(ACKBGRD)'="1" !,"Another user is editing this record."
"RTN","ACKQASU",77,0)
 S (DIC,DIE)="^ACK(509850.2,"_DFN_",1,",DIC(0)="L",DLAYGO=509850.2,ACKLAYGO=""
"RTN","ACKQASU",78,0)
 S DIC("P")=$P(^DD(509850.2,2,0),"^",2),DA(1)=DFN,X=ACKDC D FILE^DICN Q:Y<0  S DA=+Y,DR="2;1///"_ACKVD D ^DIE
"RTN","ACKQASU",79,0)
 L -^ACK(509850.2,DFN,1,0) Q
"RTN","ACKQASU",80,0)
 ;
"RTN","ACKQASU",81,0)
 Q
"RTN","ACKQASU",82,0)
 ;
"RTN","ACKQASU",83,0)
GETPCETM(ACKPCENO) ; get appointment time from a PCE Visit ien
"RTN","ACKQASU",84,0)
 ; inputs:- ACKPCENO - PCE Visit ien (from ^AUPNVSIT)
"RTN","ACKQASU",85,0)
 ; returned :-   0^ - error (visit not found)
"RTN","ACKQASU",86,0)
 ;               '.nnnnnn^' - time portion of PCE visit date/time
"RTN","ACKQASU",87,0)
 N ACKDATE,ACKTM
"RTN","ACKQASU",88,0)
 K ^TMP("PXKENC",$J)
"RTN","ACKQASU",89,0)
 D ENCEVENT^PXAPI(ACKPCENO)
"RTN","ACKQASU",90,0)
 S ACKDATE=$P($G(^TMP("PXKENC",$J,ACKPCENO,"VST",ACKPCENO,0)),U,1)
"RTN","ACKQASU",91,0)
 S ACKTM=$S(ACKDATE="":0,1:ACKDATE#1)
"RTN","ACKQASU",92,0)
 K ^TMP("PXKENC",$J)
"RTN","ACKQASU",93,0)
 Q ACKTM_U
"RTN","ACKQASU",94,0)
 ;
"RTN","ACKQASU",95,0)
DUPEDATA(ACKPAT,ACKCLIN,ACKVD,ACKTM) ;  If an appointment or PCE visit has been selected for a visit
"RTN","ACKQASU",96,0)
 ; which is at the same time, for the same patient, on the same day 
"RTN","ACKQASU",97,0)
 ; within the same clinic this processing is run.
"RTN","ACKQASU",98,0)
 ; inputs:- ACKPAT - patient ien
"RTN","ACKQASU",99,0)
 ;          ACKCLIN - clinic ien
"RTN","ACKQASU",100,0)
 ;          ACKVD - visit date (internal)
"RTN","ACKQASU",101,0)
 ;          ACKTM - appointment time (.NNN - internal)
"RTN","ACKQASU",102,0)
 W !!?4,"ERROR - A visit already exists in QUASAR with the following details..",!
"RTN","ACKQASU",103,0)
 W !?7,"Visit Date: ",$$DATE(ACKVD),"    Appointment Time: ",$$TIME(ACKTM)
"RTN","ACKQASU",104,0)
 W !?7,"    Clinic: ",$$GET1^DIQ(44,ACKCLIN_",",.01,"E")
"RTN","ACKQASU",105,0)
 W !?7,"   Patient: ",$$GET1^DIQ(509850.2,ACKPAT_",",.01,"E")
"RTN","ACKQASU",106,0)
 W !!?4,"If you choose to continue you must enter a different Appointment Time."
"RTN","ACKQASU",107,0)
 ;
"RTN","ACKQASU",108,0)
 ; W !!,"There is already an entry within Quasar for this Patient, within the same"
"RTN","ACKQASU",109,0)
 ; W !,"Clinic, on the same date at the same time."
"RTN","ACKQASU",110,0)
 ; W !!,"Enter '^' to terminate and quit back to the Division prompt"
"RTN","ACKQASU",111,0)
 ; W !,"or <RETURN> to continue."
"RTN","ACKQASU",112,0)
 W !
"RTN","ACKQASU",113,0)
 K DIR S DIR(0)="E" D ^DIR K DIR  ;  Return to Continue '^' to Exit 
"RTN","ACKQASU",114,0)
 I X="^" Q 0
"RTN","ACKQASU",115,0)
 Q 1
"RTN","ACKQASU",116,0)
 ;
"RTN","ACKQASU",117,0)
DATE(ACKDATE) ; convert ACKDATE to external format
"RTN","ACKQASU",118,0)
 S Y=ACKDATE D DD^%DT
"RTN","ACKQASU",119,0)
 Q Y
"RTN","ACKQASU",120,0)
TIME(ACKTIME) ; convert Time to external format
"RTN","ACKQASU",121,0)
 Q $$FMT^ACKQUTL6(ACKTIME,1)
"RTN","ACKQASU4")
0^2^B47495608^B44737991
"RTN","ACKQASU4",1,0)
ACKQASU4 ;HCIOFO/AG - New/Edit Visit Utilities  ; 12/31/07 7:28am
"RTN","ACKQASU4",2,0)
 ;;3.0;QUASAR;**17,22**;Feb 11, 2000;Build 5
"RTN","ACKQASU4",3,0)
 ;Per VHA Directive 2004-038, this routine SHOULD NOT be modified.
"RTN","ACKQASU4",4,0)
 ;
"RTN","ACKQASU4",5,0)
 ;  Reference/ICR
"RTN","ACKQASU4",6,0)
 ;  $$ICDDX^ICDCODE - 3990
"RTN","ACKQASU4",7,0)
 ;  $$MOD^ICPTMOD - 1996
"RTN","ACKQASU4",8,0)
 ;  $$CPT^ICPTCOD - 1995
"RTN","ACKQASU4",9,0)
 ;
"RTN","ACKQASU4",10,0)
COPYPCE(ACKVIEN,ACKPCENO) ; Copies the visit data from given PCE Visit
"RTN","ACKQASU4",11,0)
 ; inputs:- ACKVIEN - QUASAR Visit ien to receive data
"RTN","ACKQASU4",12,0)
 ;          ACKPCENO - PCE Visit ien to copy from
"RTN","ACKQASU4",13,0)
 ; outputs:- 0^ - everything ok
"RTN","ACKQASU4",14,0)
 ;           n^ - n errors found
"RTN","ACKQASU4",15,0)
 ;   errors filed in ^TMP("ACKQASU4",$J,"COPYPCE","ERROR",n)=field^int^ext^message
"RTN","ACKQASU4",16,0)
 ; NB. In the validation of Dx and CPT codes, the Visit Stop Code (A,S,
"RTN","ACKQASU4",17,0)
 ; AT or ST) is read from the Qsr Visit record. For this validation to
"RTN","ACKQASU4",18,0)
 ; work therefore, the Visit Stop Code must already be filed on the Qsr
"RTN","ACKQASU4",19,0)
 ; visit.
"RTN","ACKQASU4",20,0)
 N ACKERR,ACKARR,ACKVELG,ACKI,ACKICD,ACKE,ACKTMP,ACKPRIM,ACKSTUD
"RTN","ACKQASU4",21,0)
 N ACKSC,ACKAO,ACKIR,ACKEC,ACKREC,ACKPRV,ACKTYP,ACKCPT,ACKQTY,ACKVTME
"RTN","ACKQASU4",22,0)
 N ACKDPRIM,ACKQPRV,ACKPRVCK
"RTN","ACKQASU4",23,0)
 K ^TMP("ACKQASU4",$J,"COPYPCE") ; initialise return array
"RTN","ACKQASU4",24,0)
 S ACKERR=0  ; error counter
"RTN","ACKQASU4",25,0)
 ;
"RTN","ACKQASU4",26,0)
 ; get the PCE Visit data - returned in ^TMP("PXKENC",$J,pce ien,...)
"RTN","ACKQASU4",27,0)
 D ENCEVENT^PXAPI(ACKPCENO,"")
"RTN","ACKQASU4",28,0)
 ;
"RTN","ACKQASU4",29,0)
 ;  Get Diagnostic codes
"RTN","ACKQASU4",30,0)
 S ACKI="",ACKDPRIM=""
"RTN","ACKQASU4",31,0)
 F  S ACKI=$O(^TMP("PXKENC",$J,ACKPCENO,"POV",ACKI)) Q:ACKI=""  D
"RTN","ACKQASU4",32,0)
 . S ACKICD=$P($G(^TMP("PXKENC",$J,ACKPCENO,"POV",ACKI,0)),U,1)  ; icd ien
"RTN","ACKQASU4",33,0)
 . I ACKDPRIM="",$P($G(^TMP("PXKENC",$J,ACKPCENO,"POV",ACKI,0)),U,12)="P" S ACKDPRIM=1
"RTN","ACKQASU4",34,0)
 . ; add to visit
"RTN","ACKQASU4",35,0)
 . S ACKE=$$SETDIAG^ACKQASU5(ACKVIEN,ACKICD,ACKDPRIM)
"RTN","ACKQASU4",36,0)
 . I ACKDPRIM S ACKDPRIM="0"
"RTN","ACKQASU4",37,0)
 . ; if error returned then file
"RTN","ACKQASU4",38,0)
 . I 'ACKE D  Q
"RTN","ACKQASU4",39,0)
 . . ;ACKQ*3.0*22 updated api
"RTN","ACKQASU4",40,0)
 . . S ACKTMP="Diagnosis"_U_ACKICD_U_$P($$ICDDX^ICDCODE(ACKICD),U,2)_U_$P(ACKE,U,2)
"RTN","ACKQASU4",41,0)
 . . D ADDERR
"RTN","ACKQASU4",42,0)
 . ; if successful then ensure Diagnosis is added to  Patient Diagnostic history
"RTN","ACKQASU4",43,0)
 . D DIAGHIST
"RTN","ACKQASU4",44,0)
 ;
"RTN","ACKQASU4",45,0)
 ;  get all the providers and file
"RTN","ACKQASU4",46,0)
 S ACKI="",ACKPRIM="",ACKSTUD=""
"RTN","ACKQASU4",47,0)
 F  S ACKI=$O(^TMP("PXKENC",$J,ACKPCENO,"PRV",ACKI)) Q:ACKI=""  D
"RTN","ACKQASU4",48,0)
 . S ACKREC=$G(^TMP("PXKENC",$J,ACKPCENO,"PRV",ACKI,0))
"RTN","ACKQASU4",49,0)
 . S ACKPRV=$P(ACKREC,U,1)  ; provider ien
"RTN","ACKQASU4",50,0)
 . S ACKTYP=$P(ACKREC,U,4)  ; primary/secondary
"RTN","ACKQASU4",51,0)
 . I ACKTYP="P" D COPYPRIM Q   ; copy primary provider
"RTN","ACKQASU4",52,0)
 . I ACKTYP="S" D COPYSCND Q   ; copy secondary provider
"RTN","ACKQASU4",53,0)
 ;
"RTN","ACKQASU4",54,0)
 ; Get procedure codes
"RTN","ACKQASU4",55,0)
 S ACKI=""
"RTN","ACKQASU4",56,0)
 F  S ACKI=$O(^TMP("PXKENC",$J,ACKPCENO,"CPT",ACKI)) Q:ACKI=""  D
"RTN","ACKQASU4",57,0)
 . S ACKREC=$G(^TMP("PXKENC",$J,ACKPCENO,"CPT",ACKI,0))
"RTN","ACKQASU4",58,0)
 . S ACKCPT=$P(ACKREC,U,1),ACKQTY=$P(ACKREC,U,16)  ; unpack cpt and volume
"RTN","ACKQASU4",59,0)
 . ;  Get Procedure Provider
"RTN","ACKQASU4",60,0)
 . S ACKPRV=$P($G(^TMP("PXKENC",$J,ACKPCENO,"CPT",ACKI,12)),U,4)
"RTN","ACKQASU4",61,0)
 . S ACKQPRV=$$PROVCHK(ACKPRV)
"RTN","ACKQASU4",62,0)
 . I ACKPRV'="" D
"RTN","ACKQASU4",63,0)
 . . S ACKPRVCK=$$STACT^ACKQUTL(ACKQPRV,ACKVD)
"RTN","ACKQASU4",64,0)
 . . I ACKPRVCK'="0",ACKPRVCK'="-6" D
"RTN","ACKQASU4",65,0)
 . . . S ACKTMP="Provider"_U_ACKPRV_U_$$GET1^DIQ(200,ACKPRV_",",.01,"E")_U
"RTN","ACKQASU4",66,0)
 . . . S ACKTMP=ACKTMP_"Invalid Procedure Provider"
"RTN","ACKQASU4",67,0)
 . . . D ADDERR
"RTN","ACKQASU4",68,0)
 . . . S ACKQPRV=""
"RTN","ACKQASU4",69,0)
 . ; add to visit
"RTN","ACKQASU4",70,0)
 . S ACKE=$$SETPROC^ACKQASU5(ACKVIEN,ACKCPT,ACKQTY,ACKQPRV)
"RTN","ACKQASU4",71,0)
 . ; if error returned then file
"RTN","ACKQASU4",72,0)
 . I 'ACKE D  Q
"RTN","ACKQASU4",73,0)
 . . ;ACKQ*3.0*22 updated api
"RTN","ACKQASU4",74,0)
 . . S ACKTMP="Procedure"_U_ACKCPT_U_$P($$CPT^ICPTCOD(ACKCPT),U,2)_U_$P(ACKE,U,2)
"RTN","ACKQASU4",75,0)
 . . D ADDERR
"RTN","ACKQASU4",76,0)
 . ; if successful then do the modifiers for this procedure
"RTN","ACKQASU4",77,0)
 . S ACKM=0,ACKPIEN=+ACKE   ; ACKPIEN=procedure ien from visit file
"RTN","ACKQASU4",78,0)
 . F  S ACKM=$O(^TMP("PXKENC",$J,ACKPCENO,"CPT",ACKI,1,ACKM)) Q:'ACKM  D
"RTN","ACKQASU4",79,0)
 . . S ACKMOD=$P($G(^TMP("PXKENC",$J,ACKPCENO,"CPT",ACKI,1,ACKM,0)),U,1)
"RTN","ACKQASU4",80,0)
 . . ; add to visit
"RTN","ACKQASU4",81,0)
 . . S ACKE=$$SETMDFR^ACKQASU5(ACKVIEN,ACKPIEN,ACKMOD)
"RTN","ACKQASU4",82,0)
 . . ; if error returned then file
"RTN","ACKQASU4",83,0)
 . . I '+ACKE D  Q
"RTN","ACKQASU4",84,0)
 . . . ;ACKQ*3.0*22 updated api
"RTN","ACKQASU4",85,0)
 . . . S ACKTMP="Modifier"_U_ACKMOD_U_$P($$MOD^ICPTMOD(ACKMOD,"I"),U,2)_U_$P(ACKE,U,2)
"RTN","ACKQASU4",86,0)
 . . . D ADDERR
"RTN","ACKQASU4",87,0)
 ;
"RTN","ACKQASU4",88,0)
 ; now file header items
"RTN","ACKQASU4",89,0)
 K ACKARR,ACKPRV
"RTN","ACKQASU4",90,0)
 ;
"RTN","ACKQASU4",91,0)
 ;  If PCE visit has an eligibility write to a&sp visit file
"RTN","ACKQASU4",92,0)
 S ACKVELG=$P($G(^TMP("PXKENC",$J,ACKPCENO,"VST",ACKPCENO,0)),U,21)
"RTN","ACKQASU4",93,0)
 I ACKVELG'="" S ACKARR(509850.6,ACKVIEN_",",80)=ACKVELG
"RTN","ACKQASU4",94,0)
 ;
"RTN","ACKQASU4",95,0)
 ;  Get service connected,Agent Orange,Radiation and Environmental
"RTN","ACKQASU4",96,0)
 ;  Contaminents from PCE file and set them to the Visit file.
"RTN","ACKQASU4",97,0)
 S ACKREC=$G(^TMP("PXKENC",$J,ACKPCENO,"VST",ACKPCENO,800))
"RTN","ACKQASU4",98,0)
 S ACKSC=$P(ACKREC,U,1)  ; service connected
"RTN","ACKQASU4",99,0)
 S ACKAO=$P(ACKREC,U,2)  ; agent orange
"RTN","ACKQASU4",100,0)
 S ACKIR=$P(ACKREC,U,3)  ; ionizing radiation
"RTN","ACKQASU4",101,0)
 S ACKEC=$P(ACKREC,U,4)  ; environmental contaminants
"RTN","ACKQASU4",102,0)
 S ACKARR(509850.6,ACKVIEN_",",20)=$S(+ACKSC:1,ACKSC=0:0,1:"")
"RTN","ACKQASU4",103,0)
 S ACKARR(509850.6,ACKVIEN_",",25)=$S(+ACKAO:1,ACKAO=0:0,1:"")
"RTN","ACKQASU4",104,0)
 S ACKARR(509850.6,ACKVIEN_",",30)=$S(+ACKIR:1,ACKIR=0:0,1:"")
"RTN","ACKQASU4",105,0)
 S ACKARR(509850.6,ACKVIEN_",",35)=$S(+ACKEC:1,ACKEC=0:0,1:"")
"RTN","ACKQASU4",106,0)
 ;
"RTN","ACKQASU4",107,0)
 ; Update QUASAR visit record
"RTN","ACKQASU4",108,0)
 D FILE^DIE("","ACKARR")
"RTN","ACKQASU4",109,0)
 K ACKARR
"RTN","ACKQASU4",110,0)
 ;
"RTN","ACKQASU4",111,0)
COPYPCEX ; Exit point
"RTN","ACKQASU4",112,0)
 K ^TMP("PXKENC",$J)  ; Clear PCE data
"RTN","ACKQASU4",113,0)
 I ACKERR S ^TMP("ACKQASU4",$J,"COPYPCE","ERROR")=ACKERR  ; final error count
"RTN","ACKQASU4",114,0)
 Q ACKERR_U  ; return error count
"RTN","ACKQASU4",115,0)
 ;
"RTN","ACKQASU4",116,0)
 ;
"RTN","ACKQASU4",117,0)
COPYPRIM ; Copy the primary provider to QUASAR
"RTN","ACKQASU4",118,0)
 ;
"RTN","ACKQASU4",119,0)
 ; If we haven't successfully filed a primary then attempt to
"RTN","ACKQASU4",120,0)
 I ACKPRIM="" D  Q  ;
"RTN","ACKQASU4",121,0)
 . S ACKQPRV=$$PROVCHK(ACKPRV)
"RTN","ACKQASU4",122,0)
 . S ACKE=$$SETPRIM^ACKQASU6(ACKVIEN,ACKQPRV)  ; Attempt to add to visit
"RTN","ACKQASU4",123,0)
 . I +ACKE S ACKPRIM=ACKQPRV  ; Record that we now have a primary
"RTN","ACKQASU4",124,0)
 . I '+ACKE D  ; error occurred
"RTN","ACKQASU4",125,0)
 . . S ACKTMP="Provider"_U_ACKPRV_U_$$GET1^DIQ(200,ACKPRV_",",.01,"E")_U
"RTN","ACKQASU4",126,0)
 . . S ACKTMP=ACKTMP_$P(ACKE,U,2)
"RTN","ACKQASU4",127,0)
 . . D ADDERR
"RTN","ACKQASU4",128,0)
 ;
"RTN","ACKQASU4",129,0)
 ; if we already have a primary then add an error message
"RTN","ACKQASU4",130,0)
 S ACKTMP="Provider"_U_ACKPRV_U_$$GET1^DIQ(200,ACKPRV_",",.01,"E")_U
"RTN","ACKQASU4",131,0)
 S ACKTMP=ACKTMP_"Visit already has a Primary Provider"
"RTN","ACKQASU4",132,0)
 D ADDERR
"RTN","ACKQASU4",133,0)
 ;
"RTN","ACKQASU4",134,0)
 ; return to provider loop
"RTN","ACKQASU4",135,0)
 Q
"RTN","ACKQASU4",136,0)
 ;
"RTN","ACKQASU4",137,0)
COPYSCND ; copy a secondary provider to QUASAR
"RTN","ACKQASU4",138,0)
 ;
"RTN","ACKQASU4",139,0)
 ; determine the Quasar classification for this provider
"RTN","ACKQASU4",140,0)
 S ACKQPRV=$$PROVCHK(ACKPRV)
"RTN","ACKQASU4",141,0)
 S ACKTYPQ=$$GET1^DIQ(509850.3,$S(ACKQPRV="":" ",1:ACKQPRV)_",",.02,"I")
"RTN","ACKQASU4",142,0)
 ;
"RTN","ACKQASU4",143,0)
 ; if they are a student and we haven't one already, 
"RTN","ACKQASU4",144,0)
 ;  then attempt to file as student
"RTN","ACKQASU4",145,0)
 I ACKTYPQ="S",ACKSTUD="" D  Q   ; student
"RTN","ACKQASU4",146,0)
 . S ACKE=$$SETSTUD^ACKQASU6(ACKVIEN,ACKQPRV)
"RTN","ACKQASU4",147,0)
 . I +ACKE S ACKSTUD=ACKQPRV Q  ; record that we now have a student
"RTN","ACKQASU4",148,0)
 . I '+ACKE D  ;         Error occurred
"RTN","ACKQASU4",149,0)
 . . S ACKTMP="Student"_U_ACKPRV_U_$$GET1^DIQ(200,ACKPRV_",",.01,"E")_U
"RTN","ACKQASU4",150,0)
 . . S ACKTMP=ACKTMP_$P(ACKE,U,2)
"RTN","ACKQASU4",151,0)
 . . D ADDERR
"RTN","ACKQASU4",152,0)
 ;
"RTN","ACKQASU4",153,0)
 ; if they are a student and we already have one then set error
"RTN","ACKQASU4",154,0)
 I ACKTYPQ="S",ACKSTUD'="" D  Q
"RTN","ACKQASU4",155,0)
 . S ACKTMP="Student"_U_ACKPRV_U_$$GET1^DIQ(200,ACKPRV_",",.01,"E")_U
"RTN","ACKQASU4",156,0)
 . S ACKTMP=ACKTMP_"Visit already has a Student"
"RTN","ACKQASU4",157,0)
 . D ADDERR
"RTN","ACKQASU4",158,0)
 ;
"RTN","ACKQASU4",159,0)
 ; if they are a regular provider, and we do not already have
"RTN","ACKQASU4",160,0)
 ;  a secondary provider then attempt to file
"RTN","ACKQASU4",161,0)
 I (ACKTYPQ="C")!(ACKTYPQ="F")!(ACKTYPQ="O") D  Q
"RTN","ACKQASU4",162,0)
 . S ACKE=$$SETSCND^ACKQASU6(ACKVIEN,ACKQPRV)  ; attempt to add to visit
"RTN","ACKQASU4",163,0)
 . I +ACKE Q    ; All okay
"RTN","ACKQASU4",164,0)
 . I '+ACKE D   ; Error occurred
"RTN","ACKQASU4",165,0)
 . . S ACKTMP="Provider"_U_ACKPRV_U_$$GET1^DIQ(200,ACKPRV_",",.01,"E")_U
"RTN","ACKQASU4",166,0)
 . . S ACKTMP=ACKTMP_$P(ACKE,U,2)
"RTN","ACKQASU4",167,0)
 . . D ADDERR
"RTN","ACKQASU4",168,0)
 ;
"RTN","ACKQASU4",169,0)
 ; if we get this far then provider must be unknown to Quasar
"RTN","ACKQASU4",170,0)
 S ACKTMP="Provider"_U_ACKPRV_U_$$GET1^DIQ(200,ACKPRV_",",.01,"E")_U
"RTN","ACKQASU4",171,0)
 S ACKTMP=ACKTMP_"Provider not defined for Audiology and Speech Pathology"
"RTN","ACKQASU4",172,0)
 D ADDERR
"RTN","ACKQASU4",173,0)
 ;
"RTN","ACKQASU4",174,0)
 ; end of checking a secondary provider
"RTN","ACKQASU4",175,0)
 Q
"RTN","ACKQASU4",176,0)
 ;
"RTN","ACKQASU4",177,0)
ADDERR ; add an error to return array in ^TMP
"RTN","ACKQASU4",178,0)
 ;  ACKERR is current error count, ACKTMP is the error detail
"RTN","ACKQASU4",179,0)
 S ACKERR=ACKERR+1
"RTN","ACKQASU4",180,0)
 S ^TMP("ACKQASU4",$J,"COPYPCE","ERROR",ACKERR)=ACKTMP
"RTN","ACKQASU4",181,0)
 Q
"RTN","ACKQASU4",182,0)
 ;
"RTN","ACKQASU4",183,0)
DIAGHIST ; ensure diagnosis is on Patient history
"RTN","ACKQASU4",184,0)
 ; this s/r checks for ACKICD (diagnosis ien) on the patient history
"RTN","ACKQASU4",185,0)
 ; of patient ACKPAT
"RTN","ACKQASU4",186,0)
 ; if the ICD is not found a new entry is automatically added using the
"RTN","ACKQASU4",187,0)
 ; visit date in ACKVD
"RTN","ACKQASU4",188,0)
 N ACKTGT
"RTN","ACKQASU4",189,0)
 ;
"RTN","ACKQASU4",190,0)
 ; look for the diagnosis on the current history
"RTN","ACKQASU4",191,0)
 D FIND^DIC(509850.22,","_ACKPAT_",","","Q",ACKICD,1,"B","","","ACKTGT")
"RTN","ACKQASU4",192,0)
 ;
"RTN","ACKQASU4",193,0)
 ; if found then exit 
"RTN","ACKQASU4",194,0)
 I +$P($G(ACKTGT("DILIST",0)),U,1)=1 Q  ; exactly one found
"RTN","ACKQASU4",195,0)
 ; 
"RTN","ACKQASU4",196,0)
 ; create a new entry
"RTN","ACKQASU4",197,0)
 S ACKUPD(509850.22,"+1,"_ACKPAT_",",.01)=ACKICD
"RTN","ACKQASU4",198,0)
 S ACKUPD(509850.22,"+1,"_ACKPAT_",",1)=ACKVD
"RTN","ACKQASU4",199,0)
 D UPDATE^DIE("","ACKUPD","","")
"RTN","ACKQASU4",200,0)
 ;
"RTN","ACKQASU4",201,0)
 ; end
"RTN","ACKQASU4",202,0)
 Q
"RTN","ACKQASU4",203,0)
 ;
"RTN","ACKQASU4",204,0)
PROVCHK(ACKPRV) ;  Check to see if Provider is on Quasar Staff file - if so
"RTN","ACKQASU4",205,0)
 ;          function passes back Quasars Provider IEN No else null
"RTN","ACKQASU4",206,0)
 ;
"RTN","ACKQASU4",207,0)
 N ACKA,ACKB,NPNAME S ACKB=""
"RTN","ACKQASU4",208,0)
 I ACKPRV="" Q ACKB
"RTN","ACKQASU4",209,0)
 ;ACKQ*3*17 
"RTN","ACKQASU4",210,0)
 S NPNAME=$$GET1^DIQ(200,ACKPRV,.01,"")
"RTN","ACKQASU4",211,0)
 I '$D(^ACK(509850.3,"B",NPNAME)) Q ACKB
"RTN","ACKQASU4",212,0)
 Q $O(^ACK(509850.3,"B",NPNAME,ACKB))
"RTN","ACKQASU4",213,0)
 ;
"RTN","ACKQDWLP")
0^3^B86446562^B83192122
"RTN","ACKQDWLP",1,0)
ACKQDWLP ;AUG/JLTP BIR/PTD HCIOFO/BH-Print A&SP Capitation Report ; [ 03/28/96   10:45 AM ]
"RTN","ACKQDWLP",2,0)
 ;;3.0;QUASAR;**1,22**;Feb 11, 2000;Build 5
"RTN","ACKQDWLP",3,0)
 ;Per VHA Directive 2004-038, this routine SHOULD NOT be modified.
"RTN","ACKQDWLP",4,0)
 ;
"RTN","ACKQDWLP",5,0)
 ;   Developed within V.3, works at Div level rather than site level -
"RTN","ACKQDWLP",6,0)
 ;   - pre v.3
"RTN","ACKQDWLP",7,0)
 ;
"RTN","ACKQDWLP",8,0)
 ;
"RTN","ACKQDWLP",9,0)
 ;  Reference/ICR
"RTN","ACKQDWLP",10,0)
 ;  $$ICDDX^ICDCODE - 3990
"RTN","ACKQDWLP",11,0)
 ;
"RTN","ACKQDWLP",12,0)
 ;
"RTN","ACKQDWLP",13,0)
 K ^TMP("ACKQDWLP",$J)
"RTN","ACKQDWLP",14,0)
OPTN ; Introduce option
"RTN","ACKQDWLP",15,0)
 W @IOF,!,"This option produces a four-part Capitation Report.",!,"It includes Demographic, Diagnostic and Procedure data.",!
"RTN","ACKQDWLP",16,0)
 ;
"RTN","ACKQDWLP",17,0)
DIV ; select Div (user may select one/many/ALL)
"RTN","ACKQDWLP",18,0)
 S ACKDIV=$$DIV^ACKQUTL2(3,.ACKDIV,"IA") G:'ACKDIV EXIT
"RTN","ACKQDWLP",19,0)
 D GETDT^ACKQWL G:$D(DIRUT) EXIT D INIT^ACKQWL
"RTN","ACKQDWLP",20,0)
 ;
"RTN","ACKQDWLP",21,0)
DEV W !!,"The right margin for this report is 80.",!,"You can queue it to run at a later time.",!
"RTN","ACKQDWLP",22,0)
 K %ZIS,IOP S %ZIS="QM",%ZIS("B")="" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED." G EXIT
"RTN","ACKQDWLP",23,0)
 I $D(IO("Q")) K IO("Q") S ZTRTN="DQ^ACKQDWLP",ZTDESC="QUASAR - Print A&SP Capitation Report",ZTSAVE("ACK*")="" D ^%ZTLOAD D HOME^%ZIS K ZTSK G EXIT
"RTN","ACKQDWLP",24,0)
DQ ;  Entry point when queued.
"RTN","ACKQDWLP",25,0)
 U IO
"RTN","ACKQDWLP",26,0)
 D NOW^%DTC S ACKCDT=$$NUMDT^ACKQUTL(%)_" at "_$$FTIME^ACKQUTL(%),ACKPG=0 K ^TMP("ACKQWLD",$J)
"RTN","ACKQDWLP",27,0)
 D COMPILE,PRINT
"RTN","ACKQDWLP",28,0)
 ;
"RTN","ACKQDWLP",29,0)
EXIT ;  ALWAYS EXIT HERE
"RTN","ACKQDWLP",30,0)
 K %I,ACKBFY,ACKCDT,ACKDA,ACKEM,ACKM,ACKPG,AS,CDR,CPT,DIR,DIRUT,DTOUT
"RTN","ACKQDWLP",31,0)
 K ACKDIV,DUOUT,I,ICD,LN,T,X,XAS,Y,ZIP,^TMP("ACKQDWLP",$J)
"RTN","ACKQDWLP",32,0)
 W:$E(IOST)="C" @IOF D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","ACKQDWLP",33,0)
 Q
"RTN","ACKQDWLP",34,0)
 ;
"RTN","ACKQDWLP",35,0)
COMPILE ; Comp properly sorted data in ^TMP
"RTN","ACKQDWLP",36,0)
 N ACK1,ACKVDVN,ACK6,ACKREC,ACKAUD,ACKSPE
"RTN","ACKQDWLP",37,0)
 ;
"RTN","ACKQDWLP",38,0)
 S ACK1=""
"RTN","ACKQDWLP",39,0)
 F  S ACK1=$O(ACKDIV(ACK1)) Q:ACK1=""  D
"RTN","ACKQDWLP",40,0)
 . S ACKVDVN=$P(ACKDIV(ACK1),U,1)
"RTN","ACKQDWLP",41,0)
 . D ZIPSTAT,ICDSTAT,CPTSTAT,ECSTAT^ACKQDWLU
"RTN","ACKQDWLP",42,0)
 Q
"RTN","ACKQDWLP",43,0)
 ;
"RTN","ACKQDWLP",44,0)
ZIPSTAT ; ZIP stats
"RTN","ACKQDWLP",45,0)
 N ACKCODE
"RTN","ACKQDWLP",46,0)
 S ACK6=0
"RTN","ACKQDWLP",47,0)
 F  S ACK6=$O(^ACK(509850.7,ACKDA,5,ACKVDVN,3,ACK6)) Q:ACK6=""!(ACK6'?.N)  D
"RTN","ACKQDWLP",48,0)
 . S ACKREC=^ACK(509850.7,ACKDA,5,ACKVDVN,3,ACK6,0)
"RTN","ACKQDWLP",49,0)
 . S ACKAUD=$P(ACKREC,U,2,5),ACKSPE=$P(ACKREC,U,6,9)
"RTN","ACKQDWLP",50,0)
 . S ACKCODE=$P(ACKREC,U,1)
"RTN","ACKQDWLP",51,0)
 . I $TR(ACKAUD,"^","")'="" D
"RTN","ACKQDWLP",52,0)
 . . S ^TMP("ACKQDWLP",$J,"R",ACKVDVN,3,"A",ACKCODE)=ACKAUD
"RTN","ACKQDWLP",53,0)
 . . S ^TMP("ACKQDWLP",$J,"S",3,"A",ACKCODE,ACKVDVN)=ACKAUD
"RTN","ACKQDWLP",54,0)
 . I $TR(ACKSPE,"^","")'="" D
"RTN","ACKQDWLP",55,0)
 . . S ^TMP("ACKQDWLP",$J,"R",ACKVDVN,3,"S",ACKCODE)=ACKSPE
"RTN","ACKQDWLP",56,0)
 . . S ^TMP("ACKQDWLP",$J,"S",3,"S",ACKCODE,ACKVDVN)=ACKSPE
"RTN","ACKQDWLP",57,0)
 Q
"RTN","ACKQDWLP",58,0)
 ;
"RTN","ACKQDWLP",59,0)
ICDSTAT ; ICD stats
"RTN","ACKQDWLP",60,0)
 N ACKCODE
"RTN","ACKQDWLP",61,0)
 S ACK6=0
"RTN","ACKQDWLP",62,0)
 F  S ACK6=$O(^ACK(509850.7,ACKDA,5,ACKVDVN,1,ACK6)) Q:ACK6=""!(ACK6'?.N)  D
"RTN","ACKQDWLP",63,0)
 . S ACKREC=^ACK(509850.7,ACKDA,5,ACKVDVN,1,ACK6,0)
"RTN","ACKQDWLP",64,0)
 . S ACKAUD=$P(ACKREC,U,2,4),ACKSPE=$P(ACKREC,U,5,7)
"RTN","ACKQDWLP",65,0)
 . S ACKCODE=$P(ACKREC,U,1)
"RTN","ACKQDWLP",66,0)
 . ;ACKQ*3.0*22 updated api
"RTN","ACKQDWLP",67,0)
 . S ACKCODE=$P($$ICDDX^ICDCODE(ACKCODE),U,2)
"RTN","ACKQDWLP",68,0)
 . S ACKCODE=($S(ACKCODE?.NP:+ACKCODE,1:ACKCODE))
"RTN","ACKQDWLP",69,0)
 . I $TR(ACKAUD,"^","")'="" D
"RTN","ACKQDWLP",70,0)
 . . S ^TMP("ACKQDWLP",$J,"R",ACKVDVN,1,"A",ACKCODE)=ACKAUD
"RTN","ACKQDWLP",71,0)
 . . S ^TMP("ACKQDWLP",$J,"S",1,"A",ACKCODE,ACKVDVN)=ACKAUD
"RTN","ACKQDWLP",72,0)
 . I $TR(ACKSPE,"^","")'="" D
"RTN","ACKQDWLP",73,0)
 . . S ^TMP("ACKQDWLP",$J,"R",ACKVDVN,1,"S",ACKCODE)=ACKSPE
"RTN","ACKQDWLP",74,0)
 . . S ^TMP("ACKQDWLP",$J,"S",1,"S",ACKCODE,ACKVDVN)=ACKSPE
"RTN","ACKQDWLP",75,0)
 Q
"RTN","ACKQDWLP",76,0)
 ;
"RTN","ACKQDWLP",77,0)
CPTSTAT ; CPT Stats
"RTN","ACKQDWLP",78,0)
 N ACKCODE
"RTN","ACKQDWLP",79,0)
 S ACK6=0
"RTN","ACKQDWLP",80,0)
 F  S ACK6=$O(^ACK(509850.7,ACKDA,5,ACKVDVN,2,ACK6)) Q:ACK6=""!(ACK6'?.N)  D
"RTN","ACKQDWLP",81,0)
 . S ACKREC=^ACK(509850.7,ACKDA,5,ACKVDVN,2,ACK6,0)
"RTN","ACKQDWLP",82,0)
 . S ACKAUD=$P(ACKREC,U,2,4),ACKSPE=$P(ACKREC,U,5,7)
"RTN","ACKQDWLP",83,0)
 . S ACKCODE=$P(ACKREC,U,1)
"RTN","ACKQDWLP",84,0)
 . I $TR(ACKAUD,"^","")'="" D
"RTN","ACKQDWLP",85,0)
 . . S ^TMP("ACKQDWLP",$J,"R",ACKVDVN,2,"A",ACKCODE)=ACKAUD
"RTN","ACKQDWLP",86,0)
 . . S ^TMP("ACKQDWLP",$J,"S",2,"A",ACKCODE,ACKVDVN)=ACKAUD
"RTN","ACKQDWLP",87,0)
 . I $TR(ACKSPE,"^","")'="" D
"RTN","ACKQDWLP",88,0)
 . . S ^TMP("ACKQDWLP",$J,"R",ACKVDVN,2,"S",ACKCODE)=ACKSPE
"RTN","ACKQDWLP",89,0)
 . . S ^TMP("ACKQDWLP",$J,"S",2,"S",ACKCODE,ACKVDVN)=ACKSPE
"RTN","ACKQDWLP",90,0)
 Q
"RTN","ACKQDWLP",91,0)
 ;
"RTN","ACKQDWLP",92,0)
PRINT ; Display results
"RTN","ACKQDWLP",93,0)
 N ACKDNME,ACKK1,ACKDIEN
"RTN","ACKQDWLP",94,0)
 ;
"RTN","ACKQDWLP",95,0)
 S ACKDNME=""
"RTN","ACKQDWLP",96,0)
 N ACKK1,ACKDIEN,ACKPASS
"RTN","ACKQDWLP",97,0)
 S ACKPASS=0,ACKK1=""
"RTN","ACKQDWLP",98,0)
 F  S ACKK1=$O(ACKDIV(ACKK1)) Q:ACKK1=""  D
"RTN","ACKQDWLP",99,0)
 . S ACKDIEN=$P(ACKDIV(ACKK1),U,1)
"RTN","ACKQDWLP",100,0)
 . I $D(^TMP("ACKQDWLP",$J,"R",ACKDIEN)) S ACKPASS=1
"RTN","ACKQDWLP",101,0)
 I 'ACKPASS D DHD,LINE W !!,"No Capitation data found for selected Divisions." D:$E(IOST)="C" PAUSE^ACKQUTL Q
"RTN","ACKQDWLP",102,0)
 ;
"RTN","ACKQDWLP",103,0)
 S ACKK1=""
"RTN","ACKQDWLP",104,0)
 F  S ACKK1=$O(ACKDIV(ACKK1)) Q:ACKK1=""!($D(DIRUT))  D
"RTN","ACKQDWLP",105,0)
 . S ACKDIEN=$P(ACKDIV(ACKK1),U,1)
"RTN","ACKQDWLP",106,0)
 . S ACKDNME=$P(ACKDIV(ACKK1),U,3)
"RTN","ACKQDWLP",107,0)
 . ;
"RTN","ACKQDWLP",108,0)
 . I '$O(^TMP("ACKQDWLP",$J,"R",ACKDIEN,0)) D  Q
"RTN","ACKQDWLP",109,0)
 .. D DHD,LINE
"RTN","ACKQDWLP",110,0)
 .. W !!,"No data found for this Division."
"RTN","ACKQDWLP",111,0)
 .. D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)
"RTN","ACKQDWLP",112,0)
 . ;
"RTN","ACKQDWLP",113,0)
 . I $D(^TMP("ACKQDWLP",$J,"R",ACKDIEN,3)) D DHD,HD1,ZIP Q:$D(DIRUT)
"RTN","ACKQDWLP",114,0)
 . I $D(^TMP("ACKQDWLP",$J,"R",ACKDIEN,1)) D DHD,HD2,ICD Q:$D(DIRUT)
"RTN","ACKQDWLP",115,0)
 . I $D(^TMP("ACKQDWLP",$J,"R",ACKDIEN,2)) D DHD,HD3,CPT Q:$D(DIRUT)
"RTN","ACKQDWLP",116,0)
 . I $D(^TMP("ACKQDWLP",$J,"R",ACKDIEN,5)) D DHD,HD4,EC Q:$D(DIRUT)
"RTN","ACKQDWLP",117,0)
 . ;
"RTN","ACKQDWLP",118,0)
 Q:$D(DIRUT)
"RTN","ACKQDWLP",119,0)
 D SUMZIP^ACKQDWLR Q:$D(DIRUT)
"RTN","ACKQDWLP",120,0)
 D SUMICD^ACKQDWLR Q:$D(DIRUT)
"RTN","ACKQDWLP",121,0)
 D SUMCPT^ACKQDWLR Q:$D(DIRUT)
"RTN","ACKQDWLP",122,0)
 D SUMEC^ACKQDWLR Q:$D(DIRUT)
"RTN","ACKQDWLP",123,0)
 Q
"RTN","ACKQDWLP",124,0)
 ;
"RTN","ACKQDWLP",125,0)
ZIP ; For all visits
"RTN","ACKQDWLP",126,0)
 N ACKZCT,ACKZTT,ACKZUT,ACKZCPT
"RTN","ACKQDWLP",127,0)
 S AS=""
"RTN","ACKQDWLP",128,0)
 F  S AS=$O(^TMP("ACKQDWLP",$J,"R",ACKDIEN,3,AS)) Q:AS=""!($D(DIRUT))  D
"RTN","ACKQDWLP",129,0)
 .S ACKZCT=0,ACKZTT=0,ACKZUT=0,ACKZCPT=0
"RTN","ACKQDWLP",130,0)
 .I $Y>(IOSL-5) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D DHD,HD1
"RTN","ACKQDWLP",131,0)
 .S XAS=$S(AS="A":"Audiology",1:"Speech Pathology")
"RTN","ACKQDWLP",132,0)
 .W !," "_XAS,":"
"RTN","ACKQDWLP",133,0)
 .S (ZIP,T)="" F  S ZIP=$O(^TMP("ACKQDWLP",$J,"R",ACKDIEN,3,AS,ZIP)) Q:ZIP=""!($D(DIRUT))  D
"RTN","ACKQDWLP",134,0)
 ..I $Y>(IOSL-5) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D DHD,HD1 W !," "_XAS,":"
"RTN","ACKQDWLP",135,0)
 ..S X=^TMP("ACKQDWLP",$J,"R",ACKDIEN,3,AS,ZIP)
"RTN","ACKQDWLP",136,0)
 ..;  Print Zip data
"RTN","ACKQDWLP",137,0)
 ..W !," "_ZIP    ;  Write zero's instead of nulls
"RTN","ACKQDWLP",138,0)
 ..W ?25,$S($P(X,U,1):$P(X,U,1),1:"0")
"RTN","ACKQDWLP",139,0)
 ..W ?39,$S($P(X,U,2):$P(X,U,2),1:"0")
"RTN","ACKQDWLP",140,0)
 ..W ?55,$S($P(X,U,3):$P(X,U,3),1:"0")
"RTN","ACKQDWLP",141,0)
 ..W ?69,$S($P(X,U,4):$P(X,U,4),1:"0")
"RTN","ACKQDWLP",142,0)
 ..;
"RTN","ACKQDWLP",143,0)
 ..;  Calculate Totals
"RTN","ACKQDWLP",144,0)
 ..S ACKZCT=ACKZCT+$P(X,U,1),ACKZTT=ACKZTT+$P(X,U,2)
"RTN","ACKQDWLP",145,0)
 ..S ACKZUT=ACKZUT+$P(X,U,3),ACKZCPT=ACKZCPT+$P(X,U,4)
"RTN","ACKQDWLP",146,0)
 ..;
"RTN","ACKQDWLP",147,0)
 .Q:$D(DIRUT)
"RTN","ACKQDWLP",148,0)
 .S $P(LN,"-",80)="" W !,LN
"RTN","ACKQDWLP",149,0)
 .W !," "_XAS," Total: ",?25,ACKZCT,?39,ACKZTT,?55,ACKZUT,?69,ACKZCPT,!
"RTN","ACKQDWLP",150,0)
 Q:$D(DIRUT)
"RTN","ACKQDWLP",151,0)
 D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)
"RTN","ACKQDWLP",152,0)
 Q
"RTN","ACKQDWLP",153,0)
 ;
"RTN","ACKQDWLP",154,0)
ICD ; ICD stats
"RTN","ACKQDWLP",155,0)
 N ACKICT,ACKITT,ACKIUT
"RTN","ACKQDWLP",156,0)
 ;  D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D DHD,HD2
"RTN","ACKQDWLP",157,0)
 S AS=0 F  S AS=$O(^TMP("ACKQDWLP",$J,"R",ACKDIEN,1,AS)) Q:AS=""!($D(DIRUT))  D
"RTN","ACKQDWLP",158,0)
 .S ACKICT=0,ACKITT=0,ACKIUT=0
"RTN","ACKQDWLP",159,0)
 .I $Y>(IOSL-5) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D DHD,HD2
"RTN","ACKQDWLP",160,0)
 .S XAS=$S(AS="A":"Audiology",1:"Speech Pathology")
"RTN","ACKQDWLP",161,0)
 .W !," "_XAS,":"
"RTN","ACKQDWLP",162,0)
 .S ICD="" F  S ICD=$O(^TMP("ACKQDWLP",$J,"R",ACKDIEN,1,AS,ICD)) Q:ICD=""!($D(DIRUT))  D
"RTN","ACKQDWLP",163,0)
 ..I $Y>(IOSL-5) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D DHD,HD2
"RTN","ACKQDWLP",164,0)
 ..S ACKSTR=^TMP("ACKQDWLP",$J,"R",ACKDIEN,1,AS,ICD)
"RTN","ACKQDWLP",165,0)
 ..;  Display data
"RTN","ACKQDWLP",166,0)
 ..W !," "_ICD
"RTN","ACKQDWLP",167,0)
 ..W ?25,$S($P(ACKSTR,U,1):$P(ACKSTR,U,1),1:"0")
"RTN","ACKQDWLP",168,0)
 ..W ?39,$S($P(ACKSTR,U,2):$P(ACKSTR,U,2),1:"0")
"RTN","ACKQDWLP",169,0)
 ..W ?55,$S($P(ACKSTR,U,3):$P(ACKSTR,U,3),1:"0")
"RTN","ACKQDWLP",170,0)
 ..;  Calculate Totals
"RTN","ACKQDWLP",171,0)
 ..S ACKICT=ACKICT+$P(ACKSTR,U,1),ACKITT=ACKITT+$P(ACKSTR,U,2)
"RTN","ACKQDWLP",172,0)
 ..S ACKIUT=ACKIUT+$P(ACKSTR,U,3)
"RTN","ACKQDWLP",173,0)
 ..;
"RTN","ACKQDWLP",174,0)
 .Q:$D(DIRUT)
"RTN","ACKQDWLP",175,0)
 .S $P(LN,"-",80)="" W !,LN
"RTN","ACKQDWLP",176,0)
 .W !," "_XAS," Total: ",?25,ACKICT,?39,ACKITT,?55,ACKIUT,!
"RTN","ACKQDWLP",177,0)
 .Q:$D(DIRUT)
"RTN","ACKQDWLP",178,0)
 Q:$D(DIRUT)
"RTN","ACKQDWLP",179,0)
 D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)
"RTN","ACKQDWLP",180,0)
 Q
"RTN","ACKQDWLP",181,0)
 ;
"RTN","ACKQDWLP",182,0)
CPT ; CPT stats
"RTN","ACKQDWLP",183,0)
 N ACKCCT,ACKCTT,ACKCUT
"RTN","ACKQDWLP",184,0)
 ;
"RTN","ACKQDWLP",185,0)
 S AS=0 F  S AS=$O(^TMP("ACKQDWLP",$J,"R",ACKDIEN,2,AS)) Q:AS=""!($D(DIRUT))  D
"RTN","ACKQDWLP",186,0)
 .S ACKCCT=0,ACKCTT=0,ACKCUT=0
"RTN","ACKQDWLP",187,0)
 .I $Y>(IOSL-5) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D DHD,HD3
"RTN","ACKQDWLP",188,0)
 .S XAS=$S(AS="A":"Audiology",1:"Speech Pathology")
"RTN","ACKQDWLP",189,0)
 .W !," "_XAS,":"
"RTN","ACKQDWLP",190,0)
 .S CPT="" F  S CPT=$O(^TMP("ACKQDWLP",$J,"R",ACKDIEN,2,AS,CPT)) Q:CPT=""!($D(DIRUT))  D
"RTN","ACKQDWLP",191,0)
 ..I $Y>(IOSL-5) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D DHD,HD3
"RTN","ACKQDWLP",192,0)
 ..S ACKSTR=^TMP("ACKQDWLP",$J,"R",ACKDIEN,2,AS,CPT)
"RTN","ACKQDWLP",193,0)
 ..;  Display data
"RTN","ACKQDWLP",194,0)
 ..W !," "_$$GET1^DIQ(509850.4,CPT_",",.01)
"RTN","ACKQDWLP",195,0)
 ..W ?25,$S($P(ACKSTR,U,1):$P(ACKSTR,U,1),1:"0")
"RTN","ACKQDWLP",196,0)
 ..W ?39,$S($P(ACKSTR,U,2):$P(ACKSTR,U,2),1:"0")
"RTN","ACKQDWLP",197,0)
 ..W ?55,$S($P(ACKSTR,U,3):$P(ACKSTR,U,3),1:"0")
"RTN","ACKQDWLP",198,0)
 ..;  Calculate Totals
"RTN","ACKQDWLP",199,0)
 ..S ACKCCT=ACKCCT+$P(ACKSTR,U,1),ACKCTT=ACKCTT+$P(ACKSTR,U,2)
"RTN","ACKQDWLP",200,0)
 ..S ACKCUT=ACKCUT+$P(ACKSTR,U,3)
"RTN","ACKQDWLP",201,0)
 ..;
"RTN","ACKQDWLP",202,0)
 .Q:$D(DIRUT)
"RTN","ACKQDWLP",203,0)
 .S $P(LN,"-",80)="" W !,LN
"RTN","ACKQDWLP",204,0)
 .W !," "_XAS," Total: ",?25,ACKCCT,?39,ACKCTT,?55,ACKCUT,!
"RTN","ACKQDWLP",205,0)
 .Q:$D(DIRUT)
"RTN","ACKQDWLP",206,0)
 Q:$D(DIRUT)
"RTN","ACKQDWLP",207,0)
 D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)
"RTN","ACKQDWLP",208,0)
 Q
"RTN","ACKQDWLP",209,0)
 ;
"RTN","ACKQDWLP",210,0)
EC ; EC stats
"RTN","ACKQDWLP",211,0)
 N ACKCCT,ACKCTT,ACKCUT
"RTN","ACKQDWLP",212,0)
 ;
"RTN","ACKQDWLP",213,0)
 S AS=0 F  S AS=$O(^TMP("ACKQDWLP",$J,"R",ACKDIEN,5,AS)) Q:AS=""!($D(DIRUT))  D
"RTN","ACKQDWLP",214,0)
 .S ACKCCT=0,ACKCTT=0,ACKCUT=0
"RTN","ACKQDWLP",215,0)
 .I $Y>(IOSL-5) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D DHD,HD4
"RTN","ACKQDWLP",216,0)
 .S XAS=$S(AS="A":"Audiology",1:"Speech Pathology")
"RTN","ACKQDWLP",217,0)
 .W !," "_XAS,":"
"RTN","ACKQDWLP",218,0)
 .S EC="" F  S EC=$O(^TMP("ACKQDWLP",$J,"R",ACKDIEN,5,AS,EC)) Q:EC=""!($D(DIRUT))  D
"RTN","ACKQDWLP",219,0)
 ..I $Y>(IOSL-5) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D DHD,HD4
"RTN","ACKQDWLP",220,0)
 ..S ACKSTR=^TMP("ACKQDWLP",$J,"R",ACKDIEN,5,AS,EC)
"RTN","ACKQDWLP",221,0)
 ..;  Display data
"RTN","ACKQDWLP",222,0)
 ..W !," "_$$GET1^DIQ(725,EC_",",1,"I")
"RTN","ACKQDWLP",223,0)
 ..W ?25,$S($P(ACKSTR,U,1):$P(ACKSTR,U,1),1:"0")
"RTN","ACKQDWLP",224,0)
 ..W ?39,$S($P(ACKSTR,U,2):$P(ACKSTR,U,2),1:"0")
"RTN","ACKQDWLP",225,0)
 ..W ?55,$S($P(ACKSTR,U,3):$P(ACKSTR,U,3),1:"0")
"RTN","ACKQDWLP",226,0)
 ..;  Calculate Totals
"RTN","ACKQDWLP",227,0)
 ..S ACKCCT=ACKCCT+$P(ACKSTR,U,1),ACKCTT=ACKCTT+$P(ACKSTR,U,2)
"RTN","ACKQDWLP",228,0)
 ..S ACKCUT=ACKCUT+$P(ACKSTR,U,3)
"RTN","ACKQDWLP",229,0)
 ..;
"RTN","ACKQDWLP",230,0)
 .Q:$D(DIRUT)
"RTN","ACKQDWLP",231,0)
 .S $P(LN,"-",80)="" W !,LN
"RTN","ACKQDWLP",232,0)
 .W !," "_XAS," Total: ",?25,ACKCCT,?39,ACKCTT,?55,ACKCUT,!
"RTN","ACKQDWLP",233,0)
 .Q:$D(DIRUT)
"RTN","ACKQDWLP",234,0)
 Q:$D(DIRUT)
"RTN","ACKQDWLP",235,0)
 D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)
"RTN","ACKQDWLP",236,0)
 Q
"RTN","ACKQDWLP",237,0)
 ;  
"RTN","ACKQDWLP",238,0)
DHD ;
"RTN","ACKQDWLP",239,0)
 N X
"RTN","ACKQDWLP",240,0)
 W:($E(IOST)="C")!(ACKPG>0) @IOF
"RTN","ACKQDWLP",241,0)
 S ACKPG=ACKPG+1
"RTN","ACKQDWLP",242,0)
 W "Printed: ",ACKCDT,?(IOM-8),"Page: ",ACKPG
"RTN","ACKQDWLP",243,0)
 W ! D CNTR^ACKQUTL("Audiology & Speech Pathology")
"RTN","ACKQDWLP",244,0)
 W ! D CNTR^ACKQUTL("Capitation Report")
"RTN","ACKQDWLP",245,0)
 I ACKPASS W ! D CNTR^ACKQUTL("for DIVISION: "_ACKDNME)
"RTN","ACKQDWLP",246,0)
 W ! D CNTR^ACKQUTL($$XDAT^ACKQUTL(ACKM)) W !
"RTN","ACKQDWLP",247,0)
 Q
"RTN","ACKQDWLP",248,0)
 ;
"RTN","ACKQDWLP",249,0)
HD1 ;  Header for all visits
"RTN","ACKQDWLP",250,0)
 N X
"RTN","ACKQDWLP",251,0)
 W !,?23,"CLINIC",?36,"TELEPHONE",?53,"UNIQUE"
"RTN","ACKQDWLP",252,0)
 W !," ZIP CODE",?23,"VISITS",?37,"VISITS",?52,"PATIENTS",?68,"C&P"
"RTN","ACKQDWLP",253,0)
 D LINE Q
"RTN","ACKQDWLP",254,0)
 ;
"RTN","ACKQDWLP",255,0)
HD2 ;  Head for ICD stats
"RTN","ACKQDWLP",256,0)
 N X W !,?23,"CLINIC",?36,"TELEPHONE"
"RTN","ACKQDWLP",257,0)
 W !," ICD",?23,"VISITS",?37,"VISITS",?53,"UNIQUE" D LINE Q
"RTN","ACKQDWLP",258,0)
 ;
"RTN","ACKQDWLP",259,0)
HD3 ;  Head for CPT stats
"RTN","ACKQDWLP",260,0)
 N X W !,?23,"CLINIC",?36,"TELEPHONE"
"RTN","ACKQDWLP",261,0)
 W !," CPT",?23,"VISITS",?37,"VISITS",?53,"UNIQUE" D LINE Q
"RTN","ACKQDWLP",262,0)
 ;
"RTN","ACKQDWLP",263,0)
HD4 ;  Head for EC stats
"RTN","ACKQDWLP",264,0)
 N X W !,?23,"CLINIC",?36,"TELEPHONE"
"RTN","ACKQDWLP",265,0)
 W !,"  EC",?23,"VISITS",?37,"VISITS",?53,"UNIQUE" D LINE Q
"RTN","ACKQDWLP",266,0)
 ;
"RTN","ACKQDWLP",267,0)
LINE S X="",$P(X,"-",IOM)="-" W !,X Q
"RTN","ACKQDWLP",268,0)
 ;
"RTN","ACKQNQ")
0^4^B28737008^B27597635
"RTN","ACKQNQ",1,0)
ACKQNQ ;AUG/JLTP,AEM BIR/PTD HCIOFO/BH HCIOFO/AG-Inquire - A&SP Patient ; 12/24/09 2:14pm
"RTN","ACKQNQ",2,0)
 ;;3.0;QUASAR;**8,14,18,22**;Feb 11, 2000;Build 5
"RTN","ACKQNQ",3,0)
 ;Per VHA Directive 2004-038, this routine SHOULD NOT be modified.
"RTN","ACKQNQ",4,0)
 ;
"RTN","ACKQNQ",5,0)
 ;
"RTN","ACKQNQ",6,0)
 ;  Reference/ICR
"RTN","ACKQNQ",7,0)
 ;  $$ICDDX^ICDCODE - 3990
"RTN","ACKQNQ",8,0)
 ;
"RTN","ACKQNQ",9,0)
 ;
"RTN","ACKQNQ",10,0)
OPTN ;  Introduce option.
"RTN","ACKQNQ",11,0)
 S ACKQUIT=0
"RTN","ACKQNQ",12,0)
 W:$E(IOST,1,2)="C-" @IOF,!,"This option displays demographic data, inpatient status, and diagnostic",!,"history for a selected A&SP patient."
"RTN","ACKQNQ",13,0)
 ;
"RTN","ACKQNQ",14,0)
DIC ;  LOOKUP PATIENT
"RTN","ACKQNQ",15,0)
 N DIC
"RTN","ACKQNQ",16,0)
 W ! S DIC=509850.2,DIC(0)="AEMQ" D ^DIC
"RTN","ACKQNQ",17,0)
 I (Y<0)!($D(DUOUT)) S ACKQUIT=1 G EXIT
"RTN","ACKQNQ",18,0)
 S ACKDFN=+Y
"RTN","ACKQNQ",19,0)
 ;
"RTN","ACKQNQ",20,0)
ASK ;  Update patient's diagnostic history?
"RTN","ACKQNQ",21,0)
 S DIR(0)="Y",DIR("A")="Do you want to update this patient's diagnostic history NOW",DIR("B")="NO",DIR("?")="Enter YES to recompile the Problem List; enter NO to continue."
"RTN","ACKQNQ",22,0)
 S DIR("??")="^D UPDATE^ACKQHLP1" W ! D ^DIR K DIR G:$D(DIRUT) EXIT I Y=1 D UPDATE
"RTN","ACKQNQ",23,0)
 ;
"RTN","ACKQNQ",24,0)
DEV W !!,"The right margin for this report is 80.",!,"You can queue it to run at a later time.",!
"RTN","ACKQNQ",25,0)
 K %ZIS,IOP S %ZIS="QM",%ZIS("B")="" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED." G EXIT
"RTN","ACKQNQ",26,0)
 I $D(IO("Q")) K IO("Q") S ZTRTN="EN^ACKQNQ",ZTSAVE("ACKDFN")="",ZTDESC="QUASAR - Inquire - A&SP Patient" D ^%ZTLOAD D HOME^%ZIS K ZTSK G EXIT
"RTN","ACKQNQ",27,0)
 ;
"RTN","ACKQNQ",28,0)
EN U IO N DFN,I,X,Y S DFN=ACKDFN
"RTN","ACKQNQ",29,0)
 D DEM^VADPT,INP^VADPT,ELIG^VADPT
"RTN","ACKQNQ",30,0)
 S ACKIVD=$$NUMDT^ACKQUTL($P(^ACK(509850.2,DFN,0),U,2))
"RTN","ACKQNQ",31,0)
 K ACK S ACK(1)=VADM(1),ACK(2)=$P(VADM(3),U,2),ACK(3)=$P(VADM(2),U,2),ACK(4)=VADM(7),ACK(6)=$P(VAIN(4),U,2)
"RTN","ACKQNQ",32,0)
 S ACKINP=$S($L(ACK(6)):1,1:0),ACK(5)="Patient is "_$S(ACKINP:"",1:"not ")_"currently an inpatient."
"RTN","ACKQNQ",33,0)
 S ACK(7)=VAIN(5),ACK(8)=$P(VAIN(3),U,2),ACK(9)=$P(VAEL(1),U,2)
"RTN","ACKQNQ",34,0)
 ;
"RTN","ACKQNQ",35,0)
 ;
"RTN","ACKQNQ",36,0)
PRINT W:$E(IOST,1,2)="C-" @IOF
"RTN","ACKQNQ",37,0)
 D CNTR^ACKQUTL("Patient Inquiry")
"RTN","ACKQNQ",38,0)
 ;
"RTN","ACKQNQ",39,0)
 W !!
"RTN","ACKQNQ",40,0)
 W "PATIENT: ",ACK(1),?45,"DOB: ",ACK(2),?63,"SSN: ",ACK(3)
"RTN","ACKQNQ",41,0)
 W !,"ELIGIBILITY: ",ACK(9)
"RTN","ACKQNQ",42,0)
 W ?45,"INITIAL VISIT DATE: ",ACKIVD
"RTN","ACKQNQ",43,0)
 W:$L(ACK(4)) !,ACK(4) W !,ACK(5) D:ACKINP INP
"RTN","ACKQNQ",44,0)
 ;
"RTN","ACKQNQ",45,0)
 I $P(VAEL(3),U,1) W !!,"Patient is Service Connected."
"RTN","ACKQNQ",46,0)
 I '$P(VAEL(3),U,1) D
"RTN","ACKQNQ",47,0)
 . S ACKPAT=DFN D STATUS^ACKQUTL4 K VASV
"RTN","ACKQNQ",48,0)
 . D NOT^ACKQUTL7("Patient is not Service Connected.",ACKAO,ACKRAD,ACKENV)
"RTN","ACKQNQ",49,0)
 . K ACKPAT,ACKAO,ACKRAD,ACKENV
"RTN","ACKQNQ",50,0)
 ;
"RTN","ACKQNQ",51,0)
 D RATDIS  G:$G(DIRUT) EXIT
"RTN","ACKQNQ",52,0)
 D ICDSORT,DIAGHIST
"RTN","ACKQNQ",53,0)
 ;
"RTN","ACKQNQ",54,0)
EXIT I $G(ACKVISIT)'="",$G(DIRUT)=1 S ACKDIRUT=1  ;  Quit flag for template
"RTN","ACKQNQ",55,0)
 K %ZIS,ACK,ACKDC,ACKDD,ACKDFN,ACKDN,ACKI,ACKICD,ACKINP,ACKIVD,ACKLINE
"RTN","ACKQNQ",56,0)
 K ACKRD,DIRUT,DTOUT,DUOUT,VA,VADM,VAEL,VAERR,VAIN,X,X1,Y,ZTDESC,ZTIO
"RTN","ACKQNQ",57,0)
 K ZTRTN,ZTSAVE
"RTN","ACKQNQ",58,0)
 I $G(ACKQUIT)=1 D KILL^%ZISS Q
"RTN","ACKQNQ",59,0)
 I $E(IOST,1,2)="C-" W !!,"Press return to continue." R X:DTIME  W @IOF
"RTN","ACKQNQ",60,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","ACKQNQ",61,0)
 S ACKQUIT=0 G DIC
"RTN","ACKQNQ",62,0)
 Q
"RTN","ACKQNQ",63,0)
 ;
"RTN","ACKQNQ",64,0)
EN1 ;  CALL THIS ENTRY POINT INSTEAD OF EN
"RTN","ACKQNQ",65,0)
 D HOME^%ZIS G EN
"RTN","ACKQNQ",66,0)
 ;
"RTN","ACKQNQ",67,0)
 ;
"RTN","ACKQNQ",68,0)
INP ;  PRINT INPATIENT INFO
"RTN","ACKQNQ",69,0)
 W !,"WARD: ",ACK(6),?20,"ROOM/BED: ",ACK(7),?40,"TREATING SPEC: ",$E(ACK(8),1,25)
"RTN","ACKQNQ",70,0)
 Q
"RTN","ACKQNQ",71,0)
 ;
"RTN","ACKQNQ",72,0)
 ;
"RTN","ACKQNQ",73,0)
RATDIS ;  Display Patients RATED DISABILITIES
"RTN","ACKQNQ",74,0)
 Q:'$O(^DPT(DFN,.372,0))
"RTN","ACKQNQ",75,0)
 N ACKRD,RC,X,X1
"RTN","ACKQNQ",76,0)
 D ENS^%ZISS
"RTN","ACKQNQ",77,0)
 ;---
"RTN","ACKQNQ",78,0)
 S RC=$$PAGE(5)  Q:RC<0  W:'RC !!
"RTN","ACKQNQ",79,0)
 W IOUON,"Rated Disabilities",IOUOFF,!
"RTN","ACKQNQ",80,0)
 ;---
"RTN","ACKQNQ",81,0)
 S ACKRD=0
"RTN","ACKQNQ",82,0)
 F  S ACKRD=$O(^DPT(DFN,.372,ACKRD))  Q:'ACKRD  D  Q:RC<0
"RTN","ACKQNQ",83,0)
 . S RC=$$PAGE(2)  Q:RC<0
"RTN","ACKQNQ",84,0)
 . W:RC IOUON,"Rated Disabilities (cont'd)",IOUOFF,!
"RTN","ACKQNQ",85,0)
 . S X=^DPT(DFN,.372,ACKRD,0),X1=$P(^DIC(31,+X,0),U)
"RTN","ACKQNQ",86,0)
 . W !,X1_"  ("_$P(X,U,2)_"%)"  I $P(X,U,3) W "  (SC)"
"RTN","ACKQNQ",87,0)
 Q
"RTN","ACKQNQ",88,0)
 ;
"RTN","ACKQNQ",89,0)
DIAGHIST ;
"RTN","ACKQNQ",90,0)
 Q:$D(ACKICD)<10
"RTN","ACKQNQ",91,0)
 N ACKI,RC
"RTN","ACKQNQ",92,0)
 D ENS^%ZISS
"RTN","ACKQNQ",93,0)
 ;---
"RTN","ACKQNQ",94,0)
 S RC=$$PAGE(7)  Q:RC<0  W:'RC !!
"RTN","ACKQNQ",95,0)
 W IOUON,"Patient Diagnostic History",IOUOFF
"RTN","ACKQNQ",96,0)
 W !,$S($P(VADM(5),U)="F":"Ms. ",1:"Mr. "),$P(VADM(1),",")," has been seen for the following:",!
"RTN","ACKQNQ",97,0)
 D DIHEAD
"RTN","ACKQNQ",98,0)
 ;---
"RTN","ACKQNQ",99,0)
 S ACKI=""
"RTN","ACKQNQ",100,0)
 F  S ACKI=$O(ACKICD(ACKI))  Q:ACKI=""  D  Q:RC<0
"RTN","ACKQNQ",101,0)
 . S RC=$$PAGE(2)  Q:RC<0
"RTN","ACKQNQ",102,0)
 . I RC  D  D DIHEAD
"RTN","ACKQNQ",103,0)
 . . W IOUON,"Patient Diagnostic History (cont'd)","  (",ACK(1),")",IOUOFF,!
"RTN","ACKQNQ",104,0)
 . W !,$P(ACKICD(ACKI),U),?15,$P(ACKICD(ACKI),U,3)
"RTN","ACKQNQ",105,0)
 . W ?60,$$NUMDT^ACKQUTL($P(ACKICD(ACKI),U,4))
"RTN","ACKQNQ",106,0)
 Q
"RTN","ACKQNQ",107,0)
 ;
"RTN","ACKQNQ",108,0)
 ;
"RTN","ACKQNQ",109,0)
CLASDIS ;  Display Patient Servive Classifications
"RTN","ACKQNQ",110,0)
 N RC
"RTN","ACKQNQ",111,0)
 I '$D(ACKQSER),'$D(ACKQORG),'$D(ACKQIR),'$D(ACKQECON) Q
"RTN","ACKQNQ",112,0)
 S RC=$$PAGE(5)  Q:RC<0  W:'RC !!
"RTN","ACKQNQ",113,0)
 D ENS^%ZISS
"RTN","ACKQNQ",114,0)
 W IOUON,"Service Classifications",IOUOFF,!
"RTN","ACKQNQ",115,0)
 W:$D(ACKQSER) " SERVICE-CONNECTED " W:$D(ACKQORG) " AGENT-ORANGE " W:$D(ACKQIR) " RADIATION " W:$D(ACKQECON) " ENVIRONMENTAL-CONTAMINANTS"
"RTN","ACKQNQ",116,0)
 W !
"RTN","ACKQNQ",117,0)
 Q
"RTN","ACKQNQ",118,0)
 ;
"RTN","ACKQNQ",119,0)
 ;
"RTN","ACKQNQ",120,0)
DIHEAD W !,"DIAGNOSIS",?60,"DATE ENTERED",!,$$REPEAT^XLFSTR("-",IOM-1)
"RTN","ACKQNQ",121,0)
 Q
"RTN","ACKQNQ",122,0)
 ;
"RTN","ACKQNQ",123,0)
 ;
"RTN","ACKQNQ",124,0)
ICDSORT S ACKI=0 F  S ACKI=$O(^ACK(509850.2,DFN,1,ACKI)) Q:'ACKI  D
"RTN","ACKQNQ",125,0)
 . N ACKARY,ACKDD
"RTN","ACKQNQ",126,0)
 . S ACKDC=^ACK(509850.2,DFN,1,ACKI,0),ACKDD=$P(ACKDC,U,2)
"RTN","ACKQNQ",127,0)
 . ;ACKQ*3.0*22 updated api
"RTN","ACKQNQ",128,0)
 . N ACKTGT S ACKTGT=$$ICDDX^ICDCODE(+ACKDC)
"RTN","ACKQNQ",129,0)
 . S ACKDN=$P(ACKTGT,U,2)
"RTN","ACKQNQ",130,0)
 . S ACKARY=$P($$ICDDX^ICDCODE(ACKDN,ACKDD),"^",4)
"RTN","ACKQNQ",131,0)
 . S ACKICD(ACKDN)=ACKDN_U_$P(ACKTGT,U,3)_U_ACKARY_U_ACKDD
"RTN","ACKQNQ",132,0)
 Q
"RTN","ACKQNQ",133,0)
 ;
"RTN","ACKQNQ",134,0)
UPDATE ;  Update patient's diagnostic history in 509850.2.
"RTN","ACKQNQ",135,0)
 ;  ACKDFN is defined upon entry to this module.
"RTN","ACKQNQ",136,0)
 D WAIT^DICD W !
"RTN","ACKQNQ",137,0)
 D PROBLIST^ACKQUTL3(ACKDFN,1)
"RTN","ACKQNQ",138,0)
 Q
"RTN","ACKQNQ",139,0)
 ;
"RTN","ACKQNQ",140,0)
 ;***** CHECKS IS NEW PAGE SHOULD BE STARTED
"RTN","ACKQNQ",141,0)
 ;
"RTN","ACKQNQ",142,0)
 ; [RESERVE]     Number of additional reserved lines (0, by default).
"RTN","ACKQNQ",143,0)
 ;               If the current page does not have so many lines
"RTN","ACKQNQ",144,0)
 ;               available, a new page will be started.
"RTN","ACKQNQ",145,0)
 ;
"RTN","ACKQNQ",146,0)
 ; [FORCE]       Force the prompt
"RTN","ACKQNQ",147,0)
 ;
"RTN","ACKQNQ",148,0)
 ; Return values:
"RTN","ACKQNQ",149,0)
 ;
"RTN","ACKQNQ",150,0)
 ;       -2  Timeout
"RTN","ACKQNQ",151,0)
 ;       -1  User canceled the output ('^' was entered)
"RTN","ACKQNQ",152,0)
 ;        0  Ok
"RTN","ACKQNQ",153,0)
 ;        1  New page
"RTN","ACKQNQ",154,0)
 ;
"RTN","ACKQNQ",155,0)
PAGE(RESERVE,FORCE) ;
"RTN","ACKQNQ",156,0)
 N RC
"RTN","ACKQNQ",157,0)
 I ($Y'<($G(IOSL,24)-$G(RESERVE,1)))!$G(FORCE)  D  S $Y=0
"RTN","ACKQNQ",158,0)
 . I $E(IOST,1,2)'="C-"  W @IOF  Q
"RTN","ACKQNQ",159,0)
 . N DA,DIR,DIROUT,DTOUT,DUOUT,I,X,Y
"RTN","ACKQNQ",160,0)
 . S DIR(0)="E"
"RTN","ACKQNQ",161,0)
 . D ^DIR
"RTN","ACKQNQ",162,0)
 . S RC=$S($D(DUOUT):-1,$D(DTOUT):-2,1:1)
"RTN","ACKQNQ",163,0)
 . W:RC>0 @IOF
"RTN","ACKQNQ",164,0)
 Q +$G(RC)
"RTN","ACKQR2")
0^5^B84001886^B80557034
"RTN","ACKQR2",1,0)
ACKQR2 ;AUG/JLTP BIR/PTD HCIOFO/AG -Statistics by Procedure ; [ 12/07/95   9:52 AM ]
"RTN","ACKQR2",2,0)
 ;;3.0;QUASAR;**1,8,22**;Feb 11, 2000;Build 5
"RTN","ACKQR2",3,0)
 ;Per VHA Directive 2004-038, this routine SHOULD NOT be modified.
"RTN","ACKQR2",4,0)
 ;
"RTN","ACKQR2",5,0)
 ;
"RTN","ACKQR2",6,0)
 ;
"RTN","ACKQR2",7,0)
 ;  Reference/ICR
"RTN","ACKQR2",8,0)
 ;  $$CPT^ICPTMOD - 1995
"RTN","ACKQR2",9,0)
 ;
"RTN","ACKQR2",10,0)
 ;
"RTN","ACKQR2",11,0)
OPTN W @IOF,!,"This option produces a report listing clinic visits for a date range"
"RTN","ACKQR2",12,0)
 W !,"sorted by CPT-4 procedure codes.",!
"RTN","ACKQR2",13,0)
 ;
"RTN","ACKQR2",14,0)
 S ACKDIV=$$DIV^ACKQUTL2(3,.ACKDIV,"AI") G:+ACKDIV=0 EXIT
"RTN","ACKQR2",15,0)
 ; Date's
"RTN","ACKQR2",16,0)
 D DTRANGE^ACKQRU G:$D(DIRUT) EXIT
"RTN","ACKQR2",17,0)
 S ACKRDR="Visits from "_ACKXBD_" to "_ACKXED
"RTN","ACKQR2",18,0)
 ; 
"RTN","ACKQR2",19,0)
 ; Type of report: Returns-
"RTN","ACKQR2",20,0)
 ; ACKASB="A","S","O" or a combo, ACKSS=1-6 (1=one clinician etc)
"RTN","ACKQR2",21,0)
 ; ACKSTF(x) selected staff members
"RTN","ACKQR2",22,0)
 D PARAMS^ACKQRU G:$D(DIRUT) EXIT
"RTN","ACKQR2",23,0)
 ;
"RTN","ACKQR2",24,0)
DEV W !!,"The right margin for this report is 80."
"RTN","ACKQR2",25,0)
 W !,"You can queue it to run at a later time.",!
"RTN","ACKQR2",26,0)
 K %ZIS,IOP S %ZIS="QM",%ZIS("B")="" D ^%ZIS
"RTN","ACKQR2",27,0)
 I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED." G EXIT
"RTN","ACKQR2",28,0)
 ; Queue selected
"RTN","ACKQR2",29,0)
 I $D(IO("Q")) D  G EXIT
"RTN","ACKQR2",30,0)
 . K IO("Q")
"RTN","ACKQR2",31,0)
 . S ZTRTN="DQ^ACKQR2",ZTDESC="QUASAR - A&SP PROCEDURE STATISTICS"
"RTN","ACKQR2",32,0)
 . S ZTSAVE("ACK*")="" D ^%ZTLOAD D HOME^%ZIS K ZTSK
"RTN","ACKQR2",33,0)
 ;
"RTN","ACKQR2",34,0)
DQ ; Queued entry
"RTN","ACKQR2",35,0)
 ; Vars required :-
"RTN","ACKQR2",36,0)
 ; ACKDIV() - selected divs, ACKBD,ACKXBD - beginning date range (int,ext)
"RTN","ACKQR2",37,0)
 ; ACKED,ACKXED - end date range (int, ext)
"RTN","ACKQR2",38,0)
 ; ACKASB - A=audio,S=speech,O=other,ASO=all three
"RTN","ACKQR2",39,0)
 ; ACKSS - type of report (1=one clinician etc),  ACKSTF(x) - selected prvds
"RTN","ACKQR2",40,0)
 U IO
"RTN","ACKQR2",41,0)
 D NOW^%DTC S ACKCDT=$$NUMDT^ACKQUTL(%)_" at "_$$FTIME^ACKQUTL(%),ACKPG=0
"RTN","ACKQR2",42,0)
 K ^TMP("ACKQR2",$J),ACKT,ACKT2 S ACKT2=0
"RTN","ACKQR2",43,0)
 ; $O thru visit file using date index
"RTN","ACKQR2",44,0)
 F ACKD=ACKBD:0 S ACKD=$O(^ACK(509850.6,"B",ACKD)) Q:'ACKD!(ACKD>ACKED)  D
"RTN","ACKQR2",45,0)
 . S ACKV=0 F  S ACKV=$O(^ACK(509850.6,"B",ACKD,ACKV)) Q:'ACKV  D STORE
"RTN","ACKQR2",46,0)
 D PRINT
"RTN","ACKQR2",47,0)
 ;
"RTN","ACKQR2",48,0)
EXIT ; 1 way out
"RTN","ACKQR2",49,0)
 K ACK2,ACKASB,ACKBD,ACKC,ACKCDT,ACKCL,ACKCLI,ACKCLN,ACKCLNC,ACKCPT
"RTN","ACKQR2",50,0)
 K ACKSORT,ACKD,ACKED,ACKHDR2,ACKI,ACKLINE,ACKLR,ACKOOP,ACKP,ACKPC
"RTN","ACKQR2",51,0)
 K ACKPCP,ACKPG,ACKRDR,ACKSS,ACKSTAFF,ACKSTF,ACKT,ACKV,ACKVSC,ACKXBD
"RTN","ACKQR2",52,0)
 K ACKXED,ACKT2,ACKCT,ACKVDIV,ACKOK,ACKHDR,ACKDIV,ACKHDR5,ACKSORT
"RTN","ACKQR2",53,0)
 K ACKCPTN,ACKVOL,ACKTXT,ACKQUIT,ZTSAVE,ZTSK,^TMP("ACKQR2",$J)
"RTN","ACKQR2",54,0)
 K %DT,%I,%ZIS,%T,DIRUT,DTOUT,DUOUT,I,JJ,SS,X,Y,ZTDESC,ZTIO,ZTRTN
"RTN","ACKQR2",55,0)
 W:$E(IOST)="C" @IOF D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","ACKQR2",56,0)
 Q
"RTN","ACKQR2",57,0)
STORE ;
"RTN","ACKQR2",58,0)
 S ACKHDR=^ACK(509850.6,ACKV,0),ACKHDR5=^ACK(509850.6,ACKV,5)
"RTN","ACKQR2",59,0)
 ; Get div,make sure it was selected
"RTN","ACKQR2",60,0)
 S ACKVDIV=$P(ACKHDR5,U,1)
"RTN","ACKQR2",61,0)
 I '$D(ACKDIV(ACKVDIV)) Q
"RTN","ACKQR2",62,0)
 ;
"RTN","ACKQR2",63,0)
 S ACKCLNC=+$P(ACKHDR,U,6) ; clinic IEN
"RTN","ACKQR2",64,0)
 Q:'ACKCLNC
"RTN","ACKQR2",65,0)
 S ACK2=$G(^ACK(509850.6,ACKV,2))
"RTN","ACKQR2",66,0)
 S ACKVSC=$P(ACK2,U) ; clinic stp code
"RTN","ACKQR2",67,0)
 ; Determine sort order for visit stp code (will return zero if
"RTN","ACKQR2",68,0)
 ; the visit isnt to be included in report
"RTN","ACKQR2",69,0)
 S ACKSORT=$$STOPSORT^ACKQRU(ACKASB,ACKVSC) Q:'ACKSORT
"RTN","ACKQR2",70,0)
 ;
"RTN","ACKQR2",71,0)
 ; Check stff member for report
"RTN","ACKQR2",72,0)
 I (ACKSS=3)!(ACKSS=6) S ACKLR=$P(ACK2,U,4)  Q:ACKLR=""  Q:'$D(ACKSTF(ACKLR))
"RTN","ACKQR2",73,0)
 ;
"RTN","ACKQR2",74,0)
 ; Count the proc codes for visit
"RTN","ACKQR2",75,0)
 S ACKP=0 F  S ACKP=$O(^ACK(509850.6,ACKV,3,ACKP)) Q:'ACKP  D
"RTN","ACKQR2",76,0)
 . S ACKQQPN=$$GET1^DIQ(509850.61,ACKP_","_ACKV_",",.07,"I","","")
"RTN","ACKQR2",77,0)
 . I ACKQQPN'="" Q  ;  Has a Pointer to EC code therefore created by EC
"RTN","ACKQR2",78,0)
 . S ACKCPTN=$$GET1^DIQ(509850.61,ACKP_","_ACKV_",",.01,"I","","")
"RTN","ACKQR2",79,0)
 . S ACKVOL=$$GET1^DIQ(509850.61,ACKP_","_ACKV_",",.03,"I","","")
"RTN","ACKQR2",80,0)
 . S:ACKVOL<1 ACKVOL=1
"RTN","ACKQR2",81,0)
 . S ACKQUIT=0
"RTN","ACKQR2",82,0)
 . I ACKSS'=3,ACKSS'=6 D  Q:ACKQUIT
"RTN","ACKQR2",83,0)
 . . S ACKLR=$$GET1^DIQ(509850.61,ACKP_","_ACKV_",",.05,"I","","")
"RTN","ACKQR2",84,0)
 . . I ACKLR="" S ACKLR=$$LEADROLE^ACKQUTL2(ACKV)
"RTN","ACKQR2",85,0)
 . . I ACKLR="" S ACKQUIT=1
"RTN","ACKQR2",86,0)
 . . I '$D(ACKSTF(ACKLR)) S ACKQUIT=1
"RTN","ACKQR2",87,0)
 . ;
"RTN","ACKQR2",88,0)
 . I '$D(^TMP("ACKQR2",$J,"CPT",1,81,ACKCPTN_",")) D GETCPT(ACKCPTN)
"RTN","ACKQR2",89,0)
 . S ACKCPT=^TMP("ACKQR2",$J,"CPT",1,81,ACKCPTN_",",.01)
"RTN","ACKQR2",90,0)
 . I ACKCPT="" Q
"RTN","ACKQR2",91,0)
 . ; Add to cnt of procs for stff member
"RTN","ACKQR2",92,0)
 . S ACKCT=+$G(^TMP("ACKQR2",$J,1,ACKVDIV,ACKSORT,ACKCLNC,ACKLR,ACKCPT))
"RTN","ACKQR2",93,0)
 . S ^TMP("ACKQR2",$J,1,ACKVDIV,ACKSORT,ACKCLNC,ACKLR,ACKCPT)=ACKCT+ACKVOL
"RTN","ACKQR2",94,0)
 . ; Add to cnt of procs for the stp code within div
"RTN","ACKQR2",95,0)
 . S ^TMP("ACKQR2",$J,0,ACKVDIV,ACKSORT,ACKCPT)=$G(^TMP("ACKQR2",$J,0,ACKVDIV,ACKSORT,ACKCPT))+ACKVOL
"RTN","ACKQR2",96,0)
 . ; Add to cnt of procs for all divs
"RTN","ACKQR2",97,0)
 . S ^TMP("ACKQR2",$J,2,ACKSORT,ACKCPT)=$G(^TMP("ACKQR2",$J,2,ACKSORT,ACKCPT))+ACKVOL
"RTN","ACKQR2",98,0)
 . ; Add to tot cnt for the stp code, the div & grand tot
"RTN","ACKQR2",99,0)
 . S ACKT(ACKVDIV,ACKSORT)=$G(ACKT(ACKVDIV,ACKSORT))+ACKVOL
"RTN","ACKQR2",100,0)
 . S ACKT(ACKVDIV)=$G(ACKT(ACKVDIV))+ACKVOL
"RTN","ACKQR2",101,0)
 . S ACKT2(ACKSORT)=$G(ACKT2(ACKSORT))+ACKVOL,ACKT2=ACKT2+ACKVOL
"RTN","ACKQR2",102,0)
 Q
"RTN","ACKQR2",103,0)
GETCPT(ACKCPTN) ; Get Proc code data & put in ^TMP
"RTN","ACKQR2",104,0)
 N ACKCPT
"RTN","ACKQR2",105,0)
 ;ACKQ*3.0*22 updated api
"RTN","ACKQR2",106,0)
 S ^TMP("ACKQR2",$J,"CPT",1,81,ACKCPTN_",",.01)=$P($$CPT^ICPTCOD(ACKCPTN),U,2)
"RTN","ACKQR2",107,0)
 S ACKCPT=^TMP("ACKQR2",$J,"CPT",1,81,ACKCPTN_",",.01)
"RTN","ACKQR2",108,0)
 S ^TMP("ACKQR2",$J,"CPT",1,81,ACKCPTN_",",2)=$$PROCTXT^ACKQUTL8(ACKCPTN,"")
"RTN","ACKQR2",109,0)
 S ^TMP("ACKQR2",$J,"CPT",2,ACKCPT)=ACKCPTN
"RTN","ACKQR2",110,0)
 Q
"RTN","ACKQR2",111,0)
CPTDESC(ACKCPT) ; Get Proc desc
"RTN","ACKQR2",112,0)
 N ACKCPTN S ACKCPTN=^TMP("ACKQR2",$J,"CPT",2,ACKCPT)
"RTN","ACKQR2",113,0)
 Q ^TMP("ACKQR2",$J,"CPT",1,81,ACKCPTN_",",2)
"RTN","ACKQR2",114,0)
 ;
"RTN","ACKQR2",115,0)
PRINT ; print report 4 each div
"RTN","ACKQR2",116,0)
 S ACKVDIV=""
"RTN","ACKQR2",117,0)
 I '$D(^TMP("ACKQR2",$J,1)) D  Q
"RTN","ACKQR2",118,0)
 . D HDR
"RTN","ACKQR2",119,0)
 . W !!,"No data found for report specifications.",!!
"RTN","ACKQR2",120,0)
 . D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)
"RTN","ACKQR2",121,0)
 F  S ACKVDIV=$O(ACKDIV(ACKVDIV)) Q:ACKVDIV=""!($D(DIRUT))  D PRINT2 Q:$D(DIRUT)
"RTN","ACKQR2",122,0)
 I '$D(DIRUT) D TOTALS
"RTN","ACKQR2",123,0)
 Q
"RTN","ACKQR2",124,0)
 ;
"RTN","ACKQR2",125,0)
PRINT2 ; print for single div
"RTN","ACKQR2",126,0)
 I '$D(^TMP("ACKQR2",$J,1,ACKVDIV)) D  Q
"RTN","ACKQR2",127,0)
 . D HDR
"RTN","ACKQR2",128,0)
 . W !!,"No data found for report specifications.",!!
"RTN","ACKQR2",129,0)
 . D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)
"RTN","ACKQR2",130,0)
 D HDR
"RTN","ACKQR2",131,0)
 S ACKSORT=""
"RTN","ACKQR2",132,0)
 F  S ACKSORT=$O(^TMP("ACKQR2",$J,1,ACKVDIV,ACKSORT)) Q:(ACKSORT="")!($D(DIRUT))  D
"RTN","ACKQR2",133,0)
 .I $Y>(IOSL-9) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D HDR
"RTN","ACKQR2",134,0)
 .W !!,"STOP CODE: ",$$STOPNM^ACKQRU(ACKSORT)
"RTN","ACKQR2",135,0)
 .S ACKCLN="" F  S ACKCLN=$O(^TMP("ACKQR2",$J,1,ACKVDIV,ACKSORT,ACKCLN)) Q:ACKCLN=""!($D(DIRUT))  D
"RTN","ACKQR2",136,0)
 ..I $Y>(IOSL-7) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D HDR
"RTN","ACKQR2",137,0)
 ..W !!?2,"CLINIC: ",$$GET1^DIQ(44,ACKCLN_",",.01)
"RTN","ACKQR2",138,0)
 ..S ACKSTF=""
"RTN","ACKQR2",139,0)
 ..F  S ACKSTF=$O(^TMP("ACKQR2",$J,1,ACKVDIV,ACKSORT,ACKCLN,ACKSTF)) Q:ACKSTF=""!($D(DIRUT))  D
"RTN","ACKQR2",140,0)
 ...I $Y>(IOSL-5) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D HDR
"RTN","ACKQR2",141,0)
 ...W !!?2,$S("1^4"[ACKSS:"CLINICIAN: ","2^5"[ACKSS:"OTHER PROVIDER: ",1:"STUDENT: ")
"RTN","ACKQR2",142,0)
 ...W $$CONVERT^ACKQUTL4(ACKSTF)
"RTN","ACKQR2",143,0)
 ...S ACKCPT=""
"RTN","ACKQR2",144,0)
 ...F  S ACKCPT=$O(^TMP("ACKQR2",$J,1,ACKVDIV,ACKSORT,ACKCLN,ACKSTF,ACKCPT)) Q:(ACKCPT="")!($D(DIRUT))  D
"RTN","ACKQR2",145,0)
 ....I $Y>(IOSL-3) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D HDR
"RTN","ACKQR2",146,0)
 ....W !?5,ACKCPT,?15,$$CPTDESC(ACKCPT),?55,"COUNT: "
"RTN","ACKQR2",147,0)
 ....W $J(^TMP("ACKQR2",$J,1,ACKVDIV,ACKSORT,ACKCLN,ACKSTF,ACKCPT),4)
"RTN","ACKQR2",148,0)
 Q:$D(DIRUT)  D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)
"RTN","ACKQR2",149,0)
SUMM ;
"RTN","ACKQR2",150,0)
 Q:'$D(^TMP("ACKQR2",$J,0))  D SUMHD
"RTN","ACKQR2",151,0)
 S ACKSORT=""
"RTN","ACKQR2",152,0)
 F  S ACKSORT=$O(^TMP("ACKQR2",$J,0,ACKVDIV,ACKSORT)) Q:ACKSORT=""!($D(DIRUT))  D
"RTN","ACKQR2",153,0)
 .I $Y>(IOSL-5) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D SUMHD
"RTN","ACKQR2",154,0)
 .W !!,"STOP CODE: ",$$STOPNM^ACKQRU(ACKSORT)
"RTN","ACKQR2",155,0)
 .S ACKCPT=""
"RTN","ACKQR2",156,0)
 .F  S ACKCPT=$O(^TMP("ACKQR2",$J,0,ACKVDIV,ACKSORT,ACKCPT)) Q:(ACKCPT="")!($D(DIRUT))  D
"RTN","ACKQR2",157,0)
 ..I $Y>(IOSL-3) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D SUMHD
"RTN","ACKQR2",158,0)
 ..W !?5,ACKCPT,?15,$$CPTDESC(ACKCPT),?55,"COUNT: "
"RTN","ACKQR2",159,0)
 ..W $J(^TMP("ACKQR2",$J,0,ACKVDIV,ACKSORT,ACKCPT),4)
"RTN","ACKQR2",160,0)
 .Q:$D(DIRUT)  I $Y>(IOSL-4) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D SUMHD
"RTN","ACKQR2",161,0)
 .Q:$D(DIRUT)
"RTN","ACKQR2",162,0)
 .W !!,"Total For ",$$STOPNM^ACKQRU(ACKSORT)
"RTN","ACKQR2",163,0)
 .W ?62,$J(ACKT(ACKVDIV,ACKSORT),4)
"RTN","ACKQR2",164,0)
 Q:$D(DIRUT)  I $Y>(IOSL-4) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D SUMHD
"RTN","ACKQR2",165,0)
 Q:$D(DIRUT)  W !!,"Total For Division: "_$$DIVNAME(ACKVDIV),?62,$J(ACKT(ACKVDIV),4)
"RTN","ACKQR2",166,0)
 Q:$D(DIRUT)  D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)
"RTN","ACKQR2",167,0)
 Q
"RTN","ACKQR2",168,0)
 ;
"RTN","ACKQR2",169,0)
TOTALS ; Print final page of tots 4 all divs
"RTN","ACKQR2",170,0)
 Q:'$D(^TMP("ACKQR2",$J,2))
"RTN","ACKQR2",171,0)
 Q:$D(DIRUT)
"RTN","ACKQR2",172,0)
 I $O(ACKT(""))=$O(ACKT(""),-1) Q  ; Must be only one div
"RTN","ACKQR2",173,0)
 D TOTLHD S ACKTXT="DIVISIONS: "
"RTN","ACKQR2",174,0)
 S ACKVDIV="" F  S ACKVDIV=$O(ACKT(ACKVDIV)) Q:ACKVDIV=""  D  Q:$D(DIRUT)
"RTN","ACKQR2",175,0)
 . I $Y>(IOSL-3) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D TOTLHD
"RTN","ACKQR2",176,0)
 . W !,ACKTXT,?12,$$DIVNAME(ACKVDIV) S ACKTXT=""
"RTN","ACKQR2",177,0)
 S ACKSORT=""
"RTN","ACKQR2",178,0)
 F  S ACKSORT=$O(^TMP("ACKQR2",$J,2,ACKSORT)) Q:ACKSORT=""!($D(DIRUT))  D
"RTN","ACKQR2",179,0)
 . I $Y>(IOSL-5) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D TOTLHD
"RTN","ACKQR2",180,0)
 . W !!,"STOP CODE: ",$$STOPNM^ACKQRU(ACKSORT)
"RTN","ACKQR2",181,0)
 . S ACKCPT=""
"RTN","ACKQR2",182,0)
 . F  S ACKCPT=$O(^TMP("ACKQR2",$J,2,ACKSORT,ACKCPT)) Q:(ACKCPT="")!($D(DIRUT))  D
"RTN","ACKQR2",183,0)
 . . I $Y>(IOSL-3) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D TOTLHD
"RTN","ACKQR2",184,0)
 . . W !?5,ACKCPT,?15,$$CPTDESC(ACKCPT),?55,"COUNT: "
"RTN","ACKQR2",185,0)
 . . W $J(^TMP("ACKQR2",$J,2,ACKSORT,ACKCPT),4)
"RTN","ACKQR2",186,0)
 . I $Y>(IOSL-4) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D TOTLHD
"RTN","ACKQR2",187,0)
 . Q:$D(DIRUT)
"RTN","ACKQR2",188,0)
 . W !!,"Total For ",$$STOPNM^ACKQRU(ACKSORT)
"RTN","ACKQR2",189,0)
 . W ?62,$J(ACKT2(ACKSORT),4)
"RTN","ACKQR2",190,0)
 Q:$D(DIRUT)  I $Y>(IOSL-4) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D TOTLHD
"RTN","ACKQR2",191,0)
 Q:$D(DIRUT)  W !!,"Grand Total:",?62,$J(ACKT2,4)
"RTN","ACKQR2",192,0)
 Q:$D(DIRUT)  D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)
"RTN","ACKQR2",193,0)
 Q
"RTN","ACKQR2",194,0)
HDR ;
"RTN","ACKQR2",195,0)
 W:($E(IOST)="C")!(ACKPG>0) @IOF
"RTN","ACKQR2",196,0)
 S ACKPG=ACKPG+1
"RTN","ACKQR2",197,0)
 W "Printed: ",ACKCDT,?(IOM-8),"Page: ",ACKPG,!
"RTN","ACKQR2",198,0)
 W ! D CNTR^ACKQUTL("Audiology & Speech Pathology")
"RTN","ACKQR2",199,0)
 W ! D CNTR^ACKQUTL("Procedure Statistics")
"RTN","ACKQR2",200,0)
 W ! D CNTR^ACKQUTL("for")
"RTN","ACKQR2",201,0)
 I ACKSS<4 S X=$$STAFFNM($O(ACKSTF(0))) W ! D CNTR^ACKQUTL(X)
"RTN","ACKQR2",202,0)
 I ACKSS=4 W ! D CNTR^ACKQUTL("All Clinicians")
"RTN","ACKQR2",203,0)
 I ACKSS=5 W ! D CNTR^ACKQUTL("All Other Providers")
"RTN","ACKQR2",204,0)
 I ACKSS=6 W ! D CNTR^ACKQUTL("All Students")
"RTN","ACKQR2",205,0)
 W ! D CNTR^ACKQUTL("Covering "_ACKRDR)
"RTN","ACKQR2",206,0)
 I ACKVDIV]"" W ! D CNTR^ACKQUTL("For Division: "_$$DIVNAME(ACKVDIV))
"RTN","ACKQR2",207,0)
 S X="",$P(X,"-",IOM)="-" W !,X
"RTN","ACKQR2",208,0)
 Q
"RTN","ACKQR2",209,0)
SUMHD ;
"RTN","ACKQR2",210,0)
 W:($E(IOST)="C")!(ACKPG>0) @IOF
"RTN","ACKQR2",211,0)
 S ACKPG=ACKPG+1
"RTN","ACKQR2",212,0)
 W "Printed: ",ACKCDT,?(IOM-8),"Page: ",ACKPG,!
"RTN","ACKQR2",213,0)
 W ! D CNTR^ACKQUTL("Audiology & Speech Pathology")
"RTN","ACKQR2",214,0)
 W ! D CNTR^ACKQUTL("Procedure Statistics")
"RTN","ACKQR2",215,0)
 W ! D CNTR^ACKQUTL("For Division: "_$$DIVNAME(ACKVDIV))
"RTN","ACKQR2",216,0)
 W ! D CNTR^ACKQUTL("Summary")
"RTN","ACKQR2",217,0)
 S X="",$P(X,"-",IOM)="-" W !,X
"RTN","ACKQR2",218,0)
 Q
"RTN","ACKQR2",219,0)
 ;
"RTN","ACKQR2",220,0)
TOTLHD W:($E(IOST)="C")!(ACKPG>0) @IOF
"RTN","ACKQR2",221,0)
 S ACKPG=ACKPG+1
"RTN","ACKQR2",222,0)
 W "Printed: ",ACKCDT,?(IOM-8),"Page: ",ACKPG,!
"RTN","ACKQR2",223,0)
 W ! D CNTR^ACKQUTL("Audiology and Speech Pathology")
"RTN","ACKQR2",224,0)
 W ! D CNTR^ACKQUTL("Procedure Statistics")
"RTN","ACKQR2",225,0)
 W ! D CNTR^ACKQUTL("Summary")
"RTN","ACKQR2",226,0)
 S X="",$P(X,"-",IOM)="-" W !,X
"RTN","ACKQR2",227,0)
 Q
"RTN","ACKQR2",228,0)
DIVNAME(ACKVDIV) ; Get div name
"RTN","ACKQR2",229,0)
 Q $$GET1^DIQ(40.8,ACKVDIV_",",.01)
"RTN","ACKQR2",230,0)
STAFFNM(ACKSTF) ; Get staff name
"RTN","ACKQR2",231,0)
 Q $$MIXC^ACKQUTL($$CONVERT^ACKQUTL4(ACKSTF))
"RTN","ACKQR3")
0^6^B79522688^B77560321
"RTN","ACKQR3",1,0)
ACKQR3 ;AUG/JLTP BIR/PTD HCIOFO/AG-Visits by Diagnosis ; [ 03/27/99   10:02 AM ]
"RTN","ACKQR3",2,0)
 ;;3.0;QUASAR;**8,22**;Feb 11, 2000;Build 5
"RTN","ACKQR3",3,0)
 ;Per VHA Directive 2004-038, this routine SHOULD NOT be modified.
"RTN","ACKQR3",4,0)
 ;
"RTN","ACKQR3",5,0)
 ;  Reference/ICR
"RTN","ACKQR3",6,0)
 ;  $$ICDDX^ICDCODE - 3990
"RTN","ACKQR3",7,0)
 ;
"RTN","ACKQR3",8,0)
 ;
"RTN","ACKQR3",9,0)
OPTN ;Introduce option.
"RTN","ACKQR3",10,0)
 W @IOF,!,"This option produces a report listing clinic visits for a date range"
"RTN","ACKQR3",11,0)
 W !,"sorted by ICD-9CM diagnostic codes.",!
"RTN","ACKQR3",12,0)
 ;
"RTN","ACKQR3",13,0)
 ; get division
"RTN","ACKQR3",14,0)
 S ACKDIV=$$DIV^ACKQUTL2(3,.ACKDIV,"AI") G:+ACKDIV=0 EXIT
"RTN","ACKQR3",15,0)
 ; get date range
"RTN","ACKQR3",16,0)
 D DTRANGE^ACKQRU G:$D(DIRUT) EXIT
"RTN","ACKQR3",17,0)
 S ACKRDR="Visits from "_ACKXBD_" to "_ACKXED
"RTN","ACKQR3",18,0)
 ;
"RTN","ACKQR3",19,0)
 ; determine the type of report
"RTN","ACKQR3",20,0)
 ;  returns ACKASB="A","S" or "B"
"RTN","ACKQR3",21,0)
 ;          ACKSS=1-6 (1=one clinician etc.)
"RTN","ACKQR3",22,0)
 ;          ACKSTF(x) selected staff members
"RTN","ACKQR3",23,0)
 D PARAMS^ACKQRU G:$D(DIRUT) EXIT
"RTN","ACKQR3",24,0)
 ;
"RTN","ACKQR3",25,0)
DEV ; get device
"RTN","ACKQR3",26,0)
 W !!,"The right margin for this report is 80."
"RTN","ACKQR3",27,0)
 W !,"You can queue it to run at a later time.",!
"RTN","ACKQR3",28,0)
 K %ZIS,IOP S %ZIS="QM",%ZIS("B")="" D ^%ZIS
"RTN","ACKQR3",29,0)
 I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED." G EXIT
"RTN","ACKQR3",30,0)
 ; queue selected
"RTN","ACKQR3",31,0)
 I $D(IO("Q")) D  G EXIT
"RTN","ACKQR3",32,0)
 . K IO("Q")
"RTN","ACKQR3",33,0)
 . S ZTRTN="DQ^ACKQR3",ZTDESC="QUASAR - A&SP VISITS BY DIAGNOSIS"
"RTN","ACKQR3",34,0)
 . S ZTSAVE("ACK*")="" D ^%ZTLOAD D HOME^%ZIS K ZTSK
"RTN","ACKQR3",35,0)
 ;
"RTN","ACKQR3",36,0)
DQ ;Entry point when queued.
"RTN","ACKQR3",37,0)
 ;  variables required at this point are:-
"RTN","ACKQR3",38,0)
 ;   ACKDIV() - selected divisions
"RTN","ACKQR3",39,0)
 ;   ACKBD,ACKXBD - beginning of date range (internal,external)
"RTN","ACKQR3",40,0)
 ;   ACKED,ACKXED - end of date range (internal,external)
"RTN","ACKQR3",41,0)
 ;   ACKASB - A=audio,S=speech,B=both
"RTN","ACKQR3",42,0)
 ;   ACKSS - type of report (1=one clinicians etc)
"RTN","ACKQR3",43,0)
 ;   ACKSTF() - selected clinicians
"RTN","ACKQR3",44,0)
 U IO
"RTN","ACKQR3",45,0)
 D NOW^%DTC S ACKCDT=$$NUMDT^ACKQUTL(%)_" at "_$$FTIME^ACKQUTL(%),ACKPG=0
"RTN","ACKQR3",46,0)
 K ^TMP("ACKQR3",$J),ACKT,ACKT2 S ACKT=0,ACKT2=0
"RTN","ACKQR3",47,0)
 ; walk down the visits using the date index
"RTN","ACKQR3",48,0)
 S ACKD=ACKBD F  S ACKD=$O(^ACK(509850.6,"B",ACKD)) Q:'ACKD!(ACKD>ACKED)  D
"RTN","ACKQR3",49,0)
 . S ACKV=0 F  S ACKV=$O(^ACK(509850.6,"B",ACKD,ACKV)) Q:'ACKV  D STORE
"RTN","ACKQR3",50,0)
 D PRINT
"RTN","ACKQR3",51,0)
 ;
"RTN","ACKQR3",52,0)
EXIT ;ALWAYS EXIT HERE
"RTN","ACKQR3",53,0)
 K ACK2,ACKASB,ACKBD,ACKC,ACKCDT,ACKCL,ACKCLI,ACKCLN,ACKCLNC,ACKCPT
"RTN","ACKQR3",54,0)
 K ACKSORT,ACKD,ACKED,ACKHDR2,ACKI,ACKLINE,ACKLR,ACKOOP,ACKP,ACKPC
"RTN","ACKQR3",55,0)
 K ACKPCP,ACKPG,ACKRDR,ACKSS,ACKSTAFF,ACKSTF,ACKT,ACKV,ACKVSC,ACKXBD
"RTN","ACKQR3",56,0)
 K ACKXED,ACKT2,ACKCT,ACKDIVX,ACKOK,ACKHDR,ACKDIV,ACKHDR5,ACKVDIV
"RTN","ACKQR3",57,0)
 K ACKSORT,ACKICDN,ACKTMP,ACKICD9,ACKTXT
"RTN","ACKQR3",58,0)
 K %DT,%I,%ZIS,%T,DIRUT,DTOUT,DUOUT,I,JJ,SS,X,Y,ZTDESC,ZTIO,ZTRTN
"RTN","ACKQR3",59,0)
 K ZTSAVE,ZTSK,^TMP("ACKQR3",$J)
"RTN","ACKQR3",60,0)
 W:$E(IOST)="C" @IOF D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","ACKQR3",61,0)
 Q
"RTN","ACKQR3",62,0)
STORE ;
"RTN","ACKQR3",63,0)
 S ACKHDR=^ACK(509850.6,ACKV,0)
"RTN","ACKQR3",64,0)
 S ACKHDR5=^ACK(509850.6,ACKV,5)
"RTN","ACKQR3",65,0)
 ; get Division and make sure it was selected
"RTN","ACKQR3",66,0)
 S ACKVDIV=+$P(ACKHDR5,U,1)
"RTN","ACKQR3",67,0)
 I '$D(ACKDIV(ACKVDIV)) Q
"RTN","ACKQR3",68,0)
 ;
"RTN","ACKQR3",69,0)
 S ACKCLNC=+$P(ACKHDR,U,6) ;clinic IEN
"RTN","ACKQR3",70,0)
 S ACK2=$G(^ACK(509850.6,ACKV,2))
"RTN","ACKQR3",71,0)
 S ACKVSC=$P(ACK2,U) ; visit stop code
"RTN","ACKQR3",72,0)
 ; determine sort value for visit stop code (will return zero
"RTN","ACKQR3",73,0)
 ;  if the visit is not to be included in the report)
"RTN","ACKQR3",74,0)
 S ACKSORT=$$STOPSORT^ACKQRU(ACKASB,ACKVSC) Q:'ACKSORT
"RTN","ACKQR3",75,0)
 ; check that the staff member for the visit was selected for this report
"RTN","ACKQR3",76,0)
 I (ACKSS=3)!(ACKSS=6) S ACKLR=$P(ACK2,U,4)   ; student
"RTN","ACKQR3",77,0)
 I ACKSS'=3,ACKSS'=6 S ACKLR=$$LEADROLE^ACKQUTL2(ACKV) ; determine lead role
"RTN","ACKQR3",78,0)
 Q:$S(ACKCLNC=0:1,ACKLR="":1,1:0)
"RTN","ACKQR3",79,0)
 Q:'$D(ACKSTF(ACKLR))
"RTN","ACKQR3",80,0)
 ; count the Diagnosis codes for the visit
"RTN","ACKQR3",81,0)
 S ACKP=0 F  S ACKP=$O(^ACK(509850.6,ACKV,1,ACKP)) Q:'ACKP  D
"RTN","ACKQR3",82,0)
 . S ACKICDN=$$GET1^DIQ(509850.63,ACKP_","_ACKV_",",.01,"I","","")
"RTN","ACKQR3",83,0)
 . I '$D(^TMP("ACKQR3",$J,"ICD9",1,80,ACKICDN_",")) D GETDIAG(ACKICDN)
"RTN","ACKQR3",84,0)
 . S X=^TMP("ACKQR3",$J,"ICD9",1,80,ACKICDN_",",.01)
"RTN","ACKQR3",85,0)
 . I X="" Q
"RTN","ACKQR3",86,0)
 . ; add to count of Diagnosis codes for staff member
"RTN","ACKQR3",87,0)
 . S ACKCT=+$G(^TMP("ACKQR3",$J,1,ACKVDIV,ACKSORT,ACKCLNC,ACKLR,X))
"RTN","ACKQR3",88,0)
 . S ^TMP("ACKQR3",$J,1,ACKVDIV,ACKSORT,ACKCLNC,ACKLR,X)=ACKCT+1
"RTN","ACKQR3",89,0)
 . ; add to count of Diagnosis codes for the stop code within the division
"RTN","ACKQR3",90,0)
 . S ^TMP("ACKQR3",$J,0,ACKVDIV,ACKSORT,X)=$G(^TMP("ACKQR3",$J,0,ACKVDIV,ACKSORT,X))+1
"RTN","ACKQR3",91,0)
 . ; add to count of Diagnosis codes totals for all divisions
"RTN","ACKQR3",92,0)
 . S ^TMP("ACKQR3",$J,2,ACKSORT,X)=$G(^TMP("ACKQR3",$J,2,ACKSORT,X))+1
"RTN","ACKQR3",93,0)
 . ; add to the total count for the stop code, division, and the grand total
"RTN","ACKQR3",94,0)
 . S ACKT(ACKVDIV,ACKSORT)=$G(ACKT(ACKVDIV,ACKSORT))+1
"RTN","ACKQR3",95,0)
 . S ACKT(ACKVDIV)=$G(ACKT(ACKVDIV))+1
"RTN","ACKQR3",96,0)
 . S ACKT2(ACKSORT)=$G(ACKT2(ACKSORT))+1,ACKT2=$G(ACKT2)+1
"RTN","ACKQR3",97,0)
 Q
"RTN","ACKQR3",98,0)
GETDIAG(ACKICDN) ; get Diagnosis data and place in ^TMP
"RTN","ACKQR3",99,0)
 ;ACKQ*3.0*22 updated api
"RTN","ACKQR3",100,0)
 N ACKICD9,ACKQDTXT
"RTN","ACKQR3",101,0)
 S ^TMP("ACKQR3",$J,"ICD9",1,80,ACKICDN_",",.01)=$P($$ICDDX^ICDCODE(ACKICDN),U,2)
"RTN","ACKQR3",102,0)
 S ACKICD9=^TMP("ACKQR3",$J,"ICD9",1,80,ACKICDN_",",.01)
"RTN","ACKQR3",103,0)
 S ACKQDTXT=$$DIAGTXT^ACKQUTL8(ACKICDN,"")
"RTN","ACKQR3",104,0)
 S ^TMP("ACKQR3",$J,"ICD9",1,80,ACKICDN_",",3)=ACKQDTXT
"RTN","ACKQR3",105,0)
 S ^TMP("ACKQR3",$J,"ICD9",2,ACKICD9)=ACKICDN
"RTN","ACKQR3",106,0)
 Q
"RTN","ACKQR3",107,0)
ICDDESC(ACKICD9) ; get the description of an ICD9 from the ^TMP file
"RTN","ACKQR3",108,0)
 N ACKICDN S ACKICDN=^TMP("ACKQR3",$J,"ICD9",2,ACKICD9)
"RTN","ACKQR3",109,0)
 Q ^TMP("ACKQR3",$J,"ICD9",1,80,ACKICDN_",",3)
"RTN","ACKQR3",110,0)
 ;
"RTN","ACKQR3",111,0)
PRINT ; print the report for each Division
"RTN","ACKQR3",112,0)
 S ACKVDIV=""
"RTN","ACKQR3",113,0)
 I '$D(^TMP("ACKQR3",$J,1)) D  Q
"RTN","ACKQR3",114,0)
 . D HDR
"RTN","ACKQR3",115,0)
 . W !!,"No data found for report specifications.",!!
"RTN","ACKQR3",116,0)
 . D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)
"RTN","ACKQR3",117,0)
 F  S ACKVDIV=$O(ACKDIV(ACKVDIV)) Q:ACKVDIV=""  D PRINT2 Q:$D(DIRUT)
"RTN","ACKQR3",118,0)
 I '$D(DIRUT) D TOTALS
"RTN","ACKQR3",119,0)
 Q
"RTN","ACKQR3",120,0)
PRINT2 ; print for a single division
"RTN","ACKQR3",121,0)
 I '$D(^TMP("ACKQR3",$J,1,ACKVDIV)) D  Q
"RTN","ACKQR3",122,0)
 . D HDR W !!,"No data found for report specifications.",!!
"RTN","ACKQR3",123,0)
 . D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)
"RTN","ACKQR3",124,0)
 D HDR
"RTN","ACKQR3",125,0)
 S ACKSORT=""
"RTN","ACKQR3",126,0)
 F  S ACKSORT=$O(^TMP("ACKQR3",$J,1,ACKVDIV,ACKSORT)) Q:ACKSORT=""!($D(DIRUT))  D
"RTN","ACKQR3",127,0)
 .I $Y>(IOSL-9) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D HDR
"RTN","ACKQR3",128,0)
 .W !!,"STOP CODE: ",$$STOPNM^ACKQRU(ACKSORT)
"RTN","ACKQR3",129,0)
 .S ACKCLN=""
"RTN","ACKQR3",130,0)
 .F  S ACKCLN=$O(^TMP("ACKQR3",$J,1,ACKVDIV,ACKSORT,ACKCLN)) Q:ACKCLN=""!($D(DIRUT))  D
"RTN","ACKQR3",131,0)
 ..I $Y>(IOSL-7) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D HDR
"RTN","ACKQR3",132,0)
 ..W !!?2,"CLINIC: ",$$GET1^DIQ(44,ACKCLN_",",.01)
"RTN","ACKQR3",133,0)
 ..S ACKSTF=""
"RTN","ACKQR3",134,0)
 ..F  S ACKSTF=$O(^TMP("ACKQR3",$J,1,ACKVDIV,ACKSORT,ACKCLN,ACKSTF)) Q:ACKSTF=""!($D(DIRUT))  D
"RTN","ACKQR3",135,0)
 ...I $Y>(IOSL-5) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D HDR
"RTN","ACKQR3",136,0)
 ...W !!?2,$S("1^4"[ACKSS:"CLINICIAN: ","2^5"[ACKSS:"OTHER PROVIDER: ",1:"STUDENT: ")
"RTN","ACKQR3",137,0)
 ...W $$CONVERT^ACKQUTL4(ACKSTF)
"RTN","ACKQR3",138,0)
 ...S ACKPC=""
"RTN","ACKQR3",139,0)
 ...F  S ACKPC=$O(^TMP("ACKQR3",$J,1,ACKVDIV,ACKSORT,ACKCLN,ACKSTF,ACKPC)) Q:ACKPC=""!($D(DIRUT))  D
"RTN","ACKQR3",140,0)
 ....I $Y>(IOSL-3) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D HDR
"RTN","ACKQR3",141,0)
 ....W !?5,ACKPC,?15,$$ICDDESC(ACKPC),?55,"COUNT: "
"RTN","ACKQR3",142,0)
 ....W $J(^TMP("ACKQR3",$J,1,ACKVDIV,ACKSORT,ACKCLN,ACKSTF,ACKPC),4)
"RTN","ACKQR3",143,0)
 Q:$D(DIRUT)  D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)
"RTN","ACKQR3",144,0)
SUMM ;
"RTN","ACKQR3",145,0)
 Q:'$D(^TMP("ACKQR3",$J,0))  D SUMHD
"RTN","ACKQR3",146,0)
 S ACKSORT=""
"RTN","ACKQR3",147,0)
 F  S ACKSORT=$O(^TMP("ACKQR3",$J,0,ACKVDIV,ACKSORT)) Q:ACKSORT=""!($D(DIRUT))  D
"RTN","ACKQR3",148,0)
 .I $Y>(IOSL-5) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D SUMHD
"RTN","ACKQR3",149,0)
 .W !!,"STOP CODE: ",$$STOPNM^ACKQRU(ACKSORT)
"RTN","ACKQR3",150,0)
 .S ACKPC=""
"RTN","ACKQR3",151,0)
 .F  S ACKPC=$O(^TMP("ACKQR3",$J,0,ACKVDIV,ACKSORT,ACKPC)) Q:ACKPC=""!($D(DIRUT))  D
"RTN","ACKQR3",152,0)
 ..I $Y>(IOSL-3) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D SUMHD
"RTN","ACKQR3",153,0)
 ..W !?5,ACKPC,?15,$$ICDDESC(ACKPC),?55,"COUNT: "
"RTN","ACKQR3",154,0)
 ..W $J(^TMP("ACKQR3",$J,0,ACKVDIV,ACKSORT,ACKPC),4)
"RTN","ACKQR3",155,0)
 .I $Y>(IOSL-4) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D SUMHD
"RTN","ACKQR3",156,0)
 .Q:$D(DIRUT)
"RTN","ACKQR3",157,0)
 .W !!,"Total For ",$$STOPNM^ACKQRU(ACKSORT)
"RTN","ACKQR3",158,0)
 .W ?62,$J(ACKT(ACKVDIV,ACKSORT),4)
"RTN","ACKQR3",159,0)
 I $Y>(IOSL-4) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D SUMHD
"RTN","ACKQR3",160,0)
 Q:$D(DIRUT)  W !!,"Total For Division: "_$$DIVNAME(ACKVDIV),?62,$J(ACKT(ACKVDIV),4)
"RTN","ACKQR3",161,0)
 Q:$D(DIRUT)  D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)
"RTN","ACKQR3",162,0)
 Q
"RTN","ACKQR3",163,0)
TOTALS ; print the final page of totals for all divisions
"RTN","ACKQR3",164,0)
 Q:'$D(^TMP("ACKQR3",$J,2))
"RTN","ACKQR3",165,0)
 I $O(ACKT(""))=$O(ACKT(""),-1) Q  ; there must be only one division!
"RTN","ACKQR3",166,0)
 D TOTLHD S ACKTXT="DIVISIONS: "
"RTN","ACKQR3",167,0)
 S ACKVDIV="" F  S ACKVDIV=$O(ACKT(ACKVDIV)) Q:ACKVDIV=""  D  Q:$D(DIRUT)
"RTN","ACKQR3",168,0)
 . I $Y>(IOSL-3) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D TOTLHD
"RTN","ACKQR3",169,0)
 . W !,ACKTXT,?12,$$DIVNAME(ACKVDIV) S ACKTXT=""
"RTN","ACKQR3",170,0)
 S ACKSORT=""
"RTN","ACKQR3",171,0)
 F  S ACKSORT=$O(^TMP("ACKQR3",$J,2,ACKSORT)) Q:ACKSORT=""!($D(DIRUT))  D
"RTN","ACKQR3",172,0)
 .I $Y>(IOSL-5) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D TOTLHD
"RTN","ACKQR3",173,0)
 .W !!,"STOP CODE: ",$$STOPNM^ACKQRU(ACKSORT)
"RTN","ACKQR3",174,0)
 .S ACKPC=""
"RTN","ACKQR3",175,0)
 .F  S ACKPC=$O(^TMP("ACKQR3",$J,2,ACKSORT,ACKPC)) Q:ACKPC=""!($D(DIRUT))  D
"RTN","ACKQR3",176,0)
 ..I $Y>(IOSL-3) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D TOTLHD
"RTN","ACKQR3",177,0)
 ..W !?5,ACKPC,?15,$$ICDDESC(ACKPC),?55,"COUNT: "
"RTN","ACKQR3",178,0)
 ..W $J(^TMP("ACKQR3",$J,2,ACKSORT,ACKPC),4)
"RTN","ACKQR3",179,0)
 .I $Y>(IOSL-4) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D TOTLHD
"RTN","ACKQR3",180,0)
 .Q:$D(DIRUT)
"RTN","ACKQR3",181,0)
 .W !!,"Total For ",$$STOPNM^ACKQRU(ACKSORT)
"RTN","ACKQR3",182,0)
 .W ?62,$J(ACKT2(ACKSORT),4)
"RTN","ACKQR3",183,0)
 I $Y>(IOSL-4) D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)  D TOTLHD
"RTN","ACKQR3",184,0)
 Q:$D(DIRUT)  W !!,"Grand Total:",?62,$J(ACKT2,4)
"RTN","ACKQR3",185,0)
 Q:$D(DIRUT)  D:$E(IOST)="C" PAUSE^ACKQUTL Q:$D(DIRUT)
"RTN","ACKQR3",186,0)
 Q
"RTN","ACKQR3",187,0)
HDR ;
"RTN","ACKQR3",188,0)
 W:($E(IOST)="C")!(ACKPG>0) @IOF
"RTN","ACKQR3",189,0)
 S ACKPG=ACKPG+1
"RTN","ACKQR3",190,0)
 W "Printed: ",ACKCDT,?(IOM-8),"Page: ",ACKPG,!
"RTN","ACKQR3",191,0)
 W ! D CNTR^ACKQUTL("Audiology & Speech Pathology")
"RTN","ACKQR3",192,0)
 W ! D CNTR^ACKQUTL("Diagnostic Code Statistics")
"RTN","ACKQR3",193,0)
 W ! D CNTR^ACKQUTL("for")
"RTN","ACKQR3",194,0)
 I ACKSS<4 S X=$$STAFFNM($O(ACKSTF(0))) W ! D CNTR^ACKQUTL(X)
"RTN","ACKQR3",195,0)
 I ACKSS=4 W ! D CNTR^ACKQUTL("All Clinicians")
"RTN","ACKQR3",196,0)
 I ACKSS=5 W ! D CNTR^ACKQUTL("All Other Providers")
"RTN","ACKQR3",197,0)
 I ACKSS=6 W ! D CNTR^ACKQUTL("All Students")
"RTN","ACKQR3",198,0)
 W ! D CNTR^ACKQUTL("Covering "_ACKRDR)
"RTN","ACKQR3",199,0)
 I ACKVDIV]"" W ! D CNTR^ACKQUTL("For Division: "_$$DIVNAME(ACKVDIV))
"RTN","ACKQR3",200,0)
 S X="",$P(X,"-",IOM)="-" W !,X
"RTN","ACKQR3",201,0)
 Q
"RTN","ACKQR3",202,0)
SUMHD ;
"RTN","ACKQR3",203,0)
 W:($E(IOST)="C")!(ACKPG>0) @IOF
"RTN","ACKQR3",204,0)
 S ACKPG=ACKPG+1
"RTN","ACKQR3",205,0)
 W "Printed: ",ACKCDT,?(IOM-8),"Page: ",ACKPG,!
"RTN","ACKQR3",206,0)
 W ! D CNTR^ACKQUTL("Audiology & Speech Pathology")
"RTN","ACKQR3",207,0)
 W ! D CNTR^ACKQUTL("Diagnostic Code Statistics")
"RTN","ACKQR3",208,0)
 W ! D CNTR^ACKQUTL("For Division: "_$$DIVNAME(ACKVDIV))
"RTN","ACKQR3",209,0)
 W ! D CNTR^ACKQUTL("Summary")
"RTN","ACKQR3",210,0)
 S X="",$P(X,"-",IOM)="-" W !,X
"RTN","ACKQR3",211,0)
 Q
"RTN","ACKQR3",212,0)
TOTLHD ;
"RTN","ACKQR3",213,0)
 W:($E(IOST)="C")!(ACKPG>0) @IOF
"RTN","ACKQR3",214,0)
 S ACKPG=ACKPG+1
"RTN","ACKQR3",215,0)
 W "Printed: ",ACKCDT,?(IOM-8),"Page: ",ACKPG,!
"RTN","ACKQR3",216,0)
 W ! D CNTR^ACKQUTL("Audiology & Speech Pathology")
"RTN","ACKQR3",217,0)
 W ! D CNTR^ACKQUTL("Diagnostic Code Statistics")
"RTN","ACKQR3",218,0)
 W ! D CNTR^ACKQUTL("Summary")
"RTN","ACKQR3",219,0)
 S X="",$P(X,"-",IOM)="-" W !,X
"RTN","ACKQR3",220,0)
 Q
"RTN","ACKQR3",221,0)
 ;
"RTN","ACKQR3",222,0)
DIVNAME(ACKVDIV) ; get division name
"RTN","ACKQR3",223,0)
 Q $$GET1^DIQ(40.8,ACKVDIV_",",.01)
"RTN","ACKQR3",224,0)
 ;
"RTN","ACKQR3",225,0)
STAFFNM(ACKSTF) ; get staff name
"RTN","ACKQR3",226,0)
 Q $$MIXC^ACKQUTL($$CONVERT^ACKQUTL4(ACKSTF))
"RTN","ACKQR3",227,0)
 ;
"RTN","ACKQUTL4")
0^7^B89569144^B85057049
"RTN","ACKQUTL4",1,0)
ACKQUTL4 ;HCIOFO/BH-NEW/EDIT Visit Template Utilities for QUASAR ; 11/13/08 12:57pm
"RTN","ACKQUTL4",2,0)
 ;;3.0;QUASAR;**1,8,14,17,16,22**;Feb 11, 2000;Build 5
"RTN","ACKQUTL4",3,0)
 ;Per VHA Directive 2004-038, this routine SHOULD NOT be modified.
"RTN","ACKQUTL4",4,0)
 ;
"RTN","ACKQUTL4",5,0)
 ;Reference/IA
"RTN","ACKQUTL4",6,0)
 ;GETCUR^DGNTAPI/3457
"RTN","ACKQUTL4",7,0)
 ;CVEDT^DGCV/4156
"RTN","ACKQUTL4",8,0)
 ;$$ICDDX^ICDCODE - 3990
"RTN","ACKQUTL4",9,0)
 ;$$MOD^ICPTMOD - 1996
"RTN","ACKQUTL4",10,0)
 ;
"RTN","ACKQUTL4",11,0)
CHK(Y,ACKVD) ;
"RTN","ACKQUTL4",12,0)
 N ACKQQD
"RTN","ACKQUTL4",13,0)
 S ACKQQD=$P(^EC(725,Y,0),"^",3) I ACKQQD="" Q 1
"RTN","ACKQUTL4",14,0)
 I ACKVD<ACKQQD Q 1
"RTN","ACKQUTL4",15,0)
 Q 0
"RTN","ACKQUTL4",16,0)
 ;  Clears passed in field # of visit rec.
"RTN","ACKQUTL4",17,0)
CLEAR(ACKVIEN,ACKZNUM) ;
"RTN","ACKQUTL4",18,0)
 N ACKARR
"RTN","ACKQUTL4",19,0)
 S ACKARR(509850.6,ACKVIEN_",",ACKZNUM)=""
"RTN","ACKQUTL4",20,0)
 D FILE^DIE("","ACKARR","")
"RTN","ACKQUTL4",21,0)
 Q
"RTN","ACKQUTL4",22,0)
 ;  Decides if patient is/was suffering from MST at the time of the visit
"RTN","ACKQUTL4",23,0)
MST(ACKPCE,ACKVD,ACKPAT) ;
"RTN","ACKQUTL4",24,0)
 I '$$PATCH^XPDUTL("DG*5.3*308") Q 0
"RTN","ACKQUTL4",25,0)
 I ACKPCE'=1 Q 0
"RTN","ACKQUTL4",26,0)
 N ACKRET,ACKXKEEP
"RTN","ACKQUTL4",27,0)
 S ACKXKEEP=X
"RTN","ACKQUTL4",28,0)
 S ACKRET=$$GETSTAT^DGMSTAPI(ACKPAT,ACKVD)
"RTN","ACKQUTL4",29,0)
 S X=ACKXKEEP
"RTN","ACKQUTL4",30,0)
 I $P(ACKRET,"^",2)="Y" Q 1
"RTN","ACKQUTL4",31,0)
 Q 0
"RTN","ACKQUTL4",32,0)
 ;
"RTN","ACKQUTL4",33,0)
PROB(ACKPCE,ACKDIV) ;  Decides if Update PCE Problem List prompt appears
"RTN","ACKQUTL4",34,0)
 I 'ACKPCE Q 0
"RTN","ACKQUTL4",35,0)
 I '$$GET1^DIQ(509850.83,ACKDIV_",1",".09","I") Q 0
"RTN","ACKQUTL4",36,0)
 Q 1
"RTN","ACKQUTL4",37,0)
 ;
"RTN","ACKQUTL4",38,0)
SETUP ;  Called from within the New/Edit visit template to set up parameters
"RTN","ACKQUTL4",39,0)
 ;
"RTN","ACKQUTL4",40,0)
 D ENS^%ZISS
"RTN","ACKQUTL4",41,0)
 ;
"RTN","ACKQUTL4",42,0)
 I ACKVISIT="EDIT" D
"RTN","ACKQUTL4",43,0)
 . K ACKAR
"RTN","ACKQUTL4",44,0)
 . S ACKAR(509850.6,ACKVIEN_",",.27)=""
"RTN","ACKQUTL4",45,0)
 . D FILE^DIE("K","ACKAR") K ACKAR
"RTN","ACKQUTL4",46,0)
 ;
"RTN","ACKQUTL4",47,0)
 N ACKX,ACKD0
"RTN","ACKQUTL4",48,0)
 ;
"RTN","ACKQUTL4",49,0)
 S (ICPTVDT,ICDVDT)=ACKVD
"RTN","ACKQUTL4",50,0)
 ;
"RTN","ACKQUTL4",51,0)
 S ACKPCE=$$PCE(ACKDIV,ACKVD)  ;  Sets PCE indicator
"RTN","ACKQUTL4",52,0)
 ;
"RTN","ACKQUTL4",53,0)
 S ACKEVENT=1
"RTN","ACKQUTL4",54,0)
 S ACKEVENT=$$EVENT^ACKQUTL5(ACKDIV,ACKVD)   ; Use EC Codes or CPT
"RTN","ACKQUTL4",55,0)
 ;  Indicates whether local clinic #'s are in use
"RTN","ACKQUTL4",56,0)
 S ACKCLNO=$$GET1^DIQ(509850.83,ACKDIV_",1",".04","I")
"RTN","ACKQUTL4",57,0)
 ;
"RTN","ACKQUTL4",58,0)
 ;  Indicates whether the bypass flag for Audiometrics is set
"RTN","ACKQUTL4",59,0)
 S ACKBA=$$GET1^DIQ(509850.83,ACKDIV_",1",".07","I")
"RTN","ACKQUTL4",60,0)
 ;
"RTN","ACKQUTL4",61,0)
 ;  Indicates whether the visit is service connected
"RTN","ACKQUTL4",62,0)
 S DFN=ACKPAT D ELIG^VADPT S ACKSC=$P(VAEL(3),U,1)
"RTN","ACKQUTL4",63,0)
 ;
"RTN","ACKQUTL4",64,0)
 ;  Indicates whether the patient has any previous visits
"RTN","ACKQUTL4",65,0)
 ;  with audiometric test scores
"RTN","ACKQUTL4",66,0)
 ;
"RTN","ACKQUTL4",67,0)
 S ACKATS=1
"RTN","ACKQUTL4",68,0)
 S ACKX=$O(^ACK(509850.6,"AMD",ACKPAT,0)),ACKD0=$O(^ACK(509850.6,"AMD",ACKPAT,+ACKX,0))
"RTN","ACKQUTL4",69,0)
 I 'ACKX!('$D(^ACK(509850.6,+ACKD0,0))) S ACKATS=0
"RTN","ACKQUTL4",70,0)
 ; 
"RTN","ACKQUTL4",71,0)
 S (ACKAO,ACKRAD,ACKENV,ACKHNC,ACKCV)=0,(ACKLOSS,ACKLAMD)=""
"RTN","ACKQUTL4",72,0)
 I ACKPCE D STATUS
"RTN","ACKQUTL4",73,0)
 S:ACKSC ACKQSER=1 S:ACKAO ACKQORG=1
"RTN","ACKQUTL4",74,0)
 S:ACKRAD ACKQIR=1 S:ACKENV ACKQECON=1
"RTN","ACKQUTL4",75,0)
 ;
"RTN","ACKQUTL4",76,0)
 D ELIG
"RTN","ACKQUTL4",77,0)
 ;
"RTN","ACKQUTL4",78,0)
 K VASV,VAEL
"RTN","ACKQUTL4",79,0)
 ;  
"RTN","ACKQUTL4",80,0)
 Q
"RTN","ACKQUTL4",81,0)
 ;
"RTN","ACKQUTL4",82,0)
PCE(ACKDIV,ACKVD) ;  Sets ACKPCE to 1 if - The send to PCE flag is set 
"RTN","ACKQUTL4",83,0)
 ; (for the division) and the PCE INTERFACE START DATE is before or on
"RTN","ACKQUTL4",84,0)
 ; the same day as the Visit Date and the INTERFACE WITH PCE flag for
"RTN","ACKQUTL4",85,0)
 ; the site is set to true.
"RTN","ACKQUTL4",86,0)
 N ACKOUT S ACKOUT=0
"RTN","ACKQUTL4",87,0)
 I $$GET1^DIQ(509850.8,"1,","2","I") D
"RTN","ACKQUTL4",88,0)
 . I $$GET1^DIQ(509850.83,ACKDIV_",1",".03","I"),ACKVD'<$$GET1^DIQ(509850.83,ACKDIV_",1",".08","I") S ACKOUT=1
"RTN","ACKQUTL4",89,0)
 Q ACKOUT
"RTN","ACKQUTL4",90,0)
 ;
"RTN","ACKQUTL4",91,0)
STATUS ;  Sets Agent orange, Radiation and Environmental Contaminant and Combat indicators
"RTN","ACKQUTL4",92,0)
 ;  AO,Rad
"RTN","ACKQUTL4",93,0)
 D SVC^VADPT S ACKAO=VASV(2),ACKRAD=VASV(3)
"RTN","ACKQUTL4",94,0)
 ; Combat Veteran
"RTN","ACKQUTL4",95,0)
 ; DBIA 4156
"RTN","ACKQUTL4",96,0)
 S:$G(ACKVD) ACKCV=+$P($$CVEDT^DGCV(ACKPAT,ACKVD),U,3)
"RTN","ACKQUTL4",97,0)
 ;  HNC
"RTN","ACKQUTL4",98,0)
 N ACKHNC0
"RTN","ACKQUTL4",99,0)
 D GETCUR^DGNTAPI(DFN,"ACKHNC0")
"RTN","ACKQUTL4",100,0)
 S ACKHNC=$S((".3.4.5."[("."_$P($G(ACKHNC0("STAT")),U)_".")):1,1:0)
"RTN","ACKQUTL4",101,0)
 ;  ENV
"RTN","ACKQUTL4",102,0)
 S ACKENV=$$GET1^DIQ(2,ACKPAT,.322013,"I")
"RTN","ACKQUTL4",103,0)
 I ACKENV="Y" S ACKENV=1
"RTN","ACKQUTL4",104,0)
 S:ACKENV'="1" ACKENV=0
"RTN","ACKQUTL4",105,0)
 Q
"RTN","ACKQUTL4",106,0)
 ;-----
"RTN","ACKQUTL4",107,0)
 ;
"RTN","ACKQUTL4",108,0)
AUDIO() ;  Pass back 1 if user is valid to enter audimetric scores else 0
"RTN","ACKQUTL4",109,0)
 ;
"RTN","ACKQUTL4",110,0)
 I ACKCP=1 Q 1
"RTN","ACKQUTL4",111,0)
 I ACKLOSS,'ACKBA Q 1
"RTN","ACKQUTL4",112,0)
 Q 0
"RTN","ACKQUTL4",113,0)
 ;
"RTN","ACKQUTL4",114,0)
 ;-----
"RTN","ACKQUTL4",115,0)
 ;
"RTN","ACKQUTL4",116,0)
ELIG ;  Set up eligibiliy variables and if more than one eligibility create
"RTN","ACKQUTL4",117,0)
 ;  display array used in block ELIGDISP
"RTN","ACKQUTL4",118,0)
 ;
"RTN","ACKQUTL4",119,0)
 ;  If not service connected set default to primary & file in visit rec.
"RTN","ACKQUTL4",120,0)
 I $P(VAEL(3),U,1)=0 D  Q
"RTN","ACKQUTL4",121,0)
 . S ACKELGCT=1,ACKELIG=$P(VAEL(1),U,2),ACKELIG1=$P(VAEL(1),U,1)
"RTN","ACKQUTL4",122,0)
 . K ACKAR  S ACKAR(509850.6,ACKVIEN_",",80)=ACKELIG1
"RTN","ACKQUTL4",123,0)
 . D FILE^DIE("K","ACKAR") K ACKAR Q
"RTN","ACKQUTL4",124,0)
 ;
"RTN","ACKQUTL4",125,0)
 S ACKVELG=$$GET1^DIQ(509850.6,ACKVIEN,80,"I") I $G(ACKVELG)'="" D
"RTN","ACKQUTL4",126,0)
 . S ACKVELG=ACKVELG_"^"_$$GET1^DIQ(8,ACKVELG,.01,"I")
"RTN","ACKQUTL4",127,0)
 ;
"RTN","ACKQUTL4",128,0)
 ;  Set default eligibility
"RTN","ACKQUTL4",129,0)
 S ACKELIG=$S($G(ACKVELG)'="":$P(ACKVELG,U,2),1:$P(VAEL(1),U,2))
"RTN","ACKQUTL4",130,0)
 ;
"RTN","ACKQUTL4",131,0)
 ;  Set up display array
"RTN","ACKQUTL4",132,0)
 ;
"RTN","ACKQUTL4",133,0)
 K ACKELDIS S ACKELGCT=0
"RTN","ACKQUTL4",134,0)
 ;
"RTN","ACKQUTL4",135,0)
 I $G(ACKVELG)'="" S ACKELDIS($P(ACKVELG,U,1))=ACKVELG,ACKELGCT=ACKELGCT+1
"RTN","ACKQUTL4",136,0)
 S ACKELDIS($P(VAEL(1),U,1))=VAEL(1),ACKELGCT=ACKELGCT+1
"RTN","ACKQUTL4",137,0)
 ;
"RTN","ACKQUTL4",138,0)
 S ACKK2=""
"RTN","ACKQUTL4",139,0)
 F  S ACKK2=$O(VAEL(1,ACKK2)) Q:ACKK2=""  D
"RTN","ACKQUTL4",140,0)
 .S ACKELGCT=ACKELGCT+1
"RTN","ACKQUTL4",141,0)
 .S ACKELDIS($P(VAEL(1,ACKK2),U,1))=VAEL(1,ACKK2)
"RTN","ACKQUTL4",142,0)
 ;
"RTN","ACKQUTL4",143,0)
 ;  If not already set up add NSC internal number 5
"RTN","ACKQUTL4",144,0)
 I '$D(ACKELDIS(5)) S ACKELGCT=ACKELGCT+1,ACKELDIS(5)="5^NSC"
"RTN","ACKQUTL4",145,0)
 ;
"RTN","ACKQUTL4",146,0)
 Q
"RTN","ACKQUTL4",147,0)
 ;
"RTN","ACKQUTL4",148,0)
ELIGDIS  ;  Display patients eligibilities
"RTN","ACKQUTL4",149,0)
 ;
"RTN","ACKQUTL4",150,0)
 N ACKK2,RC
"RTN","ACKQUTL4",151,0)
 D ENS^%ZISS
"RTN","ACKQUTL4",152,0)
 S RC=$$PAGE^ACKQNQ(6)  Q:RC<0  W:'RC !!
"RTN","ACKQUTL4",153,0)
 W IOUON,"This Patient has other Entitled Eligibilities",IOUOFF,!!
"RTN","ACKQUTL4",154,0)
 S ACKK2=""
"RTN","ACKQUTL4",155,0)
 F  S ACKK2=$O(ACKELDIS(ACKK2)) Q:ACKK2=""  D  Q:RC<0
"RTN","ACKQUTL4",156,0)
 .Q:$P(ACKELDIS(ACKK2),U,2)=ACKELIG
"RTN","ACKQUTL4",157,0)
 .S RC=$$PAGE^ACKQNQ(2) Q:RC<0
"RTN","ACKQUTL4",158,0)
 .W:RC IOUON,"Other Entitled Eligibilities (cont'd)",IOUOFF,!!
"RTN","ACKQUTL4",159,0)
 .W ?1,$P(ACKELDIS(ACKK2),U,2)_" "
"RTN","ACKQUTL4",160,0)
 .W $$GET1^DIQ(8,ACKK2,5),!
"RTN","ACKQUTL4",161,0)
 Q
"RTN","ACKQUTL4",162,0)
 ;-----
"RTN","ACKQUTL4",163,0)
 ;  Display Patient data concerning Rated Disabilities and service class.
"RTN","ACKQUTL4",164,0)
PATDIS ;
"RTN","ACKQUTL4",165,0)
 S DFN=ACKPAT  D RATDIS^ACKQNQ
"RTN","ACKQUTL4",166,0)
 D CLASDIS^ACKQNQ
"RTN","ACKQUTL4",167,0)
 Q
"RTN","ACKQUTL4",168,0)
 ;
"RTN","ACKQUTL4",169,0)
ACKCP() ;  This initializes the C&P Parameter.
"RTN","ACKQUTL4",170,0)
 ;  First check site parameters file for C&P flag
"RTN","ACKQUTL4",171,0)
 ;
"RTN","ACKQUTL4",172,0)
 I '$$GET1^DIQ(509850.83,ACKDIV_",1",".06","I") Q 0
"RTN","ACKQUTL4",173,0)
 ;
"RTN","ACKQUTL4",174,0)
 ;  Check if C&P has an open request pass back 1 or 0
"RTN","ACKQUTL4",175,0)
 S ACKQCPS=$$EN1^DVBCTRN(ACKPAT,"AUDIO")
"RTN","ACKQUTL4",176,0)
 S:ACKQCPS>0 ACKQCPS=$P(ACKQCPS,U)
"RTN","ACKQUTL4",177,0)
 I $S(ACKCSC'="A":1,$$EN1^DVBCTRN(ACKPAT,"AUDIO",ACKQCPS)<1:1,$O(^ACK(509850.6,"ALCP",ACKQCPS,0))=ACKVIEN:0,$D(^ACK(509850.6,"ALCP",ACKQCPS)):1,1:0) Q 0
"RTN","ACKQUTL4",178,0)
 Q "1^"_ACKQCPS
"RTN","ACKQUTL4",179,0)
 ;
"RTN","ACKQUTL4",180,0)
 ;-----
"RTN","ACKQUTL4",181,0)
PROVDIS ;  Get providers already filed and display
"RTN","ACKQUTL4",182,0)
 ;
"RTN","ACKQUTL4",183,0)
 N RC
"RTN","ACKQUTL4",184,0)
 D ENS^%ZISS
"RTN","ACKQUTL4",185,0)
 N ACKK1,ACKPROV,ACKK2,D0,ACKARR,ACKTGT,ACKMSG
"RTN","ACKQUTL4",186,0)
 D LIST^DIC(509850.66,","_ACKVIEN_",",".01","","*","","","","","","ACKTGT","ACKMSG")
"RTN","ACKQUTL4",187,0)
 S ACKK1=""
"RTN","ACKQUTL4",188,0)
 F  S ACKK1=$O(ACKTGT("DILIST",1,ACKK1)) Q:ACKK1=""  D
"RTN","ACKQUTL4",189,0)
 . S ACKARR(ACKK1)=ACKTGT("DILIST",1,ACKK1)
"RTN","ACKQUTL4",190,0)
 K ACKPROV S ACKK2=ACKVIEN_","
"RTN","ACKQUTL4",191,0)
 D GETS^DIQ(509850.6,ACKK2,"6;7","E","ACKPROV")
"RTN","ACKQUTL4",192,0)
 I '$D(ACKARR),$G(ACKPROV(509850.6,ACKK2,"6","E"))="",$G(ACKPROV(509850.6,ACKK2,"7","E"))="" Q
"RTN","ACKQUTL4",193,0)
 S RC=$$PAGE^ACKQNQ(5) Q:RC<0  W:'RC !!
"RTN","ACKQUTL4",194,0)
 W " ",IOUON,"Providers currently recorded for this visit",IOUOFF,!
"RTN","ACKQUTL4",195,0)
 I $G(ACKPROV(509850.6,ACKK2,"6","E"))'="" W !," Primary Provider   - "_ACKPROV(509850.6,ACKK2,"6","E")
"RTN","ACKQUTL4",196,0)
 I $D(ACKARR)>1  S RC=0  D  Q:RC<0
"RTN","ACKQUTL4",197,0)
 . S ACKK1=""
"RTN","ACKQUTL4",198,0)
 . F  S ACKK1=$O(ACKARR(ACKK1))  Q:ACKK1=""  D  Q:RC<0
"RTN","ACKQUTL4",199,0)
 . . S RC=$$PAGE^ACKQNQ(2)  Q:RC<0
"RTN","ACKQUTL4",200,0)
 . . W !," Secondary Provider - "_ACKARR(ACKK1)
"RTN","ACKQUTL4",201,0)
 D:$G(ACKPROV(509850.6,ACKK2,"7","E"))'=""
"RTN","ACKQUTL4",202,0)
 . S RC=$$PAGE^ACKQNQ(2)  Q:RC<0
"RTN","ACKQUTL4",203,0)
 . W !," Student            - "_ACKPROV(509850.6,ACKK2,"7","E")
"RTN","ACKQUTL4",204,0)
 W !
"RTN","ACKQUTL4",205,0)
 Q
"RTN","ACKQUTL4",206,0)
 ;
"RTN","ACKQUTL4",207,0)
CPTDIS ;  Get procedures already filed and display
"RTN","ACKQUTL4",208,0)
 ;
"RTN","ACKQUTL4",209,0)
 D ENS^%ZISS
"RTN","ACKQUTL4",210,0)
 N D0,ACKKEY,ACKCPTDS,ACKK3,ACKPIEN,ACKTMOD,ACKCODE,ACKPROC,ACKPRV
"RTN","ACKQUTL4",211,0)
 D LIST^DIC(509850.61,","_ACKVIEN_",",".01;.03;.05","I","*","","","","","","ACKCPTDS")
"RTN","ACKQUTL4",212,0)
 I '$D(ACKCPTDS("DILIST",1)) Q
"RTN","ACKQUTL4",213,0)
 W !!," ",IOUON,"Procedures currently entered for this visit",IOUOFF,!
"RTN","ACKQUTL4",214,0)
 S ACKK3=""
"RTN","ACKQUTL4",215,0)
 F  S ACKK3=$O(ACKCPTDS("DILIST",1,ACKK3)) Q:ACKK3=""  D
"RTN","ACKQUTL4",216,0)
 . S ACKPROC=ACKCPTDS("DILIST",1,ACKK3)
"RTN","ACKQUTL4",217,0)
 . S ACKPRV=ACKCPTDS("DILIST","ID",ACKK3,.05)
"RTN","ACKQUTL4",218,0)
 . I ACKPRV'="" S ACKPRV=$$CONVERT(ACKPRV)
"RTN","ACKQUTL4",219,0)
 . W !," Code: ",$$GET1^DIQ(509850.4,ACKPROC_",",.01),?19,"Volume: ",ACKCPTDS("DILIST","ID",ACKK3,.03) I ACKPRV'="" W "   Provider : ",ACKPRV
"RTN","ACKQUTL4",220,0)
 . D LONG^ACKQUTL6(ACKPROC,"1")
"RTN","ACKQUTL4",221,0)
 . W !
"RTN","ACKQUTL4",222,0)
 . ;  Check if any Modifiers present for this Procedure
"RTN","ACKQUTL4",223,0)
 . S ACKPIEN="" I $D(ACKCODE(ACKPROC)) S ACKPIEN=$O(ACKCODE(ACKPROC,""),-1)
"RTN","ACKQUTL4",224,0)
 . S ACKPIEN=$O(^ACK(509850.6,ACKVIEN,3,"B",ACKPROC,ACKPIEN))
"RTN","ACKQUTL4",225,0)
 . I ACKPIEN="" W ! Q
"RTN","ACKQUTL4",226,0)
 . S ACKCODE(ACKPROC,ACKPIEN)=""
"RTN","ACKQUTL4",227,0)
 . ;  Modifier level present do a LIST to get them
"RTN","ACKQUTL4",228,0)
 . S ACKPIEN=ACKPIEN_","_ACKVIEN
"RTN","ACKQUTL4",229,0)
 . D LIST^DIC(509850.64,","_ACKPIEN_",",".01","I","*","","","","","","ACKTMOD")
"RTN","ACKQUTL4",230,0)
 . I $D(ACKTMOD("DILIST",1)) D
"RTN","ACKQUTL4",231,0)
 . . W "        Modifiers:"
"RTN","ACKQUTL4",232,0)
 . . ;  Loop through Modifier Array
"RTN","ACKQUTL4",233,0)
 . . S ACKKEY=""
"RTN","ACKQUTL4",234,0)
 . . F  S ACKKEY=$O(ACKTMOD("DILIST",1,ACKKEY)) Q:ACKKEY=""  D
"RTN","ACKQUTL4",235,0)
 . . . W ?19,$$MODTXT^ACKQUTL8(ACKTMOD("DILIST",1,ACKKEY),ACKVD),!
"RTN","ACKQUTL4",236,0)
 . . K ACKTMOD
"RTN","ACKQUTL4",237,0)
 W !
"RTN","ACKQUTL4",238,0)
 Q
"RTN","ACKQUTL4",239,0)
 ;
"RTN","ACKQUTL4",240,0)
DIAGDIS ;  Get diagnoses already filed and display
"RTN","ACKQUTL4",241,0)
 D ENS^%ZISS
"RTN","ACKQUTL4",242,0)
 N ACK1,D0,ACKDIAGD,ACKK3,ACKK4,ACKI,ACKD,RC
"RTN","ACKQUTL4",243,0)
 D LIST^DIC(509850.63,","_ACKVIEN_",",".01;.12","I","*","","","","","","ACKDIAGD")
"RTN","ACKQUTL4",244,0)
 I '$D(ACKDIAGD("DILIST",1)) Q
"RTN","ACKQUTL4",245,0)
 S RC=$$PAGE^ACKQNQ(5)  Q:RC<0  W:'RC !!
"RTN","ACKQUTL4",246,0)
 W " ",IOUON,"Diagnoses currently entered for this visit:",IOUOFF,!
"RTN","ACKQUTL4",247,0)
 S ACKK3="",ACKSP="                                   "
"RTN","ACKQUTL4",248,0)
 F  S ACKK3=$O(ACKDIAGD("DILIST",1,ACKK3)) Q:ACKK3=""  D
"RTN","ACKQUTL4",249,0)
 . S ACKK4=ACKDIAGD("DILIST",1,ACKK3)
"RTN","ACKQUTL4",250,0)
 . ;ACKQ*3.0*22 updated api
"RTN","ACKQUTL4",251,0)
 . S ACKI=$P($$ICDDX^ICDCODE(ACKK4),U,2)
"RTN","ACKQUTL4",252,0)
 . S ACKD($S(ACKI?.NP:+ACKI,1:ACKI))=ACKI_$E("   ",1,7-$L(ACKI))_"- "_$E($$DIAGTXT^ACKQUTL8(ACKK4,ACKVD)_ACKSP,1,35)_$S($G(ACKDIAGD("DILIST","ID",ACKK3,".12"))=1:"  * Primary Diagnosis *",1:"  * Secondary Diagnosis *")
"RTN","ACKQUTL4",253,0)
 ;
"RTN","ACKQUTL4",254,0)
 S ACK1=""
"RTN","ACKQUTL4",255,0)
 F  S ACK1=$O(ACKD(ACK1)) Q:ACK1=""  D
"RTN","ACKQUTL4",256,0)
 . S RC=$$PAGE^ACKQNQ(3)  Q:RC<0
"RTN","ACKQUTL4",257,0)
 . W:RC IOUON,"Diagnoses currently entered for this visit (cont'd)",IOUOFF,!
"RTN","ACKQUTL4",258,0)
 . W !," ",ACKD(ACK1)
"RTN","ACKQUTL4",259,0)
 W !
"RTN","ACKQUTL4",260,0)
 Q
"RTN","ACKQUTL4",261,0)
 ;
"RTN","ACKQUTL4",262,0)
 ;
"RTN","ACKQUTL4",263,0)
HLOSS ; Sets hearing loss variable if one or more diagnosis are for hearing
"RTN","ACKQUTL4",264,0)
 ;  loss
"RTN","ACKQUTL4",265,0)
 ;
"RTN","ACKQUTL4",266,0)
 N ACKK4,ACKDIAG
"RTN","ACKQUTL4",267,0)
 S (ACKLOSS,ACKK4)=0
"RTN","ACKQUTL4",268,0)
 F  S ACKK4=$O(^ACK(509850.6,ACKVIEN,1,ACKK4)) Q:ACKK4'?1.N!(ACKLOSS)  D
"RTN","ACKQUTL4",269,0)
 .S ACKDIAG=$P(^ACK(509850.6,ACKVIEN,1,ACKK4,0),U,1)
"RTN","ACKQUTL4",270,0)
 .I $P(^ACK(509850.1,ACKDIAG,0),U,5)=1 S ACKLOSS=1 Q 
"RTN","ACKQUTL4",271,0)
 Q
"RTN","ACKQUTL4",272,0)
 ;
"RTN","ACKQUTL4",273,0)
MODDIS ;  Display Modifiers - Called within Executable Help of Modiifer
"RTN","ACKQUTL4",274,0)
 ;  Enter Edit.
"RTN","ACKQUTL4",275,0)
 N ACKSRCE
"RTN","ACKQUTL4",276,0)
 S ACK1="0"
"RTN","ACKQUTL4",277,0)
 F  S ACK1=$O(^ACK(509850.5,ACK1)) Q:'+ACK1  D
"RTN","ACKQUTL4",278,0)
 . ;ACKQ*3.0*22 updated api
"RTN","ACKQUTL4",279,0)
 . S ACKSRCE=$P($$MOD^ICPTMOD(ACK1,"I"),U,5)
"RTN","ACKQUTL4",280,0)
 . W !,"  "_$P($$MOD^ICPTMOD(ACK1,"I"),U,2),?5,$$MODTXT^ACKQUTL8(ACK1,""),?53,$S(ACKSRCE="C":"CPT",ACKSRCE="H":"HCPCS",ACKSRCE="V":"VA NATIONAL",1:"")
"RTN","ACKQUTL4",281,0)
 W ! Q
"RTN","ACKQUTL4",282,0)
 ;
"RTN","ACKQUTL4",283,0)
CONVERT(ACKPRV) ; Converts the QSR Prov Code into a name string from file 200.
"RTN","ACKQUTL4",284,0)
 ;
"RTN","ACKQUTL4",285,0)
 ;ACKQ*3*17
"RTN","ACKQUTL4",286,0)
 Q $$GET1^DIQ(509850.3,ACKPRV,.07)
"RTN","ACKQUTL4",287,0)
 ;
"RTN","ACKQUTL4",288,0)
CONVERT1(ACKPRV) ;  Converts the Provider IEN number used within Quasar
"RTN","ACKQUTL4",289,0)
 ;                  to its equivalent code used on the 200 file.
"RTN","ACKQUTL4",290,0)
 ;ACKQ*3*17
"RTN","ACKQUTL4",291,0)
 Q +$$GET1^DIQ(509850.3,ACKPRV,.07,"I")
"RTN","ACKQUTL4",292,0)
 ;
"RTN","ACKQUTL4",293,0)
CONVERT2(ACKPRV) ;  Converts the Provider IEN number used within Quasar
"RTN","ACKQUTL4",294,0)
 ;                  to its equivalent code used on the 200 file.
"RTN","ACKQUTL4",295,0)
 ;ACKQ*3*17
"RTN","ACKQUTL4",296,0)
 Q +$$GET1^DIQ(509850.3,ACKPRV,.07,"I")
"RTN","ACKQUTL4",297,0)
 ;
"RTN","ACKQUTL5")
0^8^B64186800^B61333053
"RTN","ACKQUTL5",1,0)
ACKQUTL5 ;HCIOFO/BH-Quasar utilities routine ; 12/24/09 2:15pm
"RTN","ACKQUTL5",2,0)
 ;;3.0;QUASAR;**1,4,6,8,18,22**;Feb 11, 2000;Build 5
"RTN","ACKQUTL5",3,0)
 ;Per VHA Directive 2004-038, this routine SHOULD NOT be modified.
"RTN","ACKQUTL5",4,0)
 ;
"RTN","ACKQUTL5",5,0)
 ;Reference/IA
"RTN","ACKQUTL5",6,0)
 ;
"RTN","ACKQUTL5",7,0)
 ;$$MOD^ICPTMOD - 1996
"RTN","ACKQUTL5",8,0)
 ;$$CPT^ICPTMOD - 1995
"RTN","ACKQUTL5",9,0)
 ;
"RTN","ACKQUTL5",10,0)
 ; 
"RTN","ACKQUTL5",11,0)
SETREF(X,ACKVIEN,ACKTYPE) ;
"RTN","ACKQUTL5",12,0)
 ; Maintains APCE xRef When 3 of the 4 entries are present & the 4TH
"RTN","ACKQUTL5",13,0)
 ; has been entered a new entry will be set up. If any of the 4 data 
"RTN","ACKQUTL5",14,0)
 ; items used within the X ref are changed the entry will be deleted & a
"RTN","ACKQUTL5",15,0)
 ; new 1 set up
"RTN","ACKQUTL5",16,0)
 N ACKTME,ACKCLIN,ACKVD,ACKPAT
"RTN","ACKQUTL5",17,0)
 D GETVAL
"RTN","ACKQUTL5",18,0)
 I ACKTME="",ACKTYPE'="T" Q
"RTN","ACKQUTL5",19,0)
 I ACKCLIN="",ACKTYPE'="C" Q
"RTN","ACKQUTL5",20,0)
 I ACKVD="",ACKTYPE'="D" Q
"RTN","ACKQUTL5",21,0)
 I ACKPAT="",ACKTYPE'="P" Q
"RTN","ACKQUTL5",22,0)
 ;
"RTN","ACKQUTL5",23,0)
 S ^ACK(509850.6,"APCE",ACKPAT,ACKCLIN,ACKVD,ACKTME,ACKVIEN)=""
"RTN","ACKQUTL5",24,0)
 Q
"RTN","ACKQUTL5",25,0)
KILLREF(X,ACKVIEN,ACKTYPE) ;
"RTN","ACKQUTL5",26,0)
 ; When any of the 4 var values that make up the APCE xRef are deleted
"RTN","ACKQUTL5",27,0)
 ; or when the visit record is deleted the APCE xRef will be deleted
"RTN","ACKQUTL5",28,0)
 N ACKTME,ACKCLIN,ACKVD,ACKPAT
"RTN","ACKQUTL5",29,0)
 D GETVAL
"RTN","ACKQUTL5",30,0)
 ;
"RTN","ACKQUTL5",31,0)
 I ACKTYPE'="T",ACKTME="" Q   ;  If any of the 4 field values other than
"RTN","ACKQUTL5",32,0)
 I ACKTYPE'="C",ACKCLIN="" Q  ;  the field being edited are null the
"RTN","ACKQUTL5",33,0)
 I ACKTYPE'="D",ACKVD="" Q    ;  xRef will not have been set up
"RTN","ACKQUTL5",34,0)
 I ACKTYPE'="P",ACKPAT="" Q
"RTN","ACKQUTL5",35,0)
 ;
"RTN","ACKQUTL5",36,0)
 I ACKTYPE="D" S ACKVD=X      ;  X=Old field value
"RTN","ACKQUTL5",37,0)
 I ACKTYPE="P" S ACKPAT=X
"RTN","ACKQUTL5",38,0)
 I ACKTYPE="C" S ACKCLIN=X
"RTN","ACKQUTL5",39,0)
 I ACKTYPE="T" S ACKTME=X
"RTN","ACKQUTL5",40,0)
 ;
"RTN","ACKQUTL5",41,0)
 I $D(^ACK(509850.6,"APCE",ACKPAT,ACKCLIN,ACKVD,ACKTME,ACKVIEN)) D
"RTN","ACKQUTL5",42,0)
 . K ^ACK(509850.6,"APCE",ACKPAT,ACKCLIN,ACKVD,ACKTME,ACKVIEN)
"RTN","ACKQUTL5",43,0)
 Q
"RTN","ACKQUTL5",44,0)
 ;
"RTN","ACKQUTL5",45,0)
GETVAL ; Used with SETREF & KILLREF - Gets The Clinic, Visit Date, Visit
"RTN","ACKQUTL5",46,0)
 ; time and Patient from the visit file currently being processed
"RTN","ACKQUTL5",47,0)
 N ACKTGT
"RTN","ACKQUTL5",48,0)
 D GETS^DIQ(509850.6,ACKVIEN_",",".01;1;2.6;55","I","ACKTGT")
"RTN","ACKQUTL5",49,0)
 S ACKVD=$G(ACKTGT(509850.6,ACKVIEN_",",.01,"I"))
"RTN","ACKQUTL5",50,0)
 S ACKPAT=$G(ACKTGT(509850.6,ACKVIEN_",",1,"I"))
"RTN","ACKQUTL5",51,0)
 S ACKCLIN=$G(ACKTGT(509850.6,ACKVIEN_",",2.6,"I"))
"RTN","ACKQUTL5",52,0)
 S ACKTME=$G(ACKTGT(509850.6,ACKVIEN_",",55,"I"))
"RTN","ACKQUTL5",53,0)
 Q
"RTN","ACKQUTL5",54,0)
 ;
"RTN","ACKQUTL5",55,0)
EXCEPT(ACKVIEN,ACKFLD,ACKVAL) ;  Called from xRefs within the LAST SENT TO PCE, LAST
"RTN","ACKQUTL5",56,0)
 ;  EDITED IN QSR and PCE VISIT IEN fields
"RTN","ACKQUTL5",57,0)
 N ACKTGT,ACKPIEN,ACKSENT,ACKEDIT,ACKARR,ACKEXCP
"RTN","ACKQUTL5",58,0)
 I ACKFLD=125 D
"RTN","ACKQUTL5",59,0)
 . S ACKPIEN=ACKVAL
"RTN","ACKQUTL5",60,0)
 . S ACKSENT=$$GET1^DIQ(509850.6,ACKVIEN_",",135,"I")
"RTN","ACKQUTL5",61,0)
 . S ACKEDIT=$$GET1^DIQ(509850.6,ACKVIEN_",",140,"I")
"RTN","ACKQUTL5",62,0)
 I ACKFLD=135 D
"RTN","ACKQUTL5",63,0)
 . S ACKPIEN=$$GET1^DIQ(509850.6,ACKVIEN_",",125,"I")
"RTN","ACKQUTL5",64,0)
 . S ACKSENT=ACKVAL
"RTN","ACKQUTL5",65,0)
 . S ACKEDIT=$$GET1^DIQ(509850.6,ACKVIEN_",",140,"I")
"RTN","ACKQUTL5",66,0)
 I ACKFLD=140 D
"RTN","ACKQUTL5",67,0)
 . S ACKPIEN=$$GET1^DIQ(509850.6,ACKVIEN_",",125,"I")
"RTN","ACKQUTL5",68,0)
 . S ACKSENT=$$GET1^DIQ(509850.6,ACKVIEN_",",135,"I")
"RTN","ACKQUTL5",69,0)
 . S ACKEDIT=ACKVAL
"RTN","ACKQUTL5",70,0)
 ;
"RTN","ACKQUTL5",71,0)
 ; if PCE visit ien known and PCE updated last then no exception
"RTN","ACKQUTL5",72,0)
 I ACKPIEN'="",ACKEDIT'="",ACKSENT'="",ACKEDIT<ACKSENT D  Q
"RTN","ACKQUTL5",73,0)
 . S ACKARR(509850.6,ACKVIEN_",",900)="@"
"RTN","ACKQUTL5",74,0)
 . D FILE^DIE("","ACKARR")
"RTN","ACKQUTL5",75,0)
 ; else this visit is an exception - only update if null or
"RTN","ACKQUTL5",76,0)
 ; earlier than today
"RTN","ACKQUTL5",77,0)
 S ACKEXCP=$$GET1^DIQ(509850.6,ACKVIEN_",",900,"I")
"RTN","ACKQUTL5",78,0)
 D NOW^%DTC
"RTN","ACKQUTL5",79,0)
 I (ACKEXCP="")!(ACKEXCP\1<(%\1)) D
"RTN","ACKQUTL5",80,0)
 . S ACKARR(509850.6,ACKVIEN_",",900)=%
"RTN","ACKQUTL5",81,0)
 . D FILE^DIE("","ACKARR")
"RTN","ACKQUTL5",82,0)
 Q
"RTN","ACKQUTL5",83,0)
SEND(ACKVIEN) ;  Called when entering/editing any of the PCE fields.
"RTN","ACKQUTL5",84,0)
 ; inputs: ACKVIEN - visit ien 
"RTN","ACKQUTL5",85,0)
 ; this s/r is used in the xRef of any data field that, if changed,
"RTN","ACKQUTL5",86,0)
 ; should be sent to PCE to keep PCE up to date. The edit triggers the 
"RTN","ACKQUTL5",87,0)
 ; xRef call to this s/r. It ensures that the LAST EDITED IN QSR date is
"RTN","ACKQUTL5",88,0)
 ; after the LAST SENT TO PCE date so that the visit becomes a PCE 
"RTN","ACKQUTL5",89,0)
 ; EXCEPTION. NB. The LAST EDITED IN QSR date will only be updated if
"RTN","ACKQUTL5",90,0)
 ; a. it is currently earlier than the LAST SENT TO PCE and by updating 
"RTN","ACKQUTL5",91,0)
 ; it the visit becomes a PCE Exception. or b. the current value is 
"RTN","ACKQUTL5",92,0)
 ; earlier than today this saves the system from constantly updating 
"RTN","ACKQUTL5",93,0)
 ; this field and checking the exception status each time a pce field 
"RTN","ACKQUTL5",94,0)
 ; is changed
"RTN","ACKQUTL5",95,0)
 N ACKARR,ACKEDIT,ACKSENT
"RTN","ACKQUTL5",96,0)
 ; get current value of LAST EDITED IN QSR and LAST SENT TO PCE
"RTN","ACKQUTL5",97,0)
 S ACKEDIT=$$GET1^DIQ(509850.6,ACKVIEN_",",140,"I")
"RTN","ACKQUTL5",98,0)
 S ACKSENT=$$GET1^DIQ(509850.6,ACKVIEN_",",135,"I")
"RTN","ACKQUTL5",99,0)
 D NOW^%DTC
"RTN","ACKQUTL5",100,0)
 ; if qsr edit currently earlier than sent to pce update
"RTN","ACKQUTL5",101,0)
 I ACKEDIT<ACKSENT D  Q
"RTN","ACKQUTL5",102,0)
 . S ACKARR(509850.6,ACKVIEN_",",140)=%
"RTN","ACKQUTL5",103,0)
 . D FILE^DIE("","ACKARR")
"RTN","ACKQUTL5",104,0)
 ;
"RTN","ACKQUTL5",105,0)
 ; if last edit is earlier than today update
"RTN","ACKQUTL5",106,0)
 I (ACKEDIT\1)<(%\1) D  Q
"RTN","ACKQUTL5",107,0)
 . S ACKARR(509850.6,ACKVIEN_",",140)=%
"RTN","ACKQUTL5",108,0)
 . D FILE^DIE("","ACKARR")
"RTN","ACKQUTL5",109,0)
 ; nothing to do - QSR date must already be after LAST SENT and for today
"RTN","ACKQUTL5",110,0)
 Q
"RTN","ACKQUTL5",111,0)
MOD ; Creates an array of valid CPT Modfrs.  gets all valid Mods for the 
"RTN","ACKQUTL5",112,0)
 ; Proc then disgards any that are not on the A&SP Proc Mod file or that
"RTN","ACKQUTL5",113,0)
 ; are on file but Inactive
"RTN","ACKQUTL5",114,0)
 K ACKMOD,ACKMODD
"RTN","ACKQUTL5",115,0)
 N CDT,ACKMOD1,ACKM1,ACKK2
"RTN","ACKQUTL5",116,0)
 I $$PATCH^XPDUTL("PX*1.0*73") S ACKMOD1=$$CODM^ICPTCOD(ACKPC,"ACKMODD","",ACKVD)
"RTN","ACKQUTL5",117,0)
 I '$$PATCH^XPDUTL("PX*1.0*73") S ACKMOD1=$$CODM^ICPTCOD(ACKPC,"ACKMODD")
"RTN","ACKQUTL5",118,0)
 S ACKM1=""
"RTN","ACKQUTL5",119,0)
 F  S ACKM1=$O(ACKMODD(ACKM1)) Q:ACKM1=""  D
"RTN","ACKQUTL5",120,0)
 . S ACKK2=$P(ACKMODD(ACKM1),U,2)
"RTN","ACKQUTL5",121,0)
 . I '$D(^ACK(509850.5,ACKK2,0)) K ACKMODD(ACKM1) Q
"RTN","ACKQUTL5",122,0)
 . I $P(^ACK(509850.5,ACKK2,0),U,2)=0 K ACKMODD(ACKM1) Q
"RTN","ACKQUTL5",123,0)
 . K ACKMODD(ACKM1) S ACKMOD(ACKPC,ACKK2)=""
"RTN","ACKQUTL5",124,0)
 S ACKMOD(ACKPC)=""
"RTN","ACKQUTL5",125,0)
 Q
"RTN","ACKQUTL5",126,0)
MODW ; Called from x ref of Modfr field within 509850.6
"RTN","ACKQUTL5",127,0)
 I X'["?" Q
"RTN","ACKQUTL5",128,0)
 N ACKQDDD
"RTN","ACKQUTL5",129,0)
 S ACKQDDD=$G(ACKVD)
"RTN","ACKQUTL5",130,0)
 ;ACKQ*3.0*22 updated api
"RTN","ACKQUTL5",131,0)
 S DIC("W")="S ACKSRCE=$P($$MOD^ICPTMOD(Y,""I""),U,5) W ""  "",$$MODTXT^ACKQUTL8(Y,"_ACKQDDD_"),?48,$S(ACKSRCE=""C"":""CPT"",ACKSRCE=""H"":""HCPCS"",ACKSRCE=""V"":""VA NATIONAL"",1:"""")"
"RTN","ACKQUTL5",132,0)
 Q
"RTN","ACKQUTL5",133,0)
 ;
"RTN","ACKQUTL5",134,0)
 ;
"RTN","ACKQUTL5",135,0)
MODS ; Screen for Modfrs input within Modifrs field of Modfrs File
"RTN","ACKQUTL5",136,0)
 N ACKQDDD,ACKMOD
"RTN","ACKQUTL5",137,0)
 S ACKQDDD=$G(ACKVD)
"RTN","ACKQUTL5",138,0)
 ;ACKQ*3.0*22 updated api
"RTN","ACKQUTL5",139,0)
 S DIC("S")="S ACKMOD=$$MOD^ICPTMOD(Y,""I"") I $P($G(ACKMOD),""^"",5)=""C""!($P($G(ACKMOD),""^"",5)=""H""),$P($G(ACKMOD),""^"",7)=1"
"RTN","ACKQUTL5",140,0)
 S DIC("W")="W ""  "",$$MODTXT^ACKQUTL8(Y,"_ACKQDDD_")"
"RTN","ACKQUTL5",141,0)
 Q
"RTN","ACKQUTL5",142,0)
 ;
"RTN","ACKQUTL5",143,0)
 ;
"RTN","ACKQUTL5",144,0)
CHK(Y,ACKVD,ACKCSC) ;  Screen for EC codes
"RTN","ACKQUTL5",145,0)
 N ACKQCD,ACKQQD,ACKQQCPT,ACKPARAM
"RTN","ACKQUTL5",146,0)
 I $E($P(^EC(725,+Y,0),"^",2),1,2)'="SP" Q 0
"RTN","ACKQUTL5",147,0)
 S ACKQQCPT=$$GET1^DIQ(725,+Y_",",4,"I") I ACKQQCPT="" Q 0
"RTN","ACKQUTL5",148,0)
 ;S ACKQCD=$$CONVERT(ACKQQCPT) I ACKQCD="" Q 0
"RTN","ACKQUTL5",149,0)
 S ACKQCD=ACKQQCPT
"RTN","ACKQUTL5",150,0)
 S ACKPARAM=$P($$CPT^ICPTCOD(ACKQCD,ACKVD),"^",7) I 'ACKPARAM Q 0
"RTN","ACKQUTL5",151,0)
 I '$D(^ACK(509850.4,ACKQCD,0)) Q 0
"RTN","ACKQUTL5",152,0)
 I $P(^ACK(509850.4,ACKQCD,0),U,2)'[$E(ACKCSC) Q 0
"RTN","ACKQUTL5",153,0)
 I $P(^ACK(509850.4,ACKQCD,0),U,4)'=1 Q 0
"RTN","ACKQUTL5",154,0)
 S ACKQQD=$P(^EC(725,Y,0),"^",3) I ACKQQD="" Q 1
"RTN","ACKQUTL5",155,0)
 I ACKVD<ACKQQD Q 1
"RTN","ACKQUTL5",156,0)
 Q 0
"RTN","ACKQUTL5",157,0)
EVNTDIS ; Get EC Procs filed and display
"RTN","ACKQUTL5",158,0)
 D ENS^%ZISS
"RTN","ACKQUTL5",159,0)
 N D0,ACKKEY,ACKEVTDS,ACKK3,ACKPROC,ACKPRV,ACKNME,ACKNATNM
"RTN","ACKQUTL5",160,0)
 D LIST^DIC(509850.615,","_ACKVIEN_",",".01;.03;.05","I","*","","","","","","ACKEVTDS")
"RTN","ACKQUTL5",161,0)
 I '$D(ACKEVTDS("DILIST",1)) Q
"RTN","ACKQUTL5",162,0)
 W !!," ",IOUON,"Event Capture Procedures currently entered for this visit",IOUOFF,!
"RTN","ACKQUTL5",163,0)
 S ACKK3=""
"RTN","ACKQUTL5",164,0)
 F  S ACKK3=$O(ACKEVTDS("DILIST",1,ACKK3)) Q:ACKK3=""  D
"RTN","ACKQUTL5",165,0)
 . S ACKPROC=ACKEVTDS("DILIST",1,ACKK3)
"RTN","ACKQUTL5",166,0)
 . S ACKPRV=ACKEVTDS("DILIST","ID",ACKK3,.05)
"RTN","ACKQUTL5",167,0)
 . I ACKPRV'="" S ACKPRV=$$CONVERT^ACKQUTL4(ACKPRV)
"RTN","ACKQUTL5",168,0)
 . S ACKNME=$$GET1^DIQ(725,ACKPROC_",",.01) S ACKNME=$E(ACKNME,1,29)
"RTN","ACKQUTL5",169,0)
 . S ACKNATNM=$$GET1^DIQ(725,ACKPROC_",",1)
"RTN","ACKQUTL5",170,0)
 . W !," Nat.#: ",ACKNATNM,?14,"    Name: ",ACKNME,?55,"Vol.: ",ACKEVTDS("DILIST","ID",ACKK3,.03) I ACKPRV'="" W !,?14,"Provider: ",ACKPRV
"RTN","ACKQUTL5",171,0)
 . W !
"RTN","ACKQUTL5",172,0)
 Q
"RTN","ACKQUTL5",173,0)
SETCPT(DA,ACKQQIEN,X) ;  When EC Code is entered create a CPT entry
"RTN","ACKQUTL5",174,0)
 I '$D(ACKEVENT) Q   ; "" or 1 ACKEVENT must be defined
"RTN","ACKQUTL5",175,0)
 N ACK,ACKARR1,ACKCIEN,ACKQQCPT
"RTN","ACKQUTL5",176,0)
 ; Get CPT associated with EC code
"RTN","ACKQUTL5",177,0)
 S ACKQQCPT=$$GET1^DIQ(725,X_",",4,"I")
"RTN","ACKQUTL5",178,0)
 ;S ACKQQCPT=$$CONVERT(ACKQQCPT)
"RTN","ACKQUTL5",179,0)
 S ACKCIEN="" K ACKARR1
"RTN","ACKQUTL5",180,0)
 ; Create CPT entry and enter DA as CPT's pter to creating EC entry
"RTN","ACKQUTL5",181,0)
 S ACKARR1(509850.61,"+1,"_ACKQQIEN_",",.01)=ACKQQCPT
"RTN","ACKQUTL5",182,0)
 S ACKARR1(509850.61,"+1,"_ACKQQIEN_",",.07)=DA
"RTN","ACKQUTL5",183,0)
 D UPDATE^DIE("","ACKARR1","ACKCIEN","")
"RTN","ACKQUTL5",184,0)
 K ACK
"RTN","ACKQUTL5",185,0)
 ; After CPT entry set up get its IEN & set it to the creating EC 
"RTN","ACKQUTL5",186,0)
 ; entries CPT ptr field
"RTN","ACKQUTL5",187,0)
 S ACK(509850.615,DA_","_ACKQQIEN_",",.07)=ACKCIEN(1)
"RTN","ACKQUTL5",188,0)
 D FILE^DIE("","ACK","")
"RTN","ACKQUTL5",189,0)
 Q
"RTN","ACKQUTL5",190,0)
KILLCPT(DA,ACKQQIEN) ;  Deletes CPT entry if created by an EC entry
"RTN","ACKQUTL5",191,0)
 I '$D(ACKEVENT) Q  ; "" or 1 ACKEVENT must be defined
"RTN","ACKQUTL5",192,0)
 Q:'ACKEVENT  ; Q if Div set up to use CPT's
"RTN","ACKQUTL5",193,0)
 N ACKCIEN,ACK
"RTN","ACKQUTL5",194,0)
 S ACKCIEN=$$GET1^DIQ(509850.615,DA_","_ACKQQIEN_",",.07)
"RTN","ACKQUTL5",195,0)
 I ACKCIEN="" Q
"RTN","ACKQUTL5",196,0)
 S ACK(509850.61,ACKCIEN_","_ACKQQIEN_",",.01)="@" D FILE^DIE("","ACK")
"RTN","ACKQUTL5",197,0)
 Q
"RTN","ACKQUTL5",198,0)
ECVOLPRV(DA,ACKQQIEN,X,ACKQQVP,ACKQQDS) ; Update CPT rec. when EC data entered 
"RTN","ACKQUTL5",199,0)
 ;If CPT entry linked with the EC entry - 
"RTN","ACKQUTL5",200,0)
 ;   If ACKQQDS='S'
"RTN","ACKQUTL5",201,0)
 ;     If ACKQQVP='V' set EC vol to CPT vol
"RTN","ACKQUTL5",202,0)
 ;     If ACKQQVP='P' set EC Prvdr to CPT Prvdr
"RTN","ACKQUTL5",203,0)
 ;   If ACKQQDS='D'
"RTN","ACKQUTL5",204,0)
 ;     If ACKQQVP='V' delete CPT vol
"RTN","ACKQUTL5",205,0)
 ;     If ACKQQVP='P' delete CPT Prvdr
"RTN","ACKQUTL5",206,0)
 ;
"RTN","ACKQUTL5",207,0)
 I '$D(ACKEVENT) Q   ; "" or 1 ACKEVENT must be defined
"RTN","ACKQUTL5",208,0)
 Q:'ACKEVENT
"RTN","ACKQUTL5",209,0)
 N ACKFIELD,ACKVAL,ACK,ACKCIEN
"RTN","ACKQUTL5",210,0)
 S ACKCIEN=$$GET1^DIQ(509850.615,DA_","_ACKQQIEN_",",.07)
"RTN","ACKQUTL5",211,0)
 I ACKCIEN="" Q
"RTN","ACKQUTL5",212,0)
 S ACKFIELD=".03" I ACKQQVP="P" S ACKFIELD=".05"
"RTN","ACKQUTL5",213,0)
 S ACKVAL=X I ACKQQDS="D" S ACKVAL="@"
"RTN","ACKQUTL5",214,0)
 S ACK(509850.61,ACKCIEN_","_ACKQQIEN_",",ACKFIELD)=ACKVAL
"RTN","ACKQUTL5",215,0)
 D FILE^DIE("","ACK","")
"RTN","ACKQUTL5",216,0)
 Q
"RTN","ACKQUTL5",217,0)
CPVOLPRV(DA,ACKQQIEN,X,ACKQQVP,ACKQQDS) ; Update EC rec. when CPT data entered 
"RTN","ACKQUTL5",218,0)
 ;If EC entry linked with the CPT entry - 
"RTN","ACKQUTL5",219,0)
 ;   If ACKQQDS='S'
"RTN","ACKQUTL5",220,0)
 ;     If ACKQQVP='V' set CPT vol to EC vol
"RTN","ACKQUTL5",221,0)
 ;     If ACKQQVP='P' set CPT Prvdr to EC Prvdr
"RTN","ACKQUTL5",222,0)
 ;   If ACKQQDS='D'
"RTN","ACKQUTL5",223,0)
 ;     If ACKQQVP='V' delete EC vol
"RTN","ACKQUTL5",224,0)
 ;     If ACKQQVP='P' delete EC Prvdr
"RTN","ACKQUTL5",225,0)
 ;
"RTN","ACKQUTL5",226,0)
 I '$D(ACKEVENT) Q   ; "" or 1 ACKEVENT must be defined
"RTN","ACKQUTL5",227,0)
 Q:ACKEVENT
"RTN","ACKQUTL5",228,0)
 N ACKFIELD,ACKVAL,ACK,ACKEIEN
"RTN","ACKQUTL5",229,0)
 S ACKEIEN=$$GET1^DIQ(509850.61,DA_","_ACKQQIEN_",",.07)
"RTN","ACKQUTL5",230,0)
 I ACKEIEN="" Q
"RTN","ACKQUTL5",231,0)
 S ACKFIELD=".03" I ACKQQVP="P" S ACKFIELD=".05"
"RTN","ACKQUTL5",232,0)
 S ACKVAL=X I ACKQQDS="D" S ACKVAL="@"
"RTN","ACKQUTL5",233,0)
 S ACK(509850.615,ACKEIEN_","_ACKQQIEN_",",ACKFIELD)=ACKVAL
"RTN","ACKQUTL5",234,0)
 D FILE^DIE("","ACK","")
"RTN","ACKQUTL5",235,0)
 Q
"RTN","ACKQUTL5",236,0)
KILLEC(DA,ACKQQIEN) ;  Delets EC entry if CPT entry has EC pter
"RTN","ACKQUTL5",237,0)
 I '$D(ACKEVENT) Q   ; "" or 1 ACKEVENT must be defined
"RTN","ACKQUTL5",238,0)
 Q:ACKEVENT   ; Q if Div set up to use EC's
"RTN","ACKQUTL5",239,0)
 N ACKECIEN,ACK
"RTN","ACKQUTL5",240,0)
 S ACKECIEN=$$GET1^DIQ(509850.61,DA_","_ACKQQIEN_",",.07)
"RTN","ACKQUTL5",241,0)
 I ACKECIEN="" Q
"RTN","ACKQUTL5",242,0)
 S ACK(509850.615,ACKECIEN_","_ACKQQIEN_",",.01)="@" D FILE^DIE("","ACK")
"RTN","ACKQUTL5",243,0)
 Q
"RTN","ACKQUTL5",244,0)
EVENT(ACKDIV,ACKVD) ; params set up for Divn to use EC Codes ?
"RTN","ACKQUTL5",245,0)
 N ACKY,X,Y,ACKM
"RTN","ACKQUTL5",246,0)
 S ACKY=$E(ACKVD,2,3),ACKM=$E(ACKVD,4,5)
"RTN","ACKQUTL5",247,0)
 I ACKM>9 S ACKY=ACKY+1 I $L(ACKY)=1 S ACKY="0"_ACKY
"RTN","ACKQUTL5",248,0)
 I '$D(^ACK(509850.8,1,2,ACKDIV,2,"B",ACKY)) Q 0
"RTN","ACKQUTL5",249,0)
 S ACKKEY=0
"RTN","ACKQUTL5",250,0)
 S ACKKEY=$O(^ACK(509850.8,1,2,ACKDIV,2,"B",ACKY,ACKKEY))
"RTN","ACKQUTL5",251,0)
 S ACKEC=$P(^ACK(509850.8,1,2,ACKDIV,2,ACKKEY,0),"^",2)
"RTN","ACKQUTL5",252,0)
 I ACKEC="" S ACKEC="0"
"RTN","ACKQUTL5",253,0)
 Q ACKEC
"RTN","ACKQUTL5",254,0)
 ;
"RTN","ACKQUTL7")
0^9^B27877671^B27034364
"RTN","ACKQUTL7",1,0)
ACKQUTL7 ;HCIOFO/BH-Template Inquire - A&SP Patient/Visit ; 04/01/99 
"RTN","ACKQUTL7",2,0)
 ;;3.0;QUASAR;**8,22**;Feb 11, 2000;Build 5
"RTN","ACKQUTL7",3,0)
 ;Per VHA Directive 2004-038, this routine SHOULD NOT be modified.
"RTN","ACKQUTL7",4,0)
 ;
"RTN","ACKQUTL7",5,0)
 ;Reference/IA
"RTN","ACKQUTL7",6,0)
 ;
"RTN","ACKQUTL7",7,0)
 ;$$ICDDX^ICDCODE - 3990
"RTN","ACKQUTL7",8,0)
 ;
"RTN","ACKQUTL7",9,0)
 ; 
"RTN","ACKQUTL7",10,0)
INP ;  PRINT INPATIENT INFO
"RTN","ACKQUTL7",11,0)
 W !,"WARD: ",ACK(6),?20,"ROOM/BED: ",ACK(7),?40,"TREATING SPEC:"
"RTN","ACKQUTL7",12,0)
 W $E(ACK(8),1,25)
"RTN","ACKQUTL7",13,0)
 Q
"RTN","ACKQUTL7",14,0)
 ;
"RTN","ACKQUTL7",15,0)
 ;
"RTN","ACKQUTL7",16,0)
EN ;  Get Demographics
"RTN","ACKQUTL7",17,0)
 N I,X,Y K ACKDIRUT
"RTN","ACKQUTL7",18,0)
 D DEM^VADPT,INP^VADPT,ELIG^VADPT
"RTN","ACKQUTL7",19,0)
 S ACKIVD=$$NUMDT^ACKQUTL($P(^ACK(509850.2,ACKPAT,0),U,2))
"RTN","ACKQUTL7",20,0)
 K ACK S ACK(1)=VADM(1),ACK(2)=$P(VADM(3),U,2),ACK(3)=$P(VADM(2),U,2)
"RTN","ACKQUTL7",21,0)
 S ACK(4)=VADM(7),ACK(6)=$P(VAIN(4),U,2)
"RTN","ACKQUTL7",22,0)
 S ACKINP=$S($L(ACK(6)):1,1:0),ACK(5)="Patient is "_$S(ACKINP:"",1:"not ")_"currently an inpatient."
"RTN","ACKQUTL7",23,0)
 S ACK(7)=VAIN(5),ACK(8)=$P(VAIN(3),U,2),ACK(9)=$P(VAEL(1),U,2)
"RTN","ACKQUTL7",24,0)
PRINT ;
"RTN","ACKQUTL7",25,0)
 W @IOF
"RTN","ACKQUTL7",26,0)
 S X="QUASAR V.3.  "_ACKVISIT_" VISIT ENTRY" D CNTR^ACKQUTL(X)
"RTN","ACKQUTL7",27,0)
 ;
"RTN","ACKQUTL7",28,0)
 ;
"RTN","ACKQUTL7",29,0)
 D TPLTE
"RTN","ACKQUTL7",30,0)
 ;
"RTN","ACKQUTL7",31,0)
 ;
"RTN","ACKQUTL7",32,0)
 ;  D RATDIS^ACKQNQ  ;  Display any Rated Disabilities
"RTN","ACKQUTL7",33,0)
 ;
"RTN","ACKQUTL7",34,0)
 W !!,"Patient Diagnostic History",!
"RTN","ACKQUTL7",35,0)
 W $S($P(VADM(5),U)="F":"Ms. ",1:"Mr. "),$P(VADM(1),",")
"RTN","ACKQUTL7",36,0)
 W " has been seen for the following:",!
"RTN","ACKQUTL7",37,0)
 I $Y>(IOSL-8) S DIR(0)="E" D ^DIR K DIR Q:$D(DIRUT)  W @IOF
"RTN","ACKQUTL7",38,0)
 D DIHEAD,ICDSORT
"RTN","ACKQUTL7",39,0)
 K DIRUT W !
"RTN","ACKQUTL7",40,0)
 I '$O(ACKICD("")) W !,"No A&SP Diagnostic Data for this Patient" G EXIT
"RTN","ACKQUTL7",41,0)
 S ACKI=""
"RTN","ACKQUTL7",42,0)
 F  S ACKI=$O(ACKICD(ACKI)) Q:ACKI=""  D:$Y>(IOSL-5) WAIT Q:$D(DIRUT)  W !,$P(ACKICD(ACKI),U),?15,$P(ACKICD(ACKI),U,3),?60,$$NUMDT^ACKQUTL($P(ACKICD(ACKI),U,4))
"RTN","ACKQUTL7",43,0)
EXIT ;
"RTN","ACKQUTL7",44,0)
 I $G(DIRUT)=1 S ACKDIRUT=1  ;  Quit flag for template
"RTN","ACKQUTL7",45,0)
 W !!
"RTN","ACKQUTL7",46,0)
 K %ZIS,ACK,ACKDC,ACKDD,ACKDFN,ACKDN,ACKI,ACKICD,ACKINP,ACKIVD,ACKLINE
"RTN","ACKQUTL7",47,0)
 K ACKRD,DIRUT,DTOUT,DUOUT,VA,VADM,VAEL,VAERR,VAIN,X,X1,Y,ZTDESC,ZTIO
"RTN","ACKQUTL7",48,0)
 K ZTRTN,ZTSAVE
"RTN","ACKQUTL7",49,0)
 W:$E(IOST)'="C" @IOF D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","ACKQUTL7",50,0)
 Q
"RTN","ACKQUTL7",51,0)
 ;
"RTN","ACKQUTL7",52,0)
WAIT ;
"RTN","ACKQUTL7",53,0)
 K DIRUT I $E(IOST)'="C" W @IOF Q
"RTN","ACKQUTL7",54,0)
 S DIR(0)="E" D ^DIR K DIR Q:$D(DIRUT)  W @IOF,"Patient Diagnostic History (Cont'd)","  (",ACK(1),")" D DIHEAD
"RTN","ACKQUTL7",55,0)
 Q
"RTN","ACKQUTL7",56,0)
DIHEAD ;
"RTN","ACKQUTL7",57,0)
 W !,"DIAGNOSIS",?60,"DATE ENTERED" S ACKLINE="",$P(ACKLINE,"-",IOM)="" W !,ACKLINE
"RTN","ACKQUTL7",58,0)
 Q
"RTN","ACKQUTL7",59,0)
ICDSORT ;
"RTN","ACKQUTL7",60,0)
 S ACKI=0 F  S ACKI=$O(^ACK(509850.2,DFN,1,ACKI)) Q:'ACKI  D
"RTN","ACKQUTL7",61,0)
 . S ACKDC=^ACK(509850.2,DFN,1,ACKI,0),ACKDD=$P(ACKDC,U,2)
"RTN","ACKQUTL7",62,0)
 . ;ACKQ*3.0*22 updated api
"RTN","ACKQUTL7",63,0)
 . N ACKTGT S ACKTGT=$$ICDDX^ICDCODE(+ACKDC)
"RTN","ACKQUTL7",64,0)
 . S ACKDN=$P(ACKTGT,U,2)
"RTN","ACKQUTL7",65,0)
 . S ACKICD(ACKDN)=ACKDN_U_$P(ACKTGT,U,3)_U_$$DIAGTXT^ACKQUTL8(+ACKDC,ACKDD)_U_ACKDD
"RTN","ACKQUTL7",66,0)
 Q
"RTN","ACKQUTL7",67,0)
 ;
"RTN","ACKQUTL7",68,0)
TPLTE ;  Display Visit Clinic and Division
"RTN","ACKQUTL7",69,0)
 N ACKTMPE
"RTN","ACKQUTL7",70,0)
 W !!,"CLINIC: ",$$GET1^DIQ(509850.6,ACKVIEN,"2.6")
"RTN","ACKQUTL7",71,0)
 W ?45,"DIVISION: ",$$GET1^DIQ(509850.6,ACKVIEN,60),!
"RTN","ACKQUTL7",72,0)
 ;  Display more Patient data
"RTN","ACKQUTL7",73,0)
 W "PATIENT: ",ACK(1),?45,"DOB: ",ACK(2),?63,"SSN: ",ACK(3)
"RTN","ACKQUTL7",74,0)
 ;  If no Visit Eligibility on visit file display Primary Elig.
"RTN","ACKQUTL7",75,0)
 S ACKTMPE=$$GET1^DIQ(509850.6,ACKVIEN_",",80,"E")
"RTN","ACKQUTL7",76,0)
 I ACKTMPE D 
"RTN","ACKQUTL7",77,0)
 . W !,"VISIT ELIGIBILITY: "_ACKTMPE
"RTN","ACKQUTL7",78,0)
 ;
"RTN","ACKQUTL7",79,0)
 I 'ACKTMPE D
"RTN","ACKQUTL7",80,0)
 .W !,"ELIGIBILITY: ",ACK(9)
"RTN","ACKQUTL7",81,0)
 W ?45,"INITIAL VISIT DATE: ",ACKIVD
"RTN","ACKQUTL7",82,0)
 W:$L(ACK(4)) !,ACK(4) W !,ACK(5) D:ACKINP INP
"RTN","ACKQUTL7",83,0)
 ;  D VISIT
"RTN","ACKQUTL7",84,0)
 ;
"RTN","ACKQUTL7",85,0)
 Q
"RTN","ACKQUTL7",86,0)
 ;
"RTN","ACKQUTL7",87,0)
VISIT ;  Displays Service connected data
"RTN","ACKQUTL7",88,0)
 ;
"RTN","ACKQUTL7",89,0)
 I 'ACKSC Q        ;  If Patient not service connected QUIT
"RTN","ACKQUTL7",90,0)
 I 'ACKPCE Q       ;  If system not set up for PCE then QUIT
"RTN","ACKQUTL7",91,0)
 ;
"RTN","ACKQUTL7",92,0)
 N ACKX,ACKVV,ACKPP,ACKVSC,ACKAAO,ACKEENV,ACKRRAD,ACK,ACKSTR
"RTN","ACKQUTL7",93,0)
 ;
"RTN","ACKQUTL7",94,0)
 D GETDATA
"RTN","ACKQUTL7",95,0)
 I ACKVISIT="NEW",$G(ACKPCENO)="" D UNKNOWN Q
"RTN","ACKQUTL7",96,0)
 I 'ACKVSC D NOT("This Visit's Treatment :",ACKAAO,ACKRRAD,ACKEENV) Q
"RTN","ACKQUTL7",97,0)
 I ACKVSC D CONNECT
"RTN","ACKQUTL7",98,0)
 Q
"RTN","ACKQUTL7",99,0)
 ;
"RTN","ACKQUTL7",100,0)
 ;
"RTN","ACKQUTL7",101,0)
GETDATA ;  Get visit data
"RTN","ACKQUTL7",102,0)
 ;
"RTN","ACKQUTL7",103,0)
 K ACK
"RTN","ACKQUTL7",104,0)
 D GETS^DIQ(509850.6,ACKVIEN,"20;25;30;35","I","ACK")
"RTN","ACKQUTL7",105,0)
 S ACKVSC=ACK(509850.6,ACKVIEN_",",20,"I")
"RTN","ACKQUTL7",106,0)
 S ACKAAO=ACK(509850.6,ACKVIEN_",",25,"I")
"RTN","ACKQUTL7",107,0)
 S ACKEENV=ACK(509850.6,ACKVIEN_",",35,"I")
"RTN","ACKQUTL7",108,0)
 S ACKRRAD=ACK(509850.6,ACKVIEN_",",30,"I")
"RTN","ACKQUTL7",109,0)
 K ACK
"RTN","ACKQUTL7",110,0)
 Q
"RTN","ACKQUTL7",111,0)
 ;
"RTN","ACKQUTL7",112,0)
CONNECT W !!,"This visit's Treatment is Service Connected.",!
"RTN","ACKQUTL7",113,0)
 Q
"RTN","ACKQUTL7",114,0)
 ;
"RTN","ACKQUTL7",115,0)
NOT(ACKSTR,ACKAAO,ACKRRAD,ACKEENV) ;
"RTN","ACKQUTL7",116,0)
 W !!,ACKSTR,!
"RTN","ACKQUTL7",117,0)
 W "------------------------------------------------------------------------------"
"RTN","ACKQUTL7",118,0)
 ;
"RTN","ACKQUTL7",119,0)
 W !,"Related to AGENT ORANGE ? : "_$S(ACKAAO="1":"YES",1:"NO") W ?50,"Service Connected ? : NO"
"RTN","ACKQUTL7",120,0)
 ;       
"RTN","ACKQUTL7",121,0)
 W !,"Related to RADIATION EXPOSURE ? : "_$S(ACKRRAD="1":"YES",1:"NO")
"RTN","ACKQUTL7",122,0)
 ;               
"RTN","ACKQUTL7",123,0)
 W !,"Related to ENVIRONMENTAL CONTAMINANTS ? : "_$S(ACKEENV="1":"YES",1:"NO")
"RTN","ACKQUTL7",124,0)
 Q
"RTN","ACKQUTL7",125,0)
 ;
"RTN","ACKQUTL7",126,0)
UNKNOWN N ACKPASS
"RTN","ACKQUTL7",127,0)
 S ACKPASS=0
"RTN","ACKQUTL7",128,0)
 W !!,"This visit's Treatment:",!
"RTN","ACKQUTL7",129,0)
 W "------------------------------------------------------------------------------",!
"RTN","ACKQUTL7",130,0)
 I ACKAO W "Related to AGENT ORANGE ? : UNKNOWN" D:'ACKPASS SERV
"RTN","ACKQUTL7",131,0)
 I ACKRAD W !,"Related to RADIATION EXPOSURE ? : UNKNOWN" D:'ACKPASS SERV
"RTN","ACKQUTL7",132,0)
 I ACKENV W !,"Related to ENVIRONMENTAL CONTAMINANTS ? : UNKNOWN" D:'ACKPASS SERV
"RTN","ACKQUTL7",133,0)
 D:'ACKPASS SERV
"RTN","ACKQUTL7",134,0)
 W !
"RTN","ACKQUTL7",135,0)
 Q
"RTN","ACKQUTL7",136,0)
 ;
"RTN","ACKQUTL7",137,0)
SERV ;
"RTN","ACKQUTL7",138,0)
 W ?50,"Service Connected ? : UNKNOWN" S ACKPASS=1
"RTN","ACKQUTL7",139,0)
 Q
"RTN","ACKQUTL7",140,0)
 ;
"RTN","ACKQUTL7",141,0)
ERROR ; Display error message if registration returns error that indicates
"RTN","ACKQUTL7",142,0)
 ; that the Appointment Management database is not available.
"RTN","ACKQUTL7",143,0)
 ;
"RTN","ACKQUTL7",144,0)
 N ACKERR
"RTN","ACKQUTL7",145,0)
 W !!!!,"   ** The Appointment Management Data Base is unavailable. **"
"RTN","ACKQUTL7",146,0)
 W !!,"   ** Please report this problem to IRM as soon as possible. **",!!!
"RTN","ACKQUTL7",147,0)
 W "   Press any key to continue."
"RTN","ACKQUTL7",148,0)
 R ACKERR:DTIME
"RTN","ACKQUTL7",149,0)
 ; 
"RTN","ACKQUTL7",150,0)
 Q
"RTN","ACKQUTL7",151,0)
 ;
"VER")
8.0^22.0
"BLD",9481,6)
^17
**END**
**END**
