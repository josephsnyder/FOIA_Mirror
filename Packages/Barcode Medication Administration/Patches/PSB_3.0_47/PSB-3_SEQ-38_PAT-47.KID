Released PSB*3*47 SEQ #38
Extracted from mail message
**KIDS**:PSB*3.0*47^

**INSTALL NAME**
PSB*3.0*47
"BLD",6945,0)
PSB*3.0*47^BAR CODE MED ADMIN^0^3090623^y
"BLD",6945,1,0)
^^8^8^3090427^
"BLD",6945,1,1,0)
This patch provides the components for the Class III to Class I conversion
"BLD",6945,1,2,0)
project Immunizations Documentation by BCMA.
"BLD",6945,1,3,0)
 
"BLD",6945,1,4,0)
Included in this patch is a new option named Immunizations Documentation
"BLD",6945,1,5,0)
by BCMA Nightly Task [PSB PX BCMA2PCE TASK].
"BLD",6945,1,6,0)
 
"BLD",6945,1,7,0)
Patch PSS*1*141 provides the Pharmacy Data Management portion of the
"BLD",6945,1,8,0)
project.
"BLD",6945,4,0)
^9.64PA^^
"BLD",6945,6.3)
7
"BLD",6945,"KRN",0)
^9.67PA^779.2^20
"BLD",6945,"KRN",.4,0)
.4
"BLD",6945,"KRN",.401,0)
.401
"BLD",6945,"KRN",.402,0)
.402
"BLD",6945,"KRN",.403,0)
.403
"BLD",6945,"KRN",.5,0)
.5
"BLD",6945,"KRN",.84,0)
.84
"BLD",6945,"KRN",3.6,0)
3.6
"BLD",6945,"KRN",3.8,0)
3.8
"BLD",6945,"KRN",9.2,0)
9.2
"BLD",6945,"KRN",9.8,0)
9.8
"BLD",6945,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6945,"KRN",9.8,"NM",1,0)
PSBPXFL^^0^B3537740
"BLD",6945,"KRN",9.8,"NM",2,0)
PSBPXLP^^0^B5503745
"BLD",6945,"KRN",9.8,"NM","B","PSBPXFL",1)

"BLD",6945,"KRN",9.8,"NM","B","PSBPXLP",2)

"BLD",6945,"KRN",19,0)
19
"BLD",6945,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",6945,"KRN",19,"NM",1,0)
PSB PX BCMA2PCE TASK^^0
"BLD",6945,"KRN",19,"NM",2,0)
PSB MGR^^2
"BLD",6945,"KRN",19,"NM","B","PSB MGR",2)

"BLD",6945,"KRN",19,"NM","B","PSB PX BCMA2PCE TASK",1)

"BLD",6945,"KRN",19.1,0)
19.1
"BLD",6945,"KRN",101,0)
101
"BLD",6945,"KRN",409.61,0)
409.61
"BLD",6945,"KRN",771,0)
771
"BLD",6945,"KRN",779.2,0)
779.2
"BLD",6945,"KRN",870,0)
870
"BLD",6945,"KRN",8989.51,0)
8989.51
"BLD",6945,"KRN",8989.52,0)
8989.52
"BLD",6945,"KRN",8994,0)
8994
"BLD",6945,"KRN","B",.4,.4)

"BLD",6945,"KRN","B",.401,.401)

"BLD",6945,"KRN","B",.402,.402)

"BLD",6945,"KRN","B",.403,.403)

"BLD",6945,"KRN","B",.5,.5)

"BLD",6945,"KRN","B",.84,.84)

"BLD",6945,"KRN","B",3.6,3.6)

"BLD",6945,"KRN","B",3.8,3.8)

"BLD",6945,"KRN","B",9.2,9.2)

"BLD",6945,"KRN","B",9.8,9.8)

"BLD",6945,"KRN","B",19,19)

"BLD",6945,"KRN","B",19.1,19.1)

"BLD",6945,"KRN","B",101,101)

"BLD",6945,"KRN","B",409.61,409.61)

"BLD",6945,"KRN","B",771,771)

"BLD",6945,"KRN","B",779.2,779.2)

"BLD",6945,"KRN","B",870,870)

"BLD",6945,"KRN","B",8989.51,8989.51)

"BLD",6945,"KRN","B",8989.52,8989.52)

"BLD",6945,"KRN","B",8994,8994)

"BLD",6945,"QUES",0)
^9.62^^
"BLD",6945,"REQB",0)
^9.611^1^1
"BLD",6945,"REQB",1,0)
PSS*1.0*141^2
"BLD",6945,"REQB","B","PSS*1.0*141",1)

"KRN",19,11598,-1)
2^2
"KRN",19,11598,0)
PSB MGR^Bar Code Medication Administration Manager^^M^10000000043^PSB MANAGER^^^^^^536
"KRN",19,11598,10,0)
^19.01IP^10^9
"KRN",19,11598,10,10,0)
13433
"KRN",19,11598,10,10,"^")
PSB PX BCMA2PCE TASK
"KRN",19,11598,"U")
BAR CODE MEDICATION ADMINISTRA
"KRN",19,13433,-1)
0^1
"KRN",19,13433,0)
PSB PX BCMA2PCE TASK^Immunizations Documentation by BCMA Nightly Task^^R^^^^^^^^BAR CODE MED ADMIN
"KRN",19,13433,1,0)
^^12^12^3081205^
"KRN",19,13433,1,1,0)
This option is intended to be scheduled as a nightly task, with
"KRN",19,13433,1,2,0)
a start time after midnight but before 0800.  When the task runs,
"KRN",19,13433,1,3,0)
it will create a record in the V IMMUNIZATIONS file for each medication
"KRN",19,13433,1,4,0)
administration recorded the previous day for which there is a mapped
"KRN",19,13433,1,5,0)
association between the PHARMACY ORDERABLE ITEM and an IMMUNIZATION.
"KRN",19,13433,1,6,0)
 
"KRN",19,13433,1,7,0)
When run interactively, the option will prompt the user for a start date, 
"KRN",19,13433,1,8,0)
allowing a manual backlog of immunization data to be recorded from BCMA 
"KRN",19,13433,1,9,0)
intto PCE.
"KRN",19,13433,1,10,0)
 
"KRN",19,13433,1,11,0)
Created by PSS*3*47 as part of Class III to Class I Conversion Project
"KRN",19,13433,1,12,0)
"Immunizations Documentation by BCMA"
"KRN",19,13433,25)
TASK^PSBPXLP
"KRN",19,13433,200.9)
y
"KRN",19,13433,"U")
IMMUNIZATIONS DOCUMENTATION BY
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",536,-1)
1^1
"PKG",536,0)
BAR CODE MED ADMIN^PSB^BAR CODE MEDICATION ADMINISTRATION
"PKG",536,20,0)
^9.402P^^
"PKG",536,22,0)
^9.49I^1^1
"PKG",536,22,1,0)
3.0^3040224^3040819^11874
"PKG",536,22,1,"PAH",1,0)
47^3090623
"PKG",536,22,1,"PAH",1,1,0)
^^8^8^3090623
"PKG",536,22,1,"PAH",1,1,1,0)
This patch provides the components for the Class III to Class I conversion
"PKG",536,22,1,"PAH",1,1,2,0)
project Immunizations Documentation by BCMA.
"PKG",536,22,1,"PAH",1,1,3,0)
 
"PKG",536,22,1,"PAH",1,1,4,0)
Included in this patch is a new option named Immunizations Documentation
"PKG",536,22,1,"PAH",1,1,5,0)
by BCMA Nightly Task [PSB PX BCMA2PCE TASK].
"PKG",536,22,1,"PAH",1,1,6,0)
 
"PKG",536,22,1,"PAH",1,1,7,0)
Patch PSS*1*141 provides the Pharmacy Data Management portion of the
"PKG",536,22,1,"PAH",1,1,8,0)
project.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSBPXFL")
0^1^B3537740^n/a
"RTN","PSBPXFL",1,0)
PSBPXFL ;BIR/RMS - BCMA TO PCE LINK FOR IMMUNIZATIONS ; 4/29/09 2:08pm
"RTN","PSBPXFL",2,0)
 ;;3.0;BAR CODE MED ADMIN;**47**;Mar 2004;Build 7
"RTN","PSBPXFL",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBPXFL",4,0)
 ;
"RTN","PSBPXFL",5,0)
 ; Reference/IA
"RTN","PSBPXFL",6,0)
 ; $$DATA2PCE^PXAPI/1889
"RTN","PSBPXFL",7,0)
 ; $$PKG2IEN^VSIT/1904
"RTN","PSBPXFL",8,0)
 ;
"RTN","PSBPXFL",9,0)
BCMA2PCE(PSBDFN,PSBIMM,PSBDX,PSBDT,PSBWHO) ;
"RTN","PSBPXFL",10,0)
 D CLEAN
"RTN","PSBPXFL",11,0)
 D SETUP
"RTN","PSBPXFL",12,0)
 Q:$G(PSBSTOP)
"RTN","PSBPXFL",13,0)
 S PSBRSLT=$$DATA2PCE^PXAPI(PSBROOT,PSBPKG,PSBSRC)
"RTN","PSBPXFL",14,0)
 W:$E(IOST)="C" !,"Result code: ",PSBRSLT
"RTN","PSBPXFL",15,0)
 D CLEAN
"RTN","PSBPXFL",16,0)
 Q
"RTN","PSBPXFL",17,0)
SETUP S PSBROOT="^TMP(""PSBXAPI"",$J)"
"RTN","PSBPXFL",18,0)
 S PSBPKG=$$PKG2IEN^VSIT("PSB")
"RTN","PSBPXFL",19,0)
 S PSBSRC="EXTERNAL API"
"RTN","PSBPXFL",20,0)
ENC S @PSBROOT@("ENCOUNTER",1,"ENC D/T")=$G(PSBDT,DT)
"RTN","PSBPXFL",21,0)
 S @PSBROOT@("ENCOUNTER",1,"PATIENT")=PSBDFN
"RTN","PSBPXFL",22,0)
 S @PSBROOT@("ENCOUNTER",1,"HOS LOC")=$$LOC Q:$G(PSBSTOP)
"RTN","PSBPXFL",23,0)
 S @PSBROOT@("ENCOUNTER",1,"SERVICE CATEGORY")="E"
"RTN","PSBPXFL",24,0)
 S @PSBROOT@("ENCOUNTER",1,"INSTITUTION")=+$$SITE^VASITE
"RTN","PSBPXFL",25,0)
 S @PSBROOT@("ENCOUNTER",1,"ENCOUNTER TYPE")="P"
"RTN","PSBPXFL",26,0)
 S @PSBROOT@("ENCOUNTER",1,"SC")=$$SC
"RTN","PSBPXFL",27,0)
PROV S @PSBROOT@("PROVIDER",1,"NAME")=PSBWHO
"RTN","PSBPXFL",28,0)
IMMUN S @PSBROOT@("IMMUNIZATION",1,"COMMENT")="@"
"RTN","PSBPXFL",29,0)
 S @PSBROOT@("IMMUNIZATION",1,"CONTRAINDICATED")=0
"RTN","PSBPXFL",30,0)
 S @PSBROOT@("IMMUNIZATION",1,"IMMUN")=PSBIMM
"RTN","PSBPXFL",31,0)
 S @PSBROOT@("IMMUNIZATION",1,"REACTION")="@"
"RTN","PSBPXFL",32,0)
 S @PSBROOT@("IMMUNIZATION",1,"SERIES")="@"
"RTN","PSBPXFL",33,0)
SC() ;SERVICE CONNECTED
"RTN","PSBPXFL",34,0)
 N VAEL
"RTN","PSBPXFL",35,0)
 S DFN=PSBDFN
"RTN","PSBPXFL",36,0)
 D ELIG^VADPT
"RTN","PSBPXFL",37,0)
 Q $S(+VAEL(3)=1:0,1:"")
"RTN","PSBPXFL",38,0)
LOC() ;HOSPITAL LOCATION
"RTN","PSBPXFL",39,0)
 N DFN,VAIP
"RTN","PSBPXFL",40,0)
 S DFN=PSBDFN
"RTN","PSBPXFL",41,0)
 S VAIP("D")="L"
"RTN","PSBPXFL",42,0)
 D IN5^VADPT
"RTN","PSBPXFL",43,0)
 S PSBLOC=$G(^DIC(42,+VAIP(5),44))
"RTN","PSBPXFL",44,0)
 S:PSBLOC']"" PSBSTOP=1
"RTN","PSBPXFL",45,0)
 Q PSBLOC
"RTN","PSBPXFL",46,0)
 ;
"RTN","PSBPXFL",47,0)
CLEAN K ^TMP("PSBPXAPI",$J)
"RTN","PSBPXFL",48,0)
 K PSBSTOP,PSBROOT,PSBPKG,PSBSRC,PSBRSLT,PSBLOC
"RTN","PSBPXFL",49,0)
 Q
"RTN","PSBPXLP")
0^2^B5503745^n/a
"RTN","PSBPXLP",1,0)
PSBPXLP ;BIR/RMS - BCMA2PCE FOR IMMUNIZATIONS, TASKED ; 6/23/09 4:16pm
"RTN","PSBPXLP",2,0)
 ;;3.0;BAR CODE MED ADMIN;**47**;Mar 2004;Build 7
"RTN","PSBPXLP",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBPXLP",4,0)
 ;
"RTN","PSBPXLP",5,0)
 ; Reference/IA
"RTN","PSBPXLP",6,0)
 ; File 50.7/2180
"RTN","PSBPXLP",7,0)
 ; File 9999999.14/1990
"RTN","PSBPXLP",8,0)
 ; ^AUPNVIMM("AA"/2313
"RTN","PSBPXLP",9,0)
 ;
"RTN","PSBPXLP",10,0)
 ;Class III to Class I Conversion Project
"RTN","PSBPXLP",11,0)
 ;Contributions of George Holcomb (West Palm Beach) and
"RTN","PSBPXLP",12,0)
 ;Geri Wittenberg (Hines, now at North Chicago) are acknowleged.
"RTN","PSBPXLP",13,0)
 ;--------------------------------------------------------------
"RTN","PSBPXLP",14,0)
 ;
"RTN","PSBPXLP",15,0)
TASK I $D(ZTQUEUED) G TASK2
"RTN","PSBPXLP",16,0)
 N %DT,DTOUT,X,X1,X2,Y,PSBDTB,PSBUDT
"RTN","PSBPXLP",17,0)
 S X1=DT,X2=-1 D C^%DTC S PSBDTB=X\1
"RTN","PSBPXLP",18,0)
 W !,"Immunizations Documentation by BCMA",!
"RTN","PSBPXLP",19,0)
 S %DT="AEP",%DT("A")="Select START DATE: "
"RTN","PSBPXLP",20,0)
 S %DT("B")=$$FMTE^XLFDT(X),%DT(0)=-PSBDTB
"RTN","PSBPXLP",21,0)
 D ^%DT
"RTN","PSBPXLP",22,0)
 Q:Y'>0
"RTN","PSBPXLP",23,0)
 S PSBUDT=$$FMADD^XLFDT(Y,1)\1
"RTN","PSBPXLP",24,0)
 D TASK2
"RTN","PSBPXLP",25,0)
 Q
"RTN","PSBPXLP",26,0)
 ;
"RTN","PSBPXLP",27,0)
TASK2 N PAT,REC,STARTDT,X,X1,X2
"RTN","PSBPXLP",28,0)
 N PSB507,PSBDFN,PSBIMM,PSBDX,PSBDT,PSBDATE,PSBWHO
"RTN","PSBPXLP",29,0)
 S X1=$G(PSBUDT,DT),X2=-1 D C^%DTC S STARTDT=X-.000001
"RTN","PSBPXLP",30,0)
 S PAT=0 F  S PAT=$O(^PSB(53.79,"AADT",PAT)) Q:'PAT  D
"RTN","PSBPXLP",31,0)
 .S PSBDATE=STARTDT F  S PSBDATE=$O(^PSB(53.79,"AADT",PAT,PSBDATE)) Q:'PSBDATE!(PSBDATE'<DT)  D
"RTN","PSBPXLP",32,0)
 ..S REC=0 F  S REC=$O(^PSB(53.79,"AADT",PAT,PSBDATE,REC)) Q:'REC  D
"RTN","PSBPXLP",33,0)
 ...Q:$P($G(^PSB(53.79,REC,0)),"^",9)'="G"
"RTN","PSBPXLP",34,0)
 ...S PSB507=$P(^PSB(53.79,REC,0),"^",8) Q:'+PSB507
"RTN","PSBPXLP",35,0)
 ...S PSBIMM=+$G(^PS(50.7,PSB507,"IMM")) Q:'+PSBIMM
"RTN","PSBPXLP",36,0)
 ...S PSBDFN=$P(^PSB(53.79,REC,0),"^")
"RTN","PSBPXLP",37,0)
 ...S PSBDT=$P(^PSB(53.79,REC,0),"^",6)\1
"RTN","PSBPXLP",38,0)
 ...S PSBWHO=$P(^PSB(53.79,REC,0),"^",7)
"RTN","PSBPXLP",39,0)
 ...W:$E(IOST)="C" !,$E($$GET1^DIQ(2,PSBDFN,.01),1,20),?25,$E($$GET1^DIQ(9999999.14,PSBIMM,.01),1,12)," (",$$FMTE^XLFDT(PSBDT,2),")",?50,$$GET1^DIQ(200,PSBWHO,.01) ; FOR TROUBLESHOOTING ASSISTANCE
"RTN","PSBPXLP",40,0)
 ...I $D(^AUPNVIMM("AA",PSBDFN,PSBIMM,9999999-PSBDT)) D  Q  ;->
"RTN","PSBPXLP",41,0)
 ....I $E(IOST)="C" W !,"Result: Immunization already on file."
"RTN","PSBPXLP",42,0)
 ...D BCMA2PCE^PSBPXFL(PSBDFN,PSBIMM,"",PSBDT,PSBWHO)
"RTN","PSBPXLP",43,0)
 Q
"VER")
8.0^22.0
"BLD",6945,6)
^38
**END**
**END**
