Released PSB*3*33 SEQ #37
Extracted from mail message
**KIDS**:PSB*3.0*33^

**INSTALL NAME**
PSB*3.0*33
"BLD",7548,0)
PSB*3.0*33^BAR CODE MED ADMIN^0^3090107^y
"BLD",7548,1,0)
^^1^1^3090107^^^
"BLD",7548,1,1,0)
ONE-TIME PRN CAN BE GIVEN MULTIPLE TIMES.
"BLD",7548,4,0)
^9.64PA^^
"BLD",7548,6)
6^
"BLD",7548,6.3)
14
"BLD",7548,"ABPKG")
n
"BLD",7548,"INID")
n^n^n
"BLD",7548,"KRN",0)
^9.67PA^8989.52^19
"BLD",7548,"KRN",.4,0)
.4
"BLD",7548,"KRN",.4,"NM",0)
^9.68A^^
"BLD",7548,"KRN",.401,0)
.401
"BLD",7548,"KRN",.402,0)
.402
"BLD",7548,"KRN",.403,0)
.403
"BLD",7548,"KRN",.5,0)
.5
"BLD",7548,"KRN",.84,0)
.84
"BLD",7548,"KRN",3.6,0)
3.6
"BLD",7548,"KRN",3.8,0)
3.8
"BLD",7548,"KRN",9.2,0)
9.2
"BLD",7548,"KRN",9.8,0)
9.8
"BLD",7548,"KRN",9.8,"NM",0)
^9.68A^3^1
"BLD",7548,"KRN",9.8,"NM",3,0)
PSBML^^0^B81177596
"BLD",7548,"KRN",9.8,"NM","B","PSBML",3)

"BLD",7548,"KRN",19,0)
19
"BLD",7548,"KRN",19.1,0)
19.1
"BLD",7548,"KRN",101,0)
101
"BLD",7548,"KRN",409.61,0)
409.61
"BLD",7548,"KRN",771,0)
771
"BLD",7548,"KRN",870,0)
870
"BLD",7548,"KRN",8989.51,0)
8989.51
"BLD",7548,"KRN",8989.52,0)
8989.52
"BLD",7548,"KRN",8994,0)
8994
"BLD",7548,"KRN","B",.4,.4)

"BLD",7548,"KRN","B",.401,.401)

"BLD",7548,"KRN","B",.402,.402)

"BLD",7548,"KRN","B",.403,.403)

"BLD",7548,"KRN","B",.5,.5)

"BLD",7548,"KRN","B",.84,.84)

"BLD",7548,"KRN","B",3.6,3.6)

"BLD",7548,"KRN","B",3.8,3.8)

"BLD",7548,"KRN","B",9.2,9.2)

"BLD",7548,"KRN","B",9.8,9.8)

"BLD",7548,"KRN","B",19,19)

"BLD",7548,"KRN","B",19.1,19.1)

"BLD",7548,"KRN","B",101,101)

"BLD",7548,"KRN","B",409.61,409.61)

"BLD",7548,"KRN","B",771,771)

"BLD",7548,"KRN","B",870,870)

"BLD",7548,"KRN","B",8989.51,8989.51)

"BLD",7548,"KRN","B",8989.52,8989.52)

"BLD",7548,"KRN","B",8994,8994)

"BLD",7548,"QUES",0)
^9.62^^
"BLD",7548,"REQB",0)
^9.611^3^2
"BLD",7548,"REQB",2,0)
PSJ*5.0*190^2
"BLD",7548,"REQB",3,0)
PSB*3.0*45^2
"BLD",7548,"REQB","B","PSB*3.0*45",3)

"BLD",7548,"REQB","B","PSJ*5.0*190",2)

"MBREQ")
0
"PKG",537,-1)
1^1
"PKG",537,0)
BAR CODE MED ADMIN^PSB^BAR CODE MEDICATION ADMINISTRATION
"PKG",537,20,0)
^9.402P^^
"PKG",537,22,0)
^9.49I^1^1
"PKG",537,22,1,0)
3.0^3040224^3040504^22979
"PKG",537,22,1,"PAH",1,0)
33^3090107^33288
"PKG",537,22,1,"PAH",1,1,0)
^^1^1^3090107
"PKG",537,22,1,"PAH",1,1,1,0)
ONE-TIME PRN CAN BE GIVEN MULTIPLE TIMES.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSBML")
0^3^B81177596^B79215429
"RTN","PSBML",1,0)
PSBML ;BIRMINGHAM/EFC-BCMA MED LOG FUNCTIONS ; 1/7/09 9:57am
"RTN","PSBML",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,3,4,9,11,13,25,45,33**;Mar 2004;Build 14
"RTN","PSBML",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSBML",4,0)
 ; Reference/IA
"RTN","PSBML",5,0)
 ; ^DPT/10035
"RTN","PSBML",6,0)
 ; DIC(42/10039
"RTN","PSBML",7,0)
 ; DIC(42/2440
"RTN","PSBML",8,0)
 ; File 200/10060
"RTN","PSBML",9,0)
 ; EN^PSJBCMA3/3320
"RTN","PSBML",10,0)
 ; $$SITE^VASITE/10112
"RTN","PSBML",11,0)
 ; ^XUSEC(/10076
"RTN","PSBML",12,0)
 ;
"RTN","PSBML",13,0)
RPC(RESULTS,PSBHDR,PSBREC) ;BCMA MedLog Filing
"RTN","PSBML",14,0)
 S PSBEDTFL=0
"RTN","PSBML",15,0)
 N PSBORD,PSBTRAN,PSBFDA
"RTN","PSBML",16,0)
 K PSBIEN,PSBHL7
"RTN","PSBML",17,0)
 S PSBIEN=$P(PSBHDR,U,1)
"RTN","PSBML",18,0)
 S PSBTRAN=$P(PSBHDR,U,2),PSBHL7=PSBTRAN
"RTN","PSBML",19,0)
 S PSBINST=$P($G(PSBHDR),U,3)
"RTN","PSBML",20,0)
 ;PSB*3*45 We should be recording the first entry in the audit log.
"RTN","PSBML",21,0)
 ;S PSBAUDIT=$S(PSBIEN="+1":0,1:1)
"RTN","PSBML",22,0)
 S PSBAUDIT=1
"RTN","PSBML",23,0)
 D NOW^%DTC S PSBNOW=%
"RTN","PSBML",24,0)
 I $D(^XUSEC("PSB STUDENT",DUZ)),PSBINST="" S RESULTS(0)=1,RESULTS(1)="-1^Instructor not present" Q
"RTN","PSBML",25,0)
 I $D(^XUSEC("PSB STUDENT",DUZ)),'$D(^XUSEC("PSB INSTRUCTOR",PSBINST)) S RESULTS(0)=1,RESULTS(1)="-1^Instructor doesn't have authority" Q
"RTN","PSBML",26,0)
 S PSBINST(0)=$$GET1^DIQ(200,PSBINST_",",.01)
"RTN","PSBML",27,0)
 I PSBTRAN="ADD COMMENT" D COMMENT^PSBML1 Q
"RTN","PSBML",28,0)
 I PSBTRAN="PRN EFFECTIVENESS" D PRN^PSBML1 Q
"RTN","PSBML",29,0)
 I PSBTRAN="UPDATE STATUS" D  Q
"RTN","PSBML",30,0)
 .I '$D(^PSB(53.79,PSBIEN)) S RESULTS(0)=1,RESULTS(1)="-1^Administration is at an UNKNOWN STATUS" Q
"RTN","PSBML",31,0)
 .D UPDATED^PSBML2
"RTN","PSBML",32,0)
 I PSBTRAN="EDIT" D EDIT^PSBML2 Q
"RTN","PSBML",33,0)
 ;SAGG
"RTN","PSBML",34,0)
 N PSBWARD S PSBWARD=$G(^DPT(+$G(PSBREC(0)),.1),"UNKNOWN"),^PSB("SAGG",PSBWARD,DT)=$G(^PSB("SAGG",PSBWARD,DT))+1
"RTN","PSBML",35,0)
 I PSBREC(1)?1U1";"1.6N S PSBREC(1)=$P(PSBREC(1),";",1)_$E(PSBREC(1))
"RTN","PSBML",36,0)
 D PSJ1^PSBVT(PSBREC(0),$P(PSBREC(1),";",2)_$P(PSBREC(1),";",1))
"RTN","PSBML",37,0)
 S PSBTAB=$P(PSBREC(9),U,1),PSBUID=$P(PSBREC(9),U,2)
"RTN","PSBML",38,0)
 D:PSBTRAN="MEDPASS"
"RTN","PSBML",39,0)
 .I (PSBDOSEF["PATCH"),(PSBREC(3)="G") D  Q:+$G(RESULTS(1))<0
"RTN","PSBML",40,0)
 ..S PSBXDT="" F  S PSBXDT=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBXDT)) Q:PSBXDT=""  D  Q:+$G(RESULTS(1))<0
"RTN","PSBML",41,0)
 ...S PSBYZ="" F  S PSBYZ=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBXDT,PSBYZ)) Q:'PSBYZ  I ("G"[$$GET1^DIQ(53.79,PSBYZ,.09,"I")) D  Q
"RTN","PSBML",42,0)
 ....S:($$GET1^DIQ(53.79,PSBYZ,.09,"I")="G") RESULTS(0)=1,RESULTS(1)="-1^Previous Patch has not been removed. Administration canceled."
"RTN","PSBML",43,0)
 ....S:($$GET1^DIQ(53.79,PSBYZ,.09,"I")="")&(($$GET1^DIQ(53.79,PSBYZ,.07,"I")'=DUZ)&('$D(^XUSEC("PSB MANAGER",DUZ)))) RESULTS(0)=1,RESULTS(1)="-1^Patch status ""*UNKNOWN*"". Administration canceled."
"RTN","PSBML",44,0)
 .I PSBREC(7)="BCMA/CPRS Interface Entry." S PSBNOW=PSBREC(5)  ;MOB
"RTN","PSBML",45,0)
 .F X=0:1:9 S PSBREC(X)=$G(PSBREC(X))
"RTN","PSBML",46,0)
 .I PSBREC(1)?1U1";".N S PSBREC(1)=$P(PSBREC(1),";",2)_$P(PSBREC(1),";",1)
"RTN","PSBML",47,0)
 .I PSBREC(1)["V",+PSBREC(5)>0,+$P(PSBREC(5),".",2)=0,PSBIVT'["P" D NOW^%DTC S PSBREC(5)=$P(PSBREC(5),".",1)_"."_$P(%,".",2)
"RTN","PSBML",48,0)
 .I $P(PSBREC(9),U,1)="IVTAB",$P(PSBREC(9),U,2)="" S PSBUID=$$GETWSID^PSBVDLU2(PSBREC(0),PSBREC(1))
"RTN","PSBML",49,0)
 .I $P(PSBREC(9),U,1)="PBTAB",$P(PSBREC(9),U,2)="",PSBREC(1)'["U",PSBREC(3)'="M",PSBREC(3)'="R",PSBREC(3)'="H" S PSBUID=$$GETWSID^PSBVDLU2(PSBREC(0),PSBREC(1))
"RTN","PSBML",50,0)
 .;OnCal
"RTN","PSBML",51,0)
 .D:PSBREC(2)="OC"
"RTN","PSBML",52,0)
 ..S X=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),"")) Q:X=""
"RTN","PSBML",53,0)
 ..S Y=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),X,0))
"RTN","PSBML",54,0)
 ..I $P(^PSB(53.79,Y,0),U,9)="G"&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL")) D ERR(1,"On-Call already given")
"RTN","PSBML",55,0)
 .;1x
"RTN","PSBML",56,0)
 .D:PSBREC(2)="O"
"RTN","PSBML",57,0)
 ..S X=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),"")) Q:X=""
"RTN","PSBML",58,0)
 ..S Y=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),X,0))
"RTN","PSBML",59,0)
 ..I $P(^PSB(53.79,Y,0),U,9)="G" D ERR(1,"One Time already Given")
"RTN","PSBML",60,0)
 .;PRN
"RTN","PSBML",61,0)
 .I PSBREC(2)="P",PSBREC(3)'="M",$P(PSBREC(9),U,1)'="IVTAB" D
"RTN","PSBML",62,0)
 ..I PSBREC(6)="" D ERR(1,"PRN Medications MUST Have a PRN Reason")
"RTN","PSBML",63,0)
 ..I PSBREC(5)]"" D ERR(1,"PRN Orders don't have scheduled times")
"RTN","PSBML",64,0)
 ..I PSBREC(3)'="G" D ERR(1,"PRN Orders cannot be marked NOT Given")
"RTN","PSBML",65,0)
 .;Cnt
"RTN","PSBML",66,0)
 .I PSBREC(2)="C",PSBTAB'="IVTAB" D
"RTN","PSBML",67,0)
 ..D:PSBREC(5)="" ERR(1,"Continuous Order needs admin time")
"RTN","PSBML",68,0)
 ..D:PSBREC(6)]"" ERR(1,"No PRN Reason allowed on Continuous Orders")
"RTN","PSBML",69,0)
 .I PSBREC(2)="C",$D(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),+PSBREC(5))),PSBIEN="+1" D  K PSBADMBY,PSBADMAT Q:PSBSIEN=""  Q:$P(^PSB(53.79,PSBSIEN,0),U,9)'="N"
"RTN","PSBML",70,0)
 ..S PSBSIEN=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),PSBREC(5),""))
"RTN","PSBML",71,0)
 ..I PSBSIEN]"" I '(($P(^PSB(53.79,PSBSIEN,0),U,7)=DUZ)!($D(^XUSEC("PSB MANAGER",DUZ)))) S PSBSIEN=""
"RTN","PSBML",72,0)
 ..I PSBSIEN']"" S RESULTS(0)=2,RESULTS(1)="-2^Error Filing Transaction MEDPASS",RESULTS(2)="The PSB MANAGER key is required to modify this scheduled admin" Q
"RTN","PSBML",73,0)
 ..D:$P(^PSB(53.79,PSBSIEN,0),U,9)'="N"
"RTN","PSBML",74,0)
 ...K PSBINCX I $P(^PSB(53.79,PSBSIEN,0),U,9)="" S PSBINCX=PSBSIEN L +^PSB(53.79,PSBINCX):1 Q:'$T  L -^PSB(53.79,PSBINCX)
"RTN","PSBML",75,0)
 ...S Y=$P(^PSB(53.79,PSBSIEN,0),U,6) D DD^%DT S PSBADMAT=Y
"RTN","PSBML",76,0)
 ...S PSBADMBY=$$GET1^DIQ(200,$P(^PSB(53.79,PSBSIEN,0),U,7),.01,)
"RTN","PSBML",77,0)
 ...S RESULTS(0)=3,RESULTS(1)="-2^Error Filing Transaction MEDPASS"
"RTN","PSBML",78,0)
 ...S RESULTS(2)="Continuous Administration Date/Time already on file."
"RTN","PSBML",79,0)
 ...S RESULTS(3)="Administered by "_PSBADMBY_" at "_PSBADMAT_"."
"RTN","PSBML",80,0)
 ...I $D(XWB) S RESULTS(0)=RESULTS(0)+2,RESULTS(4)="                                         ",RESULTS(5)="            VDL will now be updated."
"RTN","PSBML",81,0)
 .;NonGvn
"RTN","PSBML",82,0)
 .I PSBREC(3)'="G",PSBREC(3)'="M",PSBUID'["V",PSBUID'["W" D
"RTN","PSBML",83,0)
 ..I PSBREC(7)="",PSBTAB'="IVTAB" D ERR(1,"Comment needed if Not Marked Given")
"RTN","PSBML",84,0)
 ..I PSBREC(7)="",PSBTAB="IVTAB" D ERR(1,"Comment needed if Not Marked Completed")
"RTN","PSBML",85,0)
 .S:PSBREC(3)="H" PSBREC(7)="Held: "_PSBREC(7)    ;.3
"RTN","PSBML",86,0)
 .S:PSBREC(3)="R" PSBREC(7)="Refused: "_PSBREC(7) ;.3
"RTN","PSBML",87,0)
 .S:PSBREC(3)="S" PSBREC(7)="Stopped: "_PSBREC(7) ;.3
"RTN","PSBML",88,0)
 .;Vald?
"RTN","PSBML",89,0)
 .I $G(PSBSIEN)'="" I $D(^PSB(53.79,PSBSIEN,0)) I $P(^PSB(53.79,PSBSIEN,0),U,9)="N" S PSBIEN=+PSBSIEN_",",$P(PSBHDR,U)=PSBIEN,PSBTRAN="UPDATE STATUS",PSBAUDIT=1   ;do UPDATE
"RTN","PSBML",90,0)
 .D:PSBIEN="+1"  ;New?
"RTN","PSBML",91,0)
 ..D VAL(53.79,PSBIEN,.01,"`"_PSBREC(0)) ;Pt
"RTN","PSBML",92,0)
 ..S X=$G(^DPT(PSBREC(0),.1))_" "_$G(^(.101)) ;WrdRmBd
"RTN","PSBML",93,0)
 ..D VAL(53.79,PSBIEN,.02,X) ;PtLoc
"RTN","PSBML",94,0)
 ..D:$G(^DPT(PSBREC(0),.1))'=""
"RTN","PSBML",95,0)
 ...S Y=$O(^DIC(42,"B",$G(^DPT(PSBREC(0),.1)),"")),Y=$$GET1^DIQ(42,Y,.015,"I"),PSBDIV=$$SITE^VASITE(DT,Y)
"RTN","PSBML",96,0)
 ...D VAL(53.79,PSBIEN,.03,"`"_$P(PSBDIV,U,1)) ;Div
"RTN","PSBML",97,0)
 ..D VAL(53.79,PSBIEN,.04,PSBNOW)  ;EntDT
"RTN","PSBML",98,0)
 ..D VAL(53.79,PSBIEN,.05,"`"_DUZ) ;Who
"RTN","PSBML",99,0)
 ..D VAL(53.79,PSBIEN,.06,PSBNOW)  ;AdmDT
"RTN","PSBML",100,0)
 ..D VAL(53.79,PSBIEN,.07,"`"_DUZ) ;AdmBy
"RTN","PSBML",101,0)
 ..D VAL(53.79,PSBIEN,.08,"`"_PSBREC(4)) ;OrdblItm
"RTN","PSBML",102,0)
 ..D VAL(53.79,PSBIEN,.11,PSBREC(1)) ;OrdTpeIEN
"RTN","PSBML",103,0)
 ..D VAL(53.79,PSBIEN,.12,PSBREC(2)) ;OrdSchdTpe
"RTN","PSBML",104,0)
 ..D VAL(53.79,PSBIEN,.13,PSBREC(5)) ;SchdAdmDT
"RTN","PSBML",105,0)
 ..D:PSBTAB'="UDTAB" VAL(53.79,PSBIEN,.26,PSBUID) ;Bag
"RTN","PSBML",106,0)
 ..D:PSBTAB="IVTAB" VAL(53.79,PSBIEN,.13,"") ;no SchdAdm - lvIV
"RTN","PSBML",107,0)
 ..D:PSBREC(1)?.N1"U" VAL(53.79,PSBIEN,.15,PSBDOSE) ;UDDsage
"RTN","PSBML",108,0)
 ..D:PSBREC(1)?.N1"V" VAL(53.79,PSBIEN,.35,PSBIFR)  ;IVInfRt
"RTN","PSBML",109,0)
 .;Ovrwrt if exsts
"RTN","PSBML",110,0)
 .I PSBREC(3)="G"!(PSBREC(3))="C" D  ;Gvn/Cmpltd?
"RTN","PSBML",111,0)
 ..D VAL(53.79,PSBIEN,.06,PSBNOW)   ;AdmDT
"RTN","PSBML",112,0)
 ..D VAL(53.79,PSBIEN,.07,"`"_DUZ)  ;AdmBy
"RTN","PSBML",113,0)
 .D:PSBREC(8)]"" VAL(53.79,PSBIEN,.16,PSBREC(8)) ;InjctSte
"RTN","PSBML",114,0)
 .D:'$G(PSBMMEN) VAL(53.79,PSBIEN,.09,PSBREC(3)) ;AStats
"RTN","PSBML",115,0)
 .D:PSBREC(6)]"" VAL(53.79,PSBIEN,.21,$P(PSBREC(6),U)),VAL(53.79,PSBIEN,.27,$P(PSBREC(6),U,2)) ;PRNRsn
"RTN","PSBML",116,0)
 .D:PSBREC(7)]""
"RTN","PSBML",117,0)
 ..D VAL(53.793,"+2,"_PSBIEN,.01,PSBREC(7)) ;Cmnt
"RTN","PSBML",118,0)
 ..D VAL(53.793,"+2,"_PSBIEN,.02,"`"_DUZ)   ;Who
"RTN","PSBML",119,0)
 ..D VAL(53.793,"+2,"_PSBIEN,.03,PSBNOW)
"RTN","PSBML",120,0)
 .;DD/SOL/ADD
"RTN","PSBML",121,0)
 .I PSBREC(3)="G"!(PSBREC(3)="I")!(PSBREC(3)="H")!(PSBREC(3)="R")!(PSBREC(3)="M") D  ;gvn/infs?
"RTN","PSBML",122,0)
 ..I PSBTRAN="UPDATE STATUS" K ^PSB(53.79,+PSBIEN,.5),^PSB(53.79,+PSBIEN,.6),^PSB(53.79,+PSBIEN,.7)
"RTN","PSBML",123,0)
 ..F PSBCNT=10:1 Q:'$D(PSBREC(PSBCNT))  D
"RTN","PSBML",124,0)
 ...S Y=$P(PSBREC(PSBCNT),U)
"RTN","PSBML",125,0)
 ...S PSBDD=$S(Y="DD":53.795,Y="ADD":53.796,Y="SOL":53.797,1:0)
"RTN","PSBML",126,0)
 ...Q:'PSBDD
"RTN","PSBML",127,0)
 ...S PSBIENS="+"_PSBCNT_","_PSBIEN
"RTN","PSBML",128,0)
 ...D VAL(PSBDD,PSBIENS,.01,"`"_$P(PSBREC(PSBCNT),U,2))
"RTN","PSBML",129,0)
 ...D VAL(PSBDD,PSBIENS,.02,$P(PSBREC(PSBCNT),U,3))
"RTN","PSBML",130,0)
 ...D VAL(PSBDD,PSBIENS,.03,$P(PSBREC(PSBCNT),U,4))
"RTN","PSBML",131,0)
 ...D:(PSBTAB="UDTAB")!(PSBTAB="PBTAB") VAL(PSBDD,PSBIENS,.04,$E($P(PSBREC(PSBCNT),U,5),1,40))
"RTN","PSBML",132,0)
 .I $O(RESULTS("")) S RESULTS(0)=1,RESULTS(1)="-1^Error(s) Filing Transaction MEDPASS"  Q
"RTN","PSBML",133,0)
 .D FILEIT
"RTN","PSBML",134,0)
 .;PSB*3*33
"RTN","PSBML",135,0)
 .D:((PSBREC(2)="O")!($$ONE^PSJBCMA(PSBREC(0),PSBREC(1))="O"))&(PSBREC(3)="G") EXPIRE^PSBML1  ;1x exp?
"RTN","PSBML",136,0)
 .D:(PSBREC(2)="O")&(PSBREC(3)="G") EXPIRE^PSBML1  ;1x exp?
"RTN","PSBML",137,0)
 .I $P(RESULTS(0),U,1)=1,PSBTAB'="UDTAB",PSBUID]"",PSBUID'["WS" S PSBON=+PSBREC(1) D EN^PSJBCMA3(PSBREC(0),PSBON,PSBUID,PSBREC(3),PSBNOW)
"RTN","PSBML",138,0)
 Q
"RTN","PSBML",139,0)
BCBU ;HL7,NatContng
"RTN","PSBML",140,0)
 Q:+$G(RESULTS(0))'>0
"RTN","PSBML",141,0)
 N PSBIEN1 S PSBIEN1=$S($P(PSBIEN,",",2)'="":+$P(PSBIEN,",",2),$G(PSBIEN)="+1":PSBIEN(1),1:+$G(PSBIEN))
"RTN","PSBML",142,0)
 I $G(PSBIEN1)="" S RESULTS(0)=1,RESULTS(1)="-1^Contingency NOT processed" Q
"RTN","PSBML",143,0)
 I $G(PSBIEN)="+1" S PSBHL7="MEDPASS"
"RTN","PSBML",144,0)
 E  S:$G(PSBHL7)="" PSBHL7="UPDATE STATUS"
"RTN","PSBML",145,0)
 D:('$D(Y(0))!($G(Y(0))="SAVE")!($G(Y(0))="YES")) EN^PSBSVHL7(+PSBIEN1,PSBHL7),MEDL^ALPBCBU(+PSBIEN1) K PSBHL7
"RTN","PSBML",146,0)
 ;<<HDR-VDEF(frm *3)
"RTN","PSBML",147,0)
 Q
"RTN","PSBML",148,0)
VAL(PSBDD,PSBIEN,PSBFLD,PSBVAL) ;
"RTN","PSBML",149,0)
 K ^TMP("DIERR",$J),PSBRET
"RTN","PSBML",150,0)
 D VAL^DIE(PSBDD,PSBIEN,PSBFLD,"F",PSBVAL,.PSBRET,"PSBFDA")
"RTN","PSBML",151,0)
 I PSBRET="^" F X=0:0 S X=$O(^TMP("DIERR",$J,X)) Q:'X  D ERR(2,^TMP("DIERR",$J,X)_": "_$G(^(X,"TEXT",1),"**"))
"RTN","PSBML",152,0)
 K ^TMP("DIERR",$J),PSBRET
"RTN","PSBML",153,0)
 Q
"RTN","PSBML",154,0)
FILEIT ;Updt
"RTN","PSBML",155,0)
 N PSBMSG,PSBAUD
"RTN","PSBML",156,0)
 S (PSB1,PSB2)=""
"RTN","PSBML",157,0)
 D APATCH^PSBML3
"RTN","PSBML",158,0)
 D CLEAN^DILF
"RTN","PSBML",159,0)
 D RESETADM^PSBUTL
"RTN","PSBML",160,0)
 D UPDATE^DIE("","PSBFDA","PSBIEN","PSBMSG")
"RTN","PSBML",161,0)
 I '$G(PSBMMEN) S X=+PSBIEN I $F("HR",$P(^PSB(53.79,X,0),U,9))>1 F Y=.5,.6,.7 S Z=0 F  S Z=$O(^PSB(53.79,+X,Y,Z)) Q:+Z=0  S $P(^PSB(53.79,+X,Y,Z,0),U,3)=0
"RTN","PSBML",162,0)
 I $D(PSBMSG("DIERR")) S RESULTS(0)=1,RESULTS(1)="-1^"_PSBMSG("DIERR",1)_": "_PSBMSG("DIERR",1,"TEXT",1)  Q
"RTN","PSBML",163,0)
 I $G(PSB1)]"" X PSB1 I $G(PSB2)]"" X PSB2
"RTN","PSBML",164,0)
 I $D(PSBHDR) D:"NHMR"[$P(^PSB(53.79,$S($P(PSBHDR,"^",1)="+1":PSBIEN(1),1:+PSBIEN),0),U,9)
"RTN","PSBML",165,0)
 .N PSBINDX S PSBINDX=$S($P(PSBHDR,"^",1)="+1":PSBIEN(1),1:+PSBIEN)
"RTN","PSBML",166,0)
 .K ^PSB(53.79,"APATCH",$P(^PSB(53.79,PSBINDX,0),U),$P(^PSB(53.79,PSBINDX,0),U,6),PSBINDX)
"RTN","PSBML",167,0)
 S RESULTS(0)=1,RESULTS(1)="1^Data Successfully Filed^"_$S($G(PSBIEN(1))'="":$G(PSBIEN(1)),1:+$G(PSBIEN))
"RTN","PSBML",168,0)
 D BCBU  ;NatContng
"RTN","PSBML",169,0)
 I $G(PSBINST,0) S PSBAUD=$S($P(PSBHDR,"^",1)="+1":PSBIEN(1),1:$P(PSBHDR,"^",1)) D AUDIT^PSBMLU(PSBAUD,"Instructor "_PSBINST(0)_" present.",PSBTRAN)
"RTN","PSBML",170,0)
 Q
"RTN","PSBML",171,0)
ERR(X,Y) ;
"RTN","PSBML",172,0)
 S X=$P("Business Logic Error^Data Validation Error",U,X)
"RTN","PSBML",173,0)
 S RESULTS($O(RESULTS(""),-1)+1)=X_": "_Y
"RTN","PSBML",174,0)
 Q
"RTN","PSBML",175,0)
COMMENT(DA,PSBCMT) ;
"RTN","PSBML",176,0)
 N PSBFDA,PSBIEN,PSBNOW
"RTN","PSBML",177,0)
 S PSBIEN="+1,"_DA_","
"RTN","PSBML",178,0)
 D NOW^%DTC S PSBNOW=%
"RTN","PSBML",179,0)
 D VAL(53.793,PSBIEN,.01,PSBCMT)
"RTN","PSBML",180,0)
 S PSBFDA(53.793,PSBIEN,.02)=DUZ
"RTN","PSBML",181,0)
 S PSBFDA(53.793,PSBIEN,.03)=PSBNOW
"RTN","PSBML",182,0)
 D FILEIT
"RTN","PSBML",183,0)
 Q
"VER")
8.0^22.0
"BLD",7548,6)
^37
**END**
**END**
