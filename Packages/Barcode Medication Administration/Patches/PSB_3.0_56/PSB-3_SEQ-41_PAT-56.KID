Released PSB*3*56 SEQ #41
Extracted from mail message
**KIDS**:PSB*3.0*56^

**INSTALL NAME**
PSB*3.0*56
"BLD",8358,0)
PSB*3.0*56^BAR CODE MED ADMIN^0^3100930^y
"BLD",8358,1,0)
^^10^10^3100511^
"BLD",8358,1,1,0)
 This Patch Addresses 4 issues:
"BLD",8358,1,2,0)
 
"BLD",8358,1,3,0)
 1.  An invalid MUMPS date (a date prior to 12/31/1840) entered for the
"BLD",8358,1,4,0)
     BCMA Administration Times report creates an infinite loop which sends
"BLD",8358,1,5,0)
     out BCMA Order Problem emails.
"BLD",8358,1,6,0)
 2.  An undefined error occurs at PTLKUP+16^PSBMLLKU when a Nursing Ward
"BLD",8358,1,7,0)
     contains lowercase letters.
"BLD",8358,1,8,0)
 3.  Orders with a Status of On Call do not print on the BCMA Missed Meds 
"BLD",8358,1,9,0)
     Report or the BCMA Administration Times Report
"BLD",8358,1,10,0)
 4.  Patients are Duplicating on Reports for wards with similar names.
"BLD",8358,4,0)
^9.64PA^^
"BLD",8358,6.3)
10
"BLD",8358,"KRN",0)
^9.67PA^779.2^20
"BLD",8358,"KRN",.4,0)
.4
"BLD",8358,"KRN",.401,0)
.401
"BLD",8358,"KRN",.402,0)
.402
"BLD",8358,"KRN",.403,0)
.403
"BLD",8358,"KRN",.5,0)
.5
"BLD",8358,"KRN",.84,0)
.84
"BLD",8358,"KRN",3.6,0)
3.6
"BLD",8358,"KRN",3.8,0)
3.8
"BLD",8358,"KRN",9.2,0)
9.2
"BLD",8358,"KRN",9.8,0)
9.8
"BLD",8358,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",8358,"KRN",9.8,"NM",1,0)
PSBOWA^^0^B51492255
"BLD",8358,"KRN",9.8,"NM",2,0)
PSBOMM^^0^B87016727
"BLD",8358,"KRN",9.8,"NM",3,0)
PSBMLLKU^^0^B79282842
"BLD",8358,"KRN",9.8,"NM","B","PSBMLLKU",3)

"BLD",8358,"KRN",9.8,"NM","B","PSBOMM",2)

"BLD",8358,"KRN",9.8,"NM","B","PSBOWA",1)

"BLD",8358,"KRN",19,0)
19
"BLD",8358,"KRN",19.1,0)
19.1
"BLD",8358,"KRN",101,0)
101
"BLD",8358,"KRN",409.61,0)
409.61
"BLD",8358,"KRN",771,0)
771
"BLD",8358,"KRN",779.2,0)
779.2
"BLD",8358,"KRN",870,0)
870
"BLD",8358,"KRN",8989.51,0)
8989.51
"BLD",8358,"KRN",8989.52,0)
8989.52
"BLD",8358,"KRN",8994,0)
8994
"BLD",8358,"KRN","B",.4,.4)

"BLD",8358,"KRN","B",.401,.401)

"BLD",8358,"KRN","B",.402,.402)

"BLD",8358,"KRN","B",.403,.403)

"BLD",8358,"KRN","B",.5,.5)

"BLD",8358,"KRN","B",.84,.84)

"BLD",8358,"KRN","B",3.6,3.6)

"BLD",8358,"KRN","B",3.8,3.8)

"BLD",8358,"KRN","B",9.2,9.2)

"BLD",8358,"KRN","B",9.8,9.8)

"BLD",8358,"KRN","B",19,19)

"BLD",8358,"KRN","B",19.1,19.1)

"BLD",8358,"KRN","B",101,101)

"BLD",8358,"KRN","B",409.61,409.61)

"BLD",8358,"KRN","B",771,771)

"BLD",8358,"KRN","B",779.2,779.2)

"BLD",8358,"KRN","B",870,870)

"BLD",8358,"KRN","B",8989.51,8989.51)

"BLD",8358,"KRN","B",8989.52,8989.52)

"BLD",8358,"KRN","B",8994,8994)

"BLD",8358,"QUES",0)
^9.62^^
"BLD",8358,"REQB",0)
^9.611^1^1
"BLD",8358,"REQB",1,0)
PSB*3.0*32^2
"BLD",8358,"REQB","B","PSB*3.0*32",1)

"MBREQ")
0
"PKG",550,-1)
1^1
"PKG",550,0)
BAR CODE MED ADMIN^PSB^BAR CODE MEDICATION ADMINISTRATION
"PKG",550,20,0)
^9.402P^^
"PKG",550,22,0)
^9.49I^1^1
"PKG",550,22,1,0)
3.0^3040224^3040311^66481
"PKG",550,22,1,"PAH",1,0)
56^3100930
"PKG",550,22,1,"PAH",1,1,0)
^^10^10^3100930
"PKG",550,22,1,"PAH",1,1,1,0)
 This Patch Addresses 4 issues:
"PKG",550,22,1,"PAH",1,1,2,0)
 
"PKG",550,22,1,"PAH",1,1,3,0)
 1.  An invalid MUMPS date (a date prior to 12/31/1840) entered for the
"PKG",550,22,1,"PAH",1,1,4,0)
     BCMA Administration Times report creates an infinite loop which sends
"PKG",550,22,1,"PAH",1,1,5,0)
     out BCMA Order Problem emails.
"PKG",550,22,1,"PAH",1,1,6,0)
 2.  An undefined error occurs at PTLKUP+16^PSBMLLKU when a Nursing Ward
"PKG",550,22,1,"PAH",1,1,7,0)
     contains lowercase letters.
"PKG",550,22,1,"PAH",1,1,8,0)
 3.  Orders with a Status of On Call do not print on the BCMA Missed Meds 
"PKG",550,22,1,"PAH",1,1,9,0)
     Report or the BCMA Administration Times Report
"PKG",550,22,1,"PAH",1,1,10,0)
 4.  Patients are Duplicating on Reports for wards with similar names.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSBMLLKU")
0^3^B79282842^B78334871
"RTN","PSBMLLKU",1,0)
PSBMLLKU ;BIRMINGHAM/TEJ-BCMA RPC LOOKUP UTLILITIES ;Mar 2004
"RTN","PSBMLLKU",2,0)
 ;;3.0;BAR CODE MED ADMIN;**3,9,11,20,13,38,32,56**;Mar 2004;Build 10
"RTN","PSBMLLKU",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSBMLLKU",4,0)
 ;
"RTN","PSBMLLKU",5,0)
 ; Reference/IA
"RTN","PSBMLLKU",6,0)
 ; EN^PSJBCMA1/2829
"RTN","PSBMLLKU",7,0)
 ; $$DOB^DPTLK1/3266
"RTN","PSBMLLKU",8,0)
 ; $$SSN^DPTLK1/3267
"RTN","PSBMLLKU",9,0)
 ; ^DPT/10035
"RTN","PSBMLLKU",10,0)
 ; ^XUSEC/10076
"RTN","PSBMLLKU",11,0)
 ; File 52.6/436
"RTN","PSBMLLKU",12,0)
 ; File 52.7/437
"RTN","PSBMLLKU",13,0)
 ; File 50/221
"RTN","PSBMLLKU",14,0)
 ; File 211.4/1409
"RTN","PSBMLLKU",15,0)
 ;
"RTN","PSBMLLKU",16,0)
RPC(RESULTS,PSBREC) ; Remote Procedure Call Entry Point.
"RTN","PSBMLLKU",17,0)
 ;
"RTN","PSBMLLKU",18,0)
 S RESULTS="" D @(PSBREC(0)_"(.RESULTS,.PSBREC)") Q
"RTN","PSBMLLKU",19,0)
 Q
"RTN","PSBMLLKU",20,0)
 ;
"RTN","PSBMLLKU",21,0)
ADMLKUP(RESULTS,PSBREC) ;
"RTN","PSBMLLKU",22,0)
 ;  Lookup ADMinistrations per DFN and search DATE
"RTN","PSBMLLKU",23,0)
 ;   input - PSBREC(1)  DFN
"RTN","PSBMLLKU",24,0)
 ;           PSBREC(2)  Search DATE
"RTN","PSBMLLKU",25,0)
 ;
"RTN","PSBMLLKU",26,0)
 ;   outpt - RESULTS (array)
"RTN","PSBMLLKU",27,0)
 ;          (Administrations returned will be dated  = to Search Date
"RTN","PSBMLLKU",28,0)
 ;
"RTN","PSBMLLKU",29,0)
 ;
"RTN","PSBMLLKU",30,0)
 K RESULTS
"RTN","PSBMLLKU",31,0)
 S DFN=PSBREC(1),PSBSRCH=$G(PSBREC(2)) I $G(PSBSRCH)']"" D NOW^%DTC S PSBSRCH=$P(%,".")
"RTN","PSBMLLKU",32,0)
 S PSBDT=PSBSRCH,PSBCNT=0 S:PSBSRCH'["." PSBSRCH=PSBSRCH+.9
"RTN","PSBMLLKU",33,0)
 S RESULTS(0)=1,RESULTS(1)="-1^No Meds Found!"
"RTN","PSBMLLKU",34,0)
 F  S PSBSRCH=$O(^PSB(53.79,"AADT",DFN,PSBSRCH),-1) Q:'PSBSRCH!(PSBSRCH<PSBDT)  D
"RTN","PSBMLLKU",35,0)
 .S PSBIEN=""
"RTN","PSBMLLKU",36,0)
 .F  S PSBIEN=$O(^PSB(53.79,"AADT",DFN,PSBSRCH,PSBIEN),-1) Q:'PSBIEN  D:'$D(^PSB(53.79,PSBIEN)) KILLAADT  Q:'$D(^PSB(53.79,PSBIEN))  D:$$CHKKEY(PSBIEN)
"RTN","PSBMLLKU",37,0)
 ..L +^PSB(53.79,PSBIEN):1
"RTN","PSBMLLKU",38,0)
 ..I  L -^PSB(53.79,PSBIEN)
"RTN","PSBMLLKU",39,0)
 ..E  Q
"RTN","PSBMLLKU",40,0)
 ..S PSBXORDN=$$GET1^DIQ(53.79,PSBIEN_",",.11) Q:'$D(^PSB(53.79,"AORDX",DFN,PSBXORDN,PSBSRCH))
"RTN","PSBMLLKU",41,0)
 ..Q:($$GET1^DIQ(53.79,PSBIEN_",",.06,"I")>PSBSRCH)
"RTN","PSBMLLKU",42,0)
 ..Q:($$GET1^DIQ(53.79,PSBIEN_",",.09,"I")="N")
"RTN","PSBMLLKU",43,0)
 ..S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=PSBIEN
"RTN","PSBMLLKU",44,0)
 ..S $P(RESULTS(PSBCNT),U,2)=PSBSRCH
"RTN","PSBMLLKU",45,0)
 ..S $P(RESULTS(PSBCNT),U,3)=$$GET1^DIQ(53.79,PSBIEN_",",.08)
"RTN","PSBMLLKU",46,0)
 ..S:$$GET1^DIQ(53.79,PSBIEN_",",.26) $P(RESULTS(PSBCNT),U,4)=$$GET1^DIQ(53.79,PSBIEN_",",.26)
"RTN","PSBMLLKU",47,0)
 ..S $P(RESULTS(PSBCNT),U,5)=$S($$GET1^DIQ(53.79,PSBIEN_",",.09,"I")']"":"U",1:$$GET1^DIQ(53.79,PSBIEN_",",.09,"I"))
"RTN","PSBMLLKU",48,0)
 ..D  ; Get order information
"RTN","PSBMLLKU",49,0)
 ...K ^TMP("PSJ1",$J) D EN^PSJBCMA1(DFN,PSBXORDN,1)
"RTN","PSBMLLKU",50,0)
 ...S $P(RESULTS(PSBCNT),U,3)=$P(^TMP("PSJ1",$J,2),U,2)  ;OItem_" "_Dosage Form
"RTN","PSBMLLKU",51,0)
 ...S $P(RESULTS(PSBCNT),U,6)=$P(^TMP("PSJ1",$J,4),U)    ;Sched Type
"RTN","PSBMLLKU",52,0)
 ...K ^TMP("PSJ1",$J)
"RTN","PSBMLLKU",53,0)
 ..S $P(RESULTS(PSBCNT),U,7)=$$GET1^DIQ(53.79,PSBIEN_",",.06,"I")
"RTN","PSBMLLKU",54,0)
 ..S $P(RESULTS(PSBCNT),U,8)=$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY:INITIAL")
"RTN","PSBMLLKU",55,0)
 ..S:$D(^PSB(53.79,PSBIEN,.2)) $P(RESULTS(PSBCNT),U,9)=$P(^PSB(53.79,PSBIEN,.2),U),$P(RESULTS(PSBCNT),U,10)=$P(^PSB(53.79,PSBIEN,.2),U,2)
"RTN","PSBMLLKU",56,0)
 S:+$G(RESULTS(1))>0 $P(RESULTS(0),U)=PSBCNT
"RTN","PSBMLLKU",57,0)
 Q
"RTN","PSBMLLKU",58,0)
 ;
"RTN","PSBMLLKU",59,0)
CHKKEY(PSBIENX) ;
"RTN","PSBMLLKU",60,0)
 I '(($D(^XUSEC("PSB MANAGER",DUZ)))!($$GET1^DIQ(53.79,+PSBIENX,.07,"I")=DUZ)) Q 0
"RTN","PSBMLLKU",61,0)
 Q 1
"RTN","PSBMLLKU",62,0)
 ;
"RTN","PSBMLLKU",63,0)
PTLKUP(RESULTS,PSBREC) ; Patient lookup handled separately for security
"RTN","PSBMLLKU",64,0)
 ;   input - PSBREC (array)  User entered patient lookup data
"RTN","PSBMLLKU",65,0)
 ;
"RTN","PSBMLLKU",66,0)
 ;   outpt - RESULTS (array)
"RTN","PSBMLLKU",67,0)
 ;          (Person(s) in PATIENT File (#2) meeting search criteria)
"RTN","PSBMLLKU",68,0)
 ;
"RTN","PSBMLLKU",69,0)
 ;
"RTN","PSBMLLKU",70,0)
 K RESULTS
"RTN","PSBMLLKU",71,0)
 N PSBNRSWD
"RTN","PSBMLLKU",72,0)
 S PSBDATA=$E(PSBREC(1),1,60)
"RTN","PSBMLLKU",73,0)
 S PSBDATA1=PSBDATA
"RTN","PSBMLLKU",74,0)
 N PSBINDX S PSBINDX="" K ^TMP("DILIST",$J)
"RTN","PSBMLLKU",75,0)
 I $E(PSBDATA,$L(PSBDATA)-10,60)=" [MAS WARD]" S PSBINDX="CN" S PSBDATA=$P(PSBDATA," [MAS WARD]")
"RTN","PSBMLLKU",76,0)
 I $E(PSBDATA,$L(PSBDATA)-11,60)=" [NURS UNIT]" S PSBINDX="CN" S PSBDATA=$P(PSBDATA," [NURS UNIT]") D
"RTN","PSBMLLKU",77,0)
 .K PSBPT S PSBPT(0)=0
"RTN","PSBMLLKU",78,0)
 .S PSBZ=0 F  S PSBZ=$O(^NURSF(211.4,PSBZ)) Q:PSBZ'?.N  S PSBNRSWD=$$GET1^DIQ(211.4,PSBZ_",",.01) I $$UCASE^XUSG(PSBNRSWD)=PSBDATA S PSBY=PSBZ Q
"RTN","PSBMLLKU",79,0)
 .K PSBDATA S PSBDATA=""
"RTN","PSBMLLKU",80,0)
 .S PSBX=0 F  S PSBX=$O(^NURSF(211.4,PSBY,3,PSBX)) Q:PSBX=""  S PSBDATA(PSBX)=$$GET1^DIQ(42,$P(^NURSF(211.4,PSBY,3,PSBX,0),U)_",",.01)
"RTN","PSBMLLKU",81,0)
 I PSBINDX="" S PSBINDX=$S(PSBDATA?9N.1P:"SSN",PSBDATA?4N.1P:"BS5^BS",1:PSBINDX)
"RTN","PSBMLLKU",82,0)
 I ($O(PSBDATA(""))'>0) D FIND^DIC(2,"","@;.01;.02;.03;.09","MP",PSBDATA,200,PSBINDX)
"RTN","PSBMLLKU",83,0)
 I ($O(PSBDATA(""))>0) D
"RTN","PSBMLLKU",84,0)
 .S PSBX="",PSBY=1 F  S PSBX=$O(PSBDATA(PSBX)) Q:PSBX=""  D  K ^TMP("DILIST",$J) Q:$P(PSBPT(0),U,3)=1
"RTN","PSBMLLKU",85,0)
 ..D FIND^DIC(2,"","@;.01;.02;.03;.09","MPO",PSBDATA(PSBX),200,PSBINDX)
"RTN","PSBMLLKU",86,0)
 ..S PSBZ=0 F  S PSBZ=$O(^TMP("DILIST",$J,PSBZ)) Q:PSBZ=""  S PSBPT(PSBY,0)=^TMP("DILIST",$J,PSBZ,0),PSBPT(0)=PSBY,PSBY=PSBY+1 I PSBY>200 S $P(PSBPT(0),U,3)=1
"RTN","PSBMLLKU",87,0)
 K:+$G(PSBPT(0))=0 PSBPT
"RTN","PSBMLLKU",88,0)
 I $D(PSBPT) M ^TMP("DILIST",$J)=PSBPT
"RTN","PSBMLLKU",89,0)
 I $P($G(^TMP("DILIST",$J,0)),U,3) D  Q
"RTN","PSBMLLKU",90,0)
 .S RESULTS(0)=1,RESULTS(1)="-1^Too many patients found matching '"_PSBDATA1_"'. Please be more specific."
"RTN","PSBMLLKU",91,0)
 I $D(^TMP("DILIST",$J,0)) D
"RTN","PSBMLLKU",92,0)
 .F PSBXX=0:0 S PSBXX=$O(^TMP("DILIST",$J,PSBXX)) Q:'PSBXX  D
"RTN","PSBMLLKU",93,0)
 ..S RESULTS(PSBXX)=$$PTREC(+^TMP("DILIST",$J,PSBXX,0))
"RTN","PSBMLLKU",94,0)
 I '$D(RESULTS) S RESULTS(0)=1,RESULTS(1)="-1^No patients matching '"_PSBDATA1_"'"
"RTN","PSBMLLKU",95,0)
 E  S RESULTS(0)=+$O(RESULTS(""),-1)
"RTN","PSBMLLKU",96,0)
 Q
"RTN","PSBMLLKU",97,0)
 ;
"RTN","PSBMLLKU",98,0)
PTREC(DFN) ;
"RTN","PSBMLLKU",99,0)
 ; Extrinsic to return a Pt Rec  in standard list format
"RTN","PSBMLLKU",100,0)
 N PSBXX
"RTN","PSBMLLKU",101,0)
 S PSBXX=$G(^DPT(DFN,0))
"RTN","PSBMLLKU",102,0)
 S PSBXX=DFN_U_$P(PSBXX,U,1)_U_$P(PSBXX,U,2)_U_$P(PSBXX,U,3)_U_$P(PSBXX,U,9)
"RTN","PSBMLLKU",103,0)
 S $P(PSBXX,U,6)=$$GET1^DIQ(2,DFN_",",.1)
"RTN","PSBMLLKU",104,0)
 S $P(PSBXX,U,7)=$$GET1^DIQ(2,DFN_",",.101)
"RTN","PSBMLLKU",105,0)
 S $P(PSBXX,U,10)=$$DOB^DPTLK1(DFN)
"RTN","PSBMLLKU",106,0)
 S $P(PSBXX,U,11)=$$SSN^DPTLK1(DFN)
"RTN","PSBMLLKU",107,0)
 Q PSBXX
"RTN","PSBMLLKU",108,0)
 ;
"RTN","PSBMLLKU",109,0)
SELECTAD(RESULTS,PSBREC) ; Select Administration
"RTN","PSBMLLKU",110,0)
 ;
"RTN","PSBMLLKU",111,0)
 ;  Process the SELECTed ADministration
"RTN","PSBMLLKU",112,0)
 ;   input - PSBREC(1) = PSB Med Log File (#53.79) IEN
"RTN","PSBMLLKU",113,0)
 ;
"RTN","PSBMLLKU",114,0)
 ;
"RTN","PSBMLLKU",115,0)
 ;   outpt - RESULTS (array)
"RTN","PSBMLLKU",116,0)
 ;          (Administration data that can be subsequently updated via GUI MED LOG EDIT)
"RTN","PSBMLLKU",117,0)
 ;
"RTN","PSBMLLKU",118,0)
 ;
"RTN","PSBMLLKU",119,0)
 K RESULTS,PSBXIV,PSBPTCHX
"RTN","PSBMLLKU",120,0)
 N PSBIEN,PSBCNT,PSBX S PSBIEN=PSBREC(1),PSBCNT=2
"RTN","PSBMLLKU",121,0)
 ; Construct form data    Patient^SSN^Med^BagID^AdminStat^AdminD/T^InjctSt^PRNReas^PRNEff^DisDrg^UntsGiven^Unt^
"RTN","PSBMLLKU",122,0)
 S RESULTS(0)=0
"RTN","PSBMLLKU",123,0)
 D:$$CHKKEY(PSBIEN)
"RTN","PSBMLLKU",124,0)
 .L +^PSB(53.79,PSBIEN):1
"RTN","PSBMLLKU",125,0)
 .E  I $P(^PSB(53.79,PSBIEN,0),U,9)]"" S PSBCNT=1,RESULTS(1)="-1^ This administration is being modified by another process at this moment." L -^PSB(53.79,PSBIEN) Q
"RTN","PSBMLLKU",126,0)
 .S $P(RESULTS(1),U)=PSBIEN
"RTN","PSBMLLKU",127,0)
 .S $P(RESULTS(1),U,2)=$$GET1^DIQ(53.79,PSBIEN_",",.01,"I")
"RTN","PSBMLLKU",128,0)
 .S $P(RESULTS(1),U,3)=$$GET1^DIQ(53.79,PSBIEN_",",.01)
"RTN","PSBMLLKU",129,0)
 .S $P(RESULTS(1),U,4)=$$GET1^DIQ(2,$P(RESULTS(1),U,2)_",",.09)
"RTN","PSBMLLKU",130,0)
 .S $P(RESULTS(1),U,5)=$$GET1^DIQ(53.79,PSBIEN_",",.08,"I")_"~"_$$GET1^DIQ(53.79,PSBIEN_",",.08)
"RTN","PSBMLLKU",131,0)
 .S $P(RESULTS(1),U,6)=$$GET1^DIQ(53.79,PSBIEN_",",.26)
"RTN","PSBMLLKU",132,0)
 .S $P(RESULTS(1),U,7)=$S($$GET1^DIQ(53.79,PSBIEN_",",.09,"I")']"":"U",1:$$GET1^DIQ(53.79,PSBIEN_",",.09,"I"))
"RTN","PSBMLLKU",133,0)
 .;
"RTN","PSBMLLKU",134,0)
 .D:($P(RESULTS(1),U,7)'="N")&($P(RESULTS(1),U,7)]"") SELSTTUS(.RESULTS)  ; Amend RESULTS(1) data...
"RTN","PSBMLLKU",135,0)
 .S Y=$E($$GET1^DIQ(53.79,PSBIEN_",",.06,"I"),1,12) D DD^%DT
"RTN","PSBMLLKU",136,0)
 .S $P(RESULTS(1),U,8)=Y
"RTN","PSBMLLKU",137,0)
 .S $P(RESULTS(1),U,9)=$$GET1^DIQ(53.79,PSBIEN_",",.06,"I")
"RTN","PSBMLLKU",138,0)
 .S $P(RESULTS(1),U,10)=$$GET1^DIQ(53.79,PSBIEN_",",.16)
"RTN","PSBMLLKU",139,0)
 .S $P(RESULTS(1),U,16)=0
"RTN","PSBMLLKU",140,0)
 .S $P(RESULTS(2),U)=$$GET1^DIQ(53.79,PSBIEN_",",.21),$P(RESULTS(2),U,2)=$$GET1^DIQ(53.79,PSBIEN_",",.22)
"RTN","PSBMLLKU",141,0)
 .; Determine if there are any active IVs/Patchs per order
"RTN","PSBMLLKU",142,0)
 .D:$G(PSBPTCHX)
"RTN","PSBMLLKU",143,0)
 ..S PSBX="",PSBX="^PSB(53.79,""APATCH"","_$P(RESULTS(1),U,2)_")"
"RTN","PSBMLLKU",144,0)
 ..F  S PSBX=$Q(@PSBX) Q:PSBX=""  Q:$QS(PSBX,3)'=$P(RESULTS(1),U,2)  D  Q:$P(RESULTS(1),U,16)
"RTN","PSBMLLKU",145,0)
 ...S PSBXX=$QS(PSBX,5),PSBXXX=$S(($P(^PSB(53.79,PSBXX,0),U,9)="G")&(PSBXX'=PSBIEN):1,1:0)
"RTN","PSBMLLKU",146,0)
 ...I PSBXXX&($P(^PSB(53.79,PSBXX,.1),U)=$P(RESULTS(1),U,15)) S $P(RESULTS(1),U,16)=1
"RTN","PSBMLLKU",147,0)
 .D:$G(PSBXIV)
"RTN","PSBMLLKU",148,0)
 ..S PSBX="",PSBX="^PSB(53.79,""AUID"","_$P(RESULTS(1),U,2)_")"
"RTN","PSBMLLKU",149,0)
 ..F  S PSBX=$Q(@PSBX) Q:PSBX=""  Q:$QS(PSBX,3)'=$P(RESULTS(1),U,2)  Q:$QS(PSBX,4)>$P(RESULTS(1),U,15)  D  Q:$P(RESULTS(1),U,16)
"RTN","PSBMLLKU",150,0)
 ...Q:$QS(PSBX,4)'=$P(RESULTS(1),U,15)
"RTN","PSBMLLKU",151,0)
 ...S PSBXX=$QS(PSBX,6) S:(PSBXX'=PSBIEN) $P(RESULTS(1),U,16)=$S($P(^PSB(53.79,PSBXX,0),U,9)="I":1,$P(^PSB(53.79,PSBXX,0),U,9)="S":1,1:0)
"RTN","PSBMLLKU",152,0)
 .;
"RTN","PSBMLLKU",153,0)
 .; LOOP - Place DD in RESULTS
"RTN","PSBMLLKU",154,0)
 .S PSBX=0 F  S PSBX=$O(^PSB(53.79,PSBIEN,.5,PSBX)) Q:'(+PSBX)  D
"RTN","PSBMLLKU",155,0)
 ..S PSBCNT=PSBCNT+1
"RTN","PSBMLLKU",156,0)
 ..S RESULTS(PSBCNT)="DD^"_$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U)_"^"_$$GET1^DIQ(50,$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U)_",",.01)
"RTN","PSBMLLKU",157,0)
 ..S $P(RESULTS(PSBCNT),U,4)=$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U,2)_"^"_$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U,3)_"^"_$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U,4)
"RTN","PSBMLLKU",158,0)
 ..S:$P(RESULTS(PSBCNT),U,4)?1"."1.N $P(RESULTS(PSBCNT),U,4)=0_+$P(RESULTS(PSBCNT),U,4)
"RTN","PSBMLLKU",159,0)
 ..S:$P(RESULTS(PSBCNT),U,5)?1"."1.N $P(RESULTS(PSBCNT),U,5)=0_+$P(RESULTS(PSBCNT),U,5)
"RTN","PSBMLLKU",160,0)
 .; LOOP - Place ADD in RESULTS
"RTN","PSBMLLKU",161,0)
 .S PSBX=0 F  S PSBX=$O(^PSB(53.79,PSBIEN,.6,PSBX)) Q:'(+PSBX)  D
"RTN","PSBMLLKU",162,0)
 ..S PSBCNT=PSBCNT+1
"RTN","PSBMLLKU",163,0)
 ..S RESULTS(PSBCNT)="ADD^"_$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U)_"^"_$$GET1^DIQ(52.6,$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U)_",",.01)
"RTN","PSBMLLKU",164,0)
 ..S $P(RESULTS(PSBCNT),U,4)=$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U,2)_"^"_$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U,3)_"^"_$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U,4)
"RTN","PSBMLLKU",165,0)
 .; LOOP - Place SOL in RESULTS
"RTN","PSBMLLKU",166,0)
 .S PSBX=0 F  S PSBX=$O(^PSB(53.79,PSBIEN,.7,PSBX)) Q:'(+PSBX)  D
"RTN","PSBMLLKU",167,0)
 ..S PSBCNT=PSBCNT+1
"RTN","PSBMLLKU",168,0)
 ..S RESULTS(PSBCNT)="SOL^"_$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U)_"^"_$$GET1^DIQ(52.7,$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U)_",",.01)
"RTN","PSBMLLKU",169,0)
 ..S $P(RESULTS(PSBCNT),U,4)=$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U,2)_"^"_$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U,3)_"^"_$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U,4)
"RTN","PSBMLLKU",170,0)
 .L -^PSB(53.79,PSBIEN)
"RTN","PSBMLLKU",171,0)
 S:PSBCNT>0 RESULTS(0)=PSBCNT
"RTN","PSBMLLKU",172,0)
 Q
"RTN","PSBMLLKU",173,0)
 ;
"RTN","PSBMLLKU",174,0)
SELSTTUS(RESULTS) ;
"RTN","PSBMLLKU",175,0)
 ; Provide the SELectable STaTUS
"RTN","PSBMLLKU",176,0)
 ;
"RTN","PSBMLLKU",177,0)
 ; Get TAB, ScheduleType, Current Status, provide Selectable Staus(s) in ^8
"RTN","PSBMLLKU",178,0)
 N PSBORTYP,PSBIVTYP,PSBINTSY,PSBCHMTY,PSBIVPSH,PSBXTAB
"RTN","PSBMLLKU",179,0)
 K ^TMP("PSJ1",$J) D EN^PSJBCMA1($$GET1^DIQ(53.79,PSBIEN_",",.01,"I"),$$GET1^DIQ(53.79,PSBIEN_",",.11),1)
"RTN","PSBMLLKU",180,0)
 I ^TMP("PSJ1",$J,0)>0 D
"RTN","PSBMLLKU",181,0)
 .S PSBORTYP=$TR($P(^TMP("PSJ1",$J,0),U,3),"1234567890"),PSBIVTYP=$P(^TMP("PSJ1",$J,0),U,6)
"RTN","PSBMLLKU",182,0)
 .S PSBINTSY=$P(^TMP("PSJ1",$J,0),U,7),PSBCHMTY=$P(^TMP("PSJ1",$J,0),U,8),PSBIVPSH=+$P($G(^TMP("PSJ1",$J,1,0)),U,2)
"RTN","PSBMLLKU",183,0)
 .S:$$IVPTAB^PSBVDLU3(PSBORTYP,PSBIVTYP,PSBINTSY,PSBCHMTY,PSBIVPSH) PSBXTAB="PB"
"RTN","PSBMLLKU",184,0)
 .D:'$D(PSBXTAB)
"RTN","PSBMLLKU",185,0)
 ..I PSBORTYP="U" S PSBXTAB="UD"
"RTN","PSBMLLKU",186,0)
 ..I PSBORTYP="V" S PSBXTAB="IV"
"RTN","PSBMLLKU",187,0)
 ; Set Results(1) and other flags...
"RTN","PSBMLLKU",188,0)
 I ^TMP("PSJ1",$J,0)>0 D
"RTN","PSBMLLKU",189,0)
 .S $P(RESULTS(1),U,13)=$P(^TMP("PSJ1",$J,4),U)
"RTN","PSBMLLKU",190,0)
 .S $P(RESULTS(1),U,14)=$P(^TMP("PSJ1",$J,1),U,10)
"RTN","PSBMLLKU",191,0)
 .S $P(RESULTS(1),U,15)=$P(^TMP("PSJ1",$J,0),U,3)
"RTN","PSBMLLKU",192,0)
 .I (PSBXTAB="UD"),($P(^TMP("PSJ1",$J,2),U,6)="PATCH") S PSBPTCHX=1
"RTN","PSBMLLKU",193,0)
 .I PSBXTAB="IV" S PSBXIV=1
"RTN","PSBMLLKU",194,0)
 .S:$G(PSBXTAB)]"" $P(RESULTS(1),U,11)=$G(PSBXTAB)
"RTN","PSBMLLKU",195,0)
 K ^TMP("PSJ1",$J)
"RTN","PSBMLLKU",196,0)
 Q
"RTN","PSBMLLKU",197,0)
 ;
"RTN","PSBMLLKU",198,0)
KILLAADT ;
"RTN","PSBMLLKU",199,0)
 ;   Here because there is an errorant index entry via version 1.0/2.0
"RTN","PSBMLLKU",200,0)
 ;   Cleansing!
"RTN","PSBMLLKU",201,0)
 ;
"RTN","PSBMLLKU",202,0)
 K ^PSB(53.79,"AADT",DFN,PSBSRCH,PSBIEN)
"RTN","PSBMLLKU",203,0)
 Q
"RTN","PSBMLLKU",204,0)
 ;
"RTN","PSBOMM")
0^2^B87016727^B85940582
"RTN","PSBOMM",1,0)
PSBOMM ;BIRMINGHAM/EFC-MISSED MEDS ;Mar 2004
"RTN","PSBOMM",2,0)
 ;;3.0;BAR CODE MED ADMIN;**26,32,56**;Mar 2004;Build 10
"RTN","PSBOMM",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOMM",4,0)
 ;
"RTN","PSBOMM",5,0)
 ; Reference/IA
"RTN","PSBOMM",6,0)
 ; ^DPT/10035
"RTN","PSBOMM",7,0)
 ; EN^PSJBCMA/2828
"RTN","PSBOMM",8,0)
 ; EN^PSJBCMA2/2830
"RTN","PSBOMM",9,0)
EN ;
"RTN","PSBOMM",10,0)
 N PSBSTRT,PSBSTOP,DFN,PSBODATE,PSBFLAG,PSBCNT,PSBEDIT,PSBFUTR
"RTN","PSBOMM",11,0)
 S PSBSTART=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7),PSBSTOP=$P(PSBRPT(.1),U,8)+$P(PSBRPT(.1),U,9)
"RTN","PSBOMM",12,0)
 D DEFLT^PSBOMM2
"RTN","PSBOMM",13,0)
 K PSBOCRIT,PSBACRIT,PSBS
"RTN","PSBOMM",14,0)
 S PSBOCRIT="^A^H^O" ;PSB*3*56 Adds the On Call Status to the Missed Meds Report
"RTN","PSBOMM",15,0)
 S:$P(PSBFUTR,U,8) PSBOCRIT=PSBOCRIT_"^D^DE" S:$P(PSBFUTR,U,7) PSBOCRIT=PSBOCRIT_"^E"
"RTN","PSBOMM",16,0)
 S PSBACRIT="MG"
"RTN","PSBOMM",17,0)
 S:$P(PSBFUTR,U,17) PSBACRIT=PSBACRIT_"H" S:$P(PSBFUTR,U,18) PSBACRIT=PSBACRIT_"R"
"RTN","PSBOMM",18,0)
 S PSBINCC=0 S:$P(PSBRPT(.2),U,8) PSBINCC=1
"RTN","PSBOMM",19,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J),^TMP("PSB1",$J)
"RTN","PSBOMM",20,0)
 S PSBSTRT=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7)-.0000001
"RTN","PSBOMM",21,0)
 F DFN=0:0 S DFN=$O(^TMP("PSBO",$J,DFN)) Q:'DFN  D EN1
"RTN","PSBOMM",22,0)
 D PRINT
"RTN","PSBOMM",23,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J),^TMP("PSBO",$J),PSBS
"RTN","PSBOMM",24,0)
 Q
"RTN","PSBOMM",25,0)
EN1 ;
"RTN","PSBOMM",26,0)
 N PSBGBL,PSBHDR,PSBX,PSBDFN,PSBDT,PSBEVDT,PSBH
"RTN","PSBOMM",27,0)
 K ^TMP("PSJ",$J) S PSBEVDT=PSBSTRT
"RTN","PSBOMM",28,0)
 D EN^PSJBCMA(DFN,PSBSTRT)
"RTN","PSBOMM",29,0)
 Q:^TMP("PSJ",$J,1,0)=-1
"RTN","PSBOMM",30,0)
 S PSBX=""
"RTN","PSBOMM",31,0)
 F  S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:PSBX=""  D
"RTN","PSBOMM",32,0)
 .Q:^TMP("PSJ",$J,PSBX,0)=-1
"RTN","PSBOMM",33,0)
 .D NOW^%DTC
"RTN","PSBOMM",34,0)
 .D CLEAN^PSBVT
"RTN","PSBOMM",35,0)
 .D PSJ^PSBVT(PSBX)
"RTN","PSBOMM",36,0)
 .Q:PSBIVT="A"
"RTN","PSBOMM",37,0)
 .Q:PSBIVT="H"
"RTN","PSBOMM",38,0)
 .I PSBIVT["S",PSBISYR'=1 Q
"RTN","PSBOMM",39,0)
 .I PSBIVT["C",PSBCHEMT'="P",PSBISYR'=1 Q
"RTN","PSBOMM",40,0)
 .I PSBIVT["C",PSBCHEMT="A" Q
"RTN","PSBOMM",41,0)
 .Q:PSBONX["P"
"RTN","PSBOMM",42,0)
 .Q:PSBOSP<PSBSTART
"RTN","PSBOMM",43,0)
 .I %>PSBOSP,PSBOSTS'="D",PSBOSTS'="DE",PSBOSTS'="H" S PSBOSTS="E"
"RTN","PSBOMM",44,0)
 .I PSBSCHT="C" D  Q
"RTN","PSBOMM",45,0)
 ..S (PSBYES,PSBODD)=0
"RTN","PSBOMM",46,0)
 ..S PSBDOW="SU^MO^TU^WE^TH^FR^SA" F I=1:1:7 I $P(PSBDOW,"^",I)=$E(PSBSCH,1,2) S PSBYES=1
"RTN","PSBOMM",47,0)
 ..I PSBYES,PSBADST="" Q
"RTN","PSBOMM",48,0)
 ..F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1
"RTN","PSBOMM",49,0)
 ..S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBOMM",50,0)
 ..I PSBFREQ="O" S PSBYES=1,PSBFREQ=1440
"RTN","PSBOMM",51,0)
 ..I 'PSBYES,PSBADST="",PSBFREQ<1 Q
"RTN","PSBOMM",52,0)
 ..I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBOMM",53,0)
 ..I PSBODD,PSBADST'="" Q
"RTN","PSBOMM",54,0)
 ..Q:PSBOCRIT'[PSBOSTS
"RTN","PSBOMM",55,0)
 ..Q:PSBNGF
"RTN","PSBOMM",56,0)
 ..Q:PSBOSTS="N"
"RTN","PSBOMM",57,0)
 ..Q:PSBSM
"RTN","PSBOMM",58,0)
 ..S PSBS(DFN,PSBONX,$S(PSBOSTS="A":"Active",PSBOSTS="H":"On Hold",PSBOSTS="D":"DC'd",PSBOSTS="DE":"DC'd (Edit)",PSBOSTS="E":"Expired",PSBOSTS="O":"On Call",1:" *Unknown* "))=""
"RTN","PSBOMM",59,0)
 ..S PSBSTXP(PSBONX,$$DTFMT^PSBOMM2(PSBOSP))=""
"RTN","PSBOMM",60,0)
 ..S PSBCADM=0
"RTN","PSBOMM",61,0)
 ..I PSBADST="" D  Q:$G(PSBADST)=""  S PSBCADM=1
"RTN","PSBOMM",62,0)
 ...S X=PSBOST D H^%DTC S X1=((%H*24)*60)+(%T/60)
"RTN","PSBOMM",63,0)
 ...S X=PSBSTRT,X3=0 D H^%DTC S X2=((%H*24)*60)+(%T/60)
"RTN","PSBOMM",64,0)
 ...I X2'<X1 S X3=X2-X1 S PSBOST=$$FMADD^XLFDT(PSBSTRT,,,(-1*(X3#PSBFREQ)))
"RTN","PSBOMM",65,0)
 ...K PSBADST S PSBOST2=PSBOST,PSBDT2=PSBSTRT
"RTN","PSBOMM",66,0)
 ...F XZ=0:1 S PSBADST(XZ,PSBDT2)=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST2,PSBFREQ,PSBDT2) D  Q:PSBDT2>PSBSTOP
"RTN","PSBOMM",67,0)
 ....I ($L(PSBADST(XZ,PSBDT2),"-")>$L($G(PSBADST),"-"))!($G(PSBADST)="") S PSBADST=PSBADST(XZ,PSBDT2)
"RTN","PSBOMM",68,0)
 ....S Z=PSBDT2\1,J=$P(PSBADST(XZ,PSBDT2),"-",($L(PSBADST(XZ,PSBDT2),"-"))) S:J]"" PSBOST2=Z_"."_J
"RTN","PSBOMM",69,0)
 ....S PSBDT2=($$FMADD^XLFDT(Z,1))+.2400
"RTN","PSBOMM",70,0)
 ....S PSBDT2=$S($G(FLG):(PSBSTOP\1)+.2401,PSBDT2>PSBOSP:PSBOSP,1:PSBDT2) K FLG I PSBDT2=PSBOSP S FLG=1
"RTN","PSBOMM",71,0)
 ..S Z=PSBADST I Z]"" K ^TMP("PSB",$J,"GETADMIN") S ^TMP("PSB",$J,"GETADMIN",0)=Z
"RTN","PSBOMM",72,0)
 ..F Y=1:1:$L(Z,"-") D
"RTN","PSBOMM",73,0)
 ...Q:($P(Z,"-",Y)'?2N)&($P(Z,"-",Y)'?4N)
"RTN","PSBOMM",74,0)
 ..K PSBOACTL,^TMP("PSB1",$J) D EN^PSJBCMA2(DFN,PSBONX,1) I ^TMP("PSJ2",$J,0)'=1 M PSBOACTL=^TMP("PSJ2",$J) K ^TMP("PSJ2",$J)
"RTN","PSBOMM",75,0)
 ..I 'PSBODD F XX=0:1 Q:'$D(^TMP("PSB",$J,"GETADMIN",XX))  S (PSBADST,Z)=$G(^TMP("PSB",$J,"GETADMIN",XX)) D
"RTN","PSBOMM",76,0)
 ...D MISSED^PSBOMM2(Z,.PSBEDIT,PSBSTRT)
"RTN","PSBOMM",77,0)
 ..I PSBODD F XX=0:1 Q:'$D(PSBADST(XX))  S XXX=$O(PSBADST(XX,"")) S (PSBADST,Z)=PSBADST(XX,XXX) D
"RTN","PSBOMM",78,0)
 ...I Z]"" D MISSED^PSBOMM2(Z,.PSBEDIT,XXX)
"RTN","PSBOMM",79,0)
 .K PSBHDDT,PSBUNHD,^TMP("PSB1",$J)
"RTN","PSBOMM",80,0)
 .I PSBSCHT="O" D  Q
"RTN","PSBOMM",81,0)
 ..Q:PSBOSTS="N"
"RTN","PSBOMM",82,0)
 ..Q:PSBNGF
"RTN","PSBOMM",83,0)
 ..Q:PSBSM
"RTN","PSBOMM",84,0)
 ..Q:(PSBOSP=PSBOST)&(PSBOCRIT'["E")
"RTN","PSBOMM",85,0)
 ..Q:PSBOST'<PSBSTOP
"RTN","PSBOMM",86,0)
 ..S PSBDT="*** ONE-TIME ***"
"RTN","PSBOMM",87,0)
 ..S (PSBSTXP(PSBONX,$$DTFMT^PSBOMM2(PSBOSP)),PSBSTXT(PSBONX,$$DTFMT^PSBOMM2(PSBOST)))=""
"RTN","PSBOMM",88,0)
 ..S (PSBG,X,Y,PSBXSTS)="" K PSBEXST
"RTN","PSBOMM",89,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBOMM",90,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBOMM",91,0)
 ....S PSBXSTS=$P(^PSB(53.79,Y,0),U,9)
"RTN","PSBOMM",92,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBONX,PSBXSTS'="N",PSBXSTS'="M" S PSBG=1,PSBG(PSBONX,Y)="",(X,Y)=0
"RTN","PSBOMM",93,0)
 ..I PSBG D PARTG1^PSBOMM2($O(PSBG(PSBONX,"")))
"RTN","PSBOMM",94,0)
 ..D NOW^%DTC
"RTN","PSBOMM",95,0)
 ..Q:(PSBOCRIT'[PSBOSTS)
"RTN","PSBOMM",96,0)
 ..S PSBS(DFN,PSBONX,$S(PSBOSTS="A":"Active",PSBOSTS="H":"On Hold",PSBOSTS="D":"DC'd",PSBOSTS="DE":"DC'd (Edit)",PSBOSTS="E":"Expired",PSBOSTS="O":"On Call",1:" * ERROR * "))=""
"RTN","PSBOMM",97,0)
 ..D:'PSBG!(PSBACRIT[$G(PSBXSTS,1))
"RTN","PSBOMM",98,0)
 ...S VAR=""
"RTN","PSBOMM",99,0)
 ...K ^TMP("PSJ2",$J),^TMP("PSB1",$J),PSBOACTL D EN^PSJBCMA2(DFN,PSBONX,1) I ^TMP("PSJ2",$J,0)'=1 D
"RTN","PSBOMM",100,0)
 ....M PSBOACTL=^TMP("PSJ2",$J)
"RTN","PSBOMM",101,0)
 ....D UDONE^PSBOMM2
"RTN","PSBOMM",102,0)
 ....I PSBFLAG=1 S VAR="(On Hold) "_$$DTFMT^PSBOMM2(PSBHDDT)
"RTN","PSBOMM",103,0)
 ....I PSBFLAG=2 S VAR="(On Hold) "_$$DTFMT^PSBOMM2(PSBHDDT)_"  (Off Hold) "_$$DTFMT^PSBOMM2(PSBUNHD)
"RTN","PSBOMM",104,0)
 ...I '$G(PSBEXST,0)!(PSBXSTS="M") S $P(^TMP("PSB",$J,DFN,"*** ONE-TIME ***",PSBOITX,PSBONX),U,1,4)=VAR
"RTN","PSBOMM",105,0)
 ...I $G(PSBEXST,0) D
"RTN","PSBOMM",106,0)
 ....S VAR1=$G(^TMP("PSB",$J,DFN,"*** ONE-TIME ***","* "_PSBOITX,PSBONX)) I VAR1]"" S $P(VAR1,U,1,4)=VAR_VAR1
"RTN","PSBOMM",107,0)
 ...K PSBHDDT,PSBUNHD,^TMP("PSB1",$J),PSBCNT
"RTN","PSBOMM",108,0)
 K PSBOACTL
"RTN","PSBOMM",109,0)
 Q
"RTN","PSBOMM",110,0)
PRINT ;
"RTN","PSBOMM",111,0)
 N PSBHDR,PSBDT,PSBOITX,PSBONX,DFN
"RTN","PSBOMM",112,0)
 K PSBNPG
"RTN","PSBOMM",113,0)
 S Y=$S($P(PSBRPT(.1),U,8)]"":$P(PSBRPT(.1),U,8),1:$P(PSBRPT(.1),U,6))
"RTN","PSBOMM",114,0)
 D:$P(PSBRPT(.1),U,1)="P"
"RTN","PSBOMM",115,0)
 .S PSBHDR(1)="MISSED MEDICATIONS REPORT for "_$$FMTE^XLFDT($P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7))_" to "_$$FMTE^XLFDT(Y+$P(PSBRPT(.1),U,9))
"RTN","PSBOMM",116,0)
 .S PSBHDR(2)="Order Status(es): --"
"RTN","PSBOMM",117,0)
 .F Y=5,8,7 I $P(PSBFUTR,U,Y) S $P(PSBHDR(2),": ",2)=$P(PSBHDR(2),": ",2)_$S(PSBHDR(2)["--":"",1:"/ ")_$P("^^^^Active^^Expired^DC'd^^^^^^^^^^",U,Y)_" " S PSBHDR(2)=$TR(PSBHDR(2),"-","")
"RTN","PSBOMM",118,0)
 .S PSBHDR(3)="Admin Status(es): --"
"RTN","PSBOMM",119,0)
 .F Y=16,17,18 I $P(PSBFUTR,U,Y) S $P(PSBHDR(3),": ",2)=$P(PSBHDR(3),": ",2)_$S(PSBHDR(3)["--":"",1:"/ ")_$P("^^^^^^^^^^^^^^^Missing Dose^Held^Refused",U,Y)_" " S PSBHDR(3)=$TR(PSBHDR(3),"-","")
"RTN","PSBOMM",120,0)
 .I PSBINCC S PSBHDR(4)="Include Comments/Reasons"
"RTN","PSBOMM",121,0)
 .S DFN=$P(PSBRPT(.1),U,2)
"RTN","PSBOMM",122,0)
 .W $$PTHDR()
"RTN","PSBOMM",123,0)
 .I $G(PSBEDIT) W !?7,"*Administration Times have been edited*"
"RTN","PSBOMM",124,0)
 .I $O(^TMP("PSB",$J,DFN,""))="" W !,"No Missed Medications Found",$$PTFTR^PSBOHDR() Q
"RTN","PSBOMM",125,0)
 .S PSBDT=""
"RTN","PSBOMM",126,0)
 .F  S PSBDT=$O(^TMP("PSB",$J,DFN,PSBDT)) Q:PSBDT=""  D
"RTN","PSBOMM",127,0)
 ..W !
"RTN","PSBOMM",128,0)
 ..S PSBOITX=""
"RTN","PSBOMM",129,0)
 ..F  S PSBOITX=$O(^TMP("PSB",$J,DFN,PSBDT,PSBOITX)) Q:PSBOITX=""  D
"RTN","PSBOMM",130,0)
 ...S PSBONX=""
"RTN","PSBOMM",131,0)
 ...F  S PSBONX=$O(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)) Q:PSBONX=""  D
"RTN","PSBOMM",132,0)
 ....K VAR1,VAR2,VAR3,SP I $Y>(IOSL-9) W $$PTFTR^PSBOHDR(),$$PTHDR()
"RTN","PSBOMM",133,0)
 ....S VAR1=$G(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX))
"RTN","PSBOMM",134,0)
 ....S VAR2=$G(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX,"X"))
"RTN","PSBOMM",135,0)
 ....S VAR3=$G(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX,.3))
"RTN","PSBOMM",136,0)
 ....I PSBDT["ONE-TIME" D  Q
"RTN","PSBOMM",137,0)
 .....W !
"RTN","PSBOMM",138,0)
 .....W !,$O(PSBS(DFN,PSBONX,"")),?15,PSBDT,?43,PSBOITX,!
"RTN","PSBOMM",139,0)
 .....I VAR1]"" W ?43,VAR1 S SP=1
"RTN","PSBOMM",140,0)
 .....I VAR2]"" W:$G(SP) ! W ?43,VAR2
"RTN","PSBOMM",141,0)
 .....I VAR3]"" W !,$$WRAP^PSBO(43,80,VAR3)
"RTN","PSBOMM",142,0)
 .....W !,"Start Date/Time:  ",?18,$O(PSBSTXT(PSBONX,""))
"RTN","PSBOMM",143,0)
 .....W !,"Stop Date/Time:  ",?18,$O(PSBSTXP(PSBONX,""))
"RTN","PSBOMM",144,0)
 ....W !,$O(PSBS(DFN,PSBONX,"")),?15,$S(+PSBDT>0:$$DTFMT^PSBOMM2(PSBDT),1:PSBDT),?43,PSBOITX,?95,$O(PSBSTXP(PSBONX,"")),!
"RTN","PSBOMM",145,0)
 ....I VAR1]"" W ?43,VAR1 S SP=1
"RTN","PSBOMM",146,0)
 ....I VAR2]"" W:$G(SP) ! W ?43,VAR2
"RTN","PSBOMM",147,0)
 ....I VAR3]"" W !,$$WRAP^PSBO(43,80,VAR3)
"RTN","PSBOMM",148,0)
 .W $$PTFTR^PSBOHDR()
"RTN","PSBOMM",149,0)
 .Q
"RTN","PSBOMM",150,0)
 D:$P(PSBRPT(.1),U,1)="W"
"RTN","PSBOMM",151,0)
 .S PSBHDR(1)="MISSED MEDICATIONS REPORT for "_$$FMTE^XLFDT($P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7))_" to "_$$FMTE^XLFDT(Y+$P(PSBRPT(.1),U,9))
"RTN","PSBOMM",152,0)
 .S PSBHDR(2)="Order Status(es): --"
"RTN","PSBOMM",153,0)
 .F Y=5,7,8 I $P(PSBFUTR,U,Y) S $P(PSBHDR(2),": ",2)=$P(PSBHDR(2),": ",2)_$S(PSBHDR(2)["--":"",1:"/ ")_$P("^^^^Active^^Expired^DC'd^^^^^^^^^^",U,Y)_" " S PSBHDR(2)=$TR(PSBHDR(2),"-","")
"RTN","PSBOMM",154,0)
 .S PSBHDR(3)="Admin Status(es): --"
"RTN","PSBOMM",155,0)
 .F Y=16,17,18 I $P(PSBFUTR,U,Y) S $P(PSBHDR(3),": ",2)=$P(PSBHDR(3),": ",2)_$S(PSBHDR(3)["--":"",1:"/ ")_$P("^^^^^^^^^^^^^^^Missing Dose^Held^Refused",U,Y)_" " S PSBHDR(3)=$TR(PSBHDR(3),"-","")
"RTN","PSBOMM",156,0)
 .I PSBINCC S PSBHDR(4)="Include Comments/Reasons"
"RTN","PSBOMM",157,0)
 .S PSBWARD=$P(PSBRPT(.1),U,3)
"RTN","PSBOMM",158,0)
 .W $$WRDHDR()
"RTN","PSBOMM",159,0)
 .I '$O(^TMP("PSB",$J,0)) W !,"No Missed Medications Found" Q
"RTN","PSBOMM",160,0)
 .S PSBSORT=$P(PSBRPT(.1),U,5)
"RTN","PSBOMM",161,0)
 .F DFN=0:0 S DFN=$O(^TMP("PSB",$J,DFN)) Q:'DFN  D
"RTN","PSBOMM",162,0)
 ..S PSBDX=$S(PSBSORT="P":$P(^DPT(DFN,0),U),1:$G(^DPT(DFN,.1))_" "_$G(^(.101)))
"RTN","PSBOMM",163,0)
 ..S:PSBDX="" PSBDX=$P(^DPT(DFN,0),U)
"RTN","PSBOMM",164,0)
 ..S ^TMP("PSB",$J,"B",PSBDX,DFN)=""
"RTN","PSBOMM",165,0)
 .S PSBDX=""
"RTN","PSBOMM",166,0)
 .F  S PSBDX=$O(^TMP("PSB",$J,"B",PSBDX)) Q:PSBDX=""  D
"RTN","PSBOMM",167,0)
 ..F DFN=0:0 S DFN=$O(^TMP("PSB",$J,"B",PSBDX,DFN)) Q:'DFN  D
"RTN","PSBOMM",168,0)
 ...W !
"RTN","PSBOMM",169,0)
 ...S PSBDT=""
"RTN","PSBOMM",170,0)
 ...F  S PSBDT=$O(^TMP("PSB",$J,DFN,PSBDT)) Q:PSBDT=""  D
"RTN","PSBOMM",171,0)
 ....W !
"RTN","PSBOMM",172,0)
 ....W:PSBDT["ONE-TIME" !
"RTN","PSBOMM",173,0)
 ....S PSBOITX=""
"RTN","PSBOMM",174,0)
 ....F  S PSBOITX=$O(^TMP("PSB",$J,DFN,PSBDT,PSBOITX)) Q:PSBOITX=""  D
"RTN","PSBOMM",175,0)
 .....S PSBONX=""
"RTN","PSBOMM",176,0)
 .....F  S PSBONX=$O(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)) Q:PSBONX=""  D
"RTN","PSBOMM",177,0)
 ......K VAR1,VAR2,VAR3,SP I $Y>(IOSL-9) W $$WRDHDR()
"RTN","PSBOMM",178,0)
 ......W !,$O(PSBS(DFN,PSBONX,"")),?15,$G(^DPT(DFN,.101),"**"),?35,$P(^DPT(DFN,0),U)," (",$E($P(^(0),U,9),6,9),")"
"RTN","PSBOMM",179,0)
 ......S VAR1=$G(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX))
"RTN","PSBOMM",180,0)
 ......S VAR2=$G(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX,"X"))
"RTN","PSBOMM",181,0)
 ......S VAR3=$G(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX,.3))
"RTN","PSBOMM",182,0)
 ......I PSBDT["ONE-TIME" D  Q
"RTN","PSBOMM",183,0)
 .......W !,PSBDT,?30,PSBOITX S SP=1
"RTN","PSBOMM",184,0)
 .......I VAR1]"" W !,?30,$P(VAR1,U,1) S SP=1
"RTN","PSBOMM",185,0)
 .......I VAR2]"" W:$G(SP) ! W ?30,VAR2
"RTN","PSBOMM",186,0)
 .......I VAR3]"" W !,$$WRAP^PSBO(30,95,VAR3)
"RTN","PSBOMM",187,0)
 .......W !,"Start Date/Time:  ",?18,$O(PSBSTXT(PSBONX,""))
"RTN","PSBOMM",188,0)
 .......W !,"Stop Date/Time:  ",?18,$O(PSBSTXP(PSBONX,""))
"RTN","PSBOMM",189,0)
 .......W !
"RTN","PSBOMM",190,0)
 ......W ?67,$S(+PSBDT>0:$$DTFMT^PSBOMM2(PSBDT),1:PSBDT),?85,PSBOITX S SP=1
"RTN","PSBOMM",191,0)
 ......I VAR1]"" W !,?50,VAR1 S SP=1
"RTN","PSBOMM",192,0)
 ......I VAR2]"" W:$G(SP) ! W ?50,VAR2
"RTN","PSBOMM",193,0)
 ......I VAR3]"" W !,$$WRAP^PSBO(50,75,VAR3)
"RTN","PSBOMM",194,0)
 Q
"RTN","PSBOMM",195,0)
WRDHDR() ;
"RTN","PSBOMM",196,0)
 D WARD^PSBOHDR(PSBWRD,.PSBHDR)
"RTN","PSBOMM",197,0)
 W !,"Order Status",?15,"Room-Bed",?35,"Patient",?67,"Admin Date/Time",?85,"Medication"
"RTN","PSBOMM",198,0)
 D LN1^PSBOMM2
"RTN","PSBOMM",199,0)
 Q ""
"RTN","PSBOMM",200,0)
PTHDR() ;
"RTN","PSBOMM",201,0)
 D PT^PSBOHDR(DFN,.PSBHDR)
"RTN","PSBOMM",202,0)
 W !,"Order Status",?15,"Administration Date/Time",?43,"Medication",?95,"Order Stop Date"
"RTN","PSBOMM",203,0)
 D LN1^PSBOMM2
"RTN","PSBOMM",204,0)
 Q ""
"RTN","PSBOWA")
0^1^B51492255^B50135116
"RTN","PSBOWA",1,0)
PSBOWA ;BIRMINGHAM/EFC-WARD ADMINISTRATION TIMES ;Mar 2004
"RTN","PSBOWA",2,0)
 ;;3.0;BAR CODE MED ADMIN;**9,32,56**;Mar 2004;Build 10
"RTN","PSBOWA",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOWA",4,0)
 ;
"RTN","PSBOWA",5,0)
 ; Reference/IA
"RTN","PSBOWA",6,0)
 ; ^DPT/10035
"RTN","PSBOWA",7,0)
 ; EN^PSJBCMA/2828
"RTN","PSBOWA",8,0)
EN ;
"RTN","PSBOWA",9,0)
 N PSBHDR,PSBGTOT,PSBTOT,PSBINDX,DFN,PSBX,PSBY,PSBSM,PSBADST,PSBZ
"RTN","PSBOWA",10,0)
 S (Y,PSBEVDT)=$P(PSBRPT(.1),U,6) D D^DIQ
"RTN","PSBOWA",11,0)
 S PSBHDR(2)="ADMINISTRATION DATE: "_Y
"RTN","PSBOWA",12,0)
 S (Y,PSBEVDT2)=$S($P(PSBRPT(.1),U,8)']"":PSBEVDT,1:$P(PSBRPT(.1),U,8)) D D^DIQ
"RTN","PSBOWA",13,0)
 S PSBHDR(2)=PSBHDR(2)_" to "_Y
"RTN","PSBOWA",14,0)
 F PSBIX=0:1 S PSBRPDT=$$FMADD^XLFDT(PSBEVDT,PSBIX) Q:PSBRPDT>PSBEVDT2!(PSBRPDT="-1")  D
"RTN","PSBOWA",15,0)
 .D:$P(PSBRPT(.1),U)="W"
"RTN","PSBOWA",16,0)
 ..F X=0,.01:.01:.24 S PSBGTOT(X)=""
"RTN","PSBOWA",17,0)
 ..W $$WRDHDR()
"RTN","PSBOWA",18,0)
 ..S PSBINDX=""
"RTN","PSBOWA",19,0)
 ..F  S PSBINDX=$O(^TMP("PSBO",$J,"B",PSBINDX)) Q:PSBINDX=""  D
"RTN","PSBOWA",20,0)
 ...F DFN=0:0 S DFN=$O(^TMP("PSBO",$J,"B",PSBINDX,DFN)) Q:'DFN  D
"RTN","PSBOWA",21,0)
 ....W:$Y>(IOSL-10) $$WRDHDR()
"RTN","PSBOWA",22,0)
 ....W !,$P(^DPT(DFN,0),U,1),!,"SSN: ",$P(^(0),U,9)
"RTN","PSBOWA",23,0)
 ....W !,"Ward: ",$E($G(^DPT(DFN,.1)),1,25),!,"Room-Bed:  ",$E($G(^(.101)),1,21)
"RTN","PSBOWA",24,0)
 ....W ?32
"RTN","PSBOWA",25,0)
 ....F X=0,.01:.01:.24 S PSBTOT(X)=""
"RTN","PSBOWA",26,0)
 ....K ^TMP("PSJ",$J)
"RTN","PSBOWA",27,0)
 ....D EN^PSJBCMA(DFN,$P(PSBRPT(.1),U,6))
"RTN","PSBOWA",28,0)
 ....F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:'PSBX  D
"RTN","PSBOWA",29,0)
 .....Q:^TMP("PSJ",$J,PSBX,0)=-1  ; No Orders
"RTN","PSBOWA",30,0)
 .....D CLEAN^PSBVT
"RTN","PSBOWA",31,0)
 .....D PSJ^PSBVT(PSBX)
"RTN","PSBOWA",32,0)
 .....Q:PSBSCHT'="C"  ; Not a Continuous
"RTN","PSBOWA",33,0)
 .....Q:PSBOSTS'="A"&(PSBOSTS'="R")&(PSBOSTS'="O")  ; Active? - PSB*3*56 adds on call as an active status
"RTN","PSBOWA",34,0)
 .....Q:PSBSM=1  ;Self med?
"RTN","PSBOWA",35,0)
 .....S (PSBCADM,PSBYES,PSBODD)=0
"RTN","PSBOWA",36,0)
 .....S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBOWA",37,0)
 .....S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBOWA",38,0)
 .....F I=1:1 Q:$P(PSBSCH,"-",I)=""  I ($P(PSBSCH,"-",I)?2N)!($P(PSBSCH,"-",I)?4N) S PSBYES=1
"RTN","PSBOWA",39,0)
 .....I PSBYES,PSBADST="",PSBSCHT'="O",PSBSCHT'="OC",PSBSCHT'="P" D  Q
"RTN","PSBOWA",40,0)
 ......D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH)
"RTN","PSBOWA",41,0)
 .....I "PCS"'[PSBIVT,PSBONX'["U" Q
"RTN","PSBOWA",42,0)
 .....I PSBIVT["S",PSBISYR'=1 Q  ;    allow intermittent syringe only
"RTN","PSBOWA",43,0)
 .....I PSBIVT["C",PSBCHEMT'="P",PSBISYR'=1 Q
"RTN","PSBOWA",44,0)
 .....I PSBIVT["C",PSBCHEMT="A" Q  ;     allow Chemo with intermittent syringe or Piggyback type only
"RTN","PSBOWA",45,0)
 .....I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBOWA",46,0)
 .....I 'PSBYES,PSBFREQ<1 D  Q
"RTN","PSBOWA",47,0)
 ......D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH)
"RTN","PSBOWA",48,0)
 .....I +PSBFREQ>0 D
"RTN","PSBOWA",49,0)
 ......I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBOWA",50,0)
 .....I PSBODD,PSBADST'="" D  Q
"RTN","PSBOWA",51,0)
 ......D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Administration Times on ODD SCHEDULE",PSBSCH)
"RTN","PSBOWA",52,0)
 .....K ^TMP("PSB",$J,"GETADMIN")
"RTN","PSBOWA",53,0)
 .....I PSBADST="" S PSBADST=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBRPDT) S:PSBADST'="" PSBCADM=1
"RTN","PSBOWA",54,0)
 .....E  S ^TMP("PSB",$J,"GETADMIN",0)=PSBADST
"RTN","PSBOWA",55,0)
 .....Q:PSBADST=""
"RTN","PSBOWA",56,0)
 .....I PSBONX'["V" D  Q:'$$OKAY^PSBVDLU1(PSBOST,$P(PSBRPT(.1),U,6),PSBSCH,PSBONX,PSBOIT,PSBFREQ)
"RTN","PSBOWA",57,0)
 .....I PSBONX["V",PSBSCH'=""  Q:'$$OKAY^PSBVDLU1(PSBOST,$P(PSBRPT(.1),U,6),PSBSCH,PSBONX,PSBOIT,PSBFREQ)
"RTN","PSBOWA",58,0)
 .....F PSBXX=0:1 Q:'$D(^TMP("PSB",$J,"GETADMIN",PSBXX))  S PSBADST=$G(^TMP("PSB",$J,"GETADMIN",PSBXX)) D
"RTN","PSBOWA",59,0)
 ......F Y=1:1:$L(PSBADST,"-") S Z=+("."_$E($P(PSBADST,"-",Y),1,2)) D
"RTN","PSBOWA",60,0)
 .......Q:(($P(PSBRPT(.1),U,6)+Z)<$E(PSBOST,1,12))&($G(Z)'=0)  ;Start Date
"RTN","PSBOWA",61,0)
 .......Q:($P(PSBRPT(.1),U,6)+Z)'<$E(PSBOSP,1,12)  ;Stop Date
"RTN","PSBOWA",62,0)
 .......;For invalid admin times
"RTN","PSBOWA",63,0)
 .......D:($P(PSBADST,"-",Y)'?2N)&($P(PSBADST,"-",Y)'?4N)
"RTN","PSBOWA",64,0)
 ........D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid Admin times",PSBSCH)
"RTN","PSBOWA",65,0)
 .......S PSBTOT(Z)=PSBTOT(Z)+1
"RTN","PSBOWA",66,0)
 .......S PSBGTOT(Z)=PSBGTOT(Z)+1
"RTN","PSBOWA",67,0)
 ....S PSBX="" F  S PSBX=$O(PSBTOT(PSBX)) Q:$G(PSBX)=""  W $J(PSBTOT(PSBX),4)
"RTN","PSBOWA",68,0)
 ....W !,$TR($J("",IOM)," ","-")
"RTN","PSBOWA",69,0)
 ..W !!,$TR($J("",IOM)," ","=")
"RTN","PSBOWA",70,0)
 ..W !?32 F X=0,.01:.01:.24 W $J($E(X_"00",2,3),4)
"RTN","PSBOWA",71,0)
 ..W !,"Hourly Totals:",?32
"RTN","PSBOWA",72,0)
 ..S PSBGTOT=0
"RTN","PSBOWA",73,0)
 ..S PSBX="" F  S PSBX=$O(PSBGTOT(PSBX)) Q:$G(PSBX)=""  D
"RTN","PSBOWA",74,0)
 ...W $J(PSBGTOT(PSBX),4)
"RTN","PSBOWA",75,0)
 ...S PSBGTOT=PSBGTOT+PSBGTOT(PSBX)
"RTN","PSBOWA",76,0)
 ..W !!,"Ward Total:",?32,$J(PSBGTOT,4)
"RTN","PSBOWA",77,0)
 ..W !!,$TR($J("",IOM)," ","-")
"RTN","PSBOWA",78,0)
 ..K ^TMP("PSJ",$J)
"RTN","PSBOWA",79,0)
 .D:$P(PSBRPT(.1),U)="P"
"RTN","PSBOWA",80,0)
 ..S DFN=PSBDFN
"RTN","PSBOWA",81,0)
 ..S PSBHDR(1)="WARD ADMINISTRATION TIMES"
"RTN","PSBOWA",82,0)
 ..S Y=$P(PSBRPT(.1),U,6) D D^DIQ S PSBHDR(2)="ADMINISTRATION DATE: "_Y
"RTN","PSBOWA",83,0)
 ..S Y=PSBEVDT2 D D^DIQ S PSBHDR(2)=PSBHDR(2)_" to "_Y
"RTN","PSBOWA",84,0)
 ..W $$PTHDR()
"RTN","PSBOWA",85,0)
 ..K ^TMP("PSJ",$J),PSBTOT
"RTN","PSBOWA",86,0)
 ..D EN^PSJBCMA(PSBDFN,PSBRPDT,"")
"RTN","PSBOWA",87,0)
 ..F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:'PSBX  D
"RTN","PSBOWA",88,0)
 ...Q:^TMP("PSJ",$J,PSBX,0)=-1  ; No Orders
"RTN","PSBOWA",89,0)
 ...D CLEAN^PSBVT
"RTN","PSBOWA",90,0)
 ...D PSJ^PSBVT(PSBX)
"RTN","PSBOWA",91,0)
 ...Q:PSBSCHT'="C"  ; Not a Continuous
"RTN","PSBOWA",92,0)
 ...Q:PSBOSTS'="A"&(PSBOSTS'="R")&(PSBOSTS'="O")  ; Active? - PSB*3*56 adds on call as an active status
"RTN","PSBOWA",93,0)
 ...S (PSBCADM,PSBYES,PSBODD)=0
"RTN","PSBOWA",94,0)
 ...S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBOWA",95,0)
 ...S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBOWA",96,0)
 ...F I=1:1 Q:$P(PSBSCH,"-",I)=""  I ($P(PSBSCH,"-",I)?2N)!($P(PSBSCH,"-",I)?4N) S PSBYES=1
"RTN","PSBOWA",97,0)
 ...I PSBYES,PSBADST="",PSBSCHT'="O",PSBSCHT'="OC",PSBSCHT'="P" D  Q
"RTN","PSBOWA",98,0)
 ....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH)
"RTN","PSBOWA",99,0)
 ...I "PCS"'[PSBIVT,PSBONX'["U" Q
"RTN","PSBOWA",100,0)
 ...I PSBIVT["S",PSBISYR'=1 Q  ;    allow intermittent syringe only
"RTN","PSBOWA",101,0)
 ...I PSBIVT["C",PSBCHEMT'="P",PSBISYR'=1 Q
"RTN","PSBOWA",102,0)
 ...I PSBIVT["C",PSBCHEMT="A" Q  ;     allow Chemo with intermittent syringe or Piggyback type only
"RTN","PSBOWA",103,0)
 ...I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBOWA",104,0)
 ...I 'PSBYES,PSBFREQ<1 D  Q
"RTN","PSBOWA",105,0)
 ....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH)
"RTN","PSBOWA",106,0)
 ...I +PSBFREQ>0 D
"RTN","PSBOWA",107,0)
 ....I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBOWA",108,0)
 ...I PSBODD,PSBADST'="" D  Q
"RTN","PSBOWA",109,0)
 ....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Administration Times on ODD SCHEDULE",PSBSCH)
"RTN","PSBOWA",110,0)
 ...K ^TMP("PSB",$J,"GETADMIN")
"RTN","PSBOWA",111,0)
 ...I PSBADST="",+$G(PSBFREQ)>0,$G(PSBFREQ)<30 S PSBADST="MESSAGE",$P(PSBTOT(PSBADST,PSBOITX,PSBONX),2)="Due every "_PSBFREQ_" Mins" Q
"RTN","PSBOWA",112,0)
 ...I PSBADST="",+$G(PSBFREQ)'<30 S PSBADST=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBRPDT) S:PSBADST'="" PSBCADM=1
"RTN","PSBOWA",113,0)
 ...E  S ^TMP("PSB",$J,"GETADMIN",0)=PSBADST
"RTN","PSBOWA",114,0)
 ...Q:PSBADST=""
"RTN","PSBOWA",115,0)
 ...I PSBONX'["V" D  Q:'$$OKAY^PSBVDLU1(PSBOST,PSBRPDT,PSBSCH,PSBONX,PSBOIT,PSBFREQ)
"RTN","PSBOWA",116,0)
 ...I PSBONX["V",PSBSCH'=""  Q:'$$OKAY^PSBVDLU1(PSBOST,PSBRPDT,PSBSCH,PSBONX,PSBOIT,PSBFREQ)
"RTN","PSBOWA",117,0)
 ...F PSBXX=0:1 Q:'$D(^TMP("PSB",$J,"GETADMIN",PSBXX))  S PSBADST=$G(^TMP("PSB",$J,"GETADMIN",PSBXX)) D
"RTN","PSBOWA",118,0)
 ....F Y=1:1:$L(PSBADST,"-") S Z=+("."_$P(PSBADST,"-",Y)) D
"RTN","PSBOWA",119,0)
 .....Q:(PSBRPDT+Z)<$E(PSBOST,1,12)  ; Start Date
"RTN","PSBOWA",120,0)
 .....Q:(PSBRPDT+Z)'<$E(PSBOSP,1,12)  ; Stop Date
"RTN","PSBOWA",121,0)
 .....;For Invalid admin times
"RTN","PSBOWA",122,0)
 .....D:($P(PSBADST,"-",Y)'?2N)&($P(PSBADST,"-",Y)'?4N)
"RTN","PSBOWA",123,0)
 ......D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid Admin times",PSBSCH)
"RTN","PSBOWA",124,0)
 .....S PSBSM=$S(PSBHSM=1:"HSM",PSBSM=1:"SM",1:"")
"RTN","PSBOWA",125,0)
 .....;*** Local array to include order no
"RTN","PSBOWA",126,0)
 .....S PSBTOT(Z,PSBOITX,PSBONX)=PSBSM_U_"Dosage: "_PSBDOSE_"  Route: "_PSBMR_"  "_PSBIFR
"RTN","PSBOWA",127,0)
 ..S PSBX="" F  S PSBX=$O(PSBTOT(PSBX)) Q:PSBX=""  D
"RTN","PSBOWA",128,0)
 ...W !
"RTN","PSBOWA",129,0)
 ...S PSBY="" F  S PSBY=$O(PSBTOT(PSBX,PSBY)) Q:PSBY=""  D
"RTN","PSBOWA",130,0)
 ....S PSBZ="" F  S PSBZ=$O(PSBTOT(PSBX,PSBY,PSBZ)) Q:PSBZ=""  D
"RTN","PSBOWA",131,0)
 .....W:$Y>(IOSL-6) $$PTFTR^PSBOHDR(),$$PTHDR()
"RTN","PSBOWA",132,0)
 .....I PSBX="MESSAGE" W !,$P(PSBTOT(PSBX,PSBY,PSBZ),U,1),?20,PSBY Q
"RTN","PSBOWA",133,0)
 .....W !,$$TIMEOUT^PSBUTL(PSBX),?10
"RTN","PSBOWA",134,0)
 .....W $P(PSBTOT(PSBX,PSBY,PSBZ),U,1),?20,PSBY,?55,$P(PSBTOT(PSBX,PSBY,PSBZ),U,2)
"RTN","PSBOWA",135,0)
 ..W $$PTFTR^PSBOHDR()
"RTN","PSBOWA",136,0)
 .K ^TMP("PSJ",$J),^TMP("PSB",$J)
"RTN","PSBOWA",137,0)
 .Q
"RTN","PSBOWA",138,0)
 ;
"RTN","PSBOWA",139,0)
WRDHDR() ;
"RTN","PSBOWA",140,0)
 S PSBHDR(1)="WARD ADMINISTRATION TIMES"
"RTN","PSBOWA",141,0)
 D WARD^PSBOHDR(PSBWRD,.PSBHDR)
"RTN","PSBOWA",142,0)
 S Y=PSBRPDT D D^DIQ
"RTN","PSBOWA",143,0)
 W !,"Patient Name",?64,Y_" Administration Times"
"RTN","PSBOWA",144,0)
 W !,"Room-Bed",?32
"RTN","PSBOWA",145,0)
 F X=0,.01:.01:.24 W $J($E(X_"00",2,3),4)
"RTN","PSBOWA",146,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBOWA",147,0)
 Q ""
"RTN","PSBOWA",148,0)
 ;
"RTN","PSBOWA",149,0)
PTHDR() ;
"RTN","PSBOWA",150,0)
 S PSBHDR(1)="PATIENT ADMINISTRATION TIMES"
"RTN","PSBOWA",151,0)
 D PT^PSBOHDR(PSBDFN,.PSBHDR)
"RTN","PSBOWA",152,0)
 W !,"Date/Time",?10,"Self Med",?20,"Medication",?55,"Dose/Route"
"RTN","PSBOWA",153,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBOWA",154,0)
 S Y=PSBRPDT D D^DIQ
"RTN","PSBOWA",155,0)
 W !!,Y,!
"RTN","PSBOWA",156,0)
 Q ""
"RTN","PSBOWA",157,0)
 ;
"VER")
8.0^22.0
"BLD",8358,6)
^41
**END**
**END**
