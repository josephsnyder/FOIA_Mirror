Released PSB*3*2 SEQ #30
Extracted from mail message
**KIDS**:PSB*3.0*2^

**INSTALL NAME**
PSB*3.0*2
"BLD",6042,0)
PSB*3.0*2^BAR CODE MED ADMIN^0^3080115^y
"BLD",6042,1,0)
^^4^4^3080115^^^^
"BLD",6042,1,1,0)
This patch will add the new Barcode Label Print [PSBO BZ] option 
"BLD",6042,1,2,0)
to the Bar Code Medication Administration application.  Review 
"BLD",6042,1,3,0)
the patch description for detail functionality. 
"BLD",6042,1,4,0)

"BLD",6042,4,0)
^9.64PA^53.69^1
"BLD",6042,4,53.69,0)
53.69
"BLD",6042,4,53.69,2,0)
^9.641^53.69^1
"BLD",6042,4,53.69,2,53.69,0)
BCMA REPORT REQUEST  (File-top level)
"BLD",6042,4,53.69,2,53.69,1,0)
^9.6411^.05^4
"BLD",6042,4,53.69,2,53.69,1,.05,0)
TYPE OF REQUEST
"BLD",6042,4,53.69,2,53.69,1,.32,0)
[BL] LOT NUMBER
"BLD",6042,4,53.69,2,53.69,1,.34,0)
[BL] MANUFACTURER
"BLD",6042,4,53.69,2,53.69,1,.39,0)
[BL] DOSAGE
"BLD",6042,4,53.69,222)
y^n^p^^^^n^^n
"BLD",6042,4,53.69,224)

"BLD",6042,4,"APDD",53.69,53.69)

"BLD",6042,4,"APDD",53.69,53.69,.05)

"BLD",6042,4,"APDD",53.69,53.69,.32)

"BLD",6042,4,"APDD",53.69,53.69,.34)

"BLD",6042,4,"APDD",53.69,53.69,.39)

"BLD",6042,4,"B",53.69,53.69)

"BLD",6042,6)
18^
"BLD",6042,6.3)
22
"BLD",6042,"ABPKG")
n
"BLD",6042,"INI")

"BLD",6042,"INIT")

"BLD",6042,"KRN",0)
^9.67PA^8989.52^19
"BLD",6042,"KRN",.4,0)
.4
"BLD",6042,"KRN",.401,0)
.401
"BLD",6042,"KRN",.402,0)
.402
"BLD",6042,"KRN",.403,0)
.403
"BLD",6042,"KRN",.403,"NM",0)
^9.68A^2^1
"BLD",6042,"KRN",.403,"NM",2,0)
PSBO BZ    FILE #53.69^53.69^0
"BLD",6042,"KRN",.403,"NM","B","PSBO BZ    FILE #53.69",2)

"BLD",6042,"KRN",.5,0)
.5
"BLD",6042,"KRN",.84,0)
.84
"BLD",6042,"KRN",3.6,0)
3.6
"BLD",6042,"KRN",3.8,0)
3.8
"BLD",6042,"KRN",9.2,0)
9.2
"BLD",6042,"KRN",9.8,0)
9.8
"BLD",6042,"KRN",9.8,"NM",0)
^9.68A^8^5
"BLD",6042,"KRN",9.8,"NM",2,0)
PSBOBLU^^0^B32444120
"BLD",6042,"KRN",9.8,"NM",3,0)
PSBPOIV^^0^B63509685
"BLD",6042,"KRN",9.8,"NM",5,0)
PSBOBZ^^0^B18129776
"BLD",6042,"KRN",9.8,"NM",7,0)
PSBO1^^0^B7582589
"BLD",6042,"KRN",9.8,"NM",8,0)
PSBO^^0^B64714477
"BLD",6042,"KRN",9.8,"NM","B","PSBO",8)

"BLD",6042,"KRN",9.8,"NM","B","PSBO1",7)

"BLD",6042,"KRN",9.8,"NM","B","PSBOBLU",2)

"BLD",6042,"KRN",9.8,"NM","B","PSBOBZ",5)

"BLD",6042,"KRN",9.8,"NM","B","PSBPOIV",3)

"BLD",6042,"KRN",19,0)
19
"BLD",6042,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",6042,"KRN",19,"NM",1,0)
PSBO BZ^^0^
"BLD",6042,"KRN",19,"NM",2,0)
PSB PHARMACY^^2
"BLD",6042,"KRN",19,"NM","B","PSB PHARMACY",2)

"BLD",6042,"KRN",19,"NM","B","PSBO BZ",1)

"BLD",6042,"KRN",19.1,0)
19.1
"BLD",6042,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",6042,"KRN",101,0)
101
"BLD",6042,"KRN",101,"NM",0)
^9.68A^^
"BLD",6042,"KRN",409.61,0)
409.61
"BLD",6042,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",6042,"KRN",771,0)
771
"BLD",6042,"KRN",870,0)
870
"BLD",6042,"KRN",8989.51,0)
8989.51
"BLD",6042,"KRN",8989.52,0)
8989.52
"BLD",6042,"KRN",8994,0)
8994
"BLD",6042,"KRN","B",.4,.4)

"BLD",6042,"KRN","B",.401,.401)

"BLD",6042,"KRN","B",.402,.402)

"BLD",6042,"KRN","B",.403,.403)

"BLD",6042,"KRN","B",.5,.5)

"BLD",6042,"KRN","B",.84,.84)

"BLD",6042,"KRN","B",3.6,3.6)

"BLD",6042,"KRN","B",3.8,3.8)

"BLD",6042,"KRN","B",9.2,9.2)

"BLD",6042,"KRN","B",9.8,9.8)

"BLD",6042,"KRN","B",19,19)

"BLD",6042,"KRN","B",19.1,19.1)

"BLD",6042,"KRN","B",101,101)

"BLD",6042,"KRN","B",409.61,409.61)

"BLD",6042,"KRN","B",771,771)

"BLD",6042,"KRN","B",870,870)

"BLD",6042,"KRN","B",8989.51,8989.51)

"BLD",6042,"KRN","B",8989.52,8989.52)

"BLD",6042,"KRN","B",8994,8994)

"BLD",6042,"QDEF")
^^^^NO^^^^YES^^YES
"BLD",6042,"QUES",0)
^9.62^^
"BLD",6042,"REQB",0)
^9.611^2^1
"BLD",6042,"REQB",2,0)
PSB*3.0*32^1
"BLD",6042,"REQB","B","PSB*3.0*32",2)

"FIA",53.69)
BCMA REPORT REQUEST
"FIA",53.69,0)
^PSB(53.69,
"FIA",53.69,0,0)
53.69
"FIA",53.69,0,1)
y^n^p^^^^n^^n
"FIA",53.69,0,10)

"FIA",53.69,0,11)

"FIA",53.69,0,"RLRO")

"FIA",53.69,0,"VR")
3.0^PSB
"FIA",53.69,53.69)
1
"FIA",53.69,53.69,.05)

"FIA",53.69,53.69,.32)

"FIA",53.69,53.69,.34)

"FIA",53.69,53.69,.39)

"KRN",.403,118,-1)
0^2
"KRN",.403,118,0)
PSBO BZ^^^^2990318.1536^^^53.69^0^0^1
"KRN",.403,118,11)
S PSBSAVE=0
"KRN",.403,118,14)
S PSBSAVE=1
"KRN",.403,118,20)
D VAL^PSBO(".31;.06")
"KRN",.403,118,40,0)
^.4031I^1^1
"KRN",.403,118,40,1,0)
1^^1,1
"KRN",.403,118,40,1,1)
Page 1
"KRN",.403,118,40,1,40,0)
^.4032IP^437^3
"KRN",.403,118,40,1,40,435,0)
PSBO HDRBZ^1^1,1^d
"KRN",.403,118,40,1,40,436,0)
PSBO FTRBZ^3^15,1^e
"KRN",.403,118,40,1,40,437,0)
PSBO BLBZ^2^3,1^e
"KRN",.404,435,0)
PSBO HDRBZ^53.69^
"KRN",.404,435,40,0)
^.4044I^4^3
"KRN",.404,435,40,1,0)
1^!M^1
"KRN",.404,435,40,1,.1)
S Y="Request #: "_$P(^PSB(53.69,DA,0),U)
"KRN",.404,435,40,1,2)
^^1,1
"KRN",.404,435,40,3,0)
3^!M^1
"KRN",.404,435,40,3,.1)
S Y=$TR($J("",80)," ","-")
"KRN",.404,435,40,3,2)
^^2,1
"KRN",.404,435,40,4,0)
2^!M^1
"KRN",.404,435,40,4,.1)
S Y=$J($$GET1^DIQ(53.69,DA_",",.05),40)
"KRN",.404,435,40,4,2)
^^1,41
"KRN",.404,436,0)
PSBO FTRBZ^53.69
"KRN",.404,436,40,0)
^.4044I^3^3
"KRN",.404,436,40,1,0)
1^Print to DEVICE^3
"KRN",.404,436,40,1,1)
.06
"KRN",.404,436,40,1,2)
1,59^22^1,42
"KRN",.404,436,40,1,3)
!M
"KRN",.404,436,40,1,3.1)
S Y=$$GET^XPAR("USR","PSB PRINTER USER DEFAULT",1,"E")
"KRN",.404,436,40,1,13)
D EN^XPAR("USR","PSB PRINTER USER DEFAULT",1,"`"_X)
"KRN",.404,436,40,2,0)
2^Queue To Run At^3
"KRN",.404,436,40,2,1)
.07
"KRN",.404,436,40,2,2)
2,59^17^2,42
"KRN",.404,436,40,2,3)
NOW
"KRN",.404,436,40,3,0)
3^Instructions: PF1-E Submit   PF1-Q Cancel   PF1-R Refresh   <Ret> Re-Edit^2
"KRN",.404,436,40,3,2)
3,76^1^3,1
"KRN",.404,436,40,3,10)
S DDSBR="1^2^1" ; Return to field 1 block 2
"KRN",.404,436,40,3,20)
F^^1:1
"KRN",.404,437,0)
PSBO BLBZ^53.69
"KRN",.404,437,40,0)
^.4044I^10^10
"KRN",.404,437,40,1,0)
1^Drug Name^3
"KRN",.404,437,40,1,1)
.31
"KRN",.404,437,40,1,2)
2,13^40^2,2
"KRN",.404,437,40,1,4)
0
"KRN",.404,437,40,2,0)
2^Lot #^3
"KRN",.404,437,40,2,1)
.32
"KRN",.404,437,40,2,2)
3,19^25^3,12
"KRN",.404,437,40,3,0)
3^Expiration Date^3
"KRN",.404,437,40,3,1)
.33
"KRN",.404,437,40,3,2)
4,19^11^4,2
"KRN",.404,437,40,4,0)
4^Manufacturer^3
"KRN",.404,437,40,4,1)
.34
"KRN",.404,437,40,4,2)
5,19^10^5,5
"KRN",.404,437,40,4,4)
0
"KRN",.404,437,40,5,0)
5^Quantity^3
"KRN",.404,437,40,5,1)
.35
"KRN",.404,437,40,5,2)
7,19^7^7,9
"KRN",.404,437,40,6,0)
6^Filled By^3
"KRN",.404,437,40,6,1)
.36
"KRN",.404,437,40,6,2)
8,19^5^8,8
"KRN",.404,437,40,6,4)
0
"KRN",.404,437,40,6,12)
I '$D(X) S X="  "
"KRN",.404,437,40,7,0)
7^Checked By^3
"KRN",.404,437,40,7,1)
.37
"KRN",.404,437,40,7,2)
9,19^5^9,7
"KRN",.404,437,40,7,4)
0
"KRN",.404,437,40,7,12)
I '$D(X) S X="  "
"KRN",.404,437,40,8,0)
8^# Labels^3
"KRN",.404,437,40,8,1)
.38
"KRN",.404,437,40,8,2)
10,19^7^10,9
"KRN",.404,437,40,8,3)
1
"KRN",.404,437,40,9,0)
9^Patient Name^3
"KRN",.404,437,40,9,1)
.12
"KRN",.404,437,40,9,2)
11,19^30^11,5
"KRN",.404,437,40,9,10)
S:X="Y" DDSBR="FIELD .39^BLOCK 2^PAGE 1"
"KRN",.404,437,40,9,11)
S DIC(0)="AEMQAI"
"KRN",.404,437,40,9,12)
D REFRESH^DDSUTL
"KRN",.404,437,40,9,14)
I $$GETACT^DGPFAPI(X) S PSBPAT=X
"KRN",.404,437,40,10,0)
10^Dosage^3
"KRN",.404,437,40,10,1)
.39
"KRN",.404,437,40,10,2)
12,19^22^12,11
"KRN",19,11605,-1)
2^2
"KRN",19,11605,0)
PSB PHARMACY^Medication Administration Menu Pharmacy^^M^11874^^^^^^^536
"KRN",19,11605,10,0)
^19.01IP^10^10
"KRN",19,11605,10,10,0)
13130^10
"KRN",19,11605,10,10,"^")
PSBO BZ
"KRN",19,11605,"U")
MEDICATION ADMINISTRATION MENU
"KRN",19,13130,-1)
0^1
"KRN",19,13130,0)
PSBO BZ^Barcode Label Print^^R^^^^^^^^BAR CODE MED ADMIN
"KRN",19,13130,25)
XQ^PSBO("BZ")
"KRN",19,13130,"U")
BARCODE LABEL PRINT
"MBREQ")
0
"ORD",8,.403)
.403;8;;;EDEOUT^DIFROMSO(.403,DA,"",XPDA);FPRE^DIFROMSI(.403,"",XPDA);EPRE^DIFROMSI(.403,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.403,DA,"",XPDA);DEL^DIFROMSK(.403,"",%)
"ORD",8,.403,0)
FORM
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",536,-1)
1^1
"PKG",536,0)
BAR CODE MED ADMIN^PSB^BAR CODE MEDICATION ADMINISTRATION
"PKG",536,20,0)
^9.402P^^
"PKG",536,22,0)
^9.49I^1^1
"PKG",536,22,1,0)
3.0^3040224^3040819^11874
"PKG",536,22,1,"PAH",1,0)
2^3080115^11885
"PKG",536,22,1,"PAH",1,1,0)
^^4^4^3080115
"PKG",536,22,1,"PAH",1,1,1,0)
This patch will add the new Barcode Label Print [PSBO BZ] option 
"PKG",536,22,1,"PAH",1,1,2,0)
to the Bar Code Medication Administration application.  Review 
"PKG",536,22,1,"PAH",1,1,3,0)
the patch description for detail functionality. 
"PKG",536,22,1,"PAH",1,1,4,0)

"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","PSBO")
0^8^B64714477^B64481776
"RTN","PSBO",1,0)
PSBO ;BIRMINGHAM/EFC-BCMA OUTPUTS ;Mar 2004
"RTN","PSBO",2,0)
 ;;3.0;BAR CODE MED ADMIN;**13,32,2**;Mar 2004;Build 22
"RTN","PSBO",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBO",4,0)
 ; Reference/IA
"RTN","PSBO",5,0)
 ; ^DPT(/10035
"RTN","PSBO",6,0)
 ; WARD^NURSUT5/3052
"RTN","PSBO",7,0)
 ; EN^PSJBCMA/2828
"RTN","PSBO",8,0)
 ; ^ORD(101.24/3429
"RTN","PSBO",9,0)
 ; ^PSDRUG(/221
"RTN","PSBO",10,0)
RPC(RESULTS,PSBTYPE,PSBDFN,PSBSTRT,PSBSTOP,PSBINCL,PSBDEV,PSBSORT,PSBOI,PSBWLOC,PSBWSORT,PSBFUTR,PSBORDNM,PSBRCRI,PSBLIST) ;
"RTN","PSBO",11,0)
 ;
"RTN","PSBO",12,0)
 ; RPC: PSB REPORT
"RTN","PSBO",13,0)
 ;
"RTN","PSBO",14,0)
 ; Description:
"RTN","PSBO",15,0)
 ; Used by the client to create individual patient extracts of
"RTN","PSBO",16,0)
 ; CHUI report options to display on the client.
"RTN","PSBO",17,0)
 ;
"RTN","PSBO",18,0)
 S RESULTS=$NAME(^TMP("PSBO",$J))
"RTN","PSBO",19,0)
 N PSBIENS,PSBRPT,PSBFDA,DIC,PSBANS
"RTN","PSBO",20,0)
 K ^TMP("PSBO",$J) S ^TMP("PSBO",$J,1)="-1^"
"RTN","PSBO",21,0)
 S DFN=PSBDFN
"RTN","PSBO",22,0)
 D NEW^PSBO1(.PSBRPT,PSBTYPE)
"RTN","PSBO",23,0)
 I +PSBRPT(0)<1 S ^TMP("PSBO",$J,1)="-1^Error: "_$P(PSBRPT(0),U,2) Q
"RTN","PSBO",24,0)
 S PSBIENS=+PSBRPT(0)_","
"RTN","PSBO",25,0)
 S PSBSTRT(0)=$E($P(PSBSTRT,".",2)_"0000",1,4),PSBSTRT=PSBSTRT\1
"RTN","PSBO",26,0)
 S PSBSTOP(0)=$E($P(PSBSTOP,".",2)_"0000",1,4),PSBSTOP=PSBSTOP\1
"RTN","PSBO",27,0)
 D:$G(PSBDEV)]""
"RTN","PSBO",28,0)
 .D NOW^%DTC
"RTN","PSBO",29,0)
 .I $P(PSBDEV,U,2)="" D VAL^DIE(53.69,PSBIENS,.06,"F",PSBDEV,"PSBRET","PSBFDA")
"RTN","PSBO",30,0)
 .I $P(PSBDEV,U,2)'="" D VAL^DIE(53.69,PSBIENS,.06,"F","`"_$P(PSBDEV,U,2),"PSBRET","PSBFDA")
"RTN","PSBO",31,0)
 .D VAL^DIE(53.69,PSBIENS,.07,"F",$S($P(PSBRCRI,U)="QD":$P(PSBRCRI,U,2),1:%),"PSBRET","PSBFDA")
"RTN","PSBO",32,0)
 D:$G(PSBOI)]"" VAL^DIE(53.69,PSBIENS,.09,"F",PSBOI,"PSBRET","PSBFDA")
"RTN","PSBO",33,0)
 S:($G(PSBSORT)']"")&(PSBTYPE'="XA") PSBSORT="P" D VAL^DIE(53.69,PSBIENS,.11,"F",PSBSORT,"PSBRET","PSBFDA")
"RTN","PSBO",34,0)
 D VAL^DIE(53.69,PSBIENS,.12,"F","`"_PSBDFN,"PSBRET","PSBFDA")
"RTN","PSBO",35,0)
 I $G(PSBWLOC)]"" S PSBFDA(53.69,PSBIENS,.13)=PSBWLOC
"RTN","PSBO",36,0)
 D:$G(PSBWSORT)]"" VAL^DIE(53.69,PSBIENS,.15,"F",PSBWSORT,"PSBRET","PSBFDA")
"RTN","PSBO",37,0)
 D VAL^DIE(53.69,PSBIENS,.16,"F",PSBSTRT,"PSBRET","PSBFDA")
"RTN","PSBO",38,0)
 D VAL^DIE(53.69,PSBIENS,.17,"F",PSBSTRT(0),"PSBRET","PSBFDA")
"RTN","PSBO",39,0)
 D VAL^DIE(53.69,PSBIENS,.18,"F",PSBSTOP,"PSBRET","PSBFDA")
"RTN","PSBO",40,0)
 D VAL^DIE(53.69,PSBIENS,.19,"F",PSBSTOP(0),"PSBRET","PSBFDA")
"RTN","PSBO",41,0)
 D:$G(PSBINCL)]""
"RTN","PSBO",42,0)
 .D VAL^DIE(53.69,PSBIENS,.21,"F",+$P(PSBINCL,"^",1),"PSBRET","PSBFDA")
"RTN","PSBO",43,0)
 .D VAL^DIE(53.69,PSBIENS,.22,"F",+$P(PSBINCL,"^",2),"PSBRET","PSBFDA")
"RTN","PSBO",44,0)
 .D VAL^DIE(53.69,PSBIENS,.23,"F",+$P(PSBINCL,"^",3),"PSBRET","PSBFDA")
"RTN","PSBO",45,0)
 .D VAL^DIE(53.69,PSBIENS,.24,"F",+$P(PSBINCL,"^",4),"PSBRET","PSBFDA")
"RTN","PSBO",46,0)
 .D VAL^DIE(53.69,PSBIENS,.28,"F",+$P(PSBINCL,"^",5),"PSBRET","PSBFDA")
"RTN","PSBO",47,0)
 .D VAL^DIE(53.69,PSBIENS,.29,"F",+$P(PSBINCL,"^",6),"PSBRET","PSBFDA")
"RTN","PSBO",48,0)
 D:$G(PSBFUTR)]""
"RTN","PSBO",49,0)
 .D VAL^DIE(53.69,PSBIENS,.25,"F",+$P(PSBFUTR,"^",1),"PSBRET","PSBFDA")
"RTN","PSBO",50,0)
 .D VAL^DIE(53.69,PSBIENS,.26,"F",+$P(PSBFUTR,"^",2),"PSBRET","PSBFDA")
"RTN","PSBO",51,0)
 .D VAL^DIE(53.69,PSBIENS,.27,"F",+$P(PSBFUTR,"^",3),"PSBRET","PSBFDA")
"RTN","PSBO",52,0)
 .D VAL^DIE(53.69,PSBIENS,.41,"F",+$P(PSBFUTR,"^",4),"PSBRET","PSBFDA")
"RTN","PSBO",53,0)
 .D VAL^DIE(53.69,PSBIENS,.61,"F",$TR(PSBFUTR,"^ ","~"),"PSBRET","PSBFDA")
"RTN","PSBO",54,0)
 D FILE^DIE("","PSBFDA")
"RTN","PSBO",55,0)
 I $G(PSBLIST(0),"")]"" D LIST^PSBO1(.PSBLIST)
"RTN","PSBO",56,0)
 I $G(PSBDEV)]"" D PRINT^PSBO1 S RESULTS=$NAME(^TMP("PSBO",$J)) Q
"RTN","PSBO",57,0)
 D HFSOPEN^PSBUTL("RPC") I POP S ^TMP("PSBO",$J,1)="ERROR: UNABLE TO ACCESS HFS DIRECTORY "_$$GET^XPAR("DIV","PSB HFS SCRATCH"),^TMP("PSBO",$J,2)="PLEASE CHECK DIRECTORY WRITE PRIVILEDGES." Q
"RTN","PSBO",58,0)
 U IO D DQ(+PSBIENS)
"RTN","PSBO",59,0)
 D HFSCLOSE^PSBUTL("RPC")
"RTN","PSBO",60,0)
 S RESULTS=$NAME(^TMP("PSBO",$J))
"RTN","PSBO",61,0)
 D:$G(PSBDEV)]"" PRINT^PSBO1
"RTN","PSBO",62,0)
 Q
"RTN","PSBO",63,0)
 ;
"RTN","PSBO",64,0)
XQ(PSBTYPE) ; Called via Kernel Menus
"RTN","PSBO",65,0)
 N PSBANS,PSBANS1,PSBRPT,PSBSAVE,DA,DIK,DR,DDSFILE
"RTN","PSBO",66,0)
 D NEW^PSBO1(.PSBRPT,PSBTYPE)
"RTN","PSBO",67,0)
 I +PSBRPT(0)<1 W !,"Error: ",$P(PSBRPT(0),U,2) S DIR(0)="E" D ^DIR Q
"RTN","PSBO",68,0)
 S DA=+PSBRPT(0),DR="[PSBO "_PSBTYPE_"]",DDSFILE=53.69 D ^DDS
"RTN","PSBO",69,0)
 W @IOF
"RTN","PSBO",70,0)
 I 'PSBSAVE W !,"Cancelling Request..." S DIK="^PSB(53.69," D ^DIK W "Cancelled!"
"RTN","PSBO",71,0)
 D:PSBSAVE
"RTN","PSBO",72,0)
 .;Check Drug to Patient Relationship.
"RTN","PSBO",73,0)
 .I (PSBTYPE="BL")!(PSBTYPE="BZ") S PSBANS="" D CHECK  I PSBANS=0!($D(DIRUT)) W !,"Cancelling Request..." S DIK="^PSB(53.69," D ^DIK W "Cancelled!" Q
"RTN","PSBO",74,0)
 .;
"RTN","PSBO",75,0)
 .;Allow "'BROWSER" Device
"RTN","PSBO",76,0)
 .S IOP=$$GET1^DIQ(53.69,DA_",",.06,"I"),PSBSIO=0 I IOP]"" D
"RTN","PSBO",77,0)
 ..S IOP="`"_IOP,%ZIS="N"
"RTN","PSBO",78,0)
 ..D ^%ZIS
"RTN","PSBO",79,0)
 ..I IO=IO(0) S PSBSIO=1
"RTN","PSBO",80,0)
 ..D HOME^%ZIS K IOP
"RTN","PSBO",81,0)
 .I $$GET1^DIQ(53.69,DA_",",.06)["BROWSER"!(PSBSIO=1) S IOP=$$GET1^DIQ(53.69,DA_",",.06)_";132" D ^%ZIS U IO D DQ(DA) D ^%ZISC K IOP Q
"RTN","PSBO",82,0)
 .W @IOF,"Submitting Your Report Request to Taskman..."
"RTN","PSBO",83,0)
 .S ZTIO=$$GET1^DIQ(53.69,DA_",",.06)
"RTN","PSBO",84,0)
 .S ZTDTH=$P(^PSB(53.69,DA,0),U,7)
"RTN","PSBO",85,0)
 .S ZTDESC="BCMA - "_$$GET1^DIQ(53.69,DA_",",.05)
"RTN","PSBO",86,0)
 .S ZTRTN="DQ^PSBO("_DA_")"
"RTN","PSBO",87,0)
 .D ^%ZTLOAD
"RTN","PSBO",88,0)
 .W "Submitted!",!,"Your Task Number Is: ",$G(ZTSK),!
"RTN","PSBO",89,0)
 K ^TMP("PSBO",$J)
"RTN","PSBO",90,0)
 Q
"RTN","PSBO",91,0)
 ;
"RTN","PSBO",92,0)
DQ(PSBRPT) ; Dequeue report from Taskman
"RTN","PSBO",93,0)
 N PSBWRD,PSBDFN
"RTN","PSBO",94,0)
 Q:'$D(^PSB(53.69,PSBRPT,0))  ; No Such Report
"RTN","PSBO",95,0)
 S $P(^PSB(53.69,PSBRPT,0),U,8)=$G(ZTSK,"RPC")
"RTN","PSBO",96,0)
 D:$$SETUP @("EN^PSBO"_$P(PSBRPT(0),U,5))
"RTN","PSBO",97,0)
 K ^TMP("PSBO",$J)
"RTN","PSBO",98,0)
 S ZTREQ="@"
"RTN","PSBO",99,0)
 Q
"RTN","PSBO",100,0)
 ;
"RTN","PSBO",101,0)
IOM() ; Returns good margin or not
"RTN","PSBO",102,0)
 Q:IOM'<132 1
"RTN","PSBO",103,0)
 W !,"**************************************************************"
"RTN","PSBO",104,0)
 W !,"* SORRY, Your selected DEVICE does not print 132 columns.    *"
"RTN","PSBO",105,0)
 W !,"**************************************************************"
"RTN","PSBO",106,0)
 W !
"RTN","PSBO",107,0)
 Q 0
"RTN","PSBO",108,0)
 ;
"RTN","PSBO",109,0)
VAL(PSBFLDS) ; Validate that fields in PSBFLDS are filled in
"RTN","PSBO",110,0)
 N PSB,PSBFLD,PSBMSG,PSBSTOP,PSBST,PSBDAYS S PSBSTRT=""
"RTN","PSBO",111,0)
 F PSB=1:1 Q:$P(PSBFLDS,";",PSB)=""  S PSBFLD=$P(PSBFLDS,";",PSB),PSBFLD(PSBFLD)=$$GET^DDSVAL(53.69,DA,PSBFLD)
"RTN","PSBO",112,0)
 I $D(PSBFLD(.11)) K:$E(PSBFLD(.11))="P" PSBFLD(.13),PSBFLD(.15) K:$E(PSBFLD(.11))="W" PSBFLD(.12)
"RTN","PSBO",113,0)
 S PSB=""  F  S PSB=$O(PSBFLD(PSB)) Q:PSB=""  D:PSBFLD(PSB)=""
"RTN","PSBO",114,0)
 .I '$D(PSBMSG) S PSBMSG(0)="UNABLE TO FILE REQUEST",PSBMSG(1)=" ",PSBMSG(2)="ERROR: MISSING DATA - ALL FIELDS ARE REQUIRED",PSBMSG(3)=" "
"RTN","PSBO",115,0)
 .D FIELD^DID(53.69,PSB,"","TITLE;LABEL","PSB")
"RTN","PSBO",116,0)
 .S Z="  Missing Field: "_$S(PSB("TITLE")]"":PSB("TITLE"),1:PSB("LABEL"))
"RTN","PSBO",117,0)
 .S PSBMSG($O(PSBMSG(""),-1)+1)=Z
"RTN","PSBO",118,0)
 ; Check Times
"RTN","PSBO",119,0)
 D:$G(PSBFLD(.16))
"RTN","PSBO",120,0)
 .S PSBSTRT=PSBFLD(.16)+$G(PSBFLD(.17))
"RTN","PSBO",121,0)
 .D:$P($$GET1^DIQ(53.69,DA_",",.01),U)["MH"
"RTN","PSBO",122,0)
 ..S PSBDAYS=$$GET1^DIQ(101.24,$$FIND1^DIC(101.24,"","X","ORRP BCMA MAH","B")_",",.42)  ;check maxdays
"RTN","PSBO",123,0)
 ..S:PSBDAYS="" PSBDAYS=7
"RTN","PSBO",124,0)
 ..S X=PSBSTRT\1 D H^%DTC S PSBST=%H+PSBDAYS    ;Determine stop date
"RTN","PSBO",125,0)
 .S PSBSTOP=$S($G(PSBFLD(.18)):PSBFLD(.18),1:PSBFLD(.16))+$G(PSBFLD(.19))
"RTN","PSBO",126,0)
 .I PSBSTOP<PSBSTRT S Y=$O(PSBMSG(""),-1)+1,PSBMSG(Y)="  Date: Stop Date/Time is before Start Date/Time"
"RTN","PSBO",127,0)
 .I $P($$GET1^DIQ(53.69,DA_",",.01),U)["MH" S X=PSBSTOP\1 D H^%DTC I %H>PSBST S Y=$O(PSBMSG(""),-1)+1,PSBMSG(Y)="  The date range cannot exceed "_PSBDAYS_" day(s) as defined in the CPRS 'MAXIMUM DAYS BACK' parameter"
"RTN","PSBO",128,0)
 Q:'$D(PSBMSG)  ; All is well
"RTN","PSBO",129,0)
 D MSG^DDSUTL(.PSBMSG)
"RTN","PSBO",130,0)
 S DDSERROR=1
"RTN","PSBO",131,0)
 Q
"RTN","PSBO",132,0)
 ;
"RTN","PSBO",133,0)
SETUP() ; Setup parameters for the report in PSBRPT
"RTN","PSBO",134,0)
 N PSBWRDL,PSBINDX,PSBWRDA
"RTN","PSBO",135,0)
 K ^TMP("PSBO",$J)
"RTN","PSBO",136,0)
 F X=0,.1,.2,.3,.4,1 S PSBRPT(X)=$G(^PSB(53.69,PSBRPT,X))
"RTN","PSBO",137,0)
 I $D(^PSB(53.69,PSBRPT,2)) M PSBRPT(2)=^PSB(53.69,PSBRPT,2)
"RTN","PSBO",138,0)
 I $P(PSBRPT(.1),U,1)="P" S PSBDFN=+$P(PSBRPT(.1),U,2) Q:'PSBDFN  S ^TMP("PSBO",$J,PSBDFN,0)=$P(^DPT(PSBDFN,0),U)_U_$P(^DPT(PSBDFN,0),U,9),^TMP("PSBO",$J,"B",$P(^DPT(PSBDFN,0),U),PSBDFN)=""
"RTN","PSBO",139,0)
 D:$P(PSBRPT(.1),U,1)="W"
"RTN","PSBO",140,0)
 .S PSBWRD=$P(PSBRPT(.1),U,3) Q:'PSBWRD  D WARD^NURSUT5("L^"_PSBWRD,.PSBWRDA)
"RTN","PSBO",141,0)
 .S X="" F  S X=$O(PSBWRDA(PSBWRD,2,X)) Q:X=""   S PSBWRDL=$P(PSBWRDA(PSBWRD,2,X,.01),U,2) D
"RTN","PSBO",142,0)
 ..F PSBDFN=0:0 S PSBDFN=$O(^DPT("CN",PSBWRDL,PSBDFN)) Q:'PSBDFN  D
"RTN","PSBO",143,0)
 ...S ^TMP("PSBO",$J,PSBDFN,0)=$P(^DPT(PSBDFN,0),U)_U_$P(^DPT(PSBDFN,0),U,9)
"RTN","PSBO",144,0)
 ...; Determine Sort or default to Pt Name...
"RTN","PSBO",145,0)
 ...S:$P(PSBRPT(.1),U,5)="P" PSBINDX=$P(^DPT(PSBDFN,0),U)
"RTN","PSBO",146,0)
 ...I $P(PSBRPT(.1),U,5)="B" S PSBINDX=$P($G(^DPT(PSBDFN,.101)),U) S:PSBINDX="" PSBINDX="** NO ROOM BED **"
"RTN","PSBO",147,0)
 ...S:$P(PSBRPT(.1),U,5)="" PSBINDX=$P(^DPT(PSBDFN,0),U)
"RTN","PSBO",148,0)
 ...S:$G(PSBINDX)="" PSBINDX=$P(^DPT(PSBDFN,0),U)
"RTN","PSBO",149,0)
 ...S ^TMP("PSBO",$J,"B",PSBINDX,PSBDFN)=""
"RTN","PSBO",150,0)
 Q 1
"RTN","PSBO",151,0)
 ;
"RTN","PSBO",152,0)
WRAP(X,Y,Z)    ; Quick text wrap
"RTN","PSBO",153,0)
 ;
"RTN","PSBO",154,0)
 ; Input Parameters Description:
"RTN","PSBO",155,0)
 ;  X: Left Column of display [Optional]
"RTN","PSBO",156,0)
 ;  Y: Cols to wrap in [Optional]
"RTN","PSBO",157,0)
 ;  Z: Text to wrap [Optional]
"RTN","PSBO",158,0)
 ;
"RTN","PSBO",159,0)
 N PSB
"RTN","PSBO",160,0)
 F  Q:'$L(Z)  D
"RTN","PSBO",161,0)
 .W:$X>X !
"RTN","PSBO",162,0)
 .W:$X<X ?X
"RTN","PSBO",163,0)
 .I $L(Z)<Y W Z S Z="" Q
"RTN","PSBO",164,0)
 .F PSB=Y:-1:0 Q:$E(Z,PSB)=" "
"RTN","PSBO",165,0)
 .S:PSB<1 PSB=Y
"RTN","PSBO",166,0)
 .W $E(Z,1,PSB)
"RTN","PSBO",167,0)
 .S Z=$E(Z,PSB+1,250)
"RTN","PSBO",168,0)
 Q ""
"RTN","PSBO",169,0)
 ;
"RTN","PSBO",170,0)
CHECK ;Beginning of PSB*1*10
"RTN","PSBO",171,0)
 K ^TMP("PSJ",$J)
"RTN","PSBO",172,0)
 N PSBDFN,PSBBAR,PSBDRUG,PSBFLAG,PSBPNM,PSBNDX,PSBX
"RTN","PSBO",173,0)
 S PSBFLAG="",PSBBAR=$P($P($G(^PSB(53.69,DA,.3)),U,1),"~",2)
"RTN","PSBO",174,0)
 S PSBDRUG=$$GET1^DIQ(53.69,DA_",",.31)
"RTN","PSBO",175,0)
 S PSBDFN=$$GET1^DIQ(53.69,DA_",",.12,"I") S:$G(PSBDFN) PSBFLAG=1
"RTN","PSBO",176,0)
 D EN^PSJBCMA(PSBDFN)
"RTN","PSBO",177,0)
 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:'PSBX  D
"RTN","PSBO",178,0)
 .K Y,PSBORD,PSBPNM,PSBNDX
"RTN","PSBO",179,0)
 .M PSBORD=^TMP("PSJ",$J,PSBX)
"RTN","PSBO",180,0)
 .F PSBNDX=700,850,950  D
"RTN","PSBO",181,0)
 ..F Y=0:0 S Y=$O(PSBORD(PSBNDX,Y)) Q:'Y  D
"RTN","PSBO",182,0)
 ...I $P($G(PSBORD(1)),U,7)'="A" Q
"RTN","PSBO",183,0)
 ...S PSBPNM=$P(PSBORD(PSBNDX,Y,0),U,1)
"RTN","PSBO",184,0)
 ...I PSBNDX=700,PSBPNM=PSBBAR S PSBFLAG=0 Q
"RTN","PSBO",185,0)
 ...I PSBNDX=850,$D(^PSDRUG("A526",PSBBAR,PSBPNM)) S PSBFLAG=0 Q
"RTN","PSBO",186,0)
 ...I PSBNDX=950,$D(^PSDRUG("A527",PSBBAR,PSBPNM)) S PSBFLAG=0
"RTN","PSBO",187,0)
 I PSBFLAG=1 D
"RTN","PSBO",188,0)
 .W !,"Patient is not currently on medication: ",PSBDRUG
"RTN","PSBO",189,0)
 .K DIRUT,DIR
"RTN","PSBO",190,0)
 .S DIR("A")="Do you want to continue"
"RTN","PSBO",191,0)
 .S DIR(0)="Y"
"RTN","PSBO",192,0)
 .D ^DIR
"RTN","PSBO",193,0)
 .S PSBANS=+Y W !
"RTN","PSBO",194,0)
 ; 
"RTN","PSBO1")
0^7^B7582589^B7451298
"RTN","PSBO1",1,0)
PSBO1 ;BIRMINGHAM/EFC-BCMA OUTPUTS ;Mar 2004
"RTN","PSBO1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**4,13,32,2**;Mar 2004;Build 22
"RTN","PSBO1",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBO1",4,0)
 ; Reference/IA
"RTN","PSBO1",5,0)
 ; FILE^DICN/10009
"RTN","PSBO1",6,0)
 ;
"RTN","PSBO1",7,0)
NEW(RESULTS,PSBRTYP) ; Create a new report request
"RTN","PSBO1",8,0)
 ; Called interactively and via RPCBroker
"RTN","PSBO1",9,0)
 K RESULTS
"RTN","PSBO1",10,0)
 ; Check Type
"RTN","PSBO1",11,0)
 I '$F("DL^MD^MH^ML^MM^MV^MT^PE^PM^WA^BL^PI^AL^DO^VT^PF^XA^IV^CM^CP^CE^CI^BZ^",PSBRTYP) S RESULTS(0)="-1^Invalid Report Type" Q
"RTN","PSBO1",12,0)
 I '+$G(DUZ) S RESULTS(0)="-1^Undefined User" Q
"RTN","PSBO1",13,0)
 I '$G(DUZ(2)) S RESULTS(0)="-1^Undefined Division" Q
"RTN","PSBO1",14,0)
 ; Lock Log
"RTN","PSBO1",15,0)
 L +(^PSB(53.69,0)):$S($G(DILOCKTM)>0:DILOCKTM,1:3)
"RTN","PSBO1",16,0)
 E  S RESULTS(0)="-1^Request Log Locked" Q
"RTN","PSBO1",17,0)
 ; Generate Unique Entry and Create
"RTN","PSBO1",18,0)
 F  D NOW^%DTC S X=$E(%_"000000",1,14) S X=(1700+$E(X,1,3))_$E(X,4,14),X=PSBRTYP_"-"_$TR(X,".","-") Q:'$D(^PSB(53.69,"B",X))
"RTN","PSBO1",19,0)
 S DIC="^PSB(53.69,",DIC(0)="L"
"RTN","PSBO1",20,0)
 S DIC("DR")=".02///N;.03////^S X=DUZ;.04////^S X=DUZ(2);.05///^S X=PSBRTYP"
"RTN","PSBO1",21,0)
 K DD,DO D FILE^DICN
"RTN","PSBO1",22,0)
 L -(^PSB(53.69,0))
"RTN","PSBO1",23,0)
 ; Okay, setup return and Boogie
"RTN","PSBO1",24,0)
 I +Y<1 S RESULTS(0)="-1^Error Creating Request"
"RTN","PSBO1",25,0)
 E  S RESULTS(0)=Y
"RTN","PSBO1",26,0)
 Q
"RTN","PSBO1",27,0)
 ;
"RTN","PSBO1",28,0)
PRINT ;
"RTN","PSBO1",29,0)
 N ZTDTH,ZTRTN,ZTSK,ZTDESC,ZTSAVE,DA
"RTN","PSBO1",30,0)
 S DA=+PSBRPT(0)
"RTN","PSBO1",31,0)
 S IOP=$$GET1^DIQ(53.69,DA_",",.06,"I"),PSBSIO=0 I IOP]"" D
"RTN","PSBO1",32,0)
 .S IOP="`"_IOP,%ZIS="N"
"RTN","PSBO1",33,0)
 .D ^%ZIS
"RTN","PSBO1",34,0)
 .I IO=IO(0) S PSBSIO=1
"RTN","PSBO1",35,0)
 .D HOME^%ZIS K IOP
"RTN","PSBO1",36,0)
 I $$GET1^DIQ(53.69,DA_",",.06)["BROWSER"!(PSBSIO=1) S IOP=$$GET1^DIQ(53.69,DA_",",.06)_";132" D ^%ZIS U IO D DQ^PSBO(DA) D ^%ZISC K IOP Q
"RTN","PSBO1",37,0)
 W @IOF,"Submitting Your Report Request to Taskman..."
"RTN","PSBO1",38,0)
 S ZTIO=$$GET1^DIQ(53.69,DA_",",.06)_";132"
"RTN","PSBO1",39,0)
 S ZTDTH=$S($$GET1^DIQ(53.69,DA_",",.07,"I")]"":$$GET1^DIQ(53.69,DA_",",.07,"I"),1:$H)
"RTN","PSBO1",40,0)
 S ZTDESC="BCMA - "_$$GET1^DIQ(53.69,DA_",",.05)
"RTN","PSBO1",41,0)
 S ZTRTN="DQ^PSBO("_DA_")"
"RTN","PSBO1",42,0)
 F I="PSBDFN","PSBTYPE" S ZTSAVE(I)=""
"RTN","PSBO1",43,0)
 I $G(PSBORDNM)]"" S ZTSAVE("PSBORDNM")=""
"RTN","PSBO1",44,0)
 D ^%ZTLOAD
"RTN","PSBO1",45,0)
 I $D(ZTSK) S ^TMP("PSBO",$J,1)="0^Report queued. (Task #"_ZTSK_")"
"RTN","PSBO1",46,0)
 E  S ^TMP("PSBO",$J,1)="-1^Task Rejected."
"RTN","PSBO1",47,0)
 Q
"RTN","PSBO1",48,0)
 ;
"RTN","PSBO1",49,0)
LIST(XLIST) ;  Place List Criteria into subfile #53.692 (multiple)
"RTN","PSBO1",50,0)
 F XL1=$O(XLIST("")):1:$O(XLIST("B"),-1)  Q:+XL1=""  D
"RTN","PSBO1",51,0)
 .I $P(XLIST(XL1),U)=PSBTYPE D
"RTN","PSBO1",52,0)
 ..K PSBFDA,PSBRET,PSBIENX D CLEAN^DILF
"RTN","PSBO1",53,0)
 ..S PSBIENX="+"_(XL1+1)_","_PSBIENS
"RTN","PSBO1",54,0)
 ..D VAL^DIE(53.692,"+"_(XL1+1)_","_PSBIENS,.01,"F",$TR(XLIST(XL1),"^","~"),"PSBRET","PSBFDA")
"RTN","PSBO1",55,0)
 ..D UPDATE^DIE("","PSBFDA","PSBIENX","PSBRET")
"RTN","PSBO1",56,0)
 Q
"RTN","PSBO1",57,0)
 ;
"RTN","PSBOBLU")
0^2^B32444120^n/a
"RTN","PSBOBLU",1,0)
PSBOBLU ;BIRMINGHAM/TTH-BUILD CONTROL CODES ;Mar 2004
"RTN","PSBOBLU",2,0)
 ;;3.0;BAR CODE MED ADMIN;**2**;Mar 2004;Build 22
"RTN","PSBOBLU",3,0)
 ;;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOBLU",4,0)
 ;
"RTN","PSBOBLU",5,0)
 ; Reference/IA
"RTN","PSBOBLU",6,0)
 ; ^%ZIS(2/3435
"RTN","PSBOBLU",7,0)
 ; ^%ZIS(2/3884
"RTN","PSBOBLU",8,0)
 ;
"RTN","PSBOBLU",9,0)
 N AB,ANS,CODE,NAME,PSBCHO,PSBCODE,PSBTYPE,X,Y
"RTN","PSBOBLU",10,0)
 ;
"RTN","PSBOBLU",11,0)
 W !,"                        ***Important Note***"
"RTN","PSBOBLU",12,0)
 W !,"Before you execute the automatic control code update function, create a ",!,"new terminal type entry in your TERMINAL TYPE file (#3.2) to store the "
"RTN","PSBOBLU",13,0)
 W !,"new barcode printer control codes.  The new terminal type entry needs to ",!,"be connected to the barcode printer device by inserting the new terminal "
"RTN","PSBOBLU",14,0)
 W !,"type entry name into the SUBTYPE field (#3) for the barcode printer entry ",!,"in your DEVICE file (#3.5). ",!
"RTN","PSBOBLU",15,0)
 W !,"This option will allow you to automatically copy the BCMA pre-formatted",!,"control codes for the Zebra barcode printer or Intermec barcode printer"
"RTN","PSBOBLU",16,0)
 W !,"to a device. Please select the appropriate BCMA pre-formatted control",!,"codes and then select the appropriate device.",!
"RTN","PSBOBLU",17,0)
 ;
"RTN","PSBOBLU",18,0)
 K DIR,DA,PSBCHO
"RTN","PSBOBLU",19,0)
 S DIR(0)="SX^1:Zebra Control Codes;2:Intermec Control Codes"
"RTN","PSBOBLU",20,0)
 S DIR("A")="Select 1 or 2"
"RTN","PSBOBLU",21,0)
 D ^DIR  S PSBCHO=Y
"RTN","PSBOBLU",22,0)
 I $G(DIRUT) D END Q
"RTN","PSBOBLU",23,0)
 I PSBCHO["^" D END Q
"RTN","PSBOBLU",24,0)
 ;
"RTN","PSBOBLU",25,0)
 D IO
"RTN","PSBOBLU",26,0)
 ;
"RTN","PSBOBLU",27,0)
END ;Clean Up Routine Variables
"RTN","PSBOBLU",28,0)
 K %ZIS,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT,POP,X,Y
"RTN","PSBOBLU",29,0)
 Q
"RTN","PSBOBLU",30,0)
 ;       
"RTN","PSBOBLU",31,0)
 ;Select Device  ;
"RTN","PSBOBLU",32,0)
IO S %ZIS("B")="" D ^%ZIS  Q:POP
"RTN","PSBOBLU",33,0)
 Q:$G(DIRUT)
"RTN","PSBOBLU",34,0)
 ;
"RTN","PSBOBLU",35,0)
 ;Check system
"RTN","PSBOBLU",36,0)
 W !!,"Checking system status....",!
"RTN","PSBOBLU",37,0)
 I '$G(IOST(0)) W "No Terminal Type available." Q
"RTN","PSBOBLU",38,0)
 I '$D(DUZ(0)) W "No DUZ defined." Q
"RTN","PSBOBLU",39,0)
 I DUZ(0)'="@" W "FileMan access must be @." Q
"RTN","PSBOBLU",40,0)
 ;
"RTN","PSBOBLU",41,0)
 ;Check for existing control entry in Terminal Type file.
"RTN","PSBOBLU",42,0)
 I $D(^%ZIS(2,IOST(0),55,"B","SB")) W !!,"***Warning*** BCMA CONTROL CODES already defined for this device.",!
"RTN","PSBOBLU",43,0)
 W !,"Are you sure that you want to copy the ",!,"BCMA CONTROL CODES to device: ",ION,!
"RTN","PSBOBLU",44,0)
 ;
"RTN","PSBOBLU",45,0)
WHAT ; Yes to continue No to Quit        
"RTN","PSBOBLU",46,0)
 K DIR,ANS
"RTN","PSBOBLU",47,0)
 S DIR(0)="Y^O",DIR("B")="NO",DIR("T")=20
"RTN","PSBOBLU",48,0)
 D ^DIR  S ANS=Y
"RTN","PSBOBLU",49,0)
 Q:ANS["^"
"RTN","PSBOBLU",50,0)
 Q:ANS'=1
"RTN","PSBOBLU",51,0)
 W "     Copying Control Codes...",!
"RTN","PSBOBLU",52,0)
 ;
"RTN","PSBOBLU",53,0)
 I PSBCHO=1 D ZEBCC
"RTN","PSBOBLU",54,0)
 I PSBCHO=2 D INTMECC
"RTN","PSBOBLU",55,0)
 W !,"Done..."
"RTN","PSBOBLU",56,0)
 Q
"RTN","PSBOBLU",57,0)
 ;
"RTN","PSBOBLU",58,0)
ZEBCC ;Zebral Barcode Printer Character Control Code auto install
"RTN","PSBOBLU",59,0)
 ; Use $SELECT function to set proper barcode printer control code variable "CODE"
"RTN","PSBOBLU",60,0)
 ;
"RTN","PSBOBLU",61,0)
 I '$D(^%ZIS(2,IOST(0),55,"B","SL")) S AB="SL",NAME="Start Label",CODE="W !,""^XA"",!,""^LH0,0^FS""" D FILE
"RTN","PSBOBLU",62,0)
 I '$D(^%ZIS(2,IOST(0),55,"B","EL")) S AB="EL",NAME="End Label",CODE="W !,""^XZ""" D FILE
"RTN","PSBOBLU",63,0)
 I '$D(^%ZIS(2,IOST(0),55,"B","ST")) S AB="ST",NAME="Start Text",CODE="W !,""^FO""_PSBTYPE_""^A0N,30,20^CI13^FR^FD""_TEXT_""^FS""" D FILE
"RTN","PSBOBLU",64,0)
 I '$D(^%ZIS(2,IOST(0),55,"B","SB")) S AB="SB",NAME="Start Barcode" D  D FILE
"RTN","PSBOBLU",65,0)
 .S CODE="S PSBTYPE=$S(PSBSYM=""I25"":""B2N"",PSBSYM=""128"":""BCN"",1:""B3N"")"
"RTN","PSBOBLU",66,0)
 .S CODE=CODE_"  S:PSBSYM="""" PSBBAR=""NO-CODE""  W !,""^BY2,3.0,80^FO20,100^""_PSBTYPE_"",N,80,Y,N^FR^FD""_PSBBAR_""^FS"""
"RTN","PSBOBLU",67,0)
 I '$D(^%ZIS(2,IOST(0),55,"B","STF")) S AB="STF",NAME="Start Text Field" D  D FILE
"RTN","PSBOBLU",68,0)
 .S CODE="S PSBTYPE=$S(PSBTLE=""PSBDRUG"":""20,25"",PSBTLE=""PSBDOSE"":""20,60"",PSBTLE=""PSBNAME"":""350,60"",PSBTLE=""PSBWARD"":""350,90"",PSBTLE=""PSBLOT"":""350,120"","
"RTN","PSBOBLU",69,0)
 .S CODE=CODE_"PSBTLE=""PSBEXP"":""350,150"",PSBTLE=""PSBMFG"":""500,150"",PSBTLE=""PSBFCB"":""350,180"",1:""0,0"")"
"RTN","PSBOBLU",70,0)
 Q
"RTN","PSBOBLU",71,0)
 ;
"RTN","PSBOBLU",72,0)
INTMECC ;Intermec Barcode Printer Character Control Code auto install
"RTN","PSBOBLU",73,0)
 I '$D(^%ZIS(2,IOST(0),55,"B","SL")) S AB="SL",NAME="Start Label",CODE="W ""<STX>R;<EXT>"",!,""<STX><ESC>E2<EXT>"",!"  D FILE
"RTN","PSBOBLU",74,0)
 I '$D(^%ZIS(2,IOST(0),55,"B","EL")) S AB="EL",NAME="End Label",CODE="W ""<STX><ETB><ETX>"",!"  D FILE
"RTN","PSBOBLU",75,0)
 I '$D(^%ZIS(2,IOST(0),55,"B","SB")) S AB="SB",NAME="Start Barcode",CODE="W ""<STX>""_TEXT_""<ETX>"",!"  D FILE
"RTN","PSBOBLU",76,0)
 I '$D(^%ZIS(2,IOST(0),55,"B","ST")) S AB="ST",NAME="Start Text",CODE="W ""<STX>""_TEXT_""<CR><ETX>"",!"  D FILE
"RTN","PSBOBLU",77,0)
 I '$D(^%ZIS(2,IOST(0),55,"B","EBF")) S AB="EBF",NAME="End Barcode",CODE="W ""<STX>H8;o50,40;f3;c0;h1;w1;d0,80;<ETX>"",!"  D FILE
"RTN","PSBOBLU",78,0)
 I '$D(^%ZIS(2,IOST(0),55,"B","FI")) S AB="FI",NAME="Format Initialization",CODE="W ""<STX><ESC>C<ETX>"",!,""<STX><ESC>P<ETX>"",!,""<STX>E2;F2<ESC><ETX>"",!"  D FILE
"RTN","PSBOBLU",79,0)
 ;
"RTN","PSBOBLU",80,0)
 I '$D(^%ZIS(2,IOST(0),55,"B","SBF")) S AB="SBF",NAME="Start Barcode Field" D  D FILE
"RTN","PSBOBLU",81,0)
 .S CODE="S PSBTYPE=$S(PSBSYM=""I25"":""c2,0"",PSBSYM=""128"":""c6,0"",1:""c0,0"")"
"RTN","PSBOBLU",82,0)
 .S CODE=CODE_" W ""<STX>B8;o85,40;f3;""_PSBTYPE_"";h50;w1;i1;do,25;p@;<ETX>"",!,""<STX>I8;h1;w1;<ETX>"",!"
"RTN","PSBOBLU",83,0)
 ;
"RTN","PSBOBLU",84,0)
 I '$D(^%ZIS(2,IOST(0),55,"B","FI1")) S AB="FI1",NAME="Format Initialization 1" D  D FILE
"RTN","PSBOBLU",85,0)
 .S CODE="W ""<STX>H7;o30,260;f3;c0;h1;w1;d0,80;<ETX>"",!,""<STX>H6;o50,440;f3;c0;h1;w1;d0,20;<ETX>"",!,"
"RTN","PSBOBLU",86,0)
 .S CODE=CODE_"""<STX>H5;o50,260;f3;c0;h1;w1;d0,20;<ETX>"",!,""<STX>H4;o70,260;f3;c0;h1;w1;d0,35;<ETX>"",!"
"RTN","PSBOBLU",87,0)
 ;
"RTN","PSBOBLU",88,0)
 I '$D(^%ZIS(2,IOST(0),55,"B","FI2")) S AB="FI2",NAME="Format Initialization 2" D  D FILE
"RTN","PSBOBLU",89,0)
 .S CODE="W ""<STX>H3;o90,260;f3;c0;h1;w1;d0,35;<ETX>"",!,""<STX>H2;o110,260;f3;c0;h1;w1;d0,35;<ETX>"",!,"
"RTN","PSBOBLU",90,0)
 .S CODE=CODE_"""<STX>H1;o110,40;f3;c0;h1;w1;d0,27;<ETX>"",!,""<STX>H0;o130,40;f3;c0;h1;w1;d0,60;<ETX>"",!"
"RTN","PSBOBLU",91,0)
 Q
"RTN","PSBOBLU",92,0)
 ;
"RTN","PSBOBLU",93,0)
FILE ;Set local array for Intermec Barcode Printer Default Settings
"RTN","PSBOBLU",94,0)
 ;
"RTN","PSBOBLU",95,0)
 K DD,DIC,DIE,DO
"RTN","PSBOBLU",96,0)
 S DIC(0)="L",DA(1)=IOST(0),X=AB,DIC="^%ZIS(2,"_DA(1)_",55," D FILE^DICN  K DD,DO
"RTN","PSBOBLU",97,0)
 S DIE=DIC,DA=+Y,DA(1)=IOST(0)
"RTN","PSBOBLU",98,0)
 S DR=".01////"_AB_";1////"_NAME_";2////^S X=CODE" D ^DIE
"RTN","PSBOBLU",99,0)
 Q
"RTN","PSBOBZ")
0^5^B18129776^n/a
"RTN","PSBOBZ",1,0)
PSBOBZ ;BIRMINGHAM/TTH-BAR CODE LABELS (MAIN) ;Mar 2004
"RTN","PSBOBZ",2,0)
 ;;3.0;BAR CODE MED ADMIN;**2**;Mar 2004;Build 22
"RTN","PSBOBZ",3,0)
 ;;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOBZ",4,0)
 ;
"RTN","PSBOBZ",5,0)
 ; Reference/IA
"RTN","PSBOBZ",6,0)
 ; ^%ZIS(2/3435
"RTN","PSBOBZ",7,0)
 ; File 50/221
"RTN","PSBOBZ",8,0)
 ;
"RTN","PSBOBZ",9,0)
EN ;
"RTN","PSBOBZ",10,0)
 N PSBI,PSBIENS,PSBQTY,PSBDOSE,PSBDRUG,PSBNAME,PSBNODE3,PSBWARD,PSBLOT,PSBBAR,PSBTLE,SL
"RTN","PSBOBZ",11,0)
 N PSBEXP,PSBFD,PSBMFG,PSBCB,PSBFB,PSBFCB,PSBCNT,PSBANS,PSBORD,PSBPRE,PSBX,PSBY,PSBSYM,TEXT
"RTN","PSBOBZ",12,0)
 ;
"RTN","PSBOBZ",13,0)
 N PSBXX,PSBYY,PSBCODE
"RTN","PSBOBZ",14,0)
 S PSBXX=0 F  S PSBXX=$O(^%ZIS(2,IOST(0),55,PSBXX)) Q:'PSBXX  S PSBYY=$G(^(PSBXX,0)) I PSBYY]"" S PSBX=$P(PSBYY,"^"),PSBY=^(1),PSBCODE(PSBX)=PSBY
"RTN","PSBOBZ",15,0)
 ;
"RTN","PSBOBZ",16,0)
 ;The PSBRPT variable and PSBRPT(.3) array are set in the PSBO routine.  It is the internal
"RTN","PSBOBZ",17,0)
 ;entry number from the BCMA REPORT REQUEST file (#53.69). This entry is created
"RTN","PSBOBZ",18,0)
 ;when the user submits the completed ScreenMan form from the Label Print option.
"RTN","PSBOBZ",19,0)
 ;
"RTN","PSBOBZ",20,0)
 ;
"RTN","PSBOBZ",21,0)
 S PSBIENS=PSBRPT_","
"RTN","PSBOBZ",22,0)
 S PSBBAR=$P($P($G(PSBRPT(.3)),U,1),"~",2)
"RTN","PSBOBZ",23,0)
 S PSBPRE=$$GET^XPAR("DIV","PSB DEFAULT BARCODE PREFIX")
"RTN","PSBOBZ",24,0)
 S:PSBPRE]"" PSBBAR=PSBPRE_$S(PSBPRE?1.N:"-",1:"")_PSBBAR
"RTN","PSBOBZ",25,0)
 S PSBDRUG=$P($P($G(PSBRPT(.3)),U,1),"~",1)
"RTN","PSBOBZ",26,0)
 S PSBQTY=+$P($G(PSBRPT(.3)),U,5)
"RTN","PSBOBZ",27,0)
 S:PSBQTY PSBDRUG=PSBDRUG_" (Qty: "_PSBQTY_")"
"RTN","PSBOBZ",28,0)
 I PSBQTY=0 S PSBDRUG=PSBDRUG_" (Qty:      )"
"RTN","PSBOBZ",29,0)
 S PSBDOSE=$P($G(PSBRPT(.3)),U,9)
"RTN","PSBOBZ",30,0)
 I PSBDOSE]"" S PSBDOSE="Dose:"_PSBDOSE
"RTN","PSBOBZ",31,0)
 I PSBDOSE="" S PSBDOSE="Dose:"
"RTN","PSBOBZ",32,0)
 S PSBNAME=$$GET1^DIQ(53.69,PSBIENS,.12)
"RTN","PSBOBZ",33,0)
 I PSBNAME]"" S PSBNAME=PSBNAME_" ("_$E($$GET1^DIQ(53.69,PSBIENS,.121),6,9)_")"
"RTN","PSBOBZ",34,0)
 I PSBNAME="" S PSBNAME="Patient:"
"RTN","PSBOBZ",35,0)
 S PSBWARD=$$GET1^DIQ(53.69,PSBIENS,.122)
"RTN","PSBOBZ",36,0)
 I PSBWARD]"" S PSBWARD="Ward: "_PSBWARD
"RTN","PSBOBZ",37,0)
 I PSBWARD="" S PSBWARD="Ward: "
"RTN","PSBOBZ",38,0)
 S PSBLOT=$P($G(PSBRPT(.3)),U,2)
"RTN","PSBOBZ",39,0)
 I PSBLOT]"" S PSBLOT="Lot: "_PSBLOT
"RTN","PSBOBZ",40,0)
 I PSBLOT="" S PSBLOT="Lot: "
"RTN","PSBOBZ",41,0)
 S PSBFD=$P($G(PSBRPT(.3)),U,3)
"RTN","PSBOBZ",42,0)
 S PSBEXP=$$FMTE^XLFDT(PSBFD,5)
"RTN","PSBOBZ",43,0)
 I PSBEXP]"" S PSBEXP="Exp: "_PSBEXP
"RTN","PSBOBZ",44,0)
 I PSBEXP="" S PSBEXP="Exp: "
"RTN","PSBOBZ",45,0)
 S PSBMFG=$P($G(PSBRPT(.3)),U,4)
"RTN","PSBOBZ",46,0)
 I PSBMFG]"" S PSBMFG="Mfg: "_PSBMFG
"RTN","PSBOBZ",47,0)
 I PSBMFG="" S PSBMFG="Mfg: "
"RTN","PSBOBZ",48,0)
 S PSBFB=$P($G(PSBRPT(.3)),U,6) I PSBFB="" S PSBFB="_____"
"RTN","PSBOBZ",49,0)
 S PSBCB=$P($G(PSBRPT(.3)),U,7) I PSBCB="" S PSBCB="_____"
"RTN","PSBOBZ",50,0)
 S PSBFCB=PSBFB_"/"_PSBCB
"RTN","PSBOBZ",51,0)
 F PSBCNT=1:1:+$P(PSBRPT(.3),U,8) D LABEL
"RTN","PSBOBZ",52,0)
 Q
"RTN","PSBOBZ",53,0)
 ;
"RTN","PSBOBZ",54,0)
LABEL ;Get Barcode Label Type
"RTN","PSBOBZ",55,0)
 ;Barcode Type
"RTN","PSBOBZ",56,0)
 S PSBSYM=$$GET^XPAR("DIV","PSB DEFAULT BARCODE FORMAT",,"E")
"RTN","PSBOBZ",57,0)
 ;
"RTN","PSBOBZ",58,0)
INIT ;Initialize barcode printer
"RTN","PSBOBZ",59,0)
 I $D(PSBCODE("FI")) X PSBCODE("FI")
"RTN","PSBOBZ",60,0)
 I $D(PSBCODE("FI1")) X PSBCODE("FI1")
"RTN","PSBOBZ",61,0)
 I $D(PSBCODE("FI2")) X PSBCODE("FI2")
"RTN","PSBOBZ",62,0)
 ;
"RTN","PSBOBZ",63,0)
 ;Additional format settings
"RTN","PSBOBZ",64,0)
 I PSBSYM]"",$D(PSBCODE("SBF")) X PSBCODE("SBF")
"RTN","PSBOBZ",65,0)
 I PSBSYM="",$D(PSBCODE("EBF")) X PSBCODE("EBF")
"RTN","PSBOBZ",66,0)
 ;
"RTN","PSBOBZ",67,0)
 D START ;execute control codes to start label
"RTN","PSBOBZ",68,0)
 D PRINT ;execute control codes to print label
"RTN","PSBOBZ",69,0)
 ;
"RTN","PSBOBZ",70,0)
 ;Print Barcode Strip
"RTN","PSBOBZ",71,0)
 ;If barcode type is defined.
"RTN","PSBOBZ",72,0)
 I PSBSYM]"",$D(PSBCODE("SB")) S TEXT=PSBBAR X PSBCODE("SB")
"RTN","PSBOBZ",73,0)
 ;If barcode type is not define.
"RTN","PSBOBZ",74,0)
 I PSBSYM="",$D(PSBCODE("SB")) S TEXT="*NO BARCODE TYPE*" X PSBCODE("SB")
"RTN","PSBOBZ",75,0)
 ;
"RTN","PSBOBZ",76,0)
END ; Close Label or End of Label
"RTN","PSBOBZ",77,0)
 I $G(PSBCODE("EL"))]"" X PSBCODE("EL")
"RTN","PSBOBZ",78,0)
 H 2
"RTN","PSBOBZ",79,0)
 Q
"RTN","PSBOBZ",80,0)
 ;
"RTN","PSBOBZ",81,0)
START ;Start Label Print Process
"RTN","PSBOBZ",82,0)
 I $G(PSBCODE("SL"))]"" X PSBCODE("SL")
"RTN","PSBOBZ",83,0)
 Q
"RTN","PSBOBZ",84,0)
 ;
"RTN","PSBOBZ",85,0)
PRINT ;Print barcode label
"RTN","PSBOBZ",86,0)
 ;
"RTN","PSBOBZ",87,0)
 I PSBDRUG]"" S PSBTLE="PSBDRUG",TEXT="Drug: "_PSBDRUG  D PROCESS
"RTN","PSBOBZ",88,0)
 I PSBDOSE]"" S PSBTLE="PSBDOSE",TEXT=PSBDOSE D PROCESS
"RTN","PSBOBZ",89,0)
 I PSBNAME]"" S PSBTLE="PSBNAME",TEXT=PSBNAME  D PROCESS
"RTN","PSBOBZ",90,0)
 I PSBWARD]"" S PSBTLE="PSBWARD",TEXT=PSBWARD  D PROCESS
"RTN","PSBOBZ",91,0)
 I PSBLOT]"" S PSBTLE="PSBLOT",TEXT=PSBLOT  D PROCESS
"RTN","PSBOBZ",92,0)
 I PSBEXP]"" S PSBTLE="PSBEXP",TEXT=PSBEXP  D PROCESS
"RTN","PSBOBZ",93,0)
 I PSBMFG]"" S PSBTLE="PSBMFG",TEXT=PSBMFG  D PROCESS
"RTN","PSBOBZ",94,0)
 I PSBFCB]"" S PSBTLE="PSBFCB",TEXT="Filled/Checked By: "_PSBFCB  D PROCESS
"RTN","PSBOBZ",95,0)
 Q
"RTN","PSBOBZ",96,0)
 ;
"RTN","PSBOBZ",97,0)
PROCESS ;Process control code and field data.
"RTN","PSBOBZ",98,0)
 I $D(PSBCODE("STF")) X PSBCODE("STF")
"RTN","PSBOBZ",99,0)
 I $D(PSBCODE("ST")) X PSBCODE("ST")
"RTN","PSBOBZ",100,0)
 Q
"RTN","PSBOBZ",101,0)
 ;
"RTN","PSBOBZ",102,0)
INPTR ;Input transform for DRUG field (#.31) in file 53.69.
"RTN","PSBOBZ",103,0)
 N PSBIAD,PSBDEA,D,Y
"RTN","PSBOBZ",104,0)
 K:$L(X)>40!($L(X)<1) X  I $D(X) D
"RTN","PSBOBZ",105,0)
 .S X=$TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","PSBOBZ",106,0)
 .N DIC S DIC="^PSDRUG(",DIC(0)="EQNM",D="B^C^VAPN^VAC^NDC^XATC"
"RTN","PSBOBZ",107,0)
 .S DIC("S")="I (($P($G(^PSDRUG(+Y,2)),U,3)[""I"")!($P($G(^(2)),U,3)[""U"")),(('$G(^PSDRUG(+Y,""I"")))!(DT'>$G(^(""I""))))"
"RTN","PSBOBZ",108,0)
 .D:+X'>0 MIX^DIC1
"RTN","PSBOBZ",109,0)
 .D:+X>0 ^DIC
"RTN","PSBOBZ",110,0)
 .S:+Y>0 X=$$GET1^DIQ(50,+Y_",",.01)_"~"_+Y K:+Y<1 X
"RTN","PSBOBZ",111,0)
 Q
"RTN","PSBPOIV")
0^3^B63509685^B63173944
"RTN","PSBPOIV",1,0)
PSBPOIV ;BIRMINGHAM/EFC-IV PARAMETER VALIDATION ;Mar 2004
"RTN","PSBPOIV",2,0)
 ;;3.0;BAR CODE MED ADMIN;**2**;Mar 2004;Build 22
"RTN","PSBPOIV",3,0)
 ;;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBPOIV",4,0)
 ;
"RTN","PSBPOIV",5,0)
 ; Reference/IA
"RTN","PSBPOIV",6,0)
 ; ^DIC(42/2440
"RTN","PSBPOIV",7,0)
 ; EN^PSJBCMA2/2830
"RTN","PSBPOIV",8,0)
 ; VADPT/10061
"RTN","PSBPOIV",9,0)
 ;
"RTN","PSBPOIV",10,0)
 ;
"RTN","PSBPOIV",11,0)
EN(PSBDFN,PSBORD) ;
"RTN","PSBPOIV",12,0)
 ;
"RTN","PSBPOIV",13,0)
 S DFN=PSBDFN,(PSBMI,PSBMW,PSBMWC,PSBMAUD)=0,(PSBMIDT,PSBMIM)="",PSBONXS=PSBORD_"^"
"RTN","PSBPOIV",14,0)
 K ^TMP("PSBAR",$J) S ^TMP("PSBAR",$J,"W",0)=0
"RTN","PSBPOIV",15,0)
 D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBORD)
"RTN","PSBPOIV",16,0)
 ; get IV parameters for the current ward
"RTN","PSBPOIV",17,0)
 S PSBCSTR="^ADDITIVE^STRENGTH^BOTTLE^SOLUTION^VOLUME^INFUSION RATE^MED ROUTE^SCHEDULE^ADMIN TIME^REMARKS^OTHER PRINT INFO^PROVIDER^START DATE/TIME^STOP DATE/TIME^PROVIDER COMMENTS"
"RTN","PSBPOIV",18,0)
 D INP^VADPT S PSBWARD=$P(VAIN(4),"^"),PSBWDIV=PSBWARD D KVAR^VADPT
"RTN","PSBPOIV",19,0)
 I $G(PSBWARD)'="",$D(^PSB(53.66,"B",PSBWARD)) D  ; if IV paramaters defined for ward use them
"RTN","PSBPOIV",20,0)
 .S PSBWARD=$O(^PSB(53.66,"B",PSBWARD,""))
"RTN","PSBPOIV",21,0)
 .S:$D(^PSB(53.66,PSBWARD,1,"B",PSBIVT)) PSBIVPAR=^PSB(53.66,PSBWARD,1,$O(^PSB(53.66,PSBWARD,1,"B",PSBIVT,""),-1),0)
"RTN","PSBPOIV",22,0)
 I '$D(PSBIVPAR) S PSBIVPAR=PSBIVT D  ; if IV parameters not defined for ward get defaults for division
"RTN","PSBPOIV",23,0)
 .D:$D(PSBWDIV)  ; Get the appropriate DIV for ward and DIVISIONAL IV PARAMETERS
"RTN","PSBPOIV",24,0)
 ..S PSBWDIV=$$GET1^DIQ(42,PSBWDIV_",",.015,"I")
"RTN","PSBPOIV",25,0)
 ..I $G(PSBWDIV)']"" S PSBWDIV="DIV"
"RTN","PSBPOIV",26,0)
 ..E  S PSBWDIV=$P($$SITE^VASITE(DT,PSBWDIV),U,1),PSBWDIV="DIV.`"_PSBWDIV
"RTN","PSBPOIV",27,0)
 ..F X=2:1 Q:$P(PSBCSTR,U,X)=""  S PSBIVPAR=PSBIVPAR_U_$P($P($$GET^XPAR(PSBWDIV,"PSBIV "_$P(PSBCSTR,U,X),PSBIVT,"B"),U,2),"-",1)
"RTN","PSBPOIV",28,0)
 ..K PSBWDIV ; Kill temp variable.
"RTN","PSBPOIV",29,0)
 F PSBC1=1:1 Q:$P(PSBONXS,U,PSBC1)=""  D  ; process all orders
"RTN","PSBPOIV",30,0)
 .D CLEAN^PSBVT,PSJ1^PSBVT(DFN,$P(PSBONXS,U,PSBC1))
"RTN","PSBPOIV",31,0)
 .K PSBPONX2 I $G(PSBPONX)]"",$G(PSBPONX)["P" S PSBPONX2=PSBPONX D  ; Must compare "active" orders for changes made - look beyond "pendings"
"RTN","PSBPOIV",32,0)
 ..F  D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBPONX2) S PSBPONX2=PSBPONX Q:(PSBPONX2="")!(PSBPONX2'["P")  ;
"RTN","PSBPOIV",33,0)
 ..D CLEAN^PSBVT,PSJ1^PSBVT(DFN,$P(PSBONXS,U,PSBC1))  ; Refresh data
"RTN","PSBPOIV",34,0)
 ..S:$D(PSBPONX2) PSBPONX=PSBPONX2 K PSBPONX2
"RTN","PSBPOIV",35,0)
 .Q:($L(U_PSBONXS,U_PSBPONX_U)-1)>0
"RTN","PSBPOIV",36,0)
 .I $G(PSBPONX)]"" S PSBONXS=PSBONXS_PSBPONX_U
"RTN","PSBPOIV",37,0)
 .K ^TMP("PSJ2",$J) S PSBMAUD=0 D EN^PSJBCMA2(PSBDFN,PSBONX,1)  ; check IV parameters against activity log for this order when no "I"nvalid message
"RTN","PSBPOIV",38,0)
 .I PSBMI=0 F X=1:1 Q:'$D(^TMP("PSJ2",$J,X))  S PSBCHKV=U_$P(^TMP("PSJ2",$J,X,1),U,3)_U I PSBCSTR[PSBCHKV D MSG(PSBCHKV,$P(^TMP("PSJ2",$J,X,1),U,1)) S PSBMAUD=1
"RTN","PSBPOIV",39,0)
 .K ^TMP("PSJ2",$J)
"RTN","PSBPOIV",40,0)
 .I PSBMI=0,$G(PSBPONX)]"" D SAVEPAR,CHKORD  ; check IV parameters against previous order when no "I"nvalid message
"RTN","PSBPOIV",41,0)
 .D CLEAN^PSBVT,PSJ1^PSBVT(DFN,$P(PSBONXS,U,PSBC1))  ; restore variable for this order
"RTN","PSBPOIV",42,0)
 .; okay - we have invalids and warnings through this order so process bags for this order
"RTN","PSBPOIV",43,0)
 .I '$D(PSBUIDA) Q  ; got errors and warning but no bags printed for this order - go to the next
"RTN","PSBPOIV",44,0)
 .S PSBUID="" F  S PSBUID=$O(PSBUIDA(PSBUID),-1) Q:PSBUID=""  D
"RTN","PSBPOIV",45,0)
 ..F PSBC2=1:1 S PSBMONX=$P(PSBONXS,U,PSBC2) Q:PSBMONX=""  D  ; check if bag is in 53.79
"RTN","PSBPOIV",46,0)
 ...I $D(^PSB(53.79,"AUID",PSBDFN,PSBMONX,PSBUID)) D
"RTN","PSBPOIV",47,0)
 ....S PSBIEN=$O(^PSB(53.79,"AUID",PSBDFN,PSBMONX,PSBUID,""))
"RTN","PSBPOIV",48,0)
 ....S PSBPDT=$P(PSBLBLA(PSBUID),U,1),PSBLSTS=$P(PSBLBLA(PSBUID),3)
"RTN","PSBPOIV",49,0)
 ....S $P(X,U,2)=$P(^PSB(53.79,PSBIEN,0),U,9)  ; add action status
"RTN","PSBPOIV",50,0)
 ....S $P(X,U,3)=$P(^PSB(53.79,PSBIEN,0),U,6)  ; add action date/time
"RTN","PSBPOIV",51,0)
 ....S $P(X,U,4)=$P(^PSB(53.79,PSBIEN,.1),U,1)  ; add order ID was administered for
"RTN","PSBPOIV",52,0)
 ..S $P(X,U,5)=PSBONX  ; add order ID was printed for
"RTN","PSBPOIV",53,0)
 ..S $P(X,U,6)=PSBOSTS  ; add order status
"RTN","PSBPOIV",54,0)
 ..S $P(X,U,7)=$P(PSBLBLA(PSBUID),U,1)  ; add date/time ID was printed
"RTN","PSBPOIV",55,0)
 ..S $P(X,U,8)=$P(PSBLBLA(PSBUID),U,3)  ; add lable status from pharmacy
"RTN","PSBPOIV",56,0)
 ..S $P(X,U,9)=""  ; 9 open for later development
"RTN","PSBPOIV",57,0)
 ..S $P(X,U,10)=PSBUIDA(PSBUID)  ; add return from PSJ1
"RTN","PSBPOIV",58,0)
 ..D BWAR
"RTN","PSBPOIV",59,0)
 ..I PSBMW=1 S PSBMWS="W;" F I=1:1:^TMP("PSBAR",$J,"W",0) D  S $P(X,U,1)=$P(PSBMWS,";",1,$L(PSBMWS,";")-1)
"RTN","PSBPOIV",60,0)
 ...I $P(PSBLBLA(PSBUID),U,1)'>$P(^TMP("PSBAR",$J,"W",I),U,2) D
"RTN","PSBPOIV",61,0)
 ....S:(PSBONX=$P(PSBONXS,U,1))&(PSBMAUD=1) PSBMWS=PSBMWS_I_";"
"RTN","PSBPOIV",62,0)
 ....S:PSBONX'=$P(PSBONXS,U,1) PSBMWS=PSBMWS_I_";"
"RTN","PSBPOIV",63,0)
 ..I PSBMIDT'="",$P(PSBLBLA(PSBUID),U,1)<PSBMIDT D
"RTN","PSBPOIV",64,0)
 ...S:(PSBONX=$P(PSBONXS,U,1))&(PSBMAUD=1) $P(X,U,1)="I"
"RTN","PSBPOIV",65,0)
 ...S:(PSBONX'=$P(PSBONXS,U,1)) $P(X,U,1)="I"
"RTN","PSBPOIV",66,0)
 ..S ^TMP("PSBAR",$J,PSBUID)=X K X
"RTN","PSBPOIV",67,0)
 D CLEAN^PSBVT
"RTN","PSBPOIV",68,0)
 K PSBC1,PSBC2,PSBSCHV,PSBCSTR,PSBIVPAR,PSBMI,PSBMIDT,PSBMIM,PSBMONX,PSBMW,PSBSPAR,PSBUID,PSBWARD
"RTN","PSBPOIV",69,0)
 K PSBADA,PSBSOLA,PSBOTMP
"RTN","PSBPOIV",70,0)
 I ^TMP("PSBAR",$J,"W",0)=0 K ^TMP("PSBAR",$J,"W",0)
"RTN","PSBPOIV",71,0)
 D PSJ1^PSBVT(DFN,PSBORD)  ; restore variables for calling order
"RTN","PSBPOIV",72,0)
 Q
"RTN","PSBPOIV",73,0)
 ;
"RTN","PSBPOIV",74,0)
SAVEPAR ; save parameters from current order
"RTN","PSBPOIV",75,0)
 K PSBOTMP
"RTN","PSBPOIV",76,0)
 I $D(PSBADA) M PSBOTMP("ADD")=PSBADA E  S PSBOTMP("ADD")=""  ; additive, strength, bottle
"RTN","PSBPOIV",77,0)
 I $D(PSBSOLA) M PSBOTMP("SOL")=PSBSOLA E  S PSBOTMP("SOL")=""  ; solution, volume,
"RTN","PSBPOIV",78,0)
 K PSBADA,PSBSOLA
"RTN","PSBPOIV",79,0)
 S PSBOTMP("INFUSION RATE")=$G(PSBIFR),PSBOTMP("MED ROUTE")=$G(PSBMR)
"RTN","PSBPOIV",80,0)
 S PSBOTMP("SCHEDULE")=$G(PSBSCH),PSBOTMP("ADMIN TIME")=$G(PSBADST)
"RTN","PSBPOIV",81,0)
 S PSBOTMP("REMARKS")=$G(PSBRMRK),PSBOTMP("OTHER PRINT INFO")=$G(PSBOTXT)
"RTN","PSBPOIV",82,0)
 S PSBOTMP("PROVIDER")=PSBMD,PSBOTMP("START DATE/TIME")=PSBOST
"RTN","PSBPOIV",83,0)
 S PSBOTMP("STOP DATE/TIME")=PSBOSP
"RTN","PSBPOIV",84,0)
 D CLEAN^PSBVT,PSJ1^PSBVT(DFN,$P(PSBONXS,U,PSBC1+1))  ; setup previous order variables
"RTN","PSBPOIV",85,0)
 Q
"RTN","PSBPOIV",86,0)
 ;
"RTN","PSBPOIV",87,0)
CHKORD ; check previous order against current order
"RTN","PSBPOIV",88,0)
 I $D(PSBADA)!($D(PSBOTMP("ADD"))) D CHKADD Q:PSBMI=1
"RTN","PSBPOIV",89,0)
 I $D(PSBSOLA)!($D(PSBOTMP("SOL"))) D CHKSOL Q:PSBMI=1
"RTN","PSBPOIV",90,0)
 I PSBIFR'=PSBOTMP("INFUSION RATE") D MSG("INFUSION RATE",PSBOSP) Q:PSBMI=1
"RTN","PSBPOIV",91,0)
 I PSBMR'=PSBOTMP("MED ROUTE") D MSG("MED ROUTE",PSBOSP) Q:PSBMI=1
"RTN","PSBPOIV",92,0)
 I PSBSCH'=PSBOTMP("SCHEDULE") D MSG("SCHEDULE",PSBOSP) Q:PSBMI=1
"RTN","PSBPOIV",93,0)
 I PSBADST'=PSBOTMP("ADMIN TIME") D MSG("ADMIN TIME",PSBOSP) Q:PSBMI=1
"RTN","PSBPOIV",94,0)
 I PSBRMRK'=PSBOTMP("REMARKS") D MSG("REMARKS",PSBOSP) Q:PSBMI=1
"RTN","PSBPOIV",95,0)
 I PSBOTXT'=PSBOTMP("OTHER PRINT INFO") D MSG("OTHER PRINT INFO",PSBOSP) Q:PSBMI=1
"RTN","PSBPOIV",96,0)
 I PSBMD'=PSBOTMP("PROVIDER") D MSG("PROVIDER",PSBOSP) Q:PSBMI=1
"RTN","PSBPOIV",97,0)
 I $E(PSBOST,1,10)'=$E(PSBOTMP("START DATE/TIME"),1,10) D MSG("START DATE/TIME",PSBOSP) Q:PSBMI=1
"RTN","PSBPOIV",98,0)
 I $E(PSBOSP,1,10)'=$E(PSBOTMP("STOP DATE/TIME"),1,10) D MSG("STOP DATE/TIME",PSBOSP)
"RTN","PSBPOIV",99,0)
 Q
"RTN","PSBPOIV",100,0)
CHKADD ;
"RTN","PSBPOIV",101,0)
 N X,Y
"RTN","PSBPOIV",102,0)
 I '$D(PSBADA),'$D(PSBOTMP("ADD")) Q  ; no additives
"RTN","PSBPOIV",103,0)
 I $O(PSBADA(""),-1)>$O(PSBOTMP("ADD",""),-1) D MSG("ADDITIVE",PSBOSP) Q  ;previous order has addtives not in current order
"RTN","PSBPOIV",104,0)
 I $O(PSBADA(""),-1)<$O(PSBOTMP("ADD",""),-1) D MSG("ADDITIVE",PSBOSP) Q  ;previous order missing additives in current order
"RTN","PSBPOIV",105,0)
 S X="" F  S X=$O(PSBADA(X)) Q:X=""  D  Q  ; check that additives, strength, and bottle are the same
"RTN","PSBPOIV",106,0)
 .I PSBADA(X)=PSBOTMP("ADD",X) Q  ; everything the same
"RTN","PSBPOIV",107,0)
 .I $P(PSBADA(X),U,2)'=$P(PSBOTMP("ADD",X),U,2) D MSG("ADDITIVE",PSBOSP) Q
"RTN","PSBPOIV",108,0)
 .I $P(PSBADA(X),U,4)'=$P(PSBOTMP("ADD",X),U,4) D MSG("STRENGTH",PSBOSP) Q
"RTN","PSBPOIV",109,0)
 Q
"RTN","PSBPOIV",110,0)
 ;
"RTN","PSBPOIV",111,0)
CHKSOL ;
"RTN","PSBPOIV",112,0)
 N X,Y
"RTN","PSBPOIV",113,0)
 I '$D(PSBSOLA),'$D(PSBOTMP("SOL")) Q  ; no solutions
"RTN","PSBPOIV",114,0)
 I $O(PSBSOLA(""),-1)>$O(PSBOTMP("SOL",""),-1) D MSG("SOLUTION",PSBOSP) Q  ;previous order has solutions not in current order
"RTN","PSBPOIV",115,0)
 I $O(PSBSOLA(""),-1)<$O(PSBOTMP("SOL",""),-1) D MSG("SOLUTION",PSBOSP) Q  ;previous order missing solutions in current order
"RTN","PSBPOIV",116,0)
 S X="" F  S X=$O(PSBSOLA(X)) Q:X=""  D  Q  ; check that solutions volume are the same
"RTN","PSBPOIV",117,0)
 .I PSBSOLA(X)=PSBOTMP("SOL",X) Q  ; everything the same
"RTN","PSBPOIV",118,0)
 .I $P(PSBSOLA(X),U,2)'=$P(PSBOTMP("SOL",X),U,2) D MSG("SOLUTION",PSBOSP) Q
"RTN","PSBPOIV",119,0)
 .I $P(PSBSOLA(X),U,4)'=$P(PSBOTMP("SOL",X),U,4) D MSG("VOLUME",PSBOSP) Q
"RTN","PSBPOIV",120,0)
 Q
"RTN","PSBPOIV",121,0)
 ;
"RTN","PSBPOIV",122,0)
BWAR ;
"RTN","PSBPOIV",123,0)
 N X,Y,Z,PSBONX
"RTN","PSBPOIV",124,0)
 S X=^TMP("PSBAR",$J,"W",0)+1
"RTN","PSBPOIV",125,0)
 S Z="" F Z=1:1 S PSBONX=$P(PSBONXS,U,Z) Q:$G(PSBONX)=""  D  ; Display "Warning"s for changes 
"RTN","PSBPOIV",126,0)
 .I '$D(PSBMWAR(PSBONX)) Q
"RTN","PSBPOIV",127,0)
 .S Y="" F  S Y=$O(PSBMWAR(PSBONX,Y)) Q:Y'?.N1".".N  D
"RTN","PSBPOIV",128,0)
 ..S Z="",PSBYS="" F  S Z=$O(PSBMWAR(PSBONX,Y,Z)) Q:Z=""  S PSBYS=PSBYS_Z_";"
"RTN","PSBPOIV",129,0)
 ..S PSBYS=$P(PSBYS,";",1,$L(PSBYS,";")-1)
"RTN","PSBPOIV",130,0)
 ..S ^TMP("PSBAR",$J,"W",X)=PSBONX_U_Y_U_"2^The "_PSBYS_" was changed on",^TMP("PSBAR",$J,"W",0)=X,X=X+1
"RTN","PSBPOIV",131,0)
 .K PSBMWAR(PSBONX)
"RTN","PSBPOIV",132,0)
 Q
"RTN","PSBPOIV",133,0)
 ;
"RTN","PSBPOIV",134,0)
MSG(PSBMVAR,PSBDATE) ;
"RTN","PSBPOIV",135,0)
 I PSBMI=1 Q  ;already have an invalid don't need anymore
"RTN","PSBPOIV",136,0)
 F Y=1:1 S PSBSPAR=$P(PSBCSTR,U,Y) I PSBSPAR=$TR(PSBMVAR,"^") D  Q
"RTN","PSBPOIV",137,0)
 .I $P(PSBIVPAR,U,Y)="W" D
"RTN","PSBPOIV",138,0)
 ..S PSBMVAR=$TR(PSBMVAR,"^")
"RTN","PSBPOIV",139,0)
 ..I PSBMW=0 S PSBMW=1
"RTN","PSBPOIV",140,0)
 ..S PSBMWC=PSBMWC+1,PSBMWM="2^The "_PSBSPAR_" has been changed."
"RTN","PSBPOIV",141,0)
 ..I $D(PSBMWAR(PSBONX,PSBMVAR)) S PSBOLDT=$O(PSBMWAR(PSBONX,PSBMVAR,"")) I PSBOLDT<$E(PSBDATE,1,12) K PSBMWAR(PSBONX,PSBMVAR,PSBOLDT)
"RTN","PSBPOIV",142,0)
 ..S PSBMWAR(PSBONX,PSBMVAR,$E(PSBDATE,1,12))=""
"RTN","PSBPOIV",143,0)
 ..S PSBMWAR(PSBONX,$E(PSBDATE,1,12),PSBMVAR)=""
"RTN","PSBPOIV",144,0)
 .I $P(PSBIVPAR,U,Y)="I" S PSBMI=1,PSBMIDT=PSBDATE,PSBMIM="-1^IV invalid "_PSBSPAR_".",^TMP("PSBAR",$J,"I")=PSBONX_U_PSBMIDT_U_PSBMIM
"RTN","PSBPOIV",145,0)
 Q
"VER")
8.0^22.0
"^DD",53.69,53.69,.05,0)
TYPE OF REQUEST^F^^0;5^K:$L(X)>2!($L(X)<2)!'(X'?1P.E) X
"^DD",53.69,53.69,.05,.1)
Type of Request
"^DD",53.69,53.69,.05,3)
Answer must be 2 characters in length
"^DD",53.69,53.69,.05,21,0)
^.001^28^28^3071026^^^
"^DD",53.69,53.69,.05,21,1,0)
Automatically stuffed at record creation with the type of report that is
"^DD",53.69,53.69,.05,21,2,0)
being requested.  Used to drive the report later on by appending the
"^DD",53.69,53.69,.05,21,3,0)
internal code to "DQ^PSBO"_type for the routine reference to run.  (i.e.
"^DD",53.69,53.69,.05,21,4,0)
ML for med log would call DQ^PSBOML to generate the report.) 
"^DD",53.69,53.69,.05,21,5,0)
Report types DL = Due List
"^DD",53.69,53.69,.05,21,6,0)
             MH = Medication Admin History (MAH)
"^DD",53.69,53.69,.05,21,7,0)
             ML = Med Log
"^DD",53.69,53.69,.05,21,8,0)
             MM = Missed Medications
"^DD",53.69,53.69,.05,21,9,0)
             PE = PRN Effectiveness List
"^DD",53.69,53.69,.05,21,10,0)
             PM = Patient Medication History
"^DD",53.69,53.69,.05,21,11,0)
             WA = Ward Administration Times
"^DD",53.69,53.69,.05,21,12,0)
             MV = Medication Variance Log
"^DD",53.69,53.69,.05,21,13,0)
             BL = Bar Code Label
"^DD",53.69,53.69,.05,21,14,0)
             MD = Missing Dose Follow-up
"^DD",53.69,53.69,.05,21,15,0)
             AL = Allergy Report
"^DD",53.69,53.69,.05,21,16,0)
             PI = Patient Inquiry
"^DD",53.69,53.69,.05,21,17,0)
             DO = Display Order
"^DD",53.69,53.69,.05,21,18,0)
             VT = Vitals Cumulative
"^DD",53.69,53.69,.05,21,19,0)
             PF = Patient Record Flag
"^DD",53.69,53.69,.05,21,20,0)
             XA = Unknown Action Status Report
"^DD",53.69,53.69,.05,21,21,0)
             CE = BCMA Coversheet Expired Orders Report
"^DD",53.69,53.69,.05,21,22,0)
             CI = BCMA Coversheet IV Overview Report
"^DD",53.69,53.69,.05,21,23,0)
             CM = BCMA Coversheet Medication Overview Report
"^DD",53.69,53.69,.05,21,24,0)
             CP = BCMA Coversheet PRN Overview Report
"^DD",53.69,53.69,.05,21,25,0)
             IV = BCMA IV Bag Status Report
"^DD",53.69,53.69,.05,21,26,0)
             MT = BCMA Medication Therapy Report
"^DD",53.69,53.69,.05,21,27,0)
             BZ = Barcode Label Print
"^DD",53.69,53.69,.05,21,28,0)

"^DD",53.69,53.69,.05,"DT")
3070612
"^DD",53.69,53.69,.32,0)
[BL] LOT NUMBER^F^^.3;2^K:$L(X)>25!($L(X)<1) X
"^DD",53.69,53.69,.32,.1)
Lot Number
"^DD",53.69,53.69,.32,3)
Answer must be 1-25 characters in length.
"^DD",53.69,53.69,.32,21,0)
^.001^1^1^3050609^^^
"^DD",53.69,53.69,.32,21,1,0)
Contains the lot number of the drug to print a bar code label for.
"^DD",53.69,53.69,.32,"DT")
3050609
"^DD",53.69,53.69,.34,0)
[BL] MANUFACTURER^F^^.3;4^K:$L(X)>10!($L(X)<1) X
"^DD",53.69,53.69,.34,.1)
Manufacturer
"^DD",53.69,53.69,.34,3)
Answer must be 1-10 characters in length.
"^DD",53.69,53.69,.34,21,0)
^.001^1^1^3050609^^^
"^DD",53.69,53.69,.34,21,1,0)
Contains the manufacturer of the drug to print a bar code label for.
"^DD",53.69,53.69,.34,"DT")
3050609
"^DD",53.69,53.69,.39,0)
[BL] DOSAGE^F^^.3;9^K:$L(X)>22!($L(X)<1) X
"^DD",53.69,53.69,.39,3)
Answer must be 1-22 characters in length.
"^DD",53.69,53.69,.39,21,0)
^.001^1^1^3060417^^^^
"^DD",53.69,53.69,.39,21,1,0)
Free text dosage to print on each label.
"^DD",53.69,53.69,.39,"DT")
3060417
"BLD",6042,6)
^30
**END**
**END**
