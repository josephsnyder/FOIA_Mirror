Released PSB*3*70 SEQ #62
Extracted from mail message
**KIDS**:PSB*3.0*70^

**INSTALL NAME**
PSB*3.0*70
"BLD",8399,0)
PSB*3.0*70^BAR CODE MED ADMIN^0^3131101^y
"BLD",8399,1,0)
^^1^1^3120517^
"BLD",8399,1,1,0)
Clinic Order and Witness for High Risk / High Alert drugs.
"BLD",8399,4,0)
^9.64PA^53.68^3
"BLD",8399,4,53.68,0)
53.68
"BLD",8399,4,53.68,2,0)
^9.641^53.68^1
"BLD",8399,4,53.68,2,53.68,0)
BCMA MISSING DOSE REQUEST  (File-top level)
"BLD",8399,4,53.68,2,53.68,1,0)
^9.6411^1^1
"BLD",8399,4,53.68,2,53.68,1,1,0)
CLINIC
"BLD",8399,4,53.68,222)
y^y^p^^^^n^^n
"BLD",8399,4,53.68,224)

"BLD",8399,4,53.69,0)
53.69
"BLD",8399,4,53.69,2,0)
^9.641^53.69^1
"BLD",8399,4,53.69,2,53.69,0)
BCMA REPORT REQUEST  (File-top level)
"BLD",8399,4,53.69,2,53.69,1,0)
^9.6411^5^3
"BLD",8399,4,53.69,2,53.69,1,.11,0)
SORT BY
"BLD",8399,4,53.69,2,53.69,1,4,0)
ORDERS TYPE MODE C/I
"BLD",8399,4,53.69,2,53.69,1,5,0)
CLINIC TO PRINT
"BLD",8399,4,53.69,222)
y^y^p^^^^n^^n
"BLD",8399,4,53.69,224)

"BLD",8399,4,53.79,0)
53.79
"BLD",8399,4,53.79,2,0)
^9.641^53.797^4
"BLD",8399,4,53.79,2,53.79,0)
BCMA MEDICATION LOG  (File-top level)
"BLD",8399,4,53.79,2,53.79,1,0)
^9.6411^.02^8
"BLD",8399,4,53.79,2,53.79,1,.01,0)
PATIENT NAME
"BLD",8399,4,53.79,2,53.79,1,.02,0)
PATIENT LOCATION
"BLD",8399,4,53.79,2,53.79,1,.06,0)
ACTION DATE/TIME
"BLD",8399,4,53.79,2,53.79,1,.28,0)
WITNESS DATE/TIME
"BLD",8399,4,53.79,2,53.79,1,.29,0)
ADMIN WITNESSED BY
"BLD",8399,4,53.79,2,53.79,1,.31,0)
WITNESS COMMENT
"BLD",8399,4,53.79,2,53.79,1,.32,0)
WITNESS HR ORDER CODE
"BLD",8399,4,53.79,2,53.79,1,.33,0)
WITNESSED?
"BLD",8399,4,53.79,2,53.795,0)
DISPENSE DRUG  (sub-file)
"BLD",8399,4,53.79,2,53.795,1,0)
^9.6411^.05^1
"BLD",8399,4,53.79,2,53.795,1,.05,0)
HIGH RISK/HIGH ALERT
"BLD",8399,4,53.79,2,53.796,0)
ADDITIVES  (sub-file)
"BLD",8399,4,53.79,2,53.796,1,0)
^9.6411^.05^1
"BLD",8399,4,53.79,2,53.796,1,.05,0)
HIGH RISK/HIGH ALERT
"BLD",8399,4,53.79,2,53.797,0)
SOLUTIONS  (sub-file)
"BLD",8399,4,53.79,2,53.797,1,0)
^9.6411^.05^1
"BLD",8399,4,53.79,2,53.797,1,.05,0)
HIGH RISK/HIGH ALERT
"BLD",8399,4,53.79,222)
y^y^p^^^^n^^n
"BLD",8399,4,53.79,224)

"BLD",8399,4,"APDD",53.68,53.68)

"BLD",8399,4,"APDD",53.68,53.68,1)

"BLD",8399,4,"APDD",53.69,53.69)

"BLD",8399,4,"APDD",53.69,53.69,.11)

"BLD",8399,4,"APDD",53.69,53.69,4)

"BLD",8399,4,"APDD",53.69,53.69,5)

"BLD",8399,4,"APDD",53.79,53.79)

"BLD",8399,4,"APDD",53.79,53.79,.01)

"BLD",8399,4,"APDD",53.79,53.79,.02)

"BLD",8399,4,"APDD",53.79,53.79,.06)

"BLD",8399,4,"APDD",53.79,53.79,.28)

"BLD",8399,4,"APDD",53.79,53.79,.29)

"BLD",8399,4,"APDD",53.79,53.79,.31)

"BLD",8399,4,"APDD",53.79,53.79,.32)

"BLD",8399,4,"APDD",53.79,53.79,.33)

"BLD",8399,4,"APDD",53.79,53.795)

"BLD",8399,4,"APDD",53.79,53.795,.05)

"BLD",8399,4,"APDD",53.79,53.796)

"BLD",8399,4,"APDD",53.79,53.796,.05)

"BLD",8399,4,"APDD",53.79,53.797)

"BLD",8399,4,"APDD",53.79,53.797,.05)

"BLD",8399,4,"B",53.68,53.68)

"BLD",8399,4,"B",53.69,53.69)

"BLD",8399,4,"B",53.79,53.79)

"BLD",8399,6)
24^
"BLD",8399,6.3)
101
"BLD",8399,"ABPKG")
n
"BLD",8399,"KRN",0)
^9.67PA^779.2^20
"BLD",8399,"KRN",.4,0)
.4
"BLD",8399,"KRN",.401,0)
.401
"BLD",8399,"KRN",.402,0)
.402
"BLD",8399,"KRN",.403,0)
.403
"BLD",8399,"KRN",.403,"NM",0)
^9.68A^3^3
"BLD",8399,"KRN",.403,"NM",1,0)
PSB MISSING DOSE FOLLOWUP    FILE #53.68^53.68^0
"BLD",8399,"KRN",.403,"NM",2,0)
PSBO MD    FILE #53.69^53.69^0
"BLD",8399,"KRN",.403,"NM",3,0)
PSBO BL    FILE #53.69^53.69^0
"BLD",8399,"KRN",.403,"NM","B","PSB MISSING DOSE FOLLOWUP    FILE #53.68",1)

"BLD",8399,"KRN",.403,"NM","B","PSBO BL    FILE #53.69",3)

"BLD",8399,"KRN",.403,"NM","B","PSBO MD    FILE #53.69",2)

"BLD",8399,"KRN",.5,0)
.5
"BLD",8399,"KRN",.84,0)
.84
"BLD",8399,"KRN",3.6,0)
3.6
"BLD",8399,"KRN",3.8,0)
3.8
"BLD",8399,"KRN",9.2,0)
9.2
"BLD",8399,"KRN",9.8,0)
9.8
"BLD",8399,"KRN",9.8,"NM",0)
^9.68A^50^46
"BLD",8399,"KRN",9.8,"NM",2,0)
PSBO^^0^B150383689
"BLD",8399,"KRN",9.8,"NM",3,0)
PSBOMM^^0^B142931678
"BLD",8399,"KRN",9.8,"NM",4,0)
PSBCSUTL^^0^B171997833
"BLD",8399,"KRN",9.8,"NM",5,0)
PSBVDLTB^^0^B33639693
"BLD",8399,"KRN",9.8,"NM",6,0)
PSBVDLU1^^0^B171179505
"BLD",8399,"KRN",9.8,"NM",7,0)
PSBVT^^0^B98717272
"BLD",8399,"KRN",9.8,"NM",8,0)
PSBRPC^^0^B225560301
"BLD",8399,"KRN",9.8,"NM",10,0)
PSBVDLIV^^0^B81051093
"BLD",8399,"KRN",9.8,"NM",11,0)
PSBVDLPB^^0^B106147258
"BLD",8399,"KRN",9.8,"NM",12,0)
PSBVDLUD^^0^B91521932
"BLD",8399,"KRN",9.8,"NM",13,0)
PSBML^^0^B123316080
"BLD",8399,"KRN",9.8,"NM",14,0)
PSBODO^^0^B38012086
"BLD",8399,"KRN",9.8,"NM",15,0)
PSBOML^^0^B62348455
"BLD",8399,"KRN",9.8,"NM",16,0)
PSBVITFL^^0^B9618228
"BLD",8399,"KRN",9.8,"NM",17,0)
PSBRPC3^^0^B291796
"BLD",8399,"KRN",9.8,"NM",18,0)
PSBOCE^^0^B101068370
"BLD",8399,"KRN",9.8,"NM",19,0)
PSBVDLVL^^0^B74523979
"BLD",8399,"KRN",9.8,"NM",20,0)
PSBO1^^0^B19597423
"BLD",8399,"KRN",9.8,"NM",21,0)
PSBPRN^^0^B41292164
"BLD",8399,"KRN",9.8,"NM",22,0)
PSBOMT^^0^B91036821
"BLD",8399,"KRN",9.8,"NM",23,0)
PSBOPE^^0^B20462828
"BLD",8399,"KRN",9.8,"NM",24,0)
PSBOPM^^0^B75665878
"BLD",8399,"KRN",9.8,"NM",25,0)
PSBOWA^^0^B134110503
"BLD",8399,"KRN",9.8,"NM",26,0)
PSBOHDR^^0^B71757590
"BLD",8399,"KRN",9.8,"NM",28,0)
PSBOIV^^0^B85319795
"BLD",8399,"KRN",9.8,"NM",29,0)
PSBODL^^0^B104826569
"BLD",8399,"KRN",9.8,"NM",30,0)
PSBVDLPA^^0^B22291163
"BLD",8399,"KRN",9.8,"NM",31,0)
PSBOCP^^0^B95743984
"BLD",8399,"KRN",9.8,"NM",32,0)
PSBOCP1^^0^B6917771
"BLD",8399,"KRN",9.8,"NM",33,0)
PSBOCM^^0^B102788691
"BLD",8399,"KRN",9.8,"NM",34,0)
PSBOCM1^^0^B23772218
"BLD",8399,"KRN",9.8,"NM",35,0)
PSBOCI^^0^B103229478
"BLD",8399,"KRN",9.8,"NM",36,0)
PSBOMH^^0^B92472533
"BLD",8399,"KRN",9.8,"NM",38,0)
PSBOMH2^^0^B56923677
"BLD",8399,"KRN",9.8,"NM",39,0)
PSBMD^^0^B90525242
"BLD",8399,"KRN",9.8,"NM",40,0)
PSBML2^^0^B90238392
"BLD",8399,"KRN",9.8,"NM",41,0)
PSBVAR^^0^B15144988
"BLD",8399,"KRN",9.8,"NM",42,0)
PSBMLLKU^^0^B105244000
"BLD",8399,"KRN",9.8,"NM",43,0)
PSBODL1^^0^B44703020
"BLD",8399,"KRN",9.8,"NM",44,0)
PSBRPC1^^0^B25166378
"BLD",8399,"KRN",9.8,"NM",45,0)
PSBOMD^^0^B16573592
"BLD",8399,"KRN",9.8,"NM",46,0)
PSBOBL^^0^B10430547
"BLD",8399,"KRN",9.8,"NM",47,0)
PSBOBZ^^0^B19545874
"BLD",8399,"KRN",9.8,"NM",48,0)
PSBPOIV^^0^B73419949
"BLD",8399,"KRN",9.8,"NM",49,0)
PSBML3^^0^B46997085
"BLD",8399,"KRN",9.8,"NM",50,0)
PSBVDLU3^^0^B94081463
"BLD",8399,"KRN",9.8,"NM","B","PSBCSUTL",4)

"BLD",8399,"KRN",9.8,"NM","B","PSBMD",39)

"BLD",8399,"KRN",9.8,"NM","B","PSBML",13)

"BLD",8399,"KRN",9.8,"NM","B","PSBML2",40)

"BLD",8399,"KRN",9.8,"NM","B","PSBML3",49)

"BLD",8399,"KRN",9.8,"NM","B","PSBMLLKU",42)

"BLD",8399,"KRN",9.8,"NM","B","PSBO",2)

"BLD",8399,"KRN",9.8,"NM","B","PSBO1",20)

"BLD",8399,"KRN",9.8,"NM","B","PSBOBL",46)

"BLD",8399,"KRN",9.8,"NM","B","PSBOBZ",47)

"BLD",8399,"KRN",9.8,"NM","B","PSBOCE",18)

"BLD",8399,"KRN",9.8,"NM","B","PSBOCI",35)

"BLD",8399,"KRN",9.8,"NM","B","PSBOCM",33)

"BLD",8399,"KRN",9.8,"NM","B","PSBOCM1",34)

"BLD",8399,"KRN",9.8,"NM","B","PSBOCP",31)

"BLD",8399,"KRN",9.8,"NM","B","PSBOCP1",32)

"BLD",8399,"KRN",9.8,"NM","B","PSBODL",29)

"BLD",8399,"KRN",9.8,"NM","B","PSBODL1",43)

"BLD",8399,"KRN",9.8,"NM","B","PSBODO",14)

"BLD",8399,"KRN",9.8,"NM","B","PSBOHDR",26)

"BLD",8399,"KRN",9.8,"NM","B","PSBOIV",28)

"BLD",8399,"KRN",9.8,"NM","B","PSBOMD",45)

"BLD",8399,"KRN",9.8,"NM","B","PSBOMH",36)

"BLD",8399,"KRN",9.8,"NM","B","PSBOMH2",38)

"BLD",8399,"KRN",9.8,"NM","B","PSBOML",15)

"BLD",8399,"KRN",9.8,"NM","B","PSBOMM",3)

"BLD",8399,"KRN",9.8,"NM","B","PSBOMT",22)

"BLD",8399,"KRN",9.8,"NM","B","PSBOPE",23)

"BLD",8399,"KRN",9.8,"NM","B","PSBOPM",24)

"BLD",8399,"KRN",9.8,"NM","B","PSBOWA",25)

"BLD",8399,"KRN",9.8,"NM","B","PSBPOIV",48)

"BLD",8399,"KRN",9.8,"NM","B","PSBPRN",21)

"BLD",8399,"KRN",9.8,"NM","B","PSBRPC",8)

"BLD",8399,"KRN",9.8,"NM","B","PSBRPC1",44)

"BLD",8399,"KRN",9.8,"NM","B","PSBRPC3",17)

"BLD",8399,"KRN",9.8,"NM","B","PSBVAR",41)

"BLD",8399,"KRN",9.8,"NM","B","PSBVDLIV",10)

"BLD",8399,"KRN",9.8,"NM","B","PSBVDLPA",30)

"BLD",8399,"KRN",9.8,"NM","B","PSBVDLPB",11)

"BLD",8399,"KRN",9.8,"NM","B","PSBVDLTB",5)

"BLD",8399,"KRN",9.8,"NM","B","PSBVDLU1",6)

"BLD",8399,"KRN",9.8,"NM","B","PSBVDLU3",50)

"BLD",8399,"KRN",9.8,"NM","B","PSBVDLUD",12)

"BLD",8399,"KRN",9.8,"NM","B","PSBVDLVL",19)

"BLD",8399,"KRN",9.8,"NM","B","PSBVITFL",16)

"BLD",8399,"KRN",9.8,"NM","B","PSBVT",7)

"BLD",8399,"KRN",19,0)
19
"BLD",8399,"KRN",19,"NM",0)
^9.68A^5^5
"BLD",8399,"KRN",19,"NM",1,0)
PSB GUI CONTEXT - USER^^0
"BLD",8399,"KRN",19,"NM",2,0)
PSB MISSING DOSE REQUEST^^1^
"BLD",8399,"KRN",19,"NM",3,0)
PSBO DL^^0
"BLD",8399,"KRN",19,"NM",4,0)
PSBO MM^^0
"BLD",8399,"KRN",19,"NM",5,0)
PSBO WA^^0
"BLD",8399,"KRN",19,"NM","B","PSB GUI CONTEXT - USER",1)

"BLD",8399,"KRN",19,"NM","B","PSB MISSING DOSE REQUEST",2)

"BLD",8399,"KRN",19,"NM","B","PSBO DL",3)

"BLD",8399,"KRN",19,"NM","B","PSBO MM",4)

"BLD",8399,"KRN",19,"NM","B","PSBO WA",5)

"BLD",8399,"KRN",19.1,0)
19.1
"BLD",8399,"KRN",19.1,"NM",0)
^9.68A^2^2
"BLD",8399,"KRN",19.1,"NM",1,0)
PSB NO WITNESS^^0
"BLD",8399,"KRN",19.1,"NM",2,0)
PSB UAP^^1^
"BLD",8399,"KRN",19.1,"NM","B","PSB NO WITNESS",1)

"BLD",8399,"KRN",19.1,"NM","B","PSB UAP",2)

"BLD",8399,"KRN",101,0)
101
"BLD",8399,"KRN",409.61,0)
409.61
"BLD",8399,"KRN",771,0)
771
"BLD",8399,"KRN",779.2,0)
779.2
"BLD",8399,"KRN",870,0)
870
"BLD",8399,"KRN",8989.51,0)
8989.51
"BLD",8399,"KRN",8989.51,"NM",0)
^9.68A^1^1
"BLD",8399,"KRN",8989.51,"NM",1,0)
PSB PRINTER CO MISSING DOSE^^0
"BLD",8399,"KRN",8989.51,"NM","B","PSB PRINTER CO MISSING DOSE",1)

"BLD",8399,"KRN",8989.52,0)
8989.52
"BLD",8399,"KRN",8989.52,"NM",0)
^9.68A^1^1
"BLD",8399,"KRN",8989.52,"NM",1,0)
PSB DIVISION^^0
"BLD",8399,"KRN",8989.52,"NM","B","PSB DIVISION",1)

"BLD",8399,"KRN",8994,0)
8994
"BLD",8399,"KRN",8994,"NM",0)
^9.68A^11^10
"BLD",8399,"KRN",8994,"NM",1,0)
PSB GETORDERTAB^^0
"BLD",8399,"KRN",8994,"NM",2,0)
PSB CLINICLIST^^0
"BLD",8399,"KRN",8994,"NM",4,0)
PSB REPORT^^0
"BLD",8399,"KRN",8994,"NM",5,0)
PSB USERLOAD^^0
"BLD",8399,"KRN",8994,"NM",6,0)
PSB USERSAVE^^0
"BLD",8399,"KRN",8994,"NM",7,0)
PSB WITNESS^^0
"BLD",8399,"KRN",8994,"NM",8,0)
PSB COVERSHEET1^^0
"BLD",8399,"KRN",8994,"NM",9,0)
PSB TRANSACTION^^0
"BLD",8399,"KRN",8994,"NM",10,0)
PSB MEDS ON PATIENT^^0
"BLD",8399,"KRN",8994,"NM",11,0)
PSB SUBMIT MISSING DOSE^^0
"BLD",8399,"KRN",8994,"NM","B","PSB CLINICLIST",2)

"BLD",8399,"KRN",8994,"NM","B","PSB COVERSHEET1",8)

"BLD",8399,"KRN",8994,"NM","B","PSB GETORDERTAB",1)

"BLD",8399,"KRN",8994,"NM","B","PSB MEDS ON PATIENT",10)

"BLD",8399,"KRN",8994,"NM","B","PSB REPORT",4)

"BLD",8399,"KRN",8994,"NM","B","PSB SUBMIT MISSING DOSE",11)

"BLD",8399,"KRN",8994,"NM","B","PSB TRANSACTION",9)

"BLD",8399,"KRN",8994,"NM","B","PSB USERLOAD",5)

"BLD",8399,"KRN",8994,"NM","B","PSB USERSAVE",6)

"BLD",8399,"KRN",8994,"NM","B","PSB WITNESS",7)

"BLD",8399,"KRN","B",.4,.4)

"BLD",8399,"KRN","B",.401,.401)

"BLD",8399,"KRN","B",.402,.402)

"BLD",8399,"KRN","B",.403,.403)

"BLD",8399,"KRN","B",.5,.5)

"BLD",8399,"KRN","B",.84,.84)

"BLD",8399,"KRN","B",3.6,3.6)

"BLD",8399,"KRN","B",3.8,3.8)

"BLD",8399,"KRN","B",9.2,9.2)

"BLD",8399,"KRN","B",9.8,9.8)

"BLD",8399,"KRN","B",19,19)

"BLD",8399,"KRN","B",19.1,19.1)

"BLD",8399,"KRN","B",101,101)

"BLD",8399,"KRN","B",409.61,409.61)

"BLD",8399,"KRN","B",771,771)

"BLD",8399,"KRN","B",779.2,779.2)

"BLD",8399,"KRN","B",870,870)

"BLD",8399,"KRN","B",8989.51,8989.51)

"BLD",8399,"KRN","B",8989.52,8989.52)

"BLD",8399,"KRN","B",8994,8994)

"BLD",8399,"QDEF")
^^^^NO^^^^YES^^NO
"BLD",8399,"QUES",0)
^9.62^^
"BLD",8399,"REQB",0)
^9.611^7^6
"BLD",8399,"REQB",2,0)
PSJ*5.0*279^2
"BLD",8399,"REQB",3,0)
PSB*3.0*66^2
"BLD",8399,"REQB",4,0)
PSB*3.0*54^2
"BLD",8399,"REQB",5,0)
PSB*3.0*74^2
"BLD",8399,"REQB",6,0)
PSB*3.0*41^2
"BLD",8399,"REQB",7,0)
PSB*3.0*64^2
"BLD",8399,"REQB","B","PSB*3.0*41",6)

"BLD",8399,"REQB","B","PSB*3.0*54",4)

"BLD",8399,"REQB","B","PSB*3.0*64",7)

"BLD",8399,"REQB","B","PSB*3.0*66",3)

"BLD",8399,"REQB","B","PSB*3.0*74",5)

"BLD",8399,"REQB","B","PSJ*5.0*279",2)

"FIA",53.68)
BCMA MISSING DOSE REQUEST
"FIA",53.68,0)
^PSB(53.68,
"FIA",53.68,0,0)
53.68
"FIA",53.68,0,1)
y^y^p^^^^n^^n
"FIA",53.68,0,10)

"FIA",53.68,0,11)

"FIA",53.68,0,"RLRO")

"FIA",53.68,0,"VR")
3.0^PSB
"FIA",53.68,53.68)
1
"FIA",53.68,53.68,1)

"FIA",53.69)
BCMA REPORT REQUEST
"FIA",53.69,0)
^PSB(53.69,
"FIA",53.69,0,0)
53.69
"FIA",53.69,0,1)
y^y^p^^^^n^^n
"FIA",53.69,0,10)

"FIA",53.69,0,11)

"FIA",53.69,0,"RLRO")

"FIA",53.69,0,"VR")
3.0^PSB
"FIA",53.69,53.69)
1
"FIA",53.69,53.69,.11)

"FIA",53.69,53.69,4)

"FIA",53.69,53.69,5)

"FIA",53.79)
BCMA MEDICATION LOG
"FIA",53.79,0)
^PSB(53.79,
"FIA",53.79,0,0)
53.79IP
"FIA",53.79,0,1)
y^y^p^^^^n^^n
"FIA",53.79,0,10)

"FIA",53.79,0,11)

"FIA",53.79,0,"RLRO")

"FIA",53.79,0,"VR")
3.0^PSB
"FIA",53.79,53.79)
1
"FIA",53.79,53.79,.01)

"FIA",53.79,53.79,.02)

"FIA",53.79,53.79,.06)

"FIA",53.79,53.79,.28)

"FIA",53.79,53.79,.29)

"FIA",53.79,53.79,.31)

"FIA",53.79,53.79,.32)

"FIA",53.79,53.79,.33)

"FIA",53.79,53.795)
1
"FIA",53.79,53.795,.05)

"FIA",53.79,53.796)
1
"FIA",53.79,53.796,.05)

"FIA",53.79,53.797)
1
"FIA",53.79,53.797,.05)

"IX",53.79,53.79,"AINFUSING",0)
53.79^AINFUSING^Index of IV's still with a status of Infusing.^R^^R^IR^I^53.79^^^^^S
"IX",53.79,53.79,"AINFUSING",.1,0)
^^3^3^3120821^
"IX",53.79,53.79,"AINFUSING",.1,1,0)
Updates AINFUSING when DFN or admin date/time changes and Action Status 
"IX",53.79,53.79,"AINFUSING",.1,2,0)
is "I" for infusing or kill index when Action Status changes from "I" to 
"IX",53.79,53.79,"AINFUSING",.1,3,0)
anything.
"IX",53.79,53.79,"AINFUSING",1)
S ^PSB(53.79,"AINFUSING",X(1),X(2),DA)=""
"IX",53.79,53.79,"AINFUSING",1.4)
S X=0 I $P(^PSB(53.79,DA,0),U,9)="I",$P(^PSB(53.79,DA,0),U,10)]"" S X=1
"IX",53.79,53.79,"AINFUSING",2)
K ^PSB(53.79,"AINFUSING",X(1),X(2),DA)
"IX",53.79,53.79,"AINFUSING",2.4)
S X=0 I $P(^PSB(53.79,DA,0),U,9)'="I" S X=1
"IX",53.79,53.79,"AINFUSING",2.5)
K ^PSB(53.79,"AINFUSING")
"IX",53.79,53.79,"AINFUSING",11.1,0)
^.114IA^2^2
"IX",53.79,53.79,"AINFUSING",11.1,1,0)
1^F^53.79^.01^^1^F
"IX",53.79,53.79,"AINFUSING",11.1,2,0)
2^F^53.79^.06^^2^F
"IX",53.79,53.79,"AINJ",0)
53.79^AINJ^By patient, action date/time, & inject site^R^^R^IR^I^53.79^^^^^S
"IX",53.79,53.79,"AINJ",1)
S ^PSB(53.79,"AINJ",X(1),X(2),$E(X(3),1,30),DA)=""
"IX",53.79,53.79,"AINJ",2)
K ^PSB(53.79,"AINJ",X(1),X(2),$E(X(3),1,30),DA)
"IX",53.79,53.79,"AINJ",2.5)
K ^PSB(53.79,"AINJ")
"IX",53.79,53.79,"AINJ",11.1,0)
^.114IA^3^3
"IX",53.79,53.79,"AINJ",11.1,1,0)
1^F^53.79^.01^^1^F
"IX",53.79,53.79,"AINJ",11.1,2,0)
2^F^53.79^.06^^2^F
"IX",53.79,53.79,"AINJ",11.1,3,0)
3^F^53.79^.16^30^3^F
"IX",53.79,53.79,"AINJOI",0)
53.79^AINJOI^By patient, orderable item, action date/time, & inject site^R^^R^IR^I^53.79^^^^^S
"IX",53.79,53.79,"AINJOI",1)
S ^PSB(53.79,"AINJOI",X(1),X(2),X(3),$E(X(4),1,30),DA)=""
"IX",53.79,53.79,"AINJOI",2)
K ^PSB(53.79,"AINJOI",X(1),X(2),X(3),$E(X(4),1,30),DA)
"IX",53.79,53.79,"AINJOI",2.5)
K ^PSB(53.79,"AINJOI")
"IX",53.79,53.79,"AINJOI",11.1,0)
^.114IA^4^4
"IX",53.79,53.79,"AINJOI",11.1,1,0)
1^F^53.79^.01^^1^F
"IX",53.79,53.79,"AINJOI",11.1,2,0)
2^F^53.79^.08^^2^F
"IX",53.79,53.79,"AINJOI",11.1,3,0)
3^F^53.79^.06^^3^F
"IX",53.79,53.79,"AINJOI",11.1,4,0)
4^F^53.79^.16^30^4^F
"IX",53.79,53.79,"AORDX",0)
53.79^AORDX^DFN,ORDER NUMBER,ADMIN DATE/TIME^R^^R^IR^I^53.79^^^^^S
"IX",53.79,53.79,"AORDX",.1,0)
^^2^2^3001106^
"IX",53.79,53.79,"AORDX",.1,1,0)
Cross reference by; .01 PATIENT NAME; .11 ORDER REFERENCE NUMBER; and .06
"IX",53.79,53.79,"AORDX",.1,2,0)
ADMINISTRATION DATE/TIME.
"IX",53.79,53.79,"AORDX",1)
S ^PSB(53.79,"AORDX",$E(X(1),1,30),$E(X(2),1,15),$E(X(3),1,15),DA)=""
"IX",53.79,53.79,"AORDX",2)
K ^PSB(53.79,"AORDX",$E(X(1),1,30),$E(X(2),1,15),$E(X(3),1,15),DA)
"IX",53.79,53.79,"AORDX",2.5)
K ^PSB(53.79,"AORDX")
"IX",53.79,53.79,"AORDX",11.1,0)
^.114IA^3^3
"IX",53.79,53.79,"AORDX",11.1,1,0)
1^F^53.79^.01^30^1^F
"IX",53.79,53.79,"AORDX",11.1,2,0)
2^F^53.79^.11^15^2^F
"IX",53.79,53.79,"AORDX",11.1,3,0)
3^F^53.79^.06^15^3^F
"IX",53.79,53.79,"APATCH",0)
53.79^APATCH^Updates APATCH when DFN or admin date/time changes.^R^^F^IR^I^53.79^^^^^S
"IX",53.79,53.79,"APATCH",1)
S ^PSB(53.79,"APATCH",X(1),X(2),DA)=""
"IX",53.79,53.79,"APATCH",1.4)
S X=0 N I S I=0 F  S I=$O(^PSB(53.79,DA,.5,I)) Q:'I  I ($P($G(^(I,0)),U,4)="PATCH")&($P(^PSB(53.79,DA,0),U,9)="G") S X=1 Q
"IX",53.79,53.79,"APATCH",2)
K ^PSB(53.79,"APATCH",X(1),X(2),DA)
"IX",53.79,53.79,"APATCH",2.4)
S X=0 N I S I=0 F  S I=$O(^PSB(53.79,DA,.5,I)) Q:'I  I $P($G(^(I,0)),U,4)="PATCH" S X=1 Q
"IX",53.79,53.79,"APATCH",2.5)
K ^PSB(53.79,"APATCH")
"IX",53.79,53.79,"APATCH",11.1,0)
^.114IA^2^2
"IX",53.79,53.79,"APATCH",11.1,1,0)
1^F^53.79^.01^^1^F
"IX",53.79,53.79,"APATCH",11.1,2,0)
2^F^53.79^.06^^2^F
"IX",53.79,53.79,"ASTOPPED",0)
53.79^ASTOPPED^Index of IV's that are status Stopped.^R^^R^IR^I^53.79^^^^^S
"IX",53.79,53.79,"ASTOPPED",.1,0)
^^3^3^3120910^
"IX",53.79,53.79,"ASTOPPED",.1,1,0)
Updates ASTOPPED when DFN or admin date/time changes and Action Status  
"IX",53.79,53.79,"ASTOPPED",.1,2,0)
is "S" for stopped or kill index when Action Status changes from "S" to 
"IX",53.79,53.79,"ASTOPPED",.1,3,0)
anything else.
"IX",53.79,53.79,"ASTOPPED",1)
S ^PSB(53.79,"ASTOPPED",X(1),X(2),DA)=""
"IX",53.79,53.79,"ASTOPPED",1.4)
S X=0 I $P(^PSB(53.79,DA,0),U,9)="S",$P(^PSB(53.79,DA,0),U,10)]"" S X=1
"IX",53.79,53.79,"ASTOPPED",2)
K ^PSB(53.79,"ASTOPPED",X(1),X(2),DA)
"IX",53.79,53.79,"ASTOPPED",2.4)
S X=0 I $P(^PSB(53.79,DA,0),U,9)'="S" S X=1
"IX",53.79,53.79,"ASTOPPED",2.5)
K ^PSB(53.79,"ASTOPPED")
"IX",53.79,53.79,"ASTOPPED",11.1,0)
^.114IA^2^2
"IX",53.79,53.79,"ASTOPPED",11.1,1,0)
1^F^53.79^.01^^1^F
"IX",53.79,53.79,"ASTOPPED",11.1,1,3)

"IX",53.79,53.79,"ASTOPPED",11.1,2,0)
2^F^53.79^.06^^2^F
"IX",53.79,53.79,"ASTOPPED",11.1,2,3)

"IX",53.79,53.79,"AUID",0)
53.79^AUID^cross reference of dfn, order number, and unique id^R^^R^IR^I^53.79^^^^^S
"IX",53.79,53.79,"AUID",1)
S ^PSB(53.79,"AUID",X(1),$E(X(2),1,30),$E(X(3),1,30),DA)=""
"IX",53.79,53.79,"AUID",2)
K ^PSB(53.79,"AUID",X(1),$E(X(2),1,30),$E(X(3),1,30),DA)
"IX",53.79,53.79,"AUID",2.5)
K ^PSB(53.79,"AUID")
"IX",53.79,53.79,"AUID",11.1,0)
^.114IA^3^3
"IX",53.79,53.79,"AUID",11.1,1,0)
1^F^53.79^.01^^1^F
"IX",53.79,53.79,"AUID",11.1,1,3)

"IX",53.79,53.79,"AUID",11.1,2,0)
2^F^53.79^.11^30^2^F
"IX",53.79,53.79,"AUID",11.1,2,3)

"IX",53.79,53.79,"AUID",11.1,3,0)
3^F^53.79^.26^30^3^F
"IX",53.79,53.79,"AUID",11.1,3,3)

"KRN",.403,89,-1)
0^1
"KRN",.403,89,0)
PSB MISSING DOSE FOLLOWUP^^^^2990313.2347^^Missing Dose Followup^53.68^0^0^1
"KRN",.403,89,11)
S PSBSAVE=0
"KRN",.403,89,14)
S PSBSAVE=1
"KRN",.403,89,20)
D VAL^PSBMD(".21;.24;.17")
"KRN",.403,89,40,0)
^.4031I^1^1
"KRN",.403,89,40,1,0)
1^^1,1
"KRN",.403,89,40,1,1)
Page 1
"KRN",.403,89,40,1,40,0)
^.4032IP^311^2
"KRN",.403,89,40,1,40,307,0)
PSB MISSING DOSE HDR^1^1,1^d
"KRN",.403,89,40,1,40,311,0)
PSB MISSING DOSE FOLLOWUP^2^5,1^e
"KRN",.403,90,-1)
0^3
"KRN",.403,90,0)
PSBO BL^^^^2990318.1536^^^53.69^0^0^1
"KRN",.403,90,11)
S PSBSAVE=0
"KRN",.403,90,14)
S PSBSAVE=1
"KRN",.403,90,20)
D VAL^PSBO(".31;.36;.37;.06")
"KRN",.403,90,40,0)
^.4031I^1^1
"KRN",.403,90,40,1,0)
1^^1,1
"KRN",.403,90,40,1,1)
Page 1
"KRN",.403,90,40,1,40,0)
^.4032IP^312^3
"KRN",.403,90,40,1,40,301,0)
PSBO HDR^1^1,1^d
"KRN",.403,90,40,1,40,303,0)
PSBO FTR^3^15,1^e
"KRN",.403,90,40,1,40,312,0)
PSBO BL^2^3,1^e
"KRN",.403,91,-1)
0^2
"KRN",.403,91,0)
PSBO MD^^^^2990318.1618^^^53.69^0^0^1
"KRN",.403,91,11)
S PSBSAVE=0
"KRN",.403,91,14)
S PSBSAVE=1
"KRN",.403,91,20)
D VAL^PSBO(".16;.17;.18;.19")
"KRN",.403,91,40,0)
^.4031I^3^3
"KRN",.403,91,40,1,0)
1^^1,1
"KRN",.403,91,40,1,1)
Page 1
"KRN",.403,91,40,1,40,0)
^.4032IP^313^3
"KRN",.403,91,40,1,40,301,0)
PSBO HDR^1^1,1^d
"KRN",.403,91,40,1,40,303,0)
PSBO FTR^3^15,1^e
"KRN",.403,91,40,1,40,313,0)
PSBO MD^2^3,1^e
"KRN",.403,91,40,2,0)
2^^1,1
"KRN",.403,91,40,2,1)
Ward page
"KRN",.403,91,40,2,40,0)
^.4032IP^474^1
"KRN",.403,91,40,2,40,474,0)
PSBO WARD^1^8,5^e
"KRN",.403,91,40,3,0)
3^^1,1
"KRN",.403,91,40,3,1)
Clinic page
"KRN",.403,91,40,3,40,0)
^.4032IP^475^1
"KRN",.403,91,40,3,40,475,0)
PSBO CLINIC^1^8,5^e
"KRN",.404,301,0)
PSBO HDR^53.69^
"KRN",.404,301,40,0)
^.4044I^4^3
"KRN",.404,301,40,1,0)
1^!M^1
"KRN",.404,301,40,1,.1)
S Y="Request #: "_$P(^PSB(53.69,DA,0),U)
"KRN",.404,301,40,1,2)
^^1,1
"KRN",.404,301,40,3,0)
3^!M^1
"KRN",.404,301,40,3,.1)
S Y=$TR($J("",80)," ","-")
"KRN",.404,301,40,3,2)
^^2,1
"KRN",.404,301,40,4,0)
2^!M^1
"KRN",.404,301,40,4,.1)
S Y=$J($$GET1^DIQ(53.69,DA_",",.05),40)
"KRN",.404,301,40,4,2)
^^1,41
"KRN",.404,303,0)
PSBO FTR^53.69
"KRN",.404,303,40,0)
^.4044I^3^3
"KRN",.404,303,40,1,0)
1^Print to DEVICE^3
"KRN",.404,303,40,1,1)
.06
"KRN",.404,303,40,1,2)
1,58^22^1,41
"KRN",.404,303,40,1,3)
!M
"KRN",.404,303,40,1,3.1)
S Y=$$GET^XPAR("USR","PSB PRINTER USER DEFAULT",1,"E")
"KRN",.404,303,40,1,13)
D EN^XPAR("USR","PSB PRINTER USER DEFAULT",1,"`"_X)
"KRN",.404,303,40,2,0)
2^Queue To Run At^3
"KRN",.404,303,40,2,1)
.07
"KRN",.404,303,40,2,2)
2,58^17^2,41
"KRN",.404,303,40,2,3)
NOW
"KRN",.404,303,40,3,0)
3^Instructions: PF1-E Submit   PF1-Q Cancel   PF1-R Refresh   <Ret> Re-Edit^2
"KRN",.404,303,40,3,2)
2,79^1^3,1
"KRN",.404,303,40,3,10)
S DDSBR="1^2^1" ; Return to field 1 block 2
"KRN",.404,303,40,3,20)
F^^1:1
"KRN",.404,307,0)
PSB MISSING DOSE HDR^53.68^
"KRN",.404,307,40,0)
^.4044I^6^6
"KRN",.404,307,40,1,0)
1^!M^1
"KRN",.404,307,40,1,.1)
S Y="Request #: "_$$GET1^DIQ(53.68,DA_",",.01)
"KRN",.404,307,40,1,2)
^^1,1
"KRN",.404,307,40,2,0)
2^Missing Dose Request^1
"KRN",.404,307,40,2,2)
^^1,60
"KRN",.404,307,40,3,0)
3^!M^1
"KRN",.404,307,40,3,.1)
S Y=$TR($J("",80)," ","-")
"KRN",.404,307,40,3,2)
^^2,1
"KRN",.404,307,40,4,0)
4^Requesting User^3
"KRN",.404,307,40,4,1)
.03
"KRN",.404,307,40,4,2)
3,20^30^3,1
"KRN",.404,307,40,5,0)
5^Division^3
"KRN",.404,307,40,5,1)
.04
"KRN",.404,307,40,5,2)
3,62^18^3,52
"KRN",.404,307,40,6,0)
6^Request Date/Time^3
"KRN",.404,307,40,6,1)
.02
"KRN",.404,307,40,6,2)
4,20^17^4,1
"KRN",.404,311,0)
PSB MISSING DOSE FOLLOWUP^53.68
"KRN",.404,311,40,0)
^.4044I^10^10
"KRN",.404,311,40,1,0)
1^Patient Name^3
"KRN",.404,311,40,1,1)
.11
"KRN",.404,311,40,1,2)
2,17^30^2,1
"KRN",.404,311,40,1,4)
^^^1
"KRN",.404,311,40,2,0)
2^Ward^3
"KRN",.404,311,40,2,1)
.12
"KRN",.404,311,40,2,2)
4,17^30^4,11
"KRN",.404,311,40,2,4)
^^^1
"KRN",.404,311,40,3,0)
3^Drug Requested^3
"KRN",.404,311,40,3,1)
.13
"KRN",.404,311,40,3,2)
3,17^30^3,1
"KRN",.404,311,40,3,4)
^^^1
"KRN",.404,311,40,4,0)
6^Dose Delivered^3
"KRN",.404,311,40,4,1)
.21
"KRN",.404,311,40,4,2)
9,27^3^9,3
"KRN",.404,311,40,5,0)
7^Delivered By^3
"KRN",.404,311,40,5,1)
.22
"KRN",.404,311,40,5,2)
10,27^35^10,3
"KRN",.404,311,40,5,3)
!M
"KRN",.404,311,40,5,3.1)
S Y="`"_DUZ
"KRN",.404,311,40,6,0)
8^Delivery Date/Time^3
"KRN",.404,311,40,6,1)
.23
"KRN",.404,311,40,6,2)
11,27^17^11,3
"KRN",.404,311,40,7,0)
9^Pharmacy Reason Needed^3
"KRN",.404,311,40,7,1)
.24
"KRN",.404,311,40,7,2)
12,27^25^12,3
"KRN",.404,311,40,8,0)
5^***** Pharmacy Followup Information *****^1
"KRN",.404,311,40,8,2)
^^8,17
"KRN",.404,311,40,9,0)
4^Room/Bed^3
"KRN",.404,311,40,9,1)
.18
"KRN",.404,311,40,9,2)
5,17^15^5,7
"KRN",.404,311,40,9,4)
^^^1
"KRN",.404,311,40,10,0)
4.1^Clinic^3
"KRN",.404,311,40,10,1)
1
"KRN",.404,311,40,10,2)
6,17^30^6,9
"KRN",.404,311,40,10,4)
^^^1
"KRN",.404,312,0)
PSBO BL^53.69
"KRN",.404,312,40,0)
^.4044I^10^10
"KRN",.404,312,40,1,0)
1^Drug Name^3
"KRN",.404,312,40,1,1)
.31
"KRN",.404,312,40,1,2)
2,13^40^2,2
"KRN",.404,312,40,2,0)
2^Lot #^3
"KRN",.404,312,40,2,1)
.32
"KRN",.404,312,40,2,2)
3,19^15^3,12
"KRN",.404,312,40,3,0)
3^Expiration Date^3
"KRN",.404,312,40,3,1)
.33
"KRN",.404,312,40,3,2)
4,19^11^4,2
"KRN",.404,312,40,4,0)
4^Manufacturer^3
"KRN",.404,312,40,4,1)
.34
"KRN",.404,312,40,4,2)
5,19^30^5,5
"KRN",.404,312,40,5,0)
5^Quantity^3
"KRN",.404,312,40,5,1)
.35
"KRN",.404,312,40,5,2)
7,19^7^7,9
"KRN",.404,312,40,6,0)
6^Filled By^3
"KRN",.404,312,40,6,1)
.36
"KRN",.404,312,40,6,2)
8,19^5^8,8
"KRN",.404,312,40,7,0)
7^Checked By^3
"KRN",.404,312,40,7,1)
.37
"KRN",.404,312,40,7,2)
9,19^5^9,7
"KRN",.404,312,40,8,0)
8^# Labels^3
"KRN",.404,312,40,8,1)
.38
"KRN",.404,312,40,8,2)
10,19^7^10,9
"KRN",.404,312,40,8,3)
1
"KRN",.404,312,40,9,0)
9^Patient Name^3
"KRN",.404,312,40,9,1)
.12
"KRN",.404,312,40,9,2)
11,19^30^11,5
"KRN",.404,312,40,9,12)
D REFRESH^DDSUTL
"KRN",.404,312,40,10,0)
10^Dosage^3
"KRN",.404,312,40,10,1)
.39
"KRN",.404,312,40,10,2)
12,19^30^12,11
"KRN",.404,313,0)
PSBO MD^53.69
"KRN",.404,313,40,0)
^.4044I^6^6
"KRN",.404,313,40,1,0)
1^Start Date^3
"KRN",.404,313,40,1,1)
.16
"KRN",.404,313,40,1,2)
2,14^11^2,2
"KRN",.404,313,40,2,0)
2^At^3
"KRN",.404,313,40,2,1)
.17
"KRN",.404,313,40,2,2)
2,31^6^2,27
"KRN",.404,313,40,3,0)
3^Stop Date^3
"KRN",.404,313,40,3,1)
.18
"KRN",.404,313,40,3,2)
4,14^11^4,3
"KRN",.404,313,40,4,0)
4^At^3
"KRN",.404,313,40,4,1)
.19
"KRN",.404,313,40,4,2)
4,31^6^4,27
"KRN",.404,313,40,5,0)
5^Ward or Clinic?^2^^LOC
"KRN",.404,313,40,5,2)
6,31^1^6,14
"KRN",.404,313,40,5,10)
S DDSBR=$S(X="W":"1^1^2",1:"1^1^3")
"KRN",.404,313,40,5,11)
D PUT^DDSVAL(DIE,.DA,5,""),PUT^DDSVAL(DIE,.DA,.13,"")
"KRN",.404,313,40,5,12)
D PUT^DDSVAL(DIE,.DA,.11,X)
"KRN",.404,313,40,5,13)
S DDSBR=$S(X="W":"1^1^2",1:"1^1^3")
"KRN",.404,313,40,5,20)
S^^W:Ward;C:Clinic
"KRN",.404,313,40,6,0)
6^Location^4
"KRN",.404,313,40,6,2)
8,31^30^8,21
"KRN",.404,313,40,6,30)
S Y=$S({WARD}]"":{WARD},1:{CLINIC TO PRINT})
"KRN",.404,474,0)
PSBO WARD^53.69
"KRN",.404,474,40,0)
^.4044I^2^2
"KRN",.404,474,40,1,0)
1^Ward (leave null and Return for All)^3
"KRN",.404,474,40,1,1)
.13
"KRN",.404,474,40,1,2)
3,41^30^3,3
"KRN",.404,474,40,1,10)
S DDSBR="1^3^1"
"KRN",.404,474,40,1,14)
I Y="" S DDSERROR=1
"KRN",.404,474,40,2,0)
.5^Enter the Location to appear on this report.^1
"KRN",.404,474,40,2,2)
^^1,3
"KRN",.404,475,0)
PSBO CLINIC^53.69
"KRN",.404,475,40,0)
^.4044I^2^2
"KRN",.404,475,40,1,0)
1^Clinic (leave blank and Return for All)^3
"KRN",.404,475,40,1,1)
5
"KRN",.404,475,40,1,2)
3,42^30^3,1
"KRN",.404,475,40,1,10)
S DDSBR="1^3^1"
"KRN",.404,475,40,2,0)
.5^Enter the Location to appear on this report.^1
"KRN",.404,475,40,2,2)
^^1,1
"KRN",19,11586,-1)
0^1
"KRN",19,11586,0)
PSB GUI CONTEXT - USER^BCMA Client Context^^B^^^^^^^^
"KRN",19,11586,99)
59973,28281
"KRN",19,11586,99.1)
62775,59100
"KRN",19,11586,"RPC",0)
^19.05P^59^59
"KRN",19,11586,"RPC",2,0)
PSB FMDATE
"KRN",19,11586,"RPC",4,0)
PSB GETPRNS
"KRN",19,11586,"RPC",5,0)
PSB INSTRUCTOR
"KRN",19,11586,"RPC",7,0)
PSB MEDICATION HISTORY
"KRN",19,11586,"RPC",8,0)
PSB PARAMETER
"KRN",19,11586,"RPC",12,0)
PSB SCANMED
"KRN",19,11586,"RPC",13,0)
PSB SCANPT
"KRN",19,11586,"RPC",14,0)
PSB SERVER CLOCK VARIANCE
"KRN",19,11586,"RPC",15,0)
PSB SUBMIT MISSING DOSE
"KRN",19,11586,"RPC",16,0)
PSB TRANSACTION
"KRN",19,11586,"RPC",17,0)
PSB USERLOAD
"KRN",19,11586,"RPC",18,0)
PSB USERSAVE
"KRN",19,11586,"RPC",19,0)
PSB VALIDATE ESIG
"KRN",19,11586,"RPC",20,0)
PSB VALIDATE ORDER
"KRN",19,11586,"RPC",21,0)
PSB CHECK SERVER
"KRN",19,11586,"RPC",23,0)
DG SENSITIVE RECORD BULLETIN
"KRN",19,11586,"RPC",24,0)
DG SENSITIVE RECORD ACCESS
"KRN",19,11586,"RPC",26,0)
PSB GETORDERTAB
"KRN",19,11586,"RPC",27,0)
PSB GETIVPAR
"KRN",19,11586,"RPC",28,0)
PSB PUTIVPAR
"KRN",19,11586,"RPC",29,0)
PSB DEVICE
"KRN",19,11586,"RPC",30,0)
PSB IV ORDER HISTORY
"KRN",19,11586,"RPC",31,0)
PSB BAG DETAIL
"KRN",19,11586,"RPC",32,0)
PSB WARDLIST
"KRN",19,11586,"RPC",33,0)
PSB MAIL
"KRN",19,11586,"RPC",34,0)
PSB ALLERGY
"KRN",19,11586,"RPC",35,0)
PSB GETPROVIDER
"KRN",19,11586,"RPC",37,0)
PSB MOB DRUG LIST
"KRN",19,11586,"RPC",38,0)
PSB MAXDAYS
"KRN",19,11586,"RPC",39,0)
PSB NURS WARDLIST
"KRN",19,11586,"RPC",40,0)
PSB CPRS ORDER
"KRN",19,11586,"RPC",41,0)
ORWUBCMA USERINFO
"KRN",19,11586,"RPC",43,0)
ORBCMA5 GETUDID
"KRN",19,11586,"RPC",44,0)
ORBCMA5 GETIVID
"KRN",19,11586,"RPC",45,0)
PSB VERSION CHECK
"KRN",19,11586,"RPC",46,0)
PSB CHECK IV
"KRN",19,11586,"RPC",47,0)
PSB VITALS
"KRN",19,11586,"RPC",48,0)
PSB VITAL MEAS FILE
"KRN",19,11586,"RPC",49,0)
PSB MED LOG LOOKUP
"KRN",19,11586,"RPC",50,0)
PSB COVERSHEET1
"KRN",19,11586,"RPC",51,0)
PSB UTL XSTATUS SRCH
"KRN",19,11586,"RPC",52,0)
PSB MAN SCAN FAILURE
"KRN",19,11586,"RPC",55,0)
PSB REPORT
"KRN",19,11586,"RPC",56,0)
PSB GETINJECTIONSITE
"KRN",19,11586,"RPC",57,0)
PSB CLINICLIST
"KRN",19,11586,"RPC",58,0)
PSB WITNESS
"KRN",19,11586,"RPC",59,0)
PSB MEDS ON PATIENT
"KRN",19,11586,"U")
BCMA CLIENT CONTEXT
"KRN",19,11588,-1)
0^3
"KRN",19,11588,0)
PSBO DL^Due List (INPATIENT ONLY)^^R^^^^^^^^BAR CODE MED ADMIN
"KRN",19,11588,25)
XQ^PSBO("DL")
"KRN",19,11588,"U")
DUE LIST (INPATIENT ONLY)
"KRN",19,11591,-1)
0^4
"KRN",19,11591,0)
PSBO MM^Missed Medications (INPATIENT ONLY)^^R^^^^^^^^BAR CODE MED ADMIN
"KRN",19,11591,25)
XQ^PSBO("MM")
"KRN",19,11591,"U")
MISSED MEDICATIONS (INPATIENT 
"KRN",19,11593,-1)
0^5
"KRN",19,11593,0)
PSBO WA^Ward Administration Times (INPATIENT ONLY)^^R^^^^^^^^BAR CODE MED ADMIN
"KRN",19,11593,25)
XQ^PSBO("WA")
"KRN",19,11593,"U")
WARD ADMINISTRATION TIMES (INP
"KRN",19,14187,-1)
1^2
"KRN",19,14187,0)
PSB MISSING DOSE REQUEST
"KRN",19.1,651,-1)
0^1
"KRN",19.1,651,0)
PSB NO WITNESS^Can't witness HR/HA drugs
"KRN",19.1,681,-1)
1^2
"KRN",19.1,681,0)
PSB UAP
"KRN",8989.51,34,0)
PSB VDL INCL ON-CALL^Include On Call Meds^0^^INCLUDE ON CALL MEDS ON DUE LIST^0
"KRN",8989.51,34,1)
Y^^Enter 'Y' to have On-Call Meds included in the initial VDL
"KRN",8989.51,34,20,0)
^8989.512^2^2^3030509^^
"KRN",8989.51,34,20,1,0)
Determines wether initial Due List View contains On Call
"KRN",8989.51,34,20,2,0)
medications.
"KRN",8989.51,34,30,0)
^8989.513I^1^1
"KRN",8989.51,34,30,1,0)
1^4
"KRN",8989.51,35,0)
PSB ONLINE^Is BCMA System On-Line^0^^IS BCMA ON-LINE^0
"KRN",8989.51,35,1)
Y
"KRN",8989.51,35,20,0)
^8989.512^2^2^3080416^^^^
"KRN",8989.51,35,20,1,0)
Used by the M Server and/or Application GUI Server administrator to 
"KRN",8989.51,35,20,2,0)
flag all client BCMA processes to stop.
"KRN",8989.51,35,30,0)
^8989.513I^1^1
"KRN",8989.51,35,30,1,0)
1^4
"KRN",8989.51,36,0)
PSB VDL START TIME^Default hours prior to NOW for the VDL^0^^HOURS PRIOR TO NOW FOR VDL^0
"KRN",8989.51,36,1)
N^0:24:0^Enter the number of hours prior to NOW that the VDL will initially display
"KRN",8989.51,36,20,0)
^^2^2^2990323^
"KRN",8989.51,36,20,1,0)
Default number of hours prior to NOW that the VDL will display when 
"KRN",8989.51,36,20,2,0)
initially displayed.
"KRN",8989.51,36,30,0)
^8989.513I^2^2
"KRN",8989.51,36,30,1,0)
1^200
"KRN",8989.51,36,30,2,0)
2^4
"KRN",8989.51,37,0)
PSB VDL INCL CONT^Include Continuous Meds^0^^INCLUDE CONTINUOUS MEDS ON DUE LIST^0
"KRN",8989.51,37,1)
Y^^Enter 'Y' to have Continuous Meds included in the initial VDL
"KRN",8989.51,37,20,0)
^8989.512^2^2^3030509^^
"KRN",8989.51,37,20,1,0)
Determines wheter initial Due List View contains continuous 
"KRN",8989.51,37,20,2,0)
medications.
"KRN",8989.51,37,30,0)
^8989.513I^1^1
"KRN",8989.51,37,30,1,0)
1^4
"KRN",8989.51,39,0)
PSB ROBOT RX^Using Robot RX^0^^USING ROBOT RX^0
"KRN",8989.51,39,1)
Y
"KRN",8989.51,39,20,0)
^8989.512^1^1^3010726^^^
"KRN",8989.51,39,20,1,0)
Parameter should be "yes" if site is using the robot RX.
"KRN",8989.51,39,30,0)
^8989.513I^1^1
"KRN",8989.51,39,30,1,0)
1^4
"KRN",8989.51,49,0)
PSB AUTOUPDATE SERVER^The UNC of the Auto-update Server^0^^UNC OF THE AUTOUPDATE SERVER
"KRN",8989.51,49,1)
F^0:50^Enter a Microsoft UNC for server
"KRN",8989.51,49,20,0)
^8989.512^2^2^3000726^^
"KRN",8989.51,49,20,1,0)
The Microsoft UNC path to the BCMA autoupdate server that will contain
"KRN",8989.51,49,20,2,0)
the source files for the update.
"KRN",8989.51,49,30,0)
^8989.513I^1^1
"KRN",8989.51,49,30,1,0)
1^4
"KRN",8989.51,87,0)
PSB MG AUTOUPDATE^Autoupdate Notification Mail Group^0^^AUTOUPDATE NOTIFICATION MAIL GROUP^0
"KRN",8989.51,87,1)
P^3.8
"KRN",8989.51,87,20,0)
^8989.512^1^1^3000712^
"KRN",8989.51,87,20,1,0)
Mailgroup to notify when updates or update errors occur.
"KRN",8989.51,87,30,0)
^8989.513I^1^1
"KRN",8989.51,87,30,1,0)
1^4
"KRN",8989.51,264,0)
PSB VDL STOP TIME^Default hours after NOW for the VDL^0^zzinstance^HOURS AFTER NOW FOR VDL^0
"KRN",8989.51,264,1)
N^0:24:0^Enter the number of hours after NOW that the VDL will initially display
"KRN",8989.51,264,20,0)
^^2^2^2990323^
"KRN",8989.51,264,20,1,0)
Default number of hours after NOW that the VDL will display when 
"KRN",8989.51,264,20,2,0)
initially displayed.
"KRN",8989.51,264,30,0)
^8989.513I^2^2
"KRN",8989.51,264,30,1,0)
1^200
"KRN",8989.51,264,30,2,0)
2^4
"KRN",8989.51,266,0)
PSB VDL INCL PRN^Include PRN Meds^0^^INCLUDE PRN MEDS ON DUE LIST^0
"KRN",8989.51,266,1)
Y^^Enter 'Y' to have PRN Meds included in the initial VDL
"KRN",8989.51,266,20,0)
^8989.512^1^1^3030509^^^^
"KRN",8989.51,266,20,1,0)
Determines wether initial Due List View contains PRN medications.
"KRN",8989.51,266,30,0)
^8989.513I^3^1
"KRN",8989.51,266,30,3,0)
1^4
"KRN",8989.51,267,0)
PSB VDL INCL ONE-TIME^Include One-Time Meds^0^^INCLUDE ONE-TIME MEDS ON DUE LIST^0
"KRN",8989.51,267,1)
Y^^Enter 'Y' to have One-Time Meds included in the initial VDL
"KRN",8989.51,267,20,0)
^8989.512^2^2^3030509^^
"KRN",8989.51,267,20,1,0)
Determines wether initial Due List View contains One-Time
"KRN",8989.51,267,20,2,0)
medications.
"KRN",8989.51,267,30,0)
^8989.513I^1^1
"KRN",8989.51,267,30,1,0)
1^4
"KRN",8989.51,271,0)
PSB MG DUE LIST ERROR^Due List Error Notification Mail Group^0^^DUE LIST ERRORS MAIL GROUP^0
"KRN",8989.51,271,1)
P^3.8
"KRN",8989.51,271,20,0)
^8989.512^2^2^3060607^^^^
"KRN",8989.51,271,20,1,0)
Mailgroup to notify when an order is unable to be validated and placed 
"KRN",8989.51,271,20,2,0)
on the Due List.
"KRN",8989.51,271,30,0)
^8989.513I^1^1
"KRN",8989.51,271,30,1,0)
1^4
"KRN",8989.51,272,0)
PSB ADMIN ESIG^Require E-Sig to Administer^0^^REQUIRE ESIG TO ADMINISTER^0
"KRN",8989.51,272,1)
Y
"KRN",8989.51,272,20,0)
^^2^2^2990323^^^^
"KRN",8989.51,272,20,1,0)
Determines if a user must supply their electronic signature code prior 
"KRN",8989.51,272,20,2,0)
to administering any medications.
"KRN",8989.51,272,30,0)
^8989.513I^1^1
"KRN",8989.51,272,30,1,0)
1^4
"KRN",8989.51,273,0)
PSB ADMIN BEFORE^Allowed Mins Before Sched Admin^0^^ALLOWED MINS BEFORE SCHED TIME
"KRN",8989.51,273,1)
N^10:240:0^enter a number between 10-240 on even ten minute increments.
"KRN",8989.51,273,2)
K:X#10 X
"KRN",8989.51,273,20,0)
^^2^2^2990325^^
"KRN",8989.51,273,20,1,0)
This parameter contains the number of minutes before a scheduled 
"KRN",8989.51,273,20,2,0)
administration time is allowed without filing a variance.
"KRN",8989.51,273,30,0)
^8989.513I^1^1
"KRN",8989.51,273,30,1,0)
1^4
"KRN",8989.51,274,0)
PSB ADMIN AFTER^Allowed Mins After Sched Admin^0^^ALLOWED MINS AFTER SCHED TIME
"KRN",8989.51,274,1)
N^10:240:0^enter a number between 10-240 on even ten minute increments.
"KRN",8989.51,274,2)
K:X#10 X
"KRN",8989.51,274,20,0)
^8989.512^2^2^3021114^^^^
"KRN",8989.51,274,20,1,0)
This parameter contains the number of minutes after a scheduled 
"KRN",8989.51,274,20,2,0)
administration time is allowed without filing a variance.
"KRN",8989.51,274,30,0)
^8989.513I^1^1
"KRN",8989.51,274,30,1,0)
1^4
"KRN",8989.51,275,0)
PSB ADMIN PRN EFFECT^Allowed Mins to Enter PRN Effect^0^^ALLOWED MINS FOR PRN EFFECT
"KRN",8989.51,275,1)
N^10:960:0^enter a number between 10-960 on even ten minute increments.
"KRN",8989.51,275,2)
K:X#10 X
"KRN",8989.51,275,20,0)
^8989.512^2^2^3110307^^
"KRN",8989.51,275,20,1,0)
The number of minutes allowed to elapse between PRN administration and 
"KRN",8989.51,275,20,2,0)
entry of PRN Effectiveness.
"KRN",8989.51,275,30,0)
^8989.513I^1^1
"KRN",8989.51,275,30,1,0)
1^4
"KRN",8989.51,276,0)
PSB HFS SCRATCH^Scratch HFS Directory^0^^SCRATCH HFS DIRECTORY^0
"KRN",8989.51,276,1)
F^1:50^Enter a valid HFS Directory Name
"KRN",8989.51,276,20,0)
^^2^2^2990323^
"KRN",8989.51,276,20,1,0)
Name of an HFS directory that all BCMA processes will be able to 
"KRN",8989.51,276,20,2,0)
access through ^%ZISH for printing documents.
"KRN",8989.51,276,30,0)
^8989.513I^1^1
"KRN",8989.51,276,30,1,0)
1^4
"KRN",8989.51,278,0)
PSB MG SYSTEM ERROR^System Error Notification Mail Group^0^^SYSTEM ERRORS MAIL GROUP^0
"KRN",8989.51,278,1)
P^3.8
"KRN",8989.51,278,20,0)
^^2^2^2990323^
"KRN",8989.51,278,20,1,0)
Mailgroup to notify when an unexplained error occurs with the 
"KRN",8989.51,278,20,2,0)
software.
"KRN",8989.51,278,30,0)
^8989.513I^1^1
"KRN",8989.51,278,30,1,0)
1^4
"KRN",8989.51,279,0)
PSB MG MISSING DOSE^Missing Dose Notification Mail Group^0^^MISSING DOSE MAIL GROUP^0
"KRN",8989.51,279,1)
P^3.8
"KRN",8989.51,279,20,0)
^8989.512^1^1^3060607^^
"KRN",8989.51,279,20,1,0)
Mailgroup to notify when a missing dose is requested.
"KRN",8989.51,279,30,0)
^8989.513I^2^2
"KRN",8989.51,279,30,1,0)
1^44
"KRN",8989.51,279,30,2,0)
2^4
"KRN",8989.51,281,0)
PSB ADMIN MULTIPLE ONCALL^Allow Multi Admin On-Call^0^^ALLOW MULTIPLE ON CALL ADMINS^0
"KRN",8989.51,281,1)
Y
"KRN",8989.51,281,20,0)
^^2^2^2990323^^^
"KRN",8989.51,281,20,1,0)
Determines if this Division will allow multiple administrations against an
"KRN",8989.51,281,20,2,0)
On-Call order.
"KRN",8989.51,281,30,0)
^8989.513I^1^1
"KRN",8989.51,281,30,1,0)
1^4
"KRN",8989.51,282,0)
PSB PRINTER MISSING DOSE^Missing Dose Printer^0^Printer DEVICE^MISSING DOSE PRINTER^0
"KRN",8989.51,282,1)
P^3.5
"KRN",8989.51,282,6)
^^
"KRN",8989.51,282,20,0)
^^2^2^3120820^
"KRN",8989.51,282,20,1,0)
Device to print to when a missing dose is requested for an Inpatient 
"KRN",8989.51,282,20,2,0)
Medications Order.
"KRN",8989.51,282,30,0)
^8989.513I^2^2
"KRN",8989.51,282,30,1,0)
1^44
"KRN",8989.51,282,30,2,0)
2^4
"KRN",8989.51,283,0)
PSB VDL INCL IV MEDS^Include IV Med Orders^0^^INCLUDE IV MEDS ON DUE LIST^0
"KRN",8989.51,283,1)
Y^^Enter 'Y' to have IV Order Meds included in the initial VDL
"KRN",8989.51,283,20,0)
^^1^1^2990323^
"KRN",8989.51,283,20,1,0)
Determines wether initial Due List View contains IV Medications.
"KRN",8989.51,283,30,0)
^8989.513I^2^2
"KRN",8989.51,283,30,1,0)
1^200
"KRN",8989.51,283,30,2,0)
2^4
"KRN",8989.51,284,0)
PSB VDL INCL UD MEDS^Include Unit Dose Med Orders^0^^INCLUDE UNIT DOSE MEDS ON DUE LIST^0
"KRN",8989.51,284,1)
Y^^Enter 'Y' to have Unit Dose Meds included in the initial VDL
"KRN",8989.51,284,20,0)
^^2^2^2990323^
"KRN",8989.51,284,20,1,0)
Determines wether initial Due List View contains Unit Dose
"KRN",8989.51,284,20,2,0)
medications.
"KRN",8989.51,284,30,0)
^8989.513I^2^2
"KRN",8989.51,284,30,1,0)
1^200
"KRN",8989.51,284,30,2,0)
2^4
"KRN",8989.51,285,0)
PSB VDL INCL BLANKS^Include Blank Addendums at end^0^^INCLUDE BLANKS ADDENDUMS ON DUE LIST^0
"KRN",8989.51,285,1)
Y^^Enter 'Y' to have Addendums print at end of DL
"KRN",8989.51,285,20,0)
^^2^2^2990323^
"KRN",8989.51,285,20,1,0)
Used to flag wether or not to print the blank order requests at the 
"KRN",8989.51,285,20,2,0)
bottom of the printed DUE LIST.
"KRN",8989.51,285,30,0)
^8989.513I^2^2
"KRN",8989.51,285,30,1,0)
1^200
"KRN",8989.51,285,30,2,0)
2^4
"KRN",8989.51,287,0)
PSB SERVER CLOCK VARIANCE^Allowable client-server time variance^0^^ALLOWABLE SERVER CLOCK VARIANCE
"KRN",8989.51,287,1)
N^0:30:0^Enter a number between 0 and 30
"KRN",8989.51,287,20,0)
^^3^3^2990323^
"KRN",8989.51,287,20,1,0)
Used by the client at application startup to ensure that the client 
"KRN",8989.51,287,20,2,0)
clock is within a predetermined number of minutes of the server time 
"KRN",8989.51,287,20,3,0)
before allowing the client to proceed.
"KRN",8989.51,287,30,0)
^8989.513I^1^1
"KRN",8989.51,287,30,1,0)
1^4
"KRN",8989.51,547,0)
PSB PATIENT ID LABEL^Patient ID Display Label^0^^PSB PATIENT ID LABEL
"KRN",8989.51,547,1)
F^0:5
"KRN",8989.51,547,30,0)
^8989.513I^2^2
"KRN",8989.51,547,30,1,0)
800^4.2
"KRN",8989.51,547,30,2,0)
700^4
"KRN",8989.51,552,0)
PSB NON-NURSE VERIFIED PROMPT^Non-Nurse Verified Prompt action^0^^PSB NON-NURSE VERIFIED PROMPT
"KRN",8989.51,552,1)
S^1:N-Allow Admin (No Warning);2:W-Allow Admin after Warning;3:P-Prohibit Administration
"KRN",8989.51,552,2)

"KRN",8989.51,552,30,0)
^8989.513I^1^1
"KRN",8989.51,552,30,1,0)
700^4
"KRN",8989.51,637,0)
PSB INJECTION SITE MAX HOURS^Last Injection Site Max Hours^0^^PSB INJECTION SITE MAX HOURS
"KRN",8989.51,637,1)
N^1:72^Enter a number of hours (1-72)
"KRN",8989.51,637,20,0)
^8989.512^2^2^3111107^^
"KRN",8989.51,637,20,1,0)
This will store the number of hours for the Last Injection Site Timeframe 
"KRN",8989.51,637,20,2,0)
on the BCMA Site Parameters screen.
"KRN",8989.51,637,30,0)
^8989.513I^2^2
"KRN",8989.51,637,30,1,0)
800^4.2
"KRN",8989.51,637,30,2,0)
700^4
"KRN",8989.51,690,-1)
0^1
"KRN",8989.51,690,0)
PSB PRINTER CO MISSING DOSE^Clinic Order Missing Dose Printer^0^Printer DEVICE^CO MISSING DOSE PRINTER
"KRN",8989.51,690,1)
P^3.5
"KRN",8989.51,690,20,0)
^^2^2^3120817^
"KRN",8989.51,690,20,1,0)
Device to print to when a missing dose is requested for a Clinic Order 
"KRN",8989.51,690,20,2,0)
medication.
"KRN",8989.51,690,30,0)
^8989.513I^2^2
"KRN",8989.51,690,30,1,0)
1^44
"KRN",8989.51,690,30,2,0)
2^4
"KRN",8989.51,4649,0)
PSB DEFAULT BARCODE FORMAT^Default Bar Code Format^0^DEFAULT BARCODE FORMAT^DEFAULT BARCODE FORMAT^0
"KRN",8989.51,4649,1)
S^1:C39;2:128;3:I25
"KRN",8989.51,4649,20,0)
^^1^1^2990731^^^
"KRN",8989.51,4649,20,1,0)
Select the desired bar code format to produce on the Zebra Label Printer.
"KRN",8989.51,4649,30,0)
^8989.513I^1^1
"KRN",8989.51,4649,30,1,0)
1^4
"KRN",8989.51,4659,0)
PSB DEFAULT BARCODE PREFIX^Default Barcode Prefix^0^^DEFAULT BARCODE PREFIX
"KRN",8989.51,4659,1)
F^0:5^Will accept a null or up to 5 alphanumeric characters.
"KRN",8989.51,4659,20,0)
^8989.512^1^1^3021024^^^^
"KRN",8989.51,4659,20,1,0)
Text to prefix when printing a label on the Zebra Barcode Printer.
"KRN",8989.51,4659,30,0)
^8989.513I^1^1
"KRN",8989.51,4659,30,1,0)
1^4
"KRN",8989.51,4693,0)
PSBIV PROVIDER COMMENTS^IV Provider Comments^1^IV Type^IV Provider Comments^0
"KRN",8989.51,4693,1)
S^1:W-Display Warning Message;2:N-NO Warning Message;3:I-Invalid IV Bag
"KRN",8989.51,4693,2)
I X=1!(X=2) W !!?5,"The recommended response for this parameter is 3  I-Invalid IV Bag.",!
"KRN",8989.51,4693,6)
S^1:A;2:P;3:H;4:S;5:C
"KRN",8989.51,4693,30,0)
^8989.513I^1^1
"KRN",8989.51,4693,30,1,0)
1^4
"KRN",8989.52,38,-1)
0^1
"KRN",8989.52,38,0)
PSB DIVISION^BCMA Divisional Parameters^4^
"KRN",8989.52,38,10,0)
^8989.521IA^36^30
"KRN",8989.52,38,10,1,0)
1^PSB ONLINE
"KRN",8989.52,38,10,6,0)
6^PSB ADMIN AFTER
"KRN",8989.52,38,10,7,0)
7^PSB ADMIN BEFORE
"KRN",8989.52,38,10,8,0)
8^PSB ADMIN ESIG
"KRN",8989.52,38,10,9,0)
9^PSB ADMIN MULTIPLE ONCALL
"KRN",8989.52,38,10,10,0)
10^PSB ADMIN PRN EFFECT
"KRN",8989.52,38,10,12,0)
12^PSB HFS SCRATCH
"KRN",8989.52,38,10,13,0)
13^PSB MG DUE LIST ERROR
"KRN",8989.52,38,10,14,0)
14^PSB MG MISSING DOSE
"KRN",8989.52,38,10,15,0)
15^PSB MG SYSTEM ERROR
"KRN",8989.52,38,10,16,0)
16^PSB PRINTER MISSING DOSE
"KRN",8989.52,38,10,17,0)
17^PSB SERVER CLOCK VARIANCE
"KRN",8989.52,38,10,18,0)
18^PSB VDL INCL BLANKS
"KRN",8989.52,38,10,19,0)
19^PSB VDL INCL CONT
"KRN",8989.52,38,10,20,0)
20^PSB VDL INCL IV MEDS
"KRN",8989.52,38,10,21,0)
21^PSB VDL INCL ON-CALL
"KRN",8989.52,38,10,22,0)
22^PSB VDL INCL ONE-TIME
"KRN",8989.52,38,10,23,0)
23^PSB VDL INCL PRN
"KRN",8989.52,38,10,24,0)
24^PSB VDL INCL UD MEDS
"KRN",8989.52,38,10,25,0)
25^PSB VDL START TIME
"KRN",8989.52,38,10,26,0)
26^PSB VDL STOP TIME
"KRN",8989.52,38,10,27,0)
2^PSB DEFAULT BARCODE FORMAT
"KRN",8989.52,38,10,28,0)
3^PSB DEFAULT BARCODE PREFIX
"KRN",8989.52,38,10,29,0)
4^PSB ROBOT RX
"KRN",8989.52,38,10,30,0)
27^PSB AUTOUPDATE SERVER
"KRN",8989.52,38,10,31,0)
28^PSB MG AUTOUPDATE
"KRN",8989.52,38,10,32,0)
29^PSBIV PROVIDER COMMENTS
"KRN",8989.52,38,10,33,0)
30^PSB PATIENT ID LABEL
"KRN",8989.52,38,10,34,0)
31^PSB NON-NURSE VERIFIED PROMPT
"KRN",8989.52,38,10,35,0)
32^PSB INJECTION SITE MAX HOURS
"KRN",8989.52,38,10,36,0)
16.1^PSB PRINTER CO MISSING DOSE
"KRN",8994,680,-1)
0^5
"KRN",8994,680,0)
PSB USERLOAD^USRLOAD^PSBRPC^2^S^^^^3
"KRN",8994,680,1,0)
^8994.01^3^3^3121126^^^^
"KRN",8994,680,1,1,0)
This RPC is called at application startup to populate the BCMA_User 
"KRN",8994,680,1,2,0)
object with the users defaults.  No parameters are passed, the current 
"KRN",8994,680,1,3,0)
DUZ is assumed.
"KRN",8994,680,2,0)
^8994.02A
"KRN",8994,680,3,0)
^^47^47^3121126^
"KRN",8994,680,3,1,0)
(0) = -1^Error Description
"KRN",8994,680,3,2,0)
 
"KRN",8994,680,3,3,0)
or
"KRN",8994,680,3,4,0)
 
"KRN",8994,680,3,5,0)
(0) = DUZ
"KRN",8994,680,3,6,0)
(1) = User name
"KRN",8994,680,3,7,0)
(2) = Student Key Flag
"KRN",8994,680,3,8,0)
(3) = Manager Key flag
"KRN",8994,680,3,9,0)
(4) = CPRS Med Order Button Key Flag     
"KRN",8994,680,3,10,0)
(5) = Window settings
"KRN",8994,680,3,11,0)
      Window Left
"KRN",8994,680,3,12,0)
      Window Height
"KRN",8994,680,3,13,0)
      Window Top
"KRN",8994,680,3,14,0)
      Window Width
"KRN",8994,680,3,15,0)
(6) = Virtual Due List Setup
"KRN",8994,680,3,16,0)
(7) = Division number ^ Site ID ^ (if production system "1", if test 
"KRN",8994,680,3,17,0)
      system "0")
"KRN",8994,680,3,18,0)
(8) = Division name
"KRN",8994,680,3,19,0)
(9) = ESIG flag 
"KRN",8994,680,3,20,0)
(10) = BCMA Online flag
"KRN",8994,680,3,21,0)
(11) = Time      
"KRN",8994,680,3,22,0)
(12) = Unit Dose column widths
"KRN",8994,680,3,23,0)
(13) = Check digit
"KRN",8994,680,3,24,0)
(14) = IVPB column widths
"KRN",8994,680,3,25,0)
(15) = IV column widths
"KRN",8994,680,3,26,0)
(16) = Printer user default IEN
"KRN",8994,680,3,27,0)
(17) = Printer user default IEN^Name
"KRN",8994,680,3,28,0)
(18) = Read Only Security Key flag
"KRN",8994,680,3,29,0)
(19) = User's preference per Coversheet Views' column sort
"KRN",8994,680,3,30,0)
       Medication Overview sort col #_ /
"KRN",8994,680,3,31,0)
       PRN Overview sort col #_ /
"KRN",8994,680,3,32,0)
       IV Overview sort col #_ /
"KRN",8994,680,3,33,0)
       Expired/Expiring sort col #
"KRN",8994,680,3,34,0)
(20) = User's preference per Coversheet View1 columns' widths
"KRN",8994,680,3,35,0)
(21) = User's preference per Coversheet View2 columns' widths
"KRN",8994,680,3,36,0)
(22) = User's preference per Coversheet View3 columns' widths
"KRN",8994,680,3,37,0)
(23) = User's preference per Coversheet View4 columns' widths
"KRN",8994,680,3,38,0)
(24) = BCMA Managing Scanning Failure Security Flag ( 1 if user holds
"KRN",8994,680,3,39,0)
       BCMA MSF key, 0 if not )
"KRN",8994,680,3,40,0)
(25) = 5 Rights Override/Unit Dose Administration Flag (0 = no override, 
"KRN",8994,680,3,41,0)
       1 = override)  [PSB FR UNIT DOSE OVERRIDE]
"KRN",8994,680,3,42,0)
(26) = 5 Rights Override/IV Administration Flag (0 = no override, 1 = 
"KRN",8994,680,3,43,0)
       override)  [PSB FR IV OVERRIDE]
"KRN",8994,680,3,44,0)
(27) = Agency Code, eg. V = VA, I = IHS
"KRN",8994,680,3,45,0)
(28) = Order Mode last, eg. 0 = Inpatient Order, 1 = Clinc Order
"KRN",8994,680,3,46,0)
(29) = Last Clinic Search text, delimited string by "/" (prefix 
"KRN",8994,680,3,47,0)
       text / contains text).   e.g. AL-BLUE TEAM / CARDIAC
"KRN",8994,681,-1)
0^6
"KRN",8994,681,0)
PSB USERSAVE^USRSAVE^PSBRPC^2^^^^^2
"KRN",8994,681,1,0)
^8994.01^1^1^3010910^^^
"KRN",8994,681,1,1,0)
Save the users current window settings for the next session.
"KRN",8994,681,2,0)
^8994.02A^14^13
"KRN",8994,681,2,1,0)
PSBWIN^1^30^1^1
"KRN",8994,681,2,1,1,0)
^8994.021^6^6^3010910^^^^
"KRN",8994,681,2,1,1,1,0)
Contains the current window settings so that the next time the user 
"KRN",8994,681,2,1,1,2,0)
activates the application the window will reappear in the same format.
"KRN",8994,681,2,1,1,3,0)
 
"KRN",8994,681,2,1,1,4,0)
Data is in the following format:
"KRN",8994,681,2,1,1,5,0)
 
"KRN",8994,681,2,1,1,6,0)
   Window Top;Window Left;Window Height;Window Width;Window State
"KRN",8994,681,2,2,0)
PSBVDL^1^^1^2
"KRN",8994,681,2,2,1,0)
^^1^1^3010910^
"KRN",8994,681,2,2,1,1,0)
VDL settings
"KRN",8994,681,2,3,0)
PSBUDCW ^1^^1^3
"KRN",8994,681,2,3,1,0)
^^1^1^3010910^
"KRN",8994,681,2,3,1,1,0)
UD tab column settings
"KRN",8994,681,2,4,0)
PSBPBCW^1^^1^4
"KRN",8994,681,2,4,1,0)
^^1^1^3010910^
"KRN",8994,681,2,4,1,1,0)
PB tab column settings 
"KRN",8994,681,2,5,0)
PSBIVCW^1^^1^5
"KRN",8994,681,2,5,1,0)
^^1^1^3010910^
"KRN",8994,681,2,5,1,1,0)
IV tab column settings   
"KRN",8994,681,2,6,0)
PSBDEV^1^^1^6
"KRN",8994,681,2,6,1,0)
^^1^1^3010910^
"KRN",8994,681,2,6,1,1,0)
Last print device used.
"KRN",8994,681,2,7,0)
PSBCSRT^1^^^7
"KRN",8994,681,2,8,0)
PSBCV1^1^^^8
"KRN",8994,681,2,9,0)
PSBCV2^1^^^9
"KRN",8994,681,2,10,0)
PSBCV3^1^^^10
"KRN",8994,681,2,11,0)
PSBCV4^1^^^11
"KRN",8994,681,2,13,0)
PSBORMODE^1^^^12
"KRN",8994,681,2,13,1,0)
^^8^8^3120626^
"KRN",8994,681,2,13,1,1,0)
Last Order mode per user upon exit of BCMA.
"KRN",8994,681,2,13,1,2,0)
 
"KRN",8994,681,2,13,1,3,0)
This parameter is for the last Order Mode the user was using upon exiting 
"KRN",8994,681,2,13,1,4,0)
BCMA.  
"KRN",8994,681,2,13,1,5,0)
 
"KRN",8994,681,2,13,1,6,0)
Value
"KRN",8994,681,2,13,1,7,0)
  0    Inpatient order mode
"KRN",8994,681,2,13,1,8,0)
  1    Clinic order mdoe
"KRN",8994,681,2,14,0)
PSBCLSRCH^1^^^13
"KRN",8994,681,2,14,1,0)
^^7^7^3121126^
"KRN",8994,681,2,14,1,1,0)
Last Clinic Search text criteria entered per user.  
"KRN",8994,681,2,14,1,2,0)
This parameter contains two pieces of data delimited by a "/".  First 
"KRN",8994,681,2,14,1,3,0)
piece of data is the Clinic name search Prefix text and the second is the 
"KRN",8994,681,2,14,1,4,0)
Clinic name contains search text.
"KRN",8994,681,2,14,1,5,0)
 
"KRN",8994,681,2,14,1,6,0)
Example:
"KRN",8994,681,2,14,1,7,0)
 AL-BLUE TEAM/CARDIAC
"KRN",8994,681,2,"B","PSBCLSRCH",14)

"KRN",8994,681,2,"B","PSBCSRT",7)

"KRN",8994,681,2,"B","PSBCV1",8)

"KRN",8994,681,2,"B","PSBCV2",9)

"KRN",8994,681,2,"B","PSBCV3",10)

"KRN",8994,681,2,"B","PSBCV4",11)

"KRN",8994,681,2,"B","PSBDEV",6)

"KRN",8994,681,2,"B","PSBIVCW",5)

"KRN",8994,681,2,"B","PSBORMODE",13)

"KRN",8994,681,2,"B","PSBPBCW",4)

"KRN",8994,681,2,"B","PSBUDCW ",3)

"KRN",8994,681,2,"B","PSBVDL",2)

"KRN",8994,681,2,"B","PSBWIN",1)

"KRN",8994,681,2,"PARAMSEQ",1,1)

"KRN",8994,681,2,"PARAMSEQ",2,2)

"KRN",8994,681,2,"PARAMSEQ",3,3)

"KRN",8994,681,2,"PARAMSEQ",4,4)

"KRN",8994,681,2,"PARAMSEQ",5,5)

"KRN",8994,681,2,"PARAMSEQ",6,6)

"KRN",8994,681,2,"PARAMSEQ",7,7)

"KRN",8994,681,2,"PARAMSEQ",8,8)

"KRN",8994,681,2,"PARAMSEQ",9,9)

"KRN",8994,681,2,"PARAMSEQ",10,10)

"KRN",8994,681,2,"PARAMSEQ",11,11)

"KRN",8994,681,2,"PARAMSEQ",12,13)

"KRN",8994,681,2,"PARAMSEQ",13,14)

"KRN",8994,681,3,0)
^8994.03^4^4^3120626^^
"KRN",8994,681,3,1,0)
Returns
"KRN",8994,681,3,2,0)
 
"KRN",8994,681,3,3,0)
  Results[0]='1^Saved'
"KRN",8994,681,3,4,0)
  Results[0]='-1^Unable to save settings' if an error occurs in filing.
"KRN",8994,686,-1)
0^9
"KRN",8994,686,0)
PSB TRANSACTION^RPC^PSBML^2^P^^^^3
"KRN",8994,686,1,0)
^^126^126^3130426^
"KRN",8994,686,1,1,0)
This is the filing RPC for all data returning from the client
"KRN",8994,686,1,2,0)
regarding the medication log.  Filing is handled by business rules on
"KRN",8994,686,1,3,0)
the server and this RPC will return either '1^Data Filed' or
"KRN",8994,686,1,4,0)
'-1^reason for not filing data' to the client.  Results of the 
"KRN",8994,686,1,5,0)
processed transaction is communicated via the RESULTS array.  The 
"KRN",8994,686,1,6,0)
number of RESULTS subscripts used (n) will be presented in RESULTS[0].  
"KRN",8994,686,1,7,0)
RESULTS [1..n] will contain the RESULTS message.  
"KRN",8994,686,1,8,0)
 
"KRN",8994,686,1,9,0)
Business rules are conducted via the [0] node data (Input parameter 
"KRN",8994,686,1,10,0)
sequence 1). If a '+1^MEDPASS' is encountered it is a complete new med 
"KRN",8994,686,1,11,0)
pass and is validated as such.  Transaction type MEDPASS is the only type 
"KRN",8994,686,1,12,0)
that requires a +1 in the first piece of the header, all other 
"KRN",8994,686,1,13,0)
transactions MUST supply a valid medication log entry in the IENS.
"KRN",8994,686,1,14,0)
 
"KRN",8994,686,1,15,0)
The data for filing is passed in as a list in Param[1] as shown below.
"KRN",8994,686,1,16,0)
 
"KRN",8994,686,1,17,0)
Example Delphi Call
"KRN",8994,686,1,18,0)
 
"KRN",8994,686,1,19,0)
  with RPCBroker1 do
"KRN",8994,686,1,20,0)
    begin
"KRN",8994,686,1,21,0)
    RemoteProcedure := 'PSB TRANSACTION';
"KRN",8994,686,1,22,0)
    Param[0].Value := '88484^COMMENT';
"KRN",8994,686,1,23,0)
    Param[0].PType := Literal;
"KRN",8994,686,1,24,0)
    Param[1].Mult['0'] := 'Comment for the med pass';
"KRN",8994,686,1,25,0)
    Param[1].Ptype := List;
"KRN",8994,686,1,26,0)
    Call;
"KRN",8994,686,1,27,0)
    end;
"KRN",8994,686,1,28,0)
 
"KRN",8994,686,1,29,0)
BUSINESS LOGIC controlled by Param[0]:
"KRN",8994,686,1,30,0)
 
"KRN",8994,686,1,31,0)
Param[0] = MEDLOG IEN ^ TRANSACTION ^ INSTRUCTOR DUZ ^ WITNESS DUZ
"KRN",8994,686,1,32,0)
           ^ WITNESS COMMENT ^ WITNESS HR ORDER LEVEL CODE
"KRN",8994,686,1,33,0)
 
"KRN",8994,686,1,34,0)
-------------------------------------------------------------------------
"KRN",8994,686,1,35,0)
TRANSACTION = MEDPASS
"KRN",8994,686,1,36,0)
   Note: Entries 1-6 are required, 7,8,9 are required depending on 
"KRN",8994,686,1,37,0)
         item [2] order type...
"KRN",8994,686,1,38,0)
 
"KRN",8994,686,1,39,0)
 [0] = Patient IEN
"KRN",8994,686,1,40,0)
 
"KRN",8994,686,1,41,0)
 
"KRN",8994,686,1,42,0)
 [1] = IV/Unit Dose Order Number ^ Clinic Name (if a clinic order)
"KRN",8994,686,1,43,0)
   Note: will be passed in as I;#### for IV and U;#### for Unit Dose
"KRN",8994,686,1,44,0)
         future release will allow P;#### for pending
"KRN",8994,686,1,45,0)
 
"KRN",8994,686,1,46,0)
 [2] = Schedule
"KRN",8994,686,1,47,0)
   Note: C:Continuous P:PRN 1:One Time O:On Call
"KRN",8994,686,1,48,0)
 
"KRN",8994,686,1,49,0)
 [3] = Status
"KRN",8994,686,1,50,0)
   Note: G:Given H:Held R:Refused
"KRN",8994,686,1,51,0)
 
"KRN",8994,686,1,52,0)
 [4] = Orderable Item
"KRN",8994,686,1,53,0)
   Note: IEN to 'PHARMACY ORDERABLE ITEM' (#50.7)
"KRN",8994,686,1,54,0)
 
"KRN",8994,686,1,55,0)
 [5] = Scheduled Administration Date/Time
"KRN",8994,686,1,56,0)
   Note: This is when the med is scheduled, med is entered as GIVEN NOW!
"KRN",8994,686,1,57,0)
 
"KRN",8994,686,1,58,0)
 [6] = Reason Given PRN^PRN Reason Flag
"KRN",8994,686,1,59,0)
   Note: Required if given PRN must be null if not PRN
"KRN",8994,686,1,60,0)
 
"KRN",8994,686,1,61,0)
 [7] = Comment
"KRN",8994,686,1,62,0)
   Note: 1-200 characters
"KRN",8994,686,1,63,0)
 
"KRN",8994,686,1,64,0)
 [8] = Injection Site
"KRN",8994,686,1,65,0)
 [9] = Tab^Unique ID #
"KRN",8994,686,1,66,0)
 
"KRN",8994,686,1,67,0)
 [10..n]= RecordType^IEN^Units Ordered^Units Given^Units Type
"KRN",8994,686,1,68,0)
 
"KRN",8994,686,1,69,0)
          Record Type = DD:  Dispense Drug
"KRN",8994,686,1,70,0)
                        SOL: Solution
"KRN",8994,686,1,71,0)
                        ADD: Additive
"KRN",8994,686,1,72,0)
 
"KRN",8994,686,1,73,0)
          IEN = Internal Entry Number of the following
"KRN",8994,686,1,74,0)
                if Record Type = DD:  DRUG (FILE #50)  
"KRN",8994,686,1,75,0)
                                SOL: IV SOLUTIONS (FILE #??)
"KRN",8994,686,1,76,0)
                                ADD: IV ADDITIVES (FILE #??)
"KRN",8994,686,1,77,0)
 
"KRN",8994,686,1,78,0)
          Units Ordered = Number of units in the Inpt Meds Order
"KRN",8994,686,1,79,0)
 
"KRN",8994,686,1,80,0)
          Units Given = Number of units scanned/entered by the user
"KRN",8994,686,1,81,0)
 
"KRN",8994,686,1,82,0)
          Units Type = Type of administration unit (i.e. TAB, CAPLET, ML)
"KRN",8994,686,1,83,0)
 
"KRN",8994,686,1,84,0)
-------------------------------------------------------------------------
"KRN",8994,686,1,85,0)
TRANSACTION = COMMENT
"KRN",8994,686,1,86,0)
 
"KRN",8994,686,1,87,0)
 [0] = Comment to append to the log entry
"KRN",8994,686,1,88,0)
   Note: Will be appended to the log with user ien and NOW as a date
"KRN",8994,686,1,89,0)
 
"KRN",8994,686,1,90,0)
-------------------------------------------------------------------------
"KRN",8994,686,1,91,0)
TRANSACTION = PRN EFFECTIVENESS
"KRN",8994,686,1,92,0)
 
"KRN",8994,686,1,93,0)
 [0] = Effective Comment
"KRN",8994,686,1,94,0)
   Note: will be filed as entered now by current user
"KRN",8994,686,1,95,0)
 
"KRN",8994,686,1,96,0)
 -------------------------------------------------------------------------
"KRN",8994,686,1,97,0)
TRANSACTION = STATUS UPDATE
"KRN",8994,686,1,98,0)
 
"KRN",8994,686,1,99,0)
 [0] = New Status
"KRN",8994,686,1,100,0)
   Note: If status is Given, Date/Time administered D/T will be set to NOW
"KRN",8994,686,1,101,0)
         If status is Held/Refused administered D/T will be set to null
"KRN",8994,686,1,102,0)
         Status on med log must be <> null to execute.
"KRN",8994,686,1,103,0)
         New status must NOT match current status or G will overwrite 
"KRN",8994,686,1,104,0)
         administration DT.
"KRN",8994,686,1,105,0)
 
"KRN",8994,686,1,106,0)
 [1] = Comment
"KRN",8994,686,1,107,0)
   Note: Comment *IS* Required
"KRN",8994,686,1,108,0)
 
"KRN",8994,686,1,109,0)
-------------------------------------------------------------------------
"KRN",8994,686,1,110,0)
TRANSACTION = EDIT
"KRN",8994,686,1,111,0)
 
"KRN",8994,686,1,112,0)
 [0] = Action Status
"KRN",8994,686,1,113,0)
 [1] = Patient DFN
"KRN",8994,686,1,114,0)
 [2] = Inf/Inj Site
"KRN",8994,686,1,115,0)
 [3] = IV Unique ID
"KRN",8994,686,1,116,0)
 [4] = Admin Date/Time (fileman format)
"KRN",8994,686,1,117,0)
 [5] = Prn Reason
"KRN",8994,686,1,118,0)
 [6] = Prn Effectiveness
"KRN",8994,686,1,119,0)
 
"KRN",8994,686,1,120,0)
 [7] = Comment
"KRN",8994,686,1,121,0)
       Note: comment data is required!
"KRN",8994,686,1,122,0)
 
"KRN",8994,686,1,123,0)
 [8] = "DD/ADD/SOL^ Drug IEN ^ Dose Ordered ^ Dose Given 
"KRN",8994,686,1,124,0)
         ^ Unit of Administration"
"KRN",8994,686,1,125,0)
 
"KRN",8994,686,1,126,0)
 [n] = "additional data per DD/ADD/SOL associated with order."
"KRN",8994,686,2,0)
^8994.02A^2^2
"KRN",8994,686,2,1,0)
PSBHDR^1^^1^1
"KRN",8994,686,2,1,1,0)
^^1^1^2990309^
"KRN",8994,686,2,1,1,1,0)
Contains the IEN or +1 up-arrow transaction.  See RPC description.
"KRN",8994,686,2,2,0)
PSBREC^2^^1^2
"KRN",8994,686,2,2,1,0)
^8994.021^1^1^3130426^^^^
"KRN",8994,686,2,2,1,1,0)
See description.
"KRN",8994,686,2,"B","PSBHDR",1)

"KRN",8994,686,2,"B","PSBREC",2)

"KRN",8994,686,2,"PARAMSEQ",1,1)

"KRN",8994,686,2,"PARAMSEQ",2,2)

"KRN",8994,686,3,0)
^8994.03^1^1^3040517^^^^
"KRN",8994,686,3,1,0)
See description.
"KRN",8994,692,-1)
0^4
"KRN",8994,692,0)
PSB REPORT^RPC^PSBO^4^S^^^1^3
"KRN",8994,692,1,0)
^8994.01^2^2^3120522^^^^
"KRN",8994,692,1,1,0)
Return the text for the specified report and the user has the option to 
"KRN",8994,692,1,2,0)
print the reports.
"KRN",8994,692,2,0)
^8994.02A^28^25
"KRN",8994,692,2,1,0)
PSBTYPE^1^2^1^1
"KRN",8994,692,2,1,1,0)
^^26^26^3081208^
"KRN",8994,692,2,1,1,1,0)
Contains the character designation for the needed report:
"KRN",8994,692,2,1,1,2,0)
AL: Allergy Request
"KRN",8994,692,2,1,1,3,0)
BL: Bar Code Label
"KRN",8994,692,2,1,1,4,0)
BZ: Bar Code Label
"KRN",8994,692,2,1,1,5,0)
CE: Coversheet - Expired/DC'd/Expiring Orders
"KRN",8994,692,2,1,1,6,0)
CI: Coversheet - IV Overview
"KRN",8994,692,2,1,1,7,0)
CM: Coversheet - Medication Overview
"KRN",8994,692,2,1,1,8,0)
CP: Coversheet - PRN Overview
"KRN",8994,692,2,1,1,9,0)
DL: Due List
"KRN",8994,692,2,1,1,10,0)
DO: Display Order
"KRN",8994,692,2,1,1,11,0)
IV: IV Bag Status
"KRN",8994,692,2,1,1,12,0)
MD: Missing Dose by Ward
"KRN",8994,692,2,1,1,13,0)
MH: Medication Administration History
"KRN",8994,692,2,1,1,14,0)
ML: Medication Log
"KRN",8994,692,2,1,1,15,0)
MM: Missed Medication
"KRN",8994,692,2,1,1,16,0)
MT: Medication Therapy Report
"KRN",8994,692,2,1,1,17,0)
MV: Medication Variance Log
"KRN",8994,692,2,1,1,18,0)
PE: PRN Effectiveness
"KRN",8994,692,2,1,1,19,0)
PF: Patient Record Flag
"KRN",8994,692,2,1,1,20,0)
PI: Patient Inquiry
"KRN",8994,692,2,1,1,21,0)
PM: Patient Medication History
"KRN",8994,692,2,1,1,22,0)
SF: Unable To Scan Detail
"KRN",8994,692,2,1,1,23,0)
ST: Unable To Scan Summary
"KRN",8994,692,2,1,1,24,0)
VT: Cumulative Vitals
"KRN",8994,692,2,1,1,25,0)
WA: Ward Administration Times
"KRN",8994,692,2,1,1,26,0)
XA: Unknown Action Status
"KRN",8994,692,2,2,0)
PSBDFN^1^10^1^2
"KRN",8994,692,2,2,1,0)
^8994.021^1^1^3030317^^
"KRN",8994,692,2,2,1,1,0)
Patient IEN
"KRN",8994,692,2,3,0)
PSBSTRT^1^20^1^3
"KRN",8994,692,2,3,1,0)
^^1^1^3011127^
"KRN",8994,692,2,3,1,1,0)
Internal Fileman Start Date/Time
"KRN",8994,692,2,4,0)
PSBSTOP^1^20^1^4
"KRN",8994,692,2,4,1,0)
^^1^1^3011127^
"KRN",8994,692,2,4,1,1,0)
Fileman Stop Date/Time
"KRN",8994,692,2,5,0)
PSBINCL^1^15^1^5
"KRN",8994,692,2,5,1,0)
^8994.021^8^8^3020904^^^^
"KRN",8994,692,2,5,1,1,0)
Contains the parameters for a Due List in up-arrow pieces.
"KRN",8994,692,2,5,1,2,0)
 
"KRN",8994,692,2,5,1,3,0)
Piece   1: 1/0 Include Continuous Meds
"KRN",8994,692,2,5,1,4,0)
        2: 1/0 Include PRN Meds
"KRN",8994,692,2,5,1,5,0)
        3: 1/0 Include OnCall Meds
"KRN",8994,692,2,5,1,6,0)
        4: 1/0 Include OneTime Meds
"KRN",8994,692,2,5,1,7,0)
        5: 1/0 Include Comments
"KRN",8994,692,2,5,1,8,0)
        6: 1/0 Include Audits
"KRN",8994,692,2,5,1,9,0)
blanks at the end of the report.
"KRN",8994,692,2,6,0)
PSBDEV^1^30^0^6
"KRN",8994,692,2,6,1,0)
^^1^1^3011127^
"KRN",8994,692,2,6,1,1,0)
Contains the name of the device that the report prints to.
"KRN",8994,692,2,7,0)
PSBSORT^1^1^1^7
"KRN",8994,692,2,7,1,0)
^^1^1^3011127^
"KRN",8994,692,2,7,1,1,0)
Sorts the report by patient or by ward
"KRN",8994,692,2,8,0)
PSBOI^1^7^1^8
"KRN",8994,692,2,8,1,0)
^8994.021^1^1^3070604^^^
"KRN",8994,692,2,8,1,1,0)
Order/Orderable Item number. 
"KRN",8994,692,2,9,0)
PSBWLOC^1^30^0^9
"KRN",8994,692,2,9,1,0)
^8994.021^1^1^3080806^^^
"KRN",8994,692,2,9,1,1,0)
Ward Location 
"KRN",8994,692,2,10,0)
PSBWSORT^1^1^0^10
"KRN",8994,692,2,10,1,0)
^^2^2^3011127^
"KRN",8994,692,2,10,1,1,0)
Sort By Patient - "P"
"KRN",8994,692,2,10,1,2,0)
  or By Bed     - "B"
"KRN",8994,692,2,11,0)
PSBFUT^1^1^1^11
"KRN",8994,692,2,11,1,0)
^8994.021^6^6^3030326^^^^
"KRN",8994,692,2,11,1,1,0)
Contains the parameters for Due list in up-arrow pieces
"KRN",8994,692,2,11,1,2,0)
 
"KRN",8994,692,2,11,1,3,0)
Piece   1: 1/0 Include Blanks (Changes/Addendums)
"KRN",8994,692,2,11,1,4,0)
        2: 1/0 Include IV Meds
"KRN",8994,692,2,11,1,5,0)
        3: 1/0 Include Unit Dose Meds
"KRN",8994,692,2,11,1,6,0)
        4: 1/0 Include Future Orders
"KRN",8994,692,2,12,0)
PSBORDNUM^1^^^12
"KRN",8994,692,2,12,1,0)
^8994.021^7^7^3031209^^^^
"KRN",8994,692,2,12,1,1,0)
The PSBORDNUM is the pharmacy order number from the Inpatient Medications
"KRN",8994,692,2,12,1,2,0)
package.
"KRN",8994,692,2,12,1,3,0)
 
"KRN",8994,692,2,12,1,4,0)
Example: 10U or 10V
"KRN",8994,692,2,12,1,5,0)
 
"KRN",8994,692,2,12,1,6,0)
This order number is used to do a lookup of medications by orderable item 
"KRN",8994,692,2,12,1,7,0)
for the medication history report.
"KRN",8994,692,2,13,0)
PSBLIST^2^^0^14
"KRN",8994,692,2,13,1,0)
^8994.021^19^19^3120613^^^^
"KRN",8994,692,2,13,1,1,0)
This  OPTIONAL  parameter contains list of data to input for the creating 
"KRN",8994,692,2,13,1,2,0)
of a report.  The report's developer/designer should be aware of
"KRN",8994,692,2,13,1,3,0)
the type of information to be input via this parameter.  For example per 
"KRN",8994,692,2,13,1,4,0)
the BCMA Medication Therapy Report , this parameter will contain a list of
"KRN",8994,692,2,13,1,5,0)
Dispensed Drug(s)/VA Drug Classification(s)/Orderable Items to be used 
"KRN",8994,692,2,13,1,6,0)
per a "Medical Therapy Report".
"KRN",8994,692,2,13,1,7,0)
 Each item in the list will be tagged respectively: "DD"/"VAC"/"OIT"  Each
"KRN",8994,692,2,13,1,8,0)
item will have the appropriate file pointer data as "^"piece #3.
"KRN",8994,692,2,13,1,9,0)
 
"KRN",8994,692,2,13,1,10,0)
example:
"KRN",8994,692,2,13,1,11,0)
 
"KRN",8994,692,2,13,1,12,0)
List[0]=        "MT^OIT^1043"
"KRN",8994,692,2,13,1,13,0)
List[1]=        "MT^OIT^475"
"KRN",8994,692,2,13,1,14,0)
List[2]=        "MT^OIT^464"
"KRN",8994,692,2,13,1,15,0)
List[3]=        "MT^OIT^88"
"KRN",8994,692,2,13,1,16,0)
 
"KRN",8994,692,2,13,1,17,0)
 
"KRN",8994,692,2,13,1,18,0)
 
"KRN",8994,692,2,13,1,19,0)
The data in the list will be filed into SUBFILE #53.692  (MULTIPLE).
"KRN",8994,692,2,14,0)
PSBRCRI^1^^0^13
"KRN",8994,692,2,14,1,0)
^^10^10^3070619^
"KRN",8994,692,2,14,1,1,0)
Optional parameter contains "additional" report criteria.  The Idea 
"KRN",8994,692,2,14,1,2,0)
is to make the first part of the data to designate the purpose of the data
"KRN",8994,692,2,14,1,3,0)
being input.  An example is to send an addition "Query Date" the 
"KRN",8994,692,2,14,1,4,0)
literal "QD^3070419.1200"  could be the input data.  
"KRN",8994,692,2,14,1,5,0)
 
"KRN",8994,692,2,14,1,6,0)
 
"KRN",8994,692,2,14,1,7,0)
Current list of tags:
"KRN",8994,692,2,14,1,8,0)
 
"KRN",8994,692,2,14,1,9,0)
 
"KRN",8994,692,2,14,1,10,0)
"QD" - query date
"KRN",8994,692,2,16,0)
PSBPST^1^5^0^15
"KRN",8994,692,2,16,1,0)
^^2^2^3080806^
"KRN",8994,692,2,16,1,1,0)
IDENTIFIES THE PRIMARY, SECONDARY AND TERTIARY SORT ORDERS FOR THE REPORT 
"KRN",8994,692,2,16,1,2,0)
SEPARATED BY "^".
"KRN",8994,692,2,17,0)
PSBTR^1^10^0^16
"KRN",8994,692,2,17,1,0)
^8994.021^1^1^3120606^^^
"KRN",8994,692,2,17,1,1,0)
This field defines what sub-headers will be printed on the report.
"KRN",8994,692,2,18,0)
PSBSIFIL^1^1^0^18
"KRN",8994,692,2,18,1,0)
^8994.021^3^3^3120109^^
"KRN",8994,692,2,18,1,1,0)
Include Special Instructions/Other Print Info on report Yes/No.
"KRN",8994,692,2,18,1,2,0)
0 = No
"KRN",8994,692,2,18,1,3,0)
1 = Yes
"KRN",8994,692,2,19,0)
PSBCLINORD^1^1^0^19
"KRN",8994,692,2,19,1,0)
^8994.021^5^5^3120615^^^
"KRN",8994,692,2,19,1,1,0)
This field is an indicator as to what mode the report will be run in.  
"KRN",8994,692,2,19,1,2,0)
Clinic order mode or Inpatient mode.  This is an exclusive mode for 
"KRN",8994,692,2,19,1,3,0)
certain reports to run in.
"KRN",8994,692,2,19,1,4,0)
C = Clinic Orders only
"KRN",8994,692,2,19,1,5,0)
I = Inpatient Orders only
"KRN",8994,692,2,21,0)
PSB20^1^1^0^20
"KRN",8994,692,2,21,1,0)
^8994.021^1^1^3120615^^
"KRN",8994,692,2,21,1,1,0)
Reserved parameter 20 for future use.
"KRN",8994,692,2,22,0)
PSB21^1^1^0^21
"KRN",8994,692,2,22,1,0)
^8994.021^1^1^3120615^^
"KRN",8994,692,2,22,1,1,0)
Reserved parameter 21 for future use.
"KRN",8994,692,2,24,0)
PSB22^1^1^0^22
"KRN",8994,692,2,24,1,0)
^^1^1^3120615^
"KRN",8994,692,2,24,1,1,0)
Reserved parameter 22 for future use.
"KRN",8994,692,2,25,0)
PSB23^1^1^0^23
"KRN",8994,692,2,25,1,0)
^^1^1^3120615^
"KRN",8994,692,2,25,1,1,0)
Reserved parameter 23 for future use.
"KRN",8994,692,2,26,0)
PSB24^1^1^0^24
"KRN",8994,692,2,26,1,0)
^^1^1^3120615^
"KRN",8994,692,2,26,1,1,0)
Reserved parameter 24 for future use.
"KRN",8994,692,2,27,0)
PSBCLLIST^2^90^0^25
"KRN",8994,692,2,27,1,0)
^8994.021^1^1^3120615^^^^
"KRN",8994,692,2,27,1,1,0)
LIST ARRAY FOR CLINICS
"KRN",8994,692,2,28,0)
PSBDIV^1^^0^17
"KRN",8994,692,2,28,1,0)
^^1^1^3120606^
"KRN",8994,692,2,28,1,1,0)
Division
"KRN",8994,692,2,"B","PSB20",21)

"KRN",8994,692,2,"B","PSB21",22)

"KRN",8994,692,2,"B","PSB22",24)

"KRN",8994,692,2,"B","PSB23",25)

"KRN",8994,692,2,"B","PSB24",26)

"KRN",8994,692,2,"B","PSBCLINORD",19)

"KRN",8994,692,2,"B","PSBCLLIST",27)

"KRN",8994,692,2,"B","PSBDEV",6)

"KRN",8994,692,2,"B","PSBDFN",2)

"KRN",8994,692,2,"B","PSBDIV",28)

"KRN",8994,692,2,"B","PSBDL",5)

"KRN",8994,692,2,"B","PSBFUT",11)

"KRN",8994,692,2,"B","PSBINCL",5)

"KRN",8994,692,2,"B","PSBLIST",13)

"KRN",8994,692,2,"B","PSBOI",8)

"KRN",8994,692,2,"B","PSBORDNUM",12)

"KRN",8994,692,2,"B","PSBPST",16)

"KRN",8994,692,2,"B","PSBRCRI",14)

"KRN",8994,692,2,"B","PSBSIFIL",18)

"KRN",8994,692,2,"B","PSBSORT",7)

"KRN",8994,692,2,"B","PSBSTOP",4)

"KRN",8994,692,2,"B","PSBSTRT",3)

"KRN",8994,692,2,"B","PSBTR",17)

"KRN",8994,692,2,"B","PSBTYPE",1)

"KRN",8994,692,2,"B","PSBWLOC",9)

"KRN",8994,692,2,"B","PSBWSORT",10)

"KRN",8994,692,2,"PARAMSEQ",1,1)

"KRN",8994,692,2,"PARAMSEQ",2,2)

"KRN",8994,692,2,"PARAMSEQ",3,3)

"KRN",8994,692,2,"PARAMSEQ",4,4)

"KRN",8994,692,2,"PARAMSEQ",5,5)

"KRN",8994,692,2,"PARAMSEQ",6,6)

"KRN",8994,692,2,"PARAMSEQ",7,7)

"KRN",8994,692,2,"PARAMSEQ",8,8)

"KRN",8994,692,2,"PARAMSEQ",8,9)

"KRN",8994,692,2,"PARAMSEQ",9,9)

"KRN",8994,692,2,"PARAMSEQ",10,10)

"KRN",8994,692,2,"PARAMSEQ",11,11)

"KRN",8994,692,2,"PARAMSEQ",12,12)

"KRN",8994,692,2,"PARAMSEQ",13,14)

"KRN",8994,692,2,"PARAMSEQ",14,13)

"KRN",8994,692,2,"PARAMSEQ",15,16)

"KRN",8994,692,2,"PARAMSEQ",16,17)

"KRN",8994,692,2,"PARAMSEQ",17,28)

"KRN",8994,692,2,"PARAMSEQ",18,18)

"KRN",8994,692,2,"PARAMSEQ",19,19)

"KRN",8994,692,2,"PARAMSEQ",20,21)

"KRN",8994,692,2,"PARAMSEQ",21,22)

"KRN",8994,692,2,"PARAMSEQ",22,24)

"KRN",8994,692,2,"PARAMSEQ",23,25)

"KRN",8994,692,2,"PARAMSEQ",24,26)

"KRN",8994,692,2,"PARAMSEQ",25,27)

"KRN",8994,692,3,0)
^8994.03^1^1^3120522^^^^
"KRN",8994,692,3,1,0)
Text of report.
"KRN",8994,694,-1)
0^11
"KRN",8994,694,0)
PSB SUBMIT MISSING DOSE^RPC^PSBMD^2^P^^^1^2
"KRN",8994,694,1,0)
^8994.01^1^1^3030728^^^^
"KRN",8994,694,1,1,0)
Allows the client to submit a missing dose interactively.
"KRN",8994,694,2,0)
^8994.02A^11^11
"KRN",8994,694,2,1,0)
PSBDFN^1^^1^1
"KRN",8994,694,2,1,1,0)
^^1^1^3030319^
"KRN",8994,694,2,1,1,1,0)
Patient DFN (IEN)
"KRN",8994,694,2,2,0)
PSBDRUG^1^^1^2
"KRN",8994,694,2,2,1,0)
^8994.021^1^1^3030728^^
"KRN",8994,694,2,2,1,1,0)
This is the IEN of the drug from File #50.
"KRN",8994,694,2,3,0)
PSBDOSE^1^^^3
"KRN",8994,694,2,3,1,0)
^8994.021^1^1^3030728^^
"KRN",8994,694,2,3,1,1,0)
Dosage.
"KRN",8994,694,2,4,0)
PSBRSN^1^^0^4
"KRN",8994,694,2,4,1,0)
^8994.021^6^6^3030728^^
"KRN",8994,694,2,4,1,1,0)
Missing Dose reason.
"KRN",8994,694,2,4,1,2,0)
 
"KRN",8994,694,2,4,1,3,0)
INTERNALLY-STORED CODE: 1   WILL STAND FOR: DROPPED
"KRN",8994,694,2,4,1,4,0)
INTERNALLY-STORED CODE: 2   WILL STAND FOR: EMPTY PACKAGE
"KRN",8994,694,2,4,1,5,0)
INTERNALLY-STORED CODE: 3   WILL STAND FOR: NOT AVAILABLE
"KRN",8994,694,2,4,1,6,0)
INTERNALLY-STORED CODE: 4   WILL STAND FOR: WRONG DOSE/DRUG DELIVERED
"KRN",8994,694,2,5,0)
PSBADMIN^1^^0^5
"KRN",8994,694,2,5,1,0)
^8994.021^1^1^3030728^^
"KRN",8994,694,2,5,1,1,0)
Administration time of the medication.
"KRN",8994,694,2,6,0)
PSBNEED^1^^1^6
"KRN",8994,694,2,6,1,0)
^8994.021^1^1^3030728^^
"KRN",8994,694,2,6,1,1,0)
Needed date/time of the medication
"KRN",8994,694,2,7,0)
PSBUID^1^^0^7
"KRN",8994,694,2,7,1,0)
^8994.021^1^1^3030728^^
"KRN",8994,694,2,7,1,1,0)
Unique ID of an IV bag if it's an IV order.
"KRN",8994,694,2,8,0)
PSBON^1^^1^8
"KRN",8994,694,2,8,1,0)
^8994.021^1^1^3030728^^
"KRN",8994,694,2,8,1,1,0)
Order Number
"KRN",8994,694,2,9,0)
PSBSCHD^1^^0^9
"KRN",8994,694,2,9,1,0)
^8994.021^1^1^3121102^^^
"KRN",8994,694,2,9,1,1,0)
Medication Schedule.
"KRN",8994,694,2,10,0)
PSBCLIN^1^30^0^10
"KRN",8994,694,2,10,1,0)
^8994.021^1^1^3121115^^
"KRN",8994,694,2,10,1,1,0)
Clinic Name
"KRN",8994,694,2,11,0)
PSBCLNIEN^1^^0^11
"KRN",8994,694,2,11,1,0)
^^2^2^3121115^
"KRN",8994,694,2,11,1,1,0)
Clinic pointer to the HOSPITAL LOCATION file (#44) for a clinic 
"KRN",8994,694,2,11,1,2,0)
submitting a missing dose request.
"KRN",8994,694,2,"B","PSBADMIN",5)

"KRN",8994,694,2,"B","PSBCLIN",10)

"KRN",8994,694,2,"B","PSBCLNIEN",11)

"KRN",8994,694,2,"B","PSBDFN",1)

"KRN",8994,694,2,"B","PSBDOSE",3)

"KRN",8994,694,2,"B","PSBDRUG",2)

"KRN",8994,694,2,"B","PSBNEED",6)

"KRN",8994,694,2,"B","PSBON",8)

"KRN",8994,694,2,"B","PSBRSN",4)

"KRN",8994,694,2,"B","PSBSCHD",9)

"KRN",8994,694,2,"B","PSBUID",7)

"KRN",8994,694,2,"PARAMSEQ",1,1)

"KRN",8994,694,2,"PARAMSEQ",2,2)

"KRN",8994,694,2,"PARAMSEQ",3,3)

"KRN",8994,694,2,"PARAMSEQ",4,4)

"KRN",8994,694,2,"PARAMSEQ",5,5)

"KRN",8994,694,2,"PARAMSEQ",6,6)

"KRN",8994,694,2,"PARAMSEQ",7,7)

"KRN",8994,694,2,"PARAMSEQ",8,8)

"KRN",8994,694,2,"PARAMSEQ",9,9)

"KRN",8994,694,2,"PARAMSEQ",10,10)

"KRN",8994,694,2,"PARAMSEQ",11,11)

"KRN",8994,694,3,0)
^8994.03^1^1^3030728^^^
"KRN",8994,694,3,1,0)
Results[0] = 1^Missing Dose Submitted^351
"KRN",8994,1231,-1)
0^1
"KRN",8994,1231,0)
PSB GETORDERTAB^RPC^PSBVDLTB^4^P^^^1^3
"KRN",8994,1231,1,0)
^8994.01^1^1^3120830^^^
"KRN",8994,1231,1,1,0)
Gives the client VDL information for the specified patient and time frame.
"KRN",8994,1231,2,0)
^8994.02A^5^5
"KRN",8994,1231,2,1,0)
DFN^1^30^1^1
"KRN",8994,1231,2,1,1,0)
^8994.021^1^1^3070712^^^^
"KRN",8994,1231,2,1,1,1,0)
The patient IEN from ^DPT.
"KRN",8994,1231,2,2,0)
VDL TAB^1^30^1^2
"KRN",8994,1231,2,2,1,0)
^8994.021^1^1^3070712^^^
"KRN",8994,1231,2,2,1,1,0)
The tab from the VDL that is being requested.
"KRN",8994,1231,2,3,0)
VDL DATE^1^30^0^3
"KRN",8994,1231,2,3,1,0)
^8994.021^2^2^3111020^^^^
"KRN",8994,1231,2,3,1,1,0)
The date of the requested data.  If not passed then current date/time are
"KRN",8994,1231,2,3,1,2,0)
used.
"KRN",8994,1231,2,4,0)
PSBSIOPI^1^1^0^4
"KRN",8994,1231,2,4,1,0)
^8994.021^5^5^3120425^^
"KRN",8994,1231,2,4,1,1,0)
 This parameter is a true/false flag (1/0).  If true use the new SI/OP Wp
"KRN",8994,1231,2,4,1,2,0)
 fields and return data in the Results array to the GUI Client.
"KRN",8994,1231,2,4,1,3,0)
  
"KRN",8994,1231,2,4,1,4,0)
 The field is not required, so a null will convert into a 0, for false,
"KRN",8994,1231,2,4,1,5,0)
 making this backwards compatible.
"KRN",8994,1231,2,5,0)
PSBCLINORD^1^1^0^5
"KRN",8994,1231,2,5,1,0)
^8994.021^6^6^3120830^^
"KRN",8994,1231,2,5,1,1,0)
This parameter is a True/False flag (1/0).  If true, then return only
"KRN",8994,1231,2,5,1,2,0)
Clinic Orders and not Inpatient Medication orders to BCMA, else if false, 
"KRN",8994,1231,2,5,1,3,0)
return only Inpatient Medication orders to BCMA.
"KRN",8994,1231,2,5,1,4,0)
 
"KRN",8994,1231,2,5,1,5,0)
The field is not required, so a null will convert into a 0, for a 
"KRN",8994,1231,2,5,1,6,0)
default false value, making this backwards compatible.
"KRN",8994,1231,2,"B","DFN",1)

"KRN",8994,1231,2,"B","PSBCLINORD",5)

"KRN",8994,1231,2,"B","PSBSIOPI",4)

"KRN",8994,1231,2,"B","VDL DATE",3)

"KRN",8994,1231,2,"B","VDL TAB",2)

"KRN",8994,1231,2,"PARAMSEQ",1,1)

"KRN",8994,1231,2,"PARAMSEQ",2,2)

"KRN",8994,1231,2,"PARAMSEQ",3,3)

"KRN",8994,1231,2,"PARAMSEQ",4,4)

"KRN",8994,1231,2,"PARAMSEQ",5,5)

"KRN",8994,1231,3,0)
^^102^102^3121115^
"KRN",8994,1231,3,1,0)
 
"KRN",8994,1231,3,2,0)
If a valid list of orders are found they are returned in a block format
"KRN",8994,1231,3,3,0)
with the word 'END' delimiting orders/administrations.  Lines for
"KRN",8994,1231,3,4,0)
subsequent block are numbered sequential.  They are not reset to 1 for
"KRN",8994,1231,3,5,0)
each
"KRN",8994,1231,3,6,0)
block.
"KRN",8994,1231,3,7,0)
 
"KRN",8994,1231,3,8,0)
 
"KRN",8994,1231,3,9,0)
 
"KRN",8994,1231,3,10,0)
  Results[0] =  ^1      The number of lines returned(count)
"KRN",8994,1231,3,11,0)
 
"KRN",8994,1231,3,12,0)
  Results[1] =  ^1      Data for the Unit Dose tab (0=no, 1=yes)
"KRN",8994,1231,3,13,0)
                ^2      Data for the Piggy Back tab (0=no, 1=yes)
"KRN",8994,1231,3,14,0)
                ^3      Data for the IV tab (0=no, 1=yes)
"KRN",8994,1231,3,15,0)
                ^4      Transfer type if there was a patient movement
"KRN",8994,1231,3,16,0)
                ^5      Movement type if there was a patient movement
"KRN",8994,1231,3,17,0)
                ^6      Count of Inpatient Orders for this patient
"KRN",8994,1231,3,18,0)
                ^7      Count of Clinic Orders for this patient
"KRN",8994,1231,3,19,0)
                ^8      IV's still infusing indicator light
"KRN",8994,1231,3,20,0)
                ^9      Patch still on indicator light 
"KRN",8994,1231,3,21,0)
 
"KRN",8994,1231,3,22,0)
  Results[2] =  ^1      DFN
"KRN",8994,1231,3,23,0)
                ^2      ORDER NUMBER (20V)
"KRN",8994,1231,3,24,0)
                ^3      NUMERIC PORTION OF ORDER NUMBER (20)
"KRN",8994,1231,3,25,0)
                ^4      ALPHA PORTION OF ORDER NUMBER (V)
"KRN",8994,1231,3,26,0)
                ^5      SCHEDULE TYPE (prn/continuous)
"KRN",8994,1231,3,27,0)
                ^6      SCHEDULE (Q4H)
"KRN",8994,1231,3,28,0)
                ^7      SELF MED (SM or HSM)
"KRN",8994,1231,3,29,0)
                ^8      DRUG NAME
"KRN",8994,1231,3,30,0)
                ^9      DOSAGE/FLOW RATE
"KRN",8994,1231,3,31,0)
                ^10     MED ROUTE
"KRN",8994,1231,3,32,0)
                ^11     LAST ACTION DATE/TIME (FM format)
"KRN",8994,1231,3,33,0)
                ^12     MED LOG IEN (blank if no action)
"KRN",8994,1231,3,34,0)
                ^13     LAST ACTION STATUS (this entry)
"KRN",8994,1231,3,35,0)
                ^14     SCHEDULED ADMIN DATE/TIME
"KRN",8994,1231,3,36,0)
                ^15     ORDERABLE ITEM IEN (^ORD(101.43)
"KRN",8994,1231,3,37,0)
                ^16     INJECTABLE (0=no, 1=yes)
"KRN",8994,1231,3,38,0)
                ^17     VARIABLE DOSE (0=no, 1=yes)
"KRN",8994,1231,3,39,0)
                ^18     DOSEAGE FORM
"KRN",8994,1231,3,40,0)
                ^19     VERIFYING NURSE INITIALS (*** if none)
"KRN",8994,1231,3,41,0)
                ^20     LAST ACTION STATUS (whole order)
"KRN",8994,1231,3,42,0)
                ^21     ORDER START DATE/TIME (FM)
"KRN",8994,1231,3,43,0)
                ^22     ORDER STATUS
"KRN",8994,1231,3,44,0)
                ^23     UNIQUE ID OF BAG
"KRN",8994,1231,3,45,0)
                ^24     NURSES IEN
"KRN",8994,1231,3,46,0)
                ^25     TRANSACTION TYPE
"KRN",8994,1231,3,47,0)
                ^26     ORDER STOP DATE (FM)
"KRN",8994,1231,3,48,0)
                ^27     LAST "GIVEN" DATE (FM)
"KRN",8994,1231,3,49,0)
                ^28     GIVEN PATCH (1=yes)
"KRN",8994,1231,3,50,0)
                ^29     OVERRIDE/INTERVENTION REASONS EXIST (0=No;1=Yes)
"KRN",8994,1231,3,51,0)
                ^30     LAST INJECTION SITE TEXT (per Orderable Item)
"KRN",8994,1231,3,52,0)
                ^31     PIGGYBACK TAB- ROTATION TYPE IV ORDER INJECTABLE 
"KRN",8994,1231,3,53,0)
                        FLAG  (0 or null = No ; 1 = Yes)
"KRN",8994,1231,3,54,0)
                ^32     CLINIC NAME (if a Clinic order)
"KRN",8994,1231,3,55,0)
                ^33     CLINIC IEN POINTER (if a Clinic order)
"KRN",8994,1231,3,56,0)
 
"KRN",8994,1231,3,57,0)
  ^Results[3] = ^1      SPECIAL INSTRUCTIONS (short field)
"KRN",8994,1231,3,58,0)
                        ("!"  <- BCMA FLAG may precede Text)
"KRN",8994,1231,3,59,0)
  ^Results[n] =
"KRN",8994,1231,3,60,0)
   Dispense Drug  ^1     LITERAL "DD"
"KRN",8994,1231,3,61,0)
                  ^2     DISPENSE DRUG IEN
"KRN",8994,1231,3,62,0)
                  ^3     DISPENSE DRUG NAME
"KRN",8994,1231,3,63,0)
                  ^4     UNITS PER DOSE
"KRN",8994,1231,3,64,0)
                  ^5     INACTIVE DATE
"KRN",8994,1231,3,65,0)
                  ^6     HIGH RISK/ALERT INDICATOR
"KRN",8994,1231,3,66,0)
                           0 (null) Not High Risk
"KRN",8994,1231,3,67,0)
                           1 High Risk No Witness Required
"KRN",8994,1231,3,68,0)
                           2 Witness Required High Risk
"KRN",8994,1231,3,69,0)
REQUIRED,
"KRN",8994,1231,3,70,0)
                          1=HIGH RISK NO WITNESS, 0/null=NOT HIGH RISK
"KRN",8994,1231,3,71,0)
  ^Results[n]
"KRN",8994,1231,3,72,0)
   Additive       ^1    LITERAL "ADD"
"KRN",8994,1231,3,73,0)
                  ^2    ADDITIVE IEN
"KRN",8994,1231,3,74,0)
                  ^3    ADDITIVE NAME
"KRN",8994,1231,3,75,0)
                  ^4    STRENGTH
"KRN",8994,1231,3,76,0)
                  ^5    BOTTLE
"KRN",8994,1231,3,77,0)
                  ^6    HIGH RISK/ALERT INDICATOR                      
"KRN",8994,1231,3,78,0)
                           0 (null) Not High Risk
"KRN",8994,1231,3,79,0)
                           1 High Risk No Witness Required
"KRN",8994,1231,3,80,0)
                           2 Witness Required High Risk              
"KRN",8994,1231,3,81,0)
  ^Results[n]
"KRN",8994,1231,3,82,0)
 
"KRN",8994,1231,3,83,0)
   Solution       ^1    LITERAL "SOL"
"KRN",8994,1231,3,84,0)
                  ^2    SOLUTION IEN
"KRN",8994,1231,3,85,0)
                  ^3    SOLUTION NAME
"KRN",8994,1231,3,86,0)
                  ^4    VOLUME
"KRN",8994,1231,3,87,0)
                  ^5    - not inuse -
"KRN",8994,1231,3,88,0)
                  ^6    HIGH RISK/ALERT INDICATOR
"KRN",8994,1231,3,89,0)
                           0 (null) Not High Risk
"KRN",8994,1231,3,90,0)
                           1 High Risk No Witness Required
"KRN",8994,1231,3,91,0)
                           2 Witness Required High Risk              
"KRN",8994,1231,3,92,0)
 
"KRN",8994,1231,3,93,0)
  ^Results[n]
"KRN",8994,1231,3,94,0)
   ID list        ^1    LITERAL "ID"
"KRN",8994,1231,3,95,0)
                  ^2    ID NUMBER
"KRN",8994,1231,3,96,0)
                  ^3    ADDITIVE IEN
"KRN",8994,1231,3,97,0)
                  ^...  EACH ADDITIONAL ADDITIVE IEN
"KRN",8994,1231,3,98,0)
  ^Results(n)
"KRN",8994,1231,3,99,0)
   SI WP text     ^1    LITERAL "SI"
"KRN",8994,1231,3,100,0)
                  ^2    SPECIAL INSTRUCTIONS LONG WP TEXT LINES
"KRN",8994,1231,3,101,0)
 
"KRN",8994,1231,3,102,0)
  ^Results[n]     ^1    LITERAL "END" TO INDICATE END OF BLOCK
"KRN",8994,1917,-1)
0^8
"KRN",8994,1917,0)
PSB COVERSHEET1^RPC^PSBCSUTL^4^A^0^^1^3
"KRN",8994,1917,1,0)
^^134^134^3120517^
"KRN",8994,1917,1,1,0)
(modified 05/08/2007)
"KRN",8994,1917,1,2,0)
 
"KRN",8994,1917,1,3,0)
PSB COVERSHEET1 is to return order data per patient and construction of 
"KRN",8994,1917,1,4,0)
BCMA Coversheet view as presented by the BCMA-HSC Coversheet Phase II
"KRN",8994,1917,1,5,0)
SRS and SDD documentation.
"KRN",8994,1917,1,6,0)
 
"KRN",8994,1917,1,7,0)
INPUT:  communications area -  "" 
"KRN",8994,1917,1,8,0)
        patient's DFN       -  DFN     (patient ptr.)
"KRN",8994,1917,1,9,0)
                            -  TIME RANGE (24/48/72)
"KRN",8994,1917,1,10,0)
                            -  PSBSIOPI (SI/OPI Word Processing text line)
"KRN",8994,1917,1,11,0)
                                  (true/false flag 1/0 default=0 - Opt)
"KRN",8994,1917,1,12,0)
                            -  PSBCLINORD (Clinic Order request flag, 1/0)
"KRN",8994,1917,1,13,0)
 
"KRN",8994,1917,1,14,0)
OUTPUT: results data        -  RESULTS array containing order data 
"KRN",8994,1917,1,15,0)
                                per +/-TIME RANGE hours.
"KRN",8994,1917,1,16,0)
 
"KRN",8994,1917,1,17,0)
 
"KRN",8994,1917,1,18,0)
 
"KRN",8994,1917,1,19,0)
 
"KRN",8994,1917,1,20,0)
Example "M" call and results:
"KRN",8994,1917,1,21,0)
 
"KRN",8994,1917,1,22,0)
 
"KRN",8994,1917,1,23,0)
 
"KRN",8994,1917,1,24,0)
D RPC^PSBCSUTL("",783,24,1)
"KRN",8994,1917,1,25,0)
 
"KRN",8994,1917,1,26,0)
RPC Call: PSB COVERSHEET1
"KRN",8994,1917,1,27,0)
Results[0] = 90
"KRN",8994,1917,1,28,0)
Results[1] = 1^0^1^1^COVERSHEET DATA FOLLOWS^1^4
"KRN",8994,1917,1,29,0)
Results[2] = ORD^783^85U^85^U^C^Q6H^^NITROGLYCERIN PATCH^200MG 
"KRN",8994,1917,1,30,0)
^EPIDURAL^3070501.115014^^^^455^0^0^PATCH^***^G^3070501.09^A^^^0^3070523.0
"KRN",8994,1917,1,31,0)
718^3070501.115014^1
"KRN",8994,1917,1,32,0)
Results[3] = ORC^!TEST MED THERAPY ANTIANGINALS
"KRN",8994,1917,1,33,0)
Results[4] = DD^2313^NITROGLYCERIN PATCHES 10MG/24HR^1^
"KRN",8994,1917,1,34,0)
Results[5] = 
"KRN",8994,1917,1,35,0)
ADM^3070501.09^^100000746^G^3070501.115014^TEJ^10000000039^^3070501.1500
"KRN",8994,1917,1,36,0)
Results[6] = CMT^THIS SHOULD SHOW ON THE MED THERAPY PER 56   
"KRN",8994,1917,1,37,0)
ANTIANGINALS^^10000000039^TEJ^3070501.115014
"KRN",8994,1917,1,38,0)
Results[7] = ADM^3070506.15^^^^^^^^3070501.1500
"KRN",8994,1917,1,39,0)
Results[8] = ADM^3070506.21^^^^^^^^3070501.1500
"KRN",8994,1917,1,40,0)
Results[9] = ADM^3070507.03^^^^^^^^3070501.1500
"KRN",8994,1917,1,41,0)
Results[10] = ADM^3070507.09^^^^^^^^3070501.1500
"KRN",8994,1917,1,42,0)
Results[11] = ADM^3070507.15^^^^^^^^3070501.1500
"KRN",8994,1917,1,43,0)
Results[12] = ADM^3070507.21^^^^^^^^3070501.1500
"KRN",8994,1917,1,44,0)
Results[13] = ADM^3070508.03^^^^^^^^3070501.1500
"KRN",8994,1917,1,45,0)
Results[14] = ADM^3070508.09^^^^^^^^3070501.1500
"KRN",8994,1917,1,46,0)
Results[15] = END
"KRN",8994,1917,1,47,0)
Results[16] = ORD^783^83U^83^U^C^Q3H^^RANITIDINE TAB^150MG 
"KRN",8994,1917,1,48,0)
^ORAL^3070405.12403^^^^558^0^0^TAB^***^R^3070430.1^A^^^0^3070602.1207^^1
"KRN",8994,1917,1,49,0)
Results[17] = ORC^!TEST THE ADMIN TIMES REPORT W/ DATE RANGE +3DAYS
"KRN",8994,1917,1,50,0)
Results[18] = DD^5094^RANITIDINE 150MG TAB^1^
"KRN",8994,1917,1,51,0)
Results[19] = ADM^3070506.13^^^^^^^^3070430.1000
"KRN",8994,1917,1,52,0)
Results[20] = ADM^3070506.16^^^^^^^^3070430.1000
"KRN",8994,1917,1,53,0)
Results[21] = ADM^3070506.19^^^^^^^^3070430.1000
"KRN",8994,1917,1,54,0)
Results[22] = ADM^3070506.22^^^^^^^^3070430.1000
"KRN",8994,1917,1,55,0)
Results[23] = ADM^3070507.01^^^^^^^^3070430.1000
"KRN",8994,1917,1,56,0)
Results[24] = ADM^3070507.04^^^^^^^^3070430.1000
"KRN",8994,1917,1,57,0)
Results[25] = ADM^3070507.07^^^^^^^^3070430.1000
"KRN",8994,1917,1,58,0)
Results[26] = ADM^3070507.1^^^^^^^^3070430.1000
"KRN",8994,1917,1,59,0)
Results[27] = ADM^3070507.13^^^^^^^^3070430.1000
"KRN",8994,1917,1,60,0)
Results[28] = ADM^3070507.16^^^^^^^^3070430.1000
"KRN",8994,1917,1,61,0)
Results[29] = ADM^3070507.19^^^^^^^^3070430.1000
"KRN",8994,1917,1,62,0)
Results[30] = ADM^3070507.22^^^^^^^^3070430.1000
"KRN",8994,1917,1,63,0)
Results[31] = ADM^3070508.01^^^^^^^^3070430.1000
"KRN",8994,1917,1,64,0)
Results[32] = ADM^3070508.04^^^^^^^^3070430.1000
"KRN",8994,1917,1,65,0)
Results[33] = ADM^3070508.07^^^^^^^^3070430.1000
"KRN",8994,1917,1,66,0)
Results[34] = ADM^3070508.1^^^^^^^^3070430.1000
"KRN",8994,1917,1,67,0)
Results[35] = ADM^3070508.13^^^^^^^^3070430.1000
"KRN",8994,1917,1,68,0)
Results[36] = END
"KRN",8994,1917,1,69,0)
Results[37] = ORD^783^84U^84^U^C^Q3H^^ISOSORBIDE DINITRATE TAB,ORAL^40MG 
"KRN",8994,1917,1,70,0)
^ORAL^^^^^354^0^0^TAB,ORAL^***^^3070501.07^A^^^0^3070603.04^^1
"KRN",8994,1917,1,71,0)
Results[38] = ORC^!TEST MED THERAPY ANTIANGINALS
"KRN",8994,1917,1,72,0)
Results[39] = DD^2191^ISOSORBIDE  20MG TAB ^2^
"KRN",8994,1917,1,73,0)
Results[40] = ADM^3070506.13^^^^^^^^3070501.0700
"KRN",8994,1917,1,74,0)
Results[41] = ADM^3070506.16^^^^^^^^3070501.0700
"KRN",8994,1917,1,75,0)
Results[42] = ADM^3070506.19^^^^^^^^3070501.0700
"KRN",8994,1917,1,76,0)
Results[43] = ADM^3070506.22^^^^^^^^3070501.0700
"KRN",8994,1917,1,77,0)
Results[44] = ADM^3070507.01^^^^^^^^3070501.0700
"KRN",8994,1917,1,78,0)
Results[45] = ADM^3070507.04^^^^^^^^3070501.0700
"KRN",8994,1917,1,79,0)
Results[46] = ADM^3070507.07^^^^^^^^3070501.0700
"KRN",8994,1917,1,80,0)
Results[47] = ADM^3070507.1^^^^^^^^3070501.0700
"KRN",8994,1917,1,81,0)
Results[48] = ADM^3070507.13^^^^^^^^3070501.0700
"KRN",8994,1917,1,82,0)
Results[49] = ADM^3070507.16^^^^^^^^3070501.0700
"KRN",8994,1917,1,83,0)
Results[50] = ADM^3070507.19^^^^^^^^3070501.0700
"KRN",8994,1917,1,84,0)
Results[51] = ADM^3070507.22^^^^^^^^3070501.0700
"KRN",8994,1917,1,85,0)
Results[52] = ADM^3070508.01^^^^^^^^3070501.0700
"KRN",8994,1917,1,86,0)
Results[53] = ADM^3070508.04^^^^^^^^3070501.0700
"KRN",8994,1917,1,87,0)
Results[54] = ADM^3070508.07^^^^^^^^3070501.0700
"KRN",8994,1917,1,88,0)
Results[55] = ADM^3070508.1^^^^^^^^3070501.0700
"KRN",8994,1917,1,89,0)
Results[56] = ADM^3070508.13^^^^^^^^3070501.0700
"KRN",8994,1917,1,90,0)
Results[57] = END
"KRN",8994,1917,1,91,0)
Results[58] = ORD^783^86U^86^U^C^Q3H^^PENTAERYTHRITOL TETRANITRATE 
"KRN",8994,1917,1,92,0)
TAB,ORAL^10MG 
"KRN",8994,1917,1,93,0)
^ORAL^3070501.125733^^^^481^0^0^TAB,ORAL^***^G^3070501.09^A^^^0^3070614.06
"KRN",8994,1917,1,94,0)
11^3070501.125733^1
"KRN",8994,1917,1,95,0)
Results[59] = ORC^!TEST THIS ONE TOO ANTIANGINALS
"KRN",8994,1917,1,96,0)
Results[60] = DD^251^PENTAERYTHRITOL  10MG TAB^1^
"KRN",8994,1917,1,97,0)
Results[61] = 
"KRN",8994,1917,1,98,0)
ADM^3070501.125733^^100000747^G^3070501.125733^TEJ^10000000039^^3070501.15
"KRN",8994,1917,1,99,0)
00
"KRN",8994,1917,1,100,0)
Results[62] = ADM^3070506.15^^^^^^^^3070501.1500
"KRN",8994,1917,1,101,0)
Results[63] = ADM^3070506.18^^^^^^^^3070501.1500
"KRN",8994,1917,1,102,0)
Results[64] = ADM^3070506.21^^^^^^^^3070501.1500
"KRN",8994,1917,1,103,0)
Results[65] = ADM^3070506.24^^^^^^^^3070501.1500
"KRN",8994,1917,1,104,0)
Results[66] = ADM^3070507.03^^^^^^^^3070501.1500
"KRN",8994,1917,1,105,0)
Results[67] = ADM^3070507.06^^^^^^^^3070501.1500
"KRN",8994,1917,1,106,0)
Results[68] = ADM^3070507.09^^^^^^^^3070501.1500
"KRN",8994,1917,1,107,0)
Results[69] = ADM^3070507.12^^^^^^^^3070501.1500
"KRN",8994,1917,1,108,0)
Results[70] = ADM^3070507.15^^^^^^^^3070501.1500
"KRN",8994,1917,1,109,0)
Results[71] = ADM^3070507.18^^^^^^^^3070501.1500
"KRN",8994,1917,1,110,0)
Results[72] = ADM^3070507.21^^^^^^^^3070501.1500
"KRN",8994,1917,1,111,0)
Results[73] = ADM^3070507.24^^^^^^^^3070501.1500
"KRN",8994,1917,1,112,0)
Results[74] = ADM^3070508.03^^^^^^^^3070501.1500
"KRN",8994,1917,1,113,0)
Results[75] = ADM^3070508.06^^^^^^^^3070501.1500
"KRN",8994,1917,1,114,0)
Results[76] = ADM^3070508.09^^^^^^^^3070501.1500
"KRN",8994,1917,1,115,0)
Results[77] = ADM^3070508.12^^^^^^^^3070501.1500
"KRN",8994,1917,1,116,0)
Results[78] = END
"KRN",8994,1917,1,117,0)
Results[79] = ORD^783^56V^56^V^C^^^POTASSIUM (K) LIQUID,ORAL^ 780 
"KRN",8994,1917,1,118,0)
ml/hr^INTRACARDIAC INTRA-ARTICULAR 
"KRN",8994,1917,1,119,0)
INTRAVENOUS^3070125.142403^^^^512^0^0^^***^S^3070423.08^A^^^0^3070525.2204
"KRN",8994,1917,1,120,0)
^^3
"KRN",8994,1917,1,121,0)
Results[80] = ORC^!THERE WILL BE NO ACTION ON THIS ORDER!!  nox)
"KRN",8994,1917,1,122,0)
Results[81] = ORF^CPRS^CPRS^REASON FOR THE CPRS FLAG...
"KRN",8994,1917,1,123,0)
Results[82] = ORF^NOX^No Action Taken On Order
"KRN",8994,1917,1,124,0)
Results[83] = ADD^24^KCL^78 MEQ^
"KRN",8994,1917,1,125,0)
Results[84] = SOL^14^DEXTROSE 5% IN N. SALINE^1000 ML^
"KRN",8994,1917,1,126,0)
Results[85] = ID^783V241^ADD;24^SOL;14
"KRN",8994,1917,1,127,0)
Results[86] = ID^783V240^ADD;24^SOL;14
"KRN",8994,1917,1,128,0)
Results[87] = ID^783V239^ADD;24^SOL;14
"KRN",8994,1917,1,129,0)
Results[88] = ID^783V238^ADD;24^SOL;14
"KRN",8994,1917,1,130,0)
Results[89] = ID^783V237^ADD;24^SOL;14
"KRN",8994,1917,1,131,0)
Results[90] = SI^Watch for next hour for any reaction to this medication 
"KRN",8994,1917,1,132,0)
Results[91] = SI^and stop administration if any side effects are observed
"KRN",8994,1917,1,133,0)
Results[92] = SI^and call Provider immediately for consult.
"KRN",8994,1917,1,134,0)
Results[93] = END
"KRN",8994,1917,2,0)
^8994.02A^5^4
"KRN",8994,1917,2,2,0)
DFN^1^^1^1
"KRN",8994,1917,2,2,1,0)
^8994.021^1^1^3070712^^^^
"KRN",8994,1917,2,2,1,1,0)
DFN is the internal entity number per the patient file (file #2).
"KRN",8994,1917,2,3,0)
HRSBACK^1^^0^2
"KRN",8994,1917,2,3,1,0)
^^2^2^3070712^
"KRN",8994,1917,2,3,1,1,0)
HRSBACK - (optional) The number of hours in the past the coversheet will 
"KRN",8994,1917,2,3,1,2,0)
supply order information for.  [default is 24 hours]
"KRN",8994,1917,2,4,0)
PSBSIOPI^1^1^0^3
"KRN",8994,1917,2,4,1,0)
^8994.021^5^5^3120313^^^
"KRN",8994,1917,2,4,1,1,0)
 This parameter is a true/false flag (1/0).  If true use the new SI/OP Wp
"KRN",8994,1917,2,4,1,2,0)
 fields and return data in the Results array to the GUI Client.
"KRN",8994,1917,2,4,1,3,0)
  
"KRN",8994,1917,2,4,1,4,0)
 The field is not required, so a null will convert into a 0, for false,
"KRN",8994,1917,2,4,1,5,0)
 making this backwards compatible.
"KRN",8994,1917,2,5,0)
PSBCLINORD^1^1^0^4
"KRN",8994,1917,2,5,1,0)
^8994.021^6^6^3120517^^
"KRN",8994,1917,2,5,1,1,0)
This parameter is a True/False flag (1/0).  If true, then return only
"KRN",8994,1917,2,5,1,2,0)
Clinic Orders and not Inpatient Medication orders to BCMA, else if false,
"KRN",8994,1917,2,5,1,3,0)
return only Inpatient Medication orders to BCMA.
"KRN",8994,1917,2,5,1,4,0)
 
"KRN",8994,1917,2,5,1,5,0)
The field is not required, so a null will convert into a 0, for a default
"KRN",8994,1917,2,5,1,6,0)
false value, making this backwards compatible.
"KRN",8994,1917,2,"B","DFN",2)

"KRN",8994,1917,2,"B","HRSBACK",3)

"KRN",8994,1917,2,"B","PSBCLINORD",5)

"KRN",8994,1917,2,"B","PSBSIOPI",4)

"KRN",8994,1917,2,"PARAMSEQ",1,2)

"KRN",8994,1917,2,"PARAMSEQ",2,3)

"KRN",8994,1917,2,"PARAMSEQ",3,4)

"KRN",8994,1917,2,"PARAMSEQ",4,5)

"KRN",8994,1917,3,0)
^^116^116^3121115^
"KRN",8994,1917,3,1,0)
(modified 05/08/2007)
"KRN",8994,1917,3,2,0)
 
"KRN",8994,1917,3,3,0)
Remote Procedure Call - PSB COVERSHEET1
"KRN",8994,1917,3,4,0)
RESULTS():
"KRN",8994,1917,3,5,0)
The return data will be listed in the RESULTS "global".
"KRN",8994,1917,3,6,0)
 
"KRN",8994,1917,3,7,0)
Results[0] =  ^1      Total lines in Results array
"KRN",8994,1917,3,8,0)
 
"KRN",8994,1917,3,9,0)
Results[1] =  ^1      Data for the Unit Dose tab (0=no, 1=yes)
"KRN",8994,1917,3,10,0)
              ^2      Data for the Piggy Back tab (0=no, 1=yes
"KRN",8994,1917,3,11,0)
              ^3      Data for the IV tab (0=no, 1=yes)
"KRN",8994,1917,3,12,0)
              ^4      1 = orders exist;  -1 = an error
"KRN",8994,1917,3,13,0)
              ^5      if ^4 = 1, then COVERSHEET DATA FOLLOWS text
"KRN",8994,1917,3,14,0)
                      if ^4 =-1, then error text
"KRN",8994,1917,3,15,0)
              ^6      Inpatient Meds order count
"KRN",8994,1917,3,16,0)
              ^7      Clinic orders count
"KRN",8994,1917,3,17,0)
 
"KRN",8994,1917,3,18,0)
RESULTS data will be presented with "headers":
"KRN",8994,1917,3,19,0)
 
"KRN",8994,1917,3,20,0)
ORD - Order data
"KRN",8994,1917,3,21,0)
 Order specific data
"KRN",8994,1917,3,22,0)
^1  "ORD"-header
"KRN",8994,1917,3,23,0)
^2  Patient's IEN
"KRN",8994,1917,3,24,0)
^3  Order #_Order type
"KRN",8994,1917,3,25,0)
^4  Order #
"KRN",8994,1917,3,26,0)
^5  Order type
"KRN",8994,1917,3,27,0)
^6  Schedule type
"KRN",8994,1917,3,28,0)
^7  Schedule
"KRN",8994,1917,3,29,0)
^8  Self med
"KRN",8994,1917,3,30,0)
^9  Drug name
"KRN",8994,1917,3,31,0)
^10 Dosage/Flow rate
"KRN",8994,1917,3,32,0)
^11 Med route
"KRN",8994,1917,3,33,0)
^12 Last Action Date/Time
"KRN",8994,1917,3,34,0)
^13 ""
"KRN",8994,1917,3,35,0)
^14 ""
"KRN",8994,1917,3,36,0)
^15 ""
"KRN",8994,1917,3,37,0)
^16 Orderable item (IEN)
"KRN",8994,1917,3,38,0)
^17 Injectable?
"KRN",8994,1917,3,39,0)
^18 Variable dose?
"KRN",8994,1917,3,40,0)
^19 Dosage form
"KRN",8994,1917,3,41,0)
^20 Verifying nurse initials (*** if none)
"KRN",8994,1917,3,42,0)
^21 Last action status (whole order)
"KRN",8994,1917,3,43,0)
^22 Order start date/time (FM)
"KRN",8994,1917,3,44,0)
^23 Order status
"KRN",8994,1917,3,45,0)
^24 ""
"KRN",8994,1917,3,46,0)
^25 ""
"KRN",8994,1917,3,47,0)
^26 Transaction type
"KRN",8994,1917,3,48,0)
^27 Order stop date/time (FM)
"KRN",8994,1917,3,49,0)
^28 Last Given Date/Time
"KRN",8994,1917,3,50,0)
^29 Virtual Due List (VDL) tab indicator = "UD":1 "IVPB":2 "IV":3
"KRN",8994,1917,3,51,0)
^30 Override/Intervention reasons/comments exist (0=No;1=Yes) 
"KRN",8994,1917,3,52,0)
^31 (IVPB tab usage)
"KRN",8994,1917,3,53,0)
^32 Clinic Name (if a Clinic order, else null)
"KRN",8994,1917,3,54,0)
^33 Clinic ien pointer (if a Clinic order, else null)
"KRN",8994,1917,3,55,0)
 
"KRN",8994,1917,3,56,0)
 
"KRN",8994,1917,3,57,0)
ORC - Order Comment/Special instruction
"KRN",8994,1917,3,58,0)
^1  "ORC"- header
"KRN",8994,1917,3,59,0)
^2  Special instruction
"KRN",8994,1917,3,60,0)
 
"KRN",8994,1917,3,61,0)
 
"KRN",8994,1917,3,62,0)
ORF - Order Flag
"KRN",8994,1917,3,63,0)
^1  "ORF"- header
"KRN",8994,1917,3,64,0)
^2  type of flag
"KRN",8994,1917,3,65,0)
^3  flag origin
"KRN",8994,1917,3,66,0)
^4  associated comment
"KRN",8994,1917,3,67,0)
 
"KRN",8994,1917,3,68,0)
 
"KRN",8994,1917,3,69,0)
DD  - Dispense Drug
"KRN",8994,1917,3,70,0)
^1  "DD" - header
"KRN",8994,1917,3,71,0)
^2  Dispense drug IEN
"KRN",8994,1917,3,72,0)
^3  Dispense drug name
"KRN",8994,1917,3,73,0)
^4  Units per dose
"KRN",8994,1917,3,74,0)
^5  Inactive date
"KRN",8994,1917,3,75,0)
 
"KRN",8994,1917,3,76,0)
ADD - Additive
"KRN",8994,1917,3,77,0)
^1  "ADD" - header
"KRN",8994,1917,3,78,0)
^2  Additive IEN
"KRN",8994,1917,3,79,0)
^3  Additive name
"KRN",8994,1917,3,80,0)
^4  Strength
"KRN",8994,1917,3,81,0)
^5  Bottle
"KRN",8994,1917,3,82,0)
 
"KRN",8994,1917,3,83,0)
SOL - Solution
"KRN",8994,1917,3,84,0)
^1  "SOL" - header
"KRN",8994,1917,3,85,0)
^2  Solution IEN
"KRN",8994,1917,3,86,0)
^3  Solution name
"KRN",8994,1917,3,87,0)
^4  Volume
"KRN",8994,1917,3,88,0)
 
"KRN",8994,1917,3,89,0)
ID  - Identification
"KRN",8994,1917,3,90,0)
^1  "ID" - header
"KRN",8994,1917,3,91,0)
^2  ID number
"KRN",8994,1917,3,92,0)
^3  Additive IEN
"KRN",8994,1917,3,93,0)
 
"KRN",8994,1917,3,94,0)
ADM - Administration
"KRN",8994,1917,3,95,0)
^1  "ADM" - header
"KRN",8994,1917,3,96,0)
^2  Scheduled admin date/time
"KRN",8994,1917,3,97,0)
^3  Bag id
"KRN",8994,1917,3,98,0)
^4  Med log ien
"KRN",8994,1917,3,99,0)
^5  Action
"KRN",8994,1917,3,100,0)
^6  Date/time
"KRN",8994,1917,3,101,0)
^7  Action by initials
"KRN",8994,1917,3,102,0)
^8  Action by ien
"KRN",8994,1917,3,103,0)
^9  Prn reason
"KRN",8994,1917,3,104,0)
^10 Next Action Date/Time
"KRN",8994,1917,3,105,0)
 
"KRN",8994,1917,3,106,0)
CMT - Comment per administration
"KRN",8994,1917,3,107,0)
^1  "CMT" - header
"KRN",8994,1917,3,108,0)
^2  Comment
"KRN",8994,1917,3,109,0)
^3  Prn effectiveness 
"KRN",8994,1917,3,110,0)
 
"KRN",8994,1917,3,111,0)
SI - WP text for Special Instruction/Other Print Info
"KRN",8994,1917,3,112,0)
^1    Literal "SI"
"KRN",8994,1917,3,113,0)
^2    Special Instruction/Other Print Info text line
"KRN",8994,1917,3,114,0)
 
"KRN",8994,1917,3,115,0)
END - End
"KRN",8994,1917,3,116,0)
^1  "END" - header
"KRN",8994,3007,-1)
0^7
"KRN",8994,3007,0)
PSB WITNESS^WITNESS^PSBRPC1^2^P
"KRN",8994,3007,1,0)
^8994.01^6^6^3130426^^
"KRN",8994,3007,1,1,0)
Used by frmWintess to validate if a Witness at the client is authorized 
"KRN",8994,3007,1,2,0)
to be a witness for a BCMA action, i.e. High Risk Drug administration.
"KRN",8994,3007,1,3,0)
 
"KRN",8994,3007,1,4,0)
Validation is achieved via not allowing the logged in person to witness 
"KRN",8994,3007,1,5,0)
for themselves, also persons that hold certain keys can't be a valid 
"KRN",8994,3007,1,6,0)
witness.
"KRN",8994,3007,2,0)
^8994.02A^2^2
"KRN",8994,3007,2,1,0)
PSBACC^1^^1^1
"KRN",8994,3007,2,1,1,0)
^^1^1^3120508^
"KRN",8994,3007,2,1,1,1,0)
Access Code
"KRN",8994,3007,2,2,0)
PSBVER^1^^1^2
"KRN",8994,3007,2,2,1,0)
^8994.021^1^1^3130426^^
"KRN",8994,3007,2,2,1,1,0)
Verify Code.
"KRN",8994,3007,2,"B","PSBACC",1)

"KRN",8994,3007,2,"B","PSBVER",2)

"KRN",8994,3007,2,"PARAMSEQ",1,1)

"KRN",8994,3007,2,"PARAMSEQ",2,2)

"KRN",8994,3007,3,0)
^^23^23^3130426^
"KRN",8994,3007,3,1,0)
Results array is returned in the following forms:
"KRN",8994,3007,3,2,0)
  
"KRN",8994,3007,3,3,0)
  Valid authorization of Witness.
"KRN",8994,3007,3,4,0)
   
"KRN",8994,3007,3,5,0)
      Results[0] = 'Witness DUZ^Witness Name'
"KRN",8994,3007,3,6,0)
  
"KRN",8994,3007,3,7,0)
  Invalid authorization of Witness.
"KRN",8994,3007,3,8,0)
   
"KRN",8994,3007,3,9,0)
      Results[0] = '-1^Invalid Witness sign-on'
"KRN",8994,3007,3,10,0)
            Or     '-1^Cannot Witness for yourself'
"KRN",8994,3007,3,11,0)
            Or     '-1^A student does not have authority to witness a 
"KRN",8994,3007,3,12,0)
                       High Risk/High Alert administration.'
"KRN",8994,3007,3,13,0)
            Or     '-1^You do not have authority to witness a 
"KRN",8994,3007,3,14,0)
                       High Risk/High Alert administration.'
"KRN",8994,3007,3,15,0)
            Or     '-1^Read-Only users do not have authority to witness a 
"KRN",8994,3007,3,16,0)
                       High Risk/High Alert administration.'
"KRN",8994,3007,3,17,0)
            Or     '-1^Invalid VistA user - No Primary menu setup for 
"KRN",8994,3007,3,18,0)
                       this user in the NEW PERSON file.'
"KRN",8994,3007,3,19,0)
            Or     '-1^A non-BCMA user does not have authority to witness 
"KRN",8994,3007,3,20,0)
                       a High Risk/High Alert administration.'
"KRN",8994,3007,3,21,0)
 
"KRN",8994,3007,3,22,0)
 Success of the call is validated by the first up-arrow piece of data 
"KRN",8994,3007,3,23,0)
 being greater than 0.
"KRN",8994,3008,-1)
0^2
"KRN",8994,3008,0)
PSB CLINICLIST^GETLIST^PSBRPC^4^P^^^1^3
"KRN",8994,3008,1,0)
^^1^1^3120619^
"KRN",8994,3008,1,1,0)
Returns Active Clinic names based on Search criteria.
"KRN",8994,3008,2,0)
^8994.02A^2^2
"KRN",8994,3008,2,1,0)
PREFIX^1^30^0^1
"KRN",8994,3008,2,1,1,0)
^8994.021^2^2^3120601^^
"KRN",8994,3008,2,1,1,1,0)
First search criteria, which is used to find clinic names that begin with 
"KRN",8994,3008,2,1,1,2,0)
these characters to create a subset list.
"KRN",8994,3008,2,2,0)
CONTAINS^1^30^0^2
"KRN",8994,3008,2,2,1,0)
^^4^4^3120531^
"KRN",8994,3008,2,2,1,1,0)
Second search criteria, if populated, then this search text is used to 
"KRN",8994,3008,2,2,1,2,0)
search the previously created Subset list, for if Contains this text.
"KRN",8994,3008,2,2,1,3,0)
 
"KRN",8994,3008,2,2,1,4,0)
Then this final list is sent back to the BCMA GUI Client.
"KRN",8994,3008,2,"B","CONTAINS",2)

"KRN",8994,3008,2,"B","PREFIX",1)

"KRN",8994,3008,2,"PARAMSEQ",1,1)

"KRN",8994,3008,2,"PARAMSEQ",2,2)

"KRN",8994,3008,3,0)
^8994.03^6^6^3120626^^
"KRN",8994,3008,3,1,0)
Return a list of active clinics by name, per search request, in the 
"KRN",8994,3008,3,2,0)
Results array.
"KRN",8994,3008,3,3,0)
 
"KRN",8994,3008,3,4,0)
   Results[0] =  ^1      The number of lines returned(count)
"KRN",8994,3008,3,5,0)
  
"KRN",8994,3008,3,6,0)
   Results[n] =  ^1      Clinic Name
"KRN",8994,3062,-1)
0^10
"KRN",8994,3062,0)
PSB MEDS ON PATIENT^MEDSONPT^PSBRPC1^2^S^^^^3
"KRN",8994,3062,1,0)
^8994.01^4^4^3120929^
"KRN",8994,3062,1,1,0)
This RPC returns indicators if medications are still on a patient.  The 
"KRN",8994,3062,1,2,0)
patient's DFN will be passed in and a RESULTS array returned with three 
"KRN",8994,3062,1,3,0)
flags set.  Flags set to 1 for meds are on patient or 0 none per this
"KRN",8994,3062,1,4,0)
category.
"KRN",8994,3062,2,0)
^8994.02A^1^1
"KRN",8994,3062,2,1,0)
DFN^1^^1^1
"KRN",8994,3062,2,1,1,0)
^^1^1^3120929^
"KRN",8994,3062,2,1,1,1,0)
Patient DFN
"KRN",8994,3062,2,"B","DFN",1)

"KRN",8994,3062,2,"PARAMSEQ",1,1)

"KRN",8994,3062,3,0)
^^7^7^3120929^
"KRN",8994,3062,3,1,0)
A string with 3 pieces that indicate if Medications are on a patient per a
"KRN",8994,3062,3,2,0)
specific category.  
"KRN",8994,3062,3,3,0)
 
"KRN",8994,3062,3,4,0)
   Results[0] =  ^1      The number of lines returned(count)
"KRN",8994,3062,3,5,0)
   Results[1] =  ^1      IV Meds are Infusing (1=exist, 0=do not exist)
"KRN",8994,3062,3,6,0)
                 ^2      IV Meds are Stopped (1=exist, 0=do not exist)
"KRN",8994,3062,3,7,0)
                 ^3      Patch on (1=exist, 0=do not exist)
"MBREQ")
0
"ORD",3,19.1)
19.1;3;;;KEY^XPDTA1;KEYF1^XPDIA1;KEYE1^XPDIA1;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",8,.403)
.403;8;;;EDEOUT^DIFROMSO(.403,DA,"",XPDA);FPRE^DIFROMSI(.403,"",XPDA);EPRE^DIFROMSI(.403,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.403,DA,"",XPDA);DEL^DIFROMSK(.403,"",%)
"ORD",8,.403,0)
FORM
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"ORD",21,8989.52)
8989.52;21;1;;PAR2E1^XPDTA2;PAR2F1^XPDIA3;PAR2E1^XPDIA3;PAR2F2^XPDIA3;;PAR2DEL^XPDIA3(%)
"ORD",21,8989.52,0)
PARAMETER TEMPLATE
"PKG",536,-1)
1^1
"PKG",536,0)
BAR CODE MED ADMIN^PSB^BAR CODE MEDICATION ADMINISTRATION
"PKG",536,20,0)
^9.402P^^
"PKG",536,22,0)
^9.49I^1^1
"PKG",536,22,1,0)
3.0^3040224^3040819^11874
"PKG",536,22,1,"PAH",1,0)
70^3131101^10000000009
"PKG",536,22,1,"PAH",1,1,0)
^^1^1^3131101
"PKG",536,22,1,"PAH",1,1,1,0)
Clinic Order and Witness for High Risk / High Alert drugs.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
46
"RTN","PSBCSUTL")
0^4^B171997833^B149737589
"RTN","PSBCSUTL",1,0)
PSBCSUTL ;BIRMINGHAM/TEJ- BCMA-HSC COVER SHEET UTILITIES ;11/15/12 2:40pm
"RTN","PSBCSUTL",2,0)
 ;;3.0;BAR CODE MED ADMIN;**16,13,38,32,50,60,58,68,70**;Mar 2004;Build 101
"RTN","PSBCSUTL",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBCSUTL",4,0)
 ;
"RTN","PSBCSUTL",5,0)
 ; Reference/IA
"RTN","PSBCSUTL",6,0)
 ; EN^PSJBCMA/2828
"RTN","PSBCSUTL",7,0)
 ; IN5^VADPT/10061
"RTN","PSBCSUTL",8,0)
 ; $$GET^XPAR/2263
"RTN","PSBCSUTL",9,0)
 ; ^%DTC/10000
"RTN","PSBCSUTL",10,0)
 ; $$FMADD^XLFDT/10103
"RTN","PSBCSUTL",11,0)
 ; $$GET1^DIQ/2056
"RTN","PSBCSUTL",12,0)
 ; EN1^GMVDCEXT/4251
"RTN","PSBCSUTL",13,0)
 ; GETPROVL^PSGSICH1/5653
"RTN","PSBCSUTL",14,0)
 ; INTRDIC^PSGSICH1/5654
"RTN","PSBCSUTL",15,0)
 ;
"RTN","PSBCSUTL",16,0)
 ;*58 - add 30th piece to Results for Override/Intervention flag 1/0
"RTN","PSBCSUTL",17,0)
 ;*68 - add new parameter to use new SI/OPI word processing fields
"RTN","PSBCSUTL",18,0)
 ;*70 - add Clinic order request IN param flag (true/false 0/1).
"RTN","PSBCSUTL",19,0)
 ;      also add to return array ORD line 32 piece Clinic name for CO.
"RTN","PSBCSUTL",20,0)
 ;      for CO mode: set to -7 days for pulling pull meds & viewing
"RTN","PSBCSUTL",21,0)
 ;       Expired/DC'd orders; set to +7 days to view future orders.
"RTN","PSBCSUTL",22,0)
 ;
"RTN","PSBCSUTL",23,0)
 ; ** Warning: PSBSIOPI & PSBCLINORD will be used as global variables
"RTN","PSBCSUTL",24,0)
 ;             for all down stream calls from this RPC tag.
"RTN","PSBCSUTL",25,0)
 ;
"RTN","PSBCSUTL",26,0)
RPC(RESULTS,DFN,EXPWIN,PSBSIOPI,PSBCLINORD) ;
"RTN","PSBCSUTL",27,0)
 K RESULTS,^TMP("PSB",$J),^TMP("PSJ",$J)
"RTN","PSBCSUTL",28,0)
 S EXPWIN=+$G(EXPWIN)       ;*70
"RTN","PSBCSUTL",29,0)
 S PSBSIOPI=+$G(PSBSIOPI)   ;*68 init to 0 if not present or 1 if sent
"RTN","PSBCSUTL",30,0)
 S PSBCLINORD=+$G(PSBCLINORD)                   ;*70 init to 0 if null
"RTN","PSBCSUTL",31,0)
 S PSBTAB="CVRSHT"
"RTN","PSBCSUTL",32,0)
 N PSBCNT S PSBTRFL=0,PSBDFNX=DFN
"RTN","PSBCSUTL",33,0)
 D PAINCMT(DFN) ;;Correct Comment if Pain Score entered in BCMA was marked "Entered in Error" in Vitals. (PSB*3*50)
"RTN","PSBCSUTL",34,0)
 S RESULTS=$NAME(^TMP("PSB",$J,PSBTAB))
"RTN","PSBCSUTL",35,0)
 K ^TMP("PSB",$J,PSBTAB) S ^TMP("PSB",$J,PSBTAB,0)=1 D LIGHTS(PSBDFNX)
"RTN","PSBCSUTL",36,0)
 S ^TMP("PSB",$J,PSBTAB,0)=1,^TMP("PSB",$J,PSBTAB,1)=^TMP("PSB",$J,PSBTAB,1)
"RTN","PSBCSUTL",37,0)
 Q:$P(^TMP("PSB",$J,PSBTAB,1),U,4)=-1
"RTN","PSBCSUTL",38,0)
 D NOW^%DTC S PSBNOW=+$E(%,1,10),PSBDT=$P(%,".",1)
"RTN","PSBCSUTL",39,0)
 ;set range
"RTN","PSBCSUTL",40,0)
 ;*70 - use diff window values for CO mode vs IM mode
"RTN","PSBCSUTL",41,0)
 I PSBCLINORD D
"RTN","PSBCSUTL",42,0)
 . S:'EXPWIN EXPWIN=24*7   ;not passed in def to 7 days
"RTN","PSBCSUTL",43,0)
 . S PSBWBEG=$P($$FMADD^XLFDT(PSBNOW,-EXPWIN\24),".")
"RTN","PSBCSUTL",44,0)
 . S PSBWEND=$P($$FMADD^XLFDT(PSBNOW,EXPWIN\24),".")
"RTN","PSBCSUTL",45,0)
 E  D
"RTN","PSBCSUTL",46,0)
 . S:'EXPWIN EXPWIN=24   ;not passed in def to 24 hr
"RTN","PSBCSUTL",47,0)
 . S PSBWBEG=$$FMADD^XLFDT(PSBNOW,"",-EXPWIN)
"RTN","PSBCSUTL",48,0)
 . S PSBWEND=$$FMADD^XLFDT(PSBNOW,"",EXPWIN)
"RTN","PSBCSUTL",49,0)
 ;
"RTN","PSBCSUTL",50,0)
 S PSBWADM=$$GET^XPAR("DIV","PSB ADMIN BEFORE"),PSBMHBCK=$$GET^XPAR("ALL","PSB MED HIST DAYS BACK",,"B") I +PSBMHBCK=0 S PSBMHBCK=30
"RTN","PSBCSUTL",51,0)
 D NOW^%DTC S PSBWADM=$$FMADD^XLFDT(%,"","",+PSBWADM),PSBMHBCK=$$FMADD^XLFDT(%,-1*(PSBMHBCK))
"RTN","PSBCSUTL",52,0)
 ;use lst movemnt for API
"RTN","PSBCSUTL",53,0)
 S VAIP("D")="LAST" D IN5^VADPT S PSBTRDT=+VAIP(3),PSBTRTYP=$P(VAIP(2),U,2),PSBMVTYP=$P(VAIP(4),U,2) K VAIP
"RTN","PSBCSUTL",54,0)
 S PSBPTTR=$$GET^XPAR("DIV","PSB PATIENT TRANSFER") I PSBPTTR="" S PSBPTTR=72
"RTN","PSBCSUTL",55,0)
 D NOW^%DTC S PSBNTDT=$$FMADD^XLFDT(%,"",-PSBPTTR) I PSBNTDT'>PSBTRDT S PSBTRFL=1
"RTN","PSBCSUTL",56,0)
 ;*70  go back 7 days to pull meds for clinic orders
"RTN","PSBCSUTL",57,0)
 S X1=$P(PSBNOW,"."),X2=$S(PSBCLINORD:-7,1:-3) D C^%DTC
"RTN","PSBCSUTL",58,0)
 D EN^PSJBCMA(PSBDFNX,X,$S(PSBMHBCK<PSBWBEG:PSBMHBCK,PSBWBEG<PSBMHBCK:PSBWBEG,1:PSBMHBCK))
"RTN","PSBCSUTL",59,0)
 ;Filter in/out Clinic Orders               *70
"RTN","PSBCSUTL",60,0)
 D:PSBCLINORD
"RTN","PSBCSUTL",61,0)
 . I $D(PSBRPT(2)) D FILTERCO^PSBO Q
"RTN","PSBCSUTL",62,0)
 . D INCLUDCO^PSBVDLU1
"RTN","PSBCSUTL",63,0)
 D:'PSBCLINORD REMOVECO^PSBVDLU1
"RTN","PSBCSUTL",64,0)
 ;Devlop Outp
"RTN","PSBCSUTL",65,0)
 S PSBTBOUT=0
"RTN","PSBCSUTL",66,0)
 I ^TMP("PSJ",$J,1,0)>0 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:('PSBX)!(PSBTBOUT)  D
"RTN","PSBCSUTL",67,0)
 .S:(PSBTAB'="CVRSHT")&($G(^TMP("PSB",$J,"CVRSHT",2))>0) PSBTBOUT=1
"RTN","PSBCSUTL",68,0)
 .D CLEAN^PSBVT,PSJ^PSBVT(PSBX),NOW^%DTC
"RTN","PSBCSUTL",69,0)
 .Q:PSBONX["P"  Q:(PSBOSP<PSBWBEG)&'(PSBONX["V")  ;in rnge?
"RTN","PSBCSUTL",70,0)
 .S (PSBREC,PSBONTAB)=""
"RTN","PSBCSUTL",71,0)
 .S $P(PSBREC,U,1)=PSBDFN ;Dfn
"RTN","PSBCSUTL",72,0)
 .S $P(PSBREC,U,2)=PSBONX ;OrdX 
"RTN","PSBCSUTL",73,0)
 .S $P(PSBREC,U,3)=PSBON ;Ord#
"RTN","PSBCSUTL",74,0)
 .S $P(PSBREC,U,4)=PSBOTYP ;v/u/p
"RTN","PSBCSUTL",75,0)
 .S $P(PSBREC,U,5)=PSBSCHT ;Schtyp
"RTN","PSBCSUTL",76,0)
 .S $P(PSBREC,U,6)=PSBSCH ;Sch
"RTN","PSBCSUTL",77,0)
 .S $P(PSBREC,U,7)=$S(PSBHSM:"HSM",PSBSM:"SM",1:"") ; slfmed
"RTN","PSBCSUTL",78,0)
 .S $P(PSBREC,U,8)=PSBOITX ;Drgnm
"RTN","PSBCSUTL",79,0)
 .S $P(PSBREC,U,9)=PSBDOSE_" "_PSBIFR ;Dose
"RTN","PSBCSUTL",80,0)
 .S $P(PSBREC,U,10)=PSBMR ;med route
"RTN","PSBCSUTL",81,0)
 .;Lst Gvn -AOIP xRef
"RTN","PSBCSUTL",82,0)
 .S (PSBCNT,PSBFLAG)=0,(Y,PSBSTUS)="" K PSBHSTA,PSBHSTAX
"RTN","PSBCSUTL",83,0)
 .F XZ=1:1:20 S Y=$O(^PSB(53.79,"AOIP",PSBDFN,PSBOIT,Y),-1),(PSBCNT,PSBFLAG)=0 Q:Y=""  D
"RTN","PSBCSUTL",84,0)
 ..S:Y>0 $P(PSBREC,U,11)=Y
"RTN","PSBCSUTL",85,0)
 ..S X="" F  S X=$O(^PSB(53.79,"AOIP",PSBDFN,PSBOIT,Y,X),-1) Q:X=""  D
"RTN","PSBCSUTL",86,0)
 ...S PSBSTUS=$P(^PSB(53.79,X,0),U,9) S:$G(PSBSTUS)="" PSBSTUS="X" I (PSBSTUS'="N") S PSBFLAG=1,PSBHSTA(Y,$G(PSBSTUS))="ORIG"_U_X
"RTN","PSBCSUTL",87,0)
 ...D:PSBSTUS="N"
"RTN","PSBCSUTL",88,0)
 ....S ($P(PSBREC,U,11),Z)=""
"RTN","PSBCSUTL",89,0)
 ....F  S Z=$O(^PSB(53.79,X,.9,Z),-1) Q:'Z  Q:PSBFLAG=1  S PSBDATA=$G(^(Z,0)) D
"RTN","PSBCSUTL",90,0)
 .....I (PSBDATA["Set to 'NOT GIVEN'")!(PSBDATA["Set to 'GIVEN'")!(PSBDATA["Set to 'REFUSED'")!(PSBDATA["Set to 'HELD'")!(PSBDATA["Set to 'MISSING DOSE'")!(PSBDATA["Set to 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBCSUTL",91,0)
 .....I (PSBDATA["STATUS 'HELD'")!(PSBDATA["STATUS 'GIVEN'")!(PSBDATA["STATUS 'REFUSED'")!(PSBDATA["STATUS 'MISSING DOSE'")!(PSBDATA["STATUS 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBCSUTL",92,0)
 .....I PSBCNT#2=0,PSBDATA["'REFUSED'" S PSBSTUS="R" D LAST^PSBVDLU1
"RTN","PSBCSUTL",93,0)
 .....I PSBCNT#2=0,PSBDATA["'HELD'" S PSBSTUS="H" D LAST^PSBVDLU1
"RTN","PSBCSUTL",94,0)
 .....I PSBCNT#2=0,PSBDATA["'MISSING DOSE'" S PSBSTUS="M" D LAST^PSBVDLU1
"RTN","PSBCSUTL",95,0)
 .....I PSBCNT#2=0,PSBDATA["'REMOVED'" S PSBSTUS="RM" D LAST^PSBVDLU1
"RTN","PSBCSUTL",96,0)
 .....I PSBFLAG=1,'$D(PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))) S PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))=Z_U_X
"RTN","PSBCSUTL",97,0)
 .I $D(PSBHSTA) S $P(PSBREC,U,11)=$O(PSBHSTA(""),-1),PSBSTUS=$O(PSBHSTA($P(PSBREC,U,11),""),-1) M PSBHSTAX(PSBOIT)=PSBHSTA K PSBHSTA  ;last action date/time
"RTN","PSBCSUTL",98,0)
 .S $P(PSBREC,U,12)="" ;ien - below
"RTN","PSBCSUTL",99,0)
 .S $P(PSBREC,U,13)="" ;sttus - below
"RTN","PSBCSUTL",100,0)
 .S $P(PSBREC,U,14)="" ;admn dte - below
"RTN","PSBCSUTL",101,0)
 .S $P(PSBREC,U,15)=PSBOIT ;OI Pointer
"RTN","PSBCSUTL",102,0)
 .S $P(PSBREC,U,16)=PSBNJECT  ;njctble med route flag
"RTN","PSBCSUTL",103,0)
 .;Var dosg
"RTN","PSBCSUTL",104,0)
 .I $P(PSBREC,U,9)?1.4N1"-"1.4N.E S $P(PSBREC,U,17)=1
"RTN","PSBCSUTL",105,0)
 .E  S $P(PSBREC,U,17)=0
"RTN","PSBCSUTL",106,0)
 .S:PSBDOSEF?1"CAP".E!(PSBDOSEF?1"TAB".E)!(PSBDOSEF="PATCH") $P(PSBREC,U,18)=PSBDOSEF ;DosgFrm
"RTN","PSBCSUTL",107,0)
 .D PSJ1^PSBVT(PSBDFN,PSBONX)
"RTN","PSBCSUTL",108,0)
 .S PSBPB=$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,+$G(PSBIVPSH)),PSBLVIV=0
"RTN","PSBCSUTL",109,0)
 .Q:PSBPB&(PSBOSP<PSBWBEG)
"RTN","PSBCSUTL",110,0)
 .S:(PSBONX["V"&'PSBPB) PSBLVIV=1
"RTN","PSBCSUTL",111,0)
 .S $P(PSBREC,U,19)=$S(PSBVNI]"":PSBVNI,PSBVNI']"":"***") ;VerfNrsInts
"RTN","PSBCSUTL",112,0)
 .S $P(PSBREC,U,20)=PSBSTUS S:$P(PSBREC,U,11)="" $P(PSBREC,U,20)=""  ;LstActn
"RTN","PSBCSUTL",113,0)
 .S $P(PSBREC,U,21)=PSBOST
"RTN","PSBCSUTL",114,0)
 .S $P(PSBREC,U,22)=PSBOSTS
"RTN","PSBCSUTL",115,0)
 .S $P(PSBREC,U,25)=0 I $G(PSBTRFL),$P(PSBREC,U,11)]"",$P(PSBREC,U,11)'<$G(PSBNTDT),$P(PSBREC,U,11)'>$G(PSBTRDT) S $P(PSBREC,U,25)=1
"RTN","PSBCSUTL",116,0)
 .S $P(PSBREC,U,26)=PSBOSP  ;OrdStpDt/Tm
"RTN","PSBCSUTL",117,0)
 .S $P(PSBREC,U,27)=$$LASTG($P(PSBREC,U,1),$P(PSBREC,U,15))
"RTN","PSBCSUTL",118,0)
 .S $P(PSBREC,U,28)=$S((PSBONX["U")&('PSBPB):1,PSBPB:2,(PSBONX["V")&'PSBPB:3,1:"")
"RTN","PSBCSUTL",119,0)
 .;*58 determine if override exists, send 1/0 (true/false)
"RTN","PSBCSUTL",120,0)
 .N PSBARR D GETPROVL^PSGSICH1(DFN,PSBONX,.PSBARR)
"RTN","PSBCSUTL",121,0)
 .I $O(PSBARR(""))="" D INTRDIC^PSGSICH1(DFN,PSBONX,.PSBARR,2)
"RTN","PSBCSUTL",122,0)
 .S $P(PSBREC,U,29)=$S($O(PSBARR(""))]"":1,1:0)
"RTN","PSBCSUTL",123,0)
 .;*70 add Clinic name & ien ptr to piece 32 and 33 for CO's, remember
"RTN","PSBCSUTL",124,0)
 .;   "ORD" is inserted later as piece 1 which offsets all here by +1
"RTN","PSBCSUTL",125,0)
 .S $P(PSBREC,U,31)=$G(PSBCLORD)
"RTN","PSBCSUTL",126,0)
 .S $P(PSBREC,U,32)=$G(PSBCLIEN)
"RTN","PSBCSUTL",127,0)
 .;get all Admn(s) - DD info.
"RTN","PSBCSUTL",128,0)
 .S (PSBDDS,PSBSOLS,PSBADDS,PSBFLAG)="0"
"RTN","PSBCSUTL",129,0)
 .;PSB*3*60 adds additional checks to ensure an expired order is within the coversheet time parameter and an "END" is only added to the temp global after an order is added
"RTN","PSBCSUTL",130,0)
 .I PSBLVIV D XFERBAGS^PSBCSUTY,LVIV^PSBCSUTY I $G(PSBEXPRD) S X1=$O(^TMP("PSB",$J,PSBTAB,""),-1) S:^TMP("PSB",$J,PSBTAB,X1)'="END"&(X1>1) ^TMP("PSB",$J,PSBTAB,X1+1)="END" Q  ;PSB*3*60
"RTN","PSBCSUTL",131,0)
 .D GETADMX^PSBCSUTY
"RTN","PSBCSUTL",132,0)
 .F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBCSUTL",133,0)
 ..I $P(PSBDDA(Y),U,5)=$P(%,".") S PSBFLAG=1  ;drug nactvt
"RTN","PSBCSUTL",134,0)
 ..Q:$P(PSBDDA(Y),U,5)&($P(PSBDDA(Y),U,5)<%)  ;nactv
"RTN","PSBCSUTL",135,0)
 ..S:$P(PSBDDA(Y),U,4)="" $P(PSBDDA(Y),U,4)=1
"RTN","PSBCSUTL",136,0)
 ..S PSBDDS=PSBDDS_U_$P(PSBDDA(Y),U,1,4),$P(PSBDDS,U,1)=PSBDDS+1
"RTN","PSBCSUTL",137,0)
 .;OnCa O PRN
"RTN","PSBCSUTL",138,0)
 .I ("^O^OC^P^"[(U_PSBSCHT_U))!(PSBLVIV) D  S ($P(PSBREC,U,12),$P(PSBREC,U,14))=""  Q
"RTN","PSBCSUTL",139,0)
 ..S (PSBIENX,PSBGOT1)="",PSBADMTM="" F  S PSBADMTM=$O(^PSB(53.79,"AORDX",PSBDFNX,PSBONX,PSBADMTM)) Q:(PSBADMTM="")  D
"RTN","PSBCSUTL",140,0)
 ...Q:(PSBADMTM<PSBMHBCK)&'PSBLVIV
"RTN","PSBCSUTL",141,0)
 ...F  S PSBIENX=$O(^PSB(53.79,"AORDX",PSBDFNX,PSBONX,PSBADMTM,PSBIENX)) Q:PSBIENX=""  D
"RTN","PSBCSUTL",142,0)
 ....S $P(PSBREC,U,12)=PSBIENX,$P(PSBREC,U,14)=PSBADMTM,$P(PSBREC,U,23)=$$GET1^DIQ(53.79,PSBIENX_",","IV UNIQUE ID")
"RTN","PSBCSUTL",143,0)
 ....S PSBQRR=1 I PSBWBEG<PSBOSP D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBADMTM,PSBDDS,PSBSOLS,PSBADDS,"CVRSHT") S PSBGOT1=1 ;PSB*3*60
"RTN","PSBCSUTL",144,0)
 ..I ('+PSBGOT1)&(PSBOSP'<PSBWBEG) D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1_".",PSBDDS,PSBSOLS,PSBADDS,"CVRSHT") S PSBGOT1=1
"RTN","PSBCSUTL",145,0)
 ..I ('+PSBGOT1)&($D(PSBADMX(PSBONX)))&(PSBWBEG<PSBOSP) D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1_".",PSBDDS,PSBSOLS,PSBADDS,"CVRSHT") ;PSB*3*60
"RTN","PSBCSUTL",146,0)
 ..S PSBGLBX=$O(^TMP("PSB",$J,PSBTAB,""),-1) S:^TMP("PSB",$J,PSBTAB,PSBGLBX)'="END"&(PSBGLBX>1) ^TMP("PSB",$J,PSBTAB,PSBGLBX+1)="END" ;PSB*3*60
"RTN","PSBCSUTL",147,0)
 .;cont - proces AdmnTm
"RTN","PSBCSUTL",148,0)
 .S (PSBYES,PSBODD,PSBYTF)=0 S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBCSUTL",149,0)
 .I PSBYES,PSBADST="" Q
"RTN","PSBCSUTL",150,0)
 .F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1,PSBYTF=1
"RTN","PSBCSUTL",151,0)
 .I PSBSCHT="C",PSBYTF="1",PSBADST="" Q
"RTN","PSBCSUTL",152,0)
 .S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBCSUTL",153,0)
 .I PSBFREQ="O" S PSBFREQ=1440
"RTN","PSBCSUTL",154,0)
 .I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBCSUTL",155,0)
 .S:PSBLVIV PSBYES=1
"RTN","PSBCSUTL",156,0)
 .I 'PSBYES,PSBFREQ<1 Q
"RTN","PSBCSUTL",157,0)
 .I (PSBADST="")&(+PSBFREQ>0) D ODDSCH^PSBVDLU1(PSBTAB) Q
"RTN","PSBCSUTL",158,0)
 .I +PSBFREQ>0 I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBCSUTL",159,0)
 .I PSBODD,PSBADST'="" Q
"RTN","PSBCSUTL",160,0)
 .S PSBDTX=PSBWBEG\1,PSBGOT1=0
"RTN","PSBCSUTL",161,0)
 .F PSBXX=1:1:2 D  S PSBDTX=$$FMADD^XLFDT(PSBDTX,"",24)  ;incrmnt 1 day!
"RTN","PSBCSUTL",162,0)
 ..F PSBY=1:1:$L(PSBADST,"-") Q:$P(PSBADST,"-",PSBY)=""  D
"RTN","PSBCSUTL",163,0)
 ...S PSB=+(PSBDTX_"."_$P(PSBADST,"-",PSBY))
"RTN","PSBCSUTL",164,0)
 ...I (PSB'<PSBWBEG)&(PSB'>PSBWEND) D  ;wndow?
"RTN","PSBCSUTL",165,0)
 ....D:(PSB'<PSBOST)&(PSB<PSBOSP)    ;actv?
"RTN","PSBCSUTL",166,0)
 .....D:$$OKAY^PSBVDLU1(PSBOST,PSB,PSBSCH,PSBONX,PSBOITX,PSBFREQ,PSBOSTS)  ;dt?
"RTN","PSBCSUTL",167,0)
 ......D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"CVRSHT") S PSBGOT1=1
"RTN","PSBCSUTL",168,0)
 ...S PSB=+(PSBWEND\1_"."_$P(PSBADST,"-",PSBY))
"RTN","PSBCSUTL",169,0)
 ...I (PSB'<PSBWBEG)&(PSB'>PSBWEND) D  ;wndow?
"RTN","PSBCSUTL",170,0)
 ....D:(PSB'<PSBOST)&(PSB<PSBOSP)    ;actv?
"RTN","PSBCSUTL",171,0)
 .....D:$$OKAY^PSBVDLU1(PSBOST,PSB,PSBSCH,PSBONX,PSBOITX,PSBFREQ,PSBOSTS)  ;dt?
"RTN","PSBCSUTL",172,0)
 ......D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"CVRSHT") S PSBGOT1=1
"RTN","PSBCSUTL",173,0)
 .I ('PSBGOT1)&(PSBOSP'<PSBWBEG) D ADD^PSBVDLU1(PSBREC,PSBOTXT,+(PSBWEND\1_"."_$P(PSBADST,"-")),PSBDDS,PSBSOLS,PSBADDS,"CVRSHT")
"RTN","PSBCSUTL",174,0)
 .K PSBSTUS
"RTN","PSBCSUTL",175,0)
 D EN^PSBVDLPA
"RTN","PSBCSUTL",176,0)
 I $G(^TMP("PSB",$J,PSBTAB,2))]"" S PSBI1=$O(^TMP("PSB",$J,PSBTAB,""),-1) I ^TMP("PSB",$J,PSBTAB,PSBI1)'="END" S ^TMP("PSB",$J,PSBTAB,PSBI1+1)="END"
"RTN","PSBCSUTL",177,0)
 S ^TMP("PSB",$J,PSBTAB,0)=$O(^TMP("PSB",$J,PSBTAB,""),-1)
"RTN","PSBCSUTL",178,0)
 I $G(^TMP("PSB",$J,PSBTAB,2))']"" S $P(^TMP("PSB",$J,PSBTAB,1),U,4)="-1^No orders to display on Coversheet"     ;*70 was "To" now "to"
"RTN","PSBCSUTL",179,0)
 I $G(^TMP("PSB",$J,PSBTAB,2))]"" S $P(^TMP("PSB",$J,PSBTAB,1),U,4)="1^COVERSHEET DATA FOLLOWS" D ADD^PSBCSUTX
"RTN","PSBCSUTL",180,0)
 D CLEAN
"RTN","PSBCSUTL",181,0)
 Q
"RTN","PSBCSUTL",182,0)
LASTG(PSBPATPT,PSBOIPT) ;LstGvn-(inpt: DFN,OrItm IEN)
"RTN","PSBCSUTL",183,0)
 K PSBHSTG S Y="",LASTG="" F XZ=1:1:20 S Y=$O(^PSB(53.79,"AOIP",PSBPATPT,PSBOIPT,Y),-1),(PSBCNT,PSBFLAG)=0 Q:Y=""  D
"RTN","PSBCSUTL",184,0)
 .S:Y>0 LASTG="",X="" F  S X=$O(^PSB(53.79,"AOIP",PSBPATPT,PSBOIPT,Y,X),-1) Q:X=""  D
"RTN","PSBCSUTL",185,0)
 ..S PSBSTX=$P(^PSB(53.79,X,0),U,9) S:PSBSTX']"" PSBHSTG(Y)=-1 I PSBSTX="G"  S PSBHSTG(Y)="G"
"RTN","PSBCSUTL",186,0)
 ..Q:PSBSTX="N"
"RTN","PSBCSUTL",187,0)
 ..D:(PSBSTX'="G")
"RTN","PSBCSUTL",188,0)
 ...S Z="" F  S Z=$O(^PSB(53.79,X,.9,Z),-1) Q:'Z  Q:PSBFLAG=1  S PSBDATA=$G(^(Z,0)) D
"RTN","PSBCSUTL",189,0)
 ....I (PSBDATA["Set to 'GIVEN'") S PSBCNT=PSBCNT+1
"RTN","PSBCSUTL",190,0)
 ....I (PSBDATA["STATUS 'GIVEN'") S PSBCNT=PSBCNT+1
"RTN","PSBCSUTL",191,0)
 ....I PSBCNT#2=0,PSBDATA'["'GIVEN'" Q
"RTN","PSBCSUTL",192,0)
 ....I '$D(PSBHSTG($P(PSBDATA,U))) S PSBFLAG=1,PSBHSTG($P(PSBDATA,U))=""
"RTN","PSBCSUTL",193,0)
 I $D(PSBHSTG) S LASTG="" F  S LASTG=$O(PSBHSTG(LASTG),-1) Q:+LASTG=0  Q:PSBHSTG(LASTG)="G"  I PSBHSTG(LASTG)=-1 S LASTG="" Q
"RTN","PSBCSUTL",194,0)
 Q LASTG
"RTN","PSBCSUTL",195,0)
PAINCMT(DFN) ;;Add comment if Pain Score entered in BCMA was marked "Entered in Error" in Vitals.
"RTN","PSBCSUTL",196,0)
 ;;This will run through all the patients appointments, check their comments to see if they had a Pain Vital entered  through BCMA, and check if that Vital was marked "Entered in Error."
"RTN","PSBCSUTL",197,0)
 Q:'$D(^DPT(DFN,0))
"RTN","PSBCSUTL",198,0)
 N PSBCMT,PSBGMR,PSBCMTGLB,PSBIEN,PSBCMTM,PSBVITM,PSBTMDF,PSBBDT,PSBEDT,PSBEFTM,PSBCMFL,PSBEXTM,PSBERFL,PSBPNSC,PSBNOW,PSBDFN,PSBPRNDT,PSBSTRTDT,PSBMDHST,PSBEFFL,PSBCOMMENT,X,X1,X2
"RTN","PSBCSUTL",199,0)
 K ^TMP("PSBGMV",$J)
"RTN","PSBCSUTL",200,0)
 D NOW^%DTC S PSBEDT=%
"RTN","PSBCSUTL",201,0)
 S PSBMDHST=+($$GET^XPAR("ALL","PSB MED HIST DAYS BACK",,"B")) S:+$G(PSBMDHST)=0 PSBMDHST=30
"RTN","PSBCSUTL",202,0)
 S X1=$P(PSBEDT,"."),X2=-(PSBMDHST) D C^%DTC S PSBMDHST=X
"RTN","PSBCSUTL",203,0)
 S PSBSTRTDT=$S($G(PSBSTRT)]0:PSBSTRT,1:PSBMDHST)
"RTN","PSBCSUTL",204,0)
 S PSBPRNDT=PSBSTRTDT F  S PSBPRNDT=$O(^PSB(53.79,"APRN",DFN,PSBPRNDT)) Q:'PSBPRNDT  D
"RTN","PSBCSUTL",205,0)
 .S PSBIEN=0 F  S PSBIEN=$O(^PSB(53.79,"APRN",DFN,PSBPRNDT,PSBIEN)) Q:'PSBIEN  D
"RTN","PSBCSUTL",206,0)
 ..S PSBCMT=0 F  S PSBCMT=$O(^PSB(53.79,PSBIEN,.3,PSBCMT)) Q:'PSBCMT  S PSBCMTGLB=^PSB(53.79,PSBIEN,.3,PSBCMT,0) D
"RTN","PSBCSUTL",207,0)
 ...I $P($G(PSBCMTGLB),U)["Pain Score of" D
"RTN","PSBCSUTL",208,0)
 ....I $E($P($G(PSBCMTGLB),U),1,14)="*Pain Score of" S PSBCMFL=""
"RTN","PSBCSUTL",209,0)
 ....I $E($P($G(PSBCMTGLB),U),1,15)="**Pain Score of" S PSBEFFL=""
"RTN","PSBCSUTL",210,0)
 ....S PSBCMTM=$P($G(PSBCMTGLB),U,3)
"RTN","PSBCSUTL",211,0)
 ....S PSBBDT=$E(PSBCMTM,1,12)
"RTN","PSBCSUTL",212,0)
 ....S PSBEXTM=$$FMTE^XLFDT(PSBBDT,"5Z")
"RTN","PSBCSUTL",213,0)
 ....I '$D(^TMP("PSBGMV",$J)) D EN1^GMVDCEXT("^TMP(""PSBGMV"",$J)",DFN,2,,1,PSBSTRTDT,PSBEDT,,1)
"RTN","PSBCSUTL",214,0)
 ....S PSBGMR=0 F  S PSBGMR=$O(^TMP("PSBGMV",$J,PSBGMR)) Q:PSBGMR=""  I $P(^TMP("PSBGMV",$J,PSBGMR),U,4)="PN" D
"RTN","PSBCSUTL",215,0)
 .....S PSBVITM=$P(^TMP("PSBGMV",$J,PSBGMR),U,5)
"RTN","PSBCSUTL",216,0)
 .....S PSBTMDF=$$FMDIFF^XLFDT(PSBVITM,PSBCMTM,2)
"RTN","PSBCSUTL",217,0)
 .....I PSBTMDF>=-($S($G(DILOCKTM)>0:DILOCKTM,1:3)),PSBTMDF<=$S($G(DILOCKTM)>0:DILOCKTM,1:3) D
"RTN","PSBCSUTL",218,0)
 ......I $P(^TMP("PSBGMV",$J,PSBGMR),U,9)=1 S PSBPNSC=$P(^TMP("PSBGMV",$J,PSBGMR),U,8),PSBERFL=""
"RTN","PSBCSUTL",219,0)
 ..I $D(PSBERFL),'$D(PSBCMFL) S PSBCOMMENT="*Pain Score of "_PSBPNSC_" entered in Vitals via BCMA at "_PSBEXTM_" may have been marked 'Entered in Error'. See Vitals Package for an updated Score." D COMMENT^PSBML(PSBIEN,PSBCOMMENT)
"RTN","PSBCSUTL",220,0)
 ..K PSBCMFL,PSBERFL
"RTN","PSBCSUTL",221,0)
 ..S PSBEFTM=$P($G(^PSB(53.79,PSBIEN,.2)),U,4) Q:PSBEFTM=""
"RTN","PSBCSUTL",222,0)
 ..S PSBBDT=$E(PSBEFTM,1,12)
"RTN","PSBCSUTL",223,0)
 ..S PSBEXTM=$$FMTE^XLFDT(PSBBDT,"5Z")
"RTN","PSBCSUTL",224,0)
 ..D:'$D(^TMP("PSBGMV",$J)) EN1^GMVDCEXT("^TMP(""PSBGMV"",$J)",DFN,2,,1,PSBSTRTDT,PSBEDT,,1)
"RTN","PSBCSUTL",225,0)
 ..S PSBGMR=0 F  S PSBGMR=$O(^TMP("PSBGMV",$J,PSBGMR)) Q:PSBGMR=""  I $P(^TMP("PSBGMV",$J,PSBGMR),U,4)="PN" D
"RTN","PSBCSUTL",226,0)
 ...S PSBVITM=$P(^TMP("PSBGMV",$J,PSBGMR),U,5)
"RTN","PSBCSUTL",227,0)
 ...S PSBTMDF=$$FMDIFF^XLFDT(PSBVITM,PSBEFTM,2)
"RTN","PSBCSUTL",228,0)
 ...I PSBTMDF>=-($S($G(DILOCKTM)>0:DILOCKTM,1:3)),PSBTMDF<=$S($G(DILOCKTM)>0:DILOCKTM,1:3)  D
"RTN","PSBCSUTL",229,0)
 ....I $P(^TMP("PSBGMV",$J,PSBGMR),U,9)=1 S PSBPNSC=$P(^TMP("PSBGMV",$J,PSBGMR),U,8),PSBERFL=""
"RTN","PSBCSUTL",230,0)
 ..I $D(PSBERFL),'$D(PSBEFFL) S PSBCOMMENT="**Pain Score of "_PSBPNSC_" entered in Vitals via BCMA at "_PSBEXTM_" may have been marked 'Entered in Error'. See Vitals Package for an updated Score." D COMMENT^PSBML(PSBIEN,PSBCOMMENT)
"RTN","PSBCSUTL",231,0)
 ..K PSBERFL,PSBEFFL
"RTN","PSBCSUTL",232,0)
 K ^TMP("PSBGMV",$J)
"RTN","PSBCSUTL",233,0)
 Q
"RTN","PSBCSUTL",234,0)
LIGHTS(PSBDFN) ;
"RTN","PSBCSUTL",235,0)
 D RPC^PSBVDLTB(,PSBDFN,"NO TAB",,PSBSIOPI,PSBCLINORD) S PSBTAB="CVRSHT"
"RTN","PSBCSUTL",236,0)
 M ^TMP("PSB",$J,PSBTAB,1)=^TMP("PSB",$J,"NO TAB",1) K ^TMP("PSB",$J,"NO TAB")
"RTN","PSBCSUTL",237,0)
 Q
"RTN","PSBCSUTL",238,0)
CLEAN ;
"RTN","PSBCSUTL",239,0)
 D CLEAN^PSBVT
"RTN","PSBCSUTL",240,0)
 K PSBACT,PSBACTBY,PSBACTDT,PSBACTPT,PSBADDS,PSBBAGID,PSBCHDT,PSBCHKV,PSBCNT1,PSBCNT2,PSBDDS,PSBDFNX,PSBWEND
"RTN","PSBCSUTL",241,0)
 K PSBDT,PSBFLAG,PSBHSTAX,PSBI1,PSBIEN,PSBIENX,PSBLSTS,PSBMAUD,PSBMVTYP,PSBMWC,PSBNOW,PSBNTDT,PSBONMBR,PSBY,PSBXX
"RTN","PSBCSUTL",242,0)
 K PSBONXS,PSBORREC,PSBPDT,PSBPRNRE,PSBPTTR,PSBQR,PSBRDOW,PSBREC,PSBRECHD,PSBSCHBR,PSBSCHTM,PSBSOLS,PSBTAB,PSBADMTM,PSBDTX
"RTN","PSBCSUTL",243,0)
 K PSBTBOUT,PSBTRDT,PSBTRFL,PSBTRTYP,PSBUID,PSBUIDS,PSBX,PSBXIEN,PSBX2,PSBYEA,PSBYEA1,PSBYTF,PSBYES,VAIP,PSBWADM,PSBWBEG
"RTN","PSBCSUTL",244,0)
 K PSBXREC,PSBGOT1,PSBCDT,PSBQUIT,PSBUSED,PSBLST4X,PSBADMX,PSBI2,PSBXXX,PSBI,PSBPB,PSBSHWTB,PSBONTAB,PSBDONE,^TMP("PSJ",$J)
"RTN","PSBCSUTL",245,0)
 K PSBNXTDU,LASTG,LSTTIME,PSBMHBCK,PSBHSTG,PSBNXTDT,NEXTADM,PSBLVIV
"RTN","PSBCSUTL",246,0)
 Q
"RTN","PSBMD")
0^39^B90525242^B75575865
"RTN","PSBMD",1,0)
PSBMD ;BIRMINGHAM/EFC - BCMA MISSING DOSE FUNCTIONS ;11/15/12 2:54pm
"RTN","PSBMD",2,0)
 ;;3.0;BAR CODE MED ADMIN;**23,42,70**;Mar 2004;Build 101
"RTN","PSBMD",3,0)
 ;
"RTN","PSBMD",4,0)
 ; Reference/IA
"RTN","PSBMD",5,0)
 ; ^DIC(42/10039
"RTN","PSBMD",6,0)
 ; ^DPT(/10035
"RTN","PSBMD",7,0)
 ; IN5^VADPT/10061
"RTN","PSBMD",8,0)
 ; DEM^VADPT/10061
"RTN","PSBMD",9,0)
 ; ^XMB/10070
"RTN","PSBMD",10,0)
 ; 52.6/436
"RTN","PSBMD",11,0)
 ; 52.7/437
"RTN","PSBMD",12,0)
 ;
"RTN","PSBMD",13,0)
 ;*70 -  add new kernel variable for CO Missing Dose Printer.
"RTN","PSBMD",14,0)
 ;       use Clinc name if passed in for the new field Clinic or
"RTN","PSBMD",15,0)
 ;        assume Ward and get ien.
"RTN","PSBMD",16,0)
 ;
"RTN","PSBMD",17,0)
RPC(RESULTS,PSBDFN,PSBDRUG,PSBDOSE,PSBRSN,PSBADMIN,PSBNEED,PSBUID,PSBON,PSBSCHD,PSBCLIN,PSBCLNIEN) ;
"RTN","PSBMD",18,0)
 ;
"RTN","PSBMD",19,0)
 ; RPC: PSB SUBMIT MISSING DOSE
"RTN","PSBMD",20,0)
 ;
"RTN","PSBMD",21,0)
 ; Description:
"RTN","PSBMD",22,0)
 ; Allows the client to submit a missing dose interactively
"RTN","PSBMD",23,0)
 ;
"RTN","PSBMD",24,0)
 N DFN,PSBNOW,PSBFDA,PSBIENS,PSBMD,PSBMSG
"RTN","PSBMD",25,0)
 S PSBCLNIEN=+$G(PSBCLNIEN)    ;*70 insure numeric
"RTN","PSBMD",26,0)
 D NEW(.PSBMD)
"RTN","PSBMD",27,0)
 I +PSBMD(0)<1 S RESULTS(0)="-1^Unable to create missing dose request"  Q
"RTN","PSBMD",28,0)
 S PSBIENS=+PSBMD(0)_","
"RTN","PSBMD",29,0)
 D NOW^%DTC S PSBNOW=%
"RTN","PSBMD",30,0)
 S PSBFDA(53.68,PSBIENS,.02)=PSBNOW
"RTN","PSBMD",31,0)
 S PSBFDA(53.68,PSBIENS,.03)=DUZ
"RTN","PSBMD",32,0)
 S PSBFDA(53.68,PSBIENS,.04)=DUZ(2)
"RTN","PSBMD",33,0)
 S PSBFDA(53.68,PSBIENS,.11)=PSBDFN
"RTN","PSBMD",34,0)
 ; Ward or Clinic - use Clinic name if passed, else get Ward ien.  *70
"RTN","PSBMD",35,0)
 I PSBCLIN]"" D
"RTN","PSBMD",36,0)
 .S PSBFDA(53.68,PSBIENS,1)=PSBCLNIEN
"RTN","PSBMD",37,0)
 E  D
"RTN","PSBMD",38,0)
 .S X=$G(^DPT(PSBDFN,.1))
"RTN","PSBMD",39,0)
 .I X]"" S X=$O(^DIC(42,"B",X,0)) S:X PSBFDA(53.68,PSBIENS,.12)=X
"RTN","PSBMD",40,0)
 .S DFN=PSBDFN D IN5^VADPT S PSBFDA(53.68,PSBIENS,.18)=$P(VAIP(6),U,1)
"RTN","PSBMD",41,0)
 S PSBFDA(53.68,PSBIENS,.13)=PSBDRUG
"RTN","PSBMD",42,0)
 S PSBFDA(53.68,PSBIENS,.14)=PSBDOSE
"RTN","PSBMD",43,0)
 S PSBFDA(53.68,PSBIENS,.15)=PSBRSN
"RTN","PSBMD",44,0)
 S PSBFDA(53.68,PSBIENS,.16)=PSBADMIN
"RTN","PSBMD",45,0)
 S PSBFDA(53.68,PSBIENS,.17)=PSBNEED
"RTN","PSBMD",46,0)
 S PSBFDA(53.68,PSBIENS,.19)=PSBSCHD
"RTN","PSBMD",47,0)
 S PSBFDA(53.68,PSBIENS,.25)=PSBUID
"RTN","PSBMD",48,0)
 D FILE^DIE("","PSBFDA","PSBMSG")
"RTN","PSBMD",49,0)
 L +^PSB(53.68,+PSBIENS):$S($G(DILOCKTM)>0:DILOCKTM,1:3)  ; PSB*3*23
"RTN","PSBMD",50,0)
 I $G(PSBUID)'="" D
"RTN","PSBMD",51,0)
 .D PSJ1^PSBVT(PSBDFN,PSBON) K PSBADA,PSBSOLA
"RTN","PSBMD",52,0)
 .I '$D(PSBUIDA(PSBUID)) F  D PSJ1^PSBVT(PSBDFN,PSBPONX) K PSBADA,PSBSOLA Q:$D(PSBUIDA(PSBUID))  Q:PSBPONX=""
"RTN","PSBMD",53,0)
 .F I=1:1 S PSBAD=$P(PSBUIDA(PSBUID),U,I) Q:PSBAD=""  I PSBAD["ADD" S PSBADA($P(PSBAD,";",2))=""
"RTN","PSBMD",54,0)
 .I $D(PSBADA) S X="" F I=1:1 S X=$O(PSBADA(X)) Q:X=""  S PSBFDA(53.686,I_","_PSBIENS,.01)=X,^PSB(53.68,+PSBIENS,.6,I,0)=I
"RTN","PSBMD",55,0)
 .F I=1:1 S PSBSOL=$P(PSBUIDA(PSBUID),U,I) Q:PSBSOL=""  I PSBSOL["SOL" S PSBSOLA($P(PSBSOL,";",2))=""
"RTN","PSBMD",56,0)
 .I $D(PSBSOLA) S X="" F I=1:1 S X=$O(PSBSOLA(X)) Q:X=""  S PSBFDA(53.687,I_","_PSBIENS,.01)=X,^PSB(53.68,+PSBIENS,.7,I,0)=I
"RTN","PSBMD",57,0)
 I $G(PSBUID)="",$G(PSBDRUG)="" D
"RTN","PSBMD",58,0)
 .D PSJ1^PSBVT(PSBDFN,PSBON)
"RTN","PSBMD",59,0)
 .I $D(PSBADA) S X="" F I=1:1 S X=$O(PSBADA(X)) Q:X=""  S PSBFDA(53.686,I_","_PSBIENS,.01)=$P(PSBADA(X),U,2),^PSB(53.68,+PSBIENS,.6,I,0)=X
"RTN","PSBMD",60,0)
 .I $D(PSBSOLA) S X="" F I=1:1 S X=$O(PSBSOLA(X)) Q:X=""  S PSBFDA(53.687,I_","_PSBIENS,.01)=$P(PSBSOLA(X),U,2),^PSB(53.68,+PSBIENS,.7,I,0)=X
"RTN","PSBMD",61,0)
 D FILE^DIE("","PSBFDA","PSBMSG")
"RTN","PSBMD",62,0)
 L -^PSB(53.68,+PSBIENS) ; PSB83*23
"RTN","PSBMD",63,0)
 D SUBMIT(+PSBIENS)
"RTN","PSBMD",64,0)
 S RESULTS(0)="1^Missing Dose Submitted^"_+PSBIENS
"RTN","PSBMD",65,0)
 D CLEAN^PSBVT
"RTN","PSBMD",66,0)
 Q
"RTN","PSBMD",67,0)
 ;
"RTN","PSBMD",68,0)
XQ ; Called via Kernel Menus
"RTN","PSBMD",69,0)
 N PSBMD,PSBSAVE,DA,DIK,DR,DDSFILE,XMY,XMTEXT,XMSUB
"RTN","PSBMD",70,0)
 D NEW(.PSBMD)
"RTN","PSBMD",71,0)
 I +PSBMD(0)<1 W !,"Error: ",$P(PSBMD(0),U,2) S DIR(0)="E" D ^DIR Q
"RTN","PSBMD",72,0)
 S DA=+PSBMD(0),DR="[PSB MISSING DOSE REQUEST]",DDSFILE=53.68 D ^DDS
"RTN","PSBMD",73,0)
 W @IOF
"RTN","PSBMD",74,0)
 I 'PSBSAVE W !,"Cancelling Request..." S DIK="^PSB(53.68," D ^DIK W "Cancelled!"
"RTN","PSBMD",75,0)
 D:PSBSAVE SUBMIT(DA)
"RTN","PSBMD",76,0)
 Q
"RTN","PSBMD",77,0)
 ;
"RTN","PSBMD",78,0)
SUBMIT(DA) ; Submit Request to Pharmacy
"RTN","PSBMD",79,0)
 N PSBWRD,PSBMG,PSBPRT,CLIEN
"RTN","PSBMD",80,0)
 S PSBWRD=$P(^PSB(53.68,DA,.1),U,2)
"RTN","PSBMD",81,0)
 S PSBWRD=+$G(^DIC(42,+PSBWRD,44))
"RTN","PSBMD",82,0)
 I PSBCLIN]"" S CLIEN=+$O(^PS(53.46,"B",PSBCLNIEN,""))
"RTN","PSBMD",83,0)
 ;
"RTN","PSBMD",84,0)
 ; Get Mail Group
"RTN","PSBMD",85,0)
 ;
"RTN","PSBMD",86,0)
 S PSBMG=$$GET^XPAR(PSBWRD_";SC(","PSB MG MISSING DOSE",,"E")
"RTN","PSBMD",87,0)
 S:PSBMG="" PSBMG=$$GET^XPAR("DIV","PSB MG MISSING DOSE",,"E")
"RTN","PSBMD",88,0)
 S $P(^PSB(53.68,DA,0),U,5)=PSBMG ; Add MG to notification
"RTN","PSBMD",89,0)
 ;
"RTN","PSBMD",90,0)
 ; Get Printer - If NO printer can be found, then DO NOT print!!
"RTN","PSBMD",91,0)
 ;*70 - get CO printer if Clinic orders, else IM med & get IM printer
"RTN","PSBMD",92,0)
 ; IM printer uses Variable PSB PRINTER MISSING DOSE
"RTN","PSBMD",93,0)
 ; CO printer can come from 3 sources:
"RTN","PSBMD",94,0)
 ;  1st from Clinic Defintion file for the specific Clinic if defined
"RTN","PSBMD",95,0)
 ;  2nd from the Variable PSB PRINTER CO MISSING DOSE if defined
"RTN","PSBMD",96,0)
 ;  3rd just use the IM med printer Variable.
"RTN","PSBMD",97,0)
 ;
"RTN","PSBMD",98,0)
 D:PSBCLIN]""                                             ;*70
"RTN","PSBMD",99,0)
 .S PSBPRT=$$GET1^DIQ(53.46,CLIEN,4)
"RTN","PSBMD",100,0)
 .S:PSBPRT="" PSBPRT=$$GET^XPAR("DIV","PSB PRINTER CO MISSING DOSE",,"E")
"RTN","PSBMD",101,0)
 .S:PSBPRT="" PSBPRT=$$GET^XPAR("DIV","PSB PRINTER MISSING DOSE",,"E")
"RTN","PSBMD",102,0)
 D:PSBCLIN=""                                             ;*70
"RTN","PSBMD",103,0)
 .S PSBPRT=$$GET^XPAR(PSBWRD_";SC(","PSB PRINTER MISSING DOSE",,"E")
"RTN","PSBMD",104,0)
 .S:PSBPRT="" PSBPRT=$$GET^XPAR("DIV","PSB PRINTER MISSING DOSE",,"E")
"RTN","PSBMD",105,0)
 ;
"RTN","PSBMD",106,0)
 S $P(^PSB(53.68,DA,0),U,6)=PSBPRT ; Add MG to notification
"RTN","PSBMD",107,0)
 ;
"RTN","PSBMD",108,0)
 ; Send the report to the specified printer
"RTN","PSBMD",109,0)
 ;
"RTN","PSBMD",110,0)
 D:PSBPRT]""
"RTN","PSBMD",111,0)
 .W !,"Submitting Request To Pharmacy on device ",PSBPRT,"..."
"RTN","PSBMD",112,0)
 .D NOW^%DTC
"RTN","PSBMD",113,0)
 .S ZTIO=PSBPRT
"RTN","PSBMD",114,0)
 .S ZTDTH=%
"RTN","PSBMD",115,0)
 .S ZTDESC="BCMA - MISSING DOSE REQUEST"
"RTN","PSBMD",116,0)
 .S ZTRTN="DQ^PSBMD("_DA_")"
"RTN","PSBMD",117,0)
 .D ^%ZTLOAD
"RTN","PSBMD",118,0)
 .W "Done!"
"RTN","PSBMD",119,0)
 ;
"RTN","PSBMD",120,0)
 ; Send the same stuff to the mail group
"RTN","PSBMD",121,0)
 ;
"RTN","PSBMD",122,0)
 D:PSBMG]""
"RTN","PSBMD",123,0)
 .W !,"Notifying Pharmacy via Mail Group ",PSBMG,"..."
"RTN","PSBMD",124,0)
 .D HFSOPEN^PSBUTL("MISSING DOSE")
"RTN","PSBMD",125,0)
 .U IO D DQ(DA,1)
"RTN","PSBMD",126,0)
 .D HFSCLOSE^PSBUTL("MISSING DOSE")
"RTN","PSBMD",127,0)
 .S XMY("G."_PSBMG)="",XMTEXT="^TMP(""PSBO"",$J,"
"RTN","PSBMD",128,0)
 .S XMSUB="BCMA - Missing Dose Request"
"RTN","PSBMD",129,0)
 .D ^XMD
"RTN","PSBMD",130,0)
 .W "Done!"
"RTN","PSBMD",131,0)
 Q
"RTN","PSBMD",132,0)
 ;
"RTN","PSBMD",133,0)
DQ(PSBMD,PSBMM) ; Dequeue report from Taskman
"RTN","PSBMD",134,0)
 N PSBFLD,PSBRET
"RTN","PSBMD",135,0)
 Q:'$D(^PSB(53.68,PSBMD,0))
"RTN","PSBMD",136,0)
 L +^PSB(53.68,PSBMD):$S($G(DILOCKTM)>0:DILOCKTM,1:3) ; PSB*3*23
"RTN","PSBMD",137,0)
 S PSBCFLD=$P(^PSB(53.68,PSBMD,.1),U,3)
"RTN","PSBMD",138,0)
 L -^PSB(53.68,PSBMD) ; PSB*3*23
"RTN","PSBMD",139,0)
 D:'$G(PSBMM)  ; It is not a mail message
"RTN","PSBMD",140,0)
 .W !,$TR($J("",75)," ","=")
"RTN","PSBMD",141,0)
 .W !,"Report:       MISSING DOSE REQUEST"
"RTN","PSBMD",142,0)
 .W !,"Date Created: " D NOW^%DTC S Y=% D D^DIQ W Y
"RTN","PSBMD",143,0)
 .W !,$TR($J("",75)," ","="),!
"RTN","PSBMD",144,0)
 I $G(PSBCFLD)'="" F PSBFLD=.01,.02,.03,.04,.05,.06,.11,.12,.18,1,.13,.14,.19,.15,.16,.17 D OUT  ;*70
"RTN","PSBMD",145,0)
 I $G(PSBCFLD)="" F PSBFLD=.01,.02,.03,.04,.05,.06,.11,.12,.18,1,.25,.15,.19,.16,.17 D OUT  ;*70
"RTN","PSBMD",146,0)
 I $D(^PSB(53.68,PSBMD,.6)) S X=0 F  S X=$O(^PSB(53.68,PSBMD,.6,X)) Q:'X  W !?3,"ADDITIVE:  ",$$GET1^DIQ(52.6,+^PSB(53.68,PSBMD,.6,X,0),.01)
"RTN","PSBMD",147,0)
 I $D(^PSB(53.68,PSBMD,.7)) S X=0 F  S X=$O(^PSB(53.68,PSBMD,.7,X)) Q:'X  W !?3,"SOLUTION:  ",$$GET1^DIQ(52.7,+^PSB(53.68,PSBMD,.7,X,0),.01)
"RTN","PSBMD",148,0)
 Q
"RTN","PSBMD",149,0)
OUT ;
"RTN","PSBMD",150,0)
 D FIELD^DID(53.68,PSBFLD,"","LABEL","PSBRET")
"RTN","PSBMD",151,0)
 W !?3,PSBRET("LABEL"),":" F  Q:$X>30  W "."
"RTN","PSBMD",152,0)
 W $$GET1^DIQ(53.68,PSBMD_",",PSBFLD)
"RTN","PSBMD",153,0)
 I PSBFLD=.11 D
"RTN","PSBMD",154,0)
 .N DFN,VA,VADM S DFN=$$GET1^DIQ(53.68,PSBMD_",",.11,"I") D DEM^VADPT
"RTN","PSBMD",155,0)
 .W !?3,$$GET^XPAR("ALL","PSB PATIENT ID LABEL")
"RTN","PSBMD",156,0)
 .I $G(DUZ("AG"))="I" D
"RTN","PSBMD",157,0)
 ..W ":" F  Q:$X>30  W "."
"RTN","PSBMD",158,0)
 .E  D
"RTN","PSBMD",159,0)
 ..W " (LAST 4 NUMBERS):" F  Q:$X>30  W "."
"RTN","PSBMD",160,0)
 .W VA("BID")
"RTN","PSBMD",161,0)
 W:PSBFLD=.13 " ("_$P($G(^PSB(53.68,PSBMD,.1)),U,3)_")"
"RTN","PSBMD",162,0)
 S ZTREQ="@"
"RTN","PSBMD",163,0)
 Q
"RTN","PSBMD",164,0)
 ;
"RTN","PSBMD",165,0)
NEW(RESULTS) ; Create a new missing dose request
"RTN","PSBMD",166,0)
 ; Called interactively and via RPCBroker
"RTN","PSBMD",167,0)
 N DIC
"RTN","PSBMD",168,0)
 K RESULTS
"RTN","PSBMD",169,0)
 I '+$G(DUZ) S RESULTS(0)="-1^Undefined User" Q
"RTN","PSBMD",170,0)
 I '$G(DUZ(2)) S RESULTS(0)="-1^Undefined Division" Q
"RTN","PSBMD",171,0)
 ; Lock Log
"RTN","PSBMD",172,0)
 L +^PSB(53.68,0):$S($G(DILOCKTM)>0:DILOCKTM,1:3)
"RTN","PSBMD",173,0)
 E  S RESULTS(0)="-1^Request Log Locked" Q
"RTN","PSBMD",174,0)
 ; Generate Unique Entry and Create
"RTN","PSBMD",175,0)
 F  D NOW^%DTC S X=$E(%_"000000",1,14),X=(1700+$E(X,1,3))_$E(X,4,14),X="MD-"_$TR(X,".","-") Q:'$D(^PSB(53.68,"B",X))
"RTN","PSBMD",176,0)
 S DIC="^PSB(53.68,",DIC(0)="L"
"RTN","PSBMD",177,0)
 S DIC("DR")=".02///N;.03////^S X=DUZ;.04////^S X=DUZ(2);.07///1"
"RTN","PSBMD",178,0)
 K D0         ;VRN
"RTN","PSBMD",179,0)
 D FILE^DICN
"RTN","PSBMD",180,0)
 L -^PSB(53.68,0)
"RTN","PSBMD",181,0)
 ; Okay, setup return and Boogie
"RTN","PSBMD",182,0)
 I +Y<1 S RESULTS(0)="-1^Error Creating Request"
"RTN","PSBMD",183,0)
 E  S RESULTS(0)=Y
"RTN","PSBMD",184,0)
 Q
"RTN","PSBMD",185,0)
 ;
"RTN","PSBMD",186,0)
VAL(PSBFLDS) ; Validate that fields in PSBFLDS are filled in
"RTN","PSBMD",187,0)
 N PSB,PSBFLD,PSBMSG
"RTN","PSBMD",188,0)
 F PSB=1:1 Q:$P(PSBFLDS,";",PSB)=""  S PSBFLD=$P(PSBFLDS,";",PSB),PSBFLD(PSBFLD)=$$GET^DDSVAL(53.68,DA,PSBFLD)
"RTN","PSBMD",189,0)
 I $D(PSBFLD(.21)) K:PSBFLD(.21)="N" PSBFLD(.22),PSBFLD(.23)
"RTN","PSBMD",190,0)
 S PSB=""  F  S PSB=$O(PSBFLD(PSB)) Q:PSB=""  D:PSBFLD(PSB)=""
"RTN","PSBMD",191,0)
 .I '$D(PSBMSG) S PSBMSG(0)="UNABLE TO FILE REQUEST",PSBMSG(1)=" ",PSBMSG(2)="ERROR: MISSING DATA - ALL FIELDS ARE REQUIRED"
"RTN","PSBMD",192,0)
 .D FIELD^DID(53.68,PSB,"","TITLE;LABEL","PSB")
"RTN","PSBMD",193,0)
 .S X="  Missing Field: "_$S(PSB("TITLE")]"":PSB("TITLE"),1:PSB("LABEL")),PSBMSG($O(PSBMSG(""),-1)+1)=X
"RTN","PSBMD",194,0)
 Q:'$D(PSBMSG)  ; All is well
"RTN","PSBMD",195,0)
 D MSG^DDSUTL(.PSBMSG)
"RTN","PSBMD",196,0)
 S DDSERROR=1
"RTN","PSBMD",197,0)
 Q
"RTN","PSBMD",198,0)
 ;
"RTN","PSBMD",199,0)
FLWUP ; Follow-Up on missing dose
"RTN","PSBMD",200,0)
 N DIR,PSBIEN,PSBX,DA,DR,DDSFILE,PSBHDR,PSBDRUG,LOC            ;*70
"RTN","PSBMD",201,0)
 S Y="" F  Q:Y="^"  D
"RTN","PSBMD",202,0)
 .K ^TMP("PSB",$J) S X=""
"RTN","PSBMD",203,0)
 .F  S X=$O(^PSB(53.68,"AS",1,X),-1) Q:'X  S Y=$O(^TMP("PSB",$J,""),-1)+1,^TMP("PSB",$J,Y)=X,^TMP("PSB",$J,0)=Y
"RTN","PSBMD",204,0)
 .I '$O(^TMP("PSB",$J,0)) W !!,"No Unresolved Missing Dose Requests Found." S Y="^" Q
"RTN","PSBMD",205,0)
 .S PSBHDR="Currently Unresolved Missing Dose Requests"
"RTN","PSBMD",206,0)
 .W @IOF,PSBHDR,!,$TR($J("",IOM)," ","-")
"RTN","PSBMD",207,0)
 .F PSBX=0:0 S PSBX=$O(^TMP("PSB",$J,PSBX)) Q:'PSBX!(Y="^")  S PSBIEN=^(PSBX)_"," D
"RTN","PSBMD",208,0)
 ..W !,$J(PSBX,2),". ",$$GET1^DIQ(53.68,PSBIEN,.01)
"RTN","PSBMD",209,0)
 ..W ?25,$$GET1^DIQ(53.68,PSBIEN,.11)
"RTN","PSBMD",210,0)
 ..; get correct location                                     ;*70
"RTN","PSBMD",211,0)
 ..S LOC=$S($$GET1^DIQ(53.68,PSBIEN,1)]"":$$GET1^DIQ(53.68,PSBIEN,1),1:$$GET1^DIQ(53.68,PSBIEN,.12))
"RTN","PSBMD",212,0)
 ..W ?57,LOC                                                  ;*70
"RTN","PSBMD",213,0)
 ..S PSBDRUG=$$GET1^DIQ(53.68,PSBIEN,.13)
"RTN","PSBMD",214,0)
 ..I PSBDRUG]"" W !?5,PSBDRUG
"RTN","PSBMD",215,0)
 ..I PSBDRUG="" D
"RTN","PSBMD",216,0)
 ...W !?5,"UNIQUE ID: ",$$GET1^DIQ(53.68,PSBIEN,.25)
"RTN","PSBMD",217,0)
 ...S X=0 F  S X=$O(^PSB(53.68,+PSBIEN,.6,X)) Q:'X  W !?10,"ADDITIVES:  ",$$GET1^DIQ(52.6,+^PSB(53.68,+PSBIEN,.6,X,0),.01)
"RTN","PSBMD",218,0)
 ...S X=0 F  S X=$O(^PSB(53.68,+PSBIEN,.7,X)) Q:'X  W !?10,"SOLUTIONS:  ",$$GET1^DIQ(52.7,+^PSB(53.68,+PSBIEN,.7,X,0),.01)
"RTN","PSBMD",219,0)
 ..S:$Y>(IOSL-4) Y=$$PAGE(PSBX)
"RTN","PSBMD",220,0)
 .S:Y'="^" Y=$$PAGE(PSBX)
"RTN","PSBMD",221,0)
 Q
"RTN","PSBMD",222,0)
PAGE(PSBIX) ;
"RTN","PSBMD",223,0)
 ;
"RTN","PSBMD",224,0)
 N X,X1,PSBCX,PSBDX
"RTN","PSBMD",225,0)
 S DIR("A")="Select Missing Dose Request # (<RET> to continue, '^' to quit)"
"RTN","PSBMD",226,0)
 I PSBIX="" S DIR("A")="Select Missing Dose Request # (<RET> or '^' to quit)"
"RTN","PSBMD",227,0)
 S DIR(0)="NO^1:"_$S(PSBIX="":$O(^TMP("PSB",$J,PSBX),-1),1:PSBIX)_":0"
"RTN","PSBMD",228,0)
 D ^DIR S PSBDX=+Y
"RTN","PSBMD",229,0)
 I PSBIX="",Y="" S Y="^" Q Y
"RTN","PSBMD",230,0)
 I $G(DTOUT) S Y="^" Q Y
"RTN","PSBMD",231,0)
 I Y="^" Q Y
"RTN","PSBMD",232,0)
 I Y="" W @IOF,PSBHDR,!,$TR($J("",IOM)," ","-") Q Y
"RTN","PSBMD",233,0)
 S (DA,PSBCX)=^TMP("PSB",$J,+Y),DR="[PSB MISSING DOSE FOLLOWUP]",DDSFILE=53.68
"RTN","PSBMD",234,0)
 D  Q Y
"RTN","PSBMD",235,0)
 .D ^DDS
"RTN","PSBMD",236,0)
 .I $D(^PSB(53.68,"AS",0,PSBCX)) K ^TMP("PSB",$J) S X="" F  S X=$O(^PSB(53.68,"AS",1,X),-1) Q:'X  S X1=$O(^TMP("PSB",$J,""),-1)+1,^TMP("PSB",$J,X1)=X,^TMP("PSB",$J,0)=X1
"RTN","PSBMD",237,0)
 .S PSBX=0 W @IOF,PSBHDR,!,$TR($J("",IOM)," ","-")
"RTN","PSBMD",238,0)
 ;
"RTN","PSBMD",239,0)
POST ;call from 'Patient' field of screenman form PSB MISSING DOSE REQUEST
"RTN","PSBMD",240,0)
 ; 
"RTN","PSBMD",241,0)
 N DFN
"RTN","PSBMD",242,0)
 S DFN=X D IN5^VADPT
"RTN","PSBMD",243,0)
 D PUT^DDSVAL(DIE,.DA,.12,$P(VAIP(5),U,2))  ; value of DIE is 53.68, BCMA MISSING DOSE REQUEST FILE called from ScreenMan
"RTN","PSBMD",244,0)
 D PUT^DDSVAL(DIE,.DA,.18,$P(VAIP(6),U,1),"","I")  ; value of DIE is 53.68, BCMA MISSING DOSE REQUEST FILE called from ScreenMan
"RTN","PSBMD",245,0)
 D REFRESH^DDSUTL
"RTN","PSBMD",246,0)
 Q
"RTN","PSBML")
0^13^B123316080^B89675982
"RTN","PSBML",1,0)
PSBML ;BIRMINGHAM/EFC-BCMA MED LOG FUNCTIONS ;10/23/12 12:14pm
"RTN","PSBML",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,3,4,9,11,13,25,45,33,52,70**;Mar 2004;Build 101
"RTN","PSBML",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSBML",4,0)
 ; Reference/IA
"RTN","PSBML",5,0)
 ; ^DPT/10035
"RTN","PSBML",6,0)
 ; DIC(42/10039
"RTN","PSBML",7,0)
 ; DIC(42/2440
"RTN","PSBML",8,0)
 ; File 200/10060
"RTN","PSBML",9,0)
 ; EN^PSJBCMA3/3320
"RTN","PSBML",10,0)
 ; $$SITE^VASITE/10112
"RTN","PSBML",11,0)
 ; ^XUSEC(/10076
"RTN","PSBML",12,0)
 ;
"RTN","PSBML",13,0)
 ;*70 - store clinic name to admin location if exists.
"RTN","PSBML",14,0)
 ;    - add witness duz, dt/tm for high risk/alert drug, Order level
"RTN","PSBML",15,0)
 ;      HR code, and a witnesssed y/n flag to MEDLOG file.
"RTN","PSBML",16,0)
 ;
"RTN","PSBML",17,0)
RPC(RESULTS,PSBHDR,PSBREC) ;BCMA MedLog Filing
"RTN","PSBML",18,0)
 S PSBEDTFL=0
"RTN","PSBML",19,0)
 N PSBORD,PSBTRAN,PSBFDA,PSBMES ;Add PSBMES variable for PSB*3*52
"RTN","PSBML",20,0)
 N PSBCLIN,PSBWITN,PSBWITCM,PSBWITHR,PSBWITFL,LOC                 ;*70
"RTN","PSBML",21,0)
 K PSBIEN,PSBHL7
"RTN","PSBML",22,0)
 S PSBIEN=$P(PSBHDR,U,1)
"RTN","PSBML",23,0)
 S PSBTRAN=$P(PSBHDR,U,2),PSBHL7=PSBTRAN
"RTN","PSBML",24,0)
 S PSBINST=$P($G(PSBHDR),U,3)
"RTN","PSBML",25,0)
 ;*70 witness fields
"RTN","PSBML",26,0)
 S PSBWITN=+$P(PSBHDR,U,4)                   ;init witness duz var
"RTN","PSBML",27,0)
 S PSBWITCM=$P(PSBHDR,U,5)                   ;init witness comment
"RTN","PSBML",28,0)
 S PSBWITHR=+$P(PSBHDR,U,6)                  ;init witn HR order level
"RTN","PSBML",29,0)
 S PSBWITFL=$S(PSBWITN:1,1:0)             ;init witnessed?
"RTN","PSBML",30,0)
 I PSBWITN="",PSBWITHR=3 D  Q
"RTN","PSBML",31,0)
 .S RESULTS(0)=1
"RTN","PSBML",32,0)
 .S RESULTS(1)="-1^A Witness is required, however Witness information was null."
"RTN","PSBML",33,0)
 ;PSB*3*45 We should be recording the first entry in the audit log.
"RTN","PSBML",34,0)
 ;S PSBAUDIT=$S(PSBIEN="+1":0,1:1)
"RTN","PSBML",35,0)
 S PSBAUDIT=1
"RTN","PSBML",36,0)
 D NOW^%DTC S PSBNOW=%
"RTN","PSBML",37,0)
 I $D(^XUSEC("PSB STUDENT",DUZ)),PSBINST="" S RESULTS(0)=1,RESULTS(1)="-1^Instructor not present" Q
"RTN","PSBML",38,0)
 I $D(^XUSEC("PSB STUDENT",DUZ)),'$D(^XUSEC("PSB INSTRUCTOR",PSBINST)) S RESULTS(0)=1,RESULTS(1)="-1^Instructor doesn't have authority" Q
"RTN","PSBML",39,0)
 S PSBINST(0)=$$GET1^DIQ(200,PSBINST_",",.01)
"RTN","PSBML",40,0)
 I PSBTRAN="ADD COMMENT" D COMMENT^PSBML1 Q
"RTN","PSBML",41,0)
 I PSBTRAN="PRN EFFECTIVENESS" D PRN^PSBML1 Q
"RTN","PSBML",42,0)
 ;
"RTN","PSBML",43,0)
 ;update medlog rec
"RTN","PSBML",44,0)
UPD I PSBTRAN="UPDATE STATUS" D  Q
"RTN","PSBML",45,0)
 .I '$D(^PSB(53.79,PSBIEN)) D  Q
"RTN","PSBML",46,0)
 ..S RESULTS(0)=1
"RTN","PSBML",47,0)
 ..S RESULTS(1)="-1^Administration is at an UNKNOWN STATUS"
"RTN","PSBML",48,0)
 .D UPDATED^PSBML2
"RTN","PSBML",49,0)
 ;
"RTN","PSBML",50,0)
 ;edit Medlog rec
"RTN","PSBML",51,0)
 I PSBTRAN="EDIT" D EDIT^PSBML2 Q
"RTN","PSBML",52,0)
 ;
"RTN","PSBML",53,0)
 ;SAGG
"RTN","PSBML",54,0)
 N PSBWARD S PSBWARD=$G(^DPT(+$G(PSBREC(0)),.1),"UNKNOWN"),^PSB("SAGG",PSBWARD,DT)=$G(^PSB("SAGG",PSBWARD,DT))+1
"RTN","PSBML",55,0)
 ;*70 save clinic name if exists before manipulating PSBREC(1) param
"RTN","PSBML",56,0)
 S PSBCLIN=$P(PSBREC(1),U,2) I PSBCLIN="" S PSBCLIN=$S($G(PSBCLIEN):$P($G(^SC(+PSBCLIEN,0)),"^"),($G(PSBCLORD)]""):PSBCLORD,1:"")
"RTN","PSBML",57,0)
 S PSBREC(1)=$P(PSBREC(1),U)
"RTN","PSBML",58,0)
 ;
"RTN","PSBML",59,0)
 ;pre-existing psbrec(1) manipulation logic to *70
"RTN","PSBML",60,0)
 I PSBREC(1)?1U1";"1.6N S PSBREC(1)=$P(PSBREC(1),";",1)_$E(PSBREC(1))
"RTN","PSBML",61,0)
 D PSJ1^PSBVT(PSBREC(0),$P(PSBREC(1),";",2)_$P(PSBREC(1),";",1))
"RTN","PSBML",62,0)
 S PSBTAB=$P(PSBREC(9),U,1),PSBUID=$P(PSBREC(9),U,2)
"RTN","PSBML",63,0)
MEDP D:PSBTRAN="MEDPASS"
"RTN","PSBML",64,0)
 .I (PSBDOSEF["PATCH"),(PSBREC(3)="G") D  Q:+$G(RESULTS(1))<0
"RTN","PSBML",65,0)
 ..S PSBXDT="" F  S PSBXDT=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBXDT)) Q:PSBXDT=""  D  Q:+$G(RESULTS(1))<0
"RTN","PSBML",66,0)
 ...S PSBYZ="" F  S PSBYZ=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBXDT,PSBYZ)) Q:'PSBYZ  I ("G"[$$GET1^DIQ(53.79,PSBYZ,.09,"I")) D  Q
"RTN","PSBML",67,0)
 ....S:($$GET1^DIQ(53.79,PSBYZ,.09,"I")="G") RESULTS(0)=1,RESULTS(1)="-1^Previous Patch has not been removed. Administration canceled."
"RTN","PSBML",68,0)
 ....S:($$GET1^DIQ(53.79,PSBYZ,.09,"I")="")&(($$GET1^DIQ(53.79,PSBYZ,.07,"I")'=DUZ)&('$D(^XUSEC("PSB MANAGER",DUZ)))) RESULTS(0)=1,RESULTS(1)="-1^Patch status ""*UNKNOWN*"". Administration canceled."
"RTN","PSBML",69,0)
 .I PSBREC(7)="BCMA/CPRS Interface Entry." S PSBNOW=PSBREC(5)  ;MOB
"RTN","PSBML",70,0)
 .F X=0:1:9 S PSBREC(X)=$G(PSBREC(X))
"RTN","PSBML",71,0)
 .I PSBREC(1)?1U1";".N S PSBREC(1)=$P(PSBREC(1),";",2)_$P(PSBREC(1),";",1)
"RTN","PSBML",72,0)
 .I PSBREC(1)["V",+PSBREC(5)>0,+$P(PSBREC(5),".",2)=0,PSBIVT'["P" D NOW^%DTC S PSBREC(5)=$P(PSBREC(5),".",1)_"."_$P(%,".",2)
"RTN","PSBML",73,0)
 .I $P(PSBREC(9),U,1)="IVTAB",$P(PSBREC(9),U,2)="" S PSBUID=$$GETWSID^PSBVDLU2(PSBREC(0),PSBREC(1))
"RTN","PSBML",74,0)
 .I $P(PSBREC(9),U,1)="PBTAB",$P(PSBREC(9),U,2)="",PSBREC(1)'["U",PSBREC(3)'="M",PSBREC(3)'="R",PSBREC(3)'="H" S PSBUID=$$GETWSID^PSBVDLU2(PSBREC(0),PSBREC(1))
"RTN","PSBML",75,0)
 .;OnCal
"RTN","PSBML",76,0)
 .D:PSBREC(2)="OC"
"RTN","PSBML",77,0)
 ..S X=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),"")) Q:X=""
"RTN","PSBML",78,0)
 ..S Y=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),X,0))
"RTN","PSBML",79,0)
 ..I $P(^PSB(53.79,Y,0),U,9)="G"&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL")) D ERR(1,"On-Call already given")
"RTN","PSBML",80,0)
 .;1x
"RTN","PSBML",81,0)
 .D:PSBREC(2)="O"
"RTN","PSBML",82,0)
 ..S X=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),"")) Q:X=""
"RTN","PSBML",83,0)
 ..S Y=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),X,0))
"RTN","PSBML",84,0)
 ..I $P(^PSB(53.79,Y,0),U,9)="G" D ERR(1,"One Time already Given")
"RTN","PSBML",85,0)
 .;PRN
"RTN","PSBML",86,0)
 .I PSBREC(2)="P",PSBREC(3)'="M",$P(PSBREC(9),U,1)'="IVTAB" D
"RTN","PSBML",87,0)
 ..I PSBREC(6)="" D ERR(1,"PRN Medications MUST Have a PRN Reason")
"RTN","PSBML",88,0)
 ..I PSBREC(5)]"" D ERR(1,"PRN Orders don't have scheduled times")
"RTN","PSBML",89,0)
 ..I PSBREC(3)'="G" D ERR(1,"PRN Orders cannot be marked NOT Given")
"RTN","PSBML",90,0)
 .;Cnt
"RTN","PSBML",91,0)
 .I PSBREC(2)="C",PSBTAB'="IVTAB" D
"RTN","PSBML",92,0)
 ..D:PSBREC(5)="" ERR(1,"Continuous Order needs admin time")
"RTN","PSBML",93,0)
 ..D:PSBREC(6)]"" ERR(1,"No PRN Reason allowed on Continuous Orders")
"RTN","PSBML",94,0)
 .I PSBREC(2)="C",$D(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),+PSBREC(5))),PSBIEN="+1" D  K PSBADMBY,PSBADMAT Q:PSBSIEN=""  Q:$P(^PSB(53.79,PSBSIEN,0),U,9)'="N"
"RTN","PSBML",95,0)
 ..S PSBSIEN=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),PSBREC(5),""))
"RTN","PSBML",96,0)
 ..I PSBSIEN]"" I '(($P(^PSB(53.79,PSBSIEN,0),U,7)=DUZ)!($D(^XUSEC("PSB MANAGER",DUZ)))) S PSBSIEN=""
"RTN","PSBML",97,0)
 ..I PSBSIEN']"" S RESULTS(0)=2,RESULTS(1)="-2^Error Filing Transaction MEDPASS",RESULTS(2)="The PSB MANAGER key is required to modify this scheduled admin" Q
"RTN","PSBML",98,0)
 ..D:$P(^PSB(53.79,PSBSIEN,0),U,9)'="N"
"RTN","PSBML",99,0)
 ...K PSBINCX I $P(^PSB(53.79,PSBSIEN,0),U,9)="" S PSBINCX=PSBSIEN L +^PSB(53.79,PSBINCX):1 Q:'$T  L -^PSB(53.79,PSBINCX)
"RTN","PSBML",100,0)
 ...S Y=$P(^PSB(53.79,PSBSIEN,0),U,6) D DD^%DT S PSBADMAT=Y
"RTN","PSBML",101,0)
 ...S PSBADMBY=$$GET1^DIQ(200,$P(^PSB(53.79,PSBSIEN,0),U,7),.01,)
"RTN","PSBML",102,0)
 ...S RESULTS(0)=3,RESULTS(1)="-2^Error Filing Transaction MEDPASS"
"RTN","PSBML",103,0)
 ...S RESULTS(2)="Continuous Administration Date/Time already on file."
"RTN","PSBML",104,0)
 ...S RESULTS(3)="Administered by "_PSBADMBY_" at "_PSBADMAT_"."
"RTN","PSBML",105,0)
 ...I $D(XWB) S RESULTS(0)=RESULTS(0)+2,RESULTS(4)="                                         ",RESULTS(5)="            VDL will now be updated."
"RTN","PSBML",106,0)
 .;Non Given
"RTN","PSBML",107,0)
 .I PSBREC(3)'="G",PSBREC(3)'="M",PSBUID'["V",PSBUID'["W" D
"RTN","PSBML",108,0)
 ..I PSBREC(7)="",PSBTAB'="IVTAB" D ERR(1,"Comment needed if Not Marked Given")
"RTN","PSBML",109,0)
 ..I PSBREC(7)="",PSBTAB="IVTAB" D ERR(1,"Comment needed if Not Marked Completed")
"RTN","PSBML",110,0)
 .S:PSBREC(3)="H" PSBREC(7)="Held: "_PSBREC(7)    ;.3
"RTN","PSBML",111,0)
 .S:PSBREC(3)="R" PSBREC(7)="Refused: "_PSBREC(7) ;.3
"RTN","PSBML",112,0)
 .S:PSBREC(3)="S" PSBREC(7)="Stopped: "_PSBREC(7) ;.3
"RTN","PSBML",113,0)
 .;Valid?
"RTN","PSBML",114,0)
 .I $G(PSBSIEN)'="" I $D(^PSB(53.79,PSBSIEN,0)) I $P(^PSB(53.79,PSBSIEN,0),U,9)="N" S PSBIEN=+PSBSIEN_",",$P(PSBHDR,U)=PSBIEN,PSBTRAN="UPDATE STATUS",PSBAUDIT=1                   ;do UPDATE
"RTN","PSBML",115,0)
 .D:PSBIEN="+1"                          ;New fields only?
"RTN","PSBML",116,0)
 ..D VAL(53.79,PSBIEN,.01,"`"_PSBREC(0))           ;Patn
"RTN","PSBML",117,0)
 ..S LOC=$G(^DPT(PSBREC(0),.1))_" "_$G(^(.101))    ;Ward Room/Bed LOC
"RTN","PSBML",118,0)
 ..S:PSBCLIN]"" LOC=PSBCLIN         ;If clinic order use clin name *70
"RTN","PSBML",119,0)
 ..D VAL(53.79,PSBIEN,.02,LOC)                     ;Patn Location LOC
"RTN","PSBML",120,0)
 ..D:$G(^DPT(PSBREC(0),.1))'=""
"RTN","PSBML",121,0)
 ...S Y=$O(^DIC(42,"B",$G(^DPT(PSBREC(0),.1)),"")),Y=$$GET1^DIQ(42,Y,.015,"I"),PSBDIV=$$SITE^VASITE(DT,Y)
"RTN","PSBML",122,0)
 ...D VAL(53.79,PSBIEN,.03,"`"_$P(PSBDIV,U,1))     ;Div
"RTN","PSBML",123,0)
 ..D VAL(53.79,PSBIEN,.04,PSBNOW)                  ;Entered dt/tm
"RTN","PSBML",124,0)
 ..D VAL(53.79,PSBIEN,.05,"`"_DUZ)                 ;Entered by duz
"RTN","PSBML",125,0)
 ..D VAL(53.79,PSBIEN,.06,PSBNOW)                  ;Admin dt/tm
"RTN","PSBML",126,0)
 ..D VAL(53.79,PSBIEN,.07,"`"_DUZ)                 ;Admin By duz
"RTN","PSBML",127,0)
 ..D VAL(53.79,PSBIEN,.08,"`"_PSBREC(4))           ;Orderable Item
"RTN","PSBML",128,0)
 ..D VAL(53.79,PSBIEN,.11,PSBREC(1))               ;Ord file 55 IEN
"RTN","PSBML",129,0)
 ..D VAL(53.79,PSBIEN,.12,PSBREC(2))               ;Ord Schd Type
"RTN","PSBML",130,0)
 ..D VAL(53.79,PSBIEN,.13,PSBREC(5))               ;Schd Adm dt/tm
"RTN","PSBML",131,0)
 ..D:PSBTAB'="UDTAB" VAL(53.79,PSBIEN,.26,PSBUID)  ;IV Bag ID
"RTN","PSBML",132,0)
 ..D:PSBTAB="IVTAB" VAL(53.79,PSBIEN,.13,"")       ;Schd Admdt/tm null
"RTN","PSBML",133,0)
 ..D:PSBREC(1)?.N1"U" VAL(53.79,PSBIEN,.15,PSBDOSE)  ;UD Dosage
"RTN","PSBML",134,0)
 ..D:PSBREC(1)?.N1"V" VAL(53.79,PSBIEN,.35,PSBIFR)   ;IV Infuse Rate
"RTN","PSBML",135,0)
 ..I PSBWITHR>1,(PSBREC(3)="G")!(PSBREC(3)="I") D          ;Witness logic and Give?  *70
"RTN","PSBML",136,0)
 ...D:PSBWITN VAL(53.79,PSBIEN,.28,PSBNOW)        ;Witness dt/time
"RTN","PSBML",137,0)
 ...D:PSBWITN VAL(53.79,PSBIEN,.29,"`"_PSBWITN)   ;Witness duz
"RTN","PSBML",138,0)
 ...D:PSBWITCM]"" VAL(53.79,PSBIEN,.31,PSBWITCM)  ;Witness comment
"RTN","PSBML",139,0)
 ...D VAL(53.79,PSBIEN,.32,PSBWITHR)              ;Witness HR ord code
"RTN","PSBML",140,0)
 ...D VAL(53.79,PSBIEN,.33,PSBWITFL)              ;Witnessed? flag
"RTN","PSBML",141,0)
 .;
"RTN","PSBML",142,0)
 .;Overwrite fields below, rec already exsts
"RTN","PSBML",143,0)
 .I PSBREC(3)="G"!(PSBREC(3))="C" D                ;Gvn/Completed?
"RTN","PSBML",144,0)
 ..D VAL(53.79,PSBIEN,.06,PSBNOW)                    ;Admin dt/tm
"RTN","PSBML",145,0)
 ..D VAL(53.79,PSBIEN,.07,"`"_DUZ)                   ;Admin By duz
"RTN","PSBML",146,0)
 .D:PSBREC(8)]"" VAL(53.79,PSBIEN,.16,PSBREC(8))   ;InjctSte
"RTN","PSBML",147,0)
 .D:'$G(PSBMMEN) VAL(53.79,PSBIEN,.09,PSBREC(3))   ;AStats
"RTN","PSBML",148,0)
 .I PSBREC(6)]"" D                                 ;PRN reason?
"RTN","PSBML",149,0)
 ..D VAL(53.79,PSBIEN,.21,$P(PSBREC(6),U))           ;reason dt/tm
"RTN","PSBML",150,0)
 ..D VAL(53.79,PSBIEN,.27,$P(PSBREC(6),U,2))         ;PRN reason
"RTN","PSBML",151,0)
 .D:PSBREC(7)]""
"RTN","PSBML",152,0)
 ..D VAL(53.793,"+2,"_PSBIEN,.01,PSBREC(7))        ;Comment
"RTN","PSBML",153,0)
 ..D VAL(53.793,"+2,"_PSBIEN,.02,"`"_DUZ)          ;comnt person duz
"RTN","PSBML",154,0)
 ..D VAL(53.793,"+2,"_PSBIEN,.03,PSBNOW)           ;comnt dt/time
"RTN","PSBML",155,0)
 .;DD/SOL/ADD
"RTN","PSBML",156,0)
 .I PSBREC(3)="G"!(PSBREC(3)="I")!(PSBREC(3)="H")!(PSBREC(3)="R")!(PSBREC(3)="M") D     ;given/action stat codes?
"RTN","PSBML",157,0)
 ..I PSBTRAN="UPDATE STATUS" K ^PSB(53.79,+PSBIEN,.5),^PSB(53.79,+PSBIEN,.6),^PSB(53.79,+PSBIEN,.7)
"RTN","PSBML",158,0)
 ..F PSBCNT=10:1 Q:'$D(PSBREC(PSBCNT))  D
"RTN","PSBML",159,0)
 ...S Y=$P(PSBREC(PSBCNT),U)
"RTN","PSBML",160,0)
 ...S PSBDD=$S(Y="DD":53.795,Y="ADD":53.796,Y="SOL":53.797,1:0)
"RTN","PSBML",161,0)
 ...Q:'PSBDD
"RTN","PSBML",162,0)
 ...S PSBIENS="+"_PSBCNT_","_PSBIEN
"RTN","PSBML",163,0)
 ...D VAL(PSBDD,PSBIENS,.01,"`"_$P(PSBREC(PSBCNT),U,2))
"RTN","PSBML",164,0)
 ...D VAL(PSBDD,PSBIENS,.02,$P(PSBREC(PSBCNT),U,3))
"RTN","PSBML",165,0)
 ...D VAL(PSBDD,PSBIENS,.03,$P(PSBREC(PSBCNT),U,4))
"RTN","PSBML",166,0)
 ...D:(PSBTAB="UDTAB")!(PSBTAB="PBTAB") VAL(PSBDD,PSBIENS,.04,$E($P(PSBREC(PSBCNT),U,5),1,40))
"RTN","PSBML",167,0)
 ...D VAL(PSBDD,PSBIENS,.05,$P(PSBREC(PSBCNT),U,7))        ;HR ind *70
"RTN","PSBML",168,0)
 .;Modify Filing Transaction Medpass error message too inclde details - PSB*3*52
"RTN","PSBML",169,0)
 .I $O(RESULTS("")) D  Q
"RTN","PSBML",170,0)
 ..N PSBERR
"RTN","PSBML",171,0)
 ..I $D(PSBMES) D
"RTN","PSBML",172,0)
 ...S RESULTS(1)="-2^***Your documentation is NOT being recorded in the patient record.***",RESULTS(2)=""
"RTN","PSBML",173,0)
 ...S RESULTS(3)="Please write down the information (below) AND contact your BCMA Coordinator or IT Support for assistance:",RESULTS(4)=""
"RTN","PSBML",174,0)
 ...S RESULTS(5)="Error(s) Filing Transaction MEDPASS"
"RTN","PSBML",175,0)
 ..S PSBERR=0 F  S PSBERR=$O(PSBMES(PSBERR)) Q:PSBERR=""  D
"RTN","PSBML",176,0)
 ...S RESULTS($O(RESULTS(""),-1)+1)=PSBMES(PSBERR),RESULTS(0)=$O(RESULTS(""),-1)
"RTN","PSBML",177,0)
 .;
"RTN","PSBML",178,0)
 .D FILEIT
"RTN","PSBML",179,0)
 .;
"RTN","PSBML",180,0)
 .;PSB*3*33
"RTN","PSBML",181,0)
 .D:((PSBREC(2)="O")!($$ONE^PSJBCMA(PSBREC(0),PSBREC(1))="O"))&(PSBREC(3)="G") EXPIRE^PSBML1  ;1x exp?
"RTN","PSBML",182,0)
 .D:(PSBREC(2)="O")&(PSBREC(3)="G") EXPIRE^PSBML1  ;1x exp?
"RTN","PSBML",183,0)
 .I $P(RESULTS(0),U,1)=1,PSBTAB'="UDTAB",PSBUID]"",PSBUID'["WS" S PSBON=+PSBREC(1) D EN^PSJBCMA3(PSBREC(0),PSBON,PSBUID,PSBREC(3),PSBNOW)
"RTN","PSBML",184,0)
 Q
"RTN","PSBML",185,0)
BCBU ;HL7,NatContng
"RTN","PSBML",186,0)
 Q:+$G(RESULTS(0))'>0
"RTN","PSBML",187,0)
 N PSBIEN1 S PSBIEN1=$S($P(PSBIEN,",",2)'="":+$P(PSBIEN,",",2),$G(PSBIEN)="+1":PSBIEN(1),1:+$G(PSBIEN))
"RTN","PSBML",188,0)
 I $G(PSBIEN1)="" S RESULTS(0)=1,RESULTS(1)="-1^Contingency NOT processed" Q
"RTN","PSBML",189,0)
 I $G(PSBIEN)="+1" S PSBHL7="MEDPASS"
"RTN","PSBML",190,0)
 E  S:$G(PSBHL7)="" PSBHL7="UPDATE STATUS"
"RTN","PSBML",191,0)
 D:('$D(Y(0))!($G(Y(0))="SAVE")!($G(Y(0))="YES")) EN^PSBSVHL7(+PSBIEN1,PSBHL7),MEDL^ALPBCBU(+PSBIEN1) K PSBHL7
"RTN","PSBML",192,0)
 ;<<HDR-VDEF(frm *3)
"RTN","PSBML",193,0)
 Q
"RTN","PSBML",194,0)
VAL(PSBDD,PSBIEN,PSBFLD,PSBVAL) ;
"RTN","PSBML",195,0)
 K ^TMP("DIERR",$J),PSBRET
"RTN","PSBML",196,0)
 D VAL^DIE(PSBDD,PSBIEN,PSBFLD,"F",PSBVAL,.PSBRET,"PSBFDA")
"RTN","PSBML",197,0)
 I PSBRET="^" F X=0:0 S X=$O(^TMP("DIERR",$J,X)) Q:'X  D ERR(2,^TMP("DIERR",$J,X)_": "_$G(^(X,"TEXT",1),"**"))
"RTN","PSBML",198,0)
 K ^TMP("DIERR",$J),PSBRET
"RTN","PSBML",199,0)
 Q
"RTN","PSBML",200,0)
FILEIT ;Updt
"RTN","PSBML",201,0)
 N PSBMSG,PSBAUD
"RTN","PSBML",202,0)
 S (PSB1,PSB2)=""
"RTN","PSBML",203,0)
 D APATCH^PSBML3
"RTN","PSBML",204,0)
 D CLEAN^DILF
"RTN","PSBML",205,0)
 D RESETADM^PSBUTL
"RTN","PSBML",206,0)
 D UPDATE^DIE("","PSBFDA","PSBIEN","PSBMSG")
"RTN","PSBML",207,0)
 I '$G(PSBMMEN) S X=+PSBIEN I $F("HR",$P(^PSB(53.79,X,0),U,9))>1 F Y=.5,.6,.7 S Z=0 F  S Z=$O(^PSB(53.79,+X,Y,Z)) Q:+Z=0  S $P(^PSB(53.79,+X,Y,Z,0),U,3)=0
"RTN","PSBML",208,0)
 I $D(PSBMSG("DIERR")) S RESULTS(0)=1,RESULTS(1)="-1^"_PSBMSG("DIERR",1)_": "_PSBMSG("DIERR",1,"TEXT",1)  Q
"RTN","PSBML",209,0)
 I $G(PSB1)]"" X PSB1 I $G(PSB2)]"" X PSB2
"RTN","PSBML",210,0)
 I $D(PSBHDR) D:"NHMR"[$P(^PSB(53.79,$S($P(PSBHDR,"^",1)="+1":PSBIEN(1),1:+PSBIEN),0),U,9)
"RTN","PSBML",211,0)
 .N PSBINDX S PSBINDX=$S($P(PSBHDR,"^",1)="+1":PSBIEN(1),1:+PSBIEN)
"RTN","PSBML",212,0)
 .K ^PSB(53.79,"APATCH",$P(^PSB(53.79,PSBINDX,0),U),$P(^PSB(53.79,PSBINDX,0),U,6),PSBINDX)
"RTN","PSBML",213,0)
 S RESULTS(0)=1,RESULTS(1)="1^Data Successfully Filed^"_$S($G(PSBIEN(1))'="":$G(PSBIEN(1)),1:+$G(PSBIEN))
"RTN","PSBML",214,0)
 D BCBU  ;NatContng
"RTN","PSBML",215,0)
 I $G(PSBINST,0) S PSBAUD=$S($P(PSBHDR,"^",1)="+1":PSBIEN(1),1:$P(PSBHDR,"^",1)) D AUDIT^PSBMLU(PSBAUD,"Instructor "_PSBINST(0)_" present.",PSBTRAN)
"RTN","PSBML",216,0)
 Q
"RTN","PSBML",217,0)
ERR(X,Y) ;
"RTN","PSBML",218,0)
 S X=$P("Business Logic Error^Data Validation Error",U,X)
"RTN","PSBML",219,0)
 S RESULTS($O(RESULTS(""),-1)+1)=X_": "_Y
"RTN","PSBML",220,0)
 S PSBMES($O(PSBMES(""),-1)+1)=X_": "_Y
"RTN","PSBML",221,0)
 Q
"RTN","PSBML",222,0)
COMMENT(DA,PSBCMT) ;
"RTN","PSBML",223,0)
 N PSBFDA,PSBIEN,PSBNOW
"RTN","PSBML",224,0)
 S PSBIEN="+1,"_DA_","
"RTN","PSBML",225,0)
 D NOW^%DTC S PSBNOW=%
"RTN","PSBML",226,0)
 D VAL(53.793,PSBIEN,.01,PSBCMT)
"RTN","PSBML",227,0)
 S PSBFDA(53.793,PSBIEN,.02)=DUZ
"RTN","PSBML",228,0)
 S PSBFDA(53.793,PSBIEN,.03)=PSBNOW
"RTN","PSBML",229,0)
 D FILEIT
"RTN","PSBML",230,0)
 Q
"RTN","PSBML2")
0^40^B90238392^B76455791
"RTN","PSBML2",1,0)
PSBML2 ;BIRMINGHAM/TEJ-BCMA UTILITY TO EDIT THE PSB MED LOG  ; 2/11/13 4:47pm
"RTN","PSBML2",2,0)
 ;;3.0;BAR CODE MED ADMIN;**3,18,22,23,13,45,42,70**;Mar 2004;Build 101
"RTN","PSBML2",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.;
"RTN","PSBML2",4,0)
 ; Reference/IA
"RTN","PSBML2",5,0)
 ; EN^PSJBCMA3/3320
"RTN","PSBML2",6,0)
 ; ENE^PSJBCMA4/3416
"RTN","PSBML2",7,0)
 ; ENR^PSJBCMA4/3416
"RTN","PSBML2",8,0)
 ;
"RTN","PSBML2",9,0)
 ;*70 - update Witness if present and Giving now as an updated, could 
"RTN","PSBML2",10,0)
 ;      mean undo given or a hold/refused was done first.
"RTN","PSBML2",11,0)
 ;
"RTN","PSBML2",12,0)
EDIT ;
"RTN","PSBML2",13,0)
 K RESULTS S PSBEDIEN=PSBIEN_",",RESULTS(0)=0
"RTN","PSBML2",14,0)
 I $G(PSBREC(7))']"" S RESULTS(0)=1,RESULTS(1)="-1^Data NOT filed - Comment is required" Q
"RTN","PSBML2",15,0)
 D
"RTN","PSBML2",16,0)
 .S PSBEDTFL=1,PSBMODS=0,PSBREC(1)=""
"RTN","PSBML2",17,0)
 .D:PSBREC(4)]"" VAL^PSBML(53.79,PSBEDIEN,.06,PSBREC(4))
"RTN","PSBML2",18,0)
 .I (PSBREC(0)="N") D
"RTN","PSBML2",19,0)
 ..I ($$GET1^DIQ(53.79,PSBEDIEN,.11)["V") F PSBX=1:1:6 S PSBREC(PSBX)=""
"RTN","PSBML2",20,0)
 .I ("NHR"[PSBREC(0)),$D(^PSB(53.79,+PSBEDIEN,.2)) D
"RTN","PSBML2",21,0)
 ..; Audit PRN
"RTN","PSBML2",22,0)
 ..D:$P(^PSB(53.79,+PSBEDIEN,.2),U,2)]"" AUDIT^PSBUTL(+PSBEDIEN,53.79,.22,$P(^PSB(53.79,+PSBEDIEN,.2),U,2),"K")
"RTN","PSBML2",23,0)
 ..I ($P(^PSB(53.79,+PSBEDIEN,0),U,9)="G")!($P(^PSB(53.79,+PSBEDIEN,0),U,9)="I") D
"RTN","PSBML2",24,0)
 ...I $D(^PSB(53.79,"APRN",$P(^PSB(53.79,+PSBEDIEN,0),U,1),$P(^PSB(53.79,+PSBEDIEN,0),U,6),+PSBEDIEN)) D
"RTN","PSBML2",25,0)
 ....K ^PSB(53.79,"APRN",$P(^PSB(53.79,+PSBEDIEN,0),U,1),$P(^PSB(53.79,+PSBEDIEN,0),U,6),+PSBEDIEN) K ^PSB(53.79,+PSBEDIEN,.2)
"RTN","PSBML2",26,0)
 .I ("NHR"'[PSBREC(0)) D:$G(PSBREC(5))]"" VAL^PSBML(53.79,PSBEDIEN,.21,$G(PSBREC(5))) D:$G(PSBREC(6))]"" VAL^PSBML(53.79,PSBEDIEN,.22,$G(PSBREC(6)))
"RTN","PSBML2",27,0)
 .I +$G(RESULTS(0))<0 S RESULTS(1)="-1^Data NOT filed - "_$P(RESULTS(0),U,2),RESULTS(0)=1 Q
"RTN","PSBML2",28,0)
 .D:$D(^PSB(53.79,+PSBEDIEN,.2)) VAL^PSBML(53.79,PSBEDIEN,.21,$G(PSBREC(5))),VAL^PSBML(53.79,PSBEDIEN,.22,$G(PSBREC(6)))
"RTN","PSBML2",29,0)
 .D VAL^PSBML(53.793,"+2,"_PSBIEN,.01,PSBREC(7))
"RTN","PSBML2",30,0)
 .D VAL^PSBML(53.793,"+2,"_PSBIEN,.02,"`"_DUZ)
"RTN","PSBML2",31,0)
 .D VAL^PSBML(53.793,"+2,"_PSBIEN,.03,PSBNOW)
"RTN","PSBML2",32,0)
 Q:+$G(RESULTS(1))<0
"RTN","PSBML2",33,0)
 S PSBMODS=$$CHANGE^PSBML3(.PSBREC,PSBEDIEN)
"RTN","PSBML2",34,0)
 D:PSBMODS UPDATED
"RTN","PSBML2",35,0)
 D:('$G(PSBERR))&('$G(PSBMODS)) FILEIT^PSBML
"RTN","PSBML2",36,0)
 ; Audit DD
"RTN","PSBML2",37,0)
 I $D(PSBORDMD) S (PSBXY,PSBXZ)="" D
"RTN","PSBML2",38,0)
 .F  S PSBXY=$O(PSBORDMD(PSBXY)) Q:PSBXY=""  S PSBFDAX=$S(PSBXY=.6:53.796,PSBXY=.7:53.797,1:53.795) F  S PSBXZ=$O(PSBORDMD(PSBXY,PSBXZ)) Q:PSBXZ=""  D
"RTN","PSBML2",39,0)
 ..S PSBXACT="",PSBXACT=$G(PSBORDMD(PSBXY,PSBXZ,0))
"RTN","PSBML2",40,0)
 ..D:PSBXACT["ADD" AUDIT^PSBUTL(+PSBEDIEN,PSBFDAX,.01,PSBXZ,"S") D:PSBXACT["DELETE" AUDIT^PSBUTL(+PSBEDIEN,PSBFDAX,.01,PSBXZ,"K")
"RTN","PSBML2",41,0)
 ;
"RTN","PSBML2",42,0)
 K PSBORDMD,PSBCHNG,PSBDDX,PSBEDTFL,PSBEDIEN,PSBFILED
"RTN","PSBML2",43,0)
 Q
"RTN","PSBML2",44,0)
 ;
"RTN","PSBML2",45,0)
UPDATED ;
"RTN","PSBML2",46,0)
 N PSBADD
"RTN","PSBML2",47,0)
 S PSBIEN=PSBIEN_",",PSBXPTCH=0
"RTN","PSBML2",48,0)
 S PSBRECNO=$S(PSBEDTFL:8,1:4)
"RTN","PSBML2",49,0)
 I "^G^N^H^R^RM^S^C^I^M^"[(U_PSBREC(0)_U) D
"RTN","PSBML2",50,0)
 .D:('PSBEDTFL) VAL^PSBML(53.79,PSBIEN,.06,PSBNOW)
"RTN","PSBML2",51,0)
 .D:$D(PSBREC(4,0)) VAL^PSBML(53.79,PSBIEN,.06,PSBREC(4))
"RTN","PSBML2",52,0)
 .D VAL^PSBML(53.79,PSBIEN,.07,"`"_DUZ)
"RTN","PSBML2",53,0)
 .D:('PSBEDTFL)!($G(PSBREC(0,0))) VAL^PSBML(53.79,PSBIEN,.09,PSBREC(0))
"RTN","PSBML2",54,0)
 .I $G(PSBREC(3))]"" D VAL^PSBML(53.79,PSBIEN,.26,PSBREC(3))
"RTN","PSBML2",55,0)
 I $D(PSBREC(PSBRECNO)) D:($G(PSBREC(0))="G")&($P(PSBREC(PSBRECNO),U,5)["PATCH")  Q:+$G(RESULTS(1))<0
"RTN","PSBML2",56,0)
 .Q:$$GET1^DIQ(53.79,PSBIEN,.09,"I")=""
"RTN","PSBML2",57,0)
 .S PSBXDFN=$$GET1^DIQ(53.79,PSBIEN,.01,"I")
"RTN","PSBML2",58,0)
 .S PSBXORN=$$GET1^DIQ(53.79,+PSBIEN,.11,"I")
"RTN","PSBML2",59,0)
 .S PSBXDT="" F  S PSBXDT=$O(^PSB(53.79,"AORDX",PSBXDFN,PSBXORN,PSBXDT)) Q:PSBXDT=""  D  Q:+$G(RESULTS(1))<0
"RTN","PSBML2",60,0)
 ..S PSBYZ="" F  S PSBYZ=$O(^PSB(53.79,"AORDX",PSBXDFN,PSBXORN,PSBXDT,PSBYZ)) Q:'PSBYZ  I ($$GET1^DIQ(53.79,PSBYZ,.09,"I")="G"),(PSBYZ'=+PSBIEN) S RESULTS(0)=1,RESULTS(1)="-1^Previous Patch has not been removed. Administration canceled." Q
"RTN","PSBML2",61,0)
 S:'$D(PSBXDFN) PSBXDFN=$$GET1^DIQ(53.79,PSBIEN,.01,"I"),PSBXORN=$$GET1^DIQ(53.79,+PSBIEN,.11,"I")
"RTN","PSBML2",62,0)
 I $G(PSBREC(3))']"",$G(PSBREC(0))="G",$P($G(PSBREC(4)),U)'="DD",$P($G(PSBREC(8)),U)'="DD" S PSBUID=$$GETWSID^PSBVDLU2(+PSBXDFN,+PSBXORN) D VAL^PSBML(53.79,PSBIEN,.26,PSBUID)
"RTN","PSBML2",63,0)
 D:$G(PSBREC(0))="N"
"RTN","PSBML2",64,0)
 .I (PSBREC(0)="N"),($$GET1^DIQ(53.79,+PSBIEN,.09,"I")="G") S PSBREC(1)="Undo Given: "_$G(PSBREC(1))
"RTN","PSBML2",65,0)
 .I ((PSBREC(0)="N")!(PSBREC(0)="G")),($$GET1^DIQ(53.79,+PSBIEN,.09,"I")="RM") S PSBREC(1)="Undo Remove: "_$G(PSBREC(1))
"RTN","PSBML2",66,0)
 .; Undo PRN
"RTN","PSBML2",67,0)
 .I $D(^PSB(53.79,+PSBIEN,.2)) D
"RTN","PSBML2",68,0)
 ..D:$P(^PSB(53.79,+PSBIEN,.2),U,2)]"" AUDIT^PSBUTL(+PSBIEN,53.79,.22,$P(^PSB(53.79,+PSBIEN,.2),U,2),"K")
"RTN","PSBML2",69,0)
 ..I ($P(^PSB(53.79,+PSBIEN,0),U,9)="G")!($P(^PSB(53.79,+PSBIEN,0),U,9)="I") K ^PSB(53.79,"APRN",$P(^PSB(53.79,+PSBIEN,0),U,1),$P(^PSB(53.79,+PSBIEN,0),U,6),+PSBIEN),^PSB(53.79,+PSBIEN,.2)
"RTN","PSBML2",70,0)
 D:$G(PSBREC(1))]""
"RTN","PSBML2",71,0)
 .S:PSBREC(0)="H" PSBREC(1)="Held: "_PSBREC(1)
"RTN","PSBML2",72,0)
 .S:PSBREC(0)="R" PSBREC(1)="Refused: "_PSBREC(1)
"RTN","PSBML2",73,0)
 .S:PSBREC(0)="RM" PSBREC(1)="Removed: "_PSBREC(1)
"RTN","PSBML2",74,0)
 .I $D(PSBFDA(53.793,"+2,"_PSBIEN,.01)) S PSBREC(1)=PSBREC(1)_(PSBFDA(53.793,"+2,"_PSBIEN,.01))
"RTN","PSBML2",75,0)
 .D VAL^PSBML(53.793,"+2,"_PSBIEN,.01,PSBREC(1)),VAL^PSBML(53.793,"+2,"_PSBIEN,.02,"`"_DUZ),VAL^PSBML(53.793,"+2,"_PSBIEN,.03,PSBNOW)
"RTN","PSBML2",76,0)
 S PSBXDFN=$$GET1^DIQ(53.79,PSBIEN,.01,"I")
"RTN","PSBML2",77,0)
 I ($$GET1^DIQ(53.79,+PSBIEN,.09,"I")="RM"),((PSBREC(0)="N")!(PSBREC(0)="G")) D
"RTN","PSBML2",78,0)
 .I '(($D(^XUSEC("PSB MANAGER",DUZ)))!($$GET1^DIQ(53.79,+PSBIEN,.07,"I")=DUZ)) S RESULTS(0)=1,RESULTS(1)="-1^Verify PSB MANAGER allocation" Q
"RTN","PSBML2",79,0)
 .S PSBXPTCH=1,PSBYY="",PSBGIVEN=0 F  S PSBYY=$O(^PSB(53.79,+PSBIEN,.9,PSBYY),-1) Q:'PSBYY  Q:(+$G(RESULTS(0))<0)  Q:PSBGIVEN  S PSBXDAT=$G(^(PSBYY,0))  D
"RTN","PSBML2",80,0)
 ..;PSB*3*45 Should be checking if action status changed to GIVEN
"RTN","PSBML2",81,0)
 ..I $P(PSBXDAT,"^",4)["GIVEN" D
"RTN","PSBML2",82,0)
 ...S PSBXDATE=$P(^PSB(53.79,+PSBIEN,.9,PSBYY,0),U)
"RTN","PSBML2",83,0)
 ...S PSBXORN=$$GET1^DIQ(53.79,+PSBIEN,.11,"I")
"RTN","PSBML2",84,0)
 ...S PSBYX=(PSBYY-2) I (PSBYX)>0 I ^PSB(53.79,+PSBIEN,.9,PSBYX,0)["ACTION DATE/TIME '" S PSBXDATE=$P(^PSB(53.79,+PSBIEN,.9,PSBYX,0),"'",2),X=$P(PSBXDATE,"@"),%DT="" D ^%DT S PSBXDATE=Y_"."_$TR($P(PSBXDATE,"@",2),":")
"RTN","PSBML2",85,0)
 ...S PSBXDT="" F  S PSBXDT=$O(^PSB(53.79,"AORDX",PSBXDFN,PSBXORN,PSBXDT)) Q:PSBXDT=""  D  Q:+$G(RESULTS(1))<0
"RTN","PSBML2",86,0)
 ....S PSBYZ="" F  S PSBYZ=$O(^PSB(53.79,"AORDX",PSBXDFN,PSBXORN,PSBXDT,PSBYZ)) Q:'PSBYZ  I ($$GET1^DIQ(53.79,PSBYZ,.09,"I")="G"),(PSBYZ'=+PSBIEN) S RESULTS(0)=1,RESULTS(1)="-1^Cannot UNDO! Order has GIVEN patch" Q
"RTN","PSBML2",87,0)
 ...I '(+$G(RESULTS(1))<0) D  S PSBGIVEN=1
"RTN","PSBML2",88,0)
 ....;PSB*3*45 Added PSBLSTG for the last user who gave the patch. this will be logged in order to undo multiple removed.
"RTN","PSBML2",89,0)
 ....S PSBLSTG=$P(PSBXDAT,"^",2),I="" F  S I=$O(^PSB(53.79,+PSBIEN,.9,I),-1) Q:'I  I $P(^PSB(53.79,+PSBIEN,.9,I,0),"^",4)["GIVEN" D  Q
"RTN","PSBML2",90,0)
 .....S PSBLSTG=$S($P($G(PSBXDAT),"^",5):$P(PSBXDAT,"^",5),1:$P(PSBXDAT,"^",2))
"RTN","PSBML2",91,0)
 ....D VAL^PSBML(53.79,PSBIEN,.06,PSBXDATE),VAL^PSBML(53.79,PSBIEN,.07,"`"_PSBLSTG),VAL^PSBML(53.79,PSBIEN,.09,"G") K PSBLSTG
"RTN","PSBML2",92,0)
 ..D:('(+$G(RESULTS(1))<0))&('PSBGIVEN)&($G(PSBXPTCH))&(PSBYY'>1)
"RTN","PSBML2",93,0)
 ...S PSBXDATE=$P(^PSB(53.79,+PSBIEN,.9,PSBYY,0),"'",2),X=$P(PSBXDATE,"@"),%DT="" D ^%DT S PSBXDATE=Y_"."_$TR($P(PSBXDATE,"@",2),":")
"RTN","PSBML2",94,0)
 ...D VAL^PSBML(53.79,PSBIEN,.06,PSBXDATE),VAL^PSBML(53.79,PSBIEN,.07,"`"_$$GET1^DIQ(53.79,+PSBIEN,.07,"I")),VAL^PSBML(53.79,PSBIEN,.09,"G") S PSBGIVEN=1
"RTN","PSBML2",95,0)
 Q:(+$G(RESULTS(1))<0)
"RTN","PSBML2",96,0)
 I PSBEDTFL,$G(PSBGIVEN),PSBXPTCH S PSBREC(0)="G",PSBUNTSG=$P(PSBREC(8),U,4) D VAL^PSBML(53.795,(1_","_PSBIEN),.03,$S(PSBUNTSG'=0:PSBUNTSG,1:1)) K PSBXPTCH
"RTN","PSBML2",97,0)
 I $G(PSBREC(2))]"" D VAL^PSBML(53.79,PSBIEN,.16,PSBREC(2))
"RTN","PSBML2",98,0)
 S PSBOLDUZ=$P(^PSB(53.79,+PSBIEN,0),U,7),PSBOLSTS=$P(^PSB(53.79,+PSBIEN,0),U,9)
"RTN","PSBML2",99,0)
 I $G(PSBREC(PSBRECNO))]"" D  ; DD/SOL/ADD
"RTN","PSBML2",100,0)
 .I PSBREC(0)="G"!(PSBREC(0)="I")!(PSBREC(0)="H")!(PSBREC(0)="R")!(PSBREC(0)="M") D  ; Only if gvn or infus
"RTN","PSBML2",101,0)
 ..Q:(PSBEDTFL)&('$G(PSBCHNG))
"RTN","PSBML2",102,0)
 ..F PSBCNT=PSBRECNO:1 Q:'$D(PSBREC(PSBCNT))  D
"RTN","PSBML2",103,0)
 ...S Y=$P(PSBREC(PSBCNT),U)
"RTN","PSBML2",104,0)
 ...S PSBDD=$S(Y="DD":53.795,Y="ADD":53.796,Y="SOL":53.797,1:0)
"RTN","PSBML2",105,0)
 ...Q:'PSBDD
"RTN","PSBML2",106,0)
 ...I $G(PSBCHNG) D
"RTN","PSBML2",107,0)
 ....I $D(PSBFIND(PSBCNT)) S PSBIENS=$QS($Q(PSBFIND(PSBCNT)),2)_","_PSBIEN
"RTN","PSBML2",108,0)
 ....I '$D(PSBFIND(PSBCNT)) S PSBIENS="+1,"_PSBIEN
"RTN","PSBML2",109,0)
 ....D VAL^PSBML(PSBDD,PSBIENS,.01,"`"_$P(PSBREC(PSBCNT),U,2))
"RTN","PSBML2",110,0)
 ....D VAL^PSBML(PSBDD,PSBIENS,.02,$P(PSBREC(PSBCNT),U,3))
"RTN","PSBML2",111,0)
 ....D VAL^PSBML(PSBDD,PSBIENS,.03,$P(PSBREC(PSBCNT),U,4))
"RTN","PSBML2",112,0)
 ....D:Y="DD" VAL^PSBML(PSBDD,PSBIENS,.04,$P(PSBREC(PSBCNT),U,5))
"RTN","PSBML2",113,0)
 ....D VAL^PSBML(PSBDD,PSBIENS,.05,$P(PSBREC(PSBCNT),U,7))     ;HR *70
"RTN","PSBML2",114,0)
 .I ('PSBEDTFL)!((PSBREC(0)'="G")&($$GET1^DIQ(53.79,PSBIEN,.09,"I")="G")) D
"RTN","PSBML2",115,0)
 ..S (PSBDCNT,PSBACNT,PSBSCNT)=0,PSBADD=3 F PSBCNT=PSBRECNO:1 Q:'$D(PSBREC(PSBCNT))  D
"RTN","PSBML2",116,0)
 ...S Y=$P(PSBREC(PSBCNT),U)
"RTN","PSBML2",117,0)
 ...S PSBDD=$S(Y="DD":53.795,Y="ADD":53.796,Y="SOL":53.797,1:0)
"RTN","PSBML2",118,0)
 ...Q:'PSBDD
"RTN","PSBML2",119,0)
 ...S @("PSB"_$E(Y)_"CNT")=@("PSB"_$E(Y)_"CNT")+1
"RTN","PSBML2",120,0)
 ...S PSBIENS=(@("PSB"_$E(Y)_"CNT"))_","_PSBIEN
"RTN","PSBML2",121,0)
 ...I '$$GET1^DIQ(PSBDD,PSBIENS,.01,"I") S PSBIENS="+"_PSBADD_","_PSBIEN,PSBADD=PSBADD+1
"RTN","PSBML2",122,0)
 ...D VAL^PSBML(PSBDD,PSBIENS,.01,"`"_$P(PSBREC(PSBCNT),U,2))
"RTN","PSBML2",123,0)
 ...D VAL^PSBML(PSBDD,PSBIENS,.02,$P(PSBREC(PSBCNT),U,3))
"RTN","PSBML2",124,0)
 ...D:Y="DD" VAL^PSBML(PSBDD,PSBIENS,.03,$S(PSBREC(0)="G"!(PSBREC(0)="RM"):$P(PSBREC(PSBCNT),U,4),1:0)),VAL^PSBML(PSBDD,PSBIENS,.04,$P(PSBREC(PSBCNT),U,5))
"RTN","PSBML2",125,0)
 ...I PSBDD=53.796!(PSBDD=53.797),PSBREC(0)="G" D VAL^PSBML(PSBDD,PSBIENS,.03,$P(PSBREC(PSBCNT),U,4))
"RTN","PSBML2",126,0)
 I ($G(PSBREC(PSBRECNO))']""),(PSBREC(0)="N"),($$GET1^DIQ(53.79,PSBIEN,.09,"I")="G") D
"RTN","PSBML2",127,0)
 .S PSBX=0 F  S PSBX=$O(^PSB(53.79,+PSBIEN,.5,PSBX)) Q:'+PSBX  D VAL^PSBML(53.795,(PSBX_","_PSBIEN),.03,0)
"RTN","PSBML2",128,0)
 I PSBWITHR>1,PSBREC(0)="G" D     ;Witness logic and Give?  *70
"RTN","PSBML2",129,0)
 .D:PSBWITN VAL^PSBML(53.79,PSBIEN,.28,PSBNOW)        ;Witness dt/time
"RTN","PSBML2",130,0)
 .D:PSBWITN VAL^PSBML(53.79,PSBIEN,.29,"`"_PSBWITN)   ;Witness duz
"RTN","PSBML2",131,0)
 .D:PSBWITCM]"" VAL^PSBML(53.79,PSBIEN,.31,PSBWITCM)  ;Witness comment
"RTN","PSBML2",132,0)
 .D VAL^PSBML(53.79,PSBIEN,.32,PSBWITHR)          ;Witness HR ord code
"RTN","PSBML2",133,0)
 .D VAL^PSBML(53.79,PSBIEN,.33,PSBWITFL)          ;Witnessed? flag
"RTN","PSBML2",134,0)
 ;
"RTN","PSBML2",135,0)
 I PSBWITHR>1,PSBREC(0)="N" D      ;Undo Give of Witness fields    *70
"RTN","PSBML2",136,0)
 .N WTDT,WTNS,WTCM,WTHR,WTFL       ;only delete if currently has data
"RTN","PSBML2",137,0)
 .S WTDT=$$GET1^DIQ(53.79,+PSBIEN,.28,"I")
"RTN","PSBML2",138,0)
 .S WTNS=$$GET1^DIQ(53.79,+PSBIEN,.29,"I")
"RTN","PSBML2",139,0)
 .S WTCM=$$GET1^DIQ(53.79,+PSBIEN,.31,"I")
"RTN","PSBML2",140,0)
 .S WTHR=$$GET1^DIQ(53.79,+PSBIEN,.32,"I")
"RTN","PSBML2",141,0)
 .S WTFL=$$GET1^DIQ(53.79,+PSBIEN,.33,"I")
"RTN","PSBML2",142,0)
 .D:WTDT VAL^PSBML(53.79,PSBIEN,.28,"@")
"RTN","PSBML2",143,0)
 .D:WTNS VAL^PSBML(53.79,PSBIEN,.29,"@")
"RTN","PSBML2",144,0)
 .D:WTCM]"" VAL^PSBML(53.79,PSBIEN,.31,"@")
"RTN","PSBML2",145,0)
 .D:WTHR>1 VAL^PSBML(53.79,PSBIEN,.32,"@")
"RTN","PSBML2",146,0)
 .D:WTFL]"" VAL^PSBML(53.79,PSBIEN,.33,"@")
"RTN","PSBML2",147,0)
 D FILEIT^PSBML
"RTN","PSBML2",148,0)
 I $P($G(RESULTS(1)),U,1)=1 D
"RTN","PSBML2",149,0)
 .S PSBUID=$P(^PSB(53.79,+PSBIEN,0),U,10) I PSBUID]"",PSBUID'["WS" D
"RTN","PSBML2",150,0)
 ..S PSBTS=PSBREC(0)
"RTN","PSBML2",151,0)
 ..S PSBON=$P(^PSB(53.79,+PSBIEN,.1),U,1)
"RTN","PSBML2",152,0)
 ..S PSBDFN=$P(^PSB(53.79,+PSBIEN,0),U,1)
"RTN","PSBML2",153,0)
 ..I PSBREC(0)="N" S PSBTS="" D
"RTN","PSBML2",154,0)
 ...M PSBAR=^PSB(53.79,+PSBIEN,.9)
"RTN","PSBML2",155,0)
 ...S (PSBDN,X)="" F  S X=$O(PSBAR(X),-1) Q:X=0!(PSBDN=1)  D
"RTN","PSBML2",156,0)
 ....I PSBAR(X,0)["ACTION STATUS",PSBAR(X,0)["deleted",PSBAR(X,0)'["GIVEN" D
"RTN","PSBML2",157,0)
 .....S PSBTS=$P($P(PSBAR(X,0),"'",2),"'",1)
"RTN","PSBML2",158,0)
 .....S PSBTS=$S(PSBTS="HELD":"H",PSBTS="REFUSED":"R",PSBTS="REMOVED":"RM",PSBTS="MISSING":"M",1:""),PSBDN=1
"RTN","PSBML2",159,0)
 ...D VAL^PSBML(53.79,PSBIEN,.26,"") D CLEAN^DILF,UPDATE^DIE("","PSBFDA","PSBIEN","PSBMSG")
"RTN","PSBML2",160,0)
 ..D EN^PSJBCMA3(PSBDFN,+PSBON,PSBUID,PSBTS,PSBNOW)
"RTN","PSBML2",161,0)
 I ($$GET1^DIQ(53.79,+PSBIEN,.12,"I")="O")&($$GET1^DIQ(53.79,+PSBIEN,.09,"I")="N") S PSBDFN=$$GET1^DIQ(53.79,+PSBIEN,.01,"I") D ENR^PSJBCMA4(PSBDFN,$$GET1^DIQ(53.79,+PSBIEN,.11))
"RTN","PSBML2",162,0)
 I ($$GET1^DIQ(53.79,+PSBIEN,.12,"I")="O")&($$GET1^DIQ(53.79,+PSBIEN,.09,"I")="G") S PSBDFN=$$GET1^DIQ(53.79,+PSBIEN,.01,"I") D ENE^PSJBCMA4(PSBDFN,$$GET1^DIQ(53.79,+PSBIEN,.11))
"RTN","PSBML2",163,0)
 I (PSBREC(0)="N")&($$GET1^DIQ(53.79,+PSBIEN,.09,"I")="N") D NGRESET^PSBML3(.PSBREC,PSBIEN)
"RTN","PSBML2",164,0)
 Q
"RTN","PSBML3")
0^49^B46997085^B43135068
"RTN","PSBML3",1,0)
PSBML3 ;BIRMINGHAM/TEJ-BCMA UTILITY TO EDIT THE PSB MED LOG  ;4/4/13 2:17pm
"RTN","PSBML3",2,0)
 ;;3.0;BAR CODE MED ADMIN;**3,13,39,41,70**;Mar 2004;Build 101
"RTN","PSBML3",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSBML3",4,0)
 ;
"RTN","PSBML3",5,0)
 ; Reference/IA
"RTN","PSBML3",6,0)
 ; $$GET1^DIQ/2056
"RTN","PSBML3",7,0)
 ;
"RTN","PSBML3",8,0)
 ;*70 - fix Tag CHANGE to compare the DD, Add, & Sol multiples for
"RTN","PSBML3",9,0)
 ;      only the first 5 pieces and ignore the HR flag new 6th piece.
"RTN","PSBML3",10,0)
 ;        example of pieces 1-5: "DD^363^1^3^TAB"
"RTN","PSBML3",11,0)
 ;      Edit Medlog function in BCMA uses this compare to control
"RTN","PSBML3",12,0)
 ;      Audit entries for the DD, Add, & Sol multiples & Edit Medlog
"RTN","PSBML3",13,0)
 ;      updates.
"RTN","PSBML3",14,0)
 ;
"RTN","PSBML3",15,0)
APATCH ; Maintain "APATCH" index...
"RTN","PSBML3",16,0)
 I $G(PSBTRAN)["MEDPASS" D:$P(PSBREC(9),U)="UDTAB"  Q
"RTN","PSBML3",17,0)
 .S PSBX1=9,PSBQUT=0 F  S PSBX1=$O(PSBREC(PSBX1))  Q:PSBQUT  Q:'(+PSBX1)  D:$P(PSBREC(PSBX1),U)="DD"&($P(PSBREC(PSBX1),U,5)="PATCH")  Q:PSBQUT
"RTN","PSBML3",18,0)
 ..I $G(PSBOLSTS)="",PSBREC(3)="G" S PSB1="I $D(PSBIEN(1)) S ^PSB(53.79,""APATCH"","_$G(PSBREC(0))_","_$G(PSBNOW)_",+PSBIEN(1))="""""
"RTN","PSBML3",19,0)
 ..S PSBQUT=1
"RTN","PSBML3",20,0)
 S PSBX1=0 F  S PSBX1=$O(^PSB(53.79,+PSBIEN,.5,PSBX1)) Q:'(+PSBX1)  Q
"RTN","PSBML3",21,0)
 I $G(PSBTRAN)["UPDATE",(+PSBX1)'=0 D
"RTN","PSBML3",22,0)
 .S PSBX3=0 F  S PSBX3=$O(^PSB(53.79,+PSBIEN,.5,PSBX3)) Q:+PSBX3=0  I $P(^PSB(53.79,+PSBIEN,.5,PSBX3,0),U,4)="PATCH" D
"RTN","PSBML3",23,0)
 ..I PSBOLSTS="G",PSBREC(0)="N" S PSB1="K ^PSB(53.79,""APATCH"","_$P(^PSB(53.79,+PSBIEN,0),U)_","_$P(^PSB(53.79,+PSBIEN,0),U,6)_","_+PSBIEN_")"
"RTN","PSBML3",24,0)
 ..I PSBFDA(53.79,+PSBIEN_",",.09)="G" S PSB1="S ^PSB(53.79,""APATCH"","_$P(^PSB(53.79,+PSBIEN,0),U)_","_$G(PSBFDA(53.79,+PSBIEN_",",.06))_","_+PSBIEN_")"_"="""""
"RTN","PSBML3",25,0)
 I $G(PSBTRAN)["EDIT",(+PSBX1)'=0 D
"RTN","PSBML3",26,0)
 .S PSBX3=0 F  S PSBX3=$O(^PSB(53.79,+PSBIEN,.5,PSBX3)) Q:+PSBX3=0  I $P(^PSB(53.79,+PSBIEN,.5,PSBX3,0),U,4)="PATCH",((PSBREC(0)="G")!(PSBREC(0)="RM")) D
"RTN","PSBML3",27,0)
 ..S PSB1="S ^PSB(53.79,""APATCH"","_$P(^PSB(53.79,+PSBIEN,0),U)_","_$G(PSBFDA(53.79,+PSBIEN_",",.06))_","_+PSBIEN_")"_"="""""
"RTN","PSBML3",28,0)
 ..I $D(PSBREC(4,0)) S PSB2="K ^PSB(53.79,""APATCH"","_$P(^PSB(53.79,+PSBIEN,0),U)_","_$G(PSBREC(4,0))_","_+PSBIEN_")"
"RTN","PSBML3",29,0)
 Q
"RTN","PSBML3",30,0)
 ;
"RTN","PSBML3",31,0)
CHANGE(PSBREC,PSBEDIEN) ;Determine an order edit
"RTN","PSBML3",32,0)
 S PSBCHNG=0
"RTN","PSBML3",33,0)
 K PSBORDMD,PSBDDX
"RTN","PSBML3",34,0)
 I PSBREC(0)'=$$GET1^DIQ(53.79,PSBEDIEN,.09,"I") S PSBREC(0,0)=1,PSBCHNG=1
"RTN","PSBML3",35,0)
 I PSBREC(2)'=$$GET1^DIQ(53.79,PSBEDIEN,.16,"I") S PSBREC(2,0)=1,PSBCHNG=1
"RTN","PSBML3",36,0)
 I PSBREC(4)'=$$GET1^DIQ(53.79,PSBEDIEN,.06,"I") S PSBREC(4,0)=$$GET1^DIQ(53.79,PSBEDIEN,.06,"I"),PSBCHNG=1
"RTN","PSBML3",37,0)
 I PSBREC(5)'=$$GET1^DIQ(53.79,PSBEDIEN,.21) S PSBREC(5,0)=1,PSBCHNG=1
"RTN","PSBML3",38,0)
 I PSBREC(6)'=$$GET1^DIQ(53.79,PSBEDIEN,.22) S PSBREC(6,0)=1,PSBCHNG=1
"RTN","PSBML3",39,0)
 K PSBFIND,PSBFOUN,PSBREC2
"RTN","PSBML3",40,0)
 F PSBRECNX=8:1 Q:'$D(PSBREC(PSBRECNX))  S PSBDPTR=$P(PSBREC(PSBRECNX),U,2),PSBORDMD(PSBRECNX,PSBDPTR,0)="ADDED"
"RTN","PSBML3",41,0)
 F PSBDDX=.5,.6,.7 D:$D(^PSB(53.79,+PSBEDIEN,PSBDDX,"B"))
"RTN","PSBML3",42,0)
 .S PSBDPTR="" F  S PSBDPTR=$O(^PSB(53.79,+PSBEDIEN,PSBDDX,"B",PSBDPTR)) Q:+PSBDPTR'>0  D
"RTN","PSBML3",43,0)
 ..S PSBXX=0 F  S PSBXX=$O(^PSB(53.79,+PSBEDIEN,PSBDDX,"B",PSBDPTR,PSBXX)) Q:+PSBXX'>0  D  Q:'$$FINDDD^PSBML3(PSBDDX,PSBDPTR)
"RTN","PSBML3",44,0)
 ...I '$D(PSBFOUN(PSBDDX,PSBXX)) F PSBRECNX=8:1 Q:'$D(PSBREC(PSBRECNX))  D:$D(PSBORDMD(PSBRECNX))  Q:$D(PSBFOUN(PSBDDX,PSBXX))
"RTN","PSBML3",45,0)
 ....S PSBDFDA=$P(PSBREC(PSBRECNX),U) Q:$S(PSBDFDA="DD":.5,PSBDFDA="ADD":.6,PSBDFDA="SOL":.7)'=PSBDDX
"RTN","PSBML3",46,0)
 ....S PSBDATAX=PSBDFDA_"^"_$G(^PSB(53.79,+PSBEDIEN,PSBDDX,PSBXX,0))_$S(PSBDDX'=.5:"^",1:"")
"RTN","PSBML3",47,0)
 ....S:$P(PSBDATAX,U,3)?1"."1.N $P(PSBDATAX,U,3)=0_+$P(PSBDATAX,U,3)
"RTN","PSBML3",48,0)
 ....S:$P(PSBDATAX,U,4)?1"."1.N $P(PSBDATAX,U,4)=0_+$P(PSBDATAX,U,4)
"RTN","PSBML3",49,0)
 ....I PSBDATAX=PSBREC(PSBRECNX) K PSBORDMD(PSBRECNX),PSBREC2(PSBRECNX) S (PSBFIND(PSBRECNX,PSBXX),PSBFOUN(PSBDDX,PSBXX))=1 Q
"RTN","PSBML3",50,0)
 ....S PSBUNTOR=$P(PSBDATAX,U,3),PSBUNTGN=$P(PSBDATAX,U,4),PSBUNTAD=$P(PSBDATAX,U,5)
"RTN","PSBML3",51,0)
 ....I PSBREC(PSBRECNX)[(PSBDFDA_"^"_PSBDPTR_"^"_PSBUNTOR_"^") S PSBREC2(PSBRECNX)=PSBREC(PSBRECNX)
"RTN","PSBML3",52,0)
 D:$D(PSBREC2)
"RTN","PSBML3",53,0)
 .F PSBDDX=.5,.6,.7 D:$D(^PSB(53.79,+PSBEDIEN,PSBDDX,"B"))
"RTN","PSBML3",54,0)
 ..S PSBDPTR="" F  S PSBDPTR=$O(^PSB(53.79,+PSBEDIEN,PSBDDX,"B",PSBDPTR)) Q:+PSBDPTR'>0  D
"RTN","PSBML3",55,0)
 ...S PSBXX=0 F  S PSBXX=$O(^PSB(53.79,+PSBEDIEN,PSBDDX,"B",PSBDPTR,PSBXX)) Q:+PSBXX'>0  D
"RTN","PSBML3",56,0)
 ....S PSBREC2X=0 F  S PSBREC2X=$O(PSBREC2(PSBREC2X)) Q:PSBREC2X=""  D  Q:$G(PSBFOUN(PSBDDX,PSBXX))
"RTN","PSBML3",57,0)
 .....S PSBDFDA=$P(PSBREC(PSBREC2X),U) Q:$S(PSBDFDA="DD":.5,PSBDFDA="ADD":.6,PSBDFDA="SOL":.7)'=PSBDDX
"RTN","PSBML3",58,0)
 .....S PSBDATAX=PSBDFDA_"^"_$G(^PSB(53.79,+PSBEDIEN,PSBDDX,PSBXX,0))
"RTN","PSBML3",59,0)
 .....S:$P(PSBDATAX,U,3)?1"."1.N $P(PSBDATAX,U,3)=0_+$P(PSBDATAX,U,3)
"RTN","PSBML3",60,0)
 .....S:$P(PSBDATAX,U,4)?1"."1.N $P(PSBDATAX,U,4)=0_+$P(PSBDATAX,U,4)
"RTN","PSBML3",61,0)
 .....; *70 compare only first 5 pieces ignoring the new HR piece
"RTN","PSBML3",62,0)
 .....I $P(PSBDATAX,U,1,5)=$P(PSBREC(PSBREC2X),U,1,5) K PSBREC2(PSBREC2X),PSBORDMD(PSBREC2X) S (PSBFIND(PSBREC2X,PSBXX),PSBFOUN(PSBDDX,PSBXX))=1 Q
"RTN","PSBML3",63,0)
 .....S PSBUNTOR=$P(PSBDATAX,U,3),PSBUNTGN=$P(PSBDATAX,U,4),PSBUNTAD=$P(PSBDATAX,U,5)
"RTN","PSBML3",64,0)
 .....I PSBREC2(PSBREC2X)[(PSBDFDA_"^"_PSBDPTR_"^"_PSBUNTOR_"^") I '$D(PSBFOUN(PSBDDX,PSBXX)) S (PSBCHNG,PSBFIND(PSBREC2X,PSBXX),PSBFOUN(PSBDDX,PSBXX))=1 D  Q
"RTN","PSBML3",65,0)
 ......N PSBY,Y F Y=4,5 S PSBY=$P(PSBREC2(PSBREC2X),U,Y) S:PSBY'=$S(Y=4:PSBUNTGN,Y=5:PSBUNTAD) PSBORDMD(PSBREC2X,PSBDPTR,0)=""
"RTN","PSBML3",66,0)
 ; Modify FDA per Deleted DDs
"RTN","PSBML3",67,0)
 ;
"RTN","PSBML3",68,0)
 F PSBX=.5,.6,.7 S PSBXX="" F  Q:'$D(PSBORDMD(PSBX))  S PSBXX=$O(PSBORDMD(PSBX,PSBXX)) Q:$G(PSBXX)=""  D:PSBORDMD(PSBX,PSBXX,0)["DELETE"
"RTN","PSBML3",69,0)
 .S PSBDDX=$S(PSBX=.5:53.795,PSBX=.6:53.796,1:53.797)
"RTN","PSBML3",70,0)
 .S PSBIENX="^PSB(53.79,"_($G(PSBEDIEN))_($G(PSBX))_",""B"","_PSBXX_")"
"RTN","PSBML3",71,0)
 .S PSBIENX=$Q(@PSBIENX),PSBIENX=$QS(PSBIENX,6)_","_(+PSBEDIEN)
"RTN","PSBML3",72,0)
 .D:'$D(PSBFOUN(PSBDDX,+PSBIENX)) VAL^PSBML(PSBDDX,PSBIENX,.01,""),VAL^PSBML(PSBDDX,PSBIENX,.02,""),VAL^PSBML(PSBDDX,PSBIENX,.03,""),VAL^PSBML(PSBDDX,PSBIENX,.04,"")
"RTN","PSBML3",73,0)
 ;
"RTN","PSBML3",74,0)
 S:$D(PSBORDMD) PSBCHNG=1 K PSBREC2
"RTN","PSBML3",75,0)
 Q PSBCHNG
"RTN","PSBML3",76,0)
 ;
"RTN","PSBML3",77,0)
NGRESET(PSBREC,PSBREIEN) ;
"RTN","PSBML3",78,0)
 ;
"RTN","PSBML3",79,0)
 ; Acknowledged "UNDO" - reinstate previous status and state...
"RTN","PSBML3",80,0)
 ;
"RTN","PSBML3",81,0)
 I (PSBREC(0)="N")&($$GET1^DIQ(53.79,PSBREIEN,.09,"I")="N") D  I '$D(PSBQUITX)  S PSBREINT=$$GET1^DIQ(53.79,PSBREIEN,.05,"I")
"RTN","PSBML3",82,0)
 .S PSBRESET="NOT GIVEN",PSBX="B" K PSBQUITX,PSBREXDT,PSBREINT F  S PSBX=$O(^PSB(53.79,+PSBREIEN,.9,PSBX),-1) Q:PSBX'>0  D  Q:($G(PSBQUITX))!(PSBX'>0)
"RTN","PSBML3",83,0)
 ..I (^PSB(53.79,+PSBREIEN,.9,PSBX,0)'["ACTION STATUS Set to") Q
"RTN","PSBML3",84,0)
 ..I $P(^PSB(53.79,+PSBREIEN,.9,PSBX,0),U,4)=PSBRESET D  Q:$G(PSBQUITX)  Q:PSBX'>0
"RTN","PSBML3",85,0)
 ...S PSBREXDT=$P(^PSB(53.79,+PSBREIEN,.9,PSBX,0),U)
"RTN","PSBML3",86,0)
 ...F  S PSBX=$O(^PSB(53.79,+PSBREIEN,.9,PSBX),-1) Q:PSBX'>0  D  Q:$G(PSBQUITX)
"RTN","PSBML3",87,0)
 ....I (^PSB(53.79,+PSBREIEN,.9,PSBX,0)'["ACTION STATUS")!(^PSB(53.79,+PSBREIEN,.9,PSBX,0)'["deleted") Q
"RTN","PSBML3",88,0)
 ....I $P(^PSB(53.79,+PSBREIEN,.9,PSBX,0),"'",2)'="GIVEN" Q 
"RTN","PSBML3",89,0)
 ....F  S PSBX=$O(^PSB(53.79,+PSBREIEN,.9,PSBX),-1) Q:(PSBX'>0)!($G(PSBQUITX))  D  Q:$G(PSBQUIT)
"RTN","PSBML3",90,0)
 .....I (^PSB(53.79,+PSBREIEN,.9,PSBX,0)'["ACTION STATUS ")!(^PSB(53.79,+PSBREIEN,.9,PSBX,0)'["deleted") Q
"RTN","PSBML3",91,0)
 .....S PSBRESET=$P(^PSB(53.79,+PSBREIEN,.9,PSBX,0),"'",2) I (PSBRESET="GIVEN")!(PSBRESET="REMOVED") Q
"RTN","PSBML3",92,0)
 .....S PSBREXDT=$$GET1^DIQ(53.79,PSBREIEN,.04,"I"),PSBX=PSBX-2 I '$D(^PSB(53.79,+PSBREIEN,.9,PSBX,0)) S PSBQUIT=1 Q
"RTN","PSBML3",93,0)
 .....I (^PSB(53.79,+PSBREIEN,.9,PSBX,0)'["ACTION DATE/TIME")!(^PSB(53.79,+PSBREIEN,.9,PSBX,0)'["deleted") S PSBQUIT=1 Q
"RTN","PSBML3",94,0)
 .....S PSBREXDT=$P(^PSB(53.79,+PSBREIEN,.9,PSBX,0),"'",2),X=$P(PSBREXDT,"@"),%DT="" D ^%DT S PSBREXDT=Y_"."_$TR($P(PSBREXDT,"@",2),":"),PSBQUIT=1
"RTN","PSBML3",95,0)
 I $D(PSBREINT),$D(PSBREXDT),($D(PSBRESET)&($G(PSBRESET)'="GIVEN")) D
"RTN","PSBML3",96,0)
 .D VAL^PSBML(53.79,PSBREIEN,.06,PSBREXDT)
"RTN","PSBML3",97,0)
 .D VAL^PSBML(53.79,PSBREIEN,.09,PSBRESET)
"RTN","PSBML3",98,0)
 .D:$D(PSBREINT) VAL^PSBML(53.79,PSBREIEN,.07,"`"_PSBREINT)
"RTN","PSBML3",99,0)
 .D:'$G(PSBERR) FILEIT^PSBML
"RTN","PSBML3",100,0)
 K PSBXXX,PSBRESET,PSBREXDT,PSBREINT,PSBQUITX
"RTN","PSBML3",101,0)
 Q
"RTN","PSBML3",102,0)
 ;
"RTN","PSBML3",103,0)
FINDDD(PSBDDXX,PSBDDPTR) ;
"RTN","PSBML3",104,0)
 ;
"RTN","PSBML3",105,0)
 ;  Determine if edit - 'change' is deleted DDrug 
"RTN","PSBML3",106,0)
 ;
"RTN","PSBML3",107,0)
 S FINDDD=0
"RTN","PSBML3",108,0)
 I $D(PSBREC(8)) D
"RTN","PSBML3",109,0)
 .F PSBINDX=8:1 Q:'$D(PSBREC(PSBINDX))  S PSBCOMPX=$G(PSBREC(PSBINDX)) D  Q:FINDDD
"RTN","PSBML3",110,0)
 ..I ($S(PSBDDXX=.5:"DD",PSBDDXX=.6:"ADD",PSBDDXX=.7:"SOL",1:"")=$P(PSBCOMPX,U)),(PSBDDPTR=$P(PSBCOMPX,U,2)) S FINDDD=1
"RTN","PSBML3",111,0)
 I 'FINDDD S PSBORDMD(PSBDDXX,PSBDDPTR,0)="DELETED"
"RTN","PSBML3",112,0)
 Q FINDDD
"RTN","PSBML3",113,0)
 ;
"RTN","PSBMLLKU")
0^42^B105244000^B85731436
"RTN","PSBMLLKU",1,0)
PSBMLLKU ;BIRMINGHAM/TEJ - BCMA RPC LOOKUP UTLILITIES ;9/18/12 1:24am
"RTN","PSBMLLKU",2,0)
 ;;3.0;BAR CODE MED ADMIN;**3,9,11,20,13,38,32,56,42,70**;Mar 2004;Build 101
"RTN","PSBMLLKU",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSBMLLKU",4,0)
 ;
"RTN","PSBMLLKU",5,0)
 ; Reference/IA
"RTN","PSBMLLKU",6,0)
 ; EN^PSJBCMA1/2829
"RTN","PSBMLLKU",7,0)
 ; $$DOB^DPTLK1/3266
"RTN","PSBMLLKU",8,0)
 ; $$SSN^DPTLK1/3267
"RTN","PSBMLLKU",9,0)
 ; ^DPT/10035
"RTN","PSBMLLKU",10,0)
 ; ^XUSEC/10076
"RTN","PSBMLLKU",11,0)
 ; File 52.6/436
"RTN","PSBMLLKU",12,0)
 ; File 52.7/437
"RTN","PSBMLLKU",13,0)
 ; File 50/221
"RTN","PSBMLLKU",14,0)
 ; File 211.4/1409
"RTN","PSBMLLKU",15,0)
 ;
"RTN","PSBMLLKU",16,0)
 ;*70 - create a lookup for Clinics that returns all patients per 
"RTN","PSBMLLKU",17,0)
 ;      clinic selected for Client to then pass one at a time for
"RTN","PSBMLLKU",18,0)
 ;      coversheet reports and enable the NEXT button for user
"RTN","PSBMLLKU",19,0)
 ;      selection to process the next DFN for a coversheet report.
"RTN","PSBMLLKU",20,0)
 ;
"RTN","PSBMLLKU",21,0)
RPC(RESULTS,PSBREC) ; Remote Procedure Call Entry Point.
"RTN","PSBMLLKU",22,0)
 ;
"RTN","PSBMLLKU",23,0)
 ;*70 piece out mode if exists & reset 0 node for bkwds compatability
"RTN","PSBMLLKU",24,0)
 N PSBCLINORD
"RTN","PSBMLLKU",25,0)
 S PSBCLINORD=$P(PSBREC(0),U,2),PSBREC(0)=$P(PSBREC(0),U)
"RTN","PSBMLLKU",26,0)
 ;
"RTN","PSBMLLKU",27,0)
 S RESULTS="" D @(PSBREC(0)_"(.RESULTS,.PSBREC)") Q
"RTN","PSBMLLKU",28,0)
 Q
"RTN","PSBMLLKU",29,0)
 ;
"RTN","PSBMLLKU",30,0)
ADMLKUP(RESULTS,PSBREC) ;
"RTN","PSBMLLKU",31,0)
 ;  Lookup ADMinistrations per DFN and search DATE
"RTN","PSBMLLKU",32,0)
 ;   input - PSBREC(1)  DFN
"RTN","PSBMLLKU",33,0)
 ;           PSBREC(2)  Search DATE
"RTN","PSBMLLKU",34,0)
 ;
"RTN","PSBMLLKU",35,0)
 ;   outpt - RESULTS (array)
"RTN","PSBMLLKU",36,0)
 ;          (Administrations returned will be dated  = to Search Date
"RTN","PSBMLLKU",37,0)
 ;
"RTN","PSBMLLKU",38,0)
 ;
"RTN","PSBMLLKU",39,0)
 K RESULTS
"RTN","PSBMLLKU",40,0)
 S DFN=PSBREC(1),PSBSRCH=$G(PSBREC(2)) I $G(PSBSRCH)']"" D NOW^%DTC S PSBSRCH=$P(%,".")
"RTN","PSBMLLKU",41,0)
 S PSBDT=PSBSRCH,PSBCNT=0 S:PSBSRCH'["." PSBSRCH=PSBSRCH+.9
"RTN","PSBMLLKU",42,0)
 S RESULTS(0)=1,RESULTS(1)="-1^No Meds Found!"
"RTN","PSBMLLKU",43,0)
 F  S PSBSRCH=$O(^PSB(53.79,"AADT",DFN,PSBSRCH),-1) Q:'PSBSRCH!(PSBSRCH<PSBDT)  D
"RTN","PSBMLLKU",44,0)
 .S PSBIEN=""
"RTN","PSBMLLKU",45,0)
 .F  S PSBIEN=$O(^PSB(53.79,"AADT",DFN,PSBSRCH,PSBIEN),-1) Q:'PSBIEN  D:'$D(^PSB(53.79,PSBIEN)) KILLAADT  Q:'$D(^PSB(53.79,PSBIEN))  D:$$CHKKEY(PSBIEN)
"RTN","PSBMLLKU",46,0)
 ..L +^PSB(53.79,PSBIEN):1
"RTN","PSBMLLKU",47,0)
 ..I  L -^PSB(53.79,PSBIEN)
"RTN","PSBMLLKU",48,0)
 ..E  Q
"RTN","PSBMLLKU",49,0)
 ..S PSBXORDN=$$GET1^DIQ(53.79,PSBIEN_",",.11) Q:'$D(^PSB(53.79,"AORDX",DFN,PSBXORDN,PSBSRCH))
"RTN","PSBMLLKU",50,0)
 ..Q:($$GET1^DIQ(53.79,PSBIEN_",",.06,"I")>PSBSRCH)
"RTN","PSBMLLKU",51,0)
 ..Q:($$GET1^DIQ(53.79,PSBIEN_",",.09,"I")="N")
"RTN","PSBMLLKU",52,0)
 ..S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=PSBIEN
"RTN","PSBMLLKU",53,0)
 ..S $P(RESULTS(PSBCNT),U,2)=PSBSRCH
"RTN","PSBMLLKU",54,0)
 ..S $P(RESULTS(PSBCNT),U,3)=$$GET1^DIQ(53.79,PSBIEN_",",.08)
"RTN","PSBMLLKU",55,0)
 ..S:$$GET1^DIQ(53.79,PSBIEN_",",.26) $P(RESULTS(PSBCNT),U,4)=$$GET1^DIQ(53.79,PSBIEN_",",.26)
"RTN","PSBMLLKU",56,0)
 ..S $P(RESULTS(PSBCNT),U,5)=$S($$GET1^DIQ(53.79,PSBIEN_",",.09,"I")']"":"U",1:$$GET1^DIQ(53.79,PSBIEN_",",.09,"I"))
"RTN","PSBMLLKU",57,0)
 ..D  ; Get order information
"RTN","PSBMLLKU",58,0)
 ...K ^TMP("PSJ1",$J) D EN^PSJBCMA1(DFN,PSBXORDN,1)
"RTN","PSBMLLKU",59,0)
 ...S $P(RESULTS(PSBCNT),U,3)=$P(^TMP("PSJ1",$J,2),U,2)  ;OItem_" "_Dosage Form
"RTN","PSBMLLKU",60,0)
 ...S $P(RESULTS(PSBCNT),U,6)=$P(^TMP("PSJ1",$J,4),U)    ;Sched Type
"RTN","PSBMLLKU",61,0)
 ...K ^TMP("PSJ1",$J)
"RTN","PSBMLLKU",62,0)
 ..S $P(RESULTS(PSBCNT),U,7)=$$GET1^DIQ(53.79,PSBIEN_",",.06,"I")
"RTN","PSBMLLKU",63,0)
 ..S $P(RESULTS(PSBCNT),U,8)=$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY:INITIAL")
"RTN","PSBMLLKU",64,0)
 ..S:$D(^PSB(53.79,PSBIEN,.2)) $P(RESULTS(PSBCNT),U,9)=$P(^PSB(53.79,PSBIEN,.2),U),$P(RESULTS(PSBCNT),U,10)=$P(^PSB(53.79,PSBIEN,.2),U,2)
"RTN","PSBMLLKU",65,0)
 S:+$G(RESULTS(1))>0 $P(RESULTS(0),U)=PSBCNT
"RTN","PSBMLLKU",66,0)
 Q
"RTN","PSBMLLKU",67,0)
 ;
"RTN","PSBMLLKU",68,0)
CHKKEY(PSBIENX) ;
"RTN","PSBMLLKU",69,0)
 I '(($D(^XUSEC("PSB MANAGER",DUZ)))!($$GET1^DIQ(53.79,+PSBIENX,.07,"I")=DUZ)) Q 0
"RTN","PSBMLLKU",70,0)
 Q 1
"RTN","PSBMLLKU",71,0)
 ;
"RTN","PSBMLLKU",72,0)
PTLKUP(RESULTS,PSBREC) ; Patient lookup handled separately for security
"RTN","PSBMLLKU",73,0)
 ;   input - PSBREC (array)  User entered patient lookup data
"RTN","PSBMLLKU",74,0)
 ;
"RTN","PSBMLLKU",75,0)
 ;   outpt - RESULTS (array)
"RTN","PSBMLLKU",76,0)
 ;          (Person(s) in PATIENT File (#2) meeting search criteria)
"RTN","PSBMLLKU",77,0)
 ;
"RTN","PSBMLLKU",78,0)
 ;
"RTN","PSBMLLKU",79,0)
 N PSBNRSWD,PSBINDX,PSBRPT
"RTN","PSBMLLKU",80,0)
 K RESULTS,PSBDATA
"RTN","PSBMLLKU",81,0)
 K PSBPT S PSBPT(0)=0
"RTN","PSBMLLKU",82,0)
 S PSBINDX="" K ^TMP("DILIST",$J)
"RTN","PSBMLLKU",83,0)
 I PSBCLINORD'="C" D
"RTN","PSBMLLKU",84,0)
 .S PSBDATA=$E(PSBREC(1),1,60)
"RTN","PSBMLLKU",85,0)
 .I PSBDATA?12N!(PSBDATA?1.6N)&(DUZ("AG")="I") D  Q  ; HRN/ASUFAC code
"RTN","PSBMLLKU",86,0)
 ..N X
"RTN","PSBMLLKU",87,0)
 ..S X=$$HRCNF^APSPFUNC($S($L(PSBDATA)=12:PSBDATA,1:$$PAD($$GET1^DIQ(9999999.06,+DUZ(2),.12))_$$PAD(PSBDATA)))
"RTN","PSBMLLKU",88,0)
 ..I X<0 D  Q
"RTN","PSBMLLKU",89,0)
 ...S RESULTS(0)=1,RESULTS(1)="-1^No patients matching '"_PSBDATA_"'."
"RTN","PSBMLLKU",90,0)
 ..S RESULTS(0)=1
"RTN","PSBMLLKU",91,0)
 ..S RESULTS(1)=$$PTREC(X)
"RTN","PSBMLLKU",92,0)
 .S PSBDATA1=PSBDATA
"RTN","PSBMLLKU",93,0)
 .I $E(PSBDATA,$L(PSBDATA)-10,60)=" [MAS WARD]" S PSBINDX="CN" S PSBDATA=$P(PSBDATA," [MAS WARD]")
"RTN","PSBMLLKU",94,0)
 .I $E(PSBDATA,$L(PSBDATA)-11,60)=" [NURS UNIT]" S PSBINDX="CN" S PSBDATA=$P(PSBDATA," [NURS UNIT]") D
"RTN","PSBMLLKU",95,0)
 ..K PSBPT S PSBPT(0)=0
"RTN","PSBMLLKU",96,0)
 ..S PSBZ=0 F  S PSBZ=$O(^NURSF(211.4,PSBZ)) Q:PSBZ'?.N  S PSBNRSWD=$$GET1^DIQ(211.4,PSBZ_",",.01) I $$UCASE^XUSG(PSBNRSWD)=PSBDATA S PSBY=PSBZ Q
"RTN","PSBMLLKU",97,0)
 ..K PSBDATA S PSBDATA=""
"RTN","PSBMLLKU",98,0)
 ..S PSBX=0 F  S PSBX=$O(^NURSF(211.4,PSBY,3,PSBX)) Q:PSBX=""  S PSBDATA(PSBX)=$$GET1^DIQ(42,$P(^NURSF(211.4,PSBY,3,PSBX,0),U)_",",.01)
"RTN","PSBMLLKU",99,0)
 ;
"RTN","PSBMLLKU",100,0)
 I PSBCLINORD="C" D
"RTN","PSBMLLKU",101,0)
 .;Clinic mode report - get and return array of all DFN's that belong
"RTN","PSBMLLKU",102,0)
 .;  to clinics passed in by user.
"RTN","PSBMLLKU",103,0)
 .F QQ=0:0 S QQ=$O(PSBREC(QQ)) Q:'QQ  D
"RTN","PSBMLLKU",104,0)
 ..S PSBRPT(2,QQ,0)=PSBREC(QQ)
"RTN","PSBMLLKU",105,0)
 ..S PSBRPT(2,"B",PSBREC(QQ),QQ)=""
"RTN","PSBMLLKU",106,0)
 .S PSBDATA=1 D CLIN^PSBO(.PSBRPT,.PSBDATA)
"RTN","PSBMLLKU",107,0)
 .I $D(PSBDATA)=11 D
"RTN","PSBMLLKU",108,0)
 ..N DFNXX S PSBCNT=0
"RTN","PSBMLLKU",109,0)
 ..F DFNXX=0:0 S DFNXX=$O(PSBDATA(DFNXX)) Q:'DFNXX  D
"RTN","PSBMLLKU",110,0)
 ...S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=$$PTREC(DFNXX)
"RTN","PSBMLLKU",111,0)
 .; check if any data found
"RTN","PSBMLLKU",112,0)
 .I '$D(RESULTS) D
"RTN","PSBMLLKU",113,0)
 ..S RESULTS(0)=1
"RTN","PSBMLLKU",114,0)
 ..S RESULTS(1)="-1^No patients matching Clinic Search List"
"RTN","PSBMLLKU",115,0)
 .E  D
"RTN","PSBMLLKU",116,0)
 ..S RESULTS(0)=+$O(RESULTS(""),-1)
"RTN","PSBMLLKU",117,0)
 ..S PSBINDX="CN"
"RTN","PSBMLLKU",118,0)
 I PSBCLINORD="C",+RESULTS(1)=-1 Q
"RTN","PSBMLLKU",119,0)
 ;
"RTN","PSBMLLKU",120,0)
 I PSBINDX="" S PSBINDX=$S(PSBDATA?9N.1P:"SSN",PSBDATA?4N.1P:"BS5^BS",1:PSBINDX)
"RTN","PSBMLLKU",121,0)
 I ($O(PSBDATA(""))'>0) D FIND^DIC(2,"","@;.01;.02;.03;.09","MP",PSBDATA,200,PSBINDX)
"RTN","PSBMLLKU",122,0)
 I ($O(PSBDATA(""))>0) D
"RTN","PSBMLLKU",123,0)
 .S PSBX="",PSBY=1 F  S PSBX=$O(PSBDATA(PSBX)) Q:PSBX=""  D  K ^TMP("DILIST",$J) Q:$P(PSBPT(0),U,3)=1
"RTN","PSBMLLKU",124,0)
 ..D FIND^DIC(2,"","@;.01;.02;.03;.09","MPO",PSBDATA(PSBX),200,PSBINDX)
"RTN","PSBMLLKU",125,0)
 ..S PSBZ=0 F  S PSBZ=$O(^TMP("DILIST",$J,PSBZ)) Q:PSBZ=""  S PSBPT(PSBY,0)=^TMP("DILIST",$J,PSBZ,0),PSBPT(0)=PSBY,PSBY=PSBY+1 I PSBY>200 S $P(PSBPT(0),U,3)=1
"RTN","PSBMLLKU",126,0)
 K:+$G(PSBPT(0))=0 PSBPT
"RTN","PSBMLLKU",127,0)
 I $D(PSBPT) M ^TMP("DILIST",$J)=PSBPT
"RTN","PSBMLLKU",128,0)
 I $P($G(^TMP("DILIST",$J,0)),U,3) D  Q
"RTN","PSBMLLKU",129,0)
 .S RESULTS(0)=1,RESULTS(1)="-1^Too many patients found matching '"_PSBDATA1_"'. Please be more specific."
"RTN","PSBMLLKU",130,0)
 I $D(^TMP("DILIST",$J,0)) D
"RTN","PSBMLLKU",131,0)
 .F PSBXX=0:0 S PSBXX=$O(^TMP("DILIST",$J,PSBXX)) Q:'PSBXX  D
"RTN","PSBMLLKU",132,0)
 ..S RESULTS(PSBXX)=$$PTREC(+^TMP("DILIST",$J,PSBXX,0))
"RTN","PSBMLLKU",133,0)
 I '$D(RESULTS) S RESULTS(0)=1,RESULTS(1)="-1^No patients matching '"_PSBDATA1_"'"
"RTN","PSBMLLKU",134,0)
 E  S RESULTS(0)=+$O(RESULTS(""),-1)
"RTN","PSBMLLKU",135,0)
 Q
"RTN","PSBMLLKU",136,0)
 ;
"RTN","PSBMLLKU",137,0)
PTREC(DFN) ;
"RTN","PSBMLLKU",138,0)
 ; Extrinsic to return a Pt Rec  in standard list format
"RTN","PSBMLLKU",139,0)
 N PSBXX
"RTN","PSBMLLKU",140,0)
 S PSBXX=$G(^DPT(DFN,0))
"RTN","PSBMLLKU",141,0)
 S PSBXX=DFN_U_$P(PSBXX,U,1)_U_$P(PSBXX,U,2)_U_$P(PSBXX,U,3)_U_$S(DUZ("AG")="I":$$HRCNF^BDGF2(DFN,DUZ(2)),1:$P(PSBXX,U,9))
"RTN","PSBMLLKU",142,0)
 S $P(PSBXX,U,6)=$$GET1^DIQ(2,DFN_",",.1)
"RTN","PSBMLLKU",143,0)
 S $P(PSBXX,U,7)=$$GET1^DIQ(2,DFN_",",.101)
"RTN","PSBMLLKU",144,0)
 S $P(PSBXX,U,10)=$$DOB^DPTLK1(DFN)
"RTN","PSBMLLKU",145,0)
 S $P(PSBXX,U,11)=$S(DUZ("AG")="I":$$HRN^AUPNPAT(DFN,DUZ(2)),1:$$SSN^DPTLK1(DFN))
"RTN","PSBMLLKU",146,0)
 Q PSBXX
"RTN","PSBMLLKU",147,0)
 ;
"RTN","PSBMLLKU",148,0)
SELECTAD(RESULTS,PSBREC) ; Select Administration
"RTN","PSBMLLKU",149,0)
 ;
"RTN","PSBMLLKU",150,0)
 ;  Process the SELECTed ADministration
"RTN","PSBMLLKU",151,0)
 ;   input - PSBREC(1) = PSB Med Log File (#53.79) IEN
"RTN","PSBMLLKU",152,0)
 ;
"RTN","PSBMLLKU",153,0)
 ;
"RTN","PSBMLLKU",154,0)
 ;   outpt - RESULTS (array)
"RTN","PSBMLLKU",155,0)
 ;          (Administration data that can be subsequently updated via GUI MED LOG EDIT)
"RTN","PSBMLLKU",156,0)
 ;
"RTN","PSBMLLKU",157,0)
 ;
"RTN","PSBMLLKU",158,0)
 K RESULTS,PSBXIV,PSBPTCHX
"RTN","PSBMLLKU",159,0)
 N PSBIEN,PSBCNT,PSBX S PSBIEN=PSBREC(1),PSBCNT=2
"RTN","PSBMLLKU",160,0)
 ; Construct form data    Patient^SSN^Med^BagID^AdminStat^AdminD/T^InjctSt^PRNReas^PRNEff^DisDrg^UntsGiven^Unt^
"RTN","PSBMLLKU",161,0)
 S RESULTS(0)=0
"RTN","PSBMLLKU",162,0)
 D:$$CHKKEY(PSBIEN)
"RTN","PSBMLLKU",163,0)
 .L +^PSB(53.79,PSBIEN):1
"RTN","PSBMLLKU",164,0)
 .E  I $P(^PSB(53.79,PSBIEN,0),U,9)]"" S PSBCNT=1,RESULTS(1)="-1^ This administration is being modified by another process at this moment." L -^PSB(53.79,PSBIEN) Q
"RTN","PSBMLLKU",165,0)
 .S $P(RESULTS(1),U)=PSBIEN
"RTN","PSBMLLKU",166,0)
 .S $P(RESULTS(1),U,2)=$$GET1^DIQ(53.79,PSBIEN_",",.01,"I")
"RTN","PSBMLLKU",167,0)
 .S $P(RESULTS(1),U,3)=$$GET1^DIQ(53.79,PSBIEN_",",.01)
"RTN","PSBMLLKU",168,0)
 .S $P(RESULTS(1),U,4)=$$GET1^DIQ(2,$P(RESULTS(1),U,2)_",",.09)
"RTN","PSBMLLKU",169,0)
 .S $P(RESULTS(1),U,5)=$$GET1^DIQ(53.79,PSBIEN_",",.08,"I")_"~"_$$GET1^DIQ(53.79,PSBIEN_",",.08)
"RTN","PSBMLLKU",170,0)
 .S $P(RESULTS(1),U,6)=$$GET1^DIQ(53.79,PSBIEN_",",.26)
"RTN","PSBMLLKU",171,0)
 .S $P(RESULTS(1),U,7)=$S($$GET1^DIQ(53.79,PSBIEN_",",.09,"I")']"":"U",1:$$GET1^DIQ(53.79,PSBIEN_",",.09,"I"))
"RTN","PSBMLLKU",172,0)
 .;
"RTN","PSBMLLKU",173,0)
 .D:($P(RESULTS(1),U,7)'="N")&($P(RESULTS(1),U,7)]"") SELSTTUS(.RESULTS)  ; Amend RESULTS(1) data...
"RTN","PSBMLLKU",174,0)
 .S Y=$E($$GET1^DIQ(53.79,PSBIEN_",",.06,"I"),1,12) D DD^%DT
"RTN","PSBMLLKU",175,0)
 .S $P(RESULTS(1),U,8)=Y
"RTN","PSBMLLKU",176,0)
 .S $P(RESULTS(1),U,9)=$$GET1^DIQ(53.79,PSBIEN_",",.06,"I")
"RTN","PSBMLLKU",177,0)
 .S $P(RESULTS(1),U,10)=$$GET1^DIQ(53.79,PSBIEN_",",.16)
"RTN","PSBMLLKU",178,0)
 .S $P(RESULTS(1),U,16)=0
"RTN","PSBMLLKU",179,0)
 .S $P(RESULTS(2),U)=$$GET1^DIQ(53.79,PSBIEN_",",.21),$P(RESULTS(2),U,2)=$$GET1^DIQ(53.79,PSBIEN_",",.22)
"RTN","PSBMLLKU",180,0)
 .; Determine if there are any active IVs/Patchs per order
"RTN","PSBMLLKU",181,0)
 .D:$G(PSBPTCHX)
"RTN","PSBMLLKU",182,0)
 ..S PSBX="",PSBX="^PSB(53.79,""APATCH"","_$P(RESULTS(1),U,2)_")"
"RTN","PSBMLLKU",183,0)
 ..F  S PSBX=$Q(@PSBX) Q:PSBX=""  Q:$QS(PSBX,3)'=$P(RESULTS(1),U,2)  D  Q:$P(RESULTS(1),U,16)
"RTN","PSBMLLKU",184,0)
 ...S PSBXX=$QS(PSBX,5),PSBXXX=$S(($P(^PSB(53.79,PSBXX,0),U,9)="G")&(PSBXX'=PSBIEN):1,1:0)
"RTN","PSBMLLKU",185,0)
 ...I PSBXXX&($P(^PSB(53.79,PSBXX,.1),U)=$P(RESULTS(1),U,15)) S $P(RESULTS(1),U,16)=1
"RTN","PSBMLLKU",186,0)
 .D:$G(PSBXIV)
"RTN","PSBMLLKU",187,0)
 ..S PSBX="",PSBX="^PSB(53.79,""AUID"","_$P(RESULTS(1),U,2)_")"
"RTN","PSBMLLKU",188,0)
 ..F  S PSBX=$Q(@PSBX) Q:PSBX=""  Q:$QS(PSBX,3)'=$P(RESULTS(1),U,2)  Q:$QS(PSBX,4)>$P(RESULTS(1),U,15)  D  Q:$P(RESULTS(1),U,16)
"RTN","PSBMLLKU",189,0)
 ...Q:$QS(PSBX,4)'=$P(RESULTS(1),U,15)
"RTN","PSBMLLKU",190,0)
 ...S PSBXX=$QS(PSBX,6) S:(PSBXX'=PSBIEN) $P(RESULTS(1),U,16)=$S($P(^PSB(53.79,PSBXX,0),U,9)="I":1,$P(^PSB(53.79,PSBXX,0),U,9)="S":1,1:0)
"RTN","PSBMLLKU",191,0)
 .;
"RTN","PSBMLLKU",192,0)
 .; LOOP - Place DD in RESULTS
"RTN","PSBMLLKU",193,0)
 .S PSBX=0 F  S PSBX=$O(^PSB(53.79,PSBIEN,.5,PSBX)) Q:'(+PSBX)  D
"RTN","PSBMLLKU",194,0)
 ..S PSBCNT=PSBCNT+1
"RTN","PSBMLLKU",195,0)
 ..S RESULTS(PSBCNT)="DD^"_$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U)_"^"_$$GET1^DIQ(50,$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U)_",",.01)
"RTN","PSBMLLKU",196,0)
 ..S $P(RESULTS(PSBCNT),U,4)=$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U,2)_"^"_$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U,3)_"^"_$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U,4)
"RTN","PSBMLLKU",197,0)
 ..S:$P(RESULTS(PSBCNT),U,4)?1"."1.N $P(RESULTS(PSBCNT),U,4)=0_+$P(RESULTS(PSBCNT),U,4)
"RTN","PSBMLLKU",198,0)
 ..S:$P(RESULTS(PSBCNT),U,5)?1"."1.N $P(RESULTS(PSBCNT),U,5)=0_+$P(RESULTS(PSBCNT),U,5)
"RTN","PSBMLLKU",199,0)
 .; LOOP - Place ADD in RESULTS
"RTN","PSBMLLKU",200,0)
 .S PSBX=0 F  S PSBX=$O(^PSB(53.79,PSBIEN,.6,PSBX)) Q:'(+PSBX)  D
"RTN","PSBMLLKU",201,0)
 ..S PSBCNT=PSBCNT+1
"RTN","PSBMLLKU",202,0)
 ..S RESULTS(PSBCNT)="ADD^"_$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U)_"^"_$$GET1^DIQ(52.6,$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U)_",",.01)
"RTN","PSBMLLKU",203,0)
 ..S $P(RESULTS(PSBCNT),U,4)=$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U,2)_"^"_$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U,3)_"^"_$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U,4)
"RTN","PSBMLLKU",204,0)
 .; LOOP - Place SOL in RESULTS
"RTN","PSBMLLKU",205,0)
 .S PSBX=0 F  S PSBX=$O(^PSB(53.79,PSBIEN,.7,PSBX)) Q:'(+PSBX)  D
"RTN","PSBMLLKU",206,0)
 ..S PSBCNT=PSBCNT+1
"RTN","PSBMLLKU",207,0)
 ..S RESULTS(PSBCNT)="SOL^"_$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U)_"^"_$$GET1^DIQ(52.7,$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U)_",",.01)
"RTN","PSBMLLKU",208,0)
 ..S $P(RESULTS(PSBCNT),U,4)=$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U,2)_"^"_$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U,3)_"^"_$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U,4)
"RTN","PSBMLLKU",209,0)
 .L -^PSB(53.79,PSBIEN)
"RTN","PSBMLLKU",210,0)
 S:PSBCNT>0 RESULTS(0)=PSBCNT
"RTN","PSBMLLKU",211,0)
 Q
"RTN","PSBMLLKU",212,0)
 ;
"RTN","PSBMLLKU",213,0)
SELSTTUS(RESULTS) ;
"RTN","PSBMLLKU",214,0)
 ; Provide the SELectable STaTUS
"RTN","PSBMLLKU",215,0)
 ;
"RTN","PSBMLLKU",216,0)
 ; Get TAB, ScheduleType, Current Status, provide Selectable Staus(s) in ^8
"RTN","PSBMLLKU",217,0)
 N PSBORTYP,PSBIVTYP,PSBINTSY,PSBCHMTY,PSBIVPSH,PSBXTAB
"RTN","PSBMLLKU",218,0)
 K ^TMP("PSJ1",$J) D EN^PSJBCMA1($$GET1^DIQ(53.79,PSBIEN_",",.01,"I"),$$GET1^DIQ(53.79,PSBIEN_",",.11),1)
"RTN","PSBMLLKU",219,0)
 I ^TMP("PSJ1",$J,0)>0 D
"RTN","PSBMLLKU",220,0)
 .S PSBORTYP=$TR($P(^TMP("PSJ1",$J,0),U,3),"1234567890"),PSBIVTYP=$P(^TMP("PSJ1",$J,0),U,6)
"RTN","PSBMLLKU",221,0)
 .S PSBINTSY=$P(^TMP("PSJ1",$J,0),U,7),PSBCHMTY=$P(^TMP("PSJ1",$J,0),U,8),PSBIVPSH=+$P($G(^TMP("PSJ1",$J,1,0)),U,2)
"RTN","PSBMLLKU",222,0)
 .S:$$IVPTAB^PSBVDLU3(PSBORTYP,PSBIVTYP,PSBINTSY,PSBCHMTY,PSBIVPSH) PSBXTAB="PB"
"RTN","PSBMLLKU",223,0)
 .D:'$D(PSBXTAB)
"RTN","PSBMLLKU",224,0)
 ..I PSBORTYP="U" S PSBXTAB="UD"
"RTN","PSBMLLKU",225,0)
 ..I PSBORTYP="V" S PSBXTAB="IV"
"RTN","PSBMLLKU",226,0)
 ; Set Results(1) and other flags...
"RTN","PSBMLLKU",227,0)
 I ^TMP("PSJ1",$J,0)>0 D
"RTN","PSBMLLKU",228,0)
 .S $P(RESULTS(1),U,13)=$P(^TMP("PSJ1",$J,4),U)
"RTN","PSBMLLKU",229,0)
 .S $P(RESULTS(1),U,14)=$P(^TMP("PSJ1",$J,1),U,10)
"RTN","PSBMLLKU",230,0)
 .S $P(RESULTS(1),U,15)=$P(^TMP("PSJ1",$J,0),U,3)
"RTN","PSBMLLKU",231,0)
 .I (PSBXTAB="UD"),($P(^TMP("PSJ1",$J,2),U,6)="PATCH") S PSBPTCHX=1
"RTN","PSBMLLKU",232,0)
 .I PSBXTAB="IV" S PSBXIV=1
"RTN","PSBMLLKU",233,0)
 .S:$G(PSBXTAB)]"" $P(RESULTS(1),U,11)=$G(PSBXTAB)
"RTN","PSBMLLKU",234,0)
 K ^TMP("PSJ1",$J)
"RTN","PSBMLLKU",235,0)
 Q
"RTN","PSBMLLKU",236,0)
 ;
"RTN","PSBMLLKU",237,0)
KILLAADT ;
"RTN","PSBMLLKU",238,0)
 ;   Here because there is an errorant index entry via version 1.0/2.0
"RTN","PSBMLLKU",239,0)
 ;   Cleansing!
"RTN","PSBMLLKU",240,0)
 ;
"RTN","PSBMLLKU",241,0)
 K ^PSB(53.79,"AADT",DFN,PSBSRCH,PSBIEN)
"RTN","PSBMLLKU",242,0)
 Q
"RTN","PSBMLLKU",243,0)
 ;
"RTN","PSBMLLKU",244,0)
PAD(VAL) ; Return VAL with leading zeroes padded to 6 characters
"RTN","PSBMLLKU",245,0)
 Q $E("000000",1,6-$L(VAL))_VAL
"RTN","PSBO")
0^2^B150383689^B87103799
"RTN","PSBO",1,0)
PSBO ;BIRMINGHAM/EFC - BCMA OUTPUTS ;4/25/13 1:13pm
"RTN","PSBO",2,0)
 ;;3.0;BAR CODE MED ADMIN;**13,32,2,25,28,51,50,42,58,68,70**;Mar 2004;Build 101
"RTN","PSBO",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBO",4,0)
 ;
"RTN","PSBO",5,0)
 ; Reference/IA
"RTN","PSBO",6,0)
 ; EN^PSJBCMA/2828
"RTN","PSBO",7,0)
 ; ^ORD(101.24/3429
"RTN","PSBO",8,0)
 ; ^PSDRUG(/221
"RTN","PSBO",9,0)
 ;
"RTN","PSBO",10,0)
 ;*68-Add PSBSIFL as 19th parameter to RPC tag to control printing of
"RTN","PSBO",11,0)
 ;       special instruction/other print info.
"RTN","PSBO",12,0)
 ;*58 - Tag WRAP previously wrapped on a max text limit of 250 char.
"RTN","PSBO",13,0)
 ;       Since the use of Enhanced Order Checks, that limit has to 
"RTN","PSBO",14,0)
 ;       be removed and the length of the input string will be used.
"RTN","PSBO",15,0)
 ;*70 - Add PSBCLINORD as 20th parameter to RPC tag to control the 
"RTN","PSBO",16,0)
 ;       type of order to appear on reports that want to be able to
"RTN","PSBO",17,0)
 ;       show Clinic Orders or IM orders.  Set C=CO I=IM
"RTN","PSBO",18,0)
 ;       CCR #1459: Adding clinic to BL and BZ chui labels.
"RTN","PSBO",19,0)
 ;
"RTN","PSBO",20,0)
RPC(RESULTS,PSBTYPE,PSBDFN,PSBSTRT,PSBSTOP,PSBINCL,PSBDEV,PSBSORT,PSBOI,PSBWLOC,PSBWSORT,PSBFUTR,PSBORDNM,PSBRCRI,PSBLIST,PSBPST,PSBTR,PSBDIV,PSBSIFL,PSBCLINORD,PSB21,PSB22,PSB23,PSB24,PSB25,PSBCLLST) ;
"RTN","PSBO",21,0)
 ;
"RTN","PSBO",22,0)
 ; RPC: PSB REPORT
"RTN","PSBO",23,0)
 ;
"RTN","PSBO",24,0)
 ; Description:
"RTN","PSBO",25,0)
 ; Used by the client to create individual patient extracts of
"RTN","PSBO",26,0)
 ; CHUI report options to display on the client.
"RTN","PSBO",27,0)
 ;
"RTN","PSBO",28,0)
 ;
"RTN","PSBO",29,0)
 S RESULTS=$NAME(^TMP("PSBO",$J))
"RTN","PSBO",30,0)
 N PSBIENS,PSBRPT,PSBFDA,DIC,PSBANS
"RTN","PSBO",31,0)
 N PSBMODE                                                       ;*70
"RTN","PSBO",32,0)
 K ^TMP("PSBO",$J) S ^TMP("PSBO",$J,1)="-1^"
"RTN","PSBO",33,0)
 S DFN=PSBDFN
"RTN","PSBO",34,0)
 D NEW^PSBO1(.PSBRPT,PSBTYPE)
"RTN","PSBO",35,0)
 I PSBDFN'="",PSBTYPE="MH"!(PSBTYPE="WA")!(PSBTYPE="ML")!(PSBTYPE="MT") D PAINCMT^PSBCSUTL(PSBDFN) ;;Add Comment if Pain Score entered in BCMA was marked "Entered in Error" in Vitals.
"RTN","PSBO",36,0)
 I +PSBRPT(0)<1 S ^TMP("PSBO",$J,1)="-1^Error: "_$P(PSBRPT(0),U,2) Q
"RTN","PSBO",37,0)
 S PSBIENS=+PSBRPT(0)_","
"RTN","PSBO",38,0)
 S PSBSTRT(0)=$E($P(PSBSTRT,".",2)_"0000",1,4),PSBSTRT=PSBSTRT\1
"RTN","PSBO",39,0)
 S PSBSTOP(0)=$E($P(PSBSTOP,".",2)_"0000",1,4),PSBSTOP=PSBSTOP\1
"RTN","PSBO",40,0)
 D:$G(PSBDEV)]""
"RTN","PSBO",41,0)
 .D NOW^%DTC
"RTN","PSBO",42,0)
 .I $P(PSBDEV,U,2)="" D VAL^DIE(53.69,PSBIENS,.06,"F",PSBDEV,"PSBRET","PSBFDA")
"RTN","PSBO",43,0)
 .I $P(PSBDEV,U,2)'="" D VAL^DIE(53.69,PSBIENS,.06,"F","`"_$P(PSBDEV,U,2),"PSBRET","PSBFDA")
"RTN","PSBO",44,0)
 .D VAL^DIE(53.69,PSBIENS,.07,"F",$S($P(PSBRCRI,U)="QD":$P(PSBRCRI,U,2),1:%),"PSBRET","PSBFDA")
"RTN","PSBO",45,0)
 D:$G(PSBOI)]"" VAL^DIE(53.69,PSBIENS,.09,"F",PSBOI,"PSBRET","PSBFDA")
"RTN","PSBO",46,0)
 S:($G(PSBSORT)']"")&(PSBTYPE'="XA") PSBSORT="P" D VAL^DIE(53.69,PSBIENS,.11,"F",PSBSORT,"PSBRET","PSBFDA")
"RTN","PSBO",47,0)
 I "^SF"[("^"_PSBTYPE) D VAL^DIE(53.69,PSBIENS,.51,"F",PSBSORT,"PSBRET","PSBFDA")
"RTN","PSBO",48,0)
 S PSBPST=$TR($G(PSBPST),"^",",")
"RTN","PSBO",49,0)
 D VAL^DIE(53.69,PSBIENS,.52,"F",PSBPST,"PSBRET","PSBFDA")
"RTN","PSBO",50,0)
 S PSBTR=$TR($G(PSBTR),"^",",")
"RTN","PSBO",51,0)
 I $G(PSBDIV)]"" D VAL^DIE(53.69,PSBIENS,.04,"F",$G(PSBDIV),"PSBRET","PSBFDA")
"RTN","PSBO",52,0)
 D VAL^DIE(53.69,PSBIENS,2,"F",PSBTR,"PSBRET","PSBFDA")
"RTN","PSBO",53,0)
 D VAL^DIE(53.69,PSBIENS,.12,"F","`"_PSBDFN,"PSBRET","PSBFDA")
"RTN","PSBO",54,0)
 I $G(PSBWLOC)]"" S PSBFDA(53.69,PSBIENS,.13)=PSBWLOC
"RTN","PSBO",55,0)
 D:$G(PSBWSORT)]"" VAL^DIE(53.69,PSBIENS,.15,"F",PSBWSORT,"PSBRET","PSBFDA")
"RTN","PSBO",56,0)
 D VAL^DIE(53.69,PSBIENS,.16,"F",PSBSTRT,"PSBRET","PSBFDA")
"RTN","PSBO",57,0)
 D VAL^DIE(53.69,PSBIENS,.17,"F",PSBSTRT(0),"PSBRET","PSBFDA")
"RTN","PSBO",58,0)
 D VAL^DIE(53.69,PSBIENS,.18,"F",PSBSTOP,"PSBRET","PSBFDA")
"RTN","PSBO",59,0)
 D VAL^DIE(53.69,PSBIENS,.19,"F",PSBSTOP(0),"PSBRET","PSBFDA")
"RTN","PSBO",60,0)
 D:$G(PSBINCL)]""
"RTN","PSBO",61,0)
 .D VAL^DIE(53.69,PSBIENS,.21,"F",+$P(PSBINCL,"^",1),"PSBRET","PSBFDA")
"RTN","PSBO",62,0)
 .D VAL^DIE(53.69,PSBIENS,.22,"F",+$P(PSBINCL,"^",2),"PSBRET","PSBFDA")
"RTN","PSBO",63,0)
 .D VAL^DIE(53.69,PSBIENS,.23,"F",+$P(PSBINCL,"^",3),"PSBRET","PSBFDA")
"RTN","PSBO",64,0)
 .D VAL^DIE(53.69,PSBIENS,.24,"F",+$P(PSBINCL,"^",4),"PSBRET","PSBFDA")
"RTN","PSBO",65,0)
 .D VAL^DIE(53.69,PSBIENS,.28,"F",+$P(PSBINCL,"^",5),"PSBRET","PSBFDA")
"RTN","PSBO",66,0)
 .D VAL^DIE(53.69,PSBIENS,.29,"F",+$P(PSBINCL,"^",6),"PSBRET","PSBFDA")
"RTN","PSBO",67,0)
 D:$G(PSBFUTR)]""
"RTN","PSBO",68,0)
 .D VAL^DIE(53.69,PSBIENS,.25,"F",+$P(PSBFUTR,"^",1),"PSBRET","PSBFDA")
"RTN","PSBO",69,0)
 .D VAL^DIE(53.69,PSBIENS,.26,"F",+$P(PSBFUTR,"^",2),"PSBRET","PSBFDA")
"RTN","PSBO",70,0)
 .D VAL^DIE(53.69,PSBIENS,.27,"F",+$P(PSBFUTR,"^",3),"PSBRET","PSBFDA")
"RTN","PSBO",71,0)
 .D VAL^DIE(53.69,PSBIENS,.41,"F",+$P(PSBFUTR,"^",4),"PSBRET","PSBFDA")
"RTN","PSBO",72,0)
 .D VAL^DIE(53.69,PSBIENS,.61,"F",$TR(PSBFUTR,"^ ","~"),"PSBRET","PSBFDA")
"RTN","PSBO",73,0)
 ;*68 add SIOPI flag when present
"RTN","PSBO",74,0)
 D:$D(PSBSIFL)
"RTN","PSBO",75,0)
 .D VAL^DIE(53.69,PSBIENS,3,"F",PSBSIFL,"PSBRET","PSBFDA")
"RTN","PSBO",76,0)
 ;*70 add PSBCLINORD indicator when present
"RTN","PSBO",77,0)
 D:$D(PSBCLINORD)
"RTN","PSBO",78,0)
 .D VAL^DIE(53.69,PSBIENS,4,"F",PSBCLINORD,"PSBRET","PSBFDA")
"RTN","PSBO",79,0)
 D FILE^DIE("","PSBFDA")
"RTN","PSBO",80,0)
 I "^SF"'[("^"_PSBTYPE) I $G(PSBLIST(0),"")]"" D LIST^PSBO1(.PSBLIST)
"RTN","PSBO",81,0)
 I "^SF"'[("^"_PSBTYPE) I $G(PSBCLLST(0),"")]"" D LIST^PSBO1(.PSBCLLST)
"RTN","PSBO",82,0)
 I $G(PSBDEV)]"" D PRINT^PSBO1 S RESULTS=$NAME(^TMP("PSBO",$J)) Q
"RTN","PSBO",83,0)
 D HFSOPEN^PSBUTL("RPC") I POP S ^TMP("PSBO",$J,1)="ERROR: UNABLE TO ACCESS HFS DIRECTORY "_$$DEFDIR^%ZISH(),^TMP("PSBO",$J,2)="PLEASE CHECK DIRECTORY WRITE PRIVILEGES." Q
"RTN","PSBO",84,0)
 U IO D DQ(+PSBIENS)
"RTN","PSBO",85,0)
 D HFSCLOSE^PSBUTL("RPC")
"RTN","PSBO",86,0)
 S RESULTS=$NAME(^TMP("PSBO",$J))
"RTN","PSBO",87,0)
 D:$G(PSBDEV)]"" PRINT^PSBO1
"RTN","PSBO",88,0)
 Q
"RTN","PSBO",89,0)
 ;
"RTN","PSBO",90,0)
XQ(PSBTYPE) ; Called via Kernel Menus
"RTN","PSBO",91,0)
 N PSBANS,PSBANS1,PSBRPT,PSBSAVE,DA,DIK,DR,DDSFILE,PSBCNT
"RTN","PSBO",92,0)
 D NEW^PSBO1(.PSBRPT,PSBTYPE)
"RTN","PSBO",93,0)
 I +PSBRPT(0)<1 W !,"Error: ",$P(PSBRPT(0),U,2) S DIR(0)="E" D ^DIR Q
"RTN","PSBO",94,0)
 S DA=+PSBRPT(0),DR="[PSBO "_PSBTYPE_"]",DDSFILE=53.69 D ^DDS
"RTN","PSBO",95,0)
 W @IOF
"RTN","PSBO",96,0)
 I 'PSBSAVE W !,"Cancelling Request..." S DIK="^PSB(53.69," D ^DIK W "Cancelled!"
"RTN","PSBO",97,0)
 D:PSBSAVE
"RTN","PSBO",98,0)
 .;Check Drug to Patient Relationship.
"RTN","PSBO",99,0)
 .I (PSBTYPE="BL")!(PSBTYPE="BZ") S PSBANS="" D CHECK^PSBO1  I PSBANS=0!($D(DIRUT)) W !,"Cancelling Request..." S DIK="^PSB(53.69," D ^DIK W "Cancelled!" Q
"RTN","PSBO",100,0)
 .;
"RTN","PSBO",101,0)
 .;*70  (CCR #1459 begin)
"RTN","PSBO",102,0)
 .I $O(PSBCL(""))]"" D
"RTN","PSBO",103,0)
 ..N PSBI
"RTN","PSBO",104,0)
 ..S PSBCL="" F PSBI=0:1 S PSBCL=$O(PSBCL(PSBCL)) Q:PSBCL=""
"RTN","PSBO",105,0)
 ..I PSBI=1 D  Q
"RTN","PSBO",106,0)
 ...S PSBCL=$O(PSBCL(PSBCL)),$P(^PSB(53.69,DA,4),U,3)=$O(^SC("B",PSBCL,""))
"RTN","PSBO",107,0)
 ..;
"RTN","PSBO",108,0)
 ..K DIR,Y
"RTN","PSBO",109,0)
 ..;
"RTN","PSBO",110,0)
 ..S PSBCL="" F PSBCNT=3:1 S PSBCL=$O(PSBCL(PSBCL)) Q:PSBCL=""  D
"RTN","PSBO",111,0)
 ...S DIR("A",PSBCNT)=(PSBCNT-2)_". "_PSBCL,PSBCL(PSBCL)=(PSBCNT-2)
"RTN","PSBO",112,0)
 ..;
"RTN","PSBO",113,0)
 ..S DIR(0)="NAO^1:"_(PSBCNT-3)   ;,DIR("B")=(PSBCNT-3)
"RTN","PSBO",114,0)
 ..S DIR("A",1)="Select the appropriate clinic:"
"RTN","PSBO",115,0)
 ..S DIR("A",2)=""
"RTN","PSBO",116,0)
 ..S DIR("A",(PSBCNT+1))=""
"RTN","PSBO",117,0)
 ..S DIR("A")="Enter a number 1 thru "_(PSBCNT-3)_": "
"RTN","PSBO",118,0)
 ..S DIR("?")="Select a number from 1 - "_(PSBCNT-3)_" or <Return> to exit"
"RTN","PSBO",119,0)
 ..;
"RTN","PSBO",120,0)
 ..D ^DIR
"RTN","PSBO",121,0)
 ..I Y=""!(Y=-1)!(Y=U) S PSBANS=0 Q
"RTN","PSBO",122,0)
 ..S PSBCL="" F  S PSBCL=$O(PSBCL(PSBCL)) Q:PSBCL=""  D
"RTN","PSBO",123,0)
 ...I PSBCL[" (Ward)" Q
"RTN","PSBO",124,0)
 ...I Y=PSBCL(PSBCL) S $P(^PSB(53.69,DA,4),U,3)=$O(^SC("B",PSBCL,""))
"RTN","PSBO",125,0)
 .K PSBCL
"RTN","PSBO",126,0)
 .I $G(PSBANS)=0 D  Q
"RTN","PSBO",127,0)
 ..W !,"Cancelling Request..." S DIK="^PSB(53.69," D ^DIK W "Cancelled!"
"RTN","PSBO",128,0)
 .;*70 (CCR #-1459 end)
"RTN","PSBO",129,0)
 .;
"RTN","PSBO",130,0)
 .;Allow "'BROWSER" Device
"RTN","PSBO",131,0)
 .S IOP=$$GET1^DIQ(53.69,DA_",",.06,"I"),PSBSIO=0 I IOP]"" D
"RTN","PSBO",132,0)
 ..S IOP="`"_IOP,%ZIS="N"
"RTN","PSBO",133,0)
 ..D ^%ZIS
"RTN","PSBO",134,0)
 ..I IO=IO(0) S PSBSIO=1
"RTN","PSBO",135,0)
 ..D HOME^%ZIS K IOP
"RTN","PSBO",136,0)
 .I $$GET1^DIQ(53.69,DA_",",.06)["BROWSER"!(PSBSIO=1) S IOP=$$GET1^DIQ(53.69,DA_",",.06)_";132" D ^%ZIS U IO D DQ(DA) D ^%ZISC K IOP Q
"RTN","PSBO",137,0)
 .;
"RTN","PSBO",138,0)
 .W @IOF,"Submitting Your Report Request to TaskMan..."
"RTN","PSBO",139,0)
 .S ZTIO=$$GET1^DIQ(53.69,DA_",",.06)
"RTN","PSBO",140,0)
 .S ZTDTH=$P(^PSB(53.69,DA,0),U,7)
"RTN","PSBO",141,0)
 .S ZTDESC="BCMA - "_$$GET1^DIQ(53.69,DA_",",.05)
"RTN","PSBO",142,0)
 .S ZTRTN="DQ^PSBO("_DA_")"
"RTN","PSBO",143,0)
 .D ^%ZTLOAD
"RTN","PSBO",144,0)
 .W "Submitted!",!,"Your Task Number Is: ",$G(ZTSK),!
"RTN","PSBO",145,0)
 K ^TMP("PSBO",$J)
"RTN","PSBO",146,0)
 Q
"RTN","PSBO",147,0)
 ;
"RTN","PSBO",148,0)
DQ(PSBRPT) ; Dequeue report from Taskman
"RTN","PSBO",149,0)
 N PSBDFN
"RTN","PSBO",150,0)
 Q:'$D(^PSB(53.69,PSBRPT,0))  ; No Such Report
"RTN","PSBO",151,0)
 S $P(^PSB(53.69,PSBRPT,0),U,8)=$G(ZTSK,"RPC")
"RTN","PSBO",152,0)
 D SETUP,@("EN^PSBO"_$P(PSBRPT(0),U,5))
"RTN","PSBO",153,0)
 K ^TMP("PSBO",$J),PSBSIFLG
"RTN","PSBO",154,0)
 S ZTREQ="@"
"RTN","PSBO",155,0)
 Q
"RTN","PSBO",156,0)
 ;
"RTN","PSBO",157,0)
IOM() ; Returns good margin or not
"RTN","PSBO",158,0)
 Q:IOM'<132 1
"RTN","PSBO",159,0)
 W !,"**************************************************************"
"RTN","PSBO",160,0)
 W !,"* SORRY, Your selected DEVICE does not print 132 columns.    *"
"RTN","PSBO",161,0)
 W !,"**************************************************************"
"RTN","PSBO",162,0)
 W !
"RTN","PSBO",163,0)
 Q 0
"RTN","PSBO",164,0)
 ;
"RTN","PSBO",165,0)
VAL(PSBFLDS) ; Validate that fields in PSBFLDS are filled in
"RTN","PSBO",166,0)
 N PSB,PSBFLD,PSBMSG,PSBSTOP,PSBST,PSBDAYS S PSBSTRT=""
"RTN","PSBO",167,0)
 F PSB=1:1 Q:$P(PSBFLDS,";",PSB)=""  S PSBFLD=$P(PSBFLDS,";",PSB),PSBFLD(PSBFLD)=$$GET^DDSVAL(53.69,DA,PSBFLD)
"RTN","PSBO",168,0)
 I $D(PSBFLD(.11)) K:$E(PSBFLD(.11))="P" PSBFLD(.13),PSBFLD(.15) K:$E(PSBFLD(.11))="W" PSBFLD(.12)
"RTN","PSBO",169,0)
 S PSB=""  F  S PSB=$O(PSBFLD(PSB)) Q:PSB=""  D:PSBFLD(PSB)=""
"RTN","PSBO",170,0)
 .I '$D(PSBMSG) S PSBMSG(0)="UNABLE TO FILE REQUEST",PSBMSG(1)=" ",PSBMSG(2)="ERROR: MISSING DATA - ALL FIELDS ARE REQUIRED",PSBMSG(3)=" "
"RTN","PSBO",171,0)
 .D FIELD^DID(53.69,PSB,"","TITLE;LABEL","PSB")
"RTN","PSBO",172,0)
 .S Z="  Missing Field: "_$S(PSB("TITLE")]"":PSB("TITLE"),1:PSB("LABEL"))
"RTN","PSBO",173,0)
 .S PSBMSG($O(PSBMSG(""),-1)+1)=Z
"RTN","PSBO",174,0)
 ; Check Times
"RTN","PSBO",175,0)
 D:$G(PSBFLD(.16))
"RTN","PSBO",176,0)
 .S PSBSTRT=PSBFLD(.16)+$G(PSBFLD(.17))
"RTN","PSBO",177,0)
 .D:$P($$GET1^DIQ(53.69,DA_",",.01),U)["MH"
"RTN","PSBO",178,0)
 ..S PSBDAYS=$$GET1^DIQ(101.24,$$FIND1^DIC(101.24,"","X","ORRP BCMA MAH","B")_",",.42)  ;check maxdays
"RTN","PSBO",179,0)
 ..S:PSBDAYS="" PSBDAYS=7
"RTN","PSBO",180,0)
 ..S X=PSBSTRT\1 D H^%DTC S PSBST=%H+PSBDAYS    ;Determine stop date
"RTN","PSBO",181,0)
 .S PSBSTOP=$S($G(PSBFLD(.18)):PSBFLD(.18),1:PSBFLD(.16))+$G(PSBFLD(.19))
"RTN","PSBO",182,0)
 .I PSBSTOP<PSBSTRT S Y=$O(PSBMSG(""),-1)+1,PSBMSG(Y)="  Date: Stop Date/Time is before Start Date/Time"
"RTN","PSBO",183,0)
 .I $P($$GET1^DIQ(53.69,DA_",",.01),U)["MH" S X=PSBSTOP\1 D H^%DTC I %H>PSBST S Y=$O(PSBMSG(""),-1)+1,PSBMSG(Y)="  The date range cannot exceed "_PSBDAYS_" day(s) as defined in the CPRS 'MAXIMUM DAYS BACK' parameter"
"RTN","PSBO",184,0)
 Q:'$D(PSBMSG)  ; All is well
"RTN","PSBO",185,0)
 D MSG^DDSUTL(.PSBMSG)
"RTN","PSBO",186,0)
 S DDSERROR=1
"RTN","PSBO",187,0)
 Q
"RTN","PSBO",188,0)
 ;
"RTN","PSBO",189,0)
SETUP ; Setup parameters for the report in PSBRPT
"RTN","PSBO",190,0)
 N PSBWRDL,PSBINDX,PSBWRDA,QQ,PSBSORT,RECS
"RTN","PSBO",191,0)
 S RECS=0          ;init RECS found to 0       *70
"RTN","PSBO",192,0)
 K ^TMP("PSBO",$J)
"RTN","PSBO",193,0)
 F X=0,.1,.2,.3,.4,.5,1 S PSBRPT(X)=$G(^PSB(53.69,PSBRPT,X))
"RTN","PSBO",194,0)
 I $D(^PSB(53.69,PSBRPT,2)) M PSBRPT(2)=^PSB(53.69,PSBRPT,2)
"RTN","PSBO",195,0)
 I $D(^PSB(53.69,PSBRPT,3)) M PSBRPT(3)=^PSB(53.69,PSBRPT,3)
"RTN","PSBO",196,0)
 I $D(^PSB(53.69,PSBRPT,4)) M PSBRPT(4)=^PSB(53.69,PSBRPT,4)      ;*68
"RTN","PSBO",197,0)
 I $G(PSBRPT(4))="" S PSBRPT(4)="^I^"          ;if null def to I   *70
"RTN","PSBO",198,0)
 S PSBRPT(.52)=$P($G(^PSB(53.69,PSBRPT,.5)),U,2)
"RTN","PSBO",199,0)
 S PSBSIFLG=$P($G(PSBRPT(4)),U)                                   ;*68
"RTN","PSBO",200,0)
 S PSBCLINORD=$S($P($G(PSBRPT(4)),U,2)="C":1,1:0)
"RTN","PSBO",201,0)
 I $P(PSBRPT(0),"-")="ST",PSBRPT(3)]"" Q   ;Running a MSF report PSB*3*28
"RTN","PSBO",202,0)
 I $P(PSBRPT(0),"-")="SF",PSBRPT(.52)]"" Q   ;Running a MSF report PSB*3*28
"RTN","PSBO",203,0)
 ;
"RTN","PSBO",204,0)
 S PSBSORT=$P(PSBRPT(.1),U,1)               ;init PSBSORT         ;*70
"RTN","PSBO",205,0)
 ;
"RTN","PSBO",206,0)
 ;* * Patient Mode * *
"RTN","PSBO",207,0)
 I PSBSORT="P" D  I 'PSBDFN Q RECS
"RTN","PSBO",208,0)
 .S PSBDFN=+$P(PSBRPT(.1),U,2) Q:'PSBDFN
"RTN","PSBO",209,0)
 .N VA,VADM S DFN=PSBDFN D DEM^VADPT
"RTN","PSBO",210,0)
 .Q:(VADM(1)="")!(VA("PID")="")
"RTN","PSBO",211,0)
 .S ^TMP("PSBO",$J,PSBDFN,0)=VADM(1)_U_VA("PID"),^TMP("PSBO",$J,"B",VADM(1),PSBDFN)=""
"RTN","PSBO",212,0)
 .S RECS=1
"RTN","PSBO",213,0)
 ;
"RTN","PSBO",214,0)
 ;* * WARDs per Nurse file group & All patient DFN's * *          ;*70
"RTN","PSBO",215,0)
 I PSBSORT="W" D
"RTN","PSBO",216,0)
 .S PSBWRD=$P(PSBRPT(.1),U,3) Q:'PSBWRD
"RTN","PSBO",217,0)
 .D WARD^NURSUT5("L^"_PSBWRD,.PSBWRDA)
"RTN","PSBO",218,0)
 .Q:$O(PSBWRDA(""))=""
"RTN","PSBO",219,0)
 .S QQ="" F  S QQ=$O(PSBWRDA(PSBWRD,2,QQ)) Q:QQ=""  S PSBWRDL=$P(PSBWRDA(PSBWRD,2,QQ,.01),U,2) D
"RTN","PSBO",220,0)
 ..F PSBDFN=0:0 S PSBDFN=$O(^DPT("CN",PSBWRDL,PSBDFN)) Q:'PSBDFN  D
"RTN","PSBO",221,0)
 ...S DFN=PSBDFN D DEM^VADPT
"RTN","PSBO",222,0)
 ...Q:(VADM(1)="")!(VA("PID")="")
"RTN","PSBO",223,0)
 ...S ^TMP("PSBO",$J,PSBDFN,0)=VADM(1)_U_VA("PID")
"RTN","PSBO",224,0)
 ...; Determine Sort or default to Pt Name...
"RTN","PSBO",225,0)
 ...S:$P(PSBRPT(.1),U,5)="P" PSBINDX=VADM(1)
"RTN","PSBO",226,0)
 ...I $P(PSBRPT(.1),U,5)="B" S PSBINDX=$P($G(^DPT(PSBDFN,.101)),U) S:PSBINDX="" PSBINDX="** NO ROOM BED **"
"RTN","PSBO",227,0)
 ...S:$P(PSBRPT(.1),U,5)="" PSBINDX=VADM(1)
"RTN","PSBO",228,0)
 ...S:$G(PSBINDX)="" PSBINDX=VADM(1)
"RTN","PSBO",229,0)
 ...S ^TMP("PSBO",$J,"B",PSBINDX,PSBDFN)=""
"RTN","PSBO",230,0)
 .S:$D(^TMP("PSBO",$J)) RECS=1
"RTN","PSBO",231,0)
 ;
"RTN","PSBO",232,0)
 ;* * Clinics selected & All patient DFN's * *                    ;*70
"RTN","PSBO",233,0)
 I PSBSORT="C" D
"RTN","PSBO",234,0)
 .Q:'$D(PSBRPT(2))                  ;no Clinics selected
"RTN","PSBO",235,0)
 .D CLIN(.PSBRPT)
"RTN","PSBO",236,0)
 .M ^TMP("PSBO",$J)=^TMP("PSJCL",$J) K ^TMP("PSJCL",$J)
"RTN","PSBO",237,0)
 .S:$D(^TMP("PSBO",$J)) RECS=1
"RTN","PSBO",238,0)
 ;
"RTN","PSBO",239,0)
 Q
"RTN","PSBO",240,0)
 ;Q RECS
"RTN","PSBO",241,0)
 ;
"RTN","PSBO",242,0)
WRAP(X,Y,Z) ; Quick text wrap
"RTN","PSBO",243,0)
 ;
"RTN","PSBO",244,0)
 ; Input Parameters Description:
"RTN","PSBO",245,0)
 ;  X: Left Column of display [Optional]
"RTN","PSBO",246,0)
 ;  Y: Cols to wrap in [Optional]
"RTN","PSBO",247,0)
 ;  Z: Text to wrap [Optional]
"RTN","PSBO",248,0)
 ;
"RTN","PSBO",249,0)
 N PSB
"RTN","PSBO",250,0)
 F  Q:'$L(Z)  D
"RTN","PSBO",251,0)
 .W:$X>X !
"RTN","PSBO",252,0)
 .W:$X<X ?X
"RTN","PSBO",253,0)
 .I $L(Z)<Y W Z S Z="" Q
"RTN","PSBO",254,0)
 .F PSB=Y:-1:0 Q:$E(Z,PSB)=" "
"RTN","PSBO",255,0)
 .S:PSB<1 PSB=Y
"RTN","PSBO",256,0)
 .W $E(Z,1,PSB)
"RTN","PSBO",257,0)
 .S Z=$E(Z,PSB+1,$L(Z))
"RTN","PSBO",258,0)
 Q ""
"RTN","PSBO",259,0)
 ;
"RTN","PSBO",260,0)
PRNEFF(PSBEIECMT,PSBIEN) ;Check for PRN Error comment
"RTN","PSBO",261,0)
 N PSBCMTCH
"RTN","PSBO",262,0)
 I $P($G(PSBRPT(.2)),U,8)=0 S PSBCMTCH=0 F  S PSBCMTCH=$O(^PSB(53.79,PSBIEN,.3,PSBCMTCH)) Q:PSBCMTCH=""  D
"RTN","PSBO",263,0)
 .I $P($G(^PSB(53.79,PSBIEN,.3,PSBCMTCH,0)),U)["**Pain Score of" S PSBEIECMT=" **This Pain Score may have been Entered in Error. See Vitals Package.**"
"RTN","PSBO",264,0)
 Q PSBEIECMT
"RTN","PSBO",265,0)
 ;
"RTN","PSBO",266,0)
FILTERCO ; rebuild TMP using needed recs and remove clinics not wanted
"RTN","PSBO",267,0)
 N QQ,COCNT,CLNAM
"RTN","PSBO",268,0)
 I '$G(PSBIENS) N PSBIENS S PSBIENS=PSBRPT
"RTN","PSBO",269,0)
 S COCNT=0 K ^TMP("PSJTMP",$J)
"RTN","PSBO",270,0)
 K ^TMP("PSJTMP",$J)
"RTN","PSBO",271,0)
 F QQ=0:0 S QQ=$O(^TMP("PSJ",$J,QQ)) Q:'QQ  D
"RTN","PSBO",272,0)
 . Q:$P($G(^TMP("PSJ",$J,QQ,0)),U,3)["P"
"RTN","PSBO",273,0)
 . S CLNAM=$P($G(^TMP("PSJ",$J,QQ,0)),U,11) Q:CLNAM=""   ;Not a CO
"RTN","PSBO",274,0)
 . ;ignore orders that are CO and for a Clinic not asked for
"RTN","PSBO",275,0)
 . I CLNAM]"",'$D(^PSB(53.69,+PSBIENS,2,"B",CLNAM)) Q
"RTN","PSBO",276,0)
 . S COCNT=COCNT+1
"RTN","PSBO",277,0)
 . M ^TMP("PSJTMP",$J,COCNT)=^TMP("PSJ",$J,QQ)
"RTN","PSBO",278,0)
 K ^TMP("PSJ",$J) M ^TMP("PSJ",$J)=^TMP("PSJTMP",$J)
"RTN","PSBO",279,0)
 K ^TMP("PSJTMP",$J)
"RTN","PSBO",280,0)
 S:'$D(^TMP("PSJ",$J)) ^TMP("PSJ",$J,1,0)=-1
"RTN","PSBO",281,0)
 Q
"RTN","PSBO",282,0)
 ;
"RTN","PSBO",283,0)
CLIN(RPTARR,DFNLST) ;Build DFN list of patient orders per Clinics selected
"RTN","PSBO",284,0)
 ; Input:  RPTARR - Report request array from file 53.69.  (required) 
"RTN","PSBO",285,0)
 ;         DFNLST - pass by ref array name if array needed and not
"RTN","PSBO",286,0)
 ;                  a tmp global pass a 1.  (optional)
"RTN","PSBO",287,0)
 ;                                           default is TMP global
"RTN","PSBO",288,0)
 ;         DFNLST - array of DFN's only   
"RTN","PSBO",289,0)
 ;
"RTN","PSBO",290,0)
 N DFNARR,GLB,ROOT,STARTDT
"RTN","PSBO",291,0)
 K ^TMP("PSJCL",$J)
"RTN","PSBO",292,0)
 S STARTDT=$P($G(RPTARR(.1)),U,6)
"RTN","PSBO",293,0)
 S:STARTDT="" STARTDT=$P($$NOW^XLFDT,".")
"RTN","PSBO",294,0)
 ; 
"RTN","PSBO",295,0)
 ;Begin query read with Unit Dose xref and report start date range
"RTN","PSBO",296,0)
 S GLB=$NA(^PS(55,"AUDC",STARTDT)),ROOT=$E(GLB,1,13)
"RTN","PSBO",297,0)
 D QUERY(GLB,ROOT,9999999,.RPTARR,.DFNARR)
"RTN","PSBO",298,0)
 ;
"RTN","PSBO",299,0)
 ;Now do query read for IV xref and report start date range
"RTN","PSBO",300,0)
 S GLB=$NA(^PS(55,"AIVC",STARTDT)),ROOT=$E(GLB,1,13)
"RTN","PSBO",301,0)
 D QUERY(GLB,ROOT,9999999,.RPTARR,.DFNARR)
"RTN","PSBO",302,0)
 ;
"RTN","PSBO",303,0)
 I $G(DFNLST) M DFNLST=DFNARR Q  ;if DFNLST then return array and quit
"RTN","PSBO",304,0)
 D BLDTMP(.DFNARR)
"RTN","PSBO",305,0)
 Q
"RTN","PSBO",306,0)
 ;
"RTN","PSBO",307,0)
QUERY(GLB,ROOT,RPSTOPDT,RPTAR,DFNAR) ;Loops thru global xref via $Query
"RTN","PSBO",308,0)
 ;                            for qualifying recs to find DFN's
"RTN","PSBO",309,0)
 N CLN,CLNNAM,DFN,STPDT,NOD1,NOD2
"RTN","PSBO",310,0)
 I GLB["UD" D
"RTN","PSBO",311,0)
 .S NOD1=5,NOD2=8
"RTN","PSBO",312,0)
 E  D
"RTN","PSBO",313,0)
 .S NOD1="IV",NOD2="DSS"
"RTN","PSBO",314,0)
 ;
"RTN","PSBO",315,0)
 F  S GLB=$Q(@GLB) Q:$E(GLB,1,13)'=ROOT  D
"RTN","PSBO",316,0)
 .S STPDT=$P($QS(GLB,3),"."),CLN=$QS(GLB,4),DFN=$QS(GLB,5),OR=$QS(GLB,6)
"RTN","PSBO",317,0)
 .Q:$D(DFNAR(DFN))                      ;quit if DFN already on ARR
"RTN","PSBO",318,0)
 .S CLNODE=$G(^PS(55,DFN,NOD1,OR,NOD2))
"RTN","PSBO",319,0)
 .Q:'$$CLINIC(CLNODE)                   ;not active bcma clin order
"RTN","PSBO",320,0)
 .S CLNNAM=$$GET1^DIQ(44,CLN,.01)       ;get clinic name
"RTN","PSBO",321,0)
 .Q:STPDT>RPSTOPDT                      ;quit if rec beyond stop date
"RTN","PSBO",322,0)
 .Q:'$D(RPTAR(2,"B",CLNNAM))            ;quit if Not on Cln sel list
"RTN","PSBO",323,0)
 .;
"RTN","PSBO",324,0)
 .S DFNAR(DFN)=""                       ;Keep - Set DFN in array
"RTN","PSBO",325,0)
 Q
"RTN","PSBO",326,0)
 ;
"RTN","PSBO",327,0)
BLDTMP(ARR) ;Build Tmp global for DFN's to be included on the report
"RTN","PSBO",328,0)
 N VA,VADM,PSJINDX
"RTN","PSBO",329,0)
 F DFN=0:0 S DFN=$O(ARR(DFN)) Q:'DFN  D
"RTN","PSBO",330,0)
 .K VA,VADM D DEM^VADPT
"RTN","PSBO",331,0)
 .Q:(VADM(1)="")!(VA("PID")="")
"RTN","PSBO",332,0)
 .S ^TMP("PSJCL",$J,DFN,0)=VADM(1)_U_VA("PID")
"RTN","PSBO",333,0)
 .S PSJINDX=VADM(1)
"RTN","PSBO",334,0)
 .S ^TMP("PSJCL",$J,"B",PSJINDX,DFN)=""
"RTN","PSBO",335,0)
 .S RECS=1
"RTN","PSBO",336,0)
 Q
"RTN","PSBO",337,0)
 ;
"RTN","PSBO",338,0)
CLINIC(CL) ;Is this a Clinic order that would show on the VDL in CO mode also?
"RTN","PSBO",339,0)
 Q:'($P(CL,"^",2)?7N!($P(CL,"^",2)?7N1".".N)) 0  ;no appt date, IM ord
"RTN","PSBO",340,0)
 Q:'$D(^PS(53.46,"B",+CL)) 0                     ;no PTR to 44, IM ord
"RTN","PSBO",341,0)
 N A S A=$O(^PS(53.46,"B",+CL,"")) Q:'A 0        ;no 53.46 ien, IM ord
"RTN","PSBO",342,0)
 Q $P(^PS(53.46,A,0),"^",4)                      ;Send to BCMA? flag
"RTN","PSBO1")
0^20^B19597423^B7501769
"RTN","PSBO1",1,0)
PSBO1 ;BIRMINGHAM/EFC-BCMA OUTPUTS ;3/19/13 19:13pm
"RTN","PSBO1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**4,13,32,2,43,28,70**;Mar 2004;Build 101
"RTN","PSBO1",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBO1",4,0)
 ;
"RTN","PSBO1",5,0)
 ;*70 - add ablility to update List multiple for Clinic names
"RTN","PSBO1",6,0)
 ;
"RTN","PSBO1",7,0)
NEW(RESULTS,PSBRTYP) ; Create a new report request
"RTN","PSBO1",8,0)
 ; Called interactively and via RPCBroker
"RTN","PSBO1",9,0)
 K RESULTS
"RTN","PSBO1",10,0)
 ; Check Type
"RTN","PSBO1",11,0)
 I '$F("DL^MD^MH^ML^MM^MV^MT^PE^PM^WA^BL^PI^AL^DO^VT^PF^XA^ST^SF^IV^CM^CP^CE^CI^BZ^",PSBRTYP) S RESULTS(0)="-1^Invalid Report Type" Q
"RTN","PSBO1",12,0)
 I '+$G(DUZ) S RESULTS(0)="-1^Undefined User" Q
"RTN","PSBO1",13,0)
 I '$G(DUZ(2)) S RESULTS(0)="-1^Undefined Division" Q
"RTN","PSBO1",14,0)
 ; Lock Log
"RTN","PSBO1",15,0)
 L +(^PSB(53.69,0)):$S($G(DILOCKTM)>30:DILOCKTM,1:30)
"RTN","PSBO1",16,0)
 E  S RESULTS(0)="-1^Request Log Locked" Q
"RTN","PSBO1",17,0)
 ; Generate Unique Entry and Create
"RTN","PSBO1",18,0)
 F  D NOW^%DTC S X=$E(%_"000000",1,14) S X=(1700+$E(X,1,3))_$E(X,4,14),X=PSBRTYP_"-"_$TR(X,".","-") Q:'$D(^PSB(53.69,"B",X))
"RTN","PSBO1",19,0)
 S DIC="^PSB(53.69,",DIC(0)="L"
"RTN","PSBO1",20,0)
 S DIC("DR")=".02///N;.03////^S X=DUZ;.04////^S X=DUZ(2);.05///^S X=PSBRTYP"
"RTN","PSBO1",21,0)
 K DD,DO D FILE^DICN
"RTN","PSBO1",22,0)
 L -(^PSB(53.69,0))
"RTN","PSBO1",23,0)
 ; Okay, setup return and Boogie
"RTN","PSBO1",24,0)
 I +Y<1 S RESULTS(0)="-1^Error Creating Request"
"RTN","PSBO1",25,0)
 E  S RESULTS(0)=Y
"RTN","PSBO1",26,0)
 K DO
"RTN","PSBO1",27,0)
 Q
"RTN","PSBO1",28,0)
 ;
"RTN","PSBO1",29,0)
PRINT ;
"RTN","PSBO1",30,0)
 N ZTDTH,ZTRTN,ZTSK,ZTDESC,ZTSAVE,DA
"RTN","PSBO1",31,0)
 S DA=+PSBRPT(0)
"RTN","PSBO1",32,0)
 S IOP=$$GET1^DIQ(53.69,DA_",",.06,"I"),PSBSIO=0 I IOP]"" D
"RTN","PSBO1",33,0)
 .S IOP="`"_IOP,%ZIS="N"
"RTN","PSBO1",34,0)
 .D ^%ZIS
"RTN","PSBO1",35,0)
 .I IO=IO(0) S PSBSIO=1
"RTN","PSBO1",36,0)
 .D HOME^%ZIS K IOP
"RTN","PSBO1",37,0)
 I $$GET1^DIQ(53.69,DA_",",.06)["BROWSER"!(PSBSIO=1) S IOP=$$GET1^DIQ(53.69,DA_",",.06)_";132" D ^%ZIS U IO D DQ^PSBO(DA) D ^%ZISC K IOP Q
"RTN","PSBO1",38,0)
 W @IOF,"Submitting Your Report Request to TaskMan..."
"RTN","PSBO1",39,0)
 S ZTIO=$$GET1^DIQ(53.69,DA_",",.06)_";132"
"RTN","PSBO1",40,0)
 S ZTDTH=$S($$GET1^DIQ(53.69,DA_",",.07,"I")]"":$$GET1^DIQ(53.69,DA_",",.07,"I"),1:$H)
"RTN","PSBO1",41,0)
 S ZTDESC="BCMA - "_$$GET1^DIQ(53.69,DA_",",.05)
"RTN","PSBO1",42,0)
 S ZTRTN="DQ^PSBO("_DA_")"
"RTN","PSBO1",43,0)
 F I="PSBDFN","PSBTYPE" S ZTSAVE(I)=""
"RTN","PSBO1",44,0)
 I $G(PSBORDNM)]"" S ZTSAVE("PSBORDNM")=""
"RTN","PSBO1",45,0)
 D ^%ZTLOAD
"RTN","PSBO1",46,0)
 I $D(ZTSK) S ^TMP("PSBO",$J,1)="0^Report queued. (Task #"_ZTSK_")"
"RTN","PSBO1",47,0)
 E  S ^TMP("PSBO",$J,1)="-1^Task Rejected."
"RTN","PSBO1",48,0)
 Q
"RTN","PSBO1",49,0)
 ;
"RTN","PSBO1",50,0)
LIST(XLIST) ;  Place List Criteria into subfile #53.692 (multiple)
"RTN","PSBO1",51,0)
 F XL1=$O(XLIST("")):1:$O(XLIST("B"),-1)  Q:+XL1=""  D
"RTN","PSBO1",52,0)
 .;*70 add"MM", "WA" rpts to accept array list of selected clinics
"RTN","PSBO1",53,0)
 .;    build reports that use Clinic search list array
"RTN","PSBO1",54,0)
 .N PSBCLN
"RTN","PSBO1",55,0)
 .F CLN="WA","DL","MM","CM","CP","CI","CE" S PSBCLN(CLN)=""
"RTN","PSBO1",56,0)
 .I ($P(XLIST(XL1),U)=PSBTYPE)!($D(PSBCLN(PSBTYPE))) D
"RTN","PSBO1",57,0)
 ..K PSBFDA,PSBRET,PSBIENX D CLEAN^DILF
"RTN","PSBO1",58,0)
 ..S PSBIENX="+"_(XL1+1)_","_PSBIENS
"RTN","PSBO1",59,0)
 ..D VAL^DIE(53.692,"+"_(XL1+1)_","_PSBIENS,.01,"F",$TR(XLIST(XL1),"^","~"),"PSBRET","PSBFDA")
"RTN","PSBO1",60,0)
 ..D UPDATE^DIE("","PSBFDA","PSBIENX","PSBRET")
"RTN","PSBO1",61,0)
 Q
"RTN","PSBO1",62,0)
 ;
"RTN","PSBO1",63,0)
CHECK ;Beginning of PSB*1*10
"RTN","PSBO1",64,0)
 K ^TMP("PSJ",$J),PSBCL                                   ;[*70-1459]
"RTN","PSBO1",65,0)
 N PSBDFN,PSBBAR,PSBDRUG,PSBFLAG,PSBPNM,PSBNDX,PSBX
"RTN","PSBO1",66,0)
 S PSBFLAG="",PSBBAR=$P($P($G(^PSB(53.69,DA,.3)),U,1),"~",2)
"RTN","PSBO1",67,0)
 S PSBDRUG=$$GET1^DIQ(53.69,DA_",",.31)
"RTN","PSBO1",68,0)
 S PSBDFN=$$GET1^DIQ(53.69,DA_",",.12,"I") S:$G(PSBDFN) PSBFLAG=1
"RTN","PSBO1",69,0)
 D EN^PSJBCMA(PSBDFN)
"RTN","PSBO1",70,0)
 ;
"RTN","PSBO1",71,0)
 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:'PSBX  D
"RTN","PSBO1",72,0)
 .K Y,PSBORD,PSBPNM,PSBNDX
"RTN","PSBO1",73,0)
 .S PSBCL=$P(^TMP("PSJ",$J,PSBX,0),U,11)                         ;[*70-1459]
"RTN","PSBO1",74,0)
 .M PSBORD=^TMP("PSJ",$J,PSBX)
"RTN","PSBO1",75,0)
 .F PSBNDX=700,850,950  D
"RTN","PSBO1",76,0)
 ..F Y=0:0 S Y=$O(PSBORD(PSBNDX,Y)) Q:'Y  D
"RTN","PSBO1",77,0)
 ...I $P($G(PSBORD(1)),U,7)'="A" Q
"RTN","PSBO1",78,0)
 ...S PSBPNM=$P(PSBORD(PSBNDX,Y,0),U,1)
"RTN","PSBO1",79,0)
 ...I PSBNDX=700,PSBPNM=PSBBAR D  Q                              ;[*70-1459]
"RTN","PSBO1",80,0)
 ....S PSBFLAG=0                                                 ;[*70-1459]
"RTN","PSBO1",81,0)
 ....I PSBCL]"" S PSBCL(PSBCL)=""                                ;[*70-1459]
"RTN","PSBO1",82,0)
 ....E  S PSBCL($$GET1^DIQ(2,$P(PSBORD(0),U),.1)_" (Ward)")=""   ;[*70-1459]
"RTN","PSBO1",83,0)
 ...I PSBNDX=850,$D(^PSDRUG("A526",PSBBAR,PSBPNM)) D  Q          ;[*70-1459]
"RTN","PSBO1",84,0)
 ....S PSBFLAG=0                                                 ;[*70-1459]
"RTN","PSBO1",85,0)
 ....I PSBCL]"" S PSBCL(PSBCL)=""                                ;[*70-1459]
"RTN","PSBO1",86,0)
 ....E  S PSBCL($$GET1^DIQ(2,$P(PSBORD(0),U),.1)_" (Ward)")=""   ;[*70-1459]
"RTN","PSBO1",87,0)
 ...I PSBNDX=950,$D(^PSDRUG("A527",PSBBAR,PSBPNM)) D  Q          ;[*70-1459]
"RTN","PSBO1",88,0)
 ....S PSBFLAG=0                                                 ;[*70-1459]
"RTN","PSBO1",89,0)
 ....I PSBCL]"" S PSBCL(PSBCL)=""                                ;[*70-1459]
"RTN","PSBO1",90,0)
 ....E  S PSBCL($$GET1^DIQ(2,$P(PSBORD(0),U),.1)_" (Ward)")=""   ;[*70-1459]
"RTN","PSBO1",91,0)
 I PSBFLAG=1 D
"RTN","PSBO1",92,0)
 .W !,"Patient is not currently on medication: ",PSBDRUG
"RTN","PSBO1",93,0)
 .K DIRUT,DIR
"RTN","PSBO1",94,0)
 .S DIR("A")="Do you want to continue"
"RTN","PSBO1",95,0)
 .S DIR(0)="Y"
"RTN","PSBO1",96,0)
 .D ^DIR
"RTN","PSBO1",97,0)
 .S PSBANS=+Y W !
"RTN","PSBO1",98,0)
 Q
"RTN","PSBO1",99,0)
 ;
"RTN","PSBOBL")
0^46^B10430547^B9096254
"RTN","PSBOBL",1,0)
PSBOBL ;BIRMINGHAM/EFC-BAR CODE LABELS (ZEBRA SPECIFIC) ;11/1/12 1:01pm
"RTN","PSBOBL",2,0)
 ;;3.0;BAR CODE MED ADMIN;**70**;Mar 2004;Build 101
"RTN","PSBOBL",3,0)
 ;
"RTN","PSBOBL",4,0)
 ; Reference/IA
"RTN","PSBOBL",5,0)
 ; File 50/221
"RTN","PSBOBL",6,0)
 ;
"RTN","PSBOBL",7,0)
 ;*70 - 1459: Adding clinic to BL and BZ chui labels.
"RTN","PSBOBL",8,0)
 ;
"RTN","PSBOBL",9,0)
EN ;
"RTN","PSBOBL",10,0)
 N PSBIENS,PSBBAR,PSBDRUG,PSBQTY,PSBDOSE,PSBNAME,PSBWARD,PSBLOT
"RTN","PSBOBL",11,0)
 N PSBEXP,PSBMFG,PSBFCB,PSBSYM,PSBCNT,PSBANS,PSBORD,PSBCLIN   ;[*70-1459]
"RTN","PSBOBL",12,0)
 S PSBIENS=PSBRPT_","
"RTN","PSBOBL",13,0)
 S PSBBAR=$P($P($G(^PSB(53.69,PSBRPT,.3)),U,1),"~",2)
"RTN","PSBOBL",14,0)
 ;
"RTN","PSBOBL",15,0)
 S PSBPRE=$$GET^XPAR("DIV","PSB DEFAULT BARCODE PREFIX")
"RTN","PSBOBL",16,0)
 S:PSBPRE]"" PSBBAR=PSBPRE_$S(PSBPRE?1.N:"-",1:"")_PSBBAR
"RTN","PSBOBL",17,0)
 ;
"RTN","PSBOBL",18,0)
 S PSBDRUG=$$GET1^DIQ(53.69,PSBIENS,.31)
"RTN","PSBOBL",19,0)
 S PSBQTY=+$$GET1^DIQ(53.69,PSBIENS,.35)
"RTN","PSBOBL",20,0)
 S:PSBQTY PSBDRUG=PSBDRUG_" (Qty: "_PSBQTY_")"
"RTN","PSBOBL",21,0)
 S PSBDOSE=$$GET1^DIQ(53.69,PSBIENS,.39)
"RTN","PSBOBL",22,0)
 S PSBNAME=$$GET1^DIQ(53.69,PSBIENS,.12)
"RTN","PSBOBL",23,0)
 I PSBNAME]"" S PSBNAME=PSBNAME_" ("_$E($$GET1^DIQ(53.69,PSBIENS,.121),6,9)_")"
"RTN","PSBOBL",24,0)
 S PSBWARD=$$GET1^DIQ(53.69,PSBIENS,.122)
"RTN","PSBOBL",25,0)
 S PSBCLIN=$$GET1^DIQ(53.69,PSBIENS,5)                        ;[*70-1459]
"RTN","PSBOBL",26,0)
 S PSBLOT=$$GET1^DIQ(53.69,PSBIENS,.32)
"RTN","PSBOBL",27,0)
 S PSBEXP=$$GET1^DIQ(53.69,PSBIENS,.33)
"RTN","PSBOBL",28,0)
 S PSBMFG=$$GET1^DIQ(53.69,PSBIENS,.34)
"RTN","PSBOBL",29,0)
 S PSBFCB=$$GET1^DIQ(53.69,PSBIENS,.36)_"/"_$$GET1^DIQ(53.69,PSBIENS,.37)
"RTN","PSBOBL",30,0)
 S PSBSYM=$$GET^XPAR("DIV","PSB DEFAULT BARCODE FORMAT",,"E")
"RTN","PSBOBL",31,0)
 F PSBCNT=1:1:+$P(PSBRPT(.3),U,8) D LABEL
"RTN","PSBOBL",32,0)
 Q
"RTN","PSBOBL",33,0)
 ;
"RTN","PSBOBL",34,0)
LABEL ; Print the Label
"RTN","PSBOBL",35,0)
 W "^XA"
"RTN","PSBOBL",36,0)
 W !,"^LH0,0^FS"
"RTN","PSBOBL",37,0)
 W $$DATA(20,25,"Drug:")
"RTN","PSBOBL",38,0)
 W $$DATA(100,25,PSBDRUG)
"RTN","PSBOBL",39,0)
 I PSBDOSE]"" W $$DATA(20,60,"Dosage:") W $$DATA(100,60,PSBDOSE)
"RTN","PSBOBL",40,0)
 I PSBNAME]"" W $$DATA(350,60,PSBNAME)
"RTN","PSBOBL",41,0)
 I PSBCLIN]"" W $$DATA(350,90,"Clinic:") W $$DATA(400,90,PSBCLIN)            ;[*70-1459]
"RTN","PSBOBL",42,0)
 I PSBCLIN="",PSBWARD]"" W $$DATA(350,90,"Ward:") W $$DATA(400,90,PSBWARD)   ;[*70-1459]
"RTN","PSBOBL",43,0)
 I PSBLOT]"" W $$DATA(350,120,"Lot#:") W $$DATA(400,120,PSBLOT)
"RTN","PSBOBL",44,0)
 I PSBEXP]"" W $$DATA(500,120,"Exp:") W $$DATA(550,120,PSBEXP)
"RTN","PSBOBL",45,0)
 I PSBMFG]"" W $$DATA(350,150,"Mfg:") W $$DATA(400,150,PSBMFG)
"RTN","PSBOBL",46,0)
 W $$DATA(350,180,"Filled/Checked By:") W $$DATA(520,180,PSBFCB)
"RTN","PSBOBL",47,0)
 ;
"RTN","PSBOBL",48,0)
 ; Code 39
"RTN","PSBOBL",49,0)
 I PSBSYM="C39" W !,"^BY2,3.0^FO20,100^B3N,N,80,Y,N^FR^FD"_PSBBAR_"^FS"
"RTN","PSBOBL",50,0)
 ;
"RTN","PSBOBL",51,0)
 ; Code 128
"RTN","PSBOBL",52,0)
 I PSBSYM="128" W !,"^BY2,3.0^FO20,100^BCN,80,Y,N,N^FR^FD>:"_PSBBAR_"^FS"
"RTN","PSBOBL",53,0)
 ;
"RTN","PSBOBL",54,0)
 ; Code I 2 of 5
"RTN","PSBOBL",55,0)
 I PSBSYM="I25" W !,"^BY2,3.0^FO20,100^B2N,80,Y,N,N^FR^FD"_PSBBAR_"^FS"
"RTN","PSBOBL",56,0)
 ;
"RTN","PSBOBL",57,0)
 I PSBSYM="" W $$DATA(20,100,"PSB DEFAULT BARCODE FORMAT Undefined.")
"RTN","PSBOBL",58,0)
 ;
"RTN","PSBOBL",59,0)
 ; Close Label
"RTN","PSBOBL",60,0)
 W !,"^XZ",!
"RTN","PSBOBL",61,0)
 H 2
"RTN","PSBOBL",62,0)
 Q
"RTN","PSBOBL",63,0)
 ;
"RTN","PSBOBL",64,0)
DATA(X,Y,TEXT) ; Code to place the data on the label
"RTN","PSBOBL",65,0)
 W !,"^FO"_X_","_Y_"^A0N,30,20^CI13^FR^FD"_TEXT_"^FS"
"RTN","PSBOBL",66,0)
 Q ""
"RTN","PSBOBL",67,0)
 ;
"RTN","PSBOBL",68,0)
INPTR ;Input transform for DRUG field (#.31) in file 53.69.
"RTN","PSBOBL",69,0)
 K:$L(X)>40!($L(X)<1) X I $D(X) D
"RTN","PSBOBL",70,0)
 .S X=$TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","PSBOBL",71,0)
 .N DIC S DIC="^PSDRUG(",DIC(0)="EQNM",D="B^C^VAPN^VAC^NDC^XATC"
"RTN","PSBOBL",72,0)
 .S DIC("S")="I '$G(^PSDRUG(+Y,""I""))!($G(^(""I""))>DT),$P($G(^PSDRUG(+Y,2)),U,3)[""I""!($P($G(^PSDRUG(+Y,2)),U,3)[""U"")"
"RTN","PSBOBL",73,0)
 .D:+X'>0 MIX^DIC1
"RTN","PSBOBL",74,0)
 .D:+X>0 ^DIC
"RTN","PSBOBL",75,0)
 .S:+Y>0 X=$$GET1^DIQ(50,+Y_",",.01)_"~"_+Y K:+Y<1 X
"RTN","PSBOBL",76,0)
 Q
"RTN","PSBOBL",77,0)
 ;
"RTN","PSBOBZ")
0^47^B19545874^B18129776
"RTN","PSBOBZ",1,0)
PSBOBZ ;BIRMINGHAM/TTH-BAR CODE LABELS (MAIN) ;11/08/12 3:23pm
"RTN","PSBOBZ",2,0)
 ;;3.0;BAR CODE MED ADMIN;**2,70**;Mar 2004;Build 101
"RTN","PSBOBZ",3,0)
 ;;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOBZ",4,0)
 ;
"RTN","PSBOBZ",5,0)
 ; Reference/IA
"RTN","PSBOBZ",6,0)
 ; ^%ZIS(2/3435
"RTN","PSBOBZ",7,0)
 ; File 50/221
"RTN","PSBOBZ",8,0)
 ;
"RTN","PSBOBZ",9,0)
 ;*70 - 1459: Adding clinic to BL and BZ chui labels.
"RTN","PSBOBZ",10,0)
 ;
"RTN","PSBOBZ",11,0)
EN ;
"RTN","PSBOBZ",12,0)
 N PSBI,PSBIENS,PSBQTY,PSBDOSE,PSBDRUG,PSBNAME,PSBNODE3,PSBWARD,PSBLOT,PSBBAR,PSBTLE,SL
"RTN","PSBOBZ",13,0)
 N PSBEXP,PSBFD,PSBMFG,PSBCB,PSBFB,PSBFCB,PSBCNT,PSBANS,PSBORD,PSBPRE,PSBX,PSBY,PSBSYM,TEXT,PSBCLIN   ;[*70-1459]
"RTN","PSBOBZ",14,0)
 ;
"RTN","PSBOBZ",15,0)
 N PSBXX,PSBYY,PSBCODE
"RTN","PSBOBZ",16,0)
 S PSBXX=0 F  S PSBXX=$O(^%ZIS(2,IOST(0),55,PSBXX)) Q:'PSBXX  S PSBYY=$G(^(PSBXX,0)) I PSBYY]"" S PSBX=$P(PSBYY,"^"),PSBY=^(1),PSBCODE(PSBX)=PSBY
"RTN","PSBOBZ",17,0)
 ;
"RTN","PSBOBZ",18,0)
 ;The PSBRPT variable and PSBRPT(.3) array are set in the PSBO routine.  It is the internal
"RTN","PSBOBZ",19,0)
 ;entry number from the BCMA REPORT REQUEST file (#53.69). This entry is created
"RTN","PSBOBZ",20,0)
 ;when the user submits the completed ScreenMan form from the Label Print option.
"RTN","PSBOBZ",21,0)
 ;
"RTN","PSBOBZ",22,0)
 ;
"RTN","PSBOBZ",23,0)
 S PSBIENS=PSBRPT_","
"RTN","PSBOBZ",24,0)
 S PSBBAR=$P($P($G(PSBRPT(.3)),U,1),"~",2)
"RTN","PSBOBZ",25,0)
 S PSBPRE=$$GET^XPAR("DIV","PSB DEFAULT BARCODE PREFIX")
"RTN","PSBOBZ",26,0)
 S:PSBPRE]"" PSBBAR=PSBPRE_$S(PSBPRE?1.N:"-",1:"")_PSBBAR
"RTN","PSBOBZ",27,0)
 S PSBDRUG=$P($P($G(PSBRPT(.3)),U,1),"~",1)
"RTN","PSBOBZ",28,0)
 S PSBQTY=+$P($G(PSBRPT(.3)),U,5)
"RTN","PSBOBZ",29,0)
 S:PSBQTY PSBDRUG=PSBDRUG_" (Qty: "_PSBQTY_")"
"RTN","PSBOBZ",30,0)
 I PSBQTY=0 S PSBDRUG=PSBDRUG_" (Qty:      )"
"RTN","PSBOBZ",31,0)
 S PSBDOSE=$P($G(PSBRPT(.3)),U,9)
"RTN","PSBOBZ",32,0)
 I PSBDOSE]"" S PSBDOSE="Dose:"_PSBDOSE
"RTN","PSBOBZ",33,0)
 I PSBDOSE="" S PSBDOSE="Dose:"
"RTN","PSBOBZ",34,0)
 S PSBNAME=$$GET1^DIQ(53.69,PSBIENS,.12)
"RTN","PSBOBZ",35,0)
 I PSBNAME]"" S PSBNAME=PSBNAME_" ("_$E($$GET1^DIQ(53.69,PSBIENS,.121),6,9)_")"
"RTN","PSBOBZ",36,0)
 I PSBNAME="" S PSBNAME="Patient:"
"RTN","PSBOBZ",37,0)
 S PSBWARD=$$GET1^DIQ(53.69,PSBIENS,.122)
"RTN","PSBOBZ",38,0)
 S PSBCLIN=$$GET1^DIQ(53.69,PSBIENS,5)                        ;[*70-1459]
"RTN","PSBOBZ",39,0)
 I PSBWARD]"" S PSBWARD="Ward: "_PSBWARD
"RTN","PSBOBZ",40,0)
 I PSBWARD="" S PSBWARD="Ward: "
"RTN","PSBOBZ",41,0)
 I PSBCLIN]"" S PSBWARD="Clinic: "_PSBCLIN                    ;[*70-1459]
"RTN","PSBOBZ",42,0)
 S PSBLOT=$P($G(PSBRPT(.3)),U,2)
"RTN","PSBOBZ",43,0)
 I PSBLOT]"" S PSBLOT="Lot: "_PSBLOT
"RTN","PSBOBZ",44,0)
 I PSBLOT="" S PSBLOT="Lot: "
"RTN","PSBOBZ",45,0)
 S PSBFD=$P($G(PSBRPT(.3)),U,3)
"RTN","PSBOBZ",46,0)
 S PSBEXP=$$FMTE^XLFDT(PSBFD,5)
"RTN","PSBOBZ",47,0)
 I PSBEXP]"" S PSBEXP="Exp: "_PSBEXP
"RTN","PSBOBZ",48,0)
 I PSBEXP="" S PSBEXP="Exp: "
"RTN","PSBOBZ",49,0)
 S PSBMFG=$P($G(PSBRPT(.3)),U,4)
"RTN","PSBOBZ",50,0)
 I PSBMFG]"" S PSBMFG="Mfg: "_PSBMFG
"RTN","PSBOBZ",51,0)
 I PSBMFG="" S PSBMFG="Mfg: "
"RTN","PSBOBZ",52,0)
 S PSBFB=$P($G(PSBRPT(.3)),U,6) I PSBFB="" S PSBFB="_____"
"RTN","PSBOBZ",53,0)
 S PSBCB=$P($G(PSBRPT(.3)),U,7) I PSBCB="" S PSBCB="_____"
"RTN","PSBOBZ",54,0)
 S PSBFCB=PSBFB_"/"_PSBCB
"RTN","PSBOBZ",55,0)
 F PSBCNT=1:1:+$P(PSBRPT(.3),U,8) D LABEL
"RTN","PSBOBZ",56,0)
 Q
"RTN","PSBOBZ",57,0)
 ;
"RTN","PSBOBZ",58,0)
LABEL ;Get Barcode Label Type
"RTN","PSBOBZ",59,0)
 ;Barcode Type
"RTN","PSBOBZ",60,0)
 S PSBSYM=$$GET^XPAR("DIV","PSB DEFAULT BARCODE FORMAT",,"E")
"RTN","PSBOBZ",61,0)
 ;
"RTN","PSBOBZ",62,0)
INIT ;Initialize barcode printer
"RTN","PSBOBZ",63,0)
 I $D(PSBCODE("FI")) X PSBCODE("FI")
"RTN","PSBOBZ",64,0)
 I $D(PSBCODE("FI1")) X PSBCODE("FI1")
"RTN","PSBOBZ",65,0)
 I $D(PSBCODE("FI2")) X PSBCODE("FI2")
"RTN","PSBOBZ",66,0)
 ;
"RTN","PSBOBZ",67,0)
 ;Additional format settings
"RTN","PSBOBZ",68,0)
 I PSBSYM]"",$D(PSBCODE("SBF")) X PSBCODE("SBF")
"RTN","PSBOBZ",69,0)
 I PSBSYM="",$D(PSBCODE("EBF")) X PSBCODE("EBF")
"RTN","PSBOBZ",70,0)
 ;
"RTN","PSBOBZ",71,0)
 D START ;execute control codes to start label
"RTN","PSBOBZ",72,0)
 D PRINT ;execute control codes to print label
"RTN","PSBOBZ",73,0)
 ;
"RTN","PSBOBZ",74,0)
 ;Print Barcode Strip
"RTN","PSBOBZ",75,0)
 ;If barcode type is defined.
"RTN","PSBOBZ",76,0)
 I PSBSYM]"",$D(PSBCODE("SB")) S TEXT=PSBBAR X PSBCODE("SB")
"RTN","PSBOBZ",77,0)
 ;If barcode type is not define.
"RTN","PSBOBZ",78,0)
 I PSBSYM="",$D(PSBCODE("SB")) S TEXT="*NO BARCODE TYPE*" X PSBCODE("SB")
"RTN","PSBOBZ",79,0)
 ;
"RTN","PSBOBZ",80,0)
END ; Close Label or End of Label
"RTN","PSBOBZ",81,0)
 I $G(PSBCODE("EL"))]"" X PSBCODE("EL")
"RTN","PSBOBZ",82,0)
 H 2
"RTN","PSBOBZ",83,0)
 Q
"RTN","PSBOBZ",84,0)
 ;
"RTN","PSBOBZ",85,0)
START ;Start Label Print Process
"RTN","PSBOBZ",86,0)
 I $G(PSBCODE("SL"))]"" X PSBCODE("SL")
"RTN","PSBOBZ",87,0)
 Q
"RTN","PSBOBZ",88,0)
 ;
"RTN","PSBOBZ",89,0)
PRINT ;Print barcode label
"RTN","PSBOBZ",90,0)
 ;
"RTN","PSBOBZ",91,0)
 I PSBDRUG]"" S PSBTLE="PSBDRUG",TEXT="Drug: "_PSBDRUG  D PROCESS
"RTN","PSBOBZ",92,0)
 I PSBDOSE]"" S PSBTLE="PSBDOSE",TEXT=PSBDOSE D PROCESS
"RTN","PSBOBZ",93,0)
 I PSBNAME]"" S PSBTLE="PSBNAME",TEXT=PSBNAME  D PROCESS
"RTN","PSBOBZ",94,0)
 I PSBWARD]"" S PSBTLE="PSBWARD",TEXT=PSBWARD  D PROCESS
"RTN","PSBOBZ",95,0)
 I PSBLOT]"" S PSBTLE="PSBLOT",TEXT=PSBLOT  D PROCESS
"RTN","PSBOBZ",96,0)
 I PSBEXP]"" S PSBTLE="PSBEXP",TEXT=PSBEXP  D PROCESS
"RTN","PSBOBZ",97,0)
 I PSBMFG]"" S PSBTLE="PSBMFG",TEXT=PSBMFG  D PROCESS
"RTN","PSBOBZ",98,0)
 I PSBFCB]"" S PSBTLE="PSBFCB",TEXT="Filled/Checked By: "_PSBFCB  D PROCESS
"RTN","PSBOBZ",99,0)
 Q
"RTN","PSBOBZ",100,0)
 ;
"RTN","PSBOBZ",101,0)
PROCESS ;Process control code and field data.
"RTN","PSBOBZ",102,0)
 I $D(PSBCODE("STF")) X PSBCODE("STF")
"RTN","PSBOBZ",103,0)
 I $D(PSBCODE("ST")) X PSBCODE("ST")
"RTN","PSBOBZ",104,0)
 Q
"RTN","PSBOBZ",105,0)
 ;
"RTN","PSBOBZ",106,0)
INPTR ;Input transform for DRUG field (#.31) in file 53.69.
"RTN","PSBOBZ",107,0)
 N PSBIAD,PSBDEA,D,Y
"RTN","PSBOBZ",108,0)
 K:$L(X)>40!($L(X)<1) X  I $D(X) D
"RTN","PSBOBZ",109,0)
 .S X=$TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","PSBOBZ",110,0)
 .N DIC S DIC="^PSDRUG(",DIC(0)="EQNM",D="B^C^VAPN^VAC^NDC^XATC"
"RTN","PSBOBZ",111,0)
 .S DIC("S")="I (($P($G(^PSDRUG(+Y,2)),U,3)[""I"")!($P($G(^(2)),U,3)[""U"")),(('$G(^PSDRUG(+Y,""I"")))!(DT'>$G(^(""I""))))"
"RTN","PSBOBZ",112,0)
 .D:+X'>0 MIX^DIC1
"RTN","PSBOBZ",113,0)
 .D:+X>0 ^DIC
"RTN","PSBOBZ",114,0)
 .S:+Y>0 X=$$GET1^DIQ(50,+Y_",",.01)_"~"_+Y K:+Y<1 X
"RTN","PSBOBZ",115,0)
 Q
"RTN","PSBOCE")
0^18^B101068370^B83955260
"RTN","PSBOCE",1,0)
PSBOCE ;BIRMINGHAM/TEJ-Expired/DC'd/EXPIRING ORDERS REPORT ;2/20/13 20:13pm
"RTN","PSBOCE",2,0)
 ;;3.0;BAR CODE MED ADMIN;**32,50,68,70**;Mar 2004;Build 101
"RTN","PSBOCE",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOCE",4,0)
 ;
"RTN","PSBOCE",5,0)
 ; Reference/IA
"RTN","PSBOCE",6,0)
 ; GETSIOPI^PSJBCMA5/5763
"RTN","PSBOCE",7,0)
 ; 
"RTN","PSBOCE",8,0)
 ;*68 - allow SIOPI builder to accomodate more than 1 line in SI array
"RTN","PSBOCE",9,0)
 ;*70 - pass global var PSBCLINORD when Rpc Psbcsutl is called again
"RTN","PSBOCE",10,0)
 ;    - add clinic name to new array PSBCLIN to track clinic name per 
"RTN","PSBOCE",11,0)
 ;       order for printed output.
"RTN","PSBOCE",12,0)
 ;    - pass global var PSBCLINORD when RPC psbcsutl is called again
"RTN","PSBOCE",13,0)
 ;    - convert date/time fields to date only for CO and admin window 
"RTN","PSBOCE",14,0)
 ;       to 7 days +/-.
"RTN","PSBOCE",15,0)
 ;
"RTN","PSBOCE",16,0)
EN ;
"RTN","PSBOCE",17,0)
 N PSBX1X,RESULTS,RESULT,PSBFUTR,X2,X3,QQ,PSBCLIN,PSBSRCHL,PSBHDR,EXPIREHDG,FUTUREHDG,FUTUREX      ;*70
"RTN","PSBOCE",18,0)
 S PSBCLINORD=$S($P($G(PSBRPT(4)),U,2)="C":1,1:0)                 ;*70
"RTN","PSBOCE",19,0)
 S EXPIREHDG=$S(PSBCLINORD:"Expired/DC'd within last 7 days",1:"Expired/DC'd")
"RTN","PSBOCE",20,0)
 S FUTUREHDG=$S(PSBCLINORD:"Expiring within next 7 days",1:"Expiring Tomorrow")
"RTN","PSBOCE",21,0)
 S PSBFUTR=$TR(PSBRPT(1),"~",U)
"RTN","PSBOCE",22,0)
 S (PSBOCRIT,PSBXFLG,PSBCFLG)=""   ; Ord Status srch crit - "A"ctve, "D"C ed, "E"xpred"
"RTN","PSBOCE",23,0)
 S:$P(PSBFUTR,U,7) PSBOCRIT=PSBOCRIT_EXPIREHDG S:$P(PSBFUTR,U,8) PSBOCRIT=PSBOCRIT_EXPIREHDG S:$P(PSBFUTR,U,9) PSBOCRIT=PSBOCRIT_"Expiring Today"
"RTN","PSBOCE",24,0)
 S:$P(PSBFUTR,U,10) PSBOCRIT=PSBOCRIT_FUTUREHDG
"RTN","PSBOCE",25,0)
 S:$P(PSBFUTR,U,11) PSBXFLG=1
"RTN","PSBOCE",26,0)
 I $D(PSBRPT(.2)) I $P(PSBRPT(.2),U,8) S PSBCFLG=1
"RTN","PSBOCE",27,0)
 ;check Clinic search list                *70
"RTN","PSBOCE",28,0)
 S PSBSRCHL=$$SRCHLIST^PSBOHDR()
"RTN","PSBOCE",29,0)
 D:$P(PSBRPT(4),U,2)="C"
"RTN","PSBOCE",30,0)
 .S:PSBSRCHL="" PSBSRCHL="All Clinics"
"RTN","PSBOCE",31,0)
 .S PSBSRCHL="Clinic Search List: "_PSBSRCHL
"RTN","PSBOCE",32,0)
 ;
"RTN","PSBOCE",33,0)
 K PSBSRTBY,PSBCMT,PSBADM,PSBDATA,PSBOUTP,PSBLGD
"RTN","PSBOCE",34,0)
 S PSBSORT=1
"RTN","PSBOCE",35,0)
 D NOW^%DTC S (Y,PSBNOWX)=% D DD^%DT S PSBDTTM=Y
"RTN","PSBOCE",36,0)
 D GETPAR^PSBPAR("ALL","PSB ADMIN BEFORE")
"RTN","PSBOCE",37,0)
 S PSBB4=0 S:RESULTS(0)>0 PSBB4=+RESULTS(0)
"RTN","PSBOCE",38,0)
 D GETPAR^PSBPAR("ALL","PSB ADMIN AFTER")
"RTN","PSBOCE",39,0)
 S PSBAFT=0 S:RESULTS(0)>0 PSBAFT=+RESULTS(0)
"RTN","PSBOCE",40,0)
 I PSBCLINORD S (PSBB4,PSBAFT)=7                                  ;*70
"RTN","PSBOCE",41,0)
 K ^XTMP("PSBO",$J,"PSBLIST")
"RTN","PSBOCE",42,0)
 S (PSBPGNUM,PSBLNTOT,PSBTOT,PSBX1X)=""
"RTN","PSBOCE",43,0)
 K PSBLIST,PSBLIST2
"RTN","PSBOCE",44,0)
 S PSBXDFN=$P(PSBRPT(.1),U,2)
"RTN","PSBOCE",45,0)
 S PSBLIST(PSBXDFN)=""
"RTN","PSBOCE",46,0)
 S (PSBX1X,PSBTOT)=0
"RTN","PSBOCE",47,0)
 F  S PSBX1X=$O(PSBLIST(PSBX1X)) Q:+PSBX1X=0  D
"RTN","PSBOCE",48,0)
 .D RPC^PSBCSUTL(.PSBAREA,PSBX1X,,,PSBCLINORD)                    ;*70
"RTN","PSBOCE",49,0)
 .M PSBDATA=@PSBAREA
"RTN","PSBOCE",50,0)
 .S PSBX2X=1
"RTN","PSBOCE",51,0)
 .S (PSBLIST2(FUTUREHDG),PSBLIST2("Expiring Today"),PSBLIST2(EXPIREHDG),PSBLIST2(" * NO * "))=0
"RTN","PSBOCE",52,0)
 .F  S PSBX2X=$O(PSBDATA(PSBX2X)) Q:+PSBX2X=0  D
"RTN","PSBOCE",53,0)
 ..S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCE",54,0)
 ..I $P(PSBDATA,U)="ORD" D  Q
"RTN","PSBOCE",55,0)
 ...K PSBDRUGN
"RTN","PSBOCE",56,0)
 ...S PSBORDN=$P(PSBDATA,U,3)
"RTN","PSBOCE",57,0)
 ...S PSBCLIN(PSBORDN)=$S($P(PSBDATA,U,32)]"":"Location: ",1:"")_$P(PSBDATA,U,32)                      ;*70
"RTN","PSBOCE",58,0)
 ...S PSBTB=$P(PSBDATA,U,29) S PSBTB=$S(PSBTB=1:"UD",PSBTB=2:"IVPB",PSBTB=3:"IV",1:" * ERROR * ")
"RTN","PSBOCE",59,0)
 ...S PSBTB(PSBORDN,PSBTB)=""
"RTN","PSBOCE",60,0)
 ...S PSBSTS=$P(PSBDATA,U,23) S PSBSTS=$S((PSBSTS="A")&(($P(PSBDATA,U,27)>PSBNOWX)):"Active",PSBSTS="H":"On Hold",PSBSTS="D":"Discontinued",PSBSTS="DE":"Discontinued (Edit)",(PSBSTS="E")!($P(PSBDATA,U,27)'>PSBNOWX):"Expired",1:" * ERROR * ")
"RTN","PSBOCE",61,0)
 ...S PSBSTS(PSBORDN,PSBSTS)=""
"RTN","PSBOCE",62,0)
 ...S X2=$P(PSBDATA,U,27),X3=$P(PSBNOWX,".")
"RTN","PSBOCE",63,0)
 ...;add ability to use a different calculation and heading for future
"RTN","PSBOCE",64,0)
 ...;expired IM and CO meds
"RTN","PSBOCE",65,0)
 ...S FUTUREX=$S(PSBCLINORD:8,1:2)
"RTN","PSBOCE",66,0)
 ...S PSBSTSX=$S((X2<PSBNOWX):EXPIREHDG,(X3'>X2)&($$FMADD^XLFDT(X3,1)>X2):"Expiring Today",($$FMADD^XLFDT(X3,1)'>X2)&(X2'>$$FMADD^XLFDT(X3,FUTUREX)):FUTUREHDG,1:" * NO * ")   ;*70
"RTN","PSBOCE",67,0)
 ...;
"RTN","PSBOCE",68,0)
 ...I PSBSTS["Discontinued" S PSBSTSX=EXPIREHDG
"RTN","PSBOCE",69,0)
 ...S PSBLIST2(PSBSTSX,$P(PSBDATA,U,9),PSBORDN)=$P(PSBDATA,U,32) S PSBLIST2(PSBSTSX)=PSBLIST2(PSBSTSX)+1   ;*70 clin name
"RTN","PSBOCE",70,0)
 ...S:PSBOCRIT[PSBSTSX PSBTOT=PSBTOT+1
"RTN","PSBOCE",71,0)
 ...S PSBSCHTY=$P(PSBDATA,U,6)
"RTN","PSBOCE",72,0)
 ...S PSBSCHTY(PSBORDN,PSBSCHTY)=""
"RTN","PSBOCE",73,0)
 ...S PSBSCHD=$P(PSBDATA,U,7) I PSBSCHD="" S PSBSCHD=" "
"RTN","PSBOCE",74,0)
 ...S PSBSCHD(PSBORDN,PSBSCHD)=""
"RTN","PSBOCE",75,0)
 ...S PSBDOSR=$P(PSBDATA,U,10)_", "_$P(PSBDATA,U,11)
"RTN","PSBOCE",76,0)
 ...S PSBDOSR=$TR($E(PSBDOSR,1)," ")_$E(PSBDOSR,2,999)
"RTN","PSBOCE",77,0)
 ...S PSBDOSR(PSBORDN,PSBDOSR)="" K PSBOMDR(PSBORDN)
"RTN","PSBOCE",78,0)
 ...S PSBNXTX1=$$NEXTADM^PSBCSUTX(PSBX1X,PSBORDN)
"RTN","PSBOCE",79,0)
 ...I PSBSTS["Hold" S PSBNXTX2="Provider Hold"
"RTN","PSBOCE",80,0)
 ...I PSBSTS'["Hold" D 
"RTN","PSBOCE",81,0)
 ....I PSBNOWX>$$FMADD^XLFDT(PSBNXTX1,,,PSBAFT) S PSBNXTX2="MISSED "_PSBNXTX1
"RTN","PSBOCE",82,0)
 ....E  S PSBNXTX2="DUE "_PSBNXTX1
"RTN","PSBOCE",83,0)
 ...S PSBNXTX1=$$FMTDT^PSBOCE1(PSBNXTX1)
"RTN","PSBOCE",84,0)
 ...I ("^P^OC^O"[(U_PSBSCHTY))!(PSBTB="IV")!(PSBSTS["Discontinued")!(PSBSTS["Expired") S:PSBSTS'["Hold" PSBNXTX2=" "
"RTN","PSBOCE",85,0)
 ...S PSBNXTX(PSBORDN,PSBNXTX2)=""
"RTN","PSBOCE",86,0)
 ...; ** SPC INSTR  **
"RTN","PSBOCE",87,0)
 ...S PSBX2X=PSBX2X+1
"RTN","PSBOCE",88,0)
 ...;  *68
"RTN","PSBOCE",89,0)
 ...K ^TMP("PSJBCMA5",$J)
"RTN","PSBOCE",90,0)
 ...I PSBSIFLG D GETSIOPI^PSJBCMA5(PSBX1X,PSBORDN,1)
"RTN","PSBOCE",91,0)
 ...F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,PSBX1X,PSBORDN,QQ)) Q:'QQ  D
"RTN","PSBOCE",92,0)
 ....S PSBSI(PSBORDN,QQ)=^TMP("PSJBCMA5",$J,PSBX1X,PSBORDN,QQ)
"RTN","PSBOCE",93,0)
 ...;  *68 end
"RTN","PSBOCE",94,0)
 ...S PSBOSTDT=$P(PSBDATA,U,22)
"RTN","PSBOCE",95,0)
 ...S PSBOSTDT(PSBORDN,PSBOSTDT)=""
"RTN","PSBOCE",96,0)
 ...S PSBOSPDT=$P(PSBDATA,U,27)
"RTN","PSBOCE",97,0)
 ...S PSBOSPDT(PSBORDN,PSBOSPDT)=""
"RTN","PSBOCE",98,0)
 ..I "^DD^ADD^SOL"[(U_$P(PSBDATA,U)) D  Q
"RTN","PSBOCE",99,0)
 ...F I=PSBX2X:1 S PSBDATA1=PSBDATA(I) D  Q:$D(PSBOMDR(PSBORDN))
"RTN","PSBOCE",100,0)
 ....I "^DD^ADD^SOL"[(U_$P(PSBDATA1,U)) S PSBX2X=I S PSBDRUGN=$G(PSBDRUGN,"")_$P(PSBDATA1,U,3)_", " Q
"RTN","PSBOCE",101,0)
 ....S $E(PSBDRUGN,$L(PSBDRUGN)-1)="" S PSBDRUGN(PSBORDN,$E(PSBDRUGN,1,250))=PSBDRUGN
"RTN","PSBOCE",102,0)
 ....S PSBOMDR(PSBORDN,$E((PSBDRUGN_"; "_PSBDOSR),1,250))=PSBDRUGN_"; "_PSBDOSR
"RTN","PSBOCE",103,0)
 ..I $P(PSBDATA,U)="END" Q
"RTN","PSBOCE",104,0)
 ..I $P(PSBDATA(PSBX2X+1),U)="ORF" D  Q
"RTN","PSBOCE",105,0)
 ...S PSBX2X=PSBX2X+1 S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCE",106,0)
 ...S:$P(PSBDATA,U,2)]"" PSBFLGD(PSBORDN,$P(PSBDATA,U,3)_" - "_$P(PSBDATA,U,4))=""
"RTN","PSBOCE",107,0)
 ..I ($P(PSBDATA,U)="ADM")&($P(PSBDATA,U,4)]"") D
"RTN","PSBOCE",108,0)
 ...S PSBXID=$P(PSBDATA,U,6)_U_$P(PSBDATA,U,4),PSBADM(PSBORDN,(-1*($P(PSBDATA,U,6))),PSBXID)=PSBDATA
"RTN","PSBOCE",109,0)
 ...I $O(PSBSCHTY(PSBORDN,""))="P" S PSBPRNR(PSBORDN,$P(PSBDATA,U,4))=$P(PSBDATA,U,9)
"RTN","PSBOCE",110,0)
 ...I $P(PSBDATA,U,3)]"" S PSBBID(PSBORDN,$P(PSBDATA,U,4))=$P(PSBDATA,U,3)
"RTN","PSBOCE",111,0)
 ...S:PSBXFLG PSBLGD(PSBORDN,"X","INITIALS",$P(PSBDATA,U,8))=""
"RTN","PSBOCE",112,0)
 ...K PSBDATA(PSBX2X)
"RTN","PSBOCE",113,0)
 ...I ($P(PSBDATA(PSBX2X+1),U)="CMT")  F  S PSBDATA=PSBDATA(PSBX2X+1) Q:($P(PSBDATA,U)'="CMT")  D
"RTN","PSBOCE",114,0)
 ....S PSBX2X=PSBX2X+1
"RTN","PSBOCE",115,0)
 ....S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCE",116,0)
 ....K PSBDATA(PSBX2X)
"RTN","PSBOCE",117,0)
 ....S:$P(PSBDATA,U,3)]"" PSBPRNEF(PSBORDN,$P(PSBXID,U,2))=$P(PSBDATA,U,3)
"RTN","PSBOCE",118,0)
 ....I 'PSBCFLG S PSBDATA=PSBDATA(PSBX2X+1) Q
"RTN","PSBOCE",119,0)
 ....I $P(PSBDATA,U,2)'="" D
"RTN","PSBOCE",120,0)
 .....S PSBLGD(PSBORDN,"C","INITIALS",$P(PSBDATA,U,4))=""
"RTN","PSBOCE",121,0)
 .....S PSBCMT(PSBORDN,$P(PSBXID,U,2),(-1*$P(PSBDATA,U,6)),PSBX2X)=PSBDATA
"RTN","PSBOCE",122,0)
 I '$D(PSBLIST2) K PSBLIST,^XTMP("PSBO",$J,"PSBLIST")
"RTN","PSBOCE",123,0)
 D CREATHDR
"RTN","PSBOCE",124,0)
 D SUBHDR
"RTN","PSBOCE",125,0)
 D BLDRPT
"RTN","PSBOCE",126,0)
 D WRTRPT
"RTN","PSBOCE",127,0)
 Q
"RTN","PSBOCE",128,0)
BLDRPT ; Buld RPT DATA
"RTN","PSBOCE",129,0)
 S X0="" K PSBLIST2(" * NO * "),PSBL2ULN
"RTN","PSBOCE",130,0)
 S PSBTOPHD=PSBLNTOT-2
"RTN","PSBOCE",131,0)
 I '$D(PSBLIST2) D  Q
"RTN","PSBOCE",132,0)
 .S PSBOUTP(0,PSBLNTOT)="W !!,""<<<< NO ORDERS TO DISPLAY >>>>"",!!"
"RTN","PSBOCE",133,0)
 S PSBMORE=5 F PSBX1X=EXPIREHDG,"Expiring Today",FUTUREHDG D
"RTN","PSBOCE",134,0)
 .I PSBX1X'=" * ERROR * " S PSBSUM=PSBX1X_" ["_PSBLIST2(PSBX1X)_$S(PSBLIST2(PSBX1X)=1:" Order",1:" Orders")_"]" S PSBOUTP($$PGTOT,PSBLNTOT)="W !!,"""_PSBSUM_""""
"RTN","PSBOCE",135,0)
 .Q:PSBLIST2(PSBX1X)=0
"RTN","PSBOCE",136,0)
 .Q:PSBOCRIT'[PSBX1X
"RTN","PSBOCE",137,0)
 .S:$L(PSBSUM)>$G(PSBL2ULN,0) PSBL2ULN=$L(PSBSUM)
"RTN","PSBOCE",138,0)
 .S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBL2ULN),"" "",""=""),!"
"RTN","PSBOCE",139,0)
 .S PSBOUTP($$PGTOT,PSBLNTOT)="W !"
"RTN","PSBOCE",140,0)
 .K PSBDATA
"RTN","PSBOCE",141,0)
 .S X0="",PSBTOT1=0
"RTN","PSBOCE",142,0)
 .F  S X0=$O(PSBLIST2(PSBX1X,X0))  Q:X0=""  F  S PSBX2X=$O(PSBLIST2(PSBX1X,X0,PSBX2X)) Q:PSBX2X=""  D
"RTN","PSBOCE",143,0)
 ..M PSBLGD("INITIALS")=PSBLGD(PSBX2X,"X","INITIALS") M PSBLGD("INITIALS")=PSBLGD(PSBX2X,"C","INITIALS")
"RTN","PSBOCE",144,0)
 ..S PSBDATA(1,1)=$O(PSBTB(PSBX2X,""))
"RTN","PSBOCE",145,0)
 ..S PSBDATA(1,2)=$O(PSBSTS(PSBX2X,""))
"RTN","PSBOCE",146,0)
 ..S PSBDATA(1,3)=$O(PSBSCHTY(PSBX2X,""))
"RTN","PSBOCE",147,0)
 ..S Y0=$O(PSBOMDR(PSBX2X,"")) I Y0]"" S PSBDATA(1,4)="("_X0_")",PSBDATA(1,4,0)=PSBOMDR(PSBX2X,Y0)
"RTN","PSBOCE",148,0)
 ..S PSBDATA(1,5)=$O(PSBSCHD(PSBX2X,""))
"RTN","PSBOCE",149,0)
 ..S PSBDATA(1,6)=$O(PSBNXTX(PSBX2X,""))
"RTN","PSBOCE",150,0)
 ..S:PSBDATA(1,6)'["Hold" $P(PSBDATA(1,6)," ",2)=$$FMTDT^PSBOCE1($P(PSBDATA(1,6)," ",2))
"RTN","PSBOCE",151,0)
 ..S PSBDATA(1,7)=$$FMTDT^PSBOCE1($O(PSBOSTDT(PSBX2X,"")))
"RTN","PSBOCE",152,0)
 ..S PSBDATA(1,8)=$$FMTDT^PSBOCE1($E($O(PSBOSPDT(PSBX2X,"")),1,12))
"RTN","PSBOCE",153,0)
 ..K PSBSIDAT M PSBSIDAT=PSBSI(PSBX2X)                  ;*68
"RTN","PSBOCE",154,0)
 ..S PSBTOT1=PSBTOT1+1
"RTN","PSBOCE",155,0)
 ..K PSBDATA(2),PSBDATA(3),PSBSILN
"RTN","PSBOCE",156,0)
 ..D BUILDLN^PSBOCE1,SIOPI^PSBOCM(.PSBSIDAT,PSBTAB8,$S(PSBX2X["V":"Other Print Info: ",1:""))
"RTN","PSBOCE",157,0)
 ..I $D(PSBRPLN) S PSBMORE=$O(PSBRPLN(""),-1)+6 I $D(PSBSILN) S PSBMORE=PSBMORE+$O(PSBSILN(""),-1)
"RTN","PSBOCE",158,0)
 ..K PSB1 I $D(PSBFLGD(PSBX2X)) S PSB="" F  S PSB=$O(PSBFLGD(PSBX2X,PSB)) Q:PSB=""  I ($P(PSB,":")'="NOX")&($P(PSB,":")'="STAT") S PSB1=$G(PSB1,"")_PSB
"RTN","PSBOCE",159,0)
 ..;*70 build write clinic stmt      
"RTN","PSBOCE",160,0)
 ..S PSBOUTP($$PGTOT,PSBLNTOT)="W """_$G(PSBCLIN(PSBX2X))_""""_",!"
"RTN","PSBOCE",161,0)
 ..S PSBCNT=PSBTOT1_"   "_$G(PSB1,"")
"RTN","PSBOCE",162,0)
 ..S PSBOUTP($$PGTOT,PSBLNTOT)="W """_PSBCNT_""""
"RTN","PSBOCE",163,0)
 ..S I="" F  S I=$O(PSBRPLN(I)) Q:+I=0  D
"RTN","PSBOCE",164,0)
 ...S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBRPLN(I)_""""
"RTN","PSBOCE",165,0)
 ..S I="" F  S I=$O(PSBSILN(I)) Q:+I=0  D
"RTN","PSBOCE",166,0)
 ...S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBSILN(I)_""""
"RTN","PSBOCE",167,0)
 ..S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBTAB8),"" "",""-""),!"
"RTN","PSBOCE",168,0)
 ..K PSBRPLN,PSBDATA,PSBSILN
"RTN","PSBOCE",169,0)
 D:+PSBTOT>0 LGD^PSBOCM
"RTN","PSBOCE",170,0)
 Q
"RTN","PSBOCE",171,0)
WRTRPT ;  writ
"RTN","PSBOCE",172,0)
 I $O(PSBOUTP(""),-1)<1 D  Q
"RTN","PSBOCE",173,0)
 .X PSBOUTP($O(PSBOUTP(""),-1),21)
"RTN","PSBOCE",174,0)
 .D FTR
"RTN","PSBOCE",175,0)
 S PSBPGNUM=1
"RTN","PSBOCE",176,0)
 S PSBZ="" F  S PSBZ=$O(PSBOUTP(PSBZ)) Q:PSBZ=""  D
"RTN","PSBOCE",177,0)
 .I PSBPGNUM'=PSBZ D FTR S PSBPGNUM=PSBZ D HDR,SUBHDR
"RTN","PSBOCE",178,0)
 .S PSBX2X="" F  S PSBX2X=$O(PSBOUTP(PSBZ,PSBX2X)) Q:PSBX2X=""  D
"RTN","PSBOCE",179,0)
 ..X PSBOUTP(PSBZ,PSBX2X)
"RTN","PSBOCE",180,0)
 D FTR
"RTN","PSBOCE",181,0)
 K ^XTMP("PSBO",$J,"PSBLIST"),PSBOUTP
"RTN","PSBOCE",182,0)
 Q
"RTN","PSBOCE",183,0)
HDR ;  Hder
"RTN","PSBOCE",184,0)
 W:$Y>1 @IOF
"RTN","PSBOCE",185,0)
 W:$X>1 !
"RTN","PSBOCE",186,0)
 S PSBRPNM="BCMA COVERSHEET EXPIRED/DC'd/EXPIRING ORDERS REPORT"
"RTN","PSBOCE",187,0)
 D:$P(PSBRPT(.1),U,1)="P"
"RTN","PSBOCE",188,0)
 .S PSBHDR(0)=PSBRPNM
"RTN","PSBOCE",189,0)
 .S PSBHDR(1)="Order Status(es): --"
"RTN","PSBOCE",190,0)
 .F Y=7,8,9,10 I $P(PSBFUTR,U,Y) S $P(PSBHDR(1),": ",2)=$P(PSBHDR(1),": ",2)_$S(PSBHDR(1)["--":"",1:"/ ")_$P("^^^^^^Expired^DC'd^Expiring Today^"_FUTUREHDG_"^^^^^^^^",U,Y)_" " S PSBHDR(1)=$TR(PSBHDR(1),"-","")
"RTN","PSBOCE",191,0)
 .I $P(PSBFUTR,U,11) S PSBHDR(2)="Include Action(s)"_$S(PSBCFLG:" & Comments/Reasons",1:"")
"RTN","PSBOCE",192,0)
 .S:$G(PSBSRCHL)]"" PSBHDR(3)="",PSBHDR(4)=PSBSRCHL          ;*70
"RTN","PSBOCE",193,0)
 .D PT^PSBOHDR(PSBXDFN,.PSBHDR)
"RTN","PSBOCE",194,0)
 Q
"RTN","PSBOCE",195,0)
SUBHDR ;
"RTN","PSBOCE",196,0)
 N PSBAL S PSBAL=$O(PSBHDR("ALERGY",""),-1) S PSBAL=$S((PSBAL/12)>(PSBAL\12):(PSBAL\12)+1,1:(PSBAL\12))
"RTN","PSBOCE",197,0)
 N PSBRE S PSBRE=$O(PSBHDR("REAC",""),-1) S PSBRE=$S((PSBRE/12)>(PSBRE\12):(PSBRE\12)+1,1:(PSBRE\12))
"RTN","PSBOCE",198,0)
 S PSBLNTOT=$O(PSBHDR(""),-1)+9+PSBAL+PSBRE+1
"RTN","PSBOCE",199,0)
 I $G(PSBPGNUM,0)=1 W !,?(PSBTAB8-($L("Total Orders reported: "_+PSBTOT))),"Total Orders reported: "_+PSBTOT,! S PSBLNTOT=PSBLNTOT+2
"RTN","PSBOCE",200,0)
 W !,$TR($J("",PSBTAB8)," ","_") S PSBLNTOT=PSBLNTOT+1
"RTN","PSBOCE",201,0)
 W !,$G(PSBHD1,"") S PSBLNTOT=PSBLNTOT+1
"RTN","PSBOCE",202,0)
 W !,$G(PSBHD2,"") S PSBLNTOT=PSBLNTOT+1
"RTN","PSBOCE",203,0)
 W !,$TR($J("",PSBTAB8)," ","="),! S PSBLNTOT=PSBLNTOT+2
"RTN","PSBOCE",204,0)
 I $D(NOTE(PSBPGNUM)) W NOTE(PSBPGNUM),!! S PSBLNTOT=PSBLNTOT+2
"RTN","PSBOCE",205,0)
 Q
"RTN","PSBOCE",206,0)
FTR ;  Footr
"RTN","PSBOCE",207,0)
 D PTFTR^PSBOHDR()
"RTN","PSBOCE",208,0)
 S PSBPG="Page: "_PSBPGNUM_" of "_$S($O(PSBOUTP(""),-1)=0:1,1:$O(PSBOUTP(""),-1))
"RTN","PSBOCE",209,0)
 S PSBPGRM=PSBTAB8-($L(PSBPG))
"RTN","PSBOCE",210,0)
 W !,PSBRPNM,"     ",?(PSBPGRM-($L(PSBDTTM)+3)),PSBDTTM_"  "_PSBPG
"RTN","PSBOCE",211,0)
 Q
"RTN","PSBOCE",212,0)
PGTOT(X) ;mnt PAGE Number
"RTN","PSBOCE",213,0)
 I (PSBLNTOT+PSBMORE)>(IOSL) D PGC^PSBOCE1
"RTN","PSBOCE",214,0)
 I $G(X,1) S PSBLNTOT=PSBLNTOT+$G(X,1),PSBMORE=PSBMORE-$G(X,1)
"RTN","PSBOCE",215,0)
 Q PSBPGNUM
"RTN","PSBOCE",216,0)
CREATHDR ;
"RTN","PSBOCE",217,0)
 K PSBHD1,PSBHD2
"RTN","PSBOCE",218,0)
 I IOM'<132 S PSBMORE=4,PSBHD1=$P($T(HD132A),"~",2),PSBHD2=$P($T(HD132B),";",2),PSBBLANK=$P($T(H132BLK),";",2)
"RTN","PSBOCE",219,0)
 E  S PSBHD1="THIS REPORT SUPPORTS >131 CHAR./LINE PRINT FORMATS ONLY" K PSBLIST2 Q
"RTN","PSBOCE",220,0)
 ; tabs
"RTN","PSBOCE",221,0)
 S PSBTAB0=1 F PSBI=0:1:($L(PSBHD1,"|")-1) S:PSBI>0 @("PSBTAB"_PSBI)=($F(PSBHD1,"|",@("PSBTAB"_(PSBI-1))+1))-1
"RTN","PSBOCE",222,0)
 S PSBPGNUM=1
"RTN","PSBOCE",223,0)
 D HDR
"RTN","PSBOCE",224,0)
 Q
"RTN","PSBOCE",225,0)
HD132A ;~ VDL |    Status     |Type|       Medication; Dosage, Route      |    Schedule    |     Next      |   Order Start  |   Order Stop  |
"RTN","PSBOCE",226,0)
 Q
"RTN","PSBOCE",227,0)
HD132B ; Tab |               |    |                                      |                |   Action      |     Date       |    Date       |
"RTN","PSBOCE",228,0)
 Q
"RTN","PSBOCE",229,0)
H132BLK ;;     |               |    |                                      |                |                |               |               |
"RTN","PSBOCE",230,0)
 Q
"RTN","PSBOCI")
0^35^B103229478^B92815487
"RTN","PSBOCI",1,0)
PSBOCI ;BIRMINGHAM/TEJ-COVERSHEET IV OVERVIEW REPORT ;9/18/12 2:02am
"RTN","PSBOCI",2,0)
 ;;3.0;BAR CODE MED ADMIN;**32,62,68,70**;Mar 2004;Build 101
"RTN","PSBOCI",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOCI",4,0)
 ;
"RTN","PSBOCI",5,0)
 ; Reference/IA
"RTN","PSBOCI",6,0)
 ; File 4/10090
"RTN","PSBOCI",7,0)
 ; GETSIOPI^PSJBCMA5/5763
"RTN","PSBOCI",8,0)
 ; 
"RTN","PSBOCI",9,0)
 ;*68 - allow SIOPI builder to accomodate more than 1 line in SI array
"RTN","PSBOCI",10,0)
 ;*70 - pass global var PSBCLINORD when Rpc Psbcsutl is called again.
"RTN","PSBOCI",11,0)
 ;    - add clinic name to new array PSBCLIN to track clinic name per 
"RTN","PSBOCI",12,0)
 ;       order for printed output.
"RTN","PSBOCI",13,0)
 ;
"RTN","PSBOCI",14,0)
EN ;
"RTN","PSBOCI",15,0)
 N PSBX1X,RESULTS,RESULT,PSBFUTR,QQ,PSBCLIN,PSBSRCHL,PSBHDR
"RTN","PSBOCI",16,0)
 S PSBFUTR=$TR(PSBRPT(1),"~","^")
"RTN","PSBOCI",17,0)
 S (PSBOCRIT,PSBXFLG,PSBCFLG,PSBBGX)=""  ; srch crit - "A"ctive,"D"C ed,"E"xpired"
"RTN","PSBOCI",18,0)
 S PSBOCRIT="DEA"
"RTN","PSBOCI",19,0)
 S:$P(PSBFUTR,U,11) PSBXFLG=1
"RTN","PSBOCI",20,0)
 S:$P(PSBFUTR,U,12) PSBBGX=PSBBGX_"I"
"RTN","PSBOCI",21,0)
 S:$P(PSBFUTR,U,13) PSBBGX=PSBBGX_"S"
"RTN","PSBOCI",22,0)
 S:$P(PSBFUTR,U,14) PSBBGX=PSBBGX_"A"
"RTN","PSBOCI",23,0)
 I $D(PSBRPT(.2)) I $P(PSBRPT(.2),U,8) S PSBCFLG=1
"RTN","PSBOCI",24,0)
 ;check Clinic search list                *70
"RTN","PSBOCI",25,0)
 S PSBSRCHL=$$SRCHLIST^PSBOHDR()
"RTN","PSBOCI",26,0)
 D:$P(PSBRPT(4),U,2)="C"
"RTN","PSBOCI",27,0)
 .S:PSBSRCHL="" PSBSRCHL="All Clinics"
"RTN","PSBOCI",28,0)
 .S PSBSRCHL="Clinic Search List: "_PSBSRCHL
"RTN","PSBOCI",29,0)
 ;
"RTN","PSBOCI",30,0)
 K PSBSRTBY,PSBCMT,PSBADM,PSBDATA,PSBOUTP,PSBLGD
"RTN","PSBOCI",31,0)
 S PSBSORT=1
"RTN","PSBOCI",32,0)
 D NOW^%DTC S (Y,PSBNOWX)=% D DD^%DT S PSBDTTM=Y
"RTN","PSBOCI",33,0)
 D GETPAR^PSBPAR("ALL","PSB ADMIN BEFORE")
"RTN","PSBOCI",34,0)
 S PSBB4=0 S:RESULTS(0)>0 PSBB4=+RESULTS(0)
"RTN","PSBOCI",35,0)
 D GETPAR^PSBPAR("ALL","PSB ADMIN AFTER")
"RTN","PSBOCI",36,0)
 S PSBAFT=0 S:RESULTS(0)>0 PSBAFT=+RESULTS(0)
"RTN","PSBOCI",37,0)
 K ^XTMP("PSBO",$J,"PSBLIST")
"RTN","PSBOCI",38,0)
 S (PSBPGNUM,PSBLNTOT)=""
"RTN","PSBOCI",39,0)
 K PSBLIST,PSBLIST2
"RTN","PSBOCI",40,0)
 S PSBXDFN=$P(PSBRPT(.1),U,2)
"RTN","PSBOCI",41,0)
 S PSBLIST(PSBXDFN)=""
"RTN","PSBOCI",42,0)
 S (PSBX1X,PSBTOT)=0
"RTN","PSBOCI",43,0)
 S PSBCLINORD=$S($P($G(PSBRPT(4)),U,2)="C":1,1:0)    ;*70
"RTN","PSBOCI",44,0)
 F  S PSBX1X=$O(PSBLIST(PSBX1X)) Q:+PSBX1X=0  D
"RTN","PSBOCI",45,0)
 .D RPC^PSBCSUTL(.PSBAREA,PSBX1X,,,PSBCLINORD)       ;*70
"RTN","PSBOCI",46,0)
 .M PSBDATA=@PSBAREA
"RTN","PSBOCI",47,0)
 .S PSBX2X=1
"RTN","PSBOCI",48,0)
 .S (PSBLIST2("All Other"),PSBLIST2("Infusing"),PSBLIST2("Stopped"),PSBLIST2(" * NO * "))=0
"RTN","PSBOCI",49,0)
 .K PSBBSO
"RTN","PSBOCI",50,0)
 .F  S PSBX2X=$O(PSBDATA(PSBX2X)) Q:+PSBX2X=0  D
"RTN","PSBOCI",51,0)
 ..S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCI",52,0)
 ..I $P(PSBDATA,U)="ORD" K PSBORDN,PSBDRUGN D  Q
"RTN","PSBOCI",53,0)
 ...S PSBEND=0
"RTN","PSBOCI",54,0)
 ...S PSBTB=$P(PSBDATA,U,29) S PSBTB=$S(PSBTB=1:"UD",PSBTB=2:"IVPB",PSBTB=3:"IV",1:" * ERROR * ")
"RTN","PSBOCI",55,0)
 ...I (PSBTB'="IV") F PSBX2X=PSBX2X:1 D  Q:PSBEND>0
"RTN","PSBOCI",56,0)
 ....S PSBEND=0 I $P(PSBDATA(PSBX2X),U)="END" S PSBEND=PSBX2X
"RTN","PSBOCI",57,0)
 ...Q:PSBEND>0
"RTN","PSBOCI",58,0)
 ...S PSBSTS1=$P(PSBDATA,U,23)
"RTN","PSBOCI",59,0)
 ...S PSBSTS=$S((PSBSTS1="A")&(($P(PSBDATA,U,27)>PSBNOWX)):"Active",PSBSTS1="H":"On Hold",PSBSTS1="D":"Discontinued",PSBSTS1="DE":"Discontinued (Edit)",(PSBSTS1="E")!($P(PSBDATA,U,27)'>PSBNOWX):"Expired",1:" * ERROR * ")
"RTN","PSBOCI",60,0)
 ...S V=$$FMADD^XLFDT(PSBNOWX,,,PSBB4)
"RTN","PSBOCI",61,0)
 ...S PSBSTSX=$S($P(PSBDATA,U,27)'>PSBNOWX:"EXPIRED/DC'd",$P(PSBDATA,U,22)'>V:"ACTIVE",V:"FUTURE",1:" * ERROR * ")
"RTN","PSBOCI",62,0)
 ...I PSBSTSX=" * ERROR * "  F PSBX2X=PSBX2X:1 D  Q:PSBEND>0
"RTN","PSBOCI",63,0)
 ....S PSBEND=0 I $P(PSBDATA(PSBX2X),U)="END" S PSBEND=PSBX2X
"RTN","PSBOCI",64,0)
 ...Q:PSBEND>0
"RTN","PSBOCI",65,0)
 ...S PSBORDN=$P(PSBDATA,U,3)
"RTN","PSBOCI",66,0)
 ...S PSBCLIN(PSBORDN)=$S($P(PSBDATA,U,32)]"":"Location: ",1:"")_$P(PSBDATA,U,32)                      ;*70
"RTN","PSBOCI",67,0)
 ...S PSBORITX=$P(PSBDATA,U,9)
"RTN","PSBOCI",68,0)
 ...S PSBSTS(PSBORDN,PSBSTS)=""
"RTN","PSBOCI",69,0)
 ...S PSBOSTDT=$P(PSBDATA,U,22)
"RTN","PSBOCI",70,0)
 ...S PSBOSTDT(PSBORDN,PSBOSTDT)=""
"RTN","PSBOCI",71,0)
 ...S PSBOSPDT=$P(PSBDATA,U,27)
"RTN","PSBOCI",72,0)
 ...S PSBOSPDT(PSBORDN,PSBOSPDT)=""
"RTN","PSBOCI",73,0)
 ...S PSBDOSR=$P(PSBDATA,U,10)_", "_$P(PSBDATA,U,11)
"RTN","PSBOCI",74,0)
 ...S PSBDOSR=$TR($E(PSBDOSR,1)," ")_$E(PSBDOSR,2,999)
"RTN","PSBOCI",75,0)
 ...S PSBDOSR(PSBORDN,PSBDOSR)=""
"RTN","PSBOCI",76,0)
 ...S X2="A",PSBLIST2("All Other",PSBORITX,PSBORDN,"*NA*")=" "
"RTN","PSBOCI",77,0)
 ...S PSBBSO(PSBORDN)="" S:$G(PSBSTSX)="ACTIVE" PSBBSO(PSBORDN)="AVAILABLE"
"RTN","PSBOCI",78,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCI",79,0)
 ..I $P(PSBDATA,U)="ORC" D  Q
"RTN","PSBOCI",80,0)
 ...;  *68
"RTN","PSBOCI",81,0)
 ...K ^TMP("PSJBCMA5",$J)
"RTN","PSBOCI",82,0)
 ...I PSBSIFLG D GETSIOPI^PSJBCMA5(PSBX1X,PSBORDN,1)
"RTN","PSBOCI",83,0)
 ...F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,PSBX1X,PSBORDN,QQ)) Q:'QQ  D
"RTN","PSBOCI",84,0)
 ....S PSBSI(PSBORDN,QQ)=^TMP("PSJBCMA5",$J,PSBX1X,PSBORDN,QQ)
"RTN","PSBOCI",85,0)
 ...;  *68 end
"RTN","PSBOCI",86,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCI",87,0)
 ..I "^DD^ADD^SOL"[(U_$P(PSBDATA(PSBX2X),U)) D  Q
"RTN","PSBOCI",88,0)
 ...F I=PSBX2X:1 S PSBDATA1=PSBDATA(I) D  Q:$D(PSBOMDR(PSBORDN))
"RTN","PSBOCI",89,0)
 ....I "^DD^ADD^SOL"[(U_$P(PSBDATA1,U)) S PSBX2X=I S PSBDRUGN=$G(PSBDRUGN,"")_$P(PSBDATA1,U,3)_", " Q
"RTN","PSBOCI",90,0)
 ....S $E(PSBDRUGN,$L(PSBDRUGN)-1)="" S PSBDRUGN(PSBORDN,$E(PSBDRUGN,1,250))=PSBDRUGN
"RTN","PSBOCI",91,0)
 ....S PSBOMDR(PSBORDN,$E((PSBDRUGN_"; "_PSBDOSR),1,250))=PSBDRUGN_"; "_PSBDOSR
"RTN","PSBOCI",92,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCI",93,0)
 ..I $P(PSBDATA,U)="ORF" D  Q
"RTN","PSBOCI",94,0)
 ...S:$P(PSBDATA,U,2)]"" PSBFLGD(PSBORDN,$P(PSBDATA,U,3)_" - "_$P(PSBDATA,U,4))=""
"RTN","PSBOCI",95,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCI",96,0)
 ..I $P(PSBDATA,U)="ID"  D  Q
"RTN","PSBOCI",97,0)
 ...F PSBX3X=PSBX2X:1 S PSBDATA=PSBDATA(PSBX3X) Q:($P(PSBDATA,U)'="ID")  D
"RTN","PSBOCI",98,0)
 ....S PSBX2X=PSBX3X
"RTN","PSBOCI",99,0)
 ....K X2
"RTN","PSBOCI",100,0)
 ....S X2="A",PSBLIST2("All Other",PSBORITX,PSBORDN,$P(PSBDATA,U,2))=PSBBSO(PSBORDN)
"RTN","PSBOCI",101,0)
 ....I $D(PSBLIST2("All Other",PSBORITX,PSBORDN,"*NA*")) K PSBLIST2("All Other",PSBORITX,PSBORDN,"*NA*")
"RTN","PSBOCI",102,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCI",103,0)
 ..I ($P(PSBDATA,U)="ADM")&($P(PSBDATA,U,4)]"") D  Q
"RTN","PSBOCI",104,0)
 ...I $P(PSBDATA,U,3)]"" D
"RTN","PSBOCI",105,0)
 ....K X2
"RTN","PSBOCI",106,0)
 ....S PSBBID(PSBORDN,$P(PSBDATA,U,3))=""
"RTN","PSBOCI",107,0)
 ....I $P(^PSB(53.79,$P(PSBDATA,U,4),0),U,9)="I" D
"RTN","PSBOCI",108,0)
 .....S X2="I",PSBLIST2("Infusing")=PSBLIST2("Infusing")+1,PSBLIST2("Infusing",PSBORITX,PSBORDN,$P(PSBDATA,U,3))="INFUSING"
"RTN","PSBOCI",109,0)
 ....I $P(^PSB(53.79,$P(PSBDATA,U,4),0),U,9)="S" D
"RTN","PSBOCI",110,0)
 .....S X2="S",PSBLIST2("Stopped")=PSBLIST2("Stopped")+1,PSBLIST2("Stopped",PSBORITX,PSBORDN,$P(PSBDATA,U,3))="STOPPED"
"RTN","PSBOCI",111,0)
 ....N PSBORIEN,PSBADIT,PSBCMTIT ;Include initials in the Legend for all entries in the audit log and comment subfile - PSB*3*62
"RTN","PSBOCI",112,0)
 ....S PSBORIEN=$P(PSBDATA,U,4)
"RTN","PSBOCI",113,0)
 ....S PSBADIT=0 F  S PSBADIT=$O(^PSB(53.79,PSBORIEN,.9,PSBADIT)) Q:'PSBADIT  I ^PSB(53.79,PSBORIEN,.9,PSBADIT,0)["ACTION STATUS"!(^PSB(53.79,PSBORIEN,.9,PSBADIT,0)["ADMINISTRATION STATUS") D
"RTN","PSBOCI",114,0)
 .....I $P(^PSB(53.79,PSBORIEN,.9,PSBADIT,0),U,5)]"" S PSBLGD(PSBORDN,"INITIALS",$P(^PSB(53.79,PSBORIEN,.9,PSBADIT,0),U,5))=""
"RTN","PSBOCI",115,0)
 ....S PSBCMTIT=0 F  S PSBCMTIT=$O(^PSB(53.79,PSBORIEN,.3,PSBCMTIT)) Q:'PSBCMTIT  D
"RTN","PSBOCI",116,0)
 .....I $P(^PSB(53.79,PSBORIEN,.3,PSBCMTIT,0),U,2)]"" S PSBLGD(PSBORDN,"INITIALS",$P(^PSB(53.79,PSBORIEN,.3,PSBCMTIT,0),U,2))=""
"RTN","PSBOCI",117,0)
 ....S:'$D(X2) X2="A",PSBLIST2("All Other",PSBORITX,PSBORDN,$P(PSBDATA,U,3))=$$GET1^DIQ(53.79,$P(PSBDATA,U,4)_",","ACTION STATUS")
"RTN","PSBOCI",118,0)
 ....I $D(PSBLIST2("All Other",PSBORITX,PSBORDN,"*NA*")) K PSBLIST2("All Other",PSBORITX,PSBORDN,"*NA*")
"RTN","PSBOCI",119,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCI",120,0)
 ..I $P(PSBDATA,U,1)="END" Q
"RTN","PSBOCI",121,0)
 F I="All Other","Infusing","Stopped" S X="",PSBLIST2(I)=0 F  S X=$O(PSBLIST2(I,X)) Q:X=""  S XI="" F  S XI=$O(PSBLIST2(I,X,XI),-1) Q:XI=""  D
"RTN","PSBOCI",122,0)
 .S PSBX2X="" F  S PSBX2X=$O(PSBLIST2(I,X,XI,PSBX2X),-1) Q:PSBX2X=""  S PSBLIST2(I)=PSBLIST2(I)+1  I (PSBBGX[$E(I,1)) S PSBTOT=PSBTOT+1
"RTN","PSBOCI",123,0)
 D CREATHDR
"RTN","PSBOCI",124,0)
 D SUBHDR
"RTN","PSBOCI",125,0)
 D BLDRPT
"RTN","PSBOCI",126,0)
 D WRTRPT
"RTN","PSBOCI",127,0)
 Q
"RTN","PSBOCI",128,0)
BLDRPT ; Bld RPT
"RTN","PSBOCI",129,0)
 K PSBL2ULN
"RTN","PSBOCI",130,0)
 S PSBTOPHD=PSBLNTOT-2
"RTN","PSBOCI",131,0)
 I '$D(PSBLIST2) D  Q
"RTN","PSBOCI",132,0)
 .S PSBOUTP(0,PSBLNTOT)="W !!,""<<<< NO ORDERS TO DISPLAY >>>>"",!!"
"RTN","PSBOCI",133,0)
 S PSBMORE=5 F PSBX1X="Infusing","Stopped","All Other" D
"RTN","PSBOCI",134,0)
 .I PSBX1X'=" * ERROR * " S PSBSUM=PSBX1X_" ["_PSBLIST2(PSBX1X)_"]" S PSBOUTP($$PGTOT,PSBLNTOT)="W !!,"""_PSBSUM_""""
"RTN","PSBOCI",135,0)
 .Q:PSBLIST2(PSBX1X)=0
"RTN","PSBOCI",136,0)
 .Q:PSBBGX'[$E(PSBX1X,1)
"RTN","PSBOCI",137,0)
 .S:$L(PSBSUM)>$G(PSBL2ULN,0) PSBL2ULN=$L(PSBSUM)
"RTN","PSBOCI",138,0)
 .S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBL2ULN),"" "",""=""),!"
"RTN","PSBOCI",139,0)
 .S PSBOUTP($$PGTOT,PSBLNTOT)="W !"
"RTN","PSBOCI",140,0)
 .K PSBDATA
"RTN","PSBOCI",141,0)
 .S X0="",PSBTOT1=0
"RTN","PSBOCI",142,0)
 .F  S X0=$O(PSBLIST2(PSBX1X,X0))  Q:X0=""  S PSBX2X="" F  S PSBX2X=$O(PSBLIST2(PSBX1X,X0,PSBX2X)) Q:PSBX2X=""  S XI="" F  S XI=$O(PSBLIST2(PSBX1X,X0,PSBX2X,XI)) Q:XI=""  D
"RTN","PSBOCI",143,0)
 ..K PSBDATA(1)
"RTN","PSBOCI",144,0)
 ..S PSBDATA(1,1)=XI
"RTN","PSBOCI",145,0)
 ..S PSBDATA(1,2)=$O(PSBSTS(PSBX2X,""))
"RTN","PSBOCI",146,0)
 ..S PSBDATA(1,3)=PSBLIST2(PSBX1X,X0,PSBX2X,XI)
"RTN","PSBOCI",147,0)
 ..S Y0=$O(PSBOMDR(PSBX2X,"")) I Y0]"" S PSBDATA(1,4)="("_X0_")",PSBDATA(1,4,0)=PSBOMDR(PSBX2X,Y0)
"RTN","PSBOCI",148,0)
 ..I "IS"[$E(PSBDATA(1,3),1) S (PSBCHG,PSBDATA(1,5))="",PSBORLST(0)=PSBX2X D RPC^PSBCHKIV(.PSBCHG,PSBXDFN,.PSBORLST)
"RTN","PSBOCI",149,0)
 ..I $D(PSBCHG(0)) I PSBCHG(0)>0 I ($P(PSBCHG(1),U)=PSBX2X)!($P(PSBCHG(1),U,5)=PSBX2X) F X2=0:1 Q:PSBCHG(X2)="END"  I $P(PSBCHG(X2),U)="CD" S PSBDATA(1,5)="Changed Order" Q
"RTN","PSBOCI",150,0)
 ..S PSBDATA(1,6)=$$FMTDT^PSBOCE1($O(PSBOSTDT(PSBX2X,"")))
"RTN","PSBOCI",151,0)
 ..S PSBDATA(1,7)=$$FMTDT^PSBOCE1($E($O(PSBOSPDT(PSBX2X,"")),1,12))
"RTN","PSBOCI",152,0)
 ..K PSBSIDAT M PSBSIDAT=PSBSI(PSBX2X)                  ;*68
"RTN","PSBOCI",153,0)
 ..S PSBTOT1=PSBTOT1+1
"RTN","PSBOCI",154,0)
 ..K PSBDATA(2),PSBSILN
"RTN","PSBOCI",155,0)
 ..D BUILDLN^PSBOCI1,SIOPI^PSBOCM(.PSBSIDAT,PSBTAB7,"Other Print Info: ")
"RTN","PSBOCI",156,0)
 ..I $D(PSBRPLN) S PSBMORE=$O(PSBRPLN(""),-1)+6 I $D(PSBSILN) S PSBMORE=PSBMORE+$O(PSBSILN(""),-1)
"RTN","PSBOCI",157,0)
 ..K PSB1 I $D(PSBFLGD(PSBX2X)) S PSB="" F  S PSB=$O(PSBFLGD(PSBX2X,PSB)) Q:PSB=""  I ($P(PSB,":")'="NOX")&($P(PSB,":")'="STAT") S PSB1=$G(PSB1,"")_PSB
"RTN","PSBOCI",158,0)
 ..;*70 build write clinic stmt
"RTN","PSBOCI",159,0)
 ..S PSBOUTP($$PGTOT,PSBLNTOT)="W """_$G(PSBCLIN(PSBX2X))_""""_",!"
"RTN","PSBOCI",160,0)
 ..S PSBCNT=PSBTOT1_"   "_$G(PSB1,"")
"RTN","PSBOCI",161,0)
 ..S PSBOUTP($$PGTOT,PSBLNTOT)="W """_PSBCNT_""""
"RTN","PSBOCI",162,0)
 ..S I="" F  S I=$O(PSBRPLN(I)) Q:+I=0  D
"RTN","PSBOCI",163,0)
 ...S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBRPLN(I)_""""
"RTN","PSBOCI",164,0)
 ..S I="" F  S I=$O(PSBSILN(I)) Q:+I=0  D
"RTN","PSBOCI",165,0)
 ...S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBSILN(I)_""""
"RTN","PSBOCI",166,0)
 ..S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBTAB7),"" "",""-""),!"
"RTN","PSBOCI",167,0)
 ..K PSBRPLN,PSBDATA,PSBSILN
"RTN","PSBOCI",168,0)
 K PSBNO S PSBNO=1 D:+PSBTOT>0 LGD^PSBOCM K PSBNO
"RTN","PSBOCI",169,0)
 Q
"RTN","PSBOCI",170,0)
WRTRPT ;  writ
"RTN","PSBOCI",171,0)
 I $O(PSBOUTP(""),-1)<1 D  Q
"RTN","PSBOCI",172,0)
 .X PSBOUTP($O(PSBOUTP(""),-1),14)
"RTN","PSBOCI",173,0)
 .D PTFTR^PSBOCI1
"RTN","PSBOCI",174,0)
 S PSBPGNUM=1
"RTN","PSBOCI",175,0)
 S PSBZ="" F  S PSBZ=$O(PSBOUTP(PSBZ)) Q:PSBZ=""  D
"RTN","PSBOCI",176,0)
 .I PSBPGNUM'=PSBZ D PTFTR^PSBOCI1 S PSBPGNUM=PSBZ D HDR,SUBHDR
"RTN","PSBOCI",177,0)
 .S PSBX2X="" F  S PSBX2X=$O(PSBOUTP(PSBZ,PSBX2X)) Q:PSBX2X=""  D
"RTN","PSBOCI",178,0)
 ..X PSBOUTP(PSBZ,PSBX2X)
"RTN","PSBOCI",179,0)
 D PTFTR^PSBOCI1
"RTN","PSBOCI",180,0)
 K ^XTMP("PSBO",$J,"PSBLIST"),PSBOUTP
"RTN","PSBOCI",181,0)
 Q
"RTN","PSBOCI",182,0)
HDR ;  Hder
"RTN","PSBOCI",183,0)
 W:$Y>1 @IOF
"RTN","PSBOCI",184,0)
 W:$X>1 !
"RTN","PSBOCI",185,0)
 S PSBRPNM="BCMA COVERSHEET IV OVERVIEW REPORT"
"RTN","PSBOCI",186,0)
 D:$P(PSBRPT(.1),U,1)="P"
"RTN","PSBOCI",187,0)
 .S PSBHDR(0)=PSBRPNM
"RTN","PSBOCI",188,0)
 .S PSBHDR(1)="Order Type(s): --"
"RTN","PSBOCI",189,0)
 .F Y=12,13,18 I $P(PSBFUTR,U,Y) S $P(PSBHDR(1),": ",2)=$P(PSBHDR(1),": ",2)_$S(PSBHDR(1)["--":"",1:"/ ")_$P("^^^^^^^^^^^Infusing Bags^Stopped Bags^^^^^All Others",U,Y)_" " S PSBHDR(1)=$TR(PSBHDR(1),"-","")
"RTN","PSBOCI",190,0)
 .I $P(PSBFUTR,U,11) S PSBHDR(2)="Include Action(s)"_$S(PSBCFLG:" & Comments/Reasons",1:"")
"RTN","PSBOCI",191,0)
 .S:$G(PSBSRCHL)]"" PSBHDR(3)="",PSBHDR(4)=PSBSRCHL          ;*70
"RTN","PSBOCI",192,0)
 .D PT^PSBOHDR(PSBXDFN,.PSBHDR)
"RTN","PSBOCI",193,0)
 Q
"RTN","PSBOCI",194,0)
SUBHDR ;
"RTN","PSBOCI",195,0)
 N PSBAL S PSBAL=$O(PSBHDR("ALERGY",""),-1) S PSBAL=$S((PSBAL/12)>(PSBAL\12):(PSBAL\12)+1,1:(PSBAL\12))
"RTN","PSBOCI",196,0)
 N PSBRE S PSBRE=$O(PSBHDR("REAC",""),-1) S PSBRE=$S((PSBRE/12)>(PSBRE\12):(PSBRE\12)+1,1:(PSBRE\12))
"RTN","PSBOCI",197,0)
 S PSBLNTOT=$O(PSBHDR(""),-1)+9+PSBAL+PSBRE+1
"RTN","PSBOCI",198,0)
 I $G(PSBPGNUM,0)=1 W !,?(PSBTAB7-($L("Total Items reported: "_+PSBTOT))),"Total Items reported: "_+PSBTOT,! S PSBLNTOT=PSBLNTOT+2
"RTN","PSBOCI",199,0)
 W !,$TR($J("",PSBTAB7)," ","_") S PSBLNTOT=PSBLNTOT+1
"RTN","PSBOCI",200,0)
 W !,$G(PSBHD1,"") S PSBLNTOT=PSBLNTOT+1
"RTN","PSBOCI",201,0)
 W !,$G(PSBHD2,"") S PSBLNTOT=PSBLNTOT+1
"RTN","PSBOCI",202,0)
 W !,$TR($J("",PSBTAB7)," ","="),! S PSBLNTOT=PSBLNTOT+2
"RTN","PSBOCI",203,0)
 I $D(NOTE(PSBPGNUM)) W NOTE(PSBPGNUM),!! S PSBLNTOT=PSBLNTOT+2
"RTN","PSBOCI",204,0)
 Q
"RTN","PSBOCI",205,0)
PGTOT(X) ;PG Nmbr
"RTN","PSBOCI",206,0)
 I (PSBLNTOT+PSBMORE)>(IOSL) D PGC^PSBOCE1
"RTN","PSBOCI",207,0)
 I $G(X,1) S PSBLNTOT=PSBLNTOT+$G(X,1),PSBMORE=PSBMORE-$G(X,1)
"RTN","PSBOCI",208,0)
 Q PSBPGNUM
"RTN","PSBOCI",209,0)
CREATHDR ;
"RTN","PSBOCI",210,0)
 K PSBHD1,PSBHD2
"RTN","PSBOCI",211,0)
 I IOM'<132 S PSBHD1=$P($T(HD132A),"~",2),PSBHD2=$P($T(HD132B),";",2),PSBBLANK=$P($T(C132BLK),";",2)
"RTN","PSBOCI",212,0)
 E  S PSBHD1="THIS REPORT SUPPORTS >131 CHAR./LINE PRINT FORMATS ONLY" K PSBLIST2 Q
"RTN","PSBOCI",213,0)
 ; tabs
"RTN","PSBOCI",214,0)
 S PSBTAB0=1 F PSBI=0:1:($L(PSBHD1,"|")-1) S:PSBI>0 @("PSBTAB"_PSBI)=($F(PSBHD1,"|",@("PSBTAB"_(PSBI-1))+1))-1
"RTN","PSBOCI",215,0)
 S PSBPGNUM=1
"RTN","PSBOCI",216,0)
 D HDR
"RTN","PSBOCI",217,0)
 Q
"RTN","PSBOCI",218,0)
HD132A ;~    Bag ID     |    Order    |       Bag       |   Medication; Infusion Rate, Route  | Bag Info |    Order Start  |    Order Stop  |
"RTN","PSBOCI",219,0)
 Q
"RTN","PSBOCI",220,0)
HD132B ;               |    Status   |     Status      |                                     |          |     Date        |      Date      |
"RTN","PSBOCI",221,0)
 Q
"RTN","PSBOCI",222,0)
C132BLK ;;                |            |                 |                                     |          |                 |                |
"RTN","PSBOCI",223,0)
 Q
"RTN","PSBOCM")
0^33^B102788691^B85413465
"RTN","PSBOCM",1,0)
PSBOCM ;BIRMINGHAM/TEJ-COVERSHEET MEDICATION OVERVIEW REPORT ;2/20/13 20:13pm
"RTN","PSBOCM",2,0)
 ;;3.0;BAR CODE MED ADMIN;**32,50,68,70**;Mar 2004;Build 101
"RTN","PSBOCM",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOCM",4,0)
 ;
"RTN","PSBOCM",5,0)
 ; Reference/IA
"RTN","PSBOCM",6,0)
 ; File 4/10090
"RTN","PSBOCM",7,0)
 ; File 200/10060
"RTN","PSBOCM",8,0)
 ; GETSIOPI^PSJBCMA5/5763
"RTN","PSBOCM",9,0)
 ; 
"RTN","PSBOCM",10,0)
 ;*68 - allow SIOPI builder to accomodate more than 1 line in SI array
"RTN","PSBOCM",11,0)
 ;*70 - pass global var PSBCLINORD when Rpc Psbcsutl is called again
"RTN","PSBOCM",12,0)
 ;    - add clinic name to new array PSBCLIN to track clinic name per 
"RTN","PSBOCM",13,0)
 ;       order for printed output.
"RTN","PSBOCM",14,0)
 ;    - 1512: Don't show the Special Instructions / Other Print Info
"RTN","PSBOCM",15,0)
 ;       unless radio button selected.
"RTN","PSBOCM",16,0)
 ;    - convert date/time fields to date only for CO and admin window 
"RTN","PSBOCM",17,0)
 ;       to 7 days +/-.
"RTN","PSBOCM",18,0)
 ;
"RTN","PSBOCM",19,0)
EN ;
"RTN","PSBOCM",20,0)
 N PSBX1X,RESULTS,RESULT,PSBFUTR,QQ,PSBCLIN,PSBSRCHL,STRTDT,STOPDT,EXPIREHDG
"RTN","PSBOCM",21,0)
 S PSBFUTR=$TR(PSBRPT(1),"~","^")
"RTN","PSBOCM",22,0)
 S (PSBOCRIT,PSBXFLG,PSBCFLG)=""        ;  Order Status search criteria - "A"ctive, "D"C ed, "E"xpired"
"RTN","PSBOCM",23,0)
 S:$P(PSBFUTR,U,7) PSBOCRIT=PSBOCRIT_"D" S:$P(PSBFUTR,U,8) PSBOCRIT=PSBOCRIT_"E" S:$P(PSBFUTR,U,5) PSBOCRIT=PSBOCRIT_"A"
"RTN","PSBOCM",24,0)
 S:$P(PSBFUTR,U,4) PSBOCRIT=PSBOCRIT_"F"
"RTN","PSBOCM",25,0)
 S:$P(PSBFUTR,U,11) PSBXFLG=1
"RTN","PSBOCM",26,0)
 I $D(PSBRPT(.2)) I $P(PSBRPT(.2),U,8) S PSBCFLG=1
"RTN","PSBOCM",27,0)
 S PSBCLINORD=$S($P($G(PSBRPT(4)),U,2)="C":1,1:0)                 ;*70
"RTN","PSBOCM",28,0)
 ;add ability to use a different heading for expired IM/CO meds   ;*70
"RTN","PSBOCM",29,0)
 S EXPIREHDG=$S(PSBCLINORD:"EXPIRED/DC'd within last 7 days",1:"EXPIRED/DC'd")
"RTN","PSBOCM",30,0)
 ;
"RTN","PSBOCM",31,0)
 S PSBFUTR=$TR(PSBRPT(1),"~",U)
"RTN","PSBOCM",32,0)
 ;check Clinic search list                                        ;*70
"RTN","PSBOCM",33,0)
 S PSBSRCHL=$$SRCHLIST^PSBOHDR()
"RTN","PSBOCM",34,0)
 D:$P(PSBRPT(4),U,2)="C"
"RTN","PSBOCM",35,0)
 .S:PSBSRCHL="" PSBSRCHL="All Clinics"
"RTN","PSBOCM",36,0)
 .S PSBSRCHL="Clinic Search List: "_PSBSRCHL
"RTN","PSBOCM",37,0)
 ;
"RTN","PSBOCM",38,0)
 K PSBSRTBY,PSBCMT,PSBADM,PSBDATA,PSBOUTP,PSBLGD,PSBHDR,PSBSTS
"RTN","PSBOCM",39,0)
 S PSBSORT=1
"RTN","PSBOCM",40,0)
 D NOW^%DTC S (Y,PSBNOWX)=% D DD^%DT S PSBDTTM=$E(Y,1,18)
"RTN","PSBOCM",41,0)
 D GETPAR^PSBPAR("ALL","PSB ADMIN BEFORE")
"RTN","PSBOCM",42,0)
 S PSBB4=0 S:RESULTS(0)>0 PSBB4=+RESULTS(0)
"RTN","PSBOCM",43,0)
 D GETPAR^PSBPAR("ALL","PSB ADMIN AFTER")
"RTN","PSBOCM",44,0)
 S PSBAFT=0 S:RESULTS(0)>0 PSBAFT=+RESULTS(0)
"RTN","PSBOCM",45,0)
 ;change admin window times to 7 days for CO
"RTN","PSBOCM",46,0)
 I PSBCLINORD S (PSBB4,PSBAFT)=7
"RTN","PSBOCM",47,0)
 K ^XTMP("PSBO",$J,"PSBLIST")
"RTN","PSBOCM",48,0)
 S (PSBPGNUM,PSBLNTOT,PSBTOT,PSBX1X)=""
"RTN","PSBOCM",49,0)
 K PSBLIST,PSBLIST2
"RTN","PSBOCM",50,0)
 S PSBXDFN=$P(PSBRPT(.1),U,2)
"RTN","PSBOCM",51,0)
 S PSBLIST(PSBXDFN)=""
"RTN","PSBOCM",52,0)
 S (PSBX1X,PSBTOT)=0
"RTN","PSBOCM",53,0)
 F  S PSBX1X=$O(PSBLIST(PSBX1X)) Q:+PSBX1X=0  D
"RTN","PSBOCM",54,0)
 .D RPC^PSBCSUTL(.PSBAREA,PSBX1X,,,PSBCLINORD)       ;*70
"RTN","PSBOCM",55,0)
 .M PSBDATA=@PSBAREA
"RTN","PSBOCM",56,0)
 .S PSBX2X=1
"RTN","PSBOCM",57,0)
 .S PSBLIST2("ACTIVE")=0,PSBLIST2("FUTURE")=0,PSBLIST2(EXPIREHDG)=0,PSBLIST2(" * ERROR * ")=0
"RTN","PSBOCM",58,0)
 .F  S PSBX2X=$O(PSBDATA(PSBX2X)) Q:+PSBX2X=0  D
"RTN","PSBOCM",59,0)
 ..S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCM",60,0)
 ..I $P(PSBDATA,U)="ORD" D  Q
"RTN","PSBOCM",61,0)
 ...K PSBDRUGN
"RTN","PSBOCM",62,0)
 ...S PSBORDN=$P(PSBDATA,U,3)
"RTN","PSBOCM",63,0)
 ...S PSBCLIN(PSBORDN)=$S($P(PSBDATA,U,32)]"":"Location: ",1:"")_$P(PSBDATA,U,32)                      ;*70
"RTN","PSBOCM",64,0)
 ...S PSBTB=$P(PSBDATA,U,29) S PSBTB=$S(PSBTB=1:"UD",PSBTB=2:"IVPB",PSBTB=3:"IV",1:" * ERROR * ")
"RTN","PSBOCM",65,0)
 ...S PSBTB(PSBORDN,PSBTB)=""
"RTN","PSBOCM",66,0)
 ...S PSBSTS=$P(PSBDATA,U,23) S PSBSTS=$S((PSBSTS="A")&(($P(PSBDATA,U,27)>PSBNOWX)):"Active",PSBSTS="H":"On Hold",PSBSTS="D":"Discontinued",PSBSTS="DE":"Discontinued (Edit)",(PSBSTS="E")!($P(PSBDATA,U,27)'>PSBNOWX):"Expired",1:" * ERROR * ")
"RTN","PSBOCM",67,0)
 ...S PSBSTS(PSBORDN,PSBSTS)=""
"RTN","PSBOCM",68,0)
 ...S STRTDT=$P(PSBDATA,U,22),STOPDT=$P(PSBDATA,U,27)    ;*70
"RTN","PSBOCM",69,0)
 ...S PSBSTSX=$S(STOPDT'>PSBNOWX:EXPIREHDG,$$FMADD^XLFDT(STRTDT,,,-PSBB4)'>PSBNOWX:"ACTIVE",STRTDT>$$FMADD^XLFDT(PSBNOWX,,,PSBB4):"FUTURE",1:" * ERROR * ")        ;*70
"RTN","PSBOCM",70,0)
 ...;
"RTN","PSBOCM",71,0)
 ...S PSBLIST2(PSBSTSX,$P(PSBDATA,U,9),PSBORDN)="" S PSBLIST2(PSBSTSX)=PSBLIST2(PSBSTSX)+1
"RTN","PSBOCM",72,0)
 ...S:PSBOCRIT[$E(PSBSTSX,1) PSBTOT=PSBTOT+1
"RTN","PSBOCM",73,0)
 ...S PSBSCHTY=$P(PSBDATA,U,6)
"RTN","PSBOCM",74,0)
 ...I PSBTB="IV" S PSBSCHTY=" "
"RTN","PSBOCM",75,0)
 ...S PSBSCHTY(PSBORDN,PSBSCHTY)=""
"RTN","PSBOCM",76,0)
 ...S PSBDOSR=$P(PSBDATA,U,10)_", "_$P(PSBDATA,U,11)
"RTN","PSBOCM",77,0)
 ...S PSBDOSR=$TR($E(PSBDOSR,1)," ")_$E(PSBDOSR,2,999)
"RTN","PSBOCM",78,0)
 ...S PSBDOSR(PSBORDN,PSBDOSR)="" K PSBOMDR(PSBORDN)
"RTN","PSBOCM",79,0)
 ...S PSBSCHD=$P(PSBDATA,U,7) I PSBSCHD="" S PSBSCHD=" "
"RTN","PSBOCM",80,0)
 ...S PSBSCHD(PSBORDN,PSBSCHD)=""
"RTN","PSBOCM",81,0)
 ...S PSBNXTX1=$$NEXTADM^PSBCSUTX(PSBX1X,PSBORDN)
"RTN","PSBOCM",82,0)
 ...I PSBSTS["Hold" S PSBNXTX2="Provider Hold"
"RTN","PSBOCM",83,0)
 ...I PSBSTS'["Hold",(PSBNXTX1]"") D
"RTN","PSBOCM",84,0)
 ....I PSBNOWX>$$FMADD^XLFDT(PSBNXTX1,,,PSBAFT) S PSBNXTX2="MISSED "_PSBNXTX1
"RTN","PSBOCM",85,0)
 ....E  S:+PSBNXTX1>0 PSBNXTX2="DUE "_PSBNXTX1
"RTN","PSBOCM",86,0)
 ...S PSBNXTX1=$$FMTDT^PSBOCE1(PSBNXTX1)
"RTN","PSBOCM",87,0)
 ...I ("^P^OC^O"[("^"_PSBSCHTY))!(PSBTB="IV")!(PSBSTS["Discontinued")!(PSBSTS["Expired") S:PSBSTS'["Hold" PSBNXTX2=" "
"RTN","PSBOCM",88,0)
 ...S PSBNXTX(PSBORDN,$G(PSBNXTX2," "))=""
"RTN","PSBOCM",89,0)
 ...; ** SPECIAL INSTRUCTIONS  **
"RTN","PSBOCM",90,0)
 ...S PSBX2X=PSBX2X+1
"RTN","PSBOCM",91,0)
 ...;  *68
"RTN","PSBOCM",92,0)
 ...K ^TMP("PSJBCMA5",$J)
"RTN","PSBOCM",93,0)
 ...I PSBSIFLG D GETSIOPI^PSJBCMA5(PSBX1X,PSBORDN,1)
"RTN","PSBOCM",94,0)
 ...F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,PSBX1X,PSBORDN,QQ)) Q:'QQ  D
"RTN","PSBOCM",95,0)
 ....S PSBSI(PSBORDN,QQ)=^TMP("PSJBCMA5",$J,PSBX1X,PSBORDN,QQ)
"RTN","PSBOCM",96,0)
 ...;  *68 end
"RTN","PSBOCM",97,0)
 ...S PSBOSTDT=$P(PSBDATA,U,22)
"RTN","PSBOCM",98,0)
 ...S PSBOSTDT(PSBORDN,PSBOSTDT)=""
"RTN","PSBOCM",99,0)
 ...S PSBOSPDT=$P(PSBDATA,U,27)
"RTN","PSBOCM",100,0)
 ...S PSBOSPDT(PSBORDN,PSBOSPDT)=""
"RTN","PSBOCM",101,0)
 ..I "^DD^ADD^SOL"[(U_$P(PSBDATA(PSBX2X),U)) D  Q
"RTN","PSBOCM",102,0)
 ...F I=PSBX2X:1 S PSBDATA1=PSBDATA(I) D  Q:$D(PSBOMDR(PSBORDN))
"RTN","PSBOCM",103,0)
 ....I "^DD^ADD^SOL"[(U_$P(PSBDATA1,U)) S PSBX2X=I S PSBDRUGN=$G(PSBDRUGN,"")_$P(PSBDATA1,U,3)_", " Q
"RTN","PSBOCM",104,0)
 ....S $E(PSBDRUGN,$L(PSBDRUGN)-1)="" S PSBDRUGN(PSBORDN,$E(PSBDRUGN,1,250))=PSBDRUGN
"RTN","PSBOCM",105,0)
 ....S PSBOMDR(PSBORDN,$E((PSBDRUGN_"; "_PSBDOSR),1,250))=PSBDRUGN_"; "_PSBDOSR
"RTN","PSBOCM",106,0)
 ..I $P(PSBDATA,U)="END" Q
"RTN","PSBOCM",107,0)
 ..I $P(PSBDATA(PSBX2X),U)="ORF" D  Q
"RTN","PSBOCM",108,0)
 ...S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCM",109,0)
 ...S:$P(PSBDATA,U,2)]"" PSBFLGD(PSBORDN,$P(PSBDATA,U,3)_" - "_$P(PSBDATA,U,4))=""
"RTN","PSBOCM",110,0)
 ..I ($P(PSBDATA,U)="ADM")&($P(PSBDATA,U,4)]"") D
"RTN","PSBOCM",111,0)
 ...S PSBXID=$P(PSBDATA,U,6)_U_$P(PSBDATA,U,4),PSBADM(PSBORDN,(-1*($P(PSBDATA,U,6))),PSBXID)=PSBDATA
"RTN","PSBOCM",112,0)
 ...S PSBTEST="" F  S PSBTEST=$O(PSBFLGD(PSBORDN,PSBTEST)) Q:PSBTEST=""  I $P(PSBTEST,":")="NOX" K PSBFLGD(PSBORDN,PSBTEST) Q
"RTN","PSBOCM",113,0)
 ...I $O(PSBSCHTY(PSBORDN,""))="P" S PSBPRNR(PSBORDN,$P(PSBDATA,U,4))=$P(PSBDATA,U,9)
"RTN","PSBOCM",114,0)
 ...I $P(PSBDATA,U,3)]"" S PSBBID(PSBORDN,$P(PSBDATA,U,4))=$P(PSBDATA,U,3)
"RTN","PSBOCM",115,0)
 ...S:PSBXFLG PSBLGD(PSBORDN,"X","INITIALS",$P(PSBDATA,U,8))=""
"RTN","PSBOCM",116,0)
 ...K PSBDATA(PSBX2X)
"RTN","PSBOCM",117,0)
 ...I ($P(PSBDATA(PSBX2X+1),U)="CMT")  F  S PSBDATA=PSBDATA(PSBX2X+1) Q:($P(PSBDATA,U)'="CMT")  D
"RTN","PSBOCM",118,0)
 ....S PSBX2X=PSBX2X+1
"RTN","PSBOCM",119,0)
 ....S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCM",120,0)
 ....K PSBDATA(PSBX2X)
"RTN","PSBOCM",121,0)
 ....S:$P(PSBDATA,U,3)]"" PSBPRNEF(PSBORDN,$P(PSBXID,U,2))=$P(PSBDATA,U,3)
"RTN","PSBOCM",122,0)
 ....I 'PSBCFLG S PSBDATA=PSBDATA(PSBX2X+1) Q
"RTN","PSBOCM",123,0)
 ....I $P(PSBDATA,U,2)'="" D
"RTN","PSBOCM",124,0)
 .....S PSBLGD(PSBORDN,"C","INITIALS",$P(PSBDATA,U,4))=""
"RTN","PSBOCM",125,0)
 .....S PSBCMT(PSBORDN,$P(PSBXID,U,2),(-1*$P(PSBDATA,U,6)),PSBX2X)=PSBDATA
"RTN","PSBOCM",126,0)
 I +PSBTOT=0 K PSBLIST,^XTMP("PSBO",$J,"PSBLIST")
"RTN","PSBOCM",127,0)
 D CREATHDR^PSBOCM1
"RTN","PSBOCM",128,0)
 D SUBHDR^PSBOCE
"RTN","PSBOCM",129,0)
 D BLDRPT
"RTN","PSBOCM",130,0)
 D WRTRPT^PSBOCM1
"RTN","PSBOCM",131,0)
 K ^TMP("PSJBCMA5",$J)    ;*68
"RTN","PSBOCM",132,0)
 Q
"RTN","PSBOCM",133,0)
BLDRPT ; Buld REPORT DATA
"RTN","PSBOCM",134,0)
 S PSBTOPHD=PSBLNTOT-2
"RTN","PSBOCM",135,0)
 K PSBL2ULN
"RTN","PSBOCM",136,0)
 I '$D(PSBLIST2) D  Q
"RTN","PSBOCM",137,0)
 .S PSBOUTP(0,PSBLNTOT)="W !!,""<<<< NO ORDERS TO DISPLAY >>>>"",!!"
"RTN","PSBOCM",138,0)
 S PSBMORE=5 F PSBX1X="ACTIVE","FUTURE",EXPIREHDG," * ERROR * " D
"RTN","PSBOCM",139,0)
 .I PSBX1X'=" * ERROR * " S PSBSUM=PSBX1X_" ["_PSBLIST2(PSBX1X)_$S(PSBLIST2(PSBX1X)=1:" Order",1:" Orders")_"]" S PSBOUTP($$PGTOT,PSBLNTOT)="W !!,"""_PSBSUM_""""
"RTN","PSBOCM",140,0)
 .Q:PSBLIST2(PSBX1X)=0
"RTN","PSBOCM",141,0)
 .Q:PSBOCRIT'[$E(PSBX1X,1)
"RTN","PSBOCM",142,0)
 .S:$L(PSBSUM)>$G(PSBL2ULN,0) PSBL2ULN=$L(PSBSUM)
"RTN","PSBOCM",143,0)
 .S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBL2ULN),"" "",""=""),!"
"RTN","PSBOCM",144,0)
 .S PSBOUTP($$PGTOT,PSBLNTOT)="W !"
"RTN","PSBOCM",145,0)
 .K PSBDATA
"RTN","PSBOCM",146,0)
 .S X0="",PSBTOT1=0
"RTN","PSBOCM",147,0)
 .F  S X0=$O(PSBLIST2(PSBX1X,X0))  Q:X0=""  S PSBX2X="" F  S PSBX2X=$O(PSBLIST2(PSBX1X,X0,PSBX2X)) Q:PSBX2X=""  D
"RTN","PSBOCM",148,0)
 ..M PSBLGD("INITIALS")=PSBLGD(PSBX2X,"X","INITIALS") M PSBLGD("INITIALS")=PSBLGD(PSBX2X,"C","INITIALS")
"RTN","PSBOCM",149,0)
 ..S PSBDATA(1,1)=$O(PSBTB(PSBX2X,""))
"RTN","PSBOCM",150,0)
 ..S PSBDATA(1,2)=$O(PSBSTS(PSBX2X,""))
"RTN","PSBOCM",151,0)
 ..S PSBDATA(1,3)=$O(PSBSCHTY(PSBX2X,""))
"RTN","PSBOCM",152,0)
 ..S Y0=$O(PSBOMDR(PSBX2X,"")) I Y0]"" S PSBDATA(1,4)="("_X0_")",PSBDATA(1,4,0)=PSBOMDR(PSBX2X,Y0)
"RTN","PSBOCM",153,0)
 ..S PSBDATA(1,5)=$O(PSBSCHD(PSBX2X,""))
"RTN","PSBOCM",154,0)
 ..S PSBDATA(1,6)=$O(PSBNXTX(PSBX2X,""))
"RTN","PSBOCM",155,0)
 ..S:PSBDATA(1,6)'["Hold" $P(PSBDATA(1,6)," ",2)=$$FMTDT^PSBOCE1($P(PSBDATA(1,6)," ",2))
"RTN","PSBOCM",156,0)
 ..S PSBDATA(1,7)=$$FMTDT^PSBOCE1($O(PSBOSTDT(PSBX2X,"")))
"RTN","PSBOCM",157,0)
 ..S PSBDATA(1,8)=$$FMTDT^PSBOCE1($E($O(PSBOSPDT(PSBX2X,"")),1,12))
"RTN","PSBOCM",158,0)
 ..K PSBSIDAT M PSBSIDAT=PSBSI(PSBX2X)               ;*68
"RTN","PSBOCM",159,0)
 ..S PSBTOT1=PSBTOT1+1
"RTN","PSBOCM",160,0)
 ..K PSBDATA(2),PSBDATA(3),PSBSILN
"RTN","PSBOCM",161,0)
 ..D BUILDLN^PSBOCM1,SIOPI(.PSBSIDAT,PSBTAB8,$S(PSBX2X["V":"Other Print Info: ",1:""))
"RTN","PSBOCM",162,0)
 ..I $D(PSBRPLN) S PSBMORE=$O(PSBRPLN(""),-1)+6 I $D(PSBSILN) S PSBMORE=PSBMORE+$O(PSBSILN(""),-1)
"RTN","PSBOCM",163,0)
 ..K PSB1,X I $D(PSBFLGD(PSBX2X)) S PSB="" F  S PSB=$O(PSBFLGD(PSBX2X,PSB)) Q:PSB=""  I ($P(PSB,":")'="NOX")&($P(PSB,":")'="STAT") S PSB1=$G(PSB1,"")_PSB
"RTN","PSBOCM",164,0)
 ..;*70 build write clinic stmt      
"RTN","PSBOCM",165,0)
 ..S PSBOUTP($$PGTOT,PSBLNTOT)="W """_$G(PSBCLIN(PSBX2X))_""""_",!"
"RTN","PSBOCM",166,0)
 ..S PSBCNT=PSBTOT1_"   "_$G(PSB1,"")
"RTN","PSBOCM",167,0)
 ..S PSBOUTP($$PGTOT,PSBLNTOT)="W """_PSBCNT_""""
"RTN","PSBOCM",168,0)
 ..S I="" F  S I=$O(PSBRPLN(I)) Q:+I=0  D
"RTN","PSBOCM",169,0)
 ...S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBRPLN(I)_""""
"RTN","PSBOCM",170,0)
 ..S I="" F  S I=$O(PSBSILN(I)) Q:+I=0  D
"RTN","PSBOCM",171,0)
 ...S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBSILN(I)_""""
"RTN","PSBOCM",172,0)
 ..S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBTAB8),"" "",""-""),!"
"RTN","PSBOCM",173,0)
 ..K PSBRPLN,PSBDATA,PSBSILN
"RTN","PSBOCM",174,0)
 D:+PSBTOT>0 LGD
"RTN","PSBOCM",175,0)
 Q
"RTN","PSBOCM",176,0)
PGTOT(X) ;mnt PAGE Number
"RTN","PSBOCM",177,0)
 I (PSBLNTOT+PSBMORE)>(IOSL) D PGC^PSBOCE1
"RTN","PSBOCM",178,0)
 I $G(X,1) S PSBLNTOT=PSBLNTOT+$G(X,1),PSBMORE=PSBMORE-$G(X,1)
"RTN","PSBOCM",179,0)
 Q PSBPGNUM
"RTN","PSBOCM",180,0)
SIOPI(PSBXSI,TAB,Y) ;create SIOPI text
"RTN","PSBOCM",181,0)
 ;  *68 - modified this tag to handle only WP extra lines
"RTN","PSBOCM",182,0)
 I '$P(PSBRPT(4),U) Q   ;[*70-1512]
"RTN","PSBOCM",183,0)
 Q:$O(PSBXSI(""))=""
"RTN","PSBOCM",184,0)
 ;
"RTN","PSBOCM",185,0)
 N X,LBL,LBLLN,RMAR,TXT
"RTN","PSBOCM",186,0)
 I $G(Y)="" S Y="Special Instructions: "
"RTN","PSBOCM",187,0)
 ; build label for SI field, then check $L to make a right margin
"RTN","PSBOCM",188,0)
 S LBL="  "_Y
"RTN","PSBOCM",189,0)
 S LBLLN=$L(LBL),RMAR="",$P(RMAR," ",LBLLN+1)=""  ;make margin of " "
"RTN","PSBOCM",190,0)
 K J,TXT,TXT1,TXT2 S J(0)=""
"RTN","PSBOCM",191,0)
 S J=($O(J(""),-1)+1) S PSBSILN(J)="",J(J)="" S J=($O(J(""),-1)+1)
"RTN","PSBOCM",192,0)
 F X=0:0 S X=$O(PSBXSI(X)) Q:'X  D
"RTN","PSBOCM",193,0)
 .I X=1 S TXT=LBL_PSBXSI(X)    ;put label & 1st line together
"RTN","PSBOCM",194,0)
 .E  S TXT=RMAR_PSBXSI(X)      ;all other lines add rmar
"RTN","PSBOCM",195,0)
 .S TXT1=TXT
"RTN","PSBOCM",196,0)
 .I ($L(TXT1)>0),$F(TXT1,"""")>1 D
"RTN","PSBOCM",197,0)
 ..S TXT1=$TR(TXT1,"""","^")
"RTN","PSBOCM",198,0)
 ..I $L(TXT1)+5'<TAB S TXT2=$E(TXT1,TAB-9,999),TXT1=$E(TXT1,1,TAB-10)
"RTN","PSBOCM",199,0)
 ..I $L(TXT1,"^")>1 F Y=1:1:$L(TXT1,"^")-1 S $P(TXT1,"^",Y)=$P(TXT1,"^",Y)_""""
"RTN","PSBOCM",200,0)
 ..I $D(TXT2) I $L(TXT2,"^")>1 F X=1:1:$L(TXT2,"^")-1 S $P(TXT2,"^",X)=$P(TXT2,"^",X)_""""
"RTN","PSBOCM",201,0)
 ..S TXT1=$TR(TXT1,"^","""") I $D(TXT2) S TXT2=$TR(TXT2,"^","""")
"RTN","PSBOCM",202,0)
 .S $E(PSBSILN(J),5,999)=TXT1,J(J)="",J=J+1
"RTN","PSBOCM",203,0)
 .I $D(TXT2) S $E(PSBSILN(J),5,999)=TXT2,J(J)="",J=J+1
"RTN","PSBOCM",204,0)
 S $E(PSBSILN(J),3,999)=" ",J(J)="",J=J+1
"RTN","PSBOCM",205,0)
 Q
"RTN","PSBOCM",206,0)
LGD ; Create Report's Legend
"RTN","PSBOCM",207,0)
 K PSBLGDO
"RTN","PSBOCM",208,0)
 S PSBLGD("ORDER TYPES","C")="Continuous"
"RTN","PSBOCM",209,0)
 S PSBLGD("ORDER TYPES","O")="One Time"
"RTN","PSBOCM",210,0)
 S PSBLGD("ORDER TYPES","OC")="On Call"
"RTN","PSBOCM",211,0)
 S PSBLGD("ORDER TYPES","P")="PRN"
"RTN","PSBOCM",212,0)
 S PSB=0 F  S PSB=$O(PSBLGD("INITIALS",PSB)) Q:+PSB=0  D
"RTN","PSBOCM",213,0)
 .S PSBINIT=$$GET1^DIQ(200,PSB_",","INITIAL"),PSBLGD("INITIALS",$S(PSBINIT']" ":"*n/a*",1:PSBINIT))=$$GET1^DIQ(200,PSB_",","NAME")
"RTN","PSBOCM",214,0)
 .K PSBLGD("INITIALS",PSB)
"RTN","PSBOCM",215,0)
 S PSBPGNUM=$O(PSBOUTP(""),-1),PSBLGDO(0)="REPORT LEGEND"
"RTN","PSBOCM",216,0)
 S PSBLGDO(1)=""
"RTN","PSBOCM",217,0)
 S PSBLGDO(2)=$S($G(PSBNO,0):"",1:"SCHEDULE TYPES")
"RTN","PSBOCM",218,0)
 S PSBLGDO(3)=""
"RTN","PSBOCM",219,0)
 I '$G(PSBNO,0) S X1="",X2=3 F  S X1=$O(PSBLGD("ORDER TYPES",X1)) Q:X1=""  S X2=X2+1,PSBLGDO(X2)=X1,$E(PSBLGDO(X2),5)="- "_PSBLGD("ORDER TYPES",X1)
"RTN","PSBOCM",220,0)
 I $D(PSBLGD("INITIALS")) S $E(PSBLGDO(2),35)="INITIALS" S X1="",X2=3 F  S X1=$O(PSBLGD("INITIALS",X1)) Q:X1=""  S X2=X2+1,$E(PSBLGDO(X2),35)=X1,$E(PSBLGDO(X2),40)="- "_PSBLGD("INITIALS",X1)
"RTN","PSBOCM",221,0)
 S (PSBMORE,X0)=10+($O(PSBLGDO(""),-1))
"RTN","PSBOCM",222,0)
 I (PSBLNTOT+PSBMORE)'<IOSL S PSBLNTOT=PSBTOPHD-2,PSBPGNUM=PSBPGNUM+1
"RTN","PSBOCM",223,0)
 I IOSL<1000 S X2=PSBLNTOT F  Q:X2'<(IOSL-(X0+3))  S PSBOUTP($$PGTOT,PSBLNTOT)="W !",X2=X2+1
"RTN","PSBOCM",224,0)
 S PSBMORE=X0
"RTN","PSBOCM",225,0)
 S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,"""_$TR($J("",IOM)," ","=")_""",!"
"RTN","PSBOCM",226,0)
 F X1=0:1 Q:'$D(PSBLGDO(X1))  S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_$G(PSBLGDO(X1)," ")_""""
"RTN","PSBOCM",227,0)
 S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,"""_$TR($J("",IOM)," ","=")_""",!"
"RTN","PSBOCM",228,0)
 Q
"RTN","PSBOCM1")
0^34^B23772218^B22801470
"RTN","PSBOCM1",1,0)
PSBOCM1 ;BIRMINGHAM/TEJ-COVERSHEET MEDICATION OVERVIEW REPORT ;9/18/12 1:53am
"RTN","PSBOCM1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**32,50,70**;Mar 2004;Build 101
"RTN","PSBOCM1",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOCM1",4,0)
 ;
"RTN","PSBOCM1",5,0)
 ;*70 - add new header line for clinic search list
"RTN","PSBOCM1",6,0)
 ;
"RTN","PSBOCM1",7,0)
BUILDLN ; Constr recs
"RTN","PSBOCM1",8,0)
 K J S J(0)="" F PSBFLD=1:1:8 S J=1 D FORMDAT(PSBFLD) S J($O(PSBRPLN(""),-1))=""
"RTN","PSBOCM1",9,0)
 ; Write administration info...
"RTN","PSBOCM1",10,0)
 Q:'PSBXFLG
"RTN","PSBOCM1",11,0)
 S J=($O(J(""),-1)+1),PSBRPLN(J)=PSBBLANK,J(J)="",J=J+1
"RTN","PSBOCM1",12,0)
 S (N,Y)="",J=($O(J(""),-1)+1)
"RTN","PSBOCM1",13,0)
 F  S Y=$O(PSBADM(PSBX2X,Y)) Q:Y']""  D
"RTN","PSBOCM1",14,0)
 .F  S N=$O(PSBADM(PSBX2X,Y,N)) Q:N']""  D
"RTN","PSBOCM1",15,0)
 ..I $D(PSBBID(PSBX2X,$P(N,U,2))) S PSBDATA(2,0)="BAG ID: "_PSBBID(PSBX2X,$P(N,U,2))
"RTN","PSBOCM1",16,0)
 ..S $E(PSBDATA(2,0),25)="ACTION BY: "_$P(PSBADM(PSBX2X,Y,N),U,7)_" "_$$FMTDT^PSBOCE1($E($P(PSBADM(PSBX2X,Y,N),U,6),1,12))
"RTN","PSBOCM1",17,0)
 ..S X=$P(PSBADM(PSBX2X,Y,N),U,5) S $E(PSBDATA(2,0),56)="ACTION: "_$S(X="G":"GIVEN",X="R":"REFUSED",X="RM":"REMOVED",X="H":"HELD",X="S":"STOPPED",X="I":"INFUSING",X="C":"COMPLETED",X="M":"MISSING DOSE",X=" ":"*UNKNOWN*",1:" ")
"RTN","PSBOCM1",18,0)
 ..I $D(PSBPRNR(PSBX2X)) S $E(PSBDATA(2,0),72)="PRN REASON: "_PSBPRNR(PSBX2X,$P(N,U,2))
"RTN","PSBOCM1",19,0)
 ..I $G(PSBDATA(2,0))]" " D WRAPPER(1,132-1,PSBDATA(2,0)) K PSBDATA(2) S J=J+1
"RTN","PSBOCM1",20,0)
 ..N PSBEIECMT S PSBEIECMT="" I $D(PSBPRNEF(PSBX2X,$P(N,U,2))),$P($G(PSBRPT(.2)),U,8)=0 S PSBEIECMT=$$PRNEFF^PSBO(PSBEIECMT,$P(N,U,2))
"RTN","PSBOCM1",21,0)
 ..I $D(PSBPRNEF(PSBX2X,$P(N,U,2))) S PSBDATA(2,0)="PRN EFFECTIVENESS: "_PSBPRNEF(PSBX2X,$P(N,U,2))_PSBEIECMT
"RTN","PSBOCM1",22,0)
 ..I $G(PSBDATA(2,0))]" " D WRAPPER(30,132-30,PSBDATA(2,0)) K PSBDATA(2) S J=J+1
"RTN","PSBOCM1",23,0)
 ..I ('PSBCFLG)!('$D(PSBCMT(PSBX2X,$P(N,U,2)))) S PSBRPLN(J)=PSBBLANK,J(J)="",J=J+1 Q
"RTN","PSBOCM1",24,0)
 ..S X="" F   S X=$O(PSBCMT(PSBX2X,$P(N,U,2),X)) Q:X']""  D
"RTN","PSBOCM1",25,0)
 ...N PSBDAT S PSBDAT="" F  S PSBDAT=$O(PSBCMT(PSBX2X,$P(N,U,2),X,PSBDAT)) Q:PSBDAT']""  D
"RTN","PSBOCM1",26,0)
 ....S PSBDATA(2,0)="COMMENT BY: "_$S($P(PSBCMT(PSBX2X,$P(N,U,2),X,PSBDAT),U,5)]"":$P(PSBCMT(PSBX2X,$P(N,U,2),X,PSBDAT),U,5)_" "_$$FMTDT^PSBOCE1($E($P(PSBCMT(PSBX2X,$P(N,U,2),X,PSBDAT),U,6),1,12)),1:" n/a ")
"RTN","PSBOCM1",27,0)
 ....S PSBDATA(2,0)=PSBDATA(2,0)_"  COMMENT: "_$S($P(PSBCMT(PSBX2X,$P(N,U,2),X,PSBDAT),U,2)]"":$P(PSBCMT(PSBX2X,$P(N,U,2),X,PSBDAT),U,2),1:" ")
"RTN","PSBOCM1",28,0)
 ....I $G(PSBDATA(2,0))]" " D WRAPPER(30,132-30,PSBDATA(2,0)) K PSBDATA(2) S J=J+1
"RTN","PSBOCM1",29,0)
 ..S PSBRPLN(J)=PSBBLANK,J(J)="",J=J+1
"RTN","PSBOCM1",30,0)
 Q
"RTN","PSBOCM1",31,0)
FORMDAT(FLD) ;
"RTN","PSBOCM1",32,0)
 K PSBVAL
"RTN","PSBOCM1",33,0)
 Q:'$D(PSBDATA(1,FLD))
"RTN","PSBOCM1",34,0)
 S PSBVAL=PSBDATA(1,FLD)
"RTN","PSBOCM1",35,0)
 D WRAPPER(@("PSBTAB"_(FLD-1))+1,((@("PSBTAB"_(FLD))-(@("PSBTAB"_(FLD-1))+1))),PSBVAL)
"RTN","PSBOCM1",36,0)
 I FLD=4 S J=$O(J(""),-1)+1,PSBVAL=PSBDATA(1,4,0) D WRAPPER(@("PSBTAB"_(FLD-1))+1,((@("PSBTAB"_(FLD))-(@("PSBTAB"_(FLD-1))+1))),PSBVAL)
"RTN","PSBOCM1",37,0)
 Q
"RTN","PSBOCM1",38,0)
WRAPPER(X,Y,Z) ;  Text WRAP
"RTN","PSBOCM1",39,0)
 N PSB
"RTN","PSBOCM1",40,0)
 I ($L(Z)>0),$F(Z,"""")>1 F  Q:$F(Z,"""")'>1  S Z=$TR(Z,"""","^")
"RTN","PSBOCM1",41,0)
 F  Q:'$L(Z)  D
"RTN","PSBOCM1",42,0)
 .I $L(Z)<Y S $E(PSBRPLN(J),X)=Z S Z="" D  Q
"RTN","PSBOCM1",43,0)
 ..I $L(PSBRPLN(J),"^")>1 F X=1:1:$L(PSBRPLN(J),"^")-1 S $P(PSBRPLN(J),"^",X)=$P(PSBRPLN(J),"^",X)_""""
"RTN","PSBOCM1",44,0)
 ..S PSBRPLN(J)=$TR(PSBRPLN(J),"^","""")
"RTN","PSBOCM1",45,0)
 .F PSB=Y:-1:0 Q:($E(Z,PSB)=" ")  Q:($E(Z,PSB)="-")
"RTN","PSBOCM1",46,0)
 .S:PSB<1 PSB=Y
"RTN","PSBOCM1",47,0)
 .S $E(PSBRPLN(J),X)=$E(Z,1,PSB)
"RTN","PSBOCM1",48,0)
 .S Z=$E(Z,PSB+1,250)
"RTN","PSBOCM1",49,0)
 .I $L(PSBRPLN(J),"^")>1 F X=1:1:$L(PSBRPLN(J),"^")-1 S $P(PSBRPLN(J),"^",X)=$P(PSBRPLN(J),"^",X)_""""
"RTN","PSBOCM1",50,0)
 .S PSBRPLN(J)=$TR(PSBRPLN(J),"^","""")
"RTN","PSBOCM1",51,0)
 .S J=J+1,J(J)=""
"RTN","PSBOCM1",52,0)
 Q ""
"RTN","PSBOCM1",53,0)
CREATHDR ;
"RTN","PSBOCM1",54,0)
 K PSBHD1,PSBHD2
"RTN","PSBOCM1",55,0)
 I IOM'<132 S PSBHD1=$P($T(HD132A),"~",2),PSBHD2=$P($T(HD132B),";",2),PSBBLANK=$P($T(C132BLK),";",2)
"RTN","PSBOCM1",56,0)
 E  S PSBHD1="THIS REPORT SUPPORTS >131 CHAR./LINE PRINT FORMATS ONLY" Q
"RTN","PSBOCM1",57,0)
 ; reset tabs
"RTN","PSBOCM1",58,0)
 S PSBTAB0=1 F PSBI=0:1:($L(PSBHD1,"|")-1) S:PSBI>0 @("PSBTAB"_PSBI)=($F(PSBHD1,"|",@("PSBTAB"_(PSBI-1))+1))-1
"RTN","PSBOCM1",59,0)
 S PSBPGNUM=1
"RTN","PSBOCM1",60,0)
 D HDR
"RTN","PSBOCM1",61,0)
 Q
"RTN","PSBOCM1",62,0)
HD132A ;~VDL  |   Order    |Type|       Medication; Dosage, Route      |  Schedule   |      Next Action      |  Order Start  |   Order Stop  |
"RTN","PSBOCM1",63,0)
 Q
"RTN","PSBOCM1",64,0)
HD132B ;Tab  |   Status   |    |                                      |             |                       |   Date        |    Date       |
"RTN","PSBOCM1",65,0)
 Q
"RTN","PSBOCM1",66,0)
C132BLK ;;
"RTN","PSBOCM1",67,0)
 Q
"RTN","PSBOCM1",68,0)
WRTRPT ;  writ
"RTN","PSBOCM1",69,0)
 I $O(PSBOUTP(""),-1)<1 D  Q
"RTN","PSBOCM1",70,0)
 .X PSBOUTP($O(PSBOUTP(""),-1),14)
"RTN","PSBOCM1",71,0)
 .D FTR
"RTN","PSBOCM1",72,0)
 S PSBPGNUM=1
"RTN","PSBOCM1",73,0)
 S PSBZ="" F  S PSBZ=$O(PSBOUTP(PSBZ)) Q:PSBZ=""  D
"RTN","PSBOCM1",74,0)
 .I PSBPGNUM'=PSBZ D FTR S PSBPGNUM=PSBZ D HDR,SUBHDR^PSBOCE
"RTN","PSBOCM1",75,0)
 .S PSBX2X="" F  S PSBX2X=$O(PSBOUTP(PSBZ,PSBX2X)) Q:PSBX2X=""  D
"RTN","PSBOCM1",76,0)
 ..X PSBOUTP(PSBZ,PSBX2X)
"RTN","PSBOCM1",77,0)
 D FTR
"RTN","PSBOCM1",78,0)
 K ^XTMP("PSBO",$J,"PSBLIST"),PSBOUTP
"RTN","PSBOCM1",79,0)
 Q
"RTN","PSBOCM1",80,0)
HDR ;  Header
"RTN","PSBOCM1",81,0)
 W:$Y>1 @IOF
"RTN","PSBOCM1",82,0)
 W:$X>1 !
"RTN","PSBOCM1",83,0)
 S PSBRPNM="BCMA COVERSHEET MEDICATION OVERVIEW REPORT"
"RTN","PSBOCM1",84,0)
 D:$P(PSBRPT(.1),U,1)="P"
"RTN","PSBOCM1",85,0)
 .S PSBHDR(0)=PSBRPNM
"RTN","PSBOCM1",86,0)
 .S PSBHDR(1)="Order Status(es): --"
"RTN","PSBOCM1",87,0)
 .F Y=4,5,7,8 I $P(PSBFUTR,U,Y) S $P(PSBHDR(1),": ",2)=$P(PSBHDR(1),": ",2)_$S(PSBHDR(1)["--":"",1:"/ ")_$P("^^^Future^Active^^Expired^DC'd^^^^^^^^^^",U,Y)_" " S PSBHDR(1)=$TR(PSBHDR(1),"-","")
"RTN","PSBOCM1",88,0)
 .I $P(PSBFUTR,U,11) S PSBHDR(2)="Include Action(s)"_$S(PSBCFLG:" & Comments/Reasons",1:"")
"RTN","PSBOCM1",89,0)
 .S:$G(PSBSRCHL)]"" PSBHDR(3)="",PSBHDR(4)=PSBSRCHL           ;*70
"RTN","PSBOCM1",90,0)
 .D PT^PSBOHDR(PSBXDFN,.PSBHDR)
"RTN","PSBOCM1",91,0)
 Q
"RTN","PSBOCM1",92,0)
FTR ;  Fter
"RTN","PSBOCM1",93,0)
 D PTFTR^PSBOHDR()
"RTN","PSBOCM1",94,0)
 S PSBPG="Page: "_PSBPGNUM_" of "_$S($O(PSBOUTP(""),-1)=0:1,1:$O(PSBOUTP(""),-1))
"RTN","PSBOCM1",95,0)
 S PSBPGRM=PSBTAB8-($L(PSBPG))
"RTN","PSBOCM1",96,0)
 W !,PSBRPNM,"     ",?(PSBPGRM-($L(PSBDTTM)+3)),PSBDTTM_"  "_PSBPG
"RTN","PSBOCM1",97,0)
 Q
"RTN","PSBOCP")
0^31^B95743984^B82953642
"RTN","PSBOCP",1,0)
PSBOCP ;BIRMINGHAM/TEJ-COVERSHEET PRN OVERVIEW REPORT ;3/19/13 19:13pm
"RTN","PSBOCP",2,0)
 ;;3.0;BAR CODE MED ADMIN;**32,50,68,70**;Mar 2004;Build 101
"RTN","PSBOCP",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOCP",4,0)
 ;
"RTN","PSBOCP",5,0)
 ; Reference/IA
"RTN","PSBOCP",6,0)
 ; File 4/10090
"RTN","PSBOCP",7,0)
 ; GETSIOPI^PSJBCMA5/5763
"RTN","PSBOCP",8,0)
 ;
"RTN","PSBOCP",9,0)
 ;*68 - allow SIOPI builder to accomodate more than 1 line in SI array
"RTN","PSBOCP",10,0)
 ;*70 - pass global var PSBCLINORD when Rpc Psbcsutl is called again
"RTN","PSBOCP",11,0)
 ;    - add clinic name to new array PSBCLIN to track clinic name per 
"RTN","PSBOCP",12,0)
 ;       order for printed output. set CO admin window to 7 days +/-.
"RTN","PSBOCP",13,0)
 ;
"RTN","PSBOCP",14,0)
EN ; Entry Point
"RTN","PSBOCP",15,0)
 N PSBX1X,RESULTS,RESULT,PSBFUTR,QQ,PSBSRCHL,PSBHDR,STRTDT,STOPDT,EXPIREHDG,PSBCLIN     ;*70
"RTN","PSBOCP",16,0)
 S PSBFUTR=$TR(PSBRPT(1),"~","^")
"RTN","PSBOCP",17,0)
 S (PSBOCRIT,PSBXFLG,PSBCFLG)=""        ;  Order Status search criteria - "A"ctive, "D"C ed, "E"xpired"
"RTN","PSBOCP",18,0)
 S:$P(PSBFUTR,U,7) PSBOCRIT=PSBOCRIT_"D" S:$P(PSBFUTR,U,8) PSBOCRIT=PSBOCRIT_"E" S:$P(PSBFUTR,U,5) PSBOCRIT=PSBOCRIT_"A"
"RTN","PSBOCP",19,0)
 S:$P(PSBFUTR,U,4) PSBOCRIT=PSBOCRIT_"F"
"RTN","PSBOCP",20,0)
 S:$P(PSBFUTR,U,11) PSBXFLG=1
"RTN","PSBOCP",21,0)
 I $D(PSBRPT(.2)) I $P(PSBRPT(.2),U,8) S PSBCFLG=1
"RTN","PSBOCP",22,0)
 S PSBCLINORD=$S($P($G(PSBRPT(4)),U,2)="C":1,1:0)                 ;*70
"RTN","PSBOCP",23,0)
 ;add ability to use a different heading for expired IM/CO meds   ;*70
"RTN","PSBOCP",24,0)
 S EXPIREHDG=$S(PSBCLINORD:"EXPIRED/DC'd within last 7 days",1:"EXPIRED/DC'd")
"RTN","PSBOCP",25,0)
 ;check Clinic search list                                        ;*70
"RTN","PSBOCP",26,0)
 S PSBSRCHL=$$SRCHLIST^PSBOHDR()
"RTN","PSBOCP",27,0)
 D:$P(PSBRPT(4),U,2)="C"
"RTN","PSBOCP",28,0)
 .S:PSBSRCHL="" PSBSRCHL="All Clinics"
"RTN","PSBOCP",29,0)
 .S PSBSRCHL="Clinic Search List: "_PSBSRCHL
"RTN","PSBOCP",30,0)
 ;
"RTN","PSBOCP",31,0)
 K PSBSRTBY,PSBCMT,PSBADM,PSBDATA,PSBOUTP,PSBLGD
"RTN","PSBOCP",32,0)
 S PSBSORT=1
"RTN","PSBOCP",33,0)
 D NOW^%DTC S (Y,PSBNOWX)=% D DD^%DT S PSBDTTM=Y
"RTN","PSBOCP",34,0)
 D GETPAR^PSBPAR("ALL","PSB ADMIN BEFORE")
"RTN","PSBOCP",35,0)
 S PSBB4=0 S:RESULTS(0)>0 PSBB4=+RESULTS(0)
"RTN","PSBOCP",36,0)
 D GETPAR^PSBPAR("ALL","PSB ADMIN AFTER")
"RTN","PSBOCP",37,0)
 S PSBAFT=0 S:RESULTS(0)>0 PSBAFT=+RESULTS(0)
"RTN","PSBOCP",38,0)
 ;change admin window times to 7 days for CO                      ;*70
"RTN","PSBOCP",39,0)
 I PSBCLINORD S (PSBB4,PSBAFT)=7
"RTN","PSBOCP",40,0)
 K ^XTMP("PSBO",$J,"PSBLIST")
"RTN","PSBOCP",41,0)
 S (PSBPGNUM,PSBLNTOT,PSBTOT,PSBX1X)=""
"RTN","PSBOCP",42,0)
 K PSBLIST,PSBLIST2
"RTN","PSBOCP",43,0)
 S PSBXDFN=$P(PSBRPT(.1),U,2)
"RTN","PSBOCP",44,0)
 S PSBLIST(PSBXDFN)=""
"RTN","PSBOCP",45,0)
 S (PSBX1X,PSBTOT)=0
"RTN","PSBOCP",46,0)
 F  S PSBX1X=$O(PSBLIST(PSBX1X)) Q:+PSBX1X=0  D
"RTN","PSBOCP",47,0)
 .D RPC^PSBCSUTL(.PSBAREA,PSBX1X,,,PSBCLINORD)                    ;*70
"RTN","PSBOCP",48,0)
 .M PSBDATA=@PSBAREA
"RTN","PSBOCP",49,0)
 .S PSBX2X=1
"RTN","PSBOCP",50,0)
 .S (PSBLIST2("ACTIVE"),PSBLIST2("FUTURE"),PSBLIST2(EXPIREHDG),PSBLIST2(" * ERROR * "))=0
"RTN","PSBOCP",51,0)
 .F  S PSBX2X=$O(PSBDATA(PSBX2X)) Q:+PSBX2X=0  D
"RTN","PSBOCP",52,0)
 ..S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCP",53,0)
 ..I ($P(PSBDATA,U)="ORD") I $P(PSBDATA,U,6)'="P" F  S PSBX2X=$O(PSBDATA(PSBX2X)) S PSBDATA=PSBDATA(PSBX2X) Q:$P(PSBDATA,U)="END"
"RTN","PSBOCP",54,0)
 ..I ($P(PSBDATA,U)="ORD") K PSBORDN  D  Q
"RTN","PSBOCP",55,0)
 ...K PSBDRUGN
"RTN","PSBOCP",56,0)
 ...S PSBSCHTY="P"
"RTN","PSBOCP",57,0)
 ...S PSBORDN=$P(PSBDATA,U,3)
"RTN","PSBOCP",58,0)
 ...S PSBCLIN(PSBORDN)=$S($P(PSBDATA,U,32)]"":"Location: ",1:"")_$P(PSBDATA,U,32)             ;*70
"RTN","PSBOCP",59,0)
 ...S PSBTB=$P(PSBDATA,U,29) S PSBTB=$S(PSBTB=1:"UD",PSBTB=2:"IVPB",PSBTB=3:"IV",1:" * ERROR * ")
"RTN","PSBOCP",60,0)
 ...S PSBTB(PSBORDN,PSBTB)=""
"RTN","PSBOCP",61,0)
 ...S PSBSTS1=$P(PSBDATA,U,23)
"RTN","PSBOCP",62,0)
 ...S STRTDT=$P(PSBDATA,U,22),STOPDT=$P(PSBDATA,U,27)             ;*70
"RTN","PSBOCP",63,0)
 ...S PSBSTS=$S((PSBSTS1="A")&(STOPDT>PSBNOWX):"Active",PSBSTS1="H":"Hold",PSBSTS1="D":"Discontinued",PSBSTS1="DE":"Discontinued (Edit)",(PSBSTS1="E")!(STOPDT'>PSBNOWX):"Expired",1:" * ERROR * ")
"RTN","PSBOCP",64,0)
 ...S PSBSTS(PSBORDN,PSBSTS)=""
"RTN","PSBOCP",65,0)
 ...S V=$$FMADD^XLFDT(PSBNOWX,,,PSBB4)
"RTN","PSBOCP",66,0)
 ...S PSBSTSX=$S(STOPDT'>PSBNOWX:EXPIREHDG,STRTDT'>V:"ACTIVE",V:"FUTURE",1:" * ERROR * ")
"RTN","PSBOCP",67,0)
 ...S PSBLIST2(PSBSTSX,$P(PSBDATA,U,9),PSBORDN)=$P(PSBDATA,U,32) S PSBLIST2(PSBSTSX)=PSBLIST2(PSBSTSX)+1   ;*70 clin name
"RTN","PSBOCP",68,0)
 ...S:PSBOCRIT[$E(PSBSTSX,1) PSBTOT=PSBTOT+1
"RTN","PSBOCP",69,0)
 ...S PSBSCHTY(PSBORDN,PSBSCHTY)=""
"RTN","PSBOCP",70,0)
 ...S PSBDOSR=$P(PSBDATA,U,10)_", "_$P(PSBDATA,U,11)
"RTN","PSBOCP",71,0)
 ...S PSBDOSR=$TR($E(PSBDOSR,1)," ")_$E(PSBDOSR,2,999)
"RTN","PSBOCP",72,0)
 ...S PSBDOSR(PSBORDN,PSBDOSR)=""
"RTN","PSBOCP",73,0)
 ...S PSBLSTG=$P(PSBDATA,U,28)
"RTN","PSBOCP",74,0)
 ...I PSBLSTG]"" S PSBLSTG(PSBORDN,$$FMTDT^PSBOCE1($E(PSBLSTG,1,12)))=""
"RTN","PSBOCP",75,0)
 ...S PSBLSTX=$S(PSBLSTG]"":$$LSTX(PSBLSTG,PSBNOWX),1:" ")
"RTN","PSBOCP",76,0)
 ...S PSBLSTX(PSBORDN,PSBLSTX)=""
"RTN","PSBOCP",77,0)
 ...; ** SPECIAL INSTRUCTIONS  **
"RTN","PSBOCP",78,0)
 ...S PSBX2X=PSBX2X+1
"RTN","PSBOCP",79,0)
 ...;  *68
"RTN","PSBOCP",80,0)
 ...K ^TMP("PSJBCMA5",$J)
"RTN","PSBOCP",81,0)
 ...I PSBSIFLG D GETSIOPI^PSJBCMA5(PSBX1X,PSBORDN,1)
"RTN","PSBOCP",82,0)
 ...F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,PSBX1X,PSBORDN,QQ)) Q:'QQ  D
"RTN","PSBOCP",83,0)
 ....S PSBSI(PSBORDN,QQ)=^TMP("PSJBCMA5",$J,PSBX1X,PSBORDN,QQ)
"RTN","PSBOCP",84,0)
 ...;  *68 end
"RTN","PSBOCP",85,0)
 ...S PSBOSTDT=$P(PSBDATA,U,22)
"RTN","PSBOCP",86,0)
 ...S PSBOSTDT(PSBORDN,PSBOSTDT)=""
"RTN","PSBOCP",87,0)
 ...S PSBOSPDT=$P(PSBDATA,U,27)
"RTN","PSBOCP",88,0)
 ...S PSBOSPDT(PSBORDN,PSBOSPDT)=""
"RTN","PSBOCP",89,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCP",90,0)
 ..I "^DD^ADD^SOL"[(U_$P(PSBDATA(PSBX2X),U)) D  Q
"RTN","PSBOCP",91,0)
 ...F I=PSBX2X:1 S PSBDATA1=PSBDATA(I) D  Q:$D(PSBOMDR(PSBORDN))
"RTN","PSBOCP",92,0)
 ....I "^DD^ADD^SOL"[(U_$P(PSBDATA1,U)) S PSBX2X=I S PSBDRUGN=$G(PSBDRUGN,"")_$P(PSBDATA1,U,3)_", " Q
"RTN","PSBOCP",93,0)
 ....S $E(PSBDRUGN,$L(PSBDRUGN)-1)="" S PSBDRUGN(PSBORDN,$E(PSBDRUGN,1,250))=PSBDRUGN
"RTN","PSBOCP",94,0)
 ....S PSBOMDR(PSBORDN,$E((PSBDRUGN_"; "_PSBDOSR),1,250))=PSBDRUGN_"; "_PSBDOSR
"RTN","PSBOCP",95,0)
 ..I $P(PSBDATA,U)="END" Q
"RTN","PSBOCP",96,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCP",97,0)
 ..I $P(PSBDATA(PSBX2X),U)="ORF" D  Q
"RTN","PSBOCP",98,0)
 ...S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCP",99,0)
 ...S:$P(PSBDATA,U,2)]"" PSBFLGD(PSBORDN,$P(PSBDATA,U,3)_" - "_$P(PSBDATA,U,4))=""
"RTN","PSBOCP",100,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCP",101,0)
 ..I ($P(PSBDATA,U)="ADM")&($P(PSBDATA,U,4)]"") D  Q
"RTN","PSBOCP",102,0)
 ...S PSBXID=$P(PSBDATA,U,6)_U_$P(PSBDATA,U,4),PSBADM(PSBORDN,(-1*($P(PSBDATA,U,6))),PSBXID)=PSBDATA
"RTN","PSBOCP",103,0)
 ...I $O(PSBSCHTY(PSBORDN,""))="P" S PSBPRNR(PSBORDN,$P(PSBDATA,U,4))=$P(PSBDATA,U,9)
"RTN","PSBOCP",104,0)
 ...I $P(PSBDATA,U,3)]"" S PSBBID(PSBORDN,$P(PSBDATA,U,4))=$P(PSBDATA,U,3)
"RTN","PSBOCP",105,0)
 ...S:PSBXFLG PSBLGD(PSBORDN,"X","INITIALS",$P(PSBDATA,U,8))=""
"RTN","PSBOCP",106,0)
 ...I $P(PSBDATA(PSBX2X+1),U)="CMT"  S PSBX2X=PSBX2X+1 F PSBX3X=PSBX2X:1 S PSBDATA=PSBDATA(PSBX3X) Q:($P(PSBDATA,U)'="CMT")  D
"RTN","PSBOCP",107,0)
 ....S PSBX2X=PSBX3X
"RTN","PSBOCP",108,0)
 ....I $P(PSBDATA,U,3)]"" S PSBPRNEF(PSBORDN,$P(PSBXID,U,2))=$P(PSBDATA,U,3)
"RTN","PSBOCP",109,0)
 ....I PSBCFLG I $P(PSBDATA,U,2)'="" S PSBLGD(PSBORDN,"C","INITIALS",$P(PSBDATA,U,4))="",PSBCMT(PSBORDN,$P(PSBXID,U,2),(-1*$P(PSBDATA,U,6)),PSBX2X)=PSBDATA
"RTN","PSBOCP",110,0)
 I +PSBTOT=0 K PSBLIST,^XTMP("PSBO",$J,"PSBLIST")
"RTN","PSBOCP",111,0)
 D CREATHDR^PSBOCP1
"RTN","PSBOCP",112,0)
 D SUBHDR^PSBOCE
"RTN","PSBOCP",113,0)
 D BLDRPT
"RTN","PSBOCP",114,0)
 D WRTRPT^PSBOCP1
"RTN","PSBOCP",115,0)
 Q
"RTN","PSBOCP",116,0)
BLDRPT ; Buld REPORT DATA
"RTN","PSBOCP",117,0)
 K PSBL2ULN
"RTN","PSBOCP",118,0)
 S PSBTOPHD=PSBLNTOT-2
"RTN","PSBOCP",119,0)
 I '$D(PSBLIST2) D  Q
"RTN","PSBOCP",120,0)
 .S PSBOUTP(0,PSBLNTOT)="W !!,""<<<< NO ORDERS TO DISPLAY >>>>"",!!"
"RTN","PSBOCP",121,0)
 S PSBMORE=5 F PSBX1X="ACTIVE","FUTURE",EXPIREHDG," * ERROR * " D
"RTN","PSBOCP",122,0)
 .I PSBX1X'=" * ERROR * " S PSBSUM=PSBX1X_" ["_PSBLIST2(PSBX1X)_$S(PSBLIST2(PSBX1X)=1:" Order",1:" Orders")_"]" S PSBOUTP($$PGTOT,PSBLNTOT)="W !!,"""_PSBSUM_""""
"RTN","PSBOCP",123,0)
 .Q:PSBLIST2(PSBX1X)=0
"RTN","PSBOCP",124,0)
 .Q:PSBOCRIT'[$E(PSBX1X,1)
"RTN","PSBOCP",125,0)
 .S:$L(PSBSUM)>$G(PSBL2ULN,0) PSBL2ULN=$L(PSBSUM)
"RTN","PSBOCP",126,0)
 .S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBL2ULN),"" "",""=""),!"
"RTN","PSBOCP",127,0)
 .S PSBOUTP($$PGTOT,PSBLNTOT)="W !"
"RTN","PSBOCP",128,0)
 .K PSBDATA
"RTN","PSBOCP",129,0)
 .S X0="",PSBTOT1=0
"RTN","PSBOCP",130,0)
 .F  S X0=$O(PSBLIST2(PSBX1X,X0))  Q:X0=""  S PSBX2X="" F  S PSBX2X=$O(PSBLIST2(PSBX1X,X0,PSBX2X)) Q:PSBX2X=""  D
"RTN","PSBOCP",131,0)
 ..M PSBLGD("INITIALS")=PSBLGD(PSBX2X,"X","INITIALS") M PSBLGD("INITIALS")=PSBLGD(PSBX2X,"C","INITIALS")
"RTN","PSBOCP",132,0)
 ..S PSBDATA(1,1)=$O(PSBTB(PSBX2X,""))
"RTN","PSBOCP",133,0)
 ..S PSBDATA(1,2)=$O(PSBSTS(PSBX2X,""))
"RTN","PSBOCP",134,0)
 ..S PSBDATA(1,3)=$O(PSBSCHTY(PSBX2X,""))
"RTN","PSBOCP",135,0)
 ..S Y0=$O(PSBOMDR(PSBX2X,"")) I Y0]"" S PSBDATA(1,4)="("_X0_")",PSBDATA(1,4,0)=PSBOMDR(PSBX2X,Y0)
"RTN","PSBOCP",136,0)
 ..S PSBDATA(1,5)=$O(PSBLSTG(PSBX2X,""))
"RTN","PSBOCP",137,0)
 ..S PSBDATA(1,6)=$O(PSBLSTX(PSBX2X,""))
"RTN","PSBOCP",138,0)
 ..S PSBDATA(1,7)=$$FMTDT^PSBOCE1($O(PSBOSTDT(PSBX2X,"")))
"RTN","PSBOCP",139,0)
 ..S PSBDATA(1,8)=$$FMTDT^PSBOCE1($E($O(PSBOSPDT(PSBX2X,"")),1,12))
"RTN","PSBOCP",140,0)
 ..K PSBSIDAT M PSBSIDAT=PSBSI(PSBX2X)                  ;*68
"RTN","PSBOCP",141,0)
 ..S PSBTOT1=PSBTOT1+1
"RTN","PSBOCP",142,0)
 ..K PSBDATA(2),PSBDATA(3),PSBSILN
"RTN","PSBOCP",143,0)
 ..D BUILDLN,SIOPI^PSBOCM(.PSBSIDAT,PSBTAB8,$S(PSBX2X["V":"Other Print Info:",1:""))
"RTN","PSBOCP",144,0)
 ..I $D(PSBRPLN) S PSBMORE=$O(PSBRPLN(""),-1)+6 I $D(PSBSILN) S PSBMORE=PSBMORE+$O(PSBSILN(""),-1)
"RTN","PSBOCP",145,0)
 ..K PSB1 I $D(PSBFLGD(PSBX2X)) S PSB="" F  S PSB=$O(PSBFLGD(PSBX2X,PSB)) Q:PSB=""  I ($P(PSB,":")'="NOX")&($P(PSB,":")'="STAT") S PSB1=$G(PSB1,"")_PSB
"RTN","PSBOCP",146,0)
 ..;build write clinic stmt                                       ;*70
"RTN","PSBOCP",147,0)
 ..S PSBOUTP($$PGTOT,PSBLNTOT)="W """_$G(PSBCLIN(PSBX2X))_""""_",!"
"RTN","PSBOCP",148,0)
 ..S PSBCNT=PSBTOT1_"   "_$G(PSB1,"")
"RTN","PSBOCP",149,0)
 ..S PSBOUTP($$PGTOT,PSBLNTOT)="W """_PSBCNT_""""
"RTN","PSBOCP",150,0)
 ..S I="" F  S I=$O(PSBRPLN(I)) Q:+I=0  D
"RTN","PSBOCP",151,0)
 ...S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBRPLN(I)_""""
"RTN","PSBOCP",152,0)
 ..S I="" F  S I=$O(PSBSILN(I)) Q:+I=0  D
"RTN","PSBOCP",153,0)
 ...S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBSILN(I)_""""
"RTN","PSBOCP",154,0)
 ..S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBTAB8),"" "",""-""),!"
"RTN","PSBOCP",155,0)
 ..K PSBRPLN,PSBDATA
"RTN","PSBOCP",156,0)
 D:+PSBTOT>0 LGD^PSBOCM
"RTN","PSBOCP",157,0)
 Q
"RTN","PSBOCP",158,0)
BUILDLN ; Constr recs
"RTN","PSBOCP",159,0)
 K J S J(0)="" F PSBFLD=1:1:8 S J=1 D FORMDAT(PSBFLD) S J($O(PSBRPLN(""),-1))=""
"RTN","PSBOCP",160,0)
 ; Write administration info...
"RTN","PSBOCP",161,0)
 Q:'PSBXFLG
"RTN","PSBOCP",162,0)
 S J=($O(J(""),-1)+1),PSBRPLN(J)=PSBBLANK,J(J)="",J=J+1
"RTN","PSBOCP",163,0)
 S (N,Y)=""
"RTN","PSBOCP",164,0)
 F  S Y=$O(PSBADM(PSBX2X,Y)) Q:Y']""  D
"RTN","PSBOCP",165,0)
 .F  S N=$O(PSBADM(PSBX2X,Y,N)) Q:N']""  D
"RTN","PSBOCP",166,0)
 ..N PSBEIECMT S PSBEIECMT="" I $D(PSBPRNEF(PSBX2X,$P(N,U,2))),$P($G(PSBRPT(.2)),U,8)=0 S PSBEIECMT=$$PRNEFF^PSBO(PSBEIECMT,$P(N,U,2))
"RTN","PSBOCP",167,0)
 ..I $D(PSBBID(PSBX2X,$P(N,U,2))) S PSBDATA(2,0)="BAG ID: "_PSBBID(PSBX2X,$P(N,U,2))
"RTN","PSBOCP",168,0)
 ..S $E(PSBDATA(2,0),25)="ACTION BY: "_$P(PSBADM(PSBX2X,Y,N),U,7)_" "_$$FMTDT^PSBOCE1($E($P(PSBADM(PSBX2X,Y,N),U,6),1,12))
"RTN","PSBOCP",169,0)
 ..S X=$P(PSBADM(PSBX2X,Y,N),U,5) S $E(PSBDATA(2,0),56)="ACTION: "_$S(X="G":"GIVEN",X="R":"REFUSED",X="RM":"REMOVED",X="H":"HELD",X="S":"STOPPED",X="I":"INFUSING",X="C":"COMPLETED",X="M":"MISSING DOSE",X=" ":"*UNKNOWN*",1:" ")
"RTN","PSBOCP",170,0)
 ..I $D(PSBPRNR(PSBX2X)) S $E(PSBDATA(2,0),72)="PRN REASON: "_PSBPRNR(PSBX2X,$P(N,U,2))
"RTN","PSBOCP",171,0)
 ..I $G(PSBDATA(2,0))]" " D WRAPPER(1,132-1,PSBDATA(2,0)) K PSBDATA(2) S J=J+1
"RTN","PSBOCP",172,0)
 ..I $D(PSBPRNEF(PSBX2X,$P(N,U,2))) S PSBDATA(2,0)="PRN EFFECTIVENESS: "_PSBPRNEF(PSBX2X,$P(N,U,2))_PSBEIECMT
"RTN","PSBOCP",173,0)
 ..I $G(PSBDATA(2,0))]" " D WRAPPER(30,132-30,PSBDATA(2,0)) K PSBDATA(2) S J=J+1
"RTN","PSBOCP",174,0)
 ..I ('PSBCFLG)!('$D(PSBCMT(PSBX2X,$P(N,U,2)))) S PSBRPLN(J)=PSBBLANK,J(J)="",J=J+1 Q
"RTN","PSBOCP",175,0)
 ..S X="" F   S X=$O(PSBCMT(PSBX2X,$P(N,U,2),X)) Q:X']""  D
"RTN","PSBOCP",176,0)
 ...N PSBDAT S PSBDAT="" F  S PSBDAT=$O(PSBCMT(PSBX2X,$P(N,U,2),X,PSBDAT)) Q:PSBDAT']""  D
"RTN","PSBOCP",177,0)
 ....S PSBDATA(2,0)="COMMENT BY: "_$S($P(PSBCMT(PSBX2X,$P(N,U,2),X,PSBDAT),U,5)]"":$P(PSBCMT(PSBX2X,$P(N,U,2),X,PSBDAT),U,5)_" "_$$FMTDT^PSBOCE1($E($P(PSBCMT(PSBX2X,$P(N,U,2),X,PSBDAT),U,6),1,12)),1:" n/a ")
"RTN","PSBOCP",178,0)
 ....S PSBDATA(2,0)=PSBDATA(2,0)_"  COMMENT: "_$S($P(PSBCMT(PSBX2X,$P(N,U,2),X,PSBDAT),U,2)]"":$P(PSBCMT(PSBX2X,$P(N,U,2),X,PSBDAT),U,2),1:" ")
"RTN","PSBOCP",179,0)
 ....I $G(PSBDATA(2,0))]" " D WRAPPER(30,132-30,PSBDATA(2,0)) K PSBDATA(2) S J=J+1
"RTN","PSBOCP",180,0)
 ..S PSBRPLN(J)=PSBBLANK,J(J)="",J=J+1
"RTN","PSBOCP",181,0)
 Q
"RTN","PSBOCP",182,0)
FORMDAT(FLD) ;
"RTN","PSBOCP",183,0)
 K PSBVAL
"RTN","PSBOCP",184,0)
 Q:'$D(PSBDATA(1,FLD))
"RTN","PSBOCP",185,0)
 S PSBVAL=PSBDATA(1,FLD)
"RTN","PSBOCP",186,0)
 D WRAPPER(@("PSBTAB"_(FLD-1))+1,((@("PSBTAB"_(FLD))-(@("PSBTAB"_(FLD-1))+1))),PSBVAL)
"RTN","PSBOCP",187,0)
 I FLD=4 S J=$O(J(""),-1)+1,PSBVAL=PSBDATA(1,4,0) D WRAPPER(@("PSBTAB"_(FLD-1))+1,((@("PSBTAB"_(FLD))-(@("PSBTAB"_(FLD-1))+1))),PSBVAL)
"RTN","PSBOCP",188,0)
 Q
"RTN","PSBOCP",189,0)
PGTOT(X) ;mnt PAGE Number
"RTN","PSBOCP",190,0)
 I (PSBLNTOT+PSBMORE)>(IOSL) D PGC^PSBOCE1
"RTN","PSBOCP",191,0)
 I $G(X,1) S PSBLNTOT=PSBLNTOT+$G(X,1),PSBMORE=PSBMORE-$G(X,1)
"RTN","PSBOCP",192,0)
 Q PSBPGNUM
"RTN","PSBOCP",193,0)
WRAPPER(X,Y,Z) ;  Text WRAP
"RTN","PSBOCP",194,0)
 N PSB
"RTN","PSBOCP",195,0)
 I ($L(Z)>0),$F(Z,"""")>1 F  Q:$F(Z,"""")'>1  S Z=$TR(Z,"""","^")
"RTN","PSBOCP",196,0)
 F  Q:'$L(Z)  D
"RTN","PSBOCP",197,0)
 .I $L(Z)<Y S $E(PSBRPLN(J),X)=Z S Z="" Q
"RTN","PSBOCP",198,0)
 .F PSB=Y:-1:0 Q:$E(Z,PSB)=" "
"RTN","PSBOCP",199,0)
 .S:PSB<1 PSB=Y
"RTN","PSBOCP",200,0)
 .S $E(PSBRPLN(J),X)=$E(Z,1,PSB)
"RTN","PSBOCP",201,0)
 .I $L(PSBRPLN(J),"^")>1 F X=1:1:$L(PSBRPLN(J),"^")-1 S $P(PSBRPLN(J),"^",X)=$P(PSBRPLN(J),"^",X)_""""
"RTN","PSBOCP",202,0)
 .S PSBRPLN(J)=$TR(PSBRPLN(J),"^","""")
"RTN","PSBOCP",203,0)
 .S Z=$E(Z,PSB+1,250),J=J+1,J(J)=""
"RTN","PSBOCP",204,0)
 Q ""
"RTN","PSBOCP",205,0)
LSTX(P,O) ;
"RTN","PSBOCP",206,0)
 S DT=$$FMDIFF^XLFDT(O,P,2)
"RTN","PSBOCP",207,0)
 I ((DT\60)<1) Q "0d 0h 1m"
"RTN","PSBOCP",208,0)
 S D=(DT\(60*60*24)) S DT=DT-(D*(60*60*24))
"RTN","PSBOCP",209,0)
 S H=(DT\(60*60)) S DT=DT-(H*(60*60))
"RTN","PSBOCP",210,0)
 S M=((DT+30)\(60)) S DT=DT-(M*(60))
"RTN","PSBOCP",211,0)
 Q D_"d "_H_"h "_M_"m"
"RTN","PSBOCP1")
0^32^B6917771^B6438461
"RTN","PSBOCP1",1,0)
PSBOCP1 ;BIRMINGHAM/TEJ-COVERSHEET PRN OVERVIEW REPORT ;8/16/12 2:57pm
"RTN","PSBOCP1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**32,70**;Mar 2004;Build 101
"RTN","PSBOCP1",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOCP1",4,0)
 ;
"RTN","PSBOCP1",5,0)
 ;*70 - add new header line for clinic search list
"RTN","PSBOCP1",6,0)
 ;
"RTN","PSBOCP1",7,0)
WRTRPT ;  writ
"RTN","PSBOCP1",8,0)
 I $O(PSBOUTP(""),-1)<1 D  Q
"RTN","PSBOCP1",9,0)
 .X PSBOUTP($O(PSBOUTP(""),-1),14)
"RTN","PSBOCP1",10,0)
 .D FTR
"RTN","PSBOCP1",11,0)
 S PSBPGNUM=1
"RTN","PSBOCP1",12,0)
 S PSBZ="" F  S PSBZ=$O(PSBOUTP(PSBZ)) Q:PSBZ=""  D
"RTN","PSBOCP1",13,0)
 .I PSBPGNUM'=PSBZ D FTR S PSBPGNUM=PSBZ D HDR,SUBHDR^PSBOCE
"RTN","PSBOCP1",14,0)
 .S PSBX2X="" F  S PSBX2X=$O(PSBOUTP(PSBZ,PSBX2X)) Q:PSBX2X=""  D
"RTN","PSBOCP1",15,0)
 ..X PSBOUTP(PSBZ,PSBX2X)
"RTN","PSBOCP1",16,0)
 D FTR
"RTN","PSBOCP1",17,0)
 K ^XTMP("PSBO",$J,"PSBLIST"),PSBOUTP
"RTN","PSBOCP1",18,0)
 Q
"RTN","PSBOCP1",19,0)
CREATHDR ;
"RTN","PSBOCP1",20,0)
 K PSBHD1,PSBHD2
"RTN","PSBOCP1",21,0)
 I IOM'<132 S PSBHD1=$P($T(HD132A),"~",2),PSBHD2=$P($T(HD132B),";",2),PSBBLANK=$P($T(C132BLK),";",2)
"RTN","PSBOCP1",22,0)
 E  S PSBHD1="THIS REPORT SUPPORTS >131 CHAR./LINE PRINT FORMATS ONLY" Q
"RTN","PSBOCP1",23,0)
 ; reset tabs
"RTN","PSBOCP1",24,0)
 S PSBTAB0=1 F PSBI=0:1:($L(PSBHD1,"|")-1) S:PSBI>0 @("PSBTAB"_PSBI)=($F(PSBHD1,"|",@("PSBTAB"_(PSBI-1))+1))-1
"RTN","PSBOCP1",25,0)
 S PSBPGNUM=1
"RTN","PSBOCP1",26,0)
 D HDR
"RTN","PSBOCP1",27,0)
 Q
"RTN","PSBOCP1",28,0)
HD132A ;~ VDL |    Status   |Type|      Medication; Dosage, Route      |   Last Given  |      Since    |    Order Start   |    Order Stop   |
"RTN","PSBOCP1",29,0)
 Q
"RTN","PSBOCP1",30,0)
HD132B ; Tab |             |    |                                     |               |   Last Given  |    Date          |    Date         |
"RTN","PSBOCP1",31,0)
 Q
"RTN","PSBOCP1",32,0)
C132BLK ;;     |             |    |                                     |               |               |                  |                 |
"RTN","PSBOCP1",33,0)
 Q
"RTN","PSBOCP1",34,0)
HDR ;  Header
"RTN","PSBOCP1",35,0)
 W:$Y>1 @IOF
"RTN","PSBOCP1",36,0)
 W:$X>1 !
"RTN","PSBOCP1",37,0)
 S PSBRPNM="BCMA COVERSHEET PRN OVERVIEW REPORT"
"RTN","PSBOCP1",38,0)
 D:$P(PSBRPT(.1),U,1)="P"
"RTN","PSBOCP1",39,0)
 .S PSBHDR(0)=PSBRPNM
"RTN","PSBOCP1",40,0)
 .S PSBHDR(1)="Order Status(es): --"
"RTN","PSBOCP1",41,0)
 .F Y=4,5,7,8 I $P(PSBFUTR,U,Y) S $P(PSBHDR(1),": ",2)=$P(PSBHDR(1),": ",2)_$S(PSBHDR(1)["--":"",1:"/ ")_$P("^^^Future^Active^^Expired^DC'd^^^^^^^^^^",U,Y)_" " S PSBHDR(1)=$TR(PSBHDR(1),"-","")
"RTN","PSBOCP1",42,0)
 .I $P(PSBFUTR,U,11) S PSBHDR(2)="Include Action(s)"_$S(PSBCFLG:" & Comments/Reasons",1:"")
"RTN","PSBOCP1",43,0)
 .S:$G(PSBSRCHL)]"" PSBHDR(3)="",PSBHDR(4)=PSBSRCHL           ;*70
"RTN","PSBOCP1",44,0)
 .D PT^PSBOHDR(PSBXDFN,.PSBHDR)
"RTN","PSBOCP1",45,0)
 Q
"RTN","PSBOCP1",46,0)
FTR ;  Fter
"RTN","PSBOCP1",47,0)
 S PSBPG="Page: "_PSBPGNUM_" of "_$S($O(PSBOUTP(""),-1)=0:1,1:$O(PSBOUTP(""),-1))
"RTN","PSBOCP1",48,0)
 S PSBPGRM=PSBTAB8-($L(PSBPG))
"RTN","PSBOCP1",49,0)
 D PTFTR^PSBOHDR()
"RTN","PSBOCP1",50,0)
 W !,PSBRPNM,"     ",?(PSBPGRM-($L(PSBDTTM)+3)),PSBDTTM_"  "_PSBPG
"RTN","PSBOCP1",51,0)
 Q
"RTN","PSBODL")
0^29^B104826569^B85139144
"RTN","PSBODL",1,0)
PSBODL ;BIRMINGHAM/EFC-DUE LIST ;3/19/13 19:13pm
"RTN","PSBODL",2,0)
 ;;3.0;BAR CODE MED ADMIN;**5,9,38,32,25,63,68,70**;Mar 2004;Build 101
"RTN","PSBODL",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified. 
"RTN","PSBODL",4,0)
 ;
"RTN","PSBODL",5,0)
 ; Reference/IA
"RTN","PSBODL",6,0)
 ; EN^PSJBCMA/2828
"RTN","PSBODL",7,0)
 ; $$GET^XPAR/2263
"RTN","PSBODL",8,0)
 ; ^XLFDT/10103
"RTN","PSBODL",9,0)
 ; GETSIOPI^PSJBCMA5/5763
"RTN","PSBODL",10,0)
 ;
"RTN","PSBODL",11,0)
 ;*68 - add call to retrieve New WP Special Instructions/OPI fields
"RTN","PSBODL",12,0)
 ;*70 - add Clinic filter and issert clinic name into array to force
"RTN","PSBODL",13,0)
 ;      it to sort before admin times & print clinic name when changes
"RTN","PSBODL",14,0)
 ;
"RTN","PSBODL",15,0)
EN ; Prt DL
"RTN","PSBODL",16,0)
 N PSBGBL,PSBHDR,IOINHI,IOINORM,PSBGIVEN,PSBIEN,PSBLGDT,PSBEVDT,DFN,PSBFLAG,PSBSRCHL
"RTN","PSBODL",17,0)
 S X="IOINHI;IOINORM" D ENDR^%ZISS S X=""
"RTN","PSBODL",18,0)
 I '$D(^TMP("PSBO",$J,"B")) S ^TMP("PSBO",$J,"B","EMPTY")=""
"RTN","PSBODL",19,0)
 S PSBGBL="^TMP(""PSBO"",$J,""B"")"
"RTN","PSBODL",20,0)
 I $G(PSBRPT(.4)) S $P(PSBRPT(.2),U,8)=1
"RTN","PSBODL",21,0)
 ;check Clinic or Nurs Unit search list                *70
"RTN","PSBODL",22,0)
 S PSBSRCHL=$$SRCHLIST^PSBOHDR()
"RTN","PSBODL",23,0)
 ;
"RTN","PSBODL",24,0)
 F  S PSBGBL=$Q(@PSBGBL) Q:PSBGBL=""  Q:$QS(PSBGBL,1)'="PSBO"!($QS(PSBGBL,2)'=$J)  D
"RTN","PSBODL",25,0)
 .S DFN=$QS(PSBGBL,5)
"RTN","PSBODL",26,0)
 .K PSBHDR
"RTN","PSBODL",27,0)
 .S PSBHDR(1)="MEDICATION DUE LIST for "
"RTN","PSBODL",28,0)
 .S (Y,PSBEVDT)=$P(PSBRPT(.1),U,6) D D^DIQ S Z=Y,PSBHDR(1)=PSBHDR(1)_Y_"@" S Y=$P(PSBRPT(.1),U,7) S PSBHDR(1)=PSBHDR(1)_$E(Y_"0000",2,5)
"RTN","PSBODL",29,0)
 .S PSBEVDT2=$P(PSBRPT(.1),U,6) S Y=$P(PSBRPT(.1),U,9) S:Y]"" PSBHDR(1)=PSBHDR(1)_" to "_Z_"@"_$E(Y_"0000",2,5)
"RTN","PSBODL",30,0)
 .S PSBHDR(2)="Schedule Type(s): --"
"RTN","PSBODL",31,0)
 .F Y=1:1:4 I $P(PSBRPT(.2),U,Y) S $P(PSBHDR(2),": ",2)=$P(PSBHDR(2),": ",2)_$S(PSBHDR(2)["--":"",1:"/ ")_$P("Continuous^PRN^On-Call^One-Time",U,Y)_" " S PSBHDR(2)=$TR(PSBHDR(2),"-","")
"RTN","PSBODL",32,0)
 .S PSBHDR(3)="Order Type(s): --"
"RTN","PSBODL",33,0)
 .F Y=6,7,8 I $P(PSBRPT(.2),U,Y) S $P(PSBHDR(3),": ",2)=$P(PSBHDR(3),": ",2)_$S(PSBHDR(3)["--":"",1:"/ ")_$P("^^^^^IV^Unit Dose^Future Orders",U,Y)_" " S PSBHDR(3)=$TR(PSBHDR(3),"-","")
"RTN","PSBODL",34,0)
 .D:$G(PSBSRCHL)]""                                          ;*70
"RTN","PSBODL",35,0)
 ..S PSBHDR(4)=""
"RTN","PSBODL",36,0)
 ..S:$P(PSBRPT(4),U,2)="C" PSBHDR(5)="Clinic Search List: "
"RTN","PSBODL",37,0)
 ..S:$P(PSBRPT(4),U,2)="I" PSBHDR(5)="Ward Location: "
"RTN","PSBODL",38,0)
 .;
"RTN","PSBODL",39,0)
 .I $QS(PSBGBL,4)="EMPTY" D  Q
"RTN","PSBODL",40,0)
 ..W $$EMPTYHDR^PSBOHDR(PSBSRCHL)
"RTN","PSBODL",41,0)
 ..W !!?10,"** NO DATA FOUND for "_$S(PSBCLINORD:"Clinic Search List",1:"Entire Ward/Nurse Location")_" **",! Q
"RTN","PSBODL",42,0)
 .;
"RTN","PSBODL",43,0)
 .D PRINT(DFN)
"RTN","PSBODL",44,0)
 ;
"RTN","PSBODL",45,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J),^TMP("PSBO",$J)
"RTN","PSBODL",46,0)
 Q
"RTN","PSBODL",47,0)
PRINT(DFN) ;^TMP($J.
"RTN","PSBODL",48,0)
 N PSBGBL,PSBOSTRT,PSBOSTOP,PSBINDX,PSBTYPE,PSBSCH,PSBSCHT
"RTN","PSBODL",49,0)
 N PSBMED,PSBORD,PSB,PSBX,PSBY,PSBZ,PSBSTOP,PSBSTRT,PSBSM,PSBNUM,PSBAT
"RTN","PSBODL",50,0)
 N PSBADMIN,PSBADM,PSBSTAT,PSBWFLAG,PSBODATE,PSBCLINIC,PSBCLNMB,PSBTMPSD,PSBSTTMP   ;*70
"RTN","PSBODL",51,0)
 W $$HDR()
"RTN","PSBODL",52,0)
 S PSBOSTRT=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7)
"RTN","PSBODL",53,0)
 S PSBOSTOP=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,9)
"RTN","PSBODL",54,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J)
"RTN","PSBODL",55,0)
 D EN^PSJBCMA(DFN,PSBOSTRT,"")
"RTN","PSBODL",56,0)
 D:PSBCLINORD                                    ;*70 filer clinics
"RTN","PSBODL",57,0)
 . I $D(PSBRPT(2)) D FILTERCO^PSBO Q
"RTN","PSBODL",58,0)
 . D INCLUDCO^PSBVDLU1
"RTN","PSBODL",59,0)
 I 'PSBCLINORD D REMOVECO^PSBVDLU1               ;*70
"RTN","PSBODL",60,0)
 I $G(^TMP("PSJ",$J,1,0))=-1 W !!?10,"** NO SPECIFIED MEDICATIONS TO PRINT **",!,$$BLANKS(),$$FTR^PSBODL1() Q
"RTN","PSBODL",61,0)
 S PSBI1=0 F  S PSBODATE=$$FMADD^XLFDT(PSBEVDT,PSBI1) Q:PSBODATE>PSBEVDT2  Q:PSBODATE=-1  D  ;Quit if Date is not valid Fileman Date added in PSB*3*63
"RTN","PSBODL",62,0)
 .S PSBI1=1
"RTN","PSBODL",63,0)
 .S Y=PSBODATE D D^DIQ
"RTN","PSBODL",64,0)
 .W !!,"Administration Date: "_Y,!
"RTN","PSBODL",65,0)
 .S PSBINDX=0
"RTN","PSBODL",66,0)
 .F  S PSBINDX=$O(^TMP("PSJ",$J,PSBINDX)) Q:'PSBINDX  D
"RTN","PSBODL",67,0)
 ..S PSBCLINIC=$P(^TMP("PSJ",$J,PSBINDX,0),U,11),PSBCLNMB=$P(^TMP("PSJ",$J,PSBINDX,0),U,12)                  ;*70
"RTN","PSBODL",68,0)
 ..S PSBTYPE=$P(^TMP("PSJ",$J,PSBINDX,0),U,3),PSBTYPE=$E(PSBTYPE,$L(PSBTYPE))
"RTN","PSBODL",69,0)
 ..Q:PSBTYPE=""!(PSBTYPE="P")  ; No Pend this ver
"RTN","PSBODL",70,0)
 ..S PSBSTAT=^TMP("PSJ",$J,PSBINDX,1)
"RTN","PSBODL",71,0)
 ..I $P(PSBSTAT,U,7)["D"!($P(PSBSTAT,U,7)="E")!($P(PSBSTAT,U,8)) Q
"RTN","PSBODL",72,0)
 ..Q:PSBTYPE="U"&('$P(PSBRPT(.2),U,7))
"RTN","PSBODL",73,0)
 ..Q:PSBTYPE="V"&('$P(PSBRPT(.2),U,6))
"RTN","PSBODL",74,0)
 ..S PSBTYPE=$S(PSBTYPE="U":"UD-",PSBTYPE="V":"IV-",1:"**")
"RTN","PSBODL",75,0)
 ..S Y=$P(PSBSTAT,U,2)
"RTN","PSBODL",76,0)
 ..Q:Y="C"&('$P(PSBRPT(.2),U,1))
"RTN","PSBODL",77,0)
 ..Q:Y="P"&('$P(PSBRPT(.2),U,2))
"RTN","PSBODL",78,0)
 ..Q:Y="OC"&('$P(PSBRPT(.2),U,3))
"RTN","PSBODL",79,0)
 ..Q:Y="O"&('$P(PSBRPT(.2),U,4))
"RTN","PSBODL",80,0)
 ..S PSBSCHT=Y
"RTN","PSBODL",81,0)
 ..S:PSBSCHT="" PSBSCHT="*"
"RTN","PSBODL",82,0)
 ..S PSBMED=$P(^TMP("PSJ",$J,PSBINDX,3),U,2)
"RTN","PSBODL",83,0)
 ..S PSBORD=$P(^TMP("PSJ",$J,PSBINDX,0),U,3)
"RTN","PSBODL",84,0)
 ..S ^TMP("PSB",$J,"B",PSBTYPE,PSBSCHT,PSBMED,PSBORD)=""
"RTN","PSBODL",85,0)
 ..I PSBCLINIC]"" S ^TMP("PSB",$J,"C",DFN,PSBORD)=PSBCLNMB_"^"_PSBCLINIC
"RTN","PSBODL",86,0)
 .I '$D(^TMP("PSB",$J,"B")) W !!?10,"** NO SPECIFIED MEDICATIONS TO PRINT **",!,$$BLANKS(),$$FTR^PSBODL1() Q
"RTN","PSBODL",87,0)
 .S PSBGBL=$NAME(^TMP("PSB",$J,"B")),PSBWFLAG=0
"RTN","PSBODL",88,0)
 .F  S PSBGBL=$Q(@PSBGBL) Q:PSBGBL=""  Q:($QS(PSBGBL,1)'="PSB")!($QS(PSBGBL,2)'=$J)!($QS(PSBGBL,3)'="B")  D
"RTN","PSBODL",89,0)
 ..K PSBORD,PSBFUTRO
"RTN","PSBODL",90,0)
 ..S PSBTYPE=$QS(PSBGBL,4)
"RTN","PSBODL",91,0)
 ..S PSBSCHT=$QS(PSBGBL,5)
"RTN","PSBODL",92,0)
 ..S PSBMED=$QS(PSBGBL,6)
"RTN","PSBODL",93,0)
 ..S PSBORD=$QS(PSBGBL,7)
"RTN","PSBODL",94,0)
 ..D CLEAN^PSBVT
"RTN","PSBODL",95,0)
 ..D PSJ1^PSBVT(DFN,PSBORD)
"RTN","PSBODL",96,0)
 ..;*68 begin
"RTN","PSBODL",97,0)
 ..K ^TMP("PSJBCMA5",$J,DFN,PSBONX)
"RTN","PSBODL",98,0)
 ..D GETSIOPI^PSJBCMA5(DFN,PSBONX,1)
"RTN","PSBODL",99,0)
 ..;*68 end
"RTN","PSBODL",100,0)
 ..D NOW^%DTC S PSBNOW=%
"RTN","PSBODL",101,0)
 ..Q:PSBOSP<PSBOSTRT
"RTN","PSBODL",102,0)
 ..Q:(PSBOSP<PSBOSTRT)&(PSBSCHT'="O")
"RTN","PSBODL",103,0)
 ..Q:(PSBOSP'>PSBNOW)
"RTN","PSBODL",104,0)
 ..S (PSBYES,PSBODD,PSBDAYB,PSBSCBR)=0
"RTN","PSBODL",105,0)
 ..S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1,PSBDAYB=1
"RTN","PSBODL",106,0)
 ..F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1,PSBSCBR=1
"RTN","PSBODL",107,0)
 ..I PSBYES,PSBADST="",PSBSCHT'="O",PSBSCHT'="OC",PSBSCHT'="P" D  Q
"RTN","PSBODL",108,0)
 ...D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH)
"RTN","PSBODL",109,0)
 ..I PSBSCHT="OC" S PSBYES=1
"RTN","PSBODL",110,0)
 ..I PSBSCHT="P" S PSBYES=1
"RTN","PSBODL",111,0)
 ..I "PCS"'[PSBIVT S PSBYES=1
"RTN","PSBODL",112,0)
 ..I PSBIVT["S",PSBISYR'=1 S PSBYES=1
"RTN","PSBODL",113,0)
 ..I PSBIVT["C",PSBCHEMT'="P",PSBISYR'=1 S PSBYES=1
"RTN","PSBODL",114,0)
 ..I PSBIVT["C",PSBCHEMT="A" S PSBYES=1
"RTN","PSBODL",115,0)
 ..I PSBFREQ="O" S PSBFREQ=1440
"RTN","PSBODL",116,0)
 ..I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBODL",117,0)
 ..I PSBSCHT="P" S PSBFREQ=1440
"RTN","PSBODL",118,0)
 ..I PSBSCHT="O" S PSBFREQ=1440
"RTN","PSBODL",119,0)
 ..I 'PSBYES,PSBFREQ<1 D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH) Q
"RTN","PSBODL",120,0)
 ..S PSBVALB=$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBIVPSH)
"RTN","PSBODL",121,0)
 ..I 'PSBDAYB,'PSBSCBR,PSBSCHT="C",PSBVALB="1",PSBADST'="",PSBFREQ<1 D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH) Q
"RTN","PSBODL",122,0)
 ..I +PSBFREQ>0 I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBODL",123,0)
 ..I PSBODD,PSBADST'="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Administration Times on ODD SCHEDULE",PSBSCH) Q
"RTN","PSBODL",124,0)
 ..I PSBADST'="" D
"RTN","PSBODL",125,0)
 ...F PSBY=1:1:$L(PSBADST,"-")  D
"RTN","PSBODL",126,0)
 ....D:($P(PSBADST,"-",PSBY)'?2N)&($P(PSBADST,"-",PSBY)'?4N)
"RTN","PSBODL",127,0)
 .....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid Admin times",PSBSCH)
"RTN","PSBODL",128,0)
 ..I PSBSCHT="C",PSBOTYP="U",$G(PSBOST)<$G(PSBOSTRT) Q:'$$OKAY^PSBVDLU1(PSBOST,PSBODATE,PSBSCH,PSBONX,PSBOITX,PSBFREQ,)  ;Add check for QOD schedules in PSB*3*63
"RTN","PSBODL",129,0)
 ..I PSBSCHT="C",$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBIVPSH),'$$OKAY^PSBVDLU1(PSBOST,PSBODATE,PSBSCH,PSBONX,PSBOITX,PSBFREQ) Q
"RTN","PSBODL",130,0)
 ..I PSBSCHT="O" D  Q:PSBGVN
"RTN","PSBODL",131,0)
 ...S (PSBGVN,X,Y)=""
"RTN","PSBODL",132,0)
 ...F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBODL",133,0)
 ....F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBODL",134,0)
 .....I $P(^PSB(53.79,Y,.1),U)=PSBONX,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBODL",135,0)
 ..S PSBRMN=1
"RTN","PSBODL",136,0)
 ..I PSBSCHT="O" D
"RTN","PSBODL",137,0)
 ...Q:(PSBOST'=PSBOSP)
"RTN","PSBODL",138,0)
 ...Q:(PSBOSP<PSBOSTRT)
"RTN","PSBODL",139,0)
 ...Q:((%'>PSBOST)!(%'=PSBOST))
"RTN","PSBODL",140,0)
 ...S PSBRMN=0
"RTN","PSBODL",141,0)
 ..Q:'PSBRMN
"RTN","PSBODL",142,0)
 ..I $G(PSBORD) S PSBCLINIC=$P($G(^TMP("PSB",$J,"C",+$G(DFN),PSBORD)),"^",2)
"RTN","PSBODL",143,0)
 ..I +$G(PSBCLINIC) I PSBOST>PSBNOW S ^TMP("PSBO",$J,DFN,PSBORD,PSBTYPE)="" Q
"RTN","PSBODL",144,0)
 ..I '$G(PSBCLINIC) I PSBOST>$$FMADD^XLFDT(PSBNOW,"","",+($$GET^XPAR("DIV","PSB ADMIN BEFORE"))) S ^TMP("PSBO",$J,DFN,PSBORD,PSBTYPE)="" Q
"RTN","PSBODL",145,0)
 ..I PSBSCHT="OC" D  Q:PSBGVN&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL"))
"RTN","PSBODL",146,0)
 ...S (PSBGVN,X,Y)=""
"RTN","PSBODL",147,0)
 ...F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBODL",148,0)
 ....F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBODL",149,0)
 .....I $P(^PSB(53.79,Y,.1),U)=PSBONX,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBODL",150,0)
 ..S PSBLGDT="",X=""
"RTN","PSBODL",151,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,X),-1) Q:'X  D  Q:PSBLGDT
"RTN","PSBODL",152,0)
 ...S PSBIEN=""
"RTN","PSBODL",153,0)
 ...F  S PSBIEN=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,X,PSBIEN),-1) Q:PSBIEN=""  D  Q:PSBLGDT
"RTN","PSBODL",154,0)
 ....S:$P($G(^PSB(53.79,PSBIEN,0)),U,9)="G" PSBLGDT=X
"RTN","PSBODL",155,0)
 ..S PSBADMIN="" K ^TMP("PSB",$J,"GETADMIN")
"RTN","PSBODL",156,0)
 ..I PSBSCHT="C" D  Q:PSBADMIN=""
"RTN","PSBODL",157,0)
 ...S PSBX=PSBADST,PSBFLAG=1
"RTN","PSBODL",158,0)
 ...D:PSBX=""
"RTN","PSBODL",159,0)
 ....I PSBIVT="C",PSBCHEMT="A" S PSBX="0000",PSBFLAG=0
"RTN","PSBODL",160,0)
 ....I PSBIVT="C",PSBISYR=0 S PSBX="0000",PSBFLAG=0
"RTN","PSBODL",161,0)
 ....I PSBIVT="S",PSBISYR'=1 S PSBX="0000",PSBFLAG=0
"RTN","PSBODL",162,0)
 ....I "HA"[PSBIVT S:PSBIVT]"" PSBX="0000",PSBFLAG=0
"RTN","PSBODL",163,0)
 ...I ((PSBIVT="S")!(PSBIVT="C")),(PSBISYR=1) S:+($G(PSBX))=0 PSBX=""
"RTN","PSBODL",164,0)
 ...I (PSBIVT="C"),(PSBCHEMT="P") S:+($G(PSBX))=0 PSBX=""
"RTN","PSBODL",165,0)
 ...I PSBOTYP="U",PSBX="0000" S PSBX=""
"RTN","PSBODL",166,0)
 ...I PSBIVT="P" S:+($G(PSBX))=0 PSBX=""
"RTN","PSBODL",167,0)
 ...I PSBX="" S:($G(PSBFREQ)>29)!(PSBFREQ="D") PSBX=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBODATE)
"RTN","PSBODL",168,0)
 ...E  S ^TMP("PSB",$J,"GETADMIN",0)=PSBX
"RTN","PSBODL",169,0)
 ...D:PSBX'=""
"RTN","PSBODL",170,0)
 ....F PSBXX=0:1 Q:'$D(^TMP("PSB",$J,"GETADMIN",PSBXX))  S PSBX=$G(^TMP("PSB",$J,"GETADMIN",PSBXX)) D
"RTN","PSBODL",171,0)
 .....F PSBY=1:1:$L(PSBX,"-")  D
"RTN","PSBODL",172,0)
 ......S PSBAT=+(PSBODATE_"."_$P(PSBX,"-",PSBY))
"RTN","PSBODL",173,0)
 ......I PSBFLAG Q:PSBAT<PSBOSTRT!(PSBAT>PSBOSTOP)
"RTN","PSBODL",174,0)
 ......D VAL^PSBMLVAL(.PSBZ,DFN,PSBON,PSBOTYP,PSBAT)
"RTN","PSBODL",175,0)
 ......I (PSBZ(0)<0)&(PSBCNT=1) S ^TMP("PSBO",$J,DFN,PSBORD,PSBTYPE,PSBAT)="" Q
"RTN","PSBODL",176,0)
 ......I (PSBAT'["."),($G(PSBORD)["V") I (PSBOST<PSBOSTOP) K PSBSTTMP D  Q:$G(PSBSTTMP)
"RTN","PSBODL",177,0)
 .......I ('$G(PSBCLINIC)&(PSBOST'<$$FMADD^XLFDT(PSBNOW,"","",($$GET^XPAR("DIV","PSB ADMIN BEFORE"))))) S PSBSTTMP=1 Q
"RTN","PSBODL",178,0)
 .......I ($G(PSBCLINIC)&(PSBOST'<PSBNOW)) S ^TMP("PSBO",$J,DFN,PSBORD,PSBTYPE,PSBAT)="",PSBSTTMP=1 Q
"RTN","PSBODL",179,0)
 ......Q:+PSBZ(0)<0
"RTN","PSBODL",180,0)
 ......I $G(PSBOST)'>$G(PSBAT) D
"RTN","PSBODL",181,0)
 .......Q:($G(PSBOSP)'>$G(PSBAT))
"RTN","PSBODL",182,0)
 .......S PSBADMIN=PSBADMIN_$S(PSBADMIN]"":"-",1:"")_$P(PSBX,"-",PSBY)
"RTN","PSBODL",183,0)
 ......E  I ($P($G(PSBOST),".")'>$P($G(PSBAT),"."))&($P($G(PSBAT),".",2)="") S PSBADMIN=PSBADMIN_$S(PSBADMIN]"":"-",1:"")_$P(PSBX,"-",PSBY)
"RTN","PSBODL",184,0)
 ...I +$G(PSBFREQ)>0,$G(PSBFREQ)<30,PSBADMIN'="0000" S PSBADMIN="Due every "_$G(PSBFREQ)_" minutes."
"RTN","PSBODL",185,0)
 ..I $Y>(IOSL-(12+($L(PSBADMIN)/27))) W !?(IOM-36\2),"(Medications Continued on Next Page)",$$FTR^PSBODL1(),$$HDR()
"RTN","PSBODL",186,0)
 ..I PSBSM S PSBSM=$S(PSBSMX:"H",1:"")_"SM"
"RTN","PSBODL",187,0)
 ..E  S PSBSM=""
"RTN","PSBODL",188,0)
 ..W !,PSBCLINIC                                                  ;*70
"RTN","PSBODL",189,0)
 ..W !,$J(PSBSM,3),?6,PSBTYPE,$E(PSBSCHT,1,4),?12 S PSBWFLAG=1
"RTN","PSBODL",190,0)
 ..S X="",Y=0
"RTN","PSBODL",191,0)
 ..D WRAPPUP^PSBODL1
"RTN","PSBODL",192,0)
 .I '$G(PSBWFLAG) W !!,?10,"** NO SPECIFIED MEDICATIONS TO PRINT **"
"RTN","PSBODL",193,0)
 .W $$BLANKS(),$$FTR^PSBODL1()
"RTN","PSBODL",194,0)
 .S PSBORD=$O(^TMP("PSBO",$J,DFN,""),-1)
"RTN","PSBODL",195,0)
 .I +$G(PSBORD)>0,$P(PSBRPT(.4),U,1),$D(^TMP("PSBO",$J,DFN,PSBORD)) D EN^PSBODL1
"RTN","PSBODL",196,0)
 I $G(PSBODATE)=-1 W !!,?10,"** NO SPECIFIED MEDICATIONS TO PRINT **",$$BLANKS(),$$FTR^PSBODL1() ;Add no medications message, blank lines and footer to patients for invalid Fileman date in PSB*3*63
"RTN","PSBODL",197,0)
 ;
"RTN","PSBODL",198,0)
 K ^TMP("PSJBCMA5",$J)
"RTN","PSBODL",199,0)
 Q
"RTN","PSBODL",200,0)
HDR() ;
"RTN","PSBODL",201,0)
 D PT^PSBOHDR(DFN,.PSBHDR,,,PSBSRCHL)
"RTN","PSBODL",202,0)
 W !
"RTN","PSBODL",203,0)
 W:PSBCLINORD "Location"
"RTN","PSBODL",204,0)
 W ?100,"Start",?110,"Stop"
"RTN","PSBODL",205,0)
 W !,"Self",?85,"Last",?100,"Date",?110,"Date",?120,"Verifying"
"RTN","PSBODL",206,0)
 W !,"Med",?6,"Sched",?14,"Medication",?50,"Dose",?78,"Route",?85,"Given",?100,"@Time",?110,"@Time",?120,"Rph/Rn"
"RTN","PSBODL",207,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL",208,0)
 Q ""
"RTN","PSBODL",209,0)
BLANKS() ;
"RTN","PSBODL",210,0)
 Q:'$P(PSBRPT(.2),U,5) ""
"RTN","PSBODL",211,0)
 W !
"RTN","PSBODL",212,0)
 D:$Y>(IOSL-26)
"RTN","PSBODL",213,0)
 .W ?(IOM-42\2),"(Changes/Addendums to Orders on Next Page)"
"RTN","PSBODL",214,0)
 .W $$FTR^PSBODL1(),$$HDR() ; New page - no room for blanks
"RTN","PSBODL",215,0)
 I IOSL<100 F  Q:$Y>(IOSL-26)  W !
"RTN","PSBODL",216,0)
 W ?(IOM-28\2),"Changes/Addendums to orders"
"RTN","PSBODL",217,0)
 F X=1:1:4 D
"RTN","PSBODL",218,0)
 .W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL",219,0)
 .W !!?3,"CON ___ PRN ___"
"RTN","PSBODL",220,0)
 .W ?20,"Drug: ",$TR($J("",22)," ","_")
"RTN","PSBODL",221,0)
 .W ?50,"Give: ",$TR($J("",42)," ","_")
"RTN","PSBODL",222,0)
 .W ?100,"Start: _________ Stop: _________"
"RTN","PSBODL",223,0)
 .W !?20,"Spec"
"RTN","PSBODL",224,0)
 .W !?3,"OT  ___ OC  ___"
"RTN","PSBODL",225,0)
 .W ?20,"Inst: ",$TR($J("",72)," ","_")
"RTN","PSBODL",226,0)
 .W ?100,"Initials: ______ Date: _________"
"RTN","PSBODL",227,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL",228,0)
 Q ""
"RTN","PSBODL1")
0^43^B44703020^B43970993
"RTN","PSBODL1",1,0)
PSBODL1 ;BIRMINGHAM/VRN-DUE LIST ;9/19/12 12:08am
"RTN","PSBODL1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**5,9,32,28,68,70**;Mar 2004;Build 101
"RTN","PSBODL1",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified. 
"RTN","PSBODL1",4,0)
 ;
"RTN","PSBODL1",5,0)
 ;*68 - print New unlimited Wp Special Instructions/OPI fields
"RTN","PSBODL1",6,0)
 ;*70 - add Psbsrchl to HDR
"RTN","PSBODL1",7,0)
 ;
"RTN","PSBODL1",8,0)
EN ;
"RTN","PSBODL1",9,0)
 N QQ
"RTN","PSBODL1",10,0)
 S PSBFOHDR=0
"RTN","PSBODL1",11,0)
 S PSBORD=0 F  S PSBORD=$O(^TMP("PSBO",$J,DFN,PSBORD)) Q:PSBORD=""  S PSBTYPE=$O(^TMP("PSBO",$J,DFN,PSBORD,"")) D
"RTN","PSBODL1",12,0)
 .D CLEAN^PSBVT
"RTN","PSBODL1",13,0)
 .D PSJ1^PSBVT(DFN,PSBORD)
"RTN","PSBODL1",14,0)
 .I PSBSCHT="C" D  Q:PSBADMIN=""
"RTN","PSBODL1",15,0)
 ..S PSBX=PSBADST,PSBFLAG=1
"RTN","PSBODL1",16,0)
 ..I PSBX="",PSBONX["V",PSBIVT'="P" S PSBFLAG=0
"RTN","PSBODL1",17,0)
 ..S (PSBYES,PSBODD)=0
"RTN","PSBODL1",18,0)
 ..S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBODL1",19,0)
 ..F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1
"RTN","PSBODL1",20,0)
 ..I PSBYES,PSBADST="",PSBSCHT'="O",PSBSCHT'="OC",PSBSCHT'="P"  Q
"RTN","PSBODL1",21,0)
 ..I PSBFREQ="O" S PSBFREQ=1440
"RTN","PSBODL1",22,0)
 ..I 'PSBYES,PSBADST="",PSBFREQ<1 Q
"RTN","PSBODL1",23,0)
 ..I +PSBFREQ>0 I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBODL1",24,0)
 ..I PSBODD,PSBADST'="" Q
"RTN","PSBODL1",25,0)
 ..D:PSBX=""
"RTN","PSBODL1",26,0)
 ...I PSBIVT="C",PSBCHEMT="A" S PSBX="0000",PSBFLAG=0
"RTN","PSBODL1",27,0)
 ...I PSBIVT="C",PSBISYR=0 S PSBX="0000",PSBFLAG=0
"RTN","PSBODL1",28,0)
 ...I PSBIVT="S",PSBISYR=0 S PSBX="0000",PSBFLAG=0
"RTN","PSBODL1",29,0)
 ...I "HA"[PSBIVT S PSBX="0000",PSBFLAG=0
"RTN","PSBODL1",30,0)
 ..I ("SC"[PSBIVT),(PSBISYR=1) S PSBX=""
"RTN","PSBODL1",31,0)
 ..I (PSBIVT="C"),(PSBCHEMT="P") S PSBX=""
"RTN","PSBODL1",32,0)
 ..I PSBOTYP="U",PSBX="0000" S PSBX=""
"RTN","PSBODL1",33,0)
 ..I PSBIVT="P",$G(PSBX)=0 S PSBX=""
"RTN","PSBODL1",34,0)
 ..I PSBX="" S PSBX=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBEVDT)
"RTN","PSBODL1",35,0)
 ..E  K ^TMP("PSB",$J,"GETADMIN") S ^TMP("PSB",$J,"GETADMIN",0)=PSBX
"RTN","PSBODL1",36,0)
 ..S PSBADMIN=""
"RTN","PSBODL1",37,0)
 ..F PSBXX=0:1 Q:'$D(^TMP("PSB",$J,"GETADMIN",PSBXX))  S PSBX=$G(^TMP("PSB",$J,"GETADMIN",PSBXX)) D
"RTN","PSBODL1",38,0)
 ...F PSBY=1:1:$L(PSBX,"-")  D
"RTN","PSBODL1",39,0)
 ....Q:($P(PSBX,"-",PSBY)'?2N)&($P(PSBX,"-",PSBY)'?4N)
"RTN","PSBODL1",40,0)
 ....S PSBAT=+(PSBODATE_"."_$P(PSBX,"-",PSBY))
"RTN","PSBODL1",41,0)
 ....I PSBFLAG Q:PSBAT<PSBOSTRT!(PSBAT>PSBOSTOP)  ; Report Window
"RTN","PSBODL1",42,0)
 ....D VAL^PSBMLVAL(.PSBZ,DFN,PSBONX,PSBTYPE,PSBAT)
"RTN","PSBODL1",43,0)
 ....S:$G(PSBFREQ)>29 PSBADMIN=PSBADMIN_$S(PSBADMIN]"":"-",1:"")_$P(PSBX,"-",PSBY)
"RTN","PSBODL1",44,0)
 ....S:$G(PSBFREQ)<30 PSBADMIN="Due every "_$G(PSBFREQ)_" minutes."
"RTN","PSBODL1",45,0)
 .I PSBSCHT'="C" S PSBADMIN=PSBADST
"RTN","PSBODL1",46,0)
 .; Get LAST GIVEN date/time
"RTN","PSBODL1",47,0)
 .S PSBLGDT="",X=""
"RTN","PSBODL1",48,0)
 .F  S X=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,X),-1) Q:'X  D  Q:PSBLGDT
"RTN","PSBODL1",49,0)
 ..S PSBIEN=""
"RTN","PSBODL1",50,0)
 ..F  S PSBIEN=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,X,PSBIEN),-1) Q:PSBIEN=""  D  Q:PSBLGDT
"RTN","PSBODL1",51,0)
 ...S:"MHNR"'[$P($G(^PSB(53.79,PSBIEN,0)),U,9) PSBLGDT=X
"RTN","PSBODL1",52,0)
 .I $Y>(IOSL-12) I $Y<(IOSL-4) W !?(IOM-36\2),"(Medications Continued on Next Page)",$$FTR(),$$HDR()
"RTN","PSBODL1",53,0)
 .I PSBSM S PSBSM=$S(PSBSMX:"H",1:"")_"SM"
"RTN","PSBODL1",54,0)
 .E  S PSBSM=""
"RTN","PSBODL1",55,0)
 .I 'PSBFOHDR S PSBFOHDR=1 W $$HDR()
"RTN","PSBODL1",56,0)
 .W !,$J(PSBSM,3),?6,PSBTYPE,$E(PSBSCHT,1,4),?12 S PSBWFLAG=1
"RTN","PSBODL1",57,0)
 .S X="",Y=0
"RTN","PSBODL1",58,0)
 .W $$WRAP(14,34,PSBOITX)
"RTN","PSBODL1",59,0)
 .S PSBADM="Give: "_PSBDOSE_"  "_PSBSCH
"RTN","PSBODL1",60,0)
 .W $$WRAP(50,27,PSBADM)
"RTN","PSBODL1",61,0)
 .W $$WRAP(78,6,PSBMR)
"RTN","PSBODL1",62,0)
 .W ?85 I PSBLGDT W $E(PSBLGDT,4,5),"/",$E(PSBLGDT,6,7),"/",$E(PSBLGDT,2,3) W "@",$E($P(PSBLGDT,".",2)_"0000",1,4)
"RTN","PSBODL1",63,0)
 .W ?100,$P($TR($$FMTE^XLFDT(PSBOST,2),"@"," ")," ")
"RTN","PSBODL1",64,0)
 .W ?110,$P($TR($$FMTE^XLFDT(PSBOSP,2),"@"," ")," ")
"RTN","PSBODL1",65,0)
 .W ?120,$S(PSBVPHI]"":PSBVPHI,1:"***"),"/",$S(PSBVNI]"":PSBVNI,1:"***")
"RTN","PSBODL1",66,0)
 .W !,?100,"@"_$P(PSBOSTX,"  ",2),?110,"@"_$P(PSBOSPX,"  ",2)
"RTN","PSBODL1",67,0)
 .W IOINHI  ; To Highlight the Dispense Drugs...
"RTN","PSBODL1",68,0)
 .I $D(PSBDDA) S Y=0 F  S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBODL1",69,0)
 ..Q:$P(PSBDDA(Y),U,5)&($P(PSBDDA(Y),U,5)<PSBNOW)
"RTN","PSBODL1",70,0)
 ..W !?14,"*",$$WRAP(15,33,$P(PSBDDA(Y),U,3)_" ("_+$P(PSBDDA(Y),U,2)_")")
"RTN","PSBODL1",71,0)
 .I $D(PSBADA) S Y=0 F  S Y=$O(PSBADA(Y)) Q:'Y  W !?14,"*",$$WRAP(15,33,$P(PSBADA(Y),U,3)_" ("_$P(PSBADA(Y),U,4)_")")
"RTN","PSBODL1",72,0)
 .I $D(PSBSOLA) S Y=0 F  S Y=$O(PSBSOLA(Y)) Q:'Y  W !?14,"*",$$WRAP(15,33,$P(PSBSOLA(Y),U,3)_" ("_$P(PSBSOLA(Y),U,4)_")")
"RTN","PSBODL1",73,0)
 .W IOINORM ; Highlight Off
"RTN","PSBODL1",74,0)
 .S PSBADM=$S(PSBADMIN]"":"Admin Times: "_PSBADMIN,1:"")
"RTN","PSBODL1",75,0)
 .W:PSBADM]"" $$WRAP(50,27,PSBADM)
"RTN","PSBODL1",76,0)
 .;*68 begin
"RTN","PSBODL1",77,0)
 .I PSBSIFLG,'$G(^TMP("PSJBCMA5",$J,DFN,PSBORD)) D
"RTN","PSBODL1",78,0)
 ..W !?14,"Special Instructions:",?36,"<None Entered.>",DFN,U,PSBORD,"<"
"RTN","PSBODL1",79,0)
 .D:PSBSIFLG
"RTN","PSBODL1",80,0)
 ..F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,DFN,PSBORD,QQ)) Q:'QQ  D
"RTN","PSBODL1",81,0)
 ...W:QQ=1 !?14,"Special Instructions:",?36,^TMP("PSJBCMA5",$J,DFN,PSBORD,QQ)
"RTN","PSBODL1",82,0)
 ...W:QQ>1 !?36,^TMP("PSJBCMA5",$J,DFN,PSBORD,QQ)
"RTN","PSBODL1",83,0)
 .W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL1",84,0)
 I '$G(PSBWFLAG) W !!,?10,"** NO SPECIFIED MEDICATIONS TO PRINT **"
"RTN","PSBODL1",85,0)
 W:PSBFOHDR $$BLANKS(),$$FTR()
"RTN","PSBODL1",86,0)
 K ^TMP("PSB",$J,"GETADMIN")
"RTN","PSBODL1",87,0)
 Q
"RTN","PSBODL1",88,0)
 ;
"RTN","PSBODL1",89,0)
WRAPPUP ;Do wrapping per PSBODL (Due List Report)
"RTN","PSBODL1",90,0)
 ;
"RTN","PSBODL1",91,0)
 W $$WRAP(14,34,PSBMED)
"RTN","PSBODL1",92,0)
 S PSBADM="Give: "_PSBDOSE_"  "_PSBSCH
"RTN","PSBODL1",93,0)
 W $$WRAP(50,27,PSBADM),?78,$$WRAP(78,6,PSBMR)
"RTN","PSBODL1",94,0)
 W ?85 D:PSBLGDT
"RTN","PSBODL1",95,0)
 .W $E(PSBLGDT,4,5),"/",$E(PSBLGDT,6,7),"/",$E(PSBLGDT,2,3),"@",$E($P(PSBLGDT,".",2)_"0000",1,4)
"RTN","PSBODL1",96,0)
 W ?100,$P($TR($$FMTE^XLFDT(PSBOST,2),"@"," ")," "),?110,$P($TR($$FMTE^XLFDT(PSBOSP,2),"@"," ")," "),?120,$S(PSBVPHI]"":PSBVPHI,1:"***"),"/"
"RTN","PSBODL1",97,0)
 W $S(PSBVNI]"":PSBVNI,1:"***"),!,?100,"@"_$P(PSBOSTX,"  ",2),?110,"@"_$P(PSBOSPX,"  ",2)
"RTN","PSBODL1",98,0)
 W IOINHI
"RTN","PSBODL1",99,0)
 I $D(PSBDDA) S Y=0 F  S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBODL1",100,0)
 .Q:$P(PSBDDA(Y),U,5)&($P(PSBDDA(Y),U,5)<PSBNOW)
"RTN","PSBODL1",101,0)
 .W !?14,"*",$$WRAP(15,33,$P(PSBDDA(Y),U,3)) ;_" ("_+$P(PSBDDA(Y),U,2)_")")
"RTN","PSBODL1",102,0)
 I $D(PSBADA) S Y=0 F  S Y=$O(PSBADA(Y)) Q:'Y  W !?14,"*",$$WRAP(15,33,$P(PSBADA(Y),U,3)) ;_" ("_$P(PSBADA(Y),U,4)_")")
"RTN","PSBODL1",103,0)
 I $D(PSBSOLA) S Y=0 F  S Y=$O(PSBSOLA(Y)) Q:'Y  W !?14,"*",$$WRAP(15,33,$P(PSBSOLA(Y),U,3)) ;_" ("_$P(PSBSOLA(Y),U,4)_")")
"RTN","PSBODL1",104,0)
 W IOINORM ; Hlight Off
"RTN","PSBODL1",105,0)
 S PSBADM=$S(PSBADMIN]"":"Admin Times: "_PSBADMIN,1:"")
"RTN","PSBODL1",106,0)
 W:PSBADM]"" $$WRAP(50,27,PSBADM)
"RTN","PSBODL1",107,0)
 ;*68 begin
"RTN","PSBODL1",108,0)
 I PSBSIFLG,'$G(^TMP("PSJBCMA5",$J,DFN,PSBORD)) W !?14,"Special Instructions:",?36,"<None Entered.>"
"RTN","PSBODL1",109,0)
 D:PSBSIFLG
"RTN","PSBODL1",110,0)
 .F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,DFN,PSBORD,QQ)) Q:'QQ  D
"RTN","PSBODL1",111,0)
 ..W:QQ=1 !?14,"Special Instructions:"
"RTN","PSBODL1",112,0)
 ..W:QQ>1 !
"RTN","PSBODL1",113,0)
 ..W ?36,^TMP("PSJBCMA5",$J,DFN,PSBORD,QQ)
"RTN","PSBODL1",114,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL1",115,0)
 Q
"RTN","PSBODL1",116,0)
 ;
"RTN","PSBODL1",117,0)
WRAP(X,Y,Z) ; Quick text wrap
"RTN","PSBODL1",118,0)
 F  Q:'$L(Z)  D
"RTN","PSBODL1",119,0)
 .W:$X>X !
"RTN","PSBODL1",120,0)
 .W:$X<X ?X
"RTN","PSBODL1",121,0)
 .I $L(Z)<Y W Z S Z="" Q
"RTN","PSBODL1",122,0)
 .F PSB=Y:-1:0 Q:$E(Z,PSB)=" "
"RTN","PSBODL1",123,0)
 .S:PSB<1 PSB=Y
"RTN","PSBODL1",124,0)
 .W $E(Z,1,PSB)
"RTN","PSBODL1",125,0)
 .S Z=$E(Z,PSB+1,255)
"RTN","PSBODL1",126,0)
 Q ""
"RTN","PSBODL1",127,0)
 ;
"RTN","PSBODL1",128,0)
FTR() ; [Extrinsic] Page footer
"RTN","PSBODL1",129,0)
 ;
"RTN","PSBODL1",130,0)
 ; Sub Module Description:
"RTN","PSBODL1",131,0)
 ; (No Description Available)
"RTN","PSBODL1",132,0)
 ;
"RTN","PSBODL1",133,0)
 I (IOSL<100) F  Q:$Y>(IOSL-10)  W !
"RTN","PSBODL1",134,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","PSBODL1",135,0)
 S X="Ward: "_PSBHDR("WARD")_"  Room-Bed: "_PSBHDR("ROOM")
"RTN","PSBODL1",136,0)
 W !,PSBHDR("NAME"),?(IOM-11\2),PSBHDR("SSN"),?(IOM-$L(X)),X
"RTN","PSBODL1",137,0)
 Q ""
"RTN","PSBODL1",138,0)
 ;
"RTN","PSBODL1",139,0)
HDR() ; Page Header
"RTN","PSBODL1",140,0)
 Q:'PSBFOHDR ""
"RTN","PSBODL1",141,0)
 D PT^PSBOHDR(DFN,.PSBHDR,,,PSBSRCHL)                            ;*70
"RTN","PSBODL1",142,0)
 W !
"RTN","PSBODL1",143,0)
 W !
"RTN","PSBODL1",144,0)
 W !,?(IOM-28\2),"*****   FUTURE ORDERS   *****"
"RTN","PSBODL1",145,0)
 W !
"RTN","PSBODL1",146,0)
 W !,"Self",?85,"Last",?100,"Start",?110,"Stop",?120,"Verifying"
"RTN","PSBODL1",147,0)
 W !,"Med",?6,"Sched",?14,"Medication",?50,"Dose",?78,"Route",?85,"Given",?100,"Date",?110,"Date",?120,"Rph/Rn"
"RTN","PSBODL1",148,0)
 W !,?100,"@Time",?110,"@Time"
"RTN","PSBODL1",149,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL1",150,0)
 Q ""
"RTN","PSBODL1",151,0)
 ;
"RTN","PSBODL1",152,0)
BLANKS() ; [Extrinsic] Print blanks at end of printout for changes
"RTN","PSBODL1",153,0)
 Q:'$P(PSBRPT(.2),U,5) ""
"RTN","PSBODL1",154,0)
 W !
"RTN","PSBODL1",155,0)
 I $Y>(IOSL-26) W ?(IOM-42\2),"(Changes/Addendums to Orders on Next Page)" W $$FTR(),$$HDR() ; Not enough space - new page
"RTN","PSBODL1",156,0)
 I IOSL<100 F  Q:$Y>(IOSL-26)  W !
"RTN","PSBODL1",157,0)
 W ?(IOM-28\2),"Changes/Addendums to orders"
"RTN","PSBODL1",158,0)
 F X=1:1:4 D
"RTN","PSBODL1",159,0)
 .W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL1",160,0)
 .W !!?3,"CON ___ PRN ___",?20,"Drug: ",$TR($J("",22)," ","_"),?50,"Give: ",$TR($J("",42)," ","_"),?100,"Start: _________ Stop: _________"
"RTN","PSBODL1",161,0)
 .W !?20,"Spec"
"RTN","PSBODL1",162,0)
 .W !?3,"OT  ___ OC  ___",?20,"Inst: ",$TR($J("",72)," ","_"),?100,"Initials: ______ Date: _________"
"RTN","PSBODL1",163,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL1",164,0)
 Q ""
"RTN","PSBODL1",165,0)
 ;
"RTN","PSBODO")
0^14^B38012086^B36995822
"RTN","PSBODO",1,0)
PSBODO ;BRMINGHAM/EFC-BCMA UNIT DOSE VIRTUAL DUE LIST FUNCTIONS ;10/18/12 7:58pm
"RTN","PSBODO",2,0)
 ;;3.0;BAR CODE MED ADMIN;**5,21,24,38,58,68,70**;Mar 2004;Build 101
"RTN","PSBODO",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSBODO",4,0)
 ;
"RTN","PSBODO",5,0)
 ; Reference/IA
"RTN","PSBODO",6,0)
 ; EN^PSJBCMA2/2830
"RTN","PSBODO",7,0)
 ; GETPROVL^PSGSICH1/5653
"RTN","PSBODO",8,0)
 ; INTRDIC^PSGSICH1/5654
"RTN","PSBODO",9,0)
 ; GETSIOPI^PSJBCMA5/5763
"RTN","PSBODO",10,0)
 ;
"RTN","PSBODO",11,0)
 ;*68 - add ability to print new WP Special Instructions/OPI fields
"RTN","PSBODO",12,0)
 ;*58 - add sections to display Prv Override comments and Rph
"RTN","PSBODO",13,0)
 ;      Interventions to this report for (critical drug/drug and all
"RTN","PSBODO",14,0)
 ;      adverse reactions/allergies)
"RTN","PSBODO",15,0)
 ;*70 - print clinic name at top of detail section if exists.
"RTN","PSBODO",16,0)
EN ;
"RTN","PSBODO",17,0)
 ;
"RTN","PSBODO",18,0)
 ; Description:
"RTN","PSBODO",19,0)
 ; Returns a display for a selected order when double clicked on the VDL
"RTN","PSBODO",20,0)
 ;
"RTN","PSBODO",21,0)
 N PSBGBL,DFN
"RTN","PSBODO",22,0)
 S PSBGBL=$NAME(^TMP("PSBO",$J,"B"))
"RTN","PSBODO",23,0)
 F  S PSBGBL=$Q(@PSBGBL) Q:PSBGBL=""  Q:$QS(PSBGBL,2)'=$J  Q:$QS(PSBGBL,1)'["PSBO"  D
"RTN","PSBODO",24,0)
 .S DFN=$QS(PSBGBL,5)
"RTN","PSBODO",25,0)
 .D DISPORD
"RTN","PSBODO",26,0)
 Q
"RTN","PSBODO",27,0)
 ;
"RTN","PSBODO",28,0)
DISPORD ;
"RTN","PSBODO",29,0)
 N PSBGBL,PSBOI,PSBHDR,PSJGLO,LINE,PSBPRV,PSBPV,PSBRPH,PSBRH,PSBOVR,I,X,Y
"RTN","PSBODO",30,0)
 S PSBOI=$$GET1^DIQ(53.69,PSBRPT_",",.09)
"RTN","PSBODO",31,0)
 D EN^PSJBCMA2(DFN,PSBOI)
"RTN","PSBODO",32,0)
 S PSJGLO="^TMP(""PSJ"""_","_$J
"RTN","PSBODO",33,0)
 D CLEAN^PSBVT
"RTN","PSBODO",34,0)
 D PSJ1^PSBVT(DFN,PSBOI)
"RTN","PSBODO",35,0)
 S PSBHDR(1)="BCMA - Display Order" D PT^PSBOHDR(DFN,.PSBHDR) W !
"RTN","PSBODO",36,0)
 I '$G(PSBONX) W !,"Invalid Order"
"RTN","PSBODO",37,0)
 D:$G(PSBONX)
"RTN","PSBODO",38,0)
 .W:$G(PSBCLORD)]"" "Clinic: "_PSBCLORD,!                         ;*70
"RTN","PSBODO",39,0)
 .W !,"Orderable Item: ",PSBOITX
"RTN","PSBODO",40,0)
 .I PSBONX["V" W !,"Infusion Rate:  ",PSBIFR
"RTN","PSBODO",41,0)
 .I PSBONX'["V" W !,"Dosage Ordered: ",PSBDOSE
"RTN","PSBODO",42,0)
 .W ?40,"Start:    ",PSBOSTX
"RTN","PSBODO",43,0)
 .W !?40,"Stop:     ",PSBOSPX,?70,PSBOSTSX                        ;*70
"RTN","PSBODO",44,0)
 .W !,"Med Route:      ",PSBMR
"RTN","PSBODO",45,0)
 .W !,"Schedule Type:  ",PSBSCHTX
"RTN","PSBODO",46,0)
 .I PSBONX'["V" W ?40,"Self Med: ",PSBSMX
"RTN","PSBODO",47,0)
 .W:PSBSM !?40,"Hosp Sup: ",PSBSMX
"RTN","PSBODO",48,0)
 .W:PSBSCH'="" !,"Schedule: ",PSBSCH
"RTN","PSBODO",49,0)
 .I PSBONX'["V" W !,"Admin Times:    ",PSBADST
"RTN","PSBODO",50,0)
 .I PSBONX["V",((PSBIVT="P")!(PSBISYR=1)) W !,"Admin Times:    ",PSBADST
"RTN","PSBODO",51,0)
 .W !,"Provider: ",PSBMDX
"RTN","PSBODO",52,0)
 .;*68 change
"RTN","PSBODO",53,0)
 .W !,"Special Instructions/Other Print Info:"
"RTN","PSBODO",54,0)
 .K ^TMP("PSJBCMA5",$J)
"RTN","PSBODO",55,0)
 .D GETSIOPI^PSJBCMA5(DFN,PSBONX,1)
"RTN","PSBODO",56,0)
 .F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,DFN,PSBONX,QQ)) Q:'QQ  D
"RTN","PSBODO",57,0)
 ..W !,^TMP("PSJBCMA5",$J,DFN,PSBONX,QQ)
"RTN","PSBODO",58,0)
 .K ^TMP("PSJBCMA5",$J)
"RTN","PSBODO",59,0)
 .;*68 end
"RTN","PSBODO",60,0)
 .;*58 override/intervention section * * *
"RTN","PSBODO",61,0)
 .S PSBOVR=0
"RTN","PSBODO",62,0)
 .D GETPROVL^PSGSICH1(DFN,PSBONX,.PSBPRV)
"RTN","PSBODO",63,0)
 .D INTRDIC^PSGSICH1(DFN,PSBONX,.PSBRPH,2)
"RTN","PSBODO",64,0)
 .S PSBPV=$S($D(PSBPRV)>1:1,1:0)
"RTN","PSBODO",65,0)
 .S PSBRH=$S($D(PSBRPH)>1:1,1:0)
"RTN","PSBODO",66,0)
 .I 'PSBPV,PSBRH D DSPPRV(.PSBPRV,132,2,26,1) S PSBOVR=1
"RTN","PSBODO",67,0)
 .I PSBPV D DSPPRV(.PSBPRV,132,2,26) S PSBOVR=1
"RTN","PSBODO",68,0)
 .I PSBPV,'PSBRH D DSPRPH(.PSBRPH,132,2,26,1) S PSBOVR=1
"RTN","PSBODO",69,0)
 .I PSBRH D DSPRPH(.PSBRPH,132,2,26) S PSBOVR=1
"RTN","PSBODO",70,0)
 .I PSBOVR W !,$TR($J("",75)," ","-")
"RTN","PSBODO",71,0)
 .;*58 end override/intervention section * * *
"RTN","PSBODO",72,0)
 .;
"RTN","PSBODO",73,0)
 .W !
"RTN","PSBODO",74,0)
 .I $D(PSBDDA(1)) D
"RTN","PSBODO",75,0)
 ..W !,"Dispense Drugs",!,"Drug Name",?40,"Units",?50,"Inactive Date"
"RTN","PSBODO",76,0)
 ..W !,$TR($J("",75)," ","-")
"RTN","PSBODO",77,0)
 ..F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBODO",78,0)
 ...S X=$P(PSBDDA(Y),U,4)
"RTN","PSBODO",79,0)
 ...W !,$P(PSBDDA(Y),U,3),?40,$S(X]"":X,1:1)
"RTN","PSBODO",80,0)
 ...S X=$P(PSBDDA(Y),U,5) Q:'X
"RTN","PSBODO",81,0)
 ...W ?50,$E(X,4,5),"/",$E(X,6,7),"/",(1700+$E(X,1,3))
"RTN","PSBODO",82,0)
 .I $D(PSBADA(1)) D
"RTN","PSBODO",83,0)
 ..W !!,"Additives",!,"Name",?40,"Strength"
"RTN","PSBODO",84,0)
 ..W !,$TR($J("",75)," ","-")
"RTN","PSBODO",85,0)
 ..F Y=0:0 S Y=$O(PSBADA(Y)) Q:'Y  D
"RTN","PSBODO",86,0)
 ...W !,$P(PSBADA(Y),U,3),?40,$P(PSBADA(Y),U,4)
"RTN","PSBODO",87,0)
 .I $D(PSBSOLA(1)) D
"RTN","PSBODO",88,0)
 ..W !!,"Solution",!,"Name",?40,"Volume"
"RTN","PSBODO",89,0)
 ..W !,$TR($J("",75)," ","-")
"RTN","PSBODO",90,0)
 ..F Y=0:0 S Y=$O(PSBSOLA(Y)) Q:'Y  D
"RTN","PSBODO",91,0)
 ...W !,$P(PSBSOLA(Y),U,3),?40,$P(PSBSOLA(Y),U,4)
"RTN","PSBODO",92,0)
 .I $P(@(PSJGLO_","_0_")"),U,1)'=-1 D
"RTN","PSBODO",93,0)
 ..W !,$TR($J("",75)," ","-")
"RTN","PSBODO",94,0)
 ..W !,"Pharmacy Activity Log: "
"RTN","PSBODO",95,0)
 ..F I=1:1:$P(@(PSJGLO_","_0_")"),U,4) D
"RTN","PSBODO",96,0)
 ...W !?9,"Date:  ",$$FMTE^XLFDT($P(@(PSJGLO_","_I_","_1_")"),U,1)),?35,"User:  ",$P(@(PSJGLO_","_I_","_1_")"),U,2)
"RTN","PSBODO",97,0)
 ...W !?5,"Activity:  ",$P(@(PSJGLO_","_I_","_1_")"),U,4)
"RTN","PSBODO",98,0)
 ...I $D(@(PSJGLO_","_I_","_2_")")) W !?8,"Field:  ",$P(@(PSJGLO_","_I_","_1_")"),U,3),!?5,"Old Data:  ",@(PSJGLO_","_I_","_2_")")
"RTN","PSBODO",99,0)
 ...I $D(@(PSJGLO_","_I_","_3_")")) W !?7,"Reason:  ",@(PSJGLO_","_I_","_3_")")
"RTN","PSBODO",100,0)
 ...W !
"RTN","PSBODO",101,0)
 W !!
"RTN","PSBODO",102,0)
 D CLEAN^PSBVT K @(PSJGLO_")")
"RTN","PSBODO",103,0)
 Q
"RTN","PSBODO",104,0)
 ;
"RTN","PSBODO",105,0)
DSPPRV(ARR,LN,IND,ALGN,NONE) ; Display Provider (CPRS) override reasons
"RTN","PSBODO",106,0)
 ; ARR  = array with provider override text.
"RTN","PSBODO",107,0)
 ; LN   = total width of report writable area.      (opt, 132 default)
"RTN","PSBODO",108,0)
 ; IND  = indent for both left and right margins.      (opt,0 default)
"RTN","PSBODO",109,0)
 ; ALGN = align colon on this column.                (opt, 25 default)
"RTN","PSBODO",110,0)
 ; NONE = display empty Provider override msg.        (opt, 0 default)
"RTN","PSBODO",111,0)
 ;
"RTN","PSBODO",112,0)
 N CAT,QQ,OC,HDG,CTRTAB,TMPONX,LINE,L1,L2,XX
"RTN","PSBODO",113,0)
 S LN=+$G(LN,132),IND=+$G(IND),ALGN=$G(ALGN,25),NONE=$G(NONE,0)
"RTN","PSBODO",114,0)
 S LN=LN-(IND*2)    ;adj writeable area by both L & R margins
"RTN","PSBODO",115,0)
 ;provider heading
"RTN","PSBODO",116,0)
 W !!?IND,$TR($J("",LN)," ","=")
"RTN","PSBODO",117,0)
 S HDG="** Current Provider Overrides for this order **"
"RTN","PSBODO",118,0)
 S CTRTAB=(LN-$L(HDG))/2
"RTN","PSBODO",119,0)
 W !?CTRTAB,HDG
"RTN","PSBODO",120,0)
 W !?IND,$TR($J("",LN)," ","="),!
"RTN","PSBODO",121,0)
 ;
"RTN","PSBODO",122,0)
 ;special scenario when NO Prv overrides, but Rph Interventions do
"RTN","PSBODO",123,0)
 I NONE W !?IND,"No Provider Overrides to display.",! Q
"RTN","PSBODO",124,0)
 ;
"RTN","PSBODO",125,0)
 ;provider body text
"RTN","PSBODO",126,0)
 S TMPONX=$O(ARR("PROV",DFN,"")) I TMPONX D
"RTN","PSBODO",127,0)
 .S QQ="" F  S QQ=$O(ARR("PROV",DFN,+TMPONX,QQ)) Q:QQ=""  D
"RTN","PSBODO",128,0)
 ..S LINE=ARR("PROV",DFN,+TMPONX,QQ),XX=$F(LINE,":")
"RTN","PSBODO",129,0)
 ..S L1=$J($E(LINE,1,XX),ALGN),L2=$E(LINE,XX+1,$L(LINE))
"RTN","PSBODO",130,0)
 ..W !?IND,L1,L2
"RTN","PSBODO",131,0)
 .W !
"RTN","PSBODO",132,0)
 S CAT=0 F  S CAT=$O(ARR("PROVR",DFN,+TMPONX,CAT)) Q:'CAT  D
"RTN","PSBODO",133,0)
 .S OC=0 F  S OC=$O(ARR("PROVR",DFN,+TMPONX,CAT,OC)) Q:'OC  D
"RTN","PSBODO",134,0)
 ..S LINE=ARR("PROVR",DFN,+TMPONX,CAT,OC,0),XX=$F(LINE,":")
"RTN","PSBODO",135,0)
 ..S L1=$J($E(LINE,1,XX),ALGN),L2=$E(LINE,XX+1,$L(LINE))
"RTN","PSBODO",136,0)
 ..W !,?IND,$$WRAP^PSBO(IND,LN,LINE),!
"RTN","PSBODO",137,0)
 Q
"RTN","PSBODO",138,0)
 ;
"RTN","PSBODO",139,0)
DSPRPH(ARR,LN,IND,ALGN,NONE) ; Display Pharmacist Interventions
"RTN","PSBODO",140,0)
 ; ARR  = array with Pharmacist intervention text.               (opt)
"RTN","PSBODO",141,0)
 ; LN   = total width of report writable area.       (opt,132 default)
"RTN","PSBODO",142,0)
 ; IND  = indent for both left and right margins.     (opt, 0 default)
"RTN","PSBODO",143,0)
 ; ALGN = align colon on this column.                (opt. 25 default)
"RTN","PSBODO",144,0)
 ; NONE = display empty Pharmacist intervention msg.  (opt, 0 default)
"RTN","PSBODO",145,0)
 ;
"RTN","PSBODO",146,0)
 N FLD,WP,WPTAG,WPLIN,HDG,INT,CTRTAB,LINE,L1,L2,XX
"RTN","PSBODO",147,0)
 S LN=+$G(LN,132),IND=+$G(IND),ALGN=$G(ALGN,25),NONE=$G(NONE,0)
"RTN","PSBODO",148,0)
 S LN=LN-(IND*2)         ;adj writeable area by both L & R margins
"RTN","PSBODO",149,0)
 ;
"RTN","PSBODO",150,0)
 ;pharmacist heading
"RTN","PSBODO",151,0)
 W !?IND,$TR($J("",LN)," ","=")
"RTN","PSBODO",152,0)
 S HDG="** Current Pharmacist Interventions for this order **"
"RTN","PSBODO",153,0)
 S CTRTAB=(LN-$L(HDG))/2
"RTN","PSBODO",154,0)
 W !?CTRTAB,HDG
"RTN","PSBODO",155,0)
 W !?IND,$TR($J("",LN)," ","="),!
"RTN","PSBODO",156,0)
 ;
"RTN","PSBODO",157,0)
 ;special scenario when NO Rph interventions, but Prv overrides do
"RTN","PSBODO",158,0)
 I NONE W !?IND,"No Pharmacist Interventions to display.",! Q
"RTN","PSBODO",159,0)
 ;
"RTN","PSBODO",160,0)
 ;pharmacist body text
"RTN","PSBODO",161,0)
 F INT=0:0 S INT=$O(ARR(DFN,PSBONX,INT)) Q:'INT  D
"RTN","PSBODO",162,0)
 .F FLD=0:0 S FLD=$O(ARR(DFN,PSBONX,INT,FLD)) Q:'FLD  D
"RTN","PSBODO",163,0)
 ..I FLD<1000 D
"RTN","PSBODO",164,0)
 ...S LINE=ARR(DFN,PSBONX,INT,FLD),XX=$F(LINE,":")
"RTN","PSBODO",165,0)
 ...S L1=$J($E(LINE,1,XX),ALGN),L2=$E(LINE,XX+1,$L(LINE))
"RTN","PSBODO",166,0)
 ...W !?IND,L1,L2
"RTN","PSBODO",167,0)
 ..I FLD>1000 D
"RTN","PSBODO",168,0)
 ...S (WP,WPLIN,WPTAG)="",LIN1=1
"RTN","PSBODO",169,0)
 ...F  S WP=$O(ARR(DFN,PSBONX,INT,FLD,WP)) Q:WP=""  D
"RTN","PSBODO",170,0)
 ....S LINE=ARR(DFN,PSBONX,INT,FLD,WP)
"RTN","PSBODO",171,0)
 ....I WP<1 D                          ;field Hdg line
"RTN","PSBODO",172,0)
 .....S LINE=$J(LINE,ALGN) W !?IND,LINE
"RTN","PSBODO",173,0)
 ....E  D                              ;detail WP lines
"RTN","PSBODO",174,0)
 .....I 'LIN1 W !
"RTN","PSBODO",175,0)
 .....W ?IND+ALGN,LINE
"RTN","PSBODO",176,0)
 .....S LIN1=0
"RTN","PSBODO",177,0)
 .W !
"RTN","PSBODO",178,0)
 W !
"RTN","PSBODO",179,0)
 Q
"RTN","PSBOHDR")
0^26^B71757590^B25654134
"RTN","PSBOHDR",1,0)
PSBOHDR ;BIRMINGHAM/EFC - REPORT HEADERS ;12/12/12 12:12pm
"RTN","PSBOHDR",2,0)
 ;;3.0;BAR CODE MED ADMIN;**5,13,42,74,70**;Mar 2004;Build 101
"RTN","PSBOHDR",3,0)
 ;
"RTN","PSBOHDR",4,0)
 ; Reference/IA
"RTN","PSBOHDR",5,0)
 ; EN6^GMRVUTL/1120
"RTN","PSBOHDR",6,0)
 ; WARD^NURSUT5/3052
"RTN","PSBOHDR",7,0)
 ; IN5^VADPT/10061
"RTN","PSBOHDR",8,0)
 ; DEM^VADPT/10061
"RTN","PSBOHDR",9,0)
 ;
"RTN","PSBOHDR",10,0)
 ;*70 - add to heading CLINIC ORDERS ONLY when in clinic exclusive
"RTN","PSBOHDR",11,0)
 ;      mode
"RTN","PSBOHDR",12,0)
 ;    - 1489: Blended PSB*3*74 with PSB*3*70
"RTN","PSBOHDR",13,0)
 ;
"RTN","PSBOHDR",14,0)
PT(DFN,PSBHDR,PSBCONT,PSBDT,SRCHTXT,SUBHD) ;
"RTN","PSBOHDR",15,0)
 ; DFN:     Patient File IEN
"RTN","PSBOHDR",16,0)
 ; PSBCONT: True if this is a continuation page
"RTN","PSBOHDR",17,0)
 ; PSBDT:   Date of Pt Information (Default to DT)
"RTN","PSBOHDR",18,0)
 ; SRCHTXT: User selection list
"RTN","PSBOHDR",19,0)
 ; SUBHD:   Sub heading if present - prints before body === line
"RTN","PSBOHDR",20,0)
 S SRCHTXT=$G(SRCHTXT),SUBHD=$G(SUBHD)    ;*70
"RTN","PSBOHDR",21,0)
 W:$Y>1 @IOF
"RTN","PSBOHDR",22,0)
 W:$X>1 !
"RTN","PSBOHDR",23,0)
 S:'$G(PSBDT) PSBDT=DT
"RTN","PSBOHDR",24,0)
 ; BUILD PSBHDR WITH ALL HEADER STUFF
"RTN","PSBOHDR",25,0)
 D:'$D(PSBHDR("NAME"))
"RTN","PSBOHDR",26,0)
 .S VAIP("D")="LAST"
"RTN","PSBOHDR",27,0)
 .D DEM^VADPT,IN5^VADPT
"RTN","PSBOHDR",28,0)
 .S PSBHDR("NAME")=VADM(1)
"RTN","PSBOHDR",29,0)
 .S PSBHDR("SSN")=VA("PID")
"RTN","PSBOHDR",30,0)
 .S PSBHDR("DOB")=$P(VADM(3),U,2)
"RTN","PSBOHDR",31,0)
 .S PSBHDR("AGE")=VADM(4)
"RTN","PSBOHDR",32,0)
 .S PSBHDR("SEX")=$P(VADM(5),U,2)
"RTN","PSBOHDR",33,0)
 .S PSBHDR("MVMTTYPE")=$P(VAIP(2),U,2)
"RTN","PSBOHDR",34,0)
 .S PSBHDR("MVMTLAST")=$P(VAIP(3),U,2)
"RTN","PSBOHDR",35,0)
 .S PSBHDR("WARD")=$P(VAIP(5),U,2)
"RTN","PSBOHDR",36,0)
 .S PSBHDR("ROOM")=$P(VAIP(6),U,2)
"RTN","PSBOHDR",37,0)
 .S PSBHDR("DX")=VAIP(9)
"RTN","PSBOHDR",38,0)
 .K VAIP,VADM,VA
"RTN","PSBOHDR",39,0)
 .;
"RTN","PSBOHDR",40,0)
 .;IHS/MSC/PLS - Call Vitals lookup based on agency code
"RTN","PSBOHDR",41,0)
 .;  and PCC Vitals package usage flag "BEHOVM USE VMSR"=1
"RTN","PSBOHDR",42,0)
 .I $G(DUZ("AG"))="I",$$GET^XPAR("ALL","BEHOVM USE VMSR") D
"RTN","PSBOHDR",43,0)
 ..S X=+$P($$VITAL^APSPFUNC(DFN,"HT"),U,2)
"RTN","PSBOHDR",44,0)
 ..S X=$$VITCHT^APSPFUNC(X)\1,PSBHDR("HEIGHT")=$S(X:X_"cm",1:"*")
"RTN","PSBOHDR",45,0)
 ..S X=+$P($$VITAL^APSPFUNC(DFN,"WT"),U,2)
"RTN","PSBOHDR",46,0)
 ..S X=$$VITCWT^APSPFUNC(X)\1,PSBHDR("WEIGHT")=$S(X:X_"kg",1:"*")
"RTN","PSBOHDR",47,0)
 .E  D
"RTN","PSBOHDR",48,0)
 ..S GMRVSTR="HT" D EN6^GMRVUTL
"RTN","PSBOHDR",49,0)
 ..S X=+$P(X,U,8) S:X X=X*2.54\1 S PSBHDR("HEIGHT")=$S(X:X_"cm",1:"*")
"RTN","PSBOHDR",50,0)
 ..S GMRVSTR="WT" D EN6^GMRVUTL
"RTN","PSBOHDR",51,0)
 ..S X=+$P(X,U,8) S:X X=X*.45\1 S PSBHDR("WEIGHT")=$S(X:X_"kg",1:"*")
"RTN","PSBOHDR",52,0)
 .;
"RTN","PSBOHDR",53,0)
 .N PSBADRX D ALLR^PSBALL(.PSBADRX,DFN) S X=0,Y=""
"RTN","PSBOHDR",54,0)
 .F  S X=$O(PSBADRX(X)) Q:'X  D
"RTN","PSBOHDR",55,0)
 ..Q:$P(PSBADRX(X),U,1)'="ADR"  S Z=$P(PSBADRX(X),U,2) Q:Z=""
"RTN","PSBOHDR",56,0)
 ..I $L(Y_Z)>(IOM-22) S PSBHDR("REAC",$O(PSBHDR("REAC",""),-1)+1)=Y,Y=""
"RTN","PSBOHDR",57,0)
 ..S Y=Y_$S(Y]"":", ",1:"")_$P(PSBADRX(X),U,2)
"RTN","PSBOHDR",58,0)
 .S:Y]"" PSBHDR("REAC",$O(PSBHDR("REAC",""),-1)+1)=Y
"RTN","PSBOHDR",59,0)
 .I '$D(PSBHDR("REAC")) S PSBHDR("REAC",1)="No ADRs on file."
"RTN","PSBOHDR",60,0)
 .D PSBALG
"RTN","PSBOHDR",61,0)
 .K GMRAL,GMRVSTR,GMRA,PSBARX
"RTN","PSBOHDR",62,0)
 .D NOW^%DTC S Y=+$E(%,1,12) D D^DIQ S PSBHDR("DATE")="Run Date: "_Y
"RTN","PSBOHDR",63,0)
 .S PSBHDR("PAGE")=0
"RTN","PSBOHDR",64,0)
 ;
"RTN","PSBOHDR",65,0)
 W $C(13),$TR($J("",IOM)," ","=")
"RTN","PSBOHDR",66,0)
 ;*70 insert across the board, a heading line base on the order mode
"RTN","PSBOHDR",67,0)
 ;    write line after the report name.  Some reports use PSBHDR(0)
"RTN","PSBOHDR",68,0)
 ;    for report name others use PSBHDR(1).
"RTN","PSBOHDR",69,0)
 W !,$G(PSBHDR(0))
"RTN","PSBOHDR",70,0)
 ; the DO report should not try to print a mode heading *70
"RTN","PSBOHDR",71,0)
 N DORPT S DORPT=$S($P(PSBRPT(0),"-")="DO":1,1:0)
"RTN","PSBOHDR",72,0)
 ;
"RTN","PSBOHDR",73,0)
 S PSBMODE=$S(PSBCLINORD=1:"Include Clinic Orders Only",PSBCLINORD=0:"Include Inpatient Orders Only",1:"Include Inpatient and Clinic Orders")   ;*70
"RTN","PSBOHDR",74,0)
 I 'DORPT,$G(PSBHDR(1))]"",$G(PSBHDR(0))]"" W !,PSBMODE           ;*70
"RTN","PSBOHDR",75,0)
 W !,$G(PSBHDR(1)),?(IOM-$L(PSBHDR("DATE"))),PSBHDR("DATE")
"RTN","PSBOHDR",76,0)
 S PSBHDR("PAGE")=PSBHDR("PAGE")+1
"RTN","PSBOHDR",77,0)
 I 'DORPT,$G(PSBHDR(1))]"",$G(PSBHDR(0))="" W !,PSBMODE           ;*70
"RTN","PSBOHDR",78,0)
 W !,$G(PSBHDR(2)),?(IOM-10),$J("Page: "_PSBHDR("PAGE"),10)
"RTN","PSBOHDR",79,0)
 F X=3:1 Q:'$D(PSBHDR(X))  D      ; More Lines If Needed          ;*70
"RTN","PSBOHDR",80,0)
 . W !,PSBHDR(X)
"RTN","PSBOHDR",81,0)
 . I PSBHDR(X)["Clinic Search" W $$WRAP^PSBO(21,111,SRCHTXT)
"RTN","PSBOHDR",82,0)
 . I PSBHDR(X)["Ward Location" W SRCHTXT
"RTN","PSBOHDR",83,0)
 I $G(PSBCONT) W !?(IOM-35\2),"*** CONTINUED FROM PREVIOUS PAGE ***"
"RTN","PSBOHDR",84,0)
 W !!,"Patient:",?10,PSBHDR("NAME")
"RTN","PSBOHDR",85,0)
 W ?42,$$GET^XPAR("ALL","PSB PATIENT ID LABEL")_":",?53,PSBHDR("SSN")
"RTN","PSBOHDR",86,0)
 W ?76,"DOB:",?83,PSBHDR("DOB")," (",PSBHDR("AGE"),")"
"RTN","PSBOHDR",87,0)
 D:'$G(PSBCONT)
"RTN","PSBOHDR",88,0)
 .W !,"Sex: ",?10,PSBHDR("SEX"),?42,"Ht/Wt:",?53,PSBHDR("HEIGHT"),"/",PSBHDR("WEIGHT"),?76,"Ward: ",?83,PSBHDR("WARD")," Rm: ",PSBHDR("ROOM")           ;added colon to Rm, PSB*3*74   [1489]
"RTN","PSBOHDR",89,0)
 .W !,"Dx:",?10,PSBHDR("DX"),?42,"Last Mvmt:",?53,PSBHDR("MVMTLAST"),?76,"Type:",?83,PSBHDR("MVMTTYPE")
"RTN","PSBOHDR",90,0)
 .; Reactions/Allergies
"RTN","PSBOHDR",91,0)
 .W !!,"ADRs:"
"RTN","PSBOHDR",92,0)
 .F X=0:0 S X=$O(PSBHDR("REAC",X)) Q:'X  W:$X>12 ! W ?12,PSBHDR("REAC",X)
"RTN","PSBOHDR",93,0)
 .W !!,"Allergies:"
"RTN","PSBOHDR",94,0)
 .F X=0:0 S X=$O(PSBHDR("ALERGY",X)) Q:'X  W:$X>12 ! W ?12,PSBHDR("ALERGY",X)
"RTN","PSBOHDR",95,0)
 .; Local Mods Allowed Here and showup only on First Page
"RTN","PSBOHDR",96,0)
 .; Immunizations
"RTN","PSBOHDR",97,0)
 .;D SHOT80^ASFSHOTF
"RTN","PSBOHDR",98,0)
 W:SUBHD]"" !!,SUBHD
"RTN","PSBOHDR",99,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","PSBOHDR",100,0)
 Q
"RTN","PSBOHDR",101,0)
 ;
"RTN","PSBOHDR",102,0)
WARD(PSBWP,PSBHDR,PSBCONT,PSBDT,SRCHTXT) ; 
"RTN","PSBOHDR",103,0)
 ; PSBWP:   Nurse Location File IEN
"RTN","PSBOHDR",104,0)
 ; PSBCONT: True if this is a continuation page
"RTN","PSBOHDR",105,0)
 ; PSBDT:   Date of Pt Information (Default to DT)
"RTN","PSBOHDR",106,0)
 N PSBWRDA
"RTN","PSBOHDR",107,0)
 S:'$G(PSBDT) PSBDT=DT
"RTN","PSBOHDR",108,0)
 I '$D(PSBHDR("DATE")) D NOW^%DTC S Y=+$E(%,1,12) D D^DIQ S PSBHDR("DATE")="Run Date: "_Y
"RTN","PSBOHDR",109,0)
 S:'$D(PSBHDR("PAGE")) PSBHDR("PAGE")=0
"RTN","PSBOHDR",110,0)
 W:$Y>1 @IOF
"RTN","PSBOHDR",111,0)
 W:$X>0 !
"RTN","PSBOHDR",112,0)
 W $TR($J("",IOM)," ","=")
"RTN","PSBOHDR",113,0)
 ;*70 Insert all reports, a heading line based on the order mode.
"RTN","PSBOHDR",114,0)
 ;    Write line after the report name.  Some reports use PSBHDR(0)
"RTN","PSBOHDR",115,0)
 ;    for report name, others use PSBHDR(1).
"RTN","PSBOHDR",116,0)
 W !,$G(PSBHDR(0))
"RTN","PSBOHDR",117,0)
 S PSBMODE=$S(PSBCLINORD=1:"Include Clinic Orders Only",PSBCLINORD=0:"Include Inpatient Orders Only",1:"Include Inpatient and Clinic Orders")        ;*70
"RTN","PSBOHDR",118,0)
 I $G(PSBHDR(0))]"" W !,PSBMODE                                 ;*70
"RTN","PSBOHDR",119,0)
 W !,$G(PSBHDR(1)),?(IOM-$L(PSBHDR("DATE"))),PSBHDR("DATE")
"RTN","PSBOHDR",120,0)
 I $G(PSBHDR(0))="" W !,PSBMODE                                   ;*70
"RTN","PSBOHDR",121,0)
 S PSBHDR("PAGE")=PSBHDR("PAGE")+1
"RTN","PSBOHDR",122,0)
 W !,$G(PSBHDR(2)),?(IOM-10),$J("Page: "_PSBHDR("PAGE"),10)
"RTN","PSBOHDR",123,0)
 F X=3:1 Q:'$D(PSBHDR(X))  D      ; More Lines If Needed
"RTN","PSBOHDR",124,0)
 . W !,PSBHDR(X)
"RTN","PSBOHDR",125,0)
 . I PSBHDR(X)["Clinic Search" W $$WRAP^PSBO(21,111,SRCHTXT)      ;*70
"RTN","PSBOHDR",126,0)
 . I PSBHDR(X)["Ward Location" W SRCHTXT                          ;*70
"RTN","PSBOHDR",127,0)
 I $G(PSBCONT) W !?(IOM-35\2),"*** CONTINUED FROM PREVIOUS PAGE ***"
"RTN","PSBOHDR",128,0)
 D WARD^NURSUT5("L^"_PSBWP,.PSBWRDA)
"RTN","PSBOHDR",129,0)
 S X="Division: "_$P(PSBWRDA(PSBWP,.02),U,2)
"RTN","PSBOHDR",130,0)
 W ?(IOM-$L(X)),X,!,$TR($J("",IOM)," ","=")
"RTN","PSBOHDR",131,0)
 Q
"RTN","PSBOHDR",132,0)
 ;
"RTN","PSBOHDR",133,0)
CLINIC(PSBRPT,PSBHDR,PSBCONT,PSBDT,SRCHTXT) ;
"RTN","PSBOHDR",134,0)
 ; PSBCONT: True if this is a continuation page
"RTN","PSBOHDR",135,0)
 ; PSBDT:   Date of Pt Information (Default to DT)
"RTN","PSBOHDR",136,0)
 S:'$G(PSBDT) PSBDT=DT
"RTN","PSBOHDR",137,0)
 I '$D(PSBHDR("DATE")) D NOW^%DTC S Y=+$E(%,1,12) D D^DIQ S PSBHDR("DATE")="Run Date: "_Y
"RTN","PSBOHDR",138,0)
 S:'$D(PSBHDR("PAGE")) PSBHDR("PAGE")=0
"RTN","PSBOHDR",139,0)
 W:$Y>1 @IOF
"RTN","PSBOHDR",140,0)
 W:$X>0 !
"RTN","PSBOHDR",141,0)
 W $TR($J("",IOM)," ","=")
"RTN","PSBOHDR",142,0)
 ;*70 insert across the board, a heading line base on the order mode
"RTN","PSBOHDR",143,0)
 ;    write line after the report name.  Some reports use PSBHDR(0)
"RTN","PSBOHDR",144,0)
 ;    for report name others use PSBHDR(1).
"RTN","PSBOHDR",145,0)
 W !,$G(PSBHDR(0))
"RTN","PSBOHDR",146,0)
 S PSBMODE=$S(PSBCLINORD=1:"Include Clinic Orders Only",PSBCLINORD=0:"Include Inpatient Orders Only",1:"Include Inpatient and Clinic Orders")               ;*70
"RTN","PSBOHDR",147,0)
 I $G(PSBHDR(0))]"" W !,PSBMODE        ;*70
"RTN","PSBOHDR",148,0)
 W !,$G(PSBHDR(1)),?(IOM-$L(PSBHDR("DATE"))),PSBHDR("DATE")
"RTN","PSBOHDR",149,0)
 I $G(PSBHDR(0))="" W !,PSBMODE        ;*70
"RTN","PSBOHDR",150,0)
 S PSBHDR("PAGE")=PSBHDR("PAGE")+1
"RTN","PSBOHDR",151,0)
 W !,$G(PSBHDR(2)),?(IOM-10),$J("Page: "_PSBHDR("PAGE"),10)
"RTN","PSBOHDR",152,0)
 F X=3:1 Q:'$D(PSBHDR(X))  D      ; More Lines If Needed        ;*70
"RTN","PSBOHDR",153,0)
 . W !,PSBHDR(X)
"RTN","PSBOHDR",154,0)
 . I PSBHDR(X)["Clinic Search" W $$WRAP^PSBO(21,111,SRCHTXT)
"RTN","PSBOHDR",155,0)
 . I PSBHDR(X)["Ward Location" W SRCHTXT
"RTN","PSBOHDR",156,0)
 I $G(PSBCONT) W !?(IOM-35\2),"*** CONTINUED FROM PREVIOUS PAGE ***"
"RTN","PSBOHDR",157,0)
 N DFN D CLIN^PSBO(.PSBRPT) M ^TMP("PSBO",$J)=^TMP("PSJCL",$J)
"RTN","PSBOHDR",158,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","PSBOHDR",159,0)
 Q
"RTN","PSBOHDR",160,0)
 ;
"RTN","PSBOHDR",161,0)
PSBALG ;
"RTN","PSBOHDR",162,0)
 S YA=""
"RTN","PSBOHDR",163,0)
 K PSBAL,GMRALA
"RTN","PSBOHDR",164,0)
 S PSBLIST=""
"RTN","PSBOHDR",165,0)
 D ALLR^PSBALL(.GMRALA,DFN)
"RTN","PSBOHDR",166,0)
 S X="" F  S X=$O(GMRALA(X)) Q:X=""  D
"RTN","PSBOHDR",167,0)
 .I $P(GMRALA(X),U,1)["ALL" D
"RTN","PSBOHDR",168,0)
 ..S PSBAL($P(GMRALA(X),U,2))=""
"RTN","PSBOHDR",169,0)
 S XAB="" F  S XAB=$O(PSBAL(XAB)) Q:XAB=""  D
"RTN","PSBOHDR",170,0)
 .S Z=XAB
"RTN","PSBOHDR",171,0)
 .I $L(YA_Z)>(IOM-22) S PSBHDR("ALERGY",$O(PSBHDR("ALERGY",""),-1)+1)=YA,YA=""
"RTN","PSBOHDR",172,0)
 .S YA=YA_$S(YA]"":", ",1:"")_XAB
"RTN","PSBOHDR",173,0)
 S:YA]"" PSBHDR("ALERGY",$O(PSBHDR("ALERGY",""),-1)+1)=YA
"RTN","PSBOHDR",174,0)
 I '$D(PSBHDR("ALERGY")) S PSBHDR("ALERGY",1)="No Allergies on file."
"RTN","PSBOHDR",175,0)
 Q
"RTN","PSBOHDR",176,0)
 ;
"RTN","PSBOHDR",177,0)
PTFTR() ; [Extrinsic] Patient Page footer
"RTN","PSBOHDR",178,0)
 ;
"RTN","PSBOHDR",179,0)
 I (IOSL<100) F  Q:$Y>(IOSL-6)  W !
"RTN","PSBOHDR",180,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","PSBOHDR",181,0)
 S X="Ward: "_PSBHDR("WARD")_"  Room-Bed: "_PSBHDR("ROOM")
"RTN","PSBOHDR",182,0)
 W !,PSBHDR("NAME"),?(IOM-11\2),PSBHDR("SSN"),?(IOM-$L(X)),X
"RTN","PSBOHDR",183,0)
 I $G(PSBUNK) S X="Note:  ??  Indicates an administration with an *UNKNOWN* Action Status" W !!,X
"RTN","PSBOHDR",184,0)
 Q ""
"RTN","PSBOHDR",185,0)
 ;
"RTN","PSBOHDR",186,0)
SRCHLIST() ;Build appropriate Clinic or Ward/Nurse Unit Search list heading
"RTN","PSBOHDR",187,0)
 N LIST,RPT,LBL,QQ,PSBWP,PSBWRDA
"RTN","PSBOHDR",188,0)
 S LIST=""
"RTN","PSBOHDR",189,0)
 ; Clinic locations lookup
"RTN","PSBOHDR",190,0)
 D:$P($G(PSBRPT(4)),U,2)="C"
"RTN","PSBOHDR",191,0)
 . S:'$D(PSBRPT(2)) LIST="All Clinics"
"RTN","PSBOHDR",192,0)
 . D:$D(PSBRPT(2))
"RTN","PSBOHDR",193,0)
 .. F QQ=$O(PSBRPT(2,0)):1:$O(PSBRPT(2,"B"),-1) S RPT(PSBRPT(2,QQ,0))=""
"RTN","PSBOHDR",194,0)
 .. S LIST=""
"RTN","PSBOHDR",195,0)
 .. S LBL="" F  S LBL=$O(RPT(LBL)) Q:LBL=""  D
"RTN","PSBOHDR",196,0)
 ... I LIST="" S LIST=LBL Q
"RTN","PSBOHDR",197,0)
 ... I LIST]"" S LIST=LIST_", "_LBL
"RTN","PSBOHDR",198,0)
 ; Ward location lookup
"RTN","PSBOHDR",199,0)
WRD I $P(PSBRPT(.1),U)="W" D
"RTN","PSBOHDR",200,0)
 . S PSBWP=$P(PSBRPT(.1),U,3) D WARD^NURSUT5("L^"_PSBWP,.PSBWRDA)
"RTN","PSBOHDR",201,0)
 . S WLOC=PSBWRDA(PSBWP,.01)
"RTN","PSBOHDR",202,0)
 . ;  name if a nurs unit
"RTN","PSBOHDR",203,0)
 . S LIST=$P(WLOC,U,2)
"RTN","PSBOHDR",204,0)
 . ;  hosp/ward loc name if not nurs unit
"RTN","PSBOHDR",205,0)
 . S:LIST="" LIST=$$GET1^DIQ(44,+WLOC,.01)
"RTN","PSBOHDR",206,0)
 Q LIST
"RTN","PSBOHDR",207,0)
 ;
"RTN","PSBOHDR",208,0)
EMPTYHDR(SRCHTXT) ; Write headings & search cirtieria - for no data scenario
"RTN","PSBOHDR",209,0)
 D NOW^%DTC S Y=+$E(%,1,12) D D^DIQ S PSBHDR("DATE")="Run Date: "_Y
"RTN","PSBOHDR",210,0)
 S PSBHDR("PAGE")=1
"RTN","PSBOHDR",211,0)
 ;
"RTN","PSBOHDR",212,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","PSBOHDR",213,0)
 W !,$G(PSBHDR(0))
"RTN","PSBOHDR",214,0)
 S PSBMODE=$S(PSBCLINORD=1:"Include Clinic Orders Only",PSBCLINORD=0:"Include Inpatient Orders Only",1:"Include Inpatient and Clinic Orders")   ;*70
"RTN","PSBOHDR",215,0)
 I $G(PSBHDR(1))]"",$G(PSBHDR(0))]"" W !,PSBMODE
"RTN","PSBOHDR",216,0)
 W !,$G(PSBHDR(1)),?(IOM-$L(PSBHDR("DATE"))),PSBHDR("DATE")
"RTN","PSBOHDR",217,0)
 I $G(PSBHDR(1))]"",$G(PSBHDR(0))="" W !,PSBMODE
"RTN","PSBOHDR",218,0)
 W !,$G(PSBHDR(2)),?(IOM-10),$J("Page: "_PSBHDR("PAGE"),10)
"RTN","PSBOHDR",219,0)
 F X=3:1 Q:'$D(PSBHDR(X))  D      ; More Lines If Needed
"RTN","PSBOHDR",220,0)
 . W !,PSBHDR(X)
"RTN","PSBOHDR",221,0)
 . I PSBHDR(X)["Clinic Search" W $$WRAP^PSBO(21,111,SRCHTXT)
"RTN","PSBOHDR",222,0)
 . I PSBHDR(X)["Ward Location" W SRCHTXT
"RTN","PSBOHDR",223,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","PSBOHDR",224,0)
 Q ""
"RTN","PSBOIV")
0^28^B85319795^B83398690
"RTN","PSBOIV",1,0)
PSBOIV ;BIRMINGHAM/TEJ-IV BAG STATUS REPORT ;8/30/12 10:56am
"RTN","PSBOIV",2,0)
 ;;3.0;BAR CODE MED ADMIN;**32,68,70**;Mar 2004;Build 101
"RTN","PSBOIV",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOIV",4,0)
 ;
"RTN","PSBOIV",5,0)
 ; Reference/IA
"RTN","PSBOIV",6,0)
 ; File 52.6/436
"RTN","PSBOIV",7,0)
 ; File 52.7/437
"RTN","PSBOIV",8,0)
 ; File 4/10090
"RTN","PSBOIV",9,0)
 ; File 2/10035 
"RTN","PSBOIV",10,0)
 ; GETSIOPI^PSJBCMA5/5763
"RTN","PSBOIV",11,0)
 ; 
"RTN","PSBOIV",12,0)
 ;*68 - change to accomodate unlimited lines for SIOPI array
"RTN","PSBOIV",13,0)
 ;*70 - reset PSBCLINORD = 2 to signify combined orders report
"RTN","PSBOIV",14,0)
 ;
"RTN","PSBOIV",15,0)
EN ; Entry
"RTN","PSBOIV",16,0)
 N PSB1,PSBFUTR,PSBSI,QQ,PSBHDR               ;*70 add psbhdr
"RTN","PSBOIV",17,0)
 K PSBSRTBY,PSBOCRIT,PSBACRIT,NO S PSBCFLG=0
"RTN","PSBOIV",18,0)
 S PSBFUTR=$TR(PSBRPT(1),"~","^")
"RTN","PSBOIV",19,0)
 I $D(PSBRPT(.2)) I $P(PSBRPT(.2),U,8) S PSBCFLG=1
"RTN","PSBOIV",20,0)
 S PSBDTST=+$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7)
"RTN","PSBOIV",21,0)
 S PSBDTSP=+$P(PSBRPT(.1),U,8)+$P(PSBRPT(.1),U,9)
"RTN","PSBOIV",22,0)
 S PSBOCRIT=""        ;  Ord Sttus "A"ctive, "D"C ed, "E"xprd"
"RTN","PSBOIV",23,0)
 S:$P(PSBFUTR,U,5) PSBOCRIT=PSBOCRIT_"A"
"RTN","PSBOIV",24,0)
 S:$P(PSBFUTR,U,7) PSBOCRIT=PSBOCRIT_"D"
"RTN","PSBOIV",25,0)
 S:$P(PSBFUTR,U,8) PSBOCRIT=PSBOCRIT_"E"
"RTN","PSBOIV",26,0)
 S PSBACRIT=""        ;  Actn Sttus "C"ompl, "I"nfusi, "M"issng, "S"tpped, "H"ld, "R"efsd", "N"o Actn
"RTN","PSBOIV",27,0)
 S:$P(PSBFUTR,U,12) PSBACRIT=PSBACRIT_"I"
"RTN","PSBOIV",28,0)
 S:$P(PSBFUTR,U,13) PSBACRIT=PSBACRIT_"S"
"RTN","PSBOIV",29,0)
 S:$P(PSBFUTR,U,14) PSBACRIT=PSBACRIT_"C"
"RTN","PSBOIV",30,0)
 S:$P(PSBFUTR,U,15) PSBACRIT=PSBACRIT_"N"
"RTN","PSBOIV",31,0)
 S:$P(PSBFUTR,U,16) PSBACRIT=PSBACRIT_"M"
"RTN","PSBOIV",32,0)
 S:$P(PSBFUTR,U,17) PSBACRIT=PSBACRIT_"H"
"RTN","PSBOIV",33,0)
 S:$P(PSBFUTR,U,18) PSBACRIT=PSBACRIT_"R"
"RTN","PSBOIV",34,0)
 D NOW^%DTC S (Y,PSBXNOW)=% D DD^%DT S:PSBDTSP=0 PSBDTSP=Y S PSBDTTM=Y
"RTN","PSBOIV",35,0)
 I +PSBDTST=0 S PSBDTST=X S PSBDTST=$$FMADD^XLFDT(PSBDTST,-3)_".0000"
"RTN","PSBOIV",36,0)
 S (PSBPGNUM,PSBLNTOT,PSBTOT,PSB1)=""
"RTN","PSBOIV",37,0)
 K PSBLIST,PSBLIST2,PSBBGS,PSBNOX
"RTN","PSBOIV",38,0)
 S PSBXDFN=$P(PSBRPT(.1),U,2)
"RTN","PSBOIV",39,0)
 S PSBLIST(PSBXDFN)=""
"RTN","PSBOIV",40,0)
 S PSB1=$O(PSBLIST("")) I +PSB1'=0  K ^TMP("PSJ",$J) D EN^PSJBCMA(PSB1,PSBDTST,PSBDTST)
"RTN","PSBOIV",41,0)
 I ^TMP("PSJ",$J,1,0)'=-1 D
"RTN","PSBOIV",42,0)
 .S PINX=0 F  S PINX=$O(^TMP("PSJ",$J,PINX)) Q:+PINX'>0  D
"RTN","PSBOIV",43,0)
 ..S PSB2=$P(^TMP("PSJ",$J,PINX,0),U,3)
"RTN","PSBOIV",44,0)
 ..I PSB2["V" D  Q
"RTN","PSBOIV",45,0)
 ...; flter critri
"RTN","PSBOIV",46,0)
 ...D CLEAN^PSBVT,PSJ1^PSBVT(PSB1,PSB2)
"RTN","PSBOIV",47,0)
 ...Q:$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,$G(PSBIVPSH,0))
"RTN","PSBOIV",48,0)
 ...Q:PSBOST>PSBDTSP
"RTN","PSBOIV",49,0)
 ...I "DE"'[PSBOSTS I PSBOSP'>PSBXNOW S PSBOSTS="E"
"RTN","PSBOIV",50,0)
 ...Q:PSBOCRIT'[PSBOSTS  ;incl ord stat crit
"RTN","PSBOIV",51,0)
 ...Q:(PSBOSP<PSBXNOW)&(PSBOCRIT'["E")&(PSBOSTS'="D")
"RTN","PSBOIV",52,0)
 ...S PSBLIST2(PSB2,"OStart")=PSBOST
"RTN","PSBOIV",53,0)
 ...S PSBLIST2(PSB2,"OStop")=PSBOSP
"RTN","PSBOIV",54,0)
 ...S PSBLIST2(PSB2,"OStatus")=$S((PSBOSTS="D"):"Discontinued",(PSBOSTS="DE"):"Discontinued (Edit)",PSBXNOW>PSBOSP:"Expired",PSBOSTS="A":"Active",PSBOSTS="H":"On Hold",1:PSBOSTS)
"RTN","PSBOIV",55,0)
 ...;  *68
"RTN","PSBOIV",56,0)
 ...K ^TMP("PSJBCMA5",$J)
"RTN","PSBOIV",57,0)
 ...I PSBSIFLG D GETSIOPI^PSJBCMA5(PSB1,PSB2,1)
"RTN","PSBOIV",58,0)
 ...F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,PSB1,PSB2,QQ)) Q:'QQ  D
"RTN","PSBOIV",59,0)
 ....S PSBSI(PSB2,QQ)=^TMP("PSJBCMA5",$J,PSB1,PSB2,QQ)
"RTN","PSBOIV",60,0)
 ...;  *68 end
"RTN","PSBOIV",61,0)
 ...M PSBLIST2(PSB2,"ADD")=PSBADA
"RTN","PSBOIV",62,0)
 ...M PSBLIST2(PSB2,"SOL")=PSBSOLA
"RTN","PSBOIV",63,0)
 ...D EN^PSBPOIV(PSB1,PSB2)
"RTN","PSBOIV",64,0)
 ...I +$O(^TMP("PSBAR",$J,""))>0 S X="" F  S X=$O(^TMP("PSBAR",$J,X)) Q:+X=0  S PSBBGS(PSB2,X)=$P(^TMP("PSBAR",$J,X),U,2)
"RTN","PSBOIV",65,0)
 ...D:PSBACRIT["N"
"RTN","PSBOIV",66,0)
 ....S NO=1
"RTN","PSBOIV",67,0)
 ....I $D(PSBBGS(PSB2))  S X="" F  S X=$O(PSBBGS(PSB2,X)) Q:+X=0  I PSBBGS(PSB2,X)'="" S NO=0 Q
"RTN","PSBOIV",68,0)
 ....I $D(^PSB(53.79,"AORDX",PSB1,PSB2)) S NO=0 Q
"RTN","PSBOIV",69,0)
 ...I $G(NO,0) I PSBOSTS="A" S PSBNOX(PSB2)="",PSBTOT=PSBTOT+1 Q
"RTN","PSBOIV",70,0)
 ...I $D(^PSB(53.79,"AUID",PSB1,PSB2)) M PSBBGS(PSB2)=^PSB(53.79,"AUID",PSB1,PSB2)
"RTN","PSBOIV",71,0)
 ...; Get X - "ASSOC BAGS"
"RTN","PSBOIV",72,0)
 ...S X="" F  S X=$O(PSBBGS(PSB2,X)) Q:+X=0  I $G(PSBBGS(PSB2,X),"")'=""  D
"RTN","PSBOIV",73,0)
 ....S Y="" F  S Y=$O(^PSB(53.79,"AUID",PSB1,Y)) Q:Y=""  D  Q:Y="DONE"
"RTN","PSBOIV",74,0)
 .....I $D(^PSB(53.79,"AUID",PSB1,Y,X)) S PSBBGS(PSB2,X,$O(^PSB(53.79,"AUID",PSB1,Y,X,"")))="" S Y="DONE"
"RTN","PSBOIV",75,0)
 ...S X="" F  S X=$O(PSBBGS(PSB2,X)) Q:+X=0  I $O(PSBBGS(PSB2,X,""))="" K PSBBGS(PSB2,X)
"RTN","PSBOIV",76,0)
 ...S PSB3="" F  S PSB3=$O(PSBBGS(PSB2,PSB3)) Q:PSB3=""  D
"RTN","PSBOIV",77,0)
 ....S PSB4="" F  S PSB4=$O(PSBBGS(PSB2,PSB3,PSB4)) Q:+PSB4=0  D
"RTN","PSBOIV",78,0)
 .....I ($$GET1^DIQ(53.79,PSB4_",",.06,"I")'>PSBDTST)!($$GET1^DIQ(53.79,PSB4_",",.06,"I")'<PSBDTSP) K PSBBGS(PSB2,PSB3) Q
"RTN","PSBOIV",79,0)
 .....I PSBACRIT'[$$GET1^DIQ(53.79,PSB4_",",.09,"I") K PSBBGS(PSB2,PSB3) Q
"RTN","PSBOIV",80,0)
 .....S PSBBSTS(PSB2,PSB3,$$GET1^DIQ(53.79,PSB4_",",.09))=$$GET1^DIQ(53.79,PSB4_",",.06,"I"),PSBTOT=PSBTOT+1
"RTN","PSBOIV",81,0)
 .....I "SI"[$$GET1^DIQ(53.79,PSB4_",",.09,"I") I PSBXNOW>$$FMADD^XLFDT($$GET1^DIQ(53.79,PSB4_",",.06,"I"),,24) S PSB24HR(PSB2,PSB3)=""
"RTN","PSBOIV",82,0)
 .....I PSBCFLG S PSB5=0 F  S PSB5=$O(^PSB(53.79,PSB4,.3,PSB5)) Q:+PSB5=0  D
"RTN","PSBOIV",83,0)
 ......I $P(^PSB(53.79,PSB4,.3,PSB5,0),U,3)=$$GET1^DIQ(53.79,PSB4_",",.06,"I") S PSBCMNT(PSB2,PSB3)="Comment: "_$P(^PSB(53.79,PSB4,.3,PSB5,0),U)
"RTN","PSBOIV",84,0)
 S INX="" F  S INX=$O(PSBLIST2(INX)) Q:INX=""  I '$D(PSBBGS(INX))&'$D(PSBNOX(INX)) K PSBLIST2(INX)
"RTN","PSBOIV",85,0)
 I +PSBTOT=0 K PSBLIST
"RTN","PSBOIV",86,0)
 S Y=PSBDTST D DD^%DT S Y1=Y S Y=PSBDTSP D DD^%DT S Y2=Y
"RTN","PSBOIV",87,0)
 D CREATHDR
"RTN","PSBOIV",88,0)
 D SUBHDR^PSBOIV1
"RTN","PSBOIV",89,0)
 D BLDRPT
"RTN","PSBOIV",90,0)
 D WRTRPT
"RTN","PSBOIV",91,0)
 K PSBSILN,PSBOUTP,PSBLIST2,PSBCMNT,PSBNOX
"RTN","PSBOIV",92,0)
 Q
"RTN","PSBOIV",93,0)
BLDRPT ; Buld Reprt
"RTN","PSBOIV",94,0)
 S (PSB2,PSB3,PSB4)=""
"RTN","PSBOIV",95,0)
 S PSBTOPHD=PSBLNTOT
"RTN","PSBOIV",96,0)
 I '$D(PSBLIST2) D  Q
"RTN","PSBOIV",97,0)
 .S PSBOUTP(0,14)="W !!,""<<<< NO DATA TO DISPLAY >>>>"",!!"
"RTN","PSBOIV",98,0)
 S PSBTOT1=0
"RTN","PSBOIV",99,0)
 K PSBDATA
"RTN","PSBOIV",100,0)
 K J S J=1
"RTN","PSBOIV",101,0)
 F  S PSB2=$O(PSBLIST2(PSB2)) Q:+PSB2=0  D
"RTN","PSBOIV",102,0)
 .S PSBORDX="" S PSBORDX=PSB2
"RTN","PSBOIV",103,0)
 .S PSBDATA(1)=$$FMTDT^PSBOIV1($E(PSBLIST2(PSB2,"OStart"),1,12))
"RTN","PSBOIV",104,0)
 .S PSBDATA(2)=$$FMTDT^PSBOIV1($E(PSBLIST2(PSB2,"OStop"),1,12))
"RTN","PSBOIV",105,0)
 .S PSBDATA(3)=PSBLIST2(PSB2,"OStatus")
"RTN","PSBOIV",106,0)
 .M PSBDATA(4,"ADD")=PSBLIST2(PSB2,"ADD") I $D(PSBDATA(4,"ADD",1)) S PSBDATA(4)="MED"
"RTN","PSBOIV",107,0)
 .M PSBDATA(4,"SOL")=PSBLIST2(PSB2,"SOL") I $D(PSBDATA(4,"SOL",1)) S PSBDATA(4)="MED"
"RTN","PSBOIV",108,0)
 .; Bag(s)
"RTN","PSBOIV",109,0)
 .I $D(PSBNOX(PSB2)) S PSBFLGD(PSB2," * No Action Taken On Order * ")=""
"RTN","PSBOIV",110,0)
 .I '$D(PSBNOX(PSB2))!(PSBACRIT["N")  F  S PSB3=$O(PSBBGS(PSB2,PSB3)) Q:+PSB3=0  D
"RTN","PSBOIV",111,0)
 ..S PSBDATA(5,PSB3)=PSB3
"RTN","PSBOIV",112,0)
 ..S PSBDATA(6,PSB3)=$O(PSBBSTS(PSB2,PSB3,""))
"RTN","PSBOIV",113,0)
 ..I $D(PSB24HR(PSB2,PSB3)) S PSBDATA(7,PSB3)=">24h"
"RTN","PSBOIV",114,0)
 ..I '$D(PSBNOX(PSB2)) S PSBDATA(8,PSB3)=$$FMTDT^PSBOIV1($E(PSBBSTS(PSB2,PSB3,PSBDATA(6,PSB3)),1,12))
"RTN","PSBOIV",115,0)
 ..E  S PSBDATA(8,PSB3)="No Action On Order"
"RTN","PSBOIV",116,0)
 .K PSBOPDAT M PSBOPDAT=PSBSI(PSB2)               ;*68
"RTN","PSBOIV",117,0)
 .S PSBTOT1=PSBTOT1+1
"RTN","PSBOIV",118,0)
 .K PSBRPLN,PSBSILN
"RTN","PSBOIV",119,0)
 .D BUILDLN,SIOPI^PSBOCM(.PSBOPDAT,PSBTAB8,"Other Print Info: ")
"RTN","PSBOIV",120,0)
 .I $D(PSBRPLN) S PSBMORE=$O(PSBRPLN(""),-1)+4 I $D(PSBSILN) S PSBMORE=PSBMORE+$O(PSBSILN(""),-1)
"RTN","PSBOIV",121,0)
 .S (PSB1,PSB)="" I $D(PSBFLGD(PSB2)) F  S PSB=$O(PSBFLGD(PSB2,PSB)) Q:PSB=""  I ($P(PSB,":")'="STAT") S PSB1=$G(PSB1,"")_PSB
"RTN","PSBOIV",122,0)
 .S PSBCNT=PSBTOT1_"  ("_PSB2_") "_PSB1,$E(PSBCNT,IOM)="|"
"RTN","PSBOIV",123,0)
 .S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBCNT_""""
"RTN","PSBOIV",124,0)
 .F N=$O(PSBRPLN("")):1:$O(PSBRPLN(""),-1)  D
"RTN","PSBOIV",125,0)
 ..S PSB1X=0 S PSB1X=(($L(PSBRPLN(N),"""")-1)\2) I ($E(PSBRPLN(N),(PSBTAB8)+PSB1X)']" ") S $E(PSBRPLN(N),(PSBTAB8)+PSB1X)="|"
"RTN","PSBOIV",126,0)
 ..S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBRPLN(N)_""""
"RTN","PSBOIV",127,0)
 .K PSBRPLN,PSBDATA
"RTN","PSBOIV",128,0)
 .S I="" F  S I=$O(PSBSILN(I)) Q:+I=0  D
"RTN","PSBOIV",129,0)
 ..S PSB1X=0 S PSB1X=(($L(PSBSILN(I),"""")-1)\2)
"RTN","PSBOIV",130,0)
 ..I ($E(PSBSILN(I),(PSBTAB8)+PSB1X)']" ") S $E(PSBSILN(I),(PSBTAB8)+PSB1X)="|"
"RTN","PSBOIV",131,0)
 ..S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBSILN(I)_""""
"RTN","PSBOIV",132,0)
 .S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBTAB8),"" "",""-""),!"
"RTN","PSBOIV",133,0)
 Q
"RTN","PSBOIV",134,0)
BUILDLN ; Constr recs
"RTN","PSBOIV",135,0)
 K J,LN S J(0)="" F PSBFLD=1:1:3 I $G(PSBDATA(PSBFLD))]"" S J=1 D FORMDAT^PSBOIV1(PSBFLD) S J=1
"RTN","PSBOIV",136,0)
 F X=1:1 Q:'$D(PSBDATA(4,"ADD",X))  D
"RTN","PSBOIV",137,0)
 .S PSBDATA(4)=$P(PSBDATA(4,"ADD",X),U,3)
"RTN","PSBOIV",138,0)
 .D FORMDAT^PSBOIV1(4)
"RTN","PSBOIV",139,0)
 .S J=$O(J(""),-1)+1
"RTN","PSBOIV",140,0)
 F X=1:1 Q:'$D(PSBDATA(4,"SOL",X))  D
"RTN","PSBOIV",141,0)
 .S PSBDATA(4)=$P(PSBDATA(4,"SOL",X),U,3)
"RTN","PSBOIV",142,0)
 .D FORMDAT^PSBOIV1(4)
"RTN","PSBOIV",143,0)
 .S J=$O(J(""),-1)+1
"RTN","PSBOIV",144,0)
 F PSBFLD=5:1:8 I $D(PSBDATA(PSBFLD)) K J S J=1 D
"RTN","PSBOIV",145,0)
 .S X="" F  S X=$O(PSBDATA(PSBFLD,X)) Q:+X=0  D
"RTN","PSBOIV",146,0)
 ..S PSBDATA(PSBFLD)=PSBDATA(PSBFLD,X)
"RTN","PSBOIV",147,0)
 ..I PSBFLD=5 S LN(X,J)=""
"RTN","PSBOIV",148,0)
 ..D:PSBFLD'=8 FORMDAT^PSBOIV1(PSBFLD)
"RTN","PSBOIV",149,0)
 ..S J=$O(J(""),-1)+1
"RTN","PSBOIV",150,0)
 ..I (PSBCFLG&(PSBFLD=5)),($D(PSBCMNT(PSB2,X))) D WRAPPER^PSBOIV1(PSBTAB4+1,(PSBTAB8-PSBTAB4)-1,PSBCMNT(PSB2,X)),WRAPPER^PSBOIV1(PSBTAB4+1,PSBTAB8-PSBTAB4," ")
"RTN","PSBOIV",151,0)
 .I PSBFLD=5 F J=1:1:$O(J(""),-1) S PREVLN(J)=$G(PSBRPLN(J),"")
"RTN","PSBOIV",152,0)
 .I PSBFLD'=5 I $D(PREVLN) S X="" F  S X=$O(LN(X)) Q:X=""  S J=$O(LN(X,"")) D:$D(PSBDATA(PSBFLD,X))
"RTN","PSBOIV",153,0)
 ..S $E(PREVLN(J),@("PSBTAB"_(PSBFLD-1))+1,@("PSBTAB"_(PSBFLD)))=PSBDATA(PSBFLD,X)
"RTN","PSBOIV",154,0)
 I $D(PREVLN) F J=1:1:$O(PREVLN(""),-1) S PSBRPLN(J)=PREVLN(J)
"RTN","PSBOIV",155,0)
 K PREVLN,LN
"RTN","PSBOIV",156,0)
 Q
"RTN","PSBOIV",157,0)
WRTRPT ;
"RTN","PSBOIV",158,0)
 I $O(PSBOUTP(""),-1)<1 D  Q
"RTN","PSBOIV",159,0)
 .X PSBOUTP($O(PSBOUTP(""),-1),14)
"RTN","PSBOIV",160,0)
 .D FTR
"RTN","PSBOIV",161,0)
 S PSBPGNUM=1
"RTN","PSBOIV",162,0)
 S PSBZ="" F  S PSBZ=$O(PSBOUTP(PSBZ)) Q:PSBZ=""  D
"RTN","PSBOIV",163,0)
 .I PSBPGNUM'=PSBZ D FTR S PSBPGNUM=PSBZ D HDR,SUBHDR^PSBOIV1
"RTN","PSBOIV",164,0)
 .S PSB2="" F  S PSB2=$O(PSBOUTP(PSBZ,PSB2)) Q:PSB2=""  D
"RTN","PSBOIV",165,0)
 ..X PSBOUTP(PSBZ,PSB2)
"RTN","PSBOIV",166,0)
 D FTR
"RTN","PSBOIV",167,0)
 Q
"RTN","PSBOIV",168,0)
HDR ;
"RTN","PSBOIV",169,0)
 W:$Y>1 @IOF
"RTN","PSBOIV",170,0)
 W:$X>1 !
"RTN","PSBOIV",171,0)
 S PSBRPNM="BCMA IV BAG STATUS REPORT"
"RTN","PSBOIV",172,0)
 S LN=0
"RTN","PSBOIV",173,0)
 D:$P(PSBRPT(.1),U,1)="P"
"RTN","PSBOIV",174,0)
 .S LN=LN+1,PSBHDR(LN)=PSBRPNM_" for "_$$FMTE^XLFDT($P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7))_" to "_$$FMTE^XLFDT($P(PSBRPT(.1),U,8)+$P(PSBRPT(.1),U,9))
"RTN","PSBOIV",175,0)
 .S LN=LN+1,PSBHDR(LN)="Order Status(es): --"
"RTN","PSBOIV",176,0)
 .F Y=5,7,8 I $P(PSBFUTR,U,Y) S $P(PSBHDR(LN),": ",2)=$P(PSBHDR(LN),": ",2)_$S(PSBHDR(2)["--":"",1:"/ ")_$P("^^^^Active^^DC'd^Expired^^^^^^^^^^",U,Y)_" " S PSBHDR(LN)=$TR(PSBHDR(LN),"-","")
"RTN","PSBOIV",177,0)
 .S LN=LN+1,PSBHDR(LN)="Bag Status(es): --"
"RTN","PSBOIV",178,0)
 .F Y=12:1:18 I $P(PSBFUTR,U,Y) S $P(PSBHDR(LN),": ",2)=$P(PSBHDR(LN),": ",2)_$S(PSBHDR(LN)["--":"",1:"/ ")_$P("^^^^^^^^^^^Infusing^Stopped^Completed^No Action Taken^Missing Dose^Held^Refused",U,Y)_" " S PSBHDR(LN)=$TR(PSBHDR(LN),"-","")
"RTN","PSBOIV",179,0)
 .I PSBCFLG S LN=LN+1,PSBHDR(LN)="Include Comments/Reasons"
"RTN","PSBOIV",180,0)
 .N PSBCLINORD S PSBCLINORD=2     ;set psbclinord to both ord type *70
"RTN","PSBOIV",181,0)
 .D PT^PSBOHDR(PSBXDFN,.PSBHDR) W !
"RTN","PSBOIV",182,0)
 Q
"RTN","PSBOIV",183,0)
FTR ;
"RTN","PSBOIV",184,0)
 I (IOSL<100) F  Q:$Y>(IOSL-5)  W !,?(IOM-1),"|"
"RTN","PSBOIV",185,0)
 S PSBPG="Page: "_PSBPGNUM_" of "_$S($O(PSBOUTP(""),-1)=0:1,1:$O(PSBOUTP(""),-1))
"RTN","PSBOIV",186,0)
 S PSBPGRM=PSBTAB8-($L(PSBPG))
"RTN","PSBOIV",187,0)
 D PTFTR^PSBOHDR()
"RTN","PSBOIV",188,0)
 W !,PSBRPNM,"     ",?(PSBPGRM-($L(PSBDTTM)+3)),PSBDTTM_"  "_PSBPG
"RTN","PSBOIV",189,0)
 Q
"RTN","PSBOIV",190,0)
PGTOT(X) ;mnt PAGE Number
"RTN","PSBOIV",191,0)
 I (PSBLNTOT+PSBMORE)>(IOSL) S PSBPGNUM=PSBPGNUM+1,PSBLNTOT=PSBTOPHD S PSBMORE=$S(PSBMORE>(IOSL-(PSBTOPHD)):(IOSL-(PSBTOPHD)),1:PSBMORE)
"RTN","PSBOIV",192,0)
 I $G(X,1) S PSBLNTOT=PSBLNTOT+$G(X,1),PSBMORE=PSBMORE-$G(X,1)
"RTN","PSBOIV",193,0)
 Q PSBPGNUM
"RTN","PSBOIV",194,0)
CREATHDR ;
"RTN","PSBOIV",195,0)
 K PSBHD1,PSBHD2
"RTN","PSBOIV",196,0)
 I IOM'<132 S PSBMORE=4,PSBHD1=$P($T(HD132A),";",2),PSBHD2=$P($T(HD132B),";",2),PSBBLANK=$P($T(H132BLK),";",2)
"RTN","PSBOIV",197,0)
 E  S PSBHD1="THIS REPORT SUPPORTS >131 CHAR./LINE PRINT FORMATS ONLY" K PSBLIST2 Q
"RTN","PSBOIV",198,0)
 ; reset tabs
"RTN","PSBOIV",199,0)
 S PSBTAB0=1 F PSBI=0:1:($L(PSBHD1,"|")-1) S:PSBI>0 @("PSBTAB"_PSBI)=($F(PSBHD1,"|",@("PSBTAB"_(PSBI-1))+1))-1
"RTN","PSBOIV",200,0)
 S PSBPGNUM=1
"RTN","PSBOIV",201,0)
 D HDR
"RTN","PSBOIV",202,0)
 Q
"RTN","PSBOIV",203,0)
HD132A ;     Order       |       Order       |    Order     |     Medication      |      Bag UID      |    Bag    |     | Action Date/Time |
"RTN","PSBOIV",204,0)
 Q
"RTN","PSBOIV",205,0)
HD132B ;   Start Date    |      Stop Date    |    Status    |                     |                   |   Status  |     |                  |
"RTN","PSBOIV",206,0)
 Q
"RTN","PSBOIV",207,0)
H132BLK ;;
"RTN","PSBOIV",208,0)
 Q
"RTN","PSBOMD")
0^45^B16573592^B11558325
"RTN","PSBOMD",1,0)
PSBOMD ;BIRMINGHAM/EFC-MISSING DOSE REPORT ;12/7/12 12:41pm
"RTN","PSBOMD",2,0)
 ;;3.0;BAR CODE MED ADMIN;**70**;Mar 2004;Build 101
"RTN","PSBOMD",3,0)
 ;
"RTN","PSBOMD",4,0)
 ; Reference/IA
"RTN","PSBOMD",5,0)
 ; WARD^NURSUT5/3052
"RTN","PSBOMD",6,0)
 ; IN5^VADPT/10061
"RTN","PSBOMD",7,0)
 ; $$GET1^DIQ(52.6/436
"RTN","PSBOMD",8,0)
 ; $$GET1^DIQ(52.7/437
"RTN","PSBOMD",9,0)
 ;
"RTN","PSBOMD",10,0)
 ;*70 - Allow a Clinc Order only version of this report.
"RTN","PSBOMD",11,0)
 ;
"RTN","PSBOMD",12,0)
EN ; Begin printing
"RTN","PSBOMD",13,0)
 N PSBSCHD,PSBWRD,PSBSTRT,PSBSTOP,PSBWARD,PSBDRUG,PSBDT,PSBIEN,PSBWRDA
"RTN","PSBOMD",14,0)
 N CLNMODE                                                        ;*70
"RTN","PSBOMD",15,0)
 K ^TMP("PSB",$J)
"RTN","PSBOMD",16,0)
 S CLNMODE=$S($P(PSBRPT(.1),U)="C":1,1:0)      ;clinic mode T/F    *70
"RTN","PSBOMD",17,0)
 ;Ward mode                                                        *70
"RTN","PSBOMD",18,0)
 D:'CLNMODE
"RTN","PSBOMD",19,0)
 .S PSBWRD=+$P(PSBRPT(.1),U,3)
"RTN","PSBOMD",20,0)
 .I PSBWRD D WARD^NURSUT5("L^"_PSBWRD,.PSBWRDA) S X="" F  S X=$O(PSBWRDA(PSBWRD,2,X)) Q:X=""  S Y=PSBWRDA(PSBWRD,2,X,.01),PSBWRD(+Y)=$P(Y,U,2),^TMP("PSB",$J,PSBWRD(+Y))=0
"RTN","PSBOMD",21,0)
 ;Clinic mode                                                     *70
"RTN","PSBOMD",22,0)
 D:CLNMODE
"RTN","PSBOMD",23,0)
 .S PSBWRD=+$P(PSBRPT(4),U,3),PSBWRD(PSBWRD)=$P($G(^SC(PSBWRD,0)),U)
"RTN","PSBOMD",24,0)
 .Q:PSBWRD(PSBWRD)=""
"RTN","PSBOMD",25,0)
 .S ^TMP("PSB",$J,PSBWRD(PSBWRD))=0
"RTN","PSBOMD",26,0)
 ;
"RTN","PSBOMD",27,0)
 S PSBSTRT=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7)
"RTN","PSBOMD",28,0)
 S PSBSTOP=$P(PSBRPT(.1),U,8)+$P(PSBRPT(.1),U,9)
"RTN","PSBOMD",29,0)
 S PSBDT=PSBSTRT-.0000001
"RTN","PSBOMD",30,0)
 F  S PSBDT=$O(^PSB(53.68,"ADTE",PSBDT)) Q:'PSBDT!(PSBDT>PSBSTOP)  D
"RTN","PSBOMD",31,0)
 .S PSBIEN=0
"RTN","PSBOMD",32,0)
 .F  S PSBIEN=$O(^PSB(53.68,"ADTE",PSBDT,PSBIEN))  Q:'PSBIEN  D
"RTN","PSBOMD",33,0)
 ..;check ward or clinic for ALL or selection via  by array       *70
"RTN","PSBOMD",34,0)
 ..I CLNMODE S PSBWARD=$$GET1^DIQ(53.68,PSBIEN_",",1) Q:PSBWARD=""
"RTN","PSBOMD",35,0)
 ..I CLNMODE,PSBWRD,'$D(PSBWRD(+$P($G(^PSB(53.68,PSBIEN,1)),U))) Q
"RTN","PSBOMD",36,0)
 ..I 'CLNMODE S PSBWARD=$$GET1^DIQ(53.68,PSBIEN_",",.12) Q:PSBWARD=""
"RTN","PSBOMD",37,0)
 ..I 'CLNMODE,PSBWRD,'$D(PSBWRD(+$P($G(^PSB(53.68,PSBIEN,.1)),U,2))) Q
"RTN","PSBOMD",38,0)
 ..;end check                                                     *70
"RTN","PSBOMD",39,0)
 ..S PSBDRUG=$$GET1^DIQ(53.68,PSBIEN_",",.13) I PSBDRUG="" D
"RTN","PSBOMD",40,0)
 ...S PSBDRUG="NO DATA"
"RTN","PSBOMD",41,0)
 ...I $D(^PSB(53.68,PSBIEN,.6)) S X=0 F  S X=$O(^PSB(53.68,+PSBIEN,.6,X)) Q:'X  S PSBDRUG=$$GET1^DIQ(52.6,+^PSB(53.68,PSBIEN,.6,X,0),.01)
"RTN","PSBOMD",42,0)
 ...I $D(^PSB(53.68,PSBIEN,.7)) S X=0 F  S X=$O(^PSB(53.68,+PSBIEN,.7,X)) Q:'X  S PSBDRUG=PSBDRUG_"  "_$$GET1^DIQ(52.7,+^PSB(53.68,+PSBIEN,.7,X,0),.01)
"RTN","PSBOMD",43,0)
 ..S PSBSCHD=$$GET1^DIQ(53.68,PSBIEN_",",.19) S:PSBSCHD="" PSBSCHD="NO DATA"
"RTN","PSBOMD",44,0)
 ..S ^TMP("PSB",$J,PSBWARD,PSBDRUG,PSBSCHD)=$G(^TMP("PSB",$J,PSBWARD,PSBDRUG,PSBSCHD))+1
"RTN","PSBOMD",45,0)
 ..S ^TMP("PSB",$J,PSBWARD)=+$G(^TMP("PSB",$J,PSBWARD))+1
"RTN","PSBOMD",46,0)
 ..S ^TMP("PSB",$J)=+$G(^TMP("PSB",$J))+1
"RTN","PSBOMD",47,0)
 W $$HDR()
"RTN","PSBOMD",48,0)
 I '$D(^TMP("PSB",$J)) W !!?5,"<<<NO MISSING DOSE REQUESTS FOR THIS TIME FRAME>>>" Q
"RTN","PSBOMD",49,0)
 ;print ward report
"RTN","PSBOMD",50,0)
 S PSBWARD=""
"RTN","PSBOMD",51,0)
 F  S PSBWARD=$O(^TMP("PSB",$J,PSBWARD)) Q:PSBWARD=""  D
"RTN","PSBOMD",52,0)
 .W:$Y>(IOSL-10) $$HDR()
"RTN","PSBOMD",53,0)
 .W !,PSBWARD
"RTN","PSBOMD",54,0)
 .S (PSBDRUG,PSBSCHD)=""
"RTN","PSBOMD",55,0)
 .F  S PSBDRUG=$O(^TMP("PSB",$J,PSBWARD,PSBDRUG)) Q:PSBDRUG=""  D
"RTN","PSBOMD",56,0)
 ..F  S PSBSCHD=$O(^TMP("PSB",$J,PSBWARD,PSBDRUG,PSBSCHD)) Q:PSBSCHD=""  D
"RTN","PSBOMD",57,0)
 ...W:$Y>(IOSL-10) $$HDR()
"RTN","PSBOMD",58,0)
 ...W ?32,PSBDRUG,?74,$J(+^TMP("PSB",$J,PSBWARD,PSBDRUG,PSBSCHD),8),!,?35,"Schedule: "_PSBSCHD,!
"RTN","PSBOMD",59,0)
 .W ?74,"--------"
"RTN","PSBOMD",60,0)
 .W !,?31,PSBWARD," Total: ",?74,$J(^TMP("PSB",$J,PSBWARD),8),!
"RTN","PSBOMD",61,0)
 W ?74,"========"
"RTN","PSBOMD",62,0)
 W !,?31,"Report Total: "
"RTN","PSBOMD",63,0)
 W ?74,$J(+$G(^TMP("PSB",$J)),8)
"RTN","PSBOMD",64,0)
 K ^TMP("PSB",$J)
"RTN","PSBOMD",65,0)
 Q
"RTN","PSBOMD",66,0)
 ;
"RTN","PSBOMD",67,0)
HDR() ;
"RTN","PSBOMD",68,0)
 I '$D(PSBRPT("DATE")) D NOW^%DTC S Y=+$E(%,1,12) D D^DIQ S PSBRPT("DATE")="Run Date: "_Y
"RTN","PSBOMD",69,0)
 S:'$D(PSBRPT("PAGE")) PSBRPT("PAGE")=1
"RTN","PSBOMD",70,0)
 W:$Y>1 @IOF
"RTN","PSBOMD",71,0)
 W !,$TR($J("",IOM)," ","="),!,"MISSING DOSE REPORT FROM "
"RTN","PSBOMD",72,0)
 S Y=PSBSTRT D D^DIQ W Y," thru "
"RTN","PSBOMD",73,0)
 S Y=PSBSTOP D D^DIQ W Y
"RTN","PSBOMD",74,0)
 W ?(IOM-$L(PSBRPT("DATE"))),PSBRPT("DATE"),!,$S(PSBWRD:"SELECTED",1:"ALL")
"RTN","PSBOMD",75,0)
 W:'CLNMODE " WARDS"                                              ;*70
"RTN","PSBOMD",76,0)
 W:CLNMODE " CLINICS"                                             ;*70
"RTN","PSBOMD",77,0)
 S X="Page: "_PSBRPT("PAGE")
"RTN","PSBOMD",78,0)
 W ?(IOM-$L(X)),X
"RTN","PSBOMD",79,0)
 S PSBRPT("PAGE")=PSBRPT("PAGE")+1
"RTN","PSBOMD",80,0)
 W !,$TR($J("",IOM)," ","="),!
"RTN","PSBOMD",81,0)
 W:CLNMODE "Clinic" W:'CLNMODE "Ward"                             ;*70
"RTN","PSBOMD",82,0)
 W ?32,"Medication",?77,"Total",!,$TR($J("",IOM)," ","-"),!
"RTN","PSBOMD",83,0)
 Q ""
"RTN","PSBOMD",84,0)
 ;
"RTN","PSBOMD",85,0)
POST ;
"RTN","PSBOMD",86,0)
 N DFN
"RTN","PSBOMD",87,0)
 S DFN=X D IN5^VADPT
"RTN","PSBOMD",88,0)
 S PSBDDSW=$P(VAIP(5),U,2)
"RTN","PSBOMD",89,0)
 S PSBDDSR=$P(VAIP(6),U,2)
"RTN","PSBOMD",90,0)
 Q 
"RTN","PSBOMH")
0^36^B92472533^B83165444
"RTN","PSBOMH",1,0)
PSBOMH ;BIRMINGHAM/EFC-MAH ;9/11/12 12:16am
"RTN","PSBOMH",2,0)
 ;;3.0;BAR CODE MED ADMIN;**5,9,38,57,67,68,70**;Mar 2004;Build 101
"RTN","PSBOMH",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSBOMH",4,0)
 ;
"RTN","PSBOMH",5,0)
 ; Reference/IA
"RTN","PSBOMH",6,0)
 ; EN^PSJBCMA/2828
"RTN","PSBOMH",7,0)
 ; EN^PSJBCMA2/2830
"RTN","PSBOMH",8,0)
 ; File 200/10060
"RTN","PSBOMH",9,0)
 ; ^DIWP/10011
"RTN","PSBOMH",10,0)
 ;
"RTN","PSBOMH",11,0)
 ;*68 - remove old special instruction text encoding, defer to PSBOMH2
"RTN","PSBOMH",12,0)
 ;*70 - add Clinic name to PSBO array for printing on grid via PSBOMH2
"RTN","PSBOMH",13,0)
 ;       in ^TMP(""PSB",$J,"ORDERS",PSBX,"INST") global
"RTN","PSBOMH",14,0)
 ;
"RTN","PSBOMH",15,0)
EN ; Called from DQ^PSBO
"RTN","PSBOMH",16,0)
 N PSBGBL,DFN
"RTN","PSBOMH",17,0)
 S PSBGBL=$NAME(^TMP("PSBO",$J,"B"))
"RTN","PSBOMH",18,0)
 F  S PSBGBL=$Q(@PSBGBL) Q:PSBGBL=""  Q:$QS(PSBGBL,2)'=$J  Q:$QS(PSBGBL,1)'["PSBO"  D
"RTN","PSBOMH",19,0)
 .S DFN=$QS(PSBGBL,5)
"RTN","PSBOMH",20,0)
 .S (PSBSTRT,X)=$P(PSBRPT(.1),U,6) D H^%DTC S PSBSTH=%H
"RTN","PSBOMH",21,0)
 .S (PSBSTOP,X)=$P(PSBRPT(.1),U,8)+.235959 D H^%DTC S PSBSPH=%H
"RTN","PSBOMH",22,0)
 .S PSBCNT=0 F I=PSBSTH:1:PSBSPH S PSBAR(I)=PSBSTH+((PSBCNT\7)*7),PSBCNT=PSBCNT+1
"RTN","PSBOMH",23,0)
 .D EN1
"RTN","PSBOMH",24,0)
 K PSBCNT,PSBAR Q
"RTN","PSBOMH",25,0)
EN1 ; Expects DFN,STRT,STOP
"RTN","PSBOMH",26,0)
 N PSBGBL,PSBHDR,PSBX,PSBFLAG,PSBHLDFL,PSBADST1,PSBOST1,PSBCLINIC ;*70
"RTN","PSBOMH",27,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J)
"RTN","PSBOMH",28,0)
 S PSBEVDT=PSBSTRT
"RTN","PSBOMH",29,0)
 D EN^PSJBCMA(DFN,PSBSTRT)
"RTN","PSBOMH",30,0)
 N PSBCLINORD S PSBCLINORD=2                 ;*70 Combind mode headers
"RTN","PSBOMH",31,0)
 I $G(^TMP("PSJ",$J,1,0))=-1 D  Q  ; No Ord
"RTN","PSBOMH",32,0)
 .D PT^PSBOHDR(DFN,.PSBHDR) W !!,"****NO MEDICATIONS FOUND****"
"RTN","PSBOMH",33,0)
 S PSBX=""
"RTN","PSBOMH",34,0)
 F  S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:PSBX=""  D
"RTN","PSBOMH",35,0)
 .Q:$P(^TMP("PSJ",$J,PSBX,0),U,3)?.N1"P"  ; No Pnd
"RTN","PSBOMH",36,0)
 .Q:$P(^TMP("PSJ",$J,PSBX,1),U,5)<PSBSTRT!($P(^TMP("PSJ",$J,PSBX,1),U,4)>PSBSTOP)  ;display orders active in date range of report
"RTN","PSBOMH",37,0)
 .S X=$P(^TMP("PSJ",$J,PSBX,1),U,2)
"RTN","PSBOMH",38,0)
 .S ^TMP("PSB",$J,"ORDERS",$P(^TMP("PSJ",$J,PSBX,0),U,3))=X
"RTN","PSBOMH",39,0)
 I '$D(^TMP("PSB",$J,"ORDERS")) D  Q        ;No Orders
"RTN","PSBOMH",40,0)
 .D PT^PSBOHDR(DFN,.PSBHDR) W !!,"****NO MEDICATIONS FOUND****"
"RTN","PSBOMH",41,0)
 S PSBMHND="PSBOMH"
"RTN","PSBOMH",42,0)
 ; Act on Orders
"RTN","PSBOMH",43,0)
 S PSBX="" F  S PSBX=$O(^TMP("PSB",$J,"ORDERS",PSBX)) Q:PSBX=""  S PSBTYPE=^(PSBX) D
"RTN","PSBOMH",44,0)
 .S:PSBTYPE'="C" PSBTYPE="P"
"RTN","PSBOMH",45,0)
 .D CLEAN^PSBVT
"RTN","PSBOMH",46,0)
 .D PSJ1^PSBVT(DFN,PSBX)
"RTN","PSBOMH",47,0)
 .S PSBCLINIC=PSBCLORD
"RTN","PSBOMH",48,0)
 .S X1=((PSBEVDT)\1)  S X2=-1  D C^%DTC  S PSBCNTST=X
"RTN","PSBOMH",49,0)
 .S X1=((PSBSTOP)\1)  S X2=1  D C^%DTC  S PSBXSTOP=X
"RTN","PSBOMH",50,0)
 .S PSBVALB=""
"RTN","PSBOMH",51,0)
 .S PSBVALB=$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBIVPSH)
"RTN","PSBOMH",52,0)
 .S PSBZ=""
"RTN","PSBOMH",53,0)
 .S X1=PSBXSTOP,X2=PSBCNTST D ^%DTC S PSBNCT=X
"RTN","PSBOMH",54,0)
 .F PSBZ=1:1:PSBNCT S X1=PSBCNTST  S X2=1  D C^%DTC  S PSBCNTST=X  D
"RTN","PSBOMH",55,0)
 ..I (PSBX["V")!(PSBX'["V")  D
"RTN","PSBOMH",56,0)
 ...I PSBCNTST'>(PSBOST\1) S ^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST)=""
"RTN","PSBOMH",57,0)
 ...;add check for admin time before start time in PSB*3*57
"RTN","PSBOMH",58,0)
 ...S PSBADST1=$E($P($G(PSBADST),"-",$L($G(PSBADST),"-"))_"00",1,4),PSBOST1=$E($P(PSBOST,".",2)_"0000",1,4) ;PSB*3*67
"RTN","PSBOMH",59,0)
 ...I PSBCNTST=(PSBOST\1)&(PSBADST1>PSBOST1) K ^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST) ;PSB*3*67
"RTN","PSBOMH",60,0)
 ...I PSBCNTST=(PSBOST\1),'$P($G(PSBADST),"-") K ^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST) ;PSB*3*67
"RTN","PSBOMH",61,0)
 ...I PSBCNTST>(PSBOSP\1) S ^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST)=""
"RTN","PSBOMH",62,0)
 ...I PSBCNTST=(PSBOSP\1)&($G(^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST))) K ^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST) S ^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST)=""
"RTN","PSBOMH",63,0)
 ..S PSBDODD=""
"RTN","PSBOMH",64,0)
 ..I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBDODD=1
"RTN","PSBOMH",65,0)
 ..I ((PSBX'["V")!(PSBVALB="1")),((PSBDODD="1")&(PSBADST'="")) S ^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST)=""
"RTN","PSBOMH",66,0)
 ..I ((PSBX'["V")!(PSBVALB="1")),('$$OKAY^PSBVDLU1(PSBOST,PSBCNTST,PSBSCH,PSBON,PSBOITX,PSBFREQ,PSBOSTS)) S ^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST)=""  ;W t TMP
"RTN","PSBOMH",67,0)
 .S (PSBYES,PSBODD,PSBFLAG,PSBYTFN,PSBDAYN)=0
"RTN","PSBOMH",68,0)
 .S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1,PSBDAYN=1
"RTN","PSBOMH",69,0)
 .I PSBYES,PSBADST="",PSBSCHT'="O",PSBSCHT'="OC",PSBSCHT'="P" Q 
"RTN","PSBOMH",70,0)
 .F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1,PSBYTFN=1
"RTN","PSBOMH",71,0)
 .I (PSBFREQ="O")!(PSBTYPE="P") S PSBYES=1
"RTN","PSBOMH",72,0)
 .I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBOMH",73,0)
 .;flg / admn t
"RTN","PSBOMH",74,0)
 .S:PSBONX["U" PSBFLAG=1
"RTN","PSBOMH",75,0)
 .I PSBIVT="A" S PSBADST="0000"
"RTN","PSBOMH",76,0)
 .I PSBIVT="H" S PSBADST="0000"
"RTN","PSBOMH",77,0)
 .I PSBIVT="C",PSBCHEMT="P" S:PSBADST="" PSBFLAG=1
"RTN","PSBOMH",78,0)
 .I PSBIVT="C",PSBISYR=1 S:PSBADST="" PSBFLAG=1
"RTN","PSBOMH",79,0)
 .I PSBIVT="C",PSBCHEMT="A" S PSBADST="0000"
"RTN","PSBOMH",80,0)
 .I PSBIVT="C",PSBISYR=0 S PSBADST="0000"
"RTN","PSBOMH",81,0)
 .I PSBIVT="P",($G(PSBADST)=0) S:PSBADST="" PSBFLAG=1
"RTN","PSBOMH",82,0)
 .I PSBIVT="P" S:PSBADST="" PSBFLAG=1
"RTN","PSBOMH",83,0)
 .I PSBIVT="S",PSBISYR=0 S PSBADST="0000"
"RTN","PSBOMH",84,0)
 .I PSBIVT="S",PSBISYR=1 S:PSBADST="" PSBFLAG=1
"RTN","PSBOMH",85,0)
 .I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBOMH",86,0)
 .I 'PSBYES,PSBADST="",PSBFREQ<1 Q
"RTN","PSBOMH",87,0)
 .S (PSBEE,PSBZZ)=0
"RTN","PSBOMH",88,0)
 .I (PSBVALB="1")!(PSBX'["V") D  Q:(PSBEE!PSBZZ)=1
"RTN","PSBOMH",89,0)
 ..I PSBSCHT="C",PSBYTFN="1",PSBADST=""  S PSBEE=1
"RTN","PSBOMH",90,0)
 ..I PSBSCHT="C",PSBDAYN'="1",PSBYTFN'="1",PSBADST'="",PSBFREQ<1  S PSBZZ=1
"RTN","PSBOMH",91,0)
 .I 'PSBODD,PSBFLAG,PSBTYPE="C",PSBADST="" S PSBADST=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBSTOP)
"RTN","PSBOMH",92,0)
 .E  I PSBADST'="" K ^TMP("PSB",$J,"GETADMIN") S ^TMP("PSB",$J,"GETADMIN",0)=PSBADST
"RTN","PSBOMH",93,0)
 .;Calc adm/frq
"RTN","PSBOMH",94,0)
 .S PSBDT=PSBSTRT
"RTN","PSBOMH",95,0)
 .K PSBO,^UTILITY($J)
"RTN","PSBOMH",96,0)
 .F X=1:1:8 S PSBO(X)=""
"RTN","PSBOMH",97,0)
 .S DIWL=0,DIWR=32,DIWF="C32"
"RTN","PSBOMH",98,0)
 .S X=$P(PSBOSTX," ")_"          "_$P(PSBOSPX," ") D ^DIWP
"RTN","PSBOMH",99,0)
 .S X="@"_$P(PSBOSTX," ",3)_"              @"_$P(PSBOSPX," ",3)_"   " D ^DIWP
"RTN","PSBOMH",100,0)
 .S X="" D ^DIWP
"RTN","PSBOMH",101,0)
 .S X=PSBOITX D ^DIWP
"RTN","PSBOMH",102,0)
 .; DD,SOL,ADD
"RTN","PSBOMH",103,0)
 .S X=""
"RTN","PSBOMH",104,0)
 .F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  S X=X_$S(X]"":", ",1:"")_$P(PSBDDA(Y),U,3)
"RTN","PSBOMH",105,0)
 .F Y=0:0 S Y=$O(PSBADA(Y)) Q:'Y  S X=X_$S(X]"":", ",1:"")_$P(PSBADA(Y),U,3)_" "_$P(PSBADA(Y),U,4)_$P(PSBADA(Y),U,5)
"RTN","PSBOMH",106,0)
 .F Y=0:0 S Y=$O(PSBSOLA(Y)) Q:'Y  S X=X_$S(X]"":", ",1:"")_$P(PSBSOLA(Y),U,3)_" "_$P(PSBSOLA(Y),U,4)
"RTN","PSBOMH",107,0)
 .S X=" "_X,DIWF="I2C32" D ^DIWP S DIWF="C32"
"RTN","PSBOMH",108,0)
 .S PSBTXT=" Give: "_PSBDOSE_" "_PSBMRAB_" "_PSBSCH_" "_PSBIFR
"RTN","PSBOMH",109,0)
 .F  S PSBWORD=$P(PSBTXT," ",1),PSBTXT=$P(PSBTXT," ",2,250) D  Q:PSBTXT=""
"RTN","PSBOMH",110,0)
 ..F  Q:'$L(PSBWORD)  S X=$E(PSBWORD,1,30),PSBWORD=$E(PSBWORD,30,250) D ^DIWP
"RTN","PSBOMH",111,0)
 .K ^TMP("PSJ",$J) D EN^PSJBCMA2(DFN,PSBX) I ^TMP("PSJ",$J,0)'=-1 D   ;get activity log
"RTN","PSBOMH",112,0)
 ..S (PSBDISX,PSBHLDX)=0 F I=1:1:$P(^TMP("PSJ",$J,0),U,4) S X=$G(^TMP("PSJ",$J,I,1)) D  ;loop activities
"RTN","PSBOMH",113,0)
 ...Q:X["EDITED"!(X["VERIF")  ;
"RTN","PSBOMH",114,0)
 ...S:$P(X,U,4)["PLACED ON HOLD" PSBHLDFL=1 ;Set Hold Flag
"RTN","PSBOMH",115,0)
 ...S:$P(X,U,4)["TAKEN OFF HOLD" PSBHLDFL=0 ;Remove Hold Flag
"RTN","PSBOMH",116,0)
 ...S Z=0
"RTN","PSBOMH",117,0)
 ...I X'["OFF HOLD",X'["UNHOLD",X'["REINSTATE" S Z=1 ; inc iv's
"RTN","PSBOMH",118,0)
 ...S PSBHLDX=PSBHLDX+$S(Z>0:1,1:0)
"RTN","PSBOMH",119,0)
 ...S $P(PSBHLD(PSBHLDX),U,$S(Z>0:1,1:11))=^TMP("PSJ",$J,I,1)  ;set up for multiple on hold entries save start & stop as pair if exists 
"RTN","PSBOMH",120,0)
 ..F PSBHLDX=1:1 S X=$G(PSBHLD(PSBHLDX)) Q:'X  D  ;if a hold index - process 
"RTN","PSBOMH",121,0)
 ...S PSBHLDN=$P(PSBHLD(PSBHLDX),U,1),PSBHLDF=$P(PSBHLD(PSBHLDX),U,11)  ;get on/off hold, dates, IEN number(for UD orders) of person. 
"RTN","PSBOMH",122,0)
 ...Q:PSBHLDN>PSBSTOP  Q:(PSBHLDF<PSBSTRT)&(PSBHLDF'="") 
"RTN","PSBOMH",123,0)
 ...F PSBHLDT=PSBSTRT\1:1:PSBSTOP\1 I (PSBHLDT'<(PSBHLDN\1)),(PSBHLDT'>PSBSTOP) D
"RTN","PSBOMH",124,0)
 ....I X["DISCONTINUED" K ^TMP("PSB",$J,"ORDERS",PSBONX,"HOLD",PSBHLDT) S ^TMP("PSB",$J,"ORDERS",PSBONX,"DISC",PSBHLDT)=""
"RTN","PSBOMH",125,0)
 ....I (X["HOLD")&($G(PSBHLDFL))&((PSBHLDN\1)'>PSBHLDT)&((PSBHLDF'<PSBHLDT)!(PSBHLDF="")) S ^TMP("PSB",$J,"ORDERS",PSBONX,"HOLD",PSBHLDT)="" ;Check additional flag for PSB*3*57
"RTN","PSBOMH",126,0)
 ....I X["REINSTATE" K ^TMP("PSB",$J,"ORDERS",PSBONX,"DISC",PSBHLDT) I PSBOSTS="H" S ^TMP("PSB",$J,"ORDERS",PSBONX,"HOLD",PSBHLDT)=""
"RTN","PSBOMH",127,0)
 ...F PSBHLDXP=1:10:$P(PSBHLD(PSBHLDX),U,11)]""+10 D
"RTN","PSBOMH",128,0)
 ....S PSBDESC=$P(PSBHLD(PSBHLDX),U,PSBHLDXP+3),X=$S(PSBDESC["DISCONTINUE":"***",1:"")
"RTN","PSBOMH",129,0)
 ....S X=" "_X_PSBDESC D ^DIWP  ;output activity text 
"RTN","PSBOMH",130,0)
 ....S X="",PSBHLDI=$P(PSBHLD(PSBHLDX),U,PSBHLDXP+4) I PSBHLDI'="" S X=$$GET1^DIQ(200,PSBHLDI,"INITIAL")
"RTN","PSBOMH",131,0)
 ....S:X="" X="99" ;no init present
"RTN","PSBOMH",132,0)
 ....I X'="99" S X=" "_X D ^DIWP   ;get init & store
"RTN","PSBOMH",133,0)
 ....S Y=$P(PSBHLD(PSBHLDX),U,PSBHLDXP) D DD^%DT S X=Y D ^DIWP  ;format hold date / write 
"RTN","PSBOMH",134,0)
 ..K PSBHLD,PSBHLDF,PSBHLDN,PSBHLDT,PSBHLDX,PSBHLDXP,PSBHLDI,PSBDISX,PSBDISC,PSBDISXP,PSBDISI,PSBDIST,PSBDISN,PSBDESC
"RTN","PSBOMH",135,0)
 .F X=0:0 S X=$O(^UTILITY($J,"W",0,X)) Q:'X  S PSBO(X)=$G(^(X,0)) D
"RTN","PSBOMH",136,0)
 .S X=$O(PSBO(""),-1) S X=$S(X<8:8,1:X+1)
"RTN","PSBOMH",137,0)
 .S PSBO(X)=" RPH: "_PSBVPHI_"  RN: "_PSBVNI
"RTN","PSBOMH",138,0)
 .S PSBVAL=$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBIVPSH)
"RTN","PSBOMH",139,0)
 .I PSBODD="1",PSBADST'="" D
"RTN","PSBOMH",140,0)
 ..I (PSBVAL="1")!(PSBX'["V") D   ;checks iv/pb and u dose
"RTN","PSBOMH",141,0)
 ...S PSBO(X+1)=""
"RTN","PSBOMH",142,0)
 ...S PSBO(X+2)="NOTE - ODD SCHEDULE NO LONGER",PSBO(X+3)="       ALLOWS ADMIN TIMES."
"RTN","PSBOMH",143,0)
 .K ^UTILITY($J)
"RTN","PSBOMH",144,0)
 . ;*70 If no location, and not inpatient, and Manual Med Entry, relay this information
"RTN","PSBOMH",145,0)
 .S PSBO(0)=$S(PSBCLINIC]"":PSBCLINIC,1:"INPATIENT")   ;clinic nam *70
"RTN","PSBOMH",146,0)
 .S XORDERS=$S(PSBO(0)="INPATIENT":1,1:2)              ;IM or CO   *70
"RTN","PSBOMH",147,0)
 .M ^TMP("PSB",$J,"ORDERS",PSBX,"INST")=PSBO
"RTN","PSBOMH",148,0)
 .D:PSBTYPE="C"
"RTN","PSBOMH",149,0)
 ..F  D  Q:PSBDT>PSBSTOP
"RTN","PSBOMH",150,0)
 ...S X=PSBDT D H^%DTC S PSBWEEK=%H
"RTN","PSBOMH",151,0)
 ...S ^TMP("PSB",$J,PSBWEEK,PSBONX)=""
"RTN","PSBOMH",152,0)
 ...; Odd schd - msg
"RTN","PSBOMH",153,0)
 ...S PSBIDOW=0 I PSBONX["U"!("PCS"[PSBIVT) S PSBIDOW=1
"RTN","PSBOMH",154,0)
 ...I PSBADST="",PSBIDOW,(PSBODD) D
"RTN","PSBOMH",155,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",0)=7
"RTN","PSBOMH",156,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",1)="odd"
"RTN","PSBOMH",157,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",2)="sched"
"RTN","PSBOMH",158,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",3)=$E(PSBSCH,1,5)
"RTN","PSBOMH",159,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",4)="no"
"RTN","PSBOMH",160,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",5)="fixed"
"RTN","PSBOMH",161,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",6)="admin"
"RTN","PSBOMH",162,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",7)="times"
"RTN","PSBOMH",163,0)
 ...I PSBADST'="",PSBADST'="0000",+$G(PSBFREQ)>0,+$G(PSBFREQ)<45 D
"RTN","PSBOMH",164,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",0)=5
"RTN","PSBOMH",165,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",1)="Due"
"RTN","PSBOMH",166,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",2)="every"
"RTN","PSBOMH",167,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",3)=$E(PSBFREQ,1,5)
"RTN","PSBOMH",168,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",4)="mins."
"RTN","PSBOMH",169,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",5)=" "
"RTN","PSBOMH",170,0)
 ...S PSBATCNT=0    ; # times to print...
"RTN","PSBOMH",171,0)
 ...I PSBADST'="",((+$G(PSBFREQ)>44)!(PSBFREQ="")!(PSBADST="0000")) F PSBXX=0:1  Q:$G(^TMP("PSB",$J,"GETADMIN",PSBXX))=""  D
"RTN","PSBOMH",172,0)
 ....S PSBADST2=$G(^TMP("PSB",$J,"GETADMIN",PSBXX))
"RTN","PSBOMH",173,0)
 ....F Y=1:1:$L(PSBADST2,"-") D
"RTN","PSBOMH",174,0)
 .....Q:($P(PSBADST2,"-",Y)'?2N)&($P(PSBADST2,"-",Y)'?4N)  S PSBATCNT=PSBATCNT+1,^TMP("PSB",$J,"ORDERS",PSBONX,"AT",PSBATCNT)=$P(PSBADST2,"-",Y)
"RTN","PSBOMH",175,0)
 ...;*70   Insert Xorders IM or CO flag (1 or 2) into Sort control
"RTN","PSBOMH",176,0)
 ...I PSBADST'="",PSBFREQ>44 S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",0)=PSBATCNT
"RTN","PSBOMH",177,0)
 ...S ^TMP("PSB",$J,PSBWEEK,"SORT",XORDERS,PSBTYPE,PSBOITX,PSBX)=""
"RTN","PSBOMH",178,0)
 ...F PSBDOW=0:1:6 D  Q:X>(PSBSTOP-1)
"RTN","PSBOMH",179,0)
 ....S %H=PSBWEEK+PSBDOW D YMD^%DTC
"RTN","PSBOMH",180,0)
 ....S ^TMP("PSB",$J,PSBWEEK,PSBONX,X,0)=0
"RTN","PSBOMH",181,0)
 ....I '$D(^TMP("PSB",$J,PSBWEEK,"HDR",X)) S ^TMP("PSB",$J,PSBWEEK,"HDR",X)=$E(X,4,5)_"/"_$E(X,6,7)_"/"_(1700+$E(X,1,3))
"RTN","PSBOMH",182,0)
 ...S %H=PSBWEEK+7 D YMD^%DTC S PSBDT=X
"RTN","PSBOMH",183,0)
 .D:PSBTYPE'="C"
"RTN","PSBOMH",184,0)
 ..S X=PSBDT D H^%DTC S PSBWEEK=%H
"RTN","PSBOMH",185,0)
 ..S (^TMP("PSB",$J,PSBWEEK,PSBONX),^TMP("PSB",$J,PSBWEEK,PSBONX,"AT",0))=""
"RTN","PSBOMH",186,0)
 ..;*70   Insert Xorders IM or CO flag (1 or 2) into Sort control
"RTN","PSBOMH",187,0)
 ..S ^TMP("PSB",$J,PSBWEEK,"SORT",XORDERS,PSBTYPE,PSBOITX,PSBX)=""
"RTN","PSBOMH",188,0)
 D EN^PSBOMH1,EN^PSBOMH2
"RTN","PSBOMH",189,0)
 Q
"RTN","PSBOMH",190,0)
INSTR S PSBINIT=PSBINIT_"*"
"RTN","PSBOMH",191,0)
 S PSBNAME=PSBNAME_"/"_$P(^PSB(53.79,PSBIEN,.9,$P(PSBDT,"."),0),U,3)_"  "_$$GET1^DIQ(53.79,PSBIEN_",",.06)
"RTN","PSBOMH",192,0)
 Q
"RTN","PSBOMH2")
0^38^B56923677^B46571592
"RTN","PSBOMH2",1,0)
PSBOMH2 ;BIRMINGHAM/EFC-MAH ;9/13/12 5:15pm
"RTN","PSBOMH2",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,20,27,26,67,68,70**;Mar 2004;Build 101
"RTN","PSBOMH2",3,0)
 ;
"RTN","PSBOMH2",4,0)
 ; Reference/IA
"RTN","PSBOMH2",5,0)
 ; EN^PSJBCMA/2828
"RTN","PSBOMH2",6,0)
 ; GETSIOPI^PSJBCMA5/5763
"RTN","PSBOMH2",7,0)
 ;
"RTN","PSBOMH2",8,0)
 ;*68 - Add ability to get special instructions at end of each orders
"RTN","PSBOMH2",9,0)
 ;      grid and print in free space before next orders grid, check
"RTN","PSBOMH2",10,0)
 ;      for page overflow each line of word processing text.
"RTN","PSBOMH2",11,0)
 ;*70 - Print Clinic from ^TMP(""PSB",$J,"ORDERS",PSBORD,"INST") on
"RTN","PSBOMH2",12,0)
 ;      the intruction/med cell of grid.  Add psbclinord=2 mode for 
"RTN","PSBOMH2",13,0)
 ;      dual heading text.
"RTN","PSBOMH2",14,0)
 ;
"RTN","PSBOMH2",15,0)
EN ;     Add dual sections for MAH report - IM and then CO           *70
"RTN","PSBOMH2",16,0)
 ;     only one Legend section after CO section
"RTN","PSBOMH2",17,0)
 ;           sort 1 = IM   sort 2 = CO
"RTN","PSBOMH2",18,0)
 ;
"RTN","PSBOMH2",19,0)
 ;*70 MAH was missing report Title
"RTN","PSBOMH2",20,0)
 S Y=$S($P(PSBRPT(.1),U,8)]"":$P(PSBRPT(.1),U,8),1:$P(PSBRPT(.1),U,6))
"RTN","PSBOMH2",21,0)
 S PSBHDR(0)="MEDICATION ADMINISTRATION HISTORY for "_$$FMTE^XLFDT($P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7))_" to "_$$FMTE^XLFDT(Y+$P(PSBRPT(.1),U,9))
"RTN","PSBOMH2",22,0)
 ;
"RTN","PSBOMH2",23,0)
 ;**** INPATIENT ORDERS 1st ****                                   *70
"RTN","PSBOMH2",24,0)
 N PSBSUBHD
"RTN","PSBOMH2",25,0)
 S PSBSUBHD="** INPATIENT ORDERS **"
"RTN","PSBOMH2",26,0)
 S PSBWEEK=0
"RTN","PSBOMH2",27,0)
 F  S PSBWEEK=$O(^TMP("PSB",$J,PSBWEEK)) Q:'PSBWEEK  D
"RTN","PSBOMH2",28,0)
 .D:$D(^TMP("PSB",$J,PSBWEEK,"SORT",1,"C"))
"RTN","PSBOMH2",29,0)
 ..D CONT(1)
"RTN","PSBOMH2",30,0)
 ;
"RTN","PSBOMH2",31,0)
 ; Now the PRN/One Time/On-Call Sheets
"RTN","PSBOMH2",32,0)
 S PSBWEEK=0
"RTN","PSBOMH2",33,0)
 F  S PSBWEEK=$O(^TMP("PSB",$J,PSBWEEK)) Q:'PSBWEEK  D
"RTN","PSBOMH2",34,0)
 .D:$D(^TMP("PSB",$J,PSBWEEK,"SORT",1,"P"))
"RTN","PSBOMH2",35,0)
 ..D PRN(1)
"RTN","PSBOMH2",36,0)
 ;
"RTN","PSBOMH2",37,0)
 ;**** CLINIC ORDERS 2nd ****                                      *70
"RTN","PSBOMH2",38,0)
 S PSBSUBHD="** CLINIC ORDERS **"
"RTN","PSBOMH2",39,0)
 S PSBWEEK=0
"RTN","PSBOMH2",40,0)
 F  S PSBWEEK=$O(^TMP("PSB",$J,PSBWEEK)) Q:'PSBWEEK  D
"RTN","PSBOMH2",41,0)
 .D:$D(^TMP("PSB",$J,PSBWEEK,"SORT",2,"C"))
"RTN","PSBOMH2",42,0)
 ..D CONT(2)
"RTN","PSBOMH2",43,0)
 ;
"RTN","PSBOMH2",44,0)
 ; Now the PRN/One Time/On-Call Sheets
"RTN","PSBOMH2",45,0)
 S PSBWEEK=0
"RTN","PSBOMH2",46,0)
 F  S PSBWEEK=$O(^TMP("PSB",$J,PSBWEEK)) Q:'PSBWEEK  D
"RTN","PSBOMH2",47,0)
 .D:$D(^TMP("PSB",$J,PSBWEEK,"SORT",2,"P"))
"RTN","PSBOMH2",48,0)
 ..D PRN(2)
"RTN","PSBOMH2",49,0)
 ;
"RTN","PSBOMH2",50,0)
 S PSBSUBHD="** LEGEND **"
"RTN","PSBOMH2",51,0)
 D LEGEND
"RTN","PSBOMH2",52,0)
 K ^TMP("PSB",$J)
"RTN","PSBOMH2",53,0)
 Q
"RTN","PSBOMH2",54,0)
 ;
"RTN","PSBOMH2",55,0)
CONT(XO) ;
"RTN","PSBOMH2",56,0)
 N SILN,SITXT
"RTN","PSBOMH2",57,0)
 S PSBHDR(1)="Continuing/PRN/Stat/One Time Medication/Treatment Record (VAF 10-2970 B, C, D)"
"RTN","PSBOMH2",58,0)
 W $$HDR()
"RTN","PSBOMH2",59,0)
 S PSBDRUG=""
"RTN","PSBOMH2",60,0)
 F  S PSBDRUG=$O(^TMP("PSB",$J,PSBWEEK,"SORT",XO,"C",PSBDRUG)) Q:PSBDRUG=""  D
"RTN","PSBOMH2",61,0)
 .S PSBORD=""
"RTN","PSBOMH2",62,0)
 .F  S PSBORD=$O(^TMP("PSB",$J,PSBWEEK,"SORT",XO,"C",PSBDRUG,PSBORD)) Q:'PSBORD  D
"RTN","PSBOMH2",63,0)
 ..S PSBCNT=8
"RTN","PSBOMH2",64,0)
 ..S:$O(^TMP("PSB",$J,"ORDERS",PSBORD,"INST",""),-1)>PSBCNT PSBCNT=$O(^(""),-1)
"RTN","PSBOMH2",65,0)
 ..S:$O(^TMP("PSB",$J,"ORDERS",PSBORD,"AT",""),-1)>PSBCNT PSBCNT=$O(^(""),-1)
"RTN","PSBOMH2",66,0)
 ..W:$Y>(IOSL-PSBCNT-4) $$HDR()
"RTN","PSBOMH2",67,0)
 ..F PSBLINE=0:1:PSBCNT D    ;*70 start at 0 for inserted Clinic name
"RTN","PSBOMH2",68,0)
 ...D CHKPAGE                ;*68 convert overflow logic to a tag call
"RTN","PSBOMH2",69,0)
 ...W !,$G(^TMP("PSB",$J,"ORDERS",PSBORD,"INST",PSBLINE))
"RTN","PSBOMH2",70,0)
 ...W ?32,"| " W:PSBLINE>0 $G(^TMP("PSB",$J,"ORDERS",PSBORD,"AT",PSBLINE))
"RTN","PSBOMH2",71,0)
 ...S PSBDAY=0,PSBCOL=0
"RTN","PSBOMH2",72,0)
 ...F  S PSBDAY=$O(^TMP("PSB",$J,PSBWEEK,"HDR",PSBDAY)) Q:'PSBDAY  D
"RTN","PSBOMH2",73,0)
 ....W ?(40+(PSBCOL*13)),"|" ;Remove space, PSB*3*67
"RTN","PSBOMH2",74,0)
 ....S Y=$G(^TMP("PSB",$J,PSBWEEK,PSBORD,PSBDAY,PSBLINE))
"RTN","PSBOMH2",75,0)
 ....;Write space when status does not contain >, PSB*3*67
"RTN","PSBOMH2",76,0)
 ....I ($L($P(Y,U,2))'=5)!($P(Y,U,3)'="RM"),($P(Y,U,3)'[">") W " "
"RTN","PSBOMH2",77,0)
 ....W $P(Y,U,3)
"RTN","PSBOMH2",78,0)
 ....W $E($P($P(Y,U,1)_"0000",".",2),1,4)," "
"RTN","PSBOMH2",79,0)
 ....W $P(Y,U,2)
"RTN","PSBOMH2",80,0)
 ....I $D(^TMP("PSB",$J,"ORDERS",PSBORD,"HOLD",PSBDAY)),(PSBLINE=PSBCNT) W "HOLD"  ;output hold status
"RTN","PSBOMH2",81,0)
 ....I '$D(^TMP("PSB",$J,"ORDERS",PSBORD,"DISC",PSBDAY))&'$D(^TMP("PSB",$J,"ORDERS",PSBORD,"HOLD",PSBDAY)) D
"RTN","PSBOMH2",82,0)
 .....I $D(^TMP("PSB",$J,"ORDERS",PSBORD,"NTDUE",PSBDAY)),(PSBLINE=PSBCNT) W "***"  ;write *** when day no due
"RTN","PSBOMH2",83,0)
 ....I $D(^TMP("PSB",$J,"ORDERS",PSBORD,"DISC",PSBDAY)),(PSBLINE=PSBCNT) W "***"   ;output discontinued status
"RTN","PSBOMH2",84,0)
 ....S PSBCOL=PSBCOL+1
"RTN","PSBOMH2",85,0)
 ..D SIOPI                     ;*68 get and print SI lines, if exist
"RTN","PSBOMH2",86,0)
 ..W !,$TR($J("",IOM)," ","-")
"RTN","PSBOMH2",87,0)
 Q
"RTN","PSBOMH2",88,0)
 ;
"RTN","PSBOMH2",89,0)
PRN(XO) ;
"RTN","PSBOMH2",90,0)
 S PSBHDR(1)="Continuing/PRN/Stat/One Time Medication/Treatment Record (VAF 10-2970 B, C, D)"
"RTN","PSBOMH2",91,0)
 W $$HDR(1)
"RTN","PSBOMH2",92,0)
 S PSBDRUG=""
"RTN","PSBOMH2",93,0)
 F  S PSBDRUG=$O(^TMP("PSB",$J,PSBWEEK,"SORT",XO,"P",PSBDRUG)) Q:PSBDRUG=""  D
"RTN","PSBOMH2",94,0)
 .S PSBORD=""
"RTN","PSBOMH2",95,0)
 .F  S PSBORD=$O(^TMP("PSB",$J,PSBWEEK,"SORT",XO,"P",PSBDRUG,PSBORD)) Q:'PSBORD  D
"RTN","PSBOMH2",96,0)
 ..S PSBCNT=$O(^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",""),-1)
"RTN","PSBOMH2",97,0)
 ..D:PSBCNT<$O(^TMP("PSB",$J,"ORDERS",PSBORD,"INST",""),-1)
"RTN","PSBOMH2",98,0)
 ...S PSBCNT=$O(^TMP("PSB",$J,"ORDERS",PSBORD,"INST",""),-1)
"RTN","PSBOMH2",99,0)
 ..S:PSBCNT<8 PSBCNT=8  ; Minimum space for order
"RTN","PSBOMH2",100,0)
 ..W:$Y>(IOSL-PSBCNT-4) $$HDR(1)
"RTN","PSBOMH2",101,0)
 ..F PSBLINE=0:1:PSBCNT D
"RTN","PSBOMH2",102,0)
 ...D CHKPAGE                  ;*68 move overflow page logic to a tag
"RTN","PSBOMH2",103,0)
 ...W !,$G(^TMP("PSB",$J,"ORDERS",PSBORD,"INST",PSBLINE))
"RTN","PSBOMH2",104,0)
 ...W ?32,"| ",$G(^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",PSBLINE))
"RTN","PSBOMH2",105,0)
 ..D SIOPI                     ;*68 get and print SI lines, if exist
"RTN","PSBOMH2",106,0)
 ..W !,$TR($J("",IOM)," ","-")
"RTN","PSBOMH2",107,0)
 Q
"RTN","PSBOMH2",108,0)
 ;
"RTN","PSBOMH2",109,0)
LEGEND ;
"RTN","PSBOMH2",110,0)
 ;print the initials - name legend as an extra page  ;
"RTN","PSBOMH2",111,0)
 N PSBCLINORD S PSBCLINORD=2                                    ;*70
"RTN","PSBOMH2",112,0)
 D PT^PSBOHDR(DFN,.PSBHDR,,,,$G(PSBSUBHD))             ;*70
"RTN","PSBOMH2",113,0)
 W !!,"Initial - Name Legend",!  ;
"RTN","PSBOMH2",114,0)
 I $D(^TMP("PSB",$J,"LEGEND"))  D
"RTN","PSBOMH2",115,0)
 .S X=$Q(^TMP("PSB",$J,"LEGEND",""))
"RTN","PSBOMH2",116,0)
 .F  W $S($QS(X,4)[99:"",1:$QS(X,4)),?10,$QS(X,5),! S X=$Q(@X) Q:$QS(X,3)'="LEGEND"  ;
"RTN","PSBOMH2",117,0)
 W !!,"Status Codes",!,"C - Completed",!,"G - Given",!,"H - Held",!,"I - Infusing",!,"M - Missing Dose Requested",!,"R - Refused",!,"RM - Removed",!,"S - Stopped",!  ;
"RTN","PSBOMH2",118,0)
 W "> - Scheduled administration times for the order have been changed",!,"*** - Medication Not Due",! ;add changed Admin time message, PSB*3*67
"RTN","PSBOMH2",119,0)
 K ^TMP("PSJ",$J)
"RTN","PSBOMH2",120,0)
 Q
"RTN","PSBOMH2",121,0)
 ;
"RTN","PSBOMH2",122,0)
HDR(PRN) ;
"RTN","PSBOMH2",123,0)
 ; PRN = TRUE IF DISPLAYING PRN MED (OPTIONAL)
"RTN","PSBOMH2",124,0)
 N PSBCLINORD S PSBCLINORD=2                                      ;*70
"RTN","PSBOMH2",125,0)
 D PT^PSBOHDR(DFN,.PSBHDR,,,,$G(PSBSUBHD))           ;*70
"RTN","PSBOMH2",126,0)
 W !,"Location",?32,"| "                             ;*70
"RTN","PSBOMH2",127,0)
 I '$G(PRN) F X=0:1:6 W ?(40+(X*13)),"|"             ;*70
"RTN","PSBOMH2",128,0)
 W !,"Start Date",?20,"Stop Date",?32,"| ",$S('$G(PRN):"Admin",1:"Action Status")
"RTN","PSBOMH2",129,0)
 I '$G(PRN) F X=0:1:6 W ?(40+(X*13)),"|"
"RTN","PSBOMH2",130,0)
 W !,"and Time",?20,"and Time",?32,"| ",$S('$G(PRN):"Times",1:"Action Date/Times")
"RTN","PSBOMH2",131,0)
 D:'$G(PRN)
"RTN","PSBOMH2",132,0)
 .S PSBCOL=0,X=0 F  S X=$O(^TMP("PSB",$J,PSBWEEK,"HDR",X)) Q:'X  D
"RTN","PSBOMH2",133,0)
 ..W ?(40+(PSBCOL*13)),"| ",$E(X,4,5),"/",$E(X,6,7),"/",(1700+$E(X,1,3))
"RTN","PSBOMH2",134,0)
 ..S PSBCOL=PSBCOL+1
"RTN","PSBOMH2",135,0)
 D:$G(PRN)
"RTN","PSBOMH2",136,0)
 .W ?76,"PRN Reason"
"RTN","PSBOMH2",137,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBOMH2",138,0)
 Q ""
"RTN","PSBOMH2",139,0)
 ;
"RTN","PSBOMH2",140,0)
PSBCK1(PSBCHK) ;                   
"RTN","PSBOMH2",141,0)
 I PSBCHK="A" D
"RTN","PSBOMH2",142,0)
 .S TEST=$P(^PSB(53.79,PSBIEN,0),U,6)
"RTN","PSBOMH2",143,0)
 .D PSBOUT^PSBOMH1(TEST,PSBINIT)
"RTN","PSBOMH2",144,0)
 .S X=$P(^PSB(53.79,PSBIEN,0),U,6)_U_PSBINIT_U_"G"_U_PSBIEN
"RTN","PSBOMH2",145,0)
 I PSBCHK="B" D
"RTN","PSBOMH2",146,0)
 .S TESTB=$P(^PSB(53.79,PSBIEN,0),U,6)
"RTN","PSBOMH2",147,0)
 .D PSBOUT^PSBOMH1(TESTB,PSBINIT)
"RTN","PSBOMH2",148,0)
 .S X=$P(^PSB(53.79,PSBIEN,0),U,6)_U_PSBINIT_U_$P(^(0),U,9)_U_PSBIEN
"RTN","PSBOMH2",149,0)
 S PSBCHK=""
"RTN","PSBOMH2",150,0)
 Q
"RTN","PSBOMH2",151,0)
 ;
"RTN","PSBOMH2",152,0)
PSBENT(PSBTIS) ;
"RTN","PSBOMH2",153,0)
 S PSBNAME="",PSBNAME=$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY:NAME")
"RTN","PSBOMH2",154,0)
 S ^TMP("PSB",$J,"LEGEND",$S($G(PSBTIS)="":99,1:PSBTIS),PSBNAME)=""
"RTN","PSBOMH2",155,0)
 Q
"RTN","PSBOMH2",156,0)
 ;
"RTN","PSBOMH2",157,0)
PSBSTIV ;
"RTN","PSBOMH2",158,0)
 S YB="" F  S YB=$O(PSBAUD(YB)) Q:YB=""  D
"RTN","PSBOMH2",159,0)
 .S Z="" F  S Z=$O(^PSB(53.79,PSBIEN,.9,Z)) Q:Z=""  I Z'=0  D
"RTN","PSBOMH2",160,0)
 ..I $P(PSBAUD(YB),U,1)=$P(^PSB(53.79,PSBIEN,.9,Z,0),"^",1)  D
"RTN","PSBOMH2",161,0)
 ...I $P(^PSB(53.79,PSBIEN,.9,Z,0),"^",3)["Instruct"  D
"RTN","PSBOMH2",162,0)
 ....I $P(PSBAUD(YB),U,2)'["*"  S $P(PSBAUD(YB),U,2)=$P(PSBAUD(YB),U,2)_"*"
"RTN","PSBOMH2",163,0)
 ....D PSBOUT^PSBOMH1($P(PSBAUD(YB),U,1),$P(PSBAUD(YB),U,2))
"RTN","PSBOMH2",164,0)
 Q
"RTN","PSBOMH2",165,0)
 ;
"RTN","PSBOMH2",166,0)
PSBCTAR ;
"RTN","PSBOMH2",167,0)
 S YC="" F  S YC=$O(PSBTAR(YC)) Q:YC=""  D
"RTN","PSBOMH2",168,0)
 .S Z="" F  S Z=$O(^PSB(53.79,PSBIEN,.9,Z)) Q:Z=""  I Z'=0  D
"RTN","PSBOMH2",169,0)
 ..I $P(PSBTAR(YC),U,1)=$P(^PSB(53.79,PSBIEN,.9,Z,0),"^",1)  D
"RTN","PSBOMH2",170,0)
 ...I $P(^PSB(53.79,PSBIEN,.9,Z,0),"^",3)["Instruct"  D
"RTN","PSBOMH2",171,0)
 ....S $P(PSBTAR(YC),U,2)=$P(PSBTAR(YC),U,2)_"*"
"RTN","PSBOMH2",172,0)
 ....D PSBOUT^PSBOMH1($P(^PSB(53.79,PSBIEN,.9,Z,0),"^",1),$P(PSBTAR(YC),U,2))
"RTN","PSBOMH2",173,0)
 Q
"RTN","PSBOMH2",174,0)
 ;
"RTN","PSBOMH2",175,0)
SIOPI ;Get and print SI/OPI Wp text *68
"RTN","PSBOMH2",176,0)
 K ^TMP("PSJBCMA5",$J,DFN)
"RTN","PSBOMH2",177,0)
 S SILN=$$GETSIOPI^PSJBCMA5(DFN,PSBORD,1)
"RTN","PSBOMH2",178,0)
 I SILN F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,DFN,PSBORD,QQ)) Q:'QQ  D
"RTN","PSBOMH2",179,0)
 .S SITXT=^TMP("PSJBCMA5",$J,DFN,PSBORD,QQ)
"RTN","PSBOMH2",180,0)
 .I SILN=1,SITXT="" Q
"RTN","PSBOMH2",181,0)
 .D CHKPAGE I QQ=1 W !," Special Instructions:"
"RTN","PSBOMH2",182,0)
 .D CHKPAGE W !," ",SITXT
"RTN","PSBOMH2",183,0)
 K ^TMP("PSJBCMA5",$J,DFN)
"RTN","PSBOMH2",184,0)
 Q
"RTN","PSBOMH2",185,0)
 ;
"RTN","PSBOMH2",186,0)
CHKPAGE ;check for page full and print overflow msgs and new page headers *68
"RTN","PSBOMH2",187,0)
 I IOSL>24,$Y>$S(PSBCNT<13:(IOSL-PSBCNT-4),(PSBCNT-PSBLINE=12):(IOSL-12),1:(IOSL-12)) D
"RTN","PSBOMH2",188,0)
 .W !!?(IOM-35\2),"*** CONTINUED ON NEXT PAGE ***"
"RTN","PSBOMH2",189,0)
 .W $$HDR()
"RTN","PSBOMH2",190,0)
 .W !?(IOM-35\2),"*** CONTINUED FROM PREVIOUS PAGE ***",!
"RTN","PSBOMH2",191,0)
 Q
"RTN","PSBOML")
0^15^B62348455^B41485291
"RTN","PSBOML",1,0)
PSBOML ;BIRMINGHAM/EFC-MEDICATION LOG ;11/14/12 11:58am
"RTN","PSBOML",2,0)
 ;;3.0;BAR CODE MED ADMIN;**3,11,50,54,70**;Mar 2004;Build 101
"RTN","PSBOML",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOML",4,0)
 ;
"RTN","PSBOML",5,0)
 ; Reference/IA
"RTN","PSBOML",6,0)
 ; ^DPT/10035
"RTN","PSBOML",7,0)
 ; SENDMSG^XMXAPI/2729
"RTN","PSBOML",8,0)
 ;
"RTN","PSBOML",9,0)
 ;*70 - Add Witness for High Risk Drug to report
"RTN","PSBOML",10,0)
 ;    - print Clinic name with each order that occurred in a clinic
"RTN","PSBOML",11,0)
 ;    - set psbclinord=2 for dual hdr text
"RTN","PSBOML",12,0)
 ;    - create var for Search list and use for both IM & CO, pass to
"RTN","PSBOML",13,0)
 ;      PSBOHDR api
"RTN","PSBOML",14,0)
 ;    - 1489: Blended PSB*3*54 with PSB*3*70
"RTN","PSBOML",15,0)
 ;
"RTN","PSBOML",16,0)
EN ; Begin printing
"RTN","PSBOML",17,0)
 N PSBSTRT,PSBSTOP,PSBHDR,DFN,PSBSORT,PSBSRCHL
"RTN","PSBOML",18,0)
 S PSBSORT=$P(PSBRPT(.1),U,1)                                     ;*70
"RTN","PSBOML",19,0)
 S PSBSTRT=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7)
"RTN","PSBOML",20,0)
 S PSBSTOP=$P(PSBRPT(.1),U,8)+$P(PSBRPT(.1),U,9)
"RTN","PSBOML",21,0)
 S PSBAUDF=$P(PSBRPT(.2),U,9)
"RTN","PSBOML",22,0)
 S PSBHDR(0)="Medication Log Report"
"RTN","PSBOML",23,0)
 S PSBHDR(1)="Continuing/PRN/Stat/One Time Medication/Treatment Record (Detailed Log) (VAF 10-2970 B, C, D)"
"RTN","PSBOML",24,0)
 ;check Clinic or Nurs Unit search list                *70
"RTN","PSBOML",25,0)
 S PSBSRCHL=$$SRCHLIST^PSBOHDR()
"RTN","PSBOML",26,0)
 ;
"RTN","PSBOML",27,0)
 ; Patient Report
"RTN","PSBOML",28,0)
 ;
"RTN","PSBOML",29,0)
 D:PSBSORT="P"
"RTN","PSBOML",30,0)
 .S PSBHDR(2)="Log Type: INDIVIDUAL PATIENT"
"RTN","PSBOML",31,0)
 .S DFN=+$P(PSBRPT(.1),U,2)
"RTN","PSBOML",32,0)
 .W $$PTHDR()
"RTN","PSBOML",33,0)
 .S X=$O(^PSB(53.79,"AADT",DFN,PSBSTRT-.0000001))
"RTN","PSBOML",34,0)
 .I X>PSBSTOP!(X="") W !!?10,"<<<< NO MEDICATIONS FOUND FOR THIS TIME FRAME >>>>",!! Q
"RTN","PSBOML",35,0)
 .S PSBGBL=$NAME(^PSB(53.79,"AADT",DFN,PSBSTRT-.0000001))
"RTN","PSBOML",36,0)
 .F  S PSBGBL=$Q(@PSBGBL) Q:PSBGBL=""  Q:$QS(PSBGBL,2)'="AADT"!($QS(PSBGBL,3)'=DFN)!($QS(PSBGBL,4)>PSBSTOP)  D
"RTN","PSBOML",37,0)
 ..S PSBIEN=$QS(PSBGBL,5) Q:'$D(^PSB(53.79,PSBIEN))
"RTN","PSBOML",38,0)
 ..I $P(^PSB(53.79,PSBIEN,0),U,6)'=$QS(PSBGBL,4) Q
"RTN","PSBOML",39,0)
 ..I $Y>(IOSL-10) W $$PTFTR^PSBOHDR(),$$PTHDR()
"RTN","PSBOML",40,0)
 ..W $$LINE(PSBIEN)
"RTN","PSBOML",41,0)
 .W $$PTFTR^PSBOHDR()
"RTN","PSBOML",42,0)
 ;
"RTN","PSBOML",43,0)
 ; Ward Output
"RTN","PSBOML",44,0)
 ;
"RTN","PSBOML",45,0)
 D:PSBSORT="W"
"RTN","PSBOML",46,0)
 .S PSBHDR(2)="LOG TYPE: WARD"
"RTN","PSBOML",47,0)
 .W $$WDHDR(PSBWRD)
"RTN","PSBOML",48,0)
 .S PSBTMPG=$NAME(^TMP("PSBO",$J,"B"))
"RTN","PSBOML",49,0)
 .F  S PSBTMPG=$Q(@PSBTMPG) Q:PSBTMPG=""  Q:$QS(PSBTMPG,1)'="PSBO"!($QS(PSBTMPG,2)'=$J)  D
"RTN","PSBOML",50,0)
 ..S DFN=$QS(PSBTMPG,5)
"RTN","PSBOML",51,0)
 ..I $Y>(IOSL-14) W $$WDHDR(PSBWRD)
"RTN","PSBOML",52,0)
 ..W !,$P(^DPT(DFN,0),U),"  (",$P(^(0),U,9),")"
"RTN","PSBOML",53,0)
 ..W !,"Ward: ",$G(^DPT(DFN,.1),"***"),"  Rm-Bed: ",$G(^DPT(DFN,.101),"***"),!
"RTN","PSBOML",54,0)
 ..S X=$O(^PSB(53.79,"AADT",DFN,PSBSTRT-.0000001))
"RTN","PSBOML",55,0)
 ..I X>PSBSTOP!(X="") W !!?10,"<<<< NO MEDICATIONS FOUND FOR THIS TIME FRAME >>>>",!! Q
"RTN","PSBOML",56,0)
 ..S PSBGBL=$NAME(^PSB(53.79,"AADT",DFN,PSBSTRT-.0000001))
"RTN","PSBOML",57,0)
 ..F  S PSBGBL=$Q(@PSBGBL) Q:PSBGBL=""  Q:$QS(PSBGBL,2)'="AADT"!($QS(PSBGBL,3)'=DFN)!($QS(PSBGBL,4)>PSBSTOP)  D
"RTN","PSBOML",58,0)
 ...S PSBIEN=$QS(PSBGBL,5) I $P(^PSB(53.79,PSBIEN,0),U,6)'=$QS(PSBGBL,4) Q
"RTN","PSBOML",59,0)
 ...W:$Y>(IOSL-10) $$WDHDR(PSBWRD)
"RTN","PSBOML",60,0)
 ...W $$LINE(PSBIEN)
"RTN","PSBOML",61,0)
 Q
"RTN","PSBOML",62,0)
 ;
"RTN","PSBOML",63,0)
LINE(PSBIEN) ; Displays the med log entry in PSBIEN
"RTN","PSBOML",64,0)
 N PSBX,PSBASTUS,PSBMME,PSBEXIST
"RTN","PSBOML",65,0)
 S X=$P($G(^PSB(53.79,PSBIEN,.1)),U)
"RTN","PSBOML",66,0)
 I X="" W !,"Error: Med Log Entry ",PSBIEN," has no order reference number!" Q ""
"RTN","PSBOML",67,0)
 I 'PSBAUDF,$P(^PSB(53.79,PSBIEN,0),U,9)="N" Q ""
"RTN","PSBOML",68,0)
 D CLEAN^PSBVT
"RTN","PSBOML",69,0)
 D PSJ1^PSBVT(DFN,X,,.PSBEXIST)
"RTN","PSBOML",70,0)
 ;   ;[*70-1489]...start
"RTN","PSBOML",71,0)
 I '$G(PSBEXIST),($G(PSBSCRT)="-1") D  ;send email to BCMA UKNOWN ACTIONS group if order given in BCMA does not have a corresponding # 55 file entry
"RTN","PSBOML",72,0)
 .N XMDUZ,XMSUB,XMTEXT,XMY,PSBERR,PSBPARAM,PSBMG
"RTN","PSBOML",73,0)
 .S XMSUB="Order given in BCMA does not exist in Pharmacy Patient file"
"RTN","PSBOML",74,0)
 .S XMDUZ=DUZ
"RTN","PSBOML",75,0)
 .S XMTEXT="PSBERR"
"RTN","PSBOML",76,0)
 .S PSBMG=$$GET^XPAR("DIV","PSB MG ADMIN ERROR",,"E"),PSBMG="G."_PSBMG
"RTN","PSBOML",77,0)
 .S XMY(PSBMG)=""
"RTN","PSBOML",78,0)
 .S PSBERR(1)="Order #"_$G(PSBIEN)_" given in BCMA no longer has"
"RTN","PSBOML",79,0)
 .S PSBERR(2)="a corresponding entry in the Pharmacy Patient (#55) file."
"RTN","PSBOML",80,0)
 .S PSBERR(3)="Please submit a remedy ticket for this issue."
"RTN","PSBOML",81,0)
 .D SENDMSG^XMXAPI(XMDUZ,XMSUB,XMTEXT,.XMY)
"RTN","PSBOML",82,0)
 .Q
"RTN","PSBOML",83,0)
  ;   ;[*70-1489]...end
"RTN","PSBOML",84,0)
 I PSBDFN="-1" W !,"Error: Inpatient Meds API Failure!" Q ""
"RTN","PSBOML",85,0)
 M PSBX=^PSB(53.79,PSBIEN)
"RTN","PSBOML",86,0)
 S Y=$P(PSBX(0),U,4)+.0000001
"RTN","PSBOML",87,0)
 ;*70 print location name per each clinic order
"RTN","PSBOML",88,0)
 S PSBMME=$$MME(+$G(PSBIEN)) I $G(PSBMME),($TR($P(PSBX(0),U,2)," ","")="") S $P(PSBX(0),U,2)="MME/UNKNOWN LOCATION"
"RTN","PSBOML",89,0)
 W:$P(PSBX(0),U,2)]"" !,?3,$P(PSBX(0),U,2)
"RTN","PSBOML",90,0)
 W !,$E(Y,4,5),"/",$E(Y,6,7),"/",$E(Y,2,3)
"RTN","PSBOML",91,0)
 W " ",$E(Y,9,10),":",$E(Y,11,12)
"RTN","PSBOML",92,0)
 S Y=$$GET1^DIQ(53.79,PSBIEN_",",.08)
"RTN","PSBOML",93,0)
 S Y=Y_" ["_$G(PSBDOSE)_$G(PSBIFR)_" "_$G(PSBSCH)   ;[*70-1489]
"RTN","PSBOML",94,0)
 S Y=Y_" "_$G(PSBMRAB)                              ;[*70-1489]
"RTN","PSBOML",95,0)
 S:$P($G(^PSB(53.79,PSBIEN,.1)),U,6)]"" Y=Y_" Inj Site: "_$P(^(.1),U,6)
"RTN","PSBOML",96,0)
 S Y=Y_"]"
"RTN","PSBOML",97,0)
 W $$WRAP^PSBO(16,32,Y)
"RTN","PSBOML",98,0)
 W ?50,$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY:INITIAL")
"RTN","PSBOML",99,0)
 S X=$P(PSBX(0),U,9)
"RTN","PSBOML",100,0)
 S PSBASTUS=$S(X="G":"Given",X="H":"Held",X="R":"Refused",X="I":"Infusing",X="C":"Completed",X="S":"Stopped",X="N":"Not Given",X="RM":"Removed",X="M":"Missing dose",1:"Status Unknown")
"RTN","PSBOML",101,0)
 S Y=$P(PSBX(0),U,6)+.0000001
"RTN","PSBOML",102,0)
 S Y=$E(Y,4,5)_"/"_$E(Y,6,7)_"/"_$E(Y,2,3)_" "_$E(Y,9,10)_":"_$E(Y,11,12)
"RTN","PSBOML",103,0)
 S Y=Y_" "_$G(PSBASTUS)   ;[*70-1489]
"RTN","PSBOML",104,0)
 W $$WRAP^PSBO(57,15,Y)
"RTN","PSBOML",105,0)
 W:$P(PSBX(.1),U)["V" ?75,"Bag ID #",$$GET1^DIQ(53.79,PSBIEN,"IV UNIQUE ID")
"RTN","PSBOML",106,0)
 W:$P(PSBX(.1),U)["V" ?107,"NA",?115,"NA",?120,"NA"
"RTN","PSBOML",107,0)
 W !,$TR($$FMTE^XLFDT($G(PSBOST),2),"@"," ")_">"   ;[*70-1489]
"RTN","PSBOML",108,0)
 F PSBZ=.5,.6,.7 S PSBDHIT=0 F PSBY=0:0 S PSBY=$O(PSBX(PSBZ,PSBY)) Q:'PSBY  D
"RTN","PSBOML",109,0)
 .W:$X>75 !
"RTN","PSBOML",110,0)
 .S PSBDD=$S(PSBZ=.5:53.795,PSBZ=.6:53.796,1:53.797)
"RTN","PSBOML",111,0)
 .S Y=$$EXTERNAL^DILFD(PSBDD,.01,"",$P(PSBX(PSBZ,PSBY,0),U,1))
"RTN","PSBOML",112,0)
 .W $$WRAP^PSBO(75,28,Y)
"RTN","PSBOML",113,0)
 .I $P(PSBX(.1),U)["U" W ?105,$J($P(PSBX(PSBZ,PSBY,0),U,2),6,2),?113,$J($P(PSBX(PSBZ,PSBY,0),U,3),6,2) W $$WRAP^PSBO(120,12,$P(PSBX(PSBZ,PSBY,0),U,4)) S PSBDHIT=1
"RTN","PSBOML",114,0)
 .W:$P(PSBX(.1),U)["V"&($X+3+$L($P(PSBX(PSBZ,PSBY,0),U,3))>105) !?75
"RTN","PSBOML",115,0)
 .W:$P(PSBX(.1),U)["V" " - ",$P(PSBX(PSBZ,PSBY,0),U,3)
"RTN","PSBOML",116,0)
 D:$P($G(^PSB(53.79,PSBIEN,.1)),U,2)="P"
"RTN","PSBOML",117,0)
 .W !?16,"PRN Reason: ",?30,$$GET1^DIQ(53.79,PSBIEN_",",.21)
"RTN","PSBOML",118,0)
 .W !?16,"PRN Effectiveness: "
"RTN","PSBOML",119,0)
 .I $P($G(^PSB(53.79,PSBIEN,.2)),U,2)="" W "<No PRN Effectiveness Entered>" Q
"RTN","PSBOML",120,0)
 .N PSBEIECMT S PSBEIECMT="" I $P($G(^PSB(53.79,PSBIEN,.2)),U,2)'="",$P(PSBRPT(.2),U,8)=0 S PSBEIECMT=$$PRNEFF^PSBO(PSBEIECMT,PSBIEN)
"RTN","PSBOML",121,0)
 .W $$WRAP^PSBO(20,100,$$GET1^DIQ(53.79,PSBIEN_",",.22)_PSBEIECMT)
"RTN","PSBOML",122,0)
 .W !?20,"Entered By: ",$$GET1^DIQ(53.79,PSBIEN_",",.23)
"RTN","PSBOML",123,0)
 .W " Date/Time: ",$$GET1^DIQ(53.79,PSBIEN_",",.24)
"RTN","PSBOML",124,0)
 .W " Minutes: ",$$GET1^DIQ(53.79,PSBIEN_",",.25)
"RTN","PSBOML",125,0)
 D:$P(PSBRPT(.2),U,8)
"RTN","PSBOML",126,0)
 .W !?16,"Comments: ",?30 I '$O(PSBX(.3,0)) W "<No Comments>"
"RTN","PSBOML",127,0)
 .F PSBY=0:0 S PSBY=$O(PSBX(.3,PSBY)) Q:'PSBY  D
"RTN","PSBOML",128,0)
 ..W:$X>30 !?30
"RTN","PSBOML",129,0)
 ..S Y=$P(PSBX(.3,PSBY,0),U,3)+.0000001
"RTN","PSBOML",130,0)
 ..W $E(Y,4,5),"/",$E(Y,6,7),"/",$E(Y,2,3)
"RTN","PSBOML",131,0)
 ..W " ",$E(Y,9,10),":",$E(Y,11,12)
"RTN","PSBOML",132,0)
 ..W ?46,$$GET1^DIQ(53.793,PSBY_","_PSBIEN_",","ENTERED BY:INITIAL")
"RTN","PSBOML",133,0)
 ..W $$WRAP^PSBO(52,70,$P(PSBX(.3,PSBY,0),U,1))
"RTN","PSBOML",134,0)
 .;*70 Witness new line after Comments section chosen
"RTN","PSBOML",135,0)
 .N WITBY,WITDT,WITCM,WITHR,WITFL
"RTN","PSBOML",136,0)
 .S WITBY=$$GET1^DIQ(53.79,PSBIEN_",",.29)
"RTN","PSBOML",137,0)
 .S WITDT=$$GET1^DIQ(53.79,PSBIEN_",",.28,"I")
"RTN","PSBOML",138,0)
 .S WITCM=$$GET1^DIQ(53.79,PSBIEN_",",.31)
"RTN","PSBOML",139,0)
 .S WITHR=$$GET1^DIQ(53.79,PSBIEN_",",.32)
"RTN","PSBOML",140,0)
 .S WITFL=$$GET1^DIQ(53.79,PSBIEN_",",.33)
"RTN","PSBOML",141,0)
 .I WITBY]"" D
"RTN","PSBOML",142,0)
 ..W !?16,"Witnessed by:",?30,WITBY," on "
"RTN","PSBOML",143,0)
 ..W $P($$FMTE^XLFDT($$GET1^DIQ(53.79,PSBIEN_",",.28,"I"),2),":",1,2)
"RTN","PSBOML",144,0)
 .I WITFL="NO",WITBY="" D
"RTN","PSBOML",145,0)
 ..W !?16,"Witnessed?:",?30,WITFL
"RTN","PSBOML",146,0)
 .W:WITCM]"" !,$$WRAP^PSBO(30,102,WITCM)
"RTN","PSBOML",147,0)
 .;
"RTN","PSBOML",148,0)
 .W !,$TR($$FMTE^XLFDT($G(PSBOSP),2),"@"," ")_"<"   ;[*70-1489]
"RTN","PSBOML",149,0)
 .;
"RTN","PSBOML",150,0)
 D:PSBAUDF
"RTN","PSBOML",151,0)
 .W !?16,"Audits: ",?30 I '$O(PSBX(.9,0)) W "<No Audits>" Q
"RTN","PSBOML",152,0)
 .F PSBY=0:0 S PSBY=$O(PSBX(.9,PSBY)) Q:'PSBY  D
"RTN","PSBOML",153,0)
 ..W:$X>30 !?30
"RTN","PSBOML",154,0)
 ..S Y=$P(PSBX(.9,PSBY,0),U,1)+.0000001
"RTN","PSBOML",155,0)
 ..W $E(Y,4,5),"/",$E(Y,6,7),"/",$E(Y,2,3)
"RTN","PSBOML",156,0)
 ..W " ",$E(Y,9,10),":",$E(Y,11,12)
"RTN","PSBOML",157,0)
 ..W ?46,$$GET1^DIQ(53.799,PSBY_","_PSBIEN_",","USER:INITIAL")
"RTN","PSBOML",158,0)
 ..W $$WRAP^PSBO(52,70,$P(PSBX(.9,PSBY,0),U,3))
"RTN","PSBOML",159,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBOML",160,0)
 Q ""
"RTN","PSBOML",161,0)
 ;
"RTN","PSBOML",162,0)
WDHDR(PSBWARD) ;
"RTN","PSBOML",163,0)
 N PSBCLINORD S PSBCLINORD=2              ;2=both order type hdr   *70
"RTN","PSBOML",164,0)
 S PSBHDR(3)="",PSBHDR(4)="Ward Location: "
"RTN","PSBOML",165,0)
 D WARD^PSBOHDR(PSBWARD,.PSBHDR,,,PSBSRCHL)
"RTN","PSBOML",166,0)
 W $$SUB()
"RTN","PSBOML",167,0)
 Q ""
"RTN","PSBOML",168,0)
 ;
"RTN","PSBOML",169,0)
PTHDR() ;
"RTN","PSBOML",170,0)
 N PSBCLINORD S PSBCLINORD=2              ;2=both order type hdr   *70
"RTN","PSBOML",171,0)
 S:$G(PSBSRCHL)]"" PSBHDR(3)="",PSBHDR(4)="Ward Location: "
"RTN","PSBOML",172,0)
 D PT^PSBOHDR(DFN,.PSBHDR,,,PSBSRCHL)
"RTN","PSBOML",173,0)
 W $$SUB()
"RTN","PSBOML",174,0)
 Q ""
"RTN","PSBOML",175,0)
 ;
"RTN","PSBOML",176,0)
SUB() ; Med Log Sub Header
"RTN","PSBOML",177,0)
 W:$X>1 !
"RTN","PSBOML",178,0)
 W "Location",!
"RTN","PSBOML",179,0)
 W "Activity Date",?16,"Orderable Item",?50,"Action",?57,"Action"
"RTN","PSBOML",180,0)
 W !,"Start Date>",?16,"[Dose/Sched/Route/Inj Site]",?50,"By"
"RTN","PSBOML",181,0)
 W ?57,"Date/Time",?75,"Drug/Additive/Solution",?105," U/Ord"
"RTN","PSBOML",182,0)
 W ?113," U/Gvn",?120,"Unit",!,"Stop Date<"
"RTN","PSBOML",183,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBOML",184,0)
 Q ""
"RTN","PSBOML",185,0)
 ;
"RTN","PSBOML",186,0)
MME(PSBIEN) ; Administered via Manual Med Entry?
"RTN","PSBOML",187,0)
 N MME,CMMT,CMMTND S MME=0
"RTN","PSBOML",188,0)
 S CMMT="" F  S CMMT=$O(^PSB(53.79,+PSBIEN,.3,CMMT)) Q:CMMT=""!$G(MME)  D
"RTN","PSBOML",189,0)
 .S CMMTND=$G(^PSB(53.79,+PSBIEN,.3,CMMT,0)) I CMMTND["Entry created with 'Manual Medication Entry'" S MME=1
"RTN","PSBOML",190,0)
 Q $S($G(MME):1,1:0)
"RTN","PSBOMM")
0^3^B142931678^B104750914
"RTN","PSBOMM",1,0)
PSBOMM ;BIRMINGHAM/EFC-MISSED MEDS ;9/20/12 2:08pm
"RTN","PSBOMM",2,0)
 ;;3.0;BAR CODE MED ADMIN;**26,32,56,52,58,70**;Mar 2004;Build 101
"RTN","PSBOMM",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOMM",4,0)
 ;
"RTN","PSBOMM",5,0)
 ; Reference/IA
"RTN","PSBOMM",6,0)
 ; ^DPT/10035
"RTN","PSBOMM",7,0)
 ; EN^PSJBCMA/2828
"RTN","PSBOMM",8,0)
 ; EN^PSJBCMA2/2830
"RTN","PSBOMM",9,0)
 ;
"RTN","PSBOMM",10,0)
 ;*58 - insert Verified by Column with nurse initials else "***"
"RTN","PSBOMM",11,0)
 ;*70 - add test for PSBCLINORD flag and filter accordingly
"RTN","PSBOMM",12,0)
 ;
"RTN","PSBOMM",13,0)
EN ;
"RTN","PSBOMM",14,0)
 N PSBSTRT,PSBSTOP,DFN,PSBODATE,PSBFLAG,PSBCNT,PSBEDIT,PSBFUTR
"RTN","PSBOMM",15,0)
 S PSBSTART=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7),PSBSTOP=$P(PSBRPT(.1),U,8)+$P(PSBRPT(.1),U,9)
"RTN","PSBOMM",16,0)
 D DEFLT^PSBOMM2
"RTN","PSBOMM",17,0)
 K PSBOCRIT,PSBACRIT,PSBS
"RTN","PSBOMM",18,0)
 S PSBOCRIT="^A^H^O" ;PSB*3*56 Adds the On Call Status to the Missed Meds Report
"RTN","PSBOMM",19,0)
 S:$P(PSBFUTR,U,8) PSBOCRIT=PSBOCRIT_"^D^DE" S:$P(PSBFUTR,U,7) PSBOCRIT=PSBOCRIT_"^E"
"RTN","PSBOMM",20,0)
 S PSBACRIT="MG"
"RTN","PSBOMM",21,0)
 S:$P(PSBFUTR,U,17) PSBACRIT=PSBACRIT_"H" S:$P(PSBFUTR,U,18) PSBACRIT=PSBACRIT_"R"
"RTN","PSBOMM",22,0)
 S PSBINCC=0 S:$P(PSBRPT(.2),U,8) PSBINCC=1
"RTN","PSBOMM",23,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J),^TMP("PSB1",$J)
"RTN","PSBOMM",24,0)
 S PSBSTRT=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7)-.0000001
"RTN","PSBOMM",25,0)
 F DFN=0:0 S DFN=$O(^TMP("PSBO",$J,DFN)) Q:'DFN  D EN1
"RTN","PSBOMM",26,0)
 D PRINT
"RTN","PSBOMM",27,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J),^TMP("PSBO",$J),PSBS
"RTN","PSBOMM",28,0)
 Q
"RTN","PSBOMM",29,0)
EN1 ;
"RTN","PSBOMM",30,0)
 N PSBGBL,PSBHDR,PSBX,PSBDFN,PSBDT,PSBEVDT,PSBH
"RTN","PSBOMM",31,0)
 K ^TMP("PSJ",$J) S PSBEVDT=PSBSTRT
"RTN","PSBOMM",32,0)
 D EN^PSJBCMA(DFN,PSBSTRT)
"RTN","PSBOMM",33,0)
 ;Filter in/out Clinic Orders               *70
"RTN","PSBOMM",34,0)
 D:PSBCLINORD
"RTN","PSBOMM",35,0)
 . I $D(PSBRPT(2)) D FILTERCO^PSBO Q
"RTN","PSBOMM",36,0)
 . D INCLUDCO^PSBVDLU1
"RTN","PSBOMM",37,0)
 D:'PSBCLINORD REMOVECO^PSBVDLU1
"RTN","PSBOMM",38,0)
 ;
"RTN","PSBOMM",39,0)
 Q:^TMP("PSJ",$J,1,0)=-1
"RTN","PSBOMM",40,0)
 S PSBX=""
"RTN","PSBOMM",41,0)
 F  S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:PSBX=""  D
"RTN","PSBOMM",42,0)
 .Q:^TMP("PSJ",$J,PSBX,0)=-1
"RTN","PSBOMM",43,0)
 .D NOW^%DTC
"RTN","PSBOMM",44,0)
 .D CLEAN^PSBVT
"RTN","PSBOMM",45,0)
 .D PSJ^PSBVT(PSBX)
"RTN","PSBOMM",46,0)
 .Q:PSBIVT="A"
"RTN","PSBOMM",47,0)
 .Q:PSBIVT="H"
"RTN","PSBOMM",48,0)
 .I PSBIVT["S",PSBISYR'=1 Q
"RTN","PSBOMM",49,0)
 .I PSBIVT["C",PSBCHEMT'="P",PSBISYR'=1 Q
"RTN","PSBOMM",50,0)
 .I PSBIVT["C",PSBCHEMT="A" Q
"RTN","PSBOMM",51,0)
 .Q:PSBONX["P"
"RTN","PSBOMM",52,0)
 .Q:PSBOSP<PSBSTART
"RTN","PSBOMM",53,0)
 .I %>PSBOSP,PSBOSTS'="D",PSBOSTS'="DE",PSBOSTS'="H" S PSBOSTS="E"
"RTN","PSBOMM",54,0)
 .I PSBSCHT="C" D  Q
"RTN","PSBOMM",55,0)
 ..S (PSBYES,PSBODD)=0
"RTN","PSBOMM",56,0)
 ..S PSBDOW="SU^MO^TU^WE^TH^FR^SA" F I=1:1:7 I $P(PSBDOW,"^",I)=$E(PSBSCH,1,2) S PSBYES=1
"RTN","PSBOMM",57,0)
 ..I PSBYES,PSBADST="" Q
"RTN","PSBOMM",58,0)
 ..F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1
"RTN","PSBOMM",59,0)
 ..S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBOMM",60,0)
 ..I PSBFREQ="O" S PSBYES=1,PSBFREQ=1440
"RTN","PSBOMM",61,0)
 ..I 'PSBYES,PSBADST="",PSBFREQ<1 Q
"RTN","PSBOMM",62,0)
 ..I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBOMM",63,0)
 ..I PSBODD,PSBADST'="" Q
"RTN","PSBOMM",64,0)
 ..Q:PSBOCRIT'[PSBOSTS
"RTN","PSBOMM",65,0)
 ..Q:PSBNGF
"RTN","PSBOMM",66,0)
 ..Q:PSBOSTS="N"
"RTN","PSBOMM",67,0)
 ..Q:PSBSM
"RTN","PSBOMM",68,0)
 ..S PSBS(DFN,PSBONX,$S(PSBOSTS="A":"Active",PSBOSTS="H":"On Hold",PSBOSTS="D":"DC'd",PSBOSTS="DE":"DC'd (Edit)",PSBOSTS="E":"Expired",PSBOSTS="O":"On Call",1:"*Unknown*"))=""
"RTN","PSBOMM",69,0)
 ..S PSBSTXP(PSBONX,DFN,$$DTFMT^PSBOMM2(PSBOSP))="" ;DFN added to PSBSTXP array in PSB*3*52
"RTN","PSBOMM",70,0)
 ..S PSBCADM=0
"RTN","PSBOMM",71,0)
 ..I PSBADST="" D  Q:$G(PSBADST)=""  S PSBCADM=1
"RTN","PSBOMM",72,0)
 ...S X=PSBOST D H^%DTC S X1=((%H*24)*60)+(%T/60)
"RTN","PSBOMM",73,0)
 ...S X=PSBSTRT,X3=0 D H^%DTC S X2=((%H*24)*60)+(%T/60)
"RTN","PSBOMM",74,0)
 ...I X2'<X1 S X3=X2-X1 S PSBOST=$$FMADD^XLFDT(PSBSTRT,,,(-1*(X3#PSBFREQ)))
"RTN","PSBOMM",75,0)
 ...K PSBADST S PSBOST2=PSBOST,PSBDT2=PSBSTRT
"RTN","PSBOMM",76,0)
 ...F XZ=0:1 S PSBADST(XZ,PSBDT2)=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST2,PSBFREQ,PSBDT2) D  Q:PSBDT2>PSBSTOP
"RTN","PSBOMM",77,0)
 ....I ($L(PSBADST(XZ,PSBDT2),"-")>$L($G(PSBADST),"-"))!($G(PSBADST)="") S PSBADST=PSBADST(XZ,PSBDT2)
"RTN","PSBOMM",78,0)
 ....S Z=PSBDT2\1,J=$P(PSBADST(XZ,PSBDT2),"-",($L(PSBADST(XZ,PSBDT2),"-"))) S:J]"" PSBOST2=Z_"."_J
"RTN","PSBOMM",79,0)
 ....S PSBDT2=($$FMADD^XLFDT(Z,1))+.2400
"RTN","PSBOMM",80,0)
 ....S PSBDT2=$S($G(FLG):(PSBSTOP\1)+.2401,PSBDT2>PSBOSP:PSBOSP,1:PSBDT2) K FLG I PSBDT2=PSBOSP S FLG=1
"RTN","PSBOMM",81,0)
 ..S Z=PSBADST I Z]"" K ^TMP("PSB",$J,"GETADMIN") S ^TMP("PSB",$J,"GETADMIN",0)=Z
"RTN","PSBOMM",82,0)
 ..F Y=1:1:$L(Z,"-") D
"RTN","PSBOMM",83,0)
 ...Q:($P(Z,"-",Y)'?2N)&($P(Z,"-",Y)'?4N)
"RTN","PSBOMM",84,0)
 ..K PSBOACTL,^TMP("PSB1",$J) D EN^PSJBCMA2(DFN,PSBONX,1) I ^TMP("PSJ2",$J,0)'=1 M PSBOACTL=^TMP("PSJ2",$J) K ^TMP("PSJ2",$J)
"RTN","PSBOMM",85,0)
 ..I 'PSBODD F XX=0:1 Q:'$D(^TMP("PSB",$J,"GETADMIN",XX))  S (PSBADST,Z)=$G(^TMP("PSB",$J,"GETADMIN",XX)) D
"RTN","PSBOMM",86,0)
 ...D MISSED^PSBOMM2(Z,.PSBEDIT,PSBSTRT)
"RTN","PSBOMM",87,0)
 ..I PSBODD F XX=0:1 Q:'$D(PSBADST(XX))  S XXX=$O(PSBADST(XX,"")) S (PSBADST,Z)=PSBADST(XX,XXX) D
"RTN","PSBOMM",88,0)
 ...I Z]"" D MISSED^PSBOMM2(Z,.PSBEDIT,XXX)
"RTN","PSBOMM",89,0)
 .K PSBHDDT,PSBUNHD,^TMP("PSB1",$J)
"RTN","PSBOMM",90,0)
 .I PSBSCHT="O" D  Q
"RTN","PSBOMM",91,0)
 ..Q:PSBOSTS="N"
"RTN","PSBOMM",92,0)
 ..Q:PSBNGF
"RTN","PSBOMM",93,0)
 ..Q:PSBSM
"RTN","PSBOMM",94,0)
 ..Q:(PSBOSP=PSBOST)&(PSBOCRIT'["E")
"RTN","PSBOMM",95,0)
 ..Q:PSBOST'<PSBSTOP
"RTN","PSBOMM",96,0)
 ..S PSBDT="*** ONE-TIME ***"
"RTN","PSBOMM",97,0)
 ..S (PSBSTXP(PSBONX,DFN,$$DTFMT^PSBOMM2(PSBOSP)),PSBSTXT(PSBONX,DFN,$$DTFMT^PSBOMM2(PSBOST)))="" ;DFN added to PSBSTXP array in PSB*3*52
"RTN","PSBOMM",98,0)
 ..S (PSBG,X,Y,PSBXSTS)="" K PSBEXST
"RTN","PSBOMM",99,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBOMM",100,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBOMM",101,0)
 ....S PSBXSTS=$P(^PSB(53.79,Y,0),U,9)
"RTN","PSBOMM",102,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBONX,PSBXSTS'="N",PSBXSTS'="M" S PSBG=1,PSBG(PSBONX,DFN,Y)="",(X,Y)=0 ;DFN added to PSBG array in PSB*3*52
"RTN","PSBOMM",103,0)
 ..I PSBG D PARTG1^PSBOMM2($O(PSBG(PSBONX,DFN,""))) ;DFN added to PSBG array in PSB*3*52
"RTN","PSBOMM",104,0)
 ..D NOW^%DTC
"RTN","PSBOMM",105,0)
 ..Q:(PSBOCRIT'[PSBOSTS)
"RTN","PSBOMM",106,0)
 ..S PSBS(DFN,PSBONX,$S(PSBOSTS="A":"Active",PSBOSTS="H":"On Hold",PSBOSTS="D":"DC'd",PSBOSTS="DE":"DC'd (Edit)",PSBOSTS="E":"Expired",PSBOSTS="O":"On Call",1:" * ERROR * "))=""
"RTN","PSBOMM",107,0)
 ..D:'PSBG!(PSBACRIT[$G(PSBXSTS,1))
"RTN","PSBOMM",108,0)
 ...S VAR=""
"RTN","PSBOMM",109,0)
 ...K ^TMP("PSJ2",$J),^TMP("PSB1",$J),PSBOACTL D EN^PSJBCMA2(DFN,PSBONX,1) I ^TMP("PSJ2",$J,0)'=1 D
"RTN","PSBOMM",110,0)
 ....M PSBOACTL=^TMP("PSJ2",$J)
"RTN","PSBOMM",111,0)
 ....D UDONE^PSBOMM2
"RTN","PSBOMM",112,0)
 ....I PSBFLAG=1 S VAR="(On Hold) "_$$DTFMT^PSBOMM2(PSBHDDT)
"RTN","PSBOMM",113,0)
 ....I PSBFLAG=2 S VAR="(On Hold) "_$$DTFMT^PSBOMM2(PSBHDDT)_"  (Off Hold) "_$$DTFMT^PSBOMM2(PSBUNHD)
"RTN","PSBOMM",114,0)
 ...I '$G(PSBEXST,0)!(PSBXSTS="M") S $P(^TMP("PSB",$J,DFN,"*** ONE-TIME ***",PSBOITX,PSBONX),U,1,4)=VAR
"RTN","PSBOMM",115,0)
 ...I $G(PSBEXST,0) D
"RTN","PSBOMM",116,0)
 ....S VAR1=$G(^TMP("PSB",$J,DFN,"*** ONE-TIME ***","* "_PSBOITX,PSBONX)) I VAR1]"" S $P(VAR1,U,1,4)=VAR_VAR1
"RTN","PSBOMM",117,0)
 ...K PSBHDDT,PSBUNHD,^TMP("PSB1",$J),PSBCNT
"RTN","PSBOMM",118,0)
 K PSBOACTL
"RTN","PSBOMM",119,0)
 Q
"RTN","PSBOMM",120,0)
PRINT ;
"RTN","PSBOMM",121,0)
 N PSBHDR,PSBDT,PSBOITX,PSBONX,DFN,PSBVNI,PSBSORT,PSBSRCHL,PSBSRT
"RTN","PSBOMM",122,0)
 K PSBNPG
"RTN","PSBOMM",123,0)
 S PSBSRT=$P(PSBRPT(.1),U,1)                   ;init PSBSRT  ;*70
"RTN","PSBOMM",124,0)
 S Y=$S($P(PSBRPT(.1),U,8)]"":$P(PSBRPT(.1),U,8),1:$P(PSBRPT(.1),U,6))
"RTN","PSBOMM",125,0)
 S PSBHDR(1)="MISSED MEDICATIONS REPORT for "_$$FMTE^XLFDT($P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7))_" to "_$$FMTE^XLFDT(Y+$P(PSBRPT(.1),U,9))
"RTN","PSBOMM",126,0)
 S PSBHDR(2)="Order Status(es): --"
"RTN","PSBOMM",127,0)
 F Y=5,8,7 I $P(PSBFUTR,U,Y) S $P(PSBHDR(2),": ",2)=$P(PSBHDR(2),": ",2)_$S(PSBHDR(2)["--":"",1:"/ ")_$P("^^^^Active^^Expired^DC'd^^^^^^^^^^",U,Y)_" " S PSBHDR(2)=$TR(PSBHDR(2),"-","")
"RTN","PSBOMM",128,0)
 S PSBHDR(3)="Admin Status(es): --"
"RTN","PSBOMM",129,0)
 F Y=16,17,18 I $P(PSBFUTR,U,Y) S $P(PSBHDR(3),": ",2)=$P(PSBHDR(3),": ",2)_$S(PSBHDR(3)["--":"",1:"/ ")_$P("^^^^^^^^^^^^^^^Missing Dose^Held^Refused",U,Y)_" " S PSBHDR(3)=$TR(PSBHDR(3),"-","")
"RTN","PSBOMM",130,0)
 I PSBINCC S PSBHDR(4)="Include Comments/Reasons"
"RTN","PSBOMM",131,0)
 ;check Clinic or Nurs Unit search list                *70
"RTN","PSBOMM",132,0)
 S PSBSRCHL=$$SRCHLIST^PSBOHDR()
"RTN","PSBOMM",133,0)
 D:PSBSRCHL]""
"RTN","PSBOMM",134,0)
 .S PSBHDR(5)=""
"RTN","PSBOMM",135,0)
 .S:$P(PSBRPT(4),U,2)="C" PSBHDR(6)="Clinic Search List: "
"RTN","PSBOMM",136,0)
 .S:$P(PSBRPT(4),U,2)="I" PSBHDR(6)="Ward Location: "
"RTN","PSBOMM",137,0)
 ;
"RTN","PSBOMM",138,0)
 ;* * *  Print by Patient  * * *
"RTN","PSBOMM",139,0)
 D:PSBSRT="P"
"RTN","PSBOMM",140,0)
 .S DFN=$P(PSBRPT(.1),U,2)
"RTN","PSBOMM",141,0)
 .;
"RTN","PSBOMM",142,0)
 .W $$PTHDR()
"RTN","PSBOMM",143,0)
 .I $G(PSBEDIT) W !?7,"*Administration Times have been edited*"
"RTN","PSBOMM",144,0)
 .I $O(^TMP("PSB",$J,DFN,""))="" W !,"No Missed Medications Found",$$PTFTR^PSBOHDR() Q
"RTN","PSBOMM",145,0)
 .S PSBDT=""
"RTN","PSBOMM",146,0)
 .F  S PSBDT=$O(^TMP("PSB",$J,DFN,PSBDT)) Q:PSBDT=""  D
"RTN","PSBOMM",147,0)
 ..W !
"RTN","PSBOMM",148,0)
 ..S PSBOITX=""
"RTN","PSBOMM",149,0)
 ..F  S PSBOITX=$O(^TMP("PSB",$J,DFN,PSBDT,PSBOITX)) Q:PSBOITX=""  D
"RTN","PSBOMM",150,0)
 ...S PSBONX=""
"RTN","PSBOMM",151,0)
 ...F  S PSBONX=$O(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)) Q:PSBONX=""  D
"RTN","PSBOMM",152,0)
 ....;if previously held/refused lines printed, need line feed *58
"RTN","PSBOMM",153,0)
 ....I ($G(VAR1)]"")!($G(VAR2)]"")!($G(VAR3)]"") W !
"RTN","PSBOMM",154,0)
 ....K VAR1,VAR2,VAR3,SP I $Y>(IOSL-9) W $$PTFTR^PSBOHDR(),$$PTHDR()
"RTN","PSBOMM",155,0)
 ....S VAR1=$G(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX))
"RTN","PSBOMM",156,0)
 ....S VAR2=$G(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX,"X"))
"RTN","PSBOMM",157,0)
 ....S VAR3=$G(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX,.3))
"RTN","PSBOMM",158,0)
 ....D PSJ1^PSBVT(DFN,PSBONX) S PSBVNI=$S(PSBVNI]"":PSBVNI,1:"***")
"RTN","PSBOMM",159,0)
 ....I PSBDT["ONE-TIME" D  Q
"RTN","PSBOMM",160,0)
 .....W !
"RTN","PSBOMM",161,0)
 .....W !,$O(PSBS(DFN,PSBONX,"")),?15,PSBVNI,?21,PSBDT,?38,PSBOITX,?103,PSBCLORD,!                       ;*70
"RTN","PSBOMM",162,0)
 .....I VAR1]"" W ?41,VAR1 S SP=1
"RTN","PSBOMM",163,0)
 .....I VAR2]"" W:$G(SP) ! W ?41,VAR2
"RTN","PSBOMM",164,0)
 .....I VAR3]"" W !,$$WRAP^PSBO(41,79,VAR3)
"RTN","PSBOMM",165,0)
 .....W !?3,"Start Date/Time:  ",?22,$O(PSBSTXT(PSBONX,DFN,"")) ;DFN added to PSBSTXT array in PSB*3*52
"RTN","PSBOMM",166,0)
 .....W !?3,"Stop Date/Time:  ",?22,$O(PSBSTXP(PSBONX,DFN,"")) ;DFN added to PSBSTXP array in PSB*3*52
"RTN","PSBOMM",167,0)
 ....W !,$O(PSBS(DFN,PSBONX,"")),?15,PSBVNI,?21,$S(+PSBDT>0:$$DTFMT^PSBOMM2(PSBDT),1:PSBDT),?38,PSBOITX,?85,$O(PSBSTXP(PSBONX,DFN,"")) ;DFN added to PSBSTXP array in PSB*3*52
"RTN","PSBOMM",168,0)
 ....W ?103,PSBCLORD,!                     ;*70 clinic name
"RTN","PSBOMM",169,0)
 ....I VAR1]"" W ?41,VAR1 S SP=1
"RTN","PSBOMM",170,0)
 ....I VAR2]"" W:$G(SP) ! W ?41,VAR2
"RTN","PSBOMM",171,0)
 ....I VAR3]"" W !,$$WRAP^PSBO(41,79,VAR3)
"RTN","PSBOMM",172,0)
 .W $$PTFTR^PSBOHDR()
"RTN","PSBOMM",173,0)
 .Q
"RTN","PSBOMM",174,0)
 ;
"RTN","PSBOMM",175,0)
 ;* * *  Print by Ward  * * *
"RTN","PSBOMM",176,0)
 D:PSBSRT="W"
"RTN","PSBOMM",177,0)
 .S PSBWARD=$P(PSBRPT(.1),U,3)
"RTN","PSBOMM",178,0)
 .W $$WRDHDR()
"RTN","PSBOMM",179,0)
 .I '$O(^TMP("PSB",$J,0)) W !,"No Missed Medications Found" Q
"RTN","PSBOMM",180,0)
 .S PSBSORT=$P(PSBRPT(.1),U,5)
"RTN","PSBOMM",181,0)
 .F DFN=0:0 S DFN=$O(^TMP("PSB",$J,DFN)) Q:'DFN  D
"RTN","PSBOMM",182,0)
 ..S PSBDX=$S(PSBSORT="P":$P(^DPT(DFN,0),U),1:$G(^DPT(DFN,.1))_" "_$G(^(.101)))
"RTN","PSBOMM",183,0)
 ..S:PSBDX="" PSBDX=$P(^DPT(DFN,0),U)
"RTN","PSBOMM",184,0)
 ..S ^TMP("PSB",$J,"B",PSBDX,DFN)=""
"RTN","PSBOMM",185,0)
 .S PSBDX=""
"RTN","PSBOMM",186,0)
 .F  S PSBDX=$O(^TMP("PSB",$J,"B",PSBDX)) Q:PSBDX=""  D
"RTN","PSBOMM",187,0)
 ..F DFN=0:0 S DFN=$O(^TMP("PSB",$J,"B",PSBDX,DFN)) Q:'DFN  D
"RTN","PSBOMM",188,0)
 ...W !
"RTN","PSBOMM",189,0)
 ...S PSBDT=""
"RTN","PSBOMM",190,0)
 ...F  S PSBDT=$O(^TMP("PSB",$J,DFN,PSBDT)) Q:PSBDT=""  D
"RTN","PSBOMM",191,0)
 ....W !
"RTN","PSBOMM",192,0)
 ....K VAR1,VAR2,VAR3    ;reset held/refused to prevent line feed
"RTN","PSBOMM",193,0)
 ....W:PSBDT["ONE-TIME" !
"RTN","PSBOMM",194,0)
 ....S PSBOITX=""
"RTN","PSBOMM",195,0)
 ....F  S PSBOITX=$O(^TMP("PSB",$J,DFN,PSBDT,PSBOITX)) Q:PSBOITX=""  D
"RTN","PSBOMM",196,0)
 .....S PSBONX=""
"RTN","PSBOMM",197,0)
 .....F  S PSBONX=$O(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)) Q:PSBONX=""  D
"RTN","PSBOMM",198,0)
 ......;if previously held/refused lines printed, need line feed *58
"RTN","PSBOMM",199,0)
 ......I ($G(VAR1)]"")!($G(VAR2)]"")!($G(VAR3)]"") W !
"RTN","PSBOMM",200,0)
 ......K VAR1,VAR2,VAR3,SP I $Y>(IOSL-9) W $$WRDHDR()
"RTN","PSBOMM",201,0)
 ......D PSJ1^PSBVT(DFN,PSBONX)
"RTN","PSBOMM",202,0)
 ......S PSBVNI=$S(PSBVNI]"":PSBVNI,1:"***")
"RTN","PSBOMM",203,0)
 ......W !,$O(PSBS(DFN,PSBONX,"")),?15,PSBVNI,?22,$G(^DPT(DFN,.101),"**"),?42,$P(^DPT(DFN,0),U)," (",$E($P(^(0),U,9),6,9),")"
"RTN","PSBOMM",204,0)
 ......S VAR1=$G(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX))
"RTN","PSBOMM",205,0)
 ......S VAR2=$G(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX,"X"))
"RTN","PSBOMM",206,0)
 ......S VAR3=$G(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX,.3))
"RTN","PSBOMM",207,0)
 ......I PSBDT["ONE-TIME" D  Q
"RTN","PSBOMM",208,0)
 .......W !,PSBDT,?37,PSBOITX S SP=1
"RTN","PSBOMM",209,0)
 .......I VAR1]"" W !,?37,$P(VAR1,U,1) S SP=1
"RTN","PSBOMM",210,0)
 .......I VAR2]"" W:$G(SP) ! W ?37,VAR2
"RTN","PSBOMM",211,0)
 .......I VAR3]"" W !,$$WRAP^PSBO(37,102,VAR3)
"RTN","PSBOMM",212,0)
 .......W !?3,"Start Date/Time:  ",?21,$O(PSBSTXT(PSBONX,DFN,"")) ;DFN added to PSBSTXT array in PSB*3*52
"RTN","PSBOMM",213,0)
 .......W !?3,"Stop Date/Time:  ",?21,$O(PSBSTXP(PSBONX,DFN,"")) ;DFN added to PSBSTXP array in PSB*3*52
"RTN","PSBOMM",214,0)
 .......W !
"RTN","PSBOMM",215,0)
 ......W ?74,$S(+PSBDT>0:$$DTFMT^PSBOMM2(PSBDT),1:PSBDT),?92,PSBOITX S SP=1
"RTN","PSBOMM",216,0)
 ......I VAR1]"" W !,?57,VAR1 S SP=1
"RTN","PSBOMM",217,0)
 ......I VAR2]"" W:$G(SP) ! W ?57,VAR2
"RTN","PSBOMM",218,0)
 ......I VAR3]"" W !,$$WRAP^PSBO(57,82,VAR3)
"RTN","PSBOMM",219,0)
 ;
"RTN","PSBOMM",220,0)
 ;* * *  Print by Clinic  * * *
"RTN","PSBOMM",221,0)
 D:PSBSRT="C"
"RTN","PSBOMM",222,0)
 .W $$CLNHDR()
"RTN","PSBOMM",223,0)
 .I '$O(^TMP("PSB",$J,0)) W !,"No Missed Medications Found" Q
"RTN","PSBOMM",224,0)
 .S PSBSORT=$P(PSBRPT(.1),U,5)
"RTN","PSBOMM",225,0)
 .F DFN=0:0 S DFN=$O(^TMP("PSB",$J,DFN)) Q:'DFN  D
"RTN","PSBOMM",226,0)
 ..S PSBDX=$S(PSBSORT="P":$P(^DPT(DFN,0),U),1:$G(^DPT(DFN,.1))_" "_$G(^(.101)))
"RTN","PSBOMM",227,0)
 ..S:PSBDX="" PSBDX=$P(^DPT(DFN,0),U)
"RTN","PSBOMM",228,0)
 ..S ^TMP("PSB",$J,"B",PSBDX,DFN)=""
"RTN","PSBOMM",229,0)
 .S PSBDX=""
"RTN","PSBOMM",230,0)
 .F  S PSBDX=$O(^TMP("PSB",$J,"B",PSBDX)) Q:PSBDX=""  D
"RTN","PSBOMM",231,0)
 ..F DFN=0:0 S DFN=$O(^TMP("PSB",$J,"B",PSBDX,DFN)) Q:'DFN  D
"RTN","PSBOMM",232,0)
 ...W !
"RTN","PSBOMM",233,0)
 ...S PSBDT=""
"RTN","PSBOMM",234,0)
 ...F  S PSBDT=$O(^TMP("PSB",$J,DFN,PSBDT)) Q:PSBDT=""  D
"RTN","PSBOMM",235,0)
 ....W !
"RTN","PSBOMM",236,0)
 ....K VAR1,VAR2,VAR3    ;reset held/refused to prevent line feed
"RTN","PSBOMM",237,0)
 ....W:PSBDT["ONE-TIME" !
"RTN","PSBOMM",238,0)
 ....S PSBOITX=""
"RTN","PSBOMM",239,0)
 ....F  S PSBOITX=$O(^TMP("PSB",$J,DFN,PSBDT,PSBOITX)) Q:PSBOITX=""  D
"RTN","PSBOMM",240,0)
 .....S PSBONX=""
"RTN","PSBOMM",241,0)
 .....F  S PSBONX=$O(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)) Q:PSBONX=""  D
"RTN","PSBOMM",242,0)
 ......;if previously held/refused lines printed, need line feed *58
"RTN","PSBOMM",243,0)
 ......I ($G(VAR1)]"")!($G(VAR2)]"")!($G(VAR3)]"") W !
"RTN","PSBOMM",244,0)
 ......K VAR1,VAR2,VAR3,SP I $Y>(IOSL-9) W $$CLNHDR()
"RTN","PSBOMM",245,0)
 ......D PSJ1^PSBVT(DFN,PSBONX)
"RTN","PSBOMM",246,0)
 ......S PSBVNI=$S(PSBVNI]"":PSBVNI,1:"***")
"RTN","PSBOMM",247,0)
 ......W !,$O(PSBS(DFN,PSBONX,"")),?11,PSBVNI,?17,$P(^DPT(DFN,0),U)
"RTN","PSBOMM",248,0)
 ......S VAR1=$G(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX))
"RTN","PSBOMM",249,0)
 ......S VAR2=$G(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX,"X"))
"RTN","PSBOMM",250,0)
 ......S VAR3=$G(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX,.3))
"RTN","PSBOMM",251,0)
 ......I PSBDT["ONE-TIME" D  Q
"RTN","PSBOMM",252,0)
 .......W !,PSBDT,?37,PSBOITX S SP=1
"RTN","PSBOMM",253,0)
 .......I VAR1]"" W !,?37,$P(VAR1,U,1) S SP=1
"RTN","PSBOMM",254,0)
 .......I VAR2]"" W:$G(SP) ! W ?37,VAR2
"RTN","PSBOMM",255,0)
 .......I VAR3]"" W !,$$WRAP^PSBO(37,102,VAR3)
"RTN","PSBOMM",256,0)
 .......W !?3,"Start Date/Time:  ",?21,$O(PSBSTXT(PSBONX,DFN,"")) ;DFN added to PSBSTXT array in PSB*3*52
"RTN","PSBOMM",257,0)
 .......W !?3,"Stop Date/Time:  ",?21,$O(PSBSTXP(PSBONX,DFN,"")) ;DFN added to PSBSTXP array in PSB*3*52
"RTN","PSBOMM",258,0)
 .......W !
"RTN","PSBOMM",259,0)
 ......;detail line
"RTN","PSBOMM",260,0)
 ......W ?49,$S(+PSBDT>0:$$DTFMT^PSBOMM2(PSBDT),1:PSBDT),?66,PSBOITX
"RTN","PSBOMM",261,0)
 ......W:PSBCLINORD ?103,PSBCLORD
"RTN","PSBOMM",262,0)
 ......S SP=1
"RTN","PSBOMM",263,0)
 ......I VAR1]"" W !,?57,VAR1 S SP=1
"RTN","PSBOMM",264,0)
 ......I VAR2]"" W:$G(SP) ! W ?57,VAR2
"RTN","PSBOMM",265,0)
 ......I VAR3]"" W !,$$WRAP^PSBO(57,82,VAR3)
"RTN","PSBOMM",266,0)
 Q
"RTN","PSBOMM",267,0)
WRDHDR() ;
"RTN","PSBOMM",268,0)
 D WARD^PSBOHDR(PSBWRD,.PSBHDR,,,PSBSRCHL)
"RTN","PSBOMM",269,0)
 W !,"Order Status",?15,"Ver",?22,"Room-Bed",?42,"Patient",?74,"Admin Date/Time",?92,"Medication"
"RTN","PSBOMM",270,0)
 D LN1^PSBOMM2
"RTN","PSBOMM",271,0)
 Q ""
"RTN","PSBOMM",272,0)
CLNHDR() ;
"RTN","PSBOMM",273,0)
 D CLINIC^PSBOHDR(.PSBRPT,.PSBHDR,,,PSBSRCHL)
"RTN","PSBOMM",274,0)
 W !,"Order Sts",?11,"Ver",?17,"Patient",?49,"Admin Date/Time",?66,"Medication",?103,"Location"
"RTN","PSBOMM",275,0)
 D LN1^PSBOMM2
"RTN","PSBOMM",276,0)
 Q ""
"RTN","PSBOMM",277,0)
PTHDR() ;
"RTN","PSBOMM",278,0)
 D PT^PSBOHDR(DFN,.PSBHDR,,,PSBSRCHL)
"RTN","PSBOMM",279,0)
 W !,"Order Status",?15,"Ver",?21,"Admin Date/Time",?38,"Medication",?85,"Order Stop Date"
"RTN","PSBOMM",280,0)
 W:PSBCLINORD ?103,"Location"
"RTN","PSBOMM",281,0)
 D LN1^PSBOMM2
"RTN","PSBOMM",282,0)
 Q ""
"RTN","PSBOMT")
0^22^B91036821^B88222978
"RTN","PSBOMT",1,0)
PSBOMT ;BIRMINGHAM/TEJ-BCMA MEDICATION THERAPY REPORT ;8/12/12 9:56pm
"RTN","PSBOMT",2,0)
 ;;3.0;BAR CODE MED ADMIN;**32,50,70**;Mar 2004;Build 101
"RTN","PSBOMT",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOMT",4,0)
 ;
"RTN","PSBOMT",5,0)
 ; Reference/IA
"RTN","PSBOMT",6,0)
 ; File 50.7/2880
"RTN","PSBOMT",7,0)
 ; File 52.6/436
"RTN","PSBOMT",8,0)
 ; File 52.7/437
"RTN","PSBOMT",9,0)
 ; File 200/10060
"RTN","PSBOMT",10,0)
 ; EN^PSJBCMA1/2829
"RTN","PSBOMT",11,0)
 ; IEN^PSN50P65/4543
"RTN","PSBOMT",12,0)
 ; DRGIEN^PSS50P7/4662
"RTN","PSBOMT",13,0)
 ; VAC^PSS50/4533
"RTN","PSBOMT",14,0)
 ; ^PSDRUG(/221 
"RTN","PSBOMT",15,0)
 ;
"RTN","PSBOMT",16,0)
 ;*70 - reset PSBCLINORD = 2 to signify combined orders report
"RTN","PSBOMT",17,0)
 ;
"RTN","PSBOMT",18,0)
EN ;
"RTN","PSBOMT",19,0)
 N PSBHDR,PSBORDS,PSBORD,PSBOIP
"RTN","PSBOMT",20,0)
 N TMP
"RTN","PSBOMT",21,0)
 K TMP("PSBOIS",$J),TMP("VA CLASS",$J),TMP("PSBADDS",$J),TMP("PSBSOLS",$J),PSBLGD,PSBOIL,PSBDDL,PSBSOLL,PSBADDL
"RTN","PSBOMT",22,0)
 S PSBCLSS=0,PSBCFLG=0
"RTN","PSBOMT",23,0)
 S PSBXDFN=$P(PSBRPT(.1),U,2)
"RTN","PSBOMT",24,0)
 S PSBSTRT=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7),PSBSTOP=$P(PSBRPT(.1),U,8)+$P(PSBRPT(.1),U,9)
"RTN","PSBOMT",25,0)
 K PSBOCRIT F Y=1:1:4 I $P(PSBRPT(.2),U,Y) S PSBOCRIT=$G(PSBOCRIT,"")_$P("C^P^OC^O",U,Y)_"^"
"RTN","PSBOMT",26,0)
 D NOW^%DTC S (Y,PSBNOWX)=% D DD^%DT S PSBDTTM=$E(Y,1,18)
"RTN","PSBOMT",27,0)
 S:+PSBSTRT'>0 PSBSTRT=$$FMADD^XLFDT(X,-1)
"RTN","PSBOMT",28,0)
 S:+PSBSTOP'>0 PSBSTOP=$P(%,".")
"RTN","PSBOMT",29,0)
 I $D(PSBRPT(.2)) I $P(PSBRPT(.2),U,8) S PSBCFLG=1
"RTN","PSBOMT",30,0)
 I $D(PSBRPT(2)) F XD=$O(PSBRPT(2,0)):1:$O(PSBRPT(2,"B"),-1) S PSBRPT(2,XD,0)=$TR(PSBRPT(2,XD,0),"~",U) D:$P(PSBRPT(2,XD,0),U)="MT"
"RTN","PSBOMT",31,0)
 .I $P(PSBRPT(2,XD,0),U,2)="OIT" D  Q
"RTN","PSBOMT",32,0)
 ..S PSBSRCHL="ORDERABLE ITEM SEARCH LIST:",PSBOIL(+$P(PSBRPT(2,XD,0),U,3))=""
"RTN","PSBOMT",33,0)
 ..S PSB=$P(PSBRPT(2,XD,0),U,3) F X=1:1:$L(PSB,",") Q:$P(PSB,",",X)=""  S (TMP("PSBOIS",$J,$P(PSB,",",X)),PSBOIP("OIP",$P(PSB,",",X)))=""
"RTN","PSBOMT",34,0)
 .I $P(PSBRPT(2,XD,0),U,2)="ADD" D  Q
"RTN","PSBOMT",35,0)
 ..S PSBSRCHL="IV MEDICATION SEARCH LIST:"
"RTN","PSBOMT",36,0)
 ..I $D(^PSDRUG("A526",$P(PSBRPT(2,XD,0),U,3))) S X2=$O(^PSDRUG("A526",$P(PSBRPT(2,XD,0),U,3),"")) S PSBADDL(X2)="",TMP("PSBOIS",$J,$$OFROMA(X2))=""
"RTN","PSBOMT",37,0)
 .I $P(PSBRPT(2,XD,0),U,2)="SOL" D  Q
"RTN","PSBOMT",38,0)
 ..S PSBSRCHL="IV MEDICATION SEARCH LIST:"
"RTN","PSBOMT",39,0)
 ..I $D(^PSDRUG("A527",$P(PSBRPT(2,XD,0),U,3))) S X2=$O(^PSDRUG("A527",$P(PSBRPT(2,XD,0),U,3),"")) S PSBSOLL(X2)="",TMP("PSBOIS",$J,$$OFROMS(X2))=""
"RTN","PSBOMT",40,0)
 .I $P(PSBRPT(2,XD,0),U,2)="DD" D  K PSBDRGS Q
"RTN","PSBOMT",41,0)
 ..S PSBSRCHL="DISPENSED DRUG SEARCH LIST:",PSBDDL($P(PSBRPT(2,XD,0),U,3))=""
"RTN","PSBOMT",42,0)
 ..K PSBDRGS S PSBDRGS="" D OILST^PSBRPCMO(.PSBDRGS,$P(PSBRPT(2,XD,0),U,3),"UD")
"RTN","PSBOMT",43,0)
 ..F X2=PSBDRGS(0):1:$O(PSBDRGS(""),-1) I +PSBDRGS(1)'<0 S TMP("PSBOIS",$J,$P(PSBDRGS(X2),U,4))=""
"RTN","PSBOMT",44,0)
 .I $P(PSBRPT(2,XD,0),U,2)="VAC" D
"RTN","PSBOMT",45,0)
 ..S PSBSRCHL="VA DRUG CLASS SEARCH LIST:"
"RTN","PSBOMT",46,0)
 ..S PSBCLS=$P(PSBRPT(2,XD,0),U,3) D GETCLSS(PSBCLS) K PSBDDRG("VAC") M TMP("VA CLASS",$J,PSBCLS,"DDRG")=PSBDDRG K PSBDDRG
"RTN","PSBOMT",47,0)
 ..S PSBCLSS=1
"RTN","PSBOMT",48,0)
 M PSBOIP("OIP")=TMP("PSBOIS",$J)
"RTN","PSBOMT",49,0)
 D OUT(PSBXDFN,PSBSTRT,PSBSTOP)
"RTN","PSBOMT",50,0)
 Q
"RTN","PSBOMT",51,0)
OUT(PSBXDFN,PSBSTRT,PSBSTOP) ;
"RTN","PSBOMT",52,0)
 D:PSBCLSS GETOIS  ; POSSBLE CLASS ITEMS VIA AVAIL ORDERS
"RTN","PSBOMT",53,0)
 D GETADSO^PSBOMT1 ; ALL ADDS AND SOLS
"RTN","PSBOMT",54,0)
 D FINDIENS^PSBOMT1 ; FIND ALL MED LOG ENTRS
"RTN","PSBOMT",55,0)
 D PREOUT ;   WRIT TO GLOBL
"RTN","PSBOMT",56,0)
 D WRITEOT
"RTN","PSBOMT",57,0)
 D CLEANSUM^PSBOMT1
"RTN","PSBOMT",58,0)
 D CLEANALL^PSBOMT1
"RTN","PSBOMT",59,0)
 Q
"RTN","PSBOMT",60,0)
GETOIS ;
"RTN","PSBOMT",61,0)
 K ^TMP("PSJ",$J),PSBTMP
"RTN","PSBOMT",62,0)
 D EN^PSJBCMA(PSBXDFN,PSBSTRT)
"RTN","PSBOMT",63,0)
 Q:^TMP("PSJ",$J,1,0)<0
"RTN","PSBOMT",64,0)
 M PSBTMP=^TMP("PSJ",$J) K ^TMP("PSJ",$J)
"RTN","PSBOMT",65,0)
 S X=0 F  S X=$O(PSBTMP(X)) Q:+X=0  D
"RTN","PSBOMT",66,0)
 .Q:$G(PSBOCRIT,"")'[$P(PSBTMP(X,1),U,2)_"^"
"RTN","PSBOMT",67,0)
 .S PSBORDN=$P(PSBTMP(X,0),U,3) S PSBORDS(PSBORDN)=""
"RTN","PSBOMT",68,0)
 .I $D(PSBTMP(X,700)) D  Q
"RTN","PSBOMT",69,0)
 ..F XX=1:1:PSBTMP(X,700,0) D
"RTN","PSBOMT",70,0)
 ...S PSBCLS="" F  S PSBCLS=$O(TMP("VA CLASS",$J,PSBCLS)) Q:+PSBCLS=0  D
"RTN","PSBOMT",71,0)
 ....I '$D(TMP("VA CLASS",$J,PSBCLS,"DDRG",$P(PSBTMP(X,700,XX,0),U))) Q
"RTN","PSBOMT",72,0)
 ....S PSBORDS(PSBORDN,"DD",$P(PSBTMP(X,700,XX,0),U))=""
"RTN","PSBOMT",73,0)
 ....S PSBORDS(PSBORDN,"OIP",$P(PSBTMP(X,3),U))=""
"RTN","PSBOMT",74,0)
 ..M PSBOIP("OIP")=PSBORDS(PSBORDN,"OIP")
"RTN","PSBOMT",75,0)
 .I $D(PSBTMP(X,850)) M PSBORDS(PSBORDN,"ADD")=PSBTMP(X,850) D
"RTN","PSBOMT",76,0)
 ..F XX=1:1:PSBORDS(PSBORDN,"ADD",0) S PSBORDS(PSBORDN,"OIP",$$OFROMA($P(PSBORDS(PSBORDN,"ADD",XX,0),U)))=""
"RTN","PSBOMT",77,0)
 ..M PSBOIP("OIP")=PSBORDS(PSBORDN,"OIP")
"RTN","PSBOMT",78,0)
 .I $D(PSBTMP(X,950)) M PSBORDS(PSBORDN,"SOL")=PSBTMP(X,950) D
"RTN","PSBOMT",79,0)
 ..F XX=1:1:PSBORDS(PSBORDN,"SOL",0) S PSBORDS(PSBORDN,"OIP",$$OFROMS($P(PSBORDS(PSBORDN,"SOL",XX,0),U)))=""
"RTN","PSBOMT",80,0)
 ..M PSBOIP("OIP")=PSBORDS(PSBORDN,"OIP")
"RTN","PSBOMT",81,0)
 K PSBTMP
"RTN","PSBOMT",82,0)
 M TMP("PSBOIS",$J)=PSBOIP("OIP")
"RTN","PSBOMT",83,0)
 Q
"RTN","PSBOMT",84,0)
OFROMA(PSBADD) ;OITEM FROM AN ADDITIVE
"RTN","PSBOMT",85,0)
 S X1=$$GET1^DIQ(52.6,PSBADD_",",15,"I")
"RTN","PSBOMT",86,0)
 I PSBCLSS D
"RTN","PSBOMT",87,0)
 .S X2=$$GETDRN(X1)
"RTN","PSBOMT",88,0)
 .S PSBCLS="" K X3 F  Q:$D(X3)  S PSBCLS=$O(TMP("VA CLASS",$J,PSBCLS)) Q:+PSBCLS=0  D
"RTN","PSBOMT",89,0)
 ..I $D(TMP("VA CLASS",$J,PSBCLS,"DDRG",X2)) S X3=X1
"RTN","PSBOMT",90,0)
 .I '$D(X3) S X3=0
"RTN","PSBOMT",91,0)
 Q $G(X3,X1)
"RTN","PSBOMT",92,0)
OFROMS(PSBSOL) ;OITEM FROM A SOLUTION
"RTN","PSBOMT",93,0)
 S X1=$$GET1^DIQ(52.7,PSBSOL_",",9,"I")
"RTN","PSBOMT",94,0)
 I PSBCLSS D
"RTN","PSBOMT",95,0)
 .S X2=$$GETDRN(X1)
"RTN","PSBOMT",96,0)
 .S PSBCLS="" K X3 F  Q:$D(X3)  S PSBCLS=$O(TMP("VA CLASS",$J,PSBCLS)) Q:+PSBCLS=0  D
"RTN","PSBOMT",97,0)
 ..I $D(TMP("VA CLASS",$J,PSBCLS,"DDRG",X2)) S X3=X1
"RTN","PSBOMT",98,0)
 .I '$D(X3) S X3=0
"RTN","PSBOMT",99,0)
 Q $G(X3,X1)
"RTN","PSBOMT",100,0)
PREOUT ;
"RTN","PSBOMT",101,0)
 K PSBUNK S XDT="" F  S XDT=$O(TMP("PSBIENS",$J,XDT),-1) Q:XDT=""  S XIEN="",XIEN=$O(TMP("PSBIENS",$J,XDT,XIEN)) D
"RTN","PSBOMT",102,0)
 .Q:$$NONSTS(PSBXDFN,XIEN)
"RTN","PSBOMT",103,0)
 .S PSBIEN=XIEN
"RTN","PSBOMT",104,0)
 .S PSBIENS=PSBIEN_","
"RTN","PSBOMT",105,0)
 .D OUTPUT
"RTN","PSBOMT",106,0)
 Q
"RTN","PSBOMT",107,0)
OUTPUT ;
"RTN","PSBOMT",108,0)
 S PSBSPC=$J("",80)
"RTN","PSBOMT",109,0)
 S W=$E($$GET1^DIQ(53.79,PSBIENS,.02)_PSBSPC,1,20)_" "
"RTN","PSBOMT",110,0)
 S W=W_$S($P(^PSB(53.79,PSBIEN,0),U,9)="":"?? ",1:$E($P(^PSB(53.79,PSBIEN,0),U,9)_"  ",1,2)_" ")
"RTN","PSBOMT",111,0)
 S:$P(^PSB(53.79,PSBIEN,0),U,9)="" PSBUNK=1
"RTN","PSBOMT",112,0)
 S W=W_$E($P($G(^PSB(53.79,PSBIEN,.1)),U,2)_PSBSPC,1,2)_"  "
"RTN","PSBOMT",113,0)
 S W=W_$E($E($$GET1^DIQ(53.79,PSBIENS,.06),1,18)_PSBSPC,1,21)_" "
"RTN","PSBOMT",114,0)
 S W=W_$E($$GET1^DIQ(53.79,PSBIENS,"ACTION BY:INITIAL")_PSBSPC,1,10)_" ",PSBLGD("INITIALS",$$GET1^DIQ(53.79,PSBIENS,"ACTION BY","I"))=""
"RTN","PSBOMT",115,0)
 S W=W_$$GET1^DIQ(53.79,PSBIENS,.16)
"RTN","PSBOMT",116,0)
 D ADD(W)
"RTN","PSBOMT",117,0)
 K PSBV
"RTN","PSBOMT",118,0)
 F PSBNODE=.5,.6,.7 D
"RTN","PSBOMT",119,0)
 .S PSBDD=$S(PSBNODE=.5:53.795,PSBNODE=.6:53.796,1:53.797)
"RTN","PSBOMT",120,0)
 .F PSBY=0:0 S PSBY=$O(^PSB(53.79,PSBIEN,PSBNODE,PSBY)) Q:'PSBY  D
"RTN","PSBOMT",121,0)
 ..I $$GET1^DIQ(53.79,PSBIENS,.11)["V" S PSBV=1
"RTN","PSBOMT",122,0)
 ..D WRAPMEDS($$GET1^DIQ(PSBDD,PSBY_","_PSBIENS,.01),$$GET1^DIQ(PSBDD,PSBY_","_PSBIENS,.03),$$GET1^DIQ(PSBDD,PSBY_","_PSBIENS,.02),$$GET1^DIQ(PSBDD,PSBY_","_PSBIENS,.04))
"RTN","PSBOMT",123,0)
 D PRNEFF
"RTN","PSBOMT",124,0)
 I PSBCFLG=1 D COMNTS
"RTN","PSBOMT",125,0)
 D ADD("")
"RTN","PSBOMT",126,0)
 Q
"RTN","PSBOMT",127,0)
PRNEFF ;Add PRN Effectiveness to Medication theropy Report  - PSB*3*50
"RTN","PSBOMT",128,0)
 N PSBPRN,PSBEIECMT,PSBLINE1,PSBLINE2
"RTN","PSBOMT",129,0)
 S PSBEIECMT=""
"RTN","PSBOMT",130,0)
 I $P($G(PSBRPT(.2)),U,8)=0,$D(^PSB(53.79,PSBIEN,.2)) S PSBEIECMT=$$PRNEFF^PSBO(PSBEIECMT,PSBIEN)
"RTN","PSBOMT",131,0)
 I $D(^PSB(53.79,PSBIEN,.2)) D
"RTN","PSBOMT",132,0)
 .D ADD("")
"RTN","PSBOMT",133,0)
 .D ADD($J("",35)_"PRN Effectiveness: "_$$MAKELINE^PSBOMT1("-",78))
"RTN","PSBOMT",134,0)
 .I $P(^PSB(53.79,PSBIEN,.2),U,2)'="" D
"RTN","PSBOMT",135,0)
 ..S PSBPRN=$P(^PSB(53.79,PSBIEN,.2),U,2)
"RTN","PSBOMT",136,0)
 .I $P(^PSB(53.79,PSBIEN,.2),U,2)="" S PSBPRN="<No PRN Effectiveness Entered>"
"RTN","PSBOMT",137,0)
 .S PSBLINE1=$E(PSBPRN_PSBEIECMT,1,75),PSBLINE2=$E(PSBPRN_PSBEIECMT,76,245) D WRAP(PSBLINE2,PSBLINE1,PSBIEN)
"RTN","PSBOMT",138,0)
 Q 
"RTN","PSBOMT",139,0)
COMNTS ;
"RTN","PSBOMT",140,0)
 N Z,CNT
"RTN","PSBOMT",141,0)
 S Z="",CNT=0
"RTN","PSBOMT",142,0)
 I $D(^PSB(53.79,PSBIEN,.3,0)) D
"RTN","PSBOMT",143,0)
 .D ADD("")
"RTN","PSBOMT",144,0)
 .D ADD($J("",44)_"Comments: "_$$MAKELINE^PSBOMT1("-",78))
"RTN","PSBOMT",145,0)
 .S XT="" F  S XT=$O(^PSB(53.79,PSBIEN,.3,XT)) Q:XT=""  I XT'=0  D
"RTN","PSBOMT",146,0)
 ..D:CNT=1 ADD("")
"RTN","PSBOMT",147,0)
 ..S Y=$P(^PSB(53.79,PSBIEN,.3,XT,0),"^",3) D DD^%DT S XBR=Y
"RTN","PSBOMT",148,0)
 ..S Z=XBR_"   "_$P(^VA(200,$P(^PSB(53.79,PSBIEN,.3,XT,0),"^",2),0),"^",2)
"RTN","PSBOMT",149,0)
 ..D WRAP($P(^PSB(53.79,PSBIEN,.3,XT,0),"^",1),Z,PSBIEN)
"RTN","PSBOMT",150,0)
 ..S CNT=1
"RTN","PSBOMT",151,0)
 .D ADD($J("",54)_$$MAKELINE^PSBOMT1("-",78))
"RTN","PSBOMT",152,0)
 Q
"RTN","PSBOMT",153,0)
WRAPMEDS(MED,UG,UO,UOA) ;
"RTN","PSBOMT",154,0)
 ;THIS WILL CREATE UPTO 3 LINES
"RTN","PSBOMT",155,0)
 S MED=$E(MED_$J("",40),1,40)
"RTN","PSBOMT",156,0)
 N UGWRAP,ORWRAP
"RTN","PSBOMT",157,0)
 S (CNTX,UOA1,UOA16,UOA31)=""
"RTN","PSBOMT",158,0)
 I +$G(UG)?1"."1.N S UG=0_+UG
"RTN","PSBOMT",159,0)
 I +$G(UO)?1"."1.N S UO=0_+UO
"RTN","PSBOMT",160,0)
 I $G(PSBV,0) S UO="NA"
"RTN","PSBOMT",161,0)
 F CNT=1:15:45  D
"RTN","PSBOMT",162,0)
 .D PARSE^PSBOMT1(UOA,CNT)
"RTN","PSBOMT",163,0)
 .S UGWRAP=$E(UG,CNT,(CNT+7)),UOWRAP=$E(UO,CNT,(CNT+7))
"RTN","PSBOMT",164,0)
 .I CNT=1 D ADD($J("",55)_MED_" "_$$PAD^PSBOMT1(UOWRAP,8)_" "_$$PAD^PSBOMT1(UGWRAP,8)_"  "_$$PAD^PSBOMT1(UOA1,15))
"RTN","PSBOMT",165,0)
 .I (CNT>1),($L(UGWRAP)>0!$L(@("UOA"_CNT))>0) D ADD($J("",94)_$$PAD^PSBOMT1(UOWRAP,8)_" "_$$PAD^PSBOMT1(UGWRAP,8)_"  "_$$PAD^PSBOMT1(@("UOA"_CNT),15))
"RTN","PSBOMT",166,0)
 Q
"RTN","PSBOMT",167,0)
HEADA ;
"RTN","PSBOMT",168,0)
 W !
"RTN","PSBOMT",169,0)
 W "Location",?21,"St Sch Administration Date",?50,"By",?61,"Injection Site",?96,"Units",?104,"Units",?113,"Units of"
"RTN","PSBOMT",170,0)
 W !,?55,"Medication & Dosage",?96,"Ordered",?104,"Given",?113,"Administration"
"RTN","PSBOMT",171,0)
 W !
"RTN","PSBOMT",172,0)
 W $$MAKELINE^PSBOMT1("-",132)
"RTN","PSBOMT",173,0)
 Q
"RTN","PSBOMT",174,0)
NONSTS(PSBX,PSBY) ;
"RTN","PSBOMT",175,0)
 D CLEAN^PSBVT,PSJ1^PSBVT(PSBX,$$GET1^DIQ(53.79,PSBY_",","ORDER REFERENCE NUMBER","I"))
"RTN","PSBOMT",176,0)
 Q PSBOCRIT'[PSBSCHT_"^"
"RTN","PSBOMT",177,0)
WRITEOT ;
"RTN","PSBOMT",178,0)
 D HDR^PSBOMT1
"RTN","PSBOMT",179,0)
 D MEDS
"RTN","PSBOMT",180,0)
 N PSBCLINORD S PSBCLINORD=2             ;2 = both order types   *70
"RTN","PSBOMT",181,0)
 D PT^PSBOHDR(PSBXDFN,.PSBHDR),HEADA
"RTN","PSBOMT",182,0)
 I '$D(TMP("PSBIENS",$J)) D ADD("<<<< NO HISTORY FOUND FOR THIS TIME FRAME >>>>")
"RTN","PSBOMT",183,0)
 S EX="" F  S EX=$O(^TMP("PSB",$J,EX)) Q:EX=""  D
"RTN","PSBOMT",184,0)
 .I $Y>(IOSL-5) D
"RTN","PSBOMT",185,0)
 ..W $$PTFTR^PSBOHDR()
"RTN","PSBOMT",186,0)
 ..D PT^PSBOHDR(PSBXDFN,.PSBHDR),HEADA
"RTN","PSBOMT",187,0)
 .W !,$G(^TMP("PSB",$J,EX))
"RTN","PSBOMT",188,0)
 D:$D(TMP("PSBIENS",$J)) LEGEND^PSBOMT1
"RTN","PSBOMT",189,0)
 D FTR^PSBOMT1
"RTN","PSBOMT",190,0)
 Q
"RTN","PSBOMT",191,0)
MEDS ;
"RTN","PSBOMT",192,0)
 N MED,XA,XB
"RTN","PSBOMT",193,0)
 S MED="",XB=$O(PSBHDR(""),-1)+1
"RTN","PSBOMT",194,0)
 S PSBHDR(XB)=PSBSRCHL
"RTN","PSBOMT",195,0)
 I PSBCLSS S XA=0 K PSBGOT F  S XA=$O(TMP("VA CLASS",$J,XA)) Q:+XA=0  D
"RTN","PSBOMT",196,0)
 .K ^TMP($J,"PSBLIST") D IEN^PSN50P65(XA,"??","PSBLIST")
"RTN","PSBOMT",197,0)
 .I ^TMP($J,"PSBLIST",0)>0 S MED=^TMP($J,"PSBLIST",XA,1) Q:$D(PSBGOT(MED))  K ^TMP($J,"PSBLIST")
"RTN","PSBOMT",198,0)
 .I $L(PSBHDR(XB)_" "_$G(MED," * NO DATA FOUND * "))+3>IOM D  Q
"RTN","PSBOMT",199,0)
 ..S XB=XB+1,PSBHDR(XB)="                         / "_MED S PSBGOT(MED)=""
"RTN","PSBOMT",200,0)
 .S PSBHDR(XB)=PSBHDR(XB)_$S(($L(PSBHDR(XB),":")=2)&($P(PSBHDR(XB),":",2)=""):" ",1:" / ")_MED,PSBGOT(MED)=""
"RTN","PSBOMT",201,0)
 I $D(PSBOIL) S XA="" K PSBGOT F  S XA=$O(PSBOIL(XA)) Q:XA=""  D
"RTN","PSBOMT",202,0)
 .S MED=$$GET1^DIQ(50.7,XA,.01) Q:$D(PSBGOT(MED))  S PSBGOT(MED)=""
"RTN","PSBOMT",203,0)
 .I $L(PSBHDR(XB)_" / "_MED)+3>IOM D  Q
"RTN","PSBOMT",204,0)
 ..S XB=XB+1,PSBHDR(XB)="                         / "_MED
"RTN","PSBOMT",205,0)
 .S PSBHDR(XB)=PSBHDR(XB)_$S(($L(PSBHDR(XB),":")=2)&($P(PSBHDR(XB),":",2)=""):" ",1:" / ")_MED
"RTN","PSBOMT",206,0)
 I $D(PSBADDL) S XA="" K PSBGOT F  S XA=$O(PSBADDL(XA)) Q:XA=""  D
"RTN","PSBOMT",207,0)
 .S MED=$$GET1^DIQ(52.6,XA,.01) Q:$D(PSBGOT(MED))  S PSBGOT(MED)=""
"RTN","PSBOMT",208,0)
 .I $L(PSBHDR(XB)_" / "_MED)+3>IOM D  Q
"RTN","PSBOMT",209,0)
 ..S XB=XB+1,PSBHDR(XB)="                         / "_MED
"RTN","PSBOMT",210,0)
 .S PSBHDR(XB)=PSBHDR(XB)_$S(($L(PSBHDR(XB),":")=2)&($P(PSBHDR(XB),":",2)=""):" ",1:" / ")_MED
"RTN","PSBOMT",211,0)
 I $D(PSBSOLL) S XA="" K PSBGOT F  S XA=$O(PSBSOLL(XA)) Q:XA=""  D
"RTN","PSBOMT",212,0)
 .S MED=$$GET1^DIQ(52.7,XA,.01) Q:$D(PSBGOT(MED))  S PSBGOT(MED)=""
"RTN","PSBOMT",213,0)
 .I $L(PSBHDR(XB)_" / "_MED)+3>IOM D  Q
"RTN","PSBOMT",214,0)
 ..S XB=XB+1,PSBHDR(XB)="                         / "_MED
"RTN","PSBOMT",215,0)
 .S PSBHDR(XB)=PSBHDR(XB)_$S(($L(PSBHDR(XB),":")=2)&($P(PSBHDR(XB),":",2)=""):" ",1:" / ")_MED
"RTN","PSBOMT",216,0)
 I $D(PSBDDL) S XA="" F  S XA=$O(PSBDDL(XA)) Q:XA=""  D
"RTN","PSBOMT",217,0)
 .S MED=$$GET1^DIQ(50,XA,.01)
"RTN","PSBOMT",218,0)
 .I $L(PSBHDR(XB)_" / "_MED)+3>IOM D  Q
"RTN","PSBOMT",219,0)
 ..S XB=XB+1,PSBHDR(XB)="                         / "_MED
"RTN","PSBOMT",220,0)
 .S PSBHDR(XB)=PSBHDR(XB)_$S(($L(PSBHDR(XB),":")=2)&($P(PSBHDR(XB),":",2)=""):" ",1:" / ")_MED
"RTN","PSBOMT",221,0)
 Q
"RTN","PSBOMT",222,0)
WRAP(SIZE,ZP,BRIEN) ;
"RTN","PSBOMT",223,0)
 D ADD($J("",55)_ZP)
"RTN","PSBOMT",224,0)
 D ADD($J("",55)_$E(SIZE,1,75))
"RTN","PSBOMT",225,0)
 I $L(SIZE)>75 D ADD($J("",55)_$E(SIZE,76,150))
"RTN","PSBOMT",226,0)
 Q
"RTN","PSBOMT",227,0)
ADD(XE) ;
"RTN","PSBOMT",228,0)
 S ^TMP("PSB",$J,$O(^TMP("PSB",$J,""),-1)+1)=XE
"RTN","PSBOMT",229,0)
 Q
"RTN","PSBOMT",230,0)
GETDRN(IEN1) ;
"RTN","PSBOMT",231,0)
 ; Get the Drug IEN (p50) via OI IEN (p50.7)
"RTN","PSBOMT",232,0)
 K ^TMP($J,"PSBLIST")
"RTN","PSBOMT",233,0)
 D DRGIEN^PSS50P7(IEN1,,"PSBLIST")
"RTN","PSBOMT",234,0)
 S DN=$O(^TMP($J,"PSBLIST",0))
"RTN","PSBOMT",235,0)
 K ^TMP($J,"PSBLIST")
"RTN","PSBOMT",236,0)
 Q DN
"RTN","PSBOMT",237,0)
GETCLSS(IEN1) ;
"RTN","PSBOMT",238,0)
 ; Get the Items w/i VA Class
"RTN","PSBOMT",239,0)
 K ^TMP($J,"PSBLIST")
"RTN","PSBOMT",240,0)
 D VAC^PSS50(IEN1,,,"PSBLIST")
"RTN","PSBOMT",241,0)
 M PSBDDRG=^TMP($J,"PSBLIST")
"RTN","PSBOMT",242,0)
 K ^TMP($J,"PSBLIST")
"RTN","PSBOMT",243,0)
 Q
"RTN","PSBOPE")
0^23^B20462828^B17458484
"RTN","PSBOPE",1,0)
PSBOPE ;BIRMINGHAM/EFC-PRN EFFECTIVENESS WORKSHEET ;8/12/12 10:57pm
"RTN","PSBOPE",2,0)
 ;;3.0;BAR CODE MED ADMIN;**5,23,32*,70*;Mar 2004;Build 101
"RTN","PSBOPE",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOPE",4,0)
 ;
"RTN","PSBOPE",5,0)
 ; Reference/IA
"RTN","PSBOPE",6,0)
 ; ^DPT/10035
"RTN","PSBOPE",7,0)
 ; EN^PSJBCMA/2828
"RTN","PSBOPE",8,0)
 ;
"RTN","PSBOPE",9,0)
 ;*70 - reset PSBCLINORD = 2 to signify combined orders report
"RTN","PSBOPE",10,0)
 ;
"RTN","PSBOPE",11,0)
EN ; Called from DQ^PSBO
"RTN","PSBOPE",12,0)
 N PSBSTRT,PSBSTOP,DFN
"RTN","PSBOPE",13,0)
 K ^TMP("PSB",$J)
"RTN","PSBOPE",14,0)
 S PSBSTRT=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7)
"RTN","PSBOPE",15,0)
 S PSBSTOP=$P(PSBRPT(.1),U,8)+$P(PSBRPT(.1),U,9)
"RTN","PSBOPE",16,0)
 F DFN=0:0 S DFN=$O(^TMP("PSBO",$J,DFN)) Q:'DFN  D EN1
"RTN","PSBOPE",17,0)
 D PRINT
"RTN","PSBOPE",18,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J)
"RTN","PSBOPE",19,0)
 Q
"RTN","PSBOPE",20,0)
 ;
"RTN","PSBOPE",21,0)
EN1 ; Expects DFN,PSBSTRT,PSBSTOP from EN
"RTN","PSBOPE",22,0)
 N PSBGBL,PSBHDR,PSBX,PSBADMIN,PSBDFN,PSBDT,PSBMED,PSBORD,PSBOSTRT,PSBSCHED
"RTN","PSBOPE",23,0)
 K ^TMP("PSJ",$J)
"RTN","PSBOPE",24,0)
 S PSBDT=PSBSTRT-.0000001
"RTN","PSBOPE",25,0)
 F  S PSBDT=$O(^PSB(53.79,"AADT",DFN,PSBDT)) Q:'PSBDT!(PSBDT>PSBSTOP)  D
"RTN","PSBOPE",26,0)
 .S PSBIEN=0
"RTN","PSBOPE",27,0)
 .F  S PSBIEN=$O(^PSB(53.79,"AADT",DFN,PSBDT,PSBIEN)) Q:'PSBIEN  D
"RTN","PSBOPE",28,0)
 ..Q:$P($G(^PSB(53.79,PSBIEN,.1)),U,2)'="P"  ; Not a PRN Administration
"RTN","PSBOPE",29,0)
 ..Q:$P($G(^PSB(53.79,PSBIEN,.2)),U,2)]""  ; Effectiveness entered
"RTN","PSBOPE",30,0)
 ..Q:($P($G(^PSB(53.79,PSBIEN,0)),U,9)'="G")&($P($G(^PSB(53.79,PSBIEN,0)),U,9)'="RM")  ;Allow only entries with at status of "GIVEN" and "REMOVED"
"RTN","PSBOPE",31,0)
 ..Q:$P($G(^PSB(53.79,PSBIEN,0)),U,6)<PSBDT
"RTN","PSBOPE",32,0)
 ..Q:$P($G(^PSB(53.79,PSBIEN,0)),U,6)>PSBSTOP
"RTN","PSBOPE",33,0)
 ..S ^TMP("PSB",$J,DFN,PSBIEN)=""
"RTN","PSBOPE",34,0)
 Q
"RTN","PSBOPE",35,0)
PRINT ; Print meds stored in ^TMP("PSB",$J,DFN,....
"RTN","PSBOPE",36,0)
 N PSBHDR,PSBDT,PSBMED,DFN
"RTN","PSBOPE",37,0)
 ;
"RTN","PSBOPE",38,0)
 ; Print by Patient
"RTN","PSBOPE",39,0)
 ;
"RTN","PSBOPE",40,0)
 D:$P(PSBRPT(.1),U,1)="P"
"RTN","PSBOPE",41,0)
 .S PSBHDR(1)="PRN EFFECTIVENESS LIST for "_$$FMTE^XLFDT(PSBSTRT)_" to "_$$FMTE^XLFDT(PSBSTOP)
"RTN","PSBOPE",42,0)
 .S DFN=$P(PSBRPT(.1),U,2)
"RTN","PSBOPE",43,0)
 .W $$PTHDR()
"RTN","PSBOPE",44,0)
 .I '$O(^TMP("PSB",$J,DFN,0)) W !,"No PRN Medications Found",$$PTFTR^PSBOHDR() Q
"RTN","PSBOPE",45,0)
 .W !  ; Line Break Between Admin Times
"RTN","PSBOPE",46,0)
 .S PSBIEN=""
"RTN","PSBOPE",47,0)
 .F  S PSBIEN=$O(^TMP("PSB",$J,DFN,PSBIEN)) Q:PSBIEN=""  D
"RTN","PSBOPE",48,0)
 ..S PSBIENS=PSBIEN_","
"RTN","PSBOPE",49,0)
 ..I $Y>(IOSL-5) W $$PTFTR^PSBOHDR(),$$PTHDR()
"RTN","PSBOPE",50,0)
 ..W !,$$GET1^DIQ(53.79,PSBIENS,.06),?30,$$GET1^DIQ(53.79,PSBIENS,.08),?64,$$GET1^DIQ(53.79,PSBIENS,"ACTION BY")                      ;*70
"RTN","PSBOPE",51,0)
 ..W ?102,$$GET1^DIQ(53.79,PSBIENS,"PATIENT LOCATION")           ;*70
"RTN","PSBOPE",52,0)
 ..W !,?5,"PRN Reason: ",$$GET1^DIQ(53.79,PSBIENS,.21)
"RTN","PSBOPE",53,0)
 .W $$PTFTR^PSBOHDR()
"RTN","PSBOPE",54,0)
 .Q
"RTN","PSBOPE",55,0)
 ;
"RTN","PSBOPE",56,0)
 ; Print by Ward
"RTN","PSBOPE",57,0)
 ;
"RTN","PSBOPE",58,0)
 D:$P(PSBRPT(.1),U,1)="W"
"RTN","PSBOPE",59,0)
 .S PSBHDR(1)="PRN EFFECTIVENESS LIST  from "_$$FMTE^XLFDT(PSBSTRT)_" thru "_$$FMTE^XLFDT(PSBSTOP)
"RTN","PSBOPE",60,0)
 .S PSBWARD=$P(PSBRPT(.1),U,3)
"RTN","PSBOPE",61,0)
 .W $$WRDHDR()
"RTN","PSBOPE",62,0)
 .I '$O(^TMP("PSB",$J,0)) W !,"No PRN Medications Found" Q
"RTN","PSBOPE",63,0)
 .S PSBSORT=$P(PSBRPT(.1),U,5)
"RTN","PSBOPE",64,0)
 .F DFN=0:0 S DFN=$O(^TMP("PSB",$J,DFN)) Q:'DFN  D
"RTN","PSBOPE",65,0)
 ..S PSBINDX=$S(PSBSORT="P":$P(^DPT(DFN,0),U),1:$G(^DPT(DFN,.1))_" "_$G(^DPT(DFN,.101)))  ;PSB*3*23
"RTN","PSBOPE",66,0)
 ..S:PSBINDX="" PSBINDX=$P(^DPT(DFN,0),U)
"RTN","PSBOPE",67,0)
 ..S ^TMP("PSB",$J,"B",PSBINDX,DFN)=""
"RTN","PSBOPE",68,0)
 .S PSBINDX=""
"RTN","PSBOPE",69,0)
 .F  S PSBINDX=$O(^TMP("PSB",$J,"B",PSBINDX)) Q:PSBINDX=""  D
"RTN","PSBOPE",70,0)
 ..F DFN=0:0 S DFN=$O(^TMP("PSB",$J,"B",PSBINDX,DFN)) Q:'DFN  D
"RTN","PSBOPE",71,0)
 ...W ! ; Line Break Between Pt's
"RTN","PSBOPE",72,0)
 ...W:$P(PSBRPT(.1),U,5)="P" !,$$GET1^DIQ(2,DFN_",",.01),?32,$$GET1^DIQ(2,DFN_",",.1),"  ",$$GET1^DIQ(2,DFN_",",.101)
"RTN","PSBOPE",73,0)
 ...W:$P(PSBRPT(.1),U,5)="B" !,$$GET1^DIQ(2,DFN_",",.1),"  ",$$GET1^DIQ(2,DFN_",",.101),?20,$$GET1^DIQ(2,DFN_",",.01)
"RTN","PSBOPE",74,0)
 ...W !  ; Line Break Between Admin Times
"RTN","PSBOPE",75,0)
 ...S PSBIEN=""
"RTN","PSBOPE",76,0)
 ...F  S PSBIEN=$O(^TMP("PSB",$J,DFN,PSBIEN)) Q:PSBIEN=""  D
"RTN","PSBOPE",77,0)
 ....I $Y>(IOSL-5) W $$WRDHDR()
"RTN","PSBOPE",78,0)
 ....W !?5,$$GET1^DIQ(53.79,PSBIEN_",",.06),?35,$$GET1^DIQ(53.79,PSBIEN_",",.08),?68,$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY")      ;*70
"RTN","PSBOPE",79,0)
 ....W ?102,$$GET1^DIQ(53.79,PSBIEN_",","PATIENT LOCATION")   ;*70
"RTN","PSBOPE",80,0)
 ....W !?10,"PRN Reason: ",$$GET1^DIQ(53.79,PSBIEN_",",.21)
"RTN","PSBOPE",81,0)
 Q
"RTN","PSBOPE",82,0)
 ;
"RTN","PSBOPE",83,0)
WRDHDR() ; Ward Header
"RTN","PSBOPE",84,0)
 N PSBCLINORD S PSBCLINORD=2               ;2 = both order types   *70
"RTN","PSBOPE",85,0)
 D WARD^PSBOHDR(PSBWRD,.PSBHDR)
"RTN","PSBOPE",86,0)
 W:$P(PSBRPT(.1),U,5)="B" !,"Ward Rm-Bed",?20,"Patient"
"RTN","PSBOPE",87,0)
 W:$P(PSBRPT(.1),U,5)="P" !,"Patient",?32,"Ward Rm-Bed"
"RTN","PSBOPE",88,0)
 ;adjust name of headings and colums to make room for Location    ;*70
"RTN","PSBOPE",89,0)
 W !?5,"Admin Date/Time",?35,"Medication",?68,"Administered By"   ;*70
"RTN","PSBOPE",90,0)
 W ?102,"Location"                                                ;*70
"RTN","PSBOPE",91,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBOPE",92,0)
 Q ""
"RTN","PSBOPE",93,0)
 ;
"RTN","PSBOPE",94,0)
PTHDR() ; Patient Header
"RTN","PSBOPE",95,0)
 N PSBCLINORD S PSBCLINORD=2               ;2 = both order types   *70
"RTN","PSBOPE",96,0)
 D PT^PSBOHDR(DFN,.PSBHDR)
"RTN","PSBOPE",97,0)
 W !,"Admin Date/Time",?30,"Medication",?64,"Administered By"
"RTN","PSBOPE",98,0)
 W ?102,"Location"
"RTN","PSBOPE",99,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBOPE",100,0)
 Q ""
"RTN","PSBOPE",101,0)
 ;
"RTN","PSBOPM")
0^24^B75665878^B73285742
"RTN","PSBOPM",1,0)
PSBOPM ;BIRMINGHAM/BSR-BCMA OIT HISTORY ;8/12/12 7:59pm
"RTN","PSBOPM",2,0)
 ;;3.0;BAR CODE MED ADMIN;**3,9,13,17,40,70**;Mar 2004;Build 101
"RTN","PSBOPM",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSBOPM",4,0)
 ;
"RTN","PSBOPM",5,0)
 ; Reference/IA
"RTN","PSBOPM",6,0)
 ; File 50.7/2880
"RTN","PSBOPM",7,0)
 ; File 52.6/436
"RTN","PSBOPM",8,0)
 ; File 52.7/437
"RTN","PSBOPM",9,0)
 ; File 200/10060
"RTN","PSBOPM",10,0)
 ; EN^PSJBCMA1/2829
"RTN","PSBOPM",11,0)
 ;
"RTN","PSBOPM",12,0)
 ;*70 - reset PSBCLINORD = 2 to signify combined orders report
"RTN","PSBOPM",13,0)
 ;
"RTN","PSBOPM",14,0)
EN ;
"RTN","PSBOPM",15,0)
 N PSBHDR,DFN
"RTN","PSBOPM",16,0)
 S PSBGBL="^TMP(""PSBO"",$J,""B"")"
"RTN","PSBOPM",17,0)
 F  S PSBGBL=$Q(@PSBGBL) Q:PSBGBL=""  Q:$QS(PSBGBL,2)'=$J  Q:$QS(PSBGBL,1)'["PSBO"  D
"RTN","PSBOPM",18,0)
 .S DFN=$QS(PSBGBL,5)
"RTN","PSBOPM",19,0)
 I '$G(DFN) W !,("Error: No Patient IEN")  Q
"RTN","PSBOPM",20,0)
 S PSBSTRT=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7)
"RTN","PSBOPM",21,0)
 S PSBSTOP=$P(PSBRPT(.1),U,8)+$P(PSBRPT(.1),U,9)
"RTN","PSBOPM",22,0)
 S PSBCOM=$P(PSBRPT(.2),"^",8)   ;COMMENT FLAG 1 MEANS YES
"RTN","PSBOPM",23,0)
 I PSBSTRT="0" D
"RTN","PSBOPM",24,0)
 .D NOW^%DTC S PSBSTOP=%
"RTN","PSBOPM",25,0)
 .S X1=((PSBSTOP)\1) S X2=-$$GET^XPAR("ALL","PSB MED HIST DAYS BACK")
"RTN","PSBOPM",26,0)
 .S:X2'<0 X2=-30 D C^%DTC  S PSBSTRT=X
"RTN","PSBOPM",27,0)
 .S PSBCOM=$$GET^XPAR("ALL","PSB RPT INCL COMMENTS")
"RTN","PSBOPM",28,0)
 D OUT(DFN,PSBSTRT,PSBSTOP,PSBORDNM)
"RTN","PSBOPM",29,0)
 Q
"RTN","PSBOPM",30,0)
 ;
"RTN","PSBOPM",31,0)
OUT(DFN,PSBSTRT,PSBSTOP,PSBORDNM)        ;
"RTN","PSBOPM",32,0)
 D CLEANALL ;CLEAN UP VARIABLES AND TMP ARRAY
"RTN","PSBOPM",33,0)
 ;
"RTN","PSBOPM",34,0)
 ;IF PSBORDNM DOESN'T CONTAIN A "U" OR A "V", SKIP THE ORDER LOOKUP
"RTN","PSBOPM",35,0)
 S PSBOR=1
"RTN","PSBOPM",36,0)
 I PSBORDNM'["U",PSBORDNM'["V" D
"RTN","PSBOPM",37,0)
 .S:'$$GETORD^PSBOPM1(.PSBORDNM) PSBOR=0
"RTN","PSBOPM",38,0)
 .I 'PSBOR&(PSBORDNM]"") S TMP("PSBOIS",$J,PSBORDNM)=""
"RTN","PSBOPM",39,0)
 I PSBOR D
"RTN","PSBOPM",40,0)
 .D GETORDN
"RTN","PSBOPM",41,0)
 .D GETOIS
"RTN","PSBOPM",42,0)
 D GETADSO ;  GET ALL ADDITIVES AND SOLUTIONS
"RTN","PSBOPM",43,0)
 D FINDIENS^PSBOPM1 ; FIND EVERY MED LOG ENTRIES THAT SHOULD BE ON THE RPT
"RTN","PSBOPM",44,0)
 D PREOUT ;   WRITE DATA TO GLOBAL
"RTN","PSBOPM",45,0)
 D WRITEOT ;
"RTN","PSBOPM",46,0)
 D CLEANSUM ; CLEAN UP AND LEAVE LIST OF IENS FOR THE REPORT.
"RTN","PSBOPM",47,0)
 Q
"RTN","PSBOPM",48,0)
 ;
"RTN","PSBOPM",49,0)
GETORDN ;
"RTN","PSBOPM",50,0)
 K ^TMP("PSJ1",$J)
"RTN","PSBOPM",51,0)
 D EN^PSJBCMA1(DFN,PSBORDNM,1)
"RTN","PSBOPM",52,0)
 Q
"RTN","PSBOPM",53,0)
 ;
"RTN","PSBOPM",54,0)
GETOIS  ; LOAD PSBOIS(#) WITH ALL OF THE ORDERABLE ITEMS
"RTN","PSBOPM",55,0)
 I PSBORDNM["U" D
"RTN","PSBOPM",56,0)
 .;GET UNIT DOSE ORDERS
"RTN","PSBOPM",57,0)
 .I $D(^TMP("PSJ1",$J,2)) D
"RTN","PSBOPM",58,0)
 ..S PSBOI=$P(^TMP("PSJ1",$J,2),"^")
"RTN","PSBOPM",59,0)
 ..S PSBOI=$S(PSBOI["U":$TR(PSBOI,"U",""),PSBOI["V":$TR(PSBOI,"V",""),1:PSBOI)
"RTN","PSBOPM",60,0)
 ..S TMP("PSBOIS",$J,PSBOI)=""
"RTN","PSBOPM",61,0)
 ;
"RTN","PSBOPM",62,0)
 ;IV ORDERS NEED TO USE THE ADDITIVE AND SOLUTION NUMBER TO BACK
"RTN","PSBOPM",63,0)
 ;TRACK TO THE OI ASSOCIATED WITH IT
"RTN","PSBOPM",64,0)
 I PSBORDNM["V" D
"RTN","PSBOPM",65,0)
 .;GET ADDITIVES OFF THE ORDER
"RTN","PSBOPM",66,0)
 .I $G(^TMP("PSJ1",$J,850,0))  D
"RTN","PSBOPM",67,0)
 ..S XXX="" F  S XXX=$O(^TMP("PSJ1",$J,850,XXX)) Q:XXX=""  D
"RTN","PSBOPM",68,0)
 ...S XXY="" F  S XXY=$O(^TMP("PSJ1",$J,850,XXX,XXY)) Q:XXY=""  D
"RTN","PSBOPM",69,0)
 ....S PSBADD=$P(^TMP("PSJ1",$J,850,XXX,XXY),"^")
"RTN","PSBOPM",70,0)
 ....;CONVERT ADDITIVE TO ORDERABLE ITEM AND ADD TO LIST
"RTN","PSBOPM",71,0)
 ....S TMP("PSBOIS",$J,$$OFROMA(PSBADD))=""
"RTN","PSBOPM",72,0)
 .;   GET SOLUTIONS OFF THE ORDER
"RTN","PSBOPM",73,0)
 .I $G(^TMP("PSJ1",$J,950,0))  D
"RTN","PSBOPM",74,0)
 ..S XXX="" F  S XXX=$O(^TMP("PSJ1",$J,950,XXX)) Q:XXX=""  D
"RTN","PSBOPM",75,0)
 ...S XXY="" F  S XXY=$O(^TMP("PSJ1",$J,950,XXX,XXY)) Q:XXY=""  D
"RTN","PSBOPM",76,0)
 ....S PSBSOL=$P(^TMP("PSJ1",$J,950,XXX,XXY),"^")
"RTN","PSBOPM",77,0)
 ....;
"RTN","PSBOPM",78,0)
 ....;CONVERT SOLUTIOIN TO ORDERABLE ITEM AND ADD TO LIST
"RTN","PSBOPM",79,0)
 ....S TMP("PSBOIS",$J,$$OFROMS(PSBSOL))=""
"RTN","PSBOPM",80,0)
 Q
"RTN","PSBOPM",81,0)
 ;
"RTN","PSBOPM",82,0)
OFROMA(PSBADD) ;GET ORDERABLE ITEM FROM AN ADDITIVE
"RTN","PSBOPM",83,0)
 Q $$GET1^DIQ(52.6,PSBADD_",",15,"I")
"RTN","PSBOPM",84,0)
 ; 
"RTN","PSBOPM",85,0)
OFROMS(PSBSOL) ; GET ORDERABLE ITEM FROM A SOLUTION
"RTN","PSBOPM",86,0)
 Q $$GET1^DIQ(52.7,PSBSOL_",",9,"I")
"RTN","PSBOPM",87,0)
 ;
"RTN","PSBOPM",88,0)
GETADSO ; GET ALL ADDITIVES FOR ALL ORDERABLE ITEMS
"RTN","PSBOPM",89,0)
 K PSBAOUT,PSBSOUT
"RTN","PSBOPM",90,0)
 S XA="" F  S XA=$O(TMP("PSBOIS",$J,XA)) Q:XA=""  D
"RTN","PSBOPM",91,0)
 .D LIST^DIC(52.6,"","@;15I","QPI","","","","AOI","","","PSBAOUT")
"RTN","PSBOPM",92,0)
 .S XB=0 F  S XB=$O(PSBAOUT("DILIST",XB)) Q:XB=""  D
"RTN","PSBOPM",93,0)
 ..I $P(PSBAOUT("DILIST",XB,0),"^",2)=XA D
"RTN","PSBOPM",94,0)
 ...S TMP("PSBADDS",$J,$P(PSBAOUT("DILIST",XB,0),"^",1))=""
"RTN","PSBOPM",95,0)
 K PSBAOUT
"RTN","PSBOPM",96,0)
 ; GET ALL SOLUTIONS FOR ALL ORDERABLE ITEMS
"RTN","PSBOPM",97,0)
 S XA="" F  S XA=$O(TMP("PSBOIS",$J,XA)) Q:XA=""  D
"RTN","PSBOPM",98,0)
 .D LIST^DIC(52.7,"","@;9I","QPI","","","","AOI","","","PSBSOUT")
"RTN","PSBOPM",99,0)
 .S XB=0 F  S XB=$O(PSBSOUT("DILIST",XB)) Q:XB=""  D
"RTN","PSBOPM",100,0)
 ..I $P(PSBSOUT("DILIST",XB,0),"^",2)=XA D
"RTN","PSBOPM",101,0)
 ...S TMP("PSBSOLS",$J,$P(PSBSOUT("DILIST",XB,0),"^",1))=""
"RTN","PSBOPM",102,0)
 K PSBSOUT
"RTN","PSBOPM",103,0)
 Q
"RTN","PSBOPM",104,0)
 ;
"RTN","PSBOPM",105,0)
PREOUT ;
"RTN","PSBOPM",106,0)
 N TYP
"RTN","PSBOPM",107,0)
 F TYP="UD","ADD","SOL"  D
"RTN","PSBOPM",108,0)
 .Q:'$D(TMP("PSBIENS",$J,TYP))
"RTN","PSBOPM",109,0)
 .K PSBUNK S XDT="" F  S XDT=$O(TMP("PSBIENS",$J,TYP,XDT),-1) Q:XDT=""  D
"RTN","PSBOPM",110,0)
 ..S I="" F  S I=$O(TMP("PSBIENS",$J,TYP,XDT,I)) Q:I=""  D
"RTN","PSBOPM",111,0)
 ...I TYP="UD" Q:$D(TMP("PSBIENS",$J,"ADD",XDT,I))  Q:$D(TMP("PSBIENS",$J,"SOL",XDT,I))
"RTN","PSBOPM",112,0)
 ...S PSBIEN=I
"RTN","PSBOPM",113,0)
 ...S PSBIENS=PSBIEN_","
"RTN","PSBOPM",114,0)
 ...D OUTPUT(TYP)
"RTN","PSBOPM",115,0)
 Q
"RTN","PSBOPM",116,0)
 ;
"RTN","PSBOPM",117,0)
OUTPUT(TYP) ;
"RTN","PSBOPM",118,0)
 S PSBSPC=$J("",80)
"RTN","PSBOPM",119,0)
 S W=$E($$GET1^DIQ(53.79,PSBIENS,.02)_PSBSPC,1,20)_" "
"RTN","PSBOPM",120,0)
 I $TR(W," ")="",$$MME^PSBOML(+PSBIENS) S W="MME/UNKNOWN LOCATION "
"RTN","PSBOPM",121,0)
 S W=W_$S($P(^PSB(53.79,PSBIEN,0),U,9)="":"?? ",1:$E($P(^PSB(53.79,PSBIEN,0),U,9)_"  ",1,2)_" ")
"RTN","PSBOPM",122,0)
 S:$P(^PSB(53.79,PSBIEN,0),U,9)="" PSBUNK=1
"RTN","PSBOPM",123,0)
 S W=W_$E($P($G(^PSB(53.79,PSBIEN,.1)),U,2)_PSBSPC,1,2)_"  "
"RTN","PSBOPM",124,0)
 S W=W_$E($E($$GET1^DIQ(53.79,PSBIENS,.06),1,18)_PSBSPC,1,21)_" "
"RTN","PSBOPM",125,0)
 S W=W_$E($$GET1^DIQ(53.79,PSBIENS,"ACTION BY:INITIAL")_PSBSPC,1,10)_" "
"RTN","PSBOPM",126,0)
 S W=W_$$GET1^DIQ(53.79,PSBIENS,.16)
"RTN","PSBOPM",127,0)
 D ADD(W,TYP)
"RTN","PSBOPM",128,0)
 F PSBNODE=.5,.6,.7 D
"RTN","PSBOPM",129,0)
 .S PSBDD=$S(PSBNODE=.5:53.795,PSBNODE=.6:53.796,1:53.797)
"RTN","PSBOPM",130,0)
 .F PSBY=0:0 S PSBY=$O(^PSB(53.79,PSBIEN,PSBNODE,PSBY)) Q:'PSBY  D
"RTN","PSBOPM",131,0)
 ..D WRAPMEDS($$GET1^DIQ(PSBDD,PSBY_","_PSBIENS,.01),$$GET1^DIQ(PSBDD,PSBY_","_PSBIENS,.03),$$GET1^DIQ(PSBDD,PSBY_","_PSBIENS,.04),TYP)
"RTN","PSBOPM",132,0)
 I PSBCOM=1  D COMNTS   ;GETS COMMENTS
"RTN","PSBOPM",133,0)
 D ADD("",TYP)
"RTN","PSBOPM",134,0)
 Q
"RTN","PSBOPM",135,0)
 ;
"RTN","PSBOPM",136,0)
COMNTS  ;
"RTN","PSBOPM",137,0)
 N Z,CNT
"RTN","PSBOPM",138,0)
 S Z="",CNT=0
"RTN","PSBOPM",139,0)
 I $D(^PSB(53.79,PSBIEN,.3,0)) D
"RTN","PSBOPM",140,0)
 .D ADD("",TYP)
"RTN","PSBOPM",141,0)
 .D ADD($J("",44)_"Comments: "_$$MAKELINE("-",78),TYP)
"RTN","PSBOPM",142,0)
 .S XT="" F  S XT=$O(^PSB(53.79,PSBIEN,.3,XT)) Q:XT=""  I XT'=0  D
"RTN","PSBOPM",143,0)
 ..D:CNT=1 ADD("",TYP)
"RTN","PSBOPM",144,0)
 ..S Y=$P(^PSB(53.79,PSBIEN,.3,XT,0),"^",3) D DD^%DT S XBR=Y
"RTN","PSBOPM",145,0)
 ..S Z=XBR_"   "_$P(^VA(200,$P(^PSB(53.79,PSBIEN,.3,XT,0),"^",2),0),"^",2)
"RTN","PSBOPM",146,0)
 ..D WRAP($P(^PSB(53.79,PSBIEN,.3,XT,0),"^",1),Z,PSBIEN)
"RTN","PSBOPM",147,0)
 ..S CNT=1
"RTN","PSBOPM",148,0)
 .D ADD($J("",54)_$$MAKELINE("-",78),TYP)
"RTN","PSBOPM",149,0)
 Q
"RTN","PSBOPM",150,0)
        ;
"RTN","PSBOPM",151,0)
WRAP(SIZE,ZP,BRIEN)         ;
"RTN","PSBOPM",152,0)
 D ADD($J("",55)_ZP,TYP)
"RTN","PSBOPM",153,0)
 D ADD($J("",55)_$E(SIZE,1,75),TYP)
"RTN","PSBOPM",154,0)
 I $L(SIZE)>75 D ADD($J("",55)_$E(SIZE,76,150),TYP)
"RTN","PSBOPM",155,0)
 Q
"RTN","PSBOPM",156,0)
 ;
"RTN","PSBOPM",157,0)
HEADA ;
"RTN","PSBOPM",158,0)
 W !
"RTN","PSBOPM",159,0)
 W "Location",?21,"St Sch Administration Date",?50,"By",?61,"Injection Site",?96,"Units",?112,"Units of"
"RTN","PSBOPM",160,0)
 W !,?55,"Medication & Dosage",?96,"GIVEN",?112,"Administration"
"RTN","PSBOPM",161,0)
 W !
"RTN","PSBOPM",162,0)
 W $$MAKELINE("-",132)
"RTN","PSBOPM",163,0)
 Q
"RTN","PSBOPM",164,0)
 ;
"RTN","PSBOPM",165,0)
ADD(XE,TYP)  ;
"RTN","PSBOPM",166,0)
 S ^TMP("PSB",$J,TYP,$O(^TMP("PSB",$J,TYP,""),-1)+1)=XE
"RTN","PSBOPM",167,0)
 Q
"RTN","PSBOPM",168,0)
 ;
"RTN","PSBOPM",169,0)
WRAPMEDS(MED,UG,UOA,TYP)  ;
"RTN","PSBOPM",170,0)
 ;MED IS NOT WRAPPED: MAX LENGTH IN PSDRUG/52.6/52.7 IS 40
"RTN","PSBOPM",171,0)
 ;UG/UOA MAX AT 30/40 AND WILL BE WRAPPED AT 15 EACH
"RTN","PSBOPM",172,0)
 ;THIS WILL CREATE UPTO 3 LINES
"RTN","PSBOPM",173,0)
 S MED=$E(MED_$J("",40),1,40)
"RTN","PSBOPM",174,0)
 N UGWRAP
"RTN","PSBOPM",175,0)
 S (CNTX,UOA1,UOA16,UOA31)=""
"RTN","PSBOPM",176,0)
 I +$G(UG)?1"."1.N S UG=0_+UG
"RTN","PSBOPM",177,0)
 F CNT=1:15:45  D
"RTN","PSBOPM",178,0)
 .D PARSE(UOA,CNT)
"RTN","PSBOPM",179,0)
 .S UGWRAP=$E(UG,CNT,(CNT+14))
"RTN","PSBOPM",180,0)
 .I CNT=1 D ADD($J("",55)_MED_" "_$$PAD(UGWRAP,15)_" "_$$PAD(UOA1,15),TYP)
"RTN","PSBOPM",181,0)
 .I (CNT>1),($L(UGWRAP)>0!$L(@("UOA"_CNT))>0) D ADD($J("",96)_$$PAD(UGWRAP,15)_" "_$$PAD(@("UOA"_CNT),15),TYP)
"RTN","PSBOPM",182,0)
 Q
"RTN","PSBOPM",183,0)
 ;
"RTN","PSBOPM",184,0)
PAD(X,CNT) ;
"RTN","PSBOPM",185,0)
 Q $E(X_$J("",CNT),1,CNT)
"RTN","PSBOPM",186,0)
WRITEOT ;
"RTN","PSBOPM",187,0)
 N TPE
"RTN","PSBOPM",188,0)
 S Y=$P(PSBSTRT,".",1)  D D^DIQ  S PSTRTA=Y
"RTN","PSBOPM",189,0)
 S Y=$P(PSBSTOP,".",1)  D D^DIQ  S PSTP=Y
"RTN","PSBOPM",190,0)
 S PSBHDR(1)="MEDICATION HISTORY for "_PSTRTA_"  to  "_PSTP
"RTN","PSBOPM",191,0)
 I '$D(TMP("PSBIENS",$J)) D ADD("<<<< NO HISTORY FOUND FOR THIS TIME FRAME >>>>","UD")
"RTN","PSBOPM",192,0)
 S TPE="" F  S TPE=$O(^TMP("PSB",$J,TPE)) Q:TPE=""  D
"RTN","PSBOPM",193,0)
 .D MEDS(TPE)
"RTN","PSBOPM",194,0)
 .N PSBCLINORD S PSBCLINORD=2 D PT^PSBOHDR(DFN,.PSBHDR),HEADA     ;*70
"RTN","PSBOPM",195,0)
 .S EX="" F  S EX=$O(^TMP("PSB",$J,TPE,EX)) Q:EX=""  D
"RTN","PSBOPM",196,0)
 ..I $Y>(IOSL-5) D
"RTN","PSBOPM",197,0)
 ...W $$PTFTR^PSBOHDR()
"RTN","PSBOPM",198,0)
 ...D PT^PSBOHDR(DFN,.PSBHDR),HEADA
"RTN","PSBOPM",199,0)
 ..W !,$G(^TMP("PSB",$J,TPE,EX))
"RTN","PSBOPM",200,0)
 W $$PTFTR^PSBOHDR()
"RTN","PSBOPM",201,0)
 Q
"RTN","PSBOPM",202,0)
 ;
"RTN","PSBOPM",203,0)
FTR() ;
"RTN","PSBOPM",204,0)
 I (IOSL<100) F  Q:$Y>(IOSL-10)  W !
"RTN","PSBOPM",205,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","PSBOPM",206,0)
 S X="Ward: "_PSBHDR("WARD")_"  Room-Bed: "_PSBHDR("ROOM")
"RTN","PSBOPM",207,0)
 W !,PSBHDR("NAME"),?(IOM-11\2),PSBHDR("SSN"),?(IOM-$L(X)),X
"RTN","PSBOPM",208,0)
 Q ""
"RTN","PSBOPM",209,0)
 ;
"RTN","PSBOPM",210,0)
MEDS(TYP) ;
"RTN","PSBOPM",211,0)
 N MED,XA,XB,DPTR,DRG,FLE,SBSC
"RTN","PSBOPM",212,0)
 S MED="",XB=3,DRG=""
"RTN","PSBOPM",213,0)
 S PSBHDR(3)="MEDICATIONS SEARCH LIST:"
"RTN","PSBOPM",214,0)
 S XA="" F  S XA=$O(TMP("PSBOIS",$J,XA)) Q:XA=""  D
"RTN","PSBOPM",215,0)
 .S MED=$$GET1^DIQ(50.7,XA,.01)
"RTN","PSBOPM",216,0)
 .I $L(PSBHDR(XB)_" "_MED)>IOM D
"RTN","PSBOPM",217,0)
 ..S XB=XB+1,PSBHDR(XB)="                         "_MED
"RTN","PSBOPM",218,0)
 .E  S PSBHDR(XB)=PSBHDR(XB)_$S($L(PSBHDR(XB))<26:" ",1:"; ")_MED
"RTN","PSBOPM",219,0)
 S XA=999 F  S XA=$O(PSBHDR(XA),-1) Q:XA=XB  K PSBHDR(XA)
"RTN","PSBOPM",220,0)
 I TYP'="" D
"RTN","PSBOPM",221,0)
 .I TYP["UD" S TYP="UNIT DOSE",SBSC="PSBOIS",FLE=50.7
"RTN","PSBOPM",222,0)
 .I TYP["AD" S TYP="ADDITIVE",SBSC="PSBADDS",FLE=52.6
"RTN","PSBOPM",223,0)
 .I TYP["SO" S TYP="SOLUTION",SBSC="PSBSOLS",FLE=52.7
"RTN","PSBOPM",224,0)
 .S DPTR="" F  S DPTR=$O(TMP(SBSC,$J,DPTR)) Q:DPTR=""  I TMP(SBSC,$J,DPTR) D
"RTN","PSBOPM",225,0)
 ..S DRG=$$GET1^DIQ(FLE,DPTR,.01)
"RTN","PSBOPM",226,0)
 ..S PSBHDR($O(PSBHDR(999),-1)+1)=$S(TYP="UNIT DOSE":"",1:"SEARCH FOR "_TYP_": "_DRG)
"RTN","PSBOPM",227,0)
 .K TMP(SBSC,$J)
"RTN","PSBOPM",228,0)
 Q
"RTN","PSBOPM",229,0)
 ;
"RTN","PSBOPM",230,0)
CLEANALL        ; KILL ALL TMP LEVELS USED VARIABLES
"RTN","PSBOPM",231,0)
 K ^TMP("PSB",$J),^TMP("PSJ1",$J),TMP("PSBOIS",$J),TMP("PSBADDS",$J),TMP("PSBSOLS",$J),TMP("PSBIENS",$J),TMP("ARY",$J),DRG,DPTR,PSBOR,FLE,SBSC,TPE
"RTN","PSBOPM",232,0)
 Q
"RTN","PSBOPM",233,0)
 ;
"RTN","PSBOPM",234,0)
CLEANSUM        ; KILLL ALL BUT THE "PSBIENS" LEVEL
"RTN","PSBOPM",235,0)
 K ^TMP("PSB",$J),^TMP("PSJ1",$J),TMP("PSBIENS",$J),TMP("PSBOIS",$J),TMP("PSBADDS",$J),TMP("PSBSOLS",$J)
"RTN","PSBOPM",236,0)
 Q
"RTN","PSBOPM",237,0)
MAKELINE(X,CNT) ;LINE OF WHAT'S PASSED IN CNT TIMES
"RTN","PSBOPM",238,0)
 N Y,Z
"RTN","PSBOPM",239,0)
 S Y=""
"RTN","PSBOPM",240,0)
 F Z=1:1:CNT S Y=Y_X
"RTN","PSBOPM",241,0)
 Q Y
"RTN","PSBOPM",242,0)
 ;
"RTN","PSBOPM",243,0)
PARSE(X,CNT) ;Split text for wrapping.
"RTN","PSBOPM",244,0)
 S CNTX="UOA"_CNT,@CNTX=@CNTX_$E(X,CNT,(CNT+14)),UOAX=""
"RTN","PSBOPM",245,0)
 F  S:$F(@CNTX,", ",+UOAX)>0 UOAX=$F(@CNTX,", ",+UOAX)  Q:'$F(@CNTX,", ",+UOAX)
"RTN","PSBOPM",246,0)
 I UOAX<1 F  S:$F(@CNTX," ",+UOAX)>0 UOAX=$F(@CNTX," ",+UOAX)  Q:'$F(@CNTX," ",+UOAX)
"RTN","PSBOPM",247,0)
 I UOAX>1,(($L(UOA)-(CNT+14))>0) S CNTXX=$E(@CNTX,1,UOAX-1),@("UOA"_(CNT+15))=$E(@CNTX,UOAX,UOAX+14),@CNTX=CNTXX
"RTN","PSBOPM",248,0)
 Q
"RTN","PSBOPM",249,0)
 ;
"RTN","PSBOWA")
0^25^B134110503^B51492255
"RTN","PSBOWA",1,0)
PSBOWA ;BIRMINGHAM/EFC-WARD ADMINISTRATION TIMES ;9/29/12 1:57am
"RTN","PSBOWA",2,0)
 ;;3.0;BAR CODE MED ADMIN;**9,32,56,70**;Mar 2004;Build 101
"RTN","PSBOWA",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOWA",4,0)
 ;
"RTN","PSBOWA",5,0)
 ; Reference/IA
"RTN","PSBOWA",6,0)
 ; ^DPT/10035
"RTN","PSBOWA",7,0)
 ; EN^PSJBCMA/2828
"RTN","PSBOWA",8,0)
 ;
"RTN","PSBOWA",9,0)
 ;*70 - add Clinic filter and clinic name into array
"RTN","PSBOWA",10,0)
 ;      1480: Add clinic to header and breakdown by clinic in detail.
"RTN","PSBOWA",11,0)
 ;
"RTN","PSBOWA",12,0)
EN ;
"RTN","PSBOWA",13,0)
 N PSBHDR,PSBGTOT,PSBTOT,PSBINDX,DFN,PSBX,PSBY,PSBSM,PSBADST,PSBZ
"RTN","PSBOWA",14,0)
 N PSBSRCHL,PSBSORT,PSBCL                                      ;[*70-1480]
"RTN","PSBOWA",15,0)
 S PSBSORT=$P(PSBRPT(.1),U,1)                   ;init PSBSORT  ;*70
"RTN","PSBOWA",16,0)
 S (Y,PSBEVDT)=$P(PSBRPT(.1),U,6) D D^DIQ
"RTN","PSBOWA",17,0)
 S PSBHDR(2)="ADMINISTRATION DATE: "_Y
"RTN","PSBOWA",18,0)
 ;check Clinic or Nurs Unit search list                        ;*70
"RTN","PSBOWA",19,0)
 S PSBSRCHL=$$SRCHLIST^PSBOHDR()
"RTN","PSBOWA",20,0)
 D:$G(PSBSRCHL)]""
"RTN","PSBOWA",21,0)
 .S PSBHDR(3)=""
"RTN","PSBOWA",22,0)
 .S:$P(PSBRPT(4),U,2)="C" PSBHDR(4)="Clinic Search List: "
"RTN","PSBOWA",23,0)
 .S:$P(PSBRPT(4),U,2)="I" PSBHDR(4)="Ward Location: "
"RTN","PSBOWA",24,0)
 ;
"RTN","PSBOWA",25,0)
 S (Y,PSBEVDT2)=$S($P(PSBRPT(.1),U,8)']"":PSBEVDT,1:$P(PSBRPT(.1),U,8)) D D^DIQ
"RTN","PSBOWA",26,0)
 S PSBHDR(2)=PSBHDR(2)_" to "_Y
"RTN","PSBOWA",27,0)
 F PSBIX=0:1 S PSBRPDT=$$FMADD^XLFDT(PSBEVDT,PSBIX) Q:PSBRPDT>PSBEVDT2!(PSBRPDT="-1")  D
"RTN","PSBOWA",28,0)
 .;
"RTN","PSBOWA",29,0)
 .; * * *  Print By Ward  * * *
"RTN","PSBOWA",30,0)
 .D:PSBSORT="W"
"RTN","PSBOWA",31,0)
 ..F X=0,.01:.01:.24 S PSBGTOT(X)=""
"RTN","PSBOWA",32,0)
 ..W $$WRDHDR()
"RTN","PSBOWA",33,0)
 ..S PSBINDX=""
"RTN","PSBOWA",34,0)
 ..F  S PSBINDX=$O(^TMP("PSBO",$J,"B",PSBINDX)) Q:PSBINDX=""  D
"RTN","PSBOWA",35,0)
 ...F DFN=0:0 S DFN=$O(^TMP("PSBO",$J,"B",PSBINDX,DFN)) Q:'DFN  D
"RTN","PSBOWA",36,0)
 ....W:$Y>(IOSL-10) $$WRDHDR()
"RTN","PSBOWA",37,0)
 ....W !,$P(^DPT(DFN,0),U,1),!,"SSN: ",$P(^(0),U,9)
"RTN","PSBOWA",38,0)
 ....W !,"Ward: ",$E($G(^DPT(DFN,.1)),1,25),!,"Room-Bed:  ",$E($G(^(.101)),1,21)
"RTN","PSBOWA",39,0)
 ....W ?32
"RTN","PSBOWA",40,0)
 ....F X=0,.01:.01:.24 S PSBTOT(X)=""
"RTN","PSBOWA",41,0)
 ....K ^TMP("PSJ",$J)
"RTN","PSBOWA",42,0)
 ....D EN^PSJBCMA(DFN,$P(PSBRPT(.1),U,6))
"RTN","PSBOWA",43,0)
 ....D REMOVECO^PSBVDLU1        ;*70 always remove CO orders from ward
"RTN","PSBOWA",44,0)
 ....F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:'PSBX  D
"RTN","PSBOWA",45,0)
 .....Q:^TMP("PSJ",$J,PSBX,0)=-1  ; No Orders
"RTN","PSBOWA",46,0)
 .....D CLEAN^PSBVT
"RTN","PSBOWA",47,0)
 .....D PSJ^PSBVT(PSBX)
"RTN","PSBOWA",48,0)
 .....Q:PSBSCHT'="C"  ; Not a Continuous
"RTN","PSBOWA",49,0)
 .....Q:PSBOSTS'="A"&(PSBOSTS'="R")&(PSBOSTS'="O")  ; Active? - PSB*3*56 adds on call as an active status
"RTN","PSBOWA",50,0)
 .....Q:PSBSM=1  ;Self med?
"RTN","PSBOWA",51,0)
 .....S (PSBCADM,PSBYES,PSBODD)=0
"RTN","PSBOWA",52,0)
 .....S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBOWA",53,0)
 .....S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBOWA",54,0)
 .....F I=1:1 Q:$P(PSBSCH,"-",I)=""  I ($P(PSBSCH,"-",I)?2N)!($P(PSBSCH,"-",I)?4N) S PSBYES=1
"RTN","PSBOWA",55,0)
 .....I PSBYES,PSBADST="",PSBSCHT'="O",PSBSCHT'="OC",PSBSCHT'="P" D  Q
"RTN","PSBOWA",56,0)
 ......D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH)
"RTN","PSBOWA",57,0)
 .....I "PCS"'[PSBIVT,PSBONX'["U" Q
"RTN","PSBOWA",58,0)
 .....I PSBIVT["S",PSBISYR'=1 Q  ;    allow intermittent syringe only
"RTN","PSBOWA",59,0)
 .....I PSBIVT["C",PSBCHEMT'="P",PSBISYR'=1 Q
"RTN","PSBOWA",60,0)
 .....I PSBIVT["C",PSBCHEMT="A" Q  ;     allow Chemo with intermittent syringe or Piggyback type only
"RTN","PSBOWA",61,0)
 .....I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBOWA",62,0)
 .....I 'PSBYES,PSBFREQ<1 D  Q
"RTN","PSBOWA",63,0)
 ......D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH)
"RTN","PSBOWA",64,0)
 .....I +PSBFREQ>0 D
"RTN","PSBOWA",65,0)
 ......I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBOWA",66,0)
 .....I PSBODD,PSBADST'="" D  Q
"RTN","PSBOWA",67,0)
 ......D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Administration Times on ODD SCHEDULE",PSBSCH)
"RTN","PSBOWA",68,0)
 .....K ^TMP("PSB",$J,"GETADMIN")
"RTN","PSBOWA",69,0)
 .....I PSBADST="" S PSBADST=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBRPDT) S:PSBADST'="" PSBCADM=1
"RTN","PSBOWA",70,0)
 .....E  S ^TMP("PSB",$J,"GETADMIN",0)=PSBADST
"RTN","PSBOWA",71,0)
 .....Q:PSBADST=""
"RTN","PSBOWA",72,0)
 .....I PSBONX'["V" D  Q:'$$OKAY^PSBVDLU1(PSBOST,PSBRPDT,PSBSCH,PSBONX,PSBOIT,PSBFREQ)           ;[*70-1480]
"RTN","PSBOWA",73,0)
 .....I PSBONX["V",PSBSCH'=""  Q:'$$OKAY^PSBVDLU1(PSBOST,PSBRPDT,PSBSCH,PSBONX,PSBOIT,PSBFREQ)   ;[*70-1480]
"RTN","PSBOWA",74,0)
 .....F PSBXX=0:1 Q:'$D(^TMP("PSB",$J,"GETADMIN",PSBXX))  S PSBADST=$G(^TMP("PSB",$J,"GETADMIN",PSBXX)) D
"RTN","PSBOWA",75,0)
 ......F Y=1:1:$L(PSBADST,"-") S Z=+("."_$E($P(PSBADST,"-",Y),1,2)) D
"RTN","PSBOWA",76,0)
 .......Q:(($P(PSBRPT(.1),U,6)+Z)<$E(PSBOST,1,12))&($G(Z)'=0)  ;Start Date
"RTN","PSBOWA",77,0)
 .......Q:($P(PSBRPT(.1),U,6)+Z)'<$E(PSBOSP,1,12)  ;Stop Date
"RTN","PSBOWA",78,0)
 .......;For invalid admin times
"RTN","PSBOWA",79,0)
 .......D:($P(PSBADST,"-",Y)'?2N)&($P(PSBADST,"-",Y)'?4N)
"RTN","PSBOWA",80,0)
 ........D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid Admin times",PSBSCH)
"RTN","PSBOWA",81,0)
 .......S PSBTOT(Z)=PSBTOT(Z)+1
"RTN","PSBOWA",82,0)
 .......S PSBGTOT(Z)=PSBGTOT(Z)+1
"RTN","PSBOWA",83,0)
 ....S PSBX="" F  S PSBX=$O(PSBTOT(PSBX)) Q:$G(PSBX)=""  W $J(PSBTOT(PSBX),4)
"RTN","PSBOWA",84,0)
 ....W !,$TR($J("",IOM)," ","-")
"RTN","PSBOWA",85,0)
 ..W !!,$TR($J("",IOM)," ","=")
"RTN","PSBOWA",86,0)
 ..W !?32 F X=0,.01:.01:.24 W $J($E(X_"00",2,3),4)
"RTN","PSBOWA",87,0)
 ..W !,"Hourly Totals:",?32
"RTN","PSBOWA",88,0)
 ..S PSBGTOT=0
"RTN","PSBOWA",89,0)
 ..S PSBX="" F  S PSBX=$O(PSBGTOT(PSBX)) Q:$G(PSBX)=""  D
"RTN","PSBOWA",90,0)
 ...W $J(PSBGTOT(PSBX),4)
"RTN","PSBOWA",91,0)
 ...S PSBGTOT=PSBGTOT+PSBGTOT(PSBX)
"RTN","PSBOWA",92,0)
 ..W !!,"Ward Total:",?32,$J(PSBGTOT,4)
"RTN","PSBOWA",93,0)
 ..W !!,$TR($J("",IOM)," ","-")
"RTN","PSBOWA",94,0)
 ..K ^TMP("PSJ",$J)
"RTN","PSBOWA",95,0)
 .;
"RTN","PSBOWA",96,0)
 .; * * *  Print By Clinic  * * *
"RTN","PSBOWA",97,0)
 .D:PSBSORT="C"
"RTN","PSBOWA",98,0)
 ..F X=0,.01:.01:.24 S PSBGTOT(PSBRPDT,X)=""   ;[*70-1480]
"RTN","PSBOWA",99,0)
 ..S PSBINDX=""
"RTN","PSBOWA",100,0)
 ..F  S PSBINDX=$O(^TMP("PSBO",$J,"B",PSBINDX)) Q:PSBINDX=""  D
"RTN","PSBOWA",101,0)
 ...F DFN=0:0 S DFN=$O(^TMP("PSBO",$J,"B",PSBINDX,DFN)) Q:'DFN  D
"RTN","PSBOWA",102,0)
 ....K ^TMP("PSJ",$J)
"RTN","PSBOWA",103,0)
 ....D EN^PSJBCMA(DFN,$P(PSBRPT(.1),U,6))
"RTN","PSBOWA",104,0)
 ....;Filter in/out Clinic Orders               *70
"RTN","PSBOWA",105,0)
 ....D:PSBCLINORD
"RTN","PSBOWA",106,0)
 ..... I $D(PSBRPT(2)) D FILTERCO^PSBO Q
"RTN","PSBOWA",107,0)
 ..... D INCLUDCO^PSBVDLU1
"RTN","PSBOWA",108,0)
 ....F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:'PSBX  D             ;[*70-1480]
"RTN","PSBOWA",109,0)
 .....S PSBCL=$P($G(^TMP("PSJ",$J,PSBX,0)),U,11)                      ;[*70-1480]
"RTN","PSBOWA",110,0)
 .....I PSBCL]"" F X=0,.01:.01:.24 S PSBTOT(PSBRPDT,DFN,PSBCL,X)=""   ;[*70-1480]
"RTN","PSBOWA",111,0)
 ....F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:'PSBX  D
"RTN","PSBOWA",112,0)
 .....S PSBCL=$P($G(^TMP("PSJ",$J,PSBX,0)),U,11)                      ;[*70-1480]
"RTN","PSBOWA",113,0)
 .....Q:^TMP("PSJ",$J,PSBX,0)=-1  ; No Orders
"RTN","PSBOWA",114,0)
 .....D CLEAN^PSBVT
"RTN","PSBOWA",115,0)
 .....D PSJ^PSBVT(PSBX)
"RTN","PSBOWA",116,0)
 .....Q:PSBSCHT'="C"  ; Not a Continuous
"RTN","PSBOWA",117,0)
 .....Q:PSBOSTS'="A"&(PSBOSTS'="R")&(PSBOSTS'="O")  ; Active? - PSB*3*56 adds on call as an active status
"RTN","PSBOWA",118,0)
 .....Q:PSBSM=1  ;Self med?
"RTN","PSBOWA",119,0)
 .....S (PSBCADM,PSBYES,PSBODD)=0
"RTN","PSBOWA",120,0)
 .....S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBOWA",121,0)
 .....S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBOWA",122,0)
 .....F I=1:1 Q:$P(PSBSCH,"-",I)=""  I ($P(PSBSCH,"-",I)?2N)!($P(PSBSCH,"-",I)?4N) S PSBYES=1
"RTN","PSBOWA",123,0)
 .....I PSBYES,PSBADST="",PSBSCHT'="O",PSBSCHT'="OC",PSBSCHT'="P" D  Q
"RTN","PSBOWA",124,0)
 ......D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH)
"RTN","PSBOWA",125,0)
 .....I "PCS"'[PSBIVT,PSBONX'["U" Q
"RTN","PSBOWA",126,0)
 .....I PSBIVT["S",PSBISYR'=1 Q  ;    allow intermittent syringe only
"RTN","PSBOWA",127,0)
 .....I PSBIVT["C",PSBCHEMT'="P",PSBISYR'=1 Q
"RTN","PSBOWA",128,0)
 .....I PSBIVT["C",PSBCHEMT="A" Q  ;     allow Chemo with intermittent syringe or Piggyback type only
"RTN","PSBOWA",129,0)
 .....I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBOWA",130,0)
 .....I 'PSBYES,PSBFREQ<1 D  Q
"RTN","PSBOWA",131,0)
 ......D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH)
"RTN","PSBOWA",132,0)
 .....I +PSBFREQ>0 D
"RTN","PSBOWA",133,0)
 ......I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBOWA",134,0)
 .....I PSBODD,PSBADST'="" D  Q
"RTN","PSBOWA",135,0)
 ......D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Administration Times on ODD SCHEDULE",PSBSCH)
"RTN","PSBOWA",136,0)
 .....K ^TMP("PSB",$J,"GETADMIN")
"RTN","PSBOWA",137,0)
 .....I PSBADST="" S PSBADST=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBRPDT) S:PSBADST'="" PSBCADM=1
"RTN","PSBOWA",138,0)
 .....E  S ^TMP("PSB",$J,"GETADMIN",0)=PSBADST
"RTN","PSBOWA",139,0)
 .....Q:PSBADST=""
"RTN","PSBOWA",140,0)
 .....I PSBONX'["V" D  Q:'$$OKAY^PSBVDLU1(PSBOST,PSBRPDT,PSBSCH,PSBONX,PSBOIT,PSBFREQ)           ;[*70-1480]
"RTN","PSBOWA",141,0)
 .....I PSBONX["V",PSBSCH'=""  Q:'$$OKAY^PSBVDLU1(PSBOST,PSBRPDT,PSBSCH,PSBONX,PSBOIT,PSBFREQ)   ;[*70-1480]
"RTN","PSBOWA",142,0)
 .....F PSBXX=0:1 Q:'$D(^TMP("PSB",$J,"GETADMIN",PSBXX))  S PSBADST=$G(^TMP("PSB",$J,"GETADMIN",PSBXX)) D
"RTN","PSBOWA",143,0)
 ......F Y=1:1:$L(PSBADST,"-") S Z=+("."_$E($P(PSBADST,"-",Y),1,2)) D
"RTN","PSBOWA",144,0)
 .......Q:((PSBRPDT)<$E(PSBOST,1,12))&($G(Z)'=0)  ;Start Date                                    ;[*70-1480]
"RTN","PSBOWA",145,0)
 .......Q:(PSBRPDT)'<$E(PSBOSP,1,12)              ;Stop Date                                     ;[*70-1480]
"RTN","PSBOWA",146,0)
 .......;For invalid admin times
"RTN","PSBOWA",147,0)
 .......D:($P(PSBADST,"-",Y)'?2N)&($P(PSBADST,"-",Y)'?4N)
"RTN","PSBOWA",148,0)
 ........D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid Admin times",PSBSCH)
"RTN","PSBOWA",149,0)
 .......S PSBTOT(PSBRPDT,DFN,PSBCL,Z)=PSBTOT(PSBRPDT,DFN,PSBCL,Z)+1                              ;[*70-1480]
"RTN","PSBOWA",150,0)
 .......S PSBGTOT(PSBRPDT,Z)=PSBGTOT(PSBRPDT,Z)+1                                                ;[*70-1480]
"RTN","PSBOWA",151,0)
 ..K ^TMP("PSJ",$J)
"RTN","PSBOWA",152,0)
 .;
"RTN","PSBOWA",153,0)
 .; * * *  Print By Patient  * * *
"RTN","PSBOWA",154,0)
 .D:PSBSORT="P"
"RTN","PSBOWA",155,0)
 ..S DFN=PSBDFN
"RTN","PSBOWA",156,0)
 ..S PSBHDR(1)="WARD ADMINISTRATION TIMES"
"RTN","PSBOWA",157,0)
 ..S Y=$P(PSBRPT(.1),U,6) D D^DIQ S PSBHDR(2)="ADMINISTRATION DATE: "_Y
"RTN","PSBOWA",158,0)
 ..S Y=PSBEVDT2 D D^DIQ S PSBHDR(2)=PSBHDR(2)_" to "_Y
"RTN","PSBOWA",159,0)
 ..W $$PTHDR()
"RTN","PSBOWA",160,0)
 ..K ^TMP("PSJ",$J),PSBTOT
"RTN","PSBOWA",161,0)
 ..D EN^PSJBCMA(PSBDFN,PSBRPDT,"")
"RTN","PSBOWA",162,0)
 ..D:PSBCLINORD                                     ;*70 filer clinics
"RTN","PSBOWA",163,0)
 ... I $D(PSBRPT(2)) D FILTERCO^PSBO Q
"RTN","PSBOWA",164,0)
 ... D INCLUDCO^PSBVDLU1
"RTN","PSBOWA",165,0)
 ..I 'PSBCLINORD D REMOVECO^PSBVDLU1                ;*70
"RTN","PSBOWA",166,0)
 ..F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:'PSBX  D
"RTN","PSBOWA",167,0)
 ...Q:^TMP("PSJ",$J,PSBX,0)=-1  ; No Orders
"RTN","PSBOWA",168,0)
 ...D CLEAN^PSBVT
"RTN","PSBOWA",169,0)
 ...D PSJ^PSBVT(PSBX)
"RTN","PSBOWA",170,0)
 ...Q:PSBSCHT'="C"  ; Not a Continuous
"RTN","PSBOWA",171,0)
 ...Q:PSBOSTS'="A"&(PSBOSTS'="R")&(PSBOSTS'="O")  ; Active? - PSB*3*56 adds on call as an active status
"RTN","PSBOWA",172,0)
 ...S (PSBCADM,PSBYES,PSBODD)=0
"RTN","PSBOWA",173,0)
 ...S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBOWA",174,0)
 ...S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBOWA",175,0)
 ...F I=1:1 Q:$P(PSBSCH,"-",I)=""  I ($P(PSBSCH,"-",I)?2N)!($P(PSBSCH,"-",I)?4N) S PSBYES=1
"RTN","PSBOWA",176,0)
 ...I PSBYES,PSBADST="",PSBSCHT'="O",PSBSCHT'="OC",PSBSCHT'="P" D  Q
"RTN","PSBOWA",177,0)
 ....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH)
"RTN","PSBOWA",178,0)
 ...I "PCS"'[PSBIVT,PSBONX'["U" Q
"RTN","PSBOWA",179,0)
 ...I PSBIVT["S",PSBISYR'=1 Q  ;    allow intermittent syringe only
"RTN","PSBOWA",180,0)
 ...I PSBIVT["C",PSBCHEMT'="P",PSBISYR'=1 Q
"RTN","PSBOWA",181,0)
 ...I PSBIVT["C",PSBCHEMT="A" Q  ;     allow Chemo with intermittent syringe or Piggyback type only
"RTN","PSBOWA",182,0)
 ...I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBOWA",183,0)
 ...I 'PSBYES,PSBFREQ<1 D  Q
"RTN","PSBOWA",184,0)
 ....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH)
"RTN","PSBOWA",185,0)
 ...I +PSBFREQ>0 D
"RTN","PSBOWA",186,0)
 ....I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBOWA",187,0)
 ...I PSBODD,PSBADST'="" D  Q
"RTN","PSBOWA",188,0)
 ....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Administration Times on ODD SCHEDULE",PSBSCH)
"RTN","PSBOWA",189,0)
 ...K ^TMP("PSB",$J,"GETADMIN")
"RTN","PSBOWA",190,0)
 ...I PSBADST="",+$G(PSBFREQ)>0,$G(PSBFREQ)<30 S PSBADST="MESSAGE",$P(PSBTOT(PSBADST,PSBOITX,PSBONX),2)="Due every "_PSBFREQ_" Mins" Q
"RTN","PSBOWA",191,0)
 ...I PSBADST="",+$G(PSBFREQ)'<30 S PSBADST=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBRPDT) S:PSBADST'="" PSBCADM=1
"RTN","PSBOWA",192,0)
 ...E  S ^TMP("PSB",$J,"GETADMIN",0)=PSBADST
"RTN","PSBOWA",193,0)
 ...Q:PSBADST=""
"RTN","PSBOWA",194,0)
 ...I PSBONX'["V" D  Q:'$$OKAY^PSBVDLU1(PSBOST,PSBRPDT,PSBSCH,PSBONX,PSBOIT,PSBFREQ)
"RTN","PSBOWA",195,0)
 ...I PSBONX["V",PSBSCH'=""  Q:'$$OKAY^PSBVDLU1(PSBOST,PSBRPDT,PSBSCH,PSBONX,PSBOIT,PSBFREQ)
"RTN","PSBOWA",196,0)
 ...F PSBXX=0:1 Q:'$D(^TMP("PSB",$J,"GETADMIN",PSBXX))  S PSBADST=$G(^TMP("PSB",$J,"GETADMIN",PSBXX)) D
"RTN","PSBOWA",197,0)
 ....F Y=1:1:$L(PSBADST,"-") S Z=+("."_$P(PSBADST,"-",Y)) D
"RTN","PSBOWA",198,0)
 .....Q:(PSBRPDT+Z)<$E(PSBOST,1,12)  ; Start Date
"RTN","PSBOWA",199,0)
 .....Q:(PSBRPDT+Z)'<$E(PSBOSP,1,12)  ; Stop Date
"RTN","PSBOWA",200,0)
 .....;For Invalid admin times
"RTN","PSBOWA",201,0)
 .....D:($P(PSBADST,"-",Y)'?2N)&($P(PSBADST,"-",Y)'?4N)
"RTN","PSBOWA",202,0)
 ......D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid Admin times",PSBSCH)
"RTN","PSBOWA",203,0)
 .....S PSBSM=$S(PSBHSM=1:"HSM",PSBSM=1:"SM",1:"")
"RTN","PSBOWA",204,0)
 .....;*** Local array to include order no
"RTN","PSBOWA",205,0)
 .....S PSBTOT(Z,PSBOITX,PSBONX)=PSBSM_U_"Dosage: "_PSBDOSE_"  Route: "_PSBMR_"  "_PSBIFR_U_PSBCLORD         ;add clinic name  *70
"RTN","PSBOWA",206,0)
 ..S PSBX="" F  S PSBX=$O(PSBTOT(PSBX)) Q:PSBX=""  D
"RTN","PSBOWA",207,0)
 ...W !
"RTN","PSBOWA",208,0)
 ...S PSBY="" F  S PSBY=$O(PSBTOT(PSBX,PSBY)) Q:PSBY=""  D
"RTN","PSBOWA",209,0)
 ....S PSBZ="" F  S PSBZ=$O(PSBTOT(PSBX,PSBY,PSBZ)) Q:PSBZ=""  D
"RTN","PSBOWA",210,0)
 .....W:$Y>(IOSL-6) $$PTFTR^PSBOHDR(),$$PTHDR()
"RTN","PSBOWA",211,0)
 .....I PSBX="MESSAGE" W !,$P(PSBTOT(PSBX,PSBY,PSBZ),U,1),?20,PSBY Q
"RTN","PSBOWA",212,0)
 .....W:PSBCLINORD !,$P(PSBTOT(PSBX,PSBY,PSBZ),U,3)
"RTN","PSBOWA",213,0)
 .....W !,$$TIMEOUT^PSBUTL(PSBX),?10
"RTN","PSBOWA",214,0)
 .....W $P(PSBTOT(PSBX,PSBY,PSBZ),U,1),?20,PSBY,?55,$P(PSBTOT(PSBX,PSBY,PSBZ),U,2)
"RTN","PSBOWA",215,0)
 .....;;;W:PSBCLINORD ?103,$P(PSBTOT(PSBX,PSBY,PSBZ),U,3)
"RTN","PSBOWA",216,0)
 .....;W !
"RTN","PSBOWA",217,0)
 ..W $$PTFTR^PSBOHDR()
"RTN","PSBOWA",218,0)
 .K ^TMP("PSJ",$J),^TMP("PSB",$J)
"RTN","PSBOWA",219,0)
 .Q
"RTN","PSBOWA",220,0)
 ;
"RTN","PSBOWA",221,0)
 ;   Start...;[*70-1480]
"RTN","PSBOWA",222,0)
 I PSBSORT="C",$D(PSBTOT) D
"RTN","PSBOWA",223,0)
 .S PSBRPDT="" F  S PSBRPDT=$O(PSBTOT(PSBRPDT)) Q:PSBRPDT=""  D
"RTN","PSBOWA",224,0)
 ..W $$CLNHDR()
"RTN","PSBOWA",225,0)
 ..S DFN="" F  S DFN=$O(PSBTOT(PSBRPDT,DFN)) Q:DFN=""  D
"RTN","PSBOWA",226,0)
 ...W:$Y>(IOSL-10) $$CLNHDR()
"RTN","PSBOWA",227,0)
 ...W !,$P(^DPT(DFN,0),U),!,$P(^(0),U,9)
"RTN","PSBOWA",228,0)
 ...S PSBCL="" F  S PSBCL=$O(PSBTOT(PSBRPDT,DFN,PSBCL)) Q:PSBCL=""  D
"RTN","PSBOWA",229,0)
 ....W:$Y>(IOSL-10) $$CLNHDR()
"RTN","PSBOWA",230,0)
 ....W !,PSBCL,?32
"RTN","PSBOWA",231,0)
 ....S PSBX=""  F  S PSBX=$O(PSBTOT(PSBRPDT,DFN,PSBCL,PSBX)) Q:PSBX=""  D
"RTN","PSBOWA",232,0)
 .....W:$Y>(IOSL-10) $$CLNHDR()
"RTN","PSBOWA",233,0)
 .....W $J(PSBTOT(PSBRPDT,DFN,PSBCL,PSBX),4)
"RTN","PSBOWA",234,0)
 ...W !,$TR($J("",IOM)," ","-")
"RTN","PSBOWA",235,0)
 ..W !!,$TR($J("",IOM)," ","=")
"RTN","PSBOWA",236,0)
 ..W !?32 F X=0,.01:.01:.24 W $J($E(X_"00",2,3),4)
"RTN","PSBOWA",237,0)
 ..W !,"Hourly Totals:",?32
"RTN","PSBOWA",238,0)
 ..S PSBGTOT=0
"RTN","PSBOWA",239,0)
 ..S PSBX="" F  S PSBX=$O(PSBGTOT(PSBRPDT,PSBX)) Q:$G(PSBX)=""  D
"RTN","PSBOWA",240,0)
 ...W $J(PSBGTOT(PSBRPDT,PSBX),4)
"RTN","PSBOWA",241,0)
 ...S PSBGTOT=PSBGTOT+PSBGTOT(PSBRPDT,PSBX)
"RTN","PSBOWA",242,0)
 ..W !!,"Report Date Total:",?32,$J(PSBGTOT,4)
"RTN","PSBOWA",243,0)
 ..W !!,$TR($J("",IOM)," ","-")
"RTN","PSBOWA",244,0)
 ;   End...;[*70-1480]
"RTN","PSBOWA",245,0)
 ;
"RTN","PSBOWA",246,0)
WRDHDR() ;
"RTN","PSBOWA",247,0)
 S PSBHDR(1)="WARD ADMINISTRATION TIMES"
"RTN","PSBOWA",248,0)
 D WARD^PSBOHDR(PSBWRD,.PSBHDR,,,PSBSRCHL)
"RTN","PSBOWA",249,0)
 S Y=PSBRPDT D D^DIQ
"RTN","PSBOWA",250,0)
 W !,"Patient Name",?64,Y_" Administration Times"
"RTN","PSBOWA",251,0)
 W !,"Room-Bed",?32
"RTN","PSBOWA",252,0)
 F X=0,.01:.01:.24 W $J($E(X_"00",2,3),4)
"RTN","PSBOWA",253,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBOWA",254,0)
 Q ""
"RTN","PSBOWA",255,0)
 ;
"RTN","PSBOWA",256,0)
CLNHDR() ;
"RTN","PSBOWA",257,0)
 S PSBHDR(1)="CLINIC ADMINISTRATION TIMES"
"RTN","PSBOWA",258,0)
 D CLINIC^PSBOHDR(.PSBRPT,.PSBHDR,,,PSBSRCHL)
"RTN","PSBOWA",259,0)
 ;
"RTN","PSBOWA",260,0)
 S Y=PSBRPDT D D^DIQ
"RTN","PSBOWA",261,0)
 W !,"Patient Name",?64,Y_" Administration Times"
"RTN","PSBOWA",262,0)
 W !,"SSN",!,"Location",?32                       ;[*70-1480]
"RTN","PSBOWA",263,0)
 F X=0,.01:.01:.24 W $J($E(X_"00",2,3),4)
"RTN","PSBOWA",264,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBOWA",265,0)
 Q ""
"RTN","PSBOWA",266,0)
 ;
"RTN","PSBOWA",267,0)
PTHDR() ;
"RTN","PSBOWA",268,0)
 S PSBHDR(1)="PATIENT ADMINISTRATION TIMES"
"RTN","PSBOWA",269,0)
 D PT^PSBOHDR(PSBDFN,.PSBHDR,,,PSBSRCHL)
"RTN","PSBOWA",270,0)
 W:PSBCLINORD !,"Location"
"RTN","PSBOWA",271,0)
 W !,"Date/Time",?10,"Self Med",?20,"Medication",?55,"Dose/Route"
"RTN","PSBOWA",272,0)
 ;;;W:PSBCLINORD ?103,"Location"
"RTN","PSBOWA",273,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBOWA",274,0)
 S Y=PSBRPDT D D^DIQ
"RTN","PSBOWA",275,0)
 W !!,Y,!
"RTN","PSBOWA",276,0)
 Q ""
"RTN","PSBPOIV")
0^48^B73419949^B65823843
"RTN","PSBPOIV",1,0)
PSBPOIV ;BIRMINGHAM/EFC-IV PARAMETER VALIDATION ;12/7/12 3:39pm
"RTN","PSBPOIV",2,0)
 ;;3.0;BAR CODE MED ADMIN;**2,66,70**;Mar 2004;Build 101
"RTN","PSBPOIV",3,0)
 ;;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBPOIV",4,0)
 ;
"RTN","PSBPOIV",5,0)
 ; Reference/IA
"RTN","PSBPOIV",6,0)
 ; ^DIC(42/2440
"RTN","PSBPOIV",7,0)
 ; EN^PSJBCMA2/2830
"RTN","PSBPOIV",8,0)
 ; VADPT/10061
"RTN","PSBPOIV",9,0)
 ; $$GET^XPAR/2263
"RTN","PSBPOIV",10,0)
 ;
"RTN","PSBPOIV",11,0)
 ;*70 - Change the way IV Bag parameters are retrieved slightly.
"RTN","PSBPOIV",12,0)
 ;      If patient is admitted use the Ward to find DIVision IV params
"RTN","PSBPOIV",13,0)
 ;      If not admitted find DIV associated with the Clinic order and
"RTN","PSBPOIV",14,0)
 ;       get that DIV IV params.  Else use logged in User's DIV.
"RTN","PSBPOIV",15,0)
 ;
"RTN","PSBPOIV",16,0)
EN(PSBDFN,PSBORD) ;
"RTN","PSBPOIV",17,0)
 ;
"RTN","PSBPOIV",18,0)
 S DFN=PSBDFN,(PSBMI,PSBMW,PSBMWC,PSBMAUD)=0,(PSBMIDT,PSBMIM)="",PSBONXS=PSBORD_"^"
"RTN","PSBPOIV",19,0)
 K ^TMP("PSBAR",$J) S ^TMP("PSBAR",$J,"W",0)=0
"RTN","PSBPOIV",20,0)
 D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBORD,1)
"RTN","PSBPOIV",21,0)
 ; get IV parameters for the current ward
"RTN","PSBPOIV",22,0)
 S PSBCSTR="^ADDITIVE^STRENGTH^BOTTLE^SOLUTION^VOLUME^INFUSION RATE^MED ROUTE^SCHEDULE^ADMIN TIME^REMARKS^OTHER PRINT INFO^PROVIDER^START DATE/TIME^STOP DATE/TIME^PROVIDER COMMENTS"
"RTN","PSBPOIV",23,0)
 D INP^VADPT S PSBWARD=$P(VAIN(4),"^"),PSBWDIV=PSBWARD D KVAR^VADPT
"RTN","PSBPOIV",24,0)
 I $G(PSBWARD)'="",$D(^PSB(53.66,"B",PSBWARD)) D  ; if IV paramaters defined for ward use them
"RTN","PSBPOIV",25,0)
 .S PSBWARD=$O(^PSB(53.66,"B",PSBWARD,""))
"RTN","PSBPOIV",26,0)
 .S:$D(^PSB(53.66,PSBWARD,1,"B",PSBIVT)) PSBIVPAR=^PSB(53.66,PSBWARD,1,$O(^PSB(53.66,PSBWARD,1,"B",PSBIVT,""),-1),0)
"RTN","PSBPOIV",27,0)
 N PSBFLAG,PSBDFLT,PSBORLOC
"RTN","PSBPOIV",28,0)
 I ($G(PSBCLORD)]"") D
"RTN","PSBPOIV",29,0)
 .N DIC,X,Y S DIC="^SC(",DIC(0)="XZ" S X=PSBCLORD D ^DIC S:(Y>0) PSBORLOC=+Y
"RTN","PSBPOIV",30,0)
 ;
"RTN","PSBPOIV",31,0)
 ; If IV parameters not defined for Ward or Clinic, then get defaults for division
"RTN","PSBPOIV",32,0)
 I '$D(PSBIVPAR) S PSBIVPAR=PSBIVT D
"RTN","PSBPOIV",33,0)
 .D:$D(PSBWDIV)!$G(PSBORLOC)    ;Get the appropriate DIV for Ward or Clinic and DIVISIONAL IV PARAMETERS 
"RTN","PSBPOIV",34,0)
 ..S PSBWDIV=$$GET1^DIQ(42,PSBWDIV_",",.015,"I")                                 ;Ward DIV  *70
"RTN","PSBPOIV",35,0)
 ..I '$G(PSBWARD),$G(PSBORLOC) S PSBWDIV=$$GET1^DIQ(44,PSBORLOC_",",3.5,"I")     ;Clinic DIV  *70
"RTN","PSBPOIV",36,0)
 ..I $G(PSBWDIV)']"" S PSBWDIV="DIV"
"RTN","PSBPOIV",37,0)
 ..E  S PSBWDIV=$P($$SITE^VASITE(DT,PSBWDIV),U,1),PSBWDIV="DIV.`"_PSBWDIV
"RTN","PSBPOIV",38,0)
 ..S PSBDFLT="^I^I^I^I^I^W^I^I^I^I^W^I^I^I^I"      ;Set default IV Bag Parameters variable
"RTN","PSBPOIV",39,0)
 ..F X=2:1 Q:$P(PSBCSTR,U,X)=""  S PSBIVPAR=PSBIVPAR_U_$P($P($$GET^XPAR(PSBWDIV,"PSBIV "_$P(PSBCSTR,U,X),PSBIVT,"B"),U,2),"-",1) I $P(PSBIVPAR,U,X)="" D  ;If null, set default - PSB*3*66
"RTN","PSBPOIV",40,0)
 ...S $P(PSBIVPAR,U,X)=$P(PSBDFLT,U,X),PSBFLAG=""  ;If null, set default - PSB*3*66
"RTN","PSBPOIV",41,0)
 ..K PSBWDIV ; Kill temp variable.
"RTN","PSBPOIV",42,0)
 ;
"RTN","PSBPOIV",43,0)
 F PSBC1=1:1 Q:$P(PSBONXS,U,PSBC1)=""  D  ; process all orders
"RTN","PSBPOIV",44,0)
 .D CLEAN^PSBVT,PSJ1^PSBVT(DFN,$P(PSBONXS,U,PSBC1),1)
"RTN","PSBPOIV",45,0)
 .K PSBPONX2 I $G(PSBPONX)]"",$G(PSBPONX)["P" S PSBPONX2=PSBPONX D  ; Must compare "active" orders for changes made - look beyond "pendings"
"RTN","PSBPOIV",46,0)
 ..F  D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBPONX2,1) S PSBPONX2=PSBPONX Q:(PSBPONX2="")!(PSBPONX2'["P")  ;
"RTN","PSBPOIV",47,0)
 ..D CLEAN^PSBVT,PSJ1^PSBVT(DFN,$P(PSBONXS,U,PSBC1),1)  ; Refresh data
"RTN","PSBPOIV",48,0)
 ..S:$D(PSBPONX2) PSBPONX=PSBPONX2 K PSBPONX2
"RTN","PSBPOIV",49,0)
 .Q:($L(U_PSBONXS,U_PSBPONX_U)-1)>0
"RTN","PSBPOIV",50,0)
 .I $G(PSBPONX)]"" S PSBONXS=PSBONXS_PSBPONX_U
"RTN","PSBPOIV",51,0)
 .K ^TMP("PSJ2",$J) S PSBMAUD=0 D EN^PSJBCMA2(PSBDFN,PSBONX,1)  ; check IV parameters against activity log for this order when no "I"nvalid message
"RTN","PSBPOIV",52,0)
 .I PSBMI=0 F X=1:1 Q:'$D(^TMP("PSJ2",$J,X))  S PSBCHKV=U_$P(^TMP("PSJ2",$J,X,1),U,3)_U I PSBCSTR[PSBCHKV D MSG(PSBCHKV,$P(^TMP("PSJ2",$J,X,1),U,1)) S PSBMAUD=1
"RTN","PSBPOIV",53,0)
 .K ^TMP("PSJ2",$J)
"RTN","PSBPOIV",54,0)
 .I PSBMI=0,$G(PSBPONX)]"" D SAVEPAR,CHKORD  ; check IV parameters against previous order when no "I"nvalid message
"RTN","PSBPOIV",55,0)
 .D CLEAN^PSBVT,PSJ1^PSBVT(DFN,$P(PSBONXS,U,PSBC1),1)  ; restore variable for this order
"RTN","PSBPOIV",56,0)
 .; okay - we have invalids and warnings through this order so process bags for this order
"RTN","PSBPOIV",57,0)
 .I '$D(PSBUIDA) Q  ; got errors and warning but no bags printed for this order - go to the next
"RTN","PSBPOIV",58,0)
 .S PSBUID="" F  S PSBUID=$O(PSBUIDA(PSBUID),-1) Q:PSBUID=""  D
"RTN","PSBPOIV",59,0)
 ..F PSBC2=1:1 S PSBMONX=$P(PSBONXS,U,PSBC2) Q:PSBMONX=""  D  ; check if bag is in 53.79
"RTN","PSBPOIV",60,0)
 ...I $D(^PSB(53.79,"AUID",PSBDFN,PSBMONX,PSBUID)) D
"RTN","PSBPOIV",61,0)
 ....S PSBIEN=$O(^PSB(53.79,"AUID",PSBDFN,PSBMONX,PSBUID,""))
"RTN","PSBPOIV",62,0)
 ....S PSBPDT=$P(PSBLBLA(PSBUID),U,1),PSBLSTS=$P(PSBLBLA(PSBUID),3)
"RTN","PSBPOIV",63,0)
 ....S $P(X,U,2)=$P(^PSB(53.79,PSBIEN,0),U,9)  ; add action status
"RTN","PSBPOIV",64,0)
 ....S $P(X,U,3)=$P(^PSB(53.79,PSBIEN,0),U,6)  ; add action date/time
"RTN","PSBPOIV",65,0)
 ....S $P(X,U,4)=$P(^PSB(53.79,PSBIEN,.1),U,1)  ; add order ID was administered for
"RTN","PSBPOIV",66,0)
 ..S $P(X,U,5)=PSBONX  ; add order ID was printed for
"RTN","PSBPOIV",67,0)
 ..S $P(X,U,6)=PSBOSTS  ; add order status
"RTN","PSBPOIV",68,0)
 ..S $P(X,U,7)=$P(PSBLBLA(PSBUID),U,1)  ; add date/time ID was printed
"RTN","PSBPOIV",69,0)
 ..S $P(X,U,8)=$P(PSBLBLA(PSBUID),U,3)  ; add lable status from pharmacy
"RTN","PSBPOIV",70,0)
 ..S $P(X,U,9)=""  ; 9 open for later development
"RTN","PSBPOIV",71,0)
 ..S $P(X,U,10)=PSBUIDA(PSBUID)  ; add return from PSJ1
"RTN","PSBPOIV",72,0)
 ..D BWAR
"RTN","PSBPOIV",73,0)
 ..I PSBMW=1 S PSBMWS="W;" F I=1:1:^TMP("PSBAR",$J,"W",0) D  S $P(X,U,1)=$P(PSBMWS,";",1,$L(PSBMWS,";")-1)
"RTN","PSBPOIV",74,0)
 ...I $P(PSBLBLA(PSBUID),U,1)'>$P(^TMP("PSBAR",$J,"W",I),U,2) D
"RTN","PSBPOIV",75,0)
 ....S:(PSBONX=$P(PSBONXS,U,1))&(PSBMAUD=1) PSBMWS=PSBMWS_I_";"
"RTN","PSBPOIV",76,0)
 ....S:PSBONX'=$P(PSBONXS,U,1) PSBMWS=PSBMWS_I_";"
"RTN","PSBPOIV",77,0)
 ..I PSBMIDT'="",$P(PSBLBLA(PSBUID),U,1)<PSBMIDT D
"RTN","PSBPOIV",78,0)
 ...S:(PSBONX=$P(PSBONXS,U,1))&(PSBMAUD=1) $P(X,U,1)="I"
"RTN","PSBPOIV",79,0)
 ...S:(PSBONX'=$P(PSBONXS,U,1)) $P(X,U,1)="I"
"RTN","PSBPOIV",80,0)
 ..S ^TMP("PSBAR",$J,PSBUID)=X K X
"RTN","PSBPOIV",81,0)
 D CLEAN^PSBVT
"RTN","PSBPOIV",82,0)
 K PSBC1,PSBC2,PSBSCHV,PSBCSTR,PSBIVPAR,PSBMI,PSBMIDT,PSBMIM,PSBMONX,PSBMW,PSBSPAR,PSBUID,PSBWARD
"RTN","PSBPOIV",83,0)
 K PSBADA,PSBSOLA,PSBOTMP
"RTN","PSBPOIV",84,0)
 I ^TMP("PSBAR",$J,"W",0)=0 K ^TMP("PSBAR",$J,"W",0)
"RTN","PSBPOIV",85,0)
 D PSJ1^PSBVT(DFN,PSBORD,1)  ; restore variables for calling order
"RTN","PSBPOIV",86,0)
 Q
"RTN","PSBPOIV",87,0)
 ;
"RTN","PSBPOIV",88,0)
SAVEPAR ; save parameters from current order
"RTN","PSBPOIV",89,0)
 K PSBOTMP
"RTN","PSBPOIV",90,0)
 I $D(PSBADA) M PSBOTMP("ADD")=PSBADA E  S PSBOTMP("ADD")=""  ; additive, strength, bottle
"RTN","PSBPOIV",91,0)
 I $D(PSBSOLA) M PSBOTMP("SOL")=PSBSOLA E  S PSBOTMP("SOL")=""  ; solution, volume,
"RTN","PSBPOIV",92,0)
 K PSBADA,PSBSOLA
"RTN","PSBPOIV",93,0)
 S PSBOTMP("INFUSION RATE")=$G(PSBIFR),PSBOTMP("MED ROUTE")=$G(PSBMR)
"RTN","PSBPOIV",94,0)
 S PSBOTMP("SCHEDULE")=$G(PSBSCH),PSBOTMP("ADMIN TIME")=$G(PSBADST)
"RTN","PSBPOIV",95,0)
 S PSBOTMP("REMARKS")=$G(PSBRMRK),PSBOTMP("OTHER PRINT INFO")=$G(PSBOTXT)
"RTN","PSBPOIV",96,0)
 S PSBOTMP("PROVIDER")=PSBMD,PSBOTMP("START DATE/TIME")=PSBOST
"RTN","PSBPOIV",97,0)
 S PSBOTMP("STOP DATE/TIME")=PSBOSP
"RTN","PSBPOIV",98,0)
 D CLEAN^PSBVT,PSJ1^PSBVT(DFN,$P(PSBONXS,U,PSBC1+1),1)  ; setup previous order variables
"RTN","PSBPOIV",99,0)
 Q
"RTN","PSBPOIV",100,0)
 ;
"RTN","PSBPOIV",101,0)
CHKORD ; check previous order against current order
"RTN","PSBPOIV",102,0)
 I $D(PSBADA)!($D(PSBOTMP("ADD"))) D CHKADD Q:PSBMI=1
"RTN","PSBPOIV",103,0)
 I $D(PSBSOLA)!($D(PSBOTMP("SOL"))) D CHKSOL Q:PSBMI=1
"RTN","PSBPOIV",104,0)
 I PSBIFR'=PSBOTMP("INFUSION RATE") D MSG("INFUSION RATE",PSBOSP) Q:PSBMI=1
"RTN","PSBPOIV",105,0)
 I PSBMR'=PSBOTMP("MED ROUTE") D MSG("MED ROUTE",PSBOSP) Q:PSBMI=1
"RTN","PSBPOIV",106,0)
 I PSBSCH'=PSBOTMP("SCHEDULE") D MSG("SCHEDULE",PSBOSP) Q:PSBMI=1
"RTN","PSBPOIV",107,0)
 I PSBADST'=PSBOTMP("ADMIN TIME") D MSG("ADMIN TIME",PSBOSP) Q:PSBMI=1
"RTN","PSBPOIV",108,0)
 I PSBRMRK'=PSBOTMP("REMARKS") D MSG("REMARKS",PSBOSP) Q:PSBMI=1
"RTN","PSBPOIV",109,0)
 I PSBOTXT'=PSBOTMP("OTHER PRINT INFO") D MSG("OTHER PRINT INFO",PSBOSP) Q:PSBMI=1
"RTN","PSBPOIV",110,0)
 I PSBMD'=PSBOTMP("PROVIDER") D MSG("PROVIDER",PSBOSP) Q:PSBMI=1
"RTN","PSBPOIV",111,0)
 I PSBOTMP("START DATE/TIME")<$$FMADD^XLFDT(PSBOST,,,-1)!(PSBOTMP("START DATE/TIME")>$$FMADD^XLFDT(PSBOST,,,1)) D MSG("START DATE/TIME",PSBOSP) Q:PSBMI=1
"RTN","PSBPOIV",112,0)
 ;I $E(PSBOST,1,10)'=$E(PSBOTMP("START DATE/TIME"),1,10) D MSG("START DATE/TIME",PSBOSP) Q:PSBMI=1
"RTN","PSBPOIV",113,0)
 I $E(PSBOSP,1,10)'=$E(PSBOTMP("STOP DATE/TIME"),1,10) D MSG("STOP DATE/TIME",PSBOSP)
"RTN","PSBPOIV",114,0)
 Q
"RTN","PSBPOIV",115,0)
CHKADD ;
"RTN","PSBPOIV",116,0)
 N X,Y
"RTN","PSBPOIV",117,0)
 I '$D(PSBADA),'$D(PSBOTMP("ADD")) Q  ; no additives
"RTN","PSBPOIV",118,0)
 I $O(PSBADA(""),-1)>$O(PSBOTMP("ADD",""),-1) D MSG("ADDITIVE",PSBOSP) Q  ;previous order has addtives not in current order
"RTN","PSBPOIV",119,0)
 I $O(PSBADA(""),-1)<$O(PSBOTMP("ADD",""),-1) D MSG("ADDITIVE",PSBOSP) Q  ;previous order missing additives in current order
"RTN","PSBPOIV",120,0)
 S X="" F  S X=$O(PSBADA(X)) Q:X=""  D  Q  ; check that additives, strength, and bottle are the same
"RTN","PSBPOIV",121,0)
 .I PSBADA(X)=PSBOTMP("ADD",X) Q  ; everything the same
"RTN","PSBPOIV",122,0)
 .I $P(PSBADA(X),U,2)'=$P(PSBOTMP("ADD",X),U,2) D MSG("ADDITIVE",PSBOSP) Q
"RTN","PSBPOIV",123,0)
 .I $P(PSBADA(X),U,4)'=$P(PSBOTMP("ADD",X),U,4) D MSG("STRENGTH",PSBOSP) Q
"RTN","PSBPOIV",124,0)
 Q
"RTN","PSBPOIV",125,0)
 ;
"RTN","PSBPOIV",126,0)
CHKSOL ;
"RTN","PSBPOIV",127,0)
 N X,Y
"RTN","PSBPOIV",128,0)
 I '$D(PSBSOLA),'$D(PSBOTMP("SOL")) Q  ; no solutions
"RTN","PSBPOIV",129,0)
 I $O(PSBSOLA(""),-1)>$O(PSBOTMP("SOL",""),-1) D MSG("SOLUTION",PSBOSP) Q  ;previous order has solutions not in current order
"RTN","PSBPOIV",130,0)
 I $O(PSBSOLA(""),-1)<$O(PSBOTMP("SOL",""),-1) D MSG("SOLUTION",PSBOSP) Q  ;previous order missing solutions in current order
"RTN","PSBPOIV",131,0)
 S X="" F  S X=$O(PSBSOLA(X)) Q:X=""  D  Q  ; check that solutions volume are the same
"RTN","PSBPOIV",132,0)
 .I PSBSOLA(X)=PSBOTMP("SOL",X) Q  ; everything the same
"RTN","PSBPOIV",133,0)
 .I $P(PSBSOLA(X),U,2)'=$P(PSBOTMP("SOL",X),U,2) D MSG("SOLUTION",PSBOSP) Q
"RTN","PSBPOIV",134,0)
 .I $P(PSBSOLA(X),U,4)'=$P(PSBOTMP("SOL",X),U,4) D MSG("VOLUME",PSBOSP) Q
"RTN","PSBPOIV",135,0)
 Q
"RTN","PSBPOIV",136,0)
 ;
"RTN","PSBPOIV",137,0)
BWAR ;
"RTN","PSBPOIV",138,0)
 N X,Y,Z,PSBONX
"RTN","PSBPOIV",139,0)
 S X=^TMP("PSBAR",$J,"W",0)+1
"RTN","PSBPOIV",140,0)
 S Z="" F Z=1:1 S PSBONX=$P(PSBONXS,U,Z) Q:$G(PSBONX)=""  D  ; Display "Warning"s for changes 
"RTN","PSBPOIV",141,0)
 .I '$D(PSBMWAR(PSBONX)) Q
"RTN","PSBPOIV",142,0)
 .S Y="" F  S Y=$O(PSBMWAR(PSBONX,Y)) Q:Y'?.N1".".N  D
"RTN","PSBPOIV",143,0)
 ..S Z="",PSBYS="" F  S Z=$O(PSBMWAR(PSBONX,Y,Z)) Q:Z=""  S PSBYS=PSBYS_Z_";"
"RTN","PSBPOIV",144,0)
 ..S PSBYS=$P(PSBYS,";",1,$L(PSBYS,";")-1)
"RTN","PSBPOIV",145,0)
 ..S ^TMP("PSBAR",$J,"W",X)=PSBONX_U_Y_U_"2^The "_PSBYS_" was changed on",^TMP("PSBAR",$J,"W",0)=X,X=X+1
"RTN","PSBPOIV",146,0)
 .K PSBMWAR(PSBONX)
"RTN","PSBPOIV",147,0)
 Q
"RTN","PSBPOIV",148,0)
 ;
"RTN","PSBPOIV",149,0)
MSG(PSBMVAR,PSBDATE) ;
"RTN","PSBPOIV",150,0)
 ;I PSBMI=1 Q  ;already have an invalid don't need anymore - Removed by Patch PSB*3*66 for multiple edits issue.
"RTN","PSBPOIV",151,0)
 F Y=1:1 S PSBSPAR=$P(PSBCSTR,U,Y) I PSBSPAR=$TR(PSBMVAR,"^") D  Q
"RTN","PSBPOIV",152,0)
 .I $P(PSBIVPAR,U,Y)="W" D
"RTN","PSBPOIV",153,0)
 ..S PSBMVAR=$TR(PSBMVAR,"^")
"RTN","PSBPOIV",154,0)
 ..I PSBMW=0 S PSBMW=1
"RTN","PSBPOIV",155,0)
 ..S PSBMWC=PSBMWC+1,PSBMWM="2^The "_PSBSPAR_" has been changed."
"RTN","PSBPOIV",156,0)
 ..I $D(PSBMWAR(PSBONX,PSBMVAR)) S PSBOLDT=$O(PSBMWAR(PSBONX,PSBMVAR,"")) I PSBOLDT<$E(PSBDATE,1,12) K PSBMWAR(PSBONX,PSBMVAR,PSBOLDT)
"RTN","PSBPOIV",157,0)
 ..S PSBMWAR(PSBONX,PSBMVAR,$E(PSBDATE,1,12))=""
"RTN","PSBPOIV",158,0)
 ..S PSBMWAR(PSBONX,$E(PSBDATE,1,12),PSBMVAR)=""
"RTN","PSBPOIV",159,0)
 .I $P(PSBIVPAR,U,Y)="I" S PSBMI=1,PSBMIDT=PSBDATE,PSBMIM="-1^IV invalid "_PSBSPAR_".",^TMP("PSBAR",$J,"I")=PSBONX_U_PSBMIDT_U_PSBMIM
"RTN","PSBPOIV",160,0)
 Q
"RTN","PSBPRN")
0^21^B41292164^B32147222
"RTN","PSBPRN",1,0)
PSBPRN ;BIRMINGHAM/EFC-BCMA PRN FUNCTIONS ;12/14/12 12:22pm
"RTN","PSBPRN",2,0)
 ;;3.0;BAR CODE MED ADMIN;**5,3,13,61,68,70**;Mar 2004;Build 101
"RTN","PSBPRN",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBPRN",4,0)
 ;
"RTN","PSBPRN",5,0)
 ;Reference/IA
"RTN","PSBPRN",6,0)
 ;DEM^VADPT/10061
"RTN","PSBPRN",7,0)
 ;INP^VADPT/10061
"RTN","PSBPRN",8,0)
 ;$$GET1^DIQ/2056
"RTN","PSBPRN",9,0)
 ;GETSIOPI^PSJBCMA5/5763
"RTN","PSBPRN",10,0)
 ;
"RTN","PSBPRN",11,0)
 ;*68 - add call to add special instructions (SI) entries to the
"RTN","PSBPRN",12,0)
 ;      ^TMP("PSB")  global that ends up in the RESULTS ARRAY of
"RTN","PSBPRN",13,0)
 ;      RPC PSB GETPRNS.
"RTN","PSBPRN",14,0)
 ;      and add new parameter to GETPRNS tag to use new SI/OPI word
"RTN","PSBPRN",15,0)
 ;      processing fields.
"RTN","PSBPRN",16,0)
 ;*70 - remove discharged status from the api and rename DECEASED
"RTN","PSBPRN",17,0)
 ;      see below, in tag Getprns, for searchng back rules and dates
"RTN","PSBPRN",18,0)
 ;      of CO vs IM orders.
"RTN","PSBPRN",19,0)
 ;
"RTN","PSBPRN",20,0)
 ; ** Warning: PSBSIOPI will be used as a global variable for all down
"RTN","PSBPRN",21,0)
 ;    streams calls from this RPC tag call.
"RTN","PSBPRN",22,0)
 ;
"RTN","PSBPRN",23,0)
EN ;
"RTN","PSBPRN",24,0)
 Q
"RTN","PSBPRN",25,0)
 ;
"RTN","PSBPRN",26,0)
EDIT ; Edit Medication Log PRN Effectiveness
"RTN","PSBPRN",27,0)
 NEW DFN ;* Undef DFN at EDIT+7^PSBPRN (NOIS: HUN-0699-21494)
"RTN","PSBPRN",28,0)
 W !! S DA=""
"RTN","PSBPRN",29,0)
 S DIC="^DPT(",DIC(0)="AEQM",DIC("A")="Select Patient Name: "
"RTN","PSBPRN",30,0)
 D ^DIC K DIC Q:+Y<1
"RTN","PSBPRN",31,0)
 S DFN=+Y
"RTN","PSBPRN",32,0)
 D EDIT1
"RTN","PSBPRN",33,0)
 K DFN,DA
"RTN","PSBPRN",34,0)
 G EDIT
"RTN","PSBPRN",35,0)
 ;
"RTN","PSBPRN",36,0)
EDIT1 ;
"RTN","PSBPRN",37,0)
 S %DT="AEQ",%DT("A")="Select Date to Begin Searching Back From: "
"RTN","PSBPRN",38,0)
 S %DT("B")="Today"
"RTN","PSBPRN",39,0)
 W !! D ^%DT Q:+Y<1  S PSBDT=Y
"RTN","PSBPRN",40,0)
 F  D  Q:'PSBDT
"RTN","PSBPRN",41,0)
 .W @IOF,!,"Searching Date " S Y=PSBDT D D^DIQ W Y
"RTN","PSBPRN",42,0)
 .W !," #  Medication",?45,"St",?50,"D/T Given",?75,"Int"
"RTN","PSBPRN",43,0)
 .W !,$TR($J("",IOM)," ","-")
"RTN","PSBPRN",44,0)
 .S PSBSRCH=PSBDT+.9,PSBCNT=0
"RTN","PSBPRN",45,0)
 .K PSBTMP
"RTN","PSBPRN",46,0)
 .F  S PSBSRCH=$O(^PSB(53.79,"APRN",DFN,PSBSRCH),-1) Q:'PSBSRCH!(PSBSRCH<PSBDT)  D
"RTN","PSBPRN",47,0)
 ..S PSBIEN=""
"RTN","PSBPRN",48,0)
 ..F  S PSBIEN=$O(^PSB(53.79,"APRN",DFN,PSBSRCH,PSBIEN),-1) Q:'PSBIEN  D
"RTN","PSBPRN",49,0)
 ...Q:$P($G(^PSB(53.79,PSBIEN,.2)),U,2)]""
"RTN","PSBPRN",50,0)
 ...Q:$P($G(^PSB(53.79,PSBIEN,0)),U,9)'="G"
"RTN","PSBPRN",51,0)
 ...S PSBCNT=PSBCNT+1,PSBTMP(PSBCNT)=PSBIEN
"RTN","PSBPRN",52,0)
 ...I $Y>19 W ! S DIR(0)="E" D ^DIR W @IOF,!,"Searching Date " S Y=PSBDT D D^DIQ W Y,!," #  Medication",?45,"St",?50,"D/T Given",?75,"Int",!,$TR($J("",IOM)," ","-")
"RTN","PSBPRN",53,0)
 ...W !,$J(PSBCNT,2),". "
"RTN","PSBPRN",54,0)
 ...W ?5,$$GET1^DIQ(53.79,PSBIEN_",",.08)
"RTN","PSBPRN",55,0)
 ...W ?45,$P(^PSB(53.79,PSBIEN,0),U,9)
"RTN","PSBPRN",56,0)
 ...W ?50,$$GET1^DIQ(53.79,PSBIEN_",",.06)
"RTN","PSBPRN",57,0)
 ...W ?75,$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY:INITIAL")
"RTN","PSBPRN",58,0)
 .I PSBCNT W ! S DIR(0)="NO^1:"_PSBCNT_":0" D ^DIR S:Y DA=PSBTMP(Y),PSBDT="" Q:Y
"RTN","PSBPRN",59,0)
 .I 'PSBCNT W !!?5,"No Meds Found!"
"RTN","PSBPRN",60,0)
 .S X1=PSBDT,X2=-1 D C^%DTC S (PSBDT,Y)=X D D^DIQ
"RTN","PSBPRN",61,0)
 .W !!,"Continue With ",Y
"RTN","PSBPRN",62,0)
 .S %=1 D YN^DICN I %'=1 S PSBDT=0
"RTN","PSBPRN",63,0)
 I DA S DDSFILE=53.79,DR="[PSB PRN EFFECTIVENESS]" D ^DDS S %=2 W !,"Edit another entry" D YN^DICN G:%=1 EDIT1
"RTN","PSBPRN",64,0)
 K PSBCNT,PSBDT,PSBIEN,PSBSRCH,PSBTMP,DA,DR,DDSFILE
"RTN","PSBPRN",65,0)
 Q
"RTN","PSBPRN",66,0)
 ;
"RTN","PSBPRN",67,0)
GETPRNS(RESULTS,DFN,PSBORD,PSBSIOPI) ; Get the PRN's for a pt needing effectiveness
"RTN","PSBPRN",68,0)
 ;
"RTN","PSBPRN",69,0)
 ; RPC PSB GETPRNS
"RTN","PSBPRN",70,0)
 ;
"RTN","PSBPRN",71,0)
 ; Description:
"RTN","PSBPRN",72,0)
 ; Returns all administrations of a PRN order that have NOT had
"RTN","PSBPRN",73,0)
 ; the PRN Effectiveness documented BASED ON THE TRANSFER DATE AND SITE PARAM
"RTN","PSBPRN",74,0)
 ;
"RTN","PSBPRN",75,0)
 N PSBADMDT,PSBHOUR,PSBPRNDT,PSBIEN,PSBSTOP,PSBIMHR,PSBIMPRNDT,PSBCODY,PSBCOPRNDT           ;*70
"RTN","PSBPRN",76,0)
 K ^TMP("PSB",$J),RESULTS
"RTN","PSBPRN",77,0)
 S PSBSIOPI=+$G(PSBSIOPI)   ;*68 init to 0 if not present or 1 if sent
"RTN","PSBPRN",78,0)
 ;
"RTN","PSBPRN",79,0)
 Q:$$DECEASED(DFN)                                                ;*70
"RTN","PSBPRN",80,0)
 ;
"RTN","PSBPRN",81,0)
 D INP^VADPT S PSBADMDT=+VAIN(7)                   ;get admit date *70
"RTN","PSBPRN",82,0)
 ;get IM site param then build IM & CO PRN dates                   *70
"RTN","PSBPRN",83,0)
 S PSBIMHR=$$GET^XPAR("DIV","PSB PRN DOCUMENTATION")  ;IM hours
"RTN","PSBPRN",84,0)
 S:'PSBIMHR PSBIMHR=72                ;IM def=72 hrs if param null *70
"RTN","PSBPRN",85,0)
 S PSBCODY=1                          ;CO def = 1 day, no time     *70
"RTN","PSBPRN",86,0)
 ;
"RTN","PSBPRN",87,0)
 ;*70
"RTN","PSBPRN",88,0)
 ; BUILD IM & CO prn date limit from Site param and/or defaults,
"RTN","PSBPRN",89,0)
 ; then use the oldest of the 2 PRN dates for the loop quit value.
"RTN","PSBPRN",90,0)
 ; If an admit date exists and is older than the IM date, then use
"RTN","PSBPRN",91,0)
 ; it for the loop. Also if admit date is present, then CO orders
"RTN","PSBPRN",92,0)
 ; should use IM rules and dates.
"RTN","PSBPRN",93,0)
 ;
"RTN","PSBPRN",94,0)
 ; CO date, for non-admitted patient, will be a whole day, no time.
"RTN","PSBPRN",95,0)
 ;
"RTN","PSBPRN",96,0)
 D NOW^%DTC S PSBSTRT=%
"RTN","PSBPRN",97,0)
 ;create IM & CO past date limit to include these order types     *70
"RTN","PSBPRN",98,0)
 S PSBIMPRNDT=$$FMADD^XLFDT(PSBSTRT,"",-PSBIMHR)
"RTN","PSBPRN",99,0)
 S PSBCOPRNDT=$$FMADD^XLFDT($P(PSBSTRT,"."),-PSBCODY)
"RTN","PSBPRN",100,0)
 S PSBPRNDT=$S(PSBCOPRNDT<PSBIMPRNDT:PSBCOPRNDT,1:PSBIMPRNDT)
"RTN","PSBPRN",101,0)
 ;use older of PSBPRNDT & PSBADMDT(admission) for loop quit value
"RTN","PSBPRN",102,0)
 I PSBADMDT,PSBADMDT<PSBPRNDT S (PSBPRNDT,PSBIMPRNDT,PSBCOPRNDT)=PSBADMDT
"RTN","PSBPRN",103,0)
 ;end dates                                                       *70
"RTN","PSBPRN",104,0)
 ;
"RTN","PSBPRN",105,0)
 ;begin loop of PRN records
"RTN","PSBPRN",106,0)
 S PSBSTRT="" F  S PSBSTRT=$O(^PSB(53.79,"APRN",DFN,PSBSTRT),-1) Q:(PSBSTRT<PSBPRNDT)  D
"RTN","PSBPRN",107,0)
 .S PSBIEN=""
"RTN","PSBPRN",108,0)
 .F  S PSBIEN=$O(^PSB(53.79,"APRN",DFN,PSBSTRT,PSBIEN),-1) Q:'PSBIEN  D
"RTN","PSBPRN",109,0)
 ..Q:(PSBORD'="")&($P(^PSB(53.79,PSBIEN,.1),U)'=PSBORD)  ;  Not the right order
"RTN","PSBPRN",110,0)
 ..I ($P(^PSB(53.79,PSBIEN,0),U,9)'="G")&($P(^PSB(53.79,PSBIEN,0),U,9)'="RM") Q    ; Med was never given
"RTN","PSBPRN",111,0)
 ..Q:$P($G(^PSB(53.79,PSBIEN,.2)),U,2)]""  ; Already entered
"RTN","PSBPRN",112,0)
 ..S PSBX=PSBIEN_U_DFN,PSBIENS=PSBIEN_","
"RTN","PSBPRN",113,0)
 ..S PSBX=PSBX_U_$$GET1^DIQ(53.79,PSBIENS,.02)
"RTN","PSBPRN",114,0)
 ..S PSBX=PSBX_U_$$GET1^DIQ(53.79,PSBIENS,.06,"I")
"RTN","PSBPRN",115,0)
 ..S PSBX=PSBX_U_$$GET1^DIQ(53.79,PSBIENS,.07)
"RTN","PSBPRN",116,0)
 ..S PSBX=PSBX_U_$$GET1^DIQ(53.79,PSBIENS,.08)
"RTN","PSBPRN",117,0)
 ..S PSBX=PSBX_U_$$GET1^DIQ(53.79,PSBIENS,.21)
"RTN","PSBPRN",118,0)
 ..D PSJ1^PSBVT(DFN,$$GET1^DIQ(53.79,PSBIENS,.11))
"RTN","PSBPRN",119,0)
 ..;admit date exists, force CO order to look like an IM           *70
"RTN","PSBPRN",120,0)
 ..I PSBADMDT S PSBCLORD=""
"RTN","PSBPRN",121,0)
 ..;skip CO order admins that are older than CO PRN date           *70
"RTN","PSBPRN",122,0)
 ..Q:($G(PSBCLORD)]"")&($P(PSBSTRT,".")<$P(PSBCOPRNDT,"."))
"RTN","PSBPRN",123,0)
 ..;skip IM order admins that are older than IM PRN date           *70
"RTN","PSBPRN",124,0)
 ..Q:($G(PSBCLORD)="")&(PSBSTRT<PSBIMPRNDT)
"RTN","PSBPRN",125,0)
 ..S PSBX=PSBX_U_PSBOIT_U_PSBONX
"RTN","PSBPRN",126,0)
 ..S PSBX=PSBX_U_$$GET1^DIQ(53.79,PSBIENS,.27)
"RTN","PSBPRN",127,0)
 ..S Y=$O(^TMP("PSB",$J,""),-1)+1
"RTN","PSBPRN",128,0)
 ..S ^TMP("PSB",$J,Y)=PSBX
"RTN","PSBPRN",129,0)
 ..;Special instructions
"RTN","PSBPRN",130,0)
 ..S Y=Y+1,^TMP("PSB",$J,Y)=PSBOTXT
"RTN","PSBPRN",131,0)
 ..F PSBZ=.5,.6,.7 F PSBY=0:0 S PSBY=$O(^PSB(53.79,PSBIEN,PSBZ,PSBY)) Q:'PSBY  D
"RTN","PSBPRN",132,0)
 ...S PSBDD=$S(PSBZ=.5:53.795,PSBZ=.6:53.796,1:53.797)
"RTN","PSBPRN",133,0)
 ...S PSBSOL=$S(PSBZ=.5:"DD",PSBZ=.6:"ADD",1:"SOL")
"RTN","PSBPRN",134,0)
 ...Q:'$D(^PSB(53.79,PSBIEN,PSBZ,PSBY))
"RTN","PSBPRN",135,0)
 ...S PSBUNIT=$$GET1^DIQ(PSBDD,PSBY_","_PSBIEN_",",.03)
"RTN","PSBPRN",136,0)
 ...S PSBUNFR=$$GET1^DIQ(PSBDD,PSBY_","_PSBIEN_",",.04)
"RTN","PSBPRN",137,0)
 ...I PSBUNIT>0&(PSBUNIT<1) S PSBUNIT="0"_+PSBUNIT ;add leading 0 for a decimal value less than 1 - PSB*3*61
"RTN","PSBPRN",138,0)
 ...S Y=Y+1
"RTN","PSBPRN",139,0)
 ...S ^TMP("PSB",$J,Y)=PSBSOL_U_$$GET1^DIQ(PSBDD,PSBY_","_PSBIEN_",",.01)_U_PSBUNIT_U_PSBUNFR
"RTN","PSBPRN",140,0)
 ..D:PSBSIOPI GETSI(DFN,PSBONX,.Y)     ;*68 get spec inst/oth prt info
"RTN","PSBPRN",141,0)
 ..S Y=Y+1,^TMP("PSB",$J,Y)="END"
"RTN","PSBPRN",142,0)
 S ^TMP("PSB",$J,0)=+$O(^TMP("PSB",$J,""),-1)
"RTN","PSBPRN",143,0)
 S RESULTS=$NAME(^TMP("PSB",$J))
"RTN","PSBPRN",144,0)
 D CLEAN^PSBVT
"RTN","PSBPRN",145,0)
 Q
"RTN","PSBPRN",146,0)
 ;
"RTN","PSBPRN",147,0)
DECEASED(DFN) ; Patient Deceased?                                        *70
"RTN","PSBPRN",148,0)
 ;
"RTN","PSBPRN",149,0)
 S DECEASED=0
"RTN","PSBPRN",150,0)
 ;
"RTN","PSBPRN",151,0)
 D DEM^VADPT ;check for date of death entry
"RTN","PSBPRN",152,0)
 I VADM(6)]"" S DECEASED=1,^TMP("PSB",$J,0)=0 K VADM
"RTN","PSBPRN",153,0)
 ;
"RTN","PSBPRN",154,0)
 I DECEASED D  ;setup results and clean up
"RTN","PSBPRN",155,0)
 .S RESULTS=$NAME(^TMP("PSB",$J))
"RTN","PSBPRN",156,0)
 .D CLEAN^PSBVT
"RTN","PSBPRN",157,0)
 ;
"RTN","PSBPRN",158,0)
 Q DECEASED
"RTN","PSBPRN",159,0)
 ;
"RTN","PSBPRN",160,0)
GETSI(DFN,ORD,PSB) ;Get Special Instructions/Other Print Info from IM   ;*68
"RTN","PSBPRN",161,0)
 ;
"RTN","PSBPRN",162,0)
 ; This Tag will load the SIOPI WP text into the TMP global used by
"RTN","PSBPRN",163,0)
 ; the PSB GETPRNS RPC, which ends up in the RESULTS array passed
"RTN","PSBPRN",164,0)
 ; back to the BCMA GUI.
"RTN","PSBPRN",165,0)
 ;
"RTN","PSBPRN",166,0)
 N QQ
"RTN","PSBPRN",167,0)
 K ^TMP("PSJBCMA5",$J,DFN,ORD)
"RTN","PSBPRN",168,0)
 D GETSIOPI^PSJBCMA5(DFN,ORD,1)
"RTN","PSBPRN",169,0)
 Q:'$D(^TMP("PSJBCMA5",$J,DFN,ORD))
"RTN","PSBPRN",170,0)
 F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,DFN,ORD,QQ)) Q:'QQ  D
"RTN","PSBPRN",171,0)
 .S PSB=PSB+1
"RTN","PSBPRN",172,0)
 .S ^TMP("PSB",$J,PSB)="SI^"_^TMP("PSJBCMA5",$J,DFN,ORD,QQ)
"RTN","PSBPRN",173,0)
 K ^TMP("PSJBCMA5",$J,DFN,ORD)
"RTN","PSBPRN",174,0)
 Q
"RTN","PSBRPC")
0^8^B225560301^B186718604
"RTN","PSBRPC",1,0)
PSBRPC ;BIRMINGHAM/EFC - BCMA RPC BROKER CALLS ; 19 Jul 2013  12:34 PM
"RTN","PSBRPC",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,3,4,13,32,28,42,58,66,70**;Mar 2004;Build 101
"RTN","PSBRPC",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBRPC",4,0)
 ;
"RTN","PSBRPC",5,0)
 ; Reference/IA
"RTN","PSBRPC",6,0)
 ; File 211.4/1409
"RTN","PSBRPC",7,0)
 ; CHECKAV^XUSRB/2882
"RTN","PSBRPC",8,0)
 ; GUIMTD^DPTLK6/3023
"RTN","PSBRPC",9,0)
 ; ^ORD(101.24/3429
"RTN","PSBRPC",10,0)
 ; EN1^GMRVUT0/1446
"RTN","PSBRPC",11,0)
 ; $$GETACT^DGPFAPI/3860
"RTN","PSBRPC",12,0)
 ; File #40.8/2817
"RTN","PSBRPC",13,0)
 ; $$GET^XPAR/2263
"RTN","PSBRPC",14,0)
 ; $$GET1^DIQ/2056
"RTN","PSBRPC",15,0)
 ; XMD/10070
"RTN","PSBRPC",16,0)
 ; RPCVIC^DPTLK/5888
"RTN","PSBRPC",17,0)
 ; File #42/1377
"RTN","PSBRPC",18,0)
 ;
"RTN","PSBRPC",19,0)
 ;*70 - remove restriction of allowing BCMA to view Discharged
"RTN","PSBRPC",20,0)
 ;      patients
"RTN","PSBRPC",21,0)
 ;    - add Tag GETLIST, RPC:PSB CLINICLIST (returns requested
"RTN","PSBRPC",22,0)
 ;                                           clinic names)
"RTN","PSBRPC",23,0)
 ;    - add to User load & User save 2 new varaibles, 1 for Last
"RTN","PSBRPC",24,0)
 ;      Order mode and other for Last Clinic name search text
"RTN","PSBRPC",25,0)
 ;    - 1489: Blended PSB*3*66 with PSB*3*70
"RTN","PSBRPC",26,0)
 ;    - Add Registration API call to support VIC 4.0 cards
"RTN","PSBRPC",27,0)
 ;
"RTN","PSBRPC",28,0)
FMDATE(RESULTS,X) ;
"RTN","PSBRPC",29,0)
 ; RPC: PSB FMDATE
"RTN","PSBRPC",30,0)
 ; Descr: Returns FM Date/Time from Clnt DateToStr()
"RTN","PSBRPC",31,0)
 ;
"RTN","PSBRPC",32,0)
 I $P(X,"@",2)="0000" S $P(X,"@",2)="0001"
"RTN","PSBRPC",33,0)
 ;if no time for dates like T-1, append the current time
"RTN","PSBRPC",34,0)
 I $P(X,"@",2)="",X'?1"N" D  S $P(X,"@",2)=$P(Y,"@",2)
"RTN","PSBRPC",35,0)
 . N X
"RTN","PSBRPC",36,0)
 . S X="N",%DT="T" D ^%DT,DD^%DT
"RTN","PSBRPC",37,0)
 S %DT="T" D ^%DT
"RTN","PSBRPC",38,0)
 I +Y<1 S RESULTS(0)="-1^Invalid Date/Time" Q
"RTN","PSBRPC",39,0)
 S RESULTS(0)=Y D D^DIQ
"RTN","PSBRPC",40,0)
 S RESULTS(0)=RESULTS(0)_U_Y
"RTN","PSBRPC",41,0)
 Q
"RTN","PSBRPC",42,0)
 ;
"RTN","PSBRPC",43,0)
USRLOAD(RESULTS,DUMMY) ;
"RTN","PSBRPC",44,0)
 ;
"RTN","PSBRPC",45,0)
 ; RPC: PSB USERLOAD
"RTN","PSBRPC",46,0)
 ; Descr: Load wkst user
"RTN","PSBRPC",47,0)
 ; 
"RTN","PSBRPC",48,0)
 S RESULTS(0)=DUZ ;UsrIEN
"RTN","PSBRPC",49,0)
 S RESULTS(1)=$$GET1^DIQ(200,DUZ_",",.01) ; Usr Nm
"RTN","PSBRPC",50,0)
 S RESULTS(2)=$S($D(^XUSEC("PSB STUDENT",DUZ)):1,1:0) ; Studnt?
"RTN","PSBRPC",51,0)
 S RESULTS(3)=$S($D(^XUSEC("PSB MANAGER",DUZ)):1,1:0) ; Mgr?
"RTN","PSBRPC",52,0)
 S RESULTS(4)=$S($D(^XUSEC("PSB CPRS MED BUTTON",DUZ)):1,1:0)
"RTN","PSBRPC",53,0)
 S RESULTS(5)=$$GET^XPAR("USR","PSB WINDOW")
"RTN","PSBRPC",54,0)
 ;VDL Strng
"RTN","PSBRPC",55,0)
 S X=$S(+$$GET^XPAR("ALL","PSB VDL INCL CONT"):"T",1:"F")
"RTN","PSBRPC",56,0)
 S X=X_"/"_$S(+$$GET^XPAR("ALL","PSB VDL INCL PRN"):"T",1:"F")
"RTN","PSBRPC",57,0)
 S X=X_"/"_$S(+$$GET^XPAR("ALL","PSB VDL INCL ONE-TIME"):"T",1:"F")
"RTN","PSBRPC",58,0)
 S X=X_"/"_$S(+$$GET^XPAR("ALL","PSB VDL INCL ON-CALL"):"T",1:"F")
"RTN","PSBRPC",59,0)
 S X=X_"/"_+$$GET^XPAR("ALL","PSB VDL SORT COLUMN")
"RTN","PSBRPC",60,0)
 S X=X_"/"_+$$GET^XPAR("ALL","PSB VDL PB SORT COLUMN")
"RTN","PSBRPC",61,0)
 S X=X_"/"_+$$GET^XPAR("ALL","PSB VDL IV SORT COLUMN")
"RTN","PSBRPC",62,0)
 ;
"RTN","PSBRPC",63,0)
 S RESULTS(6)=X ;VDL Setp
"RTN","PSBRPC",64,0)
 S RESULTS(7)=+$G(DUZ(2))
"RTN","PSBRPC",65,0)
 I RESULTS(7) S RESULTS(8)=$$GET1^DIQ(4,RESULTS(7)_",",.01)
"RTN","PSBRPC",66,0)
 E  S RESULTS(8)="Undefined Division"
"RTN","PSBRPC",67,0)
 N DVIEN S DVIEN=$O(^DG(40.8,"AD",RESULTS(7),""))
"RTN","PSBRPC",68,0)
 S RESULTS(7)=RESULTS(7)_U_$P($$SITE^VASITE(DT,DVIEN),U,3)
"RTN","PSBRPC",69,0)
 I $T(PROD^XUPROD)]"" S RESULTS(7)=RESULTS(7)_U_$$PROD^XUPROD(1)
"RTN","PSBRPC",70,0)
 S RESULTS(9)=+$$GET^XPAR("DIV","PSB ADMIN ESIG")
"RTN","PSBRPC",71,0)
 S RESULTS(10)=+$$GET^XPAR("DIV","PSB ONLINE")
"RTN","PSBRPC",72,0)
 S RESULTS(11)=$G(DTIME,300)
"RTN","PSBRPC",73,0)
 S RESULTS(12)=$$GET^XPAR("USR","PSB UNIT DOSE COLUMN WIDTHS")
"RTN","PSBRPC",74,0)
 S RESULTS(13)=$J_"^"_$$BASE^XLFUTL($J,10,16)
"RTN","PSBRPC",75,0)
 S RESULTS(14)=$$GET^XPAR("USR","PSB IVPB COLUMN WIDTHS")
"RTN","PSBRPC",76,0)
 S RESULTS(15)=$$GET^XPAR("USR","PSB IV COLUMN WIDTHS")
"RTN","PSBRPC",77,0)
 S RESULTS(16)=$$GET^XPAR("USR","PSB PRINTER USER DEFAULT")
"RTN","PSBRPC",78,0)
 S RESULTS(17)=$$GET^XPAR("USR","PSB GUI DEFAULT PRINTER")
"RTN","PSBRPC",79,0)
 S RESULTS(18)=$S($D(^XUSEC("PSB READ ONLY",DUZ)):1,1:0)
"RTN","PSBRPC",80,0)
 S RESULTS(19)=$$GET^XPAR("USR","PSB COVERSHEET VIEWS COL SORT")
"RTN","PSBRPC",81,0)
 S RESULTS(20)=$$GET^XPAR("USR","PSB COVERSHEET V1 COL WIDTHS")
"RTN","PSBRPC",82,0)
 S RESULTS(21)=$$GET^XPAR("USR","PSB COVERSHEET V2 COL WIDTHS")
"RTN","PSBRPC",83,0)
 S RESULTS(22)=$$GET^XPAR("USR","PSB COVERSHEET V3 COL WIDTHS")
"RTN","PSBRPC",84,0)
 S RESULTS(23)=$$GET^XPAR("USR","PSB COVERSHEET V4 COL WIDTHS")
"RTN","PSBRPC",85,0)
 S RESULTS(24)=$S($D(^XUSEC("PSB UNABLE TO SCAN",DUZ)):1,1:0)
"RTN","PSBRPC",86,0)
 S RESULTS(25)=$$GET^XPAR("DIV","PSB 5 RIGHTS UNITDOSE")
"RTN","PSBRPC",87,0)
 S RESULTS(26)=$$GET^XPAR("DIV","PSB 5 RIGHTS IV")
"RTN","PSBRPC",88,0)
 S RESULTS(27)=$G(DUZ("AG"))  ;IHS/MSC/PLS
"RTN","PSBRPC",89,0)
 S RESULTS(28)=$$GET^XPAR("USR","PSB ORDER MODE")           ;*70
"RTN","PSBRPC",90,0)
 S RESULTS(29)=$$GET^XPAR("USR","PSB CLINIC SEARCH")        ;*70
"RTN","PSBRPC",91,0)
 Q
"RTN","PSBRPC",92,0)
 ;
"RTN","PSBRPC",93,0)
USRSAVE(RESULTS,PSBWIN,PSBVDL,PSBUDCW,PSBPBCW,PSBIVCW,PSBDEV,PSBCSRT,PSBCV1,PSBCV2,PSBCV3,PSBCV4,PSBORMODE,PSBCLSRCH) ;
"RTN","PSBRPC",94,0)
 ;
"RTN","PSBRPC",95,0)
 ; RPC: PSB USERSAVE
"RTN","PSBRPC",96,0)
 ; Descr: Saves user settings.
"RTN","PSBRPC",97,0)
 ;
"RTN","PSBRPC",98,0)
 S RESULTS(0)="-1^FAILED - Parameters Save"
"RTN","PSBRPC",99,0)
 S PSBWIN=$G(PSBWIN),PSBVDL=$G(PSBVDL),PSBUDCW=$G(PSBUDCW)
"RTN","PSBRPC",100,0)
 S PSBPBCW=$G(PSBPBCW),PSBIVCW=$G(PSBIVCW),PSBDEV=$G(PSBDEV)
"RTN","PSBRPC",101,0)
 S PSBCSRT=$G(PSBCSRT),PSBCV1=$G(PSBCV1),PSBCV2=$G(PSBCV2),PSBCV3=$G(PSBCV3),PSBCV4=$G(PSBCV4)
"RTN","PSBRPC",102,0)
 ;
"RTN","PSBRPC",103,0)
 D EN^XPAR("USR","PSB WINDOW",1,PSBWIN)
"RTN","PSBRPC",104,0)
 D EN^XPAR("USR","PSB VDL INCL CONT",1,$P(PSBVDL,"/",1)["T")
"RTN","PSBRPC",105,0)
 D EN^XPAR("USR","PSB VDL INCL PRN",1,$P(PSBVDL,"/",2)["T")
"RTN","PSBRPC",106,0)
 D EN^XPAR("USR","PSB VDL INCL ONE-TIME",1,$P(PSBVDL,"/",3)["T")
"RTN","PSBRPC",107,0)
 D EN^XPAR("USR","PSB VDL INCL ON-CALL",1,$P(PSBVDL,"/",4)["T")
"RTN","PSBRPC",108,0)
 D EN^XPAR("USR","PSB VDL SORT COLUMN",1,+$P(PSBVDL,"/",5))
"RTN","PSBRPC",109,0)
 D EN^XPAR("USR","PSB VDL PB SORT COLUMN",1,+$P(PSBVDL,"/",6))
"RTN","PSBRPC",110,0)
 D EN^XPAR("USR","PSB VDL IV SORT COLUMN",1,+$P(PSBVDL,"/",7))
"RTN","PSBRPC",111,0)
 D EN^XPAR("USR","PSB UNIT DOSE COLUMN WIDTHS",1,PSBUDCW)
"RTN","PSBRPC",112,0)
 D EN^XPAR("USR","PSB IVPB COLUMN WIDTHS",1,PSBPBCW)
"RTN","PSBRPC",113,0)
 D EN^XPAR("USR","PSB IV COLUMN WIDTHS",1,PSBIVCW)
"RTN","PSBRPC",114,0)
 D EN^XPAR("USR","PSB GUI DEFAULT PRINTER",1,PSBDEV)
"RTN","PSBRPC",115,0)
 D EN^XPAR("USR","PSB COVERSHEET VIEWS COL SORT",1,PSBCSRT)
"RTN","PSBRPC",116,0)
 D EN^XPAR("USR","PSB COVERSHEET V1 COL WIDTHS",1,PSBCV1)
"RTN","PSBRPC",117,0)
 D EN^XPAR("USR","PSB COVERSHEET V2 COL WIDTHS",1,PSBCV2)
"RTN","PSBRPC",118,0)
 D EN^XPAR("USR","PSB COVERSHEET V3 COL WIDTHS",1,PSBCV3)
"RTN","PSBRPC",119,0)
 D EN^XPAR("USR","PSB COVERSHEET V4 COL WIDTHS",1,PSBCV4)
"RTN","PSBRPC",120,0)
 D EN^XPAR("USR","PSB ORDER MODE",1,PSBORMODE)            ;*70
"RTN","PSBRPC",121,0)
 D EN^XPAR("USR","PSB CLINIC SEARCH",1,PSBCLSRCH)         ;*70
"RTN","PSBRPC",122,0)
 S RESULTS(0)="1^Parameters Saved"
"RTN","PSBRPC",123,0)
 Q
"RTN","PSBRPC",124,0)
 ;
"RTN","PSBRPC",125,0)
INST(RESULTS,PSBACC,PSBVER) ;
"RTN","PSBRPC",126,0)
 ;
"RTN","PSBRPC",127,0)
 ; RPC: PSB INSTRUCTOR
"RTN","PSBRPC",128,0)
 ; Descr:
"RTN","PSBRPC",129,0)
 ; Used by frmInstructor to validate an instructor(s) at
"RTN","PSBRPC",130,0)
 ; the client via encrypted A/V Code.
"RTN","PSBRPC",131,0)
 ;
"RTN","PSBRPC",132,0)
 S PSBACC=$$DECRYP^XUSRB1(PSBACC)
"RTN","PSBRPC",133,0)
 S PSBVER=$$DECRYP^XUSRB1(PSBVER)
"RTN","PSBRPC",134,0)
 S PSBINST=$$CHECKAV^XUSRB(PSBACC_";"_PSBVER)
"RTN","PSBRPC",135,0)
 I PSBINST<1 S RESULTS(0)="-1^Invalid Instructor Sign-On" K PSBINST Q
"RTN","PSBRPC",136,0)
 I '$D(^XUSEC("PSB INSTRUCTOR",PSBINST)) S RESULTS(0)="-1^Instructor doesn't have authority" K PSBINST Q
"RTN","PSBRPC",137,0)
 S PSBINST(0)=$$GET1^DIQ(200,PSBINST_",",.01)
"RTN","PSBRPC",138,0)
 S RESULTS(0)=PSBINST_U_PSBINST(0)
"RTN","PSBRPC",139,0)
 Q
"RTN","PSBRPC",140,0)
 ;
"RTN","PSBRPC",141,0)
ESIG(RESULTS,PSBESIG) ;
"RTN","PSBRPC",142,0)
 ;
"RTN","PSBRPC",143,0)
 ; RPC: PSB VALIDATE ESIG
"RTN","PSBRPC",144,0)
 ; Descr: Validate the data in PSBESIG against user (DUZ)
"RTN","PSBRPC",145,0)
 ;
"RTN","PSBRPC",146,0)
 S PSBDSIG=$P($G(PSBESIG),U,2) I PSBDSIG'="" S PSBDSIG=$$DECRYP^XUSRB1(PSBDSIG),PSBESIG=PSBDSIG
"RTN","PSBRPC",147,0)
 I $G(PSBESIG)="" S RESULTS(0)="-1^Must Supply ESig" Q
"RTN","PSBRPC",148,0)
 S X=PSBESIG D HASH^XUSHSHP
"RTN","PSBRPC",149,0)
 I X'=$$GET1^DIQ(200,DUZ_",",20.4,"I") S RESULTS(0)="-1^Invalid ESig"
"RTN","PSBRPC",150,0)
 E  S RESULTS(0)="1^ESig Verified"
"RTN","PSBRPC",151,0)
 Q
"RTN","PSBRPC",152,0)
 ;
"RTN","PSBRPC",153,0)
SCANPT(RESULTS,PSBDATA) ; Lookup Pt by Full SSN
"RTN","PSBRPC",154,0)
 ;
"RTN","PSBRPC",155,0)
 ; RPC: PSB SCANPT
"RTN","PSBRPC",156,0)
 ; Descr:
"RTN","PSBRPC",157,0)
 ; File #2 lookup either by full SSN
"RTN","PSBRPC",158,0)
 ; returns -1 on error or patient data
"RTN","PSBRPC",159,0)
 ; Check for Interleave 2 of 5 Check Digit on SSN and remove
"RTN","PSBRPC",160,0)
 ; 
"RTN","PSBRPC",161,0)
 N DFN,PSBWARD   ;[*70-1489]
"RTN","PSBRPC",162,0)
 I "SS"[$P($G(PSBDATA),"^",3)  D  Q:RESULTS(1)<0
"RTN","PSBRPC",163,0)
 .S:$P(PSBDATA,"^")?1"0"9N.U PSBDATA=$E(PSBDATA,2,99) N PSBCNT
"RTN","PSBRPC",164,0)
 .;  IHS vs VA Agency check for Patient ID info
"RTN","PSBRPC",165,0)
 .I $G(DUZ("AG"))'="I",$G(DUZ("AG"))'="V" S RESULTS(0)=1,RESULTS(1)="-1^Invalid Agency Code - Not IHS or VA" Q
"RTN","PSBRPC",166,0)
 .I $G(DUZ("AG"))="I" D
"RTN","PSBRPC",167,0)
 ..S X=-1
"RTN","PSBRPC",168,0)
 ..I $P(PSBDATA,U)?12N S X=$$HRCNF^APSPFUNC($P(PSBDATA,U))
"RTN","PSBRPC",169,0)
 ..S:X'>0 RESULTS(0)=1,RESULTS(1)="-1^Patient not found or # not 12 digit"
"RTN","PSBRPC",170,0)
 .E  D
"RTN","PSBRPC",171,0)
 ..;*70 Implement VIC 4.0 cards. Old Bar code with SSN still accepted
"RTN","PSBRPC",172,0)
 ..S DPTDATA=$P(PSBDATA,U) ;,DPTDATA=$TR(DPTDATA,"|","^") ; ST - $TR not needed
"RTN","PSBRPC",173,0)
 ..D RPCVIC^DPTLK(.DFN,DPTDATA)
"RTN","PSBRPC",174,0)
 ..I DFN=""!(DFN<0) S DFN=$$FIND1^DIC(2,"","",DPTDATA,"SSN") S:'DFN DFN=-1 ;old SSN lookup
"RTN","PSBRPC",175,0)
 .I DFN=-1 S RESULTS(0)=1,RESULTS(1)="-1^Invalid Patient Lookup"
"RTN","PSBRPC",176,0)
 .;*End *70 Implement VIC 4.0 cards.
"RTN","PSBRPC",177,0)
 .Q:$G(RESULTS(1))<0
"RTN","PSBRPC",178,0)
 .S (RESULTS(1),PSBDFN)=DFN
"RTN","PSBRPC",179,0)
 .S PSBICN=$$GETICN^MPIF001(PSBDFN) I +PSBICN=-1 S PSBICN=""
"RTN","PSBRPC",180,0)
 I $G(DFN)']"" D  Q:+PSBDFN'>0
"RTN","PSBRPC",181,0)
 .; CCOW !
"RTN","PSBRPC",182,0)
 .I "DF"[$P($G(PSBDATA),"^",3) S PSBDFN=$P($G(PSBDATA),"^"),PSBICN=$$GETICN^MPIF001(PSBDFN) I +PSBICN=-1 S PSBICN="",RESULTS(0)=1,RESULTS(1)="-1^Cannot find ICN via DFN"
"RTN","PSBRPC",183,0)
 .I "IC"[$P($G(PSBDATA),"^",3) S PSBICN=$P($G(PSBDATA),"^"),PSBDFN=$$GETDFN^MPIF001(PSBICN) I +PSBDFN=-1 S PSBDFN="",RESULTS(0)=1,RESULTS(1)="-1^Cannot find DFN via ICN" Q
"RTN","PSBRPC",184,0)
 .S (DFN,RESULTS(1))=PSBDFN
"RTN","PSBRPC",185,0)
 .;
"RTN","PSBRPC",186,0)
 ;*70 get registration owned data for admit date or deceased date
"RTN","PSBRPC",187,0)
 N VADM,VA,VAIN,VAIP,VA D DEM^VADPT,IN5^VADPT
"RTN","PSBRPC",188,0)
 N QUIT                                                        ;*70
"RTN","PSBRPC",189,0)
 ; remove discharge test                                       ;*70
"RTN","PSBRPC",190,0)
 ; if patient is deceased                                      ;*70
"RTN","PSBRPC",191,0)
 S QUIT=0
"RTN","PSBRPC",192,0)
 I VADM(6)'="" D  Q:QUIT
"RTN","PSBRPC",193,0)
 .S RESULTS(0)=1
"RTN","PSBRPC",194,0)
 .S RESULTS(1)="-1^"_"This patient died "_$TR($P(VADM(6),U,2),"@"," ")
"RTN","PSBRPC",195,0)
 .D:'$P(PSBDATA,U,2)      ;not read only/limited mode
"RTN","PSBRPC",196,0)
 ..I ($P($G(PSBDATA),U,3)'["IC")&($P($G(PSBDATA),U,3)'["DF") S QUIT=1
"RTN","PSBRPC",197,0)
 ;
"RTN","PSBRPC",198,0)
 ; continue to load patient data
"RTN","PSBRPC",199,0)
 S RESULTS(1)=PSBDFN
"RTN","PSBRPC",200,0)
 F X=1,3,4,5 S RESULTS(X+1)=$G(VADM(X))
"RTN","PSBRPC",201,0)
 ;  IHS/VA - use VA("PID") instead of VADM(2) for Pat ID
"RTN","PSBRPC",202,0)
 S RESULTS(3)=$TR(VA("PID"),"-")_U_VA("PID")
"RTN","PSBRPC",203,0)
 F X=3,4,5,6,7,8,9,10,11 S RESULTS(X+4)=$G(VAIP(X))
"RTN","PSBRPC",204,0)
 ;
"RTN","PSBRPC",205,0)
 ; IHS/MSC/PLS - 03/27/06 - Changed to call PCC Vitals based on
"RTN","PSBRPC",206,0)
 ;  parameter flag DUZ("AG")="I" and PCC Vitals package usage
"RTN","PSBRPC",207,0)
 ;  flag "BEHOVM USE VMSR"=1
"RTN","PSBRPC",208,0)
 ;
"RTN","PSBRPC",209,0)
 I $G(DUZ("AG"))="I",$$GET^XPAR("ALL","BEHOVM USE VMSR") D
"RTN","PSBRPC",210,0)
 .S X=+$P($$VITAL^APSPFUNC(DFN,"HT"),U,2),X=$$VITCHT^APSPFUNC(X)\1,PSBHDR("HEIGHT")=$S(X:X_"cm",1:"*")
"RTN","PSBRPC",211,0)
 .S X=+$P($$VITAL^APSPFUNC(DFN,"WT"),U,2),X=$$VITCWT^APSPFUNC(X)\1,PSBHDR("WEIGHT")=$S(X:X_"kg",1:"*")
"RTN","PSBRPC",212,0)
 E  D
"RTN","PSBRPC",213,0)
 .S GMRVSTR="HT" D EN6^GMRVUTL
"RTN","PSBRPC",214,0)
 .S X=+$P(X,U,8) S:X X=X*2.54\1 S PSBHDR("HEIGHT")=$S(X:X_"cm",1:"*")
"RTN","PSBRPC",215,0)
 .S GMRVSTR="WT" D EN6^GMRVUTL
"RTN","PSBRPC",216,0)
 .S X=+$P(X,U,8) S X=$J(X/2.2,0,2) S PSBHDR("WEIGHT")=$S(X:X_"kg",1:"*")
"RTN","PSBRPC",217,0)
 ;
"RTN","PSBRPC",218,0)
 S $P(RESULTS(9),U,3)=$$GET1^DIQ(42,$P(RESULTS(9),U)_",",44,"I")_"^"_$$GET1^DIQ(42,$P(RESULTS(9),U)_",",44)
"RTN","PSBRPC",219,0)
 S PSBWARD=$P($G(RESULTS(9)),U,2) D IVBAGPAR(PSBWARD)   ;[*70-1489]
"RTN","PSBRPC",220,0)
 S RESULTS(16)=PSBHDR("HEIGHT")
"RTN","PSBRPC",221,0)
 S RESULTS(17)=PSBHDR("WEIGHT")
"RTN","PSBRPC",222,0)
 S GMRA="0^0^111" D EN1^GMRADPT
"RTN","PSBRPC",223,0)
 I $O(GMRAL(0)) S RESULTS(18)=1
"RTN","PSBRPC",224,0)
 E  S RESULTS(18)=0
"RTN","PSBRPC",225,0)
 ; Means Tst
"RTN","PSBRPC",226,0)
 D GUIMTD^DPTLK6(.PSBDATA,PSBDFN)
"RTN","PSBRPC",227,0)
 S RESULTS(19)=+$G(PSBDATA(1))_U_$G(PSBDATA(2))_U_$G(PSBDATA(3))
"RTN","PSBRPC",228,0)
 S PSBICN=$$GETICN^MPIF001(PSBDFN) I +PSBICN=-1 S PSBICN=""
"RTN","PSBRPC",229,0)
 S RESULTS(20)=PSBICN
"RTN","PSBRPC",230,0)
 S RESULTS(21)="",RESULTS(0)=21
"RTN","PSBRPC",231,0)
 S:VADM(6)'="" RESULTS(21)="This patient died "_$TR($P(VADM(6),U,2),"@"," ")
"RTN","PSBRPC",232,0)
 S:('VAIP(13))&('VADM(6)) RESULTS(21)="Patient not Admitted"  ;*70
"RTN","PSBRPC",233,0)
 S (RESULTS(0),PSBCNT)=22
"RTN","PSBRPC",234,0)
 S RESULTS(PSBCNT)=""
"RTN","PSBRPC",235,0)
 F PSBINDX=1:1:($$GETACT^DGPFAPI(PSBDFN,.PSBPTFLG)) D
"RTN","PSBRPC",236,0)
 .Q:'$D(PSBPTFLG)  Q:'$D(@(PSBPTFLG_"(PSBINDX,""FLAG"")"))  S PSBPFLAG="PATFLG",$P(PSBPFLAG,U,2)=$P(@(PSBPTFLG_"(PSBINDX,""FLAG"")"),"^",2)
"RTN","PSBRPC",237,0)
 .S $P(PSBPFLAG,U,3)=PSBINDX,PSBCNT=21+PSBINDX,RESULTS(PSBCNT)=PSBPFLAG
"RTN","PSBRPC",238,0)
 S RESULTS(0)=PSBCNT
"RTN","PSBRPC",239,0)
 I $D(PSBPTFLG) K @PSBPTFLG
"RTN","PSBRPC",240,0)
 Q
"RTN","PSBRPC",241,0)
 ;
"RTN","PSBRPC",242,0)
MAX(RESULTS,PSBDAYS) ;
"RTN","PSBRPC",243,0)
 ;
"RTN","PSBRPC",244,0)
 ; RPC: PSB MAXDAYS  ; Max days user view/print MAH
"RTN","PSBRPC",245,0)
 ;
"RTN","PSBRPC",246,0)
 S X=$O(^ORD(101.24,"B","ORRP BCMA MAH",""))
"RTN","PSBRPC",247,0)
 S RESULTS(0)=$$GET1^DIQ(101.24,X_",",.42)
"RTN","PSBRPC",248,0)
 Q
"RTN","PSBRPC",249,0)
 ;
"RTN","PSBRPC",250,0)
NWLIST(RESULTS,DUMMY) ; ward list - NURS LOCATION, file 211.4
"RTN","PSBRPC",251,0)
 ;
"RTN","PSBRPC",252,0)
 ; RPC: PSB NURS WARDLIST
"RTN","PSBRPC",253,0)
 ; 
"RTN","PSBRPC",254,0)
 K ^TMP("PSB",$J)
"RTN","PSBRPC",255,0)
 S PSBIEN=0 F  S PSBIEN=$O(^NURSF(211.4,PSBIEN)) Q:PSBIEN'?.N  D
"RTN","PSBRPC",256,0)
 .S ^TMP("PSB",$J,$$GET1^DIQ(211.4,PSBIEN_",",.01)_" [NURS UNIT]")=PSBIEN
"RTN","PSBRPC",257,0)
 .S PSBX=0 F  S PSBX=$O(^NURSF(211.4,PSBIEN,3,PSBX)) Q:PSBX=""  D
"RTN","PSBRPC",258,0)
 ..S PSBWIEN=$P(^NURSF(211.4,PSBIEN,3,PSBX,0),"^")
"RTN","PSBRPC",259,0)
 ..I $$GET1^DIQ(42,PSBWIEN_",",.01)]"" S ^TMP("PSB",$J,$$GET1^DIQ(42,PSBWIEN_",",.01)_" [MAS WARD]")=PSBIEN
"RTN","PSBRPC",260,0)
 S RESULTS(0)=0
"RTN","PSBRPC",261,0)
 S X="" F  S X=$O(^TMP("PSB",$J,X)) Q:X=""  D
"RTN","PSBRPC",262,0)
 .S RESULTS(0)=RESULTS(0)+1
"RTN","PSBRPC",263,0)
 .S RESULTS(RESULTS(0))=^TMP("PSB",$J,X)_U_X_U_$S(($$GET1^DIQ(211.4,^TMP("PSB",$J,X)_",",1)="ACTIVE")&($$GET1^DIQ(211.4,^TMP("PSB",$J,X)_",",1.5)'="**INACTIVE**"):"1",1:"0")
"RTN","PSBRPC",264,0)
 K ^TMP("PSB",$J)
"RTN","PSBRPC",265,0)
 Q
"RTN","PSBRPC",266,0)
 ;
"RTN","PSBRPC",267,0)
VITALS(RESULTS,DFN) ;Vitals API
"RTN","PSBRPC",268,0)
 ;
"RTN","PSBRPC",269,0)
 ; RPC PSB VITALS
"RTN","PSBRPC",270,0)
 ; 
"RTN","PSBRPC",271,0)
 ;Retrieve vitals from either the PCC V Measurment file or VA Vitals
"RTN","PSBRPC",272,0)
 ; file.  Based on agency code = "I" & Vitals package flag=1 for the 
"RTN","PSBRPC",273,0)
 ; PCC V Measurement file or "V" for the VA Vitals file.
"RTN","PSBRPC",274,0)
 ;
"RTN","PSBRPC",275,0)
 I $G(DUZ("AG"))="I",$$GET^XPAR("ALL","BEHOVM USE VMSR") D  Q
"RTN","PSBRPC",276,0)
 .K RESULTS
"RTN","PSBRPC",277,0)
 .N PSBNOW,PSBSTRT,VITS,CNT,VTYP,LP,DATA,NODE,XREF
"RTN","PSBRPC",278,0)
 .S XREF("TMP")="T",XREF("PU")="P",XREF("BP")="BP",XREF("RS")="R",XREF("PA")="PN"
"RTN","PSBRPC",279,0)
 .S PSBNOW=$$NOW^XLFDT(),PSBSTRT=$$FMADD^XLFDT(PSBNOW,-168)
"RTN","PSBRPC",280,0)
 .S CNT=0 F LP="TMP","PU","RS","BP","PA" D
"RTN","PSBRPC",281,0)
 ..S VTYP=$$FIND1^DIC(9999999.07,"","BX",LP)
"RTN","PSBRPC",282,0)
 ..I VTYP S VITS(CNT+1)=VTYP,CNT=CNT+1
"RTN","PSBRPC",283,0)
 .D GRID^BEHOVM(.DATA,DFN,PSBNOW,$$FMADD^XLFDT(PSBNOW,"",-168),0,.VITS)
"RTN","PSBRPC",284,0)
 .;BUILD RESULTS ARRAY
"RTN","PSBRPC",285,0)
 .I '$P(@DATA@(0),U,3) D  Q  ; No Results
"RTN","PSBRPC",286,0)
 ..S RESULTS(0)=1,RESULTS(1)="No Vitals to report"
"RTN","PSBRPC",287,0)
 .S (CNT,LP)=0 F  S LP=$O(@DATA@("R",LP)) Q:'LP  D
"RTN","PSBRPC",288,0)
 ..S NODE=@DATA@("R",LP)
"RTN","PSBRPC",289,0)
 ..S RESULTS(CNT+1)=XREF($P(@DATA@(0,$P(NODE,U,2)),U,4))_U_$E($$GET1^DIQ(9000010.01,$P(NODE,U,5),1201,"I"),1,12)_U_DFN_U_$P(NODE,U,3)
"RTN","PSBRPC",290,0)
 ..S CNT=CNT+1
"RTN","PSBRPC",291,0)
 .S RESULTS(0)=CNT
"RTN","PSBRPC",292,0)
 ;
"RTN","PSBRPC",293,0)
 K RESULTS
"RTN","PSBRPC",294,0)
 N PSBSTRT,PSBSTOP,PSBNOW
"RTN","PSBRPC",295,0)
 S PSBDFN=DFN,GMRVSTR="T;P;R;BP;PN"
"RTN","PSBRPC",296,0)
 D NOW^%DTC S PSBNOW=%,PSBSTRT=$$FMADD^XLFDT(PSBNOW,"",-168),PSBSTOP=PSBNOW,GMRVSTR(0)=PSBSTRT_U_PSBSTOP_U_4_U
"RTN","PSBRPC",297,0)
 K ^UTILITY($J,"GMRVD")
"RTN","PSBRPC",298,0)
 D EN1^GMRVUT0
"RTN","PSBRPC",299,0)
 S PSBCNT=1
"RTN","PSBRPC",300,0)
 I '$D(^UTILITY($J,"GMRVD")) S RESULTS(0)=PSBCNT,RESULTS(PSBCNT)="No Vitals to report" Q
"RTN","PSBRPC",301,0)
 S PSBTYP=""
"RTN","PSBRPC",302,0)
 F  S PSBTYP=$O(^UTILITY($J,"GMRVD",PSBTYP)) Q:PSBTYP=""  D
"RTN","PSBRPC",303,0)
 .S PSBRDT=""
"RTN","PSBRPC",304,0)
 .F  S PSBRDT=$O(^UTILITY($J,"GMRVD",PSBTYP,PSBRDT)) Q:PSBRDT=""  D
"RTN","PSBRPC",305,0)
 ..S PSBIEN=""
"RTN","PSBRPC",306,0)
 ..F  S PSBIEN=$O(^UTILITY($J,"GMRVD",PSBTYP,PSBRDT,PSBIEN)) Q:PSBIEN=""  D
"RTN","PSBRPC",307,0)
 ...S PSBDATA=($G(^UTILITY($J,"GMRVD",PSBTYP,PSBRDT,PSBIEN)))
"RTN","PSBRPC",308,0)
 ...S RESULTS(PSBCNT)=PSBTYP_U_$P(PSBDATA,U,1,2)_U_$P(PSBDATA,U,8)
"RTN","PSBRPC",309,0)
 ...S PSBCNT=PSBCNT+1
"RTN","PSBRPC",310,0)
 S RESULTS(0)=PSBCNT-1
"RTN","PSBRPC",311,0)
 K ^UTILITY($J,"GMRVD"),GMRBSTR,PSBDFN,PSBTYPE,PSBDATA,PSBCNT
"RTN","PSBRPC",312,0)
 Q
"RTN","PSBRPC",313,0)
 ;   ;[*70-1489]...start
"RTN","PSBRPC",314,0)
IVBAGPAR(PSBWARD) ; Send Mailman Message to owners of PSB Manager Key if IV Bag Parameters are not set for this Ward
"RTN","PSBRPC",315,0)
 Q:PSBWARD=""
"RTN","PSBRPC",316,0)
 N PSBCSTR,PSBWDIV,PSB,PSBIVT,PSBFLAG,PSBSTNMB,PSBINST,PSBIVPAR
"RTN","PSBRPC",317,0)
 S PSBCSTR="^ADDITIVE^STRENGTH^BOTTLE^SOLUTION^VOLUME^INFUSION RATE^MED ROUTE^SCHEDULE^ADMIN TIME^REMARKS^OTHER PRINT INFO^PROVIDER^START DATE/TIME^STOP DATE/TIME^PROVIDER COMMENTS"
"RTN","PSBRPC",318,0)
 S PSBWARD=$O(^DIC(42,"B",PSBWARD,""))
"RTN","PSBRPC",319,0)
 S PSBWDIV=$$GET1^DIQ(42,PSBWARD_",",.015,"I")
"RTN","PSBRPC",320,0)
 I $G(PSBWDIV)']"" S PSBWDIV="DIV"
"RTN","PSBRPC",321,0)
 E  S PSBWDIV=$P($$SITE^VASITE(DT,PSBWDIV),U,1),PSBWDIV="DIV.`"_PSBWDIV
"RTN","PSBRPC",322,0)
 F PSBIVT="A","P","H","S","C" S PSBIVPAR=PSBIVT D
"RTN","PSBRPC",323,0)
 .F PSBX=2:1 Q:$P(PSBCSTR,U,PSBX)=""  S PSBIVPAR=PSBIVPAR_U_$P($P($$GET^XPAR(PSBWDIV,"PSBIV "_$P(PSBCSTR,U,PSBX),PSBIVT,"B"),U,2),"-",1),^TMP("PSBWARD",PSBX,PSBIVT)=PSBIVPAR I $P(PSBIVPAR,U,PSBX)="" S PSBFLAG=""
"RTN","PSBRPC",324,0)
 S PSBSTNMB=$$GET1^DIQ(4,($P(PSBWDIV,"`",2)),99)
"RTN","PSBRPC",325,0)
 S:PSBSTNMB="" PSBINST=$$GET1^DIQ(4,($P(PSBWDIV,"`",2)),.01)
"RTN","PSBRPC",326,0)
 I $D(PSBFLAG) D
"RTN","PSBRPC",327,0)
 .N XMDUZ,XMSUB,XMTEXT,XMY,PSBERR,PSBMG1,PSBCNT
"RTN","PSBRPC",328,0)
 .S PSBCNT=1
"RTN","PSBRPC",329,0)
 .I PSBSTNMB'="" S XMSUB="ACTION NEEDED! DIV "_PSBSTNMB_" IV PARAMS NOT DEFINED"
"RTN","PSBRPC",330,0)
 .E  S XMSUB=" ACTION NEEDED! INSTITUTION IV PARAMS NOT DEFINED"
"RTN","PSBRPC",331,0)
 .S XMDUZ="BCMA PARAMETERS"
"RTN","PSBRPC",332,0)
 .S XMTEXT="PSBERR("
"RTN","PSBRPC",333,0)
 .S PSBMG1="" F  S PSBMG1=$O(^XUSEC("PSB MANAGER",PSBMG1)) Q:PSBMG1=""  S XMY(PSBMG1)=""
"RTN","PSBRPC",334,0)
 .S PSBERR(PSBCNT)="The IV Bag Parameters are not defined",PSBCNT=PSBCNT+1
"RTN","PSBRPC",335,0)
 .S PSBERR(PSBCNT)="for Ward '"_$$GET1^DIQ(42,PSBWARD,.01)_"', which is associated ",PSBCNT=PSBCNT+1
"RTN","PSBRPC",336,0)
 .I PSBSTNMB'="" S PSBERR(PSBCNT)="with Facility Division #"_PSBSTNMB_" and needs to",PSBCNT=PSBCNT+1
"RTN","PSBRPC",337,0)
 .E  S PSBERR(PSBCNT)="with Institution '"_PSBINST_"' and needs to",PSBCNT=PSBCNT+1
"RTN","PSBRPC",338,0)
 .S PSBERR(PSBCNT)="be set immediately!",PSBCNT=PSBCNT+1
"RTN","PSBRPC",339,0)
 .S PSBERR(PSBCNT)="",PSBCNT=PSBCNT+1
"RTN","PSBRPC",340,0)
 .I PSBSTNMB="" S PSBERR(PSBCNT)="A Station Number is not defined for",PSBCNT=PSBCNT+1 D
"RTN","PSBRPC",341,0)
 ..S PSBERR(PSBCNT)="Institution '"_PSBINST_"'.",PSBCNT=PSBCNT+1
"RTN","PSBRPC",342,0)
 ..S PSBERR(PSBCNT)="Please log a ticket with the VA Service Desk!!",PSBCNT=PSBCNT+1
"RTN","PSBRPC",343,0)
 ..S PSBERR(PSBCNT)="Once a Station Number has been assigned,",PSBCNT=PSBCNT+1
"RTN","PSBRPC",344,0)
 ..S PSBERR(PSBCNT)="please complete the following steps:",PSBCNT=PSBCNT+1
"RTN","PSBRPC",345,0)
 .S:PSBSTNMB'="" PSBERR(PSBCNT)="To do so:  ",PSBCNT=PSBCNT+1
"RTN","PSBRPC",346,0)
 .S PSBERR(PSBCNT)="",PSBCNT=PSBCNT+1
"RTN","PSBRPC",347,0)
 .S PSBERR(PSBCNT)="1. Log into the BCMA Parameters GUI.",PSBCNT=PSBCNT+1
"RTN","PSBRPC",348,0)
 .S PSBERR(PSBCNT)="2. Select Facility Division Number "_PSBSTNMB_".",PSBCNT=PSBCNT+1
"RTN","PSBRPC",349,0)
 .S PSBERR(PSBCNT)="3. Set IV Parameters desired for this Division.",PSBCNT=PSBCNT+1
"RTN","PSBRPC",350,0)
 .S PSBERR(PSBCNT)="4. Select OK.",PSBCNT=PSBCNT+1
"RTN","PSBRPC",351,0)
 .S PSBERR(PSBCNT)="",PSBCNT=PSBCNT+1
"RTN","PSBRPC",352,0)
 .S PSBERR(PSBCNT)="Please log a ticket with the ",PSBCNT=PSBCNT+1
"RTN","PSBRPC",353,0)
 .S PSBERR(PSBCNT)="VA Service Desk if you need assistance.",PSBCNT=PSBCNT+1
"RTN","PSBRPC",354,0)
 .D ^XMD
"RTN","PSBRPC",355,0)
 Q
"RTN","PSBRPC",356,0)
 ;   ;[*70-1489]...end
"RTN","PSBRPC",357,0)
GETLIST(RESULTS,PRE,CONTAIN) ; Get Clinics by name                     ;*70
"RTN","PSBRPC",358,0)
 N LIN
"RTN","PSBRPC",359,0)
 K ^TMP("PSBCLIN",$J)
"RTN","PSBRPC",360,0)
 S RESULTS=$NAME(^TMP("PSBCLIN",$J))
"RTN","PSBRPC",361,0)
 S LIN=0 D CLNLIST(PRE,CONTAIN,.LIN)
"RTN","PSBRPC",362,0)
 ;set total rec counter
"RTN","PSBRPC",363,0)
 I $D(^TMP("PSBCLIN",$J)) D
"RTN","PSBRPC",364,0)
 . S ^TMP("PSBCLIN",$J,0)=LIN
"RTN","PSBRPC",365,0)
 E  D
"RTN","PSBRPC",366,0)
 . S ^TMP("PSBCLIN",$J,0)=1
"RTN","PSBRPC",367,0)
 . S ^TMP("PSBCLIN",$J,1)="-1^Invalid Clinic Lookup"
"RTN","PSBRPC",368,0)
 Q
"RTN","PSBRPC",369,0)
 ;
"RTN","PSBRPC",370,0)
CLNLIST(PR,CON,LN) ;return Clinic list in TMP by name                                *70
"RTN","PSBRPC",371,0)
 N QQ,NODE0,INACTDT,NAME,REACTDT
"RTN","PSBRPC",372,0)
 F QQ=0:0 S QQ=$O(^SC(QQ)) Q:'QQ  D
"RTN","PSBRPC",373,0)
 . S NODE0=$G(^SC(QQ,0)) Q:NODE0=""
"RTN","PSBRPC",374,0)
 . Q:$P(NODE0,U,3)'="C"                     ;type Clinic
"RTN","PSBRPC",375,0)
 . S INACTDT=+$P($G(^SC(QQ,"I")),U)             ;inactive date
"RTN","PSBRPC",376,0)
 . S REACTDT=+$P($G(^SC(QQ,"I")),U,2)
"RTN","PSBRPC",377,0)
 . I INACTDT,INACTDT<DT I 'REACTDT!(REACTDT&((REACTDT<INACTDT)!(REACTDT>DT))) Q
"RTN","PSBRPC",378,0)
 . S NAME=$P(NODE0,U)
"RTN","PSBRPC",379,0)
 . I PR]"" D
"RTN","PSBRPC",380,0)
 .. I $E(NAME,1,$L(PR))=PR,NAME[CON D
"RTN","PSBRPC",381,0)
 ... S LN=LN+1,^TMP("PSBCLIN",$J,LN)=NAME
"RTN","PSBRPC",382,0)
 . E  D
"RTN","PSBRPC",383,0)
 .. I NAME[CON D
"RTN","PSBRPC",384,0)
 ... S LN=LN+1,^TMP("PSBCLIN",$J,LN)=NAME
"RTN","PSBRPC",385,0)
 Q
"RTN","PSBRPC1")
0^44^B25166378^B10114973
"RTN","PSBRPC1",1,0)
PSBRPC1 ;BIRMINGHAM/VN - BCMA RPC BROKER CALLS ;12/3/12 1:17pm
"RTN","PSBRPC1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**42,70**;Mar 2004;Build 101
"RTN","PSBRPC1",3,0)
 ;
"RTN","PSBRPC1",4,0)
 ; Reference/IA
"RTN","PSBRPC1",5,0)
 ; ^%ZIS/812
"RTN","PSBRPC1",6,0)
 ; ^XUSEC/10076
"RTN","PSBRPC1",7,0)
 ; File 200/10060
"RTN","PSBRPC1",8,0)
 ;
"RTN","PSBRPC1",9,0)
 ;*70 - Add new RPC at tag MEDSONPT, to return true/false flags for 3
"RTN","PSBRPC1",10,0)
 ;      key med types and actions:   IV Infusing, IV Stopped, and
"RTN","PSBRPC1",11,0)
 ;      Patch on not removed.
"RTN","PSBRPC1",12,0)
 ;    - add Tags to perform Witness verification, RPC:PSB WITNESS
"RTN","PSBRPC1",13,0)
 ;
"RTN","PSBRPC1",14,0)
DEVICE(RESULTS,FROM,DIR) ;
"RTN","PSBRPC1",15,0)
 ;
"RTN","PSBRPC1",16,0)
 ; RPC: PSB DEVICE
"RTN","PSBRPC1",17,0)
 ;
"RTN","PSBRPC1",18,0)
 ; Return a subset of entries from the Device file
"RTN","PSBRPC1",19,0)
 ;
"RTN","PSBRPC1",20,0)
 ; .LST(n)=IEN;Name^DisplayName^Location^RMar^PLen
"RTN","PSBRPC1",21,0)
 ; FROM=text to $O from, DIR=$O direction
"RTN","PSBRPC1",22,0)
 K RESULTS
"RTN","PSBRPC1",23,0)
 N I,IEN,SHOW,X S I=0,CNT=20
"RTN","PSBRPC1",24,0)
 I FROM["<" S FROM=$RE($P($RE(FROM),"<  ",2))
"RTN","PSBRPC1",25,0)
 F  Q:I'<CNT  S FROM=$O(^%ZIS(1,"B",FROM),DIR) Q:FROM=""  D
"RTN","PSBRPC1",26,0)
 . S IEN=0 F  S IEN=$O(^%ZIS(1,"B",FROM,IEN)) Q:'IEN  D
"RTN","PSBRPC1",27,0)
 .. N X0,X1,X90,X91,X95,XTYPE,XSTYPE,XTIME,%A,%X,POP
"RTN","PSBRPC1",28,0)
 .. Q:'$D(^%ZIS(1,IEN,0))
"RTN","PSBRPC1",29,0)
 .. S X0=$G(^%ZIS(1,IEN,0)),X1=$G(^(1)),X90=$G(^(90)),X91=$G(^(91)),X95=$G(^(95)),XSTYPE=$G(^("SUBTYPE")),XTIME=$G(^("TIME")),XTYPE=$G(^("TYPE"))
"RTN","PSBRPC1",30,0)
 .. I $E($G(^%ZIS(2,+XSTYPE,0)))'="P" Q  ;Printers only
"RTN","PSBRPC1",31,0)
 .. S X=$P(XTYPE,"^")                    ;Device Types
"RTN","PSBRPC1",32,0)
 .. I $G(DUZ("AG"))="V",X'="TRM",X'="HG",X'="HFS",X'="CHAN" Q
"RTN","PSBRPC1",33,0)
 .. I $G(DUZ("AG"))="I",X'="OTH" Q
"RTN","PSBRPC1",34,0)
 .. S X=X0 I ($P(X,U,2)="0")!($P(X,U,12)=2) Q  ;Queuing allowed
"RTN","PSBRPC1",35,0)
 .. S X=+X90 I X,(X'>DT) Q  ;Out of Service
"RTN","PSBRPC1",36,0)
 .. I XTIME]"" S %A=$P(XTIME,"^"),%X=$P($H,",",2),%=%X\60#60+(%X\3600*100),%X=$P(%A,"-",2) I %X'<%A&(%'>%X&(%'<%A))!(%X<%A&(%'<%A!(%'>%X))) Q  ;Prohibited Times
"RTN","PSBRPC1",37,0)
 .. S POP=0
"RTN","PSBRPC1",38,0)
 .. I X95]"" S %X=$G(DUZ(0)) I %X'="@" S POP=1 F %A=1:1:$L(%X) I X95[$E(%X,%A) S POP=0 Q
"RTN","PSBRPC1",39,0)
 .. Q:POP  ;Security check
"RTN","PSBRPC1",40,0)
 .. S SHOW=$P(X0,U) I SHOW'=FROM S SHOW=FROM_"  <"_SHOW_">"
"RTN","PSBRPC1",41,0)
 .. S I=I+1,RESULTS(I)=IEN_";"_$P(X0,U)_U_SHOW_U_$P(X1,U)_U_$P(X91,U)_U_$P(X91,U,3)
"RTN","PSBRPC1",42,0)
 .. S RESULTS(0)=I
"RTN","PSBRPC1",43,0)
 I '$D(RESULTS(0)) S RESULTS(0)=1,RESULTS(1)="-1^No printers on file"
"RTN","PSBRPC1",44,0)
 Q
"RTN","PSBRPC1",45,0)
 ;
"RTN","PSBRPC1",46,0)
GPROV(RESULTS,DUMMY) ;
"RTN","PSBRPC1",47,0)
 K ^TMP("PSB",$J)
"RTN","PSBRPC1",48,0)
 S RESULTS=$NAME(^TMP("PSB",$J)),PSBCNT=1,^TMP("PSB",$J,0)=0
"RTN","PSBRPC1",49,0)
 D NOW^%DTC
"RTN","PSBRPC1",50,0)
 S X="" F  S X=$O(^XUSEC("PROVIDER",X)) Q:X=""  D
"RTN","PSBRPC1",51,0)
 .S PSBIACT=$$GET1^DIQ(200,X_",",53.4,"I") I PSBIACT'="",+PSBIACT'<% Q  ;if Inactive date and date is less than now Q
"RTN","PSBRPC1",52,0)
 .S PSBTERM=$$GET1^DIQ(200,X_",",9.2,"I") I PSBTERM'="",+PSBTERM'<% Q  ;if termination date and date is less than now Q
"RTN","PSBRPC1",53,0)
 .Q:'$$GET1^DIQ(200,X_",",53.1,"I")  ;is authorized to write med orders
"RTN","PSBRPC1",54,0)
 .Q:'$$GET1^DIQ(200,X_",",53.2)  ;must have DEA#
"RTN","PSBRPC1",55,0)
 .S ^TMP("PSBL",$J,$$GET1^DIQ(200,X_",",.01),X)=""
"RTN","PSBRPC1",56,0)
 S X="^TMP(""PSBL"","_$J_")",PSBCNT=1,^TMP("PSB",$J,0)=0
"RTN","PSBRPC1",57,0)
 F  S X=$Q(@X) Q:$QS(X,1)'="PSBL"  S ^TMP("PSB",$J,PSBCNT)=$QS(X,3)_"^"_$QS(X,4),^TMP("PSB",$J,0)=PSBCNT,PSBCNT=PSBCNT+1
"RTN","PSBRPC1",58,0)
 K ^TMP("PSBL",$J),PSBIACT,PSBTERM,PSBAUTH,PSBCNT,DUMMY
"RTN","PSBRPC1",59,0)
 Q
"RTN","PSBRPC1",60,0)
 ;
"RTN","PSBRPC1",61,0)
 ;*70 new tag below attached to RPC: PSB MEDS ON PATIENT
"RTN","PSBRPC1",62,0)
MEDSONPT(RESULTS,DFN) ; Return indicators for 3 types of meds on the patient
"RTN","PSBRPC1",63,0)
 S RESULTS(0)=1
"RTN","PSBRPC1",64,0)
 S $P(RESULTS(1),U,1)=$$INFUSING^PSBVDLU1(DFN)     ;IV's infusing flag
"RTN","PSBRPC1",65,0)
 S $P(RESULTS(1),U,2)=$$STOPPED^PSBVDLU1(DFN)      ;IV's stopped flag
"RTN","PSBRPC1",66,0)
 S $P(RESULTS(1),U,3)=$$PATCHON^PSBVDLU1(DFN)      ;patch on flag
"RTN","PSBRPC1",67,0)
 Q
"RTN","PSBRPC1",68,0)
 ;
"RTN","PSBRPC1",69,0)
WITNESS(RESULTS,PSBACC,PSBVER) ; Validate a witness to a BCMA action    ;*70
"RTN","PSBRPC1",70,0)
 ;
"RTN","PSBRPC1",71,0)
 ;     RPC: PSB WITNESS
"RTN","PSBRPC1",72,0)
 ;   Descr: RPC for validating Acces and Verify codes for a Witness
"RTN","PSBRPC1",73,0)
 ; Used by: frmWitness to validate an witness(s) at the client via
"RTN","PSBRPC1",74,0)
 ;          encrypted A/V Code.
"RTN","PSBRPC1",75,0)
 ;
"RTN","PSBRPC1",76,0)
 N LOGPERS,WITNESS,GUIIEN,PSBGUI,ERR
"RTN","PSBRPC1",77,0)
 S PSBACC=$$DECRYP^XUSRB1(PSBACC)
"RTN","PSBRPC1",78,0)
 S PSBVER=$$DECRYP^XUSRB1(PSBVER)
"RTN","PSBRPC1",79,0)
 S PSBWITN=$$CHECKAV^XUSRB(PSBACC_";"_PSBVER)
"RTN","PSBRPC1",80,0)
 ;
"RTN","PSBRPC1",81,0)
 ; valid ACC & VER code test
"RTN","PSBRPC1",82,0)
 I PSBWITN<1 D WITERR("Invalid Witness sign-on") K PSBWITN Q
"RTN","PSBRPC1",83,0)
 ;
"RTN","PSBRPC1",84,0)
 ; authorized tests
"RTN","PSBRPC1",85,0)
 I $D(^XUSEC("PSB STUDENT",PSBWITN)) D  Q
"RTN","PSBRPC1",86,0)
 . D WITERR("A student does not have authority to witness a High Risk/High Alert administration.")
"RTN","PSBRPC1",87,0)
 I $D(^XUSEC("PSB NO WITNESS",PSBWITN)) D  Q
"RTN","PSBRPC1",88,0)
 . D WITERR("You do not have authority to witness a High Risk/High Alert administration.")
"RTN","PSBRPC1",89,0)
 I $D(^XUSEC("PSB READ ONLY",PSBWITN)) D  Q
"RTN","PSBRPC1",90,0)
 . D WITERR("Read-Only users do not have authority to witness a High Risk/High Alert administration.")
"RTN","PSBRPC1",91,0)
 I DUZ=PSBWITN D WITERR("Cannot Witness for yourself") K PSBWITN Q
"RTN","PSBRPC1",92,0)
 ;** workaround bug in kernel XQCHK, if fixed remove logic ref to
"RTN","PSBRPC1",93,0)
 ;** checking "AP" xref and quits thereof
"RTN","PSBRPC1",94,0)
 N ACCESS
"RTN","PSBRPC1",95,0)
 S ACCESS=$$ACCESS^XQCHK(PSBWITN,"PSB GUI CONTEXT - USER")
"RTN","PSBRPC1",96,0)
 I ACCESS="N" D  Q
"RTN","PSBRPC1",97,0)
 . D WITERR("Invalid VistA user - No Primary menu setup for this user in the NEW PERSON file.")
"RTN","PSBRPC1",98,0)
 ;
"RTN","PSBRPC1",99,0)
 ;Code with ;** comments are extra checks to work around a bug in the
"RTN","PSBRPC1",100,0)
 ;Kernel API used above, and can be removed when this API is fixed.
"RTN","PSBRPC1",101,0)
 I +ACCESS<1 D  Q:ERR         ;can be 0 or negative
"RTN","PSBRPC1",102,0)
 . S ERR=1                                                 ;**
"RTN","PSBRPC1",103,0)
 . S PSBGUI=$O(^DIC(19,"B","PSB GUI CONTEXT - USER",""))   ;**
"RTN","PSBRPC1",104,0)
 . I $D(^VA(200,"AP",PSBGUI,PSBWITN)) S ERR=0 Q            ;**
"RTN","PSBRPC1",105,0)
 . D WITERR("A non-BCMA user does not have authority to witness a High Risk/High Alert administration.")
"RTN","PSBRPC1",106,0)
 ;
"RTN","PSBRPC1",107,0)
 ;error - instructor trying to witness for their student, is handled
"RTN","PSBRPC1",108,0)
 ; by the gui client.
"RTN","PSBRPC1",109,0)
 ;
"RTN","PSBRPC1",110,0)
 ; passed all tests
"RTN","PSBRPC1",111,0)
 S PSBWITN(0)=$$GET1^DIQ(200,PSBWITN_",",.01)
"RTN","PSBRPC1",112,0)
 S RESULTS(0)=PSBWITN_U_PSBWITN(0)
"RTN","PSBRPC1",113,0)
 Q
"RTN","PSBRPC1",114,0)
 ;
"RTN","PSBRPC1",115,0)
WITERR(MSG) ;build witness error msg                                   ;*70
"RTN","PSBRPC1",116,0)
 S RESULTS(0)="-1^"_MSG
"RTN","PSBRPC1",117,0)
 K PSBWITN
"RTN","PSBRPC1",118,0)
 Q
"RTN","PSBRPC3")
0^17^B291796^B309181
"RTN","PSBRPC3",1,0)
PSBRPC3 ;BIRMINGHAM/VRN - BCMA RPC BROKER CALLS ;6/13/12 12:31pm
"RTN","PSBRPC3",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,3,4,16,13,10,32,28,42,58,68,70**;Mar 2004;Build 101
"RTN","PSBRPC3",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBRPC3",4,0)
 ;
"RTN","PSBRPC3",5,0)
GUICHK(RESULTS,DUMMY) ;
"RTN","PSBRPC3",6,0)
 ;
"RTN","PSBRPC3",7,0)
 ; RPC : PSB VERSION CHECK
"RTN","PSBRPC3",8,0)
 ;
"RTN","PSBRPC3",9,0)
 K RESULTS
"RTN","PSBRPC3",10,0)
 N PSBCURR,PSBPREV,PSBCNT
"RTN","PSBRPC3",11,0)
 S PSBCURR="3.0.70.*"
"RTN","PSBRPC3",12,0)
 S PSBPREV="",PSBCNT=0
"RTN","PSBRPC3",13,0)
 S PSBCNT=PSBCNT+1
"RTN","PSBRPC3",14,0)
 S RESULTS(PSBCNT)=PSBCURR_U_PSBPREV
"RTN","PSBRPC3",15,0)
 S RESULTS(0)=PSBCNT
"RTN","PSBRPC3",16,0)
 Q
"RTN","PSBRPC3",17,0)
 ;
"RTN","PSBVAR")
0^41^B15144988^B13715777
"RTN","PSBVAR",1,0)
PSBVAR ;BIRMINGHAM/EFC-BCMA VARIANCE LOG FUNCTIONS ;9/19/12 5:44pm
"RTN","PSBVAR",2,0)
 ;;3.0;BAR CODE MED ADMIN;*31,70*;Mar 2004;Build 101
"RTN","PSBVAR",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSBVAR",4,0)
 ;
"RTN","PSBVAR",5,0)
 ; Reference/IA
"RTN","PSBVAR",6,0)
 ; ^DPT/10035
"RTN","PSBVAR",7,0)
 ; ^DIC(42/10039
"RTN","PSBVAR",8,0)
 ;
"RTN","PSBVAR",9,0)
 ;*70 - alter DD trigger code so Clinic Orders do not update variances
"RTN","PSBVAR",10,0)
 ;
"RTN","PSBVAR",11,0)
EN ;
"RTN","PSBVAR",12,0)
 Q
"RTN","PSBVAR",13,0)
 ;
"RTN","PSBVAR",14,0)
CHKPRN(DFN,PSBMIN,PSBLOG) ;
"RTN","PSBVAR",15,0)
 Q:PSBMIN=""
"RTN","PSBVAR",16,0)
 Q:PSBMIN'>$$GET^XPAR("DIV","PSB ADMIN PRN EFFECT")
"RTN","PSBVAR",17,0)
 D ADD(.RESULTS,DFN,3,PSBMIN,"",PSBLOG)
"RTN","PSBVAR",18,0)
 Q
"RTN","PSBVAR",19,0)
 ;
"RTN","PSBVAR",20,0)
 ;CHECK^PSBVAR() calling point is used to create a new variance entry.
"RTN","PSBVAR",21,0)
 ;  Triggered by Order Administration Variance Field # .14 in the BCMA
"RTN","PSBVAR",22,0)
 ;  Medication Log File (#53.79).
"RTN","PSBVAR",23,0)
 ;
"RTN","PSBVAR",24,0)
CHECK(DFN,PSBMIN,PSBLOG) ;
"RTN","PSBVAR",25,0)
 Q:PSBMIN=""
"RTN","PSBVAR",26,0)
 N RESULTS
"RTN","PSBVAR",27,0)
 ; Checks the timing from the Med Log Entry X-Ref
"RTN","PSBVAR",28,0)
 I PSBMIN<0 D:(PSBMIN*-1)>$$GET^XPAR("DIV","PSB ADMIN BEFORE") ADD(.RESULTS,DFN,2,PSBMIN,"",PSBLOG)
"RTN","PSBVAR",29,0)
 I PSBMIN>0 D:PSBMIN>$$GET^XPAR("DIV","PSB ADMIN AFTER") ADD(.RESULTS,DFN,2,PSBMIN,"",PSBLOG)
"RTN","PSBVAR",30,0)
 Q
"RTN","PSBVAR",31,0)
 ;
"RTN","PSBVAR",32,0)
ADD(RESULTS,DFN,PSBEVNT,PSBMIN,PSBDRUG,PSBLOG) ;
"RTN","PSBVAR",33,0)
 ;
"RTN","PSBVAR",34,0)
 ; DFN:      Patient File (#2) Pointer
"RTN","PSBVAR",35,0)
 ; PSBEVNT:  Event Code (See DD for 53.78)
"RTN","PSBVAR",36,0)
 ; PSBMIN:   Minutes off of schedule (Optional)
"RTN","PSBVAR",37,0)
 ; PSBDRUG:  Drug File (#50) Pointer (Optional)
"RTN","PSBVAR",38,0)
 ; PSBLOG:   BCMA Med Log IEN (Optional)
"RTN","PSBVAR",39,0)
 ;
"RTN","PSBVAR",40,0)
 ;Do not create variance for below events:
"RTN","PSBVAR",41,0)
 ;   Med order with missing dose status.
"RTN","PSBVAR",42,0)
 ;   Clinic orders
"RTN","PSBVAR",43,0)
 ;
"RTN","PSBVAR",44,0)
 I $G(PSBLOG),$P($G(^PSB(53.79,PSBLOG,0)),U,9)="M" Q
"RTN","PSBVAR",45,0)
 Q:($G(PSBCLIN)]"")!($G(PSBCLORD)]"")  ;Clin Flags defined - PSBML *70
"RTN","PSBVAR",46,0)
 ;
"RTN","PSBVAR",47,0)
 N PSBDT,PSBRB,PSBWRD,PSBXX
"RTN","PSBVAR",48,0)
 ;
"RTN","PSBVAR",49,0)
 D EN^DDIOL("Filing Variance...")
"RTN","PSBVAR",50,0)
 D NOW^%DTC
"RTN","PSBVAR",51,0)
 L +(^PSB(53.78,0)):5 E  S RESULTS(0)="-1^Variance Log Locked" Q
"RTN","PSBVAR",52,0)
 S PSBXX=$O(^PSB(53.78,"A"),-1)+1
"RTN","PSBVAR",53,0)
 S $P(^PSB(53.78,0),U,3)=PSBXX
"RTN","PSBVAR",54,0)
 S $P(^PSB(53.78,0),U,4)=$P(^PSB(53.78,0),U,4)+1
"RTN","PSBVAR",55,0)
 ;
"RTN","PSBVAR",56,0)
WARD ;Extract the ward and room/bed information.
"RTN","PSBVAR",57,0)
 ;DFN is pre-defined.
"RTN","PSBVAR",58,0)
 S PSBRB=$P($G(^DPT(DFN,.101)),U)
"RTN","PSBVAR",59,0)
 S PSBRB=$S(PSBRB'="":PSBRB,1:"***")
"RTN","PSBVAR",60,0)
 S PSBWRD=$P($G(^DPT(DFN,.1)),U)
"RTN","PSBVAR",61,0)
 ;Convert Ward Name to Ward IEN
"RTN","PSBVAR",62,0)
 I PSBWRD'="" D
"RTN","PSBVAR",63,0)
 . S PSBDT=%
"RTN","PSBVAR",64,0)
 . S PSBWRD=$$FIND1^DIC(42,"","X",PSBWRD,"","","ERR")
"RTN","PSBVAR",65,0)
 . S %=PSBDT ;reset after $$FIND1^DIC fileman call
"RTN","PSBVAR",66,0)
 S PSBWRD=$S($G(PSBWRD):PSBWRD,1:"***")
"RTN","PSBVAR",67,0)
 ;
"RTN","PSBVAR",68,0)
 ; Set Variance Entry
"RTN","PSBVAR",69,0)
 S ^PSB(53.78,PSBXX,0)=DFN_U_PSBRB_U_DUZ_U_%_U_PSBEVNT_U_$G(PSBMIN)_U_$G(PSBDRUG)_U_$G(PSBLOG)_U_PSBWRD
"RTN","PSBVAR",70,0)
 ;
"RTN","PSBVAR",71,0)
 S ^PSB(53.78,"ADT",%,PSBXX)=""
"RTN","PSBVAR",72,0)
 S ^PSB(53.78,"B",DFN,PSBXX)=""
"RTN","PSBVAR",73,0)
 L -(^PSB(53.78,0))
"RTN","PSBVAR",74,0)
 S RESULTS(0)="1^Data Filed"
"RTN","PSBVAR",75,0)
 Q
"RTN","PSBVAR",76,0)
 ;
"RTN","PSBVAR",77,0)
 ; Unable to UPDATE^DIE WHILE IN UPDATE^DIE
"RTN","PSBVAR",78,0)
 W !,"Filing Variance..."
"RTN","PSBVAR",79,0)
 D EN^DDIOL("Filing Variance...")
"RTN","PSBVAR",80,0)
 N PSBVFDA,PSBVMSG,PSBVIEN
"RTN","PSBVAR",81,0)
 D VAL(.01,"`"_DFN) ; Patient Pointer
"RTN","PSBVAR",82,0)
 S Y=$G(^DPT(DFN,.1),"Unk Ward")_" "_$G(^DPT(DFN,.101),"Unk Bed")
"RTN","PSBVAR",83,0)
 D VAL(.02,Y) ; Patient Location
"RTN","PSBVAR",84,0)
 D VAL(.03,"`"_DUZ) ; New Person Pointer
"RTN","PSBVAR",85,0)
 D VAL(.04,"NOW") ; DT Entered
"RTN","PSBVAR",86,0)
 D VAL(.05,PSBEVNT) ; Event Code
"RTN","PSBVAR",87,0)
 D:$G(PSBMIN) VAL(.06,PSBMIN) ; Minutes Early/Late
"RTN","PSBVAR",88,0)
 D:$G(PSBDRUG) VAL(.07,"`"_PSBDRUG) ; Drug File Pointer
"RTN","PSBVAR",89,0)
 D:$G(PSBLOG) VAL(.08,"`"_PSBLOG)
"RTN","PSBVAR",90,0)
 ; Call UPDATE^DIE and set Results(0)
"RTN","PSBVAR",91,0)
 D UPDATE^DIE("","PSBVFDA","PSBVIEN","PSBVMSG")  ; PSBVFDA set into file 53.68, BCMA MEDICATION VARIANCE LOG at VAL+3
"RTN","PSBVAR",92,0)
 I $D(PSBVMSG) S RESULTS(0)="-1^"_PSBVMSG("DIERR",1)_": "_PSBVMSG("DIERR",1,"TEXT",1)
"RTN","PSBVAR",93,0)
 E  S RESULTS(0)="1^Data Successfully Filed^"_PSBVIEN(1)
"RTN","PSBVAR",94,0)
 W !,RESULTS(0)
"RTN","PSBVAR",95,0)
 Q
"RTN","PSBVAR",96,0)
 ;
"RTN","PSBVAR",97,0)
VAL(PSBVFLD,PSBVVAL) ;
"RTN","PSBVAR",98,0)
 N PSBVRET
"RTN","PSBVAR",99,0)
 K ^TMP("DIERR",$J)
"RTN","PSBVAR",100,0)
 D VAL^DIE(53.78,"+1,",PSBVFLD,"F",PSBVVAL,.PSBVRET,"PSBVFDA")
"RTN","PSBVAR",101,0)
 I PSBVRET="^" F X=0:0 S X=$O(^TMP("DIERR",$J,X)) Q:'X  S Y=^TMP("DIERR",$J,X)_": "_$G(^(X,"TEXT",1),"**"),RESULTS($O(RESULTS(""),-1)+1)="Data Validation Error: "_Y
"RTN","PSBVAR",102,0)
 K ^TMP("DIERR",$J)
"RTN","PSBVAR",103,0)
 Q
"RTN","PSBVAR",104,0)
 ;
"RTN","PSBVDLIV")
0^10^B81051093^B70061917
"RTN","PSBVDLIV",1,0)
PSBVDLIV ;BIRMINGHAM/EFC-BCMA IV VIRTUAL DUE LIST ;1/18/13 2:15pm
"RTN","PSBVDLIV",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,38,32,58,70**;Mar 2004;Build 101
"RTN","PSBVDLIV",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBVDLIV",4,0)
 ;
"RTN","PSBVDLIV",5,0)
 ; Reference/IA
"RTN","PSBVDLIV",6,0)
 ; EN^PSJBCMA/2828
"RTN","PSBVDLIV",7,0)
 ; EN^PSJBCMA1/2829 
"RTN","PSBVDLIV",8,0)
 ; GETPROVL^PSGSICH1/5653
"RTN","PSBVDLIV",9,0)
 ; INTRDIC^PSGSICH1/5654
"RTN","PSBVDLIV",10,0)
 ;
"RTN","PSBVDLIV",11,0)
 ;*58 - add 29th piece to Results for Override/Intervention flag 1/0
"RTN","PSBVDLIV",12,0)
 ;*70 - add 32nd piece to Results for Clinic Order name
"RTN","PSBVDLIV",13,0)
 ;    - add 33rd piece to Results for Clinic ien ptr to file #44
"RTN","PSBVDLIV",14,0)
 ;
"RTN","PSBVDLIV",15,0)
EN(DFN,PSBDT) ; Default Order List Return for Today
"RTN","PSBVDLIV",16,0)
 ;
"RTN","PSBVDLIV",17,0)
 ; RPC: PSB GETORDERLIST
"RTN","PSBVDLIV",18,0)
 ;
"RTN","PSBVDLIV",19,0)
 ; Description:
"RTN","PSBVDLIV",20,0)
 ; Returns the current IV order set for today to display on the
"RTN","PSBVDLIV",21,0)
 ; client VDL
"RTN","PSBVDLIV",22,0)
 ;
"RTN","PSBVDLIV",23,0)
 N PSBDATA,PSBTBOUT,PSBDOADD,PSBDT2,X,PSHIST                ;*70
"RTN","PSBVDLIV",24,0)
 S PSBTBOUT=0,PSBDOADD=0
"RTN","PSBVDLIV",25,0)
 S:PSBTAB="IVTAB" PSBDOADD=1
"RTN","PSBVDLIV",26,0)
 ;
"RTN","PSBVDLIV",27,0)
 ; Passing PSBDT as 3rd parameter turns off the V.1.0 One-Time lookback
"RTN","PSBVDLIV",28,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J,"ON IVTAB")
"RTN","PSBVDLIV",29,0)
 S PSBHIST=$S(PSBCLINORD:-7,1:-3)          ;*70 default hist days back
"RTN","PSBVDLIV",30,0)
 S X1=PSBDT,X2=PSBHIST D C^%DTC S PSBDT2=X                  ;*70
"RTN","PSBVDLIV",31,0)
 D EN^PSJBCMA(DFN,PSBDT2,PSBDT)
"RTN","PSBVDLIV",32,0)
 ;Filter in/out Clinic Orders                               ;*70
"RTN","PSBVDLIV",33,0)
 D:PSBCLINORD INCLUDCO^PSBVDLU1
"RTN","PSBVDLIV",34,0)
 D:'PSBCLINORD REMOVECO^PSBVDLU1
"RTN","PSBVDLIV",35,0)
 ;
"RTN","PSBVDLIV",36,0)
 I $G(^TMP("PSJ",$J,1,0))=-1 Q  ; No orders
"RTN","PSBVDLIV",37,0)
 ;
"RTN","PSBVDLIV",38,0)
 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:('PSBX)!(PSBTBOUT)  D
"RTN","PSBVDLIV",39,0)
 .N PSBRTNOW S PSBRTNOW=$$NOW^XLFDT()
"RTN","PSBVDLIV",40,0)
 .D CLEAN^PSBVT,PSJ^PSBVT(PSBX)
"RTN","PSBVDLIV",41,0)
 .;
"RTN","PSBVDLIV",42,0)
 .; << Standard checks for ALL orders >>
"RTN","PSBVDLIV",43,0)
 .;
"RTN","PSBVDLIV",44,0)
 .Q:PSBONX'["V"  ; IVs only
"RTN","PSBVDLIV",45,0)
 .Q:PSBIVT["P"  ; No piggybacks
"RTN","PSBVDLIV",46,0)
 .Q:PSBONX["P"  ;     No Pending Orders
"RTN","PSBVDLIV",47,0)
 .Q:('PSBCLINORD)&(PSBOST>($$FMADD^XLFDT($$NOW^XLFDT,,,$$GET^XPAR("DIV","PSB ADMIN BEFORE"))))    ;*70 don't check this for CO's
"RTN","PSBVDLIV",48,0)
 .Q:($G(PSBCLORD)]"")&(PSBOST>PSBRTNOW)   ;CL order start day in future *70
"RTN","PSBVDLIV",49,0)
 .;
"RTN","PSBVDLIV",50,0)
 .; Need to see if "last order" in chain is active/not pending.
"RTN","PSBVDLIV",51,0)
 .S PSBFON1=PSBFON,PSBLOOP=0 I $G(PSBFON)]"" S PSBLACTV=$S($G(PSBFON)["P":0,1:1) S PSBFON2=$G(PSBFON) I 'PSBLACTV F  D  Q:($G(PSBFON)="")!($G(PSBFON1)=$G(PSBFON2))!(PSBLOOP)!(PSBLACTV)  ;
"RTN","PSBVDLIV",52,0)
 ..I $G(PSBFON)["P" K ^TMP("PSJ1",$J) D EN^PSJBCMA1(DFN,PSBFON2,1) I ^TMP("PSJ1",$J,0)=-1 S PSBFON=""
"RTN","PSBVDLIV",53,0)
 ..D:$G(PSBFON)["" CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBFON2)
"RTN","PSBVDLIV",54,0)
 ..I PSBFON=PSBFON2 S PSBLOOP=1,PSBLACTV=0 Q
"RTN","PSBVDLIV",55,0)
 ..S PSBLACTV=$S($G(PSBFON)["P":0,$G(PSBFON)']"":PSBLACTV,1:1),PSBFON2=$G(PSBFON)
"RTN","PSBVDLIV",56,0)
 ..S:(PSBLACTV)&($G(PSBOST)>($$FMADD^XLFDT($$NOW^XLFDT,,,$$GET^XPAR("DIV","PSB ADMIN BEFORE")))) PSBLACTV=0
"RTN","PSBVDLIV",57,0)
 .D CLEAN^PSBVT,PSJ^PSBVT(PSBX) ;Refresh data
"RTN","PSBVDLIV",58,0)
 .K PSBCOMP,PSBCOMPX,PSBINFDT,PSBINFST D INFUSING^PSBVDLU2
"RTN","PSBVDLIV",59,0)
 .D NOW^%DTC
"RTN","PSBVDLIV",60,0)
 .I ((PSBOSTS="A")!(PSBOSTS="R"))&(PSBOSP<%) S PSBOSTS="E"
"RTN","PSBVDLIV",61,0)
 .I (PSBOSTS["D")&(PSBCOMP=0) Q  ;     Is it DC'd and not infusing or stopped
"RTN","PSBVDLIV",62,0)
 .I PSBOSTS="E",PSBCOMP=0 Q  ; Is expired and not infusing or stopped
"RTN","PSBVDLIV",63,0)
 .I PSBOSTS="D",PSBCOMP=1,($G(PSBFON)]""),PSBLACTV Q  ; order is DC'ed   will be picked up by following order
"RTN","PSBVDLIV",64,0)
 .I PSBOSTS="E",PSBCOMP=1,($G(PSBFON)]""),PSBLACTV Q  ; order is expired will be picked up by following order
"RTN","PSBVDLIV",65,0)
 .I PSBOSTS="R",PSBFOR="R",PSBOSP<PSBWBEG Q  ; order is renewed bag picked up by following order
"RTN","PSBVDLIV",66,0)
 .Q:$G(^TMP("PSB",$J,"ON IVTAB",PSBDFN,PSBONX))=1  ; The "previous order" is displayed on the VDL!
"RTN","PSBVDLIV",67,0)
 .I (PSBOSTS["E")&(PSBCOMP=0) Q  ;     Is it expired and not infusing
"RTN","PSBVDLIV",68,0)
 .I PSBIVT["S",PSBISYR=1 Q  ;     No intermittent syringes - done on PB tab
"RTN","PSBVDLIV",69,0)
 .I PSBIVT["C",PSBISYR=1 Q  ;     No intermittent syringes - done on PB tab
"RTN","PSBVDLIV",70,0)
 .I PSBIVT["C",PSBCHEMT="P" Q  ;  No Piggyback Chemos
"RTN","PSBVDLIV",71,0)
 .I PSBNGF&(PSBCOMP=1) Q  ;         Is it marked DO NOT GIVE!
"RTN","PSBVDLIV",72,0)
 .;
"RTN","PSBVDLIV",73,0)
 .; Non One-Times with stop date/time < now
"RTN","PSBVDLIV",74,0)
 .;
"RTN","PSBVDLIV",75,0)
 .D NOW^%DTC
"RTN","PSBVDLIV",76,0)
 .I PSBOSP<%,PSBOSTS'="R",PSBCOMP'=1 Q
"RTN","PSBVDLIV",77,0)
 .;
"RTN","PSBVDLIV",78,0)
 .; include Active, Renewed, ReInstated and On Call and Hold and Expired infusing
"RTN","PSBVDLIV",79,0)
 .; (Is it not one time)&(Is it not active or renewed or On Call or Hold)
"RTN","PSBVDLIV",80,0)
 .Q:PSBSCHT'="O"&((PSBOSTS'="A")&(PSBOSTS'="R")&(PSBOSTS'="RE")&(PSBOSTS'="O")&(PSBOSTS'="D")&(PSBOSTS'="H")&(PSBOSTS'="E"))
"RTN","PSBVDLIV",81,0)
 .;
"RTN","PSBVDLIV",82,0)
 .; Is One Time Given
"RTN","PSBVDLIV",83,0)
 .;
"RTN","PSBVDLIV",84,0)
 .I PSBSCHT="O" D  Q:PSBGVN
"RTN","PSBVDLIV",85,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBVDLIV",86,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBVDLIV",87,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBVDLIV",88,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBON,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBVDLIV",89,0)
 .;
"RTN","PSBVDLIV",90,0)
 .; Is On-Call Given, Can it be given more than once
"RTN","PSBVDLIV",91,0)
 .;
"RTN","PSBVDLIV",92,0)
 .I PSBSCHT="OC" D  Q:PSBGVN&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL"))
"RTN","PSBVDLIV",93,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBVDLIV",94,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBVDLIV",95,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBVDLIV",96,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBON,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBVDLIV",97,0)
 .;
"RTN","PSBVDLIV",98,0)
OK .S PSBSTRT=PSBOST ; Order Start Date/Time
"RTN","PSBVDLIV",99,0)
 .S PSBSTOP=PSBOSP ; Order Stop Date/Time
"RTN","PSBVDLIV",100,0)
 .;
"RTN","PSBVDLIV",101,0)
 .S PSBREC=""
"RTN","PSBVDLIV",102,0)
 .S $P(PSBREC,U,1)=DFN ; dfn
"RTN","PSBVDLIV",103,0)
 .S $P(PSBREC,U,2)=PSBONX ; Order
"RTN","PSBVDLIV",104,0)
 .S $P(PSBREC,U,3)=+PSBON ; order ien
"RTN","PSBVDLIV",105,0)
 .S $P(PSBREC,U,4)=PSBOTYP ; iv/ud/pending
"RTN","PSBVDLIV",106,0)
 .S $P(PSBREC,U,5)=PSBSCHT ; schedule type
"RTN","PSBVDLIV",107,0)
 .S $P(PSBREC,U,6)=PSBSCH ; schedule
"RTN","PSBVDLIV",108,0)
 .S Y=""
"RTN","PSBVDLIV",109,0)
 .S:PSBSM Y="SM"
"RTN","PSBVDLIV",110,0)
 .S:PSBHSM Y="HSM"
"RTN","PSBVDLIV",111,0)
 .S $P(PSBREC,U,7)=Y ; self med
"RTN","PSBVDLIV",112,0)
 .S $P(PSBREC,U,8)=PSBOITX ; drugname
"RTN","PSBVDLIV",113,0)
 .S $P(PSBREC,U,9)=PSBDOSE_" "_PSBIFR ; dosage
"RTN","PSBVDLIV",114,0)
 .S $P(PSBREC,U,10)=PSBMR ; med route
"RTN","PSBVDLIV",115,0)
 .; IV Information Column *new*  -  status date/time
"RTN","PSBVDLIV",116,0)
 .; (only stopped or infusing)
"RTN","PSBVDLIV",117,0)
 .;
"RTN","PSBVDLIV",118,0)
 .D:PSBCOMP 
"RTN","PSBVDLIV",119,0)
 ..S $P(PSBREC,U,11)=PSBINFDT K PSBINFDT
"RTN","PSBVDLIV",120,0)
 ..S PSBSTUS=PSBINFST,$P(PSBREC,U,20)=PSBSTUS K PSBINFST
"RTN","PSBVDLIV",121,0)
 .S $P(PSBREC,U,14)="" ; admin date inserted below
"RTN","PSBVDLIV",122,0)
 .S $P(PSBREC,U,15)=PSBOIT ; OI Pointer
"RTN","PSBVDLIV",123,0)
 .S $P(PSBREC,U,16)=PSBNJECT  ;Set injectable med route flag
"RTN","PSBVDLIV",124,0)
 .; Variable dosage entered as ####-####?
"RTN","PSBVDLIV",125,0)
 .I $P(PSBREC,U,9)?1.4N1"-"1.4N.E S $P(PSBREC,U,17)=1
"RTN","PSBVDLIV",126,0)
 .E  S $P(PSBREC,U,17)=0
"RTN","PSBVDLIV",127,0)
 .S $P(PSBREC,U,18)=PSBIVT  ;IV TYPE
"RTN","PSBVDLIV",128,0)
 .S $P(PSBREC,U,21)=PSBOST
"RTN","PSBVDLIV",129,0)
 .S $P(PSBREC,U,22)=PSBOSTS
"RTN","PSBVDLIV",130,0)
 .S $P(PSBREC,U,26)=PSBSTOP
"RTN","PSBVDLIV",131,0)
 .S $P(PSBREC,U,27)=$$LASTG^PSBCSUTL(DFN,PSBOIT)
"RTN","PSBVDLIV",132,0)
 .;*58 determine if override or intervn exists, send 1/0 (true/false)
"RTN","PSBVDLIV",133,0)
 .N PSBARR D GETPROVL^PSGSICH1(DFN,PSBONX,.PSBARR)
"RTN","PSBVDLIV",134,0)
 .I $O(PSBARR(""))="" D INTRDIC^PSGSICH1(DFN,PSBONX,.PSBARR,2)
"RTN","PSBVDLIV",135,0)
 .S $P(PSBREC,U,29)=$S($O(PSBARR(""))]"":1,1:0)
"RTN","PSBVDLIV",136,0)
 .;       piece 30 reserved by UNIT DOSE tab for last injection
"RTN","PSBVDLIV",137,0)
 .;       piece 31 reserved by IVPB tab for injection flag
"RTN","PSBVDLIV",138,0)
 .S $P(PSBREC,U,32)=$G(PSBCLORD)                 ;clinic name          *70
"RTN","PSBVDLIV",139,0)
 .S $P(PSBREC,U,33)=$G(PSBCLIEN)                 ;clinic ien ptr       *70
"RTN","PSBVDLIV",140,0)
 .;
"RTN","PSBVDLIV",141,0)
 .; Gather Dispense Drugs
"RTN","PSBVDLIV",142,0)
 .D NOW^%DTC
"RTN","PSBVDLIV",143,0)
 .S (PSBDDS,PSBSOLS,PSBADDS)="0"
"RTN","PSBVDLIV",144,0)
 .F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBVDLIV",145,0)
 ..Q:$P(PSBDDA(Y),U,4)&($P(PSBDDA(Y),U,4)<%)  ; Inactive
"RTN","PSBVDLIV",146,0)
 ..S:$P(PSBDDA(Y),U,3)="" $P(PSBDDA(Y),U,3)=1
"RTN","PSBVDLIV",147,0)
 ..S PSBDDS=PSBDDS_U_$P(PSBDDA(Y),U,1,3)
"RTN","PSBVDLIV",148,0)
 ..S $P(PSBDDS,U,1)=PSBDDS+1
"RTN","PSBVDLIV",149,0)
 .; On-Call One Time PRN orders
"RTN","PSBVDLIV",150,0)
 .S PSBQRR=0
"RTN","PSBVDLIV",151,0)
 .I "^O^OC^P^"[(U_PSBSCHT_U) D  Q
"RTN","PSBVDLIV",152,0)
 ..I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"IVTAB",0)=2,^TMP("PSB",$J,"IVTAB",1)=1,^TMP("PSB",$J,"IVTAB",2)=1 Q
"RTN","PSBVDLIV",153,0)
 ..D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1,PSBDDS,PSBSOLS,PSBADDS,"IVTAB")
"RTN","PSBVDLIV",154,0)
 ..S:$G(PSBFON)'="" ^TMP("PSB",$J,"ON IVTAB",PSBDFN,PSBFON)=1  ; Now do not have to place "following order" on VDL!
"RTN","PSBVDLIV",155,0)
 .;
"RTN","PSBVDLIV",156,0)
 .; IV's - don't worry about admin times if blank
"RTN","PSBVDLIV",157,0)
 .I PSBONX["V",PSBIVT'="P",PSBADST="" D  Q
"RTN","PSBVDLIV",158,0)
 ..I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"IVTAB",0)=2,^TMP("PSB",$J,"IVTAB",1)=1,^TMP("PSB",$J,"IVTAB",2)=1 Q
"RTN","PSBVDLIV",159,0)
 ..D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1_".",PSBDDS,PSBSOLS,PSBADDS,"IVTAB")
"RTN","PSBVDLIV",160,0)
 ..S:$G(PSBFON)'="" ^TMP("PSB",$J,"ON IVTAB",PSBDFN,PSBFON)=1  ; Now do not have to place "following order" on VDL!
"RTN","PSBVDLIV",161,0)
 .;
"RTN","PSBVDLIV",162,0)
 .; Now we deal with only continuous
"RTN","PSBVDLIV",163,0)
 .; process admintimes
"RTN","PSBVDLIV",164,0)
 .S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBVDLIV",165,0)
 .S PSBADMIN=PSBADST
"RTN","PSBVDLIV",166,0)
 .; process admin times against beginning and ending date
"RTN","PSBVDLIV",167,0)
 .; build all orders for both days.
"RTN","PSBVDLIV",168,0)
 .F PSBY=1:1 Q:$P(PSBADMIN,"-",PSBY)=""  D
"RTN","PSBVDLIV",169,0)
 ..; apply this time to the beginning window date
"RTN","PSBVDLIV",170,0)
 ..S PSB=+(PSBWBEG\1_"."_$P(PSBADMIN,"-",PSBY))
"RTN","PSBVDLIV",171,0)
 ..D:(PSB'<PSBWBEG)&(PSB'>PSBWEND)  ; Make sure it is in the window
"RTN","PSBVDLIV",172,0)
 ...D:(PSB'<PSBSTRT)&(PSB<PSBSTOP)  ; Make sure this time is active
"RTN","PSBVDLIV",173,0)
 ....D:$$OKAY^PSBVDLU1(PSBSTRT,$P(PSB,"."),PSBSCH,PSBON,PSBOITX,PSBFREQ)  ; Okay on this date?
"RTN","PSBVDLIV",174,0)
 .....I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"IVTAB",0)=2,^TMP("PSB",$J,"IVTAB",1)=1,^TMP("PSB",$J,"IVTAB",2)=1 Q
"RTN","PSBVDLIV",175,0)
 .....D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"IVTAB")
"RTN","PSBVDLIV",176,0)
 .....S:$G(PSBFON)'="" ^TMP("PSB",$J,"ON IVTAB",PSBDFN,PSBFON)=1  ; Now do not have to place "following order" on VDL!
"RTN","PSBVDLIV",177,0)
 ..;
"RTN","PSBVDLIV",178,0)
 ..Q:(PSBWBEG\1)=(PSBWEND\1)  ; Window only has one day rare but possible
"RTN","PSBVDLIV",179,0)
 ..;
"RTN","PSBVDLIV",180,0)
 ..; apply this time to the ending window date
"RTN","PSBVDLIV",181,0)
 ..S PSB=+(PSBWEND\1_"."_$P(PSBADMIN,"-",PSBY))
"RTN","PSBVDLIV",182,0)
 ..D:(PSB'<PSBWBEG)&(PSB'>PSBWEND)  ; Make sure it is in the window
"RTN","PSBVDLIV",183,0)
 ...D:(PSB'<PSBSTRT)&(PSB<PSBSTOP)  ; Make sure this time is active
"RTN","PSBVDLIV",184,0)
 ....D:$$OKAY^PSBVDLU1(PSBSTRT,$P(PSB,"."),PSBSCH,PSBON,PSBOITX,PSBFREQ)  ; Okay on this date?
"RTN","PSBVDLIV",185,0)
 .....I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"IVTAB",0)=2,^TMP("PSB",$J,"IVTAB",1)=1,^TMP("PSB",$J,"IVTAB",2)=1 Q
"RTN","PSBVDLIV",186,0)
 .....D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"IVTAB")
"RTN","PSBVDLIV",187,0)
 .....S:$G(PSBFON)'="" ^TMP("PSB",$J,"ON IVTAB",PSBDFN,PSBFON)=1  ; Now do not have to place "following order" on VDL!
"RTN","PSBVDLIV",188,0)
 K ^TMP("PSB",$J,"ON IVTAB")
"RTN","PSBVDLIV",189,0)
 ;
"RTN","PSBVDLIV",190,0)
 ;add initials of verifying pharmacist/verifying nurse
"RTN","PSBVDLIV",191,0)
 D:PSBDOADD VNURSE^PSBVDLU1("IVTAB")
"RTN","PSBVDLIV",192,0)
 Q
"RTN","PSBVDLIV",193,0)
 ;
"RTN","PSBVDLPA")
0^30^B22291163^B16689356
"RTN","PSBVDLPA",1,0)
PSBVDLPA ;BIRMINGHAM/EFC-BCMA UNIT DOSE VIRTUAL DUE LIST FUNCTIONS ;3/1/13 1:13pm
"RTN","PSBVDLPA",2,0)
 ;;3.0;BAR CODE MED ADMIN;**5,16,13,38,32,58,70**;Mar 2004;Build 101
"RTN","PSBVDLPA",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBVDLPA",4,0)
 ;
"RTN","PSBVDLPA",5,0)
 ; called by PSBVDLUD to find patches not removed
"RTN","PSBVDLPA",6,0)
 ;
"RTN","PSBVDLPA",7,0)
 ; Reference/IA
"RTN","PSBVDLPA",8,0)
 ; $$GET^XPAR/2263
"RTN","PSBVDLPA",9,0)
 ; $$FMADD^XLFDT/10103
"RTN","PSBVDLPA",10,0)
 ; GETPROVL^PSGSICH1/5653
"RTN","PSBVDLPA",11,0)
 ; INTRDIC^PSGSICH1/5654
"RTN","PSBVDLPA",12,0)
 ;
"RTN","PSBVDLPA",13,0)
 ;*58 - add 29th piece to Results for Override/Intervention flag 1/0
"RTN","PSBVDLPA",14,0)
 ;*70 - add 30th piece for consistency with psbvdlud routine.
"RTN","PSBVDLPA",15,0)
 ;    - add 32nd piece for clinic name for CO meds and a patch.
"RTN","PSBVDLPA",16,0)
 ;    - add 33rd piece to Results for Clinic ien ptr to file #44
"RTN","PSBVDLPA",17,0)
 ;      
"RTN","PSBVDLPA",18,0)
EN ;
"RTN","PSBVDLPA",19,0)
 S PSBGNODE="^PSB(53.79,"_"""APATCH"""_","_DFN_")"
"RTN","PSBVDLPA",20,0)
 F  S PSBGNODE=$Q(@PSBGNODE) Q:PSBGNODE']""  Q:($QS(PSBGNODE,2)'="APATCH")!($QS(PSBGNODE,3)'=DFN)  D
"RTN","PSBVDLPA",21,0)
 .S PSBIEN=$QS(PSBGNODE,5)
"RTN","PSBVDLPA",22,0)
 .I '$D(^PSB(53.79,PSBIEN,.5,1)) Q
"RTN","PSBVDLPA",23,0)
 .I $P(^PSB(53.79,PSBIEN,.5,1,0),U,4)'="PATCH" Q
"RTN","PSBVDLPA",24,0)
 .I "G"'[$P(^PSB(53.79,PSBIEN,0),U,9)!($D(PSBONVDL(PSBIEN))) Q
"RTN","PSBVDLPA",25,0)
 .S PSBPBK=+($$GET^XPAR("DIV","PSB VDL PATCH DAYS"))
"RTN","PSBVDLPA",26,0)
 .S PSBZON=$P(^PSB(53.79,PSBIEN,.1),"^")
"RTN","PSBVDLPA",27,0)
 .D CLEAN^PSBVT
"RTN","PSBVDLPA",28,0)
 .D PSJ1^PSBVT(DFN,PSBZON) Q:$G(PSBSCRT)=-1
"RTN","PSBVDLPA",29,0)
 .;
"RTN","PSBVDLPA",30,0)
 .I PSBPBK'=0 D NOW^%DTC I ($$FMADD^XLFDT($P(PSBOSP,"."),(PSBPBK))<X) Q
"RTN","PSBVDLPA",31,0)
 .S $P(PSBREC,U,1)=DFN  ; dfn
"RTN","PSBVDLPA",32,0)
 .S $P(PSBREC,U,2)=PSBONX  ; order numer
"RTN","PSBVDLPA",33,0)
 .S $P(PSBREC,U,3)=PSBON  ; order ien
"RTN","PSBVDLPA",34,0)
 .S $P(PSBREC,U,4)="U"  ; order type U unit dose
"RTN","PSBVDLPA",35,0)
 .S $P(PSBREC,U,5)=PSBSCHT
"RTN","PSBVDLPA",36,0)
 .S $P(PSBREC,U,6)=PSBSCH
"RTN","PSBVDLPA",37,0)
 .S $P(PSBREC,U,7)=$S(PSBHSM:"HSM",PSBSM:"SM",1:"")
"RTN","PSBVDLPA",38,0)
 .S $P(PSBREC,U,8)=PSBOITX
"RTN","PSBVDLPA",39,0)
 .S $P(PSBREC,U,9)=PSBDOSE
"RTN","PSBVDLPA",40,0)
 .S $P(PSBREC,U,10)=PSBMR
"RTN","PSBVDLPA",41,0)
 .S:$D(PSBHSTAX(PSBOIT)) $P(PSBREC,U,11)=$O(PSBHSTAX(PSBOIT,""),-1),$P(PSBREC,U,20)=$O(PSBHSTAX(PSBOIT,$P(PSBREC,U,11),""),-1)
"RTN","PSBVDLPA",42,0)
 .D:'$D(PSBHSTAX(PSBOIT))
"RTN","PSBVDLPA",43,0)
 ..N PSBX,PSBY,PSBDONE S PSBDONE=0,PSBX="" F  S PSBX=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,PSBX),-1) Q:PSBX=""  D:'PSBDONE
"RTN","PSBVDLPA",44,0)
 ...S PSBY="" F  S PSBY=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,PSBX,PSBY),-1) Q:PSBY=""  D:'PSBDONE
"RTN","PSBVDLPA",45,0)
 ....S:$P(^PSB(53.79,PSBY,0),U,9)'="N" $P(PSBREC,U,20)=$P(^PSB(53.79,PSBY,0),U,9) S:($P(PSBREC,U,20)'="N")&($P(PSBREC,U,20)]"") $P(PSBREC,U,11)=PSBX,PSBDONE=1
"RTN","PSBVDLPA",46,0)
 .S $P(PSBREC,U,12)=PSBIEN
"RTN","PSBVDLPA",47,0)
 .S $P(PSBREC,U,13)="G"
"RTN","PSBVDLPA",48,0)
 .S $P(PSBREC,U,14)=$P(^PSB(53.79,PSBIEN,.1),U,3)
"RTN","PSBVDLPA",49,0)
 .I $P(PSBREC,U,14)="" S $P(PSBREC,U,14)=PSBNOW\1
"RTN","PSBVDLPA",50,0)
 .S $P(PSBREC,U,15)=PSBOIT
"RTN","PSBVDLPA",51,0)
 .D:($G(PSBTAB)="CVRSHT")!($G(PSBTAB)="UDTAB")
"RTN","PSBVDLPA",52,0)
 ..S $P(PSBREC,U,16)=PSBNJECT            ;always send this flag   *70
"RTN","PSBVDLPA",53,0)
 ..I $P(PSBREC,U,9)?1.4N1"-"1.4N.E S $P(PSBREC,U,17)=1
"RTN","PSBVDLPA",54,0)
 ..E  S $P(PSBREC,U,17)=0
"RTN","PSBVDLPA",55,0)
 ..S $P(PSBREC,U,19)=$S(PSBVNI]"":PSBVNI,PSBVNI']"":"***")
"RTN","PSBVDLPA",56,0)
 ..S $P(PSBREC,U,23)=""
"RTN","PSBVDLPA",57,0)
 ..S $P(PSBREC,U,26)=PSBOSP
"RTN","PSBVDLPA",58,0)
 ..S $P(PSBREC,U,27)=$$LASTG^PSBCSUTL($P(PSBREC,U),$P(PSBREC,U,15))
"RTN","PSBVDLPA",59,0)
 ..S $P(PSBREC,U,28)=0
"RTN","PSBVDLPA",60,0)
 ..I ($G(PSBTAB)="CVRSHT") S $P(PSBREC,U,28)=1
"RTN","PSBVDLPA",61,0)
 ..I ($G(PSBTAB)="UDTAB") I PSBSCHT'="O" S:(PSBOSTS="E")!(PSBOSTS["D") $P(PSBREC,U,28)=1
"RTN","PSBVDLPA",62,0)
 ..;*58 determine if override or intervn exists, send 1/0 (true/false)
"RTN","PSBVDLPA",63,0)
 ..N PSBARR D GETPROVL^PSGSICH1(DFN,PSBONX,.PSBARR)
"RTN","PSBVDLPA",64,0)
 ..I $O(PSBARR(""))="" D INTRDIC^PSGSICH1(DFN,PSBONX,.PSBARR,2)
"RTN","PSBVDLPA",65,0)
 ..S $P(PSBREC,U,29)=$S($O(PSBARR(""))]"":1,1:0)
"RTN","PSBVDLPA",66,0)
 ..;add last site                                                  *70
"RTN","PSBVDLPA",67,0)
 ..K LI D RPC^PSBINJEC(.LI,DFN,PSBOIT,9999999,1)
"RTN","PSBVDLPA",68,0)
 ..S $P(PSBREC,U,30)=$P(LI(1),U,6) K LI   ;if no inj, 6th will be null
"RTN","PSBVDLPA",69,0)
 ..;    piece 31 special IVPB use in vdl's not for coversheet
"RTN","PSBVDLPA",70,0)
 ..I $G(PSBTAB)="CVRSHT" D      ;If from coversheet use offset -1  *70
"RTN","PSBVDLPA",71,0)
 ...S $P(PSBREC,U,31)=$G(PSBCLORD)             ;clinic name
"RTN","PSBVDLPA",72,0)
 ...S $P(PSBREC,U,32)=$G(PSBCLIEN)             ;clinic ien ptr
"RTN","PSBVDLPA",73,0)
 ..I $G(PSBTAB)="UDTAB" D       ;Else must be Unit does VDL calling
"RTN","PSBVDLPA",74,0)
 ...S $P(PSBREC,U,32)=$G(PSBCLORD)                  ;clinic name
"RTN","PSBVDLPA",75,0)
 ...S $P(PSBREC,U,33)=$G(PSBCLIEN)                  ;clinic ien ptr
"RTN","PSBVDLPA",76,0)
 ..;
"RTN","PSBVDLPA",77,0)
 ..; Place into Coversheet activity ARRAY
"RTN","PSBVDLPA",78,0)
 ..S PSBDIDX="" I $D(^PSB(53.79,"AORD",DFN,PSBONX)) D
"RTN","PSBVDLPA",79,0)
 ...S PSBXDTI="",PSBXDTI=$O(^PSB(53.79,"AORD",DFN,PSBONX,PSBXDTI),-1)
"RTN","PSBVDLPA",80,0)
 ...Q:'$D(^PSB(53.79,"AORD",DFN,PSBONX,PSBXDTI,PSBIEN))
"RTN","PSBVDLPA",81,0)
 ...S PSBADMX(PSBONX,PSBXDTI,PSBIEN)="",PSBDIDX=1
"RTN","PSBVDLPA",82,0)
 ..I ('PSBDIDX)&$D(^PSB(53.79,"AORDX",DFN,PSBONX)) D
"RTN","PSBVDLPA",83,0)
 ...S PSBXXDTI="",PSBXXDTI=$O(^PSB(53.79,"AORDX",DFN,PSBONX,PSBXXDTI),-1)
"RTN","PSBVDLPA",84,0)
 ...Q:'$D(^PSB(53.79,"AORDX",DFN,PSBONX,PSBXXDTI,PSBIEN))
"RTN","PSBVDLPA",85,0)
 ...S PSBADMX(PSBONX,PSBXXDTI,PSBIEN)=""
"RTN","PSBVDLPA",86,0)
 .S $P(PSBREC,U,18)="PATCH"
"RTN","PSBVDLPA",87,0)
 .S $P(PSBREC,U,21)=PSBOST
"RTN","PSBVDLPA",88,0)
 .S $P(PSBREC,U,22)=PSBOSTS
"RTN","PSBVDLPA",89,0)
 .S PSBDDS="" F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  S:$P(PSBDDA(Y),U,4)="" $P(PSBDDA(Y),U,4)=1 S PSBDDS=PSBDDS_U_$P(PSBDDA(Y),U,1,4),$P(PSBDDS,U,1)=PSBDDS+1
"RTN","PSBVDLPA",90,0)
 .S PSBQRR=1
"RTN","PSBVDLPA",91,0)
 .D ADD^PSBVDLU1(PSBREC,PSBOTXT,$P(PSBREC,U,14),PSBDDS,"","",$S($G(PSBTAB)="CVRSHT":"CVRSHT",1:"UDTAB"))
"RTN","PSBVDLPA",92,0)
 K PSBPBK,PSBONVDL
"RTN","PSBVDLPA",93,0)
 Q
"RTN","PSBVDLPB")
0^11^B106147258^B99542907
"RTN","PSBVDLPB",1,0)
PSBVDLPB ;BIRMINGHAM/EFC-BCMA IV VIRTUAL DUE ;1/32/13 1:23pm
"RTN","PSBVDLPB",2,0)
 ;;3.0;BAR CODE MED ADMIN;**11,13,38,32,58,68,70**;Mar 2004;Build 101
"RTN","PSBVDLPB",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBVDLPB",4,0)
 ;
"RTN","PSBVDLPB",5,0)
 ; Reference/IA
"RTN","PSBVDLPB",6,0)
 ; $$GET^XPAR/2263
"RTN","PSBVDLPB",7,0)
 ; File 200/10060
"RTN","PSBVDLPB",8,0)
 ; GETPROVL^PSGSICH1/5653
"RTN","PSBVDLPB",9,0)
 ; INTRDIC^PSGSICH1/5654
"RTN","PSBVDLPB",10,0)
 ;
"RTN","PSBVDLPB",11,0)
 ;*58 - add 29th piece to Results for Override/Intervention flag 1/0
"RTN","PSBVDLPB",12,0)
 ;*68 - add 30th piece to Results for Last Injection Site and
"RTN","PSBVDLPB",13,0)
 ;    - add 31st piece to Results for Piggyback tab to know the IV
"RTN","PSBVDLPB",14,0)
 ;      order is rotation type injectable.
"RTN","PSBVDLPB",15,0)
 ;*70 - add 32nd piece to Results for Clinic Order name
"RTN","PSBVDLPB",16,0)
 ;    - add 33rd piece to Results for Clinic ien ptr to file #44
"RTN","PSBVDLPB",17,0)
 ;
"RTN","PSBVDLPB",18,0)
EN(DFN,PSBDT) ; Default Order List Return for Today
"RTN","PSBVDLPB",19,0)
 ;
"RTN","PSBVDLPB",20,0)
 ; RPC: PSB GETORDERLIST
"RTN","PSBVDLPB",21,0)
 ;
"RTN","PSBVDLPB",22,0)
 ; Description:
"RTN","PSBVDLPB",23,0)
 ; Returns the current IV order set for today to display on the
"RTN","PSBVDLPB",24,0)
 ; client VDL
"RTN","PSBVDLPB",25,0)
 ;
"RTN","PSBVDLPB",26,0)
 ;
"RTN","PSBVDLPB",27,0)
 N PSBDATA,PSBTBOUT
"RTN","PSBVDLPB",28,0)
 S PSBTBOUT=0,PSBDOADD=0
"RTN","PSBVDLPB",29,0)
 S:PSBTAB="PBTAB" PSBDOADD=1
"RTN","PSBVDLPB",30,0)
 ;
"RTN","PSBVDLPB",31,0)
 ;This routine now re-uses the ^TMP("PSJ",$J global built in PSBVDLTB
"RTN","PSBVDLPB",32,0)
 ;
"RTN","PSBVDLPB",33,0)
 I $G(^TMP("PSJ",$J,1,0))=-1 Q  ; No orders
"RTN","PSBVDLPB",34,0)
 ;
"RTN","PSBVDLPB",35,0)
 N RTBL D BLDTBL^PSBINJEC(.RTBL)  ;build valid IV rotable inj *68
"RTN","PSBVDLPB",36,0)
 ;
"RTN","PSBVDLPB",37,0)
 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:('PSBX)!(PSBTBOUT)  D
"RTN","PSBVDLPB",38,0)
 .N PSBRTNOW S PSBRTNOW=$$NOW^XLFDT()
"RTN","PSBVDLPB",39,0)
 .D CLEAN^PSBVT,PSJ^PSBVT(PSBX)
"RTN","PSBVDLPB",40,0)
 .;
"RTN","PSBVDLPB",41,0)
 .; << Standard checks for ALL orders >>
"RTN","PSBVDLPB",42,0)
 .;
"RTN","PSBVDLPB",43,0)
 .Q:PSBONX["P"              ;No Pending Orders
"RTN","PSBVDLPB",44,0)
 .Q:'$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBIVPSH)  ;Is Piggyback
"RTN","PSBVDLPB",45,0)
 .Q:PSBOST>PSBWADM          ;Order Start Date/Time > admin window
"RTN","PSBVDLPB",46,0)
 .Q:($G(PSBCLORD)]"")&(PSBOST>PSBRTNOW)   ;CO Order start date is in future
"RTN","PSBVDLPB",47,0)
 .Q:PSBOSP<PSBWBEG          ;For all Order Stop Date/Time < vdl window
"RTN","PSBVDLPB",48,0)
 .Q:PSBOSTS["D"             ;Is it DC'd
"RTN","PSBVDLPB",49,0)
 .Q:PSBNGF                  ;Is it marked DO NOT GIVE!
"RTN","PSBVDLPB",50,0)
 .; Non One-Times with stop date/time < now
"RTN","PSBVDLPB",51,0)
 .;
"RTN","PSBVDLPB",52,0)
 .D NOW^%DTC
"RTN","PSBVDLPB",53,0)
 .Q:PSBOSP<%
"RTN","PSBVDLPB",54,0)
 .;
"RTN","PSBVDLPB",55,0)
 .; include Active, Renewed, ReInstated and On Call
"RTN","PSBVDLPB",56,0)
 .; (Is it not one time)&(Is it not active or renewed or On Call)
"RTN","PSBVDLPB",57,0)
 .Q:PSBSCHT'="O"&((PSBOSTS'="A")&(PSBOSTS'="R")&(PSBOSTS'="RE")&(PSBOSTS'="O")&(PSBOSTS'="H"))
"RTN","PSBVDLPB",58,0)
 .;
"RTN","PSBVDLPB",59,0)
 .; Is One Time Given
"RTN","PSBVDLPB",60,0)
 .;
"RTN","PSBVDLPB",61,0)
 .I PSBSCHT="O" D  Q:PSBGVN
"RTN","PSBVDLPB",62,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBVDLPB",63,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBVDLPB",64,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  S:($P(^PSB(53.79,Y,.1),U)=PSBONX)&($P(^PSB(53.79,Y,0),U,9)="G") PSBGVN=1,(X,Y)=0
"RTN","PSBVDLPB",65,0)
 .;
"RTN","PSBVDLPB",66,0)
 .; How long does One Time remain on VDL ?
"RTN","PSBVDLPB",67,0)
 .S PSBRMN=1
"RTN","PSBVDLPB",68,0)
 .I PSBSCHT="O",PSBOSP'=PSBOST,%>PSBOSP S PSBRMN=0
"RTN","PSBVDLPB",69,0)
 .Q:'PSBRMN
"RTN","PSBVDLPB",70,0)
 .;
"RTN","PSBVDLPB",71,0)
 .; Is On-Call Given, Can it be given more than once
"RTN","PSBVDLPB",72,0)
 .;
"RTN","PSBVDLPB",73,0)
 .I PSBSCHT="OC" D  Q:PSBGVN&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL"))
"RTN","PSBVDLPB",74,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBVDLPB",75,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBVDLPB",76,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  S:($P(^PSB(53.79,Y,.1),U)=PSBON)&($P(^PSB(53.79,Y,0),U,9)="G") PSBGVN=1,(X,Y)=0
"RTN","PSBVDLPB",77,0)
 .;
"RTN","PSBVDLPB",78,0)
 .S PSBSTRT=PSBOST ; Order Start Date/Time
"RTN","PSBVDLPB",79,0)
 .S PSBSTOP=PSBOSP ; Order Stop Date/Time
"RTN","PSBVDLPB",80,0)
 .;
"RTN","PSBVDLPB",81,0)
 .S PSBREC=""
"RTN","PSBVDLPB",82,0)
 .S $P(PSBREC,U,1)=DFN ; dfn
"RTN","PSBVDLPB",83,0)
 .S $P(PSBREC,U,2)=PSBONX ; Order
"RTN","PSBVDLPB",84,0)
 .S $P(PSBREC,U,3)=+PSBON ; order ien
"RTN","PSBVDLPB",85,0)
 .S $P(PSBREC,U,4)=PSBOTYP ; iv/ud/pending
"RTN","PSBVDLPB",86,0)
 .S $P(PSBREC,U,5)=PSBSCHT ; schedule type
"RTN","PSBVDLPB",87,0)
 .S $P(PSBREC,U,6)=PSBSCH ; schedule
"RTN","PSBVDLPB",88,0)
 .S Y=""
"RTN","PSBVDLPB",89,0)
 .S:PSBSM Y="SM"
"RTN","PSBVDLPB",90,0)
 .S:PSBHSM Y="HSM"
"RTN","PSBVDLPB",91,0)
 .S $P(PSBREC,U,7)=Y ; self med
"RTN","PSBVDLPB",92,0)
 .S $P(PSBREC,U,8)=PSBOITX ; drugname
"RTN","PSBVDLPB",93,0)
 .S $P(PSBREC,U,9)=PSBDOSE_" "_PSBIFR ; dosage
"RTN","PSBVDLPB",94,0)
 .S $P(PSBREC,U,10)=PSBMR ;med route
"RTN","PSBVDLPB",95,0)
 .; Last Given from the AOIP X-Ref - not given status not excepted
"RTN","PSBVDLPB",96,0)
 .S (YZ,PSBSTUS,PSBADMER)="" K PSBHSTA,PSBHSTAX
"RTN","PSBVDLPB",97,0)
 .F XZ=1:1:20 S YZ=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,YZ),-1),(PSBCNT,PSBFLAG)=0 Q:YZ=""  D
"RTN","PSBVDLPB",98,0)
 ..S:YZ>0 $P(PSBREC,U,11)=YZ
"RTN","PSBVDLPB",99,0)
 ..S X="" F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,YZ,X),-1) Q:X=""  D
"RTN","PSBVDLPB",100,0)
 ...K PSBLCK L +^PSB(53.79,X):1  I  L -^PSB(53.79,X) S PSBLCK=1
"RTN","PSBVDLPB",101,0)
 ...S PSBSTUS=$P(^PSB(53.79,X,0),U,9)
"RTN","PSBVDLPB",102,0)
 ...I $G(PSBSTUS)="" S:'$G(PSBLCK) PSBSTUS="X" I $G(PSBLCK) S PSBADMER=1 D
"RTN","PSBVDLPB",103,0)
 ....K PSBPARM3,PSBPARM5,PSBPARM6,PSBPARM7
"RTN","PSBVDLPB",104,0)
 ....S PSBPARM6=X,Y=$P(^PSB(53.79,X,.1),U,3) D DD^%DT S PSBPARM3=Y,Y=$P(^PSB(53.79,X,0),U,6) D DD^%DT S PSBPARM5=Y
"RTN","PSBVDLPB",105,0)
 ....S PSBPARM7=$P(^PSB(53.79,X,0),U,7) S PSBPARM7="( # "_PSBPARM7_" ) "_$$GET1^DIQ(200,PSBPARM7_",",.01)
"RTN","PSBVDLPB",106,0)
 ....K PSBXTMP S PSBXTMP=PSBONX
"RTN","PSBVDLPB",107,0)
 ....D CLEAN^PSBVT,PSJ1^PSBVT(DFN,$$GET1^DIQ(53.79,PSBPARM6_",",.11))
"RTN","PSBVDLPB",108,0)
 ....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,PSBPARM3_" admin's ACTION STATUS is ""UNKNOWN"".",PSBSCH,PSBPARM5,PSBPARM6,PSBPARM7) ;  SEND AN E-MAIL
"RTN","PSBVDLPB",109,0)
 ....D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBXTMP)  ;Reset Variables
"RTN","PSBVDLPB",110,0)
 ....S X=PSBPARM6 K PSBPARM3,PSBPARM5,PSBPARM6,PSBPARM7
"RTN","PSBVDLPB",111,0)
 ...K PSBLCK S:(PSBSTUS']"") PSBSTUS="U"  I PSBSTUS'="N",($G(PSBSTUS)'="X") S PSBFLAG=1,PSBHSTA(YZ,$G(PSBSTUS))="ORIG"_U_X
"RTN","PSBVDLPB",112,0)
 ...D:PSBSTUS="N"
"RTN","PSBVDLPB",113,0)
 ....S $P(PSBREC,U,11)=""
"RTN","PSBVDLPB",114,0)
 ....S Z="" F  S Z=$O(^PSB(53.79,X,.9,Z),-1) Q:'Z  Q:PSBFLAG=1  S PSBDATA=$G(^(Z,0)) D
"RTN","PSBVDLPB",115,0)
 .....I (PSBDATA["Set to 'NOT GIVEN'")!(PSBDATA["Set to 'GIVEN'")!(PSBDATA["Set to 'REFUSED'")!(PSBDATA["Set to 'HELD'")!(PSBDATA["Set to 'MISSING DOSE'")!(PSBDATA["Set to 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBVDLPB",116,0)
 .....I (PSBDATA["STATUS 'HELD'")!(PSBDATA["STATUS 'GIVEN'")!(PSBDATA["STATUS 'REFUSED'")!(PSBDATA["STATUS 'MISSING DOSE'")!(PSBDATA["STATUS 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBVDLPB",117,0)
 .....I PSBCNT#2=0,PSBDATA["'REFUSED'" S PSBSTUS="R" D LAST^PSBVDLU1
"RTN","PSBVDLPB",118,0)
 .....I PSBCNT#2=0,PSBDATA["'HELD'" S PSBSTUS="H" D LAST^PSBVDLU1
"RTN","PSBVDLPB",119,0)
 .....I PSBCNT#2=0,PSBDATA["'MISSING DOSE'" S PSBSTUS="M" D LAST^PSBVDLU1
"RTN","PSBVDLPB",120,0)
 .....I PSBCNT#2=0,PSBDATA["'REMOVED'" S PSBSTUS="RM" D LAST^PSBVDLU1
"RTN","PSBVDLPB",121,0)
 .....I PSBFLAG=1,'$D(PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))) S PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))=Z_U_X
"RTN","PSBVDLPB",122,0)
 .I $D(PSBHSTA) S $P(PSBREC,U,11)=$O(PSBHSTA(""),-1),PSBSTUS=$O(PSBHSTA($P(PSBREC,U,11),""),-1) M PSBHSTAX(PSBOIT)=PSBHSTA K PSBHSTA  ;last action date/time
"RTN","PSBVDLPB",123,0)
 .S $P(PSBREC,U,12)=""  ;med log ien inserted below for actual date
"RTN","PSBVDLPB",124,0)
 .S $P(PSBREC,U,13)=""  ;med log status inserted below for actual date
"RTN","PSBVDLPB",125,0)
 .S $P(PSBREC,U,14)="" ;admin date inserted below
"RTN","PSBVDLPB",126,0)
 .S $P(PSBREC,U,15)=PSBOIT ; OI Pointer
"RTN","PSBVDLPB",127,0)
 .S $P(PSBREC,U,16)=PSBNJECT  ;Set injectable med route flag
"RTN","PSBVDLPB",128,0)
 .; Variable dosage entered as ####-####?
"RTN","PSBVDLPB",129,0)
 .I $P(PSBREC,U,9)?1.4N1"-"1.4N.E S $P(PSBREC,U,17)=1
"RTN","PSBVDLPB",130,0)
 .E  S $P(PSBREC,U,17)=0
"RTN","PSBVDLPB",131,0)
 .S $P(PSBREC,U,18)=PSBIVT  ;IV TYPE - dosage form
"RTN","PSBVDLPB",132,0)
 .S $P(PSBREC,U,20)=$S((PSBSTUS="X")!(PSBSTUS="N"):"",1:PSBSTUS) ;last action status
"RTN","PSBVDLPB",133,0)
 .S $P(PSBREC,U,21)=PSBOST
"RTN","PSBVDLPB",134,0)
 .S $P(PSBREC,U,22)=PSBOSTS
"RTN","PSBVDLPB",135,0)
 .S $P(PSBREC,U,26)=PSBSTOP
"RTN","PSBVDLPB",136,0)
 .S $P(PSBREC,U,27)=$$LASTG^PSBCSUTL(DFN,PSBOIT)
"RTN","PSBVDLPB",137,0)
 .;*58 determine if override exists, send 1/0 (true/false)
"RTN","PSBVDLPB",138,0)
 .N PSBARR D GETPROVL^PSGSICH1(DFN,PSBONX,.PSBARR)
"RTN","PSBVDLPB",139,0)
 .I $O(PSBARR(""))="" D INTRDIC^PSGSICH1(DFN,PSBONX,.PSBARR,2)
"RTN","PSBVDLPB",140,0)
 .S $P(PSBREC,U,29)=$S($O(PSBARR(""))]"":1,1:0)
"RTN","PSBVDLPB",141,0)
 .;*68 inject rotation flag, send 1/0 (true/false)
"RTN","PSBVDLPB",142,0)
 .I PSBONX["V" D
"RTN","PSBVDLPB",143,0)
 ..N STDRTE S STDRTE=$$GET1^DIQ(51.2,PSBMRIEN,10)
"RTN","PSBVDLPB",144,0)
 ..S $P(PSBREC,U,31)=$$IVROTATN^PSBINJEC(.RTBL,STDRTE,PSBIVT,PSBISYR)
"RTN","PSBVDLPB",145,0)
 ..;*68 if param 31 is 1 then go get last injection site for param 30
"RTN","PSBVDLPB",146,0)
 ..I $P(PSBREC,U,31)=1 D
"RTN","PSBVDLPB",147,0)
 ...N LI D RPC^PSBINJEC(.LI,DFN,PSBOIT,9999999,1)
"RTN","PSBVDLPB",148,0)
 ...S $P(PSBREC,U,30)=$P(LI(1),U,6)   ;if no inj's, 6th will be null
"RTN","PSBVDLPB",149,0)
 .S $P(PSBREC,U,32)=$G(PSBCLORD)  ;clinic name          *70
"RTN","PSBVDLPB",150,0)
 .S $P(PSBREC,U,33)=$G(PSBCLIEN)  ;clinic ien ptr       *70
"RTN","PSBVDLPB",151,0)
 .;
"RTN","PSBVDLPB",152,0)
 .; Gather Dispense Drugs
"RTN","PSBVDLPB",153,0)
 .D NOW^%DTC
"RTN","PSBVDLPB",154,0)
 .S (PSBDDS,PSBSOLS,PSBADDS)="0"
"RTN","PSBVDLPB",155,0)
 .F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBVDLPB",156,0)
 ..Q:$P(PSBDDA(Y),U,4)&($P(PSBDDA(Y),U,4)<%)  ; Inactive
"RTN","PSBVDLPB",157,0)
 ..S:$P(PSBDDA(Y),U,3)="" $P(PSBDDA(Y),U,3)=1
"RTN","PSBVDLPB",158,0)
 ..S PSBDDS=PSBDDS_U_$P(PSBDDA(Y),U,1,3)
"RTN","PSBVDLPB",159,0)
 ..S $P(PSBDDS,U,1)=PSBDDS+1
"RTN","PSBVDLPB",160,0)
 .; On-Call One Time PRN orders
"RTN","PSBVDLPB",161,0)
 .S PSBQRR=0
"RTN","PSBVDLPB",162,0)
 .;*70 if Order start dates > than the day being viewed, don't show
"RTN","PSBVDLPB",163,0)
 .I "^O^OC^P^"[(U_PSBSCHT_U) D  Q
"RTN","PSBVDLPB",164,0)
 ..Q:PSBCLINORD&($P(PSBOST,".")>PSBDT)           ;*70
"RTN","PSBVDLPB",165,0)
 ..I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"PBTAB",0)=2,^TMP("PSB",$J,"PBTAB",1)=1,^TMP("PSB",$J,"PBTAB",2)=1 Q
"RTN","PSBVDLPB",166,0)
 ..D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1,PSBDDS,PSBSOLS,PSBADDS,"PBTAB")
"RTN","PSBVDLPB",167,0)
 .;
"RTN","PSBVDLPB",168,0)
 .; IV's - don't worry about admin times if blank
"RTN","PSBVDLPB",169,0)
 .I PSBONX["V","PSC"'[PSBIVT,PSBADST="" D  Q
"RTN","PSBVDLPB",170,0)
 ..I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"PBTAB",0)=2,^TMP("PSB",$J,"PBTAB",1)=1,^TMP("PSB",$J,"PBTAB",2)=1 Q
"RTN","PSBVDLPB",171,0)
 ..D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1_".",PSBDDS,PSBSOLS,PSBADDS,"PBTAB")
"RTN","PSBVDLPB",172,0)
 .;
"RTN","PSBVDLPB",173,0)
 .; Now we deal with only continuous
"RTN","PSBVDLPB",174,0)
 .; process admintimes
"RTN","PSBVDLPB",175,0)
 .S (PSBYES,PSBODD,PSBYTF)=0
"RTN","PSBVDLPB",176,0)
 .S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBVDLPB",177,0)
 .I PSBYES,PSBADST="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH) Q
"RTN","PSBVDLPB",178,0)
 .F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1,PSBYTF=1
"RTN","PSBVDLPB",179,0)
 .I PSBSCHT="C",PSBYTF="1",PSBADST="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH) Q
"RTN","PSBVDLPB",180,0)
 .S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBVDLPB",181,0)
 .I PSBFREQ="O" S PSBFREQ=1440
"RTN","PSBVDLPB",182,0)
 .I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBVDLPB",183,0)
 .I 'PSBYES,PSBFREQ<1 D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH) Q
"RTN","PSBVDLPB",184,0)
 .S PSBADMIN=PSBADST
"RTN","PSBVDLPB",185,0)
 .I (PSBADMIN="")&(+PSBFREQ>0) D ODDSCH^PSBVDLU1("PBTAB") Q  ;calculate admin times based on frequency
"RTN","PSBVDLPB",186,0)
 .; No admin times, MAYDAY MAYDAY!!
"RTN","PSBVDLPB",187,0)
 .I +PSBFREQ>0 I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBVDLPB",188,0)
 .I PSBODD,PSBADST'="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Administration Times on ODD SCHEDULE",PSBSCH) Q
"RTN","PSBVDLPB",189,0)
 .; process admin times against beginning and ending date
"RTN","PSBVDLPB",190,0)
 .; build all orders for both days.
"RTN","PSBVDLPB",191,0)
 .F PSBY=1:1 Q:$P(PSBADMIN,"-",PSBY)=""  D
"RTN","PSBVDLPB",192,0)
 ..;For invalid admin times
"RTN","PSBVDLPB",193,0)
 ..I ($P(PSBADST,"-",PSBY)'?2N)&($P(PSBADST,"-",PSBY)'?4N) D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid Admin times",PSBSCH)
"RTN","PSBVDLPB",194,0)
 ..; apply this time to the beginning window date
"RTN","PSBVDLPB",195,0)
 ..S PSB=+(PSBWBEG\1_"."_$P(PSBADMIN,"-",PSBY))
"RTN","PSBVDLPB",196,0)
 ..D:(PSB'<PSBWBEG)&(PSB'>PSBWEND)  ; Make sure it is in the window
"RTN","PSBVDLPB",197,0)
 ...D:(PSB'<PSBSTRT)&(PSB<PSBSTOP)  ; Make sure this time is active
"RTN","PSBVDLPB",198,0)
 ....D:$$OKAY^PSBVDLU1(PSBSTRT,PSB,PSBSCH,PSBON,PSBOITX,PSBFREQ,PSBOSTS)  ; Okay on this date?
"RTN","PSBVDLPB",199,0)
 .....I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"PBTAB",0)=2,^TMP("PSB",$J,"PBTAB",1)=1,^TMP("PSB",$J,"PBTAB",2)=1 Q
"RTN","PSBVDLPB",200,0)
 .....D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"PBTAB")
"RTN","PSBVDLPB",201,0)
 ..;
"RTN","PSBVDLPB",202,0)
 ..Q:(PSBWBEG\1)=(PSBWEND\1)  ; Window only has one day rare but possible
"RTN","PSBVDLPB",203,0)
 ..;
"RTN","PSBVDLPB",204,0)
 ..; apply this time to the ending window date
"RTN","PSBVDLPB",205,0)
 ..S PSB=+(PSBWEND\1_"."_$P(PSBADMIN,"-",PSBY))
"RTN","PSBVDLPB",206,0)
 ..D:(PSB'<PSBWBEG)&(PSB'>PSBWEND)  ; Make sure it is in the window
"RTN","PSBVDLPB",207,0)
 ...D:(PSB'<PSBSTRT)&(PSB<PSBSTOP)  ; Make sure this time is active
"RTN","PSBVDLPB",208,0)
 ....D:$$OKAY^PSBVDLU1(PSBSTRT,PSB,PSBSCH,PSBON,PSBOITX,PSBFREQ,PSBOSTS)  ; Okay on this date?
"RTN","PSBVDLPB",209,0)
 .....I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"PBTAB",0)=2,^TMP("PSB",$J,"PBTAB",1)=1,^TMP("PSB",$J,"PBTAB",2)=1 Q
"RTN","PSBVDLPB",210,0)
 .....D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"PBTAB")
"RTN","PSBVDLPB",211,0)
 ;
"RTN","PSBVDLPB",212,0)
 ;add initials of verifying pharmacist/verifying nurse
"RTN","PSBVDLPB",213,0)
 D:PSBDOADD VNURSE^PSBVDLU1("PBTAB")
"RTN","PSBVDLPB",214,0)
 Q
"RTN","PSBVDLPB",215,0)
 ;
"RTN","PSBVDLTB")
0^5^B33639693^B13695318
"RTN","PSBVDLTB",1,0)
PSBVDLTB ;BIRMINGHAM/EFC-BCMA VIRTUAL DUE LIST FUNCTIONS (CONT) ;3/19/13 19:13pm
"RTN","PSBVDLTB",2,0)
 ;;3.0;BAR CODE MED ADMIN;**3,4,16,68,70**;Mar 2004;Build 101
"RTN","PSBVDLTB",3,0)
 ;
"RTN","PSBVDLTB",4,0)
 ; Reference/IA
"RTN","PSBVDLTB",5,0)
 ; EN^PSJBCMA/2828
"RTN","PSBVDLTB",6,0)
 ; IN5^VADPT/10061
"RTN","PSBVDLTB",7,0)
 ; DEM^VADPT/10061
"RTN","PSBVDLTB",8,0)
 ; INP^VADPT/10061
"RTN","PSBVDLTB",9,0)
 ; $$FMADD^XLFDT/10103
"RTN","PSBVDLTB",10,0)
 ; $$GET^XPAR/2263
"RTN","PSBVDLTB",11,0)
 ; 
"RTN","PSBVDLTB",12,0)
 ;*68 - add new parameter to use new SI/OPI word processing fields
"RTN","PSBVDLTB",13,0)
 ;*70 - add Clinic order request IN param flag (true/false 0/1).
"RTN","PSBVDLTB",14,0)
 ;      also add to return array(1) 6th, 7th piece = IM & CO ord count
"RTN","PSBVDLTB",15,0)
 ;      also add to return array order line 32 piece, Clinic name for 
"RTN","PSBVDLTB",16,0)
 ;      CO orders.
"RTN","PSBVDLTB",17,0)
 ;
"RTN","PSBVDLTB",18,0)
 ; ** Warning: PSBSIOPI & PSBCLINORD will be used as global variables
"RTN","PSBVDLTB",19,0)
 ;             for all down stream calls from this RPC tag.
"RTN","PSBVDLTB",20,0)
 ;
"RTN","PSBVDLTB",21,0)
RPC(RESULTS,DFN,PSBTAB,PSBDT,PSBSIOPI,PSBCLINORD,PSBSRCHDIR) ;
"RTN","PSBVDLTB",22,0)
 N PSBCNT,PSBORDCNT,PSBPATCH,PSBINFUS,PSBIVSTP,PSBA               ;*70
"RTN","PSBVDLTB",23,0)
 K RESULTS,^TMP("PSB",$J),^TMP("PSJ",$J)
"RTN","PSBVDLTB",24,0)
 S PSBSIOPI=+$G(PSBSIOPI)   ;*68 init to 0 if not present or 1 if sent
"RTN","PSBVDLTB",25,0)
 S PSBCLINORD=+$G(PSBCLINORD)                   ;*70 set to 0 if NULL
"RTN","PSBVDLTB",26,0)
 S PSBSRCHDIR=$$UP^XLFSTR($G(PSBSRCHDIR))       ;*70 set to NULL/upper
"RTN","PSBVDLTB",27,0)
 S PSBTRFL=0
"RTN","PSBVDLTB",28,0)
 S RESULTS=$NAME(^TMP("PSB",$J,PSBTAB))
"RTN","PSBVDLTB",29,0)
 ;
"RTN","PSBVDLTB",30,0)
 Q:$$DECEASED(DFN)
"RTN","PSBVDLTB",31,0)
 ;
"RTN","PSBVDLTB",32,0)
 ;Set date & time window varaibles
"RTN","PSBVDLTB",33,0)
 ;
"RTN","PSBVDLTB",34,0)
 S PSBNOW=+$G(PSBDT)
"RTN","PSBVDLTB",35,0)
 I 'PSBNOW D NOW^%DTC S PSBNOW=+$E(%,1,10)
"RTN","PSBVDLTB",36,0)
 S PSBDT=$P(PSBNOW,".",1)
"RTN","PSBVDLTB",37,0)
 ;
"RTN","PSBVDLTB",38,0)
 ;check if fast search requested and valid direction passed, then
"RTN","PSBVDLTB",39,0)
 ; get the next date tha order data exists and Not Given
"RTN","PSBVDLTB",40,0)
 I PSBCLINORD,(PSBSRCHDIR="B")!(PSBSRCHDIR="F") D
"RTN","PSBVDLTB",41,0)
 . N PSBSRCHDT,SRCHDIR
"RTN","PSBVDLTB",42,0)
 . S SRCHDIR=$S(PSBSRCHDIR="B":-1,1:1)
"RTN","PSBVDLTB",43,0)
 . S PSBSRCHDT=$$FINDORD^PSBVDLU1(SRCHDIR,DFN,PSBDT,PSBTAB)
"RTN","PSBVDLTB",44,0)
 . S:PSBSRCHDT'=-1 (PSBNOW,PSBDT)=PSBSRCHDT
"RTN","PSBVDLTB",45,0)
 ;
"RTN","PSBVDLTB",46,0)
 ;*70 - if CO, set window of time to the entire day
"RTN","PSBVDLTB",47,0)
 I PSBCLINORD D
"RTN","PSBVDLTB",48,0)
 .S PSBWBEG=$P(PSBDT,".")_".0000"
"RTN","PSBVDLTB",49,0)
 .S PSBWEND=$P(PSBDT,".")_".2400"
"RTN","PSBVDLTB",50,0)
 E  D
"RTN","PSBVDLTB",51,0)
 .S PSBWBEG=$$FMADD^XLFDT(PSBNOW,"",-12)
"RTN","PSBVDLTB",52,0)
 .S PSBWEND=$$FMADD^XLFDT(PSBNOW,"",12)
"RTN","PSBVDLTB",53,0)
 ;
"RTN","PSBVDLTB",54,0)
 ;Create variable for valid order start date/time against admin window
"RTN","PSBVDLTB",55,0)
 S PSBWADM=$$GET^XPAR("DIV","PSB ADMIN BEFORE")
"RTN","PSBVDLTB",56,0)
 S:PSBCLINORD PSBWADM=99999
"RTN","PSBVDLTB",57,0)
 S PSBWADM=$$FMADD^XLFDT(PSBNOW,"","",+PSBWADM)
"RTN","PSBVDLTB",58,0)
 ;
"RTN","PSBVDLTB",59,0)
 ;Use last movement for API
"RTN","PSBVDLTB",60,0)
 S VAIP("D")="LAST" D IN5^VADPT S PSBTRDT=+VAIP(3),PSBTRTYP=$P(VAIP(2),U,2),PSBMVTYP=$P(VAIP(4),U,2) K VAIP
"RTN","PSBVDLTB",61,0)
 ;
"RTN","PSBVDLTB",62,0)
 ;Get patient transfer notification timeframe to determine pop-up box
"RTN","PSBVDLTB",63,0)
 S PSBPTTR=$$GET^XPAR("DIV","PSB PATIENT TRANSFER") I PSBPTTR="" S PSBPTTR=72
"RTN","PSBVDLTB",64,0)
 D NOW^%DTC S PSBNTDT=$$FMADD^XLFDT(%,"",-PSBPTTR) I PSBNTDT'>PSBTRDT S PSBTRFL=1
"RTN","PSBVDLTB",65,0)
 ;
"RTN","PSBVDLTB",66,0)
 ;Passing PSBDT as 3rd parameter turns off the V.1.0 One-Time lookback
"RTN","PSBVDLTB",67,0)
 ;*70 check if IM or CO orders exists for mode lights
"RTN","PSBVDLTB",68,0)
 S PSBORDCNT=$$MODELITE^PSBVDLU1                ;mode lights
"RTN","PSBVDLTB",69,0)
 S PSBPATCH=$$PATCHON^PSBVDLU1(DFN,.PSBA)       ;patch on light
"RTN","PSBVDLTB",70,0)
 S:PSBA("I") $P(PSBORDCNT,U)=1 S:PSBA("C") $P(PSBORDCNT,U,2)=1
"RTN","PSBVDLTB",71,0)
 S PSBIVSTP=$$STOPPED^PSBVDLU1(DFN,.PSBA)       ;IV stopped light
"RTN","PSBVDLTB",72,0)
 S:PSBA("I") $P(PSBORDCNT,U)=1 S:PSBA("C") $P(PSBORDCNT,U,2)=1
"RTN","PSBVDLTB",73,0)
 S PSBINFUS=$$INFUSING^PSBVDLU1(DFN,.PSBA)      ;IV infusing light
"RTN","PSBVDLTB",74,0)
 S:PSBA("I") $P(PSBORDCNT,U)=1 S:PSBA("C") $P(PSBORDCNT,U,2)=1
"RTN","PSBVDLTB",75,0)
 ;
"RTN","PSBVDLTB",76,0)
 ; Setup the ^TMP("PSJ",$J global for use below 
"RTN","PSBVDLTB",77,0)
 K ^TMP("PSJ",$J)
"RTN","PSBVDLTB",78,0)
 D EN^PSJBCMA(DFN,PSBNOW,PSBDT)
"RTN","PSBVDLTB",79,0)
 D:PSBCLINORD INCLUDCO^PSBVDLU1
"RTN","PSBVDLTB",80,0)
 D:'PSBCLINORD REMOVECO^PSBVDLU1
"RTN","PSBVDLTB",81,0)
 ;
"RTN","PSBVDLTB",82,0)
 ;initialize tabs
"RTN","PSBVDLTB",83,0)
 D TABINIT
"RTN","PSBVDLTB",84,0)
 ;
"RTN","PSBVDLTB",85,0)
 ;The following calls must be made in the order below since the ^TMP global is reused
"RTN","PSBVDLTB",86,0)
 D EN^PSBVDLUD(DFN,PSBDT)
"RTN","PSBVDLTB",87,0)
 D EN^PSBVDLPB(DFN,PSBDT)
"RTN","PSBVDLTB",88,0)
 D EN^PSBVDLIV(DFN,PSBDT)
"RTN","PSBVDLTB",89,0)
 ; adding a special check for lighting the Unit Dose Tab light.
"RTN","PSBVDLTB",90,0)
 ; Patches sent to GUI via this API will send both IM and CO patches
"RTN","PSBVDLTB",91,0)
 ; that are expired/dc'd and are still on the patient. So there is a
"RTN","PSBVDLTB",92,0)
 ; a scenario when a unit dose patch can be on TMP global and it is
"RTN","PSBVDLTB",93,0)
 ; the only order in TMP but was for a different mode than currently
"RTN","PSBVDLTB",94,0)
 ; viewing.  In this case CNT will = 0 and use it to turn on the light
"RTN","PSBVDLTB",95,0)
 N CNT,QQ,NODE S CNT=0
"RTN","PSBVDLTB",96,0)
 I $D(^TMP("PSB",$J,"UDTAB",2))>0 D           ;unit dose tab check *70
"RTN","PSBVDLTB",97,0)
 . F QQ=2:1  Q:'$D(^TMP("PSB",$J,"UDTAB",QQ))  D  Q:CNT
"RTN","PSBVDLTB",98,0)
 .. S NODE=^TMP("PSB",$J,"UDTAB",QQ)
"RTN","PSBVDLTB",99,0)
 .. I $L(NODE,U)>27,$P(NODE,U,2)?.N1A D
"RTN","PSBVDLTB",100,0)
 ... ;  first order found Activ per correct mode, then quit with cnt=1
"RTN","PSBVDLTB",101,0)
 ... I PSBCLINORD,$P(NODE,U,33),$P(NODE,U,22)="A" S CNT=1 Q
"RTN","PSBVDLTB",102,0)
 ... I 'PSBCLINORD,'$P(NODE,U,33),$P(NODE,U,22)="A" S CNT=1 Q
"RTN","PSBVDLTB",103,0)
 ... Q:'$P(NODE,U,28)  ;not a given patch
"RTN","PSBVDLTB",104,0)
 ... I PSBCLINORD,$P($P(NODE,U,26),".")'>DT,'$P(NODE,U,33) Q
"RTN","PSBVDLTB",105,0)
 ... I 'PSBCLINORD,$P($P(NODE,U,26),".")'>DT,$P(NODE,U,33) Q
"RTN","PSBVDLTB",106,0)
 ... S CNT=1
"RTN","PSBVDLTB",107,0)
 S $P(PSBATAB,U,1)=$S(CNT:1,1:0)            ;*70 use CNT for UD light
"RTN","PSBVDLTB",108,0)
 S $P(PSBATAB,U,2)=$S($D(^TMP("PSB",$J,"PBTAB",2))>0:1,1:0)
"RTN","PSBVDLTB",109,0)
 S $P(PSBATAB,U,3)=$S($D(^TMP("PSB",$J,"IVTAB",2))>0:1,1:0)
"RTN","PSBVDLTB",110,0)
 S:PSBTAB="UDTAB" PSBCNT=$O(^TMP("PSB",$J,"UDTAB",""),-1)
"RTN","PSBVDLTB",111,0)
 S:PSBTAB="IVTAB" PSBCNT=$O(^TMP("PSB",$J,"IVTAB",""),-1)
"RTN","PSBVDLTB",112,0)
 S:PSBTAB="PBTAB" PSBCNT=$O(^TMP("PSB",$J,"PBTAB",""),-1)
"RTN","PSBVDLTB",113,0)
 ;
"RTN","PSBVDLTB",114,0)
 I PSBTAB="NO TAB" D
"RTN","PSBVDLTB",115,0)
 .S ^TMP("PSB",$J,PSBTAB,0)=1
"RTN","PSBVDLTB",116,0)
 .S ^TMP("PSB",$J,PSBTAB,1)=PSBATAB
"RTN","PSBVDLTB",117,0)
 .S $P(^TMP("PSB",$J,PSBTAB,1),U,5,6)=PSBORDCNT  ;*70 Cvsht offset cnt
"RTN","PSBVDLTB",118,0)
 .S $P(^TMP("PSB",$J,PSBTAB,1),U,7)=PSBINFUS     ;*70 IV infuse light
"RTN","PSBVDLTB",119,0)
 .S $P(^TMP("PSB",$J,PSBTAB,1),U,8)=PSBIVSTP     ;*70 IV stop light
"RTN","PSBVDLTB",120,0)
 .S $P(^TMP("PSB",$J,PSBTAB,1),U,9)=PSBPATCH     ;*70 patch light
"RTN","PSBVDLTB",121,0)
 E  D
"RTN","PSBVDLTB",122,0)
 .I $G(PSBCNT)>0 S ^TMP("PSB",$J,PSBTAB,0)=PSBCNT
"RTN","PSBVDLTB",123,0)
 .I $G(PSBCNT)>1 S ^TMP("PSB",$J,PSBTAB,1)=PSBATAB_U_$S(PSBTRFL:PSBTRTYP_U_PSBMVTYP,1:"")
"RTN","PSBVDLTB",124,0)
 .I $G(PSBCNT)'>1 S ^TMP("PSB",$J,PSBTAB,1)=PSBATAB
"RTN","PSBVDLTB",125,0)
 .S $P(^TMP("PSB",$J,PSBTAB,1),U,6,7)=PSBORDCNT   ;*70 Tabs Ord cnt
"RTN","PSBVDLTB",126,0)
 .S $P(^TMP("PSB",$J,PSBTAB,1),U,8)=PSBINFUS      ;*70 IV infuse light
"RTN","PSBVDLTB",127,0)
 .S $P(^TMP("PSB",$J,PSBTAB,1),U,9)=PSBIVSTP      ;*70 IV stop light
"RTN","PSBVDLTB",128,0)
 .S $P(^TMP("PSB",$J,PSBTAB,1),U,10)=PSBPATCH     ;*70 patch light
"RTN","PSBVDLTB",129,0)
 ;
"RTN","PSBVDLTB",130,0)
 F X="UDTAB","PBTAB","IVTAB" I X'=PSBTAB K ^TMP("PSB",$J,X)
"RTN","PSBVDLTB",131,0)
 D CLEAN^PSBVT K ^TMP("PSJ",$J),PSBATAB,PSBWADM,PSBWBEG,PSBWEND,PSBNOW,PSBTRDT,PSBPTTR,PSBTRFL,PSBNTDT,PSBTRTYP,PSBMVTYP
"RTN","PSBVDLTB",132,0)
 Q
"RTN","PSBVDLTB",133,0)
 ;
"RTN","PSBVDLTB",134,0)
TABINIT ;
"RTN","PSBVDLTB",135,0)
 F PSBX="UDTAB","PBTAB","IVTAB" D
"RTN","PSBVDLTB",136,0)
 .K ^TMP("PSB",$J,PSBX)
"RTN","PSBVDLTB",137,0)
 .S ^TMP("PSB",$J,PSBX,0)=1
"RTN","PSBVDLTB",138,0)
 .S ^TMP("PSB",$J,PSBX,1)="-1^No Administration(s) due at this time." Q
"RTN","PSBVDLTB",139,0)
 ;
"RTN","PSBVDLTB",140,0)
DECEASED(DFN) ; Patient Deceased?
"RTN","PSBVDLTB",141,0)
 ;
"RTN","PSBVDLTB",142,0)
 S DECEASED=0
"RTN","PSBVDLTB",143,0)
 D DEM^VADPT I VADM(6)]"" S DECEASED=1 K VADM D  Q DECEASED
"RTN","PSBVDLTB",144,0)
 .F PSBX="UDTAB","PBTAB","IVTAB","NO TAB" D
"RTN","PSBVDLTB",145,0)
 ..K ^TMP("PSB",$J,PSBX)
"RTN","PSBVDLTB",146,0)
 ..S ^TMP("PSB",$J,PSBX,0)=1,^TMP("PSB",$J,PSBX,1)="0^0^0^-1^A ""DATE OF DEATH"" has been logged for this patient."
"RTN","PSBVDLTB",147,0)
 Q DECEASED
"RTN","PSBVDLU1")
0^6^B171179505^B63529398
"RTN","PSBVDLU1",1,0)
PSBVDLU1 ;BIRMINGHAM/EFC-VIRTUAL DUE LIST (VDL) UTILITIES ;12/18/12 7:30pm
"RTN","PSBVDLU1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**13,32,68,70**;Mar 2004;Build 101
"RTN","PSBVDLU1",3,0)
 ;
"RTN","PSBVDLU1",4,0)
 ; Reference/IA
"RTN","PSBVDLU1",5,0)
 ; EN^PSJBCMA/2828
"RTN","PSBVDLU1",6,0)
 ; EN^PSJBCMA1/2829
"RTN","PSBVDLU1",7,0)
 ; GETSIOPI^PSJBCMA5/5763
"RTN","PSBVDLU1",8,0)
 ;
"RTN","PSBVDLU1",9,0)
 ;*68 - add call to add special instructions (SI) entries to the
"RTN","PSBVDLU1",10,0)
 ;      ^TMP("PSB")  global that ends up in the RESULTS ARRAY of
"RTN","PSBVDLU1",11,0)
 ;      RPC PSB GETORDERTAB.
"RTN","PSBVDLU1",12,0)
 ;*70 - add tags to rebuild TMP array built by PSJBCMA to filter
"RTN","PSBVDLU1",13,0)
 ;      in or out Clinic Orders per request.
"RTN","PSBVDLU1",14,0)
 ;
"RTN","PSBVDLU1",15,0)
ODDSCH(PSBTABX) ;
"RTN","PSBVDLU1",16,0)
 I (PSBOST'<PSBWBEG)&(PSBOST'>PSBWEND) D ADD(PSBREC,PSBOTXT,PSBOST,PSBDDS,PSBSOLS,PSBADDS,PSBTABX)  ;Include start date/time as admin
"RTN","PSBVDLU1",17,0)
 S PSBQUIT=0,PSBCDT=PSBOST F  S PSBCDT=$$FMADD^XLFDT(PSBCDT,"","",PSBFREQ) Q:PSBQUIT=1  D
"RTN","PSBVDLU1",18,0)
 .I $P(PSBCDT,".",2)="" S PSBCDT=PSBCDT-1_".24"
"RTN","PSBVDLU1",19,0)
 .I PSBCDT>PSBWEND S PSBQUIT=1 Q
"RTN","PSBVDLU1",20,0)
 .I PSBCDT'<PSBWBEG,PSBCDT<PSBOSP D ADD(PSBREC,PSBOTXT,PSBCDT,PSBDDS,PSBSOLS,PSBADDS,PSBTABX) Q
"RTN","PSBVDLU1",21,0)
 Q
"RTN","PSBVDLU1",22,0)
GETFREQ(PSBDFN,PSBORDN) ;
"RTN","PSBVDLU1",23,0)
 K ^TMP("PSJ1",$J)
"RTN","PSBVDLU1",24,0)
 D EN^PSJBCMA1(PSBDFN,PSBORDN,1)
"RTN","PSBVDLU1",25,0)
 S PSBFREQ=$P(^TMP("PSJ1",$J,4),U,11)
"RTN","PSBVDLU1",26,0)
 S PSBSCHBR=$P(^TMP("PSJ1",$J,2),"^",5)
"RTN","PSBVDLU1",27,0)
 I $$PSBDCHK1^PSBVT1(PSBSCHBR) S PSBFREQ=""
"RTN","PSBVDLU1",28,0)
 K ^TMP("PSJ1",$J)
"RTN","PSBVDLU1",29,0)
 Q PSBFREQ
"RTN","PSBVDLU1",30,0)
 ;
"RTN","PSBVDLU1",31,0)
GETADMIN(PSBDFN,PSBORDN,PSBSTRT,PSBFREQ,PSBEVDT) ;
"RTN","PSBVDLU1",32,0)
 ;Determine administration times of an odd schedule for today
"RTN","PSBVDLU1",33,0)
 N PSBADMIN
"RTN","PSBVDLU1",34,0)
 K ^TMP("PSB",$J,"GETADMIN")
"RTN","PSBVDLU1",35,0)
 D EN^PSJBCMA1(PSBDFN,PSBORDN,1)
"RTN","PSBVDLU1",36,0)
 S PSBADMIN=$P(^TMP("PSJ1",$J,4),U,9),PSBFREQ=$P(^TMP("PSJ1",$J,4),U,11),^TMP("PSB",$J,"GETADMIN",0)=PSBADMIN
"RTN","PSBVDLU1",37,0)
 I $E(PSBFREQ)'?1N K ^TMP("PSJ1",$J) Q $G(^TMP("PSB",$J,"GETADMIN",0))
"RTN","PSBVDLU1",38,0)
 I PSBFREQ=0 K ^TMP("PSJ1",$J) Q $G(^TMP("PSB",$J,"GETADMIN",0))
"RTN","PSBVDLU1",39,0)
 I PSBSTRT'<PSBEVDT S PSBADMIN=$E($P(PSBSTRT,".",2)_"0000",1,4),^TMP("PSB",$J,"GETADMIN",0)=PSBADMIN
"RTN","PSBVDLU1",40,0)
 S PSBCDT=PSBSTRT,(PSBADTMX,PSBQUIT)=0 F  S PSBCDT=$$FMADD^XLFDT(PSBCDT,"","",PSBFREQ) D  Q:PSBQUIT=1
"RTN","PSBVDLU1",41,0)
 .I $P(PSBCDT,".",2)="" S PSBCDT=PSBCDT-1_".24"
"RTN","PSBVDLU1",42,0)
 .I (PSBCDT\1)>(PSBEVDT\1) S PSBQUIT=1 Q
"RTN","PSBVDLU1",43,0)
 .I (PSBCDT\1)=(PSBEVDT\1) S PSBADMIN=PSBADMIN_$S(PSBADMIN="":"",1:"-")_$E($P(PSBCDT,".",2)_"0000",1,4)
"RTN","PSBVDLU1",44,0)
 .S ^TMP("PSB",$J,"GETADMIN",PSBADTMX)=PSBADMIN
"RTN","PSBVDLU1",45,0)
 .S:($L(PSBADMIN)+5)>255 PSBADTMX=PSBADTMX+1,PSBADMIN=""
"RTN","PSBVDLU1",46,0)
 K ^TMP("PSJ1",$J),PSBADTMX
"RTN","PSBVDLU1",47,0)
 Q $G(^TMP("PSB",$J,"GETADMIN",0))
"RTN","PSBVDLU1",48,0)
 ;
"RTN","PSBVDLU1",49,0)
ADD(PSBREC,PSBSI,PSBDT,PSBDD,PSBSOL,PSBADD,PSBTAB) ;
"RTN","PSBVDLU1",50,0)
 ;
"RTN","PSBVDLU1",51,0)
 ; Description: Add order to ^TMP("PSB",$J,PSBTAB,...) for RPC Return RESULTS
"RTN","PSBVDLU1",52,0)
 ;
"RTN","PSBVDLU1",53,0)
 ; PSBREC=order hdr from above
"RTN","PSBVDLU1",54,0)
 ; PSBSI=special instructions
"RTN","PSBVDLU1",55,0)
 ; PSBDT=admin date/time
"RTN","PSBVDLU1",56,0)
 ; PSBDD=Dispense Drugs
"RTN","PSBVDLU1",57,0)
 ; PSBSOL=Solutions
"RTN","PSBVDLU1",58,0)
 ; PSBADD=Additives
"RTN","PSBVDLU1",59,0)
 ;
"RTN","PSBVDLU1",60,0)
 N PSB
"RTN","PSBVDLU1",61,0)
 S PSBDT=$E(PSBDT,1,12),PSBQR=0
"RTN","PSBVDLU1",62,0)
 S PSB=$O(^TMP("PSB",$J,PSBTAB,""),-1) ; Get next node
"RTN","PSBVDLU1",63,0)
 S $P(PSBREC,U,14)=PSBDT ; Admin Time sits in ^14
"RTN","PSBVDLU1",64,0)
 I $P(PSBREC,U,5)'="O" S X=$O(^PSB(53.79,"AORD",DFN,PSBONX,PSBDT,0)) D:X
"RTN","PSBVDLU1",65,0)
 .S $P(PSBREC,U,12)=X
"RTN","PSBVDLU1",66,0)
 .K PSBLCK L +^PSB(53.79,X):1  I  L -^PSB(53.79,X) S PSBLCK=1
"RTN","PSBVDLU1",67,0)
 .S PSBSTUS=$P(^PSB(53.79,X,0),U,9),$P(PSBREC,U,13)=$S(PSBSTUS="N":"",(PSBSTUS="")&$G(PSBLCK):"U",1:PSBSTUS),$P(PSBREC,U,23)=$P(^PSB(53.79,X,0),U,10),$P(PSBREC,U,24)=$P(^PSB(53.79,X,0),U,7)
"RTN","PSBVDLU1",68,0)
 .I $D(^PSB(53.79,X)) I PSBDOSEF="PATCH",PSBSTUS="G",PSBDT=$P(^PSB(53.79,X,.1),U,3),PSBQRR=0 S PSBQR=1
"RTN","PSBVDLU1",69,0)
 .I PSBSTUS="G",$G(PSBFLAG) D CHECK ;Get the correct dispense drug
"RTN","PSBVDLU1",70,0)
 I ($P(PSBREC,U,5)="O") D
"RTN","PSBVDLU1",71,0)
 .S X=$O(^PSB(53.79,"AORDX",DFN,PSBONX,"")) Q:X=""
"RTN","PSBVDLU1",72,0)
 .S Y=$O(^PSB(53.79,"AORDX",DFN,PSBONX,X,"")) Q:Y=""  S $P(PSBREC,U,12)=Y
"RTN","PSBVDLU1",73,0)
 .K PSBLCK L +^PSB(53.79,Y):1  I  L -^PSB(53.79,Y) S PSBLCK=1
"RTN","PSBVDLU1",74,0)
 .S PSBSTUS=$P(^PSB(53.79,Y,0),U,9),$P(PSBREC,U,13)=$S(PSBSTUS="N":"",(PSBSTUS="")&$G(PSBLCK):"U",1:PSBSTUS),$P(PSBREC,U,24)=$P(^PSB(53.79,Y,0),U,7)
"RTN","PSBVDLU1",75,0)
 .I $D(^PSB(53.79,Y)) I PSBDOSEF="PATCH",PSBSTUS="G",PSBDT=$P(^PSB(53.79,Y,.1),U,3),PSBQRR=0 S PSBQR=1
"RTN","PSBVDLU1",76,0)
 .I PSBSTUS="G",$G(PSBFLAG) D CHECK
"RTN","PSBVDLU1",77,0)
 Q:PSBQR=1
"RTN","PSBVDLU1",78,0)
 S $P(PSBREC,U,25)=0 I $G(PSBTRFL),$P(PSBREC,U,11)]"",$P(PSBREC,U,11)'<$G(PSBNTDT),$P(PSBREC,U,11)'>$G(PSBTRDT) S $P(PSBREC,U,25)=1
"RTN","PSBVDLU1",79,0)
 S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBREC ; Order Hdr
"RTN","PSBVDLU1",80,0)
 I $P(PSBREC,U,12)]"" S PSBONVDL($P(PSBREC,U,12))=""
"RTN","PSBVDLU1",81,0)
 S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBSI ; Special Instructions
"RTN","PSBVDLU1",82,0)
 ; add dispense drugs
"RTN","PSBVDLU1",83,0)
 I $D(PSBDDA) S X="" F  S X=$O(PSBDDA(X)) Q:X=""  S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBDDA(X)
"RTN","PSBVDLU1",84,0)
 S PSBCHDT=0
"RTN","PSBVDLU1",85,0)
 I (PSBTAB'["CVRSHT"),(PSBONX["V"),(PSBOSTS="D"),($G(PSBFOR)="") D  Q  ;get infusing bag from DCed but not DEed orders
"RTN","PSBVDLU1",86,0)
 .D PSJ^PSBVT(PSBX)
"RTN","PSBVDLU1",87,0)
 .D INFUSING^PSBVDLU2 I PSBCOMP=0 Q
"RTN","PSBVDLU1",88,0)
 .I $D(PSBSOLA) S X="" F  S X=$O(PSBSOLA(X)) Q:X=""  S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBSOLA(X)
"RTN","PSBVDLU1",89,0)
 .I $D(PSBADA) S X="" F  S X=$O(PSBADA(X)) Q:X=""  S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBADA(X)
"RTN","PSBVDLU1",90,0)
 .S X="" F  S X=$O(PSBPORA(PSBONX,X)) S PSBUID=$P(PSBPORA(PSBONX,X),U,1) Q:PSBUID]""  Q:X=""
"RTN","PSBVDLU1",91,0)
 .I PSBUID["P" Q
"RTN","PSBVDLU1",92,0)
 .I PSBUID["WS" D
"RTN","PSBVDLU1",93,0)
 ..S PSBNODE=$O(^PSB(53.79,"AUID",DFN,X,PSBUID,""))
"RTN","PSBVDLU1",94,0)
 ..S PSBUIDA(PSBUID)="ID"_U_PSBUID
"RTN","PSBVDLU1",95,0)
 ..S X=0 F  S X=$O(^PSB(53.79,PSBNODE,.6,X)) Q:'X  S PSBUIDA(PSBUID)=PSBUIDA(PSBUID)_U_"ADD;"_$P(^PSB(53.79,PSBNODE,.6,X,0),U,1)
"RTN","PSBVDLU1",96,0)
 ..S X=0 F  S X=$O(^PSB(53.79,PSBNODE,.7,X)) Q:'X  S PSBUIDA(PSBUID)=PSBUIDA(PSBUID)_U_"SOL;"_$P(^PSB(53.79,PSBNODE,.7,X,0),U,1)
"RTN","PSBVDLU1",97,0)
 .S PSBSONX=PSBONX
"RTN","PSBVDLU1",98,0)
 .I '$D(PSBUIDA(PSBUID)) S PSBCKOR="" F  S PSBCKOR=$O(PSBPORA(PSBSONX,PSBCKOR)) Q:PSBCKOR=""  D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBCKOR) Q:$D(PSBUIDA(PSBUID))
"RTN","PSBVDLU1",99,0)
 .S PSBONX=PSBSONX
"RTN","PSBVDLU1",100,0)
 .S:$D(PSBUIDA(PSBUID)) PSB=PSB+2,^TMP("PSB",$J,PSBTAB,PSB-1)=PSBUIDA(PSBUID),^TMP("PSB",$J,PSBTAB,PSB)="END"
"RTN","PSBVDLU1",101,0)
 .D CLEAN^PSBVT,PSJ1^PSBVT(DFN,$O(PSBPORA("")))
"RTN","PSBVDLU1",102,0)
 ; add additives
"RTN","PSBVDLU1",103,0)
 I $D(PSBADA) S X="" F  S X=$O(PSBADA(X)) Q:X=""  S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBADA(X)
"RTN","PSBVDLU1",104,0)
 ; add solutions
"RTN","PSBVDLU1",105,0)
 I $D(PSBSOLA) S X="" F  S X=$O(PSBSOLA(X)) Q:X=""  S $P(PSBSOLA(X),U,5)="",PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBSOLA(X)
"RTN","PSBVDLU1",106,0)
 I PSBONX["V" D EN^PSBPOIV(DFN,PSBONX)  ; get bags
"RTN","PSBVDLU1",107,0)
 I $D(^TMP("PSBAR",$J)) S PSBUID=DFN_"V"_99999 F  S PSBUID=$O(^TMP("PSBAR",$J,PSBUID),-1) Q:PSBUID=""  D
"RTN","PSBVDLU1",108,0)
 .S PSBUIDS=^TMP("PSBAR",$J,PSBUID)
"RTN","PSBVDLU1",109,0)
 .I $P(PSBUIDS,U,1)="I",$P(PSBUIDS,U,2)'="I",$P(PSBUIDS,U,2)'="S" Q  ; bag has invalid IV parameter, is not infusing or stopped
"RTN","PSBVDLU1",110,0)
 .I $P(PSBUIDS,U,2)'="I",$P(PSBUIDS,U,2)'="S",$P(PSBUIDS,U,8)'="" Q  ; label is no longer valid, bag is not infusing or stopped
"RTN","PSBVDLU1",111,0)
 .I $P(PSBUIDS,U,2)="C" Q  ; bag is completed
"RTN","PSBVDLU1",112,0)
 .I $P(PSBUIDS,U,2)="G" Q  ; bag is given (PBTAB)
"RTN","PSBVDLU1",113,0)
 .S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=$P(PSBUIDS,U,10,999)
"RTN","PSBVDLU1",114,0)
 K ^TMP("PSBAR",$J)
"RTN","PSBVDLU1",115,0)
 D:PSBSIOPI GETSI(DFN,PSBONX,PSBTAB)                    ;*68
"RTN","PSBVDLU1",116,0)
 S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)="END"
"RTN","PSBVDLU1",117,0)
 S ^TMP("PSB",$J,PSBTAB,0)=PSB
"RTN","PSBVDLU1",118,0)
 Q
"RTN","PSBVDLU1",119,0)
 ;
"RTN","PSBVDLU1",120,0)
CHECK S FILE=53.795,PSBNODE=.5,PSBIENS=X_","
"RTN","PSBVDLU1",121,0)
 F I=0:0 S I=$O(^PSB(53.79,X,PSBNODE,I)) Q:'I  S $P(PSBDDS,U,3,4)=$$GET1^DIQ(FILE,I_","_PSBIENS,.01,"I")_U_$$GET1^DIQ(FILE,I_","_PSBIENS,.01)
"RTN","PSBVDLU1",122,0)
 Q
"RTN","PSBVDLU1",123,0)
 ;
"RTN","PSBVDLU1",124,0)
VNURSE(PSBTAB) ;add initials of verifying pharmacist/verifying nurse
"RTN","PSBVDLU1",125,0)
 F PSBLP=1:1:$P(^TMP("PSB",$J,PSBTAB,0),U,1) S X=^TMP("PSB",$J,PSBTAB,PSBLP) I $P(X,U)=DFN D
"RTN","PSBVDLU1",126,0)
 .K ^TMP("PSJ1",$J)
"RTN","PSBVDLU1",127,0)
 .D PSJ1^PSBVT(DFN,$P(X,U,2))
"RTN","PSBVDLU1",128,0)
 .S $P(^TMP("PSB",$J,PSBTAB,PSBLP),U,19)=$S(PSBVNI]"":PSBVNI,1:"***")
"RTN","PSBVDLU1",129,0)
 K PSBLP,PSBTAB
"RTN","PSBVDLU1",130,0)
 Q
"RTN","PSBVDLU1",131,0)
 ;
"RTN","PSBVDLU1",132,0)
OKAY(PSBSTRT,PSBADMIN,PSBSCH,PSBORDER,PSBDRUG,PSBFREQ,PSBOSTS) ;
"RTN","PSBVDLU1",133,0)
 ;
"RTN","PSBVDLU1",134,0)
 ; Description: Determines if an order schedule is valid for
"RTN","PSBVDLU1",135,0)
 ;  the date in PSBADMIN (i.e. Q4D, is it valid today)
"RTN","PSBVDLU1",136,0)
 ;
"RTN","PSBVDLU1",137,0)
 ; PSBSTRT:  Start Date of order (Time ignored)
"RTN","PSBVDLU1",138,0)
 ; PSBADMIN: Date of administration to check (Time ignored)
"RTN","PSBVDLU1",139,0)
 ; PSBSCH:  Schedule (i.e. MO-WE-FR@0900 or Q48H...)
"RTN","PSBVDLU1",140,0)
 ; PSBORDER: Order reference
"RTN","PSBVDLU1",141,0)
 ; PSBDRUG:  Drug ordered (Orderable Item)
"RTN","PSBVDLU1",142,0)
 ; PSBOSTS: The status of the order
"RTN","PSBVDLU1",143,0)
 ;
"RTN","PSBVDLU1",144,0)
 N PSBOKAY,PSBDAYS,PSBDOW
"RTN","PSBVDLU1",145,0)
 S PSBOSTS=$G(PSBOSTS)
"RTN","PSBVDLU1",146,0)
 ;
"RTN","PSBVDLU1",147,0)
 S PSBOKAY=0  ; Default Flag
"RTN","PSBVDLU1",148,0)
 I PSBFREQ'="",PSBFREQ'="D",PSBFREQ'>1440 Q 1
"RTN","PSBVDLU1",149,0)
 ;PRN and ONE TIMES show everyday
"RTN","PSBVDLU1",150,0)
 I (PSBSCHT="P")!(PSBSCHT="O") Q 1
"RTN","PSBVDLU1",151,0)
 S PSBDAYS=$$DAYS(PSBSCH)
"RTN","PSBVDLU1",152,0)
 ;
"RTN","PSBVDLU1",153,0)
 I PSBDAYS=1 S PSBOKAY=1 Q PSBOKAY  ; Order is everyday
"RTN","PSBVDLU1",154,0)
 ;
"RTN","PSBVDLU1",155,0)
 ; find out if today is a good day for multi days
"RTN","PSBVDLU1",156,0)
 S PSBOKAY=0,PSBRDTE=PSBSTRT
"RTN","PSBVDLU1",157,0)
 S PSBADBR=PSBADMIN\1
"RTN","PSBVDLU1",158,0)
 S PSBENR=(PSBADMIN\1)+1
"RTN","PSBVDLU1",159,0)
 I PSBDAYS>1 D  Q PSBOKAY
"RTN","PSBVDLU1",160,0)
 .I PSBADBR=(PSBSTRT\1) S PSBOKAY=1
"RTN","PSBVDLU1",161,0)
 .F  S PSBRDTE=$$FMADD^XLFDT(PSBRDTE,"","",PSBFREQ) Q:PSBRDTE>PSBENR  D
"RTN","PSBVDLU1",162,0)
 ..I $P(PSBRDTE,".",2)="" S PSBRDTE=PSBRDTE-1_".24"
"RTN","PSBVDLU1",163,0)
 ..I PSBRDTE\1=PSBADBR S PSBOKAY=1
"RTN","PSBVDLU1",164,0)
 ..I PSBOKAY="1" Q
"RTN","PSBVDLU1",165,0)
 ;
"RTN","PSBVDLU1",166,0)
 ; Try the MO-WE-FR@0800 thing as last resort
"RTN","PSBVDLU1",167,0)
 S X=PSBADMIN D H^%DTC I %Y=-1 D  Q PSBOKAY  ; Error
"RTN","PSBVDLU1",168,0)
 .S PSBOKAY=0
"RTN","PSBVDLU1",169,0)
 .Q:PSBOSTS="E"
"RTN","PSBVDLU1",170,0)
 .Q:$G(PSBMHND)="PSBOMH"
"RTN","PSBVDLU1",171,0)
 .D ERROR^PSBMLU($G(PSBORDER,"UNKNOWN"),$G(PSBDRUG,""),DFN,"Unable to determine schedule "_PSBSCH,PSBSCH)
"RTN","PSBVDLU1",172,0)
 S PSBDOW=$P("SU^MO^TU^WE^TH^FR^SA",U,%Y+1)
"RTN","PSBVDLU1",173,0)
 I $F(PSBSCH,PSBDOW)>0 S PSBOKAY=1 Q PSBOKAY
"RTN","PSBVDLU1",174,0)
 S PSBOKAY=0
"RTN","PSBVDLU1",175,0)
 Q PSBOKAY
"RTN","PSBVDLU1",176,0)
 ;
"RTN","PSBVDLU1",177,0)
DAYS(PSB) ; Return days between doses (-1: error, 1:everyday 2: QOD...)
"RTN","PSBVDLU1",178,0)
 ;
"RTN","PSBVDLU1",179,0)
 ; Is it a PRN
"RTN","PSBVDLU1",180,0)
 I PSB?.E1"PRN".E Q 1  ; Straight PRN - As Needed
"RTN","PSBVDLU1",181,0)
 ;
"RTN","PSBVDLU1",182,0)
 S PSB=$TR(PSB," ","")
"RTN","PSBVDLU1",183,0)
 I PSB?2.4N.E Q 1
"RTN","PSBVDLU1",184,0)
 S X=PSBFREQ/1440 Q X
"RTN","PSBVDLU1",185,0)
 ;
"RTN","PSBVDLU1",186,0)
 Q
"RTN","PSBVDLU1",187,0)
 ;
"RTN","PSBVDLU1",188,0)
LAST ;
"RTN","PSBVDLU1",189,0)
 S PSBCC=0
"RTN","PSBVDLU1",190,0)
 S ZZ="" F  S ZZ=$O(^PSB(53.79,X,.3,ZZ),-1) Q:'ZZ  Q:PSBFLAG=1  S PSBDATA2=$G(^(ZZ,0)) D
"RTN","PSBVDLU1",191,0)
 .S PSBCC=PSBCC+1
"RTN","PSBVDLU1",192,0)
 .I (PSBCC=2)!($P($P(PSBDATA2,U)," ")="Refused:")!($P($P(PSBDATA2,U)," ")="Held:") S $P(PSBREC,U,11)=$P(PSBDATA2,U,3),PSBFLAG=1
"RTN","PSBVDLU1",193,0)
 Q
"RTN","PSBVDLU1",194,0)
 ;
"RTN","PSBVDLU1",195,0)
GETSI(DFN,ORD,TAB) ;Get Special Instructions/Other Print Info from IM   ;*68
"RTN","PSBVDLU1",196,0)
 ;
"RTN","PSBVDLU1",197,0)
 ; This Tag will load the SIOPI WP text into the TMP global used by
"RTN","PSBVDLU1",198,0)
 ; the PSB GETORDERTAB RPC, which ends up in the RESULTS array passed
"RTN","PSBVDLU1",199,0)
 ; back to the BCMA GUI.
"RTN","PSBVDLU1",200,0)
 ;
"RTN","PSBVDLU1",201,0)
 N QQ
"RTN","PSBVDLU1",202,0)
 K ^TMP("PSJBCMA5",$J,DFN,ORD)
"RTN","PSBVDLU1",203,0)
 D GETSIOPI^PSJBCMA5(DFN,ORD,1)
"RTN","PSBVDLU1",204,0)
 Q:'$D(^TMP("PSJBCMA5",$J,DFN,ORD))
"RTN","PSBVDLU1",205,0)
 F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,DFN,ORD,QQ)) Q:'QQ  D
"RTN","PSBVDLU1",206,0)
 .S PSB=PSB+1
"RTN","PSBVDLU1",207,0)
 .S ^TMP("PSB",$J,TAB,PSB)="SI^"_^TMP("PSJBCMA5",$J,DFN,ORD,QQ)
"RTN","PSBVDLU1",208,0)
 K ^TMP("PSJBCMA5",$J,DFN,ORD)
"RTN","PSBVDLU1",209,0)
 Q
"RTN","PSBVDLU1",210,0)
 ;
"RTN","PSBVDLU1",211,0)
INCLUDCO ;Rebuild TMP global from PSJBCMA, RETAIN CLINC ORDERS ONLY  *70
"RTN","PSBVDLU1",212,0)
 N QQ,IMCNT,COCNT
"RTN","PSBVDLU1",213,0)
 S (IMCNT,COCNT)=0 K ^TMP("PSJTMP",$J)
"RTN","PSBVDLU1",214,0)
 F QQ=0:0 S QQ=$O(^TMP("PSJ",$J,QQ)) Q:'QQ  D
"RTN","PSBVDLU1",215,0)
 . I $P($G(^TMP("PSJ",$J,QQ,0)),U,11)]"" D
"RTN","PSBVDLU1",216,0)
 .. S COCNT=COCNT+1
"RTN","PSBVDLU1",217,0)
 .. M ^TMP("PSJTMP",$J,COCNT)=^TMP("PSJ",$J,QQ)
"RTN","PSBVDLU1",218,0)
 K ^TMP("PSJ",$J) M ^TMP("PSJ",$J)=^TMP("PSJTMP",$J)
"RTN","PSBVDLU1",219,0)
 K ^TMP("PSJTMP",$J)
"RTN","PSBVDLU1",220,0)
 S:'$D(^TMP("PSJ",$J)) ^TMP("PSJ",$J,1,0)=-1
"RTN","PSBVDLU1",221,0)
 Q
"RTN","PSBVDLU1",222,0)
 ;
"RTN","PSBVDLU1",223,0)
REMOVECO ;Rebuild TMP global from PSJBCMA, RETAIN IM ORDERS ONLY         *70
"RTN","PSBVDLU1",224,0)
 N QQ,IMCNT
"RTN","PSBVDLU1",225,0)
 S IMCNT=0 K ^TMP("PSJTMP",$J)
"RTN","PSBVDLU1",226,0)
 F QQ=0:0 S QQ=$O(^TMP("PSJ",$J,QQ)) Q:'QQ  D
"RTN","PSBVDLU1",227,0)
 . I $P($G(^TMP("PSJ",$J,QQ,0)),U,11)="" D  Q
"RTN","PSBVDLU1",228,0)
 .. S IMCNT=IMCNT+1
"RTN","PSBVDLU1",229,0)
 .. M ^TMP("PSJTMP",$J,IMCNT)=^TMP("PSJ",$J,QQ)
"RTN","PSBVDLU1",230,0)
 K ^TMP("PSJ",$J) M ^TMP("PSJ",$J)=^TMP("PSJTMP",$J)
"RTN","PSBVDLU1",231,0)
 K ^TMP("PSJTMP",$J)
"RTN","PSBVDLU1",232,0)
 S:'$D(^TMP("PSJ",$J)) ^TMP("PSJ",$J,1,0)=-1
"RTN","PSBVDLU1",233,0)
 Q
"RTN","PSBVDLU1",234,0)
 ;
"RTN","PSBVDLU1",235,0)
MODELITE() ;
"RTN","PSBVDLU1",236,0)
 N ORDCNT,CLIN,ORDNO,STRT,STOP,STAT,PSBIMNOW,PSBIMDT
"RTN","PSBVDLU1",237,0)
 S ORDCNT=""
"RTN","PSBVDLU1",238,0)
 K ^TMP("PSJ",$J)
"RTN","PSBVDLU1",239,0)
 S PSBIMNOW=+$E($$NOW^XLFDT,1,10),PSBIMDT=$P(PSBIMNOW,".")
"RTN","PSBVDLU1",240,0)
 D EN^PSJBCMA(DFN,PSBIMNOW,PSBIMDT)
"RTN","PSBVDLU1",241,0)
 Q:^TMP("PSJ",$J,1,0)=-1 ""
"RTN","PSBVDLU1",242,0)
 F QQ=0:0 S QQ=$O(^TMP("PSJ",$J,QQ)) Q:'QQ  D
"RTN","PSBVDLU1",243,0)
 . S CLIN=$P(^TMP("PSJ",$J,QQ,0),U,11)
"RTN","PSBVDLU1",244,0)
 . S ORDNO=$P(^TMP("PSJ",$J,QQ,0),U,3)
"RTN","PSBVDLU1",245,0)
 . S STRT=$P($P(^TMP("PSJ",$J,QQ,1),U,4),".")
"RTN","PSBVDLU1",246,0)
 . S STOP=$P($P(^TMP("PSJ",$J,QQ,1),U,5),".")
"RTN","PSBVDLU1",247,0)
 . S STAT=$P(^TMP("PSJ",$J,QQ,1),U,7)
"RTN","PSBVDLU1",248,0)
 . D:CLIN]""
"RTN","PSBVDLU1",249,0)
 .. I ORDNO'["P",STAT="A",STRT'>DT,STOP'<DT S $P(ORDCNT,U,2)=1
"RTN","PSBVDLU1",250,0)
 . D:CLIN=""
"RTN","PSBVDLU1",251,0)
 .. I ORDNO'["P",STAT="A",STRT'>DT,STOP'<DT S $P(ORDCNT,U)=1
"RTN","PSBVDLU1",252,0)
 Q ORDCNT
"RTN","PSBVDLU1",253,0)
 ;
"RTN","PSBVDLU1",254,0)
INITTAB ;*70
"RTN","PSBVDLU1",255,0)
 K ^TMP("PSB",$J,PSBTAB)
"RTN","PSBVDLU1",256,0)
 S ^TMP("PSB",$J,PSBTAB,0)=1
"RTN","PSBVDLU1",257,0)
 S ^TMP("PSB",$J,PSBTAB,1)="-1^No Administration(s) due at this time."
"RTN","PSBVDLU1",258,0)
 Q
"RTN","PSBVDLU1",259,0)
 ;
"RTN","PSBVDLU1",260,0)
FINDORD(BWDFWD,DFN,PSBDT,PSBTAB) ;Search a patient's orders Bwd or Fwd    *70
"RTN","PSBVDLU1",261,0)
 ; Find the next day that contains an Active admin time not Given.
"RTN","PSBVDLU1",262,0)
 ;
"RTN","PSBVDLU1",263,0)
 N QQ,SPDT,STARTDT,STDT,STOPDT,STPDT
"RTN","PSBVDLU1",264,0)
 S PSBSIOPI="",PSBCLINORD=1
"RTN","PSBVDLU1",265,0)
 N NODE1,ENDDT,STRDT,STOPDT,STDT,SPDT,STARTDT,STOPDT,SDT,QUIT,REC,QQ
"RTN","PSBVDLU1",266,0)
 N PSBWBEG,PSBWEND,PSBWADM,FOUND,GIVE,PDT
"RTN","PSBVDLU1",267,0)
 K ^TMP("PSJ",$J)
"RTN","PSBVDLU1",268,0)
 D EN^PSJBCMA(DFN,PSBDT,PSBDT),INCLUDCO^PSBVDLU1
"RTN","PSBVDLU1",269,0)
 Q:^TMP("PSJ",$J,1,0)=-1 -1
"RTN","PSBVDLU1",270,0)
 ;
"RTN","PSBVDLU1",271,0)
 ;read thru psj tmp and create start date xref
"RTN","PSBVDLU1",272,0)
 F QQ=0:0 S QQ=$O(^TMP("PSJ",$J,QQ)) Q:'QQ  D
"RTN","PSBVDLU1",273,0)
 . S NODE1=$G(^TMP("PSJ",$J,QQ,1))
"RTN","PSBVDLU1",274,0)
 . Q:$P(NODE1,U,7)'="A"              ;not active sts
"RTN","PSBVDLU1",275,0)
 . S STRDT=$P($P(NODE1,U,4),"."),STDT(STRDT)=""
"RTN","PSBVDLU1",276,0)
 . S STPDT=$P($P(NODE1,U,5),"."),SPDT(STPDT)=""
"RTN","PSBVDLU1",277,0)
 S STARTDT=+$O(STDT(0))
"RTN","PSBVDLU1",278,0)
 Q:(BWDFWD=-1)&('STARTDT) -1
"RTN","PSBVDLU1",279,0)
 S STOPDT=+$O(SPDT(999999999),-1)
"RTN","PSBVDLU1",280,0)
 Q:(BWDFWD=1)&('STOPDT) -1
"RTN","PSBVDLU1",281,0)
 ;
"RTN","PSBVDLU1",282,0)
 D:BWDFWD=-1 LOOPBWD
"RTN","PSBVDLU1",283,0)
 D:BWDFWD=1 LOOPFWD
"RTN","PSBVDLU1",284,0)
 Q PDT
"RTN","PSBVDLU1",285,0)
 ;
"RTN","PSBVDLU1",286,0)
LOOPBWD ; Loop thru days backwards and quit when pass End date.    *70
"RTN","PSBVDLU1",287,0)
 S (REC,QUIT,FOUND)=0
"RTN","PSBVDLU1",288,0)
 F QQ=BWDFWD:BWDFWD S PDT=$$FMADD^XLFDT(PSBDT,QQ) Q:PDT<STARTDT  D  Q:FOUND!QUIT
"RTN","PSBVDLU1",289,0)
 . I PDT<STARTDT S QUIT=1 Q
"RTN","PSBVDLU1",290,0)
 . D INITTAB^PSBVDLU1
"RTN","PSBVDLU1",291,0)
 . S PSBWBEG=$P(PDT,".")_".0000"
"RTN","PSBVDLU1",292,0)
 . S PSBWEND=$P(PDT,".")_".2400"
"RTN","PSBVDLU1",293,0)
 . S PSBWADM=99999
"RTN","PSBVDLU1",294,0)
 . S PSBWADM=$$FMADD^XLFDT(PDT,"","",+PSBWADM)
"RTN","PSBVDLU1",295,0)
 . D:PSBTAB="UDTAB" EN^PSBVDLUD(DFN,PDT)
"RTN","PSBVDLU1",296,0)
 . D:PSBTAB="PBTAB" EN^PSBVDLPB(DFN,PDT)
"RTN","PSBVDLU1",297,0)
 . S FOUND=+$G(^TMP("PSB",$J,PSBTAB,2))          ;=dfn, if data found
"RTN","PSBVDLU1",298,0)
 . S GIVE=$P($G(^TMP("PSB",$J,PSBTAB,2)),U,13)   ;get give sts
"RTN","PSBVDLU1",299,0)
 . S:GIVE="G" FOUND=0                            ;skip, as was given
"RTN","PSBVDLU1",300,0)
 S:'FOUND PDT=-1
"RTN","PSBVDLU1",301,0)
 Q
"RTN","PSBVDLU1",302,0)
 ;
"RTN","PSBVDLU1",303,0)
LOOPFWD ; Loop thru days forwards and quit when pass End date.    *70
"RTN","PSBVDLU1",304,0)
 S (REC,QUIT,FOUND)=0
"RTN","PSBVDLU1",305,0)
 F QQ=BWDFWD:BWDFWD S PDT=$$FMADD^XLFDT(PSBDT,QQ) Q:PDT>STOPDT  D  Q:FOUND!QUIT
"RTN","PSBVDLU1",306,0)
 . I PDT>STOPDT S QUIT=1 Q
"RTN","PSBVDLU1",307,0)
 . D INITTAB^PSBVDLU1
"RTN","PSBVDLU1",308,0)
 . S PSBWBEG=$P(PDT,".")_".0000"
"RTN","PSBVDLU1",309,0)
 . S PSBWEND=$P(PDT,".")_".2400"
"RTN","PSBVDLU1",310,0)
 . S PSBWADM=99999
"RTN","PSBVDLU1",311,0)
 . S PSBWADM=$$FMADD^XLFDT(PDT,"","",+PSBWADM)
"RTN","PSBVDLU1",312,0)
 . D:PSBTAB="UDTAB" EN^PSBVDLUD(DFN,PDT)
"RTN","PSBVDLU1",313,0)
 . D:PSBTAB="PBTAB" EN^PSBVDLPB(DFN,PDT)
"RTN","PSBVDLU1",314,0)
 . S FOUND=+$G(^TMP("PSB",$J,PSBTAB,2))          ;=dfn, if data found
"RTN","PSBVDLU1",315,0)
 . S GIVE=$P($G(^TMP("PSB",$J,PSBTAB,2)),U,13)   ;get give sts
"RTN","PSBVDLU1",316,0)
 . S:GIVE="G" FOUND=0                            ;skip, as was given
"RTN","PSBVDLU1",317,0)
 S:'FOUND PDT=-1
"RTN","PSBVDLU1",318,0)
 Q
"RTN","PSBVDLU1",319,0)
 ;
"RTN","PSBVDLU1",320,0)
PATCHON(DFN,ORDR) ;check if any patches are still Given & Not Removed per this patient
"RTN","PSBVDLU1",321,0)
 ;  Return values:
"RTN","PSBVDLU1",322,0)
 ;    Func:   True/False (1/0) for patches do exist on a patient.
"RTN","PSBVDLU1",323,0)
 ;    ORDR(): array element "C"linic or "I"npatient order = 1 when
"RTN","PSBVDLU1",324,0)
 ;             at least 1 order of this type exists.
"RTN","PSBVDLU1",325,0)
 ;
"RTN","PSBVDLU1",326,0)
 N ON,DAYSBK,ORDNO,STOPDT,IMCL
"RTN","PSBVDLU1",327,0)
 S ON=0,ORDR("C")=0,ORDR("I")=0
"RTN","PSBVDLU1",328,0)
 Q:'$D(^PSB(53.79,"APATCH",DFN)) ON
"RTN","PSBVDLU1",329,0)
 F QQ=0:0 S QQ=$O(^PSB(53.79,"APATCH",DFN,QQ)) Q:'QQ  D
"RTN","PSBVDLU1",330,0)
 . F RR=0:0 S RR=$O(^PSB(53.79,"APATCH",DFN,QQ,RR)) Q:'RR  D
"RTN","PSBVDLU1",331,0)
 .. I $P(^PSB(53.79,RR,0),U,9)="G" D
"RTN","PSBVDLU1",332,0)
 ... S ORDNO=$P(^PSB(53.79,RR,.1),"^")
"RTN","PSBVDLU1",333,0)
 ... D CLEAN^PSBVT
"RTN","PSBVDLU1",334,0)
 ... D PSJ1^PSBVT(DFN,ORDNO) Q:'$G(PSBOSP)
"RTN","PSBVDLU1",335,0)
 ... S STOPDT=PSBOSP
"RTN","PSBVDLU1",336,0)
 ... S DAYSBK=+($$GET^XPAR("DIV","PSB VDL PATCH DAYS"))
"RTN","PSBVDLU1",337,0)
 ...; simulate PSBVDLPA logic to look back Kernel param days
"RTN","PSBVDLU1",338,0)
 ... I DAYSBK D NOW^%DTC I $$FMADD^XLFDT($P(STOPDT,"."),DAYSBK)<X Q
"RTN","PSBVDLU1",339,0)
 ... S ON=1
"RTN","PSBVDLU1",340,0)
 ... S IMCL=$S($G(PSBCLORD)]"":"C",1:"I"),ORDR(IMCL)=1
"RTN","PSBVDLU1",341,0)
 ... D CLEAN^PSBVT
"RTN","PSBVDLU1",342,0)
 Q ON
"RTN","PSBVDLU1",343,0)
 ;
"RTN","PSBVDLU1",344,0)
INFUSING(DFN,ORDR) ;check if any IV's have bags infusing per this patient
"RTN","PSBVDLU1",345,0)
 ;  Return values:
"RTN","PSBVDLU1",346,0)
 ;    Func:   True/False (1/0) for patches do exist on a patient.
"RTN","PSBVDLU1",347,0)
 ;    ORDR(): array element "C"linic or "I"npatient order = 1 when
"RTN","PSBVDLU1",348,0)
 ;             at least 1 order of this type exists.
"RTN","PSBVDLU1",349,0)
 ;
"RTN","PSBVDLU1",350,0)
 N ON,DAYSBK,ORDNO,STOPDT,IMCL,PSBCLIEN
"RTN","PSBVDLU1",351,0)
 S ON=0,ORDR("C")=0,ORDR("I")=0
"RTN","PSBVDLU1",352,0)
 Q:'$D(^PSB(53.79,"AINFUSING",DFN)) ON
"RTN","PSBVDLU1",353,0)
 F QQ=0:0 S QQ=$O(^PSB(53.79,"AINFUSING",DFN,QQ)) Q:'QQ  D
"RTN","PSBVDLU1",354,0)
 . F RR=0:0 S RR=$O(^PSB(53.79,"AINFUSING",DFN,QQ,RR)) Q:'RR  D
"RTN","PSBVDLU1",355,0)
 .. S ORDNO=$P(^PSB(53.79,RR,.1),"^")
"RTN","PSBVDLU1",356,0)
 .. D CLEAN^PSBVT
"RTN","PSBVDLU1",357,0)
 .. D PSJ1^PSBVT(DFN,ORDNO) Q:'$G(PSBOSP)
"RTN","PSBVDLU1",358,0)
 .. S STOPDT=PSBOSP
"RTN","PSBVDLU1",359,0)
 .. ; simulate IV VDL logic to look 3 days back for IM meds or 7 days
"RTN","PSBVDLU1",360,0)
 .. ; for CO med.
"RTN","PSBVDLU1",361,0)
 .. D NOW^%DTC
"RTN","PSBVDLU1",362,0)
 .. I '$G(PSBCLIEN),$$FMADD^XLFDT($P(STOPDT,"."),3)<X Q
"RTN","PSBVDLU1",363,0)
 .. I $G(PSBCLIEN),$$FMADD^XLFDT($P(STOPDT,"."),7)<X Q
"RTN","PSBVDLU1",364,0)
 .. S ON=1
"RTN","PSBVDLU1",365,0)
 .. S IMCL=$S($G(PSBCLORD)]"":"C",1:"I"),ORDR(IMCL)=1
"RTN","PSBVDLU1",366,0)
 .. D CLEAN^PSBVT
"RTN","PSBVDLU1",367,0)
 Q ON
"RTN","PSBVDLU1",368,0)
 ;
"RTN","PSBVDLU1",369,0)
STOPPED(DFN,ORDR) ;check if any IV's have bags infusing per this patient
"RTN","PSBVDLU1",370,0)
 ;  Return values:
"RTN","PSBVDLU1",371,0)
 ;    Func:   True/False (1/0) for patches do exist on a patient.
"RTN","PSBVDLU1",372,0)
 ;    ORDR(): array element "C"linic or "I"npatient order = 1 when
"RTN","PSBVDLU1",373,0)
 ;             at least 1 order of this type exists.
"RTN","PSBVDLU1",374,0)
 ;
"RTN","PSBVDLU1",375,0)
 N ON,DAYSBK,ORDNO,STOPDT,IMCL,PSBCLIEN
"RTN","PSBVDLU1",376,0)
 S ON=0,ORDR("C")=0,ORDR("I")=0
"RTN","PSBVDLU1",377,0)
 Q:'$D(^PSB(53.79,"ASTOPPED",DFN)) ON
"RTN","PSBVDLU1",378,0)
 F QQ=0:0 S QQ=$O(^PSB(53.79,"ASTOPPED",DFN,QQ)) Q:'QQ  D
"RTN","PSBVDLU1",379,0)
 . F RR=0:0 S RR=$O(^PSB(53.79,"ASTOPPED",DFN,QQ,RR)) Q:'RR  D
"RTN","PSBVDLU1",380,0)
 .. S ORDNO=$P(^PSB(53.79,RR,.1),"^")
"RTN","PSBVDLU1",381,0)
 .. D CLEAN^PSBVT
"RTN","PSBVDLU1",382,0)
 .. D PSJ1^PSBVT(DFN,ORDNO) Q:'$G(PSBOSP)
"RTN","PSBVDLU1",383,0)
 .. S STOPDT=PSBOSP
"RTN","PSBVDLU1",384,0)
 .. ; simulate IV VDL logic to look 3 days back for IM meds or 7 days
"RTN","PSBVDLU1",385,0)
 .. ; for CO med.
"RTN","PSBVDLU1",386,0)
 .. D NOW^%DTC
"RTN","PSBVDLU1",387,0)
 .. I 'PSBCLIEN,$$FMADD^XLFDT($P(STOPDT,"."),3)<X Q
"RTN","PSBVDLU1",388,0)
 .. I PSBCLIEN,$$FMADD^XLFDT($P(STOPDT,"."),7)<X Q
"RTN","PSBVDLU1",389,0)
 .. S ON=1
"RTN","PSBVDLU1",390,0)
 .. S IMCL=$S($G(PSBCLORD)]"":"C",1:"I"),ORDR(IMCL)=1
"RTN","PSBVDLU1",391,0)
 .. D CLEAN^PSBVT
"RTN","PSBVDLU1",392,0)
 Q ON
"RTN","PSBVDLU3")
0^50^B94081463^B91879754
"RTN","PSBVDLU3",1,0)
PSBVDLU3 ;BIRMINGHAM/TEJ-BCMA VDL UTILITIES 3 ;5/1/13 1:13pm
"RTN","PSBVDLU3",2,0)
 ;;3.0;BAR CODE MED ADMIN;**13,38,28,50,64,70**;Mar 2004;Build 101
"RTN","PSBVDLU3",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBVDLU3",4,0)
 ;
"RTN","PSBVDLU3",5,0)
 ;This routine file has been created to serve as a container
"RTN","PSBVDLU3",6,0)
 ;for Extrinsic Variables/Functions
"RTN","PSBVDLU3",7,0)
 ;
"RTN","PSBVDLU3",8,0)
 ; Reference/IA
"RTN","PSBVDLU3",9,0)
 ; EN^PSJBCMA/2828
"RTN","PSBVDLU3",10,0)
 ; EN^PSJBCMA1/2829
"RTN","PSBVDLU3",11,0)
 ; File 50/221
"RTN","PSBVDLU3",12,0)
 ; File 52.6/436
"RTN","PSBVDLU3",13,0)
 ; File 52.7/437
"RTN","PSBVDLU3",14,0)
 ;
"RTN","PSBVDLU3",15,0)
 ;*70 - Do not send UTS mailman msg for Clinic only patients.
"RTN","PSBVDLU3",16,0)
 ;
"RTN","PSBVDLU3",17,0)
IVPTAB(PSBORTYP,PSBIVTYP,PSBINTSY,PSBCHMTY,PSBPUSH)  ;
"RTN","PSBVDLU3",18,0)
 ;
"RTN","PSBVDLU3",19,0)
 ; This function will return
"RTN","PSBVDLU3",20,0)
 ; the value 1 (one) if the
"RTN","PSBVDLU3",21,0)
 ; specified order input will cause
"RTN","PSBVDLU3",22,0)
 ; the order to display on the "IVP/IVPB"
"RTN","PSBVDLU3",23,0)
 ; tab of the VDL BCMA Virtual Due List (VDL)
"RTN","PSBVDLU3",24,0)
 ; else return the value 0 (zero).
"RTN","PSBVDLU3",25,0)
 ;
"RTN","PSBVDLU3",26,0)
 ; Input Parameters:
"RTN","PSBVDLU3",27,0)
 ;
"RTN","PSBVDLU3",28,0)
 ;     PSBORTYP - Order type (e.g. "U","V")
"RTN","PSBVDLU3",29,0)
 ;     PSBIVTYP - IV Type (e.g. "P","S","C")
"RTN","PSBVDLU3",30,0)
 ;     PSBINTSY - Intermittent Syringe value
"RTN","PSBVDLU3",31,0)
 ;     PSBCHMTY - Chemo type (e.g. "P","S")
"RTN","PSBVDLU3",32,0)
 ;     PSBPUSH - IV PUSH Flag (e.g. 0 or 1, 1=IV PUSH)
"RTN","PSBVDLU3",33,0)
 ;
"RTN","PSBVDLU3",34,0)
 ; Output:
"RTN","PSBVDLU3",35,0)
 ;     1 - order will display on the "IVP/IVPB" Tab of BCMA VDL
"RTN","PSBVDLU3",36,0)
 ;     0 - order will NOT display on the "IVP/IVPB" Tab of BCMA VDL
"RTN","PSBVDLU3",37,0)
 ;    -1 - error processed
"RTN","PSBVDLU3",38,0)
 ;
"RTN","PSBVDLU3",39,0)
 Q:'$D(PSBORTYP) "-1^Missing Parameter"
"RTN","PSBVDLU3",40,0)
 I PSBORTYP="U"&(PSBPUSH) Q 1
"RTN","PSBVDLU3",41,0)
 I '(PSBORTYP="V") Q 0
"RTN","PSBVDLU3",42,0)
 I $G(PSBIVTYP)="P" Q 1
"RTN","PSBVDLU3",43,0)
 I $G(PSBIVTYP)="S",$G(PSBINTSY)=1 Q 1
"RTN","PSBVDLU3",44,0)
 I $G(PSBIVTYP)="C",$G(PSBCHMTY)="P" Q 1
"RTN","PSBVDLU3",45,0)
 I $G(PSBIVTYP)="C",$G(PSBCHMTY)="S",$G(PSBINTSY)=1 Q 1
"RTN","PSBVDLU3",46,0)
 Q 0
"RTN","PSBVDLU3",47,0)
 ;
"RTN","PSBVDLU3",48,0)
SHOVDL(DFN,BDATE,OTDATE,PSBTAB) ;
"RTN","PSBVDLU3",49,0)
 ;
"RTN","PSBVDLU3",50,0)
 ; This function will find orders such as discontinued or expired infusing IV bags 
"RTN","PSBVDLU3",51,0)
 ; or discontinued or expired "given" patches.  Recognizing these types of orders
"RTN","PSBVDLU3",52,0)
 ; will allow these orders to be displayed on the VDL and permits the user to take 
"RTN","PSBVDLU3",53,0)
 ; action on them.  This routine determines if such orders exist for patient,
"RTN","PSBVDLU3",54,0)
 ; time, and "BCMA VDL tab."  This routine is an "extention" to the API EN^PSJBCMA.
"RTN","PSBVDLU3",55,0)
 ;
"RTN","PSBVDLU3",56,0)
 ; INPUT Parameters:
"RTN","PSBVDLU3",57,0)
 ;    DFN           (req)   Patient Internal File Number.
"RTN","PSBVDLU3",58,0)
 ;    BDATE         (opt)   Start searching for "order stop" after this date. 
"RTN","PSBVDLU3",59,0)
 ;    OTDATE        (opt)   Include One-Time orders from this date.
"RTN","PSBVDLU3",60,0)
 ;    PSBTAB        (opt)   "UDTAB" or "IVTAB" - expedites process if specific tab
"RTN","PSBVDLU3",61,0)
 ;                            is given.
"RTN","PSBVDLU3",62,0)
 ;
"RTN","PSBVDLU3",63,0)
 ; OUTPUT Values
"RTN","PSBVDLU3",64,0)
 ;    0               absolutely no orders to display on VDL
"RTN","PSBVDLU3",65,0)
 ;    1               displayable orders have been located.
"RTN","PSBVDLU3",66,0)
 ;
"RTN","PSBVDLU3",67,0)
 ;
"RTN","PSBVDLU3",68,0)
 D EN^PSJBCMA(DFN,$G(BDATE),$G(OTDATE))
"RTN","PSBVDLU3",69,0)
 ; any active Patch orders to show on VDL?
"RTN","PSBVDLU3",70,0)
 S PSBFLG=0
"RTN","PSBVDLU3",71,0)
 I $G(^TMP("PSJ",$J,1,0))=-1 D
"RTN","PSBVDLU3",72,0)
 .;  
"RTN","PSBVDLU3",73,0)
 .; Check the indexice for given patches or infusing IVs
"RTN","PSBVDLU3",74,0)
 .;
"RTN","PSBVDLU3",75,0)
 .; Check APATCH
"RTN","PSBVDLU3",76,0)
 .D:($G(PSBTAB)="UDTAB")!($G(PSBTAB)="")  Q:PSBFLG
"RTN","PSBVDLU3",77,0)
 ..S PSBGNODE="^PSB(53.79,"_"""APATCH"""_","_DFN_")" Q:'$D(PSBGNODE)
"RTN","PSBVDLU3",78,0)
 ..F  S PSBGNODE=$Q(@PSBGNODE) Q:PSBGNODE=""  Q:$QS(PSBGNODE,3)'=DFN  Q:PSBFLG  S PSBIEN=$QS(PSBGNODE,5),PSBFLG=$S($P(^PSB(53.79,PSBIEN,0),U,9)="G":1,1:0)
"RTN","PSBVDLU3",79,0)
 .;
"RTN","PSBVDLU3",80,0)
 .; Check AUID
"RTN","PSBVDLU3",81,0)
 .;
"RTN","PSBVDLU3",82,0)
 .D:(($G(PSBTAB)="IVTAB")!($G(PSBTAB)=""))&('PSBFLG)  Q:PSBFLG
"RTN","PSBVDLU3",83,0)
 ..S PSBGNODE="^PSB(53.79,"_"""AUID"""_","_DFN_")" Q:'$D(PSBGNODE)
"RTN","PSBVDLU3",84,0)
 ..F  S PSBGNODE=$Q(@PSBGNODE) Q:PSBGNODE=""  Q:$QS(PSBGNODE,3)'=DFN  Q:PSBFLG  S PSBIEN=$QS(PSBGNODE,6),PSBFLG=$S($P(^PSB(53.79,PSBIEN,0),U,9)="I":1,1:0)
"RTN","PSBVDLU3",85,0)
 .;
"RTN","PSBVDLU3",86,0)
 .;  NOTE: Infusing bags will not display if DCed more than 3 days ago!
"RTN","PSBVDLU3",87,0)
 .;
"RTN","PSBVDLU3",88,0)
 S:$G(^TMP("PSJ",$J,1,0))'=-1 PSBFLG=1
"RTN","PSBVDLU3",89,0)
 ;
"RTN","PSBVDLU3",90,0)
 Q PSBFLG
"RTN","PSBVDLU3",91,0)
 ;
"RTN","PSBVDLU3",92,0)
FNDACTV(RESULTS,PARAMS) ;   Utility to check and order for the latest " ? (parameter #3) " order activities per patient (parameter #1)
"RTN","PSBVDLU3",93,0)
 ; #parameter= # "^"piece
"RTN","PSBVDLU3",94,0)
 ;       #1 DFN - Patient's IEN          e.g. 1234      (required)
"RTN","PSBVDLU3",95,0)
 ;       #2 Order Number_Order Type      e.g. "1V"     "" = all orders
"RTN","PSBVDLU3",96,0)
 ;       #3 Search for Activity          e.g           "" = *unknown* activity
"RTN","PSBVDLU3",97,0)
 ;       #4 Search "back"time(hours)     e.g. 12       "" = search back 3 admins
"RTN","PSBVDLU3",98,0)
 ;          NOTE:  ="FREQ"  This Function will use order's frequency.
"RTN","PSBVDLU3",99,0)
 ;          1. If the order is a PRN, On Call or One-Time
"RTN","PSBVDLU3",100,0)
 ;           the look back a default of 72 hours.
"RTN","PSBVDLU3",101,0)
 ;          2. if the order is a Continuous order key off
"RTN","PSBVDLU3",102,0)
 ;             of the frequency as follows.
"RTN","PSBVDLU3",103,0)
 ;           a.) if the frequency is <24 hours use the
"RTN","PSBVDLU3",104,0)
 ;               default of 72 hours.
"RTN","PSBVDLU3",105,0)
 ;           b.) if the frequency is >= 24 hour, look back
"RTN","PSBVDLU3",106,0)
 ;               3.5 times the frequency
"RTN","PSBVDLU3",107,0)
 ;    NOTE:  ["X#"    This Function will search back # of admins.
"RTN","PSBVDLU3",108,0)
 ;
"RTN","PSBVDLU3",109,0)
 ;  Example call: D FNDACTV^PSBVDLU3(.TEJ,"1234^1U^H^12")
"RTN","PSBVDLU3",110,0)
 ;
"RTN","PSBVDLU3",111,0)
 N PSBNOW,PSBDFN,PSBON,PSBCNT,PSBACT,PSBTMFRM,PSBX,PSBSET,PSBFRQ
"RTN","PSBVDLU3",112,0)
 K RESULTS
"RTN","PSBVDLU3",113,0)
 S PSBDFN=$P(PARAMS,U),PSBON=$P(PARAMS,U,2),PSBACT=$P(PARAMS,U,3),PSBTMFRM=$P(PARAMS,U,4)
"RTN","PSBVDLU3",114,0)
 S RESULTS(0)=1
"RTN","PSBVDLU3",115,0)
 I $G(PSBDFN)']"" S RESULTS(0)=1,RESULTS(1)="-1^ERROR - MISSING PARAMETER (DFN REQ.)" Q
"RTN","PSBVDLU3",116,0)
 I $G(PSBTMFRM)="" S PSBX=3
"RTN","PSBVDLU3",117,0)
 I $G(PSBTMFRM)["X" S PSBX=+($P(PSBTMFRM,"X",2)),PSBTMFRM=""
"RTN","PSBVDLU3",118,0)
 I $G(PSBTMFRM)]"",$G(PSBTMFRM)'["FREQ" D NOW^%DTC S PSBNOW=% S PSBTMFRM=$$FMADD^XLFDT(PSBNOW,"",-1*PSBTMFRM),PSBSET=1 S RESULTS(1)="0^ None found after "_PSBTMFRM
"RTN","PSBVDLU3",119,0)
 I $G(PSBX)="" S PSBX=9999999
"RTN","PSBVDLU3",120,0)
 D:$G(PSBON)'=""
"RTN","PSBVDLU3",121,0)
 .K ^TMP("PSJ",$J) D EN^PSJBCMA1(PSBDFN,PSBON)
"RTN","PSBVDLU3",122,0)
 .;Maintain Time Frame and other order information
"RTN","PSBVDLU3",123,0)
 .I $G(PSBTMFRM)["FREQ" D
"RTN","PSBVDLU3",124,0)
 ..S PSBFRQ=+$P(^TMP("PSJ",$J,4),"^",11) I PSBFRQ=0 S PSBFRQ=1440
"RTN","PSBVDLU3",125,0)
 ..I "P^OC^O^"[($P(^TMP("PSJ",$J,4),"^")_"^") S PSBTMFRM=72 Q
"RTN","PSBVDLU3",126,0)
 ..I (PSBFRQ/60)<24 S PSBTMFRM=72 Q
"RTN","PSBVDLU3",127,0)
 ..I (PSBFRQ/60)'<24 S PSBTMFRM=(PSBFRQ/60)*3.5
"RTN","PSBVDLU3",128,0)
 .I '$G(PSBSET) D NOW^%DTC S PSBNOW=% S PSBTMFRM=$$FMADD^XLFDT(PSBNOW,"",-1*PSBTMFRM) S RESULTS(1)="0^ None found after "_PSBTMFRM
"RTN","PSBVDLU3",129,0)
 .S I="",X=0 F  S I=$O(^PSB(53.79,"AORDX",PSBDFN,PSBON,I),-1)  Q:(I="")!(I<$S(PSBTMFRM]"":PSBTMFRM,1:-1))  D  Q:X
"RTN","PSBVDLU3",130,0)
 ..S Z=0,J="",PSBCNT=0 F  S J=$O(^PSB(53.79,"AORDX",PSBDFN,PSBON,I,J),-1)  Q:(J="")  S Z=Z+1 Q:Z>PSBX  D  Q:X
"RTN","PSBVDLU3",131,0)
 ...L +^PSB(53.79,J):DILOCKTM
"RTN","PSBVDLU3",132,0)
 ...I  L -^PSB(53.79,J)
"RTN","PSBVDLU3",133,0)
 ...E  Q
"RTN","PSBVDLU3",134,0)
 ...I ($P(^PSB(53.79,J,0),U,9)=PSBACT) S X=1 D
"RTN","PSBVDLU3",135,0)
 ....S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=$$GET1^DIQ(53.79,J_",",.02)
"RTN","PSBVDLU3",136,0)
 ....S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=$P(^TMP("PSJ",$J,2),U,2)_"^"_($$GET1^DIQ(53.79,J_",",.11))
"RTN","PSBVDLU3",137,0)
 ....S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=$$GET1^DIQ(53.79,J_",",.06,"I")
"RTN","PSBVDLU3",138,0)
 ....S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=$$GET1^DIQ(53.79,J_",",.13,"I")
"RTN","PSBVDLU3",139,0)
 D:$G(PSBON)=""
"RTN","PSBVDLU3",140,0)
 .S Z="",X=0 F  S Z=$O(^PSB(53.79,"AORDX",PSBDFN,Z),-1)  Q:(Z="")  S PSBON=Z D  Q:X
"RTN","PSBVDLU3",141,0)
 ..;Maintain Time Frame and other order information
"RTN","PSBVDLU3",142,0)
 ..K ^TMP("PSJ",$J) D EN^PSJBCMA1(PSBDFN,PSBON)
"RTN","PSBVDLU3",143,0)
 ..I $G(PSBTMFRM)["FREQ" D
"RTN","PSBVDLU3",144,0)
 ...S PSBFRQ=+$P(^TMP("PSJ",$J,4),"^",11) I PSBFRQ=0 S PSBFRQ=1440
"RTN","PSBVDLU3",145,0)
 ...I "P^OC^O^"[($P(^TMP("PSJ",$J,4),"^")_"^") S PSBTMFRM=72 Q
"RTN","PSBVDLU3",146,0)
 ...I (PSBFRQ/60)<24 S PSBTMFRM=72 Q
"RTN","PSBVDLU3",147,0)
 ...I (PSBFRQ/60)'<24 S PSBTMFRM=(PSBFRQ/60)*3.5
"RTN","PSBVDLU3",148,0)
 ..I '$G(PSBSET) D NOW^%DTC S PSBNOW=% S PSBTMFRM=$$FMADD^XLFDT(PSBNOW,"",-1*PSBTMFRM) S RESULTS(1)="0^ None found after "_PSBTMFRM
"RTN","PSBVDLU3",149,0)
 ..S I="" F  S I=$O(^PSB(53.79,"AORDX",PSBDFN,PSBON,I),-1)  Q:(I="")!(I<$S(PSBTMFRM]"":PSBTMFRM,1:-1))  D  Q:X
"RTN","PSBVDLU3",150,0)
 ...S ZZ=0,J="",PSBCNT=0 F  S J=$O(^PSB(53.79,"AORDX",PSBDFN,PSBON,I,J),-1)  Q:(J="")  S ZZ=ZZ+1 Q:ZZ>PSBX  D  Q:X
"RTN","PSBVDLU3",151,0)
 ....L +^PSB(53.79,J):DILOCKTM
"RTN","PSBVDLU3",152,0)
 ....I  L -^PSB(53.79,J)
"RTN","PSBVDLU3",153,0)
 ....E  Q
"RTN","PSBVDLU3",154,0)
 ....I ($P(^PSB(53.79,J,0),U,9)=PSBACT) S X=1 D
"RTN","PSBVDLU3",155,0)
 .....S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=$$GET1^DIQ(53.79,J_",",.02)
"RTN","PSBVDLU3",156,0)
 .....S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=$P(^TMP("PSJ",$J,2),U,2)_"^"_($$GET1^DIQ(53.79,J_",",.11))
"RTN","PSBVDLU3",157,0)
 .....S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=$$GET1^DIQ(53.79,J_",",.06,"I")
"RTN","PSBVDLU3",158,0)
 .....S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=$$GET1^DIQ(53.79,J_",",.13,"I")
"RTN","PSBVDLU3",159,0)
 I $G(PSBCNT)>0 S RESULTS(0)=PSBCNT
"RTN","PSBVDLU3",160,0)
 K ^TMP("PSJ",$J)
"RTN","PSBVDLU3",161,0)
 Q
"RTN","PSBVDLU3",162,0)
 ;
"RTN","PSBVDLU3",163,0)
SCANFAIL(RESULTS,PSBPARAM) ;  TEJ 05/12/2006  BCMA-Managing Scanning Failures (MSF)
"RTN","PSBVDLU3",164,0)
 ;       Document Unable to Scan Event
"RTN","PSBVDLU3",165,0)
 ;               Parameters:
"RTN","PSBVDLU3",166,0)
 ;               Input (via GUI):
"RTN","PSBVDLU3",167,0)
 ;
"RTN","PSBVDLU3",168,0)
 ;        Per Wristband  (0)      -       Pat IEN ^ ^ Reason Unable to Scan ^ User's Comment ^ "W" ^ 1 (keyed entry) or 2 (scanner)
"RTN","PSBVDLU3",169,0)
 ;        Per Medication (0)      -       Pat IEN ^ Order Number ^ Reason Unable to Scan ^ User's Comment ^ "M" ^ 1 (keyed entry) or 2 (scanner)
"RTN","PSBVDLU3",170,0)
 ;                       (1)      -       tag^ unique identifier
"RTN","PSBVDLU3",171,0)
 ;               Output:
"RTN","PSBVDLU3",172,0)
 ;                 Entry into database ^PSB(53.77)
"RTN","PSBVDLU3",173,0)
 ;                 Electronic Mail - Message Data per Unable to Scan Event
"RTN","PSBVDLU3",174,0)
 ;  PSB1 - Patient IEN
"RTN","PSBVDLU3",175,0)
 ;  PSB2 - Ward Location/Room
"RTN","PSBVDLU3",176,0)
 ;  PSB3 - Reason
"RTN","PSBVDLU3",177,0)
 ;  PSB4 - Type of Scan Issue
"RTN","PSBVDLU3",178,0)
 ;  PSB5 - Event date/item
"RTN","PSBVDLU3",179,0)
 ;  PSB6 - User's Comment
"RTN","PSBVDLU3",180,0)
 ;  PSB7 - User identification
"RTN","PSBVDLU3",181,0)
 ;  PSB8 - Order Number
"RTN","PSBVDLU3",182,0)
 ;                 RESULTS(0)=1
"RTN","PSBVDLU3",183,0)
 ;                 RESULTS(1)= 1 (Success) or -1 (Nonsuccess)
"RTN","PSBVDLU3",184,0)
 ;
"RTN","PSBVDLU3",185,0)
 K RESULTS,PSBSFUID,PSBMEDOI,PSBMEDNM
"RTN","PSBVDLU3",186,0)
 S RESULTS(0)=1,RESULTS(1)="-1^Unable to Scan documentation NOT successful!"
"RTN","PSBVDLU3",187,0)
 N PSBDAT,PSBDAT1,PSBXON,PSBSCHAD,PSBFILE
"RTN","PSBVDLU3",188,0)
 S PSBDAT=PSBPARAM(0) I $D(PSBPARAM(1)) S PSBDAT1=PSBPARAM(1)
"RTN","PSBVDLU3",189,0)
 S PSBXON=$P(PSBDAT,"^",2)
"RTN","PSBVDLU3",190,0)
 S PSB8=$G(PSBXON)
"RTN","PSBVDLU3",191,0)
 S (PSB1,PSBDFN)=$P(PSBDAT,"^")
"RTN","PSBVDLU3",192,0)
 ;
"RTN","PSBVDLU3",193,0)
 ; Changed the ward+room delimiter from / to $.
"RTN","PSBVDLU3",194,0)
 S PSB2=" *UNIDENTIFIABLE PATIENT* " I +$G(PSB1)>0 S PSB2=$$GET1^DIQ(2,PSB1_",",.1)_"$"_$$GET1^DIQ(2,PSB1_",",.101)
"RTN","PSBVDLU3",195,0)
 N VAIP,DFN S DFN=PSBDFN D IN5^VADPT Q:VAIP(5)=""   ;not admitted, *70
"RTN","PSBVDLU3",196,0)
 S PSB3=$P(PSBDAT,"^",3) I PSB3="Manual Medication Entry" S PSBMMEN=1
"RTN","PSBVDLU3",197,0)
 S PSB4=$S($P(PSBDAT,"^",5)="W":"Wristband",$P(PSBDAT,"^",5)="M":"Medication",1:" *UNDEFINED* ")
"RTN","PSBVDLU3",198,0)
 I PSB4="Medication"&($D(PSBDAT1)) D
"RTN","PSBVDLU3",199,0)
 .; Determine DD/ADD/SOL
"RTN","PSBVDLU3",200,0)
 .S PSBMEDOI=$P(PSBDAT1,"^",2)
"RTN","PSBVDLU3",201,0)
 .S PSBFILE=$P(PSBDAT1,"^"),PSBFILE=$S(PSBFILE="DD":50,PSBFILE="ADD":52.6,PSBFILE="SOL":52.7,1:PSBFILE)
"RTN","PSBVDLU3",202,0)
 .I PSBFILE'="ID" S PSBMEDNM=$$GET1^DIQ(PSBFILE,PSBMEDOI_",",.01)
"RTN","PSBVDLU3",203,0)
 .K PSBSFUID I PSBFILE="ID",(PSBMEDOI]"") S PSBSFUID=PSBMEDOI
"RTN","PSBVDLU3",204,0)
 D NOW^%DTC S (Y,PSB5A)=% D DD^%DT S PSB5=Y
"RTN","PSBVDLU3",205,0)
 S PSB6=$P(PSBDAT,"^",4)
"RTN","PSBVDLU3",206,0)
 S PSB7=". *UNDEFINED* " I $G(DUZ)>0 S PSB7=$$GET1^DIQ(200,DUZ_",",.01),PSB7A="`"_DUZ
"RTN","PSBVDLU3",207,0)
 ; Send message.
"RTN","PSBVDLU3",208,0)
 I $G(PSBMMEN)'=1,$P(PSBDAT,U,6)'=1,$P(PSBDAT,U,6)'=2 D MSFMSG^PSBMLU(PSB1,PSB2,PSB3,PSB4,PSB5,PSB6,PSB7,PSB8,.RESULTS)
"RTN","PSBVDLU3",209,0)
 I RESULTS(0)=-1 S RESULTS(0)=1,RESULTS(1)="-1^Unable to Scan MAILGROUP NOT SETUP!" Q
"RTN","PSBVDLU3",210,0)
 ;File data
"RTN","PSBVDLU3",211,0)
 D CLEAN^DILF
"RTN","PSBVDLU3",212,0)
 N PSBNEW1
"RTN","PSBVDLU3",213,0)
 S PSBNEW1="+1"
"RTN","PSBVDLU3",214,0)
 D
"RTN","PSBVDLU3",215,0)
 .I $G(PSBMMEN)=1 S PSBSCTYP="MMME" Q
"RTN","PSBVDLU3",216,0)
 .I $P(PSBDAT,U,6)=2 S PSBSCTYP=$S($P(PSBPARAM(0),"^",5)="W":"WSCN",$P(PSBPARAM(0),"^",5)="M":"MSCN") Q
"RTN","PSBVDLU3",217,0)
 .I $P(PSBDAT,U,6)=1 S PSBSCTYP=$S($P(PSBPARAM(0),"^",5)="W":"WKEY",$P(PSBPARAM(0),"^",5)="M":"MKEY") Q
"RTN","PSBVDLU3",218,0)
 .I $P(PSBDAT,U,6)=0 S PSBSCTYP=$S($P(PSBPARAM(0),"^",5)="W":"WUAS",$P(PSBPARAM(0),"^",5)="M":"MUAS")
"RTN","PSBVDLU3",219,0)
 ;
"RTN","PSBVDLU3",220,0)
FILESF ; File event.
"RTN","PSBVDLU3",221,0)
 D VAL^PSBML(53.77,"+1,",.01,PSB7A)
"RTN","PSBVDLU3",222,0)
 D VAL^PSBML(53.77,"+1,",.02,"`"_PSBDFN)
"RTN","PSBVDLU3",223,0)
 D VAL^PSBML(53.77,"+1,",.03,PSB2)
"RTN","PSBVDLU3",224,0)
 D VAL^PSBML(53.77,"+1,",.04,PSB5A)
"RTN","PSBVDLU3",225,0)
 D VAL^PSBML(53.77,"+1,",.05,PSBSCTYP)
"RTN","PSBVDLU3",226,0)
 D VAL^PSBML(53.77,"+1,",.06,PSB3)
"RTN","PSBVDLU3",227,0)
 D VAL^PSBML(53.77,"+1,",.07,$S($G(XMZ)]"":"`"_XMZ,1:""))
"RTN","PSBVDLU3",228,0)
 D VAL^PSBML(53.77,"+1,",.08,PSBXON)
"RTN","PSBVDLU3",229,0)
 D VAL^PSBML(53.77,"+1,",.09,PSB6)
"RTN","PSBVDLU3",230,0)
 D:$G(PSBFILE)=50
"RTN","PSBVDLU3",231,0)
 .D VAL^PSBML(53.771,"+2,+1,",.01,"`"_PSBMEDOI)
"RTN","PSBVDLU3",232,0)
 .D VAL^PSBML(53.771,"+2,+1,",1,PSBMEDNM)
"RTN","PSBVDLU3",233,0)
 D:$G(PSBFILE)=52.6
"RTN","PSBVDLU3",234,0)
 .D VAL^PSBML(53.7711,"+2,+1,",.01,"`"_PSBMEDOI)
"RTN","PSBVDLU3",235,0)
 .D VAL^PSBML(53.7711,"+2,+1,",1,PSBMEDNM)
"RTN","PSBVDLU3",236,0)
 D:$G(PSBFILE)=52.7
"RTN","PSBVDLU3",237,0)
 .D VAL^PSBML(53.7712,"+2,+1,",.01,"`"_PSBMEDOI)
"RTN","PSBVDLU3",238,0)
 .D VAL^PSBML(53.7712,"+2,+1,",1,PSBMEDNM)
"RTN","PSBVDLU3",239,0)
 I $G(PSBFILE)="ID" D VAL^PSBML(53.77,"+1,",14,PSBOIT),VAL^PSBML(53.77,"+1,",15,PSBOITX)
"RTN","PSBVDLU3",240,0)
 I $D(PSBSFUID) D VAL^PSBML(53.77,"+1,",13,PSBSFUID)
"RTN","PSBVDLU3",241,0)
 I $G(PSBFILE)="ID" D VAL^PSBML(53.77,"+1,",13,$S(PSBMEDOI']"":"WS",1:PSBMEDOI))
"RTN","PSBVDLU3",242,0)
 D UPDATE^DIE("","PSBFDA","PSBNEW1","PSBMSG")
"RTN","PSBVDLU3",243,0)
 I $D(PSBMSG("DIERR")) S RESULTS(0)=2,RESULTS(1)="-1^MSF Filing ERROR! "_PSBMSG("DIERR","1","TEXT",1) Q
"RTN","PSBVDLU3",244,0)
 S RESULTS(0)=1,RESULTS(1)="1^Unable to Scan documentation successful!"
"RTN","PSBVDLU3",245,0)
 Q
"RTN","PSBVDLU3",246,0)
 ;
"RTN","PSBVDLU3",247,0)
CLEANMSF ;
"RTN","PSBVDLU3",248,0)
 ;  Clean-up
"RTN","PSBVDLU3",249,0)
 K PSBNEW1,PSB1,PSB2,PSB3,PSB4,PSB5,PSB6,PSB7,PSB8,XMZ
"RTN","PSBVDLU3",250,0)
 Q
"RTN","PSBVDLU3",251,0)
 ;
"RTN","PSBVDLU3",252,0)
SCANCNT(PSBTYP) ;
"RTN","PSBVDLU3",253,0)
 ;  Routine to count total scans (NO MAIL)
"RTN","PSBVDLU3",254,0)
 ;  Input: PSBTYP - "WSCN"/"MSCN"/"MMME"/"MKEY"/"WKEY"  
"RTN","PSBVDLU3",255,0)
 D CLEAN^DILF
"RTN","PSBVDLU3",256,0)
 N PSBNEW1
"RTN","PSBVDLU3",257,0)
 S PSBNEW1="+1"
"RTN","PSBVDLU3",258,0)
 D VAL^PSBML(53.77,"+1,",.01,"`"_".5")
"RTN","PSBVDLU3",259,0)
 D VAL^PSBML(53.77,"+1,",.05,PSBTYP)
"RTN","PSBVDLU3",260,0)
 D UPDATE^DIE("","PSBFDA","PSBNEW1","PSBMSG")
"RTN","PSBVDLU3",261,0)
 I $D(PSBNEW1(1)) S DIK="^PSB(53.77,",DA=PSBNEW1(1) D ^DIK
"RTN","PSBVDLU3",262,0)
 I $D(PSBMSG("DIERR")) S RESULTS(0)=2,RESULTS(1)="-1^MSF Filing ERROR! "_PSBMSG("DIERR","1","TEXT",1) Q
"RTN","PSBVDLU3",263,0)
 S RESULTS(0)=1,RESULTS(1)="1^Unable to Scan documentation successful!"
"RTN","PSBVDLU3",264,0)
 Q
"RTN","PSBVDLU3",265,0)
 ;
"RTN","PSBVDLUD")
0^12^B91521932^B85273287
"RTN","PSBVDLUD",1,0)
PSBVDLUD ;BIRMINGHAM/EFC-BCMA UNIT DOSE VIRTUAL DUE LIST FUNCTIONS ;1/23/13 1:23pm
"RTN","PSBVDLUD",2,0)
 ;;3.0;BAR CODE MED ADMIN;**11,13,38,32,58,68,70**;Mar 2004;Build 101
"RTN","PSBVDLUD",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBVDLUD",4,0)
 ;
"RTN","PSBVDLUD",5,0)
 ; Reference/IA
"RTN","PSBVDLUD",6,0)
 ; $$GET^XPAR/2263
"RTN","PSBVDLUD",7,0)
 ; GETPROVL^PSGSICH1/5653
"RTN","PSBVDLUD",8,0)
 ; INTRDIC^PSGSICH1/5654
"RTN","PSBVDLUD",9,0)
 ;
"RTN","PSBVDLUD",10,0)
 ;*58 - add 29th piece to Results for Override/Intervention flag 1/0
"RTN","PSBVDLUD",11,0)
 ;*68 - add 30th piece to Results for Last Injection Site
"RTN","PSBVDLUD",12,0)
 ;*70 - add 32nd piece to Results for Clinic Order name for CO's
"RTN","PSBVDLUD",13,0)
 ;    - add 33rd piece to Results for Clinic ien ptr to file #44
"RTN","PSBVDLUD",14,0)
 ;
"RTN","PSBVDLUD",15,0)
EN(DFN,PSBDT) ;
"RTN","PSBVDLUD",16,0)
 ;
"RTN","PSBVDLUD",17,0)
 ; Description:
"RTN","PSBVDLUD",18,0)
 ; Returns the current unit dose order set for today to display
"RTN","PSBVDLUD",19,0)
 ; on the client VDL
"RTN","PSBVDLUD",20,0)
 ;
"RTN","PSBVDLUD",21,0)
 N PSBDATA,PSBTBOUT
"RTN","PSBVDLUD",22,0)
 S PSBTBOUT=0
"RTN","PSBVDLUD",23,0)
 ;
"RTN","PSBVDLUD",24,0)
 ;This routine now re-uses the ^TMP("PSJ",$J global built in PSBVDLTB
"RTN","PSBVDLUD",25,0)
 ;
"RTN","PSBVDLUD",26,0)
 G:$G(^TMP("PSJ",$J,1,0))=-1 1
"RTN","PSBVDLUD",27,0)
 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:('PSBX)!(PSBTBOUT)  D
"RTN","PSBVDLUD",28,0)
 .N PSBRTNOW S PSBRTNOW=$$NOW^XLFDT()
"RTN","PSBVDLUD",29,0)
 .S:(PSBTAB'="UDTAB")&($G(^TMP("PSB",$J,"UDTAB",2))>0) PSBTBOUT=1
"RTN","PSBVDLUD",30,0)
 .D CLEAN^PSBVT,PSJ^PSBVT(PSBX)
"RTN","PSBVDLUD",31,0)
 .;
"RTN","PSBVDLUD",32,0)
 .; << Standard checks for ALL orders >>
"RTN","PSBVDLUD",33,0)
 .;
"RTN","PSBVDLUD",34,0)
 .Q:PSBONX["V"              ;No IVs on UD tab
"RTN","PSBVDLUD",35,0)
 .Q:PSBONX["P"              ;No Pending Orders
"RTN","PSBVDLUD",36,0)
 .Q:PSBOST>PSBWADM          ;Order Start Date/Time > admin window
"RTN","PSBVDLUD",37,0)
 .Q:($G(PSBCLORD)]"")&(PSBOST>PSBRTNOW)     ;CO Order start date is in future   *70
"RTN","PSBVDLUD",38,0)
 .Q:PSBOSP<PSBWBEG  ;For Non one-times Order Stop Date/Time < vdl window
"RTN","PSBVDLUD",39,0)
 .Q:PSBOSTS["D"             ;Is it DC'd
"RTN","PSBVDLUD",40,0)
 .Q:PSBNGF                  ;Is it marked DO NOT GIVE!
"RTN","PSBVDLUD",41,0)
 .Q:PSBIVPSH                ;Is it IV push
"RTN","PSBVDLUD",42,0)
 .;
"RTN","PSBVDLUD",43,0)
 .; Non One-Times with stop date/time < now
"RTN","PSBVDLUD",44,0)
 .;
"RTN","PSBVDLUD",45,0)
 .D NOW^%DTC
"RTN","PSBVDLUD",46,0)
 .Q:PSBOSP<%
"RTN","PSBVDLUD",47,0)
 .;
"RTN","PSBVDLUD",48,0)
 .; include Active, Renewed, ReInstated and On Call
"RTN","PSBVDLUD",49,0)
 .; (Is it not one time)&(Is it not active or renewed or On Call)
"RTN","PSBVDLUD",50,0)
 .I PSBSCHT'="O",PSBOSTS'="A",PSBOSTS'="H",PSBOSTS'="R",PSBOSTS'="RE",PSBOSTS'="O" Q
"RTN","PSBVDLUD",51,0)
 .;
"RTN","PSBVDLUD",52,0)
 .; Is One Time Given
"RTN","PSBVDLUD",53,0)
 .;
"RTN","PSBVDLUD",54,0)
 .I PSBSCHT="O" D  Q:PSBGVN
"RTN","PSBVDLUD",55,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBVDLUD",56,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBVDLUD",57,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBVDLUD",58,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBONX,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBVDLUD",59,0)
 .;
"RTN","PSBVDLUD",60,0)
 .; How long does One Time remain on VDL ??
"RTN","PSBVDLUD",61,0)
 .S PSBRMN=1
"RTN","PSBVDLUD",62,0)
 .I PSBSCHT="O",PSBOSP'=PSBOST&(%>PSBOSP) S PSBRMN=0
"RTN","PSBVDLUD",63,0)
 .Q:'PSBRMN
"RTN","PSBVDLUD",64,0)
 .; Is On-Call Given, Can it be given more than once
"RTN","PSBVDLUD",65,0)
 .;
"RTN","PSBVDLUD",66,0)
 .I PSBSCHT="OC" D  Q:PSBGVN&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL"))
"RTN","PSBVDLUD",67,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBVDLUD",68,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBVDLUD",69,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBVDLUD",70,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBONX,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBVDLUD",71,0)
 .;
"RTN","PSBVDLUD",72,0)
 .S PSBREC=""
"RTN","PSBVDLUD",73,0)
 .S $P(PSBREC,U,1)=DFN ; dfn
"RTN","PSBVDLUD",74,0)
 .S $P(PSBREC,U,2)=PSBONX ; order
"RTN","PSBVDLUD",75,0)
 .S $P(PSBREC,U,3)=PSBON ; order ien
"RTN","PSBVDLUD",76,0)
 .S $P(PSBREC,U,4)=PSBOTYP ; iv/ud/pending
"RTN","PSBVDLUD",77,0)
 .S $P(PSBREC,U,5)=PSBSCHT ; schedule type
"RTN","PSBVDLUD",78,0)
 .S $P(PSBREC,U,6)=PSBSCH ; schedule
"RTN","PSBVDLUD",79,0)
 .S $P(PSBREC,U,7)=$S(PSBHSM:"HSM",PSBSM:"SM",1:"") ; self med
"RTN","PSBVDLUD",80,0)
 .S $P(PSBREC,U,8)=PSBOITX ; drugname
"RTN","PSBVDLUD",81,0)
 .S $P(PSBREC,U,9)=PSBDOSE_" "_PSBIFR ; dosage
"RTN","PSBVDLUD",82,0)
 .S $P(PSBREC,U,10)=PSBMR ; med route
"RTN","PSBVDLUD",83,0)
 .; Last Given from the AOIP X-Ref - not given status not excepted
"RTN","PSBVDLUD",84,0)
 .S (PSBCNT,PSBFLAG)=0,(YZ,PSBSTUS,PSBADMER)="" K PSBHSTA,PSBHSTAX
"RTN","PSBVDLUD",85,0)
 .F XZ=1:1:20 S YZ=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,YZ),-1),(PSBCNT,PSBFLAG)=0 Q:YZ=""  D
"RTN","PSBVDLUD",86,0)
 ..S:YZ>0 $P(PSBREC,U,11)=YZ
"RTN","PSBVDLUD",87,0)
 ..S X="" F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,YZ,X),-1) Q:X=""  D
"RTN","PSBVDLUD",88,0)
 ...K PSBLCK L +^PSB(53.79,X):1  I  L -^PSB(53.79,X) S PSBLCK=1
"RTN","PSBVDLUD",89,0)
 ...S PSBSTUS=$P(^PSB(53.79,X,0),U,9)
"RTN","PSBVDLUD",90,0)
 ...I $G(PSBSTUS)="" S:'$G(PSBLCK) PSBSTUS="X" I $G(PSBLCK) S PSBADMER=1 D
"RTN","PSBVDLUD",91,0)
 ....K PSBPARM3,PSBPARM5,PSBPARM6,PSBPARM7
"RTN","PSBVDLUD",92,0)
 ....S PSBPARM6=X,Y=$P(^PSB(53.79,X,.1),U,3) D DD^%DT S PSBPARM3=Y,Y=$P(^PSB(53.79,X,0),U,6) D DD^%DT S PSBPARM5=Y
"RTN","PSBVDLUD",93,0)
 ....S PSBPARM7=$P(^PSB(53.79,X,0),U,7) S PSBPARM7="( # "_PSBPARM7_" ) "_$$GET1^DIQ(200,PSBPARM7_",",.01)
"RTN","PSBVDLUD",94,0)
 ....K PSBXTMP S PSBXTMP=PSBONX
"RTN","PSBVDLUD",95,0)
 ....D CLEAN^PSBVT,PSJ1^PSBVT(DFN,$$GET1^DIQ(53.79,PSBPARM6_",",.11))
"RTN","PSBVDLUD",96,0)
 ....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,PSBPARM3_" admin's ACTION STATUS is ""UNKNOWN"".",PSBSCH,PSBPARM5,PSBPARM6,PSBPARM7) ;  SEND AN E-MAIL
"RTN","PSBVDLUD",97,0)
 ....D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBXTMP)  ;Reset Variables
"RTN","PSBVDLUD",98,0)
 ....S X=PSBPARM6 K PSBPARM3,PSBPARM5,PSBPARM6,PSBPARM7
"RTN","PSBVDLUD",99,0)
 ...K PSBLCK S:(PSBSTUS']"") PSBSTUS="U"  I PSBSTUS'="N",($G(PSBSTUS)'="X") S PSBFLAG=1,PSBHSTA(YZ,$G(PSBSTUS))="ORIG"_U_X
"RTN","PSBVDLUD",100,0)
 ...D:PSBSTUS="N"
"RTN","PSBVDLUD",101,0)
 ....S $P(PSBREC,U,11)=""
"RTN","PSBVDLUD",102,0)
 ....S Z="" F  S Z=$O(^PSB(53.79,X,.9,Z),-1) Q:'Z  Q:PSBFLAG=1  S PSBDATA=$G(^(Z,0)) D
"RTN","PSBVDLUD",103,0)
 .....I (PSBDATA["Set to 'NOT GIVEN'")!(PSBDATA["Set to 'GIVEN'")!(PSBDATA["Set to 'REFUSED'")!(PSBDATA["Set to 'HELD'")!(PSBDATA["Set to 'MISSING DOSE'")!(PSBDATA["Set to 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBVDLUD",104,0)
 .....I (PSBDATA["STATUS 'HELD'")!(PSBDATA["STATUS 'GIVEN'")!(PSBDATA["STATUS 'REFUSED'")!(PSBDATA["STATUS 'MISSING DOSE'")!(PSBDATA["STATUS 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBVDLUD",105,0)
 .....I PSBCNT#2=0,PSBDATA["'REFUSED'" S PSBSTUS="R" D LAST^PSBVDLU1
"RTN","PSBVDLUD",106,0)
 .....I PSBCNT#2=0,PSBDATA["'HELD'" S PSBSTUS="H" D LAST^PSBVDLU1
"RTN","PSBVDLUD",107,0)
 .....I PSBCNT#2=0,PSBDATA["'MISSING DOSE'" S PSBSTUS="M" D LAST^PSBVDLU1
"RTN","PSBVDLUD",108,0)
 .....I PSBCNT#2=0,PSBDATA["'REMOVED'" S PSBSTUS="RM" D LAST^PSBVDLU1
"RTN","PSBVDLUD",109,0)
 .....I PSBFLAG=1,'$D(PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))) S PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))=Z_U_X
"RTN","PSBVDLUD",110,0)
 .I $D(PSBHSTA) S $P(PSBREC,U,11)=$O(PSBHSTA(""),-1),PSBSTUS=$O(PSBHSTA($P(PSBREC,U,11),""),-1) M PSBHSTAX(PSBOIT)=PSBHSTA K PSBHSTA  ;last action date/time
"RTN","PSBVDLUD",111,0)
 .S $P(PSBREC,U,12)=""  ;med log ien inserted below for actual date
"RTN","PSBVDLUD",112,0)
 .S $P(PSBREC,U,13)=""  ;med log status inserted below for actual date
"RTN","PSBVDLUD",113,0)
 .S $P(PSBREC,U,14)="" ; admin date inserted below
"RTN","PSBVDLUD",114,0)
 .S $P(PSBREC,U,15)=PSBOIT ; OI Pointer
"RTN","PSBVDLUD",115,0)
 .S $P(PSBREC,U,16)=PSBNJECT  ;med route injectable flag
"RTN","PSBVDLUD",116,0)
 .; Variable dosage entered as ####-####?
"RTN","PSBVDLUD",117,0)
 .I $P(PSBREC,U,9)?1.4N1"-"1.4N.E S $P(PSBREC,U,17)=1
"RTN","PSBVDLUD",118,0)
 .E  S $P(PSBREC,U,17)=0
"RTN","PSBVDLUD",119,0)
 .S:PSBDOSEF?1"CAP".E!(PSBDOSEF?1"TAB".E)!(PSBDOSEF="PATCH")!(PSBDOSEF="GUM,CHEWABLE") $P(PSBREC,U,18)=PSBDOSEF   ;dosage form, add Gum,Chewable for HD208693
"RTN","PSBVDLUD",120,0)
 .S $P(PSBREC,U,20)=$S((PSBSTUS="X")!(PSBSTUS="N"):"",1:PSBSTUS) ; last action status
"RTN","PSBVDLUD",121,0)
 .S $P(PSBREC,U,21)=PSBOST
"RTN","PSBVDLUD",122,0)
 .S $P(PSBREC,U,22)=PSBOSTS
"RTN","PSBVDLUD",123,0)
 .S $P(PSBREC,U,26)=PSBOSP
"RTN","PSBVDLUD",124,0)
 .S $P(PSBREC,U,27)=$$LASTG^PSBCSUTL(DFN,PSBOIT)
"RTN","PSBVDLUD",125,0)
 .;*58 determine if override or intervn exists, send 1/0 (true/false)
"RTN","PSBVDLUD",126,0)
 .N PSBARR D GETPROVL^PSGSICH1(DFN,PSBONX,.PSBARR)
"RTN","PSBVDLUD",127,0)
 .I $O(PSBARR(""))="" D INTRDIC^PSGSICH1(DFN,PSBONX,.PSBARR,2)
"RTN","PSBVDLUD",128,0)
 .S $P(PSBREC,U,29)=$S($O(PSBARR(""))]"":1,1:0)
"RTN","PSBVDLUD",129,0)
 .;*68 add last injection site
"RTN","PSBVDLUD",130,0)
 .K LI D RPC^PSBINJEC(.LI,DFN,PSBOIT,9999999,1)
"RTN","PSBVDLUD",131,0)
 .S $P(PSBREC,U,30)=$P(LI(1),U,6)   ;if no inj's, 6th will be null
"RTN","PSBVDLUD",132,0)
 .;       piece 31 reserved by IVPB tab
"RTN","PSBVDLUD",133,0)
 .S $P(PSBREC,U,32)=$G(PSBCLORD)  ;clinic name          *70
"RTN","PSBVDLUD",134,0)
 .S $P(PSBREC,U,33)=$G(PSBCLIEN)  ;clinic ien ptr       *70
"RTN","PSBVDLUD",135,0)
 .;
"RTN","PSBVDLUD",136,0)
 .; Gather Dispense Drugs
"RTN","PSBVDLUD",137,0)
 .D NOW^%DTC
"RTN","PSBVDLUD",138,0)
 .S (PSBDDS,PSBSOLS,PSBADDS,PSBFLAG)="0"
"RTN","PSBVDLUD",139,0)
 .F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBVDLUD",140,0)
 ..I $P(PSBDDA(Y),U,5)=$P(%,".") S PSBFLAG=1 ;If drug was inactivated
"RTN","PSBVDLUD",141,0)
 ..Q:$P(PSBDDA(Y),U,5)&($P(PSBDDA(Y),U,5)<%)  ; Inactive
"RTN","PSBVDLUD",142,0)
 ..S:$P(PSBDDA(Y),U,4)="" $P(PSBDDA(Y),U,4)=1
"RTN","PSBVDLUD",143,0)
 ..S PSBDDS=PSBDDS_U_$P(PSBDDA(Y),U,1,4)
"RTN","PSBVDLUD",144,0)
 ..S $P(PSBDDS,U,1)=PSBDDS+1
"RTN","PSBVDLUD",145,0)
 .;
"RTN","PSBVDLUD",146,0)
 .; On-Call One Time PRN orders
"RTN","PSBVDLUD",147,0)
 .S PSBQRR=0
"RTN","PSBVDLUD",148,0)
 .;*70 if Order start dates > than the day being viewed, don't show
"RTN","PSBVDLUD",149,0)
 .I "^O^OC^P^"[(U_PSBSCHT_U) D  Q
"RTN","PSBVDLUD",150,0)
 ..Q:PSBCLINORD&($P(PSBOST,".")>PSBDT)                ;*70
"RTN","PSBVDLUD",151,0)
 ..D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1,PSBDDS,PSBSOLS,PSBADDS,"UDTAB")
"RTN","PSBVDLUD",152,0)
 .;
"RTN","PSBVDLUD",153,0)
 .; Now we deal with only continuous
"RTN","PSBVDLUD",154,0)
 .; process admintimes
"RTN","PSBVDLUD",155,0)
 .; Display an order on the VDL based on the frequency received from IPM **PSB*2.0*3
"RTN","PSBVDLUD",156,0)
 .S (PSBYES,PSBODD,PSBYTF)=0
"RTN","PSBVDLUD",157,0)
 .I PSBSCH="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"No Schedule on this order")
"RTN","PSBVDLUD",158,0)
 .S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBVDLUD",159,0)
 .I PSBYES,PSBADST="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH) Q
"RTN","PSBVDLUD",160,0)
 .F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1,PSBYTF=1
"RTN","PSBVDLUD",161,0)
 .I PSBSCHT="C",PSBYTF="1",PSBADST="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH) Q
"RTN","PSBVDLUD",162,0)
 .S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBVDLUD",163,0)
 .I PSBFREQ="O" S PSBFREQ=1440
"RTN","PSBVDLUD",164,0)
 .I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBVDLUD",165,0)
 .I 'PSBYES,PSBFREQ<1 D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH) Q
"RTN","PSBVDLUD",166,0)
 .I (PSBADST="")&(+PSBFREQ>0) D ODDSCH^PSBVDLU1("UDTAB") Q  ;calculate admin times based on frequency
"RTN","PSBVDLUD",167,0)
 .; No admin times, MAYDAY MAYDAY!!
"RTN","PSBVDLUD",168,0)
 .I +PSBFREQ>0 I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBVDLUD",169,0)
 .I PSBODD,PSBADST'="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Administration Times on ODD SCHEDULE",PSBSCH) Q
"RTN","PSBVDLUD",170,0)
 .; process admin times against beginning and ending date
"RTN","PSBVDLUD",171,0)
 .; build all orders for both days.
"RTN","PSBVDLUD",172,0)
 .F PSBY=1:1 Q:$P(PSBADST,"-",PSBY)=""  D
"RTN","PSBVDLUD",173,0)
 ..;For invalid admin times
"RTN","PSBVDLUD",174,0)
 ..I ($P(PSBADST,"-",PSBY)'?2N)&($P(PSBADST,"-",PSBY)'?4N) D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid Admin times",PSBSCH)
"RTN","PSBVDLUD",175,0)
 ..; apply this time to the beginning window date
"RTN","PSBVDLUD",176,0)
 ..S PSB=+(PSBWBEG\1_"."_$P(PSBADST,"-",PSBY))
"RTN","PSBVDLUD",177,0)
 ..D:(PSB'<PSBWBEG)&(PSB'>PSBWEND)  ; Make sure it is in the window
"RTN","PSBVDLUD",178,0)
 ...D:(PSB'<PSBOST)&(PSB<PSBOSP)  ; Make sure this time is active
"RTN","PSBVDLUD",179,0)
 ....D:$$OKAY^PSBVDLU1(PSBOST,PSB,PSBSCH,PSBONX,PSBOITX,PSBFREQ,PSBOSTS)  ; Okay on this date?
"RTN","PSBVDLUD",180,0)
 .....D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"UDTAB")
"RTN","PSBVDLUD",181,0)
 ..;
"RTN","PSBVDLUD",182,0)
 ..Q:(PSBWBEG\1)=(PSBWEND\1)  ; Window only has one day rare but possible
"RTN","PSBVDLUD",183,0)
 ..;
"RTN","PSBVDLUD",184,0)
 ..; apply this time to the ending window date
"RTN","PSBVDLUD",185,0)
 ..S PSB=+(PSBWEND\1_"."_$P(PSBADST,"-",PSBY))
"RTN","PSBVDLUD",186,0)
 ..D:(PSB'<PSBWBEG)&(PSB'>PSBWEND)  ; Make sure it is in the window
"RTN","PSBVDLUD",187,0)
 ...D:(PSB'<PSBOST)&(PSB<PSBOSP)  ; Make sure this time is active
"RTN","PSBVDLUD",188,0)
 ....D:$$OKAY^PSBVDLU1(PSBOST,PSB,PSBSCH,PSBONX,PSBOITX,PSBFREQ,PSBOSTS)  ; Okay on this date?
"RTN","PSBVDLUD",189,0)
 .....D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"UDTAB")
"RTN","PSBVDLUD",190,0)
 .K PSBSTUS
"RTN","PSBVDLUD",191,0)
1 K PSBREC D EN^PSBVDLPA
"RTN","PSBVDLUD",192,0)
 ;add initials of verifying pharmacist/verifying nurse
"RTN","PSBVDLUD",193,0)
 D:PSBTAB="UDTAB" VNURSE^PSBVDLU1("UDTAB")
"RTN","PSBVDLUD",194,0)
 D CLEAN^PSBVT
"RTN","PSBVDLUD",195,0)
 Q
"RTN","PSBVDLUD",196,0)
 ;
"RTN","PSBVDLVL")
0^19^B74523979^B65042783
"RTN","PSBVDLVL",1,0)
PSBVDLVL ;BIRMINGHAM/EFC-BCMA VIRTUAL DUE LIST FUNCTIONS ;11/27/12 3:52pm
"RTN","PSBVDLVL",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,3,12,11,13,32,25,61,70**;Mar 2004;Build 101
"RTN","PSBVDLVL",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBVDLVL",4,0)
 ;
"RTN","PSBVDLVL",5,0)
 ;
"RTN","PSBVDLVL",6,0)
 ; Reference/IA
"RTN","PSBVDLVL",7,0)
 ; $$GET^XPAR/2263
"RTN","PSBVDLVL",8,0)
 ; 
"RTN","PSBVDLVL",9,0)
 ;*70 - Clinic Orders will use an Admin Early/Late calc of any day
"RTN","PSBVDLVL",10,0)
 ;      before or After TODAY instead of minutes as in IM meds.
"RTN","PSBVDLVL",11,0)
 ;
"RTN","PSBVDLVL",12,0)
EN(RESULTS,DFN,PSBXOR,PSBTYPE,PSBADMIN,PSBTAB,PSBUID,PSBASTS,PSBORSTS,PSBRMV) ;
"RTN","PSBVDLVL",13,0)
 ;
"RTN","PSBVDLVL",14,0)
 ; RPC: PSB VALIDATE ORDER
"RTN","PSBVDLVL",15,0)
 ;
"RTN","PSBVDLVL",16,0)
 ; Description: Final check of order against an actual administration
"RTN","PSBVDLVL",17,0)
 ;              date/time used immediately after scanned med has been
"RTN","PSBVDLVL",18,0)
 ;              validated to be a good un-administered order.
"RTN","PSBVDLVL",19,0)
 ;
"RTN","PSBVDLVL",20,0)
 K PSBTST
"RTN","PSBVDLVL",21,0)
 N PSBFLAG
"RTN","PSBVDLVL",22,0)
 I PSBRMV="I" D GETOHIST^PSBRPC2(.PSBTST,DFN,PSBXOR_PSBTYPE) S I=0 F  S I=$O(PSBTST(I)) Q:I=""  I $P(PSBTST(I),U,5)="I" S RESULTS(0)=1,RESULTS(1)="-2^" K PSBTST Q
"RTN","PSBVDLVL",23,0)
 K PSBOKAY D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBXOR_PSBTYPE) S PSB=0
"RTN","PSBVDLVL",24,0)
 S RESULTS(0)=1,RESULTS(1)="-1^***Unable to determine administration" ; Default Flag will be overwritten by anything
"RTN","PSBVDLVL",25,0)
 D NOW^%DTC
"RTN","PSBVDLVL",26,0)
 I ((PSBOSTS="A")!(PSBOSTS="R"))&(PSBOSP<%) S PSBOSTS="E"
"RTN","PSBVDLVL",27,0)
 I PSBORSTS'=PSBOSTS,((PSBSCHT'="O")&(PSBOSTS'="E")) S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)="-2^ORDER STATUS MISMATCH" Q
"RTN","PSBVDLVL",28,0)
 I ((PSBTAB="UDTAB")!(PSBTAB="PBTAB")),((PSBRMV="RM")!(PSBRMV="N")) D  Q
"RTN","PSBVDLVL",29,0)
 .S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)="0^OKAY TO REMOVE"  ; patch removal does not follow rest of validte rules
"RTN","PSBVDLVL",30,0)
 .I PSBASTS="" Q  ;status is not given - don't check for missmatch
"RTN","PSBVDLVL",31,0)
 .I $D(^PSB(53.79,"AORD",DFN,PSBXOR_PSBTYPE,+PSBADMIN)) S X=$O(^PSB(53.79,"AORD",DFN,PSBXOR_PSBTYPE,+PSBADMIN,"")) I $P($G(^PSB(53.79,+X,0)),U,9)'=PSBASTS  S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)="-2^Admin status mismatch"
"RTN","PSBVDLVL",32,0)
 I PSBTYPE="V",PSBSCHT'="P",((PSBUID="")!(PSBUID["WS")) S RESULTS(0)=1,RESULTS(1)="0^Okay to administer" Q:PSBTAB="IVTAB"
"RTN","PSBVDLVL",33,0)
 I PSBTYPE="V",PSBUID'="" D  Q:PSBTAB="IVTAB"  ; validate IV bags Piggybacks have additional tests
"RTN","PSBVDLVL",34,0)
 .S PSB=0,PSBSUID=PSBUID D EN^PSBPOIV(DFN,PSBXOR_PSBTYPE)
"RTN","PSBVDLVL",35,0)
 .S X="" F  S X=$O(^TMP("PSBAR",$J,X)) Q:X=""  D
"RTN","PSBVDLVL",36,0)
 ..I PSBSUID'=X Q
"RTN","PSBVDLVL",37,0)
 ..S PSBUIDS=^TMP("PSBAR",$J,X)
"RTN","PSBVDLVL",38,0)
 ..I $P(PSBUIDS,U,2)="I"!($P(PSBUIDS,U,2)="S") S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)="0^Okay to administer" Q  ; is infusing or stopped
"RTN","PSBVDLVL",39,0)
 ..I $P(PSBUIDS,U,1)="I" S Y=$P(^TMP("PSBAR",$J,"I"),U,2) D DD^%DT S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)=$P(^TMP("PSBAR",$J,"I"),U,3,99)_"  "_Y Q
"RTN","PSBVDLVL",40,0)
 ..I $P(PSBUIDS,U,1)["W" S PSBWS=$P(PSBUIDS,U,1) F PSBWM=2:1 Q:$P(PSBWS,";",PSBWM)=""  D
"RTN","PSBVDLVL",41,0)
 ...S Y=$P(^TMP("PSBAR",$J,"W",$P(PSBWS,";",PSBWM)),U,2) D DD^%DT S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)=$P(^TMP("PSBAR",$J,"W",$P(PSBWS,";",PSBWM)),U,3,99)_" "_Y
"RTN","PSBVDLVL",42,0)
 ..S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)="0^Okay to administer"
"RTN","PSBVDLVL",43,0)
 .K ^TMP("PSBAR",$J)
"RTN","PSBVDLVL",44,0)
 ;
"RTN","PSBVDLVL",45,0)
 ; no IV orders
"RTN","PSBVDLVL",46,0)
 ;
"RTN","PSBVDLVL",47,0)
 D NOW^%DTC
"RTN","PSBVDLVL",48,0)
 I PSBOSTS="H" S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)="0^Order is on Provider Hold" Q
"RTN","PSBVDLVL",49,0)
 ;test for non-one time orders   admin prior to start date of order
"RTN","PSBVDLVL",50,0)
 I PSBSCHT'="O"&(%<($$FMADD^XLFDT(PSBOST,"","",$$GET^XPAR("ALL","PSB ADMIN BEFORE")*-1))) S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)="-1^Order Not Active" Q
"RTN","PSBVDLVL",51,0)
 I (%>PSBOSP) S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)="-1^Order Not Active" Q
"RTN","PSBVDLVL",52,0)
 ;tests sched types of continuous or prns that are patches
"RTN","PSBVDLVL",53,0)
 I (PSBSCHT="C")!((PSBSCHT="P")&(PSBDOSEF="PATCH")) D
"RTN","PSBVDLVL",54,0)
 .S PSBOKAY="0^Okay to administer"
"RTN","PSBVDLVL",55,0)
 .I PSBASTS["*UNKNOWN*" S PSBOKAY="-1^This administration has *UNKNOWN* status" Q
"RTN","PSBVDLVL",56,0)
 .I PSBOSTS'="A",PSBOSTS'="R",PSBOSTS'="O" S PSBOKAY="-1^Order Not Active" Q
"RTN","PSBVDLVL",57,0)
 .I PSBNGF S PSBOKAY="-1^marked DO NOT GIVE" Q
"RTN","PSBVDLVL",58,0)
 .S PSBFLAG=0 I PSBRMV="M"!(PSBRMV="H")!(PSBRMV="R") S PSBFLAG=1
"RTN","PSBVDLVL",59,0)
 .I $D(^PSB(53.79,"AORDX",DFN,PSBXOR_PSBTYPE)) D  Q:X
"RTN","PSBVDLVL",60,0)
 ..S X=0,PSBLADT=$O(^PSB(53.79,"AORDX",DFN,PSBXOR_PSBTYPE,""),-1),PSBLAIEN=$O(^PSB(53.79,"AORDX",DFN,PSBXOR_PSBTYPE,PSBLADT,""),-1)
"RTN","PSBVDLVL",61,0)
 ..I $P($G(^PSB(53.79,PSBLAIEN,0)),U,9)="G",$P($G(^PSB(53.79,PSBLAIEN,.5,1,0)),U,4)="PATCH",PSBFLAG=0 S X=1,PSBOKAY="-1^Previous patch has not been removed" Q
"RTN","PSBVDLVL",62,0)
 .I $D(^PSB(53.79,"AORD",DFN,PSBXOR_PSBTYPE,+PSBADMIN)) D  Q:+PSBOKAY<0
"RTN","PSBVDLVL",63,0)
 ..S X=$O(^PSB(53.79,"AORD",DFN,PSBXOR_PSBTYPE,+PSBADMIN,""))
"RTN","PSBVDLVL",64,0)
 ..L +^PSB(53.79,+X):1
"RTN","PSBVDLVL",65,0)
 ..I  L -^PSB(53.79,+X)
"RTN","PSBVDLVL",66,0)
 ..E  S PSBOKAY="-1^The "_$$GET1^DIQ(53.79,+X_",",.13)_" administration is being edited by another" Q
"RTN","PSBVDLVL",67,0)
 ..I $G(PSBASTS)]"" D  Q:+PSBOKAY<0
"RTN","PSBVDLVL",68,0)
 ...I $P($G(^PSB(53.79,+X,0)),U,9)="" Q
"RTN","PSBVDLVL",69,0)
 ...I $P($G(^PSB(53.79,+X,0)),U,9)'=PSBASTS S PSBOKAY="-2^Admin status mismatch" Q
"RTN","PSBVDLVL",70,0)
 .;*70 perform early/late admin testing of for IM & CO orders
"RTN","PSBVDLVL",71,0)
 .D:($G(PSBCLORD)="")  ;IM order orig logic
"RTN","PSBVDLVL",72,0)
 ..; Minutes before
"RTN","PSBVDLVL",73,0)
 ..S PSBWIN1=$$GET^XPAR("DIV","PSB ADMIN BEFORE")*-1
"RTN","PSBVDLVL",74,0)
 ..; Minutes After
"RTN","PSBVDLVL",75,0)
 ..S PSBWIN2=$$GET^XPAR("DIV","PSB ADMIN AFTER")
"RTN","PSBVDLVL",76,0)
 ..D NOW^%DTC S PSBMIN=$$DIFF^PSBUTL(PSBADMIN,%)
"RTN","PSBVDLVL",77,0)
 ..I PSBMIN<PSBWIN1 S PSBOKAY="1^Admin is "_(PSBMIN*-1)_" minutes before the scheduled administration time" Q
"RTN","PSBVDLVL",78,0)
 ..I PSBMIN>PSBWIN2 S PSBOKAY="1^Admin is "_(PSBMIN)_" minutes after the scheduled administration time" Q
"RTN","PSBVDLVL",79,0)
 ..S PSBOKAY="0^Okay to administer"
"RTN","PSBVDLVL",80,0)
 .D:($G(PSBCLORD)]"")  ;CO order new logic
"RTN","PSBVDLVL",81,0)
 ..N ADMINDT S ADMINDT=$P(PSBADMIN,".")
"RTN","PSBVDLVL",82,0)
 ..S PSBOKAY="1^You are about to give a medication that "
"RTN","PSBVDLVL",83,0)
 ..I ADMINDT>DT D  Q
"RTN","PSBVDLVL",84,0)
 ...S PSBOKAY=PSBOKAY_"is scheduled for "_$$DOW^XLFDT(ADMINDT)_", "_$$FMTE^XLFDT(ADMINDT,5)_"."
"RTN","PSBVDLVL",85,0)
 ..I ADMINDT<DT D  Q
"RTN","PSBVDLVL",86,0)
 ...S PSBOKAY=PSBOKAY_"was scheduled for "_$$DOW^XLFDT(ADMINDT)_", "_$$FMTE^XLFDT(ADMINDT,5)_"."
"RTN","PSBVDLVL",87,0)
 ..S PSBOKAY="0^Okay to administer"
"RTN","PSBVDLVL",88,0)
 .;*70 end early/late logic
"RTN","PSBVDLVL",89,0)
 ;
"RTN","PSBVDLVL",90,0)
 ; Validate a PRN Order
"RTN","PSBVDLVL",91,0)
 D:(PSBSCHT="P")
"RTN","PSBVDLVL",92,0)
 .I PSBOSTS'="A",PSBOSTS'="R",PSBOSTS'="O" S PSBOKAY="-1^Order Not Active" Q
"RTN","PSBVDLVL",93,0)
 .I PSBNGF S PSBOKAY="-1^marked DO NOT GIVE" Q
"RTN","PSBVDLVL",94,0)
 .I (+($G(PSBOKAY))<0)&(PSBDOSEF="PATCH") Q  ;A Patch may have to be removed.
"RTN","PSBVDLVL",95,0)
 .S PSBOKAY="1^"
"RTN","PSBVDLVL",96,0)
 .; Get Last Four Givens
"RTN","PSBVDLVL",97,0)
 .S PSBDT=""
"RTN","PSBVDLVL",98,0)
 .F  S PSBDT=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,PSBDT),-1) Q:PSBDT=""  D
"RTN","PSBVDLVL",99,0)
 ..S PSBDA=""
"RTN","PSBVDLVL",100,0)
 ..F  S PSBDA=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,PSBDT,PSBDA),-1) Q:'PSBDA  D
"RTN","PSBVDLVL",101,0)
 ...S (PSBCNT1,PSBCNT2,PSBCNT3)=0
"RTN","PSBVDLVL",102,0)
 ...S PSBLADT=$$GET1^DIQ(53.79,PSBDA_",",.06,"I")
"RTN","PSBVDLVL",103,0)
 ...S PSBSTUS=$$GET1^DIQ(53.79,PSBDA_",",.09)
"RTN","PSBVDLVL",104,0)
 ...S:PSBSTUS="" PSBSTUS="U"
"RTN","PSBVDLVL",105,0)
 ...S PSBSCH=$$GET1^DIQ(53.79,PSBDA_",",.12)
"RTN","PSBVDLVL",106,0)
 ...S PSBRSN=$$GET1^DIQ(53.79,PSBDA_",",.21)
"RTN","PSBVDLVL",107,0)
 ...S PSBINJ=$$GET1^DIQ(53.79,PSBDA_",",.16)
"RTN","PSBVDLVL",108,0)
 ...Q:$P(^PSB(53.79,PSBDA,0),U,9)="N"
"RTN","PSBVDLVL",109,0)
 ...F PSBZ=.5,.6,.7 F PSBY=0:0 S PSBY=$O(^PSB(53.79,PSBDA,PSBZ,PSBY)) Q:'PSBY  D
"RTN","PSBVDLVL",110,0)
 ....Q:'$D(^PSB(53.79,PSBDA,PSBZ,PSBY))
"RTN","PSBVDLVL",111,0)
 ....S PSBDD=$S(PSBZ=.5:53.795,PSBZ=.6:53.796,1:53.797)
"RTN","PSBVDLVL",112,0)
 ....S PSBUNIT=$$GET1^DIQ(PSBDD,PSBY_","_PSBDA_",",.03) S:PSBUNIT>0&(PSBUNIT<1) PSBUNIT="0"_+PSBUNIT ;Add leading 0 for decimal values less than 1, PSB*3*61
"RTN","PSBVDLVL",113,0)
 ....S PSBUNFR=$$GET1^DIQ(PSBDD,PSBY_","_PSBDA_",",.04)
"RTN","PSBVDLVL",114,0)
 ....I PSBZ=.5 S PSBCNT1=PSBCNT1+1
"RTN","PSBVDLVL",115,0)
 ....I PSBZ=.6 S PSBCNT2=PSBCNT2+1
"RTN","PSBVDLVL",116,0)
 ....I PSBZ=.7 S PSBCNT3=PSBCNT3+1
"RTN","PSBVDLVL",117,0)
 ...;Units given or free text not to display for multiple dispense drugs or additives and solution
"RTN","PSBVDLVL",118,0)
 ...I (PSBCNT1>1)!(PSBCNT2>0)!(PSBCNT3>0) S (PSBUNIT,PSBUNFR)=""
"RTN","PSBVDLVL",119,0)
 ...S X=PSBLADT_U
"RTN","PSBVDLVL",120,0)
 ...S X=X_PSBSTUS_U_PSBSCH_U_$G(PSBRSN)_U_$G(PSBINJ)_U_$G(PSBUNIT)_U_$G(PSBUNFR)
"RTN","PSBVDLVL",121,0)
 ...S PSBOKAY($O(PSBOKAY(""),-1)+1)=3_U_X
"RTN","PSBVDLVL",122,0)
 ...S:$D(PSBOKAY(4)) PSBDT=0
"RTN","PSBVDLVL",123,0)
 .S X1=$$LASTG^PSBCSUTL(DFN,+PSBOIT) I X1>0 S PSBOKAY($O(PSBOKAY(""),-1)+1)=4_U_X1
"RTN","PSBVDLVL",124,0)
 ; Validate a One-Time Order
"RTN","PSBVDLVL",125,0)
 D:PSBSCHT="O"
"RTN","PSBVDLVL",126,0)
 .S (PSBGVN,X,Y)=""
"RTN","PSBVDLVL",127,0)
 .F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1)  Q:'X  F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  I $P(^PSB(53.79,Y,.1),U)=PSBONX,"G"[$P(^PSB(53.79,Y,0),U,9) S PSBGVN=1,(X,Y)=0
"RTN","PSBVDLVL",128,0)
 .I PSBGVN S PSBOKAY="-1^Dose Already on medication Log" Q
"RTN","PSBVDLVL",129,0)
 .; One Time are automatically expired so we don't check STATUS here
"RTN","PSBVDLVL",130,0)
 .I PSBNGF S PSBOKAY="-1^marked DO NOT GIVE" Q
"RTN","PSBVDLVL",131,0)
 .S PSBOKAY="0^Okay to administer"
"RTN","PSBVDLVL",132,0)
 ; Validate an On Call Order
"RTN","PSBVDLVL",133,0)
 D:PSBSCHT="OC"
"RTN","PSBVDLVL",134,0)
 .S PSBOKAY="0^Okay to administer"
"RTN","PSBVDLVL",135,0)
 .S (PSBGVN,X,Y)=""
"RTN","PSBVDLVL",136,0)
 .F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1)  Q:'X  F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  I $P(^PSB(53.79,Y,.1),U)=PSBONX,"G"[$P(^PSB(53.79,Y,0),U,9) S PSBGVN=1,(X,Y)=0
"RTN","PSBVDLVL",137,0)
 .I PSBGVN&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL")) S PSBOKAY="-1^Dose Already on medication Log" Q
"RTN","PSBVDLVL",138,0)
 .I PSBOSTS'="A",PSBOSTS'="R",PSBOSTS'="O" S PSBOKAY="-1^Order Not Active" Q
"RTN","PSBVDLVL",139,0)
 .I PSBNGF S PSBOKAY="-1^marked DO NOT GIVE" Q
"RTN","PSBVDLVL",140,0)
 .I PSBGVN&($$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL"))&(PSBDOSEF="PATCH") S PSBOKAY="-1^Previous patch has not been removed" Q
"RTN","PSBVDLVL",141,0)
 .S PSBOKAY="0^Okay to administer"
"RTN","PSBVDLVL",142,0)
 ;
"RTN","PSBVDLVL",143,0)
 D:+PSBOKAY'<0
"RTN","PSBVDLVL",144,0)
 .N PSBDIFF,Y
"RTN","PSBVDLVL",145,0)
 .D:(PSBSCHT="C")!(PSBSCHT="OC"&('$G(PSBGVN)))
"RTN","PSBVDLVL",146,0)
 ..; On-call or cont and not on the log.
"RTN","PSBVDLVL",147,0)
 ..S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,""),-1)
"RTN","PSBVDLVL",148,0)
 ..;Check for the status of the medication and insert status in the text
"RTN","PSBVDLVL",149,0)
 ..I Y]"" S X=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,Y,""),-1),PSBSTUS=$P(^PSB(53.79,X,0),U,9)
"RTN","PSBVDLVL",150,0)
 ..S:Y']"" PSBSTUS=""
"RTN","PSBVDLVL",151,0)
 ..I PSBSTUS="N" D  Q:$G(PSBQUIT)
"RTN","PSBVDLVL",152,0)
 ...S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,Y,X),-1)
"RTN","PSBVDLVL",153,0)
 ...D:X']""
"RTN","PSBVDLVL",154,0)
 ....S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,Y),-1) I Y']"" S PSBQUIT=1 Q
"RTN","PSBVDLVL",155,0)
 ....S X=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,Y,""),-1),PSBSTUS=$P(^PSB(53.79,X,0),U,9)
"RTN","PSBVDLVL",156,0)
 ..S PSBDIFF=$$FMDIFF^XLFDT($$NOW^XLFDT(),Y,2)
"RTN","PSBVDLVL",157,0)
 ..Q:PSBDIFF>7200  ; Greater than 2 hours
"RTN","PSBVDLVL",158,0)
 ..I (PSBSTUS="G")!(PSBSTUS="H")!(PSBSTUS="R")!(PSBSTUS="RM") D
"RTN","PSBVDLVL",159,0)
 ...S PSBSTUS=$$GET1^DIQ(53.79,X_",",.09)
"RTN","PSBVDLVL",160,0)
 ...I PSBSTUS'="" D
"RTN","PSBVDLVL",161,0)
 ....S Y="1^*** NOTICE, "_PSBOITX_" was "_PSBSTUS_" "_(PSBDIFF\60)_" minutes ago."
"RTN","PSBVDLVL",162,0)
 ....I +PSBOKAY=1 S PSBOKAY(1)=Y
"RTN","PSBVDLVL",163,0)
 ....E  S PSBOKAY=Y
"RTN","PSBVDLVL",164,0)
 ;
"RTN","PSBVDLVL",165,0)
 S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)=PSBOKAY
"RTN","PSBVDLVL",166,0)
 F X=1:1 Q:'$D(PSBOKAY(X))  S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)=PSBOKAY(X)
"RTN","PSBVDLVL",167,0)
 Q
"RTN","PSBVITFL")
0^16^B9618228^B10030474
"RTN","PSBVITFL",1,0)
PSBVITFL ;BIRMINGHAM/TEJ - BCMA VITAL MEASUREMENT FILER ;7/25/12 11:57pm
"RTN","PSBVITFL",2,0)
 ;;3.0;BAR CODE MED ADMIN;**31,42,70**;Mar 2004;Build 101
"RTN","PSBVITFL",3,0)
 ; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSBVITFL",4,0)
 ; 
"RTN","PSBVITFL",5,0)
 ; Reference/IA
"RTN","PSBVITFL",6,0)
 ; STORE^GMRVPCE0/1589
"RTN","PSBVITFL",7,0)
 ; 44/908
"RTN","PSBVITFL",8,0)
 ; 42/10039
"RTN","PSBVITFL",9,0)
 ; 
"RTN","PSBVITFL",10,0)
 ;*70 remove discharge test
"RTN","PSBVITFL",11,0)
 ;
"RTN","PSBVITFL",12,0)
 ; Description:
"RTN","PSBVITFL",13,0)
 ; This routine is to service BCMA 3.0 functionality and store VITALs'
"RTN","PSBVITFL",14,0)
 ; data into the VA's VITAL MEASUREMENT FILE - ^GMR(120.5 using the
"RTN","PSBVITFL",15,0)
 ; API GMRVPCE0 or can store VITALs' data into the IHS (Indian Health
"RTN","PSBVITFL",16,0)
 ; Services PCC V MEASUREMENT file.  Determination for which file is
"RTN","PSBVITFL",17,0)
 ; based on the Agency code DUZ("AG") equal "V" or "I" & the Vitals 
"RTN","PSBVITFL",18,0)
 ; package flag at IHS is set to 1 for PCC V file.
"RTN","PSBVITFL",19,0)
 ; 
"RTN","PSBVITFL",20,0)
 ; Parameters:
"RTN","PSBVITFL",21,0)
 ;       Input  -        DFN     (r) Pointer to the PATIENT (#2) file
"RTN","PSBVITFL",22,0)
 ;                       RATE    (r) BCMA trigger event/transaction
"RTN","PSBVITFL",23,0)
 ;                       VTYPE   (o) Pointer to GMRV VITAL TYPE FILE (#120.51)
"RTN","PSBVITFL",24,0)
 ;                                    (default = Pain ["PN"])
"RTN","PSBVITFL",25,0)
 ;                       DTTKN   (o) Date/time (FileMan) measurement was taken 
"RTN","PSBVITFL",26,0)
 ;                                    (default = $$NOW^XLFDT())
"RTN","PSBVITFL",27,0)
 ;                                    
"RTN","PSBVITFL",28,0)
 ;       Output -        RESULTS(0) = 1                                                                                             
"RTN","PSBVITFL",29,0)
 ;                       RESULTS(1) ="1^*** comment ***"                                                              
"RTN","PSBVITFL",30,0)
 ;                 or    RESULTS(1) ="-1^ERROR * Pain Score NOT filed 
"RTN","PSBVITFL",31,0)
 ;                                    successfully"
"RTN","PSBVITFL",32,0)
 ;
"RTN","PSBVITFL",33,0)
 ;       Process results in the storing of VITAL Measurement rate into the VITAL
"RTN","PSBVITFL",34,0)
 ;       MEASUREMENT FILE per the given patient and vital type.
"RTN","PSBVITFL",35,0)
 ;   
"RTN","PSBVITFL",36,0)
RPC(RESULTS,PSBDFN,PSBRATE,PSBVTYPE,PSBDTTKN) ;
"RTN","PSBVITFL",37,0)
 ;
"RTN","PSBVITFL",38,0)
 ; Set up the input array for the API
"RTN","PSBVITFL",39,0)
 ;
"RTN","PSBVITFL",40,0)
 ;PSB*3*31 Quit if patient has been discharged.
"RTN","PSBVITFL",41,0)
 N VAIP,DFN S DFN=$G(PSBDFN) D IN5^VADPT
"RTN","PSBVITFL",42,0)
 ;*70 removed discharge code & test that was -here-
"RTN","PSBVITFL",43,0)
 S RESULTS(0)=1,RESULTS(1)="-1^ERROR * "_$S($G(PSBVTYPE)']""!($G(PSBVTYPE)="PN"):"Pain Score",1:"Vital Measurement")_" NOT filed successfully."
"RTN","PSBVITFL",44,0)
 S:$G(PSBVTYPE)']"" PSBVTYPE="PN"
"RTN","PSBVITFL",45,0)
 S:$G(PSBDTTKN)']"" PSBDTTKN=$$NOW^XLFDT()
"RTN","PSBVITFL",46,0)
 S:+$G(VAIP(5)) PSBHLOC=^DIC(42,+$G(VAIP(5)),44)  ;*70 clinic, no Hosp
"RTN","PSBVITFL",47,0)
 ;
"RTN","PSBVITFL",48,0)
 ;Store Vitals info into either the VA Vitals package or the IHS PCC
"RTN","PSBVITFL",49,0)
 ; V measurement package, based on agency variable and Vitals package ; flag setting=1 for PCC V Measurement 
"RTN","PSBVITFL",50,0)
 ;
"RTN","PSBVITFL",51,0)
 N VTYP,PCC,XREF,VSIT,VDAT
"RTN","PSBVITFL",52,0)
 I $G(DUZ("AG"))="I",$$GET^XPAR("ALL","BEHOVM USE VMSR") D
"RTN","PSBVITFL",53,0)
 .S XREF("T")="TMP",XREF("P")="PU",XREF("BP")="BP",XREF("R")="RS",XREF("PN")="PA"
"RTN","PSBVITFL",54,0)
 .S VTYP=+$$FIND1^DIC(9999999.07,"","BX",$$UP^XLFSTR($G(XREF(PSBVTYPE))))
"RTN","PSBVITFL",55,0)
 .Q:'VTYP
"RTN","PSBVITFL",56,0)
 .S VSIT=$P($G(^DGPM(+$G(VAIP(13)),0)),U,27)
"RTN","PSBVITFL",57,0)
 .S VDAT=$P($G(^AUPNVSIT(+VSIT,0)),U)
"RTN","PSBVITFL",58,0)
 .S PCC(1)="HDR^^^"_PSBHLOC_";"_$S(VDAT:VDAT,1:PSBDTTKN)_";H;"_VSIT
"RTN","PSBVITFL",59,0)
 .S PCC(2)="VST^DT^"_$S(VDAT:VDAT,1:PSBDTTKN)
"RTN","PSBVITFL",60,0)
 .S PCC(3)="VST^PT^"_PSBDFN
"RTN","PSBVITFL",61,0)
 .S PCC(4)="VIT+^"_VTYP_"^0^^"_PSBRATE_"^^^"_PSBDTTKN
"RTN","PSBVITFL",62,0)
 .D SAVE^BEHOENPC(.RESULTS,.PCC)
"RTN","PSBVITFL",63,0)
 .S:'RESULTS RESULTS(1)="1^"_$S($G(PSBVTYPE)="PN":"Pain Score",1:PSBVTYPE)_" entered in Vitals via BCMA taken "_$$FMTE^XLFDT(PSBDTTKN,"Z5")
"RTN","PSBVITFL",64,0)
 E  D
"RTN","PSBVITFL",65,0)
 .S GMRVDAT("ENCOUNTER")=U_PSBDFN_U_$G(PSBHLOC)
"RTN","PSBVITFL",66,0)
 .S GMRVDAT("SOURCE")=U_$G(DUZ)
"RTN","PSBVITFL",67,0)
 .S GMRVDAT("VITALS",$G(DUZ),1)=PSBVTYPE_U_$G(PSBRATE)_U_$G(PSBUNTS)_U_PSBDTTKN
"RTN","PSBVITFL",68,0)
 .D STORE^GMRVPCE0(.GMRVDAT)
"RTN","PSBVITFL",69,0)
 .I '$D(GMRVDAT("ERROR")) D NOW^%DTC,YX^%DTC S RESULTS(0)=1,RESULTS(1)="1^"_$S($G(PSBVTYPE)="PN":"Pain Score",1:PSBVTYPE)_" entered in Vitals via BCMA taken "_Y
"RTN","PSBVITFL",70,0)
 Q
"RTN","PSBVITFL",71,0)
 ;
"RTN","PSBVT")
0^7^B98717272^B80815673
"RTN","PSBVT",1,0)
PSBVT ;BIRMINGHAM/EFC-BCMA ORDER VARIABLES UTILITY ;1/23/13 1:23pm
"RTN","PSBVT",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,3,38,68,74,70**;Mar 2004;Build 101
"RTN","PSBVT",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSBVT",4,0)
 ;
"RTN","PSBVT",5,0)
 ; Reference/IA
"RTN","PSBVT",6,0)
 ; EN^PSJBCMA1/2829
"RTN","PSBVT",7,0)
 ; ^TMP("PSJ",$J/2828
"RTN","PSBVT",8,0)
 ;
"RTN","PSBVT",9,0)
 ;*68 Define New Variable (IEN from Med Route file) in Tag PSJ which
"RTN","PSBVT",10,0)
 ;    uses the TMP global built by a previous call to PSJBCMA Api.
"RTN","PSBVT",11,0)
 ;*70 - define new variable, 1/0 flag for is a Clinic order
"RTN","PSBVT",12,0)
 ;    - 1489: Blended PSB*3*74 with PSB*3*70
"RTN","PSBVT",13,0)
 ;
"RTN","PSBVT",14,0)
PSJ(PSBX1) ;
"RTN","PSBVT",15,0)
 S ^TMP("TK PSJ",PSBX1)=""
"RTN","PSBVT",16,0)
 S PSBSCRT="^TMP(""PSB"",$J,""PSBORDA"")"
"RTN","PSBVT",17,0)
 K @PSBSCRT M @PSBSCRT=^TMP("PSJ",$J,PSBX1)
"RTN","PSBVT",18,0)
 S PSBDFN=DFN
"RTN","PSBVT",19,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",0))
"RTN","PSBVT",20,0)
 S PSBON=+$P(PSBSCRT,U,3)        ; ord num w/o type
"RTN","PSBVT",21,0)
 S PSBONX=$P(PSBSCRT,U,3)        ; ord num w/  type "U" or "V"
"RTN","PSBVT",22,0)
 S PSBOTYP=$E(PSBONX,$L(PSBONX)) ; "U" or "V"
"RTN","PSBVT",23,0)
 S PSBPONX=$P(PSBSCRT,U,4)       ; prev ord num
"RTN","PSBVT",24,0)
 S PSBFON=$P(PSBSCRT,U,5)        ; foll ord num
"RTN","PSBVT",25,0)
 S PSBIVT=$P(PSBSCRT,U,6)        ; IV type
"RTN","PSBVT",26,0)
 S PSBISYR=$P(PSBSCRT,U,7)       ; intermit syrg
"RTN","PSBVT",27,0)
 S PSBCHEMT=$P(PSBSCRT,U,8)      ; chemo type
"RTN","PSBVT",28,0)
 S PSBCPRS=$P(PSBSCRT,U,9)       ; ords file entry (CPRS order #)
"RTN","PSBVT",29,0)
 S PSBFOR=$P(PSBSCRT,U,10)       ; reason for foll order
"RTN","PSBVT",30,0)
 S PSBCLORD=$P(PSBSCRT,U,11)     ; clinic order Name (is a CO)     *70
"RTN","PSBVT",31,0)
 ;  send clinic file #44 ien ptr                                   *70
"RTN","PSBVT",32,0)
 S PSBCLIEN=$P(PSBSCRT,U,12)                 ;*70
"RTN","PSBVT",33,0)
 Q:PSBSCRT=-1
"RTN","PSBVT",34,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",1))
"RTN","PSBVT",35,0)
 S PSBMR=$P($G(^TMP("PSB",$J,"PSBORDA",1,0)),U,2) ;med rt
"RTN","PSBVT",36,0)
 S PSBMRAB=$P(PSBSCRT,U,1) ;med rt abbr
"RTN","PSBVT",37,0)
 S PSBMRIEN=+$P($G(^TMP("PSB",$J,"PSBORDA",1,0)),U,4) ;med rt ien *68
"RTN","PSBVT",38,0)
 S PSBNJECT=+$G(^TMP("PSB",$J,"PSBORDA",1,0))  ;Inj site
"RTN","PSBVT",39,0)
 S PSBIVPSH=+$P($G(^TMP("PSB",$J,"PSBORDA",1,0)),U,3) ;IV PUSH
"RTN","PSBVT",40,0)
 S PSBSCHT=$P(PSBSCRT,U,2)  ; sched type conversion
"RTN","PSBVT",41,0)
 S PSBSCH=$P(PSBSCRT,U,3)  ; sched
"RTN","PSBVT",42,0)
 S PSBOST=$P(PSBSCRT,U,4)  ; strt dte FM
"RTN","PSBVT",43,0)
 S PSBOSP=$P(PSBSCRT,U,5)  ; stp dte FM
"RTN","PSBVT",44,0)
 S PSBADST=$P(PSBSCRT,U,6)  ; admin times strin in NNNN- format
"RTN","PSBVT",45,0)
 S PSBOSTS=$P(PSBSCRT,U,7)  ; status
"RTN","PSBVT",46,0)
 S PSBNGF=$P(PSBSCRT,U,8)  ; not to be given flag
"RTN","PSBVT",47,0)
 S PSBOSCHT=$P(PSBSCRT,U,9)  ; origin sched type
"RTN","PSBVT",48,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",2))
"RTN","PSBVT",49,0)
 S PSBDOSE=$P(PSBSCRT,U,1)  ; dosage ordered
"RTN","PSBVT",50,0)
 S PSBIFR=$P(PSBSCRT,U,2)  ; infusn rate
"RTN","PSBVT",51,0)
 S PSBSM=$P(PSBSCRT,U,3)  ; self med
"RTN","PSBVT",52,0)
 S PSBHSM=$P(PSBSCRT,U,4)  ; hospital supplied self med
"RTN","PSBVT",53,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",3))
"RTN","PSBVT",54,0)
 S PSBOIT=$P(PSBSCRT,U,1)  ; order item IEN - > ^ORD(101.43)
"RTN","PSBVT",55,0)
 S PSBOITX=$P(PSBSCRT,U,2)  ; order item (expanded)_" "_dosage form
"RTN","PSBVT",56,0)
 I PSBOITX="" S PSBOITX="ZZZZ NO ORDERABLE ITEM"
"RTN","PSBVT",57,0)
 S PSBDOSEF=$P(PSBSCRT,U,3)  ; dosage form
"RTN","PSBVT",58,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",4))
"RTN","PSBVT",59,0)
 S PSBOTXT=PSBSCRT  ; special inst/other print info
"RTN","PSBVT",60,0)
 ; get disp drug
"RTN","PSBVT",61,0)
 I $G(^TMP("PSB",$J,"PSBORDA",700,0)) F PSBX2=1:1:^TMP("PSB",$J,"PSBORDA",700,0) M PSBDDA(PSBX2)=^TMP("PSB",$J,"PSBORDA",700,PSBX2,0) S PSBDDA(PSBX2)="DD^"_PSBDDA(PSBX2) ; # of DDrug
"RTN","PSBVT",62,0)
 ;     "DD"^dispensed drug IEN -> ^PSDRUG() DRUG^dispensed drug name^units per dose^inactive date
"RTN","PSBVT",63,0)
 ; build unique id list
"RTN","PSBVT",64,0)
 ; add addits
"RTN","PSBVT",65,0)
 I $D(^TMP("PSB",$J,"PSBORDA",800)) S PSBX2="" F  S PSBX2=$O(^TMP("PSB",$J,"PSBORDA",800,PSBX2)) Q:PSBX2=""!(PSBX2="ERROR")  D
"RTN","PSBVT",66,0)
 .S PSBUIDA(PSBX2)="ID^"_PSBX2 F J=1:1:^TMP("PSB",$J,"PSBORDA",800,PSBX2,0) S PSBUIDA(PSBX2)=PSBUIDA(PSBX2)_"^"_"ADD;"_$P(^TMP("PSB",$J,"PSBORDA",800,PSBX2,J),U,1)
"RTN","PSBVT",67,0)
 ; add solutions
"RTN","PSBVT",68,0)
 I $D(^TMP("PSB",$J,"PSBORDA",900)) S PSBX2="" F  S PSBX2=$O(^TMP("PSB",$J,"PSBORDA",900,PSBX2)) Q:PSBX2=""!(PSBX2="ERROR")  D
"RTN","PSBVT",69,0)
 .I '$D(PSBUIDA(PSBX2)) S PSBUIDA(PSBX2)="ID^"_PSBX2
"RTN","PSBVT",70,0)
 .F J=1:1:^TMP("PSB",$J,"PSBORDA",900,PSBX2,0) S PSBUIDA(PSBX2)=PSBUIDA(PSBX2)_"^"_"SOL;"_$P(^TMP("PSB",$J,"PSBORDA",900,PSBX2,J),U,1)
"RTN","PSBVT",71,0)
 ;     "ID"   ^   (piece 2,3,)... = type;IEN of each add/sol for this ID ex. "SOL;4"
"RTN","PSBVT",72,0)
 ; get addits
"RTN","PSBVT",73,0)
 I $G(^TMP("PSB",$J,"PSBORDA",850,0)) F PSBX2=1:1:^TMP("PSB",$J,"PSBORDA",850,0) D
"RTN","PSBVT",74,0)
 .M PSBADA(PSBX2)=^TMP("PSB",$J,"PSBORDA",850,PSBX2,0)  ; number od additives (exists only for IV)
"RTN","PSBVT",75,0)
 .S PSBADA(PSBX2)="ADD^"_PSBADA(PSBX2)
"RTN","PSBVT",76,0)
 .S PSBBAGS=$P(PSBADA(PSBX2),U,5) I PSBBAGS'="" S PSBBAG=" IN BAG "_$P(PSBBAGS,",",1) F I=2:1 S X=$P(PSBBAGS,",",I) Q:X=""  S PSBBAG=PSBBAG_" AND "_X
"RTN","PSBVT",77,0)
 .S:PSBBAGS'="" $P(PSBADA(PSBX2),U,5)=PSBBAG,$P(PSBADA(PSBX2),U,6)=PSBBAGS
"RTN","PSBVT",78,0)
 .D ZADD(2)          ;*only executes for TEST accounts
"RTN","PSBVT",79,0)
 ; "ADD"^add IEN PS(52.6)^additive name^strength ^bottle^high risk
"RTN","PSBVT",80,0)
 ;
"RTN","PSBVT",81,0)
 ; get soluts
"RTN","PSBVT",82,0)
 I $G(^TMP("PSB",$J,"PSBORDA",950,0)) D
"RTN","PSBVT",83,0)
 .F PSBX2=1:1:^TMP("PSB",$J,"PSBORDA",950,0) D
"RTN","PSBVT",84,0)
 ..M PSBSOLA(PSBX2)=^TMP("PSB",$J,"PSBORDA",950,PSBX2,0)
"RTN","PSBVT",85,0)
 ..S PSBSOLA(PSBX2)="SOL^"_PSBSOLA(PSBX2)    ;# of SOL
"RTN","PSBVT",86,0)
 ..D ZSOL(2)         ;*only executes for TEST accounts
"RTN","PSBVT",87,0)
 ; "SOL"^solution IEN PS(52.7)^solution name^volume^^high risk drg
"RTN","PSBVT",88,0)
 ;
"RTN","PSBVT",89,0)
 K ^TMP("PSB",$J,"PSBORDA"),PSBX1,PSBX2
"RTN","PSBVT",90,0)
 Q
"RTN","PSBVT",91,0)
 ;
"RTN","PSBVT",92,0)
PSJ1(PSBPAR1,PSBPAR2,PSBIGS2B,PSBEXIST) ; set the variables for an individual order
"RTN","PSBVT",93,0)
 S ^TMP("TK PSJ1",PSBPAR1,PSBPAR2)=""
"RTN","PSBVT",94,0)
 ;     PSBPAR1 = DFN
"RTN","PSBVT",95,0)
 ;     PSBPAR2 = ORDER NUMBER 
"RTN","PSBVT",96,0)
 ;     PSBPAR3 = IGNORE "SEND TO BCMA" CLINIC PARAMETER (Label Invalidation)
"RTN","PSBVT",97,0)
 S PSBSCRT="^TMP(""PSB"",$J,""PSBORDA"")"
"RTN","PSBVT",98,0)
 K @PSBSCRT
"RTN","PSBVT",99,0)
 N PSBX
"RTN","PSBVT",100,0)
 K ^TMP("PSJ1",$J) D EN^PSJBCMA1(PSBPAR1,PSBPAR2,1,$G(PSBIGS2B),.PSBEXIST)
"RTN","PSBVT",101,0)
 M @PSBSCRT=^TMP("PSJ1",$J) K ^TMP("PSJ1",$J)
"RTN","PSBVT",102,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",0))
"RTN","PSBVT",103,0)
 S PSBDFN=PSBPAR1
"RTN","PSBVT",104,0)
 S PSBON=+$P(PSBSCRT,U,3)  ; ord num w/o type
"RTN","PSBVT",105,0)
 S PSBONX=$P(PSBSCRT,U,3)  ; ord num w/  type "U" or "V"
"RTN","PSBVT",106,0)
 S PSBOTYP=$E(PSBONX,$L(PSBONX))
"RTN","PSBVT",107,0)
 S PSBPONX=$P(PSBSCRT,U,4)  ; prev ord num
"RTN","PSBVT",108,0)
 S PSBFON=$P(PSBSCRT,U,5)  ; foll ord num
"RTN","PSBVT",109,0)
 S PSBIVT=$P(PSBSCRT,U,6)  ; IV type
"RTN","PSBVT",110,0)
 S PSBISYR=$P(PSBSCRT,U,7)  ; intermit syrg
"RTN","PSBVT",111,0)
 S PSBCHEMT=$P(PSBSCRT,U,8)  ; chemo type
"RTN","PSBVT",112,0)
 S PSBCPRS=$P(PSBSCRT,U,9)  ; ord file entry (CPRS order #)
"RTN","PSBVT",113,0)
 S PSBCLORD=$P(PSBSCRT,U,11)     ; clinic order Name (is a CO)     *70
"RTN","PSBVT",114,0)
 ;  send clinic file #44 ien ptr                                   *70
"RTN","PSBVT",115,0)
 S PSBCLIEN=$S(PSBCLORD]"":$P(PSBSCRT,U,12),1:"")                 ;*70
"RTN","PSBVT",116,0)
 Q:PSBSCRT=-1
"RTN","PSBVT",117,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",1))
"RTN","PSBVT",118,0)
 S PSBMD=$P(PSBSCRT,U,1)  ; prov IEN -> ^VA(200)
"RTN","PSBVT",119,0)
 S PSBMDX=$P(PSBSCRT,U,2)  ; prov name
"RTN","PSBVT",120,0)
 S PSBMR=$P(PSBSCRT,U,3)  ; med rt IEN -> ^PS(51.2)
"RTN","PSBVT",121,0)
 I $G(PSBMR)'="" S PSBMR=$P(PSBSCRT,U,13)  ;med rt
"RTN","PSBVT",122,0)
 S PSBMRAB=$P(PSBSCRT,U,4)  ;med rt abbr
"RTN","PSBVT",123,0)
 S PSBMRIEN=+$P($G(^TMP("PSB",$J,"PSBORDA",1,0)),U,4) ;med rt ien added in PSB*3*74   ;[*70-1489]
"RTN","PSBVT",124,0)
 S PSBNJECT=+$G(^TMP("PSB",$J,"PSBORDA",1,0))  ;Inj site
"RTN","PSBVT",125,0)
 S PSBIVPSH=+$P($G(^TMP("PSB",$J,"PSBORDA",1,0)),U,2)  ;IV PUSH
"RTN","PSBVT",126,0)
 S PSBSM=$P(PSBSCRT,U,5)  ; self med
"RTN","PSBVT",127,0)
 S PSBSMX=$P(PSBSCRT,U,6)  ; expnd to YES/NO
"RTN","PSBVT",128,0)
 S PSBHSM=$P(PSBSCRT,U,7)  ; hospital supplied self med
"RTN","PSBVT",129,0)
 S PSBHSMX=$P(PSBSCRT,U,8)  ; expnd to YES/NO
"RTN","PSBVT",130,0)
 S PSBNGF=$P(PSBSCRT,U,9)  ; not to be given flag
"RTN","PSBVT",131,0)
 S PSBOSTS=$P(PSBSCRT,U,10)  ; ord status
"RTN","PSBVT",132,0)
 S PSBOSTSX=$P(PSBSCRT,U,11)  ; ord status expans
"RTN","PSBVT",133,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",2))
"RTN","PSBVT",134,0)
 S PSBOIT=$P(PSBSCRT,U,1)  ; orderable item IEN -> ^ORD(101.43) ORDERABLE ITEM
"RTN","PSBVT",135,0)
 S PSBOITX=$P(PSBSCRT,U,2)  ; orderable item (expaned)_" "_ dosage form
"RTN","PSBVT",136,0)
 I PSBOITX="" S PSBOITX="ZZZZ NO ORDERABLE ITEM"
"RTN","PSBVT",137,0)
 S PSBDOSE=$P(PSBSCRT,U,3)  ; dosage ordered
"RTN","PSBVT",138,0)
 S PSBIFR=$P(PSBSCRT,U,4)  ; infusion rate
"RTN","PSBVT",139,0)
 S PSBSCH=$P(PSBSCRT,U,5)  ; sched
"RTN","PSBVT",140,0)
 S PSBDOSEF=$P(PSBSCRT,U,6)  ; dosage form
"RTN","PSBVT",141,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",3))
"RTN","PSBVT",142,0)
 S PSBOTXT=$P(PSBSCRT,U,1)  ; UD special inst or IV other print info
"RTN","PSBVT",143,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",4))
"RTN","PSBVT",144,0)
 S PSBSCHT=$P(PSBSCRT,U,1)  ; sched type conversion
"RTN","PSBVT",145,0)
 S PSBSCHTX=$P(PSBSCRT,U,2)  ; sched type expansion
"RTN","PSBVT",146,0)
 S PSBLDT=$P(PSBSCRT,U,3)  ; log-in date FM
"RTN","PSBVT",147,0)
 S PSBLDTX=$P(PSBSCRT,U,4)  ; exp MM/DD/YYYY HH:MM
"RTN","PSBVT",148,0)
 S PSBOST=$P(PSBSCRT,U,5)  ; start date FM
"RTN","PSBVT",149,0)
 S PSBOSTX=$P(PSBSCRT,U,6)  ; exp MM/DD/YYYY HH:MM
"RTN","PSBVT",150,0)
 S PSBOSP=$P(PSBSCRT,U,7)  ; stop date FM
"RTN","PSBVT",151,0)
 S PSBOSPX=$P(PSBSCRT,U,8) ; exp MM/DD/YYYY HH:MM
"RTN","PSBVT",152,0)
 S PSBADST=$P(PSBSCRT,U,9)  ; admin times string in NNNN- format
"RTN","PSBVT",153,0)
 S PSBOSCHT=$P(PSBSCRT,U,10)  ; original schedule type
"RTN","PSBVT",154,0)
 S PSBFREQ=$P(PSBSCRT,U,11)  ; frequency
"RTN","PSBVT",155,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",5))
"RTN","PSBVT",156,0)
 S PSBVN=$P(PSBSCRT,U,1)  ; verify nurse IEN -> ^VA(200)
"RTN","PSBVT",157,0)
 S PSBVNX=$P(PSBSCRT,U,2)  ; nurse name
"RTN","PSBVT",158,0)
 S PSBVNI=$P(PSBSCRT,U,3) ; nurse initials
"RTN","PSBVT",159,0)
 S PSBVPH=$P(PSBSCRT,U,4)  ; verify pharm IEN -> ^VA(200)
"RTN","PSBVT",160,0)
 S PSBVPHX=$P(PSBSCRT,U,5)  ; pharm name
"RTN","PSBVT",161,0)
 S PSBVPHI=$P(PSBSCRT,U,6)  ; pharm initials
"RTN","PSBVT",162,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",6))
"RTN","PSBVT",163,0)
 S PSBRMRK=$G(PSBSCRT)
"RTN","PSBVT",164,0)
 ;If DayOFWeek set frequen to NULL
"RTN","PSBVT",165,0)
 I $$PSBDCHK1^PSBVT1(PSBSCH) S PSBFREQ=""
"RTN","PSBVT",166,0)
 ; get dispensed drug
"RTN","PSBVT",167,0)
 I $G(^TMP("PSB",$J,"PSBORDA",700,0)) F PSBX=1:1:^TMP("PSB",$J,"PSBORDA",700,0) M PSBDDA(PSBX)=^TMP("PSB",$J,"PSBORDA",700,PSBX,0) S PSBDDA(PSBX)="DD^"_PSBDDA(PSBX) ; # of DDrug
"RTN","PSBVT",168,0)
 ;     "DD"^dispensed drug IEN -> ^PSDRUG() DRUG^dispensed drug name^units per dose^inactive date
"RTN","PSBVT",169,0)
 ; build unique id list
"RTN","PSBVT",170,0)
 ; add addits
"RTN","PSBVT",171,0)
 I $D(^TMP("PSB",$J,"PSBORDA",800)) S PSBX2="" F  S PSBX2=$O(^TMP("PSB",$J,"PSBORDA",800,PSBX2)) Q:PSBX2=""!(PSBX2="ERROR")  D
"RTN","PSBVT",172,0)
 .S PSBUIDA(PSBX2)="ID^"_PSBX2 F J=1:1:^TMP("PSB",$J,"PSBORDA",800,PSBX2,0) S PSBUIDA(PSBX2)=PSBUIDA(PSBX2)_"^"_"ADD;"_$P(^TMP("PSB",$J,"PSBORDA",800,PSBX2,J),U,1)
"RTN","PSBVT",173,0)
 ; add soluts
"RTN","PSBVT",174,0)
 I $D(^TMP("PSB",$J,"PSBORDA",900)) S PSBX2="" F  S PSBX2=$O(^TMP("PSB",$J,"PSBORDA",900,PSBX2)) Q:PSBX2=""!(PSBX2="ERROR")  D
"RTN","PSBVT",175,0)
 .I '$D(PSBUIDA(PSBX2)) S PSBUIDA(PSBX2)="ID^"_PSBX2
"RTN","PSBVT",176,0)
 .F J=1:1:^TMP("PSB",$J,"PSBORDA",900,PSBX2,0) S PSBUIDA(PSBX2)=PSBUIDA(PSBX2)_"^"_"SOL;"_$P(^TMP("PSB",$J,"PSBORDA",900,PSBX2,J),U,1)
"RTN","PSBVT",177,0)
 ;     "ID"   ^   (piece 2,3),... = type;IEN of each add/sol for this ID ex. "SOL;4"
"RTN","PSBVT",178,0)
 ; get addits
"RTN","PSBVT",179,0)
 I $G(^TMP("PSB",$J,"PSBORDA",850,0)) F PSBX=1:1:^TMP("PSB",$J,"PSBORDA",850,0) D
"RTN","PSBVT",180,0)
 .M PSBADA(PSBX)=^TMP("PSB",$J,"PSBORDA",850,PSBX,0)  ; num of addits
"RTN","PSBVT",181,0)
 .S PSBADA(PSBX)="ADD^"_PSBADA(PSBX)
"RTN","PSBVT",182,0)
 .S PSBBAGS=$P(PSBADA(PSBX),U,5) I PSBBAGS'="" S PSBBAG=" IN BAG "_$P(PSBBAGS,",",1) D
"RTN","PSBVT",183,0)
 ..F I=2:1 S X=$P(PSBBAGS,",",I) Q:X=""  S PSBBAG=PSBBAG_" AND "_X
"RTN","PSBVT",184,0)
 .S:PSBBAGS'="" $P(PSBADA(PSBX),U,5)=PSBBAG
"RTN","PSBVT",185,0)
 .D ZADD(1)          ;*only executes for TEST accounts
"RTN","PSBVT",186,0)
 ; "ADD"^add IEN -> ^PS(52.6)^additive name^strength ^bottle^high risk
"RTN","PSBVT",187,0)
 ;
"RTN","PSBVT",188,0)
 ; get soluts
"RTN","PSBVT",189,0)
 I $G(^TMP("PSB",$J,"PSBORDA",950,0)) D
"RTN","PSBVT",190,0)
 .F PSBX=1:1:^TMP("PSB",$J,"PSBORDA",950,0) D
"RTN","PSBVT",191,0)
 ..M PSBSOLA(PSBX)=^TMP("PSB",$J,"PSBORDA",950,PSBX,0)
"RTN","PSBVT",192,0)
 ..S PSBSOLA(PSBX)="SOL^"_PSBSOLA(PSBX)  ; # of SOLs
"RTN","PSBVT",193,0)
 ..D ZSOL(1)         ;*only executes for TEST accounts 
"RTN","PSBVT",194,0)
 ; "SOL"^solution IEN -> ^PS(52.7) IV SOLUTIONS^solution name^volume
"RTN","PSBVT",195,0)
 ;
"RTN","PSBVT",196,0)
 ; get label
"RTN","PSBVT",197,0)
 I $D(^TMP("PSB",$J,"PSBORDA",1000)) M PSBLBLA=^TMP("PSB",$J,"PSBORDA",1000)
"RTN","PSBVT",198,0)
 K ^TMP("PSB",$J,"PSBORDA")
"RTN","PSBVT",199,0)
 Q
"RTN","PSBVT",200,0)
 ;
"RTN","PSBVT",201,0)
LACTION ; get last action info
"RTN","PSBVT",202,0)
 S (PSBLADT,PSBLAIEN,PSBLASTS)=""
"RTN","PSBVT",203,0)
 I '$D(^PSB(53.79,"AORDX",PSBDFN,PSBONX)) Q
"RTN","PSBVT",204,0)
 S PSBLADT=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,""),-1)
"RTN","PSBVT",205,0)
 S PSBLAIEN=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBLADT,""))
"RTN","PSBVT",206,0)
 S PSBLASTS=$P(^PSB(53.79,PSBLAIEN,0),U,9)
"RTN","PSBVT",207,0)
 Q
"RTN","PSBVT",208,0)
 ;
"RTN","PSBVT",209,0)
CLEAN ;
"RTN","PSBVT",210,0)
 K PSBONX,PSBPONX,PSBFON,PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBMD,PSBMDX,PSBMR,PSBMRAB,PSBSM,PSBSMX,PSBHSM,PSBHSMX
"RTN","PSBVT",211,0)
 K PSBDFN,PSBNGF,PSBOSTS,PSBOSTSX,PSBOIT,PSBOITX,PSBDOSE,PSBIFR,PSBSCH,PSBDOSEF,PSBOTXT,PSBSCHT,PSBSCHTX
"RTN","PSBVT",212,0)
 K PSBLDT,PSBLDTX,PSBOST,PSBOSTX,PSBOSP,PSBOSPX,PSBADST,PSBOSCHT,PSBFREQ,PSBVN,PSBVNX,PSBVNI
"RTN","PSBVT",213,0)
 K PSBVPH,PSBVPHX,PSBVPHI,PSBDDA,PSBADA,PSBSOLA,PSBUIDA,PSBCPRS,PSBON,PSBRMRK,PSBNJECT,PSBIVPSH
"RTN","PSBVT",214,0)
 K PSBLADT,PSBLAIEN,PSBLASTS,PSBBAG,PSBBAGS,PSBLBLA,PSBFOR,PSBSCRT
"RTN","PSBVT",215,0)
 K PSBCLIEN,PSBCLORD   ;*70
"RTN","PSBVT",216,0)
 K PSBMRIEN   ;*68
"RTN","PSBVT",217,0)
 Q
"RTN","PSBVT",218,0)
 ;
"RTN","PSBVT",219,0)
ZADD(XX) ;appends pointer to Drug file #50 for additives - Results(9)
"RTN","PSBVT",220,0)
 ;*test mode only, drug ien stuffed in
"RTN","PSBVT",221,0)
 Q:$$PROD^XUPROD    ;quit if prodution account
"RTN","PSBVT",222,0)
 S:XX=1 $P(PSBADA(PSBX),U,9)=$P($G(^PS(52.6,$P(PSBADA(PSBX),U,2),0)),U,2)
"RTN","PSBVT",223,0)
 S:XX=2 $P(PSBADA(PSBX2),U,9)=$P($G(^PS(52.6,$P(PSBADA(PSBX2),U,2),0)),U,2)
"RTN","PSBVT",224,0)
 Q
"RTN","PSBVT",225,0)
 ;
"RTN","PSBVT",226,0)
ZSOL(XX) ;appends pointer to Drug file #50 for solutions - Results(9)
"RTN","PSBVT",227,0)
 ;*test mode only, drug ien stuffed in
"RTN","PSBVT",228,0)
 Q:$$PROD^XUPROD    ;quit if prodution account
"RTN","PSBVT",229,0)
 S:XX=1 $P(PSBSOLA(PSBX),U,9)=$P($G(^PS(52.7,$P(PSBSOLA(PSBX),U,2),0)),U,2)
"RTN","PSBVT",230,0)
 S:XX=2 $P(PSBSOLA(PSBX2),U,9)=$P($G(^PS(52.7,$P(PSBSOLA(PSBX2),U,2),0)),U,2)
"RTN","PSBVT",231,0)
 Q
"UP",53.79,53.795,-1)
53.79^.5
"UP",53.79,53.795,0)
53.795
"UP",53.79,53.796,-1)
53.79^.6
"UP",53.79,53.796,0)
53.796
"UP",53.79,53.797,-1)
53.79^.7
"UP",53.79,53.797,0)
53.797
"VER")
8.0^22.0
"^DD",53.68,53.68,1,0)
CLINIC^P44'^SC(^1;1^Q
"^DD",53.68,53.68,1,3)
Enter the Clinic assoiciated with the missing dose.
"^DD",53.68,53.68,1,21,0)
^^2^2^3121114^
"^DD",53.68,53.68,1,21,1,0)
Pointer to the HOSPITAL LOCATION file (#44) for the selected clinic for 
"^DD",53.68,53.68,1,21,2,0)
the report.
"^DD",53.68,53.68,1,"DT")
3121115
"^DD",53.69,53.69,.11,0)
SORT BY^S^P:Patient;W:Ward;C:Clinic;^.1;1^Q
"^DD",53.69,53.69,.11,.1)
Sort by Pt or Ward
"^DD",53.69,53.69,.11,21,0)
^.001^1^1^3011119^^^
"^DD",53.69,53.69,.11,21,1,0)
Determines the type of report (W:An entire ward P:An individual patient)
"^DD",53.69,53.69,.11,"DT")
3120907
"^DD",53.69,53.69,4,0)
ORDERS TYPE MODE C/I^S^C:Clinic orders;I:Inpatient orders;^4;2^Q
"^DD",53.69,53.69,4,3)
Enter "C" to include only Clinic Orders or "I" to include only Inpatient orders on the report.
"^DD",53.69,53.69,4,21,0)
^^3^3^3120824^
"^DD",53.69,53.69,4,21,1,0)
This field is an indicator for running the report in either Clinic order 
"^DD",53.69,53.69,4,21,2,0)
mode or in Inpatient medication order mode.  If this field is not set, 
"^DD",53.69,53.69,4,21,3,0)
the report is run in Inpatient order mode.
"^DD",53.69,53.69,4,"DT")
3120824
"^DD",53.69,53.69,5,0)
CLINIC TO PRINT^*P44'^SC(^4;3^S DIC("S")="I $P(^(0),U,3)=""C""" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",53.69,53.69,5,3)
Enter a Clinic location.
"^DD",53.69,53.69,5,12)
Allows only Clinics.
"^DD",53.69,53.69,5,12.1)
S DIC("S")="I $P(^(0),U,3)=""C"""
"^DD",53.69,53.69,5,21,0)
^^2^2^3130124^
"^DD",53.69,53.69,5,21,1,0)
This is the clinic whose name is printed on the Missing Dose Report from 
"^DD",53.69,53.69,5,21,2,0)
the PSB PHARMACY menu option.         
"^DD",53.69,53.69,5,23,0)
^^2^2^3130124^
"^DD",53.69,53.69,5,23,1,0)
This field uses an Input transform to filter only entries that have TYPE
"^DD",53.69,53.69,5,23,2,0)
field (#2) equal to "C", in the HOSPITAL LOCATION file (#44). 
"^DD",53.69,53.69,5,"DT")
3130124
"^DD",53.79,53.79,.01,0)
PATIENT NAME^RP2'^DPT(^0;1^Q
"^DD",53.79,53.79,.01,1,0)
^.1^^-1
"^DD",53.79,53.79,.01,1,1,0)
53.79^B
"^DD",53.79,53.79,.01,1,1,1)
S ^PSB(53.79,"B",$E(X,1,30),DA)=""
"^DD",53.79,53.79,.01,1,1,2)
K ^PSB(53.79,"B",$E(X,1,30),DA)
"^DD",53.79,53.79,.01,3)

"^DD",53.79,53.79,.01,21,0)
^^2^2^2990731^^^
"^DD",53.79,53.79,.01,21,1,0)
This field contains a pointer to the PATIENT File (#2) and is the patient
"^DD",53.79,53.79,.01,21,2,0)
that received the medication.
"^DD",53.79,53.79,.01,"DT")
3120910
"^DD",53.79,53.79,.02,0)
PATIENT LOCATION^F^^0;2^K:$L(X)>50!($L(X)<1) X
"^DD",53.79,53.79,.02,3)
Answer must be 1-50 characters in length.
"^DD",53.79,53.79,.02,21,0)
^^3^3^3121114^
"^DD",53.79,53.79,.02,21,1,0)
Free text room-bed and ward location of the patient for Inpatient 
"^DD",53.79,53.79,.02,21,2,0)
Medication orders or Clinic Name for Clinic orders at the time of the med 
"^DD",53.79,53.79,.02,21,3,0)
pass.
"^DD",53.79,53.79,.02,"DT")
3121114
"^DD",53.79,53.79,.06,0)
ACTION DATE/TIME^RD^^0;6^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",53.79,53.79,.06,1,0)
^.1^^-1
"^DD",53.79,53.79,.06,1,1,0)
53.79^AADT^MUMPS
"^DD",53.79,53.79,.06,1,1,1)
S ^PSB(53.79,"AADT",$P(^PSB(53.79,DA,0),U),X,DA)=""
"^DD",53.79,53.79,.06,1,1,2)
Q
"^DD",53.79,53.79,.06,1,1,"%D",0)
^.101^3^3^3020517^^^^
"^DD",53.79,53.79,.06,1,1,"%D",1,0)
Creates a cross reference by patient for administration times
"^DD",53.79,53.79,.06,1,1,"%D",2,0)
 
"^DD",53.79,53.79,.06,1,1,"%D",3,0)
  ^PSB(53.79,"AADT",dfn,administration d/t,DA)=""
"^DD",53.79,53.79,.06,1,1,"DT")
3020429
"^DD",53.79,53.79,.06,1,2,0)
53.79^AOIP1^MUMPS^^^^^^G
"^DD",53.79,53.79,.06,1,2,1)
I $P(^PSB(53.79,DA,0),U,8) S ^PSB(53.79,"AOIP",$P(^PSB(53.79,DA,0),U),$P(^PSB(53.79,DA,0),U,8),X,DA)=""
"^DD",53.79,53.79,.06,1,2,2)
I $P(^PSB(53.79,DA,0),U,8) K ^PSB(53.79,"AOIP",$P(^PSB(53.79,DA,0),U),$P(^PSB(53.79,DA,0),U,8),X,DA)
"^DD",53.79,53.79,.06,1,2,"%D",0)
^.101^6^6^3020410^^
"^DD",53.79,53.79,.06,1,2,"%D",1,0)
Creates a cross reference by patient for orderable items and
"^DD",53.79,53.79,.06,1,2,"%D",2,0)
administration date/time
"^DD",53.79,53.79,.06,1,2,"%D",3,0)
 
"^DD",53.79,53.79,.06,1,2,"%D",4,0)
  ^PSB(53.79,"AOIP",dfn,orderable item,administration d/t,DA)=""
"^DD",53.79,53.79,.06,1,2,"%D",5,0)
 
"^DD",53.79,53.79,.06,1,2,"%D",6,0)
Same as field ADMINISTRATION MEDICATION (#.08)
"^DD",53.79,53.79,.06,1,2,"DT")
2990427
"^DD",53.79,53.79,.06,1,4,0)
53.79^AU06^MUMPS
"^DD",53.79,53.79,.06,1,4,1)
D AUDIT^PSBUTL(DA,53.79,.06,X,"S")
"^DD",53.79,53.79,.06,1,4,2)
D AUDIT^PSBUTL(DA,53.79,.06,X,"K")
"^DD",53.79,53.79,.06,1,4,"%D",0)
^.101^1^1^3020412^^^^
"^DD",53.79,53.79,.06,1,4,"%D",1,0)
Creates an entry in this items audit log whenever changed or deleted.
"^DD",53.79,53.79,.06,1,4,"DT")
2990409
"^DD",53.79,53.79,.06,1,8,0)
^^TRIGGER^53.79^.14
"^DD",53.79,53.79,.06,1,8,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X I $P($G(^PSB(53.79,DA,.1)),U,2)="C"&($P($G(^(.1)),U,3)]"") I X S X=DIV S Y(1)=$S($D(^PSB(53.79,D0,.1)):^(.1),1:"") S X=$P(Y(1),U,4),X=X S DIU=X K Y X ^DD(53.79,.06,1,8,1.1) X ^DD(53.79,.06,1,8,1.4)
"^DD",53.79,53.79,.06,1,8,1.1)
S X=DIV X ^DD(53.79,.06,1,8,49.2) S X1=Y(1) S Y=$E(X1_"000",9,10)-$E(X_"000",9,10)*60+$E(X1_"00000",11,12)-$E(X_"00000",11,12),X2=X,X=$P(X,".",1)'=$P(X1,".",1) D ^%DTC:X S X=X*1440+Y
"^DD",53.79,53.79,.06,1,8,1.4)
S DIH=$S($D(^PSB(53.79,DIV(0),.1)):^(.1),1:""),DIV=X S $P(^(.1),U,4)=DIV,DIH=53.79,DIG=.14 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",53.79,53.79,.06,1,8,2)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X I $P($G(^PSB(53.79,DA,.1)),U,2)="C"&($P($G(^(.1)),U,3)]"") I X S X=DIV S Y(1)=$S($D(^PSB(53.79,D0,.1)):^(.1),1:"") S X=$P(Y(1),U,4),X=X S DIU=X K Y S X="" X ^DD(53.79,.06,1,8,2.4)
"^DD",53.79,53.79,.06,1,8,2.4)
S DIH=$S($D(^PSB(53.79,DIV(0),.1)):^(.1),1:""),DIV=X S $P(^(.1),U,4)=DIV,DIH=53.79,DIG=.14 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",53.79,53.79,.06,1,8,49.2)
S Y(2)=$S($D(^PSB(53.79,D0,.1)):^(.1),1:"") S X=DIV,Y(1)=X S X=$P(Y(2),U,3)
"^DD",53.79,53.79,.06,1,8,"CREATE CONDITION")
I $P($G(^PSB(53.79,DA,.1)),U,2)="C"&($P($G(^(.1)),U,3)]"")
"^DD",53.79,53.79,.06,1,8,"CREATE VALUE")
MINUTES(#.06,#.13)
"^DD",53.79,53.79,.06,1,8,"DELETE CONDITION")
I $P($G(^PSB(53.79,DA,.1)),U,2)="C"&($P($G(^(.1)),U,3)]"")
"^DD",53.79,53.79,.06,1,8,"DELETE VALUE")
@
"^DD",53.79,53.79,.06,1,8,"DT")
2990314
"^DD",53.79,53.79,.06,1,8,"FIELD")
#.14
"^DD",53.79,53.79,.06,21,0)
^.001^1^1^3020711^^^^
"^DD",53.79,53.79,.06,21,1,0)
Fileman Date/Time containing the actual time the med was administered.
"^DD",53.79,53.79,.06,"DT")
3120910
"^DD",53.79,53.79,.28,0)
WITNESS DATE/TIME^D^^0;13^S %DT="ESTXR" D ^%DT S X=Y K:X<1 X
"^DD",53.79,53.79,.28,1,0)
^.1
"^DD",53.79,53.79,.28,1,1,0)
53.79^AU28^MUMPS
"^DD",53.79,53.79,.28,1,1,1)
D AUDIT^PSBUTL(DA,53.79,.28,X,"S")
"^DD",53.79,53.79,.28,1,1,2)
D AUDIT^PSBUTL(DA,53.79,.28,X,"K")
"^DD",53.79,53.79,.28,1,1,"%D",0)
^^1^1^3120529^
"^DD",53.79,53.79,.28,1,1,"%D",1,0)
Creates an entry in this items audit log whenever changed or deleted.
"^DD",53.79,53.79,.28,1,1,"DT")
3120529
"^DD",53.79,53.79,.28,3)
(No range limit on date)
"^DD",53.79,53.79,.28,21,0)
^^2^2^3120912^
"^DD",53.79,53.79,.28,21,1,0)
Contains the DATE/TIME that this administration of a High Risk/High Alert 
"^DD",53.79,53.79,.28,21,2,0)
medication was witnessed.
"^DD",53.79,53.79,.28,"AUDIT")

"^DD",53.79,53.79,.28,"DT")
3120912
"^DD",53.79,53.79,.29,0)
ADMIN WITNESSED BY^P200'^VA(200,^0;14^Q
"^DD",53.79,53.79,.29,1,0)
^.1
"^DD",53.79,53.79,.29,1,1,0)
53.79^AU29^MUMPS
"^DD",53.79,53.79,.29,1,1,1)
D AUDIT^PSBUTL(DA,53.79,.29,X,"S")
"^DD",53.79,53.79,.29,1,1,2)
D AUDIT^PSBUTL(DA,53.79,.29,X,"K")
"^DD",53.79,53.79,.29,1,1,"%D",0)
^.101^1^1^3120709^^^
"^DD",53.79,53.79,.29,1,1,"%D",1,0)
Creates an entry in this items audit log whenever changed or deleted.
"^DD",53.79,53.79,.29,1,1,"DT")
3120709
"^DD",53.79,53.79,.29,3)
Select the witness.
"^DD",53.79,53.79,.29,21,0)
^^2^2^3120919^
"^DD",53.79,53.79,.29,21,1,0)
Contains the user that was required to Witness the passing of meds due to 
"^DD",53.79,53.79,.29,21,2,0)
Drug High Risk/Alert.
"^DD",53.79,53.79,.29,"AUDIT")

"^DD",53.79,53.79,.29,"DT")
3120919
"^DD",53.79,53.79,.31,0)
WITNESS COMMENT^F^^1;1^K:$L(X)>150!($L(X)<1) X
"^DD",53.79,53.79,.31,3)
Answer must be 1-150 characters in length.
"^DD",53.79,53.79,.31,21,0)
^^2^2^3120912^
"^DD",53.79,53.79,.31,21,1,0)
Comment the witness may want to enter while witnessing an administration
"^DD",53.79,53.79,.31,21,2,0)
for a High Risk/High Alert medication.
"^DD",53.79,53.79,.31,"DT")
3120912
"^DD",53.79,53.79,.32,0)
WITNESS HR ORDER CODE^S^0:NOT HIGH RISK/ALERT;1:HIGH RISK/ALERT-NO WITNESS REQUIRED IN BCMA;2:RECOMMEND WITNESS IN BCMA-HIGH RISK/ALERT;3:WITNESS REQUIRED IN BCMA-HIGH RISK/ALERT;^1;2^Q
"^DD",53.79,53.79,.32,1,0)
^.1
"^DD",53.79,53.79,.32,1,1,0)
53.79^AU32^MUMPS
"^DD",53.79,53.79,.32,1,1,1)
D AUDIT^PSBUTL(DA,53.79,.32,X,"S")
"^DD",53.79,53.79,.32,1,1,2)
D AUDIT^PSBUTL(DA,53.79,.32,X,"K")
"^DD",53.79,53.79,.32,1,1,"DT")
3121015
"^DD",53.79,53.79,.32,3)
Enter the Order's highest level of High Risk/Alert codes found in its components of Disp Drug, Additives, or Solutions.
"^DD",53.79,53.79,.32,21,0)
^^3^3^3121017^
"^DD",53.79,53.79,.32,21,1,0)
This field contains the highest level of all the High Risk/High Alert
"^DD",53.79,53.79,.32,21,2,0)
drug indicators that were found in the order when this medication was 
"^DD",53.79,53.79,.32,21,3,0)
passed.
"^DD",53.79,53.79,.32,"DT")
3121114
"^DD",53.79,53.79,.33,0)
WITNESSED?^S^0:NO;1:YES;^1;3^Q
"^DD",53.79,53.79,.33,1,0)
^.1
"^DD",53.79,53.79,.33,1,1,0)
53.79^AU33^MUMPS
"^DD",53.79,53.79,.33,1,1,1)
D AUDIT^PSBUTL(DA,53.79,.33,X,"S")
"^DD",53.79,53.79,.33,1,1,2)
D AUDIT^PSBUTL(DA,53.79,.33,X,"K")
"^DD",53.79,53.79,.33,1,1,"DT")
3121015
"^DD",53.79,53.79,.33,3)
Enter Yes if this medication administration was witnessed.
"^DD",53.79,53.79,.33,21,0)
^^2^2^3121016^
"^DD",53.79,53.79,.33,21,1,0)
This field will track whether the Witness was bypassed for a High 
"^DD",53.79,53.79,.33,21,2,0)
Risk/High Alert drug during medication passing.
"^DD",53.79,53.79,.33,"DT")
3121114
"^DD",53.79,53.795,.05,0)
HIGH RISK/HIGH ALERT^S^0:NOT HIGH RISK/ALERT;1:HIGH RISK/ALERT-NO WITNESS REQUIRED IN BCMA;2:RECOMMEND WITNESS IN BCMA-HIGH RISK/ALERT;3:WITNESS REQUIRED IN BCMA-HIGH RISK/ALERT;^0;5^Q
"^DD",53.79,53.795,.05,3)
Enter a valid High Risk/Alert code for this Dispense Drug.
"^DD",53.79,53.795,.05,21,0)
^^2^2^3121015^
"^DD",53.79,53.795,.05,21,1,0)
High Risk/High Alert indicator for the Orderable Item this disp drug
"^DD",53.79,53.795,.05,21,2,0)
pointed to at the time of administration.
"^DD",53.79,53.795,.05,"DT")
3121114
"^DD",53.79,53.796,.05,0)
HIGH RISK/HIGH ALERT^S^0:NOT HIGH RISK/ALERT;1:HIGH RISK/ALERT-NO WITNESS REQUIRED IN BCMA;2:RECOMMEND WITNESS IN BCMA-HIGH RISK/ALERT;3:WITNESS REQUIRED IN BCMA-HIGH RISK/ALERT;^0;5^Q
"^DD",53.79,53.796,.05,3)
Enter a valid High Risk/Alert code for this Additive.
"^DD",53.79,53.796,.05,21,0)
^^2^2^3121015^
"^DD",53.79,53.796,.05,21,1,0)
High Risk/High Alert indicator for the Orderable Item this additive
"^DD",53.79,53.796,.05,21,2,0)
pointed to at the time of administration.
"^DD",53.79,53.796,.05,"DT")
3121114
"^DD",53.79,53.797,.05,0)
HIGH RISK/HIGH ALERT^S^0:NOT HIGH RISK/ALERT;1:HIGH RISK/ALERT-NO WITNESS REQUIRED IN BCMA;2:RECOMMEND WITNESS IN BCMA-HIGH RISK/ALERT;3:WITNESS REQUIRED IN BCMA-HIGH RISK/ALERT;^0;5^Q
"^DD",53.79,53.797,.05,3)
Enter a valid High Risk/Alert code for this Solution.
"^DD",53.79,53.797,.05,21,0)
^^2^2^3121015^
"^DD",53.79,53.797,.05,21,1,0)
High Risk/High Alert indicator for the Orderable Item this Solution
"^DD",53.79,53.797,.05,21,2,0)
pointed to at the time of administration.
"^DD",53.79,53.797,.05,"DT")
3121114
"BLD",8399,6)
^62
**END**
**END**
