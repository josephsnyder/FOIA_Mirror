KIDS Distribution saved on Oct 23, 2008@08:59:47
OR*3*212
**KIDS**:OR*3.0*212^

**INSTALL NAME**
OR*3.0*212
"BLD",17599,0)
OR*3.0*212^ORDER ENTRY/RESULTS REPORTING^0^3081023^y
"BLD",17599,1,0)
^^3^3^3080131^^^
"BLD",17599,1,1,0)
This patch implements the interface between CPRS and VBECS, installing
"BLD",17599,1,2,0)
a new order dialog and other supporting components.  CPRS and VBECS are
"BLD",17599,1,3,0)
both required to install this patch.
"BLD",17599,4,0)
^9.64PA^100.98^3
"BLD",17599,4,100.98,0)
100.98
"BLD",17599,4,100.98,222)
n^n^f^^y^^y^r^n
"BLD",17599,4,100.98,224)
I $P(^(0),U,3)?1"VB".E
"BLD",17599,4,101.41,0)
101.41
"BLD",17599,4,101.41,222)
n^n^f^^y^^y^r^n
"BLD",17599,4,101.41,224)
I $$DLGSEND^ORY212($P(^(0),U))
"BLD",17599,4,101.43,0)
101.43
"BLD",17599,4,101.43,2,0)
^9.641^101.43^1
"BLD",17599,4,101.43,2,101.43,0)
ORDERABLE ITEMS  (File-top level)
"BLD",17599,4,101.43,2,101.43,1,0)
^9.6411^6002^2
"BLD",17599,4,101.43,2,101.43,1,6001,0)
BLOOD COMPONENT
"BLD",17599,4,101.43,2,101.43,1,6002,0)
DIAGNOSTIC TEST
"BLD",17599,4,101.43,222)
y^n^p^^^^n^^n
"BLD",17599,4,"APDD",101.43,101.43)

"BLD",17599,4,"APDD",101.43,101.43,6001)

"BLD",17599,4,"APDD",101.43,101.43,6002)

"BLD",17599,4,"B",100.98,100.98)

"BLD",17599,4,"B",101.41,101.41)

"BLD",17599,4,"B",101.43,101.43)

"BLD",17599,6.3)
24
"BLD",17599,"ABPKG")
n
"BLD",17599,"INI")
PRE^ORY212
"BLD",17599,"INIT")
POST^ORY212
"BLD",17599,"KRN",0)
^9.67PA^8989.52^19
"BLD",17599,"KRN",.4,0)
.4
"BLD",17599,"KRN",.401,0)
.401
"BLD",17599,"KRN",.402,0)
.402
"BLD",17599,"KRN",.403,0)
.403
"BLD",17599,"KRN",.5,0)
.5
"BLD",17599,"KRN",.84,0)
.84
"BLD",17599,"KRN",3.6,0)
3.6
"BLD",17599,"KRN",3.8,0)
3.8
"BLD",17599,"KRN",9.2,0)
9.2
"BLD",17599,"KRN",9.8,0)
9.8
"BLD",17599,"KRN",9.8,"NM",0)
^9.68A^24^16
"BLD",17599,"KRN",9.8,"NM",1,0)
ORCDVBEC^^0^B66434607
"BLD",17599,"KRN",9.8,"NM",3,0)
ORCSEND2^^0^B33504777
"BLD",17599,"KRN",9.8,"NM",4,0)
ORMBLDVB^^0^B42436603
"BLD",17599,"KRN",9.8,"NM",5,0)
ORMVBEC^^0^B24117916
"BLD",17599,"KRN",9.8,"NM",11,0)
ORY212^^0^B15841555
"BLD",17599,"KRN",9.8,"NM",12,0)
ORMHLREC^^0^B15260322
"BLD",17599,"KRN",9.8,"NM",13,0)
ORWLR2^^0^B29775782
"BLD",17599,"KRN",9.8,"NM",15,0)
ORY212P^^0^B12256283
"BLD",17599,"KRN",9.8,"NM",17,0)
ORCDVBC1^^0^B5469622
"BLD",17599,"KRN",9.8,"NM",18,0)
ORY212E^^0^B401737
"BLD",17599,"KRN",9.8,"NM",19,0)
ORWLR3^^0^B48454721
"BLD",17599,"KRN",9.8,"NM",20,0)
ORWLR1^^0^B29165126
"BLD",17599,"KRN",9.8,"NM",21,0)
ORWDXVB^^0^B44139791
"BLD",17599,"KRN",9.8,"NM",22,0)
ORWRP1^^0^B70925932
"BLD",17599,"KRN",9.8,"NM",23,0)
ORWRP2^^0^B14652707
"BLD",17599,"KRN",9.8,"NM",24,0)
ORWDXVB2^^0^B16199930
"BLD",17599,"KRN",9.8,"NM","B","ORCDVBC1",17)

"BLD",17599,"KRN",9.8,"NM","B","ORCDVBEC",1)

"BLD",17599,"KRN",9.8,"NM","B","ORCSEND2",3)

"BLD",17599,"KRN",9.8,"NM","B","ORMBLDVB",4)

"BLD",17599,"KRN",9.8,"NM","B","ORMHLREC",12)

"BLD",17599,"KRN",9.8,"NM","B","ORMVBEC",5)

"BLD",17599,"KRN",9.8,"NM","B","ORWDXVB",21)

"BLD",17599,"KRN",9.8,"NM","B","ORWDXVB2",24)

"BLD",17599,"KRN",9.8,"NM","B","ORWLR1",20)

"BLD",17599,"KRN",9.8,"NM","B","ORWLR2",13)

"BLD",17599,"KRN",9.8,"NM","B","ORWLR3",19)

"BLD",17599,"KRN",9.8,"NM","B","ORWRP1",22)

"BLD",17599,"KRN",9.8,"NM","B","ORWRP2",23)

"BLD",17599,"KRN",9.8,"NM","B","ORY212",11)

"BLD",17599,"KRN",9.8,"NM","B","ORY212E",18)

"BLD",17599,"KRN",9.8,"NM","B","ORY212P",15)

"BLD",17599,"KRN",19,0)
19
"BLD",17599,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",17599,"KRN",19,"NM",1,0)
ORCM VBECS OI EDIT^^0
"BLD",17599,"KRN",19,"NM",2,0)
ORCM ORDERABLES MENU^^2
"BLD",17599,"KRN",19,"NM","B","ORCM ORDERABLES MENU",2)

"BLD",17599,"KRN",19,"NM","B","ORCM VBECS OI EDIT",1)

"BLD",17599,"KRN",19.1,0)
19.1
"BLD",17599,"KRN",101,0)
101
"BLD",17599,"KRN",101,"NM",0)
^9.68A^2^2
"BLD",17599,"KRN",101,"NM",1,0)
OR OMG CLIENT^^0
"BLD",17599,"KRN",101,"NM",2,0)
OR OMG SERVER^^0
"BLD",17599,"KRN",101,"NM","B","OR OMG CLIENT",1)

"BLD",17599,"KRN",101,"NM","B","OR OMG SERVER",2)

"BLD",17599,"KRN",409.61,0)
409.61
"BLD",17599,"KRN",771,0)
771
"BLD",17599,"KRN",771,"NM",0)
^9.68A^1^1
"BLD",17599,"KRN",771,"NM",1,0)
OERR^^0
"BLD",17599,"KRN",771,"NM","B","OERR",1)

"BLD",17599,"KRN",870,0)
870
"BLD",17599,"KRN",870,"NM",0)
^9.68A^1^1
"BLD",17599,"KRN",870,"NM",1,0)
OERR-VBECS^^0
"BLD",17599,"KRN",870,"NM","B","OERR-VBECS",1)

"BLD",17599,"KRN",8989.51,0)
8989.51
"BLD",17599,"KRN",8989.51,"NM",0)
^9.68A^5^5
"BLD",17599,"KRN",8989.51,"NM",1,0)
OR VBECS COMPONENT ORDER^^0
"BLD",17599,"KRN",8989.51,"NM",2,0)
OR VBECS MODIFIERS^^0
"BLD",17599,"KRN",8989.51,"NM",3,0)
OR VBECS REASON FOR REQUEST^^0
"BLD",17599,"KRN",8989.51,"NM",4,0)
OR VBECS LEGACY REPORT^^0
"BLD",17599,"KRN",8989.51,"NM",5,0)
OR VBECS ERROR MESSAGE^^0
"BLD",17599,"KRN",8989.51,"NM","B","OR VBECS COMPONENT ORDER",1)

"BLD",17599,"KRN",8989.51,"NM","B","OR VBECS ERROR MESSAGE",5)

"BLD",17599,"KRN",8989.51,"NM","B","OR VBECS LEGACY REPORT",4)

"BLD",17599,"KRN",8989.51,"NM","B","OR VBECS MODIFIERS",2)

"BLD",17599,"KRN",8989.51,"NM","B","OR VBECS REASON FOR REQUEST",3)

"BLD",17599,"KRN",8989.52,0)
8989.52
"BLD",17599,"KRN",8994,0)
8994
"BLD",17599,"KRN","B",.4,.4)

"BLD",17599,"KRN","B",.401,.401)

"BLD",17599,"KRN","B",.402,.402)

"BLD",17599,"KRN","B",.403,.403)

"BLD",17599,"KRN","B",.5,.5)

"BLD",17599,"KRN","B",.84,.84)

"BLD",17599,"KRN","B",3.6,3.6)

"BLD",17599,"KRN","B",3.8,3.8)

"BLD",17599,"KRN","B",9.2,9.2)

"BLD",17599,"KRN","B",9.8,9.8)

"BLD",17599,"KRN","B",19,19)

"BLD",17599,"KRN","B",19.1,19.1)

"BLD",17599,"KRN","B",101,101)

"BLD",17599,"KRN","B",409.61,409.61)

"BLD",17599,"KRN","B",771,771)

"BLD",17599,"KRN","B",870,870)

"BLD",17599,"KRN","B",8989.51,8989.51)

"BLD",17599,"KRN","B",8989.52,8989.52)

"BLD",17599,"KRN","B",8994,8994)

"BLD",17599,"PRE")
ORY212E
"BLD",17599,"QDEF")
^^^^NO^^^^YES^^NO
"BLD",17599,"QUES",0)
^9.62^^
"BLD",17599,"REQB",0)
^9.611^3^2
"BLD",17599,"REQB",2,0)
VBECS 1.0^1
"BLD",17599,"REQB",3,0)
OR*3.0*243^1
"BLD",17599,"REQB","B","OR*3.0*243",3)

"BLD",17599,"REQB","B","VBECS 1.0",2)

"DATA",100.98,49,0)
BLOOD COMPONENTS^Blood Components^VBC
"DATA",100.98,65,0)
DIAGNOSTIC TESTS^Diagnostic Tests^VBT
"DATA",100.98,66,0)
BLOOD PRODUCTS^Blood Bank^VBEC^15664
"DATA",100.98,66,1,0)
^100.981P^2^2
"DATA",100.98,66,1,1,0)
49
"DATA",100.98,66,1,2,0)
65
"DATA",101.41,624,0)
OR GTX AMOUNT^Quantity: ^^P
"DATA",101.41,624,1)
F^1:5^QTY
"DATA",101.41,624,2,0)
^101.411^2^2^3021108^^
"DATA",101.41,624,2,1,0)
This prompts for quantity, created for use with VBECS; it is free text
"DATA",101.41,624,2,2,0)
to allow for either # units or #ml.
"DATA",101.41,624,99)
61031,45823
"DATA",101.41,625,0)
OR GTX RBC MODIFIERS^Additional Requirements: ^^P
"DATA",101.41,625,1)
F^1:50^MODIFIER
"DATA",101.41,625,2,0)
^101.411^1^1^3051103^^^^
"DATA",101.41,625,2,1,0)
This prompts for special instructions for Red Blood Cell (RBC) requests.
"DATA",101.41,625,99)
61031,45823
"DATA",101.41,626,0)
OR GTX REASON^Reason for Request: ^^P
"DATA",101.41,626,1)
F^1:75^REASON
"DATA",101.41,626,2,0)
^101.411^1^1^3021108^^
"DATA",101.41,626,2,1,0)
This prompts for a free text reason why this order is being placed.
"DATA",101.41,626,99)
61031,45823
"DATA",101.41,628,0)
OR GTX LAB ORDER^Associated Lab Order: ^^P
"DATA",101.41,628,1)
P^100^LAB
"DATA",101.41,628,2,0)
^^2^2^3051216^
"DATA",101.41,628,2,1,0)
This prompt holds the associated Lab order number, created for use with
"DATA",101.41,628,2,2,0)
VBECS.
"DATA",101.41,628,99)
61031,45823
"DATA",101.41,629,0)
OR GTX TEXT^Text: ^^P^^^22
"DATA",101.41,629,1)
F^1:240^MISC
"DATA",101.41,629,99)
61031,45823
"DATA",101.41,1647,0)
OR GTX DATE/TIME^Date/Time: ^^P^^^22
"DATA",101.41,1647,1)
R^NOW::ETX^DATETIME
"DATA",101.41,1647,99)
61031,45824
"DATA",101.41,15662,0)
OR GTX RESULTS^Associated Lab Results: ^^P
"DATA",101.41,15662,1)
F^1:240^RESULTS
"DATA",101.41,15662,2,0)
^^3^3^3030912^
"DATA",101.41,15662,2,1,0)
This prompt holds the results of Lab tests relevant to the current order,
"DATA",101.41,15662,2,2,0)
created for use with VBECS, in the form:
"DATA",101.41,15662,2,3,0)
 testID^result^flag^units^refrange^resultstatus(F or P)^colldate
"DATA",101.41,15662,99)
61031,45824
"DATA",101.41,15664,0)
VBEC BLOOD BANK^Blood Products^^D^66^2^397^1^0
"DATA",101.41,15664,2,0)
^101.411^2^2^3070830^^^^
"DATA",101.41,15664,2,1,0)
This dialog creates an order for blood components to be made available
"DATA",101.41,15664,2,2,0)
by the VBECS system, as well as any supporting diagnostic tests.
"DATA",101.41,15664,3)
D EN^ORCDVBEC
"DATA",101.41,15664,3.1)
D EN^ORCDVBEC
"DATA",101.41,15664,4)
D EX^ORCDVBEC
"DATA",101.41,15664,5)
^^^VBEC Blood Bank^125
"DATA",101.41,15664,9)
I $O(^OR(100,ORIFN,2,0)) S Y=$$LB^ORCDVBC1(ORIFN) K:'Y Y S:$G(Y) Y="LB #"_Y
"DATA",101.41,15664,10,0)
^101.412IA^17^14
"DATA",101.41,15664,10,1,0)
1^4^^Component or Test: ^^1^1^^^S.VBEC^^^Blood Components/Tests: 
"DATA",101.41,15664,10,1,1)
Enter a blood component or diagnostic test for the patient from the Blood Bank.
"DATA",101.41,15664,10,1,2)
1
"DATA",101.41,15664,10,1,4)
I $$ACTIVE^ORDD43(Y)
"DATA",101.41,15664,10,1,5)
D PSAOI^ORCDVBEC
"DATA",101.41,15664,10,1,6)
D XHELP^ORCDVBEC
"DATA",101.41,15664,10,1,10)
D EXOI^ORCDVBEC
"DATA",101.41,15664,10,1,"W")
cboAvailTest of cboAvailComp
"DATA",101.41,15664,10,2,0)
1.2^624^^^^1^^^C^^4
"DATA",101.41,15664,10,2,1)
Enter the number of units needed, from 1-99.
"DATA",101.41,15664,10,2,2)
^^^^unit(s)
"DATA",101.41,15664,10,2,3)
K:'$G(ORASK) ORDIALOG(PROMPT,INST) I $G(ORASK)
"DATA",101.41,15664,10,2,5)
D PSAMT^ORCDVBEC
"DATA",101.41,15664,10,2,"W")
tQuantity
"DATA",101.41,15664,10,3,0)
6^1647^^Date/Time Wanted: ^^1^^^CW
"DATA",101.41,15664,10,3,1)
Enter the date/time the unit(s) should be available.
"DATA",101.41,15664,10,3,6)
D FTDHELP^ORCD
"DATA",101.41,15664,10,3,10)
D DTW^ORCDVBEC
"DATA",101.41,15664,10,3,"W")
calWanted
"DATA",101.41,15664,10,4,0)
1.1^625^^^^^^^C^^4
"DATA",101.41,15664,10,4,1)
Select a modifier, if needed.
"DATA",101.41,15664,10,4,3)
K:'$G(ORASK) ORDIALOG(PROMPT,INST) I $G(ORASK)
"DATA",101.41,15664,10,4,6)
D LIST^ORCD
"DATA",101.41,15664,10,4,9)
D MOD^ORCDVBEC
"DATA",101.41,15664,10,4,"W")
cboModifiers
"DATA",101.41,15664,10,5,0)
7^626^^^^1^^^C
"DATA",101.41,15664,10,5,1)
Select a reason why this component is needed, or enter one of your own.
"DATA",101.41,15664,10,5,2)
7^^^Reason for Request: ^^1
"DATA",101.41,15664,10,5,3)
I ORCOMP
"DATA",101.41,15664,10,5,6)
D LIST^ORCD
"DATA",101.41,15664,10,5,9)
D REASON^ORCDVBEC
"DATA",101.41,15664,10,5,"W")
tReason
"DATA",101.41,15664,10,6,0)
4^7^^^^1^^^CW^S.VBEC
"DATA",101.41,15664,10,6,1)
Enter the urgency of this request.
"DATA",101.41,15664,10,6,2)
4^^ROUTINE
"DATA",101.41,15664,10,6,3)
I $$ASKURG^ORCDVBEC
"DATA",101.41,15664,10,6,6)
D LIST^ORCD
"DATA",101.41,15664,10,6,9)
D ENURG^ORCDVBEC
"DATA",101.41,15664,10,6,"W")
cboUrgency
"DATA",101.41,15664,10,7,0)
5^629^^Surgery: ^^^^^C
"DATA",101.41,15664,10,7,1)
Enter the name of the surgical procedure that this request is for.
"DATA",101.41,15664,10,7,2)
5^^^for
"DATA",101.41,15664,10,7,3)
I ORCOMP
"DATA",101.41,15664,10,7,5)
D CKMSBOS^ORCDVBEC
"DATA",101.41,15664,10,7,6)
D LIST^ORCD
"DATA",101.41,15664,10,7,9)
D ENSURG^ORCDVBEC
"DATA",101.41,15664,10,7,"W")
cboSurgery
"DATA",101.41,15664,10,8,0)
8^177^^Informed Consent signed on chart? ^^1^^^CW^^^^Informed Consent: 
"DATA",101.41,15664,10,8,1)
Enter YES if the patient has signed a consent form.
"DATA",101.41,15664,10,8,3)
I 0 ;I ORCOMP
"DATA",101.41,15664,10,8,"W")
chkConsent
"DATA",101.41,15664,10,9,0)
9^19^^Comments: ^^^^^C
"DATA",101.41,15664,10,9,1)
Enter any additional comments or instructions for this order.
"DATA",101.41,15664,10,9,2)
6^^^^^1
"DATA",101.41,15664,10,9,9)
I $G(ORTYPE)'="Z",$P($G(^ORD(101.43,+$G(ORITM),0)),U)="OTHER" S REQD=1
"DATA",101.41,15664,10,9,"W")
txtDiagComment
"DATA",101.41,15664,10,11,0)
98^15662^^^^^1^^*
"DATA",101.41,15664,10,11,3)
I 0 ;created by Component
"DATA",101.41,15664,10,12,0)
2^28^^Collected By: ^^1^^^C
"DATA",101.41,15664,10,12,1)
Enter the method of collection for this sample.
"DATA",101.41,15664,10,12,2)
9^1~1
"DATA",101.41,15664,10,12,3)
I ORTEST
"DATA",101.41,15664,10,12,5)
D CKTYPE^ORCDLR1
"DATA",101.41,15664,10,12,6)
D HELPTYPE^ORCDLR1
"DATA",101.41,15664,10,12,7)
I ORTEST S Y=$$COLLTYPE^ORCDLR1 K:'$L(Y) Y
"DATA",101.41,15664,10,12,9)
I ORTEST D ENTYPE^ORCDVBEC
"DATA",101.41,15664,10,12,10)
S ORCOLLCT=$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,15664,10,12,"W")
cboCollType
"DATA",101.41,15664,10,15,0)
3^6^^Collection Date/Time: ^^1^^^W
"DATA",101.41,15664,10,15,.1)
I ORCOLLCT="LC",X'?1.N,"AMNEXT"'[$$UP^XLFSTR(X),$L(X,".")'>1,$L(X,"@")'>1 S X=X_"@"_$S($$DATE^ORCDLR(X)=DT:$G(ORTIME("NEXT")),1:$G(ORTIME("AM")))
"DATA",101.41,15664,10,15,1)
Enter the date/time the sample should be collected.
"DATA",101.41,15664,10,15,3)
I ORTEST
"DATA",101.41,15664,10,15,5)
I $G(ORESET)'=$P(Y,U) N OK S OK=$S(ORCOLLCT="LC":$$LABCOLL^ORCDLR1($P(Y,U)),ORCOLLCT="I":$$IMMCOLL^ORCDLR1($P(Y,U)),1:$$CKDATE^ORCDLR1($P(Y,U))) I 'OK W $C(7),!,$P(OK,U,2) K DONE
"DATA",101.41,15664,10,15,6)
D FTDHELP^ORCD D:ORCOLLCT="LC" LISTCOLL^ORCDLR1,LIST^ORCD:$G(ORDIALOG(PROMPT,"LIST")) D:ORCOLLCT="I" IMMTIMES^ORCDLR1
"DATA",101.41,15664,10,15,7)
I ORTEST,$G(ORTYPE)'="Z" S Y=$$DEFTIME^ORCDLR1 K:'$L(Y) Y
"DATA",101.41,15664,10,15,9)
I ORTEST D COLLTIME^ORCDLR1
"DATA",101.41,15664,10,15,"W")
calCollTime
"DATA",101.41,15664,10,16,0)
1.3^15671^^^^^^^*^^4
"DATA",101.41,15664,10,16,2)
^@
"DATA",101.41,15664,10,16,3)
I 0 ;stuffed in from component
"DATA",101.41,15664,10,16,9)
D SPCSTS^ORCDVBEC
"DATA",101.41,15664,10,17,0)
99^628^^^^^^^*
"DATA",101.41,15664,10,17,3)
I 0 ;created by Lab child order on release
"DATA",101.41,15664,99)
61031,45824
"DATA",101.41,15671,0)
OR GTX SPECIMEN STATUS^Specimen Status: ^^P
"DATA",101.41,15671,1)
F^1:50^SPECSTS
"DATA",101.41,15671,99)
61031,45824
"FIA",100.98)
DISPLAY GROUP
"FIA",100.98,0)
^ORD(100.98,
"FIA",100.98,0,0)
100.98I
"FIA",100.98,0,1)
n^n^f^^y^^y^r^n
"FIA",100.98,0,10)

"FIA",100.98,0,11)
I $P(^(0),U,3)?1"VB".E
"FIA",100.98,0,"RLRO")

"FIA",100.98,0,"VR")
3.0^OR
"FIA",100.98,100.98)
0
"FIA",100.98,100.981)
0
"FIA",101.41)
ORDER DIALOG
"FIA",101.41,0)
^ORD(101.41,
"FIA",101.41,0,0)
101.41I
"FIA",101.41,0,1)
n^n^f^^y^^y^r^n
"FIA",101.41,0,10)

"FIA",101.41,0,11)
I $$DLGSEND^ORY212($P(^(0),U))
"FIA",101.41,0,"RLRO")

"FIA",101.41,0,"VR")
3.0^OR
"FIA",101.41,101.41)
0
"FIA",101.41,101.411)
0
"FIA",101.41,101.412)
0
"FIA",101.41,101.41218)
0
"FIA",101.41,101.415)
0
"FIA",101.41,101.416)
0
"FIA",101.41,101.4162)
0
"FIA",101.43)
ORDERABLE ITEMS
"FIA",101.43,0)
^ORD(101.43,
"FIA",101.43,0,0)
101.43
"FIA",101.43,0,1)
y^n^p^^^^n^^n
"FIA",101.43,0,10)

"FIA",101.43,0,11)

"FIA",101.43,0,"RLRO")

"FIA",101.43,0,"VR")
3.0^OR
"FIA",101.43,101.43)
1
"FIA",101.43,101.43,6001)

"FIA",101.43,101.43,6002)

"FRV1",100.98,"66,0",4)
VBEC BLOOD BANK
"FRV1",100.98,"66,0",4,"F")
;ORD(101.41,
"FRV1",101.41,"15664,0",5)
BLOOD PRODUCTS
"FRV1",101.41,"15664,0",5,"F")
;ORD(100.98,
"FRV1",101.41,"15664,0",7)
VBECS
"FRV1",101.41,"15664,0",7,"F")
;DIC(9.4,
"FRV1",101.41,"15664,10,1,0",2)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"15664,10,1,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"15664,10,11,0",2)
OR GTX RESULTS
"FRV1",101.41,"15664,10,11,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"15664,10,12,0",2)
OR GTX COLLECTION TYPE
"FRV1",101.41,"15664,10,12,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"15664,10,15,0",2)
OR GTX START DATE/TIME
"FRV1",101.41,"15664,10,15,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"15664,10,16,0",2)
OR GTX SPECIMEN STATUS
"FRV1",101.41,"15664,10,16,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"15664,10,16,0",11)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"15664,10,16,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"15664,10,17,0",2)
OR GTX LAB ORDER
"FRV1",101.41,"15664,10,17,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"15664,10,2,0",2)
OR GTX AMOUNT
"FRV1",101.41,"15664,10,2,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"15664,10,2,0",11)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"15664,10,2,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"15664,10,3,0",2)
OR GTX DATE/TIME
"FRV1",101.41,"15664,10,3,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"15664,10,4,0",2)
OR GTX RBC MODIFIERS
"FRV1",101.41,"15664,10,4,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"15664,10,4,0",11)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"15664,10,4,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"15664,10,5,0",2)
OR GTX REASON
"FRV1",101.41,"15664,10,5,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"15664,10,6,0",2)
OR GTX URGENCY
"FRV1",101.41,"15664,10,6,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"15664,10,7,0",2)
OR GTX TEXT
"FRV1",101.41,"15664,10,7,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"15664,10,8,0",2)
OR GTX YES/NO
"FRV1",101.41,"15664,10,8,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"15664,10,9,0",2)
OR GTX FREE TEXT 1
"FRV1",101.41,"15664,10,9,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1647,0",7)
ORDER ENTRY/RESULTS REPORTING
"FRV1",101.41,"1647,0",7,"F")
;DIC(9.4,
"FRV1",101.41,"629,0",7)
ORDER ENTRY/RESULTS REPORTING
"FRV1",101.41,"629,0",7,"F")
;DIC(9.4,
"INI")
PRE^ORY212
"INIT")
POST^ORY212
"IX",101.41,101.41,"B",0)
101.41^B^Regular B index using full field length^R^^F^IR^I^101.41^^^^^LS
"IX",101.41,101.41,"B",1)
S ^ORD(101.41,"B",$E(X,1,63),DA)=""
"IX",101.41,101.41,"B",2)
K ^ORD(101.41,"B",$E(X,1,63),DA)
"IX",101.41,101.41,"B",2.5)
K ^ORD(101.41,"B")
"IX",101.41,101.41,"B",11.1,0)
^.114IA^1^1
"IX",101.41,101.41,"B",11.1,1,0)
1^F^101.41^.01^63^1^F
"KRN",19,11680,-1)
2^2
"KRN",19,11680,0)
ORCM ORDERABLES MENU^Manage orderable items^^M^4600^^^^^^^22
"KRN",19,11680,10,0)
^19.01IP^4^4
"KRN",19,11680,10,4,0)
12560^VB
"KRN",19,11680,10,4,"^")
ORCM VBECS OI EDIT
"KRN",19,11680,"U")
MANAGE ORDERABLE ITEMS
"KRN",19,12560,-1)
0^1
"KRN",19,12560,0)
ORCM VBECS OI EDIT^Edit VBECS item display names^^R^^^^^^^^
"KRN",19,12560,1,0)
^19.06^2^2^3070716^^^^
"KRN",19,12560,1,1,0)
This option allows you to modify the display name of VBECS blood
"KRN",19,12560,1,2,0)
components and tests.
"KRN",19,12560,25)
OI^ORCDVBC1
"KRN",19,12560,"U")
EDIT VBECS ITEM DISPLAY NAMES
"KRN",101,5774,-1)
0^2
"KRN",101,5774,0)
OR OMG SERVER^^^E^^^^^^^^
"KRN",101,5774,1,0)
^^2^2^3041229^
"KRN",101,5774,1,1,0)
This protocol is triggered whenever an order for a Blood Bank component 
"KRN",101,5774,1,2,0)
class or diagnostic test is created in CPRS.
"KRN",101,5774,15)
Q
"KRN",101,5774,20)
Q
"KRN",101,5774,770)
OERR^^OMG^O19^^^^AL^AL^2.4^
"KRN",101,5774,772)
D EN^ORMHLREC
"KRN",101,5774,775,0)
^101.0775PA^1^1
"KRN",101,5774,775,1,0)
5775
"KRN",101,5774,775,1,"^")
OR OMG CLIENT
"KRN",101,5775,-1)
0^1
"KRN",101,5775,0)
OR OMG CLIENT^^^S^^^^^^^^
"KRN",101,5775,770)
^VBECS^^O20^^^OERR-VBECS^^^^ORG
"KRN",101,5775,773)
0^0^0
"KRN",101,5775,774)

"KRN",771,174,-1)
0^1
"KRN",771,174,0)
OERR^a^589^VBECS INTERFACE ADMIN^^^USA
"KRN",771,174,"EC")
^~\&
"KRN",771,174,"FS")
|
"KRN",870,234,-1)
0^1
"KRN",870,234,0)
OERR-VBECS^^TCP^^^^^^^^^^^^^^^^^^1000
"KRN",870,234,200)
^5^^10^10^^^^0^R
"KRN",870,234,400)
10.3.21.12^19802^C^N^^^N^^
"KRN",8989.5,9338,0)
22;DIC(9.4,^OR VBECS COMPONENT ORDER^5
"KRN",8989.5,9338,1)
RED BLOOD CELLS
"KRN",8989.5,9339,0)
22;DIC(9.4,^OR VBECS COMPONENT ORDER^10
"KRN",8989.5,9339,1)
FRESH FROZEN PLASMA
"KRN",8989.5,9340,0)
22;DIC(9.4,^OR VBECS COMPONENT ORDER^15
"KRN",8989.5,9340,1)
PLATELETS
"KRN",8989.5,9341,0)
22;DIC(9.4,^OR VBECS COMPONENT ORDER^20
"KRN",8989.5,9341,1)
CRYOPRECIPITATE
"KRN",8989.5,9342,0)
22;DIC(9.4,^OR VBECS COMPONENT ORDER^25
"KRN",8989.5,9342,1)
WHOLE BLOOD
"KRN",8989.5,9343,0)
22;DIC(9.4,^OR VBECS COMPONENT ORDER^30
"KRN",8989.5,9343,1)
OTHER
"KRN",8989.5,9344,0)
22;DIC(9.4,^OR VBECS MODIFIERS^5
"KRN",8989.5,9344,1)
Washed
"KRN",8989.5,9345,0)
22;DIC(9.4,^OR VBECS MODIFIERS^10
"KRN",8989.5,9345,1)
Irradiated
"KRN",8989.5,9346,0)
22;DIC(9.4,^OR VBECS MODIFIERS^15
"KRN",8989.5,9346,1)
Leuko Reduced
"KRN",8989.5,9347,0)
22;DIC(9.4,^OR VBECS MODIFIERS^20
"KRN",8989.5,9347,1)
Volume Reduced
"KRN",8989.5,9348,0)
22;DIC(9.4,^OR VBECS MODIFIERS^25
"KRN",8989.5,9348,1)
Divided
"KRN",8989.5,12731,0)
22;DIC(9.4,^OR VBECS MODIFIERS^30
"KRN",8989.5,12731,1)
Leuko Reduced/Irradiated
"KRN",8989.5,12732,0)
22;DIC(9.4,^OR VBECS REASON FOR REQUEST^5
"KRN",8989.5,12732,1)
Transfuse
"KRN",8989.5,12733,0)
22;DIC(9.4,^OR VBECS REASON FOR REQUEST^10
"KRN",8989.5,12733,1)
Hold for OR
"KRN",8989.5,12734,0)
22;DIC(9.4,^OR VBECS REASON FOR REQUEST^15
"KRN",8989.5,12734,1)
Hold until MD gives order
"KRN",8989.5,12735,0)
22;DIC(9.4,^OR VBECS REASON FOR REQUEST^20
"KRN",8989.5,12735,1)
See COMMENT for justification
"KRN",8989.5,13561,0)
22;DIC(9.4,^OR VBECS ERROR MESSAGE^1
"KRN",8989.5,13561,1)
Default VistALink Error
"KRN",8989.5,13561,2,0)
^^8^8^3081022
"KRN",8989.5,13561,2,1,0)
******************************************************************
"KRN",8989.5,13561,2,2,0)
*                                                                *
"KRN",8989.5,13561,2,3,0)
*          Patient data is not available at this time            *
"KRN",8989.5,13561,2,4,0)
*            due to a VistALink connection failure.              *
"KRN",8989.5,13561,2,5,0)
*                                                                *
"KRN",8989.5,13561,2,6,0)
*       Contact IRM and/or the Blood Bank for assistance.        *
"KRN",8989.5,13561,2,7,0)
*                                                                *
"KRN",8989.5,13561,2,8,0)
******************************************************************
"KRN",8989.51,208,-1)
0^1
"KRN",8989.51,208,0)
OR VBECS COMPONENT ORDER^List of Blood Components^1^Sequence^Blood Component
"KRN",8989.51,208,1)
P^101.43^Select a Blood Component for VBECS
"KRN",8989.51,208,3)
I $P($G(^ORD(101.43,+Y,0)),"^",2)["99VBC"
"KRN",8989.51,208,6)
N^1:99:2^Enter the sequence in which the component should appear in the selection list
"KRN",8989.51,208,20,0)
^^2^2^3040520^
"KRN",8989.51,208,20,1,0)
This parameter allows a sequence to be assigned to Blood Components
"KRN",8989.51,208,20,2,0)
selectable from VBECS.
"KRN",8989.51,208,30,0)
^8989.513I^4^4
"KRN",8989.51,208,30,1,0)
6^9.4
"KRN",8989.51,208,30,2,0)
4^4.2
"KRN",8989.51,208,30,3,0)
3^4
"KRN",8989.51,208,30,4,0)
2^200
"KRN",8989.51,405,-1)
0^2
"KRN",8989.51,405,0)
OR VBECS MODIFIERS^List of Component Modifiers^1^Sequence^Modifier
"KRN",8989.51,405,1)
F^1:50^Enter a blood component modifier
"KRN",8989.51,405,6)
N^1:99:2^Enter the sequence in which the modifier should appear in the selection list
"KRN",8989.51,405,20,0)
^8989.512^1^1^3051103^^
"KRN",8989.51,405,20,1,0)
This parameter allows local configuration of the blood component modifiers.
"KRN",8989.51,405,30,0)
^8989.513I^2^2
"KRN",8989.51,405,30,1,0)
5^4.2
"KRN",8989.51,405,30,2,0)
10^9.4
"KRN",8989.51,459,-1)
0^3
"KRN",8989.51,459,0)
OR VBECS REASON FOR REQUEST^List of Reasons for Request^1^Sequence^Reason
"KRN",8989.51,459,1)
F^1:75^Enter a reason for request
"KRN",8989.51,459,6)
N^1:99:2^Enter the sequence in which the reason should appear in the selection list
"KRN",8989.51,459,20,0)
^8989.512^1^1^3070830^^^
"KRN",8989.51,459,20,1,0)
This parameter allows local configuration of the Reasons for Request.
"KRN",8989.51,459,30,0)
^8989.513I^2^2
"KRN",8989.51,459,30,1,0)
5^4.2
"KRN",8989.51,459,30,2,0)
10^9.4
"KRN",8989.51,472,-1)
0^4
"KRN",8989.51,472,0)
OR VBECS LEGACY REPORT^Show Legacy (VISTA) Blood Bank Report^^^Yes/No
"KRN",8989.51,472,1)
Y^Y:yes;N:no^Enter 'yes' to show Legacy Blood Bank Report
"KRN",8989.51,472,20,0)
^8989.512^2^2^3080619^^^^
"KRN",8989.51,472,20,1,0)
'Yes' will show the Legacy (VISTA) blood bank report after
"KRN",8989.51,472,20,2,0)
the VBECS blood bank report.
"KRN",8989.51,472,30,0)
^8989.513I^4^3
"KRN",8989.51,472,30,2,0)
2^4
"KRN",8989.51,472,30,3,0)
3^4.2
"KRN",8989.51,472,30,4,0)
1^9.4
"KRN",8989.51,473,-1)
0^5
"KRN",8989.51,473,0)
OR VBECS ERROR MESSAGE^Text for Network Error^0^^Description^0
"KRN",8989.51,473,1)
W^^Enter text to be displayed when CPRS cannot communicate with VBECS.
"KRN",8989.51,473,20,0)
^^4^4^3080930^
"KRN",8989.51,473,20,1,0)
This parameter holds the text to be displayed when the VBECS order dialog
"KRN",8989.51,473,20,2,0)
is selected but the communication links between CPRS and VBECS are down.
"KRN",8989.51,473,20,3,0)
Site-specific directions for initiating blood bank orders are encouraged
"KRN",8989.51,473,20,4,0)
to be put here at the System or Division level.
"KRN",8989.51,473,30,0)
^8989.513I^3^3
"KRN",8989.51,473,30,1,0)
9^9.4
"KRN",8989.51,473,30,2,0)
7^4.2
"KRN",8989.51,473,30,3,0)
5^4
"MBREQ")
0
"ORD",13,870)
870;13;1;;HLLL^XPDTA1;;HLLLE^XPDIA1;;;HLLLDEL^XPDIA1(%)
"ORD",13,870,0)
HL LOGICAL LINK
"ORD",14,771)
771;14;;;HLAP^XPDTA1;HLAPF1^XPDIA1;HLAPE1^XPDIA1;HLAPF2^XPDIA1;;HLAPDEL^XPDIA1(%)
"ORD",14,771,0)
HL7 APPLICATION PARAMETER
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PGL",100.98,0,4,4)
DEFAULT DIALOG^P101.41'^ORD(101.41,^0;4^Q
"PGL",101.41,0,5,5)
DISPLAY GROUP^P100.98'^ORD(100.98,^0;5^Q
"PGL",101.41,0,7,7)
PACKAGE^P9.4'^DIC(9.4,^0;7^Q
"PGL",101.41,5,9,59)
URL^P101.14^ORD(101.14,^5;9^Q
"PGL",101.412,0,2,2)
ITEM^P101.41'X^ORD(101.41,^0;2^D TREE^ORDD41
"PGL",101.412,0,11,1)
PARENT^P101.41'^ORD(101.41,^0;11^Q
"PGL",101.415,0,2,2)
ITEM^P101.41'^ORD(101.41,^0;2^Q
"PGL",101.416,0,2,.02)
DIALOG^P101.41'^ORD(101.41,^0;2^Q
"PKG",22,-1)
1^1
"PKG",22,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",22,20,0)
^9.402P^^
"PKG",22,22,0)
^9.49I^1^1
"PKG",22,22,1,0)
3.0^2971217^2980204^64
"PKG",22,22,1,"PAH",1,0)
212^3081023^222222226
"PKG",22,22,1,"PAH",1,1,0)
^^3^3^3081023
"PKG",22,22,1,"PAH",1,1,1,0)
This patch implements the interface between CPRS and VBECS, installing
"PKG",22,22,1,"PAH",1,1,2,0)
a new order dialog and other supporting components.  CPRS and VBECS are
"PKG",22,22,1,"PAH",1,1,3,0)
both required to install this patch.
"PRE")
ORY212E
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
16
"RTN","ORCDVBC1")
0^17^B5469622
"RTN","ORCDVBC1",1,0)
ORCDVBC1 ;SLC/MKB-Utility functions for VBECS dialogs cont ;2/11/08  11:03
"RTN","ORCDVBC1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**212**;Dec 17, 1997;Build 24
"RTN","ORCDVBC1",3,0)
 ;
"RTN","ORCDVBC1",4,0)
PTINFO ; -- Show patient data [from EN^ORCDVBEC]
"RTN","ORCDVBC1",5,0)
 ;   Expects ORPNM, ORVB(attribute) from OEAPI^VBECA3
"RTN","ORCDVBC1",6,0)
 N I,X,TYPE,ORUA
"RTN","ORCDVBC1",7,0)
 W !!,"CURRENT DATA FOR "_$G(ORPNM)_":" ;I '$L($G(ORVB("ABORH"))) W " none",! Q
"RTN","ORCDVBC1",8,0)
 W !!,"ABO/Rh: "_$TR($G(ORVB("ABORH")),"^"," "),!
"RTN","ORCDVBC1",9,0)
 W !,"Antibodies Identified:" D
"RTN","ORCDVBC1",10,0)
 . I '$O(ORVB("ABHIS",0)) W "none",! Q
"RTN","ORCDVBC1",11,0)
 . S I=0 F  S I=$O(ORVB("ABHIS",I)) Q:I<1  W ?27,$G(ORVB("ABHIS",I)),!
"RTN","ORCDVBC1",12,0)
 W !,"Units Available",?36,"Expiration D/T  Division"
"RTN","ORCDVBC1",13,0)
 W !,"---------------",?36,"--------------  --------"
"RTN","ORCDVBC1",14,0)
 F TYPE="A^Autologous","D^Directed","C^Crossmatched","S^Assigned" D
"RTN","ORCDVBC1",15,0)
 . Q:'$O(ORVB("UNIT",$P(TYPE,U),0))  S ORUA=1
"RTN","ORCDVBC1",16,0)
 . W !,$P(TYPE,U,2)_" Units:" S TYPE=$P(TYPE,U)
"RTN","ORCDVBC1",17,0)
 . S I=0 F  S I=$O(ORVB("UNIT",TYPE,I)) Q:I<1  S X=$G(ORVB("UNIT",TYPE,I)) W !,"  "_$$PAD^ORCHTAB($P(X,U),15)_$$PAD^ORCHTAB($P(X,U,2),19)_$$DATETIME($P(X,U,4))_"  "_$P(X,U,3)
"RTN","ORCDVBC1",18,0)
 I '$G(ORUA) W !,"  none"
"RTN","ORCDVBC1",19,0)
 W !!,"Transfusion Reactions",?36,"Date/Time"
"RTN","ORCDVBC1",20,0)
 W !,"---------------------",?36,"---------"
"RTN","ORCDVBC1",21,0)
 I '$O(ORVB("TRHX",0)) W !,"  none"
"RTN","ORCDVBC1",22,0)
 E  S I=0 F  S I=$O(ORVB("TRHX",I)) Q:I<1  S X=$G(ORVB("TRHX",I)) W !,"  "_$P(X,U),?36,$$DATETIME($P(X,U,2))
"RTN","ORCDVBC1",23,0)
 W !
"RTN","ORCDVBC1",24,0)
 Q
"RTN","ORCDVBC1",25,0)
 ;
"RTN","ORCDVBC1",26,0)
DATETIME(X) ; -- Return external form of YYYYMMDDHHNNSS date
"RTN","ORCDVBC1",27,0)
 N Y S Y=$$HL7TFM^XLFDT(X),Y=$$DATETIME^ORCHTAB(Y)
"RTN","ORCDVBC1",28,0)
 Q Y
"RTN","ORCDVBC1",29,0)
 ;
"RTN","ORCDVBC1",30,0)
OI ; -- Edit VBECS orderable item names
"RTN","ORCDVBC1",31,0)
 ; Option = ORCM VBECS OI EDIT
"RTN","ORCDVBC1",32,0)
 N X,Y,D,DA,DR,DIE,DIC
"RTN","ORCDVBC1",33,0)
 F  D  Q:Y<1  W !
"RTN","ORCDVBC1",34,0)
 . S DIC("A")="Select VBECS ORDERABLE ITEM: "
"RTN","ORCDVBC1",35,0)
 . S DIC("W")="W:$P(^(0),U)'=$P(^(0),U,8) ""      "",$P(^(0),U,8)"
"RTN","ORCDVBC1",36,0)
 . S DIC="^ORD(101.43,",DIC(0)="AEQSZ",D="S.VBEC" D IX^DIC Q:Y<1
"RTN","ORCDVBC1",37,0)
 . S DIE=DIC,DA=+Y,DR=".01" D ^DIE S Y=1
"RTN","ORCDVBC1",38,0)
 Q
"RTN","ORCDVBC1",39,0)
 ;
"RTN","ORCDVBC1",40,0)
STRIP(X) ; -- remove leading spaces
"RTN","ORCDVBC1",41,0)
 N I,Y S Y=""
"RTN","ORCDVBC1",42,0)
 F I=1:1:$L(X) I $E(X,I)'=" " S Y=$E(X,I,$L(X)) Q
"RTN","ORCDVBC1",43,0)
 Q Y
"RTN","ORCDVBC1",44,0)
 ;
"RTN","ORCDVBC1",45,0)
LB(ORDER) ; -- Return Lab order number for specimen collection
"RTN","ORCDVBC1",46,0)
 ; [Additional Text field #19 -- expects ORIFN from TEXT^ORQ12]
"RTN","ORCDVBC1",47,0)
 N I,LR,NUM
"RTN","ORCDVBC1",48,0)
 S NUM="",LR=+$$PKG^ORMPS1("LR")
"RTN","ORCDVBC1",49,0)
 S I=0 F  S I=+$O(^OR(100,+$G(ORDER),2,I)) Q:I<1  I $P($G(^OR(100,I,0)),U,14)=LR,$G(^(4)) S NUM=+^(4) Q
"RTN","ORCDVBC1",50,0)
 Q NUM
"RTN","ORCDVBEC")
0^1^B66434607
"RTN","ORCDVBEC",1,0)
ORCDVBEC ;SLC/MKB-Utility functions for VBECS dialogs ;2/11/08  11:04
"RTN","ORCDVBEC",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**212**;Dec 17, 1997;Build 24
"RTN","ORCDVBEC",3,0)
 ;
"RTN","ORCDVBEC",4,0)
 ; External References:
"RTN","ORCDVBEC",5,0)
 ;   OEAPI^VBECA3       #4766
"RTN","ORCDVBEC",6,0)
 ;   RR^LR7OR1          #2503
"RTN","ORCDVBEC",7,0)
 ;   GCOM^LR7OR3        #2428
"RTN","ORCDVBEC",8,0)
 ;   $$SITE^VASITE      #10112
"RTN","ORCDVBEC",9,0)
 ;   $$HL7TFM^XLFDT     #10103
"RTN","ORCDVBEC",10,0)
 ;   $$UP^XLFSTR        #10104
"RTN","ORCDVBEC",11,0)
 ;
"RTN","ORCDVBEC",12,0)
PTR(X) ; -- Returns pointer to #101.41 of prompt OR GTX X
"RTN","ORCDVBEC",13,0)
 Q +$O(^ORD(101.41,"AB","OR GTX "_X,0))
"RTN","ORCDVBEC",14,0)
 ;
"RTN","ORCDVBEC",15,0)
EN ; -- entry action
"RTN","ORCDVBEC",16,0)
 I '$L($T(OEAPI^VBECA3)) W $C(7),!!,"Blood Bank orders are not available yet!" H 2 S ORQUIT=1 Q
"RTN","ORCDVBEC",17,0)
 N DIV,ORSTN,C,N,X S DIV=+$P($G(^SC(+$G(ORL),0)),U,15)
"RTN","ORCDVBEC",18,0)
 S ORSTN=$P($$SITE^VASITE(DT,DIV),U,3)
"RTN","ORCDVBEC",19,0)
 I $G(ORTYPE)'="Z" D OEAPI^VBECA3(.ORVB,+ORVP,ORSTN),PTINFO^ORCDVBC1
"RTN","ORCDVBEC",20,0)
 S C=0 F  S C=$O(ORVB(C)) Q:C<1  S N=0 F  S N=$O(ORVB(C,"MSBOS",N)) Q:N<1  S X=$G(ORVB(C,"MSBOS",N)),ORMSBOS(C,$P(X,U))=$P(X,U,2) ;sort
"RTN","ORCDVBEC",21,0)
 ;get initial state: ORCOMP/ORTEST = id^id^ ^id, ORTAS = 1 or 0:
"RTN","ORCDVBEC",22,0)
 S (ORCOMP,ORTEST,ORTAS)="" I $D(OREDIT)!$G(OREWRITE) D
"RTN","ORCDVBEC",23,0)
 . N P,I,X,X0 S P=$$PTR("ORDERABLE ITEM")
"RTN","ORCDVBEC",24,0)
 . S I=0 F  S I=$O(ORDIALOG(P,I)) Q:I<1  S X=+$G(ORDIALOG(P,I)) D
"RTN","ORCDVBEC",25,0)
 .. S X0=$G(^ORD(101.43,X,"VB")),X=+$P($G(^(0)),U,2)
"RTN","ORCDVBEC",26,0)
 .. I $P(X0,U) S ORCOMP=ORCOMP_$S($L(ORCOMP):U,1:"")_X Q
"RTN","ORCDVBEC",27,0)
 .. S ORTEST=ORTEST_$S($L(ORTEST):U,1:"")_X
"RTN","ORCDVBEC",28,0)
 Q
"RTN","ORCDVBEC",29,0)
 ;
"RTN","ORCDVBEC",30,0)
EX ; -- exit action
"RTN","ORCDVBEC",31,0)
 K ORITM,ORCOMP,ORTEST,ORTAS,ORMSBOS,ORTIME,ORIMTIME,ORDIV,ORCOLLCT,ORVB,ORASK
"RTN","ORCDVBEC",32,0)
 I $G(ORXL) S ORL=ORXL K ORXL
"RTN","ORCDVBEC",33,0)
 Q
"RTN","ORCDVBEC",34,0)
 ;
"RTN","ORCDVBEC",35,0)
XHELP ; -- display OI's in groups
"RTN","ORCDVBEC",36,0)
 N INDEX,CNT,SCREEN,X,Y,SYN,Y0,D,Z,DONE
"RTN","ORCDVBEC",37,0)
 S CNT=1,SCREEN=$G(ORDIALOG(PROMPT,"S"))
"RTN","ORCDVBEC",38,0)
 F INDEX="S.VBC","S.VBT" D  Q:$G(DONE)
"RTN","ORCDVBEC",39,0)
 . W !!,$S(INDEX["C":"Choose from Blood Components:",1:"or Diagnostic Tests:")
"RTN","ORCDVBEC",40,0)
 . S X="" F  S X=$O(^ORD(101.43,INDEX,X)) Q:X=""  S Y=0 D  Q:$G(DONE)
"RTN","ORCDVBEC",41,0)
 .. F  S Y=$O(^ORD(101.43,INDEX,X,Y)) Q:Y'>0  S SYN=$G(^(Y)) I 'SYN D  Q:$G(DONE)
"RTN","ORCDVBEC",42,0)
 ... S Y0=$G(^ORD(101.43,Y,0)),D=INDEX X:$L(SCREEN) SCREEN Q:'$T
"RTN","ORCDVBEC",43,0)
 ... W !,"   "_X ;W:SYN "     "_$P(SYN,U,4) ; echo .01 if synonym
"RTN","ORCDVBEC",44,0)
 ... S CNT=CNT+1 Q:CNT'>(IOSL-5)  S CNT=0
"RTN","ORCDVBEC",45,0)
 ... W !,"   '^' TO STOP: " R Z:DTIME S:'$T!(Z["^") DONE=1
"RTN","ORCDVBEC",46,0)
 W !
"RTN","ORCDVBEC",47,0)
 Q
"RTN","ORCDVBEC",48,0)
 ;
"RTN","ORCDVBEC",49,0)
PSAOI ; -- set ORASK flags or show GenWrdInstructions for OI instance
"RTN","ORCDVBEC",50,0)
 I $$DUP^ORCD(PROMPT,ORI) K DONE W $C(7),!,"This component or test has already been selected!",! Q
"RTN","ORCDVBEC",51,0)
 N X0,NAME,ORT,ORWRD,WRD,I
"RTN","ORCDVBEC",52,0)
 S ORASK=+$G(^ORD(101.43,+$G(Y),"VB")),X0=$G(^(0)) ;VBEC OI
"RTN","ORCDVBEC",53,0)
 Q:ORASK  Q:$G(ORESET)=+$G(Y)  ;get ward instr for new tests
"RTN","ORCDVBEC",54,0)
 S NAME=$P(X0,U,8),ORT=+$$TEST^ORCSEND2(NAME) ;corresponding Lab OI
"RTN","ORCDVBEC",55,0)
 S ORT=+$P($G(^ORD(101.43,ORT,0)),U,2) ;#60 ien
"RTN","ORCDVBEC",56,0)
 D GCOM^LR7OR3(ORT,.ORWRD) S WRD="GenWardInstructions"
"RTN","ORCDVBEC",57,0)
 I $O(ORWRD(WRD,0)) W !! S I=0 F  S I=$O(ORWRD(WRD,I)) Q:I'>0  W ORWRD(WRD,I,0),!
"RTN","ORCDVBEC",58,0)
 Q
"RTN","ORCDVBEC",59,0)
 ;
"RTN","ORCDVBEC",60,0)
MOD ; -- get allowable modifier values
"RTN","ORCDVBEC",61,0)
 Q:$G(ORDIALOG(PROMPT,"LIST"))  N ORX,I,X
"RTN","ORCDVBEC",62,0)
 D GETLST^XPAR(.ORX,"ALL","OR VBECS MODIFIERS","Q")
"RTN","ORCDVBEC",63,0)
 S I=0 F  S I=$O(ORX(I)) Q:I<1  D
"RTN","ORCDVBEC",64,0)
 . S X=$P($G(ORX(I)),U,2) Q:'$L(X)
"RTN","ORCDVBEC",65,0)
 . S ORDIALOG(PROMPT,"LIST",I)=X_U_X
"RTN","ORCDVBEC",66,0)
 . S ORDIALOG(PROMPT,"LIST","B",$$UP^XLFSTR(X))=X
"RTN","ORCDVBEC",67,0)
 S:ORX ORDIALOG(PROMPT,"LIST")=ORX_"^1"
"RTN","ORCDVBEC",68,0)
 Q
"RTN","ORCDVBEC",69,0)
 ;
"RTN","ORCDVBEC",70,0)
PSAMT ; -- Post-Selection Action for Amount, to validate and format
"RTN","ORCDVBEC",71,0)
 ;   only allow numeric entry for now, until GUI can accept volume
"RTN","ORCDVBEC",72,0)
 N X,X1,X2
"RTN","ORCDVBEC",73,0)
 I +Y'=Y W !,$C(7),"Enter the number of units needed, from 1-99." K DONE Q
"RTN","ORCDVBEC",74,0)
 S X=$$UP^XLFSTR(Y),X1=+X ;,X2=$$STRIP($P(X,X1,2))
"RTN","ORCDVBEC",75,0)
 ;I X2="ML" S ORDIALOG(PROMPT,ORI)=X1_"ml" Q
"RTN","ORCDVBEC",76,0)
 I (X1<1)!(X1>99) W !,$C(7),"Enter the number of units needed, from 1-99." K DONE Q  ;!("UNITS"'[X2)
"RTN","ORCDVBEC",77,0)
 S ORDIALOG(PROMPT,ORI)=X1 ;_" unit"_$S(X1>1:"s",1:"")
"RTN","ORCDVBEC",78,0)
 Q
"RTN","ORCDVBEC",79,0)
 ;
"RTN","ORCDVBEC",80,0)
SPCSTS ; -- set Specimen Status by component [Entry Action]
"RTN","ORCDVBEC",81,0)
 I '$G(ORASK) K ORDIALOG(PROMPT,INST) Q  ;not a component
"RTN","ORCDVBEC",82,0)
 N OI,X S OI=+$G(ORDIALOG($$PTR("ORDERABLE ITEM"),INST))
"RTN","ORCDVBEC",83,0)
 S X=+$P($G(^ORD(101.43,OI,0)),U,2)
"RTN","ORCDVBEC",84,0)
 S ORDIALOG(PROMPT,INST)=$G(ORVB(X,"SPECIMEN"))_U_$G(ORVB("SPECIMEN"))
"RTN","ORCDVBEC",85,0)
 Q
"RTN","ORCDVBEC",86,0)
 ;
"RTN","ORCDVBEC",87,0)
EXOI ; -- setup dialog parameters for selected items
"RTN","ORCDVBEC",88,0)
 N ORI,X,X0,TEST,COMP
"RTN","ORCDVBEC",89,0)
 S (ORTAS,TEST,COMP)="" K ORASK
"RTN","ORCDVBEC",90,0)
 S ORI=0 F  S ORI=$O(ORDIALOG(PROMPT,ORI)) Q:ORI<1  D
"RTN","ORCDVBEC",91,0)
 . S X=+$G(ORDIALOG(PROMPT,ORI)),X0=$G(^ORD(101.43,X,"VB")),X=+$P($G(^(0)),U,2)
"RTN","ORCDVBEC",92,0)
 . I $P(X0,U) S COMP=COMP_$S($L(COMP):U,1:"")_X Q
"RTN","ORCDVBEC",93,0)
 . S TEST=TEST_$S($L(TEST):U,1:"")_X S:$P(X0,U,2)>1 ORTAS=1
"RTN","ORCDVBEC",94,0)
 I ORTEST'=TEST S ORTEST=TEST K ORTEST("Lab CollSamp")
"RTN","ORCDVBEC",95,0)
 I ORCOMP'=COMP S ORCOMP=COMP D CHANGED:'FIRST,COMP:COMP
"RTN","ORCDVBEC",96,0)
 I ORCOMP,U[$G(ORVB("ABORH")),'ORTAS,$G(ORTYPE)'="Z" D ADDTAS
"RTN","ORCDVBEC",97,0)
 Q
"RTN","ORCDVBEC",98,0)
 ;
"RTN","ORCDVBEC",99,0)
COMP ; -- Handle component-specific tasks [from EXOI]
"RTN","ORCDVBEC",100,0)
 ;    Uses ORCOMP, ORVB(comp)
"RTN","ORCDVBEC",101,0)
 Q:$G(ORTYPE)="Z"  ;QO editor
"RTN","ORCDVBEC",102,0)
 N ORP,ORI,ORT,ORTST,ORTMP,ORTDT,ORZ,ORHDR,OROOT,N
"RTN","ORCDVBEC",103,0)
 F ORI=1:1:$L(ORCOMP,U) S ORC=$P(ORCOMP,U,ORI) D
"RTN","ORCDVBEC",104,0)
 . S N=0 F  S N=$O(ORVB(ORC,"TEST",N)) Q:N<1  S ORT=+$G(ORVB(ORC,"TEST",N)),ORTST(ORT)=""
"RTN","ORCDVBEC",105,0)
 . I $G(ORVB(ORC,"SPECIMEN")),$P($G(ORVB("SPECIMEN")),U,2)="",'ORTAS D ADDTAS
"RTN","ORCDVBEC",106,0)
C1 S ORP=$$PTR("RESULTS"),(ORI,ORT)=0 F  S ORT=+$O(ORTST(ORT)) Q:ORT<1  D
"RTN","ORCDVBEC",107,0)
 . K ^TMP("LRRR",$J) D RR^LR7OR1(+ORVP,,,,,ORT,,1)
"RTN","ORCDVBEC",108,0)
 . S ORTMP="^TMP(""LRRR"",$J,+ORVP)",ORTMP=$Q(@ORTMP)
"RTN","ORCDVBEC",109,0)
 . Q:$P(ORTMP,",",1,3)'=("^TMP(""LRRR"","_$J_","_+ORVP)
"RTN","ORCDVBEC",110,0)
 . S ORTDT=9999999-+$P(ORTMP,",",5),ORZ=@ORTMP
"RTN","ORCDVBEC",111,0)
 . S ORI=ORI+1,ORDIALOG(ORP,ORI)=$P(ORZ,U,1,6)_U_ORTDT
"RTN","ORCDVBEC",112,0)
 . W:'$G(ORHDR) !!,"RECENT LAB RESULTS:",!,"Test       Result    Units      Range     Collected       Accession     Sts"
"RTN","ORCDVBEC",113,0)
 . W:'$G(ORHDR) !,"----       ------    -----      -----     ---------       ---------     ---"
"RTN","ORCDVBEC",114,0)
 . W !,$$PAD^ORCHTAB($P(ORZ,U,15),8)_$J($P(ORZ,U,2),9)_" "_$$PAD^ORCHTAB($P(ORZ,U,3),3)_$$PAD^ORCHTAB($P(ORZ,U,4),11)_$$PAD^ORCHTAB($P(ORZ,U,5),10)_$$DATETIME^ORCHTAB(ORTDT)_"  "_$$PAD^ORCHTAB($P(ORZ,U,16),15)_$P(ORZ,U,6)
"RTN","ORCDVBEC",115,0)
 . S ORHDR=1,OROOT=$P(ORTMP,",",1,5)_",""N""" ;ck for comments
"RTN","ORCDVBEC",116,0)
 . F  S ORTMP=$Q(@ORTMP) Q:$P(ORTMP,",",1,6)'=OROOT  W !," "_@ORTMP
"RTN","ORCDVBEC",117,0)
 W:$G(ORHDR) ! K ^TMP("LRRR",$J)
"RTN","ORCDVBEC",118,0)
 W !!,"NOTE: The nursing blood administration order must be entered separately."
"RTN","ORCDVBEC",119,0)
 Q
"RTN","ORCDVBEC",120,0)
 ;
"RTN","ORCDVBEC",121,0)
ADDTAS ; -- adds T&S to order, sets ORTAS=1
"RTN","ORCDVBEC",122,0)
 ;    Expects PROMPT=OI, ORTEST
"RTN","ORCDVBEC",123,0)
 N ORI S ORI=$O(ORDIALOG(PROMPT,"?"),-1),ORI=ORI+1
"RTN","ORCDVBEC",124,0)
 S ORDIALOG(PROMPT,ORI)=+$O(^ORD(101.43,"ID","1;99VBC",0))
"RTN","ORCDVBEC",125,0)
 W !!,"Type & Screen added for new specimen."
"RTN","ORCDVBEC",126,0)
 S ORTAS=1,ORTEST=$G(ORTEST)_$S($L($G(ORTEST)):U,1:"")_"1"
"RTN","ORCDVBEC",127,0)
 Q
"RTN","ORCDVBEC",128,0)
 ;
"RTN","ORCDVBEC",129,0)
CHANGED ; -- Kill dependent values when Component changes
"RTN","ORCDVBEC",130,0)
 N PTR,I,J
"RTN","ORCDVBEC",131,0)
 F I="FREE TEXT","RESULTS" S PTR=$$PTR(I) I PTR D
"RTN","ORCDVBEC",132,0)
 . S J=0 F  S J=$O(ORDIALOG(PTR,J)) Q:J<1  K ORDIALOG(PTR,J)
"RTN","ORCDVBEC",133,0)
 . K ORDIALOG(PTR,"LIST")
"RTN","ORCDVBEC",134,0)
 Q
"RTN","ORCDVBEC",135,0)
 ;
"RTN","ORCDVBEC",136,0)
DTW ; -- Comp D/T Wanted to specimen exp d/t for TAS [DTW Exit Action]
"RTN","ORCDVBEC",137,0)
 Q:$G(ORTAS)  Q:'$G(ORVB("SPECIMEN"))  Q:$G(ORTYPE)="Z"
"RTN","ORCDVBEC",138,0)
 N X,Y,%DT,EXP
"RTN","ORCDVBEC",139,0)
 S X=$G(ORDIALOG(PROMPT,INST)),%DT="T" D ^%DT Q:Y<1
"RTN","ORCDVBEC",140,0)
 S EXP=$$HL7TFM^XLFDT(+$G(ORVB("SPECIMEN")))
"RTN","ORCDVBEC",141,0)
 I EXP<Y D ADDTAS
"RTN","ORCDVBEC",142,0)
 Q
"RTN","ORCDVBEC",143,0)
 ;
"RTN","ORCDVBEC",144,0)
REASON ; -- get allowable reasons
"RTN","ORCDVBEC",145,0)
 Q:$G(ORDIALOG(PROMPT,"LIST"))  N ORX,I,X
"RTN","ORCDVBEC",146,0)
 D GETLST^XPAR(.ORX,"ALL","OR VBECS REASON FOR REQUEST","Q")
"RTN","ORCDVBEC",147,0)
 S I=0 F  S I=$O(ORX(I)) Q:I<1  D
"RTN","ORCDVBEC",148,0)
 . S X=$P($G(ORX(I)),U,2) Q:'$L(X)
"RTN","ORCDVBEC",149,0)
 . S ORDIALOG(PROMPT,"LIST",I)=X_U_X
"RTN","ORCDVBEC",150,0)
 . S ORDIALOG(PROMPT,"LIST","B",$$UP^XLFSTR(X))=X
"RTN","ORCDVBEC",151,0)
 S:ORX ORDIALOG(PROMPT,"LIST")=ORX ;_"^1"
"RTN","ORCDVBEC",152,0)
 Q
"RTN","ORCDVBEC",153,0)
 ;
"RTN","ORCDVBEC",154,0)
ENTYPE ; -- set up Coll Type
"RTN","ORCDVBEC",155,0)
 I '$D(ORTEST("Lab CollSamp")) D
"RTN","ORCDVBEC",156,0)
 . N I,V,T,LC S LC=1
"RTN","ORCDVBEC",157,0)
 . F I=1:1:$L(ORTEST,U) S V=+$P(ORTEST,U,I) D  Q:'LC  ;no LC samp
"RTN","ORCDVBEC",158,0)
 .. S T=$$LAB60(V) ;VBECS ID -> #60 ien
"RTN","ORCDVBEC",159,0)
 .. I '$P($G(^LAB(60,T,0)),U,9) S LC=0 Q
"RTN","ORCDVBEC",160,0)
 . S ORTEST("Lab CollSamp")=LC
"RTN","ORCDVBEC",161,0)
 I '$D(ORTIME),'$D(ORIMTIME) D GETIMES^ORCDLR1
"RTN","ORCDVBEC",162,0)
 Q
"RTN","ORCDVBEC",163,0)
 ;
"RTN","ORCDVBEC",164,0)
LAB60(X) ; -- Return file 60 ien for VBECS OI ID
"RTN","ORCDVBEC",165,0)
 N Y,I,NM
"RTN","ORCDVBEC",166,0)
 S I=$O(^ORD(101.43,"ID",+X_";99VBC",0)),NM=$P($G(^ORD(101.43,+I,0)),U)_" - LAB"
"RTN","ORCDVBEC",167,0)
 S Y=+$O(^LAB(60,"B",NM,0))
"RTN","ORCDVBEC",168,0)
 Q Y
"RTN","ORCDVBEC",169,0)
 ;
"RTN","ORCDVBEC",170,0)
ENSURG ; -- Get list of surgeries from ORVB("SURGERY")
"RTN","ORCDVBEC",171,0)
 S:$P($G(^ORD(101.42,+$$VAL^ORCD("URGENCY"),0)),U,2)="P" REQD=1
"RTN","ORCDVBEC",172,0)
 Q:$G(ORDIALOG(PROMPT,"LIST"))  N I,CNT,X S (I,CNT)=0
"RTN","ORCDVBEC",173,0)
 F  S I=$O(ORVB("SURGERY",I)) Q:I'>0  S X=$G(ORVB("SURGERY",I)) D
"RTN","ORCDVBEC",174,0)
 . S CNT=CNT+1,ORDIALOG(PROMPT,"LIST",CNT)=X_U_X
"RTN","ORCDVBEC",175,0)
 . S ORDIALOG(PROMPT,"LIST","B",$$UP^XLFSTR(X))=X
"RTN","ORCDVBEC",176,0)
 S:CNT ORDIALOG(PROMPT,"LIST")=CNT_"^1"
"RTN","ORCDVBEC",177,0)
 Q
"RTN","ORCDVBEC",178,0)
 ;
"RTN","ORCDVBEC",179,0)
CKMSBOS ; -- check if MSBOS limit exists, was exceeded [from PSA]
"RTN","ORCDVBEC",180,0)
 Q:'$L($G(Y))  N OI,AMT,I,X,COMP,LIMIT
"RTN","ORCDVBEC",181,0)
 S OI=$$PTR("ORDERABLE ITEM"),AMT=$$PTR("AMOUNT")
"RTN","ORCDVBEC",182,0)
 S I=0 F  S I=$O(ORDIALOG(OI,I)) Q:I<1  D
"RTN","ORCDVBEC",183,0)
 . S X=ORDIALOG(OI,I),COMP=+$P($G(^ORD(101.43,+X,0)),U,2)
"RTN","ORCDVBEC",184,0)
 . S LIMIT=$G(ORMSBOS(COMP,$P(Y,U))) Q:LIMIT=""
"RTN","ORCDVBEC",185,0)
 . Q:$G(ORDIALOG(AMT,I))'>LIMIT
"RTN","ORCDVBEC",186,0)
 . W !,"  >> Requested #units of "_$P($G(^ORD(101.43,+X,0)),U)_" exceeds MSBOS limit of "_LIMIT_"!",!
"RTN","ORCDVBEC",187,0)
 Q
"RTN","ORCDVBEC",188,0)
 ;
"RTN","ORCDVBEC",189,0)
ENURG ; -- Get list of urgencies from #101.42, parameter
"RTN","ORCDVBEC",190,0)
 Q:$G(ORDIALOG(PROMPT,"LIST"))  N I,CNT,X S CNT=0
"RTN","ORCDVBEC",191,0)
 S X="" F  S X=$O(^ORD(101.42,"S.VBEC",X)) Q:X=""  D
"RTN","ORCDVBEC",192,0)
 . ;I X="STAT" Q:'$$GET^XPAR("ALL","OR VBECS STAT USER")
"RTN","ORCDVBEC",193,0)
 . ;I X="STAT",'$D(^XUSEC("ORES",DUZ)),'$D(^XUSEC("ORELSE",DUZ)) Q
"RTN","ORCDVBEC",194,0)
 . S I=0 F  S I=$O(^ORD(101.42,"S.VBEC",X,I)) Q:I<1  D
"RTN","ORCDVBEC",195,0)
 .. S CNT=CNT+1,ORDIALOG(PROMPT,"LIST",CNT)=I_U_X
"RTN","ORCDVBEC",196,0)
 .. S ORDIALOG(PROMPT,"LIST","B",$$UP^XLFSTR(X))=I
"RTN","ORCDVBEC",197,0)
 S:CNT ORDIALOG(PROMPT,"LIST")=CNT_"^1"
"RTN","ORCDVBEC",198,0)
 Q
"RTN","ORCDVBEC",199,0)
 ;
"RTN","ORCDVBEC",200,0)
ASKURG() ; -- ask unless PreOp, set default
"RTN","ORCDVBEC",201,0)
 N Y S Y=1
"RTN","ORCDVBEC",202,0)
 I FIRST,'$D(ORDIALOG(PROMPT,INST)),$G(ORTYPE)'="Z" D
"RTN","ORCDVBEC",203,0)
 . I $$PREOP S ORDIALOG(PROMPT,INST)=+$O(^ORD(101.42,"C","P",0)),Y=0 Q
"RTN","ORCDVBEC",204,0)
 . S ORDIALOG(PROMPT,INST)=9 ;default
"RTN","ORCDVBEC",205,0)
 Q Y
"RTN","ORCDVBEC",206,0)
 ;
"RTN","ORCDVBEC",207,0)
PREOP() ; -- Returns 1 or 0, if order is for pre-op
"RTN","ORCDVBEC",208,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","ORCDVBEC",209,0)
 S DIR(0)="YAO",DIR("A")="Is this order for pre-op? "
"RTN","ORCDVBEC",210,0)
 S DIR("?")="If YES, the urgency will be set to PRE-OP and a surgery name will be required"
"RTN","ORCDVBEC",211,0)
 S DIR("B")="NO" D ^DIR S:$D(DTOUT)!($D(DUOUT)) ORQUIT=1
"RTN","ORCDVBEC",212,0)
 Q +Y
"RTN","ORCSEND2")
0^3^B33504777
"RTN","ORCSEND2",1,0)
ORCSEND2 ;SLC/MKB - Release cont ;2/11/08  11:04
"RTN","ORCSEND2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**212**;Dec 17, 1997;Build 24
"RTN","ORCSEND2",3,0)
 ;
"RTN","ORCSEND2",4,0)
PTR(NAME) ; -- Returns ptr value of prompt in Dialog file
"RTN","ORCSEND2",5,0)
 Q +$O(^ORD(101.41,"AB","OR GTX "_NAME,0))
"RTN","ORCSEND2",6,0)
 ;
"RTN","ORCSEND2",7,0)
EN ; -- Spawn child orders from ORIFN, send to VBECS [from VBEC^ORCSEND1]
"RTN","ORCSEND2",8,0)
 N ORPARENT,OR0,ORDIALOG,ORNP,ORDUZ,ORLOG,ORCAT,ORTS,ORDG,ORPKG,ORPRINT
"RTN","ORCSEND2",9,0)
 N ORESP,ORTIME,ORSTRT,ORI,ORIT,ORITX,ORFLDS,ORP,P,ORCHLD,ORLAST,X,STS,ORLAB,ORLRIFN
"RTN","ORCSEND2",10,0)
 N ORPITEM,ORPRBCM,ORPUNIT,ORPDTW,ORPREAS,ORPMSBS,ORPINFC,ORPURG,ORPTYPE,ORPCOLL,ORPCOMM,ORPRSLT,ORPSPEC,ORPLAB
"RTN","ORCSEND2",11,0)
 S ORPARENT=+ORIFN,OR0=$G(^OR(100,ORIFN,0))
"RTN","ORCSEND2",12,0)
 S ORDIALOG=+$P(OR0,U,5),ORNP=+$P(OR0,U,4),ORDUZ=+$P(OR0,U,6)
"RTN","ORCSEND2",13,0)
 S ORLOG=$P(OR0,U,7),ORCAT=$P(OR0,U,12),ORTS=$P(OR0,U,13)
"RTN","ORCSEND2",14,0)
 S ORDG=+$P(OR0,U,11),ORPKG=$P(OR0,U,14),ORPRINT=0
"RTN","ORCSEND2",15,0)
 D GETDLG1^ORCD(ORDIALOG),GETORDER^ORCD(ORIFN,"ORESP"),GETIMES^ORCDLR1
"RTN","ORCSEND2",16,0)
 M ^TMP($J,"ORVBDLG")=ORDIALOG S ORPITEM=$$PTR("ORDERABLE ITEM")
"RTN","ORCSEND2",17,0)
 S ORPRBCM=$$PTR("RBC MODIFIERS"),ORPUNIT=$$PTR("AMOUNT")
"RTN","ORCSEND2",18,0)
 S ORPDTW=$$PTR("DATE/TIME"),ORPREAS=$$PTR("REASON")
"RTN","ORCSEND2",19,0)
 S ORPMSBS=$$PTR("TEXT"),ORPINFC=$$PTR("YES/NO")
"RTN","ORCSEND2",20,0)
 S ORPTYPE=$$PTR("COLLECTION TYPE"),ORPCOLL=$$PTR("START DATE/TIME")
"RTN","ORCSEND2",21,0)
 S ORPURG=$$PTR("URGENCY"),ORPCOMM=$$PTR("FREE TEXT 1")
"RTN","ORCSEND2",22,0)
 S ORPSPEC=$$PTR("SPECIMEN STATUS"),ORPRSLT=$$PTR("RESULTS")
"RTN","ORCSEND2",23,0)
 S ORPLAB=$$PTR("LAB ORDER") D START ;resolve ORSTRT dates
"RTN","ORCSEND2",24,0)
EN1 S ORI=0 F  S ORI=$O(ORESP(ORPITEM,ORI)) Q:ORI<1  D  Q:$G(ORERR)
"RTN","ORCSEND2",25,0)
 . N ORL S ORL=$P(OR0,U,10) ;protect ORL from calling routine
"RTN","ORCSEND2",26,0)
 . S ORIT=+$G(ORESP(ORPITEM,ORI)),ORITX=$G(^ORD(101.43,ORIT,"VB"))
"RTN","ORCSEND2",27,0)
 . D LABTST I $G(ORERR) D CANCEL(ORPARENT,$P(ORERR,U,2)) Q
"RTN","ORCSEND2",28,0)
 . K ORDIALOG M ORDIALOG=^TMP($J,"ORVBDLG") S ORDIALOG(ORPITEM,1)=ORIT
"RTN","ORCSEND2",29,0)
 . S ORFLDS=$S(ORITX:"ORPRBCM^ORPUNIT^ORPSPEC^ORPDTW^ORPREAS^ORPMSBS^ORPINFC",$P(ORITX,U,2)=1:"ORPDTW^ORPTYPE^ORPCOLL",$P(ORITX,U,2)=2:"ORPDTW^ORPREAS^ORPMSBS^ORPINFC^ORPTYPE^ORPCOLL",1:"")_"^ORPURG^ORPCOMM"
"RTN","ORCSEND2",30,0)
 . F ORP=1:1:$L(ORFLDS,U) S P=$P(ORFLDS,U,ORP) Q:'$L(P)  S ORDIALOG(@P,1)=$S($D(ORESP(@P,ORI)):ORESP(@P,ORI),1:$G(ORESP(@P,1))) ;set values
"RTN","ORCSEND2",31,0)
 . S:$G(ORLRIFN) ORDIALOG(ORPLAB,1)=ORLRIFN
"RTN","ORCSEND2",32,0)
 . K ORIFN,ORIT D EN^ORCSAVE
"RTN","ORCSEND2",33,0)
 . I '$G(ORIFN) S ORERR="1^Unable to create order" Q
"RTN","ORCSEND2",34,0)
 . S X=ORSTRT($S(ORITX:"DTW",1:"COLL")) D DATES^ORCSAVE2(ORIFN,X)
"RTN","ORCSEND2",35,0)
 . D RELEASE^ORCSAVE2(ORIFN,1,ORNOW,DUZ,$G(NATURE)),LINK
"RTN","ORCSEND2",36,0)
 . D NW^ORMBLDVB(ORIFN)
"RTN","ORCSEND2",37,0)
 S:$G(ORCHLD) ^OR(100,ORPARENT,2,0)="^100.002PA^"_ORLAST_U_ORCHLD
"RTN","ORCSEND2",38,0)
 D RELEASE^ORCSAVE2(ORPARENT,1,ORNOW,DUZ,$G(NATURE))
"RTN","ORCSEND2",39,0)
 ;D STATUS^ORCSAVE2(ORPARENT,5) ;testing
"RTN","ORCSEND2",40,0)
 S ORIFN=ORPARENT,ORQUIT=1,STS=$P(^OR(100,ORIFN,3),U,3)
"RTN","ORCSEND2",41,0)
EN2 I STS'=11,STS'=13 D  ;successful
"RTN","ORCSEND2",42,0)
 . D RESULTS^ORMBLDVB(ORPARENT)
"RTN","ORCSEND2",43,0)
 . Q:'$O(ORPRINT(0))  N PAT,LOC,NATR
"RTN","ORCSEND2",44,0)
 . S PAT=$P(OR0,U,2),LOC=$S($G(ORL):ORL,1:$P(OR0,U,10))
"RTN","ORCSEND2",45,0)
 . S NATR=$$WORK^ORCSIGN($G(NATURE))
"RTN","ORCSEND2",46,0)
 . D PRINT^ORPR02(PAT,.ORPRINT,,LOC,"0^1^1^1^"_NATR) ;labels/req's
"RTN","ORCSEND2",47,0)
 I $$UNRL(ORPARENT) S ORERR="1^Unable to release order due to an HL7 network error: queued for delivery to VBECS"
"RTN","ORCSEND2",48,0)
 I STS=13 S ORERR="1^This order was rejected by VBECS and will NOT be acted upon: see the Order Details for more information and contact the Blood Bank for assistance!"
"RTN","ORCSEND2",49,0)
 K ^TMP($J,"ORVBDLG"),^TMP($J,"ORLRDLG")
"RTN","ORCSEND2",50,0)
 Q
"RTN","ORCSEND2",51,0)
 ;
"RTN","ORCSEND2",52,0)
UNRL(DAD) ; -- ck for any unreleased child orders
"RTN","ORCSEND2",53,0)
 N Y,I,STS S Y=0
"RTN","ORCSEND2",54,0)
 S I=0 F  S I=+$O(^OR(100,+$G(DAD),2,I)) Q:I<1  D  Q:Y
"RTN","ORCSEND2",55,0)
 . S STS=$P($G(^OR(100,I,3)),U,3)
"RTN","ORCSEND2",56,0)
 . I STS=10!(STS=11) S Y=1 Q
"RTN","ORCSEND2",57,0)
 Q Y
"RTN","ORCSEND2",58,0)
 ;
"RTN","ORCSEND2",59,0)
START ; -- Define ORSTRT(), set Start Date in ORPARENT
"RTN","ORCSEND2",60,0)
 N X,Y,%DT,STRT S ORSTRT("COLL")="",ORSTRT("DTW")="",%DT="TX",STRT=""
"RTN","ORCSEND2",61,0)
 S X=$G(ORESP(ORPDTW,1)) I $L(X) D ^%DT S:Y>0 ORSTRT("DTW")=Y,STRT=Y
"RTN","ORCSEND2",62,0)
 S X=$G(ORESP(ORPCOLL,1)) I $L(X) D
"RTN","ORCSEND2",63,0)
 . D AM^ORCSAVE2:X="AM",NEXT^ORCSAVE2:X="NEXT" ;return X
"RTN","ORCSEND2",64,0)
 . D ^%DT S:Y>0 ORSTRT("COLL")=Y,STRT=Y
"RTN","ORCSEND2",65,0)
 I '$P(OR0,U,8) D DATES^ORCSAVE2(+ORIFN,STRT)
"RTN","ORCSEND2",66,0)
 Q
"RTN","ORCSEND2",67,0)
 ;
"RTN","ORCSEND2",68,0)
LINK ; -- set up ORPARENT/ORIFN links, ORLAST in ORCHLD()
"RTN","ORCSEND2",69,0)
 ;    Uses ORVP,ORLOG in xref
"RTN","ORCSEND2",70,0)
 S ORCHLD=+$G(ORCHLD)+1,^OR(100,ORPARENT,2,ORIFN,0)=ORIFN,ORLAST=ORIFN
"RTN","ORCSEND2",71,0)
 S $P(^OR(100,ORIFN,3),U,8,9)="1^"_ORPARENT
"RTN","ORCSEND2",72,0)
 S $P(^OR(100,ORIFN,8,1,0),U,4)=8 K ^OR(100,"AS",ORVP,9999999-ORLOG,ORIFN,1) ;signature on parent only
"RTN","ORCSEND2",73,0)
 Q
"RTN","ORCSEND2",74,0)
 ;
"RTN","ORCSEND2",75,0)
LABTST ; -- Create Lab order for VBECS blood component or test
"RTN","ORCSEND2",76,0)
 ;    Expects var's from above, Returns ORLAB & ORLRIFN
"RTN","ORCSEND2",77,0)
 N ORDIALOG,ORDG,ORPKG,ORIFN,X,P,LRT K ORLAB,ORLRIFN
"RTN","ORCSEND2",78,0)
 I $G(^TMP($J,"ORLRDLG")) M ORDIALOG=^TMP($J,"ORLRDLG")
"RTN","ORCSEND2",79,0)
 E  D  ;build for now, later reuse
"RTN","ORCSEND2",80,0)
 . S ORDIALOG=+$O(^ORD(101.41,"AB","LR OTHER LAB TESTS",0))
"RTN","ORCSEND2",81,0)
 . D GETDLG1^ORCD(ORDIALOG) M ^TMP($J,"ORLRDLG")=ORDIALOG
"RTN","ORCSEND2",82,0)
 S ORDG=+$O(^ORD(100.98,"B","BB",0)),X=$P($G(^ORD(101.43,ORIT,0)),U,8)
"RTN","ORCSEND2",83,0)
 S X=+$$TEST(X) I X<1 S ORERR="1^Missing or invalid Lab workload test" Q
"RTN","ORCSEND2",84,0)
 S ORDIALOG(ORPITEM,1)=X,LRT=+$P($G(^ORD(101.43,X,0)),U,2)
"RTN","ORCSEND2",85,0)
 S ORDIALOG(ORPTYPE,1)=$S($D(ORESP(ORPTYPE,1)):ORESP(ORPTYPE,1),1:"SP")
"RTN","ORCSEND2",86,0)
 S ORDIALOG(ORPCOLL,1)=$S($D(ORESP(ORPCOLL,1)):ORESP(ORPCOLL,1),1:$G(ORESP(ORPDTW,1)))
"RTN","ORCSEND2",87,0)
LT1 ; VALIDATE??
"RTN","ORCSEND2",88,0)
 S X=+$O(^LAB(60,LRT,3,0)),X=+$G(^(X,0)) ;default/unique sample
"RTN","ORCSEND2",89,0)
 S ORDIALOG($$PTR("COLLECTION SAMPLE"),1)=X
"RTN","ORCSEND2",90,0)
 S:'ORITX ORDIALOG($$PTR("SPECIMEN"),1)=$P($G(^LAB(62,X,0)),U,2)
"RTN","ORCSEND2",91,0)
 S X=+$G(ORESP(ORPURG,1)),X=$P($G(^ORD(101.42,X,0)),U)
"RTN","ORCSEND2",92,0)
 S X=$S($L(X):+$O(^LAB(62.05,"B",X,0)),1:9) S:'X X=9
"RTN","ORCSEND2",93,0)
 S ORDIALOG($$PTR("LAB URGENCY"),1)=X
"RTN","ORCSEND2",94,0)
 D EN^ORCSAVE I '$G(ORIFN) S ORERR="1^Unable to create lab order" Q
"RTN","ORCSEND2",95,0)
 S X=$S($D(ORSTRT("COLL")):ORSTRT("COLL"),1:$G(ORSTRT("DTW")))
"RTN","ORCSEND2",96,0)
 D DATES^ORCSAVE2(ORIFN,X),LINK
"RTN","ORCSEND2",97,0)
 D RELEASE^ORCSAVE2(ORIFN,1,ORNOW,DUZ,$G(NATURE)),NEW^ORMBLD(ORIFN)
"RTN","ORCSEND2",98,0)
 S ORLAB=$G(^OR(100,ORIFN,4))_";"_$G(LRT),ORLRIFN=ORIFN ;for VBECS msg
"RTN","ORCSEND2",99,0)
 I '$G(ORLAB) S ORERR="1^"_$$WHY^ORCSEND(ORIFN,1) Q
"RTN","ORCSEND2",100,0)
 S ORPRINT=+$G(ORPRINT)+1,ORPRINT(ORPRINT)=ORIFN_";1"
"RTN","ORCSEND2",101,0)
 ;D STATUS^ORCSAVE2(ORIFN,5) S ORLAB="ORLAB" ;for testing
"RTN","ORCSEND2",102,0)
 ;N ORZTEST S ORZTEST=1 D NEW^ORMBLD(ORIFN) ZW ORZTEST
"RTN","ORCSEND2",103,0)
 Q
"RTN","ORCSEND2",104,0)
 ;
"RTN","ORCSEND2",105,0)
TEST(X) ; -- find corresponding Lab test for VBECS item X, in #101.43
"RTN","ORCSEND2",106,0)
 N NM,I,Y S NM=X_" - LAB",Y=0
"RTN","ORCSEND2",107,0)
 S I=0 F  S I=+$O(^ORD(101.43,"B",$E(NM,1,30),I)) Q:I<1  I $P($G(^ORD(101.43,I,0)),U,8)=NM S Y=I Q
"RTN","ORCSEND2",108,0)
 Q Y
"RTN","ORCSEND2",109,0)
 ;
"RTN","ORCSEND2",110,0)
CANCEL(ORDAD,OREASON) ; -- Cancel parent order
"RTN","ORCSEND2",111,0)
 Q:'$G(ORDAD)  N NATR,NOW,ORCHLD
"RTN","ORCSEND2",112,0)
 S ORCHLD=0 F  S ORCHLD=+$O(^OR(100,ORDAD,2,ORCHLD)) Q:ORCHLD<1  D
"RTN","ORCSEND2",113,0)
 . Q:"^1^2^13^"[(U_$P($G(^OR(100,ORCHLD,3)),U,3)_U)  ;already done
"RTN","ORCSEND2",114,0)
 . D MSG^ORMBLD(ORCHLD,"CA",OREASON)
"RTN","ORCSEND2",115,0)
 S NATR=+$O(^ORD(100.02,"C","X",0)),NOW=+$E($$NOW^XLFDT,1,12)
"RTN","ORCSEND2",116,0)
 S ^OR(100,ORDAD,6)=NATR_U_U_NOW_U_U_$G(OREASON),$P(^(8,1,0),U,15)=13 S:$L($G(OREASON)) ^(1)=OREASON
"RTN","ORCSEND2",117,0)
 D STATUS^ORCSAVE2(ORDAD,13) ;cancel
"RTN","ORCSEND2",118,0)
 Q
"RTN","ORMBLDVB")
0^4^B42436603
"RTN","ORMBLDVB",1,0)
ORMBLDVB ;SLC/MKB - Build outgoing Blood Bank ORM msgs ;2/11/08  11:04
"RTN","ORMBLDVB",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**212**;Dec 17, 1997;Build 24
"RTN","ORMBLDVB",3,0)
 ;
"RTN","ORMBLDVB",4,0)
 ; Use of $$GETICN^MPIF001 supported by DBIA #2701
"RTN","ORMBLDVB",5,0)
 ;
"RTN","ORMBLDVB",6,0)
HL7DATE(DATE) ; -- FM -> HL7 format
"RTN","ORMBLDVB",7,0)
 Q $$FMTHL7^XLFDT(DATE)
"RTN","ORMBLDVB",8,0)
 ;
"RTN","ORMBLDVB",9,0)
NW(ORIFN) ; -- Send new VBECS orders [from ORCSEND2]
"RTN","ORMBLDVB",10,0)
 ;    Uses ORNOW if defined
"RTN","ORMBLDVB",11,0)
 N HLA,HL,OR0,OR3,ORR,ORDT,ORVAL,ORI,OROK,HLMTIEN
"RTN","ORMBLDVB",12,0)
 S OR0=$G(^OR(100,ORIFN,0)),OR3=$G(^(3))
"RTN","ORMBLDVB",13,0)
 D INIT^HLFNC2("OR OMG SERVER",.HL),GETVALS(ORIFN)
"RTN","ORMBLDVB",14,0)
 S ORDT=$S($G(ORNOW):ORNOW,1:+$E($$NOW^XLFDT,1,12))
"RTN","ORMBLDVB",15,0)
 S ORR=$G(ORVAL("REASON")),ORDT=$$HL7DATE(ORDT)
"RTN","ORMBLDVB",16,0)
 ;S ORMSH="MSH|^~\&|ORDER ENTRY|"_$G(DUZ(2))_"|VBECS|"_$G(DUZ(2))_"|"_ORDT_"||OMG^O19||P|2.4||||AL" ;for testing
"RTN","ORMBLDVB",17,0)
 S HLA("HLS",1)=$$PID(+$P(OR0,U,2)),HLA("HLS",2)=$$PV1
"RTN","ORMBLDVB",18,0)
 S HLA("HLS",3)=$$ORC("NW","",ORR),HLA("HLS",4)=$$OBR(""),ORI=4
"RTN","ORMBLDVB",19,0)
 S:$L($G(ORVAL("COMMENT"))) HLA("HLS",5)=$$NTE,ORI=5
"RTN","ORMBLDVB",20,0)
 S ORI=ORI+1,HLA("HLS",ORI)=$$DG1(+$P(OR0,U,2))
"RTN","ORMBLDVB",21,0)
 ;W ! ZW HLA D STATUS^ORCSAVE2(ORIFN,5) ;for testing 
"RTN","ORMBLDVB",22,0)
 D DIRECT^HLMA("OR OMG SERVER","LM",1,.OROK)
"RTN","ORMBLDVB",23,0)
 I $P(OROK,U,2) D SNDERR($P(OROK,U,3)),GENERATE^HLMA("OR OMG SERVER","LM",1,.OROK) Q  ;queue
"RTN","ORMBLDVB",24,0)
 ; S ^OR(100,ORIFN,8,1,1)=$P(OROK,U,3),$P(^(0),U,15)=13 Q
"RTN","ORMBLDVB",25,0)
 I HLMTIEN D ACK^ORMVBEC(+ORIFN_";1") ;successful, process ACK message
"RTN","ORMBLDVB",26,0)
 Q
"RTN","ORMBLDVB",27,0)
 ;
"RTN","ORMBLDVB",28,0)
GETVALS(IFN) ; -- Return ORVAL(ID)=value for child order IFN
"RTN","ORMBLDVB",29,0)
 N ID,ITM S ID="" K ORVAL
"RTN","ORMBLDVB",30,0)
 F  S ID=$O(^OR(100,IFN,4.5,"ID",ID)) Q:ID=""  S ITM=$O(^(ID,0)),ORVAL(ID)=$G(^OR(100,IFN,4.5,ITM,1))
"RTN","ORMBLDVB",31,0)
 Q
"RTN","ORMBLDVB",32,0)
 ;
"RTN","ORMBLDVB",33,0)
RESULTS(ORDER) ; -- Send PR messages with Lab results [from EN]
"RTN","ORMBLDVB",34,0)
 ;    where ORDER = parent#
"RTN","ORMBLDVB",35,0)
 N ORP,ORI,ORTST,ORTMP,ORTDT,ORX,OROK,HLA
"RTN","ORMBLDVB",36,0)
 S ORDER=+$G(ORDER),OR0=$G(^OR(100,ORDER,0)),ORI=0
"RTN","ORMBLDVB",37,0)
 F  S ORI=$O(^OR(100,ORDER,4.5,"ID","RESULTS",ORI)) Q:ORI<1  D
"RTN","ORMBLDVB",38,0)
 . S ORX=$G(^OR(100,ORDER,4.5,ORI,1)),ORTDT=$P(ORX,U,7)
"RTN","ORMBLDVB",39,0)
 . S ORTST=+ORX_U_$P($G(^LAB(60,+ORX,0)),U) K HLA,OROK
"RTN","ORMBLDVB",40,0)
 . S HLA("HLS",1)=$$PID(+$P(OR0,U,2)),HLA("HLS",2)=$$PV1
"RTN","ORMBLDVB",41,0)
 . S HLA("HLS",3)="ORC|PR|||"_ORDER_"^OR"
"RTN","ORMBLDVB",42,0)
 . S HLA("HLS",4)="OBR||"_$P(ORX,U,17)_"^LRCH||"_ORTST_"^99LRT"
"RTN","ORMBLDVB",43,0)
 . S HLA("HLS",5)="OBX|1||"_ORTST_"^99LRT||"_$P(ORX,U,2)_"|"_$P(ORX,U,4)_"|"_$P(ORX,U,5)_"|"_$P(ORX,U,3)_"|||"_$P(ORX,U,6)_"|||"_$$HL7DATE(ORTDT)
"RTN","ORMBLDVB",44,0)
 . ;W ! ZW HLA ;for testing
"RTN","ORMBLDVB",45,0)
 . D DIRECT^HLMA("OR OMG SERVER","LM",1,.OROK) ;GENERATE
"RTN","ORMBLDVB",46,0)
 . I $P(OROK,U,2) D SNDERR($P(OROK,U,3)),GENERATE^HLMA("OR OMG SERVER","LM",1,.OROK) Q  ;queue
"RTN","ORMBLDVB",47,0)
 . 
"RTN","ORMBLDVB",48,0)
 Q
"RTN","ORMBLDVB",49,0)
 ;
"RTN","ORMBLDVB",50,0)
CA(ORDER,REASON) ; -- Cancel VBEC orders (ORDER=child)
"RTN","ORMBLDVB",51,0)
 ;    [from DC^ORCSEND/MSG^ORMBLD - Uses ORNOW if defined]
"RTN","ORMBLDVB",52,0)
 N ORIFN,ORDA,ORDT,OR0,OR3,PKGIFN,HL,HLA,ORVAL,OROK,HLMTIEN
"RTN","ORMBLDVB",53,0)
 S ORDT=$S($G(ORNOW):ORNOW,1:+$E($$NOW^XLFDT,1,12))
"RTN","ORMBLDVB",54,0)
 S ORIFN=+$G(ORDER),ORDA=+$P($G(ORDER),";",2),ORDT=$$HL7DATE(ORDT)
"RTN","ORMBLDVB",55,0)
 S OR0=$G(^OR(100,ORIFN,0)),OR3=$G(^(3)),PKGIFN=$G(^(4))_"^VBEC"
"RTN","ORMBLDVB",56,0)
 S REASON=$S($G(REASON):$P($G(^ORD(100.03,+REASON,0)),U),1:"")
"RTN","ORMBLDVB",57,0)
 D INIT^HLFNC2("OR OMG SERVER",.HL),GETVALS(ORIFN)
"RTN","ORMBLDVB",58,0)
 ;S ORMSH="MSH|^~\&|ORDER ENTRY|"_$G(DUZ(2))_"|VBECS|"_$G(DUZ(2))_"|"_ORDT_"||OMG^O19||P|2.4||||AL" ;for now
"RTN","ORMBLDVB",59,0)
 S HLA("HLS",1)=$$PID(+$P(OR0,U,2)),HLA("HLS",2)=$$PV1
"RTN","ORMBLDVB",60,0)
 S HLA("HLS",3)=$$ORC("CA",PKGIFN,REASON),HLA("HLS",4)=$$OBR(PKGIFN)
"RTN","ORMBLDVB",61,0)
 D DIRECT^HLMA("OR OMG SERVER","LM",1,.OROK) ;GENERATE^HLMA
"RTN","ORMBLDVB",62,0)
 I $P(OROK,U,2) D  Q
"RTN","ORMBLDVB",63,0)
 . S:ORDA ^OR(100,ORIFN,8,ORDA,1)=$P(OROK,U,3),$P(^(0),U,15)=13
"RTN","ORMBLDVB",64,0)
 . D SNDERR($P(OROK,U,3)),GENERATE^HLMA("OR OMG SERVER","LM",1,.OROK) Q
"RTN","ORMBLDVB",65,0)
 I HLMTIEN D ACK^ORMVBEC(ORDER) ;successful, process ACK message
"RTN","ORMBLDVB",66,0)
 Q
"RTN","ORMBLDVB",67,0)
 ;
"RTN","ORMBLDVB",68,0)
SNDERR(MSG) ; -- Send Error message to VBECS Mail Group
"RTN","ORMBLDVB",69,0)
 ; Input - MSG = Error message string
"RTN","ORMBLDVB",70,0)
 N OREMSG,XMSUB,XMTEXT,XMDUZ,XMY,XMZ
"RTN","ORMBLDVB",71,0)
 S OREMSG(1,0)="An Error occurred trying to send an HL7 message to VBECS."
"RTN","ORMBLDVB",72,0)
 S OREMSG(2,0)=" "
"RTN","ORMBLDVB",73,0)
 S OREMSG(3,0)="Error Message Text:  "_$S($L(MSG)>60:$E(MSG,1,60),1:MSG)
"RTN","ORMBLDVB",74,0)
 S XMY("G."_$P($$GETAPP^HLCS2("VBECS"),"^"))=""
"RTN","ORMBLDVB",75,0)
 S XMTEXT="OREMSG(",XMSUB="OERR-VBECS HL7 Failure",XMDUZ="OERR-VBECS Logical Link" D XMZ^XMA2
"RTN","ORMBLDVB",76,0)
 S DIE=3.9,DA=XMZ,DR="1.7////P" D ^DIE
"RTN","ORMBLDVB",77,0)
 D EN1^XMD
"RTN","ORMBLDVB",78,0)
 Q
"RTN","ORMBLDVB",79,0)
 ;
"RTN","ORMBLDVB",80,0)
PID(DFN) ; -- PID segment
"RTN","ORMBLDVB",81,0)
 N ORPT0,ORICN,NAME,DOB,Y S DFN=+$G(DFN)
"RTN","ORMBLDVB",82,0)
 S ORPT0=$G(^DPT(DFN,0))
"RTN","ORMBLDVB",83,0)
 S ORICN=$$GETICN^MPIF001(DFN) I +$G(ORICN)<1 S ORICN=""
"RTN","ORMBLDVB",84,0)
 S NAME=$$HLNAME^HLFNC($P(ORPT0,U),"^~\&"),DOB=$$HL7DATE($P(ORPT0,U,3))
"RTN","ORMBLDVB",85,0)
 S Y="PID|||"_ORICN_"^^^^NI~"_$P(ORPT0,U,9)_"^^^^SS~"_DFN_"^^^^PI||"_NAME_"||"_DOB_"|"_$P(ORPT0,U,2)
"RTN","ORMBLDVB",86,0)
 Q Y
"RTN","ORMBLDVB",87,0)
 ;
"RTN","ORMBLDVB",88,0)
PV1() ; -- PV1 segment (expects OR0)
"RTN","ORMBLDVB",89,0)
 N Y,DFN,LOC,TYPE,SPEC,RB,ATTD
"RTN","ORMBLDVB",90,0)
 S DFN=+$P(OR0,U,2),LOC=$P(OR0,U,10),TYPE=$P(OR0,U,12),SPEC=$P(OR0,U,13)
"RTN","ORMBLDVB",91,0)
 S LOC=$S(LOC:$P($G(^SC(+LOC,0)),U),1:""),RB=""
"RTN","ORMBLDVB",92,0)
 S:TYPE="I" RB=$P($G(^DPT(DFN,.101)),U)
"RTN","ORMBLDVB",93,0)
 S SPEC=$S(SPEC:"VA"_$$GET1^DIQ(45.7,SPEC_",",1,"I"),1:"") ;DBIA 1154
"RTN","ORMBLDVB",94,0)
 S ATTD=+$G(^DPT(DFN,.1041)) S:'ATTD ATTD="" I ATTD D      ;DBIA 10035
"RTN","ORMBLDVB",95,0)
 . N NM S NM=$P($G(^VA(200,ATTD,0)),U)
"RTN","ORMBLDVB",96,0)
 . S ATTD=ATTD_U_$$HLNAME^HLFNC(NM,"^~\&")
"RTN","ORMBLDVB",97,0)
 S Y="PV1||"_TYPE_"|"_LOC_$S($L(RB):U_RB,1:"")_"||||"_ATTD_"|||"_SPEC
"RTN","ORMBLDVB",98,0)
 Q Y
"RTN","ORMBLDVB",99,0)
 ;
"RTN","ORMBLDVB",100,0)
ORC(CODE,FILLER,REASON) ; -- ORC segment (expects OR0, OR3, ORDT)
"RTN","ORMBLDVB",101,0)
 N Y,USR,PROV,NM,ORI,DAD,YN,X13,PHONE
"RTN","ORMBLDVB",102,0)
 S USR=+$P(OR0,U,6),PROV=+$P(OR0,U,4),X13=$G(^VA(200,PROV,.13))
"RTN","ORMBLDVB",103,0)
 S PHONE=$S($L($P(X13,U,7)):$P(X13,U,7),1:$P(X13,U,8))
"RTN","ORMBLDVB",104,0)
 F ORI="USR","PROV" S NM=$P($G(^VA(200,@ORI,0)),U),@ORI=@ORI_U_$$HLNAME^HLFNC(NM,"^~\&")
"RTN","ORMBLDVB",105,0)
 S DAD=+$P(OR3,U,9) ;,DIV=$$DIV(+$P(OR0,U,10))
"RTN","ORMBLDVB",106,0)
 S Y="ORC|"_CODE_"|"_ORIFN_"^OR|"_$G(FILLER)_"|"_DAD_"^OR|||||"_ORDT_"|"_USR_"||"_PROV_"||"_PHONE_"||^"_$G(REASON)_"|"_$$DIV
"RTN","ORMBLDVB",107,0)
 S YN=$G(ORVAL("YN")),YN=$S(YN="":"",YN:"1^YES",YN=0:"0^NO",1:"U^UNKNOWN")
"RTN","ORMBLDVB",108,0)
 S Y=Y_"|||"_YN
"RTN","ORMBLDVB",109,0)
 Q Y
"RTN","ORMBLDVB",110,0)
 ;
"RTN","ORMBLDVB",111,0)
OBR(FILLER) ; -- OBR segment
"RTN","ORMBLDVB",112,0)
 N Y,OI,MOD,TYPE,X,SPCACT,SPCUID
"RTN","ORMBLDVB",113,0)
 S OI=$$USID(ORIFN),MOD=$G(ORVAL("MODIFIER"))
"RTN","ORMBLDVB",114,0)
 I $L(MOD) S MOD=$S(MOD="W":"WASHED",MOD="I":"IRRADIATED",MOD="L":"LEUKO-POOR",MOD="V":"VOLUME-REDUCED",MOD="D":"DIVIDED",MOD="E":"LEUKO-POOR/IRRADIATED",1:MOD)
"RTN","ORMBLDVB",115,0)
 S TYPE=$G(ORVAL("COLLECT")),TYPE=$$TYPE(TYPE)
"RTN","ORMBLDVB",116,0)
 S X=$G(ORVAL("SPECSTS")),SPCACT=$S('X:"O",$L($P(X,U,3)):"A",1:"L")
"RTN","ORMBLDVB",117,0)
 S SPCUID=$S(SPCACT="A":$P(X,U,3),1:"")
"RTN","ORMBLDVB",118,0)
 S Y="OBR|1|"_ORIFN_"^OR|"_$G(FILLER)_"|"_OI_"^^"_MOD_"|||||||"_SPCACT_"||"_$G(ORLAB)_"||"_SPCUID_"^^"_TYPE_"||||||||||||"_$$QT
"RTN","ORMBLDVB",119,0)
 Q Y
"RTN","ORMBLDVB",120,0)
 ;
"RTN","ORMBLDVB",121,0)
USID(IFN) ; -- Return USID for order IFN
"RTN","ORMBLDVB",122,0)
 N OI,OI0,OID,OIX,Y S Y=""
"RTN","ORMBLDVB",123,0)
 S OI=+$O(^OR(100,+$G(IFN),.1,"B",0)) I OI D
"RTN","ORMBLDVB",124,0)
 . S OI0=$G(^ORD(101.43,OI,0)),OID=$P(OI0,U,2)
"RTN","ORMBLDVB",125,0)
 . S OIX=$P(OI0,U,8) I OIX["&" S OIX=$P(OIX,"&")_"\T\"_$P(OIX,"&",2)
"RTN","ORMBLDVB",126,0)
 . S Y=+OID_U_OIX_U_$P(OID,";",2)
"RTN","ORMBLDVB",127,0)
 Q Y
"RTN","ORMBLDVB",128,0)
 ;
"RTN","ORMBLDVB",129,0)
NTE() ; -- NTE segment
"RTN","ORMBLDVB",130,0)
 N Y S Y="NTE|1||"_$G(ORVAL("COMMENT"))
"RTN","ORMBLDVB",131,0)
 Q Y
"RTN","ORMBLDVB",132,0)
 ;
"RTN","ORMBLDVB",133,0)
DG1(DFN) ; -- DG1 segment
"RTN","ORMBLDVB",134,0)
 N VAIP,VAERR,Y
"RTN","ORMBLDVB",135,0)
 S DFN=+$G(DFN) D IN5^VADPT
"RTN","ORMBLDVB",136,0)
 S Y="DG1|1||^^^^"_$G(VAIP(9))_"^|||A"
"RTN","ORMBLDVB",137,0)
 Q Y
"RTN","ORMBLDVB",138,0)
 ;
"RTN","ORMBLDVB",139,0)
QT() ; -- Build and return Quantity/Timing field
"RTN","ORMBLDVB",140,0)
 N X,Y,%DT,X1,X4,X5,X6,X8,ORI
"RTN","ORMBLDVB",141,0)
 S X=$G(ORVAL("QTY")),X1=$S(X:+X_$S(X["ML":"&ML",1:""),1:"")
"RTN","ORMBLDVB",142,0)
 S (X4,X5)="" F ORI="START^4","DATETIME^5" D
"RTN","ORMBLDVB",143,0)
 . S X=$G(ORVAL($P(ORI,U))),%DT="TX" D ^%DT Q:Y<1
"RTN","ORMBLDVB",144,0)
 . S X=$$HL7DATE(Y),@("X"_$P(ORI,U,2))=X
"RTN","ORMBLDVB",145,0)
 S X=$G(ORVAL("URGENCY")),X6=$P($G(^ORD(101.42,+X,0)),U,2)
"RTN","ORMBLDVB",146,0)
 ;S X=$G(ORVAL("XFUSION")),X7=$S(X="H":"HOLD",X="I":"IMMEDIATE",1:"")
"RTN","ORMBLDVB",147,0)
 S X8=$G(ORVAL("MISC"))
"RTN","ORMBLDVB",148,0)
 S Y=X1_U_U_U_X4_U_X5_U_X6_U_U_X8
"RTN","ORMBLDVB",149,0)
 Q Y
"RTN","ORMBLDVB",150,0)
 ;
"RTN","ORMBLDVB",151,0)
DIV() ; -- Return Institution file #4 ptr for LOC
"RTN","ORMBLDVB",152,0)
 N X,Y S X=+$G(DUZ(2))
"RTN","ORMBLDVB",153,0)
 S Y=$P($G(^DIC(4,X,99)),U)_U_$P($G(^DIC(4,X,0)),U)
"RTN","ORMBLDVB",154,0)
 Q Y
"RTN","ORMBLDVB",155,0)
 ;
"RTN","ORMBLDVB",156,0)
ZDIV(LOC) ; -- Return Institution file #4 ptr for LOC
"RTN","ORMBLDVB",157,0)
 N X0,Y S X0=$G(^SC(+LOC,0))
"RTN","ORMBLDVB",158,0)
 I $P(X0,U,15) S X=$$SITE^VASITE(DT,$P(X0,U,15)),Y=$P(X,U,3)_U_$P(X,U,2)
"RTN","ORMBLDVB",159,0)
 I '$P(X0,U,15) S X=$S($P(X0,U,4):$P(X0,U,4),1:+$G(DUZ(2))),Y=X_U_$P($G(^DIC(4,+X,0)),U) ;look up #40.8 ptr??
"RTN","ORMBLDVB",160,0)
 Q Y
"RTN","ORMBLDVB",161,0)
 ;
"RTN","ORMBLDVB",162,0)
TYPE(X) ; -- Expands collection type code into text
"RTN","ORMBLDVB",163,0)
 Q:'$L($G(X)) ""
"RTN","ORMBLDVB",164,0)
 I X="SP" Q "SEND PATIENT"
"RTN","ORMBLDVB",165,0)
 S X=$E(X),X=$S(X="L":"LAB",X="I":"IMMEDIATE",1:"WARD")
"RTN","ORMBLDVB",166,0)
 Q X_" COLLECT"
"RTN","ORMHLREC")
0^12^B15260322
"RTN","ORMHLREC",1,0)
ORMHLREC ; SLC/BNT - ORM HL7 message receiver ;2/11/08  11:05
"RTN","ORMHLREC",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**212**;Dec 17, 1997;Build 24
"RTN","ORMHLREC",3,0)
 ;
"RTN","ORMHLREC",4,0)
EN ; -- main entry point for HL7 v1.6 message processing.
"RTN","ORMHLREC",5,0)
 N ORMSG,ORNMSP,ORTYPE,ORACK,ORERR,ORVP,ORTS,ORL,ORCAT,I,J,SNDACK,SG
"RTN","ORMHLREC",6,0)
 N ORDCNTRL,ORDSTS,PKGIFN,ORIFN,ORNP,ORTN,ORLOG,ORDUZ,ORQT,ORSTRT,ORSTOP
"RTN","ORMHLREC",7,0)
 N ORURG,ORNATR,OREASON,ORI,ORSEG,ORSEGID
"RTN","ORMHLREC",8,0)
 ;
"RTN","ORMHLREC",9,0)
 ; Is this an Acknowledgement message?  Additional ACK message types
"RTN","ORMHLREC",10,0)
 ; should be included in this $S statement where appropriate to set
"RTN","ORMHLREC",11,0)
 ; ORACK=1
"RTN","ORMHLREC",12,0)
 S ORACK=$S(HL("MTN")="ORG":1,HL("MTN")="ACK":1,1:0)
"RTN","ORMHLREC",13,0)
 ;
"RTN","ORMHLREC",14,0)
 F I=1:1 X HLNEXT Q:HLQUIT'>0  D
"RTN","ORMHLREC",15,0)
 . S ORMSG(I)=HLNODE,J=0
"RTN","ORMHLREC",16,0)
 . F  S J=$O(HLNODE(J)) Q:'J  S ORMSG(I,J)=HLNODE(J)
"RTN","ORMHLREC",17,0)
 ;
"RTN","ORMHLREC",18,0)
 ;I $G(VBTEST) S X=0 F  S X=$O(^XTMP("VBECS-ORM",$J,X)) Q:X=""  S ORMSG(X)=^(X)
"RTN","ORMHLREC",19,0)
 S ORNMSP=$$NMSP(HL("SAN")),ORTYPE=HL("MTN")
"RTN","ORMHLREC",20,0)
 I '$L(ORNMSP) S ORERR="Missing or invalid sending application" D ERROR Q
"RTN","ORMHLREC",21,0)
 S ORTN="EN^ORM"_ORNMSP
"RTN","ORMHLREC",22,0)
 ;
"RTN","ORMHLREC",23,0)
 S ORI=0 F  S ORI=$O(ORMSG(ORI)) Q:'ORI  D  Q:$D(ORERR)
"RTN","ORMHLREC",24,0)
 . S ORSEG=ORMSG(ORI),ORSEGID=$P(ORMSG(ORI),HL("FS"))
"RTN","ORMHLREC",25,0)
 . I $T(@ORSEGID)]"" D @ORSEGID
"RTN","ORMHLREC",26,0)
 Q:$D(ORERR)
"RTN","ORMHLREC",27,0)
 ;
"RTN","ORMHLREC",28,0)
 I $L($G(ORDCNTRL)) D @ORTN I $D(ORERR) D ERROR Q
"RTN","ORMHLREC",29,0)
 I 'ORACK D GENACK
"RTN","ORMHLREC",30,0)
 Q
"RTN","ORMHLREC",31,0)
 ;
"RTN","ORMHLREC",32,0)
ORC S ORDCNTRL=$TR($P(ORSEG,HL("FS"),2),"@","P")
"RTN","ORMHLREC",33,0)
 I '$L(ORDCNTRL) S ORERR="Invalid control code" D ERROR Q
"RTN","ORMHLREC",34,0)
 S ORIFN=$P($P(ORSEG,HL("FS"),3),$E(HL("ECH")))
"RTN","ORMHLREC",35,0)
 S PKGIFN=$P($P(ORSEG,HL("FS"),4),$E(HL("ECH")))
"RTN","ORMHLREC",36,0)
 I ORIFN,$G(ORVP),$D(^OR(100,+ORIFN,0)),$P(^(0),U,2)'=ORVP S ORERR="Patient doesn't match" D ERROR Q
"RTN","ORMHLREC",37,0)
 S ORDSTS=$P(ORSEG,HL("FS"),6)
"RTN","ORMHLREC",38,0)
 S ORQT=$P(ORSEG,HL("FS"),8)
"RTN","ORMHLREC",39,0)
 S ORSTRT=$$FMDATE($P(ORQT,U,4))
"RTN","ORMHLREC",40,0)
 S ORSTOP=$$FMDATE($P(ORQT,U,5))
"RTN","ORMHLREC",41,0)
 S ORURG=$$URGENCY($P(ORQT,U,6))
"RTN","ORMHLREC",42,0)
 S ORLOG=$$FMDATE($P(ORSEG,HL("FS"),10))
"RTN","ORMHLREC",43,0)
 S ORDUZ=+$P(ORSEG,HL("FS"),11) D DUZ^XUP(ORDUZ)
"RTN","ORMHLREC",44,0)
 S ORNP=+$P(ORSEG,HL("FS"),13)
"RTN","ORMHLREC",45,0)
 S OREASON=$P(ORSEG,HL("FS"),17)
"RTN","ORMHLREC",46,0)
 S ORNATR=$S($P(OREASON,$E(HL("ECH")),3)="99ORN":$P(OREASON,$E(HL("ECH"))),1:"")
"RTN","ORMHLREC",47,0)
 Q
"RTN","ORMHLREC",48,0)
 ;
"RTN","ORMHLREC",49,0)
NMSP(NAME) ; -- Returns package namespace
"RTN","ORMHLREC",50,0)
 I NAME="RADIOLOGY"!(NAME="IMAGING") Q "RA"
"RTN","ORMHLREC",51,0)
 I NAME="LABORATORY" Q "LR"
"RTN","ORMHLREC",52,0)
 I NAME="DIETETICS" Q "FH"
"RTN","ORMHLREC",53,0)
 I NAME="PHARMACY" Q "PS"
"RTN","ORMHLREC",54,0)
 I NAME="CONSULTS" Q "GMRC"
"RTN","ORMHLREC",55,0)
 I NAME="PROCEDURES" Q "GMRC"
"RTN","ORMHLREC",56,0)
 I NAME="ORDER ENTRY" Q "ORG"
"RTN","ORMHLREC",57,0)
 I NAME="VBECS" Q "VBEC"
"RTN","ORMHLREC",58,0)
 Q ""
"RTN","ORMHLREC",59,0)
 ;
"RTN","ORMHLREC",60,0)
MSA ; -- Process MSA segment
"RTN","ORMHLREC",61,0)
 S ORACK=1
"RTN","ORMHLREC",62,0)
 I $P(ORSEG,HL("FS"),2)'="AA" D
"RTN","ORMHLREC",63,0)
 . S ORERR=$P(ORSEG,HL("FS"),4)
"RTN","ORMHLREC",64,0)
 . I '$D(OREASON) S OREASON=U_ORERR
"RTN","ORMHLREC",65,0)
 . D ERROR Q
"RTN","ORMHLREC",66,0)
 Q
"RTN","ORMHLREC",67,0)
 ;
"RTN","ORMHLREC",68,0)
PID ; -- Process PID segment
"RTN","ORMHLREC",69,0)
 ;    Sets PID, ORVP, ORTS if valid patient
"RTN","ORMHLREC",70,0)
 N I,DFN,SEG,PIDLST,X
"RTN","ORMHLREC",71,0)
 ; Adding logic to support v2.4 Patient Id List
"RTN","ORMHLREC",72,0)
 S PIDLST=$P(ORSEG,HL("FS"),4)
"RTN","ORMHLREC",73,0)
 I PIDLST[$E(HL("ECH")) D
"RTN","ORMHLREC",74,0)
 . F I=1:1:$L(PIDLST,$E(HL("ECH"),2)) S X=$P(PIDLST,$E(HL("ECH"),2),I) Q:X=""  I $P(X,$E(HL("ECH")),5)["PI" S DFN=+X Q
"RTN","ORMHLREC",75,0)
 I PIDLST'[$E(HL("ECH")) S DFN=+$P(ORSEG,HL("FS"),4)
"RTN","ORMHLREC",76,0)
 I $D(^DPT(DFN,0)) S ORVP=DFN_";DPT(",ORTS=$G(^DPT(DFN,.103)) Q
"RTN","ORMHLREC",77,0)
 S:$L($P(ORSEG,HL("FS"),5)) ORVP=$P(ORSEG,HL("FS"),5) ; alt ID for Lab
"RTN","ORMHLREC",78,0)
 I '$G(ORVP) S ORERR="Missing or invalid patient ID" D ERROR Q
"RTN","ORMHLREC",79,0)
 Q
"RTN","ORMHLREC",80,0)
 ;
"RTN","ORMHLREC",81,0)
PV1 ; -- Process PV1 segment
"RTN","ORMHLREC",82,0)
 ;    Sets ORCAT, & ORL if valid location
"RTN","ORMHLREC",83,0)
 N I,X
"RTN","ORMHLREC",84,0)
 S X=+$P(ORSEG,HL("FS"),4),ORCAT=$P(ORSEG,HL("FS"),3)
"RTN","ORMHLREC",85,0)
 S:$D(^SC(X,0)) ORL=X_";SC("
"RTN","ORMHLREC",86,0)
 Q
"RTN","ORMHLREC",87,0)
 ;
"RTN","ORMHLREC",88,0)
ORDITEM(USID) ; -- Returns pointer to Orderable Item file for USID
"RTN","ORMHLREC",89,0)
 N ID,OI
"RTN","ORMHLREC",90,0)
 S ID=$P(USID,U,4)_";"_$P(USID,U,6)
"RTN","ORMHLREC",91,0)
 S OI=+$O(^ORD(101.43,"ID",ID,0))
"RTN","ORMHLREC",92,0)
 Q OI
"RTN","ORMHLREC",93,0)
 ;
"RTN","ORMHLREC",94,0)
URGENCY(CODE) ; -- Return ptr to Order Urgency file #101.42
"RTN","ORMHLREC",95,0)
 S:'$L(CODE) CODE="R"
"RTN","ORMHLREC",96,0)
 Q $O(^ORD(101.42,"C",CODE,0))
"RTN","ORMHLREC",97,0)
 ;
"RTN","ORMHLREC",98,0)
FMDATE(Y) ; -- Convert HL7 date/time to FM format
"RTN","ORMHLREC",99,0)
 Q $$HL7TFM^XLFDT(Y)  ;**97
"RTN","ORMHLREC",100,0)
 ;
"RTN","ORMHLREC",101,0)
ERROR ; -- Log an error and return ACK if necessary
"RTN","ORMHLREC",102,0)
 N ORV,X S ORV("XQY0")="",ORQUIT=1
"RTN","ORMHLREC",103,0)
 S X=$S($E(ORERR,1,2)="1^":$P(ORERR,U,2),1:ORERR)
"RTN","ORMHLREC",104,0)
 D EN^ORERR(X,.ORMSG,.ORV)
"RTN","ORMHLREC",105,0)
 ; send an ack to current message ??
"RTN","ORMHLREC",106,0)
 I 'ORACK D GENACK
"RTN","ORMHLREC",107,0)
 Q
"RTN","ORMHLREC",108,0)
 ;
"RTN","ORMHLREC",109,0)
GENACK ; -- Send acknowledgment to original message
"RTN","ORMHLREC",110,0)
 ;Q:$G(VBTEST)
"RTN","ORMHLREC",111,0)
 N MSA1,ORESULT S MSA1="AA"
"RTN","ORMHLREC",112,0)
 I $D(ORERR) S MSA1="AR"
"RTN","ORMHLREC",113,0)
 S HLA("HLA",1)="MSA"_HL("FS")_MSA1_HL("FS")_HL("MID")_$S($D(ORERR):HL("FS")_ORERR,1:"")
"RTN","ORMHLREC",114,0)
 ;S HLEID=HL("EID"),HLEIDS=HL("EIDS")
"RTN","ORMHLREC",115,0)
 D GENACK^HLMA1(HL("EID"),HLMTIENS,HL("EIDS"),"LM",1,.ORESULT)
"RTN","ORMHLREC",116,0)
 Q
"RTN","ORMHLREC",117,0)
TEST ; Testing utility
"RTN","ORMHLREC",118,0)
 Q
"RTN","ORMHLREC",119,0)
 N VBTEST S VBTEST=1
"RTN","ORMHLREC",120,0)
 S HL("FS")="|",HL("ECH")="^~\&",HL("SAN")="VBECS",HL("RAN")="OERR"
"RTN","ORMHLREC",121,0)
 S HL("MTN")="OMG"
"RTN","ORMHLREC",122,0)
 D EN
"RTN","ORMHLREC",123,0)
 Q
"RTN","ORMVBEC")
0^5^B24117916
"RTN","ORMVBEC",1,0)
ORMVBEC ; SLC/MKB - Process VBECS order msgs ;2/11/08  11:05
"RTN","ORMVBEC",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**212**;Dec 17, 1997;Build 24
"RTN","ORMVBEC",3,0)
 ;
"RTN","ORMVBEC",4,0)
EN ; -- entry point for VBEC messages from ORMHLREC
"RTN","ORMVBEC",5,0)
 ;M ^MKB(+ORIFN)=@ORMSG ;for testing
"RTN","ORMVBEC",6,0)
 I '$L($T(@ORDCNTRL)) Q  ;S ORERR="1^Invalid order control code" Q
"RTN","ORMVBEC",7,0)
 I '$G(ORIFN)!'$D(^OR(100,+$G(ORIFN),0)) S ORERR="1^Invalid order number" Q
"RTN","ORMVBEC",8,0)
 S:$G(ORLOG)<1 ORLOG=+$E($$NOW^XLFDT,1,12)
"RTN","ORMVBEC",9,0)
 D @ORDCNTRL
"RTN","ORMVBEC",10,0)
 Q
"RTN","ORMVBEC",11,0)
 ;
"RTN","ORMVBEC",12,0)
ACK(ORIFN) ; -- process DIRECT^HLMA acknowledgment [from ORMBLDVB]
"RTN","ORMVBEC",13,0)
 N ORMSG,I,J,MSH,MSA,ORC,ORTYPE,ORLOG,OREASON,ORNATR,ORDCNTRL,PKGIFN,X
"RTN","ORMVBEC",14,0)
 F I=1:1 X HLNEXT Q:HLQUIT'>0  D  ;get,parse message from HL7 package
"RTN","ORMVBEC",15,0)
 . S ORMSG(I)=HLNODE,J=0 ;Get segment node
"RTN","ORMVBEC",16,0)
 . ; Get continuation nodes for long segments, if any
"RTN","ORMVBEC",17,0)
 . F  S J=$O(HLNODE(J)) Q:'J  S ORMSG(I,J)=HLNODE(J)
"RTN","ORMVBEC",18,0)
 ;I '$O(ORMSG(0)) D EN^ORERR("Missing HL7 message",.ORMSG) Q
"RTN","ORMVBEC",19,0)
 S MSH=0 F  S MSH=$O(ORMSG(MSH)) Q:MSH'>0  Q:$E(ORMSG(MSH),1,3)="MSH"
"RTN","ORMVBEC",20,0)
 I 'MSH S ORERR="1^Missing or invalid MSH segment" D ERR Q
"RTN","ORMVBEC",21,0)
 S MSA=+$O(ORMSG(MSH)) I 'MSA!($E($G(ORMSG(MSA)),1,3)'="MSA") D  Q
"RTN","ORMVBEC",22,0)
 . S ORERR="1^Missing or invalid MSA segment" D ERR
"RTN","ORMVBEC",23,0)
 S ORTYPE=$P(ORMSG(MSH),"|",9),MSA=MSA_U_ORMSG(MSA)
"RTN","ORMVBEC",24,0)
 S ORLOG=+$E($$NOW^XLFDT,1,12),OREASON=U_$P(MSA,"|",4),ORNATR=""
"RTN","ORMVBEC",25,0)
 I $P(MSA,"|",2)'="AA",'$O(ORMSG(+MSA)) D  Q  ;unsuccessful, no order#
"RTN","ORMVBEC",26,0)
 . S ORERR="1^"_$P(OREASON,U,2) D UA,ERR
"RTN","ORMVBEC",27,0)
 S ORC=+MSA F  S ORC=$O(ORMSG(+ORC)) Q:ORC<1  I $E(ORMSG(ORC),1,3)="ORC" D
"RTN","ORMVBEC",28,0)
 . S X=ORMSG(ORC),ORDCNTRL=$P(X,"|",2),PKGIFN=+$P(X,"|",4)
"RTN","ORMVBEC",29,0)
 . I '$G(ORIFN) S ORIFN=+$P(X,"|",3) I ORDCNTRL["U" D  ;find action to cancel
"RTN","ORMVBEC",30,0)
 .. N DA,CODE S CODE=$S(ORDCNTRL="UC":"DC",1:"NW")
"RTN","ORMVBEC",31,0)
 .. S DA=$O(^OR(100,DA,8,"C",CODE,"?"),-1) S:DA<1 DA=1
"RTN","ORMVBEC",32,0)
 .. S ORIFN=ORIFN_";"_DA
"RTN","ORMVBEC",33,0)
 . D @ORDCNTRL
"RTN","ORMVBEC",34,0)
 Q
"RTN","ORMVBEC",35,0)
 ;
"RTN","ORMVBEC",36,0)
ERR ; -- Log an error
"RTN","ORMVBEC",37,0)
 N X S X=$P(ORERR,U,2)
"RTN","ORMVBEC",38,0)
 D EN^ORERR(X,.ORMSG)
"RTN","ORMVBEC",39,0)
 Q
"RTN","ORMVBEC",40,0)
 ;
"RTN","ORMVBEC",41,0)
STATUS(X) ; -- Returns Order Status for HL7 code X
"RTN","ORMVBEC",42,0)
 N Y S Y=$S(X="OC":1,X="CM":2,X="IP":5,X="SC":6,X="ZE":7,1:"")
"RTN","ORMVBEC",43,0)
 Q Y
"RTN","ORMVBEC",44,0)
 ;
"RTN","ORMVBEC",45,0)
OK ; -- Order accepted, VBECS order # assigned [reply]
"RTN","ORMVBEC",46,0)
 S ^OR(100,+ORIFN,4)=PKGIFN ;VBECS identifier
"RTN","ORMVBEC",47,0)
 D STATUS^ORCSAVE2(+ORIFN,5) ;pending
"RTN","ORMVBEC",48,0)
 Q
"RTN","ORMVBEC",49,0)
 ;
"RTN","ORMVBEC",50,0)
SC ; -- Status changed
"RTN","ORMVBEC",51,0)
 N ORSTS S ORSTS=$$STATUS(ORDSTS)
"RTN","ORMVBEC",52,0)
 I ORSTS=1 D OC Q  ;Cancel
"RTN","ORMVBEC",53,0)
 D STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMVBEC",54,0)
 D:ORSTS=6 DATES^ORCSAVE2(+ORIFN,ORLOG)                  ;Start Time
"RTN","ORMVBEC",55,0)
 D:ORSTS=7 DATES^ORCSAVE2(+ORIFN,,+$E($$NOW^XLFDT,1,12)) ;Stop Time
"RTN","ORMVBEC",56,0)
 Q
"RTN","ORMVBEC",57,0)
 ;
"RTN","ORMVBEC",58,0)
OC ; -- Cancelled
"RTN","ORMVBEC",59,0)
 G:ORTYPE["ORG" UA ;reject reply
"RTN","ORMVBEC",60,0)
 S:ORNATR="" ORNATR=+$O(^ORD(100.02,"C","X",0)) ;Rejected
"RTN","ORMVBEC",61,0)
 S ^OR(100,+ORIFN,6)=ORNATR_U_ORDUZ_U_ORLOG_U_U_$E($P(OREASON,U,2),1,80)
"RTN","ORMVBEC",62,0)
 D UPDATE(1,"DC"),LAB
"RTN","ORMVBEC",63,0)
 Q
"RTN","ORMVBEC",64,0)
 ;
"RTN","ORMVBEC",65,0)
CR ; -- Cancelled [reply]
"RTN","ORMVBEC",66,0)
 D STATUS^ORCSAVE2(+ORIFN,1)
"RTN","ORMVBEC",67,0)
 Q
"RTN","ORMVBEC",68,0)
 ;
"RTN","ORMVBEC",69,0)
UA ; -- Unable to accept [reply]
"RTN","ORMVBEC",70,0)
 S:'ORNATR ORNATR=$O(^ORD(100.02,"C","X",0)) ;rejected
"RTN","ORMVBEC",71,0)
 S ^OR(100,+ORIFN,6)=ORNATR_U_U_ORLOG_U_U_$E($P(OREASON,U,2),1,80)
"RTN","ORMVBEC",72,0)
 D STATUS^ORCSAVE2(+ORIFN,13),CANCEL ;cancel associated orders
"RTN","ORMVBEC",73,0)
UC ; -- Unable to cancel [reply]
"RTN","ORMVBEC",74,0)
DE ; -- Data Error [reply]
"RTN","ORMVBEC",75,0)
 N DA S DA=$P(ORIFN,";",2) Q:'DA
"RTN","ORMVBEC",76,0)
 S $P(^OR(100,+ORIFN,8,DA,0),U,15)=13 ;request rejected
"RTN","ORMVBEC",77,0)
 S:$L($P(OREASON,U,2)) ^OR(100,+ORIFN,8,DA,1)=$E($P(OREASON,U,2),1,240)
"RTN","ORMVBEC",78,0)
 Q
"RTN","ORMVBEC",79,0)
 ;
"RTN","ORMVBEC",80,0)
CANCEL ; -- cancel associated lab, parent orders
"RTN","ORMVBEC",81,0)
 N ORDAD
"RTN","ORMVBEC",82,0)
 S ORDAD=+$P($G(^OR(100,+ORIFN,3)),U,9) Q:'ORDAD
"RTN","ORMVBEC",83,0)
 D CANCEL^ORCSEND2(ORDAD,$P(OREASON,U,2)) ;cancel parent+children
"RTN","ORMVBEC",84,0)
 Q
"RTN","ORMVBEC",85,0)
 ;
"RTN","ORMVBEC",86,0)
UPDATE(ORSTS,ORACT) ; -- continue processing
"RTN","ORMVBEC",87,0)
 N DA,ORX,ORCMMT,ORP
"RTN","ORMVBEC",88,0)
 ;D DATES^ORCSAVE2(+ORIFN,ORSTRT,ORSTOP) ;DC stop set in $$STATUS
"RTN","ORMVBEC",89,0)
 D:$G(ORSTS) STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMVBEC",90,0)
 S ORCMMT=$E($P(OREASON,U,2),1,240),ORX=$$CREATE^ORX1(ORNATR) D:ORX
"RTN","ORMVBEC",91,0)
 . S DA=$$ACTION^ORCSAVE(ORACT,+ORIFN,ORNP,ORCMMT,ORLOG,ORDUZ)
"RTN","ORMVBEC",92,0)
 . I DA'>0 S ORERR="1^Cannot create new order action" Q
"RTN","ORMVBEC",93,0)
 . D RELEASE^ORCSAVE2(+ORIFN,DA,ORLOG,ORDUZ,ORNATR)
"RTN","ORMVBEC",94,0)
 . D SIGSTS^ORCSAVE2(+ORIFN,DA)
"RTN","ORMVBEC",95,0)
 . I $G(ORL) S ORP(1)=+ORIFN_";"_DA_"^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMVBEC",96,0)
 . S $P(^OR(100,+ORIFN,3),U,7)=DA
"RTN","ORMVBEC",97,0)
 I '$$ACTV^ORX1(ORNATR) S $P(^OR(100,+ORIFN,3),U,7)=0
"RTN","ORMVBEC",98,0)
 D:ORACT="DC" CANCEL^ORCSEND(+ORIFN) ;cancel unreleased actions
"RTN","ORMVBEC",99,0)
 Q
"RTN","ORMVBEC",100,0)
 ;
"RTN","ORMVBEC",101,0)
ZP ; -- Purged
"RTN","ORMVBEC",102,0)
 Q:'ORIFN  Q:'$D(^OR(100,+ORIFN,0))
"RTN","ORMVBEC",103,0)
 S $P(^OR(100,+ORIFN,4),";",1,3)=";;" I "^5^6^"[(U_$P($G(^(3)),U,3)_U) D STATUS^ORCSAVE2(+ORIFN,$S($P(^(4),";",5):2,1:14)) ; Remove pkg reference, sts=lapsed if still active
"RTN","ORMVBEC",104,0)
 Q
"RTN","ORMVBEC",105,0)
 ;
"RTN","ORMVBEC",106,0)
ZR ; -- Purged as requested [reply]
"RTN","ORMVBEC",107,0)
 D DELETE^ORCSAVE2(+ORIFN)
"RTN","ORMVBEC",108,0)
 Q
"RTN","ORMVBEC",109,0)
 ;
"RTN","ORMVBEC",110,0)
ZU ; -- Unable to purge [reply]
"RTN","ORMVBEC",111,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT ; update Last Activity
"RTN","ORMVBEC",112,0)
 Q
"RTN","ORMVBEC",113,0)
 ;
"RTN","ORMVBEC",114,0)
LAB ; -- find and cancel ORIFN'S associated Lab order
"RTN","ORMVBEC",115,0)
 N ORLRIFN S ORLRIFN=$$VALUE^ORX8(ORIFN,"LAB")
"RTN","ORMVBEC",116,0)
 I 'ORLRIFN D  ;search children for match
"RTN","ORMVBEC",117,0)
 . N ORDAD,ORIT,ORLAB,ORI,ORX
"RTN","ORMVBEC",118,0)
 . S ORDAD=+$P($G(^OR(100,+ORIFN,3)),U,9) Q:'ORDAD
"RTN","ORMVBEC",119,0)
 . S ORIT=$$VALUE^ORX8(ORIFN,"ORDERABLE",1,"E") Q:'$L(ORIT)
"RTN","ORMVBEC",120,0)
 . S ORLAB=$$PKG^ORMPS1("LR"),(ORLRIFN,ORI)=0
"RTN","ORMVBEC",121,0)
 . F  S ORI=+$O(^OR(100,ORDAD,2,+ORI)) Q:'ORI  I ORI'=+ORIFN D  Q:ORLRIFN
"RTN","ORMVBEC",122,0)
 .. Q:$P($G(^OR(100,ORI,0)),U,14)'=ORLAB
"RTN","ORMVBEC",123,0)
 .. S ORX=$$VALUE^ORX8(ORI,"ORDERABLE",1,"E")
"RTN","ORMVBEC",124,0)
 .. I ORX[ORIT S ORLRIFN=ORI Q
"RTN","ORMVBEC",125,0)
 D:ORLRIFN MSG^ORMBLD(ORLRIFN,"CA")
"RTN","ORMVBEC",126,0)
 Q
"RTN","ORWDXVB")
0^21^B44139791
"RTN","ORWDXVB",1,0)
ORWDXVB ;slc/dcm - Order dialog utilities for Blood Bank ;12/7/05  17:11
"RTN","ORWDXVB",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,243,212**;Dec 17 1997;Build 24
"RTN","ORWDXVB",3,0)
 ;
"RTN","ORWDXVB",4,0)
 ; DBIA 2503   RR^LR7OR1   ^TMP("LRRR",$J)
"RTN","ORWDXVB",5,0)
 ; 
"RTN","ORWDXVB",6,0)
GETPAT(ORX,DFN,ORL)     ;Get Patient data from VBECS
"RTN","ORWDXVB",7,0)
 ;Needs patient DFN and Location (ORL)
"RTN","ORWDXVB",8,0)
 N ORSTN,DIV
"RTN","ORWDXVB",9,0)
 S DIV=+$P($G(^SC(+$G(ORL),0)),U,15),ORSTN=$P($$SITE^VASITE(DT,DIV),U,3)
"RTN","ORWDXVB",10,0)
 D OEAPI^VBECA3(.ORX,DFN,ORSTN)
"RTN","ORWDXVB",11,0)
 Q
"RTN","ORWDXVB",12,0)
PTINFO(OROOT,ORX)       ;Format patient BB info
"RTN","ORWDXVB",13,0)
 Q:'$D(ORX)
"RTN","ORWDXVB",14,0)
 D PTINFO^ORWDXVB1
"RTN","ORWDXVB",15,0)
 Q
"RTN","ORWDXVB",16,0)
RESULTS(OROOT,DFN,ORX)  ;Get test results
"RTN","ORWDXVB",17,0)
 Q:'$O(ORX(0))  ;ORX contains a list of tests to retrieve results for
"RTN","ORWDXVB",18,0)
 N ORCOM,ORT,ORTST,ORTDT,ORTMP,GCNT,CCNT,GIOSL,GIOM,I,ORZ
"RTN","ORWDXVB",19,0)
 S GCNT=0,CCNT=1,GIOSL=999999,GIOM=80
"RTN","ORWDXVB",20,0)
 S OROOT=$NA(^TMP("ORVBEC",$J))
"RTN","ORWDXVB",21,0)
 K ^TMP("ORVBEC",$J)
"RTN","ORWDXVB",22,0)
 D LN
"RTN","ORWDXVB",23,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT,"RECENT LAB RESULTS:",.CCNT)
"RTN","ORWDXVB",24,0)
 D LN
"RTN","ORWDXVB",25,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT,"Test    Result    Units      Range     Collected       Accession     Sts",.CCNT)
"RTN","ORWDXVB",26,0)
 D LN
"RTN","ORWDXVB",27,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT,"----    ------    -----      -----     ---------       ---------     ---",.CCNT)
"RTN","ORWDXVB",28,0)
 S ORT=0 F  S ORT=$O(ORX(ORT)) Q:'ORT  S ORTST=$P(ORX(ORT),"^",1) D
"RTN","ORWDXVB",29,0)
 . K ^TMP("LRRR",$J) D RR^LR7OR1(DFN,,,,,ORTST,,1)  ;DBIA 2503
"RTN","ORWDXVB",30,0)
 . S ORTMP="^TMP(""LRRR"",$J,DFN)",ORTMP=$Q(@ORTMP)
"RTN","ORWDXVB",31,0)
 . Q:$P(ORTMP,",",1,3)'=("^TMP(""LRRR"","_$J_","_DFN)
"RTN","ORWDXVB",32,0)
 . S ORTDT=9999999-+$P(ORTMP,",",5),ORZ=@ORTMP
"RTN","ORWDXVB",33,0)
 . D LN
"RTN","ORWDXVB",34,0)
 . S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT,$P(ORZ,"^",15),.CCNT)_$$S^ORU4(8,CCNT,$J($P(ORZ,"^",2),7),.CCNT)_$$S^ORU4(16,CCNT,$P(ORZ,"^",3),.CCNT)_$$S^ORU4(19,CCNT,$P(ORZ,"^",4),.CCNT)_$$S^ORU4(30,CCNT,$P(ORZ,"^",5),.CCNT)
"RTN","ORWDXVB",35,0)
 . S ^(0)=^TMP("ORVBEC",$J,GCNT,0)_$$S^ORU4(40,CCNT,$$DATETIME^ORCHTAB(ORTDT),.CCNT)_$$S^ORU4(56,CCNT,$P(ORZ,"^",16),.CCNT)_$$S^ORU4(71,CCNT,$P(ORZ,"^",6),.CCNT)
"RTN","ORWDXVB",36,0)
 . S ORCOM=$P(ORTMP,",",1,5)_",""N""" ;check for comments
"RTN","ORWDXVB",37,0)
 . F  S ORTMP=$Q(@ORTMP) Q:$P(ORTMP,",",1,6)'=ORCOM  D
"RTN","ORWDXVB",38,0)
 .. D LN
"RTN","ORWDXVB",39,0)
 .. S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(1,CCNT,@ORTMP,.CCNT)
"RTN","ORWDXVB",40,0)
 I GCNT<4 K ^TMP("ORVBEC",$J)
"RTN","ORWDXVB",41,0)
 K ^TMP("LRRR",$J)
"RTN","ORWDXVB",42,0)
 Q
"RTN","ORWDXVB",43,0)
RAW(OROOT,DFN,ORX)  ;Get RAW test results
"RTN","ORWDXVB",44,0)
 Q:'$O(ORX(0))  ;ORX contains a list of tests to retrieve results for
"RTN","ORWDXVB",45,0)
 N ORCOM,ORT,ORTST,ORTDT,ORTMP,GCNT,CCNT,GIOSL,GIOM,I
"RTN","ORWDXVB",46,0)
 S GCNT=0,CCNT=1,GIOSL=999999,GIOM=80
"RTN","ORWDXVB",47,0)
 S OROOT=$NA(^TMP("ORVBEC",$J))
"RTN","ORWDXVB",48,0)
 K ^TMP("ORVBEC",$J)
"RTN","ORWDXVB",49,0)
 S ORT=0 F  S ORT=$O(ORX(ORT)) Q:'ORT  S ORTST=$P(ORX(ORT),"^",1) D
"RTN","ORWDXVB",50,0)
 . K ^TMP("LRRR",$J) D RR^LR7OR1(DFN,,,,,ORTST,,1)
"RTN","ORWDXVB",51,0)
 . S ORTMP="^TMP(""LRRR"",$J,DFN)",ORTMP=$Q(@ORTMP)
"RTN","ORWDXVB",52,0)
 . Q:$P(ORTMP,",",1,3)'=("^TMP(""LRRR"","_$J_","_DFN)
"RTN","ORWDXVB",53,0)
 . S ORTDT=9999999-+$P(ORTMP,",",5),ORZ=@ORTMP
"RTN","ORWDXVB",54,0)
 . D LN
"RTN","ORWDXVB",55,0)
 . S ^TMP("ORVBEC",$J,GCNT,0)=$P(ORZ,"^",1,6)_"^"_ORTDT
"RTN","ORWDXVB",56,0)
 K ^TMP("LRRR",$J)
"RTN","ORWDXVB",57,0)
 Q
"RTN","ORWDXVB",58,0)
SURG(OROOT,ORX) ;Get list of surgeries
"RTN","ORWDXVB",59,0)
 N I,CNT,X
"RTN","ORWDXVB",60,0)
 S (I,CNT)=0
"RTN","ORWDXVB",61,0)
 F  S I=$O(ORX("SURGERY",I)) Q:'I  S X=$G(ORX("SURGERY",I)) D
"RTN","ORWDXVB",62,0)
 . S CNT=CNT+1,OROOT(CNT)=X_U_X
"RTN","ORWDXVB",63,0)
 Q
"RTN","ORWDXVB",64,0)
LN ;Increment counts
"RTN","ORWDXVB",65,0)
 S GCNT=GCNT+1,CCNT=1
"RTN","ORWDXVB",66,0)
 Q
"RTN","ORWDXVB",67,0)
PATINFO(OROOT,DFN,LOC)   ;Test ^TMP global output
"RTN","ORWDXVB",68,0)
 N ORX
"RTN","ORWDXVB",69,0)
 D GETPAT(.ORX,DFN,LOC)
"RTN","ORWDXVB",70,0)
 I $L($G(ORX("SPECIMEN"))) S:$P(ORX("SPECIMEN"),"^") $P(ORX("SPECIMEN"),"^")=$$HL7TFM^XLFDT($P(ORX("SPECIMEN"),"^"))
"RTN","ORWDXVB",71,0)
 D PTINFO(.OROOT,.ORX)
"RTN","ORWDXVB",72,0)
 ;S I=0 F  S I=$O(@OROOT@(I)) Q:'I  W !,^(I,0)
"RTN","ORWDXVB",73,0)
 ;K @OROOT
"RTN","ORWDXVB",74,0)
 Q
"RTN","ORWDXVB",75,0)
GETALL(OROOT,DFN,LOC) ;Get all data in one call and let the GUI divide it up
"RTN","ORWDXVB",76,0)
 N ORX,INFO,CNT,I,J,K
"RTN","ORWDXVB",77,0)
 S OROOT=$NA(^TMP("ORVBECINFO",$J)),CNT=1
"RTN","ORWDXVB",78,0)
 D GETPAT(.ORX,DFN,LOC)
"RTN","ORWDXVB",79,0)
 ;S ^TMP("ORVBECINFO",$J,CNT)="~RAWDATA",I=0
"RTN","ORWDXVB",80,0)
 ;F  S I=$O(ORX(I)) Q:'I  S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)=ORX(I)
"RTN","ORWDXVB",81,0)
 I $L($G(ORX("SPECIMEN"))) S:$P(ORX("SPECIMEN"),"^") $P(ORX("SPECIMEN"),"^")=$$HL7TFM^XLFDT($P(ORX("SPECIMEN"),"^")) S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="~SPECIMEN",CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_ORX("SPECIMEN")
"RTN","ORWDXVB",82,0)
 I $L($G(ORX("ABORH"))) S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="~ABORH",CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_ORX("ABORH")
"RTN","ORWDXVB",83,0)
 S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="~TYPE AND SCREEN",CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_$O(^ORD(101.43,"ID","1;99VBC",0))
"RTN","ORWDXVB",84,0)
 S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="~OTHER",CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_$O(^ORD(101.43,"ID","6;99VBC",0))
"RTN","ORWDXVB",85,0)
 S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="~SPECIMENS",I=0
"RTN","ORWDXVB",86,0)
 F  S I=$O(ORX(I)) Q:'I  S J="" F  S J=$O(ORX(I,J)) Q:J=""  I J="SPECIMEN" S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_I_"^"_ORX(I,J)
"RTN","ORWDXVB",87,0)
 S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="~TESTS",I=0
"RTN","ORWDXVB",88,0)
 F  S I=$O(ORX(I)) Q:'I  S J="" F  S J=$O(ORX(I,J)) Q:J=""  I J="TEST" S K=0 F  S K=$O(ORX(I,J,K)) Q:'K  S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_I_"^"_K_"^"_ORX(I,J,K)
"RTN","ORWDXVB",89,0)
 S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="~MSBOS",I=0
"RTN","ORWDXVB",90,0)
 F  S I=$O(ORX(I)) Q:'I  S J="" F  S J=$O(ORX(I,J)) Q:J=""  I J="MSBOS" S K=0 F  S K=$O(ORX(I,J,K)) Q:'K  S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_I_"^"_K_"^"_ORX(I,J,K),$P(^(CNT),"^",4)=+$P(ORX(I,J,K),"^",2)
"RTN","ORWDXVB",91,0)
 S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="~SURGERIES",I=0
"RTN","ORWDXVB",92,0)
 F  S I=$O(ORX("SURGERY",I)) Q:'I  S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_I_"^"_ORX("SURGERY",I)
"RTN","ORWDXVB",93,0)
 S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="~URGENCIES",I=""
"RTN","ORWDXVB",94,0)
 F  S I=$O(^ORD(101.42,"S.VBEC",I)) Q:I=""  S J=0 F  S J=$O(^ORD(101.42,"S.VBEC",I,J)) Q:'J  S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_J_"^"_I
"RTN","ORWDXVB",95,0)
 S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="~MODIFIERS",I=""
"RTN","ORWDXVB",96,0)
 N ORMODS D GETLST^XPAR(.ORMODS,"ALL","OR VBECS MODIFIERS","I")
"RTN","ORWDXVB",97,0)
 F  S I=$O(ORMODS(I)) Q:'I  S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_ORMODS(I)
"RTN","ORWDXVB",98,0)
 ;F I="W^Washed","I^Irradiated","L^Leuko Reduced","V^Volume Reduced","D^Divided","E^Leuko Reduced/Irradiated" S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_I
"RTN","ORWDXVB",99,0)
 S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="~REASONS",I=""
"RTN","ORWDXVB",100,0)
 N ORMODS D GETLST^XPAR(.ORMODS,"ALL","OR VBECS REASON FOR REQUEST","I")
"RTN","ORWDXVB",101,0)
 F  S I=$O(ORMODS(I)) Q:'I  S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_ORMODS(I)
"RTN","ORWDXVB",102,0)
 S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="~INFO"
"RTN","ORWDXVB",103,0)
 D PTINFO(.INFO,.ORX)
"RTN","ORWDXVB",104,0)
 S I=0 F  S I=$O(^TMP("ORVBEC",$J,I)) Q:'I  S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_^TMP("ORVBEC",$J,I,0)
"RTN","ORWDXVB",105,0)
 S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="~TNS ORDERS"
"RTN","ORWDXVB",106,0)
 N ORMODS D PULL^ORWDXVB2(.ORMODS,DFN)
"RTN","ORWDXVB",107,0)
 S I=0 F  S I=$O(ORMODS(I)) Q:'I  S CNT=CNT+1,^TMP("ORVBECINFO",$J,CNT)="i"_ORMODS(I)
"RTN","ORWDXVB",108,0)
 K ^TMP("ORVBEC",$J)
"RTN","ORWDXVB",109,0)
 Q
"RTN","ORWDXVB",110,0)
STATALOW(OROOT,DFN) ;Allow stat for ORES ORELSE users
"RTN","ORWDXVB",111,0)
 S OROOT=$D(^XUSEC("ORES",DUZ))!($D(^XUSEC("ORELSE",DUZ)))
"RTN","ORWDXVB",112,0)
 Q
"RTN","ORWDXVB",113,0)
NURSADMN(OROOT) ;Suppress Nursing Adiminstration Order Prompt
"RTN","ORWDXVB",114,0)
 S OROOT=+$$GET^XPAR("DIV^SYS^PKG","OR VBECS SUPPRESS NURS ADMIN")
"RTN","ORWDXVB",115,0)
 Q
"RTN","ORWDXVB",116,0)
VBTNS(RETURN) ;RPC to get Days back to check for Type & Screen order
"RTN","ORWDXVB",117,0)
 S RETURN=$$GET^XPAR("ALL","ORWDXVB VBECS TNS CHECK",1,"I")
"RTN","ORWDXVB",118,0)
 Q
"RTN","ORWDXVB",119,0)
COMPORD(OROOT) ;Get sequence order of Blood Components
"RTN","ORWDXVB",120,0)
 N ORLIST,I,X
"RTN","ORWDXVB",121,0)
 D GETLST^XPAR(.ORLIST,"ALL","OR VBECS COMPONENT ORDER")
"RTN","ORWDXVB",122,0)
 S I=0 F  S I=$O(ORLIST(I)) Q:'I  S X=ORLIST(I) I $D(^ORD(101.43,$P(X,"^",2),0)) S OROOT(I)=$P(X,"^",2)_"^"_$P(^(0),"^",1)_"^"_$P(^(0),"^",1)
"RTN","ORWDXVB",123,0)
 Q
"RTN","ORWDXVB",124,0)
SUBCHK(OROOT,TSTNM) ;Check to see if selected test is a Blood Component or a Diagnostic Test
"RTN","ORWDXVB",125,0)
 S OROOT=""
"RTN","ORWDXVB",126,0)
 Q:'$L($G(TSTNM))
"RTN","ORWDXVB",127,0)
 I $O(^ORD(101.43,"S.VBT",TSTNM,0)) S OROOT="t"
"RTN","ORWDXVB",128,0)
 I $O(^ORD(101.43,"S.VBC",TSTNM,0)) S OROOT="c"
"RTN","ORWDXVB",129,0)
 Q
"RTN","ORWDXVB",130,0)
TESTR ;Test results call
"RTN","ORWDXVB",131,0)
 N ORX
"RTN","ORWDXVB",132,0)
 S ORX(3)="3" ;HGB
"RTN","ORWDXVB",133,0)
 S ORX(4)="4" ;HCT
"RTN","ORWDXVB",134,0)
 S ORX(1)="1" ;WBC
"RTN","ORWDXVB",135,0)
 S ORX(113)="113" ;FERRITIN
"RTN","ORWDXVB",136,0)
 D RESULTS(.OROOT,66,.ORX)
"RTN","ORWDXVB",137,0)
 S I=0 F  S I=$O(@OROOT@(I)) Q:'I  W !,^(I,0)
"RTN","ORWDXVB",138,0)
 K @OROOT
"RTN","ORWDXVB",139,0)
 Q
"RTN","ORWDXVB2")
0^24^B16199930
"RTN","ORWDXVB2",1,0)
ORWDXVB2 ;slc/dcm - Order dialog utilities for Blood Bank Cont.;3/2/04  09:31
"RTN","ORWDXVB2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,243,212**;Dec 17 1997;Build 24
"RTN","ORWDXVB2",3,0)
 ;
"RTN","ORWDXVB2",4,0)
ERROR ;Process error
"RTN","ORWDXVB2",5,0)
 N ORERR,ORI,X
"RTN","ORWDXVB2",6,0)
 S VBERROR=$P(ORX("ERROR"),"^",2) D LN
"RTN","ORWDXVB2",7,0)
 D GETWP^XPAR(.ORERR,"ALL","OR VBECS ERROR MESSAGE")
"RTN","ORWDXVB2",8,0)
 S ORI=0,X="" F  S ORI=$O(ORERR(ORI)) Q:ORI<1  D
"RTN","ORWDXVB2",9,0)
 . S X=$G(ORERR(ORI,0))
"RTN","ORWDXVB2",10,0)
 . S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,X,.CCNT) D LN
"RTN","ORWDXVB2",11,0)
 I X'?1."*" S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"******************************************************************",.CCNT) D LN
"RTN","ORWDXVB2",12,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"*                                                                *",.CCNT) D LN
"RTN","ORWDXVB2",13,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"*                         Error Message                          *",.CCNT) D LN
"RTN","ORWDXVB2",14,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"*                                                                *",.CCNT) D LN
"RTN","ORWDXVB2",15,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"*",.CCNT)
"RTN","ORWDXVB2",16,0)
 I $L(VBERROR)<68 D
"RTN","ORWDXVB2",17,0)
 . S ^TMP("ORVBEC",$J,GCNT,0)=^TMP("ORVBEC",$J,GCNT,0)_$$S^ORU4(70-$L(VBERROR)/2,CCNT,VBERROR,.CCNT)
"RTN","ORWDXVB2",18,0)
 . S ^TMP("ORVBEC",$J,GCNT,0)=^TMP("ORVBEC",$J,GCNT,0)_$$S^ORU4(67,CCNT,"*",.CCNT) D LN
"RTN","ORWDXVB2",19,0)
 I $L(VBERROR)>68 D
"RTN","ORWDXVB2",20,0)
 . I $L(VBERROR)>136 S VBERROR=$E(VBERROR,1,136)_"..."
"RTN","ORWDXVB2",21,0)
 . N L1 S L1=$E(VBERROR,1,$L(VBERROR)/2)
"RTN","ORWDXVB2",22,0)
 . I $E(L1,$L(L1))'=" " D
"RTN","ORWDXVB2",23,0)
 . . S LINE1=$E(L1,1,($L(L1)-($L($P(L1," ",$L(L1," ")))))),LINE2=$E(VBERROR,$L(LINE1)+1,$L(VBERROR))
"RTN","ORWDXVB2",24,0)
 . E  S LINE1=$E(L1),LINE2=$E(VBERROR,$L(LINE1)+1,$L(VBERROR))
"RTN","ORWDXVB2",25,0)
 . S ^TMP("ORVBEC",$J,GCNT,0)=^TMP("ORVBEC",$J,GCNT,0)_$$S^ORU4(70-$L(LINE1)/2,CCNT,LINE1,.CCNT)
"RTN","ORWDXVB2",26,0)
 . S ^TMP("ORVBEC",$J,GCNT,0)=^TMP("ORVBEC",$J,GCNT,0)_$$S^ORU4(67,CCNT,"*",.CCNT) D LN
"RTN","ORWDXVB2",27,0)
 . S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"*",.CCNT)
"RTN","ORWDXVB2",28,0)
 . S ^TMP("ORVBEC",$J,GCNT,0)=^TMP("ORVBEC",$J,GCNT,0)_$$S^ORU4(70-$L(LINE2)/2,CCNT,LINE2,.CCNT)
"RTN","ORWDXVB2",29,0)
 . S ^TMP("ORVBEC",$J,GCNT,0)=^TMP("ORVBEC",$J,GCNT,0)_$$S^ORU4(67,CCNT,"*",.CCNT) D LN
"RTN","ORWDXVB2",30,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"*                                                                *",.CCNT) D LN
"RTN","ORWDXVB2",31,0)
 S ^TMP("ORVBEC",$J,GCNT,0)=$$S^ORU4(2,CCNT,"******************************************************************",.CCNT) D LN
"RTN","ORWDXVB2",32,0)
 D LINE^ORU4("^TMP(""ORVBEC"",$J)",GIOM),LN
"RTN","ORWDXVB2",33,0)
 Q
"RTN","ORWDXVB2",34,0)
PULL(OROOT,ORVP,ITEMID,SDATE,EDATE) ;Get list of orders matching ITEM
"RTN","ORWDXVB2",35,0)
 ;ITEM = Orderable Item ID e.g. "1;99VBC" for Type and Screen
"RTN","ORWDXVB2",36,0)
 ;SDATE = Start Date for search
"RTN","ORWDXVB2",37,0)
 ;EDATE = End Date for search
"RTN","ORWDXVB2",38,0)
 Q:'$G(ORVP)
"RTN","ORWDXVB2",39,0)
 N ORTNSB
"RTN","ORWDXVB2",40,0)
 I $P(ORVP,";",2)="" S ORVP=ORVP_";DPT("
"RTN","ORWDXVB2",41,0)
 S ORTNSB=$$GET^XPAR("ALL","ORWDXVB VBECS TNS CHECK",1,"I")
"RTN","ORWDXVB2",42,0)
 S:'ORTNSB ORTNSB=3 ;Use Default of DT-3 or Parameter [ORWDXVB VBECS TNS CHECK] if no start date passed in
"RTN","ORWDXVB2",43,0)
 S ITEMID=$S($D(ITEMID):ITEMID,1:"1;99VBC") ;Default to Type and Screen if nothing passed in
"RTN","ORWDXVB2",44,0)
 S SDATE=$S($D(SDATE):SDATE,1:$$FMADD^XLFDT(DT-ORTNSB))
"RTN","ORWDXVB2",45,0)
 S EDATE=$S($D(EDATE):EDATE,1:DT) ;Default to DT if no End date passed in
"RTN","ORWDXVB2",46,0)
 N ORDG,FLG,ORLIST,ORX0,ORX3,ORSTAT,ORIFN,I,X,J,CNT,ITEM,ITEMNM,ORLOC,DIV
"RTN","ORWDXVB2",47,0)
 S ITEM=+$O(^ORD(101.43,"ID",ITEMID,0)),ITEMNM=$P($G(^ORD(101.43,ITEM,0)),"^")
"RTN","ORWDXVB2",48,0)
 S CNT=0,ORDG=$O(^ORD(100.98,"B","VBEC",0)) Q:'ORDG
"RTN","ORWDXVB2",49,0)
 F FLG=4,23,19 D  ;Get completed, active/pending, unreleased
"RTN","ORWDXVB2",50,0)
 . K ^TMP("ORR",$J)
"RTN","ORWDXVB2",51,0)
 . D EN^ORQ1(ORVP,ORDG,FLG,0,SDATE,EDATE)
"RTN","ORWDXVB2",52,0)
 . I '$O(^TMP("ORR",$J,ORLIST,0)) Q
"RTN","ORWDXVB2",53,0)
 . S I=0
"RTN","ORWDXVB2",54,0)
 . F  S I=$O(^TMP("ORR",$J,ORLIST,I)) Q:'I  S X=^(I) D
"RTN","ORWDXVB2",55,0)
 .. S ORIFN=+X,J=0,DIV=""
"RTN","ORWDXVB2",56,0)
 .. Q:'$D(^OR(100,ORIFN,0))  S ORX0=^(0),ORX3=^(3)
"RTN","ORWDXVB2",57,0)
 .. S ORSTAT=$S($D(^ORD(100.01,+$P(ORX3,"^",3),0)):$P(^(0),"^"),1:""),ORLOC=$S($L($P($G(^SC(+$P(ORX0,"^",10),0)),"^")):$P(^(0),"^"),1:"UNKNOWN")
"RTN","ORWDXVB2",58,0)
 .. I +$P(ORX0,"^",10) S DIV=$P($G(^SC(+$P(ORX0,"^",10),0)),U,15),DIV=$S(DIV:$P($$SITE^VASITE(DT,DIV),"^",2),1:"")
"RTN","ORWDXVB2",59,0)
 .. F  S J=$O(^OR(100,ORIFN,4.5,"ID","ORDERABLE",J)) Q:'J  I +$G(^OR(100,ORIFN,4.5,J,1))=ITEM D
"RTN","ORWDXVB2",60,0)
 ... S CNT=CNT+1,OROOT(CNT)="Duplicate order: "_ITEMNM_" entered "_$$FMTE^XLFDT($P(ORX0,"^",7))_" Div/Loc: "_DIV_":"_ORLOC_" ["_ORSTAT_"]"
"RTN","ORWDXVB2",61,0)
 Q
"RTN","ORWDXVB2",62,0)
LN ;Increment counts
"RTN","ORWDXVB2",63,0)
 S GCNT=GCNT+1,CCNT=1
"RTN","ORWDXVB2",64,0)
 Q
"RTN","ORWLR1")
0^20^B29165126
"RTN","ORWLR1",1,0)
ORWLR1 ; slc/dcm -  VBEC Blood Bank Report ;01/16/03  15:02
"RTN","ORWLR1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**172,212**;Dec 17, 1997;Build 24
"RTN","ORWLR1",3,0)
 ;Re-write of ^LR7OSBR
"RTN","ORWLR1",4,0)
EN(DFN) ;Get Blood Bank Report
"RTN","ORWLR1",5,0)
 Q:'$G(DFN)
"RTN","ORWLR1",6,0)
 N GCNT,CCNT,GIOSL,GIOM,ORABORH,PATID,PATNAM,PATDOB,ORN
"RTN","ORWLR1",7,0)
 S PATID="`"_DFN,PATNAM=$P(^DPT(DFN,0),"^"),PATDOB=$P(^(0),"^",3) ;Why PATNAM and PATDOB???
"RTN","ORWLR1",8,0)
 K ^TMP("ORLRC",$J)
"RTN","ORWLR1",9,0)
 S GCNT=0,CCNT=1,GIOSL=999999,GIOM=80
"RTN","ORWLR1",10,0)
 S ORABORH=$$ABORH^VBECA1(PATID,PATNAM,PATDOB) ;Get ABO/RH
"RTN","ORWLR1",11,0)
 S ORN(2.91)="DIRECT AHG TEST COMMENT",ORN(8)="ANTIBODY SCREEN COMMENT"
"RTN","ORWLR1",12,0)
 S ORN(10.3)="ABO TESTING COMMENT",ORN(11.3)="RH TESTING COMMENT"
"RTN","ORWLR1",13,0)
 D EN^ORWLR2
"RTN","ORWLR1",14,0)
 Q
"RTN","ORWLR1",15,0)
REPORT ;Blood Bank Report for M reports menu
"RTN","ORWLR1",16,0)
 Q:'$G(DFN)
"RTN","ORWLR1",17,0)
 N DIC,ID,ORDFN,ORY,PAGE,XQORNOD,ORDAYSBK
"RTN","ORWLR1",18,0)
 S ORDFN=DFN,ID=2
"RTN","ORWLR1",19,0)
 D BLR^ORWRP1(.ORY,.ORDFN,.ID,.ORALPHA,.OROMEGA,.ORDAYSBK,.REMOTE)
"RTN","ORWLR1",20,0)
 Q:'$L(ORY)
"RTN","ORWLR1",21,0)
 S PAGE=1
"RTN","ORWLR1",22,0)
 D HEAD^ORWRPP1(ORDFN,PAGE,"PATIENT BLOOD BANK REPORT",$G(STATION))
"RTN","ORWLR1",23,0)
 D HURL^ORWRPP1(.ORY,ORDFN,"PATIENT BLOOD BANK REPORT",,,1)
"RTN","ORWLR1",24,0)
 Q
"RTN","ORWLR1",25,0)
GETPAT(ERR) ;Setup Patient Variables
"RTN","ORWLR1",26,0)
 N ORPNM,ORVP
"RTN","ORWLR1",27,0)
 S ERR=0
"RTN","ORWLR1",28,0)
 D EN2^ORUDPA
"RTN","ORWLR1",29,0)
 I 'ORVP S ERR=1 Q
"RTN","ORWLR1",30,0)
 S PATID="`"_+ORVP,PATNAM=ORPNM,PATDOB=$P(^DPT(+ORVP,0),"^",3)
"RTN","ORWLR1",31,0)
 D PAT^VBECA1A
"RTN","ORWLR1",32,0)
 W !,LRDFN
"RTN","ORWLR1",33,0)
 I $O(VBECERR(0)) D  S ERR=1 Q
"RTN","ORWLR1",34,0)
 . S ERR=0 F  S ERR=$O(VBECERR(ERR)) Q:'ERR  W !?5," ERR:"_VBECERR(1)
"RTN","ORWLR1",35,0)
 Q
"RTN","ORWLR1",36,0)
TEST ;Test calls
"RTN","ORWLR1",37,0)
 N ORVP,PATID,PATNAM,PATDOB,LRDFN,ERR,ABORH,ID,ID1,ID2,ARR,GMI,DI2,BPN,VBECERR,ERROR
"RTN","ORWLR1",38,0)
 D GETPAT(.ERROR)
"RTN","ORWLR1",39,0)
 I $G(ERROR) W !,"Error on Patient lookup" Q
"RTN","ORWLR1",40,0)
 D ABORH,ABID,TRRX,DFN,CPRS,TRAN
"RTN","ORWLR1",41,0)
 I $O(^TMP("VBDATA",$J,"CROSSMATCH",0)) D
"RTN","ORWLR1",42,0)
 . W !,"Crossmatched Units: " S ID=0 F  S ID=$O(^TMP("VBDATA",$J,"CROSSMATCH",ID)) Q:'ID  W !?2,^(ID)
"RTN","ORWLR1",43,0)
 K ^TMP("VBDATA",$J),^TMP("TRRX",$J),^TMP("TRAN",$J)
"RTN","ORWLR1",44,0)
 Q
"RTN","ORWLR1",45,0)
OEAPI ;Test call to OEAPI^VBECA3
"RTN","ORWLR1",46,0)
 N DIV,ORSTN,ERROR,ORVB
"RTN","ORWLR1",47,0)
 D GETPAT^ORWLR1(.ERROR)
"RTN","ORWLR1",48,0)
 I $G(ERROR) W !,"Error on Patient lookup" Q
"RTN","ORWLR1",49,0)
 S DIV=+$P($G(^SC(+$G(ORL),0)),U,15),ORSTN=$P($$SITE^VASITE(DT,DIV),U,3)
"RTN","ORWLR1",50,0)
 D OEAPI^VBECA3(.ORVB,+ORVP,ORSTN)
"RTN","ORWLR1",51,0)
 I $O(ORVB(0)) D
"RTN","ORWLR1",52,0)
 . W !,"Array returned from OEAPI^VBECA3 API in ORVB():",!
"RTN","ORWLR1",53,0)
 . ;ZW ORVB
"RTN","ORWLR1",54,0)
 K ^TMP("OR",$J),^TMP("VBECRPC",$J),^TMP("VBECS_XML_RES",$J),^TMP("VBEC_OE_DATA",$J)
"RTN","ORWLR1",55,0)
 Q
"RTN","ORWLR1",56,0)
ABORH ;Test call to ABORH^VBECA1 for ABO/Rh - DBIA 3181
"RTN","ORWLR1",57,0)
 N ERROR
"RTN","ORWLR1",58,0)
 I '$G(ORVP) D GETPAT(.ERROR)
"RTN","ORWLR1",59,0)
 I $G(ERROR) W !,"Error on Patient lookup" Q
"RTN","ORWLR1",60,0)
 S ABORH=$$ABORH^VBECA1(PATID,PATNAM,PATDOB) W !,"ABO/RH: "_ABORH
"RTN","ORWLR1",61,0)
 Q
"RTN","ORWLR1",62,0)
ABID ;Test call to ABID^VBECA1 for Antibodies Identified - DBIA 3181, 3184
"RTN","ORWLR1",63,0)
 N ID,ERROR,PARENT
"RTN","ORWLR1",64,0)
 I '$G(ORVP) D GETPAT(.ERROR)
"RTN","ORWLR1",65,0)
 I $G(ERROR) W !,"Error on Patient lookup" Q
"RTN","ORWLR1",66,0)
 D ABID^VBECA1(PATID,PATNAM,PATDOB,.PARENT,.ARR) I $O(ARR("ABID",0)) D
"RTN","ORWLR1",67,0)
 . W !,"Antibodies Identified: " S ID=0 F  S ID=$O(ARR("ABID",ID)) Q:'ID  W !?2,ARR("ABID",ID)
"RTN","ORWLR1",68,0)
 Q
"RTN","ORWLR1",69,0)
DFN ;Test call to DFN^VBECA3A - DBIA 3879
"RTN","ORWLR1",70,0)
 N ID,ID1,ID2,ERROR
"RTN","ORWLR1",71,0)
 K ^TMP("VBDATA",$J)
"RTN","ORWLR1",72,0)
 I '$G(ORVP) D GETPAT(.ERROR)
"RTN","ORWLR1",73,0)
 I $G(ERROR) W !,"Error on Patient lookup" Q
"RTN","ORWLR1",74,0)
 D DFN^VBECA3A(DFN)
"RTN","ORWLR1",75,0)
 I $O(^TMP("VBDATA",$J,"COMPONENT REQUEST",0)) D
"RTN","ORWLR1",76,0)
 . W !,"Component request: " S ID=0 F  S ID=$O(^TMP("VBDATA",$J,"COMPONENT REQUEST",ID)) Q:'ID  W !?2,^(ID) D
"RTN","ORWLR1",77,0)
 .. S ID1=0 F  S ID1=$O(^TMP("VBDATA",$J,"COMPONENT REQUEST",ID,ID1)) Q:'ID1  W !,"."_^(ID1)
"RTN","ORWLR1",78,0)
  I $O(^TMP("VBDATA",$J,"SPECIMEN",0)) D
"RTN","ORWLR1",79,0)
 . W !,"Specimen: " S ID=0 F  S ID=$O(^TMP("VBDATA",$J,"SPECIMEN",ID)) Q:'ID  W !?2,^(ID) D
"RTN","ORWLR1",80,0)
 .. S ID1=0 F  S ID1=$O(^TMP("VBDATA",$J,"SPECIMEN",ID,ID1)) Q:'ID1  W:$D(^(ID1))#2 !,"."_^(ID1) D
"RTN","ORWLR1",81,0)
 ... S ID2=0 F  S ID2=$O(^TMP("VBDATA",$J,"SPECIMEN",ID,ID1,ID2)) Q:'ID2  W:$D(^(ID2))#2 !,".."_^(ID2)
"RTN","ORWLR1",82,0)
 I $O(^TMP("VBDATA",$J,"UNIT",0)) D
"RTN","ORWLR1",83,0)
 . W !,"Available Units: "
"RTN","ORWLR1",84,0)
 . S ID=0 F  S ID=$O(^TMP("VBDATA",$J,"UNIT",ID)) Q:'ID  W !?2,^(ID)
"RTN","ORWLR1",85,0)
 Q
"RTN","ORWLR1",86,0)
CPRS ;Test call to CPRS^VBECA3B - DBIA 3880
"RTN","ORWLR1",87,0)
 N ID,ID1,ID2,ERROR
"RTN","ORWLR1",88,0)
 K ^TMP("BBD",$J)
"RTN","ORWLR1",89,0)
 I '$G(ORVP) D GETPAT(.ERROR)
"RTN","ORWLR1",90,0)
 I $G(ERROR) W !,"Error on Patient lookup" Q
"RTN","ORWLR1",91,0)
 D CPRS^VBECA3B
"RTN","ORWLR1",92,0)
 I $O(^TMP("BBD",$J,"SPECIMEN",0)) D
"RTN","ORWLR1",93,0)
 . W !,"Specimen: " S ID=0 F  S ID=$O(^TMP("BBD",$J,"SPECIMEN",ID)) Q:'ID  W !?2,^(ID) D
"RTN","ORWLR1",94,0)
 .. S ID1=0 F  S ID1=$O(^TMP("BBD",$J,"SPECIMEN",ID,ID1)) Q:'ID1  W:$D(^(ID1))#2 !,"."_^(ID1) D
"RTN","ORWLR1",95,0)
 ... S ID2=0 F  S ID2=$O(^TMP("BBD",$J,"SPECIMEN",ID,ID1,ID2)) Q:'ID2  W:$D(^(ID2))#2 !,".."_^(ID2)
"RTN","ORWLR1",96,0)
 Q
"RTN","ORWLR1",97,0)
TRAN ;Test call to TRAN^VBECA4 for Tranfused Units - DBIA 3176
"RTN","ORWLR1",98,0)
 N BPN,ID,GMI,GMR,ERROR
"RTN","ORWLR1",99,0)
 K ^TMP("TRAN",$J)
"RTN","ORWLR1",100,0)
 I '$G(ORVP) D GETPAT(.ERROR)
"RTN","ORWLR1",101,0)
 I $G(ERROR) W !,"Error on Patient lookup" Q
"RTN","ORWLR1",102,0)
 D TRAN^VBECA4(+ORVP,"TRAN")
"RTN","ORWLR1",103,0)
 I $O(^TMP("TRAN",$J,0)) D
"RTN","ORWLR1",104,0)
 . W !,"Transfused Units: ",! S ID=0
"RTN","ORWLR1",105,0)
 . F  S ID=$O(^TMP("TRAN",$J,ID)) Q:'ID  S GMR=^(ID) D
"RTN","ORWLR1",106,0)
 .. D PARSE,WRT
"RTN","ORWLR1",107,0)
 . I $O(^TMP("TRAN",$J,"A"))'="" D
"RTN","ORWLR1",108,0)
 .. W !," Blood Product Key: "
"RTN","ORWLR1",109,0)
 . S GMI="A" F  S GMI=$O(^TMP("TRAN",$J,GMI)) Q:GMI=""  D
"RTN","ORWLR1",110,0)
 .. W ?21,GMI," = ",$G(^TMP("TRAN",$J,GMI)),!
"RTN","ORWLR1",111,0)
 Q
"RTN","ORWLR1",112,0)
TRRX ;Test call to TRRX^VBECA1 for Transfusion Reactions - DBIA 3181, 3187
"RTN","ORWLR1",113,0)
 N ARR,ID,ERROR,PARENT
"RTN","ORWLR1",114,0)
 I '$G(ORVP) D GETPAT(.ERROR)
"RTN","ORWLR1",115,0)
 I $G(ERROR) W !,"Error on Patient lookup" Q
"RTN","ORWLR1",116,0)
 D TRRX^VBECA1(PATID,PATNAM,PATDOB,.PARENT,.ARR) I $O(ARR("TRRX",0)) D
"RTN","ORWLR1",117,0)
 . W !,"Transfusion reactions: " S ID=0 F  S ID=$O(ARR("TRRX",ID)) Q:'ID  W !?2,ARR("TRRX",ID)
"RTN","ORWLR1",118,0)
 Q
"RTN","ORWLR1",119,0)
PARSE ;Parse Record
"RTN","ORWLR1",120,0)
 N GMI,X
"RTN","ORWLR1",121,0)
 S TD=$$FMTE^XLFDT(+GMR)
"RTN","ORWLR1",122,0)
 S GMA(1)=$P(GMR,U,2),BPN=$L(GMA(1),";")
"RTN","ORWLR1",123,0)
 I $P(GMA(1),";",BPN)="" S BPN=BPN-1
"RTN","ORWLR1",124,0)
 F GMI=2:1:BPN S GMA(GMI)="("_$P($P(GMA(1),";",GMI),"\")_") "_$P($P(GMA(1),";",GMI),"\",2)
"RTN","ORWLR1",125,0)
 S GMA(1)="("_$P($P(GMA(1),";",1),"\")_") "_$P($P(GMA(1),";",1),"\",2)
"RTN","ORWLR1",126,0)
 Q
"RTN","ORWLR1",127,0)
WRT ; Writes the Transfusion Record for each day
"RTN","ORWLR1",128,0)
 N GML,GMI1,GMI2,GMM,GMJ
"RTN","ORWLR1",129,0)
 S GMM=$S(BPN#4:1,1:0),GML=BPN\4+GMM
"RTN","ORWLR1",130,0)
 W TD
"RTN","ORWLR1",131,0)
 F GMI1=1:1:GML D
"RTN","ORWLR1",132,0)
 . F GMI2=1:1:($S((GMI1=GML)&(BPN#4):BPN#4,1:4)) D
"RTN","ORWLR1",133,0)
 .. S GMJ=((GMI1-1)*4)+GMI2
"RTN","ORWLR1",134,0)
 .. W ?(((GMI2-1)*15)+13),GMA(GMJ)
"RTN","ORWLR1",135,0)
 .. I $S(GMI2#4=0:1,GMI2=BPN:1,GMI2+(4*(GMI1-1))=BPN:1,1:0) W !
"RTN","ORWLR1",136,0)
 Q
"RTN","ORWLR2")
0^13^B29775782
"RTN","ORWLR2",1,0)
ORWLR2 ; slc/dcm -  VBEC Blood Bank Report ;2/11/08  11:05
"RTN","ORWLR2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**172,212**;Dec 17, 1997;Build 24
"RTN","ORWLR2",3,0)
 ;from ORWLR1 - Re-write of ^LR7OSBR1
"RTN","ORWLR2",4,0)
EN ;
"RTN","ORWLR2",5,0)
 N %DT,A,B,C,CMT,H,ID,J,ORI,T,X,X0,Y,ORPARENT,ORRY
"RTN","ORWLR2",6,0)
 D H,RPT^ORWLR3
"RTN","ORWLR2",7,0)
 Q
"RTN","ORWLR2",8,0)
T ;Date/time format
"RTN","ORWLR2",9,0)
 S T=$TR($$FMTE^XLFDT(T,"M"),"@"," ")
"RTN","ORWLR2",10,0)
 Q
"RTN","ORWLR2",11,0)
CX ;Crossmatch
"RTN","ORWLR2",12,0)
 N A,CNT,F,LOCAT
"RTN","ORWLR2",13,0)
 I '$O(^TMP("BBD",$J,"CROSSMATCH",0)) D  Q
"RTN","ORWLR2",14,0)
 . D LN
"RTN","ORWLR2",15,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(1,.CCNT,"No UNITS assigned/xmatched",.CCNT)
"RTN","ORWLR2",16,0)
 . D LINE^ORU4("^TMP(""ORLRC"",$J)",GIOM)
"RTN","ORWLR2",17,0)
 D LINE^ORU4("^TMP(""ORLRC"",$J)",GIOM),LN
"RTN","ORWLR2",18,0)
 S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(6,.CCNT,"Unit assigned/xmatched:",.CCNT)_$$S^ORU4(46,.CCNT,"Exp date",.CCNT)_$$S^ORU4(64,.CCNT,"Loc",.CCNT)
"RTN","ORWLR2",19,0)
 S (CNT,A)=0 F  S A=$O(^TMP("BBD",$J,"CROSSMATCH",A)) Q:'A  D
"RTN","ORWLR2",20,0)
 . S F=^TMP("BBD",$J,"CROSSMATCH",A),CNT=CNT+1,LOCAT=$S($L($P(F,"^",7)):$P(F,"^",7),1:"BB-"_$P(F,"^",6))
"RTN","ORWLR2",21,0)
 . D LN
"RTN","ORWLR2",22,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(1,.CCNT,$J(CNT,2)_")",.CCNT)_$$S^ORU4(6,.CCNT,$P(F,"^"),.CCNT)_$$S^ORU4(17,.CCNT,$E($P(F,"^",2),1,19),.CCNT)_$$S^ORU4(38,.CCNT,$P(F,"^",3)_" "_$E($P(F,"^",4),1,3),.CCNT)
"RTN","ORWLR2",23,0)
 . S ^(0)=^TMP("ORLRC",$J,GCNT,0)_$$S^ORU4(45,.CCNT,$P(F,"^",5),.CCNT)_$$S^ORU4(64,.CCNT,LOCAT,.CCNT)
"RTN","ORWLR2",24,0)
 D LINE^ORU4("^TMP(""ORLRC"",$J)",GIOM)
"RTN","ORWLR2",25,0)
 Q
"RTN","ORWLR2",26,0)
C ;Component Request
"RTN","ORWLR2",27,0)
 N %DT,A,F,T,X,Y
"RTN","ORWLR2",28,0)
 I '$O(^TMP("BBD",$J,"COMPONENT REQUEST",0)) D  Q
"RTN","ORWLR2",29,0)
 . D LN S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(1,.CCNT,"No component requests",.CCNT)
"RTN","ORWLR2",30,0)
 D LN S X="Component requests"
"RTN","ORWLR2",31,0)
 S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(1,.CCNT,X,.CCNT)_$$S^ORU4(25,.CCNT,"Units",.CCNT)_$$S^ORU4(31,.CCNT,"Request date",.CCNT)_$$S^ORU4(52,.CCNT,"Date wanted",.CCNT)_$$S^ORU4(68,.CCNT,"Requestor",.CCNT)_$$S^ORU4(77,.CCNT,"By",.CCNT)
"RTN","ORWLR2",32,0)
 S A=0 F  S A=$O(^TMP("BBD",$J,"COMPONENT REQUEST",A)) Q:'A  D
"RTN","ORWLR2",33,0)
 . S F=^TMP("BBD",$J,"COMPONENT REQUEST",A),T="",%DT="T",X=$P(F,"^",3),Y=-1
"RTN","ORWLR2",34,0)
 . I $L(X) D ^%DT
"RTN","ORWLR2",35,0)
 . I Y'=-1 S T=Y D T
"RTN","ORWLR2",36,0)
 . D LN
"RTN","ORWLR2",37,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(1,.CCNT,$E($P(F,"^"),1,25),.CCNT)_$$S^ORU4(25,.CCNT,$J($P(F,"^",2),3),.CCNT)_$$S^ORU4(31,.CCNT,T,.CCNT)
"RTN","ORWLR2",38,0)
 . S T="",%DT="T",X=$P(F,"^",4),Y=-1
"RTN","ORWLR2",39,0)
 . I $L(X) D ^%DT
"RTN","ORWLR2",40,0)
 . I Y'=-1 S T=Y D T
"RTN","ORWLR2",41,0)
 . S X=$S($P(F,"^",6):$P(F,"^",6)_",",1:""),X=$S($L(X):$$GET1^DIQ(200,X,1),1:$P(F,"^",6))
"RTN","ORWLR2",42,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=^TMP("ORLRC",$J,GCNT,0)_$$S^ORU4(52,.CCNT,T,.CCNT)_$$S^ORU4(68,.CCNT,$E($P(F,"^",5),1,10),.CCNT)_$$S^ORU4(77,.CCNT,X,.CCNT)
"RTN","ORWLR2",43,0)
 Q
"RTN","ORWLR2",44,0)
TRAN ;Transfusion Data
"RTN","ORWLR2",45,0)
 K ^TMP("TRAN",$J)
"RTN","ORWLR2",46,0)
 D TRAN^VBECA4(DFN,"TRAN")
"RTN","ORWLR2",47,0)
 Q:'$O(^TMP("TRAN",$J,0))
"RTN","ORWLR2",48,0)
 N ID,GMR,GMA,TD,C,BPN,GMI
"RTN","ORWLR2",49,0)
 D LINE^ORU4("^TMP(""ORLRC"",$J)",GIOM),LN
"RTN","ORWLR2",50,0)
 S X="Transfused Units ",^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(1,.CCNT,X,.CCNT),ID=0 D LN
"RTN","ORWLR2",51,0)
 F  S ID=$O(^TMP("TRAN",$J,ID)) Q:'ID  S GMR=^(ID) D
"RTN","ORWLR2",52,0)
 . D PARSE^ORWLR1,WRT
"RTN","ORWLR2",53,0)
 I $O(^TMP("TRAN",$J,"A"))'="" D
"RTN","ORWLR2",54,0)
 . D LN
"RTN","ORWLR2",55,0)
 . S X="  Blood Product Key: ",^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(1,.CCNT,X,.CCNT)
"RTN","ORWLR2",56,0)
 S GMI="A",C=0
"RTN","ORWLR2",57,0)
 F  S GMI=$O(^TMP("TRAN",$J,GMI)) Q:GMI=""  D
"RTN","ORWLR2",58,0)
 . S X=GMI_" = "_$G(^TMP("TRAN",$J,GMI))
"RTN","ORWLR2",59,0)
 . I C>0 D LN
"RTN","ORWLR2",60,0)
 . S C=C+1,^TMP("ORLRC",$J,GCNT,0)=$G(^TMP("ORLRC",$J,GCNT,0))_$$S^ORU4(21,.CCNT,X,.CCNT)
"RTN","ORWLR2",61,0)
 K ^TMP("TRAN",$J)
"RTN","ORWLR2",62,0)
 Q
"RTN","ORWLR2",63,0)
WRT  ;Transfusion Record for each day
"RTN","ORWLR2",64,0)
  N GML,GMI1,GMI2,GMM,GMJ,CL
"RTN","ORWLR2",65,0)
  S GMM=$S(BPN#4:1,1:0),GML=BPN\4+GMM D LN
"RTN","ORWLR2",66,0)
  S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(2,.CCNT,TD,.CCNT)
"RTN","ORWLR2",67,0)
  F GMI1=1:1:GML D
"RTN","ORWLR2",68,0)
  . F GMI2=1:1:($S((GMI1=GML)&(BPN#4):BPN#4,1:4)) D
"RTN","ORWLR2",69,0)
  .. S GMJ=((GMI1-1)*4)+GMI2,CL=(((GMI2-1)*15)+14)
"RTN","ORWLR2",70,0)
  .. S ^TMP("ORLRC",$J,GCNT,0)=$G(^TMP("ORLRC",$J,GCNT,0))_$$S^ORU4(CL,.CCNT,GMA(GMJ),.CCNT)
"RTN","ORWLR2",71,0)
  .. I $S(GMI2#4=0:1,GMI2=BPN:1,GMI2+(4*(GMI1-1))=BPN:1,1:0) D LN
"RTN","ORWLR2",72,0)
  Q
"RTN","ORWLR2",73,0)
H ;Header
"RTN","ORWLR2",74,0)
 N X D LN
"RTN","ORWLR2",75,0)
 S X=GIOM/2-(10/2+5),^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(X,.CCNT,"---- BLOOD BANK ----",.CCNT)
"RTN","ORWLR2",76,0)
 Q:$G(ORABORH)=-1  Q:$G(ORABORH)=""
"RTN","ORWLR2",77,0)
 D LN
"RTN","ORWLR2",78,0)
 S X=$E(ORABORH,$L(ORABORH)),X=$S(X="P":"Pos",X="N":"Neg",1:X),ORABORH=$E(ORABORH,1,($L(ORABORH)-1))_X
"RTN","ORWLR2",79,0)
 S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(1,.CCNT,"ABO Rh: "_ORABORH,.CCNT)
"RTN","ORWLR2",80,0)
 Q
"RTN","ORWLR2",81,0)
ERRH ;Error Header
"RTN","ORWLR2",82,0)
 N X D LN
"RTN","ORWLR2",83,0)
 S X=GIOM/2-(10/2+5),^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(X,.CCNT,"---- BLOOD BANK REPORT IS UNAVAILABLE----",.CCNT)
"RTN","ORWLR2",84,0)
 Q
"RTN","ORWLR2",85,0)
AHG ;AHG Data
"RTN","ORWLR2",86,0)
 D LINE^ORU4("^TMP(""ORLRC"",$J)",GIOM),LN
"RTN","ORWLR2",87,0)
 S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(30,.CCNT,"|---",.CCNT)_$$S^ORU4(39,.CCNT,"AHG(direct)",.CCNT)_$$S^ORU4(55,.CCNT,"---|",.CCNT)_$$S^ORU4(62,.CCNT,"|-AHG(indirect)-|",.CCNT)
"RTN","ORWLR2",88,0)
 D LN
"RTN","ORWLR2",89,0)
 S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(4,.CCNT,"Date/time",.CCNT)_$$S^ORU4(20,.CCNT,"ABO",.CCNT)_$$S^ORU4(24,.CCNT,"Rh",.CCNT)_$$S^ORU4(30,.CCNT,"POLY",.CCNT)_$$S^ORU4(35,.CCNT,"IgG",.CCNT)_$$S^ORU4(40,.CCNT,"C3",.CCNT)
"RTN","ORWLR2",90,0)
 S ^(0)=^TMP("ORLRC",$J,GCNT,0)_$$S^ORU4(45,.CCNT,"Interpretation",.CCNT)_$$S^ORU4(62,.CCNT,"(Antibody screen)",.CCNT)
"RTN","ORWLR2",91,0)
 D LN
"RTN","ORWLR2",92,0)
 S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(4,.CCNT,"---------",.CCNT)_$$S^ORU4(20,.CCNT,"---",.CCNT)_$$S^ORU4(24,.CCNT,"--",.CCNT)_$$S^ORU4(30,.CCNT,"----",.CCNT)_$$S^ORU4(35,.CCNT,"---",.CCNT)
"RTN","ORWLR2",93,0)
 S ^(0)=^TMP("ORLRC",$J,GCNT,0)_$$S^ORU4(40,.CCNT,"---",.CCNT)_$$S^ORU4(45,.CCNT,"--------------",.CCNT)_$$S^ORU4(62,.CCNT,"-----------------",.CCNT)
"RTN","ORWLR2",94,0)
 Q
"RTN","ORWLR2",95,0)
LN ;Increment counts
"RTN","ORWLR2",96,0)
 S GCNT=GCNT+1,CCNT=1
"RTN","ORWLR2",97,0)
 Q
"RTN","ORWLR3")
0^19^B48454721
"RTN","ORWLR3",1,0)
ORWLR3 ; slc/dcm - VBEC Blood Bank Report cont. ;11/13/07  15:19
"RTN","ORWLR3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**212**;Dec 17, 1997;Build 24
"RTN","ORWLR3",3,0)
RPT ;Pull report data from VBECS
"RTN","ORWLR3",4,0)
 N ORI,ORJ,ORK,ORT,ORL,ORRY,REQX,CMT,C,ID,T
"RTN","ORWLR3",5,0)
 K ^TMP("VBDATA",$J)
"RTN","ORWLR3",6,0)
 ;Antibodies
"RTN","ORWLR3",7,0)
 D ABID^VBECA1(PATID,PATNAM,PATDOB,.ORPARENT,.ORRY)
"RTN","ORWLR3",8,0)
 I $O(ORRY("ABID",0)) D
"RTN","ORWLR3",9,0)
 . D LINE^ORU4("^TMP(""ORLRC"",$J)",GIOM),LN
"RTN","ORWLR3",10,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(0,.CCNT,"ANTIBODIES IDENTIFIED: ",.CCNT),ID=0
"RTN","ORWLR3",11,0)
 . D LN F  S ID=$O(ORRY("ABID",ID)) Q:'ID  D
"RTN","ORWLR3",12,0)
 .. S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(0,.CCNT,$G(ORRY("ABID",ID)),.CCNT)
"RTN","ORWLR3",13,0)
 .. I $O(ORRY("ABID",ID,0)) D
"RTN","ORWLR3",14,0)
 ... D LN S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(2,.CCNT,"COMMENT:",.CCNT) D LN
"RTN","ORWLR3",15,0)
 ... S CMT=0 F  S CMT=$O(ORRY("ABID",ID,CMT)) Q:'CMT  S C=ORRY("ABID",ID,CMT) D
"RTN","ORWLR3",16,0)
 .... D LN S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(2,.CCNT,C,.CCNT)
"RTN","ORWLR3",17,0)
 ... D LINE^ORU4("^TMP(""ORLRC"",$J)",GIOM),LN
"RTN","ORWLR3",18,0)
 ;Transfusion reactions 
"RTN","ORWLR3",19,0)
 D TRRX^VBECA1(PATID,PATNAM,PATDOB,.ORPARENT,.ORRY)
"RTN","ORWLR3",20,0)
 I $O(ORRY("TRRX",0)) D
"RTN","ORWLR3",21,0)
 . D LINE^ORU4("^TMP(""ORLRC"",$J)",GIOM),LN
"RTN","ORWLR3",22,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(0,.CCNT,"TRANSFUSION REACTIONS:",.CCNT) D LN
"RTN","ORWLR3",23,0)
 . S ID=0 F  S ID=$O(ORRY("TRRX",ID)) Q:'ID  S X=ORRY("TRRX",ID) D
"RTN","ORWLR3",24,0)
 .. S Y=$TR($$FMTE^XLFDT(+X,"M"),"@"," ") D LN
"RTN","ORWLR3",25,0)
 .. S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(3,.CCNT,"Type:  "_$S($P(X,U,2)]"":$P(X,U,2),1:"Unknown"),.CCNT) D LN
"RTN","ORWLR3",26,0)
 .. S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(6,.CCNT,"Date/Time",.CCNT)_$$S^ORU4(35,.CCNT,"Unit ID",.CCNT)_$$S^ORU4(66,.CCNT,"Component",.CCNT) D LN
"RTN","ORWLR3",27,0)
 .. S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(6,.CCNT,"---------",.CCNT)_$$S^ORU4(35,.CCNT,"-------",.CCNT)_$$S^ORU4(66,.CCNT,"---------",.CCNT) D LN
"RTN","ORWLR3",28,0)
 .. S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(6,.CCNT,$S(Y]"":Y,1:"Unknown"),.CCNT)_$$S^ORU4(35,.CCNT,$S($P(X,U,3)]"":$P(X,U,3),1:"Unknown"),.CCNT)_$$S^ORU4(66,.CCNT,$S($P(X,U,4)]"":$P(X,U,4),1:"Unknown"),.CCNT)
"RTN","ORWLR3",29,0)
 .. I $O(ORRY("TRRX",ID,0)) D
"RTN","ORWLR3",30,0)
 ... D LN S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(6,.CCNT,"Comment:",.CCNT) D LN
"RTN","ORWLR3",31,0)
 ... S CMT=0 F  S CMT=$O(ORRY("TRRX",ID,CMT)) Q:'CMT  S C=ORRY("TRRX",ID,CMT) D
"RTN","ORWLR3",32,0)
 .... D LN S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(6,.CCNT,C,.CCNT)
"RTN","ORWLR3",33,0)
 .. D LINE^ORU4("^TMP(""ORLRC"",$J)",GIOM),LN
"RTN","ORWLR3",34,0)
 D LINE^ORU4("^TMP(""ORLRC"",$J)",GIOM)
"RTN","ORWLR3",35,0)
 ;Xmatched units, Component requests, Diagnostic test results
"RTN","ORWLR3",36,0)
 D DFN^VBECA3A(DFN)
"RTN","ORWLR3",37,0)
 ;Available Units
"RTN","ORWLR3",38,0)
 I $O(^TMP("VBDATA",$J,"UNIT",0)) D
"RTN","ORWLR3",39,0)
 . D LINE^ORU4("^TMP(""ORLRC"",$J)",GIOM),LN
"RTN","ORWLR3",40,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(0,.CCNT,"AVAILABLE UNITS:",.CCNT) D LN
"RTN","ORWLR3",41,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(2,.CCNT,"Unit ID",.CCNT)_$$S^ORU4(14,.CCNT,"Product",.CCNT)_$$S^ORU4(37,.CCNT,"ABO/Rh",.CCNT)_$$S^ORU4(47,.CCNT,"Location",.CCNT)_$$S^ORU4(67,.CCNT,"Exp. Date/Time",.CCNT) D LN
"RTN","ORWLR3",42,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(2,.CCNT,"-------",.CCNT)_$$S^ORU4(14,.CCNT,"-------",.CCNT)_$$S^ORU4(37,.CCNT,"------",.CCNT)_$$S^ORU4(47,.CCNT,"--------",.CCNT)_$$S^ORU4(67,.CCNT,"--------------",.CCNT) D LN
"RTN","ORWLR3",43,0)
 . K ^TMP("ORTMP",$J) N ORI,ORJ,ORL
"RTN","ORWLR3",44,0)
 . S ORI="" F  S ORI=$O(^TMP("VBDATA",$J,"UNIT",ORI)) Q:ORI=""  S ID=^(ORI) I $L($P(ID,"^",7)) D
"RTN","ORWLR3",45,0)
 .. S ^TMP("ORTMP",$J,$P(ID,"^",7),ORI)=ID
"RTN","ORWLR3",46,0)
 . S ORJ="" F  S ORJ=$O(^TMP("ORTMP",$J,ORJ)) Q:ORJ=""  S ORI="" F  S ORI=$O(^TMP("ORTMP",$J,ORJ,ORI)) Q:ORI=""  D
"RTN","ORWLR3",47,0)
 .. S ID=^TMP("VBDATA",$J,"UNIT",ORI)
"RTN","ORWLR3",48,0)
 .. Q:'$L($P(ID,"^"))
"RTN","ORWLR3",49,0)
 .. S T=$P(ID,"^"),X=$S($P(ID,"^",4)="P":"Pos",$P(ID,"^",4)="N":"Neg",1:$P(ID,"^",4)),ORL=""
"RTN","ORWLR3",50,0)
 .. I $L($P(ID,"^",5)) S ORL=$S($O(^DIC(4,"D",$$TRIM($P(ID,"^",5)),0)):$P(^DIC(4,$O(^(0)),0),"^"),1:"")
"RTN","ORWLR3",51,0)
 .. D T^ORWLR2,LN
"RTN","ORWLR3",52,0)
 .. S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(2,.CCNT,$P(ID,"^",8),.CCNT)_$$S^ORU4(14,.CCNT,$P(ID,"^",2),.CCNT)_$$S^ORU4(37,.CCNT,$P(ID,"^",3)_"  "_X,.CCNT)_$$S^ORU4(47,.CCNT,ORL,.CCNT)_$$S^ORU4(67,.CCNT,T,.CCNT)
"RTN","ORWLR3",53,0)
 K ^TMP("ORTMP",$J)
"RTN","ORWLR3",54,0)
 ;Specimen Tests
"RTN","ORWLR3",55,0)
 I $O(^TMP("VBDATA",$J,"SPECIMEN",0)) D
"RTN","ORWLR3",56,0)
 . D LINE^ORU4("^TMP(""ORLRC"",$J)",GIOM),LN
"RTN","ORWLR3",57,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(0,.CCNT,"DIAGNOSTIC TESTS:",.CCNT) D LN
"RTN","ORWLR3",58,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(2,.CCNT,"Test Name",.CCNT)_$$S^ORU4(35,.CCNT,"Result",.CCNT)_$$S^ORU4(55,.CCNT,"Date/Time",.CCNT) D LN
"RTN","ORWLR3",59,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(2,.CCNT,"---------",.CCNT)_$$S^ORU4(35,.CCNT,"------",.CCNT)_$$S^ORU4(55,.CCNT,"---------",.CCNT) D LN
"RTN","ORWLR3",60,0)
 . K ^TMP("ORTMP",$J)
"RTN","ORWLR3",61,0)
 . N ORI,ORJ,TST,ORT,CI,CJ,CX,CY,CZ
"RTN","ORWLR3",62,0)
 . S ORI="" F  S ORI=$O(^TMP("VBDATA",$J,"SPECIMEN",ORI),-1) Q:ORI=""  S ID=^(ORI) I $L($P(ID,"^",8)) D
"RTN","ORWLR3",63,0)
 .. S X=$P(ID,"^",5),TST=$S($E(X,1,3)="ABO":"a_",$E(X,1,3)="Rh ":"b_",1:"z_"),^TMP("ORTMP",$J,+$P(ID,"^",8),TST,ORI)=ID
"RTN","ORWLR3",64,0)
 . S ORJ="" F  S ORJ=$O(^TMP("ORTMP",$J,ORJ)) Q:ORJ=""  S ORT="" F  S ORT=$O(^TMP("ORTMP",$J,ORJ,ORT)) Q:ORT=""  S ORI="" F  S ORI=$O(^TMP("ORTMP",$J,ORJ,ORT,ORI)) Q:ORI=""  D
"RTN","ORWLR3",65,0)
 .. S ID=^TMP("VBDATA",$J,"SPECIMEN",ORI) ; ID=CPRS Order#^^^^Test^^Result^Date/time
"RTN","ORWLR3",66,0)
 .. Q:'$L($P(ID,"^",5))  S T=$P(ID,"^",8) D T^ORWLR2,LN
"RTN","ORWLR3",67,0)
 .. S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(2,.CCNT,$P(ID,"^",5),.CCNT)_$$S^ORU4(35,.CCNT,$P(ID,"^",7),.CCNT)_$$S^ORU4(55,.CCNT,T,.CCNT)
"RTN","ORWLR3",68,0)
 .. S ORK="",CZ="" F  S ORK=$O(^TMP("VBDATA",$J,"SPECIMEN",ORI,ORK)) Q:'ORK  S CX=CZ_^(ORK) I $L(CX) D
"RTN","ORWLR3",69,0)
 ... S CZ="" F CI=1:1:$L(CX," ") S CY=$P(CX," ",CI) D
"RTN","ORWLR3",70,0)
 .... I ORK>3,$O(^TMP("VBDATA",$J,"SPECIMEN",ORI,ORK))>3,CI=$L(CX," ") S CZ=CY Q
"RTN","ORWLR3",71,0)
 .... I $L(CY)>80 D  S CZ="" Q
"RTN","ORWLR3",72,0)
 ..... F CJ=1:80 S CZ=$E(CY,CJ,CJ+79) Q:'$L(CZ)  D LN S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(4,.CCNT,CZ,.CCNT)
"RTN","ORWLR3",73,0)
 .... I $L(CZ)+$L(CY)>80 D LN S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(4,.CCNT,CZ,.CCNT),CZ="" D  Q
"RTN","ORWLR3",74,0)
 ..... I $L(CY)>80 D
"RTN","ORWLR3",75,0)
 ...... F CJ=1:80 S CZ=$E(CY,CJ,CJ+79) Q:'$L(CZ)  D LN S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(4,.CCNT,CZ,.CCNT)
"RTN","ORWLR3",76,0)
 ...... S CZ=""
"RTN","ORWLR3",77,0)
 ..... E  S CZ=CY D
"RTN","ORWLR3",78,0)
 ...... I CI=$L(CX," ") D LN S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(4,.CCNT,CZ,.CCNT),CZ=""
"RTN","ORWLR3",79,0)
 .... S CZ=$S($L(CZ):CZ_" "_CY,1:CY) I $L(CZ)>80 D LN S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(4,.CCNT,CZ,.CCNT),CZ=""
"RTN","ORWLR3",80,0)
 .... I CI=$L(CX," ") D LN S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(4,.CCNT,CZ,.CCNT),CZ=""
"RTN","ORWLR3",81,0)
 K ^TMP("ORTMP",$J)
"RTN","ORWLR3",82,0)
 ;Component Requests
"RTN","ORWLR3",83,0)
 N A,F,%DT,Y
"RTN","ORWLR3",84,0)
 I $O(^TMP("VBDATA",$J,"COMPONENT REQUEST",0)) D
"RTN","ORWLR3",85,0)
 . D LINE^ORU4("^TMP(""ORLRC"",$J)",GIOM),LN
"RTN","ORWLR3",86,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(0,.CCNT,"COMPONENT REQUESTS:",.CCNT) D LN
"RTN","ORWLR3",87,0)
 . S X="Component Type"
"RTN","ORWLR3",88,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(2,.CCNT,X,.CCNT)_$$S^ORU4(22,.CCNT,"Units",.CCNT)_$$S^ORU4(28,.CCNT,"Request date",.CCNT)_$$S^ORU4(48,.CCNT,"Date wanted",.CCNT)_$$S^ORU4(68,.CCNT,"Requestor",.CCNT)_$$S^ORU4(78,.CCNT,"By",.CCNT) D LN
"RTN","ORWLR3",89,0)
 . S Y="--------------"
"RTN","ORWLR3",90,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(2,.CCNT,Y,.CCNT)_$$S^ORU4(22,.CCNT,"-----",.CCNT)_$$S^ORU4(28,.CCNT,"------------",.CCNT)_$$S^ORU4(48,.CCNT,"-----------",.CCNT)_$$S^ORU4(68,.CCNT,"---------",.CCNT)_$$S^ORU4(78,.CCNT,"--",.CCNT) D LN
"RTN","ORWLR3",91,0)
 . S A=0 F  S A=$O(^TMP("VBDATA",$J,"COMPONENT REQUEST",A)) Q:'A  D
"RTN","ORWLR3",92,0)
 .. S F=^TMP("VBDATA",$J,"COMPONENT REQUEST",A),T="",%DT="T",X=$P(F,"^",3),Y=-1
"RTN","ORWLR3",93,0)
 .. I $L(X) D ^%DT
"RTN","ORWLR3",94,0)
 .. I Y'=-1 S T=Y D T^ORWLR2
"RTN","ORWLR3",95,0)
 .. D LN
"RTN","ORWLR3",96,0)
 .. S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(2,.CCNT,$E($P(F,"^"),1,25),.CCNT)_$$S^ORU4(22,.CCNT,$J($P(F,"^",2),3),.CCNT)_$$S^ORU4(28,.CCNT,T,.CCNT)
"RTN","ORWLR3",97,0)
 .. S T="",%DT="T",X=$P(F,"^",4),Y=-1
"RTN","ORWLR3",98,0)
 .. I $L(X) D ^%DT
"RTN","ORWLR3",99,0)
 .. I Y'=-1 S T=Y D T^ORWLR2
"RTN","ORWLR3",100,0)
 .. S X=$S($P(F,"^",6):$P(F,"^",6)_",",1:""),X=$S($L(X):$$GET1^DIQ(200,X,1),1:$P(F,"^",6))
"RTN","ORWLR3",101,0)
 .. S REQX=$S($P(F,"^",5):$P(F,"^",5)_",",1:""),REQX=$S($L(REQX):$$GET1^DIQ(200,REQX,1),1:$P(F,"^",5))
"RTN","ORWLR3",102,0)
 .. S ^TMP("ORLRC",$J,GCNT,0)=^TMP("ORLRC",$J,GCNT,0)_$$S^ORU4(48,.CCNT,T,.CCNT)_$$S^ORU4(68,.CCNT,REQX,.CCNT)_$$S^ORU4(78,.CCNT,X,.CCNT)
"RTN","ORWLR3",103,0)
 ;Transfused Units
"RTN","ORWLR3",104,0)
 D TRAN^ORWLR2
"RTN","ORWLR3",105,0)
 Q
"RTN","ORWLR3",106,0)
LN ;Increment counts
"RTN","ORWLR3",107,0)
 S GCNT=GCNT+1,CCNT=1
"RTN","ORWLR3",108,0)
 Q
"RTN","ORWLR3",109,0)
TRIM(X) ;Trim leading and trailing spaces
"RTN","ORWLR3",110,0)
 S X=$RE(X) F  S:$E(X)=" " X=$E(X,2,999) Q:$E(X)'=" "  Q:'$L(X)  ;trail
"RTN","ORWLR3",111,0)
 S X=$RE(X) F  S:$E(X)=" " X=$E(X,2,999) Q:$E(X)'=" "  Q:'$L(X)  ;lead
"RTN","ORWLR3",112,0)
 Q X
"RTN","ORWRP1")
0^22^B70925932
"RTN","ORWRP1",1,0)
ORWRP1 ; ALB/MJK,dcm Report Calls ;9/18/96  15:02
"RTN","ORWRP1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,109,160,262,212**;Dec 17, 1997;Build 24
"RTN","ORWRP1",3,0)
 ;
"RTN","ORWRP1",4,0)
AHS(ROOT,ORDFN,ORHS,ALPHA,OMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ; - get adhoc health summary report
"RTN","ORWRP1",5,0)
 D START^ORWRP(80,"AHSB^ORWRP1(.ROOT,.ORDFN,.ORHS,.ALPHA,.OMEGA,.DTRANGE,.REMOTE,.ORMAX,.ORFHIE)")
"RTN","ORWRP1",6,0)
 Q
"RTN","ORWRP1",7,0)
AHSB(ROOT,ORDFN,ORHS,ALPHA,OMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ; -build adhoc health summary
"RTN","ORWRP1",8,0)
 N ORVP,GMTYP,Y
"RTN","ORWRP1",9,0)
 S ORVP=ORDFN_";DPT(",Y=$P($G(^GMT(142,+ORHS,0)),U),GMTSTYP=+ORHS
"RTN","ORWRP1",10,0)
 D ADHOC^ORPRS13
"RTN","ORWRP1",11,0)
 Q
"RTN","ORWRP1",12,0)
HS(ROOT,ORDFN,ORHS,ALPHA,OMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ; - get health summary report
"RTN","ORWRP1",13,0)
 D START^ORWRP(80,"HSB^ORWRP1(.ROOT,.ORDFN,.ORHS,.ALPHA,.OMEGA,.DTRANGE,.REMOTE,.ORMAX,.ORFHIE)")
"RTN","ORWRP1",14,0)
 Q
"RTN","ORWRP1",15,0)
HSB(ROOT,ORDFN,ORHS,ALPHA,OMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ; - build health summary report
"RTN","ORWRP1",16,0)
 N I,ICN,ORVP,GMTYP,Y,GMARXN,GMTSDLM,GMTSDTC,GMTSE,GMTSEGH,GMTSEGL,GMTSEGN,GMTSEGR,GMSEQ,GMTSHDR,GMTSLCMP,GMTSNDM,GMTSNPK,GMTSPG,GMTSPHDR,X
"RTN","ORWRP1",17,0)
 I $G(REMOTE) D  Q:'ORHS
"RTN","ORWRP1",18,0)
 . S Y=$O(^GMT(142,"E",$P(ORHS,";",2),0))
"RTN","ORWRP1",19,0)
 . I 'Y S Y=$O(^GMT(142,"E",$P($$UPPER^ORU(ORHS),";",2),0))
"RTN","ORWRP1",20,0)
 . I 'Y S I=0 F  S I=$O(^GMT(142,I)) Q:'I  I $L($P($G(^GMT(142,I,"T")),"^")),$P($$UPPER^ORU(ORHS),";",2)=$$UPPER^ORU(^("T")) S Y=I Q
"RTN","ORWRP1",21,0)
 . I 'Y S Y=$O(^GMT(142,"B",$P(ORHS,";",2),0))
"RTN","ORWRP1",22,0)
 . I 'Y S Y=$O(^GMT(142,"B",$P($$UPPER^ORU(ORHS),";",2),0))
"RTN","ORWRP1",23,0)
 . I 'Y S I=0 F  S I=$O(^GMT(142,I)) Q:'I  S X=$P(^(I,0),"^") I $P($$UPPER^ORU(ORHS),";",2)=$$UPPER^ORU(X) S Y=I Q
"RTN","ORWRP1",24,0)
 . I 'Y U IO W !,ORHS_" not found on remote system",! S ORHS=Y Q
"RTN","ORWRP1",25,0)
 . S ORHS=Y
"RTN","ORWRP1",26,0)
 I +$G(ORHS)<1 W !,"Report not Available" Q
"RTN","ORWRP1",27,0)
 S ORVP=ORDFN_";DPT(",Y=$P($G(^GMT(142,+ORHS,0)),U),GMTYP(0)=1,GMTYP(1)=+ORHS_U_Y_U_Y_U_Y
"RTN","ORWRP1",28,0)
 D PQ^ORPRS13
"RTN","ORWRP1",29,0)
 Q
"RTN","ORWRP1",30,0)
HSTYPE(ROOT,ORDFN,ORHS,ALPHA,OMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ; - Get HS type report
"RTN","ORWRP1",31,0)
 D START^ORWRP(80,"HSTYPEB^ORWRP1(.ROOT,.ORDFN,.ORHS,.ALPHA,.OMEGA,.DTRANGE,.REMOTE,.ORMAX,.ORFHIE)")
"RTN","ORWRP1",32,0)
 Q
"RTN","ORWRP1",33,0)
HSTYPEB(ROOT,ORDFN,ORHS,ALPHA,OMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ; - Build HS type report
"RTN","ORWRP1",34,0)
 N GMTSQIT,GMTSPRM,GMTSTITL,GMTSPX2,GMTSPX1
"RTN","ORWRP1",35,0)
 I $L($G(DTRANGE)),'$G(ALPHA) S ALPHA=$$FMADD^XLFDT(DT,-DTRANGE),OMEGA=$$NOW^XLFDT
"RTN","ORWRP1",36,0)
 Q:'$G(ALPHA)  Q:'$G(OMEGA)
"RTN","ORWRP1",37,0)
 I +$G(ORHS)<1 W !,"Report not Available" Q
"RTN","ORWRP1",38,0)
 S GMTSQIT=1,GMTSPRM=$P($G(^GMT(142.1,+ORHS,0)),"^",4),GMTSTITL="",GMTSPX2=ALPHA,GMTSPX1=OMEGA,DFN=ORDFN
"RTN","ORWRP1",39,0)
 D ENCWA^GMTS
"RTN","ORWRP1",40,0)
 Q
"RTN","ORWRP1",41,0)
HSGUI(DFN,GMTSTYP) ; - Call ENX^GMTSDVR to print HS Type for Patient
"RTN","ORWRP1",42,0)
 D ENX^GMTSDVR(DFN,GMTSTYP)
"RTN","ORWRP1",43,0)
 Q
"RTN","ORWRP1",44,0)
BLR(ROOT,ORDFN,ID,ALPHA,OMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ; -- get 'enhanced' blood bank report
"RTN","ORWRP1",45,0)
 D BB^ORWRP2
"RTN","ORWRP1",46,0)
 Q
"RTN","ORWRP1",47,0)
AP(ROOT,ORDFN,ID,ALPHA,OMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ; -- get Anatomic path report
"RTN","ORWRP1",48,0)
 N I,C,LINES,X
"RTN","ORWRP1",49,0)
 K ^TMP("LRC",$J),^TMP("LRH",$J)
"RTN","ORWRP1",50,0)
 D AP^LR7OSUM(ORDFN)
"RTN","ORWRP1",51,0)
 I '$O(^TMP("LRC",$J,0)) S ^TMP("LRC",$J,1,0)="",^TMP("LRC",$J,2,0)="No Anatomic Pathology reports available..."
"RTN","ORWRP1",52,0)
 S I=0
"RTN","ORWRP1",53,0)
 I $L($O(^TMP("LRH",$J,0))) S I=.001,^TMP("LRC",$J,I)="[HIDDEN TEXT]^" D
"RTN","ORWRP1",54,0)
 . S X="",C=2 F  S X=$O(^TMP("LRH",$J,X)) Q:X=""  S LINES(^(X))=X,C=C+1
"RTN","ORWRP1",55,0)
 . S $P(^TMP("LRC",$J,.001),"^",2)=C
"RTN","ORWRP1",56,0)
 . S X="" F  S X=$O(LINES(X)) Q:X=""  D
"RTN","ORWRP1",57,0)
 .. S I=I+.001,^TMP("LRC",$J,I)=X_"^"_LINES(X)
"RTN","ORWRP1",58,0)
 . S I=I+.001,^TMP("LRC",$J,I)="[REPORT TEXT]"
"RTN","ORWRP1",59,0)
 S ROOT=$NA(^TMP("LRC",$J))
"RTN","ORWRP1",60,0)
 K ^TMP("LRH",$J)
"RTN","ORWRP1",61,0)
 Q
"RTN","ORWRP1",62,0)
DIET(ROOT,DFN,ID,ALPHA,OMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ; -- get dietetics profile
"RTN","ORWRP1",63,0)
 N LCNT,ORVP
"RTN","ORWRP1",64,0)
 S LCNT=0,ORVP=DFN_";DPT("
"RTN","ORWRP1",65,0)
 D FHP^ORCXPNDR
"RTN","ORWRP1",66,0)
 S ROOT=$NA(^TMP("ORXPND",$J))
"RTN","ORWRP1",67,0)
 Q
"RTN","ORWRP1",68,0)
LISTNUTR(ROOT,DFN) ; -- list nutritional assessments
"RTN","ORWRP1",69,0)
 N OK,I,X,SITE
"RTN","ORWRP1",70,0)
 K ^TMP($J,"FHADT")
"RTN","ORWRP1",71,0)
 S OK=$$FHWORADT^FHWORA(DFN)
"RTN","ORWRP1",72,0)
 S I=0,SITE=$$SITE^VASITE,SITE=$P(SITE,"^",2)_";"_$P(SITE,"^",3)
"RTN","ORWRP1",73,0)
 F  S I=$O(^TMP($J,"FHADT",DFN,I)) Q:'I  S X=SITE_U_I_U_^(I),^(I)=X
"RTN","ORWRP1",74,0)
 S ROOT=$NA(^TMP($J,"FHADT",DFN))
"RTN","ORWRP1",75,0)
 Q
"RTN","ORWRP1",76,0)
NUTR(ROOT,DFN,ID,ALPHA,OMEGA,ORDTRNG,REMOTE,ORMAX,ORFHIE) ; -- get nutritional assessment
"RTN","ORWRP1",77,0)
 N LCNT,ORVP
"RTN","ORWRP1",78,0)
 K ^TMP("ORXPND",$J)
"RTN","ORWRP1",79,0)
 S LCNT=0,ORVP=DFN_";DPT(",ID=DFN_";"_ID
"RTN","ORWRP1",80,0)
 D FHA^ORCXPNDR
"RTN","ORWRP1",81,0)
 S ROOT=$NA(^TMP("ORXPND",$J))
"RTN","ORWRP1",82,0)
 Q
"RTN","ORWRP1",83,0)
VITALS(ROOT,ORDFN,ID,ALPHA,OMEGA,ORDTRNG,REMOTE,ORMAX,ORFHIE) ; -- get vitals report
"RTN","ORWRP1",84,0)
 D START^ORWRP(132,"VITALSB^ORWRP1(.ROOT,.ORDFN,.ID,.ALPHA,.OMEGA,.ORDTRNG,.REMOTE,.ORMAX,.ORFHIE)")
"RTN","ORWRP1",85,0)
 Q
"RTN","ORWRP1",86,0)
VITALSB(ROOT,ORDFN,ID,ALPHA,OMEGA,ORDTRNG,REMOTE,ORMAX,ORFHIE) ; -- build vitals report
"RTN","ORWRP1",87,0)
 N ORVP,XQORNOD,ORSSTRT,ORSSTOP
"RTN","ORWRP1",88,0)
 Q:'$G(ORDFN)
"RTN","ORWRP1",89,0)
 I $L(ORDTRNG),'$G(ALPHA) S ALPHA=$$FMADD^XLFDT(DT,-ORDTRNG),OMEGA=$$NOW^XLFDT
"RTN","ORWRP1",90,0)
 Q:'$G(ALPHA)  Q:'$G(OMEGA)
"RTN","ORWRP1",91,0)
 I '$P(OMEGA,".",2) S OMEGA=OMEGA_".2359"
"RTN","ORWRP1",92,0)
 S ORVP=ORDFN_";DPT(",XQORNOD=1,ORSSTRT(XQORNOD)=ALPHA,ORSSTOP(XQORNOD)=OMEGA
"RTN","ORWRP1",93,0)
 D VITCUM^ORPRS14
"RTN","ORWRP1",94,0)
 Q
"RTN","ORWRP1",95,0)
STAT(ROOT,ORDFN,ID,ORALPHA,OROMEGA,ORDTRNG,REMOTE,ORMAX,ORFHIE) ;Lab Order Status
"RTN","ORWRP1",96,0)
 N ORVP
"RTN","ORWRP1",97,0)
 K ^TMP("ORDATA",$J)
"RTN","ORWRP1",98,0)
 S ORVP=ORDFN_";DPT("
"RTN","ORWRP1",99,0)
 D EN1^LR7OSOS1(.ORY,ORVP,.ORALPHA,.OROMEGA,.ORDTRNG)
"RTN","ORWRP1",100,0)
 I '$O(^TMP("ORDATA",$J,1,0)) S ^TMP("ORDATA",$J,1,1,0)="",^TMP("ORDATA",$J,1,2,0)="No Orders found..."
"RTN","ORWRP1",101,0)
 S ROOT=ORY
"RTN","ORWRP1",102,0)
 Q
"RTN","ORWRP1",103,0)
INTERIM(ROOT,ORDFN,ID,ORALPHA,OROMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ;Lab Interim
"RTN","ORWRP1",104,0)
 D START^ORWRP(80,"INTERIMB^ORWRP1(.ROOT,.ORDFN,.ID,.ORALPHA,.OROMEGA,.DTRANGE,.REMOTE,.ORMAX,.ORFHIE)")
"RTN","ORWRP1",105,0)
 Q
"RTN","ORWRP1",106,0)
INTERIMB(ROOT,DFN,ID,ALPHA,OMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ;Build Interim
"RTN","ORWRP1",107,0)
 Q:'$G(DFN)  Q:'$G(ALPHA)  Q:'$G(OMEGA)
"RTN","ORWRP1",108,0)
 N ORVP,XQORNOD,ORSSTRT,ORSSTOP,LRACC,LRAD,LRAN,LRRT,LRPG,LRSB,LREDT,LRIDT
"RTN","ORWRP1",109,0)
 S ORVP=DFN_";DPT(",XQORNOD=1,(ORSSTRT(XQORNOD),LREDT)=(9999999-ALPHA),(ORSSTOP(XQORNOD),LRIDT)=(9999999-OMEGA)
"RTN","ORWRP1",110,0)
 D OERR^LRRP4,CLEAN^LRRP4
"RTN","ORWRP1",111,0)
 Q
"RTN","ORWRP1",112,0)
LRGEN(ROOT,ORDFN,ID,ORALPHA,OROMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ;Lab results by test
"RTN","ORWRP1",113,0)
 D START^ORWRP(80,"LRGENB^ORWRP1(.ROOT,.ORDFN,.ID,.ORALPHA,.OROMEGA,.DTRANGE,.REMOTE,.ORMAX,.ORFHIE)")
"RTN","ORWRP1",114,0)
 Q
"RTN","ORWRP1",115,0)
LRGENB(ROOT,DFN,ID,ALPHA,OMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ;Build Results
"RTN","ORWRP1",116,0)
 Q:'$G(DFN)  Q:'$G(ALPHA)  Q:'$G(OMEGA)
"RTN","ORWRP1",117,0)
 N ORVP,ORSSTRT,ORSSTOP,LREDT,LRSDT,XQORNOD
"RTN","ORWRP1",118,0)
 S ORVP=DFN_";DPT(",XQORNOD=1,(ORSSTRT(XQORNOD),LREDT)=(9999999-ALPHA),(ORSSTOP(XQORNOD),LRSDT)=(9999999-OMEGA)
"RTN","ORWRP1",119,0)
 D SET1^LRGEN,CLEAN^LRRP4
"RTN","ORWRP1",120,0)
 K LRPR
"RTN","ORWRP1",121,0)
 Q
"RTN","ORWRP1",122,0)
GRAPH(ROOT,ORDFN,ID,ORALPHA,OROMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ;Graph labs
"RTN","ORWRP1",123,0)
 D START^ORWRP(80,"GRAPHB^ORWRP1(.ROOT,.ORDFN,.ID,.ORALPHA,.OROMEGA,.DTRANGE,.REMOTE,.ORMAX,.ORFHIE)")
"RTN","ORWRP1",124,0)
 Q
"RTN","ORWRP1",125,0)
GRAPHB(ROOT,DFN,ID,ALPHA,OMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ;Graph labs
"RTN","ORWRP1",126,0)
 Q:'$G(DFN)  Q:'$G(ALPHA)  Q:'$G(OMEGA)
"RTN","ORWRP1",127,0)
 N ORVP,XQORNOD,ORSSTRT,ORSSTOP,LREDT,LRSDT
"RTN","ORWRP1",128,0)
 S ORVP=DFN_";DPT(",XQORNOD=1,(ORSSTRT(XQORNOD),LREDT)=ALPHA,(ORSSTOP(XQORNOD),LRSDT)=OMEGA
"RTN","ORWRP1",129,0)
 D OERR^LRDIST4,CLEAN^LRDIST4
"RTN","ORWRP1",130,0)
 Q
"RTN","ORWRP1",131,0)
ORS(ROOT,ORDFN,ID,ALPHA,OMEGA,ORDTRNG,REMOTE,ORMAX,ORFHIE) ;Daily order summary
"RTN","ORWRP1",132,0)
 D START^ORWRP(80,"ORSB^ORWRP1(.ROOT,.ORDFN,.ID,.ALPHA,.OMEGA,.ORDTRNG,.REMOTE,.ORMAX,.ORFHIE)")
"RTN","ORWRP1",133,0)
 Q
"RTN","ORWRP1",134,0)
ORSB(ROOT,DFN,ID,ALPHA,OMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ;Daily order summary
"RTN","ORWRP1",135,0)
 N ORVP,XQORNOD,ORSSTRT,ORSSTOP
"RTN","ORWRP1",136,0)
 S ORVP=DFN_";DPT(",XQORNOD=1,X1=DT,X2=-$S(DTRANGE:DTRANGE-1,1:0)
"RTN","ORWRP1",137,0)
 D C^%DTC
"RTN","ORWRP1",138,0)
 S ORSSTRT=X-.7641,ORSSTOP=DT+.2359
"RTN","ORWRP1",139,0)
 D DAY^ORPRS02
"RTN","ORWRP1",140,0)
 Q
"RTN","ORWRP1",141,0)
ORD(ROOT,ORDFN,ID,ORALPHA,OROMEGA,ORDTRNG,REMOTE,ORMAX,ORFHIE) ;Order Summary for Date Range
"RTN","ORWRP1",142,0)
 D START^ORWRP(80,"ORDB^ORWRP1(.ROOT,.ORDFN,.ID,.ORALPHA,.OROMEGA,.ORDTRNG,.REMOTE,.ORMAX,.ORFHIE)")
"RTN","ORWRP1",143,0)
 Q
"RTN","ORWRP1",144,0)
ORDB(ROOT,DFN,ID,ALPHA,OMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ;Order Summary for Date Range
"RTN","ORWRP1",145,0)
 Q:'$G(DFN)
"RTN","ORWRP1",146,0)
 I $L($G(DTRANGE)),'$G(ALPHA) S ALPHA=$$FMADD^XLFDT(DT,-DTRANGE),OMEGA=$$NOW^XLFDT
"RTN","ORWRP1",147,0)
 Q:'$G(ALPHA)  Q:'$G(OMEGA)
"RTN","ORWRP1",148,0)
 N ORVP,XQORNOD,ORSSTRT,ORSSTOP
"RTN","ORWRP1",149,0)
 S ORVP=DFN_";DPT(",XQORNOD=1,ORSSTRT=ALPHA,ORSSTOP=OMEGA
"RTN","ORWRP1",150,0)
 D RANGE^ORPRS02
"RTN","ORWRP1",151,0)
 Q
"RTN","ORWRP1",152,0)
ORC(ROOT,ORDFN,ID,ORALPHA,OROMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ;Custom order summary
"RTN","ORWRP1",153,0)
 D START^ORWRP(80,"ORCB^ORWRP1(.ROOT,.ORDFN,.ID,.ORALPHA,.OROMEGA,.DTRANGE,.REMOTE,.ORMAX,.ORFHIE)")
"RTN","ORWRP1",154,0)
 Q
"RTN","ORWRP1",155,0)
ORCB(ROOT,DFN,ID,ALPHA,OMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ;Custom order summary build
"RTN","ORWRP1",156,0)
 Q:'$G(DFN)  Q:'$G(ALPHA)  Q:'$G(OMEGA)
"RTN","ORWRP1",157,0)
 N ORVP,XQORNOD,ORSSTRT,ORSSTOP
"RTN","ORWRP1",158,0)
 S ORVP=DFN_";DPT(",XQORNOD=1,ORSSTRT=ALPHA,ORSSTOP=OMEGA
"RTN","ORWRP1",159,0)
 D CUSTOM^ORPRS02
"RTN","ORWRP1",160,0)
 Q
"RTN","ORWRP1",161,0)
ORP(ROOT,ORDFN,ID,ORALPHA,OROMEGA,ORDTRNG,REMOTE,ORMAX,ORFHIE) ;Chart copy summary
"RTN","ORWRP1",162,0)
 D START^ORWRP(80,"ORPB^ORWRP1(.ROOT,.ORDFN,.ID,.ORALPHA,.OROMEGA,.ORDTRNG,.REMOTE,.ORFHIE)")
"RTN","ORWRP1",163,0)
 Q
"RTN","ORWRP1",164,0)
ORPB(ROOT,DFN,ID,ALPHA,OMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ;Chart copy summary
"RTN","ORWRP1",165,0)
 Q:'$G(DFN)
"RTN","ORWRP1",166,0)
 I $L($G(DTRANGE)),'$G(ALPHA) S ALPHA=$$FMADD^XLFDT(DT,-DTRANGE),OMEGA=$$NOW^XLFDT
"RTN","ORWRP1",167,0)
 Q:'$G(ALPHA)  Q:'$G(OMEGA)
"RTN","ORWRP1",168,0)
 N ORVP,XQORNOD,ORSSTRT,ORSSTOP
"RTN","ORWRP1",169,0)
 S ORVP=DFN_";DPT(",XQORNOD=1,ORSSTRT=ALPHA,ORSSTOP=OMEGA
"RTN","ORWRP1",170,0)
 D CHART^ORPRS02
"RTN","ORWRP1",171,0)
 Q
"RTN","ORWRP1",172,0)
PSO(ROOT,ORDFN,ID,ALPHA,OMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ;Outpatient RX Profile
"RTN","ORWRP1",173,0)
 D START^ORWRP(80,"PSOB^ORWRP1(.ROOT,.ORDFN,.ID,.ALPHA,.OMEGA,.DTRANGE,.REMOTE,.ORFHIE)")
"RTN","ORWRP1",174,0)
 Q
"RTN","ORWRP1",175,0)
PSOB(ROOT,DFN,ID,ALPHA,OMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ;Outpatient RX Action Profile
"RTN","ORWRP1",176,0)
 N ORVP,PSTYPE,PSONOPG
"RTN","ORWRP1",177,0)
 S ORVP=DFN_";DPT(",PSTYPE=1,PSONOPG=2
"RTN","ORWRP1",178,0)
 D DFN^PSOSD1
"RTN","ORWRP1",179,0)
 Q
"RTN","ORWRP1",180,0)
MED(ROOT,ORDFN,IID,ALPHA,OMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ;Medicine Summary of Procedures
"RTN","ORWRP1",181,0)
 D START^ORWRP(80,"MEDB^ORWRP1(.ROOT,.ORDFN,.IID,.ALPHA,.OMEGA,.DTRANGE,.REMOTE,.ORMAX,.ORFHIE)")
"RTN","ORWRP1",182,0)
 Q
"RTN","ORWRP1",183,0)
MEDB(ROOT,DFN,IID,ALPHA,OMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ;Medicine Summary of Procedures
"RTN","ORWRP1",184,0)
 Q:'$L($G(IID))
"RTN","ORWRP1",185,0)
 N ORVP,XQY0,OT,MCARPPS,MCPRO,MCARGRTN,DXS,SSN,I,J,L,DA,MCARGDA
"RTN","ORWRP1",186,0)
 S ORVP=DFN_";DPT(",XQY0="",OT=$G(^TMP("OR",$J,"MCAR","OT",IID))
"RTN","ORWRP1",187,0)
 Q:'$L(OT)
"RTN","ORWRP1",188,0)
 S (DA,MCARGDA)=$P(OT,U,2),MCARPPS=$P(OT,U,3,4),MCPRO=$P(OT,U,11)
"RTN","ORWRP1",189,0)
 D MCPPROC^MCARP
"RTN","ORWRP1",190,0)
 S MCARGRTN=$P(OT,U,5)
"RTN","ORWRP1",191,0)
 D @MCARPPS
"RTN","ORWRP1",192,0)
 Q
"RTN","ORWRP1",193,0)
PROB(ROOT,ORDFN,IID,ALPHA,OMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ; Problem List (Problem Tab)
"RTN","ORWRP1",194,0)
 D START^ORWRP(80,"PROBB^ORWRP1(.ROOT,.ORDFN,.IID,.ALPHA,.OMEGA,.DTRANGE,.REMOTE,.ORMAX,.ORFHIE)")
"RTN","ORWRP1",195,0)
 Q
"RTN","ORWRP1",196,0)
PROBB(ROOT,DFN,IID,ALPHA,OMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ;Problem List
"RTN","ORWRP1",197,0)
 N ORSILENT S ORSILENT=1
"RTN","ORWRP1",198,0)
 D VAF^GMPLUTL2(DFN,ORSILENT)
"RTN","ORWRP1",199,0)
 Q
"RTN","ORWRP2")
0^23^B14652707
"RTN","ORWRP2",1,0)
ORWRP2 ; dcm/slc - Health Summary adhoc RPC's
"RTN","ORWRP2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,109,212**;Dec 17, 1997;Build 24
"RTN","ORWRP2",3,0)
BB ;Continuation of Blood Bank Report
"RTN","ORWRP2",4,0)
 N DFN,ORY,ORSBHEAD,GCNT
"RTN","ORWRP2",5,0)
 S DFN=ORDFN,GCNT=0
"RTN","ORWRP2",6,0)
 K ^TMP("LRC",$J)
"RTN","ORWRP2",7,0)
 S ROOT=$NA(^TMP("LRC",$J))
"RTN","ORWRP2",8,0)
 I $$GET^XPAR("DIV^SYS^PKG","OR VBECS ON",1,"Q"),$L($T(EN^ORWLR1)),$L($T(CPRS^VBECA3B)) D  Q  ;Transition to VBEC's interface
"RTN","ORWRP2",9,0)
 . K ^TMP("ORLRC",$J)
"RTN","ORWRP2",10,0)
 . D EN^ORWLR1(DFN)
"RTN","ORWRP2",11,0)
 . I '$O(^TMP("ORLRC",$J,0)) S GCNT=GCNT+1,^TMP("ORLRC",$J,GCNT,0)="",GCNT=GCNT+1,^TMP("ORLRC",$J,GCNT,0)="No VBECS Blood Bank report available..."
"RTN","ORWRP2",12,0)
 . M ^TMP("LRC",$J)=^TMP("ORLRC",$J)
"RTN","ORWRP2",13,0)
 . K ^TMP("ORLRC",$J)
"RTN","ORWRP2",14,0)
 . I $$GET^XPAR("DIV^SYS^PKG","OR VBECS LEGACY REPORT",1,"Q") D
"RTN","ORWRP2",15,0)
 .. S GCNT=$S($O(^TMP("ORLRC",$J,""),-1):$O(^(""),-1),1:1)
"RTN","ORWRP2",16,0)
 .. D BLEG
"RTN","ORWRP2",17,0)
 D BLEG
"RTN","ORWRP2",18,0)
 Q
"RTN","ORWRP2",19,0)
BLEG ;Legacy VISTA Blood Bank Report
"RTN","ORWRP2",20,0)
 S ORSBHEAD("BLOOD BANK")=""
"RTN","ORWRP2",21,0)
 D EN^LR7OSUM(.ORY,DFN,,,,,.ORSBHEAD)
"RTN","ORWRP2",22,0)
 I '$O(^TMP("LRC",$J,0)) S GCNT=GCNT+1,^TMP("LRC",$J,GCNT,0)="",GCNT=GCNT+1,^TMP("LRC",$J,GCNT,0)="No Blood Bank report available..."
"RTN","ORWRP2",23,0)
 Q
"RTN","ORWRP2",24,0)
COMP(ORY) ;Get ADHOC sub components (FILE 142.1)
"RTN","ORWRP2",25,0)
 ;RPC => ORWRP2 HS COMPONENTS
"RTN","ORWRP2",26,0)
 ;Y(i)=(1)I;IFN^(2)Component Name [Abb]^(3)Occ Limit^(4)Time Limit^(5)Header Name^
"RTN","ORWRP2",27,0)
 ;     (6)Hosp Loc Disp^(7)ICD Text Disp^(8)Prov Narr Disp^(9)Summary Order
"RTN","ORWRP2",28,0)
 D COMP^GMTSADH5(.ORY)
"RTN","ORWRP2",29,0)
 Q
"RTN","ORWRP2",30,0)
 ;
"RTN","ORWRP2",31,0)
COMPABV(ORY) ;Get ADHOD sub components listed by Abbreviation
"RTN","ORWRP2",32,0)
 N I,X,X1,X2,X3
"RTN","ORWRP2",33,0)
 D COMP^GMTSADH5(.ORY)
"RTN","ORWRP2",34,0)
 S I=0
"RTN","ORWRP2",35,0)
 F  S I=$O(ORY(I)) Q:'I  S X=ORY(I) D
"RTN","ORWRP2",36,0)
 . S X1=$P($P(X,"^",2),"["),X1=$E(X1,1,$L(X1)-1),X2=$P($P(X,"^",2),"[",2),X2=$E(X2,1,$L(X2)-1)
"RTN","ORWRP2",37,0)
 . ;S X3=X2_"     - "_X1_" ",$P(ORY(I),"^",2)=X3
"RTN","ORWRP2",38,0)
 . S X3=X2_"   - "_$P(X,"^",5)_" ",$P(ORY(I),"^",2)=X3
"RTN","ORWRP2",39,0)
 Q
"RTN","ORWRP2",40,0)
COMPDISP(ORY) ;Get ADHOD sub components listed by Display Name
"RTN","ORWRP2",41,0)
 N I,X,X1,X2,X3
"RTN","ORWRP2",42,0)
 D COMP^GMTSADH5(.ORY)
"RTN","ORWRP2",43,0)
 S I=0
"RTN","ORWRP2",44,0)
 F  S I=$O(ORY(I)) Q:'I  S X=ORY(I) D
"RTN","ORWRP2",45,0)
 . S X1=$P($P(X,"^",2),"["),X1=$E(X1,1,$L(X1)-1),X2=$P($P(X,"^",2),"[",2),X2=$E(X2,1,$L(X2)-1)
"RTN","ORWRP2",46,0)
 . S X3=$P(X,"^",5)_"   ["_X2_"]",$P(ORY(I),"^",2)=X3
"RTN","ORWRP2",47,0)
 Q
"RTN","ORWRP2",48,0)
COMPSUB(ORY,ORSUB) ;Get subitems from a predefined Adhoc component
"RTN","ORWRP2",49,0)
 I '$L($T(COMPSUB^GMTSADH5)) Q
"RTN","ORWRP2",50,0)
 D COMPSUB^GMTSADH5(.ORY,ORSUB)
"RTN","ORWRP2",51,0)
 Q
"RTN","ORWRP2",52,0)
 ;
"RTN","ORWRP2",53,0)
SAVLKUP(OK,VAL) ;save Adhoc lookup selection
"RTN","ORWRP2",54,0)
 N ORERR
"RTN","ORWRP2",55,0)
 S OK=""
"RTN","ORWRP2",56,0)
 D EN^XPAR(DUZ_";VA(200,","ORWRP ADHOC LOOKUP",1,VAL,.ORERR)
"RTN","ORWRP2",57,0)
 I ORERR S OK=VAL_":"_ORERR
"RTN","ORWRP2",58,0)
 Q
"RTN","ORWRP2",59,0)
GETLKUP(ORY) ;Get Adhoc lookup selection
"RTN","ORWRP2",60,0)
 S ORY=$$GET^XPAR("ALL","ORWRP ADHOC LOOKUP",1,"I")
"RTN","ORWRP2",61,0)
 Q
"RTN","ORWRP2",62,0)
FILES(ORY,ORCOMP) ;Get Files to select from for a component
"RTN","ORWRP2",63,0)
 ;RPC => ORWRP2 HS COMP FILES
"RTN","ORWRP2",64,0)
 D FILES^GMTSADH5(.ORY,ORCOMP)
"RTN","ORWRP2",65,0)
 Q
"RTN","ORWRP2",66,0)
 ;
"RTN","ORWRP2",67,0)
FILESEL(OROOT,ORFILE,ORFROM,ORDIR) ;Get file entries for Combobox
"RTN","ORWRP2",68,0)
 ;RPC => ORWRP2 HS FILE LOOKUP
"RTN","ORWRP2",69,0)
 D FILESEL^GMTSADH5(.OROOT,ORFILE,ORFROM,ORDIR)
"RTN","ORWRP2",70,0)
 Q
"RTN","ORWRP2",71,0)
 ;
"RTN","ORWRP2",72,0)
REPORT(OROOT,ORCOMPS,ORDFN) ;Build Report from array of Components passed in COMPS
"RTN","ORWRP2",73,0)
 ;RPC => ORWRP2 HS REPORT TEXT
"RTN","ORWRP2",74,0)
 ;ORCOMPS(i)=array of subcomponents chosen, value is pointer at ^GMT(142,DA(1),1,DA)
"RTN","ORWRP2",75,0)
 Q:'$G(ORDFN)
"RTN","ORWRP2",76,0)
 N GMTSEGC,GMTSEG,ORGMTSEG,ORSEGC,ORSEGI
"RTN","ORWRP2",77,0)
 K ^TMP("ORDATA",$J)
"RTN","ORWRP2",78,0)
 D REPORT^GMTSADH5(.ORGMTSEG,.ORSEGC,.ORSEGI,.ORCOMPS,.ORDFN)
"RTN","ORWRP2",79,0)
 Q:'$O(ORGMTSEG(0))
"RTN","ORWRP2",80,0)
 D START^ORWRP(80,"REPORT1^ORWRP2(.ORGMTSEG,.ORSEGC,.ORSEGI,ORDFN)")
"RTN","ORWRP2",81,0)
 S OROOT=$NA(^TMP("ORDATA",$J,1))
"RTN","ORWRP2",82,0)
 Q
"RTN","ORWRP2",83,0)
REPORT1(GMTSEG,GMTSEGC,GMTSEGI,DFN) ;
"RTN","ORWRP2",84,0)
 N GMTS,GMTS1,GMTS2,GMTSAGE,GMTSDOB,GMTSDTM,GMTSLO,GMTSLPG,GMTSPHDR,GMTSPNM,GMTSRB,GMTSSN,GMTSWRD
"RTN","ORWRP2",85,0)
 N CNT,INC,ORVP,ROOT,SEX,VADM,VAERR,VAIN
"RTN","ORWRP2",86,0)
 S ORVP=DFN
"RTN","ORWRP2",87,0)
 D ADHOC^ORPRS13
"RTN","ORWRP2",88,0)
 Q
"RTN","ORWRP2",89,0)
 ;
"RTN","ORWRP2",90,0)
SUBITEM(ORY,ORTEST) ;Get Subitems for a Test Panel
"RTN","ORWRP2",91,0)
 ;RPC => ORWRP2 HS SUBITEMS
"RTN","ORWRP2",92,0)
 D SUBITEM^GMTSADH5(.ORY,ORTEST)
"RTN","ORWRP2",93,0)
 Q
"RTN","ORWRP2",94,0)
PREPORT(OROOT,ORCOMPS,ORDFN) ;Build Report & Print
"RTN","ORWRP2",95,0)
 ;Called from File|Print on Reports Tab after selecting ADHOC Health Summary
"RTN","ORWRP2",96,0)
 ;COMPS(i)=array of subcomponents chosen, value is pointer at ^GMT(142,DA(1),1,DA)
"RTN","ORWRP2",97,0)
 Q:'$G(ORDFN)
"RTN","ORWRP2",98,0)
 N GMTSEGC,GMTSEG,ORGMTSEG,ORSEGC,ORSEGI
"RTN","ORWRP2",99,0)
 D REPORT^GMTSADH5(.ORGMTSEG,.ORSEGC,.ORSEGI,.ORCOMPS,.ORDFN)
"RTN","ORWRP2",100,0)
 Q:'$O(ORGMTSEG(0))
"RTN","ORWRP2",101,0)
 M GMTSEG=ORGMTSEG,GMTSEGC=ORSEGC,GMTSEGI=ORSEGI
"RTN","ORWRP2",102,0)
 N GMTS,GMTS1,GMTS2,GMTSAGE,GMTSDOB,GMTSDTM,GMTSLO,GMTSLPG,GMTSPHDR,GMTSPNM,GMTSRB,GMTSSN,GMTSWRD
"RTN","ORWRP2",103,0)
 N CNT,INC,ORVP,ROOT,SEX,VADM,VAERR,VAIN
"RTN","ORWRP2",104,0)
 S ORVP=ORDFN
"RTN","ORWRP2",105,0)
 D ADHOC^ORPRS13
"RTN","ORWRP2",106,0)
 Q
"RTN","ORY212")
0^11^B15841555
"RTN","ORY212",1,0)
ORY212 ;SLC/MKB - postinit for OR*3*212 ;2/11/08  11:06
"RTN","ORY212",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**212**;Dec 17, 1997;Build 24
"RTN","ORY212",3,0)
 ;
"RTN","ORY212",4,0)
PRE ; -- preinit [clean up test accounts]
"RTN","ORY212",5,0)
 D DAT
"RTN","ORY212",6,0)
 Q
"RTN","ORY212",7,0)
 ;
"RTN","ORY212",8,0)
DLGSEND(X) ; -- Send order dialog X?
"RTN","ORY212",9,0)
 I X="VBEC BLOOD BANK" Q 1
"RTN","ORY212",10,0)
 I X="OR GTX AMOUNT" Q 1
"RTN","ORY212",11,0)
 I X="OR GTX DATE/TIME" Q 1
"RTN","ORY212",12,0)
 I X="OR GTX LAB ORDER" Q 1
"RTN","ORY212",13,0)
 I X="OR GTX RBC MODIFIERS" Q 1
"RTN","ORY212",14,0)
 I X="OR GTX REASON" Q 1
"RTN","ORY212",15,0)
 I X="OR GTX RESULTS" Q 1
"RTN","ORY212",16,0)
 I X="OR GTX SPECIMEN STATUS" Q 1
"RTN","ORY212",17,0)
 I X="OR GTX TEXT" Q 1
"RTN","ORY212",18,0)
 ;I X="OR GTX TRANSFUSION" Q 1
"RTN","ORY212",19,0)
 Q 0
"RTN","ORY212",20,0)
 ;
"RTN","ORY212",21,0)
POST ; -- postinit
"RTN","ORY212",22,0)
 D DGRP,URG,ORDITMS ;,COMP
"RTN","ORY212",23,0)
 D MAIN^ORY212P ;install parameter values [created by ^XPARTPV]
"RTN","ORY212",24,0)
 Q
"RTN","ORY212",25,0)
 ;
"RTN","ORY212",26,0)
DGRP ; -- ck Default Dialog, Members
"RTN","ORY212",27,0)
 N VB,ORI,X,Y,DA,DIC,DLAYGO,DO,DD,DR,DIE
"RTN","ORY212",28,0)
 S VB=+$O(^ORD(100.98,"B","VBEC",0)) I VB D
"RTN","ORY212",29,0)
 . S X=$P($G(^ORD(100.98,VB,0)),U,4) D:X'>0  ;Default Dialog
"RTN","ORY212",30,0)
 .. S X=+$O(^ORD(101.41,"B","VBEC BLOOD BANK",0))
"RTN","ORY212",31,0)
 .. S:X $P(^ORD(100.98,VB,0),U,4)=X
"RTN","ORY212",32,0)
 . S DA(1)=VB,DIE="^ORD(100.98,"_VB_",1,"    ;Members
"RTN","ORY212",33,0)
 . F ORI="1^VBC","2^VBT" D
"RTN","ORY212",34,0)
 .. S X=+$G(^ORD(100.98,VB,1,+ORI,0))
"RTN","ORY212",35,0)
 .. I $P($G(^ORD(100.98,X,0)),U,3)'=$P(ORI,U,2) S DA=+ORI,DR=".01///"_$P(ORI,U,2) D ^DIE
"RTN","ORY212",36,0)
 S DA(1)=$O(^ORD(100.98,"B","BB",0)) Q:'DA(1)
"RTN","ORY212",37,0)
 Q:$O(^ORD(100.98,DA(1),1,"B",VB,0))  ;already linked
"RTN","ORY212",38,0)
 S:'$D(^ORD(100.98,DA(1),1,0)) ^(0)="^100.981P^^"
"RTN","ORY212",39,0)
 S DIC="^ORD(100.98,"_DA(1)_",1,",DIC(0)="NLX",DLAYGO=100.98
"RTN","ORY212",40,0)
 S X="BLOOD PRODUCTS" K Y D ^DIC
"RTN","ORY212",41,0)
 Q
"RTN","ORY212",42,0)
 ;
"RTN","ORY212",43,0)
URG ; -- create new PRE-OP urgency, add VBEC usage to STAT,ROUTINE
"RTN","ORY212",44,0)
 N HDR,ORI,IEN
"RTN","ORY212",45,0)
 I '$O(^ORD(101.42,"B","PRE-OP",0)) D  ;add to file [at ien #3]
"RTN","ORY212",46,0)
 . S HDR=$G(^ORD(101.42,0)),^(0)=$P(HDR,U,1,3)_U_($P(HDR,U,4)+1),IEN=3
"RTN","ORY212",47,0)
 . I $L($G(^ORD(101.42,3,0))) S IEN=$O(^ORD(101.42,90),-1) ;before DONE
"RTN","ORY212",48,0)
 . S ^ORD(101.42,IEN,0)="PRE-OP^P",^(1,0)="^101.421A^1^1",^(1,0)="VBEC"
"RTN","ORY212",49,0)
 . S ^ORD(101.42,IEN,1,"B","VBEC",1)="",^ORD(101.42,"S.VBEC","PRE-OP",IEN)=""
"RTN","ORY212",50,0)
 . S ^ORD(101.42,"B","PRE-OP",IEN)="",^ORD(101.42,"C","P",IEN)=""
"RTN","ORY212",51,0)
 F ORI=1,2,9 I '$O(^ORD(101.42,ORI,1,"B","VBEC",0)) D  ;add VBEC Usage
"RTN","ORY212",52,0)
 . N DA,DIC,X,Y,DLAYGO,DO,DD
"RTN","ORY212",53,0)
 . S DA(1)=ORI,DIC="^ORD(101.42,"_ORI_",1,",DIC(0)="LX",DLAYGO=101.421
"RTN","ORY212",54,0)
 . S:'$D(^ORD(101.42,ORI,1,0)) ^(0)="^101.421A^^"
"RTN","ORY212",55,0)
 . S X="VBEC" K DO,DD D ^DIC
"RTN","ORY212",56,0)
 Q
"RTN","ORY212",57,0)
 ;
"RTN","ORY212",58,0)
ORDITMS ; -- install VBECS orderable items
"RTN","ORY212",59,0)
 Q:$D(^ORD(101.43,"S.VBEC"))  ;items already exist
"RTN","ORY212",60,0)
 N X,Y,DIC,DIE,DR,DLAYGO,DO,DD,DA,ORDG,ORI,ITEM,ORIT,SUB
"RTN","ORY212",61,0)
 S ORDG=$O(^ORD(100.98,"B","VBEC",0)) Q:'ORDG
"RTN","ORY212",62,0)
 F ORI=1:1 S ITEM=$T(ITEMS+ORI),X=$P(ITEM,";",3) Q:X="ZZZZ"  D
"RTN","ORY212",63,0)
 . S DIC="^ORD(101.43,",DIC(0)="LX",DLAYGO=101.43
"RTN","ORY212",64,0)
 . K DO,DD,Y D FILE^DICN Q:Y'>0  ;error
"RTN","ORY212",65,0)
 . S ORIT=ORI_";99VBC",DR="1.1///"_X_";2///^S X=ORIT;5////"_ORDG
"RTN","ORY212",66,0)
 . S DA=+Y,DIE=DIC D ^DIE S ORIT=DA
"RTN","ORY212",67,0)
 . S X=$P(ITEM,";",4) I $L(X) D  ;define sub-types
"RTN","ORY212",68,0)
 .. S ^ORD(101.43,DA,"VB")=X,SUB=$S(X:"VBC",1:"VBT")
"RTN","ORY212",69,0)
 .. D SET^ORDD43(SUB,DA)
"RTN","ORY212",70,0)
 Q
"RTN","ORY212",71,0)
 ;
"RTN","ORY212",72,0)
ITEMS ;;VBECS orderable;comp^test or T&S
"RTN","ORY212",73,0)
 ;;TYPE & SCREEN;^2
"RTN","ORY212",74,0)
 ;;RED BLOOD CELLS;1^
"RTN","ORY212",75,0)
 ;;FRESH FROZEN PLASMA;1^
"RTN","ORY212",76,0)
 ;;PLATELETS;1^
"RTN","ORY212",77,0)
 ;;CRYOPRECIPITATE;1^
"RTN","ORY212",78,0)
 ;;OTHER;1^
"RTN","ORY212",79,0)
 ;;ABO/RH;^1
"RTN","ORY212",80,0)
 ;;ANTIBODY SCREEN;^1
"RTN","ORY212",81,0)
 ;;DIRECT ANTIGLOBULIN TEST;^1
"RTN","ORY212",82,0)
 ;;TRANSFUSION REACTION WORKUP;^1
"RTN","ORY212",83,0)
 ;;WHOLE BLOOD;1^
"RTN","ORY212",84,0)
 ;;ZZZZ
"RTN","ORY212",85,0)
 ;
"RTN","ORY212",86,0)
DAT ; -- Strip "(DAT)" from name
"RTN","ORY212",87,0)
 N X,DA,DR,DIE
"RTN","ORY212",88,0)
 S DA=+$O(^ORD(101.43,"ID","9;99VBC",0))
"RTN","ORY212",89,0)
 I DA,$P($G(^ORD(101.43,DA,0)),U)["(" D  ;strip "(DAT)"
"RTN","ORY212",90,0)
 . S DR=".01///DIRECT ANTIGLOBULIN TEST",DIE="^ORD(101.43,"
"RTN","ORY212",91,0)
 . D ^DIE
"RTN","ORY212",92,0)
 Q
"RTN","ORY212",93,0)
 ;
"RTN","ORY212",94,0)
COMP ;Setup package level parameters for OR VBECS COMPONENT ORDER
"RTN","ORY212",95,0)
 ;   [replaced by MAIN^ORY212P in POST]
"RTN","ORY212",96,0)
 N ORX,P
"RTN","ORY212",97,0)
 S P="OR VBECS COMPONENT ORDER"
"RTN","ORY212",98,0)
 D GETLST^XPAR(.ORX,"PKG.ORDER ENTRY/RESULTS REPORTING",P,"Q")
"RTN","ORY212",99,0)
 ;I $O(ORX(0)) Q  ;New parameter has already been setup
"RTN","ORY212",100,0)
 D SET("RED BLOOD CELLS",P,5)
"RTN","ORY212",101,0)
 D SET("FRESH FROZEN PLASMA",P,10)
"RTN","ORY212",102,0)
 D SET("PLATELETS",P,15)
"RTN","ORY212",103,0)
 D SET("CRYOPRECIPITATE",P,20)
"RTN","ORY212",104,0)
 D SET("WHOLE BLOOD",P,25)
"RTN","ORY212",105,0)
 D SET("OTHER",P,30)
"RTN","ORY212",106,0)
 Q
"RTN","ORY212",107,0)
 ;
"RTN","ORY212",108,0)
SET(ONAME,P,S) ;Set the parameter
"RTN","ORY212",109,0)
 ;ONAME=Report name
"RTN","ORY212",110,0)
 ;P=Parameter name
"RTN","ORY212",111,0)
 ;S=Sequence (count)
"RTN","ORY212",112,0)
 N DA,ORERR
"RTN","ORY212",113,0)
 S DA=0 F  S DA=$O(^ORD(101.43,"S.VBC",ONAME,DA)) Q:'DA  D
"RTN","ORY212",114,0)
 . D EN^XPAR("PKG.ORDER ENTRY/RESULTS REPORTING",P,S,ONAME,.ORERR)
"RTN","ORY212",115,0)
 Q
"RTN","ORY212E")
0^18^B401737
"RTN","ORY212E",1,0)
ORY212E ;SLC/MKB - Env Check for OR*3*212 ;2/11/08  11:06
"RTN","ORY212E",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**212**;Dec 17, 1997;Build 24
"RTN","ORY212E",3,0)
 ;
"RTN","ORY212E",4,0)
EN ; -- Require VBECS, CPRS v27 in production
"RTN","ORY212E",5,0)
 I $$PROD^XUPROD,'$$PATCH^XPDUTL("OR*3.0*243") D
"RTN","ORY212E",6,0)
 . W !!,"CPRS v27 must be present to install this in a production system.",!
"RTN","ORY212E",7,0)
 . S XPDQUIT=1
"RTN","ORY212E",8,0)
 Q
"RTN","ORY212P")
0^15^B12256283
"RTN","ORY212P",1,0)
ORY212P ;SLC/MKB - Export Package Level Parameters ;2/11/08  11:07
"RTN","ORY212P",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**212**;Dec 17, 1997;Build 24
"RTN","ORY212P",3,0)
 ;
"RTN","ORY212P",4,0)
MAIN ; main (initial) parameter transport routine
"RTN","ORY212P",5,0)
 K ^TMP($J,"XPARRSTR")
"RTN","ORY212P",6,0)
 N ENT,IDX,ROOT,REF,VAL,I
"RTN","ORY212P",7,0)
 S ROOT=$NAME(^TMP($J,"XPARRSTR")),ROOT=$E(ROOT,1,$L(ROOT)-1)_","
"RTN","ORY212P",8,0)
 D LOAD
"RTN","ORY212P",9,0)
XX2 S IDX=0,ENT="PKG.ORDER ENTRY/RESULTS REPORTING"
"RTN","ORY212P",10,0)
 F  S IDX=$O(^TMP($J,"XPARRSTR",IDX)) Q:'IDX  D
"RTN","ORY212P",11,0)
 . N PAR,INST,ORVAL,ORERR
"RTN","ORY212P",12,0)
 . S PAR=$P(^TMP($J,"XPARRSTR",IDX,"KEY"),U),INST=$P(^("KEY"),U,2)
"RTN","ORY212P",13,0)
 . M ORVAL=^TMP($J,"XPARRSTR",IDX,"VAL")
"RTN","ORY212P",14,0)
 . D EN^XPAR(ENT,PAR,INST,.ORVAL,.ORERR)
"RTN","ORY212P",15,0)
 K ^TMP($J,"XPARRSTR")
"RTN","ORY212P",16,0)
 Q
"RTN","ORY212P",17,0)
 ;
"RTN","ORY212P",18,0)
LOAD ; load data into ^TMP (expects ROOT to be defined)
"RTN","ORY212P",19,0)
 S I=1 F  S REF=$T(DATA+I) Q:REF=""  S VAL=$T(DATA+I+1) D
"RTN","ORY212P",20,0)
 . S I=I+2,REF=$P(REF,";",3,999),VAL=$P(VAL,";",3,999)
"RTN","ORY212P",21,0)
 . S @(ROOT_REF)=VAL
"RTN","ORY212P",22,0)
 Q
"RTN","ORY212P",23,0)
 ;
"RTN","ORY212P",24,0)
DATA ; parameter data
"RTN","ORY212P",25,0)
 ;;9338,"KEY")
"RTN","ORY212P",26,0)
 ;;OR VBECS COMPONENT ORDER^5
"RTN","ORY212P",27,0)
 ;;9338,"VAL")
"RTN","ORY212P",28,0)
 ;;RED BLOOD CELLS
"RTN","ORY212P",29,0)
 ;;9339,"KEY")
"RTN","ORY212P",30,0)
 ;;OR VBECS COMPONENT ORDER^10
"RTN","ORY212P",31,0)
 ;;9339,"VAL")
"RTN","ORY212P",32,0)
 ;;FRESH FROZEN PLASMA
"RTN","ORY212P",33,0)
 ;;9340,"KEY")
"RTN","ORY212P",34,0)
 ;;OR VBECS COMPONENT ORDER^15
"RTN","ORY212P",35,0)
 ;;9340,"VAL")
"RTN","ORY212P",36,0)
 ;;PLATELETS
"RTN","ORY212P",37,0)
 ;;9341,"KEY")
"RTN","ORY212P",38,0)
 ;;OR VBECS COMPONENT ORDER^20
"RTN","ORY212P",39,0)
 ;;9341,"VAL")
"RTN","ORY212P",40,0)
 ;;CRYOPRECIPITATE
"RTN","ORY212P",41,0)
 ;;9342,"KEY")
"RTN","ORY212P",42,0)
 ;;OR VBECS COMPONENT ORDER^25
"RTN","ORY212P",43,0)
 ;;9342,"VAL")
"RTN","ORY212P",44,0)
 ;;WHOLE BLOOD
"RTN","ORY212P",45,0)
 ;;9343,"KEY")
"RTN","ORY212P",46,0)
 ;;OR VBECS COMPONENT ORDER^30
"RTN","ORY212P",47,0)
 ;;9343,"VAL")
"RTN","ORY212P",48,0)
 ;;OTHER
"RTN","ORY212P",49,0)
 ;;9344,"KEY")
"RTN","ORY212P",50,0)
 ;;OR VBECS MODIFIERS^5
"RTN","ORY212P",51,0)
 ;;9344,"VAL")
"RTN","ORY212P",52,0)
 ;;Washed
"RTN","ORY212P",53,0)
 ;;9345,"KEY")
"RTN","ORY212P",54,0)
 ;;OR VBECS MODIFIERS^10
"RTN","ORY212P",55,0)
 ;;9345,"VAL")
"RTN","ORY212P",56,0)
 ;;Irradiated
"RTN","ORY212P",57,0)
 ;;9346,"KEY")
"RTN","ORY212P",58,0)
 ;;OR VBECS MODIFIERS^15
"RTN","ORY212P",59,0)
 ;;9346,"VAL")
"RTN","ORY212P",60,0)
 ;;Leuko Reduced
"RTN","ORY212P",61,0)
 ;;9347,"KEY")
"RTN","ORY212P",62,0)
 ;;OR VBECS MODIFIERS^20
"RTN","ORY212P",63,0)
 ;;9347,"VAL")
"RTN","ORY212P",64,0)
 ;;Volume Reduced
"RTN","ORY212P",65,0)
 ;;9348,"KEY")
"RTN","ORY212P",66,0)
 ;;OR VBECS MODIFIERS^25
"RTN","ORY212P",67,0)
 ;;9348,"VAL")
"RTN","ORY212P",68,0)
 ;;Divided
"RTN","ORY212P",69,0)
 ;;12731,"KEY")
"RTN","ORY212P",70,0)
 ;;OR VBECS MODIFIERS^30
"RTN","ORY212P",71,0)
 ;;12731,"VAL")
"RTN","ORY212P",72,0)
 ;;Leuko Reduced/Irradiated
"RTN","ORY212P",73,0)
 ;;12732,"KEY")
"RTN","ORY212P",74,0)
 ;;OR VBECS REASON FOR REQUEST^5
"RTN","ORY212P",75,0)
 ;;12732,"VAL")
"RTN","ORY212P",76,0)
 ;;Transfuse
"RTN","ORY212P",77,0)
 ;;12733,"KEY")
"RTN","ORY212P",78,0)
 ;;OR VBECS REASON FOR REQUEST^10
"RTN","ORY212P",79,0)
 ;;12733,"VAL")
"RTN","ORY212P",80,0)
 ;;Hold for OR
"RTN","ORY212P",81,0)
 ;;12734,"KEY")
"RTN","ORY212P",82,0)
 ;;OR VBECS REASON FOR REQUEST^15
"RTN","ORY212P",83,0)
 ;;12734,"VAL")
"RTN","ORY212P",84,0)
 ;;Hold until MD gives order
"RTN","ORY212P",85,0)
 ;;12735,"KEY")
"RTN","ORY212P",86,0)
 ;;OR VBECS REASON FOR REQUEST^20
"RTN","ORY212P",87,0)
 ;;12735,"VAL")
"RTN","ORY212P",88,0)
 ;;See COMMENT for justification
"RTN","ORY212P",89,0)
 ;;13450,"KEY")
"RTN","ORY212P",90,0)
 ;;OR VBECS ON^1
"RTN","ORY212P",91,0)
 ;;13450,"VAL")
"RTN","ORY212P",92,0)
 ;;YES
"RTN","ORY212P",93,0)
 ;;13561,"KEY")
"RTN","ORY212P",94,0)
 ;;OR VBECS ERROR MESSAGE^1
"RTN","ORY212P",95,0)
 ;;13561,"VAL")
"RTN","ORY212P",96,0)
 ;;Default VistaLink Error
"RTN","ORY212P",97,0)
 ;;13561,"VAL",1,0)
"RTN","ORY212P",98,0)
 ;;******************************************************************
"RTN","ORY212P",99,0)
 ;;13561,"VAL",2,0)
"RTN","ORY212P",100,0)
 ;;*                                                                *
"RTN","ORY212P",101,0)
 ;;13561,"VAL",3,0)
"RTN","ORY212P",102,0)
 ;;*          Patient data is not available at this time            *
"RTN","ORY212P",103,0)
 ;;13561,"VAL",4,0)
"RTN","ORY212P",104,0)
 ;;*            due to a VistALink connection failure.              *
"RTN","ORY212P",105,0)
 ;;13561,"VAL",5,0)
"RTN","ORY212P",106,0)
 ;;*                                                                *
"RTN","ORY212P",107,0)
 ;;13561,"VAL",6,0)
"RTN","ORY212P",108,0)
 ;;*       Contact IRM and/or the Blood Bank for assistance.        *
"RTN","ORY212P",109,0)
 ;;13561,"VAL",7,0)
"RTN","ORY212P",110,0)
 ;;*                                                                *
"RTN","ORY212P",111,0)
 ;;13561,"VAL",8,0)
"RTN","ORY212P",112,0)
 ;;******************************************************************
"VER")
8.0^22.0
"^DD",100.98,100.98,0)
FIELD^^4^5
"^DD",100.98,100.98,0,"DDA")
N
"^DD",100.98,100.98,0,"DT")
2960814
"^DD",100.98,100.98,0,"IX","AD",100.981,.01)

"^DD",100.98,100.98,0,"IX","B",100.98,.01)

"^DD",100.98,100.98,0,"IX","B",100.98,3)

"^DD",100.98,100.98,0,"NM","DISPLAY GROUP")

"^DD",100.98,100.98,0,"PT",100,23)

"^DD",100.98,100.98,0,"PT",100.65,.01)

"^DD",100.98,100.98,0,"PT",100.981,.01)

"^DD",100.98,100.98,0,"PT",100.995,1.1)

"^DD",100.98,100.98,0,"PT",101.41,5)

"^DD",100.98,100.98,0,"PT",101.43,5)

"^DD",100.98,100.98,0,"PT",123.5,123.01)

"^DD",100.98,100.98,0,"VRPK")
ORDER ENTRY/RESULTS REPORTING
"^DD",100.98,100.98,.01,0)
NAME^RF^^0;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",100.98,100.98,.01,1,0)
^.1^^-1
"^DD",100.98,100.98,.01,1,1,0)
100.98^B
"^DD",100.98,100.98,.01,1,1,1)
S ^ORD(100.98,"B",$E(X,1,30),DA)=""
"^DD",100.98,100.98,.01,1,1,2)
K ^ORD(100.98,"B",$E(X,1,30),DA)
"^DD",100.98,100.98,.01,3)
ANSWER MUST BE 3-30 CHARACTERS IN LENGTH
"^DD",100.98,100.98,.01,4)

"^DD",100.98,100.98,.01,21,0)
^^3^3^2920224^^^^
"^DD",100.98,100.98,.01,21,1,0)
This is the name of the display group for a particular kind of order.
"^DD",100.98,100.98,.01,21,2,0)
The display group generally corresponds to a hospital service or part
"^DD",100.98,100.98,.01,21,3,0)
of a service.
"^DD",100.98,100.98,.01,"DT")
2890131
"^DD",100.98,100.98,1,0)
MEMBER^100.981P^^1;0
"^DD",100.98,100.98,1,3)
Enter a display group as a member.
"^DD",100.98,100.98,1,21,0)
^^3^3^2920224^^^^
"^DD",100.98,100.98,1,21,1,0)
This is a list of specific display groups that `belong' to the display
"^DD",100.98,100.98,1,21,2,0)
group listed in the NAME field.  (This is similar to menu items in the
"^DD",100.98,100.98,1,21,3,0)
OPTION File.)
"^DD",100.98,100.98,2,0)
MIXED NAME^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",100.98,100.98,2,3)
Answer must be 1-30 characters in length.
"^DD",100.98,100.98,2,21,0)
^^3^3^2960617^
"^DD",100.98,100.98,2,21,1,0)
This field contains a mixed case name for the display group.  The name 
"^DD",100.98,100.98,2,21,2,0)
should be as short as possible without being obscure.  This name is 
"^DD",100.98,100.98,2,21,3,0)
primarily intended for use in the windows display of orders.
"^DD",100.98,100.98,2,"DT")
2960617
"^DD",100.98,100.98,3,0)
SHORT NAME^F^^0;3^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>5!($L(X)<1) X
"^DD",100.98,100.98,3,1,0)
^.1
"^DD",100.98,100.98,3,1,1,0)
100.98^B^MNEMONIC
"^DD",100.98,100.98,3,1,1,1)
S:'$D(^ORD(100.98,"B",$E(X,1,30),DA)) ^(DA)=1
"^DD",100.98,100.98,3,1,1,2)
I $D(^ORD(100.98,"B",$E(X,1,30),DA)),^(DA) K ^(DA)
"^DD",100.98,100.98,3,3)
ANSWER MUST BE 1-5 CHARACTERS IN LENGTH
"^DD",100.98,100.98,3,21,0)
^^2^2^2920224^^^
"^DD",100.98,100.98,3,21,1,0)
This is an abbreviation for the display group to be used in displays and
"^DD",100.98,100.98,3,21,2,0)
reports.
"^DD",100.98,100.98,3,"DT")
2880308
"^DD",100.98,100.98,4,0)
DEFAULT DIALOG^P101.41'^ORD(101.41,^0;4^Q
"^DD",100.98,100.98,4,3)
Enter the default ordering dialog for this display group.
"^DD",100.98,100.98,4,21,0)
^^2^2^2960815^^
"^DD",100.98,100.98,4,21,1,0)
This is the dialog that will be used as the default definition when
"^DD",100.98,100.98,4,21,2,0)
placing quick orders associated with this display group.
"^DD",100.98,100.98,4,"DT")
2960814
"^DD",100.98,100.981,0)
MEMBER SUB-FIELD^^.01^2
"^DD",100.98,100.981,0,"DT")
2920601
"^DD",100.98,100.981,0,"IX","B",100.981,.01)

"^DD",100.98,100.981,0,"NM","MEMBER")

"^DD",100.98,100.981,0,"UP")
100.98
"^DD",100.98,100.981,.001,0)
SEQUENCE^NJ5,1^^ ^K:+X'=X!(X>900)!(X<0)!(X?.E1"."2N.N) X
"^DD",100.98,100.981,.001,3)
Type a Number between 0 and 900, 1 Decimal Digit
"^DD",100.98,100.981,.001,21,0)
^^2^2^2920601^
"^DD",100.98,100.981,.001,21,1,0)
This is the sequence of the member in the display group for reporting
"^DD",100.98,100.981,.001,21,2,0)
purposes.
"^DD",100.98,100.981,.001,"DT")
2920601
"^DD",100.98,100.981,.01,0)
MEMBER^MP100.98X^ORD(100.98,^0;1^S ORDDF=100.98 D TREE^ORDD101
"^DD",100.98,100.981,.01,1,0)
^.1
"^DD",100.98,100.981,.01,1,1,0)
100.981^B
"^DD",100.98,100.981,.01,1,1,1)
S ^ORD(100.98,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",100.98,100.981,.01,1,1,2)
K ^ORD(100.98,DA(1),1,"B",$E(X,1,30),DA)
"^DD",100.98,100.981,.01,1,2,0)
100.98^AD^MUMPS
"^DD",100.98,100.981,.01,1,2,1)
S ^ORD(100.98,"AD",$E(X,1,30),DA(1),DA)=""
"^DD",100.98,100.981,.01,1,2,2)
K ^ORD(100.98,"AD",$E(X,1,30),DA(1),DA)
"^DD",100.98,100.981,.01,1,2,"%D",0)
^^2^2^2971217^^
"^DD",100.98,100.981,.01,1,2,"%D",1,0)
^ORD(100.98,"AD",ORMEM,ORGRP,DA)
"^DD",100.98,100.981,.01,1,2,"%D",2,0)
Provides backwards pointer from member to parent group.
"^DD",100.98,100.981,.01,3)
Enter a display group.  A display group that is an ancestor may not also be a member.
"^DD",100.98,100.981,.01,4)

"^DD",100.98,100.981,.01,21,0)
^^2^2^2920224^^^
"^DD",100.98,100.981,.01,21,1,0)
This is a display group listed in the NAME field. (This is similar to a
"^DD",100.98,100.981,.01,21,2,0)
menu item in the OPTION File.)
"^DD",100.98,100.981,.01,"DT")
2890207
"^DD",101.41,101.41,0)
FIELD^^99^31
"^DD",101.41,101.41,0,"DDA")
N
"^DD",101.41,101.41,0,"DT")
3010724
"^DD",101.41,101.41,0,"IX","AB",101.41,.01)

"^DD",101.41,101.41,0,"IX","AD",101.412,2)

"^DD",101.41,101.41,0,"IX","AM",101.41,99)

"^DD",101.41,101.41,0,"IX","AM2",101.41,2)

"^DD",101.41,101.41,0,"IX","AM51",101.41,51)

"^DD",101.41,101.41,0,"IX","AM52",101.41,52)

"^DD",101.41,101.41,0,"IX","AMM",101.412,.01)

"^DD",101.41,101.41,0,"IX","AMM2",101.412,2)

"^DD",101.41,101.41,0,"IX","AMM3",101.412,3)

"^DD",101.41,101.41,0,"IX","AMM4",101.412,4)

"^DD",101.41,101.41,0,"IX","AMM5",101.412,5)

"^DD",101.41,101.41,0,"IX","APKG",101.41,7)

"^DD",101.41,101.41,0,"IX","C",101.41,2)

"^DD",101.41,101.41,0,"NM","ORDER DIALOG")

"^DD",101.41,101.41,0,"PT",100,2)

"^DD",101.41,101.41,0,"PT",100,7)

"^DD",101.41,101.41,0,"PT",100.045,.02)

"^DD",101.41,101.41,0,"PT",100.5,4)

"^DD",101.41,101.41,0,"PT",100.5,5)

"^DD",101.41,101.41,0,"PT",100.98,4)

"^DD",101.41,101.41,0,"PT",101.141,.03)

"^DD",101.41,101.41,0,"PT",101.412,1)

"^DD",101.41,101.41,0,"PT",101.412,2)

"^DD",101.41,101.41,0,"PT",101.415,2)

"^DD",101.41,101.41,0,"PT",101.416,.02)

"^DD",101.41,101.41,0,"PT",101.441,.01)

"^DD",101.41,101.41,0,"PT",801.41,15)

"^DD",101.41,101.41,0,"PT",801.4118,.01)

"^DD",101.41,101.41,0,"VRPK")
ORDER ENTRY/RESULTS REPORTING
"^DD",101.41,101.41,0,"VRRV")
1^3010724
"^DD",101.41,101.41,.01,0)
NAME^RF^^0;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>63!($L(X)<3)!'(X'?1P.E) X
"^DD",101.41,101.41,.01,1,0)
^.1^^-1
"^DD",101.41,101.41,.01,1,2,0)
101.41^AB
"^DD",101.41,101.41,.01,1,2,1)
S ^ORD(101.41,"AB",$E(X,1,63),DA)=""
"^DD",101.41,101.41,.01,1,2,2)
K ^ORD(101.41,"AB",$E(X,1,63),DA)
"^DD",101.41,101.41,.01,1,2,"%D",0)
^^1^1^2971020^
"^DD",101.41,101.41,.01,1,2,"%D",1,0)
This is a regular index on the full 63 characters of the Name field.
"^DD",101.41,101.41,.01,1,2,"DT")
2971020
"^DD",101.41,101.41,.01,3)
Answer must be 3-63 characters in length.
"^DD",101.41,101.41,.01,21,0)
^^3^3^2971219^
"^DD",101.41,101.41,.01,21,1,0)
This is the name of the dialog; entries that were converted from the
"^DD",101.41,101.41,.01,21,2,0)
Protocol file will retain the same name.  Namespacing is not required,
"^DD",101.41,101.41,.01,21,3,0)
but still encouraged.
"^DD",101.41,101.41,.01,"DT")
2971020
"^DD",101.41,101.41,2,0)
DISPLAY TEXT^FX^^0;2^K:$L(X)>80!($L(X)<3)!($$CHKNAM^ORUTL(X)) X
"^DD",101.41,101.41,2,1,0)
^.1
"^DD",101.41,101.41,2,1,1,0)
101.41^C
"^DD",101.41,101.41,2,1,1,1)
S ^ORD(101.41,"C",$$UP^XLFSTR($E(X,1,63)),DA)=""
"^DD",101.41,101.41,2,1,1,2)
K ^ORD(101.41,"C",$$UP^XLFSTR($E(X,1,63)),DA)
"^DD",101.41,101.41,2,1,1,"DT")
2950112
"^DD",101.41,101.41,2,1,2,0)
101.41^AM2^MUMPS
"^DD",101.41,101.41,2,1,2,1)
D REDOM^ORDD41
"^DD",101.41,101.41,2,1,2,2)
D REDOM^ORDD41
"^DD",101.41,101.41,2,1,2,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.41,2,1,2,"%D",1,0)
Update TIMESTAMP whenever DISPLAY TEXT is changed.
"^DD",101.41,101.41,2,1,2,"DT")
2990210
"^DD",101.41,101.41,2,3)
Answer must be 3-80 characters in length and cannot contain a semicolon (;), a comma (,), an up-arrow (^), a dash (-), or an equal sign (=). 
"^DD",101.41,101.41,2,21,0)
^.001^1^1^3010913^^^^
"^DD",101.41,101.41,2,21,1,0)
The text of this dialog's name as it appears on a menu or subheader.
"^DD",101.41,101.41,2,"DT")
3000823
"^DD",101.41,101.41,3,0)
DISABLE^F^^0;3^K:$L(X)>40!($L(X)<1) X
"^DD",101.41,101.41,3,3)
Enter a message here to disable this dialog, 1-40 characters in length.
"^DD",101.41,101.41,3,21,0)
^^3^3^2950112^
"^DD",101.41,101.41,3,21,1,0)
This field disables use of this dialog when it contains text.  The text
"^DD",101.41,101.41,3,21,2,0)
should be a short message explaining why use of this dialog has been
"^DD",101.41,101.41,3,21,3,0)
disabled, as it will be displayed if this dialog is selected.
"^DD",101.41,101.41,3,"DT")
2950112
"^DD",101.41,101.41,4,0)
TYPE^RS^P:prompt;D:dialog;Q:quick order;O:order set;M:menu;A:action;H:html;^0;4^Q
"^DD",101.41,101.41,4,3)
Specify a type for this dialog.
"^DD",101.41,101.41,4,21,0)
^^5^5^2950716^^^^
"^DD",101.41,101.41,4,21,1,0)
This field defines the type of order dialog to be processed.  Control
"^DD",101.41,101.41,4,21,2,0)
will be passed to the OE/RR Dialog Processor for dialog items; menu types
"^DD",101.41,101.41,4,21,3,0)
are used for displaying and selecting dialog items.  Action types will only
"^DD",101.41,101.41,4,21,4,0)
execute the entry and exit actions, ignoring any items that may exist; these
"^DD",101.41,101.41,4,21,5,0)
dialogs should not create entries in the Orders file.
"^DD",101.41,101.41,4,"DT")
3010430
"^DD",101.41,101.41,5,0)
DISPLAY GROUP^P100.98'^ORD(100.98,^0;5^Q
"^DD",101.41,101.41,5,3)
Enter the display group containing orderable items defined by this dialog.
"^DD",101.41,101.41,5,21,0)
^^3^3^2950112^
"^DD",101.41,101.41,5,21,1,0)
This field determines what display group this dialog has been defined for.
"^DD",101.41,101.41,5,21,2,0)
It will define which orderable items are selectable with this dialog,
"^DD",101.41,101.41,5,21,3,0)
as well as what service to send the order to when it is complete.
"^DD",101.41,101.41,5,"DT")
2950112
"^DD",101.41,101.41,6,0)
SIGNATURE REQUIRED^S^0:NONE;1:ORELSE;2:ORES;^0;6^Q
"^DD",101.41,101.41,6,3)
Enter the OR key required to sign orders created by this dialog
"^DD",101.41,101.41,6,21,0)
^^6^6^2970318^^
"^DD",101.41,101.41,6,21,1,0)
This field indicates what signature will be required for orders created by
"^DD",101.41,101.41,6,21,2,0)
this dialog, to be considered complete and ready to release to the service
"^DD",101.41,101.41,6,21,3,0)
for action.  If this flag is set to NO and the dialog contains a prompt
"^DD",101.41,101.41,6,21,4,0)
for item(s) from the Orderable Item file, the order created may still
"^DD",101.41,101.41,6,21,5,0)
require a signature if any of the items ordered are individually flagged
"^DD",101.41,101.41,6,21,6,0)
as requiring a signature.
"^DD",101.41,101.41,6,"DT")
2970318
"^DD",101.41,101.41,7,0)
PACKAGE^P9.4'^DIC(9.4,^0;7^Q
"^DD",101.41,101.41,7,1,0)
^.1
"^DD",101.41,101.41,7,1,1,0)
101.41^APKG
"^DD",101.41,101.41,7,1,1,1)
S ^ORD(101.41,"APKG",$E(X,1,30),DA)=""
"^DD",101.41,101.41,7,1,1,2)
K ^ORD(101.41,"APKG",$E(X,1,30),DA)
"^DD",101.41,101.41,7,1,1,"DT")
2970325
"^DD",101.41,101.41,7,3)
Enter the VISTA package that is to receive orders created by this dialog.
"^DD",101.41,101.41,7,21,0)
^^3^3^2950208^
"^DD",101.41,101.41,7,21,1,0)
This is the VISTA package that is intended to receive orders created by
"^DD",101.41,101.41,7,21,2,0)
this dialog; this is required for creating the HL7 messages to pass the
"^DD",101.41,101.41,7,21,3,0)
order.
"^DD",101.41,101.41,7,"DT")
2970325
"^DD",101.41,101.41,8,0)
VERIFY ORDER^S^1:YES;0:NO;^0;8^Q
"^DD",101.41,101.41,8,3)
Enter YES to have orders created by this dialog presented to the user before saving, with the opportunity to edit.
"^DD",101.41,101.41,8,21,0)
^^3^3^2950623^
"^DD",101.41,101.41,8,21,1,0)
This field is a flag, which determines if the order created by this dialog
"^DD",101.41,101.41,8,21,2,0)
will be presented to the user for verification before saving in the Orders
"^DD",101.41,101.41,8,21,3,0)
file; for most quick orders, this flag should be set to 0 (no).
"^DD",101.41,101.41,8,"DT")
2950623
"^DD",101.41,101.41,9,0)
ASK FOR ANOTHER ORDER^S^0:NO;1:YES;2:YES-DON'T ASK;^0;9^Q
"^DD",101.41,101.41,9,3)
Enter YES to have the user asked to enter another order from this dialog before exiting.
"^DD",101.41,101.41,9,21,0)
^^6^6^2970616^^^
"^DD",101.41,101.41,9,21,1,0)
This field allows the user to add another order from this dialog, when the
"^DD",101.41,101.41,9,21,2,0)
initial order is accepted and placed; if set to YES, the user will be
"^DD",101.41,101.41,9,21,3,0)
asked "Add another <dialog display text> order?" to allow for either
"^DD",101.41,101.41,9,21,4,0)
exiting the processor or adding an additional order of the same type.
"^DD",101.41,101.41,9,21,5,0)
This field can also be set to YES-DON'T ASK to force the processor to
"^DD",101.41,101.41,9,21,6,0)
automatically drop into prompting for another order without asking first.
"^DD",101.41,101.41,9,"DT")
2970616
"^DD",101.41,101.41,10,0)
ITEMS^101.412IA^^10;0
"^DD",101.41,101.41,10,21,0)
^^5^5^2990211^^^^
"^DD",101.41,101.41,10,21,1,0)
This field contains the components for dialogs:
"^DD",101.41,101.41,10,21,2,0)
     Dialogs      -> prompts
"^DD",101.41,101.41,10,21,3,0)
     Quick orders -> prompts (completed)
"^DD",101.41,101.41,10,21,4,0)
     Order sets   -> dialogs or quick orders
"^DD",101.41,101.41,10,21,5,0)
     Menus        -> dialogs, quick orders, or order sets
"^DD",101.41,101.41,11,0)
DATA TYPE^S^D:date/time;R:free text date/time;F:free text;N:numeric;S:set of codes;Y:yes/no;P:pointer;W:word processing;^1;1^Q
"^DD",101.41,101.41,11,3)
Enter the type of data to be collected at this prompt.
"^DD",101.41,101.41,11,21,0)
^^2^2^2950823^^
"^DD",101.41,101.41,11,21,1,0)
This is the type of data being prompted for; this field is used to define
"^DD",101.41,101.41,11,21,2,0)
a call to the reader (^DIR) in most cases.
"^DD",101.41,101.41,11,23,0)
^^1^1^2950823^^
"^DD",101.41,101.41,11,23,1,0)
Used with Prompt-type only.
"^DD",101.41,101.41,11,"DT")
2950407
"^DD",101.41,101.41,12,0)
DOMAIN^F^^1;2^K:$L(X)>235!($L(X)<1) X
"^DD",101.41,101.41,12,3)
Answer must be 1-235 characters in length.
"^DD",101.41,101.41,12,21,0)
^^3^3^2990225^^^^
"^DD",101.41,101.41,12,21,1,0)
This is a parameter that may be used to further specify the data type.
"^DD",101.41,101.41,12,21,2,0)
The string stored here should be appropriate for the second ^-piece of
"^DD",101.41,101.41,12,21,3,0)
DIR(0) when used with the data type field.
"^DD",101.41,101.41,12,23,0)
^^1^1^2990225^^^^
"^DD",101.41,101.41,12,23,1,0)
Used with Prompt-type only.
"^DD",101.41,101.41,12,"DT")
2990225
"^DD",101.41,101.41,13,0)
ID^F^^1;3^K:$L(X)>10!($L(X)<2) X
"^DD",101.41,101.41,13,3)
Answer must be 2-10 characters in length.
"^DD",101.41,101.41,13,21,0)
^.001^20^20^3010727^^
"^DD",101.41,101.41,13,21,1,0)
This field may contain a single word identifier which will be
"^DD",101.41,101.41,13,21,2,0)
stored with the user response in the Orders file #100, where it
"^DD",101.41,101.41,13,21,3,0)
will be indexed for quick reference to certain values in the
"^DD",101.41,101.41,13,21,4,0)
order dialog.  The following are some examples of values
"^DD",101.41,101.41,13,21,5,0)
currently in use:
"^DD",101.41,101.41,13,21,6,0)
 
"^DD",101.41,101.41,13,21,7,0)
   START      -> Start date/time
"^DD",101.41,101.41,13,21,8,0)
   STOP       -> Stop date/time
"^DD",101.41,101.41,13,21,9,0)
   SCHEDULE   -> Administration Schedule
"^DD",101.41,101.41,13,21,10,0)
   ORDERABLE  -> Orderable Item
"^DD",101.41,101.41,13,21,11,0)
   DRUG       -> Dispense Drug
"^DD",101.41,101.41,13,21,12,0)
   CANCEL     -> Cancel Future Orders flag
"^DD",101.41,101.41,13,21,13,0)
   COMMENT    -> Word processing comments
"^DD",101.41,101.41,13,21,14,0)
 
"^DD",101.41,101.41,13,21,15,0)
These values must be unique among entries within an order dialog
"^DD",101.41,101.41,13,21,16,0)
but do not need to be unique across the entire file.  Be sure to
"^DD",101.41,101.41,13,21,17,0)
check the IDs assigned to generic text entries to make sure that
"^DD",101.41,101.41,13,21,18,0)
all IDs are unique.  In order to avoid potential problems it's
"^DD",101.41,101.41,13,21,19,0)
recommended that you use unique IDs for any local entries that you
"^DD",101.41,101.41,13,21,20,0)
create.
"^DD",101.41,101.41,13,"DT")
2960215
"^DD",101.41,101.41,17,0)
VALIDATION^K^^7;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.41,17,3)
This is Standard MUMPS code.
"^DD",101.41,101.41,17,9)
@
"^DD",101.41,101.41,17,21,0)
^^3^3^2960912^
"^DD",101.41,101.41,17,21,1,0)
This is MUMPS code that will be executed at the time of releasing an
"^DD",101.41,101.41,17,21,2,0)
order created with this dialog; dialog responses may be checked again
"^DD",101.41,101.41,17,21,3,0)
here before releasing the order to the service.
"^DD",101.41,101.41,17,"DT")
2960912
"^DD",101.41,101.41,19,0)
ADDITIONAL TEXT^K^^9;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.41,19,3)
This is Standard MUMPS code.
"^DD",101.41,101.41,19,9)
@
"^DD",101.41,101.41,19,21,0)
^^3^3^2960405^^
"^DD",101.41,101.41,19,21,1,0)
This is MUMPS code that will be executed when order ORIFN created by this
"^DD",101.41,101.41,19,21,2,0)
dialog is about to be displayed; any string that should be appended to the
"^DD",101.41,101.41,19,21,3,0)
order text should be returned in Y.
"^DD",101.41,101.41,19,"DT")
2960405
"^DD",101.41,101.41,20,0)
DESCRIPTION^101.411^^2;0
"^DD",101.41,101.41,20,21,0)
^^1^1^2971219^
"^DD",101.41,101.41,20,21,1,0)
This is a description of the dialog and its uses.
"^DD",101.41,101.41,21,0)
RESPONSES^101.416^^6;0
"^DD",101.41,101.41,21,21,0)
^^2^2^2971219^
"^DD",101.41,101.41,21,21,1,0)
This multiple contains any responses to prompts that have been pre-answered
"^DD",101.41,101.41,21,21,2,0)
to create a quick order.
"^DD",101.41,101.41,30,0)
ENTRY ACTION^K^^3;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.41,30,3)
This is Standard MUMPS code.
"^DD",101.41,101.41,30,9)
@
"^DD",101.41,101.41,30,21,0)
^^4^4^2950425^
"^DD",101.41,101.41,30,21,1,0)
This is MUMPS code that will be executed at the top of a dialog, prior to
"^DD",101.41,101.41,30,21,2,0)
the execution of any prompts; it may perform functions such as listing
"^DD",101.41,101.41,30,21,3,0)
the recent Radiology exams before ordering a new one, or alerting the
"^DD",101.41,101.41,30,21,4,0)
user to an existing diet order before making a change.
"^DD",101.41,101.41,30,"DT")
2950425
"^DD",101.41,101.41,31,0)
QUICK SETUP^K^^3.1;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.41,31,3)
This is Standard MUMPS code.
"^DD",101.41,101.41,31,9)
@
"^DD",101.41,101.41,31,21,0)
^^3^3^2970113^
"^DD",101.41,101.41,31,21,1,0)
This is MUMPS code that will be executed in the place of the Entry Action
"^DD",101.41,101.41,31,21,2,0)
when creating quick orders for this dialog; variables may be set here
"^DD",101.41,101.41,31,21,3,0)
instead to bypass the usual dependence on specific patient values.
"^DD",101.41,101.41,31,"DT")
2970113
"^DD",101.41,101.41,40,0)
EXIT ACTION^K^^4;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.41,40,3)
This is Standard MUMPS code.
"^DD",101.41,101.41,40,9)
@
"^DD",101.41,101.41,40,21,0)
^^2^2^2950622^
"^DD",101.41,101.41,40,21,1,0)
This is MUMPS code that will be executed upon completion of processing the
"^DD",101.41,101.41,40,21,2,0)
dialog; it is currently used only with dialog-type entries.
"^DD",101.41,101.41,40,"DT")
2950622
"^DD",101.41,101.41,50,0)
CONTROLS^101.415A^^50;0
"^DD",101.41,101.41,51,0)
COLUMN WIDTH^NJ3,0^^5;1^K:+X'=X!(X>240)!(X<20)!(X?.E1"."1N.N) X
"^DD",101.41,101.41,51,1,0)
^.1
"^DD",101.41,101.41,51,1,1,0)
101.41^AM51^MUMPS
"^DD",101.41,101.41,51,1,1,1)
D REDO^ORDD41
"^DD",101.41,101.41,51,1,1,2)
D REDO^ORDD41
"^DD",101.41,101.41,51,1,1,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.41,51,1,1,"%D",1,0)
Update TIMESTAMP whenever COLUMN WIDTH is changed.
"^DD",101.41,101.41,51,1,1,"DT")
2990210
"^DD",101.41,101.41,51,3)
Type a Number between 20 and 240, 0 Decimal Digits
"^DD",101.41,101.41,51,21,0)
^^2^2^2950623^
"^DD",101.41,101.41,51,21,1,0)
This is the width, in characters, for each column in a menu.  For example,
"^DD",101.41,101.41,51,21,2,0)
to have 3 columns on an 80 character device, enter a width of 26.
"^DD",101.41,101.41,51,"DT")
2990210
"^DD",101.41,101.41,52,0)
MNEMONIC WIDTH^NJ1,0^^5;2^K:+X'=X!(X>9)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.41,101.41,52,1,0)
^.1
"^DD",101.41,101.41,52,1,1,0)
101.41^AM52^MUMPS
"^DD",101.41,101.41,52,1,1,1)
D REDO^ORDD41
"^DD",101.41,101.41,52,1,1,2)
D REDO^ORDD41
"^DD",101.41,101.41,52,1,1,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.41,52,1,1,"%D",1,0)
Update TIMESTAMP whenever MNEMONIC WIDTH is changed.
"^DD",101.41,101.41,52,1,1,"DT")
2990210
"^DD",101.41,101.41,52,3)
Type a Number between 1 and 9, 0 Decimal Digits
"^DD",101.41,101.41,52,21,0)
^^2^2^2950623^
"^DD",101.41,101.41,52,21,1,0)
This field allows the width of item mnemonics to be varied; the default
"^DD",101.41,101.41,52,21,2,0)
value is 5.
"^DD",101.41,101.41,52,"DT")
2990210
"^DD",101.41,101.41,53,0)
PATH SWITCH^S^1:YES;0:NO;^5;3^Q
"^DD",101.41,101.41,53,3)
Enter YES if this menu should be redisplayed when traversing back up the menu tree.
"^DD",101.41,101.41,53,21,0)
^^5^5^2950623^
"^DD",101.41,101.41,53,21,1,0)
This switch allows the user, when traversing back UP the tree of menus and
"^DD",101.41,101.41,53,21,2,0)
items, to select a new path back down the tree.  In other words, the menu
"^DD",101.41,101.41,53,21,3,0)
is redisplayed when returning to that menu's level in the tree and
"^DD",101.41,101.41,53,21,4,0)
processing back down the tree is possible from that point.  If nothing is
"^DD",101.41,101.41,53,21,5,0)
selected from the menu, the path continues back up the tree.
"^DD",101.41,101.41,53,"DT")
2950623
"^DD",101.41,101.41,54,0)
LISTBOX TEXT^F^^5;4^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.41,54,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.41,54,"DT")
2960524
"^DD",101.41,101.41,55,0)
WINDOW FORM ID^NJ4,0^^5;5^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."1N.N) X
"^DD",101.41,101.41,55,3)
Type a Number between 0 and 9999, 0 Decimal Digits
"^DD",101.41,101.41,55,21,0)
^.001^23^23^3010727^^
"^DD",101.41,101.41,55,21,1,0)
This field tells the GUI DELPHI code which form to use to process the
"^DD",101.41,101.41,55,21,2,0)
order dialog.  Each number represents a unique form.  Following are some
"^DD",101.41,101.41,55,21,3,0)
of the more common codes and their corresponding form in DELPHI.
"^DD",101.41,101.41,55,21,4,0)
 
"^DD",101.41,101.41,55,21,5,0)
    Form Name     Windows Form ID
"^DD",101.41,101.41,55,21,6,0)
    ---------     ---------------
"^DD",101.41,101.41,55,21,7,0)
  OD_ACTIVITY           100
"^DD",101.41,101.41,55,21,8,0)
  OD_ALLERGY            105
"^DD",101.41,101.41,55,21,9,0)
  OD_CONSULT            110
"^DD",101.41,101.41,55,21,10,0)
  OD_PROCEDURE          112
"^DD",101.41,101.41,55,21,11,0)
  OD_DIET_TXT           115
"^DD",101.41,101.41,55,21,12,0)
  OD_DIET               117
"^DD",101.41,101.41,55,21,13,0)
  OD_LAB                120
"^DD",101.41,101.41,55,21,14,0)
  OD_MEDINPT            130
"^DD",101.41,101.41,55,21,15,0)
  OD_MEDS               135
"^DD",101.41,101.41,55,21,16,0)
  OD_MEDOUTPT           140
"^DD",101.41,101.41,55,21,17,0)
  OD_NURSING            150
"^DD",101.41,101.41,55,21,18,0)
  OD_MISC               151
"^DD",101.41,101.41,55,21,19,0)
  OD_GENERIC            152
"^DD",101.41,101.41,55,21,20,0)
  OD_IMAGING            160
"^DD",101.41,101.41,55,21,21,0)
  OD_VITALS             171 
"^DD",101.41,101.41,55,21,22,0)
  OD_MEDIV              180
"^DD",101.41,101.41,55,21,23,0)
  OD_TEXTONLY           999
"^DD",101.41,101.41,55,"DT")
2960804
"^DD",101.41,101.41,56,0)
CREATE PARENT ORDER^S^1:YES;0:NO;^5;6^Q
"^DD",101.41,101.41,56,3)
Enter YES if a parent order should be created for this order set
"^DD",101.41,101.41,56,21,0)
^^6^6^2970227^
"^DD",101.41,101.41,56,21,1,0)
This flag indicates whether a parent order should be created to group
"^DD",101.41,101.41,56,21,2,0)
together all the orders created by this order set; this flag is only
"^DD",101.41,101.41,56,21,3,0)
valid with SET type order dialogs.  If this value is YES, a parent
"^DD",101.41,101.41,56,21,4,0)
order will be created, and only the parent will be presented on the
"^DD",101.41,101.41,56,21,5,0)
orders list for display and action; NO will prevent a parent from being
"^DD",101.41,101.41,56,21,6,0)
created and all orders will be created and displayed independently.
"^DD",101.41,101.41,56,"DT")
2970227
"^DD",101.41,101.41,57,0)
DISPLAY SUBHEADER^S^1:YES;0:NO;^5;7^Q
"^DD",101.41,101.41,57,3)
Enter YES if a subheader should be displayed as each order in this set is processed
"^DD",101.41,101.41,57,21,0)
^^3^3^2970227^
"^DD",101.41,101.41,57,21,1,0)
This flag indicates whether a subheader is to be displayed for each order
"^DD",101.41,101.41,57,21,2,0)
in this set as it is processed and placed; this flag is only valid with
"^DD",101.41,101.41,57,21,3,0)
SET type order dialogs.
"^DD",101.41,101.41,57,"DT")
2970227
"^DD",101.41,101.41,58,0)
AUTO-ACCEPT QUICK ORDER^S^1:YES;^5;8^Q
"^DD",101.41,101.41,58,3)
Enter 'Yes' if the order should be placed without displaying the dialog window.
"^DD",101.41,101.41,58,21,0)
^^2^2^2980902^
"^DD",101.41,101.41,58,21,1,0)
This can be set to yes for a quick order so that it can be placed simply
"^DD",101.41,101.41,58,21,2,0)
by clicking on it in the GUI (no ordering dialog is displayed).
"^DD",101.41,101.41,58,"DT")
2980902
"^DD",101.41,101.41,59,0)
URL^P101.14^ORD(101.14,^5;9^Q
"^DD",101.41,101.41,59,3)
Enter the URL that should be associated with this dialog.
"^DD",101.41,101.41,59,21,0)
^^3^3^3010724^
"^DD",101.41,101.41,59,21,1,0)
This points an entry in the ORDER HTML FORM file.  The URL is used to
"^DD",101.41,101.41,59,21,2,0)
tpresent the user with an HTML form that can be used to select quick
"^DD",101.41,101.41,59,21,3,0)
orders.
"^DD",101.41,101.41,59,"DT")
3010724
"^DD",101.41,101.41,99,0)
TIMESTAMP^F^^99;1^K:$L(X)>15!($L(X)<1) X
"^DD",101.41,101.41,99,1,0)
^.1
"^DD",101.41,101.41,99,1,1,0)
101.41^AM^MUMPS
"^DD",101.41,101.41,99,1,1,1)
D SET^ORDD41(DA)
"^DD",101.41,101.41,99,1,1,2)
D KILL^ORDD41(DA)
"^DD",101.41,101.41,99,1,1,"%D",0)
^^2^2^2990210^
"^DD",101.41,101.41,99,1,1,"%D",1,0)
Recompiles order dialog menus in ^XUTL("XQORM",<dialog#>_";ORD(101.41,")
"^DD",101.41,101.41,99,1,1,"%D",2,0)
whenever fields necessary to displaying the menu are changed.
"^DD",101.41,101.41,99,1,1,"DT")
2990210
"^DD",101.41,101.41,99,3)
Answer must be 1-15 characters in length.
"^DD",101.41,101.41,99,21,0)
^^2^2^2980501^
"^DD",101.41,101.41,99,21,1,0)
For menus, this contains the $H time the menu was last compiled for use
"^DD",101.41,101.41,99,21,2,0)
with the Unwinder utility (^XQOR).
"^DD",101.41,101.41,99,"DT")
2990210
"^DD",101.41,101.411,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",101.41,101.411,0,"DT")
2950407
"^DD",101.41,101.411,0,"NM","DESCRIPTION")

"^DD",101.41,101.411,0,"UP")
101.41
"^DD",101.41,101.411,.01,0)
DESCRIPTION^W^^0;1^Q
"^DD",101.41,101.411,.01,3)
Enter a description of this dialog.
"^DD",101.41,101.411,.01,21,0)
^^1^1^2950425^^
"^DD",101.41,101.411,.01,21,1,0)
This field contains a description of the content and use of this dialog.
"^DD",101.41,101.411,.01,"DT")
2950407
"^DD",101.41,101.412,0)
ITEMS SUB-FIELD^^117^37
"^DD",101.41,101.412,0,"DT")
2971117
"^DD",101.41,101.412,0,"ID","WRITE")
N OR0,ORNM S OR0=^(0) I $P(OR0,U,2) S ORNM=$P($G(^ORD(101.41,+$P(OR0,U,2),0)),U) D:$L(ORNM) EN^DDIOL(ORNM,,"?10")
"^DD",101.41,101.412,0,"IX","ATXT",101.412,21)

"^DD",101.41,101.412,0,"IX","B",101.412,.01)

"^DD",101.41,101.412,0,"IX","D",101.412,2)

"^DD",101.41,101.412,0,"IX","DAD",101.412,1)

"^DD",101.41,101.412,0,"IX","DAD1",101.412,.01)

"^DD",101.41,101.412,0,"NM","ITEMS")

"^DD",101.41,101.412,0,"UP")
101.41
"^DD",101.41,101.412,.01,0)
SEQUENCE^MNJ5,1^^0;1^K:+X'=X!(X>999.9)!(X<.1)!(X?.E1"."2N.N) X
"^DD",101.41,101.412,.01,1,0)
^.1
"^DD",101.41,101.412,.01,1,1,0)
101.412^B
"^DD",101.41,101.412,.01,1,1,1)
S ^ORD(101.41,DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",101.41,101.412,.01,1,1,2)
K ^ORD(101.41,DA(1),10,"B",$E(X,1,30),DA)
"^DD",101.41,101.412,.01,1,2,0)
101.412^DAD1^MUMPS
"^DD",101.41,101.412,.01,1,2,1)
N ORP S ORP=$P(^ORD(101.41,DA(1),10,DA,0),U,11) S:ORP ^ORD(101.41,DA(1),10,"DAD",ORP,X,DA)=""
"^DD",101.41,101.412,.01,1,2,2)
N ORP S ORP=$P(^ORD(101.41,DA(1),10,DA,0),U,11) K:ORP ^ORD(101.41,DA(1),10,"DAD",ORP,X,DA)
"^DD",101.41,101.412,.01,1,2,"%D",0)
^^1^1^2950511^
"^DD",101.41,101.412,.01,1,2,"%D",1,0)
Allows retrieval of 'child' prompts in sequence by parent.
"^DD",101.41,101.412,.01,1,2,"DT")
2950511
"^DD",101.41,101.412,.01,1,3,0)
101.41^AMM^MUMPS
"^DD",101.41,101.412,.01,1,3,1)
D REDOX^ORDD41
"^DD",101.41,101.412,.01,1,3,2)
D REDOX^ORDD41
"^DD",101.41,101.412,.01,1,3,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.412,.01,1,3,"%D",1,0)
Update TIMESTAMP whenever SEQUENCE is changed.
"^DD",101.41,101.412,.01,1,3,"DT")
2990210
"^DD",101.41,101.412,.01,3)
Type a Number between .1 and 999.9, 1 Decimal Digit
"^DD",101.41,101.412,.01,21,0)
^^2^2^2971117^^^^
"^DD",101.41,101.412,.01,21,1,0)
This field specifies the order in which this item will be displayed or
"^DD",101.41,101.412,.01,21,2,0)
processed.
"^DD",101.41,101.412,.01,"DT")
2990210
"^DD",101.41,101.412,.1,0)
INPUT TRANSFORM^K^^.1;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,.1,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,.1,9)
@
"^DD",101.41,101.412,.1,21,0)
^^2^2^2950816^
"^DD",101.41,101.412,.1,21,1,0)
This is code that will be used as the third piece of DIR(0) when asking
"^DD",101.41,101.412,.1,21,2,0)
this prompt.
"^DD",101.41,101.412,.1,"DT")
2950816
"^DD",101.41,101.412,1,0)
PARENT^P101.41'^ORD(101.41,^0;11^Q
"^DD",101.41,101.412,1,1,0)
^.1
"^DD",101.41,101.412,1,1,1,0)
101.412^DAD^MUMPS
"^DD",101.41,101.412,1,1,1,1)
S ^ORD(101.41,DA(1),10,"DAD",X,$P(^ORD(101.41,DA(1),10,DA,0),U),DA)=""
"^DD",101.41,101.412,1,1,1,2)
K ^ORD(101.41,DA(1),10,"DAD",X,$P(^ORD(101.41,DA(1),10,DA,0),U),DA)
"^DD",101.41,101.412,1,1,1,"%D",0)
^^1^1^2950511^^
"^DD",101.41,101.412,1,1,1,"%D",1,0)
Allows retrieval of 'child' prompts in sequence by parent.
"^DD",101.41,101.412,1,1,1,"DT")
2950511
"^DD",101.41,101.412,1,3)
If this prompt is subordinate to another in this dialog, enter the parent prompt here
"^DD",101.41,101.412,1,21,0)
^^4^4^2950511^
"^DD",101.41,101.412,1,21,1,0)
This field controls the behavior of this prompt.  If a parent is defined
"^DD",101.41,101.412,1,21,2,0)
here, this prompt will be asked from within the parent's dialog; when it
"^DD",101.41,101.412,1,21,3,0)
is invoked independently based on its position sequence number, the child
"^DD",101.41,101.412,1,21,4,0)
prompt will be ignored.
"^DD",101.41,101.412,1,"DT")
2950511
"^DD",101.41,101.412,2,0)
ITEM^P101.41'X^ORD(101.41,^0;2^D TREE^ORDD41
"^DD",101.41,101.412,2,1,0)
^.1
"^DD",101.41,101.412,2,1,1,0)
101.41^AD
"^DD",101.41,101.412,2,1,1,1)
S ^ORD(101.41,"AD",$E(X,1,30),DA(1),DA)=""
"^DD",101.41,101.412,2,1,1,2)
K ^ORD(101.41,"AD",$E(X,1,30),DA(1),DA)
"^DD",101.41,101.412,2,1,1,"DT")
2950123
"^DD",101.41,101.412,2,1,2,0)
101.412^D
"^DD",101.41,101.412,2,1,2,1)
S ^ORD(101.41,DA(1),10,"D",$E(X,1,30),DA)=""
"^DD",101.41,101.412,2,1,2,2)
K ^ORD(101.41,DA(1),10,"D",$E(X,1,30),DA)
"^DD",101.41,101.412,2,1,2,"DT")
2950411
"^DD",101.41,101.412,2,1,3,0)
101.41^AMM2^MUMPS
"^DD",101.41,101.412,2,1,3,1)
D REDOX^ORDD41
"^DD",101.41,101.412,2,1,3,2)
D REDOX^ORDD41
"^DD",101.41,101.412,2,1,3,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.412,2,1,3,"%D",1,0)
Update TIMESTAMP whenever ITEM is changed.
"^DD",101.41,101.412,2,1,3,"DT")
2990210
"^DD",101.41,101.412,2,3)
Enter an order dialog; a dialog that is an ancestor may not also be a sub-item.
"^DD",101.41,101.412,2,21,0)
^^3^3^2950123^
"^DD",101.41,101.412,2,21,1,0)
This field points to an order dialog which is subordinate to this dialog.
"^DD",101.41,101.412,2,21,2,0)
NOTE:  The parent dialog menu or one of its ancestors may not be entered
"^DD",101.41,101.412,2,21,3,0)
as an item.
"^DD",101.41,101.412,2,"DT")
2990217
"^DD",101.41,101.412,3,0)
MNEMONIC^FX^^0;3^K:$L(X)>4!($L(X)<1)!(+X=X&($L(X,".")>1))!($$CHKMNE^ORUTL(X)) X
"^DD",101.41,101.412,3,1,0)
^.1
"^DD",101.41,101.412,3,1,1,0)
101.41^AMM3^MUMPS
"^DD",101.41,101.412,3,1,1,1)
D REDOX^ORDD41
"^DD",101.41,101.412,3,1,1,2)
D REDOX^ORDD41
"^DD",101.41,101.412,3,1,1,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.412,3,1,1,"%D",1,0)
Update TIMESTAMP whenever MNEMONIC is changed.
"^DD",101.41,101.412,3,1,1,"DT")
2990210
"^DD",101.41,101.412,3,3)
Enter a mnemonic to be used when this dialog is displayed for selection, 1-4 characters in length with no decimal places if numeric. Standard list manager mnemonics may not be used.
"^DD",101.41,101.412,3,21,0)
^.001^2^2^3010727^^^^
"^DD",101.41,101.412,3,21,1,0)
This is a short abbreviation for this item dialog to be used when this
"^DD",101.41,101.412,3,21,2,0)
dialog is displayed for selection.
"^DD",101.41,101.412,3,"DT")
3000822
"^DD",101.41,101.412,4,0)
DISPLAY TEXT^FX^^0;4^K:$L(X)>80!($L(X)<1)!($$CHKNAM^ORUTL(X)) X
"^DD",101.41,101.412,4,1,0)
^.1
"^DD",101.41,101.412,4,1,1,0)
101.41^AMM4^MUMPS
"^DD",101.41,101.412,4,1,1,1)
D REDOX^ORDD41
"^DD",101.41,101.412,4,1,1,2)
D REDOX^ORDD41
"^DD",101.41,101.412,4,1,1,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.412,4,1,1,"%D",1,0)
Update TIMESTAMP whenever DISPLAY TEXT is changed.
"^DD",101.41,101.412,4,1,1,"DT")
2990210
"^DD",101.41,101.412,4,3)
Answer must be 1-80 characters in length and cannot contain a semicolon (;), a comma (,), an up-arrow (^), a dash (-), or an equal sign (=).
"^DD",101.41,101.412,4,21,0)
^.001^2^2^3010419^^^^
"^DD",101.41,101.412,4,21,1,0)
This field allows the text that normally appears for this item to be
"^DD",101.41,101.412,4,21,2,0)
replaced with alternate text for use in this dialog or menu.
"^DD",101.41,101.412,4,"DT")
3000823
"^DD",101.41,101.412,5,0)
DISPLAY ONLY?^S^0:NO;1:YES;2:YES-HEADER;^0;5^Q
"^DD",101.41,101.412,5,1,0)
^.1
"^DD",101.41,101.412,5,1,1,0)
101.41^AMM5^MUMPS
"^DD",101.41,101.412,5,1,1,1)
D REDOX^ORDD41
"^DD",101.41,101.412,5,1,1,2)
D REDOX^ORDD41
"^DD",101.41,101.412,5,1,1,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.412,5,1,1,"%D",1,0)
Update TIMESTAMP whenever DISPLAY ONLY? is changed.
"^DD",101.41,101.412,5,1,1,"DT")
2990210
"^DD",101.41,101.412,5,3)
Enter YES if this item is text for display only and not a selectable item.
"^DD",101.41,101.412,5,21,0)
^^3^3^2970409^^^^
"^DD",101.41,101.412,5,21,1,0)
This field identifies an item as being free text for display purposes
"^DD",101.41,101.412,5,21,2,0)
only.  The text in the Display Text field will be displayed, but it
"^DD",101.41,101.412,5,21,3,0)
is not selectable; if designated as a header, the text will be underlined.
"^DD",101.41,101.412,5,"DT")
2990210
"^DD",101.41,101.412,6,0)
REQUIRED^S^1:YES;0:NO;^0;6^Q
"^DD",101.41,101.412,6,3)
Enter YES if a response to this prompt is mandatory.
"^DD",101.41,101.412,6,21,0)
^^1^1^2950407^
"^DD",101.41,101.412,6,21,1,0)
This field indicates that the user must enter a response to this prompt.
"^DD",101.41,101.412,6,"DT")
2950407
"^DD",101.41,101.412,7,0)
MULTIPLE VALUED^S^1:YES;0:NO;^0;7^Q
"^DD",101.41,101.412,7,3)
Enter YES if this prompt is to be asked multiple times.
"^DD",101.41,101.412,7,21,0)
^^3^3^2950407^
"^DD",101.41,101.412,7,21,1,0)
This field determines if this prompt will be allowed to have multiple
"^DD",101.41,101.412,7,21,2,0)
values, or be prompted for only once; if this prompt is a sub-dialog,
"^DD",101.41,101.412,7,21,3,0)
the entire dialog will be asked once or many times, as a group.
"^DD",101.41,101.412,7,"DT")
2950407
"^DD",101.41,101.412,7.1,0)
MAX NUMBER OF MULTIPLES^NJ2,0^^0;12^K:+X'=X!(X>99)!(X<2)!(X?.E1"."1N.N) X
"^DD",101.41,101.412,7.1,3)
Type a Number between 2 and 99, 0 Decimal Digits
"^DD",101.41,101.412,7.1,21,0)
^^4^4^2950815^
"^DD",101.41,101.412,7.1,21,1,0)
This is the maximum number of values that may be entered for this prompt,
"^DD",101.41,101.412,7.1,21,2,0)
if it is flagged as being multiple-valued.  For example, a diet order may
"^DD",101.41,101.412,7.1,21,3,0)
have up to 5 diet modifications entered, where 5 is the maximum allowed
"^DD",101.41,101.412,7.1,21,4,0)
that would be entered here.
"^DD",101.41,101.412,7.1,"DT")
2950815
"^DD",101.41,101.412,7.2,0)
TITLE^F^^0;13^K:$L(X)>30!($L(X)<3) X
"^DD",101.41,101.412,7.2,3)
Answer must be 3-30 characters in length.
"^DD",101.41,101.412,7.2,21,0)
^^8^8^2970430^^
"^DD",101.41,101.412,7.2,21,1,0)
This is text that will be used in place of the prompt when the order is
"^DD",101.41,101.412,7.2,21,2,0)
displayed for place, edit, or cancel, or at the top of a multiple-valued
"^DD",101.41,101.412,7.2,21,3,0)
prompt.  The Display Text for the prompt will be used together with the
"^DD",101.41,101.412,7.2,21,4,0)
instance number to prompt for user input; for example if Title="Lab Tests:"
"^DD",101.41,101.412,7.2,21,5,0)
and Display Text="Test:" the user would see
"^DD",101.41,101.412,7.2,21,6,0)
  Lab Tests:
"^DD",101.41,101.412,7.2,21,7,0)
  1. Test:
"^DD",101.41,101.412,7.2,21,8,0)
  2. Test:
"^DD",101.41,101.412,7.2,"DT")
2950815
"^DD",101.41,101.412,7.3,0)
PROMPT^F^^0;14^K:$L(X)>10!($L(X)<1) X
"^DD",101.41,101.412,7.3,3)
Answer must be 1-10 characters in length.
"^DD",101.41,101.412,7.3,21,0)
^^3^3^2970618^
"^DD",101.41,101.412,7.3,21,1,0)
This field contains text that will be appended to the beginning of the
"^DD",101.41,101.412,7.3,21,2,0)
display text when prompting for additional values; if this field is
"^DD",101.41,101.412,7.3,21,3,0)
empty, then "Another " will be used.
"^DD",101.41,101.412,7.3,"DT")
2970618
"^DD",101.41,101.412,8,0)
ASK ON EDIT ONLY^S^1:YES;0:NO;^0;8^Q
"^DD",101.41,101.412,8,3)
Enter YES if this prompt should not be asked initially when creating this order, only if the user chooses to edit the order.
"^DD",101.41,101.412,8,21,0)
^^4^4^2960112^^^
"^DD",101.41,101.412,8,21,1,0)
This field determines the behaviour of the dialog driver for this prompt;
"^DD",101.41,101.412,8,21,2,0)
if no value or the defined default is usually correct for this prompt,
"^DD",101.41,101.412,8,21,3,0)
enter YES here to have this prompt skipped on the first pass through this
"^DD",101.41,101.412,8,21,4,0)
dialog when creating an order.
"^DD",101.41,101.412,8,"DT")
2950407
"^DD",101.41,101.412,9,0)
ASK ON ACTION^F^^0;9^K:$L(X)>3!($L(X)<1) X
"^DD",101.41,101.412,9,3)
Answer must be 1-3 characters in length.
"^DD",101.41,101.412,9,21,0)
^^6^6^2970708^^^
"^DD",101.41,101.412,9,21,1,0)
This field determines the behaviour of the dialog driver for this prompt
"^DD",101.41,101.412,9,21,2,0)
when taking a particular action on an order created by this dialog.  If
"^DD",101.41,101.412,9,21,3,0)
this string contains "R", this prompt will be asked when renewing an order;
"^DD",101.41,101.412,9,21,4,0)
if this string contains "C", this prompt will be asked when changing an
"^DD",101.41,101.412,9,21,5,0)
order; if this string contains "W", this prompt will be asked when
"^DD",101.41,101.412,9,21,6,0)
rewriting an order.
"^DD",101.41,101.412,9,"DT")
2970708
"^DD",101.41,101.412,10,0)
INDEX^F^^0;10^K:$L(X)>25!($L(X)<1) X
"^DD",101.41,101.412,10,3)
Answer must be 1-25 characters in length.
"^DD",101.41,101.412,10,21,0)
^^3^3^2950713^^^
"^DD",101.41,101.412,10,21,1,0)
For pointer-type prompts, this is the index to use when searching the file;
"^DD",101.41,101.412,10,21,2,0)
it must be in the form of a regular cross-reference.  To search on multiple
"^DD",101.41,101.412,10,21,3,0)
indices, enter a string of index names separated by semi-colons, i.e. "B;C".
"^DD",101.41,101.412,10,"DT")
2950713
"^DD",101.41,101.412,11,0)
HELP MESSAGE^F^^1;1^K:$L(X)>160!($L(X)<1) X
"^DD",101.41,101.412,11,3)
Answer must be 1-160 characters in length.
"^DD",101.41,101.412,11,21,0)
^^2^2^2970609^^
"^DD",101.41,101.412,11,21,1,0)
This field contains the help message to be presented when the user enters
"^DD",101.41,101.412,11,21,2,0)
a question mark at this prompt.
"^DD",101.41,101.412,11,"DT")
2970609
"^DD",101.41,101.412,12,0)
SPECIAL LOOKUP ROUTINE^F^^1;2^K:$L(X)>20!($L(X)<3) X
"^DD",101.41,101.412,12,3)
Enter the routine to use instead of DIC to do this lookup, as [TAG;]ROUTINE
"^DD",101.41,101.412,12,21,0)
^^3^3^2970609^
"^DD",101.41,101.412,12,21,1,0)
This field contains a routine to execute that will replace the standard
"^DD",101.41,101.412,12,21,2,0)
DIC lookup for this prompt; it must be entered here as LINETAG;ROUTINE
"^DD",101.41,101.412,12,21,3,0)
using a ; instead of ^ and where LINETAG is optional.
"^DD",101.41,101.412,12,"DT")
2970609
"^DD",101.41,101.412,13,0)
ASK ON CONDITION^K^^3;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,13,3)
This is MUMPS code that sets $T to determine if this prompt should be asked, or given a default value and bypassed.
"^DD",101.41,101.412,13,9)
@
"^DD",101.41,101.412,13,21,0)
^^5^5^2950407^
"^DD",101.41,101.412,13,21,1,0)
This is MUMPS code that sets $T to determine if this prompt should be asked
"^DD",101.41,101.412,13,21,2,0)
or simply given a default value and presented to the user for acceptance
"^DD",101.41,101.412,13,21,3,0)
or editing.  For example, the prompt "Pregnant: " may have code here to
"^DD",101.41,101.412,13,21,4,0)
check the sex of the current patient, i.e. I ORSEX="F" will allow it to be
"^DD",101.41,101.412,13,21,5,0)
asked only for female patients.
"^DD",101.41,101.412,13,"DT")
2950407
"^DD",101.41,101.412,14,0)
SCREEN^K^^4;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,14,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,14,9)
@
"^DD",101.41,101.412,14,21,0)
^^2^2^2950407^
"^DD",101.41,101.412,14,21,1,0)
For pointer-type prompts, this field may contain MUMPS code that will be
"^DD",101.41,101.412,14,21,2,0)
set into DIC("S") to screen the possible choices in the pointed-to file.
"^DD",101.41,101.412,14,"DT")
2950407
"^DD",101.41,101.412,15,0)
POST-SELECTION ACTION^K^^5;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,15,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,15,9)
@
"^DD",101.41,101.412,15,21,0)
^^3^3^2970923^^^^
"^DD",101.41,101.412,15,21,1,0)
This is code that will be executed after a response is entered to this
"^DD",101.41,101.412,15,21,2,0)
prompt; if this prompt should be re-asked, kill the variable DONE.
"^DD",101.41,101.412,15,21,3,0)
If execution of the ordering dialog should be stopped, set ORQUIT=1.
"^DD",101.41,101.412,15,"DT")
2970923
"^DD",101.41,101.412,16,0)
XECUTABLE HELP^K^^6;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,16,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,16,9)
@
"^DD",101.41,101.412,16,21,0)
^^2^2^2950407^
"^DD",101.41,101.412,16,21,1,0)
This is code that is to be executed when the user enters two or more
"^DD",101.41,101.412,16,21,2,0)
question marks at this prompt.
"^DD",101.41,101.412,16,"DT")
2950407
"^DD",101.41,101.412,17,0)
DEFAULT^K^^7;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,17,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,17,9)
@
"^DD",101.41,101.412,17,21,0)
^^2^2^2971219^^^^
"^DD",101.41,101.412,17,21,1,0)
This is code that is to be executed to determine the appropriate default
"^DD",101.41,101.412,17,21,2,0)
value for this prompt, setting Y=internal form of this value.
"^DD",101.41,101.412,17,"DT")
2950519
"^DD",101.41,101.412,18,0)
DEFAULT WORD-PROCESSING TEXT^101.41218^^8;0
"^DD",101.41,101.412,18,21,0)
^^1^1^2971219^
"^DD",101.41,101.412,18,21,1,0)
This is default text to be stuffed into this word-processing prompt.
"^DD",101.41,101.412,19,0)
ENTRY ACTION^K^^9;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,19,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,19,9)
@
"^DD",101.41,101.412,19,21,0)
^^3^3^2970609^
"^DD",101.41,101.412,19,21,1,0)
This is code that will be executed at the beginning of the processing of
"^DD",101.41,101.412,19,21,2,0)
this prompt, before the Default and Ask on Condition fields are executed;
"^DD",101.41,101.412,19,21,3,0)
any special setup required for this field should be done here.
"^DD",101.41,101.412,19,"DT")
2970609
"^DD",101.41,101.412,20,0)
EXIT ACTION^K^^10;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,20,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,20,9)
@
"^DD",101.41,101.412,20,21,0)
^^3^3^2970609^
"^DD",101.41,101.412,20,21,1,0)
This is code that will be executed at the very end of the processing of
"^DD",101.41,101.412,20,21,2,0)
this prompt, after prompting and the Validation field is executed;
"^DD",101.41,101.412,20,21,3,0)
any special cleanup should be done here.
"^DD",101.41,101.412,20,"DT")
2970609
"^DD",101.41,101.412,21,0)
ORDER TEXT SEQUENCE^NJ5,2^^2;1^K:+X'=X!(X>99.99)!(X<1)!(X?.E1"."3N.N) X
"^DD",101.41,101.412,21,1,0)
^.1
"^DD",101.41,101.412,21,1,1,0)
101.412^ATXT
"^DD",101.41,101.412,21,1,1,1)
S ^ORD(101.41,DA(1),10,"ATXT",$E(X,1,30),DA)=""
"^DD",101.41,101.412,21,1,1,2)
K ^ORD(101.41,DA(1),10,"ATXT",$E(X,1,30),DA)
"^DD",101.41,101.412,21,1,1,"%D",0)
^^1^1^2960226^
"^DD",101.41,101.412,21,1,1,"%D",1,0)
Used to build order text.
"^DD",101.41,101.412,21,1,1,"DT")
2960226
"^DD",101.41,101.412,21,3)
Enter the order in which this value should be added to the order text, as a number between 1 and 99.99; leave this field blank to prevent this value from being included
"^DD",101.41,101.412,21,21,0)
^^3^3^2970607^^^
"^DD",101.41,101.412,21,21,1,0)
This field indicates the order in which values will be concatenated
"^DD",101.41,101.412,21,21,2,0)
together to build the order text; this may differ from the prompting
"^DD",101.41,101.412,21,21,3,0)
order defined in the .01 Sequence field.
"^DD",101.41,101.412,21,"DT")
2960226
"^DD",101.41,101.412,22,0)
FORMAT^F^^2;2^K:$L(X)>10!($L(X)<1) X
"^DD",101.41,101.412,22,3)
Answer must be 1-10 characters in length.
"^DD",101.41,101.412,22,21,0)
^^15^15^2971207^^^^
"^DD",101.41,101.412,22,21,1,0)
This is a string of characters that will define any exceptions to how
"^DD",101.41,101.412,22,21,2,0)
the external form of this value is generated.  Possible values include:
"^DD",101.41,101.412,22,21,3,0)
  Pointer         -> <field #>~<piece in RPC list of field #>, default =.01
"^DD",101.41,101.412,22,21,4,0)
  Set of Codes    -> 1~<piece in RPC list of code> to use code for name
"^DD",101.41,101.412,22,21,5,0)
  Date/Time       -> Format string to pass $$FMTE^XLFDT (default = 2)
"^DD",101.41,101.412,22,21,6,0)
  
"^DD",101.41,101.412,22,21,7,0)
  Suppress value  -> @
"^DD",101.41,101.412,22,21,8,0)
  Replace value   -> @<ptr> where ptr is the Dialog IEN of the prompt
"^DD",101.41,101.412,22,21,9,0)
                      whose value, when present, supersedes this value
"^DD",101.41,101.412,22,21,10,0)
  Required value  -> *<ptr> where ptr is the Dialog IEN of the prompt
"^DD",101.41,101.412,22,21,11,0)
                      whose value is required to be present to include
"^DD",101.41,101.412,22,21,12,0)
                      this value
"^DD",101.41,101.412,22,21,13,0)
  Ignore if same  -> =<ptr> where ptr is the Dialog IEN of the prompt
"^DD",101.41,101.412,22,21,14,0)
                      whose value, if the external form is the same,
"^DD",101.41,101.412,22,21,15,0)
                      supersedes this value
"^DD",101.41,101.412,22,"DT")
2960226
"^DD",101.41,101.412,23,0)
OMIT TEXT^F^^2;3^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.412,23,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.412,23,21,0)
^^3^3^2970829^^^^
"^DD",101.41,101.412,23,21,1,0)
This is the external form of a value that is not to be included when building
"^DD",101.41,101.412,23,21,2,0)
the order text.  E.g. to include the urgency in the order text unless it
"^DD",101.41,101.412,23,21,3,0)
is routine, enter "ROUTINE" here.
"^DD",101.41,101.412,23,"DT")
2970829
"^DD",101.41,101.412,24,0)
LEADING TEXT^F^^2;4^K:$L(X)>80!($L(X)<1) X
"^DD",101.41,101.412,24,3)
Answer must be 1-80 characters in length.
"^DD",101.41,101.412,24,21,0)
^^3^3^2970724^^^^
"^DD",101.41,101.412,24,21,1,0)
This field contains text that will be appended to the order text
"^DD",101.41,101.412,24,21,2,0)
immediately in front of this value, e.g. "Instructions:".  If this text
"^DD",101.41,101.412,24,21,3,0)
is contained in a variable, enter @NAME where NAME is the variable name.
"^DD",101.41,101.412,24,"DT")
2970724
"^DD",101.41,101.412,25,0)
TRAILING TEXT^F^^2;5^K:$L(X)>80!($L(X)<1) X
"^DD",101.41,101.412,25,3)
Answer must be 1-80 characters in length.
"^DD",101.41,101.412,25,21,0)
^^3^3^2970724^^^^
"^DD",101.41,101.412,25,21,1,0)
This field contains text that will be appended to the order text
"^DD",101.41,101.412,25,21,2,0)
immediately following this value, e.g. "refills".  If this text is
"^DD",101.41,101.412,25,21,3,0)
contained in a variable, enter @NAME where NAME is the variable name.
"^DD",101.41,101.412,25,"DT")
2970724
"^DD",101.41,101.412,26,0)
START NEW LINE^S^1:YES;0:NO;^2;6^Q
"^DD",101.41,101.412,26,3)
Enter YES if this value should begin on a new line in the order text.
"^DD",101.41,101.412,26,21,0)
0^^2^2^2970911^
"^DD",101.41,101.412,26,21,1,0)
This field determines if this value is concatenated onto the current line
"^DD",101.41,101.412,26,21,2,0)
when building the order text, or if a new line is started with this value.
"^DD",101.41,101.412,26,"DT")
2970911
"^DD",101.41,101.412,27,0)
WORD-WRAP^S^1:DON'T WRAP;0:WRAP;^2;7^Q
"^DD",101.41,101.412,27,3)
Enter 'Don't Wrap' to have the text be added line-by-line as it is stored; the default formatting is 'Wrap'.
"^DD",101.41,101.412,27,21,0)
^^3^3^2970926^^^
"^DD",101.41,101.412,27,21,1,0)
This field determines if this text should be wrapped when added to the
"^DD",101.41,101.412,27,21,2,0)
order text, or appended line by line as stored in the file; this is only
"^DD",101.41,101.412,27,21,3,0)
used for word-processing type prompts.
"^DD",101.41,101.412,27,"DT")
2970926
"^DD",101.41,101.412,101,0)
WINDOWS CONTROL^F^^W;1^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.412,101,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.412,101,21,0)
^^2^2^2950715^
"^DD",101.41,101.412,101,21,1,0)
Stores the type of Windows control necessary to get the data for this
"^DD",101.41,101.412,101,21,2,0)
prompt.
"^DD",101.41,101.412,101,"DT")
2960517
"^DD",101.41,101.412,102,0)
API NAME^F^^W;2^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.412,102,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.412,102,21,0)
^^3^3^2950715^
"^DD",101.41,101.412,102,21,1,0)
This is the API that should be called when the control is used.  How the API
"^DD",101.41,101.412,102,21,2,0)
is used varys with the control.  Examples are: filling list boxes, getting
"^DD",101.41,101.412,102,21,3,0)
boilerplate text, etc.
"^DD",101.41,101.412,102,"DT")
2951002
"^DD",101.41,101.412,103,0)
API PARAMETER #1^F^^W;3^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.412,103,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.412,103,21,0)
^^1^1^2950715^
"^DD",101.41,101.412,103,21,1,0)
A parameter that is used by the API call may be stored here.
"^DD",101.41,101.412,103,"DT")
2950715
"^DD",101.41,101.412,113,0)
WINDOWS CONDITION^K^^W3;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,113,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,113,9)
@
"^DD",101.41,101.412,113,21,0)
^^3^3^2950715^
"^DD",101.41,101.412,113,21,1,0)
This is silent code that is executed when building the dialog for windows.
"^DD",101.41,101.412,113,21,2,0)
It identifies which prompts should be included in the dialog.  The condition
"^DD",101.41,101.412,113,21,3,0)
should leave $T false if the prompt should not be asked.
"^DD",101.41,101.412,113,"DT")
2950715
"^DD",101.41,101.412,117,0)
WINDOWS DEFAULT^K^^W7;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,117,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,117,9)
@
"^DD",101.41,101.412,117,21,0)
^^2^2^2950715^
"^DD",101.41,101.412,117,21,1,0)
This code should silently set the default value of a prompt when it is 
"^DD",101.41,101.412,117,21,2,0)
selected.
"^DD",101.41,101.412,117,"DT")
2950715
"^DD",101.41,101.41218,0)
DEFAULT WORD-PROCESSING TEXT SUB-FIELD^^.01^1
"^DD",101.41,101.41218,0,"DT")
2950407
"^DD",101.41,101.41218,0,"NM","DEFAULT WORD-PROCESSING TEXT")

"^DD",101.41,101.41218,0,"UP")
101.412
"^DD",101.41,101.41218,.01,0)
DEFAULT WORD-PROCESSING TEXT^W^^0;1^Q
"^DD",101.41,101.41218,.01,3)
Enter the default response for a word-processing type prompt.
"^DD",101.41,101.41218,.01,21,0)
^^2^2^2950407^
"^DD",101.41,101.41218,.01,21,1,0)
This field contains the text to be presented as the default for this prompt,
"^DD",101.41,101.41218,.01,21,2,0)
for word-processing type prompts.
"^DD",101.41,101.41218,.01,"DT")
2950407
"^DD",101.41,101.415,0)
CONTROLS SUB-FIELD^^14^14
"^DD",101.41,101.415,0,"DT")
2960202
"^DD",101.41,101.415,0,"IX","AC",101.415,3)

"^DD",101.41,101.415,0,"IX","B",101.415,.01)

"^DD",101.41,101.415,0,"NM","CONTROLS")

"^DD",101.41,101.415,0,"UP")
101.41
"^DD",101.41,101.415,.01,0)
LOGICAL NAME^MF^^0;1^K:$L(X)>8!($L(X)<1)!'(X?1.8U) X
"^DD",101.41,101.415,.01,1,0)
^.1
"^DD",101.41,101.415,.01,1,1,0)
101.415^B
"^DD",101.41,101.415,.01,1,1,1)
S ^ORD(101.41,DA(1),50,"B",$E(X,1,30),DA)=""
"^DD",101.41,101.415,.01,1,1,2)
K ^ORD(101.41,DA(1),50,"B",$E(X,1,30),DA)
"^DD",101.41,101.415,.01,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,.01,21,0)
^^1^1^2960202^
"^DD",101.41,101.415,.01,21,1,0)
This is the name by which controls can refer to each other.
"^DD",101.41,101.415,.01,"DT")
2960202
"^DD",101.41,101.415,2,0)
ITEM^P101.41'^ORD(101.41,^0;2^Q
"^DD",101.41,101.415,2,"DT")
2960202
"^DD",101.41,101.415,3,0)
CREATE SEQUENCE^NJ2,0^^0;3^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.41,101.415,3,1,0)
^.1
"^DD",101.41,101.415,3,1,1,0)
101.415^AC
"^DD",101.41,101.415,3,1,1,1)
S ^ORD(101.41,DA(1),50,"AC",$E(X,1,30),DA)=""
"^DD",101.41,101.415,3,1,1,2)
K ^ORD(101.41,DA(1),50,"AC",$E(X,1,30),DA)
"^DD",101.41,101.415,3,1,1,"%D",0)
^^2^2^2960202^
"^DD",101.41,101.415,3,1,1,"%D",1,0)
The 'AC' cross-reference puts in window controls in order by creation 
"^DD",101.41,101.415,3,1,1,"%D",2,0)
sequence.
"^DD",101.41,101.415,3,1,1,"DT")
2960202
"^DD",101.41,101.415,3,3)
Type a Number between 1 and 99, 0 Decimal Digits
"^DD",101.41,101.415,3,"DT")
2960202
"^DD",101.41,101.415,4,0)
CONTROL TYPE^S^0:Label;1:Button;2:Edit;3:Memo;4:ListBox;5:SimpleCombo;6:DropDownList;7:LongCombo;^0;4^Q
"^DD",101.41,101.415,4,"DT")
2960202
"^DD",101.41,101.415,5,0)
LABEL^F^^0;5^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.415,5,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.415,5,"DT")
2960202
"^DD",101.41,101.415,6,0)
BESIDE^F^^0;6^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,6,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,6,"DT")
2960202
"^DD",101.41,101.415,7,0)
BELOW^F^^0;7^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,7,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,7,"DT")
2960202
"^DD",101.41,101.415,8,0)
WIDTH^NJ6,4^^0;8^K:+X'=X!(X>1)!(X<0)!(X?.E1"."5N.N) X
"^DD",101.41,101.415,8,3)
Type a Number between 0 and 1, 4 Decimal Digits
"^DD",101.41,101.415,8,"DT")
2960202
"^DD",101.41,101.415,9,0)
LEFT CONTROL^F^^0;9^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,9,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,9,"DT")
2960202
"^DD",101.41,101.415,10,0)
RIGHT CONTROL^F^^0;10^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,10,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,10,"DT")
2960202
"^DD",101.41,101.415,11,0)
HEIGHT^NJ2,0^^0;11^K:+X'=X!(X>15)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.41,101.415,11,3)
Type a Number between 1 and 15, 0 Decimal Digits
"^DD",101.41,101.415,11,"DT")
2960202
"^DD",101.41,101.415,12,0)
UPPER CONTROL^F^^0;12^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,12,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,12,"DT")
2960202
"^DD",101.41,101.415,13,0)
LOWER CONTROL^F^^0;13^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,13,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,13,"DT")
2960202
"^DD",101.41,101.415,14,0)
TAB SEQUENCE^NJ2,0^^0;14^K:+X'=X!(X>89)!(X<0)!(X?.E1"."1N.N) X
"^DD",101.41,101.415,14,3)
Type a Number between 0 and 89, 0 Decimal Digits
"^DD",101.41,101.415,14,"DT")
2960202
"^DD",101.41,101.416,0)
RESPONSES SUB-FIELD^^2^5
"^DD",101.41,101.416,0,"DT")
2960717
"^DD",101.41,101.416,0,"IX","D",101.416,.02)

"^DD",101.41,101.416,0,"NM","RESPONSES")

"^DD",101.41,101.416,0,"UP")
101.41
"^DD",101.41,101.416,.01,0)
ITEM ENTRY^MNJ7,0^^0;1^K:+X'=X!(X>9999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.41,101.416,.01,1,0)
^.1^^0
"^DD",101.41,101.416,.01,3)
Type a Number between 1 and 9999999, 0 Decimal Digits
"^DD",101.41,101.416,.01,21,0)
^^2^2^2971219^^^
"^DD",101.41,101.416,.01,21,1,0)
This is the internal entry number of the prompt in the Item multiple
"^DD",101.41,101.416,.01,21,2,0)
by which this response was obtained.
"^DD",101.41,101.416,.01,"DT")
2961118
"^DD",101.41,101.416,.02,0)
DIALOG^P101.41'^ORD(101.41,^0;2^Q
"^DD",101.41,101.416,.02,1,0)
^.1
"^DD",101.41,101.416,.02,1,1,0)
101.416^D
"^DD",101.41,101.416,.02,1,1,1)
S ^ORD(101.41,DA(1),6,"D",$E(X,1,30),DA)=""
"^DD",101.41,101.416,.02,1,1,2)
K ^ORD(101.41,DA(1),6,"D",$E(X,1,30),DA)
"^DD",101.41,101.416,.02,1,1,"DT")
2961118
"^DD",101.41,101.416,.02,3)
Select the dialog prompt from which this response was generated.
"^DD",101.41,101.416,.02,21,0)
^^2^2^2960717^
"^DD",101.41,101.416,.02,21,1,0)
This is a pointer to the dialog prompt, which is in the Order Dialog file
"^DD",101.41,101.416,.02,21,2,0)
as type prompt.
"^DD",101.41,101.416,.02,"DT")
2961118
"^DD",101.41,101.416,.03,0)
INSTANCE^NJ7,0^^0;3^K:+X'=X!(X>9999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.41,101.416,.03,3)
Type a Number between 1 and 9999999, 0 Decimal Digits
"^DD",101.41,101.416,.03,21,0)
^^2^2^2960717^
"^DD",101.41,101.416,.03,21,1,0)
In the case of multiple answers for the same item, this identifies the
"^DD",101.41,101.416,.03,21,2,0)
individual instance.
"^DD",101.41,101.416,.03,"DT")
2960717
"^DD",101.41,101.416,1,0)
VALUE^FO^^1;1^K:$L(X)>245!($L(X)<1) X
"^DD",101.41,101.416,1,2)
S Y(0)=Y S Y=$$OUTPUT^ORCMEDT5(Y)
"^DD",101.41,101.416,1,2.1)
S Y=$$OUTPUT^ORCMEDT5(Y)
"^DD",101.41,101.416,1,3)
Answer must be 1-245 characters in length.
"^DD",101.41,101.416,1,21,0)
^^2^2^2971219^^
"^DD",101.41,101.416,1,21,1,0)
This contains the actual response, unless the value is a word processing
"^DD",101.41,101.416,1,21,2,0)
type.
"^DD",101.41,101.416,1,"DT")
2980717
"^DD",101.41,101.416,2,0)
TEXT^101.4162^^2;0
"^DD",101.41,101.416,2,21,0)
^^1^1^2971219^
"^DD",101.41,101.416,2,21,1,0)
This contains the actual response, for word-processing type prompts.
"^DD",101.41,101.416,2,"DT")
2960717
"^DD",101.41,101.4162,0)
TEXT SUB-FIELD^^.01^1
"^DD",101.41,101.4162,0,"DT")
2960717
"^DD",101.41,101.4162,0,"NM","TEXT")

"^DD",101.41,101.4162,0,"UP")
101.416
"^DD",101.41,101.4162,.01,0)
TEXT^WL^^0;1^Q
"^DD",101.41,101.4162,.01,21,0)
^^1^1^2960717^^
"^DD",101.41,101.4162,.01,21,1,0)
This contains responses to items that are a word processing type.
"^DD",101.41,101.4162,.01,"DT")
2960717
"^DD",101.43,101.43,6001,0)
BLOOD COMPONENT^S^1:YES;0:NO;^VB;1^Q
"^DD",101.43,101.43,6001,1,0)
^.1
"^DD",101.43,101.43,6001,1,1,0)
101.43^S10^MUMPS
"^DD",101.43,101.43,6001,1,1,1)
D:X SET^ORDD43("VBC",DA)
"^DD",101.43,101.43,6001,1,1,2)
D:X KILL^ORDD43("VBC",DA)
"^DD",101.43,101.43,6001,1,1,"%D",0)
^^1^1^3031125^
"^DD",101.43,101.43,6001,1,1,"%D",1,0)
Creates an entry in SET multiple.
"^DD",101.43,101.43,6001,1,1,"DT")
3031125
"^DD",101.43,101.43,6001,3)
Enter YES if this orderable item is a blood component.
"^DD",101.43,101.43,6001,"DT")
3031125
"^DD",101.43,101.43,6002,0)
DIAGNOSTIC TEST^S^0:NO;1:YES;2:TAS;^VB;2^Q
"^DD",101.43,101.43,6002,1,0)
^.1
"^DD",101.43,101.43,6002,1,1,0)
101.43^S11^MUMPS
"^DD",101.43,101.43,6002,1,1,1)
D:X SET^ORDD43("VBT",DA)
"^DD",101.43,101.43,6002,1,1,2)
D:X KILL^ORDD43("VBT",DA)
"^DD",101.43,101.43,6002,1,1,"%D",0)
^^1^1^3031125^
"^DD",101.43,101.43,6002,1,1,"%D",1,0)
Creates an entry in SET multiple.
"^DD",101.43,101.43,6002,1,1,"DT")
3031125
"^DD",101.43,101.43,6002,3)
Enter YES if this item is a diagnostic test, TAS if the test is a Type & Screen.
"^DD",101.43,101.43,6002,"DT")
3031125
"^DIC",100.98,100.98,0)
DISPLAY GROUP^100.98I
"^DIC",100.98,100.98,0,"GL")
^ORD(100.98,
"^DIC",100.98,100.98,"%D",0)
^^5^5^2971218^^^^
"^DIC",100.98,100.98,"%D",1,0)
This file allows orders to be clustered in groups other than by package.
"^DIC",100.98,100.98,"%D",2,0)
It is similar in structure to the OPTION File (19).  This allows display
"^DIC",100.98,100.98,"%D",3,0)
groups to be arranged in a hierarchy.  The main entry in this file
"^DIC",100.98,100.98,"%D",4,0)
should be 'ALL SERVICES'.  Other entries should be logically subordinate
"^DIC",100.98,100.98,"%D",5,0)
to the 'ALL SERVICES' entry.
"^DIC",100.98,"B","DISPLAY GROUP",100.98)

"^DIC",101.41,101.41,0)
ORDER DIALOG^101.41
"^DIC",101.41,101.41,0,"GL")
^ORD(101.41,
"^DIC",101.41,101.41,"%D",0)
^^2^2^2960819^^
"^DIC",101.41,101.41,"%D",1,0)
This file contains the information needed to define how to prompt for each
"^DIC",101.41,101.41,"%D",2,0)
order, what values are acceptable, etc.
"^DIC",101.41,"B","ORDER DIALOG",101.41)

**END**
**END**
