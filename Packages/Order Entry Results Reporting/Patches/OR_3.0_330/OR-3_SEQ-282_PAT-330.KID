Released OR*3*330 SEQ #282
Extracted from mail message
**KIDS**:OR*3.0*330^

**INSTALL NAME**
OR*3.0*330
"BLD",19286,0)
OR*3.0*330^ORDER ENTRY/RESULTS REPORTING^0^3100803^y
"BLD",19286,1,0)
^^2^2^3100803^
"BLD",19286,1,1,0)
The description of this patch may be found in the National Patch Module
"BLD",19286,1,2,0)
under OR*3*330.
"BLD",19286,4,0)
^9.64PA^^
"BLD",19286,6)
1^
"BLD",19286,6.3)
2
"BLD",19286,"ABPKG")
n
"BLD",19286,"KRN",0)
^9.67PA^779.2^20
"BLD",19286,"KRN",.4,0)
.4
"BLD",19286,"KRN",.401,0)
.401
"BLD",19286,"KRN",.402,0)
.402
"BLD",19286,"KRN",.403,0)
.403
"BLD",19286,"KRN",.5,0)
.5
"BLD",19286,"KRN",.84,0)
.84
"BLD",19286,"KRN",3.6,0)
3.6
"BLD",19286,"KRN",3.8,0)
3.8
"BLD",19286,"KRN",9.2,0)
9.2
"BLD",19286,"KRN",9.8,0)
9.8
"BLD",19286,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",19286,"KRN",9.8,"NM",1,0)
ORWOR^^0^B39244307
"BLD",19286,"KRN",9.8,"NM",2,0)
ORAM^^0^B75504293
"BLD",19286,"KRN",9.8,"NM","B","ORAM",2)

"BLD",19286,"KRN",9.8,"NM","B","ORWOR",1)

"BLD",19286,"KRN",19,0)
19
"BLD",19286,"KRN",19.1,0)
19.1
"BLD",19286,"KRN",101,0)
101
"BLD",19286,"KRN",409.61,0)
409.61
"BLD",19286,"KRN",771,0)
771
"BLD",19286,"KRN",779.2,0)
779.2
"BLD",19286,"KRN",870,0)
870
"BLD",19286,"KRN",8989.51,0)
8989.51
"BLD",19286,"KRN",8989.52,0)
8989.52
"BLD",19286,"KRN",8994,0)
8994
"BLD",19286,"KRN","B",.4,.4)

"BLD",19286,"KRN","B",.401,.401)

"BLD",19286,"KRN","B",.402,.402)

"BLD",19286,"KRN","B",.403,.403)

"BLD",19286,"KRN","B",.5,.5)

"BLD",19286,"KRN","B",.84,.84)

"BLD",19286,"KRN","B",3.6,3.6)

"BLD",19286,"KRN","B",3.8,3.8)

"BLD",19286,"KRN","B",9.2,9.2)

"BLD",19286,"KRN","B",9.8,9.8)

"BLD",19286,"KRN","B",19,19)

"BLD",19286,"KRN","B",19.1,19.1)

"BLD",19286,"KRN","B",101,101)

"BLD",19286,"KRN","B",409.61,409.61)

"BLD",19286,"KRN","B",771,771)

"BLD",19286,"KRN","B",779.2,779.2)

"BLD",19286,"KRN","B",870,870)

"BLD",19286,"KRN","B",8989.51,8989.51)

"BLD",19286,"KRN","B",8989.52,8989.52)

"BLD",19286,"KRN","B",8994,8994)

"BLD",19286,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",19286,"QUES",0)
^9.62^^
"BLD",19286,"REQB",0)
^9.611^1^1
"BLD",19286,"REQB",1,0)
OR*3.0*307^2
"BLD",19286,"REQB","B","OR*3.0*307",1)

"MBREQ")
0
"PKG",22,-1)
1^1
"PKG",22,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",22,20,0)
^9.402P^^
"PKG",22,22,0)
^9.49I^1^1
"PKG",22,22,1,0)
3.0^2971217^2980204^64
"PKG",22,22,1,"PAH",1,0)
330^3100803^11
"PKG",22,22,1,"PAH",1,1,0)
^^2^2^3100803
"PKG",22,22,1,"PAH",1,1,1,0)
The description of this patch may be found in the National Patch Module
"PKG",22,22,1,"PAH",1,1,2,0)
under OR*3*330.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","ORAM")
0^2^B75504293^B73547514
"RTN","ORAM",1,0)
ORAM ;POR/RSF - ANTICOAGULATION MANAGEMENT RPCS (1 of 4) ;08/03/10  09:50
"RTN","ORAM",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**307,330**;Dec 17, 1997;Build 2
"RTN","ORAM",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified
"RTN","ORAM",4,0)
 Q
"RTN","ORAM",5,0)
 ;
"RTN","ORAM",6,0)
PATIENT(RESULT,ORAMDFN) ;Returns current Patient info as:
"RTN","ORAM",7,0)
 ;DFN^NAME^GENDER^ADMISSION^CURRENT DT/TIME (internal)^SSN^CURRENT DT/TIME (external)^CLINIC LOCATION^DTIME
"RTN","ORAM",8,0)
 ;RPC=ORAM PATIENT
"RTN","ORAM",9,0)
 N CURADM,PTNAME,GENDER,ORAMNOW,ORAMRD,ORAMSSN,ORAMPLOC,ORAMVDT
"RTN","ORAM",10,0)
 I '$G(ORAMDFN) D
"RTN","ORAM",11,0)
 . N DIC,X,Y
"RTN","ORAM",12,0)
 . S DIC="^DPT(",DIC(0)="Z",X=" "
"RTN","ORAM",13,0)
 . D ^DIC
"RTN","ORAM",14,0)
 . S ORAMDFN=+$G(Y)
"RTN","ORAM",15,0)
 I ORAMDFN<1 S ORAMDFN=0 G PATIENTQ
"RTN","ORAM",16,0)
 S CURADM=$G(^DPT(ORAMDFN,.105))   ;CHECKS IF PATIENT IS ADMITTED
"RTN","ORAM",17,0)
 S PTNAME=$P(^DPT(ORAMDFN,0),U)
"RTN","ORAM",18,0)
 I $L(PTNAME)>19 D
"RTN","ORAM",19,0)
 . N ORFMT
"RTN","ORAM",20,0)
 . F ORFMT="LAST,FIRST MI","LAST,FI MI" S PTNAME=$$NAME^ORAMX(PTNAME,ORFMT) Q:$L(PTNAME)'>19
"RTN","ORAM",21,0)
 S GENDER=$P(^DPT(ORAMDFN,0),U,2)
"RTN","ORAM",22,0)
 S ORAMSSN=$P(^DPT(ORAMDFN,0),U,9)
"RTN","ORAM",23,0)
 S ORAMNOW=$$NOW^XLFDT S ORAMRD=$$FMTE^XLFDT($E(ORAMNOW,1,12),2)
"RTN","ORAM",24,0)
 S ORAMPLOC=$P($G(^ORAM(103,ORAMDFN,6)),U,2)
"RTN","ORAM",25,0)
 S:+ORAMPLOC>0 ORAMPLOC=ORAMPLOC_";SC("
"RTN","ORAM",26,0)
 S ORAMVDT=$$GETAPPT(ORAMDFN,+ORAMPLOC)
"RTN","ORAM",27,0)
 S:$L($P(ORAMRD,"/",1))=1 $P(ORAMRD,"/",1)="0"_$P(ORAMRD,"/",1)
"RTN","ORAM",28,0)
 S:$L($P(ORAMRD,"/",2))=1 $P(ORAMRD,"/",2)="0"_$P(ORAMRD,"/",2)
"RTN","ORAM",29,0)
 S RESULT=$G(ORAMDFN)_U_$G(PTNAME)_U_$G(GENDER)_U_$G(CURADM)_U_ORAMNOW_U_$G(ORAMSSN)_U_$G(ORAMRD)_U_ORAMPLOC_U_$G(DTIME)_U_ORAMVDT
"RTN","ORAM",30,0)
PATIENTQ Q
"RTN","ORAM",31,0)
 ;
"RTN","ORAM",32,0)
APPTMTCH(RESULT,ORAMDFN,ORAMCL) ; Find appt match on clinic change
"RTN","ORAM",33,0)
 S RESULT=$$GETAPPT(ORAMDFN,+ORAMCL)
"RTN","ORAM",34,0)
 Q
"RTN","ORAM",35,0)
 ;
"RTN","ORAM",36,0)
GETAPPT(ORAMDFN,ORAMCL) ; Find most recent appointment to Clinic from t-1 to t+1 days
"RTN","ORAM",37,0)
 N ORAMC,ORAMEDT,ORAMLDT,ORAMOK,ORAMY,ORAMDIFF,ORAMTCL,ORAMVCL,ORAMLAD,ORAMLBD,ORAMFLTR,ORAMAPPT
"RTN","ORAM",38,0)
 S ORAMOK=0
"RTN","ORAM",39,0)
 S ORAMY=$$NOW^XLFDT
"RTN","ORAM",40,0)
 I +ORAMCL'>0 G GETAPPX
"RTN","ORAM",41,0)
 S ORAMLBD=$$GET^XPAR(ORAMCL_";SC(^ALL","ORAM APPT MATCH LOOK-BACK",1,"I")
"RTN","ORAM",42,0)
 S ORAMDIFF=$S(ORAMLBD]"":-ORAMLBD,1:-1)
"RTN","ORAM",43,0)
 S ORAMEDT=$$FMADD^XLFDT(DT,ORAMDIFF)
"RTN","ORAM",44,0)
 S ORAMLAD=$$GET^XPAR(ORAMCL_";SC(^ALL","ORAM APPT MATCH LOOK-AHEAD",1,"I")
"RTN","ORAM",45,0)
 S ORAMDIFF=$S(ORAMLAD]"":ORAMLAD,1:1)
"RTN","ORAM",46,0)
 S ORAMLDT=$$FMADD^XLFDT(DT,ORAMDIFF)_".2359"
"RTN","ORAM",47,0)
 S ORAMVCL=$$GET^XPAR(ORAMCL_";SC(","ORAM VISIT LOCATION",1,"I")
"RTN","ORAM",48,0)
 S ORAMTCL=$$GET^XPAR(ORAMCL_";SC(","ORAM PHONE CLINIC",1,"I")
"RTN","ORAM",49,0)
 F ORAMC=ORAMVCL,ORAMTCL D
"RTN","ORAM",50,0)
 . N ORAMOK
"RTN","ORAM",51,0)
 . S ORAMFLTR(1)=ORAMEDT_";"_ORAMLDT
"RTN","ORAM",52,0)
 . S ORAMFLTR(2)=ORAMC
"RTN","ORAM",53,0)
 . S ORAMFLTR(3)="R;I;NT"
"RTN","ORAM",54,0)
 . S ORAMFLTR(4)=ORAMDFN
"RTN","ORAM",55,0)
 . S ORAMFLTR("MAX")=-3
"RTN","ORAM",56,0)
 . S ORAMFLTR("FLDS")="1;2;4"
"RTN","ORAM",57,0)
 . S ORAMOK=$$SDAPI^SDAMA301(.ORAMFLTR)
"RTN","ORAM",58,0)
 . I +ORAMOK>0 M ORAMAPPT=^TMP($J,"SDAMA301")
"RTN","ORAM",59,0)
 I +$D(ORAMAPPT)>9 S ORAMY=$$NEAREST($NA(ORAMAPPT(ORAMDFN)))
"RTN","ORAM",60,0)
 K ^TMP($J,"SDAMA301")
"RTN","ORAM",61,0)
GETAPPX Q ORAMY
"RTN","ORAM",62,0)
 ;
"RTN","ORAM",63,0)
NEAREST(APPTS) ; Find the nearest appointment to NOW
"RTN","ORAM",64,0)
 N ORC,ORI,ORY,ORNOW,ORDIFFS S (ORC,ORY)=0,ORNOW=$$NOW^XLFDT
"RTN","ORAM",65,0)
 F  S ORC=$O(@APPTS@(ORC)) Q:+ORC'>0  D
"RTN","ORAM",66,0)
 . N ORDT S ORDT=0
"RTN","ORAM",67,0)
 . F  S ORDT=$O(@APPTS@(ORC,ORDT)) Q:+ORDT'>0  S ORDIFFS($$ABS^XLFMTH($$FMDIFF^XLFDT(ORNOW,ORDT,2)))=ORDT
"RTN","ORAM",68,0)
 S ORI=$O(ORDIFFS(0))
"RTN","ORAM",69,0)
 S:+ORI>0 ORY=ORDIFFS(ORI)
"RTN","ORAM",70,0)
 Q ORY
"RTN","ORAM",71,0)
 ;
"RTN","ORAM",72,0)
PROVIDER(RESULT) ;GETS DUZ/NAME OF PROVIDER WHO IS SIGNED IN
"RTN","ORAM",73,0)
 ;;RPC=ORAM PROVIDER
"RTN","ORAM",74,0)
 N PN,INIT
"RTN","ORAM",75,0)
 S DUZ=$G(DUZ)
"RTN","ORAM",76,0)
 S PN=$P(^VA(200,DUZ,0),U)
"RTN","ORAM",77,0)
 S INIT=$P(^VA(200,DUZ,0),U,2)
"RTN","ORAM",78,0)
 S RESULT=$G(DUZ)_U_PN_U_$G(INIT)
"RTN","ORAM",79,0)
 Q
"RTN","ORAM",80,0)
 ;
"RTN","ORAM",81,0)
INRCHK(ORAMQO) ; Resolve Lab Test id from Quick Order
"RTN","ORAM",82,0)
 N TST,N,ORAM60,ORAMT2,ORAMTT,ORAMPP,ORAMTST,ORAMTSTN,ORAMNEW,ORAML,ORAMT60,ORAMORD,ORY
"RTN","ORAM",83,0)
 S ORAMORD=$$QOORD(ORAMQO),ORY=""
"RTN","ORAM",84,0)
 I +$G(ORAMQO) D
"RTN","ORAM",85,0)
 . N ORAMC
"RTN","ORAM",86,0)
 . S ORAM60=+$P(^ORD(101.43,ORAMORD,0),U,2) Q:'+$G(ORAM60)
"RTN","ORAM",87,0)
 . S ORAMT60=$P($P($G(^LAB(60,ORAM60,0)),U,5),";",2) I +$G(ORAMT60) S ORY=ORAMT60 Q
"RTN","ORAM",88,0)
 . I '$G(ORAMT60),$D(^LAB(60,ORAM60,2,0)) S ORAMC=0 F  S ORAMC=$O(^LAB(60,ORAM60,2,ORAMC)) Q:'+$G(ORAMC)!(+$G(ORY))  D
"RTN","ORAM",89,0)
 .. S ORAMNEW=^LAB(60,ORAM60,2,ORAMC,0) I +ORAMNEW>0,$$ISINR(ORAMNEW) S ORY=$P($P($G(^LAB(60,ORAMNEW,0)),U,5),";",2) Q
"RTN","ORAM",90,0)
 Q ORY
"RTN","ORAM",91,0)
 ;
"RTN","ORAM",92,0)
ISINR(ORTEST) ; Is the lab test an INR?
"RTN","ORAM",93,0)
 N ORY,ORNM S ORY=0
"RTN","ORAM",94,0)
 S ORNM=$P($G(^LAB(60,ORTEST,0)),U)
"RTN","ORAM",95,0)
 S ORY=$S(ORNM["INR":1,(ORNM["INT")&(ORNM["NORM")&(ORNM["RAT"):1,1:0)
"RTN","ORAM",96,0)
 Q ORY
"RTN","ORAM",97,0)
 ;
"RTN","ORAM",98,0)
LABCHK(RESULT) ;
"RTN","ORAM",99,0)
 ;;RPC=ORAM ORDERABLES
"RTN","ORAM",100,0)
 N ORAMINR,ORAMCBC,C,Y S (C,Y)=0,RESULT="0|0"
"RTN","ORAM",101,0)
 S ORAMINR=0 F  S ORAMINR=$O(^ORD(101.43,"B","INR",ORAMINR)) Q:'+$G(ORAMINR)!(+$G(C))  I +$G(ORAMINR) S $P(RESULT,"|")=ORAMINR,C=1
"RTN","ORAM",102,0)
 I $G(ORAMINR)="" S ORAMINR=0 F  S ORAMINR=$O(^ORD(101.43,"B","INR ",ORAMINR)) Q:'+$G(ORAMINR)!(+$G(C))  I +$G(ORAMINR) S $P(RESULT,"|")=ORAMINR,C=1
"RTN","ORAM",103,0)
 I $G(ORAMINR)="" S ORAMINR=0 F  S ORAMINR=$O(^ORD(101.43,"B","INR/PT",ORAMINR)) Q:'+$G(ORAMINR)!(+$G(C))  I +$G(ORAMINR) S $P(RESULT,"|")=ORAMINR,C=1
"RTN","ORAM",104,0)
 I $G(ORAMINR)="" S ORAMINR=0 F  S ORAMINR=$O(^ORD(101.43,"B","PT",ORAMINR)) Q:'+$G(ORAMINR)!(+$G(C))  I +$G(ORAMINR) S $P(RESULT,"|")=ORAMINR,C=1
"RTN","ORAM",105,0)
 S ORAMCBC=0 F  S ORAMCBC=$O(^ORD(101.43,"B","CBC",ORAMCBC)) Q:'+$G(ORAMCBC)!(+$G(Y))  I +$G(ORAMCBC) S $P(RESULT,"|",2)=ORAMCBC,Y=1
"RTN","ORAM",106,0)
 I $G(ORAMCBC)="" S ORAMCBC=$O(^ORD(101.43,"B","CBC ",ORAMCBC)) Q:'+$G(ORAMCBC)!(+$G(Y))  I +$G(ORAMCBC) S $P(RESULT,"|",2)=ORAMCBC,Y=1
"RTN","ORAM",107,0)
 Q
"RTN","ORAM",108,0)
 ;
"RTN","ORAM",109,0)
SIGCHECK(RESULT,ESCODE) ;
"RTN","ORAM",110,0)
 ;;CHECKS SIG CODE
"RTN","ORAM",111,0)
 ;;RPC=ORAM SIGCHECK
"RTN","ORAM",112,0)
 N SUCCESS,X
"RTN","ORAM",113,0)
 S SUCCESS=0
"RTN","ORAM",114,0)
 Q:ESCODE=""
"RTN","ORAM",115,0)
 S X=ESCODE D HASH^XUSHSHP
"RTN","ORAM",116,0)
 I $P($G(^VA(200,DUZ,20)),U,4)=X S SUCCESS=1 ;SIG CODE CORRECT
"RTN","ORAM",117,0)
 S RESULT=$G(SUCCESS)
"RTN","ORAM",118,0)
SIGQ Q
"RTN","ORAM",119,0)
 ;
"RTN","ORAM",120,0)
HCT(RESULT,ORAMDFN) ;GET HCT
"RTN","ORAM",121,0)
 ;;GETS MOST RECENT HCT
"RTN","ORAM",122,0)
 ;;RPC=ORAM HCT
"RTN","ORAM",123,0)
 N HCT,LDATE,HCTDATE,LOOPCNT,HCTDIFF,LRDFN,ORAMS,ORAMHCT,ORAMDNM,OHCT,OHCTD,ORAMFM,ORAMHCTN
"RTN","ORAM",124,0)
 I '$G(ORAMDFN) S RESULT="" Q  ;IF DFN IS NOT PASSED, EXIT
"RTN","ORAM",125,0)
 S LRDFN=$$LAB($G(ORAMDFN)) Q:'+LRDFN
"RTN","ORAM",126,0)
 S ORAMHCT=$$GET^XPAR("ALL","ORAM HCT/HGB REFERENCE",1,"B")
"RTN","ORAM",127,0)
 I +$G(ORAMHCT)'>0 S RESULT="HCT Param not set." Q
"RTN","ORAM",128,0)
 S ORAMHCTN=$P(ORAMHCT,U,2),ORAMHCT=$P(ORAMHCT,U)
"RTN","ORAM",129,0)
 ; Get Lab Data Name based on IEN in ^LAB(60,
"RTN","ORAM",130,0)
 S ORAMDNM=$P($P(^LAB(60,+ORAMHCT,0),U,5),";",2) Q:ORAMDNM']""
"RTN","ORAM",131,0)
 S LDATE=0 F  SET LDATE=$O(^LR(LRDFN,"CH",LDATE)) S LOOPCNT=0 Q:LDATE=""!(+$G(HCT))  D  Q:LOOPCNT
"RTN","ORAM",132,0)
 . S RESULT=$G(^LR(LRDFN,"CH",LDATE,ORAMDNM))
"RTN","ORAM",133,0)
 . Q:RESULT=""
"RTN","ORAM",134,0)
 . Q:$P(RESULT,U,1)=""  ;QUIT IF NO HCT DATA
"RTN","ORAM",135,0)
 . S HCT=$P(RESULT,U,1)  ;HCT
"RTN","ORAM",136,0)
 . S HCTDATE=9999999-LDATE
"RTN","ORAM",137,0)
 . S LOOPCNT=1
"RTN","ORAM",138,0)
 . Q:+HCT
"RTN","ORAM",139,0)
 I LDATE="" S RESULT="NONE"
"RTN","ORAM",140,0)
 I $D(^ORAM(103,ORAMDFN,6)),($L($P(^ORAM(103,ORAMDFN,6),U,4),"|")=3) D
"RTN","ORAM",141,0)
 . S OHCT=$P($P(^ORAM(103,ORAMDFN,6),U,4),"|"),OHCTD=$P($P(^ORAM(103,ORAMDFN,6),U,4),"|",2)
"RTN","ORAM",142,0)
 . I +$G(OHCT) D DT^DILF(,OHCTD,.ORAMFM)
"RTN","ORAM",143,0)
 I +$G(HCTDATE),$G(ORAMFM)>HCTDATE S HCT=OHCT_" (Outside Lab)",HCTDATE=ORAMFM,ORAMHCTN="HCT"
"RTN","ORAM",144,0)
 I '+$G(HCTDATE) S:+$G(OHCT) HCT=OHCT_" (Outside Lab)",ORAMHCTN="HCT" S:$G(ORAMFM)'="" HCTDATE=ORAMFM
"RTN","ORAM",145,0)
 I +$G(HCTDATE) S HCTDATE=$$FMTE^XLFDT($E(HCTDATE,1,7),2)
"RTN","ORAM",146,0)
 S RESULT=$G(HCT)_U_$G(HCTDATE)_U_ORAMHCTN
"RTN","ORAM",147,0)
 Q
"RTN","ORAM",148,0)
 ;
"RTN","ORAM",149,0)
INR(RESULT,ORAMDFN) ; Gets most recent INR
"RTN","ORAM",150,0)
 ;;RPC=ORAM INR
"RTN","ORAM",151,0)
 N LDATE,INR,INRFD,LRDFN,HDATE,TDIFF,SIXMON,COUNT,SCORE,ORAMITST,INRHD,INRRD
"RTN","ORAM",152,0)
 N ORAMQO
"RTN","ORAM",153,0)
 S RESULT=""
"RTN","ORAM",154,0)
 I '$G(ORAMDFN) Q  ;IF DFN IS NOT PASSED, EXIT
"RTN","ORAM",155,0)
 S LRDFN=$$LAB($G(ORAMDFN)) Q:'+$G(LRDFN)
"RTN","ORAM",156,0)
 S ORAMQO=$$GET^XPAR("ALL","ORAM INR QUICK ORDER",1,"I") S ORAMITST=$$INRCHK(ORAMQO)
"RTN","ORAM",157,0)
 I +ORAMITST'>0 Q
"RTN","ORAM",158,0)
 S (LDATE,COUNT)=0,SIXMON=$$FMADD^XLFDT(DT,-180)
"RTN","ORAM",159,0)
 F  S LDATE=$O(^LR(LRDFN,"CH",LDATE)) Q:+LDATE'>0!(LDATE>(9999999-SIXMON))  D
"RTN","ORAM",160,0)
 . N SCORE,INR,INRFD,INRHD,INRRD,XDT
"RTN","ORAM",161,0)
 . S SCORE=$G(^LR(LRDFN,"CH",LDATE,ORAMITST))
"RTN","ORAM",162,0)
 . Q:SCORE=""  ;QUIT IF NO INR TEST
"RTN","ORAM",163,0)
 . S INR=$P(SCORE,U)  ;INR
"RTN","ORAM",164,0)
 . Q:INR=""  ;QUIT IF NO INR DATA
"RTN","ORAM",165,0)
 . S INRFD=9999999-LDATE
"RTN","ORAM",166,0)
 . S XDT=$P(INRFD,".") S INRHD=$$FMTH^XLFDT(XDT,1),INRRD=$$FMTE^XLFDT(XDT,"2P")
"RTN","ORAM",167,0)
 . S RESULT(COUNT)=$G(INR)_"^^"_$G(INRRD)_U_$G(INRHD)
"RTN","ORAM",168,0)
 . Q:INRFD<SIXMON  ;Q WHEN SEARCHED LAST 6 MONTHS
"RTN","ORAM",169,0)
 . S COUNT=COUNT+1
"RTN","ORAM",170,0)
 Q
"RTN","ORAM",171,0)
 ;
"RTN","ORAM",172,0)
CONCOMP(RESULT,ORAMCNUM,ORAMNNUM,ORAMDUZ) ;
"RTN","ORAM",173,0)
 ;;BRINGS IN CONSULT NUMBER(ORAMCNUM)
"RTN","ORAM",174,0)
 ;;BRINGS IN NOTE NUMBER(ORAMNNUM), COMPLETES CONSULT
"RTN","ORAM",175,0)
 ;;RPC=ORAM CONCOMP
"RTN","ORAM",176,0)
 N ORAMCST
"RTN","ORAM",177,0)
 S RESULT=0
"RTN","ORAM",178,0)
 S ORAMCST=$S($$STATUS^TIULC(ORAMNNUM)="completed":"COMPLETE",1:"INCOMPLETE")
"RTN","ORAM",179,0)
 D GET^GMRCTIU(ORAMCNUM,ORAMNNUM,ORAMCST,ORAMDUZ)
"RTN","ORAM",180,0)
 S RESULT=1
"RTN","ORAM",181,0)
 Q
"RTN","ORAM",182,0)
 ;
"RTN","ORAM",183,0)
LAB(DFN) ;GET LAB NUMBER
"RTN","ORAM",184,0)
 N LRDFN
"RTN","ORAM",185,0)
 IF 'DFN S LRDFN="" G LABQ ;IF DFN IS NOT PASSED, EXIT
"RTN","ORAM",186,0)
 S LRDFN=$G(^DPT(DFN,"LR"))
"RTN","ORAM",187,0)
LABQ Q LRDFN
"RTN","ORAM",188,0)
 ;
"RTN","ORAM",189,0)
ORDER(ORESULT,DFN,ORNP,ORLOC,ORQO,ORCDT) ; Place Quick Order for INR or CBC
"RTN","ORAM",190,0)
 ; RPC ORAM ORDER
"RTN","ORAM",191,0)
 ;  in: DFN   - pt id file 2
"RTN","ORAM",192,0)
 ;      ORNP  - ordering provider id file 200
"RTN","ORAM",193,0)
 ;      ORLOC - location id file 42
"RTN","ORAM",194,0)
 ;      ORQO  - quick order id file 101.41
"RTN","ORAM",195,0)
 ;      ORCDT - collection date/time
"RTN","ORAM",196,0)
 N ORANS,ORDIALOG,ORDG,ORDLG
"RTN","ORAM",197,0)
 I +$G(DFN)'>0 S ORESULT="0^invalid Patient id" Q
"RTN","ORAM",198,0)
 I +$G(ORNP)'>0 S ORESULT="0^invalid Provider id" Q
"RTN","ORAM",199,0)
 I +$G(ORLOC)'>0 S ORESULT="0^invalid Location id" Q
"RTN","ORAM",200,0)
 I +$G(ORQO)'>0 S ORESULT="0^invalid Quick Order id" Q
"RTN","ORAM",201,0)
 I $G(ORCDT)']"" S ORESULT="0^invalid Collection Date/Time" Q
"RTN","ORAM",202,0)
 D GETQDLG^ORCD(ORQO)
"RTN","ORAM",203,0)
 I '$D(ORDIALOG) S ORESULT="0^invalid Quick Order id" Q
"RTN","ORAM",204,0)
 S ORDLG=$$GET1^DIQ(101.41,+ORDIALOG_",",.01)
"RTN","ORAM",205,0)
 I ORDLG']"" S ORESULT="0^invalid Quick Order id" Q
"RTN","ORAM",206,0)
 S ORDG=$$GET1^DIQ(101.41,ORQO_",",5,"I")
"RTN","ORAM",207,0)
 I +ORDG'>0 S ORESULT="0^invalid Quick Order id - no Display Group" Q
"RTN","ORAM",208,0)
 S ORDIALOG(6,1)=$$IDATE(ORCDT)
"RTN","ORAM",209,0)
 D SAVE^ORWDX(.ORESULT,DFN,ORNP,ORLOC,ORDLG,ORDG,ORQO,"",.ORDIALOG) ; Place the order
"RTN","ORAM",210,0)
 ; if the order is placed, call UNOTIF^ORCSIGN to avoid duplicate alerts,
"RTN","ORAM",211,0)
 ; then call NOTIF^ORCSIGN to generate an unsigned order notification
"RTN","ORAM",212,0)
 I +ORESULT D
"RTN","ORAM",213,0)
 . N ORVP,ORIFN,Y
"RTN","ORAM",214,0)
 . S ORVP=DFN_";DPT(",ORIFN=$P($P($G(ORESULT(1)),"~",2),";")
"RTN","ORAM",215,0)
 . D UNOTIF^ORCSIGN
"RTN","ORAM",216,0)
 . D NOTIF^ORCSIGN
"RTN","ORAM",217,0)
 Q
"RTN","ORAM",218,0)
IDATE(ORX) ; Convert External Date/time to FM Internal format
"RTN","ORAM",219,0)
 N ORY S ORY=""
"RTN","ORAM",220,0)
 D DT^DILF("T",ORX,.ORY) S:+ORY'>0 ORY=""
"RTN","ORAM",221,0)
 Q ORY
"RTN","ORAM",222,0)
QOORD(ORQO) ; Given Quick Order, find the IEN of the Orderable Item
"RTN","ORAM",223,0)
 N ORI,ORDIALOG,ORY S ORY=0
"RTN","ORAM",224,0)
 D GETQDLG^ORCD(+$G(ORQO))
"RTN","ORAM",225,0)
 I '$D(ORDIALOG) G QOORDX
"RTN","ORAM",226,0)
 S ORI=0
"RTN","ORAM",227,0)
 F  S ORI=$O(ORDIALOG(ORI)) Q:ORI'>0!+ORY>0  D
"RTN","ORAM",228,0)
 . I $G(ORDIALOG(ORI))["ORDERABLE" S ORY=$G(ORDIALOG(ORI,1))
"RTN","ORAM",229,0)
QOORDX Q ORY
"RTN","ORWOR")
0^1^B39244307^B36027702
"RTN","ORWOR",1,0)
ORWOR ; SLC/KCM - Orders Calls ;04/19/10  17:32
"RTN","ORWOR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,132,141,163,187,190,215,243,307,330**;Dec 17, 1997;Build 2
"RTN","ORWOR",3,0)
 ;
"RTN","ORWOR",4,0)
CURRENT(LST,DFN) ; Get Current Orders for a Patient
"RTN","ORWOR",5,0)
 ; Returns two lists in ^TMP("ORW",$J), fields and text
"RTN","ORWOR",6,0)
 N TM,IEN,X,X0,X3,CTR,IDX,I
"RTN","ORWOR",7,0)
 K ^TMP("ORW",$J)
"RTN","ORWOR",8,0)
 S IDX=0,DFN=DFN_";DPT("
"RTN","ORWOR",9,0)
 S TM=0 F  S TM=$O(^OR(100,"AC",DFN,TM)) Q:TM<1  D
"RTN","ORWOR",10,0)
 . S IEN=0 F  S IEN=$O(^OR(100,"AC",DFN,TM,IEN)) Q:IEN<1  D
"RTN","ORWOR",11,0)
 . . S X0=^OR(100,IEN,0),X3=^(3)
"RTN","ORWOR",12,0)
 . . S X=IEN_U_$P(X0,U,7)_U_$P(X0,U,11)_U_$P(X3,U,6)_U_$P(X3,U,3)
"RTN","ORWOR",13,0)
 . . S ^TMP("ORW",$J,IDX+1)=X
"RTN","ORWOR",14,0)
 . . S (CTR,I)=0,X=""
"RTN","ORWOR",15,0)
 . . F  S I=$O(^OR(100,IEN,1,I)) Q:I<1  D  Q:CTR>244
"RTN","ORWOR",16,0)
 . . . S X=X_$E(^OR(100,IEN,1,I,0),1,(245-CTR)),CTR=$L(X)
"RTN","ORWOR",17,0)
 . . S ^TMP("ORW",$J,IDX+2)=X,IDX=IDX+2
"RTN","ORWOR",18,0)
 ; S LST=$NA(^TMP("ORW",$J))
"RTN","ORWOR",19,0)
 M LST=^TMP("ORW",$J)
"RTN","ORWOR",20,0)
 Q
"RTN","ORWOR",21,0)
DETAIL(LST,ORID,DFN)    ; Return details of ORID (shell to kill VIDEO subs)
"RTN","ORWOR",22,0)
 Q:'+ORID
"RTN","ORWOR",23,0)
 I $G(DFN) N ORVP S ORVP=DFN_";DPT("
"RTN","ORWOR",24,0)
 S LST="^TMP(""ORTXT"",$J)"
"RTN","ORWOR",25,0)
 D DETAIL^ORQ2(.LST,ORID)
"RTN","ORWOR",26,0)
 K @LST@("VIDEO")
"RTN","ORWOR",27,0)
 S LST=$NA(^TMP("ORTXT",$J)),@LST=""
"RTN","ORWOR",28,0)
 Q
"RTN","ORWOR",29,0)
RESULT(REF,DFN,ORID,ID)      ; Return results of order identified by ID
"RTN","ORWOR",30,0)
 K ^TMP("ORXPND",$J)
"RTN","ORWOR",31,0)
 N ORESULTS,ORVP,LCNT S ORESULTS=1,LCNT=0,ORVP=DFN_";DPT("
"RTN","ORWOR",32,0)
 D ORDERS^ORCXPND1
"RTN","ORWOR",33,0)
 K ^TMP("ORXPND",$J,"VIDEO")
"RTN","ORWOR",34,0)
 S REF=$NA(^TMP("ORXPND",$J))
"RTN","ORWOR",35,0)
 Q
"RTN","ORWOR",36,0)
RESHIST(REF,DFN,ORID,ID)      ; Return result history of associated tests identified by ID
"RTN","ORWOR",37,0)
 K ^TMP("ORXPND",$J)
"RTN","ORWOR",38,0)
 N ORESULTS,ORVP,LCNT
"RTN","ORWOR",39,0)
 S ORESULTS=1,LCNT=0,ORVP=DFN_";DPT("
"RTN","ORWOR",40,0)
 D ORDHIST^ORWOR2
"RTN","ORWOR",41,0)
 K ^TMP("ORXPND",$J,"VIDEO")
"RTN","ORWOR",42,0)
 S REF=$NA(^TMP("ORXPND",$J))
"RTN","ORWOR",43,0)
 Q
"RTN","ORWOR",44,0)
TSALL(LST)      ; Return list of treating specialties
"RTN","ORWOR",45,0)
 N Y S Y=0
"RTN","ORWOR",46,0)
 F  S Y=$O(^DIC(45.7,Y)) Q:'Y  I $$ACTIVE^DGACT(45.7,Y) S LST(Y)=Y_U_$P(^DIC(45.7,Y,0),U)
"RTN","ORWOR",47,0)
 Q
"RTN","ORWOR",48,0)
DT(X) ; -- Returns FM date for X (SEE ORCHTAB1)
"RTN","ORWOR",49,0)
 N Y,%DT S %DT="T",Y="" D:X'="" ^%DT
"RTN","ORWOR",50,0)
 Q +Y
"RTN","ORWOR",51,0)
VWSET(ORERR,VIEW)       ; Set the preferred view for orders
"RTN","ORWOR",52,0)
 ; VIEW:  semi-colon delimited record
"RTN","ORWOR",53,0)
 ;        1 - Relative From Date/Time or ""
"RTN","ORWOR",54,0)
 ;        2 - Relative Thru Date/Time or ""
"RTN","ORWOR",55,0)
 ;        3 - Filter
"RTN","ORWOR",56,0)
 ;        4 - Display Group Pointer
"RTN","ORWOR",57,0)
 ;        5 - Format (preserve for list manager)
"RTN","ORWOR",58,0)
 ;        6 - chronological display (R or F)
"RTN","ORWOR",59,0)
 ;        7 - sort by display group
"RTN","ORWOR",60,0)
 N FMT
"RTN","ORWOR",61,0)
 ; use short name for display group instead of pointer
"RTN","ORWOR",62,0)
 I $E($P(VIEW,";",2))="T" S $P(VIEW,";",2)=$P($P(VIEW,";",2),"@") ;allows all orders for Today
"RTN","ORWOR",63,0)
 S $P(VIEW,";",4)=$P($G(^ORD(100.98,+$P(VIEW,";",4),0)),U,3)
"RTN","ORWOR",64,0)
 ; use last saved format, since this is used only by LM
"RTN","ORWOR",65,0)
 S FMT=$P($$GET^XPAR("ALL","ORCH CONTEXT ORDERS",1,"I"),";",5)
"RTN","ORWOR",66,0)
 S:'$L(FMT) FMT="L" S $P(VIEW,";",5)=FMT
"RTN","ORWOR",67,0)
 ; and save the parameter
"RTN","ORWOR",68,0)
 D EN^XPAR(DUZ_";VA(200,","ORCH CONTEXT ORDERS",1,VIEW,.ORERR)
"RTN","ORWOR",69,0)
 Q
"RTN","ORWOR",70,0)
VWGET(REC)      ; Get the preferred view for orders
"RTN","ORWOR",71,0)
 N FROM,THRU,FILTER,DGRP,FRMT,CHRN,BYGRP,S,VNAME,FL
"RTN","ORWOR",72,0)
 S REC=$$GET^XPAR("ALL","ORCH CONTEXT ORDERS",1,"I"),S=";"
"RTN","ORWOR",73,0)
 S FROM=$$DT($P(REC,S)),THRU=$$DT($P(REC,S,2)),FILTER=$P(REC,S,3)
"RTN","ORWOR",74,0)
 S DGRP=$P(REC,S,4),FRMT=$P(REC,S,5),CHRN=$P(REC,S,6),BYGRP=$P(REC,S,7)
"RTN","ORWOR",75,0)
 S:'$L(DGRP) DGRP="ALL" S DGRP=+$O(^ORD(100.98,"B",DGRP,0))
"RTN","ORWOR",76,0)
 I FILTER="" S FILTER=2  ; active orders
"RTN","ORWOR",77,0)
 I CHRN="" S CHRN="R"    ; reverse chronological
"RTN","ORWOR",78,0)
 I BYGRP="" S BYGRP=1    ; sort by display group
"RTN","ORWOR",79,0)
 ; set up view name
"RTN","ORWOR",80,0)
 D REVSTS^ORWORDG(.FL)
"RTN","ORWOR",81,0)
 S I=0 F  S I=$O(FL(I)) Q:'I  Q:+FL(I)=FILTER
"RTN","ORWOR",82,0)
 S VNAME=$P($G(FL(+I)),U,2)
"RTN","ORWOR",83,0)
 I '("^6^8^9^10^19^20^"[(U_FILTER_U)) S VNAME=VNAME_" Orders"
"RTN","ORWOR",84,0)
 I FILTER=2 S VNAME="Active Orders (includes Pending & Recent Activity)"
"RTN","ORWOR",85,0)
 I FILTER=23 S VNAME="Current Orders (Active & Pending Status Only)"
"RTN","ORWOR",86,0)
 S VNAME=VNAME_" - "_$P($G(^ORD(100.98,DGRP,0)),U)
"RTN","ORWOR",87,0)
 I (FROM>0)!(THRU>0) D
"RTN","ORWOR",88,0)
 . S VNAME=VNAME_" ("_$$FMTE^XLFDT(FROM,"2D")_" thru "
"RTN","ORWOR",89,0)
 . S VNAME=VNAME_$S(THRU>0:$$FMTE^XLFDT(THRU,"2D"),1:"")_")"
"RTN","ORWOR",90,0)
 S REC=FROM_S_THRU_S_FILTER_S_DGRP_S_FRMT_S_CHRN_S_BYGRP_S_VNAME
"RTN","ORWOR",91,0)
 Q
"RTN","ORWOR",92,0)
SHEETS(LST,ORVP) ; Return Order Sheets for a patient
"RTN","ORWOR",93,0)
 N ELST,ETYP,ORIFN,TS,I
"RTN","ORWOR",94,0)
 S ORVP=ORVP_";DPT("
"RTN","ORWOR",95,0)
 S ETYP="" F  S ETYP=$O(^OR(100,"AEVNT",ORVP,ETYP)) Q:ETYP=""  D
"RTN","ORWOR",96,0)
 . S ORIFN=0 F  S ORIFN=$O(^OR(100,"AEVNT",ORVP,ETYP,ORIFN)) Q:'ORIFN  D
"RTN","ORWOR",97,0)
 . . I (ETYP="A")!(ETYP="T") S ELST(ETYP,$P($G(^OR(100,+ORIFN,0)),U,13))=""
"RTN","ORWOR",98,0)
 S LST(1)="C;O^Current View",I=1
"RTN","ORWOR",99,0)
 S TS="" F  S TS=$O(ELST("A",TS)) Q:TS=""  D
"RTN","ORWOR",100,0)
 . S I=I+1,LST(I)="A;"_TS_U_"Admit to "_$P($G(^DIC(45.7,TS,0)),U)
"RTN","ORWOR",101,0)
 S I=I+1,LST(I)="A;-1^Admit..."
"RTN","ORWOR",102,0)
 S TS="" F  S TS=$O(ELST("T",TS)) Q:TS=""  D
"RTN","ORWOR",103,0)
 . S I=I+1,LST(I)="T;"_TS_U_"Transfer to "_$P($G(^DIC(45.7,TS,0)),U)
"RTN","ORWOR",104,0)
 I $L($G(^DPT(+ORVP,.1))) D
"RTN","ORWOR",105,0)
 . S I=I+1,LST(I)="T;-1^Transfer..."
"RTN","ORWOR",106,0)
 . S I=I+1,LST(I)="D;0^Discharge"
"RTN","ORWOR",107,0)
 Q
"RTN","ORWOR",108,0)
EVENTS(LST,EVT) ; Return general delayed events categories for a patient
"RTN","ORWOR",109,0)
 N EVTI
"RTN","ORWOR",110,0)
 S EVTI=0
"RTN","ORWOR",111,0)
 S EVTI=EVTI+1,LST(EVTI)="A;-1^Admit..."
"RTN","ORWOR",112,0)
 S EVTI=EVTI+1,LST(EVTI)="T;-1^Transfer..."
"RTN","ORWOR",113,0)
 S EVTI=EVTI+1,LST(EVTI)="D;0^Discharge"
"RTN","ORWOR",114,0)
 Q
"RTN","ORWOR",115,0)
UNSIGN(LST,ORVP,HAVE)   ; Return Unsigned Orders that are not on client
"RTN","ORWOR",116,0)
 N IFN,ACT,X8,ENT,LVL,TM,ILST,ORELSE S ILST=0
"RTN","ORWOR",117,0)
 Q:'$D(^XUSEC("ORES",DUZ))&('$D(^XUSEC("ORELSE",DUZ))&'$D(^ORAM(103,+ORVP)))
"RTN","ORWOR",118,0)
 S ORVP=ORVP_";DPT("
"RTN","ORWOR",119,0)
 S ENT="ALL"_$S($G(^VA(200,DUZ,5)):"^SRV.`"_+^(5),1:"")
"RTN","ORWOR",120,0)
 S LVL=$$GET^XPAR(ENT,"OR UNSIGNED ORDERS ON EXIT")
"RTN","ORWOR",121,0)
 ; Nurses only see their own unsigned orders, independent of OR UNSIGNED ORDERS ON EXIT
"RTN","ORWOR",122,0)
 S ORELSE=$D(^XUSEC("ORELSE",DUZ))
"RTN","ORWOR",123,0)
 I ORELSE S LVL=1
"RTN","ORWOR",124,0)
 Q:'LVL
"RTN","ORWOR",125,0)
 S TM=0 F  S TM=$O(^OR(100,"AS",ORVP,TM)) Q:TM<1  D
"RTN","ORWOR",126,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AS",ORVP,TM,IFN)) Q:IFN<1  D
"RTN","ORWOR",127,0)
 . . S ACT=0 F  S ACT=$O(^OR(100,"AS",ORVP,TM,IFN,ACT)) Q:ACT<1  D
"RTN","ORWOR",128,0)
 . . . Q:$D(HAVE(IFN_";"_ACT))                        ;in Changes
"RTN","ORWOR",129,0)
 . . . S X8=$G(^OR(100,IFN,8,ACT,0))
"RTN","ORWOR",130,0)
 . . . I '$S(LVL=1&($P(X8,U,3)=DUZ):1,ORELSE&($P(X8,U,13)=DUZ):1,LVL=2:1,1:0) Q  ;chk user
"RTN","ORWOR",131,0)
 . . . ;if Nurse, and order is already released or held for signature, don't include in list
"RTN","ORWOR",132,0)
 . . . I ORELSE,$S((+$P(X8,U,16)>0):1,$D(^OR(100,IFN,5)):1,1:0) Q
"RTN","ORWOR",133,0)
 . . . S ILST=ILST+1,LST(ILST)=IFN_";"_ACT_U_$P(X8,U,3)
"RTN","ORWOR",134,0)
 Q
"RTN","ORWOR",135,0)
PKIUSE(RETURN) ; RPC determines user can use PKI Digital Signature
"RTN","ORWOR",136,0)
 S RETURN=0
"RTN","ORWOR",137,0)
 I $$GET^XPAR("ALL^USR.`"_DUZ,"ORWOR PKI USE",1,"Q") S RETURN=1
"RTN","ORWOR",138,0)
 Q
"RTN","ORWOR",139,0)
PKISITE(RETURN) ; RPC determines if PKI is turned on at the site
"RTN","ORWOR",140,0)
 S RETURN=0
"RTN","ORWOR",141,0)
 Q:'$L($T(STORESIG^XUSSPKI))  ;Check for Kernel piece
"RTN","ORWOR",142,0)
 Q:'$L($T(DOSE^PSSOPKI1))  ;Check for Pharmacy piece
"RTN","ORWOR",143,0)
 I $$GET^XPAR("ALL","ORWOR PKI SITE",1,"Q") S RETURN=1
"RTN","ORWOR",144,0)
 Q
"RTN","ORWOR",145,0)
ACTXT(ORY,ORIFN) ;Return detail action information
"RTN","ORWOR",146,0)
 N ORI,CNT,OR0,OR3,OR6
"RTN","ORWOR",147,0)
 K ^TMP("ORACTXT",$J)
"RTN","ORWOR",148,0)
 S ORY="^TMP(""ORACTXT"",$J)",ORI=$P(ORIFN,";",2)
"RTN","ORWOR",149,0)
 S CNT=0,ORIFN=+ORIFN,OR0=$G(^OR(100,ORIFN,0)),OR3=$G(^(3)),OR6=$G(^(6))
"RTN","ORWOR",150,0)
 F  S ORI=$O(^OR(100,+ORIFN,8,ORI)) Q:ORI'>0  S ACTION=$G(^(ORI,0)) D ACT^ORQ20
"RTN","ORWOR",151,0)
 S ORY=$NA(^TMP("ORACTXT",$J)),@ORY=""
"RTN","ORWOR",152,0)
 Q
"RTN","ORWOR",153,0)
EXPIRED(ORY) ;return FM date/time to begin search for expired orders
"RTN","ORWOR",154,0)
 N HRS
"RTN","ORWOR",155,0)
 S HRS=$$GET^XPAR("ALL","ORWOR EXPIRED ORDERS",1,"I")
"RTN","ORWOR",156,0)
 S ORY=$$FMADD^XLFDT($$NOW^XLFDT,"","-"_HRS,"","")
"RTN","ORWOR",157,0)
 Q
"VER")
8.0^22.0
"BLD",19286,6)
^282
**END**
**END**
