Released FB*3.5*107 SEQ #99
Extracted from mail message
**KIDS**:FB*3.5*107^

**INSTALL NAME**
FB*3.5*107
"BLD",7849,0)
FB*3.5*107^FEE BASIS^0^3090210^y
"BLD",7849,1,0)
^^4^4^3090120^
"BLD",7849,1,1,0)
First patch of Fee Data & HERO enhancement:
"BLD",7849,1,2,0)
 o Increase maximum size of disbursed amount in FEE BASIS INVOICE file.
"BLD",7849,1,3,0)
 o Update S.FBAA PAID SERVER to process either old or new format of the
"BLD",7849,1,4,0)
   payment confirmation message.
"BLD",7849,4,0)
^9.64PA^162.5^1
"BLD",7849,4,162.5,0)
162.5
"BLD",7849,4,162.5,2,0)
^9.641^162.5^1
"BLD",7849,4,162.5,2,162.5,0)
FEE BASIS INVOICE  (File-top level)
"BLD",7849,4,162.5,2,162.5,1,0)
^9.6411^52^1
"BLD",7849,4,162.5,2,162.5,1,52,0)
DISBURSED AMOUNT
"BLD",7849,4,162.5,222)
y^y^p^^^^n^^n
"BLD",7849,4,162.5,224)

"BLD",7849,4,"APDD",162.5,162.5)

"BLD",7849,4,"APDD",162.5,162.5,52)

"BLD",7849,4,"B",162.5,162.5)

"BLD",7849,6.3)
3
"BLD",7849,"KRN",0)
^9.67PA^779.2^20
"BLD",7849,"KRN",.4,0)
.4
"BLD",7849,"KRN",.401,0)
.401
"BLD",7849,"KRN",.402,0)
.402
"BLD",7849,"KRN",.403,0)
.403
"BLD",7849,"KRN",.5,0)
.5
"BLD",7849,"KRN",.84,0)
.84
"BLD",7849,"KRN",3.6,0)
3.6
"BLD",7849,"KRN",3.8,0)
3.8
"BLD",7849,"KRN",9.2,0)
9.2
"BLD",7849,"KRN",9.8,0)
9.8
"BLD",7849,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",7849,"KRN",9.8,"NM",1,0)
FBPAID^^0^B27015212
"BLD",7849,"KRN",9.8,"NM",2,0)
FBPAID1^^0^B16159022
"BLD",7849,"KRN",9.8,"NM","B","FBPAID",1)

"BLD",7849,"KRN",9.8,"NM","B","FBPAID1",2)

"BLD",7849,"KRN",19,0)
19
"BLD",7849,"KRN",19.1,0)
19.1
"BLD",7849,"KRN",101,0)
101
"BLD",7849,"KRN",409.61,0)
409.61
"BLD",7849,"KRN",771,0)
771
"BLD",7849,"KRN",779.2,0)
779.2
"BLD",7849,"KRN",870,0)
870
"BLD",7849,"KRN",8989.51,0)
8989.51
"BLD",7849,"KRN",8989.52,0)
8989.52
"BLD",7849,"KRN",8994,0)
8994
"BLD",7849,"KRN","B",.4,.4)

"BLD",7849,"KRN","B",.401,.401)

"BLD",7849,"KRN","B",.402,.402)

"BLD",7849,"KRN","B",.403,.403)

"BLD",7849,"KRN","B",.5,.5)

"BLD",7849,"KRN","B",.84,.84)

"BLD",7849,"KRN","B",3.6,3.6)

"BLD",7849,"KRN","B",3.8,3.8)

"BLD",7849,"KRN","B",9.2,9.2)

"BLD",7849,"KRN","B",9.8,9.8)

"BLD",7849,"KRN","B",19,19)

"BLD",7849,"KRN","B",19.1,19.1)

"BLD",7849,"KRN","B",101,101)

"BLD",7849,"KRN","B",409.61,409.61)

"BLD",7849,"KRN","B",771,771)

"BLD",7849,"KRN","B",779.2,779.2)

"BLD",7849,"KRN","B",870,870)

"BLD",7849,"KRN","B",8989.51,8989.51)

"BLD",7849,"KRN","B",8989.52,8989.52)

"BLD",7849,"KRN","B",8994,8994)

"BLD",7849,"QUES",0)
^9.62^^
"BLD",7849,"REQB",0)
^9.611^3^2
"BLD",7849,"REQB",2,0)
FB*3.5*19^2
"BLD",7849,"REQB",3,0)
FB*3.5*61^2
"BLD",7849,"REQB","B","FB*3.5*19",2)

"BLD",7849,"REQB","B","FB*3.5*61",3)

"FIA",162.5)
FEE BASIS INVOICE
"FIA",162.5,0)
^FBAAI(
"FIA",162.5,0,0)
162.5
"FIA",162.5,0,1)
y^y^p^^^^n^^n
"FIA",162.5,0,10)

"FIA",162.5,0,11)

"FIA",162.5,0,"RLRO")

"FIA",162.5,0,"VR")
3.5^FB
"FIA",162.5,162.5)
1
"FIA",162.5,162.5,52)

"MBREQ")
0
"PKG",60,-1)
1^1
"PKG",60,0)
FEE BASIS^FB^Used to pay private vendors
"PKG",60,20,0)
^9.402P^1^1
"PKG",60,20,1,0)
2^^FBPMRG
"PKG",60,20,1,1)

"PKG",60,20,"B",2,1)

"PKG",60,22,0)
^9.49I^1^1
"PKG",60,22,1,0)
3.5^2950130^2950313
"PKG",60,22,1,"PAH",1,0)
107^3090210
"PKG",60,22,1,"PAH",1,1,0)
^^4^4^3090210
"PKG",60,22,1,"PAH",1,1,1,0)
First patch of Fee Data & HERO enhancement:
"PKG",60,22,1,"PAH",1,1,2,0)
 o Increase maximum size of disbursed amount in FEE BASIS INVOICE file.
"PKG",60,22,1,"PAH",1,1,3,0)
 o Update S.FBAA PAID SERVER to process either old or new format of the
"PKG",60,22,1,"PAH",1,1,4,0)
   payment confirmation message.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","FBPAID")
0^1^B27015212^B26862172
"RTN","FBPAID",1,0)
FBPAID ;WOIFO/SAB - SERVER ROUTINE TO UPDATE PAYMENTS ;2/10/2009
"RTN","FBPAID",2,0)
 ;;3.5;FEE BASIS;**5,61,107**;JAN 30, 1995;Build 3
"RTN","FBPAID",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBPAID",4,0)
 ;incoming record from AAC will contain the following data
"RTN","FBPAID",5,0)
 ;   - Fee Program  - from Fee Basis Program  (161.8)
"RTN","FBPAID",6,0)
 ;   - Activity Code    (C - confirmed)
"RTN","FBPAID",7,0)
 ;                      (B - backout)
"RTN","FBPAID",8,0)
 ;                      (X - cancelled)
"RTN","FBPAID",9,0)
 ;   - Internal Control Number   - IEN of payment record
"RTN","FBPAID",10,0)
 ;   - Check Number
"RTN","FBPAID",11,0)
 ;   - Check Date
"RTN","FBPAID",12,0)
 ;   - Interest Amount
"RTN","FBPAID",13,0)
 ;   - Cancellation Date
"RTN","FBPAID",14,0)
 ;   - Reason Code  (File # 162.95)
"RTN","FBPAID",15,0)
 ;   - Cancellation Code (R - C - X)
"RTN","FBPAID",16,0)
 ;   - Disbursed Amount   (this amount minus interest amount = amt pd)
"RTN","FBPAID",17,0)
 ;   variable 'FBPAID' is defined and passed to TRAP^FBMRASVR2
"RTN","FBPAID",18,0)
 ;
"RTN","FBPAID",19,0)
 N FBINV
"RTN","FBPAID",20,0)
 S U="^",FBPAID=1,FBMCNT=0
"RTN","FBPAID",21,0)
 S X="TRAP^FBMRASV2" S @^%ZOSF("TRAP")
"RTN","FBPAID",22,0)
 ;K XMY S XMY("G.FEE")="" D ENT1^XMD
"RTN","FBPAID",23,0)
 K ^TMP("FBPAID",$J),^TMP("FBERR",$J)
"RTN","FBPAID",24,0)
 D STATION^FBAAUTL I $S($G(FB("ERROR")):1,'$G(FBAASN):1,1:0) Q
"RTN","FBPAID",25,0)
 K FB
"RTN","FBPAID",26,0)
 ;start to read in message from central fee
"RTN","FBPAID",27,0)
 ;edits are:
"RTN","FBPAID",28,0)
 ;          1. invalid station number
"RTN","FBPAID",29,0)
 ;          2. invalid record length
"RTN","FBPAID",30,0)
 ;          3. unable to locate payment record
"RTN","FBPAID",31,0)
 ;          4. disbursed amount '= amt paid+interest
"RTN","FBPAID",32,0)
 ;          5. cancellations
"RTN","FBPAID",33,0)
 ; XMRG=record received in mail message from Austin
"RTN","FBPAID",34,0)
 F I=1:1 X XMREC Q:XMER<0  I XMRG]"",$E(XMRG,1,3)=FBAASN D
"RTN","FBPAID",35,0)
 .S ^TMP("FBREC",$J,I)=XMRG
"RTN","FBPAID",36,0)
 .K FBERR
"RTN","FBPAID",37,0)
 .I $L(XMRG)'=77&($L(XMRG)'=82) S FBERR=1,^TMP("FBERR",$J,2,I)=""
"RTN","FBPAID",38,0)
 .D PARSE^FBPAID1 Q:$G(FBERR)  S FBMCNT=FBMCNT+1 D @FBPROG
"RTN","FBPAID",39,0)
 D ^FBPAID2:$D(^TMP("FBERR",$J))
"RTN","FBPAID",40,0)
 D BUL^FBPAID1
"RTN","FBPAID",41,0)
 ; if any EDI invoices then add to FPPS queue
"RTN","FBPAID",42,0)
 I $D(FBINV) D PAIDLOG^FBFHLL(.FBINV)
"RTN","FBPAID",43,0)
 G END
"RTN","FBPAID",44,0)
 ;
"RTN","FBPAID",45,0)
3 ;update outpatient payment record
"RTN","FBPAID",46,0)
 Q:'$D(^FBAAC(+FBIEN(3),1,+FBIEN(2),1,FBIEN(1),1,FBIEN,0))  S FBAMT=+$P(^(0),U,3) D
"RTN","FBPAID",47,0)
 .I FBDAMT-FBINAMT'=FBAMT,$G(FBACT)="C" S ^TMP("FBERR",$J,4,I)=""_U_FBPROG_U_+FBIEN(3)_U_+FBIEN(2)_U_+FBIEN(1)_U_+FBIEN
"RTN","FBPAID",48,0)
 N JJ F JJ=1:1:3 S DA(JJ)=+FBIEN(JJ)
"RTN","FBPAID",49,0)
 S DA=+FBIEN
"RTN","FBPAID",50,0)
 S DR=""
"RTN","FBPAID",51,0)
 I FBACT="C" S DR="12////^S X=$G(FBCKDT);35///^S X=FBCKNUM;40///^S X=FBDAMT;41///^S X=FBINAMT;36///@;37///@"
"RTN","FBPAID",52,0)
 I FBACT="B" S DR="12///@;35///@;36///@;37///@;40///@;41///@"
"RTN","FBPAID",53,0)
 I FBACT="X" S DR="12///@;40///@;41///@;36////^S X=FBXDT;37////^S X=$G(FBRCOD);38///^S X=FBXCOD" D
"RTN","FBPAID",54,0)
 .I FBXCOD'="R" S ^TMP("FBERR",$J,5,I)=""_U_FBPROG_U_+FBIEN(3)_U_+FBIEN(2)_U_+FBIEN(1)_U_+FBIEN
"RTN","FBPAID",55,0)
 .I FBXCOD="R" S DR=DR_";35///@"
"RTN","FBPAID",56,0)
 S DIE="^FBAAC("_DA(3)_",1,"_DA(2)_",1,"_DA(1)_",1,"
"RTN","FBPAID",57,0)
 D LOCK^FBUCUTL(DIE,DA,1) I FBLOCK D ^DIE L -^FBAAC(DA(3),1,DA(2),1,DA(1),1,DA)
"RTN","FBPAID",58,0)
 ; if EDI then add invoice to list in FBINV(, patch *61
"RTN","FBPAID",59,0)
 I FBACT'="B",$P($G(^FBAAC(DA(3),1,DA(2),1,DA(1),1,DA,3)),U)]"" D
"RTN","FBPAID",60,0)
 . N FBAAIN
"RTN","FBPAID",61,0)
 . S FBAAIN=$P($G(^FBAAC(DA(3),1,DA(2),1,DA(1),1,DA,0)),U,16)
"RTN","FBPAID",62,0)
 . I FBAAIN]"" S FBINV(3,FBAAIN)=""
"RTN","FBPAID",63,0)
 D KILL
"RTN","FBPAID",64,0)
 Q
"RTN","FBPAID",65,0)
 ;
"RTN","FBPAID",66,0)
5 ;update pharmacy payment record
"RTN","FBPAID",67,0)
 Q:'$D(^FBAA(162.1,+FBIEN(1),"RX",+FBIEN,0))  S FBAMT=+$P(^(0),U,16) D
"RTN","FBPAID",68,0)
 . I FBDAMT-FBINAMT'=FBAMT,$G(FBACT)="C" S ^TMP("FBERR",$J,4,I)=""_U_FBPROG_U_+FBIEN(1)_U_+FBIEN
"RTN","FBPAID",69,0)
 S DA(1)=+FBIEN(1),DA=+FBIEN
"RTN","FBPAID",70,0)
 S DR=""
"RTN","FBPAID",71,0)
 I FBACT="C" S DR="28////^S X=FBCKDT;30///^S X=FBCKNUM;34///^S X=FBDAMT;35///^S X=FBINAMT;31///@;32///@"
"RTN","FBPAID",72,0)
 I FBACT="B" S DR="28///@;30///@;31///@;32///@;34///@;35///@"
"RTN","FBPAID",73,0)
 I FBACT="X" S DR="28///@;34///@;35///@;31////^S X=FBXDT;32////^S X=$G(FBRCOD);33///^S X=FBXCOD" D
"RTN","FBPAID",74,0)
 .I FBXCOD'="R" S ^TMP("FBERR",$J,5,I)=""_U_FBPROG_U_+FBIEN(1)_U_+FBIEN
"RTN","FBPAID",75,0)
 .I FBXCOD="R" S DR=DR_";30///@"
"RTN","FBPAID",76,0)
 S DIE="^FBAA(162.1,"_DA(1)_",""RX"","
"RTN","FBPAID",77,0)
 D LOCK^FBUCUTL(DIE,DA,1) I FBLOCK D ^DIE L -^FBAA(162.1,DA(1),"RX",DA)
"RTN","FBPAID",78,0)
 ; if EDI then add invoice to list in FBINV(, patch *61
"RTN","FBPAID",79,0)
 I FBACT'="B",$P($G(^FBAA(162.1,DA(1),0)),U,13)]"" D
"RTN","FBPAID",80,0)
 . N FBAAIN
"RTN","FBPAID",81,0)
 . S FBAAIN=$P($G(^FBAA(162.1,DA(1),0)),U)
"RTN","FBPAID",82,0)
 . I FBAAIN]"" S FBINV(5,FBAAIN)=""
"RTN","FBPAID",83,0)
 D KILL
"RTN","FBPAID",84,0)
 Q
"RTN","FBPAID",85,0)
 ;
"RTN","FBPAID",86,0)
9 ;update inpatient payment record
"RTN","FBPAID",87,0)
 Q:'$D(^FBAAI(+FBIEN,0))  S FBAMT=+$P(^(0),U,9) D
"RTN","FBPAID",88,0)
 .I FBDAMT-FBINAMT'=FBAMT,$G(FBACT)="C" S ^TMP("FBERR",$J,4,I)=""_U_FBPROG_U_+FBIEN
"RTN","FBPAID",89,0)
 S DA=+FBIEN
"RTN","FBPAID",90,0)
 S DR=""
"RTN","FBPAID",91,0)
 I FBACT="C" S DR="45////^S X=FBCKDT;48///^S X=FBCKNUM;52///^S X=FBDAMT;53///^S X=FBINAMT;49///@;50///@"
"RTN","FBPAID",92,0)
 I FBACT="B" S DR="45///@;48///@;49///@;50///@;52///@;53///@"
"RTN","FBPAID",93,0)
 I FBACT="X" S DR="45///@;52///@;53///@;49////^S X=FBXDT;50////^S X=$G(FBRCOD);51///^S X=FBXCOD" D
"RTN","FBPAID",94,0)
 .I FBXCOD'="R" S ^TMP("FBERR",$J,5,I)=""_U_FBPROG_U_+FBIEN
"RTN","FBPAID",95,0)
 .I FBXCOD="R" S DR=DR_";48///@"
"RTN","FBPAID",96,0)
 S DIE="^FBAAI("
"RTN","FBPAID",97,0)
 D LOCK^FBUCUTL(DIE,DA,1) I FBLOCK D ^DIE L -^FBAAI(DA)
"RTN","FBPAID",98,0)
 ; if EDI then add invoice to list in FBINV(, patch *61
"RTN","FBPAID",99,0)
 I FBACT'="B",$P($G(^FBAAI(DA,3)),U)]"" D
"RTN","FBPAID",100,0)
 . N FBAAIN
"RTN","FBPAID",101,0)
 . S FBAAIN=$P($G(^FBAAI(DA,0)),U)
"RTN","FBPAID",102,0)
 . I FBAAIN]"" S FBINV(9,FBAAIN)=""
"RTN","FBPAID",103,0)
 D KILL
"RTN","FBPAID",104,0)
 Q
"RTN","FBPAID",105,0)
 ;
"RTN","FBPAID",106,0)
T ;update travel payment record
"RTN","FBPAID",107,0)
 Q:'$D(^FBAAC(+FBIEN(1),3,+FBIEN,0))  S FBAMT=+$P(^(0),U,3) D
"RTN","FBPAID",108,0)
 . I FBDAMT-FBINAMT'=FBAMT,$G(FBACT)="C" S ^TMP("FBERR",$J,4,I)=""_U_FBPROG_U_+FBIEN(1)_U_+FBIEN
"RTN","FBPAID",109,0)
 S DA(1)=+FBIEN(1),DA=+FBIEN
"RTN","FBPAID",110,0)
 S DR=""
"RTN","FBPAID",111,0)
 I FBACT="C" S DR="8////^S X=FBCKDT;9///^S X=FBCKNUM;13///^S X=FBDAMT;14///^S X=FBINAMT;10///@;11///@"
"RTN","FBPAID",112,0)
 I FBACT="B" S DR="8///@;9///@;10///@;11///@;13///@;14///@"
"RTN","FBPAID",113,0)
 I FBACT="X" S DR="8///@;13///@;14///@;10////^S X=FBXDT;11////^S X=$G(FBRCOD);12///^S X=FBXCOD" D
"RTN","FBPAID",114,0)
 .I FBXCOD'="R" S ^TMP("FBERR",$J,5,I)=""_U_FBPROG_U_+FBIEN(1)_U_+FBIEN
"RTN","FBPAID",115,0)
 .I FBXCOD="R" S DR=DR_";9///@"
"RTN","FBPAID",116,0)
 S DIE="^FBAAC("_+FBIEN(1)_",3,"
"RTN","FBPAID",117,0)
 D LOCK^FBUCUTL(DIE,DA,1) I FBLOCK D ^DIE L -^FBAAC(DA(1),3,DA)
"RTN","FBPAID",118,0)
 D KILL
"RTN","FBPAID",119,0)
 Q
"RTN","FBPAID",120,0)
 ;
"RTN","FBPAID",121,0)
END ;clean and exit
"RTN","FBPAID",122,0)
 N XMSER,XMZ S XMSER="S."_XQSOP,XMZ=XQMSG D REMSBMSG^XMA1C
"RTN","FBPAID",123,0)
 K FB,FBPAID,FBSITE,FBAASN,FBSN,FBMCNT,I,XMER,XMREC,XMRG,XMY,^TMP("FBERR",$J),^TMP("FBPAID",$J),^TMP("FBREC",$J),X
"RTN","FBPAID",124,0)
KILL K FBLOCK,DIE,DA,DR,FBIEN,FBACT,FBCKNUM,FBRCOD,FBPROG,FBCKDT,FBXDT,FBXCOD,FBINAMT,FBDAMT,FBAMT,FBERR
"RTN","FBPAID",125,0)
 Q
"RTN","FBPAID1")
0^2^B16159022^B10584099
"RTN","FBPAID1",1,0)
FBPAID1 ;WOIFO/SAB - SERVER ROUTINE TO UPDATE PAYMENTS CON'T ;2/10/2009
"RTN","FBPAID1",2,0)
 ;;3.5;FEE BASIS;**19,107**;JAN 30, 1995;Build 3
"RTN","FBPAID1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBPAID1",4,0)
PARSE ;set-up variables for payment record called from FBPAID
"RTN","FBPAID1",5,0)
 ;  FBPROG = 3 for Outpatient (file 162)
"RTN","FBPAID1",6,0)
 ;         = T for Travel (file 162)
"RTN","FBPAID1",7,0)
 ;         = 5 for Pharmacy (file 162.1)
"RTN","FBPAID1",8,0)
 ;         = 9 for Inpatient (file 162.5)
"RTN","FBPAID1",9,0)
 ;         = $E(XMRG,7)      fee program and effected file
"RTN","FBPAID1",10,0)
 ;  FBACT  = $E(XMRG,8)      type of activity                
"RTN","FBPAID1",11,0)
 ;  FBIEN(x)=$E(XMRG,9,38)   IEN for payment record to update
"RTN","FBPAID1",12,0)
 ;  FBCKNUM= $E(XMRG,39,46)  check number
"RTN","FBPAID1",13,0)
 ;  old format (when total length = 77)
"RTN","FBPAID1",14,0)
 ;  FBCKDT = $E(XMRG,47,52)  check date
"RTN","FBPAID1",15,0)
 ;  FBINAMT= $E(XMRG,53,60)  interest amount
"RTN","FBPAID1",16,0)
 ;  FBXDT  = $E(XMRG,61,66)  cancel date
"RTN","FBPAID1",17,0)
 ;  FBRCOD = $E(XMRG,67)     reason code
"RTN","FBPAID1",18,0)
 ;  FBXCOD = $E(XMRG,68)     cancel code
"RTN","FBPAID1",19,0)
 ;  FBDAMT = $E(XMRG,69,76)  disbursed amount
"RTN","FBPAID1",20,0)
 ;  new format (when total length = 82)
"RTN","FBPAID1",21,0)
 ;  FBCKDT = $E(XMRG,47,54)  check date
"RTN","FBPAID1",22,0)
 ;  FBINAMT= $E(XMRG,55,62)  interest amount
"RTN","FBPAID1",23,0)
 ;  FBXDT  = $E(XMRG,63,70)  cancel date
"RTN","FBPAID1",24,0)
 ;  FBRCOD = $E(XMRG,71)     reason code
"RTN","FBPAID1",25,0)
 ;  FBXCOD = $E(XMRG,72)     cancel code
"RTN","FBPAID1",26,0)
 ;  FBDAMT = $E(XMRG,73,81)  disbursed amount
"RTN","FBPAID1",27,0)
 ;
"RTN","FBPAID1",28,0)
 ;  FBAMT  = Amount paid out of payment record
"RTN","FBPAID1",29,0)
 Q:$G(FBERR)
"RTN","FBPAID1",30,0)
 S FBPROG=$E(XMRG,7) I $S(FBPROG=3:0,FBPROG=5:0,FBPROG=9:0,FBPROG="T":0,1:1) S FBERR=1 Q
"RTN","FBPAID1",31,0)
 S FBACT=$E(XMRG,8) I $S(FBACT="C":0,FBACT="B":0,FBACT="X":0,1:1) S FBERR=1 Q
"RTN","FBPAID1",32,0)
 S FBIEN=$E(XMRG,9,38) D  Q:$G(FBERR)
"RTN","FBPAID1",33,0)
 . I FBPROG=3 D  Q:$G(FBERR)
"RTN","FBPAID1",34,0)
 ..S FBIEN(3)=+$P(FBIEN,U),FBIEN(2)=+$P(FBIEN,U,2),FBIEN(1)=+$P(FBIEN,U,3),FBIEN=+$P(FBIEN,U,4)
"RTN","FBPAID1",35,0)
 ..I '$D(^FBAAC(FBIEN(3),1,FBIEN(2),1,FBIEN(1),1,FBIEN,0)) D CHKMOVE
"RTN","FBPAID1",36,0)
 ..I '$D(^FBAAC(FBIEN(3),1,FBIEN(2),1,FBIEN(1),1,FBIEN,0)) S FBERR=1,^TMP("FBERR",$J,3,I)=""
"RTN","FBPAID1",37,0)
 . ;
"RTN","FBPAID1",38,0)
 . I FBPROG=5 D  Q:$G(FBERR)
"RTN","FBPAID1",39,0)
 ..S FBIEN(1)=+$P(FBIEN,U),FBIEN=+$P(FBIEN,U,2)
"RTN","FBPAID1",40,0)
 ..I '$D(^FBAA(162.1,FBIEN(1),"RX",FBIEN,0)) S FBERR=1,^TMP("FBERR",$J,3,I)=""
"RTN","FBPAID1",41,0)
 . ;
"RTN","FBPAID1",42,0)
 . I FBPROG=9 D  Q:$G(FBERR)
"RTN","FBPAID1",43,0)
 ..S FBIEN=+FBIEN I '$D(^FBAAI(FBIEN,0)) S FBERR=1,^TMP("FBERR",$J,3,I)=""
"RTN","FBPAID1",44,0)
 . ;
"RTN","FBPAID1",45,0)
 . I FBPROG="T" D  Q:$G(FBERR)
"RTN","FBPAID1",46,0)
 ..S FBIEN(1)=+$P(FBIEN,U),FBIEN=+$P(FBIEN,U,2)
"RTN","FBPAID1",47,0)
 ..I '$D(^FBAAC(FBIEN(1),3,FBIEN,0)) D CHKMOVE
"RTN","FBPAID1",48,0)
 ..I '$D(^FBAAC(FBIEN(1),3,FBIEN,0)) S FBERR=1,^TMP("FBERR",$J,3,I)=""
"RTN","FBPAID1",49,0)
 S FBCKNUM=$$EXTRL^FBMRASVR($E(XMRG,39,46),1)
"RTN","FBPAID1",50,0)
 I $L(XMRG)=77 D  ; process old format
"RTN","FBPAID1",51,0)
 . S FBCKDT=$$DATE^FBPAID1($E(XMRG,47,52))
"RTN","FBPAID1",52,0)
 . S FBINAMT=$S(+$E(XMRG,53,60):+$E(XMRG,53,58)_"."_$E(XMRG,59,60),1:0)
"RTN","FBPAID1",53,0)
 . S FBINAMT=$S(FBINAMT=0:0,$P(FBINAMT,".",2)'>0:$P(FBINAMT,"."),1:+FBINAMT)
"RTN","FBPAID1",54,0)
 . S FBXDT=$$DATE^FBPAID1($E(XMRG,61,66))
"RTN","FBPAID1",55,0)
 . S FBRCOD=$E(XMRG,67),FBXCOD=$E(XMRG,68)
"RTN","FBPAID1",56,0)
 . S FBRCOD=$O(^FB(162.95,"C",FBRCOD,0))
"RTN","FBPAID1",57,0)
 . S FBDAMT=$S(+$E(XMRG,69,76):+$E(XMRG,69,74)_"."_$E(XMRG,75,76),1:0)
"RTN","FBPAID1",58,0)
 . S FBDAMT=$S(FBDAMT=0:0,$P(FBDAMT,".",2)'>0:$P(FBDAMT,"."),1:+FBDAMT)
"RTN","FBPAID1",59,0)
 I $L(XMRG)=82 D  ; process new format
"RTN","FBPAID1",60,0)
 . S FBCKDT=$$DATE4^FBPAID1($E(XMRG,47,54))
"RTN","FBPAID1",61,0)
 . S FBINAMT=$S(+$E(XMRG,55,62):+$E(XMRG,55,60)_"."_$E(XMRG,61,62),1:0)
"RTN","FBPAID1",62,0)
 . S FBINAMT=$S(FBINAMT=0:0,$P(FBINAMT,".",2)'>0:$P(FBINAMT,"."),1:+FBINAMT)
"RTN","FBPAID1",63,0)
 . S FBXDT=$$DATE4^FBPAID1($E(XMRG,63,70))
"RTN","FBPAID1",64,0)
 . S FBRCOD=$E(XMRG,71),FBXCOD=$E(XMRG,72)
"RTN","FBPAID1",65,0)
 . S FBRCOD=$O(^FB(162.95,"C",FBRCOD,0))
"RTN","FBPAID1",66,0)
 . S FBDAMT=$S(+$E(XMRG,73,81):+$E(XMRG,73,79)_"."_$E(XMRG,80,81),1:0)
"RTN","FBPAID1",67,0)
 . S FBDAMT=$S(FBDAMT=0:0,$P(FBDAMT,".",2)'>0:$P(FBDAMT,"."),1:+FBDAMT)
"RTN","FBPAID1",68,0)
 Q
"RTN","FBPAID1",69,0)
 ;
"RTN","FBPAID1",70,0)
BUL ;create server bulletin message
"RTN","FBPAID1",71,0)
 S ^TMP("FBPAID",$J,0)=FBMCNT
"RTN","FBPAID1",72,0)
 Q
"RTN","FBPAID1",73,0)
DATE(X) ;pass in 'X'=date in yymmdd format and return date in
"RTN","FBPAID1",74,0)
 ;fileman format.
"RTN","FBPAID1",75,0)
 N Y I '$G(X) Q ""
"RTN","FBPAID1",76,0)
 S %DT="",X=$E(X,3,7)_$E(X,1,2) D ^%DT K %DT
"RTN","FBPAID1",77,0)
 Q $S(Y=-1:"",1:Y)
"RTN","FBPAID1",78,0)
DATE4(X) ;pass in 'X'=date in yyyymmdd format and return date in
"RTN","FBPAID1",79,0)
 ;fileman format.
"RTN","FBPAID1",80,0)
 N Y I '$G(X) Q ""
"RTN","FBPAID1",81,0)
 S %DT="",X=$E(X,5,6)_"/"_$E(X,7,8)_"/"_$E(X,1,4) D ^%DT K %DT
"RTN","FBPAID1",82,0)
 Q $S(Y=-1:"",1:Y)
"RTN","FBPAID1",83,0)
CHKMOVE ;check if payment moved
"RTN","FBPAID1",84,0)
 ; input
"RTN","FBPAID1",85,0)
 ;   FBPROG - fee program
"RTN","FBPAID1",86,0)
 ;   FBIEN - ien of payment (from austin)
"RTN","FBPAID1",87,0)
 ;   FBIEN() - ien(s) of higher level entries (1 for next higher, etc.)
"RTN","FBPAID1",88,0)
 ; output
"RTN","FBPAID1",89,0)
 ;   FBIEN   may be changed
"RTN","FBPAID1",90,0)
 ;   FBIEN() may be changed
"RTN","FBPAID1",91,0)
 N FBDA,FBFILE,FBNIENS,FBOIENS
"RTN","FBPAID1",92,0)
 S FBFILE=$S(FBPROG=3:162.03,FBPROG="T":162.04,1:"")
"RTN","FBPAID1",93,0)
 Q:FBFILE=""
"RTN","FBPAID1",94,0)
 I FBPROG=3 D
"RTN","FBPAID1",95,0)
 . S FBOIENS=FBIEN_","_FBIEN(1)_","_FBIEN(2)_","_FBIEN(3)_","
"RTN","FBPAID1",96,0)
 . S FBDA=$O(^FBAA(161.45,"C",FBFILE,FBOIENS,0))
"RTN","FBPAID1",97,0)
 . Q:'FBDA  ; not moved
"RTN","FBPAID1",98,0)
 . S FBNIENS=$P($G(^FBAA(161.45,FBDA,0)),U,3)
"RTN","FBPAID1",99,0)
 . Q:FBNIENS=""  ; don't know new iens
"RTN","FBPAID1",100,0)
 . S FBIEN=$P(FBNIENS,",",1)
"RTN","FBPAID1",101,0)
 . S FBIEN(1)=$P(FBNIENS,",",2)
"RTN","FBPAID1",102,0)
 . S FBIEN(2)=$P(FBNIENS,",",3)
"RTN","FBPAID1",103,0)
 . S FBIEN(3)=$P(FBNIENS,",",4)
"RTN","FBPAID1",104,0)
 I FBPROG="T" D
"RTN","FBPAID1",105,0)
 . S FBOIENS=FBIEN_","_FBIEN(1)_","
"RTN","FBPAID1",106,0)
 . S FBDA=$O(^FBAA(161.45,"C",FBFILE,FBOIENS,0))
"RTN","FBPAID1",107,0)
 . Q:'FBDA  ; not moved
"RTN","FBPAID1",108,0)
 . S FBNIENS=$P($G(^FBAA(161.45,FBDA,0)),U,3)
"RTN","FBPAID1",109,0)
 . Q:FBNIENS=""  ; don't known new iens
"RTN","FBPAID1",110,0)
 . S FBIEN=$P(FBNIENS,",",1)
"RTN","FBPAID1",111,0)
 . S FBIEN(1)=$P(FBNIENS,",",2)
"RTN","FBPAID1",112,0)
 Q
"VER")
8.0^22.0
"^DD",162.5,162.5,52,0)
DISBURSED AMOUNT^NJ10,2^^2;8^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>9999999.99)!(X<0) X
"^DD",162.5,162.5,52,3)
Type a Dollar Amount between 0 and 9999999.99, 2 Decimal Digits
"^DD",162.5,162.5,52,21,0)
^.001^1^1^3081119^^^
"^DD",162.5,162.5,52,21,1,0)
This is the dollar amount paid by the treasury, less any interest paid.
"^DD",162.5,162.5,52,"DT")
3081119
"BLD",7849,6)
^99
**END**
**END**
