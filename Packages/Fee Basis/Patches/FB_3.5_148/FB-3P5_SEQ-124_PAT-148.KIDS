Released FB*3.5*148 SEQ #124
Extracted from mail message
**KIDS**:FB*3.5*148^

**INSTALL NAME**
FB*3.5*148
"BLD",9382,0)
FB*3.5*148^FEE BASIS^0^3131002^y
"BLD",9382,1,0)
^^4^4^3130701^
"BLD",9382,1,1,0)
This Patch Addresses 1 issue:
"BLD",9382,1,2,0)
 
"BLD",9382,1,3,0)
1. The error "<UNDEFINED>ANC+8^FBPCR67" occurs when running 
"BLD",9382,1,4,0)
   the Potential Cost Recovery Report [FB PRC].
"BLD",9382,4,0)
^9.64PA^^
"BLD",9382,6.3)
4
"BLD",9382,"INID")
^
"BLD",9382,"INIT")

"BLD",9382,"KRN",0)
^9.67PA^779.2^20
"BLD",9382,"KRN",.4,0)
.4
"BLD",9382,"KRN",.401,0)
.401
"BLD",9382,"KRN",.402,0)
.402
"BLD",9382,"KRN",.403,0)
.403
"BLD",9382,"KRN",.5,0)
.5
"BLD",9382,"KRN",.84,0)
.84
"BLD",9382,"KRN",3.6,0)
3.6
"BLD",9382,"KRN",3.8,0)
3.8
"BLD",9382,"KRN",9.2,0)
9.2
"BLD",9382,"KRN",9.8,0)
9.8
"BLD",9382,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",9382,"KRN",9.8,"NM",1,0)
FBPCR67^^0^B27989751
"BLD",9382,"KRN",9.8,"NM","B","FBPCR67",1)

"BLD",9382,"KRN",19,0)
19
"BLD",9382,"KRN",19.1,0)
19.1
"BLD",9382,"KRN",101,0)
101
"BLD",9382,"KRN",409.61,0)
409.61
"BLD",9382,"KRN",771,0)
771
"BLD",9382,"KRN",779.2,0)
779.2
"BLD",9382,"KRN",870,0)
870
"BLD",9382,"KRN",8989.51,0)
8989.51
"BLD",9382,"KRN",8989.52,0)
8989.52
"BLD",9382,"KRN",8994,0)
8994
"BLD",9382,"KRN","B",.4,.4)

"BLD",9382,"KRN","B",.401,.401)

"BLD",9382,"KRN","B",.402,.402)

"BLD",9382,"KRN","B",.403,.403)

"BLD",9382,"KRN","B",.5,.5)

"BLD",9382,"KRN","B",.84,.84)

"BLD",9382,"KRN","B",3.6,3.6)

"BLD",9382,"KRN","B",3.8,3.8)

"BLD",9382,"KRN","B",9.2,9.2)

"BLD",9382,"KRN","B",9.8,9.8)

"BLD",9382,"KRN","B",19,19)

"BLD",9382,"KRN","B",19.1,19.1)

"BLD",9382,"KRN","B",101,101)

"BLD",9382,"KRN","B",409.61,409.61)

"BLD",9382,"KRN","B",771,771)

"BLD",9382,"KRN","B",779.2,779.2)

"BLD",9382,"KRN","B",870,870)

"BLD",9382,"KRN","B",8989.51,8989.51)

"BLD",9382,"KRN","B",8989.52,8989.52)

"BLD",9382,"KRN","B",8994,8994)

"BLD",9382,"QDEF")
^^^^NO^^^^NO^^YES
"BLD",9382,"QUES",0)
^9.62^^
"BLD",9382,"REQB",0)
^9.611^1^1
"BLD",9382,"REQB",1,0)
FB*3.5*108^2
"BLD",9382,"REQB","B","FB*3.5*108",1)

"MBREQ")
0
"PKG",60,-1)
1^1
"PKG",60,0)
FEE BASIS^FB^Used to pay private vendors
"PKG",60,20,0)
^9.402P^1^1
"PKG",60,20,1,0)
2^^FBPMRG
"PKG",60,20,1,1)

"PKG",60,20,"B",2,1)

"PKG",60,22,0)
^9.49I^1^1
"PKG",60,22,1,0)
3.5^2950130^2950313
"PKG",60,22,1,"PAH",1,0)
148^3131002
"PKG",60,22,1,"PAH",1,1,0)
^^4^4^3131002
"PKG",60,22,1,"PAH",1,1,1,0)
This Patch Addresses 1 issue:
"PKG",60,22,1,"PAH",1,1,2,0)
 
"PKG",60,22,1,"PAH",1,1,3,0)
1. The error "<UNDEFINED>ANC+8^FBPCR67" occurs when running 
"PKG",60,22,1,"PAH",1,1,4,0)
   the Potential Cost Recovery Report [FB PRC].
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","FBPCR67")
0^1^B27989751^B27748859
"RTN","FBPCR67",1,0)
FBPCR67 ;AISC/DMK,TET-CH/CNH POTENTIAL COST RECOVERY SORT ; 7/5/13 10:10am
"RTN","FBPCR67",2,0)
 ;;3.5;FEE BASIS;**4,48,55,69,98,122,108,148**;JAN 30, 1995;Build 4
"RTN","FBPCR67",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBPCR67",4,0)
EN ;entry point for sort
"RTN","FBPCR67",5,0)
 S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR67",6,0)
SORT ;sort by date finalized, ien
"RTN","FBPCR67",7,0)
 N FBY2,FBY5,FBCDAYS,FBCSID,FBX,FBADJLR,FBADJLA,FBRRMKL
"RTN","FBPCR67",8,0)
 S FBM=FBBDATE-.1 F  S FBM=$O(^FBAAI("AD",FBM)) Q:'FBM!(FBM>FBEDATE)  S FBI=0 F  S FBI=$O(^FBAAI("AD",FBM,FBI)) Q:FBI'>0  S FBIN=$G(^FBAAI(FBI,0)) I FBIN]""&($G(^FBAAI(FBI,"FBREJ"))']"") D  S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR67",9,0)
 .S (DFN,J)=+$P(FBIN,U,4) D VET^FBPCR
"RTN","FBPCR67",10,0)
 .D SET Q:FBPI'[+$P(FBIN,U,12)!('FBPSV&('$D(FBPSV(FBPSF))))  I FBCATC!FBINS D SETTMP
"RTN","FBPCR67",11,0)
KILL ;kill variables set in this routine and in FPAY2, sort/set sections
"RTN","FBPCR67",12,0)
 K A1,A2,A3,D,D2,DFN,FBAACPTC,FBBN,FBCATC,FBCNT,FBCP,FBDOB,FBDT,FBDT1,FBDX,FBDX1,FBI,FBIN,FBINS,FBIX,FBJ,FBM,FBOB,FBPAT,FBPDX,FBPROC,FBPROC1,FBPSF,FBSC,FBTA,FBVEN,FBVENID,FBVP,I,J,K,L,M,Y,FBPOA,FBPROA,FBADMTDX
"RTN","FBPCR67",13,0)
 K FBVNAME,FBVID,FBPNAME,FBPID
"RTN","FBPCR67",14,0)
 K FBY2,FBY4,FBCDAYS,FBCSID,FBX,FBADJLR,FBADJLA,FBRRMKL   ; FB*3.5*122
"RTN","FBPCR67",15,0)
 D KILL^FBPCR2
"RTN","FBPCR67",16,0)
 Q
"RTN","FBPCR67",17,0)
SET ;set variables
"RTN","FBPCR67",18,0)
 S FBY2=$G(^FBAAI(FBI,2)),FBY4=$G(^FBAAI(FBI,4)),$P(FBY4,U,20)=$P($G(^FBAAI(FBI,5)),U,1,4)  ; FB*3.5*122
"RTN","FBPCR67",19,0)
 S FBY5=$G(^FBAAI(FBI,5))
"RTN","FBPCR67",20,0)
 F FBJ=1,2,3,4,6,7,8,9,11,13,14 S FBIN(FBJ)=$P(FBIN,"^",FBJ)
"RTN","FBPCR67",21,0)
 Q:FBPI'[+$P(FBIN,U,12)  S FBPSF=+$P(FBIN,U,20)
"RTN","FBPCR67",22,0)
 Q:'FBPSV&('$D(FBPSV(FBPSF)))
"RTN","FBPCR67",23,0)
 S ^TMP($J,"FB",FBPSF)=$G(^FBAAI(FBI,5))  ; FB*3.5*122
"RTN","FBPCR67",24,0)
 D
"RTN","FBPCR67",25,0)
 . N FBCATC2
"RTN","FBPCR67",26,0)
 . S FBCATC=$$CATC^FBPCR(DFN,+$P(FBIN,U,6),+$P(FBIN,U,18))
"RTN","FBPCR67",27,0)
 . Q:FBCATC=2
"RTN","FBPCR67",28,0)
 . S FBCATC2=$$CATC^FBPCR(DFN,+$P(FBIN,U,7),+$P(FBIN,U,18))
"RTN","FBPCR67",29,0)
 . I FBCATC2=0 Q
"RTN","FBPCR67",30,0)
 . I FBCATC=0!(FBCATC=1) S FBCATC=FBCATC2 Q
"RTN","FBPCR67",31,0)
 . S:FBCATC2=2 FBCATC=2
"RTN","FBPCR67",32,0)
 ;,FBINS=$S($O(^FBAAA("AIC",FBIN(4),+$O(^FBAAA("AIC",FBIN(4),-FBIN(6))),0))="Y":1,1:0)
"RTN","FBPCR67",33,0)
 S FBINS=$S($$INSCK^FBPCR3(FBIN(6),FBIN(4),+$P(FBIN,U,12))=1:$$INSURED^FBPCR4(DFN,+$P(FBIN,U,6),+$P(FBIN,U,7)),1:0)
"RTN","FBPCR67",34,0)
 Q:'FBCATC&'FBINS
"RTN","FBPCR67",35,0)
 S FBIN(5)=$P(FBIN,U,5)
"RTN","FBPCR67",36,0)
 S FBIEN=FBIN(3),FBVNAME=$G(^FBAAV(FBIN(3),0)) Q:FBVNAME']""  S FBVID=$P(FBVNAME,U,2)_"/"_$S($P($G(^FBAAV(FBIEN,3)),U,2)]"":$P($G(^FBAAV(FBIEN,3)),U,2),1:"**********"),FBVNAME=$E($P(FBVNAME,U),1,23)
"RTN","FBPCR67",37,0)
 S FBIN(2)=$$DATX^FBAAUTL(FBIN(2)),FBVEN=FBVNAME_";"_FBVID,FBPAT=FBPNAME_";"_DFN
"RTN","FBPCR67",38,0)
 S FBIN(6)=$$DATX^FBAAUTL(FBIN(6)),FBIN(7)=$$DATX^FBAAUTL(FBIN(7))
"RTN","FBPCR67",39,0)
 Q
"RTN","FBPCR67",40,0)
SETTMP ;sort data by primary service facility, patient, fee program, vendor, date
"RTN","FBPCR67",41,0)
 Q:$$FILTER^FBPCR4()=0
"RTN","FBPCR67",42,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI)=FBIN(2)_U_$J(FBIN(8),8,2)_U_$J(FBIN(9),8,2)_U_FBIN(11)_U_$J(FBIN(1),8)_U_FBIN(6)_U_FBIN(7)_U_$P(FBIN,U,12)_U_FBCATC_U_FBINS_U_FBIN(13)_U_FBIN(14)
"RTN","FBPCR67",43,0)
 S FBCDAYS=$P(FBY2,U,10) ; covered days
"RTN","FBPCR67",44,0)
 S FBCSID=$P(FBY2,U,11) ; patient control number
"RTN","FBPCR67",45,0)
 S FBX=$$ADJLRA^FBCHFA(FBI_",")
"RTN","FBPCR67",46,0)
 S FBADJLR=$P(FBX,U) ;adjustment reason
"RTN","FBPCR67",47,0)
 S FBADJLA=$P(FBX,U,2) ;adjustment amount
"RTN","FBPCR67",48,0)
 S FBRRMKL=$$RRL^FBCHFR(FBI_",") ;remittance remarks
"RTN","FBPCR67",49,0)
 S FBADMTDX=$$ICD9^FBCSV1($P(FBY5,"^",9))  ; admitting diagnosis
"RTN","FBPCR67",50,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"FBINV")=FBCDAYS_"^"_FBCSID_"^"_FBADJLR_"^"_FBADJLA_"^"_FBRRMKL_"^"_FBADMTDX
"RTN","FBPCR67",51,0)
 ;S FBDX=$G(^FBAAI(FBI,"DX")) I FBDX]"" S FBDX1="" F I=1:1:5 S:$P(FBDX,U,I) FBDX1=FBDX1_$$ICD9^FBCSV1($P(FBDX,U,I),+$P($G(FBIN),U,6))_U
"RTN","FBPCR67",52,0)
 S FBDX=$G(^FBAAI(FBI,"DX"))
"RTN","FBPCR67",53,0)
 S FBPOA=$G(^FBAAI(FBI,"POA"))
"RTN","FBPCR67",54,0)
 I FBDX]"" S FBDX1="" F I=1:1:25 D
"RTN","FBPCR67",55,0)
 . N FBPOA1
"RTN","FBPCR67",56,0)
 . Q:$P(FBDX,U,I)=""
"RTN","FBPCR67",57,0)
 . S FBPOA1=$P(FBPOA,U,I)
"RTN","FBPCR67",58,0)
 . S FBDX1=FBDX1_$$ICD9^FBCSV1($P(FBDX,U,I),+$P($G(FBIN),U,6))_"/"
"RTN","FBPCR67",59,0)
 . S FBDX1=FBDX1_$S(FBPOA1:$P($G(^FB(161.94,FBPOA1,0)),"^"),1:"")_U
"RTN","FBPCR67",60,0)
 . Q
"RTN","FBPCR67",61,0)
 I FBDX]"" S FBDX1=$P(FBDX1,U,1,($L(FBDX1,U)-1)),^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"DX")=FBDX1
"RTN","FBPCR67",62,0)
 S FBPROC=$G(^FBAAI(FBI,"PROC")) I FBPROC]"" S FBPROC1="" F I=1:1:25 S:$P(FBPROC,U,I) FBPROC1=FBPROC1_$$ICD0^FBCSV1($P(FBPROC,U,I),+$P($G(FBIN),U,6))_U
"RTN","FBPCR67",63,0)
 I FBPROC]"" S FBPROC1=$P(FBPROC1,U,1,($L(FBPROC1,U)-1)),^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"PROC")=FBPROC1
"RTN","FBPCR67",64,0)
 ;*** removed conditional to get ancillary payments processed
"RTN","FBPCR67",65,0)
 ;D ANC:$D(^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,FBM,FBI))
"RTN","FBPCR67",66,0)
 D ANC
"RTN","FBPCR67",67,0)
 K FB5010
"RTN","FBPCR67",68,0)
 ;get line item rendering provider data
"RTN","FBPCR67",69,0)
 I FBPROC]"" S I=0 F  S I=$O(^FBAAI(FBI,"RPROV",I)) Q:'I  D
"RTN","FBPCR67",70,0)
 . N X
"RTN","FBPCR67",71,0)
 . S X=$G(^FBAAI(FBI,"RPROV",I,0))
"RTN","FBPCR67",72,0)
 . I $P(X,U) S FB5010($P(X,U))=X
"RTN","FBPCR67",73,0)
 I $D(FB5010) M ^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"RPROV")=FB5010 K FB5010
"RTN","FBPCR67",74,0)
 I $TR(FBY4,U)]"" S ^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"FBY4")=FBY4         ; FB*3.5*122
"RTN","FBPCR67",75,0)
 ;I FBPROC]"" K FB5010 F I=1:1:25 S:$P(FBPROC,U,I) FB5010(I)=$G(^FBAAI(FBI,"RPROV",I,0))          ; FB*3.5*122
"RTN","FBPCR67",76,0)
 ;I FBPROC]"" K FB5010 F I=1:1:25 S:$P(FBPROC,U,I) FB5010($P($G(^FBAAI(FBI,"RPROV",I,0)),U,1))=$G(^FBAAI(FBI,"RPROV",I,0))
"RTN","FBPCR67",77,0)
 ;I FBPROC]"" M ^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"RPROV")=FB5010 K FB5010   ; FB*3.5*122 
"RTN","FBPCR67",78,0)
 Q
"RTN","FBPCR67",79,0)
ANC ;ancillary payments
"RTN","FBPCR67",80,0)
 ;Patch FB*3.5*148 saves off any previous values and then cleans up variable FBAACPTC
"RTN","FBPCR67",81,0)
 N J,K,L,M,Y,FBDT1,FBVID,FBAACPTC I FBPI=67 N FBPI S FBPI=+$P(FBIN,U,12)
"RTN","FBPCR67",82,0)
 S J=DFN,FBCNT=0 I J,+FBIN(5),$D(^FBAAC("AM",FBIN(5),J)) D
"RTN","FBPCR67",83,0)
 .F K=0:0 S K=$O(^FBAAC("AM",FBIN(5),J,K)) Q:'K  S L=0 F  S L=$O(^FBAAC("AM",FBIN(5),J,K,L)) Q:'L  D
"RTN","FBPCR67",84,0)
 ..S FBDT1=$P($G(^FBAAC(J,1,K,1,L,0)),U) I FBDT1]"" S FBDT1=$$DATX^FBAAUTL(FBDT1)
"RTN","FBPCR67",85,0)
 ..S M=0 F  S M=$O(^FBAAC("AM",FBIN(5),J,K,L,M)) Q:'M  S Y=$G(^FBAAC(J,1,K,1,L,1,M,0)) I Y]"" D
"RTN","FBPCR67",86,0)
 ...K FBAACPTC
"RTN","FBPCR67",87,0)
 ...D EN1^FBPCR2 Q:'$D(FBAACPTC)  S FBCNT=FBCNT+1
"RTN","FBPCR67",88,0)
 ...Q:$$FILTER^FBPCR4()=0
"RTN","FBPCR67",89,0)
 ...S ^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,FBM,FBI,"A",FBCNT)=FBDT1_U_FBAACPTC_FBCP_$S($G(FBMODLE)]"":"-"_FBMODLE,1:"")_U_A1_U_A2_U_FBBN_U_FBIN_U_D2_U_FBSC_U_FBPDX_U_FBOB_U_FBVNAME_U_FBVID_U_FBPI_U_FBCATC_U_FBINS
"RTN","FBPCR67",90,0)
 ...S ^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,FBM,FBI,"A",FBCNT,"FBADJ")=TAMT_U_FBUNITS_U_FBADJLR_U_FBADJLA_U_FBRRMKL_U_FBCSID
"RTN","FBPCR67",91,0)
 Q
"VER")
8.0^22.0
"BLD",9382,6)
^124
**END**
**END**
