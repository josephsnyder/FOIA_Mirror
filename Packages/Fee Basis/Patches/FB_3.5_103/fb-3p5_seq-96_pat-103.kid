Released FB*3.5*103 SEQ #96
Extracted from mail message
**KIDS**:FB*3.5*103^

**INSTALL NAME**
FB*3.5*103
"BLD",7198,0)
FB*3.5*103^FEE BASIS^0^3080530^y
"BLD",7198,1,0)
^^2^2^3080430^
"BLD",7198,1,1,0)
Add the Referring Provider NPI Information to 10-7078 and 10-7079
"BLD",7198,1,2,0)
Fee Authorization Forms.
"BLD",7198,4,0)
^9.64PA^162.2^3
"BLD",7198,4,161,0)
161
"BLD",7198,4,161,2,0)
^9.641^161.01^1
"BLD",7198,4,161,2,161.01,0)
AUTHORIZATION  (sub-file)
"BLD",7198,4,161,2,161.01,1,0)
^9.6411^104^1
"BLD",7198,4,161,2,161.01,1,104,0)
REFERRING PROVIDER
"BLD",7198,4,161,222)
y^n^p^^^^n^^n
"BLD",7198,4,161,224)

"BLD",7198,4,162.2,0)
162.2
"BLD",7198,4,162.2,2,0)
^9.641^162.2^1
"BLD",7198,4,162.2,2,162.2,0)
FEE NOTIFICATION/REQUEST  (File-top level)
"BLD",7198,4,162.2,2,162.2,1,0)
^9.6411^17^1
"BLD",7198,4,162.2,2,162.2,1,17,0)
REFERRING PROVIDER
"BLD",7198,4,162.2,222)
y^n^p^^^^n^^n
"BLD",7198,4,162.2,224)

"BLD",7198,4,162.4,0)
162.4
"BLD",7198,4,162.4,2,0)
^9.641^162.4^1
"BLD",7198,4,162.4,2,162.4,0)
VA FORM 10-7078  (File-top level)
"BLD",7198,4,162.4,2,162.4,1,0)
^9.6411^16^2
"BLD",7198,4,162.4,2,162.4,1,15,0)
REFERRING PROVIDER
"BLD",7198,4,162.4,2,162.4,1,16,0)
REFERRING PROVIDER NPI
"BLD",7198,4,162.4,222)
y^n^p^^^^n^^n
"BLD",7198,4,162.4,224)

"BLD",7198,4,"APDD",161,161.01)

"BLD",7198,4,"APDD",161,161.01,104)

"BLD",7198,4,"APDD",162.2,162.2)

"BLD",7198,4,"APDD",162.2,162.2,17)

"BLD",7198,4,"APDD",162.4,162.4)

"BLD",7198,4,"APDD",162.4,162.4,15)

"BLD",7198,4,"APDD",162.4,162.4,16)

"BLD",7198,4,"B",161,161)

"BLD",7198,4,"B",162.2,162.2)

"BLD",7198,4,"B",162.4,162.4)

"BLD",7198,6.3)
19
"BLD",7198,"KRN",0)
^9.67PA^8989.52^19
"BLD",7198,"KRN",.4,0)
.4
"BLD",7198,"KRN",.401,0)
.401
"BLD",7198,"KRN",.402,0)
.402
"BLD",7198,"KRN",.402,"NM",0)
^9.68A^4^4
"BLD",7198,"KRN",.402,"NM",1,0)
FBAA AUTHORIZATION    FILE #161^161^0
"BLD",7198,"KRN",.402,"NM",2,0)
FBNH ENTER 7078    FILE #162.4^162.4^0
"BLD",7198,"KRN",.402,"NM",3,0)
FBCH ENTER REQUEST    FILE #162.2^162.2^0
"BLD",7198,"KRN",.402,"NM",4,0)
FBCH ENTER 7078    FILE #162.4^162.4^0
"BLD",7198,"KRN",.402,"NM","B","FBAA AUTHORIZATION    FILE #161",1)

"BLD",7198,"KRN",.402,"NM","B","FBCH ENTER 7078    FILE #162.4",4)

"BLD",7198,"KRN",.402,"NM","B","FBCH ENTER REQUEST    FILE #162.2",3)

"BLD",7198,"KRN",.402,"NM","B","FBNH ENTER 7078    FILE #162.4",2)

"BLD",7198,"KRN",.403,0)
.403
"BLD",7198,"KRN",.5,0)
.5
"BLD",7198,"KRN",.5,"NM",0)
^9.68A^1^1
"BLD",7198,"KRN",.5,"NM",1,0)
FB REF PROV NPI^^0
"BLD",7198,"KRN",.5,"NM","B","FB REF PROV NPI",1)

"BLD",7198,"KRN",.84,0)
.84
"BLD",7198,"KRN",3.6,0)
3.6
"BLD",7198,"KRN",3.8,0)
3.8
"BLD",7198,"KRN",9.2,0)
9.2
"BLD",7198,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",7198,"KRN",9.8,0)
9.8
"BLD",7198,"KRN",9.8,"NM",0)
^9.68A^13^12
"BLD",7198,"KRN",9.8,"NM",1,0)
FBNHEDAT^^0^B13820385
"BLD",7198,"KRN",9.8,"NM",2,0)
FBNHEAUT^^0^B25443874
"BLD",7198,"KRN",9.8,"NM",4,0)
FBNHEAU1^^0^B5124970
"BLD",7198,"KRN",9.8,"NM",5,0)
FBCHREQ1^^0^B12310672
"BLD",7198,"KRN",9.8,"NM",6,0)
FBAA79A^^0^B22503574
"BLD",7198,"KRN",9.8,"NM",7,0)
FBCH78A^^0^B17933275
"BLD",7198,"KRN",9.8,"NM",8,0)
FBAA79^^0^B22492731
"BLD",7198,"KRN",9.8,"NM",9,0)
FBCH78^^0^B31111171
"BLD",7198,"KRN",9.8,"NM",10,0)
FBCHP78^^0^B33711436
"BLD",7198,"KRN",9.8,"NM",11,0)
FBAADEM1^^0^B13894268
"BLD",7198,"KRN",9.8,"NM",12,0)
FBAAAUT^^0^B13109090
"BLD",7198,"KRN",9.8,"NM",13,0)
FBPCR^^0^B63936182
"BLD",7198,"KRN",9.8,"NM","B","FBAA79",8)

"BLD",7198,"KRN",9.8,"NM","B","FBAA79A",6)

"BLD",7198,"KRN",9.8,"NM","B","FBAAAUT",12)

"BLD",7198,"KRN",9.8,"NM","B","FBAADEM1",11)

"BLD",7198,"KRN",9.8,"NM","B","FBCH78",9)

"BLD",7198,"KRN",9.8,"NM","B","FBCH78A",7)

"BLD",7198,"KRN",9.8,"NM","B","FBCHP78",10)

"BLD",7198,"KRN",9.8,"NM","B","FBCHREQ1",5)

"BLD",7198,"KRN",9.8,"NM","B","FBNHEAU1",4)

"BLD",7198,"KRN",9.8,"NM","B","FBNHEAUT",2)

"BLD",7198,"KRN",9.8,"NM","B","FBNHEDAT",1)

"BLD",7198,"KRN",9.8,"NM","B","FBPCR",13)

"BLD",7198,"KRN",19,0)
19
"BLD",7198,"KRN",19,"NM",0)
^9.68A^^
"BLD",7198,"KRN",19.1,0)
19.1
"BLD",7198,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",7198,"KRN",101,0)
101
"BLD",7198,"KRN",101,"NM",0)
^9.68A^^
"BLD",7198,"KRN",409.61,0)
409.61
"BLD",7198,"KRN",771,0)
771
"BLD",7198,"KRN",870,0)
870
"BLD",7198,"KRN",8989.51,0)
8989.51
"BLD",7198,"KRN",8989.52,0)
8989.52
"BLD",7198,"KRN",8994,0)
8994
"BLD",7198,"KRN","B",.4,.4)

"BLD",7198,"KRN","B",.401,.401)

"BLD",7198,"KRN","B",.402,.402)

"BLD",7198,"KRN","B",.403,.403)

"BLD",7198,"KRN","B",.5,.5)

"BLD",7198,"KRN","B",.84,.84)

"BLD",7198,"KRN","B",3.6,3.6)

"BLD",7198,"KRN","B",3.8,3.8)

"BLD",7198,"KRN","B",9.2,9.2)

"BLD",7198,"KRN","B",9.8,9.8)

"BLD",7198,"KRN","B",19,19)

"BLD",7198,"KRN","B",19.1,19.1)

"BLD",7198,"KRN","B",101,101)

"BLD",7198,"KRN","B",409.61,409.61)

"BLD",7198,"KRN","B",771,771)

"BLD",7198,"KRN","B",870,870)

"BLD",7198,"KRN","B",8989.51,8989.51)

"BLD",7198,"KRN","B",8989.52,8989.52)

"BLD",7198,"KRN","B",8994,8994)

"BLD",7198,"QDEF")
^^^^NO^^^^^^YES
"BLD",7198,"QUES",0)
^9.62^^
"BLD",7198,"REQB",0)
^9.611^4^4
"BLD",7198,"REQB",1,0)
XU*8.0*480^2
"BLD",7198,"REQB",2,0)
FB*3.5*101^2
"BLD",7198,"REQB",3,0)
FB*3.5*51^2
"BLD",7198,"REQB",4,0)
FB*3.5*43^2
"BLD",7198,"REQB","B","FB*3.5*101",2)

"BLD",7198,"REQB","B","FB*3.5*43",4)

"BLD",7198,"REQB","B","FB*3.5*51",3)

"BLD",7198,"REQB","B","XU*8.0*480",1)

"FIA",161)
FEE BASIS PATIENT
"FIA",161,0)
^FBAAA(
"FIA",161,0,0)
161P
"FIA",161,0,1)
y^n^p^^^^n^^n
"FIA",161,0,10)

"FIA",161,0,11)

"FIA",161,0,"RLRO")

"FIA",161,0,"VR")
3.5^FB
"FIA",161,161)
1
"FIA",161,161.01)
1
"FIA",161,161.01,104)

"FIA",162.2)
FEE NOTIFICATION/REQUEST
"FIA",162.2,0)
^FBAA(162.2,
"FIA",162.2,0,0)
162.2DI
"FIA",162.2,0,1)
y^n^p^^^^n^^n
"FIA",162.2,0,10)

"FIA",162.2,0,11)

"FIA",162.2,0,"RLRO")

"FIA",162.2,0,"VR")
3.5^FB
"FIA",162.2,162.2)
1
"FIA",162.2,162.2,17)

"FIA",162.4)
VA FORM 10-7078
"FIA",162.4,0)
^FB7078(
"FIA",162.4,0,0)
162.4I
"FIA",162.4,0,1)
y^n^p^^^^n^^n
"FIA",162.4,0,10)

"FIA",162.4,0,11)

"FIA",162.4,0,"RLRO")

"FIA",162.4,0,"VR")
3.5^FB
"FIA",162.4,162.4)
1
"FIA",162.4,162.4,15)

"FIA",162.4,162.4,16)

"KRN",.402,1175,-1)
0^1
"KRN",.402,1175,0)
FBAA AUTHORIZATION^3080325.0828^^161^^^3080428
"KRN",.402,1175,"%D",0)
^^1^1^2951204^^
"KRN",.402,1175,"%D",1,0)
This template is used for creating new authorizations for Fee Basis.
"KRN",.402,1175,"AR",161.01,55)
1^FBCTAU8
"KRN",.402,1175,"DIAB",2,1,161.01,3)
101;T
"KRN",.402,1175,"DR",1,161)
S FBPRG="";1;I '$D(FBAATT) S Y="";I FBAATT'=3 S Y="";Q;S HID=$S($D(^FBAAA(DA,4)):$P(^(4),"^"),1:"");.5;Q;S NID=X;.6//^S X="TODAY";S Y=$S(HID="":"",HID=NID:"",NID="":.65,1:.7);.65;.7;S NIDR=X;
"KRN",.402,1175,"DR",2,161.01)
S FBAOLD=^FBAAA(DA(1),1,DA,0),FBAALT=$S($P(FBAOLD,"^",13)=2:"Y",$P(FBAOLD,"^",13)=3:"Y",1:""),FBPRG=$P(FBAOLD,"^",3);I FBPRG,FBPRG'=2 W !!,*7,"You are only allowed to edit an outpatient authorization using this option.",!! S Y="";
"KRN",.402,1175,"DR",2,161.01,1)
@1;.01;S FBTODT=X;I $P(FBAOLD,U,2)']"" S Y="@2";I X'>$P(FBAOLD,U,2) S Y="@2";.01////^S X=+FBAOLD;W !,*7,"From Date cannot be later than the To Date!";S Y="@1";@2;
"KRN",.402,1175,"DR",2,161.01,2)
S:'$D(FBAADDYS) FBAADDYS=0 S X1=FBTODT,X2=FBAADDYS D C^%DTC S FBAAX=X;S FBD1=DA;.02//^S X=$E(FBAAX,4,5)_"-"_$E(FBAAX,6,7)_"-"_($E(FBAAX,1,3)+1700);I $P(^FBAAA(DA(1),1,DA,0),"^",7)]"" K DIE("NO^");.03////^S X=$S(FBPRG:FBPRG,1:2);
"KRN",.402,1175,"DR",2,161.01,3)
S FBTYPE=$S(FBPRG:FBPRG,1:2);101T~;104;I $G(X) W !,"REFERRING PROVIDER NPI: ",$$REFNPI^FBCH78(X);@4;.07;S:$$EXTPV^FBAAUTL5(X)'=55 Y="@5";S:$P($$GETSTAT^DGMSTAPI(DA(1)),U,2)="Y" Y="@5";S DIE("NO^")="";
"KRN",.402,1175,"DR",2,161.01,4)
W !,$C(7),"MST POV can't be selected because veteran's MST status is not YES.";S Y="@4";@5;.065;.095;S FBAATT=X;S FBAALT=$S(X=2:"Y",X=3:"Y",1:"");K DIE("NO^");.08;S:X="" Y=.021;.085;S:X="" Y=.021;.086;.021;2;
"KRN",.402,1175,"DR",2,161.01,5)
S:'$D(FBAAASKV) FBAAASKV="N";S:FBAAASKV'="y" Y=100;.04;Q;100////^S X=DUZ;W !!;.096;.097//^S X="NO";1//^S X="YES";S FBAAP79=$S(X["Y":"Y",1:"");I X["Y" S Y="";1///^S X="@";
"KRN",.402,1175,"ROU")
^FBCTAU
"KRN",.402,1175,"ROUOLD")
FBCTAU
"KRN",.402,1184,-1)
0^3
"KRN",.402,1184,0)
FBCH ENTER REQUEST^3080401.111^^162.2^^^3080529
"KRN",.402,1184,"DR",1,162.2)
S FBUP="",FBLG=0;D:FBN CHEK^FBCHREQ;.01;S FBDA=DA;S FBDATE=X;@1;W !;1////^S X=FBCHVEN;S FBVD=X;@2;2;S FBPER=X;3////^S X=DFN;3.5;S FBDOA=X;I 1;4//^S X=FBDOA;S FBADDT=X;W !;S FBBEGDT=X;
"KRN",.402,1184,"DR",1,162.2,1)
S FBPROG=6,FBFLAG=2 D EN1^FBAAUTL2 S:FBLG>0 FBSW=1,Y=7;D TIMCK^FBCHREQ1;S (FBDIAG,FBPHY,FBCHTEL)="";S:FBSW FBOUT=1,Y="";5;S FBDIAG=X;17;I $G(X) W !,"REFERRING PROVIDER NPI: ",$$REFNPI^FBCH78(X);6;S FBPHY=X;S:FBPHY="" Y="@7";6.5;
"KRN",.402,1184,"DR",1,162.2,2)
S FBCHTEL=X;@7;S:'FBN Y=0;7////^S X=DUZ;100////^S X=$S(FBSW:3,1:1);S:'FBSW Y="@99";8////^S X="N";9////^S X=DT;10////^S X=DUZ;@99;S FBUP=1;K FBVENEW;
"KRN",.402,1185,-1)
0^4
"KRN",.402,1185,0)
FBCH ENTER 7078^3080530.1119^^162.4^^^3080424
"KRN",.402,1185,"DR",1,162.4)
.5////^S X=6;9////^S X="I";1////^S X=FBVEN;2////^S X=FBVET;3////^S X=FBFRDT;3.5////^S X=FBDOA;4////^S X=FBTODT;4.5////^S X=FBDOD;5////^S X=FBADMIT;10////^S X=DT;8////^S X=DUZ;6////^S X=FBEST;15////^S X=FBRP;
"KRN",.402,1185,"DR",1,162.4,1)
I $D(^FBAA(161.4,1,0)),$D(^("S")) S:$D(^("S",0)) ^FB7078(DA,1,0)=^(0) F FBI=1:1 Q:'$D(^FBAA(161.4,1,"S",FBI,0))  I $D(^(0)) S ^FB7078(DA,1,FBI,0)=^(0);7;S Y=$S(FBTODT:0,1:12);12////^S X=FBPDIS;9////^S X="I";
"KRN",.402,1193,-1)
0^2
"KRN",.402,1193,0)
FBNH ENTER 7078^3080304.1908^^162.4^^^3080417
"KRN",.402,1193,"DIAB",6,0,162.4,0)
5;"ADMITTING AUTHORITY"
"KRN",.402,1193,"DR",1,162.4)
.5////^S X=7;1////^S X=FBVEN;2////^S X=DFN;3////^S X=FBBEGDT;4////^S X=FBENDDT;5ADMITTING AUTHORITY~;10////^S X=DT;8////^S X=DUZ;6////^S X=FBDEFP;9////^S X="C";15////^S X=FBRP;
"KRN",.5,242,-1)
0^1
"KRN",.5,242,0)
FB REF PROV NPI
"KRN",.5,242,1)
S X=$$REFNPI^FBCH78(X)
"KRN",.5,242,3)
1
"KRN",.5,242,9)
Returns the NPI for this REFERRING PROVIDER in file 162.4 VA FORM 10-7078
"MBREQ")
0
"ORD",4,.5)
.5;4;;;EDEOUT^DIFROMSO(.5,DA,"",XPDA);FPRE^DIFROMSI(.5,"",XPDA);EPRE^DIFROMSI(.5,DA,"",XPDA,"",OLDA);;EPOST^DIFROMSI(.5,DA,"",XPDA)
"ORD",4,.5,0)
FUNCTION
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",60,-1)
1^1
"PKG",60,0)
FEE BASIS^FB
"PKG",60,20,0)
^9.402P^1^1
"PKG",60,20,1,0)
2^^FBPMRG
"PKG",60,20,1,1)

"PKG",60,20,"B",2,1)

"PKG",60,22,0)
^9.49I^1^1
"PKG",60,22,1,0)
3.5
"PKG",60,22,1,"PAH",1,0)
103^3080530
"PKG",60,22,1,"PAH",1,1,0)
^^2^2^3080530
"PKG",60,22,1,"PAH",1,1,1,0)
Add the Referring Provider NPI Information to 10-7078 and 10-7079
"PKG",60,22,1,"PAH",1,1,2,0)
Fee Authorization Forms.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
12
"RTN","FBAA79")
0^8^B22492731^B21933465
"RTN","FBAA79",1,0)
FBAA79 ;AISC/GRR-PRINT FORM 7079 REQUEST FOR OUTPATIENT MEDICAL SERVICES ;7/NOV/2006
"RTN","FBAA79",2,0)
 ;;3.5;FEE BASIS;**12,23,101,103**;JAN 30, 1995;Build 19
"RTN","FBAA79",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAA79",4,0)
 W !,"Print 7079's for: " D DT^DICRW,DATE^FBAAUTL G:FBPOP END D SITEP^FBAAUTL G:FBPOP END
"RTN","FBAA79",5,0)
 I '$D(^FBAAA("AF",2)) W !!,*7,"There are no 7079's to be printed!",! G END
"RTN","FBAA79",6,0)
 S FBAASCR=""
"RTN","FBAA79",7,0)
RDHOW W ! S DIR("A")="Want only those that have not yet been printed",DIR("B")="Yes",DIR(0)="Y" D ^DIR K DIR G END:$D(DIRUT) S:Y FBAASCR="Y"
"RTN","FBAA79",8,0)
 D OUTPUT^FBAAS79
"RTN","FBAA79",9,0)
 S VAR="BEGDATE^ENDDATE^FBAASCR",VAL=BEGDATE_"^"_ENDDATE_"^"_FBAASCR,PGM="START^FBAA79",IOP="Q" D ZIS^FBAAUTL G:FBPOP END
"RTN","FBAA79",10,0)
START D SITEP^FBAAUTL G END:FBPOP
"RTN","FBAA79",11,0)
 S UL="",ULL="----------",FBPG=0 F Z=1:1:12 S UL=UL_ULL
"RTN","FBAA79",12,0)
 U IO S FBAASCR=$S(FBAASCR="":"I 1",FBAASCR="Y":"I $S('$D(^FBAAA(DFN,1,FBK,1)):1,$P(^FBAAA(DFN,1,FBK,1),""^"",2)']"""":1,1:0)",1:"I 1")
"RTN","FBAA79",13,0)
 S FBJ=BEGDATE-.001,(DFN,FBK)=0 F ZZ=0:0 S FBJ=$O(^FBAAA("AF",2,FBJ)) Q:FBJ'>0!(FBJ>ENDDATE)  F  S DFN=$O(^FBAAA("AF",2,FBJ,DFN)) Q:DFN'>0  F  S FBK=$O(^FBAAA("AF",2,FBJ,DFN,FBK)) Q:FBK'>0  X FBAASCR I  D GOT
"RTN","FBAA79",14,0)
END K FBJ,FBK,DFN,Z,FBS,V,FBI,FBPATT,FBPG,FBSITE,UL,ULL,POV,NOV,POS,CC,PSTCD,SSTCD,VSTCD,BEGDATE,ENDDATE,PIDC,REF,VDX,CODE,STATCD,D,FBAASCR,FBDX,FBIDC,FBOUT,FBPDX,FBREM,FBRR,NAME,PGM,POW,VAL,VAR,VFN,VFROM,VTO,YOB,ZZ
"RTN","FBAA79",15,0)
 K FB7078,FBAABDT,FBAAEDT,FBASSOC,FBLOC,FBPOV,FBPSA,FBPT,FBTT,FBTYPE,FBVEN,FTP,CNT,FBAAOUT,FBAUT,FBPROG,I,J,M,PI,Q,SEX,SSN,TA,DATE,S,Y,DA,DIC
"RTN","FBAA79",16,0)
 D CLOSE^FBAAUTL Q
"RTN","FBAA79",17,0)
 Q
"RTN","FBAA79",18,0)
 ;
"RTN","FBAA79",19,0)
 ; Utilize new API for Name Standardization
"RTN","FBAA79",20,0)
 ;
"RTN","FBAA79",21,0)
GOT Q:'$D(^DPT(DFN,0))
"RTN","FBAA79",22,0)
 S Y(0)=^DPT(DFN,0)
"RTN","FBAA79",23,0)
 D
"RTN","FBAA79",24,0)
 .N FBNAMES
"RTN","FBAA79",25,0)
 .S FBNAMES("FILE")=2,FBNAMES("IENS")=DFN_",",FBNAMES("FIELD")=.01
"RTN","FBAA79",26,0)
 .S NAME=$$NAMEFMT^XLFNAME(.FBNAMES)
"RTN","FBAA79",27,0)
 S SEX=$P(Y(0),U,2)
"RTN","FBAA79",28,0)
 S SSN=$TR($$SSNL4^FBAAUTL($$SSN^FBAAUTL(DFN)),"-",""),YOB=$S($P(Y(0),U,3)]"":$E($P(Y(0),U,3),1,3)+1700,1:""),POS=$S($D(^DPT(DFN,.32)):$P(^(.32),"^",3),1:""),POS=$S(POS]"":$P(^DIC(21,POS,0),"^",3),1:"")
"RTN","FBAA79",29,0)
 F I=1:1:7 S FBI(I)=""
"RTN","FBAA79",30,0)
 I $D(^DPT(DFN,.11)) F I=1:1:7 S FBI(I)=$P(^(.11),"^",I)
"RTN","FBAA79",31,0)
 S POW=$P($G(^DPT(DFN,.52)),"^",5)
"RTN","FBAA79",32,0)
 Q:'$D(^FBAAA(DFN,1,FBK))  S Y(0)=^(FBK,0),VFROM=$P(Y(0),"^",1),VTO=$P(Y(0),"^",2),VFN=$P(Y(0),"^",4) I $S($P(Y(0),"^",3)=6:1,$P(Y(0),"^",3)=7:1,1:"") Q
"RTN","FBAA79",33,0)
 S VDX=$P(Y(0),"^",8),FBPATT=$P(Y(0),"^",18),POV=$$EXTPV^FBAAUTL5($P(Y(0),"^",7)),CODE=$P(Y(0),"^",13),PIDC=$P(Y(0),"^",12),REF=$P(Y(0),"^",21)
"RTN","FBAA79",34,0)
 S NOV=$P($G(^FBAAA(DFN,1,FBK,1)),"^")
"RTN","FBAA79",35,0)
 S FBDX=$G(^FBAAA(DFN,1,FBK,3))
"RTN","FBAA79",36,0)
 S FBIDC=$P($G(^FBAAA(DFN,4)),"^")
"RTN","FBAA79",37,0)
 S STATCD=FBI(5),CC=FBI(7) F V=1:1:14 S V(V)=""
"RTN","FBAA79",38,0)
 S CC=$S(CC']"":"",$D(^DIC(5,+STATCD,1,CC,0)):$P(^(0),"^",3),1:"")
"RTN","FBAA79",39,0)
 S Y(0)=$S(VFN']"":"",'$D(^FBAAV(VFN,0)):"",$D(^FBAAV(VFN,0)):^(0),1:"") G:$S(VFN']"":1,'$D(^FBAAV(VFN,0)):1,1:0) OVR
"RTN","FBAA79",40,0)
 F V=2,1,3,14,4,5,6,10 S V(V)=$P(Y(0),"^",V)
"RTN","FBAA79",41,0)
OVR F S=1:1:9 S FBS(S)=$P(FBSITE(0),"^",S)
"RTN","FBAA79",42,0)
 S VSTCD=$S(V(5)']"":"  ",$D(^DIC(5,V(5),0)):$P(^(0),"^",2),1:"  "),SSTCD=$S(FBS(5)']"":"  ",$D(^DIC(5,+FBS(5),0)):$P(^(0),"^",2),1:"  "),PSTCD=$S(FBI(5)']"":"  ",$D(^DIC(5,+FBI(5),0)):$P(^(0),"^",2),1:"  ")
"RTN","FBAA79",43,0)
 W:FBPG @IOF W UL,!,?46,"Department of Veterans Affairs",?100,"ID Card Number: ",FBIDC,!,?35,"R E Q U E S T   F O R   O U T P A T I E N T   S E R V I C E S",!,UL S FBREM=0,FBOUT=0
"RTN","FBAA79",44,0)
 ;
"RTN","FBAA79",45,0)
 W !,"(1) Veterans Name",?31,"|(2) ID Number | Period of Validity",!,?31,"|",?46,"|"
"RTN","FBAA79",46,0)
 W !,NAME,?31,"|",?32,SSN,?46,"|"," FROM: ",$$FMTE^XLFDT(VFROM),"   TO: ",$$FMTE^XLFDT(VTO),!,UL
"RTN","FBAA79",47,0)
 W !,"(3) ADDRESS",?31,"|DATE OF ISSUE",?46,"| CONDITIONS FOR WHICH SERVICES ARE REQUESTED (DESCRIPTION OF DISABILITY)",!,?31,"|",?46,"|"
"RTN","FBAA79",48,0)
 W !,FBI(1),?31,"|",?33,$$FMTE^XLFDT(FBJ),?46,"|","  ",VDX S FBPDX=0
"RTN","FBAA79",49,0)
 I FBI(2)]"" W !,FBI(2),?31,"|",?46,"|","  " S FBPDX=FBPDX+1 W ?48,$P(FBDX,"^",FBPDX)
"RTN","FBAA79",50,0)
 I FBI(3)]"" W !,FBI(3),?31,"|",?46,"|","  " S FBPDX=FBPDX+1 W ?48,$P(FBDX,"^",FBPDX)
"RTN","FBAA79",51,0)
 W !,FBI(4)," ",PSTCD," ",FBI(6),?31,"|",?46,"|" S FBPDX=FBPDX+1 W ?48,$P(FBDX,"^",FBPDX),!,$E(UL,1,45),?46,"|" S FBPDX=FBPDX+1 W ?48,$P(FBDX,"^",FBPDX)
"RTN","FBAA79",52,0)
 W !,"Name and Address of Fee Participant",?46,"|" S FBPDX=FBPDX+1 W ?48,$P(FBDX,"^",FBPDX)
"RTN","FBAA79",53,0)
 W !,?46,"|",!,V(1),?46,"|",!,V(3),?46,"|" W:V(14)]"" !,V(14),?46,"|"
"RTN","FBAA79",54,0)
 ; PRXM/KJH - Patch 103. Add Referring Provider and NPI to the display.
"RTN","FBAA79",55,0)
 W !,V(4)," ",VSTCD," ",V(6),?46,"|","REFERRING PROVIDER: "
"RTN","FBAA79",56,0)
 I REF'="" W $$GET1^DIQ(200,REF,.01)
"RTN","FBAA79",57,0)
 W !,V(2),?46,"|","NPI: ",$$REFNPI^FBCH78(REF,"",1)
"RTN","FBAA79",58,0)
 W !,?46,"|","AUTHORIZATION #: ",DFN,"-",FBK,!,UL,!
"RTN","FBAA79",59,0)
 W ?49,"AUTHORIZATION REMARKS",!,?49,$E(UL,1,21)
"RTN","FBAA79",60,0)
 D ^FBAA79A S $P(^FBAAA(DFN,1,FBK,1),"^",2)=DT,FBPG=1 Q
"RTN","FBAA79A")
0^6^B22503574^B17873236
"RTN","FBAA79A",1,0)
FBAA79A ;AISC/GRR-PRINT 7079 CONTINUED ;1/12/98
"RTN","FBAA79A",2,0)
 ;;3.5;FEE BASIS;**12,103**;JAN 30, 1995;Build 19
"RTN","FBAA79A",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAA79A",4,0)
 S DIWL=1,DIWF="WC120" K ^UTILITY($J,"W")
"RTN","FBAA79A",5,0)
 I $D(^FBAAA(DFN,1,FBK,2)) F FBRR=0:0 S FBRR=$O(^FBAAA(DFN,1,FBK,2,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBAA79A",6,0)
 D ^DIWW:$D(FBXX) K FBXX
"RTN","FBAA79A",7,0)
 W !,?40,"FOR VA USE ONLY",!,UL
"RTN","FBAA79A",8,0)
 W !," (5) STATE CODE | (6) COUNTY CODE | (7) TYPE OF | (8) YEAR OF BIRTH | (9) WAR | (10) PURPOSE |",!,?16,"|",?34,"|",?37,"PATIENT",?48,"|",?68,"|",?78,"|",?93,"|"
"RTN","FBAA79A",9,0)
 W !,?7,FBI(5),?16,"|",?23,CC,?34,"|",?41,FBPATT,?48,"|",?58,YOB,?68,"|",?74,POS,?78,"|",?87,POV,?93,"|",!,UL
"RTN","FBAA79A",10,0)
 W !,"STATION OF JURISDICTION",?48,"|",?78,"|",?80," (11) CODE",?100,"| (12) SEX",!,?48,"|",?78,"|",?100,"|","  ",$S(SEX="F":"FEMALE",1:"MALE")
"RTN","FBAA79A",11,0)
 W !,"Veterans Administration",?48,"|",?78,"|",?100,"|",$E(UL,101,120)
"RTN","FBAA79A",12,0)
 W !,FBS(2),?48,"|",?78,"|",?80,$S(CODE=1:"SHORT TERM - 1",CODE=2:"HOME NURSING - 2",CODE=3:"ID CARD STATUS - 3",1:""),?100,"| (13) POW"
"RTN","FBAA79A",13,0)
 W:FBS(3)]"" !,FBS(3),?48,"|",?78,"|",?100,"|","  ",$S(POW="Y":"YES",1:"NO")
"RTN","FBAA79A",14,0)
 W !,FBS(4)," ",SSTCD," ",FBS(6),?48,"|",?78,"|",?100,"|" W:FBS(3)']"" "  ",$S(POW="Y":"YES",1:"NO") W !,?48,$E(UL,49,120)
"RTN","FBAA79A",15,0)
 W !,?48,"| APPROVED BY (Name and Title)",?110,"(",$S($D(^VA(200,DUZ,0)):$P(^(0),"^",2),1:""),")",!,?48,"|"
"RTN","FBAA79A",16,0)
 W !,"TELEPHONE: ",FBS(7),?48,"|",?50,FBS(8),!,?48,"|",?50,FBS(9),!,UL
"RTN","FBAA79A",17,0)
 W !,?32,"Information On Veterans Administration Program",!
"RTN","FBAA79A",18,0)
 W !,"Acceptance of this request to render the prescribed services will constitute an agreement which is subject",!,"to the following: ",!
"RTN","FBAA79A",19,0)
 W !,?3,"I. SERVICES. If services are not initiated, please return this document to the Station of Jurisdiction with a brief"
"RTN","FBAA79A",20,0)
 W !,?5,"explanation. Unless approved by the VA, services are limited in type and extent to those shown.",!
"RTN","FBAA79A",21,0)
 W !,?3,"II. PERIOD OF VALIDITY. Service must be performed within the period of validity indicated.",!,?5,"If a longer time is needed, please request an extension.",!
"RTN","FBAA79A",22,0)
 W !,?3,"III. REPORTS. Clinical reports are required when an examination only has been requested. Please ",!,?5,"submit reports promptly to the Station Of Jurisdiction.",!
"RTN","FBAA79A",23,0)
 W !,?3,"IV. STATEMENT OF ACCOUNTS. Submit a Statement of Account in your usual manner. Your statement must",!,?5,"include: (1) Patient's Name; (2) Identification NO.; (3) Treatment (CPT) and Dates Rendered; and (4) Fees.",!
"RTN","FBAA79A",24,0)
 W !,?3,"V. FEES. Fees claimed may not exceed those made to the general public for like services.",!
"RTN","FBAA79A",25,0)
 W !,?3,"VI. PAYMENT. Payment by the VA for services rendered and approved is payment in full.",!
"RTN","FBAA79A",26,0)
 W !,?3,"VII. HOSPITALIZATION. When a need for hospital care is indicated, please call the Station of Jurisdiction",!,?5,"for assistance in admitting the veteran to a VA hospital.",!
"RTN","FBAA79A",27,0)
 W !,?3,"VIII. INQUIRIES. Additional information when required may be obtained by contacting the Station Of Jurisdiction.",!
"RTN","FBAA79A",28,0)
 W !,?3,"IX. When submitting claims for payment you must include the NPI and Taxonomy Code of the rendering practitioner, and"
"RTN","FBAA79A",29,0)
 W !,?5,"the NPI and Taxonomy Code of your organization.  If, under the HIPAA NPI Final Rule"
"RTN","FBAA79A",30,0)
 W !,?5,"[http://www.cms.hhs.gov/NationalProvIdentStand], your organization is an ""atypical"" provider furnishing services such as"
"RTN","FBAA79A",31,0)
 W !,?5,"taxi, home and vehicle modifications, insect control, habilitation, and respite services and is therefore ineligible"
"RTN","FBAA79A",32,0)
 W !,?5,"for an NPI, it is important that you indicate ""Ineligible for NPI"" on your claim form ."
"RTN","FBAA79A",33,0)
 W !,UL
"RTN","FBAA79A",34,0)
 W !?3,"VA Form 10-7079"
"RTN","FBAA79A",35,0)
 W ?85,"Date Printed: ",$$FMTE^XLFDT(DT),!
"RTN","FBAA79A",36,0)
 Q
"RTN","FBAAAUT")
0^12^B13109090^B12777604
"RTN","FBAAAUT",1,0)
FBAAAUT ;AISC/DMK - ENTER/EDIT AUTHORIZATION ;3/11/1999
"RTN","FBAAAUT",2,0)
 ;;3.5;FEE BASIS;**13,95,103**;JAN 30, 1995;Build 19
"RTN","FBAAAUT",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAAAUT",4,0)
 D SITEP^FBAAUTL G Q:FBPOP S FBAADDYS=+$P(FBSITE(0),"^",13),FBAAASKV=$P(FBSITE(1),"^",1),FBPROG=$S($P(FBSITE(1),"^",6)="":"I 1",1:"I $P(^(0),U,3)=2")
"RTN","FBAAAUT",5,0)
 W ! S DIC="^DPT(",DIC(0)="QEAZM" D ^DIC G Q:Y<0 S DFN=+Y
"RTN","FBAAAUT",6,0)
 I $P($G(^DPT(DFN,.361)),"^")="" W !!,"ELIGIBILITY HAS NOT BEEN DETERMINED NOR PENDING, CANNOT ENTER AN AUTHORIZATION." G FBAAAUT
"RTN","FBAAAUT",7,0)
CONT I $P($G(^DPT(DFN,.32)),"^",4)=2 W !!?4,"VETERAN HAS A DISHONORABLE DISCHARGE, " S X=$P($G(^(.321)),"^") W $S(X="Y":"ONLY ELIGIBLE FOR AGENT ORANGE EXAM.",1:"NOT ELIGIBLE FOR BENEFITS.")
"RTN","FBAAAUT",8,0)
 W ! S DIR("A")="Do you want to continue",DIR(0)="Y",DIR("B")="Yes" D ^DIR K DIR G FBAAAUT:$S($D(DIRUT):1,'Y:1,1:0)
"RTN","FBAAAUT",9,0)
1 S DA=DFN I '$D(^FBAAA(DA,0)) L +^FBAAA(DA) K DD,DO S (X,DINUM)=DA,DIC="^FBAAA(",DIC(0)="LM",DLAYGO=161 D FILE^DICN L -^FBAAA(DFN) K DIC G:Y<0 Q
"RTN","FBAAAUT",10,0)
 S:'$D(^FBAAA(DFN,1,0)) ^(0)="^161.01D^^"
"RTN","FBAAAUT",11,0)
 D ^FBAADEM K DIRUT,DIROUT,DTOUT,DUOUT
"RTN","FBAAAUT",12,0)
2 W ! S (HID,NID,FBAAP79,FBANEW)="",DA=DFN,DIE="^FBAAA(",DIE("NO^")="",DR="[FBAA AUTHORIZATION]" D ^DIE I $D(FBD1) S FBANEW=$G(^FBAAA(DFN,1,FBD1,0))
"RTN","FBAAAUT",13,0)
 D:'$D(Y)&(HID'="")&(HID'=NID) TRIG K HID,NID,NIDR,TIME G FBAAAUT:FBANEW']"" S X=FBANEW,K=FBD1,J=DT
"RTN","FBAAAUT",14,0)
 I FBAAP79="Y" S $P(^FBAAA(DFN,1,FBD1,1),"^",2)="",FBDFN=DFN D CHEKP79 S DFN=FBDFN
"RTN","FBAAAUT",15,0)
 I $D(FBAOLD),FBAOLD'=FBANEW,$D(FBAALT),FBAALT="Y" S FBTTYPE="A",FBMST=$S($P(FBANEW,"^",13)=1:"Y",1:""),FBFDC=$S($P(FBAOLD,"^")'=$P(FBANEW,"^"):1,1:"") D MORE
"RTN","FBAAAUT",16,0)
 I '$D(^FBAAC(DFN,0)) K DD,DO S (X,DINUM)=DFN,DIC(0)="L",DLAYGO=162,DIC="^FBAAC(" D FILE^DICN K DIC,DLAYGO
"RTN","FBAAAUT",17,0)
 G FBAAAUT
"RTN","FBAAAUT",18,0)
TRIG ;Add an entry in Fee Basis ID Card Audit file
"RTN","FBAAAUT",19,0)
 I '$D(^FBAA(161.83,DFN)) K DD,DO S (X,DINUM)=DFN,DIC="^FBAA(161.83,",DIC(0)="L",DLAYGO=161.83 D FILE^DICN Q:Y<0
"RTN","FBAAAUT",20,0)
 S:'$D(^FBAA(161.83,DFN,1,0)) ^(0)="^161.831DA^^"
"RTN","FBAAAUT",21,0)
 S %DT="XT",X="NOW" D ^%DT K %DT S TIME=Y
"RTN","FBAAAUT",22,0)
 L +^FBAA(161.83,DFN) S DIC="^FBAA(161.83,"_DFN_",1,",DIC(0)="LM",DINUM=9999999.9999-TIME,X=TIME,DIC("DR")="1////^S X=HID;2////^S X=NIDR;3////^S X=DUZ",DA(1)=DFN K DD,DO D FILE^DICN I Y<0 L -^FBAA(161.83,DFN) Q
"RTN","FBAAAUT",23,0)
 K DIE,DIC,DA,DLAYGO L -^FBAA(161.83,DFN)
"RTN","FBAAAUT",24,0)
 Q
"RTN","FBAAAUT",25,0)
ENT ;ENTRY POINT FROM ^FBAAPM TO CREATE MRA TRANSACTION
"RTN","FBAAAUT",26,0)
MORE ;
"RTN","FBAAAUT",27,0)
 S DIC="^FBAA(161.26,",DIC(0)="L",DLAYGO=161.26,X=DFN
"RTN","FBAAAUT",28,0)
 S DIC("DR")="1///^S X=""P"";2///^S X=FBD1;3///^S X=FBTTYPE;5////^S X=FBFDC;6////^S X=FBMST"
"RTN","FBAAAUT",29,0)
 K DD,DO D FILE^DICN K DIC,DLAYGO S DA=+Y
"RTN","FBAAAUT",30,0)
 Q
"RTN","FBAAAUT",31,0)
 ;
"RTN","FBAAAUT",32,0)
CHEKP79 W ! S DIR("A")="Want to Print 7079 for this patient now",DIR(0)="Y",DIR("B")="No" D ^DIR K DIR I Y S FBK=FBD1 D EN1^FBAAS79
"RTN","FBAAAUT",33,0)
 Q
"RTN","FBAAAUT",34,0)
Q K DA,DAT,DFN,DR,F,FBAASKV,FBAADDYS,FBAALT,FBAAP79,FBAATT,FBANEW,FBAOLD,FBCOUNTY,FBDX,FBI,FBRR,FBSITE,FBTYPE,FBXX,I,J,K,PI,S,T,Z,ZZ,FBAAASKV,FBPROG,DIC,DIE,FBAAX,X,Y,PTYPE,FBPRG,FBAAOUT,FBDFN
"RTN","FBAAAUT",35,0)
 K FBAUT,FBD1,FBPOP
"RTN","FBAAAUT",36,0)
 Q
"RTN","FBAAAUT",37,0)
 ;
"RTN","FBAAAUT",38,0)
 ; PROVIDER LOOKUP
"RTN","FBAAAUT",39,0)
 ;
"RTN","FBAAAUT",40,0)
 ; This function checks the inputed File 200 entry to ensure that it has been assigned the Security Key PROVIDER.
"RTN","FBAAAUT",41,0)
 ; 
"RTN","FBAAAUT",42,0)
 ; Referenced: AUTHORIZATION Sub-File (#161.01) OF FEE BASIS PATIENT File (#161) - REFERRING PROVIDER Field (#104)
"RTN","FBAAAUT",43,0)
 ; Referenced: FEE NOTIFICATION/REQUEST File (#162.2) - REFERRING PROVIDER Field (#17)
"RTN","FBAAAUT",44,0)
 ; Referenced: VA FORM 10-7078 File (#162.4) - REFERRING PROVIDER Field (#15)
"RTN","FBAAAUT",45,0)
 ; 
"RTN","FBAAAUT",46,0)
 ;  Input - FB200IEN - Internal IEN of file 200 entry
"RTN","FBAAAUT",47,0)
 ; Output - 0 Blank Input or entry without PROVIDER Security Key
"RTN","FBAAAUT",48,0)
 ;        - 1 Entry PROVIDER Security Key assigned
"RTN","FBAAAUT",49,0)
 ;
"RTN","FBAAAUT",50,0)
PROVIDER(FB200IEN) N Y
"RTN","FBAAAUT",51,0)
 ;
"RTN","FBAAAUT",52,0)
 Q:$G(FB200IEN)="" 0
"RTN","FBAAAUT",53,0)
 ;
"RTN","FBAAAUT",54,0)
 ;Test for PROVIDER Security Key
"RTN","FBAAAUT",55,0)
 I $D(^XUSEC("PROVIDER",FB200IEN)) Q 1
"RTN","FBAAAUT",56,0)
 ;
"RTN","FBAAAUT",57,0)
 ;Entry did not have PROVIDER Security Key
"RTN","FBAAAUT",58,0)
 Q 0
"RTN","FBAADEM1")
0^11^B13894268^B12880120
"RTN","FBAADEM1",1,0)
FBAADEM1 ;AISC/DMK-DISPLAY PATIENT DEMOGRAPHICS ;14MAY92
"RTN","FBAADEM1",2,0)
 ;;3.5;FEE BASIS;**13,51,103**;JAN 30, 1995;Build 19
"RTN","FBAADEM1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAADEM1",4,0)
EN N FBDX,FBFDT,FBI,FBRR,FBT,FBTYPE,FBV,FBZ,PSA
"RTN","FBAADEM1",5,0)
 S:'$D(FBPROG) FBPROG="I 1"
"RTN","FBAADEM1",6,0)
 ;
"RTN","FBAADEM1",7,0)
 S Y=$G(^FBAAA(DFN,4)) W:$P(Y,"^")]"" !,"Fee ID Card #: ",$P(Y,"^"),?40,"Fee Card Issue Date: " S Y=$P(Y,"^",2) D PDF W Y,!
"RTN","FBAADEM1",8,0)
 ;
"RTN","FBAADEM1",9,0)
 I $O(^FBAAA(DFN,1,0)) D  Q:FBAAOUT
"RTN","FBAADEM1",10,0)
 . D HANG:$Y+5>IOSL Q:FBAAOUT
"RTN","FBAADEM1",11,0)
 . W !,"Patient Name: ",VADM(1),?55,"Pt.ID: ",$P(VADM(2),"^",2)
"RTN","FBAADEM1",12,0)
 . W !!,"AUTHORIZATIONS:",!
"RTN","FBAADEM1",13,0)
 . K FBAUT
"RTN","FBAADEM1",14,0)
 . S FBZ=0,FBFDT="9999999"
"RTN","FBAADEM1",15,0)
 . F  S FBFDT=$O(^FBAAA(DFN,1,"B",FBFDT),-1) Q:'FBFDT  D  Q:FBAAOUT
"RTN","FBAADEM1",16,0)
 . . S FBI=0 F  S FBI=$O(^FBAAA(DFN,1,"B",FBFDT,FBI)) Q:'FBI  I $D(^FBAAA(DFN,1,FBI,0)) X FBPROG I  S FBZ=FBZ+1,X=^(0) D  Q:FBAAOUT
"RTN","FBAADEM1",17,0)
 . . . S Y=+X,PSA=$P(X,"^",5),FBT=$P(X,"^",13),FBV=+$P(X,"^",4) D PDF
"RTN","FBAADEM1",18,0)
 . . . W ?3,"(",FBZ,")",?7,"FR: ",Y,?25,"VENDOR: ",$S($D(^FBAAV(FBV,0)):$P(^(0),"^")_" - "_$P(^(0),"^",2),1:"Not Specified")
"RTN","FBAADEM1",19,0)
 . . . S FBDX=$G(^FBAAA(DFN,1,FBI,3)) W !?7,"TO: " S Y=$P(X,"^",2) D PDF W Y,!?25,"Authorization Type: " D
"RTN","FBAADEM1",20,0)
 . . . . S FBTYPE=$P(X,"^",3),FBTYPE=$S(FBTYPE=2:"Outpatient - "_$S(FBT=1:"Short Term",FBT=2:"Home Health",FBT=3:"ID Card",1:""),$D(^FBAA(161.8,+FBTYPE,0)):$P(^(0),"^"),1:"Unknown")
"RTN","FBAADEM1",21,0)
 . . . W FBTYPE W:$P(X,"^",7) !,?11,"Purpose of Visit: ",$P($G(^FBAA(161.82,$P(X,"^",7),0)),"^") I $P(X,"^",9)["FB583(" W !?25,">> Unauthorized Claim <<"
"RTN","FBAADEM1",22,0)
 . . . ; PRXM/KJH - Patch 103. Add Referring Provider and NPI to the display.
"RTN","FBAADEM1",23,0)
 . . . W !?11,"DX: ",$P(X,"^",8) W ?40,"REF: "
"RTN","FBAADEM1",24,0)
 . . . I $P(X,"^",21)'="" W $$GET1^DIQ(200,$P(X,"^",21),.01)
"RTN","FBAADEM1",25,0)
 . . . W !?11,"REF NPI: ",$$REFNPI^FBCH78($P(X,"^",21)),!
"RTN","FBAADEM1",26,0)
 . . . W:$P(FBDX,"^")]"" !?15,$P(FBDX,"^") W:$P(FBDX,"^",2)]"" !?15,$P(FBDX,"^",2)
"RTN","FBAADEM1",27,0)
 . . . S FBAUT($P(X,"^"))=$P(X,"^",2)
"RTN","FBAADEM1",28,0)
 . . . W !?7,"County: ",FBCOUNTY,?40,"PSA: ",$S($D(^DIC(4,+PSA,0)):$P(^(0),"^"),1:"Unknown"),!
"RTN","FBAADEM1",29,0)
 . . . S FBDEL=$G(^FBAAA(DFN,1,FBI,"ADEL")) I FBDEL]"" S Y=$P(FBDEL,"^",2) D PDF W ?12,">> DELETE MRA SENT TO AUSTIN ON - ",Y," >>",!
"RTN","FBAADEM1",30,0)
 . . . I $D(^FBAAA(DFN,1,FBI,2,0)) K ^UTILITY($J,"W") S DIWL=15,DIWR=70,DIWF="W" D HANG:$Y+6>IOSL Q:FBAAOUT  W !?11,"REMARKS:" D
"RTN","FBAADEM1",31,0)
 . . . . S FBRR=0 F  S FBRR=$O(^FBAAA(DFN,1,FBI,2,FBRR)) Q:'FBRR  S (FBXX,X)=^(FBRR,0) D ^DIWP
"RTN","FBAADEM1",32,0)
 . . . D ^DIWW:$D(FBXX) K FBXX W !
"RTN","FBAADEM1",33,0)
 . . . K X,FBDX,FBT,FBTYPE,FBV,PSA D HANG:$Y+5>IOSL
"RTN","FBAADEM1",34,0)
 ;
"RTN","FBAADEM1",35,0)
 D HANG:$Y+5>IOSL Q:FBAAOUT
"RTN","FBAADEM1",36,0)
 ;
"RTN","FBAADEM1",37,0)
 I $O(^FBAAA(DFN,2,0))>0 D  Q:FBAAOUT
"RTN","FBAADEM1",38,0)
 . W !,"VENDOR CONTACTS:"
"RTN","FBAADEM1",39,0)
 . S (FBZ,FBI)=0
"RTN","FBAADEM1",40,0)
 . F  S FBI=$O(^FBAAA(DFN,2,FBI)) Q:'FBI!(FBAAOUT)  S FBZ=FBZ+1,X=$G(^(FBI,0)),Y=+X D PDF D
"RTN","FBAADEM1",41,0)
 . . W !?3,"(",FBZ,")",?7,"DATE: ",Y,?25,"VENDOR: ",$P(X,"^",2),?55,"PHONE: ",$S($P(X,"^",3)]"":$P(X,"^",3),1:"Not Found")
"RTN","FBAADEM1",42,0)
 . . I $D(^FBAAA(DFN,2,FBI,1,0)) K ^UTILITY($J,"W") S DIWL=20,DIWR=70,DIWF="W" D HANG:$Y+5>IOSL Q:FBAAOUT  W !?11,"NARRATIVE:",! D
"RTN","FBAADEM1",43,0)
 . . . S FBRR=0 F  S FBRR=$O(^FBAAA(DFN,2,FBI,1,FBRR)) Q:'FBRR  S FBXX=^(FBRR,0) D HANG:$Y+5>IOSL Q:FBAAOUT  S X=FBXX D ^DIWP
"RTN","FBAADEM1",44,0)
 . . D ^DIWW:$D(FBXX) K FBXX W !
"RTN","FBAADEM1",45,0)
 Q
"RTN","FBAADEM1",46,0)
 ;
"RTN","FBAADEM1",47,0)
HANG I $E(IOST,1,2)="C-" S DIR(0)="E" D ^DIR K DIR S:'Y FBAAOUT=1
"RTN","FBAADEM1",48,0)
 W @IOF I 'FBAAOUT W !,"Patient Name: ",VADM(1),?55,"Pt.ID: ",$P(VADM(2),"^",2),!
"RTN","FBAADEM1",49,0)
 Q
"RTN","FBAADEM1",50,0)
 ;
"RTN","FBAADEM1",51,0)
PDF S:Y Y=$$FMTE^XLFDT(Y,5)  ; TRANSLATE TO DISPLAY DATE
"RTN","FBAADEM1",52,0)
 Q
"RTN","FBCH78")
0^9^B31111171^B27936825
"RTN","FBCH78",1,0)
FBCH78 ;AISC/DMK-SETS UP 7078/AUTHORIZATION FOR CONTRACT HOSPITAL ;08/07/02
"RTN","FBCH78",2,0)
 ;;3.5;FEE BASIS;**43,103**;JAN 30, 1995;Build 19
"RTN","FBCH78",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBCH78",4,0)
 S DIC("S")="I $P(^(0),U,15)=3&($P(^(0),U,12)=""Y"")" D ASKV^FBCHREQ G END:$E(X)="^"!($E(X)="")!('$D(FBDA))
"RTN","FBCH78",5,0)
 I $P(^FBAA(162.2,FBDA,0),"^",17)]"" W !!,*7,"There already is a 7078 set up for this request.",!,"The number is ",$P(^FB7078($P(^FBAA(162.2,FBDA,0),"^",17),0),"^")," .",! G END
"RTN","FBCH78",6,0)
EN S FBVEN=$P(^FBAA(162.2,FBDA,0),"^",2)_";FBAAV(",FBVET=$P(^(0),"^",4),FBFRDT=$P(^(0),"^",5),FBFRDT=FBFRDT\1,FBDOA=$S($P(^(0),"^",19):$P(^(0),"^",19)\1,1:""),FBDXS=$P(^(0),"^",6)
"RTN","FBCH78",7,0)
 ;FB*3.5*103 ;added FBRP
"RTN","FBCH78",8,0)
 S FBRP=$P($G(^FBAA(162.2,FBDA,2)),"^") K DA
"RTN","FBCH78",9,0)
 W !! S %DT="APEX",%DT("A")="AUTHORIZATION TO DATE: " D ^%DT K %DT G END:X="^" S FBTODT=$S(X="":"",1:Y)
"RTN","FBCH78",10,0)
 I FBTODT]"",FBFRDT>FBTODT W !!,*7,?5,"Authorization To Date must be after Authorization From Date!",! G EN
"RTN","FBCH78",11,0)
 W !! S %DT="APEX",%DT("A")="DATE OF DISCHARGE: ",%DT("B")=$$DATX^FBAAUTL(FBTODT) D ^%DT K %DT G END:X="^" S FBDOD=$S(X="":"",1:Y)
"RTN","FBCH78",12,0)
 I FBDOD]"",FBTODT>FBDOD W !!,*7,?5,"Date of Discharge must not be earlier than the Authorization To Date!",! G EN
"RTN","FBCH78",13,0)
 S DIR(0)="162.4,5",DIR("A")="ADMITTING AUTHORITY" D ^DIR K DIR
"RTN","FBCH78",14,0)
 G END:$D(DIRUT) S FBADMIT=+Y
"RTN","FBCH78",15,0)
 S DIR(0)="162.4,6" D ^DIR K DIR
"RTN","FBCH78",16,0)
 G END:$D(DIRUT) S FBEST=+Y
"RTN","FBCH78",17,0)
FBPDIS I FBTODT="" S DIR(0)="162.4,12" D ^DIR K DIR G END:$D(DUOUT),END:$D(DTOUT),NULL^FBCH780:X="" S FBPDIS=+Y
"RTN","FBCH78",18,0)
 ;
"RTN","FBCH78",19,0)
ASKPT I FBTODT]"" S DIR(0)="SAO^00:SURGICAL;10:MEDICAL;86:PSYCHIATRY",DIR("A")="BEDSECTION/TREATING SPECIALTY: ",DIR("?")="^D HELP^FBCH780" D ^DIR K DIR D NOUP^FBCHCD:$D(DIRUT) G ASKPT:$D(DIRUT) S FBPT=Y
"RTN","FBCH78",20,0)
7078 S PRCS("A")="Select Obligation Number: ",PRCS("TYPE")="FB" D EN1^PRCS58 G:Y=-1 NOGOOD S (X,FBCHOB)=$P(Y,"^",2) K PRCS("A") S PRCS("TYPE")="FB" D EN1^PRCSUT31 G:Y="" NOGOOD S FB7078=$P(FBCHOB,"-",2)_"."_Y S FBSEQ=Y
"RTN","FBCH78",21,0)
 S DIC="^FB7078(",DIC(0)="LQ",DLAYGO=162.4,X=""""_FB7078_"""" D ^DIC G:Y<0 PROB S (DA,FBAA78)=+Y
"RTN","FBCH78",22,0)
 S DIE="^FBAA(162.2,",DA=FBDA,DR="16////^S X=FBAA78" D ^DIE K DIE,DIC,DA,DR
"RTN","FBCH78",23,0)
SET78 S DIE="^FB7078(",DA=FBAA78,DR="[FBCH ENTER 7078]" D ^DIE K DIC,DIE,DR,DA
"RTN","FBCH78",24,0)
 D ^FBCH780 I $G(FBOUT) W !!,*7,"...deleting 7078." D DEL G END
"RTN","FBCH78",25,0)
 I +Y=0 W !!,*7,Y,!,"...deleting 7078.  Use 'Set-up a 7078' after adjusting 1358.",! D DEL G END
"RTN","FBCH78",26,0)
 K DIE,DIC,DA
"RTN","FBCH78",27,0)
 I $G(FBVET) S:'$G(DFN) DFN=FBVET D PTF^FBCH780
"RTN","FBCH78",28,0)
 G SHOW:FBTODT=""
"RTN","FBCH78",29,0)
AUTH D HOME^%ZIS
"RTN","FBCH78",30,0)
 D:'$D(FBSITE(1)) SITEP^FBAAUTL Q:FBPOP  S FBPSA=$S($P(FBSITE(1),"^",3)="":"",$D(^DIC(4,$P(FBSITE(1),"^",3),0)):$P(^(0),"^"),1:"")
"RTN","FBCH78",31,0)
 S FBVEN=$P(FBVEN,";")
"RTN","FBCH78",32,0)
 I '$D(^FBAAA(FBVET,0)) L +^FBAAA(FBVET) K DD,DO S (X,DINUM)=FBVET,DIC="^FBAAA(",DIC(0)="LM",DLAYGO=161 D FILE^DICN L -^FBAAA(FBVET) G:Y<0 END
"RTN","FBCH78",33,0)
 S:'$D(^FBAAA(FBVET,1,0)) ^(0)="^161.01D^^"
"RTN","FBCH78",34,0)
 K DE,DQ,DR,DIE,DLAYGO
"RTN","FBCH78",35,0)
FBDCHG S DIR(0)="161.01,.06" D ^DIR K DIR G END:$D(DTOUT),END:$D(DUOUT) D NULL1^FBCH780:X="" G FBDCHG:X="" S FBDCHG=+Y
"RTN","FBCH78",36,0)
FBPUR S FBTYPE=6,DIR(0)="161.01,.07" D ^DIR K DIR S FBPUR=+Y
"RTN","FBCH78",37,0)
 G END:$D(DTOUT),END:$D(DUOUT)
"RTN","FBCH78",38,0)
FBPSA S DIR(0)="161.01,101" D ^DIR K DIR G END:$D(DTOUT),END:$D(DUOUT) D NULL1^FBCH780:X="" G FBPSA:X="" S FBPSA=+Y
"RTN","FBCH78",39,0)
 ;file entry in authorization multiple of file 161
"RTN","FBCH78",40,0)
 S DIC="^FBAAA("_FBVET_",1,",DIC(0)="LM",DLAYGO=161,DA(1)=FBVET,X=FBFRDT K DD,DO D FILE^DICN G:Y<0 END S DA=+Y,DIE("NO^")="" ;DA(1)=FBVET
"RTN","FBCH78",41,0)
 S FB78=FBAA78_";FB7078("
"RTN","FBCH78",42,0)
 ;FB*3.5*103 ;added FBRP
"RTN","FBCH78",43,0)
 S DIE=DIC,DR=".02////^S X=FBTODT;.03////^S X=6;100////^S X=DUZ;1////^S X=""YES"";.055////^S X=FB78;.06////^S X=FBDCHG;S FBTYPE=6;.04////^S X=FBVEN;.065////^S X=FBPT;101////^S X=FBPSA"
"RTN","FBCH78",44,0)
 S:$G(FBRP)]"" DR=DR_";104////^S X=FBRP"
"RTN","FBCH78",45,0)
 S DR=DR_";.095////^S X=1"
"RTN","FBCH78",46,0)
 S DR(1,161.01,1)="I $D(^FB7078(FBAA78,1,0)) S ^FBAAA(DA(1),1,DA,2,0)=^(0) F FBI=1:1 Q:'$D(^FB7078(FBAA78,1,FBI,0))  I $D(^(0)) S ^FBAAA(DA(1),1,DA,2,FBI,0)=^(0);.07////^S X=FBPUR;.08///^S X=FBDXS;.096;.097//^S X=""N"""
"RTN","FBCH78",47,0)
 D ^DIE K DIE,DR
"RTN","FBCH78",48,0)
 S (DIC,DIE)="^FB7078(",DA=FBAA78,DR="9///^S X=""C"";12///^S X=""@""" D ^DIE K DR,DIE,DA,X
"RTN","FBCH78",49,0)
SHOW W !! S DA=FBAA78,DR="0;1",DIC="^FB7078(" D EN^DIQ
"RTN","FBCH78",50,0)
 ;
"RTN","FBCH78",51,0)
 ;FB*3.5*103 ;added FBRP
"RTN","FBCH78",52,0)
END K D,DA,DIC,DIE,DIR,DLAYGO,DR,FBDA,FB7078,FBAA78,FBPT,FBTYPE,FBVEN,FBZ,FBVET,FBFRDT,FBTODT,J,S,POP,X,Y,DFN,FBCHOB,FBCOMM,FBDFN,FBEST,FBI,FBLENT,FBMENT,FBNAME,FBSEQ,FBSSN,FBSW,I,K,PRC,VAL,FB,FBFLG,ZZ,FBPSA,FBSITE,FB78,FBOUT
"RTN","FBCH78",53,0)
 K FBDCHG,FBPUR,FBPDIS,FBADMIT,FBDXS,A,D0,D1,X1,DIRUT,DTOUT,DUOUT,FBDOA,FBDOD,FBPOP,FBZZ,ZZZ,PRCSCPAN,FBRP
"RTN","FBCH78",54,0)
 Q
"RTN","FBCH78",55,0)
PROB W !!,"The reference number did not get set up with the",!,"IFCAP software. Contact your package coordinator." G END
"RTN","FBCH78",56,0)
NOGOOD S DIR(0)="Y",DIR("A")="Obligation number selected is invalid or you are not a control point user in the IFCAP package!  Try again",DIR("B")="YES" D ^DIR K DIR G END:$D(DIRUT)!'Y,7078
"RTN","FBCH78",57,0)
 ;
"RTN","FBCH78",58,0)
OUTP ;ENTRY TO DISPLAY A 7078
"RTN","FBCH78",59,0)
 ;FB*3.5*103 ; Display the 0 node fields with computed REFERRING PROVIDER NPI, then 1 node fields
"RTN","FBCH78",60,0)
 S DIC="^FB7078(",DIC(0)="AEQM",D="D",DIC("A")="Select Patient: " D IX^DIC
"RTN","FBCH78",61,0)
 G END:X=""!(X="^")
"RTN","FBCH78",62,0)
 S (DA,FBDA)=+Y,DR="0",DIQ(0)="C" W !! D EN^DIQ K DIQ(0)
"RTN","FBCH78",63,0)
 S DA=FBDA,DR="1" D EN^DIQ
"RTN","FBCH78",64,0)
 I $$DISCH^FBCH780(FBDA)]"" W ?2,"DISCHARGE TYPE: ",$$DISCH^FBCH780(FBDA),!
"RTN","FBCH78",65,0)
 G OUTP
"RTN","FBCH78",66,0)
 ;
"RTN","FBCH78",67,0)
REFNPI(IEN200,IEN162P4,CHKAUTH) ;FB*3.5*103
"RTN","FBCH78",68,0)
 ; a new function that returns the REFERRING PROVIDER NPI if it is Active and the provider has authorized use of the NPI
"RTN","FBCH78",69,0)
 ; If is used in both a Fileman function and in other FB routines.
"RTN","FBCH78",70,0)
 ;
"RTN","FBCH78",71,0)
 ; Input
"RTN","FBCH78",72,0)
 ; IEN200 - IEN to file 200 if known
"RTN","FBCH78",73,0)
 ; IEN162P4 (optional) - IEN to File 162.4 (if ref prov is not known)
"RTN","FBCH78",74,0)
 ; CHKAUTH (optional) - Flag on whether to Chek Authorization in file 200
"RTN","FBCH78",75,0)
 ;
"RTN","FBCH78",76,0)
 ; Output
"RTN","FBCH78",77,0)
 ; A valid/active NPI if one can be determined.  Otherwise, nada.
"RTN","FBCH78",78,0)
 ;
"RTN","FBCH78",79,0)
 ; If neither IEN is passed in, there is no NPI coming out
"RTN","FBCH78",80,0)
 I $G(IEN200)<1,$G(IEN162P4)<1 Q ""
"RTN","FBCH78",81,0)
 ;
"RTN","FBCH78",82,0)
 ; If there is no referrring provider IEN passed in, try getting it from the IEN from 162.4 (VA FORM 10-7078)
"RTN","FBCH78",83,0)
 ; return nothing if you can't
"RTN","FBCH78",84,0)
 I $G(IEN200)<1 S IEN200=$$GET1^DIQ(162.4,IEN162P4_",",15,"I") Q:$G(IEN200)<1 ""
"RTN","FBCH78",85,0)
 ;
"RTN","FBCH78",86,0)
 ; Now that we have an IEN to 200 see if we need authorization and have to display/print NPI
"RTN","FBCH78",87,0)
 ; If the return value is less than 1, then we don't have permission or it was not a valid IEN.
"RTN","FBCH78",88,0)
 ; IA#5070
"RTN","FBCH78",89,0)
 I $G(CHKAUTH) Q:+$$GETRLNPI^XUSNPI(IEN200)<1 ""
"RTN","FBCH78",90,0)
 ;
"RTN","FBCH78",91,0)
 ; Go get the NPI for this IEN
"RTN","FBCH78",92,0)
 N NPI S NPI=$$NPI^XUSNPI("Individual_ID",IEN200)
"RTN","FBCH78",93,0)
 ;
"RTN","FBCH78",94,0)
 ; Make sure it is a valid/Active NPI
"RTN","FBCH78",95,0)
 I +NPI<1!($P(NPI,U,3)="Inactive") Q ""
"RTN","FBCH78",96,0)
 Q +NPI
"RTN","FBCH78",97,0)
 ;
"RTN","FBCH78",98,0)
DEL S DA=FBAA78,DIK="^FB7078(" D ^DIK K DIK S DA=$O(^FBAA(162.2,"AM",+FBAA78,0)) I DA S DIE="^FBAA(162.2,",DR="16///@" D ^DIE
"RTN","FBCH78A")
0^7^B17933275^B13886797
"RTN","FBCH78A",1,0)
FBCH78A ;AISC/DMK-PRINT 7078 CONTINUED FROM FBCHP78 ;06FEB89
"RTN","FBCH78A",2,0)
 ;;3.5;FEE BASIS;**103**;JAN 30, 1995;Build 19
"RTN","FBCH78A",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBCH78A",4,0)
HED W:'$G(FBPG) @IOF K:$G(FBPG) FBPG W UL,!,?5,"Department of Veterans Affairs",?58,"AUTHORIZATION AND INVOICE FOR MEDICAL AND HOSPITAL SERVICES",!,UL,!
"RTN","FBCH78A",5,0)
 Q
"RTN","FBCH78A",6,0)
BOT W !,"SPECIAL PROVISIONS: Acceptance of this authorization to render service is governed by the following:",!!
"RTN","FBCH78A",7,0)
 W "1. ACCEPTANCE OF THIS AUTHORIZATION AND PROVIDING OF SUCH TREATMENT OR SERVICES SUBJECTS YOU, THE PROVIDER OF CARE, TO",!,?3,"THE PROVISIONS OF PUBLIC LAW 93-579, THE PRIVACY ACT OF 1974, TO THE EXTENT OF THE RECORDS "
"RTN","FBCH78A",8,0)
 W "PERTAINING TO THE VA",!,?3,"AUTHORIZED TREATMENT OR SERVICES OF THIS VETERAN.",!
"RTN","FBCH78A",9,0)
 W !,"2. Fees or rates listed represent maximum allowance for services specified. In no event should charges be made to the",!,?3,"VA in excess of usual and customary charges to the general public for similar services.",!
"RTN","FBCH78A",10,0)
 W !,"3. Payment by the VA is payment in full for authorized services rendered.",!
"RTN","FBCH78A",11,0)
 W !,"4. Unless otherwise approved by the VA, services are limited in type and extent to those shown on this authorization.",!,?3,"If services are not initiated for any reason, return a copy of the authorization to the issuing ",!
"RTN","FBCH78A",12,0)
 W ?3,"office with a brief explanation.",!
"RTN","FBCH78A",13,0)
 W !,"5. A copy of the Operative Report will be forwarded to the Authorizing station within one week following any major",!,?3,"surgery.",!
"RTN","FBCH78A",14,0)
 W !,"6. A copy of the hospital summary will be forwarded to the authorizing station within ten work days following the ",!,?3,"release of the patient from the hospital.",!
"RTN","FBCH78A",15,0)
 W !,"7. When submitting claims for payment you must include the NPI and Taxonomy Code of the rendering practitioner,"
"RTN","FBCH78A",16,0)
 W !,?3,"and the NPI and Taxonomy Code of your organization.  If, under the HIPAA NPI Final Rule"
"RTN","FBCH78A",17,0)
 W !,?3,"[http://www.cms.hhs.gov/NationalProvIdentStand], your organization is an ""atypical"" provider furnishing services such"
"RTN","FBCH78A",18,0)
 W !,?3,"as taxi, home and vehicle modifications, insect control, habilitation, and respite services and is therefore"
"RTN","FBCH78A",19,0)
 W !,?3,"ineligible for an NPI, it is important that you indicate ""Ineligible for NPI"" on your claim form.",!
"RTN","FBCH78A",20,0)
 W UL,!,?16,"All questions relating to this authorization should be referred to the issuing VA Office",!,UL,!,"VA Form 10-7078" Q
"RTN","FBCH78A",21,0)
 ;
"RTN","FBCH78A",22,0)
FISCAL ;SETS THE FISCAL SYMBOL BLOCK FOR 7078
"RTN","FBCH78A",23,0)
 S PRC("SITE")=FB("SITE"),PRCS("X")=PRC("SITE")_"-"_$P($P(FB(0),"^"),"."),PRCS("TYPE")="FB" D EN1^PRCS58
"RTN","FBCH78A",24,0)
 S FB("SYM")=$P(Y,"^",4)_" "_$P(FB(0),"^")_"  FCP "_$P(Y,U,3) K PRC("SITE"),PRCSI,Y Q
"RTN","FBCH78A",25,0)
 ;
"RTN","FBCH78A",26,0)
CONT(X,Y) ;get contract for CNH authorization
"RTN","FBCH78A",27,0)
 ;X=IEN of vendor
"RTN","FBCH78A",28,0)
 ;Y=from date of authorization
"RTN","FBCH78A",29,0)
 I $S('$G(X):1,'$G(Y):1,1:0) Q ""
"RTN","FBCH78A",30,0)
 I '$O(^FBAA(161.21,"ACR",X,-Y+.9)) Q ""
"RTN","FBCH78A",31,0)
 N Z
"RTN","FBCH78A",32,0)
 S Z=$P(^FBAA(161.21,+$O(^(+$O(^FBAA(161.21,"ACR",X,-Y+.9)),0)),0),U,1,3)
"RTN","FBCH78A",33,0)
 Q $S($P(Z,U,3)>Y:$P(Z,U),1:"")
"RTN","FBCHP78")
0^10^B33711436^B33168184
"RTN","FBCHP78",1,0)
FBCHP78 ;AISC/DMK-GENERATE 7078 ;7/NOV/2006
"RTN","FBCHP78",2,0)
 ;;3.5;FEE BASIS;**12,23,52,101,103**;JAN 30, 1995;Build 19
"RTN","FBCHP78",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBCHP78",4,0)
 I '$D(^FBAA(161.4,1,0)) W !,"Site Parameters must be entered prior",!," to using this option." Q
"RTN","FBCHP78",5,0)
GET78 S DIC="^FB7078(",DIC(0)="AEQMZ",DIC("A")="Select Veteran: ",D="D",DIC("S")="I $P(^(0),U,9)'=""DC""" D IX^DIC G END:X="^"!(X=""),GET78:Y<0 S FB7078=+Y,FB(0)=Y(0) K DIC,D
"RTN","FBCHP78",6,0)
 S DA=FB7078,DIC="^FB7078(",DR=0 D EN^DIQ
"RTN","FBCHP78",7,0)
ASK S DIR(0)="Y",DIR("A")="Is this the correct 7078",DIR("B")="YES" D ^DIR K DIR G END:$D(DIRUT),GET78:'Y
"RTN","FBCHP78",8,0)
 D SITEP^FBAAUTL S FBO=$S($D(FBSITE(1)):$P(FBSITE(1),"^",7),1:""),FBNUM=$S($D(FBSITE(1)):$P(FBSITE(1),"^",5),1:"")
"RTN","FBCHP78",9,0)
 S FBT=$S($D(FBSITE(1)):$P(FBSITE(1),"^",8),1:"")
"RTN","FBCHP78",10,0)
 D FBO G END:$D(DIRUT)
"RTN","FBCHP78",11,0)
 S PRCF("X")="S" D ^PRCFSITE S PRC("SITE")=$S($D(PRC("SITE")):PRC("SITE"),1:"") I PRC("SITE")="" W ! G GET78
"RTN","FBCHP78",12,0)
 S FB("SITE")=PRC("SITE")
"RTN","FBCHP78",13,0)
QUE S VAR="FB7078^FBNUM^FBO^FBT^FB(""SITE"")",VAL=FB7078_"^"_FBNUM_"^"_FBO_"^"_FBT_"^"_FB("SITE"),PGM="START^FBCHP78" D ZIS^FBAAUTL G:FBPOP END
"RTN","FBCHP78",14,0)
 ;
"RTN","FBCHP78",15,0)
START S FB(0)=^FB7078(FB7078,0) S:$E(IOST,1,2)'["C-" FBPG=1 F FBM=1:1:FBNUM D 7078
"RTN","FBCHP78",16,0)
END K DA,DFN,DIC,DINAME,DIRUT,DIWF,DIWL,DR,FB,FB7078,FBFD,FBID,FBNM,FBNUM,FBO,FBRR,FBSITE,FBTD,FBV,FBVEN,FBT,I,L,FBM,PGM,S,UL,VA,VADM,VAEL,VAERR,VAL,VAPA,VAR,X,Y,Z,PRC,PRCS,^UTILITY($J),PRCSCPAN
"RTN","FBCHP78",17,0)
 D CLOSE^FBAAUTL Q
"RTN","FBCHP78",18,0)
 ;
"RTN","FBCHP78",19,0)
7078 U IO S UL="",$P(UL,"-",120)="-",L="|" D HED^FBCH78A
"RTN","FBCHP78",20,0)
 S DFN=$P(^FB7078(FB7078,0),"^",3) G END:'$D(DFN)#2!('$D(^DPT(+DFN,0)))
"RTN","FBCHP78",21,0)
 N FBNAME
"RTN","FBCHP78",22,0)
 S FBNAME("FILE")=2,FBNAME("IENS")=DFN_",",FBNAME("FIELD")=.01
"RTN","FBCHP78",23,0)
 S FBNAME=$$NAMEFMT^XLFNAME(.FBNAME,"F","C")
"RTN","FBCHP78",24,0)
 S VAPA("P")="" D SITEP^FBAAUTL,6^VADPT
"RTN","FBCHP78",25,0)
 N FBCONFAD S FBCONFAD=$$ACTIVECC^FBAACO0() I FBCONFAD,$L($G(VAPA(16))) D
"RTN","FBCHP78",26,0)
 . N FBLEN S FBLEN=$L(VAPA(16))+$L($P($G(VAPA(17)),U,2))+$L($P($G(VAPA(18)),U,2))+3 S:FBLEN>52 FBLEN=$L(VAPA(16))-(FBLEN-52),VAPA(16)=$E(VAPA(16),1,FBLEN)
"RTN","FBCHP78",27,0)
 F FBNM=1:1:7 S FBNM(FBNM)=$P(FBSITE(0),"^",FBNM)
"RTN","FBCHP78",28,0)
 S FBNM(5)=$S($D(^DIC(5,FBNM(5))):$P(^(FBNM(5),0),"^",2),1:"")
"RTN","FBCHP78",29,0)
 S Y=$P(FB(0),"^",10) D DATE S FBID=Y,FBVEN=$P(FB(0),"^",2),(FBVEN,FBV(0))=$P(FBVEN,";",1),FBVEN=$S($D(^FBAAV(FBVEN,0)):$P(^(0),"^",1),1:"Unknown"),FBVEN(1)=$S($D(^FBAAV(FBV(0),0)):$P(^(0),"^",2),1:"")
"RTN","FBCHP78",30,0)
 F I=3:1:6,14 S FBV(I)=$S($D(^FBAAV(FBV(0),0)):$P(^(0),"^",I),1:"")
"RTN","FBCHP78",31,0)
 I FBV(5)]"" S FBV(5)=$S($D(^DIC(5,FBV(5),0)):$P(^(0),"^",2),1:"")
"RTN","FBCHP78",32,0)
 S Y=$P(FB(0),"^",4) D DATE S FBFD=Y,Y=$S($P(FB(0),"^",5)]"":$P(FB(0),"^",5),1:"Disposition") D DATE:Y>0 S FBTD=Y
"RTN","FBCHP78",33,0)
 S FB(6)=$P(FB(0),"^",6) I FB(6)]"" S FB(6)=$S($D(^DIC(43.4,FB(6),0)):$P(^(0),"^",3),1:"")
"RTN","FBCHP78",34,0)
 W "Issuing Office",?66,L,"1. Date of Issue",!,?5,FBNM(1),?66,L,?70,FBID,!,?5,FBNM(2),?66,L,$E(UL,1,52),!,?5,$S(FBNM(3)]"":FBNM(3),1:FBNM(4)_", "_FBNM(5)_" "_FBNM(6)),?66,L,"2. Veteran's Name",!
"RTN","FBCHP78",35,0)
 I FBNM(3)]"" W ?5,FBNM(4)_", "_FBNM(5)_" "_FBNM(6)
"RTN","FBCHP78",36,0)
 W ?66,L,?70,FBNAME,!,UL,!,"Name of Physician or Station",?66,L,"3. Address",!,?5,FBVEN,?66,L,?68,$S(FBCONFAD:VAPA(13),1:VAPA(1)),!,?5,FBV(3),?66,L,?68,$S(FBCONFAD:VAPA(14),1:VAPA(2)),!,?5,FBV(14)
"RTN","FBCHP78",37,0)
 W ?66,L,?68,$S(FBCONFAD:VAPA(15),1:VAPA(3)),!?5,FBV(4)_", "_FBV(5)_" "_FBV(6)
"RTN","FBCHP78",38,0)
 W ?66,L,?68,$S(FBCONFAD:$G(VAPA(16)),1:VAPA(4))_", "_$S(FBCONFAD:$P($G(VAPA(17)),U,2),1:$P(VAPA(5),"^",2))_" "_$S(FBCONFAD:$P($G(VAPA(18)),U,2),'+$G(VAPA(11)):VAPA(6),$P(VAPA(11),U,2)]"":$P(VAPA(11),U,2),1:VAPA(6)),!?5,"ID#: ",FBVEN(1)
"RTN","FBCHP78",39,0)
 W ?66,L,$E(UL,1,53),!,?66,L,?68,"4. Veteran's Claim No.",?93,L,?95,"4A. SSN",!,?66,L,?68,VAEL(7),?93,L,?95,$$SSNL4^FBAAUTL($P(VADM(2),"^",2)),!,?66,L,$E(UL,1,53),!,?66,L,?75,"5. Authorization Valid",!,?66,L,$E(UL,1,53),!
"RTN","FBCHP78",40,0)
 ; next few lines contain changes that display/print the referring provider data  FB*3.5*103
"RTN","FBCHP78",41,0)
 W "Name of VA Referring Provider",?66,L,"From",?93,L,"To",!
"RTN","FBCHP78",42,0)
 W ?5,$$GET1^DIQ(162.4,FB7078_",",15),?50,"NPI: ",$$REFNPI^FBCH78("",FB7078,1)
"RTN","FBCHP78",43,0)
 W ?66,L,?68,FBFD,?93,L,?95,FBTD,!,UL,!,?45,"PART 1. - SERVICES AUTHORIZED",!,UL,!,"6. Services shown below are authorized for the period indicated in Item 5 above.",?104,L,?107,"7. Fee",!
"RTN","FBCHP78",44,0)
 W ?12,"(See Special Provisions below.)",?104,L,"$",!
"RTN","FBCHP78",45,0)
 S DIWL=1,DIWF="WC103" K ^UTILITY($J,"W")
"RTN","FBCHP78",46,0)
 I $D(^FB7078(FB7078,1,0)) F FBRR=0:0 S FBRR=$O(^FB7078(FB7078,1,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBCHP78",47,0)
 D ^DIWW:$D(FBXX) K FBXX
"RTN","FBCHP78",48,0)
 D FISCAL^FBCH78A
"RTN","FBCHP78",49,0)
 W UL,!,"8. Fee Schedule or Contract",?33,L,"9. Authority",?66,L,"9A.",?93,L,"10. Estimated Amount",!?5,$$CONT^FBCH78A(+$P(FB(0),U,2),$P(FB(0),U,4)),?33,L,?35,FB(6),?66,L,?93,L,?95,"$"
"RTN","FBCHP78",50,0)
 K X2 S X=$P(FB(0),"^",7),X3=$L(+X)+2 D COMMA^%DTC K X3 W X,!,UL,!
"RTN","FBCHP78",51,0)
 W "11. Fiscal Symbols",?66,L,"12. Authorized by (Name and Title)",!,?5,FB("SYM"),?66,L,?68,FBO,"  ",FBT,!,UL
"RTN","FBCHP78",52,0)
 D BOT^FBCH78A
"RTN","FBCHP78",53,0)
 Q
"RTN","FBCHP78",54,0)
DATE S Y=$$FMTE^XLFDT(Y) Q
"RTN","FBCHP78",55,0)
 ;
"RTN","FBCHP78",56,0)
FBO S DIR(0)="F^3:45",DIR("A")="Approving Official for 7078",DIR("B")=FBO,DIR("?")="Enter <return> to accept the default or enter a name from 3 to 45 characters in length" D ^DIR K DIR Q:$D(DIRUT)  S FBO=X
"RTN","FBCHP78",57,0)
FBT S DIR(0)="F^3:45",DIR("A")="Title of Approving Official",DIR("B")=FBT,DIR("?")="Enter <return> to accept the default title or enter a title from 3 to 45 characters in length" D ^DIR K DIR Q:$D(DIRUT)  S FBT=X
"RTN","FBCHP78",58,0)
ASKN S DIR(0)="N^1:5",DIR("A")="# of copies of 7078",DIR("B")=FBNUM,DIR("?")="Select a number between 1 and 5.  This number represents the number of copies of the 7078 you would like printed" D ^DIR K DIR Q:$D(DIRUT)  S FBNUM=X
"RTN","FBCHREQ1")
0^5^B12310672^B11459050
"RTN","FBCHREQ1",1,0)
FBCHREQ1 ;AISC/DMK-FEE NOTIFICATION CONT ;31AUG90
"RTN","FBCHREQ1",2,0)
 ;;3.5;FEE BASIS;**103**;JAN 30, 1995;Build 19
"RTN","FBCHREQ1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBCHREQ1",4,0)
VENDOR ;ASK VENDOR FOR NOTIFICATION
"RTN","FBCHREQ1",5,0)
 W ! K FBCHVEN S DIC="^FBAAV(",DIC(0)="AEQLM",DLAYGO=161.2 D ^DIC G END:X=""!(X="^"),VENDOR:Y<0 S (DA,FBCHVEN)=+Y,DIE=DIC I $P(Y,"^",3)=1 S FBVENEW=1 D NEW^FBAAVD K DIC,DIE,DA,DLAYGO Q
"RTN","FBCHREQ1",6,0)
ASKVOK I '$D(FBVENEW) D EN1^FBAAVD S DIR(0)="Y",DIR("A")="Is this the correct vendor",DIR("B")="YES" D ^DIR K DIR G VENDOR:$D(DIRUT)!'Y
"RTN","FBCHREQ1",7,0)
END K DIC,DIE,DLAYGO
"RTN","FBCHREQ1",8,0)
 Q
"RTN","FBCHREQ1",9,0)
TIMCK ;72 hour time check called from FBAA ENTER REQUEST template
"RTN","FBCHREQ1",10,0)
 S X1=$P(^FBAA(162.2,DA,0),"^",1),X=$P(^(0),"^",19),HY=Y,FBSW=""
"RTN","FBCHREQ1",11,0)
 S Y=$E(X1_"000",9,10)-$E(X_"000",9,10)*60+$E(X1_"00000",11,12)-$E(X_"00000",11,12),X2=X,X=$P(X,".",1)'=$P(X1,".",1) D ^%DTC:X S FBX=X*1440+Y
"RTN","FBCHREQ1",12,0)
SURE I FBX>4320 W *7,!!,"This Authorization From Date exceeds the 72 hour notification period. ",!,?8,"Do you want to continue ? No// " R X:DTIME S:X="" X="N" G HELP:X["^" D VALCK^FBAAUTL1 G SURE:'VAL I "Nn"[$E(X,1) S FBSW=1,Y=HY Q
"RTN","FBCHREQ1",13,0)
 S Y=HY Q
"RTN","FBCHREQ1",14,0)
HELP W !,"Entering an '^' is not allowed.  Please answer 'Yes' or 'No'." G SURE
"RTN","FBCHREQ1",15,0)
EN I $D(DA),DA S FBDA(0)=DA,DIE="^FBAA(162.2,",DR=".01////@" D ^DIE
"RTN","FBCHREQ1",16,0)
 I '$D(DA)  W *7,!?3,"...request deleted",! I $D(^FBAA(161.5,FBDA(0),0)) S DA=FBDA(0),DIK="^FBAA(161.5," D ^DIK
"RTN","FBCHREQ1",17,0)
 K DIC,DIE,DIK,DA,X,FBDA,DR,DLAYGO,FBDATE,FBLG,FBN,FBUP,FBVT,VA D END^FBCHREQ
"RTN","FBCHREQ1",18,0)
 Q
"RTN","FBCHREQ1",19,0)
EDIT ;EDIT A REQUEST THAT'S NOT COMPLETE
"RTN","FBCHREQ1",20,0)
 S DIC("S")="I $P(^(0),U,15)'=3" D ASKV^FBCHREQ K DIC("S") G Q:X=""!(X="^") S DA=+Y,FB(0)=^FBAA(162.2,DA,0),FBDOA=$P(FB(0),"^",19),FBFRDT=$P(FB(0),"^",5)
"RTN","FBCHREQ1",21,0)
 ; fb*3.5*103  add REFERRING PROVIDER (162.2,17) to DR string
"RTN","FBCHREQ1",22,0)
 S DIE="^FBAA(162.2,",DR="1;2;3.5;S:X=FBDOA!(X<FBFRDT) Y=""@10"";S FBDOA=X;4////^S X=FBDOA;I 1;@10;4;5;17;I $G(X) W !,""REFERRING PROVIDER NPI: "",$$REFNPI^FBCH78(X);6;S FBCHVEN=X" D ^DIE S FBN(0)=^FBAA(162.2,DA,0)
"RTN","FBCHREQ1",23,0)
 I FB(0)'=FBN(0) S DR="7////^S X=DUZ" D ^DIE
"RTN","FBCHREQ1",24,0)
 I $D(DA),$D(^FBAA(161.5,DA,0)) D
"RTN","FBCHREQ1",25,0)
 .I FB(0)'=FBN(0) S $P(^FBAA(161.5,DA,0),"^",2)=$P(FBN(0),"^",2),$P(^(0),"^",5)=$P(FBN(0),"^",5),$P(^FBAA(161.5,DA,1),"^",7)=$P(FBN(0),"^",19),$P(^(1),U)=$P(FBN(0),U,6),DIK="^FBAA(161.5," D IX^DIK K DIK
"RTN","FBCHREQ1",26,0)
 .S FBREQED=1,DIC="^FBAA(161.5,",DIC(0)="AEQM" D EN^FBCHROC
"RTN","FBCHREQ1",27,0)
Q K DIE,DIC,DIRUT,DUOUT,DTOUT,X,Y,DR,FB,FBN,FBDA,FBDFN,FBNAME,FBSSN,DA,FBCHVEN,FBREQED,FBDOA,FBFRDT,J
"RTN","FBCHREQ1",28,0)
 Q
"RTN","FBCHREQ1",29,0)
DATCK ;Verify authorized from date is > or = date of admission.
"RTN","FBCHREQ1",30,0)
 S FBDOA=$P(^FBAA(162.2,DA,0),"^",19) I $G(FBDOA),X<FBDOA W !,*7,"Authorized From Date must be equal to or greater than the Date of Admission" S FBOUT=1
"RTN","FBCHREQ1",31,0)
 Q
"RTN","FBNHEAU1")
0^4^B5124970^B5103721
"RTN","FBNHEAU1",1,0)
FBNHEAU1 ;AISC/dmk - continue FBNHEAUT cnh authorization ;4/28/93  11:04
"RTN","FBNHEAU1",2,0)
 ;;3.5;FEE BASIS;**103**;JAN 30, 1995;Build 19
"RTN","FBNHEAU1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBNHEAU1",4,0)
 ;
"RTN","FBNHEAU1",5,0)
END K DA,DR,F,FBAASKV,FBAADDYS,FBAALT,FBAAP79,FBAATT,FBANEW,FBAOLD,FBCOUNTY,FBDX,FBI,FBRR,FBSITE,FBTYPE,FBXX,I,J,K,PI,S,T,Z,ZZ,FBPROG,PRC,PRCS,PRCSCPAN,DFN,CNT,X1,X2,FBMM
"RTN","FBNHEAU1",6,0)
 K DIC,DIE,FB7078,FBAA78,FBAADA,FBAAASKV,FBBEGDT,FBCD,FBDAYS,FBDEFP,FBDEV,FBENDDT,FBERR,FBNAME,FBNUM,FBO,FBOBN,FBPAYDT,FBPAYEDT,FBPOSDT,FBPSADF,FBSEQ,FBSSN,FBT,FBVEN,FBVCAR,FTP,IFN,PGM,VAL,VAR,X,Y
"RTN","FBNHEAU1",7,0)
 K FB("SITE"),FBAAADA,FBABD,FBDD,FBEDT,FBEND,FBFLAG,FBLG,FBMULT,FBONE,FBOUT,FBPOP,FBRIFN,FBTDT,FBTOT,FBTRDYS,FBTWO,FBZZ,FB,FBRIFN,FBRATE,FBC,FBID,FBAAOUT,FBVIEN,FBX,FBATODT,FBCNUM,FBFR
"RTN","FBNHEAU1",8,0)
 K FBRP
"RTN","FBNHEAU1",9,0)
 Q
"RTN","FBNHEAU1",10,0)
 ;
"RTN","FBNHEAU1",11,0)
NOGOOD ;ERROR
"RTN","FBNHEAU1",12,0)
 W !!,"No valid Obligation Number selected" G END
"RTN","FBNHEAU1",13,0)
 ;
"RTN","FBNHEAU1",14,0)
PROB ;ERROR
"RTN","FBNHEAU1",15,0)
 W !!,"Unable to get Obligation Sequence number from IFCAP!",!,"Check with IFCAP package coordinator!" Q
"RTN","FBNHEAU1",16,0)
 ;
"RTN","FBNHEAU1",17,0)
PROB2 ;ERROR
"RTN","FBNHEAU1",18,0)
 W !!,"Unable to add an entry in the VA Form 7078 file.  Please see Computer Staff!" Q
"RTN","FBNHEAU1",19,0)
 Q
"RTN","FBNHEAUT")
0^2^B25443874^B24816829
"RTN","FBNHEAUT",1,0)
FBNHEAUT ;AISC/DMK,GRR-ENTER/EDIT AUTHORIZATION ;08/07/02
"RTN","FBNHEAUT",2,0)
 ;;3.5;FEE BASIS;**43,103**;JAN 30, 1995;Build 19
"RTN","FBNHEAUT",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBNHEAUT",4,0)
 D SITEP^FBAAUTL Q:FBPOP  S FBAADDYS=+$P(FBSITE(0),"^",13),FBAAASKV=$P(FBSITE(1),"^"),FBPROG=$S($P(FBSITE(1),"^",6)="":"I 1",1:"I $P(^(0),U,3)=7") W !!
"RTN","FBNHEAUT",5,0)
 ;
"RTN","FBNHEAUT",6,0)
 S PRCS("TYPE")="FB",PRCS("A")="Select Obligation Number: " K PRCS("X") D EN1^PRCS58 G:Y<0 NOGOOD^FBNHEAU1 S FBOBN=$P(Y,"^",2) K PRCS("A")
"RTN","FBNHEAUT",7,0)
 ;
"RTN","FBNHEAUT",8,0)
 W !! S DIC="^DPT(",DIC(0)="QEAZM" D ^DIC G END:Y<0 S DFN=+Y
"RTN","FBNHEAUT",9,0)
 I $P($G(^DPT(DFN,.361)),"^")="" W !!,"ELIGIBILITY HAS NOT BEEN DETERMINED NOR PENDING, CANNOT ENTER AN AUTHORIZATION." G FBNHEAUT
"RTN","FBNHEAUT",10,0)
 I $P($G(^DPT(DFN,.32)),"^",4)=2 W !!,"VETERAN HAS A DISHONORABLE DISCHARGE, " S X=$P($G(^(.321)),"^") W $S(X="Y":"ONLY ELIGIBLE FOR AGENT ORANGE.",1:"NOT ELIGIBLE FOR BENEFITS.")
"RTN","FBNHEAUT",11,0)
 I "N"[$E(X) W ! S DIR("A")="Do you want to continue",DIR(0)="Y",DIR("B")="No" D ^DIR K DIR G FBNHEAUT:$S($D(DIRUT):1,'Y:1,1:0)
"RTN","FBNHEAUT",12,0)
 S DA=DFN I '$D(^FBAAA(DFN,0)) K DD,DO S (X,DINUM)=DFN,DIC="^FBAAA(",DIC(0)="LM",DLAYGO=161 D FILE^DICN K DIC,DLAYGO G:Y<0 END
"RTN","FBNHEAUT",13,0)
 S:'$D(^FBAAA(DFN,1,0)) ^(0)="^161.01D^^"
"RTN","FBNHEAUT",14,0)
 D ^FBAADEM ;G FBNHEAUT:FBAAOUT
"RTN","FBNHEAUT",15,0)
 ;
"RTN","FBNHEAUT",16,0)
GETVEN S FBPROG=7 D DATES^FBAAUTL2 G:FBBEGDT="" FBNHEAUT
"RTN","FBNHEAUT",17,0)
 D GETVEN^FBAAUTL1 G END:X="^"!(X=""),GETVEN:IFN="" S FBVEN=IFN,FBPAYDT=FBBEGDT,X=+FBBEGDT D DAYS^FBAAUTL1 S FBDAYS=$S(X>(FBENDDT-FBBEGDT):(FBENDDT-FBBEGDT),1:X)
"RTN","FBNHEAUT",18,0)
 D GETRAT^FBNHEAU2 G:FBERR GETVEN
"RTN","FBNHEAUT",19,0)
 ;CREATE AN ENTRY IN FILE 161
"RTN","FBNHEAUT",20,0)
 K DD,DO S DLAYGO=161,DA(1)=DFN,(DIE,DIC)="^FBAAA("_DA(1)_",1,",DIC(0)="LQ",X=FBBEGDT D FILE^DICN K DLAYGO S DA=+Y,FBAAADA=DA
"RTN","FBNHEAUT",21,0)
 S DIE=DIC,FBPSADF=$S($D(FBSITE(1)):$P(^DIC(4,$P(FBSITE(1),"^",3),0),"^",1),1:"")
"RTN","FBNHEAUT",22,0)
 ; fb*3.5*103  added REFERRING PROVIDER field (161.01,104) to DR string
"RTN","FBNHEAUT",23,0)
 S DR=".02////^S X=FBENDDT;.03////^S X=7;S FBTYPE=7;100////^S X=DUZ;1////^S X=""YES"";.04////^S X=FBVEN;.095////1;101T;104;.065;.07;.021;.097;.08;S:X="""" Y="""";.085;S:X="""" Y="""";.086" D ^DIE
"RTN","FBNHEAUT",24,0)
 I $D(DTOUT)!('$D(Y)=0) S DIC="^FBAAA("_DFN_",1," G DEL
"RTN","FBNHEAUT",25,0)
 ; fb*3.5*103  assignment of REFERRING PROVIDER (161.01,104) for recording at 162.4,15 via the FBNH ENTER 7078 input template
"RTN","FBNHEAUT",26,0)
 S FBRP=$$GET1^DIQ(161.01,FBAAADA_","_DFN,104,"I")
"RTN","FBNHEAUT",27,0)
 S FBVEN=FBVEN_";FBAAV("
"RTN","FBNHEAUT",28,0)
 ;
"RTN","FBNHEAUT",29,0)
 S X=FBPAYDT D DAYS^FBAAUTL1 S FBATODT=$S($E(FBPAYDT,1,5)_"00"+X>FBENDDT:FBENDDT-1,1:$E(FBPAYDT,1,5)_"00"+X)
"RTN","FBNHEAUT",30,0)
 D EST^FBNHEAU2
"RTN","FBNHEAUT",31,0)
 I $G(FBDEFP)'>0 W !,*7,"Unable to determine estimated dollar amount, based on authorization",!,"dates and current vendor contracts.",! S DA=FBAAADA,DA(1)=DFN,DIC="^FBAAA("_DFN_",1," G DEL
"RTN","FBNHEAUT",32,0)
 ;CHECK 1358 and get next point number. create entry in 162.4
"RTN","FBNHEAUT",33,0)
 S X=FBOBN K PRCS("A") S PRCS("TYPE")="FB" D EN1^PRCSUT31 I Y<0 S DIC="^FBAAA("_DFN_",1," D PROB^FBNHEAU1 G DEL
"RTN","FBNHEAUT",34,0)
 S FB7078=$P(FBOBN,"-",2)_"."_Y,FBSEQ=Y,DIC="^FB7078(",DIC(0)="LQ",DLAYGO=162.4,X=""""_FB7078_"""" D ^DIC K DLAYGO I Y<0 S DIC="^FBAAA("_DFN_",1," D PROB2^FBNHEAU1 G DEL
"RTN","FBNHEAUT",35,0)
 S (DA,FBAA78)=+Y
"RTN","FBNHEAUT",36,0)
 S DIE=DIC,DR="[FBNH ENTER 7078]" D ^DIE
"RTN","FBNHEAUT",37,0)
 I $O(^FBAAA(DFN,1,FBAAADA,2,0))>0 S ^FB7078(FBAA78,1,0)=^FBAAA(DFN,1,FBAAADA,2,0) F Z=0:0 S Z=$O(^FBAAA(DFN,1,FBAAADA,2,Z)) Q:Z'>0  S ^FB7078(FBAA78,1,Z,0)=^FBAAA(DFN,1,FBAAADA,2,Z,0)
"RTN","FBNHEAUT",38,0)
 S $P(^FBAAA(DFN,1,FBAAADA,0),"^",9)=FBAA78_";FB7078(",^FBAAA("AG",FBAA78_";FB7078(",DFN,FBAAADA)=""
"RTN","FBNHEAUT",39,0)
 ;call to create entries in file 161.23, time sensitive file
"RTN","FBNHEAUT",40,0)
 ;that will store patient rates
"RTN","FBNHEAUT",41,0)
 S FBERR=0 D FILE^FBNHEAU2 I FBERR W !,"Unable to create entry in Authorization Rate file (161.23).  Contact IRM.",! G ADM
"RTN","FBNHEAUT",42,0)
 ;call to create entry in ifcap 424.
"RTN","FBNHEAUT",43,0)
 S FBMM=$E(FBBEGDT,4,5)
"RTN","FBNHEAUT",44,0)
 S PRCS("TYPE")="FB" K PRCS("A") S FBNAME=$$NAME^FBCHREQ2(DFN),FBSSN=$$SSN^FBAAUTL(DFN) D NOW^%DTC S FBPOSDT=%,X=FBOBN_"^"_FBPOSDT_"^"_FBDEFP_"^^"_FBSEQ_"^"_FBNAME_"  ("_FBSSN_")"_"^"_DFN_";"_FBAA78_";"_$P(FBOBN,"-",2)_";"_FBMM D EN2^PRCS58
"RTN","FBNHEAUT",45,0)
 I +Y=0 W !!,"Error trying to Post to 1358, DID NOT POST. Error was:",!,Y,!?7,"Adjust the 1358 for $",$FN(FBDEFP,",",2)," then use the",!?7,"Post Commitments for Obligation option!",!,*7 G ADM
"RTN","FBNHEAUT",46,0)
 W !!,$J(FBDEFP,7,2),"  Posted to 1358"
"RTN","FBNHEAUT",47,0)
 ;
"RTN","FBNHEAUT",48,0)
 ;
"RTN","FBNHEAUT",49,0)
CHEKP78 S FBNUM=$P(FBSITE(1),"^",5),FBO=$P(FBSITE(1),"^",7),FBT=$P(FBSITE(1),"^",8) D FBO^FBCHP78 G END:$D(DIRUT) S IOP="Q",FB7078=FBAA78 W !
"RTN","FBNHEAUT",50,0)
 D IFCAP^FBAAUTL2
"RTN","FBNHEAUT",51,0)
 I '$D(FBERR(1)) S VAR="FB7078^FBNUM^FBO^FBT^FB(""SITE"")",VAL=FB7078_"^"_FBNUM_"^"_FBO_"^"_FBT_"^"_FB("SITE"),PGM="START^FBCHP78",%ZIS("B")="" W ! D ZIS^FBAAUTL
"RTN","FBNHEAUT",52,0)
 ;
"RTN","FBNHEAUT",53,0)
ADM S DIR(0)="Y",DIR("A")="Do you want to Admit Patient to CNH now",DIR("B")="YES" D ^DIR K DIR I Y S FBVEN=+FBVEN,FTP=FBAAADA,FBAABDT=FBBEGDT,FBAAEDT=FBENDDT,FBEND=1,FBRCHK=1 D RD2^FBNHEA
"RTN","FBNHEAUT",54,0)
 ;
"RTN","FBNHEAUT",55,0)
END D END^FBNHEAU1
"RTN","FBNHEAUT",56,0)
 Q
"RTN","FBNHEAUT",57,0)
 ;
"RTN","FBNHEAUT",58,0)
DEL S DIK=DIC D ^DIK K DIK,DIC D END^FBNHEAU1 G FBNHEAUT
"RTN","FBNHEDAT")
0^1^B13820385^B13238291
"RTN","FBNHEDAT",1,0)
FBNHEDAT ;AISC/GRR-ENTER/EDIT AUTHORIZATION ;02:07 PM  11 Apr 1990;
"RTN","FBNHEDAT",2,0)
 ;;3.5;FEE BASIS;**103**;JAN 30, 1995;Build 19
"RTN","FBNHEDAT",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBNHEDAT",4,0)
 D SITEP^FBAAUTL
"RTN","FBNHEDAT",5,0)
RD1 S U="^" D GETVET^FBAAUTL1 G:DFN="" END
"RTN","FBNHEDAT",6,0)
 S FBPROG="I $P(^(0),U,3)=7" D GETAUTH^FBAAUTL1 G RD1:'CNT!(FTP']"")!($D(DIRUT)) S (FBOLD,FBNEW,FBERR)=""
"RTN","FBNHEDAT",7,0)
 K FBAUT,CNT S (DA(1),D0)=DFN,FBOLD=^FBAAA(DFN,1,FTP,0),DA=FTP,FBAAADA=DA,DIE="^FBAAA("_DFN_",1,",FBO=$P(FBOLD,"^"),(FB1,FBAA(2))=$P(FBOLD,"^",2)
"RTN","FBNHEDAT",8,0)
 S FBPROG=7 D DATES^FBAAUTL2 S FBAA(1)=$S($G(FBBEGDT):FBBEGDT,1:FBO),FBAA(2)=$S($G(FBENDDT):FBENDDT,1:FB1)
"RTN","FBNHEDAT",9,0)
DR S DR=".01////^S X=FBAA(1);.02////^S X=FBAA(2)"
"RTN","FBNHEDAT",10,0)
 ; fb*3.5*103  add REFERRING PROVIDER (161.01,104) to DR string
"RTN","FBNHEDAT",11,0)
 S DR(1,161.01,1)="@2;.065;.07;.021;.08;S:X="""" Y=101;.085;S:X="""" Y=101;.086;101;104;.097" D ^DIE
"RTN","FBNHEDAT",12,0)
 S FBNEW=$S('$D(DA):"",'$D(^FBAAA(DFN,1,DA,0)):"",1:^(0)) K DR
"RTN","FBNHEDAT",13,0)
 I $D(Y)>0,FBNEW=""!(FBNEW=FBOLD) G RD1
"RTN","FBNHEDAT",14,0)
 I FBNEW'=FBOLD,$P(FBNEW,"^")>$P(FBNEW,"^",2) S DR=".01////^S X=FBO;.02////^S X=FB1" D ^DIE K DR D ER G DR
"RTN","FBNHEDAT",15,0)
 ;
"RTN","FBNHEDAT",16,0)
 S FBAA78=FB7078 D ^FBNHEDA1 K FBAA78 I FBERR S DA(1)=DFN,DA=FTP,DIE="^FBAAA("_DA(1)_",1,",DR=".01////^S X=FBO;.02////^S X=FB1" D ^DIE G END
"RTN","FBNHEDAT",17,0)
 ; fb*3.5*103  add the REFERRING PROVIDER (162.4,15) to the DR string; stuff with the value stored at 161.01,104
"RTN","FBNHEDAT",18,0)
 S DIE="^FB7078(",DA=FB7078,FBAA78=DA,DR="5;6;15////^S X=$$GET1^DIQ(161.01,FBAAADA_"",""_DFN,104,""I"")" I 'DA W !!,*7,"No 7078 on file!",! G END
"RTN","FBNHEDAT",19,0)
 D:FBOLD'=FBNEW CHANGED
"RTN","FBNHEDAT",20,0)
GO D ^DIE
"RTN","FBNHEDAT",21,0)
 I $O(^FBAAA(DFN,1,FBAAADA,2,0))>0 K ^FB7078(FBAA78,1) S ^FB7078(FBAA78,1,0)=^FBAAA(DFN,1,FBAAADA,2,0) F Z=0:0 S Z=$O(^FBAAA(DFN,1,FBAAADA,2,Z)) Q:Z'>0  S ^FB7078(FBAA78,1,Z,0)=^FBAAA(DFN,1,FBAAADA,2,Z,0)
"RTN","FBNHEDAT",22,0)
RD2 S DIR(0)="Y",DIR("A")="Want to Queue 7078 for printing",DIR("B")=$S(FBOLD=FBNEW:"No",1:"Yes") D ^DIR K DIR G:Y'>0 RD1
"RTN","FBNHEDAT",23,0)
CHEKP78 S FBNUM=$P(FBSITE(1),"^",5),FBO=$P(FBSITE(1),"^",7),FBT=$P(FBSITE(1),"^",8) D FBO^FBCHP78 G END:$D(DIRUT) S IOP="Q",%ZIS("B")="",FB7078=FBAA78,FB("SITE")=$P(FBSITE(1),"^",3) W !
"RTN","FBNHEDAT",24,0)
 S VAR="FB7078^FBNUM^FBO^FBT^FB(""SITE"")",VAL=FB7078_"^"_FBNUM_"^"_FBO_"^"_FBT_"^"_FB("SITE"),PGM="START^FBCHP78" W ! D ZIS^FBAAUTL
"RTN","FBNHEDAT",25,0)
 ;
"RTN","FBNHEDAT",26,0)
END K D0,DA,FBAASKV,FBAADDYS,FBAALT,FBAAP79,FBAATT,FBNUM,FBDEV,FBO,FBT,FB7078,FBAA78,FBCOUNTY,FBDX,FBI,FBRR,FBVEN,FBTYPE,FBXX,I,J,K,PI,FBOLD,FBNEW,FBPSADF,FBAADA,FB1,FBERR,FBOUT,FBIFN,FBZ,FBBEGDT,FBENDDT,FBAUT
"RTN","FBNHEDAT",27,0)
 K DIE,DIR,FBAAADA,FTP,PGM,VAL,VAR,X,Y,Z,DIC,A,FBAABDT,FBAAEDT,FBAAOUT,FBASSOC,FBLOC,FBPOV,FBPROG,FBPSA,FBPT,FBSITE,FBTT,PTYPE,T,ZZ,FB("SITE"),FBPOP,FBAA,FBBDT,FBTDAYS,HOLDX
"RTN","FBNHEDAT",28,0)
 D END^FBNHEAU1
"RTN","FBNHEDAT",29,0)
 D CLOSE^FBAAUTL
"RTN","FBNHEDAT",30,0)
 Q
"RTN","FBNHEDAT",31,0)
 ;
"RTN","FBNHEDAT",32,0)
CHANGED S:$P(FBOLD,"^",1)'=$P(FBNEW,"^",1) DR="3////^S X=$P(FBNEW,U,1);"_DR
"RTN","FBNHEDAT",33,0)
 S:$P(FBOLD,"^",2)'=$P(FBNEW,"^",2) DR="4////^S X=$P(FBNEW,U,2);"_DR
"RTN","FBNHEDAT",34,0)
 Q
"RTN","FBNHEDAT",35,0)
 ;
"RTN","FBNHEDAT",36,0)
ER W !,*7,"From Date cannot be greater than the To Date.",!
"RTN","FBNHEDAT",37,0)
 Q
"RTN","FBNHEDAT",38,0)
 ;
"RTN","FBNHEDAT",39,0)
ER1 W !,*7,"This patient has movements after the authorization to date.  You must",!,"edit the patient's movements first.",!
"RTN","FBNHEDAT",40,0)
 Q
"RTN","FBPCR")
0^13^B63936182^B63491421
"RTN","FBPCR",1,0)
FBPCR ;AISC/DMK,GRR,TET-POTENTIAL COST RECOVERY OUTPUT DRIVER ;23 May 2006  10:06 AM
"RTN","FBPCR",2,0)
 ;;3.5;FEE BASIS;**12,48,76,98,103**;JAN 30, 1995;Build 19
"RTN","FBPCR",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBPCR",4,0)
 ; DBIA SUPPORTED REF $$NPI^XUSNPI = 4532
"RTN","FBPCR",5,0)
DOC ;Refer to fbdoc, tag fbpcr, for documentation of fbpcr* routines
"RTN","FBPCR",6,0)
PSF ;select one/many/all primary service failities
"RTN","FBPCR",7,0)
 S FBARRLTC=""
"RTN","FBPCR",8,0)
 W !! S DIC="^DIC(4,",VAUTSTR="Primary Service Facility",VAUTNI=2,VAUTVB="FBPSV" D FIRST^VAUTOMA K DIC I Y=-1 G EXIT
"RTN","FBPCR",9,0)
ARRAY ;set fee program array for all programs
"RTN","FBPCR",10,0)
 S FBPI=0 F  S FBPI=$O(^FBAA(161.8,FBPI)) Q:'FBPI  S FBPIN=$G(^(FBPI,0)) I $P(FBPIN,U,3) S FBPROG(FBPI)=$P(FBPIN,U)
"RTN","FBPCR",11,0)
 I '$D(FBPROG) G EXIT
"RTN","FBPCR",12,0)
 ;prepare array with LTC POV codes
"RTN","FBPCR",13,0)
 D MKARRLTC^FBPCR4
"RTN","FBPCR",14,0)
 ;what party to include
"RTN","FBPCR",15,0)
 K DIR
"RTN","FBPCR",16,0)
 S DIR(0)="SO^P:Patient;I:Insurance;B:Both",DIR("A")="Include (P)atient Co-pays / (I)nsurance / (B)oth",DIR("B")="Both"
"RTN","FBPCR",17,0)
 S DIR("?")=" Select type of recover to include",DIR("?",1)=" P - include only recover from patient copays",DIR("?",2)=" I - include only recover from insurance",DIR("?",3)=" B - include both",DIR("L")=""
"RTN","FBPCR",18,0)
 D ^DIR S FBPARTY=$S($G(Y(0))="Patient":1,$G(Y(0))="Insurance":2,$G(Y(0))="Both":3,X="Both":3,1:0)
"RTN","FBPCR",19,0)
 K DIR
"RTN","FBPCR",20,0)
 G:FBPARTY=0 EXIT
"RTN","FBPCR",21,0)
 ;what type of copay to include
"RTN","FBPCR",22,0)
 S FBCOPAY=3
"RTN","FBPCR",23,0)
 I FBPARTY'=2 D
"RTN","FBPCR",24,0)
 . S DIR(0)="SO^M:MeansTest;L:LTC;B:Both",DIR("A")="Include (M)eans Test Co-pays /(L)TC Co-pays /(B)oth",DIR("B")="Both"
"RTN","FBPCR",25,0)
 . S DIR("?")=" Select services to include",DIR("?",1)=" M - include only Means Test copays",DIR("?",2)=" L - include only LTC copays",DIR("?",3)=" B - include both",DIR("L")=""
"RTN","FBPCR",26,0)
 . D ^DIR S FBCOPAY=$S($G(Y(0))="LTC":1,$G(Y(0))="MeansTest":2,$G(Y(0))="Both":3,X="Both":3,1:0)
"RTN","FBPCR",27,0)
 . K DIR
"RTN","FBPCR",28,0)
 G:FBCOPAY=0 EXIT
"RTN","FBPCR",29,0)
 ;
"RTN","FBPCR",30,0)
 ;include patients if their insurance informations is unavailable?
"RTN","FBPCR",31,0)
 S FBINCUNK=0
"RTN","FBPCR",32,0)
 I FBPARTY=2!(FBPARTY=3) D
"RTN","FBPCR",33,0)
 . S FBINCUNK=1
"RTN","FBPCR",34,0)
 . N Y,X
"RTN","FBPCR",35,0)
 . W !!
"RTN","FBPCR",36,0)
 . S DIR("A")="Do you want to include patients whose insurance status is unavailable? "
"RTN","FBPCR",37,0)
 . S DIR("?")="Please answer Yes or No."
"RTN","FBPCR",38,0)
 . S DIR("B")="YES",DIR(0)="YA^^"
"RTN","FBPCR",39,0)
 . D ^DIR K DIR
"RTN","FBPCR",40,0)
 . I $G(DIRUT) S FBINCUNK=-1 Q
"RTN","FBPCR",41,0)
 . I $G(Y)=0 S FBINCUNK=0
"RTN","FBPCR",42,0)
 I FBINCUNK=-1 G EXIT ;uparrow - exit
"RTN","FBPCR",43,0)
 ;
"RTN","FBPCR",44,0)
DATE ;select date range
"RTN","FBPCR",45,0)
 D DATE^FBAAUTL I FBPOP G PSF
"RTN","FBPCR",46,0)
 S FBBDATE=BEGDATE,FBEDATE=ENDDATE
"RTN","FBPCR",47,0)
 S Z=9999999.9999,FBBEG=Z-FBEDATE,FBEND=Z-FBBDATE
"RTN","FBPCR",48,0)
Q K ^TMP($J,"FB"),^TMP($J,"FBINSIBAPI"),DIC
"RTN","FBPCR",49,0)
 ;
"RTN","FBPCR",50,0)
 S VAR="FBINCUNK^FBARRLTC^FBARRLTC(^FBPARTY^FBCOPAY^FBNAME^FBIEN^FBID^FBBEG^FBEND^FBBDATE^FBEDATE^FBPSV^FBPSV(^FBPROG(",VAL=VAR,PGM="DQ^FBPCR",IOP="Q" D ZIS^FBAAUTL G:FBPOP EXIT
"RTN","FBPCR",51,0)
DQ S $P(FBDASH,"=",80)="",$P(FBDASH1,"-",80)="",FBPG=0,FBCRT=$S($E(IOST,1,2)="C-":1,1:0),FBOUT=0,FBBEG=FBBEG-.9 U IO
"RTN","FBPCR",52,0)
SORT ;sort driver for payment output(s)
"RTN","FBPCR",53,0)
 S FBPI=0 F  S FBPI=$O(FBPROG(FBPI)) Q:'FBPI  S FBXPROG=FBPROG(FBPI) D
"RTN","FBPCR",54,0)
 .I FBPI=2 D EN^FBPCR2 ;outpatient payments
"RTN","FBPCR",55,0)
 .I FBPI=3 D EN^FBPCR3 ;pharmacy payments
"RTN","FBPCR",56,0)
 .I FBPI=6!(FBPI=7) S:FBPI=6&($D(FBPROG(7))) FBPI=67 D EN^FBPCR67 S:FBPI=67 FBPI=7 ;civil hospital/cnh payments
"RTN","FBPCR",57,0)
PRINT ;print driver for payment output(s)
"RTN","FBPCR",58,0)
 I $G(^TMP($J,"FBINSIBAPI"))>0 D HDRUNK
"RTN","FBPCR",59,0)
 S FBPI=$O(^TMP($J,"FB",0)) I FBPI']"" D WMSG G OUT
"RTN","FBPCR",60,0)
 S FBSTA=0
"RTN","FBPCR",61,0)
 S FBPSF=0 F  S FBPSF=$O(^TMP($J,"FB",FBPSF)) Q:'FBPSF!FBOUT  D STA S FBPT="" F  S FBPT=$O(^TMP($J,"FB",FBPSF,FBPT)) Q:FBPT']""!FBOUT  S DFN=$P(FBPT,";",2) D VET S FBPI=0 F  S FBPI=$O(FBPROG(FBPI)) Q:'FBPI  S FBXPROG=FBPROG(FBPI) D  Q:FBOUT
"RTN","FBPCR",62,0)
 .I FBPSF_FBPT'=FBSTA D HDR Q:FBOUT
"RTN","FBPCR",63,0)
 .I FBPI=2,$D(^TMP($J,"FB",FBPSF,FBPT,FBPI)) D PRINT^FBPCR2 Q
"RTN","FBPCR",64,0)
 .I FBPI=3 D:$D(^TMP($J,"FB",FBPSF,FBPT,FBPI)) PRINT^FBPCR3 Q
"RTN","FBPCR",65,0)
 .I FBPI=6!(FBPI=7) D:$D(^TMP($J,"FB",FBPSF,FBPT,FBPI)) PRINT^FBPCR671 Q
"RTN","FBPCR",66,0)
OUT I $G(^TMP($J,"FBINSIBAPI"))>0 D ERRHDL^FBPCR4
"RTN","FBPCR",67,0)
 I FBOUT!$D(ZTQUEUED) G EXIT
"RTN","FBPCR",68,0)
 D EXIT G PSF
"RTN","FBPCR",69,0)
 Q
"RTN","FBPCR",70,0)
EXIT ;kill and quit
"RTN","FBPCR",71,0)
KILL ;kill all variables set in the FBPCR* routines, other than fbx
"RTN","FBPCR",72,0)
 D CLOSE^FBAAUTL K ^TMP($J,"FB")
"RTN","FBPCR",73,0)
 K A1,A2,A3,BEGDATE,C,D,D2,DFN,DIC,DIR,DTOUT,DUOUT,ENDDATE,FBPDXC,FBPARTY,FBCOPAY,FBARRLTC,FBINCUNK
"RTN","FBPCR",74,0)
 K FBAAA,FBAACPTC,FBAC,FBAP,FBBATCH,FBBDATE,FBBEG,FBBN,FBCATC,FBCNT,FBCP,FBCRT,FBDA1,FBDASH,FBDASH1,FBDATA,FBDOB,FBDRUG,FBDT,FBDT1,FBDOS,FBDX,FBDX1,FBEDATE,FBEND,FBERR,FBFD,FBFD1,FBHEAD
"RTN","FBPCR",75,0)
 K FBI,FBID,FBIEN,FBIN,FBINS,FBINVN,FBIX,FBJ,FBLOC,FBM,FBNAME,FBOB,FBOPI,FBOUT,FBOV,FBP,FBPAT,FBPD,FBPDX,FBPG,FBPI,FBPID,FBPIN,FBPNAME,FBPROC,FBPROC1,FBPROG,FBPSF,FBPSFNAM,FBPSFNUM,FBPSV,FBPT,FBPV,FBQTY,FBREIM,FBRX
"RTN","FBPCR",76,0)
 K FBSC,FBSL,FBSTA,FBSTR,FBSUSP,FBTA,FBTYPE,FBV,FBVCHAIN,FBVEN,FBVENID,FBVNAME,FBVI,FBVID,FBVP,FBXPROG,FBY,FBZ,I,IOP,J,K,L,M,N,PGM,T,V,VA,VAERR,VAL,VAR,VAUTNI,VAUTSTR,VAUTVB,X,Y,Z,FBSTANPI,FBXX
"RTN","FBPCR",77,0)
 Q
"RTN","FBPCR",78,0)
WMSG ;write message if no matches found
"RTN","FBPCR",79,0)
 D HDR W !!?3,"There are no potential cost recoveries on file"
"RTN","FBPCR",80,0)
 W !?5,"for specified date range:  ",$$DATX^FBAAUTL(FBBDATE)," through ",$$DATX^FBAAUTL(FBEDATE)
"RTN","FBPCR",81,0)
 I 'FBPSV D
"RTN","FBPCR",82,0)
 .W ",",!?5,"and selected Primary Service Area(s):"
"RTN","FBPCR",83,0)
 .S FBPSF=0 F  S FBPSF=$O(FBPSV(FBPSF)) Q:'FBPSF  W !?31,$G(FBPSV(FBPSF))
"RTN","FBPCR",84,0)
 E  W !?5,"and ALL Primary Service Areas "
"RTN","FBPCR",85,0)
 W ".",*7,!!
"RTN","FBPCR",86,0)
 Q
"RTN","FBPCR",87,0)
 ;
"RTN","FBPCR",88,0)
CATC(DFN,FBDT,FBPOV) ;
"RTN","FBPCR",89,0)
 ;treats all copays as Means test for date < 3020705 (JULY 5,2002)
"RTN","FBPCR",90,0)
 ;check if patient is liable for copay
"RTN","FBPCR",91,0)
 ;INPUT:  
"RTN","FBPCR",92,0)
 ; DFN = IEN of Patient file
"RTN","FBPCR",93,0)
 ; FBDT= Date
"RTN","FBPCR",94,0)
 ; FBPOV = POV code (for LTC determination)
"RTN","FBPCR",95,0)
 ;OUTPUT:  
"RTN","FBPCR",96,0)
 ;0 - the patient is not liable for any co-pay;
"RTN","FBPCR",97,0)
 ;1 - if Means test catc or pending adjudication and agree to pay deduc
"RTN","FBPCR",98,0)
 ;2 - the patient is liable for LTC co-pay;
"RTN","FBPCR",99,0)
 ;3 - no 1010EC on file
"RTN","FBPCR",100,0)
 ;4 - more analysis is needed to determine the patient liability
"RTN","FBPCR",101,0)
 N FBLTC,FBISLTC
"RTN","FBPCR",102,0)
 S FBCATC=$$BIL^DGMTUB(DFN,FBDT)
"RTN","FBPCR",103,0)
 I '$D(FBPOV)!(FBDT<3020705) Q $S(FBCATC:1,1:0)
"RTN","FBPCR",104,0)
 S FBISLTC=$$ISLTC^FBPCR4(FBPOV)
"RTN","FBPCR",105,0)
 I FBISLTC=0 Q $S(FBCATC:1,1:0)  ;Means test
"RTN","FBPCR",106,0)
 I FBISLTC=2 Q 0  ;LTC-service, but LTC-copay is not applicable
"RTN","FBPCR",107,0)
 S FBLTC=$$LTCST^FBPCR4(DFN,FBDT)
"RTN","FBPCR",108,0)
 I FBLTC=2 Q 2  ;LTC copay
"RTN","FBPCR",109,0)
 I FBLTC=0 Q 3  ;no 1010EC on file
"RTN","FBPCR",110,0)
 I FBLTC=4 Q 4  ;more info needed
"RTN","FBPCR",111,0)
 Q 0  ;exemption from LTC -copay
"RTN","FBPCR",112,0)
 ;
"RTN","FBPCR",113,0)
VET ;set vet name/ssn/dob info
"RTN","FBPCR",114,0)
 ;INPUT:  DFN  = IEN of Patient file
"RTN","FBPCR",115,0)
 ;      FBPI = IEN of fee program (optional)
"RTN","FBPCR",116,0)
 ;OUTPUT:  FBPNAME = Patient's name
"RTN","FBPCR",117,0)
 ;      FBPID   = Patient's pid
"RTN","FBPCR",118,0)
 ;      FBDOB   = Patient's dob (if pharmacy fee program)
"RTN","FBPCR",119,0)
 N N
"RTN","FBPCR",120,0)
 S N=$G(^DPT(DFN,0)),FBPNAME=$P(N,U),FBPID=$$SSN^FBAAUTL(DFN),FBDOB=$$FMTE^XLFDT($P(N,U,3))
"RTN","FBPCR",121,0)
 Q
"RTN","FBPCR",122,0)
STA ;set station name & number
"RTN","FBPCR",123,0)
 ;INPUT = FBPSF - IEN to institution file
"RTN","FBPCR",124,0)
 ;OUTPUT = FBPSFNAM = station name
"RTN","FBPCR",125,0)
 ;      FBPSFNUM = station number
"RTN","FBPCR",126,0)
 S FBPSFNAM=$P($G(^DIC(4,FBPSF,0)),U),FBPSFNUM=$P($G(^DIC(4,FBPSF,99)),U)
"RTN","FBPCR",127,0)
 S:FBPSFNAM=+FBPSFNAM FBPSFNAM="UNKNOWN"
"RTN","FBPCR",128,0)
 S FBSTANPI=$S($G(FBPSFNAM)="":"",FBPSFNAM="UNKNOWN":"",1:$P($$NPI^XUSNPI("Organization_ID",FBPSF),U,1))
"RTN","FBPCR",129,0)
 Q
"RTN","FBPCR",130,0)
PAGE ;form feed when new station/patient
"RTN","FBPCR",131,0)
 S FBSTA=$G(FBPSF)_$G(FBPT)
"RTN","FBPCR",132,0)
 I FBCRT&(FBPG'=0) D CR Q:FBOUT
"RTN","FBPCR",133,0)
 I FBPG>0!FBCRT W @IOF
"RTN","FBPCR",134,0)
 S FBPG=FBPG+1
"RTN","FBPCR",135,0)
 Q
"RTN","FBPCR",136,0)
CR ;read for display
"RTN","FBPCR",137,0)
 S DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1
"RTN","FBPCR",138,0)
 Q
"RTN","FBPCR",139,0)
HDR ;general header for potential recoveries
"RTN","FBPCR",140,0)
 D PAGE Q:FBOUT
"RTN","FBPCR",141,0)
 W !?(IOM-30/2),"POTENTIAL COST RECOVERY REPORT"
"RTN","FBPCR",142,0)
 W !?(IOM-(11+$L($G(FBPSFNAM))+$L($G(FBPSFNUM)))/2),"Division: ",$G(FBPSFNUM)," ",$G(FBPSFNAM)
"RTN","FBPCR",143,0)
 W !?(IOM-14/2),"NPI: ",$S($G(FBSTANPI)="":"",$G(FBSTANPI)<1:"",1:$G(FBSTANPI))
"RTN","FBPCR",144,0)
 W !?(IOM-19/2),$$DATX^FBAAUTL(FBBDATE)," - ",$$DATX^FBAAUTL(FBEDATE)
"RTN","FBPCR",145,0)
 W !?71,"Page: ",FBPG
"RTN","FBPCR",146,0)
 W !,"Patient: ",$G(FBPNAME),?40,"Pat. ID: ",$G(FBPID),?62,"DOB: ",$G(FBDOB)
"RTN","FBPCR",147,0)
 W !
"RTN","FBPCR",148,0)
 I FBINCUNK=1,$D(^TMP($J,"FBINSIBAPI",+$G(DFN))) W ">> Warning: accurate insurance information for the patient is unavailable"
"RTN","FBPCR",149,0)
 W !?3,"('*' Represents Reimbursement to Patient",?50,"'#' Represents Voided Payment)"
"RTN","FBPCR",150,0)
 W !,FBDASH
"RTN","FBPCR",151,0)
 W ! D:$D(DFN) INS^DGRPDB
"RTN","FBPCR",152,0)
 Q
"RTN","FBPCR",153,0)
HDRUNK ;Warning message if patient's insurance status is unknown
"RTN","FBPCR",154,0)
 D PAGE Q:FBOUT
"RTN","FBPCR",155,0)
 W !?(IOM-30/2),"POTENTIAL COST RECOVERY REPORT"
"RTN","FBPCR",156,0)
 W !?(IOM-(11+$L($G(FBPSFNAM))+$L($G(FBPSFNUM)))/2),"Division: ",$G(FBPSFNUM)," ",$G(FBPSFNAM)
"RTN","FBPCR",157,0)
 W !?(IOM-19/2),$$DATX^FBAAUTL(FBBDATE)," - ",$$DATX^FBAAUTL(FBEDATE)
"RTN","FBPCR",158,0)
 W !?71,"Page: ",FBPG
"RTN","FBPCR",159,0)
 W !,"------------------------------ !!! WARNING !!! --------------------------------"
"RTN","FBPCR",160,0)
 W !,"This report is incomplete due to problems with obtaining insurance information"
"RTN","FBPCR",161,0)
 W !,"for those patients listed in a separate section in the end of the report. You"
"RTN","FBPCR",162,0)
 W !,"may want to rerun the report again to get more accurate results."
"RTN","FBPCR",163,0)
 W !,FBDASH
"RTN","FBPCR",164,0)
 I FBINCUNK=1 D
"RTN","FBPCR",165,0)
 . W !,"Note: You have chosen to include patients with unknown insurance status in"
"RTN","FBPCR",166,0)
 . W !,"this report. Please be aware that these patients will be treated as if they"
"RTN","FBPCR",167,0)
 . W !,"have billable insurance and their treatment details will be marked accordingly."
"RTN","FBPCR",168,0)
 . W !,"The names of these patients will be accompanied with the following message"
"RTN","FBPCR",169,0)
 . W !,"to order to identify them:"
"RTN","FBPCR",170,0)
 . W !,">> Warning: accurate insurance information for the patient is unavailable"
"RTN","FBPCR",171,0)
 . W !,FBDASH
"RTN","FBPCR",172,0)
 Q
"UP",161,161.01,-1)
161^1
"UP",161,161.01,0)
161.01
"VER")
8.0^22.0
"^DD",161,161.01,104,0)
REFERRING PROVIDER^*P200'^VA(200,^0;21^S DIC("S")="I $$PROVIDER^FBAAAUT(+Y)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",161,161.01,104,3)
Enter the provider who referred this patient for service.
"^DD",161,161.01,104,12)
Types of users allowed should only be providers.
"^DD",161,161.01,104,12.1)
S DIC("S")="I $$PROVIDER^FBAAAUT(+Y)"
"^DD",161,161.01,104,21,0)
^.001^3^3^3080416^^
"^DD",161,161.01,104,21,1,0)
This field contains the name of the VA provider who referred this patient
"^DD",161,161.01,104,21,2,0)
for service. This is not necessarily the same as the Authorizing Physician
"^DD",161,161.01,104,21,3,0)
although they may be the same in some cases.
"^DD",161,161.01,104,"DT")
3080416
"^DD",162.2,162.2,17,0)
REFERRING PROVIDER^*P200'^VA(200,^2;1^S DIC("S")="I $$PROVIDER^FBAAAUT(+Y)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",162.2,162.2,17,3)
Enter the VA Physician who made the referral to the Non-VA facility.
"^DD",162.2,162.2,17,12)
Types of users allowed should only be providers
"^DD",162.2,162.2,17,12.1)
S DIC("S")="I $$PROVIDER^FBAAAUT(+Y)"
"^DD",162.2,162.2,17,21,0)
^.001^2^2^3080417^^
"^DD",162.2,162.2,17,21,1,0)
The VA physician who made the referral on behalf of the veteran to the 
"^DD",162.2,162.2,17,21,2,0)
non-VA hospital for inpatient health care services.
"^DD",162.2,162.2,17,"DT")
3080417
"^DD",162.4,162.4,15,0)
REFERRING PROVIDER^*P200'^VA(200,^0;17^S DIC("S")="I $$PROVIDER^FBAAAUT(+Y)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",162.4,162.4,15,3)
Enter the VA Physician who made the referral to the Non-VA facility.
"^DD",162.4,162.4,15,12)
Types of users allowed should only be providers.
"^DD",162.4,162.4,15,12.1)
S DIC("S")="I $$PROVIDER^FBAAAUT(+Y)"
"^DD",162.4,162.4,15,21,0)
^.001^2^2^3080418^^^^
"^DD",162.4,162.4,15,21,1,0)
The VA physician who made the referral on behalf of the veteran to the
"^DD",162.4,162.4,15,21,2,0)
non-VA hospital for inpatient health care services.
"^DD",162.4,162.4,15,"DT")
3080418
"^DD",162.4,162.4,16,0)
REFERRING PROVIDER NPI^CJ10^^ ; ^S Y(162.4,16,1)=$S($D(^FB7078(D0,0)):^(0),1:"") S X=$P(Y(162.4,16,1),U,17),X=X S X=X,X=$$REFNPI^FBCH78(X)
"^DD",162.4,162.4,16,9)
^
"^DD",162.4,162.4,16,9.01)
162.4^15
"^DD",162.4,162.4,16,9.1)
FB REF PROV NPI(INTERNAL(REFERRING PROVIDER))
"^DD",162.4,162.4,16,"DT")
3080416
"BLD",7198,6)
^96
**END**
**END**
