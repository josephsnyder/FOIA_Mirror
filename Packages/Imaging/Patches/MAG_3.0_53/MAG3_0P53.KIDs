KIDS Distribution saved on Apr 28, 2010@13:01:47
VistA Imaging V3.0 - Patch 53 - 04/28/2010 13:01PM
**KIDS**:MAG*3.0*53^

**INSTALL NAME**
MAG*3.0*53
"BLD",3463,0)
MAG*3.0*53^IMAGING^0^3100428^y
"BLD",3463,1,0)
^^75^75^3100428^
"BLD",3463,1,1,0)
Version 3.0 Patch 053 - DICOM Import I
"BLD",3463,1,2,0)
 
"BLD",3463,1,3,0)
 
"BLD",3463,1,4,0)
 
"BLD",3463,1,5,0)
 
"BLD",3463,1,6,0)
 
"BLD",3463,1,7,0)
 
"BLD",3463,1,8,0)
 
"BLD",3463,1,9,0)
New MAG DICOM ADD CAMERA EQUIP RM 3.0 rpc.
"BLD",3463,1,10,0)
 
"BLD",3463,1,11,0)
RPC= MAG DICOM GET DFN  ROUTINE: MAGDRPCA TAG: GETDFN
"BLD",3463,1,12,0)
 
"BLD",3463,1,13,0)
 
"BLD",3463,1,14,0)
 
"BLD",3463,1,15,0)
 
"BLD",3463,1,16,0)
 
"BLD",3463,1,17,0)
RPC DICOM GET RAD CAMERA
"BLD",3463,1,18,0)
CAMERA^MAGDRPCB  (#78.6)
"BLD",3463,1,19,0)
 
"BLD",3463,1,20,0)
RPC MAG DICOM GET RAD CPT MOD
"BLD",3463,1,21,0)
CPTMOD^MAGDRPCB (#81.3)
"BLD",3463,1,22,0)
 
"BLD",3463,1,23,0)
RPC MAG DICOM GET RAD DX CODE
"BLD",3463,1,24,0)
DXCODE^MAGDRPCB
"BLD",3463,1,25,0)
 
"BLD",3463,1,26,0)
RPC MAG DICOM GET RAD FILM
"BLD",3463,1,27,0)
FILM^MAGDRPCB (#78.4)
"BLD",3463,1,28,0)
 
"BLD",3463,1,29,0)
RPC: DICOM GET RAD INFO BY ACN
"BLD",3463,1,30,0)
 
"BLD",3463,1,31,0)
This RPC takes the Accession Number and returns the first radiology 
"BLD",3463,1,32,0)
study that matches it.  This RPC uses $$ACCFIND^RAAPI().
"BLD",3463,1,33,0)
 
"BLD",3463,1,34,0)
 
"BLD",3463,1,35,0)
RPC_MAG_DICOM_GET_PERSON
"BLD",3463,1,36,0)
 
"BLD",3463,1,37,0)
 
"BLD",3463,1,38,0)
 
"BLD",3463,1,39,0)
 
"BLD",3463,1,40,0)
RPC = MAG DICOM IMPORTER CHECK UIDS ROUTINE: MAGDRPCA TAG: CHECKUID
"BLD",3463,1,41,0)
 
"BLD",3463,1,42,0)
RPC = MAG DICOM IMPORTER DELETE ROUTINE: MAGDRPCA TAG: DELETE
"BLD",3463,1,43,0)
 
"BLD",3463,1,44,0)
RPC:  MAG DICOM RADIOLOGY MODIFIERS TAG:  MOD  ROUTINE: MAGDRPCA
"BLD",3463,1,45,0)
 
"BLD",3463,1,46,0)
RPC:  MAG DICOM RADIOLOGY PROCEDURES PROC^MAGDRPCA
"BLD",3463,1,47,0)
 
"BLD",3463,1,48,0)
 
"BLD",3463,1,49,0)
 
"BLD",3463,1,50,0)
 
"BLD",3463,1,51,0)
 
"BLD",3463,1,52,0)
 
"BLD",3463,1,53,0)
 
"BLD",3463,1,54,0)
 
"BLD",3463,1,55,0)
 
"BLD",3463,1,56,0)
 
"BLD",3463,1,57,0)
 
"BLD",3463,1,58,0)
 
"BLD",3463,1,59,0)
 
"BLD",3463,1,60,0)
Routines:
"BLD",3463,1,61,0)
MAGBRTK     new value = 20097310
"BLD",3463,1,62,0)
MAGDAIRF    new value = 25028969
"BLD",3463,1,63,0)
MAGDAIRG    new value = 53876343
"BLD",3463,1,64,0)
MAGDIR81    new value = 80768896
"BLD",3463,1,65,0)
MAGDIR8R    new value = 53835298
"BLD",3463,1,66,0)
MAGDIR9A    new value = 52130794
"BLD",3463,1,67,0)
MAGDIR9B    new value = 19341690
"BLD",3463,1,68,0)
MAGDLBAA    new value = 19867393
"BLD",3463,1,69,0)
MAGDRPC9    new value = 56624389
"BLD",3463,1,70,0)
MAGDRPCA    new value = 90688059
"BLD",3463,1,71,0)
MAGDRPCB    new value = 129146302
"BLD",3463,1,72,0)
MAGIPS53    new value = 10130628
"BLD",3463,1,73,0)
 
"BLD",3463,1,74,0)
Please note that routine MAGIPS53 is deleted after the KIDS Build is
"BLD",3463,1,75,0)
installed.
"BLD",3463,4,0)
^9.64PA^2006.588^8
"BLD",3463,6.3)
V3.0p53Build1719_T29
"BLD",3463,4,2006.563,0)
2006.563
"BLD",3463,4,2006.563,2,0)
^9.641^2006.563^1
"BLD",3463,4,2006.563,2,2006.563,0)
DICOM GATEWAY PARAMETER  (File-top level)
"BLD",3463,4,2006.563,2,2006.563,1,0)
^9.6411^99^20
"BLD",3463,4,2006.563,2,2006.563,1,79,0)
BACKGROUND PROCESS VERIFY
"BLD",3463,4,2006.563,2,2006.563,1,81,0)
MULTIFRAME COUNTER
"BLD",3463,4,2006.563,2,2006.563,1,93,0)
DICOM EXPORT RUN NUMBER
"BLD",3463,4,2006.563,2,2006.563,1,99,0)
EXPORT SCAN MODE
"BLD",3463,4,2006.563,2,2006.563,1,114,0)
IMPORTER
"BLD",3463,4,2006.563,2,2006.563,1,115,0)
IMPORTER LOG
"BLD",3463,4,2006.563,2,2006.563,1,116,0)
IMPORTER DRIVE
"BLD",3463,4,2006.563,2,2006.563,1,117,0)
IMPORTER ORDER LOCATION
"BLD",3463,4,2006.563,2,2006.563,1,118,0)
IMPORTER ORDER LOCATION NAME
"BLD",3463,4,2006.563,2,2006.563,1,119,0)
IMPORTER ORDER PROVIDER
"BLD",3463,4,2006.563,2,2006.563,1,120,0)
IMPORTER ORDER PROVIDER NAME
"BLD",3463,4,2006.563,2,2006.563,1,121,0)
IMPORTER RAD DICT DOWNLOAD
"BLD",3463,4,2006.563,2,2006.563,1,122,0)
IMPORTER RAD CAMERA
"BLD",3463,4,2006.563,2,2006.563,1,123,0)
IMPORTER RAD CAMERA NAME
"BLD",3463,4,2006.563,2,2006.563,1,124,0)
IMPORTER RAD DX CODE
"BLD",3463,4,2006.563,2,2006.563,1,125,0)
IMPORTER RAD DX CODE NAME
"BLD",3463,4,2006.563,2,2006.563,1,126,0)
IMPORTER RAD FILM SIZE
"BLD",3463,4,2006.563,2,2006.563,1,127,0)
IMPORTER RAD FILM SIZE NAME
"BLD",3463,4,2006.563,2,2006.563,1,128,0)
IMPORT RAD TECH
"BLD",3463,4,2006.563,2,2006.563,1,129,0)
IMPORTER RAD TECH NAME
"BLD",3463,4,2006.563,222)
y^y^p^^^^n^^n
"BLD",3463,4,2006.563,224)

"BLD",3463,4,2006.571,0)
2006.571
"BLD",3463,4,2006.571,2,0)
^9.641^2006.571^1
"BLD",3463,4,2006.571,2,2006.571,0)
DICOM RAW IMAGE  (File-top level)
"BLD",3463,4,2006.571,2,2006.571,1,0)
^9.6411^6^3
"BLD",3463,4,2006.571,2,2006.571,1,4,0)
ORIGIN INDEX
"BLD",3463,4,2006.571,2,2006.571,1,5,0)
MEDIA
"BLD",3463,4,2006.571,2,2006.571,1,6,0)
OLDPATH
"BLD",3463,4,2006.571,222)
y^y^p^^^^n^^n
"BLD",3463,4,2006.571,224)

"BLD",3463,4,2006.5751,0)
2006.5751
"BLD",3463,4,2006.5751,222)
y^y^f^^^^n
"BLD",3463,4,2006.5752,0)
2006.5752
"BLD",3463,4,2006.5752,222)
y^y^f^^^^n
"BLD",3463,4,2006.5757,0)
2006.5757
"BLD",3463,4,2006.5757,222)
y^y^f^^^^n
"BLD",3463,4,2006.5758,0)
2006.5758
"BLD",3463,4,2006.5758,222)
y^y^f^^^^n
"BLD",3463,4,2006.5759,0)
2006.5759
"BLD",3463,4,2006.5759,222)
y^y^f^^^^n
"BLD",3463,4,2006.588,0)
2006.588
"BLD",3463,4,2006.588,222)
y^y^f^^^^n
"BLD",3463,4,"APDD",2006.571,2006.571)

"BLD",3463,4,"APDD",2006.563,2006.563)

"BLD",3463,4,"APDD",2006.563,2006.563,114)

"BLD",3463,4,"APDD",2006.563,2006.563,115)

"BLD",3463,4,"APDD",2006.563,2006.563,116)

"BLD",3463,4,"APDD",2006.563,2006.563,117)

"BLD",3463,4,"APDD",2006.563,2006.563,118)

"BLD",3463,4,"APDD",2006.563,2006.563,119)

"BLD",3463,4,"APDD",2006.563,2006.563,120)

"BLD",3463,4,"APDD",2006.563,2006.563,121)

"BLD",3463,4,"APDD",2006.563,2006.563,122)

"BLD",3463,4,"APDD",2006.563,2006.563,123)

"BLD",3463,4,"APDD",2006.563,2006.563,124)

"BLD",3463,4,"APDD",2006.563,2006.563,125)

"BLD",3463,4,"APDD",2006.563,2006.563,126)

"BLD",3463,4,"APDD",2006.563,2006.563,127)

"BLD",3463,4,"APDD",2006.563,2006.563,128)

"BLD",3463,4,"APDD",2006.563,2006.563,129)

"BLD",3463,4,"APDD",2006.563,2006.563,79)

"BLD",3463,4,"APDD",2006.563,2006.563,81)

"BLD",3463,4,"APDD",2006.563,2006.563,93)

"BLD",3463,4,"APDD",2006.563,2006.563,99)

"BLD",3463,4,"APDD",2006.571,2006.571)

"BLD",3463,4,"APDD",2006.571,2006.571,4)

"BLD",3463,4,"APDD",2006.571,2006.571,5)

"BLD",3463,4,"APDD",2006.571,2006.571,6)

"BLD",3463,4,"B",2006.563,2006.563)

"BLD",3463,4,"B",2006.571,2006.571)

"BLD",3463,4,"B",2006.5751,2006.5751)

"BLD",3463,4,"B",2006.5752,2006.5752)

"BLD",3463,4,"B",2006.5757,2006.5757)

"BLD",3463,4,"B",2006.5758,2006.5758)

"BLD",3463,4,"B",2006.5759,2006.5759)

"BLD",3463,4,"B",2006.588,2006.588)

"BLD",3463,"ABNS",0)
^9.66A^^
"BLD",3463,"ABPKG")
n^n^G.IMAGING DEVELOPMENT TEAM@DOMAIN.EXT
"BLD",3463,"INID")
n^y^n
"BLD",3463,"INIT")
POST^MAGIPS53
"BLD",3463,"KRN",0)
^9.67PA^8994^19
"BLD",3463,"KRN",.4,0)
.4
"BLD",3463,"KRN",.4,"NM",0)
^9.68A^^
"BLD",3463,"KRN",.401,0)
.401
"BLD",3463,"KRN",.401,"NM",0)
^9.68A^^
"BLD",3463,"KRN",.402,0)
.402
"BLD",3463,"KRN",.402,"NM",0)
^9.68A^^
"BLD",3463,"KRN",.403,0)
.403
"BLD",3463,"KRN",.5,0)
.5
"BLD",3463,"KRN",.84,0)
.84
"BLD",3463,"KRN",.84,"NM",0)
^9.68A^^
"BLD",3463,"KRN",3.6,0)
3.6
"BLD",3463,"KRN",3.8,0)
3.8
"BLD",3463,"KRN",9.2,0)
9.2
"BLD",3463,"KRN",9.8,0)
9.8
"BLD",3463,"KRN",9.8,"NM",0)
^9.68A^11^11
"BLD",3463,"KRN",9.8,"NM",1,0)
MAGBRTK^^0^B20097310
"BLD",3463,"KRN",9.8,"NM",2,0)
MAGDAIRF^^0^B25028969
"BLD",3463,"KRN",9.8,"NM",3,0)
MAGDAIRG^^0^B53876343
"BLD",3463,"KRN",9.8,"NM",4,0)
MAGDIR81^^0^B80768896
"BLD",3463,"KRN",9.8,"NM",5,0)
MAGDIR8R^^0^B53835298
"BLD",3463,"KRN",9.8,"NM",6,0)
MAGDIR9A^^0^B52130794
"BLD",3463,"KRN",9.8,"NM",7,0)
MAGDIR9B^^0^B19341690
"BLD",3463,"KRN",9.8,"NM",8,0)
MAGDLBAA^^0^B19867393
"BLD",3463,"KRN",9.8,"NM",9,0)
MAGDRPC9^^0^B56624389
"BLD",3463,"KRN",9.8,"NM",10,0)
MAGDRPCA^^0^B90688059
"BLD",3463,"KRN",9.8,"NM",11,0)
MAGDRPCB^^0^B129146302
"BLD",3463,"KRN",9.8,"NM","B","MAGBRTK",1)

"BLD",3463,"KRN",9.8,"NM","B","MAGDAIRF",2)

"BLD",3463,"KRN",9.8,"NM","B","MAGDAIRG",3)

"BLD",3463,"KRN",9.8,"NM","B","MAGDIR81",4)

"BLD",3463,"KRN",9.8,"NM","B","MAGDIR8R",5)

"BLD",3463,"KRN",9.8,"NM","B","MAGDIR9A",6)

"BLD",3463,"KRN",9.8,"NM","B","MAGDIR9B",7)

"BLD",3463,"KRN",9.8,"NM","B","MAGDLBAA",8)

"BLD",3463,"KRN",9.8,"NM","B","MAGDRPC9",9)

"BLD",3463,"KRN",9.8,"NM","B","MAGDRPCA",10)

"BLD",3463,"KRN",9.8,"NM","B","MAGDRPCB",11)

"BLD",3463,"KRN",9.8,"NM","B","MAGIPS53",12)

"BLD",3463,"KRN",19,0)
19
"BLD",3463,"KRN",19,"NM",0)
^9.68A^5^5
"BLD",3463,"KRN",19,"NM",1,0)
MAG BUILD OUT IMG LOC^^0
"BLD",3463,"KRN",19,"NM",2,0)
MAG CHECK OUT IMG LOC^^0
"BLD",3463,"KRN",19,"NM",3,0)
MAG DISPLAY IMPORTER^^0
"BLD",3463,"KRN",19,"NM",4,0)
MAG IMPORTER MENU^^0
"BLD",3463,"KRN",19,"NM",5,0)
MAG SYS MENU^^2
"BLD",3463,"KRN",19,"NM","B","MAG BUILD OUT IMG LOC",1)

"BLD",3463,"KRN",19,"NM","B","MAG CHECK OUT IMG LOC",2)

"BLD",3463,"KRN",19,"NM","B","MAG DISPLAY IMPORTER",3)

"BLD",3463,"KRN",19,"NM","B","MAG IMPORTER MENU",4)

"BLD",3463,"KRN",19,"NM","B","MAG SYS MENU",5)

"BLD",3463,"KRN",19.1,0)
19.1
"BLD",3463,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",3463,"KRN",101,0)
101
"BLD",3463,"KRN",101,"NM",0)
^9.68A^^
"BLD",3463,"KRN",409.61,0)
409.61
"BLD",3463,"KRN",771,0)
771
"BLD",3463,"KRN",771,"NM",0)
^9.68A^^
"BLD",3463,"KRN",870,0)
870
"BLD",3463,"KRN",870,"NM",0)
^9.68A^^
"BLD",3463,"KRN",8989.51,0)
8989.51
"BLD",3463,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",3463,"KRN",8989.52,0)
8989.52
"BLD",3463,"KRN",8994,0)
8994
"BLD",3463,"KRN",8994,"NM",0)
^9.68A^17^17
"BLD",3463,"KRN",8994,"NM",1,0)
MAG DICOM ADD CAMERA EQUIP RM^^0
"BLD",3463,"KRN",8994,"NM",2,0)
MAG DICOM GET DFN^^0
"BLD",3463,"KRN",8994,"NM",3,0)
MAG DICOM GET HOSP LOCATION^^0
"BLD",3463,"KRN",8994,"NM",4,0)
MAG DICOM GET RAD CAMERA^^0
"BLD",3463,"KRN",8994,"NM",5,0)
MAG DICOM GET RAD CPT MOD^^0
"BLD",3463,"KRN",8994,"NM",6,0)
MAG DICOM GET RAD DX CODE^^0
"BLD",3463,"KRN",8994,"NM",7,0)
MAG DICOM GET RAD FILM^^0
"BLD",3463,"KRN",8994,"NM",8,0)
MAG DICOM GET RAD INFO BY ACN^^0
"BLD",3463,"KRN",8994,"NM",9,0)
MAG DICOM GET RAD ORDERS^^0
"BLD",3463,"KRN",8994,"NM",10,0)
MAG DICOM GET RAD PERSON^^0
"BLD",3463,"KRN",8994,"NM",11,0)
MAG DICOM GET USERNAME^^0
"BLD",3463,"KRN",8994,"NM",12,0)
MAG DICOM IMPORTER CHECK UIDS^^0
"BLD",3463,"KRN",8994,"NM",13,0)
MAG DICOM IMPORTER DELETE^^0
"BLD",3463,"KRN",8994,"NM",14,0)
MAG DICOM IMPORTER LOOKUP^^0
"BLD",3463,"KRN",8994,"NM",15,0)
MAG DICOM RADIOLOGY MODIFIERS^^0
"BLD",3463,"KRN",8994,"NM",16,0)
MAG DICOM RADIOLOGY PROCEDURES^^0
"BLD",3463,"KRN",8994,"NM",17,0)
MAG DICOM SET IMAGING LOCATION^^0
"BLD",3463,"KRN",8994,"NM","B","MAG DICOM ADD CAMERA EQUIP RM",1)

"BLD",3463,"KRN",8994,"NM","B","MAG DICOM GET DFN",2)

"BLD",3463,"KRN",8994,"NM","B","MAG DICOM GET HOSP LOCATION",3)

"BLD",3463,"KRN",8994,"NM","B","MAG DICOM GET RAD CAMERA",4)

"BLD",3463,"KRN",8994,"NM","B","MAG DICOM GET RAD CPT MOD",5)

"BLD",3463,"KRN",8994,"NM","B","MAG DICOM GET RAD DX CODE",6)

"BLD",3463,"KRN",8994,"NM","B","MAG DICOM GET RAD FILM",7)

"BLD",3463,"KRN",8994,"NM","B","MAG DICOM GET RAD INFO BY ACN",8)

"BLD",3463,"KRN",8994,"NM","B","MAG DICOM GET RAD ORDERS",9)

"BLD",3463,"KRN",8994,"NM","B","MAG DICOM GET RAD PERSON",10)

"BLD",3463,"KRN",8994,"NM","B","MAG DICOM GET USERNAME",11)

"BLD",3463,"KRN",8994,"NM","B","MAG DICOM IMPORTER CHECK UIDS",12)

"BLD",3463,"KRN",8994,"NM","B","MAG DICOM IMPORTER DELETE",13)

"BLD",3463,"KRN",8994,"NM","B","MAG DICOM IMPORTER LOOKUP",14)

"BLD",3463,"KRN",8994,"NM","B","MAG DICOM RADIOLOGY MODIFIERS",15)

"BLD",3463,"KRN",8994,"NM","B","MAG DICOM RADIOLOGY PROCEDURES",16)

"BLD",3463,"KRN",8994,"NM","B","MAG DICOM SET IMAGING LOCATION",17)

"BLD",3463,"KRN","B",.4,.4)

"BLD",3463,"KRN","B",.401,.401)

"BLD",3463,"KRN","B",.402,.402)

"BLD",3463,"KRN","B",.403,.403)

"BLD",3463,"KRN","B",.5,.5)

"BLD",3463,"KRN","B",.84,.84)

"BLD",3463,"KRN","B",3.6,3.6)

"BLD",3463,"KRN","B",3.8,3.8)

"BLD",3463,"KRN","B",9.2,9.2)

"BLD",3463,"KRN","B",9.8,9.8)

"BLD",3463,"KRN","B",19,19)

"BLD",3463,"KRN","B",19.1,19.1)

"BLD",3463,"KRN","B",101,101)

"BLD",3463,"KRN","B",409.61,409.61)

"BLD",3463,"KRN","B",771,771)

"BLD",3463,"KRN","B",870,870)

"BLD",3463,"KRN","B",8989.51,8989.51)

"BLD",3463,"KRN","B",8989.52,8989.52)

"BLD",3463,"KRN","B",8994,8994)

"BLD",3463,"REQB",0)
^9.611^2^2
"BLD",3463,"REQB",1,0)
MAG*.3.0*54^2
"BLD",3463,"REQB",2,0)
RA*5.0*90^2
"BLD",3463,"REQB","B","MAG*.3.0*54",1)

"BLD",3463,"REQB","B","RA*5.0*90",2)

"FIA",2006.563)
DICOM GATEWAY PARAMETER
"FIA",2006.563,0)
^MAGDICOM(2006.563,
"FIA",2006.563,0,0)
2006.563
"FIA",2006.563,0,1)
y^y^p^^^^n^^n
"FIA",2006.563,0,10)

"FIA",2006.563,0,11)

"FIA",2006.563,0,"RLRO")

"FIA",2006.563,2006.563)
1
"FIA",2006.563,2006.563,79)

"FIA",2006.563,2006.563,81)

"FIA",2006.563,2006.563,93)

"FIA",2006.563,2006.563,99)

"FIA",2006.563,2006.563,114)

"FIA",2006.563,2006.563,115)

"FIA",2006.563,2006.563,116)

"FIA",2006.563,2006.563,117)

"FIA",2006.563,2006.563,118)

"FIA",2006.563,2006.563,119)

"FIA",2006.563,2006.563,120)

"FIA",2006.563,2006.563,121)

"FIA",2006.563,2006.563,122)

"FIA",2006.563,2006.563,123)

"FIA",2006.563,2006.563,124)

"FIA",2006.563,2006.563,125)

"FIA",2006.563,2006.563,126)

"FIA",2006.563,2006.563,127)

"FIA",2006.563,2006.563,128)

"FIA",2006.563,2006.563,129)

"FIA",2006.571)
DICOM RAW IMAGE
"FIA",2006.571,0)
^MAGDINPT(2006.571,
"FIA",2006.571,0,0)
2006.571
"FIA",2006.571,0,1)
y^y^p^^^^n^^n
"FIA",2006.571,0,10)

"FIA",2006.571,0,11)

"FIA",2006.571,0,"RLRO")

"FIA",2006.571,2006.571)
1
"FIA",2006.571,2006.571,4)

"FIA",2006.571,2006.571,5)

"FIA",2006.571,2006.571,6)

"FIA",2006.5751)
DICOM OBJECTS TO BE IMPORTED
"FIA",2006.5751,0)
^MAGDICOM(2006.5751,
"FIA",2006.5751,0,0)
2006.5751
"FIA",2006.5751,0,1)
y^y^f^^^^n
"FIA",2006.5751,0,10)

"FIA",2006.5751,0,11)

"FIA",2006.5751,0,"RLRO")

"FIA",2006.5751,2006.5751)
0
"FIA",2006.5752)
IMPORTABLE DICOM OBJECTS
"FIA",2006.5752,0)
^MAGD(2006.5752,
"FIA",2006.5752,0,0)
2006.5752
"FIA",2006.5752,0,1)
y^y^f^^^^n
"FIA",2006.5752,0,10)

"FIA",2006.5752,0,11)

"FIA",2006.5752,0,"RLRO")

"FIA",2006.5752,2006.5752)
0
"FIA",2006.5757)
DICOM RADIOLOGY PROCEDURE MODIFIERS
"FIA",2006.5757,0)
^MAGDICOM(2006.5757,
"FIA",2006.5757,0,0)
2006.5757
"FIA",2006.5757,0,1)
y^y^f^^^^n
"FIA",2006.5757,0,10)

"FIA",2006.5757,0,11)

"FIA",2006.5757,0,"RLRO")

"FIA",2006.5757,2006.5757)
0
"FIA",2006.5758)
DICOM RADIOLOGY PROCEDURES
"FIA",2006.5758,0)
^MAGDICOM(2006.5758,
"FIA",2006.5758,0,0)
2006.5758
"FIA",2006.5758,0,1)
y^y^f^^^^n
"FIA",2006.5758,0,10)

"FIA",2006.5758,0,11)

"FIA",2006.5758,0,"RLRO")

"FIA",2006.5758,2006.5758)
0
"FIA",2006.5759)
OUTSIDE IMAGING LOCATION
"FIA",2006.5759,0)
^MAGD(2006.5759,
"FIA",2006.5759,0,0)
2006.5759P
"FIA",2006.5759,0,1)
y^y^f^^^^n
"FIA",2006.5759,0,10)

"FIA",2006.5759,0,11)

"FIA",2006.5759,0,"RLRO")

"FIA",2006.5759,2006.5759)
0
"FIA",2006.588)
APPLICATION ENTITY TITLE
"FIA",2006.588,0)
^MAGDICOM(2006.588,
"FIA",2006.588,0,0)
2006.588
"FIA",2006.588,0,1)
y^y^f^^^^n
"FIA",2006.588,0,10)

"FIA",2006.588,0,11)

"FIA",2006.588,0,"RLRO")

"FIA",2006.588,2006.588)
0
"INIT")
POST^MAGIPS53
"IX",2006.5752,2006.5752,"D",0)
2006.5752^D^Cross reference by machine id and physical path for imported images.^R^^R^IR^I^2006.5752^^^^^LS
"IX",2006.5752,2006.5752,"D",.1,0)
^^3^3^3090522^^^
"IX",2006.5752,2006.5752,"D",.1,1,0)
This cross reference is set by routine MAGDIR8R and is used for a quick
"IX",2006.5752,2006.5752,"D",.1,2,0)
lookup for an individual DICOM Gateway and it's associated path where
"IX",2006.5752,2006.5752,"D",.1,3,0)
the images were read from.  ex: ^MAGD(2006.5752,"D",MACHINE ID,PHYSICAL PATH,DA)=""
"IX",2006.5752,2006.5752,"D",1)
S ^MAGD(2006.5752,"D",$E(X(1),1,30),$E(X(2),1,30),DA)=""
"IX",2006.5752,2006.5752,"D",2)
K ^MAGD(2006.5752,"D",$E(X(1),1,30),$E(X(2),1,30),DA)
"IX",2006.5752,2006.5752,"D",2.5)
K ^MAGD(2006.5752,"D")
"IX",2006.5752,2006.5752,"D",11.1,0)
^.114IA^2^2
"IX",2006.5752,2006.5752,"D",11.1,1,0)
1^F^2006.5752^3^30^1^F
"IX",2006.5752,2006.5752,"D",11.1,1,3)

"IX",2006.5752,2006.5752,"D",11.1,2,0)
2^F^2006.5752^31^30^2^F
"IX",2006.5752,2006.5752,"D",11.1,2,3)

"IX",2006.5759,2006.5759,"D",0)
2006.5759^D^Groups entries by INSTITUTION and IMAGING TYPE.^R^^R^IR^I^2006.5759^^^^^LS
"IX",2006.5759,2006.5759,"D",.1,0)
^^3^3^3090423^^^^
"IX",2006.5759,2006.5759,"D",.1,1,0)
The cross reference is needed by routines MAGDAIRF and MAGDRPCA.  This
"IX",2006.5759,2006.5759,"D",.1,2,0)
cross reference will facilitate sorting by institution especially within
"IX",2006.5759,2006.5759,"D",.1,3,0)
a consolidated database and each institution has their own DICOM Gateway. 
"IX",2006.5759,2006.5759,"D",1)
S ^MAGD(2006.5759,"D",X(1),X(2),DA)=""
"IX",2006.5759,2006.5759,"D",2)
K ^MAGD(2006.5759,"D",X(1),X(2),DA)
"IX",2006.5759,2006.5759,"D",2.5)
K ^MAGD(2006.5759,"D")
"IX",2006.5759,2006.5759,"D",11.1,0)
^.114IA^2^2
"IX",2006.5759,2006.5759,"D",11.1,1,0)
1^F^2006.5759^4^^1^F
"IX",2006.5759,2006.5759,"D",11.1,2,0)
2^F^2006.5759^2^^2^F
"KRN",19,123457,-1)
0^1
"KRN",19,123457,0)
MAG BUILD OUT IMG LOC^Build Outside Imaging Location file^^R^^^^^^^^IMAGING
"KRN",19,123457,1,0)
^19.06^3^3^3090122^^^
"KRN",19,123457,1,1,0)
Use this menu option to populate file Outside Imaging Location (2006.5759).
"KRN",19,123457,1,2,0)
A warning message is displayed if Radiology's IMAGING LOCATION (#79.1)
"KRN",19,123457,1,3,0)
file does not have entries defined as 'no credit'.
"KRN",19,123457,25)
UPDATE^MAGDAIRF
"KRN",19,123457,"U")
BUILD OUTSIDE IMAGING LOCATION
"KRN",19,123458,-1)
0^2
"KRN",19,123458,0)
MAG CHECK OUT IMG LOC^Check Outside Imaging Location file^^R^^^^^^^^IMAGING^^
"KRN",19,123458,1,0)
^19.06^1^1^3090122^^
"KRN",19,123458,1,1,0)
Menu option to validate entries in Outside Imaging Location file (#2006.5759).
"KRN",19,123458,20)

"KRN",19,123458,25)
DISPLAY^MAGDAIRG()
"KRN",19,123458,"U")
CHECK OUTSIDE IMAGING LOCATION
"KRN",19,123459,-1)
0^3
"KRN",19,123459,0)
MAG DISPLAY IMPORTER^Display Studies to be Imported^^R^^^^^^^^IMAGING
"KRN",19,123459,1,0)
^19.06^2^2^3090122^^^^
"KRN",19,123459,1,1,0)
This menu option will display all entries ready to be imported.
"KRN",19,123459,1,2,0)
All entries are sorted by individual Gateways.
"KRN",19,123459,25)
DISPLAY^MAGDIR8R
"KRN",19,123459,"U")
DISPLAY STUDIES TO BE IMPORTED
"KRN",19,123460,-1)
0^4
"KRN",19,123460,1,1,0)
Menu options used to setup Imaging Outside Locations in file 2006.5759
"KRN",19,123460,1,2,0)
and to display entries to be imported on the DICOM Gateways.
"KRN",19,123460,10,5,0)
23204
"KRN",19,123460,10,5,"^")
MAG CHECK OUT IMG LOC
"KRN",19,123460,10,6,0)
23205
"KRN",19,123460,10,6,"^")
MAG BUILD OUT IMG LOC
"KRN",19,123460,0)
MAG IMPORTER MENU^Importer Menu^^M^133^^^^^^^454
"KRN",19,123460,10,0)
^19.01IP^7^6
"KRN",19,123460,10,7,0)
23206
"KRN",19,123460,10,7,"^")
MAG DISPLAY IMPORTER
"KRN",19,123460,"U")
IMPORTER MENU
"KRN",19,123461,-1)
2^5
"KRN",19,123461,0)
MAG SYS MENU^Imaging System Manager Menu^^M^133^MAG SYSTEM^^^^^^454
"KRN",19,123461,10,0)
^19.01IP^17^8
"KRN",19,123461,10,17,0)
23238
"KRN",19,123461,10,17,"^")
MAG IMPORTER MENU
"KRN",19,123461,"U")
IMAGING SYSTEM MANAGER MENU
"KRN",8994,123462,-1)
0^1
"KRN",8994,123462,0)
MAG DICOM ADD CAMERA EQUIP RM^ADDROOM^MAGDRPCB^2
"KRN",8994,123462,1,0)
^8994.01^2^2^3100121^^^^
"KRN",8994,123462,1,1,0)
Check the OUTSIDE STUDY Camera Equipment Room for the IMAGING LOCATION.
"KRN",8994,123462,1,2,0)
If it is not present, add it.
"KRN",8994,123462,2,0)
^8994.02A^1^1
"KRN",8994,123462,2,1,0)
RAEXAM^1^^1^1
"KRN",8994,123462,2,1,1,0)
^8994.021^4^4^3100121^^^^
"KRN",8994,123462,2,1,1,1,0)
String of exam/case identifiers separated by '^':
"KRN",8994,123462,2,1,1,2,0)
  ^01: IEN of the patient in the RAD/NUC MED PATIENT file (#70)
"KRN",8994,123462,2,1,1,3,0)
  ^02: IEN in the REGISTERED EXAMS multiple (sub-file #70.02)
"KRN",8994,123462,2,1,1,4,0)
  ^03: IEN in the EXAMINATIONS multiple (sub-file #70.03)
"KRN",8994,123462,2,"B","RAEXAM",1)

"KRN",8994,123462,2,"PARAMSEQ",1,1)

"KRN",8994,123462,3,0)
^8994.03^1^1^3100121^^^^
"KRN",8994,123462,3,1,0)
Success/Error results
"KRN",8994,123463,-1)
0^2
"KRN",8994,123463,0)
MAG DICOM GET DFN^GETDFN^MAGDRPCA^1^P
"KRN",8994,123463,1,0)
^^1^1^3071101^
"KRN",8994,123463,1,1,0)
Given an ICN, it returns the DFN.
"KRN",8994,123463,2,0)
^8994.02A^1^1
"KRN",8994,123463,2,1,0)
ICN^1^^1^1
"KRN",8994,123463,2,1,1,0)
^^1^1^3071101^
"KRN",8994,123463,2,1,1,1,0)
Integration Control Number
"KRN",8994,123463,2,"B","ICN",1)

"KRN",8994,123463,2,"PARAMSEQ",1,1)

"KRN",8994,123463,3,0)
^^1^1^3071101^
"KRN",8994,123463,3,1,0)
DFN
"KRN",8994,123464,-1)
0^3
"KRN",8994,123464,0)
MAG DICOM GET HOSP LOCATION^GETLOC^MAGDRPCB^2^P
"KRN",8994,123464,1,0)
^^1^1^3090818^
"KRN",8994,123464,1,1,0)
Return a list of matching hospital locations
"KRN",8994,123464,2,0)
^8994.02A^1^1
"KRN",8994,123464,2,1,0)
LOCATION^1^30^1^1
"KRN",8994,123464,2,1,1,0)
^^1^1^3090818^
"KRN",8994,123464,2,1,1,1,0)
Hospital location to look up.
"KRN",8994,123464,2,"B","LOCATION",1)

"KRN",8994,123464,2,"PARAMSEQ",1,1)

"KRN",8994,123464,3,0)
^^1^1^3090818^
"KRN",8994,123464,3,1,0)
List of matching hospital locations in "ien^name" format.
"KRN",8994,123465,-1)
0^4
"KRN",8994,123465,0)
MAG DICOM GET RAD CAMERA^CAMERA^MAGDRPCB^2^R^0^^^3
"KRN",8994,123465,1,0)
^8994.01^1^1^3090107^^^^
"KRN",8994,123465,1,1,0)
Used to find an entry in file CAMERA/EQUIP/RM (#78.6)
"KRN",8994,123465,2,0)
^8994.02A^1^1
"KRN",8994,123465,2,1,0)
CAMERA^1^30^1^1
"KRN",8994,123465,2,1,1,0)
^8994.021^2^2^3090107^^^^
"KRN",8994,123465,2,1,1,1,0)
The name of the entry expected to be found in file CAMERA/EQUIP/RM 
"KRN",8994,123465,2,1,1,2,0)
(#78.6.)
"KRN",8994,123465,2,"B","CAMERA",1)

"KRN",8994,123465,2,"PARAMSEQ",1,1)

"KRN",8994,123465,3,0)
^^3^3^3090107^
"KRN",8994,123465,3,1,0)
Returns:
"KRN",8994,123465,3,2,0)
RESULTS(1)= -1 (entry not found) or 1 (entry found)
"KRN",8994,123465,3,3,0)
RESULTS(2)= ien^name of entry^description of entry.
"KRN",8994,123466,-1)
0^5
"KRN",8994,123466,0)
MAG DICOM GET RAD CPT MOD^CPTMOD^MAGDRPCB^2^R^0^^^3
"KRN",8994,123466,1,0)
^8994.01^1^1^3090107^^^^
"KRN",8994,123466,1,1,0)
This RPC is used to return a valid entry in the CPT MODIFIER file (#81.3).
"KRN",8994,123466,2,0)
^8994.02A^3^2
"KRN",8994,123466,2,2,0)
CPTMOD^1^30^1^1
"KRN",8994,123466,2,2,1,0)
^8994.021^1^1^3090107^^
"KRN",8994,123466,2,2,1,1,0)
This is the name of the CPT modifier.
"KRN",8994,123466,2,3,0)
MAGDT^1^30^0^2
"KRN",8994,123466,2,3,1,0)
^8994.021^2^2^3090107^^
"KRN",8994,123466,2,3,1,1,0)
This is the date used during the lookup process for screening
"KRN",8994,123466,2,3,1,2,0)
'active' CPT modifiers.
"KRN",8994,123466,2,"B","CPTMOD",2)

"KRN",8994,123466,2,"B","MAGDT",3)

"KRN",8994,123466,2,"PARAMSEQ",1,2)

"KRN",8994,123466,2,"PARAMSEQ",2,3)

"KRN",8994,123466,3,0)
^8994.03^2^2^3090107^^^^
"KRN",8994,123466,3,1,0)
RESULTS(1)= -1 (entry not found) or 1 (entry found)
"KRN",8994,123466,3,2,0)
RESULTS(2)= ien^CPT name
"KRN",8994,123467,-1)
0^6
"KRN",8994,123467,0)
MAG DICOM GET RAD DX CODE^DXCODE^MAGDRPCB^2^R^0^^^3
"KRN",8994,123467,1,0)
^8994.01^1^1^3090107^^^^
"KRN",8994,123467,1,1,0)
This RPC is used to lookup an entry in file DIAGNOSTIC CODES (78.3).
"KRN",8994,123467,2,0)
^8994.02A^2^1
"KRN",8994,123467,2,2,0)
DXCODE^1^30^1^1
"KRN",8994,123467,2,2,1,0)
^8994.021^1^1^3090107^^^^
"KRN",8994,123467,2,2,1,1,0)
This is the diagnostic name to be used in the lookup process.
"KRN",8994,123467,2,"B","DXCODE",2)

"KRN",8994,123467,2,"PARAMSEQ",1,2)

"KRN",8994,123467,3,0)
^8994.03^2^2^3090107^^^^
"KRN",8994,123467,3,1,0)
RESULTS(1)= -1 (entry not found) or 1 (entry found)
"KRN",8994,123467,3,2,0)
RESULTS(2)= ien^diagnostic name
"KRN",8994,123468,-1)
0^7
"KRN",8994,123468,0)
MAG DICOM GET RAD FILM^FILM^MAGDRPCB^2^R^0^^^3
"KRN",8994,123468,1,0)
^8994.01^1^1^3090107^^^^
"KRN",8994,123468,1,1,0)
This RPC is used to find an entry in the FILM SIZE file (#78.4).
"KRN",8994,123468,2,0)
^8994.02A^1^1
"KRN",8994,123468,2,1,0)
FILM^1^30^1^1
"KRN",8994,123468,2,1,1,0)
^8994.021^1^1^3090107^^^
"KRN",8994,123468,2,1,1,1,0)
This is the name of the film size to be used in the lookup process.
"KRN",8994,123468,2,"B","FILM",1)

"KRN",8994,123468,2,"PARAMSEQ",1,1)

"KRN",8994,123468,3,0)
^8994.03^2^2^3090107^^
"KRN",8994,123468,3,1,0)
RESULTS(1)= -1 (entry not found) or 1 (entry found)
"KRN",8994,123468,3,2,0)
RESULTS(2)= ien^film size name
"KRN",8994,123469,-1)
0^8
"KRN",8994,123469,0)
MAG DICOM GET RAD INFO BY ACN^ACNUMB^MAGDRPCA^1^R^0^^^3
"KRN",8994,123469,1,0)
^8994.01^1^1^3090107^^^^
"KRN",8994,123469,1,1,0)
This RPC takes the Accession Number and returns the first radiology study that matches it.  This RPC uses $$ACCFIND^RAAPI() to get this information.
"KRN",8994,123469,2,0)
^8994.02A^1^1
"KRN",8994,123469,2,1,0)
ACNUMB^1^30^1^1
"KRN",8994,123469,2,1,1,0)
^8994.021^2^2^3090107^^^^
"KRN",8994,123469,2,1,1,1,0)
The accession number in either a 'sss-mmddyy-xxxxx' or
"KRN",8994,123469,2,1,1,2,0)
   'mmddyy-xxxxx' format
"KRN",8994,123469,2,"B","ACNUMB",1)

"KRN",8994,123469,2,"PARAMSEQ",1,1)

"KRN",8994,123469,3,0)
^8994.03^5^5^3090107^^
"KRN",8994,123469,3,1,0)
The results will be either:
"KRN",8994,123469,3,2,0)
If successful:    1^RADFN_^_RADTI_^_RACNI_^_IMAGLOCN
"KRN",8994,123469,3,3,0)
If unsuccessful: -1^"invalid site accession number format"^accession #
"KRN",8994,123469,3,4,0)
 or -2^"invalid accession number format"^accession #
"KRN",8994,123469,3,5,0)
 or -3^"no data associated with this accession number"^accession #
"KRN",8994,123470,-1)
0^9
"KRN",8994,123470,0)
MAG DICOM GET RAD ORDERS^ORDERS^MAGDRPCB^2
"KRN",8994,123470,1,0)
^^1^1^3091027^
"KRN",8994,123470,1,1,0)
Return a list of radiology orders for a patient
"KRN",8994,123470,2,0)
^8994.02A^1^1
"KRN",8994,123470,2,1,0)
DFN^1^^1^1
"KRN",8994,123470,2,1,1,0)
^^1^1^3091027^
"KRN",8994,123470,2,1,1,1,0)
Standard pointer to PATIENT file #2.
"KRN",8994,123470,2,"B","DFN",1)

"KRN",8994,123470,2,"PARAMSEQ",1,1)

"KRN",8994,123470,3,0)
^^1^1^3091027^
"KRN",8994,123470,3,1,0)
List of radiogy orders for the patient.
"KRN",8994,123471,-1)
0^10
"KRN",8994,123471,0)
MAG DICOM GET RAD PERSON^RADLST^MAGDRPCB^2^R^0^^0^3
"KRN",8994,123471,1,0)
^8994.01^1^1^3090107^^^^
"KRN",8994,123471,1,1,0)
Returns list of names from the NEW PERSON file (#200) with a Rad/Nuc class.
"KRN",8994,123471,2,0)
^8994.02A^3^2
"KRN",8994,123471,2,2,0)
CLASS^1^30^1^1
"KRN",8994,123471,2,2,1,0)
^8994.021^2^2^3090107^^
"KRN",8994,123471,2,2,1,1,0)
This is the RAD/NUC classification used to correlate matching entries.
"KRN",8994,123471,2,2,1,2,0)
Input value: T (technologist), R (resident), S (staff), or C (clerk). 
"KRN",8994,123471,2,3,0)
NAME^1^30^1^2
"KRN",8994,123471,2,3,1,0)
^8994.021^1^1^3090107^^^
"KRN",8994,123471,2,3,1,1,0)
This is the name to be used in the lookup process.
"KRN",8994,123471,2,"B","CLASS",2)

"KRN",8994,123471,2,"B","NAME",3)

"KRN",8994,123471,2,"PARAMSEQ",1,2)

"KRN",8994,123471,2,"PARAMSEQ",2,3)

"KRN",8994,123471,3,0)
^8994.03^7^7^3090107^^^^
"KRN",8994,123471,3,1,0)
Unsuccessful lookup returns:
"KRN",8994,123471,3,2,0)
 RESULTS(1)="-1^No provider matching input."
"KRN",8994,123471,3,3,0)
 RESULTS(1)="-2,More than "_MAXNR_" matches; please specify"
"KRN",8994,123471,3,4,0)
 RESULTS(1)=RESULTS(1)_" more characters in the name."
"KRN",8994,123471,3,5,0)
Successful lookup returns:
"KRN",8994,123471,3,6,0)
 RESULTS(1)= 1
"KRN",8994,123471,3,7,0)
 RESULTS(2)= ien^name
"KRN",8994,123472,-1)
0^11
"KRN",8994,123472,0)
MAG DICOM GET USERNAME^USERNAME^MAGDRPCB^1^R
"KRN",8994,123472,1,0)
^^1^1^3090820^
"KRN",8994,123472,1,1,0)
Returns the name of the user.
"KRN",8994,123472,3,0)
^^1^1^3090820^
"KRN",8994,123472,3,1,0)
Name of user from NEW PERSON file (#200).
"KRN",8994,123473,-1)
0^12
"KRN",8994,123473,0)
MAG DICOM IMPORTER CHECK UIDS^CHECKUID^MAGDRPCA^2^R^0^^^3
"KRN",8994,123473,1,0)
^8994.01^1^1^3090107^^^^
"KRN",8994,123473,1,1,0)
This RPC is used to lookup DICOM UIDs before importing images.
"KRN",8994,123473,2,0)
^8994.02A^2^2
"KRN",8994,123473,2,1,0)
UIDLIST^2^30^1^1
"KRN",8994,123473,2,1,1,0)
^8994.021^1^1^3090107^^^
"KRN",8994,123473,2,1,1,1,0)
This is a list of UIDs to be evaluated.
"KRN",8994,123473,2,2,0)
LEVEL^1^^1^2
"KRN",8994,123473,2,2,1,0)
^8994.021^1^1^3090107^^^
"KRN",8994,123473,2,2,1,1,0)
The value is either STUDY or SOP instance UID.
"KRN",8994,123473,2,"B","LEVEL",2)

"KRN",8994,123473,2,"B","UIDLIST",1)

"KRN",8994,123473,2,"PARAMSEQ",1,1)

"KRN",8994,123473,2,"PARAMSEQ",2,2)

"KRN",8994,123473,3,0)
^8994.03^1^1^3090107^^^^
"KRN",8994,123473,3,1,0)
Return a list that matched the UID provided.
"KRN",8994,123474,-1)
0^13
"KRN",8994,123474,0)
MAG DICOM IMPORTER DELETE^DELETE^MAGDRPCA^2^R^0^^^3
"KRN",8994,123474,1,0)
^8994.01^3^3^3090107^^
"KRN",8994,123474,1,1,0)
This RPC is used by the DICOM Gateway to delete an entry in file IMPORTABLE
"KRN",8994,123474,1,2,0)
DICOM OBJECTS (#2006.5752).  The entry to be deleted must match the Hostname,
"KRN",8994,123474,1,3,0)
OLDPATH (Gateway), and the image UID.
"KRN",8994,123474,2,0)
^8994.02A^3^3
"KRN",8994,123474,2,1,0)
MACHID^1^30^1^2
"KRN",8994,123474,2,1,1,0)
^8994.021^1^1^3090107^^^
"KRN",8994,123474,2,1,1,1,0)
This is the hostname of the DICOM Imaging Gateway running the Importer application.
"KRN",8994,123474,2,2,0)
FILEPATH^1^30^1^3
"KRN",8994,123474,2,2,1,0)
^8994.021^1^1^3090107^^^^
"KRN",8994,123474,2,2,1,1,0)
This is the path of the DICOM image file being deleted.
"KRN",8994,123474,2,3,0)
IMAGEUID^1^30^1^1
"KRN",8994,123474,2,3,1,0)
^8994.021^1^1^3090107^^^^
"KRN",8994,123474,2,3,1,1,0)
This is the image's SOP Instance UID.
"KRN",8994,123474,2,"B","FILEPATH",2)

"KRN",8994,123474,2,"B","IMAGEUID",3)

"KRN",8994,123474,2,"B","MACHID",1)

"KRN",8994,123474,2,"PARAMSEQ",1,3)

"KRN",8994,123474,2,"PARAMSEQ",2,1)

"KRN",8994,123474,2,"PARAMSEQ",3,2)

"KRN",8994,123475,-1)
0^14
"KRN",8994,123475,0)
MAG DICOM IMPORTER LOOKUP^LOOKUP^MAGDRPCA^1^R^0
"KRN",8994,123475,1,0)
^8994.01^1^1^3090327^^^
"KRN",8994,123475,1,1,0)
Return information about the image.
"KRN",8994,123475,2,0)
^8994.02A^1^1
"KRN",8994,123475,2,1,0)
MAGIEN^1^^1^1
"KRN",8994,123475,2,1,1,0)
^8994.021^1^1^3090327^^
"KRN",8994,123475,2,1,1,1,0)
The Internal Entry Number of the image entry in file 2005.
"KRN",8994,123475,2,"B","MAGIEN",1)

"KRN",8994,123475,2,"PARAMSEQ",1,1)

"KRN",8994,123475,3,0)
^8994.03^2^2^3090327^^
"KRN",8994,123475,3,1,0)
Returns patient demographics, case number, and study date, procedure 
"KRN",8994,123475,3,2,0)
and procedure modifier.
"KRN",8994,123476,-1)
0^15
"KRN",8994,123476,0)
MAG DICOM RADIOLOGY MODIFIERS^MOD^MAGDRPCA^2^R^0^^^3
"KRN",8994,123476,1,0)
^8994.01^1^1^3090107^^
"KRN",8994,123476,1,1,0)
This RPC returns a listing of entries from the PROCEDURES MODIFIER file (#71.2) sorted by Radiology' Imaging Type.
"KRN",8994,123477,-1)
0^16
"KRN",8994,123477,0)
MAG DICOM RADIOLOGY PROCEDURES^PROC^MAGDRPCA^2^R^0^^^3
"KRN",8994,123477,1,0)
1^8994.01^4^4^3090112^^^^
"KRN",8994,123477,1,1,0)
This RPC returns a list of Radiology Procedures for 'no-credit' Imaging
"KRN",8994,123477,1,2,0)
locations within a given division.
"KRN",8994,123477,1,3,0)
If the division does not have any 'no-credit' Imaging locations defined,
"KRN",8994,123477,1,4,0)
the results will return an error message indicating the problem.
"KRN",8994,123477,2,0)
^8994.02A^1^1
"KRN",8994,123477,2,1,0)
DIV^1^30^1^1
"KRN",8994,123477,2,1,1,0)
^8994.021^1^1^3090108^^
"KRN",8994,123477,2,1,1,1,0)
This is the division used during the lookup process.
"KRN",8994,123477,2,"B","DIV",1)

"KRN",8994,123477,2,"PARAMSEQ",1,1)

"KRN",8994,123478,-1)
0^17
"KRN",8994,123478,0)
MAG DICOM SET IMAGING LOCATION^IMAGELOC^MAGDRPCB^1
"KRN",8994,123478,1,0)
^^1^1^3091030^
"KRN",8994,123478,1,1,0)
Set imaging location in radiology order file (#75.1).
"KRN",8994,123478,2,0)
^8994.02A^2^2
"KRN",8994,123478,2,1,0)
RAOIEN^1^^1^1
"KRN",8994,123478,2,1,1,0)
^^1^1^3091030^
"KRN",8994,123478,2,1,1,1,0)
Pointer to Radiology Order File #75.1.
"KRN",8994,123478,2,2,0)
RAMLC^1^^1^2
"KRN",8994,123478,2,2,1,0)
^^1^1^3091030^
"KRN",8994,123478,2,2,1,1,0)
Pointer to Radiology Imaging Location File #79.1.
"KRN",8994,123478,2,"B","RAMLC",2)

"KRN",8994,123478,2,"B","RAOIEN",1)

"KRN",8994,123478,2,"PARAMSEQ",1,1)

"KRN",8994,123478,2,"PARAMSEQ",2,2)

"KRN",8994,123478,3,0)
^^1^1^3091030^
"KRN",8994,123478,3,1,0)
Status: positive values are good, errors are negative.
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",454,-1)
1^1
"PKG",454,0)
IMAGING^MAG^Imaging Release History
"PKG",454,22,0)
^9.49I^1^1
"PKG",454,22,1,0)
3.0^3020328^3020328^.5
"PKG",454,22,1,"PAH",1,0)
53^3100428^.5
"PKG",454,22,1,"PAH",1,1,0)
^9.49011^18^18^3100428
"PKG",454,22,1,"PAH",1,1,1,0)
Routines for Patch 53, Test Build 29.
"PKG",454,22,1,"PAH",1,1,2,0)
 
"PKG",454,22,1,"PAH",1,1,3,0)
Routines:
"PKG",454,22,1,"PAH",1,1,4,0)
MAGBRTK     value = 7352676
"PKG",454,22,1,"PAH",1,1,5,0)
MAGDAIRF    value = 8123428
"PKG",454,22,1,"PAH",1,1,6,0)
MAGDAIRG    value = 10868841
"PKG",454,22,1,"PAH",1,1,7,0)
MAGDIR81    value = 17308670
"PKG",454,22,1,"PAH",1,1,8,0)
MAGDIR8R    value = 11763503
"PKG",454,22,1,"PAH",1,1,9,0)
MAGDIR9A    value = 11731498
"PKG",454,22,1,"PAH",1,1,10,0)
MAGDIR9B    value = 7655058
"PKG",454,22,1,"PAH",1,1,11,0)
MAGDLBAA    value = 8068461
"PKG",454,22,1,"PAH",1,1,12,0)
MAGDRPC9    value = 13044987
"PKG",454,22,1,"PAH",1,1,13,0)
MAGDRPCA    value = 17799839
"PKG",454,22,1,"PAH",1,1,14,0)
MAGDRPCB    value = 19465055
"PKG",454,22,1,"PAH",1,1,15,0)
MAGIPS53    value = 5286805
"PKG",454,22,1,"PAH",1,1,16,0)
 
"PKG",454,22,1,"PAH",1,1,17,0)
Please note that routine MAGIPS53 is deleted after the KIDS Build is
"PKG",454,22,1,"PAH",1,1,18,0)
installed.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
12
"RTN","MAGBRTK")
0^1^B20097310
"RTN","MAGBRTK",1,0)
MAGBRTK ;WOIFO/EdM - Routing - Keywords ; 17 Mar 2008 12:25 PM
"RTN","MAGBRTK",2,0)
 ;;3.0;IMAGING;**51,53**;Mar 19, 2002;Build 1719;Apr 28, 2010
"RTN","MAGBRTK",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGBRTK",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGBRTK",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGBRTK",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGBRTK",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGBRTK",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGBRTK",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGBRTK",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGBRTK",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGBRTK",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGBRTK",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGBRTK",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGBRTK",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGBRTK",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGBRTK",17,0)
 ;;
"RTN","MAGBRTK",18,0)
 Q
"RTN","MAGBRTK",19,0)
 ;
"RTN","MAGBRTK",20,0)
 ; This routine is needed on the DICOM Gateway while importing
"RTN","MAGBRTK",21,0)
 ; new rules, and on the VistA system while evaluating the rules.
"RTN","MAGBRTK",22,0)
 ;
"RTN","MAGBRTK",23,0)
KEYWORD ; build the KEYWORD array
"RTN","MAGBRTK",24,0)
 N C,CD,D,KW,M,V,X
"RTN","MAGBRTK",25,0)
 S CD="CONDITION" K KEYWORD
"RTN","MAGBRTK",26,0)
 ; Actions
"RTN","MAGBRTK",27,0)
 F X="SEND","BALANCE","DICOM" S KEYWORD("ACTION",X)="-"
"RTN","MAGBRTK",28,0)
 F X="DESTINATION","HOLIDAY" S KEYWORD("ACTION",X)="I"
"RTN","MAGBRTK",29,0)
 ;
"RTN","MAGBRTK",30,0)
 F X="HIGH","NORMAL","LOW" S KEYWORD("PRIORITY",X)="-"
"RTN","MAGBRTK",31,0)
 F X="YES","NO" S KEYWORD("PRIORSTUDY",X)="-"
"RTN","MAGBRTK",32,0)
 ;
"RTN","MAGBRTK",33,0)
 ; Fields in ^MAG(2005,
"RTN","MAGBRTK",34,0)
 S M="LO^MAG^MAGBRTE3(IMAGE,"
"RTN","MAGBRTK",35,0)
 S KEYWORD(CD,"ABSTRACT_REF")=M_"0,0,4,.VAL)"
"RTN","MAGBRTK",36,0)
 S KEYWORD(CD,"ACQUISITION_DEVICE")=M_"2006.04,100,4,.VAL)"
"RTN","MAGBRTK",37,0)
 S KEYWORD(CD,"BIG_JUKEBOX_PATH")=M_"2005.2,""FBIG"",2,.VAL)"
"RTN","MAGBRTK",38,0)
 S KEYWORD(CD,"BIG_MAGNETIC_PATH")=M_"2005.2,""FBIG"",1,.VAL)"
"RTN","MAGBRTK",39,0)
 S KEYWORD(CD,"CLASS")=M_"2005.82,40,2,.VAL)"
"RTN","MAGBRTK",40,0)
 S KEYWORD(CD,"CLINIC")=M_"44,100,2,.VAL)"
"RTN","MAGBRTK",41,0)
 S KEYWORD(CD,"CREATE_METHOD")=M_"0,""METHOD"",1,.VAL)"
"RTN","MAGBRTK",42,0)
 S KEYWORD(CD,"DESCRIPTIVE_CATEGORY")=M_"2005.81,100,1,.VAL)"
"RTN","MAGBRTK",43,0)
 S KEYWORD(CD,"EXPORT_REQUEST_STATUS")=M_"0,2,9,.VAL)"
"RTN","MAGBRTK",44,0)
 S KEYWORD(CD,"FILE_REF")=M_"0,0,2,.VAL)"
"RTN","MAGBRTK",45,0)
 S KEYWORD(CD,"IQ")=M_"0,0,11,.VAL)"
"RTN","MAGBRTK",46,0)
 S KEYWORD(CD,"MAGNETIC_REF")=M_"0,0,3,.VAL)"
"RTN","MAGBRTK",47,0)
 S KEYWORD(CD,"MICROSCOPIC_OBJECTIVE")=M_"0,""PATH"",5,.VAL)"
"RTN","MAGBRTK",48,0)
 S KEYWORD(CD,"MODALITY")=M_"0,0,8,.VAL)"
"RTN","MAGBRTK",49,0)
 S KEYWORD(CD,"OBJECT_NAME")=M_"0,0,1,.VAL)"
"RTN","MAGBRTK",50,0)
 S KEYWORD(CD,"OBJECT_TYPE")=M_"2005.02,0,6,.VAL)"
"RTN","MAGBRTK",51,0)
 S KEYWORD(CD,"ORIGIN_INDEX")=M_"0,40,6,.VAL)"
"RTN","MAGBRTK",52,0)
 S KEYWORD(CD,"PACKAGE")=M_"0,40,1,.VAL)"
"RTN","MAGBRTK",53,0)
 S KEYWORD(CD,"PACS_PROCEDURE")=M_"71,""PACS"",3,.VAL)"
"RTN","MAGBRTK",54,0)
 S KEYWORD(CD,"PACS_UID")=M_"0,""PACS"",1,.VAL)"
"RTN","MAGBRTK",55,0)
 S KEYWORD(CD,"PARENT_DATA")=M_"2005.03,2,6,.VAL)"
"RTN","MAGBRTK",56,0)
 S KEYWORD(CD,"PARENT_DATA_FILE_IMAGE_POINTER")=M_"0,2,8,.VAL)"
"RTN","MAGBRTK",57,0)
 S KEYWORD(CD,"PARENT_GLOBAL_ROOT_D0")=M_"0,2,7,.VAL)"
"RTN","MAGBRTK",58,0)
 S KEYWORD(CD,"PARENT_GLOBAL_ROOT_D1")=M_"0,2,10,.VAL)"
"RTN","MAGBRTK",59,0)
 S KEYWORD(CD,"PATH_ACCESSION_NUMBER")=M_"0,""PATH"",1,.VAL)"
"RTN","MAGBRTK",60,0)
 S KEYWORD(CD,"PATIENT")=M_"2,0,7,.VAL)"
"RTN","MAGBRTK",61,0)
 S KEYWORD(CD,"PROCEDURE")=M_"0,0,8,.VAL)"
"RTN","MAGBRTK",62,0)
 S KEYWORD(CD,"PROCEDURE_OR_EVENT")=M_"2005.85,40,4,.VAL)"
"RTN","MAGBRTK",63,0)
 S KEYWORD(CD,"RADIOLOGY_REPORT")=M_"74,""PACS"",2,.VAL)"
"RTN","MAGBRTK",64,0)
 S KEYWORD(CD,"SAVED_BY")=M_"200,2,2,.VAL)"
"RTN","MAGBRTK",65,0)
 S KEYWORD(CD,"SHORT_DESCRIPTION")=M_"0,2,4,.VAL)"
"RTN","MAGBRTK",66,0)
 S KEYWORD(CD,"SPECIALTY")=M_"2005.84,40,5,.VAL)"
"RTN","MAGBRTK",67,0)
 S KEYWORD(CD,"SPECIMEN")=M_"0,""PATH"",3,.VAL)"
"RTN","MAGBRTK",68,0)
 S KEYWORD(CD,"SPECIMEN_DESCRIPTION")=M_"0,""PATH"",2,.VAL)"
"RTN","MAGBRTK",69,0)
 S KEYWORD(CD,"STAIN")=M_"0,""PATH"",4,.VAL)"
"RTN","MAGBRTK",70,0)
 S KEYWORD(CD,"SUMMARY")=M_"0,2,3,.VAL)"
"RTN","MAGBRTK",71,0)
 S KEYWORD(CD,"SUMMARY_OBJECT")=M_"0,2,3,.VAL)"
"RTN","MAGBRTK",72,0)
 S KEYWORD(CD,"TRACKING_ID")=M_"0,100,5,.VAL)"
"RTN","MAGBRTK",73,0)
 S KEYWORD(CD,"TYPE")=M_"2005.83,40,3,.VAL)"
"RTN","MAGBRTK",74,0)
 S KEYWORD(CD,"WORM_REF")=M_"0,0,5,.VAL)"
"RTN","MAGBRTK",75,0)
 ;
"RTN","MAGBRTK",76,0)
 ; Date and time fields
"RTN","MAGBRTK",77,0)
 S M="DT^MAG^MAGBRTE3(IMAGE,"
"RTN","MAGBRTK",78,0)
 S KEYWORD(CD,"EXAM_TIME")=M_"0,2,5,.VAL)"
"RTN","MAGBRTK",79,0)
 S KEYWORD(CD,"IMAGE_SAVED")=M_"0,2,1,.VAL)"
"RTN","MAGBRTK",80,0)
 S KEYWORD(CD,"LAST_ACCESS")=M_"0,0,9,.VAL)"
"RTN","MAGBRTK",81,0)
 S KEYWORD(CD,"PROCEDURE_TIME")=M_"0,2,5,.VAL)"
"RTN","MAGBRTK",82,0)
 ;
"RTN","MAGBRTK",83,0)
 S M="DT^DATE^MAGBRTE3(IMAGE,"
"RTN","MAGBRTK",84,0)
 S KEYWORD(CD,"EXAM_TIME_FIRST")=M_"0,2,5,1,.VAL)"
"RTN","MAGBRTK",85,0)
 S KEYWORD(CD,"EXAM_TIME_LAST")=M_"0,2,5,2,.VAL)"
"RTN","MAGBRTK",86,0)
 S KEYWORD(CD,"IMAGE_SAVED_FIRST")=M_"0,2,1,1,.VAL)"
"RTN","MAGBRTK",87,0)
 S KEYWORD(CD,"IMAGE_SAVED_LAST")=M_"0,2,1,2,.VAL)"
"RTN","MAGBRTK",88,0)
 S KEYWORD(CD,"LAST_ACCESS_FIRST")=M_"0,0,9,1,.VAL)"
"RTN","MAGBRTK",89,0)
 S KEYWORD(CD,"LAST_ACCESS_LAST")=M_"0,0,9,2,.VAL)"
"RTN","MAGBRTK",90,0)
 S KEYWORD(CD,"PROCEDURE_TIME_FIRST")=M_"0,2,5,1,.VAL)"
"RTN","MAGBRTK",91,0)
 S KEYWORD(CD,"PROCEDURE_TIME_LAST")=M_"0,2,5,2,.VAL)"
"RTN","MAGBRTK",92,0)
 S KEYWORD(CD,"STUDY_TIME")=M_"0,2,5,1,.VAL)"
"RTN","MAGBRTK",93,0)
 ;
"RTN","MAGBRTK",94,0)
 ; Built-in Fields
"RTN","MAGBRTK",95,0)
 S KEYWORD(CD,"NOW")="DT^NOW^MAGBRTE3(.VAL)"
"RTN","MAGBRTK",96,0)
 S KEYWORD(CD,"SOURCE")="SH^SOURCE^MAGBRTE3(IMAGE,.VAL)"
"RTN","MAGBRTK",97,0)
 S KEYWORD(CD,"URGENCY")="SH^URGENCY^MAGBRTE3(IMAGE,.VAL)"
"RTN","MAGBRTK",98,0)
 Q
"RTN","MAGBRTK",99,0)
 ;
"RTN","MAGDAIRF")
0^2^B25028969
"RTN","MAGDAIRF",1,0)
MAGDAIRF ;WOIFO/PMK - Automatic Import Reconciliation Workflow ; 17 Nov 2009 7:31 AM
"RTN","MAGDAIRF",2,0)
 ;;3.0;IMAGING;**53**;Mar 19, 2002;Build 1719;Apr 28, 2010
"RTN","MAGDAIRF",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDAIRF",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDAIRF",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDAIRF",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDAIRF",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDAIRF",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDAIRF",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDAIRF",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDAIRF",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDAIRF",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDAIRF",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDAIRF",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDAIRF",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDAIRF",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDAIRF",17,0)
 ;;
"RTN","MAGDAIRF",18,0)
 Q
"RTN","MAGDAIRF",19,0)
 ; Populate the OUTSIDE IMAGING LOCATION file (#2006.5759)
"RTN","MAGDAIRF",20,0)
 ; This requires No Credit entries in the IMAGING LOCATIONS file (#79.1)
"RTN","MAGDAIRF",21,0)
 ;
"RTN","MAGDAIRF",22,0)
UPDATE ; update the OUTSIDE IMAGING LOCATION file
"RTN","MAGDAIRF",23,0)
 S DTIME=$G(DTIME,300)
"RTN","MAGDAIRF",24,0)
 N DIVISION ;------ INSTITUTION file #4 ien
"RTN","MAGDAIRF",25,0)
 N IMAGETYPE ;----- IMAGE TYPE file #79.2 ien
"RTN","MAGDAIRF",26,0)
 N NOCREDITLOCS ;-- array of IMAGING LOCATIONS with No Credit
"RTN","MAGDAIRF",27,0)
 N RADIMGLOC ;----- Radiology IMAGING LOCATIONS file (file 79.1) pointer)
"RTN","MAGDAIRF",28,0)
 N ERROR,I,N,X,Y
"RTN","MAGDAIRF",29,0)
 S ERROR=$$DISPLAY^MAGDAIRG(1,.NOCREDITLOCS)
"RTN","MAGDAIRF",30,0)
 Q:ERROR=-1  ; missing "No Credit" imaging location(s)
"RTN","MAGDAIRF",31,0)
 S DIVISION=0
"RTN","MAGDAIRF",32,0)
 F  S DIVISION=$O(NOCREDITLOCS(DIVISION)) Q:'DIVISION  D
"RTN","MAGDAIRF",33,0)
 . W !!!,"OUTSIDE IMAGING LOCATIONS for ",$$GET1^DIQ(4,DIVISION,.01)
"RTN","MAGDAIRF",34,0)
 . W " (",$$GET1^DIQ(4,DIVISION,99),")" S N=$X
"RTN","MAGDAIRF",35,0)
 . W ! F I=1:1:N W "-"
"RTN","MAGDAIRF",36,0)
 . S IMAGETYPE=""
"RTN","MAGDAIRF",37,0)
 . F  S IMAGETYPE=$O(NOCREDITLOCS(DIVISION,IMAGETYPE)) Q:'IMAGETYPE  D
"RTN","MAGDAIRF",38,0)
 . . K RADIMGLOC S RADIMGLOC=""
"RTN","MAGDAIRF",39,0)
 . . F  S RADIMGLOC=$O(NOCREDITLOCS(DIVISION,IMAGETYPE,RADIMGLOC)) Q:RADIMGLOC=""  D
"RTN","MAGDAIRF",40,0)
 . . . S RADIMGLOC(0)=$G(RADIMGLOC(0))+1,RADIMGLOC(RADIMGLOC(0))=RADIMGLOC
"RTN","MAGDAIRF",41,0)
 . . . Q
"RTN","MAGDAIRF",42,0)
 . . D SELECT(DIVISION,IMAGETYPE,.RADIMGLOC) W !
"RTN","MAGDAIRF",43,0)
 . . Q
"RTN","MAGDAIRF",44,0)
 . Q
"RTN","MAGDAIRF",45,0)
 Q
"RTN","MAGDAIRF",46,0)
 ;
"RTN","MAGDAIRF",47,0)
SELECT(DIVISION,IMAGETYPE,RADIMGLOC) ; pick IMAGING LOCATION
"RTN","MAGDAIRF",48,0)
 N OUTSIDE ; ------ OUTSIDE IMAGING LOCATIONS file #2006.5759 ien
"RTN","MAGDAIRF",49,0)
 N ABORT,CHOICE,I,OPTION,PROMPT,QUIT,X
"RTN","MAGDAIRF",50,0)
 W !,$$GET1^DIQ(79.2,IMAGETYPE,.01)," -- "
"RTN","MAGDAIRF",51,0)
 S OUTSIDE=$O(^MAGD(2006.5759,"D",DIVISION,IMAGETYPE,""))
"RTN","MAGDAIRF",52,0)
 I $O(^MAGD(2006.5759,"D",DIVISION,IMAGETYPE,OUTSIDE)) D  Q:ABORT
"RTN","MAGDAIRF",53,0)
 . N X
"RTN","MAGDAIRF",54,0)
 . S X=$X
"RTN","MAGDAIRF",55,0)
 . W "*** Redundant records found! ***"
"RTN","MAGDAIRF",56,0)
 . S I="" F  S I=$O(^MAGD(2006.5759,"D",DIVISION,IMAGETYPE,I)) Q:'I  D
"RTN","MAGDAIRF",57,0)
 . . W !,?X,$$GET1^DIQ(2006.5759,I,.01)
"RTN","MAGDAIRF",58,0)
 . . Q
"RTN","MAGDAIRF",59,0)
 . W !,?X,"*** These must be deleted and replace by a single entry ***"
"RTN","MAGDAIRF",60,0)
 . S PROMPT="Proceed",ABORT=1
"RTN","MAGDAIRF",61,0)
 . S X=$$YESNO(PROMPT,"y",.CHOICE) Q:X<0
"RTN","MAGDAIRF",62,0)
 . I "Nn"[$E(CHOICE) Q
"RTN","MAGDAIRF",63,0)
 . S I="" F  S I=$O(^MAGD(2006.5759,"D",DIVISION,IMAGETYPE,I)) Q:'I  D
"RTN","MAGDAIRF",64,0)
 . . D KILL(I) ; remove each entry
"RTN","MAGDAIRF",65,0)
 . . Q 
"RTN","MAGDAIRF",66,0)
 . S (ABORT,OUTSIDE)=0
"RTN","MAGDAIRF",67,0)
 . Q
"RTN","MAGDAIRF",68,0)
 I OUTSIDE D  Q:QUIT
"RTN","MAGDAIRF",69,0)
 . S QUIT=1
"RTN","MAGDAIRF",70,0)
 . W $$GET1^DIQ(2006.5759,OUTSIDE,.01)
"RTN","MAGDAIRF",71,0)
 . S PROMPT="Change it"
"RTN","MAGDAIRF",72,0)
 . S X=$$YESNO(PROMPT,"n",.CHOICE) Q:X<0
"RTN","MAGDAIRF",73,0)
 . I "Nn"[$E(CHOICE) Q
"RTN","MAGDAIRF",74,0)
 . D KILL(OUTSIDE)
"RTN","MAGDAIRF",75,0)
 . S QUIT=0 ; this will force a drop though to reset the node
"RTN","MAGDAIRF",76,0)
 . Q
"RTN","MAGDAIRF",77,0)
 E  W "(not defined yet)"
"RTN","MAGDAIRF",78,0)
 F I=1:1:RADIMGLOC(0) D
"RTN","MAGDAIRF",79,0)
 . S OPTION(I)=$S(RADIMGLOC(0)>1:I_":",1:"")
"RTN","MAGDAIRF",80,0)
 . S OPTION(I)=OPTION(I)_$$GET1^DIQ(79.1,RADIMGLOC(I),.01)
"RTN","MAGDAIRF",81,0)
 . Q
"RTN","MAGDAIRF",82,0)
 I RADIMGLOC(0)>1 D
"RTN","MAGDAIRF",83,0)
 . S X=$$CHOOSE("Select location",,.CHOICE,.OPTION) Q:X<0
"RTN","MAGDAIRF",84,0)
 . D SET(DIVISION,IMAGETYPE,RADIMGLOC(+CHOICE))
"RTN","MAGDAIRF",85,0)
 . Q
"RTN","MAGDAIRF",86,0)
 E  D
"RTN","MAGDAIRF",87,0)
 . S PROMPT(1)=OPTION(1)
"RTN","MAGDAIRF",88,0)
 . S PROMPT="Use this value?"
"RTN","MAGDAIRF",89,0)
 . S X=$$YESNO(.PROMPT,"n",.CHOICE) Q:X<0
"RTN","MAGDAIRF",90,0)
 . I "Nn"[$E(CHOICE) Q
"RTN","MAGDAIRF",91,0)
 . D SET(DIVISION,IMAGETYPE,RADIMGLOC(1))
"RTN","MAGDAIRF",92,0)
 . Q
"RTN","MAGDAIRF",93,0)
 Q
"RTN","MAGDAIRF",94,0)
 ;
"RTN","MAGDAIRF",95,0)
SET(DIVISION,IMAGETYPE,RADIMGLOC) ; create the OUTSIDE IMAGING LOCATION fle (#2006.5759) entry
"RTN","MAGDAIRF",96,0)
 N DIERR,IENS,MAGERR,MAGFDA,MAGIENS,SC44IEN
"RTN","MAGDAIRF",97,0)
 ;
"RTN","MAGDAIRF",98,0)
 ; check to see if it already exists
"RTN","MAGDAIRF",99,0)
 S MAGIENS=$O(^MAGD(2006.5759,"B",RADIMGLOC,"")) Q:MAGIENS MAGIENS
"RTN","MAGDAIRF",100,0)
 ;
"RTN","MAGDAIRF",101,0)
 S SC44IEN=$$GET1^DIQ(79.1,RADIMGLOC,.01,"I")
"RTN","MAGDAIRF",102,0)
 ;
"RTN","MAGDAIRF",103,0)
 S IENS="+1,"
"RTN","MAGDAIRF",104,0)
 S MAGFDA(2006.5759,IENS,.01)=RADIMGLOC    ; IMAGING LOCATION
"RTN","MAGDAIRF",105,0)
 S MAGFDA(2006.5759,IENS,2)=IMAGETYPE      ; IMAGING TYPE
"RTN","MAGDAIRF",106,0)
 S MAGFDA(2006.5759,IENS,3)=SC44IEN        ; HOSPITAL LOCATION
"RTN","MAGDAIRF",107,0)
 S MAGFDA(2006.5759,IENS,4)=DIVISION       ; INSTITUTION
"RTN","MAGDAIRF",108,0)
 D UPDATE^DIE("","MAGFDA","MAGIENS","MAGERR")
"RTN","MAGDAIRF",109,0)
 I $D(DIERR) Q "-3 Entry not created in OUTSIDE IMAGING LOCATION file (#2006.5759)"
"RTN","MAGDAIRF",110,0)
 Q MAGIENS(1)
"RTN","MAGDAIRF",111,0)
 ;
"RTN","MAGDAIRF",112,0)
KILL(OUTSIDE) ; delete the file 2006.5759 entry
"RTN","MAGDAIRF",113,0)
 N DA,DIK
"RTN","MAGDAIRF",114,0)
 S DIK="^MAGD(2006.5759,",DA=OUTSIDE
"RTN","MAGDAIRF",115,0)
 D ^DIK
"RTN","MAGDAIRF",116,0)
 Q
"RTN","MAGDAIRF",117,0)
 ;
"RTN","MAGDAIRF",118,0)
YESNO(PROMPT,DEFAULT,CHOICE) ; generic YES/NO question driver
"RTN","MAGDAIRF",119,0)
 N DIR,DIRUT,DIROUT,X,Y
"RTN","MAGDAIRF",120,0)
 S DIR(0)="Y" S DIR("A")=PROMPT M DIR("A")=PROMPT
"RTN","MAGDAIRF",121,0)
 I $G(DEFAULT)'="" S DIR("B")=DEFAULT
"RTN","MAGDAIRF",122,0)
 D ^DIR
"RTN","MAGDAIRF",123,0)
 I $D(DIROUT) Q -2
"RTN","MAGDAIRF",124,0)
 I $D(DIRUT) Q -1
"RTN","MAGDAIRF",125,0)
 S CHOICE=Y(0)
"RTN","MAGDAIRF",126,0)
 Q 1
"RTN","MAGDAIRF",127,0)
 ;
"RTN","MAGDAIRF",128,0)
CHOOSE(PROMPT,DEFAULT,CHOICE,OPTION) ; generic question driver
"RTN","MAGDAIRF",129,0)
 N DIR,DIRUT,DIROUT,I,X,Y
"RTN","MAGDAIRF",130,0)
 S DIR(0)="S^",I=0
"RTN","MAGDAIRF",131,0)
 F  S I=$O(OPTION(I)) Q:'I  D
"RTN","MAGDAIRF",132,0)
 . S DIR(0)=DIR(0)_$S(I>1:";",1:"")_OPTION(I)
"RTN","MAGDAIRF",133,0)
 . Q
"RTN","MAGDAIRF",134,0)
 S DIR("A")=PROMPT
"RTN","MAGDAIRF",135,0)
 I $G(DEFAULT)'="" S DIR("B")=DEFAULT
"RTN","MAGDAIRF",136,0)
 D ^DIR
"RTN","MAGDAIRF",137,0)
 I $D(DIROUT) Q -2
"RTN","MAGDAIRF",138,0)
 I $D(DIRUT) Q -1
"RTN","MAGDAIRF",139,0)
 S CHOICE=Y
"RTN","MAGDAIRF",140,0)
 Q 1
"RTN","MAGDAIRG")
0^3^B53876343
"RTN","MAGDAIRG",1,0)
MAGDAIRG ;WOIFO/SG - Automatic Import Reconciliation Workflow ; 29 Jul 2009 7:26 AM
"RTN","MAGDAIRG",2,0)
 ;;3.0;IMAGING;**53**;Mar 19, 2002;Build 1719;Apr 28, 2010
"RTN","MAGDAIRG",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDAIRG",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDAIRG",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDAIRG",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDAIRG",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDAIRG",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDAIRG",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDAIRG",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDAIRG",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDAIRG",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDAIRG",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDAIRG",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDAIRG",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDAIRG",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDAIRG",17,0)
 ;;
"RTN","MAGDAIRG",18,0)
 Q
"RTN","MAGDAIRG",19,0)
 ;
"RTN","MAGDAIRG",20,0)
 ;***** BUILDS THE LIST OF IMAGING TYPES AND "NO CREDIT" LOCATIONS
"RTN","MAGDAIRG",21,0)
 ;
"RTN","MAGDAIRG",22,0)
 ; .DVITLST      Reference to a local variable where the division,
"RTN","MAGDAIRG",23,0)
 ;               imaging type, and "No Credit" imaging locations are
"RTN","MAGDAIRG",24,0)
 ;               returned to.
"RTN","MAGDAIRG",25,0)
 ;
"RTN","MAGDAIRG",26,0)
 ; DVITLST(
"RTN","MAGDAIRG",27,0)
 ;   DivIEN,
"RTN","MAGDAIRG",28,0)
 ;     TypeIEN,  Number of "No Credit" imaging locations
"RTN","MAGDAIRG",29,0)
 ;       LocIEN) ""
"RTN","MAGDAIRG",30,0)
 ;
"RTN","MAGDAIRG",31,0)
LIST(DVITLST) ;
"RTN","MAGDAIRG",32,0)
 N DIVIEN,IEN1,ILIEN,ITIEN,MAGERR,TMP
"RTN","MAGDAIRG",33,0)
 K DVITLST
"RTN","MAGDAIRG",34,0)
 ;
"RTN","MAGDAIRG",35,0)
 ;=== Load the list of imaging types that are referenced by radiology 
"RTN","MAGDAIRG",36,0)
 ;    procedures. There is no point in creating outside locations for
"RTN","MAGDAIRG",37,0)
 ;=== imaging types that are not used at the site.
"RTN","MAGDAIRG",38,0)
 S ITIEN=0
"RTN","MAGDAIRG",39,0)
 F  S ITIEN=$O(^RAMIS(71,"AIMG",ITIEN))  Q:ITIEN'>0  D
"RTN","MAGDAIRG",40,0)
 . S DVITLST(0,ITIEN)=0
"RTN","MAGDAIRG",41,0)
 . Q
"RTN","MAGDAIRG",42,0)
 ;
"RTN","MAGDAIRG",43,0)
 ;=== Check the Radiology files
"RTN","MAGDAIRG",44,0)
 S DIVIEN=0
"RTN","MAGDAIRG",45,0)
 F  S DIVIEN=$O(^RA(79,DIVIEN))  Q:DIVIEN'>0  D
"RTN","MAGDAIRG",46,0)
 . I '$D(^RA(79,DIVIEN,"L","B")) Q  ; ignore inactivated divisions
"RTN","MAGDAIRG",47,0)
 . ;--- Use the same list of imaging types for all divisions
"RTN","MAGDAIRG",48,0)
 . M DVITLST(DIVIEN)=DVITLST(0)
"RTN","MAGDAIRG",49,0)
 . ;=== Load locations of the division
"RTN","MAGDAIRG",50,0)
 . S IEN1=0
"RTN","MAGDAIRG",51,0)
 . F  S IEN1=$O(^RA(79,DIVIEN,"L",IEN1))  Q:IEN1'>0  D
"RTN","MAGDAIRG",52,0)
 . . ;--- IEN of the imaging location
"RTN","MAGDAIRG",53,0)
 . . S ILIEN=$$GET1^DIQ(79.01,IEN1_","_DIVIEN_",",.01,"I",,"MAGERR")
"RTN","MAGDAIRG",54,0)
 . . Q:ILIEN'>0
"RTN","MAGDAIRG",55,0)
 . . ;--- IEN of the imaging type
"RTN","MAGDAIRG",56,0)
 . . S ITIEN=$$GET1^DIQ(79.1,ILIEN_",",6,"I",,"MAGERR")
"RTN","MAGDAIRG",57,0)
 . . ;--- Store the association
"RTN","MAGDAIRG",58,0)
 . . S:ITIEN>0 DVITLST(DIVIEN,ITIEN,ILIEN)=""
"RTN","MAGDAIRG",59,0)
 . . Q
"RTN","MAGDAIRG",60,0)
 . ;=== Keep only "No Credit" locations
"RTN","MAGDAIRG",61,0)
 . S ITIEN=0
"RTN","MAGDAIRG",62,0)
 . F  S ITIEN=$O(DVITLST(DIVIEN,ITIEN))  Q:ITIEN'>0  D
"RTN","MAGDAIRG",63,0)
 . . S DVITLST(DIVIEN,ITIEN)=0
"RTN","MAGDAIRG",64,0)
 . . S ILIEN=0
"RTN","MAGDAIRG",65,0)
 . . F  S ILIEN=$O(DVITLST(DIVIEN,ITIEN,ILIEN))  Q:ILIEN'>0  D
"RTN","MAGDAIRG",66,0)
 . . . S TMP=+$$GET1^DIQ(79.1,ILIEN_",",21,"I",,"MAGERR")
"RTN","MAGDAIRG",67,0)
 . . . I TMP'=2  K DVITLST(DIVIEN,ITIEN,ILIEN)  Q
"RTN","MAGDAIRG",68,0)
 . . . S DVITLST(DIVIEN,ITIEN)=DVITLST(DIVIEN,ITIEN)+1
"RTN","MAGDAIRG",69,0)
 . . . Q
"RTN","MAGDAIRG",70,0)
 . . Q
"RTN","MAGDAIRG",71,0)
 . Q
"RTN","MAGDAIRG",72,0)
 ;
"RTN","MAGDAIRG",73,0)
 ;=== Cleanup
"RTN","MAGDAIRG",74,0)
 K DVITLST(0)
"RTN","MAGDAIRG",75,0)
 Q
"RTN","MAGDAIRG",76,0)
 ;
"RTN","MAGDAIRG",77,0)
 ;##### CHECKS THE OUTSIDE LOCATIONS AND DISPLAYS THEM
"RTN","MAGDAIRG",78,0)
 ; 
"RTN","MAGDAIRG",79,0)
 ; Input Parameter
"RTN","MAGDAIRG",80,0)
 ; ===============
"RTN","MAGDAIRG",81,0)
 ; VERBOSE -- 1 output messages (default)
"RTN","MAGDAIRG",82,0)
 ;            0 suppress messages
"RTN","MAGDAIRG",83,0)
 ;            
"RTN","MAGDAIRG",84,0)
 ; Output Parameter
"RTN","MAGDAIRG",85,0)
 ; ================
"RTN","MAGDAIRG",86,0)
 ; DVITLST ---  described above at beginning of LIST subroutine
"RTN","MAGDAIRG",87,0)
 ;            
"RTN","MAGDAIRG",88,0)
 ; Return Values
"RTN","MAGDAIRG",89,0)
 ; =============
"RTN","MAGDAIRG",90,0)
 ;           -2  Required outside locations are not (properly) defined
"RTN","MAGDAIRG",91,0)
 ;               in the OUTSIDE IMAGING LOCATION file (#2006.5759)
"RTN","MAGDAIRG",92,0)
 ;           -1  Required "No Credit" locations are not (properly)
"RTN","MAGDAIRG",93,0)
 ;               defined in the Radiology files.
"RTN","MAGDAIRG",94,0)
 ;            0  Ok
"RTN","MAGDAIRG",95,0)
 ; Notes
"RTN","MAGDAIRG",96,0)
 ; =====
"RTN","MAGDAIRG",97,0)
 ;
"RTN","MAGDAIRG",98,0)
 ; This entry point can also be called as a procedure:
"RTN","MAGDAIRG",99,0)
 ; D DISPLAY^MAGDAIRG() if you do not need its return value.
"RTN","MAGDAIRG",100,0)
 ;
"RTN","MAGDAIRG",101,0)
DISPLAY(VERBOSE,DVITLST) ;
"RTN","MAGDAIRG",102,0)
 N DIVIEN,ERRCNT,IEN,IENS,ILIEN,ITIEN,MAGBUF,MAGERR,MAGLST,TMP
"RTN","MAGDAIRG",103,0)
 S VERBOSE=$G(VERBOSE,1) ; default is verbose
"RTN","MAGDAIRG",104,0)
 ;
"RTN","MAGDAIRG",105,0)
 ;=== Load the list of imaging types and "No Credit" locations
"RTN","MAGDAIRG",106,0)
 D LIST(.DVITLST)
"RTN","MAGDAIRG",107,0)
 ;
"RTN","MAGDAIRG",108,0)
 ;=== Check the Radiology files
"RTN","MAGDAIRG",109,0)
 W:VERBOSE !!,"Checking the Radiology files..."
"RTN","MAGDAIRG",110,0)
 S (DIVIEN,ERRCNT)=0
"RTN","MAGDAIRG",111,0)
 F  S DIVIEN=$O(DVITLST(DIVIEN))  Q:DIVIEN'>0  D
"RTN","MAGDAIRG",112,0)
 . W:VERBOSE !,"Division: "_$$DIVNAME(DIVIEN)
"RTN","MAGDAIRG",113,0)
 . S ITIEN=0
"RTN","MAGDAIRG",114,0)
 . F  S ITIEN=$O(DVITLST(DIVIEN,ITIEN))  Q:ITIEN'>0  D
"RTN","MAGDAIRG",115,0)
 . . S MAGLST(DIVIEN,ITIEN)=0
"RTN","MAGDAIRG",116,0)
 . . ;--- Check if there is at least one "No Credit" location for
"RTN","MAGDAIRG",117,0)
 . . ;--- this imaging type
"RTN","MAGDAIRG",118,0)
 . . Q:DVITLST(DIVIEN,ITIEN)>0
"RTN","MAGDAIRG",119,0)
 . . ;--- Display the warning message
"RTN","MAGDAIRG",120,0)
 . . W:VERBOSE !?2,$$ITNAME(ITIEN),?32," - Define ""No Credit"" Imaging Location!"
"RTN","MAGDAIRG",121,0)
 . . S ERRCNT=ERRCNT+1
"RTN","MAGDAIRG",122,0)
 . . Q
"RTN","MAGDAIRG",123,0)
 . Q
"RTN","MAGDAIRG",124,0)
 ;--- Instruct the user to create missing "No Credit" locations
"RTN","MAGDAIRG",125,0)
 I ERRCNT>0  D:VERBOSE  Q:$QUIT -1  Q
"RTN","MAGDAIRG",126,0)
 . W !!  D MESSAGE("MSG1")  W !
"RTN","MAGDAIRG",127,0)
 . Q
"RTN","MAGDAIRG",128,0)
 ;
"RTN","MAGDAIRG",129,0)
 ;=== Check the OUTSIDE IMAGING LOCATION file (#2006.5759)
"RTN","MAGDAIRG",130,0)
 W:VERBOSE !!,"Checking the OUTSIDE IMAGING LOCATION file (#2006.5759)..."
"RTN","MAGDAIRG",131,0)
 S IEN=0
"RTN","MAGDAIRG",132,0)
 F  S IEN=$O(^MAGD(2006.5759,IEN))  Q:IEN'>0  D
"RTN","MAGDAIRG",133,0)
 . S IENS=IEN_","  K MAGBUF
"RTN","MAGDAIRG",134,0)
 . D GETS^DIQ(2006.5759,IENS,".01;2;4","I","MAGBUF","MAGERR")
"RTN","MAGDAIRG",135,0)
 . S DIVIEN=+$G(MAGBUF(2006.5759,IENS,4,"I"))   ; INSTITUTION
"RTN","MAGDAIRG",136,0)
 . S ITIEN=+$G(MAGBUF(2006.5759,IENS,2,"I"))    ; IMAGING TYPE
"RTN","MAGDAIRG",137,0)
 . S ILIEN=+$G(MAGBUF(2006.5759,IENS,.01,"I"))  ; IMAGING LOCATION
"RTN","MAGDAIRG",138,0)
 . ;--- Check if all required pointers are valid
"RTN","MAGDAIRG",139,0)
 . I '$D(DVITLST(DIVIEN,ITIEN,ILIEN))  D:VERBOSE  S ERRCNT=ERRCNT+1 Q
"RTN","MAGDAIRG",140,0)
 . . W !,"Invalid record in the file #2006.5759 (IEN="_IEN_")!"
"RTN","MAGDAIRG",141,0)
 . . Q
"RTN","MAGDAIRG",142,0)
 . ;--- Add the outside location to the list
"RTN","MAGDAIRG",143,0)
 . S MAGLST(DIVIEN,ITIEN,ILIEN)=IEN
"RTN","MAGDAIRG",144,0)
 . S MAGLST(DIVIEN,ITIEN)=$G(MAGLST(DIVIEN,ITIEN))+1
"RTN","MAGDAIRG",145,0)
 . Q
"RTN","MAGDAIRG",146,0)
 ;
"RTN","MAGDAIRG",147,0)
 ;=== Display the associations for each division and image type
"RTN","MAGDAIRG",148,0)
 S (DIVIEN,ERRCNT)=0
"RTN","MAGDAIRG",149,0)
 F  S DIVIEN=$O(MAGLST(DIVIEN))  Q:DIVIEN'>0  D
"RTN","MAGDAIRG",150,0)
 . W:VERBOSE !!,"Division: "_$$DIVNAME(DIVIEN)
"RTN","MAGDAIRG",151,0)
 . S ITIEN=0
"RTN","MAGDAIRG",152,0)
 . F  S ITIEN=$O(MAGLST(DIVIEN,ITIEN))  Q:ITIEN'>0  D
"RTN","MAGDAIRG",153,0)
 . . W:VERBOSE !?2,$$ITNAME(ITIEN),?32," - "
"RTN","MAGDAIRG",154,0)
 . . ;--- No association for this division and image type
"RTN","MAGDAIRG",155,0)
 . . I MAGLST(DIVIEN,ITIEN)'>0  D:VERBOSE  S ERRCNT=ERRCNT+1  Q
"RTN","MAGDAIRG",156,0)
 . . . W "Create record in file #2006.5759!"
"RTN","MAGDAIRG",157,0)
 . . . Q
"RTN","MAGDAIRG",158,0)
 . . ;--- Multiple associations for this division and image type
"RTN","MAGDAIRG",159,0)
 . . I MAGLST(DIVIEN,ITIEN)>1  D:VERBOSE  S ERRCNT=ERRCNT+1  Q
"RTN","MAGDAIRG",160,0)
 . . . W "Delete redundant records in file #2006.5759!"
"RTN","MAGDAIRG",161,0)
 . . . S ILIEN=0
"RTN","MAGDAIRG",162,0)
 . . . F  S ILIEN=$O(MAGLST(DIVIEN,ITIEN,ILIEN))  Q:ILIEN'>0  D
"RTN","MAGDAIRG",163,0)
 . . . . S TMP=$$GET1^DIQ(79.1,ILIEN_",",.01,,,"MAGERR")
"RTN","MAGDAIRG",164,0)
 . . . . S:TMP="" TMP="Unknown Imaging Location (IEN="_ILIEN_")"
"RTN","MAGDAIRG",165,0)
 . . . . W !?32," - ",TMP
"RTN","MAGDAIRG",166,0)
 . . . . Q
"RTN","MAGDAIRG",167,0)
 . . . Q
"RTN","MAGDAIRG",168,0)
 . . ;--- Valid association for this division and image type
"RTN","MAGDAIRG",169,0)
 . . S ILIEN=$O(MAGLST(DIVIEN,ITIEN,0))
"RTN","MAGDAIRG",170,0)
 . . S TMP=$$GET1^DIQ(79.1,ILIEN_",",.01,,,"MAGERR")
"RTN","MAGDAIRG",171,0)
 . . I TMP="" D
"RTN","MAGDAIRG",172,0)
 . . . S TMP="Unknown Imaging Location (IEN="_ILIEN_")"
"RTN","MAGDAIRG",173,0)
 . . . S ERRCNT=ERRCNT+1
"RTN","MAGDAIRG",174,0)
 . . . Q
"RTN","MAGDAIRG",175,0)
 . . W:VERBOSE TMP
"RTN","MAGDAIRG",176,0)
 . . Q
"RTN","MAGDAIRG",177,0)
 . Q
"RTN","MAGDAIRG",178,0)
 ;
"RTN","MAGDAIRG",179,0)
 ;=== Instruct the user to fix problems in the OUTSIDE IMAGING LOCATION file
"RTN","MAGDAIRG",180,0)
 I ERRCNT>0 D:VERBOSE  Q:$QUIT -2  Q
"RTN","MAGDAIRG",181,0)
 . W !!  D MESSAGE("MSG2")  W !
"RTN","MAGDAIRG",182,0)
 . Q
"RTN","MAGDAIRG",183,0)
 ;
"RTN","MAGDAIRG",184,0)
 ;=== Success
"RTN","MAGDAIRG",185,0)
 Q:$QUIT 0  Q
"RTN","MAGDAIRG",186,0)
 ;
"RTN","MAGDAIRG",187,0)
 ;+++++ RETURNS DIVISION NAME
"RTN","MAGDAIRG",188,0)
DIVNAME(DIVIEN) ;
"RTN","MAGDAIRG",189,0)
 N MAGERR,NAME
"RTN","MAGDAIRG",190,0)
 S NAME=$$GET1^DIQ(4,DIVIEN_",",.01,,,"MAGERR")
"RTN","MAGDAIRG",191,0)
 Q $S(NAME'="":NAME,1:"Unknown (IEN="_DIVIEN_")")
"RTN","MAGDAIRG",192,0)
 ;
"RTN","MAGDAIRG",193,0)
 ;+++++ RETURNS NAME OF THE IMAGING TYPE
"RTN","MAGDAIRG",194,0)
ITNAME(ITIEN) ;
"RTN","MAGDAIRG",195,0)
 N MAGERR,NAME
"RTN","MAGDAIRG",196,0)
 S NAME=$$GET1^DIQ(79.2,ITIEN_",",.01,,,"MAGERR")
"RTN","MAGDAIRG",197,0)
 Q $S(NAME'="":NAME,1:"Unknown Imaging Type (IEN="_ITIEN_")")
"RTN","MAGDAIRG",198,0)
 ;
"RTN","MAGDAIRG",199,0)
 ;+++++ FORMATS AND DISPLAYS THE MULTILINE MESSAGE
"RTN","MAGDAIRG",200,0)
MESSAGE(TAG) ;
"RTN","MAGDAIRG",201,0)
 N DIWF,DIWL,DIWR,MAGI,X
"RTN","MAGDAIRG",202,0)
 K ^UTILITY($J,"W")
"RTN","MAGDAIRG",203,0)
 S DIWF="W",DIWL=1,DIWR=$G(IOM,80)-1
"RTN","MAGDAIRG",204,0)
 F MAGI=1:1  S X=$P($T(@TAG+MAGI),";;",2)  Q:X=""  D ^DIWP
"RTN","MAGDAIRG",205,0)
 D ^DIWW
"RTN","MAGDAIRG",206,0)
 Q
"RTN","MAGDAIRG",207,0)
 ;
"RTN","MAGDAIRG",208,0)
 ;+++++ MESSAGES
"RTN","MAGDAIRG",209,0)
MSG1 ;
"RTN","MAGDAIRG",210,0)
 ;;Please define missing "No Credit" imaging locations for the
"RTN","MAGDAIRG",211,0)
 ;;aforementioned divisions and imaging types (using the Location
"RTN","MAGDAIRG",212,0)
 ;;Parameter Set-up [RA SYSLOC] and Division Parameter Set-up
"RTN","MAGDAIRG",213,0)
 ;;[RA SYSDIV] options of the System Definition Menu ... [RA SYSDEF]
"RTN","MAGDAIRG",214,0)
 ;;options) and then run this option again.
"RTN","MAGDAIRG",215,0)
MSG2 ;
"RTN","MAGDAIRG",216,0)
 ;;Please fix the aforementioned problems in the OUTSIDE IMAGING
"RTN","MAGDAIRG",217,0)
 ;;LOCATION file (#2006.5759) and then run this option again.
"RTN","MAGDIR81")
0^4^B80768896
"RTN","MAGDIR81",1,0)
MAGDIR81 ;WOIFO/PMK - Read a DICOM image file ; 25 Feb 2008 11:06 AM
"RTN","MAGDIR81",2,0)
 ;;3.0;IMAGING;**11,30,51,50,46,54,53**;Mar 19, 2002;Build 1719;Apr 28, 2010
"RTN","MAGDIR81",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDIR81",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR81",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDIR81",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDIR81",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDIR81",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDIR81",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDIR81",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDIR81",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDIR81",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDIR81",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDIR81",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDIR81",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDIR81",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR81",17,0)
 ;;
"RTN","MAGDIR81",18,0)
 ; M2MB server
"RTN","MAGDIR81",19,0)
 ;
"RTN","MAGDIR81",20,0)
 ; This routine is invoked by the ^MAGDIR8 for the "STORE1/STORE2"
"RTN","MAGDIR81",21,0)
 ; REQUEST items when there is an image to be stored into the database.
"RTN","MAGDIR81",22,0)
 ; It adds it to the ^MAG global with appropriate pointers to the
"RTN","MAGDIR81",23,0)
 ; "parent data files".
"RTN","MAGDIR81",24,0)
 ;
"RTN","MAGDIR81",25,0)
ENTRY ; process one image
"RTN","MAGDIR81",26,0)
 N FILEDATA ;- array of data to be passed between routines
"RTN","MAGDIR81",27,0)
 N FIRSTDCM ;- patient first name from the image header (ie, PNAMEDCM)
"RTN","MAGDIR81",28,0)
 N GMRCIEN ;-- internal entry number of consult/procedure request
"RTN","MAGDIR81",29,0)
 N IMPORTER ;- flag set by a gateway that is running the IMPORTER app
"RTN","MAGDIR81",30,0)
 N LASTDCM ;-- patient last name from the image header (ie, PNAMEDCM)
"RTN","MAGDIR81",31,0)
 N MEDIA ;---- source of DICOM object for Importer (D=disk, T=transmission)
"RTN","MAGDIR81",32,0)
 N MAGGP ;---- image's group pointer in ^MAG(2005)
"RTN","MAGDIR81",33,0)
 N MAGIEN ;--- pointer to the entry for the image in ^MAG(2005)
"RTN","MAGDIR81",34,0)
 N MIDCM ;---- patient middle initial from the image header (PNAMEDCM)
"RTN","MAGDIR81",35,0)
 N OLDPATH ;-- original path for imported images (set by Importer)
"RTN","MAGDIR81",36,0)
 N ORIGINDX ;- origin index (file 2005, field 45)
"RTN","MAGDIR81",37,0)
 N PNAMEVAH ;- patient name from VADM(1)
"RTN","MAGDIR81",38,0)
 N PROCDESC ;- procedure description (VA's name)
"RTN","MAGDIR81",39,0)
 N RADATA ;--- radiology pkg patient & study data (set in ^MAGDIR8A)
"RTN","MAGDIR81",40,0)
 N VADM ;----- array of demographic variables filled in by DEM^VADPT
"RTN","MAGDIR81",41,0)
 N I,MAG0,MAG1,MAG2,QUIT,X
"RTN","MAGDIR81",42,0)
 ;
"RTN","MAGDIR81",43,0)
 N ACNUMB,ARG2,CASENUMB,EMAIL,FROMPATH,IMAGEUID,IMAGNAME,IMAGNUMB,IMGSVC
"RTN","MAGDIR81",44,0)
 N INSTLOC,INSTNAME,LASTIMG,LOCATION,MACHID,MFGR,MODALITY,MODEL,MODPARMS
"RTN","MAGDIR81",45,0)
 N MULTFRAM,PID,PNAMEDCM,ROUTRULE,SERINUMB,SERIEUID,SOPCLASS,STAMP,STATUS
"RTN","MAGDIR81",46,0)
 N STUDYDAT,STUDYTIM,STUDYDAT,STUDYTIM,STUDYUID,SYSTITLE
"RTN","MAGDIR81",47,0)
 ;
"RTN","MAGDIR81",48,0)
 S STATUS=$P(ARGS,"|",1),LOCATION=$P(ARGS,"|",2)
"RTN","MAGDIR81",49,0)
 S MACHID=$P(ARGS,"|",3),IMGSVC=$P(ARGS,"|",4)
"RTN","MAGDIR81",50,0)
 S INSTNAME=$P(ARGS,"|",5),FROMPATH=$P(ARGS,"|",6)
"RTN","MAGDIR81",51,0)
 S PID=$P(ARGS,"|",7),PNAMEDCM=$P(ARGS,"|",8)
"RTN","MAGDIR81",52,0)
 S CASENUMB=$P(ARGS,"|",9),ACNUMB=$P(ARGS,"|",10)
"RTN","MAGDIR81",53,0)
 S STUDYDAT=$P(ARGS,"|",11),STUDYTIM=$P(ARGS,"|",12)
"RTN","MAGDIR81",54,0)
 S IMPORTER=$P(ARGS,"|",13),MODALITY=$P(ARGS,"|",14)
"RTN","MAGDIR81",55,0)
 S IMAGNAME=$P(ARGS,"|",15),MODPARMS=$P(ARGS,"|",16)
"RTN","MAGDIR81",56,0)
 S SERINUMB=$P(ARGS,"|",17),IMAGNUMB=$P(ARGS,"|",18)
"RTN","MAGDIR81",57,0)
 S INSTLOC=$P(ARGS,"|",19),MULTFRAM=$P(ARGS,"|",20)
"RTN","MAGDIR81",58,0)
 S SYSTITLE=$P(ARGS,"|",21),EMAIL=$P(ARGS,"|",22)
"RTN","MAGDIR81",59,0)
 S IREQUEST=IREQUEST+1,OPCODE=$P(REQUEST(IREQUEST),"|")
"RTN","MAGDIR81",60,0)
 I OPCODE'="STORE2" D  Q
"RTN","MAGDIR81",61,0)
 . D RESULT^MAGDIR8("STORE","-101 Expecting STORE2, got """_OPCODE_"""")
"RTN","MAGDIR81",62,0)
 . Q
"RTN","MAGDIR81",63,0)
 S ARG2=$P(REQUEST(IREQUEST),"|",2,999)
"RTN","MAGDIR81",64,0)
 S STUDYUID=$P(ARG2,"|",1),SERIEUID=$P(ARG2,"|",2)
"RTN","MAGDIR81",65,0)
 S IMAGEUID=$P(ARG2,"|",3),SOPCLASS=$P(ARG2,"|",4)
"RTN","MAGDIR81",66,0)
 S LASTIMG=$P(ARG2,"|",5),ROUTRULE=$P(ARG2,"|",6)
"RTN","MAGDIR81",67,0)
 S MFGR=$P(ARG2,"|",7),MODEL=$P(ARG2,"|",8)
"RTN","MAGDIR81",68,0)
 S STAMP=$P(ARG2,"|",9),ORIGINDX=$P(ARG2,"|",10)
"RTN","MAGDIR81",69,0)
 S MEDIA=$P(ARG2,"|",11),OLDPATH=$P(ARG2,"|",12)
"RTN","MAGDIR81",70,0)
 ;
"RTN","MAGDIR81",71,0)
 ; get a pointer to the image, if it is already on file
"RTN","MAGDIR81",72,0)
 S MAGIEN=$O(^MAG(2005,"P",IMAGEUID,0))
"RTN","MAGDIR81",73,0)
 ;
"RTN","MAGDIR81",74,0)
 ; the following line will have to be adjusted for DICOM SR
"RTN","MAGDIR81",75,0)
 S FILEDATA("TYPE")=$O(^MAG(2005.83,"B","IMAGE",""))
"RTN","MAGDIR81",76,0)
 ;
"RTN","MAGDIR81",77,0)
 I MULTFRAM,MAGIEN D  ; subsequent image of a multiframe object
"RTN","MAGDIR81",78,0)
 . D MULTFRAM ; require both MULTFRAM and MAGIEN to be non-zero
"RTN","MAGDIR81",79,0)
 . Q
"RTN","MAGDIR81",80,0)
 E  D  Q:ERRCODE  ; new image
"RTN","MAGDIR81",81,0)
 . S ERRCODE=$$NEWIMAGE()
"RTN","MAGDIR81",82,0)
 . I ERRCODE D  ; error - abort image processing
"RTN","MAGDIR81",83,0)
 . . D ERROR^MAGDIR8("STORE",ERRCODE,.MSG,$T(+0))
"RTN","MAGDIR81",84,0)
 . . Q
"RTN","MAGDIR81",85,0)
 . Q
"RTN","MAGDIR81",86,0)
 ;
"RTN","MAGDIR81",87,0)
 ;create the image pointer
"RTN","MAGDIR81",88,0)
 I MODPARMS="<DICOM>" D  ; store DICOM image type in VistA
"RTN","MAGDIR81",89,0)
 . S FILEDATA("OBJECT TYPE")=100 ; DICOM image type
"RTN","MAGDIR81",90,0)
 . S FILEDATA("EXTENSION")="EXT^DCM" ; specify the DICOM file extension
"RTN","MAGDIR81",91,0)
 . Q
"RTN","MAGDIR81",92,0)
 E  D  ; convert DICOM image type to TGA and store it in VistA
"RTN","MAGDIR81",93,0)
 . S FILEDATA("OBJECT TYPE")=3 ; XRAY image type
"RTN","MAGDIR81",94,0)
 . S FILEDATA("EXTENSION")="EXT^TGA" ; specify the TGA file extension
"RTN","MAGDIR81",95,0)
 . Q
"RTN","MAGDIR81",96,0)
 S FILEDATA("ABSTRACT")="ABS^STUFFONLY" ; specify the abstract net loc
"RTN","MAGDIR81",97,0)
 ;
"RTN","MAGDIR81",98,0)
 S ERRCODE=$$IMAGE^MAGDIR9B ; create the ^MAG(2005) entry for the image
"RTN","MAGDIR81",99,0)
 I ERRCODE D  ; error - abort image processing
"RTN","MAGDIR81",100,0)
 . D ERROR^MAGDIR8("STORE",ERRCODE,.MSG,$T(+0))
"RTN","MAGDIR81",101,0)
 . Q
"RTN","MAGDIR81",102,0)
 E  D  ; no error
"RTN","MAGDIR81",103,0)
 . S X="0|"_RETURN
"RTN","MAGDIR81",104,0)
 . ; save pname, pid, dob, age, and sex from DEM^VADPT for gateway
"RTN","MAGDIR81",105,0)
 . F I=1:1:5 S X=X_"|"_VADM(I)
"RTN","MAGDIR81",106,0)
 . S X=X_"|"_$$GETICN^MPIF001(DFN) ; save ICN value
"RTN","MAGDIR81",107,0)
 . D RESULT^MAGDIR8("STORE",X)
"RTN","MAGDIR81",108,0)
 . Q
"RTN","MAGDIR81",109,0)
 Q
"RTN","MAGDIR81",110,0)
 ;
"RTN","MAGDIR81",111,0)
NEWIMAGE() ; processing for a new image
"RTN","MAGDIR81",112,0)
 N ERRORMSG ;- error message causing processing to stop
"RTN","MAGDIR81",113,0)
 N PIDCHECK ;- return value of from $$PIDCHECK^MAGDIR8A()
"RTN","MAGDIR81",114,0)
 ;
"RTN","MAGDIR81",115,0)
 I MAGIEN D  I $L(ERRORMSG) Q ERRORMSG
"RTN","MAGDIR81",116,0)
 . N I,X
"RTN","MAGDIR81",117,0)
 . K MSG S I=0
"RTN","MAGDIR81",118,0)
 . I IMAGEUID=$$GETUID(MACHID) D  ; same image as last one
"RTN","MAGDIR81",119,0)
 . . ; process the image again, after software crash
"RTN","MAGDIR81",120,0)
 . . ; If the software crashed processing the first image, it might
"RTN","MAGDIR81",121,0)
 . . ; delete the image without ever writing it to the file server.
"RTN","MAGDIR81",122,0)
 . . ; Now, the image processing software has a second chance.
"RTN","MAGDIR81",123,0)
 . . S I=I+1,MSG(I)="Reprocessing image """_FROMPATH_""""
"RTN","MAGDIR81",124,0)
 . . S I=I+1,MSG(I)="which is partially in the database (#"_MAGIEN_") for"
"RTN","MAGDIR81",125,0)
 . . D ERROR^MAGDIR8("STORE","1 Image partially in the database",.MSG,$T(+0))
"RTN","MAGDIR81",126,0)
 . . S ERRORMSG="" ; this is not an error!
"RTN","MAGDIR81",127,0)
 . . Q
"RTN","MAGDIR81",128,0)
 . E  D  ; don't accept images with duplicate UIDs
"RTN","MAGDIR81",129,0)
 . . S I=I+1,MSG(I)="Image """_FROMPATH_""""
"RTN","MAGDIR81",130,0)
 . . S I=I+1,MSG(I)="is already in the database (#"_MAGIEN_") for"
"RTN","MAGDIR81",131,0)
 . . S ERRORMSG="-1 Image already in database"
"RTN","MAGDIR81",132,0)
 . . Q
"RTN","MAGDIR81",133,0)
 . S X=$P($G(^MAG(2005,MAGIEN,2)),"^",1)
"RTN","MAGDIR81",134,0)
 . S X=$S(X:$$FMTE^XLFDT(X,1),1:"<no date known>")
"RTN","MAGDIR81",135,0)
 . S I=I+1,MSG(I)=""""_$P($G(^MAG(2005,MAGIEN,0)),"^")_""""
"RTN","MAGDIR81",136,0)
 . S I=I+1,MSG(I)="Entered into VistA database on "_X
"RTN","MAGDIR81",137,0)
 . S I=I+1,MSG(I)="UID = "_IMAGEUID
"RTN","MAGDIR81",138,0)
 . Q
"RTN","MAGDIR81",139,0)
 ;
"RTN","MAGDIR81",140,0)
 D SAVEUID(MACHID,IMAGEUID) ; record the UID of the image being processed
"RTN","MAGDIR81",141,0)
 ;
"RTN","MAGDIR81",142,0)
 ; lookup the study by ACNUMB/CASENUMB, get DFN, and double-check PID
"RTN","MAGDIR81",143,0)
 S ERRCODE=$$LOOKUP Q:ERRCODE ERRCODE
"RTN","MAGDIR81",144,0)
 ;
"RTN","MAGDIR81",145,0)
 S PIDCHECK=$$PIDCHECK^MAGDIR8A()
"RTN","MAGDIR81",146,0)
 I PIDCHECK D  Q "-2 Image Association Problem" ; didn't find the study
"RTN","MAGDIR81",147,0)
 . N CASETEXT,COLUMNS,MFGR,MODEL,MODIEN,OFFSET,ROWS
"RTN","MAGDIR81",148,0)
 . ; formulate error message
"RTN","MAGDIR81",149,0)
 . K MSG
"RTN","MAGDIR81",150,0)
 . S MSG(1)=PIDCHECK
"RTN","MAGDIR81",151,0)
 . S (ROWS,COLUMNS,OFFSET,MODIEN,MFGR,MODEL,CASETEXT)=""
"RTN","MAGDIR81",152,0)
 . I 'IMPORTER D
"RTN","MAGDIR81",153,0)
 . . D MOVE^MAGDLBAA
"RTN","MAGDIR81",154,0)
 . . Q
"RTN","MAGDIR81",155,0)
 . E  D
"RTN","MAGDIR81",156,0)
 . . D STORE^MAGDIR8R ; record miss-matched image
"RTN","MAGDIR81",157,0)
 . . Q
"RTN","MAGDIR81",158,0)
 . Q
"RTN","MAGDIR81",159,0)
 ; create the group pointer
"RTN","MAGDIR81",160,0)
 I IMGSVC="RAD" D  Q:ERRCODE ERRCODE
"RTN","MAGDIR81",161,0)
 . S ERRCODE=$$GROUP^MAGDIR9A
"RTN","MAGDIR81",162,0)
 . Q
"RTN","MAGDIR81",163,0)
 E  I IMGSVC="CON" D  Q:ERRCODE ERRCODE
"RTN","MAGDIR81",164,0)
 . S ERRCODE=$$GROUP^MAGDIR9E
"RTN","MAGDIR81",165,0)
 . Q
"RTN","MAGDIR81",166,0)
 E  D  Q 3  ; undefined imaging service - same as error #4 in LOOKUP
"RTN","MAGDIR81",167,0)
 . K MSG
"RTN","MAGDIR81",168,0)
 . S MSG(1)="Undefined Imaging Service: "_IMGSVC
"RTN","MAGDIR81",169,0)
 . D ERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR81",170,0)
 . Q
"RTN","MAGDIR81",171,0)
 ; delete import reconciliation entry
"RTN","MAGDIR81",172,0)
 I IMPORTER,$L(OLDPATH) Q $$DELETE^MAGDIR8R(IMAGEUID,MACHID,OLDPATH)
"RTN","MAGDIR81",173,0)
 Q 0
"RTN","MAGDIR81",174,0)
 ;
"RTN","MAGDIR81",175,0)
SAVEUID(MACHID,UID) ; record the UID of the image being processed
"RTN","MAGDIR81",176,0)
 N D0,X
"RTN","MAGDIR81",177,0)
 S D0=$O(^MAGD(2006.5715,"B",MACHID,"")) D:'D0
"RTN","MAGDIR81",178,0)
 . L +^MAGD(2006.5715):1E9 ; Background process MUST wait
"RTN","MAGDIR81",179,0)
 . S D0=$O(^MAGD(2006.5715," "),-1)+1
"RTN","MAGDIR81",180,0)
 . S X=$G(^MAGD(2006.5715,0))
"RTN","MAGDIR81",181,0)
 . S $P(X,"^",1,2)="CURRENT IMAGE^2006.5715"
"RTN","MAGDIR81",182,0)
 . S $P(X,"^",3)=D0
"RTN","MAGDIR81",183,0)
 . S $P(X,"^",4)=$P(X,"^",4)+1
"RTN","MAGDIR81",184,0)
 . S ^MAGD(2006.5715,0)=X
"RTN","MAGDIR81",185,0)
 . S ^MAGD(2006.5715,D0,0)=MACHID
"RTN","MAGDIR81",186,0)
 . S ^MAGD(2006.5715,"B",MACHID,D0)=""
"RTN","MAGDIR81",187,0)
 . L -^MAGD(2006.5715)
"RTN","MAGDIR81",188,0)
 . Q
"RTN","MAGDIR81",189,0)
 S $P(^MAGD(2006.5715,D0,0),"^",2)=UID
"RTN","MAGDIR81",190,0)
 Q
"RTN","MAGDIR81",191,0)
 ;
"RTN","MAGDIR81",192,0)
GETUID(MACHID) ; lookup the UID of the last image processed
"RTN","MAGDIR81",193,0)
 N D0
"RTN","MAGDIR81",194,0)
 S D0=+$O(^MAGD(2006.5715,"B",MACHID,""))
"RTN","MAGDIR81",195,0)
 Q $P($G(^MAGD(2006.5715,D0,0)),"^",2)
"RTN","MAGDIR81",196,0)
 ;
"RTN","MAGDIR81",197,0)
MULTFRAM ; Handle additional images in a multiframe object
"RTN","MAGDIR81",198,0)
 ; Get the information from the first image for the additional ones
"RTN","MAGDIR81",199,0)
 ;
"RTN","MAGDIR81",200,0)
 N DIQUIET,INAME,MAG0,MAG40,MAG100,MAGPACS
"RTN","MAGDIR81",201,0)
 N SOPCLASP ; pointer to SOP Class file (#2006.532)
"RTN","MAGDIR81",202,0)
 S MAG0=^MAG(2005,MAGIEN,0),MAG1=$G(^(1)),MAG2=$G(^(2))
"RTN","MAGDIR81",203,0)
 S MAG40=$G(^MAG(2005,MAGIEN,40)),MAG100=$G(^(100))
"RTN","MAGDIR81",204,0)
 S MAGPACS=$G(^MAG(2005,MAGIEN,"PACS"))
"RTN","MAGDIR81",205,0)
 S INAME=$P(MAG0,"^",1) ; field .01
"RTN","MAGDIR81",206,0)
 S PNAMEVAH=$P(INAME,"  ",1),DCMPID=$P(INAME,"  ",2)
"RTN","MAGDIR81",207,0)
 S DFN=$P(MAG0,"^",7) ; field 5
"RTN","MAGDIR81",208,0)
 S MAGGP=$P(MAG0,"^",10) ; field 14
"RTN","MAGDIR81",209,0)
 S DATETIME=$P(MAG2,"^",5) ; field 15
"RTN","MAGDIR81",210,0)
 S FILEDATA("MODALITY")=MODALITY
"RTN","MAGDIR81",211,0)
 S FILEDATA("PARENT FILE")=$P(MAG2,"^",6) ; field 16
"RTN","MAGDIR81",212,0)
 S FILEDATA("PARENT IEN")=$P(MAG2,"^",7) ; field 17
"RTN","MAGDIR81",213,0)
 S FILEDATA("PARENT FILE PTR")=$P(MAG2,"^",8) ; field 18
"RTN","MAGDIR81",214,0)
 S FILEDATA("RAD REPORT")=$P(MAGPACS,"^",2) ; field 61
"RTN","MAGDIR81",215,0)
 S FILEDATA("RAD PROC PTR")=$P(MAGPACS,"^",3) ; field 62
"RTN","MAGDIR81",216,0)
 S FILEDATA("PACKAGE")=$P(MAG40,"^",1) ; field 40
"RTN","MAGDIR81",217,0)
 ; field 41 is not needed
"RTN","MAGDIR81",218,0)
 S FILEDATA("TYPE")=$P(MAG40,"^",3) ; field 42
"RTN","MAGDIR81",219,0)
 S FILEDATA("PROC/EVENT")=$P(MAG40,"^",4) ; field 43
"RTN","MAGDIR81",220,0)
 S FILEDATA("SPEC/SUBSPEC")=$P(MAG40,"^",5) ; field 44
"RTN","MAGDIR81",221,0)
 S FILEDATA("ACQUISITION DEVICE")=$P(MAG100,"^",4) ; field 107
"RTN","MAGDIR81",222,0)
 ; get the SOP Class pointer (file 2005, field 251)
"RTN","MAGDIR81",223,0)
 S SOPCLASP=$O(^MAG(2006.532,"B",SOPCLASS,""))
"RTN","MAGDIR81",224,0)
 S FILEDATA("SOP CLASS POINTER")=SOPCLASP
"RTN","MAGDIR81",225,0)
 S PROCDESC=$P(MAG2,"^",4) ; field 10
"RTN","MAGDIR81",226,0)
 ; S X="" F  S X=$O(FILEDATA(X)) Q:X=""  I FILEDATA(X)="" K FILEDATA(X)
"RTN","MAGDIR81",227,0)
 I PROCDESC?.E1" (#".N1")" S PROCDESC=$P(PROCDESC," (#")
"RTN","MAGDIR81",228,0)
 ; lookup patient in VistA database - needed to build VADM array
"RTN","MAGDIR81",229,0)
 S DIQUIET=1 D DEM^VADPT
"RTN","MAGDIR81",230,0)
 Q
"RTN","MAGDIR81",231,0)
 ;
"RTN","MAGDIR81",232,0)
LOOKUP() ; lookup the patient/study using cross-reference
"RTN","MAGDIR81",233,0)
 I IMGSVC="RAD" D
"RTN","MAGDIR81",234,0)
 . D RADLKUP^MAGDIR8A
"RTN","MAGDIR81",235,0)
 . Q
"RTN","MAGDIR81",236,0)
 E  I IMGSVC="CON" D
"RTN","MAGDIR81",237,0)
 . S ACNUMB=CASENUMB
"RTN","MAGDIR81",238,0)
 . D CONLKUP^MAGDIR8A
"RTN","MAGDIR81",239,0)
 . Q
"RTN","MAGDIR81",240,0)
 E  D  Q 4 ; undefined imaging service - same as error #3 in NEWIMAGE
"RTN","MAGDIR81",241,0)
 . K MSG
"RTN","MAGDIR81",242,0)
 . S MSG(1)="Undefined Imaging Service: "_IMGSVC
"RTN","MAGDIR81",243,0)
 . D ERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR81",244,0)
 . Q
"RTN","MAGDIR81",245,0)
 Q 0
"RTN","MAGDIR8R")
0^5^B53835298
"RTN","MAGDIR8R",1,0)
MAGDIR8R ;WOIFO/PMK - Automatic Import Reconciliation Workflow ; 04 Feb 2009 10:18 AM
"RTN","MAGDIR8R",2,0)
 ;;3.0;IMAGING;**53**;Mar 19, 2002;Build 1719;Apr 28, 2010
"RTN","MAGDIR8R",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDIR8R",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR8R",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDIR8R",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDIR8R",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDIR8R",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDIR8R",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDIR8R",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDIR8R",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDIR8R",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDIR8R",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDIR8R",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDIR8R",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDIR8R",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR8R",17,0)
 ;;
"RTN","MAGDIR8R",18,0)
 ;
"RTN","MAGDIR8R",19,0)
DISPLAY ;Display a study
"RTN","MAGDIR8R",20,0)
 N HEADING ;-- title of display
"RTN","MAGDIR8R",21,0)
 N IEN ;------ internal entry number in DATAFILE
"RTN","MAGDIR8R",22,0)
 N MACHID ;--- machine id (hostname)
"RTN","MAGDIR8R",23,0)
 N MODALITY ;- DICOM modality, for counting how many images
"RTN","MAGDIR8R",24,0)
 N NONE ;----- flag indicating whether or not there are studies
"RTN","MAGDIR8R",25,0)
 N PNAMEDCM ;- patient name in DICOM format
"RTN","MAGDIR8R",26,0)
 N SERIEUID ;- DICOM series instance uid
"RTN","MAGDIR8R",27,0)
 N STUDYUID ;- DICOM study instance uid array
"RTN","MAGDIR8R",28,0)
 N I,J,K,X
"RTN","MAGDIR8R",29,0)
 ;
"RTN","MAGDIR8R",30,0)
 S IOF="#" ; remove this later
"RTN","MAGDIR8R",31,0)
 ;
"RTN","MAGDIR8R",32,0)
 S HEADING="DICOM Images that need to be Reconciled and Imported"
"RTN","MAGDIR8R",33,0)
 S X=$$BUILD()
"RTN","MAGDIR8R",34,0)
 S NONE=1,MACHID=""
"RTN","MAGDIR8R",35,0)
 F  S MACHID=$O(^TMP("MAG",$J,"IRWF",MACHID)) Q:MACHID=""  D
"RTN","MAGDIR8R",36,0)
 . D DISPLAY1
"RTN","MAGDIR8R",37,0)
 . D CONTINUE
"RTN","MAGDIR8R",38,0)
 . Q
"RTN","MAGDIR8R",39,0)
 I NONE W !!,"No images to correct" D CONTINUE
"RTN","MAGDIR8R",40,0)
 Q
"RTN","MAGDIR8R",41,0)
 ;
"RTN","MAGDIR8R",42,0)
DISPLAY1 ; Display for one machine 
"RTN","MAGDIR8R",43,0)
 N DATA ;----- data about the entry
"RTN","MAGDIR8R",44,0)
 D HEADING
"RTN","MAGDIR8R",45,0)
 S I=0 F  S I=$O(^TMP("MAG",$J,"IRWF",MACHID,I)) Q:'I  D
"RTN","MAGDIR8R",46,0)
 . I '$$GETDATA(I,"LIST",.DATA) Q
"RTN","MAGDIR8R",47,0)
 . S NONE=0 ; there are studies to correct
"RTN","MAGDIR8R",48,0)
 . I $Y>43 D CONTINUE,HEADING
"RTN","MAGDIR8R",49,0)
 . W !,$J(I,3),")"
"RTN","MAGDIR8R",50,0)
 . W ?5,$J(DATA("PID"),14) ; DoD pid is 14 characters: FP/***********
"RTN","MAGDIR8R",51,0)
 . W ?20,$E($$NAME(DATA("PNAMEDCM")),1,25)
"RTN","MAGDIR8R",52,0)
 . W ?47,DATA("ACNUMB"),?64,$$DATE(DATA("STUDYDAT"),"S")
"RTN","MAGDIR8R",53,0)
 . W ?72
"RTN","MAGDIR8R",54,0)
 . S MODALITY=""
"RTN","MAGDIR8R",55,0)
 . F  S MODALITY=$O(^TMP("MAG",$J,"IRWF",MACHID,I,"MOD",MODALITY)) Q:MODALITY=""  D
"RTN","MAGDIR8R",56,0)
 . . W " ",MODALITY,"=",^TMP("MAG",$J,"IRWF",MACHID,I,"MOD",MODALITY)
"RTN","MAGDIR8R",57,0)
 . . Q
"RTN","MAGDIR8R",58,0)
 . Q
"RTN","MAGDIR8R",59,0)
 Q
"RTN","MAGDIR8R",60,0)
 ;
"RTN","MAGDIR8R",61,0)
HEADING ; output the heading
"RTN","MAGDIR8R",62,0)
 N TAB,X
"RTN","MAGDIR8R",63,0)
 S X=HEADING_" ("_MACHID_")"
"RTN","MAGDIR8R",64,0)
 S TAB=(80-$L(X))/2
"RTN","MAGDIR8R",65,0)
 W @IOF,?TAB,X
"RTN","MAGDIR8R",66,0)
 W !?TAB,$TR($J("",$L(X))," ","-")
"RTN","MAGDIR8R",67,0)
 W !!,"  #",?7,"Patient ID",?22,"DICOM Patient Name"
"RTN","MAGDIR8R",68,0)
 W ?49,"Accession #",?66,"Date",?73,"Images"
"RTN","MAGDIR8R",69,0)
 W !,"----",?5,"--------------",?20,"-------------------------",?47,"----------------"
"RTN","MAGDIR8R",70,0)
 W ?64,"--------",?73,"------"
"RTN","MAGDIR8R",71,0)
 Q
"RTN","MAGDIR8R",72,0)
 ;
"RTN","MAGDIR8R",73,0)
NAME(NAME) ; convert person name from DICOM format to displayable one
"RTN","MAGDIR8R",74,0)
 N CHAR,I,X
"RTN","MAGDIR8R",75,0)
 S X=""
"RTN","MAGDIR8R",76,0)
 F I=1:1:$L(NAME) D
"RTN","MAGDIR8R",77,0)
 . S CHAR=$E(NAME,I)
"RTN","MAGDIR8R",78,0)
 . I CHAR="^" D
"RTN","MAGDIR8R",79,0)
 . . ; the first "^" becomes a comma, while the others become spaces
"RTN","MAGDIR8R",80,0)
 . . S X=X_$S($F(NAME,"^")=(I+1):",",1:" ")
"RTN","MAGDIR8R",81,0)
 . . Q
"RTN","MAGDIR8R",82,0)
 . E  S X=X_$E(NAME,I)
"RTN","MAGDIR8R",83,0)
 Q X
"RTN","MAGDIR8R",84,0)
 ;
"RTN","MAGDIR8R",85,0)
DATE(YYYYMMDD,FORMAT) ; convert date from DICOM format to displayable one
"RTN","MAGDIR8R",86,0)
 ; FORMAT: B for birthday mm/dd/yyyy, S for short mm/dd/yy, L for long
"RTN","MAGDIR8R",87,0)
 N M
"RTN","MAGDIR8R",88,0)
 S FORMAT=$G(FORMAT)
"RTN","MAGDIR8R",89,0)
 I FORMAT'="B",FORMAT'="S",FORMAT'="L" Q "Wrong format: "_FORMAT
"RTN","MAGDIR8R",90,0)
 I YYYYMMDD="" Q ""
"RTN","MAGDIR8R",91,0)
 I YYYYMMDD="<unknown>" Q YYYYMMDD
"RTN","MAGDIR8R",92,0)
 I FORMAT="B" Q $E(YYYYMMDD,5,6)_"/"_$E(YYYYMMDD,7,8)_"/"_$E(YYYYMMDD,1,4)
"RTN","MAGDIR8R",93,0)
 I FORMAT="S" Q $E(YYYYMMDD,5,6)_"/"_$E(YYYYMMDD,7,8)_"/"_$E(YYYYMMDD,3,4)
"RTN","MAGDIR8R",94,0)
 S M=+$E(YYYYMMDD,5,6),M=(3*(M-1))+1
"RTN","MAGDIR8R",95,0)
 S M=$E("JanFebMarAprMayJunJulAugSepOctNovDec",M,M+2)
"RTN","MAGDIR8R",96,0)
 Q M_" "_(+$E(YYYYMMDD,7,8))_", "_$E(YYYYMMDD,1,4)
"RTN","MAGDIR8R",97,0)
 ;
"RTN","MAGDIR8R",98,0)
CONTINUE ; prompt
"RTN","MAGDIR8R",99,0)
 R !!,"Press <Enter> to continue...",X:$G(DTIME,1E5)
"RTN","MAGDIR8R",100,0)
 Q
"RTN","MAGDIR8R",101,0)
 ;
"RTN","MAGDIR8R",102,0)
BUILD() ;
"RTN","MAGDIR8R",103,0)
 N COUNT ;---- count of images
"RTN","MAGDIR8R",104,0)
 N DATA ;----- data about the entry
"RTN","MAGDIR8R",105,0)
 ;
"RTN","MAGDIR8R",106,0)
 K ^TMP("MAG",$J,"IRWF")
"RTN","MAGDIR8R",107,0)
 S COUNT=0
"RTN","MAGDIR8R",108,0)
 ; prevent update of DATAFILE while someone is starting Importer
"RTN","MAGDIR8R",109,0)
 L +^MAGD(2006.5752,0):1E9
"RTN","MAGDIR8R",110,0)
 S IEN=0 F  S IEN=$O(^MAGD(2006.5752,IEN)) Q:'IEN  D
"RTN","MAGDIR8R",111,0)
 . S X=$$GETDATA(IEN,"IEN",.DATA)
"RTN","MAGDIR8R",112,0)
 . S MACHID=DATA("MACHID")
"RTN","MAGDIR8R",113,0)
 . S MODALITY=DATA("MODALITY")
"RTN","MAGDIR8R",114,0)
 . S STUDYUID=DATA("STUDYUID")
"RTN","MAGDIR8R",115,0)
 . S SERIEUID=DATA("SERIEUID")
"RTN","MAGDIR8R",116,0)
 . S I=$G(STUDYUID(STUDYUID))
"RTN","MAGDIR8R",117,0)
 . I I="" S (I,COUNT)=COUNT+1,STUDYUID(STUDYUID)=COUNT
"RTN","MAGDIR8R",118,0)
 . S ^TMP("MAG",$J,"IRWF",MACHID,I,"IEN",SERIEUID,IEN)=""
"RTN","MAGDIR8R",119,0)
 . S ^(MODALITY)=$G(^TMP("MAG",$J,"IRWF",MACHID,I,"MOD",MODALITY))+1
"RTN","MAGDIR8R",120,0)
 . Q
"RTN","MAGDIR8R",121,0)
 L -^MAGD(2006.5752,0)
"RTN","MAGDIR8R",122,0)
 Q COUNT
"RTN","MAGDIR8R",123,0)
 ;
"RTN","MAGDIR8R",124,0)
GETDATA(I,MODE,DATA) ; get the data from the I-th entry in the DATAFILE
"RTN","MAGDIR8R",125,0)
 ; if MODE="LIST", then I is the index into the LIST
"RTN","MAGDIR8R",126,0)
 ; if MODE="IEN", then I is the actual internal entry number
"RTN","MAGDIR8R",127,0)
 N IEN,J,K,SERIEUID,VARS,X
"RTN","MAGDIR8R",128,0)
 K DATA Q:'$G(I) 0  Q:'$D(MODE) 0
"RTN","MAGDIR8R",129,0)
 I MODE="LIST" D
"RTN","MAGDIR8R",130,0)
 . S SERIEUID=$O(^TMP("MAG",$J,"IRWF",MACHID,I,"IEN",""))
"RTN","MAGDIR8R",131,0)
 . S IEN=$O(^TMP("MAG",$J,"IRWF",MACHID,I,"IEN",SERIEUID,""))
"RTN","MAGDIR8R",132,0)
 . Q
"RTN","MAGDIR8R",133,0)
 E  I MODE="IEN" S IEN=I
"RTN","MAGDIR8R",134,0)
 E  Q 0
"RTN","MAGDIR8R",135,0)
 M X=^MAGD(2006.5752,IEN)
"RTN","MAGDIR8R",136,0)
 F J=0:1:3 F K=1:1:$L(X(J),"^") I $P(X(J),"^",K)="<unknown>" S $P(X(J),"^",K)=""
"RTN","MAGDIR8R",137,0)
 S VARS(0)="PNAME^PID^MACHID" ; 0 = patient level
"RTN","MAGDIR8R",138,0)
 S VARS(1)="STUDYDAT^ACNUMB^STUDYUID" ; 1 = study level
"RTN","MAGDIR8R",139,0)
 S VARS(2)="MODALITY^SERIEUID" ; 2 = series level
"RTN","MAGDIR8R",140,0)
 S VARS(3)="FROMPATH^IMAGEUID" ; 3 = instance level
"RTN","MAGDIR8R",141,0)
 F J=0:1:3 D  ; iterate through the levels
"RTN","MAGDIR8R",142,0)
 . F K=1:1:$L(VARS(J),"^") S DATA($P(VARS(J),"^",K))=$P(X(J),"^",K)
"RTN","MAGDIR8R",143,0)
 . Q
"RTN","MAGDIR8R",144,0)
 S DATA("PNAMEDCM")=$TR(DATA("PNAME"),"|","^") K DATA("PNAME")
"RTN","MAGDIR8R",145,0)
 Q 1
"RTN","MAGDIR8R",146,0)
 ;
"RTN","MAGDIR8R",147,0)
STORE ;  store an entry
"RTN","MAGDIR8R",148,0)
 N I,IEN,PNAME,X
"RTN","MAGDIR8R",149,0)
 ; patient data
"RTN","MAGDIR8R",150,0)
 S PNAME=$TR(PNAMEDCM,"^","|")
"RTN","MAGDIR8R",151,0)
 ; patient data
"RTN","MAGDIR8R",152,0)
 S X(0)=PNAME_"^"_PID_"^"_MACHID
"RTN","MAGDIR8R",153,0)
 ; study data
"RTN","MAGDIR8R",154,0)
 S X(1)=STUDYDAT_"^"_ACNUMB_"^"_STUDYUID
"RTN","MAGDIR8R",155,0)
 ; series data
"RTN","MAGDIR8R",156,0)
 S X(2)=MODALITY_"^"_SERIEUID
"RTN","MAGDIR8R",157,0)
 ; object data
"RTN","MAGDIR8R",158,0)
 S X(3)=FROMPATH_"^"_IMAGEUID
"RTN","MAGDIR8R",159,0)
 ;
"RTN","MAGDIR8R",160,0)
 ; prevent update of DATAFILE while someone is starting Importer
"RTN","MAGDIR8R",161,0)
 L +^MAGD(2006.5752,0):1E9 ; serialize name generation code
"RTN","MAGDIR8R",162,0)
 I '$D(^MAGD(2006.5752,0)) S ^MAGD(2006.5752,0)="Importable DICOM Objects^^0^0"
"RTN","MAGDIR8R",163,0)
 S IEN=$P(^MAGD(2006.5752,0),"^",3)+1
"RTN","MAGDIR8R",164,0)
 S $P(^MAGD(2006.5752,0),"^",3,4)=IEN_"^"_IEN
"RTN","MAGDIR8R",165,0)
 M ^MAGD(2006.5752,IEN)=X
"RTN","MAGDIR8R",166,0)
 L -^MAGD(2006.5752,0)
"RTN","MAGDIR8R",167,0)
 S ^MAGD(2006.5752,"C",IMAGEUID,IEN)="" ; index by SOP Instance UID
"RTN","MAGDIR8R",168,0)
 S ^MAGD(2006.5752,"D",MACHID,FROMPATH,IEN)="" ; index by file path
"RTN","MAGDIR8R",169,0)
 Q
"RTN","MAGDIR8R",170,0)
 ;
"RTN","MAGDIR8R",171,0)
DELETE(IMAGEUID,MACHID,OLDPATH) ; remove an entry
"RTN","MAGDIR8R",172,0)
 N RETURN
"RTN","MAGDIR8R",173,0)
 L +^MAGD(2006.5752,0):1E9 ; serialize name generation code
"RTN","MAGDIR8R",174,0)
 S RETURN=$$DELETE1(IMAGEUID,MACHID,OLDPATH)
"RTN","MAGDIR8R",175,0)
 L -^MAGD(2006.5752,0)
"RTN","MAGDIR8R",176,0)
 Q RETURN
"RTN","MAGDIR8R",177,0)
 ;
"RTN","MAGDIR8R",178,0)
DELETE1(IMAGEUID,MACHID,OLDPATH) ; remove the single entry
"RTN","MAGDIR8R",179,0)
 N EXIST,IEN,X
"RTN","MAGDIR8R",180,0)
 S IEN=$O(^MAGD(2006.5752,"D",MACHID,OLDPATH,"")) Q:'IEN 0
"RTN","MAGDIR8R",181,0)
 M X=^MAGD(2006.5752,IEN)
"RTN","MAGDIR8R",182,0)
 ; image uid's should match (defined as zero for MAGDRPCA call)
"RTN","MAGDIR8R",183,0)
 I IMAGEUID'=$P(X(3),"^",2) D  Q -99
"RTN","MAGDIR8R",184,0)
 . K I,MSG
"RTN","MAGDIR8R",185,0)
 . S I=0
"RTN","MAGDIR8R",186,0)
 . S I=I+1,MSG(I)="IMPORT RECONCILIATION DATABASE FILE DELETION ERROR:"
"RTN","MAGDIR8R",187,0)
 . S I=I+1,MSG(I)="The DICOM SOP Instance UIDs don't agree."
"RTN","MAGDIR8R",188,0)
 . S I=I+1,MSG(I)="Current UID: "_IMAGEUID
"RTN","MAGDIR8R",189,0)
 . S I=I+1,MSG(I)="Previous UID: "_$P(X(3),"^",2)
"RTN","MAGDIR8R",190,0)
 . S I=I+1,MSG(I)="Dump of File ^MAGD(2006.5752,"_IEN_")"
"RTN","MAGDIR8R",191,0)
 . S I=I+1,MSG(I)="^MAGD(2006.5752,"_IEN_",0)="_X(0)
"RTN","MAGDIR8R",192,0)
 . S I=I+1,MSG(I)="^MAGD(2006.5752,"_IEN_",1)="_X(1)
"RTN","MAGDIR8R",193,0)
 . S I=I+1,MSG(I)="^MAGD(2006.5752,"_IEN_",2)="_X(2)
"RTN","MAGDIR8R",194,0)
 . S I=I+1,MSG(I)="^MAGD(2006.5752,"_IEN_",3)="_X(3)
"RTN","MAGDIR8R",195,0)
 . S I=I+1,MSG(I)="Argument 1: "_ARGS
"RTN","MAGDIR8R",196,0)
 . S I=I+1,MSG(I)="Argument 2: "_ARG2
"RTN","MAGDIR8R",197,0)
 . D BADERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR8R",198,0)
 . Q 
"RTN","MAGDIR8R",199,0)
 ; remove the entry
"RTN","MAGDIR8R",200,0)
 S EXIST=$D(^MAGD(2006.5752,IEN))
"RTN","MAGDIR8R",201,0)
 K ^MAGD(2006.5752,IEN)
"RTN","MAGDIR8R",202,0)
 K ^MAGD(2006.5752,"C",IMAGEUID,IEN) ; index by SOP Instance UID
"RTN","MAGDIR8R",203,0)
 K ^MAGD(2006.5752,"D",MACHID,OLDPATH,IEN) ; index by file path
"RTN","MAGDIR8R",204,0)
 L +^MAGD(2006.5752,0):1E9 ; serialize name generation code
"RTN","MAGDIR8R",205,0)
 ; Only subtract 1 from #entries, if we're actually deleting one
"RTN","MAGDIR8R",206,0)
 I EXIST S $P(^(0),"^",4)=$P(^MAGD(2006.5752,0),"^",4)-1
"RTN","MAGDIR8R",207,0)
 L -^MAGD(2006.5752,0)
"RTN","MAGDIR8R",208,0)
 Q 0
"RTN","MAGDIR9A")
0^6^B52130794
"RTN","MAGDIR9A",1,0)
MAGDIR9A ;WOIFO/PMK - Read a DICOM image file ; 01 Oct 2009 6:28 AM
"RTN","MAGDIR9A",2,0)
 ;;3.0;IMAGING;**11,30,51,46,54,53**;Mar 19, 2002;Build 1719;Apr 28, 2010
"RTN","MAGDIR9A",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDIR9A",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR9A",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDIR9A",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDIR9A",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDIR9A",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDIR9A",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDIR9A",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDIR9A",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDIR9A",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDIR9A",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDIR9A",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDIR9A",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDIR9A",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR9A",17,0)
 ;;
"RTN","MAGDIR9A",18,0)
 Q
"RTN","MAGDIR9A",19,0)
 ; M2MB server
"RTN","MAGDIR9A",20,0)
 ;
"RTN","MAGDIR9A",21,0)
 ; This routine creates a ^mag(2005) group entry and links it to the
"RTN","MAGDIR9A",22,0)
 ; associated radiology report
"RTN","MAGDIR9A",23,0)
 ;
"RTN","MAGDIR9A",24,0)
 ;   XXXXXX      XX    XXXXXX
"RTN","MAGDIR9A",25,0)
 ;    XX  XX    XXXX    XX  XX
"RTN","MAGDIR9A",26,0)
 ;    XX  XX   XX  XX   XX  XX
"RTN","MAGDIR9A",27,0)
 ;    XXXXX    XX  XX   XX  XX
"RTN","MAGDIR9A",28,0)
 ;    XX XX    XXXXXX   XX  XX
"RTN","MAGDIR9A",29,0)
 ;    XX  XX   XX  XX   XX  XX
"RTN","MAGDIR9A",30,0)
 ;   XXX  XX   XX  XX  XXXXXX
"RTN","MAGDIR9A",31,0)
 ;
"RTN","MAGDIR9A",32,0)
GROUP() ; entry point from ^MAGDIR81
"RTN","MAGDIR9A",33,0)
 N ACQDEVP ;-- pointer to acquisition device file (#2006.04)
"RTN","MAGDIR9A",34,0)
 N DA ;------ fileman variable
"RTN","MAGDIR9A",35,0)
 N ERRCODE ;- error trap code
"RTN","MAGDIR9A",36,0)
 N GROUP ;--- array to pass group data to ^MAGGTIA
"RTN","MAGDIR9A",37,0)
 N GROUPDFN ; DFN value from image group entry for double checking
"RTN","MAGDIR9A",38,0)
 N P ;-------- scratch variable (pointer to ACQUISITION DEVICE file)
"RTN","MAGDIR9A",39,0)
 N RACNE ;--- external "3rd level" subscript in ^RADPT
"RTN","MAGDIR9A",40,0)
 N RACNI ;--- internal "3rd level" subscript in ^RADPT
"RTN","MAGDIR9A",41,0)
 N RADFN ;--- radiology package's DFN
"RTN","MAGDIR9A",42,0)
 N RADTE ;--- external "2nd level" subscript in ^RADPT
"RTN","MAGDIR9A",43,0)
 N RADTI ;--- internal "2nd level" subscript in ^RADPT
"RTN","MAGDIR9A",44,0)
 N RARPT ;--- 1st level node in ^RARPT for report (ie, the ien)
"RTN","MAGDIR9A",45,0)
 N RARPT3 ;-- 3rd level node for 2005 multiple under ^RARPT's report
"RTN","MAGDIR9A",46,0)
 N RARPTDFN ; DFN value from ^RARPT for double checking
"RTN","MAGDIR9A",47,0)
 N SOPCLASP ; pointer to SOP Class file (#2006.532)
"RTN","MAGDIR9A",48,0)
 N HIT,ISPECIDX,X,Y ; scratch variables
"RTN","MAGDIR9A",49,0)
 ;
"RTN","MAGDIR9A",50,0)
 S ERRCODE=""
"RTN","MAGDIR9A",51,0)
 ;
"RTN","MAGDIR9A",52,0)
 S (RADFN,DA(2))=DFN ; patient DFN variables
"RTN","MAGDIR9A",53,0)
 S RADTI=RADATA("RADPT2") ; case subscript
"RTN","MAGDIR9A",54,0)
 I RADTI="" D  Q ERRCODE
"RTN","MAGDIR9A",55,0)
 . K MSG
"RTN","MAGDIR9A",56,0)
 . S MSG(1)="No radiology case number specified for patient "_DFN
"RTN","MAGDIR9A",57,0)
 . D ERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR9A",58,0)
 . S ERRCODE=-301
"RTN","MAGDIR9A",59,0)
 . Q
"RTN","MAGDIR9A",60,0)
 ;
"RTN","MAGDIR9A",61,0)
 S RADTE=9999999.9999-RADTI ; 9's complement conversion
"RTN","MAGDIR9A",62,0)
 S RACNI=RADATA("RADPT3")
"RTN","MAGDIR9A",63,0)
 S RACNE=$P(CASENUMB,"-",$L(CASENUMB,"-")) ; short case #
"RTN","MAGDIR9A",64,0)
 ;
"RTN","MAGDIR9A",65,0)
 ; check for the existence of the entry in ^RADPT (redundant)
"RTN","MAGDIR9A",66,0)
 I '$D(^RADPT(RADFN,"DT",RADTI,0)) D  Q ERRCODE ; can't process further
"RTN","MAGDIR9A",67,0)
 . K MSG
"RTN","MAGDIR9A",68,0)
 . S MSG(1)="Radiology case "_RADTI_" is not in ^RADPT("_RADFN_")"
"RTN","MAGDIR9A",69,0)
 . D ERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR9A",70,0)
 . S ERRCODE=-302
"RTN","MAGDIR9A",71,0)
 . Q
"RTN","MAGDIR9A",72,0)
 ;
"RTN","MAGDIR9A",73,0)
 ; check for the existence of the report pointer
"RTN","MAGDIR9A",74,0)
 S RARPT=$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),"^",17)
"RTN","MAGDIR9A",75,0)
 ; if the report does not yet exist, create it
"RTN","MAGDIR9A",76,0)
 D:RARPT=""
"RTN","MAGDIR9A",77,0)
 . N RACN
"RTN","MAGDIR9A",78,0)
 . S RACN=RACNE D CREATE^RARIC ; create the report
"RTN","MAGDIR9A",79,0)
 . Q
"RTN","MAGDIR9A",80,0)
 ;
"RTN","MAGDIR9A",81,0)
 ; If RARPT is no longer defined at this point, this means
"RTN","MAGDIR9A",82,0)
 ; that we're dealing with an old study, and the report has
"RTN","MAGDIR9A",83,0)
 ; been archived and purged.
"RTN","MAGDIR9A",84,0)
 ;
"RTN","MAGDIR9A",85,0)
 I '$G(RARPT) D  Q ERRCODE
"RTN","MAGDIR9A",86,0)
 . K MSG
"RTN","MAGDIR9A",87,0)
 . S MSG(1)="IMAGE GROUP CREATION ERROR:"
"RTN","MAGDIR9A",88,0)
 . S MSG(2)="Radiology Report has been archived and purged."
"RTN","MAGDIR9A",89,0)
 . S MSG(3)="Patient "_$G(RADFN)_", Date "_$G(RADTI)_", Case "_$G(RACNI)
"RTN","MAGDIR9A",90,0)
 . D ERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR9A",91,0)
 . S ERRCODE=-303
"RTN","MAGDIR9A",92,0)
 . Q
"RTN","MAGDIR9A",93,0)
 ;
"RTN","MAGDIR9A",94,0)
 ; double check the DFN value from ^RARPT to make sure its right
"RTN","MAGDIR9A",95,0)
 S RARPTDFN=$P($G(^RARPT(RARPT,0)),"^",2)
"RTN","MAGDIR9A",96,0)
 I RARPTDFN'=DFN D  Q ERRCODE ; fatal error
"RTN","MAGDIR9A",97,0)
 . D RADMISS^MAGDIRVE($T(+0),DFN,RARPT,RARPTDFN)
"RTN","MAGDIR9A",98,0)
 . S ERRCODE=-304
"RTN","MAGDIR9A",99,0)
 . Q
"RTN","MAGDIR9A",100,0)
 ;
"RTN","MAGDIR9A",101,0)
 ; initialize FILEDATA for GROUP and IMAGE
"RTN","MAGDIR9A",102,0)
 ; get the acquisition device pointer (file 2005, field 107)
"RTN","MAGDIR9A",103,0)
 S ACQDEVP=$$ACQDEV^MAGDFCNV(MFGR,MODEL,INSTLOC)
"RTN","MAGDIR9A",104,0)
 S FILEDATA("ACQUISITION DEVICE")=ACQDEVP
"RTN","MAGDIR9A",105,0)
 ; get the SOP Class pointer (file 2005, field 251)
"RTN","MAGDIR9A",106,0)
 S SOPCLASP=$O(^MAG(2006.532,"B",SOPCLASS,""))
"RTN","MAGDIR9A",107,0)
 S FILEDATA("SOP CLASS POINTER")=SOPCLASP
"RTN","MAGDIR9A",108,0)
 ;
"RTN","MAGDIR9A",109,0)
 S FILEDATA("MODALITY")=MODALITY
"RTN","MAGDIR9A",110,0)
 S FILEDATA("PARENT FILE")=74
"RTN","MAGDIR9A",111,0)
 S FILEDATA("PARENT IEN")=RARPT
"RTN","MAGDIR9A",112,0)
 S FILEDATA("RAD REPORT")=RARPT
"RTN","MAGDIR9A",113,0)
 S FILEDATA("RAD PROC PTR")=RADATA("PROCIEN")
"RTN","MAGDIR9A",114,0)
 S FILEDATA("PACKAGE")="RAD"
"RTN","MAGDIR9A",115,0)
 S X=$S(MODALITY="NM":"NUCLEAR MEDICINE",1:"RADIOLOGY")
"RTN","MAGDIR9A",116,0)
 S ISPECIDX=$O(^MAG(2005.84,"B",X,""))
"RTN","MAGDIR9A",117,0)
 S X=$$FIELD43^MAGXMA(MODALITY,ISPECIDX,.Y)
"RTN","MAGDIR9A",118,0)
 S FILEDATA("PROC/EVENT")=$S(X=0:Y,1:"")
"RTN","MAGDIR9A",119,0)
 S FILEDATA("SPEC/SUBSPEC")=ISPECIDX
"RTN","MAGDIR9A",120,0)
 ;
"RTN","MAGDIR9A",121,0)
 ; find the corresponding image group node under the report
"RTN","MAGDIR9A",122,0)
 S (HIT,RARPT3)=0
"RTN","MAGDIR9A",123,0)
 F  S RARPT3=$O(^RARPT(RARPT,2005,RARPT3)) Q:'RARPT3  D  Q:HIT  Q:ERRCODE
"RTN","MAGDIR9A",124,0)
 . S MAGGP=+$G(^RARPT(RARPT,2005,RARPT3,0)) ; get imaging group pointer
"RTN","MAGDIR9A",125,0)
 . S GROUPDFN=$P($G(^MAG(2005,MAGGP,0)),"^",7) ; check image DFN value
"RTN","MAGDIR9A",126,0)
 . I GROUPDFN'=DFN D  ; fatal error
"RTN","MAGDIR9A",127,0)
 . . D MISMATCH^MAGDIRVE($T(+0),DFN,MAGGP)
"RTN","MAGDIR9A",128,0)
 . . S ERRCODE=-305
"RTN","MAGDIR9A",129,0)
 . . Q
"RTN","MAGDIR9A",130,0)
 . E  I $P($G(^MAG(2005,MAGGP,0)),"^",6)=11 D
"RTN","MAGDIR9A",131,0)
 . . ; check to see that this group is for the same SOP Class
"RTN","MAGDIR9A",132,0)
 . . S P=$P($G(^MAG(2005,MAGGP,"SOP")),"^",1)
"RTN","MAGDIR9A",133,0)
 . . S HIT=$$EQUIVGRP^MAGDFCNV(P,SOPCLASP) ; equivalent groups?
"RTN","MAGDIR9A",134,0)
 . . Q
"RTN","MAGDIR9A",135,0)
 . Q
"RTN","MAGDIR9A",136,0)
 ;
"RTN","MAGDIR9A",137,0)
 I ERRCODE Q ERRCODE ; fatal image DFN problem
"RTN","MAGDIR9A",138,0)
 ;
"RTN","MAGDIR9A",139,0)
 I 'HIT D  Q:ERRCODE ERRCODE ; the 2005 node does not yet exist
"RTN","MAGDIR9A",140,0)
 . ; create the radiology imaging group
"RTN","MAGDIR9A",141,0)
 . N PROCEDUR,RADRPT,RADPTR
"RTN","MAGDIR9A",142,0)
 . S PROCEDUR="RAD "_FILEDATA("MODALITY")
"RTN","MAGDIR9A",143,0)
 . S RADRPT=FILEDATA("RAD REPORT")
"RTN","MAGDIR9A",144,0)
 . S RADPTR=FILEDATA("RAD PROC PTR")
"RTN","MAGDIR9A",145,0)
 . D NEWGROUP(PROCEDUR,RADRPT,RADPTR) Q:ERRCODE
"RTN","MAGDIR9A",146,0)
 . ;
"RTN","MAGDIR9A",147,0)
 . ; store the cross-reference for the report
"RTN","MAGDIR9A",148,0)
 . D PTR^RARIC
"RTN","MAGDIR9A",149,0)
 . Q
"RTN","MAGDIR9A",150,0)
 ;
"RTN","MAGDIR9A",151,0)
 I 'MAGGP D  Q ERRCODE ; fatal error
"RTN","MAGDIR9A",152,0)
 . K MSG
"RTN","MAGDIR9A",153,0)
 . S MSG(1)="IMAGE GROUP LOOKUP ERROR:"
"RTN","MAGDIR9A",154,0)
 . S MSG(2)="Looking for 2005 cross reference in ^RARPT("_RARPT_")"
"RTN","MAGDIR9A",155,0)
 . D ERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR9A",156,0)
 . S ERRCODE=-308
"RTN","MAGDIR9A",157,0)
 . Q
"RTN","MAGDIR9A",158,0)
 Q 0
"RTN","MAGDIR9A",159,0)
 ;
"RTN","MAGDIR9A",160,0)
NEWGROUP(PROCEDUR,RADRPT,RADPTR) ; create an imaging group (called by ^MAGDIR9E)
"RTN","MAGDIR9A",161,0)
 N I
"RTN","MAGDIR9A",162,0)
 K GROUP S I=0
"RTN","MAGDIR9A",163,0)
 S I=I+1,GROUP(I)=".01^"_PNAMEVAH_"  "_DCMPID_"  "_PROCDESC
"RTN","MAGDIR9A",164,0)
 S I=I+1,GROUP(I)="3^11" ; Object Type -- XRAY Group
"RTN","MAGDIR9A",165,0)
 S I=I+1,GROUP(I)="5^"_DFN
"RTN","MAGDIR9A",166,0)
 S I=I+1,GROUP(I)="6^"_PROCEDUR
"RTN","MAGDIR9A",167,0)
 S I=I+1,GROUP(I)="2005.04^0"
"RTN","MAGDIR9A",168,0)
 S I=I+1,GROUP(I)="10^"_PROCDESC
"RTN","MAGDIR9A",169,0)
 S I=I+1,GROUP(I)="15^"_DATETIME
"RTN","MAGDIR9A",170,0)
 S I=I+1,GROUP(I)="16^"_FILEDATA("PARENT FILE")
"RTN","MAGDIR9A",171,0)
 S I=I+1,GROUP(I)="17^"_FILEDATA("PARENT IEN")
"RTN","MAGDIR9A",172,0)
 S I=I+1,GROUP(I)="60^"_STUDYUID
"RTN","MAGDIR9A",173,0)
 ;
"RTN","MAGDIR9A",174,0)
 ; the following two fields are only for radiology
"RTN","MAGDIR9A",175,0)
 I $D(RADRPT) S I=I+1,GROUP(I)="61^"_RADRPT
"RTN","MAGDIR9A",176,0)
 I $D(RADPTR) S I=I+1,GROUP(I)="62^"_RADPTR
"RTN","MAGDIR9A",177,0)
 ;
"RTN","MAGDIR9A",178,0)
 S I=I+1,GROUP(I)=".05^"_INSTLOC
"RTN","MAGDIR9A",179,0)
 S I=I+1,GROUP(I)="40^"_FILEDATA("PACKAGE")
"RTN","MAGDIR9A",180,0)
 S I=I+1,GROUP(I)="41^"_$O(^MAG(2005.82,"B","CLIN",""))
"RTN","MAGDIR9A",181,0)
 S I=I+1,GROUP(I)="42^"_FILEDATA("TYPE")
"RTN","MAGDIR9A",182,0)
 S I=I+1,GROUP(I)="43^"_FILEDATA("PROC/EVENT")
"RTN","MAGDIR9A",183,0)
 S I=I+1,GROUP(I)="44^"_FILEDATA("SPEC/SUBSPEC")
"RTN","MAGDIR9A",184,0)
 S I=I+1,GROUP(I)="45^"_ORIGINDX
"RTN","MAGDIR9A",185,0)
 S I=I+1,GROUP(I)="107^"_FILEDATA("ACQUISITION DEVICE")
"RTN","MAGDIR9A",186,0)
 S I=I+1,GROUP(I)="110^"_STAMP
"RTN","MAGDIR9A",187,0)
 S I=I+1,GROUP(I)="251^"_FILEDATA("SOP CLASS POINTER")
"RTN","MAGDIR9A",188,0)
 D ADD^MAGGTIA(.RETURN,.GROUP)
"RTN","MAGDIR9A",189,0)
 S MAGGP=+RETURN
"RTN","MAGDIR9A",190,0)
 I 'MAGGP D  Q  ; fatal error
"RTN","MAGDIR9A",191,0)
 . K MSG
"RTN","MAGDIR9A",192,0)
 . S MSG(1)="IMAGE GROUP CREATION ERROR:"
"RTN","MAGDIR9A",193,0)
 . S MSG(2)=$P(RETURN,"^",2,999)
"RTN","MAGDIR9A",194,0)
 . D BADERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR9A",195,0)
 . S ERRCODE=-306
"RTN","MAGDIR9A",196,0)
 . Q
"RTN","MAGDIR9A",197,0)
 ;
"RTN","MAGDIR9A",198,0)
 I MAGGP<LASTIMG D  Q  ; fatal last image pointer error
"RTN","MAGDIR9A",199,0)
 . D GROUPPTR^MAGDIRVE($T(+0),MAGGP,LASTIMG)
"RTN","MAGDIR9A",200,0)
 . S ERRCODE=-307
"RTN","MAGDIR9A",201,0)
 . Q
"RTN","MAGDIR9A",202,0)
 Q
"RTN","MAGDIR9A",203,0)
 ;
"RTN","MAGDIR9B")
0^7^B19341690
"RTN","MAGDIR9B",1,0)
MAGDIR9B ;WOIFO/PMK - Read a DICOM image file ; 19 Nov 2007 07:10 AM
"RTN","MAGDIR9B",2,0)
 ;;3.0;IMAGING;**11,51,50,54,53**;Mar 19, 2002;Build 1719;Apr 28, 2010
"RTN","MAGDIR9B",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDIR9B",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR9B",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDIR9B",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDIR9B",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDIR9B",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDIR9B",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDIR9B",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDIR9B",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDIR9B",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDIR9B",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDIR9B",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDIR9B",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDIR9B",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR9B",17,0)
 ;;
"RTN","MAGDIR9B",18,0)
 Q
"RTN","MAGDIR9B",19,0)
 ; Create an image entry in ^MAG(2005)
"RTN","MAGDIR9B",20,0)
 ;
"RTN","MAGDIR9B",21,0)
IMAGE() ; entry point from ^MAGDIR81 to create an image entry in ^MAG(2005)
"RTN","MAGDIR9B",22,0)
 N I ;-------- scratch counter
"RTN","MAGDIR9B",23,0)
 N IMAGE ;---- image array for ^MAGGTIA
"RTN","MAGDIR9B",24,0)
 N IMAGECNT ;- counter of image in the group
"RTN","MAGDIR9B",25,0)
 N IMAGEPTR ;- value returned by ^MAGGTIA
"RTN","MAGDIR9B",26,0)
 ;
"RTN","MAGDIR9B",27,0)
 ; check that the group has right object type and is for the same person
"RTN","MAGDIR9B",28,0)
 I $P($G(^MAG(2005,MAGGP,0)),"^",6)'=11 D  Q -101 ; fatal error
"RTN","MAGDIR9B",29,0)
 . D OBJECT^MAGDIRVE($T(+0),MAGGP)
"RTN","MAGDIR9B",30,0)
 . Q
"RTN","MAGDIR9B",31,0)
 ;
"RTN","MAGDIR9B",32,0)
 ; check that the group patient DFN matches the image patient DFN
"RTN","MAGDIR9B",33,0)
 I $P(^MAG(2005,MAGGP,0),"^",7)'=DFN D  Q -102 ; fatal error
"RTN","MAGDIR9B",34,0)
 . D MISMATCH^MAGDIRVE($T(+0),DFN,MAGGP)
"RTN","MAGDIR9B",35,0)
 . Q
"RTN","MAGDIR9B",36,0)
 ;
"RTN","MAGDIR9B",37,0)
 ; get the next file number and create the entry for this image
"RTN","MAGDIR9B",38,0)
 ;
"RTN","MAGDIR9B",39,0)
 S IMAGECNT=$P($G(^MAG(2005,MAGGP,1,0)),"^",4)+1 ; next image # in group
"RTN","MAGDIR9B",40,0)
 ;
"RTN","MAGDIR9B",41,0)
 K IMAGE S I=0
"RTN","MAGDIR9B",42,0)
 S I=I+1,IMAGE(I)=".01^"_PNAMEVAH_"  "_DCMPID_"  "_PROCDESC ; used in ^MAGDIR8
"RTN","MAGDIR9B",43,0)
 S I=I+1,IMAGE(I)="5^"_DFN
"RTN","MAGDIR9B",44,0)
 I $D(FILEDATA("SHORT DESCRIPTION")) D  ; set in ^MAGDIR7F
"RTN","MAGDIR9B",45,0)
 . S I=I+1,IMAGE(I)="10^"_FILEDATA("SHORT DESCRIPTION")
"RTN","MAGDIR9B",46,0)
 . Q
"RTN","MAGDIR9B",47,0)
 E  S I=I+1,IMAGE(I)="10^"_PROCDESC_" (#"_IMAGECNT_")" ; used in ^MAGDIR81
"RTN","MAGDIR9B",48,0)
 S I=I+1,IMAGE(I)="14^"_MAGGP
"RTN","MAGDIR9B",49,0)
 S I=I+1,IMAGE(I)="15^"_DATETIME
"RTN","MAGDIR9B",50,0)
 S I=I+1,IMAGE(I)="60^"_IMAGEUID
"RTN","MAGDIR9B",51,0)
 S I=I+1,IMAGE(I)=FILEDATA("EXTENSION") ; specify the image file extension
"RTN","MAGDIR9B",52,0)
 S:$D(FILEDATA("ABSTRACT")) I=I+1,IMAGE(I)=FILEDATA("ABSTRACT")
"RTN","MAGDIR9B",53,0)
 S I=I+1,IMAGE(I)="WRITE^PACS" ; select the PACS Image write location
"RTN","MAGDIR9B",54,0)
 S I=I+1,IMAGE(I)="3^"_FILEDATA("OBJECT TYPE")
"RTN","MAGDIR9B",55,0)
 S I=I+1,IMAGE(I)="6^"_FILEDATA("MODALITY")
"RTN","MAGDIR9B",56,0)
 S I=I+1,IMAGE(I)="16^"_FILEDATA("PARENT FILE")
"RTN","MAGDIR9B",57,0)
 S I=I+1,IMAGE(I)="17^"_FILEDATA("PARENT IEN")
"RTN","MAGDIR9B",58,0)
 S:$D(FILEDATA("PARENT FILE PTR")) I=I+1,IMAGE(I)="18^"_FILEDATA("PARENT FILE PTR")
"RTN","MAGDIR9B",59,0)
 S:$D(FILEDATA("RAD REPORT")) I=I+1,IMAGE(I)="61^"_FILEDATA("RAD REPORT")
"RTN","MAGDIR9B",60,0)
 S:$D(FILEDATA("RAD PROC PTR")) I=I+1,IMAGE(I)="62^"_FILEDATA("RAD PROC PTR")
"RTN","MAGDIR9B",61,0)
 S:MODPARMS["/" I=I+1,IMAGE(I)="BIG^1" ; big file will be output
"RTN","MAGDIR9B",62,0)
 S I=I+1,IMAGE(I)="DICOMSN^"_SERINUMB ; series number
"RTN","MAGDIR9B",63,0)
 S I=I+1,IMAGE(I)="DICOMIN^"_IMAGNUMB ; image number
"RTN","MAGDIR9B",64,0)
 S I=I+1,IMAGE(I)=".05^"_INSTLOC
"RTN","MAGDIR9B",65,0)
 S I=I+1,IMAGE(I)="40^"_FILEDATA("PACKAGE")
"RTN","MAGDIR9B",66,0)
 S I=I+1,IMAGE(I)="41^"_$O(^MAG(2005.82,"B","CLIN",""))
"RTN","MAGDIR9B",67,0)
 S I=I+1,IMAGE(I)="42^"_FILEDATA("TYPE")
"RTN","MAGDIR9B",68,0)
 S I=I+1,IMAGE(I)="43^"_FILEDATA("PROC/EVENT")
"RTN","MAGDIR9B",69,0)
 S I=I+1,IMAGE(I)="44^"_FILEDATA("SPEC/SUBSPEC")
"RTN","MAGDIR9B",70,0)
 S I=I+1,IMAGE(I)="45^"_ORIGINDX
"RTN","MAGDIR9B",71,0)
 S I=I+1,IMAGE(I)="107^"_FILEDATA("ACQUISITION DEVICE")
"RTN","MAGDIR9B",72,0)
 S I=I+1,IMAGE(I)="110^"_STAMP
"RTN","MAGDIR9B",73,0)
 S I=I+1,IMAGE(I)="251^"_FILEDATA("SOP CLASS POINTER")
"RTN","MAGDIR9B",74,0)
 S I=I+1,IMAGE(I)="253^"_SERIEUID
"RTN","MAGDIR9B",75,0)
 D ADD^MAGGTIA(.RETURN,.IMAGE)
"RTN","MAGDIR9B",76,0)
 ;
"RTN","MAGDIR9B",77,0)
 S IMAGEPTR=+RETURN
"RTN","MAGDIR9B",78,0)
 I 'IMAGEPTR D  Q -103 ; fatal error
"RTN","MAGDIR9B",79,0)
 . K MSG
"RTN","MAGDIR9B",80,0)
 . S MSG(1)="IMAGE FILE CREATION ERROR:"
"RTN","MAGDIR9B",81,0)
 . S MSG(2)=$P(RETURN,"^",2,999)
"RTN","MAGDIR9B",82,0)
 . D BADERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR9B",83,0)
 . Q
"RTN","MAGDIR9B",84,0)
 ;
"RTN","MAGDIR9B",85,0)
 I IMAGEPTR<LASTIMG D  Q -104 ; fatal last image pointer error
"RTN","MAGDIR9B",86,0)
 . D IMAGEPTR^MAGDIRVE($T(+0),IMAGEPTR,LASTIMG)
"RTN","MAGDIR9B",87,0)
 . Q
"RTN","MAGDIR9B",88,0)
 ;
"RTN","MAGDIR9B",89,0)
 S $P(RETURN,"^",4)=$$CHKPATH() ; hierarchal file patch check
"RTN","MAGDIR9B",90,0)
 ;
"RTN","MAGDIR9B",91,0)
 Q 0
"RTN","MAGDIR9B",92,0)
 ;
"RTN","MAGDIR9B",93,0)
CHKPATH() ; determine if the path is hierarchal (true) or not (false)
"RTN","MAGDIR9B",94,0)
 N D0,PATH
"RTN","MAGDIR9B",95,0)
 S D0="",PATH=$P(RETURN,"^",2)
"RTN","MAGDIR9B",96,0)
 I $D(^MAG(2005.2,"AC")) S D0=$O(^MAG(2005.2,"AC",PATH,""))
"RTN","MAGDIR9B",97,0)
 E  D
"RTN","MAGDIR9B",98,0)
 . N PLACE
"RTN","MAGDIR9B",99,0)
 . S PLACE=""
"RTN","MAGDIR9B",100,0)
 . F  S PLACE=$O(^MAG(2005.2,"E",PLACE)) Q:PLACE=""  D  Q:D0
"RTN","MAGDIR9B",101,0)
 . . S D0=$O(^MAG(2005.2,"E",PLACE,PATH,""))
"RTN","MAGDIR9B",102,0)
 . . Q
"RTN","MAGDIR9B",103,0)
 . Q
"RTN","MAGDIR9B",104,0)
 Q 'D0 ; network location file
"RTN","MAGDIR9B",105,0)
 ;
"RTN","MAGDLBAA")
0^8^B19867393
"RTN","MAGDLBAA",1,0)
MAGDLBAA ;WOIFO/LB - Routine to move failed dicom images to ^MAG(2006.575 ; 05/18/2007 11:23
"RTN","MAGDLBAA",2,0)
 ;;3.0;IMAGING;**11,51,54,53**;Mar 19, 2002;Build 1719;Apr 28, 2010
"RTN","MAGDLBAA",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDLBAA",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDLBAA",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDLBAA",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDLBAA",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDLBAA",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDLBAA",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDLBAA",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDLBAA",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDLBAA",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDLBAA",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDLBAA",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDLBAA",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDLBAA",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDLBAA",17,0)
 ;;
"RTN","MAGDLBAA",18,0)
 Q
"RTN","MAGDLBAA",19,0)
MOVE ;called from MAGDIR1 to move entries not matching Radiology case #.
"RTN","MAGDLBAA",20,0)
 ;Not done thru FM because the system should be independent.
"RTN","MAGDLBAA",21,0)
 ;These variable are needed to be defined before using this routine:
"RTN","MAGDLBAA",22,0)
 ;PIDCHECK, FIRSTDCM, IMGSVC, MIDCM, MACHID,ACNUMB, CASENUMB, PNAMEDCM, PID
"RTN","MAGDLBAA",23,0)
 ;MODALITY, CASETEXT
"RTN","MAGDLBAA",24,0)
 N DATE,REASON,ENTRY,IEN,NIEN,ORIG,DCMPNME,CASE,CASENUM,PATIENT,RESULT
"RTN","MAGDLBAA",25,0)
 S DATE=$$NOW^XLFDT()\1,RESULT=0
"RTN","MAGDLBAA",26,0)
 ;
"RTN","MAGDLBAA",27,0)
 ; if the entry alreay exists in file 2006.575, skip it
"RTN","MAGDLBAA",28,0)
 S MACHID=$G(MACHID,"A")
"RTN","MAGDLBAA",29,0)
 I $$EXIST(.RESULT,FROMPATH,MACHID,LOCATION) D  Q
"RTN","MAGDLBAA",30,0)
 . D REMOAFX(.RESULT,MACHID,LOCATION,STUDYUID)
"RTN","MAGDLBAA",31,0)
 . Q
"RTN","MAGDLBAA",32,0)
 ;
"RTN","MAGDLBAA",33,0)
 ;ADD ENTRY
"RTN","MAGDLBAA",34,0)
 L +^MAGD(2006.575,0):1E9 ; Background process MUST wait
"RTN","MAGDLBAA",35,0)
 S X=$G(^MAGD(2006.575,0))
"RTN","MAGDLBAA",36,0)
 S $P(X,"^",1,2)="DICOM FAILED IMAGES^2006.575"
"RTN","MAGDLBAA",37,0)
 S IEN=$O(^MAGD(2006.575," "),-1)+1,$P(X,"^",3)=IEN
"RTN","MAGDLBAA",38,0)
 S $P(X,"^",4)=$P(X,"^",4)+1 ; # entries
"RTN","MAGDLBAA",39,0)
 S ^MAGD(2006.575,0)=X
"RTN","MAGDLBAA",40,0)
 ;
"RTN","MAGDLBAA",41,0)
 S REASON=$P(PIDCHECK,",",2)
"RTN","MAGDLBAA",42,0)
 S PATIENT=LASTDCM_","_FIRSTDCM_$S($L(MIDCM)>0:" "_MIDCM,1:"")
"RTN","MAGDLBAA",43,0)
 ; PNAMEDCM usually contains an "^" between last & first name
"RTN","MAGDLBAA",44,0)
 ; CHANGE ^ TO ~
"RTN","MAGDLBAA",45,0)
 S CASE=$TR(ACNUMB,"^","~"),CASENUM=$TR(CASENUMB,"^","~")
"RTN","MAGDLBAA",46,0)
 S DCMPNME=$TR(PNAMEDCM,"^","~")
"RTN","MAGDLBAA",47,0)
 S ^MAGD(2006.575,IEN,0)=FROMPATH_"^"_REASON_"^"_PID_"^"_PATIENT_"^"_DCMPNME
"RTN","MAGDLBAA",48,0)
 S ^MAGD(2006.575,IEN,1)=CASE_"^"_CASENUM_"^"_DATE_"^"_MACHID_"^"_LOCATION
"RTN","MAGDLBAA",49,0)
 S ^MAGD(2006.575,IEN,"AIUID")=$G(IMAGEUID)
"RTN","MAGDLBAA",50,0)
 S ^MAGD(2006.575,IEN,"ASUID")=STUDYUID
"RTN","MAGDLBAA",51,0)
 S ^MAGD(2006.575,IEN,"AMFG")=$G(INSTNAME)_"^"_$G(ROWS)_"^"_$G(COLUMNS)_"^"_$G(OFFSET)_"^"_$G(MODIEN)_"^"_$G(MODALITY)_"^"_$$UP^MAGDFCNV($G(MFGR))_"^"_$$UP^MAGDFCNV($G(MODEL))_"^"_LOCATION
"RTN","MAGDLBAA",52,0)
 S ^MAGD(2006.575,IEN,"ACSTXT")=$G(CASETEXT)
"RTN","MAGDLBAA",53,0)
 ; Image type can be RAD, MEDICINE, SURGERY, etc.
"RTN","MAGDLBAA",54,0)
 S ^MAGD(2006.575,IEN,"TYPE")=$G(IMGSVC)
"RTN","MAGDLBAA",55,0)
 ;Setting xrefs
"RTN","MAGDLBAA",56,0)
 S ^MAGD(2006.575,"B",FROMPATH,IEN)=""
"RTN","MAGDLBAA",57,0)
 ; Clean up---no longer need this cross reference
"RTN","MAGDLBAA",58,0)
 K ^MAGD(2006.575,"D") ; Used for Consults only
"RTN","MAGDLBAA",59,0)
 L -^MAGD(2006.575,0)
"RTN","MAGDLBAA",60,0)
 ;
"RTN","MAGDLBAA",61,0)
 ;The following xref ("F") will be set on the 1st entry having a unique
"RTN","MAGDLBAA",62,0)
 ;STUDYUID. The remaining entries with the same # will be added
"RTN","MAGDLBAA",63,0)
 ;to the RELATED IMAGES multiple field for the entry that set the
"RTN","MAGDLBAA",64,0)
 ;F xref.
"RTN","MAGDLBAA",65,0)
 S ORIG=0
"RTN","MAGDLBAA",66,0)
 I '$D(^MAGD(2006.575,"F",LOCATION,STUDYUID)) D  Q  ; Quit if 1st entry
"RTN","MAGDLBAA",67,0)
 . S ^MAGD(2006.575,"F",LOCATION,STUDYUID,IEN)=""
"RTN","MAGDLBAA",68,0)
 . Q
"RTN","MAGDLBAA",69,0)
 S ORIG=$O(^MAGD(2006.575,"F",LOCATION,STUDYUID,0))
"RTN","MAGDLBAA",70,0)
 Q:'ORIG
"RTN","MAGDLBAA",71,0)
 I ORIG'=IEN D
"RTN","MAGDLBAA",72,0)
 . I '$D(^MAGD(2006.575,ORIG,"RLATE",0)) D
"RTN","MAGDLBAA",73,0)
 . . S ^MAGD(2006.575,ORIG,"RLATE",0)="^2006.57526PA^^"
"RTN","MAGDLBAA",74,0)
 . S NIEN=$P(^MAGD(2006.575,ORIG,"RLATE",0),"^",3),NIEN=NIEN+1
"RTN","MAGDLBAA",75,0)
 . S $P(^MAGD(2006.575,ORIG,"RLATE",0),"^",3)=NIEN ; #next ien entry
"RTN","MAGDLBAA",76,0)
 . S $P(^MAGD(2006.575,ORIG,"RLATE",0),"^",4)=$P(^MAGD(2006.575,ORIG,"RLATE",0),"^",4)+1 ; #record for multiple field
"RTN","MAGDLBAA",77,0)
 . S ^MAGD(2006.575,ORIG,"RLATE",NIEN,0)=IEN
"RTN","MAGDLBAA",78,0)
 . S ^MAGD(2006.575,ORIG,"RLATE","B",IEN,NIEN)=""
"RTN","MAGDLBAA",79,0)
 . Q
"RTN","MAGDLBAA",80,0)
 Q
"RTN","MAGDLBAA",81,0)
 ;
"RTN","MAGDLBAA",82,0)
EXIST(RESULT,PATH,MACHINE,SITE) ; if it exist don't add it.
"RTN","MAGDLBAA",83,0)
 N IEN,NODE1
"RTN","MAGDLBAA",84,0)
 S RESULT=0
"RTN","MAGDLBAA",85,0)
 I $D(^MAGD(2006.575,"B",PATH)) D
"RTN","MAGDLBAA",86,0)
 . S IEN=$O(^MAGD(2006.575,"B",PATH,"")) I 'IEN S RESULT=0 Q
"RTN","MAGDLBAA",87,0)
 . I '$D(^MAGD(2006.575,+IEN)) S RESULT=0 Q
"RTN","MAGDLBAA",88,0)
 . S NODE1=$G(^MAGD(2006.575,IEN,1))
"RTN","MAGDLBAA",89,0)
 . I $P(NODE1,"^",4)'=MACHINE S RESULT=0 Q
"RTN","MAGDLBAA",90,0)
 . I $P(NODE1,"^",5)'=SITE S RESULT=0 Q
"RTN","MAGDLBAA",91,0)
 . S RESULT=IEN
"RTN","MAGDLBAA",92,0)
 . Q
"RTN","MAGDLBAA",93,0)
 Q RESULT
"RTN","MAGDLBAA",94,0)
REMOAFX(IEN,MACHINE,SITE,STUDY) ; Remove AFX cross reference.
"RTN","MAGDLBAA",95,0)
 N PENTRY
"RTN","MAGDLBAA",96,0)
 ;IEN is the result of the call to line tag EXIST.
"RTN","MAGDLBAA",97,0)
 ; The AFX cross reference governs what needs processing.
"RTN","MAGDLBAA",98,0)
 I $D(^MAGD(2006.575,"AFX",SITE,MACHINE,IEN)) D  Q
"RTN","MAGDLBAA",99,0)
 . S $P(^MAGD(2006.575,IEN,"FIXD"),"^")=0
"RTN","MAGDLBAA",100,0)
 . K ^MAGD(2006.575,"AFX",SITE,MACHINE,IEN)
"RTN","MAGDLBAA",101,0)
 . Q
"RTN","MAGDLBAA",102,0)
 ;may be a child entry check the 'F' cross reference to find the parent.
"RTN","MAGDLBAA",103,0)
 S PENTRY=$O(^MAGD(2006.575,"F",SITE,STUDY,0))
"RTN","MAGDLBAA",104,0)
 Q:'$D(^MAGD(2006.575,+PENTRY,0))
"RTN","MAGDLBAA",105,0)
 ;is it a child entry check the multiple 'b' cross reference
"RTN","MAGDLBAA",106,0)
 I $D(^MAGD(2006.575,PENTRY,"RELATE",0)),$D(^MAGD(2006.575,PENTRY,"B",IEN)) D
"RTN","MAGDLBAA",107,0)
 . I $D(^MAGD(2006.575,"AFX",SITE,MACHINE,PENTRY)) D
"RTN","MAGDLBAA",108,0)
 . . K ^MAGD(2006.575,"AFX",SITE,MACHINE,PENTRY)
"RTN","MAGDLBAA",109,0)
 . . S $P(^MAGD(2006.575,PENTRY,"FIXD"),"^")=0
"RTN","MAGDLBAA",110,0)
 . . Q
"RTN","MAGDLBAA",111,0)
 Q
"RTN","MAGDRPC9")
0^9^B56624389
"RTN","MAGDRPC9",1,0)
MAGDRPC9 ;WOIFO/EdM - Imaging RPCs ; 05 Sep 2008 12:55 PM
"RTN","MAGDRPC9",2,0)
 ;;3.0;IMAGING;**50,54,53**;Mar 19, 2002;Build 1719;Apr 28, 2010
"RTN","MAGDRPC9",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDRPC9",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC9",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRPC9",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRPC9",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRPC9",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRPC9",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRPC9",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRPC9",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRPC9",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRPC9",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRPC9",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRPC9",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRPC9",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC9",17,0)
 ;;
"RTN","MAGDRPC9",18,0)
 Q
"RTN","MAGDRPC9",19,0)
 ;
"RTN","MAGDRPC9",20,0)
UIDROOT(OUT) ; RPC = MAG DICOM GET UID ROOT
"RTN","MAGDRPC9",21,0)
 S OUT=$G(^MAGD(2006.15,1,"UID ROOT"))
"RTN","MAGDRPC9",22,0)
 Q
"RTN","MAGDRPC9",23,0)
 ;
"RTN","MAGDRPC9",24,0)
NEWUID(OUT,OLD,NEW,IMAGE) ; RPC = MAG NEW SOP INSTANCE UID
"RTN","MAGDRPC9",25,0)
 N D0,L,X
"RTN","MAGDRPC9",26,0)
 S IMAGE=+$G(IMAGE),OLD=$G(OLD)
"RTN","MAGDRPC9",27,0)
 S:$G(NEW)="" NEW=OLD
"RTN","MAGDRPC9",28,0)
 S D0=0 S:OLD'="" D0=$O(^MAG(2005,"P",OLD,""))
"RTN","MAGDRPC9",29,0)
 I IMAGE,D0,IMAGE'=D0 S OUT="-1,UID cannot belong to multiple images ("_IMAGE_"/"_D0_")" Q
"RTN","MAGDRPC9",30,0)
 I IMAGE,'D0 S D0=IMAGE
"RTN","MAGDRPC9",31,0)
 I 'D0 S OUT="-2,Cannot find image with UID "_OLD Q
"RTN","MAGDRPC9",32,0)
 S OUT=$P($G(^MAG(2005,D0,"SOP")),"^",2) Q:OUT'=""
"RTN","MAGDRPC9",33,0)
 S L=$L(NEW,".")-1,X=$P(NEW,".",L+1),L=$P(NEW,".",1,L)_"."
"RTN","MAGDRPC9",34,0)
 L +^MAG(2005,"P"):1E9 ; Background process MUST wait
"RTN","MAGDRPC9",35,0)
 S OUT="" F  D  Q:OUT'=""
"RTN","MAGDRPC9",36,0)
 . S OUT=L_X
"RTN","MAGDRPC9",37,0)
 . I $L(OUT)>64 S OUT="-3,Cannot use "_NEW_" to create valid UID" Q
"RTN","MAGDRPC9",38,0)
 . I $D(^MAG(2005,"P",OUT)) S OUT="",X=X+1 Q
"RTN","MAGDRPC9",39,0)
 . S $P(^MAG(2005,D0,"SOP"),"^",2)=OUT
"RTN","MAGDRPC9",40,0)
 . S ^MAG(2005,"P",OUT,D0)=1
"RTN","MAGDRPC9",41,0)
 . Q
"RTN","MAGDRPC9",42,0)
 L -^MAG(2005,"P")
"RTN","MAGDRPC9",43,0)
 Q
"RTN","MAGDRPC9",44,0)
 ;
"RTN","MAGDRPC9",45,0)
QRNEWUID(IMAGE) ; Get updated UID for Query/Retrieve
"RTN","MAGDRPC9",46,0)
 N DATE,DH,FAIL,I,OLD,OUT,NEW,LASTUID,NEXTUID,TIME,X,Y
"RTN","MAGDRPC9",47,0)
 S IMAGE=+$G(IMAGE)
"RTN","MAGDRPC9",48,0)
 S NEW=$P($G(^MAG(2005,IMAGE,"SOP")),"^",2)
"RTN","MAGDRPC9",49,0)
 Q:NEW'="" NEW  ; There already is a new UID
"RTN","MAGDRPC9",50,0)
 ; Generate the next UID using date/time and counter
"RTN","MAGDRPC9",51,0)
 L +^MAGDICOM(2006.563,1,"MACHINE ID"):1E9 ; Background process must wait
"RTN","MAGDRPC9",52,0)
 S LASTUID=$G(^MAGDICOM(2006.563,1,"LAST UID"))
"RTN","MAGDRPC9",53,0)
 ; Can't use D NOW^XLFDT to set DH because it is incorrect at midnight
"RTN","MAGDRPC9",54,0)
 S DH=$H,X=$$HTFM^XLFDT(DH,1),DATE=X+17000000
"RTN","MAGDRPC9",55,0)
 S X=$P(DH,",",2) D
"RTN","MAGDRPC9",56,0)
 . N H,M,S
"RTN","MAGDRPC9",57,0)
 . S H=X\3600,M=X\60#60,S=X#60
"RTN","MAGDRPC9",58,0)
 . S TIME=H*100+M*100+S
"RTN","MAGDRPC9",59,0)
 . Q
"RTN","MAGDRPC9",60,0)
 S NEXTUID=$G(^MAGD(2006.15,1,"UID ROOT"))
"RTN","MAGDRPC9",61,0)
 I NEXTUID="" S $EC=",13:No UID Root defined - Run INIT^MAGDRUID," ; Fatal Error
"RTN","MAGDRPC9",62,0)
 ; UID type = 7, Machine ID = 0
"RTN","MAGDRPC9",63,0)
 S NEXTUID=NEXTUID_".1.7."_(+$G(DUZ(2)))_".0."_DATE_"."_TIME_".0"
"RTN","MAGDRPC9",64,0)
 ; Remove leading 0s from UID components
"RTN","MAGDRPC9",65,0)
 F I=1:1:$L(NEXTUID,".") S $P(NEXTUID,".",I)=+$P(NEXTUID,".",I)
"RTN","MAGDRPC9",66,0)
 I $P(NEXTUID,".",1,10)=$P(LASTUID,".",1,10) D
"RTN","MAGDRPC9",67,0)
 . S NEXTUID=LASTUID
"RTN","MAGDRPC9",68,0)
 . S $P(NEXTUID,".",11)=$P(NEXTUID,".",11)+1
"RTN","MAGDRPC9",69,0)
 . Q
"RTN","MAGDRPC9",70,0)
 S ^MAGDICOM(2006.563,1,"LAST UID")=NEXTUID
"RTN","MAGDRPC9",71,0)
 L -^MAGDICOM(2006.563,1,"MACHINE ID")
"RTN","MAGDRPC9",72,0)
 S OLD=$P($G(^MAG(2005,IMAGE,"PACS")),"^",1)
"RTN","MAGDRPC9",73,0)
 D NEWUID(.OUT,OLD,NEXTUID,IMAGE) ; Store the new UID with the image
"RTN","MAGDRPC9",74,0)
 Q OUT
"RTN","MAGDRPC9",75,0)
 ;
"RTN","MAGDRPC9",76,0)
NEXT(OUT,SEED,DIR) ; RPC = MAG RAD GET NEXT RPT BY DATE
"RTN","MAGDRPC9",77,0)
 N D2,DFN,EXAMDATE,NAME
"RTN","MAGDRPC9",78,0)
 ;
"RTN","MAGDRPC9",79,0)
 ; ^RADPT(DFN,"DT",D1,"P",D2,0) = Data, $P(17) = pointer to report
"RTN","MAGDRPC9",80,0)
 ; ^RADPT("AR",9999999.9999-D1,DFN,D1)="" ; IA # 65
"RTN","MAGDRPC9",81,0)
 ;
"RTN","MAGDRPC9",82,0)
 ; OUT = report_pointer ^ ExamDate ^ Patient ^ D2
"RTN","MAGDRPC9",83,0)
 ;
"RTN","MAGDRPC9",84,0)
 S SEED=$G(SEED),DIR=$S($G(DIR)<0:-1,1:1) ; default is ascending order
"RTN","MAGDRPC9",85,0)
 S EXAMDATE=$P(SEED,"^",1),DFN=$P(SEED,"^",2),D2=$P(SEED,"^",3)
"RTN","MAGDRPC9",86,0)
 S OUT=0 F  D  Q:OUT
"RTN","MAGDRPC9",87,0)
 . I EXAMDATE="" S EXAMDATE=$O(^RADPT("AR",""),DIR),DFN="" ; IA # 65
"RTN","MAGDRPC9",88,0)
 . I EXAMDATE="" S OUT=-1 Q
"RTN","MAGDRPC9",89,0)
 . I DFN="" S DFN=$O(^RADPT("AR",EXAMDATE,""),DIR) ; IA # 65
"RTN","MAGDRPC9",90,0)
 . I DFN="" S EXAMDATE=$O(^RADPT("AR",EXAMDATE),DIR),D2="" Q  ; IA # 65
"RTN","MAGDRPC9",91,0)
 . S:'D2 D2=$S(DIR>0:0,1:" ")
"RTN","MAGDRPC9",92,0)
 . S D2=$O(^RADPT(DFN,"DT",9999999.9999-EXAMDATE,"P",D2),DIR) ; IA # 1172
"RTN","MAGDRPC9",93,0)
 . I 'D2 D  Q
"RTN","MAGDRPC9",94,0)
 . . S DFN=$O(^RADPT("AR",EXAMDATE,DFN),DIR),D2="" ; IA # 65
"RTN","MAGDRPC9",95,0)
 . . I 'DFN D
"RTN","MAGDRPC9",96,0)
 . . . S EXAMDATE=$O(^RADPT("AR",EXAMDATE),DIR),DFN="" ; IA # 65
"RTN","MAGDRPC9",97,0)
 . . . I EXAMDATE="" S OUT=-1
"RTN","MAGDRPC9",98,0)
 . . . Q
"RTN","MAGDRPC9",99,0)
 . . Q
"RTN","MAGDRPC9",100,0)
 . S OUT=$P($G(^RADPT(DFN,"DT",9999999.9999-EXAMDATE,"P",D2,0)),"^",17) ; IA # 1172
"RTN","MAGDRPC9",101,0)
 . S:OUT OUT=OUT_"^"_EXAMDATE_"^"_DFN_"^"_D2
"RTN","MAGDRPC9",102,0)
 . Q
"RTN","MAGDRPC9",103,0)
 Q
"RTN","MAGDRPC9",104,0)
 ;
"RTN","MAGDRPC9",105,0)
NXTPTRPT(OUT,DFN,RARPT1,DIR) ; RPC = MAG RAD GET NEXT RPT BY PT
"RTN","MAGDRPC9",106,0)
 S DFN=$G(DFN)
"RTN","MAGDRPC9",107,0)
 I 'DFN S OUT="-1,Patient DFN not passed" Q
"RTN","MAGDRPC9",108,0)
 I '$D(^RARPT("C",DFN)) S OUT="-2,Patient does not have any radiology reports" Q  ; IA # 2442
"RTN","MAGDRPC9",109,0)
 S RARPT1=$G(RARPT1),DIR=$S($G(DIR)<0:-1,1:1) ; default is ascending order
"RTN","MAGDRPC9",110,0)
 S OUT=$O(^RARPT("C",DFN,RARPT1),DIR) ; IA # 2442
"RTN","MAGDRPC9",111,0)
 Q
"RTN","MAGDRPC9",112,0)
 ;
"RTN","MAGDRPC9",113,0)
GETICN(OUT,DFN) ; RPC = MAG DICOM GET ICN
"RTN","MAGDRPC9",114,0)
 S OUT=$$GETICN^MPIF001(DFN)
"RTN","MAGDRPC9",115,0)
 Q
"RTN","MAGDRPC9",116,0)
 ;
"RTN","MAGDRPC9",117,0)
CLEAN ; Overflow from MAGDRPC4
"RTN","MAGDRPC9",118,0)
 N STUID
"RTN","MAGDRPC9",119,0)
 S S0=$P(SENT(I),"^",1),S1=$P(SENT(I),"^",2)
"RTN","MAGDRPC9",120,0)
 Q:'$D(^MAGDOUTP(2006.574,S0,1,S1))
"RTN","MAGDRPC9",121,0)
 L +^MAGDOUTP(2006.574,S0,1,0):1E9 ; Background process MUST wait
"RTN","MAGDRPC9",122,0)
 S X=$G(^MAGDOUTP(2006.574,S0,0)),LOC=$P(X,"^",4),PRI=+$P(X,"^",5)
"RTN","MAGDRPC9",123,0)
 S STS=$P($G(^MAGDOUTP(2006.574,S0,1,S1,0)),"^",2)
"RTN","MAGDRPC9",124,0)
 K ^MAGDOUTP(2006.574,S0,1,S1)
"RTN","MAGDRPC9",125,0)
 I LOC'="",STS'="" K ^MAGDOUTP(2006.574,"STS",LOC,PRI,STS,S0,S1)
"RTN","MAGDRPC9",126,0)
 S X=$G(^MAGDOUTP(2006.574,S0,1,0))
"RTN","MAGDRPC9",127,0)
 S $P(X,"^",4)=$P(X,"^",4)-1
"RTN","MAGDRPC9",128,0)
 S ^MAGDOUTP(2006.574,S0,1,0)=X
"RTN","MAGDRPC9",129,0)
 L -^MAGDOUTP(2006.574,S0,1,0)
"RTN","MAGDRPC9",130,0)
 Q:$O(^MAGDOUTP(2006.574,S0,1,0))
"RTN","MAGDRPC9",131,0)
 L +^MAGDOUTP(2006.574,0):1E9 ; Background process MUST wait
"RTN","MAGDRPC9",132,0)
 S STUID=$G(^MAGDOUTP(2006.574,S0,2))
"RTN","MAGDRPC9",133,0)
 K ^MAGDOUTP(2006.574,S0)
"RTN","MAGDRPC9",134,0)
 K:STUID'="" ^MAGDOUTP(2006.574,"STUDY",STUID)
"RTN","MAGDRPC9",135,0)
 S X=$G(^MAGDOUTP(2006.574,0))
"RTN","MAGDRPC9",136,0)
 S $P(X,"^",4)=$P(X,"^",4)-1
"RTN","MAGDRPC9",137,0)
 S ^MAGDOUTP(2006.574,0)=X
"RTN","MAGDRPC9",138,0)
 L -^MAGDOUTP(2006.574,0)
"RTN","MAGDRPC9",139,0)
 Q
"RTN","MAGDRPC9",140,0)
 ;
"RTN","MAGDRPC9",141,0)
IENLOOK ; Overflow from MAGDRPC4
"RTN","MAGDRPC9",142,0)
 ; lookup image by the IEN
"RTN","MAGDRPC9",143,0)
 N ACNUMB,D0,DFN,GROUPIEN,MODIFIER,P,PROCNAME,STUDYDAT,X,Y
"RTN","MAGDRPC9",144,0)
 S NUMBER=+$P(NUMBER,"`",2)
"RTN","MAGDRPC9",145,0)
 ; patient safety checks
"RTN","MAGDRPC9",146,0)
 D CHK^MAGGSQI(.X,NUMBER) I +$G(X(0))'=1 D  Q
"RTN","MAGDRPC9",147,0)
 . S OUT(1)="-9,"_$P(X(0),"^",2,999)
"RTN","MAGDRPC9",148,0)
 . Q
"RTN","MAGDRPC9",149,0)
 S GROUPIEN=$P($G(^MAG(2005,NUMBER,0)),"^",10)
"RTN","MAGDRPC9",150,0)
 I GROUPIEN D CHK^MAGGSQI(.X,GROUPIEN) I +$G(X(0))'=1 D  Q
"RTN","MAGDRPC9",151,0)
 . S OUT(1)="-10,Group #"_GROUPIEN_": "_$P(X(0),"^",2,999)
"RTN","MAGDRPC9",152,0)
 . Q
"RTN","MAGDRPC9",153,0)
 ;
"RTN","MAGDRPC9",154,0)
 S X=$G(^MAG(2005,NUMBER,2)),P=$P(X,"^",6),D0=$P(X,"^",7)
"RTN","MAGDRPC9",155,0)
 I 'P!'D0 D  ; get parent from group
"RTN","MAGDRPC9",156,0)
 . S:GROUPIEN X=$G(^MAG(2005,GROUPIEN,2)),P=$P(X,"^",6),D0=$P(X,"^",7)
"RTN","MAGDRPC9",157,0)
 . Q
"RTN","MAGDRPC9",158,0)
 ;
"RTN","MAGDRPC9",159,0)
 S OUT(2)=P_"^"_D0_"^"_NUMBER_"^" ; result w/o Accession Number
"RTN","MAGDRPC9",160,0)
 I 'P!'D0 S OUT(1)="-6,Warning - Parent file entry is not present - no Accession Number."
"RTN","MAGDRPC9",161,0)
 E  I P=74 D
"RTN","MAGDRPC9",162,0)
 . N DATETIME,I,INFO,PROC,RADPT0,RADPT1,RADPT2,RADPT3,RARPT0
"RTN","MAGDRPC9",163,0)
 . S RARPT0=$G(^RARPT(D0,0)) ; IA # 1171
"RTN","MAGDRPC9",164,0)
 . I $T(ACCRPT^RAAPI)'="" D  ; requires RA*5.0*47
"RTN","MAGDRPC9",165,0)
 . . S X=$$ACCRPT^RAAPI(D0,.INFO)
"RTN","MAGDRPC9",166,0)
 . . I X<0 S OUT(1)="-11,Radiology Problem: "_X Q
"RTN","MAGDRPC9",167,0)
 . . S ACNUMB=INFO(1)
"RTN","MAGDRPC9",168,0)
 . . Q
"RTN","MAGDRPC9",169,0)
 . E  S ACNUMB=$P(RARPT0,"^",1)
"RTN","MAGDRPC9",170,0)
 . S RADPT1=$P(RARPT0,"^",2),DATETIME=$P(RARPT0,"^",3)
"RTN","MAGDRPC9",171,0)
 . S RADPT2=9999999.9999-DATETIME,RADPT3=1
"RTN","MAGDRPC9",172,0)
 . S RADPT0=$G(^RADPT(RADPT1,"DT",RADPT2,"P",RADPT3,0))
"RTN","MAGDRPC9",173,0)
 . S PROCNAME=$$GET1^DIQ(71,$P(RADPT0,"^",2),.01)
"RTN","MAGDRPC9",174,0)
 . S STUDYDAT=17000000+(DATETIME\1)
"RTN","MAGDRPC9",175,0)
 . S MODIFIER=""
"RTN","MAGDRPC9",176,0)
 . S I=0 F  S I=$O(^RADPT(RADPT1,"DT",RADPT2,"P",RADPT3,"M",I)) Q:'I  D
"RTN","MAGDRPC9",177,0)
 . . S X=^RADPT(RADPT1,"DT",RADPT2,"P",RADPT3,"M",I,0)
"RTN","MAGDRPC9",178,0)
 . . S:I>1 MODIFIER=MODIFIER_", " S MODIFIER=MODIFIER_$$GET1^DIQ(71.2,X,.01)
"RTN","MAGDRPC9",179,0)
 . . Q
"RTN","MAGDRPC9",180,0)
 . S X=P_"^"_D0_"^"_NUMBER_"^"_ACNUMB_"^"_STUDYDAT_"^"_PROCNAME_"^"_MODIFIER
"RTN","MAGDRPC9",181,0)
 . S OUT(1)=1,OUT(2)=X
"RTN","MAGDRPC9",182,0)
 . Q
"RTN","MAGDRPC9",183,0)
 E  I P=8925 D
"RTN","MAGDRPC9",184,0)
 . N GMRCIEN
"RTN","MAGDRPC9",185,0)
 . ; get pointer from TIU to consult request
"RTN","MAGDRPC9",186,0)
 . S X=$$GET1^DIQ(8925,D0,1405,"I") ; IA ???
"RTN","MAGDRPC9",187,0)
 . I $P(X,";",2)="GMR(123," D
"RTN","MAGDRPC9",188,0)
 . . S GMRCIEN=$P(X,";"),ACNUMB="GMRC-"_GMRCIEN
"RTN","MAGDRPC9",189,0)
 . . S STUDYDAT=17000000+($$GET1^DIQ(123,GMRCIEN,.01,"I")\1)
"RTN","MAGDRPC9",190,0)
 . . S PROCNAME=$$GET1^DIQ(123,GMRCIEN,1) ; TO SERVICE
"RTN","MAGDRPC9",191,0)
 . . S MODIFIER=$$GET1^DIQ(123,GMRCIEN,4) ; PROCEDURE
"RTN","MAGDRPC9",192,0)
 . . S X=P_"^"_D0_"^"_NUMBER_"^"_ACNUMB_"^"_STUDYDAT_"^"_PROCNAME_"^"_MODIFIER
"RTN","MAGDRPC9",193,0)
 . . S OUT(1)=1,OUT(2)=X
"RTN","MAGDRPC9",194,0)
 . . Q
"RTN","MAGDRPC9",195,0)
 . E  S OUT(1)="-8,Problem with parent file "_P_", internal entry number "_D0_" - no Accession Number."
"RTN","MAGDRPC9",196,0)
 . Q
"RTN","MAGDRPC9",197,0)
 E  S OUT(1)="-7,Parent file "_P_" not yet supported - no Accession Number."
"RTN","MAGDRPC9",198,0)
 Q
"RTN","MAGDRPCA")
0^10^B90688059
"RTN","MAGDRPCA",1,0)
MAGDRPCA ;WOIFO/PMK/MLS/SG - Imaging RPCs for Importer ; 02 Nov 2009 8:47 AM
"RTN","MAGDRPCA",2,0)
 ;;3.0;IMAGING;**53**;Mar 19, 2002;Build 1719;Apr 28, 2010
"RTN","MAGDRPCA",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDRPCA",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPCA",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRPCA",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRPCA",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRPCA",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRPCA",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRPCA",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRPCA",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRPCA",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRPCA",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRPCA",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRPCA",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRPCA",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPCA",17,0)
 ;;
"RTN","MAGDRPCA",18,0)
 Q
"RTN","MAGDRPCA",19,0)
 ;
"RTN","MAGDRPCA",20,0)
CHECKUID(OUT,UIDLIST,LEVEL) ; RPC = MAG DICOM IMPORTER CHECK UIDS
"RTN","MAGDRPCA",21,0)
 N COUNT,DUPCOUNT,DUPUID,ERROR,I,MAG0,MAGIEN,OBJECT
"RTN","MAGDRPCA",22,0)
 I '$D(UIDLIST) S OUT(1)="-1,A list of UIDs must be supplied." Q
"RTN","MAGDRPCA",23,0)
 I '$D(LEVEL) S OUT(1)="-2,Study or SOP Instance level must be specified." Q
"RTN","MAGDRPCA",24,0)
 I LEVEL'="STUDY",LEVEL'="SOP" D  Q
"RTN","MAGDRPCA",25,0)
 . S OUT(1)="-3,Level must be either ""STUDY"" or ""SOP -- """
"RTN","MAGDRPCA",26,0)
 . S OUT(1)=OUT(1)_"the value """_LEVEL_""" was specified."
"RTN","MAGDRPCA",27,0)
 . Q
"RTN","MAGDRPCA",28,0)
 S COUNT=$G(UIDLIST(1)),ERROR=0
"RTN","MAGDRPCA",29,0)
 I COUNT'>0 S OUT(1)="-4,Count of UIDs in list must be greater than zero." Q
"RTN","MAGDRPCA",30,0)
 F I=2:1:COUNT+1 S UID=UIDLIST(I) D
"RTN","MAGDRPCA",31,0)
 . S MAGIEN=$O(^MAG(2005,"P",UID,""))
"RTN","MAGDRPCA",32,0)
 . I MAGIEN D
"RTN","MAGDRPCA",33,0)
 . . S MAG0=$G(^MAG(2005,MAGIEN,0)),OBJECT=$P(MAG0,"^",6),DFN=$P(MAG0,"^",7)
"RTN","MAGDRPCA",34,0)
 . . I LEVEL="STUDY" D  ; Study Instance UID
"RTN","MAGDRPCA",35,0)
 . . . I OBJECT'=11 D  Q
"RTN","MAGDRPCA",36,0)
 . . . . S OUT(I)="-5,Study Instance UID not pointing to an XRAY Group -- "
"RTN","MAGDRPCA",37,0)
 . . . . S OUT(I)=OUT(I)_"MAGIEN = "_MAGIEN,ERROR=ERROR+1
"RTN","MAGDRPCA",38,0)
 . . . . Q
"RTN","MAGDRPCA",39,0)
 . . . S OUT(I)=$$LOOKUP1(MAGIEN)_"^"_$$DUPUID(LEVEL,UID)
"RTN","MAGDRPCA",40,0)
 . . . Q
"RTN","MAGDRPCA",41,0)
 . . E  D  ; SOP Instance UID
"RTN","MAGDRPCA",42,0)
 . . . I OBJECT'=3,OBJECT'=100 D  Q
"RTN","MAGDRPCA",43,0)
 . . . . S OUT(I)="-6,SOP Instance UID not pointing to an XRAY or a DICOM object -- "
"RTN","MAGDRPCA",44,0)
 . . . . S OUT(I)=OUT(I)_"MAGIEN = "_MAGIEN,ERROR=ERROR+1
"RTN","MAGDRPCA",45,0)
 . . . . Q
"RTN","MAGDRPCA",46,0)
 . . . S OUT(I)=$$LOOKUP1(MAGIEN)_"^"_$$DUPUID(LEVEL,UID)
"RTN","MAGDRPCA",47,0)
 . . . Q
"RTN","MAGDRPCA",48,0)
 . . Q
"RTN","MAGDRPCA",49,0)
 . E  S OUT(I)=""
"RTN","MAGDRPCA",50,0)
 . Q
"RTN","MAGDRPCA",51,0)
 I ERROR>1 S OUT(1)="-100,There were "_ERROR_" database inconsistency errors detected.  Look at returned data."
"RTN","MAGDRPCA",52,0)
 E  I ERROR=1 S OUT(1)="-100,A database inconsistency error was detected. Look at returned data."
"RTN","MAGDRPCA",53,0)
 E  S OUT(1)=COUNT
"RTN","MAGDRPCA",54,0)
 Q
"RTN","MAGDRPCA",55,0)
 ;
"RTN","MAGDRPCA",56,0)
DUPUID(LEVEL,UID) ; return a list of ^MAG(2005) entries with dup uids
"RTN","MAGDRPCA",57,0)
 N COUNT,DFN,DUPUID,I,MAG0,MAG2,MAGIEN,PARENT,RETURN,XREF,XREFLIST
"RTN","MAGDRPCA",58,0)
 S MAGIEN=""
"RTN","MAGDRPCA",59,0)
 F  S MAGIEN=$O(^MAG(2005,"P",UID,MAGIEN)) Q:MAGIEN=""  D
"RTN","MAGDRPCA",60,0)
 . S MAG0=$G(^MAG(2005,MAGIEN,0)),DFN=$P(MAG0,"^",7)
"RTN","MAGDRPCA",61,0)
 . S MAG2=$G(^MAG(2005,MAGIEN,2))
"RTN","MAGDRPCA",62,0)
 . S PARENT="" F I=6,7,8,10 S PARENT=PARENT_"^"_$P(MAG2,"^",I)
"RTN","MAGDRPCA",63,0)
 . S DUPUID(MAGIEN)=DFN_PARENT
"RTN","MAGDRPCA",64,0)
 . S XREFLIST(DFN_PARENT,MAGIEN)=""
"RTN","MAGDRPCA",65,0)
 . Q
"RTN","MAGDRPCA",66,0)
 . ; remove duplicate Study UIDs for different groups for the same study
"RTN","MAGDRPCA",67,0)
 I LEVEL="STUDY" D
"RTN","MAGDRPCA",68,0)
 . S COUNT=0,XREF=""
"RTN","MAGDRPCA",69,0)
 . F  S XREF=$O(XREFLIST(XREF)) Q:XREF=""  S COUNT=COUNT+1
"RTN","MAGDRPCA",70,0)
 . I COUNT=1 K DUPUID
"RTN","MAGDRPCA",71,0)
 . Q
"RTN","MAGDRPCA",72,0)
 S COUNT=0,(MAGIEN,RETURN)=""
"RTN","MAGDRPCA",73,0)
 F  S MAGIEN=$O(DUPUID(MAGIEN)) Q:MAGIEN=""  D
"RTN","MAGDRPCA",74,0)
 . S RETURN=RETURN_"^"_MAGIEN,COUNT=COUNT+1
"RTN","MAGDRPCA",75,0)
 . Q
"RTN","MAGDRPCA",76,0)
 Q COUNT_RETURN
"RTN","MAGDRPCA",77,0)
 ;
"RTN","MAGDRPCA",78,0)
LOOKUP(OUT,MAGIEN) ; RPC = MAG DICOM IMPORTER LOOKUP
"RTN","MAGDRPCA",79,0)
 S OUT=$$LOOKUP1(MAGIEN)
"RTN","MAGDRPCA",80,0)
 Q
"RTN","MAGDRPCA",81,0)
 ;
"RTN","MAGDRPCA",82,0)
LOOKUP1(MAGIEN) ; patient and accession number lookup
"RTN","MAGDRPCA",83,0)
 N DFN,I,MAG0,MAG2,NUMBER,OUT,TMP,VADM,X
"RTN","MAGDRPCA",84,0)
 S MAG0=$G(^MAG(2005,MAGIEN,0)),MAG2=$G(^(2))
"RTN","MAGDRPCA",85,0)
 S DFN=+$P(MAG0,"^",7)
"RTN","MAGDRPCA",86,0)
 D  ; Protect variables that are referenced by the DEM^VADPT
"RTN","MAGDRPCA",87,0)
 . N A,I,J,K,K1,NC,NF,NQ,T,VAHOW,VAPTYP,VAROOT,X
"RTN","MAGDRPCA",88,0)
 . D DEM^VADPT
"RTN","MAGDRPCA",89,0)
 . Q
"RTN","MAGDRPCA",90,0)
 S X="^"_DFN ; piece 1 is for an error message
"RTN","MAGDRPCA",91,0)
 S X=X_"^"_VADM(1) ; patient name
"RTN","MAGDRPCA",92,0)
 S X=X_"^"_$P(VADM(2),"^",2) ; patient id (ssn)
"RTN","MAGDRPCA",93,0)
 S TMP=$S(VADM(3)>0:17000000+VADM(3),1:"-1,Invalid date of birth")
"RTN","MAGDRPCA",94,0)
 S X=X_"^"_TMP ; Patient DOB
"RTN","MAGDRPCA",95,0)
 S X=X_"^"_$P(VADM(5),"^",1) ; patient sex
"RTN","MAGDRPCA",96,0)
 ; $$GETICN^MPIF001 can return error code and message separated
"RTN","MAGDRPCA",97,0)
 ; by "^". If this happens, the "^" is replaced by comma.
"RTN","MAGDRPCA",98,0)
 S X=X_"^"_$TR($$GETICN^MPIF001(DFN),"^",",")  ; ICN
"RTN","MAGDRPCA",99,0)
 I $P(MAG2,"^",6)=2006.5839 D  ; temporary consult association
"RTN","MAGDRPCA",100,0)
 . N ACNUMB,GMRCIEN,MODIFIER,PROCNAME,STUDYDAT
"RTN","MAGDRPCA",101,0)
 . S GMRCIEN=$P(MAG2,"^",7),ACNUMB="GMRC-"_GMRCIEN
"RTN","MAGDRPCA",102,0)
 . S TMP=$$GET1^DIQ(123,GMRCIEN,.01,"I")\1
"RTN","MAGDRPCA",103,0)
 . S STUDYDAT=$S(TMP>0:17000000+TMP,1:"-1,Invalid study date")
"RTN","MAGDRPCA",104,0)
 . S PROCNAME=$$GET1^DIQ(123,GMRCIEN,1) ; TO SERVICE
"RTN","MAGDRPCA",105,0)
 . S MODIFIER=$$GET1^DIQ(123,GMRCIEN,4) ; PROCEDURE
"RTN","MAGDRPCA",106,0)
 . S X=X_"^"_ACNUMB_"^"_STUDYDAT_"^"_PROCNAME_"^"_MODIFIER
"RTN","MAGDRPCA",107,0)
 . Q
"RTN","MAGDRPCA",108,0)
 E  D  ; regular association
"RTN","MAGDRPCA",109,0)
 . S NUMBER="`"_MAGIEN D IENLOOK^MAGDRPC9 ; lookup accession number
"RTN","MAGDRPCA",110,0)
 . I OUT(1)<0 S X=OUT(1)_" detected in IENLOOK^MAGDRPC9"
"RTN","MAGDRPCA",111,0)
 . E  S X=X_"^"_$P(OUT(2),"^",4,7) ; accession number, study date, procedure
"RTN","MAGDRPCA",112,0)
 . Q
"RTN","MAGDRPCA",113,0)
 Q X
"RTN","MAGDRPCA",114,0)
 ;
"RTN","MAGDRPCA",115,0)
 ;
"RTN","MAGDRPCA",116,0)
 ;
"RTN","MAGDRPCA",117,0)
GETDFN(OUT,ICN) ; RPC = MAG DICOM GET DFN
"RTN","MAGDRPCA",118,0)
 S OUT=$$GETDFN^MPIF001(ICN)
"RTN","MAGDRPCA",119,0)
 Q
"RTN","MAGDRPCA",120,0)
 ;
"RTN","MAGDRPCA",121,0)
 ;
"RTN","MAGDRPCA",122,0)
 ;
"RTN","MAGDRPCA",123,0)
ACNUMB(OUT,ACNUMB) ; RPC = MAG DICOM GET RAD INFO BY ACN
"RTN","MAGDRPCA",124,0)
 N RADFN,RADTI,LIST,STATUS
"RTN","MAGDRPCA",125,0)
 I $T(ACCFIND^RAAPI)'="" D  ; requires RA*5.0*47
"RTN","MAGDRPCA",126,0)
 . S STATUS=$$ACCFIND^RAAPI(ACNUMB,.LIST)
"RTN","MAGDRPCA",127,0)
 . Q
"RTN","MAGDRPCA",128,0)
 E  D  ; before RA*5.0*47
"RTN","MAGDRPCA",129,0)
 . S STATUS=$$ACCFIND(ACNUMB,.LIST)
"RTN","MAGDRPCA",130,0)
 . Q
"RTN","MAGDRPCA",131,0)
 I STATUS<0 S OUT=STATUS Q
"RTN","MAGDRPCA",132,0)
 S OUT=STATUS_"^"_LIST(1)
"RTN","MAGDRPCA",133,0)
 ; add the imaging location as 5th piece of the results
"RTN","MAGDRPCA",134,0)
 S RADFN=$P(LIST(1),"^",1),RADTI=$P(LIST(1),"^",2)
"RTN","MAGDRPCA",135,0)
 S OUT=OUT_"^"_$$GET1^DIQ(79.1,$P(^RADPT(RADFN,"DT",RADTI,0),"^",4),.01)
"RTN","MAGDRPCA",136,0)
 Q
"RTN","MAGDRPCA",137,0)
 ;
"RTN","MAGDRPCA",138,0)
ACCFIND(Y,RAA) ; borrowed from RA*5.0*47
"RTN","MAGDRPCA",139,0)
 ;
"RTN","MAGDRPCA",140,0)
 ;input : Y=the accession number in either a 'sss-mmddyy-xxxxx' or
"RTN","MAGDRPCA",141,0)
 ;          'mmddyy-xxxxx' format
"RTN","MAGDRPCA",142,0)
 ;      : RAA(n)=the array used to return the data in the following
"RTN","MAGDRPCA",143,0)
 ;               format RADFN_^_RADTI_^_RACNI
"RTN","MAGDRPCA",144,0)
 ;
"RTN","MAGDRPCA",145,0)
 ;return: n>0 successful, else n<0... 'n' is the number of array
"RTN","MAGDRPCA",146,0)
 ;        elements when successful. When unsuccessful (n<0) 'n' is
"RTN","MAGDRPCA",147,0)
 ;        a specific error dialog which is returned along with the
"RTN","MAGDRPCA",148,0)
 ;        invalid accession number.
"RTN","MAGDRPCA",149,0)
 ;
"RTN","MAGDRPCA",150,0)
 ;        Examples:
"RTN","MAGDRPCA",151,0)
 ;        -1^"invalid site accession number format"^accession #
"RTN","MAGDRPCA",152,0)
 ;        -2^"invalid accession number format"^accession #
"RTN","MAGDRPCA",153,0)
 ;        -3^"no data associated with this accession number"^accession #
"RTN","MAGDRPCA",154,0)
 ;
"RTN","MAGDRPCA",155,0)
 I $L(Y,"-")=3 Q:Y'?3N1"-"6N1"-"1.5N "-1^invalid site accession number format^"_Y
"RTN","MAGDRPCA",156,0)
 I $L(Y,"-")=2 Q:Y'?6N1"-"1.5N "-2^invalid accession number format^"_Y
"RTN","MAGDRPCA",157,0)
 N X S X=$S($L(Y,"-")=3:$NA(^RADPT("ADC1")),1:$NA(^RADPT("ADC")))
"RTN","MAGDRPCA",158,0)
 Q:$O(@X@(Y,0))'>0 "-3^no data associated with this accession number^"_Y
"RTN","MAGDRPCA",159,0)
 N RADFN,RADTI,RACNI,Z S:$D(U)#2=0 U="^"
"RTN","MAGDRPCA",160,0)
 S (RADFN,Z)=0 F  S RADFN=$O(@X@(Y,RADFN)) Q:'RADFN  D
"RTN","MAGDRPCA",161,0)
 . S RADTI=0 F  S RADTI=$O(@X@(Y,RADFN,RADTI)) Q:'RADTI  D
"RTN","MAGDRPCA",162,0)
 . . S RACNI=0 F  S RACNI=$O(@X@(Y,RADFN,RADTI,RACNI)) Q:'RACNI  D
"RTN","MAGDRPCA",163,0)
 . . . S Z=Z+1,RAA(Z)=RADFN_U_RADTI_U_RACNI
"RTN","MAGDRPCA",164,0)
 . . . Q
"RTN","MAGDRPCA",165,0)
 . . Q
"RTN","MAGDRPCA",166,0)
 . Q
"RTN","MAGDRPCA",167,0)
 Q Z ;success
"RTN","MAGDRPCA",168,0)
 ;
"RTN","MAGDRPCA",169,0)
 ;
"RTN","MAGDRPCA",170,0)
 ;
"RTN","MAGDRPCA",171,0)
DELETE(OUT,IMAGEUID,MACHID,FILEPATH) ; RPC = MAG DICOM IMPORTER DELETE
"RTN","MAGDRPCA",172,0)
 S OUT=$$DELETE^MAGDIR8R(IMAGEUID,MACHID,FILEPATH)
"RTN","MAGDRPCA",173,0)
 Q
"RTN","MAGDRPCA",174,0)
 ;
"RTN","MAGDRPCA",175,0)
 ;***** RETURNS THE LIST OF RADIOLOGY PROCEDURES
"RTN","MAGDRPCA",176,0)
 ; RPC: MAG DICOM RADIOLOGY PROCEDURES
"RTN","MAGDRPCA",177,0)
 ;
"RTN","MAGDRPCA",178,0)
 ; .ARRAY        Reference to a local variable where results
"RTN","MAGDRPCA",179,0)
 ;               are returned to.
"RTN","MAGDRPCA",180,0)
 ;
"RTN","MAGDRPCA",181,0)
 ; DIV           IEN of a record in the INSTITUTION file (#4)
"RTN","MAGDRPCA",182,0)
 ;
"RTN","MAGDRPCA",183,0)
PROC(ARRAY,DIV) ;
"RTN","MAGDRPCA",184,0)
 N IMAGTYPE      ; IEN of the imaging type (file #79.2)
"RTN","MAGDRPCA",185,0)
 N INACTDAT      ; Inactivation date of the procedure
"RTN","MAGDRPCA",186,0)
 N OMLDAT        ; Outside imaging location data (file #2006.5759)
"RTN","MAGDRPCA",187,0)
 N OMLIEN        ; IEN in OUTSIDE IMAGING LOCATION file (#2006.5759)
"RTN","MAGDRPCA",188,0)
 N RADPROC       ; Radiology procedure data (file #71)
"RTN","MAGDRPCA",189,0)
 N TODAY         ; today's date in Fileman format
"RTN","MAGDRPCA",190,0)
 ;
"RTN","MAGDRPCA",191,0)
 N BUF,ERROR,IEN,Z
"RTN","MAGDRPCA",192,0)
 K ARRAY
"RTN","MAGDRPCA",193,0)
 ;
"RTN","MAGDRPCA",194,0)
 ;--- Validate parameters
"RTN","MAGDRPCA",195,0)
 S DIV=$G(DIV)
"RTN","MAGDRPCA",196,0)
 I (DIV'>0)!(DIV'=+DIV)  D  Q
"RTN","MAGDRPCA",197,0)
 . S ARRAY(1)="-1,Invalid Institution IEN: '"_DIV_"'."
"RTN","MAGDRPCA",198,0)
 . Q
"RTN","MAGDRPCA",199,0)
 I $D(^DIC(4,DIV))<10  D  Q
"RTN","MAGDRPCA",200,0)
 . S ARRAY(1)="-2,Institution with IEN="_DIV_" does not exist."
"RTN","MAGDRPCA",201,0)
 . Q
"RTN","MAGDRPCA",202,0)
 ;
"RTN","MAGDRPCA",203,0)
 S ERROR=$$DISPLAY^MAGDAIRG(0)
"RTN","MAGDRPCA",204,0)
 I ERROR=-1 D  Q
"RTN","MAGDRPCA",205,0)
 . S ARRAY(1)="-3,""No Credit"" entries must be added to the IMAGING LOCATIONS file (#79.1)"
"RTN","MAGDRPCA",206,0)
 . S ARRAY(2)=""
"RTN","MAGDRPCA",207,0)
 . S ARRAY(3)="Use the IMPORTER MENU option CHECK OUTSIDE IMAGING LOCATION FILE"
"RTN","MAGDRPCA",208,0)
 . S ARRAY(4)="on the VistA system to correct the problem."
"RTN","MAGDRPCA",209,0)
 . Q
"RTN","MAGDRPCA",210,0)
 I ERROR=-2 D  Q
"RTN","MAGDRPCA",211,0)
 . S ARRAY(1)="-4,Entries must be added to the OUTSIDE IMAGING LOCATIONS file (#2006.5759)"
"RTN","MAGDRPCA",212,0)
 . S ARRAY(2)=""
"RTN","MAGDRPCA",213,0)
 . S ARRAY(3)="Use the IMPORTER MENU option BUILD OUTSIDE IMAGING LOCATION FILE"
"RTN","MAGDRPCA",214,0)
 . S ARRAY(4)="on the VistA system to correct the problem."
"RTN","MAGDRPCA",215,0)
 . Q
"RTN","MAGDRPCA",216,0)
 I ERROR'=0 D  Q
"RTN","MAGDRPCA",217,0)
 . S ARRAY(1)="-5,Unexpected error #"_ERROR_" returned by $$DISPLAY^MAGDAIRG(0)"
"RTN","MAGDRPCA",218,0)
 . Q
"RTN","MAGDRPCA",219,0)
 ;
"RTN","MAGDRPCA",220,0)
 S (ARRAY(1),IEN)=0,TODAY=$$DT^XLFDT()
"RTN","MAGDRPCA",221,0)
 F  S IEN=$O(^RAMIS(71,IEN))  Q:'IEN  D
"RTN","MAGDRPCA",222,0)
 . S RADPROC=^RAMIS(71,IEN,0),IMAGTYPE=+$P(RADPROC,U,12)
"RTN","MAGDRPCA",223,0)
 . ;--- Get outside imaging location associated
"RTN","MAGDRPCA",224,0)
 . ;--- with the imaging type of the procedure
"RTN","MAGDRPCA",225,0)
 . S OMLIEN=$O(^MAGD(2006.5759,"D",DIV,IMAGTYPE,""))  Q:'OMLIEN
"RTN","MAGDRPCA",226,0)
 . S OMLDAT=$G(^MAGD(2006.5759,OMLIEN,0))
"RTN","MAGDRPCA",227,0)
 . Q:$P(OMLDAT,U,4)'=DIV  ; Has to be in the same Division
"RTN","MAGDRPCA",228,0)
 . ;--- Prepare the procedure descriptor
"RTN","MAGDRPCA",229,0)
 . S BUF=$P(RADPROC,U)_U_IEN      ; Procedure Name and IEN
"RTN","MAGDRPCA",230,0)
 . S $P(BUF,U,3)=$P(RADPROC,U,6)  ; Type of Procedure
"RTN","MAGDRPCA",231,0)
 . S $P(BUF,U,4)=$P(RADPROC,U,9)  ; CPT Code (file #81)
"RTN","MAGDRPCA",232,0)
 . S $P(BUF,U,5)=IMAGTYPE         ; Type of Imaging (file #79.2)
"RTN","MAGDRPCA",233,0)
 . S INACTDAT=$P($G(^RAMIS(71,IEN,"I")),U)
"RTN","MAGDRPCA",234,0)
 . I INACTDAT,INACTDAT<TODAY Q    ; ignore inactive procedures
"RTN","MAGDRPCA",235,0)
 . S $P(BUF,U,6)=INACTDAT         ; Inactivation Date
"RTN","MAGDRPCA",236,0)
 . S $P(BUF,U,7)=$P(OMLDAT,U)     ; Imaging Location (file #79.1)
"RTN","MAGDRPCA",237,0)
 . S Z=$P(OMLDAT,U,3)
"RTN","MAGDRPCA",238,0)
 . S $P(BUF,U,8)=Z                ; Hospital Location (file #44) - IEN
"RTN","MAGDRPCA",239,0)
 . S $P(BUF,U,9)=$$GET1^DIQ(44,Z,.01) ; Hospital Location (file #44) - NAME
"RTN","MAGDRPCA",240,0)
 . ;--- Add the descriptor to the result array
"RTN","MAGDRPCA",241,0)
 . S ARRAY(1)=ARRAY(1)+1,ARRAY(ARRAY(1)+1)=BUF
"RTN","MAGDRPCA",242,0)
 . Q
"RTN","MAGDRPCA",243,0)
 Q
"RTN","MAGDRPCA",244,0)
 ;
"RTN","MAGDRPCA",245,0)
 ;***** RETURNS THE LIST OF RADIOLOGY PROCEDURE MODIFIERS
"RTN","MAGDRPCA",246,0)
 ; RPC: MAG DICOM RADIOLOGY MODIFIERS
"RTN","MAGDRPCA",247,0)
 ;
"RTN","MAGDRPCA",248,0)
 ; .ARRAY        Reference to a local variable where results
"RTN","MAGDRPCA",249,0)
 ;               are returned to.
"RTN","MAGDRPCA",250,0)
 ;
"RTN","MAGDRPCA",251,0)
MOD(ARRAY) ;
"RTN","MAGDRPCA",252,0)
 N IEN           ; IEN in the PROCEDURE MODIFIERS file (#71.2)
"RTN","MAGDRPCA",253,0)
 N IEN2          ; IEN in the TYPE OF IMAGING subfile (#71.23)
"RTN","MAGDRPCA",254,0)
 N IMAGTYPE      ; Imaging type (#79.2)
"RTN","MAGDRPCA",255,0)
 N MODIFIER      ; Radiology procedure modifier name (71.2,.01)
"RTN","MAGDRPCA",256,0)
 N PROCMOD       ; Radiology procedure modifer data
"RTN","MAGDRPCA",257,0)
 ;
"RTN","MAGDRPCA",258,0)
 K ARRAY
"RTN","MAGDRPCA",259,0)
 ;
"RTN","MAGDRPCA",260,0)
 S (ARRAY(1),IEN)=0
"RTN","MAGDRPCA",261,0)
 F  S IEN=$O(^RAMIS(71.2,IEN))  Q:'IEN  D
"RTN","MAGDRPCA",262,0)
 . S PROCMOD=^RAMIS(71.2,IEN,0),MODIFIER=$P(PROCMOD,U)
"RTN","MAGDRPCA",263,0)
 . S IEN2=0
"RTN","MAGDRPCA",264,0)
 . F  S IEN2=$O(^RAMIS(71.2,IEN,1,IEN2))  Q:'IEN2  D
"RTN","MAGDRPCA",265,0)
 . . S IMAGTYPE=+$G(^RAMIS(71.2,IEN,1,IEN2,0))  Q:'IMAGTYPE
"RTN","MAGDRPCA",266,0)
 . . S ARRAY(1)=ARRAY(1)+1
"RTN","MAGDRPCA",267,0)
 . . S ARRAY(ARRAY(1)+1)=MODIFIER_U_IEN_U_IMAGTYPE
"RTN","MAGDRPCA",268,0)
 . . Q
"RTN","MAGDRPCA",269,0)
 . Q
"RTN","MAGDRPCA",270,0)
 Q
"RTN","MAGDRPCB")
0^11^B129146302
"RTN","MAGDRPCB",1,0)
MAGDRPCB ;WOIFO/PMK/MLS/SG - Imaging RPCs for Importer ; 27 Apr 2010 3:34 PM
"RTN","MAGDRPCB",2,0)
 ;;3.0;IMAGING;**53**;Mar 19, 2002;Build 1719;Apr 28, 2010
"RTN","MAGDRPCB",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDRPCB",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPCB",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRPCB",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRPCB",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRPCB",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRPCB",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRPCB",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRPCB",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRPCB",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRPCB",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRPCB",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRPCB",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRPCB",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPCB",17,0)
 ;;
"RTN","MAGDRPCB",18,0)
 Q
"RTN","MAGDRPCB",19,0)
 ;
"RTN","MAGDRPCB",20,0)
FILM(RESULTS,FILM) ; RPC = MAG DICOM GET RAD FILM
"RTN","MAGDRPCB",21,0)
 D LOOKUP(.RESULTS,$G(FILM),78.4,"B",".01") ; ICR 5360
"RTN","MAGDRPCB",22,0)
 Q
"RTN","MAGDRPCB",23,0)
 ;
"RTN","MAGDRPCB",24,0)
DXCODE(RESULTS,DXCODE) ; RPC = MAG DICOM GET RAD DIAGNOSTIC CODE
"RTN","MAGDRPCB",25,0)
 D LOOKUP(.RESULTS,$G(DXCODE),78.3,"B",".01") ; ICR 4112
"RTN","MAGDRPCB",26,0)
 Q
"RTN","MAGDRPCB",27,0)
 ;
"RTN","MAGDRPCB",28,0)
CAMERA(RESULTS,CAMERA) ; RPC = MAG DICOM GET RAD CAMERA
"RTN","MAGDRPCB",29,0)
 D LOOKUP(.RESULTS,$G(CAMERA),78.6,"B",".01;2") ; ICR 5359
"RTN","MAGDRPCB",30,0)
 Q
"RTN","MAGDRPCB",31,0)
 ; 
"RTN","MAGDRPCB",32,0)
CPTMOD(RESULTS,CPTMOD,MAGDT) ; RPC = MAG DICOM GET RAD CPT MOD
"RTN","MAGDRPCB",33,0)
 ; CPTMOD = partial CPT modifier match
"RTN","MAGDRPCB",34,0)
 N I,SCR
"RTN","MAGDRPCB",35,0)
 S:$G(MAGDT)'>0 MAGDT=$$DT^XLFDT
"RTN","MAGDRPCB",36,0)
 S SCR="S D=$$MOD^ICPTMOD(Y,""I"",MAGDT) I D'<0,$P(D,U,7)"
"RTN","MAGDRPCB",37,0)
 D LOOKUP(.RESULTS,$G(CPTMOD),81.3,"C","",SCR) ; ICR 3026
"RTN","MAGDRPCB",38,0)
 F I=1:1:$G(RESULTS(1)) D
"RTN","MAGDRPCB",39,0)
 . S $P(RESULTS(I+1),"^",2)=$P($$MOD^ICPTMOD(RESULTS(I+1),"I"),"^",3)
"RTN","MAGDRPCB",40,0)
 . Q
"RTN","MAGDRPCB",41,0)
 Q
"RTN","MAGDRPCB",42,0)
 ;
"RTN","MAGDRPCB",43,0)
LOOKUP(RESULTS,SRCHVAL,FILE,XREF,FIELDS,SCREEN) ; search file
"RTN","MAGDRPCB",44,0)
 N CNT,I,MAGTMP,MAGMSG,MAXNR,X
"RTN","MAGDRPCB",45,0)
 S MAXNR=100  ; Maximum number of records to return
"RTN","MAGDRPCB",46,0)
 S SRCHVAL=$$UP^XLFSTR($TR(SRCHVAL,"*?"))
"RTN","MAGDRPCB",47,0)
 S SRCHVAL=$E(SRCHVAL,1,30) ; limit of 30 characters for B or C cross reference
"RTN","MAGDRPCB",48,0)
 S MAGTMP=$NA(^TMP($T(+0),$J))
"RTN","MAGDRPCB",49,0)
 K @MAGTMP,RESULTS
"RTN","MAGDRPCB",50,0)
 ;
"RTN","MAGDRPCB",51,0)
 ;--- Perform the search
"RTN","MAGDRPCB",52,0)
 D LIST^DIC(FILE,,"@;"_FIELDS,"P",MAXNR,,SRCHVAL,XREF,$G(SCREEN),,MAGTMP,"MAGMSG")
"RTN","MAGDRPCB",53,0)
 S X=$G(@MAGTMP@("DILIST",0))
"RTN","MAGDRPCB",54,0)
 I X'>0  S RESULTS(1)="-1^No records match the input."  Q
"RTN","MAGDRPCB",55,0)
 I $P(X,U,3)  D  Q
"RTN","MAGDRPCB",56,0)
 . S RESULTS(1)="-2,More than "_MAXNR_" matches; please specify"
"RTN","MAGDRPCB",57,0)
 . S RESULTS(1)=RESULTS(1)_" more characters in the name."
"RTN","MAGDRPCB",58,0)
 . Q
"RTN","MAGDRPCB",59,0)
 ;
"RTN","MAGDRPCB",60,0)
 ;--- Copy the records to the resut array
"RTN","MAGDRPCB",61,0)
 S (RESULTS(1),I)=0
"RTN","MAGDRPCB",62,0)
 F  S I=$O(@MAGTMP@("DILIST",I))  Q:'I  D
"RTN","MAGDRPCB",63,0)
 . S RESULTS(1)=RESULTS(1)+1
"RTN","MAGDRPCB",64,0)
 . S RESULTS(RESULTS(1)+1)=@MAGTMP@("DILIST",I,0)
"RTN","MAGDRPCB",65,0)
 . Q
"RTN","MAGDRPCB",66,0)
 ;
"RTN","MAGDRPCB",67,0)
 ;--- Cleanup
"RTN","MAGDRPCB",68,0)
 K @MAGTMP
"RTN","MAGDRPCB",69,0)
 Q
"RTN","MAGDRPCB",70,0)
 ;
"RTN","MAGDRPCB",71,0)
 ;***** RETURNS LIST OF USERS WITH PROVIDED RADIOLOGY CLASSIFICATION
"RTN","MAGDRPCB",72,0)
 ; RPC: MAG DICOM GET RAD PERSON
"RTN","MAGDRPCB",73,0)
 ;
"RTN","MAGDRPCB",74,0)
 ; .RESULTS      Reference to a local variable where results
"RTN","MAGDRPCB",75,0)
 ;               are returned to.
"RTN","MAGDRPCB",76,0)
 ;
"RTN","MAGDRPCB",77,0)
 ; MAGRADCLASS   Radiology classification codes (can be combined):
"RTN","MAGDRPCB",78,0)
 ;
"RTN","MAGDRPCB",79,0)
 ;                 C  Clerk    R  Resident
"RTN","MAGDRPCB",80,0)
 ;                 S  Staff    T  Technologist
"RTN","MAGDRPCB",81,0)
 ;
"RTN","MAGDRPCB",82,0)
 ; [NAME]        Partial name match.
"RTN","MAGDRPCB",83,0)
 ;
"RTN","MAGDRPCB",84,0)
RADLST(RESULTS,MAGRADCLASS,NAME) ;
"RTN","MAGDRPCB",85,0)
 N I,MAGMSG,MAGTMP,MAXNR,X
"RTN","MAGDRPCB",86,0)
 S MAXNR=100      ; Maximum number of records to return
"RTN","MAGDRPCB",87,0)
 S DT=$$DT^XLFDT  ; Make sure that the actual date is there
"RTN","MAGDRPCB",88,0)
 S MAGTMP=$NA(^TMP($T(+0),$J))
"RTN","MAGDRPCB",89,0)
 K @MAGTMP,RESULTS
"RTN","MAGDRPCB",90,0)
 ;
"RTN","MAGDRPCB",91,0)
 ;--- Validate parameters
"RTN","MAGDRPCB",92,0)
 I $G(MAGRADCLASS)=""  D  Q
"RTN","MAGDRPCB",93,0)
 . S RESULTS(1)="-1^No RAD/NUC classification provided."
"RTN","MAGDRPCB",94,0)
 . Q
"RTN","MAGDRPCB",95,0)
 S NAME=$$UP^XLFSTR($TR($G(NAME),"*?"))
"RTN","MAGDRPCB",96,0)
 S NAME=$E(NAME,1,30) ; limit of 30 characters for B cross reference
"RTN","MAGDRPCB",97,0)
 ;
"RTN","MAGDRPCB",98,0)
 ;--- Search for users
"RTN","MAGDRPCB",99,0)
 S X="I $$SCRUSR^"_$T(+0)_"(Y)"  ; Screening code
"RTN","MAGDRPCB",100,0)
 D LIST^DIC(200,,"@;.01","P",MAXNR,,NAME,"B",X,,MAGTMP,"MAGMSG") ; ICR # 10060
"RTN","MAGDRPCB",101,0)
 S X=$G(@MAGTMP@("DILIST",0))
"RTN","MAGDRPCB",102,0)
 I X'>0  S RESULTS(1)="-1^No provider matching input."  Q
"RTN","MAGDRPCB",103,0)
 I $P(X,U,3)  D  Q
"RTN","MAGDRPCB",104,0)
 . S RESULTS(1)="-2,More than "_MAXNR_" matches; please specify"
"RTN","MAGDRPCB",105,0)
 . S RESULTS(1)=RESULTS(1)_" more characters in the name."
"RTN","MAGDRPCB",106,0)
 . Q
"RTN","MAGDRPCB",107,0)
 ;
"RTN","MAGDRPCB",108,0)
 ;--- Copy the records to the result array
"RTN","MAGDRPCB",109,0)
 S (RESULTS(1),I)=0
"RTN","MAGDRPCB",110,0)
 F  S I=$O(@MAGTMP@("DILIST",I))  Q:'I  D
"RTN","MAGDRPCB",111,0)
 . S RESULTS(1)=RESULTS(1)+1
"RTN","MAGDRPCB",112,0)
 . S RESULTS(RESULTS(1)+1)=@MAGTMP@("DILIST",I,0)
"RTN","MAGDRPCB",113,0)
 . Q
"RTN","MAGDRPCB",114,0)
 ;
"RTN","MAGDRPCB",115,0)
 ;--- Cleanup
"RTN","MAGDRPCB",116,0)
 K @MAGTMP
"RTN","MAGDRPCB",117,0)
 Q
"RTN","MAGDRPCB",118,0)
 ;
"RTN","MAGDRPCB",119,0)
 ;***** SCREENING LOGIC FOR SEARCH FOR RADIOLOGY USERS
"RTN","MAGDRPCB",120,0)
 ;
"RTN","MAGDRPCB",121,0)
 ; IEN           IEN in the NEW PERSON file (#200)
"RTN","MAGDRPCB",122,0)
 ;
"RTN","MAGDRPCB",123,0)
 ; Input variables:
"RTN","MAGDRPCB",124,0)
 ;   MAGRADCLASS
"RTN","MAGDRPCB",125,0)
 ;
"RTN","MAGDRPCB",126,0)
 ; Return Values:
"RTN","MAGDRPCB",127,0)
 ;            0  Skip the record
"RTN","MAGDRPCB",128,0)
 ;            1  Get the record
"RTN","MAGDRPCB",129,0)
 ;
"RTN","MAGDRPCB",130,0)
SCRUSR(IEN) ;
"RTN","MAGDRPCB",131,0)
 N IEN1,MAGMSG,OK,TERMDT
"RTN","MAGDRPCB",132,0)
 ;--- Check the termination date
"RTN","MAGDRPCB",133,0)
 S TERMDT=$$GET1^DIQ(200,IEN_",",9.2,"I",,"MAGMSG") ; ICR # 10060
"RTN","MAGDRPCB",134,0)
 I TERMDT>0  Q:TERMDT'>DT 0
"RTN","MAGDRPCB",135,0)
 ;--- Check the radiology classification
"RTN","MAGDRPCB",136,0)
 S (IEN1,OK)=0
"RTN","MAGDRPCB",137,0)
 F  S IEN1=$O(^VA(200,IEN,"RAC",IEN1))  Q:'IEN1  D  Q:OK
"RTN","MAGDRPCB",138,0)
 . S:MAGRADCLASS[$P(^VA(200,IEN,"RAC",IEN1,0),U) OK=1
"RTN","MAGDRPCB",139,0)
 . Q
"RTN","MAGDRPCB",140,0)
 Q OK
"RTN","MAGDRPCB",141,0)
 ;
"RTN","MAGDRPCB",142,0)
GETLOC(RESULTS,LOCATION) ; RPC = MAG DICOM GET HOSP LOCATION
"RTN","MAGDRPCB",143,0)
 N I,INACTIVE,LIST,REACTIVE,TYPE
"RTN","MAGDRPCB",144,0)
 D LOOKUP(.LIST,$G(LOCATION),44,"B",".01;2I;2505I;2506I") ; ICR 10040
"RTN","MAGDRPCB",145,0)
 K RESULTS
"RTN","MAGDRPCB",146,0)
  ;--- Copy the records to the result array
"RTN","MAGDRPCB",147,0)
 S (RESULTS(1),I)=0
"RTN","MAGDRPCB",148,0)
 F I=2:1:LIST(1)+1 D
"RTN","MAGDRPCB",149,0)
 . S TYPE=$P(LIST(I),"^",3)
"RTN","MAGDRPCB",150,0)
 . ;
"RTN","MAGDRPCB",151,0)
 . ; allow C=Clinc, M=Module, W=Ward, Z=Other Location
"RTN","MAGDRPCB",152,0)
 . ; allow N=Non-clinic stop, OR=Operating Room
"RTN","MAGDRPCB",153,0)
 . ; ignore F=File area and I=Imaging
"RTN","MAGDRPCB",154,0)
 . ;
"RTN","MAGDRPCB",155,0)
 . I "^C^M^W^Z^N^OR^"'[("^"_TYPE_"^") Q
"RTN","MAGDRPCB",156,0)
 . ;
"RTN","MAGDRPCB",157,0)
 . ; check inactivate date and reactivate date
"RTN","MAGDRPCB",158,0)
 . S INACTIVE=$P(LIST(I),"^",4),REACTIVE=$P(LIST(I),"^",5)
"RTN","MAGDRPCB",159,0)
 . I INACTIVE,DT>INACTIVE Q:'REACTIVE  Q:DT<REACTIVE
"RTN","MAGDRPCB",160,0)
 . ;
"RTN","MAGDRPCB",161,0)
 . S RESULTS(1)=RESULTS(1)+1
"RTN","MAGDRPCB",162,0)
 . S RESULTS(I)=$P(LIST(I),"^",1,2)
"RTN","MAGDRPCB",163,0)
 . Q
"RTN","MAGDRPCB",164,0)
 Q
"RTN","MAGDRPCB",165,0)
 ;
"RTN","MAGDRPCB",166,0)
USERNAME(RESULT) ; RPC = MAG DICOM GET USERNAME
"RTN","MAGDRPCB",167,0)
 S RESULT=$$GET1^DIQ(200,DUZ,.01) ; ICR # 10060
"RTN","MAGDRPCB",168,0)
 Q
"RTN","MAGDRPCB",169,0)
 ;
"RTN","MAGDRPCB",170,0)
ORDERS(ARRAY,DFN) ; RPC = MAG DICOM GET RAD ORDERS
"RTN","MAGDRPCB",171,0)
 ; look up radiology orders
"RTN","MAGDRPCB",172,0)
 N ACNUMB,CASENUMB,DIERR,EXAMDATA,EXAMDATE,ERROR,FIELDS,I,IENS,IMAGLOCN,INACTDAT
"RTN","MAGDRPCB",173,0)
 N ORDER,MAGEXAM,MAGMSG,MAGTMPEXAM,MAGTMPMOD,MODCOUNT,MODDATA
"RTN","MAGDRPCB",174,0)
 N MODIEN,MODIFIER,MSG,PROCIEN,RACNI,RADFN,RADTI,RAOIEN,RC,STATUS,STUDYDAT,TODAY,X,Z
"RTN","MAGDRPCB",175,0)
 K ARRAY
"RTN","MAGDRPCB",176,0)
 S DFN=$G(DFN),TODAY=$$DT^XLFDT()
"RTN","MAGDRPCB",177,0)
 I (DFN'>0)!(DFN'=+DFN) D  Q
"RTN","MAGDRPCB",178,0)
 . S ARRAY(1)="-1,Invalid or missing patient identifier: """_DFN_"""."
"RTN","MAGDRPCB",179,0)
 . Q
"RTN","MAGDRPCB",180,0)
 ;
"RTN","MAGDRPCB",181,0)
 ; Make sure that the patient is registered in the RAD/NUC MED PATIENT file (#70)
"RTN","MAGDRPCB",182,0)
 ;
"RTN","MAGDRPCB",183,0)
 S RC=$$RAPTREG^RAMAGU04(DFN) I RC<0 D  Q  ; ICR 5519
"RTN","MAGDRPCB",184,0)
 . S ARRAY(1)="-2,Patient with DFN #"_DFN_" is not defined in the RAD/NUC MED PATIENT file (#70)."
"RTN","MAGDRPCB",185,0)
 . S ARRAY(2)=RC
"RTN","MAGDRPCB",186,0)
 . Q
"RTN","MAGDRPCB",187,0)
 ;
"RTN","MAGDRPCB",188,0)
 ; Use MUMPS global reads to get data from ^RAO because of possible bad data
"RTN","MAGDRPCB",189,0)
 ; that would cause Fileman to throw an error and not return any results.
"RTN","MAGDRPCB",190,0)
 ;
"RTN","MAGDRPCB",191,0)
 S (ARRAY(1),ERROR,RAOIEN)=0
"RTN","MAGDRPCB",192,0)
 F  S RAOIEN=$O(^RAO(75.1,"B",DFN,RAOIEN)) Q:ERROR  Q:RAOIEN=""  D  ; ICR 3074
"RTN","MAGDRPCB",193,0)
 . S STATUS=$$GET1^DIQ(75.1,RAOIEN,5) ; request status
"RTN","MAGDRPCB",194,0)
 . I "^^COMPLETE^DISCONTINUED^UNRELEASED^"[("^"_STATUS_"^") Q  ; quit if status is null too
"RTN","MAGDRPCB",195,0)
 . S Z=$G(^RAO(75.1,RAOIEN,0))
"RTN","MAGDRPCB",196,0)
 . K ORDER S $P(ORDER,"^",11)="" ; initialize ORDER string
"RTN","MAGDRPCB",197,0)
 . S $P(ORDER,"^",1)=RAOIEN ; file 75.1 IEN
"RTN","MAGDRPCB",198,0)
 . S PROCIEN=$P(Z,"^",2) ; procedure
"RTN","MAGDRPCB",199,0)
 . Q:PROCIEN=""  Q:'$D(^RAMIS(71,PROCIEN,0))  ; null or bad PROCIEN
"RTN","MAGDRPCB",200,0)
 . S INACTDAT=$P($G(^RAMIS(71,PROCIEN,"I")),U)
"RTN","MAGDRPCB",201,0)
 . I INACTDAT,INACTDAT<TODAY Q  ; ignore inactive procedures
"RTN","MAGDRPCB",202,0)
 . S $P(ORDER,"^",2)=PROCIEN ; procedure
"RTN","MAGDRPCB",203,0)
 . ; piece 3 of ORDER is modifier(s)
"RTN","MAGDRPCB",204,0)
 . S $P(ORDER,"^",4)=STATUS ; request status
"RTN","MAGDRPCB",205,0)
 . S $P(ORDER,"^",5)=$P(Z,"^",16) ; request entered date
"RTN","MAGDRPCB",206,0)
 . S $P(ORDER,"^",6)=$$GET1^DIQ(75.1,RAOIEN,1.1) ; reason for study
"RTN","MAGDRPCB",207,0)
 . I $D(^RADPT("AO",RAOIEN)) D
"RTN","MAGDRPCB",208,0)
 . . S RADFN=$O(^RADPT("AO",RAOIEN,"")) ; ICR 1172
"RTN","MAGDRPCB",209,0)
 . . S RADTI=$O(^RADPT("AO",RAOIEN,RADFN,""))
"RTN","MAGDRPCB",210,0)
 . . S RACNI=$O(^RADPT("AO",RAOIEN,RADFN,RADTI,""))
"RTN","MAGDRPCB",211,0)
 . . S $P(ORDER,"^",7)=RADTI
"RTN","MAGDRPCB",212,0)
 . . S $P(ORDER,"^",8)=RACNI
"RTN","MAGDRPCB",213,0)
 . . S MAGTMPEXAM=$NA(^TMP($T(+0),$J,"EXAM"))
"RTN","MAGDRPCB",214,0)
 . . S IENS=RACNI_","_RADTI_","_RADFN_","
"RTN","MAGDRPCB",215,0)
 . . S EXAMDATA=$NA(@MAGTMPEXAM@(70.03,IENS))
"RTN","MAGDRPCB",216,0)
 . . I $T(ACCFIND^RAAPI)'="" S FIELDS=".01;31;" ; requires RA*5.0*47
"RTN","MAGDRPCB",217,0)
 . . E  S FIELDS=".01;" ; no accession number field (#31)
"RTN","MAGDRPCB",218,0)
 . . K @MAGTMPEXAM,MAGMSG
"RTN","MAGDRPCB",219,0)
 . . D GETS^DIQ(70.03,IENS,FIELDS,"EI",MAGTMPEXAM,"MAGMSG") ; ICR 1172
"RTN","MAGDRPCB",220,0)
 . . I $D(MAGMSG) D ORDERERR(.ARRAY,.MAGMSG,-3) S ERROR=-3 Q  ; fatal FileMan error
"RTN","MAGDRPCB",221,0)
 . . S EXAMDATE=$$GET1^DIQ(70.02,(RADTI_","_RADFN),.01,"I") ; ICR 1172
"RTN","MAGDRPCB",222,0)
 . . S ACNUMB=$G(@EXAMDATA@(31,"E"))
"RTN","MAGDRPCB",223,0)
 . . I ACNUMB="" D
"RTN","MAGDRPCB",224,0)
 . . . S CASENUMB=@EXAMDATA@(.01,"E")
"RTN","MAGDRPCB",225,0)
 . . . S ACNUMB=$E(EXAMDATE,4,7)_$E(EXAMDATE,2,3)_"-"_CASENUMB
"RTN","MAGDRPCB",226,0)
 . . . Q
"RTN","MAGDRPCB",227,0)
 . . S $P(ORDER,"^",9)=ACNUMB,$P(ORDER,"^",10)=EXAMDATE
"RTN","MAGDRPCB",228,0)
 . . S IMAGLOCN=$$GET1^DIQ(70.02,(RADTI_","_RADFN),4) ; ICR 1172
"RTN","MAGDRPCB",229,0)
 . . S $P(ORDER,"^",11)=IMAGLOCN
"RTN","MAGDRPCB",230,0)
 . . Q
"RTN","MAGDRPCB",231,0)
 . ;
"RTN","MAGDRPCB",232,0)
 . I ERROR Q  ; FileMan error encountered in exam lookup
"RTN","MAGDRPCB",233,0)
 . ;
"RTN","MAGDRPCB",234,0)
 . ; get procedure modifier(s)
"RTN","MAGDRPCB",235,0)
 . S MAGTMPMOD=$NA(^TMP($T(+0),$J,"MODIFIER")),MODDATA=$NA(@MAGTMPMOD@("DILIST"))
"RTN","MAGDRPCB",236,0)
 . K @MAGTMPMOD,MAGMSG
"RTN","MAGDRPCB",237,0)
 . D LIST^DIC(75.1125,","_RAOIEN_",","@;.01;.01I;IX","",,,,,,,MAGTMPMOD,"MAGMSG") ; ICR 3074
"RTN","MAGDRPCB",238,0)
 . I $D(MAGMSG) D ORDERERR(.ARRAY,.MAGMSG,-4) Q  ; fatal FileMan error
"RTN","MAGDRPCB",239,0)
 . S MODCOUNT=+@MODDATA@(0)
"RTN","MAGDRPCB",240,0)
 . S MODIFIER=""
"RTN","MAGDRPCB",241,0)
 . F I=1:1:MODCOUNT D
"RTN","MAGDRPCB",242,0)
 . . S:$L(MODIFIER) MODIFIER=MODIFIER_"~"
"RTN","MAGDRPCB",243,0)
 . . S MODIEN=@MODDATA@(2,I)
"RTN","MAGDRPCB",244,0)
 . . S MODIFIER=MODIFIER_@MODDATA@("ID",MODIEN,.01,"E")_"|"_^("I")
"RTN","MAGDRPCB",245,0)
 . . Q
"RTN","MAGDRPCB",246,0)
 . S $P(ORDER,"^",3)=MODIFIER
"RTN","MAGDRPCB",247,0)
 . ;
"RTN","MAGDRPCB",248,0)
 . S ARRAY(1)=ARRAY(1)+1,ARRAY(ARRAY(1)+1)=ORDER
"RTN","MAGDRPCB",249,0)
 . Q
"RTN","MAGDRPCB",250,0)
 K:$D(MAGTMPEXAM) @MAGTMPEXAM K:$D(MAGTMPMOD) @MAGTMPMOD ; cleanup
"RTN","MAGDRPCB",251,0)
 Q
"RTN","MAGDRPCB",252,0)
 ;
"RTN","MAGDRPCB",253,0)
ORDERERR(ARRAY,MSG,ERRNUMB) ; handle FilMan errors in ORDER subroutine
"RTN","MAGDRPCB",254,0)
 N I,NODE
"RTN","MAGDRPCB",255,0)
 K ARRAY
"RTN","MAGDRPCB",256,0)
 S I=1,NODE="MSG"
"RTN","MAGDRPCB",257,0)
 F  S NODE=$Q(@NODE) Q:NODE=""  D
"RTN","MAGDRPCB",258,0)
 . S I=I+1,ARRAY(I)=NODE
"RTN","MAGDRPCB",259,0)
 . I $D(@NODE) S ARRAY(I)=ARRAY(I)_"="_@NODE
"RTN","MAGDRPCB",260,0)
 . Q
"RTN","MAGDRPCB",261,0)
 S ARRAY(1)="-100,Fatal FileMan error #"_ERRNUMB
"RTN","MAGDRPCB",262,0)
 Q
"RTN","MAGDRPCB",263,0)
 ;
"RTN","MAGDRPCB",264,0)
IMAGELOC(RESULT,RAOIEN,RAMLC) ; RPC = MAG DICOM SET IMAGING LOCATION
"RTN","MAGDRPCB",265,0)
 N DIERR,MAGFDA,MAGMSG
"RTN","MAGDRPCB",266,0)
 ;
"RTN","MAGDRPCB",267,0)
 K RESULT
"RTN","MAGDRPCB",268,0)
 S RAOIEN=$G(RAOIEN)
"RTN","MAGDRPCB",269,0)
 I (RAOIEN'>0)!(RAOIEN'=+RAOIEN) D  Q
"RTN","MAGDRPCB",270,0)
 . S RESULT="-1,Invalid or missing Radiology Order pointer: """_RAOIEN_"""."
"RTN","MAGDRPCB",271,0)
 . Q
"RTN","MAGDRPCB",272,0)
 ;
"RTN","MAGDRPCB",273,0)
 S RAMLC=$G(RAMLC)
"RTN","MAGDRPCB",274,0)
 I (RAMLC'>0)!(RAMLC'=+RAMLC) D  Q
"RTN","MAGDRPCB",275,0)
 . S RESULT="-2,Invalid or missing Radiology Image Location identifier: """_RAMLC_"""."
"RTN","MAGDRPCB",276,0)
 . Q
"RTN","MAGDRPCB",277,0)
 ;
"RTN","MAGDRPCB",278,0)
 I $$GET1^DIQ(75.1,RAOIEN,.01)="" D  Q  ; ICR 3074
"RTN","MAGDRPCB",279,0)
 . S RESULT="-3,Missing Radiology Order for pointer: """_RAOIEN_"""."
"RTN","MAGDRPCB",280,0)
 . Q
"RTN","MAGDRPCB",281,0)
 ;
"RTN","MAGDRPCB",282,0)
 I $$GET1^DIQ(79.1,RAMLC,.01)="" D  Q  ; ICR 5357
"RTN","MAGDRPCB",283,0)
 . S RESULT="-4,Missing Radiology Image Location for pointer: """_RAMLC_"""."
"RTN","MAGDRPCB",284,0)
 . Q
"RTN","MAGDRPCB",285,0)
 ;
"RTN","MAGDRPCB",286,0)
 I $$GET1^DIQ(75.1,RAOIEN,20)="" D  Q  ; ICR 3074
"RTN","MAGDRPCB",287,0)
 . S MAGFDA(75.1,RAOIEN_",",20)=RAMLC ; IMAGING LOCATION
"RTN","MAGDRPCB",288,0)
 . D FILE^DIE("","MAGFDA","MAGMSG") ; ICR 3074
"RTN","MAGDRPCB",289,0)
 . I $D(MAGMSG) S RESULT="-5,Error setting Radiology Image Location" Q
"RTN","MAGDRPCB",290,0)
 . S RESULT="1,Radiology Image Location set for pointer: """_RAOIEN_"""."
"RTN","MAGDRPCB",291,0)
 . Q
"RTN","MAGDRPCB",292,0)
 E  D
"RTN","MAGDRPCB",293,0)
 . S RESULT="2,Radiology Image Location already set for pointer: """_RAOIEN_""", operation ignored."
"RTN","MAGDRPCB",294,0)
 . Q
"RTN","MAGDRPCB",295,0)
 Q
"RTN","MAGDRPCB",296,0)
 ;
"RTN","MAGDRPCB",297,0)
ADDROOM(RETURN,RAEXAM) ; RPC = MAG DICOM ADD CAMERA EQUIP RM
"RTN","MAGDRPCB",298,0)
 N HIT,I,IENS,LOCNAME,OUTSIDESTUDY,MAGFDA,MAGMSG,RADIMGLOC,ROOMS
"RTN","MAGDRPCB",299,0)
 K RETURN
"RTN","MAGDRPCB",300,0)
 ;
"RTN","MAGDRPCB",301,0)
 I $L($G(RAEXAM),"^")<2 S RETURN(0)="-1,Invalid or missing Radiology Exam pointer: """_RAEXAM_"""." Q
"RTN","MAGDRPCB",302,0)
 ; 
"RTN","MAGDRPCB",303,0)
 ; get the Radiology IMAGING LOCATION
"RTN","MAGDRPCB",304,0)
 S IENS=$P(RAEXAM,"^",2)_","_$P(RAEXAM,"^",1)_","
"RTN","MAGDRPCB",305,0)
 S RADIMGLOC=$$GET1^DIQ(70.02,IENS,4,"I")  ; ICR 1172
"RTN","MAGDRPCB",306,0)
 I 'RADIMGLOC S RETURN(0)="-2,Invalid or missing Radiology IMAGING LOCATION for Exam pointer: """_RAEXAM_"""." Q
"RTN","MAGDRPCB",307,0)
 S LOCNAME=$$GET1^DIQ(79.1,RADIMGLOC,.01)
"RTN","MAGDRPCB",308,0)
 ;
"RTN","MAGDRPCB",309,0)
 ; check if the IMAGING LOCATION has the OUTSIDE STUDY Camera/Equipment/Room
"RTN","MAGDRPCB",310,0)
 S OUTSIDESTUDY="OUTSIDE STUDY" ; designated name
"RTN","MAGDRPCB",311,0)
 D LIST^DIC(79.12,","_RADIMGLOC_",","@;.01","",,,,,,,"ROOMS","MAGMSG")
"RTN","MAGDRPCB",312,0)
 I $D(MAGMSG) D ORDERERR(.RETURN,.MAGMSG,-3) Q  ; fatal FileMan error
"RTN","MAGDRPCB",313,0)
 S HIT=0 F I=1:1:ROOMS("DILIST",0) D  Q:HIT
"RTN","MAGDRPCB",314,0)
 . I ROOMS("DILIST","ID",I,".01")=OUTSIDESTUDY S HIT=1
"RTN","MAGDRPCB",315,0)
 . Q
"RTN","MAGDRPCB",316,0)
 I HIT S RETURN(0)="2,"_OUTSIDESTUDY_" is already defined for """_LOCNAME_"""." Q
"RTN","MAGDRPCB",317,0)
 ;
"RTN","MAGDRPCB",318,0)
 ; add the OUTSIDE STUDY Camera/Equipment/Room to the IMAGING LOCATION
"RTN","MAGDRPCB",319,0)
 S MAGFDA(79.12,"+1,"_RADIMGLOC_",",.01)=OUTSIDESTUDY
"RTN","MAGDRPCB",320,0)
 D UPDATE^DIE("E","MAGFDA","MAGIENS","MAGMSG") ; ICR 5357
"RTN","MAGDRPCB",321,0)
 I $D(MAGMSG) D ORDERERR(.RETURN,.MAGMSG,-4) Q  ; fatal FileMan error
"RTN","MAGDRPCB",322,0)
 S RETURN(0)="1,"_OUTSIDESTUDY_" has been added for """_LOCNAME_"""."
"RTN","MAGDRPCB",323,0)
 Q
"RTN","MAGIPS53")
0^^B10130628
"RTN","MAGIPS53",1,0)
MAGIPS53 ;Post init routine to queue site activity at install. ; 24 Jun 2008 3:12 PM
"RTN","MAGIPS53",2,0)
 ;;3.0;IMAGING;**53**;Mar 19, 2002;Build 1719;Apr 28, 2010
"RTN","MAGIPS53",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGIPS53",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGIPS53",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGIPS53",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGIPS53",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGIPS53",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGIPS53",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGIPS53",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGIPS53",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGIPS53",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGIPS53",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGIPS53",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGIPS53",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGIPS53",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGIPS53",17,0)
 ;;
"RTN","MAGIPS53",18,0)
 Q
"RTN","MAGIPS53",19,0)
 ;
"RTN","MAGIPS53",20,0)
POST ;
"RTN","MAGIPS53",21,0)
 D MENUPDT
"RTN","MAGIPS53",22,0)
 N CT,CNT,D,D0,D1,D2,DDATE,DG,DIC,DICR,DIW,MAGMSG,ST,XMID,XMY
"RTN","MAGIPS53",23,0)
 ;
"RTN","MAGIPS53",24,0)
 D GETENV^%ZOSV
"RTN","MAGIPS53",25,0)
 S CNT=0
"RTN","MAGIPS53",26,0)
 S CNT=CNT+1,MAGMSG(CNT)="PACKAGE INSTALL"
"RTN","MAGIPS53",27,0)
 S CNT=CNT+1,MAGMSG(CNT)="SITE: "_$$KSP^XUPARAM("WHERE")
"RTN","MAGIPS53",28,0)
 S CNT=CNT+1,MAGMSG(CNT)="PACKAGE: "_XPDNM
"RTN","MAGIPS53",29,0)
 S CNT=CNT+1,MAGMSG(CNT)="Version: "_$$VER^XPDUTL(XPDNM)
"RTN","MAGIPS53",30,0)
 S ST=$$GET1^DIQ(9.7,XPDA,11,"I")
"RTN","MAGIPS53",31,0)
 S CNT=CNT+1,MAGMSG(CNT)="Start time: "_$$FMTE^XLFDT(ST)
"RTN","MAGIPS53",32,0)
 S CT=$$GET1^DIQ(9.7,XPDA,17,"I") S:+CT'=CT CT=$$NOW^XLFDT()
"RTN","MAGIPS53",33,0)
 S CNT=CNT+1,MAGMSG(CNT)="Completion time: "_$$FMTE^XLFDT(CT)
"RTN","MAGIPS53",34,0)
 S CNT=CNT+1,MAGMSG(CNT)="Run time: "_$$FMDIFF^XLFDT(CT,ST,3)
"RTN","MAGIPS53",35,0)
 S CNT=CNT+1,MAGMSG(CNT)="Environment: "_Y
"RTN","MAGIPS53",36,0)
 S CNT=CNT+1,MAGMSG(CNT)="FILE COMMENT: "_$$GET1^DIQ(9.7,XPDA,6,"I")
"RTN","MAGIPS53",37,0)
 S CNT=CNT+1,MAGMSG(CNT)="DATE: "_$$NOW^XLFDT()
"RTN","MAGIPS53",38,0)
 S CNT=CNT+1,MAGMSG(CNT)="Installed by: "_$$GET1^DIQ(9.7,XPDA,9,"E")
"RTN","MAGIPS53",39,0)
 S CNT=CNT+1,MAGMSG(CNT)="Install Name: "_$$GET1^DIQ(9.7,XPDA,.01,"E")
"RTN","MAGIPS53",40,0)
 S DDATE=$$GET1^DIQ(9.7,XPDA,51,"I")
"RTN","MAGIPS53",41,0)
 S CNT=CNT+1,MAGMSG(CNT)="Distribution Date: "_$$FMTE^XLFDT(DDATE)
"RTN","MAGIPS53",42,0)
 S XMSUB=XPDNM_" INSTALLATION"
"RTN","MAGIPS53",43,0)
 S XMID=$G(DUZ) S:'XMID XMID=.5
"RTN","MAGIPS53",44,0)
 S XMY(XMID)=""
"RTN","MAGIPS53",45,0)
 S XMY("G.MAG SERVER")=""
"RTN","MAGIPS53",46,0)
 S:$G(MAGDUZ) XMY(MAGDUZ)=""
"RTN","MAGIPS53",47,0)
 S XMSUB=$E(XMSUB,1,63)
"RTN","MAGIPS53",48,0)
 D SENDMSG^XMXAPI(XMID,XMSUB,"MAGMSG",.XMY,,.XMZ,)
"RTN","MAGIPS53",49,0)
 I $G(XMERR) M XMERR=^TMP("XMERR",$J) S $EC=",U13-Cannot send MailMan message,"
"RTN","MAGIPS53",50,0)
 Q
"RTN","MAGIPS53",51,0)
 ;
"RTN","MAGIPS53",52,0)
MENUPDT ; Rename menu on VistA
"RTN","MAGIPS53",53,0)
 D FILE("MAGD DICOM MENU","DICOM Menu Options")
"RTN","MAGIPS53",54,0)
 D FILE("MAGD PRINT DICOM FILE","Print DICOM Failed Image File Entries")
"RTN","MAGIPS53",55,0)
 Q
"RTN","MAGIPS53",56,0)
FILE(OPTION,NAME) ;
"RTN","MAGIPS53",57,0)
 N FDAIEN,FDA
"RTN","MAGIPS53",58,0)
 Q:'$L($G(OPTION))
"RTN","MAGIPS53",59,0)
 Q:'$L($G(NAME))
"RTN","MAGIPS53",60,0)
 S FDAIEN=$$FIND1^DIC(19,,,OPTION,"B")
"RTN","MAGIPS53",61,0)
 Q:'FDAIEN
"RTN","MAGIPS53",62,0)
 S FDAIEN=FDAIEN_",",FDA(19,FDAIEN,1)=NAME
"RTN","MAGIPS53",63,0)
 D UPDATE^DIE("","FDA","")
"RTN","MAGIPS53",64,0)
 Q
"SEC","^DIC",2006.5751,2006.5751,0,"AUDIT")
@
"SEC","^DIC",2006.5751,2006.5751,0,"DD")
@
"SEC","^DIC",2006.5751,2006.5751,0,"DEL")
@
"SEC","^DIC",2006.5751,2006.5751,0,"LAYGO")
@
"SEC","^DIC",2006.5751,2006.5751,0,"RD")
@
"SEC","^DIC",2006.5751,2006.5751,0,"WR")
@
"SEC","^DIC",2006.5752,2006.5752,0,"AUDIT")
@
"SEC","^DIC",2006.5752,2006.5752,0,"DD")
@
"SEC","^DIC",2006.5752,2006.5752,0,"DEL")
@
"SEC","^DIC",2006.5752,2006.5752,0,"LAYGO")
@
"SEC","^DIC",2006.5752,2006.5752,0,"RD")
@
"SEC","^DIC",2006.5752,2006.5752,0,"WR")
@
"SEC","^DIC",2006.5757,2006.5757,0,"AUDIT")
@
"SEC","^DIC",2006.5757,2006.5757,0,"DD")
@
"SEC","^DIC",2006.5757,2006.5757,0,"DEL")
@
"SEC","^DIC",2006.5757,2006.5757,0,"LAYGO")
@
"SEC","^DIC",2006.5757,2006.5757,0,"RD")
@
"SEC","^DIC",2006.5757,2006.5757,0,"WR")
@
"SEC","^DIC",2006.5758,2006.5758,0,"AUDIT")
@
"SEC","^DIC",2006.5758,2006.5758,0,"DD")
@
"SEC","^DIC",2006.5758,2006.5758,0,"DEL")
@
"SEC","^DIC",2006.5758,2006.5758,0,"LAYGO")
@
"SEC","^DIC",2006.5758,2006.5758,0,"RD")
@
"SEC","^DIC",2006.5758,2006.5758,0,"WR")
@
"SEC","^DIC",2006.5759,2006.5759,0,"AUDIT")
@
"SEC","^DIC",2006.5759,2006.5759,0,"DD")
@
"SEC","^DIC",2006.5759,2006.5759,0,"DEL")
@
"SEC","^DIC",2006.5759,2006.5759,0,"LAYGO")
@
"SEC","^DIC",2006.5759,2006.5759,0,"RD")
@
"SEC","^DIC",2006.5759,2006.5759,0,"WR")
@
"SEC","^DIC",2006.588,2006.588,0,"AUDIT")
@
"SEC","^DIC",2006.588,2006.588,0,"DD")
@
"SEC","^DIC",2006.588,2006.588,0,"DEL")
@
"SEC","^DIC",2006.588,2006.588,0,"LAYGO")
@
"SEC","^DIC",2006.588,2006.588,0,"RD")
@
"SEC","^DIC",2006.588,2006.588,0,"WR")
@
"VER")
8.0^22.0
"^DD",2006.563,2006.563,79,0)
BACKGROUND PROCESS VERIFY^F^^M-to-M BROKER BGND VERIFY;1^K:$L(X)>63!($L(X)<1) X
"^DD",2006.563,2006.563,79,3)
Enter the verify code for background processes.
"^DD",2006.563,2006.563,79,21,0)
^.001^8^8^3090929^^
"^DD",2006.563,2006.563,79,21,1,0)
The value of this field is an (encrypted) string. This value will
"^DD",2006.563,2006.563,79,21,2,0)
be used as a verify code by the DICOM Gateway when a "modality"
"^DD",2006.563,2006.563,79,21,3,0)
performs a Modality Worklist Query, in those special cases where
"^DD",2006.563,2006.563,79,21,4,0)
the DICOM Gateway needs to query the VistA system about details
"^DD",2006.563,2006.563,79,21,5,0)
about "old" Radiology studies. (Under normal circumstances, a
"^DD",2006.563,2006.563,79,21,6,0)
DICOM Gateway will be able to respond to a Modality Worklist
"^DD",2006.563,2006.563,79,21,7,0)
Query using only information that is stored on the DICOM Gateway
"^DD",2006.563,2006.563,79,21,8,0)
itself.)
"^DD",2006.563,2006.563,79,"DT")
3040303
"^DD",2006.563,2006.563,81,0)
MULTIFRAME COUNTER^NJ9,0^^MULTIFRAME COUNTER;1^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.563,2006.563,81,3)
Record the sequence number of the last-processed frame.
"^DD",2006.563,2006.563,81,21,0)
^.001^13^13^3090929^^
"^DD",2006.563,2006.563,81,21,1,0)
The value of this field is an integer number that records the
"^DD",2006.563,2006.563,81,21,2,0)
progress through the various frames of a multi-frame image
"^DD",2006.563,2006.563,81,21,3,0)
as data for that image is being received.
"^DD",2006.563,2006.563,81,21,4,0)
 
"^DD",2006.563,2006.563,81,21,5,0)
Under normal circumstances, the various "frames" are converted
"^DD",2006.563,2006.563,81,21,6,0)
to individual images, and there is no need to know the number of
"^DD",2006.563,2006.563,81,21,7,0)
frames processed to any process other than the one
"^DD",2006.563,2006.563,81,21,8,0)
receiving the image data.
"^DD",2006.563,2006.563,81,21,9,0)
 
"^DD",2006.563,2006.563,81,21,10,0)
However, if that process is interrupted (user interrupt, network
"^DD",2006.563,2006.563,81,21,11,0)
outage, power failure), a subsequent process will need to know
"^DD",2006.563,2006.563,81,21,12,0)
which sub-images have already been created when it starts processing
"^DD",2006.563,2006.563,81,21,13,0)
the re-transmission of the image data.
"^DD",2006.563,2006.563,81,"DT")
3040303
"^DD",2006.563,2006.563,93,0)
DICOM EXPORT RUN NUMBER^P2006.565'^MAGDICOM(2006.565,^EXPORT DICOM RUN NUMBER;1^Q
"^DD",2006.563,2006.563,93,3)
Identify the latest DICOM export batch run.
"^DD",2006.563,2006.563,93,21,0)
^.001^3^3^3090929^^
"^DD",2006.563,2006.563,93,21,1,0)
The value of this field is a pointer to the table that
"^DD",2006.563,2006.563,93,21,2,0)
keeps track of the various DICOM export batch runs (#2006.565).
"^DD",2006.563,2006.563,93,21,3,0)
This field identifies the most recently added entry to that table.
"^DD",2006.563,2006.563,93,"DT")
3051007
"^DD",2006.563,2006.563,99,0)
EXPORT SCAN MODE^S^DATE:Date;NUMBER:Report;PATIENT:Patient;^EXPORT SCAN MODE;1^Q
"^DD",2006.563,2006.563,99,3)
Identify the primary scanning criterion for the next batch run.
"^DD",2006.563,2006.563,99,21,0)
^.001^14^14^3090929^^^
"^DD",2006.563,2006.563,99,21,1,0)
Set of codes: DATE, NUMBER, PATIENT
"^DD",2006.563,2006.563,99,21,2,0)
The value of this field is a code that identifies the method
"^DD",2006.563,2006.563,99,21,3,0)
of scanning the Radiology Reports.
"^DD",2006.563,2006.563,99,21,4,0)
Possible values are "DATE", "NUMBER" and "PATIENT".
"^DD",2006.563,2006.563,99,21,5,0)
 
"^DD",2006.563,2006.563,99,21,6,0)
A value of "DATE" indicates that the reports are scanned by date.
"^DD",2006.563,2006.563,99,21,7,0)
 
"^DD",2006.563,2006.563,99,21,8,0)
A value of "PATIENT" indicates that the reports are scanned
"^DD",2006.563,2006.563,99,21,9,0)
by (internal entry number of) patient.
"^DD",2006.563,2006.563,99,21,10,0)
 
"^DD",2006.563,2006.563,99,21,11,0)
A value of "NUMBER" indicates that the reports are scanned
"^DD",2006.563,2006.563,99,21,12,0)
by (internal entry number of) report.
"^DD",2006.563,2006.563,99,21,13,0)
 
"^DD",2006.563,2006.563,99,21,14,0)
This value is the default to be used in the next batch run.
"^DD",2006.563,2006.563,99,"DT")
3051006
"^DD",2006.563,2006.563,114,0)
IMPORTER^S^YES:YES;NO:NO;^IMPORTER;1^Q
"^DD",2006.563,2006.563,114,3)
Use Importer?
"^DD",2006.563,2006.563,114,21,0)
^.001^1^1^3090422^^^^
"^DD",2006.563,2006.563,114,21,1,0)
Indicates whether or not the Importer is to be used on the DICOM Image Gateway.  
"^DD",2006.563,2006.563,114,"DT")
3080618
"^DD",2006.563,2006.563,115,0)
IMPORTER LOG^F^^IMPORTER LOG;1^K:$L(X)>200!($L(X)<1) X
"^DD",2006.563,2006.563,115,3)
Provide the Importer's directory path; answer must be 1-200 characters in length.
"^DD",2006.563,2006.563,115,21,0)
^.001^1^1^3090422^^^^
"^DD",2006.563,2006.563,115,21,1,0)
The value of this field is the directory where the summary importer reports are created.
"^DD",2006.563,2006.563,115,"DT")
3080618
"^DD",2006.563,2006.563,116,0)
IMPORTER DRIVE^F^^IMPORTER DRIVE;1^K:$L(X)>3!($L(X)<1) X
"^DD",2006.563,2006.563,116,3)
Enter the drive letter; answer must be 1-3 characters in length.
"^DD",2006.563,2006.563,116,21,0)
^.001^1^1^3090422^^^^
"^DD",2006.563,2006.563,116,21,1,0)
This is the CD/DVD drive letter that is used by the Importer application.
"^DD",2006.563,2006.563,116,"DT")
3080618
"^DD",2006.563,2006.563,117,0)
IMPORTER ORDER LOCATION^P44'^SC(^IMPORTER ORDER LOCATION;1^Q
"^DD",2006.563,2006.563,117,3)
Select the Hospital Location entry.
"^DD",2006.563,2006.563,117,21,0)
^.001^3^3^3090422^^^
"^DD",2006.563,2006.563,117,21,1,0)
This field records the last hospital location used when placing a study
"^DD",2006.563,2006.563,117,21,2,0)
order on the DICOM Gateway.  This location is used as a default for the
"^DD",2006.563,2006.563,117,21,3,0)
next case to facilitate the ordering process. 
"^DD",2006.563,2006.563,117,"DT")
3080618
"^DD",2006.563,2006.563,118,0)
IMPORTER ORDER LOCATION NAME^F^^IMPORTER ORDER LOCATION NAME;1^K:$L(X)>30!($L(X)<2) X
"^DD",2006.563,2006.563,118,3)
Enter the name of the last location used in the ordering process; answer must be 2-30 characters in length.
"^DD",2006.563,2006.563,118,21,0)
^.001^2^2^3091228^^
"^DD",2006.563,2006.563,118,21,1,0)
The actual Hospital Location name is copied to this field when IMPORTER 
"^DD",2006.563,2006.563,118,21,2,0)
ORDER LOCATION field (#117) is updated.
"^DD",2006.563,2006.563,118,23,0)
^^2^2^3091228^
"^DD",2006.563,2006.563,118,23,1,0)
DICOM Gateway stores a redundant copy of this location, so that it is 
"^DD",2006.563,2006.563,118,23,2,0)
available for display when a connection to VistA is not available.
"^DD",2006.563,2006.563,118,"DT")
3091228
"^DD",2006.563,2006.563,119,0)
IMPORTER ORDER PROVIDER^P200'^VA(200,^IMPORTER ORDER PROVIDER;1^Q
"^DD",2006.563,2006.563,119,3)
Select the provider for this order.
"^DD",2006.563,2006.563,119,21,0)
^^3^3^3091228^
"^DD",2006.563,2006.563,119,21,1,0)
This field records the last provider used when placing a study order on 
"^DD",2006.563,2006.563,119,21,2,0)
the DICOM Gateway.  This provider is used as a default to facilitate the 
"^DD",2006.563,2006.563,119,21,3,0)
next order process.
"^DD",2006.563,2006.563,119,"DT")
3091228
"^DD",2006.563,2006.563,120,0)
IMPORTER ORDER PROVIDER NAME^F^^IMPORTER ORDER PROVIDER NAME;1^K:$L(X)>35!($L(X)<1) X
"^DD",2006.563,2006.563,120,3)
Enter the name of the last ordering provider; answer must be 1-35 characters in length.
"^DD",2006.563,2006.563,120,21,0)
^.001^4^4^3090422^^^^
"^DD",2006.563,2006.563,120,21,1,0)
The actual Provider's name is copied to this field when IMPORTER ORDER
"^DD",2006.563,2006.563,120,21,2,0)
PROVIDER field (#119) is updated.
"^DD",2006.563,2006.563,120,21,3,0)
DICOM Gateway store a redundant copy of the provider name, so that it 
"^DD",2006.563,2006.563,120,21,4,0)
is available for display when a connection to VistA is not available.
"^DD",2006.563,2006.563,120,"DT")
3090408
"^DD",2006.563,2006.563,121,0)
IMPORTER RAD DICT DOWNLOAD^D^^IMPORTER RAD DICT DOWNLOAD;1^S %DT="ETXR" D ^%DT S X=Y K:Y<1 X
"^DD",2006.563,2006.563,121,3)
Enter the date and time when the Radiology dictionaries were last downloaded.
"^DD",2006.563,2006.563,121,21,0)
^.001^3^3^3090422^^^^
"^DD",2006.563,2006.563,121,21,1,0)
The value of this field is the date/time the Radiology Procedure and
"^DD",2006.563,2006.563,121,21,2,0)
Modifier dictionaries were last downloaded.  Downloading automatically occurs
"^DD",2006.563,2006.563,121,21,3,0)
the first time the Importer is used each day.
"^DD",2006.563,2006.563,121,"DT")
3080618
"^DD",2006.563,2006.563,122,0)
IMPORTER RAD CAMERA^P78.6^RA(78.6,^IMPORTER RAD CAMERA;1^Q
"^DD",2006.563,2006.563,122,3)
Select the camera/equip/rm for this order.
"^DD",2006.563,2006.563,122,21,0)
^^3^3^3091228^
"^DD",2006.563,2006.563,122,21,1,0)
This field records the last camera/equip/rm used when placing a study 
"^DD",2006.563,2006.563,122,21,2,0)
order on the DICOM Gateway.  The camera/equip/rm is used as a default for 
"^DD",2006.563,2006.563,122,21,3,0)
the next case to facilitate the ordering process.
"^DD",2006.563,2006.563,122,"DT")
3091228
"^DD",2006.563,2006.563,123,0)
IMPORTER RAD CAMERA NAME^F^^IMPORTER RAD CAMERA NAME;1^K:$L(X)>30!($L(X)<1) X
"^DD",2006.563,2006.563,123,3)
Enter the name of the last camera/equip/rm used by the Importer; answer must be 1-30 characters in length.
"^DD",2006.563,2006.563,123,21,0)
^.001^5^5^3090424^^^
"^DD",2006.563,2006.563,123,21,1,0)
The actual Camera/Equip/Rm name is copied to this field when IMPORTER RAD
"^DD",2006.563,2006.563,123,21,2,0)
CAMERA FIELD (#122) is updated.
"^DD",2006.563,2006.563,123,21,3,0)
 
"^DD",2006.563,2006.563,123,21,4,0)
DICOM Gateway stores a redundant copy of the camera/equip/rm so that it is
"^DD",2006.563,2006.563,123,21,5,0)
available for display when a connection to VistA is not available.
"^DD",2006.563,2006.563,123,"DT")
3090424
"^DD",2006.563,2006.563,124,0)
IMPORTER RAD DX CODE^P78.3'^RA(78.3,^IMPORTER RAD DX CODE;1^Q
"^DD",2006.563,2006.563,124,3)
Select the diagnostic code for this order.
"^DD",2006.563,2006.563,124,21,0)
^.001^3^3^3090424^^^
"^DD",2006.563,2006.563,124,21,1,0)
This field records the last diagnostic code used when placing a study order
"^DD",2006.563,2006.563,124,21,2,0)
on the DICOM Gateway.  This location is used as a default for the next
"^DD",2006.563,2006.563,124,21,3,0)
case to facilitate the ordering process.
"^DD",2006.563,2006.563,124,"DT")
3090424
"^DD",2006.563,2006.563,125,0)
IMPORTER RAD DX CODE NAME^F^^IMPORTER RAD DX CODE NAME;1^K:$L(X)>60!($L(X)<1) X
"^DD",2006.563,2006.563,125,3)
Enter the name of the last diagnostic code used by the Importer; answer must be 1-60 characters in length.
"^DD",2006.563,2006.563,125,21,0)
^.001^6^6^3090424^^
"^DD",2006.563,2006.563,125,21,1,0)
The actual NAME OF THE DIAGNOSTIC CODE is copied to this field when
"^DD",2006.563,2006.563,125,21,2,0)
IMPORTER RAD DX CODE is updated.
"^DD",2006.563,2006.563,125,21,3,0)
 
"^DD",2006.563,2006.563,125,21,4,0)
DICOM Gateway stores a redundant copy of the Radiology diagnostic code
"^DD",2006.563,2006.563,125,21,5,0)
so that it is available for display when a connection to VistA is not
"^DD",2006.563,2006.563,125,21,6,0)
available.
"^DD",2006.563,2006.563,125,"DT")
3090424
"^DD",2006.563,2006.563,126,0)
IMPORTER RAD FILM SIZE^P78.4'^RA(78.4,^IMPORTER RAD FILM SIZE;1^Q
"^DD",2006.563,2006.563,126,3)
Select the film size for this order.
"^DD",2006.563,2006.563,126,21,0)
^^3^3^3091228^
"^DD",2006.563,2006.563,126,21,1,0)
This field records the last film size used when placing a study order on 
"^DD",2006.563,2006.563,126,21,2,0)
the DICOM Gateway.  This film size will be used as a default for the next 
"^DD",2006.563,2006.563,126,21,3,0)
case to facilitate the ordering process.
"^DD",2006.563,2006.563,126,"DT")
3091228
"^DD",2006.563,2006.563,127,0)
IMPORTER RAD FILM SIZE NAME^F^^IMPORTER RAD FILM SIZE NAME;1^K:$L(X)>30!($L(X)<1) X
"^DD",2006.563,2006.563,127,3)
Enter the last film size used by the Importer; answer must be 1-30 characters in length.
"^DD",2006.563,2006.563,127,21,0)
^.001^5^5^3090506^^^^
"^DD",2006.563,2006.563,127,21,1,0)
The actual Film Size name is copied to this field when IMPORTER RAD FILM
"^DD",2006.563,2006.563,127,21,2,0)
SIZE field (#126) is updated.
"^DD",2006.563,2006.563,127,21,3,0)
 
"^DD",2006.563,2006.563,127,21,4,0)
DICOM Gateway stores a redundant copy of this Film Size name so that it is
"^DD",2006.563,2006.563,127,21,5,0)
available for display when a connection to VistA is not available.
"^DD",2006.563,2006.563,127,"DT")
3090424
"^DD",2006.563,2006.563,128,0)
IMPORT RAD TECH^P200'^VA(200,^IMPORTER RAD TECH;1^Q
"^DD",2006.563,2006.563,128,3)
Select the Radiology technician for this order.
"^DD",2006.563,2006.563,128,21,0)
^.001^3^3^3090424^^
"^DD",2006.563,2006.563,128,21,1,0)
This field records the last Radiology technician used when placing a 
"^DD",2006.563,2006.563,128,21,2,0)
study order on the DICOM Gateway.  This technician will be used as the
"^DD",2006.563,2006.563,128,21,3,0)
default for the next case to facilitate the ordering process.
"^DD",2006.563,2006.563,128,"DT")
3090424
"^DD",2006.563,2006.563,129,0)
IMPORTER RAD TECH NAME^F^^IMPORTER RAD TECH NAME;1^K:$L(X)>35!($L(X)<1) X
"^DD",2006.563,2006.563,129,3)
Enter the last Radiology technician used by the Importer; answer must be 1-35 characters in length.
"^DD",2006.563,2006.563,129,21,0)
^.001^4^4^3090428^^
"^DD",2006.563,2006.563,129,21,1,0)
The actual Radiology technician name is copied to this field when the IMPORTER RAD TECH field (#128) is updated.
"^DD",2006.563,2006.563,129,21,2,0)
 
"^DD",2006.563,2006.563,129,21,3,0)
DICOM Gateway stores a redundant copy of the technician name, so that it is
"^DD",2006.563,2006.563,129,21,4,0)
available for display when a connection to VistA is not available.
"^DD",2006.563,2006.563,129,"DT")
3090424
"^DD",2006.571,2006.571,4,0)
ORIGIN INDEX^S^D:DOD;F:FEE;N:OTHER;V:VA;^0;4^Q
"^DD",2006.571,2006.571,4,3)
Select the origin index.
"^DD",2006.571,2006.571,4,21,0)
^.001^2^2^3090420^^^^
"^DD",2006.571,2006.571,4,21,1,0)
This field indicates whether the image originated inside or outside the VA.
"^DD",2006.571,2006.571,4,21,2,0)
The information will be used for field ORIGIN INDEX (#45) in IMAGE file (#2005).
"^DD",2006.571,2006.571,4,"DT")
3080618
"^DD",2006.571,2006.571,5,0)
MEDIA^S^M:Portable Media (CD or DVD);T:Transmitted (C-Stored);^0;5^Q
"^DD",2006.571,2006.571,5,3)
Select the media type.
"^DD",2006.571,2006.571,5,21,0)
^.001^1^1^3090420^^^
"^DD",2006.571,2006.571,5,21,1,0)
The value of this field indicates the source of the DICOM object.
"^DD",2006.571,2006.571,5,"DT")
3090420
"^DD",2006.571,2006.571,6,0)
OLDPATH^F^^0;6^K:$L(X)>50!($L(X)<1) X
"^DD",2006.571,2006.571,6,3)
Enter the original physical path; answer must be 1-50 characters in length.
"^DD",2006.571,2006.571,6,21,0)
^.001^1^1^3090420^^
"^DD",2006.571,2006.571,6,21,1,0)
This is the original path of the transmitted DICOM object.
"^DD",2006.571,2006.571,6,"DT")
3080618
"^DD",2006.5751,2006.5751,0)
FIELD^^44^25
"^DD",2006.5751,2006.5751,0,"DDA")
N
"^DD",2006.5751,2006.5751,0,"DT")
3090505
"^DD",2006.5751,2006.5751,0,"IX","B",2006.5751,.01)

"^DD",2006.5751,2006.5751,0,"NM","DICOM OBJECTS TO BE IMPORTED")

"^DD",2006.5751,2006.5751,.01,0)
PATIENT NAME^RFX^^0;1^K:X'?.E1"|".E1"|".E!(X?2"|") X I $D(X),$L(X)>60 K X
"^DD",2006.5751,2006.5751,.01,1,0)
^.1
"^DD",2006.5751,2006.5751,.01,1,1,0)
2006.5751^B
"^DD",2006.5751,2006.5751,.01,1,1,1)
S ^MAGDICOM(2006.5751,"B",$E(X,1,60),DA)=""
"^DD",2006.5751,2006.5751,.01,1,1,2)
K ^MAGDICOM(2006.5751,"B",$E(X,1,60),DA)
"^DD",2006.5751,2006.5751,.01,3)
Enter the patient's name in format: LAST|FIRST|MIDDLE
"^DD",2006.5751,2006.5751,.01,21,0)
^.001^2^2^3090505^^^^
"^DD",2006.5751,2006.5751,.01,21,1,0)
This is the patient name as identified in DICOM tag 0010,0010 from the
"^DD",2006.5751,2006.5751,.01,21,2,0)
DICOM Object file that is to be imported.
"^DD",2006.5751,2006.5751,.01,"DT")
3090505
"^DD",2006.5751,2006.5751,2,0)
PATIENT ID^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",2006.5751,2006.5751,2,3)
Enter the patient's id for the imported image; answer must be 1-30 characters in length.
"^DD",2006.5751,2006.5751,2,21,0)
^.001^4^4^3090505^^^^
"^DD",2006.5751,2006.5751,2,21,1,0)
This is the Patient ID as identified in DICOM tag 0010,0020 from the DICOM
"^DD",2006.5751,2006.5751,2,21,2,0)
Object file that is to be imported.  
"^DD",2006.5751,2006.5751,2,21,3,0)
The patient id may be a social security number or the sending facility's
"^DD",2006.5751,2006.5751,2,21,4,0)
own patient identification.
"^DD",2006.5751,2006.5751,2,"DT")
3090505
"^DD",2006.5751,2006.5751,3,0)
DOB^FX^^0;3^K:X'?8N X
"^DD",2006.5751,2006.5751,3,3)
Enter the patient's date of birth, use format YYYYMMDD.
"^DD",2006.5751,2006.5751,3,21,0)
^.001^2^2^3090505^^^^
"^DD",2006.5751,2006.5751,3,21,1,0)
The patient's date of birth is obtained in DICOM tag 0010,0030 from the
"^DD",2006.5751,2006.5751,3,21,2,0)
DICOM Object file that is to be imported.
"^DD",2006.5751,2006.5751,3,"DT")
3090505
"^DD",2006.5751,2006.5751,4,0)
SEX^S^M:MALE;F:FEMALE;O:UNKNOWN;^0;4^Q
"^DD",2006.5751,2006.5751,4,3)
Identify patient's sex.
"^DD",2006.5751,2006.5751,4,21,0)
^.001^2^2^3090505^^^^
"^DD",2006.5751,2006.5751,4,21,1,0)
The patient's sex is obtained in DICOM tag 0010,0040 from the DICOM Object
"^DD",2006.5751,2006.5751,4,21,2,0)
file that is to be imported.
"^DD",2006.5751,2006.5751,4,"DT")
3090420
"^DD",2006.5751,2006.5751,11,0)
STUDY DATE^FX^^1;1^K:X'?8N X
"^DD",2006.5751,2006.5751,11,3)
Enter image's study date; use format YYYYMMDD
"^DD",2006.5751,2006.5751,11,21,0)
^.001^2^2^3090505^^^^
"^DD",2006.5751,2006.5751,11,21,1,0)
The study date is obtained in DICOM tag 0008,0020 from the DICOM Object
"^DD",2006.5751,2006.5751,11,21,2,0)
file that is to be imported.
"^DD",2006.5751,2006.5751,11,"DT")
3090505
"^DD",2006.5751,2006.5751,12,0)
STUDY TIME^FX^^1;2^K:X'?4N X
"^DD",2006.5751,2006.5751,12,3)
Enter the image study time, in format HHMM.
"^DD",2006.5751,2006.5751,12,21,0)
^^2^2^3090505^
"^DD",2006.5751,2006.5751,12,21,1,0)
The study time is obtained in DICOM tag 0008,0030 from the DICOM Object
"^DD",2006.5751,2006.5751,12,21,2,0)
file that is to be imported.
"^DD",2006.5751,2006.5751,12,"DT")
3090505
"^DD",2006.5751,2006.5751,13,0)
ACCESSION NUMBER^F^^1;3^K:$L(X)>16!($L(X)<1) X
"^DD",2006.5751,2006.5751,13,3)
Enter the image's accession number; answer must be 1-16 characters in length.
"^DD",2006.5751,2006.5751,13,21,0)
^.001^2^2^3090505^^^^
"^DD",2006.5751,2006.5751,13,21,1,0)
This is the accession number as identified in DICOM tag 0008,0050 from the
"^DD",2006.5751,2006.5751,13,21,2,0)
DICOM Object file that is to be imported.
"^DD",2006.5751,2006.5751,13,"DT")
3080425
"^DD",2006.5751,2006.5751,14,0)
REFERRING PHYSICIAN^F^^1;4^K:$L(X)>30!($L(X)<1) X
"^DD",2006.5751,2006.5751,14,3)
Enter the referring physician for the image; answer must be 1-30 characters in length.
"^DD",2006.5751,2006.5751,14,21,0)
^.001^2^2^3090505^^^
"^DD",2006.5751,2006.5751,14,21,1,0)
This is the physician name as identified in DICOM tag 0008,0090 from the
"^DD",2006.5751,2006.5751,14,21,2,0)
DICOM Object file that is to be imported.
"^DD",2006.5751,2006.5751,14,"DT")
3080425
"^DD",2006.5751,2006.5751,15,0)
STUDY DESCRIPTION^F^^1;5^K:$L(X)>64!($L(X)<1) X
"^DD",2006.5751,2006.5751,15,3)
Enter the image's study description; answer must be 1-64 characters in length.
"^DD",2006.5751,2006.5751,15,21,0)
^.001^2^2^3090505^^^
"^DD",2006.5751,2006.5751,15,21,1,0)
This is the image's study description obtained in DICOM tag 0008,1030
"^DD",2006.5751,2006.5751,15,21,2,0)
from the DICOM Object file that is to be imported.
"^DD",2006.5751,2006.5751,15,"DT")
3080425
"^DD",2006.5751,2006.5751,16,0)
STUDY INSTANCE UID^F^^1;6^K:$L(X)>64!($L(X)<1) X
"^DD",2006.5751,2006.5751,16,3)
Enter the image's study instance uid; answer must be 1-64 characters in length.
"^DD",2006.5751,2006.5751,16,21,0)
^.001^2^2^3090505^^^
"^DD",2006.5751,2006.5751,16,21,1,0)
The study instance uid is obtained in DICOM tag 0020,000D from the 
"^DD",2006.5751,2006.5751,16,21,2,0)
DICOM Object file that is to be imported. 
"^DD",2006.5751,2006.5751,16,"DT")
3080425
"^DD",2006.5751,2006.5751,21,0)
MODALITY^F^^2;1^K:$L(X)>16!($L(X)<1) X
"^DD",2006.5751,2006.5751,21,3)
Enter the modality that captured the image; answer must be 1-16 characters in length.
"^DD",2006.5751,2006.5751,21,21,0)
^.001^2^2^3090505^^^^
"^DD",2006.5751,2006.5751,21,21,1,0)
The modality is obtained in DICOM tag 0008,0060 from the DICOM Object
"^DD",2006.5751,2006.5751,21,21,2,0)
file that is to be imported.
"^DD",2006.5751,2006.5751,21,"DT")
3080425
"^DD",2006.5751,2006.5751,22,0)
INSTITUTION NAME^F^^2;2^K:$L(X)>30!($L(X)<1) X
"^DD",2006.5751,2006.5751,22,3)
Enter the institution name where the image was acquired; answer must be 1-30 characters in length.
"^DD",2006.5751,2006.5751,22,21,0)
^.001^5^5^3090505^^^^
"^DD",2006.5751,2006.5751,22,21,1,0)
The institution name is obtained from the DICOM Object file
"^DD",2006.5751,2006.5751,22,21,2,0)
under DICOM tag 0008,0080.
"^DD",2006.5751,2006.5751,22,21,3,0)
 
"^DD",2006.5751,2006.5751,22,21,4,0)
The DICOM Object file's institution may be an outside non-VA facility
"^DD",2006.5751,2006.5751,22,21,5,0)
such as DOD facility or a fee basis entity.
"^DD",2006.5751,2006.5751,22,"DT")
3080425
"^DD",2006.5751,2006.5751,23,0)
INSTITUTION ADDRESS^F^^2;3^K:$L(X)>40!($L(X)<1) X
"^DD",2006.5751,2006.5751,23,3)
Enter the institution address where the image was acquired; answer must be 1-40 characters in length.
"^DD",2006.5751,2006.5751,23,21,0)
^.001^2^2^3090505^^^^
"^DD",2006.5751,2006.5751,23,21,1,0)
The institution address is obtained from the DICOM Object file under
"^DD",2006.5751,2006.5751,23,21,2,0)
DICOM tag 0008,0081.  
"^DD",2006.5751,2006.5751,23,"DT")
3080425
"^DD",2006.5751,2006.5751,24,0)
SERIES DESCRIPTION^F^^2;4^K:$L(X)>40!($L(X)<1) X
"^DD",2006.5751,2006.5751,24,3)
Enter the image's series description; answer must be 1-40 characters in length.
"^DD",2006.5751,2006.5751,24,21,0)
^.001^2^2^3090505^^^^
"^DD",2006.5751,2006.5751,24,21,1,0)
This is the image's series description as identified in DICOM tag
"^DD",2006.5751,2006.5751,24,21,2,0)
0008,103E from the DICOM Object file that is to be imported.
"^DD",2006.5751,2006.5751,24,"DT")
3080425
"^DD",2006.5751,2006.5751,25,0)
SERIES INSTANCE UID^F^^2;5^K:$L(X)>64!($L(X)<1) X
"^DD",2006.5751,2006.5751,25,3)
Enter the image's series instance uid; answer must be 1-64 characters in length.
"^DD",2006.5751,2006.5751,25,21,0)
^.001^2^2^3090505^^^^
"^DD",2006.5751,2006.5751,25,21,1,0)
This is the image's series instance uid as identified in DICOM tag 0020,000E
"^DD",2006.5751,2006.5751,25,21,2,0)
from the DICOM Object file that is to be imported.
"^DD",2006.5751,2006.5751,25,"DT")
3080425
"^DD",2006.5751,2006.5751,31,0)
PATH TO DICOM OBJECT^F^^3;1^K:$L(X)>30!($L(X)<1) X
"^DD",2006.5751,2006.5751,31,3)
Enter the path where the images are located; answer must be 1-30 characters in length.
"^DD",2006.5751,2006.5751,31,21,0)
^.001^2^2^3090505^^^^
"^DD",2006.5751,2006.5751,31,21,1,0)
This is the share path either on the local machine or a mapped drive
"^DD",2006.5751,2006.5751,31,21,2,0)
where the images to be imported reside.
"^DD",2006.5751,2006.5751,31,"DT")
3080425
"^DD",2006.5751,2006.5751,32,0)
SOP CLASS^F^^3;2^K:$L(X)>35!($L(X)<1) X
"^DD",2006.5751,2006.5751,32,3)
Enter the image's sop class; answer must be 1-35 characters in length.
"^DD",2006.5751,2006.5751,32,21,0)
^.001^2^2^3090505^^
"^DD",2006.5751,2006.5751,32,21,1,0)
The image's sop class is obtained in DICOM tag from the DICOM Object
"^DD",2006.5751,2006.5751,32,21,2,0)
file for the image to be imported.
"^DD",2006.5751,2006.5751,32,"DT")
3080425
"^DD",2006.5751,2006.5751,33,0)
TRANSFER SYNTAX^F^^3;3^K:$L(X)>35!($L(X)<1) X
"^DD",2006.5751,2006.5751,33,3)
Enter the image's transfer syntax; answer must be 1-35 characters in length.
"^DD",2006.5751,2006.5751,33,21,0)
^.001^2^2^3090505^^^^
"^DD",2006.5751,2006.5751,33,21,1,0)
The image's transfer syntax is obtained in DICOM tag 0004,1523 from
"^DD",2006.5751,2006.5751,33,21,2,0)
the DICOM Object file for the image to be imported.
"^DD",2006.5751,2006.5751,33,"DT")
3080425
"^DD",2006.5751,2006.5751,34,0)
SOP INSTANCE UID^F^^3;4^K:$L(X)>64!($L(X)<1) X
"^DD",2006.5751,2006.5751,34,3)
Enter the image's sop instance uid; answer must be 1-64 characters in length.
"^DD",2006.5751,2006.5751,34,21,0)
^.001^2^2^3090505^^^^
"^DD",2006.5751,2006.5751,34,21,1,0)
The image's sop instance uid is obtained in DICOM tag 0008,0018 and
"^DD",2006.5751,2006.5751,34,21,2,0)
0004,1511 from the DICOM Object file for the image to be imported.
"^DD",2006.5751,2006.5751,34,"DT")
3080425
"^DD",2006.5751,2006.5751,35,0)
INSTANCE NUMBER^NJ5,0^^3;5^K:+X'=X!(X>99999)!(X<1)!(X?.E1"."1N.N) X
"^DD",2006.5751,2006.5751,35,3)
Enter the image number; answer must be 1 to 5 numeric characters.
"^DD",2006.5751,2006.5751,35,21,0)
^.001^3^3^3090505^^^^
"^DD",2006.5751,2006.5751,35,21,1,0)
The image's instance number (actual image number within the study) is
"^DD",2006.5751,2006.5751,35,21,2,0)
obtained in DICOM tag 0020,0013 from the DICOM Object file for the image
"^DD",2006.5751,2006.5751,35,21,3,0)
to be imported.
"^DD",2006.5751,2006.5751,35,"DT")
3090420
"^DD",2006.5751,2006.5751,36,0)
NUMBER OF FRAMES^NJ5,0^^3;6^K:+X'=X!(X>99999)!(X<1)!(X?.E1"."1N.N) X
"^DD",2006.5751,2006.5751,36,3)
Enter the frame number for the image; answer must be 1 to 5 numeric characters.
"^DD",2006.5751,2006.5751,36,21,0)
^.001^3^3^3090505^^^^
"^DD",2006.5751,2006.5751,36,21,1,0)
This field is optional and used for multi-frame images.  The
"^DD",2006.5751,2006.5751,36,21,2,0)
information is obtained in DICOM tag 0028,0008 from the DICOM Object
"^DD",2006.5751,2006.5751,36,21,3,0)
file for the image to be imported.
"^DD",2006.5751,2006.5751,36,"DT")
3090420
"^DD",2006.5751,2006.5751,41,0)
INSTRUMENT NAME^F^^4;1^K:$L(X)>16!($L(X)<1) X
"^DD",2006.5751,2006.5751,41,3)
Enter the instrument name where the image was captured on; answer must be 1-16 characters in length.
"^DD",2006.5751,2006.5751,41,21,0)
^.001^1^1^3090505^^^^
"^DD",2006.5751,2006.5751,41,21,1,0)
This field stores the Instrument Name (C-Store process name).
"^DD",2006.5751,2006.5751,41,"DT")
3080425
"^DD",2006.5751,2006.5751,42,0)
CALLING AE TITLE^F^^4;2^K:$L(X)>16!($L(X)<1) X
"^DD",2006.5751,2006.5751,42,3)
Enter the application's entity title; answer must be 1-16 characters in length.
"^DD",2006.5751,2006.5751,42,21,0)
^.001^2^2^3090505^^^^
"^DD",2006.5751,2006.5751,42,21,1,0)
This field stores the Calling application entity title, e.g. DICOM_TEST.  The
"^DD",2006.5751,2006.5751,42,21,2,0)
possible values are defined in file AE_TITLE.DIC.
"^DD",2006.5751,2006.5751,42,"DT")
3080425
"^DD",2006.5751,2006.5751,43,0)
TIMESTAMP^D^^4;3^S %DT="ET" D ^%DT S X=Y K:Y<1 X
"^DD",2006.5751,2006.5751,43,3)
Enter the present date and time for the entry being added.
"^DD",2006.5751,2006.5751,43,21,0)
^.001^1^1^3090505^^^^
"^DD",2006.5751,2006.5751,43,21,1,0)
This field stores the date and time when an entry was made into this file.
"^DD",2006.5751,2006.5751,43,"DT")
3090420
"^DD",2006.5751,2006.5751,44,0)
PRESENTATION CONTEXT FLAG^S^0:acceptable;2:VISTA_STORAGE is missing;3:abstract syntax not supported;4:transfer syntax not supported;^4;4^Q
"^DD",2006.5751,2006.5751,44,3)
Select image's presentation context.
"^DD",2006.5751,2006.5751,44,21,0)
^.001^6^6^3090505^^^^
"^DD",2006.5751,2006.5751,44,21,1,0)
This field is updated during the process of reading the DICOM Object
"^DD",2006.5751,2006.5751,44,21,2,0)
file and will store the image's presentation context.  The values
"^DD",2006.5751,2006.5751,44,21,3,0)
provided are DICOM standards.
"^DD",2006.5751,2006.5751,44,21,4,0)
 
"^DD",2006.5751,2006.5751,44,21,5,0)
If VISTA_STORAGE is undefined in the PROVIDER APPLICATION file (#2006.586),
"^DD",2006.5751,2006.5751,44,21,6,0)
this field will record 'VISTA_STORAGE is missing'.
"^DD",2006.5751,2006.5751,44,"DT")
3090505
"^DD",2006.5752,2006.5752,0)
FIELD^^32^10
"^DD",2006.5752,2006.5752,0,"DDA")
N
"^DD",2006.5752,2006.5752,0,"DT")
3090505
"^DD",2006.5752,2006.5752,0,"IX","C",2006.5752,32)

"^DD",2006.5752,2006.5752,0,"NM","IMPORTABLE DICOM OBJECTS")

"^DD",2006.5752,2006.5752,.01,0)
PATIENT NAME^RFX^^0;1^K:X'?.E1"|".E1"|".E!(X?2"|") X I $D(X),$L(X)>60 K X
"^DD",2006.5752,2006.5752,.01,1,0)
^.1^^0
"^DD",2006.5752,2006.5752,.01,3)
Enter the patient's name in format: LAST|FIRST|MIDDLE
"^DD",2006.5752,2006.5752,.01,21,0)
^.001^2^2^3090505^^^^
"^DD",2006.5752,2006.5752,.01,21,1,0)
This is the patient name as identified in DICOM tag 0010,0010 from the
"^DD",2006.5752,2006.5752,.01,21,2,0)
DICOM Object file for the image to be imported.
"^DD",2006.5752,2006.5752,.01,"DT")
3090528
"^DD",2006.5752,2006.5752,2,0)
PATIENT ID^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",2006.5752,2006.5752,2,3)
Enter the patient identifier; answer must be 1-30 characters in length.
"^DD",2006.5752,2006.5752,2,21,0)
^.001^5^5^3090505^^^^
"^DD",2006.5752,2006.5752,2,21,1,0)
This is the Patient ID as identified in DICOM tag 0010,0020 from the
"^DD",2006.5752,2006.5752,2,21,2,0)
DICOM Object file that is to be imported.
"^DD",2006.5752,2006.5752,2,21,3,0)
 
"^DD",2006.5752,2006.5752,2,21,4,0)
The patient id may be a social security number or the sending
"^DD",2006.5752,2006.5752,2,21,5,0)
facility's own patient identification.
"^DD",2006.5752,2006.5752,2,"DT")
3080425
"^DD",2006.5752,2006.5752,3,0)
DICOM GATEWAY NAME^F^^0;3^K:$L(X)>16!($L(X)<1) X
"^DD",2006.5752,2006.5752,3,3)
Enter the DICOM Gateway's host name; answer must be 1-16 characters in length.
"^DD",2006.5752,2006.5752,3,21,0)
^.001^1^1^3090505^^^^
"^DD",2006.5752,2006.5752,3,21,1,0)
This the DICOM Gateway that received the DICOM Object file.
"^DD",2006.5752,2006.5752,3,"DT")
3090522
"^DD",2006.5752,2006.5752,11,0)
STUDY DATE^FX^^1;1^K:X'?8N X
"^DD",2006.5752,2006.5752,11,3)
This is the study date for the image; use format YYYYMMDD.
"^DD",2006.5752,2006.5752,11,21,0)
^.001^2^2^3090505^^^^
"^DD",2006.5752,2006.5752,11,21,1,0)
The study date is obtained in DICOM tag 0008,0020 from the DICOM
"^DD",2006.5752,2006.5752,11,21,2,0)
Object file that is to be imported.
"^DD",2006.5752,2006.5752,11,"DT")
3090505
"^DD",2006.5752,2006.5752,12,0)
ACCESSION NUMBER^F^^1;2^K:$L(X)>16!($L(X)<1) X
"^DD",2006.5752,2006.5752,12,3)
Enter the image's accession number; answer must be 1-16 characters in length.
"^DD",2006.5752,2006.5752,12,21,0)
^.001^2^2^3090505^^^^
"^DD",2006.5752,2006.5752,12,21,1,0)
This is the accession number as identified in DICOM tag 0008,0050 from
"^DD",2006.5752,2006.5752,12,21,2,0)
the DICOM Object file that is to be imported.
"^DD",2006.5752,2006.5752,12,"DT")
3080425
"^DD",2006.5752,2006.5752,13,0)
STUDY INSTANCE UID^F^^1;3^K:$L(X)>64!($L(X)<1) X
"^DD",2006.5752,2006.5752,13,3)
Enter the image's study instance uid; answer must be 1-64 characters in length.
"^DD",2006.5752,2006.5752,13,21,0)
^.001^2^2^3090505^^^^
"^DD",2006.5752,2006.5752,13,21,1,0)
The study instance uid is obtained in DICOM tag 0020,000D from the 
"^DD",2006.5752,2006.5752,13,21,2,0)
DICOM Object file that is to be imported.
"^DD",2006.5752,2006.5752,13,"DT")
3080425
"^DD",2006.5752,2006.5752,21,0)
MODALITY^F^^2;1^K:$L(X)>16!($L(X)<1) X
"^DD",2006.5752,2006.5752,21,3)
Enter the modality that captured the image; answer must be 1-16 characters in length.
"^DD",2006.5752,2006.5752,21,21,0)
^.001^2^2^3090505^^^^
"^DD",2006.5752,2006.5752,21,21,1,0)
The modality is obtained in DICOM tag 0008,0060 from the DICOM Object
"^DD",2006.5752,2006.5752,21,21,2,0)
file that is to be imported.
"^DD",2006.5752,2006.5752,21,"DT")
3090505
"^DD",2006.5752,2006.5752,22,0)
SERIES INSTANCE UID^F^^2;2^K:$L(X)>64!($L(X)<1) X
"^DD",2006.5752,2006.5752,22,3)
Enter the image's series instance uid; answer must be 1-64 characters in length.
"^DD",2006.5752,2006.5752,22,21,0)
^.001^2^2^3090505^^^^
"^DD",2006.5752,2006.5752,22,21,1,0)
This is the image's series instance uid as identified in DICOM tag 
"^DD",2006.5752,2006.5752,22,21,2,0)
0020,000E from the DICOM Object file that is to be imported.
"^DD",2006.5752,2006.5752,22,"DT")
3080425
"^DD",2006.5752,2006.5752,31,0)
PATH TO DICOM OBJECT^F^^3;1^K:$L(X)>30!($L(X)<1) X
"^DD",2006.5752,2006.5752,31,1,0)
^.1^^0
"^DD",2006.5752,2006.5752,31,3)
Enter the physical path where the image files will be read from; answer must be 1-30 characters in length.
"^DD",2006.5752,2006.5752,31,21,0)
^.001^2^2^3090505^^^^
"^DD",2006.5752,2006.5752,31,21,1,0)
This is the share path either on the local machine or a mapped
"^DD",2006.5752,2006.5752,31,21,2,0)
drive where the images to be imported reside.
"^DD",2006.5752,2006.5752,31,"DT")
3090522
"^DD",2006.5752,2006.5752,32,0)
SOP INSTANCE UID^F^^3;2^K:$L(X)>64!($L(X)<1) X
"^DD",2006.5752,2006.5752,32,1,0)
^.1
"^DD",2006.5752,2006.5752,32,1,2,0)
2006.5752^C
"^DD",2006.5752,2006.5752,32,1,2,1)
S ^MAGD(2006.5752,"C",$E(X,1,30),DA)=""
"^DD",2006.5752,2006.5752,32,1,2,2)
K ^MAGD(2006.5752,"C",$E(X,1,30),DA)
"^DD",2006.5752,2006.5752,32,1,2,"%D",0)
^^1^1^3080425^
"^DD",2006.5752,2006.5752,32,1,2,"%D",1,0)
index by SOP Instance UID
"^DD",2006.5752,2006.5752,32,1,2,"DT")
3080425
"^DD",2006.5752,2006.5752,32,3)
Enter the image's sop instance uid; answer must be 1-64 characters in length.
"^DD",2006.5752,2006.5752,32,21,0)
^.001^2^2^3090505^^^^
"^DD",2006.5752,2006.5752,32,21,1,0)
The image's sop instance uid is obtained in DICOM tag 0008,0018 and
"^DD",2006.5752,2006.5752,32,21,2,0)
0004,1511 from the DICOM Object file that is to be imported.
"^DD",2006.5752,2006.5752,32,"DT")
3080425
"^DD",2006.5757,2006.5757,0)
FIELD^^3^3
"^DD",2006.5757,2006.5757,0,"DDA")
N
"^DD",2006.5757,2006.5757,0,"DT")
3090420
"^DD",2006.5757,2006.5757,0,"IX","B",2006.5757,.01)

"^DD",2006.5757,2006.5757,0,"IX","C",2006.5757,2)

"^DD",2006.5757,2006.5757,0,"IX","D",2006.5757,3)

"^DD",2006.5757,2006.5757,0,"NM","DICOM RADIOLOGY PROCEDURE MODIFIERS")

"^DD",2006.5757,2006.5757,.01,0)
RAD PROC MOD NAME^RF^^0;1^K:$L(X)>30!($L(X)<1)!'(X'?1P.E) X
"^DD",2006.5757,2006.5757,.01,1,0)
^.1
"^DD",2006.5757,2006.5757,.01,1,1,0)
2006.5757^B
"^DD",2006.5757,2006.5757,.01,1,1,1)
S ^MAGDICOM(2006.5757,"B",$E(X,1,30),DA)=""
"^DD",2006.5757,2006.5757,.01,1,1,2)
K ^MAGDICOM(2006.5757,"B",$E(X,1,30),DA)
"^DD",2006.5757,2006.5757,.01,3)
Enter the procedure modifier; answer must be 1-30 characters in length.
"^DD",2006.5757,2006.5757,.01,21,0)
^.001^5^5^3090505^^^^
"^DD",2006.5757,2006.5757,.01,21,1,0)
This field is a copy of the procedure modifier NAME (#.01) field of file
"^DD",2006.5757,2006.5757,.01,21,2,0)
PROCEDURE MODIFIERS (#71.2).
"^DD",2006.5757,2006.5757,.01,21,3,0)
 
"^DD",2006.5757,2006.5757,.01,21,4,0)
The DICOM Gateway's store redundant information in case the VistA connection
"^DD",2006.5757,2006.5757,.01,21,5,0)
is lost.
"^DD",2006.5757,2006.5757,.01,"DT")
3080505
"^DD",2006.5757,2006.5757,2,0)
RAD PROC MOD IEN^P71.2'^RAMIS(71.2,^0;2^Q
"^DD",2006.5757,2006.5757,2,1,0)
^.1
"^DD",2006.5757,2006.5757,2,1,1,0)
2006.5757^C
"^DD",2006.5757,2006.5757,2,1,1,1)
S ^MAGDICOM(2006.5757,"C",$E(X,1,30),DA)=""
"^DD",2006.5757,2006.5757,2,1,1,2)
K ^MAGDICOM(2006.5757,"C",$E(X,1,30),DA)
"^DD",2006.5757,2006.5757,2,3)
Select the procedure modifier.
"^DD",2006.5757,2006.5757,2,21,0)
^.001^2^2^3090506^^^^
"^DD",2006.5757,2006.5757,2,21,1,0)
The Importer will use this procedure's value when placing an order on 
"^DD",2006.5757,2006.5757,2,21,2,0)
Vista from the DICOM Gateway. 
"^DD",2006.5757,2006.5757,2,"DT")
3090420
"^DD",2006.5757,2006.5757,3,0)
TYPE OF IMAGING^P79.2'^RA(79.2,^0;3^Q
"^DD",2006.5757,2006.5757,3,1,0)
^.1
"^DD",2006.5757,2006.5757,3,1,1,0)
2006.5757^D
"^DD",2006.5757,2006.5757,3,1,1,1)
S ^MAGDICOM(2006.5757,"D",$E(X,1,30),DA)=""
"^DD",2006.5757,2006.5757,3,1,1,2)
K ^MAGDICOM(2006.5757,"D",$E(X,1,30),DA)
"^DD",2006.5757,2006.5757,3,1,1,"DT")
3090119
"^DD",2006.5757,2006.5757,3,3)
Select the IMAGING TYPE for the procedure.
"^DD",2006.5757,2006.5757,3,21,0)
^.001^2^2^3090505^^^^
"^DD",2006.5757,2006.5757,3,21,1,0)
The Importer will use the corresponding TYPE OF IMAGING for the selected
"^DD",2006.5757,2006.5757,3,21,2,0)
procedure when placing an order on VistA from the DICOM Gateway.
"^DD",2006.5757,2006.5757,3,"DT")
3090420
"^DD",2006.5758,2006.5758,0)
FIELD^^9^9
"^DD",2006.5758,2006.5758,0,"DDA")
N
"^DD",2006.5758,2006.5758,0,"DT")
3090902
"^DD",2006.5758,2006.5758,0,"IX","B",2006.5758,.01)

"^DD",2006.5758,2006.5758,0,"NM","DICOM RADIOLOGY PROCEDURES")

"^DD",2006.5758,2006.5758,.01,0)
RADIOLOGY PROCEDURE NAME^F^^0;1^K:$L(X)>60!($L(X)<1)!'(X'?1P.E) X
"^DD",2006.5758,2006.5758,.01,1,0)
^.1
"^DD",2006.5758,2006.5758,.01,1,1,0)
2006.5758^B
"^DD",2006.5758,2006.5758,.01,1,1,1)
S ^MAGDICOM(2006.5758,"B",$E(X,1,30),DA)=""
"^DD",2006.5758,2006.5758,.01,1,1,2)
K ^MAGDICOM(2006.5758,"B",$E(X,1,30),DA)
"^DD",2006.5758,2006.5758,.01,3)
Enter the procedure name; the first character should not be a punctuation mark and must be 1-60 characters in length.
"^DD",2006.5758,2006.5758,.01,21,0)
^.001^5^5^3090506^^^^
"^DD",2006.5758,2006.5758,.01,21,1,0)
This field is a copy of the RADIOLOGY PROCEDURE NAME (#.01) field of
"^DD",2006.5758,2006.5758,.01,21,2,0)
file RAD/NUC MED PROCEDURES (#71). 
"^DD",2006.5758,2006.5758,.01,21,3,0)
 
"^DD",2006.5758,2006.5758,.01,21,4,0)
The DICOM Gateway stores redundant information so that image processing
"^DD",2006.5758,2006.5758,.01,21,5,0)
can continue when a connection to VistA is lost.
"^DD",2006.5758,2006.5758,.01,"DT")
3090419
"^DD",2006.5758,2006.5758,2,0)
RADIOLOGY PROCEDURE IEN^P71'^RAMIS(71,^0;2^Q
"^DD",2006.5758,2006.5758,2,3)
Select the Radiology procedure.
"^DD",2006.5758,2006.5758,2,21,0)
^.001^1^1^3090506^^^^
"^DD",2006.5758,2006.5758,2,21,1,0)
This is the radiology procedure for the image being processed.
"^DD",2006.5758,2006.5758,2,"DT")
3090419
"^DD",2006.5758,2006.5758,3,0)
PROCEDURE TYPE^S^B:BROAD;D:DETAILED;S:SERIES;P:PARENT;^0;3^Q
"^DD",2006.5758,2006.5758,3,3)
Select the type of procedure.
"^DD",2006.5758,2006.5758,3,21,0)
^.001^2^2^3090506^^^^
"^DD",2006.5758,2006.5758,3,21,1,0)
This field is a copy of the TYPE OF PROCEDURE field (#6) as defined 
"^DD",2006.5758,2006.5758,3,21,2,0)
for the procedure in RAD/NUC MED PROCEDURES file (#71).
"^DD",2006.5758,2006.5758,3,"DT")
3090408
"^DD",2006.5758,2006.5758,4,0)
CPT CODE^F^^0;4^K:$L(X)>5!($L(X)<5) X
"^DD",2006.5758,2006.5758,4,3)
CPT CODE must be 5 characters in length.
"^DD",2006.5758,2006.5758,4,21,0)
^.001^6^6^3090506^^^^
"^DD",2006.5758,2006.5758,4,21,1,0)
This is the CPT CODE defined for the procedure in file RAD/NUC MED 
"^DD",2006.5758,2006.5758,4,21,2,0)
PROCEDURE (#71).  The information is obtained from field CPT CODE (#9)
"^DD",2006.5758,2006.5758,4,21,3,0)
in the RAD/NUC MED PROCEDURE FILE (#71).  Field #9 in file #71 is a 
"^DD",2006.5758,2006.5758,4,21,4,0)
pointer to the CPT CODE file (#81); however the remote procedure
"^DD",2006.5758,2006.5758,4,21,5,0)
called to update this file (#2006.5758) will interpret the field and
"^DD",2006.5758,2006.5758,4,21,6,0)
bring in the actual CPT CODE value instead of the pointer value.
"^DD",2006.5758,2006.5758,4,"DT")
3090420
"^DD",2006.5758,2006.5758,5,0)
IMAGING TYPE^P79.2'^RA(79.2,^0;5^Q
"^DD",2006.5758,2006.5758,5,3)
Select the procedure's TYPE OF IMAGING.
"^DD",2006.5758,2006.5758,5,21,0)
^.001^12^12^3090506^^^^
"^DD",2006.5758,2006.5758,5,21,1,0)
This is the TYPE OF IMAGING as defined for the procedure in file
"^DD",2006.5758,2006.5758,5,21,2,0)
RAD/NUC MED PROCEDURES (#71). 
"^DD",2006.5758,2006.5758,5,21,3,0)
 
"^DD",2006.5758,2006.5758,5,21,4,0)
The information is obtained from field TYPE OF IMAGING (#12) in file
"^DD",2006.5758,2006.5758,5,21,5,0)
RAD/NUC MED PROCEDRUES (#71).  
"^DD",2006.5758,2006.5758,5,21,6,0)
 
"^DD",2006.5758,2006.5758,5,21,7,0)
The remote procedure that updates this file (#2006.5758) will marry the TYPE OF
"^DD",2006.5758,2006.5758,5,21,8,0)
IMAGING value for the procedure to the TYPE OF IMAGING value for the
"^DD",2006.5758,2006.5758,5,21,9,0)
appropriate OUTSIDE IMAGING LOCATION in file (2006.5759).
"^DD",2006.5758,2006.5758,5,21,10,0)
 
"^DD",2006.5758,2006.5758,5,21,11,0)
For each outside location it should have a TYPE OF IMAGING and for
"^DD",2006.5758,2006.5758,5,21,12,0)
each TYPE OF IMAGING a set of radiology procedures must be defined.
"^DD",2006.5758,2006.5758,5,"DT")
3090420
"^DD",2006.5758,2006.5758,6,0)
INACTIVE DATE^D^^0;6^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",2006.5758,2006.5758,6,3)
Enter the inactive date for the procedure.
"^DD",2006.5758,2006.5758,6,21,0)
^.001^2^2^3090506^^^^
"^DD",2006.5758,2006.5758,6,21,1,0)
This is a copy of the INACTIVATION DATE field (#100) as identified for the
"^DD",2006.5758,2006.5758,6,21,2,0)
procedure in file RAD/NUC MED PROCEDURES file (#71).
"^DD",2006.5758,2006.5758,6,"DT")
3080505
"^DD",2006.5758,2006.5758,7,0)
OUTSIDE IMAGE LOCATION^P2006.5759'^MAGD(2006.5759,^0;7^Q
"^DD",2006.5758,2006.5758,7,3)
Select the outside location.
"^DD",2006.5758,2006.5758,7,21,0)
^^1^1^3090506^
"^DD",2006.5758,2006.5758,7,21,1,0)
This is the outside image location to be used for this procedure.
"^DD",2006.5758,2006.5758,7,"DT")
3090419
"^DD",2006.5758,2006.5758,8,0)
HOSPITAL LOCATION IEN^P44'^SC(^0;8^Q
"^DD",2006.5758,2006.5758,8,3)
Enter the Hospital Location for the OUTSIDE IMAGING LOCATION.
"^DD",2006.5758,2006.5758,8,21,0)
^.001^2^2^3090902^^^^
"^DD",2006.5758,2006.5758,8,21,1,0)
This is a copy of the HOSPITAL LOCATION field (#3) as identified for the
"^DD",2006.5758,2006.5758,8,21,2,0)
outside location in file OUTSIDE IMAGING LOCATION (#2006.5759).
"^DD",2006.5758,2006.5758,8,"DT")
3090902
"^DD",2006.5758,2006.5758,9,0)
HOSPITAL LOCATION NAME^RF^^0;9^K:$L(X)>30!($L(X)<2)!'(X'?1P.E) X
"^DD",2006.5758,2006.5758,9,3)
Answer must be 2-30 characters in length.
"^DD",2006.5758,2006.5758,9,21,0)
^^1^1^3090902^
"^DD",2006.5758,2006.5758,9,21,1,0)
This is the name [copy of the NAME (#.01) field of the HOSPITAL LOCATION (#44) file] associated with the HOSPITAL LOCATION IEN (#8) field of this file.
"^DD",2006.5758,2006.5758,9,"DT")
3090902
"^DD",2006.5759,2006.5759,0)
FIELD^^4^4
"^DD",2006.5759,2006.5759,0,"DDA")
N
"^DD",2006.5759,2006.5759,0,"DT")
3090421
"^DD",2006.5759,2006.5759,0,"IX","B",2006.5759,.01)

"^DD",2006.5759,2006.5759,0,"IX","C",2006.5759,4)

"^DD",2006.5759,2006.5759,0,"NM","OUTSIDE IMAGING LOCATION")

"^DD",2006.5759,2006.5759,0,"PT",2006.5758,7)

"^DD",2006.5759,2006.5759,.01,0)
IMAGING LOCATION^R*P79.1'^RA(79.1,^0;1^S DIC("S")="I $P(^(0),U,21)=2" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",2006.5759,2006.5759,.01,1,0)
^.1
"^DD",2006.5759,2006.5759,.01,1,1,0)
2006.5759^B
"^DD",2006.5759,2006.5759,.01,1,1,1)
S ^MAGD(2006.5759,"B",$E(X,1,30),DA)=""
"^DD",2006.5759,2006.5759,.01,1,1,2)
K ^MAGD(2006.5759,"B",$E(X,1,30),DA)
"^DD",2006.5759,2006.5759,.01,1,2,0)
^^TRIGGER^2006.5759^2
"^DD",2006.5759,2006.5759,.01,1,2,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^MAGD(2006.5759,D0,0)):^(0),1:"") S X=$P(Y(1),U,2),X=X S DIU=X K Y X ^DD(2006.5759,.01,1,2,1.1) X ^DD(2006.5759,.01,1,2,1.4)
"^DD",2006.5759,2006.5759,.01,1,2,1.1)
S X=DIV S I(0,0)=$G(D0),D0=DIV S:'D0!'$D(^RA(79.1,+D0,0)) D0=-1 S Y(102)=$S($D(^RA(79.1,D0,0)):^(0),1:""),Y(101)=$G(X) S X=$P(Y(102),U,6),X=X S X=X S D0=I(0,0)
"^DD",2006.5759,2006.5759,.01,1,2,1.4)
S DIH=$G(^MAGD(2006.5759,DIV(0),0)),DIV=X S $P(^(0),U,2)=DIV,DIH=2006.5759,DIG=2 D ^DICR
"^DD",2006.5759,2006.5759,.01,1,2,2)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^MAGD(2006.5759,D0,0)):^(0),1:"") S X=$P(Y(1),U,2),X=X S DIU=X K Y S X="" S DIH=$G(^MAGD(2006.5759,DIV(0),0)),DIV=X S $P(^(0),U,2)=DIV,DIH=2006.5759,DIG=2 D ^DICR
"^DD",2006.5759,2006.5759,.01,1,2,3)
Field IMAGING TYPE will be populated with the identical value it has in Radiology's file IMAGING LOCATION (#79.1) for the corresponding IMAGING LOCATION entry.
"^DD",2006.5759,2006.5759,.01,1,2,"CREATE VALUE")
IMAGING LOCATION:INTERNAL(#6)
"^DD",2006.5759,2006.5759,.01,1,2,"DELETE VALUE")
@
"^DD",2006.5759,2006.5759,.01,1,2,"DT")
3090119
"^DD",2006.5759,2006.5759,.01,1,2,"FIELD")
IMAGING TYPE
"^DD",2006.5759,2006.5759,.01,1,3,0)
^^TRIGGER^2006.5759^3
"^DD",2006.5759,2006.5759,.01,1,3,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^MAGD(2006.5759,D0,0)):^(0),1:"") S X=$P(Y(1),U,3),X=X S DIU=X K Y X ^DD(2006.5759,.01,1,3,1.1) X ^DD(2006.5759,.01,1,3,1.4)
"^DD",2006.5759,2006.5759,.01,1,3,1.1)
S X=DIV S I(0,0)=$G(D0),D0=DIV S:'D0!'$D(^RA(79.1,+D0,0)) D0=-1 S Y(102)=$S($D(^RA(79.1,D0,0)):^(0),1:""),Y(101)=$G(X) S X=$P(Y(102),U,1),X=X S X=X S D0=I(0,0)
"^DD",2006.5759,2006.5759,.01,1,3,1.4)
S DIH=$G(^MAGD(2006.5759,DIV(0),0)),DIV=X S $P(^(0),U,3)=DIV,DIH=2006.5759,DIG=3 D ^DICR
"^DD",2006.5759,2006.5759,.01,1,3,2)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^MAGD(2006.5759,D0,0)):^(0),1:"") S X=$P(Y(1),U,3),X=X S DIU=X K Y S X="" S DIH=$G(^MAGD(2006.5759,DIV(0),0)),DIV=X S $P(^(0),U,3)=DIV,DIH=2006.5759,DIG=3 D ^DICR
"^DD",2006.5759,2006.5759,.01,1,3,3)
Field HOSPITAL LOC will be populated with the identical value it has in Radiology's file IMAGING LOCATION (#79.1) for the corresponding IMAGING LOCATION entry.
"^DD",2006.5759,2006.5759,.01,1,3,"CREATE VALUE")
IMAGING LOCATION:INTERNAL(LOCATION)
"^DD",2006.5759,2006.5759,.01,1,3,"DELETE VALUE")
@
"^DD",2006.5759,2006.5759,.01,1,3,"DT")
3090119
"^DD",2006.5759,2006.5759,.01,1,3,"FIELD")
HOSPITAL LOC
"^DD",2006.5759,2006.5759,.01,1,4,0)
^^TRIGGER^2006.5759^4
"^DD",2006.5759,2006.5759,.01,1,4,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^MAGD(2006.5759,D0,0)):^(0),1:"") S X=$P(Y(1),U,4),X=X S DIU=X K Y X ^DD(2006.5759,.01,1,4,1.1) X ^DD(2006.5759,.01,1,4,1.4)
"^DD",2006.5759,2006.5759,.01,1,4,1.1)
S X=DIV S I(0,0)=$G(D0),D0=DIV S:'D0!'$D(^RA(79.1,+D0,0)) D0=-1 S Y(102)=$S($D(^RA(79.1,D0,"DIV")):^("DIV"),1:""),Y(101)=$G(X) S X=$P(Y(102),U,1),X=X S X=X S D0=I(0,0)
"^DD",2006.5759,2006.5759,.01,1,4,1.4)
S DIH=$G(^MAGD(2006.5759,DIV(0),0)),DIV=X S $P(^(0),U,4)=DIV,DIH=2006.5759,DIG=4 D ^DICR
"^DD",2006.5759,2006.5759,.01,1,4,2)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^MAGD(2006.5759,D0,0)):^(0),1:"") S X=$P(Y(1),U,4),X=X S DIU=X K Y S X="" S DIH=$G(^MAGD(2006.5759,DIV(0),0)),DIV=X S $P(^(0),U,4)=DIV,DIH=2006.5759,DIG=4 D ^DICR
"^DD",2006.5759,2006.5759,.01,1,4,3)
Field INSTITUTION will be populated with the identical value is has in Radiology's file IMAGING LOCATION (#79.1) for the corresponding IMAGING LOCATION entry.
"^DD",2006.5759,2006.5759,.01,1,4,"CREATE VALUE")
IMAGING LOCATION:INTERNAL(#25)
"^DD",2006.5759,2006.5759,.01,1,4,"DELETE VALUE")
@
"^DD",2006.5759,2006.5759,.01,1,4,"DT")
3090119
"^DD",2006.5759,2006.5759,.01,1,4,"FIELD")
INSTITUTION
"^DD",2006.5759,2006.5759,.01,3)
Enter an IMAGING LOCATION entry defined as 'NO CREDIT'.
"^DD",2006.5759,2006.5759,.01,12)
Permits selection to be on locations with a credit method of 'No Credit".
"^DD",2006.5759,2006.5759,.01,12.1)
S DIC("S")="I $P(^(0),U,21)=2"
"^DD",2006.5759,2006.5759,.01,21,0)
^.001^6^6^3090423^^^^
"^DD",2006.5759,2006.5759,.01,21,1,0)
This is the 'No Credit' Radiology location to be used by the DICOM Gateways
"^DD",2006.5759,2006.5759,.01,21,2,0)
to collect imported 'outside' images and place or update a Radiology order
"^DD",2006.5759,2006.5759,.01,21,3,0)
on VistA.
"^DD",2006.5759,2006.5759,.01,21,4,0)
 
"^DD",2006.5759,2006.5759,.01,21,5,0)
The field has a screen to only allow entries that have been defined as
"^DD",2006.5759,2006.5759,.01,21,6,0)
'No Credit' in Radiology's IMAGING LOCATION file (#79.1).
"^DD",2006.5759,2006.5759,.01,"DT")
3090421
"^DD",2006.5759,2006.5759,2,0)
IMAGING TYPE^P79.2'^RA(79.2,^0;2^Q
"^DD",2006.5759,2006.5759,2,1,0)
^.1^^0
"^DD",2006.5759,2006.5759,2,3)
Select the Imaging type for this location.
"^DD",2006.5759,2006.5759,2,5,1,0)
2006.5759^.01^2
"^DD",2006.5759,2006.5759,2,9)
^
"^DD",2006.5759,2006.5759,2,21,0)
^.001^1^1^3090423^^^^
"^DD",2006.5759,2006.5759,2,21,1,0)
The value of this field is the associated imaging type (e.g. VASCULAR LAB) for the outside imaging location. 
"^DD",2006.5759,2006.5759,2,"DT")
3080815
"^DD",2006.5759,2006.5759,3,0)
HOSPITAL LOCATION^P44'^SC(^0;3^Q
"^DD",2006.5759,2006.5759,3,3)
Select the hospital location for this location.
"^DD",2006.5759,2006.5759,3,5,1,0)
2006.5759^.01^3
"^DD",2006.5759,2006.5759,3,9)
^
"^DD",2006.5759,2006.5759,3,21,0)
^.001^2^2^3090423^^^^
"^DD",2006.5759,2006.5759,3,21,1,0)
The value for this field is the hospital location (e.g. Radiology clinic) pertaining to the
"^DD",2006.5759,2006.5759,3,21,2,0)
outside imaging location.
"^DD",2006.5759,2006.5759,3,"DT")
3080115
"^DD",2006.5759,2006.5759,4,0)
INSTITUTION^P4'^DIC(4,^0;4^Q
"^DD",2006.5759,2006.5759,4,1,0)
^.1
"^DD",2006.5759,2006.5759,4,1,1,0)
2006.5759^C
"^DD",2006.5759,2006.5759,4,1,1,1)
S ^MAGD(2006.5759,"C",$E(X,1,30),DA)=""
"^DD",2006.5759,2006.5759,4,1,1,2)
K ^MAGD(2006.5759,"C",$E(X,1,30),DA)
"^DD",2006.5759,2006.5759,4,1,1,"DT")
3080115
"^DD",2006.5759,2006.5759,4,3)
Select the institution pertaining to this location.
"^DD",2006.5759,2006.5759,4,5,1,0)
2006.5759^.01^4
"^DD",2006.5759,2006.5759,4,9)
^
"^DD",2006.5759,2006.5759,4,21,0)
^.001^2^2^3090423^^^^
"^DD",2006.5759,2006.5759,4,21,1,0)
The value of this field is the institution related to the outside imaging
"^DD",2006.5759,2006.5759,4,21,2,0)
location. Within a consolidated database, an institution could be an Outpatient clinic.
"^DD",2006.5759,2006.5759,4,"DT")
3080815
"^DD",2006.588,2006.588,0)
FIELD^^3^3
"^DD",2006.588,2006.588,0,"DDA")
N
"^DD",2006.588,2006.588,0,"DT")
3080505
"^DD",2006.588,2006.588,0,"IX","B",2006.588,.01)

"^DD",2006.588,2006.588,0,"NM","APPLICATION ENTITY TITLE")

"^DD",2006.588,2006.588,.01,0)
APPLICATION ENTITY TITLE^RF^^0;1^K:$L(X)>30!($L(X)<1)!'(X'?1P.E) X
"^DD",2006.588,2006.588,.01,1,0)
^.1
"^DD",2006.588,2006.588,.01,1,1,0)
2006.588^B
"^DD",2006.588,2006.588,.01,1,1,1)
S ^MAGDICOM(2006.588,"B",$E(X,1,30),DA)=""
"^DD",2006.588,2006.588,.01,1,1,2)
K ^MAGDICOM(2006.588,"B",$E(X,1,30),DA)
"^DD",2006.588,2006.588,.01,3)
Enter the device's AE Title, answer must be 1-30 characters in length.
"^DD",2006.588,2006.588,.01,21,0)
^.001^9^9^3090506^^^^
"^DD",2006.588,2006.588,.01,21,1,0)
The value of this field will be used during the DICOM negotiation request.
"^DD",2006.588,2006.588,.01,21,2,0)
 
"^DD",2006.588,2006.588,.01,21,3,0)
The AE_TITLE.DIC is used to map the Called Application Entity Title of a 
"^DD",2006.588,2006.588,.01,21,4,0)
DICOM negotiation request to the alias that identifies the VistA Application
"^DD",2006.588,2006.588,.01,21,5,0)
Entity Title name for the SCP.  This is used for looking up acceptable 
"^DD",2006.588,2006.588,.01,21,6,0)
presentation contexts in SCP_LIST.DIC.  The Called Application Entity Title
"^DD",2006.588,2006.588,.01,21,7,0)
for a DICOM request must either be the VistA Application Entity Title name
"^DD",2006.588,2006.588,.01,21,8,0)
in file SCP_LIST.DIC or else one defined in AE_Title.DIC as an alias for 
"^DD",2006.588,2006.588,.01,21,9,0)
the VistA one. Otherwise, the DICOM negotiation request will be rejected.
"^DD",2006.588,2006.588,.01,"DT")
3080505
"^DD",2006.588,2006.588,2,0)
ALIAS^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",2006.588,2006.588,2,3)
Enter an abbreviated name for the Application Entity Title; answer must be 1-30 characters in length.
"^DD",2006.588,2006.588,2,21,0)
^.001^1^1^3090423^^^^
"^DD",2006.588,2006.588,2,21,1,0)
This field is optional and it stores the alias for the Application Entity Title.
"^DD",2006.588,2006.588,2,"DT")
3080505
"^DD",2006.588,2006.588,3,0)
SITE NAME^F^^0;3^K:$L(X)>30!($L(X)<1) X
"^DD",2006.588,2006.588,3,3)
Enter the site for the device, answer must be 1-30 characters in length.
"^DD",2006.588,2006.588,3,21,0)
^.001^3^3^3090423^^^^
"^DD",2006.588,2006.588,3,21,1,0)
This field stores the site that has the device with the Application Entity Title.
"^DD",2006.588,2006.588,3,21,2,0)
For example: "Walter Reed AMC" could be the site name for the Application
"^DD",2006.588,2006.588,3,21,3,0)
Entity "OSXWRAMC".
"^DD",2006.588,2006.588,3,"DT")
3080505
"^DIC",2006.5751,2006.5751,0)
DICOM OBJECTS TO BE IMPORTED^2006.5751
"^DIC",2006.5751,2006.5751,0,"GL")
^MAGDICOM(2006.5751,
"^DIC",2006.5751,2006.5751,"%",0)
^1.005^^
"^DIC",2006.5751,2006.5751,"%D",0)
^1.001^6^6^3090505^^^
"^DIC",2006.5751,2006.5751,"%D",1,0)
The DICOM OBJECTS TO BE IMPORTED file (#2006.5751) resides on the DICOM
"^DIC",2006.5751,2006.5751,"%D",2,0)
Gateway and tracks DICOM objects that have been received and may be imported.
"^DIC",2006.5751,2006.5751,"%D",3,0)
 
"^DIC",2006.5751,2006.5751,"%D",4,0)
Entries are made to this file by reading the DICOM Object files and recording the 
"^DIC",2006.5751,2006.5751,"%D",5,0)
raw data elements from the file.  The information is displayed in listing
"^DIC",2006.5751,2006.5751,"%D",6,0)
which are selectable for importing into the VistA database.
"^DIC",2006.5751,"B","DICOM OBJECTS TO BE IMPORTED",2006.5751)

"^DIC",2006.5752,2006.5752,0)
IMPORTABLE DICOM OBJECTS^2006.5752
"^DIC",2006.5752,2006.5752,0,"GL")
^MAGD(2006.5752,
"^DIC",2006.5752,2006.5752,"%",0)
^1.005^^
"^DIC",2006.5752,2006.5752,"%D",0)
^1.001^8^8^3090522^^^^
"^DIC",2006.5752,2006.5752,"%D",1,0)
The IMPORTABLE DICOM OBJECTS file (#2006.5752) is on the VistA HIS and tracks the importable DICOM objects that are on each of the different the DICOM Gateways.
"^DIC",2006.5752,2006.5752,"%D",2,0)
 
"^DIC",2006.5752,2006.5752,"%D",3,0)
This allows the site to see all importable DICOM objects from each of the
"^DIC",2006.5752,2006.5752,"%D",4,0)
site's DICOM Gateways. 
"^DIC",2006.5752,2006.5752,"%D",5,0)
 
"^DIC",2006.5752,2006.5752,"%D",6,0)
The information is obtained from DICOM Gateway's file DICOM OBJECTS TO BE
"^DIC",2006.5752,2006.5752,"%D",7,0)
IMPORTED (#2006.5751).  Information is periodically updated by a remote
"^DIC",2006.5752,2006.5752,"%D",8,0)
procedure call on the DICOM Gateways connecting to VistA. 
"^DIC",2006.5752,"B","IMPORTABLE DICOM OBJECTS",2006.5752)

"^DIC",2006.5757,2006.5757,0)
DICOM RADIOLOGY PROCEDURE MODIFIERS^2006.5757
"^DIC",2006.5757,2006.5757,0,"GL")
^MAGDICOM(2006.5757,
"^DIC",2006.5757,2006.5757,"%D",0)
^1.001^8^8^3090505^^^
"^DIC",2006.5757,2006.5757,"%D",1,0)
The DICOM RADIOLOGY PROCEDURE MODIFIERS file (#2006.5757) resides on the
"^DIC",2006.5757,2006.5757,"%D",2,0)
DICOM Gateway.  It contains the list of Radiology procedure modifiers 
"^DIC",2006.5757,2006.5757,"%D",3,0)
that may be used when placing orders for VistA on the DICOM Gateway. 
"^DIC",2006.5757,2006.5757,"%D",4,0)
 
"^DIC",2006.5757,2006.5757,"%D",5,0)
This file is periodically updated on the Gateway by a remote procedure
"^DIC",2006.5757,2006.5757,"%D",6,0)
call to VistA to read file Radiology's PROCEDURE MODIFIERS (#71.2).
"^DIC",2006.5757,2006.5757,"%D",7,0)
This allows the Gateway to continue processing if a VistA connections 
"^DIC",2006.5757,2006.5757,"%D",8,0)
is lost.
"^DIC",2006.5757,"B","DICOM RADIOLOGY PROCEDURE MODIFIERS",2006.5757)

"^DIC",2006.5758,2006.5758,0)
DICOM RADIOLOGY PROCEDURES^2006.5758
"^DIC",2006.5758,2006.5758,0,"GL")
^MAGDICOM(2006.5758,
"^DIC",2006.5758,2006.5758,"%D",0)
^1.001^9^9^3090506^^^^
"^DIC",2006.5758,2006.5758,"%D",1,0)
The DICOM RADIOLOGY PROCEDURES file (#2006.5758) contains the list of orderable radiology procedures, along with related data that is needed for the Importer to place orders on VistA.
"^DIC",2006.5758,2006.5758,"%D",2,0)
 
"^DIC",2006.5758,2006.5758,"%D",3,0)
This file resides on the DICOM Gateway and several of the fields will be
"^DIC",2006.5758,2006.5758,"%D",4,0)
redundantly storing the same information for pointer fields.  This is 
"^DIC",2006.5758,2006.5758,"%D",5,0)
required to continue image processing when a VistA connection is lost.
"^DIC",2006.5758,2006.5758,"%D",6,0)
 
"^DIC",2006.5758,2006.5758,"%D",7,0)
Information in this file is a combination of data from files RAD/NUC MED
"^DIC",2006.5758,2006.5758,"%D",8,0)
PROCEDUES (#71) and OUTSIDE IMAGE LOCATION (#2006.5759).  The data in this
"^DIC",2006.5758,2006.5758,"%D",9,0)
file will be periodically updated via a remote procedure file to VistA.
"^DIC",2006.5758,"B","DICOM RADIOLOGY PROCEDURES",2006.5758)

"^DIC",2006.5759,2006.5759,0)
OUTSIDE IMAGING LOCATION^2006.5759
"^DIC",2006.5759,2006.5759,0,"GL")
^MAGD(2006.5759,
"^DIC",2006.5759,2006.5759,"%",0)
^1.005^^0
"^DIC",2006.5759,2006.5759,"%D",0)
^1.001^6^6^3090506^^^
"^DIC",2006.5759,2006.5759,"%D",1,0)
Entries in this file are locations identified in Radiology's IMAGING LOCATION file (#79.1) for 
"^DIC",2006.5759,2006.5759,"%D",2,0)
entities that are non-credit locations.  These entries will be used by the DICOM Gateways during the 
"^DIC",2006.5759,2006.5759,"%D",3,0)
ordering process to assign a location to an 'unordered' Radiology study.  The DICOM Gateways 
"^DIC",2006.5759,2006.5759,"%D",4,0)
periodically download this file.
"^DIC",2006.5759,2006.5759,"%D",5,0)
 
"^DIC",2006.5759,2006.5759,"%D",6,0)
Use menu option 'Build Outside Imaging Location File' [MAG BUILD OUT LOC] to populate this file.
"^DIC",2006.5759,"B","OUTSIDE IMAGING LOCATION",2006.5759)

"^DIC",2006.588,2006.588,0)
APPLICATION ENTITY TITLE^2006.588
"^DIC",2006.588,2006.588,0,"GL")
^MAGDICOM(2006.588,
"^DIC",2006.588,2006.588,"%",0)
^1.005^^
"^DIC",2006.588,2006.588,"%D",0)
^^11^11^3090303^^
"^DIC",2006.588,2006.588,"%D",1,0)
The APPLICATION ENTITY TITLE file (2006.588) is used to map Application Entity Titles to aliases and descriptive names.  It is built from the entries in AETITLE.DIC.
"^DIC",2006.588,2006.588,"%D",2,0)
 
"^DIC",2006.588,2006.588,"%D",3,0)
The APPLICATION ENTITY TITLE file is used for two purposes.  When a DICOM Service Class 
"^DIC",2006.588,2006.588,"%D",4,0)
User (SCU) negotiates an association with VistA, it may present a Called Application Entity Title that is 
"^DIC",2006.588,2006.588,"%D",5,0)
different than one defined in the SCP_LIST.DIC.  The APPLICATION ENTITY TITLE file may 
"^DIC",2006.588,2006.588,"%D",6,0)
contain an entry for the SCU's Called Application Entity Title that maps it to one that is defined in 
"^DIC",2006.588,2006.588,"%D",7,0)
SCP_LIST.DIC. This is required in order for the association to be accepted.
"^DIC",2006.588,2006.588,"%D",8,0)
 
"^DIC",2006.588,2006.588,"%D",9,0)
The second purpose is to provide a mapping from the SCU's Calling Application Entity Title to a more 
"^DIC",2006.588,2006.588,"%D",10,0)
descriptive name, which help to identify it better.  In this case, if the SCU's Called Application Entity 
"^DIC",2006.588,2006.588,"%D",11,0)
Title is one that is defined in the SCP_LIST.DIC, the entry in the APPLICATION ENTITY TITLE file is optional.
"^DIC",2006.588,"B","APPLICATION ENTITY TITLE",2006.588)

**END**
**END**


****
****
