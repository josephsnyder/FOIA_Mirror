
=============================================================================
Run Date: MAY 31, 2011                     Designation: MAG*3*39
Package : MAG - IMAGING                       Priority: Mandatory
Version : 3        SEQ #75                      Status: Released
                  Compliance Date: JUL 01, 2011
=============================================================================

Associated patches: (v)MAG*3*46    <<= must be installed BEFORE `MAG*3*39'
                    (v)MAG*3*54    <<= must be installed BEFORE `MAG*3*39'
                    (v)MAG*3*81    <<= must be installed BEFORE `MAG*3*39'
                    (v)MAG*3*83    <<= must be installed BEFORE `MAG*3*39'

Subject: BACKGROUND PROCESSOR ENHANCEMENT II

Category: 
  - Data Dictionary
  - Routine
  - Other
  - Enhancement (Mandatory)

Description:
============

 Patch 39 contains several Background Processor maintenance changes to
 Queue Processing, RAID share organization and purging, security and
 maintenance of log files, mail messages, auto logon, GUI operations and
 the MAG Enterprise application.
  
 For details on new features in Patch 39, Installation Worksheet and
 client installation refer to the MAG3_0P39_Patch_Description.pdf 
 distributed with the patch.
  
 Distribution of Software
 ========================
  
 This patch can be downloaded from: 
  
 ftp.imaging.med.va.gov/Software/Released_Software/Mag3_0P39
  
 Installation instructions are included in this document.
  
 NOTE  Any late-breaking news about this patch will be found in a readme 
       file.  If present, this file will also be located in the MAG3_0P39
       directory.
  
 Terms of Use
 ============
  
 FDA regulations require that each Imaging software distribution be 
 documented and tracked by the VistA Imaging project.
  
 To receive this patch, sites must have a Site Agreement filed with and
 approved by the VistA Imaging Group.
  
 For information about the status of a Site Agreement, contact the VistA
 Imaging Distribution Manager (VHAVISiteFeedback@va.gov).
  
 Patch Contents
 ==============
  
 Software
 ========
  
 MAG3_0P39.KID - KIDS (Kernel Installation & Distribution System) package
                 to be installed on the VistA hospital information system.
  
 MAG3_0P39_BPSetup.exe - Installation file for BP Queue Processor, 
                         Verifier and Purge client software to be 
                         installed on a server class machine.
  
 Documentation 
 =============
  
 MAG3_0P39_Patch_Description.pdf - Patch description and installation
                                   instructions.
  
 MAG_BP_User_Manual.pdf - Background Processor User Manual.
  
   Note: The Verifier Manual is obsolete. Its content is in the
         rewritten BP User Manual.
  
 MAG_Storage_Utilities_User_Manual.pdf VistA Imaging System Storage
                                       Utilities User Manual
  
   Note: References to the Verifier Manual have been updated to refer to 
         the Verifier Chapter in teh rewritten BP User Manual.
  
 MAG3_0P39_Install_Guide_Changes.pdf   VistA Imaging System Installation
                                       Guide Change Pages
  
 MAG3_0P39_Security_Guide_Changes.pdf  VistA Imaging System Security Guide
                                       Change Pages
  
 MAG3_0P39_Technical Manual_Changes.pdf   VistA Imaging System Technical
                                          Manual Change Pages
   
   Note: Download a locally approved version of Acrobat Reader to view
         the PDFs. 
  
 Required Patches
 ================
  
 Before Patch 39 is installed, the following patch must be installed: 
  
   MAG*3.0*81
  
 For a list of all released Imaging (MAG) patches, refer to the 
 patch_list.txt file available on the Imaging FTP server (go to 
 ftp://ftp.imaging.med.va.gov, and then navigate to the 
 \Docs\Imaging_Docs_Latest folder).
  
 Test Sites
 ==========
  
 The following sites are test sites for this patch:
  
 * Atlanta, GA (Large)
 * Charleston, SC (Large)
 * Fayetteville, NC (Large)
 * Lebanon, PA (Medium)
 * Philadelphia, PA (Large)
 * Puget Sound, WA (Integrated, Large)
 * White River Junction, NH (Medium)
  
 Remedy Entries
 ==============
  
 67817   ATG-1203-31258  Vista email groups for emergency and normal 
         problems
  
 67890   ROS-0204-52120  Request assistance to review first Verifier run 
         for Roseburg [Purge will not stop by clicking the "X  in the title
         bar of the Purge]
  
 68156   NHM-0804-10131  Error on background processor
         [SetFile Time failure]
  
 84646   File 2006.95 (Image Access Log) is missing the "AC" Xref
         [File 2006.95 (Image Access Log) is missing the "AC  cross 
         reference]
  
 140594  Background processor, VHANOLBGP,  is down
         [Auto Write Update OFF. Loss of network connectivity to shares
         causes this trap ($ZE=<DIVIDE>CHGSERV+21^MAGQBUT)]
  
 154535  Need assistance with Network Location file cleanup
         [Network Location entries with duplicate PHYSICAL REFS]
  
 207347  Need help with results from Verifier
         [Lab Autopsy entries incorrectly reported by Verifier]
  
 208849  Background Processor error
         [Problems with Background Processor and Broker disconnects]
  
 212371  Connection to VistA Lost:
         [Problems with Background Processor and Broker disconnects]
  
 237287  Background Processor - error
         [Problems with Background Processor and Broker disconnects]
  
 246417  Invalid operations pointer
         [Problems with Background Processor and Broker disconnects]
  
 265026  Background Processor Issue
         [Problems with Background Processor and Broker disconnects]
  
 302072  Losing Connectivity to VistA
         [Problems with Background Processor and Broker disconnects]
  
 302691  BGP has stop running several time over the last 2 week
         [Problems with Background Processor and Broker disconnects]
  
 404647  Purge on RAID not freeing up any space...down to 5.5%
  
 417519  Cannot purge
  
 433867  Queues Not "Zeroed"
  
 454482  Purge log question/issue
  
 NSR and Enhancement Request Entries
 ===================================
  
 The following NSR (New Service Request) and enhancement request are
 addressed in this patch.
  
 NSR 20070515:   VistA Imaging Storage
  
 Remedy 67817:   Mail group assignments based on type of error 
  
 Patch 39 Changes
 ================
  
 For information on the changes included in this patch refer to the 
 MAG3_0P39_Patch_Description.pdf document distributed with the patch.
  
 VistA System KIDS Summary
 =========================
  
 Patch 39 includes a KIDS package to be installed on the VistA System.
  
 Data Dictionaries
 =================
  
 The following file is being deleted in this patch: 
  
   JUKEBOX file (#2006.032) has been removed. The NETWORK LOCATION FILE 
   (#2005.2) will be referenced to get jukebox information.
  
 The following files are modified in this patch.  For details on the
 changes refer to the MAG3_0P39_Patch_Description.pdf document distributed
 with the patch.
  
   NETWORK LOCATION file (#2005.2) 
   IMAGE ACCESS LOG (#2006.95)
   IMAGING SITE PARAMETERS (#2006.1)
   IMAGE BACKGROUND QUEUE POINTER file (#2006.031)
  
   The BP WORKSTATIONS file (#2006.8) is renamed during the post 
   installation to BP SERVERS and has new fields.
  
 Security Keys
 =============
  
 There are no new or modified security keys included in this patch.
  
 Remote Procedures
 =================
  
 The following remote procedures are added in this patch: 
  
   MAG FIELD VALIDATE
   MAG KEY VALIDATE
   MAGQ ADD RAID GROUP
   MAGQ BP UAT
   MAGQ DEL NLOC
   MAGQ ELOGR
   MAGQ FINDC
   MAGQ QRNGE
  
 The following remote procedures are removed in this patch:
  
   MAGQ IRP GETNEXT
   MAGQ JBP
   MAGQ REA
   MAGQ REA UPDATE
   MAGQ SLAD
   MAGQB PURNUL
   MAGQBP CHKN
  
 The following remote procedures are modified in this patch:
  
   MAGQ ALL SERVER
   MAGQ DFNIQ
   MAGQ FS CHNGE
   MAGQ FTYPE
   MAGQ JBQUE
   MAGQ JBSCN
   MAGQ QCNT
   MAGQB QUEDEL
   MAGQBP ALL SHARES
   MAGQBP FREF
  
 Menu Options
 ============
  
 A new menu option, Monitor Background Processor Activity [MAGQ BPMONITOR]
 has been added. This schedulable menu option is used to monitor BP 
 activities.  
  
 Recommendation: Schedule this task to run every 10 to 15 minutes
 (site configurable).
  
 The new option will:
  
 * Monitor the processing activities on each BP server. This activity 
   can be scheduled using the Schedule/Unschedule Options [XUTM SCHEDULE]. 
  
 * Handle all the entries that exist in the BP SERVERS file (#2006.8) 
   and the BP queues assigned to each server.  If xxx minutes, which
   is site specific, have transpired since processing the last queue
   and there is another queue to be processed, then a MailMan message
   with subject text "VI_BP_Queue_Processor_failure  will be sent.  
   The recipients and frequency of the mail message is determined by
   the parameters in the IMAGING SITE PARAMETERS file (#2006.1) BP
   MAIL MESSAGE field (#66).
  
 Templates
 =========
  
 There are no new or modified templates included in this patch.
  
 Installation
 ============
  
 This patch is to be installed on the VistA System and on server class 
 machines.  The installation of this patch must be coordinated with the 
 VistA Imaging Coordinator.
  
 For details on the Installation activities refer to the
 MAG3_0P39_Patch_Description.pdf document distributed
 with the patch.
  
 Installation Prerequisites
 ==========================
  
 * Before installing this patch, you will need to download the Patch 39 
   files from the Imaging FTP site to a local storage location.  
  
 * Review the Pre and Post Installation Activity section to familiarize
   yourself with the activities that take place during this patch 
   installation.
  
 * Verify that the patches listed in the Required Patches section have 
   been installed.
  
 Important: Any Background Processor that is running must be stopped 
   (applications are closed) prior to the installation of the KIDS and 
   Client software. Any image capture application (Clinical and DICOM 
   gateway processing) can continue.
  
 WARNING: Prior to installation, print out the entries in the NETWORK 
   LOCATION, BP WORKSTATION, and  IMAGING SITE PARAMETERS files for 
   review.  Patch 39 will modify these files during the pre and post
   installation activities.  See Patch 39 Installation Worksheet 
   section below.
  
 It is recommended that the install not be performed during the peak
 of site activity.
  
 Note that an extremely brief update to indexes of the site parameter 
 file could cause a failure on the Text gateways.  Check your mail 
 system for DICOM Gateway alerts to this effect after the KIDS install.
  
 VistA System (KIDS) Installation
 ================================
  
 Use the following steps to install the KIDS package, which takes less
 than three minutes.
  
 Installing the KIDS Package
 ===========================
  
 1 Access the Kernel Installation and Distribution System Menu [XPD MAIN].
  
 2 Run the Installation option.
  
 3 Load the KIDS file by performing the following steps:
   a Run the (1) Load a Distribution [XPD LOAD DISTRIBUTION] option 
     to load the KIDS distribution.
  
   b When prompted, enter the path and file name (MAG3_0P39.KID) of the 
     Patch 39 KIDS file that you downloaded from the Imaging FTP server.
  
   c When prompted to continue with the load, enter YES.
  
     A Distribution OK! message will be displayed when the load is 
     complete.
  
 4 After you load the KIDS file, you may elect to use the following
   options:
  
   Verify Checksums in Transport Global [XPD PRINT CHECKSUM]  run this 
   option if you want to ensure the integrity of the routines in the 
   patch. 
  
   Compare Transport Global to Current System [XPD COMPARE TO SYSTEM]   
   run this option if you want to view all changes that will be made when 
   the patch is installed.  All components (routines, options, and so on)
   in the patch will be compared.
  
   Backup a Transport Global [XPD BACKUP]   run this option if you want to 
   create a backup message of any routines exported with the patch.  It 
   will NOT back up any of the other changes.
  
 5 After performing the load and any optional verification steps, install
   the KIDS file by performing the following steps:
  
   a. Run the Install Package(s) [XPD INSTALL BUILD] option.
   b. When prompted for the install name, enter MAG*3.0*39.
   c. Answer NO to the following prompts:
  
      Want KIDS to Rebuild Menu Trees Upon Completion of Install? No//NO
      Want KIDS to INHIBIT LOGONs during the install? No//NO
      Want to DISABLE Scheduled Options, Menu Options, and Protocols? 
        No//NO
  
      Shall I write over your BP WORKSTATIONS File? YES//YES
  
   Note: The last prompt 'Shall I write over your BP Workstations File?'
   will not be displayed on a re-install of this patch.
  
 When the installation is finished, an Installed message will be displayed.
  
 Sample KIDS Installation
 ========================
  
 Select Installation Option: 6  Install Package(s)
 Select INSTALL NAME: MAG*3.0*39       Loaded from Distribution  
 3/9/11@08:09:39
      => VistA Imaging V3.0 - Patch 39 - 03/08/2011 15:34PM  
 ;Created o
  
 This Distribution was loaded on Mar 09, 2011@08:09:39 with header of 
    VistA Imaging V3.0 - Patch 39 - 03/08/2011 15:34PM  ;Created 
 on Mar 0
 8, 2011@15:34:05
    It consisted of the following Install(s):
      MAG*3.0*39
 Checking Install for Package MAG*3.0*39
 Will first run the Environment Check Routine, MAGIP39E
  
  
 Install Questions for MAG*3.0*39
  
 Incoming Files:
  
  
    2005.2    NETWORK LOCATION  (Partial Definition)
 Note:  You already have the 'NETWORK LOCATION' File.
  
  
    2005.86   IMAGE ACTIONS  (Partial Definition)
 Note:  You already have the 'IMAGE ACTIONS' File.
  
  
    2006.031  IMAGE BACKGROUND QUEUE POINTER  (Partial Definition)
 Note:  You already have the 'IMAGE BACKGROUND QUEUE POINTER' File.
  
  
    2006.1    IMAGING SITE PARAMETERS  (Partial Definition)
 Note:  You already have the 'IMAGING SITE PARAMETERS' File.
  
  
    2006.8    BP SERVERS  (Partial Definition)
 Note:  You already have the 'BP SERVERS' File.
  
  
    2006.95   IMAGE ACCESS LOG  (Partial Definition)
 Note:  You already have the 'IMAGE ACCESS LOG' File.
  
 Want KIDS to Rebuild Menu Trees Upon Completion of Install? NO// 
  
  
 Want KIDS to INHIBIT LOGONs during the install? NO// 
 Want to DISABLE Scheduled Options, Menu Options, and Protocols? NO// 
  
 Enter the Device you want to print the Install messages.
 You can queue the install by enter a 'Q' at the device prompt.
 Enter a '^' to abort the install.
  
 DEVICE: HOME//   HERE
  
  
  Install Started for MAG*3.0*39 : 
                Mar 09, 2011@08:11:01
  
 Build Distribution Date: Mar 08, 2011
  
  Installing Routines:...............................
                Mar 09, 2011@08:11:01
  
  Running Pre-Install Routine: PRE^MAGIP39.
  
  Installing Data Dictionaries: .......
                Mar 09, 2011@08:11:02
  
  Installing PACKAGE COMPONENTS: 
  
  Installing REMOTE PROCEDURE...................
  
  Installing OPTION..
                Mar 09, 2011@08:11:02
  
  Running Post-Install Routine: POST^MAGIP39B.
  
 Updating MAG WINDOWS: Mar 09, 2011@08:11:02
  
 Add Generic Mail Message groups to the Mail Group file: Mar 09, 
 2011@08:11:02
  
 Add Message Subjects for Mail Management to Site Parameters - with 
 interval: Mar
  09, 2011@08:11:03
  
 Add Generic Mail groups to BP Message subfile: Mar 09, 2011@08:11:03
  
 Add Raid Groups to the Network Location file: Mar 09, 2011@08:11:03
  
 Initialize raid groups to group default: Mar 09, 2011@08:11:03
  
 Setting Prime entries on line.
  
 Updating Imaging Site Parameter file with prime entries.
  
 Add Photo-ID Post Action to the Image Action file: Mar 09, 2011@08:11:03
  
 Set POP/AUTO Purge 'ON' as the default & Purge Factor as '2' & Purge by 
 'Last Ac
 cess Date': Mar 09, 2011@08:11:03
  
 Setup Auto-Verify: Mar 09, 2011@08:11:03
  
 Re-index Site Parameters, BP Servers, Network Location file: Mar 09, 
 2011@08:11:
 03
  
 Setup dummy UAT (Unassigned Tasks) BP Servers: Mar 09, 2011@08:11:03
  
 Setting AC X-reference in file #2006.95. TASK#: 378285
  
 Consolidate redundant shares. TASK#: 378286
  
 Purging completed import queues in file #2006.041. TASK#: 378287
  
 Post Install Mail Message: Mar 09, 2011@08:11:03
  
  Updating Routine file......
  
  Updating KIDS files.......
  
  MAG*3.0*39 Installed. 
                Mar 09, 2011@08:11:03
  
  
 Installing the Background Processor Client
 ==========================================
  
 Refer to the MAG3_0P39_Patch_Description.pdf document
 distributed with the patch for a pre-installation checklist and
 client installation instructions.
  
 The installation can be performed while the VistA System is active
 and is independent of any products running on the BP server.  The
 client installation takes less than two minutes.
  
 KIDS Routines
 =============
  
 New and modified Imaging routines for the VistA System are listed below.
 For each routine, the second line will contain the following information.
 Please note that the Before Checksums may differ if any test software has
 been installed.
  
 ;;3.0;IMAGING;**[Patch List]**;MAR 19, 2002;; Build 2010; Mar 8, 2011
  
 Checksums are calculated using the Kernel utility program CHECK1^XTSUMBLD.
  
 MAGIP39, MAGIP39E and MAGIP39B are post\pre-install routines and are 
 deleted after the KIDS installation.

Routine Information:
====================
The checksums below are new checksums, and
 can be checked with CHECK1^XTSUMBLD.

Routine Name: MAGBAPI
    Before: B74386027   After: B83920568  **1,7,8,20,39**
Routine Name: MAGBRTE4
    Before: B74476689   After: B72404251  **11,30,51,85,54,39**
Routine Name: MAGFILEB
    Before: B48518635   After: B49779032  **8,48,39**
Routine Name: MAGIP39
    Before:       n/a   After: B76334031  **39**
Routine Name: MAGIP39B
    Before:       n/a   After:B176147737  **39**
Routine Name: MAGIP39E
    Before:       n/a   After: B19057411  **39**
Routine Name: MAGLOG
    Before:  B8117581   After: B12733539  **17,8,20,59,83,39**
Routine Name: MAGQBAB
    Before: B10838980   After: B11090744  **1,8,20,39**
Routine Name: MAGQBD
    Before:  B7129737   After:  B7193200  **20,39**
Routine Name: MAGQBGCC
    Before: B11208984   After: B22620729  **8,48,20,39**
Routine Name: MAGQBIM
    Before:  B7456958   After: B10106548  **7,20,39**
Routine Name: MAGQBJB
    Before: B18032148   After: B17698321  **8,20,39**
Routine Name: MAGQBJH
    Before: B24339395   After: B24245362  **8,20,39**
Routine Name: MAGQBPG1
    Before: B76244753   After: B77258360  **7,8,20,81,39**
Routine Name: MAGQBPG2
    Before: B20522184   After: B21016522  **8,20,39**
Routine Name: MAGQBPRG
    Before: B57300845   After: B56526255  **7,3,8,20,81,39**
Routine Name: MAGQBTM
    Before: B79858508   After: B81984703  **1,7,8,20,81,39**
Routine Name: MAGQBU6A
    Before:       n/a   After:B101156562  **39**
Routine Name: MAGQBUT
    Before: B78801561   After:B143602408  **7,8,48,20,39**
Routine Name: MAGQBUT1
    Before: B76309021   After:B115897109  **7,8,20,81,39**
Routine Name: MAGQBUT2
    Before: B55361113   After: B91378529  **7,8,20,81,39**
Routine Name: MAGQBUT4
    Before: B78049028   After: B92803022  **7,8,48,20,81,39**
Routine Name: MAGQBUT5
    Before: B15869460   After:B105448474  **20,81,39**
Routine Name: MAGQBUT6
    Before:       n/a   After:B144843447  **39**
Routine Name: MAGQCBP
    Before:       n/a   After:B116132863  **39**
Routine Name: MAGQE1
    Before: B11840891   After: B12851574  **27,29,30,20,39**
Routine Name: MAGQE2
    Before: B17337879   After: B15983460  **27,29,20,39**
Routine Name: MAGQE5
    Before: B54546885   After: B56083407  **27,29,8,30,20,46,39**
Routine Name: MAGQE6
    Before: B11312577   After: B16298001  **46,39**
Routine Name: MAGQE7
    Before:       n/a   After: B48785755  **39**
 
Routine list of preceding patches: 46, 54, 81, 83

=============================================================================
User Information:                          Hold Date     : MAY 27, 2011
Entered By  : BARRIOS,LUCILLE               Date Entered  : JUL 13, 2004
Completed By: TROMBETTA,KATHY               Date Completed: APR 27, 2011
Released By : FUGETT,BRENT                  Date Released : MAY 31, 2011
=============================================================================


Packman Mail Message:
=====================

No routines included
