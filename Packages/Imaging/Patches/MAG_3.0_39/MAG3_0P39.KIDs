KIDS Distribution saved on Mar 08, 2011@15:34:05
VistA Imaging V3.0 - Patch 39 - Test 28 03/08/2011 15:34PM
**KIDS**:MAG*3.0*39^

**INSTALL NAME**
MAG*3.0*39
"BLD",3463,0)
MAG*3.0*39^IMAGING^0^3110308^y
"BLD",3463,1,0)
^^40^40^3110308^
"BLD",3463,1,1,0)
Version 3.0 Patch 039 - Background Processor Enhancements II
"BLD",3463,1,2,0)
 
"BLD",3463,1,3,0)
 
"BLD",3463,1,4,0)
Routines:
"BLD",3463,1,5,0)
MAGBAPI     new value = 83920568
"BLD",3463,1,6,0)
MAGBRTE4    new value = 72404251
"BLD",3463,1,7,0)
MAGFILEB    new value = 49779032
"BLD",3463,1,8,0)
MAGIP39     new value = 76334031
"BLD",3463,1,9,0)
MAGIP39B    new value = 176147737
"BLD",3463,1,10,0)
MAGIP39E    new value = 19057411
"BLD",3463,1,11,0)
MAGLOG      new value = 12733539
"BLD",3463,1,12,0)
MAGQBAB     new value = 11090744
"BLD",3463,1,13,0)
MAGQBD      new value = 7193200
"BLD",3463,1,14,0)
MAGQBGCC    new value = 22620729
"BLD",3463,1,15,0)
MAGQBIM     new value = 10106548
"BLD",3463,1,16,0)
MAGQBJB     new value = 17698321
"BLD",3463,1,17,0)
MAGQBJH     new value = 24245362
"BLD",3463,1,18,0)
MAGQBPG1    new value = 77258360
"BLD",3463,1,19,0)
MAGQBPG2    new value = 21016522
"BLD",3463,1,20,0)
MAGQBPRG    new value = 56526255
"BLD",3463,1,21,0)
MAGQBTM     new value = 81984703
"BLD",3463,1,22,0)
MAGQBU6A    new value = 101156562
"BLD",3463,1,23,0)
MAGQBUT     new value = 143602408
"BLD",3463,1,24,0)
MAGQBUT1    new value = 115897109
"BLD",3463,1,25,0)
MAGQBUT2    new value = 91378529
"BLD",3463,1,26,0)
MAGQBUT4    new value = 92803022
"BLD",3463,1,27,0)
MAGQBUT5    new value = 105448474
"BLD",3463,1,28,0)
MAGQBUT6    new value = 144843447
"BLD",3463,1,29,0)
MAGQCBP     new value = 116132863
"BLD",3463,1,30,0)
MAGQE1      new value = 12851574
"BLD",3463,1,31,0)
MAGQE2      new value = 15983460
"BLD",3463,1,32,0)
MAGQE5      new value = 56083407
"BLD",3463,1,33,0)
MAGQE6      new value = 16298001
"BLD",3463,1,34,0)
MAGQE7      new value = 48785755
"BLD",3463,1,35,0)
 
"BLD",3463,1,36,0)
Please note that routine MAGIP39 is deleted after the KIDS Build is
"BLD",3463,1,37,0)
installed.
"BLD",3463,1,38,0)
 
"BLD",3463,1,39,0)
Please note that routine MAGIP39B is deleted after the KIDS Build is
"BLD",3463,1,40,0)
installed.
"BLD",3463,4,0)
^9.64PA^2006.95^6
"BLD",3463,6.3)
V3.0p39Build2010_T28
"BLD",3463,4,2005.2,0)
2005.2
"BLD",3463,4,2005.2,2,0)
^9.641^2005.22^3
"BLD",3463,4,2005.2,2,2005.2,0)
NETWORK LOCATION  (File-top level)
"BLD",3463,4,2005.2,2,2005.2,1,0)
^9.6411^26^29
"BLD",3463,4,2005.2,2,2005.2,1,.01,0)
NETWORK LOCATION
"BLD",3463,4,2005.2,2,2005.2,1,.04,0)
PLACE
"BLD",3463,4,2005.2,2,2005.2,1,1,0)
PHYSICAL REFERENCE
"BLD",3463,4,2005.2,2,2005.2,1,2,0)
TOTAL SPACE
"BLD",3463,4,2005.2,2,2005.2,1,4,0)
FREE SPACE
"BLD",3463,4,2005.2,2,2005.2,1,5.5,0)
READ ONLY
"BLD",3463,4,2005.2,2,2005.2,1,6,0)
STORAGE TYPE
"BLD",3463,4,2005.2,2,2005.2,1,7,0)
HASH SUBDIRECTORY
"BLD",3463,4,2005.2,2,2005.2,1,8,0)
ABSTRACT
"BLD",3463,4,2005.2,2,2005.2,1,9,0)
FULL
"BLD",3463,4,2005.2,2,2005.2,1,10,0)
BIG
"BLD",3463,4,2005.2,2,2005.2,1,11,0)
TEXT
"BLD",3463,4,2005.2,2,2005.2,1,12,0)
DICOM
"BLD",3463,4,2005.2,2,2005.2,1,14,0)
COMPRESSION
"BLD",3463,4,2005.2,2,2005.2,1,15,0)
USER NAME
"BLD",3463,4,2005.2,2,2005.2,1,16,0)
PASSWORD
"BLD",3463,4,2005.2,2,2005.2,1,17,0)
MAINTAINCONNECTION
"BLD",3463,4,2005.2,2,2005.2,1,18,0)
MAX # RETRY ON CONNECT
"BLD",3463,4,2005.2,2,2005.2,1,19,0)
MAX # RETRY ON TRANSMIT
"BLD",3463,4,2005.2,2,2005.2,1,20,0)
SYNTAX
"BLD",3463,4,2005.2,2,2005.2,1,21,0)
SUBDIRECTORY
"BLD",3463,4,2005.2,2,2005.2,1,23,0)
RETENTION PERIOD
"BLD",3463,4,2005.2,2,2005.2,1,24,0)
LAST PURGE DATE
"BLD",3463,4,2005.2,2,2005.2,1,25,0)
SITE
"BLD",3463,4,2005.2,2,2005.2,1,26,0)
ROUTER
"BLD",3463,4,2005.2,2,2005.2,1,27,0)
TIME OFFLINE
"BLD",3463,4,2005.2,2,2005.2,1,28,0)
MUSE SITE #
"BLD",3463,4,2005.2,2,2005.2,1,29,0)
MUSE VERSION #
"BLD",3463,4,2005.2,2,2005.2,1,31,0)
GROUP MEMBER
"BLD",3463,4,2005.2,2,2005.201,0)
EMAIL  (sub-file)
"BLD",3463,4,2005.2,2,2005.201,1,0)
^9.6411^^
"BLD",3463,4,2005.2,2,2005.22,0)
SHARE GROUP  (sub-file)
"BLD",3463,4,2005.2,2,2005.22,1,0)
^9.6411^^
"BLD",3463,4,2005.2,222)
y^y^p^^^^n^^n
"BLD",3463,4,2005.2,224)

"BLD",3463,4,2005.86,0)
2005.86
"BLD",3463,4,2005.86,2,0)
^9.641^2005.86^1
"BLD",3463,4,2005.86,2,2005.86,0)
IMAGE ACTIONS  (File-top level)
"BLD",3463,4,2005.86,2,2005.86,1,0)
^9.6411^6^1
"BLD",3463,4,2005.86,2,2005.86,1,6,0)
EXPORT LOCATION
"BLD",3463,4,2005.86,222)
y^y^p^^^^n^^n
"BLD",3463,4,2005.86,224)

"BLD",3463,4,2006.031,0)
2006.031
"BLD",3463,4,2006.031,2,0)
^9.641^2006.031^1
"BLD",3463,4,2006.031,2,2006.031,0)
IMAGE BACKGROUND QUEUE POINTER  (File-top level)
"BLD",3463,4,2006.031,2,2006.031,1,0)
^9.6411^4^1
"BLD",3463,4,2006.031,2,2006.031,1,4,0)
LAST_QUEUE_PROCESSED_DATE_TIME
"BLD",3463,4,2006.031,222)
y^y^p^^^^n^^n
"BLD",3463,4,2006.031,224)

"BLD",3463,4,2006.1,0)
2006.1
"BLD",3463,4,2006.1,2,0)
^9.641^2006.11^5
"BLD",3463,4,2006.1,2,2006.1,0)
IMAGING SITE PARAMETERS  (File-top level)
"BLD",3463,4,2006.1,2,2006.1,1,0)
^9.6411^9^44
"BLD",3463,4,2006.1,2,2006.1,1,.02,0)
CURRENT NAMESPACE
"BLD",3463,4,2006.1,2,2006.1,1,.03,0)
IMAGE NETWORK WRITE LOCATION
"BLD",3463,4,2006.1,2,2006.1,1,.031,0)
CURRENT RAID GROUP
"BLD",3463,4,2006.1,2,2006.1,1,.07,0)
GCC EXPORT LOC
"BLD",3463,4,2006.1,2,2006.1,1,.08,0)
IMAGE NETWORK IMPORT LOCATION
"BLD",3463,4,2006.1,2,2006.1,1,1.02,0)
PACS DIRECTORY
"BLD",3463,4,2006.1,2,2006.1,1,1.03,0)
PACS IMAGE WRITE LOCATION
"BLD",3463,4,2006.1,2,2006.1,1,2.01,0)
JUKEBOX WRITE LOCATION
"BLD",3463,4,2006.1,2,2006.1,1,6,0)
TRACK ABSTRACT ACCESSES
"BLD",3463,4,2006.1,2,2006.1,1,8,0)
PURGE-RETENTION DAYS FULL FILE
"BLD",3463,4,2006.1,2,2006.1,1,9,0)
RETENTION DAYS HL7 & DICOM
"BLD",3463,4,2006.1,2,2006.1,1,10,0)
SERVER TASK
"BLD",3463,4,2006.1,2,2006.1,1,11,0)
PERCENT SERVER RESERVE
"BLD",3463,4,2006.1,2,2006.1,1,11.9,0)
DATE OF LAST CRITICAL MESSAGE
"BLD",3463,4,2006.1,2,2006.1,1,20,0)
NO AUTOWRITE UPDATE
"BLD",3463,4,2006.1,2,2006.1,1,22,0)
PURGE-RETENTION DAYS BIG FILE
"BLD",3463,4,2006.1,2,2006.1,1,23,0)
PURGE-RETENTION DAYS ABS FILE
"BLD",3463,4,2006.1,2,2006.1,1,24,0)
PURGE-RETENTION DAYS PHOTOID
"BLD",3463,4,2006.1,2,2006.1,1,60,0)
AUTOPURGE
"BLD",3463,4,2006.1,2,2006.1,1,60.1,0)
PURGE BY
"BLD",3463,4,2006.1,2,2006.1,1,60.2,0)
EXPRESS PURGE
"BLD",3463,4,2006.1,2,2006.1,1,60.3,0)
EXPRESS PURGE RATE
"BLD",3463,4,2006.1,2,2006.1,1,60.4,0)
LAST PURGE BPWS
"BLD",3463,4,2006.1,2,2006.1,1,60.5,0)
RAID PURGE FACTOR
"BLD",3463,4,2006.1,2,2006.1,1,61,0)
SCHEDULED PURGE
"BLD",3463,4,2006.1,2,2006.1,1,61.1,0)
DATE OF LAST PURGE
"BLD",3463,4,2006.1,2,2006.1,1,61.2,0)
SCHEDULED PURGE FREQUENCY
"BLD",3463,4,2006.1,2,2006.1,1,61.3,0)
DATE OF SCHEDULED PURGE
"BLD",3463,4,2006.1,2,2006.1,1,61.4,0)
SCHEDULED PURGE TIME
"BLD",3463,4,2006.1,2,2006.1,1,62,0)
SCHEDULED VERIFIER
"BLD",3463,4,2006.1,2,2006.1,1,62.1,0)
DATE OF LAST VERIFY
"BLD",3463,4,2006.1,2,2006.1,1,62.2,0)
SCHEDULED VERIFIER FREQUENCY
"BLD",3463,4,2006.1,2,2006.1,1,62.3,0)
DATE OF SCHEDULED VERIFIER
"BLD",3463,4,2006.1,2,2006.1,1,62.4,0)
SCHEDULED VERIFIER TIME
"BLD",3463,4,2006.1,2,2006.1,1,62.5,0)
LAST VERIFY BP WS
"BLD",3463,4,2006.1,2,2006.1,1,62.6,0)
SCHEDULED VERIFY TEXT CHECK
"BLD",3463,4,2006.1,2,2006.1,1,63,0)
SCHEDULED RG ADVANCE
"BLD",3463,4,2006.1,2,2006.1,1,63.1,0)
RG ADVANCE FREQUENCY
"BLD",3463,4,2006.1,2,2006.1,1,63.2,0)
DATE OF LAST RG ADVANCE
"BLD",3463,4,2006.1,2,2006.1,1,63.3,0)
RG ADVANCE DATE
"BLD",3463,4,2006.1,2,2006.1,1,63.4,0)
RG ADVANCE TIME
"BLD",3463,4,2006.1,2,2006.1,1,103,0)
RETENTION DAYS DICOM MSGS
"BLD",3463,4,2006.1,2,2006.1,1,124,0)
DICOM GATEWAY ACCESS CODE
"BLD",3463,4,2006.1,2,2006.1,1,125,0)
DICOM GATEWAY VERIFY CODE
"BLD",3463,4,2006.1,2,2006.11,0)
MULTI NAMESPACE  (sub-file)
"BLD",3463,4,2006.1,2,2006.11,1,0)
^9.6411^^
"BLD",3463,4,2006.1,2,2006.112,0)
FILE TYPES  (sub-file)
"BLD",3463,4,2006.1,2,2006.112,1,0)
^9.6411^.01^1
"BLD",3463,4,2006.1,2,2006.112,1,.01,0)
FILE TYPES
"BLD",3463,4,2006.1,2,2006.12,0)
ASSOCIATED INSTITUTIONS  (sub-file)
"BLD",3463,4,2006.1,2,2006.12,1,0)
^9.6411^.01^1
"BLD",3463,4,2006.1,2,2006.12,1,.01,0)
ASSOCIATED INSTITUTIONS
"BLD",3463,4,2006.1,2,2006.166,0)
BP MAIL MESSAGE  (sub-file)
"BLD",3463,4,2006.1,2,2006.166,1,0)
^9.6411^^
"BLD",3463,4,2006.1,222)
y^y^p^^^^n^^n
"BLD",3463,4,2006.1,224)

"BLD",3463,4,2006.8,0)
2006.8
"BLD",3463,4,2006.8,2,0)
^9.641^2006.8^1
"BLD",3463,4,2006.8,2,2006.8,0)
BP SERVERS  (File-top level)
"BLD",3463,4,2006.8,2,2006.8,1,0)
^9.6411^4^19
"BLD",3463,4,2006.8,2,2006.8,1,.01,0)
NAME
"BLD",3463,4,2006.8,2,2006.8,1,.04,0)
PLACE
"BLD",3463,4,2006.8,2,2006.8,1,3,0)
AUTO PURGE
"BLD",3463,4,2006.8,2,2006.8,1,4,0)
SCHEDULED VERIFY
"BLD",3463,4,2006.8,2,2006.8,1,11,0)
BACKGROUND PROCESSOR
"BLD",3463,4,2006.8,2,2006.8,1,12,0)
ABSTRACT
"BLD",3463,4,2006.8,2,2006.8,1,13,0)
JUKEBOX
"BLD",3463,4,2006.8,2,2006.8,1,14,0)
JBTOHD
"BLD",3463,4,2006.8,2,2006.8,1,15,0)
PREFET
"BLD",3463,4,2006.8,2,2006.8,1,16,0)
IMPORT
"BLD",3463,4,2006.8,2,2006.8,1,17,0)
GCC
"BLD",3463,4,2006.8,2,2006.8,1,20,0)
DELETE
"BLD",3463,4,2006.8,2,2006.8,1,49,0)
NETWORK_LOG_ARCHIVE
"BLD",3463,4,2006.8,2,2006.8,1,50,0)
BP SERVER NETWORK NAME
"BLD",3463,4,2006.8,2,2006.8,1,51,0)
BP CLIENT VERSION
"BLD",3463,4,2006.8,2,2006.8,1,52,0)
BP CLIENT DISTRIBUTION DATE
"BLD",3463,4,2006.8,2,2006.8,1,53,0)
BP SERVER OS
"BLD",3463,4,2006.8,2,2006.8,1,54,0)
LOGSIZE
"BLD",3463,4,2006.8,2,2006.8,1,55,0)
LAST EXECUTION DATE
"BLD",3463,4,2006.8,222)
y^y^p^^^^n^^n
"BLD",3463,4,2006.8,224)

"BLD",3463,4,2006.95,0)
2006.95
"BLD",3463,4,2006.95,2,0)
^9.641^2006.95^1
"BLD",3463,4,2006.95,2,2006.95,0)
IMAGE ACCESS LOG  (File-top level)
"BLD",3463,4,2006.95,2,2006.95,1,0)
^9.6411^10^2
"BLD",3463,4,2006.95,2,2006.95,1,1,0)
ACCESS TYPE
"BLD",3463,4,2006.95,2,2006.95,1,10,0)
DIVISION
"BLD",3463,4,2006.95,222)
y^y^p^^^^n^^n
"BLD",3463,4,2006.95,224)

"BLD",3463,4,"APDD",2006.95,2006.95)

"BLD",3463,4,"APDD",2005.2,2005.2)

"BLD",3463,4,"APDD",2005.2,2005.2,.01)

"BLD",3463,4,"APDD",2005.2,2005.2,.04)

"BLD",3463,4,"APDD",2005.2,2005.2,1)

"BLD",3463,4,"APDD",2005.2,2005.2,10)

"BLD",3463,4,"APDD",2005.2,2005.2,11)

"BLD",3463,4,"APDD",2005.2,2005.2,12)

"BLD",3463,4,"APDD",2005.2,2005.2,14)

"BLD",3463,4,"APDD",2005.2,2005.2,15)

"BLD",3463,4,"APDD",2005.2,2005.2,16)

"BLD",3463,4,"APDD",2005.2,2005.2,17)

"BLD",3463,4,"APDD",2005.2,2005.2,18)

"BLD",3463,4,"APDD",2005.2,2005.2,19)

"BLD",3463,4,"APDD",2005.2,2005.2,2)

"BLD",3463,4,"APDD",2005.2,2005.2,20)

"BLD",3463,4,"APDD",2005.2,2005.2,21)

"BLD",3463,4,"APDD",2005.2,2005.2,23)

"BLD",3463,4,"APDD",2005.2,2005.2,24)

"BLD",3463,4,"APDD",2005.2,2005.2,25)

"BLD",3463,4,"APDD",2005.2,2005.2,26)

"BLD",3463,4,"APDD",2005.2,2005.2,27)

"BLD",3463,4,"APDD",2005.2,2005.2,28)

"BLD",3463,4,"APDD",2005.2,2005.2,29)

"BLD",3463,4,"APDD",2005.2,2005.2,31)

"BLD",3463,4,"APDD",2005.2,2005.2,4)

"BLD",3463,4,"APDD",2005.2,2005.2,5.5)

"BLD",3463,4,"APDD",2005.2,2005.2,6)

"BLD",3463,4,"APDD",2005.2,2005.2,7)

"BLD",3463,4,"APDD",2005.2,2005.2,8)

"BLD",3463,4,"APDD",2005.2,2005.2,9)

"BLD",3463,4,"APDD",2005.2,2005.201)

"BLD",3463,4,"APDD",2005.2,2005.22)

"BLD",3463,4,"APDD",2005.86,2005.86)

"BLD",3463,4,"APDD",2005.86,2005.86,6)

"BLD",3463,4,"APDD",2006.031,2006.031)

"BLD",3463,4,"APDD",2006.031,2006.031,4)

"BLD",3463,4,"APDD",2006.1,2006.1)

"BLD",3463,4,"APDD",2006.1,2006.1,.02)

"BLD",3463,4,"APDD",2006.1,2006.1,.03)

"BLD",3463,4,"APDD",2006.1,2006.1,.031)

"BLD",3463,4,"APDD",2006.1,2006.1,.07)

"BLD",3463,4,"APDD",2006.1,2006.1,.08)

"BLD",3463,4,"APDD",2006.1,2006.1,1.02)

"BLD",3463,4,"APDD",2006.1,2006.1,1.03)

"BLD",3463,4,"APDD",2006.1,2006.1,10)

"BLD",3463,4,"APDD",2006.1,2006.1,103)

"BLD",3463,4,"APDD",2006.1,2006.1,11)

"BLD",3463,4,"APDD",2006.1,2006.1,11.9)

"BLD",3463,4,"APDD",2006.1,2006.1,124)

"BLD",3463,4,"APDD",2006.1,2006.1,125)

"BLD",3463,4,"APDD",2006.1,2006.1,2.01)

"BLD",3463,4,"APDD",2006.1,2006.1,20)

"BLD",3463,4,"APDD",2006.1,2006.1,22)

"BLD",3463,4,"APDD",2006.1,2006.1,23)

"BLD",3463,4,"APDD",2006.1,2006.1,24)

"BLD",3463,4,"APDD",2006.1,2006.1,6)

"BLD",3463,4,"APDD",2006.1,2006.1,60)

"BLD",3463,4,"APDD",2006.1,2006.1,60.1)

"BLD",3463,4,"APDD",2006.1,2006.1,60.2)

"BLD",3463,4,"APDD",2006.1,2006.1,60.3)

"BLD",3463,4,"APDD",2006.1,2006.1,60.4)

"BLD",3463,4,"APDD",2006.1,2006.1,60.5)

"BLD",3463,4,"APDD",2006.1,2006.1,61)

"BLD",3463,4,"APDD",2006.1,2006.1,61.1)

"BLD",3463,4,"APDD",2006.1,2006.1,61.2)

"BLD",3463,4,"APDD",2006.1,2006.1,61.3)

"BLD",3463,4,"APDD",2006.1,2006.1,61.4)

"BLD",3463,4,"APDD",2006.1,2006.1,62)

"BLD",3463,4,"APDD",2006.1,2006.1,62.1)

"BLD",3463,4,"APDD",2006.1,2006.1,62.2)

"BLD",3463,4,"APDD",2006.1,2006.1,62.3)

"BLD",3463,4,"APDD",2006.1,2006.1,62.4)

"BLD",3463,4,"APDD",2006.1,2006.1,62.5)

"BLD",3463,4,"APDD",2006.1,2006.1,62.6)

"BLD",3463,4,"APDD",2006.1,2006.1,63)

"BLD",3463,4,"APDD",2006.1,2006.1,63.1)

"BLD",3463,4,"APDD",2006.1,2006.1,63.2)

"BLD",3463,4,"APDD",2006.1,2006.1,63.3)

"BLD",3463,4,"APDD",2006.1,2006.1,63.4)

"BLD",3463,4,"APDD",2006.1,2006.1,8)

"BLD",3463,4,"APDD",2006.1,2006.1,9)

"BLD",3463,4,"APDD",2006.1,2006.11)

"BLD",3463,4,"APDD",2006.1,2006.112)

"BLD",3463,4,"APDD",2006.1,2006.112,.01)

"BLD",3463,4,"APDD",2006.1,2006.12)

"BLD",3463,4,"APDD",2006.1,2006.12,.01)

"BLD",3463,4,"APDD",2006.1,2006.166)

"BLD",3463,4,"APDD",2006.8,2006.8)

"BLD",3463,4,"APDD",2006.8,2006.8,.01)

"BLD",3463,4,"APDD",2006.8,2006.8,.04)

"BLD",3463,4,"APDD",2006.8,2006.8,11)

"BLD",3463,4,"APDD",2006.8,2006.8,12)

"BLD",3463,4,"APDD",2006.8,2006.8,13)

"BLD",3463,4,"APDD",2006.8,2006.8,14)

"BLD",3463,4,"APDD",2006.8,2006.8,15)

"BLD",3463,4,"APDD",2006.8,2006.8,16)

"BLD",3463,4,"APDD",2006.8,2006.8,17)

"BLD",3463,4,"APDD",2006.8,2006.8,20)

"BLD",3463,4,"APDD",2006.8,2006.8,3)

"BLD",3463,4,"APDD",2006.8,2006.8,4)

"BLD",3463,4,"APDD",2006.8,2006.8,49)

"BLD",3463,4,"APDD",2006.8,2006.8,50)

"BLD",3463,4,"APDD",2006.8,2006.8,51)

"BLD",3463,4,"APDD",2006.8,2006.8,52)

"BLD",3463,4,"APDD",2006.8,2006.8,53)

"BLD",3463,4,"APDD",2006.8,2006.8,54)

"BLD",3463,4,"APDD",2006.8,2006.8,55)

"BLD",3463,4,"APDD",2006.95,2006.95)

"BLD",3463,4,"APDD",2006.95,2006.95,1)

"BLD",3463,4,"APDD",2006.95,2006.95,10)

"BLD",3463,4,"B",2005.2,2005.2)

"BLD",3463,4,"B",2005.86,2005.86)

"BLD",3463,4,"B",2006.031,2006.031)

"BLD",3463,4,"B",2006.1,2006.1)

"BLD",3463,4,"B",2006.8,2006.8)

"BLD",3463,4,"B",2006.95,2006.95)

"BLD",3463,"ABNS",0)
^9.66A^^
"BLD",3463,"ABPKG")
n^n^G.IMAGING DEVELOPMENT TEAM@DOMAIN.EXT
"BLD",3463,"INI")
PRE^MAGIP39
"BLD",3463,"INID")
y^y^y
"BLD",3463,"INIT")
POST^MAGIP39B
"BLD",3463,"KRN",0)
^9.67PA^8994^19
"BLD",3463,"KRN",.4,0)
.4
"BLD",3463,"KRN",.4,"NM",0)
^9.68A^^
"BLD",3463,"KRN",.401,0)
.401
"BLD",3463,"KRN",.401,"NM",0)
^9.68A^^
"BLD",3463,"KRN",.402,0)
.402
"BLD",3463,"KRN",.402,"NM",0)
^9.68A^^
"BLD",3463,"KRN",.403,0)
.403
"BLD",3463,"KRN",.5,0)
.5
"BLD",3463,"KRN",.84,0)
.84
"BLD",3463,"KRN",.84,"NM",0)
^9.68A^^
"BLD",3463,"KRN",3.6,0)
3.6
"BLD",3463,"KRN",3.8,0)
3.8
"BLD",3463,"KRN",9.2,0)
9.2
"BLD",3463,"KRN",9.8,0)
9.8
"BLD",3463,"KRN",9.8,"NM",0)
^9.68A^28^28
"BLD",3463,"KRN",9.8,"NM",1,0)
MAGBAPI^^0^B83920568
"BLD",3463,"KRN",9.8,"NM",2,0)
MAGBRTE4^^0^B72404251
"BLD",3463,"KRN",9.8,"NM",3,0)
MAGFILEB^^0^B49779032
"BLD",3463,"KRN",9.8,"NM",4,0)
MAGIP39E^^0^B19057411
"BLD",3463,"KRN",9.8,"NM",5,0)
MAGLOG^^0^B12733539
"BLD",3463,"KRN",9.8,"NM",6,0)
MAGQBAB^^0^B11090744
"BLD",3463,"KRN",9.8,"NM",7,0)
MAGQBD^^0^B7193200
"BLD",3463,"KRN",9.8,"NM",8,0)
MAGQBGCC^^0^B22620729
"BLD",3463,"KRN",9.8,"NM",9,0)
MAGQBIM^^0^B10106548
"BLD",3463,"KRN",9.8,"NM",10,0)
MAGQBJB^^0^B17698321
"BLD",3463,"KRN",9.8,"NM",11,0)
MAGQBJH^^0^B24245362
"BLD",3463,"KRN",9.8,"NM",12,0)
MAGQBPG1^^0^B77258360
"BLD",3463,"KRN",9.8,"NM",13,0)
MAGQBPG2^^0^B21016522
"BLD",3463,"KRN",9.8,"NM",14,0)
MAGQBPRG^^0^B56526255
"BLD",3463,"KRN",9.8,"NM",15,0)
MAGQBTM^^0^B81984703
"BLD",3463,"KRN",9.8,"NM",16,0)
MAGQBU6A^^0^B101156562
"BLD",3463,"KRN",9.8,"NM",17,0)
MAGQBUT^^0^B143602408
"BLD",3463,"KRN",9.8,"NM",18,0)
MAGQBUT1^^0^B115897109
"BLD",3463,"KRN",9.8,"NM",19,0)
MAGQBUT2^^0^B91378529
"BLD",3463,"KRN",9.8,"NM",20,0)
MAGQBUT4^^0^B92803022
"BLD",3463,"KRN",9.8,"NM",21,0)
MAGQBUT5^^0^B105448474
"BLD",3463,"KRN",9.8,"NM",22,0)
MAGQBUT6^^0^B144843447
"BLD",3463,"KRN",9.8,"NM",23,0)
MAGQCBP^^0^B116132863
"BLD",3463,"KRN",9.8,"NM",24,0)
MAGQE1^^0^B12851574
"BLD",3463,"KRN",9.8,"NM",25,0)
MAGQE2^^0^B15983460
"BLD",3463,"KRN",9.8,"NM",26,0)
MAGQE5^^0^B56083407
"BLD",3463,"KRN",9.8,"NM",27,0)
MAGQE6^^0^B16298001
"BLD",3463,"KRN",9.8,"NM",28,0)
MAGQE7^^0^B48785755
"BLD",3463,"KRN",9.8,"NM","B","MAGBAPI",1)

"BLD",3463,"KRN",9.8,"NM","B","MAGBRTE4",2)

"BLD",3463,"KRN",9.8,"NM","B","MAGFILEB",3)

"BLD",3463,"KRN",9.8,"NM","B","MAGIP39E",4)

"BLD",3463,"KRN",9.8,"NM","B","MAGLOG",5)

"BLD",3463,"KRN",9.8,"NM","B","MAGQBAB",6)

"BLD",3463,"KRN",9.8,"NM","B","MAGQBD",7)

"BLD",3463,"KRN",9.8,"NM","B","MAGQBGCC",8)

"BLD",3463,"KRN",9.8,"NM","B","MAGQBIM",9)

"BLD",3463,"KRN",9.8,"NM","B","MAGQBJB",10)

"BLD",3463,"KRN",9.8,"NM","B","MAGQBJH",11)

"BLD",3463,"KRN",9.8,"NM","B","MAGQBPG1",12)

"BLD",3463,"KRN",9.8,"NM","B","MAGQBPG2",13)

"BLD",3463,"KRN",9.8,"NM","B","MAGQBPRG",14)

"BLD",3463,"KRN",9.8,"NM","B","MAGQBTM",15)

"BLD",3463,"KRN",9.8,"NM","B","MAGQBU6A",16)

"BLD",3463,"KRN",9.8,"NM","B","MAGQBUT",17)

"BLD",3463,"KRN",9.8,"NM","B","MAGQBUT1",18)

"BLD",3463,"KRN",9.8,"NM","B","MAGQBUT2",19)

"BLD",3463,"KRN",9.8,"NM","B","MAGQBUT4",20)

"BLD",3463,"KRN",9.8,"NM","B","MAGQBUT5",21)

"BLD",3463,"KRN",9.8,"NM","B","MAGQBUT6",22)

"BLD",3463,"KRN",9.8,"NM","B","MAGQCBP",23)

"BLD",3463,"KRN",9.8,"NM","B","MAGQE1",24)

"BLD",3463,"KRN",9.8,"NM","B","MAGQE2",25)

"BLD",3463,"KRN",9.8,"NM","B","MAGQE5",26)

"BLD",3463,"KRN",9.8,"NM","B","MAGQE6",27)

"BLD",3463,"KRN",9.8,"NM","B","MAGQE7",28)

"BLD",3463,"KRN",19,0)
19
"BLD",3463,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",3463,"KRN",19,"NM",1,0)
MAGQ BPMONITOR^^0
"BLD",3463,"KRN",19,"NM","B","MAGQ BPMONITOR",1)

"BLD",3463,"KRN",19.1,0)
19.1
"BLD",3463,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",3463,"KRN",101,0)
101
"BLD",3463,"KRN",101,"NM",0)
^9.68A^^
"BLD",3463,"KRN",409.61,0)
409.61
"BLD",3463,"KRN",771,0)
771
"BLD",3463,"KRN",771,"NM",0)
^9.68A^^
"BLD",3463,"KRN",870,0)
870
"BLD",3463,"KRN",870,"NM",0)
^9.68A^^
"BLD",3463,"KRN",8989.51,0)
8989.51
"BLD",3463,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",3463,"KRN",8989.52,0)
8989.52
"BLD",3463,"KRN",8994,0)
8994
"BLD",3463,"KRN",8994,"NM",0)
^9.68A^18^18
"BLD",3463,"KRN",8994,"NM",1,0)
MAG FIELD VALIDATE^^0
"BLD",3463,"KRN",8994,"NM",2,0)
MAG KEY VALIDATE^^0
"BLD",3463,"KRN",8994,"NM",3,0)
MAGQ ADD RAID GROUP^^0
"BLD",3463,"KRN",8994,"NM",4,0)
MAGQ ALL SERVER^^0
"BLD",3463,"KRN",8994,"NM",5,0)
MAGQ BP UAT^^0
"BLD",3463,"KRN",8994,"NM",6,0)
MAGQ DEL NLOC^^0
"BLD",3463,"KRN",8994,"NM",7,0)
MAGQ DFNIQ^^0
"BLD",3463,"KRN",8994,"NM",8,0)
MAGQ ELOGR^^0
"BLD",3463,"KRN",8994,"NM",9,0)
MAGQ FINDC^^0
"BLD",3463,"KRN",8994,"NM",10,0)
MAGQ FS CHNGE^^0
"BLD",3463,"KRN",8994,"NM",11,0)
MAGQ FTYPE^^0
"BLD",3463,"KRN",8994,"NM",12,0)
MAGQ JBQUE^^0
"BLD",3463,"KRN",8994,"NM",13,0)
MAGQ JBSCN^^0
"BLD",3463,"KRN",8994,"NM",14,0)
MAGQ QCNT^^0
"BLD",3463,"KRN",8994,"NM",15,0)
MAGQ QRNGE^^0
"BLD",3463,"KRN",8994,"NM",16,0)
MAGQB QUEDEL^^0
"BLD",3463,"KRN",8994,"NM",17,0)
MAGQBP ALL SHARES^^0
"BLD",3463,"KRN",8994,"NM",18,0)
MAGQBP FREF^^0
"BLD",3463,"KRN",8994,"NM","B","MAG FIELD VALIDATE",1)

"BLD",3463,"KRN",8994,"NM","B","MAG KEY VALIDATE",2)

"BLD",3463,"KRN",8994,"NM","B","MAGQ ADD RAID GROUP",3)

"BLD",3463,"KRN",8994,"NM","B","MAGQ ALL SERVER",4)

"BLD",3463,"KRN",8994,"NM","B","MAGQ BP UAT",5)

"BLD",3463,"KRN",8994,"NM","B","MAGQ DEL NLOC",6)

"BLD",3463,"KRN",8994,"NM","B","MAGQ DFNIQ",7)

"BLD",3463,"KRN",8994,"NM","B","MAGQ ELOGR",8)

"BLD",3463,"KRN",8994,"NM","B","MAGQ FINDC",9)

"BLD",3463,"KRN",8994,"NM","B","MAGQ FS CHNGE",10)

"BLD",3463,"KRN",8994,"NM","B","MAGQ FTYPE",11)

"BLD",3463,"KRN",8994,"NM","B","MAGQ JBQUE",12)

"BLD",3463,"KRN",8994,"NM","B","MAGQ JBSCN",13)

"BLD",3463,"KRN",8994,"NM","B","MAGQ QCNT",14)

"BLD",3463,"KRN",8994,"NM","B","MAGQ QRNGE",15)

"BLD",3463,"KRN",8994,"NM","B","MAGQB QUEDEL",16)

"BLD",3463,"KRN",8994,"NM","B","MAGQBP ALL SHARES",17)

"BLD",3463,"KRN",8994,"NM","B","MAGQBP FREF",18)

"BLD",3463,"KRN","B",.4,.4)

"BLD",3463,"KRN","B",.401,.401)

"BLD",3463,"KRN","B",.402,.402)

"BLD",3463,"KRN","B",.403,.403)

"BLD",3463,"KRN","B",.5,.5)

"BLD",3463,"KRN","B",.84,.84)

"BLD",3463,"KRN","B",3.6,3.6)

"BLD",3463,"KRN","B",3.8,3.8)

"BLD",3463,"KRN","B",9.2,9.2)

"BLD",3463,"KRN","B",9.8,9.8)

"BLD",3463,"KRN","B",19,19)

"BLD",3463,"KRN","B",19.1,19.1)

"BLD",3463,"KRN","B",101,101)

"BLD",3463,"KRN","B",409.61,409.61)

"BLD",3463,"KRN","B",771,771)

"BLD",3463,"KRN","B",870,870)

"BLD",3463,"KRN","B",8989.51,8989.51)

"BLD",3463,"KRN","B",8989.52,8989.52)

"BLD",3463,"KRN","B",8994,8994)

"BLD",3463,"PRE")
MAGIP39E
"BLD",3463,"REQB",0)
^9.611^1^1
"BLD",3463,"REQB",1,0)
MAG*3.0*81^2
"BLD",3463,"REQB","B","MAG*3.0*81",1)

"FIA",2005.2)
NETWORK LOCATION
"FIA",2005.2,0)
^MAG(2005.2,
"FIA",2005.2,0,0)
2005.2I
"FIA",2005.2,0,1)
y^y^p^^^^n^^n
"FIA",2005.2,0,10)

"FIA",2005.2,0,11)

"FIA",2005.2,0,"RLRO")

"FIA",2005.2,2005.2)
1
"FIA",2005.2,2005.2,.01)

"FIA",2005.2,2005.2,.04)

"FIA",2005.2,2005.2,1)

"FIA",2005.2,2005.2,2)

"FIA",2005.2,2005.2,4)

"FIA",2005.2,2005.2,5.5)

"FIA",2005.2,2005.2,6)

"FIA",2005.2,2005.2,7)

"FIA",2005.2,2005.2,8)

"FIA",2005.2,2005.2,9)

"FIA",2005.2,2005.2,10)

"FIA",2005.2,2005.2,11)

"FIA",2005.2,2005.2,12)

"FIA",2005.2,2005.2,14)

"FIA",2005.2,2005.2,15)

"FIA",2005.2,2005.2,16)

"FIA",2005.2,2005.2,17)

"FIA",2005.2,2005.2,18)

"FIA",2005.2,2005.2,19)

"FIA",2005.2,2005.2,20)

"FIA",2005.2,2005.2,21)

"FIA",2005.2,2005.2,22)

"FIA",2005.2,2005.2,23)

"FIA",2005.2,2005.2,24)

"FIA",2005.2,2005.2,25)

"FIA",2005.2,2005.2,26)

"FIA",2005.2,2005.2,27)

"FIA",2005.2,2005.2,28)

"FIA",2005.2,2005.2,29)

"FIA",2005.2,2005.2,30)

"FIA",2005.2,2005.2,31)

"FIA",2005.2,2005.201)
0
"FIA",2005.2,2005.22)
0
"FIA",2005.86)
IMAGE ACTIONS
"FIA",2005.86,0)
^MAG(2005.86,
"FIA",2005.86,0,0)
2005.86
"FIA",2005.86,0,1)
y^y^p^^^^n^^n
"FIA",2005.86,0,10)

"FIA",2005.86,0,11)

"FIA",2005.86,0,"RLRO")

"FIA",2005.86,2005.86)
1
"FIA",2005.86,2005.86,6)

"FIA",2006.031)
IMAGE BACKGROUND QUEUE POINTER
"FIA",2006.031,0)
^MAGQUEUE(2006.031,
"FIA",2006.031,0,0)
2006.031
"FIA",2006.031,0,1)
y^y^p^^^^n^^n
"FIA",2006.031,0,10)

"FIA",2006.031,0,11)

"FIA",2006.031,0,"RLRO")

"FIA",2006.031,2006.031)
1
"FIA",2006.031,2006.031,4)

"FIA",2006.1)
IMAGING SITE PARAMETERS
"FIA",2006.1,0)
^MAG(2006.1,
"FIA",2006.1,0,0)
2006.1P
"FIA",2006.1,0,1)
y^y^p^^^^n^^n
"FIA",2006.1,0,10)

"FIA",2006.1,0,11)

"FIA",2006.1,0,"RLRO")

"FIA",2006.1,2006.1)
1
"FIA",2006.1,2006.1,.02)

"FIA",2006.1,2006.1,.03)

"FIA",2006.1,2006.1,.031)

"FIA",2006.1,2006.1,.04)

"FIA",2006.1,2006.1,.07)

"FIA",2006.1,2006.1,.08)

"FIA",2006.1,2006.1,1.02)

"FIA",2006.1,2006.1,1.03)

"FIA",2006.1,2006.1,2.01)

"FIA",2006.1,2006.1,6)

"FIA",2006.1,2006.1,8)

"FIA",2006.1,2006.1,9)

"FIA",2006.1,2006.1,10)

"FIA",2006.1,2006.1,11)

"FIA",2006.1,2006.1,11.9)

"FIA",2006.1,2006.1,12)

"FIA",2006.1,2006.1,12.5)

"FIA",2006.1,2006.1,20)

"FIA",2006.1,2006.1,22)

"FIA",2006.1,2006.1,23)

"FIA",2006.1,2006.1,24)

"FIA",2006.1,2006.1,60)

"FIA",2006.1,2006.1,60.1)

"FIA",2006.1,2006.1,60.2)

"FIA",2006.1,2006.1,60.3)

"FIA",2006.1,2006.1,60.4)

"FIA",2006.1,2006.1,60.5)

"FIA",2006.1,2006.1,61)

"FIA",2006.1,2006.1,61.1)

"FIA",2006.1,2006.1,61.2)

"FIA",2006.1,2006.1,61.3)

"FIA",2006.1,2006.1,61.4)

"FIA",2006.1,2006.1,62)

"FIA",2006.1,2006.1,62.1)

"FIA",2006.1,2006.1,62.2)

"FIA",2006.1,2006.1,62.3)

"FIA",2006.1,2006.1,62.4)

"FIA",2006.1,2006.1,62.5)

"FIA",2006.1,2006.1,62.6)

"FIA",2006.1,2006.1,63)

"FIA",2006.1,2006.1,63.1)

"FIA",2006.1,2006.1,63.2)

"FIA",2006.1,2006.1,63.3)

"FIA",2006.1,2006.1,63.4)

"FIA",2006.1,2006.1,66)

"FIA",2006.1,2006.1,103)

"FIA",2006.1,2006.1,124)

"FIA",2006.1,2006.1,125)

"FIA",2006.1,2006.11)
0
"FIA",2006.1,2006.112)
1
"FIA",2006.1,2006.112,.01)

"FIA",2006.1,2006.12)
1
"FIA",2006.1,2006.12,.01)

"FIA",2006.1,2006.166)
0
"FIA",2006.1,2006.1662)
0
"FIA",2006.1,2006.1664)
0
"FIA",2006.1,2006.1665)
0
"FIA",2006.8)
BP SERVERS
"FIA",2006.8,0)
^MAG(2006.8,
"FIA",2006.8,0,0)
2006.8I
"FIA",2006.8,0,1)
y^y^p^^^^n^^n
"FIA",2006.8,0,10)

"FIA",2006.8,0,11)

"FIA",2006.8,0,"RLRO")

"FIA",2006.8,2006.8)
1
"FIA",2006.8,2006.8,.01)

"FIA",2006.8,2006.8,.04)

"FIA",2006.8,2006.8,3)

"FIA",2006.8,2006.8,4)

"FIA",2006.8,2006.8,11)

"FIA",2006.8,2006.8,12)

"FIA",2006.8,2006.8,13)

"FIA",2006.8,2006.8,14)

"FIA",2006.8,2006.8,15)

"FIA",2006.8,2006.8,16)

"FIA",2006.8,2006.8,17)

"FIA",2006.8,2006.8,20)

"FIA",2006.8,2006.8,49)

"FIA",2006.8,2006.8,50)

"FIA",2006.8,2006.8,51)

"FIA",2006.8,2006.8,52)

"FIA",2006.8,2006.8,53)

"FIA",2006.8,2006.8,54)

"FIA",2006.8,2006.8,55)

"FIA",2006.95)
IMAGE ACCESS LOG
"FIA",2006.95,0)
^MAG(2006.95,
"FIA",2006.95,0,0)
2006.95I
"FIA",2006.95,0,1)
y^y^p^^^^n^^n
"FIA",2006.95,0,10)

"FIA",2006.95,0,11)

"FIA",2006.95,0,"RLRO")

"FIA",2006.95,2006.95)
1
"FIA",2006.95,2006.95,1)

"FIA",2006.95,2006.95,10)

"INI")
PRE^MAGIP39
"INIT")
POST^MAGIP39B
"IX",2005.2,2005.2,"C",0)
2005.2^C^PHYSICAL REFERENCE and OPERATIONAL STATUS^MU^^R^IR^I^2005.2^^^^^LS
"IX",2005.2,2005.2,"C",.1,0)
^^1^1^3030220^
"IX",2005.2,2005.2,"C",.1,1,0)
This cross reference keeps track of which devices are on (or off) line.
"IX",2005.2,2005.2,"C",1)
S ^MAG(2005.2,"C",X(1),X(2),DA)=""
"IX",2005.2,2005.2,"C",2)
K ^MAG(2005.2,"C",X(1),X(2),DA)
"IX",2005.2,2005.2,"C",2.5)
K ^MAG(2005.2,"C")
"IX",2005.2,2005.2,"C",11.1,0)
^.114IA^2^2
"IX",2005.2,2005.2,"C",11.1,1,0)
1^F^2005.2^1^63^1^F
"IX",2005.2,2005.2,"C",11.1,2,0)
2^F^2005.2^5^^2^F
"IX",2005.2,2005.2,"D",0)
2005.2^D^Place and Name^R^^R^IR^I^2005.2^^^^^LS
"IX",2005.2,2005.2,"D",.1,0)
^^2^2^3090529^
"IX",2005.2,2005.2,"D",.1,1,0)
This cross reference will be used to check for uniqueness for
"IX",2005.2,2005.2,"D",.1,2,0)
Place (#.04) and Name (#.01).
"IX",2005.2,2005.2,"D",1)
S ^MAG(2005.2,"D",X(1),$E(X(2),1,30),DA)=""
"IX",2005.2,2005.2,"D",2)
K ^MAG(2005.2,"D",X(1),$E(X(2),1,30),DA)
"IX",2005.2,2005.2,"D",2.5)
K ^MAG(2005.2,"D")
"IX",2005.2,2005.2,"D",11.1,0)
^.114IA^2^2
"IX",2005.2,2005.2,"D",11.1,1,0)
1^F^2005.2^.04^^1^F
"IX",2005.2,2005.2,"D",11.1,2,0)
2^F^2005.2^.01^30^2^F
"IX",2005.2,2005.2,"F",0)
2005.2^F^Place and Storage type index^R^^R^IR^I^2005.2^^^^^LS
"IX",2005.2,2005.2,"F",1)
S ^MAG(2005.2,"F",X(1),X(2),DA)=""
"IX",2005.2,2005.2,"F",2)
K ^MAG(2005.2,"F",X(1),X(2),DA)
"IX",2005.2,2005.2,"F",2.5)
K ^MAG(2005.2,"F")
"IX",2005.2,2005.2,"F",11.1,0)
^.114IA^2^2
"IX",2005.2,2005.2,"F",11.1,1,0)
1^F^2005.2^.04^^1^F
"IX",2005.2,2005.2,"F",11.1,1,3)

"IX",2005.2,2005.2,"F",11.1,2,0)
2^F^2005.2^6^^2^F
"IX",2005.2,2005.2,"F",11.1,2,3)

"IX",2005.2,2005.2,"G",0)
2005.2^G^Sort for Place and Physical Reference^R^^R^IR^I^2005.2^^^^^LS
"IX",2005.2,2005.2,"G",.1,0)
^^2^2^3090529^
"IX",2005.2,2005.2,"G",.1,1,0)
This allows the input transform to evaluate for unique network shares
"IX",2005.2,2005.2,"G",.1,2,0)
within a given platform.
"IX",2005.2,2005.2,"G",1)
S ^MAG(2005.2,"G",X(1),$E(X(2),1,30),DA)=""
"IX",2005.2,2005.2,"G",2)
K ^MAG(2005.2,"G",X(1),$E(X(2),1,30),DA)
"IX",2005.2,2005.2,"G",2.5)
K ^MAG(2005.2,"G")
"IX",2005.2,2005.2,"G",11.1,0)
^.114IA^2^2
"IX",2005.2,2005.2,"G",11.1,1,0)
1^F^2005.2^.04^^1^F
"IX",2005.2,2005.2,"G",11.1,1,3)

"IX",2005.2,2005.2,"G",11.1,2,0)
2^F^2005.2^1^30^2^F
"IX",2005.2,2005.2,"G",11.1,2,3)

"IX",2006.8,2006.8,"C",0)
2006.8^C^Uniqueness Index for Key 'A' of File #2006.8^R^^R^IR^I^2006.8^^^^^LS
"IX",2006.8,2006.8,"C",1)
S ^MAG(2006.8,"C",X(1),X(2),DA)=""
"IX",2006.8,2006.8,"C",2)
K ^MAG(2006.8,"C",X(1),X(2),DA)
"IX",2006.8,2006.8,"C",2.5)
K ^MAG(2006.8,"C")
"IX",2006.8,2006.8,"C",11.1,0)
^.114IA^2^2
"IX",2006.8,2006.8,"C",11.1,1,0)
1^F^2006.8^.04^^1
"IX",2006.8,2006.8,"C",11.1,2,0)
2^F^2006.8^50^^2
"IX",2006.8,2006.8,"D",0)
2006.8^D^Uniqueness Index for Key 'B' of File #2006.8^R^^R^IR^I^2006.8^^^^^LS
"IX",2006.8,2006.8,"D",1)
S ^MAG(2006.8,"D",X(1),X(2),DA)=""
"IX",2006.8,2006.8,"D",2)
K ^MAG(2006.8,"D",X(1),X(2),DA)
"IX",2006.8,2006.8,"D",2.5)
K ^MAG(2006.8,"D")
"IX",2006.8,2006.8,"D",11.1,0)
^.114IA^2^2
"IX",2006.8,2006.8,"D",11.1,1,0)
1^F^2006.8^.04^^1
"IX",2006.8,2006.8,"D",11.1,2,0)
2^F^2006.8^.01^^2
"KEY",2006.8,2006.8,"A",0)
2006.8^A^P^418
"KEY",2006.8,2006.8,"A",2,0)
^.312IA^2^2
"KEY",2006.8,2006.8,"A",2,1,0)
.04^2006.8^1
"KEY",2006.8,2006.8,"A",2,2,0)
50^2006.8^2
"KEY",2006.8,2006.8,"B",0)
2006.8^B^S^419
"KEY",2006.8,2006.8,"B",2,0)
^.312IA^2^2
"KEY",2006.8,2006.8,"B",2,1,0)
.04^2006.8^1
"KEY",2006.8,2006.8,"B",2,2,0)
.01^2006.8^2
"KEYPTR",2006.8,2006.8,"A")
2006.8^C
"KEYPTR",2006.8,2006.8,"B")
2006.8^D
"KRN",19,123457,-1)
0^1
"KRN",19,123457,0)
MAGQ BPMONITOR^Monitor Background Processor Activity^^R^^^^^^^^IMAGING
"KRN",19,123457,1,0)
^19.06^20^20^3100406^^^^
"KRN",19,123457,1,1,0)
This menu option is used to monitor the queue processing activities on
"KRN",19,123457,1,2,0)
the Background Processor. Inactivity by this application will be reported
"KRN",19,123457,1,3,0)
to the mail groups: G.MAG SERVER and G.MAG_nn_VI_BP_Queue_Processo.
"KRN",19,123457,1,4,0)
Inactivity is determined by the timestamp on the last queue processed and
"KRN",19,123457,1,5,0)
if there are queues still to be processed.  If the time is greater than
"KRN",19,123457,1,6,0)
the time specified in the calling routine than a mail message will be
"KRN",19,123457,1,7,0)
sent.   Time specified is passed in a parameter when calling the routine.
"KRN",19,123457,1,8,0)
     CBP^MAGQCBP(15)
"KRN",19,123457,1,9,0)
In the above example, the time lapsed to be determined since the last
"KRN",19,123457,1,10,0)
queue was processed is 15 minutes.   This parameter can be modified by
"KRN",19,123457,1,11,0)
editing this menu option and changing the '(15)' in the ROUTINE field.
"KRN",19,123457,1,12,0)
 
"KRN",19,123457,1,13,0)
Recommend scheduling this task using the Kernel's Schedule\Unschedule Options.
"KRN",19,123457,1,14,0)
The following are optional parameters that can be defined when scheduling this task:
"KRN",19,123457,1,15,0)
 
"KRN",19,123457,1,16,0)
     MAGMIN - determines the lapse time between processing tasks.  If the variable is undefined, then the default value is 15 minutes.  If an active queue has not processed with specified minutes then a mail message is sent. 
"KRN",19,123457,1,17,0)
 
"KRN",19,123457,1,18,0)
     MAGFQ - determines if failed queues have reached this limit.  If the variable is undefined, then the default value is 1,000.  If failed queues are above this limit, then a mail message is sent. 
"KRN",19,123457,1,19,0)
 
"KRN",19,123457,1,20,0)
   MAGEVAL - determines if EVAL queues have reached this limit. If the variable is undefined, then the default value is 10,000.  If EVAL queues are above this limit, then a mail message is sent.
"KRN",19,123457,25)
CBP^MAGQCBP(15)
"KRN",19,123457,83)
Y
"KRN",19,123457,200.9)
y^y
"KRN",19,123457,"U")
MONITOR BACKGROUND PROCESSOR A
"KRN",8994,123458,-1)
0^1
"KRN",8994,123458,0)
MAG FIELD VALIDATE^DVAL^MAGQBUT4^1^R^0
"KRN",8994,123458,1,0)
^8994.01^2^2^3100908^^^^
"KRN",8994,123458,1,1,0)
This provides an interface with the VA Fileman Database Server (DBS)
"KRN",8994,123458,1,2,0)
API for the single field validator: VAL^DIE.
"KRN",8994,123458,2,0)
^8994.02A^5^5
"KRN",8994,123458,2,1,0)
FILE^1^99^1^1
"KRN",8994,123458,2,1,1,0)
^8994.021^1^1^3100908^^
"KRN",8994,123458,2,1,1,1,0)
This is the file number that contains the attribute to be validated.
"KRN",8994,123458,2,2,0)
IENS^1^99^1^2
"KRN",8994,123458,2,2,1,0)
^8994.021^1^1^3100908^^
"KRN",8994,123458,2,2,1,1,0)
This is the record number or place holder of the entry being validated.
"KRN",8994,123458,2,3,0)
FIELD^1^99^1^3
"KRN",8994,123458,2,3,1,0)
^8994.021^1^1^3100908^^
"KRN",8994,123458,2,3,1,1,0)
This is the number of the file attribute to be validated.
"KRN",8994,123458,2,4,0)
FLAGS^1^99^0^4
"KRN",8994,123458,2,4,1,0)
^8994.021^13^13^3100908^^
"KRN",8994,123458,2,4,1,1,0)
This is the option set of parameters defined for the VAL^DIE
"KRN",8994,123458,2,4,1,2,0)
E External value is returned in RESULT(0).
"KRN",8994,123458,2,4,1,3,0)
 
"KRN",8994,123458,2,4,1,4,0)
F FDA node is set for valid data in array identified by FDA_ROOT.
"KRN",8994,123458,2,4,1,5,0)
 
"KRN",8994,123458,2,4,1,6,0)
H Help (single ?) is returned if VALUE is not valid.
"KRN",8994,123458,2,4,1,7,0)
 
"KRN",8994,123458,2,4,1,8,0)
R Record identified by IENS is verified to exist and to be editable. Do
"KRN",8994,123458,2,4,1,9,0)
not  include "R" if there are placeholders in the IENS.
"KRN",8994,123458,2,4,1,10,0)
 
"KRN",8994,123458,2,4,1,11,0)
U Don't perform key validation. Without this flag, the data in VALUE is
"KRN",8994,123458,2,4,1,12,0)
checked to ensure that no duplicate keys are created and that key field 
"KRN",8994,123458,2,4,1,13,0)
values are not deleted.
"KRN",8994,123458,2,5,0)
VALUE^1^99^1^5
"KRN",8994,123458,2,5,1,0)
^8994.021^1^1^3100908^^^^
"KRN",8994,123458,2,5,1,1,0)
This is the value to be validated.
"KRN",8994,123458,2,"B","FIELD",3)

"KRN",8994,123458,2,"B","FILE",1)

"KRN",8994,123458,2,"B","FLAGS",4)

"KRN",8994,123458,2,"B","IENS",2)

"KRN",8994,123458,2,"B","VALUE",5)

"KRN",8994,123458,2,"PARAMSEQ",1,1)

"KRN",8994,123458,2,"PARAMSEQ",2,2)

"KRN",8994,123458,2,"PARAMSEQ",3,3)

"KRN",8994,123458,2,"PARAMSEQ",4,4)

"KRN",8994,123458,2,"PARAMSEQ",5,5)

"KRN",8994,123458,3,0)
^8994.03^14^14^3100908^^^^
"KRN",8994,123458,3,1,0)
It returns the resolved external value or -1 followed by the carat 
"KRN",8994,123458,3,2,0)
delimiter and one of the following error messages:
"KRN",8994,123458,3,3,0)
 
"KRN",8994,123458,3,4,0)
120 Error occurred during execution of a FileMan hook.
"KRN",8994,123458,3,5,0)
299 Ambiguous value. (Variable Pointer data type only.)
"KRN",8994,123458,3,6,0)
405 The file is uneditable.
"KRN",8994,123458,3,7,0)
520 The field's data type or INPUT transform is inappropriate.
"KRN",8994,123458,3,8,0)
602 The entry cannot be edited.
"KRN",8994,123458,3,9,0)
701 Value is invalid.
"KRN",8994,123458,3,10,0)
710 The field is uneditable.
"KRN",8994,123458,3,11,0)
712 An inappropriate deletion of a field's value is being attempted.
"KRN",8994,123458,3,12,0)
740 A duplicate key is produced by a field's new value.
"KRN",8994,123458,3,13,0)
742 A value for a field in a key is being deleted.
"KRN",8994,123458,3,14,0)
1610 Help was improperly requested.
"KRN",8994,123459,-1)
0^2
"KRN",8994,123459,0)
MAG KEY VALIDATE^KVAL^MAGQBUT4^1^R^0
"KRN",8994,123459,1,0)
^^8^8^3100326^
"KRN",8994,123459,1,1,0)
This is a an interface to the Database Server (DBS) utility:
"KRN",8994,123459,1,2,0)
Key Validator
"KRN",8994,123459,1,3,0)
 
"KRN",8994,123459,1,4,0)
The Key Validator extrinsic function verifies that new values contained 
"KRN",8994,123459,1,5,0)
in the FDA do not produce an invalid key. All keys in which any field in 
"KRN",8994,123459,1,6,0)
the FDA participates are checked. If the value for a field in a key being 
"KRN",8994,123459,1,7,0)
checked is not present in the FDA, the value used to verify the key is 
"KRN",8994,123459,1,8,0)
obtained from the previously filed data.
"KRN",8994,123459,2,0)
^8994.02A^2^2
"KRN",8994,123459,2,1,0)
FLAGS^1^9^0^1
"KRN",8994,123459,2,1,1,0)
^^3^3^3100326^
"KRN",8994,123459,2,1,1,1,0)
(Optional) Flags to control processing. The possible values are:
"KRN",8994,123459,2,1,1,2,0)
 
"KRN",8994,123459,2,1,1,3,0)
Q  Quit when the first problem in the FDA is encountered.
"KRN",8994,123459,2,2,0)
FDA^2^99^1^2
"KRN",8994,123459,2,2,1,0)
^^7^7^3100326^
"KRN",8994,123459,2,2,1,1,0)
The root of the FDA that contains the data to be checked. The array can 
"KRN",8994,123459,2,2,1,2,0)
be a local or global one. See the Database Server Introduction for 
"KRN",8994,123459,2,2,1,3,0)
details of the structure of the FDA.
"KRN",8994,123459,2,2,1,4,0)
The value of fields in the FDA must be the internal value. Do not pass 
"KRN",8994,123459,2,2,1,5,0)
external (e.g., unresolved pointer values, non-FileMan dates) in the FDA.
"KRN",8994,123459,2,2,1,6,0)
No action is taken on fields in the referenced FDA if those fields do not 
"KRN",8994,123459,2,2,1,7,0)
participate in a Key defined in the KEY file.
"KRN",8994,123459,2,"B","FDA",2)

"KRN",8994,123459,2,"B","FLAGS",1)

"KRN",8994,123459,2,"PARAMSEQ",1,1)

"KRN",8994,123459,2,"PARAMSEQ",2,2)

"KRN",8994,123459,3,0)
^^8^8^3100326^
"KRN",8994,123459,3,1,0)
This Boolean function returns a 1 if key integrity is not violated by any 
"KRN",8994,123459,3,2,0)
value in the FDA and a -1 followed by a carat delimiter and an error 
"KRN",8994,123459,3,3,0)
message describing the nature of an invalid key that  was produced by any
"KRN",8994,123459,3,4,0)
of the values. 
"KRN",8994,123459,3,5,0)
 
"KRN",8994,123459,3,6,0)
740 A duplicate key is produced by a field's new value.
"KRN",8994,123459,3,7,0)
742 A value for a field in a key is being deleted.
"KRN",8994,123459,3,8,0)
744 Not all fields in a key have a value.
"KRN",8994,123460,-1)
0^3
"KRN",8994,123460,0)
MAGQ ADD RAID GROUP^ADDRG^MAGQBUT5^1^R
"KRN",8994,123460,1,0)
^8994.01^3^3^3100406^^^
"KRN",8994,123460,1,1,0)
This is used to create the next RAID group for the Network Location
"KRN",8994,123460,1,2,0)
file (#2005.2).  It will generate a group name that includes 
"KRN",8994,123460,1,3,0)
the sites namespace and the next logical sequence number.
"KRN",8994,123460,2,0)
^8994.02A^2^2
"KRN",8994,123460,2,1,0)
NUMBER^1^99^1^1
"KRN",8994,123460,2,1,1,0)
^^2^2^3090507^
"KRN",8994,123460,2,1,1,1,0)
This value determines the number of RAID groups to be added to the sites
"KRN",8994,123460,2,1,1,2,0)
Network Location file (#2005.2).
"KRN",8994,123460,2,2,0)
PLACE^1^99^^2
"KRN",8994,123460,2,2,1,0)
^8994.021^2^2^3100406^^
"KRN",8994,123460,2,2,1,1,0)
This is the place value, an entry in the IMAGING SITE PARAMETER (#2006.1)
"KRN",8994,123460,2,2,1,2,0)
file, for the RAID group entry being defined.
"KRN",8994,123460,2,"B","NUMBER",1)

"KRN",8994,123460,2,"B","PLACE",2)

"KRN",8994,123460,2,"PARAMSEQ",1,1)

"KRN",8994,123460,2,"PARAMSEQ",2,2)

"KRN",8994,123461,-1)
0^4
"KRN",8994,123461,0)
MAGQ ALL SERVER^ALLSERV^MAGQBUT1^2^R
"KRN",8994,123461,1,0)
^8994.01^7^7^3100810^^^^
"KRN",8994,123461,1,1,0)
Returns a list of all online file servers at a site.
"KRN",8994,123461,1,2,0)
This network location file list requires the following from each
"KRN",8994,123461,1,3,0)
candidate:
"KRN",8994,123461,1,4,0)
ONLINE
"KRN",8994,123461,1,5,0)
type: MAG
"KRN",8994,123461,1,6,0)
path does not contain: ":"
"KRN",8994,123461,1,7,0)
NON-ROUTER 
"KRN",8994,123461,2,0)
^8994.02A^2^2
"KRN",8994,123461,2,1,0)
null
"KRN",8994,123461,2,1,1,0)
^8994.021^1^1^3070829^^
"KRN",8994,123461,2,1,1,1,0)
No input parameter required.
"KRN",8994,123461,2,2,0)
GROUP^1^16^1^1
"KRN",8994,123461,2,2,1,0)
^8994.021^2^2^3100810^^^
"KRN",8994,123461,2,2,1,1,0)
This value should be either "GROUP" or "ALL" to differentiate
"KRN",8994,123461,2,2,1,2,0)
between a Current Write Group Update and an All share update.
"KRN",8994,123461,2,"B","GROUP",2)

"KRN",8994,123461,2,"B","null",1)

"KRN",8994,123461,2,"PARAMSEQ",1,2)

"KRN",8994,123461,3,0)
^8994.03^8^8^3090531^^^^
"KRN",8994,123461,3,1,0)
(0)="-1^No additional servers to process" or
"KRN",8994,123461,3,2,0)
share network path of the current Vista Imaging Write Location first  
"KRN",8994,123461,3,3,0)
(0)=network path^Location file(#2005.2) IEN^free space^disk capacity
"KRN",8994,123461,3,4,0)
(1)= "
"KRN",8994,123461,3,5,0)
(2)= "
"KRN",8994,123461,3,6,0)
 .
"KRN",8994,123461,3,7,0)
 .
"KRN",8994,123461,3,8,0)
 .
"KRN",8994,123462,-1)
0^5
"KRN",8994,123462,0)
MAGQ BP UAT^UAT^MAGQBUT5^1^R
"KRN",8994,123462,1,0)
^8994.01^3^3^3091204^
"KRN",8994,123462,1,1,0)
This procedure validates the BP Server task assignments and rebuilds the 
"KRN",8994,123462,1,2,0)
content of the dummy BP Server, "Unassigned Tasks" with the tasks that 
"KRN",8994,123462,1,3,0)
are not currently assigned to a BP server.
"KRN",8994,123462,2,0)
^8994.02A^1^1
"KRN",8994,123462,2,1,0)
PLACE^1^4^1^1
"KRN",8994,123462,2,1,1,0)
^^2^2^3091204^
"KRN",8994,123462,2,1,1,1,0)
This is the reference to the Site Parameter file to which the BP Servers 
"KRN",8994,123462,2,1,1,2,0)
are assigned.
"KRN",8994,123462,2,"B","PLACE",1)

"KRN",8994,123462,2,"PARAMSEQ",1,1)

"KRN",8994,123463,-1)
0^6
"KRN",8994,123463,0)
MAGQ DEL NLOC^RLOCA^MAGQBU6A^1^S
"KRN",8994,123463,1,0)
^8994.01^2^2^3090915^^
"KRN",8994,123463,1,1,0)
This is used to remove Network Location entries
"KRN",8994,123463,1,2,0)
and requires the user to have the MAG SYS key.
"KRN",8994,123463,2,0)
^8994.02A^1^1
"KRN",8994,123463,2,1,0)
Network location file entry^1^30^1^1
"KRN",8994,123463,2,1,1,0)
^8994.021^1^1^3090528^^^^
"KRN",8994,123463,2,1,1,1,0)
This is the Network Location file entry number.
"KRN",8994,123463,2,"B","Network location file entry",1)

"KRN",8994,123463,2,"PARAMSEQ",1,1)

"KRN",8994,123463,3,0)
^8994.03^1^1^3090528^^
"KRN",8994,123463,3,1,0)
The value of 0 means the entry could not be deleted.  The value of 1 means the entry was deleted.
"KRN",8994,123464,-1)
0^7
"KRN",8994,123464,0)
MAGQ DFNIQ^DFNIQ^MAGQBPG1^1^R
"KRN",8994,123464,1,0)
^8994.01^2^2^3070905^^^^
"KRN",8994,123464,1,1,0)
This provides a method of sending a Patient DFN VistA
"KRN",8994,123464,1,2,0)
 mail message from client methods.
"KRN",8994,123464,2,0)
^8994.02A^6^4
"KRN",8994,123464,2,3,0)
DATA^1^^1^1
"KRN",8994,123464,2,3,1,0)
^8994.021^1^1^3070905^^^
"KRN",8994,123464,2,3,1,1,0)
This is the message content that is sent if the Send Flag is set.
"KRN",8994,123464,2,4,0)
PLACE^1^1^1^3
"KRN",8994,123464,2,4,1,0)
^8994.021^3^3^3070905^^^
"KRN",8994,123464,2,4,1,1,0)
This is the internal entry number of the site parameter file 
"KRN",8994,123464,2,4,1,2,0)
that designates the local Imaging configuration from which this message
"KRN",8994,123464,2,4,1,3,0)
is addressed.
"KRN",8994,123464,2,5,0)
SEND^1^1^1^2
"KRN",8994,123464,2,5,1,0)
^8994.021^2^2^3070905^^
"KRN",8994,123464,2,5,1,1,0)
If this is the last line of the message and if this value is set to
"KRN",8994,123464,2,5,1,2,0)
"1" then the message will be sent.
"KRN",8994,123464,2,6,0)
APPLICATION^1^36^1^4
"KRN",8994,123464,2,6,1,0)
^8994.021^1^1^3070905^^
"KRN",8994,123464,2,6,1,1,0)
This value is set to the application that has created this message.
"KRN",8994,123464,2,"B","APPLICATION",6)

"KRN",8994,123464,2,"B","DATA",3)

"KRN",8994,123464,2,"B","PLACE",4)

"KRN",8994,123464,2,"B","SEND",5)

"KRN",8994,123464,2,"B","data",1)

"KRN",8994,123464,2,"B","send",2)

"KRN",8994,123464,2,"PARAMSEQ",1,3)

"KRN",8994,123464,2,"PARAMSEQ",2,5)

"KRN",8994,123464,2,"PARAMSEQ",3,4)

"KRN",8994,123464,2,"PARAMSEQ",4,6)

"KRN",8994,123465,-1)
0^8
"KRN",8994,123465,0)
MAGQ ELOGR^ELOGR^MAGQBPRG^2^R
"KRN",8994,123465,1,0)
^8994.01^4^4^3100827^^^^
"KRN",8994,123465,1,1,0)
This provides a method of capturing errors logged during the purge
"KRN",8994,123465,1,2,0)
process.  This function provides a list which can be examined at a later
"KRN",8994,123465,1,3,0)
date and will be rolled into the purge log file on the BP Server 
"KRN",8994,123465,1,4,0)
which performed the purge.
"KRN",8994,123465,2,0)
^8994.02A^2^2
"KRN",8994,123465,2,1,0)
NULL^^^0
"KRN",8994,123465,2,1,1,0)
^8994.021^1^1^3100819^^
"KRN",8994,123465,2,1,1,1,0)
No input parameter is defined.
"KRN",8994,123465,2,2,0)
LIMIT^1^5^1^1
"KRN",8994,123465,2,2,1,0)
^^1^1^3100819^
"KRN",8994,123465,2,2,1,1,0)
This value is used to control the array size.
"KRN",8994,123465,2,"B","LIMIT",2)

"KRN",8994,123465,2,"B","NULL",1)

"KRN",8994,123465,2,"PARAMSEQ",1,2)

"KRN",8994,123465,3,0)
^8994.03^3^3^3100819^^^^
"KRN",8994,123465,3,1,0)
This is a list of the file names and image file (#2005) references
"KRN",8994,123465,3,2,0)
which could not successfully be evaluated by the purge process.
"KRN",8994,123465,3,3,0)
"filename^2005 ptr"
"KRN",8994,123466,-1)
0^9
"KRN",8994,123466,0)
MAGQ FINDC^FINDC^MAGQBUT5^1^R^0
"KRN",8994,123466,1,0)
^8994.01^3^3^3090915^^^^
"KRN",8994,123466,1,1,0)
By placing carat delimited values in the find value parameter
"KRN",8994,123466,1,2,0)
the subscriber can perform a compound index lookup on an 
"KRN",8994,123466,1,3,0)
extended primary key.
"KRN",8994,123466,2,0)
^8994.02A^6^6
"KRN",8994,123466,2,1,0)
FNUM^1^30^1^1
"KRN",8994,123466,2,1,1,0)
^^1^1^3080701^
"KRN",8994,123466,2,1,1,1,0)
The file number of the content table.
"KRN",8994,123466,2,2,0)
IENS^1^30^0^2
"KRN",8994,123466,2,2,1,0)
^^1^1^3080701^
"KRN",8994,123466,2,2,1,1,0)
The IENS of the main level or subfile level of the content table.
"KRN",8994,123466,2,3,0)
FLAGS^1^30^0^3
"KRN",8994,123466,2,3,1,0)
^^1^1^3080701^
"KRN",8994,123466,2,3,1,1,0)
The FIND1^DIC lookup options.
"KRN",8994,123466,2,4,0)
FNDVALUE^1^60^1^4
"KRN",8994,123466,2,4,1,0)
^8994.021^2^2^3090915^^
"KRN",8994,123466,2,4,1,1,0)
The carat delimited lookup.  Each piece is the same as 
"KRN",8994,123466,2,4,1,2,0)
the subscript in the index.
"KRN",8994,123466,2,5,0)
XREF^1^30^0^5
"KRN",8994,123466,2,5,1,0)
^8994.021^1^1^3090318^^
"KRN",8994,123466,2,5,1,1,0)
The subscriber specified cross reference for the lookup.
"KRN",8994,123466,2,6,0)
SCREEN^1^30^0^6
"KRN",8994,123466,2,6,1,0)
^8994.021^1^1^3090915^^^^
"KRN",8994,123466,2,6,1,1,0)
The subscriber specified DIC("S") logic for the lookup.
"KRN",8994,123466,2,"B","FLAGS",3)

"KRN",8994,123466,2,"B","FNDVALUE",4)

"KRN",8994,123466,2,"B","FNUM",1)

"KRN",8994,123466,2,"B","IENS",2)

"KRN",8994,123466,2,"B","SCREEN",6)

"KRN",8994,123466,2,"B","XREF",5)

"KRN",8994,123466,2,"PARAMSEQ",1,1)

"KRN",8994,123466,2,"PARAMSEQ",2,2)

"KRN",8994,123466,2,"PARAMSEQ",3,3)

"KRN",8994,123466,2,"PARAMSEQ",4,4)

"KRN",8994,123466,2,"PARAMSEQ",5,5)

"KRN",8994,123466,2,"PARAMSEQ",6,6)

"KRN",8994,123466,3,0)
^8994.03^1^1^3090915^^^^
"KRN",8994,123466,3,1,0)
The Internal entry number of the lookup value.
"KRN",8994,123467,-1)
0^10
"KRN",8994,123467,0)
MAGQ FS CHNGE^CHGSERV^MAGQBUT^1^R
"KRN",8994,123467,1,0)
^8994.01^7^7^3090531^^^^
"KRN",8994,123467,1,1,0)
Finds the available network file server with the most space, 
"KRN",8994,123467,1,2,0)
changes the current write space pointer and returns the IEN.
"KRN",8994,123467,1,3,0)
The candidate list requires the following criteria:
"KRN",8994,123467,1,4,0)
ONLINE
"KRN",8994,123467,1,5,0)
type: MAG
"KRN",8994,123467,1,6,0)
path does not contain: ":"
"KRN",8994,123467,1,7,0)
NON-ROUTER
"KRN",8994,123467,2,0)
^8994.02A^4^4
"KRN",8994,123467,2,1,0)
null
"KRN",8994,123467,2,1,1,0)
^8994.021^1^1^3070905^^^
"KRN",8994,123467,2,1,1,1,0)
No input parameter required.
"KRN",8994,123467,2,2,0)
NOTIFY^1^2^1^1
"KRN",8994,123467,2,2,1,0)
^8994.021^3^3^3070905^^^
"KRN",8994,123467,2,2,1,1,0)
A message will be sent to the G.MAG_SERVER mail group if this value is set 
"KRN",8994,123467,2,2,1,2,0)
to '1' and if the share space does not meet the lower limit as established
"KRN",8994,123467,2,2,1,3,0)
by the PERCENT SERVER RESERVE (#11) in the SITE PARAMETER FILE (#2006.1).
"KRN",8994,123467,2,3,0)
BP OS^1^99^0^2
"KRN",8994,123467,2,3,1,0)
^8994.021^1^1^3080819^^^
"KRN",8994,123467,2,3,1,1,0)
This is the Microsoft Windows operating system name and version.
"KRN",8994,123467,2,4,0)
BPWS^1^99^0^3
"KRN",8994,123467,2,4,1,0)
^8994.021^1^1^3090531^^^
"KRN",8994,123467,2,4,1,1,0)
This is the Background Processor network computer name.
"KRN",8994,123467,2,"B","BP OS",3)

"KRN",8994,123467,2,"B","BPWS",4)

"KRN",8994,123467,2,"B","NOTIFY",2)

"KRN",8994,123467,2,"B","null",1)

"KRN",8994,123467,2,"PARAMSEQ",1,2)

"KRN",8994,123467,2,"PARAMSEQ",2,3)

"KRN",8994,123467,2,"PARAMSEQ",3,4)

"KRN",8994,123467,3,0)
^8994.03^6^6^3090531^^^^
"KRN",8994,123467,3,1,0)
In the first caret piece the following is returned:
"KRN",8994,123467,3,2,0)
-1=NO RG MEMEBERS, 0=BELOW RESERVE,1=ABOVE RESERVE*PURGE FACTOR,2=BETWEEN RESERVE AND RESERVE*PURGE FACTOR
"KRN",8994,123467,3,3,0)
The second caret piece is the network share path of the current write location
"KRN",8994,123467,3,4,0)
The third piece is total disk space. The fourth is the purge boolean value.
"KRN",8994,123467,3,5,0)
The fifth piece is the percent server reserve.  The sixth is the
"KRN",8994,123467,3,6,0)
purge group and the 7th piece is the verifier Boolean value.
"KRN",8994,123468,-1)
0^11
"KRN",8994,123468,0)
MAGQ FTYPE^FTYPE^MAGQBUT5^2^R
"KRN",8994,123468,1,0)
^8994.01^3^3^3000505^^
"KRN",8994,123468,1,1,0)
This RPC returns an array of file types which the background processor
"KRN",8994,123468,1,2,0)
will use to move files from magnetic to jukebox and back for this
"KRN",8994,123468,1,3,0)
Vista installation.
"KRN",8994,123468,2,0)
^8994.02A^1^1
"KRN",8994,123468,2,1,0)
NULL^^^0
"KRN",8994,123468,2,1,1,0)
^^1^1^3000505^
"KRN",8994,123468,2,1,1,1,0)
No input parameter required.
"KRN",8994,123468,2,"B","NULL",1)

"KRN",8994,123468,3,0)
^8994.03^5^5^3000505^^
"KRN",8994,123468,3,1,0)
RESULT(0)="TXT"
"KRN",8994,123468,3,2,0)
RESULT(1)="TIF"
"KRN",8994,123468,3,3,0)
.
"KRN",8994,123468,3,4,0)
.
"KRN",8994,123468,3,5,0)
.
"KRN",8994,123469,-1)
0^12
"KRN",8994,123469,0)
MAGQ JBQUE^JBQUE^MAGQBUT2^1^R
"KRN",8994,123469,1,0)
^8994.01^1^1^3110118^^
"KRN",8994,123469,1,1,0)
This RPC generates a JUKEBOX queue.
"KRN",8994,123469,2,0)
^8994.02A^1^1
"KRN",8994,123469,2,1,0)
IEN^1^256^1^1
"KRN",8994,123469,2,1,1,0)
^^3^3^3110119^
"KRN",8994,123469,2,1,1,1,0)
This is the internal entry of either the Image file (#2005) or the Image 
"KRN",8994,123469,2,1,1,2,0)
Audit file (#2005.1) of the Image to be queued.
"KRN",8994,123469,2,1,1,3,0)
.
"KRN",8994,123469,2,"B","IEN",1)

"KRN",8994,123469,2,"PARAMSEQ",1,1)

"KRN",8994,123469,3,0)
^^2^2^3110118^
"KRN",8994,123469,3,1,0)
This is the internal entry number of the IMAGE BACKGROUND QUEUE file 
"KRN",8994,123469,3,2,0)
(#2006.03) that is generated by this RPC.
"KRN",8994,123470,-1)
0^13
"KRN",8994,123470,0)
MAGQ JBSCN^CNP2^MAGQBPG1^1^R
"KRN",8994,123470,1,0)
^8994.01^2^2^3070905^^^
"KRN",8994,123470,1,1,0)
This function returns the next image file entry to be evaluated by the
"KRN",8994,123470,1,2,0)
BP Verifier function.
"KRN",8994,123470,2,0)
^8994.02A^4^4
"KRN",8994,123470,2,1,0)
IEN^1^256^1^1
"KRN",8994,123470,2,1,1,0)
^8994.021^1^1^3070905^^^^
"KRN",8994,123470,2,1,1,1,0)
This value is the initial $Order value applied to the Image file.
"KRN",8994,123470,2,2,0)
START^2^32^1^2
"KRN",8994,123470,2,2,1,0)
^8994.021^1^1^3070905^^^
"KRN",8994,123470,2,2,1,1,0)
This is the starting IEN for the BP Verifier session.
"KRN",8994,123470,2,3,0)
STOP^1^32^1^3
"KRN",8994,123470,2,3,1,0)
^8994.021^1^1^3070905^^^
"KRN",8994,123470,2,3,1,1,0)
This is the ending IEN for the BP Verifier session.
"KRN",8994,123470,2,4,0)
AUTO^1^1^0^4
"KRN",8994,123470,2,4,1,0)
^8994.021^1^1^3070905^^^^
"KRN",8994,123470,2,4,1,1,0)
When set this will allow the BP Verifier session to terminate automatically.
"KRN",8994,123470,2,"B","AUTO",4)

"KRN",8994,123470,2,"B","IEN",1)

"KRN",8994,123470,2,"B","START",2)

"KRN",8994,123470,2,"B","STOP",3)

"KRN",8994,123470,2,"PARAMSEQ",1,1)

"KRN",8994,123470,2,"PARAMSEQ",2,2)

"KRN",8994,123470,2,"PARAMSEQ",3,3)

"KRN",8994,123470,2,"PARAMSEQ",4,4)

"KRN",8994,123470,3,0)
^8994.03^2^2^3070905^^^
"KRN",8994,123470,3,1,0)
A string containing each of the network and Jukebox internal entry
"KRN",8994,123470,3,2,0)
numbers (IENs) where the VistA Imaging file references exists.
"KRN",8994,123471,-1)
0^14
"KRN",8994,123471,0)
MAGQ QCNT^QCNT^MAGQBUT4^1^R
"KRN",8994,123471,1,0)
^8994.01^1^1^3050608^^
"KRN",8994,123471,1,1,0)
This call resets the Queue pointer settings in the Imaging Queue Pointer file, #2006.031.
"KRN",8994,123471,2,0)
^8994.02A^2^2
"KRN",8994,123471,2,1,0)
place^1^999^1^1
"KRN",8994,123471,2,1,1,0)
^8994.021^1^1^3050608^^
"KRN",8994,123471,2,1,1,1,0)
This field represents the internal entry number of the site parameter file, #2006.1.
"KRN",8994,123471,2,2,0)
QUEUE^1^33^1^2
"KRN",8994,123471,2,2,1,0)
^^1^1^3050608^
"KRN",8994,123471,2,2,1,1,0)
This is the queue entry to be updated by this method.
"KRN",8994,123471,2,"B","QUEUE",2)

"KRN",8994,123471,2,"B","place",1)

"KRN",8994,123471,2,"PARAMSEQ",1,1)

"KRN",8994,123471,2,"PARAMSEQ",2,2)

"KRN",8994,123472,-1)
0^15
"KRN",8994,123472,0)
MAGQ QRNGE^QRNGE^MAGQBUT5^1^R
"KRN",8994,123472,1,0)
^8994.01^2^2^3090318^^
"KRN",8994,123472,1,1,0)
This procedure is to either delete or re-queue a range of Vista Imaging
"KRN",8994,123472,1,2,0)
Background Processor queues.  The process parameter determines the action.
"KRN",8994,123472,2,0)
^8994.02A^5^5
"KRN",8994,123472,2,1,0)
QUEUE^1^15^1^1
"KRN",8994,123472,2,1,1,0)
^^1^1^3071022^
"KRN",8994,123472,2,1,1,1,0)
This determines the queue type that will be processed.
"KRN",8994,123472,2,2,0)
PROCESS^1^15^1^2
"KRN",8994,123472,2,2,1,0)
^^3^3^3071022^
"KRN",8994,123472,2,2,1,1,0)
This determines whether the queue will be requeued or deleted.  A
"KRN",8994,123472,2,2,1,2,0)
value of "DEL" will designate a delete and a value of "REQ" will
"KRN",8994,123472,2,2,1,3,0)
designate a requeue.
"KRN",8994,123472,2,3,0)
START^1^15^1^3
"KRN",8994,123472,2,3,1,0)
^^2^2^3071022^
"KRN",8994,123472,2,3,1,1,0)
This value will determine the start of the range of Queue file 
"KRN",8994,123472,2,3,1,2,0)
(#2006.03) entries that will be processed.
"KRN",8994,123472,2,4,0)
STOP^1^15^1^4
"KRN",8994,123472,2,4,1,0)
^^1^1^3071022^
"KRN",8994,123472,2,4,1,1,0)
This will determine the last Queue file entry that will be processed.
"KRN",8994,123472,2,5,0)
PLACE^1^15^1^5
"KRN",8994,123472,2,5,1,0)
^8994.021^2^2^3090318^^
"KRN",8994,123472,2,5,1,1,0)
This value designates the Imaging site parameter entry
"KRN",8994,123472,2,5,1,2,0)
for which the queues to be processed are associated.
"KRN",8994,123472,2,"B","PLACE",5)

"KRN",8994,123472,2,"B","PROCESS",2)

"KRN",8994,123472,2,"B","QUEUE",1)

"KRN",8994,123472,2,"B","START",3)

"KRN",8994,123472,2,"B","STOP",4)

"KRN",8994,123472,2,"PARAMSEQ",1,1)

"KRN",8994,123472,2,"PARAMSEQ",2,2)

"KRN",8994,123472,2,"PARAMSEQ",3,3)

"KRN",8994,123472,2,"PARAMSEQ",4,4)

"KRN",8994,123472,2,"PARAMSEQ",5,5)

"KRN",8994,123472,3,0)
^8994.03^1^1^3090318^^
"KRN",8994,123472,3,1,0)
This value is the number of Queue entries that are ready to be processed.
"KRN",8994,123473,-1)
0^16
"KRN",8994,123473,0)
MAGQB QUEDEL^DQUE1^MAGQBUT2^1^R
"KRN",8994,123473,1,0)
^^2^2^3110118^
"KRN",8994,123473,1,1,0)
This procedure call deletes a single IMAGE BACKGROUND QUEUE file 
"KRN",8994,123473,1,2,0)
(#2006.03) entry.
"KRN",8994,123473,2,0)
^8994.02A^1^1
"KRN",8994,123473,2,1,0)
IEN^1^256^1^1
"KRN",8994,123473,2,1,1,0)
^8994.021^1^1^3110118^^
"KRN",8994,123473,2,1,1,1,0)
This is the queue file internal entry number to be deleted.
"KRN",8994,123473,2,"B","IEN",1)

"KRN",8994,123473,2,"PARAMSEQ",1,1)

"KRN",8994,123473,3,0)
^8994.03^1^1^3110118^^
"KRN",8994,123473,3,1,0)
No return parameter has been defined for this procedure call.
"KRN",8994,123474,-1)
0^17
"KRN",8994,123474,0)
MAGQBP ALL SHARES^ALLSHR^MAGQBUT1^2^R
"KRN",8994,123474,1,0)
^8994.01^4^4^3100812^^^^
"KRN",8994,123474,1,1,0)
The output of this RPC is a list of all online magnetic shares
"KRN",8994,123474,1,2,0)
(non-routing).  This list establishes a set of roots for the purge process
"KRN",8994,123474,1,3,0)
to downwardly traverse and evaluate the age and VistA attributes of each
"KRN",8994,123474,1,4,0)
image file for the purpose of purging archaic and archived files.
"KRN",8994,123474,2,0)
^8994.02A^2^1
"KRN",8994,123474,2,2,0)
TYPE^1^8^0^1
"KRN",8994,123474,2,2,1,0)
^8994.021^4^4^3100812^^^
"KRN",8994,123474,2,2,1,1,0)
This value is used to determine if there is a screen intended for 
"KRN",8994,123474,2,2,1,2,0)
members of the Next RAID Group.
"KRN",8994,123474,2,2,1,3,0)
"ALL" performs no screen.
"KRN",8994,123474,2,2,1,4,0)
"AUTO" will screen for members of the Next RAID group.
"KRN",8994,123474,2,"B","TYPE",2)

"KRN",8994,123474,2,"PARAMSEQ",1,2)

"KRN",8994,123474,3,0)
^8994.03^4^4^3100812^^^^
"KRN",8994,123474,3,1,0)
result(0)=network path1
"KRN",8994,123474,3,2,0)
result(1)=network path2
"KRN",8994,123474,3,3,0)
.
"KRN",8994,123474,3,4,0)
.
"KRN",8994,123475,-1)
0^18
"KRN",8994,123475,0)
MAGQBP FREF^FILEREF^MAGQBPRG^1^R
"KRN",8994,123475,1,0)
^8994.01^4^4^3090916^^^
"KRN",8994,123475,1,1,0)
VALIDATES THAT THE FILEPATH IS CONSISTENT WITH VISTA MAGFILE REFERENCE
"KRN",8994,123475,1,2,0)
SET THE SECOND PIECE TO "PACS" IF IT REPRESENTS DICOM
"KRN",8994,123475,1,3,0)
VALIDATES THAT A JUKEBOX POINTER EXISTS
"KRN",8994,123475,1,4,0)
RESULT VALUES
"KRN",8994,123475,2,0)
^8994.02A^4^4
"KRN",8994,123475,2,1,0)
FILEPATH^1^^1^1
"KRN",8994,123475,2,1,1,0)
^^1^1^3090916^
"KRN",8994,123475,2,1,1,1,0)
The computer name and directory path of the file.
"KRN",8994,123475,2,2,0)
FILENAME^1^^1^2
"KRN",8994,123475,2,2,1,0)
^^1^1^3090916^
"KRN",8994,123475,2,2,1,1,0)
The filename.
"KRN",8994,123475,2,3,0)
FILE EXTENSION^1^^1^3
"KRN",8994,123475,2,3,1,0)
^^1^1^3090916^
"KRN",8994,123475,2,3,1,1,0)
The file extension.
"KRN",8994,123475,2,4,0)
NETWORK LOCATION^1^^1^4
"KRN",8994,123475,2,4,1,0)
^8994.021^1^1^3090916^^^
"KRN",8994,123475,2,4,1,1,0)
Current share network path being evaluated.
"KRN",8994,123475,2,"B","FILE EXTENSION",3)

"KRN",8994,123475,2,"B","FILENAME",2)

"KRN",8994,123475,2,"B","FILEPATH",1)

"KRN",8994,123475,2,"B","NETWORK LOCATION",4)

"KRN",8994,123475,2,"PARAMSEQ",1,1)

"KRN",8994,123475,2,"PARAMSEQ",2,2)

"KRN",8994,123475,2,"PARAMSEQ",3,3)

"KRN",8994,123475,2,"PARAMSEQ",4,4)

"KRN",8994,123475,3,0)
^8994.03^25^25^3090916^^^
"KRN",8994,123475,3,1,0)
PIECE  1:-3 = FOREIGN FILE, DO NOT PURGE
"KRN",8994,123475,3,2,0)
         -2 = QUEUED FOR JUKEBOX COPY, DO NOT PURGE
"KRN",8994,123475,3,3,0)
         -1 = DO NOT PURGE
"KRN",8994,123475,3,4,0)
          0 = PURGE('MAG 2005 ENTRY)!('JUKEBOX PTRS & 'EXCEPTIONS)
"KRN",8994,123475,3,5,0)
          1 = PURGE GIVEN NORMAL DATE CRITERIA (NDC) + CONFIRMED ON JB
"KRN",8994,123475,3,6,0)
          2 = PURGE GIVEN NDC IF TGA PRESENT
"KRN",8994,123475,3,7,0)
          3 = PURGE IF FILE IS AT ALTERNATE NETWORK LOCATION SITE
"KRN",8994,123475,3,8,0)
              ELSE PURGE IF AGED & UPDATE FILE REFERENCES
"KRN",8994,123475,3,9,0)
          5 = PURGE IF AT ALTERNATE SITE,QUEUE JUKEBOX IF NOT ON JB
"KRN",8994,123475,3,10,0)
          6 = PURGE GIVEN NORMAL DATE CRITERIA
"KRN",8994,123475,3,11,0)
PIECE   2:0 = NONPACS
"KRN",8994,123475,3,12,0)
         :1 = PACS
"KRN",8994,123475,3,13,0)
PIECE    3: RECORD CATEGORY
"KRN",8994,123475,3,14,0)
          1 = 'NO 2005 ENTRY
"KRN",8994,123475,3,15,0)
          2 = RADIOLOGY HOLD
"KRN",8994,123475,3,16,0)
          3 = NO JUKEBOX/JUKEBOX PTRS
"KRN",8994,123475,3,17,0)
          4 = JUKEBOX - NO JUKEBOX PTRS (P/EXCEPT)ELSE QUEUE
"KRN",8994,123475,3,18,0)
          5 = JUKEBOX/JUKEBOX PTRS, NO CACHE PTRS,PURGE IF CONFIRMED
"KRN",8994,123475,3,19,0)
          6 = JUKEBOX/JUKEBOX PTRS, WRONG CACHE PTRS PURGE IF AT ALT
"KRN",8994,123475,3,20,0)
          7 = JUKEBOX/JUKEBOX PTRS, NO CACHE PTRS, FIX PTRS
"KRN",8994,123475,3,21,0)
          8 = JUKEBOX/JUKEBOX PTRS, CACHE PTRS, AGE (IF CONFIRMED)
"KRN",8994,123475,3,22,0)
          9 = RECORD NOT IN THE IMAGE FILE
"KRN",8994,123475,3,23,0)
         10 = FOREIGN IMAGE FILE
"KRN",8994,123475,3,24,0)
         11 = NOT AN IMAGE FILE
"KRN",8994,123475,3,25,0)
         12 = FILE LOCATION NOT VALID
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",454,-1)
1^1
"PKG",454,0)
IMAGING^MAG^Imaging Release History
"PKG",454,22,0)
^9.49I^1^1
"PKG",454,22,1,0)
3.0^3020328^3020328^.5
"PKG",454,22,1,"PAH",1,0)
39^3110308^.5
"PKG",454,22,1,"PAH",1,1,0)
^9.49011^39^39^3110308
"PKG",454,22,1,"PAH",1,1,1,0)
Routines for Patch 39, Test Build 28.
"PKG",454,22,1,"PAH",1,1,2,0)
 
"PKG",454,22,1,"PAH",1,1,3,0)
Routines:
"PKG",454,22,1,"PAH",1,1,4,0)
MAGBAPI     value = 17337697
"PKG",454,22,1,"PAH",1,1,5,0)
MAGBRTE4    value = 15016927
"PKG",454,22,1,"PAH",1,1,6,0)
MAGFILEB    value = 11899853
"PKG",454,22,1,"PAH",1,1,7,0)
MAGIP39     value = 15355104
"PKG",454,22,1,"PAH",1,1,8,0)
MAGIP39B    value = 33707188
"PKG",454,22,1,"PAH",1,1,9,0)
MAGIP39E    value = 9567529
"PKG",454,22,1,"PAH",1,1,10,0)
MAGLOG      value = 6505482
"PKG",454,22,1,"PAH",1,1,11,0)
MAGQBAB     value = 6248046
"PKG",454,22,1,"PAH",1,1,12,0)
MAGQBD      value = 4804096
"PKG",454,22,1,"PAH",1,1,13,0)
MAGQBGCC    value = 9817430
"PKG",454,22,1,"PAH",1,1,14,0)
MAGQBIM     value = 5640879
"PKG",454,22,1,"PAH",1,1,15,0)
MAGQBJB     value = 7946372
"PKG",454,22,1,"PAH",1,1,16,0)
MAGQBJH     value = 9334687
"PKG",454,22,1,"PAH",1,1,17,0)
MAGQBPG1    value = 17587779
"PKG",454,22,1,"PAH",1,1,18,0)
MAGQBPG2    value = 7742906
"PKG",454,22,1,"PAH",1,1,19,0)
MAGQBPRG    value = 11705676
"PKG",454,22,1,"PAH",1,1,20,0)
MAGQBTM     value = 16348461
"PKG",454,22,1,"PAH",1,1,21,0)
MAGQBU6A    value = 21126520
"PKG",454,22,1,"PAH",1,1,22,0)
MAGQBUT     value = 30554887
"PKG",454,22,1,"PAH",1,1,23,0)
MAGQBUT1    value = 23611991
"PKG",454,22,1,"PAH",1,1,24,0)
MAGQBUT2    value = 17468675
"PKG",454,22,1,"PAH",1,1,25,0)
MAGQBUT4    value = 13069038
"PKG",454,22,1,"PAH",1,1,26,0)
MAGQBUT5    value = 18100543
"PKG",454,22,1,"PAH",1,1,27,0)
MAGQBUT6    value = 29900309
"PKG",454,22,1,"PAH",1,1,28,0)
MAGQCBP     value = 25623703
"PKG",454,22,1,"PAH",1,1,29,0)
MAGQE1      value = 5411143
"PKG",454,22,1,"PAH",1,1,30,0)
MAGQE2      value = 6604569
"PKG",454,22,1,"PAH",1,1,31,0)
MAGQE5      value = 13439984
"PKG",454,22,1,"PAH",1,1,32,0)
MAGQE6      value = 7370203
"PKG",454,22,1,"PAH",1,1,33,0)
MAGQE7      value = 15755110
"PKG",454,22,1,"PAH",1,1,34,0)
 
"PKG",454,22,1,"PAH",1,1,35,0)
Please note that routine MAGIP39 is deleted after the KIDS Build is
"PKG",454,22,1,"PAH",1,1,36,0)
installed.
"PKG",454,22,1,"PAH",1,1,37,0)
 
"PKG",454,22,1,"PAH",1,1,38,0)
Please note that routine MAGIP39B is deleted after the KIDS Build is
"PKG",454,22,1,"PAH",1,1,39,0)
installed.
"PRE")
MAGIP39E
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
30
"RTN","MAGBAPI")
0^1^B83920568
"RTN","MAGBAPI",1,0)
MAGBAPI ;WOIFO/PMK,RMP,SEB,MLH - Background Processor API to build queues ; 08 Sep 2010 5:12 PM
"RTN","MAGBAPI",2,0)
 ;;3.0;IMAGING;**1,7,8,20,39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGBAPI",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGBAPI",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGBAPI",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGBAPI",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGBAPI",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGBAPI",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGBAPI",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGBAPI",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGBAPI",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGBAPI",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGBAPI",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGBAPI",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGBAPI",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGBAPI",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGBAPI",17,0)
 ;;
"RTN","MAGBAPI",18,0)
 Q
"RTN","MAGBAPI",19,0)
 ; The API returns the entry's queue pointer
"RTN","MAGBAPI",20,0)
 ;
"RTN","MAGBAPI",21,0)
ABSTRACT(INPUT,PLACE) ; Entry point to create an image abstract
"RTN","MAGBAPI",22,0)
 ; input = image pointer
"RTN","MAGBAPI",23,0)
 Q:$$IMOFFLN^MAGFILEB($P($G(^MAG(2005,INPUT,0)),U,2)) 0
"RTN","MAGBAPI",24,0)
 S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE 0 ; DBI - SEB Patch 4
"RTN","MAGBAPI",25,0)
 Q $$QUEUE("ABSTRACT",INPUT,PLACE)
"RTN","MAGBAPI",26,0)
 ;
"RTN","MAGBAPI",27,0)
GCC(INPUT,PLACE) ; Entry point to create an Document Imaging Export Copy
"RTN","MAGBAPI",28,0)
 ; input = image pointer(^Second Piece Optional Location specified^3rd optional extension(s) specifier
"RTN","MAGBAPI",29,0)
 ; plus "~" separated alternate source file types
"RTN","MAGBAPI",30,0)
 S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE 0 ; DBI - SEB Patch 4
"RTN","MAGBAPI",31,0)
 Q $$QUEUE("GCC",$P(INPUT,"^")_"^^"_$P(INPUT,"^",4)_"^"_$P(INPUT,"^",2,3),PLACE)
"RTN","MAGBAPI",32,0)
JUKEBOX(INPUT,PLACE) ; Entry point to copy an image file and abstract to the Jukebox / input = image pointer
"RTN","MAGBAPI",33,0)
 N NEXT,CONS,GB
"RTN","MAGBAPI",34,0)
 S GB=$G(^MAG(2005,+$P(INPUT,U),0))
"RTN","MAGBAPI",35,0)
 S:GB="" GB=$G(^MAG(2005.1,+$P(INPUT,U),0))
"RTN","MAGBAPI",36,0)
 Q:GB="" 0
"RTN","MAGBAPI",37,0)
 Q:$$IMOFFLN^MAGFILEB($P(GB,U,2)) 0
"RTN","MAGBAPI",38,0)
 S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE 0 ; DBI - SEB Patch 4
"RTN","MAGBAPI",39,0)
 S CONS=$$CONSOLID()
"RTN","MAGBAPI",40,0)
 S NEXT=$O(^MAGQUEUE(2006.03,"E",PLACE,$P(INPUT,"^"),$$NEXTQ("JUKEBOX",PLACE)))
"RTN","MAGBAPI",41,0)
 Q:NEXT?1N.N NEXT
"RTN","MAGBAPI",42,0)
 S NEXT=$$QUEUE("JUKEBOX",INPUT,PLACE)
"RTN","MAGBAPI",43,0)
 Q:'NEXT NEXT
"RTN","MAGBAPI",44,0)
 S ^MAGQUEUE(2006.03,"E",PLACE,$P(INPUT,"^"),NEXT)=""
"RTN","MAGBAPI",45,0)
 Q NEXT
"RTN","MAGBAPI",46,0)
DELETE(INPUT,PLACE) ; Entry point to delete a file (literally from anywhere) / input = full path of file to delete
"RTN","MAGBAPI",47,0)
 N IMOD
"RTN","MAGBAPI",48,0)
 S IMOD=$S(INPUT[U:"^^"_INPUT,1:"^^^"_INPUT)
"RTN","MAGBAPI",49,0)
 S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE 0 ; DBI - SEB Patch 4
"RTN","MAGBAPI",50,0)
 Q $$QUEUE("DELETE",IMOD,PLACE) ;SETS 9TH & 10TH PIECE
"RTN","MAGBAPI",51,0)
IMPORT(INPUT,CALLBACK,TRACKID,PLACE) ; Entry point to import a file
"RTN","MAGBAPI",52,0)
 ; input = Image Parameter Array
"RTN","MAGBAPI",53,0)
 N QUEIEN,INDX,FDA,DINUM,MS1,CT,REQUE,TMP
"RTN","MAGBAPI",54,0)
 S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE "0^Missing PLACE parameter" ; DBI - SEB Patch 4
"RTN","MAGBAPI",55,0)
 S REQUE=$S($P($G(INPUT),"^",3)'?1N.N:0,1:1)
"RTN","MAGBAPI",56,0)
 I REQUE=0 Q:($O(^MAG(2006.041,"C",TRACKID,""))?1N.N) "0^Duplicate Tracking ID"
"RTN","MAGBAPI",57,0)
 S QUEIEN=$$QUEUE("IMPORT","^^"_$P($G(INPUT),"^",3)_U_$TR(CALLBACK,"^","|")_U_$P($G(INPUT),"^",4),PLACE)
"RTN","MAGBAPI",58,0)
 I REQUE=0 D
"RTN","MAGBAPI",59,0)
 . S $P(^MAGQUEUE(2006.03,QUEIEN,0),"^",11)=QUEIEN
"RTN","MAGBAPI",60,0)
 . S (DINUM,X)=QUEIEN,DIC="^MAG(2006.034,",DLAYGO="2006.034",DIC(0)="L"
"RTN","MAGBAPI",61,0)
 . K D0
"RTN","MAGBAPI",62,0)
 . D FILE^DICN
"RTN","MAGBAPI",63,0)
 . K DIC,D0,DLAYGO
"RTN","MAGBAPI",64,0)
 . S CT=0
"RTN","MAGBAPI",65,0)
 . D CONV^MAGQBUT4(.INPUT,.CT)
"RTN","MAGBAPI",66,0)
 . D MRGMULT^MAGQBUT4(.INPUT,"^MAG(2006.034,"_QUEIEN_",1,","2006.341A",CT)
"RTN","MAGBAPI",67,0)
 . Q
"RTN","MAGBAPI",68,0)
 K DIE,FDA
"RTN","MAGBAPI",69,0)
 S FDA(2006.041,"+1,",.01)=$S(REQUE=0:QUEIEN,1:$P($G(INPUT),"^",4))
"RTN","MAGBAPI",70,0)
 S FDA(2006.041,"+1,",.02)=TRACKID
"RTN","MAGBAPI",71,0)
 S FDA(2006.041,"+1,",1)=$S(REQUE=0:"QUEUING",1:"REQUEUING")
"RTN","MAGBAPI",72,0)
 S FDA(2006.041,"+1,",2)=$$NOW^XLFDT
"RTN","MAGBAPI",73,0)
 D UPDATE^DIE("U","FDA","","MAGIMP")
"RTN","MAGBAPI",74,0)
 I $D(DIERR) S TMP=MAGIMP("DIERR",1,"TEXT",1) K DIERR,MAGIMP
"RTN","MAGBAPI",75,0)
 Q $S($D(TMP):"0^"_TMP,1:QUEIEN)
"RTN","MAGBAPI",76,0)
 ;
"RTN","MAGBAPI",77,0)
JBTOHD(INPUT,PLACE) ; Entry point to copy an image from the Jukebox to the Hard Disk
"RTN","MAGBAPI",78,0)
 ; input = image pointer ^ FULL or ABSTRACT or BIG
"RTN","MAGBAPI",79,0)
 N NEXT,IEN,JDTYPE,CONS
"RTN","MAGBAPI",80,0)
 S IEN=$P(INPUT,"^"),JDTYPE=$P(INPUT,"^",2)
"RTN","MAGBAPI",81,0)
 Q:$$IMOFFLN^MAGFILEB($P($G(^MAG(2005,IEN,0)),U,2)) 0
"RTN","MAGBAPI",82,0)
 I 'PLACE S PLACE=$$DA2PLC^MAGBAPIP(IEN,$S(JDTYPE["ABSTRACT":"A",JDTYPE["BIG":"B",1:"F"))
"RTN","MAGBAPI",83,0)
 E  S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE 0 ; DBI - SEB Patch 4
"RTN","MAGBAPI",84,0)
 S NEXT=$O(^MAGQUEUE(2006.03,"F",PLACE,IEN,JDTYPE,$$NEXTQ("JBTOHD",PLACE)))
"RTN","MAGBAPI",85,0)
 Q:NEXT?1N.N NEXT
"RTN","MAGBAPI",86,0)
 S NEXT=$$QUEUE("JBTOHD",INPUT,PLACE)
"RTN","MAGBAPI",87,0)
 Q:'NEXT NEXT
"RTN","MAGBAPI",88,0)
 S ^MAGQUEUE(2006.03,"F",PLACE,$P(INPUT,"^"),$P(INPUT,"^",2),NEXT)=""
"RTN","MAGBAPI",89,0)
 Q NEXT
"RTN","MAGBAPI",90,0)
 ;
"RTN","MAGBAPI",91,0)
PREFET(INPUT,PLACE) ;
"RTN","MAGBAPI",92,0)
 ; input = image pointer ^ FULL or ABSTRACT or BIG
"RTN","MAGBAPI",93,0)
 N NEXT,IEN,JDTYPE,CONS
"RTN","MAGBAPI",94,0)
 S IEN=$P(INPUT,"^"),JDTYPE=$P(INPUT,"^",2)
"RTN","MAGBAPI",95,0)
 Q:$$IMOFFLN^MAGFILEB($P($G(^MAG(2005,IEN,0)),U,2)) 0
"RTN","MAGBAPI",96,0)
 I 'PLACE S PLACE=$$DA2PLC^MAGBAPIP(IEN,$S(JDTYPE["ABSTRACT":"A",JDTYPE["BIG":"B",1:"F"))
"RTN","MAGBAPI",97,0)
 E  S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE 0 ; DBI - SEB Patch 4
"RTN","MAGBAPI",98,0)
 S IEN=$P(INPUT,"^"),JDTYPE=$P(INPUT,"^",2)
"RTN","MAGBAPI",99,0)
 S NEXT=$O(^MAGQUEUE(2006.03,"F",PLACE,IEN,JDTYPE,$$NEXTQ("PREFET",PLACE)))
"RTN","MAGBAPI",100,0)
 Q:NEXT?1N.N NEXT
"RTN","MAGBAPI",101,0)
 S NEXT=$$QUEUE("PREFET",INPUT,PLACE)
"RTN","MAGBAPI",102,0)
 Q:'NEXT NEXT
"RTN","MAGBAPI",103,0)
 S ^MAGQUEUE(2006.03,"F",PLACE,$P(INPUT,"^"),$P(INPUT,"^",2),NEXT)=""
"RTN","MAGBAPI",104,0)
 Q NEXT
"RTN","MAGBAPI",105,0)
 ;
"RTN","MAGBAPI",106,0)
EVAL(IMAGE,PLACE) ; Entry point for before rules are evaluated
"RTN","MAGBAPI",107,0)
 S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE 0 ; DBI - SEB Patch 4
"RTN","MAGBAPI",108,0)
 Q $$QUEUE("EVAL",IMAGE,PLACE)
"RTN","MAGBAPI",109,0)
 ;
"RTN","MAGBAPI",110,0)
NEXTQ(TYPE,PLACE) ;
"RTN","MAGBAPI",111,0)
 N X
"RTN","MAGBAPI",112,0)
 S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE 0 ; DBI - SEB Patch 4
"RTN","MAGBAPI",113,0)
 S X=$O(^MAGQUEUE(2006.031,"C",PLACE,TYPE,""))
"RTN","MAGBAPI",114,0)
 Q $S('X:X,1:$P(^MAGQUEUE(2006.031,X,0),"^",2))
"RTN","MAGBAPI",115,0)
 ;
"RTN","MAGBAPI",116,0)
QUEUE(Q,INPUT,PLACE) ; Stuff the entry (header + INPUT) into the appropriate queue (Q)
"RTN","MAGBAPI",117,0)
 N MAGTIME,QPTR,QTR,X,Y,STATUS
"RTN","MAGBAPI",118,0)
 S U="^",STATUS="NOT_PROCESSED"
"RTN","MAGBAPI",119,0)
 S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE 0 ; DBI - SEB Patch 4
"RTN","MAGBAPI",120,0)
 Q:(((Q'["DELETE")&(Q'["IMPORT"))&($P(INPUT,U,1)'?1N.N)) 0
"RTN","MAGBAPI",121,0)
 ; increment the QPTR
"RTN","MAGBAPI",122,0)
 L +^MAGQUEUE(2006.03,0):1E9
"RTN","MAGBAPI",123,0)
 S X=^MAGQUEUE(2006.03,0)
"RTN","MAGBAPI",124,0)
 S QPTR=$O(^MAGQUEUE(2006.03," "),-1)+1
"RTN","MAGBAPI",125,0)
 S QPTR=$S(QPTR<+$P(X,U,3):$P(X,U,3)+1,1:QPTR)
"RTN","MAGBAPI",126,0)
 S $P(X,"^",3)=QPTR,$P(X,"^",4)=$P(X,"^",4)+1
"RTN","MAGBAPI",127,0)
 S ^MAGQUEUE(2006.03,0)=X
"RTN","MAGBAPI",128,0)
 S MAGTIME=$$NOW^XLFDT
"RTN","MAGBAPI",129,0)
 S ^MAGQUEUE(2006.03,QPTR,0)=Q_"^"_$G(DUZ)_"^"_^%ZOSF("VOL")_"^"_MAGTIME_"^"_STATUS_"^"_MAGTIME_"^"_INPUT
"RTN","MAGBAPI",130,0)
 S ^MAGQUEUE(2006.03,"C",PLACE,Q,QPTR)="",$P(^MAGQUEUE(2006.03,QPTR,0),"^",12)=PLACE
"RTN","MAGBAPI",131,0)
 S ^MAGQUEUE(2006.03,"D",PLACE,Q,STATUS,QPTR)=""
"RTN","MAGBAPI",132,0)
 L -^MAGQUEUE(2006.03,0)
"RTN","MAGBAPI",133,0)
 D ADD(1,Q,PLACE)
"RTN","MAGBAPI",134,0)
 Q QPTR
"RTN","MAGBAPI",135,0)
ADD(N,QUEUE,PLACE) ;
"RTN","MAGBAPI",136,0)
 ;
"RTN","MAGBAPI",137,0)
 N CNT,D0,I,X,CONS,PREV,QTOT
"RTN","MAGBAPI",138,0)
 S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE 0
"RTN","MAGBAPI",139,0)
 S D0=$O(^MAGQUEUE(2006.031,"C",PLACE,QUEUE,""))
"RTN","MAGBAPI",140,0)
 D:'D0
"RTN","MAGBAPI",141,0)
 . L +^MAGQUEUE(2006.031):1E9
"RTN","MAGBAPI",142,0)
 . S D0=$O(^MAGQUEUE(2006.031," "),-1)+1
"RTN","MAGBAPI",143,0)
 . S ^MAGQUEUE(2006.031,D0,0)=QUEUE_"^0^0^"_PLACE_U
"RTN","MAGBAPI",144,0)
 . S ^MAGQUEUE(2006.031,"C",PLACE,QUEUE,D0)=""
"RTN","MAGBAPI",145,0)
 . S X="IMAGE BACKGROUND QUEUE POINTER^2006.031^"_D0_"^"_D0
"RTN","MAGBAPI",146,0)
 . S ^MAGQUEUE(2006.031,0)=X
"RTN","MAGBAPI",147,0)
 . L -^MAGQUEUE(2006.031)
"RTN","MAGBAPI",148,0)
 . Q
"RTN","MAGBAPI",149,0)
 L +^MAGQUEUE(2006.031,D0):1E9
"RTN","MAGBAPI",150,0)
 S X=^MAGQUEUE(2006.031,D0,0),CNT=$P(X,U,3),PREV=$P(X,U,2),QTOT=$P(X,U,5)
"RTN","MAGBAPI",151,0)
 I CNT?1.N S CNT=CNT+N
"RTN","MAGBAPI",152,0)
 E  D
"RTN","MAGBAPI",153,0)
 . S I=$P(X,"^",2),CNT=0
"RTN","MAGBAPI",154,0)
 . F  S I=$O(^MAGQUEUE(2006.03,"C",PLACE,QUEUE,I)) Q:I'?1N.N  S CNT=CNT+1
"RTN","MAGBAPI",155,0)
 . Q
"RTN","MAGBAPI",156,0)
 S $P(X,U,4)=PLACE
"RTN","MAGBAPI",157,0)
 S:N>0 QTOT=QTOT+N
"RTN","MAGBAPI",158,0)
 ; In order to avoid the new queue from being skipped...
"RTN","MAGBAPI",159,0)
 I QUEUE'["IMPORT",$D(QPTR),QPTR<(PREV+1) S $P(X,"^",2)=QPTR-1,$P(X,"^",6)=$$NOW^XLFDT
"RTN","MAGBAPI",160,0)
 S $P(X,U,3)=CNT,$P(X,U,5)=QTOT,^MAGQUEUE(2006.031,D0,0)=X
"RTN","MAGBAPI",161,0)
 L -^MAGQUEUE(2006.031,D0)
"RTN","MAGBAPI",162,0)
 Q
"RTN","MAGBAPI",163,0)
CWL(PLACE) ;Current Write Location
"RTN","MAGBAPI",164,0)
 S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE 0 ; DBI - SEB Patch 4
"RTN","MAGBAPI",165,0)
 Q $P($G(^MAG(2006.1,PLACE,0)),"^",3)
"RTN","MAGBAPI",166,0)
PLACE(IEN) ;
"RTN","MAGBAPI",167,0)
 Q $$GETPLACE(+$O(^MAG(2006.1,"B",IEN,"")))
"RTN","MAGBAPI",168,0)
JBPTR(PLACE) ;Current JukeBox Pointer
"RTN","MAGBAPI",169,0)
 S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE 0 ; DBI - SEB Patch 4
"RTN","MAGBAPI",170,0)
 Q $P($G(^MAG(2006.1,PLACE,1)),"^",6)
"RTN","MAGBAPI",171,0)
GETPLACE(PLACE) ; Validate place
"RTN","MAGBAPI",172,0)
 N SP
"RTN","MAGBAPI",173,0)
 S SP=$G(PLACE)
"RTN","MAGBAPI",174,0)
 S PLACE=+$S($$CONSOLID():+$G(PLACE),1:$O(^MAG(2006.1," "),-1))
"RTN","MAGBAPI",175,0)
 I PLACE,$P($G(^MAG(2006.1,PLACE,0)),"^",1)="" S PLACE=0
"RTN","MAGBAPI",176,0)
 I 'PLACE,$$MAXREP(10) D
"RTN","MAGBAPI",177,0)
 . N I,MSG,S,T,J,PS
"RTN","MAGBAPI",178,0)
 . S PS=$O(^MAG(2006.1,"B",$$KSP^XUPARAM("INST"),"")) ; PLACE of the VistA host system
"RTN","MAGBAPI",179,0)
 . S MSG="Application process failure"
"RTN","MAGBAPI",180,0)
 . S I=1,MSG(I)="Cannot determine 'place' (location, division, institution) for image."
"RTN","MAGBAPI",181,0)
 . S I=1,MSG(I)=" Production Account: "_$$PROD^XUPROD("1")
"RTN","MAGBAPI",182,0)
 . S T=$J("At",11) F S=$ST-1:-1:0 D
"RTN","MAGBAPI",183,0)
 . . S I=I+1,MSG(I)=T_": "_$ST(S,"PLACE")_" = "_$ST(S,"MCODE"),T="Called From"
"RTN","MAGBAPI",184,0)
 . . Q
"RTN","MAGBAPI",185,0)
 . I $D(MAGARRAY) D
"RTN","MAGBAPI",186,0)
 . . S J="",I=I+1,MSG(I)="MAGARRAY"
"RTN","MAGBAPI",187,0)
 . . F  S J=$O(MAGARRAY(J)) Q:J=""  D
"RTN","MAGBAPI",188,0)
 . . . S I=I+1,MSG(I)="MAGARRAY("_J_")"_MAGARRAY(J)
"RTN","MAGBAPI",189,0)
 . . Q
"RTN","MAGBAPI",190,0)
 . I $D(XWBTBUF) S I=I+1,MSG(I)="XWBTBUF: "_XWBTBUF
"RTN","MAGBAPI",191,0)
 . I $D(MAGDA) S I=I+1,MSG(I)="MAGDA: "_MAGDA
"RTN","MAGBAPI",192,0)
 . I $D(MAGGDA) S I=I+1,MSG(I)="MAGGDA: "_MAGGDA
"RTN","MAGBAPI",193,0)
 . I $D(MAGGIEN("1")) S I=I+1,MSG(I)="MAGGIEN(""1""): "_MAGGIEN("1")
"RTN","MAGBAPI",194,0)
 . S:$G(DUZ) I=I+1,MSG(I)="The USER was: "_$$GET1^DIQ(200,DUZ,".01","E")_" DUZ: "_DUZ
"RTN","MAGBAPI",195,0)
 . S:$G(DUZ(2)) I=I+1,MSG(I)="The USER had a DUZ(2) setting of: "_DUZ(2)
"RTN","MAGBAPI",196,0)
 . S I=I+1,MSG(I)="The original value of the INPUT Parameter 'PLACE' was: "_SP
"RTN","MAGBAPI",197,0)
 . S I=I+1,MSG(I)="This fault may result in the failure to archive or process images."
"RTN","MAGBAPI",198,0)
 . S I=I+1,MSG(I)="The users site of origin needs to have an Associated Institution value"
"RTN","MAGBAPI",199,0)
 . S I=I+1,MSG(I)="setup on the Site Parameters window."
"RTN","MAGBAPI",200,0)
 . S I=I+1,MSG(I)="refer to the BP User manual for instructions."
"RTN","MAGBAPI",201,0)
 . S I="" F  S I=$O(MSG(I)) Q:I=""  D DFNIQ^MAGQBPG1("",MSG(I),0,PS,"$$GETPLACE_MAGBAPI")
"RTN","MAGBAPI",202,0)
 . D DFNIQ^MAGQBPG1("",MSG,1,PS,"$$GETPLACE_MAGBAPI")
"RTN","MAGBAPI",203,0)
 . Q
"RTN","MAGBAPI",204,0)
 Q PLACE
"RTN","MAGBAPI",205,0)
MAXREP(MAX) ;
"RTN","MAGBAPI",206,0)
 N REP,CNT
"RTN","MAGBAPI",207,0)
 I $P($G(^MAG(2006.1,"WARNING","MAGBAPI")),U,1)=$$DT^XLFDT D
"RTN","MAGBAPI",208,0)
 . S CNT=+$P($G(^MAG(2006.1,"WARNING","MAGBAPI")),U,2)+1
"RTN","MAGBAPI",209,0)
 . S REP=$S(CNT<MAX:1,1:0)
"RTN","MAGBAPI",210,0)
 . S $P(^MAG(2006.1,"WARNING","MAGBAPI"),U,2)=CNT
"RTN","MAGBAPI",211,0)
 . Q
"RTN","MAGBAPI",212,0)
 E  D
"RTN","MAGBAPI",213,0)
 . I $D(^MAG(2006.1,"WARNING","MAGBAPI")) D
"RTN","MAGBAPI",214,0)
 . . N I,MSG,PS
"RTN","MAGBAPI",215,0)
 . . S PS=$O(^MAG(2006.1,"B",$$KSP^XUPARAM("INST"),""))
"RTN","MAGBAPI",216,0)
 . . S MSG="Application process failure Count"
"RTN","MAGBAPI",217,0)
 . . S I=1,MSG(I)="On the following date: "_$P(^MAG(2006.1,"WARNING","MAGBAPI"),U,1)
"RTN","MAGBAPI",218,0)
 . . S I=I+1,MSG(I)=$P(^MAG(2006.1,"WARNING","MAGBAPI"),U,2)_" were logged on the host system"
"RTN","MAGBAPI",219,0)
 . . S I=I+1,MSG(I)="The Vista Imaging Development and support team is being notified."
"RTN","MAGBAPI",220,0)
 . . S I="" F  S I=$O(MSG(I)) Q:I=""  D DFNIQ^MAGQBPG1("",MSG(I),0,PS,"$$GETPLACE_MAGBAPI")
"RTN","MAGBAPI",221,0)
 . . D DFNIQ^MAGQBPG1("",MSG,1,PS,"$$GETPLACE_MAGBAPI")
"RTN","MAGBAPI",222,0)
 . . Q
"RTN","MAGBAPI",223,0)
 . S REP=1,$P(^MAG(2006.1,"WARNING","MAGBAPI"),U,1,2)=$$DT^XLFDT_U_1
"RTN","MAGBAPI",224,0)
 . Q
"RTN","MAGBAPI",225,0)
 Q REP
"RTN","MAGBAPI",226,0)
CWG(PL) ;Returns the Current RAID Group
"RTN","MAGBAPI",227,0)
 Q $P($G(^MAG(2006.1,PL,0)),U,10)
"RTN","MAGBAPI",228,0)
CONSOLID() ;
"RTN","MAGBAPI",229,0)
 Q $GET(^MAG(2006.1,"CONSOLIDATED"))="YES"
"RTN","MAGBAPI",230,0)
CONRPC(RESULT) ;[MAGG CONS]
"RTN","MAGBAPI",231,0)
 S RESULT=$$CONSOLID^MAGBAPI()
"RTN","MAGBAPI",232,0)
 Q
"RTN","MAGBAPI",233,0)
PLACER(RESULT) ;[MAGG PLACE]
"RTN","MAGBAPI",234,0)
 S RESULT=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGBAPI",235,0)
 Q
"RTN","MAGBAPI",236,0)
 ;
"RTN","MAGBRTE4")
0^2^B72404251
"RTN","MAGBRTE4",1,0)
MAGBRTE4 ;WOIFO/EdM - Process Routing Rule Evaluation Queue ; 18 Jan 2011 3:14 PM
"RTN","MAGBRTE4",2,0)
 ;;3.0;IMAGING;**11,30,51,85,54,39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGBRTE4",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGBRTE4",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGBRTE4",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGBRTE4",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGBRTE4",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGBRTE4",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGBRTE4",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGBRTE4",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGBRTE4",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGBRTE4",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGBRTE4",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGBRTE4",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGBRTE4",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGBRTE4",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGBRTE4",17,0)
 ;;
"RTN","MAGBRTE4",18,0)
 Q
"RTN","MAGBRTE4",19,0)
 ;
"RTN","MAGBRTE4",20,0)
EVAL ;
"RTN","MAGBRTE4",21,0)
 N ACTIVE ;--- Switch that controls start/stop queue processor
"RTN","MAGBRTE4",22,0)
 N ANY ;------ Flag: processed any rule
"RTN","MAGBRTE4",23,0)
 N CONS ;----- Switch that indicates whether or not site has "consolidated" code
"RTN","MAGBRTE4",24,0)
 N KEYWORD ;-- Array with all keywords
"RTN","MAGBRTE4",25,0)
 N MAGFILE1 ;- Name of file
"RTN","MAGBRTE4",26,0)
 N XMSG ;----- Message counter
"RTN","MAGBRTE4",27,0)
 ;
"RTN","MAGBRTE4",28,0)
 F I="MAGEVAL","MAGEVALSTUDY" K ^XTMP(I,ZTSK)
"RTN","MAGBRTE4",29,0)
 D LOG^MAGBRTE5("Started at "_$H)
"RTN","MAGBRTE4",30,0)
 S XMSG=1,CONS=$$CONSOLID^MAGBAPI()
"RTN","MAGBRTE4",31,0)
 S PLACE=$S(CONS:$O(^MAG(2006.1,"B",LOCATION,"")),1:1)
"RTN","MAGBRTE4",32,0)
 L +^MAGDICOM(2006.563,1,"EVAL",LOCATION):0 E  D  Q
"RTN","MAGBRTE4",33,0)
 . D LOG^MAGBRTE5("A rule evaluator is already running for "_$$GET1^DIQ(4,LOCATION,.01))
"RTN","MAGBRTE4",34,0)
 . Q
"RTN","MAGBRTE4",35,0)
 S ^MAGDICOM(2006.563,1,"EVAL")=1
"RTN","MAGBRTE4",36,0)
 ;
"RTN","MAGBRTE4",37,0)
 S I="" F  S I=$O(RULES(I)) Q:I=""  D
"RTN","MAGBRTE4",38,0)
 . N D0,D1,D2,L,Q1
"RTN","MAGBRTE4",39,0)
 . S X=RULES(I),D0=$P(X,"^",1),Q1=$P(X,"^",2),L=$L(X,"^")
"RTN","MAGBRTE4",40,0)
 . I L=3 S RULE(D0,Q1)=$P(X,"^",3) Q
"RTN","MAGBRTE4",41,0)
 . I Q1="ACTION" S RULE(D0,Q1,$P(X,"^",3))=$P(X,"^",4,L) Q
"RTN","MAGBRTE4",42,0)
 . I Q1'="CONDITION" D LOG^MAGBRTE5("Rule "_D0_" has a qualifier """_Q1_""".") Q
"RTN","MAGBRTE4",43,0)
 . I L=5 S RULE(D0,Q1,$P(X,"^",3),$P(X,"^",4))=$P(X,"^",5) Q
"RTN","MAGBRTE4",44,0)
 . S RULE(D0,Q1,$P(X,"^",3),$P(X,"^",4),$P(X,"^",6),$P(X,"^",5))=$P(X,"^",7)
"RTN","MAGBRTE4",45,0)
 . Q
"RTN","MAGBRTE4",46,0)
 K RULES
"RTN","MAGBRTE4",47,0)
 ;
"RTN","MAGBRTE4",48,0)
 S ACTIVE=1 F  D  Q:'ACTIVE
"RTN","MAGBRTE4",49,0)
 . S ANY=0
"RTN","MAGBRTE4",50,0)
 . S ACTIVE=+$G(^MAGDICOM(2006.563,1,"EVAL")) I 'ACTIVE D  Q
"RTN","MAGBRTE4",51,0)
 . . D LOG^MAGBRTE5("Stopped at "_$H)
"RTN","MAGBRTE4",52,0)
 . . Q
"RTN","MAGBRTE4",53,0)
 . D
"RTN","MAGBRTE4",54,0)
 . . N IMAGE,QPTR,QPTR2,STATUS,X
"RTN","MAGBRTE4",55,0)
 . . D:'CONS ADD^MAGBAPI(0,"EVAL")
"RTN","MAGBRTE4",56,0)
 . . D:CONS ADD^MAGBAPI(0,"EVAL",PLACE)
"RTN","MAGBRTE4",57,0)
 . . S QPTR2=$O(^MAGQUEUE(2006.031,"B","EVAL",""))
"RTN","MAGBRTE4",58,0)
 . . S QPTR=$S(QPTR2:$P(^MAGQUEUE(2006.031,QPTR2,0),"^",2),1:"")
"RTN","MAGBRTE4",59,0)
 . . ; Get next queue pointer value
"RTN","MAGBRTE4",60,0)
 . . S:'CONS QPTR=$O(^MAGQUEUE(2006.03,"B","EVAL",QPTR))
"RTN","MAGBRTE4",61,0)
 . . S:CONS QPTR=$O(^MAGQUEUE(2006.03,"C",PLACE,"EVAL",QPTR))
"RTN","MAGBRTE4",62,0)
 . . I QPTR="" Q  ; Nothing to do
"RTN","MAGBRTE4",63,0)
 . . ;
"RTN","MAGBRTE4",64,0)
 . . S X=$G(^MAGQUEUE(2006.03,QPTR,0))
"RTN","MAGBRTE4",65,0)
 . . ; After an error, sometimes the entry is purged,
"RTN","MAGBRTE4",66,0)
 . . ; but the cross reference is still present.
"RTN","MAGBRTE4",67,0)
 . . ; In such a case, remove the cross reference.
"RTN","MAGBRTE4",68,0)
 . . I X="" D  Q
"RTN","MAGBRTE4",69,0)
 . . . K:'CONS ^MAGQUEUE(2006.03,"B","EVAL",QPTR)
"RTN","MAGBRTE4",70,0)
 . . . K:CONS ^MAGQUEUE(2006.03,"C",PLACE,"EVAL",QPTR)
"RTN","MAGBRTE4",71,0)
 . . . Q
"RTN","MAGBRTE4",72,0)
 . . ;
"RTN","MAGBRTE4",73,0)
 . . S IMAGE=$P(X,"^",7),ANY=1
"RTN","MAGBRTE4",74,0)
 . . I IMAGE,$D(^MAG(2005,IMAGE,0)) D
"RTN","MAGBRTE4",75,0)
 . . . S STATUS=$$RULES() Q:STATUS'<0
"RTN","MAGBRTE4",76,0)
 . . . I STATUS["NO NETWORK LOCATION" D  Q
"RTN","MAGBRTE4",77,0)
 . . . . D LOG^MAGBRTE5("Image "_IMAGE_" has no files associated with it")
"RTN","MAGBRTE4",78,0)
 . . . . Q
"RTN","MAGBRTE4",79,0)
 . . . D LOG^MAGBRTE5("*** EVAL queue error: "_STATUS_" ***")
"RTN","MAGBRTE4",80,0)
 . . . Q
"RTN","MAGBRTE4",81,0)
 . . D DQUE^MAGQBUT2(QPTR)
"RTN","MAGBRTE4",82,0)
 . . Q
"RTN","MAGBRTE4",83,0)
 . H:'ANY 1
"RTN","MAGBRTE4",84,0)
 . D:'$D(^XTMP("MAGEVAL",ZTSK)) XTINIT^MAGDRPC5,LOG^MAGBRTE5("^XTMP was cleaned up.")
"RTN","MAGBRTE4",85,0)
 . Q
"RTN","MAGBRTE4",86,0)
 L -^MAGDICOM(2006.563,1,"EVAL",LOCATION)
"RTN","MAGBRTE4",87,0)
 Q
"RTN","MAGBRTE4",88,0)
 ;
"RTN","MAGBRTE4",89,0)
RULES() ; To be called from above
"RTN","MAGBRTE4",90,0)
 ; IMAGE ;---- IEN for image (2005)
"RTN","MAGBRTE4",91,0)
 ; LOCATION ;- Location from which queue entry originates
"RTN","MAGBRTE4",92,0)
 N ACTION ;--- Action to be taken (SEND)
"RTN","MAGBRTE4",93,0)
 N C ;-------- Loop-variable for looping through parameters and conditions
"RTN","MAGBRTE4",94,0)
 N D ;-------- Data type
"RTN","MAGBRTE4",95,0)
 N DS ;------- Data type enclosed in space-characters
"RTN","MAGBRTE4",96,0)
 N F ;-------- ...
"RTN","MAGBRTE4",97,0)
 N METMSG ;--- Message to be issued when rule is evaluated
"RTN","MAGBRTE4",98,0)
 N O ;-------- Operator
"RTN","MAGBRTE4",99,0)
 N OK ;------- Flag: indicates whether or not rule is met
"RTN","MAGBRTE4",100,0)
 N RDT ;------ Current date (don't use DT, process might run over midnight)
"RTN","MAGBRTE4",101,0)
 N STUDYUID ;- Study UID
"RTN","MAGBRTE4",102,0)
 N V ;-------- Value for property as specified in rule
"RTN","MAGBRTE4",103,0)
 N VAL ;------ Actual value of property
"RTN","MAGBRTE4",104,0)
 N VRS ;------ String of Queue Entry numbers when rule(s) are met
"RTN","MAGBRTE4",105,0)
 N X ;-------- Scratch variable
"RTN","MAGBRTE4",106,0)
 ;
"RTN","MAGBRTE4",107,0)
 S VRS=""
"RTN","MAGBRTE4",108,0)
 ;
"RTN","MAGBRTE4",109,0)
 D KEYWORD^MAGBRTK
"RTN","MAGBRTE4",110,0)
 ;
"RTN","MAGBRTE4",111,0)
 D FILEFIND^MAGDFB(IMAGE,"FULL",0,0,.MAGFILE1)
"RTN","MAGBRTE4",112,0)
 Q:MAGFILE1<0 MAGFILE1
"RTN","MAGBRTE4",113,0)
 ;
"RTN","MAGBRTE4",114,0)
 S STUDYUID=$P($G(^MAG(2005,IMAGE,"PACS")),"^",1)
"RTN","MAGBRTE4",115,0)
 S X=$P($G(^MAG(2005,IMAGE,0)),"^",10)
"RTN","MAGBRTE4",116,0)
 S:X STUDYUID=$P($G(^MAG(2005,X,"PACS")),"^",1)
"RTN","MAGBRTE4",117,0)
 ;
"RTN","MAGBRTE4",118,0)
 S RULE=0 F  S RULE=$O(RULE(RULE)) Q:'RULE  D
"RTN","MAGBRTE4",119,0)
 . S METMSG=$G(RULE(RULE,"ACTION"))
"RTN","MAGBRTE4",120,0)
 . S X=" (",C=0 F  S C=$O(RULE(RULE,"ACTION",C)) Q:'C  D
"RTN","MAGBRTE4",121,0)
 . . S METMSG=METMSG_X_$G(RULE(RULE,"ACTION",C)),X=", "
"RTN","MAGBRTE4",122,0)
 . . Q
"RTN","MAGBRTE4",123,0)
 . S:X'=" (" METMSG=METMSG_")"
"RTN","MAGBRTE4",124,0)
 . S:METMSG="" METMSG="Rule #"_RULE
"RTN","MAGBRTE4",125,0)
 . S OK=$G(^XTMP("MAGEVALSTUDY",ZTSK,STUDYUID,RULE))
"RTN","MAGBRTE4",126,0)
 . I OK="" S OK=1,C=0 F  S C=$O(RULE(RULE,"CONDITION",C)) Q:'C  D  Q:'OK
"RTN","MAGBRTE4",127,0)
 . . S F=$G(RULE(RULE,"CONDITION",C,"KW")) Q:F=""
"RTN","MAGBRTE4",128,0)
 . . S X=$G(KEYWORD("CONDITION",F),"^DICOM^MAGBRTE3(F,""OUT"",.VAL)")
"RTN","MAGBRTE4",129,0)
 . . K VAL D @$P(X,"^",2,9)
"RTN","MAGBRTE4",130,0)
 . . ; If the field is not defined, the test passes...
"RTN","MAGBRTE4",131,0)
 . . Q:$D(VAL)'=1  ; We won't deal with multiple values just yet...
"RTN","MAGBRTE4",132,0)
 . . ;
"RTN","MAGBRTE4",133,0)
 . . S V=$G(RULE(RULE,"CONDITION",C,"VA"))
"RTN","MAGBRTE4",134,0)
 . . S D=$G(RULE(RULE,"CONDITION",C,"DT"))
"RTN","MAGBRTE4",135,0)
 . . S O=$G(RULE(RULE,"CONDITION",C,"OP"))
"RTN","MAGBRTE4",136,0)
 . . S:D="" D="S"
"RTN","MAGBRTE4",137,0)
 . . S DS=" "_D_" "
"RTN","MAGBRTE4",138,0)
 . . D:" S CS DS IS LO LT OB OW PN SH ST "[DS
"RTN","MAGBRTE4",139,0)
 . . . N WILD ;-- Wildcard to be matched
"RTN","MAGBRTE4",140,0)
 . . . S WILD=$$WLDMATCH^MAGBRTE5(VAL,V)
"RTN","MAGBRTE4",141,0)
 . . . I O="=",'WILD S OK=0 Q
"RTN","MAGBRTE4",142,0)
 . . . I O="!=",WILD S OK=0 Q
"RTN","MAGBRTE4",143,0)
 . . . Q
"RTN","MAGBRTE4",144,0)
 . . D:" DT DA TM "[DS
"RTN","MAGBRTE4",145,0)
 . . . Q:O'="="  ; Only "within range" comparisons allowed currently
"RTN","MAGBRTE4",146,0)
 . . . ;
"RTN","MAGBRTE4",147,0)
 . . . N A ;--- Flag: indicates whether at least one time-frame matches
"RTN","MAGBRTE4",148,0)
 . . . N B ;--- Begin date/time
"RTN","MAGBRTE4",149,0)
 . . . N E ;--- End date/time
"RTN","MAGBRTE4",150,0)
 . . . N I ;--- Loopcounter
"RTN","MAGBRTE4",151,0)
 . . . N M ;--- Date/time mask
"RTN","MAGBRTE4",152,0)
 . . . N N ;--- Loopcounter (time-frames)
"RTN","MAGBRTE4",153,0)
 . . . N %T ;-- FileMan internal variable
"RTN","MAGBRTE4",154,0)
 . . . N VV ;-- Actual value
"RTN","MAGBRTE4",155,0)
 . . . N WD ;-- Weekday
"RTN","MAGBRTE4",156,0)
 . . . N X1 ;-- FileMan API parameter value -- date
"RTN","MAGBRTE4",157,0)
 . . . N X2 ;-- FileMan API parameter value -- date
"RTN","MAGBRTE4",158,0)
 . . . ;
"RTN","MAGBRTE4",159,0)
 . . . ; convert the literal date/time field into the format for comparison
"RTN","MAGBRTE4",160,0)
 . . . S VV=VAL
"RTN","MAGBRTE4",161,0)
 . . . ;
"RTN","MAGBRTE4",162,0)
 . . . S (A,N)=0 F  S N=$O(RULE(RULE,"CONDITION",C,"VA",N)) Q:'N  D
"RTN","MAGBRTE4",163,0)
 . . . . N T,VB,VC,VE
"RTN","MAGBRTE4",164,0)
 . . . . S M=$G(RULE(RULE,"CONDITION",C,"VA",N,"M"))
"RTN","MAGBRTE4",165,0)
 . . . . S B=$G(RULE(RULE,"CONDITION",C,"VA",N,"B"))
"RTN","MAGBRTE4",166,0)
 . . . . S E=$G(RULE(RULE,"CONDITION",C,"VA",N,"E"))
"RTN","MAGBRTE4",167,0)
 . . . . S T=1
"RTN","MAGBRTE4",168,0)
 . . . . I $E(M,1,3)="HOL" S:$$GET1^DIQ(40.5,+$E(VV,5,11),.01)="" T=0 ; IA 10038
"RTN","MAGBRTE4",169,0)
 . . . . I $E(M,1,3)="DDD",$E(B,1,3)'=$E(VAL,1,3) S T=0
"RTN","MAGBRTE4",170,0)
 . . . . S (VB,VC,VE)=""
"RTN","MAGBRTE4",171,0)
 . . . . F I=4:1:$L(M) S:$E(M,I)?1U VC=VC_$E(VV,I),VB=VB_$E(B,I),VE=VE_$E(E,I)
"RTN","MAGBRTE4",172,0)
 . . . . S:VB>VC T=0
"RTN","MAGBRTE4",173,0)
 . . . . S:VE<VC T=0
"RTN","MAGBRTE4",174,0)
 . . . . S:T A=1
"RTN","MAGBRTE4",175,0)
 . . . . Q
"RTN","MAGBRTE4",176,0)
 . . . S:'A OK=0
"RTN","MAGBRTE4",177,0)
 . . . Q
"RTN","MAGBRTE4",178,0)
 . . Q
"RTN","MAGBRTE4",179,0)
 . S ^XTMP("MAGEVALSTUDY",ZTSK,STUDYUID,RULE)=OK
"RTN","MAGBRTE4",180,0)
 . S METMSG(OK,METMSG)=""
"RTN","MAGBRTE4",181,0)
 . S RDT=$$NOW^XLFDT()\1
"RTN","MAGBRTE4",182,0)
 . Q:'OK
"RTN","MAGBRTE4",183,0)
 . S ACTION=$G(RULE(RULE,"ACTION"))
"RTN","MAGBRTE4",184,0)
 . Q:ACTION=""
"RTN","MAGBRTE4",185,0)
 . I ACTION="SEND" D  Q
"RTN","MAGBRTE4",186,0)
 . . N D,PRI,X
"RTN","MAGBRTE4",187,0)
 . . S X=$G(RULE(RULE,"ACTION",1))
"RTN","MAGBRTE4",188,0)
 . . I X="" S METMSG(0,"No location for rule "_RULE)="" Q
"RTN","MAGBRTE4",189,0)
 . . D VALDEST^MAGDRPC1(.D,X)
"RTN","MAGBRTE4",190,0)
 . . I D<0 S METMSG(0,"Cannot find location """_X_""".")="" Q
"RTN","MAGBRTE4",191,0)
 . . S PRI=$$PRI($G(RULE(RULE,"PRIORITY")),IMAGE)
"RTN","MAGBRTE4",192,0)
 . . S VRS=$$VRS^MAGBRTE5(VRS,$$SEND^MAGBRTE5(IMAGE,D,PRI,1,LOCATION))
"RTN","MAGBRTE4",193,0)
 . . Q
"RTN","MAGBRTE4",194,0)
 . I ACTION="DICOM" D  Q
"RTN","MAGBRTE4",195,0)
 . . N D,PRI,X
"RTN","MAGBRTE4",196,0)
 . . S X=$G(RULE(RULE,"ACTION",1))
"RTN","MAGBRTE4",197,0)
 . . I X="" S METMSG(0,"No location for rule "_RULE)="" Q
"RTN","MAGBRTE4",198,0)
 . . S D=$O(^MAG(2006.587,"B",X,""))
"RTN","MAGBRTE4",199,0)
 . . I D="" S METMSG(0,"Cannot find location """_X_""".")="" Q
"RTN","MAGBRTE4",200,0)
 . . S PRI=$$PRI($G(RULE(RULE,"PRIORITY")),IMAGE)
"RTN","MAGBRTE4",201,0)
 . . S VRS=$$VRS^MAGBRTE5(VRS,$$SEND^MAGBRTE5(IMAGE,D,PRI,2,LOCATION))
"RTN","MAGBRTE4",202,0)
 . . Q
"RTN","MAGBRTE4",203,0)
 . I ACTION="BALANCE" D BALANCE^MAGBRTE5(IMAGE,.RULE) Q
"RTN","MAGBRTE4",204,0)
 . ;
"RTN","MAGBRTE4",205,0)
 . ; Other actions to be inserted here...
"RTN","MAGBRTE4",206,0)
 . ;
"RTN","MAGBRTE4",207,0)
 . Q
"RTN","MAGBRTE4",208,0)
 ;
"RTN","MAGBRTE4",209,0)
 ; Note: we may have:
"RTN","MAGBRTE4",210,0)
 ;    Rule 1: If CR, send to XXX
"RTN","MAGBRTE4",211,0)
 ;    Rule 2: If CT, send to XXX
"RTN","MAGBRTE4",212,0)
 ; For a CR, this would cause an entry of
"RTN","MAGBRTE4",213,0)
 ;    METMSG(0,"SEND(XXX)") for rule 2
"RTN","MAGBRTE4",214,0)
 ; and an entry of
"RTN","MAGBRTE4",215,0)
 ;    METMSG(1,"SEND(XXX)") for rule 1
"RTN","MAGBRTE4",216,0)
 ; and for a CT it would be the other way around.
"RTN","MAGBRTE4",217,0)
 ; So, first remove all "failed" entries that were successful
"RTN","MAGBRTE4",218,0)
 ; for a different rule.
"RTN","MAGBRTE4",219,0)
 ;
"RTN","MAGBRTE4",220,0)
 S X="" F  S X=$O(METMSG(1,X)) Q:X=""  D
"RTN","MAGBRTE4",221,0)
 . D LOG^MAGBRTE5("Image "_IMAGE_": "_X)
"RTN","MAGBRTE4",222,0)
 . K METMSG(0,X)
"RTN","MAGBRTE4",223,0)
 . Q
"RTN","MAGBRTE4",224,0)
 S X="" F  S X=$O(METMSG(0,X)) Q:X=""  D
"RTN","MAGBRTE4",225,0)
 . D LOG^MAGBRTE5("Image "_IMAGE_": Do not "_X)
"RTN","MAGBRTE4",226,0)
 . Q
"RTN","MAGBRTE4",227,0)
 Q VRS
"RTN","MAGBRTE4",228,0)
 ;
"RTN","MAGBRTE4",229,0)
 ;
"RTN","MAGBRTE4",230,0)
PRI(PRI,IMAGE) N C,D0,D1,D2,O,P,R,X
"RTN","MAGBRTE4",231,0)
 S PRI=$S(PRI="HIGH":750,PRI="NORMAL":500,PRI="LOW":250,1:500)
"RTN","MAGBRTE4",232,0)
 S X=$G(^MAG(2005,IMAGE,2))
"RTN","MAGBRTE4",233,0)
 S P=$P(X,"^",6) Q:P'=74 PRI
"RTN","MAGBRTE4",234,0)
 S R=$P(X,"^",7) Q:'R PRI
"RTN","MAGBRTE4",235,0)
 S C=$P($G(^RARPT(R,0)),"^",1) Q:C="" PRI  ; IA 1171
"RTN","MAGBRTE4",236,0)
 S D0=$O(^RADPT("ADC",C,"")) Q:'D0 PRI  ; IA 1172
"RTN","MAGBRTE4",237,0)
 S D1=$O(^RADPT("ADC",C,D0,"")) Q:'D1 PRI  ; IA 1172
"RTN","MAGBRTE4",238,0)
 S D2=$O(^RADPT("ADC",C,D0,D1,"")) Q:'D2 PRI  ; IA 1172
"RTN","MAGBRTE4",239,0)
 S O=$P($G(^RADPT(D0,"DT",D1,"P",D2,0)),"^",11) Q:'O PRI  ; IA 1172
"RTN","MAGBRTE4",240,0)
 S X=$P($G(^RAO(75.1,O,0)),"^",6) ; IA 3074
"RTN","MAGBRTE4",241,0)
 Q PRI+$S(X=1:20,X=2:10,1:0)
"RTN","MAGBRTE4",242,0)
 ;
"RTN","MAGFILEB")
0^3^B49779032
"RTN","MAGFILEB",1,0)
MAGFILEB ;WOIFO/RED - CREATE FILE REFERENCE FROM ^MAG(2005) ; 10/22/2002  06:39
"RTN","MAGFILEB",2,0)
 ;;3.0;IMAGING;**8,48,39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGFILEB",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGFILEB",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGFILEB",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGFILEB",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGFILEB",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGFILEB",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGFILEB",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGFILEB",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGFILEB",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGFILEB",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGFILEB",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGFILEB",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGFILEB",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGFILEB",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGFILEB",17,0)
 ;;
"RTN","MAGFILEB",18,0)
 Q
"RTN","MAGFILEB",19,0)
 ; CALL WITH MAGXX=IEN NUMBER IN IMAGE FILE (2005)
"RTN","MAGFILEB",20,0)
 ;Calling FINDFILE requires FILETYPE to be defined ["FULL"|"ABSTRACT"|"BIG"|"TEXT"]
"RTN","MAGFILEB",21,0)
 ;   returns : 
"RTN","MAGFILEB",22,0)
 ; ..MAGFILE1 =          FILENAME ONLY
"RTN","MAGFILEB",23,0)
 ; ..MAGFILE1(.01)=      .01 FIELD OF FILE (2005)
"RTN","MAGFILEB",24,0)
 ; ..MAGFILE1("ERROR") = Message if NetWork device is offline and Image Not On JB
"RTN","MAGFILEB",25,0)
 ; ..MAGINST =                   Pointer to Institution File (Consolidated)
"RTN","MAGFILEB",26,0)
 ; ..                      OR  IEN of Imaging Site Parameters only entry (Non-Consolidated)
"RTN","MAGFILEB",27,0)
 ; ..MAGJBOL =                   NULL("")  OR " ** "_Name of Platter that is Offline"_" ** "
"RTN","MAGFILEB",28,0)
 ; ..MAGOFFLN =                  NULL("")  OR "1"   "1" means image is on platter that is offline.
"RTN","MAGFILEB",29,0)
 ; ..MAGPLACE =                  PLACE of Image. (IEN of IMAGING SITE PARAMETERS FILE)
"RTN","MAGFILEB",30,0)
 ; ..                                      Determined from Network Location file                 
"RTN","MAGFILEB",31,0)
 ; ..MAGPREF  =          Full Path of Image Network (or Jukebox) Directory 
"RTN","MAGFILEB",32,0)
 ;
"RTN","MAGFILEB",33,0)
 ;Calling other TAGS (VST,VSTNOCP,ABS,ABSNOCP,BIG,BIGNOCP,FULL,ABSTRACT,BIGFILE)      
"RTN","MAGFILEB",34,0)
 ;   return all of above and : 
"RTN","MAGFILEB",35,0)
 ; ..MAGFILE  =          FILE NAME WITH FULL PATH FOLLOWED BY $C(0)
"RTN","MAGFILEB",36,0)
 ; ..MAGFILE2 =          FILE NAME WITH FULL PATH W/O $C(0)
"RTN","MAGFILEB",37,0)
 ; .. Deletes MAGXX
"RTN","MAGFILEB",38,0)
 ; .. Does not Return MAGPREF
"RTN","MAGFILEB",39,0)
 ; Modified to handle hierarchical directory hash 4/23/98 -- PMK
"RTN","MAGFILEB",40,0)
 ;
"RTN","MAGFILEB",41,0)
 Q
"RTN","MAGFILEB",42,0)
VST ; Entry point to get a full size image with copying from JB to MAG DISK
"RTN","MAGFILEB",43,0)
 N MAGPREF,MAGJBCP S MAGJBCP=1 G FULL
"RTN","MAGFILEB",44,0)
 ;
"RTN","MAGFILEB",45,0)
VSTNOCP ; Entry point to get a full size image without copying it from the JB
"RTN","MAGFILEB",46,0)
 N MAGPREF,MAGJBCP S MAGJBCP=0 G FULL
"RTN","MAGFILEB",47,0)
 ;
"RTN","MAGFILEB",48,0)
ABS ; Entry point to get an image abstract with copying from JB to MAG DISK
"RTN","MAGFILEB",49,0)
 N MAGPREF,MAGJBCP S MAGJBCP=1 G ABSTRACT
"RTN","MAGFILEB",50,0)
 ;
"RTN","MAGFILEB",51,0)
ABSNOCP ; Entry point to get an image abstract without copying it from the JB
"RTN","MAGFILEB",52,0)
 N MAGPREF,MAGJBCP S MAGJBCP=0 G ABSTRACT
"RTN","MAGFILEB",53,0)
 ;
"RTN","MAGFILEB",54,0)
BIG ; Entry point to get a big file with copying from JB to MAG DISK
"RTN","MAGFILEB",55,0)
 N MAGPREF,MAGJBCP S MAGJBCP=1 G BIGFILE
"RTN","MAGFILEB",56,0)
 ;
"RTN","MAGFILEB",57,0)
BIGNOCP ; Entry point to get a big without copying it from the JB
"RTN","MAGFILEB",58,0)
 N MAGPREF,MAGJBCP S MAGJBCP=0 G BIGFILE
"RTN","MAGFILEB",59,0)
 ;
"RTN","MAGFILEB",60,0)
FULL N FILETYPE,MAGTYPE S FILETYPE="FULL" D FINDFILE G EXIT
"RTN","MAGFILEB",61,0)
 ;
"RTN","MAGFILEB",62,0)
ABSTRACT N FILETYPE,MAGTYPE S FILETYPE="ABSTRACT" D FINDFILE G EXIT
"RTN","MAGFILEB",63,0)
 ;
"RTN","MAGFILEB",64,0)
BIGFILE N FILETYPE,MAGTYPE S FILETYPE="BIG" D FINDFILE G EXIT
"RTN","MAGFILEB",65,0)
 ;
"RTN","MAGFILEB",66,0)
EXIT S MAGPREF=$G(MAGPREF)
"RTN","MAGFILEB",67,0)
 S MAGFILE2=MAGPREF_MAGFILE1,MAGFILE=MAGFILE2_$C(0)
"RTN","MAGFILEB",68,0)
 K MAGXX Q
"RTN","MAGFILEB",69,0)
 ;
"RTN","MAGFILEB",70,0)
FINDFILE ;
"RTN","MAGFILEB",71,0)
 N MAG0,MAGERR,MAGREF,MAGSTORE,CNDBMP
"RTN","MAGFILEB",72,0)
 K MAGPREF,MAGFILE1("ERROR") S (MAGJBOL,MAGERR,MAGTYPE,MAGOFFLN,MAGREF)=""
"RTN","MAGFILEB",73,0)
 I '$D(^MAG(2005,+MAGXX,0)) S MAGFILE1="-13,Image "_MAGXX_" is deleted",MAGERR=1 Q
"RTN","MAGFILEB",74,0)
 S MAG0=^MAG(2005,+MAGXX,0),MAGFILE1=$P(MAG0,"^",2)
"RTN","MAGFILEB",75,0)
 S MAGFILE1(.01)=$P(MAG0,"^") ; for MAILMAN interface
"RTN","MAGFILEB",76,0)
 S MAGFILE1=$P(MAGFILE1,"\",$L(MAGFILE1,"\"))
"RTN","MAGFILEB",77,0)
 ; 
"RTN","MAGFILEB",78,0)
 I FILETYPE="TEXT" S FILETYPE="FULL" S $P(MAGFILE1,".",2)="TXT"
"RTN","MAGFILEB",79,0)
 ;
"RTN","MAGFILEB",80,0)
 I FILETYPE="FULL" D  ; code for full size image
"RTN","MAGFILEB",81,0)
 . S MAGREF=$P(MAG0,"^",3)
"RTN","MAGFILEB",82,0)
 . I MAGREF="" S MAGJB=1,MAGREF=$P(MAG0,"^",5) ; get file from jukebox
"RTN","MAGFILEB",83,0)
 . Q
"RTN","MAGFILEB",84,0)
 ;
"RTN","MAGFILEB",85,0)
 I FILETYPE="ABSTRACT" D  Q:MAGERR  ; code for abstract
"RTN","MAGFILEB",86,0)
 . ;  gek 8/26/02 not sending full as the abstract for Documents.
"RTN","MAGFILEB",87,0)
 . ;  If Abs doesn't exist for Document (TIF) we'll Queue it. (don't know if it's on JB)
"RTN","MAGFILEB",88,0)
 . S MAGREF=$P(MAG0,"^",4)
"RTN","MAGFILEB",89,0)
 . I (MAGREF="") D  Q:MAGERR
"RTN","MAGFILEB",90,0)
 . . D RSLVABS^MAGGTU3(MAGXX,.CNDBMP)
"RTN","MAGFILEB",91,0)
 . . I $L(CNDBMP) S MAGFILE1=CNDBMP,MAGERR=1 Q
"RTN","MAGFILEB",92,0)
 . . S MAGJB=1,MAGREF=$P(MAG0,"^",5) ; get file from jukebox
"RTN","MAGFILEB",93,0)
 . . ;Patch 48 stop queing abstracts.
"RTN","MAGFILEB",94,0)
 . . ;I $P(MAG0,"^",6)=15 S X=$$ABSTRACT^MAGBAPI(+MAGXX)
"RTN","MAGFILEB",95,0)
 . . Q
"RTN","MAGFILEB",96,0)
 . S $P(MAGFILE1,".",2)="ABS"
"RTN","MAGFILEB",97,0)
 . Q
"RTN","MAGFILEB",98,0)
 ;
"RTN","MAGFILEB",99,0)
 I FILETYPE="BIG" D  Q:MAGERR  ; code for big file
"RTN","MAGFILEB",100,0)
 . N EXT,FBIG  ;
"RTN","MAGFILEB",101,0)
 . S FBIG=$G(^MAG(2005,MAGXX,"FBIG"))
"RTN","MAGFILEB",102,0)
 . I FBIG="" D  Q  ; no big file exists
"RTN","MAGFILEB",103,0)
 . . S MAGPREF="",MAGFILE1="-1~BIG File Does NOT Exist",MAGERR=1
"RTN","MAGFILEB",104,0)
 . . Q
"RTN","MAGFILEB",105,0)
 . S EXT=$P(FBIG,"^",3) I EXT="" S EXT="BIG"
"RTN","MAGFILEB",106,0)
 . S $P(MAGFILE1,".",2)=EXT
"RTN","MAGFILEB",107,0)
 . S MAGREF=$P(FBIG,"^") ; get file from magnetic disk, if possible
"RTN","MAGFILEB",108,0)
 . I MAGREF="" S MAGREF=$P(FBIG,"^",2) ; get file from jukebox
"RTN","MAGFILEB",109,0)
 . Q
"RTN","MAGFILEB",110,0)
 ;
"RTN","MAGFILEB",111,0)
 I MAGREF="" D  Q  ;NO NETWORK LOCATION
"RTN","MAGFILEB",112,0)
 . S MAGFILE1="-1~NO NETWORK OR JUKEBOX LOCATION DEFINED"
"RTN","MAGFILEB",113,0)
 ;
"RTN","MAGFILEB",114,0)
 I '$D(^MAG(2005.2,MAGREF,0)) D  Q  ; BAD POINTER
"RTN","MAGFILEB",115,0)
 . S MAGFILE1="-1~INVALID NETWORK LOCATION POINTER ->"_MAGREF
"RTN","MAGFILEB",116,0)
 ;
"RTN","MAGFILEB",117,0)
 S MAGSTORE=^MAG(2005.2,MAGREF,0),MAGTYPE=$P(MAGSTORE,"^",7)
"RTN","MAGFILEB",118,0)
 I MAGTYPE="" S MAGTYPE=$E(MAGSTORE,1,4) ; in case the type is null
"RTN","MAGFILEB",119,0)
 ;
"RTN","MAGFILEB",120,0)
 S MAGERR=""
"RTN","MAGFILEB",121,0)
 I '$P(MAGSTORE,"^",6) D  Q:MAGERR  ; the network device is off-line
"RTN","MAGFILEB",122,0)
 . I MAGTYPE["MAG" D  Q:MAGERR  ; get the jukebox device
"RTN","MAGFILEB",123,0)
 . . S MAGSTORE=$P(MAG0,"^",5)
"RTN","MAGFILEB",124,0)
 . . I 'MAGSTORE D NOWHERE S MAGERR=1 Q  ;big trouble:nowhere on jbox
"RTN","MAGFILEB",125,0)
 . . S MAGSTORE=^MAG(2005.2,MAGSTORE,0) ; get the file from the jbox
"RTN","MAGFILEB",126,0)
 . . Q
"RTN","MAGFILEB",127,0)
 . I '$P(MAGSTORE,"^",6) D OFFLINE S MAGERR=1 Q  ;jbox cartridge offline
"RTN","MAGFILEB",128,0)
 . S MAGREF=$P(MAG0,"^",5)
"RTN","MAGFILEB",129,0)
 . Q
"RTN","MAGFILEB",130,0)
 ;
"RTN","MAGFILEB",131,0)
 S MAGPREF=""
"RTN","MAGFILEB",132,0)
 I MAGTYPE["MAG" S MAGPREF=$P(MAGSTORE,"^",2)
"RTN","MAGFILEB",133,0)
 ;
"RTN","MAGFILEB",134,0)
 I MAGTYPE?1"WORM".E D  ; code for Jukeboxes
"RTN","MAGFILEB",135,0)
 . I MAGTYPE=("WORM-OTG") S MAGPREF=$P(MAGSTORE,"^",2)
"RTN","MAGFILEB",136,0)
 . E  I MAGTYPE="WORM-PDT" S MAGPREF=$P(MAGSTORE,"^",2)
"RTN","MAGFILEB",137,0)
 . E  I MAGTYPE["WORM-DG" D  ; this code is for DG/SONY jukebox
"RTN","MAGFILEB",138,0)
 . . N SUBDIR ; the subdirectory is the last two digits of the file name
"RTN","MAGFILEB",139,0)
 . . S SUBDIR=$P(MAGFILE1,".")
"RTN","MAGFILEB",140,0)
 . . S SUBDIR=$E(100+$E(SUBDIR,$L(SUBDIR)-1,999),2,3)_"\"
"RTN","MAGFILEB",141,0)
 . . S MAGPREF=$P(MAGSTORE,"^",2)_SUBDIR
"RTN","MAGFILEB",142,0)
 . . Q
"RTN","MAGFILEB",143,0)
 . ; The following is for tracking offline images
"RTN","MAGFILEB",144,0)
 . I $$IMOFFLN(MAGFILE1) S MAGOFFLN=1
"RTN","MAGFILEB",145,0)
 . I MAGJBCP D  ; add the image to the JukeBox TO Hard Disk copy queue
"RTN","MAGFILEB",146,0)
 . . S X=$$JBTOHD^MAGBAPI(MAGXX_"^"_FILETYPE,$$GET1^DIQ(2005.2,MAGREF,.04,"I")) ; DBI - SEB Patch 4
"RTN","MAGFILEB",147,0)
 . . Q
"RTN","MAGFILEB",148,0)
 . Q
"RTN","MAGFILEB",149,0)
 ;
"RTN","MAGFILEB",150,0)
 S MAGPREF=MAGPREF_$$DIRHASH^MAGFILEB(MAGFILE1,MAGREF)
"RTN","MAGFILEB",151,0)
 ;
"RTN","MAGFILEB",152,0)
 Q
"RTN","MAGFILEB",153,0)
 ;
"RTN","MAGFILEB",154,0)
DIRHASH(FILENAME,NETLOCN) ; determine the hierarchical file directory hash 
"RTN","MAGFILEB",155,0)
 ;
"RTN","MAGFILEB",156,0)
 ; Input Variables:
"RTN","MAGFILEB",157,0)
 ; FILENAME -- the name of the file, with or without the extension
"RTN","MAGFILEB",158,0)
 ; NETLOCN --- the network location file internal entry number
"RTN","MAGFILEB",159,0)
 ; Return Value: the hierarchical file directory hash
"RTN","MAGFILEB",160,0)
 ;
"RTN","MAGFILEB",161,0)
 N FN,HASHFLAG,HASH,I
"RTN","MAGFILEB",162,0)
 S HASHFLAG=$P(^MAG(2005.2,NETLOCN,0),"^",8)
"RTN","MAGFILEB",163,0)
 I HASHFLAG="Y" D  ; calculate the hierarchical directory hash
"RTN","MAGFILEB",164,0)
 . ; for an 8.3 filename AB123456.XYZ, the directory hash is AB\12\34
"RTN","MAGFILEB",165,0)
 . ; for a 14.3 filename BALT1234567890.XYZ, its BALT\12\34\56\78
"RTN","MAGFILEB",166,0)
 . S FN=$P(FILENAME,".") ; strip off the extension
"RTN","MAGFILEB",167,0)
 . I $L(FN)=8 S HASH=$E(FN,1,2)_"\"_$E(FN,3,4)_"\"_$E(FN,5,6)
"RTN","MAGFILEB",168,0)
 . E  S HASH=$E(FN,1,4) F I=5,7,9,11 S HASH=HASH_"\"_$E(FN,I,I+1)
"RTN","MAGFILEB",169,0)
 . S HASH=HASH_"\" ; add the trailing directory separator
"RTN","MAGFILEB",170,0)
 . Q
"RTN","MAGFILEB",171,0)
 E  S HASH="" ; flat directory structure, no hierarchical hashing 
"RTN","MAGFILEB",172,0)
 Q HASH
"RTN","MAGFILEB",173,0)
 ; 
"RTN","MAGFILEB",174,0)
NOWHERE ; File is not anywhere on the jukebox -- output error message
"RTN","MAGFILEB",175,0)
 ; Requested image file is not on the Jukebox
"RTN","MAGFILEB",176,0)
 S MAGPREF="",MAGFILE1="-1^"_MAGXX_"^^NOWHERE"
"RTN","MAGFILEB",177,0)
 S MAGFILE1("ERROR")="-1~Network device Off-Line and Image not on JukeBox"
"RTN","MAGFILEB",178,0)
 Q
"RTN","MAGFILEB",179,0)
 ;
"RTN","MAGFILEB",180,0)
OFFLINE ; Jukebox Cartridge is off-line -- output error message
"RTN","MAGFILEB",181,0)
 ; Jukebox Cartridge with image file is off-line."
"RTN","MAGFILEB",182,0)
 S MAGPREF="",MAGFILE1="-1^"_MAGXX_"^"_$P(MAG0,"^",5)_"^OFFLINE"
"RTN","MAGFILEB",183,0)
 Q
"RTN","MAGFILEB",184,0)
IMOFFLN(FILE) ;Check to see if image is offline (jb platter removed)
"RTN","MAGFILEB",185,0)
 N XX,X,Y
"RTN","MAGFILEB",186,0)
 I '$L(FILE) Q 0
"RTN","MAGFILEB",187,0)
 S X=FILE X ^%ZOSF("UPPERCASE") S FILE=Y
"RTN","MAGFILEB",188,0)
 I $D(^MAGQUEUE(2006.033,"B",FILE)) D   Q 1
"RTN","MAGFILEB",189,0)
 . S XX="",XX=$O(^MAGQUEUE(2006.033,"B",FILE,XX))
"RTN","MAGFILEB",190,0)
 . S MAGJBOL=" ** "_$P(^MAGQUEUE(2006.033,XX,0),"^",2)_" **"
"RTN","MAGFILEB",191,0)
 Q 0
"RTN","MAGIP39")
0^^B76334031
"RTN","MAGIP39",1,0)
MAGIP39 ;PRE init routine to queue site activity at install. ; 14 Oct 2010 4:39 PM
"RTN","MAGIP39",2,0)
 ;;3.0;IMAGING;**39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGIP39",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGIP39",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGIP39",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGIP39",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGIP39",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGIP39",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGIP39",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGIP39",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGIP39",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGIP39",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGIP39",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGIP39",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGIP39",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGIP39",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGIP39",17,0)
 ;;
"RTN","MAGIP39",18,0)
 Q
"RTN","MAGIP39",19,0)
PRE ;
"RTN","MAGIP39",20,0)
 ; If not first P39 install then must convert the Jukebox default from 54 to 2.01
"RTN","MAGIP39",21,0)
 I $$FLDNUM^DILFD(2006.1,"JUKEBOX DEFAULT") D
"RTN","MAGIP39",22,0)
 . N JBREF,NLREF,PL
"RTN","MAGIP39",23,0)
 . S PL=0
"RTN","MAGIP39",24,0)
 . F  S PL=$O(^MAG(2006.1,PL)) Q:'PL  D
"RTN","MAGIP39",25,0)
 . . S JBREF=$P($G(^MAG(2006.1,PL,1)),U,6) Q:'JBREF
"RTN","MAGIP39",26,0)
 . . S NLREF=$P($G(^MAGQUEUE(2006.032,JBREF,0)),U,3)
"RTN","MAGIP39",27,0)
 . . S $P(^MAG(2006.1,PL,1),U,6)=NLREF
"RTN","MAGIP39",28,0)
 . . Q
"RTN","MAGIP39",29,0)
 . Q
"RTN","MAGIP39",30,0)
 ; Move Pre-Patch 39 data to new location and clear retired fields 11.5,11.9
"RTN","MAGIP39",31,0)
 N PL,LEGACY
"RTN","MAGIP39",32,0)
 S PL=0
"RTN","MAGIP39",33,0)
 F  S PL=$O(^MAG(2006.1,PL)) Q:'PL  D
"RTN","MAGIP39",34,0)
 . S $P(^MAG(2006.1,PL,3),U,7)="" ; CRITICAL LOW MESSAGE INTERVAL - RETIRED
"RTN","MAGIP39",35,0)
 . S $P(^MAG(2006.1,PL,3),U,11)="" ; DATE OF LAST CRITICAL MESSAGE - RETIRED
"RTN","MAGIP39",36,0)
 . Q:$D(^MAG(2006.1,PL,"BPPURGE"))  ; Only for initial conversion
"RTN","MAGIP39",37,0)
 . S $P(^MAG(2006.1,PL,"BPPURGE"),U,1)=$P($G(^MAG(2006.1,PL,5)),U,1) ; New #60 AutoPurge
"RTN","MAGIP39",38,0)
 . S $P(^MAG(2006.1,PL,"BPPURGE"),U,6)=$P($G(^MAG(2006.1,PL,5)),U,3) ; New #61 Scheduled Purge
"RTN","MAGIP39",39,0)
 . S $P(^MAG(2006.1,PL,"BPPURGE"),U,7)=$P($G(^MAG(2006.1,PL,5)),U,6) ; New #61.1 Date of Last Scheduled Purge
"RTN","MAGIP39",40,0)
 . S $P(^MAG(2006.1,PL,"BPPURGE"),U,9)=$P($G(^MAG(2006.1,PL,5)),U,4) ; New #61.2 Scheduled Purge Frequency
"RTN","MAGIP39",41,0)
 . S $P(^MAG(2006.1,PL,"BPPURGE"),U,11)=$P($G(^MAG(2006.1,PL,5)),U,5) ; New #61.4 Scheduled Purge Time
"RTN","MAGIP39",42,0)
 . Q
"RTN","MAGIP39",43,0)
 ; Change the BP Workstation file ( 2006.8) name to BP SERVERS
"RTN","MAGIP39",44,0)
 D:$$UPPER^MAGQE4($P($G(^DIC(2006.8,0)),U,1))["BP WORKSTATIONS" CFILEN("2006.8","BP SERVERS")
"RTN","MAGIP39",45,0)
 ; Remove data dictionary definition so that the new definition installs cleanly
"RTN","MAGIP39",46,0)
 ; Except we are removing fields 9 PACS Purge, 13 Radiology Holds, 14 JBX ALL, 15 JBX ALL PACS, 16 JBX ALL BIG,
"RTN","MAGIP39",47,0)
 ; 17 JBX BIG NON-PACS,18 NO JB DELETE ENTRY, 19 JBX PACS BIG VER TGA, 21 PURGE-RETEN DAYS PACS BIG,
"RTN","MAGIP39",48,0)
 ; 22 PURGE-RETENTION DAYS BIG, 24 PURGE-RETENTION DAYS PACS
"RTN","MAGIP39",49,0)
 ; 
"RTN","MAGIP39",50,0)
 N DIK,DA,DIU
"RTN","MAGIP39",51,0)
 S DIK="^DD(2005.2,",DA=.01,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",52,0)
 S DIK="^DD(2005.2,",DA=.04,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",53,0)
 S DIK="^DD(2005.2,",DA=1,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",54,0)
 S DIK="^DD(2005.2,",DA=2,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",55,0)
 S DIK="^DD(2005.2,",DA=4,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",56,0)
 S DIK="^DD(2005.2,",DA=5.5,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",57,0)
 S DIK="^DD(2005.2,",DA=6,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",58,0)
 S DIK="^DD(2005.2,",DA=8,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",59,0)
 S DIK="^DD(2005.2,",DA=9,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",60,0)
 S DIK="^DD(2005.2,",DA=10,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",61,0)
 S DIK="^DD(2005.2,",DA=11,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",62,0)
 S DIK="^DD(2005.2,",DA=12,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",63,0)
 S DIK="^DD(2005.2,",DA=14,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",64,0)
 S DIK="^DD(2005.2,",DA=15,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",65,0)
 S DIK="^DD(2005.2,",DA=16,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",66,0)
 S DIK="^DD(2005.2,",DA=17,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",67,0)
 S DIK="^DD(2005.2,",DA=18,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",68,0)
 S DIK="^DD(2005.2,",DA=19,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",69,0)
 S DIK="^DD(2005.2,",DA=20,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",70,0)
 S DIK="^DD(2005.2,",DA=21,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",71,0)
 S DIK="^DD(2005.2,",DA=22,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",72,0)
 S DIK="^DD(2005.2,",DA=23,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",73,0)
 S DIK="^DD(2005.2,",DA=24,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",74,0)
 S DIK="^DD(2005.2,",DA=25,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",75,0)
 S DIK="^DD(2005.2,",DA=26,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",76,0)
 S DIK="^DD(2005.2,",DA=27,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",77,0)
 S DIK="^DD(2005.2,",DA=28,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",78,0)
 S DIK="^DD(2005.2,",DA=29,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",79,0)
 S DIK="^DD(2005.2,",DA=30,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",80,0)
 S DIK="^DD(2005.2,",DA=31,DA(1)=2005.2 D ^DIK
"RTN","MAGIP39",81,0)
 S DIK="^DD(2005.86,",DA=6,DA(1)=2005.86 D ^DIK
"RTN","MAGIP39",82,0)
 S DIK="^DD(2006.031,",DA=4,DA(1)=2006.031 D ^DIK
"RTN","MAGIP39",83,0)
 S DIK="^DD(2006.1,",DA=.02,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",84,0)
 S DIK="^DD(2006.1,",DA=.03,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",85,0)
 S DIK="^DD(2006.1,",DA=.031,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",86,0)
 S DIK="^DD(2006.1,",DA=.04,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",87,0)
 S DIK="^DD(2006.1,",DA=.07,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",88,0)
 S DIK="^DD(2006.1,",DA=.08,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",89,0)
 S DIK="^DD(2006.1,",DA=1.02,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",90,0)
 S DIK="^DD(2006.1,",DA=1.03,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",91,0)
 S DIK="^DD(2006.1,",DA=2.01,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",92,0)
 S DIK="^DD(2006.1,",DA=2.02,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",93,0)
 S DIK="^DD(2006.1,",DA=2.03,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",94,0)
 S DIK="^DD(2006.1,",DA=6,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",95,0)
 S DIK="^DD(2006.1,",DA=8,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",96,0)
 S DIK="^DD(2006.1,",DA=9,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",97,0)
 S DIK="^DD(2006.1,",DA=10,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",98,0)
 S DIK="^DD(2006.1,",DA=11,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",99,0)
 S DIK="^DD(2006.1,",DA=11.2,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",100,0)
 S DIK="^DD(2006.1,",DA=11.5,DA(1)=2006.1 D ^DIK ; CRITICAL LOW MESSAGE INTERVAL - RETIRED 
"RTN","MAGIP39",101,0)
 S DIK="^DD(2006.1,",DA=11.9,DA(1)=2006.1 D ^DIK ; DATE OF LAST CRITICAL MESSAGE - RETIRED
"RTN","MAGIP39",102,0)
 S DIK="^DD(2006.1,",DA=13,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",103,0)
 S DIK="^DD(2006.1,",DA=14,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",104,0)
 S DIK="^DD(2006.1,",DA=15,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",105,0)
 S DIK="^DD(2006.1,",DA=16,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",106,0)
 S DIK="^DD(2006.1,",DA=17,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",107,0)
 S DIK="^DD(2006.1,",DA=18,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",108,0)
 S DIK="^DD(2006.1,",DA=19,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",109,0)
 S DIK="^DD(2006.1,",DA=21,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",110,0)
 S DIK="^DD(2006.1,",DA=22,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",111,0)
 S DIK="^DD(2006.1,",DA=23,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",112,0)
 S DIK="^DD(2006.1,",DA=24,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",113,0)
 S DIK="^DD(2006.1,",DA=54,DA(1)=2006.1 D ^DIK ; JUKEBOX DEFAULT - RETIRED CHANGED TO 2.01 see above
"RTN","MAGIP39",114,0)
 S DIK="^DD(2006.1,",DA=60.1,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",115,0)
 S DIK="^DD(2006.1,",DA=60.2,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",116,0)
 S DIK="^DD(2006.1,",DA=60.3,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",117,0)
 S DIK="^DD(2006.1,",DA=60.4,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",118,0)
 S DIK="^DD(2006.1,",DA=60.5,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",119,0)
 S DIK="^DD(2006.1,",DA=60.6,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",120,0)
 S DIK="^DD(2006.1,",DA=61,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",121,0)
 S DIK="^DD(2006.1,",DA=61.1,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",122,0)
 S DIK="^DD(2006.1,",DA=61.2,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",123,0)
 S DIK="^DD(2006.1,",DA=61.3,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",124,0)
 S DIK="^DD(2006.1,",DA=61.4,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",125,0)
 S DIK="^DD(2006.1,",DA=62,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",126,0)
 S DIK="^DD(2006.1,",DA=62.1,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",127,0)
 S DIK="^DD(2006.1,",DA=62.2,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",128,0)
 S DIK="^DD(2006.1,",DA=66.3,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",129,0)
 S DIK="^DD(2006.1,",DA=62.4,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",130,0)
 S DIK="^DD(2006.1,",DA=62.5,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",131,0)
 S DIK="^DD(2006.1,",DA=62.6,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",132,0)
 S DIK="^DD(2006.1,",DA=63,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",133,0)
 S DIK="^DD(2006.1,",DA=63.1,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",134,0)
 S DIK="^DD(2006.1,",DA=63.2,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",135,0)
 S DIK="^DD(2006.1,",DA=63.3,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",136,0)
 S DIK="^DD(2006.1,",DA=63.4,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",137,0)
 S DIK="^DD(2006.1,",DA=63.5,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",138,0)
 S DIK="^DD(2006.1,",DA=64,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",139,0)
 S DIK="^DD(2006.1,",DA=64.5,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",140,0)
 S DIK="^DD(2006.1,",DA=65.5,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",141,0)
 S DIK="^DD(2006.1,",DA=65,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",142,0)
 S DIK="^DD(2006.1,",DA=66,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",143,0)
 S DIK="^DD(2006.1,",DA=67,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",144,0)
 S DIK="^DD(2006.1,",DA=67.1,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",145,0)
 S DIK="^DD(2006.1,",DA=67.2,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",146,0)
 S DIK="^DD(2006.1,",DA=67.3,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",147,0)
 S DIK="^DD(2006.1,",DA=67.4,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",148,0)
 S DIK="^DD(2006.1,",DA=103,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",149,0)
 S DIK="^DD(2006.1,",DA=124,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",150,0)
 S DIK="^DD(2006.1,",DA=125,DA(1)=2006.1 D ^DIK
"RTN","MAGIP39",151,0)
 S DIK="^DD(2006.11,",DA=.01,DA(1)=2006.11 D ^DIK
"RTN","MAGIP39",152,0)
 S DIK="^DD(2006.112,",DA=.01,DA(1)=2006.112 D ^DIK
"RTN","MAGIP39",153,0)
 S DIK="^DD(2006.8,",DA=.01,DA(1)=2006.8 D ^DIK
"RTN","MAGIP39",154,0)
 S DIK="^DD(2006.8,",DA=.04,DA(1)=2006.8 D ^DIK
"RTN","MAGIP39",155,0)
 S DIK="^DD(2006.8,",DA=3,DA(1)=2006.8 D ^DIK
"RTN","MAGIP39",156,0)
 S DIK="^DD(2006.8,",DA=4,DA(1)=2006.8 D ^DIK
"RTN","MAGIP39",157,0)
 S DIK="^DD(2006.8,",DA=11,DA(1)=2006.8 D ^DIK
"RTN","MAGIP39",158,0)
 S DIK="^DD(2006.8,",DA=12,DA(1)=2006.8 D ^DIK
"RTN","MAGIP39",159,0)
 S DIK="^DD(2006.8,",DA=13,DA(1)=2006.8 D ^DIK
"RTN","MAGIP39",160,0)
 S DIK="^DD(2006.8,",DA=14,DA(1)=2006.8 D ^DIK
"RTN","MAGIP39",161,0)
 S DIK="^DD(2006.8,",DA=15,DA(1)=2006.8 D ^DIK
"RTN","MAGIP39",162,0)
 S DIK="^DD(2006.8,",DA=16,DA(1)=2006.8 D ^DIK
"RTN","MAGIP39",163,0)
 S DIK="^DD(2006.8,",DA=17,DA(1)=2006.8 D ^DIK
"RTN","MAGIP39",164,0)
 S DIK="^DD(2006.8,",DA=20,DA(1)=2006.8 D ^DIK
"RTN","MAGIP39",165,0)
 S DIK="^DD(2006.8,",DA=49,DA(1)=2006.8 D ^DIK
"RTN","MAGIP39",166,0)
 S DIK="^DD(2006.8,",DA=50,DA(1)=2006.8 D ^DIK
"RTN","MAGIP39",167,0)
 S DIK="^DD(2006.8,",DA=51,DA(1)=2006.8 D ^DIK
"RTN","MAGIP39",168,0)
 S DIK="^DD(2006.8,",DA=52,DA(1)=2006.8 D ^DIK
"RTN","MAGIP39",169,0)
 S DIK="^DD(2006.8,",DA=53,DA(1)=2006.8 D ^DIK
"RTN","MAGIP39",170,0)
 S DIK="^DD(2006.8,",DA=54,DA(1)=2006.8 D ^DIK
"RTN","MAGIP39",171,0)
 S DIK="^DD(2006.8,",DA=55,DA(1)=2006.8 D ^DIK
"RTN","MAGIP39",172,0)
 S DIK="^DD(2006.95,",DA=10,DA(1)=2006.95 D ^DIK
"RTN","MAGIP39",173,0)
 S DIK="^DD(2006.95,",DA=1,DA(1)=2006.95 D ^DIK
"RTN","MAGIP39",174,0)
 ; Remove the Jukebox file data dictionary and data
"RTN","MAGIP39",175,0)
 S DIU="^MAGQUEUE(2006.032,",DIU(0)="D" D EN^DIU2
"RTN","MAGIP39",176,0)
 ;remove file definitions so that the new file definitions will lay down cleanly
"RTN","MAGIP39",177,0)
 N DIU
"RTN","MAGIP39",178,0)
 F DIU=2006.1665,2006.1664,2006.1662,2006.166 D
"RTN","MAGIP39",179,0)
 . S DIU(0)="S" D EN^DIU2
"RTN","MAGIP39",180,0)
 . Q
"RTN","MAGIP39",181,0)
 ; Retire option no longer active
"RTN","MAGIP39",182,0)
 D RMOPT("MAGQ COQ")
"RTN","MAGIP39",183,0)
 ; Remove options so new ones install cleanly
"RTN","MAGIP39",184,0)
 D RMOPT("MAGQ BPMONITOR")
"RTN","MAGIP39",185,0)
 ; Remove RPC so that it installs cleanly
"RTN","MAGIP39",186,0)
 D RMRPC("MAGQB QUEDEL")
"RTN","MAGIP39",187,0)
 D RMRPC("MAGQ JBQUE")
"RTN","MAGIP39",188,0)
 D RMRPC("MAG FIELD VALIDATE")
"RTN","MAGIP39",189,0)
 D RMRPC("MAG KEY VALIDATE")
"RTN","MAGIP39",190,0)
 D RMRPC("MAGQ FTYPE")
"RTN","MAGIP39",191,0)
 D RMRPC("MAGQ DFNIQ")
"RTN","MAGIP39",192,0)
 D RMRPC("MAGQ ADD RAID GROUP")
"RTN","MAGIP39",193,0)
 D RMRPC("MAGQ JBSCN")
"RTN","MAGIP39",194,0)
 D RMRPC("MAGQBP FREF")
"RTN","MAGIP39",195,0)
 D RMRPC("MAGQ FS CHNGE")
"RTN","MAGIP39",196,0)
 D RMRPC("MAGQ QRNGE")
"RTN","MAGIP39",197,0)
 D RMRPC("MAGQ FINDC")
"RTN","MAGIP39",198,0)
 D RMRPC("MAGQ QCNT")
"RTN","MAGIP39",199,0)
 D RMRPC("MAGQ ALL SERVER")
"RTN","MAGIP39",200,0)
 D RMRPC("MAGQ JBPTR")
"RTN","MAGIP39",201,0)
 D RMRPC("MAGQB PURNUL")
"RTN","MAGIP39",202,0)
 D RMRPC("MAGQBP ALL SHARES")
"RTN","MAGIP39",203,0)
 D RMRPC("MAGQBP CHKN")
"RTN","MAGIP39",204,0)
 D RMRPC("MAGQ JBP")
"RTN","MAGIP39",205,0)
 D RMRPC("MAGQ IRP GETNEXT")
"RTN","MAGIP39",206,0)
 D RMRPC("MAGQ REA")
"RTN","MAGIP39",207,0)
 D RMRPC("MAGQ REA UPDATE")
"RTN","MAGIP39",208,0)
 D RMRPC("MAGQ SLAD")
"RTN","MAGIP39",209,0)
 D RMRPC("MAGQ DEL NLOC")
"RTN","MAGIP39",210,0)
 D RMRPC("MAGQ BP UAT")
"RTN","MAGIP39",211,0)
 Q
"RTN","MAGIP39",212,0)
CFILEN(NUM,NAME) ;
"RTN","MAGIP39",213,0)
 N DIE,DR,DA
"RTN","MAGIP39",214,0)
 S DIE="^DIC(",DR=".01///"_NAME,DA=NUM
"RTN","MAGIP39",215,0)
 D ^DIE
"RTN","MAGIP39",216,0)
 K DIE,DR,DA
"RTN","MAGIP39",217,0)
 Q
"RTN","MAGIP39",218,0)
RMRPC(NAME) ; Removing an RPC in order to revise
"RTN","MAGIP39",219,0)
 N MW,RPC,MWE,DIERR,DA,DIK
"RTN","MAGIP39",220,0)
 S MW=$$FIND1^DIC(19,"","X","MAG WINDOWS","","","")
"RTN","MAGIP39",221,0)
 D CLEAN^DILF
"RTN","MAGIP39",222,0)
 S RPC=$$FIND1^DIC(8994,"","X",NAME,"","","")
"RTN","MAGIP39",223,0)
 D CLEAN^DILF
"RTN","MAGIP39",224,0)
 Q:'RPC
"RTN","MAGIP39",225,0)
 I MW D
"RTN","MAGIP39",226,0)
 . S MWE=$$FIND1^DIC(19.05,","_MW_",","X",NAME,"","","")
"RTN","MAGIP39",227,0)
 . D CLEAN^DILF
"RTN","MAGIP39",228,0)
 . Q:'MWE
"RTN","MAGIP39",229,0)
 . S DA=MWE,DA(1)=MW,DIK="^DIC(19,"_DA(1)_",""RPC"","
"RTN","MAGIP39",230,0)
 . D ^DIK
"RTN","MAGIP39",231,0)
 . K DA,DIK
"RTN","MAGIP39",232,0)
 . Q
"RTN","MAGIP39",233,0)
 S DA=RPC,DIK="^XWB(8994,"
"RTN","MAGIP39",234,0)
 D ^DIK
"RTN","MAGIP39",235,0)
 K DA,DIK
"RTN","MAGIP39",236,0)
 Q
"RTN","MAGIP39",237,0)
RMOPT(NAME) ; Removing an OPTION from the OPTION File (#19)
"RTN","MAGIP39",238,0)
 N OPT
"RTN","MAGIP39",239,0)
 S OPT=$$FIND1^DIC(19,"","X",NAME,"","","")
"RTN","MAGIP39",240,0)
 D CLEAN^DILF
"RTN","MAGIP39",241,0)
 Q:'OPT
"RTN","MAGIP39",242,0)
 I NAME="MAGQ BPMONITOR" D MAGSYS(NAME)
"RTN","MAGIP39",243,0)
 S DA=OPT,DIK="^DIC(19,"
"RTN","MAGIP39",244,0)
 D ^DIK
"RTN","MAGIP39",245,0)
 K DA,DIK
"RTN","MAGIP39",246,0)
 Q
"RTN","MAGIP39",247,0)
MAGSYS(NAME) ;
"RTN","MAGIP39",248,0)
 N MENU,ITEM,DA,DIK
"RTN","MAGIP39",249,0)
 Q:NAME=""
"RTN","MAGIP39",250,0)
 S MENU=+$$FIND1^DIC(19,"","X","MAG SYS MENU") Q:'+MENU
"RTN","MAGIP39",251,0)
 S ITEM=$$FIND1^DIC(19.01,","_MENU_",","B",NAME) Q:'+ITEM
"RTN","MAGIP39",252,0)
 S DA=ITEM,DA(1)=MENU,DIK="^DIC(19,"_DA(1)_",10," D ^DIK K DA,DIK
"RTN","MAGIP39",253,0)
 Q
"RTN","MAGIP39B")
0^^B176147737
"RTN","MAGIP39B",1,0)
MAGIP39B ;Post init routine to queue site activity at install. ; 14 Oct 2010 4:41 PM
"RTN","MAGIP39B",2,0)
 ;;3.0;IMAGING;**39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGIP39B",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGIP39B",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGIP39B",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGIP39B",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGIP39B",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGIP39B",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGIP39B",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGIP39B",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGIP39B",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGIP39B",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGIP39B",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGIP39B",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGIP39B",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGIP39B",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGIP39B",17,0)
 ;;
"RTN","MAGIP39B",18,0)
 Q
"RTN","MAGIP39B",19,0)
POST ;
"RTN","MAGIP39B",20,0)
 N I,NLIST,PLACE,FLDAR,PL
"RTN","MAGIP39B",21,0)
 K ^MAG(2006.8,"B") ; Remove "B" cross-reference
"RTN","MAGIP39B",22,0)
 S PLACE=$O(^MAG(2006.1,"B",$$KSP^XUPARAM("INST"),""))
"RTN","MAGIP39B",23,0)
 D BMES^XPDUTL("Updating MAG WINDOWS: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","MAGIP39B",24,0)
 D ADDRPC^MAGQBUT4("MAGQB QUEDEL","MAG WINDOWS")
"RTN","MAGIP39B",25,0)
 D ADDRPC^MAGQBUT4("MAGQ JBQUE","MAG WINDOWS")
"RTN","MAGIP39B",26,0)
 D ADDRPC^MAGQBUT4("MAG FIELD VALIDATE","MAG WINDOWS")
"RTN","MAGIP39B",27,0)
 D ADDRPC^MAGQBUT4("MAG KEY VALIDATE","MAG WINDOWS")
"RTN","MAGIP39B",28,0)
 D ADDRPC^MAGQBUT4("MAGQ FTYPE","MAG WINDOWS")
"RTN","MAGIP39B",29,0)
 D ADDRPC^MAGQBUT4("MAGQ DFNIQ","MAG WINDOWS")
"RTN","MAGIP39B",30,0)
 D ADDRPC^MAGQBUT4("MAGQ JBSCN","MAG WINDOWS")
"RTN","MAGIP39B",31,0)
 D ADDRPC^MAGQBUT4("MAGQ FS CHNGE","MAG WINDOWS")
"RTN","MAGIP39B",32,0)
 D ADDRPC^MAGQBUT4("MAGQ QRNGE","MAG WINDOWS")
"RTN","MAGIP39B",33,0)
 D ADDRPC^MAGQBUT4("MAGQ FINDC","MAG WINDOWS")
"RTN","MAGIP39B",34,0)
 D ADDRPC^MAGQBUT4("MAGQ QCNT","MAG WINDOWS")
"RTN","MAGIP39B",35,0)
 D ADDRPC^MAGQBUT4("MAGQ ALL SERVER","MAG WINDOWS")
"RTN","MAGIP39B",36,0)
 D ADDRPC^MAGQBUT4("MAGQ ADD RAID GROUP","MAG WINDOWS")
"RTN","MAGIP39B",37,0)
 D ADDRPC^MAGQBUT4("MAGQ DEL NLOC","MAG WINDOWS")
"RTN","MAGIP39B",38,0)
 D ADDRPC^MAGQBUT4("MAGQBP ALL SHARES","MAG WINDOWS")
"RTN","MAGIP39B",39,0)
 D ADDRPC^MAGQBUT4("MAGQBP FREF","MAG WINDOWS")
"RTN","MAGIP39B",40,0)
 D ADDRPC^MAGQBUT4("MAGQ BP UAT","MAG WINDOWS")
"RTN","MAGIP39B",41,0)
 D BMES^XPDUTL("Add Generic Mail Message groups to the Mail Group file: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","MAGIP39B",42,0)
 D ADDMG ; Add Generic Mail Message groups to the Mail Group file (XMB(3.8)
"RTN","MAGIP39B",43,0)
 D BMES^XPDUTL("Add Message Subjects for Mail Management to Site Parameters - with interval: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","MAGIP39B",44,0)
 D ADDMS(6) ; Add Message Subjects for Mail Management to Site Parameters - with interval
"RTN","MAGIP39B",45,0)
 D BMES^XPDUTL("Add Generic Mail groups to BP Message subfile: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","MAGIP39B",46,0)
 D DLKP ; Add Generic Mail groups to BP Message subfile
"RTN","MAGIP39B",47,0)
 D BMES^XPDUTL("Add Raid Groups to the Network Location file: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","MAGIP39B",48,0)
 D ADDRG(4) ; Add Raid Groups to the Network Location file
"RTN","MAGIP39B",49,0)
 D FAR^MAGQBUT6(.FLDAR) ; Setup File/Node/Piece Table for FieldNumbers
"RTN","MAGIP39B",50,0)
 D GETRL^MAGQBU6A(.NLIST) ; Get a list of duplicate shares
"RTN","MAGIP39B",51,0)
 D BMES^XPDUTL("Initialize raid groups to group default: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","MAGIP39B",52,0)
 D IRG ; Initialize raid groups to group default
"RTN","MAGIP39B",53,0)
 D PRIME^MAGQBUT6(.NLIST) D BMES^XPDUTL("Setting Prime entries on line.")  ;Set prime entries online
"RTN","MAGIP39B",54,0)
 D SPRR^MAGQBUT6(.NLIST) D BMES^XPDUTL("Updating Imaging Site Parameter file with prime entries.")  ;Update the Site Parameter file
"RTN","MAGIP39B",55,0)
 D BMES^XPDUTL("Add Photo-ID Post Action to the Image Action file: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","MAGIP39B",56,0)
 D PID ;  Add Photo-ID Post Action to the Image Action file
"RTN","MAGIP39B",57,0)
 D BMES^XPDUTL("Set POP/AUTO Purge 'ON' as the default & Purge Factor as '2' & Purge by 'Last Access Date': "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","MAGIP39B",58,0)
 D DPOP ; Set Express/AUTO Purge 'ON' as the default & Purge Factor as '2' & Purge by 'Last Access Date'
"RTN","MAGIP39B",59,0)
 D BMES^XPDUTL("Setup Auto-Verify: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","MAGIP39B",60,0)
 D AVSET ; Setup Auto-Verify
"RTN","MAGIP39B",61,0)
 D BMES^XPDUTL("Re-index Site Parameters, BP Servers, Network Location file: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","MAGIP39B",62,0)
 D INDEX
"RTN","MAGIP39B",63,0)
 D RMBPMSG
"RTN","MAGIP39B",64,0)
 D BMES^XPDUTL("Setup dummy UAT (Unassigned Tasks) BP Servers: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","MAGIP39B",65,0)
 D PURVER ; Add Auto Purge and Scheduled Verify to the BP server that has JUKEBOX assigned.
"RTN","MAGIP39B",66,0)
 D SUAT ; Setup dummy UAT (Unassigned Tasks) BP Servers
"RTN","MAGIP39B",67,0)
 D RTRS^MAGQBUT6 ;send an email on routers.
"RTN","MAGIP39B",68,0)
 D TASKIT("ACXREF^MAGQE7(0,0)","Setting AC X-reference in file 2006.95","Setting AC X-reference in file #2006.95.")
"RTN","MAGIP39B",69,0)
 D TASKIT("CONSHR^MAGQBUT6","Consolidate redundant shares utility","Consolidate redundant shares.")
"RTN","MAGIP39B",70,0)
 D TASKIT("CAS^MAGQBUT5","Purging queues in file 2006.041","Purging completed import queues in file #2006.041.")
"RTN","MAGIP39B",71,0)
 D RD ; Remove data from retired fields 2006.1:2.02,2.03,13,14,15,16,17,18,19,21,24 set photo id default
"RTN","MAGIP39B",72,0)
 S PL=0 F  S PL=$O(^MAG(2006.1,PL)) Q:'PL  S:$P($G(^MAG(2006.1,PL,1)),U,5)="" $P(^MAG(2006.1,PL,1),U,5)="30"   ;Restore a value - CR 685
"RTN","MAGIP39B",73,0)
 D BMES^XPDUTL("Post Install Mail Message: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","MAGIP39B",74,0)
 D INS^MAGQBUT4(XPDNM,DUZ,$$NOW^XLFDT,XPDA)
"RTN","MAGIP39B",75,0)
 Q
"RTN","MAGIP39B",76,0)
SUAT ; Setup dummy UAT (Unassigned Tasks) BP Servers
"RTN","MAGIP39B",77,0)
 N PL
"RTN","MAGIP39B",78,0)
 S PL=0
"RTN","MAGIP39B",79,0)
 F  S PL=$O(^MAG(2006.1,PL)) Q:'PL  D
"RTN","MAGIP39B",80,0)
 . Q:$D(^MAG(2006.8,"C",PL,"Unassigned Tasks"))  ; Do not re-configure
"RTN","MAGIP39B",81,0)
 . D UAT^MAGQBUT5("",PL)
"RTN","MAGIP39B",82,0)
 Q
"RTN","MAGIP39B",83,0)
ADDRG(CNT) ; Add Raid Groups to the Network Location file
"RTN","MAGIP39B",84,0)
 N PL,I,J,VALUE,NMSP,DUP,TMP,MAGFDA,RESULT
"RTN","MAGIP39B",85,0)
 S PL=0
"RTN","MAGIP39B",86,0)
 K ^MAG(2005.2,"AC"),^MAG(2005.2,"B"),^MAG(2005.2,"C"),^MAG(2005.2,"D"),^MAG(2005.2,"G")
"RTN","MAGIP39B",87,0)
 S DIK="^MAG(2005.2,"
"RTN","MAGIP39B",88,0)
 D IXALL^DIK K DIK
"RTN","MAGIP39B",89,0)
 F  S PL=$O(^MAG(2006.1,PL)) Q:'PL  D
"RTN","MAGIP39B",90,0)
 . Q:$D(^MAG(2005.2,"F",PL,"GRP"))  ; Do not reconfigure
"RTN","MAGIP39B",91,0)
 . S NMSP=$P($G(^MAG(2006.1,PL,0)),U,2)
"RTN","MAGIP39B",92,0)
 . I NMSP="" D  Q
"RTN","MAGIP39B",93,0)
 . . S TMP=$$GET1^DIQ("4",$P($G(^MAG(2006.1,PL,0)),U,1),".01","","","")
"RTN","MAGIP39B",94,0)
 . . D BMES^XPDUTL("No namespace is defined for: "_TMP_" in the Site Parameter file (#2006.1)")
"RTN","MAGIP39B",95,0)
 . . Q
"RTN","MAGIP39B",96,0)
 . D ADDRG^MAGQBUT5(.RESULT,CNT,PL)
"RTN","MAGIP39B",97,0)
 . Q
"RTN","MAGIP39B",98,0)
 Q
"RTN","MAGIP39B",99,0)
AVSET ; Setup Auto-Verify - To run at midnight, nightly (no more than 48 hours, limited to the run)
"RTN","MAGIP39B",100,0)
 N PL,DIERR,MAGERR,MAGFDA
"RTN","MAGIP39B",101,0)
 S PL=0
"RTN","MAGIP39B",102,0)
 F  S PL=$O(^MAG(2006.1,PL)) Q:'PL  D
"RTN","MAGIP39B",103,0)
 . Q:$P($G(^MAG(2006.1,PL,"BPVERIFIER")),U,1)'=""  ; Do not re-configure
"RTN","MAGIP39B",104,0)
 . S MAGFDA(2006.1,PL_",",62)="1" ; SCHEDULED VERIFY
"RTN","MAGIP39B",105,0)
 . S MAGFDA(2006.1,PL_",",62.2)="1" ; SCHEDULED VERIFIER FREQUENCY
"RTN","MAGIP39B",106,0)
 . S MAGFDA(2006.1,PL_",",62.4)="2355" ; SCHEDULED VERIFIER TIME
"RTN","MAGIP39B",107,0)
 . S MAGFDA(2006.1,PL_",",62.3)=$$DT^XLFDT ; DATE OF NEXT VERIFY  
"RTN","MAGIP39B",108,0)
 . D UPDATE^DIE("","MAGFDA","MAGIEN","MAGERR")
"RTN","MAGIP39B",109,0)
 . I $D(DIERR) D
"RTN","MAGIP39B",110,0)
 . . N TMP S TMP=$P(^DIC(4,$O(^DIC(4,"D",$P($G(^MAG(2006.1,PL,0)),U,1),"")),0),U,1)
"RTN","MAGIP39B",111,0)
 . . D BMES^XPDUTL("Error adding default Auto-Verify options to "_TMP_" Error text: "_MAGERR("DIERR",1,"TEXT",1))
"RTN","MAGIP39B",112,0)
 . . Q
"RTN","MAGIP39B",113,0)
 . K MAG,DIERR,MAGFDA,MAGERR
"RTN","MAGIP39B",114,0)
 . Q
"RTN","MAGIP39B",115,0)
 Q
"RTN","MAGIP39B",116,0)
IRG ; Initialize raid groups to group default
"RTN","MAGIP39B",117,0)
 N DA,EN,PC,PL,INDX,ZNODE,GD,MAGIEN,MAGERR,SUBIX
"RTN","MAGIP39B",118,0)
 ;The following sets all duplicate share as READ ONLY in preparation of adding enties to the Group.
"RTN","MAGIP39B",119,0)
 S EN="" S EN=$O(NLIST(EN)) D:EN'=""
"RTN","MAGIP39B",120,0)
 . S EN="" F  S EN=$O(NLIST(EN)) Q:EN=""  D
"RTN","MAGIP39B",121,0)
 . . F PC=2:1:$L(NLIST(EN),U) S DA=$P(NLIST(EN),U,PC) Q:'DA  D:$D(^MAG(2005.2,DA,0))
"RTN","MAGIP39B",122,0)
 . . . I $P(^MAG(2005.2,DA,0),U,7)="MAG",'+$P(^(0),U,9)!($P(^MAG(2005.2,DA,0),U,7)["WORM") D   ;Mag type and not router
"RTN","MAGIP39B",123,0)
 . . . . S MAGFDA(2005.2,DA_",",5.5)=1     ;Set as READ ONLY
"RTN","MAGIP39B",124,0)
 . . . . D FILE^DIE("","MAGFDA","MAGMSG")
"RTN","MAGIP39B",125,0)
 . . . . I $D(MSG("DIERR")) D BMES^XPDUTL("Duplicate entry: '"_DA_" failed to be set offline. ")
"RTN","MAGIP39B",126,0)
 . . . . K MAGFDA,MAGMSG
"RTN","MAGIP39B",127,0)
 . . . . Q
"RTN","MAGIP39B",128,0)
 . . . Q
"RTN","MAGIP39B",129,0)
 . . Q
"RTN","MAGIP39B",130,0)
 . Q
"RTN","MAGIP39B",131,0)
 S PL=0
"RTN","MAGIP39B",132,0)
 F  S PL=$O(^MAG(2006.1,PL)) Q:'PL  D
"RTN","MAGIP39B",133,0)
 . Q:$P($G(^MAG(2006.1,PL,0)),U,10)'=""  ; Do not Re-configure
"RTN","MAGIP39B",134,0)
 . S GD=$O(^MAG(2005.2,"F",PL,"GRP","")) ; first Raid Group
"RTN","MAGIP39B",135,0)
 . Q:'GD
"RTN","MAGIP39B",136,0)
 . S $P(^MAG(2006.1,PL,0),U,10)=GD ; by default set the sites Current Group to the 1st
"RTN","MAGIP39B",137,0)
 . S (INDX,SUBIX)=0
"RTN","MAGIP39B",138,0)
 . F  S INDX=$O(^MAG(2005.2,INDX)) Q:'INDX  D
"RTN","MAGIP39B",139,0)
 . . S ZNODE=$G(^MAG(2005.2,INDX,0))
"RTN","MAGIP39B",140,0)
 . . Q:$P(ZNODE,U,10)'=PL
"RTN","MAGIP39B",141,0)
 . . Q:$P(ZNODE,U,6,7)'["1^MAG"
"RTN","MAGIP39B",142,0)
 . . Q:$P(ZNODE,U,9)="1"  ;ROUTING SHARE
"RTN","MAGIP39B",143,0)
 . . Q:$P(ZNODE,U,8)'="Y"  ;not hashed
"RTN","MAGIP39B",144,0)
 . . Q:$P($G(^MAG(2005.2,INDX,1)),U,6)="1"  ;Read Only
"RTN","MAGIP39B",145,0)
 . . Q:+$P($G(^MAG(2005.2,INDX,1)),U,8)>0  ;Already assigned
"RTN","MAGIP39B",146,0)
 . . S $P(^MAG(2005.2,INDX,1),U,8)=GD
"RTN","MAGIP39B",147,0)
 . . S SUBIX=SUBIX+1
"RTN","MAGIP39B",148,0)
 . . S MAGFDA(2005.22,"+"_SUBIX_","_GD_",",.01)=INDX
"RTN","MAGIP39B",149,0)
 . . D UPDATE^DIE("","MAGFDA","MAGIEN","MAGERR")
"RTN","MAGIP39B",150,0)
 . . I $D(DIERR) D BMES^XPDUTL("Error adding Raid Group subentry: "_MAGERR("DIERR",1,"TEXT",1))
"RTN","MAGIP39B",151,0)
 . . K MAGFDA,DIERR,MSGIEN,MAGERR
"RTN","MAGIP39B",152,0)
 . . Q
"RTN","MAGIP39B",153,0)
 . Q
"RTN","MAGIP39B",154,0)
 Q
"RTN","MAGIP39B",155,0)
ADDMS(INTERVAL) ; Add Message Subjects for Mail Management
"RTN","MAGIP39B",156,0)
 N I,J,K,MAGFDA,MSG,IEN,MAGERR
"RTN","MAGIP39B",157,0)
 S IEN=0
"RTN","MAGIP39B",158,0)
 F  S IEN=$O(^MAG(2006.1,IEN)) Q:'IEN  D
"RTN","MAGIP39B",159,0)
 . F J=1:1:19 S K=$P($T(TEXT+J),";",3) D
"RTN","MAGIP39B",160,0)
 . . Q:$D(^MAG(2006.1,IEN,6,"B",K))  ; Do not re-configure
"RTN","MAGIP39B",161,0)
 . . S MAGFDA(2006.166,"?+1,"_IEN_",",.01)=K
"RTN","MAGIP39B",162,0)
 . . S MAGFDA(2006.166,"?+1,"_IEN_",",1)=INTERVAL
"RTN","MAGIP39B",163,0)
 . . D UPDATE^DIE("","MAGFDA","","MAGERR")
"RTN","MAGIP39B",164,0)
 . . I $D(DIERR) D BMES^XPDUTL("Error updating the BP Mail Message Subfile: "_MAGERR("DIERR",1,"TEXT",1)) K DIERR,MAGERR
"RTN","MAGIP39B",165,0)
 . . Q
"RTN","MAGIP39B",166,0)
 . Q
"RTN","MAGIP39B",167,0)
 Q
"RTN","MAGIP39B",168,0)
ADDMG ; Add Mail Message groups to the Mail Group file (XMB(3.8))
"RTN","MAGIP39B",169,0)
 N PL,NMSP
"RTN","MAGIP39B",170,0)
 S PL=0
"RTN","MAGIP39B",171,0)
 F  S PL=$O(^MAG(2006.1,PL)) Q:'PL  D
"RTN","MAGIP39B",172,0)
 . S NMSP=$P($G(^MAG(2006.1,PL,0)),U,2)
"RTN","MAGIP39B",173,0)
 . Q:NMSP=""
"RTN","MAGIP39B",174,0)
 . D ADD(NMSP)
"RTN","MAGIP39B",175,0)
 . Q
"RTN","MAGIP39B",176,0)
 Q 
"RTN","MAGIP39B",177,0)
ADD(NMSP) ;
"RTN","MAGIP39B",178,0)
 N J,K,L,MAGFDA,MSG,IEN,MAGIEN,MAGERR
"RTN","MAGIP39B",179,0)
 F J=1:1:19 S K=$P($T(TEXT+J),";",3) D
"RTN","MAGIP39B",180,0)
 . I '$D(^XMB(3.8,"B","MAG_"_NMSP_"_"_$E($$TRIM^MAGQBUT4(K),1,20))) D
"RTN","MAGIP39B",181,0)
 . . S L=$O(^XMB(3.8,"B","MAG_"_NMSP_"_"_$E($$TRIM^MAGQBUT4(K),1,20),""))
"RTN","MAGIP39B",182,0)
 . . S MAGFDA(3.8,"?+"_J_",",.01)="MAG_"_NMSP_"_"_$E($$TRIM^MAGQBUT4(K),1,20)
"RTN","MAGIP39B",183,0)
 . . D UPDATE^DIE("","MAGFDA","MAGIEN","MAGERR")
"RTN","MAGIP39B",184,0)
 . . I $D(DIERR) D BMES^XPDUTL("Error Adding Imaging Mail Groups: "_MAGERR("DIERR",1,"TEXT",1)) K DIERR,MAGERR,MAGFDA Q
"RTN","MAGIP39B",185,0)
 . . K MAGFDA,DIERR,MAGERR
"RTN","MAGIP39B",186,0)
 . . S MAGFDA(3.8,MAGIEN(J)_",",4)="PU"
"RTN","MAGIP39B",187,0)
 . . D FILE^DIE("I","MAGFDA","MAGERR")
"RTN","MAGIP39B",188,0)
 . . K MAGFDA,DIERR,MAGERR
"RTN","MAGIP39B",189,0)
 . . S MAGFDA(3.81,"?+1,"_MAGIEN(J)_",",.01)=DUZ
"RTN","MAGIP39B",190,0)
 . . D UPDATE^DIE("","MAGFDA","MAGIEN","MAGERR")
"RTN","MAGIP39B",191,0)
 . . I $D(DIERR) D BMES^XPDUTL("Error Adding Imaging Mail Group member: "_MAGERR("DIERR",1,"TEXT",1))
"RTN","MAGIP39B",192,0)
 . . K DIERR,MAGERR,MAGFDA,MAGIEN
"RTN","MAGIP39B",193,0)
 . E  D
"RTN","MAGIP39B",194,0)
 . . S L=$O(^XMB(3.8,"B","MAG_"_NMSP_"_"_$E($$TRIM^MAGQBUT4(K),1,20),""))
"RTN","MAGIP39B",195,0)
 . . S MAGFDA(3.81,"?+1,"_L_",",.01)=DUZ
"RTN","MAGIP39B",196,0)
 . . D UPDATE^DIE("","MAGFDA","MAGIEN","MAGERR")
"RTN","MAGIP39B",197,0)
 . . I $D(DIERR) D BMES^XPDUTL("Error Adding Imaging Mail Group member: "_MAGERR("DIERR",1,"TEXT",1))
"RTN","MAGIP39B",198,0)
 . . K DIERR,MAGERR,MAGFDA,MAGIEN
"RTN","MAGIP39B",199,0)
 . Q
"RTN","MAGIP39B",200,0)
 Q
"RTN","MAGIP39B",201,0)
DLKP ; Add Generic Mail groups to BP Message subfile
"RTN","MAGIP39B",202,0)
 N PL,I,J,MAGFDA,MSGROOT,MG,DIERR,MAGIEN,MAGERR,NMSP
"RTN","MAGIP39B",203,0)
 S PL=0
"RTN","MAGIP39B",204,0)
 F  S PL=$O(^MAG(2006.1,PL)) Q:'PL  D
"RTN","MAGIP39B",205,0)
 . S I=0,NMSP=$P($G(^MAG(2006.1,PL,0)),U,2)
"RTN","MAGIP39B",206,0)
 . Q:NMSP=""
"RTN","MAGIP39B",207,0)
 . F  S I=$O(^MAG(2006.1,PL,6,I)) Q:'I  D
"RTN","MAGIP39B",208,0)
 . . S MG=$P($G(^MAG(2006.1,PL,6,I,0)),"^",1)
"RTN","MAGIP39B",209,0)
 . . S J=$$FIND1^DIC(3.8,"","","MAG_"_NMSP_"_"_$E($$TRIM^MAGQBUT4(MG),1,20),"","","MSGROOT")
"RTN","MAGIP39B",210,0)
 . . Q:$D(^MAG(2006.1,PL,6,I,1,"B",J))  ; Do not re-configure
"RTN","MAGIP39B",211,0)
 . . I J  D
"RTN","MAGIP39B",212,0)
 . . . S MAGFDA(2006.1662,"+1,"_I_","_PL_",",.01)=J
"RTN","MAGIP39B",213,0)
 . . . D UPDATE^DIE("","MAGFDA","MAGIEN","MAGERR")
"RTN","MAGIP39B",214,0)
 . . . I $D(DIERR) D BMES^XPDUTL("Error Adding Generic Mail Groups: "_MAGERR("DIERR",1,"TEXT",1)) K DIERR,MAGERR
"RTN","MAGIP39B",215,0)
 . . . Q
"RTN","MAGIP39B",216,0)
 . . Q
"RTN","MAGIP39B",217,0)
 . Q
"RTN","MAGIP39B",218,0)
 K MAGFDA,MSGROOT,MAGIEN,MSGROOT
"RTN","MAGIP39B",219,0)
 Q
"RTN","MAGIP39B",220,0)
DPOP ; Set the POP Purge value to a default of 'ON' & Purge Factor as '2'
"RTN","MAGIP39B",221,0)
 N PL,MAGFDA,DIERR,MAGIEN,MAGERR
"RTN","MAGIP39B",222,0)
 S PL=0
"RTN","MAGIP39B",223,0)
 F  S PL=$O(^MAG(2006.1,PL)) Q:'PL  D
"RTN","MAGIP39B",224,0)
 . Q:$P($G(^MAG(2006.1,PL,"BPPURGE")),U,4)'=""  ; Do not re-configure
"RTN","MAGIP39B",225,0)
 . S MAGFDA(2006.1,PL_",",60.2)="1" ;Express Purge ON
"RTN","MAGIP39B",226,0)
 . S MAGFDA(2006.1,PL_",",60)="1" ;Auto Purge ON
"RTN","MAGIP39B",227,0)
 . S MAGFDA(2006.1,PL_",",60.1)="DA" ;Purge by: Date Accessed
"RTN","MAGIP39B",228,0)
 . S MAGFDA(2006.1,PL_",",60.3)="100000" ; Express Purge Rate 100,000
"RTN","MAGIP39B",229,0)
 . S MAGFDA(2006.1,PL_",",60.5)="1" ; Purge Factor
"RTN","MAGIP39B",230,0)
 . D UPDATE^DIE("","MAGFDA","","MAGERR")
"RTN","MAGIP39B",231,0)
 . I $D(DIERR) D BMES^XPDUTL("Error setting the POP/Auto Purge default as 'ON': "_MAGERR("DIERR",1,"TEXT",1))
"RTN","MAGIP39B",232,0)
 . K MAGFDA,MAGERR
"RTN","MAGIP39B",233,0)
 . Q
"RTN","MAGIP39B",234,0)
 Q
"RTN","MAGIP39B",235,0)
PID ;  Add Photo-ID Post Action to the Image Action file
"RTN","MAGIP39B",236,0)
 N MAGFDA,MAGERR,IEN,MSGROOT,ACTIVE,EXPLOC
"RTN","MAGIP39B",237,0)
 ;  If already configured, save and restore active and Export Location parameters 
"RTN","MAGIP39B",238,0)
 S IEN=$O(^MAG(2005.86,"B","PHOTO-ID COPY",""))
"RTN","MAGIP39B",239,0)
 I IEN'="" D
"RTN","MAGIP39B",240,0)
 . S ACTIVE=+$P($G(^MAG(2005.86,IEN,0)),U,2)
"RTN","MAGIP39B",241,0)
 . S EXPLOC=$P($G(^MAG(2005.86,IEN,0)),U,5)
"RTN","MAGIP39B",242,0)
 . S DIK="^MAG(2005.86,",DA=IEN D ^DIK
"RTN","MAGIP39B",243,0)
 . K DIK,DA
"RTN","MAGIP39B",244,0)
 . Q
"RTN","MAGIP39B",245,0)
 E  S ACTIVE="0",EXPLOC=""
"RTN","MAGIP39B",246,0)
 S MAGFDA(2005.86,"?+1,",.01)="PHOTO-ID COPY"
"RTN","MAGIP39B",247,0)
 S MAGFDA(2005.86,"?+1,",1)=ACTIVE
"RTN","MAGIP39B",248,0)
 S MAGFDA(2005.86,"?+1,",2)="PID"
"RTN","MAGIP39B",249,0)
 S MAGFDA(2005.86,"?+1,",3)="MAGQBGCC"
"RTN","MAGIP39B",250,0)
 S MAGFDA(2005.86,"?+1,",4)="This will copy photo ID's to an external share with the Patient's Name as the file name."
"RTN","MAGIP39B",251,0)
 S MAGFDA(2005.86,"?+1,",6)=EXPLOC
"RTN","MAGIP39B",252,0)
 D UPDATE^DIE("","MAGFDA","","MAGERR")
"RTN","MAGIP39B",253,0)
 I $D(DIERR) D BMES^XPDUTL("Error Adding PHOTO-ID Post Process Action: "_MAGERR("DIERR",1,"TEXT",1)) K DIERR,MAGERR
"RTN","MAGIP39B",254,0)
 S IEN=$$FIND1^DIC(2005.86,"","","PHOTO-ID COPY","","","MSGROOT")
"RTN","MAGIP39B",255,0)
 S MAGFDA(2005.865,"?+1,"_IEN_",",.01)="PHOTO ID"
"RTN","MAGIP39B",256,0)
 D UPDATE^DIE("E","MAGFDA","","MAGERR")
"RTN","MAGIP39B",257,0)
 I $D(DIERR) D BMES^XPDUTL("Error Adding PHOTO ID Action type: "_MAGERR("DIERR",1,"TEXT",1)) K DIERR,MAGERR
"RTN","MAGIP39B",258,0)
 K MAGFDA,MAGERR,MSGROOT
"RTN","MAGIP39B",259,0)
 Q
"RTN","MAGIP39B",260,0)
TASKIT(RTN,DESC,MSG) ;
"RTN","MAGIP39B",261,0)
 N MAGDATE,MAGTIME,MAGHR,ZTRTN,ZTDESC,ZTIO,ZTDTH,ZTSK
"RTN","MAGIP39B",262,0)
 Q:$G(RTN)=""!($G(DESC)="")
"RTN","MAGIP39B",263,0)
 S ZTRTN=$G(RTN),ZTDESC=$G(DESC),ZTIO=""
"RTN","MAGIP39B",264,0)
 S MAGDATE=$$NOW^XLFDT(),MAGTIME=$P(MAGDATE,".",2),MAGHR=$E(MAGTIME,1,2)
"RTN","MAGIP39B",265,0)
 I MAGHR>5,MAGHR<17 S MAGTIME=180000
"RTN","MAGIP39B",266,0)
 S MAGDATE=$P(MAGDATE,".")_"."_MAGTIME
"RTN","MAGIP39B",267,0)
 S ZTDTH=MAGDATE
"RTN","MAGIP39B",268,0)
 D ^%ZTLOAD
"RTN","MAGIP39B",269,0)
 D BMES^XPDUTL($G(MSG)_" TASK#: "_ZTSK)
"RTN","MAGIP39B",270,0)
 Q
"RTN","MAGIP39B",271,0)
INDEX ; Kill and Set All indexes for the BP Server file
"RTN","MAGIP39B",272,0)
 K ^MAG(2006.8,"C"),^MAG(2006.8,"D")
"RTN","MAGIP39B",273,0)
 S DIK="^MAG(2006.8," D IXALL^DIK
"RTN","MAGIP39B",274,0)
 K DIK
"RTN","MAGIP39B",275,0)
 K ^MAG(2006.1,"B")
"RTN","MAGIP39B",276,0)
 S DIK="^MAG(2006.1," D IXALL^DIK
"RTN","MAGIP39B",277,0)
 K DIK
"RTN","MAGIP39B",278,0)
 K ^MAG(2005.2,"AC"),^MAG(2005.2,"B"),^MAG(2005.2,"C"),^MAG(2005.2,"D"),^MAG(2005.2,"E"),^MAG(2005.2,"F"),^MAG(2005.2,"G")
"RTN","MAGIP39B",279,0)
 S DIK="^MAG(2005.2," D IXALL^DIK
"RTN","MAGIP39B",280,0)
 K DIK
"RTN","MAGIP39B",281,0)
 Q
"RTN","MAGIP39B",282,0)
RD ;Remove data for retired fields 11.5,11.9,13,14,15,16,17,18,19,21,24,60,61,62,63,64,65 set photo id default
"RTN","MAGIP39B",283,0)
 N PL,PIECE
"RTN","MAGIP39B",284,0)
 S PL=0
"RTN","MAGIP39B",285,0)
 F  S PL=$O(^MAG(2006.1,PL)) Q:'PL  D
"RTN","MAGIP39B",286,0)
 . K ^MAG(2006.1,PL,"JBX") ;2.01,2.02,2.03
"RTN","MAGIP39B",287,0)
 . S $P(^MAG(2006.1,PL,1),U,9)="" ;13
"RTN","MAGIP39B",288,0)
 . K ^MAG(2006.1,PL,"JBEX") ; 14,15,16,17,18,19
"RTN","MAGIP39B",289,0)
 . S $P(^MAG(2006.1,PL,3),U,1)="" ;21
"RTN","MAGIP39B",290,0)
 . S $P(^MAG(2006.1,PL,3),U,7)="" ;11.5 CRITICAL LOW MESSAGE INTERVAL - RETIRED
"RTN","MAGIP39B",291,0)
 . S $P(^MAG(2006.1,PL,3),U,11)="" ;11.9  ; DATE OF LAST CRITICAL MESSAGE - RETIRED
"RTN","MAGIP39B",292,0)
 . S $P(^MAG(2006.1,PL,3),U,4)="99999" ;24 Changed to Photo ID have 99999 set as the default
"RTN","MAGIP39B",293,0)
 . S $P(^MAG(2006.1,PL,5),U,1,6)="^^^^^" ;60,61,62,63,64,65
"RTN","MAGIP39B",294,0)
 . Q
"RTN","MAGIP39B",295,0)
 Q
"RTN","MAGIP39B",296,0)
 ;
"RTN","MAGIP39B",297,0)
PURVER ;Find the first BP server that has a JUKEBOX assignment and add Auto Purge & Scheduled Verify
"RTN","MAGIP39B",298,0)
 N BPNME,BPIEN,SITE,FDA
"RTN","MAGIP39B",299,0)
 S SITE=0 F  S SITE=$O(^MAG(2006.8,"D",SITE)) Q:'SITE  D
"RTN","MAGIP39B",300,0)
 . Q:$D(^MAG(2006.8,"C",SITE,"Unassigned Tasks"))  ;patch has been installed don't execute 
"RTN","MAGIP39B",301,0)
 . S BPNME="" F  S BPNME=$O(^MAG(2006.8,"D",SITE,BPNME)) Q:BPNME=""  D
"RTN","MAGIP39B",302,0)
 . . S BPIEN=$O(^MAG(2006.8,"D",SITE,BPNME,0))
"RTN","MAGIP39B",303,0)
 . . I +$P($G(^MAG(2006.8,BPIEN,0)),U,14) D  ;BP server has JUKEBOX task assigned 
"RTN","MAGIP39B",304,0)
 . . . S FDA(2006.8,BPIEN_",",3)="1",FDA(2006.8,BPIEN_",",4)="1" D FILE^DIE("","FDA")
"RTN","MAGIP39B",305,0)
 . . . Q
"RTN","MAGIP39B",306,0)
 . . Q
"RTN","MAGIP39B",307,0)
 . Q
"RTN","MAGIP39B",308,0)
 Q
"RTN","MAGIP39B",309,0)
RMBPMSG ;The following will remove P39T23's POST_INSTALL_ACQUISITION_SITE message and mail group.
"RTN","MAGIP39B",310,0)
 ;^MAG(2006.1,2,6,"B","Post_Install_Acquisition_Site",8)=
"RTN","MAGIP39B",311,0)
 N DA,DIK,I,L,K,MSG,MSGTXT,NMSP
"RTN","MAGIP39B",312,0)
 S MSG="Post_Install_Acquisition_Site"
"RTN","MAGIP39B",313,0)
 S PL=0  F  S PL=$O(^MAG(2006.1,PL)) Q:'PL  D
"RTN","MAGIP39B",314,0)
 . S I=0,NMSP=$P($G(^MAG(2006.1,PL,0)),U,2)
"RTN","MAGIP39B",315,0)
 . Q:NMSP=""
"RTN","MAGIP39B",316,0)
 . S MSGTXT="MAG_"_NMSP_"_"_$E($$TRIM^MAGQBUT4(MSG),1,20)
"RTN","MAGIP39B",317,0)
 . S K=$$FIND1^DIC(3.8,"","B",MSGTXT) D:+K
"RTN","MAGIP39B",318,0)
 . . S DA=K,DIK="^XMB(3.8," D ^DIK K DA,DIK
"RTN","MAGIP39B",319,0)
 . . Q
"RTN","MAGIP39B",320,0)
 . I $D(^MAG(2006.1,PL,6,"B",MSG)) D
"RTN","MAGIP39B",321,0)
 . . S L=$O(^MAG(2006.1,PL,6,"B",MSG,0)) D:+L
"RTN","MAGIP39B",322,0)
 . . S DA(1)=PL,DA=L,DIK="^MAG(2006.1,"_DA(1)_",6," D ^DIK K DA,DIK
"RTN","MAGIP39B",323,0)
 . . Q
"RTN","MAGIP39B",324,0)
 . Q
"RTN","MAGIP39B",325,0)
 Q
"RTN","MAGIP39B",326,0)
TEXT ; Message Subjects
"RTN","MAGIP39B",327,0)
 ;;Imaging_Integrity_Check
"RTN","MAGIP39B",328,0)
 ;;GCC_Copy_Error
"RTN","MAGIP39B",329,0)
 ;;Application_process_failure
"RTN","MAGIP39B",330,0)
 ;;Image_Cache_Critically_Low
"RTN","MAGIP39B",331,0)
 ;;Monthly_Image_Site_Usage
"RTN","MAGIP39B",332,0)
 ;;Ad_Hoc_Image_Site_Usage
"RTN","MAGIP39B",333,0)
 ;;INSTALLATION
"RTN","MAGIP39B",334,0)
 ;;Image_File_Size_Variance
"RTN","MAGIP39B",335,0)
 ;;Verifier_Scan_Error_log
"RTN","MAGIP39B",336,0)
 ;;Imaging_Site_Verification_Issue
"RTN","MAGIP39B",337,0)
 ;;VI_BP_Queue_Processor_failure
"RTN","MAGIP39B",338,0)
 ;;Photo_I_D_Action
"RTN","MAGIP39B",339,0)
 ;;Get_Next_RAID_Group_failure
"RTN","MAGIP39B",340,0)
 ;;Scheduled_Purge_failure
"RTN","MAGIP39B",341,0)
 ;;Scheduled_Verifier_failure
"RTN","MAGIP39B",342,0)
 ;;Site_report_task_was_restarted
"RTN","MAGIP39B",343,0)
 ;;Auto_RAID_group_purge
"RTN","MAGIP39B",344,0)
 ;;Scheduled_RAID_Group_Adv
"RTN","MAGIP39B",345,0)
 ;;VI_BP_Eval_Queue
"RTN","MAGIP39B",346,0)
 ;
"RTN","MAGIP39E")
0^4^B19057411
"RTN","MAGIP39E",1,0)
MAGIP39E ;Patch 39's environment checking
"RTN","MAGIP39E",2,0)
 ;;3.0;IMAGING;**39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGIP39E",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGIP39E",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGIP39E",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGIP39E",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGIP39E",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGIP39E",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGIP39E",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGIP39E",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGIP39E",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGIP39E",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGIP39E",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGIP39E",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGIP39E",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGIP39E",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGIP39E",17,0)
 ;;
"RTN","MAGIP39E",18,0)
 ; Check duplicate network locations and inform the site on the entries
"RTN","MAGIP39E",19,0)
 N DA,EN,LIST,MAGNME,PL,RTR
"RTN","MAGIP39E",20,0)
 Q:+$G(XPDENV)  ;Only run on LOAD phase - the variable is defined by the KID install process
"RTN","MAGIP39E",21,0)
 D GETRL(.LIST),SORT(.LIST)
"RTN","MAGIP39E",22,0)
 S EN=$O(LIST("")) I EN=""  W !,"No duplicate NETWORK LOCATION entries were found." Q
"RTN","MAGIP39E",23,0)
 S PL=0 F  S PL=$O(LIST(PL)) Q:'PL  D
"RTN","MAGIP39E",24,0)
 . W !,"The Network Location file(#2005.2) has duplicate entries!",!
"RTN","MAGIP39E",25,0)
 . W !,?20,$P(^DIC(4,+$P(^MAG(2006.1,+PL,0),U),0),U) S TYPE="" F  S TYPE=$O(LIST(PL,TYPE)) Q:TYPE=""  D
"RTN","MAGIP39E",26,0)
 . . W !!,"Storage type: ",TYPE  I TYPE="ROUTER" W !,"Review ROUTE.DIC file and if needed change to Prime entry's name."
"RTN","MAGIP39E",27,0)
 . . S EN="" F  S EN=$O(LIST(PL,TYPE,EN)) Q:EN=""  D
"RTN","MAGIP39E",28,0)
 . . . S MAGNME=$P(^MAG(2005.2,$P(LIST(PL,TYPE,EN),U),0),U),RTR=$S(+$P(^MAG(2005.2,$P(LIST(PL,TYPE,EN),U),0),U,9):"ROUTER",1:"")
"RTN","MAGIP39E",29,0)
 . . . W !,"Duplicate network path: ",$P(EN,U)_"  "_$S($P(EN,U,2)="Y":"Hashed",1:"")
"RTN","MAGIP39E",30,0)
 . . . W !,?2,$G(RTR)_" Prime share name: ",MAGNME I $G(RTR)="" W "  (IEN:`"_$P(LIST(EN),U)_")"
"RTN","MAGIP39E",31,0)
 . . . F PC=2:1:$L(LIST(PL,TYPE,EN),"^") S DA=$P(LIST(PL,TYPE,EN),U,PC) Q:'DA  W !,?5," Duplicate: ",$P(^MAG(2005.2,+DA,0),U)_" (IEN:`"_DA_")",!
"RTN","MAGIP39E",32,0)
 . . . Q
"RTN","MAGIP39E",33,0)
 . . Q
"RTN","MAGIP39E",34,0)
 . W !!,"Patch 39 will task a job to delete the duplicate entries.",!!
"RTN","MAGIP39E",35,0)
 . Q
"RTN","MAGIP39E",36,0)
 Q
"RTN","MAGIP39E",37,0)
GETRL(LIST) ;  Get Redundant List (of shares)
"RTN","MAGIP39E",38,0)
 N HASH,IEN,NODE,NODE2,NODE3,PATH,PLACE,TYPE
"RTN","MAGIP39E",39,0)
 ; Must have same:  PHYSICAL REFERENCE,STORAGE TYPE,HASH DIRECTORY,PLACE
"RTN","MAGIP39E",40,0)
 ; Routers have the ROUTER field defined.  (Verify this with Ron)
"RTN","MAGIP39E",41,0)
 ; Return array:(UNC path, 1 or 0 for hash directory,division)=list of iens that match the UNC path
"RTN","MAGIP39E",42,0)
 ; ARRAY(\\UNC_HASH_DIVISION)=1ST IEN FOUND_IEN_IEN,etc.
"RTN","MAGIP39E",43,0)
 K LIST
"RTN","MAGIP39E",44,0)
 S U="^"
"RTN","MAGIP39E",45,0)
 S IEN=0 F  S IEN=$O(^MAG(2005.2,IEN)) Q:'IEN  D
"RTN","MAGIP39E",46,0)
 . S NODE=$G(^MAG(2005.2,IEN,0)),NODE3=$G(^MAG(2005.2,IEN,3)),NODE2=$G(^MAG(2005,IEN,3))
"RTN","MAGIP39E",47,0)
 . S PATH=$P(NODE,U,2),PLACE=$P(NODE,U,10),TYPE=$P(NODE,U,7),HASH=$P(NODE,U,8)
"RTN","MAGIP39E",48,0)
 . Q:((TYPE'["WORM")&(TYPE'["MAG"))  ; Only RAID and Jukebox NAMES
"RTN","MAGIP39E",49,0)
 . I +$D(LIST(PATH_U_HASH_U_PLACE)) D  Q
"RTN","MAGIP39E",50,0)
 . . S $P(LIST(PATH_U_HASH_U_PLACE),U,1,99)=$P(LIST(PATH_U_HASH_U_PLACE),U,1,99)_U_IEN
"RTN","MAGIP39E",51,0)
 . . Q
"RTN","MAGIP39E",52,0)
 . E  S LIST(PATH_U_HASH_U_PLACE)=IEN
"RTN","MAGIP39E",53,0)
 . Q
"RTN","MAGIP39E",54,0)
 S PATH="" F  S PATH=$O(LIST(PATH)) Q:PATH=""  D
"RTN","MAGIP39E",55,0)
 . I $G(LIST(PATH))'["^" K LIST(PATH) ;Only entry with more than one IEN defined.
"RTN","MAGIP39E",56,0)
 . Q
"RTN","MAGIP39E",57,0)
 ;Now start applying rules: 
"RTN","MAGIP39E",58,0)
 ;Use the IEN in the duplicates that is ONLINE-- as the primary.
"RTN","MAGIP39E",59,0)
 N NEW,OLD,ON,PC,PRIME
"RTN","MAGIP39E",60,0)
 S EN="" F  S EN=$O(LIST(EN)) Q:EN=""  D
"RTN","MAGIP39E",61,0)
 . S ON=0 F PC=1:1:$L(LIST(EN),"^") S IEN=$P(LIST(EN),U,PC) D  Q:ON
"RTN","MAGIP39E",62,0)
 . . I PC=1,+$P(^MAG(2005.2,IEN,0),U,6) S ON=1 Q    ;above rule
"RTN","MAGIP39E",63,0)
 . . I +$P(^MAG(2005.2,IEN,0),U,6) S ON=1 S NEW(EN)=IEN_"^"_PC
"RTN","MAGIP39E",64,0)
 . . Q
"RTN","MAGIP39E",65,0)
 . Q
"RTN","MAGIP39E",66,0)
 ;resort the array to place the new prime in right order
"RTN","MAGIP39E",67,0)
 S EN="" F  S EN=$O(NEW(EN)) Q:EN=""  D
"RTN","MAGIP39E",68,0)
 . ;get the original prime (OLD)and the new piece value for it.
"RTN","MAGIP39E",69,0)
 . S PRIME=$G(NEW(EN)),OLD=+LIST(EN)_U_$P(PRIME,U,2)
"RTN","MAGIP39E",70,0)
 . S NEW(EN)=$G(LIST(EN))   ;get the original prime and dup values 
"RTN","MAGIP39E",71,0)
 . S $P(NEW(EN),U)=+PRIME   ;set the new prime
"RTN","MAGIP39E",72,0)
 . S $P(NEW(EN),U,$P(OLD,U,2))=+OLD  ;Reposition the old prime value
"RTN","MAGIP39E",73,0)
 . Q
"RTN","MAGIP39E",74,0)
 S EN="" F  S EN=$O(LIST(EN)) Q:EN=""  D
"RTN","MAGIP39E",75,0)
 . I $D(NEW(EN)) M LIST(EN)=NEW(EN)
"RTN","MAGIP39E",76,0)
 . Q
"RTN","MAGIP39E",77,0)
 Q
"RTN","MAGIP39E",78,0)
SORT(LIST) ;Removing Router since there is a separate email sent during the post install.
"RTN","MAGIP39E",79,0)
 N PLACE,ROUTER,TYPE,NEW,NAME
"RTN","MAGIP39E",80,0)
 S EN="" F  S EN=$O(LIST(EN)) Q:EN=""  D
"RTN","MAGIP39E",81,0)
 . S PLACE=$P(EN,U,3),HASH=$P(EN,U,2),NAME=$P(EN,U)
"RTN","MAGIP39E",82,0)
 . S ROUTER=$S(+$P(^MAG(2005.2,$P(LIST(EN),U),0),U,9):"ROUTER",1:"")
"RTN","MAGIP39E",83,0)
 . S TYPE=$P(^MAG(2005.2,$P(LIST(EN),U),0),U,7)
"RTN","MAGIP39E",84,0)
 . S TYPE=$S(ROUTER'="":ROUTER,1:TYPE)
"RTN","MAGIP39E",85,0)
 . S NEW(PLACE,TYPE,EN)=$G(LIST(EN))
"RTN","MAGIP39E",86,0)
 . Q
"RTN","MAGIP39E",87,0)
 M LIST=NEW
"RTN","MAGIP39E",88,0)
 Q
"RTN","MAGIP39E",89,0)
 ;
"RTN","MAGLOG")
0^5^B12733539
"RTN","MAGLOG",1,0)
MAGLOG ;WOIFO/RED,SRR,MLH - Log image access ; 13 Jul 2008 11:39 PM
"RTN","MAGLOG",2,0)
 ;;3.0;IMAGING;**17,8,20,59,83,39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGLOG",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGLOG",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGLOG",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGLOG",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGLOG",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGLOG",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGLOG",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGLOG",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGLOG",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGLOG",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGLOG",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGLOG",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGLOG",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGLOG",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGLOG",17,0)
 ;;
"RTN","MAGLOG",18,0)
 Q
"RTN","MAGLOG",19,0)
 ; CALL WITH:
"RTN","MAGLOG",20,0)
 ; MAGIMT = TYPE OF ACCESS
"RTN","MAGLOG",21,0)
 ; DUZ = USER NO.
"RTN","MAGLOG",22,0)
 ; MAGO = IMAGE SUBSCRIPT NO.
"RTN","MAGLOG",23,0)
 ; MAGPACK = USER INTERFACE PACKAGE
"RTN","MAGLOG",24,0)
 ; MAGDFN = PATIENT NO.
"RTN","MAGLOG",25,0)
 ; MAGCT = TOTAL IMAGE COUNT
"RTN","MAGLOG",26,0)
 ; MAGAD = ADDITIONAL DATA
"RTN","MAGLOG",27,0)
 Q
"RTN","MAGLOG",28,0)
ENTRY(MAGIMT,MAGDUZ,MAGO,MAGPACK,MAGDFN,MAGCT,MAGAD) ;
"RTN","MAGLOG",29,0)
 I '$D(MAGSYS) S MAGSYS=^%ZOSF("VOL")
"RTN","MAGLOG",30,0)
 N MAGC,MSYS,MAGSITE,SITE,NOW
"RTN","MAGLOG",31,0)
 S MSYS=$$UP^XLFSTR(MAGSYS)
"RTN","MAGLOG",32,0)
 I (MSYS["UNKNOWN"),($D(MAGJOB("WRKSIEN"))) S MSYS=$P(^MAG(2006.81,MAGJOB("WRKSIEN"),0),"^",1)
"RTN","MAGLOG",33,0)
 L +^MAG(2006.95,0):10 E  Q  ;entries were being overwritten.
"RTN","MAGLOG",34,0)
 S MAGC=$P(^MAG(2006.95,0),"^",3)+1
"RTN","MAGLOG",35,0)
 S $P(^MAG(2006.95,0),"^",3,4)=MAGC_"^"_MAGC
"RTN","MAGLOG",36,0)
 L -^MAG(2006.95,0)
"RTN","MAGLOG",37,0)
 S NOW=$$NOW^XLFDT
"RTN","MAGLOG",38,0)
 ;   FLD #'s            .01         1                2          3          4             5         6       7          8               9  
"RTN","MAGLOG",39,0)
 S ^MAG(2006.95,MAGC,0)=MAGC_"^"_$G(MAGIMT)_"^"_$G(MAGDUZ)_"^"_MAGO_"^"_MAGPACK_"^"_MSYS_"^"_NOW_"^"_MAGDFN_"^"_MAGCT_"^"_+$G(MAGJOB("SESSION"))
"RTN","MAGLOG",40,0)
 S SITE=$$SITE(""),MAGSITE=$P(SITE,"^",2)
"RTN","MAGLOG",41,0)
 S $P(^MAG(2006.95,MAGC,0),"^",11)=$P(SITE,"^")
"RTN","MAGLOG",42,0)
 S:$G(MAGAD)'="" ^MAG(2006.95,MAGC,100)=MAGAD
"RTN","MAGLOG",43,0)
 S ^MAG(2006.95,"B",MAGC,MAGC)=""
"RTN","MAGLOG",44,0)
 S ^MAG(2006.95,"AC",NOW,MAGC)=""
"RTN","MAGLOG",45,0)
 S ^MAG(2006.95,"C",MAGSITE,NOW,MAGC)=""
"RTN","MAGLOG",46,0)
 D ACCESS(MAGO) ; This should be here.  Can now search 2006.95 from "Last Access Date" to "Capture Date" to
"RTN","MAGLOG",47,0)
 ; get all Actions logged. We Don't have to search entire Image File.
"RTN","MAGLOG",48,0)
 I $G(MAGJOB("SESSION")) S ^MAG(2006.95,"AS",+$G(MAGJOB("SESSION")),MAGC)=""
"RTN","MAGLOG",49,0)
 Q
"RTN","MAGLOG",50,0)
ACCESS(MAGO) ; Update Field "Last Access Date" in Image File.
"RTN","MAGLOG",51,0)
 Q:'$G(MAGO)
"RTN","MAGLOG",52,0)
 I '$D(^MAG(2005,MAGO,0)) D  Q
"RTN","MAGLOG",53,0)
 . I $D(^MAG(2005.1,MAGO,0)) S $P(^MAG(2005.1,MAGO,0),"^",9)=$$NOW^XLFDT
"RTN","MAGLOG",54,0)
 . Q
"RTN","MAGLOG",55,0)
 S $P(^MAG(2005,MAGO,0),"^",9)=$$NOW^XLFDT
"RTN","MAGLOG",56,0)
 Q
"RTN","MAGLOG",57,0)
SITE(RETURN) ;Set SITE to either image acquisition field or the user's division or default to Kernel parameter.
"RTN","MAGLOG",58,0)
 ; SITE is the division value and MAGSITE is the value for it's corresponding value in file 2006.1
"RTN","MAGLOG",59,0)
 ; either an Imaging site entry or an associated institution.
"RTN","MAGLOG",60,0)
 N INST,SITE,MAGSITE
"RTN","MAGLOG",61,0)
 S INST=$$KSP^XUPARAM("INST"),MAGSITE="",RETURN=""
"RTN","MAGLOG",62,0)
 I $G(MAGO) D
"RTN","MAGLOG",63,0)
 . I $D(^MAG(2005,MAGO,0)),$D(^MAG(2005,MAGO,100)) S SITE=$P(^(100),"^",3)
"RTN","MAGLOG",64,0)
 . E  I $D(^MAG(2005.1,MAGO,0)),$D(^MAG(2005.1,MAGO,100)) S SITE=$P(^(100),"^",3)
"RTN","MAGLOG",65,0)
 . Q
"RTN","MAGLOG",66,0)
 I '+$G(SITE),$G(MAGDUZ) D 
"RTN","MAGLOG",67,0)
 . I $G(DUZ(2)),$D(^MAG(2006.1,"B",DUZ(2))) S SITE=DUZ(2),MAGSITE=$$PLACE^MAGBAPI(SITE) Q
"RTN","MAGLOG",68,0)
 . S SITE=$$FINDSITE^MAGQE7(MAGDUZ)
"RTN","MAGLOG",69,0)
 . Q
"RTN","MAGLOG",70,0)
 I '+$G(SITE) S SITE=INST  ; ;Last default use the Kernel parameters.
"RTN","MAGLOG",71,0)
 I 'MAGSITE S MAGSITE=$S($D(^MAG(2006.1,"B",+SITE)):SITE,1:INST) S MAGSITE=$$PLACE^MAGBAPI(MAGSITE)
"RTN","MAGLOG",72,0)
 S RETURN=SITE_"^"_MAGSITE
"RTN","MAGLOG",73,0)
 Q RETURN
"RTN","MAGQBAB")
0^6^B11090744
"RTN","MAGQBAB",1,0)
MAGQBAB ;WOIFO/PMK/RMP - Create an ABSTRACT from an image file ; 18 Jan 2011 4:09 PM
"RTN","MAGQBAB",2,0)
 ;;3.0;IMAGING;**1,8,20,39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGQBAB",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGQBAB",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBAB",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBAB",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBAB",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBAB",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBAB",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBAB",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBAB",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBAB",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBAB",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBAB",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBAB",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBAB",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBAB",17,0)
 ;;
"RTN","MAGQBAB",18,0)
 Q
"RTN","MAGQBAB",19,0)
ENTRY(RESULT,QPTR) ;
"RTN","MAGQBAB",20,0)
 ; RESULT=STATUS^IMAGE PTR^FROM FILEPATH^ABSTRACT FILEPATH^QPTR^VWP^QSN
"RTN","MAGQBAB",21,0)
 ; VWP=VISTA WRITE LOCATION,QSN=QUEUE SEQUENCE NUMBER
"RTN","MAGQBAB",22,0)
 N IMGPTR,L,X,MAGXX,FILENAME,FILE,ABSNAME,JBPATH
"RTN","MAGQBAB",23,0)
 N MAGNODE,MAGFILE,MAGFILE2,QSN,QNODE,MAGDRIVE,CWL,PLACE
"RTN","MAGQBAB",24,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBAB",25,0)
 S U="^",QNODE=$G(^MAGQUEUE(2006.03,QPTR,0))
"RTN","MAGQBAB",26,0)
 S IMGPTR=$P(QNODE,U,7),QSN=+$P(QNODE,U,9)
"RTN","MAGQBAB",27,0)
 S MAGNODE=$G(^MAG(2005,IMGPTR,0))
"RTN","MAGQBAB",28,0)
 I $P(MAGNODE,U,2)="" D  Q
"RTN","MAGQBAB",29,0)
 . S RESULT="-1^"_QPTR_U_"The Image file entry has no file name for IEN: "_IMGPTR_"^^^^"_QSN
"RTN","MAGQBAB",30,0)
 . Q
"RTN","MAGQBAB",31,0)
 I $P(MAGNODE,U,4)?1N.N D  Q
"RTN","MAGQBAB",32,0)
 . S RESULT="-1^"_QPTR_U_$P($P(MAGNODE,U,2),".")_" has an .ABS file already referenced on the VistA cache ^^^^"_QSN
"RTN","MAGQBAB",33,0)
 . Q
"RTN","MAGQBAB",34,0)
 I $P(MAGNODE,U,3)="" D  Q
"RTN","MAGQBAB",35,0)
 . I $P(MAGNODE,U,5)?1N.N D  Q
"RTN","MAGQBAB",36,0)
 . . N QN,TMP
"RTN","MAGQBAB",37,0)
 . . S QN=$$JBTOHD^MAGBAPI(IMGPTR_U_"FULL",PLACE)
"RTN","MAGQBAB",38,0)
 . . S TMP=IMGPTR_" Full File is not on the VC, a JBTOHD queue will retrieve and the ABSTRACT will be requeued"
"RTN","MAGQBAB",39,0)
 . . S RESULT="-15^"_QPTR_U_TMP_"^^"_QPTR_"^^"_QSN
"RTN","MAGQBAB",40,0)
 . . Q
"RTN","MAGQBAB",41,0)
 . S RESULT="-2^"_QPTR_U_IMGPTR_" File not available on the VistA network^^"_QPTR_"^^"_QSN
"RTN","MAGQBAB",42,0)
 ; get the path and file name for this image
"RTN","MAGQBAB",43,0)
 S MAGXX=IMGPTR D VSTNOCP^MAGFILEB I $E(MAGFILE1,1,2)="-1" D  Q
"RTN","MAGQBAB",44,0)
 . S RESULT="-3^"_QPTR_U_IMGPTR_" File not online^^"_QPTR_"^^"_QSN
"RTN","MAGQBAB",45,0)
 S FILENAME=MAGFILE
"RTN","MAGQBAB",46,0)
 S L=$L(FILENAME) I '$A(FILENAME,L) S FILENAME=$E(FILENAME,1,L-1)
"RTN","MAGQBAB",47,0)
 S L=$L(FILENAME,"\") ; parse the file
"RTN","MAGQBAB",48,0)
 S FILE=$P(FILENAME,"\",L)
"RTN","MAGQBAB",49,0)
 K MAGFILE1
"RTN","MAGQBAB",50,0)
 ;
"RTN","MAGQBAB",51,0)
 S JBPATH=$P(MAGNODE,U,5)
"RTN","MAGQBAB",52,0)
 S JBPATH=$S('JBPATH:"",1:$P(^MAG(2005.2,JBPATH,0),U,2)_$$DIRHASH^MAGFILEB(FILE,JBPATH))
"RTN","MAGQBAB",53,0)
 S CWL=$$CWL^MAGBAPI(PLACE),MAGDRIVE=$P(^MAG(2005.2,CWL,0),U,2)
"RTN","MAGQBAB",54,0)
 S ABSNAME=MAGDRIVE_$$DIRHASH^MAGFILEB(FILE,CWL)
"RTN","MAGQBAB",55,0)
 S ABSNAME=ABSNAME_$P(FILE,".")_".ABS"
"RTN","MAGQBAB",56,0)
 S RESULT="1"_U_IMGPTR_U_FILENAME_U_ABSNAME_U_QPTR_U_CWL_U_QSN_U_JBPATH
"RTN","MAGQBAB",57,0)
 Q
"RTN","MAGQBD")
0^7^B7193200
"RTN","MAGQBD",1,0)
MAGQBD ;WOIFO/PMK/RMP - Arbitrary file deletion ; 18 Jan 2011 4:18 PM
"RTN","MAGQBD",2,0)
 ;;3.0;IMAGING;**20,39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGQBD",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGQBD",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBD",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBD",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBD",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBD",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBD",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBD",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBD",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBD",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBD",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBD",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBD",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBD",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBD",17,0)
 ;;
"RTN","MAGQBD",18,0)
 Q
"RTN","MAGQBD",19,0)
ENTRY(RESULT,QPTR) ; entry point from MAGQBTM
"RTN","MAGQBD",20,0)
 N FILE,X,IEN,FN,ARCH,NODE,PLACE,GB,CJB,CJBP
"RTN","MAGQBD",21,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2))),(GB,ARCH)=""
"RTN","MAGQBD",22,0)
 S U="^",X=^MAGQUEUE(2006.03,QPTR,0)
"RTN","MAGQBD",23,0)
 S FILE=$P(X,"^",10)
"RTN","MAGQBD",24,0)
 S FN=$P(FILE,"\",$L(FILE,"\"))
"RTN","MAGQBD",25,0)
 S IEN=$O(^MAG(2005.1,"F",$P(FN,"."),""))
"RTN","MAGQBD",26,0)
 I 'IEN S RESULT="-1"_U_QPTR_U_"No 2005.1 Entry established for Image file: "_$P(FN,".")_U_U Q
"RTN","MAGQBD",27,0)
 S NODE=$G(^MAG(2005.1,IEN,0))
"RTN","MAGQBD",28,0)
 I $P(FILE,".",2)'["BIG" S ARCH=$S($P(NODE,U,5):$P(NODE,U,5),1:"")
"RTN","MAGQBD",29,0)
 E  S ARCH=$S($P($G(^MAG(2005.1,IEN,"FBIG")),U,2):$P($G(^MAG(2005.1,IEN,"FBIG")),U,2),1:"")
"RTN","MAGQBD",30,0)
 S CJB=$$JBPTR^MAGBAPI($$PLACE^MAGBAPI(+$G(DUZ(2))))
"RTN","MAGQBD",31,0)
 S CJBP=$$UPPER^MAGQE4($P($G(^MAG(2005.2,CJB,0)),U,2)_$$DIRHASH^MAGFILEB(FN,CJB))
"RTN","MAGQBD",32,0)
 S GB=$S(ARCH:$$UPPER^MAGQE4($P($G(^MAG(2005.2,ARCH,0)),U,2)_$$DIRHASH^MAGFILEB(FN,ARCH)),1:"")
"RTN","MAGQBD",33,0)
 I ($L(GB)<1)&($L(CJBP)<1) S RESULT="-1"_U_QPTR_U_"No Archive Global established for entry: "_IEN_U_QPTR_U_U
"RTN","MAGQBD",34,0)
 E  S RESULT="1"_U_FILE_U_QPTR_U_+$P(X,U,9)_U_GB_U_IEN_U_ARCH_U_CJB_U_CJBP
"RTN","MAGQBD",35,0)
 Q
"RTN","MAGQBGCC")
0^8^B22620729
"RTN","MAGQBGCC",1,0)
MAGQBGCC ;WOIFO/RMP - Export an image file to a remote location ; 18 Jan 2011 4:49 PM
"RTN","MAGQBGCC",2,0)
 ;;3.0;IMAGING;**8,48,20,39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGQBGCC",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGQBGCC",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBGCC",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBGCC",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBGCC",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBGCC",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBGCC",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBGCC",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBGCC",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBGCC",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBGCC",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBGCC",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBGCC",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBGCC",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBGCC",17,0)
 ;;
"RTN","MAGQBGCC",18,0)
 Q
"RTN","MAGQBGCC",19,0)
ENTRY(RESULT,QPTR) ; entry point from ^MAGQBTM
"RTN","MAGQBGCC",20,0)
 ; RESULT=STATUS^IMAGE PTR^FROM FILE^TO FILE^QUEUE PTR^REMOTELOC PTR^QSN
"RTN","MAGQBGCC",21,0)
 ; QSN=QUEUE SEQUENCE NUMBER
"RTN","MAGQBGCC",22,0)
 N CWL,IMGPTR,L,FILE,MAGREF,TOFILE,QNODE,QSN,ZNODE,SOURCE,FTYPE,MSG,EXT,ALTDEST,ALTNAME
"RTN","MAGQBGCC",23,0)
 S QNODE=$G(^MAGQUEUE(2006.03,QPTR,0)),RESULT="1"
"RTN","MAGQBGCC",24,0)
 S IMGPTR=$P(QNODE,U,7),QSN=+$P(QNODE,U,9),ALTDEST=+$P(QNODE,U,10),ALTNAME=$P($P(QNODE,U,11),"~")
"RTN","MAGQBGCC",25,0)
 S FTYPE=$P($P(QNODE,U,11),"~",2)
"RTN","MAGQBGCC",26,0)
 S ZNODE=$G(^MAG(2005,IMGPTR,0))
"RTN","MAGQBGCC",27,0)
 I ZNODE="" D  Q
"RTN","MAGQBGCC",28,0)
 . S RESULT="-101^"_QPTR_"^MAG Global Node #"_IMGPTR_" not present"
"RTN","MAGQBGCC",29,0)
 S FILE=$P(ZNODE,U,2)
"RTN","MAGQBGCC",30,0)
 I FILE="" D  Q
"RTN","MAGQBGCC",31,0)
 . I +$P($G(^MAG(2005,IMGPTR,1,0)),U,4)>0 D
"RTN","MAGQBGCC",32,0)
 . . S MSG="Image group parent"
"RTN","MAGQBGCC",33,0)
 . E  S MSG="Does not have an image file specified"
"RTN","MAGQBGCC",34,0)
 . S RESULT="-5"_U_QPTR_U_MSG
"RTN","MAGQBGCC",35,0)
 ;Next we implement alternate file types
"RTN","MAGQBGCC",36,0)
 S FTYPE=$S(FTYPE="":"FULL",1:$$FTYPE^MAGQBPRG(FTYPE,IMGPTR))
"RTN","MAGQBGCC",37,0)
 D @(FTYPE_"(.RESULT,.MAGREF,IMGPTR)")
"RTN","MAGQBGCC",38,0)
 Q:$P(RESULT,"^")<0
"RTN","MAGQBGCC",39,0)
 S SOURCE=$$WPATH(FILE,MAGREF)_FILE
"RTN","MAGQBGCC",40,0)
 S L=+$P(QNODE,"^",10)
"RTN","MAGQBGCC",41,0)
 S CWL=$S(L>0:L,1:$$CEL()) ;DETERMINE DESTINATION SHARE
"RTN","MAGQBGCC",42,0)
 I $P(^MAG(2005.2,CWL,0),"^",6)'="1" D  Q
"RTN","MAGQBGCC",43,0)
 . S RESULT="-4"_U_QPTR_U_"Export Network Location is set Offline"
"RTN","MAGQBGCC",44,0)
 S TOFILE=$S(ALTDEST:$$WPATH(FILE,ALTDEST)_ALTNAME,1:$$WPATH(FILE,CWL)_FILE)
"RTN","MAGQBGCC",45,0)
 S RESULT="1^"_IMGPTR_U_SOURCE_U_TOFILE_U_QPTR_U_CWL_U_QSN_U_ALTNAME
"RTN","MAGQBGCC",46,0)
 Q
"RTN","MAGQBGCC",47,0)
CEL() ; Current Export Pointer
"RTN","MAGQBGCC",48,0)
 Q $S($P(^MAG(2006.1,$$PLACE^MAGBAPI(+$G(DUZ(2))),0),"^",7)>1:$P(^(0),"^",7),1:1)
"RTN","MAGQBGCC",49,0)
WPATH(FILE,LOC) ; Write path of location (CWP)
"RTN","MAGQBGCC",50,0)
 Q $P(^MAG(2005.2,LOC,0),"^",2)_$$DIRHASH^MAGFILEB(FILE,LOC)
"RTN","MAGQBGCC",51,0)
FULL(RESULT,MAGREF,MAGIFN) ; copy a full-size image
"RTN","MAGQBGCC",52,0)
 S MAGREF=$$LINE(+$P(^MAG(2005,MAGIFN,0),"^",3))
"RTN","MAGQBGCC",53,0)
 I 'MAGREF S MAGREF=$$LINE(+$P(^MAG(2005,MAGIFN,0),"^",5))
"RTN","MAGQBGCC",54,0)
 S:('MAGREF) RESULT="-3"_U_QPTR_U_"File not online"
"RTN","MAGQBGCC",55,0)
 Q 
"RTN","MAGQBGCC",56,0)
 ;
"RTN","MAGQBGCC",57,0)
ABS(RESULT,MAGREF,MAGIFN) ; copy an image abstract
"RTN","MAGQBGCC",58,0)
 S MAGREF=$$LINE(+$P(^MAG(2005,MAGIFN,0),"^",4))
"RTN","MAGQBGCC",59,0)
 I 'MAGREF S MAGREF=$$LINE(+$P(^MAG(2005,MAGIFN,0),"^",5))
"RTN","MAGQBGCC",60,0)
 S:('MAGREF) RESULT="-3"_U_QPTR_U_"Abstract File not online"
"RTN","MAGQBGCC",61,0)
 Q 
"RTN","MAGQBGCC",62,0)
 ;
"RTN","MAGQBGCC",63,0)
BIG(RESULT,MAGREF,MAGIFN) ; copy a big image
"RTN","MAGQBGCC",64,0)
 S MAGREF=$$LINE(+$P(^MAG(2005,MAGIFN,"FBIG"),"^",1))
"RTN","MAGQBGCC",65,0)
 I 'MAGREF S MAGREF=$$LINE(+$P(^MAG(2005,MAGIFN,"FBIG"),"^",2))
"RTN","MAGQBGCC",66,0)
 S:('MAGREF) RESULT="-3"_U_QPTR_U_"Big File not online"
"RTN","MAGQBGCC",67,0)
 Q
"RTN","MAGQBGCC",68,0)
LINE(PTR) ;Check if the share is online
"RTN","MAGQBGCC",69,0)
 Q:PTR<1 ""
"RTN","MAGQBGCC",70,0)
 Q $S($P($G(^MAG(2005.2,PTR,0)),U,6)=1:PTR,1:"")
"RTN","MAGQBGCC",71,0)
PID(MAGRY,MAGIEN) ;  Queuing PHOTO ID
"RTN","MAGQBGCC",72,0)
 N EXLOC,DFN,FN
"RTN","MAGQBGCC",73,0)
 S EXLOC=$P($G(^MAG(2005.86,$O(^MAG(2005.86,"B","PHOTO-ID COPY","")),0)),U,5)
"RTN","MAGQBGCC",74,0)
 I 'EXLOC D  Q
"RTN","MAGQBGCC",75,0)
 . N PLACE
"RTN","MAGQBGCC",76,0)
 . S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBGCC",77,0)
 . D DFNIQ^MAGQBPG1(""," Production Account: "_$$PROD^XUPROD("1"),0,PLACE,"PHOTO ID ACTION")
"RTN","MAGQBGCC",78,0)
 . D DFNIQ^MAGQBPG1("","The Photo ID protocol in the IMAGE ACTION file (#2005.86) could not ",0,PLACE,"PHOTO ID ACTION")
"RTN","MAGQBGCC",79,0)
 . D DFNIQ^MAGQBPG1("","resolve the target export location as currently defined. ",0,PLACE,"PHOTO ID ACTION")
"RTN","MAGQBGCC",80,0)
 . D DFNIQ^MAGQBPG1("","Update the EXPORT LOCATION field for the PHOTO-ID COPY entry in ",0,PLACE,"PHOTO ID ACTION")
"RTN","MAGQBGCC",81,0)
 . D DFNIQ^MAGQBPG1("","IMAGE ACTION file. ",0,PLACE,"PHOTO ID ACTION")
"RTN","MAGQBGCC",82,0)
 . D DFNIQ^MAGQBPG1("","Photo_I_D_Action",1,PLACE,"PHOTO ID ACTION")
"RTN","MAGQBGCC",83,0)
 . S MAGRY(0)="0^The PHOTO ID COPY Image action queue process could not resolve the export location"
"RTN","MAGQBGCC",84,0)
 . Q
"RTN","MAGQBGCC",85,0)
 S DFN=$P($G(^MAG(2005,MAGIEN,0)),U,7),FN=DFN_"."_$P($P($G(^MAG(2005,MAGIEN,0)),U,2),".",2)
"RTN","MAGQBGCC",86,0)
 D CHK^MAGGSQI(.MAGRY,MAGIEN)
"RTN","MAGQBGCC",87,0)
 I $P(MAGRY(0),U) S MAGRY(0)=$$GCC^MAGBAPI(MAGIEN_U_EXLOC_U_FN,$$DA2PLC^MAGBAPIP(MAGIEN,"F"))
"RTN","MAGQBGCC",88,0)
 S MAGRY(1)=MAGIEN_" "_$$NOW^XLFDT
"RTN","MAGQBGCC",89,0)
 D ACTION^MAGGTAU("PPACT^"_$P(^MAG(2005,MAGIEN,0),"^",7)_"^"_MAGIEN_"|PHOTO ID-COPY using GCC^MAGBAPI",1)
"RTN","MAGQBGCC",90,0)
 K VADPT
"RTN","MAGQBGCC",91,0)
 Q
"RTN","MAGQBGCC",92,0)
 ;
"RTN","MAGQBIM")
0^9^B10106548
"RTN","MAGQBIM",1,0)
MAGQBIM ;WOIFO/RMP - Import functions ; 18 Jan 2011 4:52 PM
"RTN","MAGQBIM",2,0)
 ;;3.0;IMAGING;**7,20,39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGQBIM",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGQBIM",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBIM",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBIM",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBIM",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBIM",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBIM",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBIM",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBIM",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBIM",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBIM",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBIM",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBIM",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBIM",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBIM",17,0)
 ;;
"RTN","MAGQBIM",18,0)
 ;
"RTN","MAGQBIM",19,0)
 Q
"RTN","MAGQBIM",20,0)
ENTRY(QP,QUE,QP2,ZN,RES) ;
"RTN","MAGQBIM",21,0)
 N IEN,TRACKID,ASIEN,XX,X,X2,PLACE
"RTN","MAGQBIM",22,0)
 S IEN=$S($P(ZN,U,11)?1N.N:$P(ZN,U,11),1:QP),TRACKID=""
"RTN","MAGQBIM",23,0)
 S ASIEN=$O(^MAG(2006.041,"B",IEN,""))
"RTN","MAGQBIM",24,0)
 I ASIEN?1N.N S TRACKID=$P($G(^MAG(2006.041,ASIEN,0)),U,2)
"RTN","MAGQBIM",25,0)
 I TRACKID']"" D  Q:TRACKID']""
"RTN","MAGQBIM",26,0)
 . D QSTAT^MAGQBTM(QP,"Import De-queue Holding FIVE sec for TrackID.",QUE,.PLACE)
"RTN","MAGQBIM",27,0)
 . S X=$$DT^XLFDT,X2=$$FMADD^XLFDT(X,30)
"RTN","MAGQBIM",28,0)
 . I '$D(^XTMP("MAGQBIM "_X,0)) D
"RTN","MAGQBIM",29,0)
 . . S ^XTMP("MAGQBIM "_X,0)=X2_"^"_X_"^"_"Recording IMPORT Trackid failure"
"RTN","MAGQBIM",30,0)
 . . Q
"RTN","MAGQBIM",31,0)
 . S ^XTMP("MAGQBIM "_X,$$NOW^XLFDT)="Queue ptr: "_QP_U_"De-queue Holding FIVE sec for Station #: ^"_$P(^MAG(2006.1,$P($G(ZN),U,12),0),U,1)
"RTN","MAGQBIM",32,0)
 . H 5
"RTN","MAGQBIM",33,0)
 . S ASIEN=$O(^MAG(2006.041,"B",IEN,"")) ;try setting again after the hang
"RTN","MAGQBIM",34,0)
 . I ASIEN?1N.N S TRACKID=$P($G(^MAG(2006.041,ASIEN,0)),U,2)
"RTN","MAGQBIM",35,0)
 . S RES="-1"_U_QP_U_" Dequeue Failed on TrackId lookup."
"RTN","MAGQBIM",36,0)
 . Q
"RTN","MAGQBIM",37,0)
 S RES=QP_U_TRACKID_U_$TR($P(ZN,U,10),"|",U)_U_IEN
"RTN","MAGQBIM",38,0)
 S $P(RES,U,8)=+$P(ZN,U,9)
"RTN","MAGQBIM",39,0)
 Q
"RTN","MAGQBIM",40,0)
STAT(QP,TIME,MESS) ;
"RTN","MAGQBIM",41,0)
 N STATID,STATIEN
"RTN","MAGQBIM",42,0)
 S STATIEN=$O(^MAG(2006.041,"B",QP,"")),STATID=""
"RTN","MAGQBIM",43,0)
 I STATIEN?1N.N S STATID=$P($G(^MAG(2006.041,STATIEN,0)),U,2)
"RTN","MAGQBIM",44,0)
 Q:STATID']""
"RTN","MAGQBIM",45,0)
 K FDA
"RTN","MAGQBIM",46,0)
 S FDA(2006.041,"+1,",.01)=QP
"RTN","MAGQBIM",47,0)
 S FDA(2006.041,"+1,",.02)=STATID
"RTN","MAGQBIM",48,0)
 S FDA(2006.041,"+1,",1)="BP QUEUE STATUS"
"RTN","MAGQBIM",49,0)
 S FDA(2006.041,"+1,",2)=TIME
"RTN","MAGQBIM",50,0)
 S FDA(2006.041,"+1,",3)=MESS
"RTN","MAGQBIM",51,0)
 D UPDATE^DIE("U","FDA","","MAGIMP")
"RTN","MAGQBIM",52,0)
 Q
"RTN","MAGQBIM",53,0)
TIDL(QP,QUE,RES) ; Tracking ID Lookup - Used for IMPORT Re-Queue
"RTN","MAGQBIM",54,0)
 N ASIEN,TRACKID
"RTN","MAGQBIM",55,0)
 S RES=0,TRACKID=""
"RTN","MAGQBIM",56,0)
 S ASIEN=$O(^MAG(2006.041,"B",QP,""))
"RTN","MAGQBIM",57,0)
 I ASIEN?1N.N S TRACKID=$P($G(^MAG(2006.041,ASIEN,0)),U,2)
"RTN","MAGQBIM",58,0)
 I TRACKID']"" D  Q
"RTN","MAGQBIM",59,0)
 . D QSTAT^MAGQBTM(QP,QUE_"      Requeue Failed on TrackId lookup.",QUE,$$PLACE^MAGBAPI(+$G(DUZ(2))))
"RTN","MAGQBIM",60,0)
 . Q
"RTN","MAGQBIM",61,0)
 S RES=TRACKID
"RTN","MAGQBIM",62,0)
 Q
"RTN","MAGQBJB")
0^10^B17698321
"RTN","MAGQBJB",1,0)
MAGQBJB ;WOIFO/PMK/RMP - Get an image file to copy to the JukeBox ; 18 Jan 2011 4:55 PM
"RTN","MAGQBJB",2,0)
 ;;3.0;IMAGING;**8,20,39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGQBJB",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGQBJB",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBJB",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBJB",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBJB",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBJB",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBJB",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBJB",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBJB",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBJB",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBJB",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBJB",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBJB",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBJB",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBJB",17,0)
 ;;
"RTN","MAGQBJB",18,0)
 Q
"RTN","MAGQBJB",19,0)
ENTRY(RESULT,QPTR) ; entry point from ^MAGQBTM
"RTN","MAGQBJB",20,0)
 ; RESULT=STATUS^IMAGE PTR^FROM FILE^TO FILE^JUKEBOX DEVICE^
"RTN","MAGQBJB",21,0)
 ;   QUEUE PTR^JUKEBOX-NETWORK LOC PTR^QSN^Abstract^BIG
"RTN","MAGQBJB",22,0)
 ; QSN=QUEUE SEQUENCE NUMBER
"RTN","MAGQBJB",23,0)
 N IMGPTR,L,JBDEVICE,FILENAME,FILE,X,JBPTR,SUBDIR
"RTN","MAGQBJB",24,0)
 N MAGFILE,MAGXX,MAGSTORE,MAGFILE2,PERCENT,SIZERTN,MAGDEV,SRCE
"RTN","MAGQBJB",25,0)
 N TOFILE,TOTAL,QNODE,QSN,ZNODE,BNODE,FULL,ABS,BIG,MSG,PLACE,AGG
"RTN","MAGQBJB",26,0)
 S U="^",QNODE=$G(^MAGQUEUE(2006.03,QPTR,0)),(ZNODE,FULL,ABS,BIG,JBPTR,AGG)=""
"RTN","MAGQBJB",27,0)
 S IMGPTR=$P(QNODE,U,7),QSN=+$P(QNODE,U,9),PLACE=$P(QNODE,U,12)
"RTN","MAGQBJB",28,0)
 I $D(^MAG(2005,IMGPTR,0)) D
"RTN","MAGQBJB",29,0)
 . S ZNODE=$G(^MAG(2005,IMGPTR,0))
"RTN","MAGQBJB",30,0)
 . S BNODE=$G(^MAG(2005,IMGPTR,"FBIG"))
"RTN","MAGQBJB",31,0)
 . Q
"RTN","MAGQBJB",32,0)
 E  I $D(^MAG(2005.1,IMGPTR,0)) D
"RTN","MAGQBJB",33,0)
 . S ZNODE=$G(^MAG(2005.1,IMGPTR,0))
"RTN","MAGQBJB",34,0)
 . S BNODE=$G(^MAG(2005.1,IMGPTR,"FBIG"))
"RTN","MAGQBJB",35,0)
 . Q
"RTN","MAGQBJB",36,0)
 I ZNODE="" D  Q  ;RESULT ;!!!!
"RTN","MAGQBJB",37,0)
 . S RESULT="-101^"_QPTR_"^MAG Global Node #"_IMGPTR_" not present"
"RTN","MAGQBJB",38,0)
 S FILE=$P(ZNODE,U,2)
"RTN","MAGQBJB",39,0)
 I FILE="" D  Q  ;RESULT ;!!!
"RTN","MAGQBJB",40,0)
 . I +$P($G(^MAG(2005,IMGPTR,1,0)),U,4)>0 D
"RTN","MAGQBJB",41,0)
 . . S MSG="Image group parent"
"RTN","MAGQBJB",42,0)
 . E  S MSG="Does not have an image file specified"
"RTN","MAGQBJB",43,0)
 . S RESULT="-5"_U_QPTR_U_MSG
"RTN","MAGQBJB",44,0)
 ; Establish the current Jukebox location
"RTN","MAGQBJB",45,0)
 S JBPTR=$$JBPTR^MAGBAPI($$PLACE^MAGBAPI(+$G(DUZ(2))))
"RTN","MAGQBJB",46,0)
 I 'JBPTR D  Q
"RTN","MAGQBJB",47,0)
 . S RESULT="-4"_U_QPTR_U_"The Jukebox Network Location is not set"
"RTN","MAGQBJB",48,0)
 I $P(^MAG(2005.2,JBPTR,0),"^",6)'="1" D  Q
"RTN","MAGQBJB",49,0)
 . S RESULT="-4"_U_QPTR_U_"Jukebox Network Location "_$P(^MAG(2005.2,JBPTR,0),"^",1)_" is set Offline"
"RTN","MAGQBJB",50,0)
 S JBDEVICE=$$JBDEV(JBPTR)
"RTN","MAGQBJB",51,0)
 ; If the current Jukebox write location differs from the FULL/ABstract Worm or the BIG Worm then aggregate
"RTN","MAGQBJB",52,0)
 S AGG=$S($P(ZNODE,U,5)&($P(ZNODE,U,5)'=JBPTR):1,$P(BNODE,U,2)&($P(BNODE,U,2)'=JBPTR):1,1:"")
"RTN","MAGQBJB",53,0)
 ; Check for FULL
"RTN","MAGQBJB",54,0)
 S SRCE=$S($$SLINE(+$P(ZNODE,U,3)):$P(ZNODE,U,3),1:"")
"RTN","MAGQBJB",55,0)
 I 'SRCE,AGG S SRCE=$S($$SLINE(+$P(ZNODE,U,5)):$P(ZNODE,U,5),1:"")
"RTN","MAGQBJB",56,0)
 I SRCE D 
"RTN","MAGQBJB",57,0)
 . S MAGDEV=$P(^MAG(2005.2,SRCE,0),U,2),FULL=MAGDEV_$$DIRHASH^MAGFILEB(FILE,SRCE)_FILE Q 
"RTN","MAGQBJB",58,0)
 ; Check for Abstract
"RTN","MAGQBJB",59,0)
 S SRCE=$S($$SLINE(+$P(ZNODE,U,4)):$P(ZNODE,U,4),1:"")
"RTN","MAGQBJB",60,0)
 I 'SRCE,AGG S SRCE=$S($$SLINE(+$P(ZNODE,U,5)):$P(ZNODE,U,5),1:"")
"RTN","MAGQBJB",61,0)
 I SRCE D 
"RTN","MAGQBJB",62,0)
 . S MAGDEV=$P(^MAG(2005.2,SRCE,0),U,2),ABS=MAGDEV_$$DIRHASH^MAGFILEB(FILE,SRCE)_$P(FILE,".")_".ABS" Q 
"RTN","MAGQBJB",63,0)
 ; Check for Big
"RTN","MAGQBJB",64,0)
 S SRCE=$S($$SLINE(+$P(BNODE,U,1)):$P(BNODE,U,1),1:"")
"RTN","MAGQBJB",65,0)
 I 'SRCE,AGG S SRCE=$S($$SLINE(+$P(BNODE,U,2)):$P(BNODE,U,2),1:"")
"RTN","MAGQBJB",66,0)
 I SRCE D  ; Including logic for P99 alternative BIG file extension.
"RTN","MAGQBJB",67,0)
 . S MAGDEV=$P(^MAG(2005.2,SRCE,0),U,2)
"RTN","MAGQBJB",68,0)
 . S BIG=MAGDEV_$$DIRHASH^MAGFILEB(FILE,SRCE)_$P(FILE,".")_"."_$S($P(BNODE,U,3)="":"BIG",1:$P(BNODE,U,3))
"RTN","MAGQBJB",69,0)
 . Q 
"RTN","MAGQBJB",70,0)
 I FULL="",BIG="",ABS="" D  Q
"RTN","MAGQBJB",71,0)
 . S MSG=$S(('$P(BNODE,U))&('$P(ZNODE,U,4))&('$P(ZNODE,U,4)):"No VistA Cache Source",1:"")
"RTN","MAGQBJB",72,0)
 . S MSG=$S('MSG:"There are no network location references for this image: "_FILE,1:MSG)
"RTN","MAGQBJB",73,0)
 . S RESULT="-11^"_QPTR_"^"_MSG
"RTN","MAGQBJB",74,0)
 . Q
"RTN","MAGQBJB",75,0)
 K MAGFILE1
"RTN","MAGQBJB",76,0)
 S TOFILE=$$WPATH(FILE,JBPTR)_FILE
"RTN","MAGQBJB",77,0)
 S RESULT="1^"_IMGPTR_U_FULL_U_TOFILE_U
"RTN","MAGQBJB",78,0)
 S RESULT=RESULT_JBDEVICE_U_QPTR_U_JBPTR_U_QSN_U_ABS_U_BIG
"RTN","MAGQBJB",79,0)
 Q
"RTN","MAGQBJB",80,0)
WPATH(FILE,CWP) ; Write path of Current Write Platter (CWP)
"RTN","MAGQBJB",81,0)
 Q $P(^MAG(2005.2,CWP,0),"^",2)_$$DIRHASH^MAGFILEB(FILE,CWP)
"RTN","MAGQBJB",82,0)
JBDEV(JBPTR) ; Jukebox Device (drive spec)
"RTN","MAGQBJB",83,0)
 Q $P($G(^MAG(2005.2,JBPTR,0)),"^",2)
"RTN","MAGQBJB",84,0)
SLINE(PTR) ;Check if the share is online
"RTN","MAGQBJB",85,0)
 Q:PTR<1 ""
"RTN","MAGQBJB",86,0)
 Q $S($P($G(^MAG(2005.2,PTR,0)),U,6)=1:1,1:"")
"RTN","MAGQBJH")
0^11^B24245362
"RTN","MAGQBJH",1,0)
MAGQBJH ;WOIFO/PMK/RMP - Copy an image from the Jukebox to the Hard Disk ; 18 Jan 2011 4:57 PM
"RTN","MAGQBJH",2,0)
 ;;3.0;IMAGING;**8,20,39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGQBJH",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGQBJH",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBJH",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBJH",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBJH",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBJH",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBJH",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBJH",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBJH",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBJH",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBJH",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBJH",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBJH",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBJH",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBJH",17,0)
 ;;
"RTN","MAGQBJH",18,0)
 ; RESULT=STATUS^MAGIFN^FROMPATH^TOPATH^FILETYPE^QPTR^VWP^QSN
"RTN","MAGQBJH",19,0)
 ; VWP = VISTA WRITE-LOCATION POINTER, QSN=QUEUE SEQUENCE NUMBER
"RTN","MAGQBJH",20,0)
ENTRY(RESULT,QPTR) ; entry point from ^MAGBMAIN
"RTN","MAGQBJH",21,0)
 N NODE,X,MAGIFN,FILETYPE,MAGXX,STATUS,TODAY,MAGPIECE,MAGREF,MSG
"RTN","MAGQBJH",22,0)
 N FROMPATH,TOPATH,MAGFILE,MAGFILE2,QSN,MSG,PLACE
"RTN","MAGQBJH",23,0)
 S U="^",NODE=^MAGQUEUE(2006.03,QPTR,0),QSN=+$P(NODE,U,9)
"RTN","MAGQBJH",24,0)
 S PLACE=$P(NODE,U,12)
"RTN","MAGQBJH",25,0)
 I "^JBTOHD^PREFET^"'[(U_$P(NODE,U)_U) D  Q
"RTN","MAGQBJH",26,0)
 . S RESULT="-4"_U_QPTR_U_"Not a Jukebox to HardDisk Process"
"RTN","MAGQBJH",27,0)
 S MAGIFN=$P(NODE,U,7),FILETYPE=$P(NODE,U,8)
"RTN","MAGQBJH",28,0)
 S TODAY=$P($$NOW^XLFDT,".",1)
"RTN","MAGQBJH",29,0)
 I "^FULL^ABSTRACT^BIG^"'[("^"_FILETYPE_"^") D  Q
"RTN","MAGQBJH",30,0)
 . S RESULT="-4"_U_QPTR_U_FILETYPE_" Is not a Jukebox to HardDisk Process"
"RTN","MAGQBJH",31,0)
 I $P(^MAG(2005,MAGIFN,0),U,2)="" D  Q
"RTN","MAGQBJH",32,0)
 . I +$P($G(^MAG(2005,MAGIFN,1,0)),U,4)>0 S MSG="Image group parent"
"RTN","MAGQBJH",33,0)
 . E  S MSG="Does not have an image file specified"
"RTN","MAGQBJH",34,0)
 . S RESULT="-5"_U_QPTR_U_MSG
"RTN","MAGQBJH",35,0)
 . K ^MAGQUEUE(2006.03,"F",PLACE,MAGIFN,FILETYPE,QPTR)
"RTN","MAGQBJH",36,0)
 . Q
"RTN","MAGQBJH",37,0)
 D @(FILETYPE_"(PLACE)") ; do either FULL or ABSTRACT
"RTN","MAGQBJH",38,0)
 K ^MAGQUEUE(2006.03,"F",PLACE,MAGIFN,FILETYPE,QPTR)
"RTN","MAGQBJH",39,0)
 K MAGFILE1
"RTN","MAGQBJH",40,0)
 S RESULT=STATUS
"RTN","MAGQBJH",41,0)
 S $P(RESULT,U,8)=QSN
"RTN","MAGQBJH",42,0)
 Q
"RTN","MAGQBJH",43,0)
FULL(PLACE) ; copy a full-size image
"RTN","MAGQBJH",44,0)
 S MAGXX=MAGIFN D VSTNOCP^MAGFILEB
"RTN","MAGQBJH",45,0)
 I (($E(MAGFILE1,1,2)="-1")!('$P(^MAG(2005,MAGIFN,0),"^",5))) D  Q 
"RTN","MAGQBJH",46,0)
 . S STATUS="-3"_U_QPTR_U_"Image IEN:"_MAGIFN_"has no file online"
"RTN","MAGQBJH",47,0)
 S MAGREF=$P(^MAG(2005,MAGIFN,0),"^",3)
"RTN","MAGQBJH",48,0)
 I MAGREF?1N.N D WLSET(.STATUS,MAGIFN,MAGREF,"FULL",PLACE) Q
"RTN","MAGQBJH",49,0)
 S STATUS=$$COPY(PLACE) I +STATUS>0 D  ;
"RTN","MAGQBJH",50,0)
 . S $P(^MAG(2005,MAGIFN,0),"^",9)=TODAY ; update the last access date
"RTN","MAGQBJH",51,0)
 Q 
"RTN","MAGQBJH",52,0)
 ;
"RTN","MAGQBJH",53,0)
ABSTRACT(PLACE) ; copy an image abstract
"RTN","MAGQBJH",54,0)
 S MAGXX=MAGIFN D ABSNOCP^MAGFILEB
"RTN","MAGQBJH",55,0)
 I (($E(MAGFILE1,1,2)="-1")!('$P(^MAG(2005,MAGIFN,0),"^",5))) D  Q
"RTN","MAGQBJH",56,0)
 . S STATUS="-3"_U_QPTR_U_"Image IEN:"_MAGIFN_"has no file online"
"RTN","MAGQBJH",57,0)
 S MAGREF=$P(^MAG(2005,MAGIFN,0),"^",4)
"RTN","MAGQBJH",58,0)
 I MAGREF?1N.N D WLSET(.STATUS,MAGIFN,MAGREF,"ABSTRACT",PLACE) Q
"RTN","MAGQBJH",59,0)
 S STATUS=$$COPY(PLACE) I +STATUS>0 D  ;
"RTN","MAGQBJH",60,0)
 . S $P(^MAG(2005,MAGIFN,0),"^",9)=TODAY ; update the last access date
"RTN","MAGQBJH",61,0)
 Q 
"RTN","MAGQBJH",62,0)
 ;
"RTN","MAGQBJH",63,0)
BIG(PLACE) ; copy a big image
"RTN","MAGQBJH",64,0)
 S MAGXX=MAGIFN D BIGNOCP^MAGFILEB
"RTN","MAGQBJH",65,0)
 I (($E(MAGFILE1,1,2)="-1")!('$P($G(^MAG(2005,MAGIFN,"FBIG")),U,2))) D  Q
"RTN","MAGQBJH",66,0)
 . S STATUS="-3"_U_QPTR_U_"Image IEN:"_MAGIFN_"has no file online"
"RTN","MAGQBJH",67,0)
 S MAGREF=$P(^MAG(2005,MAGIFN,"FBIG"),U)
"RTN","MAGQBJH",68,0)
 I MAGREF?1N.N D WLSET(.STATUS,MAGIFN,MAGREF,"BIG",PLACE) Q
"RTN","MAGQBJH",69,0)
 S STATUS=$$COPY(PLACE) I +STATUS>0 D  ;
"RTN","MAGQBJH",70,0)
 . S $P(^MAG(2005,MAGIFN,0),"^",9)=TODAY ; update the last access date
"RTN","MAGQBJH",71,0)
 Q 
"RTN","MAGQBJH",72,0)
 ;
"RTN","MAGQBJH",73,0)
WLSET(STATUS,MAGIFN,MAGREF,TYPE,PLACE) ;Write Location set already
"RTN","MAGQBJH",74,0)
 N JBREF,JBPATH,CWL,SOURCE,DEST,ALTDEST,ONLINE,PATH
"RTN","MAGQBJH",75,0)
 S $P(^MAG(2005,MAGIFN,0),U,9)=TODAY ; update the last access date
"RTN","MAGQBJH",76,0)
 ; output the warning message
"RTN","MAGQBJH",77,0)
 S JBREF=$S(TYPE="BIG":$P($G(^MAG(2005,MAGIFN,"FBIG")),U,2),1:$P(^MAG(2005,MAGIFN,0),U,5))
"RTN","MAGQBJH",78,0)
 S JBPATH=$P(^MAG(2005.2,JBREF,0),U,2)
"RTN","MAGQBJH",79,0)
 S JBPATH=JBPATH_$$DIRHASH^MAGFILEB(MAGFILE1,JBREF)
"RTN","MAGQBJH",80,0)
 S CWL=$$CWL^MAGBAPI(PLACE)
"RTN","MAGQBJH",81,0)
 S SOURCE=JBPATH_MAGFILE1
"RTN","MAGQBJH",82,0)
 S ONLINE=$P(^MAG(2005.2,MAGREF,0),U,6)
"RTN","MAGQBJH",83,0)
 ;If the current magnetic write location is on line the first
"RTN","MAGQBJH",84,0)
 ;destination path will be to that path and the 2nd path is the 
"RTN","MAGQBJH",85,0)
 ;current write location
"RTN","MAGQBJH",86,0)
 S PATH=$P(^MAG(2005.2,$S(ONLINE:MAGREF,1:CWL),0),U,2)
"RTN","MAGQBJH",87,0)
 S DEST=PATH_$$DIRHASH^MAGFILEB(MAGFILE1,$S(ONLINE:MAGREF,1:CWL))_MAGFILE1
"RTN","MAGQBJH",88,0)
 S:ONLINE ALTDEST=$P(^MAG(2005.2,CWL,0),U,2)_$$DIRHASH^MAGFILEB(MAGFILE1,CWL)_MAGFILE1
"RTN","MAGQBJH",89,0)
 S STATUS="2^"_MAGIFN_U_SOURCE_U_DEST
"RTN","MAGQBJH",90,0)
 S STATUS=STATUS_U_FILETYPE_U_QPTR_U_$S(ONLINE:MAGREF,1:CWL)_U_QSN
"RTN","MAGQBJH",91,0)
 S:ONLINE STATUS=STATUS_U_ALTDEST_U_CWL
"RTN","MAGQBJH",92,0)
 Q
"RTN","MAGQBJH",93,0)
 ;
"RTN","MAGQBJH",94,0)
COPY(PLACE) ; copy an image file from the jukebox to the hard drive
"RTN","MAGQBJH",95,0)
 N MAGREF,MAGDRIVE
"RTN","MAGQBJH",96,0)
 D GETDRIVE(.MAGDRIVE,.MAGREF,PLACE) ;^MAGFILE ; find space to put file
"RTN","MAGQBJH",97,0)
 I MAGREF'?1N.N Q "-4^"_QPTR_"^Current Write Location is not SET"
"RTN","MAGQBJH",98,0)
 I +$P($G(^MAG(2005.2,MAGREF,0)),"^",6)'>0 Q "-4^"_QPTR_"^Current Write Location is OFFLINE"
"RTN","MAGQBJH",99,0)
 S TOPATH=MAGDRIVE_$$DIRHASH^MAGFILEB(MAGFILE1,MAGREF)_MAGFILE1
"RTN","MAGQBJH",100,0)
 S FROMPATH=MAGFILE2
"RTN","MAGQBJH",101,0)
 Q "1"_U_MAGIFN_U_FROMPATH_U_TOPATH_U_FILETYPE_U_QPTR_U_MAGREF
"RTN","MAGQBJH",102,0)
GETDRIVE(DRIVE,MAGREF,PLACE) ; Get the current drive for writing an image
"RTN","MAGQBJH",103,0)
 S MAGREF=$$CWL^MAGBAPI(PLACE)
"RTN","MAGQBJH",104,0)
 S DRIVE=$S('MAGREF:"",1:$P(^MAG(2005.2,MAGREF,0),U,2))
"RTN","MAGQBJH",105,0)
 Q
"RTN","MAGQBJH",106,0)
 ;
"RTN","MAGQBPG1")
0^12^B77258360
"RTN","MAGQBPG1",1,0)
MAGQBPG1 ;WOIFO/RMP - REMOTE Task SERVER Program ; 18 Jan 2011 5:00 PM
"RTN","MAGQBPG1",2,0)
 ;;3.0;IMAGING;**7,8,20,81,39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGQBPG1",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGQBPG1",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBPG1",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBPG1",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBPG1",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBPG1",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBPG1",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBPG1",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBPG1",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBPG1",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBPG1",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBPG1",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBPG1",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBPG1",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBPG1",17,0)
 ;;
"RTN","MAGQBPG1",18,0)
 Q
"RTN","MAGQBPG1",19,0)
ENTRY(RESULT,WSTAT,PROCESS) ;RPC[MAGQ JBS]
"RTN","MAGQBPG1",20,0)
 N X,SYSIEN,SYSNAME,ZNODE,NODE,INDX,CNT,PROC,%,QPTR,QCNT,SHARE,PLACE,SCANDATE
"RTN","MAGQBPG1",21,0)
 S SCANDATE=$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","MAGQBPG1",22,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBPG1",23,0)
 S (SYSIEN,CNT)=0,SYSNAME="",U="^",PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBPG1",24,0)
 S SYSIEN=$O(^MAG(2006.8,"C",PLACE,WSTAT,"")) ;TRUE WORKSTATION NAME
"RTN","MAGQBPG1",25,0)
 I 'SYSIEN S SYSIEN=$O(^MAG(2006.8,"C",PLACE,$$UPPER^MAGQE4(WSTAT),""))
"RTN","MAGQBPG1",26,0)
 I 'SYSIEN D  ;ATTEMPT TO FIND A MATCH FROM LOCAL NAME
"RTN","MAGQBPG1",27,0)
 . N TRY
"RTN","MAGQBPG1",28,0)
 . F TRY=1:1:$L(WSTAT,".") D  Q:SYSIEN?1N.N
"RTN","MAGQBPG1",29,0)
 . . S SYSIEN=$O(^MAG(2006.8,"C",PLACE,$P(WSTAT,".",TRY),""))
"RTN","MAGQBPG1",30,0)
 . . I 'SYSIEN S SYSIEN=$O(^MAG(2006.8,"C",PLACE,$$UPPER^MAGQE4($P(WSTAT,".",TRY)),""))
"RTN","MAGQBPG1",31,0)
 I SYSIEN="" D  Q
"RTN","MAGQBPG1",32,0)
 . S RESULT(0)="-1^This workstation is not currently setup as a Background Processor."
"RTN","MAGQBPG1",33,0)
 . Q
"RTN","MAGQBPG1",34,0)
 S NODE=^MAG(2006.8,SYSIEN,0)
"RTN","MAGQBPG1",35,0)
 S SYSNAME=$P(NODE,U)
"RTN","MAGQBPG1",36,0)
 I SYSNAME="" D  Q
"RTN","MAGQBPG1",37,0)
 . S RESULT(0)="-1^This workstation is not currently setup as a Background Processor."
"RTN","MAGQBPG1",38,0)
 . Q
"RTN","MAGQBPG1",39,0)
 S RESULT(0)="0^BP List^PID: "_$$BASE^XLFUTL($J,10,16)_U_SYSNAME_U_WSTAT_U_$P(^MAG(2006.1,PLACE,0),U,2)
"RTN","MAGQBPG1",40,0)
 S (X,CNT)=0
"RTN","MAGQBPG1",41,0)
 F  S X=$O(^MAG(2005.2,X)) Q:X'?1N.N  S ZNODE=$G(^(X,0)) D
"RTN","MAGQBPG1",42,0)
 . Q:'$P(ZNODE,U,6)  ;1=online
"RTN","MAGQBPG1",43,0)
 . Q:$E($P(ZNODE,U,2),1,2)'="\\"
"RTN","MAGQBPG1",44,0)
 . Q:$P(ZNODE,U,10)'=PLACE
"RTN","MAGQBPG1",45,0)
 . Q:(($P(ZNODE,U,7)'["WORM")&($P(ZNODE,U,7)'="RW"))
"RTN","MAGQBPG1",46,0)
 . S CNT=CNT+1,SHARE=$P(ZNODE,U,2)
"RTN","MAGQBPG1",47,0)
 . I $E(SHARE,$L(SHARE))="\" S SHARE=$E(SHARE,1,$L(SHARE)-1)
"RTN","MAGQBPG1",48,0)
 . S RESULT(CNT)=X_U_SHARE_U_$P(ZNODE,U,8)
"RTN","MAGQBPG1",49,0)
 Q
"RTN","MAGQBPG1",50,0)
SHR(RESULT) ; RPC[MAGQ SHARES]
"RTN","MAGQBPG1",51,0)
 N TMP,INDX,DATA,CNT,SHARE,CWL,VALUE,PLACE
"RTN","MAGQBPG1",52,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBPG1",53,0)
 S (CNT,INDX)=0,U="^",PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBPG1",54,0)
 S CWL=$$CWL^MAGBAPI(PLACE)
"RTN","MAGQBPG1",55,0)
 F  S INDX=$O(^MAG(2005.2,INDX)) Q:INDX'?1N.N  D
"RTN","MAGQBPG1",56,0)
 . S DATA=$G(^MAG(2005.2,INDX,0))
"RTN","MAGQBPG1",57,0)
 . Q:$P(DATA,U,6,7)'["1^MAG"
"RTN","MAGQBPG1",58,0)
 . Q:$P(DATA,U,9)="1"  ;ROUTING SHARE
"RTN","MAGQBPG1",59,0)
 . Q:$P(DATA,U,2)[":"
"RTN","MAGQBPG1",60,0)
 . Q:$P(DATA,U,10)'=PLACE
"RTN","MAGQBPG1",61,0)
 . S SHARE=$P(DATA,U,2)
"RTN","MAGQBPG1",62,0)
 . Q:$E(SHARE,1,2)'="\\"
"RTN","MAGQBPG1",63,0)
 . I $E(SHARE,$L(SHARE))="\" S SHARE=$E(SHARE,1,$L(SHARE)-1)
"RTN","MAGQBPG1",64,0)
 . S SHARE=SHARE_U_$P(DATA,U,8)
"RTN","MAGQBPG1",65,0)
 . Q:$D(TMP(SHARE))
"RTN","MAGQBPG1",66,0)
 . S TMP(SHARE)=INDX
"RTN","MAGQBPG1",67,0)
 S INDX=""
"RTN","MAGQBPG1",68,0)
 F  S INDX=$O(TMP(INDX)) Q:INDX=""  D
"RTN","MAGQBPG1",69,0)
 . S RESULT(CNT)=TMP(INDX)_U_INDX,CNT=CNT+1
"RTN","MAGQBPG1",70,0)
 . S ^TMP("MAGQBP",$J,"SHRLST",CNT-1)=TMP(INDX)_U_INDX
"RTN","MAGQBPG1",71,0)
 K TMP
"RTN","MAGQBPG1",72,0)
 Q
"RTN","MAGQBPG1",73,0)
CNP2(RESULT,IEN,START,STOP,AUTO) ;[MAGQ JBSCN]
"RTN","MAGQBPG1",74,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBPG1",75,0)
 N FNAME,PIECE,ZNODE,NODE2,BNODE,BNAME,PTR,HASH,TEMP,ORDER,RDATE,PLACE,OFFLINE,PLACEOK,GL,END,ACQSITE
"RTN","MAGQBPG1",76,0)
 S (RESULT,GL)="",PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2))),(OFFLINE,PLACEOK)=0
"RTN","MAGQBPG1",77,0)
 I AUTO D
"RTN","MAGQBPG1",78,0)
 . S IEN=+IEN
"RTN","MAGQBPG1",79,0)
 . S ORDER="R"
"RTN","MAGQBPG1",80,0)
 . I START="" S START=$S(IEN>0:IEN,1:$O(^MAG(2005,"A"),-1))
"RTN","MAGQBPG1",81,0)
 . S STOP=$O(^MAG(2005,0))
"RTN","MAGQBPG1",82,0)
 . Q
"RTN","MAGQBPG1",83,0)
 S:START="" START=$O(^MAG(2005,0)) S:STOP="" STOP=$O(^MAG(2005,"A"),-1)
"RTN","MAGQBPG1",84,0)
 S ORDER=$S(START>STOP:"R",1:"F")
"RTN","MAGQBPG1",85,0)
 I (IEN'?1N.N)!IEN=0 D  I IEN="" S RESULT=0 Q
"RTN","MAGQBPG1",86,0)
 . I START=0 S IEN=START Q
"RTN","MAGQBPG1",87,0)
 . I ORDER="R" D
"RTN","MAGQBPG1",88,0)
 . . S I1=+$O(^MAG(2005," "),-1),I2=+$O(^MAG(2005.1," "),-1),END=$S(I1>I2:I1,1:I2)
"RTN","MAGQBPG1",89,0)
 . . S IEN=$S(START>END:START,1:START+1) Q
"RTN","MAGQBPG1",90,0)
 . E  S IEN=START-1
"RTN","MAGQBPG1",91,0)
 . Q
"RTN","MAGQBPG1",92,0)
 S IEN=+IEN
"RTN","MAGQBPG1",93,0)
 F  D SCAN^MAGQBPG1(.IEN,ORDER,.GL) D  Q:((('OFFLINE)&PLACEOK)!('IEN)!($P(RESULT,U,21)="DUPE")!'$G(ACQSITE))
"RTN","MAGQBPG1",94,0)
 . Q:'IEN
"RTN","MAGQBPG1",95,0)
 . S ZNODE=$G(@(GL_IEN_",0)")),ACQSITE=$P($G(@(GL_IEN_",100)")),U,3)
"RTN","MAGQBPG1",96,0)
 . I AUTO,$P(ZNODE,U,11)'="" D  Q
"RTN","MAGQBPG1",97,0)
 . . S $P(RESULT,U,1)=0
"RTN","MAGQBPG1",98,0)
 . . S IEN=0
"RTN","MAGQBPG1",99,0)
 . . Q
"RTN","MAGQBPG1",100,0)
 . S PLACEOK=$S($$PLACE^MAGBAPI(+ACQSITE)=$$PLACE^MAGBAPI($G(DUZ(2))):1,1:"")
"RTN","MAGQBPG1",101,0)
 . I $P(ZNODE,U,2)'="" S OFFLINE=$$IMOFFLN^MAGFILEB($P(ZNODE,U,2))  ; Only check the offline status of image files
"RTN","MAGQBPG1",102,0)
 . I ($D(^MAG(2005.1,IEN,0))&$D(^MAG(2005,IEN,0))) D  Q  ; Image is duplicated in the Archive file
"RTN","MAGQBPG1",103,0)
 . . I $P(^MAG(2005,IEN,0),U,1,8)="^^^^^^^",+$P(^MAG(2005,IEN,0),U,9) K ^MAG(2005,IEN,0) Q
"RTN","MAGQBPG1",104,0)
 . . S FDA(2005,IEN_",",13.5)="1" ; Set Dupe field in the Image File 
"RTN","MAGQBPG1",105,0)
 . . S FDA(2005,IEN_",",13)="1" ; Set IQ field in the Image File  
"RTN","MAGQBPG1",106,0)
 . . D FILE^DIE("I","FDA","MSG") K FDA,MSG
"RTN","MAGQBPG1",107,0)
 . . S FDA(2005.1,IEN_",",13.5)="1" ; Set the Dupe field in the archive file
"RTN","MAGQBPG1",108,0)
 . . S FDA(2005.1,IEN_",",13)="1" ; and set the IQ field in the archive file
"RTN","MAGQBPG1",109,0)
 . . D FILE^DIE("I","FDA","MSG") K FDA,MSG
"RTN","MAGQBPG1",110,0)
 . . S $P(RESULT,U,21)="DUPE"
"RTN","MAGQBPG1",111,0)
 . . S $P(RESULT,U)=IEN
"RTN","MAGQBPG1",112,0)
 . . I $P(ZNODE,U,2)=$P($G(^MAG(2005.1,IEN,0)),U,2) S $P(RESULT,U,2)=$P(ZNODE,U,2) D
"RTN","MAGQBPG1",113,0)
 . . . I $P(RESULT,U,2)="" S $P(RESULT,U,2)="No File Name" Q
"RTN","MAGQBPG1",114,0)
 . . E  S $P(RESULT,U,2)=$P(ZNODE,U,2)_"/"_$P($G(^MAG(2005.1,IEN,0)),U,2) D
"RTN","MAGQBPG1",115,0)
 . . . I $P($P(RESULT,U,2),"/")="" S $P(RESULT,U,2)="No File Name"_$P(RESULT,U,2)
"RTN","MAGQBPG1",116,0)
 . . . I $P($P(RESULT,U,2),"/",2)="" S $P(RESULT,U,2)=$P(RESULT,U,2)_"No File Name"
"RTN","MAGQBPG1",117,0)
 . . . Q
"RTN","MAGQBPG1",118,0)
 . . Q
"RTN","MAGQBPG1",119,0)
 . E  I $P(ZNODE,U,2)'="" S $P(@(GL_IEN_",0)"),U,12)="0"
"RTN","MAGQBPG1",120,0)
 . Q
"RTN","MAGQBPG1",121,0)
 ;  The next statement will stop the BP Verifier cycle because the ien is out of range
"RTN","MAGQBPG1",122,0)
 I $S('IEN:1,((ORDER="F")&(IEN>STOP)):1,((ORDER="R")&(IEN<STOP)):1,1:0) D  Q
"RTN","MAGQBPG1",123,0)
 . S $P(RESULT,U,1)=0
"RTN","MAGQBPG1",124,0)
 . Q
"RTN","MAGQBPG1",125,0)
 S FNAME=$P(ZNODE,U,2)
"RTN","MAGQBPG1",126,0)
 S $P(RESULT,U)=IEN
"RTN","MAGQBPG1",127,0)
 Q:($P(RESULT,U,21)="DUPE")
"RTN","MAGQBPG1",128,0)
 S $P(RESULT,U,19)=$P($P($G(@(GL_IEN_",2)")),U),".")
"RTN","MAGQBPG1",129,0)
 I $P(ZNODE,U,2)'="" D  ;NON-GROUP PARENT
"RTN","MAGQBPG1",130,0)
 . S BNODE=$G(@(GL_IEN_",""FBIG"")"))
"RTN","MAGQBPG1",131,0)
 . I $P(ZNODE,U,5)?1N.N S $P(RESULT,U,3)=$P(ZNODE,U,5)
"RTN","MAGQBPG1",132,0)
 . S:$P(BNODE,U,2)?1N.N $P(RESULT,U,4)=$S($P(BNODE,U,3)'="":"["_$P(BNODE,U,3)_"]",1:"")_$P(BNODE,U,2)
"RTN","MAGQBPG1",133,0)
 . S:$P(ZNODE,U,3)?1N.N $P(RESULT,U,5)=$P(ZNODE,U,3)
"RTN","MAGQBPG1",134,0)
 . S:$P(ZNODE,U,4)?1N.N $P(RESULT,U,6)=$P(ZNODE,U,4)
"RTN","MAGQBPG1",135,0)
 . S:$P(BNODE,U)?1N.N $P(RESULT,U,7)=$S($P(BNODE,U,3)'="":"["_$P(BNODE,U,3)_"]",1:"")_$P(BNODE,U)
"RTN","MAGQBPG1",136,0)
 . S $P(RESULT,U,8)=$$CWL^MAGBAPI(PLACE)
"RTN","MAGQBPG1",137,0)
 . S $P(RESULT,U,2)=FNAME
"RTN","MAGQBPG1",138,0)
 . I $D(@(GL_IEN_",""FBIG"")")),'$P(BNODE,U),'$P(BNODE,U,2) S $P(RESULT,U,22)="EMPTY_FBIG"
"RTN","MAGQBPG1",139,0)
 . Q
"RTN","MAGQBPG1",140,0)
 I '$P($G(@(GL_IEN_",100)")),U,3) S $P(RESULT,U,23)=-1 ;"NO ACQ SITE VALUE"
"RTN","MAGQBPG1",141,0)
 I GL[("^MAG(2005.1,") S $P(RESULT,U,21)="ARCH"
"RTN","MAGQBPG1",142,0)
 E  S $P(RESULT,U,12,17)=$$CHKIMG^MAGQBUT2(IEN)
"RTN","MAGQBPG1",143,0)
 Q
"RTN","MAGQBPG1",144,0)
JPUD(RESULT,JPTR,EXT,IEN) ; RPC[MAGQ JPUD]
"RTN","MAGQBPG1",145,0)
 N TYPE,PIECE,NODE,GL
"RTN","MAGQBPG1",146,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP"),RESULT="0"
"RTN","MAGQBPG1",147,0)
 S TYPE=$$FTYPE^MAGQBPRG(EXT,IEN)
"RTN","MAGQBPG1",148,0)
 S PIECE=$S(TYPE="BIG":2,1:5)
"RTN","MAGQBPG1",149,0)
 S NODE=$S(TYPE="BIG":"FBIG",1:0)
"RTN","MAGQBPG1",150,0)
 I JPTR="0" D  Q:(RESULT<0)
"RTN","MAGQBPG1",151,0)
 . S JPTR=""
"RTN","MAGQBPG1",152,0)
 . S GL=$S($D(^MAG(2005,IEN)):"^MAG(2005,",$D(^MAG(2005.1,IEN)):"^MAG(2005.1,",1:0)
"RTN","MAGQBPG1",153,0)
 . I GL=0 S RESULT="-1" Q
"RTN","MAGQBPG1",154,0)
 . I $D(^MAGQUEUE(2006.033,"B",$P($G(@(GL_IEN_",0)")),U,2))) D  Q
"RTN","MAGQBPG1",155,0)
 . . S RESULT=-2 Q  ;Don't clear the JB pointer if image is on an Offline Platter
"RTN","MAGQBPG1",156,0)
 . . Q
"RTN","MAGQBPG1",157,0)
 . Q
"RTN","MAGQBPG1",158,0)
 S:$D(^MAG(2005,IEN,NODE)) $P(^MAG(2005,IEN,NODE),U,PIECE)=JPTR
"RTN","MAGQBPG1",159,0)
 S:$D(^MAG(2005.1,IEN,NODE)) $P(^MAG(2005.1,IEN,NODE),U,PIECE)=JPTR
"RTN","MAGQBPG1",160,0)
 S RESULT="1"
"RTN","MAGQBPG1",161,0)
 Q
"RTN","MAGQBPG1",162,0)
VCUD(RESULT,VCPTR,EXT,IEN) ; RPC[MAGQ VCUD]
"RTN","MAGQBPG1",163,0)
 N TYPE,PIECE,NODE
"RTN","MAGQBPG1",164,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP"),RESULT="0"
"RTN","MAGQBPG1",165,0)
 S TYPE=$$FTYPE^MAGQBPRG(EXT,IEN)
"RTN","MAGQBPG1",166,0)
 S PIECE=$S(TYPE="BIG":1,TYPE="ABS":4,1:3)
"RTN","MAGQBPG1",167,0)
 S NODE=$S(TYPE="BIG":"FBIG",1:0)
"RTN","MAGQBPG1",168,0)
 S:VCPTR="0" VCPTR=""
"RTN","MAGQBPG1",169,0)
 S:$D(^MAG(2005,IEN,NODE)) $P(^MAG(2005,IEN,NODE),U,PIECE)=VCPTR
"RTN","MAGQBPG1",170,0)
 S:$D(^MAG(2005.1,IEN,NODE)) $P(^MAG(2005.1,IEN,NODE),U,PIECE)=VCPTR
"RTN","MAGQBPG1",171,0)
 S RESULT="1"
"RTN","MAGQBPG1",172,0)
 Q
"RTN","MAGQBPG1",173,0)
DFNIQ(RESULT,INPUT,SEND,PLACE,APP) ;
"RTN","MAGQBPG1",174,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBPG1",175,0)
 N LOC,CNT,Y,XMSUB
"RTN","MAGQBPG1",176,0)
 S U="^",RESULT="1"
"RTN","MAGQBPG1",177,0)
 S CNT=+$O(^TMP($J,"MAGQDFN",PLACE,APP,""),-1)
"RTN","MAGQBPG1",178,0)
 I CNT<2 D
"RTN","MAGQBPG1",179,0)
 . S LOC=$$KSP^XUPARAM("WHERE")
"RTN","MAGQBPG1",180,0)
 . S ^TMP($J,"MAGQDFN",PLACE,APP,1)="            SITE: "_LOC
"RTN","MAGQBPG1",181,0)
 . S ^TMP($J,"MAGQDFN",PLACE,APP,2)="            DATE: "_$$FMTE^XLFDT($$NOW^XLFDT)_" "_$G(^XMB("TIMEZONE"))
"RTN","MAGQBPG1",182,0)
 . S CNT=2 Q
"RTN","MAGQBPG1",183,0)
 I SEND="1" D
"RTN","MAGQBPG1",184,0)
 . S RESULT=$$SUBCHK^XMGAPI0(INPUT,0)
"RTN","MAGQBPG1",185,0)
 . Q:$P(RESULT,U)
"RTN","MAGQBPG1",186,0)
 . S XMSUB=INPUT
"RTN","MAGQBPG1",187,0)
 . N XMTEXT,INTERVAL,XMDUZ,XMZ
"RTN","MAGQBPG1",188,0)
 . S INTERVAL=$$GETMI^MAGQBUT5(XMSUB,PLACE)
"RTN","MAGQBPG1",189,0)
 . I $$FMADD^XLFDT(+$P(INTERVAL,"^",2),"",+$P(INTERVAL,U,1),"","")>$$NOW^XLFDT D  Q
"RTN","MAGQBPG1",190,0)
 . . K ^TMP($J,"MAGQDFN",PLACE,APP) Q
"RTN","MAGQBPG1",191,0)
 . S XMTEXT="^TMP($J,""MAGQDFN"",PLACE,APP)"
"RTN","MAGQBPG1",192,0)
 . D:$$PROD^XUPROD("1") ADDMG^MAGQBUT5(INPUT,.XMY,PLACE)
"RTN","MAGQBPG1",193,0)
 . S XMY(DUZ)="",XMDUZ=DUZ,XMY(XMDUZ)=""
"RTN","MAGQBPG1",194,0)
 . S XMID=$G(DUZ) S:'XMID XMID=.5
"RTN","MAGQBPG1",195,0)
 . S XMINSTR("FLAGS")="I",XMINSTR("FROM")="VistA Imaging "_APP
"RTN","MAGQBPG1",196,0)
 . D SENDMSG^XMXAPI(XMID,XMSUB,XMTEXT,.XMY,.XMINSTR,.XMZ,)
"RTN","MAGQBPG1",197,0)
 . K ^TMP($J,"MAGQDFN",PLACE,APP)
"RTN","MAGQBPG1",198,0)
 . I $G(XMERR) M XMERR=^TMP("XMERR",$J) K XMERR
"RTN","MAGQBPG1",199,0)
 . K ^TMP($J,"MAGQDFN",PLACE,APP)
"RTN","MAGQBPG1",200,0)
 . D UDMI^MAGQBUT5(INPUT,PLACE) Q
"RTN","MAGQBPG1",201,0)
 E  S CNT=CNT+1,^TMP($J,"MAGQDFN",PLACE,APP,CNT)=INPUT
"RTN","MAGQBPG1",202,0)
 S $P(RESULT,U)=$S($P(RESULT,U):"1",1:0)
"RTN","MAGQBPG1",203,0)
 K XMY,XMINSTR,XMID
"RTN","MAGQBPG1",204,0)
 Q
"RTN","MAGQBPG1",205,0)
SCAN(IEN,ORDER,GB) ; Find the next image spanning the Image and the Image Archive file
"RTN","MAGQBPG1",206,0)
 I IEN,GB="^MAG(2005,",$D(^MAG(2005.1,IEN)) D  Q
"RTN","MAGQBPG1",207,0)
 . S IEN=IEN,GB="^MAG(2005.1," Q
"RTN","MAGQBPG1",208,0)
 N I1,I2
"RTN","MAGQBPG1",209,0)
 I $G(ORDER)="F" D 
"RTN","MAGQBPG1",210,0)
 . S I1=$O(^MAG(2005,IEN)),I1=$S(I1:I1,1:"")
"RTN","MAGQBPG1",211,0)
 . S I2=$O(^MAG(2005.1,IEN)),I2=$S(I2:I2,1:"")
"RTN","MAGQBPG1",212,0)
 . I I1,'I2 S IEN=I1,GB="^MAG(2005," Q
"RTN","MAGQBPG1",213,0)
 . I I2,'I1 S IEN=I2,GB="^MAG(2005.1," Q
"RTN","MAGQBPG1",214,0)
 . S GB=$S(I1>I2:"^MAG(2005.1,",1:"^MAG(2005,")
"RTN","MAGQBPG1",215,0)
 . S IEN=$S(I1>I2:I2,1:I1)
"RTN","MAGQBPG1",216,0)
 . Q
"RTN","MAGQBPG1",217,0)
 E  D  ;Reverse
"RTN","MAGQBPG1",218,0)
 . S I1=$O(^MAG(2005,IEN),-1),I1=$S(I1:I1,1:"")
"RTN","MAGQBPG1",219,0)
 . S I2=$O(^MAG(2005.1,IEN),-1),I2=$S(I2:I2,1:"")
"RTN","MAGQBPG1",220,0)
 . I I1,'I2 S IEN=I1,GB="^MAG(2005," Q
"RTN","MAGQBPG1",221,0)
 . I I2,'I1 S IEN=I2,GB="^MAG(2005.1," Q
"RTN","MAGQBPG1",222,0)
 . S GB=$S(I1<I2:"^MAG(2005.1,",1:"^MAG(2005,")
"RTN","MAGQBPG1",223,0)
 . S IEN=$S(I1<I2:I2,1:I1)
"RTN","MAGQBPG1",224,0)
 . Q
"RTN","MAGQBPG1",225,0)
 S IEN=$S('IEN:"",1:IEN)
"RTN","MAGQBPG1",226,0)
 Q
"RTN","MAGQBPG2")
0^13^B21016522
"RTN","MAGQBPG2",1,0)
MAGQBPG2 ;WCIOFO - TS RMP Magnetic Server Purge processes ; 18 Jan 2011 5:03 PM
"RTN","MAGQBPG2",2,0)
 ;;3.0;IMAGING;**8,20,39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGQBPG2",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGQBPG2",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBPG2",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBPG2",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBPG2",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBPG2",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBPG2",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBPG2",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBPG2",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBPG2",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBPG2",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBPG2",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBPG2",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBPG2",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBPG2",17,0)
 ;;
"RTN","MAGQBPG2",18,0)
 Q
"RTN","MAGQBPG2",19,0)
CNP(RESULT,IEN) ; [MAGQ PCHKN]
"RTN","MAGQBPG2",20,0)
 N FNAME,PIECE,ZNODE,BNODE,BNAME,PTR,HASH,X
"RTN","MAGQBPG2",21,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBPG2",22,0)
 S IEN=+IEN,RESULT="^^^",U="^"
"RTN","MAGQBPG2",23,0)
 F  S IEN=$O(^MAG(2005,IEN)) Q:IEN'?1N.N  D  Q:RESULT'="^^^"
"RTN","MAGQBPG2",24,0)
 . S ZNODE=$G(^MAG(2005,IEN,0))
"RTN","MAGQBPG2",25,0)
 . S FNAME=$P(ZNODE,U,2)
"RTN","MAGQBPG2",26,0)
 . I (FNAME["\")!(FNAME[":") D
"RTN","MAGQBPG2",27,0)
 . . S FNAME=$$FNX(FNAME)
"RTN","MAGQBPG2",28,0)
 . . S $P(^MAG(2005,IEN,0),U,2)=FNAME
"RTN","MAGQBPG2",29,0)
 . Q:$P(ZNODE,U,2)=""  ;PROBABLE GROUP HEAD
"RTN","MAGQBPG2",30,0)
 . S BNODE=$G(^MAG(2005,IEN,"FBIG"))
"RTN","MAGQBPG2",31,0)
 . S PTR=$P(ZNODE,U,3) I PTR?1N.N D
"RTN","MAGQBPG2",32,0)
 . . S HASH=$P(^MAG(2005.2,PTR,0),U,8)
"RTN","MAGQBPG2",33,0)
 . . S $P(^MAG(2005,IEN,0),U,3)=$$SHNAM^MAGQBPRG($P(^MAG(2005.2,PTR,0),U,2),HASH)
"RTN","MAGQBPG2",34,0)
 . . S $P(RESULT,"^")=$$JBPATH^MAGQBPRG(FNAME,PTR)
"RTN","MAGQBPG2",35,0)
 . S PTR=$P(ZNODE,U,4) I PTR?1N.N D
"RTN","MAGQBPG2",36,0)
 . . S HASH=$P(^MAG(2005.2,PTR,0),U,8)
"RTN","MAGQBPG2",37,0)
 . . S $P(^MAG(2005,IEN,0),U,4)=$$SHNAM^MAGQBPRG($P(^MAG(2005.2,PTR,0),U,2),HASH)
"RTN","MAGQBPG2",38,0)
 . . S $P(RESULT,U,2)=$$JBPATH^MAGQBPRG($P(FNAME,".")_".ABS",PTR)
"RTN","MAGQBPG2",39,0)
 . S PTR=$P(BNODE,U) I PTR?1N.N D
"RTN","MAGQBPG2",40,0)
 . . S HASH=$P(^MAG(2005.2,PTR,0),U,8)
"RTN","MAGQBPG2",41,0)
 . . S $P(^MAG(2005,IEN,"FBIG"),U)=$$SHNAM^MAGQBPRG($P(^MAG(2005.2,PTR,0),U,2),HASH)
"RTN","MAGQBPG2",42,0)
 . . S BNAME=$P(FNAME,".")_".BIG"
"RTN","MAGQBPG2",43,0)
 . . S $P(RESULT,"^",3)=$$JBPATH^MAGQBPRG(BNAME,PTR)
"RTN","MAGQBPG2",44,0)
 . I RESULT'="^^^" S $P(RESULT,U,4)=IEN  ;IEN
"RTN","MAGQBPG2",45,0)
 Q
"RTN","MAGQBPG2",46,0)
FNX(NAME) ;FIX FILENAME
"RTN","MAGQBPG2",47,0)
 I NAME[":" S NAME=$P(NAME,":",$L(NAME,":"))
"RTN","MAGQBPG2",48,0)
 I NAME["\" S NAME=$P(NAME,"\",$L(NAME,"\"))
"RTN","MAGQBPG2",49,0)
 Q NAME
"RTN","MAGQBPG2",50,0)
CNPT ;
"RTN","MAGQBPG2",51,0)
 N IEN,RESULT,%
"RTN","MAGQBPG2",52,0)
 S IEN=0
"RTN","MAGQBPG2",53,0)
 D NOW^%DTC
"RTN","MAGQBPG2",54,0)
 F  D CNP(.RESULT,.IEN) W:RESULT[":" !,RESULT Q:IEN'?1N.N  D
"RTN","MAGQBPG2",55,0)
 . S IEN=$P(RESULT,"^",4)
"RTN","MAGQBPG2",56,0)
 Q
"RTN","MAGQBPG2",57,0)
PGEPAR(RESULT) ; RPC[MAGQBP PARM]
"RTN","MAGQBPG2",58,0)
 ;; RECORD PurgeParam
"RTN","MAGQBPG2",59,0)
 ;; Status^ABS^FULL^BIG^FilePrefix^EXPRESSPURGE^PurgeBy^PhotoID^Minimum
"RTN","MAGQBPG2",60,0)
 ;; FULL:8,BIG:22,ABS:23,EXPRESSP:60.2,PURGEBY:60.1
"RTN","MAGQBPG2",61,0)
 N ABS,FULL,BIG,PREFIX,NODE3,EXPRESSP,PURGEBY,PREFIX,BIG,MINIMUM
"RTN","MAGQBPG2",62,0)
 N FILE,PLACE,FIELD,FLAGS,ARR,X,PHOTOID,TEMP
"RTN","MAGQBPG2",63,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBPG2",64,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBPG2",65,0)
 S NODE3=$G(^MAG(2006.1,PLACE,3))
"RTN","MAGQBPG2",66,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBPG2",67,0)
 S U="^"
"RTN","MAGQBPG2",68,0)
 S FILE=2006.1,FIELD="8;22;23;24;60.2;60.1",FLAGS="E"
"RTN","MAGQBPG2",69,0)
 D GETS^DIQ(FILE,PLACE,FIELD,FLAGS,"ARR","ERR")
"RTN","MAGQBPG2",70,0)
 S FULL=+ARR(2006.1,PLACE_",",8,"E")
"RTN","MAGQBPG2",71,0)
 S ABS=+ARR(2006.1,PLACE_",",23,"E")
"RTN","MAGQBPG2",72,0)
 S BIG=+ARR(2006.1,PLACE_",",22,"E")
"RTN","MAGQBPG2",73,0)
 S PHOTOID=+ARR(2006.1,PLACE_",",24,"E")
"RTN","MAGQBPG2",74,0)
 S EXPRESSP=ARR(2006.1,PLACE_",",60.2,"E")
"RTN","MAGQBPG2",75,0)
 S PREFIX=$$INIS(PLACE)
"RTN","MAGQBPG2",76,0)
 S PURGEBY=ARR(2006.1,PLACE_",",60.1,"E")
"RTN","MAGQBPG2",77,0)
 S:PURGEBY="" PURGEBY="DATE ACCESSED"
"RTN","MAGQBPG2",78,0)
 S MINIMUM=FULL F TEMP=ABS,BIG,PHOTOID S:MINIMUM>TEMP MINIMUM=TEMP
"RTN","MAGQBPG2",79,0)
 S RESULT="1"_U_ABS_U_FULL_U_BIG_U_PREFIX_U_EXPRESSP_U_PURGEBY_U_PHOTOID_U_MINIMUM
"RTN","MAGQBPG2",80,0)
 K ARR
"RTN","MAGQBPG2",81,0)
 Q
"RTN","MAGQBPG2",82,0)
 ;;
"RTN","MAGQBPG2",83,0)
PGEUD(RESULT,FILENAME,EXT,IEN,DEVICE) ; RPC[MAGQBP UPDATE]
"RTN","MAGQBPG2",84,0)
 N FTYPE,NODE,PIECE,PLACE,X
"RTN","MAGQBPG2",85,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBPG2",86,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBPG2",87,0)
 S RESULT="0",FTYPE=$$FTYPE^MAGQBPRG(EXT,IEN)
"RTN","MAGQBPG2",88,0)
 S NODE=$S(FTYPE="BIG":"FBIG",1:0)
"RTN","MAGQBPG2",89,0)
 S:DEVICE="JB" PIECE=$S(FTYPE="ABS":5,FTYPE="BIG":2,FTYPE="FULL":5,FTYPE="PHOTOID":5,1:0)
"RTN","MAGQBPG2",90,0)
 S:DEVICE="NET" PIECE=$S(FTYPE="ABS":4,FTYPE="BIG":1,FTYPE="FULL":3,FTYPE="PHOTOID":3,1:0)
"RTN","MAGQBPG2",91,0)
 I PIECE=0 D ELOG^MAGQBPRG(NODE,FTYPE,"RAID pointer indeterminate") Q
"RTN","MAGQBPG2",92,0)
 S RESULT="1"
"RTN","MAGQBPG2",93,0)
 S:$D(^MAG(2005,IEN,NODE)) $P(^MAG(2005,IEN,NODE),U,PIECE)=""
"RTN","MAGQBPG2",94,0)
 S:$D(^MAG(2005.1,IEN,NODE)) $P(^MAG(2005.1,IEN,NODE),U,PIECE)=""
"RTN","MAGQBPG2",95,0)
 Q
"RTN","MAGQBPG2",96,0)
INIS(PLACE) ;
"RTN","MAGQBPG2",97,0)
 N ARRY,CNT,SUB,RESULT
"RTN","MAGQBPG2",98,0)
 S ARRY($P($G(^MAG(2006.1,PLACE,0)),"^",2))=""
"RTN","MAGQBPG2",99,0)
 S CNT=0
"RTN","MAGQBPG2",100,0)
 F  S CNT=$O(^MAG(2006.1,PLACE,4,CNT)) Q:CNT'?1N.N  D
"RTN","MAGQBPG2",101,0)
 . S ARRY(^MAG(2006.1,PLACE,4,CNT,0))=""
"RTN","MAGQBPG2",102,0)
 S (SUB,RESULT)=""
"RTN","MAGQBPG2",103,0)
 F  S SUB=$O(ARRY(SUB)) Q:SUB=""  D
"RTN","MAGQBPG2",104,0)
 . S RESULT=$S(RESULT="":SUB,1:(RESULT_","_SUB))
"RTN","MAGQBPG2",105,0)
 K ARRY
"RTN","MAGQBPG2",106,0)
 Q RESULT
"RTN","MAGQBPRG")
0^14^B56526255
"RTN","MAGQBPRG",1,0)
MAGQBPRG ;WOIOFO/RMP - Magnetic Server Purge processes ; 24 Jan 2011 3:55 PM
"RTN","MAGQBPRG",2,0)
 ;;3.0;IMAGING;**7,3,8,20,81,39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGQBPRG",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGQBPRG",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBPRG",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBPRG",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBPRG",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBPRG",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBPRG",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBPRG",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBPRG",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBPRG",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBPRG",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBPRG",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBPRG",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBPRG",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBPRG",17,0)
 ;;
"RTN","MAGQBPRG",18,0)
 Q
"RTN","MAGQBPRG",19,0)
FILEREF(RESULT,FILEPATH,FNAM,EXT,NETLOC) ; RPC[MAGQBP FREF]
"RTN","MAGQBPRG",20,0)
 ;VALIDATES THAT THE FILEPATH IS CONSISTENT WITH VISTA MAGFILE REFERENCE
"RTN","MAGQBPRG",21,0)
 ;SET THE SECOND PIECE TO "PACS" IF IT REPRESENTS DICOM
"RTN","MAGQBPRG",22,0)
 ;VALIDATES THAT A JUKEBOX POINTER EXISTS
"RTN","MAGQBPRG",23,0)
 ;RESULT VALUES
"RTN","MAGQBPRG",24,0)
 ;PIECE  1:-3 = FOREIGN FILE, DO NOT PURGE
"RTN","MAGQBPRG",25,0)
 ;         -2 = QUEUED FOR JUKEBOX COPY, DO NOT PURGE
"RTN","MAGQBPRG",26,0)
 ;         -1 = DO NOT PURGE
"RTN","MAGQBPRG",27,0)
 ;        **0 = PURGE('MAG 2005 ENTRY)!('JUKEBOX PTRS )
"RTN","MAGQBPRG",28,0)
 ;          1 = PURGE GIVEN NORMAL DATE CRITERIA (NDC) + CONFIRMED ON JB
"RTN","MAGQBPRG",29,0)
 ;        **2 = PURGE GIVEN NDC IF TGA PRESENT
"RTN","MAGQBPRG",30,0)
 ;          3 = PURGE IF FILE IS AT ALTERNATE NETWORK LOCATION SITE
"RTN","MAGQBPRG",31,0)
 ;              ELSE PURGE IF AGED & UPDATE FILE REFERENCES
"RTN","MAGQBPRG",32,0)
 ;        **4 = (**NA**)AGE PURGE IF ON JUKEBOX, UPDATE FILE REFERENCES
"RTN","MAGQBPRG",33,0)
 ;              ELSE UPDATE FILEREFENCES, QUEUE JUKEBOX COPY
"RTN","MAGQBPRG",34,0)
 ;          5 = PURGE IF AT ALTERNATE SITE,QUEUE JUKEBOX IF NOT ON JB
"RTN","MAGQBPRG",35,0)
 ;        **6 = PURGE GIVEN NORMAL DATE CRITERIA
"RTN","MAGQBPRG",36,0)
 ;PIECE   ** 2:  FILETYPE
"RTN","MAGQBPRG",37,0)
 ;                   0 = foreign
"RTN","MAGQBPRG",38,0)
 ;                   1 = abstract
"RTN","MAGQBPRG",39,0)
 ;                   2 = full
"RTN","MAGQBPRG",40,0)
 ;                   3 = big
"RTN","MAGQBPRG",41,0)
 ;                   4 = photo id
"RTN","MAGQBPRG",42,0)
 ;PIECE    3: RECORD CATEGORY
"RTN","MAGQBPRG",43,0)
 ;         1 = 'NO 2005 ENTRY
"RTN","MAGQBPRG",44,0)
 ;       **2 = RADIOLOGY HOLD
"RTN","MAGQBPRG",45,0)
 ;         3 = NO JUKEBOX/JUKEBOX PTRS
"RTN","MAGQBPRG",46,0)
 ;         4 = JUKEBOX - NO JUKEBOX PTRS (P/EXCEPT)ELSE QUEUE
"RTN","MAGQBPRG",47,0)
 ;         5 = JUKEBOX/JUKEBOX PTRS, NO CACHE PTRS,PURGE IF CONFIRMED
"RTN","MAGQBPRG",48,0)
 ;         6 = JUKEBOX/JUKEBOX PTRS, WRONG CACHE PTRS PURGE IF AT ALT
"RTN","MAGQBPRG",49,0)
 ;         7 = JUKEBOX/JUKEBOX PTRS, NO CACHE PTRS, FIX PTRS
"RTN","MAGQBPRG",50,0)
 ;         8 = JUKEBOX/JUKEBOX PTRS, CACHE PTRS, AGE (IF CONFIRMED)
"RTN","MAGQBPRG",51,0)
 ;         9 = RECORD NOT IN THE IMAGE FILE
"RTN","MAGQBPRG",52,0)
 ;        10 = FOREIGN IMAGE FILE
"RTN","MAGQBPRG",53,0)
 ;        11 = NOT AN IMAGE FILE
"RTN","MAGQBPRG",54,0)
 ;        12 = FILE LOCATION NOT VALID 
"RTN","MAGQBPRG",55,0)
 ;        13 = DELETE 2005 ENTRY (LAST LOCATION REFERENCED)
"RTN","MAGQBPRG",56,0)
 ;        14 = Duplicate 2005/2005.1 entry
"RTN","MAGQBPRG",57,0)
 ;        15 = Foreign Place
"RTN","MAGQBPRG",58,0)
 ;        16 = Record in Archive file
"RTN","MAGQBPRG",59,0)
 ;        17 = Jukebox offline
"RTN","MAGQBPRG",60,0)
 N FILEXT,IEN,SITEID,MAGXX,MAGFILE,MAGFILE1,MAGFILE2,RIEN,ZNODE
"RTN","MAGQBPRG",61,0)
 N FTYPE,CPTR,JBPTR,CPOK,BNODE,ALTPATH,NMSPC,PLACE,XX,FT
"RTN","MAGQBPRG",62,0)
 N X S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBPRG",63,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBPRG",64,0)
 S U="^",(MAGFILE2,RESULT)=""
"RTN","MAGQBPRG",65,0)
 S FNAM=$$UPPER^MAGQE4(FNAM)
"RTN","MAGQBPRG",66,0)
 S ^TMP("MAGQ",$J,"PRG","LAST")=FILEPATH_U_FNAM_U_EXT_U_NETLOC
"RTN","MAGQBPRG",67,0)
 I FNAM'?1.5A1.13N1"."1.3E  D  Q  ;LATER ADD EXT VERIFY USING 2005.02
"RTN","MAGQBPRG",68,0)
 . D ELOG(FNAM,FILEPATH,"Not a VistA Imaging file") S RESULT="-3^0^11" Q  ;'IMAGE FILE
"RTN","MAGQBPRG",69,0)
 S SITEID=$$UPPER^MAGQE4($$INIS^MAGQBPG2(PLACE))
"RTN","MAGQBPRG",70,0)
 S NMSPC=$TR($P(FNAM,"."),"0123456789","")
"RTN","MAGQBPRG",71,0)
 S FILEPATH=$$UPPER^MAGQE4(FILEPATH)
"RTN","MAGQBPRG",72,0)
 I SITEID'[NMSPC D ELOG(FNAM,FILEPATH,"Foreign Image file") S RESULT="-3^0^10" Q  ;FOREIGN FILE
"RTN","MAGQBPRG",73,0)
 S IEN=$O(^MAG(2005,"F",$P(FNAM,"."),""))
"RTN","MAGQBPRG",74,0)
 I 'IEN  S IEN=$O(^MAG(2005.1,"F",$P(FNAM,"."),""))
"RTN","MAGQBPRG",75,0)
 ; Patch 39 - added logging
"RTN","MAGQBPRG",76,0)
 I 'IEN D  Q
"RTN","MAGQBPRG",77,0)
 . D ELOG(FNAM,FILEPATH,"Record neither in 2005 nor 2005.1")
"RTN","MAGQBPRG",78,0)
 . S RESULT="-3^0^9^^^"_IEN
"RTN","MAGQBPRG",79,0)
 . Q
"RTN","MAGQBPRG",80,0)
 S FTYPE=$$FTYPE(EXT,IEN)
"RTN","MAGQBPRG",81,0)
 S FT=$S(FTYPE="ABS":"1",FTYPE="FULL":"2",FTYPE="BIG":"3",FTYPE="PHOTOID":"4",1:"2")
"RTN","MAGQBPRG",82,0)
 S JBPTR=$$JBPTR(IEN,FTYPE)
"RTN","MAGQBPRG",83,0)
 ;PURGE UNCONDITIONALLY IF NO 2005 or 2005.1 ENTRY
"RTN","MAGQBPRG",84,0)
 I '$D(^MAG(2005,IEN,0)) D  Q
"RTN","MAGQBPRG",85,0)
 . I $D(^MAG(2005.1,IEN,0)) D  Q
"RTN","MAGQBPRG",86,0)
 . . I ('JBPTR&($P($G(^MAG(2005.2,+$$JBPTR^MAGBAPI(PLACE),0)),U,6)="1"))  D
"RTN","MAGQBPRG",87,0)
 . . . S XX=$$JUKEBOX^MAGBAPI(IEN,PLACE)
"RTN","MAGQBPRG",88,0)
 . . . S RESULT="-2^"_FT_"^9^^^"_IEN
"RTN","MAGQBPRG",89,0)
 . . . Q
"RTN","MAGQBPRG",90,0)
 . . E  D 
"RTN","MAGQBPRG",91,0)
 . . . I JBPTR S RESULT="5^"_FT_"^16^"_$$JBPATH(FNAM,JBPTR)_U_$$JBPATH(FNAM,JBPTR)_U_IEN
"RTN","MAGQBPRG",92,0)
 . . . E  S RESULT="-1^"_FT_"^17"
"RTN","MAGQBPRG",93,0)
 . . . Q
"RTN","MAGQBPRG",94,0)
 . E  S RESULT="1^"_FT_"^9^^^"_IEN
"RTN","MAGQBPRG",95,0)
 . Q
"RTN","MAGQBPRG",96,0)
 I PLACE'=$$PLACE^MAGBAPI(+$P($G(^MAG(2005,IEN,100)),U,3)) D  Q
"RTN","MAGQBPRG",97,0)
 . S RESULT="-3^"_FT_"^15" Q  ;Foreign Place
"RTN","MAGQBPRG",98,0)
 S ZNODE=^MAG(2005,IEN,0)
"RTN","MAGQBPRG",99,0)
 I $P(ZNODE,U,12)="1" S RESULT="-1^"_FT_"^14" Q  ; Duplicate Image/Archive entry 
"RTN","MAGQBPRG",100,0)
 S BNODE=$S(FTYPE="BIG":$G(^MAG(2005,IEN,"FBIG")),1:"")
"RTN","MAGQBPRG",101,0)
 ; NEXT PROCESS MAGNETIC PTR~LESS
"RTN","MAGQBPRG",102,0)
 S CPTR=$$CHKCP($S(FTYPE="BIG":BNODE,1:ZNODE),FTYPE,EXT)
"RTN","MAGQBPRG",103,0)
 I 'CPTR D  Q
"RTN","MAGQBPRG",104,0)
 . D CPUPD(FTYPE,IEN,FILEPATH,FNAM,EXT)
"RTN","MAGQBPRG",105,0)
 . I 'JBPTR,$P($G(^MAG(2005.2,+$$JBPTR^MAGBAPI(PLACE),0)),U,6)="1" D
"RTN","MAGQBPRG",106,0)
 . . S XX=$$JUKEBOX^MAGBAPI(IEN,PLACE)
"RTN","MAGQBPRG",107,0)
 . S RESULT="-1^"_FT_"^7^^"_JBPTR_U_IEN ;$S(JBPTR:JBPTR,1:XX)_U_IEN
"RTN","MAGQBPRG",108,0)
 S CPOK=$S('CPTR:0,1:$$CPOK(FTYPE,.ALTPATH,FILEPATH,IEN))
"RTN","MAGQBPRG",109,0)
 S ALTPATH=ALTPATH_FNAM
"RTN","MAGQBPRG",110,0)
 I 'CPOK,JBPTR D  Q
"RTN","MAGQBPRG",111,0)
 . S RESULT="3^"_FT_"^6^"_ALTPATH_U_$$JBPATH(FNAM,JBPTR)_U_IEN
"RTN","MAGQBPRG",112,0)
 I 'JBPTR D  Q
"RTN","MAGQBPRG",113,0)
 . I $P($G(^MAG(2005.2,+$$JBPTR^MAGBAPI(PLACE),0)),U,6)="1" D
"RTN","MAGQBPRG",114,0)
 . . S XX=$$JUKEBOX^MAGBAPI(IEN,PLACE)
"RTN","MAGQBPRG",115,0)
 . . S RESULT="-1^"_FT_"^7^^"_JBPTR_U_IEN ;$S(JBPTR:JBPTR,1:XX)_U_IEN
"RTN","MAGQBPRG",116,0)
 . . Q
"RTN","MAGQBPRG",117,0)
 . E  S RESULT="-1^"_FT_"^17"
"RTN","MAGQBPRG",118,0)
 . Q
"RTN","MAGQBPRG",119,0)
 S RESULT="1^"_FT_"^8^^"_$$JBPATH(FNAM,JBPTR)_U_IEN
"RTN","MAGQBPRG",120,0)
 Q
"RTN","MAGQBPRG",121,0)
 ;
"RTN","MAGQBPRG",122,0)
LASTNP(TYPE) ;
"RTN","MAGQBPRG",123,0)
 I TYPE="BIG" Q $S($P(ZNODE,U,3,4)="^":1,1:0)
"RTN","MAGQBPRG",124,0)
 I TYPE="ABS" Q $S((($P(ZNODE,U,3)="")&($P(BNODE,U)="")):1,1:0)
"RTN","MAGQBPRG",125,0)
 Q $S((($P(ZNODE,U,4)="")&($P(BNODE,U)="")):1,1:0)
"RTN","MAGQBPRG",126,0)
JBPATH(FN,NL) ;
"RTN","MAGQBPRG",127,0)
 Q $P($G(^MAG(2005.2,NL,0)),U,2)_$$DIRHASH^MAGFILEB(FN,NL)_FN
"RTN","MAGQBPRG",128,0)
FTYPE(FEXT,IEN) ;
"RTN","MAGQBPRG",129,0)
 ; Patch 39 : checking for ABS in FULL
"RTN","MAGQBPRG",130,0)
 N FILE
"RTN","MAGQBPRG",131,0)
 S FILE=$S($D(^MAG(2005,IEN,0)):"2005",1:"2005.1")
"RTN","MAGQBPRG",132,0)
 I $P($G(^MAG(FILE,IEN,40)),U,3)=$O(^MAG(2005.83,"B","PHOTO ID","")) Q "PHOTOID"
"RTN","MAGQBPRG",133,0)
 I $$UPPER^MAGQE4($P($G(^MAG(FILE,IEN,0)),U,2))[".ABS" Q "FULL"
"RTN","MAGQBPRG",134,0)
 S FEXT=$$UPPER^MAGQE4(FEXT)
"RTN","MAGQBPRG",135,0)
 I "^ABS^"[("^"_FEXT_"^") Q "ABS"
"RTN","MAGQBPRG",136,0)
 I "^BIG^"[("^"_FEXT_"^") Q "BIG"
"RTN","MAGQBPRG",137,0)
 I "^"_$P($G(^MAG(FILE,IEN,"FBIG")),U,3)_"^"[("^"_FEXT_"^") Q "BIG"
"RTN","MAGQBPRG",138,0)
 Q "FULL"
"RTN","MAGQBPRG",139,0)
CHKCP(NODE,TYPE,EXT) ;
"RTN","MAGQBPRG",140,0)
 N PIECE,CP
"RTN","MAGQBPRG",141,0)
 S PIECE=$S(TYPE="ABS":4,TYPE="BIG":1,TYPE="FULL":3,(TYPE="PHOTOID"&(EXT="ABS")):4,TYPE="PHOTOID":3,1:0)
"RTN","MAGQBPRG",142,0)
 Q $P(NODE,U,PIECE)
"RTN","MAGQBPRG",143,0)
JBPTR(MAGIEN,TYPE) ;
"RTN","MAGQBPRG",144,0)
 N PTR
"RTN","MAGQBPRG",145,0)
 I TYPE="BIG" D
"RTN","MAGQBPRG",146,0)
 . S PTR=+$P($G(^MAG(2005,MAGIEN,"FBIG")),"^",2)
"RTN","MAGQBPRG",147,0)
 . S:'PTR PTR=+$P($G(^MAG(2005.1,MAGIEN,"FBIG")),"^",2)
"RTN","MAGQBPRG",148,0)
 E  D
"RTN","MAGQBPRG",149,0)
 . S PTR=+$P($G(^MAG(2005,MAGIEN,0)),"^",5)
"RTN","MAGQBPRG",150,0)
 . S:'PTR PTR=+$P($G(^MAG(2005.1,MAGIEN,"FBIG")),"^",2)
"RTN","MAGQBPRG",151,0)
 Q $S($P($G(^MAG(2005.2,PTR,0)),U,6)=1:PTR,1:0)
"RTN","MAGQBPRG",152,0)
CPOK(TYPE,ALTPATH,FILEPATH,IEN) ;
"RTN","MAGQBPRG",153,0)
 ; Patch 39: initializing ALTPATH, checking nodes of either 2005 or 2005.1
"RTN","MAGQBPRG",154,0)
 N MAGXX,PIECE,NODE,LOC,FILE
"RTN","MAGQBPRG",155,0)
 S MAGXX=IEN
"RTN","MAGQBPRG",156,0)
 S ALTPATH=""
"RTN","MAGQBPRG",157,0)
 S PIECE=$S(TYPE="ABS":4,TYPE="BIG":1,TYPE="FULL":3,(TYPE="PHOTOID"&(EXT="ABS")):4,TYPE="PHOTOID":3,1:0)
"RTN","MAGQBPRG",158,0)
 S NODE=$S(TYPE="BIG":"FBIG",1:0)
"RTN","MAGQBPRG",159,0)
 S FILE=$S($D(^MAG(2005,IEN,0)):"2005",1:"2005.1")
"RTN","MAGQBPRG",160,0)
 S LOC=$P($G(^MAG(FILE,IEN,NODE)),U,PIECE)
"RTN","MAGQBPRG",161,0)
 Q:'$D(^MAG(2005.2,+LOC,0)) 0
"RTN","MAGQBPRG",162,0)
 S ALTPATH=$$UPPER^MAGQE4($P($G(^MAG(2005.2,LOC,0)),U,2)_$$DIRHASH^MAGFILEB(FNAM,LOC))
"RTN","MAGQBPRG",163,0)
 Q $S(ALTPATH=FILEPATH:1,1:0)
"RTN","MAGQBPRG",164,0)
CPUPD(TYPE,IEN,FP,FN,EXT) ;
"RTN","MAGQBPRG",165,0)
 ; Patch 39 - Update : Error log type, and using FILE in case an Archive file
"RTN","MAGQBPRG",166,0)
 N PIECE,CP,NODE,LOC,FILE
"RTN","MAGQBPRG",167,0)
 S EXT=$S('$D(EXT):"",1:$$UPPER^MAGQE4(EXT))
"RTN","MAGQBPRG",168,0)
 S PIECE=$S(TYPE="ABS":4,TYPE="BIG":1,TYPE="FULL":3,(TYPE="PHOTOID"&(EXT="ABS")):4,TYPE="PHOTOID":3,1:0)
"RTN","MAGQBPRG",169,0)
 S NODE=$S(TYPE="BIG":"FBIG",1:0)
"RTN","MAGQBPRG",170,0)
 S LOC=$$UNHASH(FN,FP)
"RTN","MAGQBPRG",171,0)
 I (PIECE=0)!(+LOC=0) D ELOG(FN,FP,"RAID pointer indeterminate") Q
"RTN","MAGQBPRG",172,0)
 S FILE=$S($D(^MAG(2005,IEN,0)):"2005",1:"2005.1")
"RTN","MAGQBPRG",173,0)
 S $P(^MAG(FILE,IEN,NODE),U,PIECE)=LOC
"RTN","MAGQBPRG",174,0)
 Q
"RTN","MAGQBPRG",175,0)
CUPD(RESULT,FILEPATH,FILENAME,EXT,IEN) ; RPC[MAGQ CUPDTE]
"RTN","MAGQBPRG",176,0)
 N TYPE ; called from the BP Purge
"RTN","MAGQBPRG",177,0)
 N X S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBPRG",178,0)
 S TYPE=$$FTYPE(EXT,IEN)
"RTN","MAGQBPRG",179,0)
 D CPUPD(TYPE,IEN,FILEPATH,FILENAME,EXT)
"RTN","MAGQBPRG",180,0)
 Q
"RTN","MAGQBPRG",181,0)
UNHASH(FN,FP) ; RETURN NETWORK LOCATION NUMBER
"RTN","MAGQBPRG",182,0)
 N SHARE,HASH
"RTN","MAGQBPRG",183,0)
 S SHARE=$S(FP[":":$P(FP,"\",1,2)_"\",1:$P(FP,"\",1,4)_"\")
"RTN","MAGQBPRG",184,0)
 S HASH=$S($P(FP,SHARE,2)["\":"Y",1:"")
"RTN","MAGQBPRG",185,0)
 Q $$SHNAM(SHARE,HASH)
"RTN","MAGQBPRG",186,0)
ELOG(FN,FP,MESSAGE) ;
"RTN","MAGQBPRG",187,0)
 N INDX
"RTN","MAGQBPRG",188,0)
 N X S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBPRG",189,0)
 S INDX=+$O(^TMP("MAGQ",$J,"PRG",99999),-1)+1
"RTN","MAGQBPRG",190,0)
 S ^TMP("MAGQ",$J,"PRG",INDX)=MESSAGE_"^"_FN_"^"_FP
"RTN","MAGQBPRG",191,0)
 Q
"RTN","MAGQBPRG",192,0)
ELOGR(RESULT,LIMIT) ;[MAGQ ELOGR] - Error log report and purge
"RTN","MAGQBPRG",193,0)
 ; Please test this
"RTN","MAGQBPRG",194,0)
 N FN,INDX,CNT
"RTN","MAGQBPRG",195,0)
 N X S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBPRG",196,0)
 S CNT=0,INDX=""
"RTN","MAGQBPRG",197,0)
 F  S INDX=$O(^TMP("MAGQ",$J,"PRG",INDX)) Q:INDX'?1N.N  Q:CNT=LIMIT  D
"RTN","MAGQBPRG",198,0)
 . S CNT=CNT+1,RESULT(CNT)=^TMP("MAGQ",$J,"PRG",INDX)
"RTN","MAGQBPRG",199,0)
 . K ^TMP("MAGQ",$J,"PRG",INDX)
"RTN","MAGQBPRG",200,0)
 . Q
"RTN","MAGQBPRG",201,0)
 S RESULT(0)=CNT
"RTN","MAGQBPRG",202,0)
 S INDX=$O(^TMP("MAGQ",$J,"PRG",""))
"RTN","MAGQBPRG",203,0)
 I INDX?1N.N S RESULT(0)=RESULT(0)_U_"MORE"
"RTN","MAGQBPRG",204,0)
 Q
"RTN","MAGQBPRG",205,0)
SHNAM(SHARE,HASH) ;
"RTN","MAGQBPRG",206,0)
 N NUM,ONLINE,ZNODE
"RTN","MAGQBPRG",207,0)
 S (NUM,ONLINE)=0
"RTN","MAGQBPRG",208,0)
 Q:((SHARE="")!(SHARE[":")) ""
"RTN","MAGQBPRG",209,0)
 F  S NUM=$O(^MAG(2005.2,"AC",SHARE,NUM)) Q:'NUM  D  Q:ONLINE
"RTN","MAGQBPRG",210,0)
 . S ZNODE=^MAG(2005.2,NUM,0)
"RTN","MAGQBPRG",211,0)
 . Q:($P(ZNODE,"^",6)'="1")
"RTN","MAGQBPRG",212,0)
 . Q:($P(ZNODE,"^",8)'=HASH)
"RTN","MAGQBPRG",213,0)
 . S ONLINE="1"
"RTN","MAGQBPRG",214,0)
 Q NUM
"RTN","MAGQBTM")
0^15^B81984703
"RTN","MAGQBTM",1,0)
MAGQBTM ;WOIFO/RMP/JL - REMOTE Task SERVER Program ; 18 Jan 2011 5:07 PM
"RTN","MAGQBTM",2,0)
 ;;3.0;IMAGING;**1,7,8,20,81,39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGQBTM",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGQBTM",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBTM",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBTM",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBTM",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBTM",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBTM",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBTM",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBTM",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBTM",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBTM",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBTM",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBTM",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBTM",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBTM",17,0)
 ;;
"RTN","MAGQBTM",18,0)
 Q
"RTN","MAGQBTM",19,0)
ENTRY(RESULT,WSTAT,PROCESS) ; RPC[MAGQ ABP]
"RTN","MAGQBTM",20,0)
 N X,SYSIEN,SYSNAME,NODE,INDX,CNT,PROC,%,QPTR,QCNT,VERS,EXEDATE,WSOS,PLACE,VOK,EXDATE
"RTN","MAGQBTM",21,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBTM",22,0)
 S (SYSIEN,CNT)=0,SYSNAME="",PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2))),VOK=""
"RTN","MAGQBTM",23,0)
 S $P(RESULT(0),U,6)=$D(^XUSEC("MAG SYSTEM",DUZ))
"RTN","MAGQBTM",24,0)
 Q:'$P(RESULT(0),U,6)
"RTN","MAGQBTM",25,0)
 S VERS=$P(WSTAT,U,2)
"RTN","MAGQBTM",26,0)
 S WSTAT=$P(WSTAT,U)
"RTN","MAGQBTM",27,0)
 S SYSIEN=$O(^MAG(2006.8,"C",PLACE,WSTAT,""))
"RTN","MAGQBTM",28,0)
 I 'SYSIEN S SYSIEN=$O(^MAG(2006.8,"C",PLACE,$$UPPER^MAGQE4(WSTAT),""))
"RTN","MAGQBTM",29,0)
 I 'SYSIEN D
"RTN","MAGQBTM",30,0)
 . N TRY
"RTN","MAGQBTM",31,0)
 . F TRY=1:1:$L(WSTAT,".") D  Q:SYSIEN?1.N
"RTN","MAGQBTM",32,0)
 . . S SYSIEN=$O(^MAG(2006.8,"C",PLACE,$P(WSTAT,".",TRY),""))
"RTN","MAGQBTM",33,0)
 . . I 'SYSIEN S SYSIEN=$O(^MAG(2006.8,"C",PLACE,$$UPPER^MAGQE4($P(WSTAT,".",TRY)),""))
"RTN","MAGQBTM",34,0)
 Q:SYSIEN=""
"RTN","MAGQBTM",35,0)
 S VERS=$P(VERS,".",1,2)_"P"_$P(VERS,".",3)
"RTN","MAGQBTM",36,0)
 D VOKR^MAGQBUT4(.VOK,VERS)
"RTN","MAGQBTM",37,0)
 Q:'$P(VOK,U)
"RTN","MAGQBTM",38,0)
 S NODE=^MAG(2006.8,SYSIEN,0)
"RTN","MAGQBTM",39,0)
 S SYSNAME=$P(NODE,U)
"RTN","MAGQBTM",40,0)
 I SYSNAME="" D  Q
"RTN","MAGQBTM",41,0)
 . S $P(RESULT(0),U,1,2)="-1^No Background Processor parameters on system"
"RTN","MAGQBTM",42,0)
 I $P(NODE,U,12)'=1 D  Q
"RTN","MAGQBTM",43,0)
 . S $P(RESULT(0),U,1,2)="-1^Not assigned as a Background Processor"
"RTN","MAGQBTM",44,0)
 F PROC="ABSTRACT;13","JUKEBOX;14","JBTOHD;15","DELETE;23","PREFET;16","GCC;18","IMPORT;17" D  Q:$P(RESULT(0),U,1)="-1"
"RTN","MAGQBTM",45,0)
 . N PIECE,NAME
"RTN","MAGQBTM",46,0)
 . I $$UBPW^MAGQBUT1(SYSNAME,PROC) D  Q
"RTN","MAGQBTM",47,0)
 . . S $P(RESULT(0),U,1,2)="-1^This BP: "_SYSNAME_" has a co-assigned queue: "_$P(PROC,";")
"RTN","MAGQBTM",48,0)
 . S NAME=$P(PROC,";")
"RTN","MAGQBTM",49,0)
 . S PIECE=$P(PROC,";",2)
"RTN","MAGQBTM",50,0)
 . I $P(NODE,U,PIECE)="1" D
"RTN","MAGQBTM",51,0)
 . . N QCNT,QPTR
"RTN","MAGQBTM",52,0)
 . . D ADD^MAGBAPI(0,NAME,PLACE)
"RTN","MAGQBTM",53,0)
 . . S QPTR=$O(^MAGQUEUE(2006.031,"C",PLACE,NAME,""))
"RTN","MAGQBTM",54,0)
 . . S QCNT=$P($G(^MAGQUEUE(2006.031,+QPTR,0)),U,3)
"RTN","MAGQBTM",55,0)
 . . S CNT=CNT+1
"RTN","MAGQBTM",56,0)
 . . S RESULT(CNT)=NAME_U_QCNT_U_(+$P($G(^MAGQUEUE(2006.031,+QPTR,0)),U,5)-QCNT)
"RTN","MAGQBTM",57,0)
 . . Q
"RTN","MAGQBTM",58,0)
 . Q
"RTN","MAGQBTM",59,0)
 Q:$P(RESULT(0),U,1)="-1"
"RTN","MAGQBTM",60,0)
 S $P(RESULT(0),U,1,5)="0^BP List^PID: "_$$BASE^XLFUTL($J,10,16)_"^"_SYSNAME_U_WSTAT
"RTN","MAGQBTM",61,0)
 Q
"RTN","MAGQBTM",62,0)
GETQUE(RESULT,ACTION) ; RPC[MAGQ GET]
"RTN","MAGQBTM",63,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBTM",64,0)
 N PLACE
"RTN","MAGQBTM",65,0)
 D @(ACTION_"(.RESULT)")
"RTN","MAGQBTM",66,0)
 I +RESULT<0 D  ; Update queue status and increment the Queue pointer if the queue cannot be processed
"RTN","MAGQBTM",67,0)
 . N PLACE S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBTM",68,0)
 . D QSTAT($P(RESULT,U,2),$P(RESULT,U,3),ACTION,.PLACE)
"RTN","MAGQBTM",69,0)
 . D QPTER(ACTION,$P(RESULT,U,2),.PLACE)
"RTN","MAGQBTM",70,0)
 Q
"RTN","MAGQBTM",71,0)
ABSTRACT(RESULT) ;
"RTN","MAGQBTM",72,0)
 D DEQUEUE("ABSTRACT",.RESULT) Q
"RTN","MAGQBTM",73,0)
JUKEBOX(RESULT) ;
"RTN","MAGQBTM",74,0)
 D DEQUEUE("JUKEBOX",.RESULT) Q
"RTN","MAGQBTM",75,0)
JBTOHD(RESULT) ;
"RTN","MAGQBTM",76,0)
 D DEQUEUE("JBTOHD",.RESULT) Q
"RTN","MAGQBTM",77,0)
GCC(RESULT) ;
"RTN","MAGQBTM",78,0)
 D DEQUEUE("GCC",.RESULT) Q
"RTN","MAGQBTM",79,0)
DELETE(RESULT) ;
"RTN","MAGQBTM",80,0)
 D DEQUEUE("DELETE",.RESULT) Q
"RTN","MAGQBTM",81,0)
PREFET(RESULT) ;
"RTN","MAGQBTM",82,0)
 D DEQUEUE("PREFET",.RESULT) Q
"RTN","MAGQBTM",83,0)
IMPORT(RESULT) ;
"RTN","MAGQBTM",84,0)
 D DEQUEUE("IMPORT",.RESULT) Q
"RTN","MAGQBTM",85,0)
DEQUEUE(QUE,RESULT) ;
"RTN","MAGQBTM",86,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBTM",87,0)
 N QPTR,QPTR2,ROU,MAGIEN,ZNODE,MSG,IMQUE,PLACE
"RTN","MAGQBTM",88,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBTM",89,0)
 S QPTR2=$O(^MAGQUEUE(2006.031,"C",PLACE,QUE,""))
"RTN","MAGQBTM",90,0)
 S QPTR=$S(QPTR2:$P(^MAGQUEUE(2006.031,QPTR2,0),U,2),1:"")
"RTN","MAGQBTM",91,0)
 S QPTR=$O(^MAGQUEUE(2006.03,"C",PLACE,QUE,QPTR))
"RTN","MAGQBTM",92,0)
 I QPTR="" D  Q
"RTN","MAGQBTM",93,0)
 . S RESULT="0"_U_QPTR2_U_"No "_QUE_" "_QPTR2_" to process."
"RTN","MAGQBTM",94,0)
 D QSTAT(QPTR,QUE_" in progress.",QUE,.PLACE)
"RTN","MAGQBTM",95,0)
 S ZNODE=$G(^MAGQUEUE(2006.03,QPTR,0))
"RTN","MAGQBTM",96,0)
 I ZNODE="" S RESULT=-101_U_QPTR_U_"Queue Record does not exist" Q
"RTN","MAGQBTM",97,0)
 I QUE="IMPORT" D ENTRY^MAGQBIM(QPTR,QUE,QPTR2,ZNODE,.RESULT) Q
"RTN","MAGQBTM",98,0)
 S MAGIEN=$P(ZNODE,"^",7)
"RTN","MAGQBTM",99,0)
 I ("^DELETE^JUKEBOX^")'[(U_QUE_U),(('(+MAGIEN))!('$D(^MAG(2005,+MAGIEN,0)))!($P(ZNODE,U)'=QUE)) D  Q
"RTN","MAGQBTM",100,0)
 . I $D(^MAG(2005.1,+MAGIEN,0)) D
"RTN","MAGQBTM",101,0)
 . . S MSG="Image Record Deleted and in archive file."
"RTN","MAGQBTM",102,0)
 . E  S MSG="No valid image file number to process."
"RTN","MAGQBTM",103,0)
 . S RESULT=-101_U_QPTR_U_MSG
"RTN","MAGQBTM",104,0)
 S ROU=$$RESET(QUE)
"RTN","MAGQBTM",105,0)
 I ROU="" S RESULT="-1"_U_QPTR_U_QUE_" Is an inactive process" Q
"RTN","MAGQBTM",106,0)
 D @("ENTRY^"_ROU_"(.RESULT,QPTR)")
"RTN","MAGQBTM",107,0)
 Q
"RTN","MAGQBTM",108,0)
QSTAT(QPTR,MESSAGE,ACTION,PLACE) ;Update the Queue status
"RTN","MAGQBTM",109,0)
 N ZNODE,MAGTIME
"RTN","MAGQBTM",110,0)
 Q:QPTR=""
"RTN","MAGQBTM",111,0)
 S MESSAGE=$TR(MESSAGE,":;<>.?/\'()*^%$#@!0123456789","")
"RTN","MAGQBTM",112,0)
 Q:'$D(^MAGQUEUE(2006.03,QPTR,0))
"RTN","MAGQBTM",113,0)
 S ZNODE=$G(^MAGQUEUE(2006.03,QPTR,0))
"RTN","MAGQBTM",114,0)
 S MAGTIME=$$NOW^XLFDT
"RTN","MAGQBTM",115,0)
 S:'$G(PLACE) PLACE=$$QPLACE(ZNODE,QPTR)
"RTN","MAGQBTM",116,0)
 Q:'PLACE
"RTN","MAGQBTM",117,0)
 I $P(ZNODE,U,5)]"" D
"RTN","MAGQBTM",118,0)
 . K ^MAGQUEUE(2006.03,"D",PLACE,$P(ZNODE,U),$E($P(ZNODE,U,5),1,30),QPTR) Q
"RTN","MAGQBTM",119,0)
 S ^MAGQUEUE(2006.03,"D",PLACE,$P(ZNODE,U),$E(MESSAGE,1,30),QPTR)=""
"RTN","MAGQBTM",120,0)
 S $P(^MAGQUEUE(2006.03,QPTR,0),U,5,6)=$P(MESSAGE,U)_U_MAGTIME
"RTN","MAGQBTM",121,0)
 I ACTION["IMPORT" D STAT^MAGQBIM($S($P(ZNODE,U,11)?1N.N:$P(ZNODE,U,11),1:QPTR),MAGTIME,MESSAGE)
"RTN","MAGQBTM",122,0)
 Q
"RTN","MAGQBTM",123,0)
QPLACE(QNODE,PTR) ; Seek alternate PLACE values and update the Queue
"RTN","MAGQBTM",124,0)
 N IEN,VALUE,ACQ
"RTN","MAGQBTM",125,0)
 S VALUE=""
"RTN","MAGQBTM",126,0)
 I +$P(QNODE,U,12) D  Q VALUE
"RTN","MAGQBTM",127,0)
 . S VALUE=+$P(QNODE,U,12) Q
"RTN","MAGQBTM",128,0)
 S IEN=$P(QNODE,U,7) ; try the Image acquisition site
"RTN","MAGQBTM",129,0)
 I IEN?1N.N D
"RTN","MAGQBTM",130,0)
 . S ACQ=+$P($G(^MAG(2005,IEN,100)),U,3)
"RTN","MAGQBTM",131,0)
 . S:'ACQ ACQ=+$P($G(^MAG(2005.1,IEN,100)),U,3)
"RTN","MAGQBTM",132,0)
 . S:ACQ VALUE=$$PLACE^MAGBAPI(ACQ) Q
"RTN","MAGQBTM",133,0)
 S:'VALUE VALUE=$$PLACE^MAGBAPI(+$G(DUZ(2))) ; else the BP User
"RTN","MAGQBTM",134,0)
 S:VALUE $P(^MAGQUEUE(2006.03,PTR,0),U,12)=VALUE
"RTN","MAGQBTM",135,0)
 Q VALUE
"RTN","MAGQBTM",136,0)
QPTER(QUEUE,QPTR,PLACE) ; Conditionally advance the queue pointer & decrement the active queue count
"RTN","MAGQBTM",137,0)
 N QREC,PREV,PNODE
"RTN","MAGQBTM",138,0)
 I 'PLACE D  Q:'PLACE
"RTN","MAGQBTM",139,0)
 . S PLACE=$P($G(^MAGQUEUE(2006.03,QPTR,0)),U,12)
"RTN","MAGQBTM",140,0)
 . S PLACE=$S(PLACE:PLACE,1:$$PLACE^MAGBAPI(+$G(DUZ(2))))
"RTN","MAGQBTM",141,0)
 . Q
"RTN","MAGQBTM",142,0)
 S QREC=$O(^MAGQUEUE(2006.031,"C",PLACE,QUEUE,""))
"RTN","MAGQBTM",143,0)
 S PREV=$S(QREC:$P(^MAGQUEUE(2006.031,QREC,0),U,2),1:"")
"RTN","MAGQBTM",144,0)
 I PREV'=QPTR D  Q
"RTN","MAGQBTM",145,0)
 . D ADD^MAGBAPI(-1,QUEUE,PLACE)
"RTN","MAGQBTM",146,0)
 . L +^MAGQUEUE(2006.031,QREC,0):1E9
"RTN","MAGQBTM",147,0)
 . S $P(^MAGQUEUE(2006.031,QREC,0),U,2)=QPTR,$P(^MAGQUEUE(2006.031,QREC,0),U,6)=$$NOW^XLFDT
"RTN","MAGQBTM",148,0)
 . L -^MAGQUEUE(2006.031,QREC,0)
"RTN","MAGQBTM",149,0)
 . Q
"RTN","MAGQBTM",150,0)
 D ADD^MAGBAPI(0,QUEUE,PLACE)  ; Else reset the active queue count
"RTN","MAGQBTM",151,0)
 Q
"RTN","MAGQBTM",152,0)
RESET(QUEUE) ; Set Routine parameter
"RTN","MAGQBTM",153,0)
 Q:QUEUE="ABSTRACT" "MAGQBAB"
"RTN","MAGQBTM",154,0)
 Q:QUEUE="JUKEBOX" "MAGQBJB"
"RTN","MAGQBTM",155,0)
 Q:QUEUE="JBTOHD" "MAGQBJH"
"RTN","MAGQBTM",156,0)
 Q:QUEUE="DELETE" "MAGQBD"
"RTN","MAGQBTM",157,0)
 Q:QUEUE="PREFET" "MAGQBJH"
"RTN","MAGQBTM",158,0)
 Q:QUEUE="IMPORT" "MAGQBIM"
"RTN","MAGQBTM",159,0)
 Q:QUEUE="GCC" "MAGQBGCC"
"RTN","MAGQBTM",160,0)
 Q ""
"RTN","MAGQBTM",161,0)
QUPDTE(RESULT,QPTR,UPDATE) ;RPC[MAGQ QUD]
"RTN","MAGQBTM",162,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBTM",163,0)
 N NODE,STAT,TYPE,VPTR,MPTR,IEN,IDFN,MSG,PLACE,DA
"RTN","MAGQBTM",164,0)
 S NODE=$G(^MAGQUEUE(2006.03,QPTR,0))
"RTN","MAGQBTM",165,0)
 S PLACE=$P(NODE,U,12)
"RTN","MAGQBTM",166,0)
 S RESULT="1^QUEUE UPDATE COMPLETE"
"RTN","MAGQBTM",167,0)
 S STAT=$P(UPDATE,U)
"RTN","MAGQBTM",168,0)
 S TYPE=$P(NODE,U)
"RTN","MAGQBTM",169,0)
 S MSG=$S($P(UPDATE,U,2)="":TYPE_" Process Error",1:$P(UPDATE,U,2))
"RTN","MAGQBTM",170,0)
 D QSTAT(QPTR,MSG,TYPE,.PLACE)
"RTN","MAGQBTM",171,0)
 D QPTER(TYPE,QPTR,PLACE)
"RTN","MAGQBTM",172,0)
 I STAT<0 Q
"RTN","MAGQBTM",173,0)
 I "^DELETE^"[("^"_TYPE_"^") D DQUE^MAGQBUT2(QPTR) Q
"RTN","MAGQBTM",174,0)
 I "^IMPORT^"[("^"_TYPE_"^") D DQUE^MAGQBUT2(QPTR) Q
"RTN","MAGQBTM",175,0)
 S VPTR=$P(UPDATE,U,3)
"RTN","MAGQBTM",176,0)
 I VPTR?1.N D
"RTN","MAGQBTM",177,0)
 . S MPTR=$P(NODE,U,7)
"RTN","MAGQBTM",178,0)
 . I "^ABSTRACT^"[("^"_TYPE_"^") D  Q
"RTN","MAGQBTM",179,0)
 . . S $P(^MAG(2005,MPTR,0),U,4)=VPTR
"RTN","MAGQBTM",180,0)
 . . S X=$$JUKEBOX^MAGBAPI(MPTR,PLACE)
"RTN","MAGQBTM",181,0)
 . . D DQUE^MAGQBUT2(QPTR) Q
"RTN","MAGQBTM",182,0)
 . I ("^JBTOHD^"[("^"_TYPE_"^"))!("^PREFET^"[("^"_TYPE_"^")) D  Q
"RTN","MAGQBTM",183,0)
 . . I "^FULL^"[$P(NODE,U,8) S $P(^MAG(2005,MPTR,0),U,3)=VPTR
"RTN","MAGQBTM",184,0)
 . . I "^ABSTRACT^"[$P(NODE,U,8) S $P(^MAG(2005,MPTR,0),U,4)=VPTR
"RTN","MAGQBTM",185,0)
 . . I "^BIG^"[$P(NODE,U,8) S $P(^MAG(2005,MPTR,"FBIG"),U)=VPTR
"RTN","MAGQBTM",186,0)
 . . D DQUE^MAGQBUT2(QPTR) Q
"RTN","MAGQBTM",187,0)
 . I "^JUKEBOX^"[("^"_TYPE_"^") D  Q 
"RTN","MAGQBTM",188,0)
 . . I $P(UPDATE,U,2)["BIG" D  Q
"RTN","MAGQBTM",189,0)
 . . . S:$D(^MAG(2005,MPTR)) $P(^MAG(2005,MPTR,"FBIG"),U,2)=VPTR
"RTN","MAGQBTM",190,0)
 . . . S:$D(^MAG(2005.1,MPTR)) $P(^MAG(2005.1,MPTR,"FBIG"),U,2)=VPTR
"RTN","MAGQBTM",191,0)
 . . . D DQUE^MAGQBUT2(QPTR) Q
"RTN","MAGQBTM",192,0)
 . . E  D
"RTN","MAGQBTM",193,0)
 . . . S:$D(^MAG(2005,MPTR)) $P(^MAG(2005,MPTR,0),U,5)=VPTR
"RTN","MAGQBTM",194,0)
 . . . S:$D(^MAG(2005.1,MPTR)) $P(^MAG(2005.1,MPTR,0),U,5)=VPTR
"RTN","MAGQBTM",195,0)
 . . . D DQUE^MAGQBUT2(QPTR) Q
"RTN","MAGQBTM",196,0)
 . . Q
"RTN","MAGQBTM",197,0)
 . I "^GCC^"[("^"_TYPE_"^") D  Q
"RTN","MAGQBTM",198,0)
 . . S FDA(2005.01,"+1,"_MPTR_",",.01)=VPTR
"RTN","MAGQBTM",199,0)
 . . S FDA(2005.01,"+1,"_MPTR_",",1)=$$NOW^XLFDT
"RTN","MAGQBTM",200,0)
 . . S FDA(2005.01,"+1,"_MPTR_",",2)=$P($$TRIM^MAGQBUT4($P(UPDATE,U,2))," ")
"RTN","MAGQBTM",201,0)
 . . D UPDATE^DIE("U","FDA","","MAGIMP")
"RTN","MAGQBTM",202,0)
 . . K FDA
"RTN","MAGQBTM",203,0)
 . . S IDFN=$P(^MAG(2005,MPTR,0),U,7)
"RTN","MAGQBTM",204,0)
 . . D ENTRY^MAGLOG("EXPORT->"_$P($G(^MAG(2005.2,VPTR,0)),U,2),$P(NODE,U,2),MPTR,"Document Imaging",IDFN,0)
"RTN","MAGQBTM",205,0)
 . . D DQUE^MAGQBUT2(QPTR) Q
"RTN","MAGQBTM",206,0)
 . Q
"RTN","MAGQBTM",207,0)
 Q
"RTN","MAGQBTM",208,0)
REQUE(RESULT,QPTR) ;
"RTN","MAGQBTM",209,0)
 ; RPC[MAGQ REQ]
"RTN","MAGQBTM",210,0)
 N PROC,NODE,INDX,PARAM,OPDUZ,STATUS,TRACKID,PLACE,X
"RTN","MAGQBTM",211,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBTM",212,0)
 S INDX=$$TRIM^MAGQBUT4(QPTR),TRACKID=0
"RTN","MAGQBTM",213,0)
 S NODE=$G(^MAGQUEUE(2006.03,INDX,0))
"RTN","MAGQBTM",214,0)
 Q:NODE']""
"RTN","MAGQBTM",215,0)
 S PLACE=$P(NODE,U,12)
"RTN","MAGQBTM",216,0)
 Q:'PLACE
"RTN","MAGQBTM",217,0)
 S PROC=$P(NODE,U),STATUS=$P(NODE,U,5)
"RTN","MAGQBTM",218,0)
 I PROC'="IMPORT" D
"RTN","MAGQBTM",219,0)
 . D RQP(PROC,NODE,.PARAM)
"RTN","MAGQBTM",220,0)
 . S @("RESULT=$$"_PROC_"^MAGBAPI(PARAM,PLACE)")
"RTN","MAGQBTM",221,0)
 . Q
"RTN","MAGQBTM",222,0)
 E  D  Q  ;IMPORT - Doesn't De-queue Import and Session file
"RTN","MAGQBTM",223,0)
 . S $P(PARAM,U,3)=+$P(NODE,U,9)+1
"RTN","MAGQBTM",224,0)
 . S $P(PARAM,U,4)=$S($P(NODE,U,11)?1N.N:$P(NODE,U,11),1:QPTR)
"RTN","MAGQBTM",225,0)
 . D TIDL^MAGQBIM($S($P(NODE,U,11)?1N.N:$P(NODE,U,11),1:QPTR),PROC,.TRACKID)
"RTN","MAGQBTM",226,0)
 . Q:TRACKID=0
"RTN","MAGQBTM",227,0)
 . S @("RESULT=$$"_PROC_"^MAGBAPI(PARAM,$P(NODE,U,10),TRACKID,PLACE)")
"RTN","MAGQBTM",228,0)
 . D DQUE^MAGQBUT2(INDX,"1")
"RTN","MAGQBTM",229,0)
 . Q
"RTN","MAGQBTM",230,0)
 D DQUE^MAGQBUT2(INDX)
"RTN","MAGQBTM",231,0)
 Q
"RTN","MAGQBTM",232,0)
RQP(P,N,PAR) ;
"RTN","MAGQBTM",233,0)
 N P1,P2,P3,P4
"RTN","MAGQBTM",234,0)
 I ("^JBTOHD^PREFET^")[P S P1=$P(N,U,7),P2=$P(N,U,8),P3=+$P(N,U,9)+1,PAR=P1_U_P2_U_P3 Q
"RTN","MAGQBTM",235,0)
 I P["DELETE" S P1=$P(N,U,10),P2=+$P(N,U,9)+1,PAR=P2_U_P1 Q
"RTN","MAGQBTM",236,0)
 I P["GCC" D  Q
"RTN","MAGQBTM",237,0)
 . S P1=$P(N,U,7),P2=$P(N,U,10),P3=$P(N,U,11),P4=$P(N,U,9)+1,PAR=P1_U_P2_U_P3_U_P4 Q
"RTN","MAGQBTM",238,0)
 S P1=$P(N,U,7)_"^^",P2=+$P(N,U,9)+1,PAR=P1_P2 ;JUKEBOX + ABSTRACT
"RTN","MAGQBTM",239,0)
 Q
"RTN","MAGQBTM",240,0)
ERR ;
"RTN","MAGQBTM",241,0)
 N ERRXX
"RTN","MAGQBTM",242,0)
 S ERRXX=$$EC^%ZOSV
"RTN","MAGQBTM",243,0)
 D ^%ZTER
"RTN","MAGQBTM",244,0)
 D ^XUSCLEAN
"RTN","MAGQBTM",245,0)
 Q
"RTN","MAGQBU6A")
0^16^B101156562
"RTN","MAGQBU6A",1,0)
MAGQBU6A ;WIOFO/RMP Utility to find possible incorrect Image issues with the Import Queue File. ; 14 Oct 2010 10:12 AM
"RTN","MAGQBU6A",2,0)
 ;;3.0;IMAGING;**39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGQBU6A",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGQBU6A",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBU6A",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBU6A",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBU6A",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBU6A",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBU6A",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBU6A",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBU6A",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBU6A",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBU6A",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBU6A",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBU6A",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBU6A",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBU6A",17,0)
 ;;
"RTN","MAGQBU6A",18,0)
 Q
"RTN","MAGQBU6A",19,0)
GETRL(LIST) ;  Get Redundant List (of shares)
"RTN","MAGQBU6A",20,0)
 N HASH,IEN,NODE,NODE2,NODE3,PATH,PLACE,TYPE
"RTN","MAGQBU6A",21,0)
 ; Must have same:  PHYSICAL REFERENCE,STORAGE TYPE,HASH DIRECTORY,PLACE
"RTN","MAGQBU6A",22,0)
 ; Return array:(UNC path, 1 or 0 for hash directory,division)=list of iens that match the UNC path
"RTN","MAGQBU6A",23,0)
 ; ARRAY(\\UNC_HASH_DIVISION)=1ST IEN FOUND_IEN_IEN,etc.
"RTN","MAGQBU6A",24,0)
 K LIST
"RTN","MAGQBU6A",25,0)
 S U="^"
"RTN","MAGQBU6A",26,0)
 S IEN=0 F  S IEN=$O(^MAG(2005.2,IEN)) Q:'IEN  D
"RTN","MAGQBU6A",27,0)
 . S NODE=$G(^MAG(2005.2,IEN,0)),NODE3=$G(^MAG(2005.2,IEN,3)),NODE2=$G(^MAG(2005,IEN,3))
"RTN","MAGQBU6A",28,0)
 . S PATH=$P(NODE,U,2),PLACE=$P(NODE,U,10),TYPE=$P(NODE,U,7),HASH=$P(NODE,U,8)
"RTN","MAGQBU6A",29,0)
 . Q:((TYPE'["WORM")&(TYPE'["MAG"))  ; Only RAID and Jukebox NAMES
"RTN","MAGQBU6A",30,0)
 . I +$D(LIST(PATH_U_HASH_U_PLACE)) D  Q
"RTN","MAGQBU6A",31,0)
 . . S $P(LIST(PATH_U_HASH_U_PLACE),U,1,99)=$P(LIST(PATH_U_HASH_U_PLACE),U,1,99)_U_IEN
"RTN","MAGQBU6A",32,0)
 . . Q
"RTN","MAGQBU6A",33,0)
 . E  S LIST(PATH_U_HASH_U_PLACE)=IEN
"RTN","MAGQBU6A",34,0)
 . Q
"RTN","MAGQBU6A",35,0)
 S PATH="" F  S PATH=$O(LIST(PATH)) Q:PATH=""  D
"RTN","MAGQBU6A",36,0)
 . I $G(LIST(PATH))'["^" K LIST(PATH) ;Only entry with more than one IEN defined.
"RTN","MAGQBU6A",37,0)
 . Q
"RTN","MAGQBU6A",38,0)
 ;Now start applying rule: 
"RTN","MAGQBU6A",39,0)
 ;Use the IEN in the duplicates that is ONLINE-- as the primary.
"RTN","MAGQBU6A",40,0)
 N NEW,OLD,ON,PC,PRIME
"RTN","MAGQBU6A",41,0)
 S EN="" F  S EN=$O(LIST(EN)) Q:EN=""  D
"RTN","MAGQBU6A",42,0)
 . S ON=0 F PC=1:1:$L(LIST(EN),"^") S IEN=$P(LIST(EN),U,PC) D  Q:ON
"RTN","MAGQBU6A",43,0)
 . . I PC=1,+$P(^MAG(2005.2,IEN,0),U,6) S ON=1 Q    ;above rule
"RTN","MAGQBU6A",44,0)
 . . I +$P(^MAG(2005.2,IEN,0),U,6) S ON=1 S NEW(EN)=IEN_"^"_PC
"RTN","MAGQBU6A",45,0)
 . . Q
"RTN","MAGQBU6A",46,0)
 . Q
"RTN","MAGQBU6A",47,0)
 ;resort the array to place the new prime in right order
"RTN","MAGQBU6A",48,0)
 S EN="" F  S EN=$O(NEW(EN)) Q:EN=""  D
"RTN","MAGQBU6A",49,0)
 . ;get the original prime (OLD)and the new piece value for it.
"RTN","MAGQBU6A",50,0)
 . S PRIME=$G(NEW(EN)),OLD=+LIST(EN)_U_$P(PRIME,U,2)
"RTN","MAGQBU6A",51,0)
 . S NEW(EN)=$G(LIST(EN))   ;get the original prime and dup values 
"RTN","MAGQBU6A",52,0)
 . S $P(NEW(EN),U)=+PRIME   ;set the new prime
"RTN","MAGQBU6A",53,0)
 . S $P(NEW(EN),U,$P(OLD,U,2))=+OLD  ;Reposition the old prime value
"RTN","MAGQBU6A",54,0)
 . Q
"RTN","MAGQBU6A",55,0)
 S EN="" F  S EN=$O(LIST(EN)) Q:EN=""  D
"RTN","MAGQBU6A",56,0)
 . I $D(NEW(EN)) M LIST(EN)=NEW(EN)
"RTN","MAGQBU6A",57,0)
 . Q
"RTN","MAGQBU6A",58,0)
 ;Now save in a temp file in case errors occur during repointing of dangling pointers in the IMAGE files.
"RTN","MAGQBU6A",59,0)
 N ENTRY,ILIST,X,X2
"RTN","MAGQBU6A",60,0)
 S X=$$NOW^XLFDT,X2=$$FMADD^XLFDT(X,30,"","","")
"RTN","MAGQBU6A",61,0)
 S ^XTMP("MAGP39","DUPSHARE",0)=X_"^"_X2_"^"_"Patch 39 Consolidating Network Locations"
"RTN","MAGQBU6A",62,0)
 S PATH="" F  S PATH=$O(LIST(PATH)) Q:PATH=""  D 
"RTN","MAGQBU6A",63,0)
 . S ILIST=$G(LIST(PATH)) I ILIST S ENTRY=$P(ILIST,"^") I ENTRY D
"RTN","MAGQBU6A",64,0)
 . S ^XTMP("MAGP39","DUPSHARE","ENTRIES",ENTRY,PATH)=ILIST
"RTN","MAGQBU6A",65,0)
 . Q
"RTN","MAGQBU6A",66,0)
 Q 
"RTN","MAGQBU6A",67,0)
 ;
"RTN","MAGQBU6A",68,0)
DSPNL ; Display the original Network Location file
"RTN","MAGQBU6A",69,0)
 N EN,DATA,ONLINE,ROUTER
"RTN","MAGQBU6A",70,0)
 S EN=0
"RTN","MAGQBU6A",71,0)
 D PMSG^MAGQBUT6("")
"RTN","MAGQBU6A",72,0)
 D PMSG^MAGQBUT6("======================================================================")
"RTN","MAGQBU6A",73,0)
 D PMSG^MAGQBUT6("Display the original Network Location file")
"RTN","MAGQBU6A",74,0)
 F  S EN=$O(^MAG(2005.2,EN)) Q:'EN  D
"RTN","MAGQBU6A",75,0)
 . D PMSG^MAGQBUT6("Entry:"_EN_" "_$G(^MAG(2005.2,EN,0)))
"RTN","MAGQBU6A",76,0)
 . Q
"RTN","MAGQBU6A",77,0)
 D PMSG^MAGQBUT6("======================================================================")
"RTN","MAGQBU6A",78,0)
 Q
"RTN","MAGQBU6A",79,0)
REPNAM ;Report residual duplicate names
"RTN","MAGQBU6A",80,0)
 N ARRAY,DSITE,EN,EN1,PSITE,TMP
"RTN","MAGQBU6A",81,0)
 S (TMP,ARRAY)=""
"RTN","MAGQBU6A",82,0)
 F  S TMP=$O(^MAG(2005.2,"B",TMP)) Q:TMP=""  D
"RTN","MAGQBU6A",83,0)
 . S (EN,EN1)="",EN=$O(^MAG(2005.2,"B",TMP,"")) S PSITE=$P($G(^MAG(2005.2,EN,0)),U,10)
"RTN","MAGQBU6A",84,0)
 . S EN1=EN F  S EN1=$O(^MAG(2005.2,"B",TMP,EN1)) Q:EN1=""  D
"RTN","MAGQBU6A",85,0)
 . . S DSITE=$P($G(^MAG(2005.2,EN1,0)),U,10)  I PSITE'=DSITE Q  ;Not the same site.
"RTN","MAGQBU6A",86,0)
 . . S ARRAY(TMP,EN1)="",ARRAY(TMP,EN)="" Q
"RTN","MAGQBU6A",87,0)
 . Q
"RTN","MAGQBU6A",88,0)
 Q:$O(ARRAY(""))=""
"RTN","MAGQBU6A",89,0)
 S TMP=""
"RTN","MAGQBU6A",90,0)
 D PMSG^MAGQBUT6("The following is a list of residual duplicate names in the Network Location file")
"RTN","MAGQBU6A",91,0)
 F  S TMP=$O(ARRAY(TMP)) Q:TMP=""  D
"RTN","MAGQBU6A",92,0)
 . S EN="" F  S EN=$O(ARRAY(TMP,EN)) Q:EN=""  D
"RTN","MAGQBU6A",93,0)
 . . S SITE=$P($G(^MAG(2005.2,EN,0)),U,10),SITE=$P($G(^MAG(2006.1,SITE,0)),U)
"RTN","MAGQBU6A",94,0)
 . . D PMSG^MAGQBUT6("NAME: "_TMP_" "_" IEN: "_EN_" for Imaging division "_SITE)
"RTN","MAGQBU6A",95,0)
 . . Q
"RTN","MAGQBU6A",96,0)
 . Q
"RTN","MAGQBU6A",97,0)
 K ARRAY
"RTN","MAGQBU6A",98,0)
 Q
"RTN","MAGQBU6A",99,0)
RLOC(LIST,RESULT) ; Delete Network Location file entry
"RTN","MAGQBU6A",100,0)
 N DA,DIK,EN,PC,PLACE,APP
"RTN","MAGQBU6A",101,0)
 S X="ERR^MAGQBU6A",@^%ZOSF("TRAP")
"RTN","MAGQBU6A",102,0)
 S RESULT="1"
"RTN","MAGQBU6A",103,0)
 S EN=""  F  S EN=$O(LIST(EN)) Q:EN=""  D
"RTN","MAGQBU6A",104,0)
 . F PC=2:1:$L(LIST(EN),U) D
"RTN","MAGQBU6A",105,0)
 . . S DA=$P(LIST(EN),U,PC) Q:'DA
"RTN","MAGQBU6A",106,0)
 . . S PLACE=$P($G(^MAG(2005.2,DA,0)),U,10)
"RTN","MAGQBU6A",107,0)
 . . I '$D(^MAG(2005.2,DA,0)) S RESULT="-1^This is an invalid entry." Q
"RTN","MAGQBU6A",108,0)
 . . I $P($G(^MAG(2005.2,DA,0)),U,7)["GRP" Q:'$$GRP(DA,PLACE,.RESULT)
"RTN","MAGQBU6A",109,0)
 . . E   I DA=$$CWL^MAGBAPI(PLACE) D  ; Attempt to reset the Current Write location wo an able share within the current group
"RTN","MAGQBU6A",110,0)
 . . . N MIN,SPACE,SIZE,IEN,TSPACE,TSIZE,GRP
"RTN","MAGQBU6A",111,0)
 . . . S (TSIZE,TSPACE,SPACE,SIZE,IEN,CNT)=0
"RTN","MAGQBU6A",112,0)
 . . . S MIN=$$SPARM^MAGQBUT
"RTN","MAGQBU6A",113,0)
 . . . S GRP=$$GRP^MAGQBUT(PLACE)
"RTN","MAGQBU6A",114,0)
 . . . D FSP^MAGQBUT(MIN,.SPACE,.SIZE,.IEN,.TSPACE,.TSIZE,PLACE,.GRP,DA)
"RTN","MAGQBU6A",115,0)
 . . . I IEN>0 D  Q
"RTN","MAGQBU6A",116,0)
 . . . . I $$VALRD^MAGQBUT(IEN,PLACE,GRP) D
"RTN","MAGQBU6A",117,0)
 . . . . . S APP="Network Location Delete: RAID"
"RTN","MAGQBU6A",118,0)
 . . . . . D SCWL^MAGQBUT(IEN,PLACE,GRP,APP,DUZ)
"RTN","MAGQBU6A",119,0)
 . . . . . S RESULT="1^The Current Write Location has been reset to: "_IEN
"RTN","MAGQBU6A",120,0)
 . . . . . Q
"RTN","MAGQBU6A",121,0)
 . . . . E  S RESULT="0^This is invalid share: "_IEN Q
"RTN","MAGQBU6A",122,0)
 . . . S RESULT="0^This is the current Write Location and there are no other able members in the current group."
"RTN","MAGQBU6A",123,0)
 . . . Q
"RTN","MAGQBU6A",124,0)
 . . Q:$P(RESULT,U,1)<1
"RTN","MAGQBU6A",125,0)
 . . D GRPEN(DA)
"RTN","MAGQBU6A",126,0)
 . . S DIK="^MAG(2005.2,"
"RTN","MAGQBU6A",127,0)
 . . D ^DIK
"RTN","MAGQBU6A",128,0)
 . . K DIK,DA
"RTN","MAGQBU6A",129,0)
 . . Q
"RTN","MAGQBU6A",130,0)
 . Q
"RTN","MAGQBU6A",131,0)
 Q
"RTN","MAGQBU6A",132,0)
 ;
"RTN","MAGQBU6A",133,0)
GRP(GRPIEN,PLACE,RESULT) ;
"RTN","MAGQBU6A",134,0)
 N GROUP,CWL,APP,RES
"RTN","MAGQBU6A",135,0)
 S RES=1
"RTN","MAGQBU6A",136,0)
 I GRPIEN=$$GRP^MAGQBUT(PLACE) D  ;Advance RAID Group and reset the Current Write Location
"RTN","MAGQBU6A",137,0)
 . S GROUP=$$NXTGP^MAGQBUT(PLACE,GRPIEN)
"RTN","MAGQBU6A",138,0)
 . I GROUP=GRPIEN S RESULT="-1^This Network Location is the Current Write Group.",RES=0 Q 
"RTN","MAGQBU6A",139,0)
 . S CWL=$O(^MAG(2005.2,GROUP,7,"B",""))
"RTN","MAGQBU6A",140,0)
 . I CWL<1 S RESULT="-1^The Current Write Group has no member shares.",RES=0 Q
"RTN","MAGQBU6A",141,0)
 . S APP="GRP^MAGQBU6A: Group Delete"
"RTN","MAGQBU6A",142,0)
 . D SCWL^MAGQBUT(CWL,PLACE,GROUP,APP,DUZ)
"RTN","MAGQBU6A",143,0)
 . Q
"RTN","MAGQBU6A",144,0)
 D:RES
"RTN","MAGQBU6A",145,0)
 . N INDX
"RTN","MAGQBU6A",146,0)
 . S INDX="" F  S INDX=$O(^MAG(2005.2,GRPIEN,7,"B",INDX)) Q:'INDX  D
"RTN","MAGQBU6A",147,0)
 . . S $P(^MAG(2005.2,INDX,1),U,8)=""
"RTN","MAGQBU6A",148,0)
 . . Q
"RTN","MAGQBU6A",149,0)
 . Q
"RTN","MAGQBU6A",150,0)
 Q RES
"RTN","MAGQBU6A",151,0)
GRPEN(DUPIEN) ;
"RTN","MAGQBU6A",152,0)
 ;DUPIEN is the duplicate entry in file 2005.2 being deleted.
"RTN","MAGQBU6A",153,0)
 ;This module checks if the duplicate entry is part of a RAID group and
"RTN","MAGQBU6A",154,0)
 ;deletes the entry to prevent hanging pointers.
"RTN","MAGQBU6A",155,0)
 N DA,DIK,MAGIEN,SITE
"RTN","MAGQBU6A",156,0)
 Q:'+$G(DUPIEN)
"RTN","MAGQBU6A",157,0)
 S SITE=0 F  S SITE=$O(^MAG(2005.2,"F",SITE)) Q:'SITE  D
"RTN","MAGQBU6A",158,0)
 . Q:'$D(^MAG(2005.2,"F",SITE,"GRP"))
"RTN","MAGQBU6A",159,0)
 . S MAGIEN=0 F  S MAGIEN=$O(^MAG(2005.2,"F",SITE,"GRP",MAGIEN)) Q:'MAGIEN  D
"RTN","MAGQBU6A",160,0)
 . . I $D(^MAG(2005.2,MAGIEN,7,"B",DUPIEN)) D
"RTN","MAGQBU6A",161,0)
 . . . N DA,DIK
"RTN","MAGQBU6A",162,0)
 . . . S DA=$O(^MAG(2005.2,MAGIEN,7,"B",DUPIEN,0)) Q:'DA
"RTN","MAGQBU6A",163,0)
 . . . S DA(1)=MAGIEN,DIK="^MAG(2005.2,"_DA(1)_",7," D ^DIK K DA,DIK
"RTN","MAGQBU6A",164,0)
 . . . Q
"RTN","MAGQBU6A",165,0)
 . . Q 
"RTN","MAGQBU6A",166,0)
 . Q
"RTN","MAGQBU6A",167,0)
 Q
"RTN","MAGQBU6A",168,0)
RLOCA(RESULT,RLOC) ; Delete Network Location file entry
"RTN","MAGQBU6A",169,0)
 ; [RPC:MAGQ DEL NLOC ]
"RTN","MAGQBU6A",170,0)
 Q:'$D(^XUSEC("MAG SYSTEM",DUZ))  ; Requires the "MAG SYS" security key
"RTN","MAGQBU6A",171,0)
 N LST,RES
"RTN","MAGQBU6A",172,0)
 S LST(1)=$P(RLOC,U,2)_U_$P(RLOC,U,2),RES="1"
"RTN","MAGQBU6A",173,0)
 D RLOC(.LST,.RES)
"RTN","MAGQBU6A",174,0)
 S RESULT=RES
"RTN","MAGQBU6A",175,0)
 K LST
"RTN","MAGQBU6A",176,0)
 Q 
"RTN","MAGQBU6A",177,0)
REQDUP ; Are there duplicate .01 entries? If so rename by adding A,B, etc. 
"RTN","MAGQBU6A",178,0)
 N ARRAY,CHAR,CNT,IEN,NAME,NME,NODE,NNAME,MSG,ROUTE,SITE,TYPE
"RTN","MAGQBU6A",179,0)
 S NAME="" F  S NAME=$O(^MAG(2005.2,"B",NAME)) Q:NAME=""  D
"RTN","MAGQBU6A",180,0)
 . S IEN="",CNT=0 F  S IEN=$O(^MAG(2005.2,"B",NAME,IEN)) Q:'IEN  D
"RTN","MAGQBU6A",181,0)
 . . ;GET TYPE ON MAG TYPE WILL BE DUPLICATED.
"RTN","MAGQBU6A",182,0)
 . . S NODE=$G(^MAG(2005.2,IEN,0)),TYPE=$P(NODE,"^",7),SITE=$P(NODE,"^",10)
"RTN","MAGQBU6A",183,0)
 . . S ROUTE=$P(NODE,"^",9)
"RTN","MAGQBU6A",184,0)
 . . ;QUIT IF ROUTER, NOT MAG OR WORM TYPE
"RTN","MAGQBU6A",185,0)
 . . Q:ROUTE
"RTN","MAGQBU6A",186,0)
 . . Q:NAME["MUSE"
"RTN","MAGQBU6A",187,0)
 . . I TYPE["MAG"!(TYPE["WORM") D
"RTN","MAGQBU6A",188,0)
 . . . S NME(NAME,SITE)=$G(NME(NAME,SITE))+1
"RTN","MAGQBU6A",189,0)
 . . . S ARRAY(NAME,SITE,IEN)=CNT,CNT=CNT+1
"RTN","MAGQBU6A",190,0)
 . . . Q
"RTN","MAGQBU6A",191,0)
 . . Q
"RTN","MAGQBU6A",192,0)
 . Q
"RTN","MAGQBU6A",193,0)
 S NAME="" F  S NAME=$O(ARRAY(NAME)) Q:NAME=""  S SITE=0 F  S SITE=$O(ARRAY(NAME,SITE)) Q:'SITE  D
"RTN","MAGQBU6A",194,0)
 . Q:+$G(NME(NAME,SITE))'>1
"RTN","MAGQBU6A",195,0)
 . S IEN=0 F  S IEN=$O(ARRAY(NAME,SITE,IEN)) Q:'IEN  D
"RTN","MAGQBU6A",196,0)
 . . S CHAR=$G(ARRAY(NAME,SITE,IEN)) Q:'CHAR  S CHAR=(63+CHAR)
"RTN","MAGQBU6A",197,0)
 . . S NNAME=NAME_$C(CHAR)
"RTN","MAGQBU6A",198,0)
 . . Q:'$D(^MAG(2005.2,IEN,0))
"RTN","MAGQBU6A",199,0)
 . . N FDA S FDA(2005.2,IEN_",",.01)=NNAME D UPDATE^DIE("U","FDA")
"RTN","MAGQBU6A",200,0)
 . . S ^XTMP("MAGP39","^MAG(2005.2,"_IEN_",0)",1)=NNAME_U_NAME
"RTN","MAGQBU6A",201,0)
 . . S MSG="Duplicate named Network Location entry, "_NAME_" was renamed to "_NNAME
"RTN","MAGQBU6A",202,0)
 . . D PMSG^MAGQBUT6(MSG)
"RTN","MAGQBU6A",203,0)
 . . S (CHAR,NNAME)=""
"RTN","MAGQBU6A",204,0)
 . . Q
"RTN","MAGQBU6A",205,0)
 . Q
"RTN","MAGQBU6A",206,0)
 Q
"RTN","MAGQBU6A",207,0)
RESTART ;
"RTN","MAGQBU6A",208,0)
 ;Controls the purging of this global at the sites.
"RTN","MAGQBU6A",209,0)
 ;^XTMP("MAGP39","DUPSHARE",0)=X_"^"_X2_"^"_"Patch 39 Consolidating Network Locations"
"RTN","MAGQBU6A",210,0)
 ;contains the list of duplicate shares to be used to remove dangling network entries.
"RTN","MAGQBU6A",211,0)
 ;^XTMP("MAGP39","DUPSHARE","ENTRIES",ENTRY,PATH)= Original ien^nn^nn (nn^nn are the duplicate entries).
"RTN","MAGQBU6A",212,0)
 ;set in MAGQBUT6 while processing the entries in file 2005 and 2005.1
"RTN","MAGQBU6A",213,0)
 ;^XTMP("MAGP39","DUPSHARE","LAST")=Last ien processed in either 2005 or 2005.1
"RTN","MAGQBU6A",214,0)
 ;
"RTN","MAGQBU6A",215,0)
 N ARRAY,ENTRY,SHAREDIR
"RTN","MAGQBU6A",216,0)
 I '$D(^XMTP("MAGP39","DUPSHARE")) W !,"Nothing to process, global does not exist." H 2 Q
"RTN","MAGQBU6A",217,0)
 ;rebuild the list
"RTN","MAGQBU6A",218,0)
 I '$D(^XMTP("MAGP39","DUPSHARE","ENTRIES")) D  Q
"RTN","MAGQBU6A",219,0)
 . W !,"No duplicate shares information available." H 2
"RTN","MAGQBU6A",220,0)
 . Q
"RTN","MAGQBU6A",221,0)
 S ENTRY=0 F  S ENTRY=$O(^XMTP("MAGP39","DUPSHARE","ENTRIES",ENTRY)) Q:'ENTRY  D
"RTN","MAGQBU6A",222,0)
 . S SHAREDIR="" S SHAREDIR=$O(^XMTP("MAGP39","DUPSHARE","ENTRIES",ENTRY,SHAREDIR)) D:SHAREDIR'=""
"RTN","MAGQBU6A",223,0)
 . . S ARRAY(SHAREDIR)=$G(^XMTP("MAGP39","DUPSHARE","ENTRIES",ENTRY,SHAREDIR))
"RTN","MAGQBU6A",224,0)
 . . Q
"RTN","MAGQBU6A",225,0)
 . Q
"RTN","MAGQBU6A",226,0)
 S ENTRY=$G(^XTMP("MAGP39","DUPSHARE","LAST")) Q:'ENTRY
"RTN","MAGQBU6A",227,0)
 D RSREF^MAGQBUT6(ARRAY,ENTRY)
"RTN","MAGQBU6A",228,0)
 Q
"RTN","MAGQBU6A",229,0)
PRINT ;Print out the entries in files 2005 and 2005.1 whose fields were modified by the redundant share job
"RTN","MAGQBU6A",230,0)
 ;
"RTN","MAGQBU6A",231,0)
 I '$D(^XTMP("MAGP39","IMAGEFILE")) W !,"Sorry, the XTMP global has been cleared, nothing to display. Quitting" H 2 Q
"RTN","MAGQBU6A",232,0)
 W !,"Image files 2005, 2005.1 & 2006.035 whose network location was reset as a result of redundant network location entries."
"RTN","MAGQBU6A",233,0)
 N POP,ZTDESC,ZTRTN,ZTSK
"RTN","MAGQBU6A",234,0)
 S %ZIS="QMP" D ^%ZIS K %ZIS I POP Q
"RTN","MAGQBU6A",235,0)
 I '$D(IO("Q")) U IO D STARTPRT Q
"RTN","MAGQBU6A",236,0)
 ; task job
"RTN","MAGQBU6A",237,0)
 S ZTRTN="STARTPRT^MAGQBU6A",ZTDESC="Patch 39 changes to Image files."
"RTN","MAGQBU6A",238,0)
 D ^%ZTLOAD
"RTN","MAGQBU6A",239,0)
 W !!,$S(+$D(ZTSK):">>> Job has been queued. The task number is "_ZTSK_".",1:">>> Unable to queue this job.") K IO("Q")
"RTN","MAGQBU6A",240,0)
 Q
"RTN","MAGQBU6A",241,0)
STARTPRT ;
"RTN","MAGQBU6A",242,0)
 N ANS,FILE,FIELD,IEN,HEADING,PAGE,STOP,TEXT,ZTREQ
"RTN","MAGQBU6A",243,0)
 S ZTREQ="@"  ;TaskMan utilities to delete the task.
"RTN","MAGQBU6A",244,0)
 S:'$G(DTIME) DTIME=600
"RTN","MAGQBU6A",245,0)
 S PAGE=0,HEADING="Patch 39 changes to Image files 2005,2005.1 and 2006.035"
"RTN","MAGQBU6A",246,0)
 D HDR
"RTN","MAGQBU6A",247,0)
 S (STOP,FILE)=0
"RTN","MAGQBU6A",248,0)
 F  S FILE=$O(^XTMP("MAGP39","IMAGEFILE",FILE)) Q:'FILE!STOP  D 
"RTN","MAGQBU6A",249,0)
 . S IEN=0 F  S IEN=$O(^XTMP("MAGP39","IMAGEFILE",FILE,IEN)) Q:'IEN!STOP  D
"RTN","MAGQBU6A",250,0)
 . . S FIELD=0 F  S FIELD=$O(^XTMP("MAGP39","IMAGEFILE",FILE,IEN,FIELD)) Q:'FIELD!STOP  D
"RTN","MAGQBU6A",251,0)
 . . . S TEXT=$G(^XTMP("MAGP39","IMAGEFILE",FILE,IEN,FIELD)) D LINE
"RTN","MAGQBU6A",252,0)
 . . . Q
"RTN","MAGQBU6A",253,0)
 . . Q
"RTN","MAGQBU6A",254,0)
 . Q
"RTN","MAGQBU6A",255,0)
 D ^%ZISC
"RTN","MAGQBU6A",256,0)
 Q
"RTN","MAGQBU6A",257,0)
HDR ;
"RTN","MAGQBU6A",258,0)
 W @IOF S PAGE=PAGE+1
"RTN","MAGQBU6A",259,0)
 W !?2,HEADING,"  Page: ",PAGE
"RTN","MAGQBU6A",260,0)
 W !,?10,"___________________________________",!
"RTN","MAGQBU6A",261,0)
 Q
"RTN","MAGQBU6A",262,0)
LINE ;Display output
"RTN","MAGQBU6A",263,0)
 D HDR:$Y+4>IOSL
"RTN","MAGQBU6A",264,0)
 W !,"File: "_FILE_" entry: "_IEN_" was modified by changing "_TEXT
"RTN","MAGQBU6A",265,0)
 I $E(IOST,1,2)["C-",$Y+4>IOSL D
"RTN","MAGQBU6A",266,0)
 . W !,"Press RETURN to continue or '^' to exit: "
"RTN","MAGQBU6A",267,0)
 . R ANS:DTIME S STOP=$S(ANS="^":1,1:0)
"RTN","MAGQBU6A",268,0)
 . Q
"RTN","MAGQBU6A",269,0)
 Q
"RTN","MAGQBU6A",270,0)
ERR ;
"RTN","MAGQBU6A",271,0)
 N ERRXX
"RTN","MAGQBU6A",272,0)
 S ERRXX=$$EC^%ZOSV
"RTN","MAGQBU6A",273,0)
 D ^%ZTER
"RTN","MAGQBU6A",274,0)
 D ^XUSCLEAN
"RTN","MAGQBU6A",275,0)
 Q
"RTN","MAGQBU6A",276,0)
 ;
"RTN","MAGQBUT")
0^17^B143602408
"RTN","MAGQBUT",1,0)
MAGQBUT ;WOIFO/RMP - Imaging Background Processor Utilities ; 26 Jan 2011 10:16 AM
"RTN","MAGQBUT",2,0)
 ;;3.0;IMAGING;**7,8,48,20,39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGQBUT",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGQBUT",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBUT",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBUT",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBUT",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBUT",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBUT",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBUT",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBUT",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBUT",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBUT",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBUT",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBUT",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBUT",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBUT",17,0)
 ;;
"RTN","MAGQBUT",18,0)
 Q
"RTN","MAGQBUT",19,0)
CHGSERV(RESULT,NOTIFY,WSOS,BPWS) ;
"RTN","MAGQBUT",20,0)
 ; RPC[MAGQ FS CHNGE]
"RTN","MAGQBUT",21,0)
 ; RESULT VALUES:-1=NO RG MEMBERS,0=BELOW RESERVE,1=ABOVE RESERVE*PURGE FACTOR,2=BETWEEN RESERVE AND RESERVE*PURGE FACTOR
"RTN","MAGQBUT",22,0)
 ; ^CWL-PHYSICAL REFERENCE^CWL-TOTAL SPACE^PURGE^%FREE SPACE^PURGE_GROUP_IEN^VERIFY^RGADVANCE
"RTN","MAGQBUT",23,0)
 N SPACE,IEN,SIZE,CWL,MIN,CNT,TNODE,TINT,NOW,TLTIME,TOD,PLACE,TSPACE,TSIZE,AUTON,GROUP
"RTN","MAGQBUT",24,0)
 N APP,PFACTOR,NG,WSIEN,X,OG
"RTN","MAGQBUT",25,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT",26,0)
 S U="^",(SPACE,SIZE,CNT,TSPACE,TSIZE)=0,(RESULT,IEN,NG)="" ; T23
"RTN","MAGQBUT",27,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBUT",28,0)
 S APP="MAGQ FS CHNGE: "_BPWS
"RTN","MAGQBUT",29,0)
 S WSIEN=$O(^MAG(2006.8,"C",PLACE,BPWS,""))
"RTN","MAGQBUT",30,0)
 S MIN=$$SPARM
"RTN","MAGQBUT",31,0)
 S CWL=$$CWL^MAGBAPI(PLACE)
"RTN","MAGQBUT",32,0)
 S (GROUP,OG)=$$GRP(PLACE)
"RTN","MAGQBUT",33,0)
 D:SPACE>0 REPCWL(CWL,GROUP,.RESULT) ; Update Result with Current Write Group properties
"RTN","MAGQBUT",34,0)
 S PFACTOR=$$GET1^DIQ(2006.1,PLACE,"60.5","E")
"RTN","MAGQBUT",35,0)
 S PFACTOR=$S(+PFACTOR:+PFACTOR,1:2) ; If only one group default to 1
"RTN","MAGQBUT",36,0)
 D SPRGE(WSIEN,PLACE,.RESULT) ; Check for Scheduled Purge
"RTN","MAGQBUT",37,0)
 D SVERI(WSIEN,PLACE,.RESULT) ; Check for Scheduled Verifier
"RTN","MAGQBUT",38,0)
 D RGADV(PLACE,.GROUP,.RESULT)  ;Check for RG Advance (Scheduled RAID group advance)
"RTN","MAGQBUT",39,0)
 I $P($G(^MAG(2006.1,PLACE,1)),U,10) D NAUTOW(PLACE,CWL,.SPACE,.SIZE,.RESULT,NOTIFY,GROUP) Q  ;Cache balancing off
"RTN","MAGQBUT",40,0)
 ; Evaluate space for auto-write location update/should find group with space
"RTN","MAGQBUT",41,0)
 F  D FSP(MIN,.SPACE,.SIZE,.IEN,.TSPACE,.TSIZE,PLACE,GROUP,"") Q:IEN  D  Q:$P(RESULT,U,1)="-1"  Q:GROUP=$$GRP(PLACE)  Q:OG=GROUP
"RTN","MAGQBUT",42,0)
 . S NG=$$NXTGP(PLACE,GROUP)
"RTN","MAGQBUT",43,0)
 . I NG=GROUP D  Q
"RTN","MAGQBUT",44,0)
 . . D NGF(PLACE) ; Mail "Get_Next_RAID_Group_failure" message
"RTN","MAGQBUT",45,0)
 . . I '$P($G(^MAG(2005.2,NG,7,0)),U,4)  S $P(RESULT,U,1)="-1" ; ZERO MEMBER COUNT - T23
"RTN","MAGQBUT",46,0)
 . . Q
"RTN","MAGQBUT",47,0)
 . S GROUP=NG
"RTN","MAGQBUT",48,0)
 . Q
"RTN","MAGQBUT",49,0)
 I OG'=GROUP,$P(RESULT,U,8)'="" S $P(RESULT,U,8)="Automatic RGADVANCE"
"RTN","MAGQBUT",50,0)
 Q:$P(RESULT,U,1)="-1"
"RTN","MAGQBUT",51,0)
 I TSIZE D REPCWL(IEN,GROUP,.RESULT,TSPACE,TSIZE) ; %FREE SPACE
"RTN","MAGQBUT",52,0)
 E  S $P(RESULT,U,5)="0.00"
"RTN","MAGQBUT",53,0)
 I +IEN'=CWL,IEN>0 D  ; on Change event 
"RTN","MAGQBUT",54,0)
 . D SCWL(IEN,PLACE,GROUP,APP,DUZ)  ; UPDATES SITE PARAMETER FILE WITH CURRENT WRITE AND GROUP LOCATIONS
"RTN","MAGQBUT",55,0)
 . Q
"RTN","MAGQBUT",56,0)
 ; Evaluate space for auto purge contingencies for current RAID group
"RTN","MAGQBUT",57,0)
 I TSIZE>0,(((TSPACE/TSIZE)*100)>(PFACTOR*MIN)) S $P(RESULT,U)=1 Q
"RTN","MAGQBUT",58,0)
 S $P(RESULT,U)=$S('TSIZE:0,(((TSPACE/TSIZE)*100)>MIN):1,SPACE>0:2,1:0)
"RTN","MAGQBUT",59,0)
 S $P(RESULT,U,2,3)=$P($G(^MAG(2005.2,+$P(^MAG(2006.1,PLACE,0),U,3),0)),U,1,2)
"RTN","MAGQBUT",60,0)
 I ($P($G(^MAG(2006.1,PLACE,"BPPURGE")),U)&(SPACE>0)&($$GET1^DIQ(2006.8,WSIEN,"3","I")="1")) D  Q  ;AUTOPURGE IS ENABLED
"RTN","MAGQBUT",61,0)
 . S NG=$$NXTGP(PLACE,GROUP,"1") ;NEXT PURGE CAPABLE GROUP
"RTN","MAGQBUT",62,0)
 . I 'NG D NGF(PLACE) Q
"RTN","MAGQBUT",63,0)
 . Q:($P(^MAG(2006.1,PLACE,"BPPURGE"),U,7))+4>$$DT^XLFDT  ; Allow only 1 auto-purge per 4 days
"RTN","MAGQBUT",64,0)
 . Q:$$UPPER^MAGQE4(WSOS)'["SERVER"
"RTN","MAGQBUT",65,0)
 . S $P(RESULT,U,4)="AUTO_PURGE"
"RTN","MAGQBUT",66,0)
 . S $P(RESULT,U,6)=NG ;GROUP TO BE PURGED
"RTN","MAGQBUT",67,0)
 . D DFNIQ^MAGQBPG1("","An automatic RAID Group purge has been initiated for the following",0,PLACE,"AUTO_RAID_GROUP_PURGE")
"RTN","MAGQBUT",68,0)
 . D DFNIQ^MAGQBPG1("","VistA Imaging RAID group: "_$P($G(^MAG(2005.2,NG,0)),U,1),0,PLACE,"AUTO_RAID_GROUP_PURGE")
"RTN","MAGQBUT",69,0)
 . D DFNIQ^MAGQBPG1("","Auto_RAID_group_purge",1,PLACE,"AUTO_RAID_GROUP_PURGE")
"RTN","MAGQBUT",70,0)
 . Q
"RTN","MAGQBUT",71,0)
 I TSIZE>0,(((TSPACE/TSIZE)*100)>MIN) Q
"RTN","MAGQBUT",72,0)
 D:(NOTIFY!(SPACE>0)) TMESS(SPACE,"VistA Imaging RAID storage is Critically Low",PLACE)
"RTN","MAGQBUT",73,0)
 Q 
"RTN","MAGQBUT",74,0)
TMESS(SPACE,TS,PLACE) ;Trigger a message
"RTN","MAGQBUT",75,0)
 N TN,PC,SER S TN=$$GETMI^MAGQBUT5(TS,PLACE)
"RTN","MAGQBUT",76,0)
 S PC=$P($G(^MAG(2006.1,PLACE,"BPPURGE")),U)
"RTN","MAGQBUT",77,0)
 S SER=$$PURGES(PLACE)
"RTN","MAGQBUT",78,0)
 Q:$$FMADD^XLFDT(+$P(TN,"^",2),"",+$P(TN,U,1),"","")>$$NOW^XLFDT
"RTN","MAGQBUT",79,0)
 D ICCL^MAGQBUT1(CNT_U_TS_U_SPACE_U_PC_SER,$P(TN,"^",1)_" hours.",PLACE)
"RTN","MAGQBUT",80,0)
 Q
"RTN","MAGQBUT",81,0)
PURGES(PLACE) ; BP Server Assigned to Auto-purge
"RTN","MAGQBUT",82,0)
 N IEN,NAME,SER S (NAME,SER)=""
"RTN","MAGQBUT",83,0)
 F  S NAME=$O(^MAG(2006.8,"C",PLACE,NAME)) Q:NAME=""  D  Q:SER]""
"RTN","MAGQBUT",84,0)
 . S IEN=$O(^MAG(2006.8,"C",PLACE,NAME,"")) Q:'IEN
"RTN","MAGQBUT",85,0)
 . I $P($G(^MAG(2006.8,IEN,0)),U,4)=1 S SER=$P($G(^MAG(2006.8,IEN,1)),U,1)
"RTN","MAGQBUT",86,0)
 . Q 
"RTN","MAGQBUT",87,0)
 Q SER
"RTN","MAGQBUT",88,0)
NXTGP(PL,GRP,FP) ; return sure the NEXT able group (Canonically sorted by name)
"RTN","MAGQBUT",89,0)
 N INDX,TMP,GNAME
"RTN","MAGQBUT",90,0)
 S INDX="",GNAME=$P($G(^MAG(2005.2,GRP,0)),U)
"RTN","MAGQBUT",91,0)
 F  S INDX=$O(^MAG(2005.2,"F",PL,"GRP",INDX)) Q:'INDX  D
"RTN","MAGQBUT",92,0)
 . Q:'$P($G(^MAG(2005.2,INDX,7,0)),U,4)  ; ZERO MEMBER COUNT
"RTN","MAGQBUT",93,0)
 . ; CHECK MEMBERS FOR ONLINE, READABLE, HASHED, AND SPACE
"RTN","MAGQBUT",94,0)
 . Q:'$$GABLE(INDX,$G(FP))
"RTN","MAGQBUT",95,0)
 . S TMP($P($G(^MAG(2005.2,INDX,0)),U),INDX)=""
"RTN","MAGQBUT",96,0)
 . Q
"RTN","MAGQBUT",97,0)
 Q:'$D(TMP) GRP
"RTN","MAGQBUT",98,0)
 S INDX=$O(TMP(GNAME)) ;TRY NEXT GROUP NAME CANONICALLY CH
"RTN","MAGQBUT",99,0)
 I INDX="" S INDX=$O(TMP("")) ; ELSE LOOP TO FIRST
"RTN","MAGQBUT",100,0)
 S INDX=$S(INDX'="":$O(TMP(INDX,"")),1:"") ; IF ANY GROUPS QUALIFY
"RTN","MAGQBUT",101,0)
 K TMP
"RTN","MAGQBUT",102,0)
 Q $S(INDX'="":INDX,1:GRP)
"RTN","MAGQBUT",103,0)
GABLE(GR,FP) ; next group able (has online, readable, hashed)
"RTN","MAGQBUT",104,0)
 N IEN,RESULT,MIN,SPACE,SIZE
"RTN","MAGQBUT",105,0)
 S (IEN,RESULT,SPACE,SIZE)=0
"RTN","MAGQBUT",106,0)
 S MIN=$$SPARM
"RTN","MAGQBUT",107,0)
 F  S IEN=$O(^MAG(2005.2,GR,7,"B",IEN)) Q:'IEN  D
"RTN","MAGQBUT",108,0)
 . Q:$P($G(^MAG(2005.2,IEN,0)),U,6,7)'="1^MAG"  ; Not online/MAG
"RTN","MAGQBUT",109,0)
 . Q:$P($G(^MAG(2005.2,IEN,1)),U,6)="1"  ; Read-only
"RTN","MAGQBUT",110,0)
 . Q:$P($G(^MAG(2005.2,IEN,0)),U,3)'>0  ; No total space reported
"RTN","MAGQBUT",111,0)
 . Q:$P($G(^MAG(2005.2,IEN,0)),U,8)'="Y"  ; Not hashed
"RTN","MAGQBUT",112,0)
 . Q:$P($G(^MAG(2005.2,IEN,0)),U,2)[":"  ;skip if it appears to be a local drive
"RTN","MAGQBUT",113,0)
 . Q:$E($P($G(^MAG(2005.2,IEN,0)),U,2),1,2)'="\\"  ; skip if not a normal share path address
"RTN","MAGQBUT",114,0)
 . Q:('$G(FP)&'$$MAXSP(IEN,.SPACE,.SIZE,$G(^MAG(2005.2,IEN,0)),MIN))
"RTN","MAGQBUT",115,0)
 . S RESULT="1"
"RTN","MAGQBUT",116,0)
 . Q
"RTN","MAGQBUT",117,0)
 Q RESULT
"RTN","MAGQBUT",118,0)
MAXSP(IEN,FS,SZ,NODE,MIN) ; Called from FSP (RPC[MAGQ FS CHNGE]CHGSERV:FSP) 
"RTN","MAGQBUT",119,0)
 N SPACE,SIZE
"RTN","MAGQBUT",120,0)
 S SPACE=+$P(NODE,U,5),SIZE=+$P(NODE,U,3)
"RTN","MAGQBUT",121,0)
 I SIZE>0,(((SPACE/SIZE)*100)>MIN),SPACE>FS D  Q 1
"RTN","MAGQBUT",122,0)
 . S FS=SPACE,SZ=SIZE
"RTN","MAGQBUT",123,0)
 Q 0
"RTN","MAGQBUT",124,0)
SPARM() ;Site Parameter for PERCENT server space to be held in reserve
"RTN","MAGQBUT",125,0)
 N VALUE
"RTN","MAGQBUT",126,0)
 S VALUE=$P($G(^MAG(2006.1,$$PLACE^MAGBAPI(+$G(DUZ(2))),1)),U,8)
"RTN","MAGQBUT",127,0)
 Q $S(VALUE>0:VALUE,1:5)
"RTN","MAGQBUT",128,0)
SCWL(IEN,PLACE,GROUP,APP,DUZ) ; Sets updates the Current Write Location
"RTN","MAGQBUT",129,0)
 N X,X2,CNT
"RTN","MAGQBUT",130,0)
 Q:'$$VALRD(IEN,PLACE,GROUP)
"RTN","MAGQBUT",131,0)
 S X=$$DT^XLFDT,X2=$$FMADD^XLFDT(X,30,"","","")
"RTN","MAGQBUT",132,0)
 I '$D(^XTMP("MAGSCWL "_X,0)) D 
"RTN","MAGQBUT",133,0)
 . S ^XTMP("MAGSCWL "_X,0)=X2_"^"_X_"^"_"Recording current write location updates"
"RTN","MAGQBUT",134,0)
 S ^XTMP("MAGSCWL "_X,$$NOW^XLFDT)="CWL: "_IEN_" ( "_$P($G(^MAG(2005.2,IEN,0)),U,1,2)_")^PLACE: "_PLACE_"^GROUP: "_GROUP_"^Application: "_$G(APP)_"^DUZ: "_DUZ
"RTN","MAGQBUT",135,0)
 S $P(^MAG(2006.1,PLACE,0),U,10)=GROUP
"RTN","MAGQBUT",136,0)
 S $P(^MAG(2006.1,PLACE,0),U,3)=IEN
"RTN","MAGQBUT",137,0)
 S $P(^MAG(2006.1,PLACE,"PACS"),U,3)=IEN
"RTN","MAGQBUT",138,0)
 Q
"RTN","MAGQBUT",139,0)
EGR(PL,GRP,ACTION) ; Edit Group Read Only 
"RTN","MAGQBUT",140,0)
 N INDX,ZNODE,NODE1
"RTN","MAGQBUT",141,0)
 S INDX=0
"RTN","MAGQBUT",142,0)
 F  S INDX=$O(^MAG(2005.2,INDX)) Q:INDX'?1N.N  D
"RTN","MAGQBUT",143,0)
 . S ZNODE=$G(^MAG(2005.2,INDX,0))
"RTN","MAGQBUT",144,0)
 . Q:$P(ZNODE,U,10)'=PLACE
"RTN","MAGQBUT",145,0)
 . Q:$P(ZNODE,U,6,7)'["1^MAG"
"RTN","MAGQBUT",146,0)
 . Q:$P(ZNODE,U,9)="1"  ;ROUTING SHARE
"RTN","MAGQBUT",147,0)
 . S NODE1=$G(^MAG(2005.2,INDX,1))
"RTN","MAGQBUT",148,0)
 . Q:$P(NODE1,U,8)'=GRP
"RTN","MAGQBUT",149,0)
 . I ACTION="E" S $P(^MAG(2005.2,INDX,1),U,6)="0"
"RTN","MAGQBUT",150,0)
 . E  S $P(^MAG(2005.2,INDX,1),U,6)="1"
"RTN","MAGQBUT",151,0)
 . Q
"RTN","MAGQBUT",152,0)
 Q
"RTN","MAGQBUT",153,0)
GRP(PLACE) ;
"RTN","MAGQBUT",154,0)
 Q $S(+$P($G(^MAG(2006.1,PLACE,0)),U,10):+$P($G(^MAG(2006.1,PLACE,0)),U,10),1:$$NXTGP(PLACE,0))
"RTN","MAGQBUT",155,0)
FSP(MIN,SPACE,SIZE,IEN,TSPACE,TSIZE,PLACE,GROUP,FILTER) ; Find Space called from (RPC[MAGQ FS CHNGE]CHGSERV)
"RTN","MAGQBUT",156,0)
 N INDX,ZNODE,NODE1
"RTN","MAGQBUT",157,0)
 S (INDX,TSPACE,TSIZE)=0
"RTN","MAGQBUT",158,0)
 F  S INDX=$O(^MAG(2005.2,INDX)) Q:INDX'?1N.N  D
"RTN","MAGQBUT",159,0)
 . Q:'$$VALRD(INDX,PLACE,GROUP)
"RTN","MAGQBUT",160,0)
 . S ZNODE=$G(^MAG(2005.2,INDX,0))
"RTN","MAGQBUT",161,0)
 . S TSPACE=TSPACE+(+$P(ZNODE,U,5))
"RTN","MAGQBUT",162,0)
 . S TSIZE=TSIZE+(+$P(ZNODE,U,3))
"RTN","MAGQBUT",163,0)
 . S CNT=CNT+1
"RTN","MAGQBUT",164,0)
 . Q:(+FILTER=INDX)  ; Find a share within the group other than this one
"RTN","MAGQBUT",165,0)
 . I $$MAXSP(INDX,.SPACE,.SIZE,ZNODE,MIN) S IEN=INDX
"RTN","MAGQBUT",166,0)
 . Q
"RTN","MAGQBUT",167,0)
 Q
"RTN","MAGQBUT",168,0)
VALRD(IEN,PLACE,GROUP) ;Validate Active RAID
"RTN","MAGQBUT",169,0)
 N ZNODE,NODE1
"RTN","MAGQBUT",170,0)
 S ZNODE=$G(^MAG(2005.2,IEN,0))
"RTN","MAGQBUT",171,0)
 S NODE1=$G(^MAG(2005.2,IEN,1))
"RTN","MAGQBUT",172,0)
 Q:$P(ZNODE,U,10)'=PLACE 0
"RTN","MAGQBUT",173,0)
 I $D(GROUP),$P(NODE1,U,8)'=GROUP Q 0
"RTN","MAGQBUT",174,0)
 Q:+$P(NODE1,U,6) 0 ;READ ONLY
"RTN","MAGQBUT",175,0)
 Q:$P(ZNODE,U,6,7)'["1^MAG" 0
"RTN","MAGQBUT",176,0)
 Q:$P(ZNODE,U,9)="1" 0 ;ROUTING SHARE
"RTN","MAGQBUT",177,0)
 Q:$P(ZNODE,U,8)'="Y" 0 ;skip not hashed
"RTN","MAGQBUT",178,0)
 Q:$P(ZNODE,U,2)[":" 0 ;skip if it appears to be a local drive - from testing
"RTN","MAGQBUT",179,0)
 Q:$E($P(ZNODE,U,2),1,2)'="\\" 0 ; skip if not a normal share path address
"RTN","MAGQBUT",180,0)
 Q 1
"RTN","MAGQBUT",181,0)
NGF(PLACE) ;
"RTN","MAGQBUT",182,0)
 D DFNIQ^MAGQBPG1("","The get next raid group function failed!",0,PLACE,"GET_NEXT_RAID_GROUP_FAILURE")
"RTN","MAGQBUT",183,0)
 D DFNIQ^MAGQBPG1("","Use your BP Network Location Manager to re-configure your RAID",0,PLACE,"GET_NEXT_RAID_GROUP_FAILURE")
"RTN","MAGQBUT",184,0)
 D DFNIQ^MAGQBPG1("","Get_Next_RAID_Group_failure",1,PLACE,"GET_NEXT_RAID_GROUP_FAILURE")
"RTN","MAGQBUT",185,0)
 Q
"RTN","MAGQBUT",186,0)
SPRGE(WSIEN,PLACE,RESULT) ; Scheduled Purge
"RTN","MAGQBUT",187,0)
 N NG
"RTN","MAGQBUT",188,0)
 ;Check for scheduled purge
"RTN","MAGQBUT",189,0)
 Q:'$$GET1^DIQ(2006.1,PLACE,"61","I")  ; Check if Scheduled purge is enabled
"RTN","MAGQBUT",190,0)
 Q:($$GET1^DIQ(2006.1,PLACE,"61.1","I")+1)>$$DT^XLFDT  ;Check if activated today
"RTN","MAGQBUT",191,0)
 Q:$$UPPER^MAGQE4(WSOS)'["SERVER"
"RTN","MAGQBUT",192,0)
 Q:'$$GET1^DIQ(2006.8,WSIEN,"3","I")  ;Check if task is assigned to this BP WS
"RTN","MAGQBUT",193,0)
 N T1,T2
"RTN","MAGQBUT",194,0)
 ;Adjust 24 hour time for Fileman format for Scheduled time (#61.4)
"RTN","MAGQBUT",195,0)
 S T1="0000",T2=$$GET1^DIQ(2006.1,PLACE,"61.4","I"),T1=$E(T1,1,($L(T1)-$L(T2)))_T2
"RTN","MAGQBUT",196,0)
 I $$FMADD^XLFDT($$NOW^XLFDT,"","",20,"")>($$GET1^DIQ(2006.1,PLACE,"61.3","I")_"."_T1) D
"RTN","MAGQBUT",197,0)
 . S NG=$$NXTGP(PLACE,GROUP,"1") ; Next purge capable Group
"RTN","MAGQBUT",198,0)
 . I 'NG D NGF(PLACE)  Q  ; Quit if next Raid Group not found
"RTN","MAGQBUT",199,0)
 . S $P(RESULT,U,4)="SCHEDULED_PURGE"_"~"_$$GET1^DIQ(2006.1,PLACE,"61.3","I")
"RTN","MAGQBUT",200,0)
 . S $P(RESULT,U,6)=NG
"RTN","MAGQBUT",201,0)
 . D DFNIQ^MAGQBPG1("","A scheduled RAID group purge has been initiated for the following",0,PLACE,"SCHEDULED_RAID_GROUP_PURGE")
"RTN","MAGQBUT",202,0)
 . D DFNIQ^MAGQBPG1("","VistA Imaging RAID group: "_$P($G(^MAG(2005.2,NG,0)),U,1),0,PLACE,"SCHEDULED_RAID_GROUP_PURGE")
"RTN","MAGQBUT",203,0)
 . D DFNIQ^MAGQBPG1("","Scheduled_RAID_group_purge",1,PLACE,"SCHEDULED_RAID_GROUP_PURGE")
"RTN","MAGQBUT",204,0)
 . Q
"RTN","MAGQBUT",205,0)
 Q
"RTN","MAGQBUT",206,0)
SVERI(WSIEN,PLACE,RESULT) ; Scheduled Verify
"RTN","MAGQBUT",207,0)
 Q:'$$GET1^DIQ(2006.1,PLACE,"62","I")  ; Check if Scheduled Verify is enabled
"RTN","MAGQBUT",208,0)
 Q:($$GET1^DIQ(2006.1,PLACE,"62.1","I")+1)>$$DT^XLFDT  ;Check if activated today
"RTN","MAGQBUT",209,0)
 Q:$$UPPER^MAGQE4(WSOS)'["SERVER"
"RTN","MAGQBUT",210,0)
 Q:'$$GET1^DIQ(2006.8,WSIEN,"4","I")  ;Check if task is assigned to this BP WS
"RTN","MAGQBUT",211,0)
 N T1,T2
"RTN","MAGQBUT",212,0)
 S T1="0000",T2=$$GET1^DIQ(2006.1,PLACE,"62.4","I"),T1=$E(T1,1,($L(T1)-$L(T2)))_T2
"RTN","MAGQBUT",213,0)
 I $$FMADD^XLFDT($$NOW^XLFDT,"","",20,"")>($$GET1^DIQ(2006.1,PLACE,"62.3","I")_"."_T1) D
"RTN","MAGQBUT",214,0)
 . S $P(RESULT,U,7)="VERIFY"_"~"_$$GET1^DIQ(2006.1,PLACE,"62.3","I")
"RTN","MAGQBUT",215,0)
 . Q
"RTN","MAGQBUT",216,0)
 Q
"RTN","MAGQBUT",217,0)
NAUTOW(PLACE,CWL,SPACE,SIZE,RESULT,NOTIFY,GROUP) ; CACHE BALANCING OFF
"RTN","MAGQBUT",218,0)
 ; No Auto RG Advance if Auto write is off
"RTN","MAGQBUT",219,0)
 S SPACE=+$P($G(^MAG(2005.2,CWL,0)),U,5),SIZE=+$P($G(^MAG(2005.2,CWL,0)),U,3)
"RTN","MAGQBUT",220,0)
 I (SIZE>0),((SPACE/SIZE)*100)>MIN D  Q  ;Here is where % Reserve is returned ...need to add by group and by RAID set also GB
"RTN","MAGQBUT",221,0)
 . S $P(RESULT,U)=1
"RTN","MAGQBUT",222,0)
 . I SIZE S $P(RESULT,U,5)=$P(((SPACE/SIZE)*100),".")_"."_$E($P(((SPACE/SIZE)*100),".",2),1,2)
"RTN","MAGQBUT",223,0)
 . E  S $P(RESULT,U,5)="0.00"
"RTN","MAGQBUT",224,0)
 . Q
"RTN","MAGQBUT",225,0)
 I SIZE>0 S $P(RESULT,U,5)=$P(((SPACE/SIZE)*100),".")_"."_$E($P(((SPACE/SIZE)*100),".",2),1,2)
"RTN","MAGQBUT",226,0)
 E  S $P(RESULT,U,5)="0.00"
"RTN","MAGQBUT",227,0)
 S $P(RESULT,U)=$S(SPACE>0:2,1:0)
"RTN","MAGQBUT",228,0)
 S $P(RESULT,U,2,3)=$P(^MAG(2005.2,$P(^MAG(2006.1,PLACE,0),U,3),0),U,1,2)
"RTN","MAGQBUT",229,0)
 I (($$GET1^DIQ(2006.1,PLACE,"61.1","I")+4)<$$DT^XLFDT) D  ;Check if activated within 4 days
"RTN","MAGQBUT",230,0)
 . I ($P($G(^MAG(2006.1,PLACE,"BPPURGE")),U)&(SPACE>0)&($$GET1^DIQ(2006.8,WSIEN,"3","I")="1")) D
"RTN","MAGQBUT",231,0)
 . . Q:$$UPPER^MAGQE4(WSOS)'["SERVER"
"RTN","MAGQBUT",232,0)
 . . S $P(RESULT,U,4)="AUTO_PURGE",$P(RESULT,U,6)=GROUP
"RTN","MAGQBUT",233,0)
 . . D DFNIQ^MAGQBPG1("","An automatic RAID Group purge has been initiated for the following",0,PLACE,"AUTO_RAID_GROUP_PURGE")
"RTN","MAGQBUT",234,0)
 . . D DFNIQ^MAGQBPG1("","VistA Imaging RAID group: "_$P($G(^MAG(2005.2,GROUP,0)),U,1),0,PLACE,"AUTO_RAID_GROUP_PURGE")
"RTN","MAGQBUT",235,0)
 . . D DFNIQ^MAGQBPG1("","Auto_RAID_group_purge",1,PLACE,"AUTO_RAID_GROUP_PURGE")
"RTN","MAGQBUT",236,0)
 . . Q
"RTN","MAGQBUT",237,0)
 . Q
"RTN","MAGQBUT",238,0)
 D:(NOTIFY!(SPACE>0)) TMESS(SPACE,"VistA Imaging RAID storage is Critically Low ",PLACE)
"RTN","MAGQBUT",239,0)
 Q
"RTN","MAGQBUT",240,0)
RGADV(PLACE,GROUP,RESULT) ; Scheduled Raid Group Advance
"RTN","MAGQBUT",241,0)
 N NODERG,NG,IEN,APP,SCH,T1,T2
"RTN","MAGQBUT",242,0)
 S NODERG=$G(^MAG(2006.1,PLACE,"RGADVANCE"))
"RTN","MAGQBUT",243,0)
 I $P(NODERG,U,1) D
"RTN","MAGQBUT",244,0)
 . Q:'(+$P(NODERG,U,4))
"RTN","MAGQBUT",245,0)
 . S T1="0000",T2=$P(NODERG,U,5),T1=$E(T1,1,($L(T1)-$L(T2)))_T2
"RTN","MAGQBUT",246,0)
 . I $$FMADD^XLFDT($$NOW^XLFDT,"","",20,"")>($P(NODERG,U,4)_"."_T1) D
"RTN","MAGQBUT",247,0)
 . . S NG=$$NXTGP(PLACE,GROUP) ;$$NXTGP returns null when no group with suitable space is found
"RTN","MAGQBUT",248,0)
 . . I ((NG)&(NG'=GROUP)) D  Q
"RTN","MAGQBUT",249,0)
 . . . S GROUP=NG,IEN=""
"RTN","MAGQBUT",250,0)
 . . . D FSP(MIN,.SPACE,.SIZE,.IEN,.TSPACE,.TSIZE,PLACE,GROUP,"")
"RTN","MAGQBUT",251,0)
 . . . S APP="Scheduled RAID Group Advance"
"RTN","MAGQBUT",252,0)
 . . . D SCWL(IEN,PLACE,GROUP,APP,DUZ)
"RTN","MAGQBUT",253,0)
 . . . S $P(RESULT,U,8)="Scheduled RGADVANCE"
"RTN","MAGQBUT",254,0)
 . . . D DFNIQ^MAGQBPG1("","A Scheduled RGADVANCE has completed",0,PLACE,APP)
"RTN","MAGQBUT",255,0)
 . . . D DFNIQ^MAGQBPG1("","The Active RAID Group is now set to: "_$P(^MAG(2005.2,GROUP,0),U,1),0,PLACE,APP)
"RTN","MAGQBUT",256,0)
 . . . D DFNIQ^MAGQBPG1("","Scheduled_RAID_Group_Advance",1,PLACE,APP)
"RTN","MAGQBUT",257,0)
 . . . S $P(^MAG(2006.1,PLACE,"RGADVANCE"),U,3)=$$DT^XLFDT ; DATE OF LAST RG ADVANCE #63.2
"RTN","MAGQBUT",258,0)
 . . . ;Allow singly scheduled RGAdvance,unschedule next if Frequency not set
"RTN","MAGQBUT",259,0)
 . . . S $P(^MAG(2006.1,PLACE,"RGADVANCE"),U,4)=$S(+$P(NODERG,U,2)>0:$$FMADD^XLFDT($$DT^XLFDT,$P(NODERG,U,2),"","",""),1:"")
"RTN","MAGQBUT",260,0)
 . . . Q
"RTN","MAGQBUT",261,0)
 . . ; Else NOTIFY & QUIT
"RTN","MAGQBUT",262,0)
 . . N MSG S MSG="The scheduled RAID Group Advance failed!"
"RTN","MAGQBUT",263,0)
 . . D DFNIQ^MAGQBPG1("",MSG,0,PLACE,"MAGQ FS CHNGE")
"RTN","MAGQBUT",264,0)
 . . S MSG="Scheduled_RAID_Group_Advance_failure!"
"RTN","MAGQBUT",265,0)
 . . D DFNIQ^MAGQBPG1("",MSG,1,PLACE,"MAGQ FS CHNGE") ; Send
"RTN","MAGQBUT",266,0)
 . . Q
"RTN","MAGQBUT",267,0)
 . Q
"RTN","MAGQBUT",268,0)
 Q
"RTN","MAGQBUT",269,0)
REPCWL(IEN,RG,RES,TSPACE,TSIZE) ;  Update Result with Current Write Group properties
"RTN","MAGQBUT",270,0)
 S $P(RES,U,2)="CWL: "_IEN_" RG: "_RG
"RTN","MAGQBUT",271,0)
 S $P(RES,U,3)=TSPACE
"RTN","MAGQBUT",272,0)
 S $P(RES,U,5)=$P(((TSPACE/TSIZE)*100),".")_"."_$E($P(((TSPACE/TSIZE)*100),".",2),1,2) ; %FREE SPACE
"RTN","MAGQBUT",273,0)
 Q
"RTN","MAGQBUT1")
0^18^B115897109
"RTN","MAGQBUT1",1,0)
MAGQBUT1 ;WOIFO/RP - Utilities for Background ; 18 Jan 2011 5:13 PM
"RTN","MAGQBUT1",2,0)
 ;;3.0;IMAGING;**7,8,20,81,39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGQBUT1",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGQBUT1",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBUT1",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBUT1",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBUT1",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBUT1",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBUT1",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBUT1",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBUT1",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBUT1",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBUT1",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBUT1",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBUT1",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBUT1",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBUT1",17,0)
 ;;
"RTN","MAGQBUT1",18,0)
 Q
"RTN","MAGQBUT1",19,0)
UBPW(WS,ASSIGN) ;  screen for duplicate assignments
"RTN","MAGQBUT1",20,0)
 N IEN,PLACE,PIECE,WSIEN,VALUE,DUP
"RTN","MAGQBUT1",21,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBUT1",22,0)
 S VALUE(1)=PLACE,VALUE(2)=WS
"RTN","MAGQBUT1",23,0)
 S WSIEN=$$FIND1^DIC(2006.8,"","QX",.VALUE,"D","","")
"RTN","MAGQBUT1",24,0)
 S PIECE=$P(ASSIGN,";",2)
"RTN","MAGQBUT1",25,0)
 S (DUP,IEN)=0
"RTN","MAGQBUT1",26,0)
 ;IF NOT ASSIGNED THEN QUIT
"RTN","MAGQBUT1",27,0)
 I '$P($G(^MAG(2006.8,WSIEN,0)),U,PIECE) K VALUE Q DUP
"RTN","MAGQBUT1",28,0)
 F  S IEN=$O(^MAG(2006.8,IEN)) Q:'IEN  D  Q:DUP
"RTN","MAGQBUT1",29,0)
 . S ZNODE=^MAG(2006.8,IEN,0)
"RTN","MAGQBUT1",30,0)
 . Q:'$P(ZNODE,U,12)  ; not a BP
"RTN","MAGQBUT1",31,0)
 . Q:$P(ZNODE,U,2)'=PLACE
"RTN","MAGQBUT1",32,0)
 . Q:$P(ZNODE,U)=WS
"RTN","MAGQBUT1",33,0)
 . S:+$P(ZNODE,U,PIECE) DUP=1
"RTN","MAGQBUT1",34,0)
 . Q
"RTN","MAGQBUT1",35,0)
 Q DUP
"RTN","MAGQBUT1",36,0)
BPPS(INPUT,WS,PROCESS) ;INPUT TRANSFORM FOR FILE 2006.8
"RTN","MAGQBUT1",37,0)
 N IEN,FND,WSNAME,WSNAME2,ZNODE,PIECE,MAGX,MAGY,PLACE
"RTN","MAGQBUT1",38,0)
 S U="^"
"RTN","MAGQBUT1",39,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBUT1",40,0)
 Q:'(+$P($G(^MAG(2006.8,WS,0)),U,12)) 0  ;NOT A BACKGROUND PROCESSOR
"RTN","MAGQBUT1",41,0)
 Q:'INPUT 1  ; Always allow unassigned
"RTN","MAGQBUT1",42,0)
 S WSNAME=$P($G(^MAG(2006.8,WS,0)),U) ;Workstation Name
"RTN","MAGQBUT1",43,0)
 Q:$L(WSNAME)<3 0 ;BP WS NOT PROPERLY INSTALLED
"RTN","MAGQBUT1",44,0)
 Q:$O(^MAG(2006.8,"C",PLACE,WSNAME,""))'?1N.N 1
"RTN","MAGQBUT1",45,0)
 S PIECE=$P($$GET1^DID(2006.8,PROCESS,"","GLOBAL SUBSCRIPT LOCATION"),";",2)
"RTN","MAGQBUT1",46,0)
 S IEN=0,WSNAME2="",FND=0
"RTN","MAGQBUT1",47,0)
 F  S WSNAME2=$O(^MAG(2006.8,"C",PLACE,WSNAME2)) Q:WSNAME2=""  D  Q:FND
"RTN","MAGQBUT1",48,0)
 . Q:WSNAME2=WSNAME
"RTN","MAGQBUT1",49,0)
 . S IEN=$O(^MAG(2006.8,"C",PLACE,WSNAME2,"")) Q:IEN'?1N.N
"RTN","MAGQBUT1",50,0)
 . S ZNODE=$G(^MAG(2006.8,IEN,0))
"RTN","MAGQBUT1",51,0)
 . Q:$P(ZNODE,"^",12)'="1"
"RTN","MAGQBUT1",52,0)
 . S FND=$P(ZNODE,"^",PIECE)="1"
"RTN","MAGQBUT1",53,0)
 . Q
"RTN","MAGQBUT1",54,0)
 Q $S(FND="1":0,1:1)
"RTN","MAGQBUT1",55,0)
RSQUE(RESULT,IEN,QUEUE) ;[MAGQB RSQUE]
"RTN","MAGQBUT1",56,0)
 N PTR,PLACE
"RTN","MAGQBUT1",57,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBUT1",58,0)
 S PTR=$O(^MAGQUEUE(2006.031,"C",PLACE,QUEUE,""))
"RTN","MAGQBUT1",59,0)
 I $P(^MAGQUEUE(2006.031,PTR,0),"^")=QUEUE D
"RTN","MAGQBUT1",60,0)
 . S $P(^MAGQUEUE(2006.031,PTR,0),"^",2)=IEN
"RTN","MAGQBUT1",61,0)
 . Q
"RTN","MAGQBUT1",62,0)
 Q
"RTN","MAGQBUT1",63,0)
ICCL(SRVRCNT,NMESS,PLACE) ;UPDATE IMAGING DISTRIBUTION
"RTN","MAGQBUT1",64,0)
 N Y,LOC,INDEX,CNT,IEN,ARRAY,SUB1,SUB2,NAME
"RTN","MAGQBUT1",65,0)
 S Y=$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","MAGQBUT1",66,0)
 S LOC=$$KSP^XUPARAM("WHERE")
"RTN","MAGQBUT1",67,0)
 S CNT=1,^TMP($J,"MAGQ",PLACE,"BP",CNT)="SITE: "_LOC
"RTN","MAGQBUT1",68,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",PLACE,"BP",CNT)="DATE: "_Y_" "_$G(^XMB("TIMEZONE"))
"RTN","MAGQBUT1",69,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",PLACE,"BP",CNT)="SENDER: "_$$PLNM^MAGQBUT5(PLACE)_" Imaging Background Processor"
"RTN","MAGQBUT1",70,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",PLACE,"BP",CNT)="Total Cache Free: "_$P(SRVRCNT,U,2)_" megabytes"
"RTN","MAGQBUT1",71,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",PLACE,"BP",CNT)="Total Cache Available: "_$P(SRVRCNT,U,3)_" megabytes"
"RTN","MAGQBUT1",72,0)
 I $P(SRVRCNT,U,4) S CNT=CNT+1,^TMP($J,"MAGQ",PLACE,"BP",CNT)="An Automatic Purge process has been Activated. "
"RTN","MAGQBUT1",73,0)
 E  S CNT=CNT+1,^TMP($J,"MAGQ",PLACE,"BP",CNT)="The Automatic Purge process is NOT configured. "
"RTN","MAGQBUT1",74,0)
 I $P(SRVRCNT,U,5)]"" S CNT=CNT+1,^TMP($J,"MAGQ",PLACE,"BP",CNT)="The Automatic Purge process is assigned to: "_$P(SRVRCNT,U,5)
"RTN","MAGQBUT1",75,0)
 E  S CNT=CNT+1,^TMP($J,"MAGQ",PLACE,"BP",CNT)="The Automatic Purge process is NOT assigned to a BP server. "
"RTN","MAGQBUT1",76,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",PLACE,"BP",CNT)="The "_$P(SRVRCNT,U)_" Imaging cache servers will"
"RTN","MAGQBUT1",77,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",PLACE,"BP",CNT)="require operator intervention to ensure continued"
"RTN","MAGQBUT1",78,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",PLACE,"BP",CNT)="availability.  The following MAG SERVER members"
"RTN","MAGQBUT1",79,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",PLACE,"BP",CNT)="are being notified: "
"RTN","MAGQBUT1",80,0)
 S INDEX=0,IEN=$$FIND1^DIC(3.8,"","MX","MAG SERVER","","","ERR")
"RTN","MAGQBUT1",81,0)
 Q:IEN'?1N.N
"RTN","MAGQBUT1",82,0)
 D GETS^DIQ(3.8,IEN_",","2*;11*;12*","","ARRAY")
"RTN","MAGQBUT1",83,0)
 S (SUB1,SUB2)=""
"RTN","MAGQBUT1",84,0)
 F  S SUB1=$O(ARRAY(SUB1)) Q:SUB1=""  D
"RTN","MAGQBUT1",85,0)
 . F  S SUB2=$O(ARRAY(SUB1,SUB2)) Q:SUB2=""  D
"RTN","MAGQBUT1",86,0)
 . . S NAME=$G(ARRAY(SUB1,SUB2,".01")) D:NAME'=""
"RTN","MAGQBUT1",87,0)
 . . . S CNT=CNT+1,^TMP($J,"MAGQ",PLACE,"BP",8+CNT)=NAME
"RTN","MAGQBUT1",88,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",PLACE,"BP",CNT)="The next notifications will occur in: "
"RTN","MAGQBUT1",89,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",PLACE,"BP",CNT)=NMESS
"RTN","MAGQBUT1",90,0)
 D MAILSHR(PLACE,"BP","Image Cache Critically Low at "_LOC)
"RTN","MAGQBUT1",91,0)
 S $P(^MAG(2006.1,$$PLACE^MAGBAPI($G(DUZ(2))),3),"^",11)=$$NOW^XLFDT
"RTN","MAGQBUT1",92,0)
 D UDMI^MAGQBUT5("Image Cache Critically Low at ",PLACE)
"RTN","MAGQBUT1",93,0)
 K ARRAY
"RTN","MAGQBUT1",94,0)
 Q
"RTN","MAGQBUT1",95,0)
MAILSHR(PLACE,APP,XMSUB) ;Shared Mail server code
"RTN","MAGQBUT1",96,0)
 N XMY,XMTEXT,XMID,XMZ
"RTN","MAGQBUT1",97,0)
 S XMTEXT="^TMP($J,""MAGQ"",PLACE,APP)"
"RTN","MAGQBUT1",98,0)
 S:$G(DUZ) XMY(DUZ)=""
"RTN","MAGQBUT1",99,0)
 D:$$PROD^XUPROD("1") ADDMG^MAGQBUT5(XMSUB,.XMY,PLACE)
"RTN","MAGQBUT1",100,0)
 S:$G(MAGDUZ) XMY(MAGDUZ)=""
"RTN","MAGQBUT1",101,0)
 S XMID=$G(DUZ) S:'XMID XMID=.5
"RTN","MAGQBUT1",102,0)
 S XMY(XMID)=""
"RTN","MAGQBUT1",103,0)
 D SENDMSG^XMXAPI(XMID,XMSUB,XMTEXT,.XMY,,.XMZ,)
"RTN","MAGQBUT1",104,0)
 K ^TMP($J,"MAGQ",PLACE,APP)
"RTN","MAGQBUT1",105,0)
 I $G(XMERR) M XMERR=^TMP("XMERR",$J) K XMERR
"RTN","MAGQBUT1",106,0)
 Q
"RTN","MAGQBUT1",107,0)
ALLSERV(RESULT,GRP) ; BP Queue Processor
"RTN","MAGQBUT1",108,0)
 ; RPC[MAGQ ALL SERVER] used for ServerSize update/display function - reports network resources
"RTN","MAGQBUT1",109,0)
 ; Returns OnLine, network addressed, non-router, place related Magnetic shares
"RTN","MAGQBUT1",110,0)
 ; it returns the share designated as the current Write location in the (0) indice
"RTN","MAGQBUT1",111,0)
 ; it does not screen on READ-ONLY, and the list is group specific
"RTN","MAGQBUT1",112,0)
 ; the function could be replaced by a fileman call from the GUI 
"RTN","MAGQBUT1",113,0)
 ; PHYSICAL REFERENCE^CWL or ien^FREE SPACE^TOTAL SPACE^NAME^GROUP^TYPE
"RTN","MAGQBUT1",114,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT1",115,0)
 N INDX,DATA,CNT,SHARE,CWL,VALUE,TMP,PLACE,CWG ;CWL=CURRENT WRITE LOCATION CWG=CURRENT WRITE GROUP
"RTN","MAGQBUT1",116,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBUT1",117,0)
 S CWG=$S($G(GRP)["ALL":"",1:$$CWG^MAGBAPI(PLACE))
"RTN","MAGQBUT1",118,0)
 D:CWG CWGIC(CWG)  ;Remove all members that do not reference this group
"RTN","MAGQBUT1",119,0)
 S CWL=$$CWL^MAGBAPI(PLACE)
"RTN","MAGQBUT1",120,0)
 ; I CWL D  ;First report Current Write Location data 
"RTN","MAGQBUT1",121,0)
 ; . S DATA=$G(^MAG(2005.2,CWL,0))
"RTN","MAGQBUT1",122,0)
 ; . S SHARE=$P(DATA,U,2)
"RTN","MAGQBUT1",123,0)
 ; . S RESULT(0)=SHARE_U_CWL_U_+$P(DATA,U,5)_U_+$P(DATA,U,3)_U_$P(DATA,U)
"RTN","MAGQBUT1",124,0)
 ; . S RESULT(0)=RESULT(0)_U_$S($L($$GET1^DIQ(2005.2,CWL,31,"E","","")):$$GET1^DIQ(2005.2,CWL,31,"E","",""),1:"")
"RTN","MAGQBUT1",125,0)
 ; . S RESULT(0)=RESULT(0)_U_$$GET1^DIQ(2005.2,CWL,6,"I","","")
"RTN","MAGQBUT1",126,0)
 ; . Q
"RTN","MAGQBUT1",127,0)
 ; E  S RESULT(0)="-1^The Current Write Location (CWL) is not currently set."
"RTN","MAGQBUT1",128,0)
 S INDX=0,U="^",CNT=1
"RTN","MAGQBUT1",129,0)
 K ^TMP("MAGQAS")
"RTN","MAGQBUT1",130,0)
 F  S INDX=$O(^MAG(2005.2,INDX)) Q:INDX'?1N.N  D
"RTN","MAGQBUT1",131,0)
 . S DATA=$G(^MAG(2005.2,INDX,0))
"RTN","MAGQBUT1",132,0)
 . Q:$P(DATA,U,6,7)'["1^MAG"
"RTN","MAGQBUT1",133,0)
 . Q:$P(DATA,U,2)[":"
"RTN","MAGQBUT1",134,0)
 . Q:($P(DATA,U,10)'=PLACE)
"RTN","MAGQBUT1",135,0)
 . Q:$P(DATA,U,9)="1"  ;ROUTING SHARE
"RTN","MAGQBUT1",136,0)
 . S SHARE=$P(DATA,U,2)
"RTN","MAGQBUT1",137,0)
 . Q:$E(SHARE,1,2)'="\\"
"RTN","MAGQBUT1",138,0)
 . I $E(SHARE,$L(SHARE))="\" S SHARE=$E(SHARE,1,$L(SHARE)-1)
"RTN","MAGQBUT1",139,0)
 . S TMP(SHARE)=""
"RTN","MAGQBUT1",140,0)
 . I CWG,'$$GMEM(CWG,INDX) Q  ;screen on Current Write Group also validate group member reference
"RTN","MAGQBUT1",141,0)
 . S VALUE=SHARE_U_INDX_U_+$P(DATA,U,5)_U_+$P(DATA,U,3)_U_$P(DATA,U)
"RTN","MAGQBUT1",142,0)
 . S VALUE=VALUE_U_$S($L($$GET1^DIQ(2005.2,INDX,31,"E","","")):$$GET1^DIQ(2005.2,INDX,31,"E","",""),1:"")
"RTN","MAGQBUT1",143,0)
 . S VALUE=VALUE_U_$$GET1^DIQ(2005.2,INDX,6,"I","","")
"RTN","MAGQBUT1",144,0)
 . I INDX=CWL D  Q  ;ELSE CONTINUE 
"RTN","MAGQBUT1",145,0)
 . . S RESULT(0)=VALUE_U_$G(^TMP("MAGQ","WSUD"))
"RTN","MAGQBUT1",146,0)
 . . S ^TMP("MAGQAS",0)=VALUE ;1ST SHARE=CWL
"RTN","MAGQBUT1",147,0)
 . . Q
"RTN","MAGQBUT1",148,0)
 . S RESULT(CNT)=VALUE,CNT=CNT+1
"RTN","MAGQBUT1",149,0)
 . S ^TMP("MAGQAS",CNT-1)=VALUE
"RTN","MAGQBUT1",150,0)
 . Q
"RTN","MAGQBUT1",151,0)
 Q
"RTN","MAGQBUT1",152,0)
ALLSHR(RESULT,TYPE) ; RPC[MAGQBP ALL SHARES] - Used by BP Purge
"RTN","MAGQBUT1",153,0)
 ; screens off-line,read-only,routing share,non-mag,non-place,next group,current group,specific group(s)
"RTN","MAGQBUT1",154,0)
 N TMP,INDX,DATA,CNT,SHARE,CWL,VALUE,PLACE,NG,GRP ;CWL=CURRENT WRITE LOCATION
"RTN","MAGQBUT1",155,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT1",156,0)
 S (CNT,INDX)=0,U="^" S:'$D(TYPE) TYPE="ALL" ;calling routine will define TYPE, or set as ALL by default (no screen).
"RTN","MAGQBUT1",157,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBUT1",158,0)
 S CWL=$$CWL^MAGBAPI(PLACE)
"RTN","MAGQBUT1",159,0)
 S GRP=$$GRP^MAGQBUT(PLACE)
"RTN","MAGQBUT1",160,0)
 S NG=$$NXTGP^MAGQBUT(PLACE,GRP,"1") ; Next Purge capable group
"RTN","MAGQBUT1",161,0)
 F  S INDX=$O(^MAG(2005.2,INDX)) Q:INDX'?1N.N  D
"RTN","MAGQBUT1",162,0)
 . S DATA=$G(^MAG(2005.2,INDX,0))
"RTN","MAGQBUT1",163,0)
 . Q:$P(DATA,U,6,7)'["1^MAG"
"RTN","MAGQBUT1",164,0)
 . Q:$P(DATA,U,9)="1"  ;ROUTING SHARE
"RTN","MAGQBUT1",165,0)
 . Q:$P(DATA,U,2)[":"
"RTN","MAGQBUT1",166,0)
 . Q:($P(DATA,U,10)'=PLACE)
"RTN","MAGQBUT1",167,0)
 . Q:($P($G(^MAG(2005.2,INDX,1)),U,6)="1")  ;Read Only
"RTN","MAGQBUT1",168,0)
 . Q:(("^AUTO^NRG^"[("^"_TYPE_"^"))&($P($G(^MAG(2005.2,INDX,1)),U,8)'=NG))  ;NOT a member of the Next RAID Group
"RTN","MAGQBUT1",169,0)
 . Q:(("^CRG^"[("^"_TYPE_"^"))&($P($G(^MAG(2005.2,INDX,1)),U,8)'=GRP))  ;NOT a member of the Current RAID Group
"RTN","MAGQBUT1",170,0)
 . Q:((TYPE?1N.N)&($P($G(^MAG(2005.2,INDX,1)),U,8)'=TYPE))  ;NOT a member of the Specified RAID Group
"RTN","MAGQBUT1",171,0)
 . S SHARE=$$UPPER^MAGQE4($P(DATA,U,2))
"RTN","MAGQBUT1",172,0)
 . Q:$E(SHARE,1,2)'="\\"
"RTN","MAGQBUT1",173,0)
 . I $E(SHARE,$L(SHARE))="\" S SHARE=$E(SHARE,1,$L(SHARE)-1)
"RTN","MAGQBUT1",174,0)
 . Q:$D(TMP(SHARE))
"RTN","MAGQBUT1",175,0)
 . S TMP(SHARE)=""
"RTN","MAGQBUT1",176,0)
 . Q
"RTN","MAGQBUT1",177,0)
 S INDX=""
"RTN","MAGQBUT1",178,0)
 F  S INDX=$O(TMP(INDX)) Q:INDX=""  D
"RTN","MAGQBUT1",179,0)
 . S RESULT(CNT)=INDX,CNT=CNT+1
"RTN","MAGQBUT1",180,0)
 . Q
"RTN","MAGQBUT1",181,0)
 K TMP
"RTN","MAGQBUT1",182,0)
 Q
"RTN","MAGQBUT1",183,0)
FSUPDT(RESULT,IEN,SPACE,SIZE) ; File Server Update
"RTN","MAGQBUT1",184,0)
 ; RPC[MAGQ FS UPDATE]
"RTN","MAGQBUT1",185,0)
 ; Space is field #2 (Total Space)and is actually share size
"RTN","MAGQBUT1",186,0)
 ; Size is field #4 (Free Space)
"RTN","MAGQBUT1",187,0)
 N NODE,X,Y,INDEX,SHNAME,PLACE
"RTN","MAGQBUT1",188,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT1",189,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBUT1",190,0)
 K ^TMP("MAGQ","WSUD")
"RTN","MAGQBUT1",191,0)
 S ^TMP("MAGQ","WSUD",IEN)=$$FMTE^XLFDT($$NOW^XLFDT)_U_IEN_U_SPACE_U_SIZE
"RTN","MAGQBUT1",192,0)
 I $G(^MAG(2005.2,IEN,0))="" S RESULT="-1^No Network Location Entry" Q
"RTN","MAGQBUT1",193,0)
 S SHNAME=$P($G(^MAG(2005.2,IEN,0)),U,2)
"RTN","MAGQBUT1",194,0)
 D FSW(IEN,SPACE,SIZE) ;The next is to update redundant shares and should not be necessary
"RTN","MAGQBUT1",195,0)
 S INDEX=0 F  S INDEX=$O(^MAG(2005.2,"AC",SHNAME,INDEX)) Q:'INDEX  D
"RTN","MAGQBUT1",196,0)
 . Q:INDEX=IEN
"RTN","MAGQBUT1",197,0)
 . D FSW(INDEX,SPACE,SIZE)
"RTN","MAGQBUT1",198,0)
 . Q
"RTN","MAGQBUT1",199,0)
 S RESULT="1^Update Complete"
"RTN","MAGQBUT1",200,0)
 Q
"RTN","MAGQBUT1",201,0)
FSW(IX,SP,SZ) ;
"RTN","MAGQBUT1",202,0)
 S $P(^MAG(2005.2,IX,0),U,3)=+SP,$P(^MAG(2005.2,IX,0),U,5)=+SZ
"RTN","MAGQBUT1",203,0)
 Q
"RTN","MAGQBUT1",204,0)
QUEUER(QUE,FROM,TO) ;
"RTN","MAGQBUT1",205,0)
 N TYPE,INC,CNT,AR,TMP,PLACE,INST,MAGFILE
"RTN","MAGQBUT1",206,0)
 I $$GET1^DIQ(200,+$G(DUZ),.01)="" D  Q
"RTN","MAGQBUT1",207,0)
 . W !,"You must have a valid User ID (DUZ) to use this function!"
"RTN","MAGQBUT1",208,0)
 . Q
"RTN","MAGQBUT1",209,0)
 I "^JBTOHD^PREFET^ABSTRACT^JUKEBOX^GCC^DELETE^EVAL^"'[QUE D  Q
"RTN","MAGQBUT1",210,0)
 . W !,"Only JBTOHD, PREFET, ABSTRACT, JUKEBOX, DELETE, EVAL & GCC queues are valid!"
"RTN","MAGQBUT1",211,0)
 . W !,"Input values: ""Queue type"",""From Image IEN"",""To Image IEN"""
"RTN","MAGQBUT1",212,0)
 S CNT=0,PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2))),INST=$$GET1^DIQ(2006.1,PLACE,.01,"I")
"RTN","MAGQBUT1",213,0)
 F INC=FROM:1:TO D
"RTN","MAGQBUT1",214,0)
 . I ('$D(^MAG(2005,INC,0))&('$D(^MAG(2005.1,INC,0)))) Q
"RTN","MAGQBUT1",215,0)
 . I $D(^MAG(2005,INC,0)),$$PLACE^MAGBAPI(+$P($G(^MAG(2005,INC,100)),U,3))'=PLACE Q
"RTN","MAGQBUT1",216,0)
 . I $D(^MAG(2005.1,INC,0)),$$PLACE^MAGBAPI(+$P($G(^MAG(2005.1,INC,100)),U,3))'=PLACE Q
"RTN","MAGQBUT1",217,0)
 . I ($P($G(^MAG(2005,INC,0)),"^",2)="")&($P($G(^MAG(2005.1,INC,0)),"^",2)="") Q  ;No full filename attribute
"RTN","MAGQBUT1",218,0)
 . I (+$P($G(^MAG(2005,INC,1,0)),"^",4)>0)!(+$P($G(^MAG(2005.1,INC,1,0)),"^",4)>0) Q  ;GROUP PARENT
"RTN","MAGQBUT1",219,0)
 . I "^DELETE^"[QUE D  Q
"RTN","MAGQBUT1",220,0)
 . . N MAGXX S MAGXX=INC D VSTNOCP^MAGFILEB I $E(MAGFILE,1,2)="-1" W !,"Image # "_INC Q 
"RTN","MAGQBUT1",221,0)
 . . S MAGXX=INC D ABSNOCP^MAGFILEB I $E(MAGFILE,1,2)="-1" W !,"Image # "_INC Q
"RTN","MAGQBUT1",222,0)
 . . S MAGXX=INC D BIGNOCP^MAGFILEB I $E(MAGFILE,1,2)="-1" W !,"Image # "_INC Q
"RTN","MAGQBUT1",223,0)
 . . D IMAGEDEL^MAGGTID(.MAGFILE,INC,"","TESTING")
"RTN","MAGQBUT1",224,0)
 . . Q
"RTN","MAGQBUT1",225,0)
 . I "^ABSTRACT^"[QUE D  Q
"RTN","MAGQBUT1",226,0)
 . . I $$ABSOK^MAGQBUT1(INC) D MAPI(QUE,INC,.CNT)
"RTN","MAGQBUT1",227,0)
 . . Q
"RTN","MAGQBUT1",228,0)
 . I "^JBTOHD^PREFET^"[QUE F TYPE="ABSTRACT","FULL","BIG" D
"RTN","MAGQBUT1",229,0)
 . . Q:(TYPE="BIG")&('$D(^MAG(2005,INC,"FBIG"))&'$D(^MAG(2005.1,INC,"FBIG")))
"RTN","MAGQBUT1",230,0)
 . . D MAPI(QUE,INC_"^"_TYPE,.CNT)
"RTN","MAGQBUT1",231,0)
 . . Q
"RTN","MAGQBUT1",232,0)
 . E  D MAPI(QUE,INC,.CNT) ; JUKEBOX,EVAL,GCC
"RTN","MAGQBUT1",233,0)
 . Q
"RTN","MAGQBUT1",234,0)
 Q
"RTN","MAGQBUT1",235,0)
MAPI(TYP,PARAM,CNT) ;
"RTN","MAGQBUT1",236,0)
 N PLACE
"RTN","MAGQBUT1",237,0)
 S CNT=CNT+1,PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBUT1",238,0)
 W !,CNT," TYPE: ",TYP,": ",PARAM_" QUEUE #: ",@("$$"_TYP_"^MAGBAPI(PARAM,PLACE)")
"RTN","MAGQBUT1",239,0)
 Q
"RTN","MAGQBUT1",240,0)
ABSOK(IEN) ; Verify that the Full Image Type is a supported by our ABSTRACT method
"RTN","MAGQBUT1",241,0)
 N TYPE,FILE,IFT ; Image file type
"RTN","MAGQBUT1",242,0)
 S FILE=$S($D(^MAG(2005,IEN)):$P($G(^MAG(2005,IEN,0)),U,2),$D(^MAG(2005.1,IEN)):$P($G(^MAG(2005.1,IEN,0)),U,2),1:"")
"RTN","MAGQBUT1",243,0)
 S TYPE=$P(FILE,".",2)
"RTN","MAGQBUT1",244,0)
 S IFT=$S($D(^MAG(2005.021,"B",TYPE)):$O(^MAG(2005.021,"B",TYPE,"")),1:"")
"RTN","MAGQBUT1",245,0)
 I (IFT']"")!($P($G(^MAG(2005.021,IFT,0)),U,5)'="1") D  Q 0
"RTN","MAGQBUT1",246,0)
 . W !,"Abstract not supported IEN/TYPE: "_IEN_"/"_TYPE
"RTN","MAGQBUT1",247,0)
 Q $P($G(^MAG(2005.021,IFT,0)),U,5)
"RTN","MAGQBUT1",248,0)
BPQSL(RESULT,TYPE) ; Called from MAGQUEMAN.PAS and MagSiteParameters.PAS
"RTN","MAGQBUT1",249,0)
 ; RPC[MAGQB QSL]
"RTN","MAGQBUT1",250,0)
 N STATUS,CNT,IEN,CP,PLACE
"RTN","MAGQBUT1",251,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBUT1",252,0)
 S STATUS="",CNT=0
"RTN","MAGQBUT1",253,0)
 F  S STATUS=$O(^MAGQUEUE(2006.03,"D",PLACE,TYPE,STATUS)) Q:STATUS=""  D
"RTN","MAGQBUT1",254,0)
 . Q:+STATUS>0
"RTN","MAGQBUT1",255,0)
 . S IEN=$O(^MAGQUEUE(2006.03,"D",PLACE,TYPE,STATUS,""))
"RTN","MAGQBUT1",256,0)
 . S CP=$P(^MAGQUEUE(2006.031,$O(^MAGQUEUE(2006.031,"C",PLACE,TYPE,"")),0),"^",2)
"RTN","MAGQBUT1",257,0)
 . Q:IEN>(CP)
"RTN","MAGQBUT1",258,0)
 . S CNT=CNT+1,RESULT(CNT)=STATUS
"RTN","MAGQBUT1",259,0)
 . Q
"RTN","MAGQBUT1",260,0)
 Q
"RTN","MAGQBUT1",261,0)
CWGIC(CWG) ;  Current RAID Group integrity check
"RTN","MAGQBUT1",262,0)
 N VALUE,IEN,MAGFDA,MSG
"RTN","MAGQBUT1",263,0)
 S VALUE=""
"RTN","MAGQBUT1",264,0)
 F  S VALUE=$O(^MAG(2005.2,CWG,7,"B",VALUE)) Q:'VALUE  D:($P($G(^MAG(2005.2,VALUE,1)),U,8)'=CWG)
"RTN","MAGQBUT1",265,0)
 . S IEN=$O(^MAG(2005.2,CWG,7,"B",VALUE,""))
"RTN","MAGQBUT1",266,0)
 . S MAGFDA(2005.22,IEN_","_CWG_",",.01)="@"
"RTN","MAGQBUT1",267,0)
 . D FILE^DIE("","MAGFDA","")
"RTN","MAGQBUT1",268,0)
 . K MAGFDA
"RTN","MAGQBUT1",269,0)
 . Q
"RTN","MAGQBUT1",270,0)
 Q
"RTN","MAGQBUT1",271,0)
GMEM(CWG,IEN) ; Update Current RAID Group
"RTN","MAGQBUT1",272,0)
 N GVAL
"RTN","MAGQBUT1",273,0)
 S GVAL=$P($G(^MAG(2005.2,IEN,1)),U,8)
"RTN","MAGQBUT1",274,0)
 I GVAL,'$D(^MAG(2005.2,GVAL,7,"B",IEN)) D
"RTN","MAGQBUT1",275,0)
 . N MAGFDA
"RTN","MAGQBUT1",276,0)
 . S MAGFDA(2005.22,"+1,"_GVAL_",",.01)=IEN
"RTN","MAGQBUT1",277,0)
 . D UPDATE^DIE("","MAGFDA","","")
"RTN","MAGQBUT1",278,0)
 . K MAGFDA
"RTN","MAGQBUT1",279,0)
 . Q
"RTN","MAGQBUT1",280,0)
 Q $S(GVAL'=CWG:0,1:1)
"RTN","MAGQBUT2")
0^19^B91378529
"RTN","MAGQBUT2",1,0)
MAGQBUT2 ;WOIFO/SRR/RMP - IMAGE SITE PARAMETERS COMPANION ; 31 Jan 2011 3:06 PM
"RTN","MAGQBUT2",2,0)
 ;;3.0;IMAGING;**7,8,20,81,39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGQBUT2",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGQBUT2",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBUT2",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBUT2",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBUT2",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBUT2",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBUT2",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBUT2",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBUT2",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBUT2",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBUT2",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBUT2",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBUT2",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBUT2",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBUT2",17,0)
 ;;
"RTN","MAGQBUT2",18,0)
MAGSYS(LIST) ;
"RTN","MAGQBUT2",19,0)
 ; RPC[MAGQ SYSTEM]
"RTN","MAGQBUT2",20,0)
 N VAIEN,NODE,MGIEN,UNAME,TDATE
"RTN","MAGQBUT2",21,0)
 S MGIEN=$$FIND1^DIC(3.8,"","MX","MAG SERVER","","","ERR")
"RTN","MAGQBUT2",22,0)
 S VAIEN=0
"RTN","MAGQBUT2",23,0)
 F  S VAIEN=$O(^XUSEC("MAG SYSTEM",VAIEN)) Q:VAIEN'?1N.N  D
"RTN","MAGQBUT2",24,0)
 . S UNAME=$$GET1^DIQ(200,VAIEN,.01)
"RTN","MAGQBUT2",25,0)
 . Q:UNAME=""
"RTN","MAGQBUT2",26,0)
 . ;CHECK FOR TERMINATION DATE
"RTN","MAGQBUT2",27,0)
 . S TDATE=$$GET1^DIQ(200,VAIEN,9.2)
"RTN","MAGQBUT2",28,0)
 . Q:((TDATE'="")&(TDATE<$$NOW^XLFDT))
"RTN","MAGQBUT2",29,0)
 . ;the next line screens existing 'MAG SERVER' members
"RTN","MAGQBUT2",30,0)
 . I MGIEN?1N.N,$$FIND1^DIC(3.81,","_MGIEN_",","QA",VAIEN,"","","ERR") Q
"RTN","MAGQBUT2",31,0)
 . S LIST(VAIEN)=VAIEN_"^"_UNAME
"RTN","MAGQBUT2",32,0)
 Q
"RTN","MAGQBUT2",33,0)
IMPAR(RESULT,QIEN) ; Import Array
"RTN","MAGQBUT2",34,0)
 N INDX,CNT
"RTN","MAGQBUT2",35,0)
 S (INDX,CNT)=0
"RTN","MAGQBUT2",36,0)
 F  S INDX=$O(^MAG(2006.034,QIEN,1,INDX)) Q:INDX'?1N.N  D
"RTN","MAGQBUT2",37,0)
 . S CNT=CNT+1
"RTN","MAGQBUT2",38,0)
 . S RESULT(CNT)=$G(^MAG(2006.034,QIEN,1,INDX,0))
"RTN","MAGQBUT2",39,0)
 I CNT<1 S RESULT(0)="0^Corrupted Import Array"
"RTN","MAGQBUT2",40,0)
 E  S RESULT(0)="1"
"RTN","MAGQBUT2",41,0)
 Q
"RTN","MAGQBUT2",42,0)
CHKIMG(IEN) ;
"RTN","MAGQBUT2",43,0)
 ; Given an Image IEN, return:
"RTN","MAGQBUT2",44,0)
 ;   1: Case # or accession #
"RTN","MAGQBUT2",45,0)
 ;   2: Parent application~IEN
"RTN","MAGQBUT2",46,0)
 ;   3: Application DFN
"RTN","MAGQBUT2",47,0)
 ;   4: Image DFN
"RTN","MAGQBUT2",48,0)
 ;   5: Flag: true = all DFNs in images in same parent group are identical
"RTN","MAGQBUT2",49,0)
 ;   6: Image object Class
"RTN","MAGQBUT2",50,0)
 ;
"RTN","MAGQBUT2",51,0)
 ; PF: Parent Data file number
"RTN","MAGQBUT2",52,0)
 ; PT(): Parent file data dictionary
"RTN","MAGQBUT2",53,0)
 ; PD0: Parent (Global root) IEN (D0)
"RTN","MAGQBUT2",54,0)
 ; PD1:  Lab Parent Global Root (D1)
"RTN","MAGQBUT2",55,0)
 ; PD2:  Parent Data File Image Pointer
"RTN","MAGQBUT2",56,0)
 ; T():  Error types
"RTN","MAGQBUT2",57,0)
 ; IDFN: Image file entry DFN
"RTN","MAGQBUT2",58,0)
 ; PDFN: Parent file DFN
"RTN","MAGQBUT2",59,0)
 ; GRG:  virtual Parent File Image Multiple
"RTN","MAGQBUT2",60,0)
 ; IOR: Image Object Referenced (by parent)
"RTN","MAGQBUT2",61,0)
 N GF,GP,G0,GR,GRD,GRG,GR0,IDFN,IENV,P0,PD0,PD1,PD2,PF,PT,X,X0,X2,N0,N1,R,T,GPDFN,PACS,IOR,APR,I,PDFN
"RTN","MAGQBUT2",62,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT2",63,0)
 S R="^^^^^"
"RTN","MAGQBUT2",64,0)
 S T(1)="No Image ptr in AP"
"RTN","MAGQBUT2",65,0)
 S T(2)="GP has no Images"
"RTN","MAGQBUT2",66,0)
 S T(3)="Conflicting AP & Image DFNs"
"RTN","MAGQBUT2",67,0)
 S T(4)="Invalid Image Ptr to AP"
"RTN","MAGQBUT2",68,0)
 S T(5)="Conflicting GP and GO DFN"
"RTN","MAGQBUT2",69,0)
 S T(6)="GP & GO AP Mismatch"
"RTN","MAGQBUT2",70,0)
 S T(7)="GP Missing GO ptr"
"RTN","MAGQBUT2",71,0)
 S T(8)="No AP Ptr"
"RTN","MAGQBUT2",72,0)
 S T(9)="No AP Entry ptr"
"RTN","MAGQBUT2",73,0)
 S T(10)="No AP Mult ptr"
"RTN","MAGQBUT2",74,0)
 S T(11)="GO DFN mismatches"
"RTN","MAGQBUT2",75,0)
 S T(12)="Null Image Ptr"
"RTN","MAGQBUT2",76,0)
 S T(13)="Invalid Image Ptr"
"RTN","MAGQBUT2",77,0)
 S T(14)="Invalid Image Ptr to AP"
"RTN","MAGQBUT2",78,0)
 S T(15)="Image Entry is structurally abnormal"
"RTN","MAGQBUT2",79,0)
 S T(16)="Missing Group Objects"
"RTN","MAGQBUT2",80,0)
 S T(21)="DFN Mismatches in AP Image Mult"
"RTN","MAGQBUT2",81,0)
 I IEN="" S $P(R,"^",5)=T(12)_"~1" Q R
"RTN","MAGQBUT2",82,0)
 S X0=$G(^MAG(2005,IEN,0))
"RTN","MAGQBUT2",83,0)
 I X0="" S $P(R,"^",5)=T(13)_"~1" Q R
"RTN","MAGQBUT2",84,0)
 S IDFN=$P(X0,"^",7),$P(R,"^",4)=IDFN
"RTN","MAGQBUT2",85,0)
 S PT(3.9)="^XMB(3.9,PD0,|Mail message||2|^XMB(3.9,PD0,2005,|MAIL"
"RTN","MAGQBUT2",86,0)
 ; The following 5 Lab subsections must be in-synch with FILE+42^MAGGTLB1
"RTN","MAGQBUT2",87,0)
 ; IA #1962
"RTN","MAGQBUT2",88,0)
 S PT(63)="^LR(PD0,GF,PD1,|Autopsy (microscopic)|AY|1|^LR(PD0,GF,PD1,2005.1,|AUM"
"RTN","MAGQBUT2",89,0)
 S PT(63.02)="^LR(PD0,GF,PD1,|Electron microscopy|EM|1|^LR(PD0,GF,PD1,2005,|EM"
"RTN","MAGQBUT2",90,0)
 S PT(63.08)="^LR(PD0,GF,PD1,|Surgical pathology|SP|1|^LR(PD0,GF,PD1,2005,|SP"
"RTN","MAGQBUT2",91,0)
 S PT(63.09)="^LR(PD0,GF,PD1,|Cytology|CY|1|^LR(PD0,GF,PD1,2005,|CY|"
"RTN","MAGQBUT2",92,0)
 S PT(63.2)="^LR(PD0,GF,PD1,|Autopsy (gross)|AY|1|^LR(PD0,GF,PD1,2005,|AUG"
"RTN","MAGQBUT2",93,0)
 S PT(70)="^RADPT(PDFN,|Radiology Patient||1|"
"RTN","MAGQBUT2",94,0)
 S PT(74)="^RARPT(PD0,|Radiology||2|^RARPT(PD0,2005,|RAD"
"RTN","MAGQBUT2",95,0)
 S PT(130)="^SRF(PD0,|Surgery||1|^SRF(PD0,2005,|SUR"
"RTN","MAGQBUT2",96,0)
 S PT(691)="^MCAR(691,PD0,|Echocardiogram||2|^MCAR(691,PD0,2005,|ECHO"
"RTN","MAGQBUT2",97,0)
 S PT(691.1)="^MCAR(691.1,PD0,|Cardiac catheterization||2|^MCAR(691.1,PD0,2005,|CATH"
"RTN","MAGQBUT2",98,0)
 S PT(691.5)="^MCAR(691.5,PD0,|Electrocardiography||2|^MCAR(691.5,PD0,2005,|ECG"
"RTN","MAGQBUT2",99,0)
 S PT(694)="^MCAR(694,PD0,|Hematology||2|^MCAR(694,PD0,2005,|HEM"
"RTN","MAGQBUT2",100,0)
 S PT(699)="^MCAR(699,PD0,|Endoscopy||2|^MCAR(699,PD0,2005,|ENDO"
"RTN","MAGQBUT2",101,0)
 S PT(699.5)="^MCAR(699.5,PD0,|Medicine||2|^MCAR(699.5,PD0,2005,|GEN"
"RTN","MAGQBUT2",102,0)
 S PT(8925)="^TIU(8925,PD0,|TIU||2|^TIU(8925.91,""ADI"",PD0,|TIU"
"RTN","MAGQBUT2",103,0)
 S IC=$$IC(IEN,.N0,.N2,.GPDFN),$P(R,U,6)=IC
"RTN","MAGQBUT2",104,0)
 I IC="ER" S $P(R,U,5)=T(15)_"~1" Q R
"RTN","MAGQBUT2",105,0)
 I IC["GP",'$O(^MAG(2005,IEN,1,0)) S $P(R,U,5)=T(2)_"~1" Q R
"RTN","MAGQBUT2",106,0)
 D PF(IEN,IC,N0,.PF,.PD0,.PD1,.PD2,.PACS,.IOR,.APR)
"RTN","MAGQBUT2",107,0)
 I "GP^GO"[IC D  Q:$P(R,U,5)'="" R
"RTN","MAGQBUT2",108,0)
 . S I=0
"RTN","MAGQBUT2",109,0)
 . F  S I=$O(^MAG(2005,IOR,1,I)) Q:I'?1N.N  D
"RTN","MAGQBUT2",110,0)
 . . I '$D(^MAG(2005,$P($G(^MAG(2005,IOR,1,I,0)),U),0)) S $P(R,U,5)=T(16)_$S(IC="GO":"~2",1:"~1")
"RTN","MAGQBUT2",111,0)
 . . Q
"RTN","MAGQBUT2",112,0)
 I IC["GO" S $P(R,U,6)=$P(R,U,6)_"~"_IOR
"RTN","MAGQBUT2",113,0)
 I PD2'?1N.N,(('PACS)&(PD0?1N.N)) S $P(R,U,5)=T(10)_$S(IC["GO":"~2",1:"~1") Q R
"RTN","MAGQBUT2",114,0)
 I IC["GO" D  Q:$P(R,U,5)'="" R
"RTN","MAGQBUT2",115,0)
 . N I,J
"RTN","MAGQBUT2",116,0)
 . S (I,J)=0
"RTN","MAGQBUT2",117,0)
 . F  S I=$O(^MAG(2005,IOR,1,I)) Q:I'?1N.N  S:IEN=$P($G(^MAG(2005,IOR,1,I,0)),U,1) J=1
"RTN","MAGQBUT2",118,0)
 . S:J=0 $P(R,U,5)=T(7)_"~2"
"RTN","MAGQBUT2",119,0)
 . Q
"RTN","MAGQBUT2",120,0)
 I IC["GO",IDFN'=GPDFN S $P(R,U,5)=T(5)_"~1",$P(R,U,3)=GPDFN Q R
"RTN","MAGQBUT2",121,0)
 I IC["GO" D  Q:$P(R,U,5)'="" R
"RTN","MAGQBUT2",122,0)
 . N I,J
"RTN","MAGQBUT2",123,0)
 . S I=0
"RTN","MAGQBUT2",124,0)
 . F  S I=$O(^MAG(2005,IOR,1,I)) Q:I'?1N.N  D  Q:$P(R,U,5)'=""
"RTN","MAGQBUT2",125,0)
 . . S J=$P($G(^MAG(2005,IOR,1,I,0)),U)
"RTN","MAGQBUT2",126,0)
 . . I $P($G(^MAG(2005,J,0)),U,7)'=IDFN S $P(R,U,5)=T(11)_"~2",$P(R,U,3)=$P($G(^MAG(2005,J,0)),U,7)
"RTN","MAGQBUT2",127,0)
 . . Q
"RTN","MAGQBUT2",128,0)
 I IC["GO",PACS,(($P(N2,U,6,7)'="")&($P(N2,U,6,7)'="^")),$P(N2,U,6,7)'=$P($G(^MAG(2005,$P(N0,U,10),2)),U,6,7) D  Q R
"RTN","MAGQBUT2",129,0)
 . S $P(R,U,5)=T(6)_"~1",$P(R,U,3)=$P(^MAG(2005,IOR,0),U,7) Q
"RTN","MAGQBUT2",130,0)
 I (PF\1=63),PD1'?1N.N,PD1'?1N.N1"."1N.N Q R
"RTN","MAGQBUT2",131,0)
 I PF?1N.E,$D(PT(+PF)),PD0?1N.N D
"RTN","MAGQBUT2",132,0)
 . S $P(R,"^",2)=$P(PT(PF),"|",6)_"~"_PD0
"RTN","MAGQBUT2",133,0)
 . S GR=$P(PT(PF),"|",1),GR0=GR_"0)"
"RTN","MAGQBUT2",134,0)
 . S GF=$P(PT(PF),"|",3),GP=$P(PT(PF),"|",4)
"RTN","MAGQBUT2",135,0)
 . S T=$P(PT(PF),"|",5),GRD=T_"G0,0)",GRG=T_"G0)"
"RTN","MAGQBUT2",136,0)
 E  D  Q R
"RTN","MAGQBUT2",137,0)
 . S:((IC["GP")&($P(R,U,5)="")) $P(R,U,5)="1"
"RTN","MAGQBUT2",138,0)
 S P0=$G(@GR0)
"RTN","MAGQBUT2",139,0)
 I P0="" S $P(R,"^",5)=T(4)_$S((('PACS)&(IC["GO")):"~2",1:"~1") Q R
"RTN","MAGQBUT2",140,0)
 S PDFN=$S(PF\1=63:$P(^LR(PD0,0),U,3),$P(P0,"^",GP)'="":$P(P0,"^",GP),1:PDFN)
"RTN","MAGQBUT2",141,0)
 I 'PDFN,$P($G(^VA(200,IDFN,0)),"^",1)=PDFN S PDFN=IDFN
"RTN","MAGQBUT2",142,0)
 S $P(R,"^",3)=PDFN
"RTN","MAGQBUT2",143,0)
 I PDFN'=IDFN S $P(R,U,5)=T(3)_$S((('PACS)&(IC["GO")):"~2",1:"~1") Q R
"RTN","MAGQBUT2",144,0)
 I PF=74 D
"RTN","MAGQBUT2",145,0)
 . S GR=$P(PT(70),"|",1),GR0=GR_"0)"
"RTN","MAGQBUT2",146,0)
 . S GF=$P(PT(70),"|",3),GP=$P(PT(70),"|",4)
"RTN","MAGQBUT2",147,0)
 . S P0=$G(@GR0),$P(R,"^",3)=$P(R,"^",3)_"~"_$P(P0,"^",GP)
"RTN","MAGQBUT2",148,0)
 S T=1,G0=0,IENV=0
"RTN","MAGQBUT2",149,0)
 F  S G0=$O(@GRG) Q:'G0  Q:$P(R,U,5)'=""  D  I 'T K PT Q
"RTN","MAGQBUT2",150,0)
 . I PF=8925 D  Q
"RTN","MAGQBUT2",151,0)
 . . I '$D(^MAG(2005,+G0,0)) S $P(R,U,5)=T(14)_$S((('PACS)&(IC["GO")):"~2",1:"~1")
"RTN","MAGQBUT2",152,0)
 . . S:G0=IOR IENV=1
"RTN","MAGQBUT2",153,0)
 . . I $P($G(^MAG(2005,+G0,0)),"^",7)'=IDFN S $P(R,U,5)=T(21)_"~2",$P(R,U,3)=$P($G(^MAG(2005,+G0,0)),"^",7)
"RTN","MAGQBUT2",154,0)
 . . Q
"RTN","MAGQBUT2",155,0)
 . I '$D(^MAG(2005,+$P($G(@GRD),"^",1),0)) S $P(R,U,5)=T(14)_$S((('PACS)&(IC["GO")):"~2",1:"~1")
"RTN","MAGQBUT2",156,0)
 . I $P($G(^MAG(2005,+$P($G(@GRD),"^",1),0)),"^",7)'=IDFN D  Q
"RTN","MAGQBUT2",157,0)
 . . S $P(R,U,5)=T(21)_"~2",$P(R,U,3)=$P($G(^MAG(2005,+$P($G(@GRD),"^",1),0)),"^",7) Q
"RTN","MAGQBUT2",158,0)
 . I PF=63 S:+$P($G(^LR(PD0,GF,PD1,2005.1,G0,0)),U)=IOR IENV=1
"RTN","MAGQBUT2",159,0)
 . I PF=63.2 S:+$P($G(^LR(PD0,GF,PD1,2005,G0,0)),U)=IOR IENV=1
"RTN","MAGQBUT2",160,0)
 . S:+$P($G(@GRD),"^",1)=IOR IENV=1
"RTN","MAGQBUT2",161,0)
 . Q
"RTN","MAGQBUT2",162,0)
 Q:$P(R,U,5)'="" R
"RTN","MAGQBUT2",163,0)
 I IC["GP" S $P(R,U,5)="1"
"RTN","MAGQBUT2",164,0)
 I IENV=0 S $P(R,U,5)=T(1)_"~1"
"RTN","MAGQBUT2",165,0)
 I PF=74 S $P(R,"^",1)=$P(P0,"^",1)
"RTN","MAGQBUT2",166,0)
 K PT
"RTN","MAGQBUT2",167,0)
 Q R
"RTN","MAGQBUT2",168,0)
IC(IEN,N0,N2,GPDFN) ;
"RTN","MAGQBUT2",169,0)
 S N0=$G(^MAG(2005,IEN,0))
"RTN","MAGQBUT2",170,0)
 S N1=$G(^MAG(2005,IEN,1,0))
"RTN","MAGQBUT2",171,0)
 S N2=$G(^MAG(2005,IEN,2))
"RTN","MAGQBUT2",172,0)
 I ($P(N0,U,2)="")&($P(N0,U,10)="")&($P(N1,U,4)>0) Q "GP"
"RTN","MAGQBUT2",173,0)
 I (($P(N0,U,2)'="")&($P(N0,U,10)?1N.N)&(N1="")) D  Q "GO"
"RTN","MAGQBUT2",174,0)
 . S GPDFN=$P($G(^MAG(2005,$P(N0,U,10),0)),U,7) Q
"RTN","MAGQBUT2",175,0)
 I ($P(N0,U,2)'="")&($P(N0,U,10)'?1N.N)&(N1="") Q "NG"
"RTN","MAGQBUT2",176,0)
 Q "ER"
"RTN","MAGQBUT2",177,0)
PF(IEN,IC,N0,PF,PD0,PD1,PD2,PACS,IOR,APR) ;
"RTN","MAGQBUT2",178,0)
 N N2
"RTN","MAGQBUT2",179,0)
 S PACS=$S($D(^MAG(2005,IEN,"PACS")):1,1:0)
"RTN","MAGQBUT2",180,0)
 S IOR=$S(IC="GO":$P($G(N0),U,10),1:IEN)
"RTN","MAGQBUT2",181,0)
 I ((IC="GP")!(IC="NG")!((PACS)&(IC="GO"))) S N2=$G(^MAG(2005,IEN,2))
"RTN","MAGQBUT2",182,0)
 I ((IC="GO")&('PACS)) S N2=$G(^MAG(2005,IOR,2))
"RTN","MAGQBUT2",183,0)
 S PF=$P(N2,"^",6),PD0=$P(N2,"^",7),PD1=$P(N2,"^",10),PD2=$P(N2,"^",8)
"RTN","MAGQBUT2",184,0)
 I PACS S APR=$S(PD0?1N.N:1,1:0)
"RTN","MAGQBUT2",185,0)
 E  S APR=$S(((PF'="")&(PD0?1N.N)):1,$P($G(^MAG(2005,IOR,100)),U)?1N.N:1,$P($G(^MAG(2005,IOR,0)),U,6)="18":1,1:0)
"RTN","MAGQBUT2",186,0)
 Q
"RTN","MAGQBUT2",187,0)
DBQ(QIEN,PLACE,ZNODE) ;
"RTN","MAGQBUT2",188,0)
 N INDX
"RTN","MAGQBUT2",189,0)
 F INDX="DELETE","ABSTRACT","JUKEBOX","JBTOHD","PREFET","IMPORT","EVAL" D
"RTN","MAGQBUT2",190,0)
 . K ^MAGQUEUE(2006.03,"C",PLACE,INDX,QIEN)
"RTN","MAGQBUT2",191,0)
 . K:$P(ZNODE,U,5)]"" ^MAGQUEUE(2006.03,"D",PLACE,INDX,$E($P(ZNODE,U,5),1,30),QIEN)
"RTN","MAGQBUT2",192,0)
 . I INDX="JUKEBOX" D
"RTN","MAGQBUT2",193,0)
 . . K:$P(ZNODE,U,7) ^MAGQUEUE(2006.03,"E",PLACE,$P(ZNODE,U,7),QIEN) Q
"RTN","MAGQBUT2",194,0)
 . I "^JBTOHD^PREFET^"[("^"_INDX_"^") D
"RTN","MAGQBUT2",195,0)
 . . K:((+$P(ZNODE,U,7))&($P(ZNODE,U,8)]"")) ^MAGQUEUE(2006.03,"F",PLACE,$P(ZNODE,U,7),$P(ZNODE,U,8),QIEN) Q
"RTN","MAGQBUT2",196,0)
 K ^MAGQUEUE(2006.03,QIEN,0)
"RTN","MAGQBUT2",197,0)
 Q
"RTN","MAGQBUT2",198,0)
DQUE(QIEN,QONLY) ;
"RTN","MAGQBUT2",199,0)
 N ZNODE,TYPE,MAGIEN,PLACE,QP,TMP,DA,IMPORTIEN
"RTN","MAGQBUT2",200,0)
 S ZNODE=$G(^MAGQUEUE(2006.03,QIEN,0))
"RTN","MAGQBUT2",201,0)
 S PLACE=$P(ZNODE,U,12)
"RTN","MAGQBUT2",202,0)
 S TYPE=$P(ZNODE,U)
"RTN","MAGQBUT2",203,0)
 I TYPE="" D DBQ^MAGQBUT2(QIEN,PLACE,ZNODE) Q
"RTN","MAGQBUT2",204,0)
 I "^IMPORT^"[("^"_TYPE_"^") S IMPORTIEN=$S($P(ZNODE,U,11)?1N.N:$P(ZNODE,U,11),1:QIEN)
"RTN","MAGQBUT2",205,0)
 S MAGIEN=$P(ZNODE,U,7)
"RTN","MAGQBUT2",206,0)
 S QP=$O(^MAGQUEUE(2006.031,"C",PLACE,TYPE,""))
"RTN","MAGQBUT2",207,0)
 L +^MAGQUEUE(2006.031,QP,0):1E9
"RTN","MAGQBUT2",208,0)
 S TMP=$G(^MAGQUEUE(2006.031,QP,0))
"RTN","MAGQBUT2",209,0)
 S $P(TMP,U,5)=$P(TMP,U,5)-1
"RTN","MAGQBUT2",210,0)
 S ^MAGQUEUE(2006.031,QP,0)=TMP
"RTN","MAGQBUT2",211,0)
 L -^MAGQUEUE(2006.031,QP,0)
"RTN","MAGQBUT2",212,0)
 K ^MAGQUEUE(2006.03,"C",PLACE,$P(ZNODE,U),QIEN)
"RTN","MAGQBUT2",213,0)
 K ^MAGQUEUE(2006.03,QIEN,0)
"RTN","MAGQBUT2",214,0)
 I $P(ZNODE,U,5)]"" D
"RTN","MAGQBUT2",215,0)
 . K ^MAGQUEUE(2006.03,"D",PLACE,TYPE,$E($P(ZNODE,U,5),1,30),QIEN)
"RTN","MAGQBUT2",216,0)
 L +^MAGQUEUE(2006.03,0):1E9
"RTN","MAGQBUT2",217,0)
 S $P(^MAGQUEUE(2006.03,0),"^",4)=$P(^MAGQUEUE(2006.03,0),"^",4)-1
"RTN","MAGQBUT2",218,0)
 L -^MAGQUEUE(2006.03,0)
"RTN","MAGQBUT2",219,0)
 I "^IMPORT^"[("^"_TYPE_"^"),'$D(QONLY) D  Q
"RTN","MAGQBUT2",220,0)
 . I $D(^MAG(2006.041,"B",IMPORTIEN)) D
"RTN","MAGQBUT2",221,0)
 . . N TRACKID,ASIEN,SIEN
"RTN","MAGQBUT2",222,0)
 . . S ASIEN=$O(^MAG(2006.041,"B",IMPORTIEN)) Q:ASIEN=""
"RTN","MAGQBUT2",223,0)
 . . S TRACKID=$P($G(^MAG(2006.041,ASIEN)),U,2) Q:TRACKID=""
"RTN","MAGQBUT2",224,0)
 . . S ASIEN="A",ASIEN=$O(^MAG(2006.041,"C",TRACKID,ASIEN),-1)
"RTN","MAGQBUT2",225,0)
 . . F  S SIEN=$O(^MAG(2006.041,"C",TRACKID,SIEN),-1) Q:'SIEN  D
"RTN","MAGQBUT2",226,0)
 . . . S DIK="^MAG(2006.041,",DA=SIEN
"RTN","MAGQBUT2",227,0)
 . . . D ^DIK K DIK,DA
"RTN","MAGQBUT2",228,0)
 . . . Q
"RTN","MAGQBUT2",229,0)
 . . Q
"RTN","MAGQBUT2",230,0)
 . S DIK="^MAG(2006.034,",DA=IMPORTIEN D ^DIK
"RTN","MAGQBUT2",231,0)
 . K DIK,DA
"RTN","MAGQBUT2",232,0)
 . K:MAGIEN ^MAGQUEUE(2006.03,"E",PLACE,MAGIEN,IMPORTIEN)
"RTN","MAGQBUT2",233,0)
 . Q 
"RTN","MAGQBUT2",234,0)
 Q:("^JBTOHD^PREFET^JUKEBOX^")'[("^"_TYPE_"^")
"RTN","MAGQBUT2",235,0)
 S MAGIEN=$P(ZNODE,U,7)
"RTN","MAGQBUT2",236,0)
 Q:'MAGIEN
"RTN","MAGQBUT2",237,0)
 I TYPE="JUKEBOX" D  Q
"RTN","MAGQBUT2",238,0)
 . K ^MAGQUEUE(2006.03,"E",PLACE,MAGIEN,QIEN)
"RTN","MAGQBUT2",239,0)
 I "^JBTOHD^PREFET^"[("^"_TYPE_"^") D  Q
"RTN","MAGQBUT2",240,0)
 . Q:$P(ZNODE,U,8)']""
"RTN","MAGQBUT2",241,0)
 . K ^MAGQUEUE(2006.03,"F",PLACE,MAGIEN,$P(ZNODE,U,8),QIEN)
"RTN","MAGQBUT2",242,0)
 . Q
"RTN","MAGQBUT2",243,0)
 Q
"RTN","MAGQBUT2",244,0)
DQUE1(RESULT,QIEN) ;[MAGQB QUEDEL]
"RTN","MAGQBUT2",245,0)
 N X,TYPE
"RTN","MAGQBUT2",246,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT2",247,0)
 S RESULT=0
"RTN","MAGQBUT2",248,0)
 S TYPE=$P($G(^MAGQUEUE(2006.03,QIEN,0)),U)
"RTN","MAGQBUT2",249,0)
 D QRNGE^MAGQBUT5(.RESULT,TYPE,"DEL",QIEN,QIEN)
"RTN","MAGQBUT2",250,0)
 S RESULT=1
"RTN","MAGQBUT2",251,0)
 Q
"RTN","MAGQBUT2",252,0)
JBQUE(RESULT,QIEN) ; RPC[MAGQ JBQUE]
"RTN","MAGQBUT2",253,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT2",254,0)
 I '+QIEN S RESULT=0 Q
"RTN","MAGQBUT2",255,0)
 S RESULT=$$JUKEBOX^MAGBAPI(QIEN,$$PLACE^MAGBAPI(+$G(DUZ(2))))
"RTN","MAGQBUT2",256,0)
 Q
"RTN","MAGQBUT4")
0^20^B92803022
"RTN","MAGQBUT4",1,0)
MAGQBUT4 ;WOIFO/RMP - BP Utilities ; 18 Jan 2011 5:17 PM
"RTN","MAGQBUT4",2,0)
 ;;3.0;IMAGING;**7,8,48,20,81,39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGQBUT4",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGQBUT4",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBUT4",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBUT4",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBUT4",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBUT4",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBUT4",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBUT4",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBUT4",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBUT4",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBUT4",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBUT4",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBUT4",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBUT4",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBUT4",17,0)
 ;;
"RTN","MAGQBUT4",18,0)
 ;
"RTN","MAGQBUT4",19,0)
 Q
"RTN","MAGQBUT4",20,0)
CONV(ARR,ICT) ;Convert any single node array to FM Style multiple
"RTN","MAGQBUT4",21,0)
 ;  The node subscripts of ARR are ignored, and not retained
"RTN","MAGQBUT4",22,0)
 ; i.e.  ARR(34)=8
"RTN","MAGQBUT4",23,0)
 ;       ARR("BLUE")=9
"RTN","MAGQBUT4",24,0)
 ;       ARR("D")=10
"RTN","MAGQBUT4",25,0)
 ; converts to
"RTN","MAGQBUT4",26,0)
 ;      ARR(1,0)=8
"RTN","MAGQBUT4",27,0)
 ;      ARR(2,0)=9
"RTN","MAGQBUT4",28,0)
 ;      ARR(3,0)=10
"RTN","MAGQBUT4",29,0)
 N I,ARO
"RTN","MAGQBUT4",30,0)
 S ICT=0,I=""
"RTN","MAGQBUT4",31,0)
 F  S I=$O(ARR(I)) Q:(I="")  D
"RTN","MAGQBUT4",32,0)
 . S ICT=ICT+1
"RTN","MAGQBUT4",33,0)
 . S ARO(ICT,0)=ARR(I)
"RTN","MAGQBUT4",34,0)
 K ARR
"RTN","MAGQBUT4",35,0)
 M ARR=ARO
"RTN","MAGQBUT4",36,0)
 Q
"RTN","MAGQBUT4",37,0)
MRGMULT(ARR,RT,RTDSC,CT) ;Merge the FM formatted array into a FM File
"RTN","MAGQBUT4",38,0)
 ;   multiple field.
"RTN","MAGQBUT4",39,0)
 ;   This isn't for general consumption.
"RTN","MAGQBUT4",40,0)
 ; RT = FILE ROOT, RECORD NUMBER, NODE
"RTN","MAGQBUT4",41,0)
 ; i.e.  "^MAG(2006.034,44,1,"   -> 44 is the IEN of MAG(2006.34
"RTN","MAGQBUT4",42,0)
 ; RTDSC is the 2nd piece of the 0 node of the multiple field.
"RTN","MAGQBUT4",43,0)
 S RT=$E(RT,1,$L(RT)-1)_")"
"RTN","MAGQBUT4",44,0)
 S @RT@(0)=U_RTDSC_U_CT_U_CT ;  i.e.    ^2006.341A^13^13
"RTN","MAGQBUT4",45,0)
 M @RT=ARR
"RTN","MAGQBUT4",46,0)
 Q
"RTN","MAGQBUT4",47,0)
DDLF(RESULTS,FILE,FIELD,FLAGS,ATTR) ;[MAG FLD ATT]
"RTN","MAGQBUT4",48,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT4",49,0)
 K X
"RTN","MAGQBUT4",50,0)
 N I
"RTN","MAGQBUT4",51,0)
 D FIELD^DID(FILE,FIELD,FLAGS,ATTR,"RESULTS","RESULTS")
"RTN","MAGQBUT4",52,0)
 S I=0 F  S I=I+1 Q:'$D(RESULTS(ATTR,I))  M RESULTS(I)=RESULTS(ATTR,I)
"RTN","MAGQBUT4",53,0)
 Q
"RTN","MAGQBUT4",54,0)
DDFA(RESULTS) ;[MAG ATT LST]
"RTN","MAGQBUT4",55,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT4",56,0)
 K X
"RTN","MAGQBUT4",57,0)
 D FIELDLST^DID(RESULTS)
"RTN","MAGQBUT4",58,0)
 Q
"RTN","MAGQBUT4",59,0)
DVAL(RESULTS,FILE,IENS,FIELD,FLAGS,VALUE) ;[MAG FIELD VALIDATE]
"RTN","MAGQBUT4",60,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT4",61,0)
 K X
"RTN","MAGQBUT4",62,0)
 I FLAGS']"" S FLAGS="EHU"
"RTN","MAGQBUT4",63,0)
 D VAL^DIE(FILE,IENS,FIELD,FLAGS,VALUE,.RESULT,"","MSG")
"RTN","MAGQBUT4",64,0)
 I RESULT=U S RESULTS="-1^"_$G(MSG("DIERR","1","TEXT","1"))
"RTN","MAGQBUT4",65,0)
 E  S RESULTS=1_U_RESULT_U_$G(RESULT(0))
"RTN","MAGQBUT4",66,0)
 Q
"RTN","MAGQBUT4",67,0)
KVAL(RESULTS,FLAGS,FDA) ;[MAG KEY VALIDATE]
"RTN","MAGQBUT4",68,0)
 N TMP,DDRFDA
"RTN","MAGQBUT4",69,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT4",70,0)
 K X
"RTN","MAGQBUT4",71,0)
 D FDASET(.FDA,.DDRFDA)
"RTN","MAGQBUT4",72,0)
 S TMP=$$KEYVAL^DIE(FLAGS,"DDRFDA","MSG")
"RTN","MAGQBUT4",73,0)
 S RESULTS=$S(TMP=1:1,1:"-1^"_$G(MSG("DIERR","1","TEXT","1")))
"RTN","MAGQBUT4",74,0)
 K DDRFDA,MSG
"RTN","MAGQBUT4",75,0)
 Q
"RTN","MAGQBUT4",76,0)
FDASET(DDRROOT,DDRFDA) ;
"RTN","MAGQBUT4",77,0)
 N DDRFILE,DDRIEN,DDRFIELD,DDRVAL,DDRERR,I
"RTN","MAGQBUT4",78,0)
 S I=0
"RTN","MAGQBUT4",79,0)
 F  S I=$O(DDRROOT(I)) Q:'I  S X=DDRROOT(I) D
"RTN","MAGQBUT4",80,0)
 . S DDRFILE=$P(X,U)
"RTN","MAGQBUT4",81,0)
 . S DDRFIELD=$P(X,U,2)
"RTN","MAGQBUT4",82,0)
 . S DDRIEN=$P(X,U,3)
"RTN","MAGQBUT4",83,0)
 . S DDRVAL=$P(X,U,4,99)
"RTN","MAGQBUT4",84,0)
 . D FDA^DILF(DDRFILE,DDRIEN_$S($E(DDRIEN,$L(DDRIEN))'=",":",",1:""),DDRFIELD,"",DDRVAL,"DDRFDA","DDRERR")
"RTN","MAGQBUT4",85,0)
 Q
"RTN","MAGQBUT4",86,0)
DHRPC(RESULTS,FNAME,FLOC) ;[MAG DIRHASH]
"RTN","MAGQBUT4",87,0)
 N TMP
"RTN","MAGQBUT4",88,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT4",89,0)
 K X
"RTN","MAGQBUT4",90,0)
 S TMP=$$DIRHASH^MAGFILEB(FNAME,FLOC)
"RTN","MAGQBUT4",91,0)
 S RESULTS=$S(TMP="":U,1:TMP)
"RTN","MAGQBUT4",92,0)
 Q
"RTN","MAGQBUT4",93,0)
GPACHX(PV) ; Get Package File Install History of Imaging
"RTN","MAGQBUT4",94,0)
 N I,LCNT,MSG,PKG
"RTN","MAGQBUT4",95,0)
 S LCNT=0
"RTN","MAGQBUT4",96,0)
 S PV(0)="Version^Install Date"
"RTN","MAGQBUT4",97,0)
 F PKG="IMAGING" D
"RTN","MAGQBUT4",98,0)
 . N J,K,L,VERS,DATE,X,Y
"RTN","MAGQBUT4",99,0)
 . S J=$O(^DIC(9.4,"B",PKG,"")) Q:'J
"RTN","MAGQBUT4",100,0)
 . S VERS="" F  S VERS=$O(^DIC(9.4,J,22,"B",VERS)) Q:VERS=""  D
"RTN","MAGQBUT4",101,0)
 . . N MSG,TAR
"RTN","MAGQBUT4",102,0)
 . . S K=$O(^DIC(9.4,J,22,"B",VERS,""))
"RTN","MAGQBUT4",103,0)
 . . D LIST^DIC(9.4901,","_K_","_J_",","@;.01;.02;.03","","","","","","","","TAR","MSG")
"RTN","MAGQBUT4",104,0)
 . . Q:$D(MSG("DIERR"))
"RTN","MAGQBUT4",105,0)
 . . S L=0 F  S L=$O(TAR("DILIST","ID",L)) Q:'L  D
"RTN","MAGQBUT4",106,0)
 . . . S LCNT=LCNT+1
"RTN","MAGQBUT4",107,0)
 . . . S PV(LCNT)=VERS_"P"_$P(TAR("DILIST","ID",L,".01"),"^",1)
"RTN","MAGQBUT4",108,0)
 . . . S X=$P($P(TAR("DILIST","ID",L,".02"),"^",1),"@",1)
"RTN","MAGQBUT4",109,0)
 . . . S PV(LCNT)=PV(LCNT)_"^"_$S(X["-1":"",1:X)
"RTN","MAGQBUT4",110,0)
 . . . Q
"RTN","MAGQBUT4",111,0)
 . . Q
"RTN","MAGQBUT4",112,0)
 . Q
"RTN","MAGQBUT4",113,0)
 Q
"RTN","MAGQBUT4",114,0)
 ;
"RTN","MAGQBUT4",115,0)
VOKR(RESULT,VER) ; RPC for VOK [MAGQ VOK]
"RTN","MAGQBUT4",116,0)
 N CVERS,PNUM,SLINE
"RTN","MAGQBUT4",117,0)
 S VER="3.0P"_($$TRIM($P(VER,"P",2)))
"RTN","MAGQBUT4",118,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT4",119,0)
 S SLINE=$T(+2)
"RTN","MAGQBUT4",120,0)
 S PNUM=$$TRIM($P(SLINE,"**",2)),PNUM=$$TRIM($P(PNUM,",",$L(PNUM,",")))
"RTN","MAGQBUT4",121,0)
 S CVERS=$$TRIM($P(SLINE,";",3))_"P"_PNUM
"RTN","MAGQBUT4",122,0)
 S RESULT=$S(CVERS=VER:1,1:0)_U_CVERS
"RTN","MAGQBUT4",123,0)
 Q
"RTN","MAGQBUT4",124,0)
 ;
"RTN","MAGQBUT4",125,0)
TRIM(X) ; remove both leading and trailing blanks
"RTN","MAGQBUT4",126,0)
 N I,J
"RTN","MAGQBUT4",127,0)
 F I=1:1:$L(X) Q:$E(X,I)'=" "
"RTN","MAGQBUT4",128,0)
 F J=$L(X):-1:I Q:$E(X,J)'=" "
"RTN","MAGQBUT4",129,0)
 Q $S($E(X,I,J)=" ":"",1:$E(X,I,J))
"RTN","MAGQBUT4",130,0)
 ;
"RTN","MAGQBUT4",131,0)
QCNT(RESULT,PLC,QUE) ; [MAGQ QCNT] Called from MagQueManSet.pas and MagSiteParameters.pas
"RTN","MAGQBUT4",132,0)
 N CNT,DA,CQ,IA,X
"RTN","MAGQBUT4",133,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT4",134,0)
 ;CQ=Current Queue Pointer(#2006.03) 
"RTN","MAGQBUT4",135,0)
 ;QP=Queue file pointer(#2006.031)
"RTN","MAGQBUT4",136,0)
 ;CNT=Queue type total, IA=Not failed total
"RTN","MAGQBUT4",137,0)
 S IA="",RESULT=0
"RTN","MAGQBUT4",138,0)
 S (CNT,IA)=0,DA=""
"RTN","MAGQBUT4",139,0)
 S QP=$S($D(^MAGQUEUE(2006.031,"C",PLC,QUE)):$O(^MAGQUEUE(2006.031,"C",PLC,QUE,"")),1:"")
"RTN","MAGQBUT4",140,0)
 S CQ=$S('QP:0,1:$P($G(^MAGQUEUE(2006.031,QP,0)),U,2))
"RTN","MAGQBUT4",141,0)
 F  S DA=$O(^MAGQUEUE(2006.03,"C",PLC,QUE,DA)) Q:'DA  D
"RTN","MAGQBUT4",142,0)
 . I '$D(^MAGQUEUE(2006.03,DA,0)) K ^MAGQUEUE(2006.03,"C",PLC,QUE,DA) Q 
"RTN","MAGQBUT4",143,0)
 . S CNT=CNT+1
"RTN","MAGQBUT4",144,0)
 . I CQ<DA S IA=IA+1
"RTN","MAGQBUT4",145,0)
 . Q
"RTN","MAGQBUT4",146,0)
 D QPUP(PLC,QUE,CNT,CQ,IA,QP) Q
"RTN","MAGQBUT4",147,0)
 Q
"RTN","MAGQBUT4",148,0)
 ;
"RTN","MAGQBUT4",149,0)
QPUP(PLC,QUE,CNT,CQ,IA,QP) ;
"RTN","MAGQBUT4",150,0)
 N IEN,DIC,VAL
"RTN","MAGQBUT4",151,0)
 K VAL
"RTN","MAGQBUT4",152,0)
 S VAL(1)=PLC,VAL(2)=QUE
"RTN","MAGQBUT4",153,0)
 S QP=$S(QP:QP,1:$$FIND1^DIC(2006.031,"","QX",.VAL,"C","",""))
"RTN","MAGQBUT4",154,0)
 ;I IEN>0 D  Q:IEN
"RTN","MAGQBUT4",155,0)
 ;. S $P(^MAGQUEUE(2006.031,IEN,0),U,5)=CNT Q
"RTN","MAGQBUT4",156,0)
 I 'QP D  Q
"RTN","MAGQBUT4",157,0)
 . K DIE,FDA
"RTN","MAGQBUT4",158,0)
 . S FDA(2006.031,"+1,",.01)=QUE
"RTN","MAGQBUT4",159,0)
 . S FDA(2006.031,"+1,",.04)=PLC
"RTN","MAGQBUT4",160,0)
 . S FDA(2006.031,"+1,",1)=CQ
"RTN","MAGQBUT4",161,0)
 . S FDA(2006.031,"+1,",2)=IA
"RTN","MAGQBUT4",162,0)
 . S FDA(2006.031,"+1,",3)=CNT
"RTN","MAGQBUT4",163,0)
 . D UPDATE^DIE("U","FDA","","MAGQUP")
"RTN","MAGQBUT4",164,0)
 . K DIE,FDA
"RTN","MAGQBUT4",165,0)
 E  D
"RTN","MAGQBUT4",166,0)
 . K DIE,FDA
"RTN","MAGQBUT4",167,0)
 . S FDA(2006.031,QP_",",.01)=QUE
"RTN","MAGQBUT4",168,0)
 . S FDA(2006.031,QP_",",.04)=PLC
"RTN","MAGQBUT4",169,0)
 . S FDA(2006.031,QP_",",1)=CQ
"RTN","MAGQBUT4",170,0)
 . S FDA(2006.031,QP_",",2)=IA
"RTN","MAGQBUT4",171,0)
 . S FDA(2006.031,QP_",",3)=CNT
"RTN","MAGQBUT4",172,0)
 . D FILE^DIE("","FDA","MAGERR")
"RTN","MAGQBUT4",173,0)
 . K DIE,FDA
"RTN","MAGQBUT4",174,0)
 Q
"RTN","MAGQBUT4",175,0)
 ;
"RTN","MAGQBUT4",176,0)
CPUD ;
"RTN","MAGQBUT4",177,0)
 N PLC,INS,QUE
"RTN","MAGQBUT4",178,0)
 S (INS,PLC)=""
"RTN","MAGQBUT4",179,0)
 F  S INS=$O(^MAG(2006.1,"B",INS)) Q:INS=""  D
"RTN","MAGQBUT4",180,0)
 . S PLC=$O(^MAG(2006.1,"B",INS,""))
"RTN","MAGQBUT4",181,0)
 . S QUE="" F  S QUE=$O(^MAGQUEUE(2006.031,"C",PLC,QUE)) Q:QUE=""  D
"RTN","MAGQBUT4",182,0)
 . . D QCNT^MAGQBUT4("",PLC,QUE)
"RTN","MAGQBUT4",183,0)
 . . Q
"RTN","MAGQBUT4",184,0)
 . Q
"RTN","MAGQBUT4",185,0)
 Q
"RTN","MAGQBUT4",186,0)
CNL(GL,IEN,NLC) ;  Check Network Location
"RTN","MAGQBUT4",187,0)
 N MAGREF,MAG0,MAG1,PLC
"RTN","MAGQBUT4",188,0)
 S NLC=NLC+1
"RTN","MAGQBUT4",189,0)
 I '$G(IEN) Q ""
"RTN","MAGQBUT4",190,0)
 S MAG0=$G(@(GL_IEN_",0)"))
"RTN","MAGQBUT4",191,0)
 S MAGREF=+$P(MAG0,"^",3)            ; get file from raid
"RTN","MAGQBUT4",192,0)
 I MAGREF=0 S MAGREF=+$P(MAG0,"^",5) ; get file from jukebox
"RTN","MAGQBUT4",193,0)
 I 'MAGREF Q ""
"RTN","MAGQBUT4",194,0)
 I '$D(^MAG(2005.2,MAGREF,0)) Q ""
"RTN","MAGQBUT4",195,0)
 S PLC=$P($G(^MAG(2005.2,MAGREF,0)),U,10)
"RTN","MAGQBUT4",196,0)
 Q:'PLC ""
"RTN","MAGQBUT4",197,0)
 S PLC=$P($G(^MAG(2006.1,PLC,0)),U)
"RTN","MAGQBUT4",198,0)
 Q $S('PLC:"",1:PLC)
"RTN","MAGQBUT4",199,0)
CNSP(GL,IEN,NMSP,NSC) ;  Check NameSPace
"RTN","MAGQBUT4",200,0)
 N NMSPC,MAG0,FNAM,INSTIEN
"RTN","MAGQBUT4",201,0)
 S NSC=NSC+1
"RTN","MAGQBUT4",202,0)
 S MAG0=$G(@(GL_IEN_",0)"))
"RTN","MAGQBUT4",203,0)
 S FNAM=$P(MAG0,U,2)
"RTN","MAGQBUT4",204,0)
 S NMSPC=$TR($P(FNAM,"."),"0123456789","")
"RTN","MAGQBUT4",205,0)
 Q:NMSPC="" ""
"RTN","MAGQBUT4",206,0)
 S INSTIEN=$S($D(NMSP(NMSPC)):$O(NMSP(NMSPC,"")),1:"")
"RTN","MAGQBUT4",207,0)
 Q INSTIEN
"RTN","MAGQBUT4",208,0)
NMSP(TMPA) ;
"RTN","MAGQBUT4",209,0)
 N IEN,INS,TMP,I,J
"RTN","MAGQBUT4",210,0)
 S INS="" F  S INS=$O(^MAG(2006.1,"B",INS)) Q:INS=""  S IEN="" D
"RTN","MAGQBUT4",211,0)
 . S IEN=$O(^MAG(2006.1,"B",INS,IEN)) Q:IEN=""  D  Q
"RTN","MAGQBUT4",212,0)
 . . S TMP=","_$$UPPER^MAGQE4($$INIS^MAGQBPG2(IEN))_"," D  Q
"RTN","MAGQBUT4",213,0)
 . . . F I=2:1 S J=$P(TMP,",",I) Q:J=""  S TMPA(J,INS)=""
"RTN","MAGQBUT4",214,0)
 . . . Q
"RTN","MAGQBUT4",215,0)
 S J="" F  S J=$O(TMPA(J)) Q:J=""  S INS=$O(TMPA(J,"")) K:($O(TMPA(J,INS))]"") TMPA(J)
"RTN","MAGQBUT4",216,0)
 Q
"RTN","MAGQBUT4",217,0)
CLRQ ; Clears the Queue file and Queue Pointer files
"RTN","MAGQBUT4",218,0)
 N DA,DIK,FILE,IEN
"RTN","MAGQBUT4",219,0)
 F FILE=2006.03,2006.031 D
"RTN","MAGQBUT4",220,0)
 . S IEN=0 F  S IEN=$O(^MAGQUEUE(FILE,IEN)) Q:'IEN  D
"RTN","MAGQBUT4",221,0)
 . . S DIK="^MAGQUEUE("_FILE_","
"RTN","MAGQBUT4",222,0)
 . . S DA=IEN,DA(1)=FILE D ^DIK
"RTN","MAGQBUT4",223,0)
 K DIK,DA
"RTN","MAGQBUT4",224,0)
 Q
"RTN","MAGQBUT4",225,0)
 ; We add RPC to MAG WINDOWS Option this way instead of sending Option : MAG WINDOWS
"RTN","MAGQBUT4",226,0)
 ; If we send MAG WINDOWS Option, the last one installed will overwrite others.
"RTN","MAGQBUT4",227,0)
 ; ADDRPC copied from Patch 51, added the call "D MES^XPDUTL(" instead of "W !"
"RTN","MAGQBUT4",228,0)
ADDRPC(RPCNAME,OPTNAME) ;
"RTN","MAGQBUT4",229,0)
 N DA,DIC
"RTN","MAGQBUT4",230,0)
 S DIC="^DIC(19,",DIC(0)="",X=OPTNAME D ^DIC
"RTN","MAGQBUT4",231,0)
 I Y<0 D  Q
"RTN","MAGQBUT4",232,0)
 . D MES^XPDUTL("Cannot add RPC: """_RPCNAME_""" to Option: """_OPTNAME_""".")
"RTN","MAGQBUT4",233,0)
 . D MES^XPDUTL("Cannot find Option: """_OPTNAME_""".")
"RTN","MAGQBUT4",234,0)
 . Q
"RTN","MAGQBUT4",235,0)
 I '$D(^XWB(8994,"B",RPCNAME)) D  Q
"RTN","MAGQBUT4",236,0)
 . D MES^XPDUTL("Cannot add RPC: """_RPCNAME_""" to Option: """_OPTNAME_""".")
"RTN","MAGQBUT4",237,0)
 . D MES^XPDUTL("Cannot find RPC: """_RPCNAME_""".")
"RTN","MAGQBUT4",238,0)
 . Q
"RTN","MAGQBUT4",239,0)
 S DA(1)=+Y
"RTN","MAGQBUT4",240,0)
 I $D(^DIC(19,+Y,"RPC","B",$O(^XWB(8994,"B",RPCNAME,"")))) D  Q
"RTN","MAGQBUT4",241,0)
 . D MES^XPDUTL("Cannot add RPC: """_RPCNAME_""" to Option: """_OPTNAME_""".")
"RTN","MAGQBUT4",242,0)
 . D MES^XPDUTL("RPC: """_RPCNAME_""" is already a member of """_OPTNAME_""".")
"RTN","MAGQBUT4",243,0)
 . Q
"RTN","MAGQBUT4",244,0)
 S DIC=DIC_DA(1)_",""RPC"","
"RTN","MAGQBUT4",245,0)
 S DIC(0)="L",DLAYGO="19" ; LAYGO should be allowed here
"RTN","MAGQBUT4",246,0)
 S X=RPCNAME
"RTN","MAGQBUT4",247,0)
 D ^DIC
"RTN","MAGQBUT4",248,0)
 K DIC,D0,DLAYGO
"RTN","MAGQBUT4",249,0)
 I Y<0 D  Q
"RTN","MAGQBUT4",250,0)
 . D MES^XPDUTL("Cannot add RPC: """_RPCNAME_""" to Option: """_OPTNAME_""".")
"RTN","MAGQBUT4",251,0)
 . D MES^XPDUTL("Cannot find RPC: """_RPCNAME_""".")
"RTN","MAGQBUT4",252,0)
 . Q
"RTN","MAGQBUT4",253,0)
 Q
"RTN","MAGQBUT4",254,0)
INS(XP,DUZ,DATE,IDA) ;
"RTN","MAGQBUT4",255,0)
 N CT,CNT,COM,D,D0,D1,D2,DDATE,DG,DIC,DICR,DIW,MAGMSG,ST,XMID,XMY,PLACE,XMSUB,XMZ
"RTN","MAGQBUT4",256,0)
 S PLACE=$O(^MAG(2006.1,"B",$$KSP^XUPARAM("INST"),""))
"RTN","MAGQBUT4",257,0)
 D GETENV^%ZOSV
"RTN","MAGQBUT4",258,0)
 S CNT=0
"RTN","MAGQBUT4",259,0)
 S CNT=CNT+1,MAGMSG(CNT)="PACKAGE INSTALL"
"RTN","MAGQBUT4",260,0)
 S CNT=CNT+1,MAGMSG(CNT)="SITE: "_$$KSP^XUPARAM("WHERE")
"RTN","MAGQBUT4",261,0)
 S CNT=CNT+1,MAGMSG(CNT)=" Production Account: "_$$PROD^XUPROD("1")
"RTN","MAGQBUT4",262,0)
 S CNT=CNT+1,MAGMSG(CNT)="PACKAGE: "_XP
"RTN","MAGQBUT4",263,0)
 S CNT=CNT+1,MAGMSG(CNT)="Version: "_$$VER^XPDUTL(XP)
"RTN","MAGQBUT4",264,0)
 S ST=$$GET1^DIQ(9.7,IDA,11,"I")
"RTN","MAGQBUT4",265,0)
 S CNT=CNT+1,MAGMSG(CNT)="Start time: "_$$FMTE^XLFDT(ST)
"RTN","MAGQBUT4",266,0)
 S CT=$$GET1^DIQ(9.7,IDA,17,"I") S:+CT'=CT CT=$$NOW^XLFDT
"RTN","MAGQBUT4",267,0)
 S CNT=CNT+1,MAGMSG(CNT)="Completion time: "_$$FMTE^XLFDT(CT)
"RTN","MAGQBUT4",268,0)
 S CNT=CNT+1,MAGMSG(CNT)="Run time: "_$$FMDIFF^XLFDT(CT,ST,3)
"RTN","MAGQBUT4",269,0)
 S CNT=CNT+1,MAGMSG(CNT)="Environment: "_Y
"RTN","MAGQBUT4",270,0)
 S COM=$$GET1^DIQ(9.7,IDA,6,"I")
"RTN","MAGQBUT4",271,0)
 S CNT=CNT+1,MAGMSG(CNT)="FILE COMMENT: "_COM
"RTN","MAGQBUT4",272,0)
 S CNT=CNT+1,MAGMSG(CNT)="DATE: "_DATE
"RTN","MAGQBUT4",273,0)
 S CNT=CNT+1,MAGMSG(CNT)="Installed by: "_$$GET1^DIQ(9.7,IDA,9,"E")
"RTN","MAGQBUT4",274,0)
 S CNT=CNT+1,MAGMSG(CNT)="Install Name: "_$$GET1^DIQ(9.7,IDA,.01,"E")
"RTN","MAGQBUT4",275,0)
 S DDATE=$$GET1^DIQ(9.7,IDA,51,"I")
"RTN","MAGQBUT4",276,0)
 S CNT=CNT+1,MAGMSG(CNT)="Distribution Date: "_$$FMTE^XLFDT(DDATE)
"RTN","MAGQBUT4",277,0)
 S XMSUB=XP_" INSTALLATION"
"RTN","MAGQBUT4",278,0)
 S XMID=$G(DUZ) S:'XMID XMID=.5
"RTN","MAGQBUT4",279,0)
 S XMY(XMID)=""
"RTN","MAGQBUT4",280,0)
 S:$G(MAGDUZ) XMY(MAGDUZ)=""
"RTN","MAGQBUT4",281,0)
 S XMSUB=$E(XMSUB,1,63)
"RTN","MAGQBUT4",282,0)
 D:$$PROD^XUPROD("1") ADDMG^MAGQBUT5(XMSUB,.XMY,PLACE)
"RTN","MAGQBUT4",283,0)
 D SENDMSG^XMXAPI(XMID,XMSUB,"MAGMSG",.XMY,,.XMZ,)
"RTN","MAGQBUT4",284,0)
 I $G(XMERR) M XMERR=^TMP("XMERR",$J) K XMERR
"RTN","MAGQBUT4",285,0)
 K MAGMSG
"RTN","MAGQBUT4",286,0)
 Q
"RTN","MAGQBUT4",287,0)
TEST ;
"RTN","MAGQBUT4",288,0)
 N FDA
"RTN","MAGQBUT4",289,0)
 S FDA(4)="2006.8^.01^+1,^BP1"
"RTN","MAGQBUT4",290,0)
 S FDA(1)="2006.8^.04^+1,^1"
"RTN","MAGQBUT4",291,0)
 S FDA(3)="2006.8^50^+1,^ISW-PRICER"
"RTN","MAGQBUT4",292,0)
 S FDA(2)="2006.8^11^+1,^1"
"RTN","MAGQBUT4",293,0)
 D KVAL(.RESULTS,"Q",.FDA)
"RTN","MAGQBUT4",294,0)
 W !,"RESULTS: "_RESULTS
"RTN","MAGQBUT4",295,0)
 Q
"RTN","MAGQBUT4",296,0)
 ;
"RTN","MAGQBUT5")
0^21^B105448474
"RTN","MAGQBUT5",1,0)
MAGQBUT5 ;WOIFO/RMP - BP Utilities ; 18 Jan 2011 5:19 PM
"RTN","MAGQBUT5",2,0)
 ;;3.0;IMAGING;**20,81,39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGQBUT5",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGQBUT5",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBUT5",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBUT5",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBUT5",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBUT5",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBUT5",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBUT5",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBUT5",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBUT5",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBUT5",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBUT5",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBUT5",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBUT5",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBUT5",17,0)
 ;;
"RTN","MAGQBUT5",18,0)
 Q
"RTN","MAGQBUT5",19,0)
AI(RESULT) ; List of Associated Institution candidates;
"RTN","MAGQBUT5",20,0)
 N INDEX,INST,J,K,L,OUT
"RTN","MAGQBUT5",21,0)
 S K=0
"RTN","MAGQBUT5",22,0)
 S RESULT(K)=""
"RTN","MAGQBUT5",23,0)
 S K=K+1
"RTN","MAGQBUT5",24,0)
 D LIST^DIC(40.8,,".01;.07I",,,,,,,,"OUT")
"RTN","MAGQBUT5",25,0)
 S RESULT(K)="The following Medical Center Divisions have Imaging Site Parameters defined on ",K=K+1
"RTN","MAGQBUT5",26,0)
 S RESULT(K)="your system:" D
"RTN","MAGQBUT5",27,0)
 . S INDEX=0,K=K+1 F  S INDEX=INDEX+1 Q:'$D(OUT("DILIST","ID",INDEX))  D
"RTN","MAGQBUT5",28,0)
 . . S INST=OUT("DILIST","ID",INDEX,.07),J=0 F  S J=$O(^MAG(2006.1,J)) Q:'J  I $P(^MAG(2006.1,J,0),U)=INST D  Q
"RTN","MAGQBUT5",29,0)
 . . . S RESULT(K)=OUT("DILIST","ID",INDEX,.01)_" "_INST,K=K+1 Q
"RTN","MAGQBUT5",30,0)
 . . Q
"RTN","MAGQBUT5",31,0)
 . Q
"RTN","MAGQBUT5",32,0)
 I INDEX=1 S RESULT(K)="None",K=K+1
"RTN","MAGQBUT5",33,0)
 S RESULT(K)="The following Medical Center Divisions have 'Associated Institutions' defined on ",K=K+1
"RTN","MAGQBUT5",34,0)
 S RESULT(K)="your system:" D
"RTN","MAGQBUT5",35,0)
 . S INDEX="",K=K+1,L=K  F  S INDEX=$O(^MAG(2006.1,"B",INDEX)) Q:'INDEX  D
"RTN","MAGQBUT5",36,0)
 . . Q:$P($G(^MAG(2006.1,$O(^MAG(2006.1,"B",INDEX,"")),0)),U)=INDEX
"RTN","MAGQBUT5",37,0)
 . . S RESULT(K)=$P($G(^DIC(4,INDEX,0)),U)_" "_INDEX,K=K+1 Q
"RTN","MAGQBUT5",38,0)
 . Q
"RTN","MAGQBUT5",39,0)
 I K=L S RESULT(K)="None",K=K+1
"RTN","MAGQBUT5",40,0)
 S RESULT(K)="The following Medical Center Divisions have NO Imaging parameter affiliations ",K=K+1
"RTN","MAGQBUT5",41,0)
 S RESULT(K)="defined on your system:" D
"RTN","MAGQBUT5",42,0)
 . S INDEX=0,K=K+1,L=K F  S INDEX=INDEX+1 Q:'$D(OUT("DILIST","ID",INDEX))  D
"RTN","MAGQBUT5",43,0)
 . . S INST=OUT("DILIST","ID",INDEX,.07) Q:$D(^MAG(2006.1,"B",INST))  D
"RTN","MAGQBUT5",44,0)
 . . . S RESULT(K)=OUT("DILIST","ID",INDEX,.01)_" "_INST,K=K+1 Q
"RTN","MAGQBUT5",45,0)
 . . Q
"RTN","MAGQBUT5",46,0)
 . Q
"RTN","MAGQBUT5",47,0)
 I K=L S RESULT(K)="None",K=K+1
"RTN","MAGQBUT5",48,0)
 K OUT
"RTN","MAGQBUT5",49,0)
 D CLEAN^DILF
"RTN","MAGQBUT5",50,0)
 Q
"RTN","MAGQBUT5",51,0)
PLNM(PLACE) ;  Returns the Institution name of the Place
"RTN","MAGQBUT5",52,0)
 N INST
"RTN","MAGQBUT5",53,0)
 Q:'PLACE " "
"RTN","MAGQBUT5",54,0)
 S INST=$P($G(^MAG(2006.1,PLACE,0)),U)
"RTN","MAGQBUT5",55,0)
 Q $P($G(^DIC(4,INST,0)),U)
"RTN","MAGQBUT5",56,0)
TPMESS(PLACE) ;Trigger a purge message
"RTN","MAGQBUT5",57,0)
 N Y,LOC,CNT,XMSUB
"RTN","MAGQBUT5",58,0)
 S Y=$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","MAGQBUT5",59,0)
 S LOC=$$KSP^XUPARAM("WHERE")
"RTN","MAGQBUT5",60,0)
 S CNT=1,^TMP($J,"MAGQ",CNT)="SITE: "_LOC
"RTN","MAGQBUT5",61,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",CNT)="DATE: "_Y_" "_$G(^XMB("TIMEZONE"))
"RTN","MAGQBUT5",62,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",CNT)="SENDER: "_$$PLNM^MAGQBUT5(PLACE)_" Imaging Background Processor"
"RTN","MAGQBUT5",63,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",CNT)="An automatic purge event has been initiated"
"RTN","MAGQBUT5",64,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",CNT)="in order to maintain adequate image storage"
"RTN","MAGQBUT5",65,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",CNT)="no operator intervention is required."
"RTN","MAGQBUT5",66,0)
 S XMSUB="VistA Imaging BP Queue processor - Autopurge"
"RTN","MAGQBUT5",67,0)
 D MAILSHR^MAGQBUT1(PLACE,"AUTOPURGE",XMSUB)
"RTN","MAGQBUT5",68,0)
 D UDMI^MAGQBUT5("VistA Imaging BP Queue processor - Autopurge",PLACE)
"RTN","MAGQBUT5",69,0)
 Q
"RTN","MAGQBUT5",70,0)
ADDMG(SUB,XMY,PLACE) ; Provide an array of Message Recipients for Message Subject
"RTN","MAGQBUT5",71,0)
 N INDEX,IEN,GROUP,NAME,J,K,L,KEY
"RTN","MAGQBUT5",72,0)
 S SUB=$TR(SUB," ","_")
"RTN","MAGQBUT5",73,0)
 S XMY("G.MAG SERVER")=""
"RTN","MAGQBUT5",74,0)
 S INDEX="" F  S INDEX=$O(^MAG(2006.1,PLACE,6,"B",INDEX)) Q:INDEX=""  D
"RTN","MAGQBUT5",75,0)
 . Q:SUB'[INDEX
"RTN","MAGQBUT5",76,0)
 . S J=$O(^MAG(2006.1,PLACE,6,"B",INDEX,"")) ; first add Mail Groups
"RTN","MAGQBUT5",77,0)
 . S K=0 F  S K=$O(^MAG(2006.1,PLACE,6,J,1,"B",K)) Q:'K  D
"RTN","MAGQBUT5",78,0)
 . . Q:'$$GOTLOCAL^XMXAPIG(K,"")
"RTN","MAGQBUT5",79,0)
 . . S NAME="G."_$$GET1^DIQ(3.8,K,.01,"E")
"RTN","MAGQBUT5",80,0)
 . . S XMY(NAME)=""
"RTN","MAGQBUT5",81,0)
 . . Q
"RTN","MAGQBUT5",82,0)
 . I +$P($G(^MAG(2006.1,PLACE,6,J,3,0)),U,4) D  ; next add Mail Message members
"RTN","MAGQBUT5",83,0)
 . . S K=0 F  S K=$O(^MAG(2006.1,PLACE,6,J,3,"B",K)) Q:'K  D
"RTN","MAGQBUT5",84,0)
 . . . Q:'+$$ACTIVE^XUSER(K)
"RTN","MAGQBUT5",85,0)
 . . . S XMY(K)=""
"RTN","MAGQBUT5",86,0)
 . . . Q
"RTN","MAGQBUT5",87,0)
 . . Q
"RTN","MAGQBUT5",88,0)
 . I +$P($G(^MAG(2006.1,PLACE,6,J,4,0)),U,4) D  ; next add designated Security Key holders
"RTN","MAGQBUT5",89,0)
 . . S K=0 F  S K=$O(^MAG(2006.1,PLACE,6,J,4,"B",K)) Q:'K  D
"RTN","MAGQBUT5",90,0)
 . . . S KEY=$P($G(^DIC(19.1,K,0)),U,1) Q:KEY=""
"RTN","MAGQBUT5",91,0)
 . . . S L="" F  S L=$O(^XUSEC(KEY,L)) Q:'L  D
"RTN","MAGQBUT5",92,0)
 . . . . Q:'+$$ACTIVE^XUSER(L)
"RTN","MAGQBUT5",93,0)
 . . . . S XMY(L)=""
"RTN","MAGQBUT5",94,0)
 . . . . Q
"RTN","MAGQBUT5",95,0)
 . . . Q
"RTN","MAGQBUT5",96,0)
 . . Q
"RTN","MAGQBUT5",97,0)
 . Q
"RTN","MAGQBUT5",98,0)
 Q
"RTN","MAGQBUT5",99,0)
GETMI(SUB,PLACE) ; Provide the message interval assigned to this message type
"RTN","MAGQBUT5",100,0)
 N INDEX,RETURN,IEN,IENS
"RTN","MAGQBUT5",101,0)
 S RETURN=0
"RTN","MAGQBUT5",102,0)
 S SUB=$TR(SUB," ","_")
"RTN","MAGQBUT5",103,0)
 S INDEX="" F  S INDEX=$O(^MAG(2006.1,PLACE,6,"B",INDEX)) Q:INDEX=""  D
"RTN","MAGQBUT5",104,0)
 . Q:SUB'[INDEX
"RTN","MAGQBUT5",105,0)
 . S IEN=$O(^MAG(2006.1,PLACE,6,"B",INDEX,""))
"RTN","MAGQBUT5",106,0)
 . S IENS=IEN_","_PLACE_","
"RTN","MAGQBUT5",107,0)
 . S RETURN=$$GET1^DIQ(2006.166,IENS,1)_U_$$GET1^DIQ(2006.166,IENS,3,"I")
"RTN","MAGQBUT5",108,0)
 Q $S('RETURN:0,1:RETURN)
"RTN","MAGQBUT5",109,0)
 ;
"RTN","MAGQBUT5",110,0)
UDMI(SUB,PLACE) ; Update DATE OF LAST MESSAGE
"RTN","MAGQBUT5",111,0)
 N INDEX,RETURN,IEN
"RTN","MAGQBUT5",112,0)
 S RETURN=0
"RTN","MAGQBUT5",113,0)
 S SUB=$TR(SUB," ","_")
"RTN","MAGQBUT5",114,0)
 S INDEX="" F  S INDEX=$O(^MAG(2006.1,PLACE,6,"B",INDEX)) Q:INDEX=""  D  Q:RETURN
"RTN","MAGQBUT5",115,0)
 . Q:SUB'[INDEX
"RTN","MAGQBUT5",116,0)
 . S IEN=$O(^MAG(2006.1,PLACE,6,"B",INDEX,""))
"RTN","MAGQBUT5",117,0)
 . S $P(^MAG(2006.1,PLACE,6,IEN,2),U,1)=$$NOW^XLFDT
"RTN","MAGQBUT5",118,0)
 . S RETURN="1"
"RTN","MAGQBUT5",119,0)
 . Q
"RTN","MAGQBUT5",120,0)
 Q RETURN
"RTN","MAGQBUT5",121,0)
 ;
"RTN","MAGQBUT5",122,0)
RMRPC(NAME) ; Removing an RPC in order to revise
"RTN","MAGQBUT5",123,0)
 N MW,RPC,MWE,DIERR,DA,DIK
"RTN","MAGQBUT5",124,0)
 S MW=$$FIND1^DIC(19,"","X","MAG WINDOWS","","","")
"RTN","MAGQBUT5",125,0)
 D CLEAN^DILF
"RTN","MAGQBUT5",126,0)
 S RPC=$$FIND1^DIC(8994,"","X",NAME,"","","")
"RTN","MAGQBUT5",127,0)
 D CLEAN^DILF
"RTN","MAGQBUT5",128,0)
 Q:'RPC
"RTN","MAGQBUT5",129,0)
 I MW D
"RTN","MAGQBUT5",130,0)
 . S MWE=$$FIND1^DIC(19.05,","_MW_",","X",NAME,"","","")
"RTN","MAGQBUT5",131,0)
 . D CLEAN^DILF
"RTN","MAGQBUT5",132,0)
 . Q:'MWE
"RTN","MAGQBUT5",133,0)
 . S DA=MWE,DA(1)=MW,DIK="^DIC(19,"_DA(1)_",""RPC"","
"RTN","MAGQBUT5",134,0)
 . D ^DIK
"RTN","MAGQBUT5",135,0)
 . K DA,DIK
"RTN","MAGQBUT5",136,0)
 . Q
"RTN","MAGQBUT5",137,0)
 S DA=RPC,DIK="^XWB(8994,"
"RTN","MAGQBUT5",138,0)
 D ^DIK
"RTN","MAGQBUT5",139,0)
 K DA,DIK
"RTN","MAGQBUT5",140,0)
 Q
"RTN","MAGQBUT5",141,0)
MOVE(RESULT,FNAM) ;[MAGQ MOVE]
"RTN","MAGQBUT5",142,0)
 N IEN,FTYPE,NMSPC,SITEID,EXT,ALT,J,X
"RTN","MAGQBUT5",143,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT5",144,0)
 S NMSPC=$TR($P(FNAM,"."),"0123456789","")
"RTN","MAGQBUT5",145,0)
 S SITEID=$$INIS^MAGQBPG2($$PLACE^MAGBAPI(+DUZ(2)))
"RTN","MAGQBUT5",146,0)
 I SITEID'[(","_NMSPC_",") D  Q
"RTN","MAGQBUT5",147,0)
 . S RESULT="0^Invalid Imaging Namespace"
"RTN","MAGQBUT5",148,0)
 S IEN=$O(^MAG(2005,"F",$P(FNAM,"."),""))
"RTN","MAGQBUT5",149,0)
 I IEN'?1N.N!('$D(^MAG(2005,IEN,0))) D  Q
"RTN","MAGQBUT5",150,0)
 . S RESULT="0^No matching 2005 entry"
"RTN","MAGQBUT5",151,0)
 S EXT=$P(FNAM,".",2)
"RTN","MAGQBUT5",152,0)
 I $P($G(^MAG(2005,IEN,0)),U,2)[FNAM S RESULT=IEN_U_"FULL"
"RTN","MAGQBUT5",153,0)
 E  D
"RTN","MAGQBUT5",154,0)
 . S FTYPE=$$FTYPE^MAGQBPRG(EXT,IEN)
"RTN","MAGQBUT5",155,0)
 . I FTYPE="FULL" D  Q
"RTN","MAGQBUT5",156,0)
 . . D FTYPE(.ALT)
"RTN","MAGQBUT5",157,0)
 . . S J=""
"RTN","MAGQBUT5",158,0)
 . . F  S J=$O(ALT(J)) Q:J'?1N.N  S:ALT(J)[EXT FTYPE="ALT"
"RTN","MAGQBUT5",159,0)
 . . I FTYPE["ALT" S RESULT=IEN_U_FTYPE
"RTN","MAGQBUT5",160,0)
 . . E  S RESULT="0^Invalid File Extension"
"RTN","MAGQBUT5",161,0)
 . E  S RESULT=IEN_U_FTYPE
"RTN","MAGQBUT5",162,0)
 Q
"RTN","MAGQBUT5",163,0)
QRNGE(RESULT,QUEUE,PROC,START,STOP,PLACE) ;
"RTN","MAGQBUT5",164,0)
 ;[MAGQ QRNGE] Requeue/Dequeue a Range of Queues
"RTN","MAGQBUT5",165,0)
 N XX,CNT,TMP,QP,X,PART
"RTN","MAGQBUT5",166,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT5",167,0)
 S CNT=0,TMP=""
"RTN","MAGQBUT5",168,0)
 S PLACE=$P($G(^MAGQUEUE(2006.03,START,0)),U,12)
"RTN","MAGQBUT5",169,0)
 Q:'PLACE
"RTN","MAGQBUT5",170,0)
 S XX=+$O(^MAGQUEUE(2006.03,"C",PLACE,QUEUE,START),-1)
"RTN","MAGQBUT5",171,0)
 F  S XX=$O(^MAGQUEUE(2006.03,"C",PLACE,QUEUE,XX)) Q:'XX  Q:XX>(STOP)  D
"RTN","MAGQBUT5",172,0)
 . S CNT=CNT+1
"RTN","MAGQBUT5",173,0)
 . D:PROC="DEL"
"RTN","MAGQBUT5",174,0)
 . . S QP=$O(^MAGQUEUE(2006.031,"C",PLACE,QUEUE,""))
"RTN","MAGQBUT5",175,0)
 . . S PART=$S(QP:$P(^MAGQUEUE(2006.031,QP,0),U,2),1:"")
"RTN","MAGQBUT5",176,0)
 . . I XX>PART D ADD^MAGBAPI(-1,QUEUE,PLACE)
"RTN","MAGQBUT5",177,0)
 . . D DQUE^MAGQBUT2(XX)
"RTN","MAGQBUT5",178,0)
 . . Q
"RTN","MAGQBUT5",179,0)
 . D:PROC="REQ" REQUE^MAGQBTM(.TMP,XX)
"RTN","MAGQBUT5",180,0)
 . Q
"RTN","MAGQBUT5",181,0)
 S RESULT=CNT
"RTN","MAGQBUT5",182,0)
 Q
"RTN","MAGQBUT5",183,0)
UAT(RESULT,PLACE) ; to support and maintain a dummy BP workstation with unassigned workstation tasks - future RPC
"RTN","MAGQBUT5",184,0)
 ;AUTO PURGE(3), AUTO VERIFY(4), ABSTRACT(12), JUKEBOX(13), JBTOHD(14), PREFET(15), IMPORT(16), GCC(17), DELETE(20)
"RTN","MAGQBUT5",185,0)
 N WSIEN,TASKS,WS,UAT,NODE,PIECE,FIELD,ASSIGNED,I
"RTN","MAGQBUT5",186,0)
 ; Remove and re-build unassigned task entry
"RTN","MAGQBUT5",187,0)
 S I=0 F  S I=$O(^MAG(2006.8,I)) Q:'I  S NODE=$G(^MAG(2006.8,I,0)) D
"RTN","MAGQBUT5",188,0)
 . Q:$P(NODE,U)'="UAT"
"RTN","MAGQBUT5",189,0)
 . Q:$P(NODE,U,2)'=PLACE
"RTN","MAGQBUT5",190,0)
 . S DIK="^MAG(2006.8,",DA=I
"RTN","MAGQBUT5",191,0)
 . D ^DIK
"RTN","MAGQBUT5",192,0)
 . K DIK
"RTN","MAGQBUT5",193,0)
 . Q 
"RTN","MAGQBUT5",194,0)
 S RESULT="1"
"RTN","MAGQBUT5",195,0)
 D:'$D(^MAG(2006.8,"C",PLACE,"Unassigned Tasks")) CUAT(PLACE)
"RTN","MAGQBUT5",196,0)
 S UAT=$O(^MAG(2006.8,"C",PLACE,"Unassigned Tasks",""))
"RTN","MAGQBUT5",197,0)
 F FIELD=3,4,12,13,14,15,16,17,20 D
"RTN","MAGQBUT5",198,0)
 . S (ASSIGNED,WS)=""
"RTN","MAGQBUT5",199,0)
 . F  S WS=$O(^MAG(2006.8,"C",PLACE,WS)) Q:WS=""  D  Q:ASSIGNED
"RTN","MAGQBUT5",200,0)
 . . S WSIEN=$O(^MAG(2006.8,"C",PLACE,WS,""))
"RTN","MAGQBUT5",201,0)
 . . S ASSIGNED=+$$GET1^DIQ(2006.8,WSIEN_",",FIELD,"I","","")
"RTN","MAGQBUT5",202,0)
 . . Q
"RTN","MAGQBUT5",203,0)
 . I 'ASSIGNED S FDA(2006.8,UAT_",",FIELD)="1"
"RTN","MAGQBUT5",204,0)
 . Q
"RTN","MAGQBUT5",205,0)
 I $D(FDA) D FILE^DIE("","FDA","FDAIEN")
"RTN","MAGQBUT5",206,0)
 K FDA,FDAIEN
"RTN","MAGQBUT5",207,0)
 Q RESULT
"RTN","MAGQBUT5",208,0)
CUAT(PLACE) ;
"RTN","MAGQBUT5",209,0)
 N CUATFDA
"RTN","MAGQBUT5",210,0)
 S CUATFDA(10,2006.8,"+1,",.01)="UAT"
"RTN","MAGQBUT5",211,0)
 S CUATFDA(10,2006.8,"+1,",.04)=PLACE
"RTN","MAGQBUT5",212,0)
 S CUATFDA(10,2006.8,"+1,",50)="Unassigned Tasks"
"RTN","MAGQBUT5",213,0)
 D UPDATE^DIE("","CUATFDA(10)","FDAIEN")
"RTN","MAGQBUT5",214,0)
 K CUATFDA
"RTN","MAGQBUT5",215,0)
 Q
"RTN","MAGQBUT5",216,0)
FINDC(RESULT,FNUM,IENS,FLAG,FNDVALUE,XREF,SCREEN) ; [MAGQ FINDC] Find with Compound Index - uses key field lookup
"RTN","MAGQBUT5",217,0)
 ;    function Find1(FNum,IENS,Flag,FndValue,XREF,Screen:string;silent:boolean): string;
"RTN","MAGQBUT5",218,0)
 N VALUE,INDEX
"RTN","MAGQBUT5",219,0)
 F INDEX=1:1:$L(FNDVALUE,U) S VALUE(INDEX)=$P(FNDVALUE,U,INDEX)
"RTN","MAGQBUT5",220,0)
 S RESULT=$$FIND1^DIC(FNUM,IENS,FLAG,.VALUE,XREF,SCREEN,"FNDERR")
"RTN","MAGQBUT5",221,0)
 K FNDERR
"RTN","MAGQBUT5",222,0)
 Q RESULT
"RTN","MAGQBUT5",223,0)
CRG(PL,RG) ; Count RAID groups by place
"RTN","MAGQBUT5",224,0)
 N CNT,I,J,NODE,NV
"RTN","MAGQBUT5",225,0)
 S I=RG,CNT=0,NV=""
"RTN","MAGQBUT5",226,0)
 F  S I=$O(^MAG(2005.2,"B",I)) Q:I=""  Q:($E(I,1,$L(RG))'[RG)  D
"RTN","MAGQBUT5",227,0)
 . S J=$O(^MAG(2005.2,"B",I,"")) Q:'J  S NODE=$G(^MAG(2005.2,J,0)) D  Q:NV'=""
"RTN","MAGQBUT5",228,0)
 . . Q:$P(NODE,"^",10)'=PL  ; Screen on Place
"RTN","MAGQBUT5",229,0)
 . . S CNT=CNT+1
"RTN","MAGQBUT5",230,0)
 . . S:'$D(^MAG(2005.2,"B",(RG_CNT))) NV=(RG_CNT)
"RTN","MAGQBUT5",231,0)
 . . Q
"RTN","MAGQBUT5",232,0)
 . Q
"RTN","MAGQBUT5",233,0)
 S:NV="" NV=RG_(CNT+1)
"RTN","MAGQBUT5",234,0)
 Q NV
"RTN","MAGQBUT5",235,0)
ADDRG(RESULT,CNT,PLACE) ; Add Raid Groups to the Network Location file
"RTN","MAGQBUT5",236,0)
 ; [MAGQ ADD RAID GROUP]
"RTN","MAGQBUT5",237,0)
 N PL,I,VALUE,NMSP,LRG,X
"RTN","MAGQBUT5",238,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT5",239,0)
 S PL=$G(PLACE)
"RTN","MAGQBUT5",240,0)
 S:PL="" PL=$$PLACE^MAGBAPI(+$G(DUZ(2))) Q:'PL  D
"RTN","MAGQBUT5",241,0)
 . S NMSP=$P($G(^MAG(2006.1,PL,0)),U,2)
"RTN","MAGQBUT5",242,0)
 . F I=1:1:CNT  D
"RTN","MAGQBUT5",243,0)
 . . S VALUE=$$CRG(PL,"RG-"_NMSP)
"RTN","MAGQBUT5",244,0)
 . . Q:$D(^MAG(2005.2,"D",PL,VALUE))  ; Do not create duplicates
"RTN","MAGQBUT5",245,0)
 . . S MAGFDA(2005.2,"+1,",.01)=VALUE
"RTN","MAGQBUT5",246,0)
 . . S MAGFDA(2005.2,"+1,",.04)=PL ;Place
"RTN","MAGQBUT5",247,0)
 . . S MAGFDA(2005.2,"+1,",5)="0" ;READ-only
"RTN","MAGQBUT5",248,0)
 . . S MAGFDA(2005.2,"+1,",6)="GRP" ;"RAID-GROUP"
"RTN","MAGQBUT5",249,0)
 . . D UPDATE^DIE("U","MAGFDA","MAGIEN","MAGERR")
"RTN","MAGQBUT5",250,0)
 . . I $D(DIERR) W !,"Error updating the Network Location file: "_MAGERR("DIERR",1,"TEXT",1)
"RTN","MAGQBUT5",251,0)
 . . K MAGFDA,DIERR,MAGIEN,MAGFDA,MAGERR
"RTN","MAGQBUT5",252,0)
 . . Q
"RTN","MAGQBUT5",253,0)
 . Q
"RTN","MAGQBUT5",254,0)
 S RESULT="1"
"RTN","MAGQBUT5",255,0)
 Q
"RTN","MAGQBUT5",256,0)
 ;
"RTN","MAGQBUT5",257,0)
CAS ; Remove Acquisition Session file entries
"RTN","MAGQBUT5",258,0)
 ; Remove entries in 2006.041 - ACQUISITION SESSION FILE
"RTN","MAGQBUT5",259,0)
 ; Find COMPLETE import series and reduce to final outcome entry, keep for unique TrackingID ?
"RTN","MAGQBUT5",260,0)
 ; Next remove IMPORT QUEUE entry if Complete
"RTN","MAGQBUT5",261,0)
 ;Remove old queue entries from 2006.034 with no 2006.041 complement
"RTN","MAGQBUT5",262,0)
 N DA,DIK,IEN,TRKID,IMPORTQ,ZNODE,STATUS,SIEN
"RTN","MAGQBUT5",263,0)
 S IEN="A"
"RTN","MAGQBUT5",264,0)
 F  S IEN=$O(^MAG(2006.041,IEN),-1) Q:'IEN  D
"RTN","MAGQBUT5",265,0)
 . S ZNODE=$G(^MAG(2006.041,IEN,0))
"RTN","MAGQBUT5",266,0)
 . S IMPORTQ=$P(ZNODE,U,1),TRKID=$P(ZNODE,U,2),STATUS=$P(ZNODE,U,5)
"RTN","MAGQBUT5",267,0)
 . I TRKID="" S DIK="^MAG(2006.041,",DA=IEN D ^DIK K DIK,DA Q
"RTN","MAGQBUT5",268,0)
 . I $D(^MAG(2006.041,"C",TRKID)) D
"RTN","MAGQBUT5",269,0)
 . . ; skip latest entry, remove preliminary status entries
"RTN","MAGQBUT5",270,0)
 . . S SIEN="A",SIEN=$O(^MAG(2006.041,"C",TRKID,SIEN),-1)
"RTN","MAGQBUT5",271,0)
 . . I $$UPPER^MAGQE4($G(^MAG(2006.041,IEN,0)))["COMPLETE" D
"RTN","MAGQBUT5",272,0)
 . . . ; Remove IMPORT QUEUE entry if Complete
"RTN","MAGQBUT5",273,0)
 . . . I $D(^MAG(2006.034,IMPORTQ,0)) D
"RTN","MAGQBUT5",274,0)
 . . . . S DIK="^MAG(2006.034,",DA=IMPORTQ
"RTN","MAGQBUT5",275,0)
 . . . . D ^DIK K DIK,DA
"RTN","MAGQBUT5",276,0)
 . . . . ; Remove Queue Record, if it exists to eliminate dangling pointer
"RTN","MAGQBUT5",277,0)
 . . . . I $D(^MAGQUEUE(2006.03,IMPORTQ,0)) D DQUE^MAGQBUT2(IMPORTQ)
"RTN","MAGQBUT5",278,0)
 . . . . Q
"RTN","MAGQBUT5",279,0)
 . . . ; Remove log activity if Complete
"RTN","MAGQBUT5",280,0)
 . . . F  S SIEN=$O(^MAG(2006.041,"C",TRKID,SIEN),-1) Q:'SIEN  D
"RTN","MAGQBUT5",281,0)
 . . . . S DIK="^MAG(2006.041,",DA=SIEN
"RTN","MAGQBUT5",282,0)
 . . . . D ^DIK K DIK,DA
"RTN","MAGQBUT5",283,0)
 . . . . Q
"RTN","MAGQBUT5",284,0)
 . Q
"RTN","MAGQBUT5",285,0)
 ; Remove old queue entries from 2006.034 with no 2006.041 complement
"RTN","MAGQBUT5",286,0)
 S IEN="" F  S IEN=$O(^MAG(2006.034,IEN)) Q:'IEN  D:'$D(^MAG(2006.041,"B",IEN))
"RTN","MAGQBUT5",287,0)
 . S DIK="^MAG(2006.034,",DA=IEN
"RTN","MAGQBUT5",288,0)
 . D ^DIK
"RTN","MAGQBUT5",289,0)
 . K DIK,DA
"RTN","MAGQBUT5",290,0)
 . ; Remove Queue Record, if it exists to eliminate dangling pointer
"RTN","MAGQBUT5",291,0)
 . I $D(^MAGQUEUE(2006.03,IMPORTQ,0)) D DQUE^MAGQBUT2(IMPORTQ)
"RTN","MAGQBUT5",292,0)
 . Q
"RTN","MAGQBUT5",293,0)
 Q
"RTN","MAGQBUT5",294,0)
 ;
"RTN","MAGQBUT5",295,0)
FTYPE(RESULT) ;
"RTN","MAGQBUT5",296,0)
 ; RPC[MAGQ FTYPE]
"RTN","MAGQBUT5",297,0)
 N MAX,INDX,PLACE,X
"RTN","MAGQBUT5",298,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT5",299,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBUT5",300,0)
 S U="^",MAX=$P(^MAG(2006.1,PLACE,2,0),U,4),INDX=0
"RTN","MAGQBUT5",301,0)
 Q:+MAX<1
"RTN","MAGQBUT5",302,0)
 F  S INDX=$O(^MAG(2006.1,PLACE,2,INDX)) Q:INDX'?1N.N  D  Q:INDX=MAX
"RTN","MAGQBUT5",303,0)
 . S RESULT(INDX-1)=$G(^MAG(2006.1,PLACE,2,INDX,0))
"RTN","MAGQBUT5",304,0)
 . Q
"RTN","MAGQBUT5",305,0)
 Q
"RTN","MAGQBUT6")
0^22^B144843447
"RTN","MAGQBUT6",1,0)
MAGQBUT6 ;WIOFO/RMP - Utility to Consolidate Redundant Network Location file Entries ; 18 Jan 2011 5:21 PM
"RTN","MAGQBUT6",2,0)
 ;;3.0;IMAGING;**39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGQBUT6",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGQBUT6",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBUT6",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBUT6",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBUT6",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBUT6",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBUT6",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBUT6",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBUT6",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBUT6",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBUT6",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBUT6",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBUT6",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBUT6",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBUT6",17,0)
 ;;
"RTN","MAGQBUT6",18,0)
 Q
"RTN","MAGQBUT6",19,0)
CHKNAM(MAG) ; This is the input transform for the PLACE field in the Network location file.
"RTN","MAGQBUT6",20,0)
 N IEN,PLACE,VALUE
"RTN","MAGQBUT6",21,0)
 Q:'$D(MAG)
"RTN","MAGQBUT6",22,0)
 I 'DUZ(2) D  K X Q
"RTN","MAGQBUT6",23,0)
 . D EN^DDIOL("You may only edit records for the configuration to which your login is associated!")
"RTN","MAGQBUT6",24,0)
 . Q
"RTN","MAGQBUT6",25,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBUT6",26,0)
 I $D(DA),$P($G(^MAG(2005.2,DA,0)),U,10),PLACE'=$P($G(^MAG(2005.2,DA,0)),U,10) D  K X Q
"RTN","MAGQBUT6",27,0)
 . D EN^DDIOL("You may only edit records for the configuration to which your login is associated!")
"RTN","MAGQBUT6",28,0)
 . Q
"RTN","MAGQBUT6",29,0)
 S IEN="",VALUE=MAG
"RTN","MAGQBUT6",30,0)
 F  S IEN=$O(^MAG(2005.2,"B",VALUE,IEN)) Q:'IEN  D
"RTN","MAGQBUT6",31,0)
 . Q:$G(DA)=IEN
"RTN","MAGQBUT6",32,0)
 . I $P($G(^MAG(2005.2,IEN,0)),U,10)=PLACE D
"RTN","MAGQBUT6",33,0)
 . . D EN^DDIOL("Duplicate NAMES within the same VistA Imaging configuration (PLACE) is not allowed.")
"RTN","MAGQBUT6",34,0)
 . . K X
"RTN","MAGQBUT6",35,0)
 . . Q
"RTN","MAGQBUT6",36,0)
 . Q
"RTN","MAGQBUT6",37,0)
 Q
"RTN","MAGQBUT6",38,0)
CHKNET(MAG) ; This is the input transform for the share path (PHYSICAL REFERENCE  FIELD #1) in the network location file.
"RTN","MAGQBUT6",39,0)
 N UPPER,VALUE,PLACE,TABLE,IEN,TEMP,FAILED ; should convert all physical reference values to upper case
"RTN","MAGQBUT6",40,0)
 Q:'$D(MAG)
"RTN","MAGQBUT6",41,0)
 I '$G(DUZ(2)) D  K X Q
"RTN","MAGQBUT6",42,0)
 . D EN^DDIOL("You may only edit records for the configuration to which your login is associated!")
"RTN","MAGQBUT6",43,0)
 . Q
"RTN","MAGQBUT6",44,0)
 S VALUE="",PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBUT6",45,0)
 I PLACE'=$P($G(^MAG(2005.2,DA,0)),U,10),DA'["+1" D  K X Q
"RTN","MAGQBUT6",46,0)
 . D EN^DDIOL("You may only edit records for the configuration to which your login is associated!")
"RTN","MAGQBUT6",47,0)
 . Q 
"RTN","MAGQBUT6",48,0)
 S UPPER=$$UPPER^MAGQE4(MAG),FAILED=""
"RTN","MAGQBUT6",49,0)
 F  S VALUE=$O(^MAG(2005.2,"G",PLACE,VALUE)) Q:VALUE=""  D  Q:'$D(X)
"RTN","MAGQBUT6",50,0)
 . I UPPER=$$UPPER^MAGQE4(VALUE) D
"RTN","MAGQBUT6",51,0)
 . . S IEN=""
"RTN","MAGQBUT6",52,0)
 . . F  S IEN=$O(^MAG(2005.2,"G",PLACE,VALUE,IEN)) Q:'IEN  D  Q:FAILED
"RTN","MAGQBUT6",53,0)
 . . . S TEMP=$P(^MAG(2005.2,IEN,0),U,7)_U_$P(^MAG(2005.2,IEN,0),U,8)_U_$P(^MAG(2005.2,IEN,0),U,9)
"RTN","MAGQBUT6",54,0)
 . . . I $D(TABLE(TEMP)) S FAILED=1 Q
"RTN","MAGQBUT6",55,0)
 . . . S TABLE(TEMP)=""
"RTN","MAGQBUT6",56,0)
 . . . Q
"RTN","MAGQBUT6",57,0)
 . . I +FAILED D  Q
"RTN","MAGQBUT6",58,0)
 . . D EN^DDIOL("Duplicate PHYSICAL REFERENCE values within the same VistA Imaging configuration (PLACE) is not allowed.")
"RTN","MAGQBUT6",59,0)
 . . K X
"RTN","MAGQBUT6",60,0)
 . . Q
"RTN","MAGQBUT6",61,0)
 . Q
"RTN","MAGQBUT6",62,0)
 K TABLE
"RTN","MAGQBUT6",63,0)
 Q
"RTN","MAGQBUT6",64,0)
CONSHR ;  This is the interface for the Consolidate redundant shares utility
"RTN","MAGQBUT6",65,0)
 N LIST,EN,ENTRY,FLDAR,PLACE
"RTN","MAGQBUT6",66,0)
 S PLACE=$O(^MAG(2006.1,"B",$$KSP^XUPARAM("INST"),""))
"RTN","MAGQBUT6",67,0)
 D GETRL^MAGQBU6A(.LIST) ;  Get Redundant List (of shares) where the path is the same.
"RTN","MAGQBUT6",68,0)
 S EN=$O(LIST("")) I EN="" D  Q
"RTN","MAGQBUT6",69,0)
 . D PMSG("======================================================================")
"RTN","MAGQBUT6",70,0)
 . D DFNIQ^MAGQBPG1(""," Production Account: "_$$PROD^XUPROD("1"),0,PLACE,"Consolidate Shares")
"RTN","MAGQBUT6",71,0)
 . D PMSG(" Imaging patch MAG*3.0*39 found no redundant Network Location shares to consolidate.")
"RTN","MAGQBUT6",72,0)
 . D DFNIQ^MAGQBPG1("","Installation: Redundant Network Location Utility",1,PLACE,"Consolidate Shares")
"RTN","MAGQBUT6",73,0)
 . Q
"RTN","MAGQBUT6",74,0)
 D PMSG("======================================================================")
"RTN","MAGQBUT6",75,0)
 D DFNIQ^MAGQBPG1(""," Production Account: "_$$PROD^XUPROD("1"),0,PLACE,"Consolidate Shares")
"RTN","MAGQBUT6",76,0)
 D PMSG("Redundant Share List ")
"RTN","MAGQBUT6",77,0)
 D PMSG("(Share ^ Hash ^ Place) Prime IEN ^ 2nd IEN ...")
"RTN","MAGQBUT6",78,0)
 S EN="" F  S EN=$O(LIST(EN)) Q:EN=""  D PMSG("("_EN_")"_LIST(EN))
"RTN","MAGQBUT6",79,0)
 D PMSG("======================================================================")
"RTN","MAGQBUT6",80,0)
 D PMSG("")
"RTN","MAGQBUT6",81,0)
 D PMSG("Here is the list of shares that will be consolidated")
"RTN","MAGQBUT6",82,0)
 D PMSG("The share references that exist in both the 2005, 2005.1 & 2006.035 files")
"RTN","MAGQBUT6",83,0)
 D PMSG("will be reset to the PRIME share entry. ")
"RTN","MAGQBUT6",84,0)
 D DSPNL^MAGQBU6A ; Display the original Network Location file
"RTN","MAGQBUT6",85,0)
 D FAR(.FLDAR) ; Setup File/Node/Piece Table for FieldNumbers
"RTN","MAGQBUT6",86,0)
 ;The following is being performed during the post install phase.
"RTN","MAGQBUT6",87,0)
 ;D PRIME(.LIST) ; If any like shares are on - set the prime shares on
"RTN","MAGQBUT6",88,0)
 D SFRP(.LIST) ; DESTINATION field (#1) of the SEND QUEUE File (#2006.035)
"RTN","MAGQBUT6",89,0)
 ;The following is being performed during the post install phase.
"RTN","MAGQBUT6",90,0)
 ;D SPRR(.LIST) ; Site Parameter file re-reference (#.03,.07,.08,1.02,1.03,2.01,52,53,55)
"RTN","MAGQBUT6",91,0)
 S ENTRY=0 D RSREF(.LIST,ENTRY) ; Consolidate references
"RTN","MAGQBUT6",92,0)
 D RLOC^MAGQBU6A(.LIST) ; Delete Network Location file entry
"RTN","MAGQBUT6",93,0)
 D REQDUP^MAGQBU6A ; rename any duplicate .01 network location entries.
"RTN","MAGQBUT6",94,0)
 D REPNAM^MAGQBU6A ;Report residual duplicate names
"RTN","MAGQBUT6",95,0)
 D DFNIQ^MAGQBPG1("","Installation: Redundant Network Location Utility",1,PLACE,"Consolidate Shares")
"RTN","MAGQBUT6",96,0)
 K LIST
"RTN","MAGQBUT6",97,0)
 K ^TMP($J,"MAGQDFN")
"RTN","MAGQBUT6",98,0)
 Q
"RTN","MAGQBUT6",99,0)
PRIME(LIST) ; If any like shares are on - set the prime shares on
"RTN","MAGQBUT6",100,0)
 N EMSG,EN,PC,FDA,MSG,PTMP,TMP
"RTN","MAGQBUT6",101,0)
 S EN="" F  S EN=$O(LIST(EN)) Q:EN=""  D
"RTN","MAGQBUT6",102,0)
 . S PTMP=$P(^MAG(2005.2,($P(LIST(EN),U)),0),U,6) Q:PTMP  D
"RTN","MAGQBUT6",103,0)
 . . S FDA(2005.2,$P(LIST(EN),U,1)_",",5)="1"
"RTN","MAGQBUT6",104,0)
 . . D FILE^DIE("I","FDA","MSG")
"RTN","MAGQBUT6",105,0)
 . . I $D(MSG("DIERR")) D PMSG("Prime entry: '"_IEN_" failed to be set online. "_MSG("DIERR",1,"TEXT",1)) D  Q
"RTN","MAGQBUT6",106,0)
 . . . K FDA,MSG
"RTN","MAGQBUT6",107,0)
 . . . Q
"RTN","MAGQBUT6",108,0)
 . . S EMSG="Prime entry "_$P(^MAG(2005.2,$P(LIST(EN),U),0),U)_", ^MAG(2005.2,"_$P(LIST(EN),U)_",0), was set to Online."
"RTN","MAGQBUT6",109,0)
 . . D DFNIQ^MAGQBPG1("",EMSG,0,PLACE,"Consolidate Shares")
"RTN","MAGQBUT6",110,0)
 . . K FDA,MSG
"RTN","MAGQBUT6",111,0)
 . . Q
"RTN","MAGQBUT6",112,0)
 . Q
"RTN","MAGQBUT6",113,0)
 Q
"RTN","MAGQBUT6",114,0)
SPRR(LIST) ; Site Parameter file re-reference (#.03,.07,.08,1.02,1.03,2.01,52,53,55)
"RTN","MAGQBUT6",115,0)
 N EN,FDA,NEW,MSG,OLD,PC,MSG,TMP,VALUE
"RTN","MAGQBUT6",116,0)
 S EN=0 F  S EN=$O(^MAG(2006.1,EN)) Q:'EN  D
"RTN","MAGQBUT6",117,0)
 . ; fields: .03,.07,.08
"RTN","MAGQBUT6",118,0)
 . F PC=3,7,8 S (VALUE,TMP)=$P($G(^MAG(2006.1,EN,0)),U,PC) D
"RTN","MAGQBUT6",119,0)
 . . S VALUE=$$FRP(VALUE,.LIST) I VALUE D
"RTN","MAGQBUT6",120,0)
 . . . S FDA(2006.1,EN_",",FLDAR(2006.1,0,PC))=VALUE
"RTN","MAGQBUT6",121,0)
 . . . D FILE^DIE("I","FDA","MSG")
"RTN","MAGQBUT6",122,0)
 . . . I $D(MSG("DIERR")) D  Q
"RTN","MAGQBUT6",123,0)
 . . . . D PMSG("Site Parameter Filing Error for IEN: "_IEN_MSG("DIERR",1,"TEXT",1)) K FDA,MSG
"RTN","MAGQBUT6",124,0)
 . . . . Q
"RTN","MAGQBUT6",125,0)
 . . . S FLD=$P(FLDAR(2006.1,0,PC),"^"),OLD=$P(^MAG(2005.2,TMP,0),"^"),NEW=$P(^MAG(2005.2,VALUE,0),"^")
"RTN","MAGQBUT6",126,0)
 . . . D PMSG("Field #"_FLDAR(2006.1,0,PC)_" Value: "_OLD_" Changed to New Value: "_NEW)
"RTN","MAGQBUT6",127,0)
 . . . D PMSG("^MAG(2006.1,"_EN_",0)"_" Piece "_PC) K FDA,MSG
"RTN","MAGQBUT6",128,0)
 . . . Q
"RTN","MAGQBUT6",129,0)
 . . Q
"RTN","MAGQBUT6",130,0)
 . ; fields: 1.02, 1.03
"RTN","MAGQBUT6",131,0)
 . F PC=2,3 S (VALUE,TMP)=$P($G(^MAG(2006.1,EN,"PACS")),U,PC) D
"RTN","MAGQBUT6",132,0)
 . . S VALUE=$$FRP(VALUE,.LIST) I VALUE D
"RTN","MAGQBUT6",133,0)
 . . . S FDA(2006.1,EN_",",FLDAR(2006.1,"PACS",PC))=VALUE
"RTN","MAGQBUT6",134,0)
 . . . D FILE^DIE("I","FDA","MSG")
"RTN","MAGQBUT6",135,0)
 . . . I $D(MSG("DIERR")) D  Q
"RTN","MAGQBUT6",136,0)
 . . . . D PMSG("Site Parameter Filing Error for IEN: "_EN_MSG("DIERR",1,"TEXT",1)) K FDA,MSG
"RTN","MAGQBUT6",137,0)
 . . . . Q
"RTN","MAGQBUT6",138,0)
 . . . S OLD=$P(^MAG(2005.2,TMP,0),"^"),NEW=$P(^MAG(2005.2,VALUE,0),"^")
"RTN","MAGQBUT6",139,0)
 . . . D PMSG("Field #"_FLDAR(2006.1,"PACS",PC)_" Value: "_OLD_" Changed to New Value: "_NEW)
"RTN","MAGQBUT6",140,0)
 . . . D PMSG("^MAG(2006.1,"_EN_",PACS)"_" Piece "_PC) K FDA,MSG
"RTN","MAGQBUT6",141,0)
 . . . Q
"RTN","MAGQBUT6",142,0)
 . . Q
"RTN","MAGQBUT6",143,0)
 . ; field: 2.01
"RTN","MAGQBUT6",144,0)
 . S (VALUE,TMP)=$P($G(^MAG(2006.1,EN,1)),U,6) D
"RTN","MAGQBUT6",145,0)
 . . S VALUE=$$FRP(VALUE,.LIST) I VALUE D
"RTN","MAGQBUT6",146,0)
 . . . S FDA(2006.1,EN_",",FLDAR(2006.1,1,6))=VALUE
"RTN","MAGQBUT6",147,0)
 . . . D FILE^DIE("I","FDA","MSG")
"RTN","MAGQBUT6",148,0)
 . . . I $D(MSG("DIERR")) D  Q
"RTN","MAGQBUT6",149,0)
 . . . . D PMSG("Site Parameter Filing Error for IEN: "_EN_" "_MSG("DIERR",1,"TEXT",1)) K FDA,MSG
"RTN","MAGQBUT6",150,0)
 . . . . Q
"RTN","MAGQBUT6",151,0)
 . . . S OLD=$P(^MAG(2005.2,TMP,0),"^"),NEW=$P(^MAG(2005.2,VALUE,0),"^")
"RTN","MAGQBUT6",152,0)
 . . . D PMSG("Field #"_FLDAR(2006.1,1,6)_" Value: "_OLD_" Changed to New Value: "_NEW)
"RTN","MAGQBUT6",153,0)
 . . . D PMSG("^MAG(2006.1,"_EN_",1)"_" Piece "_6) K FDA,MSG
"RTN","MAGQBUT6",154,0)
 . . . Q
"RTN","MAGQBUT6",155,0)
 . . Q
"RTN","MAGQBUT6",156,0)
 . ; fields: 52,53,55
"RTN","MAGQBUT6",157,0)
 . F PC=3,4,5 S (VALUE,TMP)=$P($G(^MAG(2006.1,EN,"NET")),U,PC) D
"RTN","MAGQBUT6",158,0)
 . . S VALUE=$$FRP(VALUE,.LIST) I VALUE D
"RTN","MAGQBUT6",159,0)
 . . . S FDA(2006.1,EN_",",FLDAR(2006.1,"NET",PC))=VALUE
"RTN","MAGQBUT6",160,0)
 . . . D FILE^DIE("I","FDA","MSG")
"RTN","MAGQBUT6",161,0)
 . . . I $D(MSG("DIERR")) D  Q
"RTN","MAGQBUT6",162,0)
 . . . . D PMSG("Site Parameter Filing Error for IEN: "_EN_" "_MSG("DIERR",1,"TEXT",1)) K FDA,MSG
"RTN","MAGQBUT6",163,0)
 . . . . Q
"RTN","MAGQBUT6",164,0)
 . . . S OLD=$P(^MAG(2005.2,TMP,0),"^"),NEW=$P(^MAG(2005.2,VALUE,0),"^")
"RTN","MAGQBUT6",165,0)
 . . . D PMSG("Field #"_FLDAR(2006.1,"NET",PC)_" Value: "_OLD_" Changed to New Value: "_NEW)
"RTN","MAGQBUT6",166,0)
 . . . D PMSG("^MAG(2006.1,"_EN_",NET)"_" Piece "_PC) K FDA,MSG
"RTN","MAGQBUT6",167,0)
 . . . Q
"RTN","MAGQBUT6",168,0)
 . . Q
"RTN","MAGQBUT6",169,0)
 . Q
"RTN","MAGQBUT6",170,0)
 Q
"RTN","MAGQBUT6",171,0)
SFRP(LIST) ; DESTINATION field (#1) of the SEND QUEUE File (#2006.035).
"RTN","MAGQBUT6",172,0)
 N EN,VALUE,TMP,FDA,MSG,TEXT,TMP,OLD
"RTN","MAGQBUT6",173,0)
 S EN=0 F  S EN=$O(^MAGQUEUE(2006.035,EN)) Q:'EN  D
"RTN","MAGQBUT6",174,0)
 . I $P($P($G(^MAGQUEUE(2006.035,EN,0)),U,2),";",2)="MAG(2005.2," D
"RTN","MAGQBUT6",175,0)
 . . S (VALUE,TMP)=$P($P($G(^MAGQUEUE(2006.035,EN,0)),U,2),";",1)
"RTN","MAGQBUT6",176,0)
 . . S VALUE=$$FRP(VALUE,.LIST) I VALUE D
"RTN","MAGQBUT6",177,0)
 . . . S TMP=$P($G(^MAGQUEUE(2006.035,EN,0)),U,2),OLD=$P(TMP,";"),$P(TMP,";")=VALUE
"RTN","MAGQBUT6",178,0)
 . . . S $P(^MAGQUEUE(2006.035,EN,0),U,2)=TMP,OLD=$P(^MAG(2005.2,OLD,0),U),NEW=$P(^MAG(2005.2,VALUE,0),U)
"RTN","MAGQBUT6",179,0)
 . . . S TEXT=("DESTINATION (#1) value: "_OLD_" changed to: "_NEW)
"RTN","MAGQBUT6",180,0)
 . . . S ^XTMP("MAGP39","IMAGEFILE",2006.035,EN,1)=TEXT
"RTN","MAGQBUT6",181,0)
 . . . Q
"RTN","MAGQBUT6",182,0)
 . . Q
"RTN","MAGQBUT6",183,0)
 . Q
"RTN","MAGQBUT6",184,0)
 Q
"RTN","MAGQBUT6",185,0)
RSREF(LIST,IEN) ; Consolidate references
"RTN","MAGQBUT6",186,0)
 N GL,IEN,IENS,NODE,PIECE,FNUM,VALUE,SIEN,SPIECE,SNODE,FLD,SUB,MSG,FDA,TMP,TEXT
"RTN","MAGQBUT6",187,0)
 S GL="",IEN=$S(+$G(IEN):IEN,1:0)
"RTN","MAGQBUT6",188,0)
 F  D SCAN^MAGQBPG1(.IEN,"F",.GL) D  Q:'IEN
"RTN","MAGQBUT6",189,0)
 . Q:'IEN
"RTN","MAGQBUT6",190,0)
 . S FNUM=$S(GL[2005.1:2005.1,GL[2005:2005,1:"")
"RTN","MAGQBUT6",191,0)
 . S NODE=$G(^MAG(FNUM,IEN,0))
"RTN","MAGQBUT6",192,0)
 . F PIECE=3,4,5 S (VALUE,TMP)=$P(NODE,U,PIECE) D:VALUE
"RTN","MAGQBUT6",193,0)
 . . S VALUE=$$FRP(VALUE,.LIST) I VALUE D
"RTN","MAGQBUT6",194,0)
 . . . S FDA(FNUM,IEN_",",FLDAR(FNUM,0,PIECE))=VALUE
"RTN","MAGQBUT6",195,0)
 . . . D FILE^DIE("I","FDA","MSG")
"RTN","MAGQBUT6",196,0)
 . . . I $D(MSG("DIERR")) D  Q
"RTN","MAGQBUT6",197,0)
 . . . . D PMSG($S(FNUM=2005:"Image File",1:"Image Archive")_" Filing Error for entry: "_IEN_MSG("DIERR",1,"TEXT",1)) K FDA,MSG
"RTN","MAGQBUT6",198,0)
 . . . . Q
"RTN","MAGQBUT6",199,0)
 . . . S TEXT="FIELD #"_FLDAR(FNUM,0,PIECE)_" value: "_TMP_" changed to: "_VALUE
"RTN","MAGQBUT6",200,0)
 . . . S ^XTMP("MAGP39","IMAGEFILE",FNUM,IEN,$G(FLDAR(FNUM,0,PIECE)))=TEXT
"RTN","MAGQBUT6",201,0)
 . . . Q
"RTN","MAGQBUT6",202,0)
 . . Q
"RTN","MAGQBUT6",203,0)
 . S NODE=$G(^MAG(FNUM,IEN,"FBIG"))
"RTN","MAGQBUT6",204,0)
 . F PIECE=1,2 S VALUE=$P(NODE,U,PIECE) D:VALUE
"RTN","MAGQBUT6",205,0)
 . . S (VALUE,TMP)=$$FRP(VALUE,.LIST) I VALUE D
"RTN","MAGQBUT6",206,0)
 . . . S FDA(FNUM,IEN_",",FLDAR(FNUM,"FBIG",PIECE))=VALUE
"RTN","MAGQBUT6",207,0)
 . . . D FILE^DIE("I","FDA","MSG")
"RTN","MAGQBUT6",208,0)
 . . . I $D(MSG("DIERR")) D  Q
"RTN","MAGQBUT6",209,0)
 . . . . D PMSG($S(FNUM=2005:"Image File",1:"Image Archive")_" Filing Error for IEN: "_IEN_MSG("DIERR",1,"TEXT",1)) K FDA,MSG
"RTN","MAGQBUT6",210,0)
 . . . . Q
"RTN","MAGQBUT6",211,0)
 . . . S TEXT="FIELD #"_FLDAR(FNUM,"FBIG",PIECE)_" Value: "_TMP_" changed to: "_VALUE
"RTN","MAGQBUT6",212,0)
 . . . S ^XTMP("MAGP39","IMAGEFILE",FNUM,IEN,$G(FLDAR(FNUM,"FBIG",PIECE)))=TEXT
"RTN","MAGQBUT6",213,0)
 . . . Q
"RTN","MAGQBUT6",214,0)
 . . Q
"RTN","MAGQBUT6",215,0)
 . F SNODE=4,5,6 I $D(^MAG(FNUM,IEN,SNODE)) D  ;ROUTING TIMESTAMP, EXPORT LOCATION, ROUTING LOG
"RTN","MAGQBUT6",216,0)
 . . S SIEN=0,SPIECE=$S(SNODE=4:2,SNODE=5:1,SNODE=6:2) F  S SIEN=$O(^MAG(FNUM,IEN,SNODE,SIEN)) Q:'SIEN  D
"RTN","MAGQBUT6",217,0)
 . . . S (VALUE,TMP)=$P($G(^MAG(FNUM,IEN,SNODE,SIEN,0)),U,SPIECE)
"RTN","MAGQBUT6",218,0)
 . . . S VALUE=$$FRP(VALUE,.LIST) I VALUE D
"RTN","MAGQBUT6",219,0)
 . . . . I SNODE=4,FNUM=2005 S SUB=2005.0106
"RTN","MAGQBUT6",220,0)
 . . . . I SNODE=4,FNUM=2005.1 S SUB=2005.1106
"RTN","MAGQBUT6",221,0)
 . . . . I SNODE=5,FNUM=2005 S SUB=2005.01
"RTN","MAGQBUT6",222,0)
 . . . . I SNODE=5,FNUM=2005.1 S SUB=2005.11
"RTN","MAGQBUT6",223,0)
 . . . . I SNODE=6,FNUM=2005 S SUB=2005.0111
"RTN","MAGQBUT6",224,0)
 . . . . I SNODE=6,FNUM=2005.1 S SUB=2005.1111
"RTN","MAGQBUT6",225,0)
 . . . . S IENS=SIEN_","_IEN_","
"RTN","MAGQBUT6",226,0)
 . . . . S FDA(SUB,IENS,FLDAR(SUB,0,SPIECE))=VALUE
"RTN","MAGQBUT6",227,0)
 . . . . D FILE^DIE("I","FDA","MSG")
"RTN","MAGQBUT6",228,0)
 . . . . I $D(MSG("DIERR")) D  Q
"RTN","MAGQBUT6",229,0)
 . . . . . D PMSG($S(FNUM=2005:"Image File",1:"Image Archive")_" Filing Error for IEN: "_IEN_MSG("DIERR",1,"TEXT",1)) K FDA,MSG
"RTN","MAGQBUT6",230,0)
 . . . . . Q
"RTN","MAGQBUT6",231,0)
 . . . . S TEXT=SUB_" FIELD #"_FLDAR(SUB,0,SPIECE)_" value: "_TMP_" changed to: "_VALUE
"RTN","MAGQBUT6",232,0)
 . . . . S ^XTMP("MAGP39","IMAGEFILE",FNUM,IEN,SUB_$G(FLDAR(SUB,0,SPIECE)))=TEXT
"RTN","MAGQBUT6",233,0)
 . . . . Q
"RTN","MAGQBUT6",234,0)
 . . . Q
"RTN","MAGQBUT6",235,0)
 . . Q
"RTN","MAGQBUT6",236,0)
 . S ^XTMP("MAGP39","DUPSHARE","LAST")=IEN
"RTN","MAGQBUT6",237,0)
 . Q
"RTN","MAGQBUT6",238,0)
 Q
"RTN","MAGQBUT6",239,0)
FRP(IEN,LIST) ;Find entry number in list and return the primary
"RTN","MAGQBUT6",240,0)
 N EN,PN,PC
"RTN","MAGQBUT6",241,0)
 S EN="",PN=0 F  S EN=$O(LIST(EN)) Q:EN=""  D  Q:PN
"RTN","MAGQBUT6",242,0)
 . I (U_$P(LIST(EN),U,2,99)_U)[(U_IEN_U) S PN=$P(LIST(EN),U)
"RTN","MAGQBUT6",243,0)
 . Q
"RTN","MAGQBUT6",244,0)
 Q PN
"RTN","MAGQBUT6",245,0)
PMSG(TXT) ; Display to Screen and Build E-MAIL content
"RTN","MAGQBUT6",246,0)
 D DFNIQ^MAGQBPG1("",TXT,0,PLACE,"Consolidate Shares")
"RTN","MAGQBUT6",247,0)
 Q
"RTN","MAGQBUT6",248,0)
FAR(FLDAR) ; Setup File/Node/Piece Table for FieldNumbers
"RTN","MAGQBUT6",249,0)
 S FLDAR(2006.1,0,3)=.03
"RTN","MAGQBUT6",250,0)
 S FLDAR(2006.1,0,7)=.07
"RTN","MAGQBUT6",251,0)
 S FLDAR(2006.1,0,8)=.08
"RTN","MAGQBUT6",252,0)
 S FLDAR(2006.1,1,6)=2.01
"RTN","MAGQBUT6",253,0)
 S FLDAR(2006.1,"PACS",2)=1.02
"RTN","MAGQBUT6",254,0)
 S FLDAR(2006.1,"PACS",3)=1.03
"RTN","MAGQBUT6",255,0)
 S FLDAR(2006.1,"NET",3)=52
"RTN","MAGQBUT6",256,0)
 S FLDAR(2006.1,"NET",4)=53
"RTN","MAGQBUT6",257,0)
 S FLDAR(2006.1,"NET",5)=55
"RTN","MAGQBUT6",258,0)
 S FLDAR(2005,0,3)=2
"RTN","MAGQBUT6",259,0)
 S FLDAR(2005,0,4)=2.1
"RTN","MAGQBUT6",260,0)
 S FLDAR(2005,0,5)=2.2
"RTN","MAGQBUT6",261,0)
 S FLDAR(2005,"FBIG",1)=102
"RTN","MAGQBUT6",262,0)
 S FLDAR(2005,"FBIG",2)=103
"RTN","MAGQBUT6",263,0)
 S FLDAR(2005.1,0,3)=2
"RTN","MAGQBUT6",264,0)
 S FLDAR(2005.1,0,4)=2.1
"RTN","MAGQBUT6",265,0)
 S FLDAR(2005.1,0,5)=2.2
"RTN","MAGQBUT6",266,0)
 S FLDAR(2005.1,"FBIG",1)=102
"RTN","MAGQBUT6",267,0)
 S FLDAR(2005.1,"FBIG",2)=103
"RTN","MAGQBUT6",268,0)
 S FLDAR(2005.0106,0,2)=2
"RTN","MAGQBUT6",269,0)
 S FLDAR(2005.1106,0,2)=2
"RTN","MAGQBUT6",270,0)
 S FLDAR(2005.01,0,1)=.01
"RTN","MAGQBUT6",271,0)
 S FLDAR(2005.11,0,1)=.01
"RTN","MAGQBUT6",272,0)
 S FLDAR(2005.0111,0,2)=2
"RTN","MAGQBUT6",273,0)
 S FLDAR(2005.1111,0,2)=2
"RTN","MAGQBUT6",274,0)
 Q
"RTN","MAGQBUT6",275,0)
RTRS ;Check to see if any network locations are routers & send an email
"RTN","MAGQBUT6",276,0)
 N EN,IEN,IENS,NLIST,PRIME,RTR,SITE
"RTN","MAGQBUT6",277,0)
 D GETRL^MAGQBU6A(.NLIST) S PLACE=$O(^MAG(2006.1,"B",$$KSP^XUPARAM("INST"),""))
"RTN","MAGQBUT6",278,0)
 S EN=$O(NLIST("")) I EN="" Q  ;No duplicate network locations.
"RTN","MAGQBUT6",279,0)
 S (RTR,EN)="" F  S EN=$O(NLIST(EN)) Q:EN=""  F PC=2:1:$L(NLIST(EN),U) D
"RTN","MAGQBUT6",280,0)
 . I $P(^MAG(2005.2,+$P(NLIST(EN),U,PC),0),U,9) S RTR(EN)=$G(NLIST(EN)) Q
"RTN","MAGQBUT6",281,0)
 . Q
"RTN","MAGQBUT6",282,0)
 S EN=$O(RTR("")) I EN="" Q  ;No duplicate router network locations.
"RTN","MAGQBUT6",283,0)
 D RMSG S EN="" F  S EN=$O(RTR(EN)) Q:EN=""  D 
"RTN","MAGQBUT6",284,0)
 . S IEN=$P(RTR(EN),U),PRIME=$P(^MAG(2005.2,+IEN,0),U),SITE=$P(^MAG(2005.2,+IEN,0),U,10)
"RTN","MAGQBUT6",285,0)
 . D PMSG("Prime entry is IEN:"_IEN_" Name: "_PRIME_" "_$P(^MAG(2005.2,+IEN,0),U,2)_" SITE: "_$P(^MAG(2006.1,+SITE,0),U))
"RTN","MAGQBUT6",286,0)
 . D PMSG("  Duplicate entries that are marked for deletion: ") F PC=2:1:$L(RTR(EN),U) D
"RTN","MAGQBUT6",287,0)
 . . D PMSG("   IEN: "_+$P(RTR(EN),U,PC)_" Name: "_$P(^MAG(2005.2,+$P(RTR(EN),"^",PC),0),U))
"RTN","MAGQBUT6",288,0)
 . . Q
"RTN","MAGQBUT6",289,0)
 . Q
"RTN","MAGQBUT6",290,0)
 D:$G(PRIME)]"" DFNIQ^MAGQBPG1("","Installation: Possible Duplicate Router Shares",1,PLACE,"Consolidate Shares")
"RTN","MAGQBUT6",291,0)
 Q
"RTN","MAGQBUT6",292,0)
RMSG ;
"RTN","MAGQBUT6",293,0)
 D PMSG("The following entries may be defined as 'ROUTERS'.")
"RTN","MAGQBUT6",294,0)
 D PMSG("Review the ROUTE.DIC file on each Routing DICOM Gateway")
"RTN","MAGQBUT6",295,0)
 D PMSG("and replace any duplicate entries with prime entries.")
"RTN","MAGQBUT6",296,0)
 D PMSG("======================================================================")
"RTN","MAGQBUT6",297,0)
 Q
"RTN","MAGQCBP")
0^23^B116132863
"RTN","MAGQCBP",1,0)
MAGQCBP ;WOIFO/RP - Background Processor Queue Processor Monitor ; 18 Jan 2011 5:25 PM
"RTN","MAGQCBP",2,0)
 ;;3.0;IMAGING;**39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGQCBP",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGQCBP",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQCBP",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQCBP",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQCBP",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQCBP",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQCBP",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQCBP",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQCBP",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQCBP",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQCBP",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQCBP",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQCBP",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQCBP",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQCBP",17,0)
 ;;
"RTN","MAGQCBP",18,0)
 Q
"RTN","MAGQCBP",19,0)
 ; This Code evaluates whether the last queue processed or the queuing of the next queue is the later event
"RTN","MAGQCBP",20,0)
 ; So if and only if there is a queue waiting to be processed and that queue has been clear to be processed
"RTN","MAGQCBP",21,0)
 ; for a period of 15 minutes then and only then would a message event be triggered (See message event BPMSG)
"RTN","MAGQCBP",22,0)
CBP(MIN) ;Entry point for job to check the BP queue processing activity
"RTN","MAGQCBP",23,0)
 ; I Suggest 15 minutes as a reasonably sensitive value; value is site configurable
"RTN","MAGQCBP",24,0)
 ; An additional alert has been added for failed queues over 1K
"RTN","MAGQCBP",25,0)
 N DATA,FQLIM,LASTDT,LQP,NQ,NQP,QU,SPAN,PL,WS,WSNAME
"RTN","MAGQCBP",26,0)
 ;Variable  MAGEVAL, MAGMIN & FQLIM are site configurable when scheduling the task.
"RTN","MAGQCBP",27,0)
 S FQLIM=$S(+$G(MAGFQ)>0:MAGFQ,1:1000) ;T23 was setting to 1k if MAGFQ was less than 1k
"RTN","MAGQCBP",28,0)
 S MIN=$S(+$G(MAGMIN)>0:MAGMIN,1:+$G(MIN))
"RTN","MAGQCBP",29,0)
 S MAGEVAL=$S(+$G(MAGEVAL)>0:MAGEVAL,1:10000) ;this variable will be used for reviewing EVAL queues
"RTN","MAGQCBP",30,0)
 S U="^",PL=0
"RTN","MAGQCBP",31,0)
 F  S PL=$O(^MAG(2006.1,PL)) Q:'PL  D
"RTN","MAGQCBP",32,0)
 . S WS=0,WSNAME=""
"RTN","MAGQCBP",33,0)
 . F  S WSNAME=$O(^MAG(2006.8,"C",PL,WSNAME)) Q:WSNAME=""  D
"RTN","MAGQCBP",34,0)
 . . S WS=$O(^MAG(2006.8,"C",PL,WSNAME,"")) Q:'WS
"RTN","MAGQCBP",35,0)
 . . ; quit if this bp has not been active today - removed because we only report on active BP Servers
"RTN","MAGQCBP",36,0)
 . . ;Q:$P($P($G(^MAG(2006.8,WS,1)),U,5),"@",1)'=$P($$FMTE^XLFDT($$NOW^XLFDT),"@",1)
"RTN","MAGQCBP",37,0)
 . . S NQP=$$NQP(WS,PL,.NQ),RETURN=0
"RTN","MAGQCBP",38,0)
 . . I NQP>0 D
"RTN","MAGQCBP",39,0)
 . . . Q:WSNAME="Unassigned Tasks"
"RTN","MAGQCBP",40,0)
 . . . S LQP=$$LQP(WS,PL)
"RTN","MAGQCBP",41,0)
 . . . S SPAN=$S(LQP>NQP:LQP,1:NQP)
"RTN","MAGQCBP",42,0)
 . . . D CNT(NQ,PL,.RETURN) ; get counts for message.
"RTN","MAGQCBP",43,0)
 . . . I $$NOW^XLFDT>$$FMADD^XLFDT(SPAN,"","",MIN,"") D BPMSG(PL,WSNAME,MIN,NQ,LQP,NQP,RETURN)
"RTN","MAGQCBP",44,0)
 . . . Q
"RTN","MAGQCBP",45,0)
 . . Q
"RTN","MAGQCBP",46,0)
 . D:+PL FAILQ(PL,FQLIM)
"RTN","MAGQCBP",47,0)
 . D:+PL EVALQ(PL,MAGEVAL)
"RTN","MAGQCBP",48,0)
 . D:+PL CAUTO(PL) ; check for scheduled Purge and Verifier
"RTN","MAGQCBP",49,0)
 . D:+PL CISU(PL)  ; check for active Imaging Site Usage task 
"RTN","MAGQCBP",50,0)
 . Q
"RTN","MAGQCBP",51,0)
 K MAGEVAL,MAGMIN,MAGFQ   ;Variables passed from scheduled task
"RTN","MAGQCBP",52,0)
 Q
"RTN","MAGQCBP",53,0)
LQP(WS,PLACE) ; Returns the date and time of the Last Queue Processed by this BP Server
"RTN","MAGQCBP",54,0)
 N LDATE,QI,QP,TDATE,ZNODE,QUE,QSTR
"RTN","MAGQCBP",55,0)
 S QSTR="^^^^^^^^^^^^ABSTRACT^JUKEBOX^JBTOHD^PREFET^IMPORT^GCC^^^^^DELETE^"
"RTN","MAGQCBP",56,0)
 S ZNODE=$G(^MAG(2006.8,WS,0))
"RTN","MAGQCBP",57,0)
 S LDATE=0
"RTN","MAGQCBP",58,0)
 ;Priority:  JBTOHD, PREFET, ABSTRACT, IMPORT JUKEBOX, DELETE and GCC
"RTN","MAGQCBP",59,0)
 F QI=15,16,13,17,14,23,18 D:$P(ZNODE,U,QI)
"RTN","MAGQCBP",60,0)
 . S QUE=$P(QSTR,U,QI)
"RTN","MAGQCBP",61,0)
 . S QP=$O(^MAGQUEUE(2006.031,"C",PLACE,QUE,"")) Q:'QP
"RTN","MAGQCBP",62,0)
 . S TDATE=$P($G(^MAGQUEUE(2006.031,QP,0)),U,6)
"RTN","MAGQCBP",63,0)
 . I TDATE>LDATE S LDATE=TDATE
"RTN","MAGQCBP",64,0)
 . Q
"RTN","MAGQCBP",65,0)
 Q LDATE
"RTN","MAGQCBP",66,0)
NQP(WS,PLACE,NQ) ; Returns the date and time that the next queue to be processed by this BP Server was queued
"RTN","MAGQCBP",67,0)
 N LDATE,QCNT,QI,QP,TDATE,ZNODE,QUEIEN
"RTN","MAGQCBP",68,0)
 S QSTR="^^^^^^^^^^^^ABSTRACT^JUKEBOX^JBTOHD^PREFET^IMPORT^GCC^^^^^DELETE^"
"RTN","MAGQCBP",69,0)
 S ZNODE=$G(^MAG(2006.8,WS,0))
"RTN","MAGQCBP",70,0)
 S TDATE=0
"RTN","MAGQCBP",71,0)
 ;Priority:  JBTOHD, PREFET, ABSTRACT, IMPORT JUKEBOX, DELETE and GCC
"RTN","MAGQCBP",72,0)
 F QI=15,16,13,17,14,23,18 Q:'QI  I $P(ZNODE,U,QI) D  Q:TDATE>0
"RTN","MAGQCBP",73,0)
 . S NQ=$P(QSTR,U,QI)
"RTN","MAGQCBP",74,0)
 . S QP=$O(^MAGQUEUE(2006.031,"C",PLACE,NQ,"")) Q:'QP
"RTN","MAGQCBP",75,0)
 . Q:'+$P(^MAGQUEUE(2006.031,QP,0),U,3)  ; Queue count - no entries 
"RTN","MAGQCBP",76,0)
 . I +$P(^MAGQUEUE(2006.031,QP,0),U,3) D   ;Queue count
"RTN","MAGQCBP",77,0)
 . . S QUEIEN=$P($G(^MAGQUEUE(2006.031,QP,0)),U,2)
"RTN","MAGQCBP",78,0)
 . . S TDATE=$P($G(^MAGQUEUE(2006.03,QP,0)),U,4)
"RTN","MAGQCBP",79,0)
 . . I '+TDATE S TDATE=$$NQENTRY(NQ,PLACE)
"RTN","MAGQCBP",80,0)
 . . ;above line is needed - if queien value doesn't exist in the 2006.03
"RTN","MAGQCBP",81,0)
 . . ;then get the next entry using x-ref "D","NOT_Processed" for queue type.
"RTN","MAGQCBP",82,0)
 . Q
"RTN","MAGQCBP",83,0)
 Q TDATE
"RTN","MAGQCBP",84,0)
BPMSG(PLACE,WS,MIN,NQ,LASTDT,NQDATE,DATA) ;
"RTN","MAGQCBP",85,0)
 N MSG,TMP
"RTN","MAGQCBP",86,0)
 S MSG="VistA Imaging BP Server, "_WS_", has failed to process"
"RTN","MAGQCBP",87,0)
 D DFNIQ^MAGQBPG1("",MSG,0,PLACE,"MAGQCBP")
"RTN","MAGQCBP",88,0)
 S MSG="a "_NQ_" queue within "_MIN_" minutes."
"RTN","MAGQCBP",89,0)
 D DFNIQ^MAGQBPG1("",MSG,0,PLACE,"MAGQCBP")
"RTN","MAGQCBP",90,0)
 S MSG="The last date/time a queue was processed was on: "_$$FMTE^XLFDT(LASTDT,1)
"RTN","MAGQCBP",91,0)
 D DFNIQ^MAGQBPG1("",MSG,0,PLACE,"MAGQCBP")
"RTN","MAGQCBP",92,0)
 S MSG="The next queue to process was created on: "_$$FMTE^XLFDT(NQDATE,1)
"RTN","MAGQCBP",93,0)
 D DFNIQ^MAGQBPG1("",MSG,0,PLACE,"MAGQCBP")
"RTN","MAGQCBP",94,0)
 S MSG="Total "_NQ_" queues is: "_$P(DATA,U,2)_"."
"RTN","MAGQCBP",95,0)
 D DFNIQ^MAGQBPG1("",MSG,0,PLACE,"MAGQCBP")
"RTN","MAGQCBP",96,0)
 S TMP=$P(^DIC(4,$O(^DIC(4,"D",$P($G(^MAG(2006.1,PLACE,0)),U,1),"")),0),U,1)
"RTN","MAGQCBP",97,0)
 S MSG="This BP Queue processor was supporting the VI implementation serving: "_TMP_"."
"RTN","MAGQCBP",98,0)
 D DFNIQ^MAGQBPG1("",MSG,0,PLACE,"MAGQCBP")
"RTN","MAGQCBP",99,0)
 S MSG="VI_BP_Queue_Processor_failure"
"RTN","MAGQCBP",100,0)
 D DFNIQ^MAGQBPG1("",MSG,1,PLACE,"MAGQCBP")
"RTN","MAGQCBP",101,0)
 Q
"RTN","MAGQCBP",102,0)
BMSGF(PLACE,WS,NQ,DATA) ;
"RTN","MAGQCBP",103,0)
 N MSG,TMP
"RTN","MAGQCBP",104,0)
 ;DATA=FAILQUECNT_U_QUEUE CNT_U_TOTAL QUE TYPE
"RTN","MAGQCBP",105,0)
 S MSG="VistA Imaging BP Server "_WS_" has "_NQ_" failed queues ("_$P(DATA,U)_")."
"RTN","MAGQCBP",106,0)
 D DFNIQ^MAGQBPG1("",MSG,0,PLACE,"MAGQCBP")
"RTN","MAGQCBP",107,0)
 S MSG="Please review this BP server activity."
"RTN","MAGQCBP",108,0)
 D DFNIQ^MAGQBPG1("",MSG,0,PLACE,"MAGQCBP")
"RTN","MAGQCBP",109,0)
 S MSG="The last date/time this queue was processed was on: "_$$FMTE^XLFDT($P(DATA,U,4))_"."
"RTN","MAGQCBP",110,0)
 D DFNIQ^MAGQBPG1("",MSG,0,PLACE,"MAGQCBP")
"RTN","MAGQCBP",111,0)
 S TMP=$P(^DIC(4,$O(^DIC(4,"D",$P($G(^MAG(2006.1,PLACE,0)),U,1),"")),0),U,1)
"RTN","MAGQCBP",112,0)
 S MSG="This BP Queue processor was supporting the VI implementation serving: "_TMP
"RTN","MAGQCBP",113,0)
 D DFNIQ^MAGQBPG1("",MSG,0,PLACE,"MAGQCBP")
"RTN","MAGQCBP",114,0)
 S MSG="VI_BP_Queue_Processor_failure"
"RTN","MAGQCBP",115,0)
 D DFNIQ^MAGQBPG1("",MSG,1,PLACE,"MAGQCBP")
"RTN","MAGQCBP",116,0)
 Q
"RTN","MAGQCBP",117,0)
CAUTO(PLACE) ;
"RTN","MAGQCBP",118,0)
 N ASSIGN,BPPURGE,BPTIME,BPVER,MSG,NODE5,TMP,AUTO
"RTN","MAGQCBP",119,0)
 S BPPURGE=$G(^MAG(2006.1,PLACE,"BPPURGE")),BPTIME=0
"RTN","MAGQCBP",120,0)
 S ASSIGN=$$GTASK(PLACE,3),ASSIGN=$S(ASSIGN["is not currently assigned":0,1:1)
"RTN","MAGQCBP",121,0)
 ; ASSIGN is a flag whether the AUTO PURGE task has been assigned to a BP Server. 
"RTN","MAGQCBP",122,0)
 I +$P(BPPURGE,U,6),+ASSIGN D  ; If Scheduled is ON (#62.5) and assigned to a BP Server.
"RTN","MAGQCBP",123,0)
 . ; Add 20 min to schedule time to compensate the BP to perform MAGQ FS CHNGE.
"RTN","MAGQCBP",124,0)
 . S BPTIME=$P(BPPURGE,U,10)_"."_$P(BPPURGE,U,11) Q:'+BPTIME  S BPTIME=$$FMADD^XLFDT(BPTIME,"","",21)
"RTN","MAGQCBP",125,0)
 . Q:($$NOW^XLFDT)<BPTIME
"RTN","MAGQCBP",126,0)
 . ;DATE OF SCHEDULED PURGE (#61.3) & SCHEDULED PURGE TIME (#61.4) of SITE PARAMETERS (2006.1)
"RTN","MAGQCBP",127,0)
 . I ($$NOW^XLFDT)>BPTIME D  ;2006.1 
"RTN","MAGQCBP",128,0)
 . . Q:($P(BPPURGE,U,7)=$P(BPPURGE,U,10))    ; DATE OF LAST PURGE (#61.1) & DATE OF SCHEDULED PURGE (#61.3) of SITE PARAMETERS 2006.1 - Purge active
"RTN","MAGQCBP",129,0)
 . . S TMP=$P(^DIC(4,$O(^DIC(4,"D",$P($G(^MAG(2006.1,PLACE,0)),U,1),"")),0),U,1)
"RTN","MAGQCBP",130,0)
 . . S MSG="The "_TMP_" implementation of VistA Imaging has failed to start the schedule Purge activity!"
"RTN","MAGQCBP",131,0)
 . . D DFNIQ^MAGQBPG1("",MSG,0,PLACE,"MAGQCBP")
"RTN","MAGQCBP",132,0)
 . . S MSG="The task is currently assigned to BP Server: "_$$GTASK(PLACE,3)  ;AUTO PURGE is assigned to BP Server field #3
"RTN","MAGQCBP",133,0)
 . . D DFNIQ^MAGQBPG1("",MSG,0,PLACE,"MAGQCBP")
"RTN","MAGQCBP",134,0)
 . . S MSG="Scheduled_Purge_failure"
"RTN","MAGQCBP",135,0)
 . . D DFNIQ^MAGQBPG1("",MSG,1,PLACE,"MAGQCBP") ; Send
"RTN","MAGQCBP",136,0)
 . . Q
"RTN","MAGQCBP",137,0)
 . Q
"RTN","MAGQCBP",138,0)
 S BPVER=$G(^MAG(2006.1,PLACE,"BPVERIFIER")),BPTIME=0
"RTN","MAGQCBP",139,0)
 S ASSIGN=$$GTASK(PLACE,4),ASSIGN=$S(ASSIGN["is not currently assigned":0,1:1)
"RTN","MAGQCBP",140,0)
 I $P(BPVER,U,1),+ASSIGN D    ; If Scheduled Verifier is ON (#62) and assigned to a BP Server ;
"RTN","MAGQCBP",141,0)
 . ; DATE OF SCHEDULED VERIFY (#62.3) & SCHEDULED VERIFIER TIME (62.4) of SITE PARAMETERS 2006.1
"RTN","MAGQCBP",142,0)
 . ; Add 20 min to schedule time to compensate the BP to perform MAGQ FS CHNGE.
"RTN","MAGQCBP",143,0)
 . S BPTIME=($P(BPVER,U,4)_"."_$P(BPVER,U,5)) Q:'+BPTIME  S BPTIME=$$FMADD^XLFDT(BPTIME,"","",21)
"RTN","MAGQCBP",144,0)
 . Q:($$NOW^XLFDT)<BPTIME
"RTN","MAGQCBP",145,0)
 . I ($$NOW^XLFDT)>BPTIME D
"RTN","MAGQCBP",146,0)
 . . ;Quit if the verifier has already processed.
"RTN","MAGQCBP",147,0)
 . . Q:($P(BPVER,U,2)=$P(BPVER,U,4))  ; DATE OF LAST VERIFY (#62.1) & DATE OF SCHEDULED VERIFY (#62.3) - Verifier is active
"RTN","MAGQCBP",148,0)
 . . S TMP=$P(^DIC(4,$O(^DIC(4,"D",$P($G(^MAG(2006.1,PLACE,0)),U,1),"")),0),U,1)
"RTN","MAGQCBP",149,0)
 . . S MSG="The "_TMP_" implementation of VistA Imaging has failed to start the schedule Verifier activity!"
"RTN","MAGQCBP",150,0)
 . . D DFNIQ^MAGQBPG1("",MSG,0,PLACE,"MAGQCBP")
"RTN","MAGQCBP",151,0)
 . . S MSG="The task is currently assigned to BP Server: "_$$GTASK(PLACE,4)  ;AUTO VERIFY is assigned to BP Server field #3
"RTN","MAGQCBP",152,0)
 . . D DFNIQ^MAGQBPG1("",MSG,0,PLACE,"MAGQCBP")
"RTN","MAGQCBP",153,0)
 . . S MSG="Scheduled_Verifier_failure"
"RTN","MAGQCBP",154,0)
 . . D DFNIQ^MAGQBPG1("",MSG,1,PLACE,"MAGQCBP") ; Send
"RTN","MAGQCBP",155,0)
 . . Q
"RTN","MAGQCBP",156,0)
 . Q
"RTN","MAGQCBP",157,0)
 Q
"RTN","MAGQCBP",158,0)
GTASK(PLACE,TASK) ;
"RTN","MAGQCBP",159,0)
 ;AUTO PURGE(3), AUTO VERIFY(4), ABSTRACT(12), JUKEBOX(13), JBTOHD(14), PREFET(15), IMPORT(16), GCC(17), DELETE(20) 
"RTN","MAGQCBP",160,0)
 N MAGFLD,IEN,WS,ASSIGNED,WSIEN
"RTN","MAGQCBP",161,0)
 S ASSIGNED=0
"RTN","MAGQCBP",162,0)
 D FIELD^DID(2006.8,TASK,"","LABEL","MAGFLD")
"RTN","MAGQCBP",163,0)
 S WS="" F  S WS=$O(^MAG(2006.8,"C",PLACE,WS)) Q:WS=""  D  Q:ASSIGNED
"RTN","MAGQCBP",164,0)
 . Q:($$UPPER^MAGQE4(WS)="UNASSIGNED TASKS")
"RTN","MAGQCBP",165,0)
 . S WSIEN=$O(^MAG(2006.8,"C",PLACE,WS,""))
"RTN","MAGQCBP",166,0)
 . S ASSIGNED=+$$GET1^DIQ(2006.8,WSIEN_",",TASK,"I","","")
"RTN","MAGQCBP",167,0)
 . Q
"RTN","MAGQCBP",168,0)
 I 'ASSIGNED Q $G(MAGFLD("LABEL"))_" is not currently assigned"
"RTN","MAGQCBP",169,0)
 Q WS
"RTN","MAGQCBP",170,0)
CISU(PLACE) ;
"RTN","MAGQCBP",171,0)
 N ZTSK,ACTIVE,MESSAGE
"RTN","MAGQCBP",172,0)
 Q:'+PLACE
"RTN","MAGQCBP",173,0)
 S ACTIVE=0,MESSAGE="Unknown"
"RTN","MAGQCBP",174,0)
 S ZTSK=$$GET1^DIQ(2006.1,PLACE_",",10,"I","","")
"RTN","MAGQCBP",175,0)
 I ZTSK D
"RTN","MAGQCBP",176,0)
 . D STAT^%ZTLOAD ; IA#10063
"RTN","MAGQCBP",177,0)
 . I ZTSK(0)=1,ZTSK(1)<3 S ACTIVE=1
"RTN","MAGQCBP",178,0)
 . S MESSAGE=ZTSK(2)
"RTN","MAGQCBP",179,0)
 . I $$UPPER^MAGQE4(MESSAGE)="UNDEFINED" S MESSAGE="Task is undefined"
"RTN","MAGQCBP",180,0)
 . Q
"RTN","MAGQCBP",181,0)
 Q:+ACTIVE
"RTN","MAGQCBP",182,0)
 ;else START A NEW TASK,SEND A MESSAGE
"RTN","MAGQCBP",183,0)
 D STTASK^MAGQE4
"RTN","MAGQCBP",184,0)
 D DFNIQ^MAGQBPG1("","The inactive monthly Imaging Site Usage report task was restarted",0,PLACE,"MAGQCBP")
"RTN","MAGQCBP",185,0)
 D DFNIQ^MAGQBPG1("","The problem was: "_MESSAGE,0,PLACE,"MAGQCBP")
"RTN","MAGQCBP",186,0)
 D DFNIQ^MAGQBPG1("","Site_report_task_was_restarted",1,PLACE,"MAGQCBP") ; Send
"RTN","MAGQCBP",187,0)
 K ZTSK
"RTN","MAGQCBP",188,0)
 Q
"RTN","MAGQCBP",189,0)
CNT(QUE,PL,RET) ; Return the number of failed queues, queue pointer, queue type total count and last date processed.
"RTN","MAGQCBP",190,0)
 ; failed queues= queue count - total queue type count.
"RTN","MAGQCBP",191,0)
 ;^MAGQUEUE(2006.031,D0,0)= (#.01) QUEUE NAME [1F] ^ (#1) QUEUE POINTER
"RTN","MAGQCBP",192,0)
 ;                     ==>[2P:2006.03] ^ (#2) QUEUE COUNT [3N] ^ (#.04) PLACE
"RTN","MAGQCBP",193,0)
 ;                     ==>[4P:2006.1] ^ (#3) QUEUE TYPE TOTAL [5N] ^ (#4)
"RTN","MAGQCBP",194,0)
 ;                     ==>LAST_QUEUE_PROCESSED_DATE_TIME [6D] ^
"RTN","MAGQCBP",195,0)
 N QP,FAIL,QTOTAL,QCNT S RET=0
"RTN","MAGQCBP",196,0)
 Q:QUE=""!('PL)
"RTN","MAGQCBP",197,0)
 Q:'$D(^MAGQUEUE(2006.031,"C",PL,QUE))
"RTN","MAGQCBP",198,0)
 S QP=$O(^MAGQUEUE(2006.031,"C",PL,QUE,"")) Q:'QP!'$D(^MAGQUEUE(2006.031,QP))
"RTN","MAGQCBP",199,0)
 S QCNT=$P($G(^MAGQUEUE(2006.031,+QP,0)),U,3),QTOTAL=$P($G(^MAGQUEUE(2006.031,+QP,0)),U,5)
"RTN","MAGQCBP",200,0)
 S FAIL=(+QTOTAL)-(+QCNT),RET=FAIL_U_QCNT_U_QTOTAL_U_$P($G(^MAGQUEUE(2006.031,+QP,0)),U,6)
"RTN","MAGQCBP",201,0)
 Q
"RTN","MAGQCBP",202,0)
NQENTRY(NQ,PLACE) ;
"RTN","MAGQCBP",203,0)
 ;Get the date the queue entry was entered into 2006.03 file.
"RTN","MAGQCBP",204,0)
 N I
"RTN","MAGQCBP",205,0)
 Q:NQ=""!'PLACE
"RTN","MAGQCBP",206,0)
 S I=$O(^MAGQUEUE(2006.03,"D",PLACE,NQ,"NOT_PROCESSED",""))
"RTN","MAGQCBP",207,0)
 I +I,$D(^MAGQUEUE(2006.03,I,0)) Q $P(^MAGQUEUE(2006.03,I,0),U,4)
"RTN","MAGQCBP",208,0)
 Q 0
"RTN","MAGQCBP",209,0)
FAILQ(PLACE,FQLIM) ;
"RTN","MAGQCBP",210,0)
 N QU,RETURN,FAILQ,BPSERV
"RTN","MAGQCBP",211,0)
 F QU="JUKEBOX","ABSTRACT","IMPORT","JBTOHD","DELETE","GCC" D
"RTN","MAGQCBP",212,0)
 . D CNT(QU,PLACE,.RETURN)
"RTN","MAGQCBP",213,0)
 . S FAILQ=$S(+$P(RETURN,U)>+FQLIM:1,1:0),BPSERV="("_$$GTASK(PLACE,QU)_")"
"RTN","MAGQCBP",214,0)
 . ;send msg if failed queues are greater then specified value.
"RTN","MAGQCBP",215,0)
 . D:+FAILQ BMSGF(PLACE,BPSERV,QU,RETURN)
"RTN","MAGQCBP",216,0)
 . Q
"RTN","MAGQCBP",217,0)
EVALQ(PL,QLIM) ;
"RTN","MAGQCBP",218,0)
 N RETURN,MSG
"RTN","MAGQCBP",219,0)
 D CNT("EVAL",PL,.RETURN)
"RTN","MAGQCBP",220,0)
 S QCNT=$P(RETURN,U,2)
"RTN","MAGQCBP",221,0)
 Q:QCNT'>QLIM
"RTN","MAGQCBP",222,0)
 S MSG="The total number of EVAL queues is "_QCNT_".  Please review the DICOM Gateways"
"RTN","MAGQCBP",223,0)
 D DFNIQ^MAGQBPG1("",MSG,0,PL,"MAGQCBP")
"RTN","MAGQCBP",224,0)
 S MSG="to ensure Routing is appropriately setup with the correct destination."
"RTN","MAGQCBP",225,0)
 D DFNIQ^MAGQBPG1("",MSG,0,PL,"MAGQCBP")
"RTN","MAGQCBP",226,0)
 S MSG="If your site is not using DICOM Gateway for Routing then review "
"RTN","MAGQCBP",227,0)
 D DFNIQ^MAGQBPG1("",MSG,0,PL,"MAGQCBP")
"RTN","MAGQCBP",228,0)
 S MSG="the Imaging DICOM Gateway Installation Guide, Section 4.3."
"RTN","MAGQCBP",229,0)
 D DFNIQ^MAGQBPG1("",MSG,0,PL,"MAGQCBP"),BLNKLN
"RTN","MAGQCBP",230,0)
 S MSG="On-Demand Routing will not generate EVAL queues, if your site is doing"
"RTN","MAGQCBP",231,0)
 D DFNIQ^MAGQBPG1("",MSG,0,PL,"MAGQCBP")
"RTN","MAGQCBP",232,0)
 S MSG="only On-Demand Routing then the DICOM Gateway parameters are set incorrectly."
"RTN","MAGQCBP",233,0)
 D DFNIQ^MAGQBPG1("",MSG,0,PL,"MAGQCBP"),BLNKLN
"RTN","MAGQCBP",234,0)
 S MSG="Check the following DICOM parameters on all your Gateways:"
"RTN","MAGQCBP",235,0)
 D DFNIQ^MAGQBPG1("",MSG,0,PL,"MAGQCBP")
"RTN","MAGQCBP",236,0)
 S MSG="(On-Demand routing does not require these parameters to be set.)"
"RTN","MAGQCBP",237,0)
 D DFNIQ^MAGQBPG1("",MSG,0,PL,"MAGQCBP"),BLNKLN
"RTN","MAGQCBP",238,0)
 S MSG="Will this computer be a Routing Processor? // NO "
"RTN","MAGQCBP",239,0)
 D DFNIQ^MAGQBPG1("",MSG,0,PL,"MAGQCBP")
"RTN","MAGQCBP",240,0)
 S MSG="Will this computer be part of a system where 'autorouting' is active? // NO "
"RTN","MAGQCBP",241,0)
 D DFNIQ^MAGQBPG1("",MSG,0,PL,"MAGQCBP")
"RTN","MAGQCBP",242,0)
 S MSG="VI_BP_Eval_Queue"
"RTN","MAGQCBP",243,0)
 D DFNIQ^MAGQBPG1("",MSG,1,PL,"MAGQCBP")
"RTN","MAGQCBP",244,0)
 Q
"RTN","MAGQCBP",245,0)
BLNKLN ;
"RTN","MAGQCBP",246,0)
 S MSG="               "
"RTN","MAGQCBP",247,0)
 D DFNIQ^MAGQBPG1("",MSG,0,PL,"MAGQCBP")
"RTN","MAGQCBP",248,0)
 Q
"RTN","MAGQE1")
0^24^B12851574
"RTN","MAGQE1",1,0)
MAGQE1 ;WOIFO/RMP - Support for MAG Enterprise ; 02/18/2005  09:19
"RTN","MAGQE1",2,0)
 ;;3.0;IMAGING;**27,29,30,20,39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGQE1",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGQE1",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQE1",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQE1",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQE1",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQE1",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQE1",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQE1",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQE1",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQE1",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQE1",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQE1",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQE1",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQE1",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQE1",17,0)
 ;;
"RTN","MAGQE1",18,0)
 Q
"RTN","MAGQE1",19,0)
 ;
"RTN","MAGQE1",20,0)
SDATE(FDAY,ORDER) ; Find first image before/after specified date
"RTN","MAGQE1",21,0)
 ; EdM: In a future patch, this function must be replaced by a cross-reference.
"RTN","MAGQE1",22,0)
 N I1,I2
"RTN","MAGQE1",23,0)
 I $G(ORDER)'="R" Q 0
"RTN","MAGQE1",24,0)
 S I1=$O(^MAG(2005," "),-1)+1 S I2=$O(^MAG(2005.1," "),-1)+1
"RTN","MAGQE1",25,0)
 Q $S(I1>I2:I1,1:I2)
"RTN","MAGQE1",26,0)
 ;
"RTN","MAGQE1",27,0)
BPV(PLACE) ;
"RTN","MAGQE1",28,0)
 N BPWS,D0,NODE,INDEX,WS,RD
"RTN","MAGQE1",29,0)
 K BPWS
"RTN","MAGQE1",30,0)
 S RD=$$FMADD^XLFDT($$NOW^XLFDT,-180,"","","")
"RTN","MAGQE1",31,0)
 S WS="" F  S WS=$O(^MAG(2006.8,"C",PLACE,WS)) Q:WS=""  D
"RTN","MAGQE1",32,0)
 . S D0=$O(^MAG(2006.8,"C",PLACE,WS,""))
"RTN","MAGQE1",33,0)
 . Q:$P($G(^MAG(2006.8,D0,0)),"^",12)'="1"
"RTN","MAGQE1",34,0)
 . S NODE=$G(^MAG(2006.8,D0,1))
"RTN","MAGQE1",35,0)
 . Q:(+$P(NODE,U,5))<RD  ;  last execution date is greater than 6 months or null
"RTN","MAGQE1",36,0)
 . D:$P(NODE,"^",2)>0
"RTN","MAGQE1",37,0)
 . . S INDEX=$P(NODE,"^",2)_"^"_$P(NODE,"^",4)
"RTN","MAGQE1",38,0)
 . . S BPWS(INDEX)=$G(BPWS(INDEX))+1
"RTN","MAGQE1",39,0)
 . . S $P(BPWS(INDEX),"^",2)=$P(NODE,"^",3)
"RTN","MAGQE1",40,0)
 . . Q
"RTN","MAGQE1",41,0)
 . Q
"RTN","MAGQE1",42,0)
 D:$D(BPWS) LLOAD^MAGQE5(.BPWS,"BP VERS NUM DATE: ")
"RTN","MAGQE1",43,0)
 Q
"RTN","MAGQE1",44,0)
 ;
"RTN","MAGQE1",45,0)
IWSV(PLACE) ; Image workstation versions
"RTN","MAGQE1",46,0)
 N D0,IDX,OS,RD,WSC,WSD,WSV,X
"RTN","MAGQE1",47,0)
 S RD=$$FMADD^XLFDT($$NOW^XLFDT,-180,"","","")
"RTN","MAGQE1",48,0)
 S D0=0 F  S D0=$O(^MAG(2006.81,"C",PLACE,D0)) Q:'D0  D
"RTN","MAGQE1",49,0)
 . S X=^MAG(2006.81,D0,0) Q:$P(X,"^",3)<RD
"RTN","MAGQE1",50,0)
 . S OS=$P($G(^MAG(2006.81,D0,1)),"^",2)
"RTN","MAGQE1",51,0)
 . S:OS?.N OS=$P($G(^MAG(2006.81,D0,1)),"^",3)
"RTN","MAGQE1",52,0)
 . S IDX=$P(X,"^",9) D:IDX'=""  ; Display Station
"RTN","MAGQE1",53,0)
 . . S:OS'="" IDX=IDX_"^"_OS S WSD(IDX)=$G(WSD(IDX))+1
"RTN","MAGQE1",54,0)
 . . Q
"RTN","MAGQE1",55,0)
 . S IDX=$P(X,"^",13) D:IDX'=""  ; Capture Station
"RTN","MAGQE1",56,0)
 . . S:OS'="" IDX=IDX_"^"_OS S WSC(IDX)=$G(WSC(IDX))+1
"RTN","MAGQE1",57,0)
 . . Q
"RTN","MAGQE1",58,0)
 . S IDX=$P(X,"^",15) D:IDX'=""  ; VistARad Station
"RTN","MAGQE1",59,0)
 . . S:OS'="" IDX=IDX_"^"_OS S WSV(IDX)=$G(WSV(IDX))+1
"RTN","MAGQE1",60,0)
 . . Q
"RTN","MAGQE1",61,0)
 . Q
"RTN","MAGQE1",62,0)
 D LLOAD^MAGQE5(.WSD," WS DIS VERS: ")
"RTN","MAGQE1",63,0)
 D LLOAD^MAGQE5(.WSC," WS CAP VERS: ")
"RTN","MAGQE1",64,0)
 D LLOAD^MAGQE5(.WSV," WS VR VERS: ")
"RTN","MAGQE1",65,0)
 Q
"RTN","MAGQE1",66,0)
 ;
"RTN","MAGQE1",67,0)
DICOMV() ; Version of DICOM
"RTN","MAGQE1",68,0)
 N D0,DCMG,RD,T,VER,X
"RTN","MAGQE1",69,0)
 S RD=$$FMADD^XLFDT($$NOW^XLFDT,-30,"","","")
"RTN","MAGQE1",70,0)
 S X="" F  S X=$O(^MAG(2006.83,"B",X)) Q:X=""  D
"RTN","MAGQE1",71,0)
 . S D0=$O(^MAG(2006.83,"B",X,"")) Q:'D0
"RTN","MAGQE1",72,0)
 . S T=$G(^MAG(2006.83,D0,0)) Q:$P(T,"^",2)<RD
"RTN","MAGQE1",73,0)
 . S VER=$P(T,"^",3) S:VER="" VER="?"
"RTN","MAGQE1",74,0)
 . S DCMG(VER)=$G(DCMG(VER))+1
"RTN","MAGQE1",75,0)
 . Q
"RTN","MAGQE1",76,0)
 D:$D(DCMG) LLOAD^MAGQE5(.DCMG,"DICOM Gateway Version: ")
"RTN","MAGQE1",77,0)
 Q
"RTN","MAGQE1",78,0)
 ;
"RTN","MAGQE1",79,0)
VSTAV() ;
"RTN","MAGQE1",80,0)
 N VER
"RTN","MAGQE1",81,0)
 S VER=$$VERSION^XPDUTL("IMAGING")
"RTN","MAGQE1",82,0)
 S:$T(LAST^XPDUTL)'="" VER=VER_"^"_$$LAST^XPDUTL("IMAGING",VER)
"RTN","MAGQE1",83,0)
 Q VER
"RTN","MAGQE1",84,0)
 ;
"RTN","MAGQE1",85,0)
SNS(PLACE) ;
"RTN","MAGQE1",86,0)
 N D1,RESULT
"RTN","MAGQE1",87,0)
 S RESULT=$P(^MAG(2006.1,PLACE,0),"^",2)
"RTN","MAGQE1",88,0)
 S D1=0 F  S D1=$O(^MAG(2006.1,PLACE,4,D1)) Q:'D1  D
"RTN","MAGQE1",89,0)
 . S RESULT=RESULT_"^"_$P($G(^MAG(2006.1,PLACE,4,D1,0)),"^",1)
"RTN","MAGQE1",90,0)
 . Q
"RTN","MAGQE1",91,0)
 Q RESULT
"RTN","MAGQE1",92,0)
 ;
"RTN","MAGQE2")
0^25^B15983460
"RTN","MAGQE2",1,0)
MAGQE2 ;WOIFO/RMP - Support for MAG Enterprise ; 08/22/2003  13:44
"RTN","MAGQE2",2,0)
 ;;3.0;IMAGING;**27,29,20,39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGQE2",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGQE2",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQE2",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQE2",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQE2",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQE2",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQE2",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQE2",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQE2",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQE2",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQE2",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQE2",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQE2",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQE2",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQE2",17,0)
 ;;
"RTN","MAGQE2",18,0)
 Q
"RTN","MAGQE2",19,0)
 ;
"RTN","MAGQE2",20,0)
AHISU(START,STOP) ;
"RTN","MAGQE2",21,0)
 N ADHOC
"RTN","MAGQE2",22,0)
 S ADHOC=1
"RTN","MAGQE2",23,0)
 ;
"RTN","MAGQE2",24,0)
ISU ;IMAGING SITE USAGE - SERVER
"RTN","MAGQE2",25,0)
 N INST,LOC,PLACE,TMP
"RTN","MAGQE2",26,0)
 I $$CONSOLID^MAGQE5() D
"RTN","MAGQE2",27,0)
 . S INST="" F  S INST=$O(^MAG(2006.1,"B",INST)) Q:INST=""  D
"RTN","MAGQE2",28,0)
 . . S PLACE=$O(^MAG(2006.1,"B",INST,"")) Q:'PLACE
"RTN","MAGQE2",29,0)
 . . Q:($P($G(^MAG(2006.1,PLACE,0)),U)'=INST)  ;Screen Associated Institutions
"RTN","MAGQE2",30,0)
 . . D ISU1(PLACE,INST)
"RTN","MAGQE2",31,0)
 . . Q
"RTN","MAGQE2",32,0)
 . Q
"RTN","MAGQE2",33,0)
 E  D ISU1($O(^MAG(2006.1," "),-1),$$KSP^XUPARAM("INST"))
"RTN","MAGQE2",34,0)
 D:'$G(ADHOC) TASK^MAGQE4
"RTN","MAGQE2",35,0)
 K ^TMP($J,"MAGQ")
"RTN","MAGQE2",36,0)
 Q
"RTN","MAGQE2",37,0)
 ;
"RTN","MAGQE2",38,0)
ISU1(PLACE,INST) ;
"RTN","MAGQE2",39,0)
 I '$G(ADHOC) D TASK Q  ; We are already in a TaskMan task...
"RTN","MAGQE2",40,0)
 ;
"RTN","MAGQE2",41,0)
 S ZTDTH=$$NOW^XLFDT()
"RTN","MAGQE2",42,0)
 S ZTRTN="TASK^"_$T(+0)
"RTN","MAGQE2",43,0)
 S ZTDESC="Ad-Hoc Imaging Usage Report ("_$$FMTE^XLFDT(START\1)_" - "_$$FMTE^XLFDT(STOP\1)_")"
"RTN","MAGQE2",44,0)
 S ZTIO=""
"RTN","MAGQE2",45,0)
 S ZTSAVE("START")=START
"RTN","MAGQE2",46,0)
 S ZTSAVE("STOP")=STOP
"RTN","MAGQE2",47,0)
 S ZTSAVE("PLACE")=PLACE
"RTN","MAGQE2",48,0)
 S ZTSAVE("INST")=INST
"RTN","MAGQE2",49,0)
 S:$G(ADHOC) ZTSAVE("ADHOC")=1
"RTN","MAGQE2",50,0)
 S:$D(MAGDUZ) ZTSAVE("MAGDUZ")=MAGDUZ
"RTN","MAGQE2",51,0)
 D ^%ZTLOAD
"RTN","MAGQE2",52,0)
 K ZTDTH,ZTRTN,ZTDESC,ZTIO,ZTSAVE
"RTN","MAGQE2",53,0)
 Q
"RTN","MAGQE2",54,0)
 ;
"RTN","MAGQE2",55,0)
MSG(TXT) N I
"RTN","MAGQE2",56,0)
 S I=$O(^TMP($J,"MAGQ",PLACE,"SITE_REPORT"," "),-1)+1
"RTN","MAGQE2",57,0)
 S ^TMP($J,"MAGQ",PLACE,"SITE_REPORT",I)=TXT
"RTN","MAGQE2",58,0)
 Q
"RTN","MAGQE2",59,0)
 ;
"RTN","MAGQE2",60,0)
TASK N DM,I,LOC,OCONS,PCNT,REC,VR,XMSUB,Y,X
"RTN","MAGQE2",61,0)
 S:'$D(INST) INST=$$KSP^XUPARAM("INST")
"RTN","MAGQE2",62,0)
 K ^TMP($J,"MAGQ")
"RTN","MAGQE2",63,0)
 I '$G(START)!'$G(STOP) D
"RTN","MAGQE2",64,0)
 . S STOP=$$FMADD^XLFDT($$NOW^XLFDT()\100_"01",-1)
"RTN","MAGQE2",65,0)
 . S START=STOP\100_"01"
"RTN","MAGQE2",66,0)
 . Q
"RTN","MAGQE2",67,0)
 S Y=$$NOW^XLFDT,Y=$$FMTE^XLFDT(Y)
"RTN","MAGQE2",68,0)
 S U="^",LOC=$$GET1^DIQ(4,INST,.01)_"^"_INST
"RTN","MAGQE2",69,0)
 D MSG("            SITE: "_LOC)
"RTN","MAGQE2",70,0)
 D MSG("Reporting Period: "_$$FMTE^XLFDT(START\1)_" - "_$$FMTE^XLFDT(STOP\1))
"RTN","MAGQE2",71,0)
 D MSG("            DATE: "_Y_" "_$G(^XMB("TIMEZONE")))
"RTN","MAGQE2",72,0)
 D MSG("          DOMAIN: "_$$KSP^XUPARAM("WHERE"))
"RTN","MAGQE2",73,0)
 D MSG("    2005 ENTRIES: "_$P($G(^MAG(2005,0)),"^",4))
"RTN","MAGQE2",74,0)
 D MSG(" 2006.81 ENTRIES: "_$$WSP^MAGQE5(PLACE))
"RTN","MAGQE2",75,0)
 D MSG(" Production Account: "_$$PROD^XUPROD("1"))
"RTN","MAGQE2",76,0)
 ; Distribute an array each of the capture and display versions
"RTN","MAGQE2",77,0)
 D IWSV^MAGQE1(PLACE)
"RTN","MAGQE2",78,0)
 ; VistaRad version
"RTN","MAGQE2",79,0)
 S VR=$$VERSION^XPDUTL("MAGJ RADIOLOGY") D:VR'="" MSG("VistaRad Version: "_VR)
"RTN","MAGQE2",80,0)
 I $D(^MAGD(2006.599,0)) D MSG("DICOM Error Log:"_+$P(^MAGD(2006.599,0),"^",4))
"RTN","MAGQE2",81,0)
 I $D(^MAGD(2006.575,0)) D MSG("DICOM FAILED IMAGES:"_+$P(^MAGD(2006.575,0),"^",4))
"RTN","MAGQE2",82,0)
 ; Queue File count & Unprocessed Queue entries
"RTN","MAGQE2",83,0)
 D MSG("Queue File count: "_$$QCNT^MAGQE5(.PCNT,PLACE))
"RTN","MAGQE2",84,0)
 D MSG("Unprocessed Queue entries: "_PCNT)
"RTN","MAGQE2",85,0)
 D ISU2^MAGQE5
"RTN","MAGQE2",86,0)
 S X=""
"RTN","MAGQE2",87,0)
 S:'$G(ADHOC) X=" ("_$P("Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec"," ",START\100#100)_" "_(START\10000+1700)_")"
"RTN","MAGQE2",88,0)
 S XMSUB=$S($G(ADHOC):"Ad Hoc",1:"Monthly")_" Image Site Usage: "_LOC_X
"RTN","MAGQE2",89,0)
 D MAILSHR^MAGQBUT1(PLACE,"SITE_REPORT",XMSUB)
"RTN","MAGQE2",90,0)
 Q
"RTN","MAGQE2",91,0)
 ;
"RTN","MAGQE5")
0^26^B56083407
"RTN","MAGQE5",1,0)
MAGQE5 ;WOIFO/RMP - Support for MAG Enterprise ; 08/29/2006 09:48
"RTN","MAGQE5",2,0)
 ;;3.0;IMAGING;**27,29,8,30,20,46,39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGQE5",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGQE5",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQE5",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQE5",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQE5",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQE5",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQE5",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQE5",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQE5",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQE5",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQE5",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQE5",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQE5",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQE5",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQE5",17,0)
 ;;
"RTN","MAGQE5",18,0)
 Q
"RTN","MAGQE5",19,0)
ISU2 ;
"RTN","MAGQE5",20,0)
 ; Workstation Session and Patient counts
"RTN","MAGQE5",21,0)
 N CCNT,D0,DATE,ICNT,M1,M2,PCNT,RES,SCNAD,SCNMN,SCNT,TD,TD1,UNSCN,VD,VI,X1,X2,YR,AI,DUP,IQ,TIOP,TGPP,TIEDP
"RTN","MAGQE5",22,0)
 N GRPPRNT,IMAGE,DELETED
"RTN","MAGQE5",23,0)
 S (SCNT,PCNT,ICNT,CCNT,DUP,TIOP,TGPP,TIEDP,GRPPRNT,IMAGE,DELETED)=0
"RTN","MAGQE5",24,0)
 S (VD,VI)=""
"RTN","MAGQE5",25,0)
 I '$$CONSOLID() D
"RTN","MAGQE5",26,0)
 . S DATE="L"_START
"RTN","MAGQE5",27,0)
 . F  S DATE=$O(^MAG(2006.82,"AC",DATE)) Q:DATE=""  Q:$P(DATE,"L",2)\1>STOP  D
"RTN","MAGQE5",28,0)
 . . S D0=0 F  S D0=$O(^MAG(2006.82,"AC",DATE,D0)) Q:'D0  D
"RTN","MAGQE5",29,0)
 . . . Q:'$D(^MAG(2006.82,D0,1))
"RTN","MAGQE5",30,0)
 . . . S SCNT=SCNT+1
"RTN","MAGQE5",31,0)
 . . . S PCNT=PCNT+$P($G(^MAG(2006.82,D0,1)),"^",1)
"RTN","MAGQE5",32,0)
 . . . D ACT^MAGQE3(D0,.ICNT,.CCNT,.VD,.VI,.RES)
"RTN","MAGQE5",33,0)
 . . . Q
"RTN","MAGQE5",34,0)
 . . Q
"RTN","MAGQE5",35,0)
 . Q
"RTN","MAGQE5",36,0)
 E  D
"RTN","MAGQE5",37,0)
 . S DATE=START
"RTN","MAGQE5",38,0)
 . F  S DATE=$O(^MAG(2006.82,"APL",PLACE,DATE)) Q:DATE=""  Q:DATE\1>STOP  D
"RTN","MAGQE5",39,0)
 . . S D0=0 F  S D0=$O(^MAG(2006.82,"APL",PLACE,DATE,D0)) Q:D0'?1.N  D
"RTN","MAGQE5",40,0)
 . . . Q:'$D(^MAG(2006.82,D0,1))
"RTN","MAGQE5",41,0)
 . . . S SCNT=SCNT+1
"RTN","MAGQE5",42,0)
 . . . S PCNT=PCNT+$P($G(^MAG(2006.82,D0,1)),"^",1)
"RTN","MAGQE5",43,0)
 . . . D ACT^MAGQE3(D0,.ICNT,.CCNT,.VD,.VI,.RES)
"RTN","MAGQE5",44,0)
 . . . Q
"RTN","MAGQE5",45,0)
 . . Q
"RTN","MAGQE5",46,0)
 . Q
"RTN","MAGQE5",47,0)
 S X1=START,X2=STOP D ^%DTC S X=$TR(X,"-")+1_" day "
"RTN","MAGQE5",48,0)
 D MSG^MAGQE2(X_"Image Workstation Sessions: "_SCNT)
"RTN","MAGQE5",49,0)
 D MSG^MAGQE2(X_"Image Workstation Patients: "_PCNT)
"RTN","MAGQE5",50,0)
 D MSG^MAGQE2(X_"Image Workstation Images: "_ICNT)
"RTN","MAGQE5",51,0)
 D MSG^MAGQE2(X_"Image Workstation Captures: "_CCNT)
"RTN","MAGQE5",52,0)
 D MSG^MAGQE2(X_"VistaRad WS Display: "_VD)
"RTN","MAGQE5",53,0)
 D MSG^MAGQE2(X_"VistaRad WS Interpretations: "_VI)
"RTN","MAGQE5",54,0)
 K VD,VI
"RTN","MAGQE5",55,0)
 I $T(AVERAGE^MAGBRTLD)'="" D
"RTN","MAGQE5",56,0)
 . D MSG^MAGQE2(X_"average daily routed images: "_$$AVERAGE^MAGBRTLD())
"RTN","MAGQE5",57,0)
 . Q
"RTN","MAGQE5",58,0)
 D BPV^MAGQE1(PLACE)
"RTN","MAGQE5",59,0)
 D MSG^MAGQE2("Vista Image Version/Build: "_$$VSTAV^MAGQE1())
"RTN","MAGQE5",60,0)
 D DICOMV^MAGQE1()
"RTN","MAGQE5",61,0)
 D MSG^MAGQE2("Image file namespace(s): "_$$SNS^MAGQE1(PLACE))
"RTN","MAGQE5",62,0)
 S I="" F  S I=$O(RES(I)) Q:I=""  D
"RTN","MAGQE5",63,0)
 . S RES="" F  S RES=$O(RES(I,RES)) Q:RES=""  D
"RTN","MAGQE5",64,0)
 . . S X=$TR(I,"^")_"^"_RES S $P(X,"^",6)=RES(I,RES)
"RTN","MAGQE5",65,0)
 . . D MSG^MAGQE2(" RESOLUTION: "_X)
"RTN","MAGQE5",66,0)
 . . Q
"RTN","MAGQE5",67,0)
 . Q
"RTN","MAGQE5",68,0)
 K RES
"RTN","MAGQE5",69,0)
 ;
"RTN","MAGQE5",70,0)
 S AI=$$GETAI(PLACE)
"RTN","MAGQE5",71,0)
 D COUNT^MAGQE3(START,STOP,INST,AI,.IQ,.DUP,.TIOP,.TGPP,.TIEDP,.GRPPRNT,.IMAGE,.DELETED)
"RTN","MAGQE5",72,0)
 D MSG^MAGQE2("Total Image Objects for Place: "_TIOP)
"RTN","MAGQE5",73,0)
 D MSG^MAGQE2("Total Group Parents for Place: "_TGPP)
"RTN","MAGQE5",74,0)
 D MSG^MAGQE2("Total Image Entry Deletes for Place: "_TIEDP)
"RTN","MAGQE5",75,0)
 D MSG^MAGQE2("Image file group parents: "_GRPPRNT)
"RTN","MAGQE5",76,0)
 D MSG^MAGQE2("Image file objects: "_IMAGE)
"RTN","MAGQE5",77,0)
 D MSG^MAGQE2("Image file deletes: "_DELETED)
"RTN","MAGQE5",78,0)
 ;
"RTN","MAGQE5",79,0)
 S (I,D0)=0 F  S D0=$O(^TMP($J,"MAGQ","ACQPAT",D0)) Q:D0=""  S I=I+1
"RTN","MAGQE5",80,0)
 D MSG^MAGQE2("Unique Image patients captured: "_I)
"RTN","MAGQE5",81,0)
 K ^TMP($J,"MAGQ","ACQPAT")
"RTN","MAGQE5",82,0)
 S (I,D0)=0 F  S D0=$O(^TMP($J,"MAGQ","DISPAT",D0)) Q:D0=""  S I=I+1
"RTN","MAGQE5",83,0)
 D MSG^MAGQE2("Unique Image patients display: "_I)
"RTN","MAGQE5",84,0)
 K ^TMP($J,"MAGQ","DISPAT")
"RTN","MAGQE5",85,0)
 S (I,D0)=0 F  S D0=$O(^TMP($J,"MAGQ","ALLPAT",D0)) Q:D0=""  S I=I+1
"RTN","MAGQE5",86,0)
 D MSG^MAGQE2("Unique Image patients All: "_I)
"RTN","MAGQE5",87,0)
 K ^TMP($J,"MAGQ","ALLPAT")
"RTN","MAGQE5",88,0)
 D MSG^MAGQE2("Total Non-Verified Images for Place: "_$P(IQ,U,1))
"RTN","MAGQE5",89,0)
 D MSG^MAGQE2("Total Verified Images for Place: "_$P(IQ,U,2))
"RTN","MAGQE5",90,0)
 D MSG^MAGQE2("Total Integrity Issues for Place: "_$P(IQ,U,3))
"RTN","MAGQE5",91,0)
 D MSG^MAGQE2("Total Duplicate Images for Place: "_DUP)
"RTN","MAGQE5",92,0)
 D START^MAGQE6(START,STOP,INST,"TLR")
"RTN","MAGQE5",93,0)
 D ADCNT^MAGQE3(START,STOP,INST,AI)
"RTN","MAGQE5",94,0)
 D GPACHX^MAGQE3()
"RTN","MAGQE5",95,0)
 D GS1^MAGQE5() ;Get Share data
"RTN","MAGQE5",96,0)
 D AI1^MAGQE5() ;Get Associated Institutions
"RTN","MAGQE5",97,0)
 D GATH^MAGQE6(START,STOP,INST)    ;Gather remote va/dod views
"RTN","MAGQE5",98,0)
 Q
"RTN","MAGQE5",99,0)
 ;
"RTN","MAGQE5",100,0)
AHOPT ;
"RTN","MAGQE5",101,0)
 N %DT,START,STOP,X,Y
"RTN","MAGQE5",102,0)
 S STOP=$$FMADD^XLFDT($$NOW^XLFDT()\100_"01",-1)
"RTN","MAGQE5",103,0)
 S START=STOP\100_"01"
"RTN","MAGQE5",104,0)
 S Y=START D DD^%DT S %DT("B")=Y
"RTN","MAGQE5",105,0)
 S %DT="AEXP",%DT("A")="Enter starting Date: "
"RTN","MAGQE5",106,0)
 D ^%DT I ((X="")!(X="^")!($D(DTOUT))) K %DT(0),DTOUT Q
"RTN","MAGQE5",107,0)
 S START=Y
"RTN","MAGQE5",108,0)
 S Y=STOP D DD^%DT S %DT("B")=Y
"RTN","MAGQE5",109,0)
 S %DT="AEXP",%DT("A")="Enter ending Date: "
"RTN","MAGQE5",110,0)
 D ^%DT I ((X="")!(X="^")!($D(DTOUT))) K %DT(0),DTOUT Q
"RTN","MAGQE5",111,0)
 S STOP=Y
"RTN","MAGQE5",112,0)
 W !!,"Creating ad-hoc report over the period "
"RTN","MAGQE5",113,0)
 W $$DT(START)," until ",$$DT(STOP),".",!
"RTN","MAGQE5",114,0)
 D AHISU^MAGQE2(START,STOP)
"RTN","MAGQE5",115,0)
 Q
"RTN","MAGQE5",116,0)
 ;
"RTN","MAGQE5",117,0)
DT(X) ;
"RTN","MAGQE5",118,0)
 Q (X\1#100)_"-"_$P("Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec"," ",X\100#100)_"-"_(X\10000+1700)
"RTN","MAGQE5",119,0)
 ;
"RTN","MAGQE5",120,0)
LLOAD(AR,LBL) ;
"RTN","MAGQE5",121,0)
 N I
"RTN","MAGQE5",122,0)
 S I="" F  S I=$O(AR(I)) Q:I=""  D MSG^MAGQE2(" "_LBL_" "_I_"^"_AR(I))
"RTN","MAGQE5",123,0)
 Q
"RTN","MAGQE5",124,0)
 ;
"RTN","MAGQE5",125,0)
GETPLACE(PLACE) ; Validate place
"RTN","MAGQE5",126,0)
 S PLACE=$S($$CONSOLID():$G(PLACE),1:+$O(^MAG(2006.1," "),-1)) Q:'PLACE 0
"RTN","MAGQE5",127,0)
 S:$P($G(^MAG(2006.1,PLACE,0)),"^",1)="" PLACE=0
"RTN","MAGQE5",128,0)
 Q PLACE
"RTN","MAGQE5",129,0)
 ;
"RTN","MAGQE5",130,0)
CONSOLID() ;
"RTN","MAGQE5",131,0)
 ; Return value: 0 = site not consolidated,
"RTN","MAGQE5",132,0)
 ;               1 = site is consolidated
"RTN","MAGQE5",133,0)
 N FLDNFO
"RTN","MAGQE5",134,0)
 D FIELD^DID(2006.1,.01,"","SPECIFIER","FLDNFO")
"RTN","MAGQE5",135,0)
 I $G(FLDNFO("SPECIFIER"))["P" Q 1
"RTN","MAGQE5",136,0)
 Q 0
"RTN","MAGQE5",137,0)
 ;
"RTN","MAGQE5",138,0)
PLACE(INST) ;
"RTN","MAGQE5",139,0)
 Q:'$$CONSOLID() +$O(^MAG(2006.1," "),-1)
"RTN","MAGQE5",140,0)
 Q $$GETPLACE(+$O(^MAG(2006.1,"B",INST,"")))
"RTN","MAGQE5",141,0)
 ;
"RTN","MAGQE5",142,0)
QCNT(READY,PLACE) ;
"RTN","MAGQE5",143,0)
 N D0,FAILED,NEXT,TYPE
"RTN","MAGQE5",144,0)
 S (READY,FAILED)=0
"RTN","MAGQE5",145,0)
 I $$CONSOLID() D
"RTN","MAGQE5",146,0)
 . S TYPE="" F  S TYPE=$O(^MAGQUEUE(2006.031,"C",PLACE,TYPE)) Q:TYPE=""  D
"RTN","MAGQE5",147,0)
 . . S NEXT=+$O(^MAGQUEUE(2006.031,"C",PLACE,TYPE,""))
"RTN","MAGQE5",148,0)
 . . S NEXT=+$P($G(^MAGQUEUE(2006.031,NEXT,0)),"^",2)
"RTN","MAGQE5",149,0)
 . . S D0=0 F  S D0=$O(^MAGQUEUE(2006.03,"C",PLACE,TYPE,D0)) Q:'D0  D
"RTN","MAGQE5",150,0)
 . . . I D0<NEXT S FAILED=FAILED+1
"RTN","MAGQE5",151,0)
 . . . E  S READY=READY+1
"RTN","MAGQE5",152,0)
 . . . Q
"RTN","MAGQE5",153,0)
 . . Q
"RTN","MAGQE5",154,0)
 E  D
"RTN","MAGQE5",155,0)
 . S TYPE="" F  S TYPE=$O(^MAGQUEUE(2006.031,"B",TYPE)) Q:TYPE=""  D
"RTN","MAGQE5",156,0)
 . . S NEXT=+$O(^MAGQUEUE(2006.031,"B",TYPE,""))
"RTN","MAGQE5",157,0)
 . . S NEXT=+$P($G(^MAGQUEUE(2006.031,NEXT,0)),"^",2)
"RTN","MAGQE5",158,0)
 . . S D0=0 F  S D0=$O(^MAGQUEUE(2006.03,"B",TYPE,D0)) Q:'D0  D
"RTN","MAGQE5",159,0)
 . . . I D0<NEXT S FAILED=FAILED+1
"RTN","MAGQE5",160,0)
 . . . E  S READY=READY+1
"RTN","MAGQE5",161,0)
 . . . Q
"RTN","MAGQE5",162,0)
 . . Q
"RTN","MAGQE5",163,0)
 . Q
"RTN","MAGQE5",164,0)
 Q READY+FAILED
"RTN","MAGQE5",165,0)
 ;
"RTN","MAGQE5",166,0)
WSP(PLACE) ; Imaging workstations per place
"RTN","MAGQE5",167,0)
 N COUNT,D0,RD
"RTN","MAGQE5",168,0)
 S RD=$$FMADD^XLFDT($$NOW^XLFDT,-180,"","","")
"RTN","MAGQE5",169,0)
 S (D0,COUNT)=0 F  S D0=$O(^MAG(2006.81,"C",PLACE,D0)) Q:'D0  D
"RTN","MAGQE5",170,0)
 . S:$P(^MAG(2006.81,D0,0),"^",3)'<RD COUNT=COUNT+1
"RTN","MAGQE5",171,0)
 . Q
"RTN","MAGQE5",172,0)
 Q COUNT
"RTN","MAGQE5",173,0)
 ;
"RTN","MAGQE5",174,0)
MAGDUZ2() Q $G(DUZ(2),$$KSP^XUPARAM("INST"))
"RTN","MAGQE5",175,0)
 ;
"RTN","MAGQE5",176,0)
GS1() ; Get local Network location share data
"RTN","MAGQE5",177,0)
 N I,L,M,MSG,RESULT,TAR
"RTN","MAGQE5",178,0)
 S RESULT(0)="NETWORK LOCATION^PHYSICAL REFERENCE^TOTAL SPACE^FREE SPACE^OPERATIONAL STATUS^READ ONLY^STORAGE TYPE^HASH^ROUTER"
"RTN","MAGQE5",179,0)
 D LIST^DIC(2005.2,"","@;.01;1;2;4;5;5.5;6;7;26","","","","","","I $P(^(0),U,10)=PLACE","","TAR","MSG")
"RTN","MAGQE5",180,0)
 Q:$D(MSG("DIERR"))
"RTN","MAGQE5",181,0)
 S L=0 F  S L=$O(TAR("DILIST","ID",L)) Q:'L  D
"RTN","MAGQE5",182,0)
 . S RESULT(L)=$P(TAR("DILIST","ID",L,.01),U,1)
"RTN","MAGQE5",183,0)
 . F M=1,2,4,5,5.5,6,7,26 S RESULT(L)=RESULT(L)_U_$P(TAR("DILIST","ID",L,M),U,1)
"RTN","MAGQE5",184,0)
 . Q
"RTN","MAGQE5",185,0)
 S I="" F  S I=$O(RESULT(I)) Q:I=""  D
"RTN","MAGQE5",186,0)
 . D MSG^MAGQE2("LOCAL NETWORK LOCATIONS: "_I_"^"_RESULT(I))
"RTN","MAGQE5",187,0)
 . Q
"RTN","MAGQE5",188,0)
 K TAR,MSG,RESULT
"RTN","MAGQE5",189,0)
 Q
"RTN","MAGQE5",190,0)
AI1() ; get Associated Institutions list per place
"RTN","MAGQE5",191,0)
 N I,L,M,MSG,RESULT,TAR
"RTN","MAGQE5",192,0)
 S RESULT(0)="Associated Institutions"
"RTN","MAGQE5",193,0)
 D LIST^DIC(2006.12,","_PLACE_",","@;.01","","","","","","","","TAR","MSG")
"RTN","MAGQE5",194,0)
 Q:$D(MSG("DIERR"))
"RTN","MAGQE5",195,0)
 S L=0 F  S L=$O(TAR("DILIST","ID",L)) Q:'L  D
"RTN","MAGQE5",196,0)
 . S RESULT(L)=$P(TAR("DILIST","ID",L,.01),U,1)
"RTN","MAGQE5",197,0)
 . Q
"RTN","MAGQE5",198,0)
 S I="" F  S I=$O(RESULT(I)) Q:I=""  D
"RTN","MAGQE5",199,0)
 . D MSG^MAGQE2("ASSOCIATED INSTITUTIONS: "_I_"^"_RESULT(I))
"RTN","MAGQE5",200,0)
 . Q
"RTN","MAGQE5",201,0)
 K TAR,MSG,RESULT
"RTN","MAGQE5",202,0)
 Q
"RTN","MAGQE5",203,0)
GETAI(PLACE,PARAM) ;
"RTN","MAGQE5",204,0)
 N I,J
"RTN","MAGQE5",205,0)
 S PARAM=$S('$D(PARAM):U,PARAM="":U,1:PARAM)
"RTN","MAGQE5",206,0)
 S I="",J=PARAM
"RTN","MAGQE5",207,0)
 F  S I=$O(^MAG(2006.1,PLACE,"INSTS","B",I)) Q:I=""  S J=J_I_PARAM
"RTN","MAGQE5",208,0)
 Q J
"RTN","MAGQE5",209,0)
 ;
"RTN","MAGQE6")
0^27^B16298001
"RTN","MAGQE6",1,0)
MAGQE6 ;WOIFO/OHH - Counts for Remote Image Views ; 01 Jul 2010 4:49 PM
"RTN","MAGQE6",2,0)
 ;;3.0;IMAGING;**46,39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGQE6",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGQE6",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQE6",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQE6",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQE6",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQE6",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQE6",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQE6",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQE6",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQE6",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQE6",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQE6",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQE6",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQE6",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQE6",17,0)
 ;;
"RTN","MAGQE6",18,0)
 Q
"RTN","MAGQE6",19,0)
 ; This routine collects information related to telereader read/unread
"RTN","MAGQE6",20,0)
 ; list activities and passes it to MAG-Enterprise, so that it will
"RTN","MAGQE6",21,0)
 ; appear in the monthly reports.
"RTN","MAGQE6",22,0)
 ;
"RTN","MAGQE6",23,0)
START(SDATE,EDATE,INST,NMS) ;
"RTN","MAGQE6",24,0)
 N AA,AI,COUNT,DIVISION,I,IMAGES,M0,OM,WHERE
"RTN","MAGQE6",25,0)
 ;
"RTN","MAGQE6",26,0)
 F AA=0,1 F I=1:1:6 S COUNT(AA,I)=0
"RTN","MAGQE6",27,0)
 S DIVISION=INST_$$GETAI^MAGQE5($$PLACE^MAGBAPI(INST),"^")
"RTN","MAGQE6",28,0)
 F I=1:1 S AI=$P(DIVISION,"^",I) Q:'AI  D:$D(^MAG(2006.5849,"E",AI))
"RTN","MAGQE6",29,0)
 . S AA=$O(^MAG(2006.5849,"E",AI,SDATE),-1)
"RTN","MAGQE6",30,0)
 . F  S AA=$O(^MAG(2006.5849,"E",AI,AA)) Q:'AA  Q:AA>EDATE  D
"RTN","MAGQE6",31,0)
 . . S OM="" F  S OM=$O(^MAG(2006.5849,"E",AI,AA,OM)) Q:'OM  D
"RTN","MAGQE6",32,0)
 . . . S M0=^MAG(2006.5849,OM,0) Q:$P(M0,"^",11)'="R"
"RTN","MAGQE6",33,0)
 . . . S WHERE=$P(M0,"^",16)=$P(M0,"^",2)
"RTN","MAGQE6",34,0)
 . . . S COUNT(WHERE,1)=COUNT(WHERE,1)+1
"RTN","MAGQE6",35,0)
 . . . S COUNT(WHERE,2)=COUNT(WHERE,2)+$P(M0,"^",10)
"RTN","MAGQE6",36,0)
 . . . I $P(M0,"^",18)>0,$P(M0,"^",17)>0 S COUNT(WHERE,3)=COUNT(WHERE,3)+$$FMDIFF^XLFDT($P(M0,"^",18),$P(M0,"^",17),2)
"RTN","MAGQE6",37,0)
 . . . I $P(M0,"^",18)>0,$P(M0,"^",17)>0 S COUNT(WHERE,4)=COUNT(WHERE,4)+1
"RTN","MAGQE6",38,0)
 . . . S:$P(M0,"^",17)="" COUNT(WHERE,6)=COUNT(WHERE,6)+1
"RTN","MAGQE6",39,0)
 . . . I $P(M0,"^",9)>0,$P(M0,"^",7)>0 S COUNT(WHERE,5)=COUNT(WHERE,5)+$$FMDIFF^XLFDT($P(M0,"^",9),$P(M0,"^",7),2)
"RTN","MAGQE6",40,0)
 . . . Q
"RTN","MAGQE6",41,0)
 . . Q
"RTN","MAGQE6",42,0)
 . Q
"RTN","MAGQE6",43,0)
 ;
"RTN","MAGQE6",44,0)
 ; Output collected data:
"RTN","MAGQE6",45,0)
 D:COUNT(1,1)+COUNT(0,1)
"RTN","MAGQE6",46,0)
 . I NMS'="",$E(NMS,$L(NMS))'=" " S NMS=NMS_" "
"RTN","MAGQE6",47,0)
 . D MSG^MAGQE2(NMS_"SPECIALITY: 57")
"RTN","MAGQE6",48,0)
 . D MSG^MAGQE2(NMS_"PROCEDURE: 88")
"RTN","MAGQE6",49,0)
 . D MSG^MAGQE2(NMS_"LOCAL STUDIES: "_COUNT(1,1))
"RTN","MAGQE6",50,0)
 . D MSG^MAGQE2(NMS_"REMOTE STUDIES: "_COUNT(0,1))
"RTN","MAGQE6",51,0)
 . D MSG^MAGQE2(NMS_"LOCAL IMAGES: "_COUNT(1,2))
"RTN","MAGQE6",52,0)
 . D MSG^MAGQE2(NMS_"REMOTE IMAGES: "_COUNT(0,2))
"RTN","MAGQE6",53,0)
 . D MSG^MAGQE2(NMS_"LOCAL READING TIME: "_COUNT(1,3))
"RTN","MAGQE6",54,0)
 . D MSG^MAGQE2(NMS_"REMOTE READING TIME: "_COUNT(0,3))
"RTN","MAGQE6",55,0)
 . D MSG^MAGQE2(NMS_"RESULTED LOCALLY BY TELEREADER: "_COUNT(1,4))
"RTN","MAGQE6",56,0)
 . D MSG^MAGQE2(NMS_"RESULTED LOCALLY BY CPRS: "_COUNT(1,6))
"RTN","MAGQE6",57,0)
 . D MSG^MAGQE2(NMS_"RESULTED REMOTELY BY TELEREADER: "_COUNT(0,4))
"RTN","MAGQE6",58,0)
 . D MSG^MAGQE2(NMS_"RESULTED REMOTELY BY CPRS: "_COUNT(0,6))
"RTN","MAGQE6",59,0)
 . D MSG^MAGQE2(NMS_"LOCAL ACQUISITION TIME:  "_COUNT(1,5))
"RTN","MAGQE6",60,0)
 . D MSG^MAGQE2(NMS_"REMOTE ACQUISITION TIME:  "_COUNT(0,5))
"RTN","MAGQE6",61,0)
 . Q
"RTN","MAGQE6",62,0)
 Q 
"RTN","MAGQE6",63,0)
 ;
"RTN","MAGQE6",64,0)
GATH(START,STOP,INST) ;Will count the number of entries for remote views
"RTN","MAGQE6",65,0)
 ;from DOD to VA and VA to DOD
"RTN","MAGQE6",66,0)
 ;INST=STATION NUMBER 
"RTN","MAGQE6",67,0)
 N AI,ENTRIES,ENTRY,CNT,J,JJ,RMTYPE,SITE
"RTN","MAGQE6",68,0)
 Q:'$G(INST)
"RTN","MAGQE6",69,0)
 K ^TMP($J,"MAG_ACC")
"RTN","MAGQE6",70,0)
 I '$G(START)!'$G(STOP) D
"RTN","MAGQE6",71,0)
 . S STOP=$$FMADD^XLFDT($$NOW^XLFDT()\100_"01",-1)
"RTN","MAGQE6",72,0)
 . S START=STOP\100_"01"
"RTN","MAGQE6",73,0)
 Q:'STOP
"RTN","MAGQE6",74,0)
 Q:'START
"RTN","MAGQE6",75,0)
 S SITE=$O(^MAG(2006.1,"B",INST,0))
"RTN","MAGQE6",76,0)
 S I=START F  S I=$O(^MAG(2006.95,"C",SITE,I)) Q:'I!(I>STOP)  S ENTRY=0 D
"RTN","MAGQE6",77,0)
 . F  S ENTRY=$O(^MAG(2006.95,"C",SITE,I,ENTRY)) Q:'ENTRY  D 
"RTN","MAGQE6",78,0)
 . . I $D(^MAG(2006.95,ENTRY,0)) S RMTYPE=$P(^MAG(2006.95,ENTRY,0),"^",2)
"RTN","MAGQE6",79,0)
 . . I RMTYPE]"" D
"RTN","MAGQE6",80,0)
 . . . I '$D(^TMP($J,"MAG_ACC",RMTYPE)) S ^TMP($J,"MAG_ACC",RMTYPE)=0
"RTN","MAGQE6",81,0)
 . . . S $P(^TMP($J,"MAG_ACC",RMTYPE),"^")=$P(^TMP($J,"MAG_ACC",RMTYPE),"^")+1
"RTN","MAGQE6",82,0)
 . . . Q
"RTN","MAGQE6",83,0)
 . . Q
"RTN","MAGQE6",84,0)
 . Q
"RTN","MAGQE6",85,0)
 S J="" F  S J=$O(^TMP($J,"MAG_ACC",J)) Q:J=""   D MSG^MAGQE2("ACCESS TYPE("_J_"): "_$G(^TMP($J,"MAG_ACC",J)))
"RTN","MAGQE6",86,0)
 K ^TMP($J,"MAG_ACC")
"RTN","MAGQE6",87,0)
 Q
"RTN","MAGQE7")
0^28^B48785755
"RTN","MAGQE7",1,0)
MAGQE7 ;WOIFO/LB - Imaging Utilities to support Monthly Report ; 18 Jan 2011 5:31 PM
"RTN","MAGQE7",2,0)
 ;;3.0;IMAGING;**39**;Mar 19, 2002;Build 2010;Mar 08, 2011
"RTN","MAGQE7",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGQE7",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQE7",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQE7",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQE7",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQE7",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQE7",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQE7",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQE7",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQE7",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQE7",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQE7",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQE7",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQE7",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQE7",17,0)
 ;;
"RTN","MAGQE7",18,0)
 Q
"RTN","MAGQE7",19,0)
ACXREF(IEN,LAST) ;
"RTN","MAGQE7",20,0)
 ;This will set the "C" and "AC" cross reference on field #6, "ACCESS DATE/TIME",
"RTN","MAGQE7",21,0)
 ;for all the entries in the file. I $D(^MAG(2006.95,"MAGP39")),$P(^MAG(2006.95,"MAGP39"),"^",2)]"" Q
"RTN","MAGQE7",22,0)
 ; Don't re-index on further patch 39 rebuilds.
"RTN","MAGQE7",23,0)
 K ^MAG(2006.95,"AC") D INDEX(IEN,LAST)
"RTN","MAGQE7",24,0)
 Q
"RTN","MAGQE7",25,0)
INDEX(IEN,LAST) ;
"RTN","MAGQE7",26,0)
 N CNT,END,I,IMAGE,J,LAST,NODE,NOTSET,SITE,START,TCNT,USER,PLACE
"RTN","MAGQE7",27,0)
 S START=$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","MAGQE7",28,0)
 D SETXTMP
"RTN","MAGQE7",29,0)
 S:'$D(PLACE) PLACE=$O(^MAG(2006.1,"B",$$KSP^XUPARAM("INST"),"")),U="^"
"RTN","MAGQE7",30,0)
 ; PLACE will be used as default
"RTN","MAGQE7",31,0)
 S (CNT,TCNT,NOTSET)=0  ;Counter to count the number of entries set and not set.
"RTN","MAGQE7",32,0)
 ;Will only re-index up to the last entry
"RTN","MAGQE7",33,0)
 S LAST=$S('$G(LAST):$O(^MAG(2006.95," "),-1),1:LAST)
"RTN","MAGQE7",34,0)
 S IEN=$S('$G(IEN):0,1:IEN)
"RTN","MAGQE7",35,0)
 S I=IEN
"RTN","MAGQE7",36,0)
 F  S I=$O(^MAG(2006.95,I)) Q:'I!(I>LAST)  D
"RTN","MAGQE7",37,0)
 . S J=$P($G(^MAG(2006.95,I,0)),U,7) Q:J'?7N1".".N
"RTN","MAGQE7",38,0)
 . S NODE=$G(^MAG(2006.95,I,0)),CNT=CNT+1
"RTN","MAGQE7",39,0)
 . S IMAGE=$P(NODE,"^",4),USER=$P(NODE,"^",3),SITE=""
"RTN","MAGQE7",40,0)
 . ;
"RTN","MAGQE7",41,0)
 . S ^MAG(2006.95,"AC",$E(J,1,30),I)=""  ; Regular cross reference on date.
"RTN","MAGQE7",42,0)
 . ;
"RTN","MAGQE7",43,0)
 . I IMAGE D
"RTN","MAGQE7",44,0)
 . . ;Get acquisition site
"RTN","MAGQE7",45,0)
 . . I $D(^MAG(2005,IMAGE,0)),$D(^MAG(2005,IMAGE,100)) S SITE=$P(^(100),"^",3)
"RTN","MAGQE7",46,0)
 . . E  I $D(^MAG(2005.1,IMAGE,0)),$D(^MAG(2005.1,IMAGE,100)) S SITE=$P(^(100),"^",3)
"RTN","MAGQE7",47,0)
 . . Q 
"RTN","MAGQE7",48,0)
 . I 'SITE D
"RTN","MAGQE7",49,0)
 . . ; no acquisition site - use the user's division.
"RTN","MAGQE7",50,0)
 . . S SITE=$$FINDSITE(USER)
"RTN","MAGQE7",51,0)
 . I 'SITE D BUILD Q:'SITE
"RTN","MAGQE7",52,0)
 . ;This is a new field for p39 - back filing
"RTN","MAGQE7",53,0)
 . S $P(^MAG(2006.95,I,0),"^",11)=SITE
"RTN","MAGQE7",54,0)
 . ;Now MagEnterprise needs the value from PLACE^MAGBAPI. 
"RTN","MAGQE7",55,0)
 . S SITE=$S('$D(^MAG(2006.1,"B",SITE)):PLACE,1:$$PLACE^MAGBAPI(SITE))
"RTN","MAGQE7",56,0)
 . S ^MAG(2006.95,"C",SITE,$E(J,1,30),I)="",TCNT=TCNT+1
"RTN","MAGQE7",57,0)
 . S ^XTMP("MAGQE7","LASTXREF")=I_"^"_LAST  ; Store the last entry processed.
"RTN","MAGQE7",58,0)
 . Q 
"RTN","MAGQE7",59,0)
 S END=$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","MAGQE7",60,0)
 S $P(^MAG(2006.95,"MAGP39"),"^",2)=END ;To prevent re-indexing in future t builds.
"RTN","MAGQE7",61,0)
 ;
"RTN","MAGQE7",62,0)
 D DFNIQ^MAGQBPG1("","The starting time for patch 39 post-install XREF process: "_START,0,PLACE,"Consolidate Shares")
"RTN","MAGQE7",63,0)
 D DFNIQ^MAGQBPG1("","# entries processed: "_CNT_" Cross reference set on "_TCNT_" Items unresolved: "_NOTSET,0,PLACE,"Consolidate Shares")
"RTN","MAGQE7",64,0)
 D DFNIQ^MAGQBPG1("","The ending time for patch 39 post-install XREF process: "_END,0,PLACE,"Consolidate Shares")
"RTN","MAGQE7",65,0)
 D DFNIQ^MAGQBPG1("","Installation: Patch 39 - xref post install completed",1,PLACE,"Consolidate Shares")
"RTN","MAGQE7",66,0)
 ;
"RTN","MAGQE7",67,0)
 Q
"RTN","MAGQE7",68,0)
FINDSITE(USER) ;Get the user's site - covered by IA 10060
"RTN","MAGQE7",69,0)
 ;File 2006.95 stores the user involved in the event - find out the actual division for this person.
"RTN","MAGQE7",70,0)
 ;FSITE - first site found in the DIVISION multiple in file 200.
"RTN","MAGQE7",71,0)
 N I,FSITE,MAGSITE,MAGARR,MSG,SITE
"RTN","MAGQE7",72,0)
 S MAGSITE=""    ;FSITE=first entry in the Division field.
"RTN","MAGQE7",73,0)
 Q:'USER
"RTN","MAGQE7",74,0)
 D GETS^DIQ(200,USER_",","16*","I","MAGARR","MSG")
"RTN","MAGQE7",75,0)
 Q:$D(MSG("DIERR"))
"RTN","MAGQE7",76,0)
 S (FSITE,I)="" F  S I=$O(MAGARR(200.02,I)) Q:I=""!MAGSITE  D
"RTN","MAGQE7",77,0)
 . S SITE=$G(MAGARR(200.02,I,.01,"I")) I 'FSITE S FSITE=SITE
"RTN","MAGQE7",78,0)
 . ;Default division and a match in Imaging
"RTN","MAGQE7",79,0)
 . I $G(MAGARR(200.02,I,1,"I")),$D(^MAG(2006.1,"B",SITE)) S MAGSITE=SITE
"RTN","MAGQE7",80,0)
 . E  I $D(^MAG(2006.1,"B",SITE)) S MAGSITE=SITE
"RTN","MAGQE7",81,0)
 . Q
"RTN","MAGQE7",82,0)
 ; If not an image site then get the first entry in the Division field or default to site institution.
"RTN","MAGQE7",83,0)
 I 'MAGSITE S MAGSITE=PLACE
"RTN","MAGQE7",84,0)
 Q MAGSITE
"RTN","MAGQE7",85,0)
 ;
"RTN","MAGQE7",86,0)
BUILD ;if sent here there was no acquisition site or user's division is not set
"RTN","MAGQE7",87,0)
 ;Purge date should be 30 days
"RTN","MAGQE7",88,0)
 S ^XTMP("MAGQE7","NOTSET",I)=IMAGE_"^"_USER
"RTN","MAGQE7",89,0)
 S NOTSET=NOTSET+1
"RTN","MAGQE7",90,0)
 Q
"RTN","MAGQE7",91,0)
PRINT ;Utility to print the exceptions in setting the AC cross reference in file 2006.95.
"RTN","MAGQE7",92,0)
 ;
"RTN","MAGQE7",93,0)
 N ZTSK
"RTN","MAGQE7",94,0)
 I '$D(^XTMP("MAGQE7","NOTSET")) W !,"Sorry, the XTMP global has been cleared, nothing to display. Quitting" Q
"RTN","MAGQE7",95,0)
 W !,"Exception list for entries in 2006.95 where an AC cross reference could not be set."
"RTN","MAGQE7",96,0)
 N POP,ZTDESC,ZTRTN,ZTSK
"RTN","MAGQE7",97,0)
 S %ZIS="QMP" D ^%ZIS K %ZIS I POP Q
"RTN","MAGQE7",98,0)
 I '$D(IO("Q")) U IO D STARTPRT Q
"RTN","MAGQE7",99,0)
 ; task job
"RTN","MAGQE7",100,0)
 S ZTRTN="STARTPRT^MAGQE7",ZTDESC="Exceptions in setting AC cross reference for 2006.95"
"RTN","MAGQE7",101,0)
 D ^%ZTLOAD
"RTN","MAGQE7",102,0)
 W !!,$S($D(ZTSK):">>> Job has been queued. The task number is "_ZTSK_".",1:">>> Unable to queue this job.") K IO("Q")
"RTN","MAGQE7",103,0)
 Q
"RTN","MAGQE7",104,0)
STARTPRT ;
"RTN","MAGQE7",105,0)
 N ANS,I,IMAGE,NODE,USER,HEADING,HEADING2,HEADING3,PAGE,STOP,ZTREQ
"RTN","MAGQE7",106,0)
 S:'+$G(DTIME) DTIME=600
"RTN","MAGQE7",107,0)
 S ZTREQ="@"  ;TaskMan utilities to delete the task.
"RTN","MAGQE7",108,0)
 S PAGE=0,HEADING="Imaging Activity Log (#2006.95) entries without C cross reference."
"RTN","MAGQE7",109,0)
 S HEADING2="Review the Image pointer, the entry should have an Acquisition Site (field #.05)."
"RTN","MAGQE7",110,0)
 S HEADING3="Or possibly the user does not have a DIVISION defined in file #200."
"RTN","MAGQE7",111,0)
 D HDR
"RTN","MAGQE7",112,0)
 S (STOP,I)=0 F  S I=$O(^XTMP("MAGQE7","NOTSET",I)) Q:'I  S NODE=$G(^XTMP("MAGQE7","NOTSET",I)) D  Q:STOP
"RTN","MAGQE7",113,0)
 . S IMAGE=$P(NODE,"^"),USER=$P(NODE,"^",2) D LINE
"RTN","MAGQE7",114,0)
 . Q
"RTN","MAGQE7",115,0)
 D ^%ZISC
"RTN","MAGQE7",116,0)
 Q
"RTN","MAGQE7",117,0)
HDR ;
"RTN","MAGQE7",118,0)
 W @IOF S PAGE=PAGE+1
"RTN","MAGQE7",119,0)
 W !?2,HEADING,"  Page: ",PAGE
"RTN","MAGQE7",120,0)
 W !?(IOM-$L(HEADING2)\2),HEADING2 W !?(IOM-$L(HEADING3)\2),HEADING3
"RTN","MAGQE7",121,0)
 W !,?10,"___________________________________",!
"RTN","MAGQE7",122,0)
 Q
"RTN","MAGQE7",123,0)
LINE ;Display output
"RTN","MAGQE7",124,0)
 N TYPE
"RTN","MAGQE7",125,0)
 D HDR:$Y+4>IOSL S TYPE="" I $D(^MAG(2006.95,I,0)) S TYPE=$P(^MAG(2006.95,I,0),"^",2)
"RTN","MAGQE7",126,0)
 W !,"Entry: ",I,", has image pointer ,",$S('IMAGE:"NULL",1:IMAGE),"; the entry was set by user, ",USER," ",TYPE
"RTN","MAGQE7",127,0)
 I $E(IOST,1,2)="C-",$Y+4>IOSL W !,"Press RETURN to continue or '^' to exit: "
"RTN","MAGQE7",128,0)
 R ANS:DTIME S STOP=$S(ANS="^":1,1:0)
"RTN","MAGQE7",129,0)
 Q
"RTN","MAGQE7",130,0)
RESTART ;
"RTN","MAGQE7",131,0)
 I '$P($G(^XTMP("MAGQE7","LASTXREF")),"^") W !,"Nothing to process." Q
"RTN","MAGQE7",132,0)
 S IEN=$P(^XMTP("MAGQE7","LASTXREF"),"^"),LAST=$P(^XTMP("MAGQE7","LASTXREF"),"^",2)
"RTN","MAGQE7",133,0)
 I IEN>LAST D  Q
"RTN","MAGQE7",134,0)
 . W !,"Last entry processed was IEN: "_IEN_", and indexing did complete."
"RTN","MAGQE7",135,0)
 . Q
"RTN","MAGQE7",136,0)
 D INDEX(IEN,LAST)
"RTN","MAGQE7",137,0)
 Q
"RTN","MAGQE7",138,0)
SETXTMP ;
"RTN","MAGQE7",139,0)
 ;XTMP global structure:
"RTN","MAGQE7",140,0)
 ;XTMP("MAGQE7",0)=start date^purge date^AC x-ref for file 2006.95^duz 
"RTN","MAGQE7",141,0)
 ;zero node to control the purging of this global.
"RTN","MAGQE7",142,0)
 ;XTMP("MAGQE7","LASTXREF") =2006.95's IEN last indexed ^ last IEN in the file at time of indexing
"RTN","MAGQE7",143,0)
 ;The above global can be used to restart the job incase an error occurs, RESTART^MAGQE7.
"RTN","MAGQE7",144,0)
 ;XTMP("MAGQE7","NOTSET",I)=IMAGE_"^"_USER
"RTN","MAGQE7",145,0)
 ;The above global is set when an entry can not be indexed.  Use PRINT^MAGQE7 to print the entries.
"RTN","MAGQE7",146,0)
 N BEGIN,X,X2 S BEGIN=$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","MAGQE7",147,0)
 S X=$$NOW^XLFDT,X2=$$FMADD^XLFDT(X,30,"","","")
"RTN","MAGQE7",148,0)
 S ^XTMP("MAGQE7",0)=X_"^"_X2_"^"_"AC x-ref for file 2006.95 "_"^"_$G(DUZ)   ;Create date^Purge date
"RTN","MAGQE7",149,0)
 ;Now time stamp the dd to prevent future t build be executed on test accounts.
"RTN","MAGQE7",150,0)
 S ^MAG(2006.95,"MAGP39")=BEGIN
"RTN","MAGQE7",151,0)
 Q
"RTN","MAGQE7",152,0)
REINDEX ;
"RTN","MAGQE7",153,0)
 N START,END,DT
"RTN","MAGQE7",154,0)
 S DT=$O(^MAG(2006.95,"AC",""),-1)
"RTN","MAGQE7",155,0)
 I DT'="" S START=$O(^MAG(2006.95,"AC",DT,0))
"RTN","MAGQE7",156,0)
 E  S START=1
"RTN","MAGQE7",157,0)
 S END=$P(^MAG(2006.95,0),"^",3)
"RTN","MAGQE7",158,0)
 N MAGDATE,MAGTIME,MAGHR,ZTRTN,ZTDESC,ZTIO,ZTDTH,ZTSK
"RTN","MAGQE7",159,0)
 S ZTRTN="INDEX^MAGQE7("_START_","_END_")",ZTDESC="Re-index file 2006.95",ZTIO=""
"RTN","MAGQE7",160,0)
 S MAGDATE=$$NOW^XLFDT(),MAGTIME=$P(MAGDATE,".",2),MAGHR=$E(MAGTIME,1,2)
"RTN","MAGQE7",161,0)
 I MAGHR>5,MAGHR<17 S MAGTIME=180000
"RTN","MAGQE7",162,0)
 S MAGDATE=$P(MAGDATE,".")_"."_MAGTIME
"RTN","MAGQE7",163,0)
 S ZTDTH=MAGDATE
"RTN","MAGQE7",164,0)
 D ^%ZTLOAD I $D(IO(0)) U IO(0) W !,"Re-indexing scheduled TASK#: "_ZTSK
"RTN","MAGQE7",165,0)
 Q
"UP",2005.2,2005.201,-1)
2005.2^5
"UP",2005.2,2005.201,0)
2005.201
"UP",2005.2,2005.22,-1)
2005.2^7
"UP",2005.2,2005.22,0)
2005.22
"UP",2006.1,2006.11,-1)
2006.1^4
"UP",2006.1,2006.11,0)
2006.11
"UP",2006.1,2006.112,-1)
2006.1^2
"UP",2006.1,2006.112,0)
2006.112
"UP",2006.1,2006.12,-1)
2006.1^INSTS
"UP",2006.1,2006.12,0)
2006.12
"UP",2006.1,2006.166,-1)
2006.1^6
"UP",2006.1,2006.166,0)
2006.166
"UP",2006.1,2006.1662,-1)
2006.166^1
"UP",2006.1,2006.1662,-2)
2006.1^6
"UP",2006.1,2006.1662,0)
2006.1662
"UP",2006.1,2006.1664,-1)
2006.166^3
"UP",2006.1,2006.1664,-2)
2006.1^6
"UP",2006.1,2006.1664,0)
2006.1664
"UP",2006.1,2006.1665,-1)
2006.166^4
"UP",2006.1,2006.1665,-2)
2006.1^6
"UP",2006.1,2006.1665,0)
2006.1665
"VER")
8.0^22.0
"^DD",2005.2,2005.2,.01,0)
NETWORK LOCATION^RFX^^0;1^I $D(X) K:$L(X)>30!($L(X)<3)!'(X?1.E) X D CHKNAM^MAGQBUT6(.X)
"^DD",2005.2,2005.2,.01,1,0)
^.1
"^DD",2005.2,2005.2,.01,1,1,0)
2005.2^B
"^DD",2005.2,2005.2,.01,1,1,1)
S ^MAG(2005.2,"B",$E(X,1,30),DA)=""
"^DD",2005.2,2005.2,.01,1,1,2)
K ^MAG(2005.2,"B",$E(X,1,30),DA)
"^DD",2005.2,2005.2,.01,3)
Enter the alias name for the share; 3-30 characters in length.
"^DD",2005.2,2005.2,.01,21,0)
^.001^1^1^3100308^^^^
"^DD",2005.2,2005.2,.01,21,1,0)
This is the alias name of an Imaging share.
"^DD",2005.2,2005.2,.01,23,0)
^.001^2^2^3100308^^^
"^DD",2005.2,2005.2,.01,23,1,0)
This field must be unique within the site parameter file
"^DD",2005.2,2005.2,.01,23,2,0)
entry which systemically is referred to as PLACE.
"^DD",2005.2,2005.2,.01,"DEL",1,0)
D EN^DDIOL("Deletion is not allowed!") I 1
"^DD",2005.2,2005.2,.01,"DT")
3100210
"^DD",2005.2,2005.2,.04,0)
PLACE^RP2006.1'^MAG(2006.1,^0;10^Q
"^DD",2005.2,2005.2,.04,1,0)
^.1^^0
"^DD",2005.2,2005.2,.04,21,0)
^.001^5^5^3100308^^^^
"^DD",2005.2,2005.2,.04,21,1,0)
This field identifies the SITE PARAMETER file entry. The Site
"^DD",2005.2,2005.2,.04,21,2,0)
parameter entry defines all of the attributes of Vista Imaging
"^DD",2005.2,2005.2,.04,21,3,0)
local area network.
"^DD",2005.2,2005.2,.04,21,4,0)
 
"^DD",2005.2,2005.2,.04,21,5,0)
This includes facility user preferences, network write locations, etc.
"^DD",2005.2,2005.2,.04,"DT")
3090529
"^DD",2005.2,2005.2,1,0)
PHYSICAL REFERENCE^FX^^0;2^Q:($P($G(^MAG(2005.2,DA,0)),U,7)["GRP")  K:($L(X)>120!($L(X)<1))!'((X?1"\\".E1"\".E1"\")!(X?1A1":\"1E.E1"\")!($P($$UPPER^MAGQE4(X),"//")["HTTP")) X D CHKNET^MAGQBUT6(.X)
"^DD",2005.2,2005.2,1,1,0)
^.1^^-1
"^DD",2005.2,2005.2,1,1,1,0)
2005.2^AC
"^DD",2005.2,2005.2,1,1,1,1)
S ^MAG(2005.2,"AC",X,DA)=""
"^DD",2005.2,2005.2,1,1,1,2)
K ^MAG(2005.2,"AC",X,DA)
"^DD",2005.2,2005.2,1,1,1,"%D",0)
^.101^2^2^3030220^^^^
"^DD",2005.2,2005.2,1,1,1,"%D",1,0)
This cross-reference allows a network location to be looked up
"^DD",2005.2,2005.2,1,1,1,"%D",2,0)
by physical name.
"^DD",2005.2,2005.2,1,1,1,"DT")
2951017
"^DD",2005.2,2005.2,1,3)
Enter the name of the physical location for this device. Answer must be 1-120 characters in length.
"^DD",2005.2,2005.2,1,21,0)
^.001^9^9^3100308^^^^
"^DD",2005.2,2005.2,1,21,1,0)
This is the physical network location where the image is stored.
"^DD",2005.2,2005.2,1,21,2,0)
This is the Universal Naming Convention (UNC) path for the 
"^DD",2005.2,2005.2,1,21,3,0)
Image Storage. For example: \\SERVER01\IMAGE1\
"^DD",2005.2,2005.2,1,21,4,0)
 
"^DD",2005.2,2005.2,1,21,5,0)
This is a required field for all entries except for an entry 
"^DD",2005.2,2005.2,1,21,6,0)
defined with a RAID-GROUP STORAGE TYPE (#6).
"^DD",2005.2,2005.2,1,21,7,0)
 
"^DD",2005.2,2005.2,1,21,8,0)
Duplicate PHYSICAL REFERENCE values within the same VistA Imaging
"^DD",2005.2,2005.2,1,21,9,0)
configuration PLACE (#.04) are not allowed.
"^DD",2005.2,2005.2,1,"DT")
3090529
"^DD",2005.2,2005.2,2,0)
TOTAL SPACE^NJ7,0^^0;3^K:+X'=X!(X>9999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2005.2,2005.2,2,3)
Type a Number between 0 and 9999999, 0 Decimal Digits
"^DD",2005.2,2005.2,2,21,0)
^.001^6^6^3100308^^^^
"^DD",2005.2,2005.2,2,21,1,0)
This is the total available formatted space of this network location. 
"^DD",2005.2,2005.2,2,21,2,0)
 
"^DD",2005.2,2005.2,2,21,3,0)
The information in this field is dependent on the connectivity of the 
"^DD",2005.2,2005.2,2,21,4,0)
share and may be set to zero if the share is not available. 
"^DD",2005.2,2005.2,2,21,5,0)
 
"^DD",2005.2,2005.2,2,21,6,0)
This field is maintained by the RPC MAGQ FS CHNGE.
"^DD",2005.2,2005.2,2,"DT")
2940609
"^DD",2005.2,2005.2,4,0)
FREE SPACE^NJ7,0^^0;5^K:+X'=X!(X>9999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2005.2,2005.2,4,3)
Type a Number between 0 and 9999999, 0 Decimal Digits
"^DD",2005.2,2005.2,4,21,0)
^.001^4^4^3100308^^^^
"^DD",2005.2,2005.2,4,21,1,0)
This is the amount of available space remaining for this network
"^DD",2005.2,2005.2,4,21,2,0)
location. The information in this field is dependent on the 
"^DD",2005.2,2005.2,4,21,3,0)
connectivity of the share and may be set to zero if the share is
"^DD",2005.2,2005.2,4,21,4,0)
not available. This field is maintained by the RPC MAGQ FS CHNGE.
"^DD",2005.2,2005.2,4,"DT")
2940505
"^DD",2005.2,2005.2,5.5,0)
READ ONLY^S^0:NO;1:YES;^1;6^S:$P(^MAG(2005.2,DA,1),U,6)="" $P(^MAG(2005.2,DA,1),U,6)="0"
"^DD",2005.2,2005.2,5.5,21,0)
^.001^2^2^3100308^^^^
"^DD",2005.2,2005.2,5.5,21,1,0)
This field enables applications to filter shares that are 
"^DD",2005.2,2005.2,5.5,21,2,0)
designated as read only by active VistA Imaging applications.
"^DD",2005.2,2005.2,5.5,"DT")
3070710
"^DD",2005.2,2005.2,6,0)
STORAGE TYPE^RS^MAG:MAGNETIC;WORM-DG:WORM-DG;WORM-PDT:WORM-PDT;RW:READ/WRITE;WORM-OTG:WORM-OTG;EKG:MUSE-EKG;GCC:EXPORT;DGM:DIAGRAM;URL:URL;RTR:ROUTER;GRP:RAID-GROUP;^0;7^Q
"^DD",2005.2,2005.2,6,1,0)
^.1
"^DD",2005.2,2005.2,6,1,1,0)
2005.2^E
"^DD",2005.2,2005.2,6,1,1,1)
S ^MAG(2005.2,"E",$E(X,1,30),DA)=""
"^DD",2005.2,2005.2,6,1,1,2)
K ^MAG(2005.2,"E",$E(X,1,30),DA)
"^DD",2005.2,2005.2,6,1,1,"%D",0)
^.101^1^1^3030813^^
"^DD",2005.2,2005.2,6,1,1,"%D",1,0)
Storage Type cross reference
"^DD",2005.2,2005.2,6,1,1,"DT")
3000131
"^DD",2005.2,2005.2,6,3)
Enter the type of storage for this network location.
"^DD",2005.2,2005.2,6,21,0)
^.001^18^18^3100308^^^^
"^DD",2005.2,2005.2,6,21,1,0)
This field describes the media type of this network location. 
"^DD",2005.2,2005.2,6,21,2,0)
It should be MAGNETIC for a magnetic disk server.
"^DD",2005.2,2005.2,6,21,3,0)
 
"^DD",2005.2,2005.2,6,21,4,0)
Jukeboxes should be WORM-DG for Data General Jukeboxes under 
"^DD",2005.2,2005.2,6,21,5,0)
OpenNetware or WORM-PDT for Pegasus Jukeboxes or WORM-OTG for 
"^DD",2005.2,2005.2,6,21,6,0)
OTG Disk Extender. WORM-DG and WORM-PDT are for backward 
"^DD",2005.2,2005.2,6,21,7,0)
compatibility only. Note: WORM stands for Write Once, Read Many.
"^DD",2005.2,2005.2,6,21,8,0)
 
"^DD",2005.2,2005.2,6,21,9,0)
The GCC type refers to the Generic Carbon Copy (GCC) utility. 
"^DD",2005.2,2005.2,6,21,10,0)
 
"^DD",2005.2,2005.2,6,21,11,0)
URL is used for Web based file access. 
"^DD",2005.2,2005.2,6,21,12,0)
 
"^DD",2005.2,2005.2,6,21,13,0)
Type 'RTR' should be used to identify network entries that are 
"^DD",2005.2,2005.2,6,21,14,0)
used for Routing images.
"^DD",2005.2,2005.2,6,21,15,0)
 
"^DD",2005.2,2005.2,6,21,16,0)
Type 'GRP' will identify a group entry and will allow sites to group 
"^DD",2005.2,2005.2,6,21,17,0)
network locations. This functionality is useful for the Background 
"^DD",2005.2,2005.2,6,21,18,0)
Processor and Verifier applications.
"^DD",2005.2,2005.2,6,"DT")
3090225
"^DD",2005.2,2005.2,7,0)
HASH SUBDIRECTORY^SX^Y:YES;^0;8^Q
"^DD",2005.2,2005.2,7,21,0)
^.001^1^1^3100408^^^^
"^DD",2005.2,2005.2,7,21,1,0)
Control whether subdirectory should be hashed.
"^DD",2005.2,2005.2,7,23,0)
^.001^10^10^3100408^^^^
"^DD",2005.2,2005.2,7,23,1,0)
Imaging storage activities create a directory schema with the sites
"^DD",2005.2,2005.2,7,23,2,0)
namespace as the primary directory and sub directories
"^DD",2005.2,2005.2,7,23,3,0)
are created by parsing sequential 2 digit file name segments.
"^DD",2005.2,2005.2,7,23,4,0)
 
"^DD",2005.2,2005.2,7,23,5,0)
The function DIRHASH in the M routine MAGFILEB calculates the 
"^DD",2005.2,2005.2,7,23,6,0)
hierarchical directory hash. The following is an example of 
"^DD",2005.2,2005.2,7,23,7,0)
the method it uses:
"^DD",2005.2,2005.2,7,23,8,0)
For an 8.3 filename AB123456.XYZ, the directory hash is AB\12\34
"^DD",2005.2,2005.2,7,23,9,0)
For a 14.3 filename BALT1234567890.XYZ, the directory 
"^DD",2005.2,2005.2,7,23,10,0)
hash is BALT\12\34\56\
"^DD",2005.2,2005.2,7,"DT")
2991119
"^DD",2005.2,2005.2,8,0)
ABSTRACT^S^0:No;1:Yes;^1;1^Q
"^DD",2005.2,2005.2,8,.1)
Site supports 'ABSTRACT' files
"^DD",2005.2,2005.2,8,3)
Enter Yes or No.
"^DD",2005.2,2005.2,8,21,0)
^.001^2^2^3100308^^^^
"^DD",2005.2,2005.2,8,21,1,0)
This field is a flag indicating whether or not 
"^DD",2005.2,2005.2,8,21,2,0)
a network location supports ABSTRACT image files'.  
"^DD",2005.2,2005.2,8,"DT")
2980929
"^DD",2005.2,2005.2,9,0)
FULL^S^0:No;1:Yes;^1;2^Q
"^DD",2005.2,2005.2,9,.1)
Site supports 'FULL' files
"^DD",2005.2,2005.2,9,3)
Enter Yes or No.
"^DD",2005.2,2005.2,9,21,0)
^.001^2^2^3100308^^^^
"^DD",2005.2,2005.2,9,21,1,0)
This field is a flag indicating whether or not 
"^DD",2005.2,2005.2,9,21,2,0)
a network location supports FULL image files. 
"^DD",2005.2,2005.2,9,"DT")
2980929
"^DD",2005.2,2005.2,10,0)
BIG^S^0:No;1:Yes;^1;3^Q
"^DD",2005.2,2005.2,10,.1)
Site supports 'BIG' files
"^DD",2005.2,2005.2,10,3)
Enter Yes or No.
"^DD",2005.2,2005.2,10,21,0)
^.001^2^2^3100308^^^^
"^DD",2005.2,2005.2,10,21,1,0)
This field is a flag indicating whether or not 
"^DD",2005.2,2005.2,10,21,2,0)
a network location supports BIG image files.  
"^DD",2005.2,2005.2,10,"DT")
2980929
"^DD",2005.2,2005.2,11,0)
TEXT^S^0:No;1:Yes;^1;4^Q
"^DD",2005.2,2005.2,11,.1)
Site supports 'TEXT' files
"^DD",2005.2,2005.2,11,3)
Enter Yes or No.
"^DD",2005.2,2005.2,11,21,0)
^.001^2^2^3100308^^^^
"^DD",2005.2,2005.2,11,21,1,0)
This field is a flag indicating whether or not 
"^DD",2005.2,2005.2,11,21,2,0)
a network location supports TEXT image files.  
"^DD",2005.2,2005.2,11,"DT")
2980929
"^DD",2005.2,2005.2,12,0)
DICOM^S^0:No;1:Yes;^1;5^Q
"^DD",2005.2,2005.2,12,.1)
Site supports 'DICOM' files
"^DD",2005.2,2005.2,12,3)
Enter Yes or No.
"^DD",2005.2,2005.2,12,21,0)
^.001^2^2^3100308^^^^
"^DD",2005.2,2005.2,12,21,1,0)
This field is a flag indicating whether or not 
"^DD",2005.2,2005.2,12,21,2,0)
a network location supports DICOM image files. 
"^DD",2005.2,2005.2,12,"DT")
2980929
"^DD",2005.2,2005.2,14,0)
COMPRESSION^S^NONE:None;J2K:JPEG-2000;^1;7^Q
"^DD",2005.2,2005.2,14,.1)
Type of data compression
"^DD",2005.2,2005.2,14,3)
Enter a code for the type of compression (NONE means no compression).
"^DD",2005.2,2005.2,14,21,0)
^.001^2^2^3100308^^^^
"^DD",2005.2,2005.2,14,21,1,0)
This field indicates which type of compression, if any, 
"^DD",2005.2,2005.2,14,21,2,0)
is to use while transmitting files to this network location.
"^DD",2005.2,2005.2,14,"DT")
3040903
"^DD",2005.2,2005.2,15,0)
USER NAME^F^^2;1^K:$L(X)>31!($L(X)<1) X
"^DD",2005.2,2005.2,15,.1)
User name
"^DD",2005.2,2005.2,15,3)
Enter a valid user name for this network location.
"^DD",2005.2,2005.2,15,21,0)
^.001^2^2^3100308^^^^
"^DD",2005.2,2005.2,15,21,1,0)
This field is for a user name used to establish 
"^DD",2005.2,2005.2,15,21,2,0)
a connection with the network location.
"^DD",2005.2,2005.2,15,"DT")
2980929
"^DD",2005.2,2005.2,16,0)
PASSWORD^FXO^^2;2^K:$L(X)>30!($L(X)<3) X Q:'$D(X)  S MAGPAS=X S X=$$ENCRYP^ROUTINE(MAGPAS)
"^DD",2005.2,2005.2,16,.1)
Password
"^DD",2005.2,2005.2,16,2)
S Y(0)=Y S Y="<Hidden>"
"^DD",2005.2,2005.2,16,2.1)
S Y="<Hidden>"
"^DD",2005.2,2005.2,16,3)
Enter a valid password for this user at this network location.
"^DD",2005.2,2005.2,16,21,0)
^.001^2^2^3100308^^^^
"^DD",2005.2,2005.2,16,21,1,0)
This field is a password used with a user name to 
"^DD",2005.2,2005.2,16,21,2,0)
establish a connection with this network location. 
"^DD",2005.2,2005.2,16,"DT")
3090415
"^DD",2005.2,2005.2,17,0)
MAINTAINCONNECTION^S^0:NO;1:YES;^2;3^Q
"^DD",2005.2,2005.2,17,23,0)
^^4^4^3100308^
"^DD",2005.2,2005.2,17,23,1,0)
This field allows the user to optimize the Export share output by
"^DD",2005.2,2005.2,17,23,2,0)
maintaining the connection between export events.  The normal 
"^DD",2005.2,2005.2,17,23,3,0)
export file copy connects to the share, copies a file, and then 
"^DD",2005.2,2005.2,17,23,4,0)
disconnects from the export share.
"^DD",2005.2,2005.2,17,"DT")
3011219
"^DD",2005.2,2005.2,18,0)
MAX # RETRY ON CONNECT^NJ3,0^^3;2^K:+X'=X!(X>999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2005.2,2005.2,18,.1)
Maximum number of retries on connect
"^DD",2005.2,2005.2,18,3)
Enter the maximum number of attemps to establish a connection.
"^DD",2005.2,2005.2,18,21,0)
^.001^4^4^3100308^^^^
"^DD",2005.2,2005.2,18,21,1,0)
This field indicates  the number of attempts to make to connect with
"^DD",2005.2,2005.2,18,21,2,0)
the network location. When no connection can be established within
"^DD",2005.2,2005.2,18,21,3,0)
this number of attempts, the status of the network location will be 
"^DD",2005.2,2005.2,18,21,4,0)
set to 'Off-Line'. 
"^DD",2005.2,2005.2,18,"DT")
2980929
"^DD",2005.2,2005.2,19,0)
MAX # RETRY ON TRANSMIT^NJ3,0^^3;3^K:+X'=X!(X>999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2005.2,2005.2,19,.1)
Maximum number of retries on transmit
"^DD",2005.2,2005.2,19,3)
Enter the maximum number of attempts to transmit a file.
"^DD",2005.2,2005.2,19,21,0)
^.001^3^3^3100308^^^^
"^DD",2005.2,2005.2,19,21,1,0)
This field indicates  the number of attempts to make to transmit
"^DD",2005.2,2005.2,19,21,2,0)
a file. When a file cannot be transmitted within this number of 
"^DD",2005.2,2005.2,19,21,3,0)
attempts, its status will be set to 'FAILED'.
"^DD",2005.2,2005.2,19,"DT")
2980929
"^DD",2005.2,2005.2,20,0)
SYNTAX^S^UNC:UNC;^4;1^Q
"^DD",2005.2,2005.2,20,.1)
Syntax for physical name
"^DD",2005.2,2005.2,20,3)
Enter a code for the syntax of the name of this network location.
"^DD",2005.2,2005.2,20,21,0)
^.001^2^2^3100308^^^^
"^DD",2005.2,2005.2,20,21,1,0)
This field is a code for the syntax that describes the actual 
"^DD",2005.2,2005.2,20,21,2,0)
(physical) name of the network location.
"^DD",2005.2,2005.2,20,"DT")
2980929
"^DD",2005.2,2005.2,21,0)
SUBDIRECTORY^F^^4;2^K:$L(X)>64!($L(X)<1) X
"^DD",2005.2,2005.2,21,.1)
Subdirectory at network location
"^DD",2005.2,2005.2,21,3)
Enter the name of the subdirectory where files are to be stored.
"^DD",2005.2,2005.2,21,21,0)
^.001^9^9^3100308^^^^
"^DD",2005.2,2005.2,21,21,1,0)
Files are typically not stored in root directories. 
"^DD",2005.2,2005.2,21,21,2,0)
 
"^DD",2005.2,2005.2,21,21,3,0)
This field is the name of a subdirectory where files are to be
"^DD",2005.2,2005.2,21,21,4,0)
stored.  The value of this field is concatenated to the 
"^DD",2005.2,2005.2,21,21,5,0)
name of the network location (the 'physical name') to create 
"^DD",2005.2,2005.2,21,21,6,0)
the complete path-name for the location where files are to be 
"^DD",2005.2,2005.2,21,21,7,0)
stored.  When "directory hashing" iS active, additional 
"^DD",2005.2,2005.2,21,21,8,0)
subdirectory names will be added to the above-mentioned 
"^DD",2005.2,2005.2,21,21,9,0)
path-name before the file name  is appended.
"^DD",2005.2,2005.2,21,"DT")
2980929
"^DD",2005.2,2005.2,22,0)
EMAIL^2005.201PA^^5;0
"^DD",2005.2,2005.2,23,0)
RETENTION PERIOD^NJ3,0^^3;1^K:+X'=X!(X>365)!(X<1)!(X?.E1"."1N.N) X
"^DD",2005.2,2005.2,23,.1)
Number of days before automatic purge
"^DD",2005.2,2005.2,23,3)
Enter the number of days that routed images will be retained.
"^DD",2005.2,2005.2,23,21,0)
^.001^5^5^3100308^^^^
"^DD",2005.2,2005.2,23,21,1,0)
This field  indicates the number of days to retain routed image files
"^DD",2005.2,2005.2,23,21,2,0)
at the location identified by this entry in the NETWORK LOCATION file. 
"^DD",2005.2,2005.2,23,21,3,0)
 
"^DD",2005.2,2005.2,23,21,4,0)
When Images  are present for more than this number of days, they are 
"^DD",2005.2,2005.2,23,21,5,0)
candidates for automatic removal.
"^DD",2005.2,2005.2,23,"DT")
2981110
"^DD",2005.2,2005.2,24,0)
LAST PURGE DATE^D^^3;4^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",2005.2,2005.2,24,3)
Enter the date of the latest automatic purge at this location.
"^DD",2005.2,2005.2,24,21,0)
^.001^4^4^3100308^^
"^DD",2005.2,2005.2,24,21,1,0)
This field indicates the date and time of the most recent purge 
"^DD",2005.2,2005.2,24,21,2,0)
at this network location.  An automatic purge will be executed
"^DD",2005.2,2005.2,24,21,3,0)
at most once per day; the value of this field determines whether 
"^DD",2005.2,2005.2,24,21,4,0)
or not a purge has already taken place.  
"^DD",2005.2,2005.2,24,"DT")
2981110
"^DD",2005.2,2005.2,25,0)
SITE^F^^3;5^K:$L(X)>20!($L(X)<3) X
"^DD",2005.2,2005.2,25,3)
Enter the three-letter abbreviation for the site.
"^DD",2005.2,2005.2,25,21,0)
^.001^6^6^3100908^^^^
"^DD",2005.2,2005.2,25,21,1,0)
This field is a code for the site of the 'network location.  
"^DD",2005.2,2005.2,25,21,2,0)
 
"^DD",2005.2,2005.2,25,21,3,0)
This code is typically a three-letter abbreviation\acronym
"^DD",2005.2,2005.2,25,21,4,0)
(WAS for Washington DC, STL for St. Louis, etcetera).  
"^DD",2005.2,2005.2,25,21,5,0)
For stations 'at home', a longer code that starts with "HOME" 
"^DD",2005.2,2005.2,25,21,6,0)
is entered.
"^DD",2005.2,2005.2,25,"DT")
2981211
"^DD",2005.2,2005.2,26,0)
ROUTER^SX^0:NO;1:YES;^0;9^Q:DA="+1"  S:$P(^MAG(2005.2,DA,0),U,9)="" $P(^MAG(2005.2,DA,0),U,9)="0"
"^DD",2005.2,2005.2,26,21,0)
^.001^5^5^3100308^^^^
"^DD",2005.2,2005.2,26,21,1,0)
This boolean value is used to designate certain network location 
"^DD",2005.2,2005.2,26,21,2,0)
shares as routing shares.  This is necessary to allow clinical WS 
"^DD",2005.2,2005.2,26,21,3,0)
applications access to images on these shares but to prevent the 
"^DD",2005.2,2005.2,26,21,4,0)
background processor from designating this share as the current 
"^DD",2005.2,2005.2,26,21,5,0)
write location.
"^DD",2005.2,2005.2,26,"DT")
3080219
"^DD",2005.2,2005.2,27,0)
TIME OFFLINE^D^^3;6^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",2005.2,2005.2,27,3)
Enter the date and time that this equipment went off-line.
"^DD",2005.2,2005.2,27,21,0)
^.001^5^5^3100308^^^
"^DD",2005.2,2005.2,27,21,1,0)
This field is a time stamp indicating when the equipment 
"^DD",2005.2,2005.2,27,21,2,0)
in question most recently went off-line.  This time stamp is
"^DD",2005.2,2005.2,27,21,3,0)
used by the Routing software to decide whether or not to 
"^DD",2005.2,2005.2,27,21,4,0)
attempt to reconnect to a destination that was not reachable
"^DD",2005.2,2005.2,27,21,5,0)
at an earlier stage.  
"^DD",2005.2,2005.2,27,"DT")
2990210
"^DD",2005.2,2005.2,28,0)
MUSE SITE #^NJ2,0^^6;1^K:+X'=X!(X>20)!(X<0)!(X?.E1"."1N.N) X
"^DD",2005.2,2005.2,28,3)
Type a Number between 0 and 20, 0 Decimal Digits
"^DD",2005.2,2005.2,28,21,0)
^.001^5^5^3100308^^^^
"^DD",2005.2,2005.2,28,21,1,0)
If this is a MUSE EKG network location, enter the MUSE site 
"^DD",2005.2,2005.2,28,21,2,0)
number for this location. Typically, a site with a single MUSE 
"^DD",2005.2,2005.2,28,21,3,0)
server that holds EKGs for one site uses 1.  If a MUSE server
"^DD",2005.2,2005.2,28,21,4,0)
stores EKGs for more than one site, then Marquette assigns 
"^DD",2005.2,2005.2,28,21,5,0)
each site a MUSE site number.  
"^DD",2005.2,2005.2,28,"DT")
3000208
"^DD",2005.2,2005.2,29,0)
MUSE VERSION #^P2006.17'^MAG(2006.17,^6;2^Q
"^DD",2005.2,2005.2,29,3)
Enter the MUSE version number.
"^DD",2005.2,2005.2,29,21,0)
^.001^2^2^3100308^^^^
"^DD",2005.2,2005.2,29,21,1,0)
Enter the MUSE version number if this network location is a 
"^DD",2005.2,2005.2,29,21,2,0)
MUSE EKG storage type.
"^DD",2005.2,2005.2,29,"DT")
3000228
"^DD",2005.2,2005.2,30,0)
SHARE GROUP^2005.22PA^^7;0
"^DD",2005.2,2005.2,30,21,0)
^.001^3^3^3100308^^^^
"^DD",2005.2,2005.2,30,21,1,0)
This subfile identifies the entries that are part of a Shared 
"^DD",2005.2,2005.2,30,21,2,0)
Group Imaging sites can use this functionality to group their  
"^DD",2005.2,2005.2,30,21,3,0)
network shares.
"^DD",2005.2,2005.2,31,0)
GROUP MEMBER^*P2005.2'^MAG(2005.2,^1;8^S DIC("S")="I $P(^(0),U,7)=""GRP""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",2005.2,2005.2,31,12)
This should only reference a STORAGE TYPE of 'GRP'.
"^DD",2005.2,2005.2,31,12.1)
S DIC("S")="I $P(^(0),U,7)=""GRP"""
"^DD",2005.2,2005.2,31,21,0)
^.001^3^3^3100308^^^
"^DD",2005.2,2005.2,31,21,1,0)
This field identifies the Group name that this network location
"^DD",2005.2,2005.2,31,21,2,0)
 is part of. Only entries that have a Storage Type of 'GRP' can
"^DD",2005.2,2005.2,31,21,3,0)
 be selected.
"^DD",2005.2,2005.2,31,"DT")
3070905
"^DD",2005.2,2005.201,0)
EMAIL SUB-FIELD^^1^2
"^DD",2005.2,2005.201,0,"DT")
2980929
"^DD",2005.2,2005.201,0,"NM","EMAIL")

"^DD",2005.2,2005.201,0,"UP")
2005.2
"^DD",2005.2,2005.201,.01,0)
USER^P200'^VA(200,^0;1^Q
"^DD",2005.2,2005.201,.01,.1)
User
"^DD",2005.2,2005.201,.01,1,0)
^.1^^0
"^DD",2005.2,2005.201,.01,3)
Enter the name of a user to notify.
"^DD",2005.2,2005.201,.01,21,0)
^.001^5^5^3100308^^^^
"^DD",2005.2,2005.201,.01,21,1,0)
This field identifies a user who is to receive notification
"^DD",2005.2,2005.201,.01,21,2,0)
messages when certain important events have occurred, or when 
"^DD",2005.2,2005.201,.01,21,3,0)
a certain number of images have been transmitted.  Messages 
"^DD",2005.2,2005.201,.01,21,4,0)
transmitted to the user identified in this field will be 
"^DD",2005.2,2005.201,.01,21,5,0)
sent through VA-MailMan (FORUM).  
"^DD",2005.2,2005.201,.01,"DT")
2980929
"^DD",2005.2,2005.201,1,0)
EMAIL^F^^0;2^K:$L(X)>64!($L(X)<1) X
"^DD",2005.2,2005.201,1,.1)
E-mail
"^DD",2005.2,2005.201,1,3)
Enter an e-mail address (name@machine.domain).
"^DD",2005.2,2005.201,1,21,0)
^.001^4^4^3100308^^^^
"^DD",2005.2,2005.201,1,21,1,0)
This field indicates the e-mail address of a user  to notify when
"^DD",2005.2,2005.201,1,21,2,0)
significant events occur for this network location.  Messages
"^DD",2005.2,2005.201,1,21,3,0)
transmitted to a user identified in this field will be sent through
"^DD",2005.2,2005.201,1,21,4,0)
'internet e-mail'.
"^DD",2005.2,2005.201,1,"DT")
2980929
"^DD",2005.2,2005.22,0)
SHARE GROUP SUB-FIELD^^.01^1
"^DD",2005.2,2005.22,0,"DT")
3070305
"^DD",2005.2,2005.22,0,"IX","B",2005.22,.01)

"^DD",2005.2,2005.22,0,"NM","SHARE GROUP")

"^DD",2005.2,2005.22,0,"UP")
2005.2
"^DD",2005.2,2005.22,.01,0)
SHARE GROUP^P2005.2^MAG(2005.2,^0;1^Q
"^DD",2005.2,2005.22,.01,1,0)
^.1^^-1
"^DD",2005.2,2005.22,.01,1,1,0)
2005.22^B
"^DD",2005.2,2005.22,.01,1,1,1)
S ^MAG(2005.2,DA(1),7,"B",$E(X,1,30),DA)=""
"^DD",2005.2,2005.22,.01,1,1,2)
K ^MAG(2005.2,DA(1),7,"B",$E(X,1,30),DA)
"^DD",2005.2,2005.22,.01,3)
Enter a RAID storage type member.
"^DD",2005.2,2005.22,.01,21,0)
^.001^2^2^3100308^^^
"^DD",2005.2,2005.22,.01,21,1,0)
This field identifies the RAID storage type members of
"^DD",2005.2,2005.22,.01,21,2,0)
 the parent RAID-GROUP.
"^DD",2005.2,2005.22,.01,"DT")
3090701
"^DD",2005.86,2005.86,6,0)
EXPORT LOCATION^P2005.2'^MAG(2005.2,^0;5^Q
"^DD",2005.86,2005.86,6,3)
Enter the Network Location for this type of image.
"^DD",2005.86,2005.86,6,21,0)
^.001^1^1^3090924^^
"^DD",2005.86,2005.86,6,21,1,0)
This is the export location to which an image may be exported.
"^DD",2005.86,2005.86,6,"DT")
3070712
"^DD",2006.031,2006.031,4,0)
LAST_QUEUE_PROCESSED_DATE_TIME^D^^0;6^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",2006.031,2006.031,4,3)
(No range limit on date)
"^DD",2006.031,2006.031,4,21,0)
^^1^1^3070808^
"^DD",2006.031,2006.031,4,21,1,0)
This is the latest date and time that this queue was processed.  It is updated at the completion of the BP Queue process. 
"^DD",2006.031,2006.031,4,"DT")
3070808
"^DD",2006.1,2006.1,.02,0)
CURRENT NAMESPACE^RFX^^0;2^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>45!($L(X)<1) X
"^DD",2006.1,2006.1,.02,3)
Answer must be 1-45 characters in length.
"^DD",2006.1,2006.1,.02,21,0)
^.001^2^2^3100308^^^
"^DD",2006.1,2006.1,.02,21,1,0)
The Image file is 14 characters. Each facility has its own
"^DD",2006.1,2006.1,.02,21,2,0)
unique namespace (e.g., Washington is WAS, Baltimore is BAL).
"^DD",2006.1,2006.1,.02,"DT")
3020411
"^DD",2006.1,2006.1,.03,0)
IMAGE NETWORK WRITE LOCATION^P2005.2^MAG(2005.2,^0;3^Q
"^DD",2006.1,2006.1,.03,3)
Current Network Write Location for Image Storage
"^DD",2006.1,2006.1,.03,21,0)
^.001^3^3^3100308^^^
"^DD",2006.1,2006.1,.03,21,1,0)
This field identifies the current network share for image file
"^DD",2006.1,2006.1,.03,21,2,0)
captures and archive retrieval.  This field will need to be 
"^DD",2006.1,2006.1,.03,21,3,0)
manually changed when a share reaches low water mark.
"^DD",2006.1,2006.1,.03,"DT")
2930909
"^DD",2006.1,2006.1,.031,0)
CURRENT RAID GROUP^*P2005.2'X^MAG(2005.2,^0;10^S DIC("S")="I $P(^(0),U,7)=""GRP""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",2006.1,2006.1,.031,12)
This selection should be restricted to the 'GRP' storage type.
"^DD",2006.1,2006.1,.031,12.1)
I $P(^(0),U,7)="GRP"
"^DD",2006.1,2006.1,.031,21,0)
^^3^3^3100308^
"^DD",2006.1,2006.1,.031,21,1,0)
This field indicates the RAID group of shares that the system is
"^DD",2006.1,2006.1,.031,21,2,0)
currently writing to.  This group is an entry in the NETWORK 
"^DD",2006.1,2006.1,.031,21,3,0)
LOCATION file and has a GRP storage type.
"^DD",2006.1,2006.1,.031,"DT")
3090318
"^DD",2006.1,2006.1,.04,0)
ASSOCIATED INSTITUTIONS^2006.12P^^INSTS;0
"^DD",2006.1,2006.1,.04,21,0)
^.001^3^3^3100308^^^^
"^DD",2006.1,2006.1,.04,21,1,0)
Through the use of the subfield's whole file cross-reference 
"^DD",2006.1,2006.1,.04,21,2,0)
this set of values will allow a site to make use of the imaging 
"^DD",2006.1,2006.1,.04,21,3,0)
network of a second institution to store and support images.
"^DD",2006.1,2006.1,.07,0)
GCC EXPORT LOC^*P2005.2'X^MAG(2005.2,^0;7^S DIC("S")="I $P(^(0),U,6,7)=""1^GCC""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",2006.1,2006.1,.07,3)
Enter the GCC EXPORT network share.
"^DD",2006.1,2006.1,.07,12)
Select GCC Network locations only.
"^DD",2006.1,2006.1,.07,12.1)
S DIC("S")="I $P(^(0),U,6,7)=""1^GCC"""
"^DD",2006.1,2006.1,.07,21,0)
^.001^2^2^3100308^^^^
"^DD",2006.1,2006.1,.07,21,1,0)
This field identifies the external network share for Generic 
"^DD",2006.1,2006.1,.07,21,2,0)
Carbon Copy (GCC) where image files are copied to.
"^DD",2006.1,2006.1,.07,"DT")
3041102
"^DD",2006.1,2006.1,.08,0)
IMAGE NETWORK IMPORT LOCATION^P2005.2^MAG(2005.2,^0;8^Q
"^DD",2006.1,2006.1,.08,3)
Enter the Network Location to which Images are imported.
"^DD",2006.1,2006.1,.08,21,0)
^.001^2^2^3100308^^^^
"^DD",2006.1,2006.1,.08,21,1,0)
This field identifies the IMPORT network share where the IMPORT 
"^DD",2006.1,2006.1,.08,21,2,0)
queues are copied to. This share is within the local Imaging Network.
"^DD",2006.1,2006.1,.08,"DT")
2940412
"^DD",2006.1,2006.1,1.02,0)
PACS DIRECTORY^P2005.2^MAG(2005.2,^PACS;2^Q
"^DD",2006.1,2006.1,1.02,3)
Enter Network Location where PACS images are written.
"^DD",2006.1,2006.1,1.02,21,0)
^.001^3^3^3100908^^^^
"^DD",2006.1,2006.1,1.02,21,1,0)
This field identifies the DICOM Gateway network location share 
"^DD",2006.1,2006.1,1.02,21,2,0)
where PACS images are written by the Commercial PACS SYSTEM, 
"^DD",2006.1,2006.1,1.02,21,3,0)
and where VistA first reads them.
"^DD",2006.1,2006.1,1.02,23,0)
^.001^6^6^3100908^^^^
"^DD",2006.1,2006.1,1.02,23,1,0)
The PACS SYSTEM, to which VistA is interfaced, will write images
"^DD",2006.1,2006.1,1.02,23,2,0)
to a designated network location, as defined by this field which 
"^DD",2006.1,2006.1,1.02,23,3,0)
can be changed if necessary. VistA will read from the directory 
"^DD",2006.1,2006.1,1.02,23,4,0)
specified by this field. It points to the Network location file -
"^DD",2006.1,2006.1,1.02,23,5,0)
so the full network location must be defined in that file for this
"^DD",2006.1,2006.1,1.02,23,6,0)
to work.
"^DD",2006.1,2006.1,1.02,"DT")
2940411
"^DD",2006.1,2006.1,1.03,0)
PACS IMAGE WRITE LOCATION^P2005.2^MAG(2005.2,^PACS;3^Q
"^DD",2006.1,2006.1,1.03,3)
Enter Network location where converted DICOM IMAGES are written.
"^DD",2006.1,2006.1,1.03,21,0)
^.001^4^4^3100308^^^^
"^DD",2006.1,2006.1,1.03,21,1,0)
This field identifies the current write network share for the 
"^DD",2006.1,2006.1,1.03,21,2,0)
DICOM Image Gateways. DICOM images are first read from the
"^DD",2006.1,2006.1,1.03,21,3,0)
DICOM directory and later converted and copied to the network
"^DD",2006.1,2006.1,1.03,21,4,0)
location specified by this field.
"^DD",2006.1,2006.1,1.03,"DT")
3001006
"^DD",2006.1,2006.1,2.01,0)
JUKEBOX WRITE LOCATION^*P2005.2'X^MAG(2005.2,^1;6^S DIC("S")="I $P(^(0),U,6,7)[""1^WORM"""  D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",2006.1,2006.1,2.01,12)
This Network Location selection must be an archival type so designated by the term "WORM" and have an 'On Line' OPERATIONAL STATUS.
"^DD",2006.1,2006.1,2.01,12.1)
S DIC("S")="I $P(^(0),U,6,7)[""1^WORM"""
"^DD",2006.1,2006.1,2.01,21,0)
^.001^3^3^3100308^^^^
"^DD",2006.1,2006.1,2.01,21,1,0)
This field identifies the JUKEBOX 'current write' network
"^DD",2006.1,2006.1,2.01,21,2,0)
share that will receive the Background Processor JUKEBOX
"^DD",2006.1,2006.1,2.01,21,3,0)
queues for newly acquired Image files. 
"^DD",2006.1,2006.1,2.01,"DT")
3071227
"^DD",2006.1,2006.1,6,0)
TRACK ABSTRACT ACCESSES^S^1:YES;0:NO;^1;3^Q
"^DD",2006.1,2006.1,6,3)
Enter YES to use abstract accesses in determining archive times
"^DD",2006.1,2006.1,6,21,0)
^.001^5^5^3100308^^^^
"^DD",2006.1,2006.1,6,21,1,0)
This field controls whether user access to image abstracts will
"^DD",2006.1,2006.1,6,21,2,0)
cause the LAST ACCESS DATE field in the Image file to be updated.
"^DD",2006.1,2006.1,6,21,3,0)
The LAST ACCESS DATE field is used to determine when full and
"^DD",2006.1,2006.1,6,21,4,0)
abstract images are removed from magnetic disks and become
"^DD",2006.1,2006.1,6,21,5,0)
available only from optical disk.
"^DD",2006.1,2006.1,6,"DT")
3001006
"^DD",2006.1,2006.1,8,0)
PURGE-RETENTION DAYS FULL FILE^RNJ5,0^^1;2^K:+X'=X!(X>99999)!(X<0)!(X?.E1"."1.N) X
"^DD",2006.1,2006.1,8,3)
Type a number between 0 and 99999, 0 Decimal Digits
"^DD",2006.1,2006.1,8,21,0)
^.001^5^5^3100308^^^^
"^DD",2006.1,2006.1,8,21,1,0)
This field is used by the Background Processor Purge to
"^DD",2006.1,2006.1,8,21,2,0)
determine the number of days to retain full image files. All
"^DD",2006.1,2006.1,8,21,3,0)
FULL images that have not been accessed in this many days
"^DD",2006.1,2006.1,8,21,4,0)
will be removed from magnetic storage by the Background
"^DD",2006.1,2006.1,8,21,5,0)
Processor Purge.
"^DD",2006.1,2006.1,8,"DT")
3060614
"^DD",2006.1,2006.1,9,0)
RETENTION DAYS HL7 & DICOM^RNJ6,0X^^1;5^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1.N) X
"^DD",2006.1,2006.1,9,3)
Type a number between 1 and 999999, 0 Decimal Digits
"^DD",2006.1,2006.1,9,21,0)
^^17^17^3110208^
"^DD",2006.1,2006.1,9,21,1,0)
This field is used as the default value, in days, by the
"^DD",2006.1,2006.1,9,21,2,0)
DICOM Text Gateway for three different user menu driven purges.
"^DD",2006.1,2006.1,9,21,3,0)
 
"^DD",2006.1,2006.1,9,21,4,0)
1) This field is used by the Purge Old Modality Worklist Entries
"^DD",2006.1,2006.1,9,21,5,0)
menu option to determine the number of retention days from the date
"^DD",2006.1,2006.1,9,21,6,0)
of creation of the Modality Worklist Entries.
"^DD",2006.1,2006.1,9,21,7,0)
 
"^DD",2006.1,2006.1,9,21,8,0)
2) This field is used by the Purge Old DICOM Message Files menu
"^DD",2006.1,2006.1,9,21,9,0)
option to determine the number of retention days from the date
"^DD",2006.1,2006.1,9,21,10,0)
of creation of the DICOM messages that were sent to commercial PACS.
"^DD",2006.1,2006.1,9,21,11,0)
 
"^DD",2006.1,2006.1,9,21,12,0)
3) This field is used by the Purge Old HL7 Transaction Global Nodes
"^DD",2006.1,2006.1,9,21,13,0)
menu option to determine the number of retention days from the date
"^DD",2006.1,2006.1,9,21,14,0)
of creation of the HL7 messages sent from VistA to the DICOM Text Gateway.
"^DD",2006.1,2006.1,9,21,15,0)
                                
"^DD",2006.1,2006.1,9,21,16,0)
This value may be overridden by the user when executing any of these 
"^DD",2006.1,2006.1,9,21,17,0)
menu options.
"^DD",2006.1,2006.1,9,"DT")
3110208
"^DD",2006.1,2006.1,10,0)
SERVER TASK^NJ10,0^^1;7^K:+X'=X!(X>9999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.1,2006.1,10,1,0)
^.1
"^DD",2006.1,2006.1,10,1,1,0)
2006.1^AE^MUMPS
"^DD",2006.1,2006.1,10,1,1,1)
D SAME^MAGDRPC2(1,DA,1,7,X)
"^DD",2006.1,2006.1,10,1,1,2)
D SAME^MAGDRPC2(0,DA,1,7,X)
"^DD",2006.1,2006.1,10,1,1,"%D",0)
^^3^3^3051025^
"^DD",2006.1,2006.1,10,1,1,"%D",1,0)
This MUMPS cross reference is really a trigger that causes
"^DD",2006.1,2006.1,10,1,1,"%D",2,0)
the values for this field to be the same for all entries
"^DD",2006.1,2006.1,10,1,1,"%D",3,0)
in the Imaging Site Parameter file.
"^DD",2006.1,2006.1,10,1,1,"DT")
3051025
"^DD",2006.1,2006.1,10,3)
Enter the task number for the monthly site report, type a number between 0 and 9999999999, 0 Decimal Digits
"^DD",2006.1,2006.1,10,21,0)
^.001^9^9^3100308^^^
"^DD",2006.1,2006.1,10,21,1,0)
This field identifies the Kernel scheduled task number for the
"^DD",2006.1,2006.1,10,21,2,0)
monthly site report.  The Background Processor Monitor utility
"^DD",2006.1,2006.1,10,21,3,0)
(menu option [MAGQ BPMONITOR]) reads and updates this field 
"^DD",2006.1,2006.1,10,21,4,0)
when verifying the monthly site report has been tasked or 
"^DD",2006.1,2006.1,10,21,5,0)
re-tasked by this utility.
"^DD",2006.1,2006.1,10,21,6,0)
 
"^DD",2006.1,2006.1,10,21,7,0)
This automated process reports version and Imaging system 
"^DD",2006.1,2006.1,10,21,8,0)
statusback to the development site in order to serve the site 
"^DD",2006.1,2006.1,10,21,9,0)
better.
"^DD",2006.1,2006.1,10,"DT")
3051025
"^DD",2006.1,2006.1,11,0)
PERCENT SERVER RESERVE^NJ2,0X^^1;8^K:+X'=X!(X>50)!(X<1)!(X?.E1"."1N.N) X
"^DD",2006.1,2006.1,11,3)
Enter the free space percentage, type a number between 1 and 50, 0 Decimal Digits
"^DD",2006.1,2006.1,11,21,0)
^.001^7^7^3100308^^^
"^DD",2006.1,2006.1,11,21,1,0)
This field allows sites to increase the amount of space that 
"^DD",2006.1,2006.1,11,21,2,0)
is maintained in reserve for each individual Image server share.  
"^DD",2006.1,2006.1,11,21,3,0)
The minimum value is 1. The default value is 5.  
"^DD",2006.1,2006.1,11,21,4,0)
The RPC, MAGQ FS CHNGE, uses this value to determine the RAID 
"^DD",2006.1,2006.1,11,21,5,0)
Group advance and is part of the automatic Purge algorithm.  
"^DD",2006.1,2006.1,11,21,6,0)
When this value cannot be maintained, a CRITICAL LOW MESSAGE 
"^DD",2006.1,2006.1,11,21,7,0)
is triggered. 
"^DD",2006.1,2006.1,11,"DT")
3050608
"^DD",2006.1,2006.1,11.9,0)
DATE OF LAST CRITICAL MESSAGE^DO^^3;11^S %DT="ESTR" D ^%DT S X=Y K:Y<1 X
"^DD",2006.1,2006.1,11.9,2)
S Y(0)=Y S Y=$$FMTE^XLFDT(Y,"5D")
"^DD",2006.1,2006.1,11.9,2.1)
S Y=$$FMTE^XLFDT(Y,"5D")
"^DD",2006.1,2006.1,11.9,3)
This date/time field is automatically set each time a critical message is sent.
"^DD",2006.1,2006.1,11.9,21,0)
^.001^4^4^3100308^^^^
"^DD",2006.1,2006.1,11.9,21,1,0)
It is a parameter used in combination with the CRITICAL LOW MESSAGE
"^DD",2006.1,2006.1,11.9,21,2,0)
INTERVAL to determine if it is appropriate to send a new message 
"^DD",2006.1,2006.1,11.9,21,3,0)
when the VistA cache space falls below the PERCENT SERVER RESERVE
"^DD",2006.1,2006.1,11.9,21,4,0)
value. This field should not be edited directly by a user.
"^DD",2006.1,2006.1,11.9,"DT")
3080814
"^DD",2006.1,2006.1,12,0)
FILE TYPES^2006.112^^2;0
"^DD",2006.1,2006.1,12,21,0)
^.001^3^3^3100308^^^^
"^DD",2006.1,2006.1,12,21,1,0)
This field identifies acceptable file types on image captures and is read 
"^DD",2006.1,2006.1,12,21,2,0)
by the Background Processor to migrate files across the network shares 
"^DD",2006.1,2006.1,12,21,3,0)
and jukeboxes.
"^DD",2006.1,2006.1,12.5,0)
MULTI NAMESPACE^2006.11^^4;0
"^DD",2006.1,2006.1,12.5,21,0)
^.001^3^3^3100325^^^^
"^DD",2006.1,2006.1,12.5,21,1,0)
This multiple field is used to store all previously used image
"^DD",2006.1,2006.1,12.5,21,2,0)
prefixes from the CURRENT NAMESPACE field. Any time the CURRENT NAMESPACE
"^DD",2006.1,2006.1,12.5,21,3,0)
field is changed, enter the previous name in this multiple field.
"^DD",2006.1,2006.1,12.5,23,0)
^.001^3^3^3100325^^^^
"^DD",2006.1,2006.1,12.5,23,1,0)
This multiple field is used to store all previously used image
"^DD",2006.1,2006.1,12.5,23,2,0)
prefixes from the CURRENT NAMESPACE field. Any time the CURRENT NAMESPACE
"^DD",2006.1,2006.1,12.5,23,3,0)
field is changed, enter the previous name in this multiple field.
"^DD",2006.1,2006.1,20,0)
NO AUTOWRITE UPDATE^S^0:AUTOWRITE UPDATE OK;1:NO AUTOWRITE UPDATE;^1;10^Q
"^DD",2006.1,2006.1,20,21,0)
^.001^7^7^3100308^^^^
"^DD",2006.1,2006.1,20,21,1,0)
This field enables or disables the Background Processor function
"^DD",2006.1,2006.1,20,21,2,0)
which evaluates the space availability on each of the online magnetic
"^DD",2006.1,2006.1,20,21,3,0)
shares and assigns the current write location to the share with the 
"^DD",2006.1,2006.1,20,21,4,0)
greatest space available both for PACS and regular image capture.
"^DD",2006.1,2006.1,20,21,5,0)
 
"^DD",2006.1,2006.1,20,21,6,0)
RPC, MAGQ FS CHNGE, utilizes this field when evaluating the current
"^DD",2006.1,2006.1,20,21,7,0)
write location.
"^DD",2006.1,2006.1,20,"DT")
2980512
"^DD",2006.1,2006.1,22,0)
PURGE-RETENTION DAYS BIG FILE^NJ5,0X^^3;2^K:+X'=X!(X>99999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.1,2006.1,22,3)
Type a Number between 0 and 99999, 0 Decimal Digits
"^DD",2006.1,2006.1,22,21,0)
^.001^4^4^3100308^^^
"^DD",2006.1,2006.1,22,21,1,0)
This field is used by the Background Processor purge to determine
"^DD",2006.1,2006.1,22,21,2,0)
the number of days to retain BIG files. All BIG images that have 
"^DD",2006.1,2006.1,22,21,3,0)
not been accessed in this many days will be removed from magnetic
"^DD",2006.1,2006.1,22,21,4,0)
storage by the Background Processor purge.
"^DD",2006.1,2006.1,22,"DT")
3090211
"^DD",2006.1,2006.1,23,0)
PURGE-RETENTION DAYS ABS FILE^NJ5,0^^3;3^K:+X'=X!(X>99999)!(X<0)!(X?.E1"."1.N) X
"^DD",2006.1,2006.1,23,3)
Type a number between 0 and 99999, 0 Decimal Digits
"^DD",2006.1,2006.1,23,21,0)
^.001^4^4^3100308^^^
"^DD",2006.1,2006.1,23,21,1,0)
This field is used by the Background Processor purge to determine
"^DD",2006.1,2006.1,23,21,2,0)
the number of days to retain ABS files. All ABS images that have
"^DD",2006.1,2006.1,23,21,3,0)
not been accessed in this many days will be removed from magnetic
"^DD",2006.1,2006.1,23,21,4,0)
storage by the Background Processor purge.
"^DD",2006.1,2006.1,23,"DT")
3060614
"^DD",2006.1,2006.1,24,0)
PURGE-RETENTION DAYS PHOTOID^NJ5,0^^3;4^K:+X'=X!(X>99999)!(X<0)!(X?.E1"."1.N) X
"^DD",2006.1,2006.1,24,3)
Type a number between 0 and 99999, 0 Decimal Digits
"^DD",2006.1,2006.1,24,21,0)
^.001^5^5^3100308^^
"^DD",2006.1,2006.1,24,21,1,0)
This field is used by the Background Processor purge to determine
"^DD",2006.1,2006.1,24,21,2,0)
the number of days to retain images designate as PHOTO IDs by the
"^DD",2006.1,2006.1,24,21,3,0)
Image file. All PhotoID images that have not been accessed  in this
"^DD",2006.1,2006.1,24,21,4,0)
many days will be removed from magnetic storage by the Background 
"^DD",2006.1,2006.1,24,21,5,0)
Processor purge.
"^DD",2006.1,2006.1,24,"DT")
3090521
"^DD",2006.1,2006.1,60,0)
AUTOPURGE^S^0:OFF;1:ON;^BPPURGE;1^Q
"^DD",2006.1,2006.1,60,3)
This value is used by the Background processor to determine whether to start a purge process when the Vista Cache low water mark has been reached.
"^DD",2006.1,2006.1,60,23,0)
^.001^7^7^3100308^^^
"^DD",2006.1,2006.1,60,23,1,0)
This enables the Background Processor the ability to launch the
"^DD",2006.1,2006.1,60,23,2,0)
Purge when the VistA RAID low water mark has been reached. This 
"^DD",2006.1,2006.1,60,23,3,0)
field is also required for the Scheduled Purge. 
"^DD",2006.1,2006.1,60,23,4,0)
 
"^DD",2006.1,2006.1,60,23,5,0)
The RPC, MAGQ FS CHNGE, evaluates this field when setting the
"^DD",2006.1,2006.1,60,23,6,0)
current write location, and is part of the automatic Purge
"^DD",2006.1,2006.1,60,23,7,0)
algorithm.
"^DD",2006.1,2006.1,60,"DT")
3081215
"^DD",2006.1,2006.1,60.1,0)
PURGE BY^S^DA:DATE ACCESSED;DC:DATE CREATED;DM:DATE MODIFIED;^BPPURGE;2^Q
"^DD",2006.1,2006.1,60.1,3)
This will determine the criteria applied to the purge logic.
"^DD",2006.1,2006.1,60.1,21,0)
^.001^3^3^3100308^^^^
"^DD",2006.1,2006.1,60.1,21,1,0)
This parameter is used by the Purge application. These date
"^DD",2006.1,2006.1,60.1,21,2,0)
criteria apply to the dates within the Master File Table of
"^DD",2006.1,2006.1,60.1,21,3,0)
the network share being purged. 
"^DD",2006.1,2006.1,60.1,"DT")
3081215
"^DD",2006.1,2006.1,60.2,0)
EXPRESS PURGE^S^0:OFF;1:ON;^BPPURGE;3^Q
"^DD",2006.1,2006.1,60.2,3)
This field enables and disables the Express purge method.
"^DD",2006.1,2006.1,60.2,21,0)
^.001^3^3^3100308^^^
"^DD",2006.1,2006.1,60.2,21,1,0)
This enables the Purge application to expedite the purge on
"^DD",2006.1,2006.1,60.2,21,2,0)
a given share if no files are actively being purged.  This works
"^DD",2006.1,2006.1,60.2,21,3,0)
with field EXPRESS PURGE RATE (#60.3).
"^DD",2006.1,2006.1,60.2,"DT")
3081215
"^DD",2006.1,2006.1,60.3,0)
EXPRESS PURGE RATE^NJ7,0^^BPPURGE;4^K:+X'=X!(X>9000000)!(X<10000)!(X?.E1"."1N.N) X
"^DD",2006.1,2006.1,60.3,3)
Enter the number of idle Image file entries to be evaluated, type a number between 10000 and 9000000.
"^DD",2006.1,2006.1,60.3,21,0)
^.001^2^2^3100308^^^
"^DD",2006.1,2006.1,60.3,21,1,0)
This value determines if there is enough idle purge activity
"^DD",2006.1,2006.1,60.3,21,2,0)
on a share to cease processing on the share.  
"^DD",2006.1,2006.1,60.3,"DT")
3090218
"^DD",2006.1,2006.1,60.4,0)
LAST PURGE BPWS^P2006.8'^MAG(2006.8,^BPPURGE;5^Q
"^DD",2006.1,2006.1,60.4,3)
This is the last BP Server to run a purge.
"^DD",2006.1,2006.1,60.4,23,0)
^^8^8^3100308^
"^DD",2006.1,2006.1,60.4,23,1,0)
This field references the BP Server that executed the Purge
"^DD",2006.1,2006.1,60.4,23,2,0)
process and therefore has the log files that document that 
"^DD",2006.1,2006.1,60.4,23,3,0)
activity.  The intention of this field is to assist the support
"^DD",2006.1,2006.1,60.4,23,4,0)
staff in locating the BP Purge activity log files for the 
"^DD",2006.1,2006.1,60.4,23,5,0)
last purge.
"^DD",2006.1,2006.1,60.4,23,6,0)
 
"^DD",2006.1,2006.1,60.4,23,7,0)
This field is updated by the BP Purge application when it 
"^DD",2006.1,2006.1,60.4,23,8,0)
completes the purge activity.
"^DD",2006.1,2006.1,60.4,"DT")
3081215
"^DD",2006.1,2006.1,60.5,0)
RAID PURGE FACTOR^NJ3,0^^BPPURGE;8^K:+X'=X!(X>100)!(X<0)!(X?.E1"."1.N) X
"^DD",2006.1,2006.1,60.5,3)
Type a number between 0 and 100, 0 Decimal Digits
"^DD",2006.1,2006.1,60.5,21,0)
^.001^6^6^3100308^^^
"^DD",2006.1,2006.1,60.5,21,1,0)
This factor (a number between 0 and 100), when multiplied by 
"^DD",2006.1,2006.1,60.5,21,2,0)
the Percent Server Reserve (#11), determines the automatic 
"^DD",2006.1,2006.1,60.5,21,3,0)
purge event triggered by the BP Queue Processor.
"^DD",2006.1,2006.1,60.5,21,4,0)
 
"^DD",2006.1,2006.1,60.5,21,5,0)
The RPC, MAGQ FS CHNGE, uses this value and is part of the
"^DD",2006.1,2006.1,60.5,21,6,0)
automatic Purge algorithm.
"^DD",2006.1,2006.1,60.5,"DT")
3090218
"^DD",2006.1,2006.1,61,0)
SCHEDULED PURGE^S^0:OFF;1:ON;^BPPURGE;6^Q
"^DD",2006.1,2006.1,61,3)
This value is used to determine whether the BP Queue Processor will trigger a purge process on a scheduled frequency.
"^DD",2006.1,2006.1,61,21,0)
^.001^5^5^3100308^^^^
"^DD",2006.1,2006.1,61,21,1,0)
This field is used to determine whether the BP Queue Processor
"^DD",2006.1,2006.1,61,21,2,0)
enables a scheduled purge process. The frequency is determined
"^DD",2006.1,2006.1,61,21,3,0)
by the frequency days and the date of the last purge. A default
"^DD",2006.1,2006.1,61,21,4,0)
value of 28 days is used if the frequency value is null.  A 
"^DD",2006.1,2006.1,61,21,5,0)
default value of 2400 hours is used if the PURGE TIME is not set.
"^DD",2006.1,2006.1,61,"DT")
3081215
"^DD",2006.1,2006.1,61.1,0)
DATE OF LAST PURGE^DXO^^BPPURGE;7^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",2006.1,2006.1,61.1,2)
S Y(0)=Y S Y=$$FMTE^XLFDT(Y,"5D")
"^DD",2006.1,2006.1,61.1,2.1)
S Y=$$FMTE^XLFDT(Y,"5D")
"^DD",2006.1,2006.1,61.1,3)
Last scheduled purge date. (This is not a user editable field.)
"^DD",2006.1,2006.1,61.1,21,0)
^.001^2^2^3100308^^^
"^DD",2006.1,2006.1,61.1,21,1,0)
This is the date of a last scheduled purge process was executed
"^DD",2006.1,2006.1,61.1,21,2,0)
and is automatically set at the beginning of a scheduled purge.
"^DD",2006.1,2006.1,61.1,23,0)
^^2^2^3100308^
"^DD",2006.1,2006.1,61.1,23,1,0)
This parameter is used by RPC, MAGQ FS CHNGE,when evaluating
"^DD",2006.1,2006.1,61.1,23,2,0)
Scheduled Purge.
"^DD",2006.1,2006.1,61.1,"DT")
3081219
"^DD",2006.1,2006.1,61.2,0)
SCHEDULED PURGE FREQUENCY^NJ3,0^^BPPURGE;9^K:+X'=X!(X>365)!(X<1)!(X?.E1"."1N.N) X
"^DD",2006.1,2006.1,61.2,3)
Type a number between 1 and 365 days. 
"^DD",2006.1,2006.1,61.2,21,0)
^.001^3^3^3100308^^^
"^DD",2006.1,2006.1,61.2,21,1,0)
When the Scheduled Purge process is enabled, this value in days 
"^DD",2006.1,2006.1,61.2,21,2,0)
(between 1 and 365) is added to the date of the last purge for 
"^DD",2006.1,2006.1,61.2,21,3,0)
the BP Queue Processor to evaluate for launching a purge process.
"^DD",2006.1,2006.1,61.2,"DT")
3081215
"^DD",2006.1,2006.1,61.3,0)
DATE OF SCHEDULED PURGE^DXO^^BPPURGE;10^S %DT="E" D ^%DT S X=Y K:Y<1 X Q:'$P($G(^MAG(2006.1,DA,"BPPURGE")),U,6)  K:(Y<$P($$NOW^XLFDT,".")) X
"^DD",2006.1,2006.1,61.3,2)
S Y(0)=Y S Y=$$FMTE^XLFDT(Y,"5D")
"^DD",2006.1,2006.1,61.3,2.1)
S Y=$$FMTE^XLFDT(Y,"5D")
"^DD",2006.1,2006.1,61.3,3)
The date may not be to earlier than today.
"^DD",2006.1,2006.1,61.3,21,0)
^.001^4^4^3100308^^^
"^DD",2006.1,2006.1,61.3,21,1,0)
This is the scheduled date of the next scheduled purge.  It is
"^DD",2006.1,2006.1,61.3,21,2,0)
set at the end of an automated purge by adding the SCHEDULE PURGE
"^DD",2006.1,2006.1,61.3,21,3,0)
FREQUENCY (#61.2) parameter to the date of the last purge.  It may
"^DD",2006.1,2006.1,61.3,21,4,0)
be set by the user to establish a new schedule.
"^DD",2006.1,2006.1,61.3,23,0)
^.001^2^2^3100308^^
"^DD",2006.1,2006.1,61.3,23,1,0)
This parameter is used by RPC MAGQ FS CHNGE when evaluating
"^DD",2006.1,2006.1,61.3,23,2,0)
a scheduled purge. 
"^DD",2006.1,2006.1,61.3,"DT")
3090106
"^DD",2006.1,2006.1,61.4,0)
SCHEDULED PURGE TIME^NJ4,0X^^BPPURGE;11^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>2359)!(X<0) X
"^DD",2006.1,2006.1,61.4,3)
Type a Number between 0 and 2359 (military time).
"^DD",2006.1,2006.1,61.4,21,0)
^.001^5^5^3100308^^^
"^DD",2006.1,2006.1,61.4,21,1,0)
This number (between 0 and 2359) for military time determines
"^DD",2006.1,2006.1,61.4,21,2,0)
the time of day to trigger the Scheduled Purge.  If this number
"^DD",2006.1,2006.1,61.4,21,3,0)
is undefined, the BP Queue Processor uses the default value of 0
"^DD",2006.1,2006.1,61.4,21,4,0)
if the Scheduled Purge option is enabled and the frequency days
"^DD",2006.1,2006.1,61.4,21,5,0)
plus date of last purge threshold are reached.
"^DD",2006.1,2006.1,61.4,23,0)
^.001^2^2^3100308^^
"^DD",2006.1,2006.1,61.4,23,1,0)
This time is used by RPC, MAGQ FS CHNGE, when evaluating
"^DD",2006.1,2006.1,61.4,23,2,0)
scheduled purge. 
"^DD",2006.1,2006.1,61.4,"DT")
3081215
"^DD",2006.1,2006.1,62,0)
SCHEDULED VERIFIER^S^0:OFF;1:ON;^BPVERIFIER;1^Q
"^DD",2006.1,2006.1,62,3)
This value is monitored by the BP Queue processor to determine if scheduled BP Verifier. 
"^DD",2006.1,2006.1,62,21,0)
^.001^2^2^3100308^^^
"^DD",2006.1,2006.1,62,21,1,0)
This field is used to determine whether the BP Queue Processor
"^DD",2006.1,2006.1,62,21,2,0)
enables a scheduled verifier process.
"^DD",2006.1,2006.1,62,23,0)
^.001^2^2^3100308^^
"^DD",2006.1,2006.1,62,23,1,0)
This parameter is used by RPC, MAGQ FS CHNGE, when evaluating
"^DD",2006.1,2006.1,62,23,2,0)
scheduled verifier process logic.
"^DD",2006.1,2006.1,62,"DT")
3081219
"^DD",2006.1,2006.1,62.1,0)
DATE OF LAST VERIFY^DO^^BPVERIFIER;2^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",2006.1,2006.1,62.1,2)
S Y(0)=Y S Y=$$FMTE^XLFDT(Y,"5D")
"^DD",2006.1,2006.1,62.1,2.1)
S Y=$$FMTE^XLFDT(Y,"5D")
"^DD",2006.1,2006.1,62.1,3)
Last scheduled verifier date.  (This is not a user editable field.)
"^DD",2006.1,2006.1,62.1,21,0)
^.001^3^3^3100308^^^
"^DD",2006.1,2006.1,62.1,21,1,0)
This is the date of a last scheduled verifier application and
"^DD",2006.1,2006.1,62.1,21,2,0)
is automatically set at the beginning of a scheduled verifier
"^DD",2006.1,2006.1,62.1,21,3,0)
execution. 
"^DD",2006.1,2006.1,62.1,23,0)
^.001^2^2^3100308^^
"^DD",2006.1,2006.1,62.1,23,1,0)
This parameter is used by RPC, MAGQ FS CHNGE, when evaluating
"^DD",2006.1,2006.1,62.1,23,2,0)
scheduled verifier.
"^DD",2006.1,2006.1,62.1,"DT")
3081219
"^DD",2006.1,2006.1,62.2,0)
SCHEDULED VERIFIER FREQUENCY^NJ3,0^^BPVERIFIER;3^K:+X'=X!(X>365)!(X<1)!(X?.E1"."1N.N) X
"^DD",2006.1,2006.1,62.2,3)
Type a number between 1 and 365 days.
"^DD",2006.1,2006.1,62.2,21,0)
^.001^4^4^3100308^^^
"^DD",2006.1,2006.1,62.2,21,1,0)
When the Scheduled Verifier process is enabled, this number
"^DD",2006.1,2006.1,62.2,21,2,0)
in days (between 1 and 365) is added to the date of the last
"^DD",2006.1,2006.1,62.2,21,3,0)
verify for the BP Queue Processor to evaluate in launching
"^DD",2006.1,2006.1,62.2,21,4,0)
a verify process.
"^DD",2006.1,2006.1,62.2,23,0)
^.001^2^2^3100308^^
"^DD",2006.1,2006.1,62.2,23,1,0)
This parameter is used by RPC, MAGQ FS CHNGE, when evaluating
"^DD",2006.1,2006.1,62.2,23,2,0)
scheduled verifier process logic.
"^DD",2006.1,2006.1,62.2,"DT")
3081219
"^DD",2006.1,2006.1,62.3,0)
DATE OF SCHEDULED VERIFIER^DXO^^BPVERIFIER;4^S %DT="E" D ^%DT S X=Y K:Y<1 X Q:'$P($G(^MAG(2006.1,DA,"BPVERIFIER")),U,1)  K:(Y<$P($$NOW^XLFDT,".")) X
"^DD",2006.1,2006.1,62.3,2)
S Y(0)=Y S Y=$$FMTE^XLFDT(Y,"5D")
"^DD",2006.1,2006.1,62.3,2.1)
S Y=$$FMTE^XLFDT(Y,"5D")
"^DD",2006.1,2006.1,62.3,3)
This should be date in the future to run your next Verifier process.
"^DD",2006.1,2006.1,62.3,21,0)
^.001^4^4^3100308^^
"^DD",2006.1,2006.1,62.3,21,1,0)
This is evaluated by active BP Processors to trigger a BP
"^DD",2006.1,2006.1,62.3,21,2,0)
Verifier process at the date and time designated by the user.
"^DD",2006.1,2006.1,62.3,21,3,0)
In conjunction with the SCHEDULED VERIFER time, this field 
"^DD",2006.1,2006.1,62.3,21,4,0)
co-defines the timing of this process.
"^DD",2006.1,2006.1,62.3,"DT")
3090106
"^DD",2006.1,2006.1,62.4,0)
SCHEDULED VERIFIER TIME^NJ4,0X^^BPVERIFIER;5^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>2359)!(X<0) X
"^DD",2006.1,2006.1,62.4,3)
Type a Number between 0 and 2359 (military time).
"^DD",2006.1,2006.1,62.4,21,0)
^.001^5^5^3100308^^^
"^DD",2006.1,2006.1,62.4,21,1,0)
This number (between 0 and 2359) for military time is used to
"^DD",2006.1,2006.1,62.4,21,2,0)
determine the time of the day to trigger the Scheduled Verifier. 
"^DD",2006.1,2006.1,62.4,21,3,0)
If this number is undefined, the BP Verifier uses the default 
"^DD",2006.1,2006.1,62.4,21,4,0)
value of 0 if the Scheduled Verify option is enabled and the 
"^DD",2006.1,2006.1,62.4,21,5,0)
frequency days plus date of last verify threshold are reached.
"^DD",2006.1,2006.1,62.4,23,0)
^.001^2^2^3100308^^
"^DD",2006.1,2006.1,62.4,23,1,0)
This parameter is used by RPC, MAGQ FS CHNGE, when evaluating
"^DD",2006.1,2006.1,62.4,23,2,0)
scheduled verifier.
"^DD",2006.1,2006.1,62.4,"DT")
3081219
"^DD",2006.1,2006.1,62.5,0)
LAST VERIFY BP WS^P2006.8'^MAG(2006.8,^BPVERIFIER;6^Q
"^DD",2006.1,2006.1,62.5,3)
Last BP Server that exected the Verifier process.
"^DD",2006.1,2006.1,62.5,21,0)
^.001^5^5^3100308^^^
"^DD",2006.1,2006.1,62.5,21,1,0)
This field references the BP Server that executed the Verifier
"^DD",2006.1,2006.1,62.5,21,2,0)
process and therefore has the log files that document that 
"^DD",2006.1,2006.1,62.5,21,3,0)
activity.  The intention of this field is to assist the support
"^DD",2006.1,2006.1,62.5,21,4,0)
staff in locating the BP Verifier activity log files for the 
"^DD",2006.1,2006.1,62.5,21,5,0)
last purge.
"^DD",2006.1,2006.1,62.5,23,0)
^.001^2^2^3100308^^
"^DD",2006.1,2006.1,62.5,23,1,0)
This field is updated by the BP Purge application when
"^DD",2006.1,2006.1,62.5,23,2,0)
it completes the purge activity.
"^DD",2006.1,2006.1,62.5,"DT")
3081219
"^DD",2006.1,2006.1,62.6,0)
SCHEDULED VERIFY TEXT CHECK^S^0:NO;1:YES;^BPVERIFIER;7^Q
"^DD",2006.1,2006.1,62.6,3)
This value controls whether the scheduled Verifier will check the RAID TXT files.
"^DD",2006.1,2006.1,62.6,21,0)
^.001^2^2^3100308^^^
"^DD",2006.1,2006.1,62.6,21,1,0)
This field enables the BP Verifier to validate the RAID text files
"^DD",2006.1,2006.1,62.6,21,2,0)
for patient identification consistencies.
"^DD",2006.1,2006.1,62.6,"DT")
3090407
"^DD",2006.1,2006.1,63,0)
SCHEDULED RG ADVANCE^S^0:OFF;1:ON;^RGADVANCE;1^Q
"^DD",2006.1,2006.1,63,3)
This switch enables the schedule RAID group advance.
"^DD",2006.1,2006.1,63,21,0)
^.001^4^4^3100308^^^^
"^DD",2006.1,2006.1,63,21,1,0)
This field enables the automatic RAID Group Advance.  It is
"^DD",2006.1,2006.1,63,21,2,0)
necessary to set the date of the next RG ADVANCE DATE (63.3)
"^DD",2006.1,2006.1,63,21,3,0)
and the RG ADVANCE TIME (63.4).  If the RG ADVANCE TIME is 
"^DD",2006.1,2006.1,63,21,4,0)
null, the default is 0.
"^DD",2006.1,2006.1,63,23,0)
^.001^8^8^3100308^^^
"^DD",2006.1,2006.1,63,23,1,0)
The BP Queue Processor advances the current RAID Group during 
"^DD",2006.1,2006.1,63,23,2,0)
the RPC MAGQ FS CHNGE execution. 
"^DD",2006.1,2006.1,63,23,3,0)
The RAID Group advance feature will change the Current RAID 
"^DD",2006.1,2006.1,63,23,4,0)
group (#.031) under the following conditions:
"^DD",2006.1,2006.1,63,23,5,0)
A)  AutoWrite (#20)) is enabled.
"^DD",2006.1,2006.1,63,23,6,0)
B)  The current RAID Group has reached the watermark (#11).
"^DD",2006.1,2006.1,63,23,7,0)
C)  There is enough space in an alternative RAID Group.
"^DD",2006.1,2006.1,63,23,8,0)
D)  The event can be schedule to occur (#63).
"^DD",2006.1,2006.1,63,"DT")
3081219
"^DD",2006.1,2006.1,63.1,0)
RG ADVANCE FREQUENCY^NJ3,0^^RGADVANCE;2^K:+X'=X!(X>365)!(X<1)!(X?.E1"."1N.N) X
"^DD",2006.1,2006.1,63.1,3)
Type a Number between 1 and 365 days.
"^DD",2006.1,2006.1,63.1,21,0)
^.001^3^3^3100308^^^^
"^DD",2006.1,2006.1,63.1,21,1,0)
This number in days (between 1 and 365) and the RG ADVANCE
"^DD",2006.1,2006.1,63.1,21,2,0)
TIME determine the date and time of the next scheduled RAID
"^DD",2006.1,2006.1,63.1,21,3,0)
Group Advance. 
"^DD",2006.1,2006.1,63.1,"DT")
3081219
"^DD",2006.1,2006.1,63.2,0)
DATE OF LAST RG ADVANCE^DO^^RGADVANCE;3^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",2006.1,2006.1,63.2,2)
S Y(0)=Y S Y=$$FMTE^XLFDT(Y,"5D")
"^DD",2006.1,2006.1,63.2,2.1)
S Y=$$FMTE^XLFDT(Y,"5D")
"^DD",2006.1,2006.1,63.2,3)
Last scheduled RAID Group Advance execution date. (This is not a user editable field.)
"^DD",2006.1,2006.1,63.2,21,0)
^.001^3^3^3100308^^^
"^DD",2006.1,2006.1,63.2,21,1,0)
This is the date of the last scheduled RAID Group Advance was
"^DD",2006.1,2006.1,63.2,21,2,0)
executed and is automatically set at the beginning of a RAID
"^DD",2006.1,2006.1,63.2,21,3,0)
Group Advance execution. 
"^DD",2006.1,2006.1,63.2,23,0)
^.001^2^2^3100308^^
"^DD",2006.1,2006.1,63.2,23,1,0)
This parameter is used by RPC, MAGQ FS CHNGE, when evaluating
"^DD",2006.1,2006.1,63.2,23,2,0)
scheduled RAID Group Advance.
"^DD",2006.1,2006.1,63.2,"DT")
3081219
"^DD",2006.1,2006.1,63.3,0)
RG ADVANCE DATE^DXO^^RGADVANCE;4^S %DT="E" D ^%DT S X=Y K:Y<1 X Q:'$P($G(^MAG(2006.1,DA,"RGADVANCE")),U,1)  K:(Y<$P($$NOW^XLFDT,".")) X K:Y<1 X
"^DD",2006.1,2006.1,63.3,2)
S Y(0)=Y S Y=$$FMTE^XLFDT(Y,"5D")
"^DD",2006.1,2006.1,63.3,2.1)
S Y=$$FMTE^XLFDT(Y,"5D")
"^DD",2006.1,2006.1,63.3,3)
The date may not be to earlier than today.
"^DD",2006.1,2006.1,63.3,21,0)
^.001^2^2^3100308^^^
"^DD",2006.1,2006.1,63.3,21,1,0)
This is the scheduled date (today or later) of the next
"^DD",2006.1,2006.1,63.3,21,2,0)
RAID GROUP advance.  
"^DD",2006.1,2006.1,63.3,23,0)
^.001^2^2^3100308^^
"^DD",2006.1,2006.1,63.3,23,1,0)
This parameter is used by the RPC MAGQ FS CHNGE procedure
"^DD",2006.1,2006.1,63.3,23,2,0)
during the evaluation for scheduling the RG Advance process. 
"^DD",2006.1,2006.1,63.3,"DT")
3090106
"^DD",2006.1,2006.1,63.4,0)
RG ADVANCE TIME^NJ4,0^^RGADVANCE;5^K:+X'=X!(X>2359)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.1,2006.1,63.4,3)
Type a number between 0 and 2359 (military time).
"^DD",2006.1,2006.1,63.4,21,0)
^.001^6^6^3100308^^^^
"^DD",2006.1,2006.1,63.4,21,1,0)
This number (between 0 and 2359) for military time is the
"^DD",2006.1,2006.1,63.4,21,2,0)
time of day of the RAID Group advance function. If this number
"^DD",2006.1,2006.1,63.4,21,3,0)
is undefined, the BP Queue Processor uses the default value 
"^DD",2006.1,2006.1,63.4,21,4,0)
of 0 if the Scheduled RAID Group Advance option is enabled 
"^DD",2006.1,2006.1,63.4,21,5,0)
and the frequency days plus date of last RAID Group Advance
"^DD",2006.1,2006.1,63.4,21,6,0)
threshold are reached.
"^DD",2006.1,2006.1,63.4,23,0)
^.001^2^2^3100308^^^
"^DD",2006.1,2006.1,63.4,23,1,0)
This field is used by the RPC MAGQ FS CHNGE procedure
"^DD",2006.1,2006.1,63.4,23,2,0)
during the evaluation for scheduling the RG Advance process.
"^DD",2006.1,2006.1,63.4,"DT")
3100223
"^DD",2006.1,2006.1,66,0)
BP MAIL MESSAGE^2006.166A^^6;0
"^DD",2006.1,2006.1,66,21,0)
^.001^3^3^3100308^^^^
"^DD",2006.1,2006.1,66,21,1,0)
This table allows each Imaging site to manage the local distribution
"^DD",2006.1,2006.1,66,21,2,0)
of all BP Queue Processor messages as well as the monthly and ad
"^DD",2006.1,2006.1,66,21,3,0)
hoc site usage reports.
"^DD",2006.1,2006.1,103,0)
RETENTION DAYS DICOM MSGS^NJ5,0^^3;6^K:+X'=X!(X>99999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.1,2006.1,103,.1)
Number of days to retain DICOM messages
"^DD",2006.1,2006.1,103,3)
Enter the number of days (between 0 and 99999) that DICOM messages are to be retained on the DICOM Gateway(s). 
"^DD",2006.1,2006.1,103,21,0)
^.001^4^4^3100308^^^^
"^DD",2006.1,2006.1,103,21,1,0)
The value of this parameter is the number of days that DICOM
"^DD",2006.1,2006.1,103,21,2,0)
messages are to be retained.
"^DD",2006.1,2006.1,103,21,3,0)
The subroutine that purges old DICOM messages will only remove
"^DD",2006.1,2006.1,103,21,4,0)
messages that are older than this number of days.
"^DD",2006.1,2006.1,103,"DT")
2991130
"^DD",2006.1,2006.1,124,0)
DICOM GATEWAY ACCESS CODE^FXO^^GW;1^K:$L(X)>30!($L(X)<3) X Q:'$D(X)  S X=$$ENCRYP^ROUTINE(X)
"^DD",2006.1,2006.1,124,1,0)
^.1
"^DD",2006.1,2006.1,124,1,1,0)
2006.1^AC^MUMPS
"^DD",2006.1,2006.1,124,1,1,1)
D SAME^MAGDRPC2(1,DA,"GW",1,X)
"^DD",2006.1,2006.1,124,1,1,2)
D SAME^MAGDRPC2(0,DA,"GW",1,X)
"^DD",2006.1,2006.1,124,1,1,"%D",0)
^.101^3^3^3051025^^^
"^DD",2006.1,2006.1,124,1,1,"%D",1,0)
This MUMPS cross reference is really a trigger that causes
"^DD",2006.1,2006.1,124,1,1,"%D",2,0)
the values for this field to be the same for all entries
"^DD",2006.1,2006.1,124,1,1,"%D",3,0)
in the Imaging Site Parameter file.
"^DD",2006.1,2006.1,124,1,1,"DT")
3031120
"^DD",2006.1,2006.1,124,2)
S Y(0)=Y S Y="<hidden>"
"^DD",2006.1,2006.1,124,2.1)
S Y="<hidden>"
"^DD",2006.1,2006.1,124,3)
Enter the access code that DICOM Gateways may use.
"^DD",2006.1,2006.1,124,21,0)
^.001^7^7^3100308^^
"^DD",2006.1,2006.1,124,21,1,0)
The value of this field is a string that may be used by a
"^DD",2006.1,2006.1,124,21,2,0)
DICOM Gateway when it needs to provide an ACCESS CODE to the
"^DD",2006.1,2006.1,124,21,3,0)
VistA system.
"^DD",2006.1,2006.1,124,21,4,0)
 
"^DD",2006.1,2006.1,124,21,5,0)
This field is also used for auto-login for the BP Queue 
"^DD",2006.1,2006.1,124,21,6,0)
Processor, Purge and Verifier applications. This value is 
"^DD",2006.1,2006.1,124,21,7,0)
stored encrypted.
"^DD",2006.1,2006.1,124,"DT")
3031120
"^DD",2006.1,2006.1,125,0)
DICOM GATEWAY VERIFY CODE^FXO^^GW;2^K:$L(X)>30!($L(X)<3) X Q:'$D(X)  S X=$$ENCRYP^ROUTINE(X)
"^DD",2006.1,2006.1,125,1,0)
^.1
"^DD",2006.1,2006.1,125,1,1,0)
2006.1^AD^MUMPS
"^DD",2006.1,2006.1,125,1,1,1)
D SAME^MAGDRPC2(1,DA,"GW",2,X)
"^DD",2006.1,2006.1,125,1,1,2)
D SAME^MAGDRPC2(0,DA,"GW",2,X)
"^DD",2006.1,2006.1,125,1,1,"%D",0)
^^3^3^3031120^
"^DD",2006.1,2006.1,125,1,1,"%D",1,0)
This MUMPS cross reference is really a trigger that causes
"^DD",2006.1,2006.1,125,1,1,"%D",2,0)
the values for this field to be the same for all entries
"^DD",2006.1,2006.1,125,1,1,"%D",3,0)
in the Imaging Site Parameter file.
"^DD",2006.1,2006.1,125,1,1,"DT")
3031120
"^DD",2006.1,2006.1,125,2)
S Y(0)=Y S Y="<hidden>"
"^DD",2006.1,2006.1,125,2.1)
S Y="<hidden>"
"^DD",2006.1,2006.1,125,3)
Enter the verify code that DICOM Gateways may use.
"^DD",2006.1,2006.1,125,21,0)
^.001^7^7^3100308^^^^
"^DD",2006.1,2006.1,125,21,1,0)
The value of this field is a string that may be used by a
"^DD",2006.1,2006.1,125,21,2,0)
DICOM Gateway when it needs to provide a VERIFY CODE to a
"^DD",2006.1,2006.1,125,21,3,0)
VistA system.
"^DD",2006.1,2006.1,125,21,4,0)
 
"^DD",2006.1,2006.1,125,21,5,0)
This field is also used for auto-login for the BP Queue 
"^DD",2006.1,2006.1,125,21,6,0)
Processor, Purge and Verifier applications. This value is
"^DD",2006.1,2006.1,125,21,7,0)
stored encrypted.
"^DD",2006.1,2006.1,125,"DT")
3031120
"^DD",2006.1,2006.11,0)
MULTI NAMESPACE SUB-FIELD^^.01^1
"^DD",2006.1,2006.11,0,"DT")
3100325
"^DD",2006.1,2006.11,0,"IX","B",2006.11,.01)

"^DD",2006.1,2006.11,0,"NM","MULTI NAMESPACE")

"^DD",2006.1,2006.11,0,"UP")
2006.1
"^DD",2006.1,2006.11,.01,0)
MULTI NAMESPACE^MF^^0;1^S X=$$UPPER^MAGQE4(X) K:($L(X)>45)!($L(X)<1)!($D(^MAG(2006.1,DA(1),4,"B",X))) X
"^DD",2006.1,2006.11,.01,1,0)
^.1
"^DD",2006.1,2006.11,.01,1,1,0)
2006.11^B
"^DD",2006.1,2006.11,.01,1,1,1)
S ^MAG(2006.1,DA(1),4,"B",$E(X,1,30),DA)=""
"^DD",2006.1,2006.11,.01,1,1,2)
K ^MAG(2006.1,DA(1),4,"B",$E(X,1,30),DA)
"^DD",2006.1,2006.11,.01,3)
Answer must be 1-45 characters in length
"^DD",2006.1,2006.11,.01,21,0)
^.001^4^4^3100325^^^
"^DD",2006.1,2006.11,.01,21,1,0)
This multiple field is used to store all previously used image 
"^DD",2006.1,2006.11,.01,21,2,0)
prefixes from the CURRENT NAMESPACE field. Any time the 
"^DD",2006.1,2006.11,.01,21,3,0)
CURRENT NAMESPACE field is changed, enter the previous name 
"^DD",2006.1,2006.11,.01,21,4,0)
in this multiple field.
"^DD",2006.1,2006.11,.01,23,0)
^.001^3^3^3100325^^^^
"^DD",2006.1,2006.11,.01,23,1,0)
This multiple field is used to store all previously used image
"^DD",2006.1,2006.11,.01,23,2,0)
prefixes from the CURRENT NAMESPACE field. Any time the CURRENT NAMESPACE
"^DD",2006.1,2006.11,.01,23,3,0)
field is changed, enter the previous name in this multiple field.
"^DD",2006.1,2006.11,.01,"DT")
3100325
"^DD",2006.1,2006.112,0)
FILE TYPES SUB-FIELD^^.01^1
"^DD",2006.1,2006.112,0,"NM","FILE TYPES")

"^DD",2006.1,2006.112,.01,0)
FILE TYPES^MFX^^0;1^S X=$$UPPER^MAGQE4(X) K:($L(X)>3)!($L(X)<3)!($D(^MAG(2006.1,DA(1),2,"B",X))) X
"^DD",2006.1,2006.112,.01,1,0)
^.1
"^DD",2006.1,2006.112,.01,1,1,0)
2006.112^B
"^DD",2006.1,2006.112,.01,1,1,1)
S ^MAG(2006.1,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",2006.1,2006.112,.01,1,1,2)
K ^MAG(2006.1,DA(1),2,"B",$E(X,1,30),DA)
"^DD",2006.1,2006.112,.01,3)
File extensions for background copies.
"^DD",2006.1,2006.112,.01,21,0)
^.001^3^3^3100308^^
"^DD",2006.1,2006.112,.01,21,1,0)
This field identifies the acceptable file types on image captures
"^DD",2006.1,2006.112,.01,21,2,0)
and is read by the Background Processor to migrate files across
"^DD",2006.1,2006.112,.01,21,3,0)
the network share and jukeboxes.
"^DD",2006.1,2006.112,.01,"DT")
3100126
"^DD",2006.1,2006.12,0)
ASSOCIATED INSTITUTIONS SUB-FIELD^^201^2
"^DD",2006.1,2006.12,0,"NM","ASSOCIATED INSTITUTIONS")

"^DD",2006.1,2006.12,.01,0)
ASSOCIATED INSTITUTIONS^P4'X^DIC(4,^0;1^Q
"^DD",2006.1,2006.12,.01,1,0)
^.1
"^DD",2006.1,2006.12,.01,1,1,0)
2006.12^B
"^DD",2006.1,2006.12,.01,1,1,1)
S ^MAG(2006.1,DA(1),"INSTS","B",$E(X,1,30),DA)=""
"^DD",2006.1,2006.12,.01,1,1,2)
K ^MAG(2006.1,DA(1),"INSTS","B",$E(X,1,30),DA)
"^DD",2006.1,2006.12,.01,1,2,0)
2006.1^C^MUMPS
"^DD",2006.1,2006.12,.01,1,2,1)
S ^MAG(2006.1,"B",$E(X,1,30),DA(1))=""
"^DD",2006.1,2006.12,.01,1,2,2)
K ^MAG(2006.1,"B",$E(X,1,30),DA(1))
"^DD",2006.1,2006.12,.01,1,2,"%D",0)
^.101^1^1^3060127^^
"^DD",2006.1,2006.12,.01,1,2,"%D",1,0)
This associates the institution with a set of site parameters.
"^DD",2006.1,2006.12,.01,1,2,"DT")
3050520
"^DD",2006.1,2006.12,.01,3)
Select an Institution that is a member of the Medical Division file.
"^DD",2006.1,2006.12,.01,21,0)
^.001^3^3^3100308^^^^
"^DD",2006.1,2006.12,.01,21,1,0)
This field allows users to associate this institution's logon
"^DD",2006.1,2006.12,.01,21,2,0)
to an imaging site platform.  Only institutions in the Medical 
"^DD",2006.1,2006.12,.01,21,3,0)
Division file are listed.
"^DD",2006.1,2006.12,.01,"DT")
3060127
"^DD",2006.1,2006.166,0)
BP MAIL MESSAGE SUB-FIELD^^5^6
"^DD",2006.1,2006.166,0,"DT")
3100223
"^DD",2006.1,2006.166,0,"IX","B",2006.166,.01)

"^DD",2006.1,2006.166,0,"NM","BP MAIL MESSAGE")

"^DD",2006.1,2006.166,0,"UP")
2006.1
"^DD",2006.1,2006.166,.01,0)
BP MAIL MESSAGE^F^^0;1^K:$L(X)>40!($L(X)<8) X
"^DD",2006.1,2006.166,.01,1,0)
^.1
"^DD",2006.1,2006.166,.01,1,1,0)
2006.166^B
"^DD",2006.1,2006.166,.01,1,1,1)
S ^MAG(2006.1,DA(1),6,"B",$E(X,1,30),DA)=""
"^DD",2006.1,2006.166,.01,1,1,2)
K ^MAG(2006.1,DA(1),6,"B",$E(X,1,30),DA)
"^DD",2006.1,2006.166,.01,3)
Enter the Imaging Mail message subject, answer must be 8-30 characters in length.
"^DD",2006.1,2006.166,.01,21,0)
^.001^5^5^3100308^^^^
"^DD",2006.1,2006.166,.01,21,1,0)
This field is for message subject text (8-30 characters) intended
"^DD",2006.1,2006.166,.01,21,2,0)
for all Imaging applications.  The entries in this sub-file 
"^DD",2006.1,2006.166,.01,21,3,0)
namespaced by MAGxxx (where xxx is the site code) followed by the
"^DD",2006.1,2006.166,.01,21,4,0)
subject index text.  The site code facilitates sorting for 
"^DD",2006.1,2006.166,.01,21,5,0)
multi-divisional platforms.
"^DD",2006.1,2006.166,.01,"DT")
3060619
"^DD",2006.1,2006.166,1,0)
Message Interval^NJ3,0^^0;2^K:+X'=X!(X>999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.1,2006.166,1,3)
Type a number between 0 and 999 hours.
"^DD",2006.1,2006.166,1,21,0)
^.001^4^4^3100308^^^^
"^DD",2006.1,2006.166,1,21,1,0)
The Imaging mail processing method uses this number of hours
"^DD",2006.1,2006.166,1,21,2,0)
(between 0 and 999) for the message interval.  Subsequent 
"^DD",2006.1,2006.166,1,21,3,0)
messages sent within the time framed of the current time and
"^DD",2006.1,2006.166,1,21,4,0)
this parameter will not be sent.
"^DD",2006.1,2006.166,1,"DT")
3070905
"^DD",2006.1,2006.166,2,0)
Mail Group^2006.1662PA^^1;0
"^DD",2006.1,2006.166,2,21,0)
^.001^2^2^3100308^^^^
"^DD",2006.1,2006.166,2,21,1,0)
This sub-file identifies the Kernel mail group recipients
"^DD",2006.1,2006.166,2,21,2,0)
for the Imaging mail message. 
"^DD",2006.1,2006.166,3,0)
DATE OF LAST MESSAGE^D^^2;1^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",2006.1,2006.166,3,3)
(No range limit on date)
"^DD",2006.1,2006.166,3,21,0)
^.001^3^3^3100308^^^
"^DD",2006.1,2006.166,3,21,1,0)
This field is set by the Imaging mail processing method and 
"^DD",2006.1,2006.166,3,21,2,0)
contains the date of the last message sent for this Subject Text.
"^DD",2006.1,2006.166,3,21,3,0)
This field is not editable.
"^DD",2006.1,2006.166,3,"DT")
3100223
"^DD",2006.1,2006.166,4,0)
MESSAGE RECIPIENTS^2006.1664P^^3;0
"^DD",2006.1,2006.166,4,21,0)
^.001^2^2^3100308^^^^
"^DD",2006.1,2006.166,4,21,1,0)
This is the list of active Mail users to add to the recipient
"^DD",2006.1,2006.166,4,21,2,0)
list of Imaging mail messages.
"^DD",2006.1,2006.166,5,0)
SECURITY KEYS^2006.1665P^^4;0
"^DD",2006.1,2006.166,5,21,0)
^.001^3^3^3100308^^
"^DD",2006.1,2006.166,5,21,1,0)
This is a list of SECURITY KEYS whose members will be recipients
"^DD",2006.1,2006.166,5,21,2,0)
of Imaging
"^DD",2006.1,2006.166,5,21,3,0)
mail messages.
"^DD",2006.1,2006.1662,0)
Mail Group SUB-FIELD^^.01^1
"^DD",2006.1,2006.1662,0,"DT")
3100223
"^DD",2006.1,2006.1662,0,"IX","B",2006.1662,.01)

"^DD",2006.1,2006.1662,0,"NM","Mail Group")

"^DD",2006.1,2006.1662,0,"UP")
2006.166
"^DD",2006.1,2006.1662,.01,0)
Mail Group^M*P3.8^XMB(3.8,^0;1^S DIC("S")="I $E($P(^(0),U,1),1,3)[""MAG""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",2006.1,2006.1662,.01,1,0)
^.1
"^DD",2006.1,2006.1662,.01,1,1,0)
2006.1662^B
"^DD",2006.1,2006.1662,.01,1,1,1)
S ^MAG(2006.1,DA(2),6,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",2006.1,2006.1662,.01,1,1,2)
K ^MAG(2006.1,DA(2),6,DA(1),1,"B",$E(X,1,30),DA)
"^DD",2006.1,2006.1662,.01,12)
This is intended to support the Imaging "MAG" namespace.
"^DD",2006.1,2006.1662,.01,12.1)
S DIC("S")="I $E($P(^(0),U,1),1,3)[""MAG"""
"^DD",2006.1,2006.1662,.01,21,0)
^.001^3^3^3100308^^^^
"^DD",2006.1,2006.1662,.01,21,1,0)
Select the Imaging mail group to receive the mail message.
"^DD",2006.1,2006.1662,.01,21,2,0)
The Imaging MAG namespace should be used to maintain
"^DD",2006.1,2006.1662,.01,21,3,0)
database standards.  
"^DD",2006.1,2006.1662,.01,"DT")
3100223
"^DD",2006.1,2006.1664,0)
MESSAGE RECIPIENTS SUB-FIELD^^.01^1
"^DD",2006.1,2006.1664,0,"DT")
3071204
"^DD",2006.1,2006.1664,0,"IX","B",2006.1664,.01)

"^DD",2006.1,2006.1664,0,"NM","MESSAGE RECIPIENTS")

"^DD",2006.1,2006.1664,0,"UP")
2006.166
"^DD",2006.1,2006.1664,.01,0)
MESSAGE RECIPIENTS^P200'^VA(200,^0;1^Q
"^DD",2006.1,2006.1664,.01,1,0)
^.1
"^DD",2006.1,2006.1664,.01,1,1,0)
2006.1664^B
"^DD",2006.1,2006.1664,.01,1,1,1)
S ^MAG(2006.1,DA(2),6,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",2006.1,2006.1664,.01,1,1,2)
K ^MAG(2006.1,DA(2),6,DA(1),3,"B",$E(X,1,30),DA)
"^DD",2006.1,2006.1664,.01,3)
This should be an active Mail user from the New Person file.
"^DD",2006.1,2006.1664,.01,21,0)
^.001^2^2^3100308^^^
"^DD",2006.1,2006.1664,.01,21,1,0)
This field identifies individual recipients for this
"^DD",2006.1,2006.1664,.01,21,2,0)
Imaging mail message.
"^DD",2006.1,2006.1664,.01,"DT")
3090407
"^DD",2006.1,2006.1665,0)
SECURITY KEYS SUB-FIELD^^.01^1
"^DD",2006.1,2006.1665,0,"DT")
3080422
"^DD",2006.1,2006.1665,0,"IX","B",2006.1665,.01)

"^DD",2006.1,2006.1665,0,"NM","SECURITY KEYS")

"^DD",2006.1,2006.1665,0,"UP")
2006.166
"^DD",2006.1,2006.1665,.01,0)
SECURITY KEYS^P19.1'^DIC(19.1,^0;1^Q
"^DD",2006.1,2006.1665,.01,1,0)
^.1
"^DD",2006.1,2006.1665,.01,1,1,0)
2006.1665^B
"^DD",2006.1,2006.1665,.01,1,1,1)
S ^MAG(2006.1,DA(2),6,DA(1),4,"B",$E(X,1,30),DA)=""
"^DD",2006.1,2006.1665,.01,1,1,2)
K ^MAG(2006.1,DA(2),6,DA(1),4,"B",$E(X,1,30),DA)
"^DD",2006.1,2006.1665,.01,3)
Select a security key that you would have holders receive this message type.
"^DD",2006.1,2006.1665,.01,21,0)
^.001^3^3^3100308^^^^
"^DD",2006.1,2006.1665,.01,21,1,0)
This is a VistA Imaging namespace security key.  All holders
"^DD",2006.1,2006.1665,.01,21,2,0)
of this key are added to the mail message recipient list of 
"^DD",2006.1,2006.1665,.01,21,3,0)
automated VistA Imaging mail messages.
"^DD",2006.1,2006.1665,.01,"DT")
3090407
"^DD",2006.8,2006.8,.01,0)
NAME^RFX^^0;1^K:$L(X)>6!($L(X)<3) X
"^DD",2006.8,2006.8,.01,1,0)
^.1^^0
"^DD",2006.8,2006.8,.01,3)
This must be a unique name.
"^DD",2006.8,2006.8,.01,21,0)
^.001^2^2^3100308^^^^
"^DD",2006.8,2006.8,.01,21,1,0)
This is the name that is given to a particular BP Server.
"^DD",2006.8,2006.8,.01,21,2,0)
This identifying name remains with the system.
"^DD",2006.8,2006.8,.01,"DT")
3100219
"^DD",2006.8,2006.8,.04,0)
PLACE^RP2006.1'^MAG(2006.1,^0;2^Q
"^DD",2006.8,2006.8,.04,1,0)
^.1^^0
"^DD",2006.8,2006.8,.04,21,0)
^.001^7^7^3100904^^^^
"^DD",2006.8,2006.8,.04,21,1,0)
This field identifies the Imaging site platform that pertains
"^DD",2006.8,2006.8,.04,21,2,0)
to this BP server.  The Site Parameter entry defines all of the
"^DD",2006.8,2006.8,.04,21,3,0)
attributes of VistA Imaging local area network and application 
"^DD",2006.8,2006.8,.04,21,4,0)
site parameters for DICOM Gateway(s), VistARad, TeleReader, 
"^DD",2006.8,2006.8,.04,21,5,0)
Clinical capture and Clinical display applications.
"^DD",2006.8,2006.8,.04,21,6,0)
 
"^DD",2006.8,2006.8,.04,21,7,0)
The Imaging site is determined by the end-users default division.
"^DD",2006.8,2006.8,.04,"DT")
3080714
"^DD",2006.8,2006.8,3,0)
PURGE^SX^0:NO;1:YES;^0;3^Q
"^DD",2006.8,2006.8,3,3)
This enables this workstation to perform the auto purge function
"^DD",2006.8,2006.8,3,21,0)
^.001^2^2^3100308^^^^
"^DD",2006.8,2006.8,3,21,1,0)
This value designates this BP Server for the task of running 
"^DD",2006.8,2006.8,3,21,2,0)
the Auto-purge and Scheduled Purge tasks. 
"^DD",2006.8,2006.8,3,"DT")
3090407
"^DD",2006.8,2006.8,4,0)
SCHEDULED VERIFY^SX^0:NO;1:YES;^0;4^Q
"^DD",2006.8,2006.8,4,3)
This enables this workstation to perform the Scheduled VERIFY function.
"^DD",2006.8,2006.8,4,21,0)
^.001^2^2^3100308^^^
"^DD",2006.8,2006.8,4,21,1,0)
This value designates this workstation for the task of running 
"^DD",2006.8,2006.8,4,21,2,0)
the Scheduled-verifier function.
"^DD",2006.8,2006.8,4,"DT")
3090318
"^DD",2006.8,2006.8,11,0)
BACKGROUND PROCESSOR^SX^0:NO;1:YES;^0;12^Q
"^DD",2006.8,2006.8,11,3)
Enter YES if this system is to be used as a BACKGROUND PROCESSOR
"^DD",2006.8,2006.8,11,21,0)
^.001^6^6^3100308^^^^
"^DD",2006.8,2006.8,11,21,1,0)
This field designates a BACKGROUND PROCESSOR server.
"^DD",2006.8,2006.8,11,21,2,0)
Only entries defined as a BACKGROUND PROCESSOR may be 
"^DD",2006.8,2006.8,11,21,3,0)
assigned tasks to process.  
"^DD",2006.8,2006.8,11,21,4,0)
 
"^DD",2006.8,2006.8,11,21,5,0)
This field is not user editable but maintained by the 
"^DD",2006.8,2006.8,11,21,6,0)
BP Queue Processor client software
"^DD",2006.8,2006.8,11,"DT")
3080630
"^DD",2006.8,2006.8,12,0)
ABSTRACT^*SX^0:NO;1:YES;^0;13^Q
"^DD",2006.8,2006.8,12,3)
Enter YES if the BP Server should execute ABSTRACT queues.
"^DD",2006.8,2006.8,12,21,0)
^.001^6^6^3100308^^^^
"^DD",2006.8,2006.8,12,21,1,0)
This value indicates whether the Background Processor Server 
"^DD",2006.8,2006.8,12,21,2,0)
assigned to this entry executes ABSTRACT queues.
"^DD",2006.8,2006.8,12,21,3,0)
 
"^DD",2006.8,2006.8,12,21,4,0)
Only one Background Processor Server may be assigned this task
"^DD",2006.8,2006.8,12,21,5,0)
at a time.  Retire the Abstract assignment from its current 
"^DD",2006.8,2006.8,12,21,6,0)
assignee, and then reassign.
"^DD",2006.8,2006.8,12,"DT")
3090407
"^DD",2006.8,2006.8,13,0)
JUKEBOX^SX^0:NO;1:YES;^0;14^Q
"^DD",2006.8,2006.8,13,3)
Enter YES if the BP Server should execute JUKEBOX queues.
"^DD",2006.8,2006.8,13,21,0)
^.001^6^6^3100907^^^^
"^DD",2006.8,2006.8,13,21,1,0)
This value indicates whether the Background Processor Server
"^DD",2006.8,2006.8,13,21,2,0)
assigned to this entry executes JUKEBOX queues.
"^DD",2006.8,2006.8,13,21,3,0)
 
"^DD",2006.8,2006.8,13,21,4,0)
Only one Background Processor Server may be assigned this task
"^DD",2006.8,2006.8,13,21,5,0)
at a time.  Retire the JUKEBOX assignment from its current 
"^DD",2006.8,2006.8,13,21,6,0)
assignee, and then reassign.
"^DD",2006.8,2006.8,13,"DT")
3090407
"^DD",2006.8,2006.8,14,0)
JBTOHD^SX^0:NO;1:YES;^0;15^Q
"^DD",2006.8,2006.8,14,3)
Enter YES if the BP Server should execute JBTOHD queues.
"^DD",2006.8,2006.8,14,21,0)
^.001^6^6^3100907^^^^
"^DD",2006.8,2006.8,14,21,1,0)
This value indicates whether the Background Processor Server
"^DD",2006.8,2006.8,14,21,2,0)
assigned to this entry executes JBTOHD queues.
"^DD",2006.8,2006.8,14,21,3,0)
 
"^DD",2006.8,2006.8,14,21,4,0)
Only one Background Processor Server may be assigned this task
"^DD",2006.8,2006.8,14,21,5,0)
at a time.  Retire the JBTOHD assignment from its current 
"^DD",2006.8,2006.8,14,21,6,0)
assignee, and then reassign.
"^DD",2006.8,2006.8,14,"DT")
3090407
"^DD",2006.8,2006.8,15,0)
PREFET^*SX^0:NO;1:YES;^0;16^Q
"^DD",2006.8,2006.8,15,3)
Enter YES if the BP Server should execute PREFET queues.
"^DD",2006.8,2006.8,15,21,0)
^.001^6^6^3100907^^^^
"^DD",2006.8,2006.8,15,21,1,0)
This value indicates whether the Background Processor Server
"^DD",2006.8,2006.8,15,21,2,0)
assigned to this entry executes PREFET queues.
"^DD",2006.8,2006.8,15,21,3,0)
 
"^DD",2006.8,2006.8,15,21,4,0)
Only one Background Processor Server may be assigned this task
"^DD",2006.8,2006.8,15,21,5,0)
at a time.  Retire the PREFET assignment from its current 
"^DD",2006.8,2006.8,15,21,6,0)
assignee, and then reassign.
"^DD",2006.8,2006.8,15,"DT")
3090407
"^DD",2006.8,2006.8,16,0)
IMPORT^SX^0:NO;1:YES;^0;17^Q
"^DD",2006.8,2006.8,16,3)
Enter YES if the BP Server should execute IMPORT queues.
"^DD",2006.8,2006.8,16,21,0)
^.001^6^6^3100907^^^^
"^DD",2006.8,2006.8,16,21,1,0)
This value indicates whether the Background Processor Server
"^DD",2006.8,2006.8,16,21,2,0)
assigned to this entry executes IMPORT queues.
"^DD",2006.8,2006.8,16,21,3,0)
 
"^DD",2006.8,2006.8,16,21,4,0)
Only one Background Processor Server may be assigned this task
"^DD",2006.8,2006.8,16,21,5,0)
at a time.  Retire the IMPORT assignment from its current 
"^DD",2006.8,2006.8,16,21,6,0)
assignee, and then reassign.
"^DD",2006.8,2006.8,16,"DT")
3090407
"^DD",2006.8,2006.8,17,0)
GCC^*SX^0:NO;1:YES;^0;18^Q
"^DD",2006.8,2006.8,17,3)
Enter YES if the BP Server should execute GCC queues.
"^DD",2006.8,2006.8,17,21,0)
^.001^6^6^3100907^^^^
"^DD",2006.8,2006.8,17,21,1,0)
This value indicates whether the Background Processor Server
"^DD",2006.8,2006.8,17,21,2,0)
assigned to this entry executes GCC queues.
"^DD",2006.8,2006.8,17,21,3,0)
 
"^DD",2006.8,2006.8,17,21,4,0)
Only one Background Processor Server may be assigned this task
"^DD",2006.8,2006.8,17,21,5,0)
at a time.  Retire the GCC assignment from its current 
"^DD",2006.8,2006.8,17,21,6,0)
assignee, and then reassign.
"^DD",2006.8,2006.8,17,"DT")
3090407
"^DD",2006.8,2006.8,20,0)
DELETE^*SX^0:NO;1:YES;^0;23^Q
"^DD",2006.8,2006.8,20,3)
Enter YES if the BP Server should execute DELETE queues.
"^DD",2006.8,2006.8,20,21,0)
^.001^6^6^3100907^^^^
"^DD",2006.8,2006.8,20,21,1,0)
This value indicates whether the Background Processor Server
"^DD",2006.8,2006.8,20,21,2,0)
assigned to this entry executes DELETE queues.
"^DD",2006.8,2006.8,20,21,3,0)
 
"^DD",2006.8,2006.8,20,21,4,0)
Only one Background Processor Server may be assigned this task
"^DD",2006.8,2006.8,20,21,5,0)
at a time.  Retire the DELETE assignment from its current 
"^DD",2006.8,2006.8,20,21,6,0)
assignee, and then reassign.
"^DD",2006.8,2006.8,20,"DT")
3090407
"^DD",2006.8,2006.8,49,0)
NETWORK_LOG_ARCHIVE^F^^2;1^K:$L(X)>160!($L(X)<1) X
"^DD",2006.8,2006.8,49,3)
Enter the share path for the archive logs, answer must be 1-160 characters in length.
"^DD",2006.8,2006.8,49,21,0)
^.001^4^4^3100308^^^^
"^DD",2006.8,2006.8,49,21,1,0)
This is the location where this BP Server stores the activity
"^DD",2006.8,2006.8,49,21,2,0)
logs. An example of a share path is: \\iswxxximg1\share1..., 
"^DD",2006.8,2006.8,49,21,3,0)
where xxx is the site code.
"^DD",2006.8,2006.8,49,21,4,0)
This share should be scheduled for backups.
"^DD",2006.8,2006.8,49,"DT")
3060606
"^DD",2006.8,2006.8,50,0)
BP SERVER NETWORK NAME^FX^^1;1^S DIC("S")="I '$O(^MAG(2006.8,""C"",$$PLACE^MAGBAPI(+$G(DUZ(2))),X,0))" K:($L(X)>30) X
"^DD",2006.8,2006.8,50,1,0)
^.1^^0
"^DD",2006.8,2006.8,50,3)
The computer name defined in network properties on this BP Server.
"^DD",2006.8,2006.8,50,12.1)
S DIC("S")="I '$O(^MAG(2006.8,""C"",$$PLACE^MAGBAPI(+$G(DUZ(2))),Y,0))"
"^DD",2006.8,2006.8,50,21,0)
^.001^2^2^3100308^^^^
"^DD",2006.8,2006.8,50,21,1,0)
This is the computer name defined on the BP Server for network
"^DD",2006.8,2006.8,50,21,2,0)
operation (i.e. the Network computer name).
"^DD",2006.8,2006.8,50,"DT")
3080703
"^DD",2006.8,2006.8,51,0)
BP CLIENT VERSION^F^^1;2^K:$L(X)>24!($L(X)<3) X
"^DD",2006.8,2006.8,51,3)
Enter the BP software version, answer must be 3-24 characters in length
"^DD",2006.8,2006.8,51,21,0)
^.001^3^3^3100308^^^
"^DD",2006.8,2006.8,51,21,1,0)
This is the BP software version installed on this BP Server.  
"^DD",2006.8,2006.8,51,21,2,0)
This field is maintained by the BP Queue Processor, Verifier, 
"^DD",2006.8,2006.8,51,21,3,0)
and Purge applications for this Server.
"^DD",2006.8,2006.8,51,"DT")
3000208
"^DD",2006.8,2006.8,52,0)
BP CLIENT DISTRIBUTION DATE^D^^1;3^S %DT="EX" D ^%DT S X=Y K:X<1 X
"^DD",2006.8,2006.8,52,3)
(No range limit on date)
"^DD",2006.8,2006.8,52,21,0)
^.001^1^1^3100308^^
"^DD",2006.8,2006.8,52,21,1,0)
This is the Windows date modified for the MAGQBTM executable.
"^DD",2006.8,2006.8,52,"DT")
3090427
"^DD",2006.8,2006.8,53,0)
BP SERVER OS^F^^1;4^K:$L(X)>60!($L(X)<3) X
"^DD",2006.8,2006.8,53,3)
Answer must be 3-60 characters in length.
"^DD",2006.8,2006.8,53,21,0)
^^3^3^3100308^
"^DD",2006.8,2006.8,53,21,1,0)
This is the operating system for the BP Server.  This field
"^DD",2006.8,2006.8,53,21,2,0)
is maintained by the BP Queue Processor, Verifier, and Purge 
"^DD",2006.8,2006.8,53,21,3,0)
applications for this Server.
"^DD",2006.8,2006.8,53,"DT")
3000329
"^DD",2006.8,2006.8,54,0)
LOGSIZE^NJ5,0^^2;2^K:+X'=X!(X>10000)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.8,2006.8,54,3)
Type a number between 0 and 10000 to indicate the maximum size for archived log files to reach.
"^DD",2006.8,2006.8,54,21,0)
^.001^3^3^3100907^^^^
"^DD",2006.8,2006.8,54,21,1,0)
This value determines the size in megabytes of the archived
"^DD",2006.8,2006.8,54,21,2,0)
html log files generated by the BP application that are 
"^DD",2006.8,2006.8,54,21,3,0)
executed on the BP server assigned to this entry.
"^DD",2006.8,2006.8,54,"DT")
3100222
"^DD",2006.8,2006.8,55,0)
LAST EXECUTION DATE^D^^1;5^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",2006.8,2006.8,55,3)
This is the latest date of activity for this Background Processor server.
"^DD",2006.8,2006.8,55,21,0)
^.001^3^3^3100308^^^^
"^DD",2006.8,2006.8,55,21,1,0)
This field is updated by the Background Processor and
"^DD",2006.8,2006.8,55,21,2,0)
identifies the date when the Background Processor was
"^DD",2006.8,2006.8,55,21,3,0)
last executed. 
"^DD",2006.8,2006.8,55,"DT")
3100222
"^DD",2006.95,2006.95,1,0)
ACCESS TYPE^RF^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",2006.95,2006.95,1,3)
Enter the type of access being logged; answer must be 1-30 characters in length.
"^DD",2006.95,2006.95,1,21,0)
^.001^2^2^3100406^^^^
"^DD",2006.95,2006.95,1,21,1,0)
This field describes the type of access made to the image or
"^DD",2006.95,2006.95,1,21,2,0)
page of image abstracts.
"^DD",2006.95,2006.95,1,"DT")
3100406
"^DD",2006.95,2006.95,10,0)
DIVISION^P4'^DIC(4,^0;11^Q
"^DD",2006.95,2006.95,10,1,0)
^.1
"^DD",2006.95,2006.95,10,1,1,0)
2006.95^C^MUMPS
"^DD",2006.95,2006.95,10,1,1,1)
S ^MAG(2006.95,"C",$S($D(^MAG(2006.1,"B",+X)):$$PLACE^MAGBAPI(X),1:$$PLACE^MAGBAPI($$KSP^XUPARAM("INST"))),$E(+$P(^MAG(2006.95,DA,0),U,7),1,30),DA)=""
"^DD",2006.95,2006.95,10,1,1,2)
K ^MAG(2006.95,"C",$S($D(^MAG(2006.1,"B",+X)):$$PLACE^MAGBAPI(X),1:$$PLACE^MAGBAPI($$KSP^XUPARAM("INST"))),$E(+$P(^MAG(2006.95,DA,0),U,7),1,30),DA)
"^DD",2006.95,2006.95,10,1,1,"%D",0)
^.101^5^5^3090408^^^^
"^DD",2006.95,2006.95,10,1,1,"%D",1,0)
This cross reference is used to sort by division in chronological order.
"^DD",2006.95,2006.95,10,1,1,"%D",2,0)
Example: ^MAG(2006.95,"C",Imaging site division,access date/time,da)=""
"^DD",2006.95,2006.95,10,1,1,"%D",3,0)
 
"^DD",2006.95,2006.95,10,1,1,"%D",4,0)
The division will default to the Kernel Site Institution if a division does
"^DD",2006.95,2006.95,10,1,1,"%D",5,0)
not match an entry in the Imaging Site Parameter file (#2006.1).
"^DD",2006.95,2006.95,10,1,1,"DT")
3090408
"^DD",2006.95,2006.95,10,21,0)
^.001^1^1^3090408^^^^
"^DD",2006.95,2006.95,10,21,1,0)
Records the institution where the Imaging event took place. 
"^DD",2006.95,2006.95,10,"DT")
3090408
**END**
**END**


****
****
