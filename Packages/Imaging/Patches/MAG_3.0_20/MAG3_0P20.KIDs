KIDS Distribution saved on Apr 12, 2006@10:53:22
Vista Imaging - 3.0 - P20
**KIDS**:MAG*3.0*20^

**INSTALL NAME**
MAG*3.0*20
"BLD",5029,0)
MAG*3.0*20^IMAGING^0^3060412^y
"BLD",5029,1,0)
^^35^35^3060412^
"BLD",5029,1,1,0)
Select BUILD NAME:    MAG*3.0*20     IMAGING
"BLD",5029,1,2,0)
MAGBAPI   value = 74386027
"BLD",5029,1,3,0)
MAGBAPIP  value = 8622481
"BLD",5029,1,4,0)
MAGDIR82  value = 62866214
"BLD",5029,1,5,0)
MAGDLB12  value = 22838427
"BLD",5029,1,6,0)
MAGGSIUI  value = 60693392
"BLD",5029,1,7,0)
MAGGSIV   value = 38730975
"BLD",5029,1,8,0)
MAGGSIV1  value = 21788454
"BLD",5029,1,9,0)
MAGGTU3   value = 61285454
"BLD",5029,1,10,0)
MAGGTU6   value = 64383471
"BLD",5029,1,11,0)
MAGGTU7   value = 22552210
"BLD",5029,1,12,0)
MAGIPS20  value = 26957915
"BLD",5029,1,13,0)
MAGIPT20  value = 70909996
"BLD",5029,1,14,0)
MAGLOG    value = 6935907
"BLD",5029,1,15,0)
MAGQBAB   value = 10838980
"BLD",5029,1,16,0)
MAGQBD    value = 7129737
"BLD",5029,1,17,0)
MAGQBGCC  value = 11208984
"BLD",5029,1,18,0)
MAGQBIM   value = 7456958
"BLD",5029,1,19,0)
MAGQBJB   value = 18032148
"BLD",5029,1,20,0)
MAGQBJH   value = 24339395
"BLD",5029,1,21,0)
MAGQBJHR  value = 14061671
"BLD",5029,1,22,0)
MAGQBPG1  value = 74002571
"BLD",5029,1,23,0)
MAGQBPG2  value = 20522184
"BLD",5029,1,24,0)
MAGQBPRG  value = 57111603
"BLD",5029,1,25,0)
MAGQBTM   value = 79154449
"BLD",5029,1,26,0)
MAGQBUT   value = 78801561
"BLD",5029,1,27,0)
MAGQBUT1  value = 75489141
"BLD",5029,1,28,0)
MAGQBUT2  value = 73670919
"BLD",5029,1,29,0)
MAGQBUT4  value = 78268087
"BLD",5029,1,30,0)
MAGQBUT5  value = 13804118
"BLD",5029,1,31,0)
MAGQE1    value = 11840891
"BLD",5029,1,32,0)
MAGQE2    value = 17337879
"BLD",5029,1,33,0)
MAGQE3    value = 75394836
"BLD",5029,1,34,0)
MAGQE5    value = 48023547
"BLD",5029,1,35,0)
MAGUSIT   value = 17597745
"BLD",5029,4,0)
^9.64PA^2006.81^10
"BLD",5029,4,2005,0)
2005
"BLD",5029,4,2005,2,0)
^9.641^2005.04^2
"BLD",5029,4,2005,2,2005,0)
IMAGE  (File-top level)
"BLD",5029,4,2005,2,2005,1,0)
^9.6411^13.5^2
"BLD",5029,4,2005,2,2005,1,1,0)
FILEREF
"BLD",5029,4,2005,2,2005,1,13.5,0)
DUPE
"BLD",5029,4,2005,2,2005.04,0)
OBJECT GROUP  (sub-file)
"BLD",5029,4,2005,2,2005.04,1,0)
^9.6411^2^3
"BLD",5029,4,2005,2,2005.04,1,.01,0)
OBJECT GROUP
"BLD",5029,4,2005,2,2005.04,1,1,0)
DICOM SERIES NUM
"BLD",5029,4,2005,2,2005.04,1,2,0)
DICOM IMAGE NUM
"BLD",5029,4,2005,222)
y^y^p^^^^n^^n
"BLD",5029,4,2005,224)

"BLD",5029,4,2005.1,0)
2005.1
"BLD",5029,4,2005.1,2,0)
^9.641^2005.14^2
"BLD",5029,4,2005.1,2,2005.1,0)
IMAGE AUDIT  (File-top level)
"BLD",5029,4,2005.1,2,2005.1,1,0)
^9.6411^13.5^2
"BLD",5029,4,2005.1,2,2005.1,1,1,0)
FILEREF
"BLD",5029,4,2005.1,2,2005.1,1,13.5,0)
DUPE
"BLD",5029,4,2005.1,2,2005.14,0)
OBJECT GROUP  (sub-file)
"BLD",5029,4,2005.1,2,2005.14,1,0)
^9.6411^2^3
"BLD",5029,4,2005.1,2,2005.14,1,.01,0)
OBJECT GROUP
"BLD",5029,4,2005.1,2,2005.14,1,1,0)
DICOM SERIES NUM
"BLD",5029,4,2005.1,2,2005.14,1,2,0)
DICOM IMAGE NUM
"BLD",5029,4,2005.1,222)
y^y^p^^^^n^^n
"BLD",5029,4,2005.1,224)

"BLD",5029,4,2005.2,0)
2005.2
"BLD",5029,4,2005.2,2,0)
^9.641^2005.2^1
"BLD",5029,4,2005.2,2,2005.2,0)
NETWORK LOCATION  (File-top level)
"BLD",5029,4,2005.2,2,2005.2,1,0)
^9.6411^26^8
"BLD",5029,4,2005.2,2,2005.2,1,.04,0)
PLACE
"BLD",5029,4,2005.2,2,2005.2,1,1,0)
PHYSICAL REFERENCE
"BLD",5029,4,2005.2,2,2005.2,1,2,0)
TOTAL SPACE
"BLD",5029,4,2005.2,2,2005.2,1,3,0)
SPACE USED
"BLD",5029,4,2005.2,2,2005.2,1,4,0)
FREE SPACE
"BLD",5029,4,2005.2,2,2005.2,1,6,0)
STORAGE TYPE
"BLD",5029,4,2005.2,2,2005.2,1,14,0)
COMPRESSION
"BLD",5029,4,2005.2,2,2005.2,1,26,0)
ROUTER
"BLD",5029,4,2005.2,222)
y^y^p^^^^n^^n
"BLD",5029,4,2005.2,224)

"BLD",5029,4,2006.03,0)
2006.03
"BLD",5029,4,2006.03,222)
y^y^f^^^^n
"BLD",5029,4,2006.031,0)
2006.031
"BLD",5029,4,2006.031,222)
y^y^f^^^^n
"BLD",5029,4,2006.032,0)
2006.032
"BLD",5029,4,2006.032,222)
y^y^f^^^^n
"BLD",5029,4,2006.1,0)
2006.1
"BLD",5029,4,2006.1,222)
y^y^f^^^^n^^n
"BLD",5029,4,2006.1,224)

"BLD",5029,4,2006.8,0)
2006.8
"BLD",5029,4,2006.8,222)
y^y^f^^^^n
"BLD",5029,4,2006.81,0)
2006.81
"BLD",5029,4,2006.81,2,0)
^9.641^2006.81^1
"BLD",5029,4,2006.81,2,2006.81,0)
IMAGING WINDOWS WORKSTATIONS  (File-top level)
"BLD",5029,4,2006.81,2,2006.81,1,0)
^9.6411^.04^1
"BLD",5029,4,2006.81,2,2006.81,1,.04,0)
PLACE
"BLD",5029,4,2006.81,222)
y^y^p^^^^n^^n
"BLD",5029,4,2006.81,224)

"BLD",5029,4,2006.82,0)
2006.82
"BLD",5029,4,2006.82,2,0)
^9.641^2006.82^1
"BLD",5029,4,2006.82,2,2006.82,0)
IMAGING WINDOWS SESSIONS  (File-top level)
"BLD",5029,4,2006.82,2,2006.82,1,0)
^9.6411^2^2
"BLD",5029,4,2006.82,2,2006.82,1,.04,0)
PLACE
"BLD",5029,4,2006.82,2,2006.82,1,2,0)
START
"BLD",5029,4,2006.82,222)
y^y^p^^^^n^^n
"BLD",5029,4,2006.82,224)

"BLD",5029,4,"APDD",2005,2005)

"BLD",5029,4,"APDD",2005,2005,1)

"BLD",5029,4,"APDD",2005,2005,13.5)

"BLD",5029,4,"APDD",2005,2005.04)

"BLD",5029,4,"APDD",2005,2005.04,.01)

"BLD",5029,4,"APDD",2005,2005.04,1)

"BLD",5029,4,"APDD",2005,2005.04,2)

"BLD",5029,4,"APDD",2005.1,2005.1)

"BLD",5029,4,"APDD",2005.1,2005.1,1)

"BLD",5029,4,"APDD",2005.1,2005.1,13.5)

"BLD",5029,4,"APDD",2005.1,2005.14)

"BLD",5029,4,"APDD",2005.1,2005.14,.01)

"BLD",5029,4,"APDD",2005.1,2005.14,1)

"BLD",5029,4,"APDD",2005.1,2005.14,2)

"BLD",5029,4,"APDD",2005.2,2005.2)

"BLD",5029,4,"APDD",2005.2,2005.2,.04)

"BLD",5029,4,"APDD",2005.2,2005.2,1)

"BLD",5029,4,"APDD",2005.2,2005.2,2)

"BLD",5029,4,"APDD",2005.2,2005.2,3)

"BLD",5029,4,"APDD",2005.2,2005.2,4)

"BLD",5029,4,"APDD",2005.2,2005.2,6)

"BLD",5029,4,"APDD",2005.2,2005.2,14)

"BLD",5029,4,"APDD",2005.2,2005.2,26)

"BLD",5029,4,"APDD",2006.81,2006.81)

"BLD",5029,4,"APDD",2006.81,2006.81,.04)

"BLD",5029,4,"APDD",2006.82,2006.82)

"BLD",5029,4,"APDD",2006.82,2006.82,.04)

"BLD",5029,4,"APDD",2006.82,2006.82,2)

"BLD",5029,4,"B",2005,2005)

"BLD",5029,4,"B",2005.1,2005.1)

"BLD",5029,4,"B",2005.2,2005.2)

"BLD",5029,4,"B",2006.03,2006.03)

"BLD",5029,4,"B",2006.031,2006.031)

"BLD",5029,4,"B",2006.032,2006.032)

"BLD",5029,4,"B",2006.1,2006.1)

"BLD",5029,4,"B",2006.8,2006.8)

"BLD",5029,4,"B",2006.81,2006.81)

"BLD",5029,4,"B",2006.82,2006.82)

"BLD",5029,"ABNS",0)
^9.66A^^
"BLD",5029,"ABPKG")
n^n
"BLD",5029,"INI")
PRE^MAGIPS20
"BLD",5029,"INID")
n^y^y
"BLD",5029,"INIT")
POST^MAGIPT20
"BLD",5029,"KRN",0)
^9.67PA^8989.52^19
"BLD",5029,"KRN",.4,0)
.4
"BLD",5029,"KRN",.4,"NM",0)
^9.68A^^
"BLD",5029,"KRN",.401,0)
.401
"BLD",5029,"KRN",.401,"NM",0)
^9.68A^^
"BLD",5029,"KRN",.402,0)
.402
"BLD",5029,"KRN",.402,"NM",0)
^9.68A^^
"BLD",5029,"KRN",.403,0)
.403
"BLD",5029,"KRN",.403,"NM",0)
^9.68A^^
"BLD",5029,"KRN",.5,0)
.5
"BLD",5029,"KRN",.5,"NM",0)
^9.68A^^
"BLD",5029,"KRN",.84,0)
.84
"BLD",5029,"KRN",.84,"NM",0)
^9.68A^^
"BLD",5029,"KRN",3.6,0)
3.6
"BLD",5029,"KRN",3.6,"NM",0)
^9.68A^^
"BLD",5029,"KRN",3.8,0)
3.8
"BLD",5029,"KRN",3.8,"NM",0)
^9.68A^^
"BLD",5029,"KRN",9.2,0)
9.2
"BLD",5029,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",5029,"KRN",9.8,0)
9.8
"BLD",5029,"KRN",9.8,"NM",0)
^9.68A^38^33
"BLD",5029,"KRN",9.8,"NM",1,0)
MAGBAPI^^0^B74386027
"BLD",5029,"KRN",9.8,"NM",3,0)
MAGDLB12^^0^B22838427
"BLD",5029,"KRN",9.8,"NM",4,0)
MAGQBAB^^0^B10838980
"BLD",5029,"KRN",9.8,"NM",5,0)
MAGQBGCC^^0^B11208984
"BLD",5029,"KRN",9.8,"NM",6,0)
MAGQBJB^^0^B18032148
"BLD",5029,"KRN",9.8,"NM",7,0)
MAGQBJH^^0^B24339395
"BLD",5029,"KRN",9.8,"NM",8,0)
MAGQBJHR^^0^B14061671
"BLD",5029,"KRN",9.8,"NM",9,0)
MAGQBPG1^^0^B74002571
"BLD",5029,"KRN",9.8,"NM",10,0)
MAGQBPG2^^0^B20522184
"BLD",5029,"KRN",9.8,"NM",11,0)
MAGQBPRG^^0^B57111603
"BLD",5029,"KRN",9.8,"NM",12,0)
MAGQBTM^^0^B79154449
"BLD",5029,"KRN",9.8,"NM",13,0)
MAGQBUT^^0^B78801561
"BLD",5029,"KRN",9.8,"NM",14,0)
MAGQBUT1^^0^B75489141
"BLD",5029,"KRN",9.8,"NM",15,0)
MAGQBUT2^^0^B73670919
"BLD",5029,"KRN",9.8,"NM",16,0)
MAGQBUT4^^0^B78268087
"BLD",5029,"KRN",9.8,"NM",17,0)
MAGQST^^1^
"BLD",5029,"KRN",9.8,"NM",18,0)
MAGUSIT^^0^B17597745
"BLD",5029,"KRN",9.8,"NM",20,0)
MAGGTU6^^0^B64383471
"BLD",5029,"KRN",9.8,"NM",22,0)
MAGQE1^^0^B11840891
"BLD",5029,"KRN",9.8,"NM",23,0)
MAGQBD^^0^B7129737
"BLD",5029,"KRN",9.8,"NM",24,0)
MAGQBIM^^0^B7456958
"BLD",5029,"KRN",9.8,"NM",25,0)
MAGGTU3^^0^B61285454
"BLD",5029,"KRN",9.8,"NM",26,0)
MAGBAPIP^^0^B8622481
"BLD",5029,"KRN",9.8,"NM",27,0)
MAGGSIV^^0^B38730975
"BLD",5029,"KRN",9.8,"NM",28,0)
MAGGSIUI^^0^B60693392
"BLD",5029,"KRN",9.8,"NM",30,0)
MAGQBUT5^^0^B13804118
"BLD",5029,"KRN",9.8,"NM",32,0)
MAGQE3^^0^B75394836
"BLD",5029,"KRN",9.8,"NM",33,0)
MAGQE5^^0^B48023547
"BLD",5029,"KRN",9.8,"NM",34,0)
MAGQE2^^0^B17337879
"BLD",5029,"KRN",9.8,"NM",35,0)
MAGGSIV1^^0^B21788454
"BLD",5029,"KRN",9.8,"NM",36,0)
MAGGTU7^^0^B22552210
"BLD",5029,"KRN",9.8,"NM",37,0)
MAGLOG^^0^B6935907
"BLD",5029,"KRN",9.8,"NM",38,0)
MAGDIR82^^0^B62866214
"BLD",5029,"KRN",9.8,"NM","B","MAGBAPI",1)

"BLD",5029,"KRN",9.8,"NM","B","MAGBAPIP",26)

"BLD",5029,"KRN",9.8,"NM","B","MAGDIR82",38)

"BLD",5029,"KRN",9.8,"NM","B","MAGDLB12",3)

"BLD",5029,"KRN",9.8,"NM","B","MAGGSIUI",28)

"BLD",5029,"KRN",9.8,"NM","B","MAGGSIV",27)

"BLD",5029,"KRN",9.8,"NM","B","MAGGSIV1",35)

"BLD",5029,"KRN",9.8,"NM","B","MAGGTU3",25)

"BLD",5029,"KRN",9.8,"NM","B","MAGGTU6",20)

"BLD",5029,"KRN",9.8,"NM","B","MAGGTU7",36)

"BLD",5029,"KRN",9.8,"NM","B","MAGLOG",37)

"BLD",5029,"KRN",9.8,"NM","B","MAGQBAB",4)

"BLD",5029,"KRN",9.8,"NM","B","MAGQBD",23)

"BLD",5029,"KRN",9.8,"NM","B","MAGQBGCC",5)

"BLD",5029,"KRN",9.8,"NM","B","MAGQBIM",24)

"BLD",5029,"KRN",9.8,"NM","B","MAGQBJB",6)

"BLD",5029,"KRN",9.8,"NM","B","MAGQBJH",7)

"BLD",5029,"KRN",9.8,"NM","B","MAGQBJHR",8)

"BLD",5029,"KRN",9.8,"NM","B","MAGQBPG1",9)

"BLD",5029,"KRN",9.8,"NM","B","MAGQBPG2",10)

"BLD",5029,"KRN",9.8,"NM","B","MAGQBPRG",11)

"BLD",5029,"KRN",9.8,"NM","B","MAGQBTM",12)

"BLD",5029,"KRN",9.8,"NM","B","MAGQBUT",13)

"BLD",5029,"KRN",9.8,"NM","B","MAGQBUT1",14)

"BLD",5029,"KRN",9.8,"NM","B","MAGQBUT2",15)

"BLD",5029,"KRN",9.8,"NM","B","MAGQBUT4",16)

"BLD",5029,"KRN",9.8,"NM","B","MAGQBUT5",30)

"BLD",5029,"KRN",9.8,"NM","B","MAGQE1",22)

"BLD",5029,"KRN",9.8,"NM","B","MAGQE2",34)

"BLD",5029,"KRN",9.8,"NM","B","MAGQE3",32)

"BLD",5029,"KRN",9.8,"NM","B","MAGQE5",33)

"BLD",5029,"KRN",9.8,"NM","B","MAGQST",17)

"BLD",5029,"KRN",9.8,"NM","B","MAGUSIT",18)

"BLD",5029,"KRN",19,0)
19
"BLD",5029,"KRN",19,"NM",0)
^9.68A^^
"BLD",5029,"KRN",19.1,0)
19.1
"BLD",5029,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",5029,"KRN",101,0)
101
"BLD",5029,"KRN",101,"NM",0)
^9.68A^^
"BLD",5029,"KRN",409.61,0)
409.61
"BLD",5029,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",5029,"KRN",771,0)
771
"BLD",5029,"KRN",771,"NM",0)
^9.68A^^
"BLD",5029,"KRN",870,0)
870
"BLD",5029,"KRN",870,"NM",0)
^9.68A^^
"BLD",5029,"KRN",8989.51,0)
8989.51
"BLD",5029,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",5029,"KRN",8989.52,0)
8989.52
"BLD",5029,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",5029,"KRN",8994,0)
8994
"BLD",5029,"KRN",8994,"NM",0)
^9.68A^3^3
"BLD",5029,"KRN",8994,"NM",1,0)
MAGQ COQ^^0
"BLD",5029,"KRN",8994,"NM",2,0)
MAGQ QCNT^^0
"BLD",5029,"KRN",8994,"NM",3,0)
MAGQ FS CHNGE^^0
"BLD",5029,"KRN",8994,"NM","B","MAGQ COQ",1)

"BLD",5029,"KRN",8994,"NM","B","MAGQ FS CHNGE",3)

"BLD",5029,"KRN",8994,"NM","B","MAGQ QCNT",2)

"BLD",5029,"KRN","B",.4,.4)

"BLD",5029,"KRN","B",.401,.401)

"BLD",5029,"KRN","B",.402,.402)

"BLD",5029,"KRN","B",.403,.403)

"BLD",5029,"KRN","B",.5,.5)

"BLD",5029,"KRN","B",.84,.84)

"BLD",5029,"KRN","B",3.6,3.6)

"BLD",5029,"KRN","B",3.8,3.8)

"BLD",5029,"KRN","B",9.2,9.2)

"BLD",5029,"KRN","B",9.8,9.8)

"BLD",5029,"KRN","B",19,19)

"BLD",5029,"KRN","B",19.1,19.1)

"BLD",5029,"KRN","B",101,101)

"BLD",5029,"KRN","B",409.61,409.61)

"BLD",5029,"KRN","B",771,771)

"BLD",5029,"KRN","B",870,870)

"BLD",5029,"KRN","B",8989.51,8989.51)

"BLD",5029,"KRN","B",8989.52,8989.52)

"BLD",5029,"KRN","B",8994,8994)

"BLD",5029,"PRE")
MAGIPS20
"BLD",5029,"QUES",0)
^9.62^^
"BLD",5029,"REQB",0)
^9.611^4^4
"BLD",5029,"REQB",1,0)
MAG*3.0*48^2
"BLD",5029,"REQB",2,0)
MAG*3.0*30^2
"BLD",5029,"REQB",3,0)
MAG*3.0*45^2
"BLD",5029,"REQB",4,0)
MAG*3.0*51^2
"BLD",5029,"REQB","B","MAG*3.0*30",2)

"BLD",5029,"REQB","B","MAG*3.0*45",3)

"BLD",5029,"REQB","B","MAG*3.0*48",1)

"BLD",5029,"REQB","B","MAG*3.0*51",4)

"FIA",2005)
IMAGE
"FIA",2005,0)
^MAG(2005,
"FIA",2005,0,0)
2005I
"FIA",2005,0,1)
y^y^p^^^^n^^n
"FIA",2005,0,10)

"FIA",2005,0,11)

"FIA",2005,0,"RLRO")

"FIA",2005,0,"VR")
3.0^MAG
"FIA",2005,2005)
1
"FIA",2005,2005,1)

"FIA",2005,2005,4)

"FIA",2005,2005,13.5)

"FIA",2005,2005.04)
1
"FIA",2005,2005.04,.01)

"FIA",2005,2005.04,1)

"FIA",2005,2005.04,2)

"FIA",2005.1)
IMAGE AUDIT
"FIA",2005.1,0)
^MAG(2005.1,
"FIA",2005.1,0,0)
2005.1I
"FIA",2005.1,0,1)
y^y^p^^^^n^^n
"FIA",2005.1,0,10)

"FIA",2005.1,0,11)

"FIA",2005.1,0,"RLRO")

"FIA",2005.1,0,"VR")
3.0^MAG
"FIA",2005.1,2005.1)
1
"FIA",2005.1,2005.1,1)

"FIA",2005.1,2005.1,4)

"FIA",2005.1,2005.1,13.5)

"FIA",2005.1,2005.14)
1
"FIA",2005.1,2005.14,.01)

"FIA",2005.1,2005.14,1)

"FIA",2005.1,2005.14,2)

"FIA",2005.2)
NETWORK LOCATION
"FIA",2005.2,0)
^MAG(2005.2,
"FIA",2005.2,0,0)
2005.2I
"FIA",2005.2,0,1)
y^y^p^^^^n^^n
"FIA",2005.2,0,10)

"FIA",2005.2,0,11)

"FIA",2005.2,0,"RLRO")

"FIA",2005.2,0,"VR")
3.0^MAG
"FIA",2005.2,2005.2)
1
"FIA",2005.2,2005.2,.04)

"FIA",2005.2,2005.2,1)

"FIA",2005.2,2005.2,2)

"FIA",2005.2,2005.2,3)

"FIA",2005.2,2005.2,4)

"FIA",2005.2,2005.2,6)

"FIA",2005.2,2005.2,14)

"FIA",2005.2,2005.2,26)

"FIA",2006.03)
IMAGE BACKGROUND QUEUE
"FIA",2006.03,0)
^MAGQUEUE(2006.03,
"FIA",2006.03,0,0)
2006.03I
"FIA",2006.03,0,1)
y^y^f^^^^n
"FIA",2006.03,0,10)

"FIA",2006.03,0,11)

"FIA",2006.03,0,"RLRO")

"FIA",2006.03,0,"VR")
3.0^MAG
"FIA",2006.03,2006.03)
0
"FIA",2006.031)
IMAGE BACKGROUND QUEUE POINTER
"FIA",2006.031,0)
^MAGQUEUE(2006.031,
"FIA",2006.031,0,0)
2006.031
"FIA",2006.031,0,1)
y^y^f^^^^n
"FIA",2006.031,0,10)

"FIA",2006.031,0,11)

"FIA",2006.031,0,"RLRO")

"FIA",2006.031,0,"VR")
3.0^MAG
"FIA",2006.031,2006.031)
0
"FIA",2006.032)
JUKEBOX
"FIA",2006.032,0)
^MAGQUEUE(2006.032,
"FIA",2006.032,0,0)
2006.032I
"FIA",2006.032,0,1)
y^y^f^^^^n
"FIA",2006.032,0,10)

"FIA",2006.032,0,11)

"FIA",2006.032,0,"RLRO")

"FIA",2006.032,0,"VR")
3.0^MAG
"FIA",2006.032,2006.032)
0
"FIA",2006.1)
IMAGING SITE PARAMETERS
"FIA",2006.1,0)
^MAG(2006.1,
"FIA",2006.1,0,0)
2006.1P
"FIA",2006.1,0,1)
y^y^f^^^^n^^n
"FIA",2006.1,0,10)

"FIA",2006.1,0,11)

"FIA",2006.1,0,"RLRO")

"FIA",2006.1,0,"VR")
3.0^MAG
"FIA",2006.1,2006.1)
0
"FIA",2006.1,2006.11)
0
"FIA",2006.1,2006.112)
0
"FIA",2006.1,2006.12)
0
"FIA",2006.1,2006.1201)
0
"FIA",2006.1,2006.12201)
0
"FIA",2006.8)
BP WORKSTATIONS
"FIA",2006.8,0)
^MAG(2006.8,
"FIA",2006.8,0,0)
2006.8I
"FIA",2006.8,0,1)
y^y^f^^^^n
"FIA",2006.8,0,10)

"FIA",2006.8,0,11)

"FIA",2006.8,0,"RLRO")

"FIA",2006.8,0,"VR")
3.0^MAG
"FIA",2006.8,2006.8)
0
"FIA",2006.81)
IMAGING WINDOWS WORKSTATIONS
"FIA",2006.81,0)
^MAG(2006.81,
"FIA",2006.81,0,0)
2006.81
"FIA",2006.81,0,1)
y^y^p^^^^n^^n
"FIA",2006.81,0,10)

"FIA",2006.81,0,11)

"FIA",2006.81,0,"RLRO")

"FIA",2006.81,0,"VR")
3.0^MAG
"FIA",2006.81,2006.81)
1
"FIA",2006.81,2006.81,.04)

"FIA",2006.82)
IMAGING WINDOWS SESSIONS
"FIA",2006.82,0)
^MAG(2006.82,
"FIA",2006.82,0,0)
2006.82IAO
"FIA",2006.82,0,1)
y^y^p^^^^n^^n
"FIA",2006.82,0,10)

"FIA",2006.82,0,11)

"FIA",2006.82,0,"RLRO")

"FIA",2006.82,0,"VR")
3.0^MAG
"FIA",2006.82,2006.82)
1
"FIA",2006.82,2006.82,.04)

"FIA",2006.82,2006.82,2)

"INI")
PRE^MAGIPS20
"INIT")
POST^MAGIPT20
"IX",2005,2005,"f",0)
2005^f^FILEREF minus the extention^MU^^F^IR^I^2005^^^^^LS
"IX",2005,2005,"f",1)
S ^MAG(2005,"F",$P($E(X,1,60),"."),DA)=""
"IX",2005,2005,"f",2)
K ^MAG(2005,"F",$P($E(X,1,60),"."),DA)
"IX",2005,2005,"f",11.1,0)
^.114IA^1^1
"IX",2005,2005,"f",11.1,1,0)
1^F^2005^1^^1^F
"IX",2005,2005,"f",11.1,1,3)

"IX",2005.1,2005.1,"F",0)
2005.1^F^Image File Name Only^MU^^F^IR^I^2005.1^^^^^LS
"IX",2005.1,2005.1,"F",.1,0)
^^2^2^3041221^
"IX",2005.1,2005.1,"F",.1,1,0)
This allows sorting and lookup of the image IEN by the 
"IX",2005.1,2005.1,"F",.1,2,0)
image file name.
"IX",2005.1,2005.1,"F",1)
S ^MAG(2005.1,"F",$P($E(X,1,30),"."),DA)=""
"IX",2005.1,2005.1,"F",2)
K ^MAG(2005.1,"F",$P($E(X,1,30),"."),DA)
"IX",2005.1,2005.1,"F",2.5)
K ^MAG(2005.1,"F")
"IX",2005.1,2005.1,"F",11.1,0)
^.114IA^1^1
"IX",2005.1,2005.1,"F",11.1,1,0)
1^F^2005.1^1^30^1^F
"IX",2005.2,2005.2,"C",0)
2005.2^C^PHYSICAL REFERENCE and OPERATIONAL STATUS^MU^^R^IR^I^2005.2^^^^^LS
"IX",2005.2,2005.2,"C",.1,0)
^^1^1^3030220^
"IX",2005.2,2005.2,"C",.1,1,0)
This cross reference keeps track of which devices are on (or off) line.
"IX",2005.2,2005.2,"C",1)
S ^MAG(2005.2,"C",X(1),X(2),DA)=""
"IX",2005.2,2005.2,"C",2)
K ^MAG(2005.2,"C",X(1),X(2),DA)
"IX",2005.2,2005.2,"C",2.5)
K ^MAG(2005.2,"C")
"IX",2005.2,2005.2,"C",11.1,0)
^.114IA^2^2
"IX",2005.2,2005.2,"C",11.1,1,0)
1^F^2005.2^1^63^1^F
"IX",2005.2,2005.2,"C",11.1,2,0)
2^F^2005.2^5^^2^F
"IX",2005.2,2005.2,"F",0)
2005.2^F^Place and Storage type index^R^^R^IR^I^2005.2^^^^^LS
"IX",2005.2,2005.2,"F",1)
S ^MAG(2005.2,"F",X(1),X(2),DA)=""
"IX",2005.2,2005.2,"F",2)
K ^MAG(2005.2,"F",X(1),X(2),DA)
"IX",2005.2,2005.2,"F",2.5)
K ^MAG(2005.2,"F")
"IX",2005.2,2005.2,"F",11.1,0)
^.114IA^2^2
"IX",2005.2,2005.2,"F",11.1,1,0)
1^F^2005.2^.04^^1^F
"IX",2005.2,2005.2,"F",11.1,1,3)

"IX",2005.2,2005.2,"F",11.1,2,0)
2^F^2005.2^6^^2^F
"IX",2005.2,2005.2,"F",11.1,2,3)

"IX",2006.03,2006.03,"C",0)
2006.03^C^To Sort by Place and Queue name^R^^R^IR^I^2006.03^^^^^LS
"IX",2006.03,2006.03,"C",1)
S ^MAGQUEUE(2006.03,"C",X(1),$E(X(2),1,30),DA)=""
"IX",2006.03,2006.03,"C",2)
K ^MAGQUEUE(2006.03,"C",X(1),$E(X(2),1,30),DA)
"IX",2006.03,2006.03,"C",2.5)
K ^MAGQUEUE(2006.03,"C")
"IX",2006.03,2006.03,"C",11.1,0)
^.114IA^2^2
"IX",2006.03,2006.03,"C",11.1,1,0)
1^F^2006.03^.04^^1^F
"IX",2006.03,2006.03,"C",11.1,1,3)

"IX",2006.03,2006.03,"C",11.1,2,0)
2^F^2006.03^.01^30^2^F
"IX",2006.03,2006.03,"C",11.1,2,3)

"IX",2006.03,2006.03,"D",0)
2006.03^D^Status^R^^R^IR^I^2006.03^^^^^LS
"IX",2006.03,2006.03,"D",1)
S ^MAGQUEUE(2006.03,"D",X(1),$E(X(2),1,30),$E(X(3),1,30),DA)=""
"IX",2006.03,2006.03,"D",2)
K ^MAGQUEUE(2006.03,"D",X(1),$E(X(2),1,30),$E(X(3),1,30),DA)
"IX",2006.03,2006.03,"D",2.5)
K ^MAGQUEUE(2006.03,"D")
"IX",2006.03,2006.03,"D",11.1,0)
^.114IA^3^3
"IX",2006.03,2006.03,"D",11.1,1,0)
1^F^2006.03^.04^^1^F
"IX",2006.03,2006.03,"D",11.1,1,3)

"IX",2006.03,2006.03,"D",11.1,2,0)
2^F^2006.03^.01^30^2^F
"IX",2006.03,2006.03,"D",11.1,2,3)

"IX",2006.03,2006.03,"D",11.1,3,0)
3^F^2006.03^4^30^3^F
"IX",2006.03,2006.03,"D",11.1,3,3)

"IX",2006.03,2006.03,"E",0)
2006.03^E^Place and Image number index to prevent redundant queues^R^^R^IR^I^2006.03^^^^^LS
"IX",2006.03,2006.03,"E",1)
S ^MAGQUEUE(2006.03,"E",X(1),$E(X(2),1,30),DA)=""
"IX",2006.03,2006.03,"E",1.4)
I $P(^MAGQUEUE(2006.03,DA,0),U)["JUKEBOX"
"IX",2006.03,2006.03,"E",2)
K ^MAGQUEUE(2006.03,"E",X(1),$E(X(2),1,30),DA)
"IX",2006.03,2006.03,"E",2.4)
I $P(^MAGQUEUE(2006.03,DA,0),U)["JUKEBOX"
"IX",2006.03,2006.03,"E",2.5)
K ^MAGQUEUE(2006.03,"E")
"IX",2006.03,2006.03,"E",11.1,0)
^.114IA^2^2
"IX",2006.03,2006.03,"E",11.1,1,0)
1^F^2006.03^.04^^1^F
"IX",2006.03,2006.03,"E",11.1,1,3)

"IX",2006.03,2006.03,"E",11.1,2,0)
2^F^2006.03^6^30^2^F
"IX",2006.03,2006.03,"E",11.1,2,3)

"IX",2006.03,2006.03,"F",0)
2006.03^F^Place, image number, type index^R^^R^IR^I^2006.03^^^^^LS
"IX",2006.03,2006.03,"F",.1,0)
^^2^2^3010313^
"IX",2006.03,2006.03,"F",.1,1,0)
This X-REF is used to prevent redundent queuing of images when
"IX",2006.03,2006.03,"F",.1,2,0)
network throughput is at a premium.
"IX",2006.03,2006.03,"F",1)
S ^MAGQUEUE(2006.03,"F",X(1),$E(X(2),1,30),$E(X(3),1,30),DA)=""
"IX",2006.03,2006.03,"F",1.4)
I (($P(^MAGQUEUE(2006.03,DA,0),U)["JBTOHD")&($P(^MAGQUEUE(2006.03,DA,0),U,7)?1N.N))
"IX",2006.03,2006.03,"F",2)
K ^MAGQUEUE(2006.03,"F",X(1),$E(X(2),1,30),$E(X(3),1,30),DA)
"IX",2006.03,2006.03,"F",2.4)
I (($P(^MAGQUEUE(2006.03,DA,0),U)["JBTOHD")&($P(^MAGQUEUE(2006.03,DA,0),U,7)?1N.N))
"IX",2006.03,2006.03,"F",2.5)
K ^MAGQUEUE(2006.03,"F")
"IX",2006.03,2006.03,"F",11.1,0)
^.114IA^3^3
"IX",2006.03,2006.03,"F",11.1,1,0)
1^F^2006.03^.04^^1^F
"IX",2006.03,2006.03,"F",11.1,1,3)

"IX",2006.03,2006.03,"F",11.1,2,0)
2^F^2006.03^6^30^2^F
"IX",2006.03,2006.03,"F",11.1,2,3)

"IX",2006.03,2006.03,"F",11.1,3,0)
3^F^2006.03^7^30^3^F
"IX",2006.03,2006.03,"F",11.1,3,3)

"IX",2006.031,2006.031,"C",0)
2006.031^C^Place and type index^R^^R^IR^I^2006.031^^^^^LS
"IX",2006.031,2006.031,"C",1)
S ^MAGQUEUE(2006.031,"C",X(1),$E(X(2),1,30),DA)=""
"IX",2006.031,2006.031,"C",2)
K ^MAGQUEUE(2006.031,"C",X(1),$E(X(2),1,30),DA)
"IX",2006.031,2006.031,"C",2.5)
K ^MAGQUEUE(2006.031,"C")
"IX",2006.031,2006.031,"C",11.1,0)
^.114IA^2^2
"IX",2006.031,2006.031,"C",11.1,1,0)
1^F^2006.031^.04^^1^F
"IX",2006.031,2006.031,"C",11.1,1,3)

"IX",2006.031,2006.031,"C",11.1,2,0)
2^F^2006.031^.01^30^2^F
"IX",2006.031,2006.031,"C",11.1,2,3)

"IX",2006.032,2006.032,"C",0)
2006.032^C^Place and Jukeox index^R^^R^IR^I^2006.032^^^^^LS
"IX",2006.032,2006.032,"C",1)
S ^MAGQUEUE(2006.032,"C",X(1),$E(X(2),1,30),DA)=""
"IX",2006.032,2006.032,"C",2)
K ^MAGQUEUE(2006.032,"C",X(1),$E(X(2),1,30),DA)
"IX",2006.032,2006.032,"C",2.5)
K ^MAGQUEUE(2006.032,"C")
"IX",2006.032,2006.032,"C",11.1,0)
^.114IA^2^2
"IX",2006.032,2006.032,"C",11.1,1,0)
1^F^2006.032^.04^^1^F
"IX",2006.032,2006.032,"C",11.1,1,3)

"IX",2006.032,2006.032,"C",11.1,2,0)
2^F^2006.032^.01^30^2^F
"IX",2006.032,2006.032,"C",11.1,2,3)

"IX",2006.8,2006.8,"C",0)
2006.8^C^Place^R^^R^IR^I^2006.8^^^^^LS
"IX",2006.8,2006.8,"C",1)
S ^MAG(2006.8,"C",X(1),$E(X(2),1,30),DA)=""
"IX",2006.8,2006.8,"C",2)
K ^MAG(2006.8,"C",X(1),$E(X(2),1,30),DA)
"IX",2006.8,2006.8,"C",2.5)
K ^MAG(2006.8,"C")
"IX",2006.8,2006.8,"C",11.1,0)
^.114IA^2^2
"IX",2006.8,2006.8,"C",11.1,1,0)
1^F^2006.8^.04^^1^F
"IX",2006.8,2006.8,"C",11.1,1,3)

"IX",2006.8,2006.8,"C",11.1,2,0)
2^F^2006.8^50^30^2^F
"IX",2006.8,2006.8,"C",11.1,2,3)

"IX",2006.82,2006.82,"ACDUZ",0)
2006.82^ACDUZ^CR by DUZ and Start Time^R^^R^IR^I^2006.82^^^^^S
"IX",2006.82,2006.82,"ACDUZ",1)
S ^MAG(2006.82,"ACDUZ",$E(X(1),1,30),$E(X(2),1,30),DA)=""
"IX",2006.82,2006.82,"ACDUZ",2)
K ^MAG(2006.82,"ACDUZ",$E(X(1),1,30),$E(X(2),1,30),DA)
"IX",2006.82,2006.82,"ACDUZ",2.5)
K ^MAG(2006.82,"ACDUZ")
"IX",2006.82,2006.82,"ACDUZ",11.1,0)
^.114IA^2^2
"IX",2006.82,2006.82,"ACDUZ",11.1,1,0)
1^F^2006.82^1^30^1^F
"IX",2006.82,2006.82,"ACDUZ",11.1,1,3)

"IX",2006.82,2006.82,"ACDUZ",11.1,2,0)
2^F^2006.82^2^30^2^F
"IX",2006.82,2006.82,"ACDUZ",11.1,2,3)

"IX",2006.82,2006.82,"APL",0)
2006.82^APL^Place and Date^R^^R^IR^I^2006.82^^^^^S
"IX",2006.82,2006.82,"APL",.1,0)
^^1^1^3041027^
"IX",2006.82,2006.82,"APL",.1,1,0)
This allows sorting by Place and Start Time.
"IX",2006.82,2006.82,"APL",1)
S ^MAG(2006.82,"APL",X(1),X(2),DA)=""
"IX",2006.82,2006.82,"APL",2)
K ^MAG(2006.82,"APL",X(1),X(2),DA)
"IX",2006.82,2006.82,"APL",2.5)
K ^MAG(2006.82,"APL")
"IX",2006.82,2006.82,"APL",11.1,0)
^.114IA^2^2
"IX",2006.82,2006.82,"APL",11.1,1,0)
1^F^2006.82^.04^^1^F
"IX",2006.82,2006.82,"APL",11.1,1,3)

"IX",2006.82,2006.82,"APL",11.1,2,0)
2^F^2006.82^2^^2^F
"IX",2006.82,2006.82,"APL",11.1,2,3)

"KRN",8994,652,-1)
0^3
"KRN",8994,652,0)
MAGQ FS CHNGE^CHGSERV^MAGQBUT^1^R
"KRN",8994,652,1,0)
^8994.01^7^7^3060110^^
"KRN",8994,652,1,1,0)
Finds the available network file server with the most space, 
"KRN",8994,652,1,2,0)
changes the current write space pointer and returns the IEN.
"KRN",8994,652,1,3,0)
The candidate list requires the following criteria:
"KRN",8994,652,1,4,0)
ONLINE
"KRN",8994,652,1,5,0)
type: MAG
"KRN",8994,652,1,6,0)
path does not contain: ":"
"KRN",8994,652,1,7,0)
NON-ROUTER
"KRN",8994,652,2,0)
^8994.02A^2^2
"KRN",8994,652,2,1,0)
null
"KRN",8994,652,2,1,1,0)
^^1^1^3000505^
"KRN",8994,652,2,1,1,1,0)
No input parameter required.
"KRN",8994,652,2,2,0)
NOTIFY^1^2^1^1
"KRN",8994,652,2,2,1,0)
^^4^4^3060110^
"KRN",8994,652,2,2,1,1,0)
If this value is set to '1' then if the share space does not meet the lower
"KRN",8994,652,2,2,1,2,0)
limit as established by the PERCENT SERVER RESERVE (#11) 
"KRN",8994,652,2,2,1,3,0)
in the SITE PARAMETER FILE (#2006.1) then a message will be
"KRN",8994,652,2,2,1,4,0)
sent to the G.MAG SERVER mail group.
"KRN",8994,652,2,"B","NOTIFY",2)

"KRN",8994,652,2,"B","null",1)

"KRN",8994,652,2,"PARAMSEQ",1,2)

"KRN",8994,652,3,0)
^8994.03^2^2^3060110^^
"KRN",8994,652,3,1,0)
Returns 0 if unsuccessful , 1 if successful in the first piece
"KRN",8994,652,3,2,0)
network location^network share path in pieces 2 and 3
"KRN",8994,2072,-1)
0^1
"KRN",8994,2072,0)
MAGQ COQ^FOQUE^MAGQBUT^1^S^0
"KRN",8994,2072,1,0)
^8994.01^4^4^3050323^
"KRN",8994,2072,1,1,0)
The QUEUE types: "JUKEBOX","JBTOHD","PREFET","IMPORT","GCC","DELETE"
"KRN",8994,2072,1,2,0)
are purged that are in the failed queue partion of the queue file. 
"KRN",8994,2072,1,3,0)
The partition is designated by the position in the queue file (#2006.03)
"KRN",8994,2072,1,4,0)
by the queue pointer from the Queue pointer file (#2006.031).
"KRN",8994,2072,3,0)
^^1^1^3050323^
"KRN",8994,2072,3,1,0)
This is the queue type.
"KRN",8994,2073,-1)
0^2
"KRN",8994,2073,0)
MAGQ QCNT^QCNT^MAGQBUT4^1^R
"KRN",8994,2073,1,0)
^8994.01^1^1^3050608^^
"KRN",8994,2073,1,1,0)
This call resets the Queue pointer settings in the Imaging Queue Pointer file, #2006.031.
"KRN",8994,2073,2,0)
^8994.02A^2^2
"KRN",8994,2073,2,1,0)
place^1^999^1^1
"KRN",8994,2073,2,1,1,0)
^8994.021^1^1^3050608^^
"KRN",8994,2073,2,1,1,1,0)
This field represents the internal entry number of the site parameter file, #2006.1.
"KRN",8994,2073,2,2,0)
QUEUE^1^33^1^2
"KRN",8994,2073,2,2,1,0)
^^1^1^3050608^
"KRN",8994,2073,2,2,1,1,0)
This is the queue entry to be updated by this method.
"KRN",8994,2073,2,"B","QUEUE",2)

"KRN",8994,2073,2,"B","place",1)

"KRN",8994,2073,2,"PARAMSEQ",1,1)

"KRN",8994,2073,2,"PARAMSEQ",2,2)

"MBREQ")
0
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"PKG",454,-1)
1^1
"PKG",454,0)
IMAGING^MAG^Imaging-V1 to release 
"PKG",454,20,0)
^9.402P^^
"PKG",454,22,0)
^9.49I^1^1
"PKG",454,22,1,0)
3.0^3020319^3020517^126
"PKG",454,22,1,"PAH",1,0)
20^3060412^126
"PKG",454,22,1,"PAH",1,1,0)
^^35^35^3060412
"PKG",454,22,1,"PAH",1,1,1,0)
Select BUILD NAME:    MAG*3.0*20     IMAGING
"PKG",454,22,1,"PAH",1,1,2,0)
MAGBAPI   value = 74386027
"PKG",454,22,1,"PAH",1,1,3,0)
MAGBAPIP  value = 8622481
"PKG",454,22,1,"PAH",1,1,4,0)
MAGDIR82  value = 62866214
"PKG",454,22,1,"PAH",1,1,5,0)
MAGDLB12  value = 22838427
"PKG",454,22,1,"PAH",1,1,6,0)
MAGGSIUI  value = 60693392
"PKG",454,22,1,"PAH",1,1,7,0)
MAGGSIV   value = 38730975
"PKG",454,22,1,"PAH",1,1,8,0)
MAGGSIV1  value = 21788454
"PKG",454,22,1,"PAH",1,1,9,0)
MAGGTU3   value = 61285454
"PKG",454,22,1,"PAH",1,1,10,0)
MAGGTU6   value = 64383471
"PKG",454,22,1,"PAH",1,1,11,0)
MAGGTU7   value = 22552210
"PKG",454,22,1,"PAH",1,1,12,0)
MAGIPS20  value = 26957915
"PKG",454,22,1,"PAH",1,1,13,0)
MAGIPT20  value = 70909996
"PKG",454,22,1,"PAH",1,1,14,0)
MAGLOG    value = 6935907
"PKG",454,22,1,"PAH",1,1,15,0)
MAGQBAB   value = 10838980
"PKG",454,22,1,"PAH",1,1,16,0)
MAGQBD    value = 7129737
"PKG",454,22,1,"PAH",1,1,17,0)
MAGQBGCC  value = 11208984
"PKG",454,22,1,"PAH",1,1,18,0)
MAGQBIM   value = 7456958
"PKG",454,22,1,"PAH",1,1,19,0)
MAGQBJB   value = 18032148
"PKG",454,22,1,"PAH",1,1,20,0)
MAGQBJH   value = 24339395
"PKG",454,22,1,"PAH",1,1,21,0)
MAGQBJHR  value = 14061671
"PKG",454,22,1,"PAH",1,1,22,0)
MAGQBPG1  value = 74002571
"PKG",454,22,1,"PAH",1,1,23,0)
MAGQBPG2  value = 20522184
"PKG",454,22,1,"PAH",1,1,24,0)
MAGQBPRG  value = 57111603
"PKG",454,22,1,"PAH",1,1,25,0)
MAGQBTM   value = 79154449
"PKG",454,22,1,"PAH",1,1,26,0)
MAGQBUT   value = 78801561
"PKG",454,22,1,"PAH",1,1,27,0)
MAGQBUT1  value = 75489141
"PKG",454,22,1,"PAH",1,1,28,0)
MAGQBUT2  value = 73670919
"PKG",454,22,1,"PAH",1,1,29,0)
MAGQBUT4  value = 78268087
"PKG",454,22,1,"PAH",1,1,30,0)
MAGQBUT5  value = 13804118
"PKG",454,22,1,"PAH",1,1,31,0)
MAGQE1    value = 11840891
"PKG",454,22,1,"PAH",1,1,32,0)
MAGQE2    value = 17337879
"PKG",454,22,1,"PAH",1,1,33,0)
MAGQE3    value = 75394836
"PKG",454,22,1,"PAH",1,1,34,0)
MAGQE5    value = 48023547
"PKG",454,22,1,"PAH",1,1,35,0)
MAGUSIT   value = 17597745
"PRE")
MAGIPS20
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
35
"RTN","MAGBAPI")
0^1^B74386027
"RTN","MAGBAPI",1,0)
MAGBAPI ;WOIFO/PMK,RMP,SEB,MLH - Background Processor API to build queues ; 08/26/2003  07:04
"RTN","MAGBAPI",2,0)
 ;;3.0;IMAGING;**1,7,8,20**;Apr 12, 2006
"RTN","MAGBAPI",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGBAPI",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGBAPI",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGBAPI",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGBAPI",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGBAPI",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGBAPI",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGBAPI",10,0)
 ;; |                                                               |
"RTN","MAGBAPI",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGBAPI",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGBAPI",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGBAPI",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGBAPI",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGBAPI",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGBAPI",17,0)
 ;;
"RTN","MAGBAPI",18,0)
 ; The API returns the entry's queue pointer
"RTN","MAGBAPI",19,0)
 ;
"RTN","MAGBAPI",20,0)
ABSTRACT(INPUT,PLACE) ; Entry point to create an image abstract
"RTN","MAGBAPI",21,0)
 ; input = image pointer
"RTN","MAGBAPI",22,0)
 Q:$$IMOFFLN^MAGFILEB($P($G(^MAG(2005,INPUT,0)),U,2)) 0
"RTN","MAGBAPI",23,0)
 S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE 0 ; DBI - SEB Patch 4
"RTN","MAGBAPI",24,0)
 Q $$QUEUE("ABSTRACT",INPUT,PLACE)
"RTN","MAGBAPI",25,0)
 ;
"RTN","MAGBAPI",26,0)
GCC(INPUT,PLACE) ; Entry point to create an Document Imaging Export Copy
"RTN","MAGBAPI",27,0)
 ; input = image pointer(^Second Piece Optional Location specified^3rd optional extension(s) specifier)
"RTN","MAGBAPI",28,0)
 S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE 0 ; DBI - SEB Patch 4
"RTN","MAGBAPI",29,0)
 Q $$QUEUE("GCC",$P(INPUT,"^")_"^^"_$P(INPUT,"^",4)_"^"_$P(INPUT,"^",2,3),PLACE)
"RTN","MAGBAPI",30,0)
JUKEBOX(INPUT,PLACE) ; Entry point to copy an image file and abstract to the Jukebox
"RTN","MAGBAPI",31,0)
 ; input = image pointer
"RTN","MAGBAPI",32,0)
 N NEXT,CONS,GB
"RTN","MAGBAPI",33,0)
 S GB=$G(^MAG(2005,INPUT,0))
"RTN","MAGBAPI",34,0)
 S:GB="" GB=$G(^MAG(2005.1,INPUT,0))
"RTN","MAGBAPI",35,0)
 Q:GB="" 0
"RTN","MAGBAPI",36,0)
 Q:$$IMOFFLN^MAGFILEB($P(GB,U,2)) 0
"RTN","MAGBAPI",37,0)
 S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE 0 ; DBI - SEB Patch 4
"RTN","MAGBAPI",38,0)
 S CONS=$$CONSOLID()
"RTN","MAGBAPI",39,0)
 S NEXT=$O(^MAGQUEUE(2006.03,"E",PLACE,$P(INPUT,"^"),$$NEXTQ("JUKEBOX",PLACE)))
"RTN","MAGBAPI",40,0)
 Q:NEXT?1N.N NEXT
"RTN","MAGBAPI",41,0)
 S NEXT=$$QUEUE("JUKEBOX",INPUT,PLACE)
"RTN","MAGBAPI",42,0)
 S ^MAGQUEUE(2006.03,"E",PLACE,$P(INPUT,"^"),NEXT)=""
"RTN","MAGBAPI",43,0)
 Q NEXT
"RTN","MAGBAPI",44,0)
DELETE(INPUT,PLACE) ; Entry point to delete a file (literally from anywhere)
"RTN","MAGBAPI",45,0)
 ; input = full path of file to delete
"RTN","MAGBAPI",46,0)
 N IMOD
"RTN","MAGBAPI",47,0)
 S IMOD=$S(INPUT[U:"^^"_INPUT,1:"^^^"_INPUT)
"RTN","MAGBAPI",48,0)
 S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE 0 ; DBI - SEB Patch 4
"RTN","MAGBAPI",49,0)
 Q $$QUEUE("DELETE",IMOD,PLACE) ;SETS 9TH & 10TH PIECE
"RTN","MAGBAPI",50,0)
IMPORT(INPUT,CALLBACK,TRACKID,PLACE) ; Entry point to import a file
"RTN","MAGBAPI",51,0)
 ; input = Image Parameter Array
"RTN","MAGBAPI",52,0)
 ; Callback = the process called with the results of the import activity
"RTN","MAGBAPI",53,0)
 N QUEIEN,INDX,FDA,DINUM,%,MS1,CT,REQUE,TMP
"RTN","MAGBAPI",54,0)
 S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE "0^Missing PLACE parameter" ; DBI - SEB Patch 4
"RTN","MAGBAPI",55,0)
 S REQUE=$S($P($G(INPUT),"^",3)'?1N.N:0,1:1)
"RTN","MAGBAPI",56,0)
 I REQUE=0 Q:($O(^MAG(2006.041,"C",TRACKID,""))?1N.N) "0^Duplicate Tracking ID"
"RTN","MAGBAPI",57,0)
 S QUEIEN=$$QUEUE("IMPORT","^^"_$P($G(INPUT),"^",3)_U_$TR(CALLBACK,"^","|")_U_$P($G(INPUT),"^",4),PLACE)
"RTN","MAGBAPI",58,0)
 I REQUE=0 D
"RTN","MAGBAPI",59,0)
 . S $P(^MAGQUEUE(2006.03,QUEIEN,0),"^",11)=QUEIEN
"RTN","MAGBAPI",60,0)
 . S (DINUM,X)=QUEIEN,DIC="^MAG(2006.034,",DLAYGO="2006.034",DIC(0)="L"
"RTN","MAGBAPI",61,0)
 . D FILE^DICN
"RTN","MAGBAPI",62,0)
 . K DIC
"RTN","MAGBAPI",63,0)
 . S CT=0
"RTN","MAGBAPI",64,0)
 . D CONV^MAGQBUT4(.INPUT,.CT)
"RTN","MAGBAPI",65,0)
 . D MRGMULT^MAGQBUT4(.INPUT,"^MAG(2006.034,"_QUEIEN_",1,","2006.341A",CT)
"RTN","MAGBAPI",66,0)
 D NOW^%DTC
"RTN","MAGBAPI",67,0)
 K DIE,FDA
"RTN","MAGBAPI",68,0)
 S FDA(2006.041,"+1,",.01)=$S(REQUE=0:QUEIEN,1:$P($G(INPUT),"^",4))
"RTN","MAGBAPI",69,0)
 S FDA(2006.041,"+1,",.02)=TRACKID
"RTN","MAGBAPI",70,0)
 S FDA(2006.041,"+1,",1)=$S(REQUE=0:"QUEUING",1:"REQUEUING")
"RTN","MAGBAPI",71,0)
 S FDA(2006.041,"+1,",2)=%
"RTN","MAGBAPI",72,0)
 D UPDATE^DIE("U","FDA","","MAGIMP")
"RTN","MAGBAPI",73,0)
 I $D(DIERR) S TMP=MAGIMP("DIERR",1,"TEXT",1) K DIERR,MAGIMP
"RTN","MAGBAPI",74,0)
 Q $S($D(TMP):"0^"_TMP,1:QUEIEN)
"RTN","MAGBAPI",75,0)
 ;
"RTN","MAGBAPI",76,0)
JBTOHD(INPUT,PLACE) ; Entry point to copy an image from the Jukebox to the Hard Disk
"RTN","MAGBAPI",77,0)
 ; input = image pointer ^ FULL or ABSTRACT or BIG
"RTN","MAGBAPI",78,0)
 N NEXT,IEN,JDTYPE,CONS
"RTN","MAGBAPI",79,0)
 S IEN=$P(INPUT,"^"),JDTYPE=$P(INPUT,"^",2)
"RTN","MAGBAPI",80,0)
 Q:$$IMOFFLN^MAGFILEB($P($G(^MAG(2005,IEN,0)),U,2)) 0
"RTN","MAGBAPI",81,0)
 I 'PLACE S PLACE=$$DA2PLC^MAGBAPIP(IEN,$S(JDTYPE["ABSTRACT":"A",JDTYPE["BIG":"B",1:"F"))
"RTN","MAGBAPI",82,0)
 E  S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE 0 ; DBI - SEB Patch 4
"RTN","MAGBAPI",83,0)
 S NEXT=$O(^MAGQUEUE(2006.03,"F",PLACE,IEN,JDTYPE,$$NEXTQ("JBTOHD",PLACE)))
"RTN","MAGBAPI",84,0)
 Q:NEXT?1N.N NEXT
"RTN","MAGBAPI",85,0)
 S NEXT=$$QUEUE("JBTOHD",INPUT,PLACE)
"RTN","MAGBAPI",86,0)
 S ^MAGQUEUE(2006.03,"F",PLACE,$P(INPUT,"^"),$P(INPUT,"^",2),NEXT)=""
"RTN","MAGBAPI",87,0)
 Q NEXT
"RTN","MAGBAPI",88,0)
 ;
"RTN","MAGBAPI",89,0)
PREFET(INPUT,PLACE) ;
"RTN","MAGBAPI",90,0)
 ; input = image pointer ^ FULL or ABSTRACT or BIG
"RTN","MAGBAPI",91,0)
 N NEXT,IEN,JDTYPE,CONS
"RTN","MAGBAPI",92,0)
 S IEN=$P(INPUT,"^"),JDTYPE=$P(INPUT,"^",2)
"RTN","MAGBAPI",93,0)
 Q:$$IMOFFLN^MAGFILEB($P($G(^MAG(2005,IEN,0)),U,2)) 0
"RTN","MAGBAPI",94,0)
 I 'PLACE S PLACE=$$DA2PLC^MAGBAPIP(IEN,$S(JDTYPE["ABSTRACT":"A",JDTYPE["BIG":"B",1:"F"))
"RTN","MAGBAPI",95,0)
 E  S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE 0 ; DBI - SEB Patch 4
"RTN","MAGBAPI",96,0)
 S IEN=$P(INPUT,"^"),JDTYPE=$P(INPUT,"^",2)
"RTN","MAGBAPI",97,0)
 S NEXT=$O(^MAGQUEUE(2006.03,"F",PLACE,IEN,JDTYPE,$$NEXTQ("PREFET",PLACE)))
"RTN","MAGBAPI",98,0)
 Q:NEXT?1N.N NEXT
"RTN","MAGBAPI",99,0)
 S NEXT=$$QUEUE("PREFET",INPUT,PLACE)
"RTN","MAGBAPI",100,0)
 S ^MAGQUEUE(2006.03,"F",PLACE,$P(INPUT,"^"),$P(INPUT,"^",2),NEXT)=""
"RTN","MAGBAPI",101,0)
 Q NEXT
"RTN","MAGBAPI",102,0)
 ;
"RTN","MAGBAPI",103,0)
EVAL(IMAGE,PLACE) ; Entry point for before rules are evaluated
"RTN","MAGBAPI",104,0)
 S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE 0 ; DBI - SEB Patch 4
"RTN","MAGBAPI",105,0)
 Q $$QUEUE("EVAL",IMAGE,PLACE)
"RTN","MAGBAPI",106,0)
 ;
"RTN","MAGBAPI",107,0)
NEXTQ(TYPE,PLACE) ;
"RTN","MAGBAPI",108,0)
 N X
"RTN","MAGBAPI",109,0)
 S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE 0 ; DBI - SEB Patch 4
"RTN","MAGBAPI",110,0)
 S X=$O(^MAGQUEUE(2006.031,"C",PLACE,TYPE,""))
"RTN","MAGBAPI",111,0)
 Q $S('X:X,1:$P(^MAGQUEUE(2006.031,X,0),"^",2))
"RTN","MAGBAPI",112,0)
 ;
"RTN","MAGBAPI",113,0)
QUEUE(Q,INPUT,PLACE) ; Stuff the entry (header + INPUT) into the appropriate queue (Q)
"RTN","MAGBAPI",114,0)
 N %,%H,%I,QPTR,QTR,X,Y,STATUS
"RTN","MAGBAPI",115,0)
 S U="^",STATUS="NOT_PROCESSED"
"RTN","MAGBAPI",116,0)
 S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE 0 ; DBI - SEB Patch 4
"RTN","MAGBAPI",117,0)
 ; increment the QPTR
"RTN","MAGBAPI",118,0)
 ;
"RTN","MAGBAPI",119,0)
 L +^MAGQUEUE(2006.03,0)
"RTN","MAGBAPI",120,0)
 S X=^MAGQUEUE(2006.03,0)
"RTN","MAGBAPI",121,0)
 S QPTR=$O(^MAGQUEUE(2006.03," "),-1)+1
"RTN","MAGBAPI",122,0)
 S QPTR=$S(QPTR<+$P(X,U,3):$P(X,U,3)+1,1:QPTR)
"RTN","MAGBAPI",123,0)
 S $P(X,"^",3)=QPTR,$P(X,"^",4)=$P(X,"^",4)+1
"RTN","MAGBAPI",124,0)
 S ^MAGQUEUE(2006.03,0)=X
"RTN","MAGBAPI",125,0)
 D NOW^%DTC
"RTN","MAGBAPI",126,0)
 S ^MAGQUEUE(2006.03,QPTR,0)=Q_"^"_$G(DUZ)_"^"_^%ZOSF("VOL")_"^"_%_"^"_STATUS_"^"_%_"^"_INPUT
"RTN","MAGBAPI",127,0)
 S ^MAGQUEUE(2006.03,"C",PLACE,Q,QPTR)="",$P(^MAGQUEUE(2006.03,QPTR,0),"^",12)=PLACE
"RTN","MAGBAPI",128,0)
 S ^MAGQUEUE(2006.03,"D",PLACE,Q,STATUS,QPTR)=""
"RTN","MAGBAPI",129,0)
 L -^MAGQUEUE(2006.03,0)
"RTN","MAGBAPI",130,0)
 D ADD(1,Q,PLACE)
"RTN","MAGBAPI",131,0)
 Q QPTR
"RTN","MAGBAPI",132,0)
ADD(N,QUEUE,PLACE) ;
"RTN","MAGBAPI",133,0)
 ;
"RTN","MAGBAPI",134,0)
 N CNT,D0,I,X,CONS,PREV,QTOT
"RTN","MAGBAPI",135,0)
 S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE 0
"RTN","MAGBAPI",136,0)
 S D0=$O(^MAGQUEUE(2006.031,"C",PLACE,QUEUE,""))
"RTN","MAGBAPI",137,0)
 D:'D0
"RTN","MAGBAPI",138,0)
 . L +^MAGQUEUE(2006.031)
"RTN","MAGBAPI",139,0)
 . S D0=$O(^MAGQUEUE(2006.031," "),-1)+1
"RTN","MAGBAPI",140,0)
 . S ^MAGQUEUE(2006.031,D0,0)=QUEUE_"^0^0^"_PLACE_U
"RTN","MAGBAPI",141,0)
 . S ^MAGQUEUE(2006.031,"C",PLACE,QUEUE,D0)=""
"RTN","MAGBAPI",142,0)
 . S X="IMAGE BACKGROUND QUEUE POINTER^2006.031^"_D0_"^"_D0
"RTN","MAGBAPI",143,0)
 . S ^MAGQUEUE(2006.031,0)=X
"RTN","MAGBAPI",144,0)
 . L -^MAGQUEUE(2006.031)
"RTN","MAGBAPI",145,0)
 . Q
"RTN","MAGBAPI",146,0)
 L +^MAGQUEUE(2006.031,D0)
"RTN","MAGBAPI",147,0)
 S X=^MAGQUEUE(2006.031,D0,0),CNT=$P(X,U,3),PREV=$P(X,U,2),QTOT=$P(X,U,5)
"RTN","MAGBAPI",148,0)
 I CNT?1.N S CNT=CNT+N
"RTN","MAGBAPI",149,0)
 E  D
"RTN","MAGBAPI",150,0)
 . S I=$P(X,"^",2),CNT=0
"RTN","MAGBAPI",151,0)
 . F  S I=$O(^MAGQUEUE(2006.03,"C",PLACE,QUEUE,I)) Q:I'?1N.N  S CNT=CNT+1
"RTN","MAGBAPI",152,0)
 . Q
"RTN","MAGBAPI",153,0)
 S $P(X,U,4)=PLACE
"RTN","MAGBAPI",154,0)
 S:N>0 QTOT=QTOT+N
"RTN","MAGBAPI",155,0)
 I QUEUE'["IMPORT",$D(QPTR),QPTR<(PREV+1) S $P(X,"^",2)=QPTR-1
"RTN","MAGBAPI",156,0)
 S $P(X,U,3)=CNT,$P(X,U,5)=QTOT,^MAGQUEUE(2006.031,D0,0)=X
"RTN","MAGBAPI",157,0)
 L -^MAGQUEUE(2006.031,D0)
"RTN","MAGBAPI",158,0)
 Q
"RTN","MAGBAPI",159,0)
CWL(PLACE) ;Current Write Location
"RTN","MAGBAPI",160,0)
 S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE 0 ; DBI - SEB Patch 4
"RTN","MAGBAPI",161,0)
 Q $P($G(^MAG(2006.1,PLACE,0)),"^",3)
"RTN","MAGBAPI",162,0)
PLACE(IEN) ;
"RTN","MAGBAPI",163,0)
 Q $$GETPLACE(+$O(^MAG(2006.1,"B",IEN,"")))
"RTN","MAGBAPI",164,0)
CWP(PLACE) ;Current Write Platter
"RTN","MAGBAPI",165,0)
 N JBPTR
"RTN","MAGBAPI",166,0)
 S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE 0 ; DBI - SEB Patch 4
"RTN","MAGBAPI",167,0)
 S JBPTR=$$JBPTR(PLACE) Q:'JBPTR 0
"RTN","MAGBAPI",168,0)
 Q $P($G(^MAGQUEUE(2006.032,JBPTR,0)),"^",3)
"RTN","MAGBAPI",169,0)
JBPTR(PLACE) ;Current JukeBox Pointer
"RTN","MAGBAPI",170,0)
 S PLACE=$$GETPLACE($G(PLACE)) Q:'PLACE 0 ; DBI - SEB Patch 4
"RTN","MAGBAPI",171,0)
 Q $P($G(^MAG(2006.1,PLACE,1)),"^",6)
"RTN","MAGBAPI",172,0)
GETPLACE(PLACE) ; Validate place
"RTN","MAGBAPI",173,0)
 N SP
"RTN","MAGBAPI",174,0)
 S SP=$G(PLACE)
"RTN","MAGBAPI",175,0)
 S PLACE=+$S($$CONSOLID():+$G(PLACE),1:$O(^MAG(2006.1," "),-1))
"RTN","MAGBAPI",176,0)
 I PLACE,$P($G(^MAG(2006.1,PLACE,0)),"^",1)="" S PLACE=0
"RTN","MAGBAPI",177,0)
 I 'PLACE,$$MAXREP(10) D
"RTN","MAGBAPI",178,0)
 . N I,MSG,S,T,J
"RTN","MAGBAPI",179,0)
 . S MSG="Application process failure"
"RTN","MAGBAPI",180,0)
 . S I=1,MSG(I)="Cannot determine 'place' (location, division, institution) for image."
"RTN","MAGBAPI",181,0)
 . S T=$J("At",11) F S=$ST-1:-1:0 D
"RTN","MAGBAPI",182,0)
 . . S I=I+1,MSG(I)=T_": "_$ST(S,"PLACE")_" = "_$ST(S,"MCODE"),T="Called From"
"RTN","MAGBAPI",183,0)
 . . Q
"RTN","MAGBAPI",184,0)
 . I $D(MAGARRAY) D
"RTN","MAGBAPI",185,0)
 . . S J="",I=I+1,MSG(I)="MAGARRAY"
"RTN","MAGBAPI",186,0)
 . . F  S J=$O(MAGARRAY(J)) Q:J=""  D
"RTN","MAGBAPI",187,0)
 . . . S I=I+1,MSG(I)="MAGARRAY("_J_")"_MAGARRAY(J)
"RTN","MAGBAPI",188,0)
 . . Q
"RTN","MAGBAPI",189,0)
 . I $D(XWBTBUF) S I=I+1,MSG(I)="XWBTBUF: "_XWBTBUF
"RTN","MAGBAPI",190,0)
 . I $D(MAGDA) S I=I+1,MSG(I)="MAGDA: "_MAGDA
"RTN","MAGBAPI",191,0)
 . I $D(MAGGDA) S I=I+1,MSG(I)="MAGGDA: "_MAGGDA
"RTN","MAGBAPI",192,0)
 . I $D(MAGGIEN("1")) S I=I+1,MSG(I)="MAGGIEN(""1""): "_MAGGIEN("1")
"RTN","MAGBAPI",193,0)
 . S:$G(DUZ) I=I+1,MSG(I)="The USER was: "_$$GET1^DIQ(200,DUZ,".01","E")_" DUZ: "_DUZ
"RTN","MAGBAPI",194,0)
 . S:$G(DUZ(2)) I=I+1,MSG(I)="The USER had a DUZ(2) setting of: "_DUZ(2)
"RTN","MAGBAPI",195,0)
 . S I=I+1,MSG(I)="The original value of the INPUT Parameter 'PLACE' was: "_SP
"RTN","MAGBAPI",196,0)
 . S I=I+1,MSG(I)="This fault may result in the failure to archive or process images."
"RTN","MAGBAPI",197,0)
 . S I=I+1,MSG(I)="Please log a NOIS-call."
"RTN","MAGBAPI",198,0)
 . S I="" F  S I=$O(MSG(I)) Q:I=""  D DFNIQ^MAGQBPG1("",MSG(I),0)
"RTN","MAGBAPI",199,0)
 . D DFNIQ^MAGQBPG1("",MSG,1)
"RTN","MAGBAPI",200,0)
 . Q
"RTN","MAGBAPI",201,0)
 Q PLACE
"RTN","MAGBAPI",202,0)
MAXREP(MAX) ;
"RTN","MAGBAPI",203,0)
 N REP,CNT
"RTN","MAGBAPI",204,0)
 I $P($G(^MAG(2006.1,"WARNING","MAGBAPI")),U,1)=$P($$NOW^XLFDT,".") D
"RTN","MAGBAPI",205,0)
 . S CNT=+$P($G(^MAG(2006.1,"WARNING","MAGBAPI")),U,2)+1
"RTN","MAGBAPI",206,0)
 . S REP=$S(CNT<MAX:1,1:0)
"RTN","MAGBAPI",207,0)
 . S $P(^MAG(2006.1,"WARNING","MAGBAPI"),U,2)=CNT
"RTN","MAGBAPI",208,0)
 E  D
"RTN","MAGBAPI",209,0)
 . I $D(^MAG(2006.1,"WARNING","MAGBAPI")) D
"RTN","MAGBAPI",210,0)
 . . N I,MSG
"RTN","MAGBAPI",211,0)
 . . S MSG="Application process failure Count"
"RTN","MAGBAPI",212,0)
 . . S I=1,MSG(I)="On the following date: "_$P(^MAG(2006.1,"WARNING","MAGBAPI"),U,1)
"RTN","MAGBAPI",213,0)
 . . S I=I+1,MSG(I)=$P(^MAG(2006.1,"WARNING","MAGBAPI"),U,2)_" were logged on the host system"
"RTN","MAGBAPI",214,0)
 . . S I=I+1,MSG(I)="The Vista Imaging Development and support team is being notified."
"RTN","MAGBAPI",215,0)
 . . S I="" F  S I=$O(MSG(I)) Q:I=""  D DFNIQ^MAGQBPG1("",MSG(I),0)
"RTN","MAGBAPI",216,0)
 . . D DFNIQ^MAGQBPG1("",MSG,1)
"RTN","MAGBAPI",217,0)
 . . Q
"RTN","MAGBAPI",218,0)
 . S REP=1,$P(^MAG(2006.1,"WARNING","MAGBAPI"),U,1,2)=$P($$NOW^XLFDT,".",1)_U_1
"RTN","MAGBAPI",219,0)
 . Q
"RTN","MAGBAPI",220,0)
 Q REP
"RTN","MAGBAPI",221,0)
CONSOLID() ;
"RTN","MAGBAPI",222,0)
 Q $GET(^MAG(2006.1,"CONSOLIDATED"))="YES"
"RTN","MAGBAPI",223,0)
CONRPC(RESULT) ;[MAGG CONS]
"RTN","MAGBAPI",224,0)
 S RESULT=$$CONSOLID^MAGBAPI()
"RTN","MAGBAPI",225,0)
 Q
"RTN","MAGBAPI",226,0)
PLACER(RESULT) ;[MAGG PLACE]
"RTN","MAGBAPI",227,0)
 S RESULT=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGBAPI",228,0)
 Q
"RTN","MAGBAPI",229,0)
 ;
"RTN","MAGBAPIP")
0^26^B8622481
"RTN","MAGBAPIP",1,0)
MAGBAPIP ;WOIFO/MLH - Background Processor API to build queues - Modules for place
"RTN","MAGBAPIP",2,0)
 ;;3.0;IMAGING;**1,7,8,20**;Apr 12, 2006
"RTN","MAGBAPIP",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGBAPIP",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGBAPIP",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGBAPIP",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGBAPIP",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGBAPIP",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGBAPIP",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGBAPIP",10,0)
 ;; |                                                               |
"RTN","MAGBAPIP",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGBAPIP",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGBAPIP",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGBAPIP",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGBAPIP",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGBAPIP",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGBAPIP",17,0)
 ;;
"RTN","MAGBAPIP",18,0)
DUZ2PLC(WARN) ; Moved from MAGGTU3 v2.5 - DBI - SEB Patch 4
"RTN","MAGBAPIP",19,0)
 ; Extrinsic : Always returns a PLACE /gek 8/2003
"RTN","MAGBAPIP",20,0)
 ; WARN          : message about where the PLACE was derived from.  /gek 8/2003
"RTN","MAGBAPIP",21,0)
 ; Compute the Users Institution for older versions of Imaging Display workstation.
"RTN","MAGBAPIP",22,0)
 ; This is called when : 
"RTN","MAGBAPIP",23,0)
 ;               DUZ(2) doesn't exist, 
"RTN","MAGBAPIP",24,0)
 ;               Or Can't resolve DUZ(2) into site param entry
"RTN","MAGBAPIP",25,0)
 N MAGINST,DIVDTA,PLACE
"RTN","MAGBAPIP",26,0)
 S MAGINST=0
"RTN","MAGBAPIP",27,0)
 D GETS^DIQ(200,DUZ,"16*","I","DIVDTA") ; look up Division field
"RTN","MAGBAPIP",28,0)
 ;                                 ? Any division data on file for this user
"RTN","MAGBAPIP",29,0)
 I $D(DIVDTA) D  ; yes, use it
"RTN","MAGBAPIP",30,0)
 . S MAGINST=@$Q(DIVDTA),WARN="Using first Division of New Person File."
"RTN","MAGBAPIP",31,0)
 . Q
"RTN","MAGBAPIP",32,0)
 E  D  ;                   no, use default site param?
"RTN","MAGBAPIP",33,0)
 . S MAGINST=$$KSP^XUPARAM("INST"),WARN="Using Kernel Site Param default entry." Q
"RTN","MAGBAPIP",34,0)
 . Q
"RTN","MAGBAPIP",35,0)
 S PLACE=$$GETPLACE^MAGBAPI(+$$PLACE^MAGBAPI(MAGINST))
"RTN","MAGBAPIP",36,0)
 I 'PLACE S PLACE=$O(^MAG(2006.1,0)),WARN="Using First Site Param entry."
"RTN","MAGBAPIP",37,0)
 Q PLACE
"RTN","MAGBAPIP",38,0)
 ;
"RTN","MAGBAPIP",39,0)
DA2PLC(MAGDA,TYPE) ; Moved from MAGGTU7 v2.5 - DBI - SEB Patch 4
"RTN","MAGBAPIP",40,0)
 ; TYPE :        Possible values "A" Abstract, "F" Full Res or "B" Big File
"RTN","MAGBAPIP",41,0)
 ; (defaults to "F" if null)
"RTN","MAGBAPIP",42,0)
 ; Resolve current place of image using the Acquisition Site field, then
"RTN","MAGBAPIP",43,0)
 ; resolve current place of image using NetWork Location pointer
"RTN","MAGBAPIP",44,0)
 ; if the Acquisition Site field is null or not related to the site 
"RTN","MAGBAPIP",45,0)
 ; parameter file.
"RTN","MAGBAPIP",46,0)
 ; 
"RTN","MAGBAPIP",47,0)
 N MAGREF,MAG0,FBIG,SITE,PLC,MAGJB
"RTN","MAGBAPIP",48,0)
 I '$G(MAGDA) Q 0
"RTN","MAGBAPIP",49,0)
 S SITE=$P($G(^MAG(2005,MAGDA,100)),U,3)
"RTN","MAGBAPIP",50,0)
 I SITE S PLC=$$PLACE^MAGBAPI(SITE) Q:PLC PLC
"RTN","MAGBAPIP",51,0)
 S MAG0=^MAG(2005,MAGDA,0)
"RTN","MAGBAPIP",52,0)
 ;I '$D(TYPE) S TYPE="F" /gek 8/2003  mod for efficiency (from ed)
"RTN","MAGBAPIP",53,0)
 S TYPE=$E($G(TYPE)_"F",1)
"RTN","MAGBAPIP",54,0)
 I "AF"[TYPE D
"RTN","MAGBAPIP",55,0)
 . S MAGREF=$S(TYPE="A":+$P(MAG0,"^",4),1:+$P(MAG0,"^",3))
"RTN","MAGBAPIP",56,0)
 . I MAGREF=0 S MAGJB=1,MAGREF=+$P(MAG0,"^",5) ; get file from jukebox
"RTN","MAGBAPIP",57,0)
 I "B"[TYPE D
"RTN","MAGBAPIP",58,0)
 . S FBIG=$G(^MAG(2005,MAGDA,"FBIG"))
"RTN","MAGBAPIP",59,0)
 . S MAGREF=+$P(FBIG,"^") ; get file from magnetic disk, if possible
"RTN","MAGBAPIP",60,0)
 . I MAGREF=0 S MAGREF=+$P(FBIG,"^",2) ; get file from jukebox
"RTN","MAGBAPIP",61,0)
 I 'MAGREF Q 0
"RTN","MAGBAPIP",62,0)
 I '$D(^MAG(2005.2,MAGREF,0)) Q 0
"RTN","MAGBAPIP",63,0)
 Q $$GETPLACE^MAGBAPI(+$$GET1^DIQ(2005.2,MAGREF,.04,"I"))
"RTN","MAGDIR82")
0^38^B62866214
"RTN","MAGDIR82",1,0)
MAGDIR82 ;WOIFO/PMK - Read a DICOM image file ; 03/01/2006 14:04
"RTN","MAGDIR82",2,0)
 ;;3.0;IMAGING;**11,30,51,20**;Apr 12, 2006
"RTN","MAGDIR82",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR82",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDIR82",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDIR82",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDIR82",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDIR82",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDIR82",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDIR82",10,0)
 ;; |                                                               |
"RTN","MAGDIR82",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDIR82",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDIR82",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDIR82",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDIR82",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDIR82",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR82",17,0)
 ;;
"RTN","MAGDIR82",18,0)
 ; M2MB server
"RTN","MAGDIR82",19,0)
 ;
"RTN","MAGDIR82",20,0)
 ; This routine is invoked by the ^MAGDIR8 to update statistics & add
"RTN","MAGDIR82",21,0)
 ; an image to the background processor and auto-router queues.
"RTN","MAGDIR82",22,0)
 ;
"RTN","MAGDIR82",23,0)
 ; There are two entry points, one for the "ACQUIRED" RESULT item, and
"RTN","MAGDIR82",24,0)
 ; the other (POSTPROC) for the "PROCESSED" RESULT item.
"RTN","MAGDIR82",25,0)
 ;
"RTN","MAGDIR82",26,0)
ACQUIRED ; update image acquisition statistics
"RTN","MAGDIR82",27,0)
 N INSTNAME,LOCATION,STATUS
"RTN","MAGDIR82",28,0)
 S STATUS=$P(ARGS,"|",1)
"RTN","MAGDIR82",29,0)
 S LOCATION=$P(ARGS,"|",2)
"RTN","MAGDIR82",30,0)
 S INSTNAME=$P(ARGS,"|",3)
"RTN","MAGDIR82",31,0)
 D COUNT("ACQUIRED")
"RTN","MAGDIR82",32,0)
 Q
"RTN","MAGDIR82",33,0)
 ;
"RTN","MAGDIR82",34,0)
POSTPROC ; update image processing statistics and add to BP & AR queues
"RTN","MAGDIR82",35,0)
 N COUNTFLG,ERRCODE,EVAL,I,IMAGEPTR,INSTNAME,LOCATION,MACHID,MSG,STATUS
"RTN","MAGDIR82",36,0)
 S STATUS=$P(ARGS,"|",1)
"RTN","MAGDIR82",37,0)
 S LOCATION=$P(ARGS,"|",2)
"RTN","MAGDIR82",38,0)
 S INSTNAME=$P(ARGS,"|",3)
"RTN","MAGDIR82",39,0)
 S IMAGEPTR=$P(ARGS,"|",4)
"RTN","MAGDIR82",40,0)
 S COUNTFLG=$P(ARGS,"|",5) ; zero for multiframe images
"RTN","MAGDIR82",41,0)
 S EVAL=$P(ARGS,"|",6)
"RTN","MAGDIR82",42,0)
 S MACHID=$P(ARGS,"|",7)
"RTN","MAGDIR82",43,0)
 I COUNTFLG D
"RTN","MAGDIR82",44,0)
 . D COUNT("PROCESSED") ; update the count
"RTN","MAGDIR82",45,0)
 . Q:$T(SAVEUID^MAGDIR81)=""
"RTN","MAGDIR82",46,0)
 . D SAVEUID^MAGDIR81(MACHID,"") ; clear the last image UID
"RTN","MAGDIR82",47,0)
 . Q
"RTN","MAGDIR82",48,0)
 ;
"RTN","MAGDIR82",49,0)
 S ERRCODE=""
"RTN","MAGDIR82",50,0)
 ;
"RTN","MAGDIR82",51,0)
 I $$CONSOLID^MAGDFCNV D
"RTN","MAGDIR82",52,0)
 . D POSTPRO2 ; consolidation code
"RTN","MAGDIR82",53,0)
 . Q
"RTN","MAGDIR82",54,0)
 E  D
"RTN","MAGDIR82",55,0)
 . D POSTPRO1 ; non-consolidation code
"RTN","MAGDIR82",56,0)
 . Q
"RTN","MAGDIR82",57,0)
 I ERRCODE="" D
"RTN","MAGDIR82",58,0)
 . D RESULT^MAGDIR8(OPCODE,"|"_$P(ARGS,"|",2,999))
"RTN","MAGDIR82",59,0)
 . Q
"RTN","MAGDIR82",60,0)
 E  D
"RTN","MAGDIR82",61,0)
 . D ERROR^MAGDIR8(OPCODE,ERRCODE,.MSG,$T(+0))
"RTN","MAGDIR82",62,0)
 . Q
"RTN","MAGDIR82",63,0)
 Q
"RTN","MAGDIR82",64,0)
 ;
"RTN","MAGDIR82",65,0)
POSTPRO1 ; non-consolidation code version of post processing
"RTN","MAGDIR82",66,0)
 Q:IMAGEPTR<0
"RTN","MAGDIR82",67,0)
 ; add the image to the jukebox queue
"RTN","MAGDIR82",68,0)
 D:'$$JUKEBOX^MAGBAPI(IMAGEPTR)
"RTN","MAGDIR82",69,0)
 . S I=$O(MSG(" "),-1)
"RTN","MAGDIR82",70,0)
 . S:I I=I+1,MSG(I)=" "
"RTN","MAGDIR82",71,0)
 . S I=I+1,MSG(I)="JUKEBOX QUEUE CREATION ERROR:"
"RTN","MAGDIR82",72,0)
 . S I=I+1,MSG(I)="An image has not been entered into the jukebox queue."
"RTN","MAGDIR82",73,0)
 . S I=I+1,MSG(I)="Image pointer: "_IMAGEPTR
"RTN","MAGDIR82",74,0)
 . D ERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR82",75,0)
 . S ERRCODE=-401
"RTN","MAGDIR82",76,0)
 . Q
"RTN","MAGDIR82",77,0)
 ;
"RTN","MAGDIR82",78,0)
 D:EVAL  ; Add the image to the routing evaluator queue
"RTN","MAGDIR82",79,0)
 . D WARNROUT(0)
"RTN","MAGDIR82",80,0)
 . D:$$EVAL^MAGBAPI(IMAGEPTR)<0
"RTN","MAGDIR82",81,0)
 . . S I=$O(MSG(" "),-1)
"RTN","MAGDIR82",82,0)
 . . S:I I=I+1,MSG(I)=" "
"RTN","MAGDIR82",83,0)
 . . S I=I+1,MSG(I)="AUTOROUTER EVALUATION QUEUE CREATION ERROR:"
"RTN","MAGDIR82",84,0)
 . . S I=I+1,MSG(I)="An image could not be evaluated for autorouting purposes."
"RTN","MAGDIR82",85,0)
 . . S I=I+1,MSG(I)="Image pointer: "_IMAGEPTR
"RTN","MAGDIR82",86,0)
 . . S I=I+1,MSG(I)="Error code is """_Z_"""."
"RTN","MAGDIR82",87,0)
 . . D ERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR82",88,0)
 . . S ERRCODE=ERRCODE_"-402"
"RTN","MAGDIR82",89,0)
 . . Q
"RTN","MAGDIR82",90,0)
 . Q
"RTN","MAGDIR82",91,0)
 Q
"RTN","MAGDIR82",92,0)
 ;
"RTN","MAGDIR82",93,0)
POSTPRO2 ; consolidation code version of post processing
"RTN","MAGDIR82",94,0)
 N PLACE
"RTN","MAGDIR82",95,0)
 Q:IMAGEPTR<0
"RTN","MAGDIR82",96,0)
 S PLACE=$O(^MAG(2006.1,"B",LOCATION,""))
"RTN","MAGDIR82",97,0)
 ;
"RTN","MAGDIR82",98,0)
 ; add the image to the jukebox queue
"RTN","MAGDIR82",99,0)
 D:'$$JUKEBOX^MAGBAPI(IMAGEPTR,PLACE)
"RTN","MAGDIR82",100,0)
 . S I=$O(MSG(" "),-1)
"RTN","MAGDIR82",101,0)
 . S:I I=I+1,MSG(I)=" "
"RTN","MAGDIR82",102,0)
 . S I=I+1,MSG(I)="JUKEBOX QUEUE CREATION ERROR:"
"RTN","MAGDIR82",103,0)
 . S I=I+1,MSG(I)="An image has not been entered into the jukebox queue."
"RTN","MAGDIR82",104,0)
 . S I=I+1,MSG(I)="Image pointer: "_IMAGEPTR_"   Location: "_LOCATION
"RTN","MAGDIR82",105,0)
 . D ERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR82",106,0)
 . S ERRCODE=-403
"RTN","MAGDIR82",107,0)
 . Q
"RTN","MAGDIR82",108,0)
 ;
"RTN","MAGDIR82",109,0)
 D:EVAL  ; Add the image to the routing evaluator queue
"RTN","MAGDIR82",110,0)
 . D WARNROUT(PLACE)
"RTN","MAGDIR82",111,0)
 . D:$$EVAL^MAGBAPI(IMAGEPTR,PLACE)<0
"RTN","MAGDIR82",112,0)
 . . S I=$O(MSG(" "),-1)
"RTN","MAGDIR82",113,0)
 . . S:I I=I+1,MSG(I)=" "
"RTN","MAGDIR82",114,0)
 . . S I=I+1,MSG(I)="AUTOROUTER EVALUATION QUEUE CREATION ERROR:"
"RTN","MAGDIR82",115,0)
 . . S I=I+1,MSG(I)="An image could not be evaluated for autorouting purposes."
"RTN","MAGDIR82",116,0)
 . . S I=I+1,MSG(I)="Image pointer: "_IMAGEPTR_"   Place: "_PLACE
"RTN","MAGDIR82",117,0)
 . . S I=I+1,MSG(I)="Error code is """_Z_"""."
"RTN","MAGDIR82",118,0)
 . . D ERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR82",119,0)
 . . S ERRCODE=ERRCODE_"-404"
"RTN","MAGDIR82",120,0)
 . . Q
"RTN","MAGDIR82",121,0)
 . Q
"RTN","MAGDIR82",122,0)
 Q
"RTN","MAGDIR82",123,0)
 ;
"RTN","MAGDIR82",124,0)
COUNT(STEP) ; update today's count
"RTN","MAGDIR82",125,0)
 N %,D2,%H,NOW,PC,TODAY,X
"RTN","MAGDIR82",126,0)
 D NOW^%DTC S TODAY=X,NOW=%
"RTN","MAGDIR82",127,0)
 L +^MAGDAUDT(2006.5762,TODAY)
"RTN","MAGDIR82",128,0)
 D:'$D(^MAGDAUDT(2006.5762,TODAY))
"RTN","MAGDIR82",129,0)
 . S X=$G(^MAGDAUDT(2006.5762,0))
"RTN","MAGDIR82",130,0)
 . S $P(X,"^",1,2)="DICOM INSTRUMENT STATISTICS^2006.5762"
"RTN","MAGDIR82",131,0)
 . S $P(X,"^",3)=TODAY
"RTN","MAGDIR82",132,0)
 . S $P(X,"^",4)=$P(X,"^",4)+1
"RTN","MAGDIR82",133,0)
 . S ^MAGDAUDT(2006.5762,0)=X
"RTN","MAGDIR82",134,0)
 . S ^MAGDAUDT(2006.5762,TODAY,0)=TODAY
"RTN","MAGDIR82",135,0)
 . S ^MAGDAUDT(2006.5762,"B",TODAY,TODAY)=""
"RTN","MAGDIR82",136,0)
 . Q
"RTN","MAGDIR82",137,0)
 S D2=$O(^MAGDAUDT(2006.5762,TODAY,1,LOCATION,1,"B",INSTNAME,""))
"RTN","MAGDIR82",138,0)
 D:'D2
"RTN","MAGDIR82",139,0)
 . S D2=$O(^MAGDAUDT(2006.5762,TODAY,1,LOCATION,1," "),-1)+1
"RTN","MAGDIR82",140,0)
 . S X=$G(^MAGDAUDT(2006.5762,TODAY,1,LOCATION,1,0))
"RTN","MAGDIR82",141,0)
 . S $P(X,"^",2)="2006.576211"
"RTN","MAGDIR82",142,0)
 . S $P(X,"^",3)=D2
"RTN","MAGDIR82",143,0)
 . S $P(X,"^",4)=$P(X,"^",4)+1
"RTN","MAGDIR82",144,0)
 . S ^MAGDAUDT(2006.5762,TODAY,1,LOCATION,0)=LOCATION
"RTN","MAGDIR82",145,0)
 . S ^MAGDAUDT(2006.5762,TODAY,1,LOCATION,1,0)=X
"RTN","MAGDIR82",146,0)
 . S ^MAGDAUDT(2006.5762,TODAY,1,LOCATION,1,D2,0)=INSTNAME
"RTN","MAGDIR82",147,0)
 . S ^MAGDAUDT(2006.5762,TODAY,1,LOCATION,1,"B",INSTNAME,D2)=""
"RTN","MAGDIR82",148,0)
 . Q
"RTN","MAGDIR82",149,0)
 S X=$G(^MAGDAUDT(2006.5762,TODAY,1,LOCATION,1,D2,0))
"RTN","MAGDIR82",150,0)
 S PC=$S(STEP="ACQUIRED":2,STEP="PROCESSED":4,1:6)
"RTN","MAGDIR82",151,0)
 S $P(X,"^",PC)=$P(X,"^",PC)+1
"RTN","MAGDIR82",152,0)
 S $P(X,"^",PC+1)=NOW
"RTN","MAGDIR82",153,0)
 S ^MAGDAUDT(2006.5762,TODAY,1,LOCATION,1,D2,0)=X
"RTN","MAGDIR82",154,0)
 L -^MAGDAUDT(2006.5762,TODAY)
"RTN","MAGDIR82",155,0)
 Q
"RTN","MAGDIR82",156,0)
 ;
"RTN","MAGDIR82",157,0)
WARNROUT(PLACE) N LAST,X1,X2,X3
"RTN","MAGDIR82",158,0)
 D:'PLACE
"RTN","MAGDIR82",159,0)
 . S PLACE=$$PLACE^MAGDRPC2(LOCATION)
"RTN","MAGDIR82",160,0)
 . Q
"RTN","MAGDIR82",161,0)
 S LAST=$G(^MAG(2006.1,+PLACE,"LASTROUTE"))
"RTN","MAGDIR82",162,0)
 S (X2,X3)=LAST\1 D:X3
"RTN","MAGDIR82",163,0)
 . N DEST,E,I,PRI,T
"RTN","MAGDIR82",164,0)
 . S X1=DT D ^%DTC Q:X<7
"RTN","MAGDIR82",165,0)
 . S X2=$P(LAST,"^",2) Q:X2'<DT  ; Only send one message per day
"RTN","MAGDIR82",166,0)
 . S (E,T,I)=0 F  S I=$O(^MAGQUEUE(2006.03,"C",PLACE,"EVAL",I)) Q:I=""  S E=E+1
"RTN","MAGDIR82",167,0)
 . S PRI="" F  S PRI=$O(^MAGQUEUE(2006.035,"STS",LOCATION,"WAITING",PRI)) Q:PRI=""  D
"RTN","MAGDIR82",168,0)
 . . S DEST="" F  S DEST=$O(^MAGQUEUE(2006.035,"STS",LOCATION,"WAITING",PRI,DEST)) Q:DEST=""  D
"RTN","MAGDIR82",169,0)
 . . . S I="" F  S I=$O(^MAGQUEUE(2006.035,"STS",LOCATION,"WAITING",PRI,DEST,I)) Q:I=""  S T=T+1
"RTN","MAGDIR82",170,0)
 . . . Q
"RTN","MAGDIR82",171,0)
 . . Q
"RTN","MAGDIR82",172,0)
 . S I=$O(MSG(" "),-1)
"RTN","MAGDIR82",173,0)
 . S:I I=I+1,MSG(I)=" "
"RTN","MAGDIR82",174,0)
 . S I=I+1,MSG(I)="More than a week has elapsed since "_(X3#100)_"-"_$P("Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec"," ",X3\100#100)_"-"_(X3\10000+1700)
"RTN","MAGDIR82",175,0)
 . S I=I+1,MSG(I)="when the last activity occurred that is related"
"RTN","MAGDIR82",176,0)
 . S I=I+1,MSG(I)="to the processing of Routed Image files."
"RTN","MAGDIR82",177,0)
 . S I=I+1,MSG(I)=" "
"RTN","MAGDIR82",178,0)
 . S I=I+1,MSG(I)="The site parameter for ""This is a Routing Site"" is"
"RTN","MAGDIR82",179,0)
 . S I=I+1,MSG(I)="currently turned ON."
"RTN","MAGDIR82",180,0)
 . S I=I+1,MSG(I)="If this site is no longer actively routing image files"
"RTN","MAGDIR82",181,0)
 . S I=I+1,MSG(I)="this site parameter must be turned OFF."
"RTN","MAGDIR82",182,0)
 . S I=I+1,MSG(I)="This parameter needs to be turned OFF on each VistA"
"RTN","MAGDIR82",183,0)
 . S I=I+1,MSG(I)="DICOM Gateway that processes incoming images."
"RTN","MAGDIR82",184,0)
 . S I=I+1,MSG(I)=" "
"RTN","MAGDIR82",185,0)
 . S I=I+1,MSG(I)="There are currently "_E_" entr"_$S(E=1:"y",1:"ies")
"RTN","MAGDIR82",186,0)
 . S I=I+1,MSG(I)="waiting to be processed in the evaluation queue."
"RTN","MAGDIR82",187,0)
 . S I=I+1,MSG(I)=" "
"RTN","MAGDIR82",188,0)
 . S I=I+1,MSG(I)="There are currently "_T_" entr"_$S(T=1:"y",1:"ies")
"RTN","MAGDIR82",189,0)
 . S I=I+1,MSG(I)="waiting to be processed in the transmission queue."
"RTN","MAGDIR82",190,0)
 . S I=I+1,MSG(I)=" "
"RTN","MAGDIR82",191,0)
 . S I=I+1,MSG(I)="If this site is still a routing site, then both the"
"RTN","MAGDIR82",192,0)
 . S I=I+1,MSG(I)="Routing Rule Evaluator and the Routing Transmitter"
"RTN","MAGDIR82",193,0)
 . S I=I+1,MSG(I)="must be restarted."
"RTN","MAGDIR82",194,0)
 . D ERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR82",195,0)
 . S ERRCODE=ERRCODE_"-405"
"RTN","MAGDIR82",196,0)
 . S $P(^MAG(2006.1,PLACE,"LASTROUTE"),"^",2)=DT
"RTN","MAGDIR82",197,0)
 . Q
"RTN","MAGDIR82",198,0)
 Q
"RTN","MAGDIR82",199,0)
 ;
"RTN","MAGDLB12")
0^3^B22838427
"RTN","MAGDLB12",1,0)
MAGDLB12 ;WOIFO/LB,MLH - Routine to fix failed DICOM entries  ; 04/25/2005  07:46
"RTN","MAGDLB12",2,0)
 ;;3.0;IMAGING;**11,51,20**;Apr 12, 2006
"RTN","MAGDLB12",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDLB12",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDLB12",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDLB12",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDLB12",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDLB12",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDLB12",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDLB12",10,0)
 ;; |                                                               |
"RTN","MAGDLB12",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDLB12",12,0)
 ;; | a Class II medical device.  As such, it may not be changed    |
"RTN","MAGDLB12",13,0)
 ;; | in any way.  Modifications to this software may result in an  |
"RTN","MAGDLB12",14,0)
 ;; | adulterated medical device under 21CFR820, the use of which   |
"RTN","MAGDLB12",15,0)
 ;; | is considered to be a violation of US Federal Statutes.       |
"RTN","MAGDLB12",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDLB12",17,0)
 ;;
"RTN","MAGDLB12",18,0)
 Q
"RTN","MAGDLB12",19,0)
LOOP ;
"RTN","MAGDLB12",20,0)
 N ANS,ANSR,CASENO,COMNT1,DATA,DATA1,DATA2,DATE,FILE,FIRST,FIRSTS
"RTN","MAGDLB12",21,0)
 N MACHID,MAGDY,MAGDIEN,MAGIEN,MAGTYPE,MSG,START,STOP,SUID
"RTN","MAGDLB12",22,0)
 N MOD,MODEL,NEWCAS,NEWDFN,NEWDTI,NEWDTIM,NEWMUL,NEWNME,NEWPIEN,NEWPROC
"RTN","MAGDLB12",23,0)
 N NEWSSN,OK,OOUT,OUT,PAT,PID,PP,PREV,PREVS,REASON,SITE,STUDYUID,WHY,MAGFIX
"RTN","MAGDLB12",24,0)
 N KFIXALL ; -- does user hold MAGDFIX ALL security key?
"RTN","MAGDLB12",25,0)
 ;
"RTN","MAGDLB12",26,0)
 S KFIXALL=$$SECKEY()
"RTN","MAGDLB12",27,0)
 S (OOUT,OUT,PREV,FIRST)=0
"RTN","MAGDLB12",28,0)
 ; select a site - bail if no images to correct or no site selected
"RTN","MAGDLB12",29,0)
 S STAT=$$SITE(.SITE) Q:'SITE
"RTN","MAGDLB12",30,0)
 S SUID=0
"RTN","MAGDLB12",31,0)
 F  S SUID=$O(^MAGD(2006.575,"F",SITE,SUID)) Q:SUID=""!(OOUT)  D
"RTN","MAGDLB12",32,0)
 . S MAGIEN=$O(^MAGD(2006.575,"F",SITE,SUID,0)) Q:'MAGIEN
"RTN","MAGDLB12",33,0)
 . ; if image isn't on file, clean up xrefs
"RTN","MAGDLB12",34,0)
 . I '$D(^MAGD(2006.575,MAGIEN,0)) D  Q
"RTN","MAGDLB12",35,0)
 . . K ^MAGD(2006.575,"F",SITE,SUID,MAGIEN)
"RTN","MAGDLB12",36,0)
 . . Q
"RTN","MAGDLB12",37,0)
 . ; if gateway site isn't the user's site, bail unless the user holds
"RTN","MAGDLB12",38,0)
 . ; the MAGDFIX ALL security key
"RTN","MAGDLB12",39,0)
 . I $P($G(^MAGD(2006.575,MAGIEN,1)),U,5)'=DUZ(2),'KFIXALL Q
"RTN","MAGDLB12",40,0)
 . ;Only process Radiology images...medicine images done by other rtns.
"RTN","MAGDLB12",41,0)
 . S MAGTYPE=$P($G(^MAGD(2006.575,MAGIEN,"TYPE")),"^") I MAGTYPE'["RAD" Q
"RTN","MAGDLB12",42,0)
 . I $D(^MAGD(2006.575,MAGIEN,"FIXD")),$P(^MAGD(2006.575,MAGIEN,"FIXD"),"^") Q
"RTN","MAGDLB12",43,0)
 . I 'FIRST S PREV=MAGIEN,PREVS=SUID,FIRST=MAGIEN
"RTN","MAGDLB12",44,0)
 . D SET^MAGDLB1
"RTN","MAGDLB12",45,0)
 . Q
"RTN","MAGDLB12",46,0)
 Q
"RTN","MAGDLB12",47,0)
SITE(XSITE) ; select a site for which to process entries
"RTN","MAGDLB12",48,0)
 ; input:        none
"RTN","MAGDLB12",49,0)
 ; output:   .XSITE   site number for which to process entries
"RTN","MAGDLB12",50,0)
 ; 
"RTN","MAGDLB12",51,0)
 ; return:   0 always
"RTN","MAGDLB12",52,0)
 ; 
"RTN","MAGDLB12",53,0)
 N CNT,KFIXALL,RESULT,SITES
"RTN","MAGDLB12",54,0)
 S (CNT,XSITE)=0 F  S XSITE=$O(^MAGD(2006.575,"F",XSITE)) Q:'XSITE  D
"RTN","MAGDLB12",55,0)
 . Q:'$$FIND1^DIC(4,"","","`"_XSITE)
"RTN","MAGDLB12",56,0)
 . S CNT=CNT+1,SITES(CNT)=XSITE
"RTN","MAGDLB12",57,0)
 . Q
"RTN","MAGDLB12",58,0)
 Q:'CNT 0
"RTN","MAGDLB12",59,0)
 ;
"RTN","MAGDLB12",60,0)
 S KFIXALL=$$SECKEY I '$$MDIV S KFIXALL=1
"RTN","MAGDLB12",61,0)
 ; If not multi-division set the KFIXALL - site should be able to correct any entry
"RTN","MAGDLB12",62,0)
 I KFIXALL D FIX(.SITES,CNT) Q 0
"RTN","MAGDLB12",63,0)
 I $D(DUZ(2)) D  Q 0
"RTN","MAGDLB12",64,0)
 . S XSITE=DUZ(2)
"RTN","MAGDLB12",65,0)
 . I '$D(^MAGD(2006.575,"F",XSITE)) W !,"No entries for division "_$$GET1^DIQ(4,+XSITE,".01","E")
"RTN","MAGDLB12",66,0)
 . Q
"RTN","MAGDLB12",67,0)
 D LKUSR(.RESULT,DUZ)
"RTN","MAGDLB12",68,0)
 I '$D(RESULT(0)) Q 0
"RTN","MAGDLB12",69,0)
 I $P(RESULT(0),"^")=0 W !,$P(RESULT,"^",2) Q 0
"RTN","MAGDLB12",70,0)
 ;
"RTN","MAGDLB12",71,0)
 N EN,II,NSITE,MAGSITE,X
"RTN","MAGDLB12",72,0)
 S (CNT,XSITE)=0
"RTN","MAGDLB12",73,0)
 S X=0 F  S X=$O(SITES(X)) Q:'X  S II=$G(SITES(X)) I II S NSITE(II)=""
"RTN","MAGDLB12",74,0)
 S II=0
"RTN","MAGDLB12",75,0)
 F  S II=$O(RESULT(II)) Q:'II  S EN=$G(RESULT(II)) I $D(NSITE(EN)) S CNT=CNT+1,MAGSITE(CNT)=EN
"RTN","MAGDLB12",76,0)
 I 'CNT Q 0 ;no matches
"RTN","MAGDLB12",77,0)
 I CNT=1 S XSITE=$G(MAGSITE(1)) Q 0
"RTN","MAGDLB12",78,0)
 D FIX(.MAGSITE,CNT) ; select a SITE to fix
"RTN","MAGDLB12",79,0)
 Q 0
"RTN","MAGDLB12",80,0)
 ;
"RTN","MAGDLB12",81,0)
FIX(SITES,CNT) ;SUBROUTINE - Prepare to fix the entries for the user's division entries.        
"RTN","MAGDLB12",82,0)
 ; Multiple divisions have images to be corrected and user has appropriate security key.
"RTN","MAGDLB12",83,0)
 N DIR,I,Y,X
"RTN","MAGDLB12",84,0)
 I 'CNT Q
"RTN","MAGDLB12",85,0)
 I CNT=1 S SITE=$G(SITES(CNT)) Q
"RTN","MAGDLB12",86,0)
 S I=0 F  S I=$O(SITES(I)) Q:'I  D
"RTN","MAGDLB12",87,0)
 . W !,I,") ",$G(SITES(I)),"  ",$$GET1^DIQ(4,+$G(SITES(I)),".01","E")
"RTN","MAGDLB12",88,0)
 . Q
"RTN","MAGDLB12",89,0)
 F  D  Q:Y'>CNT
"RTN","MAGDLB12",90,0)
 . S DIR(0)="N:1:"_CNT
"RTN","MAGDLB12",91,0)
 . S DIR("A",1)="There are images to be corrected for multiple divisions."
"RTN","MAGDLB12",92,0)
 . S DIR("A")="Select by number (1-"_CNT_")"
"RTN","MAGDLB12",93,0)
 . D ^DIR
"RTN","MAGDLB12",94,0)
 . W:Y>CNT " ??"
"RTN","MAGDLB12",95,0)
 . Q
"RTN","MAGDLB12",96,0)
 S:Y SITE=$G(SITES(+Y))
"RTN","MAGDLB12",97,0)
 Q
"RTN","MAGDLB12",98,0)
 ;
"RTN","MAGDLB12",99,0)
SECKEY() ;
"RTN","MAGDLB12",100,0)
 N MAGKY,MAGRSLT
"RTN","MAGDLB12",101,0)
 I '$D(DUZ) Q 0
"RTN","MAGDLB12",102,0)
 S MAGKY("MAGDFIX ALL")="MAGDFIX ALL"
"RTN","MAGDLB12",103,0)
 D OWNSKEY^XUSRB(.MAGRSLT,.MAGKY)
"RTN","MAGDLB12",104,0)
 I +$G(MAGRSLT("MAGDFIX ALL")) Q 1
"RTN","MAGDLB12",105,0)
 Q 0
"RTN","MAGDLB12",106,0)
 ;
"RTN","MAGDLB12",107,0)
MDIV() ;Multi-divisional flag
"RTN","MAGDLB12",108,0)
 N CNT,I
"RTN","MAGDLB12",109,0)
 S (CNT,I)=0
"RTN","MAGDLB12",110,0)
 F  S I=$O(^MAG(2006.1,I)) Q:'I  S CNT=CNT+1
"RTN","MAGDLB12",111,0)
 I CNT>1 Q 1
"RTN","MAGDLB12",112,0)
 Q 0
"RTN","MAGDLB12",113,0)
 ;
"RTN","MAGDLB12",114,0)
LKUSR(RESULT,USER) ;
"RTN","MAGDLB12",115,0)
 ;RETURNS: 0^Message for failure
"RTN","MAGDLB12",116,0)
 ;         IENs for Institution file entry^
"RTN","MAGDLB12",117,0)
 ; If the user has more than one division and more than one match in the Imaging Site
"RTN","MAGDLB12",118,0)
 ; Parameter file, then it returns the 1st matching division entry in the New Person file.
"RTN","MAGDLB12",119,0)
 I $D(DUZ(2)) S RESULT(0)="1^Number of entries",RESULT(DUZ(2))=DUZ(2) Q
"RTN","MAGDLB12",120,0)
 N MAGARRAY,CNT,MAGERR,MAGOUT,MAGDV,MAGX
"RTN","MAGDLB12",121,0)
 S RESULT(0)="0^Your division entry is not part of the Imaging Site Parameter."
"RTN","MAGDLB12",122,0)
 D GETS^DIQ(200,USER,"16*","I","MAGOUT")
"RTN","MAGDLB12",123,0)
 ;MAGOUT(200.02,"institution entry,duz,",.01,"I")=institution entry
"RTN","MAGDLB12",124,0)
 I $D(MAGOUT)=0 Q
"RTN","MAGDLB12",125,0)
 S MAGX="",CNT=0
"RTN","MAGDLB12",126,0)
 F  S MAGX=$O(MAGOUT(200.02,MAGX)) Q:MAGX=""  D
"RTN","MAGDLB12",127,0)
 . S MAGDV=$P(MAGX,",") I $D(^MAG(2006.1,"B",MAGDV)) S CNT=CNT+1,MAGARRAY(CNT)=MAGDV
"RTN","MAGDLB12",128,0)
 . Q
"RTN","MAGDLB12",129,0)
 I 'CNT Q
"RTN","MAGDLB12",130,0)
 S CNT=0
"RTN","MAGDLB12",131,0)
 S X=0 F  S X=$O(MAGARRAY(X)) Q:'X  S CNT=CNT+1,RESULT(X)=$P(MAGARRAY(X),"^")
"RTN","MAGDLB12",132,0)
 S RESULT(0)=CNT_"^Number of entries"
"RTN","MAGDLB12",133,0)
 ; Get the 1st institution, the calling routine should check for keys.
"RTN","MAGDLB12",134,0)
 Q
"RTN","MAGDLB12",135,0)
 ;
"RTN","MAGGSIUI")
0^28^B60693392
"RTN","MAGGSIUI",1,0)
MAGGSIUI ;WOIFO/GEK - Utilities for Image Import API
"RTN","MAGGSIUI",2,0)
 ;;3.0;IMAGING;**7,8,48,20**;Apr 12, 2006
"RTN","MAGGSIUI",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGSIUI",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGGSIUI",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGGSIUI",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGGSIUI",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGGSIUI",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGGSIUI",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGGSIUI",10,0)
 ;; |                                                               |
"RTN","MAGGSIUI",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGGSIUI",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGGSIUI",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGGSIUI",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGGSIUI",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGGSIUI",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGSIUI",17,0)
 ;;
"RTN","MAGGSIUI",18,0)
 Q
"RTN","MAGGSIUI",19,0)
REMOTE(MAGRY,MAGDATA) ;RPC [MAG4 REMOTE IMPORT]
"RTN","MAGGSIUI",20,0)
 ; Import Images from a Windows App, by sending an array.
"RTN","MAGGSIUI",21,0)
 I ($D(MAGDATA)<10) S MAGRY(0)="0^Missing Data Array !." Q
"RTN","MAGGSIUI",22,0)
 N I,J,ICT,DCT,MAGIX,IMAGES,ERR,X,Z
"RTN","MAGGSIUI",23,0)
 S (ERR,ICT,DCT)=0
"RTN","MAGGSIUI",24,0)
 S I="" F  S I=$O(MAGDATA(I)) Q:I=""  S X=MAGDATA(I) D  Q:ERR
"RTN","MAGGSIUI",25,0)
 . S Z=$P(X,U)
"RTN","MAGGSIUI",26,0)
 . I (X="")!(Z="") S MAGRY(0)="0^INVALID Data in Input Array: Node "_I_"="""_X_"",ERR=1 Q
"RTN","MAGGSIUI",27,0)
 . I Z="IMAGE" S ICT=ICT+1,IMAGES(ICT)=$P(X,U,2,99) Q
"RTN","MAGGSIUI",28,0)
 . S DCT=DCT+1,MAGIX(Z)=$P(X,U,2,99)
"RTN","MAGGSIUI",29,0)
 I 'ERR D IMPORT(.MAGRY,.IMAGES,.MAGIX)
"RTN","MAGGSIUI",30,0)
 Q
"RTN","MAGGSIUI",31,0)
 ;
"RTN","MAGGSIUI",32,0)
IMPORT(MAGRY,IMAGES,MAGIX) ;
"RTN","MAGGSIUI",33,0)
 ; "IDFN","PXPKG","PXIEN","PXDT","TRKID","ACQD","ACQS","ACQL","STSCB","ITYPE",
"RTN","MAGGSIUI",34,0)
 ;        "CMTH","CDUZ","USERNAME","PASSWORD","GDESC","DFLG","TRTYPE","DOCCTG","DOCDT",
"RTN","MAGGSIUI",35,0)
 ;        "IXTYPE","IXSPEC","IXPROC","IXORIGIN    ;Patch 8: Added Index fields
"RTN","MAGGSIUI",36,0)
 ;
"RTN","MAGGSIUI",37,0)
 ;Index fields Package, Class ("IXPKG" and "IXCLS") aren't accepted
"RTN","MAGGSIUI",38,0)
 ;    they are computed values.
"RTN","MAGGSIUI",39,0)
 ; - Convert field codes into an Input Data Array,
"RTN","MAGGSIUI",40,0)
 ;   validate, then set the Import Queue
"RTN","MAGGSIUI",41,0)
 ;
"RTN","MAGGSIUI",42,0)
 N $ETRAP,$ESTACK S $ETRAP="D ERR^"_$T(+0)
"RTN","MAGGSIUI",43,0)
 K MAGRY S MAGRY(0)="0^Importing data..."
"RTN","MAGGSIUI",44,0)
 N APISESS
"RTN","MAGGSIUI",45,0)
 N PRM,CT,MAGA,MAGY,MAGTN,TNODE
"RTN","MAGGSIUI",46,0)
 N IDFN,PXPKG,PXIEN,PXDT,TRKID,ACQD,ACQS,ACQN,ACQL,STSCB,ITYPE,CMTH,CDUZ,USERNAME,PASSWORD,GDESC,DFLG,TRTYPE,DOCCTG,DOCDT,IXPKG,IXCLS,IXTYPE,IXSPEC,IXPROC,IXORIGIN
"RTN","MAGGSIUI",47,0)
 N ERR,MAGTM,QTIME,MAGIXZ
"RTN","MAGGSIUI",48,0)
 S CT=0,ERR=0
"RTN","MAGGSIUI",49,0)
 M MAGIXZ=MAGIX
"RTN","MAGGSIUI",50,0)
 F PRM="IDFN","PXPKG","PXIEN","PXDT","TRKID","ACQD","ACQS","ACQN","ACQL","STSCB","ITYPE","CMTH","CDUZ","USERNAME","PASSWORD","GDESC","DFLG","TRTYPE","DOCCTG","DOCDT","IXTYPE","IXSPEC","IXPROC","IXORIGIN" D
"RTN","MAGGSIUI",51,0)
 . S @PRM=$G(MAGIX(PRM)) K MAGIX(PRM) ; P8T14 added K.. and next line to account for field numbers later.
"RTN","MAGGSIUI",52,0)
 . Q
"RTN","MAGGSIUI",53,0)
 S PRM="" F  S PRM=$O(MAGIX(PRM)) Q:PRM=""  D SA(PRM,$G(MAGIX(PRM)))
"RTN","MAGGSIUI",54,0)
 ;
"RTN","MAGGSIUI",55,0)
 S MAGTM=$$NOW^XLFDT
"RTN","MAGGSIUI",56,0)
 I '$G(DUZ) S MAGRY(0)="0^DUZ is undefined." Q  ;D ERRTRK Q
"RTN","MAGGSIUI",57,0)
 ; DATATRK sets Global var. APISESS  = IEN of Session File.
"RTN","MAGGSIUI",58,0)
 D DATATRK
"RTN","MAGGSIUI",59,0)
 I '$$REQPARAM() D ERRTRK Q
"RTN","MAGGSIUI",60,0)
 ; Workaround VIC (Maximus) is sending Station Number 
"RTN","MAGGSIUI",61,0)
 ; we'll convert to Institution IEN
"RTN","MAGGSIUI",62,0)
 I ($P(TRKID,";",1)="MAX")&(ACQS]"") D  Q:ERR
"RTN","MAGGSIUI",63,0)
 . S X=$O(^DIC(4,"D",ACQS,""))
"RTN","MAGGSIUI",64,0)
 . I X="" S MAGRY(0)="0^Invalid STATION NUMBER: (ACQS): "_ACQS,ERR=1 Q
"RTN","MAGGSIUI",65,0)
 . S ACQS=X
"RTN","MAGGSIUI",66,0)
 . Q
"RTN","MAGGSIUI",67,0)
 ; Change to Allow ACQN - STATION NUMBER from INSTITUTION File.
"RTN","MAGGSIUI",68,0)
 I $L(ACQN) D  Q:ERR
"RTN","MAGGSIUI",69,0)
 . I $L(ACQS) S MAGRY(0)="0^Station IEN or Station Number, not both",ERR=1 Q
"RTN","MAGGSIUI",70,0)
 . S ACQS=$O(^DIC(4,"D",ACQN,""))
"RTN","MAGGSIUI",71,0)
 . I ACQS="" S MAGRY(0)="0^Invalid STATION NUMBER: (ACQN): "_ACQN,ERR=1 Q 
"RTN","MAGGSIUI",72,0)
 . S ACQN="" ;We converted to ACQS, lets make "" so no confusion later.
"RTN","MAGGSIUI",73,0)
 . Q
"RTN","MAGGSIUI",74,0)
 ;
"RTN","MAGGSIUI",75,0)
 ; Set the input data array
"RTN","MAGGSIUI",76,0)
 D SA(5,IDFN)    ;PATIENT
"RTN","MAGGSIUI",77,0)
 D SA(16,PXPKG)   ;PARENT DATA FILE
"RTN","MAGGSIUI",78,0)
 D SA(17,PXIEN) ;PARENT GLOBAL ROOT
"RTN","MAGGSIUI",79,0)
 D SA(15,PXDT)   ; PROCEDURE/EXAM DATE/TIME
"RTN","MAGGSIUI",80,0)
 D SA(108,TRKID) ; TRACKING ID (new)
"RTN","MAGGSIUI",81,0)
 D SA("ACQD",ACQD)  ; ACQUISTION DEVICE ( new )
"RTN","MAGGSIUI",82,0)
 D SA(.05,ACQS) ; this used to be fld 105
"RTN","MAGGSIUI",83,0)
 D SA(101,ACQL)
"RTN","MAGGSIUI",84,0)
 D SA("STATUSCB",STSCB)  ; STATUS CALLBACK  (was referred to as ExceptionHandler)
"RTN","MAGGSIUI",85,0)
 D SA(3,ITYPE)   ; OBJECT TYPE
"RTN","MAGGSIUI",86,0)
 D SA("CALLMTH",CMTH)     ; CALL METHOD
"RTN","MAGGSIUI",87,0)
 D SA(8,CDUZ)    ; IMAGE SAVE BY
"RTN","MAGGSIUI",88,0)
 D SA("USERNAME",USERNAME)
"RTN","MAGGSIUI",89,0)
 D SA("PASSWORD",PASSWORD)
"RTN","MAGGSIUI",90,0)
 D SA(10,GDESC)  ; SHORT DESCRIPTION
"RTN","MAGGSIUI",91,0)
 D SA("DELFLAG",DFLG)    ; DELETE FLAG
"RTN","MAGGSIUI",92,0)
 D SA("TRNSTYP",TRTYPE)  ; TRANSACTION TYPE
"RTN","MAGGSIUI",93,0)
 D SA(100,DOCCTG) ;  document Main category
"RTN","MAGGSIUI",94,0)
 D SA(110,DOCDT)     ;  document date
"RTN","MAGGSIUI",95,0)
 ; Patch 8 allows Index fields to be imported.
"RTN","MAGGSIUI",96,0)
 ;"IXTYPE","IXSPEC","IXPROC","IXORIGIN"
"RTN","MAGGSIUI",97,0)
 D SA(42,IXTYPE)     ;  Index Type
"RTN","MAGGSIUI",98,0)
 D SA(43,IXPROC)     ;  Index Proc/Event
"RTN","MAGGSIUI",99,0)
 D SA(44,IXSPEC)     ;  Index Spec/SubSpec
"RTN","MAGGSIUI",100,0)
 D SA(45,IXORIGIN)         ;  Index Origin
"RTN","MAGGSIUI",101,0)
 ;
"RTN","MAGGSIUI",102,0)
 D VAL^MAGGSIV(.MAGRY,.MAGA,1) I 'MAGRY(0) D ERRTRK Q
"RTN","MAGGSIUI",103,0)
 ; Also Done in MAGGSIA when image is being Saved.
"RTN","MAGGSIUI",104,0)
 I '$$VALINDEX^MAGGSIV1(.MAGRY,IXTYPE,IXSPEC,IXPROC) D ERRTRK Q
"RTN","MAGGSIUI",105,0)
 ;   Array of Images to Import
"RTN","MAGGSIUI",106,0)
 D SI("IMAGES",.IMAGES) I 'MAGRY(0) D ERRTRK Q
"RTN","MAGGSIUI",107,0)
 K MAGRY
"RTN","MAGGSIUI",108,0)
 ;
"RTN","MAGGSIUI",109,0)
 I TRTYPE="NOQUEUE" M MAGRY=MAGA S MAGRY(0)="1^" Q
"RTN","MAGGSIUI",110,0)
 ; This call is for BP
"RTN","MAGGSIUI",111,0)
 S QTIME=$$NOW^XLFDT
"RTN","MAGGSIUI",112,0)
 S MAGY=$$IMPORT^MAGBAPI(.MAGA,STSCB,TRKID,$$PLACE^MAGBAPI(DUZ(2))) ; DBI - SEB 10/11/2002
"RTN","MAGGSIUI",113,0)
 ; Return Queue Number
"RTN","MAGGSIUI",114,0)
 I 'MAGY S MAGRY(0)="0^Error Setting Queue: "_$P(MAGY,U,2),MAGY=TRKID
"RTN","MAGGSIUI",115,0)
 E  S MAGRY(0)=MAGY_"^Data has been Queued.",MAGY=+MAGY
"RTN","MAGGSIUI",116,0)
 ; for Testing, we'll track input array, and results array by Queue number.
"RTN","MAGGSIUI",117,0)
 I 'MAGRY(0) D ERRTRK Q
"RTN","MAGGSIUI",118,0)
 D LOGRES^MAGGSIU3(.MAGRY,0,APISESS)
"RTN","MAGGSIUI",119,0)
 ;
"RTN","MAGGSIUI",120,0)
 Q
"RTN","MAGGSIUI",121,0)
REQPARAM() ;Do required parameters have values.
"RTN","MAGGSIUI",122,0)
 N CT
"RTN","MAGGSIUI",123,0)
 S CT=0
"RTN","MAGGSIUI",124,0)
 S MAGRY(0)="1^Checking for Required parameter values..."
"RTN","MAGGSIUI",125,0)
 I IDFN="" S CT=CT+1,MAGRY(CT)="DFN is Required. !"
"RTN","MAGGSIUI",126,0)
 I '$D(IMAGES),'CMTH S CT=CT+1,MAGRY(CT)="List of Images is Required. !"
"RTN","MAGGSIUI",127,0)
 ;
"RTN","MAGGSIUI",128,0)
 I (PXPKG=""),(DOCCTG=""),(IXTYPE="") S CT=CT+1,MAGRY(CT)="Procedure or Category or Index Type is Required. !"
"RTN","MAGGSIUI",129,0)
 I (PXPKG'=""),(DOCCTG'="") S CT=CT+1,MAGRY(CT)="Procedure OR Document Category. Not BOTH. !"
"RTN","MAGGSIUI",130,0)
 ;
"RTN","MAGGSIUI",131,0)
 I (PXPKG'=""),(PXIEN="") S CT=CT+1,MAGRY(CT)="Procedure IEN is Required. !"
"RTN","MAGGSIUI",132,0)
 I (PXPKG=""),(PXIEN'="") S CT=CT+1,MAGRY(CT)="Procedure Package is Required. !"
"RTN","MAGGSIUI",133,0)
 I (PXPKG'=""),(PXDT="") S CT=CT+1,MAGRY(CT)="Procedure Date is Required. !"
"RTN","MAGGSIUI",134,0)
 ;
"RTN","MAGGSIUI",135,0)
 ;Patch 8 index field check... could be using Patch 7 or Patch 8.
"RTN","MAGGSIUI",136,0)
 ;  We're this far, so either PXIEN or DOCCTG is defined
"RTN","MAGGSIUI",137,0)
 I (IXTYPE'=""),(DOCCTG'="") S CT=CT+1,MAGRY(CT)="Image Type OR Document Category. Not BOTH. !"
"RTN","MAGGSIUI",138,0)
 ; MAGGSIA computes PACKAGE #40 and CLASS #41 when adding an Image (2005) entry.
"RTN","MAGGSIUI",139,0)
 ;
"RTN","MAGGSIUI",140,0)
 I TRKID="" S CT=CT+1,MAGRY(CT)="Tracking ID is Required. !"
"RTN","MAGGSIUI",141,0)
 I ACQD="" S CT=CT+1,MAGRY(CT)="Acquisition Device is Required. !"
"RTN","MAGGSIUI",142,0)
 ;   ACQS ( could ? ) default to users institution i.e. DUZ(2)
"RTN","MAGGSIUI",143,0)
 I (ACQS="")&(ACQN="") S CT=CT+1,MAGRY(CT)="Acquisition Site IEN or Station Number is Required. !"
"RTN","MAGGSIUI",144,0)
 ;
"RTN","MAGGSIUI",145,0)
 I STSCB="" S CT=CT+1,MAGRY(CT)="Status Handler (TAG^ROUTINE) is Required. !"
"RTN","MAGGSIUI",146,0)
 ;
"RTN","MAGGSIUI",147,0)
 I (DOCCTG'=""),(DOCDT="") S CT=CT+1,MAGRY(CT)="Document Date is Required. !"
"RTN","MAGGSIUI",148,0)
 ;
"RTN","MAGGSIUI",149,0)
 I (CT>0) S MAGRY(0)="0^Required parameter is null" Q MAGRY(0)
"RTN","MAGGSIUI",150,0)
 ;Checks to stop Duplicate or incorrect Tracking ID's
"RTN","MAGGSIUI",151,0)
 ;  //TODO: ?? check the Queue File, is this Tracking ID already Queued.
"RTN","MAGGSIUI",152,0)
 I (TRKID'="") I $D(^MAG(2005,"ATRKID",TRKID)) S MAGRY(0)="0^Tracking ID Must be Unique !"
"RTN","MAGGSIUI",153,0)
 I (TRKID'="") I ($L(TRKID,";")<2) S MAGRY(0)="0^Tracking ID Must have "";"" Delimiter"
"RTN","MAGGSIUI",154,0)
 ;
"RTN","MAGGSIUI",155,0)
 Q MAGRY(0)
"RTN","MAGGSIUI",156,0)
 ;
"RTN","MAGGSIUI",157,0)
SA(FLD,VAL) ;Set the data array with Fld,Value
"RTN","MAGGSIUI",158,0)
 Q:VAL=""
"RTN","MAGGSIUI",159,0)
 S CT=CT+1,MAGA(CT)=FLD_U_VAL
"RTN","MAGGSIUI",160,0)
 Q
"RTN","MAGGSIUI",161,0)
SI(FLD,ARR) ;Set the images into the data array
"RTN","MAGGSIUI",162,0)
 ; 'CT' is a global variable.
"RTN","MAGGSIUI",163,0)
 S MAGRY(0)="1^Valid Image file Extensions."
"RTN","MAGGSIUI",164,0)
 N I,MAGEXT,MAGFN
"RTN","MAGGSIUI",165,0)
 S I="" F  S I=$O(ARR(I)) Q:I=""  D  Q:'MAGRY(0)
"RTN","MAGGSIUI",166,0)
 . S CT=CT+1
"RTN","MAGGSIUI",167,0)
 . I ($L($P(ARR(I),U),".")<2) S MAGRY(0)="0^Invalid file name: "_ARR(I) Q
"RTN","MAGGSIUI",168,0)
 . S MAGFN=$P(ARR(I),"^")
"RTN","MAGGSIUI",169,0)
 . S MAGEXT=$$UP^XLFSTR($P(MAGFN,".",$L(MAGFN,".")))
"RTN","MAGGSIUI",170,0)
 . I '$D(^MAG(2005.021,"B",MAGEXT)) S MAGRY(0)="0^Unsupported File Type:'."_MAGEXT Q
"RTN","MAGGSIUI",171,0)
 . S MAGA(CT)="IMAGE"_U_ARR(I)
"RTN","MAGGSIUI",172,0)
 Q
"RTN","MAGGSIUI",173,0)
GETARR(ARR,QNUM) ;RPC [MAG4 DATA FROM IMPORT QUEUE]
"RTN","MAGGSIUI",174,0)
 ; Get the Input Array from Queue Number
"RTN","MAGGSIUI",175,0)
 I '$G(QNUM) S ARR(0)="0^INVALID QUEUE Number: "_$G(QNUM) Q
"RTN","MAGGSIUI",176,0)
 D IMPAR^MAGQBUT2(.ARR,QNUM)
"RTN","MAGGSIUI",177,0)
 Q
"RTN","MAGGSIUI",178,0)
STATUSCB(MAGRY,STAT,TAGRTN,DOCB) ;RPC [MAG4 STATUS CALLBACK]
"RTN","MAGGSIUI",179,0)
 ; Report Status to calling application
"RTN","MAGGSIUI",180,0)
 ; Now the IAPI and OCX make this call.  Not BP
"RTN","MAGGSIUI",181,0)
 ; STAT(0)= "0^message" or "1^message"
"RTN","MAGGSIUI",182,0)
 ; STAT(1)=TRKID,
"RTN","MAGGSIUI",183,0)
 ;        (2)=QNUM
"RTN","MAGGSIUI",184,0)
 ;        (3..N)=warnings
"RTN","MAGGSIUI",185,0)
 ;TAGRTN                 : The TAG^RTN to call with Status Array
"RTN","MAGGSIUI",186,0)
 ;DOCB                   : (1|0) to suppress execution of Status Callback
"RTN","MAGGSIUI",187,0)
 ; 
"RTN","MAGGSIUI",188,0)
 N APISESS,TRKID,CBMSG
"RTN","MAGGSIUI",189,0)
 S DOCB=$S($G(DOCB)="":1,1:+$G(DOCB)) ;  Default to TRUE
"RTN","MAGGSIUI",190,0)
 ; Old Import API and BP that made this call, will work : DOCB defaults to 1
"RTN","MAGGSIUI",191,0)
 S CBMSG=$S(DOCB:"Status Callback was called",1:"Status Callback was NOT called")
"RTN","MAGGSIUI",192,0)
 I DOCB D @(TAGRTN_"(.STAT)")
"RTN","MAGGSIUI",193,0)
 S MAGRY="1^"_CBMSG
"RTN","MAGGSIUI",194,0)
 S STAT($O(STAT(""),-1)+1)=MAGRY
"RTN","MAGGSIUI",195,0)
 S TRKID=$G(STAT(1))
"RTN","MAGGSIUI",196,0)
 ; Log Results. Always.
"RTN","MAGGSIUI",197,0)
 I $L(TRKID) D
"RTN","MAGGSIUI",198,0)
 . S APISESS=$$SES4TRK^MAGGSIU3(TRKID) ;
"RTN","MAGGSIUI",199,0)
 . I APISESS D LOGRES^MAGGSIU3(.STAT,0,APISESS) ;gek/send Tracking ID to log status
"RTN","MAGGSIUI",200,0)
 Q
"RTN","MAGGSIUI",201,0)
TESTCB(STATARR) ;TESTING.  This is the Status Callback for testing.
"RTN","MAGGSIUI",202,0)
 ; the STATUSCB property must have a Valid "M" TAG^ROUTINE
"RTN","MAGGSIUI",203,0)
 ; TAG TESTCB exists so that STATUSCB validates successfully
"RTN","MAGGSIUI",204,0)
 Q
"RTN","MAGGSIUI",205,0)
ERRTRK ;Track bad data and Quit
"RTN","MAGGSIUI",206,0)
 N I
"RTN","MAGGSIUI",207,0)
 D LOGERR^MAGGSERR("---- New Error ----",APISESS)
"RTN","MAGGSIUI",208,0)
 S I="" F  S I=$O(MAGRY(I)) Q:I=""  D LOGERR^MAGGSERR(MAGRY(I),APISESS)
"RTN","MAGGSIUI",209,0)
 Q
"RTN","MAGGSIUI",210,0)
DATATRK ; Track the raw data being sent to the Import API.
"RTN","MAGGSIUI",211,0)
 ; Log the data being imported.  Results are logged later.
"RTN","MAGGSIUI",212,0)
 N XY
"RTN","MAGGSIUI",213,0)
 S APISESS=$$LOG^MAGGSIU3(.XY,.MAGIXZ,.IMAGES,IDFN,ACQD,TRKID)
"RTN","MAGGSIUI",214,0)
 Q
"RTN","MAGGSIUI",215,0)
ERR ; ERROR TRAP FOR Import API
"RTN","MAGGSIUI",216,0)
 N ERR S ERR=$$EC^%ZOSV
"RTN","MAGGSIUI",217,0)
 S MAGRY(0)="0^ETRAP: "_ERR
"RTN","MAGGSIUI",218,0)
 D @^%ZOSF("ERRTN")
"RTN","MAGGSIUI",219,0)
 I $G(APISESS) D ERRTRK
"RTN","MAGGSIUI",220,0)
 Q
"RTN","MAGGSIV")
0^27^B38730975
"RTN","MAGGSIV",1,0)
MAGGSIV ;WOIFO/GEK - Imaging RPC Broker calls. Validate Image data array ; [ 12/27/2000 10:49 ]
"RTN","MAGGSIV",2,0)
 ;;3.0;IMAGING;**7,8,20**;Apr 12, 2006
"RTN","MAGGSIV",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGSIV",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGGSIV",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGGSIV",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGGSIV",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGGSIV",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGGSIV",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGGSIV",10,0)
 ;; |                                                               |
"RTN","MAGGSIV",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGGSIV",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGGSIV",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGGSIV",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGGSIV",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGGSIV",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGSIV",17,0)
 ;;
"RTN","MAGGSIV",18,0)
 Q
"RTN","MAGGSIV",19,0)
VAL(MAGRY,MAGARRAY,ALL) ;RPC [MAG4 VALIDATE DATA]
"RTN","MAGGSIV",20,0)
 ;Call to Validate the Image Data Array before a new image/modified entry is attempted.  
"RTN","MAGGSIV",21,0)
 ; Called from MAGGSIA, MAGGSIUI and Capture GUI.
"RTN","MAGGSIV",22,0)
 ;  Parameters : 
"RTN","MAGGSIV",23,0)
 ;    MAGARRAY - array of 'Field numbers'|'Action codes'  and their Values 
"RTN","MAGGSIV",24,0)
 ;                     MAGARRAY(1)="5^38"  Field#:  5   Value: 38
"RTN","MAGGSIV",25,0)
 ;         an example of an action code is the Code for File Extension    
"RTN","MAGGSIV",26,0)
 ;                     MAGARRAY(2)="EXT^JPG"  Action: EXT Value: JPG                        
"RTN","MAGGSIV",27,0)
 ;    ALL - "1" = Validate ALL fields, returning an array of error messages.
"RTN","MAGGSIV",28,0)
 ;          "0" = Stop validating if an error occurs, return
"RTN","MAGGSIV",29,0)
 ;                           the error message in (0) node.
"RTN","MAGGSIV",30,0)
 ;  Return Variable
"RTN","MAGGSIV",31,0)
 ;    MAGRY() - Array
"RTN","MAGGSIV",32,0)
 ;      Successful   MAGRY(0) = 1^Image Data is Valid.
"RTN","MAGGSIV",33,0)
 ;      UNsuccessful MAGRY(0) = 0^Error desc
"RTN","MAGGSIV",34,0)
 ;                   IF ALL then MAGRY(1..N) =0^Error desc of all errors
"RTN","MAGGSIV",35,0)
 N MAGGFLD,MAGGDAT,MAGFSPEC,CHKOK,MAGETXT,MAGRET,MAGRES
"RTN","MAGGSIV",36,0)
 N Y,AITEM,CT,MAGERR,DFNFLAG,DAT1,X,MAX
"RTN","MAGGSIV",37,0)
 N $ETRAP,$ESTACK S $ETRAP="D ERR^"_$T(+0)
"RTN","MAGGSIV",38,0)
 S ALL=$G(ALL)
"RTN","MAGGSIV",39,0)
 S MAGRY(0)="0^Validating the Data Array..."
"RTN","MAGGSIV",40,0)
 S MAGERR="",DFNFLAG=0,CT=0
"RTN","MAGGSIV",41,0)
 ;  Do we have any data ? 
"RTN","MAGGSIV",42,0)
 I ($D(MAGARRAY)<10) S MAGRY(0)="0^No input data, Operation CANCELED" Q
"RTN","MAGGSIV",43,0)
 ;  Flag if from Maximus
"RTN","MAGGSIV",44,0)
 S MAX=0
"RTN","MAGGSIV",45,0)
 S X="" F  S X=$O(MAGARRAY(X)) Q:X=""  I $P(MAGARRAY(X),U,1)="TRKID"!($P(MAGARRAY(X),U,1)="108") I $P($P(MAGARRAY(X),U,2),";",1)="MAX" S MAX=1
"RTN","MAGGSIV",46,0)
 ;  Loop through Input Array
"RTN","MAGGSIV",47,0)
 S AITEM="" F  S AITEM=$O(MAGARRAY(AITEM)) Q:AITEM=""  D  I $L(MAGERR) Q:'ALL  S CT=CT+1,MAGRY(CT)=MAGERR,MAGERR=""
"RTN","MAGGSIV",48,0)
 . S MAGERR=""
"RTN","MAGGSIV",49,0)
 . S MAGGFLD=$P(MAGARRAY(AITEM),U,1),MAGGDAT=$P(MAGARRAY(AITEM),U,2,99)
"RTN","MAGGSIV",50,0)
 . I MAGGFLD="" S MAGERR="0^A Field Number/Action Code is required: "_" Item: "_MAGARRAY(AITEM) Q
"RTN","MAGGSIV",51,0)
 . I MAGGDAT="" S MAGERR="0^A Value is required."_" Item: "_MAGARRAY(AITEM) Q
"RTN","MAGGSIV",52,0)
 . I MAGGFLD=5 S DFNFLAG=1
"RTN","MAGGSIV",53,0)
 . ; This inadvertently disallowed Tracking ID's on Group Images.
"RTN","MAGGSIV",54,0)
 . ;I MAGGFLD=108 I $D(^MAG(2005,"ATRKID",MAGGDAT)) S MAGERR="0^Tracking ID Must be Unique !" Q
"RTN","MAGGSIV",55,0)
 . I MAGGFLD=108 I ($L(MAGGDAT,";")<2) S MAGRY(0)="0^Tracking ID Must have "";"" Delimiter" Q
"RTN","MAGGSIV",56,0)
 . ; Check for possible action codes that could be in the array.
"RTN","MAGGSIV",57,0)
 . I $$ACTCODE(MAGGFLD) D  Q
"RTN","MAGGSIV",58,0)
 . . S DAT1=MAGGDAT
"RTN","MAGGSIV",59,0)
 . . S Y=$$VALCODE(MAGGFLD,.MAGGDAT) S:'Y MAGERR=Y_" Item: "_MAGARRAY(AITEM)
"RTN","MAGGSIV",60,0)
 . . I DAT1'=MAGGDAT S MAGARRAY(AITEM)=MAGGFLD_"^"_MAGGDAT
"RTN","MAGGSIV",61,0)
 . ; If we are adding Multiple Images to a Group, they must be Validated.
"RTN","MAGGSIV",62,0)
 . ;   we could have multiple "2005.04^IENs" in this array. Which means we are 
"RTN","MAGGSIV",63,0)
 . ;   adding existing Images to a New/Existing Group.
"RTN","MAGGSIV",64,0)
 . I MAGGFLD=2005.04 D  Q  ; 2005.04 isn't the field number, #4 is the field number
"RTN","MAGGSIV",65,0)
 . . I $G(MAGGDAT,0)=0 Q  ;Creating a new Group, with no group entries is the usual way
"RTN","MAGGSIV",66,0)
 . . ; to do it.  Then make successive calls to ADD, Adding each Image to the 
"RTN","MAGGSIV",67,0)
 . . ; Object Group multiple of the Group Parent (fld#14) as it is created.
"RTN","MAGGSIV",68,0)
 . . I '$D(^MAG(2005,MAGGDAT,0)) S MAGERR="0^Group Object "_MAGGDAT_" doesn't exist"_" Item: "_MAGARRAY(AITEM)
"RTN","MAGGSIV",69,0)
 . . ;  We can't allow adding an image if it already has a group parent.
"RTN","MAGGSIV",70,0)
 . . I $P(^MAG(2005,MAGGDAT,0),U,10) S MAGERR="0^The Image to be added to the Group, already has a Group Parent"_" Item: "_MAGARRAY(AITEM)
"RTN","MAGGSIV",71,0)
 . ; if we are getting a WP line of text for Long Desc Field.  Can't validate it.
"RTN","MAGGSIV",72,0)
 . I MAGGFLD=11 Q  ; this is a line of the WP Long Desc field.
"RTN","MAGGSIV",73,0)
 . ; NEW CALL TO VALIDATE FILE,FIELD,DATA 
"RTN","MAGGSIV",74,0)
 . S DAT1=MAGGDAT
"RTN","MAGGSIV",75,0)
 . I '$$VALID^MAGGSIV1(2005,MAGGFLD,.MAGGDAT,.MAGRES) S MAGERR="0^"_MAGRES Q
"RTN","MAGGSIV",76,0)
 . I DAT1'=MAGGDAT S MAGARRAY(AITEM)=MAGGFLD_"^"_MAGGDAT
"RTN","MAGGSIV",77,0)
 . Q
"RTN","MAGGSIV",78,0)
 ;
"RTN","MAGGSIV",79,0)
 ; if there was an Error in data we'll quit now.
"RTN","MAGGSIV",80,0)
 ; If ALL is true, then MAGRY(1...N) will exist if there were errors.
"RTN","MAGGSIV",81,0)
 I $O(MAGRY(0)) S MAGRY(0)="0^Errors were found in data." Q
"RTN","MAGGSIV",82,0)
 ; If ALL is false, then MAGERR will exist if there was an error.
"RTN","MAGGSIV",83,0)
 I $L(MAGERR) S MAGRY(0)=MAGERR Q
"RTN","MAGGSIV",84,0)
 ;
"RTN","MAGGSIV",85,0)
 ;  If all data is valid we get here.
"RTN","MAGGSIV",86,0)
 ;  Last Test, see if a Patient was in array, 
"RTN","MAGGSIV",87,0)
 ;  (Patient is the only Required field check done in this routine).
"RTN","MAGGSIV",88,0)
 I 'DFNFLAG S MAGRY(0)="0^A Patient DFN is required. " Q
"RTN","MAGGSIV",89,0)
 S MAGRY(0)="1^Data is Valid."
"RTN","MAGGSIV",90,0)
 Q
"RTN","MAGGSIV",91,0)
ACTCODE(CODE) ;Function that returns True (1) if this code is a valid Import API Action Code
"RTN","MAGGSIV",92,0)
 ; Patch 8.  We're adding 107 as an action code, so it will pass validation even if the entry
"RTN","MAGGSIV",93,0)
 ;   in the Acquisition Device File doesn't exist;
"RTN","MAGGSIV",94,0)
 ;   it will be validated in PRE^MAGGSIA1 and a new Acquisition Device entry made if needed.
"RTN","MAGGSIV",95,0)
 I ",107,ACQD,IEN,EXT,ABS,JB,WRITE,BIG,DICOMSN,DICOMIN,ACQS,ACQL,STATUSCB,CALLMTH,USERNAME,PASSWORD,DELFLAG,TRNSTYP,"[(","_CODE_",") Q 1
"RTN","MAGGSIV",96,0)
 Q 0
"RTN","MAGGSIV",97,0)
VALCODE(CODE,VALUE) ; We validate the values for the possible action codes
"RTN","MAGGSIV",98,0)
 N MAGY
"RTN","MAGGSIV",99,0)
 I VALUE="" Q "0^NO VALUE in Action Code string: """_X_""
"RTN","MAGGSIV",100,0)
 ; Patch 8, added 107 
"RTN","MAGGSIV",101,0)
 I ",ACQL,CALLMTH,USERNAME,PASSWORD,"[(","_CODE_",") Q 1 ; NO VALIDATION FOR THESE CODES
"RTN","MAGGSIV",102,0)
 D @CODE
"RTN","MAGGSIV",103,0)
 Q MAGY
"RTN","MAGGSIV",104,0)
 ;  Each Tag is a valid Action code
"RTN","MAGGSIV",105,0)
IEN I $D(^MAG(2005,VALUE)) S MAGY=1
"RTN","MAGGSIV",106,0)
 E  S MAGY="0^INVALID IMAGE IEN."
"RTN","MAGGSIV",107,0)
 Q
"RTN","MAGGSIV",108,0)
EXT ; code will go here to validate the extension type.  i.e. we won't let types .exe .bat .com .zip ... etc.
"RTN","MAGGSIV",109,0)
 ;  Maybe a modification to Object Type file, to have allowable extensions in the file, and a 
"RTN","MAGGSIV",110,0)
 ;  cross reference on a new field EXTENSION.  The capture workstation wouldn't have to ask the 
"RTN","MAGGSIV",111,0)
 ; user for the file type of each file, and we wouldn't get WORD .DOC files that the user called Color Images
"RTN","MAGGSIV",112,0)
ABS ; Meaning: Have the BP create the abstract
"RTN","MAGGSIV",113,0)
JB ; Meaning: Have the BP copy the image to the JukeBox
"RTN","MAGGSIV",114,0)
BIG ; Meaning: There is a big file also, set the Image File field ? to indicate there is a BIG File.
"RTN","MAGGSIV",115,0)
 S MAGY=1
"RTN","MAGGSIV",116,0)
 Q
"RTN","MAGGSIV",117,0)
WRITE ; Meaning: This is the Internal Entry (or "PACS") of the WRITE Directory. Images will be written
"RTN","MAGGSIV",118,0)
 ; here instead of the default WRITE Directory.
"RTN","MAGGSIV",119,0)
 S MAGY=$$DRIVE^MAGGTU1(VALUE)
"RTN","MAGGSIV",120,0)
 Q
"RTN","MAGGSIV",121,0)
DICOMSN ;Meaning: DICOM Series Number.  This will be entered in the Group Object multiple, field #1
"RTN","MAGGSIV",122,0)
 ;We were validating this as an integer, but it can be anything, no way to validate.
"RTN","MAGGSIV",123,0)
 S MAGY=1
"RTN","MAGGSIV",124,0)
 Q
"RTN","MAGGSIV",125,0)
DICOMIN ;Meaning: DICOM Image Number.  This will be entered in the Group Object multiple, field #2
"RTN","MAGGSIV",126,0)
 ; We were validating this as an integer, but it can be anything, no way to validate.
"RTN","MAGGSIV",127,0)
 S MAGY=1
"RTN","MAGGSIV",128,0)
 Q
"RTN","MAGGSIV",129,0)
DELFLAG ;Meaning: This flag tells the Delphi Import Component to Delete the Image files after successful processing
"RTN","MAGGSIV",130,0)
 I ",TRUE,FALSE,0,1,"[(","_$$UPPER(VALUE)_",") S MAGY=1
"RTN","MAGGSIV",131,0)
 E  S MAGY="0^INVALID Value "
"RTN","MAGGSIV",132,0)
 I VALUE="1" S VALUE="TRUE"
"RTN","MAGGSIV",133,0)
 I VALUE="0" S VALUE="FALSE"
"RTN","MAGGSIV",134,0)
 Q
"RTN","MAGGSIV",135,0)
TRNSTYP ;Meaning: This flag is for future use, for now it is ignored, defaults to "NEW"
"RTN","MAGGSIV",136,0)
 S MAGY=1
"RTN","MAGGSIV",137,0)
 Q
"RTN","MAGGSIV",138,0)
STATUSCB ; Meaning: This is the TAG^RTN that Imaging calls to report the 
"RTN","MAGGSIV",139,0)
 ; status of the Import.
"RTN","MAGGSIV",140,0)
 S MAGY="0^Error validating TAG^RTN: "_VALUE
"RTN","MAGGSIV",141,0)
 I '$L($T(@VALUE)) S MAGY="0^Invalid Status CallBack "_VALUE
"RTN","MAGGSIV",142,0)
 E  S MAGY=1
"RTN","MAGGSIV",143,0)
 Q
"RTN","MAGGSIV",144,0)
ACQS ; We need to make sure the ACQS (Acquisition Site) is a Valid entry in Imaging Site Params.
"RTN","MAGGSIV",145,0)
 S VALUE=$P(VALUE,";") ; Stop error, when old OCX sends data.
"RTN","MAGGSIV",146,0)
 ; Next Block is for VIC (Maximus) that sends Station Number.
"RTN","MAGGSIV",147,0)
 N ERR S ERR=0
"RTN","MAGGSIV",148,0)
 I MAX D  Q:ERR
"RTN","MAGGSIV",149,0)
 . S X=$O(^DIC(4,"D",VALUE,""))
"RTN","MAGGSIV",150,0)
 . I X="" S MAGY="0^Invalid STATION NUMBER: (ACQS): "_VALUE,ERR=1 Q
"RTN","MAGGSIV",151,0)
 . S VALUE=X
"RTN","MAGGSIV",152,0)
 . Q
"RTN","MAGGSIV",153,0)
 I '$$CONSOLID^MAGBAPI S MAGY=1 Q
"RTN","MAGGSIV",154,0)
 ;Patch 20 will have this.
"RTN","MAGGSIV",155,0)
 I '$D(^MAG(2006.1,"B",VALUE)) S MAGY="0^Acquisition Site ("_VALUE_") is Not in Site Param File." Q
"RTN","MAGGSIV",156,0)
 S MAGY=1
"RTN","MAGGSIV",157,0)
 Q
"RTN","MAGGSIV",158,0)
107 ;    107 and ACQD are the same.  Calling 107 falls into validation for ACQD.
"RTN","MAGGSIV",159,0)
ACQD ; 107 and ACQD are ACQUISITION DEVICE FILE (2006.04) pointers or Values.
"RTN","MAGGSIV",160,0)
 ; If it is an integer, We assume the value is an IEN and validate it here.
"RTN","MAGGSIV",161,0)
 I ((+VALUE)=VALUE),'$D(^MAG(2006.04,VALUE)) S MAGY="0^Invalid IEN ("_VALUE_") for ACQUISITION DEVICE File." Q
"RTN","MAGGSIV",162,0)
 ; if it is not an integer, it is either a new/existing entry for 2006.04 Result is Success,
"RTN","MAGGSIV",163,0)
 ;       and it will be validated in PRE^MAGGSIA1 and added to File 2006.04 if needed.
"RTN","MAGGSIV",164,0)
 S MAGY=1
"RTN","MAGGSIV",165,0)
 Q
"RTN","MAGGSIV",166,0)
UPPER(X) ;
"RTN","MAGGSIV",167,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","MAGGSIV",168,0)
 ;
"RTN","MAGGSIV",169,0)
ERR ; ERROR TRAP FOR Import API
"RTN","MAGGSIV",170,0)
 N ERR S ERR=$$EC^%ZOSV
"RTN","MAGGSIV",171,0)
 S MAGRY(0)="0^ETRAP: "_ERR
"RTN","MAGGSIV",172,0)
 D @^%ZOSF("ERRTN")
"RTN","MAGGSIV",173,0)
 Q
"RTN","MAGGSIV1")
0^35^B21788454
"RTN","MAGGSIV1",1,0)
MAGGSIV1 ;WOIFO/GEK - Imaging Validate Data ; [ 08/15/2004 08:57 ]
"RTN","MAGGSIV1",2,0)
 ;;3.0;IMAGING;**8,20**;Apr 12, 2006
"RTN","MAGGSIV1",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGSIV1",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGGSIV1",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGGSIV1",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGGSIV1",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGGSIV1",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGGSIV1",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGGSIV1",10,0)
 ;; |                                                               |
"RTN","MAGGSIV1",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGGSIV1",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGGSIV1",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGGSIV1",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGGSIV1",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGGSIV1",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGSIV1",17,0)
 ;;
"RTN","MAGGSIV1",18,0)
 Q
"RTN","MAGGSIV1",19,0)
VALID(MAGF,MAGL,MAGD,MAGRES) ; call to validate value for field in a FM file.
"RTN","MAGGSIV1",20,0)
 ; Function is boolean.  Returns:
"RTN","MAGGSIV1",21,0)
 ;        0   -  Invalid 
"RTN","MAGGSIV1",22,0)
 ;        1   -  Valid 
"RTN","MAGGSIV1",23,0)
 ;        ""  -  Error
"RTN","MAGGSIV1",24,0)
 ; Call this function before you set the FDA Array.
"RTN","MAGGSIV1",25,0)
 ; MAGD - sent by reference because it could be Internal or External
"RTN","MAGGSIV1",26,0)
 ;        and if it is external and valid, it is changed to Internal.
"RTN","MAGGSIV1",27,0)
 ;        
"RTN","MAGGSIV1",28,0)
 ; MAGF  : File Number
"RTN","MAGGSIV1",29,0)
 ; MAGL  : Field Number
"RTN","MAGGSIV1",30,0)
 ; MAGD  : (sent by reference) data value of field
"RTN","MAGGSIV1",31,0)
 ; MAGRES: (sent by reference) Result message
"RTN","MAGGSIV1",32,0)
 ;
"RTN","MAGGSIV1",33,0)
 N $ETRAP,$ESTACK S $ETRAP="D ERR^"_$T(+0)
"RTN","MAGGSIV1",34,0)
 N MAGR,MAGMSG,MAGSP,MAGRESA,MAGE,MAGPT
"RTN","MAGGSIV1",35,0)
 ;if a BAD field number
"RTN","MAGGSIV1",36,0)
 I '$$VFIELD^DILFD(MAGF,MAGL) D  Q 0
"RTN","MAGGSIV1",37,0)
 . S MAGRES="The field number: "_MAGL_", in File: "_MAGF_", is invalid."
"RTN","MAGGSIV1",38,0)
 D FIELD^DID(MAGF,MAGL,"","SPECIFIER","MAGSP")
"RTN","MAGGSIV1",39,0)
 ; If it is a pointer field 
"RTN","MAGGSIV1",40,0)
 ; If an  integer - We assume it is a pointer and validate that and Quit.
"RTN","MAGGSIV1",41,0)
 ; If not integer - We assume it is external value, proceed to let CHK do validate
"RTN","MAGGSIV1",42,0)
 I (MAGSP("SPECIFIER")["P"),(+MAGD=MAGD) D  Q MAGPT
"RTN","MAGGSIV1",43,0)
 . I $$EXTERNAL^DILFD(MAGF,MAGL,"",MAGD)'="" S MAGPT=1,MAGRES="Valid pointer" Q
"RTN","MAGGSIV1",44,0)
 . S MAGPT=0,MAGRES="The value: "_MAGD_" for field: "_MAGL_" in File: "_MAGF_" is an invalid Pointer."
"RTN","MAGGSIV1",45,0)
 . Q
"RTN","MAGGSIV1",46,0)
 ;
"RTN","MAGGSIV1",47,0)
 D CHK^DIE(MAGF,MAGL,"E",MAGD,.MAGR,"MAGMSG")
"RTN","MAGGSIV1",48,0)
 ; If success, Quit. We changed External to Internal. Internal is in MAGR
"RTN","MAGGSIV1",49,0)
 I MAGR'="^" S MAGD=MAGR Q 1
"RTN","MAGGSIV1",50,0)
 ;  If not success Get the error text and Quit 0
"RTN","MAGGSIV1",51,0)
 D MSG^DIALOG("A",.MAGRESA,245,5,"MAGMSG")
"RTN","MAGGSIV1",52,0)
 S MAGRES=MAGRESA(1)
"RTN","MAGGSIV1",53,0)
 Q 0
"RTN","MAGGSIV1",54,0)
VALINDEX(MAGRY,TYPE,SPEC,PROC) ; Validate the interdependency of Index Terms.
"RTN","MAGGSIV1",55,0)
 ; MAGRY is the return array 
"RTN","MAGGSIV1",56,0)
 ; MAGRY(0)="1^Okay"  or   "0^error message"
"RTN","MAGGSIV1",57,0)
 ; MAGRY(1..n)  Information about the Type,Spec and Proc
"RTN","MAGGSIV1",58,0)
 ; 
"RTN","MAGGSIV1",59,0)
 ; Validate the Procedure/Event <-> Specialty/SubSpecialty interdependency
"RTN","MAGGSIV1",60,0)
 ; Assure the TYPE is a Clinical TYPE.
"RTN","MAGGSIV1",61,0)
 ; Assure all are Active.
"RTN","MAGGSIV1",62,0)
 N CLS,RES,ARR,TYX,PRX,SPX,OK
"RTN","MAGGSIV1",63,0)
 K MAGRY
"RTN","MAGGSIV1",64,0)
 S TYPE=$G(TYPE),PROC=$G(PROC),SPEC=$G(SPEC)
"RTN","MAGGSIV1",65,0)
 I TYPE=0 S TYPE=""
"RTN","MAGGSIV1",66,0)
 I PROC=0 S PROC=""
"RTN","MAGGSIV1",67,0)
 I SPEC=0 S SPEC=""
"RTN","MAGGSIV1",68,0)
 I ((PROC]"")!(SPEC]"")) I TYPE="" S MAGRY(0)="0^Type is required." Q 0
"RTN","MAGGSIV1",69,0)
 ; TYPE is required, but not enforcing yet.  All vendors are not sending
"RTN","MAGGSIV1",70,0)
 ; index values.
"RTN","MAGGSIV1",71,0)
 ; VALID will accept External or Internal and return Internal if Valid
"RTN","MAGGSIV1",72,0)
 I $L(TYPE) I '$$VALID(2005,42,.TYPE,.RES) S MAGRY(0)="0^"_RES Q 0
"RTN","MAGGSIV1",73,0)
 I $L(PROC) I '$$VALID(2005,43,.PROC,.RES) S MAGRY(0)="0^"_RES Q 0
"RTN","MAGGSIV1",74,0)
 I $L(SPEC) I '$$VALID(2005,44,.SPEC,.RES) S MAGRY(0)="0^"_RES Q 0
"RTN","MAGGSIV1",75,0)
 ;
"RTN","MAGGSIV1",76,0)
 I TYPE D  I 'OK S MAGRY(0)=OK Q 0
"RTN","MAGGSIV1",77,0)
 . S OK=1,TYX=TYPE_","
"RTN","MAGGSIV1",78,0)
 . K ARR D GETS^DIQ(2005.83,TYX,".01;1;2","EI","ARR")
"RTN","MAGGSIV1",79,0)
 . S MAGRY(1)="Type - Class          : "_ARR(2005.83,TYX,.01,"E")_" - "_ARR(2005.83,TYX,1,"E")
"RTN","MAGGSIV1",80,0)
 . I $L(ARR(2005.83,TYX,2,"E")) S MAGRY(1)=MAGRY(1)_" - "_ARR(2005.83,TYX,2,"E")
"RTN","MAGGSIV1",81,0)
 . I ARR(2005.83,TYX,2,"I")="I" S OK="0^Type is Inactive"
"RTN","MAGGSIV1",82,0)
 . Q
"RTN","MAGGSIV1",83,0)
 ;
"RTN","MAGGSIV1",84,0)
 I SPEC D  I 'OK S MAGRY(0)=OK Q 0
"RTN","MAGGSIV1",85,0)
 . S OK=1,SPX=SPEC_","
"RTN","MAGGSIV1",86,0)
 . K ARR D GETS^DIQ(2005.84,SPX,".01;2;4","EI","ARR")
"RTN","MAGGSIV1",87,0)
 . S MAGRY(2)="Specialty/SubSpecialty: "_ARR(2005.84,SPX,.01,"E")
"RTN","MAGGSIV1",88,0)
 . I $L(ARR(2005.84,SPX,4,"E")) S MAGRY(2)=MAGRY(2)_" - "_ARR(2005.84,SPX,4,"E")
"RTN","MAGGSIV1",89,0)
 . I $L(ARR(2005.84,SPX,2,"E")) S MAGRY(2)=MAGRY(2)_" <"_ARR(2005.84,SPX,2,"E")_">"
"RTN","MAGGSIV1",90,0)
 . I ARR(2005.84,SPX,4,"I")="I" S OK="0^Specialty is Inactive"
"RTN","MAGGSIV1",91,0)
 . Q
"RTN","MAGGSIV1",92,0)
 ;
"RTN","MAGGSIV1",93,0)
 I PROC D  I 'OK S MAGRY(0)=OK Q 0
"RTN","MAGGSIV1",94,0)
 . S OK=1,PRX=PROC_","
"RTN","MAGGSIV1",95,0)
 . K ARR D GETS^DIQ(2005.85,PRX,".01;4","EI","ARR")
"RTN","MAGGSIV1",96,0)
 . S MAGRY(4)="Procedure/Event       : "_$$GET1^DIQ(2005.85,PROC,.01)
"RTN","MAGGSIV1",97,0)
 . I $L(ARR(2005.85,PRX,4,"E")) S MAGRY(4)=MAGRY(4)_" - "_ARR(2005.85,PRX,4,"E")
"RTN","MAGGSIV1",98,0)
 . I ARR(2005.85,PRX,4,"I")="I" S OK="0^Procedure is Inactive"
"RTN","MAGGSIV1",99,0)
 . Q
"RTN","MAGGSIV1",100,0)
 ;
"RTN","MAGGSIV1",101,0)
 ; If PROC and SPEC are "", then Quit, any TYPE by itself is valid
"RTN","MAGGSIV1",102,0)
 I (PROC=""),(SPEC="") S MAGRY(0)="1^Okay" Q 1
"RTN","MAGGSIV1",103,0)
 ; Here, TYPE has to be Clin.
"RTN","MAGGSIV1",104,0)
 S CLS=$$GET1^DIQ(2005.83,TYPE,1,"","MAGTAR") I $E(CLS,1,5)="ADMIN" D  Q 0
"RTN","MAGGSIV1",105,0)
 . S MAGRY(0)="0^The Type Index is Administrative, it has to be Clinical."
"RTN","MAGGSIV1",106,0)
 I (PROC="")!(SPEC="") S MAGRY(0)="1^Okay" Q 1
"RTN","MAGGSIV1",107,0)
 ; we get here, we have to validate the interdependency of SPEC <-> PROC.
"RTN","MAGGSIV1",108,0)
 I '$O(^MAG(2005.85,PROC,1,0)) S MAGRY(0)="1^Okay" Q 1
"RTN","MAGGSIV1",109,0)
 I '$D(^MAG(2005.85,PROC,1,"B",SPEC)) D  Q 0
"RTN","MAGGSIV1",110,0)
 . S MAGRY(0)="0^Invalid Association between Spec/SubSpec and Proc/Event"
"RTN","MAGGSIV1",111,0)
 . Q
"RTN","MAGGSIV1",112,0)
 S MAGRY(0)="1^Okay"
"RTN","MAGGSIV1",113,0)
 Q 1
"RTN","MAGGSIV1",114,0)
ERR ;
"RTN","MAGGSIV1",115,0)
 N ERR
"RTN","MAGGSIV1",116,0)
 S ERR=$$EC^%ZOSV
"RTN","MAGGSIV1",117,0)
 S MAGRES="0^Error during data validation: "_ERR
"RTN","MAGGSIV1",118,0)
 D LOGERR^MAGGTERR(ERR)
"RTN","MAGGSIV1",119,0)
 D @^%ZOSF("ERRTN")
"RTN","MAGGSIV1",120,0)
 D CLEAN^DILF
"RTN","MAGGSIV1",121,0)
 Q
"RTN","MAGGTU3")
0^25^B61285454
"RTN","MAGGTU3",1,0)
MAGGTU3 ;WOIFO/GEK - Silent calls for Imaging ; [ 06/20/2001 08:57 ]
"RTN","MAGGTU3",2,0)
 ;;3.0;IMAGING;**7,8,48,45,20**;Apr 12, 2006
"RTN","MAGGTU3",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGTU3",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGGTU3",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGGTU3",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGGTU3",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGGTU3",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGGTU3",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGGTU3",10,0)
 ;; |                                                               |
"RTN","MAGGTU3",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGGTU3",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGGTU3",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGGTU3",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGGTU3",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGGTU3",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGTU3",17,0)
 ;;
"RTN","MAGGTU3",18,0)
 Q
"RTN","MAGGTU3",19,0)
IMAGEINF(MAGRY,IEN,NOCHK) ;RPC [MAGG IMAGE INFO] Call to return information for 1 image;
"RTN","MAGGTU3",20,0)
 ; IEN   =       Image IEN ^MAG(2005,IEN
"RTN","MAGGTU3",21,0)
 ; NOCHK =   If Flag = 1, then do not run QA check on this image.
"RTN","MAGGTU3",22,0)
 ; 
"RTN","MAGGTU3",23,0)
 N MAGFILE,Y,Z,MAGNOCHK
"RTN","MAGGTU3",24,0)
 I '$D(^MAG(2005,IEN)) D  Q
"RTN","MAGGTU3",25,0)
 . I $D(^MAG(2005.1,IEN)) S MAGRY(0)="0^Image : """_$P($G(^MAG(2005.1,IEN,2)),U,4)_""" has been deleted." Q
"RTN","MAGGTU3",26,0)
 . S MAGRY(0)="0^INVALID Image number "_IEN
"RTN","MAGGTU3",27,0)
 . Q
"RTN","MAGGTU3",28,0)
 ; MAGGTII queries the variable MAGNOCHK to run QA check or not.
"RTN","MAGGTU3",29,0)
 S MAGNOCHK=+$G(NOCHK)
"RTN","MAGGTU3",30,0)
 S MAGXX=IEN D INFO^MAGGTII ; this'll give us the  MAGFILE variable
"RTN","MAGGTU3",31,0)
 S Z=$P(^MAG(2005,IEN,0),U,7)
"RTN","MAGGTU3",32,0)
 I '$D(^DPT(Z)) S Z="1^Invalid patient pointer"
"RTN","MAGGTU3",33,0)
 E  S Z=Z_U_$P(^DPT(Z,0),U)
"RTN","MAGGTU3",34,0)
 S MAGRY(0)="1^"_MAGFILE
"RTN","MAGGTU3",35,0)
 S MAGRY(1)=Z ; dfn^name
"RTN","MAGGTU3",36,0)
 Q
"RTN","MAGGTU3",37,0)
USERINF2(MAGRY,MAGWRKID) ;RPC [MAGGUSER2] Return user info.
"RTN","MAGGTU3",38,0)
 ; MAGRY(1) = DUZ ^ FULL NAME  ^ INITIALS
"RTN","MAGGTU3",39,0)
 ; MAGRY(2) = Network UserName ^ PassWord.
"RTN","MAGGTU3",40,0)
 ; MAGRY(3) = MUSE Site number. ( default = 1)
"RTN","MAGGTU3",41,0)
 ; Node 4 is data from IMAGING SITE PARAMATERS File #2006.1 and INSTITUTION File #4
"RTN","MAGGTU3",42,0)
 ; MAGRY(4)= IEN  ^ SITE CODE ^ DUZ(2) ^ INSTITUTION NAME (.01) ^ $$CONSOLID ^ STATION NUMBER (99)
"RTN","MAGGTU3",43,0)
 ; MAGRY(5) = +<CP Version>|0 ^ Version of CP installed on Server
"RTN","MAGGTU3",44,0)
 ; MAGRY(6) = Warning message if we can't resolve which Site Parameter entry to use.
"RTN","MAGGTU3",45,0)
 ; MAGRY(7) = Warning message  <reserved for future>
"RTN","MAGGTU3",46,0)
 ; MAGRY(8) = 1|0  1 = Production account    0 = Test Account (or couldn't determine) ;Patch 41
"RTN","MAGGTU3",47,0)
 ; MAGRY(9) = Vista Site Service PHYSICAL REFERENCE from Network Location File.
"RTN","MAGGTU3",48,0)
 ; 
"RTN","MAGGTU3",49,0)
 N J,K,Y,MAGPLC,MAGWARN,MAGWARN1,VSRV,PHYREF ; DBI - SEB 9/20/2002
"RTN","MAGGTU3",50,0)
 S MAGPLC=0
"RTN","MAGGTU3",51,0)
 I $D(DUZ(2)) S MAGPLC=+$$PLACE^MAGBAPI(DUZ(2)) ; DBI - SEB 9/20/2002
"RTN","MAGGTU3",52,0)
 ;
"RTN","MAGGTU3",53,0)
 ; SET THE PARTITION VARIABLE MAGSYS   i.e.'IGK_Garrett's Desk'
"RTN","MAGGTU3",54,0)
 S MAGSYS=$G(MAGWRKID,"")
"RTN","MAGGTU3",55,0)
 I +$G(DUZ)=0 S MAGRY(0)="0^DUZ Undefined, Null or Zero" Q
"RTN","MAGGTU3",56,0)
 I 'MAGPLC D
"RTN","MAGGTU3",57,0)
 . S MAGWARN="Can't resolve Site Param, DUZ(2): "_$S($D(DUZ(2)):DUZ(2),1:"NULL")_" DUZ: "_DUZ
"RTN","MAGGTU3",58,0)
 . S MAGPLC=$$DUZ2PLC^MAGBAPIP(.MAGWARN1) ; DBI - SEB 9/20/2002
"RTN","MAGGTU3",59,0)
 . Q
"RTN","MAGGTU3",60,0)
 S MAGRY(0)="1^"
"RTN","MAGGTU3",61,0)
 ;          DUZ     FULL NAME                INITIALS
"RTN","MAGGTU3",62,0)
 S MAGRY(1)=DUZ_U_$$GET1^DIQ(200,DUZ_",",.01)_U_$$GET1^DIQ(200,DUZ_",",1)
"RTN","MAGGTU3",63,0)
 ; NOW NET STUFF
"RTN","MAGGTU3",64,0)
 I 'MAGPLC Q 
"RTN","MAGGTU3",65,0)
 ; Get info from IMAGING SITE PARAMETERS File
"RTN","MAGGTU3",66,0)
 ; get the Network UserName and PassWord.
"RTN","MAGGTU3",67,0)
 S MAGRY(2)=$P($G(^MAG(2006.1,MAGPLC,"NET")),U,1,2)
"RTN","MAGGTU3",68,0)
 ; get the default MUSE Site number.
"RTN","MAGGTU3",69,0)
 S MAGRY(3)=+$P($G(^MAG(2006.1,MAGPLC,"USERPREF")),U,2)
"RTN","MAGGTU3",70,0)
 ; default to 1 if nothing is entered in Site Parameters File
"RTN","MAGGTU3",71,0)
 I MAGRY(3)=0 S MAGRY(3)=1
"RTN","MAGGTU3",72,0)
 ; This SITEIEN^SITECODE^USER INSTITUTION IEN^INSTITUTION NAME^CONSOLIDATED
"RTN","MAGGTU3",73,0)
 ;  is  used by Display to determine location of Workstation
"RTN","MAGGTU3",74,0)
 ;  and used by Capture to determine the Write Location.
"RTN","MAGGTU3",75,0)
 S MAGRY(4)=MAGPLC_U_$$GET1^DIQ(2006.1,MAGPLC,.09)_U_$G(DUZ(2))_U_$$GET1^DIQ(2006.1,MAGPLC,.01,"E")
"RTN","MAGGTU3",76,0)
 S MAGRY(4)=MAGRY(4)_U_$$CONSOLID^MAGBAPI_U_$$GET1^DIQ(4,DUZ(2),99,"E")
"RTN","MAGGTU3",77,0)
 ; is CP installed at this site, the Front End will hide options
"RTN","MAGGTU3",78,0)
 ;  related to CP if not installed.
"RTN","MAGGTU3",79,0)
 S X=$$VERSION^XPDUTL("CLINICAL PROCEDURES")
"RTN","MAGGTU3",80,0)
 S MAGRY(5)=+X_U_X
"RTN","MAGGTU3",81,0)
 S MAGRY(6)=$G(MAGWARN)
"RTN","MAGGTU3",82,0)
 S MAGRY(7)=$G(MAGWARN1)
"RTN","MAGGTU3",83,0)
 S MAGRY(8)=$S($L($T(PROD^XUPROD)):+$$PROD^XUPROD,1:0)
"RTN","MAGGTU3",84,0)
 S VSRV=$P($G(^MAG(2006.1,MAGPLC,"NET")),"^",5)
"RTN","MAGGTU3",85,0)
 I VSRV I +$P($G(^MAG(2005.2,VSRV,0)),"^",6) S PHYREF=$P($G(^MAG(2005.2,VSRV,0)),"^",2)
"RTN","MAGGTU3",86,0)
 S MAGRY(9)=$G(PHYREF)
"RTN","MAGGTU3",87,0)
 Q
"RTN","MAGGTU3",88,0)
 ;
"RTN","MAGGTU3",89,0)
CATEGORY(MAGRY) ; RPC [MAGGDESCCAT] Call to return Mag Descriptive Categories in array
"RTN","MAGGTU3",90,0)
 ; for listing in a list box.
"RTN","MAGGTU3",91,0)
 N I,K,CT,Y
"RTN","MAGGTU3",92,0)
 S I=0,CT=0
"RTN","MAGGTU3",93,0)
 I '$D(^MAG(2005.81)) D  Q
"RTN","MAGGTU3",94,0)
 . S MAGRY(0)="0^ERROR Mag Descriptive Category File doesn't exist"
"RTN","MAGGTU3",95,0)
 F  S I=$O(^MAG(2005.81,"B",I)) Q:I=""  D
"RTN","MAGGTU3",96,0)
 . ;S K=$O(^MAG(2005.81,"B",I,"")),CT=CT+1,MAGRY(CT)=I_U_K
"RTN","MAGGTU3",97,0)
 . ;Next line adds ADMIN, CLIN 3rd piece of the data returned
"RTN","MAGGTU3",98,0)
 . S K=$O(^MAG(2005.81,"B",I,"")),CT=CT+1
"RTN","MAGGTU3",99,0)
 . S MAGRY(CT)=I_U_K_U_$P(^MAG(2005.81,K,0),U,2)
"RTN","MAGGTU3",100,0)
 S MAGRY(0)=CT_"^Categories on file"
"RTN","MAGGTU3",101,0)
 Q
"RTN","MAGGTU3",102,0)
USERKEYS(MAGK) ; RPC [MAGGUSERKEYS]
"RTN","MAGGTU3",103,0)
 ; Call to return an array of IMAGING Security Keys
"RTN","MAGGTU3",104,0)
 ; to use on the workstation to limit capture ability
"RTN","MAGGTU3",105,0)
 ; and to limit functionality on Display application.
"RTN","MAGGTU3",106,0)
 ;
"RTN","MAGGTU3",107,0)
 N Y
"RTN","MAGGTU3",108,0)
 N MAGKS ; list of keys to send to XUS KEY CHECK
"RTN","MAGGTU3",109,0)
 N MAGKG ; list returned from XUS KEY CHECK
"RTN","MAGGTU3",110,0)
 N I,J,MAGMED,MAGKEY,MAGPLC
"RTN","MAGGTU3",111,0)
 K MAGK
"RTN","MAGGTU3",112,0)
 S MAGPLC=+$$PLACE^MAGBAPI(DUZ(2)) ; DBI - SEB 9/20/2002
"RTN","MAGGTU3",113,0)
 S MAGKEY=+$P($G(^MAG(2006.1,MAGPLC,"KEYS")),U)
"RTN","MAGGTU3",114,0)
 I 'MAGKEY S MAGK(0)="CAPTURE KEYS OFF"
"RTN","MAGGTU3",115,0)
 E  S MAGK(0)="CAPTURE KEYS ON"
"RTN","MAGGTU3",116,0)
 N X S X="MAG",I=0
"RTN","MAGGTU3",117,0)
 F  S X=$O(^XUSEC(X)) Q:$E(X,1,3)'="MAG"  D
"RTN","MAGGTU3",118,0)
 . S I=I+1,MAGKS(I)=X
"RTN","MAGGTU3",119,0)
 D OWNSKEY^XUSRB(.MAGKG,.MAGKS)
"RTN","MAGGTU3",120,0)
 S I=0,J=0,MAGMED=0
"RTN","MAGGTU3",121,0)
 F  S I=$O(MAGKG(I)) Q:I=""  D
"RTN","MAGGTU3",122,0)
 . Q:MAGKG(I)=0
"RTN","MAGGTU3",123,0)
 . S J=J+1,MAGK(J)=MAGKS(I)
"RTN","MAGGTU3",124,0)
 . I MAGKS(I)["MAGCAP MED" S MAGMED=1
"RTN","MAGGTU3",125,0)
 I MAGMED S J=J+1,MAGK(J)="MAGCAP MED"
"RTN","MAGGTU3",126,0)
 Q
"RTN","MAGGTU3",127,0)
MAIL(MAGRY,MAGFILE,MAGIEN) ;RPC [MAGG OFFLINE IMAGE ACCESSED]
"RTN","MAGGTU3",128,0)
 ;   called when a user tries to access an image that in offline as
"RTN","MAGGTU3",129,0)
 ;   determined by Stuarts file
"RTN","MAGGTU3",130,0)
 ;       ^MAGQUEUE(2006.033,0) = OFFLINE IMAGES
"RTN","MAGGTU3",131,0)
 ;   User must edit the MAGQUEUE file by hand to say if images are
"RTN","MAGGTU3",132,0)
 ;   OFFLINE.
"RTN","MAGGTU3",133,0)
 ;
"RTN","MAGGTU3",134,0)
 N FILEREF,PLATTER,A
"RTN","MAGGTU3",135,0)
 S MAGRY="0^Error : logging access to Off-Line Image"
"RTN","MAGGTU3",136,0)
 N $ETRAP,$ESTACK S $ETRAP="D ERR^MAGGTERR"
"RTN","MAGGTU3",137,0)
 S FILEREF=$$UP^XLFSTR($P(MAGFILE,"\",$L(MAGFILE,"\")))
"RTN","MAGGTU3",138,0)
 S PLATTER=$O(^MAGQUEUE(2006.033,"B",FILEREF,""))
"RTN","MAGGTU3",139,0)
 S PLATTER=$P(^MAGQUEUE(2006.033,PLATTER,0),U,2)
"RTN","MAGGTU3",140,0)
 I MAGFILE[".ABS" Q
"RTN","MAGGTU3",141,0)
 N XMDUZ,XMSUB,XMTEXT,XMY
"RTN","MAGGTU3",142,0)
 S XMDUZ=$S($D(DUZ):DUZ,1:.5)
"RTN","MAGGTU3",143,0)
 S XMSUB="Offline Image Request"
"RTN","MAGGTU3",144,0)
 S XMTEXT="A("
"RTN","MAGGTU3",145,0)
 S A(1)="Patient   : "_$P(^DPT($P($G(^MAG(2005,+MAGIEN,0)),U,7),0),U,1)
"RTN","MAGGTU3",146,0)
 S A(2)="FileName  : "_MAGFILE_"  "_MAGIEN
"RTN","MAGGTU3",147,0)
 S A(3)="Desc      : "_$P($G(^MAG(2005,MAGIEN,2)),U,4)
"RTN","MAGGTU3",148,0)
 S A(4)="Procedure : "_$P($G(^MAG(2005,MAGIEN,0)),U,8)
"RTN","MAGGTU3",149,0)
 S A(5)="Platter   : "_PLATTER
"RTN","MAGGTU3",150,0)
 S A(6)="User      : "_$$GET1^DIQ(200,DUZ_",",.01)_"("_$G(DUZ)_")"
"RTN","MAGGTU3",151,0)
 S XMY("G.OFFLINE IMAGE TRACKERS")="" D ^XMD
"RTN","MAGGTU3",152,0)
 S MAGRY="1^Message sent :  Offline Image Accessed"
"RTN","MAGGTU3",153,0)
 Q
"RTN","MAGGTU3",154,0)
LOGERROR(MAGRY,TEXT) ;RPC [MAGG LOG ERROR TEXT]
"RTN","MAGGTU3",155,0)
 ; Call to stuff error information from Delphi app into the Session file.
"RTN","MAGGTU3",156,0)
 Q:($P($G(MAGJOB("VERSION")),".",1,2))<"3.0"
"RTN","MAGGTU3",157,0)
 D LOGERR^MAGGTERR("---- New Error ----")
"RTN","MAGGTU3",158,0)
 S I="" F  S I=$O(TEXT(I)) Q:I=""  D LOGERR^MAGGTERR(TEXT(I))
"RTN","MAGGTU3",159,0)
 S MAGRY="1^Error text saved to Session file"
"RTN","MAGGTU3",160,0)
 Q
"RTN","MAGGTU3",161,0)
RSLVABS(MAGIEN,FILENAME) ;Resolve Abstract into the Default Bitmap 
"RTN","MAGGTU3",162,0)
 ; Return the default bitmap, If the image file extension resolves into a default bitmap
"RTN","MAGGTU3",163,0)
 ; MAGIEN        : Image internal entry number
"RTN","MAGGTU3",164,0)
 ; FILENAME      : ""  or Relative Path and Default Bitmap. ie ('.\BMP\magavi.bmp')
"RTN","MAGGTU3",165,0)
 N FTIEN,EXT ; 
"RTN","MAGGTU3",166,0)
 S FILENAME=""
"RTN","MAGGTU3",167,0)
 I '$D(^MAG(2005.021)) Q  ; IMAGE FILE TYPES doesn't exist on this system.
"RTN","MAGGTU3",168,0)
 S EXT=$P($P(^MAG(2005,MAGIEN,0),"^",2),".",2) ; image file extension   JPG, TGA, etc.
"RTN","MAGGTU3",169,0)
 Q:EXT=""  ;
"RTN","MAGGTU3",170,0)
 S FTIEN=$O(^MAG(2005.021,"B",EXT,""))
"RTN","MAGGTU3",171,0)
 Q:'FTIEN  ; No extension in IMAGE FILE TYPES file.
"RTN","MAGGTU3",172,0)
 ; gek P8, get rid of dependency on "c:\program files"
"RTN","MAGGTU3",173,0)
 I '+$P(^MAG(2005.021,FTIEN,0),"^",5) S FILENAME=".\BMP\"_$P(^MAG(2005.021,FTIEN,0),"^",4)
"RTN","MAGGTU3",174,0)
 Q
"RTN","MAGGTU3",175,0)
GETINFO(MAGRY,IEN) ; RPC [MAG4 GET IMAGE INFO]
"RTN","MAGGTU3",176,0)
 ; Call (3.0p8) to get information on 1 image
"RTN","MAGGTU3",177,0)
 N Y,J,JI,I,CT,IENC,FLAGS,SNGRP,Z,M40,T
"RTN","MAGGTU3",178,0)
 S I=0,CT=0
"RTN","MAGGTU3",179,0)
 S MAGRY(CT)="Image ID#:      "_IEN
"RTN","MAGGTU3",180,0)
 I $D(^MAG(2005.1,IEN)) D  Q
"RTN","MAGGTU3",181,0)
 . S CT=CT+1,MAGRY(CT)="    STATUS:  "_"HAS BEEN DELETED. !!"
"RTN","MAGGTU3",182,0)
 . S CT=CT+1,MAGRY(CT)="Deleted By: "_$$GET1^DIQ(2005.1,IEN,30,"E")
"RTN","MAGGTU3",183,0)
 . S CT=CT+1,MAGRY(CT)="    Reason: "_$$GET1^DIQ(2005.1,IEN,30.2,"E")
"RTN","MAGGTU3",184,0)
 . S CT=CT+1,MAGRY(CT)="      Date: "_$$GET1^DIQ(2005.1,IEN,30.1,"E")
"RTN","MAGGTU3",185,0)
 . Q
"RTN","MAGGTU3",186,0)
 S M40=$G(^MAG(2005,IEN,40)),T=$P(M40,"^",3)
"RTN","MAGGTU3",187,0)
 S Z=$P($G(^MAG(2005,IEN,0)),"^",10) I Z D
"RTN","MAGGTU3",188,0)
 . S CT=CT+1,MAGRY(CT)=" is in Group#: "_Z_"  ("_+$P(^MAG(2005,Z,1,0),"^",4)_" images)"
"RTN","MAGGTU3",189,0)
 . Q
"RTN","MAGGTU3",190,0)
 S SNGRP="FLDS"
"RTN","MAGGTU3",191,0)
 I (+$O(^MAG(2005,IEN,1,0)))!($P(^MAG(2005,IEN,0),"^",6)=11)!($P(^MAG(2005,IEN,0),"^",6)=16) D
"RTN","MAGGTU3",192,0)
 . S CT=CT+1,MAGRY(CT)=$P(^MAG(2005,IEN,0),"^",8)_" Group of "_+$P($G(^MAG(2005,IEN,1,0)),U,4)
"RTN","MAGGTU3",193,0)
 . S SNGRP="FLDG"
"RTN","MAGGTU3",194,0)
 . Q
"RTN","MAGGTU3",195,0)
 N MAGOUT,MAGERR,MAGVAL
"RTN","MAGGTU3",196,0)
 S IENC=IEN_","
"RTN","MAGGTU3",197,0)
 S FLAGS="EN"
"RTN","MAGGTU3",198,0)
 S I=-1
"RTN","MAGGTU3",199,0)
 F  S I=I+1,Z=$T(@SNGRP+I) Q:$P(Z,";",3)="end"  D
"RTN","MAGGTU3",200,0)
 . S J=$P(Z,";",4),JI=J_";"
"RTN","MAGGTU3",201,0)
 . K MAGOUT
"RTN","MAGGTU3",202,0)
 . S CT=CT+1,MAGRY(CT)=$P(Z,";",3)
"RTN","MAGGTU3",203,0)
 . I J=41 D  Q  ; Need to compute the Class.  Class field in Image File is wrong.
"RTN","MAGGTU3",204,0)
 . . S MAGVAL=$S('T:"",'$D(^MAG(2005.83,T,0)):"",1:$P(^MAG(2005.82,$P(^MAG(2005.83,T,0),"^",2),0),"^",1))
"RTN","MAGGTU3",205,0)
 . . S MAGRY(CT)=MAGRY(CT)_" "_MAGVAL
"RTN","MAGGTU3",206,0)
 . . Q
"RTN","MAGGTU3",207,0)
 . D GETS^DIQ(2005,IEN,JI,FLAGS,"MAGOUT","MAGERR")
"RTN","MAGGTU3",208,0)
 . ; Get Extension from FileRef
"RTN","MAGGTU3",209,0)
 . I J=1 S MAGVAL=$P($G(MAGOUT(2005,IENC,J,"E")),".",2)
"RTN","MAGGTU3",210,0)
 . E  S MAGVAL=$G(MAGOUT(2005,IENC,J,"E"))
"RTN","MAGGTU3",211,0)
 . S MAGRY(CT)=MAGRY(CT)_" "_MAGVAL
"RTN","MAGGTU3",212,0)
 Q
"RTN","MAGGTU3",213,0)
FLDS ;;Format:       ;3;;
"RTN","MAGGTU3",214,0)
 ;;Extension:    ;1;;
"RTN","MAGGTU3",215,0)
FLDG ;;Patient:      ;5;;
"RTN","MAGGTU3",216,0)
 ;;Desc:         ;10;;
"RTN","MAGGTU3",217,0)
 ;;Procedure:    ;6;;
"RTN","MAGGTU3",218,0)
 ;;     Date:    ;15;;
"RTN","MAGGTU3",219,0)
 ;;Class:        ;41;;
"RTN","MAGGTU3",220,0)
 ;;Package:      ;40;;
"RTN","MAGGTU3",221,0)
 ;;Type:         ;42;;
"RTN","MAGGTU3",222,0)
 ;;Proc/Event:   ;43;;
"RTN","MAGGTU3",223,0)
 ;;Spec/SubSpec: ;44;;
"RTN","MAGGTU3",224,0)
 ;;Origin:       ;45;;
"RTN","MAGGTU3",225,0)
 ;;Captured on:  ;7;;
"RTN","MAGGTU3",226,0)
 ;;         by:  ;8;;
"RTN","MAGGTU3",227,0)
 ;;end;;
"RTN","MAGGTU6")
0^20^B64345537
"RTN","MAGGTU6",1,0)
MAGGTU6 ;WOIFO/GEK - Silent Utilities ; [ 06/20/2001 08:57 ]
"RTN","MAGGTU6",2,0)
 ;;3.0;IMAGING;**24,8,48,45,20**;Apr 12, 2006
"RTN","MAGGTU6",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGTU6",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGGTU6",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGGTU6",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGGTU6",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGGTU6",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGGTU6",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGGTU6",10,0)
 ;; |                                                               |
"RTN","MAGGTU6",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGGTU6",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGGTU6",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGGTU6",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGGTU6",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGGTU6",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGTU6",17,0)
 ;;
"RTN","MAGGTU6",18,0)
 Q
"RTN","MAGGTU6",19,0)
 ;
"RTN","MAGGTU6",20,0)
LOGACT(MAGRY,ZY) ;RPC [MAGGACTION LOG]
"RTN","MAGGTU6",21,0)
 ; Call to LogAction from Delphi Window 
"RTN","MAGGTU6",22,0)
 ;
"RTN","MAGGTU6",23,0)
 ; ZY is input variable it is '^' delimited string
"RTN","MAGGTU6",24,0)
 ; 'A|B|C|D|E' ^^ MAGIEN ^ 'Copy/Download' ^ DFN ^ '1';
"RTN","MAGGTU6",25,0)
 ;  DUZ is inserted as 2nd piece below.
"RTN","MAGGTU6",26,0)
 ; I.E. zy  = "C^^103660^Copy To Clipboard^1033^1"
"RTN","MAGGTU6",27,0)
 N Y
"RTN","MAGGTU6",28,0)
 S MAGRY="0^Logging access..."
"RTN","MAGGTU6",29,0)
 ;
"RTN","MAGGTU6",30,0)
 N $ETRAP,$ESTACK S $ETRAP="D ERR^MAGGTERR"
"RTN","MAGGTU6",31,0)
 ;                 C       DUZ      MAGIEN     ACTION       DFN       1
"RTN","MAGGTU6",32,0)
 D ENTRY^MAGLOG($P(ZY,U),+$G(DUZ),$P(ZY,U,3),$P(ZY,U,4),$P(ZY,U,5),$P(ZY,U,6))
"RTN","MAGGTU6",33,0)
 S MAGRY="1^Action was Logged."
"RTN","MAGGTU6",34,0)
 Q
"RTN","MAGGTU6",35,0)
TIMEOUT(MAGRY,APP) ;RPC [MAGG GET TIMEOUT]
"RTN","MAGGTU6",36,0)
 ; Call  Returns the timeout for the APP from IMAGING SITE PARAMETERS File
"RTN","MAGGTU6",37,0)
 ;  APP is either 'DISPLAY'  'CAPTURE' or   'VISTARAD'
"RTN","MAGGTU6",38,0)
 N I,MAGTIMES,MAGPLC
"RTN","MAGGTU6",39,0)
 S MAGRY=""
"RTN","MAGGTU6",40,0)
 S MAGPLC=$$PLACE^MAGBAPI(DUZ(2)) I 'MAGPLC Q  ; DBI - SEB 9/20/2002
"RTN","MAGGTU6",41,0)
 S MAGTIMES=$G(^MAG(2006.1,MAGPLC,"KEYS"))
"RTN","MAGGTU6",42,0)
 I APP="DISPLAY" S MAGRY=$P(MAGTIMES,U,2)
"RTN","MAGGTU6",43,0)
 I APP="CAPTURE" S MAGRY=$P(MAGTIMES,U,3)
"RTN","MAGGTU6",44,0)
 I APP="VISTARAD" S MAGRY=$P(MAGTIMES,U,4)
"RTN","MAGGTU6",45,0)
 Q
"RTN","MAGGTU6",46,0)
EXIST(EKGPLACE) ;Does an ekg server exist in 2005.2
"RTN","MAGGTU6",47,0)
 I $$CONSOLID^MAGBAPI()=0 Q $O(^MAG(2005.2,"E","EKG","")) ; DBI - SEB 9/20/2002
"RTN","MAGGTU6",48,0)
 Q $O(^MAG(2005.2,"F",EKGPLACE,"EKG",""))
"RTN","MAGGTU6",49,0)
 ;
"RTN","MAGGTU6",50,0)
ONLINE(MAGR) ;RPC [MAG EKG ONLINE] EKG network location status    
"RTN","MAGGTU6",51,0)
 ;returns the status of the first EKG network location type
"RTN","MAGGTU6",52,0)
 ;O if offline or a network location doesn't exist
"RTN","MAGGTU6",53,0)
 ;1 if online
"RTN","MAGGTU6",54,0)
 ;
"RTN","MAGGTU6",55,0)
 N EKG1,EKGPLACE
"RTN","MAGGTU6",56,0)
 S EKGPLACE=$$PLACE^MAGBAPI(DUZ(2)) ; DBI - SEB 9/20/2002
"RTN","MAGGTU6",57,0)
 I EKGPLACE=0 S EKGPLACE=$$PLACE^MAGBAPI(DUZ(2)) ;Convert to extrinsic /gek 8/2003
"RTN","MAGGTU6",58,0)
 I $$EXIST(EKGPLACE) D
"RTN","MAGGTU6",59,0)
 . I $$CONSOLID^MAGBAPI() S EKG1=$O(^MAG(2005.2,"F",EKGPLACE,"EKG","")) ; DBI - SEB 9/20/2002
"RTN","MAGGTU6",60,0)
 . E  S EKG1=$O(^MAG(2005.2,"E","EKG",""))
"RTN","MAGGTU6",61,0)
 . S MAGR=$P(^MAG(2005.2,EKG1,0),U,6)
"RTN","MAGGTU6",62,0)
 E  S MAGR=0
"RTN","MAGGTU6",63,0)
 Q
"RTN","MAGGTU6",64,0)
SHARE(MAGRY,TYPE) ;RPC [MAG GET NETLOC]
"RTN","MAGGTU6",65,0)
 ; Get list of image shares
"RTN","MAGGTU6",66,0)
 ;TYPE = One of the STORAGE TYPE codes : MAG, EKG, WORM, URL or ALL
"RTN","MAGGTU6",67,0)
 N TMP,I,DATA0,DATA2,DATA3,DATA6,INFO,VALUE,STYP,PHYREF
"RTN","MAGGTU6",68,0)
 N $ETRAP,$ESTACK S $ETRAP="D ERRA^MAGGTERR"
"RTN","MAGGTU6",69,0)
 S I=0
"RTN","MAGGTU6",70,0)
 I TYPE="" S TYPE="ALL"
"RTN","MAGGTU6",71,0)
 S MAGRY(0)="1^SUCCESS"
"RTN","MAGGTU6",72,0)
 F  S I=$O(^MAG(2005.2,I)) Q:'I  D
"RTN","MAGGTU6",73,0)
 . Q:$$LOCDRIVE(I)
"RTN","MAGGTU6",74,0)
 . S DATA0=$G(^MAG(2005.2,I,0))
"RTN","MAGGTU6",75,0)
 . S DATA2=$G(^MAG(2005.2,I,2))
"RTN","MAGGTU6",76,0)
 . S DATA3=$G(^MAG(2005.2,I,3))
"RTN","MAGGTU6",77,0)
 . S DATA6=$G(^MAG(2005.2,I,6))
"RTN","MAGGTU6",78,0)
 . ; 
"RTN","MAGGTU6",79,0)
 . S PHYREF=$P(DATA0,"^",2) ; PHYSICAL REFERENCE
"RTN","MAGGTU6",80,0)
 . S STYP=$P(DATA0,"^",7) ; STORAGE TYPE
"RTN","MAGGTU6",81,0)
 . ;
"RTN","MAGGTU6",82,0)
 . I TYPE'="ALL" Q:STYP'[TYPE
"RTN","MAGGTU6",83,0)
 . Q:$P(DATA0,"^",6)=0     ;SHARE IS OFFLINE (don't return offline shares)
"RTN","MAGGTU6",84,0)
 . I STYP'="URL" Q:(PHYREF[".")  ; pre 45, quit if '.' in phyref
"RTN","MAGGTU6",85,0)
 . I STYP'="URL" Q:($E(PHYREF,1,2)'="\\")  ; pre 45 quit if doesn't start with '\\'
"RTN","MAGGTU6",86,0)
 . ;
"RTN","MAGGTU6",87,0)
 . S INFO=$S($E(PHYREF,$L(PHYREF))="\":$E(PHYREF,1,$L(PHYREF)-1),1:PHYREF)
"RTN","MAGGTU6",88,0)
 . S $P(INFO,"^",2)=$P($G(DATA0),"^",7) ;Physical reference (path)
"RTN","MAGGTU6",89,0)
 . S $P(INFO,"^",3)=$P($G(DATA0),"^",6)  ;Operational Status 0=OFFLINE 1=ONLINE
"RTN","MAGGTU6",90,0)
 . S $P(INFO,"^",4)=$P($G(DATA2),"^",1) ;Username
"RTN","MAGGTU6",91,0)
 . S $P(INFO,"^",5)=$P($G(DATA2),"^",2) ;Password
"RTN","MAGGTU6",92,0)
 . S $P(INFO,"^",6)=$P($G(DATA6),"^",1)  ;MUSE Site #
"RTN","MAGGTU6",93,0)
 . I $P($G(DATA6),"^",2)'="" S $P(INFO,"^",7)=^MAG(2006.17,$P(DATA6,"^",2),0)  ;MUSE version #
"RTN","MAGGTU6",94,0)
 . S $P(INFO,"^",8)=$P($G(DATA3),"^",5)  ;Network location SITE
"RTN","MAGGTU6",95,0)
 . Q:$D(TMP(INFO))
"RTN","MAGGTU6",96,0)
 . S TMP(INFO)=I
"RTN","MAGGTU6",97,0)
 S INFO=""
"RTN","MAGGTU6",98,0)
 F  S INFO=$O(TMP(INFO)) Q:INFO=""  D
"RTN","MAGGTU6",99,0)
 . S MAGRY($O(MAGRY(""),-1)+1)=TMP(INFO)_"^"_INFO
"RTN","MAGGTU6",100,0)
 K TMP
"RTN","MAGGTU6",101,0)
 Q
"RTN","MAGGTU6",102,0)
LOCDRIVE(I) ; Returns 1 if this is a local drive, else 0
"RTN","MAGGTU6",103,0)
 ; Local Drive is determined by the DIR not being Type : URL and having a ":"
"RTN","MAGGTU6",104,0)
 I $P(^MAG(2005.2,I,0),"^",7)'="URL" I $P(^MAG(2005.2,I,0),"^",2)[":" Q 1
"RTN","MAGGTU6",105,0)
 Q 0
"RTN","MAGGTU6",106,0)
GETENV(MAGRY) ;RPC [MAG GET ENV]
"RTN","MAGGTU6",107,0)
 ; Get some environment variables (used by annotation control)
"RTN","MAGGTU6",108,0)
 S MAGRY=DUZ(2)_"^"_$$NOW^XLFDT
"RTN","MAGGTU6",109,0)
 Q
"RTN","MAGGTU6",110,0)
ANNCB(STATARR) ;Status Callback (called by the import API)
"RTN","MAGGTU6",111,0)
 ;
"RTN","MAGGTU6",112,0)
 N I,CDUZ,QINDEX,A,COUNT
"RTN","MAGGTU6",113,0)
 N XMDUZ,XMSUB,XMTEXT,XMY
"RTN","MAGGTU6",114,0)
 ;  0 = error, all others are success.
"RTN","MAGGTU6",115,0)
 I $P(STATARR(0),"^",1)'=0 D
"RTN","MAGGTU6",116,0)
 . ;   Import was successful
"RTN","MAGGTU6",117,0)
 E  D
"RTN","MAGGTU6",118,0)
 . ;   Import failed - send mail to MAG SERVER group and person who queued the import
"RTN","MAGGTU6",119,0)
 . S XMDUZ=DUZ
"RTN","MAGGTU6",120,0)
 . S XMSUB="Import Error Report"
"RTN","MAGGTU6",121,0)
 . ;    get text of message from status array
"RTN","MAGGTU6",122,0)
 . S XMTEXT="A("
"RTN","MAGGTU6",123,0)
 . ; XMD needs array to start with 1, not 0
"RTN","MAGGTU6",124,0)
 . S COUNT=1,I=""
"RTN","MAGGTU6",125,0)
 . F  S I=$O(STATARR(I)) Q:I=""  D
"RTN","MAGGTU6",126,0)
 . . S A(COUNT)=I_") "_STATARR(I)
"RTN","MAGGTU6",127,0)
 . . S COUNT=COUNT+1
"RTN","MAGGTU6",128,0)
 . . Q
"RTN","MAGGTU6",129,0)
 . S A(COUNT+1)=" "
"RTN","MAGGTU6",130,0)
 . S A(COUNT+2)=" "
"RTN","MAGGTU6",131,0)
 . S A(COUNT+3)="     The errors listed above were generated by"
"RTN","MAGGTU6",132,0)
 . S A(COUNT+4)="     the VistA Imaging Annotation Editor while"
"RTN","MAGGTU6",133,0)
 . S A(COUNT+5)="     trying to import your diagram.  Please"
"RTN","MAGGTU6",134,0)
 . S A(COUNT+6)="     report these errors to your VistA Imaging"
"RTN","MAGGTU6",135,0)
 . S A(COUNT+7)="     support personnel."
"RTN","MAGGTU6",136,0)
 . ;Get person who did the import
"RTN","MAGGTU6",137,0)
 . S QINDEX=STATARR(2)
"RTN","MAGGTU6",138,0)
 . S I=-1 F  S I=$O(^MAG(2006.034,QINDEX,1,I)) Q:I=""  D
"RTN","MAGGTU6",139,0)
 . . I $P($G(^MAG(2006.034,QINDEX,1,I,0)),"^",1)=8 S CDUZ=$P(^MAG(2006.034,QINDEX,1,I,0),"^",2)
"RTN","MAGGTU6",140,0)
 . ;Set recipients of message
"RTN","MAGGTU6",141,0)
 . S XMY("G.MAG SERVER")=""
"RTN","MAGGTU6",142,0)
 . I $G(CDUZ) S XMY(CDUZ)=""
"RTN","MAGGTU6",143,0)
 . D ^XMD
"RTN","MAGGTU6",144,0)
 . Q
"RTN","MAGGTU6",145,0)
 Q
"RTN","MAGGTU6",146,0)
GETCTP(MAGRY) ;RPC [MAG4 CT PRESETS GET]
"RTN","MAGGTU6",147,0)
 N MAGPLC
"RTN","MAGGTU6",148,0)
 S MAGPLC=$$PLACE^MAGBAPI(DUZ(2))
"RTN","MAGGTU6",149,0)
 I 'MAGPLC S MAGRY="0^Error resolving Users Division" Q
"RTN","MAGGTU6",150,0)
 S MAGRY=$G(^MAG(2006.1,MAGPLC,"CT"))
"RTN","MAGGTU6",151,0)
 I MAGRY="" S MAGRY="0^Site doesn't have CT Presets defined." Q
"RTN","MAGGTU6",152,0)
 S MAGRY="1^"_MAGRY
"RTN","MAGGTU6",153,0)
 Q
"RTN","MAGGTU6",154,0)
SAVECTP(MAGRY,VALUE) ;RPC [MAG4 CT PRESETS SAVE]
"RTN","MAGGTU6",155,0)
 N MAGPLC
"RTN","MAGGTU6",156,0)
 S MAGPLC=$$PLACE^MAGBAPI(DUZ(2))
"RTN","MAGGTU6",157,0)
 I 'MAGPLC S MAGRY="0^Error resolving Users Division" Q
"RTN","MAGGTU6",158,0)
 S ^MAG(2006.1,MAGPLC,"CT")=VALUE
"RTN","MAGGTU6",159,0)
 S MAGRY="1^CT Presets saved."
"RTN","MAGGTU6",160,0)
 Q
"RTN","MAGGTU6",161,0)
NETPLCS ; Create an array of Place, SiteCodes for all entries of
"RTN","MAGGTU6",162,0)
 ; Network Location entries.  
"RTN","MAGGTU6",163,0)
 N I,PLC,PLCODE,CONS
"RTN","MAGGTU6",164,0)
 S CONS=$$CONSOLID^MAGBAPI
"RTN","MAGGTU6",165,0)
 I 'CONS S PLC=$O(^MAG(2006.1,0)),PLCODE=$P(^MAG(2006.1,PLC,0),"^",9)
"RTN","MAGGTU6",166,0)
 ; 
"RTN","MAGGTU6",167,0)
 K MAGJOB("NETPLC")
"RTN","MAGGTU6",168,0)
 S I=0 F  S I=$O(^MAG(2005.2,I)) Q:'I  D
"RTN","MAGGTU6",169,0)
 . I 'CONS S MAGJOB("NETPLC",I)=PLC_"^"_PLCODE Q
"RTN","MAGGTU6",170,0)
 . ; Here, for consolidated sites we get the real Site IEN, and Site Code.
"RTN","MAGGTU6",171,0)
 . I CONS S PLC=$P($G(^MAG(2005.2,I,0)),"^",10),PLCODE=$S(PLC:$P($G(^MAG(2006.1,PLC,0)),"^",9),1:"n/a")
"RTN","MAGGTU6",172,0)
 . S MAGJOB("NETPLC",I)=PLC_"^"_PLCODE
"RTN","MAGGTU6",173,0)
 . Q
"RTN","MAGGTU6",174,0)
 Q
"RTN","MAGGTU6",175,0)
ABSJB(MAGRY,MAGIN) ;RPC [MAG ABSJB] SET ABSTRACT AND/OR JUKEBOX QUEUES
"RTN","MAGGTU6",176,0)
 ;       MAGIN
"RTN","MAGGTU6",177,0)
 ;   DESCRIPTION:  '^' delimited String:
"RTN","MAGGTU6",178,0)
 ;   Piece 1 = the IEN of the image that needs an abstract created.
"RTN","MAGGTU6",179,0)
 ;   Piece 2 = the IEN of the image that needs copied to the jukebox
"RTN","MAGGTU6",180,0)
 ;
"RTN","MAGGTU6",181,0)
 ;       MAGRY = "1^Successful"
"RTN","MAGGTU6",182,0)
 ;             = "0^error message"
"RTN","MAGGTU6",183,0)
 ;             
"RTN","MAGGTU6",184,0)
 N MAGIENAB,MAGIENJB,MAGERR,X
"RTN","MAGGTU6",185,0)
 S MAGERR=0
"RTN","MAGGTU6",186,0)
 N $ETRAP,$ESTACK S $ETRAP="D ERR^"_$T(+0)
"RTN","MAGGTU6",187,0)
 S MAGRY="0^ERROR: Setting Queue for Abstract or JukeBox copy"
"RTN","MAGGTU6",188,0)
 S MAGIENAB=+$P(MAGIN,"^",1),MAGIENJB=+$P(MAGIN,"^",2)
"RTN","MAGGTU6",189,0)
 Q:((+$P(^MAG(2005,MAGIENAB,0),U,11))!(+$P(^MAG(2005,MAGIENAB,0),U,12))) "0^Image integrity"
"RTN","MAGGTU6",190,0)
 Q:((+$P(^MAG(2005,MAGIENJB,0),U,11))!(+$P(^MAG(2005,MAGIENJB,0),U,12))) "0^Image integrity"
"RTN","MAGGTU6",191,0)
 L +(^MAGQUEUE(2006.03,0),^MAGQUEUE(2006.031)):10 E  D QERR Q
"RTN","MAGGTU6",192,0)
 I +MAGIENAB>0 S X=$$ABSTRACT^MAGBAPI(MAGIENAB,$$DA2PLC^MAGBAPIP(MAGIENAB,"F"))
"RTN","MAGGTU6",193,0)
 I MAGIENJB'="" S X=$$JUKEBOX^MAGBAPI(MAGIENJB,$$DA2PLC^MAGBAPIP(MAGIENJB,"F"))
"RTN","MAGGTU6",194,0)
 L -(^MAGQUEUE(2006.03,0),^MAGQUEUE(2006.031))
"RTN","MAGGTU6",195,0)
 S MAGRY="1^SUCCESSFUL"
"RTN","MAGGTU6",196,0)
 Q
"RTN","MAGGTU6",197,0)
ERR ;
"RTN","MAGGTU6",198,0)
 L -(^MAGQUEUE(2006.03,0),^MAGQUEUE(2006.031))
"RTN","MAGGTU6",199,0)
 N ERR S ERR=$$EC^%ZOSV
"RTN","MAGGTU6",200,0)
 S MAGRY="0^Error setting JukeBox/Abstract Queue.  Not Fatal.  'Save' will continue..."
"RTN","MAGGTU6",201,0)
 D LOGERR^MAGGTERR(ERR)
"RTN","MAGGTU6",202,0)
 D @^%ZOSF("ERRTN")
"RTN","MAGGTU6",203,0)
 Q
"RTN","MAGGTU6",204,0)
QERR ;
"RTN","MAGGTU6",205,0)
 N MAGTXT
"RTN","MAGGTU6",206,0)
 S MAGTXT="Failed to set JukeBox/Abstract Queue."
"RTN","MAGGTU6",207,0)
 ;ENTRY(MAGIMT,MAGDUZ,MAGO,MAGPACK,MAGDFN,MAGCT,MAGAD)
"RTN","MAGGTU6",208,0)
 D ENTRY^MAGLOG("QFAIL",$G(DUZ),MAGIENJB,"","","",MAGTXT)
"RTN","MAGGTU6",209,0)
 D ACTION^MAGGTAU(MAGTXT,1)
"RTN","MAGGTU6",210,0)
 S MAGRY="1^"_MAGTXT_"  Message was sent to IRM.  Not Fatal.  'Save' will continue..."
"RTN","MAGGTU6",211,0)
 N XMSUB,XMY,XMTEXT,XMK,XMDUZ
"RTN","MAGGTU6",212,0)
 S XMTEXT="^TMP($J,""MAGQ"","
"RTN","MAGGTU6",213,0)
 S XMSUB=MAGTXT
"RTN","MAGGTU6",214,0)
 K ^TMP($J,"MAGQ")
"RTN","MAGGTU6",215,0)
 S ^TMP($J,"MAGQ",1)=MAGTXT
"RTN","MAGGTU6",216,0)
 S ^TMP($J,"MAGQ",2)=" for Image IEN: "_MAGIENJB
"RTN","MAGGTU6",217,0)
 S ^TMP($J,"MAGQ",3)="You need to run the Verifier for this Image IEN"
"RTN","MAGGTU6",218,0)
 S XMY("G.IMAGING DEVELOPMENT@DOMAIN.EXT")=""
"RTN","MAGGTU6",219,0)
 D ^XMD
"RTN","MAGGTU6",220,0)
 S XMDUZ=DUZ D KLQ^XMA1B
"RTN","MAGGTU6",221,0)
 K ^TMP($J,"MAGQ")
"RTN","MAGGTU6",222,0)
 Q
"RTN","MAGGTU7")
0^36^B22552210
"RTN","MAGGTU7",1,0)
MAGGTU7 ;WOIFO/GEK - Silent calls for Queing functions from GUI ; [ 06/20/2001 08:57 ]
"RTN","MAGGTU7",2,0)
 ;;3.0;IMAGING;**8,20**;Apr 12, 2006
"RTN","MAGGTU7",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGTU7",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGGTU7",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGGTU7",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGGTU7",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGGTU7",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGGTU7",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGGTU7",10,0)
 ;; |                                                               |
"RTN","MAGGTU7",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGGTU7",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGGTU7",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGGTU7",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGGTU7",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGGTU7",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGTU7",17,0)
 ;;
"RTN","MAGGTU7",18,0)
 Q
"RTN","MAGGTU7",19,0)
ONJBOX(MAGIEN,CODE) ;
"RTN","MAGGTU7",20,0)
 ;Check to see if the image ( Abs, Full, or Big ) is on the worm 
"RTN","MAGGTU7",21,0)
 ;  before queuing it to be copied to HardDrive.
"RTN","MAGGTU7",22,0)
 ; We're testing to see if a pointer to the magnetic exists.
"RTN","MAGGTU7",23,0)
 ;  If not then we assume the Image is on JukeBox
"RTN","MAGGTU7",24,0)
 N ZNODE
"RTN","MAGGTU7",25,0)
 S ZNODE=$G(^MAG(2005,+MAGIEN,0))
"RTN","MAGGTU7",26,0)
 IF '$L(ZNODE) Q 0
"RTN","MAGGTU7",27,0)
 IF $$IMOFFLN^MAGFILEB($P(ZNODE,"^",2)) Q 0
"RTN","MAGGTU7",28,0)
 Q:((+$P(ZNODE,U,11))!(+$P(ZNODE,U,12))) 0
"RTN","MAGGTU7",29,0)
 IF CODE="A" Q '$P(ZNODE,U,4)
"RTN","MAGGTU7",30,0)
 IF CODE="F" Q '$P(ZNODE,U,3)
"RTN","MAGGTU7",31,0)
 IF CODE="B" Q $S('$P(^MAG(2005,+MAGIEN,"FBIG"),U,2):0,1:'$P(^MAG(2005,+MAGIEN,"FBIG"),U,1))
"RTN","MAGGTU7",32,0)
 ;
"RTN","MAGGTU7",33,0)
 Q
"RTN","MAGGTU7",34,0)
QUEIMAGE(MAGRY,CODE,MAGIEN) ;RPC [MAGG QUE IMAGE]
"RTN","MAGGTU7",35,0)
 ; Call to Queue an image for copy from Jukebox
"RTN","MAGGTU7",36,0)
 ;  NOTE : This is also called from other M routines.
"RTN","MAGGTU7",37,0)
 ; 
"RTN","MAGGTU7",38,0)
 ; CODE is a string code for which images to Queue
"RTN","MAGGTU7",39,0)
 ;     ["A" Abatract
"RTN","MAGGTU7",40,0)
 ;     ["F" Full Resolution
"RTN","MAGGTU7",41,0)
 ;     ["B" Big File
"RTN","MAGGTU7",42,0)
 ;
"RTN","MAGGTU7",43,0)
 N Y,QUE
"RTN","MAGGTU7",44,0)
 S QUE=""
"RTN","MAGGTU7",45,0)
 S MAGRY="0^Error setting Que from JukeBox"
"RTN","MAGGTU7",46,0)
 ;S MAGRY="1^Image was Queued to copy from JukeBox"
"RTN","MAGGTU7",47,0)
 ;  GEK 6/27/03  added code (ABS4IMAG) that returns 1|0  1 if this image should have an Abstract
"RTN","MAGGTU7",48,0)
 ;     This will stop the Queing of Canned Bitmaps for Images of type DOC, PDF, WAV, AVI  etc.
"RTN","MAGGTU7",49,0)
 I (CODE["A"),$$ONJBOX(MAGIEN,"A"),$$ABS4IMAG^MAGGSFT(MAGIEN) S Y=$$JBTOHD^MAGBAPI(+MAGIEN_"^ABSTRACT",$$DA2PLC^MAGBAPIP(MAGIEN,"A")) S QUE="A" ; DBI - SEB 9/20/2002
"RTN","MAGGTU7",50,0)
 I (CODE["F"),$$ONJBOX(MAGIEN,"F") S Y=$$JBTOHD^MAGBAPI(+MAGIEN_"^FULL",$$DA2PLC^MAGBAPIP(MAGIEN,"F")) S QUE=QUE_"F" ; DBI - SEB 9/20/2002
"RTN","MAGGTU7",51,0)
 I (CODE["B"),$$ONJBOX(MAGIEN,"B") S Y=$$JBTOHD^MAGBAPI(+MAGIEN_"^BIG",$$DA2PLC^MAGBAPIP(MAGIEN,"B")) S QUE=QUE_"B" ; DBI - SEB 9/20/2002
"RTN","MAGGTU7",52,0)
 I QUE="" S MAGRY="1^Copy from JukeBox not needed, Image was NOT Queued."
"RTN","MAGGTU7",53,0)
 E  S MAGRY="1^Image was Queued to copy from JukeBox ("_QUE_")"
"RTN","MAGGTU7",54,0)
 Q
"RTN","MAGGTU7",55,0)
QPREFET(MAGRY,CODE,MAGIEN) ;
"RTN","MAGGTU7",56,0)
 ; CODE is a string code for which images to Queue
"RTN","MAGGTU7",57,0)
 ;     ["A" Abatract
"RTN","MAGGTU7",58,0)
 ;     ["F" Full Resolution
"RTN","MAGGTU7",59,0)
 ;     ["B" Big File
"RTN","MAGGTU7",60,0)
 ;
"RTN","MAGGTU7",61,0)
 N Y,QUE
"RTN","MAGGTU7",62,0)
 S QUE=""
"RTN","MAGGTU7",63,0)
 S MAGRY="0^Error setting Prefetch Que from JukeBox"
"RTN","MAGGTU7",64,0)
 ;S MAGRY="1^Image was Queued to copy from JukeBox"
"RTN","MAGGTU7",65,0)
 I (CODE["A"),$$ONJBOX(MAGIEN,"A"),$$ABS4IMAG^MAGGSFT(MAGIEN) S Y=$$PREFET^MAGBAPI(+MAGIEN_"^ABSTRACT",$$DA2PLC^MAGBAPIP(MAGIEN,"A")) S QUE="A" ; DBI - SEB 9/20/2002
"RTN","MAGGTU7",66,0)
 I (CODE["F"),$$ONJBOX(MAGIEN,"F") S Y=$$PREFET^MAGBAPI(+MAGIEN_"^FULL",$$DA2PLC^MAGBAPIP(MAGIEN,"F")) S QUE=QUE_"F" ; DBI - SEB 9/20/2002
"RTN","MAGGTU7",67,0)
 I (CODE["B"),$$ONJBOX(MAGIEN,"B") S Y=$$PREFET^MAGBAPI(+MAGIEN_"^BIG",$$DA2PLC^MAGBAPIP(MAGIEN,"B")) S QUE=QUE_"B" ; DBI - SEB 9/20/2002
"RTN","MAGGTU7",68,0)
 I QUE="" S MAGRY="1^Copy from JukeBox not needed, Image was NOT Queued."
"RTN","MAGGTU7",69,0)
 E  S MAGRY="1^Image was Queued to copy from JukeBox"
"RTN","MAGGTU7",70,0)
 Q
"RTN","MAGGTU7",71,0)
QUELIST(MAGRY,CODE,LIST) ;RPC [MAGG QUE LIST]
"RTN","MAGGTU7",72,0)
 ; Call to queue all images in the input list for a copy from jukebox
"RTN","MAGGTU7",73,0)
 ;
"RTN","MAGGTU7",74,0)
 ; CODE is a string code for which images to Queue
"RTN","MAGGTU7",75,0)
 ;     ["A" Abatract
"RTN","MAGGTU7",76,0)
 ;     ["F" Full Resolution
"RTN","MAGGTU7",77,0)
 ;     ["B" Big File
"RTN","MAGGTU7",78,0)
 ; LIST is an array of Image IEN's,  we queue images contained in CODE
"RTN","MAGGTU7",79,0)
 ;
"RTN","MAGGTU7",80,0)
 N Y,CT
"RTN","MAGGTU7",81,0)
 S CT=0
"RTN","MAGGTU7",82,0)
 S X="" F  S X=$O(LIST(X)) Q:X=""  D QUEIMAGE(.XX,CODE,X) S CT=CT+1
"RTN","MAGGTU7",83,0)
 S MAGRY=CT_"^"_CT_" Image"_$S(CT=1:"",1:"'s")_" Queued to copy from JukeBox"
"RTN","MAGGTU7",84,0)
 Q
"RTN","MAGGTU7",85,0)
QUEGROUP(MAGRY,CODE,MAGIEN,QCODE) ;RPC [MAGG QUE IMAGE GROUP]
"RTN","MAGGTU7",86,0)
 ; Call to queue all images of an Image group for a copy from JukeBox.
"RTN","MAGGTU7",87,0)
 ;  This can also be a PREFETCH, in which case the Images being 
"RTN","MAGGTU7",88,0)
 ;  Queued have a lower priority than other copies from JukeBox
"RTN","MAGGTU7",89,0)
 ;
"RTN","MAGGTU7",90,0)
 ; CODE is a string code for which images to Queue
"RTN","MAGGTU7",91,0)
 ;     ["A" Abatract
"RTN","MAGGTU7",92,0)
 ;     ["F" Full Resolution
"RTN","MAGGTU7",93,0)
 ;     ["B" Big File
"RTN","MAGGTU7",94,0)
 ; MAGIEN is assumed to be a group image.
"RTN","MAGGTU7",95,0)
 ; QCODE is a QUEUE code.  If = 1 then this is a prefetch
"RTN","MAGGTU7",96,0)
 ;   here we are queing the images contained in CODE
"RTN","MAGGTU7",97,0)
 ;   for all images in the group.
"RTN","MAGGTU7",98,0)
 N X,Y,Z,CT
"RTN","MAGGTU7",99,0)
 S QCODE=$G(QCODE)
"RTN","MAGGTU7",100,0)
 I '$D(^MAG(2005,+MAGIEN,0)) S MAGRY="0^Invalid Image IEN. Queuing Canceled." Q
"RTN","MAGGTU7",101,0)
 S CT=0,X=0
"RTN","MAGGTU7",102,0)
 F  S X=$O(^MAG(2005,+MAGIEN,1,X)) Q:'X  S Z=+^(X,0) D
"RTN","MAGGTU7",103,0)
 . I QCODE D QPREFET(.XX,CODE,Z) S CT=CT+1
"RTN","MAGGTU7",104,0)
 . I 'QCODE D QUEIMAGE(.XX,CODE,Z) S CT=CT+1
"RTN","MAGGTU7",105,0)
 S MAGRY=CT_"^"_CT_" Group Image"_$S(CT=1:"",1:"'s")_" Queued to copy from JukeBox"
"RTN","MAGGTU7",106,0)
 Q
"RTN","MAGGTU7",107,0)
QUEPAT(MAGRY,CODE,MAGDFN) ;RPC [MAGG QUE PATIENT]
"RTN","MAGGTU7",108,0)
 ; Call to  Prefetch all images for a patient.
"RTN","MAGGTU7",109,0)
 ;  CODE is a string code for which images to Queue
"RTN","MAGGTU7",110,0)
 ;     ["A" Abatract
"RTN","MAGGTU7",111,0)
 ;     ["F" Full Resolution
"RTN","MAGGTU7",112,0)
 ;     ["B" Big File
"RTN","MAGGTU7",113,0)
 ;  this will queue a JBTOHD copy for all images for the patient.
"RTN","MAGGTU7",114,0)
 ;  images queued depend on what is contained in CODE
"RTN","MAGGTU7",115,0)
 ;
"RTN","MAGGTU7",116,0)
 N Y,I
"RTN","MAGGTU7",117,0)
 I '$D(^MAG(2005,"AC",+MAGDFN)) S MAGRY="0^No Images on file for "_$P($G(^DPT(+MAGDFN,0)),U,1) Q
"RTN","MAGGTU7",118,0)
 S I="" F  S I=$O(^MAG(2005,"AC",+MAGDFN,I),-1) Q:'I  D
"RTN","MAGGTU7",119,0)
 . I $P(^MAG(2005,I,0),U,10) Q
"RTN","MAGGTU7",120,0)
 . I $P(^MAG(2005,I,0),U,6)="11" D QUEGROUP(.XX,CODE,I,1) Q
"RTN","MAGGTU7",121,0)
 . D QPREFET(.XX,CODE,I)
"RTN","MAGGTU7",122,0)
 S MAGRY="1^"_$P(^DPT(+MAGDFN,0),U)_"'s Images will be copied from the JukeBox."
"RTN","MAGGTU7",123,0)
 Q
"RTN","MAGIPS20")
0^^B26957915
"RTN","MAGIPS20",1,0)
MAGIPS20 ;Pre-init routine to queue site activity at install.
"RTN","MAGIPS20",2,0)
 ;;3.0;IMAGING;**20**;Apr 12, 2006
"RTN","MAGIPS20",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGIPS20",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGIPS20",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGIPS20",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGIPS20",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGIPS20",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGIPS20",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGIPS20",10,0)
 ;; |                                                               |
"RTN","MAGIPS20",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGIPS20",12,0)
 ;; | a medical device.  As such, it may not be changed             |
"RTN","MAGIPS20",13,0)
 ;; | in any way.  Modifications to this software may result in an  |
"RTN","MAGIPS20",14,0)
 ;; | adulterated medical device under 21CFR820, the use of which   |
"RTN","MAGIPS20",15,0)
 ;; | is considered to be a violation of US Federal Statutes.       |
"RTN","MAGIPS20",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGIPS20",17,0)
 ;;
"RTN","MAGIPS20",18,0)
EC ; This is the Patch 20 Environment Check Routine
"RTN","MAGIPS20",19,0)
 N MESSAGE,ERR
"RTN","MAGIPS20",20,0)
 S ERR=0
"RTN","MAGIPS20",21,0)
 I DUZ(2)'=$$KSP^XUPARAM("INST") D
"RTN","MAGIPS20",22,0)
 . S MESSAGE="You must be logged in to the same institution on which you"
"RTN","MAGIPS20",23,0)
 . D BMES^XPDUTL(MESSAGE)
"RTN","MAGIPS20",24,0)
 . S MESSAGE="are installing this KIDS package"
"RTN","MAGIPS20",25,0)
 . D BMES^XPDUTL(MESSAGE)
"RTN","MAGIPS20",26,0)
 . S MESSAGE="Your DUZ(2) is: "_$G(DUZ(2))_" and the host system is: "_$$KSP^XUPARAM("INST")
"RTN","MAGIPS20",27,0)
 . D BMES^XPDUTL(MESSAGE)
"RTN","MAGIPS20",28,0)
 . S XPDQUIT=2 Q
"RTN","MAGIPS20",29,0)
 I '$P($G(^MAG(2006.1,$O(^MAG(2006.1," "),-1),0)),U),(+$P($G(^MAG(2006.1,0)),U,4))>1 D
"RTN","MAGIPS20",30,0)
 . S MESSAGE="Your Site Parameter file has more than one entry."
"RTN","MAGIPS20",31,0)
 . D BMES^XPDUTL(MESSAGE)
"RTN","MAGIPS20",32,0)
 . S MESSAGE="In order for the post-install"
"RTN","MAGIPS20",33,0)
 . D BMES^XPDUTL(MESSAGE)
"RTN","MAGIPS20",34,0)
 . S MESSAGE="to successfully convert your system it is necessary"
"RTN","MAGIPS20",35,0)
 . D BMES^XPDUTL(MESSAGE)
"RTN","MAGIPS20",36,0)
 . S MESSAGE="to remove the inactive Site Parameter file entry."
"RTN","MAGIPS20",37,0)
 . D BMES^XPDUTL(MESSAGE)
"RTN","MAGIPS20",38,0)
 . S XPDQUIT=2 Q
"RTN","MAGIPS20",39,0)
 I DUZ(2)=$$KSP^XUPARAM("INST"),ERR=0  D
"RTN","MAGIPS20",40,0)
 . S MESSAGE="Environment check: OK!"
"RTN","MAGIPS20",41,0)
 . D BMES^XPDUTL(MESSAGE) Q
"RTN","MAGIPS20",42,0)
 ;
"RTN","MAGIPS20",43,0)
 Q
"RTN","MAGIPS20",44,0)
PRE ; Remove DD field definitions so that new definition can be laid down cleanly
"RTN","MAGIPS20",45,0)
 N DIK,DA
"RTN","MAGIPS20",46,0)
 S DIK="^DD(2005,",DA=1,DA(1)=2005 D ^DIK
"RTN","MAGIPS20",47,0)
 S DIK="^DD(2005.1,",DA=1,DA(1)=2005.1 D ^DIK
"RTN","MAGIPS20",48,0)
 S DIK="^DD(2005.2,",DA=.04,DA(1)=2005.2 D ^DIK
"RTN","MAGIPS20",49,0)
 S DIK="^DD(2005.2,",DA=1,DA(1)=2005.2 D ^DIK
"RTN","MAGIPS20",50,0)
 S DIK="^DD(2005.2,",DA=2,DA(1)=2005.2 D ^DIK
"RTN","MAGIPS20",51,0)
 S DIK="^DD(2005.2,",DA=3,DA(1)=2005.2 D ^DIK
"RTN","MAGIPS20",52,0)
 S DIK="^DD(2005.2,",DA=4,DA(1)=2005.2 D ^DIK
"RTN","MAGIPS20",53,0)
 S DIK="^DD(2005.2,",DA=6,DA(1)=2005.2 D ^DIK
"RTN","MAGIPS20",54,0)
 S DIK="^DD(2005.2,",DA=14,DA(1)=2005.2 D ^DIK
"RTN","MAGIPS20",55,0)
 S DIK="^DD(2005.2,",DA=26,DA(1)=2005.2 D ^DIK
"RTN","MAGIPS20",56,0)
 S DIK="^DD(2005.04,",DA=1,DA(1)=2005.04 D ^DIK
"RTN","MAGIPS20",57,0)
 S DIK="^DD(2005.04,",DA=2,DA(1)=2005.04 D ^DIK
"RTN","MAGIPS20",58,0)
 S DIK="^DD(2006.1,",DA=.01,DA(1)=2006.1 D ^DIK
"RTN","MAGIPS20",59,0)
 S DIK="^DD(2006.1,",DA=.02,DA(1)=2006.1 D ^DIK
"RTN","MAGIPS20",60,0)
 S DIK="^DD(2006.1,",DA=.03,DA(1)=2006.1 D ^DIK
"RTN","MAGIPS20",61,0)
 S DIK="^DD(2006.1,",DA=.04,DA(1)=2006.1 D ^DIK
"RTN","MAGIPS20",62,0)
 S DIK="^DD(2006.1,",DA=.07,DA(1)=2006.1 D ^DIK
"RTN","MAGIPS20",63,0)
 S DIK="^DD(2006.1,",DA=.08,DA(1)=2006.1 D ^DIK
"RTN","MAGIPS20",64,0)
 S DIK="^DD(2006.1,",DA=1.01,DA(1)=2006.1 D ^DIK
"RTN","MAGIPS20",65,0)
 S DIK="^DD(2006.1,",DA=1.02,DA(1)=2006.1 D ^DIK
"RTN","MAGIPS20",66,0)
 S DIK="^DD(2006.1,",DA=1.03,DA(1)=2006.1 D ^DIK
"RTN","MAGIPS20",67,0)
 S DIK="^DD(2006.1,",DA=2.01,DA(1)=2006.1 D ^DIK
"RTN","MAGIPS20",68,0)
 S DIK="^DD(2006.1,",DA=2.02,DA(1)=2006.1 D ^DIK
"RTN","MAGIPS20",69,0)
 S DIK="^DD(2006.1,",DA=2.03,DA(1)=2006.1 D ^DIK
"RTN","MAGIPS20",70,0)
 S DIK="^DD(2006.1,",DA=6,DA(1)=2006.1 D ^DIK
"RTN","MAGIPS20",71,0)
 S DIK="^DD(2006.1,",DA=8,DA(1)=2006.1 D ^DIK
"RTN","MAGIPS20",72,0)
 S DIK="^DD(2006.1,",DA=9,DA(1)=2006.1 D ^DIK
"RTN","MAGIPS20",73,0)
 S DIK="^DD(2006.1,",DA=11,DA(1)=2006.1 D ^DIK
"RTN","MAGIPS20",74,0)
 S DIK="^DD(2006.1,",DA=21,DA(1)=2006.1 D ^DIK
"RTN","MAGIPS20",75,0)
 S DIK="^DD(2006.1,",DA=22,DA(1)=2006.1 D ^DIK
"RTN","MAGIPS20",76,0)
 S DIK="^DD(2006.1,",DA=25,DA(1)=2006.1 D ^DIK
"RTN","MAGIPS20",77,0)
 S DIK="^DD(2006.1,",DA=64,DA(1)=2006.1 D ^DIK
"RTN","MAGIPS20",78,0)
 S DIK="^DD(2006.1,",DA=102,DA(1)=2006.1 D ^DIK
"RTN","MAGIPS20",79,0)
 S DIK="^DD(2006.1,",DA=103,DA(1)=2006.1 D ^DIK
"RTN","MAGIPS20",80,0)
 S DIK="^DD(2006.1,",DA=201,DA(1)=2006.1 D ^DIK
"RTN","MAGIPS20",81,0)
 S DIK="^DD(2006.81,",DA=.04,DA(1)=2006.81 D ^DIK
"RTN","MAGIPS20",82,0)
 S DIK="^DD(2006.82,",DA=.04,DA(1)=2006.82 D ^DIK
"RTN","MAGIPS20",83,0)
 S DIK="^DD(2006.82,",DA=2,DA(1)=2006.82 D ^DIK
"RTN","MAGIPS20",84,0)
 D RX ;Remove "A" cross-references from the site parameter file
"RTN","MAGIPS20",85,0)
 ;remove file definitions so that the new file definitions will lay down cleanly
"RTN","MAGIPS20",86,0)
 N DIU
"RTN","MAGIPS20",87,0)
 F DIU=2006.03,2006.031,2006.032,2006.8,2006.12,2006.1201,2006.12201 D
"RTN","MAGIPS20",88,0)
 . S DIU(0)="" D EN^DIU2
"RTN","MAGIPS20",89,0)
 . Q
"RTN","MAGIPS20",90,0)
 D RMRPC("MAGQ FS CHNGE") ; Removing an RPC so that the revison installs cleanly
"RTN","MAGIPS20",91,0)
 Q
"RTN","MAGIPS20",92,0)
RX ; REMOVE A SET OF CROSS REFERENCES
"RTN","MAGIPS20",93,0)
 N FILE,FIELD,CROSSREF,IEN,NAME
"RTN","MAGIPS20",94,0)
 S CROSSREF="^ALTR^ARITE^AIMPORT^AIMDELBIG^AIMDELPACS^AIMDELPACS2^AIMDELPACS3^AIMDELPACSBIG^"
"RTN","MAGIPS20",95,0)
 S CROSSREF=CROSSREF_"AJBXDEV^AJBXTOT^AJBXPTR^APACS^APXDR^APXWRITE^ATRABS^"
"RTN","MAGIPS20",96,0)
 S FILE=2006.1,NAME=""
"RTN","MAGIPS20",97,0)
 F FIELD=.02,.03,.08,22,9,102,103,21,2.01,2.02,2.03,1.01,1.02,1.03,6 D
"RTN","MAGIPS20",98,0)
 . S IEN=$$CREF(FILE,FIELD,CROSSREF,.NAME) I IEN D
"RTN","MAGIPS20",99,0)
 . . K RXERR
"RTN","MAGIPS20",100,0)
 . . D DELIX^DDMOD(FILE,FIELD,IEN,"KW","MYOUT","RXERR")
"RTN","MAGIPS20",101,0)
 . . I $D(^DD(FILE,0,"IX",NAME,FILE,FIELD)) K ^DD(FILE,0,"IX",NAME,FILE,FIELD)
"RTN","MAGIPS20",102,0)
 . . Q
"RTN","MAGIPS20",103,0)
 . Q
"RTN","MAGIPS20",104,0)
 Q
"RTN","MAGIPS20",105,0)
CREF(FILE,FIELD,CROSSREF,NAME) ;
"RTN","MAGIPS20",106,0)
 N I,J
"RTN","MAGIPS20",107,0)
 S I=0 F  S I=I+1 Q:'$D(^DD(FILE,FIELD,1,I,0))  Q:CROSSREF[("^"_$P(^DD(FILE,FIELD,1,I,0),U,2)_"^")
"RTN","MAGIPS20",108,0)
 S J=1 F  S J=J+1 S NAME=$P(CROSSREF,U,J) Q:NAME=""  Q:$D(^DD(FILE,0,"IX",NAME,FILE,FIELD))
"RTN","MAGIPS20",109,0)
 Q $S(NAME'="":I,1:0)
"RTN","MAGIPS20",110,0)
RMRPC(NAME) ; Removing an RPC in order to revise
"RTN","MAGIPS20",111,0)
 N MW,RPC,MWE,DIERR
"RTN","MAGIPS20",112,0)
 S MW=$$FIND1^DIC(19,"","X","MAG WINDOWS","","","")
"RTN","MAGIPS20",113,0)
 D CLEAN^DILF
"RTN","MAGIPS20",114,0)
 Q:'MW
"RTN","MAGIPS20",115,0)
 S RPC=$$FIND1^DIC(8994,"","X",NAME,"","","")
"RTN","MAGIPS20",116,0)
 D CLEAN^DILF
"RTN","MAGIPS20",117,0)
 Q:'RPC
"RTN","MAGIPS20",118,0)
 S MWE=$$FIND1^DIC(19.05,","_MW_",","X","NAME","","","")
"RTN","MAGIPS20",119,0)
 D CLEAN^DILF
"RTN","MAGIPS20",120,0)
 Q:'MWE
"RTN","MAGIPS20",121,0)
 S DA=MWE,DA(1)=MW,DIK="^DIC(19,"_DA(1)_",""RPC"","
"RTN","MAGIPS20",122,0)
 D ^DIK
"RTN","MAGIPS20",123,0)
 K DA,DIK
"RTN","MAGIPS20",124,0)
 S DA=RPC,DIK="^XWB(8994,"
"RTN","MAGIPS20",125,0)
 D ^DIK
"RTN","MAGIPS20",126,0)
 K DA,DIK
"RTN","MAGIPS20",127,0)
 Q
"RTN","MAGIPS20",128,0)
 ;
"RTN","MAGIPT20")
0^^B70909996
"RTN","MAGIPT20",1,0)
MAGIPT20 ;Post init routine to queue site activity at install.
"RTN","MAGIPT20",2,0)
 ;;3.0;IMAGING;**20**;Apr 12, 2006
"RTN","MAGIPT20",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGIPT20",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGIPT20",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGIPT20",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGIPT20",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGIPT20",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGIPT20",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGIPT20",10,0)
 ;; |                                                               |
"RTN","MAGIPT20",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGIPT20",12,0)
 ;; | a medical device.  As such, it may not be changed             |
"RTN","MAGIPT20",13,0)
 ;; | in any way.  Modifications to this software may result in an  |
"RTN","MAGIPT20",14,0)
 ;; | adulterated medical device under 21CFR820, the use of which   |
"RTN","MAGIPT20",15,0)
 ;; | is considered to be a violation of US Federal Statutes.       |
"RTN","MAGIPT20",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGIPT20",17,0)
 ;;
"RTN","MAGIPT20",18,0)
POST ;
"RTN","MAGIPT20",19,0)
 N INDEX,INSTIEN,CON,AI,I
"RTN","MAGIPT20",20,0)
 S INSTIEN=$$KSP^XUPARAM("INST")
"RTN","MAGIPT20",21,0)
 I '$P($G(^MAG(2006.1,$O(^MAG(2006.1," "),-1),0)),U) D
"RTN","MAGIPT20",22,0)
 . S CON=0
"RTN","MAGIPT20",23,0)
 . D BMES^XPDUTL("Non-consolidated conversion, Queue file Clearing: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","MAGIPT20",24,0)
 . D CLRQ^MAGQBUT4
"RTN","MAGIPT20",25,0)
 . D BMES^XPDUTL("Non-consolidated conversion, PLACE setting: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","MAGIPT20",26,0)
 . D SETPL
"RTN","MAGIPT20",27,0)
 . D BMES^XPDUTL("Non-consolidated conversion, SITEID PROCESS: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","MAGIPT20",28,0)
 . D SITEID
"RTN","MAGIPT20",29,0)
 . Q
"RTN","MAGIPT20",30,0)
 E  S CON=1
"RTN","MAGIPT20",31,0)
 S INDEX=0 F  S INDEX=$O(^MAG(2006.1,INDEX)) Q:'INDEX  D  ;set Import security ON by default
"RTN","MAGIPT20",32,0)
 . I $P($G(^MAG(2006.1,INDEX,3)),U,12)'?1N S $P(^MAG(2006.1,INDEX,3),U,12)="1"
"RTN","MAGIPT20",33,0)
 D BMES^XPDUTL("Queue Pointer Update: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","MAGIPT20",34,0)
 D CPUD^MAGQBUT4
"RTN","MAGIPT20",35,0)
 D BMES^XPDUTL("Workstation Session Place Indexing: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","MAGIPT20",36,0)
 D WSUP(6)
"RTN","MAGIPT20",37,0)
 D REMTASK^MAGQE4
"RTN","MAGIPT20",38,0)
 D STTASK^MAGQE4
"RTN","MAGIPT20",39,0)
 D POSTI^MAGQBUT
"RTN","MAGIPT20",40,0)
 D BMES^XPDUTL("Site Parameter PLACE Indexing: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","MAGIPT20",41,0)
 S ^MAG(2006.1,"CONSOLIDATED")="YES"
"RTN","MAGIPT20",42,0)
 S INDEX="A" K ^MAG(2006.1,INDEX)
"RTN","MAGIPT20",43,0)
 F  S INDEX=$O(^MAG(2006.1,INDEX)) Q:($E(INDEX,1)'="A")  I INDEX'="AC",INDEX'="AD" K ^MAG(2006.1,INDEX)
"RTN","MAGIPT20",44,0)
 D BMES^XPDUTL("Updating MAG WINDOWS: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","MAGIPT20",45,0)
 D ADDRPC^MAGQBUT4("MAGQ COQ","MAG WINDOWS")
"RTN","MAGIPT20",46,0)
 D ADDRPC^MAGQBUT4("MAGQ QCNT","MAG WINDOWS")
"RTN","MAGIPT20",47,0)
 D ADDRPC^MAGQBUT4("XUS GET TOKEN","MAG WINDOWS")
"RTN","MAGIPT20",48,0)
 D ADDRPC^MAGQBUT4("XWB GET VARIABLE VALUE","MAG WINDOWS")
"RTN","MAGIPT20",49,0)
 D BMES^XPDUTL("Image and Queue file Indexing: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","MAGIPT20",50,0)
 D INDEX
"RTN","MAGIPT20",51,0)
 D BMES^XPDUTL("Medical Division Evaluation: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","MAGIPT20",52,0)
 D AI^MAGQBUT5(.AI)
"RTN","MAGIPT20",53,0)
 S I="" F  S I=$O(AI(I)) Q:I=""  D BMES^XPDUTL(AI(I))
"RTN","MAGIPT20",54,0)
 D BMES^XPDUTL("If there are Medical Divisions that have no Imaging Site parameter")
"RTN","MAGIPT20",55,0)
 D BMES^XPDUTL("affiliations you will want to setup Associated Institutions using the")
"RTN","MAGIPT20",56,0)
 D BMES^XPDUTL("site parameter window on the Background Processor.")
"RTN","MAGIPT20",57,0)
 K AI
"RTN","MAGIPT20",58,0)
 D INS^MAGQBUT4(XPDNM,DUZ,$$NOW^XLFDT,XPDA)
"RTN","MAGIPT20",59,0)
 D BMES^XPDUTL("Install complete: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","MAGIPT20",60,0)
 Q
"RTN","MAGIPT20",61,0)
INDEX ; Re-index actually (2006.03 & 2006.031 Are rebuilt during the conversion)
"RTN","MAGIPT20",62,0)
 N IEN,FILE,CNT,IENA,TMPACQ,TINSTIEN,ERRCNT,I,IEN,INSTDA,SAVE,SITEARAY,SITEDA
"RTN","MAGIPT20",63,0)
 N STATION,GIC,NLC,NSC,MESSAGE,GL,NMSP,GRPOBJ,VALUE,DIC,X,Y,LIMIT,CHANGE,TMP,FNUM
"RTN","MAGIPT20",64,0)
 S (ERRCNT,IEN,CNT,GIC,NLC,NSC,CHANGE)=0,NMSP=""
"RTN","MAGIPT20",65,0)
 S DIC=4.3,X=^XMB("NETNAME")
"RTN","MAGIPT20",66,0)
 D ^DIC K DIC
"RTN","MAGIPT20",67,0)
 S:+Y LIMIT=+$$GET1^DIQ(4.3,+Y,16.1,"","RP","")
"RTN","MAGIPT20",68,0)
 S LIMIT=$S(LIMIT:LIMIT,1:2000)
"RTN","MAGIPT20",69,0)
 D STATION
"RTN","MAGIPT20",70,0)
 D NMSP^MAGQBUT4(.NMSP)
"RTN","MAGIPT20",71,0)
 S GL=""
"RTN","MAGIPT20",72,0)
 F  D SCAN^MAGQBPG1(.IEN,"F",.GL) D  Q:'IEN
"RTN","MAGIPT20",73,0)
 . Q:'IEN
"RTN","MAGIPT20",74,0)
 . S CNT=CNT+1
"RTN","MAGIPT20",75,0)
 . S FNUM=$S(GL[2005.1:2005.1,GL[2005:2005,1:"")
"RTN","MAGIPT20",76,0)
 . S GRPOBJ=0
"RTN","MAGIPT20",77,0)
 . I (CNT#1000)=0 W "."
"RTN","MAGIPT20",78,0)
 . I (CNT#80000)=0 W !
"RTN","MAGIPT20",79,0)
 . S TMPACQ=$P($G(^MAG(FNUM,IEN,100)),U,3)
"RTN","MAGIPT20",80,0)
 . I (TMPACQ'=""),$D(SITEARAY(TMPACQ)) S TINSTIEN=TMPACQ
"RTN","MAGIPT20",81,0)
 . E  S TINSTIEN=$S('CON:INSTIEN,TMPACQ=INSTIEN:TMPACQ,1:$$GI(TMPACQ,INSTIEN,GL,IEN,FNUM))
"RTN","MAGIPT20",82,0)
 . I TINSTIEN="" D
"RTN","MAGIPT20",83,0)
 . . D DFNIQ^MAGQBPG1("","Invalid Acquisition Site for image: "_IEN_" the value in question is: "_TMPACQ,0)
"RTN","MAGIPT20",84,0)
 . . S ERRCNT=ERRCNT+1
"RTN","MAGIPT20",85,0)
 . . I (ERRCNT+1)>LIMIT D 
"RTN","MAGIPT20",86,0)
 . . . D DFNIQ^MAGQBPG1("Post Install error in Acquisition Site Validation","",1)
"RTN","MAGIPT20",87,0)
 . . . S ERRCNT=0 Q
"RTN","MAGIPT20",88,0)
 . E  D
"RTN","MAGIPT20",89,0)
 . . I TMPACQ'=TINSTIEN S $P(^MAG(FNUM,IEN,100),U,3)=TINSTIEN
"RTN","MAGIPT20",90,0)
 . . S:(FNUM=2005) ^MAG(2005,"D",TINSTIEN,IEN)=""
"RTN","MAGIPT20",91,0)
 . . Q
"RTN","MAGIPT20",92,0)
 . I CON,TINSTIEN'="",TMPACQ'=TINSTIEN S ^TMP($J,"CHANGE_IEN",CHANGE+1)=TMPACQ_U_TINSTIEN_U_IEN,CHANGE=CHANGE+1
"RTN","MAGIPT20",93,0)
 . S FILE=$P($G(^MAG(FNUM,IEN,0)),U,2) Q:'$D(FILE)  Q:$L(FILE)<9
"RTN","MAGIPT20",94,0)
 . S FILE=$P(FILE,".")
"RTN","MAGIPT20",95,0)
 . K ^MAG(FNUM,"F",$E(FILE,1,30),IEN),^MAG(FNUM,"f",$E(FILE,1,30),IEN)
"RTN","MAGIPT20",96,0)
 . S ^MAG(FNUM,"F",$E(FILE,1,30),IEN)=""
"RTN","MAGIPT20",97,0)
 . Q
"RTN","MAGIPT20",98,0)
 I ERRCNT>0 D DFNIQ^MAGQBPG1("Post Install error in Acquisition Site Validation","",1)
"RTN","MAGIPT20",99,0)
 I CHANGE>0 D ACQUD^MAGQBUT4(LIMIT)
"RTN","MAGIPT20",100,0)
 K NMSP,SITEARAY,STATION
"RTN","MAGIPT20",101,0)
 K ^MAG(2005.2,"B"),^MAG(2005.2,"C"),^MAG(2005.2,"D"),^MAG(2005.2,"E"),^MAG(2005.2,"F")
"RTN","MAGIPT20",102,0)
 K ^MAG(2005.2,"AC")
"RTN","MAGIPT20",103,0)
 S DIK="^MAG(2005.2," D IXALL^DIK
"RTN","MAGIPT20",104,0)
 K ^MAG(2006.1,"B"),^MAG(2006.1,"AC"),^MAG(2006.1,"AD")
"RTN","MAGIPT20",105,0)
 S DIK="^MAG(2006.1," D IXALL^DIK
"RTN","MAGIPT20",106,0)
 K ^MAG(2006.8,"C"),^MAG(2006.8,"D"),^MAG(2006.8,"B"),^MAG(2006.8,"E")
"RTN","MAGIPT20",107,0)
 S DIK="^MAG(2006.8," D IXALL^DIK
"RTN","MAGIPT20",108,0)
 K ^MAGQUEUE(2006.03,"B"),^MAGQUEUE(2006.03,"C"),^MAGQUEUE(2006.03,"D"),^MAGQUEUE(2006.03,"E"),^MAGQUEUE(2006.03,"F")
"RTN","MAGIPT20",109,0)
 S DIK="^MAGQUEUE(2006.03," D IXALL^DIK
"RTN","MAGIPT20",110,0)
 K ^MAGQUEUE(2006.031,"B"),^MAGQUEUE(2006.031,"C")
"RTN","MAGIPT20",111,0)
 S DIK="^MAGQUEUE(2006.031," D IXALL^DIK
"RTN","MAGIPT20",112,0)
 K ^MAGQUEUE(2006.032,"B"),^MAGQUEUE(2006.032,"C")
"RTN","MAGIPT20",113,0)
 S DIK="^MAGQUEUE(2006.032," D IXALL^DIK
"RTN","MAGIPT20",114,0)
 K DIK
"RTN","MAGIPT20",115,0)
 I GIC>1 D
"RTN","MAGIPT20",116,0)
 . S MESSAGE="It was necessary to attempt to recover the Acquisition site for this install"
"RTN","MAGIPT20",117,0)
 . D BMES^XPDUTL(MESSAGE)
"RTN","MAGIPT20",118,0)
 . S MESSAGE="using the following methods: "
"RTN","MAGIPT20",119,0)
 . D BMES^XPDUTL(MESSAGE)
"RTN","MAGIPT20",120,0)
 . S MESSAGE="$$GI: "_GIC_", this is the 'get institution' method, "
"RTN","MAGIPT20",121,0)
 . D BMES^XPDUTL(MESSAGE)
"RTN","MAGIPT20",122,0)
 . S MESSAGE="using the Institution file 'D' cross-reference."
"RTN","MAGIPT20",123,0)
 . D BMES^XPDUTL(MESSAGE)
"RTN","MAGIPT20",124,0)
 . S MESSAGE="$$CNL: "_NLC_", this is the 'network location file lookup method' for this image."
"RTN","MAGIPT20",125,0)
 . D BMES^XPDUTL(MESSAGE)
"RTN","MAGIPT20",126,0)
 . S MESSAGE="$$CNSP: "_NSC_", this is the 'image file namespace' method."
"RTN","MAGIPT20",127,0)
 . D BMES^XPDUTL(MESSAGE)
"RTN","MAGIPT20",128,0)
 . Q
"RTN","MAGIPT20",129,0)
 Q
"RTN","MAGIPT20",130,0)
GI(TMPACQ,INSTIEN,GL,IEN,FNUM) ;      Get institution
"RTN","MAGIPT20",131,0)
 N TMPI
"RTN","MAGIPT20",132,0)
 S VALUE=""
"RTN","MAGIPT20",133,0)
 S GIC=GIC+1
"RTN","MAGIPT20",134,0)
 I TMPACQ'="",$D(STATION("PROBLEM",TMPACQ)) S TMPACQ=""
"RTN","MAGIPT20",135,0)
 I TMPACQ'="" D  Q:VALUE VALUE
"RTN","MAGIPT20",136,0)
 . S TMPI=$O(STATION("STATION",TMPACQ,""))
"RTN","MAGIPT20",137,0)
 . S VALUE=$S(TMPI="":"",$D(SITEARAY(TMPI)):TMPI,1:"")
"RTN","MAGIPT20",138,0)
 . Q
"RTN","MAGIPT20",139,0)
 I GRPOBJ=0&($D(^MAG(FNUM,IEN,1,0))) D  Q VALUE
"RTN","MAGIPT20",140,0)
 . NEW IENX,IENY
"RTN","MAGIPT20",141,0)
 . S IENX=$O(^MAG(FNUM,IEN,1,0))
"RTN","MAGIPT20",142,0)
 . I IENX="" Q
"RTN","MAGIPT20",143,0)
 . S GRPOBJ=1
"RTN","MAGIPT20",144,0)
 . S IENY=$P(^MAG(FNUM,IEN,1,IENX,0),U)
"RTN","MAGIPT20",145,0)
 . S TMPACQ=$P($G(^MAG(FNUM,IENY,100)),U,3)
"RTN","MAGIPT20",146,0)
 . I (TMPACQ'=""),$D(SITEARAY(TMPACQ)) S VALUE=TMPACQ
"RTN","MAGIPT20",147,0)
 . E  S VALUE=$S('CON:INSTIEN,TMPACQ=INSTIEN:TMPACQ,1:$$GI(TMPACQ,INSTIEN,GL,IENY))
"RTN","MAGIPT20",148,0)
 . Q
"RTN","MAGIPT20",149,0)
 S VALUE=$$CNL^MAGQBUT4(GL,IEN,.NLC)
"RTN","MAGIPT20",150,0)
 Q:VALUE VALUE
"RTN","MAGIPT20",151,0)
 S VALUE=$$CNSP^MAGQBUT4(GL,IEN,.NMSP,.NSC)
"RTN","MAGIPT20",152,0)
 Q VALUE
"RTN","MAGIPT20",153,0)
SETPL ;
"RTN","MAGIPT20",154,0)
 N IEN,NAME,DR,DA,DIE,X,Y,PLACE,FILE
"RTN","MAGIPT20",155,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGIPT20",156,0)
 F FILE=2005.2,2006.8 D
"RTN","MAGIPT20",157,0)
 . S (NAME,IEN)="" F  S NAME=$O(^MAG(FILE,"B",NAME)) Q:NAME=""  D
"RTN","MAGIPT20",158,0)
 . . S IEN=$O(^MAG(FILE,"B",NAME,""))
"RTN","MAGIPT20",159,0)
 . . S DR=".04///^S X=PLACE",DA=IEN,DIE=FILE D ^DIE
"RTN","MAGIPT20",160,0)
 . . Q
"RTN","MAGIPT20",161,0)
 S FILE=2006.032,(NAME,IEN)=""
"RTN","MAGIPT20",162,0)
 F  S NAME=$O(^MAGQUEUE(FILE,"B",NAME)) Q:NAME=""  D
"RTN","MAGIPT20",163,0)
 . S IEN=$O(^MAGQUEUE(FILE,"B",NAME,""))
"RTN","MAGIPT20",164,0)
 . S DR=".04///^S X=PLACE",DA=IEN,DIE=FILE D ^DIE
"RTN","MAGIPT20",165,0)
 . Q
"RTN","MAGIPT20",166,0)
 Q
"RTN","MAGIPT20",167,0)
WSUP(MONTHS) ;
"RTN","MAGIPT20",168,0)
 N EDATE,PLACE,SDATE,IEN,DEFP,CNT,ZNODE,DAYS
"RTN","MAGIPT20",169,0)
 S DAYS=MONTHS*(365/12)
"RTN","MAGIPT20",170,0)
 S DEFP=$$KSP^XUPARAM("INST")
"RTN","MAGIPT20",171,0)
 S EDATE=$$FMADD^XLFDT($$NOW^XLFDT,-DAYS,"","","")
"RTN","MAGIPT20",172,0)
 S IEN=$O(^MAG(2006.82," "),-1),CNT=0
"RTN","MAGIPT20",173,0)
 F  S IEN=$O(^MAG(2006.82,IEN),-1) Q:'IEN  S SDATE=$P($G(^MAG(2006.82,IEN,0)),U,3) Q:SDATE<EDATE  D
"RTN","MAGIPT20",174,0)
 . S CNT=CNT+1
"RTN","MAGIPT20",175,0)
 . W:(CNT#1000)=0 "."
"RTN","MAGIPT20",176,0)
 . W:(CNT#80000)=0 !
"RTN","MAGIPT20",177,0)
 . S PLACE=$P($G(^MAG(2006.82,IEN,1)),U,4)
"RTN","MAGIPT20",178,0)
 . S PLACE=$S(PLACE:PLACE,1:DEFP)
"RTN","MAGIPT20",179,0)
 . S ^MAG(2006.82,"APL",PLACE,SDATE,IEN)=""
"RTN","MAGIPT20",180,0)
 Q
"RTN","MAGIPT20",181,0)
SITEID ;
"RTN","MAGIPT20",182,0)
 N FDA,MSG,IEN
"RTN","MAGIPT20",183,0)
 S IEN=$O(^MAG(2006.1,"A"),-1)_","
"RTN","MAGIPT20",184,0)
 S FDA(2006.1,IEN,.01)=$$KSP^XUPARAM("INST")
"RTN","MAGIPT20",185,0)
 D FILE^DIE("E","FDA","MSG")
"RTN","MAGIPT20",186,0)
 Q
"RTN","MAGIPT20",187,0)
STATION ;  make Imaging Site Parameters (2006.1) file a local array
"RTN","MAGIPT20",188,0)
 ;      find problems in the "D" cross reference of the Institution file
"RTN","MAGIPT20",189,0)
 N I,IEN,INSTDA,SAVE,SITEDA
"RTN","MAGIPT20",190,0)
 S INSTDA="" F  S INSTDA=$O(^MAG(2006.1,"B",INSTDA)) Q:INSTDA=""  S SITEDA="" D
"RTN","MAGIPT20",191,0)
 . S SITEDA=$O(^MAG(2006.1,"B",INSTDA,SITEDA)) Q:SITEDA=""  D
"RTN","MAGIPT20",192,0)
 . . S SITEARAY(INSTDA,SITEDA)=""
"RTN","MAGIPT20",193,0)
 . . Q
"RTN","MAGIPT20",194,0)
 . Q
"RTN","MAGIPT20",195,0)
 K ^TMP($J,"MAG_STATION")
"RTN","MAGIPT20",196,0)
 S STATION=""
"RTN","MAGIPT20",197,0)
 F  S STATION=$O(^DIC(4,"D",STATION)) Q:STATION=""  S IEN="" D
"RTN","MAGIPT20",198,0)
 . F I=1:1 S IEN=$O(^DIC(4,"D",STATION,IEN)) Q:IEN=""  D
"RTN","MAGIPT20",199,0)
 . . S ^TMP($J,"MAG_STATION",STATION)=I
"RTN","MAGIPT20",200,0)
 . . S ^TMP($J,"MAG_STATION",STATION,IEN)=""
"RTN","MAGIPT20",201,0)
 . . Q
"RTN","MAGIPT20",202,0)
 . Q
"RTN","MAGIPT20",203,0)
 S STATION=""
"RTN","MAGIPT20",204,0)
 F  S STATION=$O(^TMP($J,"MAG_STATION",STATION)) Q:STATION=""  D
"RTN","MAGIPT20",205,0)
 . S SAVE=""
"RTN","MAGIPT20",206,0)
 . S STATION("STATION",STATION)=^TMP($J,"MAG_STATION",STATION)
"RTN","MAGIPT20",207,0)
 . I ^TMP($J,"MAG_STATION",STATION)>1 S STATION("PROBLEM",STATION)=""
"RTN","MAGIPT20",208,0)
 . S IEN=""
"RTN","MAGIPT20",209,0)
 . F  S IEN=$O(^TMP($J,"MAG_STATION",STATION,IEN)) Q:IEN=""  D
"RTN","MAGIPT20",210,0)
 . . S STATION("STATION",STATION,IEN)=""
"RTN","MAGIPT20",211,0)
 . . I $D(^DIC(4,STATION))&(STATION'=IEN) S STATION("PROBLEM",STATION)=""
"RTN","MAGIPT20",212,0)
 . . I $D(SITEARAY(IEN)) S SAVE=1
"RTN","MAGIPT20",213,0)
 . . Q
"RTN","MAGIPT20",214,0)
 . I SAVE=1 Q
"RTN","MAGIPT20",215,0)
 . K STATION("STATION",STATION)
"RTN","MAGIPT20",216,0)
 . Q
"RTN","MAGIPT20",217,0)
 K ^TMP($J,"MAG_STATION")
"RTN","MAGIPT20",218,0)
 Q
"RTN","MAGIPT20",219,0)
 ;
"RTN","MAGLOG")
0^37^B6935907
"RTN","MAGLOG",1,0)
MAGLOG ;WOIFO/RED,SRR,MLH - Log image access ; [ 06/20/2001 08:57 ]
"RTN","MAGLOG",2,0)
 ;;3.0;IMAGING;**17,8,20**;Apr 12, 2006
"RTN","MAGLOG",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGLOG",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGLOG",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGLOG",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGLOG",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGLOG",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGLOG",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGLOG",10,0)
 ;; |                                                               |
"RTN","MAGLOG",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGLOG",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGLOG",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGLOG",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGLOG",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGLOG",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGLOG",17,0)
 ;;
"RTN","MAGLOG",18,0)
 ; CALL WITH:
"RTN","MAGLOG",19,0)
 ; MAGIMT = TYPE OF ACCESS
"RTN","MAGLOG",20,0)
 ; DUZ = USER NO.
"RTN","MAGLOG",21,0)
 ; MAGO = IMAGE SUBSCRIPT NO.
"RTN","MAGLOG",22,0)
 ; MAGPACK = USER INTERFACE PACKAGE
"RTN","MAGLOG",23,0)
 ; MAGDFN = PATIENT NO.
"RTN","MAGLOG",24,0)
 ; MAGCT = TOTAL IMAGE COUNT
"RTN","MAGLOG",25,0)
 ; MAGAD = ADDITIONAL DATA
"RTN","MAGLOG",26,0)
ENTRY(MAGIMT,MAGDUZ,MAGO,MAGPACK,MAGDFN,MAGCT,MAGAD) ;
"RTN","MAGLOG",27,0)
 I '$D(MAGSYS) S MAGSYS=^%ZOSF("VOL")
"RTN","MAGLOG",28,0)
 N MAGC,MSYS
"RTN","MAGLOG",29,0)
 S MSYS=$$UP^XLFSTR(MAGSYS)
"RTN","MAGLOG",30,0)
 I (MSYS["UNKNOWN"),($D(MAGJOB("WRKSIEN"))) S MSYS=$P(^MAG(2006.81,MAGJOB("WRKSIEN"),0),"^",1)
"RTN","MAGLOG",31,0)
 L +^MAG(2006.95,0):10 E  Q  ;entries were being overwritten.
"RTN","MAGLOG",32,0)
 S MAGC=$P(^MAG(2006.95,0),"^",3)+1
"RTN","MAGLOG",33,0)
 S $P(^MAG(2006.95,0),"^",3,4)=MAGC_"^"_MAGC
"RTN","MAGLOG",34,0)
 L -^MAG(2006.95,0)
"RTN","MAGLOG",35,0)
 D NOW^%DTC ;gives us % (now)
"RTN","MAGLOG",36,0)
 ;   FLD #'s            .01         1                2          3          4             5         6       7          8               9  
"RTN","MAGLOG",37,0)
 S ^MAG(2006.95,MAGC,0)=MAGC_"^"_$G(MAGIMT)_"^"_$G(MAGDUZ)_"^"_MAGO_"^"_MAGPACK_"^"_MSYS_"^"_%_"^"_MAGDFN_"^"_MAGCT_"^"_+$G(MAGJOB("SESSION"))
"RTN","MAGLOG",38,0)
 I $D(MAGAD) S ^MAG(2006.95,MAGC,100)=MAGAD
"RTN","MAGLOG",39,0)
 S ^MAG(2006.95,"B",MAGC,MAGC)=""
"RTN","MAGLOG",40,0)
 I $G(MAGJOB("SESSION")) S ^MAG(2006.95,"AS",+$G(MAGJOB("SESSION")),MAGC)=""
"RTN","MAGLOG",41,0)
 Q
"RTN","MAGLOG",42,0)
ACCESS(MAGO) ; Update Field "Last Access Date" in Image File.
"RTN","MAGLOG",43,0)
 I '$D(^MAG(2005,MAGO,0)) D  Q
"RTN","MAGLOG",44,0)
 . I $D(^MAG(2005.1,MAGO,0)) S $P(^MAG(2005.1,MAGO,0),"^",9)=$$NOW^XLFDT
"RTN","MAGLOG",45,0)
 . Q
"RTN","MAGLOG",46,0)
 S $P(^MAG(2005,MAGO,0),"^",9)=$$NOW^XLFDT
"RTN","MAGLOG",47,0)
 Q
"RTN","MAGQBAB")
0^4^B10838980
"RTN","MAGQBAB",1,0)
MAGQBAB ;WOIFO/PMK/RMP - Create an ABSTRACT from an image file [ 06/20/2001 08:57 ]
"RTN","MAGQBAB",2,0)
 ;;3.0;IMAGING;**1,8,20**;Apr 12, 2006
"RTN","MAGQBAB",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBAB",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBAB",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBAB",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBAB",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBAB",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBAB",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBAB",10,0)
 ;; |                                                               |
"RTN","MAGQBAB",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBAB",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBAB",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBAB",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBAB",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBAB",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBAB",17,0)
 ;;
"RTN","MAGQBAB",18,0)
ENTRY(RESULT,QPTR) ;
"RTN","MAGQBAB",19,0)
 ; RESULT=STATUS^IMAGE PTR^FROM FILEPATH^ABSTRACT FILEPATH^QPTR^VWP^QSN
"RTN","MAGQBAB",20,0)
 ; VWP=VISTA WRITE LOCATION,QSN=QUEUE SEQUENCE NUMBER
"RTN","MAGQBAB",21,0)
 N IMGPTR,L,X,MAGXX,FILENAME,FILE,ABSNAME,JBPATH
"RTN","MAGQBAB",22,0)
 N MAGNODE,MAGFILE,MAGFILE2,QSN,QNODE,MAGDRIVE,CWL,PLACE
"RTN","MAGQBAB",23,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBAB",24,0)
 S U="^",QNODE=$G(^MAGQUEUE(2006.03,QPTR,0))
"RTN","MAGQBAB",25,0)
 S IMGPTR=$P(QNODE,U,7),QSN=+$P(QNODE,U,9)
"RTN","MAGQBAB",26,0)
 S MAGNODE=$G(^MAG(2005,IMGPTR,0))
"RTN","MAGQBAB",27,0)
 I $P(MAGNODE,U,2)="" D  Q
"RTN","MAGQBAB",28,0)
 . S RESULT="-1^"_QPTR_U_"The Image file entry has no file name for IEN: "_IMGPTR_"^^^^"_QSN
"RTN","MAGQBAB",29,0)
 . Q
"RTN","MAGQBAB",30,0)
 I $P(MAGNODE,U,4)?1N.N D  Q
"RTN","MAGQBAB",31,0)
 . S RESULT="-1^"_QPTR_U_$P($P(MAGNODE,U,2),".")_" has an .ABS file already referenced on the Vista cache ^^^^"_QSN
"RTN","MAGQBAB",32,0)
 . Q
"RTN","MAGQBAB",33,0)
 I $P(MAGNODE,U,3)="" D  Q
"RTN","MAGQBAB",34,0)
 . I $P(MAGNODE,U,5)?1N.N D  Q
"RTN","MAGQBAB",35,0)
 . . N QN,TMP
"RTN","MAGQBAB",36,0)
 . . S QN=$$JBTOHD^MAGBAPI(IMGPTR_U_"FULL",PLACE)
"RTN","MAGQBAB",37,0)
 . . S TMP=IMGPTR_" Full File is not on the VC, a JBTOHD queue will retrieve and the ABSTRACT will be requeued"
"RTN","MAGQBAB",38,0)
 . . S RESULT="-15^"_QPTR_U_TMP_"^^"_QPTR_"^^"_QSN
"RTN","MAGQBAB",39,0)
 . . Q
"RTN","MAGQBAB",40,0)
 . S RESULT="-2^"_QPTR_U_IMGPTR_" File not available on the Vista network^^"_QPTR_"^^"_QSN
"RTN","MAGQBAB",41,0)
 ; get the path and file name for this image
"RTN","MAGQBAB",42,0)
 S MAGXX=IMGPTR D VSTNOCP^MAGFILEB I $P(MAGFILE1,U)="-1" D  Q
"RTN","MAGQBAB",43,0)
 . S RESULT="-3^"_QPTR_U_IMGPTR_" File not on-line^^"_QPTR_"^^"_QSN
"RTN","MAGQBAB",44,0)
 S FILENAME=MAGFILE
"RTN","MAGQBAB",45,0)
 S L=$L(FILENAME) I '$A(FILENAME,L) S FILENAME=$E(FILENAME,1,L-1)
"RTN","MAGQBAB",46,0)
 S L=$L(FILENAME,"\") ; parse the file
"RTN","MAGQBAB",47,0)
 S FILE=$P(FILENAME,"\",L)
"RTN","MAGQBAB",48,0)
 K MAGFILE1
"RTN","MAGQBAB",49,0)
 ;
"RTN","MAGQBAB",50,0)
 S JBPATH=$P(MAGNODE,U,5)
"RTN","MAGQBAB",51,0)
 S JBPATH=$S('JBPATH:"",1:$P(^MAG(2005.2,JBPATH,0),U,2)_$$DIRHASH^MAGFILEB(FILE,JBPATH))
"RTN","MAGQBAB",52,0)
 S CWL=$$CWL^MAGBAPI(PLACE),MAGDRIVE=$P(^MAG(2005.2,CWL,0),U,2)
"RTN","MAGQBAB",53,0)
 S ABSNAME=MAGDRIVE_$$DIRHASH^MAGFILEB(FILE,CWL)
"RTN","MAGQBAB",54,0)
 S ABSNAME=ABSNAME_$P(FILE,".")_".ABS"
"RTN","MAGQBAB",55,0)
 S RESULT="1"_U_IMGPTR_U_FILENAME_U_ABSNAME_U_QPTR_U_CWL_U_QSN_U_JBPATH
"RTN","MAGQBAB",56,0)
 Q
"RTN","MAGQBD")
0^23^B7129737
"RTN","MAGQBD",1,0)
MAGQBD ;WOIFO/PMK/RMP - Arbitrary file deletion [ 06/20/2001 08:57 ]
"RTN","MAGQBD",2,0)
 ;;3.0;IMAGING;**20**;Apr 12, 2006
"RTN","MAGQBD",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBD",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBD",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBD",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBD",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBD",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBD",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBD",10,0)
 ;; |                                                               |
"RTN","MAGQBD",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBD",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBD",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBD",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBD",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBD",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBD",17,0)
 ;;
"RTN","MAGQBD",18,0)
 ; !!! QUEUER MUST HANDLE NULLING MAGNETIC WRITE LOCATION !!
"RTN","MAGQBD",19,0)
ENTRY(RESULT,QPTR) ; entry point from ^MAGBMAIN
"RTN","MAGQBD",20,0)
 N FILE,X,IEN,FN,ARCH,NODE,PLACE,GB,CJB,CJBP
"RTN","MAGQBD",21,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2))),(GB,ARCH)=""
"RTN","MAGQBD",22,0)
 S U="^",X=^MAGQUEUE(2006.03,QPTR,0)
"RTN","MAGQBD",23,0)
 S FILE=$P(X,"^",10)
"RTN","MAGQBD",24,0)
 S FN=$P(FILE,"\",$L(FILE,"\"))
"RTN","MAGQBD",25,0)
 S IEN=$O(^MAG(2005.1,"F",$P(FN,"."),""))
"RTN","MAGQBD",26,0)
 I 'IEN S RESULT="-1"_U_QPTR_U_"No 2005.1 Entry established for Image file: "_$P(FN,".")_U_U Q
"RTN","MAGQBD",27,0)
 S NODE=$G(^MAG(2005.1,IEN,0))
"RTN","MAGQBD",28,0)
 I $P(FILE,".",2)'["BIG" S ARCH=$S($P(NODE,U,5):$P(NODE,U,5),1:"")
"RTN","MAGQBD",29,0)
 E  S ARCH=$S($P($G(^MAG(2005.1,IEN,"FBIG")),U,2):$P($G(^MAG(2005.1,IEN,"FBIG")),U,2),1:"")
"RTN","MAGQBD",30,0)
 S CJB=$P($G(^MAGQUEUE(2006.032,$P($G(^MAG(2006.1,PLACE,1)),U,6),0)),U,3)
"RTN","MAGQBD",31,0)
 S CJBP=$$UPPER^MAGQE4($P($G(^MAG(2005.2,CJB,0)),U,2)_$$DIRHASH^MAGFILEB(FN,CJB))
"RTN","MAGQBD",32,0)
 S GB=$S(ARCH:$$UPPER^MAGQE4($P($G(^MAG(2005.2,ARCH,0)),U,2)_$$DIRHASH^MAGFILEB(FN,ARCH)),1:"")
"RTN","MAGQBD",33,0)
 I ($L(GB)<1)&($L(CJBP)<1) S RESULT="-1"_U_QPTR_U_"No Archive Global established for entry: "_IEN_U_QPTR_U_U
"RTN","MAGQBD",34,0)
 E  S RESULT="1"_U_FILE_U_QPTR_U_+$P(X,U,9)_U_GB_U_IEN_U_ARCH_U_CJB_U_CJBP
"RTN","MAGQBD",35,0)
 Q
"RTN","MAGQBGCC")
0^5^B11208984
"RTN","MAGQBGCC",1,0)
MAGQBGCC ;WOIFO/RMP - Export an image file to a remote location  [ 06/20/2001 08:57 ]
"RTN","MAGQBGCC",2,0)
 ;;3.0;IMAGING;**8,48,20**;Apr 12, 2006
"RTN","MAGQBGCC",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBGCC",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBGCC",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBGCC",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBGCC",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBGCC",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBGCC",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBGCC",10,0)
 ;; |                                                               |
"RTN","MAGQBGCC",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBGCC",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBGCC",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBGCC",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBGCC",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBGCC",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBGCC",17,0)
 ;;
"RTN","MAGQBGCC",18,0)
ENTRY(RESULT,QPTR) ; entry point from ^MAGQBTM
"RTN","MAGQBGCC",19,0)
 ; RESULT=STATUS^IMAGE PTR^FROM FILE^TO FILE^QUEUE PTR^REMOTELOC PTR^QSN
"RTN","MAGQBGCC",20,0)
 ; QSN=QUEUE SEQUENCE NUMBER
"RTN","MAGQBGCC",21,0)
 N CWL,IMGPTR,L,FILE,MAGREF,TOFILE,QNODE,QSN,ZNODE,SOURCE,FTYPE,MSG,EXT,ALTDEST,ALTTYPE
"RTN","MAGQBGCC",22,0)
 S QNODE=$G(^MAGQUEUE(2006.03,QPTR,0)),RESULT="1"
"RTN","MAGQBGCC",23,0)
 S IMGPTR=$P(QNODE,U,7),QSN=+$P(QNODE,U,9),ALTDEST=+$P(QNODE,U,10),ALTTYPE=$P(QNODE,U,11)
"RTN","MAGQBGCC",24,0)
 S ZNODE=$G(^MAG(2005,IMGPTR,0))
"RTN","MAGQBGCC",25,0)
 I ZNODE="" D  Q  ;RESULT ;!!!!
"RTN","MAGQBGCC",26,0)
 . S RESULT="-101^"_QPTR_"^MAG Global Node #"_IMGPTR_" not present"
"RTN","MAGQBGCC",27,0)
 S FILE=$P(ZNODE,U,2)
"RTN","MAGQBGCC",28,0)
 I FILE="" D  Q  ;RESULT ;!!!
"RTN","MAGQBGCC",29,0)
 . I +$P($G(^MAG(2005,IMGPTR,1,0)),U,4)>0 D
"RTN","MAGQBGCC",30,0)
 . . S MSG="Image group parent"
"RTN","MAGQBGCC",31,0)
 . E  S MSG="Does not have an image file specified"
"RTN","MAGQBGCC",32,0)
 . S RESULT="-5"_U_QPTR_U_MSG
"RTN","MAGQBGCC",33,0)
 S FTYPE=$S(ALTTYPE="":"FULL",1:$$FTYPE^MAGQBPRG(ALTTYPE))
"RTN","MAGQBGCC",34,0)
 D @(FTYPE_"(.RESULT,.MAGREF,IMGPTR)")
"RTN","MAGQBGCC",35,0)
 Q:$P(RESULT,"^")<0
"RTN","MAGQBGCC",36,0)
 S SOURCE=$$WPATH(FILE,MAGREF)_FILE
"RTN","MAGQBGCC",37,0)
 S L=+$P(QNODE,"^",10)
"RTN","MAGQBGCC",38,0)
 S CWL=$S(L>0:L,1:$$CEL())
"RTN","MAGQBGCC",39,0)
 I $P(^MAG(2005.2,CWL,0),"^",6)'="1" D  Q
"RTN","MAGQBGCC",40,0)
 . S RESULT="-4"_U_QPTR_U_"Export Network Location is set Off-Line"
"RTN","MAGQBGCC",41,0)
 S TOFILE=$$WPATH(FILE,CWL)_FILE
"RTN","MAGQBGCC",42,0)
 S RESULT="1^"_IMGPTR_U_SOURCE_U_TOFILE_U_QPTR_U_CWL_U_QSN_U_$P(QNODE,U,11)
"RTN","MAGQBGCC",43,0)
 Q
"RTN","MAGQBGCC",44,0)
CEL() ; Current Export Pointer
"RTN","MAGQBGCC",45,0)
 Q $S($P(^MAG(2006.1,$$PLACE^MAGBAPI(+$G(DUZ(2))),0),"^",7)>1:$P(^(0),"^",7),1:1)
"RTN","MAGQBGCC",46,0)
WPATH(FILE,LOC) ; Write path of location (CWP)
"RTN","MAGQBGCC",47,0)
 Q $P(^MAG(2005.2,LOC,0),"^",2)_$$DIRHASH^MAGFILEB(FILE,LOC)
"RTN","MAGQBGCC",48,0)
FULL(RESULT,MAGREF,MAGIFN) ; copy a full-size image
"RTN","MAGQBGCC",49,0)
 S MAGREF=$$LINE(+$P(^MAG(2005,MAGIFN,0),"^",3))
"RTN","MAGQBGCC",50,0)
 I 'MAGREF S MAGREF=$$LINE(+$P(^MAG(2005,MAGIFN,0),"^",5))
"RTN","MAGQBGCC",51,0)
 S:('MAGREF) RESULT="-3"_U_QPTR_U_"File not on-line"
"RTN","MAGQBGCC",52,0)
 Q 
"RTN","MAGQBGCC",53,0)
 ;
"RTN","MAGQBGCC",54,0)
ABS(RESULT,MAGREF,MAGIFN) ; copy an image abstract
"RTN","MAGQBGCC",55,0)
 S MAGREF=$$LINE(+$P(^MAG(2005,MAGIFN,0),"^",4))
"RTN","MAGQBGCC",56,0)
 I 'MAGREF S MAGREF=$$LINE(+$P(^MAG(2005,MAGIFN,0),"^",5))
"RTN","MAGQBGCC",57,0)
 S:('MAGREF) RESULT="-3"_U_QPTR_U_"Abstract File not on-line"
"RTN","MAGQBGCC",58,0)
 Q 
"RTN","MAGQBGCC",59,0)
 ;
"RTN","MAGQBGCC",60,0)
BIG(RESULT,MAGREF,MAGIFN) ; copy a big image
"RTN","MAGQBGCC",61,0)
 S MAGREF=$$LINE(+$P(^MAG(2005,MAGIFN,"FBIG"),"^",1))
"RTN","MAGQBGCC",62,0)
 I 'MAGREF S MAGREF=$$LINE(+$P(^MAG(2005,MAGIFN,"FBIG"),"^",2))
"RTN","MAGQBGCC",63,0)
 S:('MAGREF) RESULT="-3"_U_QPTR_U_"Big File not on-line"
"RTN","MAGQBGCC",64,0)
 Q
"RTN","MAGQBGCC",65,0)
LINE(PTR) ;Check if the share is online
"RTN","MAGQBGCC",66,0)
 Q:PTR<1 ""
"RTN","MAGQBGCC",67,0)
 Q $S($P($G(^MAG(2005.2,PTR,0)),U,6)=1:PTR,1:"")
"RTN","MAGQBGCC",68,0)
 ;
"RTN","MAGQBIM")
0^24^B7456958
"RTN","MAGQBIM",1,0)
MAGQBIM ;WOIFO/RMP - Import functions  ;19 Nov 2001 1:23 PM
"RTN","MAGQBIM",2,0)
 ;;3.0;IMAGING;**7,20**;Apr 12, 2006
"RTN","MAGQBIM",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBIM",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBIM",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBIM",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBIM",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBIM",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBIM",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBIM",10,0)
 ;; |                                                               |
"RTN","MAGQBIM",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBIM",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBIM",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBIM",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBIM",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBIM",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBIM",17,0)
 ;;
"RTN","MAGQBIM",18,0)
 ;
"RTN","MAGQBIM",19,0)
 Q
"RTN","MAGQBIM",20,0)
ENTRY(QP,QUE,QP2,ZN,RES) ;
"RTN","MAGQBIM",21,0)
 K OUT,ERR,IEN
"RTN","MAGQBIM",22,0)
 S IEN=$S($P(ZN,U,11)?1N.N:$P(ZN,U,11),1:QP)
"RTN","MAGQBIM",23,0)
 D FIND^DIC(2006.041,"","@;.02","PQ",IEN,1,"","","","OUT","ERR")
"RTN","MAGQBIM",24,0)
 I ($D(ERR)!($P($G(OUT("DILIST",0)),U)<1)) D  Q
"RTN","MAGQBIM",25,0)
 . D QSTAT^MAGQBTM(IEN,QUE_" Dequeue Failed on TrackId lookup.",QUE,$$PLACE^MAGBAPI(+$G(DUZ(2))))
"RTN","MAGQBIM",26,0)
 . S RES="0"_U_QP2_U_" Dequeue Failed on TrackId lookup."
"RTN","MAGQBIM",27,0)
 . Q
"RTN","MAGQBIM",28,0)
 N VALUE
"RTN","MAGQBIM",29,0)
 S VALUE=$P(OUT("DILIST",1,0),U,2)
"RTN","MAGQBIM",30,0)
 S RES=QP_U_VALUE_U_$TR($P(ZN,U,10),"|",U)_U_IEN
"RTN","MAGQBIM",31,0)
 S $P(RES,U,8)=+$P(ZN,U,9)
"RTN","MAGQBIM",32,0)
 Q
"RTN","MAGQBIM",33,0)
STAT(QP,TIME,MESS) ;
"RTN","MAGQBIM",34,0)
 N TRACKID
"RTN","MAGQBIM",35,0)
 K OUT,ERR,FDA
"RTN","MAGQBIM",36,0)
 S FDA(2006.041,"+1,",.01)=QP
"RTN","MAGQBIM",37,0)
 D FIND^DIC(2006.041,"","@;.02","PQ",QP,1,"","","","OUT","ERR")
"RTN","MAGQBIM",38,0)
 Q:$D(ERR)
"RTN","MAGQBIM",39,0)
 Q:$P(OUT("DILIST",0),U)<1
"RTN","MAGQBIM",40,0)
 S TRACKID=$P(OUT("DILIST",1,0),U,2)
"RTN","MAGQBIM",41,0)
 S FDA(2006.041,"+1,",.02)=TRACKID
"RTN","MAGQBIM",42,0)
 S FDA(2006.041,"+1,",1)="BP QUEUE STATUS"
"RTN","MAGQBIM",43,0)
 S FDA(2006.041,"+1,",2)=TIME
"RTN","MAGQBIM",44,0)
 S FDA(2006.041,"+1,",3)=MESS
"RTN","MAGQBIM",45,0)
 D UPDATE^DIE("U","FDA","","MAGIMP")
"RTN","MAGQBIM",46,0)
 Q
"RTN","MAGQBIM",47,0)
TIDL(QP,QUE,RES) ;
"RTN","MAGQBIM",48,0)
 K OUT,ERR
"RTN","MAGQBIM",49,0)
 S RES=0
"RTN","MAGQBIM",50,0)
 D FIND^DIC(2006.041,"","@;.02","PQ",QP,1,"","","","OUT","ERR")
"RTN","MAGQBIM",51,0)
 I ($D(ERR)!($P($G(OUT("DILIST",0)),U)<1)) D  Q
"RTN","MAGQBIM",52,0)
 . D QSTAT^MAGQBTM(QP,QUE_"      Requeue Failed on TrackId lookup.",QUE,$$PLACE^MAGBAPI(+$G(DUZ(2))))
"RTN","MAGQBIM",53,0)
 . Q
"RTN","MAGQBIM",54,0)
 S RES=$P($G(OUT("DILIST",1,0)),U,2)
"RTN","MAGQBIM",55,0)
 Q
"RTN","MAGQBJB")
0^6^B18032148
"RTN","MAGQBJB",1,0)
MAGQBJB ;WOIFO/PMK/RMP - Get an image file to copy to the JukeBoX [ 06/20/2001 08:57 ]
"RTN","MAGQBJB",2,0)
 ;;3.0;IMAGING;**8,20**;Apr 12, 2006
"RTN","MAGQBJB",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBJB",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBJB",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBJB",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBJB",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBJB",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBJB",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBJB",10,0)
 ;; |                                                               |
"RTN","MAGQBJB",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBJB",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBJB",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBJB",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBJB",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBJB",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBJB",17,0)
 ;;
"RTN","MAGQBJB",18,0)
ENTRY(RESULT,QPTR) ; entry point from ^MAGQBTM
"RTN","MAGQBJB",19,0)
 ; RESULT=STATUS^IMAGE PTR^FROM FILE^TO FILE^VOLUME NAME^
"RTN","MAGQBJB",20,0)
 ;   JUKEBOX DEVICE^QUEUE PTR^JUKEBOX-NETWORK LOC PTR^QSN
"RTN","MAGQBJB",21,0)
 ; QSN=QUEUE SEQUENCE NUMBER
"RTN","MAGQBJB",22,0)
 N CWP,IMGPTR,L,JBDEVICE,FILENAME,FILE,X,JBPTR,SUBDIR
"RTN","MAGQBJB",23,0)
 N MAGFILE,MAGXX,MAGSTORE,MAGFILE2,PERCENT,SIZERTN,MAGDEV,SRCE
"RTN","MAGQBJB",24,0)
 N TOFILE,TOTAL,QNODE,QSN,ZNODE,BNODE,FULL,ABS,BIG,MSG,PLACE,AGG
"RTN","MAGQBJB",25,0)
 S U="^",QNODE=$G(^MAGQUEUE(2006.03,QPTR,0)),(ZNODE,FULL,ABS,BIG,JBPTR,AGG)=""
"RTN","MAGQBJB",26,0)
 S IMGPTR=$P(QNODE,U,7),QSN=+$P(QNODE,U,9),PLACE=$P(QNODE,U,12)
"RTN","MAGQBJB",27,0)
 I $D(^MAG(2005,IMGPTR,0)) D
"RTN","MAGQBJB",28,0)
 . S ZNODE=$G(^MAG(2005,IMGPTR,0))
"RTN","MAGQBJB",29,0)
 . S BNODE=$G(^MAG(2005,IMGPTR,"FBIG"))
"RTN","MAGQBJB",30,0)
 . Q
"RTN","MAGQBJB",31,0)
 E  I $D(^MAG(2005.1,IMGPTR,0)) D
"RTN","MAGQBJB",32,0)
 . S ZNODE=$G(^MAG(2005.1,IMGPTR,0))
"RTN","MAGQBJB",33,0)
 . S BNODE=$G(^MAG(2005.1,IMGPTR,"FBIG"))
"RTN","MAGQBJB",34,0)
 . Q
"RTN","MAGQBJB",35,0)
 I ZNODE="" D  Q  ;RESULT ;!!!!
"RTN","MAGQBJB",36,0)
 . S RESULT="-101^"_QPTR_"^MAG Global Node #"_IMGPTR_" not present"
"RTN","MAGQBJB",37,0)
 S FILE=$P(ZNODE,U,2)
"RTN","MAGQBJB",38,0)
 I FILE="" D  Q  ;RESULT ;!!!
"RTN","MAGQBJB",39,0)
 . I +$P($G(^MAG(2005,IMGPTR,1,0)),U,4)>0 D
"RTN","MAGQBJB",40,0)
 . . S MSG="Image group parent"
"RTN","MAGQBJB",41,0)
 . E  S MSG="Does not have an image file specified"
"RTN","MAGQBJB",42,0)
 . S RESULT="-5"_U_QPTR_U_MSG
"RTN","MAGQBJB",43,0)
 ;I $P(ZNODE,U,5),$P(BNODE,U,2) D  Q
"RTN","MAGQBJB",44,0)
 ;. S RESULT="-11^"_QPTR_"^Source file is already archived" Q
"RTN","MAGQBJB",45,0)
 ; Establish the current Jukebox location
"RTN","MAGQBJB",46,0)
 S CWP=$$CWP^MAGBAPI($$PLACE^MAGBAPI(+$G(DUZ(2))))
"RTN","MAGQBJB",47,0)
 I $P(^MAG(2005.2,CWP,0),"^",6)'="1" D  Q
"RTN","MAGQBJB",48,0)
 . S RESULT="-4"_U_QPTR_U_"Jukebox Network Location is set Off-Line"
"RTN","MAGQBJB",49,0)
 S JBPTR=$$JBPTR^MAGBAPI($$PLACE^MAGBAPI(+$G(DUZ(2))))
"RTN","MAGQBJB",50,0)
 S JBDEVICE=$$JBDEV(JBPTR)
"RTN","MAGQBJB",51,0)
 ; If the current Jukebox write location differs from the FULL/ABstract Worm or the BIG Worm then aggregate
"RTN","MAGQBJB",52,0)
 S AGG=$S($P(ZNODE,U,5)&($P(ZNODE,U,5)'=CWP):1,$P(BNODE,U,2)&($P(BNODE,U,2)'=CWP):1,1:"")
"RTN","MAGQBJB",53,0)
 ; Check for FULL
"RTN","MAGQBJB",54,0)
 S SRCE=$S($$SLINE(+$P(ZNODE,U,3)):$P(ZNODE,U,3),1:"")
"RTN","MAGQBJB",55,0)
 I 'SRCE,AGG S SRCE=$S($$SLINE(+$P(ZNODE,U,5)):$P(ZNODE,U,5),1:"")
"RTN","MAGQBJB",56,0)
 I SRCE D 
"RTN","MAGQBJB",57,0)
 . S MAGDEV=$P(^MAG(2005.2,SRCE,0),U,2),FULL=MAGDEV_$$DIRHASH^MAGFILEB(FILE,SRCE)_FILE Q 
"RTN","MAGQBJB",58,0)
 ; Check for Abstract
"RTN","MAGQBJB",59,0)
 S SRCE=$S($$SLINE(+$P(ZNODE,U,4)):$P(ZNODE,U,4),1:"")
"RTN","MAGQBJB",60,0)
 I 'SRCE,AGG S SRCE=$S($$SLINE(+$P(ZNODE,U,5)):$P(ZNODE,U,5),1:"")
"RTN","MAGQBJB",61,0)
 I SRCE D 
"RTN","MAGQBJB",62,0)
 . S MAGDEV=$P(^MAG(2005.2,SRCE,0),U,2),ABS=MAGDEV_$$DIRHASH^MAGFILEB(FILE,SRCE)_$P(FILE,".")_".ABS" Q 
"RTN","MAGQBJB",63,0)
 ; Check for Big
"RTN","MAGQBJB",64,0)
 S SRCE=$S($$SLINE(+$P(BNODE,U,1)):$P(BNODE,U,1),1:"")
"RTN","MAGQBJB",65,0)
 I 'SRCE,AGG S SRCE=$S($$SLINE(+$P(BNODE,U,2)):$P(BNODE,U,2),1:"")
"RTN","MAGQBJB",66,0)
 I SRCE D 
"RTN","MAGQBJB",67,0)
 . S MAGDEV=$P(^MAG(2005.2,SRCE,0),U,2),BIG=MAGDEV_$$DIRHASH^MAGFILEB(FILE,SRCE)_$P(FILE,".")_".BIG" Q 
"RTN","MAGQBJB",68,0)
 I FULL="",BIG="",ABS="" D  Q
"RTN","MAGQBJB",69,0)
 . S MSG=$S(('$P(BNODE,U))&('$P(ZNODE,U,4))&('$P(ZNODE,U,4)):"No Vista Cache Source",1:"")
"RTN","MAGQBJB",70,0)
 . S MSG=$S('MSG:"There are no network location references for this image: "_FILE,1:MSG)
"RTN","MAGQBJB",71,0)
 . S RESULT="-11^"_QPTR_"^"_MSG
"RTN","MAGQBJB",72,0)
 . Q
"RTN","MAGQBJB",73,0)
 K MAGFILE1
"RTN","MAGQBJB",74,0)
 S TOFILE=$$WPATH(FILE,CWP)_FILE
"RTN","MAGQBJB",75,0)
 S RESULT="1^"_IMGPTR_U_FULL_U_TOFILE_U
"RTN","MAGQBJB",76,0)
 S RESULT=RESULT_$$VOLNM(JBPTR)_U_JBDEVICE_U_QPTR_U_CWP_U_QSN_U_ABS_U_BIG
"RTN","MAGQBJB",77,0)
 Q  ;RESULT ;!!!
"RTN","MAGQBJB",78,0)
JBLPT(JBPTR) ; Jukebox Ptr to Network Location File
"RTN","MAGQBJB",79,0)
 Q $P(^MAGQUEUE(2006.032,JBPTR,0),U,3)
"RTN","MAGQBJB",80,0)
WPATH(FILE,CWP) ; Write path of Current Write Platter (CWP)
"RTN","MAGQBJB",81,0)
 Q $P(^MAG(2005.2,CWP,0),"^",2)_$$DIRHASH^MAGFILEB(FILE,CWP)
"RTN","MAGQBJB",82,0)
VOLNM(JBPTR) ; Volume name of JBDEVICE
"RTN","MAGQBJB",83,0)
 Q $P($G(^MAGQUEUE(2006.032,JBPTR,0)),"^",9)
"RTN","MAGQBJB",84,0)
JBDEV(JBPTR) ; Jukebox Device (drive spec)
"RTN","MAGQBJB",85,0)
 Q $P($G(^MAGQUEUE(2006.032,JBPTR,0)),"^",2)
"RTN","MAGQBJB",86,0)
JBPLT(PTR) ; FIND 2005.2 REFERENCE
"RTN","MAGQBJB",87,0)
 N I,RESULT
"RTN","MAGQBJB",88,0)
 S (I,RESULT)=0
"RTN","MAGQBJB",89,0)
 F  S I=$O(^MAGQUEUE(2006.032,I)) Q:'I  D  Q:RESULT
"RTN","MAGQBJB",90,0)
 . I $P(^MAGQUEUE(2006.032,I,0),U,3)=PTR S RESULT=I
"RTN","MAGQBJB",91,0)
 . Q
"RTN","MAGQBJB",92,0)
 Q RESULT
"RTN","MAGQBJB",93,0)
SLINE(PTR) ;Check if the share is online
"RTN","MAGQBJB",94,0)
 Q:PTR<1 ""
"RTN","MAGQBJB",95,0)
 Q $S($P($G(^MAG(2005.2,PTR,0)),U,6)=1:1,1:"")
"RTN","MAGQBJH")
0^7^B24339395
"RTN","MAGQBJH",1,0)
MAGQBJH ;WOIFO/PMK/RMP - Copy an image from the Jukebox to the Hard Disk [ 06/20/2001 08:57 ]
"RTN","MAGQBJH",2,0)
 ;;3.0;IMAGING;**8,20**;Apr 12, 2006
"RTN","MAGQBJH",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBJH",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBJH",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBJH",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBJH",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBJH",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBJH",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBJH",10,0)
 ;; |                                                               |
"RTN","MAGQBJH",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBJH",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBJH",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBJH",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBJH",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBJH",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBJH",17,0)
 ;;
"RTN","MAGQBJH",18,0)
 ; RESULT=STATUS^MAGIFN^FROMPATH^TOPATH^FILETYPE^QPTR^VWP^QSN
"RTN","MAGQBJH",19,0)
 ; VWP = VISTA WRITE-LOCATION POINTER, QSN=QUEUE SEQUENCE NUMBER
"RTN","MAGQBJH",20,0)
ENTRY(RESULT,QPTR) ; entry point from ^MAGBMAIN
"RTN","MAGQBJH",21,0)
 N NODE,X,MAGIFN,FILETYPE,MAGXX,STATUS,TODAY,MAGPIECE,MAGREF
"RTN","MAGQBJH",22,0)
 N FROMPATH,TOPATH,MAGFILE,MAGFILE2,QSN,MSG,PLACE
"RTN","MAGQBJH",23,0)
 S U="^",NODE=^MAGQUEUE(2006.03,QPTR,0),QSN=+$P(NODE,U,9)
"RTN","MAGQBJH",24,0)
 S PLACE=$P(NODE,U,12)
"RTN","MAGQBJH",25,0)
 I "^JBTOHD^PREFET^"'[(U_$P(NODE,U)_U) D  Q
"RTN","MAGQBJH",26,0)
 . S RESULT="-4"_U_QPTR_U_"Not a Jukebox to HardDisk Process"
"RTN","MAGQBJH",27,0)
 S MAGIFN=$P(NODE,U,7),FILETYPE=$P(NODE,U,8)
"RTN","MAGQBJH",28,0)
 D NOW^%DTC S TODAY=X
"RTN","MAGQBJH",29,0)
 I "^FULL^ABSTRACT^BIG^"'[("^"_FILETYPE_"^") D  Q
"RTN","MAGQBJH",30,0)
 . S RESULT="-4"_U_QPTR_U_FILETYPE_" Is not a Jukebox to HardDisk Process"
"RTN","MAGQBJH",31,0)
 I $P(^MAG(2005,MAGIFN,0),U,2)="" D  Q
"RTN","MAGQBJH",32,0)
 . I +$P($G(^MAG(2005,MAGIFN,1,0)),U,4)>0 D
"RTN","MAGQBJH",33,0)
 . . S MSG="Image group parent"
"RTN","MAGQBJH",34,0)
 . E  S MSG="Does not have an image file specified"
"RTN","MAGQBJH",35,0)
 . S RESULT="-5"_U_QPTR_U_MSG
"RTN","MAGQBJH",36,0)
 . K ^MAGQUEUE(2006.03,"F",PLACE,MAGIFN,FILETYPE,QPTR)
"RTN","MAGQBJH",37,0)
 D @(FILETYPE_"(PLACE)") ; do either FULL or ABSTRACT
"RTN","MAGQBJH",38,0)
 K ^MAGQUEUE(2006.03,"F",PLACE,MAGIFN,FILETYPE,QPTR)
"RTN","MAGQBJH",39,0)
 K MAGFILE1
"RTN","MAGQBJH",40,0)
 S RESULT=STATUS
"RTN","MAGQBJH",41,0)
 S $P(RESULT,U,8)=QSN
"RTN","MAGQBJH",42,0)
 Q  ;RESULT ;!!! REMOVE RESULT ON DISTRIBUTION
"RTN","MAGQBJH",43,0)
 ;
"RTN","MAGQBJH",44,0)
FULL(PLACE) ; copy a full-size image
"RTN","MAGQBJH",45,0)
 S MAGXX=MAGIFN D VSTNOCP^MAGFILEB
"RTN","MAGQBJH",46,0)
 I (($P(MAGFILE1,U)="-1")!('$P(^MAG(2005,MAGIFN,0),"^",5))) D  Q 
"RTN","MAGQBJH",47,0)
 . S STATUS="-3"_U_QPTR_U_"Image IEN:"_MAGIFN_"has no file on-line"
"RTN","MAGQBJH",48,0)
 S MAGREF=$P(^MAG(2005,MAGIFN,0),"^",3)
"RTN","MAGQBJH",49,0)
 I MAGREF?1N.N D WLSET(.STATUS,MAGIFN,MAGREF,"FULL",PLACE) Q
"RTN","MAGQBJH",50,0)
 S STATUS=$$COPY(PLACE) I +STATUS>0 D  ;
"RTN","MAGQBJH",51,0)
 . S $P(^MAG(2005,MAGIFN,0),"^",9)=TODAY ; update the last access date
"RTN","MAGQBJH",52,0)
 Q 
"RTN","MAGQBJH",53,0)
 ;
"RTN","MAGQBJH",54,0)
ABSTRACT(PLACE) ; copy an image abstract
"RTN","MAGQBJH",55,0)
 S MAGXX=MAGIFN D ABSNOCP^MAGFILEB
"RTN","MAGQBJH",56,0)
 I (($P(MAGFILE1,U)="-1")!('$P(^MAG(2005,MAGIFN,0),"^",5))) D  Q
"RTN","MAGQBJH",57,0)
 . S STATUS="-3"_U_QPTR_U_"Image IEN:"_MAGIFN_"has no file on-line"
"RTN","MAGQBJH",58,0)
 S MAGREF=$P(^MAG(2005,MAGIFN,0),"^",4)
"RTN","MAGQBJH",59,0)
 I MAGREF?1N.N D WLSET(.STATUS,MAGIFN,MAGREF,"ABSTRACT",PLACE) Q
"RTN","MAGQBJH",60,0)
 S STATUS=$$COPY(PLACE) I +STATUS>0 D  ;
"RTN","MAGQBJH",61,0)
 . S $P(^MAG(2005,MAGIFN,0),"^",9)=TODAY ; update the last access date
"RTN","MAGQBJH",62,0)
 Q 
"RTN","MAGQBJH",63,0)
 ;
"RTN","MAGQBJH",64,0)
BIG(PLACE) ; copy a big image
"RTN","MAGQBJH",65,0)
 S MAGXX=MAGIFN D BIGNOCP^MAGFILEB
"RTN","MAGQBJH",66,0)
 I (($P(MAGFILE1,U)="-1")!('$P($G(^MAG(2005,MAGIFN,"FBIG")),U,2))) D  Q
"RTN","MAGQBJH",67,0)
 . S STATUS="-3"_U_QPTR_U_"Image IEN:"_MAGIFN_"has no file on-line"
"RTN","MAGQBJH",68,0)
 S MAGREF=$P(^MAG(2005,MAGIFN,"FBIG"),U)
"RTN","MAGQBJH",69,0)
 I MAGREF?1N.N D WLSET(.STATUS,MAGIFN,MAGREF,"BIG",PLACE) Q
"RTN","MAGQBJH",70,0)
 S STATUS=$$COPY(PLACE) I +STATUS>0 D  ;
"RTN","MAGQBJH",71,0)
 . S $P(^MAG(2005,MAGIFN,0),"^",9)=TODAY ; update the last access date
"RTN","MAGQBJH",72,0)
 Q 
"RTN","MAGQBJH",73,0)
 ;
"RTN","MAGQBJH",74,0)
WLSET(STATUS,MAGIFN,MAGREF,TYPE,PLACE) ;Write Location set already
"RTN","MAGQBJH",75,0)
 N JBREF,JBPATH,CWL,SOURCE,DEST,ALTDEST,ONLINE,PATH
"RTN","MAGQBJH",76,0)
 S $P(^MAG(2005,MAGIFN,0),U,9)=TODAY ; update the last access date
"RTN","MAGQBJH",77,0)
 ; output the warning message
"RTN","MAGQBJH",78,0)
 S JBREF=$S(TYPE="BIG":$P($G(^MAG(2005,MAGIFN,"FBIG")),U,2),1:$P(^MAG(2005,MAGIFN,0),U,5))
"RTN","MAGQBJH",79,0)
 S JBPATH=$P(^MAG(2005.2,JBREF,0),U,2)
"RTN","MAGQBJH",80,0)
 S JBPATH=JBPATH_$$DIRHASH^MAGFILEB(MAGFILE1,JBREF)
"RTN","MAGQBJH",81,0)
 S CWL=$$CWL^MAGBAPI(PLACE)
"RTN","MAGQBJH",82,0)
 S SOURCE=JBPATH_MAGFILE1
"RTN","MAGQBJH",83,0)
 S ONLINE=$P(^MAG(2005.2,MAGREF,0),U,6)
"RTN","MAGQBJH",84,0)
 ;If the current magnetic write location is on line the first
"RTN","MAGQBJH",85,0)
 ;destination path will be to that path and the 2nd path is the 
"RTN","MAGQBJH",86,0)
 ;current write location
"RTN","MAGQBJH",87,0)
 S PATH=$P(^MAG(2005.2,$S(ONLINE:MAGREF,1:CWL),0),U,2)
"RTN","MAGQBJH",88,0)
 S DEST=PATH_$$DIRHASH^MAGFILEB(MAGFILE1,$S(ONLINE:MAGREF,1:CWL))_MAGFILE1
"RTN","MAGQBJH",89,0)
 S:ONLINE ALTDEST=$P(^MAG(2005.2,CWL,0),U,2)_$$DIRHASH^MAGFILEB(MAGFILE1,CWL)_MAGFILE1
"RTN","MAGQBJH",90,0)
 S STATUS="2^"_MAGIFN_U_SOURCE_U_DEST
"RTN","MAGQBJH",91,0)
 S STATUS=STATUS_U_FILETYPE_U_QPTR_U_$S(ONLINE:MAGREF,1:CWL)_U_QSN
"RTN","MAGQBJH",92,0)
 S:ONLINE STATUS=STATUS_U_ALTDEST_U_CWL
"RTN","MAGQBJH",93,0)
 Q
"RTN","MAGQBJH",94,0)
 ;
"RTN","MAGQBJH",95,0)
COPY(PLACE) ; copy an image file from the jukebox to the hard drive
"RTN","MAGQBJH",96,0)
 N MAGREF,MAGDRIVE
"RTN","MAGQBJH",97,0)
 D GETDRIVE(.MAGDRIVE,.MAGREF,PLACE) ;^MAGFILE ; find space to put file
"RTN","MAGQBJH",98,0)
 I MAGREF'?1N.N Q "-4^"_QPTR_"^Current Write Location is not SET"
"RTN","MAGQBJH",99,0)
 I +$P($G(^MAG(2005.2,MAGREF,0)),"^",6)'>0 Q "-4^"_QPTR_"^Current Write Location is OFFLINE"
"RTN","MAGQBJH",100,0)
 S TOPATH=MAGDRIVE_$$DIRHASH^MAGFILEB(MAGFILE1,MAGREF)_MAGFILE1
"RTN","MAGQBJH",101,0)
 S FROMPATH=MAGFILE2
"RTN","MAGQBJH",102,0)
 Q "1"_U_MAGIFN_U_FROMPATH_U_TOPATH_U_FILETYPE_U_QPTR_U_MAGREF
"RTN","MAGQBJH",103,0)
GETDRIVE(DRIVE,MAGREF,PLACE) ; Get the current drive for writing an image
"RTN","MAGQBJH",104,0)
 S MAGREF=$$CWL^MAGBAPI(PLACE)
"RTN","MAGQBJH",105,0)
 S DRIVE=$S('MAGREF:"",1:$P(^MAG(2005.2,MAGREF,0),U,2))
"RTN","MAGQBJH",106,0)
 Q
"RTN","MAGQBJH",107,0)
 ;
"RTN","MAGQBJHR")
0^8^B14061671
"RTN","MAGQBJHR",1,0)
MAGQBJHR ;WOIFO/RP; Report of Currently Queued items [ 03/28/2001 18:40 ]
"RTN","MAGQBJHR",2,0)
 ;;3.0;IMAGING;**20**;Apr 12, 2006
"RTN","MAGQBJHR",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBJHR",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBJHR",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBJHR",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBJHR",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBJHR",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBJHR",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBJHR",10,0)
 ;; |                                                               |
"RTN","MAGQBJHR",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBJHR",12,0)
 ;; | a Class II medical device.  As such, it may not be changed    |
"RTN","MAGQBJHR",13,0)
 ;; | in any way.  Modifications to this software may result in an  |
"RTN","MAGQBJHR",14,0)
 ;; | adulterated medical device under 21CFR820, the use of which   |
"RTN","MAGQBJHR",15,0)
 ;; | is considered to be a violation of US Federal Statutes.       |
"RTN","MAGQBJHR",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBJHR",17,0)
 ;;
"RTN","MAGQBJHR",18,0)
 ;Report of currently queued JBTOHD
"RTN","MAGQBJHR",19,0)
JHRPT(RESULT) ;[MAGQ JH RPT]
"RTN","MAGQBJHR",20,0)
 N INDEX,CNT,TYPE,SUBTYPE,PDUZ,PAT,IEN,QUEUER,SESS,PLACE
"RTN","MAGQBJHR",21,0)
 S TYPE="JBTOHD",CNT=-1,PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBJHR",22,0)
 ;S INDEX=550
"RTN","MAGQBJHR",23,0)
 S INDEX=$P($G(^MAGQUEUE(2006.031,$O(^MAGQUEUE(2006.031,"C",PLACE,TYPE,0)),0)),"^",2)
"RTN","MAGQBJHR",24,0)
 D SL("Current JBTOHD queue: "_INDEX_" "_$P($G(^MAGQUEUE(2006.03,INDEX,0)),"^",4),2)
"RTN","MAGQBJHR",25,0)
 F  S INDEX=$O(^MAGQUEUE(2006.03,"C",PLACE,TYPE,INDEX)) Q:INDEX'?1N.N  D
"RTN","MAGQBJHR",26,0)
 . S NODE=$G(^MAGQUEUE(2006.03,INDEX,0))
"RTN","MAGQBJHR",27,0)
 . Q:NODE=""
"RTN","MAGQBJHR",28,0)
 . S SUBTYPE=$P(NODE,"^",8),PDUZ=+$P(NODE,"^",2),IEN=$P(NODE,"^",7)
"RTN","MAGQBJHR",29,0)
 . S PAT=+$P($G(^MAG(2005,IEN,0)),"^",7)
"RTN","MAGQBJHR",30,0)
 . S:'$D(^TMP("MAGQJDE",$J,PDUZ,0,PAT,0)) ^TMP("MAGQJDE",$J,PDUZ,0,PAT,0)=INDEX
"RTN","MAGQBJHR",31,0)
 . S ^TMP("MAGQJDE",$J,PDUZ,0,PAT)=+$G(^TMP("MAGQJDE",$J,PDUZ,0,PAT))+1
"RTN","MAGQBJHR",32,0)
 . S ^TMP("MAGQJDE",$J,PDUZ,0)=+$G(^TMP("MAGQJDE",$J,PDUZ,0))+1
"RTN","MAGQBJHR",33,0)
 . S ^TMP("MAGQJDE",$J,PDUZ,SUBTYPE)=+$G(^TMP("MAGQJDE",$J,PDUZ,SUBTYPE))+1
"RTN","MAGQBJHR",34,0)
 ;Reporting
"RTN","MAGQBJHR",35,0)
 S INDEX=""
"RTN","MAGQBJHR",36,0)
 N TITLE
"RTN","MAGQBJHR",37,0)
 F  S INDEX=$O(^TMP("MAGQJDE",$J,INDEX)) Q:INDEX'?1N.N  D
"RTN","MAGQBJHR",38,0)
 . S QUEUER=$$GET1^DIQ(200,INDEX,.01)
"RTN","MAGQBJHR",39,0)
 . Q:QUEUER=""
"RTN","MAGQBJHR",40,0)
 . D SL("Image Queuer: "_QUEUER,2)
"RTN","MAGQBJHR",41,0)
 . S TITLE=$$GET1^DIQ(200,INDEX,20.3)
"RTN","MAGQBJHR",42,0)
 . S:TITLE="" TITLE=$$GET1^DIQ(200,INDEX,8)
"RTN","MAGQBJHR",43,0)
 . D SL("  "_TITLE_"-"_$$GET1^DIQ(200,INDEX,29),1)
"RTN","MAGQBJHR",44,0)
 . D SL("  "_"Number of Queues: "_^TMP("MAGQJDE",$J,INDEX,0),1)
"RTN","MAGQBJHR",45,0)
 . D SESS(QUEUER,.SESS)
"RTN","MAGQBJHR",46,0)
 . N INDX S INDX=""
"RTN","MAGQBJHR",47,0)
 . F  S INDX=$O(SESS(INDX)) Q:INDX'?1N.N  D
"RTN","MAGQBJHR",48,0)
 . . D SL("  Today's WS logins: "_$P(SESS(INDX),"^")_" Display Version: "_$P(SESS(INDX),"^",2),1)
"RTN","MAGQBJHR",49,0)
 . S INDX=$O(^MAG(2006.19,"AC",INDEX,""))
"RTN","MAGQBJHR",50,0)
 . I INDX?1N.N D SL("  Queuer's View of Jukebox images: "_$S($P(^MAG(2006.19,INDX,0),"^",6)=1:"true",1:"false"),1)
"RTN","MAGQBJHR",51,0)
 . D SUBT(INDEX)
"RTN","MAGQBJHR",52,0)
 . D PATIN(INDEX)
"RTN","MAGQBJHR",53,0)
 . D SL(" ",1)
"RTN","MAGQBJHR",54,0)
 K ^TMP("MAGQJDE")
"RTN","MAGQBJHR",55,0)
 Q
"RTN","MAGQBJHR",56,0)
SL(LINE,CR) ;
"RTN","MAGQBJHR",57,0)
 S CNT=CNT+1
"RTN","MAGQBJHR",58,0)
 S RESULT(CNT)=LINE
"RTN","MAGQBJHR",59,0)
 Q
"RTN","MAGQBJHR",60,0)
SESS(ID,SESS) ;
"RTN","MAGQBJHR",61,0)
 N INDX,NODE,TODAY,DONE,WS,WSNODE
"RTN","MAGQBJHR",62,0)
 K SESS
"RTN","MAGQBJHR",63,0)
 S INDX=" ",DONE=0
"RTN","MAGQBJHR",64,0)
 D NOW^%DTC S TODAY=$P(%,".")
"RTN","MAGQBJHR",65,0)
 F  S INDX=$O(^MAG(2006.82,"B",+ID,INDX),-1) Q:INDX'?1N.N  D  Q:DONE
"RTN","MAGQBJHR",66,0)
 . S NODE=$G(^MAG(2006.82,INDX,0))
"RTN","MAGQBJHR",67,0)
 . I $P($P(NODE,"^",3),".")<TODAY S DONE=1 Q
"RTN","MAGQBJHR",68,0)
 . S WS=$P(NODE,"^",5)
"RTN","MAGQBJHR",69,0)
 . S WSNODE=$G(^MAG(2006.81,WS,0))
"RTN","MAGQBJHR",70,0)
 . S SESS(WS)=$P(WSNODE,"^")_"^"_$P(WSNODE,"^",9)
"RTN","MAGQBJHR",71,0)
 Q
"RTN","MAGQBJHR",72,0)
PATIN(MD) ;
"RTN","MAGQBJHR",73,0)
 N PID
"RTN","MAGQBJHR",74,0)
 S PID=0
"RTN","MAGQBJHR",75,0)
 F  S PID=$O(^TMP("MAGQJDE",$J,MD,0,PID)) Q:PID'?1N.N  D
"RTN","MAGQBJHR",76,0)
 . D SL("  Patient: "_$P($G(^DPT(PID,0)),"^")_" - "_$G(^TMP("MAGQJDE",$J,MD,0,PID,0)),1)
"RTN","MAGQBJHR",77,0)
 Q
"RTN","MAGQBJHR",78,0)
SUBT(MD) ;
"RTN","MAGQBJHR",79,0)
 N SUBTYPE
"RTN","MAGQBJHR",80,0)
 S SUBTYPE=0
"RTN","MAGQBJHR",81,0)
 F  S SUBTYPE=$O(^TMP("MAGQJDE",$J,MD,SUBTYPE)) Q:SUBTYPE=""  D
"RTN","MAGQBJHR",82,0)
 . D SL("  Number of "_SUBTYPE_" : "_^TMP("MAGQJDE",$J,MD,SUBTYPE),1)
"RTN","MAGQBJHR",83,0)
 Q
"RTN","MAGQBPG1")
0^9^B74002571
"RTN","MAGQBPG1",1,0)
MAGQBPG1 ;WOIFO/RMP - REMOTE Task SERVER Program [ 11/08/2001 17:18 ]
"RTN","MAGQBPG1",2,0)
 ;;3.0;IMAGING;**7,8,20**;Apr 12, 2006
"RTN","MAGQBPG1",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBPG1",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBPG1",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBPG1",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBPG1",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBPG1",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBPG1",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBPG1",10,0)
 ;; |                                                               |
"RTN","MAGQBPG1",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBPG1",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBPG1",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBPG1",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBPG1",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBPG1",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBPG1",17,0)
 ;;
"RTN","MAGQBPG1",18,0)
ENTRY(RESULT,WSTAT,PROCESS) ;RPC[MAGQ JBS]
"RTN","MAGQBPG1",19,0)
 N X,SYSIEN,SYSNAME,ZNODE,NODE,INDX,CNT,PROC,%,QPTR,QCNT,SHARE,PLACE
"RTN","MAGQBPG1",20,0)
 D NOW^%DTC
"RTN","MAGQBPG1",21,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBPG1",22,0)
 S (SYSIEN,CNT)=0,SYSNAME="",U="^",PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBPG1",23,0)
 S SYSIEN=$O(^MAG(2006.8,"C",WSTAT,"")) ;TRUE WORKSTATION NAME
"RTN","MAGQBPG1",24,0)
 I 'SYSIEN S SYSIEN=$O(^MAG(2006.8,"C",$$UPPER^MAGQE4(WSTAT),""))
"RTN","MAGQBPG1",25,0)
 I 'SYSIEN D  ;ATTEMPT TO FIND A MATCH FROM LOCAL NAME
"RTN","MAGQBPG1",26,0)
 . N TRY
"RTN","MAGQBPG1",27,0)
 . F TRY=1:1:$L(WSTAT,".") D  Q:SYSIEN?1N.N
"RTN","MAGQBPG1",28,0)
 . . S SYSIEN=$O(^MAG(2006.8,"C",$P(WSTAT,".",TRY),""))
"RTN","MAGQBPG1",29,0)
 . . I 'SYSIEN S SYSIEN=$O(^MAG(2006.8,"C",$$UPPER^MAGQE4($P(WSTAT,".",TRY)),""))
"RTN","MAGQBPG1",30,0)
 I SYSIEN="" D  Q
"RTN","MAGQBPG1",31,0)
 . S RESULT(0)="-1^This workstation is not currently setup as a Background Processor."
"RTN","MAGQBPG1",32,0)
 . Q
"RTN","MAGQBPG1",33,0)
 S NODE=^MAG(2006.8,SYSIEN,0)
"RTN","MAGQBPG1",34,0)
 S SYSNAME=$P(NODE,U)
"RTN","MAGQBPG1",35,0)
 I SYSNAME="" D  Q
"RTN","MAGQBPG1",36,0)
 . S RESULT(0)="-1^This workstation is not currently setup as a Background Processor."
"RTN","MAGQBPG1",37,0)
 . Q
"RTN","MAGQBPG1",38,0)
 S RESULT(0)="0^BP List^PID: "_$$BASE^XLFUTL($J,10,16)_U_SYSNAME_U_WSTAT_U_$P(^MAG(2006.1,PLACE,0),U,2)
"RTN","MAGQBPG1",39,0)
 S (X,CNT)=0
"RTN","MAGQBPG1",40,0)
 F  S X=$O(^MAG(2005.2,X)) Q:X'?1N.N  S ZNODE=^(X,0) D
"RTN","MAGQBPG1",41,0)
 . Q:'$P(ZNODE,U,6)  ;1=on-line
"RTN","MAGQBPG1",42,0)
 . Q:$E($P(ZNODE,U,2),1,2)'="\\"
"RTN","MAGQBPG1",43,0)
 . Q:$P(ZNODE,U,10)'=PLACE
"RTN","MAGQBPG1",44,0)
 . Q:(($P(ZNODE,U,7)'["WORM")&($P(ZNODE,U,7)'="RW"))
"RTN","MAGQBPG1",45,0)
 . S CNT=CNT+1,SHARE=$P(ZNODE,U,2)
"RTN","MAGQBPG1",46,0)
 . I $E(SHARE,$L(SHARE))="\" S SHARE=$E(SHARE,1,$L(SHARE)-1)
"RTN","MAGQBPG1",47,0)
 . S RESULT(CNT)=X_U_SHARE_U_$P(ZNODE,U,8)
"RTN","MAGQBPG1",48,0)
 Q
"RTN","MAGQBPG1",49,0)
JBPTR(RESULT,FILE) ;[MAGQ JBPTR]
"RTN","MAGQBPG1",50,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBPG1",51,0)
 N IEN,SITEID
"RTN","MAGQBPG1",52,0)
 S SITEID=$$UPPER^MAGQE4($P(^MAG(2006.1,$$PLACE^MAGBAPI(+$G(DUZ(2))),0),U,2))
"RTN","MAGQBPG1",53,0)
 S IEN=$P(+$P(FILE,SITEID,2),".")
"RTN","MAGQBPG1",54,0)
 S RESULT=$$JBPTR^MAGQBPRG(IEN,$$FTYPE^MAGQBPRG($P(FILE,".",2)))
"RTN","MAGQBPG1",55,0)
 Q
"RTN","MAGQBPG1",56,0)
SHR(RESULT) ; RPC[MAGQ SHARES]
"RTN","MAGQBPG1",57,0)
 N TMP,INDX,DATA,CNT,SHARE,CWL,VALUE,PLACE ;CWL=CURRENT WRITE LOCATION
"RTN","MAGQBPG1",58,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBPG1",59,0)
 S (CNT,INDX)=0,U="^",PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBPG1",60,0)
 S CWL=$$CWL^MAGBAPI(PLACE)
"RTN","MAGQBPG1",61,0)
 F  S INDX=$O(^MAG(2005.2,INDX)) Q:INDX'?1N.N  D
"RTN","MAGQBPG1",62,0)
 . S DATA=$G(^MAG(2005.2,INDX,0))
"RTN","MAGQBPG1",63,0)
 . Q:$P(DATA,U,6,7)'["1^MAG"
"RTN","MAGQBPG1",64,0)
 . Q:$P(DATA,U,9)="1"  ;ROUTING SHARE
"RTN","MAGQBPG1",65,0)
 . Q:$P(DATA,U,2)[":"
"RTN","MAGQBPG1",66,0)
 . Q:$P(DATA,U,10)'=PLACE
"RTN","MAGQBPG1",67,0)
 . S SHARE=$P(DATA,U,2)
"RTN","MAGQBPG1",68,0)
 . Q:$E(SHARE,1,2)'="\\"
"RTN","MAGQBPG1",69,0)
 . I $E(SHARE,$L(SHARE))="\" S SHARE=$E(SHARE,1,$L(SHARE)-1)
"RTN","MAGQBPG1",70,0)
 . S SHARE=SHARE_U_$P(DATA,U,8)
"RTN","MAGQBPG1",71,0)
 . Q:$D(TMP(SHARE))
"RTN","MAGQBPG1",72,0)
 . S TMP(SHARE)=INDX
"RTN","MAGQBPG1",73,0)
 S INDX=""
"RTN","MAGQBPG1",74,0)
 F  S INDX=$O(TMP(INDX)) Q:INDX=""  D
"RTN","MAGQBPG1",75,0)
 . S RESULT(CNT)=TMP(INDX)_U_INDX,CNT=CNT+1
"RTN","MAGQBPG1",76,0)
 . S ^TMP("MAGQBP",$J,"SHRLST",CNT-1)=TMP(INDX)_U_INDX
"RTN","MAGQBPG1",77,0)
 K TMP
"RTN","MAGQBPG1",78,0)
 Q
"RTN","MAGQBPG1",79,0)
CNP2(RESULT,IEN,START,STOP) ;[MAGQ JBSCN]
"RTN","MAGQBPG1",80,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBPG1",81,0)
 N FNAME,PIECE,ZNODE,NODE2,BNODE,BNAME,PTR,HASH,TEMP,ORDER,RDATE,PLACE,OFFLINE,PLACEOK,GL,END
"RTN","MAGQBPG1",82,0)
 S (RESULT,GL)="",PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2))),(OFFLINE,PLACEOK)=0
"RTN","MAGQBPG1",83,0)
 S:START="" START=$O(^MAG(2005,0)) S:STOP="" STOP=$O(^MAG(2005,"A"),-1)
"RTN","MAGQBPG1",84,0)
 S ORDER=$S(START>STOP:"R",1:"F")
"RTN","MAGQBPG1",85,0)
 I (IEN'?1N.N)!IEN=0 D  I IEN="" S RESULT=0 Q
"RTN","MAGQBPG1",86,0)
 . I START=0 S IEN=START Q
"RTN","MAGQBPG1",87,0)
 . I ORDER="R" D
"RTN","MAGQBPG1",88,0)
 . . S I1=+$O(^MAG(2005," "),-1),I2=+$O(^MAG(2005.1," "),-1),END=$S(I1>I2:I1,1:I2)
"RTN","MAGQBPG1",89,0)
 . . S IEN=$S(START>END:START,1:START+1) Q
"RTN","MAGQBPG1",90,0)
 . E  S IEN=START-1
"RTN","MAGQBPG1",91,0)
 . Q
"RTN","MAGQBPG1",92,0)
 S IEN=+IEN
"RTN","MAGQBPG1",93,0)
 F  D SCAN^MAGQBPG1(.IEN,ORDER,.GL) D  Q:((('OFFLINE)&PLACEOK)!('IEN)!($P(RESULT,U,21)="DUPE"))
"RTN","MAGQBPG1",94,0)
 . Q:'IEN
"RTN","MAGQBPG1",95,0)
 . S ZNODE=$G(@(GL_IEN_",0)"))
"RTN","MAGQBPG1",96,0)
 . S PLACEOK=$S($P($G(@(GL_IEN_",100)")),U,3)=$G(DUZ(2)):1,1:"")
"RTN","MAGQBPG1",97,0)
 . I $P(ZNODE,U,2)'="" S OFFLINE=$$IMOFFLN^MAGFILEB($P(ZNODE,U,2))  ; Only check the offline status of image files
"RTN","MAGQBPG1",98,0)
 . I ($D(^MAG(2005.1,IEN,0))&$D(^MAG(2005,IEN,0))) D  Q  ; Image is duplicated in the Archive file
"RTN","MAGQBPG1",99,0)
 . . I $P(^MAG(2005,IEN,0),U,1,8)="^^^^^^^",+$P(^MAG(2005,IEN,0),U,9) K ^MAG(2005,IEN,0) Q
"RTN","MAGQBPG1",100,0)
 . . S FDA(2005,IEN_",",13.5)="1" ; Set Dupe field in the Image File 
"RTN","MAGQBPG1",101,0)
 . . S FDA(2005,IEN_",",13)="1" ; Set IQ field in the Image File  
"RTN","MAGQBPG1",102,0)
 . . D FILE^DIE("I","FDA","MSG") K FDA,MSG
"RTN","MAGQBPG1",103,0)
 . . S FDA(2005.1,IEN_",",13.5)="1" ; Set the Dupe field in the archive file
"RTN","MAGQBPG1",104,0)
 . . S FDA(2005.1,IEN_",",13)="1" ; and set the IQ field in the archive file
"RTN","MAGQBPG1",105,0)
 . . D FILE^DIE("I","FDA","MSG") K FDA,MSG
"RTN","MAGQBPG1",106,0)
 . . S $P(RESULT,U,21)="DUPE"
"RTN","MAGQBPG1",107,0)
 . . S $P(RESULT,U)=IEN
"RTN","MAGQBPG1",108,0)
 . . I $P(ZNODE,U,2)=$P($G(^MAG(2005.1,IEN,0)),U,2) S $P(RESULT,U,2)=$P(ZNODE,U,2) D
"RTN","MAGQBPG1",109,0)
 . . . I $P(RESULT,U,2)="" S $P(RESULT,U,2)="No File Name" Q
"RTN","MAGQBPG1",110,0)
 . . E  S $P(RESULT,U,2)=$P(ZNODE,U,2)_"/"_$P($G(^MAG(2005.1,IEN,0)),U,2) D
"RTN","MAGQBPG1",111,0)
 . . . I $P($P(RESULT,U,2),"/")="" S $P(RESULT,U,2)="No File Name"_$P(RESULT,U,2)
"RTN","MAGQBPG1",112,0)
 . . . I $P($P(RESULT,U,2),"/",2)="" S $P(RESULT,U,2)=$P(RESULT,U,2)_"No File Name"
"RTN","MAGQBPG1",113,0)
 . . . Q
"RTN","MAGQBPG1",114,0)
 . . Q
"RTN","MAGQBPG1",115,0)
 . E  I $P(ZNODE,U,2)'="" S $P(@(GL_IEN_",0)"),U,12)="0"
"RTN","MAGQBPG1",116,0)
 . Q
"RTN","MAGQBPG1",117,0)
 I $S('IEN:1,((ORDER="F")&(IEN>STOP)):1,((ORDER="R")&(IEN<STOP)):1,1:0) D  Q
"RTN","MAGQBPG1",118,0)
 . S RESULT=0
"RTN","MAGQBPG1",119,0)
 . Q
"RTN","MAGQBPG1",120,0)
 S FNAME=$P(ZNODE,U,2)
"RTN","MAGQBPG1",121,0)
 S $P(RESULT,U)=IEN
"RTN","MAGQBPG1",122,0)
 Q:($P(RESULT,U,21)="DUPE")
"RTN","MAGQBPG1",123,0)
 S $P(RESULT,U,19)=$P($P($G(@(GL_IEN_",2)")),U),".")
"RTN","MAGQBPG1",124,0)
 I $P(ZNODE,U,2)'="" D  ;NON-GROUP PARENT
"RTN","MAGQBPG1",125,0)
 . S BNODE=$G(@(GL_IEN_",""FBIG"")"))
"RTN","MAGQBPG1",126,0)
 . I $P(ZNODE,U,5)?1N.N S $P(RESULT,U,3)=$P(ZNODE,U,5)
"RTN","MAGQBPG1",127,0)
 . S:$P(BNODE,U,2)?1N.N $P(RESULT,U,4)=$P(BNODE,U,2)
"RTN","MAGQBPG1",128,0)
 . S:$P(ZNODE,U,3)?1N.N $P(RESULT,U,5)=$P(ZNODE,U,3)
"RTN","MAGQBPG1",129,0)
 . S:$P(ZNODE,U,4)?1N.N $P(RESULT,U,6)=$P(ZNODE,U,4)
"RTN","MAGQBPG1",130,0)
 . S:$P(BNODE,U)?1N.N $P(RESULT,U,7)=$P(BNODE,U)
"RTN","MAGQBPG1",131,0)
 . S $P(RESULT,U,8)=$$CWL^MAGBAPI(PLACE)
"RTN","MAGQBPG1",132,0)
 . S $P(RESULT,U,2)=FNAME
"RTN","MAGQBPG1",133,0)
 . I $D(@(GL_IEN_",""FBIG"")")),'$P(BNODE,U),'$P(BNODE,U,2) S $P(RESULT,U,22)="EMPTY_FBIG"
"RTN","MAGQBPG1",134,0)
 . Q
"RTN","MAGQBPG1",135,0)
 I GL[("^MAG(2005.1,") S $P(RESULT,U,21)="ARCH"
"RTN","MAGQBPG1",136,0)
 E  S $P(RESULT,U,12,17)=$$CHKIMG^MAGQBUT2(IEN)
"RTN","MAGQBPG1",137,0)
 Q
"RTN","MAGQBPG1",138,0)
JPUD(RESULT,JPTR,EXT,IEN) ; RPC[MAGQ JPUD]
"RTN","MAGQBPG1",139,0)
 N TYPE,PIECE,NODE,GL
"RTN","MAGQBPG1",140,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP"),RESULT="0"
"RTN","MAGQBPG1",141,0)
 S TYPE=$$FTYPE^MAGQBPRG(EXT)
"RTN","MAGQBPG1",142,0)
 S PIECE=$S(TYPE="BIG":2,1:5)
"RTN","MAGQBPG1",143,0)
 S NODE=$S(TYPE="BIG":"FBIG",1:0)
"RTN","MAGQBPG1",144,0)
 I JPTR="0" D  Q:(RESULT<0)
"RTN","MAGQBPG1",145,0)
 . S JPTR=""
"RTN","MAGQBPG1",146,0)
 . S GL=$S($D(^MAG(2005,IEN)):"^MAG(2005,",$D(^MAG(2005.1,IEN)):"^MAG(2005.1,",1:0)
"RTN","MAGQBPG1",147,0)
 . I GL=0 S RESULT="-1" Q
"RTN","MAGQBPG1",148,0)
 . I $D(^MAGQUEUE(2006.033,"B",$P($G(@(GL_IEN_",0)")),U,2))) D  Q
"RTN","MAGQBPG1",149,0)
 . . S RESULT=-2 Q  ;Don't clear the JB pointer if image is on an Off-line Platter
"RTN","MAGQBPG1",150,0)
 . . Q
"RTN","MAGQBPG1",151,0)
 . Q
"RTN","MAGQBPG1",152,0)
 S:$D(^MAG(2005,IEN,NODE)) $P(^MAG(2005,IEN,NODE),U,PIECE)=JPTR
"RTN","MAGQBPG1",153,0)
 S:$D(^MAG(2005.1,IEN,NODE)) $P(^MAG(2005.1,IEN,NODE),U,PIECE)=JPTR
"RTN","MAGQBPG1",154,0)
 S RESULT="1"
"RTN","MAGQBPG1",155,0)
 Q
"RTN","MAGQBPG1",156,0)
VCUD(RESULT,VCPTR,EXT,IEN) ; RPC[MAGQ VCUD]
"RTN","MAGQBPG1",157,0)
 N TYPE,PIECE,NODE
"RTN","MAGQBPG1",158,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP"),RESULT="0"
"RTN","MAGQBPG1",159,0)
 S TYPE=$$FTYPE^MAGQBPRG(EXT)
"RTN","MAGQBPG1",160,0)
 S PIECE=$S(TYPE="BIG":1,TYPE="ABS":4,1:3)
"RTN","MAGQBPG1",161,0)
 S NODE=$S(TYPE="BIG":"FBIG",1:0)
"RTN","MAGQBPG1",162,0)
 S:VCPTR="0" VCPTR=""
"RTN","MAGQBPG1",163,0)
 S:$D(^MAG(2005,IEN,NODE)) $P(^MAG(2005,IEN,NODE),U,PIECE)=VCPTR
"RTN","MAGQBPG1",164,0)
 S:$D(^MAG(2005.1,IEN,NODE)) $P(^MAG(2005.1,IEN,NODE),U,PIECE)=VCPTR
"RTN","MAGQBPG1",165,0)
 S RESULT="1"
"RTN","MAGQBPG1",166,0)
 Q
"RTN","MAGQBPG1",167,0)
DFNIQ(RESULT,INPUT,SEND) ;
"RTN","MAGQBPG1",168,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBPG1",169,0)
 N LOC,CNT,Y
"RTN","MAGQBPG1",170,0)
 S U="^"
"RTN","MAGQBPG1",171,0)
 S CNT=+$O(^TMP($J,"MAGQDFN",""),-1)
"RTN","MAGQBPG1",172,0)
 I CNT<2 D
"RTN","MAGQBPG1",173,0)
 . D NOW^%DTC S Y=% D DD^%DT
"RTN","MAGQBPG1",174,0)
 . S LOC=$$KSP^XUPARAM("WHERE")
"RTN","MAGQBPG1",175,0)
 . S ^TMP($J,"MAGQDFN",1)="            SITE: "_LOC
"RTN","MAGQBPG1",176,0)
 . S ^TMP($J,"MAGQDFN",2)="            DATE: "_Y_" "_$G(^XMB("TIMEZONE"))
"RTN","MAGQBPG1",177,0)
 . S CNT=2
"RTN","MAGQBPG1",178,0)
 . Q
"RTN","MAGQBPG1",179,0)
 I SEND="1" D
"RTN","MAGQBPG1",180,0)
 . S XMSUB=INPUT
"RTN","MAGQBPG1",181,0)
 . N XMY,XMTEXT
"RTN","MAGQBPG1",182,0)
 . S XMTEXT="^TMP($J,""MAGQDFN"","
"RTN","MAGQBPG1",183,0)
 . S XMY("G.MAG SERVER")=""
"RTN","MAGQBPG1",184,0)
 . S:$G(DUZ) XMY(DUZ)=""
"RTN","MAGQBPG1",185,0)
 . D ^XMD
"RTN","MAGQBPG1",186,0)
 . K ^TMP($J,"MAGQDFN")
"RTN","MAGQBPG1",187,0)
 . Q
"RTN","MAGQBPG1",188,0)
 E  S CNT=CNT+1,^TMP($J,"MAGQDFN",CNT)=INPUT
"RTN","MAGQBPG1",189,0)
 S RESULT="1"
"RTN","MAGQBPG1",190,0)
 Q
"RTN","MAGQBPG1",191,0)
MOVE(RESULT,FNAM) ;[MAGQ MOVE]
"RTN","MAGQBPG1",192,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBPG1",193,0)
 N IEN,FTYPE,NMSPC,SITEID,EXT,ALT,J
"RTN","MAGQBPG1",194,0)
 S NMSPC=$TR($P(FNAM,"."),"0123456789","")
"RTN","MAGQBPG1",195,0)
 S SITEID=$$INIS^MAGQBPG2($$PLACE^MAGBAPI(+DUZ(2)))
"RTN","MAGQBPG1",196,0)
 I SITEID'[(","_NMSPC_",") D  Q
"RTN","MAGQBPG1",197,0)
 . S RESULT="0^Invalid Imaging Namespace"
"RTN","MAGQBPG1",198,0)
 S IEN=$O(^MAG(2005,"F",$P(FNAM,"."),""))
"RTN","MAGQBPG1",199,0)
 I IEN'?1N.N!('$D(^MAG(2005,IEN,0))) D  Q
"RTN","MAGQBPG1",200,0)
 . S RESULT="0^No matching 2005 entry"
"RTN","MAGQBPG1",201,0)
 S EXT=$P(FNAM,".",2)
"RTN","MAGQBPG1",202,0)
 I $P($G(^MAG(2005,IEN,0)),U,2)[FNAM S RESULT=IEN_U_"FULL"
"RTN","MAGQBPG1",203,0)
 E  D
"RTN","MAGQBPG1",204,0)
 . S FTYPE=$$FTYPE^MAGQBPRG(EXT)
"RTN","MAGQBPG1",205,0)
 . I FTYPE="FULL" D  Q
"RTN","MAGQBPG1",206,0)
 . . D FTYPE^MAGQBUT(.ALT)
"RTN","MAGQBPG1",207,0)
 . . S J=""
"RTN","MAGQBPG1",208,0)
 . . F  S J=$O(ALT(J)) Q:J'?1N.N  S:ALT(J)[EXT FTYPE="ALT"
"RTN","MAGQBPG1",209,0)
 . . I FTYPE["ALT" S RESULT=IEN_U_FTYPE
"RTN","MAGQBPG1",210,0)
 . . E  S RESULT="0^Invalid File Extension"
"RTN","MAGQBPG1",211,0)
 . E  S RESULT=IEN_U_FTYPE
"RTN","MAGQBPG1",212,0)
 Q
"RTN","MAGQBPG1",213,0)
SCAN(IEN,ORDER,GB) ; Find the next image spanning the Image and the Image Archive file
"RTN","MAGQBPG1",214,0)
 I IEN,GB="^MAG(2005,",$D(^MAG(2005.1,IEN)) D  Q
"RTN","MAGQBPG1",215,0)
 . S IEN=IEN,GB="^MAG(2005.1," Q
"RTN","MAGQBPG1",216,0)
 N I1,I2
"RTN","MAGQBPG1",217,0)
 I $G(ORDER)="F" D 
"RTN","MAGQBPG1",218,0)
 . S I1=$O(^MAG(2005,IEN)),I1=$S(I1:I1,1:"")
"RTN","MAGQBPG1",219,0)
 . S I2=$O(^MAG(2005.1,IEN)),I2=$S(I2:I2,1:"")
"RTN","MAGQBPG1",220,0)
 . I I1,'I2 S IEN=I1,GB="^MAG(2005," Q
"RTN","MAGQBPG1",221,0)
 . I I2,'I1 S IEN=I2,GB="^MAG(2005.1," Q
"RTN","MAGQBPG1",222,0)
 . S GB=$S(I1>I2:"^MAG(2005.1,",1:"^MAG(2005,")
"RTN","MAGQBPG1",223,0)
 . S IEN=$S(I1>I2:I2,1:I1)
"RTN","MAGQBPG1",224,0)
 . Q
"RTN","MAGQBPG1",225,0)
 E  D  ;Reverse
"RTN","MAGQBPG1",226,0)
 . S I1=$O(^MAG(2005,IEN),-1),I1=$S(I1:I1,1:"")
"RTN","MAGQBPG1",227,0)
 . S I2=$O(^MAG(2005.1,IEN),-1),I2=$S(I2:I2,1:"")
"RTN","MAGQBPG1",228,0)
 . I I1,'I2 S IEN=I1,GB="^MAG(2005," Q
"RTN","MAGQBPG1",229,0)
 . I I2,'I1 S IEN=I2,GB="^MAG(2005.1," Q
"RTN","MAGQBPG1",230,0)
 . S GB=$S(I1<I2:"^MAG(2005.1,",1:"^MAG(2005,")
"RTN","MAGQBPG1",231,0)
 . S IEN=$S(I1<I2:I2,1:I1)
"RTN","MAGQBPG1",232,0)
 . Q
"RTN","MAGQBPG1",233,0)
 S IEN=$S('IEN:"",1:IEN)
"RTN","MAGQBPG1",234,0)
 Q
"RTN","MAGQBPG2")
0^10^B20522184
"RTN","MAGQBPG2",1,0)
MAGQBPG2 ;WCIOFO - TS RMP Magnetic Server Purge processes [ 06/29/2001 18:28 ]
"RTN","MAGQBPG2",2,0)
 ;;3.0;IMAGING;**8,20**;Apr 12, 2006
"RTN","MAGQBPG2",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBPG2",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBPG2",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBPG2",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBPG2",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBPG2",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBPG2",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBPG2",10,0)
 ;; |                                                               |
"RTN","MAGQBPG2",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBPG2",12,0)
 ;; | a medical device.  As such, it may not be changed in any way  |
"RTN","MAGQBPG2",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBPG2",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBPG2",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBPG2",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBPG2",17,0)
 ;;
"RTN","MAGQBPG2",18,0)
CNP(RESULT,IEN) ; [MAGQ PCHKN]
"RTN","MAGQBPG2",19,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBPG2",20,0)
 N FNAME,PIECE,ZNODE,BNODE,BNAME,PTR,HASH
"RTN","MAGQBPG2",21,0)
 S IEN=+IEN,RESULT="^^^",U="^"
"RTN","MAGQBPG2",22,0)
 F  S IEN=$O(^MAG(2005,IEN)) Q:IEN'?1N.N  D  Q:RESULT'="^^^"
"RTN","MAGQBPG2",23,0)
 . S ZNODE=$G(^MAG(2005,IEN,0))
"RTN","MAGQBPG2",24,0)
 . S FNAME=$P(ZNODE,U,2)
"RTN","MAGQBPG2",25,0)
 . I (FNAME["\")!(FNAME[":") D
"RTN","MAGQBPG2",26,0)
 . . S FNAME=$$FNX(FNAME)
"RTN","MAGQBPG2",27,0)
 . . S $P(^MAG(2005,IEN,0),U,2)=FNAME
"RTN","MAGQBPG2",28,0)
 . Q:$P(ZNODE,U,2)=""  ;PROBABLE GROUP HEAD
"RTN","MAGQBPG2",29,0)
 . S BNODE=$G(^MAG(2005,IEN,"FBIG"))
"RTN","MAGQBPG2",30,0)
 . S PTR=$P(ZNODE,U,3) I PTR?1N.N D
"RTN","MAGQBPG2",31,0)
 . . S HASH=$P(^MAG(2005.2,PTR,0),U,8)
"RTN","MAGQBPG2",32,0)
 . . S $P(^MAG(2005,IEN,0),U,3)=$$SHNAM^MAGQBPRG($P(^MAG(2005.2,PTR,0),U,2),HASH)
"RTN","MAGQBPG2",33,0)
 . . S $P(RESULT,"^")=$$JBPATH^MAGQBPRG(FNAME,PTR)
"RTN","MAGQBPG2",34,0)
 . S PTR=$P(ZNODE,U,4) I PTR?1N.N D
"RTN","MAGQBPG2",35,0)
 . . S HASH=$P(^MAG(2005.2,PTR,0),U,8)
"RTN","MAGQBPG2",36,0)
 . . S $P(^MAG(2005,IEN,0),U,4)=$$SHNAM^MAGQBPRG($P(^MAG(2005.2,PTR,0),U,2),HASH)
"RTN","MAGQBPG2",37,0)
 . . S $P(RESULT,U,2)=$$JBPATH^MAGQBPRG($P(FNAME,".")_".ABS",PTR)
"RTN","MAGQBPG2",38,0)
 . S PTR=$P(BNODE,U) I PTR?1N.N D
"RTN","MAGQBPG2",39,0)
 . . S HASH=$P(^MAG(2005.2,PTR,0),U,8)
"RTN","MAGQBPG2",40,0)
 . . S $P(^MAG(2005,IEN,"FBIG"),U)=$$SHNAM^MAGQBPRG($P(^MAG(2005.2,PTR,0),U,2),HASH)
"RTN","MAGQBPG2",41,0)
 . . S BNAME=$P(FNAME,".")_".BIG"
"RTN","MAGQBPG2",42,0)
 . . S $P(RESULT,"^",3)=$$JBPATH^MAGQBPRG(BNAME,PTR)
"RTN","MAGQBPG2",43,0)
 . I RESULT'="^^^" S $P(RESULT,U,4)=IEN  ;IEN
"RTN","MAGQBPG2",44,0)
 Q
"RTN","MAGQBPG2",45,0)
FNX(NAME) ;FIX FILENAME
"RTN","MAGQBPG2",46,0)
 I NAME[":" S NAME=$P(NAME,":",$L(NAME,":"))
"RTN","MAGQBPG2",47,0)
 I NAME["\" S NAME=$P(NAME,"\",$L(NAME,"\"))
"RTN","MAGQBPG2",48,0)
 Q NAME
"RTN","MAGQBPG2",49,0)
CNPT ;
"RTN","MAGQBPG2",50,0)
 N IEN,RESULT,%
"RTN","MAGQBPG2",51,0)
 S IEN=0
"RTN","MAGQBPG2",52,0)
 D NOW^%DTC
"RTN","MAGQBPG2",53,0)
 F  D CNP(.RESULT,.IEN) W:RESULT[":" !,RESULT Q:IEN'?1N.N  D
"RTN","MAGQBPG2",54,0)
 . S IEN=$P(RESULT,"^",4)
"RTN","MAGQBPG2",55,0)
 Q
"RTN","MAGQBPG2",56,0)
PGEPAR(RESULT) ; RPC[MAGQBP PARM]
"RTN","MAGQBPG2",57,0)
 ;; RECORD PurgeParam
"RTN","MAGQBPG2",58,0)
 ;; Status^MinAbs^MinFull^MinBig^ABS^PACABS^FULL^PACS^BIG^PACSBIG^RADHOLD
"RTN","MAGQBPG2",59,0)
 ;; ^FilePrefix
"RTN","MAGQBPG2",60,0)
 ;; FULL:8,PACS:9,PACSBIG:21,BIG:22,ABS:23,ABSPACS:24,RADHOLDS:13
"RTN","MAGQBPG2",61,0)
 N ABS,FULL,PACSABS,PACS,BIG,PACSBIG,MINABS,MINFULL,MINBIG,PREFIX,NODE3
"RTN","MAGQBPG2",62,0)
 N FILE,PLACE,FIELD,FLAGS
"RTN","MAGQBPG2",63,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBPG2",64,0)
 S NODE3=$G(^MAG(2006.1,PLACE,3))
"RTN","MAGQBPG2",65,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBPG2",66,0)
 S U="^"
"RTN","MAGQBPG2",67,0)
 S FILE=2006.1,FIELD="8;9;13;21;22;23;24",FLAGS="E"
"RTN","MAGQBPG2",68,0)
 D GETS^DIQ(FILE,PLACE,FIELD,FLAGS,"ARR","ERR")
"RTN","MAGQBPG2",69,0)
 S FULL=+ARR(2006.1,PLACE_",",8,"E"),TFULL(FULL)=""
"RTN","MAGQBPG2",70,0)
 S ABS=+ARR(2006.1,PLACE_",",23,"E"),TABS(ABS)=""
"RTN","MAGQBPG2",71,0)
 S PACS=+ARR(2006.1,PLACE_",",9,"E"),TFULL(PACS)=""
"RTN","MAGQBPG2",72,0)
 S PACSABS=+ARR(2006.1,PLACE_",",24,"E"),TABS(PACSABS)=""
"RTN","MAGQBPG2",73,0)
 S PACSBIG=+ARR(2006.1,PLACE_",",21,"E"),TBIG(PACSBIG)=""
"RTN","MAGQBPG2",74,0)
 S BIG=+ARR(2006.1,PLACE_",",22,"E"),TBIG(BIG)=""
"RTN","MAGQBPG2",75,0)
 S MINABS=+$O(TABS(0)),MINFULL=+$O(TFULL(0)),MINBIG=+$O(TBIG(0))
"RTN","MAGQBPG2",76,0)
 S PREFIX=$$INIS(PLACE)
"RTN","MAGQBPG2",77,0)
 K TABS,TFULL,TBIG
"RTN","MAGQBPG2",78,0)
 S RESULT="1"_U_MINABS_U_MINFULL_U_MINBIG_U_ABS_U_PACSABS_U_FULL_U_PACS
"RTN","MAGQBPG2",79,0)
 S RESULT=RESULT_U_BIG_U_PACSBIG_U_+ARR(2006.1,PLACE_",",13,"E")_U_PREFIX
"RTN","MAGQBPG2",80,0)
 Q
"RTN","MAGQBPG2",81,0)
 ;;
"RTN","MAGQBPG2",82,0)
PGEUD(RESULT,FILENAME,EXT,IEN,DEVICE) ; RPC[MAGQBP UPDATE]
"RTN","MAGQBPG2",83,0)
 N FTYPE,NODE,PIECE,PLACE
"RTN","MAGQBPG2",84,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBPG2",85,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBPG2",86,0)
 S RESULT="0",FTYPE=$$FTYPE^MAGQBPRG(EXT)
"RTN","MAGQBPG2",87,0)
 ;I $P($G(^MAG(2006.1,PLACE,"JBEX")),U,5) D IMAGEDEL^MAGGTID(.RESULT,IEN) Q
"RTN","MAGQBPG2",88,0)
 S NODE=$S(FTYPE="BIG":"FBIG",1:0)
"RTN","MAGQBPG2",89,0)
 S:DEVICE="JB" PIECE=$S(FTYPE="ABS":5,FTYPE="BIG":2,FTYPE="FULL":5,1:0)
"RTN","MAGQBPG2",90,0)
 S:DEVICE="NET" PIECE=$S(FTYPE="ABS":4,FTYPE="BIG":1,FTYPE="FULL":3,1:0)
"RTN","MAGQBPG2",91,0)
 I PIECE=0 D ELOG^MAGQBPRG(NODE,FTYPE) Q
"RTN","MAGQBPG2",92,0)
 S RESULT="1"
"RTN","MAGQBPG2",93,0)
 S:$D(^MAG(2005,IEN,NODE)) $P(^MAG(2005,IEN,NODE),U,PIECE)=""
"RTN","MAGQBPG2",94,0)
 S:$D(^MAG(2005.1,IEN,NODE)) $P(^MAG(2005.1,IEN,NODE),U,PIECE)=""
"RTN","MAGQBPG2",95,0)
 Q
"RTN","MAGQBPG2",96,0)
INIS(PLACE) ;
"RTN","MAGQBPG2",97,0)
 N ARRY,CNT,SUB,RESULT
"RTN","MAGQBPG2",98,0)
 S ARRY($P($G(^MAG(2006.1,PLACE,0)),"^",2))=""
"RTN","MAGQBPG2",99,0)
 S CNT=0
"RTN","MAGQBPG2",100,0)
 F  S CNT=$O(^MAG(2006.1,PLACE,4,CNT)) Q:CNT'?1N.N  D
"RTN","MAGQBPG2",101,0)
 . S ARRY(^MAG(2006.1,PLACE,4,CNT,0))=""
"RTN","MAGQBPG2",102,0)
 S (SUB,RESULT)=""
"RTN","MAGQBPG2",103,0)
 F  S SUB=$O(ARRY(SUB)) Q:SUB=""  D
"RTN","MAGQBPG2",104,0)
 . S RESULT=$S(RESULT="":SUB,1:(RESULT_","_SUB))
"RTN","MAGQBPG2",105,0)
 K ARRY
"RTN","MAGQBPG2",106,0)
 Q RESULT
"RTN","MAGQBPRG")
0^11^B57111603
"RTN","MAGQBPRG",1,0)
MAGQBPRG ;WOIOFO/RMP Magnetic Server Purge processes [ 06/29/2001 18:28 ]
"RTN","MAGQBPRG",2,0)
 ;;3.0;IMAGING;**7,3,8,20**;Apr 12, 2006
"RTN","MAGQBPRG",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBPRG",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBPRG",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBPRG",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBPRG",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBPRG",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBPRG",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBPRG",10,0)
 ;; |                                                               |
"RTN","MAGQBPRG",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBPRG",12,0)
 ;; | a medical device.  As such, it may not be changed in any way  |
"RTN","MAGQBPRG",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBPRG",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBPRG",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBPRG",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBPRG",17,0)
 ;;
"RTN","MAGQBPRG",18,0)
FILEREF(RESULT,FILEPATH,FNAM,EXT,NETLOC,RADHOLD) ; RPC[MAGQBP FREF]
"RTN","MAGQBPRG",19,0)
 ;VALIDATES THAT THE FILEPATH IS CONSISTENT WITH VISTA MAGFILE REFERENCE
"RTN","MAGQBPRG",20,0)
 ;SET THE SECOND PIECE TO "PACS" IF IT REPRESENTS DICOM
"RTN","MAGQBPRG",21,0)
 ;VALIDATES THAT A JUKEBOX POINTER EXISTS
"RTN","MAGQBPRG",22,0)
 ;RESULT VALUES
"RTN","MAGQBPRG",23,0)
 ;PIECE  1:-3 = FOREIGN FILE, DO NOT PURGE
"RTN","MAGQBPRG",24,0)
 ;         -2 = QUEUED FOR JUKEBOX COPY, DO NOT PURGE
"RTN","MAGQBPRG",25,0)
 ;         -1 = DO NOT PURGE
"RTN","MAGQBPRG",26,0)
 ;          0 = PURGE('MAG 2005 ENTRY)!('JUKEBOX PTRS & 'EXCEPTIONS)
"RTN","MAGQBPRG",27,0)
 ;          1 = PURGE GIVEN NORMAL DATE CRITERIA (NDC) + CONFIRMED ON JB
"RTN","MAGQBPRG",28,0)
 ;          2 = PURGE GIVEN NDC IF TGA PRESENT
"RTN","MAGQBPRG",29,0)
 ;          3 = PURGE IF FILE IS AT ALTERNATE NETWORK LOCATION SITE
"RTN","MAGQBPRG",30,0)
 ;              ELSE PURGE IF AGED & UPDATE FILE REFERENCES
"RTN","MAGQBPRG",31,0)
 ;        **4 = (**NA**)AGE PURGE IF ON JUKEBOX, UPDATE FILE REFERENCES
"RTN","MAGQBPRG",32,0)
 ;              ELSE UPDATE FILEREFENCES, QUEUE JUKEBOX COPY
"RTN","MAGQBPRG",33,0)
 ;          5 = PURGE IF AT ALTERNATE SITE,QUEUE JUKEBOX IF NOT ON JB
"RTN","MAGQBPRG",34,0)
 ;          6 = PURGE GIVEN NORMAL DATE CRITERIA
"RTN","MAGQBPRG",35,0)
 ;PIECE   2:0 = NONPACS
"RTN","MAGQBPRG",36,0)
 ;         :1 = PACS
"RTN","MAGQBPRG",37,0)
 ;PIECE    3: RECORD CATEGORY
"RTN","MAGQBPRG",38,0)
 ;         1 = 'NO 2005 ENTRY
"RTN","MAGQBPRG",39,0)
 ;         2 = RADIOLOGY HOLD
"RTN","MAGQBPRG",40,0)
 ;         3 = NO JUKEBOX/JUKEBOX PTRS
"RTN","MAGQBPRG",41,0)
 ;         4 = JUKEBOX - NO JUKEBOX PTRS (P/EXCEPT)ELSE QUEUE
"RTN","MAGQBPRG",42,0)
 ;         5 = JUKEBOX/JUKEBOX PTRS, NO CACHE PTRS,PURGE IF CONFIRMED
"RTN","MAGQBPRG",43,0)
 ;         6 = JUKEBOX/JUKEBOX PTRS, WRONG CACHE PTRS PURGE IF AT ALT
"RTN","MAGQBPRG",44,0)
 ;         7 = JUKEBOX/JUKEBOX PTRS, NO CACHE PTRS, FIX PTRS
"RTN","MAGQBPRG",45,0)
 ;         8 = JUKEBOX/JUKEBOX PTRS, CACHE PTRS, AGE (IF CONFIRMED)
"RTN","MAGQBPRG",46,0)
 ;         9 = RECORD NOT IN THE IMAGE FILE
"RTN","MAGQBPRG",47,0)
 ;        10 = FOREIGN IMAGE FILE
"RTN","MAGQBPRG",48,0)
 ;        11 = NOT AN IMAGE FILE
"RTN","MAGQBPRG",49,0)
 ;        12 = FILE LOCATION NOT VALID 
"RTN","MAGQBPRG",50,0)
 ;        13 = DELETE 2005 ENTRY (LAST LOCATION REFERENCED)
"RTN","MAGQBPRG",51,0)
 ;        14 = Duplicate 2005/2005.1 entry
"RTN","MAGQBPRG",52,0)
 ;        15 = Foreign Place
"RTN","MAGQBPRG",53,0)
 ;        16 = Record in Archive file
"RTN","MAGQBPRG",54,0)
 ;        17 = Jukebox offline
"RTN","MAGQBPRG",55,0)
 N FILEXT,IEN,SITEID,MAGXX,MAGFILE,MAGFILE1,MAGFILE2,PACS,RIEN,ZNODE
"RTN","MAGQBPRG",56,0)
 N FILETYPE,CPTR,JBPTR,CPOK,BNODE,ALTPATH,NMSPC,PLACE,RDHOLD
"RTN","MAGQBPRG",57,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBPRG",58,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBPRG",59,0)
 S U="^",(MAGFILE2,RESULT)=""
"RTN","MAGQBPRG",60,0)
 S FNAM=$$UPPER^MAGQE4(FNAM)
"RTN","MAGQBPRG",61,0)
 S ^TMP("MAGQ",$J,"PRG","LAST")=FILEPATH_U_FNAM_U_EXT_U_NETLOC_U_RADHOLD
"RTN","MAGQBPRG",62,0)
 I FNAM'?1.5A1.13N1"."1.3E  D  Q  ;LATER ADD EXT VERIFY USING 2005.02
"RTN","MAGQBPRG",63,0)
 . D ELOG(FNAM,FILEPATH) S RESULT="-3^^11" Q  ;'IMAGE FILE
"RTN","MAGQBPRG",64,0)
 S SITEID=$$UPPER^MAGQE4($$INIS^MAGQBPG2(PLACE))
"RTN","MAGQBPRG",65,0)
 S NMSPC=$TR($P(FNAM,"."),"0123456789","")
"RTN","MAGQBPRG",66,0)
 S FILEPATH=$$UPPER^MAGQE4(FILEPATH)
"RTN","MAGQBPRG",67,0)
 I SITEID'[NMSPC D ELOG(FNAM,FILEPATH) S RESULT="-3^^10" Q  ;FOREIGN FILE
"RTN","MAGQBPRG",68,0)
 S IEN=$O(^MAG(2005,"F",$P(FNAM,"."),""))
"RTN","MAGQBPRG",69,0)
 S:'IEN IEN=$O(^MAG(2005.1,"F",$P(FNAM,"."),""))
"RTN","MAGQBPRG",70,0)
 I 'IEN S RESULT="1^^9^^^"_IEN Q
"RTN","MAGQBPRG",71,0)
 S FTYPE=$$FTYPE(EXT)
"RTN","MAGQBPRG",72,0)
 S JBPTR=$$JBPTR(IEN,FTYPE)
"RTN","MAGQBPRG",73,0)
 ;PURGE UNCONDITIONALLY IF NO 2005 ENTRY
"RTN","MAGQBPRG",74,0)
 I '$D(^MAG(2005,IEN,0)) D  Q
"RTN","MAGQBPRG",75,0)
 . I $D(^MAG(2005.1,IEN,0)) D  Q
"RTN","MAGQBPRG",76,0)
 . . I ('JBPTR&($P($G(^MAG(2005.2,+$$CWP^MAGBAPI(PLACE),0)),U,6)="1"))  D
"RTN","MAGQBPRG",77,0)
 . . . S XX=$$JUKEBOX^MAGBAPI(IEN,PLACE)
"RTN","MAGQBPRG",78,0)
 . . . S RESULT="-2^^9^^^"_IEN
"RTN","MAGQBPRG",79,0)
 . . . Q
"RTN","MAGQBPRG",80,0)
 . . E  D 
"RTN","MAGQBPRG",81,0)
 . . . I JBPTR S RESULT="5^^16^"_$$JBPATH(FNAM,JBPTR)_U_$$JBPATH(FNAM,JBPTR)_U_IEN
"RTN","MAGQBPRG",82,0)
 . . . E  S RESULT="-1^^17"
"RTN","MAGQBPRG",83,0)
 . . . Q
"RTN","MAGQBPRG",84,0)
 . E  S RESULT="1^^9^^^"_IEN
"RTN","MAGQBPRG",85,0)
 . Q
"RTN","MAGQBPRG",86,0)
 I PLACE'=$$PLACE^MAGBAPI($P($G(^MAG(2005,IEN,100)),U,3)) D  Q
"RTN","MAGQBPRG",87,0)
 . S RESULT="-3^^15" Q  ;Foreign Place
"RTN","MAGQBPRG",88,0)
 S ZNODE=^MAG(2005,IEN,0)
"RTN","MAGQBPRG",89,0)
 I $P(ZNODE,U,12)="1" S RESULT="-1^^14" Q  ; Duplicate Image/Archive entry 
"RTN","MAGQBPRG",90,0)
 S BNODE=$S(FTYPE="BIG":$G(^MAG(2005,IEN,"FBIG")),1:"")
"RTN","MAGQBPRG",91,0)
 ; NEXT PROCESS MAGNETIC PTR~LESS
"RTN","MAGQBPRG",92,0)
 S CPTR=$$CHKCP($S(FTYPE="BIG":BNODE,1:ZNODE),FTYPE)
"RTN","MAGQBPRG",93,0)
 I 'CPTR D  Q
"RTN","MAGQBPRG",94,0)
 . D CPUPD(FTYPE,IEN,FILEPATH,FNAM)
"RTN","MAGQBPRG",95,0)
 . I 'JBPTR,$P($G(^MAG(2005.2,+$$CWP^MAGBAPI(PLACE),0)),U,6)="1" D
"RTN","MAGQBPRG",96,0)
 . . S XX=$$JUKEBOX^MAGBAPI(IEN,PLACE)
"RTN","MAGQBPRG",97,0)
 . S RESULT="-1^^7^^"_JBPTR_U_IEN ;$S(JBPTR:JBPTR,1:XX)_U_IEN
"RTN","MAGQBPRG",98,0)
 S CPOK=$S('CPTR:0,1:$$CPOK(FTYPE,.ALTPATH,FILEPATH,IEN))
"RTN","MAGQBPRG",99,0)
 S ALTPATH=ALTPATH_FNAM
"RTN","MAGQBPRG",100,0)
 S PACS=$S($D(^MAG(2005,IEN,"PACS")):1,1:0)
"RTN","MAGQBPRG",101,0)
 I 'CPOK,JBPTR D  Q
"RTN","MAGQBPRG",102,0)
 . S RESULT="3^"_PACS_"^6^"_ALTPATH_U_$$JBPATH(FNAM,JBPTR)_U_IEN
"RTN","MAGQBPRG",103,0)
 I 'JBPTR D  Q
"RTN","MAGQBPRG",104,0)
 . I $P($G(^MAG(2005.2,+$$CWP^MAGBAPI(PLACE),0)),U,6)="1" D
"RTN","MAGQBPRG",105,0)
 . . S XX=$$JUKEBOX^MAGBAPI(IEN,PLACE)
"RTN","MAGQBPRG",106,0)
 . . S RESULT="-1^^7^^"_JBPTR_U_IEN ;$S(JBPTR:JBPTR,1:XX)_U_IEN
"RTN","MAGQBPRG",107,0)
 . . Q
"RTN","MAGQBPRG",108,0)
 . E  S RESULT="-1^^17"
"RTN","MAGQBPRG",109,0)
 . Q
"RTN","MAGQBPRG",110,0)
 S RESULT="1^"_PACS_"^8^^"_$$JBPATH(FNAM,JBPTR)_U_IEN
"RTN","MAGQBPRG",111,0)
 Q
"RTN","MAGQBPRG",112,0)
 ;
"RTN","MAGQBPRG",113,0)
LASTNP(TYPE) ;
"RTN","MAGQBPRG",114,0)
 I TYPE="BIG" Q $S($P(ZNODE,U,3,4)="^":1,1:0)
"RTN","MAGQBPRG",115,0)
 I TYPE="ABS" Q $S((($P(ZNODE,U,3)="")&($P(BNODE,U)="")):1,1:0)
"RTN","MAGQBPRG",116,0)
 Q $S((($P(ZNODE,U,4)="")&($P(BNODE,U)="")):1,1:0)
"RTN","MAGQBPRG",117,0)
JBPATH(FN,NL) ;
"RTN","MAGQBPRG",118,0)
 Q $P($G(^MAG(2005.2,NL,0)),U,2)_$$DIRHASH^MAGFILEB(FN,NL)_FN
"RTN","MAGQBPRG",119,0)
WXCPT(RESULT,XPACS,TYPE) ;Check for Worm Exceptions
"RTN","MAGQBPRG",120,0)
 ;                        when no Worm reference in 2005
"RTN","MAGQBPRG",121,0)
 ;NO JUKEBOX Q:1 ????
"RTN","MAGQBPRG",122,0)
 ;SITE PARAMETER EXCEPTIONS
"RTN","MAGQBPRG",123,0)
 ; ALL           "JBEX";1
"RTN","MAGQBPRG",124,0)
 ; ALL PACS      "JBEX";2
"RTN","MAGQBPRG",125,0)
 ; ALL PACS BIG  "JBEX";3
"RTN","MAGQBPRG",126,0)
 ; ALL PACS BIG IF TGA PRESENT ON MAGNETIC
"RTN","MAGQBPRG",127,0)
 ; ALL BIG NON PACS "JBEX";4
"RTN","MAGQBPRG",128,0)
 N PARNODE,RY
"RTN","MAGQBPRG",129,0)
 ; I '$D(^MAG(2006.1,PLACE,"JBEX")) D  Q
"RTN","MAGQBPRG",130,0)
 S $P(RESULT,U)="-2^"_XPACS_"^4"  ;NO WXCPT - We no longer support this activity
"RTN","MAGQBPRG",131,0)
 S PARNODE=$G(^MAG(2006.1,1,"JBEX"))
"RTN","MAGQBPRG",132,0)
 I +$P(PARNODE,U)?1"1" S $P(RESULT,U)="6^"_XPACS_"^4" Q  ;ALL
"RTN","MAGQBPRG",133,0)
 I +$P(PARNODE,U)?1"2" S $P(RESULT,U)="6^"_XPACS_"^4" D  Q  ;ALL
"RTN","MAGQBPRG",134,0)
 . S ^XUSEC("MAG DELETE",DUZ)=""
"RTN","MAGQBPRG",135,0)
 . D DELETE^MAGGTID(.RY,IEN,0)
"RTN","MAGQBPRG",136,0)
 . S ^TMP("MAGQ",$J,IEN)=RY(0)
"RTN","MAGQBPRG",137,0)
 . K RY
"RTN","MAGQBPRG",138,0)
 I XPACS D  Q
"RTN","MAGQBPRG",139,0)
 . I $P(PARNODE,U,2) S $P(RESULT,U)="6^1^4" Q  ;ALL PACS
"RTN","MAGQBPRG",140,0)
 . I TYPE="BIG" D 
"RTN","MAGQBPRG",141,0)
 . . I +$P(PARNODE,U,3) S $P(RESULT,U)="6^1^4" Q  ;ALL BIG PACS
"RTN","MAGQBPRG",142,0)
 . . I +$P(PARNODE,U,6) S $P(RESULT,U)="2^1^4" Q  ;BIG PACS IF TGA 
"RTN","MAGQBPRG",143,0)
 . I $P(RESULT,U)="" D
"RTN","MAGQBPRG",144,0)
 . . I $P($G(^MAG(2005.2,+$$CWP^MAGBAPI(PLACE),0)),U,6)'="1" S RESULT="-1" Q
"RTN","MAGQBPRG",145,0)
 . . S RESULT="-2^1^4"
"RTN","MAGQBPRG",146,0)
 ;NON PACS
"RTN","MAGQBPRG",147,0)
 I ((TYPE="BIG")&(+$P(PARNODE,U,4))) S RESULT="6^0^4" Q
"RTN","MAGQBPRG",148,0)
 I $P($G(^MAG(2005.2,+$$CWP^MAGBAPI(PLACE),0)),U,6)'="1" S RESULT="-1^0^4" Q
"RTN","MAGQBPRG",149,0)
 S RESULT="-2^0^4"
"RTN","MAGQBPRG",150,0)
 Q
"RTN","MAGQBPRG",151,0)
 ;
"RTN","MAGQBPRG",152,0)
FTYPE(FEXT) ;
"RTN","MAGQBPRG",153,0)
 S FEXT=$$UPPER^MAGQE4(FEXT)
"RTN","MAGQBPRG",154,0)
 I "^ABS^"[("^"_FEXT_"^") Q "ABS"
"RTN","MAGQBPRG",155,0)
 I "^BIG^"[("^"_FEXT_"^") Q "BIG"
"RTN","MAGQBPRG",156,0)
 Q "FULL"
"RTN","MAGQBPRG",157,0)
CHKCP(NODE,TYPE) ;
"RTN","MAGQBPRG",158,0)
 N PIECE,CP
"RTN","MAGQBPRG",159,0)
 S PIECE=$S(TYPE="ABS":4,TYPE="BIG":1,TYPE="FULL":3,1:0)
"RTN","MAGQBPRG",160,0)
 Q $P(NODE,U,PIECE)
"RTN","MAGQBPRG",161,0)
JBPTR(MAGIEN,TYPE) ;
"RTN","MAGQBPRG",162,0)
 N PTR
"RTN","MAGQBPRG",163,0)
 I TYPE="BIG" D
"RTN","MAGQBPRG",164,0)
 . S PTR=+$P($G(^MAG(2005,MAGIEN,"FBIG")),"^",2)
"RTN","MAGQBPRG",165,0)
 . S:'PTR PTR=+$P($G(^MAG(2005.1,MAGIEN,"FBIG")),"^",2)
"RTN","MAGQBPRG",166,0)
 E  D
"RTN","MAGQBPRG",167,0)
 . S PTR=+$P($G(^MAG(2005,MAGIEN,0)),"^",5)
"RTN","MAGQBPRG",168,0)
 . S:'PTR PTR=+$P($G(^MAG(2005.1,MAGIEN,"FBIG")),"^",2)
"RTN","MAGQBPRG",169,0)
 Q $S($P($G(^MAG(2005.2,PTR,0)),U,6)=1:PTR,1:0)
"RTN","MAGQBPRG",170,0)
RDHOLD(IEN) ;
"RTN","MAGQBPRG",171,0)
 N HOLD,RIEN
"RTN","MAGQBPRG",172,0)
 S RIEN=$G(^MAG(2005,IEN,2))
"RTN","MAGQBPRG",173,0)
 Q:$P(RIEN,"^",6)'=74 0
"RTN","MAGQBPRG",174,0)
 S HOLD=$G(^RARPT($P(RIEN,"^",7),"NOPURGE"))
"RTN","MAGQBPRG",175,0)
 Q $S($$UPPER^MAGQE4(HOLD)="N":1,1:0)
"RTN","MAGQBPRG",176,0)
CPOK(TYPE,ALTPATH,FILEPATH,IEN) ;
"RTN","MAGQBPRG",177,0)
 N MAGXX,PIECE,NODE,LOC
"RTN","MAGQBPRG",178,0)
 S MAGXX=IEN
"RTN","MAGQBPRG",179,0)
 S PIECE=$S(TYPE="ABS":4,TYPE="BIG":1,TYPE="FULL":3,1:0)
"RTN","MAGQBPRG",180,0)
 S NODE=$S(TYPE="BIG":"FBIG",1:0)
"RTN","MAGQBPRG",181,0)
 S LOC=$P($G(^MAG(2005,IEN,NODE)),U,PIECE)
"RTN","MAGQBPRG",182,0)
 Q:'LOC 0
"RTN","MAGQBPRG",183,0)
 S ALTPATH=$$UPPER^MAGQE4($P($G(^MAG(2005.2,LOC,0)),U,2)_$$DIRHASH^MAGFILEB(FNAM,LOC))
"RTN","MAGQBPRG",184,0)
 Q $S(ALTPATH=FILEPATH:1,1:0)
"RTN","MAGQBPRG",185,0)
CPUPD(TYPE,IEN,FP,FN) ;
"RTN","MAGQBPRG",186,0)
 N PIECE,CP,NODE,LOC
"RTN","MAGQBPRG",187,0)
 S PIECE=$S(TYPE="ABS":4,TYPE="BIG":1,TYPE="FULL":3,1:0)
"RTN","MAGQBPRG",188,0)
 S NODE=$S(TYPE="BIG":"FBIG",1:0)
"RTN","MAGQBPRG",189,0)
 S LOC=$$UNHASH(FN,FP)
"RTN","MAGQBPRG",190,0)
 I (PIECE=0)!(+LOC=0) D ELOG(FN,FP) Q
"RTN","MAGQBPRG",191,0)
 S $P(^MAG(2005,IEN,NODE),U,PIECE)=LOC
"RTN","MAGQBPRG",192,0)
 Q
"RTN","MAGQBPRG",193,0)
CUPD(RESULT,FILEPATH,FILENAME,EXT,IEN) ; RPC[MAGQ CUPDTE]
"RTN","MAGQBPRG",194,0)
 N TYPE
"RTN","MAGQBPRG",195,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBPRG",196,0)
 S TYPE=$$FTYPE(EXT)
"RTN","MAGQBPRG",197,0)
 D CPUPD(TYPE,IEN,FILEPATH,FILENAME)
"RTN","MAGQBPRG",198,0)
 Q
"RTN","MAGQBPRG",199,0)
UNHASH(FN,FP) ; RETURN NETWORK LOCATION NUMBER
"RTN","MAGQBPRG",200,0)
 N SHARE,HASH
"RTN","MAGQBPRG",201,0)
 S SHARE=$S(FP[":":$P(FP,"\",1,2)_"\",1:$P(FP,"\",1,4)_"\")
"RTN","MAGQBPRG",202,0)
 S HASH=$S($P(FP,SHARE,2)["\":"Y",1:"")
"RTN","MAGQBPRG",203,0)
 Q $$SHNAM(SHARE,HASH)
"RTN","MAGQBPRG",204,0)
ELOG(FN,FP) ;
"RTN","MAGQBPRG",205,0)
 N INDX
"RTN","MAGQBPRG",206,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBPRG",207,0)
 S INDX=+$O(^TMP("MAGQ",$J,"PRG",FN,99999),-1)+1
"RTN","MAGQBPRG",208,0)
 S ^TMP("MAGQ",$J,"PRG",FN,INDX)=FN_"^"_FP
"RTN","MAGQBPRG",209,0)
 Q
"RTN","MAGQBPRG",210,0)
ELOGR(RESULT) ;[MAGQ ELOGR] - Error log report and purge
"RTN","MAGQBPRG",211,0)
 N FN,INDX,CNT
"RTN","MAGQBPRG",212,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBPRG",213,0)
 S FN="",CNT=0
"RTN","MAGQBPRG",214,0)
 F  S FN=$O(^TMP("MAGQ",$J,"PRG",FN)) Q:FN=""  D
"RTN","MAGQBPRG",215,0)
 . S INDX=""
"RTN","MAGQBPRG",216,0)
 . F  S INDX=$O(^TMP("MAGQ",$J,"PRG",FN,INDX)) Q:INDX'?1N.N  D
"RTN","MAGQBPRG",217,0)
 . . S CNT=CNT+1,RESULT(CNT)=^TMP("MAGQ",$J,"PRG",FN,INDX)
"RTN","MAGQBPRG",218,0)
 S RESULT(0)=CNT
"RTN","MAGQBPRG",219,0)
 K ^TMP("MAGQ",$J,"PRG")
"RTN","MAGQBPRG",220,0)
 Q
"RTN","MAGQBPRG",221,0)
SHNAM(SHARE,HASH) ;
"RTN","MAGQBPRG",222,0)
 N NUM,ONLINE,ZNODE
"RTN","MAGQBPRG",223,0)
 S (NUM,ONLINE)=0
"RTN","MAGQBPRG",224,0)
 Q:((SHARE="")!(SHARE[":")) ""
"RTN","MAGQBPRG",225,0)
 F  S NUM=$O(^MAG(2005.2,"AC",SHARE,NUM)) Q:'NUM  D  Q:ONLINE
"RTN","MAGQBPRG",226,0)
 . S ZNODE=^MAG(2005.2,NUM,0)
"RTN","MAGQBPRG",227,0)
 . Q:($P(ZNODE,"^",6)'="1")
"RTN","MAGQBPRG",228,0)
 . Q:($P(ZNODE,"^",8)'=HASH)
"RTN","MAGQBPRG",229,0)
 . S ONLINE="1"
"RTN","MAGQBPRG",230,0)
 Q NUM
"RTN","MAGQBTM")
0^12^B79154449
"RTN","MAGQBTM",1,0)
MAGQBTM ;WOIFO/RMP - REMOTE Task SERVER Program [ 03/25/2001 11:20 ]
"RTN","MAGQBTM",2,0)
 ;;3.0;IMAGING;**1,7,8,20**;Apr 12, 2006
"RTN","MAGQBTM",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBTM",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBTM",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBTM",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBTM",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBTM",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBTM",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBTM",10,0)
 ;; |                                                               |
"RTN","MAGQBTM",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBTM",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBTM",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBTM",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBTM",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBTM",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBTM",17,0)
 ;;
"RTN","MAGQBTM",18,0)
 ;
"RTN","MAGQBTM",19,0)
ENTRY(RESULT,WSTAT,PROCESS) ; RPC[MAGQ ABP]
"RTN","MAGQBTM",20,0)
 N X,SYSIEN,SYSNAME,NODE,INDX,CNT,PROC,%,QPTR,QCNT,VERS,EXEDATE,WSOS,PLACE
"RTN","MAGQBTM",21,0)
 D NOW^%DTC
"RTN","MAGQBTM",22,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBTM",23,0)
 S (SYSIEN,CNT)=0,SYSNAME="",PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBTM",24,0)
 S $P(RESULT(0),U,6)=$D(^XUSEC("MAG SYSTEM",DUZ))
"RTN","MAGQBTM",25,0)
 Q:'$P(RESULT(0),U,6)
"RTN","MAGQBTM",26,0)
 S VERS=$P(WSTAT,U,2),EXEDATE=$P(WSTAT,U,3),WSOS=$P(WSTAT,U,4)
"RTN","MAGQBTM",27,0)
 S WSTAT=$P(WSTAT,U)
"RTN","MAGQBTM",28,0)
 S SYSIEN=$O(^MAG(2006.8,"C",PLACE,WSTAT,""))
"RTN","MAGQBTM",29,0)
 I 'SYSIEN S SYSIEN=$O(^MAG(2006.8,"C",PLACE,$$UPPER^MAGQE4(WSTAT),""))
"RTN","MAGQBTM",30,0)
 I 'SYSIEN D
"RTN","MAGQBTM",31,0)
 . N TRY
"RTN","MAGQBTM",32,0)
 . F TRY=1:1:$L(WSTAT,".") D  Q:SYSIEN?1.N
"RTN","MAGQBTM",33,0)
 . . S SYSIEN=$O(^MAG(2006.8,"C",PLACE,$P(WSTAT,".",TRY),""))
"RTN","MAGQBTM",34,0)
 . . I 'SYSIEN S SYSIEN=$O(^MAG(2006.8,"C",PLACE,$$UPPER^MAGQE4($P(WSTAT,".",TRY)),""))
"RTN","MAGQBTM",35,0)
 Q:SYSIEN=""
"RTN","MAGQBTM",36,0)
 S $P(^MAG(2006.8,SYSIEN,1),U,2)=VERS
"RTN","MAGQBTM",37,0)
 S $P(^MAG(2006.8,SYSIEN,1),U,3)=EXEDATE
"RTN","MAGQBTM",38,0)
 S $P(^MAG(2006.8,SYSIEN,1),U,4)=WSOS
"RTN","MAGQBTM",39,0)
 S VERS=$P(VERS,".",1,2)_"P"_$P(VERS,".",3)
"RTN","MAGQBTM",40,0)
 Q:'$$VOK^MAGQBUT4(VERS)
"RTN","MAGQBTM",41,0)
 S ^TMP("MAGQN",$J,0)=SYSIEN_"^"_WSTAT
"RTN","MAGQBTM",42,0)
 S NODE=^MAG(2006.8,SYSIEN,0)
"RTN","MAGQBTM",43,0)
 S SYSNAME=$P(NODE,U)
"RTN","MAGQBTM",44,0)
 I SYSNAME="" D  Q
"RTN","MAGQBTM",45,0)
 . S $P(RESULT(0),U,1,2)="-1^No Background Processor parameters on system"
"RTN","MAGQBTM",46,0)
 I $P(NODE,U,12)'=1 D  Q
"RTN","MAGQBTM",47,0)
 . S $P(RESULT(0),U,1,2)="-1^Not assigned as a Background Processor"
"RTN","MAGQBTM",48,0)
 F PROC="ABSTRACT","JUKEBOX","JBTOHD","DELETE","PREFET","GCC","IMPORT" D
"RTN","MAGQBTM",49,0)
 . N FNUM,PIECE
"RTN","MAGQBTM",50,0)
 . S FNUM=$$FNUM(PROC)
"RTN","MAGQBTM",51,0)
 . S PIECE=$$GET1^DID(2006.8,FNUM,"","GLOBAL SUBSCRIPT LOCATION")
"RTN","MAGQBTM",52,0)
 . S PIECE=$P(PIECE,";",2)
"RTN","MAGQBTM",53,0)
 . I $P(NODE,U,PIECE)="1" D
"RTN","MAGQBTM",54,0)
 . . N QCNT,QPTR
"RTN","MAGQBTM",55,0)
 . . D ADD^MAGBAPI(0,PROC,PLACE)
"RTN","MAGQBTM",56,0)
 . . S QPTR=$O(^MAGQUEUE(2006.031,"C",PLACE,PROC,""))
"RTN","MAGQBTM",57,0)
 . . S QCNT=$P($G(^MAGQUEUE(2006.031,+QPTR,0)),U,3)
"RTN","MAGQBTM",58,0)
 . . S CNT=CNT+1
"RTN","MAGQBTM",59,0)
 . . S RESULT(CNT)=PROC_U_QCNT
"RTN","MAGQBTM",60,0)
 . . Q
"RTN","MAGQBTM",61,0)
 . Q
"RTN","MAGQBTM",62,0)
 S $P(RESULT(0),U,1,5)="0^BP List^PID: "_$$BASE^XLFUTL($J,10,16)_"^"_SYSNAME_U_WSTAT
"RTN","MAGQBTM",63,0)
 Q
"RTN","MAGQBTM",64,0)
FNUM(PROCESS) ;
"RTN","MAGQBTM",65,0)
 Q:PROC="ABSTRACT" 12
"RTN","MAGQBTM",66,0)
 Q:PROC="JUKEBOX" 13
"RTN","MAGQBTM",67,0)
 Q:PROC="JBTOHD" 14
"RTN","MAGQBTM",68,0)
 Q:PROC="PREFET" 15
"RTN","MAGQBTM",69,0)
 Q:PROC="IMPORT" 16
"RTN","MAGQBTM",70,0)
 Q:PROC="GCC" 17
"RTN","MAGQBTM",71,0)
 Q:PROC="DELETE" 20
"RTN","MAGQBTM",72,0)
 Q 0
"RTN","MAGQBTM",73,0)
GETQUE(RESULT,ACTION) ; RPC[MAGQ GET]
"RTN","MAGQBTM",74,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBTM",75,0)
 D @(ACTION_"(.RESULT)")
"RTN","MAGQBTM",76,0)
 I +RESULT<0 D
"RTN","MAGQBTM",77,0)
 . D NOW^%DTC
"RTN","MAGQBTM",78,0)
 . D QSTAT($P(RESULT,U,2),$P(RESULT,U,3),ACTION,$$PLACE^MAGBAPI(+$G(DUZ(2))))
"RTN","MAGQBTM",79,0)
 . D QPTER(ACTION,$P(RESULT,U,2))
"RTN","MAGQBTM",80,0)
 Q
"RTN","MAGQBTM",81,0)
ABSTRACT(RESULT) ;
"RTN","MAGQBTM",82,0)
 D DEQUEUE("ABSTRACT",.RESULT) Q
"RTN","MAGQBTM",83,0)
JUKEBOX(RESULT) ;
"RTN","MAGQBTM",84,0)
 D DEQUEUE("JUKEBOX",.RESULT) Q
"RTN","MAGQBTM",85,0)
JBTOHD(RESULT) ;
"RTN","MAGQBTM",86,0)
 D DEQUEUE("JBTOHD",.RESULT) Q
"RTN","MAGQBTM",87,0)
GCC(RESULT) ;
"RTN","MAGQBTM",88,0)
 D DEQUEUE("GCC",.RESULT) Q
"RTN","MAGQBTM",89,0)
DELETE(RESULT) ;
"RTN","MAGQBTM",90,0)
 D DEQUEUE("DELETE",.RESULT) Q
"RTN","MAGQBTM",91,0)
PREFET(RESULT) ;
"RTN","MAGQBTM",92,0)
 D DEQUEUE("PREFET",.RESULT) Q
"RTN","MAGQBTM",93,0)
IMPORT(RESULT) ;
"RTN","MAGQBTM",94,0)
 D DEQUEUE("IMPORT",.RESULT) Q
"RTN","MAGQBTM",95,0)
DEQUEUE(QUE,RESULT) ;
"RTN","MAGQBTM",96,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBTM",97,0)
 N QPTR,QPTR2,ROU,MAGIEN,ZNODE,MSG,IMQUE,PLACE
"RTN","MAGQBTM",98,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBTM",99,0)
 S QPTR2=$O(^MAGQUEUE(2006.031,"C",PLACE,QUE,""))
"RTN","MAGQBTM",100,0)
 S QPTR=$S(QPTR2:$P(^MAGQUEUE(2006.031,QPTR2,0),U,2),1:"")
"RTN","MAGQBTM",101,0)
 S QPTR=$O(^MAGQUEUE(2006.03,"C",PLACE,QUE,QPTR))
"RTN","MAGQBTM",102,0)
 I QPTR="" D  Q
"RTN","MAGQBTM",103,0)
 . S RESULT="0"_U_QPTR2_U_"No "_QUE_" "_QPTR2_" to process."
"RTN","MAGQBTM",104,0)
 D QSTAT(QPTR,QUE_" in progress.",QUE,PLACE)
"RTN","MAGQBTM",105,0)
 S ZNODE=$G(^MAGQUEUE(2006.03,QPTR,0))
"RTN","MAGQBTM",106,0)
 I ZNODE="" S RESULT=-101_U_QPTR_U_"Queue Record does not exist" Q
"RTN","MAGQBTM",107,0)
 I QUE="IMPORT" D ENTRY^MAGQBIM(QPTR,QUE,QPTR2,ZNODE,.RESULT) Q
"RTN","MAGQBTM",108,0)
 S MAGIEN=$P(ZNODE,"^",7)
"RTN","MAGQBTM",109,0)
 I ("^DELETE^JUKEBOX^")'[(U_QUE_U),(('(+MAGIEN))!('$D(^MAG(2005,+MAGIEN,0)))!($P(ZNODE,U)'=QUE)) D  Q
"RTN","MAGQBTM",110,0)
 . I $D(^MAG(2005.1,+MAGIEN,0)) D
"RTN","MAGQBTM",111,0)
 . . S MSG="Image Record Deleted and in archive file."
"RTN","MAGQBTM",112,0)
 . E  S MSG="No valid image file number to process."
"RTN","MAGQBTM",113,0)
 . S RESULT=-101_U_QPTR_U_MSG
"RTN","MAGQBTM",114,0)
 S ROU=$$RESET(QUE)
"RTN","MAGQBTM",115,0)
 I ROU="" S RESULT="-1"_U_QPTR_U_QUE_" Is an inactive process" Q
"RTN","MAGQBTM",116,0)
 D @("ENTRY^"_ROU_"(.RESULT,QPTR)")
"RTN","MAGQBTM",117,0)
 Q
"RTN","MAGQBTM",118,0)
QSTAT(QPTR,MESSAGE,ACTION,PLACE) ;
"RTN","MAGQBTM",119,0)
 N ZNODE
"RTN","MAGQBTM",120,0)
 Q:QPTR=""
"RTN","MAGQBTM",121,0)
 S MESSAGE=$TR(MESSAGE,":;<>.?/\'()*^%$#@!0123456789","")
"RTN","MAGQBTM",122,0)
 Q:'$D(^MAGQUEUE(2006.03,QPTR,0))
"RTN","MAGQBTM",123,0)
 S ZNODE=$G(^MAGQUEUE(2006.03,QPTR,0))
"RTN","MAGQBTM",124,0)
 D NOW^%DTC
"RTN","MAGQBTM",125,0)
 I $P(ZNODE,U,5)]"" D
"RTN","MAGQBTM",126,0)
 . K ^MAGQUEUE(2006.03,"D",PLACE,$P(ZNODE,U),$E($P(ZNODE,U,5),1,30),QPTR) Q
"RTN","MAGQBTM",127,0)
 S ^MAGQUEUE(2006.03,"D",PLACE,$P(ZNODE,U),$E(MESSAGE,1,30),QPTR)=""
"RTN","MAGQBTM",128,0)
 S $P(^MAGQUEUE(2006.03,QPTR,0),U,5,6)=$P(MESSAGE,U)_U_%
"RTN","MAGQBTM",129,0)
 I ACTION["IMPORT" D STAT^MAGQBIM(QPTR,%,MESSAGE)
"RTN","MAGQBTM",130,0)
 Q
"RTN","MAGQBTM",131,0)
QPTER(QUEUE,QPTR) ;
"RTN","MAGQBTM",132,0)
 N QREC,PREV,PNODE,PLACE
"RTN","MAGQBTM",133,0)
 S PLACE=$P($G(^MAGQUEUE(2006.03,QPTR,0)),U,12)
"RTN","MAGQBTM",134,0)
 S PLACE=$S(PLACE:PLACE,1:$$PLACE^MAGBAPI(+$G(DUZ(2))))
"RTN","MAGQBTM",135,0)
 S QREC=$O(^MAGQUEUE(2006.031,"C",PLACE,QUEUE,""))
"RTN","MAGQBTM",136,0)
 S PREV=$S(QREC:$P(^MAGQUEUE(2006.031,QREC,0),U,2),1:"")
"RTN","MAGQBTM",137,0)
 I PREV'=QPTR D  Q
"RTN","MAGQBTM",138,0)
 . D ADD^MAGBAPI(-1,QUEUE,PLACE)
"RTN","MAGQBTM",139,0)
 . L +^MAGQUEUE(2006.031,QREC,0)
"RTN","MAGQBTM",140,0)
 . S $P(^MAGQUEUE(2006.031,QREC,0),U,2)=QPTR
"RTN","MAGQBTM",141,0)
 . L -^MAGQUEUE(2006.031,QREC,0)
"RTN","MAGQBTM",142,0)
 . Q
"RTN","MAGQBTM",143,0)
 D ADD^MAGBAPI(0,QUEUE,PLACE)
"RTN","MAGQBTM",144,0)
 Q
"RTN","MAGQBTM",145,0)
RESET(QUEUE) ; Set Routine parameter
"RTN","MAGQBTM",146,0)
 Q:QUEUE="ABSTRACT" "MAGQBAB"
"RTN","MAGQBTM",147,0)
 Q:QUEUE="JUKEBOX" "MAGQBJB"
"RTN","MAGQBTM",148,0)
 Q:QUEUE="JBTOHD" "MAGQBJH"
"RTN","MAGQBTM",149,0)
 Q:QUEUE="DELETE" "MAGQBD"
"RTN","MAGQBTM",150,0)
 Q:QUEUE="PREFET" "MAGQBJH"
"RTN","MAGQBTM",151,0)
 Q:QUEUE="IMPORT" "MAGQBIM"
"RTN","MAGQBTM",152,0)
 Q:QUEUE="GCC" "MAGQBGCC"
"RTN","MAGQBTM",153,0)
 Q ""
"RTN","MAGQBTM",154,0)
RQCNT(PLACE) ;
"RTN","MAGQBTM",155,0)
 N QIEN,QPTR,QNAM
"RTN","MAGQBTM",156,0)
 S QNAM=""
"RTN","MAGQBTM",157,0)
 F  S QNAM=$O(^MAGQUEUE(2006.031,"C",PLACE,QNAM)) Q:QNAM=""  D
"RTN","MAGQBTM",158,0)
 . S QIEN=$O(^MAGQUEUE(2006.031,"C",PLACE,QNAM,"")) Q:QIEN'?1.N
"RTN","MAGQBTM",159,0)
 . S QPTR=+$P(^MAGQUEUE(2006.031,QIEN,0),U,2)
"RTN","MAGQBTM",160,0)
 . S $P(^MAGQUEUE(2006.031,QIEN,0),U,3)=""
"RTN","MAGQBTM",161,0)
 . D ADD^MAGBAPI(0,QNAM,PLACE)
"RTN","MAGQBTM",162,0)
 . Q
"RTN","MAGQBTM",163,0)
 Q
"RTN","MAGQBTM",164,0)
QUPDTE(RESULT,QPTR,UPDATE) ;RPC[MAGQ QUD]
"RTN","MAGQBTM",165,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBTM",166,0)
 N NODE,STAT,TYPE,VPTR,MPTR,IEN,IDFN,MSG,PLACE
"RTN","MAGQBTM",167,0)
 S NODE=$G(^MAGQUEUE(2006.03,QPTR,0))
"RTN","MAGQBTM",168,0)
 S PLACE=$P(NODE,U,12)
"RTN","MAGQBTM",169,0)
 S RESULT="1^QUEUE UPDATE COMPLETE"
"RTN","MAGQBTM",170,0)
 S STAT=$P(UPDATE,U)
"RTN","MAGQBTM",171,0)
 S TYPE=$P(NODE,U)
"RTN","MAGQBTM",172,0)
 S MSG=$S($P(UPDATE,U,2)="":TYPE_" Process Error",1:$P(UPDATE,U,2))
"RTN","MAGQBTM",173,0)
 D QSTAT(QPTR,MSG,TYPE,PLACE)
"RTN","MAGQBTM",174,0)
 D QPTER(TYPE,QPTR)
"RTN","MAGQBTM",175,0)
 I STAT<0 Q
"RTN","MAGQBTM",176,0)
 I "^DELETE^"[("^"_TYPE_"^") D DQUE^MAGQBUT(QPTR) Q
"RTN","MAGQBTM",177,0)
 I "^IMPORT^"[("^"_TYPE_"^") D  Q
"RTN","MAGQBTM",178,0)
 . D DQUE^MAGQBUT(QPTR)
"RTN","MAGQBTM",179,0)
 . S DIK="^MAG(2006.034,",DA=QPTR D ^DIK
"RTN","MAGQBTM",180,0)
 . S DIK="^MAG(2006.041,",DA=QPTR D ^DIK
"RTN","MAGQBTM",181,0)
 . K DIK,DA
"RTN","MAGQBTM",182,0)
 . Q 
"RTN","MAGQBTM",183,0)
 S VPTR=$P(UPDATE,U,3)
"RTN","MAGQBTM",184,0)
 I VPTR?1.N D
"RTN","MAGQBTM",185,0)
 . S MPTR=$P(NODE,U,7)
"RTN","MAGQBTM",186,0)
 . I "^ABSTRACT^"[("^"_TYPE_"^") D  Q
"RTN","MAGQBTM",187,0)
 . . S $P(^MAG(2005,MPTR,0),U,4)=VPTR
"RTN","MAGQBTM",188,0)
 . . S X=$$JUKEBOX^MAGBAPI(MPTR,PLACE)
"RTN","MAGQBTM",189,0)
 . . D DQUE^MAGQBUT(QPTR) Q
"RTN","MAGQBTM",190,0)
 . I ("^JBTOHD^"[("^"_TYPE_"^"))!("^PREFET^"[("^"_TYPE_"^")) D  Q
"RTN","MAGQBTM",191,0)
 . . I "^FULL^"[$P(NODE,U,8) S $P(^MAG(2005,MPTR,0),U,3)=VPTR
"RTN","MAGQBTM",192,0)
 . . I "^ABSTRACT^"[$P(NODE,U,8) S $P(^MAG(2005,MPTR,0),U,4)=VPTR
"RTN","MAGQBTM",193,0)
 . . I "^BIG^"[$P(NODE,U,8) S $P(^MAG(2005,MPTR,"FBIG"),U)=VPTR
"RTN","MAGQBTM",194,0)
 . . D DQUE^MAGQBUT(QPTR) Q
"RTN","MAGQBTM",195,0)
 . I "^JUKEBOX^"[("^"_TYPE_"^") D  Q 
"RTN","MAGQBTM",196,0)
 . . I $P(UPDATE,U,2)["BIG" D  Q
"RTN","MAGQBTM",197,0)
 . . . S:$D(^MAG(2005,MPTR)) $P(^MAG(2005,MPTR,"FBIG"),U,2)=VPTR
"RTN","MAGQBTM",198,0)
 . . . S:$D(^MAG(2005.1,MPTR)) $P(^MAG(2005.1,MPTR,"FBIG"),U,2)=VPTR
"RTN","MAGQBTM",199,0)
 . . . D DQUE^MAGQBUT(QPTR) Q
"RTN","MAGQBTM",200,0)
 . . E  D
"RTN","MAGQBTM",201,0)
 . . . S:$D(^MAG(2005,MPTR)) $P(^MAG(2005,MPTR,0),U,5)=VPTR
"RTN","MAGQBTM",202,0)
 . . . S:$D(^MAG(2005.1,MPTR)) $P(^MAG(2005.1,MPTR,0),U,5)=VPTR
"RTN","MAGQBTM",203,0)
 . . . D DQUE^MAGQBUT(QPTR) Q
"RTN","MAGQBTM",204,0)
 . . Q
"RTN","MAGQBTM",205,0)
 . I "^GCC^"[("^"_TYPE_"^") D  Q
"RTN","MAGQBTM",206,0)
 . . D NOW^%DTC
"RTN","MAGQBTM",207,0)
 . . S FDA(2005.01,"+1,"_MPTR_",",.01)=VPTR
"RTN","MAGQBTM",208,0)
 . . S FDA(2005.01,"+1,"_MPTR_",",1)=%
"RTN","MAGQBTM",209,0)
 . . S FDA(2005.01,"+1,"_MPTR_",",2)=$P($$TRIM^MAGQBUT4($P(UPDATE,U,2))," ")
"RTN","MAGQBTM",210,0)
 . . D UPDATE^DIE("U","FDA","","MAGIMP")
"RTN","MAGQBTM",211,0)
 . . S IDFN=$P(^MAG(2005,MPTR,0),U,7)
"RTN","MAGQBTM",212,0)
 . . D ENTRY^MAGLOG("EXPORT->"_$P($G(^MAG(2005.2,VPTR,0)),U,2),$P(NODE,U,2),MPTR,"Document Imaging",IDFN,0)
"RTN","MAGQBTM",213,0)
 . . D DQUE^MAGQBUT(QPTR) Q
"RTN","MAGQBTM",214,0)
 . Q
"RTN","MAGQBTM",215,0)
 Q
"RTN","MAGQBTM",216,0)
REQUE(RESULT,QPTR) ;
"RTN","MAGQBTM",217,0)
 ; RPC[MAGQ REQ]
"RTN","MAGQBTM",218,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBTM",219,0)
 N PROC,NODE,INDX,PARAM,OPDUZ,STATUS,TRACKID,PLACE
"RTN","MAGQBTM",220,0)
 S INDX=$$TRIM^MAGQBUT4(QPTR),TRACKID=0
"RTN","MAGQBTM",221,0)
 S NODE=$G(^MAGQUEUE(2006.03,INDX,0))
"RTN","MAGQBTM",222,0)
 Q:NODE']""
"RTN","MAGQBTM",223,0)
 S PLACE=$P(NODE,U,12)
"RTN","MAGQBTM",224,0)
 Q:'PLACE
"RTN","MAGQBTM",225,0)
 S PROC=$P(NODE,U),STATUS=$P(NODE,U,5)
"RTN","MAGQBTM",226,0)
 I PROC'="IMPORT" D
"RTN","MAGQBTM",227,0)
 . D RQP(PROC,NODE,.PARAM)
"RTN","MAGQBTM",228,0)
 . S @("RESULT=$$"_PROC_"^MAGBAPI(PARAM,PLACE)")
"RTN","MAGQBTM",229,0)
 . Q
"RTN","MAGQBTM",230,0)
 E  D
"RTN","MAGQBTM",231,0)
 . S $P(PARAM,U,3)=+$P(NODE,U,9)+1
"RTN","MAGQBTM",232,0)
 . S $P(PARAM,U,4)=$S($P(NODE,U,11)?1N.N:$P(NODE,U,11),1:QPTR)
"RTN","MAGQBTM",233,0)
 . D TIDL^MAGQBIM($S($P(NODE,U,11)?1N.N:$P(NODE,U,11),1:QPTR),PROC,.TRACKID)
"RTN","MAGQBTM",234,0)
 . Q:TRACKID=0
"RTN","MAGQBTM",235,0)
 . S @("RESULT=$$"_PROC_"^MAGBAPI(PARAM,$P(NODE,U,10),TRACKID,PLACE)")
"RTN","MAGQBTM",236,0)
 Q:((PROC="IMPORT")&(TRACKID=0))
"RTN","MAGQBTM",237,0)
 D DQUE^MAGQBUT(INDX)
"RTN","MAGQBTM",238,0)
 Q
"RTN","MAGQBTM",239,0)
RQP(P,N,PAR) ;
"RTN","MAGQBTM",240,0)
 N P1,P2,P3,P4
"RTN","MAGQBTM",241,0)
 I ("^JBTOHD^PREFET^")[P S P1=$P(N,U,7),P2=$P(N,U,8),P3=+$P(N,U,9)+1,PAR=P1_U_P2_U_P3 Q
"RTN","MAGQBTM",242,0)
 I P["DELETE" S P1=$P(N,U,10),P2=+$P(N,U,9)+1,PAR=P2_U_P1 Q
"RTN","MAGQBTM",243,0)
 I P["GCC" D  Q
"RTN","MAGQBTM",244,0)
 . S P1=$P(N,U,7),P2=$P(N,U,10),P3=$P(N,U,11),P4=$P(N,U,9)+1,PAR=P1_U_P2_U_P3_U_P4 Q
"RTN","MAGQBTM",245,0)
 S P1=$P(N,U,7)_"^^",P2=+$P(N,U,9)+1,PAR=P1_P2 ;JUKEBOX + ABSTRACT
"RTN","MAGQBTM",246,0)
 Q
"RTN","MAGQBTM",247,0)
ERR ;
"RTN","MAGQBTM",248,0)
 N ERRXX
"RTN","MAGQBTM",249,0)
 S ERRXX=$$EC^%ZOSV
"RTN","MAGQBTM",250,0)
 D ^%ZTER
"RTN","MAGQBTM",251,0)
 D ^XUSCLEAN
"RTN","MAGQBTM",252,0)
 Q
"RTN","MAGQBUT")
0^13^B78801561
"RTN","MAGQBUT",1,0)
MAGQBUT ;WOIFO/RMP - Imaging Background Processor Utilities [ 03/25/2001 11:20 ]
"RTN","MAGQBUT",2,0)
 ;;3.0;IMAGING;**7,8,48,20**;Apr 12, 2006
"RTN","MAGQBUT",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBUT",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBUT",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBUT",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBUT",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBUT",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBUT",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBUT",10,0)
 ;; |                                                               |
"RTN","MAGQBUT",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBUT",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBUT",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBUT",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBUT",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBUT",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBUT",17,0)
 ;;
"RTN","MAGQBUT",18,0)
FTYPE(RESULT) ;
"RTN","MAGQBUT",19,0)
 ; RPC[MAGQ FTYPE]
"RTN","MAGQBUT",20,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT",21,0)
 N MAX,INDX,PLACE
"RTN","MAGQBUT",22,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBUT",23,0)
 S U="^",MAX=$P(^MAG(2006.1,PLACE,2,0),U,4),INDX=0
"RTN","MAGQBUT",24,0)
 Q:+MAX<1
"RTN","MAGQBUT",25,0)
 F  S INDX=$O(^MAG(2006.1,PLACE,2,INDX)) Q:INDX'?1N.N  D  Q:INDX=MAX
"RTN","MAGQBUT",26,0)
 . S RESULT(INDX-1)=$G(^MAG(2006.1,PLACE,2,INDX,0))
"RTN","MAGQBUT",27,0)
 Q
"RTN","MAGQBUT",28,0)
CHGSERV(RESULT,NOTIFY) ;
"RTN","MAGQBUT",29,0)
 ; RPC[MAGQ FS CHNGE]
"RTN","MAGQBUT",30,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT",31,0)
 N SPACE,DATA,IEN,SIZE,CWL,MIN,CNT,TNODE,TINT,NOW,TLTIME,TOD,PLACE,TS,AUTON
"RTN","MAGQBUT",32,0)
 S U="^",(INDX,SPACE,SIZE,CNT)=0,(RESULT,IEN)=""
"RTN","MAGQBUT",33,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBUT",34,0)
 S MIN=$$SPARM
"RTN","MAGQBUT",35,0)
 S CWL=$$CWL^MAGBAPI(PLACE)
"RTN","MAGQBUT",36,0)
 S DATA=$S(CWL?1N.N:$G(^MAG(2005.2,CWL,0)),1:0)
"RTN","MAGQBUT",37,0)
 ;Check for scheduled purge
"RTN","MAGQBUT",38,0)
 S AUTON=$G(^MAG(2006.1,PLACE,5))
"RTN","MAGQBUT",39,0)
 I $P(AUTON,U,3) D
"RTN","MAGQBUT",40,0)
 . N T1,T2
"RTN","MAGQBUT",41,0)
 . S T1="0000",T2=$P(AUTON,U,5),T1=$E(T1,1,($L(T1)-$L(T2)))_T2
"RTN","MAGQBUT",42,0)
 . I ($$FMADD^XLFDT($$NOW^XLFDT,-$P(AUTON,U,4),"","",""))>($P(AUTON,U,6)_"."_T1) D
"RTN","MAGQBUT",43,0)
 . . S $P(RESULT,U,4)="PURGE"
"RTN","MAGQBUT",44,0)
 . . S $P(^MAG(2006.1,PLACE,5),U,6)=$P($$NOW^XLFDT,".")
"RTN","MAGQBUT",45,0)
 . . Q
"RTN","MAGQBUT",46,0)
 . Q
"RTN","MAGQBUT",47,0)
 I $P($G(^MAG(2006.1,PLACE,1)),U,10) D  Q  ;Cache balancing off
"RTN","MAGQBUT",48,0)
 . S SPACE=+$P($G(^MAG(2005.2,CWL,0)),U,5),SIZE=+$P($G(^MAG(2005.2,CWL,0)),U,3)
"RTN","MAGQBUT",49,0)
 . I (SIZE>0)&(((SPACE/SIZE)*100)>MIN) D  Q
"RTN","MAGQBUT",50,0)
 . . S $P(RESULT,U)=1
"RTN","MAGQBUT",51,0)
 . . D  Q
"RTN","MAGQBUT",52,0)
 . . . I SIZE S $P(RESULT,U,5)=$P(((SPACE/SIZE)*100),".")_"."_$E($P(((SPACE/SIZE)*100),".",2),1,2) Q
"RTN","MAGQBUT",53,0)
 . . . E  S $P(RESULT,U,5)="0.00" Q
"RTN","MAGQBUT",54,0)
 . E  D
"RTN","MAGQBUT",55,0)
 . . I SIZE S $P(RESULT,U,5)=$P(((SPACE/SIZE)*100),".")_"."_$E($P(((SPACE/SIZE)*100),".",2),1,2)
"RTN","MAGQBUT",56,0)
 . . E  S $P(RESULT,U,5)="0.00"
"RTN","MAGQBUT",57,0)
 . . S $P(RESULT,U)=$S(SPACE>0:2,1:0)
"RTN","MAGQBUT",58,0)
 . . S $P(RESULT,U,2,3)=$P(^MAG(2005.2,$P(^MAG(2006.1,PLACE,0),U,3),0),U,1,2)
"RTN","MAGQBUT",59,0)
 . . I ($P($G(^MAG(2006.1,PLACE,5)),U)&(SPACE>0)) S $P(RESULT,U,4)="PURGE" Q
"RTN","MAGQBUT",60,0)
 . . D:(NOTIFY!(SPACE>0)) TMESS(SPACE,PLACE)
"RTN","MAGQBUT",61,0)
 . . Q
"RTN","MAGQBUT",62,0)
 . Q
"RTN","MAGQBUT",63,0)
 D FSP(MIN,.SPACE,.SIZE,.IEN,.TS,PLACE)
"RTN","MAGQBUT",64,0)
 I SIZE S $P(RESULT,U,5)=$P(((SPACE/SIZE)*100),".")_"."_$E($P(((SPACE/SIZE)*100),".",2),1,2)
"RTN","MAGQBUT",65,0)
 E  S $P(RESULT,U,5)="0.00"
"RTN","MAGQBUT",66,0)
 I IEN D SCWL(IEN,PLACE)
"RTN","MAGQBUT",67,0)
 I SIZE>0,(((SPACE/SIZE)*100)>MIN) S $P(RESULT,U)=1 Q
"RTN","MAGQBUT",68,0)
 S $P(RESULT,U)=$S(SPACE>0:2,1:0)
"RTN","MAGQBUT",69,0)
 S $P(RESULT,U,2,3)=$P(^MAG(2005.2,$P(^MAG(2006.1,PLACE,0),U,3),0),U,1,2)
"RTN","MAGQBUT",70,0)
 I ($P($G(^MAG(2006.1,PLACE,5)),U)&(SPACE>0)) D  Q
"RTN","MAGQBUT",71,0)
 . S $P(RESULT,U,4)="PURGE"
"RTN","MAGQBUT",72,0)
 . D TPMESS^MAGQBUT5(PLACE)
"RTN","MAGQBUT",73,0)
 . Q
"RTN","MAGQBUT",74,0)
 D:(NOTIFY!(SPACE>0)) TMESS(TS,PLACE)
"RTN","MAGQBUT",75,0)
 Q
"RTN","MAGQBUT",76,0)
TMESS(TS,PLACE) ;Trigger a message
"RTN","MAGQBUT",77,0)
 N TN S TN=^MAG(2006.1,PLACE,3)
"RTN","MAGQBUT",78,0)
 Q:$$FMADD^XLFDT($P(TN,"^",11),"",$P(TN,"^",7),"","")>$$NOW^XLFDT
"RTN","MAGQBUT",79,0)
 D ICCL^MAGQBUT1(CNT_U_TS_U_SPACE_U_$P($G(^MAG(2006.1,PLACE,5)),U),$P(TN,"^",7)_" hours.",PLACE)
"RTN","MAGQBUT",80,0)
 Q
"RTN","MAGQBUT",81,0)
TPURGE ; 
"RTN","MAGQBUT",82,0)
 S $P(RESULT,U,2,3)=$P(^MAG(2005.2,$P(^MAG(2006.1,PLACE,0),U,3),0),1,2)
"RTN","MAGQBUT",83,0)
 S TNODE=^MAG(2006.1,PLACE,3)
"RTN","MAGQBUT",84,0)
 S TINT=$P(TNODE,"^",8) I "^W^D^"[("^"_TINT_"^") D  ;CONDITIONAL PURGE
"RTN","MAGQBUT",85,0)
 . S NOW=$$NOW^XLFDT,TOD=$P(TNODE,"^",9)
"RTN","MAGQBUT",86,0)
 . Q:NOW<$$FMADD^XLFDT($P(NOW,"."),"",TOD,"","")
"RTN","MAGQBUT",87,0)
 . S TLTIME=$P(TNODE,"^",10)
"RTN","MAGQBUT",88,0)
 . I NOW>$$FMADD^XLFDT(TLTIME,$S(TINT="D":1,TINT="W":7),"","","") D
"RTN","MAGQBUT",89,0)
 . . S $P(RESULT,"^",4)="PURGE"
"RTN","MAGQBUT",90,0)
 Q
"RTN","MAGQBUT",91,0)
MAXSP(IEN,FS,SZ,NODE,MIN) ;
"RTN","MAGQBUT",92,0)
 N SPACE,SIZE
"RTN","MAGQBUT",93,0)
 S SPACE=+$P(NODE,U,5),SIZE=+$P(NODE,U,3)
"RTN","MAGQBUT",94,0)
 I SIZE>0,(((SPACE/SIZE)*100)>MIN),SPACE>FS D  Q 1
"RTN","MAGQBUT",95,0)
 . S FS=SPACE,SZ=SIZE
"RTN","MAGQBUT",96,0)
 Q 0
"RTN","MAGQBUT",97,0)
HFIND(SHARE,IEN) ;HASHED SHARE AT THE SAME LOCATION
"RTN","MAGQBUT",98,0)
 N INDEX,NODE,RESULT
"RTN","MAGQBUT",99,0)
 S INDEX=0,RESULT=""
"RTN","MAGQBUT",100,0)
 F  S INDEX=$O(^MAG(2005.2,"AC",SHARE,INDEX)) Q:INDEX'?1N.N  D
"RTN","MAGQBUT",101,0)
 . Q:INDEX=IEN
"RTN","MAGQBUT",102,0)
 . I $P(^MAG(2005.2,INDEX,0),"^",8)="Y" S RESULT=1
"RTN","MAGQBUT",103,0)
 Q RESULT
"RTN","MAGQBUT",104,0)
SPARM() ;Site Parameter for PERCENT server space to be held in reserve
"RTN","MAGQBUT",105,0)
 N VALUE
"RTN","MAGQBUT",106,0)
 S VALUE=$P($G(^MAG(2006.1,$$PLACE^MAGBAPI(+$G(DUZ(2))),1)),U,8)
"RTN","MAGQBUT",107,0)
 Q $S(VALUE>0:VALUE,1:5)
"RTN","MAGQBUT",108,0)
SCWL(IEN,PLACE) ;
"RTN","MAGQBUT",109,0)
 S $P(^MAG(2006.1,PLACE,0),U,3)=IEN
"RTN","MAGQBUT",110,0)
 S $P(^MAG(2006.1,PLACE,"PACS"),U,3)=IEN
"RTN","MAGQBUT",111,0)
 Q
"RTN","MAGQBUT",112,0)
FSP(MIN,SPACE,SIZE,IEN,TOTAL,PLACE) ; Find Space
"RTN","MAGQBUT",113,0)
 N INDX,DATA S (TOTAL,INDX)=0
"RTN","MAGQBUT",114,0)
 F  S INDX=$O(^MAG(2005.2,INDX)) Q:INDX'?1N.N  D
"RTN","MAGQBUT",115,0)
 . S DATA=$G(^MAG(2005.2,INDX,0))
"RTN","MAGQBUT",116,0)
 . Q:$P(DATA,U,6,7)'["1^MAG"
"RTN","MAGQBUT",117,0)
 . Q:$P(DATA,U,9)="1"  ;ROUTING SHARE
"RTN","MAGQBUT",118,0)
 . Q:$P(DATA,U,10)'=PLACE
"RTN","MAGQBUT",119,0)
 . I $P(DATA,U,8)'="Y",$$HFIND($P(DATA,"^",2),INDX) Q
"RTN","MAGQBUT",120,0)
 . Q:$P(DATA,U,2)[":"
"RTN","MAGQBUT",121,0)
 . Q:$E($P(DATA,U,2),1,2)'="\\"
"RTN","MAGQBUT",122,0)
 . S TOTAL=TOTAL+(+$P(DATA,U,5))
"RTN","MAGQBUT",123,0)
 . S CNT=CNT+1
"RTN","MAGQBUT",124,0)
 . I $$MAXSP(INDX,.SPACE,.SIZE,DATA,MIN) S IEN=INDX
"RTN","MAGQBUT",125,0)
 Q
"RTN","MAGQBUT",126,0)
SLAD(RESULT) ;SITE LAST ACCESS DATE(DEFAULT TO 180)
"RTN","MAGQBUT",127,0)
 N PLACE
"RTN","MAGQBUT",128,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBUT",129,0)
 S RESULT=$S(+$P(^MAG(2006.1,PLACE,1),"^",2):+$P(^MAG(2006.1,PLACE,1),"^",2),1:180)
"RTN","MAGQBUT",130,0)
 Q
"RTN","MAGQBUT",131,0)
DQUE(QIEN) ;
"RTN","MAGQBUT",132,0)
 N ZNODE,TYPE,MAGIEN,PLACE,QP,QT
"RTN","MAGQBUT",133,0)
 S ZNODE=$G(^MAGQUEUE(2006.03,QIEN,0))
"RTN","MAGQBUT",134,0)
 S PLACE=$P(ZNODE,U,12)
"RTN","MAGQBUT",135,0)
 S TYPE=$P(ZNODE,U)
"RTN","MAGQBUT",136,0)
 I TYPE="" D DBQ(QIEN,PLACE,ZNODE) Q
"RTN","MAGQBUT",137,0)
 S QP=$O(^MAGQUEUE(2006.031,"C",PLACE,TYPE,""))
"RTN","MAGQBUT",138,0)
 L +^MAGQUEUE(2006.031,QP,0)
"RTN","MAGQBUT",139,0)
 S QT=+$P($G(^MAGQUEUE(2006.031,QP,0)),U,5)
"RTN","MAGQBUT",140,0)
 S $P(^MAGQUEUE(2006.031,QP,0),U,5)=QT-1
"RTN","MAGQBUT",141,0)
 L -^MAGQUEUE(2006.031,QP,0)
"RTN","MAGQBUT",142,0)
 K ^MAGQUEUE(2006.03,"C",PLACE,$P(ZNODE,U),QIEN)
"RTN","MAGQBUT",143,0)
 K ^MAGQUEUE(2006.03,QIEN,0)
"RTN","MAGQBUT",144,0)
 I $P(ZNODE,U,5)]"" D
"RTN","MAGQBUT",145,0)
 . K ^MAGQUEUE(2006.03,"D",PLACE,TYPE,$E($P(ZNODE,U,5),1,30),QIEN)
"RTN","MAGQBUT",146,0)
 L +^MAGQUEUE(2006.03,0)
"RTN","MAGQBUT",147,0)
 S $P(^MAGQUEUE(2006.03,0),"^",4)=$P(^MAGQUEUE(2006.03,0),"^",4)-1
"RTN","MAGQBUT",148,0)
 L -^MAGQUEUE(2006.03,0)
"RTN","MAGQBUT",149,0)
 Q:("^JBTOHD^PREFET^JUKEBOX^")'[("^"_TYPE_"^")
"RTN","MAGQBUT",150,0)
 S MAGIEN=$P(ZNODE,U,7)
"RTN","MAGQBUT",151,0)
 Q:'MAGIEN
"RTN","MAGQBUT",152,0)
 I TYPE="JUKEBOX" D  Q
"RTN","MAGQBUT",153,0)
 . K ^MAGQUEUE(2006.03,"E",PLACE,MAGIEN,QIEN)
"RTN","MAGQBUT",154,0)
 I "^JBTOHD^PREFET^"[("^"_TYPE_"^") D  Q
"RTN","MAGQBUT",155,0)
 . Q:$P(ZNODE,U,8)']""
"RTN","MAGQBUT",156,0)
 . K ^MAGQUEUE(2006.03,"F",PLACE,MAGIEN,$P(ZNODE,U,8),QIEN)
"RTN","MAGQBUT",157,0)
 . Q
"RTN","MAGQBUT",158,0)
 Q
"RTN","MAGQBUT",159,0)
DQUE1(RESULT,QIEN) ;[MAGQB QUEDEL]
"RTN","MAGQBUT",160,0)
 D DQUE(QIEN)
"RTN","MAGQBUT",161,0)
 Q
"RTN","MAGQBUT",162,0)
DBQ(QIEN,PLACE,ZNODE) ;
"RTN","MAGQBUT",163,0)
 N INDX
"RTN","MAGQBUT",164,0)
 F INDX="DELETE","ABSTRACT","JUKEBOX","JBTOHD","PREFET","IMPORT" D
"RTN","MAGQBUT",165,0)
 . K ^MAGQUEUE(2006.03,"C",PLACE,INDX,QIEN)
"RTN","MAGQBUT",166,0)
 . K:$P(ZNODE,U,5)]"" ^MAGQUEUE(2006.03,"D",PLACE,INDX,$E($P(ZNODE,U,5),1,30),QIEN)
"RTN","MAGQBUT",167,0)
 . I INDX="JUKEBOX" D
"RTN","MAGQBUT",168,0)
 . . K:$P(ZNODE,U,7) ^MAGQUEUE(2006.03,"E",PLACE,$P(ZNODE,U,7),QIEN) Q
"RTN","MAGQBUT",169,0)
 . I "^JBTOHD^PREFET^"[("^"_INDX_"^") D 
"RTN","MAGQBUT",170,0)
 . . K:($P(ZNODE,U,7)&$P(ZNODE,U,8)]"") ^MAGQUEUE(2006.03,"F",PLACE,$P(ZNODE,U,7),$P(ZNODE,U,8),QIEN) Q
"RTN","MAGQBUT",171,0)
 K ^MAGQUEUE(2006.03,QIEN,0)
"RTN","MAGQBUT",172,0)
 Q
"RTN","MAGQBUT",173,0)
JBQUE(RESULT,QIEN) ; RPC[MAGQBP JBQUE]
"RTN","MAGQBUT",174,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT",175,0)
 S RESULT=$$JUKEBOX^MAGBAPI(QIEN,$$PLACE^MAGBAPI(+$G(DUZ(2))))
"RTN","MAGQBUT",176,0)
 Q
"RTN","MAGQBUT",177,0)
POSTI ;
"RTN","MAGQBUT",178,0)
 D INI^MAGUSIT
"RTN","MAGQBUT",179,0)
 N DIC,X,DA,Y,NODE1,NODE3,PLACE,KEYS
"RTN","MAGQBUT",180,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBUT",181,0)
 Q:'PLACE
"RTN","MAGQBUT",182,0)
 S DIC="^MAG(2006.1,"_PLACE_",2,",DIC(0)="XL",X="TXT",DLAYGO="2006.112"
"RTN","MAGQBUT",183,0)
 S DA(1)=PLACE,DIC("P")="2006.112"
"RTN","MAGQBUT",184,0)
 D ^DIC
"RTN","MAGQBUT",185,0)
 S (DIE,DIC,DLAYGO)=2006.1,DA=PLACE,DIC(0)="XL"
"RTN","MAGQBUT",186,0)
 S NODE1=$G(^MAG(2006.1,1,1)),NODE3=$G(^MAG(2006.1,PLACE,3)),DR=""
"RTN","MAGQBUT",187,0)
 S KEYS=$G(^MAG(2006.1,PLACE,"KEYS"))
"RTN","MAGQBUT",188,0)
 S DR=$S(($P(NODE1,"^",2)'?1N.N):"8///45",1:DR)
"RTN","MAGQBUT",189,0)
 I ($P(NODE1,"^",5)'?1N.N) S DR=DR_$S((DR["/"):";",1:"")_"9///45"
"RTN","MAGQBUT",190,0)
 I ($P(NODE1,"^",10)'?1N.N) S DR=DR_$S((DR["/"):";",1:"")_"20///1"
"RTN","MAGQBUT",191,0)
 I ($P(NODE3,"^",1)'?1N.N) S DR=DR_$S((DR["/"):";",1:"")_"21///45"
"RTN","MAGQBUT",192,0)
 I ($P(NODE3,"^",2)'?1N.N) S DR=DR_$S((DR["/"):";",1:"")_"22///45"
"RTN","MAGQBUT",193,0)
 I ($P(NODE3,"^",3)'?1N.N) S DR=DR_$S((DR["/"):";",1:"")_"23///120"
"RTN","MAGQBUT",194,0)
 I ($P(NODE3,"^",4)'?1N.N) S DR=DR_$S((DR["/"):";",1:"")_"24///120"
"RTN","MAGQBUT",195,0)
 I ($P(NODE3,"^",5)'?1N.N) S DR=DR_$S((DR["/"):";",1:"")_"102///10"
"RTN","MAGQBUT",196,0)
 I ($P(NODE3,"^",6)'?1N.N) S DR=DR_$S((DR["/"):";",1:"")_"103///15"
"RTN","MAGQBUT",197,0)
 I ($P(NODE3,"^",7)'?1N.N) S DR=DR_$S((DR["/"):";",1:"")_"11.5///6"
"RTN","MAGQBUT",198,0)
 S DR=DR_$S((DR["/"):";",1:"")_"11.6///D"
"RTN","MAGQBUT",199,0)
 I ($P(NODE3,"^",9)'?1N.N) S DR=DR_$S((DR["/"):";",1:"")_"11.7///4"
"RTN","MAGQBUT",200,0)
 I ($P(NODE3,"^",10)'?1N.E) D
"RTN","MAGQBUT",201,0)
 . S DR=DR_$S((DR["/"):";",1:"")_"11.8///"_$$NOW^XLFDT
"RTN","MAGQBUT",202,0)
 I ($P(NODE3,"^",11)'?1N.E) D
"RTN","MAGQBUT",203,0)
 . S DR=DR_$S((DR["/"):";",1:"")_"11.9///"_$$NOW^XLFDT
"RTN","MAGQBUT",204,0)
 I ($P(KEYS,"^",2)'?1N.N) S DR=DR_$S((DR["/"):";",1:"")_"121///60"
"RTN","MAGQBUT",205,0)
 I ($P(KEYS,"^",3)'?1N.N) S DR=DR_$S((DR["/"):";",1:"")_"122///90"
"RTN","MAGQBUT",206,0)
 D ^DIE
"RTN","MAGQBUT",207,0)
 ; Enable the Imaging Health Summary component
"RTN","MAGQBUT",208,0)
 I $D(^GMT(142.1,235)) D
"RTN","MAGQBUT",209,0)
 . S (DIE,DIC)=142.1,DA=235
"RTN","MAGQBUT",210,0)
 . S DR="5///@;8///@"
"RTN","MAGQBUT",211,0)
 . D ^DIE
"RTN","MAGQBUT",212,0)
 K DIE,DIC,DA,Y,X,DLAYGO,DR
"RTN","MAGQBUT",213,0)
 D MMGRP^MAGQAI
"RTN","MAGQBUT",214,0)
 Q
"RTN","MAGQBUT",215,0)
X1 ; CLEANUP
"RTN","MAGQBUT",216,0)
 N PC
"RTN","MAGQBUT",217,0)
 S DIR(0)="Y",DIR("B")="YES"
"RTN","MAGQBUT",218,0)
 S DIR("?")="This activity removes already processed queues which precede the current queue pointer.  These queues are not necessary for file recovery.The current BP software will recover files during purge or by the verify."
"RTN","MAGQBUT",219,0)
 S DIR("A")="Do you wish to remove old processed Background Processor Queues" D
"RTN","MAGQBUT",220,0)
 . D ^DIR Q:($D(DIRUT)!(Y'="1"))
"RTN","MAGQBUT",221,0)
 . F PC="JUKEBOX","JBTOHD","PREFET","IMPORT","GCC","DELETE" D FOQUE("",PC)
"RTN","MAGQBUT",222,0)
 ; REINDEX FIELD 4 (COMPLETION STATUS) IN FILE 2006.03 (QUEUE)
"RTN","MAGQBUT",223,0)
 K DIR
"RTN","MAGQBUT",224,0)
 K ^MAGQUEUE(2006.03,"C")
"RTN","MAGQBUT",225,0)
 S DIK="^MAGQUEUE(2006.03,"
"RTN","MAGQBUT",226,0)
 D IXALL^DIK K DIK
"RTN","MAGQBUT",227,0)
 K DIRUT
"RTN","MAGQBUT",228,0)
 Q
"RTN","MAGQBUT",229,0)
FOQUE(RESULT,PROC) ;[MAGQ COQ] PASS A BP PROCESS TO DELETE OLD FAILED QUEUES
"RTN","MAGQBUT",230,0)
 N XX,JXMAX,JHMAX,QIEN,PLACE,LQP,CNT
"RTN","MAGQBUT",231,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2))),CNT=0
"RTN","MAGQBUT",232,0)
 S QIEN=$O(^MAGQUEUE(2006.031,"C",PLACE,PROC,""))
"RTN","MAGQBUT",233,0)
 I QIEN D
"RTN","MAGQBUT",234,0)
 . S LQP=$P($G(^MAGQUEUE(2006.031,QIEN,0)),"^",2)
"RTN","MAGQBUT",235,0)
 . Q:'LQP
"RTN","MAGQBUT",236,0)
 . S XX=0
"RTN","MAGQBUT",237,0)
 . F  S XX=$O(^MAGQUEUE(2006.03,"C",PLACE,PROC,XX)) Q:'XX  Q:XX>(LQP)  D
"RTN","MAGQBUT",238,0)
 . . S CNT=CNT+1
"RTN","MAGQBUT",239,0)
 . . D DQUE(XX)
"RTN","MAGQBUT",240,0)
 S RESULT=CNT
"RTN","MAGQBUT",241,0)
 Q
"RTN","MAGQBUT1")
0^14^B75489141
"RTN","MAGQBUT1",1,0)
MAGQBUT1 ;WOIFO/RP; Utilities for Background [ 03/25/2001 11:20 ]
"RTN","MAGQBUT1",2,0)
 ;;3.0;IMAGING;**7,8,20**;Apr 12, 2006
"RTN","MAGQBUT1",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBUT1",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBUT1",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBUT1",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBUT1",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBUT1",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBUT1",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBUT1",10,0)
 ;; |                                                               |
"RTN","MAGQBUT1",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBUT1",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBUT1",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBUT1",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBUT1",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBUT1",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBUT1",17,0)
 ;;
"RTN","MAGQBUT1",18,0)
 Q
"RTN","MAGQBUT1",19,0)
BPPS(INPUT,WS,PROCESS) ;INPUT TRANSFORM FOR FILE 2006.8
"RTN","MAGQBUT1",20,0)
 N IEN,FND,WSNAME,WSNAME2,ZNODE,PIECE,MAGX,MAGY,PLACE
"RTN","MAGQBUT1",21,0)
 S U="^"
"RTN","MAGQBUT1",22,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBUT1",23,0)
 Q:'(+$P($G(^MAG(2006.8,WS,0)),U,12)) 0  ;NOT A BACKGROUND PROCESSOR
"RTN","MAGQBUT1",24,0)
 Q:'INPUT 1
"RTN","MAGQBUT1",25,0)
 S WSNAME=$$UPPER^MAGQE4($P($G(^MAG(2006.8,WS,1)),U)) ;Workstation Name
"RTN","MAGQBUT1",26,0)
 Q:$L(WSNAME)<3 0 ;BP WS NOT PROPERLY INSTALLED
"RTN","MAGQBUT1",27,0)
 Q:$O(^MAG(2006.8,"C",PLACE,WSNAME,""))'?1N.N 0
"RTN","MAGQBUT1",28,0)
 F MAGX=12,13,14,15,16,17,20 D  Q:MAGY=PROCESS
"RTN","MAGQBUT1",29,0)
 . S MAGY=$$GET1^DID(2006.8,MAGX,"","LABEL")
"RTN","MAGQBUT1",30,0)
 . D:MAGY=PROCESS
"RTN","MAGQBUT1",31,0)
 . . S PIECE=$$GET1^DID(2006.8,MAGX,"","GLOBAL SUBSCRIPT LOCATION")
"RTN","MAGQBUT1",32,0)
 Q:MAGY'=PROCESS 0
"RTN","MAGQBUT1",33,0)
 S PIECE=$P(PIECE,";",2)
"RTN","MAGQBUT1",34,0)
 S IEN=0,WSNAME2="",FND=0
"RTN","MAGQBUT1",35,0)
 F  S WSNAME2=$$UPPER^MAGQE4($O(^MAG(2006.8,"C",PLACE,WSNAME2))) Q:WSNAME2=""  D  Q:FND
"RTN","MAGQBUT1",36,0)
 . Q:WSNAME2=WSNAME
"RTN","MAGQBUT1",37,0)
 . S IEN=$O(^MAG(2006.8,"C",PLACE,WSNAME2,"")) Q:IEN'?1N.N
"RTN","MAGQBUT1",38,0)
 . S ZNODE=$G(^MAG(2006.8,IEN,0))
"RTN","MAGQBUT1",39,0)
 . Q:$P(ZNODE,"^",12)'="1"
"RTN","MAGQBUT1",40,0)
 . S:($P(ZNODE,"^",PIECE)="1") FND="1"
"RTN","MAGQBUT1",41,0)
 Q $S(FND="1":0,1:1)
"RTN","MAGQBUT1",42,0)
RSQUE(RESULT,IEN,QUEUE) ;[MAGQB RSQUE]
"RTN","MAGQBUT1",43,0)
 N PTR,PLACE
"RTN","MAGQBUT1",44,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBUT1",45,0)
 S PTR=$O(^MAGQUEUE(2006.031,"C",PLACE,QUEUE,""))
"RTN","MAGQBUT1",46,0)
 I $P(^MAGQUEUE(2006.031,PTR,0),"^")=QUEUE D
"RTN","MAGQBUT1",47,0)
 . S $P(^MAGQUEUE(2006.031,PTR,0),"^",2)=IEN
"RTN","MAGQBUT1",48,0)
 . ;D RQCNT^MAGQBTM(PLACE)
"RTN","MAGQBUT1",49,0)
 Q
"RTN","MAGQBUT1",50,0)
ICCL(SRVRCNT,NMESS,PLACE) ;UPDATE IMAGING DISTRIBUTION
"RTN","MAGQBUT1",51,0)
 N Y,LOC,INDEX,CNT,IEN,ARRAY,SUB1,SUB2,NAME
"RTN","MAGQBUT1",52,0)
 D NOW^%DTC S Y=% D DD^%DT
"RTN","MAGQBUT1",53,0)
 S LOC=$$KSP^XUPARAM("WHERE")
"RTN","MAGQBUT1",54,0)
 S CNT=1,^TMP($J,"MAGQ",CNT)="SITE: "_LOC
"RTN","MAGQBUT1",55,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",CNT)="DATE: "_Y_" "_$G(^XMB("TIMEZONE"))
"RTN","MAGQBUT1",56,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",CNT)="SENDER: "_$$PLNM^MAGQBUT5(PLACE)_" Imaging Background Processor"
"RTN","MAGQBUT1",57,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",CNT)="Total Cache Free: "_$P(SRVRCNT,U,2)_" gigabytes"
"RTN","MAGQBUT1",58,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",CNT)="Total Cache Available: "_$P(SRVRCNT,U,3)_" gigabytes"
"RTN","MAGQBUT1",59,0)
 I $P(SRVRCNT,U,4) S CNT=CNT+1,^TMP($J,"MAGQ",CNT)="An Automatic Purge process has been Activated."
"RTN","MAGQBUT1",60,0)
 E  S CNT=CNT+1,^TMP($J,"MAGQ",CNT)="The Automatic Purge process is NOT configured."
"RTN","MAGQBUT1",61,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",CNT)="The "_$P(SRVRCNT,U)_" Imaging cache servers will"
"RTN","MAGQBUT1",62,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",CNT)="require operator intervention to ensure continued"
"RTN","MAGQBUT1",63,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",CNT)="availability.  The following MAG SERVER members"
"RTN","MAGQBUT1",64,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",CNT)="are being notified:"
"RTN","MAGQBUT1",65,0)
 S INDEX=0,IEN=$$FIND1^DIC(3.8,"","MX","MAG SERVER","","","ERR")
"RTN","MAGQBUT1",66,0)
 Q:IEN'?1N.N
"RTN","MAGQBUT1",67,0)
 D GETS^DIQ(3.8,IEN_",","2*;11*;12*","","ARRAY")
"RTN","MAGQBUT1",68,0)
 S (SUB1,SUB2)=""
"RTN","MAGQBUT1",69,0)
 F  S SUB1=$O(ARRAY(SUB1)) Q:SUB1=""  D
"RTN","MAGQBUT1",70,0)
 . F  S SUB2=$O(ARRAY(SUB1,SUB2)) Q:SUB2=""  D
"RTN","MAGQBUT1",71,0)
 . . S NAME=$G(ARRAY(SUB1,SUB2,".01")) D:NAME'=""
"RTN","MAGQBUT1",72,0)
 . . . S CNT=CNT+1,^TMP($J,"MAGQ",8+CNT)=NAME
"RTN","MAGQBUT1",73,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",CNT)="The next notifications will occur in:"
"RTN","MAGQBUT1",74,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",CNT)=NMESS
"RTN","MAGQBUT1",75,0)
 D MAILIT
"RTN","MAGQBUT1",76,0)
 S $P(^MAG(2006.1,$$PLACE^MAGBAPI($G(DUZ(2))),3),"^",11)=$$NOW^XLFDT
"RTN","MAGQBUT1",77,0)
 K ARRAY
"RTN","MAGQBUT1",78,0)
 Q
"RTN","MAGQBUT1",79,0)
MAILIT ;Send the report to the Clinical Application Time
"RTN","MAGQBUT1",80,0)
 N XMSUB
"RTN","MAGQBUT1",81,0)
 S XMSUB="Image Cache Critically Low at "_LOC
"RTN","MAGQBUT1",82,0)
MAILSHR ;Shared Mail server code
"RTN","MAGQBUT1",83,0)
 ;If dropping in...must manage XMSUB
"RTN","MAGQBUT1",84,0)
 N XMY,XMTEXT
"RTN","MAGQBUT1",85,0)
 S XMTEXT="^TMP($J,""MAGQ"","
"RTN","MAGQBUT1",86,0)
 S:$G(DUZ) XMY(DUZ)=""
"RTN","MAGQBUT1",87,0)
 S XMY("G.MAG SERVER")=""
"RTN","MAGQBUT1",88,0)
 S:$G(MAGDUZ) XMY(MAGDUZ)=""
"RTN","MAGQBUT1",89,0)
 D ^XMD
"RTN","MAGQBUT1",90,0)
 K ^TMP($J,"MAGQ")
"RTN","MAGQBUT1",91,0)
 Q
"RTN","MAGQBUT1",92,0)
ALLSERV(RESULT) ;
"RTN","MAGQBUT1",93,0)
 ; RPC[MAGQ ALL SERVER]
"RTN","MAGQBUT1",94,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT1",95,0)
 N INDX,DATA,CNT,SHARE,CWL,VALUE,TMP,PLACE ;CWL=CURRENT WRITE LOCATION
"RTN","MAGQBUT1",96,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBUT1",97,0)
 S CWL=$$CWL^MAGBAPI(PLACE)
"RTN","MAGQBUT1",98,0)
 I CWL D
"RTN","MAGQBUT1",99,0)
 . S DATA=$G(^MAG(2005.2,CWL,0))
"RTN","MAGQBUT1",100,0)
 . S SHARE=$P(DATA,U,2)
"RTN","MAGQBUT1",101,0)
 . S RESULT(0)=SHARE_U_CWL_U_+$P(DATA,U,5)_U_+$P(DATA,U,3)_U_$P(DATA,U)
"RTN","MAGQBUT1",102,0)
 . Q
"RTN","MAGQBUT1",103,0)
 E  S RESULT(0)="-1^The Current Write Location (CWL) could not be set."
"RTN","MAGQBUT1",104,0)
 S INDX=0,U="^",CNT=1
"RTN","MAGQBUT1",105,0)
 K ^TMP("MAGQAS")
"RTN","MAGQBUT1",106,0)
 F  S INDX=$O(^MAG(2005.2,INDX)) Q:INDX'?1N.N  D
"RTN","MAGQBUT1",107,0)
 . S DATA=$G(^MAG(2005.2,INDX,0))
"RTN","MAGQBUT1",108,0)
 . Q:$P(DATA,U,6,7)'["1^MAG"
"RTN","MAGQBUT1",109,0)
 . Q:$P(DATA,U,2)[":"
"RTN","MAGQBUT1",110,0)
 . Q:($P(DATA,U,10)'=PLACE)
"RTN","MAGQBUT1",111,0)
 . Q:$P(DATA,U,9)="1"  ;ROUTING SHARE
"RTN","MAGQBUT1",112,0)
 . S SHARE=$P(DATA,U,2)
"RTN","MAGQBUT1",113,0)
 . Q:$E(SHARE,1,2)'="\\"
"RTN","MAGQBUT1",114,0)
 . I $E(SHARE,$L(SHARE))="\" S SHARE=$E(SHARE,1,$L(SHARE)-1)
"RTN","MAGQBUT1",115,0)
 . S TMP(SHARE)=""
"RTN","MAGQBUT1",116,0)
 . S VALUE=SHARE_U_INDX_U_+$P(DATA,U,5)_U_+$P(DATA,U,3)_U_$P(DATA,U)
"RTN","MAGQBUT1",117,0)
 . I INDX=CWL D  Q  ;ELSE CONTINUE 
"RTN","MAGQBUT1",118,0)
 . . S RESULT(0)=VALUE_U_$G(^TMP("MAGQ","WSUD"))
"RTN","MAGQBUT1",119,0)
 . . S ^TMP("MAGQAS",0)=VALUE ;1ST SHARE=CWL
"RTN","MAGQBUT1",120,0)
 . S RESULT(CNT)=VALUE,CNT=CNT+1
"RTN","MAGQBUT1",121,0)
 . S ^TMP("MAGQAS",CNT-1)=VALUE
"RTN","MAGQBUT1",122,0)
 Q
"RTN","MAGQBUT1",123,0)
ALLSHR(RESULT) ; RPC[MAGQBP ALL SHARES]
"RTN","MAGQBUT1",124,0)
 N TMP,INDX,DATA,CNT,SHARE,CWL,VALUE,PLACE ;CWL=CURRENT WRITE LOCATION
"RTN","MAGQBUT1",125,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT1",126,0)
 S (CNT,INDX)=0,U="^"
"RTN","MAGQBUT1",127,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBUT1",128,0)
 S CWL=$$CWL^MAGBAPI(PLACE)
"RTN","MAGQBUT1",129,0)
 F  S INDX=$O(^MAG(2005.2,INDX)) Q:INDX'?1N.N  D
"RTN","MAGQBUT1",130,0)
 . S DATA=$G(^MAG(2005.2,INDX,0))
"RTN","MAGQBUT1",131,0)
 . Q:$P(DATA,U,6,7)'["1^MAG"
"RTN","MAGQBUT1",132,0)
 . Q:$P(DATA,U,9)="1"  ;ROUTING SHARE
"RTN","MAGQBUT1",133,0)
 . Q:$P(DATA,U,2)[":"
"RTN","MAGQBUT1",134,0)
 . Q:($P(DATA,U,10)'=PLACE)
"RTN","MAGQBUT1",135,0)
 . S SHARE=$P(DATA,U,2)
"RTN","MAGQBUT1",136,0)
 . Q:$E(SHARE,1,2)'="\\"
"RTN","MAGQBUT1",137,0)
 . I $E(SHARE,$L(SHARE))="\" S SHARE=$E(SHARE,1,$L(SHARE)-1)
"RTN","MAGQBUT1",138,0)
 . Q:$D(TMP(SHARE))
"RTN","MAGQBUT1",139,0)
 . S TMP(SHARE)=""
"RTN","MAGQBUT1",140,0)
 S INDX=""
"RTN","MAGQBUT1",141,0)
 F  S INDX=$O(TMP(INDX)) Q:INDX=""  D
"RTN","MAGQBUT1",142,0)
 . S RESULT(CNT)=INDX,CNT=CNT+1
"RTN","MAGQBUT1",143,0)
 K TMP
"RTN","MAGQBUT1",144,0)
 Q
"RTN","MAGQBUT1",145,0)
FSUPDT(RESULT,IEN,SPACE,SIZE) ;
"RTN","MAGQBUT1",146,0)
 ;File Server Update
"RTN","MAGQBUT1",147,0)
 ; RPC[MAGQ FS UPDATE]
"RTN","MAGQBUT1",148,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT1",149,0)
 N NODE,X,Y,INDEX,SHNAME,PLACE
"RTN","MAGQBUT1",150,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBUT1",151,0)
 S X=$$NOW^XLFDT S Y=X D DD^%DT S ^TMP("MAGQ","WSUD")=Y
"RTN","MAGQBUT1",152,0)
 S ^TMP("MAGQ","WSUD",XWBTIP)=Y
"RTN","MAGQBUT1",153,0)
 I $G(^MAG(2005.2,IEN,0))="" S RESULT="-1^No Network Location Entry" Q
"RTN","MAGQBUT1",154,0)
 S NODE=^MAG(2005.2,IEN,0)
"RTN","MAGQBUT1",155,0)
 D FSW(IEN,NODE)
"RTN","MAGQBUT1",156,0)
 S INDEX=0,SHNAME=$P(NODE,"^",2)
"RTN","MAGQBUT1",157,0)
 ; NOW UPDATE THE SIZING FIELDS FOR SHARES OF SAME PHYS LOCATION
"RTN","MAGQBUT1",158,0)
 F  S INDEX=$O(^MAG(2005.2,"AC",SHNAME,INDEX)) Q:INDEX'?1N.N  D
"RTN","MAGQBUT1",159,0)
 . Q:INDEX=IEN
"RTN","MAGQBUT1",160,0)
 . S NODE=^MAG(2005.2,INDEX,0)
"RTN","MAGQBUT1",161,0)
 . D FSW(INDEX,NODE)
"RTN","MAGQBUT1",162,0)
 S RESULT="1^Update Complete"
"RTN","MAGQBUT1",163,0)
 Q
"RTN","MAGQBUT1",164,0)
FSW(INDEX,NODE) ;
"RTN","MAGQBUT1",165,0)
 I (($P(NODE,"^",3)'=(+SIZE))!($P(NODE,"^",5)'=(+SPACE))) D
"RTN","MAGQBUT1",166,0)
 . S $P(NODE,"^",3)=+SIZE,$P(NODE,"^",5)=+SPACE,^MAG(2005.2,INDEX,0)=NODE
"RTN","MAGQBUT1",167,0)
 Q
"RTN","MAGQBUT1",168,0)
QUEUER(QUE,FROM,TO) ;
"RTN","MAGQBUT1",169,0)
 N TYPE,INC,CNT,AR,TMP,PLACE,INST,MAGFILE
"RTN","MAGQBUT1",170,0)
 I $$GET1^DIQ(200,+$G(DUZ),.01)="" D  Q
"RTN","MAGQBUT1",171,0)
 . W !,"You must have a valid User ID (DUZ) to use this function!"
"RTN","MAGQBUT1",172,0)
 I "^JBTOHD^PREFET^ABSTRACT^JUKEBOX^GCC^DELETE^EVAL^"'[QUE D  Q
"RTN","MAGQBUT1",173,0)
 . W !,"Only JBTOHD, PREFET, ABSTRACT, JUKEBOX, DELETE, EVAL & GCC queues are valid!"
"RTN","MAGQBUT1",174,0)
 . W !,"Input values: ""Queue type"",""From Image IEN"",""To Image IEN"""
"RTN","MAGQBUT1",175,0)
 S CNT=0
"RTN","MAGQBUT1",176,0)
 ;
"RTN","MAGQBUT1",177,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBUT1",178,0)
 ;
"RTN","MAGQBUT1",179,0)
 S INST=$$GET1^DIQ(2006.1,PLACE,.01,"I")
"RTN","MAGQBUT1",180,0)
 F INC=FROM:1:TO D
"RTN","MAGQBUT1",181,0)
 . I ('$D(^MAG(2005,INC,0))&('$D(^MAG(2005.1,INC,0)))) Q
"RTN","MAGQBUT1",182,0)
 . I ($P($G(^MAG(2005,INC,100)),U,3)'=INST)&($P($G(^MAG(2005.1,INC,100)),U,3)'=INST) Q
"RTN","MAGQBUT1",183,0)
 . I ($P($G(^MAG(2005,INC,0)),"^",2)="")&($P($G(^MAG(2005.1,INC,0)),"^",2)="") Q  ;No full filename attribute
"RTN","MAGQBUT1",184,0)
 . I (+$P($G(^MAG(2005,INC,1,0)),"^",4)>0)!(+$P($G(^MAG(2005.1,INC,1,0)),"^",4)>0) Q  ;GROUP PARENT
"RTN","MAGQBUT1",185,0)
 . I "^DELETE^"[QUE D  Q
"RTN","MAGQBUT1",186,0)
 . . S MAGXX=INC D VSTNOCP^MAGFILEB I $P(MAGFILE,U)="-1" W !,"Image # "_INC Q 
"RTN","MAGQBUT1",187,0)
 . . S MAGXX=INC D ABSNOCP^MAGFILEB I $P(MAGFILE,U)="-1" W !,"Image # "_INC Q
"RTN","MAGQBUT1",188,0)
 . . S MAGXX=INC D BIGNOCP^MAGFILEB I $P(MAGFILE,U)="-1" W !,"Image # "_INC Q
"RTN","MAGQBUT1",189,0)
 . . D IMAGEDEL^MAGGTID(.MAGFILE,INC,"","TESTING") Q
"RTN","MAGQBUT1",190,0)
 . I "^JBTOHD^PREFET^"[QUE F TYPE="ABSTRACT","FULL","BIG" D
"RTN","MAGQBUT1",191,0)
 . . Q:(TYPE="BIG")&('$D(^MAG(2005,INC,"FBIG"))&'$D(^MAG(2005.1,INC,"FBIG")))
"RTN","MAGQBUT1",192,0)
 . . D MAPI(QUE,INC_"^"_TYPE,.CNT)
"RTN","MAGQBUT1",193,0)
 . E  D MAPI(QUE,INC,.CNT)
"RTN","MAGQBUT1",194,0)
 Q
"RTN","MAGQBUT1",195,0)
MPAC(SW,FROM,TO) ;
"RTN","MAGQBUT1",196,0)
 N INDEX
"RTN","MAGQBUT1",197,0)
 I (SW'=1)&(SW'=0) W !,"The first parameter must equal 0 or 1" Q
"RTN","MAGQBUT1",198,0)
 I (FROM<0)!((TO<0)!(TO<FROM)) W !,"The second parameter must be greater than 0 and less than the third!" Q
"RTN","MAGQBUT1",199,0)
 S FROM=FROM-1
"RTN","MAGQBUT1",200,0)
 F  S INDEX=$O(^MAG(2005,INDEX)) Q:INDEX'?1N.N  Q:INDEX>TO  D
"RTN","MAGQBUT1",201,0)
 . I '$D(^MAG(2005,INDEX,0)) Q
"RTN","MAGQBUT1",202,0)
 . I $P($G(^MAG(2005,INDEX,0)),"^",2)="" Q  ;No full filename attribute
"RTN","MAGQBUT1",203,0)
 . I +$P($G(^MAG(2005,INDEX,1,0)),"^",4)>0 Q  ;GROUP PARENT
"RTN","MAGQBUT1",204,0)
 . I (SW=1)&('$D(^MAG(2005,INDEX,"PACS"))) S ^MAG(2005,INDEX,"PACS")="TEST PACS" Q
"RTN","MAGQBUT1",205,0)
 . I SW=0 K ^MAG(2005,INDEX,"PACS")
"RTN","MAGQBUT1",206,0)
 Q
"RTN","MAGQBUT1",207,0)
MAPI(TYP,PARAM,CNT) ;
"RTN","MAGQBUT1",208,0)
 N PLACE
"RTN","MAGQBUT1",209,0)
 S CNT=CNT+1,PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBUT1",210,0)
 W !,CNT," TYPE: ",TYP,": ",PARAM_" QUEUE #: ",@("$$"_TYP_"^MAGBAPI(PARAM,PLACE)")
"RTN","MAGQBUT1",211,0)
 Q
"RTN","MAGQBUT1",212,0)
BPQSL(RESULT,TYPE) ;
"RTN","MAGQBUT1",213,0)
 ; RPC[MAGQB QSL]
"RTN","MAGQBUT1",214,0)
 N STATUS,CNT,IEN,CP,PLACE
"RTN","MAGQBUT1",215,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGQBUT1",216,0)
 S STATUS="",CNT=0
"RTN","MAGQBUT1",217,0)
 F  S STATUS=$O(^MAGQUEUE(2006.03,"D",PLACE,TYPE,STATUS)) Q:STATUS=""  D
"RTN","MAGQBUT1",218,0)
 . Q:+STATUS>0
"RTN","MAGQBUT1",219,0)
 . S IEN=$O(^MAGQUEUE(2006.03,"D",PLACE,TYPE,STATUS,""))
"RTN","MAGQBUT1",220,0)
 . S CP=$P(^MAGQUEUE(2006.031,$O(^MAGQUEUE(2006.031,"C",PLACE,TYPE,"")),0),"^",2)
"RTN","MAGQBUT1",221,0)
 . Q:IEN>(CP)
"RTN","MAGQBUT1",222,0)
 . S CNT=CNT+1,RESULT(CNT)=STATUS
"RTN","MAGQBUT1",223,0)
 Q
"RTN","MAGQBUT2")
0^15^B73670919
"RTN","MAGQBUT2",1,0)
MAGQBUT2 ;WOIFO/SRR/RMP -IMAGE SITE PARAMETERS COMPANION [ 11/08/2001 17:18 ]
"RTN","MAGQBUT2",2,0)
 ;;3.0;IMAGING;**7,8,20**;Apr 12, 2006
"RTN","MAGQBUT2",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBUT2",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBUT2",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBUT2",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBUT2",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBUT2",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBUT2",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBUT2",10,0)
 ;; |                                                               |
"RTN","MAGQBUT2",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBUT2",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBUT2",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBUT2",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBUT2",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBUT2",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBUT2",17,0)
 ;;
"RTN","MAGQBUT2",18,0)
VSTAV() ;
"RTN","MAGQBUT2",19,0)
 N VER,IEN,ARRAY,VALUE,LATEST
"RTN","MAGQBUT2",20,0)
 S VER=$$VERSION^XPDUTL("IMAGING")
"RTN","MAGQBUT2",21,0)
 S:$T(LAST^XPDUTL)]"" VER=VER_"^"_$$LAST^XPDUTL("IMAGING",VER)
"RTN","MAGQBUT2",22,0)
 Q VER
"RTN","MAGQBUT2",23,0)
IWSV(WSD,WSC,WSV,PLACE) ;IMAGE WORKSTATION VERSIONS
"RTN","MAGQBUT2",24,0)
 N IEN,NODE,RD,OS
"RTN","MAGQBUT2",25,0)
 S RD=$$FMADD^XLFDT($$NOW^XLFDT,-180,"","","")
"RTN","MAGQBUT2",26,0)
 S IEN=0
"RTN","MAGQBUT2",27,0)
 F  S IEN=$O(^MAG(2006.81,"C",PLACE,IEN)) Q:IEN'?1N.N  D
"RTN","MAGQBUT2",28,0)
 . S NODE=^MAG(2006.81,IEN,0)
"RTN","MAGQBUT2",29,0)
 . Q:($P(NODE,U,3)<RD)
"RTN","MAGQBUT2",30,0)
 . S OS=$P($G(^MAG(2006.81,IEN,1)),U,2)
"RTN","MAGQBUT2",31,0)
 . I $P(NODE,"^",9)'="" D
"RTN","MAGQBUT2",32,0)
 . . S INDEX=$P(NODE,"^",9),INDEX=$S(OS="":INDEX,1:INDEX_U_OS)
"RTN","MAGQBUT2",33,0)
 . . S WSD(INDEX)=$G(WSD(INDEX))+1
"RTN","MAGQBUT2",34,0)
 . I $P(NODE,"^",13)'="" D
"RTN","MAGQBUT2",35,0)
 . . S INDEX=$P(NODE,"^",13),INDEX=$S(OS="":INDEX,1:INDEX_U_OS)
"RTN","MAGQBUT2",36,0)
 . . S WSC(INDEX)=$G(WSC(INDEX))+1
"RTN","MAGQBUT2",37,0)
 . I $P(NODE,"^",15)'="" D
"RTN","MAGQBUT2",38,0)
 . . S INDEX=$P(NODE,"^",15),INDEX=$S(OS="":INDEX,1:INDEX_U_OS)
"RTN","MAGQBUT2",39,0)
 . . S WSV(INDEX)=$G(WSV(INDEX))+1
"RTN","MAGQBUT2",40,0)
 Q
"RTN","MAGQBUT2",41,0)
DICOMV(DCMG) ;Version of DICOM
"RTN","MAGQBUT2",42,0)
 N X,ARRAY,IEN,NAME
"RTN","MAGQBUT2",43,0)
 S X=""
"RTN","MAGQBUT2",44,0)
 F  S X=$O(^MAG(2006.83,"B",X)) Q:X=""  D
"RTN","MAGQBUT2",45,0)
 . S IEN=$O(^MAG(2006.83,"B",X,"")) Q:IEN'?1N.N
"RTN","MAGQBUT2",46,0)
 . S DCMG($P(^MAG(2006.83,IEN,0),U,3))=$G(DCMG($P(^MAG(2006.83,IEN,0),U,3)))+1
"RTN","MAGQBUT2",47,0)
 Q $S($D(DCMG):1,1:0)
"RTN","MAGQBUT2",48,0)
VISTARV() ;
"RTN","MAGQBUT2",49,0)
 Q $$VERSION^XPDUTL("MAGJ RADIOLOGY")
"RTN","MAGQBUT2",50,0)
MAGSYS(LIST) ;
"RTN","MAGQBUT2",51,0)
 N VAIEN,NODE,MGIEN,UNAME,TDATE
"RTN","MAGQBUT2",52,0)
 S MGIEN=$$FIND1^DIC(3.8,"","MX","MAG SERVER","","","ERR")
"RTN","MAGQBUT2",53,0)
 S VAIEN=0
"RTN","MAGQBUT2",54,0)
 F  S VAIEN=$O(^XUSEC("MAG SYSTEM",VAIEN)) Q:VAIEN'?1N.N  D
"RTN","MAGQBUT2",55,0)
 . S UNAME=$$GET1^DIQ(200,VAIEN,.01)
"RTN","MAGQBUT2",56,0)
 . Q:UNAME=""
"RTN","MAGQBUT2",57,0)
 . ;CHECK FOR TERMINATION DATE
"RTN","MAGQBUT2",58,0)
 . S TDATE=$$GET1^DIQ(200,VAIEN,9.2)
"RTN","MAGQBUT2",59,0)
 . Q:((TDATE'="")&(TDATE<$$NOW^XLFDT))
"RTN","MAGQBUT2",60,0)
 . ;the next line screens existing 'MAG SERVER' members
"RTN","MAGQBUT2",61,0)
 . I MGIEN?1N.N,$$FIND1^DIC(3.81,","_MGIEN_",","QA",VAIEN,"","","ERR") Q
"RTN","MAGQBUT2",62,0)
 . S LIST(VAIEN)=VAIEN_"^"_UNAME
"RTN","MAGQBUT2",63,0)
 Q
"RTN","MAGQBUT2",64,0)
IMPAR(RESULT,QIEN) ;
"RTN","MAGQBUT2",65,0)
 N INDX,CNT
"RTN","MAGQBUT2",66,0)
 S (INDX,CNT)=0
"RTN","MAGQBUT2",67,0)
 F  S INDX=$O(^MAG(2006.034,QIEN,1,INDX)) Q:INDX'?1N.N  D
"RTN","MAGQBUT2",68,0)
 . S CNT=CNT+1
"RTN","MAGQBUT2",69,0)
 . S RESULT(CNT)=$G(^MAG(2006.034,QIEN,1,INDX,0))
"RTN","MAGQBUT2",70,0)
 I CNT<1 S RESULT(0)="0^Corrupted Import Array"
"RTN","MAGQBUT2",71,0)
 E  S RESULT(0)="1"
"RTN","MAGQBUT2",72,0)
 Q
"RTN","MAGQBUT2",73,0)
SNS(PLACE) ;
"RTN","MAGQBUT2",74,0)
 N RESULT,INDEX
"RTN","MAGQBUT2",75,0)
 S INDEX=0
"RTN","MAGQBUT2",76,0)
 S RESULT=$P(^MAG(2006.1,PLACE,0),U,2)
"RTN","MAGQBUT2",77,0)
 F  S INDEX=$O(^MAG(2006.1,PLACE,4,INDEX)) Q:INDEX'?1N.N  D
"RTN","MAGQBUT2",78,0)
 . S RESULT=RESULT_U_$P($G(^MAG(2006.1,PLACE,4,INDEX,0)),U)
"RTN","MAGQBUT2",79,0)
 Q RESULT
"RTN","MAGQBUT2",80,0)
CHKIMG(IEN) ;
"RTN","MAGQBUT2",81,0)
 ; Given an Image IEN, return:
"RTN","MAGQBUT2",82,0)
 ;   1: Case # or accession #
"RTN","MAGQBUT2",83,0)
 ;   2: Parent application~IEN
"RTN","MAGQBUT2",84,0)
 ;   3: Application DFN
"RTN","MAGQBUT2",85,0)
 ;   4: Image DFN
"RTN","MAGQBUT2",86,0)
 ;   5: Flag: true = all DFNs in images in same parent group are identical
"RTN","MAGQBUT2",87,0)
 ;   6: Image object Class
"RTN","MAGQBUT2",88,0)
 ;
"RTN","MAGQBUT2",89,0)
 ; PF: Parent Data file number
"RTN","MAGQBUT2",90,0)
 ; PT(): Parent file data dictionary
"RTN","MAGQBUT2",91,0)
 ; PD0: Parent (Global root) IEN (D0)
"RTN","MAGQBUT2",92,0)
 ; PD1:  Lab Parent Global Root (D1)
"RTN","MAGQBUT2",93,0)
 ; PD2:  Parent Data File Image Pointer
"RTN","MAGQBUT2",94,0)
 ; T():  Error types
"RTN","MAGQBUT2",95,0)
 ; IDFN: Image file entry DFN
"RTN","MAGQBUT2",96,0)
 ; PDFN: Parent file DFN
"RTN","MAGQBUT2",97,0)
 ; GRG:  virtual Parent File Image Multiple
"RTN","MAGQBUT2",98,0)
 ; IOR: Image Object Referenced (by parent)
"RTN","MAGQBUT2",99,0)
 N GF,GP,G0,GR,GRD,GRG,GR0,IDFN,IENV,P0,PD0,PD1,PD2,PF,PT,X0,X2,N0,N1,R,T,GPDFN,PACS,IOR,APR,I,PDFN
"RTN","MAGQBUT2",100,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT2",101,0)
 S R="^^^^^"
"RTN","MAGQBUT2",102,0)
 S T(1)="No Image ptr in AP"
"RTN","MAGQBUT2",103,0)
 S T(2)="GP has no Images"
"RTN","MAGQBUT2",104,0)
 S T(3)="Conflicting AP & Image DFNs"
"RTN","MAGQBUT2",105,0)
 S T(4)="Invalid Image Ptr to AP"
"RTN","MAGQBUT2",106,0)
 S T(5)="Conflicting GP and GO DFN"
"RTN","MAGQBUT2",107,0)
 S T(6)="GP & GO AP Mismatch"
"RTN","MAGQBUT2",108,0)
 S T(7)="GP Missing GO ptr"
"RTN","MAGQBUT2",109,0)
 S T(8)="No AP Ptr"
"RTN","MAGQBUT2",110,0)
 S T(9)="No AP Entry ptr"
"RTN","MAGQBUT2",111,0)
 S T(10)="No AP Mult ptr"
"RTN","MAGQBUT2",112,0)
 S T(11)="GO DFN mismatches"
"RTN","MAGQBUT2",113,0)
 S T(12)="Null Image Ptr"
"RTN","MAGQBUT2",114,0)
 S T(13)="Invalid Image Ptr"
"RTN","MAGQBUT2",115,0)
 S T(14)="Invalid Image Ptr to AP"
"RTN","MAGQBUT2",116,0)
 S T(15)="Image Entry is structurally abnormal"
"RTN","MAGQBUT2",117,0)
 S T(16)="Missing Group Objects"
"RTN","MAGQBUT2",118,0)
 S T(21)="DFN Mismatches in AP Image Mult"
"RTN","MAGQBUT2",119,0)
 I IEN="" S $P(R,"^",5)=T(12)_"~1" Q R
"RTN","MAGQBUT2",120,0)
 S X0=$G(^MAG(2005,IEN,0))
"RTN","MAGQBUT2",121,0)
 I X0="" S $P(R,"^",5)=T(13)_"~1" Q R
"RTN","MAGQBUT2",122,0)
 S IDFN=$P(X0,"^",7),$P(R,"^",4)=IDFN
"RTN","MAGQBUT2",123,0)
 S PT(3.9)="^XMB(3.9,PD0,|Mail message||2|^XMB(3.9,PD0,2005,|MAIL"
"RTN","MAGQBUT2",124,0)
 S PT(63)="^LR(PD0,GF,PD1,|Autopsy (microscopic)|AY|1|^LR(PD0,GF,PD1,2005,|AUM"
"RTN","MAGQBUT2",125,0)
 S PT(63.02)="^LR(PD0,GF,PD1,|Electron microscopy|EM|1|^LR(PD0,GF,PD1,2005,|EM"
"RTN","MAGQBUT2",126,0)
 S PT(63.08)="^LR(PD0,GF,PD1,|Surgical pathology|SP|1|^LR(PD0,GF,PD1,2005,|SP"
"RTN","MAGQBUT2",127,0)
 S PT(63.09)="^LR(PD0,GF,PD1,|Cytology|CY|1|^LR(PD0,GF,PD1,2005,|CY|"
"RTN","MAGQBUT2",128,0)
 S PT(63.2)="^LR(PD0,GF,PD1,|Autopsy (gross)|AU|1|^LR(PD0,GF,PD1,2005,|AUG"
"RTN","MAGQBUT2",129,0)
 S PT(70)="^RADPT(PDFN,|Radiology Patient||1|"
"RTN","MAGQBUT2",130,0)
 S PT(74)="^RARPT(PD0,|Radiology||2|^RARPT(PD0,2005,|RAD"
"RTN","MAGQBUT2",131,0)
 S PT(130)="^SRF(PD0,|Surgery||1|^SRF(PD0,2005,|SUR"
"RTN","MAGQBUT2",132,0)
 S PT(691)="^MCAR(691,PD0,|Echocardiogram||2|^MCAR(691,PD0,2005,|ECHO"
"RTN","MAGQBUT2",133,0)
 S PT(691.1)="^MCAR(691.1,PD0,|Cardiac catheterization||2|^MCAR(691.1,PD0,2005,|CATH"
"RTN","MAGQBUT2",134,0)
 S PT(691.5)="^MCAR(691.5,PD0,|Electrocardiography||2|^MCAR(691.5,PD0,2005,|ECG"
"RTN","MAGQBUT2",135,0)
 S PT(694)="^MCAR(694,PD0,|Hematology||2|^MCAR(694,PD0,2005,|HEM"
"RTN","MAGQBUT2",136,0)
 S PT(699)="^MCAR(699,PD0,|Endoscopy||2|^MCAR(699,PD0,2005,|ENDO"
"RTN","MAGQBUT2",137,0)
 S PT(699.5)="^MCAR(699.5,PD0,|Medicine||2|^MCAR(699.5,PD0,2005,|GEN"
"RTN","MAGQBUT2",138,0)
 S PT(8925)="^TIU(8925,PD0,|TIU||2|^TIU(8925.91,""ADI"",PD0,|TIU"
"RTN","MAGQBUT2",139,0)
 S IC=$$IC(IEN,.N0,.N2,.GPDFN),$P(R,U,6)=IC
"RTN","MAGQBUT2",140,0)
 I IC="ER" S $P(R,U,5)=T(15)_"~1" Q R
"RTN","MAGQBUT2",141,0)
 I IC["GP",'$O(^MAG(2005,IEN,1,0)) S $P(R,U,5)=T(2)_"~1" Q R
"RTN","MAGQBUT2",142,0)
 D PF(IEN,IC,N0,.PF,.PD0,.PD1,.PD2,.PACS,.IOR,.APR)
"RTN","MAGQBUT2",143,0)
 I "GP^GO"[IC D  Q:$P(R,U,5)'="" R
"RTN","MAGQBUT2",144,0)
 . S I=0
"RTN","MAGQBUT2",145,0)
 . F  S I=$O(^MAG(2005,IOR,1,I)) Q:I'?1N.N  D
"RTN","MAGQBUT2",146,0)
 . . I '$D(^MAG(2005,$P($G(^MAG(2005,IOR,1,I,0)),U),0)) S $P(R,U,5)=T(16)_$S(IC="GO":"~2",1:"~1")
"RTN","MAGQBUT2",147,0)
 . . Q
"RTN","MAGQBUT2",148,0)
 I IC["GO" S $P(R,U,6)=$P(R,U,6)_"~"_IOR
"RTN","MAGQBUT2",149,0)
 I PD2'?1N.N,(('PACS)&(PD0?1N.N)) S $P(R,U,5)=T(10)_$S(IC["GO":"~2",1:"~1") Q R
"RTN","MAGQBUT2",150,0)
 I IC["GO" D  Q:$P(R,U,5)'="" R
"RTN","MAGQBUT2",151,0)
 . N I,J
"RTN","MAGQBUT2",152,0)
 . S (I,J)=0
"RTN","MAGQBUT2",153,0)
 . F  S I=$O(^MAG(2005,IOR,1,I)) Q:I'?1N.N  S:IEN=$P($G(^MAG(2005,IOR,1,I,0)),U,1) J=1
"RTN","MAGQBUT2",154,0)
 . S:J=0 $P(R,U,5)=T(7)_"~2"
"RTN","MAGQBUT2",155,0)
 . Q
"RTN","MAGQBUT2",156,0)
 I IC["GO",IDFN'=GPDFN S $P(R,U,5)=T(5)_"~1",$P(R,U,3)=GPDFN Q R
"RTN","MAGQBUT2",157,0)
 I IC["GO" D  Q:$P(R,U,5)'="" R
"RTN","MAGQBUT2",158,0)
 . N I,J
"RTN","MAGQBUT2",159,0)
 . S I=0
"RTN","MAGQBUT2",160,0)
 . F  S I=$O(^MAG(2005,IOR,1,I)) Q:I'?1N.N  D  Q:$P(R,U,5)'=""
"RTN","MAGQBUT2",161,0)
 . . S J=$P($G(^MAG(2005,IOR,1,I,0)),U)
"RTN","MAGQBUT2",162,0)
 . . I $P($G(^MAG(2005,J,0)),U,7)'=IDFN S $P(R,U,5)=T(11)_"~2",$P(R,U,3)=$P($G(^MAG(2005,J,0)),U,7)
"RTN","MAGQBUT2",163,0)
 . . Q
"RTN","MAGQBUT2",164,0)
 I IC["GO",PACS,(($P(N2,U,6,7)'="")&($P(N2,U,6,7)'="^")),$P(N2,U,6,7)'=$P($G(^MAG(2005,$P(N0,U,10),2)),U,6,7) D  Q R
"RTN","MAGQBUT2",165,0)
 . S $P(R,U,5)=T(6)_"~1",$P(R,U,3)=$P(^MAG(2005,IOR,0),U,7) Q
"RTN","MAGQBUT2",166,0)
 I (PF\1=63),PD1'?1N.N,PD1'?1N.N1"."1N.N Q R
"RTN","MAGQBUT2",167,0)
 I PF?1N.E,$D(PT(+PF)),PD0?1N.N D
"RTN","MAGQBUT2",168,0)
 . S $P(R,"^",2)=$P(PT(PF),"|",6)_"~"_PD0
"RTN","MAGQBUT2",169,0)
 . S GR=$P(PT(PF),"|",1),GR0=GR_"0)"
"RTN","MAGQBUT2",170,0)
 . S GF=$P(PT(PF),"|",3),GP=$P(PT(PF),"|",4)
"RTN","MAGQBUT2",171,0)
 . S T=$P(PT(PF),"|",5),GRD=T_"G0,0)",GRG=T_"G0)"
"RTN","MAGQBUT2",172,0)
 E  D  Q R
"RTN","MAGQBUT2",173,0)
 . S:((IC["GP")&($P(R,U,5)="")) $P(R,U,5)="1"
"RTN","MAGQBUT2",174,0)
 S P0=$G(@GR0)
"RTN","MAGQBUT2",175,0)
 I P0="" S $P(R,"^",5)=T(4)_$S((('PACS)&(IC["GO")):"~2",1:"~1") Q R
"RTN","MAGQBUT2",176,0)
 S PDFN=$S(PF\1=63:$P(^LR(PD0,0),U,3),$P(P0,"^",GP)'="":$P(P0,"^",GP),1:PDFN)
"RTN","MAGQBUT2",177,0)
 I 'PDFN,$P($G(^VA(200,IDFN,0)),"^",1)=PDFN S PDFN=IDFN
"RTN","MAGQBUT2",178,0)
 S $P(R,"^",3)=PDFN
"RTN","MAGQBUT2",179,0)
 I PDFN'=IDFN S $P(R,U,5)=T(3)_$S((('PACS)&(IC["GO")):"~2",1:"~1") Q R
"RTN","MAGQBUT2",180,0)
 I PF=74 D
"RTN","MAGQBUT2",181,0)
 . S GR=$P(PT(70),"|",1),GR0=GR_"0)"
"RTN","MAGQBUT2",182,0)
 . S GF=$P(PT(70),"|",3),GP=$P(PT(70),"|",4)
"RTN","MAGQBUT2",183,0)
 . S P0=$G(@GR0),$P(R,"^",3)=$P(R,"^",3)_"~"_$P(P0,"^",GP)
"RTN","MAGQBUT2",184,0)
 S T=1,G0=0,IENV=0
"RTN","MAGQBUT2",185,0)
 F  S G0=$O(@GRG) Q:'G0  Q:$P(R,U,5)'=""  D  I 'T K PT Q
"RTN","MAGQBUT2",186,0)
 . I PF=8925 D  Q
"RTN","MAGQBUT2",187,0)
 . . I '$D(^MAG(2005,+G0,0)) S $P(R,U,5)=T(14)_$S((('PACS)&(IC["GO")):"~2",1:"~1")
"RTN","MAGQBUT2",188,0)
 . . S:G0=IOR IENV=1
"RTN","MAGQBUT2",189,0)
 . . I $P($G(^MAG(2005,+G0,0)),"^",7)'=IDFN S $P(R,U,5)=T(21)_"~2",$P(R,U,3)=$P($G(^MAG(2005,+G0,0)),"^",7)
"RTN","MAGQBUT2",190,0)
 . . Q
"RTN","MAGQBUT2",191,0)
 . I '$D(^MAG(2005,+$P($G(@GRD),"^",1),0)) S $P(R,U,5)=T(14)_$S((('PACS)&(IC["GO")):"~2",1:"~1")
"RTN","MAGQBUT2",192,0)
 . I $P($G(^MAG(2005,+$P($G(@GRD),"^",1),0)),"^",7)'=IDFN D  Q
"RTN","MAGQBUT2",193,0)
 . . S $P(R,U,5)=T(21)_"~2",$P(R,U,3)=$P($G(^MAG(2005,+$P($G(@GRD),"^",1),0)),"^",7) Q
"RTN","MAGQBUT2",194,0)
 . I PF=63 S:+$P($G(^LR(PD0,GF,PD1,2005.1,G0,0)),U)=IOR IENV=1
"RTN","MAGQBUT2",195,0)
 . I PF=63.2 S:+$P($G(^LR(PD0,GF,PD1,2005,G0,0)),U)=IOR IENV=1
"RTN","MAGQBUT2",196,0)
 . S:+$P($G(@GRD),"^",1)=IOR IENV=1
"RTN","MAGQBUT2",197,0)
 . Q
"RTN","MAGQBUT2",198,0)
 Q:$P(R,U,5)'="" R
"RTN","MAGQBUT2",199,0)
 I IC["GP" S $P(R,U,5)="1"
"RTN","MAGQBUT2",200,0)
 I IENV=0 S $P(R,U,5)=T(1)_"~1"
"RTN","MAGQBUT2",201,0)
 I PF=74 S $P(R,"^",1)=$P(P0,"^",1)
"RTN","MAGQBUT2",202,0)
 K PT
"RTN","MAGQBUT2",203,0)
 Q R
"RTN","MAGQBUT2",204,0)
IC(IEN,N0,N2,GPDFN) ;
"RTN","MAGQBUT2",205,0)
 S N0=$G(^MAG(2005,IEN,0))
"RTN","MAGQBUT2",206,0)
 S N1=$G(^MAG(2005,IEN,1,0))
"RTN","MAGQBUT2",207,0)
 S N2=$G(^MAG(2005,IEN,2))
"RTN","MAGQBUT2",208,0)
 I ($P(N0,U,2)="")&($P(N0,U,10)="")&($P(N1,U,4)>0) Q "GP"
"RTN","MAGQBUT2",209,0)
 I (($P(N0,U,2)'="")&($P(N0,U,10)?1N.N)&(N1="")) D  Q "GO"
"RTN","MAGQBUT2",210,0)
 . S GPDFN=$P($G(^MAG(2005,$P(N0,U,10),0)),U,7) Q
"RTN","MAGQBUT2",211,0)
 I ($P(N0,U,2)'="")&($P(N0,U,10)'?1N.N)&(N1="") Q "NG"
"RTN","MAGQBUT2",212,0)
 Q "ER"
"RTN","MAGQBUT2",213,0)
PF(IEN,IC,N0,PF,PD0,PD1,PD2,PACS,IOR,APR) ;
"RTN","MAGQBUT2",214,0)
 N N2
"RTN","MAGQBUT2",215,0)
 S PACS=$S($D(^MAG(2005,IEN,"PACS")):1,1:0)
"RTN","MAGQBUT2",216,0)
 S IOR=$S(IC="GO":$P($G(N0),U,10),1:IEN)
"RTN","MAGQBUT2",217,0)
 I ((IC="GP")!(IC="NG")!((PACS)&(IC="GO"))) S N2=$G(^MAG(2005,IEN,2))
"RTN","MAGQBUT2",218,0)
 I ((IC="GO")&('PACS)) S N2=$G(^MAG(2005,IOR,2))
"RTN","MAGQBUT2",219,0)
 S PF=$P(N2,"^",6),PD0=$P(N2,"^",7),PD1=$P(N2,"^",10),PD2=$P(N2,"^",8)
"RTN","MAGQBUT2",220,0)
 I PACS S APR=$S(PD0?1N.N:1,1:0)
"RTN","MAGQBUT2",221,0)
 E  S APR=$S(((PF'="")&(PD0?1N.N)):1,$P($G(^MAG(2005,IOR,100)),U)?1N.N:1,$P($G(^MAG(2005,IOR,0)),U,6)="18":1,1:0)
"RTN","MAGQBUT2",222,0)
 Q
"RTN","MAGQBUT4")
0^16^B78268087
"RTN","MAGQBUT4",1,0)
MAGQBUT4 ;WOIFO/RMP - BP Utilities  ;19 Nov 2001 1:23 PM
"RTN","MAGQBUT4",2,0)
 ;;3.0;IMAGING;**7,8,48,20**;Apr 12, 2006
"RTN","MAGQBUT4",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBUT4",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBUT4",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBUT4",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBUT4",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBUT4",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBUT4",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBUT4",10,0)
 ;; |                                                               |
"RTN","MAGQBUT4",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBUT4",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQBUT4",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQBUT4",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQBUT4",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQBUT4",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBUT4",17,0)
 ;;
"RTN","MAGQBUT4",18,0)
 ;
"RTN","MAGQBUT4",19,0)
 Q
"RTN","MAGQBUT4",20,0)
CONV(ARR,ICT) ;Convert any single node array to FM Style multiple
"RTN","MAGQBUT4",21,0)
 ;  The node subscripts of ARR are ignored, and not retained
"RTN","MAGQBUT4",22,0)
 ; i.e.  ARR(34)=8
"RTN","MAGQBUT4",23,0)
 ;       ARR("BLUE")=9
"RTN","MAGQBUT4",24,0)
 ;       ARR("D")=10
"RTN","MAGQBUT4",25,0)
 ; converts to
"RTN","MAGQBUT4",26,0)
 ;      ARR(1,0)=8
"RTN","MAGQBUT4",27,0)
 ;      ARR(2,0)=9
"RTN","MAGQBUT4",28,0)
 ;      ARR(3,0)=10
"RTN","MAGQBUT4",29,0)
 N I,ARO
"RTN","MAGQBUT4",30,0)
 S ICT=0,I=""
"RTN","MAGQBUT4",31,0)
 F  S I=$O(ARR(I)) Q:(I="")  D
"RTN","MAGQBUT4",32,0)
 . S ICT=ICT+1
"RTN","MAGQBUT4",33,0)
 . S ARO(ICT,0)=ARR(I)
"RTN","MAGQBUT4",34,0)
 K ARR
"RTN","MAGQBUT4",35,0)
 M ARR=ARO
"RTN","MAGQBUT4",36,0)
 Q
"RTN","MAGQBUT4",37,0)
MRGMULT(ARR,RT,RTDSC,CT) ;Merge the FM formatted array into a FM File
"RTN","MAGQBUT4",38,0)
 ;   multiple field.
"RTN","MAGQBUT4",39,0)
 ;   This isn't for general consumption.
"RTN","MAGQBUT4",40,0)
 ; RT = FILE ROOT, RECORD NUMBER, NODE
"RTN","MAGQBUT4",41,0)
 ; i.e.  "^MAG(2006.034,44,1,"   -> 44 is the IEN of MAG(2006.34
"RTN","MAGQBUT4",42,0)
 ; RTDSC is the 2nd piece of the 0 node of the multiple field.
"RTN","MAGQBUT4",43,0)
 S RT=$E(RT,1,$L(RT)-1)_")"
"RTN","MAGQBUT4",44,0)
 S @RT@(0)=U_RTDSC_U_CT_U_CT ;  i.e.    ^2006.341A^13^13
"RTN","MAGQBUT4",45,0)
 M @RT=ARR
"RTN","MAGQBUT4",46,0)
 Q
"RTN","MAGQBUT4",47,0)
DDLF(RESULTS,FILE,FIELD,FLAGS,ATTR) ;[MAG FLD ATT]
"RTN","MAGQBUT4",48,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT4",49,0)
 K X
"RTN","MAGQBUT4",50,0)
 D FIELD^DID(FILE,FIELD,FLAGS,ATTR,"RESULTS","RESULTS")
"RTN","MAGQBUT4",51,0)
 Q
"RTN","MAGQBUT4",52,0)
DDFA(RESULTS) ;[MAG ATT LST]
"RTN","MAGQBUT4",53,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT4",54,0)
 K X
"RTN","MAGQBUT4",55,0)
 D FIELDLST^DID(RESULTS)
"RTN","MAGQBUT4",56,0)
 Q
"RTN","MAGQBUT4",57,0)
DHRPC(RESULTS,FNAME,FLOC) ;[MAG DIRHASH]
"RTN","MAGQBUT4",58,0)
 N TMP
"RTN","MAGQBUT4",59,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT4",60,0)
 K X
"RTN","MAGQBUT4",61,0)
 S TMP=$$DIRHASH^MAGFILEB(FNAME,FLOC)
"RTN","MAGQBUT4",62,0)
 S RESULTS=$S(TMP="":U,1:TMP)
"RTN","MAGQBUT4",63,0)
 Q
"RTN","MAGQBUT4",64,0)
GPACHX(PV) ; Get Package File Install History of Imaging
"RTN","MAGQBUT4",65,0)
 N I,LCNT,MSG,PKG
"RTN","MAGQBUT4",66,0)
 S LCNT=0
"RTN","MAGQBUT4",67,0)
 S PV(0)="Version^Install Date"
"RTN","MAGQBUT4",68,0)
 F PKG="IMAGING" D
"RTN","MAGQBUT4",69,0)
 . N J,K,L,VERS,DATE,X,Y,%DT
"RTN","MAGQBUT4",70,0)
 . S J=$O(^DIC(9.4,"B",PKG,"")) Q:'J
"RTN","MAGQBUT4",71,0)
 . S VERS="" F  S VERS=$O(^DIC(9.4,J,22,"B",VERS)) Q:VERS=""  D
"RTN","MAGQBUT4",72,0)
 . . N MSG,TAR
"RTN","MAGQBUT4",73,0)
 . . S K=$O(^DIC(9.4,J,22,"B",VERS,""))
"RTN","MAGQBUT4",74,0)
 . . D LIST^DIC(9.4901,","_K_","_J_",","@;.01;.02;.03","","","","","","","","TAR","MSG")
"RTN","MAGQBUT4",75,0)
 . . Q:$D(MSG("DIERR"))
"RTN","MAGQBUT4",76,0)
 . . S L=0 F  S L=$O(TAR("DILIST","ID",L)) Q:'L  D
"RTN","MAGQBUT4",77,0)
 . . . S LCNT=LCNT+1
"RTN","MAGQBUT4",78,0)
 . . . S PV(LCNT)=VERS_"P"_$P(TAR("DILIST","ID",L,".01"),"^",1)
"RTN","MAGQBUT4",79,0)
 . . . S X=$P(TAR("DILIST","ID",L,".02"),"^",1) D ^%DT S DATE=$$FMTE^XLFDT(Y,2)
"RTN","MAGQBUT4",80,0)
 . . . S PV(LCNT)=PV(LCNT)_"^"_$S(DATE["-1":"",1:DATE)
"RTN","MAGQBUT4",81,0)
 . . . Q
"RTN","MAGQBUT4",82,0)
 . . Q
"RTN","MAGQBUT4",83,0)
 . Q
"RTN","MAGQBUT4",84,0)
 Q
"RTN","MAGQBUT4",85,0)
VOK(VER) ; Check for the appropriate BP Queue processor version
"RTN","MAGQBUT4",86,0)
 ; This routine MAGQBUT4 will need to be released with each BP Update
"RTN","MAGQBUT4",87,0)
 ; The variable CVERS will contain the current BP server version
"RTN","MAGQBUT4",88,0)
 ;       ;;3.0;IMAGING;**7,13,8**;Jul 26, 2004
"RTN","MAGQBUT4",89,0)
 N VN,I,CVERS,PNUM,SLINE,ALTVER
"RTN","MAGQBUT4",90,0)
 S SLINE=$T(+2),ALTVER=","_$$TRIM($P(SLINE,"**",2))_","
"RTN","MAGQBUT4",91,0)
 S PNUM=$$TRIM($P(SLINE,"**",2)),PNUM=$$TRIM($P(PNUM,",",$L(PNUM,",")))
"RTN","MAGQBUT4",92,0)
 S CVERS=$$TRIM($P(SLINE,";",3))_"P"_PNUM
"RTN","MAGQBUT4",93,0)
 Q $S(CVERS=VER:1,$P(VER,"P",2)["13":1,ALTVER[(","_$P(VER,"P",2)_","):1,1:0)
"RTN","MAGQBUT4",94,0)
 ;
"RTN","MAGQBUT4",95,0)
TRIM(X) ; remove both leading and trailing blanks
"RTN","MAGQBUT4",96,0)
 N I,J
"RTN","MAGQBUT4",97,0)
 F I=1:1:$L(X) Q:$E(X,I)'=" "
"RTN","MAGQBUT4",98,0)
 F J=$L(X):-1:I Q:$E(X,J)'=" "
"RTN","MAGQBUT4",99,0)
 Q $S($E(X,I,J)=" ":"",1:$E(X,I,J))
"RTN","MAGQBUT4",100,0)
 ;
"RTN","MAGQBUT4",101,0)
QCNT(RESULT,PLC,QUE) ; [MAGQ QCNT]
"RTN","MAGQBUT4",102,0)
 S X="ERR^MAGQBTM",@^%ZOSF("TRAP")
"RTN","MAGQBUT4",103,0)
 N CNT,DA,CQ,IA
"RTN","MAGQBUT4",104,0)
 S (NODE,IA)="",RESULT=0
"RTN","MAGQBUT4",105,0)
 S (CNT,IA)=0,DA=""
"RTN","MAGQBUT4",106,0)
 S QP=$S($D(^MAGQUEUE(2006.031,"C",PLC,QUE)):$O(^MAGQUEUE(2006.031,"C",PLC,QUE,"")),1:"")
"RTN","MAGQBUT4",107,0)
 S CQ=$S('QP:0,1:$P($G(^MAGQUEUE(2006.031,QP,0)),U,2))
"RTN","MAGQBUT4",108,0)
 F  S DA=$O(^MAGQUEUE(2006.03,"C",PLC,QUE,DA)) Q:'DA  S CNT=CNT+1 I CQ<DA S IA=IA+1
"RTN","MAGQBUT4",109,0)
 D QPUP(PLC,QUE,CNT,CQ,IA,QP) Q
"RTN","MAGQBUT4",110,0)
 Q
"RTN","MAGQBUT4",111,0)
 ;
"RTN","MAGQBUT4",112,0)
QPUP(PLC,QUE,CNT,CQ,IA,QP) ;
"RTN","MAGQBUT4",113,0)
 N IEN,DIC,VAL
"RTN","MAGQBUT4",114,0)
 K VAL
"RTN","MAGQBUT4",115,0)
 S VAL(1)=PLC,VAL(2)=QUE
"RTN","MAGQBUT4",116,0)
 S QP=$S(QP:QP,1:$$FIND1^DIC(2006.031,"","QX",.VAL,"C","",""))
"RTN","MAGQBUT4",117,0)
 ;I IEN>0 D  Q:IEN
"RTN","MAGQBUT4",118,0)
 ;. S $P(^MAGQUEUE(2006.031,IEN,0),U,5)=CNT Q
"RTN","MAGQBUT4",119,0)
 I 'QP D  Q
"RTN","MAGQBUT4",120,0)
 . K DIE,FDA
"RTN","MAGQBUT4",121,0)
 . S FDA(2006.031,"+1,",.01)=QUE
"RTN","MAGQBUT4",122,0)
 . S FDA(2006.031,"+1,",.04)=PLC
"RTN","MAGQBUT4",123,0)
 . S FDA(2006.031,"+1,",1)=CQ
"RTN","MAGQBUT4",124,0)
 . S FDA(2006.031,"+1,",2)=IA
"RTN","MAGQBUT4",125,0)
 . S FDA(2006.031,"+1,",3)=CNT
"RTN","MAGQBUT4",126,0)
 . D UPDATE^DIE("U","FDA","","MAGQUP")
"RTN","MAGQBUT4",127,0)
 . K DIE,FDA
"RTN","MAGQBUT4",128,0)
 E  D
"RTN","MAGQBUT4",129,0)
 . K DIE,FDA
"RTN","MAGQBUT4",130,0)
 . S FDA(2006.031,QP_",",.01)=QUE
"RTN","MAGQBUT4",131,0)
 . S FDA(2006.031,QP_",",.04)=PLC
"RTN","MAGQBUT4",132,0)
 . S FDA(2006.031,QP_",",1)=CQ
"RTN","MAGQBUT4",133,0)
 . S FDA(2006.031,QP_",",2)=IA
"RTN","MAGQBUT4",134,0)
 . S FDA(2006.031,QP_",",3)=CNT
"RTN","MAGQBUT4",135,0)
 . D FILE^DIE("","FDA","MAGERR")
"RTN","MAGQBUT4",136,0)
 . K DIE,FDA
"RTN","MAGQBUT4",137,0)
 Q
"RTN","MAGQBUT4",138,0)
 ;
"RTN","MAGQBUT4",139,0)
CPUD ;
"RTN","MAGQBUT4",140,0)
 N PLC,INS,QUE
"RTN","MAGQBUT4",141,0)
 S (INS,PLC)=""
"RTN","MAGQBUT4",142,0)
 F  S INS=$O(^MAG(2006.1,"B",INS)) Q:INS=""  D
"RTN","MAGQBUT4",143,0)
 . S PLC=$O(^MAG(2006.1,"B",INS,""))
"RTN","MAGQBUT4",144,0)
 . S QUE="" F  S QUE=$O(^MAGQUEUE(2006.031,"C",PLC,QUE)) Q:QUE=""  D
"RTN","MAGQBUT4",145,0)
 . . D QCNT^MAGQBUT4("",PLC,QUE)
"RTN","MAGQBUT4",146,0)
 . . Q
"RTN","MAGQBUT4",147,0)
 . Q
"RTN","MAGQBUT4",148,0)
 Q
"RTN","MAGQBUT4",149,0)
CNL(GL,IEN,NLC) ;  Check Network Location
"RTN","MAGQBUT4",150,0)
 N MAGREF,MAG0,MAG1,PLC
"RTN","MAGQBUT4",151,0)
 S NLC=NLC+1
"RTN","MAGQBUT4",152,0)
 I '$G(IEN) Q ""
"RTN","MAGQBUT4",153,0)
 S MAG0=$G(@(GL_IEN_",0)"))
"RTN","MAGQBUT4",154,0)
 S MAGREF=+$P(MAG0,"^",3)            ; get file from raid
"RTN","MAGQBUT4",155,0)
 I MAGREF=0 S MAGREF=+$P(MAG0,"^",5) ; get file from jukebox
"RTN","MAGQBUT4",156,0)
 I 'MAGREF Q ""
"RTN","MAGQBUT4",157,0)
 I '$D(^MAG(2005.2,MAGREF,0)) Q ""
"RTN","MAGQBUT4",158,0)
 S PLC=$P($G(^MAG(2005.2,MAGREF,0)),U,10)
"RTN","MAGQBUT4",159,0)
 Q:'PLC ""
"RTN","MAGQBUT4",160,0)
 S PLC=$P($G(^MAG(2006.1,PLC,0)),U)
"RTN","MAGQBUT4",161,0)
 Q $S('PLC:"",1:PLC)
"RTN","MAGQBUT4",162,0)
CNSP(GL,IEN,NMSP,NSC) ;  Check NameSPace
"RTN","MAGQBUT4",163,0)
 N NMSPC,MAG0,FNAM,INSTIEN
"RTN","MAGQBUT4",164,0)
 S NSC=NSC+1
"RTN","MAGQBUT4",165,0)
 S MAG0=$G(@(GL_IEN_",0)"))
"RTN","MAGQBUT4",166,0)
 S FNAM=$P(MAG0,U,2)
"RTN","MAGQBUT4",167,0)
 S NMSPC=$TR($P(FNAM,"."),"0123456789","")
"RTN","MAGQBUT4",168,0)
 Q:NMSPC="" ""
"RTN","MAGQBUT4",169,0)
 S INSTIEN=$S($D(NMSP(NMSPC)):$O(NMSP(NMSPC,"")),1:"")
"RTN","MAGQBUT4",170,0)
 Q INSTIEN
"RTN","MAGQBUT4",171,0)
ACQUD(LIMIT) ;
"RTN","MAGQBUT4",172,0)
 N I,TMP,CNT
"RTN","MAGQBUT4",173,0)
 S (I,CNT)=0
"RTN","MAGQBUT4",174,0)
 F  S I=$O(^TMP($J,"CHANGE_IEN",I)) Q:I=""  D
"RTN","MAGQBUT4",175,0)
 . S TMP=$G(^TMP($J,"CHANGE_IEN",I))
"RTN","MAGQBUT4",176,0)
 . D DFNIQ^MAGQBPG1("","Original Acquisition Site at IEN: "_$P(TMP,U,3)_" Value: "_$P(TMP,U)_" New value: "_$P(TMP,U,2),0)
"RTN","MAGQBUT4",177,0)
 . S CNT=CNT+1
"RTN","MAGQBUT4",178,0)
 . I (CNT+1)>LIMIT D
"RTN","MAGQBUT4",179,0)
 . . D DFNIQ^MAGQBPG1("Post Install Acquisition Site field Updates","",1)
"RTN","MAGQBUT4",180,0)
 . . S CNT=0
"RTN","MAGQBUT4",181,0)
 . . Q
"RTN","MAGQBUT4",182,0)
 . Q
"RTN","MAGQBUT4",183,0)
 D DFNIQ^MAGQBPG1("Post Install Acquisition Site field Updates","",1)
"RTN","MAGQBUT4",184,0)
 K ^TMP($J,"CHANGE_IEN"),TMP
"RTN","MAGQBUT4",185,0)
 Q
"RTN","MAGQBUT4",186,0)
NMSP(TMPA) ;
"RTN","MAGQBUT4",187,0)
 N IEN,INS,TMP,I,J
"RTN","MAGQBUT4",188,0)
 S INS="" F  S INS=$O(^MAG(2006.1,"B",INS)) Q:INS=""  S IEN="" D
"RTN","MAGQBUT4",189,0)
 . S IEN=$O(^MAG(2006.1,"B",INS,IEN)) Q:IEN=""  D  Q
"RTN","MAGQBUT4",190,0)
 . . S TMP=","_$$UPPER^MAGQE4($$INIS^MAGQBPG2(IEN))_"," D  Q
"RTN","MAGQBUT4",191,0)
 . . . F I=2:1 S J=$P(TMP,",",I) Q:J=""  S TMPA(J,INS)=""
"RTN","MAGQBUT4",192,0)
 . . . Q
"RTN","MAGQBUT4",193,0)
 S J="" F  S J=$O(TMPA(J)) Q:J=""  S INS=$O(TMPA(J,"")) K:($O(TMPA(J,INS))]"") TMPA(J)
"RTN","MAGQBUT4",194,0)
 Q
"RTN","MAGQBUT4",195,0)
CLRQ ; Clears the Queue file and Queue Pointer files
"RTN","MAGQBUT4",196,0)
 N DA,DIK,FILE,IEN
"RTN","MAGQBUT4",197,0)
 F FILE=2006.03,2006.031 D
"RTN","MAGQBUT4",198,0)
 . S IEN=0 F  S IEN=$O(^MAGQUEUE(FILE,IEN)) Q:'IEN  D
"RTN","MAGQBUT4",199,0)
 . . S DIK="^MAGQUEUE("_FILE_","
"RTN","MAGQBUT4",200,0)
 . . S DA=IEN,DA(1)=FILE D ^DIK
"RTN","MAGQBUT4",201,0)
 K DIK,DA
"RTN","MAGQBUT4",202,0)
 Q
"RTN","MAGQBUT4",203,0)
 ; We add RPC to MAG WINDOWS Option this way instead of sending Option : MAG WINDOWS
"RTN","MAGQBUT4",204,0)
 ; If we send MAG WINDOWS Option, the last one installed will overwrite others.
"RTN","MAGQBUT4",205,0)
 ; ADDRPC copied from Patch 51, added the call "D MES^XPDUTL(" instead of "W !"
"RTN","MAGQBUT4",206,0)
ADDRPC(RPCNAME,OPTNAME) ;
"RTN","MAGQBUT4",207,0)
 N DA,DIC
"RTN","MAGQBUT4",208,0)
 S DIC="^DIC(19,",DIC(0)="",X=OPTNAME D ^DIC
"RTN","MAGQBUT4",209,0)
 I Y<0 D  Q
"RTN","MAGQBUT4",210,0)
 . D MES^XPDUTL("Cannot add RPC: """_RPCNAME_""" to Option: """_OPTNAME_""".")
"RTN","MAGQBUT4",211,0)
 . D MES^XPDUTL("Cannot find Option: """_OPTNAME_""".")
"RTN","MAGQBUT4",212,0)
 . Q
"RTN","MAGQBUT4",213,0)
 I '$D(^XWB(8994,"B",RPCNAME)) D  Q
"RTN","MAGQBUT4",214,0)
 . D MES^XPDUTL("Cannot add RPC: """_RPCNAME_""" to Option: """_OPTNAME_""".")
"RTN","MAGQBUT4",215,0)
 . D MES^XPDUTL("Cannot find RPC: """_RPCNAME_""".")
"RTN","MAGQBUT4",216,0)
 . Q
"RTN","MAGQBUT4",217,0)
 S DA(1)=+Y
"RTN","MAGQBUT4",218,0)
 I $D(^DIC(19,+Y,"RPC","B",$O(^XWB(8994,"B",RPCNAME,"")))) D  Q
"RTN","MAGQBUT4",219,0)
 . D MES^XPDUTL("Cannot add RPC: """_RPCNAME_""" to Option: """_OPTNAME_""".")
"RTN","MAGQBUT4",220,0)
 . D MES^XPDUTL("RPC: """_RPCNAME_""" is already a member of """_OPTNAME_""".")
"RTN","MAGQBUT4",221,0)
 . Q
"RTN","MAGQBUT4",222,0)
 S DIC=DIC_DA(1)_",""RPC"","
"RTN","MAGQBUT4",223,0)
 S DIC(0)="L" ; LAYGO should be allowed here
"RTN","MAGQBUT4",224,0)
 S X=RPCNAME
"RTN","MAGQBUT4",225,0)
 D ^DIC
"RTN","MAGQBUT4",226,0)
 I Y<0 D  Q
"RTN","MAGQBUT4",227,0)
 . D MES^XPDUTL("Cannot add RPC: """_RPCNAME_""" to Option: """_OPTNAME_""".")
"RTN","MAGQBUT4",228,0)
 . D MES^XPDUTL("Cannot find RPC: """_RPCNAME_""".")
"RTN","MAGQBUT4",229,0)
 . Q
"RTN","MAGQBUT4",230,0)
 Q
"RTN","MAGQBUT4",231,0)
INS(XP,DUZ,DATE,IDA) ;
"RTN","MAGQBUT4",232,0)
 N CT,CNT,COM,D,D0,D1,D2,DDATE,DG,DIC,DICR,DIW,MAGMSG,ST,XMID,XMY
"RTN","MAGQBUT4",233,0)
 D GETENV^%ZOSV
"RTN","MAGQBUT4",234,0)
 S CNT=0
"RTN","MAGQBUT4",235,0)
 S CNT=CNT+1,MAGMSG(CNT)="PACKAGE INSTALL"
"RTN","MAGQBUT4",236,0)
 S CNT=CNT+1,MAGMSG(CNT)="SITE: "_$$KSP^XUPARAM("WHERE")
"RTN","MAGQBUT4",237,0)
 S CNT=CNT+1,MAGMSG(CNT)="PACKAGE: "_XP
"RTN","MAGQBUT4",238,0)
 S CNT=CNT+1,MAGMSG(CNT)="Version: "_$$VER^XPDUTL(XP)
"RTN","MAGQBUT4",239,0)
 S ST=$$GET1^DIQ(9.7,IDA,11,"I")
"RTN","MAGQBUT4",240,0)
 S CNT=CNT+1,MAGMSG(CNT)="Start time: "_$$FMTE^XLFDT(ST)
"RTN","MAGQBUT4",241,0)
 S CT=$$GET1^DIQ(9.7,IDA,17,"I") S:+CT'=CT CT=$$NOW^XLFDT
"RTN","MAGQBUT4",242,0)
 S CNT=CNT+1,MAGMSG(CNT)="Completion time: "_$$FMTE^XLFDT(CT)
"RTN","MAGQBUT4",243,0)
 S CNT=CNT+1,MAGMSG(CNT)="Run time: "_$$FMDIFF^XLFDT(CT,ST,3)
"RTN","MAGQBUT4",244,0)
 S CNT=CNT+1,MAGMSG(CNT)="Environment: "_Y
"RTN","MAGQBUT4",245,0)
 S COM=$$GET1^DIQ(9.7,IDA,6,"I")
"RTN","MAGQBUT4",246,0)
 S CNT=CNT+1,MAGMSG(CNT)="FILE COMMENT: "_COM
"RTN","MAGQBUT4",247,0)
 S CNT=CNT+1,MAGMSG(CNT)="DATE: "_DATE
"RTN","MAGQBUT4",248,0)
 S CNT=CNT+1,MAGMSG(CNT)="Installed by: "_$$GET1^DIQ(9.7,IDA,9,"E")
"RTN","MAGQBUT4",249,0)
 S CNT=CNT+1,MAGMSG(CNT)="Install Name: "_$$GET1^DIQ(9.7,IDA,.01,"E")
"RTN","MAGQBUT4",250,0)
 S DDATE=$$GET1^DIQ(9.7,IDA,51,"I")
"RTN","MAGQBUT4",251,0)
 S CNT=CNT+1,MAGMSG(CNT)="Distribution Date: "_$$FMTE^XLFDT(DDATE)
"RTN","MAGQBUT4",252,0)
 S XMSUB=XP_" INSTALLATION"
"RTN","MAGQBUT4",253,0)
 S XMID=$G(DUZ) S:'XMID XMID=.5
"RTN","MAGQBUT4",254,0)
 S XMY(XMID)=""
"RTN","MAGQBUT4",255,0)
 S XMY("G.MAG SERVER")=""
"RTN","MAGQBUT4",256,0)
 S:$G(MAGDUZ) XMY(MAGDUZ)=""
"RTN","MAGQBUT4",257,0)
 S XMSUB=$E(XMSUB,1,63)
"RTN","MAGQBUT4",258,0)
 D SENDMSG^XMXAPI(XMID,XMSUB,"MAGMSG",.XMY,,.XMZ,)
"RTN","MAGQBUT4",259,0)
 I $G(XMERR) M XMERR=^TMP("XMERR",$J) S $EC=",U13-Cannot send MailMan message," K XMERR
"RTN","MAGQBUT4",260,0)
 Q
"RTN","MAGQBUT4",261,0)
 ;
"RTN","MAGQBUT5")
0^30^B13804118
"RTN","MAGQBUT5",1,0)
MAGQBUT5 ;WOIFO/RMP - BP Utilities  ;Oct 21, 2005 1:23 PM
"RTN","MAGQBUT5",2,0)
 ;;3.0;IMAGING;**20**;Apr 12, 2006
"RTN","MAGQBUT5",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBUT5",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQBUT5",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQBUT5",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQBUT5",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQBUT5",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQBUT5",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQBUT5",10,0)
 ;; |                                                               |
"RTN","MAGQBUT5",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQBUT5",12,0)
 ;; | a medical device.  As such, it may not be changed             |
"RTN","MAGQBUT5",13,0)
 ;; | in any way.  Modifications to this software may result in an  |
"RTN","MAGQBUT5",14,0)
 ;; | adulterated medical device under 21CFR820, the use of which   |
"RTN","MAGQBUT5",15,0)
 ;; | is considered to be a violation of US Federal Statutes.       |
"RTN","MAGQBUT5",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQBUT5",17,0)
 ;;
"RTN","MAGQBUT5",18,0)
AI(RESULT) ; List of Associated Institution candidates;
"RTN","MAGQBUT5",19,0)
 N INDEX,INST,J,K,L,OUT
"RTN","MAGQBUT5",20,0)
 S K=0
"RTN","MAGQBUT5",21,0)
 S RESULT(K)=""
"RTN","MAGQBUT5",22,0)
 S K=K+1
"RTN","MAGQBUT5",23,0)
 D LIST^DIC(40.8,,".01;.07I",,,,,,,,"OUT")
"RTN","MAGQBUT5",24,0)
 S RESULT(K)="The following Medical Center Divisions have Imaging Site Parameters defined on",K=K+1
"RTN","MAGQBUT5",25,0)
 S RESULT(K)="your system:" D
"RTN","MAGQBUT5",26,0)
 . S INDEX=0,K=K+1 F  S INDEX=INDEX+1 Q:'$D(OUT("DILIST","ID",INDEX))  D
"RTN","MAGQBUT5",27,0)
 . . S INST=OUT("DILIST","ID",INDEX,.07),J=0 F  S J=$O(^MAG(2006.1,J)) Q:'J  I $P(^MAG(2006.1,J,0),U)=INST D  Q
"RTN","MAGQBUT5",28,0)
 . . . S RESULT(K)=OUT("DILIST","ID",INDEX,.01)_" "_INST,K=K+1 Q
"RTN","MAGQBUT5",29,0)
 . . Q
"RTN","MAGQBUT5",30,0)
 . Q
"RTN","MAGQBUT5",31,0)
 I INDEX=1 S RESULT(K)="None",K=K+1
"RTN","MAGQBUT5",32,0)
 S RESULT(K)="The following Medical Center Divisions have 'Associated Institutions' defined on",K=K+1
"RTN","MAGQBUT5",33,0)
 S RESULT(K)="your system:" D
"RTN","MAGQBUT5",34,0)
 . S INDEX="",K=K+1,L=K  F  S INDEX=$O(^MAG(2006.1,"B",INDEX)) Q:'INDEX  D
"RTN","MAGQBUT5",35,0)
 . . Q:$P($G(^MAG(2006.1,$O(^MAG(2006.1,"B",INDEX,"")),0)),U)=INDEX
"RTN","MAGQBUT5",36,0)
 . . S RESULT(K)=$P($G(^DIC(4,INDEX,0)),U)_" "_INDEX,K=K+1 Q
"RTN","MAGQBUT5",37,0)
 . Q
"RTN","MAGQBUT5",38,0)
 I K=L S RESULT(K)="None",K=K+1
"RTN","MAGQBUT5",39,0)
 S RESULT(K)="The following Medical Center Divisions have NO Imaging parameter affiliations",K=K+1
"RTN","MAGQBUT5",40,0)
 S RESULT(K)="defined on your system:" D
"RTN","MAGQBUT5",41,0)
 . S INDEX=0,K=K+1,L=K F  S INDEX=INDEX+1 Q:'$D(OUT("DILIST","ID",INDEX))  D
"RTN","MAGQBUT5",42,0)
 . . S INST=OUT("DILIST","ID",INDEX,.07) Q:$D(^MAG(2006.1,"B",INST))  D
"RTN","MAGQBUT5",43,0)
 . . . S RESULT(K)=OUT("DILIST","ID",INDEX,.01)_" "_INST,K=K+1 Q
"RTN","MAGQBUT5",44,0)
 . . Q
"RTN","MAGQBUT5",45,0)
 . Q
"RTN","MAGQBUT5",46,0)
 I K=L S RESULT(K)="None",K=K+1
"RTN","MAGQBUT5",47,0)
 K OUT
"RTN","MAGQBUT5",48,0)
 D CLEAN^DILF
"RTN","MAGQBUT5",49,0)
 Q
"RTN","MAGQBUT5",50,0)
PLNM(PLACE) ;  Returns the Institution name of the Place
"RTN","MAGQBUT5",51,0)
 N INST
"RTN","MAGQBUT5",52,0)
 Q:'PLACE " "
"RTN","MAGQBUT5",53,0)
 S INST=$P($G(^MAG(2006.1,PLACE,0)),U)
"RTN","MAGQBUT5",54,0)
 Q $P($G(^DIC(4,INST,0)),U)
"RTN","MAGQBUT5",55,0)
TPMESS(PLACE) ;Trigger a purge message
"RTN","MAGQBUT5",56,0)
 N Y,LOC,CNT,XMSUB
"RTN","MAGQBUT5",57,0)
 D NOW^%DTC S Y=% D DD^%DT
"RTN","MAGQBUT5",58,0)
 S LOC=$$KSP^XUPARAM("WHERE")
"RTN","MAGQBUT5",59,0)
 S CNT=1,^TMP($J,"MAGQ",CNT)="SITE: "_LOC
"RTN","MAGQBUT5",60,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",CNT)="DATE: "_Y_" "_$G(^XMB("TIMEZONE"))
"RTN","MAGQBUT5",61,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",CNT)="SENDER: "_$$PLNM^MAGQBUT5(PLACE)_" Imaging Background Processor"
"RTN","MAGQBUT5",62,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",CNT)="An automatic purge event has been initiated"
"RTN","MAGQBUT5",63,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",CNT)="in order to maintain adequate image storage"
"RTN","MAGQBUT5",64,0)
 S CNT=CNT+1,^TMP($J,"MAGQ",CNT)="no operator intervention is required."
"RTN","MAGQBUT5",65,0)
 S XMSUB="Vista Imaging BP Queue processor - Autopurge"
"RTN","MAGQBUT5",66,0)
 D MAILSHR^MAGQBUT1
"RTN","MAGQBUT5",67,0)
 Q
"RTN","MAGQBUT5",68,0)
 ;
"RTN","MAGQE1")
0^22^B11840891
"RTN","MAGQE1",1,0)
MAGQE1 ;WOIFO/RMP - Support for MAG Enterprise ; 02/18/2005  09:19
"RTN","MAGQE1",2,0)
 ;;3.0;IMAGING;**27,29,30,20**;Apr 12, 2006
"RTN","MAGQE1",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQE1",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQE1",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQE1",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQE1",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQE1",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQE1",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQE1",10,0)
 ;; |                                                               |
"RTN","MAGQE1",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQE1",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQE1",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQE1",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQE1",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQE1",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQE1",17,0)
 ;;
"RTN","MAGQE1",18,0)
 Q
"RTN","MAGQE1",19,0)
 ;
"RTN","MAGQE1",20,0)
SDATE(FDAY,ORDER) ; Find first image before/after specified date
"RTN","MAGQE1",21,0)
 ; EdM: In a future patch, this function must be replaced by a cross-reference.
"RTN","MAGQE1",22,0)
 N I1,I2
"RTN","MAGQE1",23,0)
 I $G(ORDER)'="R" Q 0
"RTN","MAGQE1",24,0)
 S I1=$O(^MAG(2005," "),-1)+1 S I2=$O(^MAG(2005.1," "),-1)+1
"RTN","MAGQE1",25,0)
 Q $S(I1>I2:I1,1:I2)
"RTN","MAGQE1",26,0)
 ;
"RTN","MAGQE1",27,0)
BPV(PLACE) ;
"RTN","MAGQE1",28,0)
 N BPWS,D0,NODE,INDEX,WS
"RTN","MAGQE1",29,0)
 K BPWS
"RTN","MAGQE1",30,0)
 S WS="" F  S WS=$O(^MAG(2006.8,"C",PLACE,WS)) Q:WS=""  D
"RTN","MAGQE1",31,0)
 . S D0=$O(^MAG(2006.8,"C",PLACE,WS,""))
"RTN","MAGQE1",32,0)
 . Q:$P($G(^MAG(2006.8,D0,0)),"^",12)'="1"
"RTN","MAGQE1",33,0)
 . S NODE=$G(^MAG(2006.8,D0,1))
"RTN","MAGQE1",34,0)
 . D:$P(NODE,"^",2)>0
"RTN","MAGQE1",35,0)
 . . S INDEX=$P(NODE,"^",2)_"^"_$P(NODE,"^",4)
"RTN","MAGQE1",36,0)
 . . S BPWS(INDEX)=$G(BPWS(INDEX))+1
"RTN","MAGQE1",37,0)
 . . S $P(BPWS(INDEX),"^",2)=$P(NODE,"^",3)
"RTN","MAGQE1",38,0)
 . . Q
"RTN","MAGQE1",39,0)
 . Q
"RTN","MAGQE1",40,0)
 D:$D(BPWS) LLOAD^MAGQE5(.BPWS,"BP VERS NUM DATE: ")
"RTN","MAGQE1",41,0)
 Q
"RTN","MAGQE1",42,0)
 ;
"RTN","MAGQE1",43,0)
IWSV(PLACE) ; Image workstation versions
"RTN","MAGQE1",44,0)
 N D0,IDX,OS,RD,WSC,WSD,WSV,X
"RTN","MAGQE1",45,0)
 S RD=$$FMADD^XLFDT($$NOW^XLFDT,-180,"","","")
"RTN","MAGQE1",46,0)
 S D0=0 F  S D0=$O(^MAG(2006.81,"C",PLACE,D0)) Q:'D0  D
"RTN","MAGQE1",47,0)
 . S X=^MAG(2006.81,D0,0) Q:$P(X,"^",3)<RD
"RTN","MAGQE1",48,0)
 . S OS=$P($G(^MAG(2006.81,D0,1)),"^",2)
"RTN","MAGQE1",49,0)
 . S:OS?.N OS=$P($G(^MAG(2006.81,D0,1)),"^",3)
"RTN","MAGQE1",50,0)
 . S IDX=$P(X,"^",9) D:IDX'=""  ; Display Station
"RTN","MAGQE1",51,0)
 . . S:OS'="" IDX=IDX_"^"_OS S WSD(IDX)=$G(WSD(IDX))+1
"RTN","MAGQE1",52,0)
 . . Q
"RTN","MAGQE1",53,0)
 . S IDX=$P(X,"^",13) D:IDX'=""  ; Capture Station
"RTN","MAGQE1",54,0)
 . . S:OS'="" IDX=IDX_"^"_OS S WSC(IDX)=$G(WSC(IDX))+1
"RTN","MAGQE1",55,0)
 . . Q
"RTN","MAGQE1",56,0)
 . S IDX=$P(X,"^",15) D:IDX'=""  ; VistARad Station
"RTN","MAGQE1",57,0)
 . . S:OS'="" IDX=IDX_"^"_OS S WSV(IDX)=$G(WSV(IDX))+1
"RTN","MAGQE1",58,0)
 . . Q
"RTN","MAGQE1",59,0)
 . Q
"RTN","MAGQE1",60,0)
 D LLOAD^MAGQE5(.WSD," WS DIS VERS: ")
"RTN","MAGQE1",61,0)
 D LLOAD^MAGQE5(.WSC," WS CAP VERS: ")
"RTN","MAGQE1",62,0)
 D LLOAD^MAGQE5(.WSV," WS VR VERS: ")
"RTN","MAGQE1",63,0)
 Q
"RTN","MAGQE1",64,0)
 ;
"RTN","MAGQE1",65,0)
DICOMV() ; Version of DICOM
"RTN","MAGQE1",66,0)
 N D0,DCMG,RD,T,VER,X
"RTN","MAGQE1",67,0)
 S RD=$$FMADD^XLFDT($$NOW^XLFDT,-30,"","","")
"RTN","MAGQE1",68,0)
 S X="" F  S X=$O(^MAG(2006.83,"B",X)) Q:X=""  D
"RTN","MAGQE1",69,0)
 . S D0=$O(^MAG(2006.83,"B",X,"")) Q:'D0
"RTN","MAGQE1",70,0)
 . S T=$G(^MAG(2006.83,D0,0)) Q:$P(T,"^",2)<RD
"RTN","MAGQE1",71,0)
 . S VER=$P(T,"^",3) S:VER="" VER="?"
"RTN","MAGQE1",72,0)
 . S DCMG(VER)=$G(DCMG(VER))+1
"RTN","MAGQE1",73,0)
 . Q
"RTN","MAGQE1",74,0)
 D:$D(DCMG) LLOAD^MAGQE5(.DCMG,"DICOM Gateway Version: ")
"RTN","MAGQE1",75,0)
 Q
"RTN","MAGQE1",76,0)
 ;
"RTN","MAGQE1",77,0)
VSTAV() ;
"RTN","MAGQE1",78,0)
 N VER
"RTN","MAGQE1",79,0)
 S VER=$$VERSION^XPDUTL("IMAGING")
"RTN","MAGQE1",80,0)
 S:$T(LAST^XPDUTL)'="" VER=VER_"^"_$$LAST^XPDUTL("IMAGING",VER)
"RTN","MAGQE1",81,0)
 Q VER
"RTN","MAGQE1",82,0)
 ;
"RTN","MAGQE1",83,0)
SNS(PLACE) ;
"RTN","MAGQE1",84,0)
 N D1,RESULT
"RTN","MAGQE1",85,0)
 S RESULT=$P(^MAG(2006.1,PLACE,0),"^",2)
"RTN","MAGQE1",86,0)
 S D1=0 F  S D1=$O(^MAG(2006.1,PLACE,4,D1)) Q:'D1  D
"RTN","MAGQE1",87,0)
 . S RESULT=RESULT_"^"_$P($G(^MAG(2006.1,PLACE,4,D1,0)),"^",1)
"RTN","MAGQE1",88,0)
 . Q
"RTN","MAGQE1",89,0)
 Q RESULT
"RTN","MAGQE1",90,0)
 ;
"RTN","MAGQE2")
0^34^B17337879
"RTN","MAGQE2",1,0)
MAGQE2 ;WOIFO/RMP - Support for MAG Enterprise ; 08/22/2003  13:44
"RTN","MAGQE2",2,0)
 ;;3.0;IMAGING;**27,29,20**;Apr 12, 2006
"RTN","MAGQE2",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQE2",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQE2",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQE2",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQE2",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQE2",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQE2",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQE2",10,0)
 ;; |                                                               |
"RTN","MAGQE2",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQE2",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQE2",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQE2",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQE2",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQE2",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQE2",17,0)
 ;;
"RTN","MAGQE2",18,0)
 Q
"RTN","MAGQE2",19,0)
 ;
"RTN","MAGQE2",20,0)
MAILSHR ; Shared Mail server code
"RTN","MAGQE2",21,0)
 N D,D0,D1,D2,DG,DIC,DICR,DIW,XMID,XMY
"RTN","MAGQE2",22,0)
 S XMID=$G(DUZ) S:'XMID XMID=.5
"RTN","MAGQE2",23,0)
 S XMY(XMID)=""
"RTN","MAGQE2",24,0)
 S XMY("G.MAG SERVER")=""
"RTN","MAGQE2",25,0)
 S:$G(MAGDUZ) XMY(MAGDUZ)=""
"RTN","MAGQE2",26,0)
 S XMSUB=$E(XMSUB,1,63)
"RTN","MAGQE2",27,0)
 D SENDMSG^XMXAPI(XMID,XMSUB,"^TMP($J,""MAGQ"")",.XMY,,.XMZ,)
"RTN","MAGQE2",28,0)
 I $G(XMERR) M XMERR=^TMP("XMERR",$J) S $EC=",U13-Cannot send MailMan message," K XMERR
"RTN","MAGQE2",29,0)
 Q
"RTN","MAGQE2",30,0)
 ;
"RTN","MAGQE2",31,0)
AHISU(START,STOP) ;
"RTN","MAGQE2",32,0)
 N ADHOC
"RTN","MAGQE2",33,0)
 S ADHOC=1
"RTN","MAGQE2",34,0)
 ;
"RTN","MAGQE2",35,0)
ISU ;IMAGING SITE USAGE - SERVER
"RTN","MAGQE2",36,0)
 N INST,LOC,PLACE,TMP
"RTN","MAGQE2",37,0)
 I $$CONSOLID^MAGQE5() D
"RTN","MAGQE2",38,0)
 . S INST="" F  S INST=$O(^MAG(2006.1,"B",INST)) Q:INST=""  D
"RTN","MAGQE2",39,0)
 . . S PLACE=$O(^MAG(2006.1,"B",INST,"")) Q:'PLACE
"RTN","MAGQE2",40,0)
 . . Q:($P($G(^MAG(2006.1,PLACE,0)),U)'=INST)  ;Screen Associated Institutions
"RTN","MAGQE2",41,0)
 . . D ISU1(PLACE,INST)
"RTN","MAGQE2",42,0)
 . . Q
"RTN","MAGQE2",43,0)
 . Q
"RTN","MAGQE2",44,0)
 E  D ISU1($O(^MAG(2006.1," "),-1),$$KSP^XUPARAM("INST"))
"RTN","MAGQE2",45,0)
 D:'$G(ADHOC) TASK^MAGQE4
"RTN","MAGQE2",46,0)
 K ^TMP($J,"MAGQ")
"RTN","MAGQE2",47,0)
 Q
"RTN","MAGQE2",48,0)
 ;
"RTN","MAGQE2",49,0)
ISU1(PLACE,INST) ;
"RTN","MAGQE2",50,0)
 I '$G(ADHOC) D TASK Q  ; We are already in a TaskMan task...
"RTN","MAGQE2",51,0)
 ;
"RTN","MAGQE2",52,0)
 S ZTDTH=$$NOW^XLFDT()
"RTN","MAGQE2",53,0)
 S ZTRTN="TASK^"_$T(+0)
"RTN","MAGQE2",54,0)
 S ZTDESC="Ad-Hoc Imaging Usage Report ("_$$FMTE^XLFDT(START\1)_" - "_$$FMTE^XLFDT(STOP\1)_")"
"RTN","MAGQE2",55,0)
 S ZTIO=""
"RTN","MAGQE2",56,0)
 S ZTSAVE("START")=START
"RTN","MAGQE2",57,0)
 S ZTSAVE("STOP")=STOP
"RTN","MAGQE2",58,0)
 S ZTSAVE("PLACE")=PLACE
"RTN","MAGQE2",59,0)
 S ZTSAVE("INST")=INST
"RTN","MAGQE2",60,0)
 S:$G(ADHOC) ZTSAVE("ADHOC")=1
"RTN","MAGQE2",61,0)
 S:$D(MAGDUZ) ZTSAVE("MAGDUZ")=MAGDUZ
"RTN","MAGQE2",62,0)
 D ^%ZTLOAD
"RTN","MAGQE2",63,0)
 K ZTDTH,ZTRTN,ZTDESC,ZTIO,ZTSAVE
"RTN","MAGQE2",64,0)
 Q
"RTN","MAGQE2",65,0)
 ;
"RTN","MAGQE2",66,0)
MSG(TXT) N I
"RTN","MAGQE2",67,0)
 S I=$O(^TMP($J,"MAGQ"," "),-1)+1,^TMP($J,"MAGQ",I)=TXT
"RTN","MAGQE2",68,0)
 Q
"RTN","MAGQE2",69,0)
 ;
"RTN","MAGQE2",70,0)
TASK N DM,I,LOC,NEW,OCONS,PCNT,REC,VR,XMSUB,Y
"RTN","MAGQE2",71,0)
 S:'$D(INST) INST=$$KSP^XUPARAM("INST")
"RTN","MAGQE2",72,0)
 K ^TMP($J,"MAGQ")
"RTN","MAGQE2",73,0)
 I '$G(START)!'$G(STOP) D
"RTN","MAGQE2",74,0)
 . S STOP=$$FMADD^XLFDT($$NOW^XLFDT()\100_"01",-1)
"RTN","MAGQE2",75,0)
 . S START=STOP\100_"01"
"RTN","MAGQE2",76,0)
 . Q
"RTN","MAGQE2",77,0)
 D NOW^%DTC S Y=% D DD^%DT
"RTN","MAGQE2",78,0)
 S U="^",LOC=$$GET1^DIQ(4,INST,.01)_"^"_INST
"RTN","MAGQE2",79,0)
 D MSG("            SITE: "_LOC)
"RTN","MAGQE2",80,0)
 D MSG("Reporting Period: "_$$FMTE^XLFDT(START\1)_" - "_$$FMTE^XLFDT(STOP\1))
"RTN","MAGQE2",81,0)
 D MSG("            DATE: "_Y_" "_$G(^XMB("TIMEZONE")))
"RTN","MAGQE2",82,0)
 D MSG("          DOMAIN: "_$$KSP^XUPARAM("WHERE"))
"RTN","MAGQE2",83,0)
 D MSG("    2005 ENTRIES: "_$P($G(^MAG(2005,0)),"^",4))
"RTN","MAGQE2",84,0)
 D MSG(" 2006.81 ENTRIES: "_$$WSP^MAGQE5(PLACE))
"RTN","MAGQE2",85,0)
 ; Distribute an array each of the capture and display versions
"RTN","MAGQE2",86,0)
 D IWSV^MAGQE1(PLACE)
"RTN","MAGQE2",87,0)
 ; VistaRad version
"RTN","MAGQE2",88,0)
 S VR=$$VERSION^XPDUTL("MAGJ RADIOLOGY") D:VR'="" MSG("VistaRad Version: "_VR)
"RTN","MAGQE2",89,0)
 I $D(^MAGD(2006.599,0)) D MSG("DICOM Error Log:"_+$P(^MAGD(2006.599,0),"^",4))
"RTN","MAGQE2",90,0)
 I $D(^MAGD(2006.575,0)) D MSG("DICOM FAILED IMAGES:"_+$P(^MAGD(2006.575,0),"^",4))
"RTN","MAGQE2",91,0)
 ; Queue File count & Unprocessed Queue entries
"RTN","MAGQE2",92,0)
 D MSG("Queue File count: "_$$QCNT^MAGQE5(.PCNT,PLACE))
"RTN","MAGQE2",93,0)
 D MSG("Unprocessed Queue entries: "_PCNT)
"RTN","MAGQE2",94,0)
 D ISU2^MAGQE5
"RTN","MAGQE2",95,0)
 S X=""
"RTN","MAGQE2",96,0)
 S:'$G(ADHOC) X=" ("_$P("Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec"," ",START\100#100)_" "_(START\10000+1700)_")"
"RTN","MAGQE2",97,0)
 S XMSUB=$S($G(ADHOC):"Ad Hoc",1:"Monthly")_" Image Site Usage: "_LOC_X
"RTN","MAGQE2",98,0)
 D MAILSHR
"RTN","MAGQE2",99,0)
 Q
"RTN","MAGQE2",100,0)
 ;
"RTN","MAGQE3")
0^32^B75394836
"RTN","MAGQE3",1,0)
MAGQE3 ;WOIFO/RMP - Support for MAG Enterprise ; 05/06/2004  06:32
"RTN","MAGQE3",2,0)
 ;;3.0;IMAGING;**27,29,30,20**;Apr 12, 2006
"RTN","MAGQE3",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQE3",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQE3",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQE3",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQE3",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQE3",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQE3",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQE3",10,0)
 ;; |                                                               |
"RTN","MAGQE3",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQE3",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQE3",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQE3",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQE3",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQE3",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQE3",17,0)
 ;;
"RTN","MAGQE3",18,0)
 Q
"RTN","MAGQE3",19,0)
 ;
"RTN","MAGQE3",20,0)
COUNT(SDATE,EDATE,INST,AI,GP,GO,ID) ;
"RTN","MAGQE3",21,0)
 N CLIN,CONSENTS,CPTR,D0,DAT,DELETED,DICOM,DOC,DOCGRP,DOCUMENT,ED0,GRPPRNT,I,IMAGE,IMPORT
"RTN","MAGQE3",22,0)
 N NAME,OTHER,PCE,PROC,SD0,TRK,ZNODE,CNODE
"RTN","MAGQE3",23,0)
 S SD0=$$SDATE^MAGQE1(SDATE,"F")
"RTN","MAGQE3",24,0)
 S ED0=$$SDATE^MAGQE1(EDATE,"R")
"RTN","MAGQE3",25,0)
 D MSG^MAGQE2(" From, FileMan Date="""_SDATE_""", D0="""_SD0_""".")
"RTN","MAGQE3",26,0)
 D MSG^MAGQE2("Until, FileMan Date="""_EDATE_""", D0="""_ED0_""".")
"RTN","MAGQE3",27,0)
 S D0="" F  S D0=$O(^MAG(2005.02,"B","DOCUMENT",D0)) Q:D0=""  D
"RTN","MAGQE3",28,0)
 . S:$G(^MAG(2005.02,D0,4))["TIF" DOC(D0)=""
"RTN","MAGQE3",29,0)
 . Q
"RTN","MAGQE3",30,0)
 S (CONSENTS,GRPPRNT,IMAGE,DELETED,DOCGRP,DOCUMENT)=0
"RTN","MAGQE3",31,0)
 S CPTR=$O(^MAG(2005.83,"B","CONSENT",""))
"RTN","MAGQE3",32,0)
 S D0=SD0 F  S D0=$O(^MAG(2005,D0)) Q:'D0  Q:D0'<ED0  D
"RTN","MAGQE3",33,0)
 . S CNODE=$G(^MAG(2005,D0,100))
"RTN","MAGQE3",34,0)
 . S PCE=$P(CNODE,"^",3) I PCE Q:((PCE'=INST)&(AI'[("^"_PCE_"^")))
"RTN","MAGQE3",35,0)
 . S ZNODE=$G(^MAG(2005,D0,0))
"RTN","MAGQE3",36,0)
 . S X=$P($G(^MAG(2005,D0,2)),"^",1) Q:'X  Q:X<SDATE  Q:X>EDATE
"RTN","MAGQE3",37,0)
 . I $P(ZNODE,"^",2)="" S GP=GP+1
"RTN","MAGQE3",38,0)
 . E  S GO=GO+1
"RTN","MAGQE3",39,0)
 . S PCE=$P(CNODE,"^",5),TRK="" I PCE'="" D
"RTN","MAGQE3",40,0)
 . . S TRK=$P($G(^MAG(2006.04,$P(CNODE,U,4),0)),U)
"RTN","MAGQE3",41,0)
 . . S TRK=$S(TRK'="":TRK,1:"?") Q
"RTN","MAGQE3",42,0)
 . I $P(ZNODE,"^",2)="" D  Q
"RTN","MAGQE3",43,0)
 . . S GRPPRNT=GRPPRNT+1
"RTN","MAGQE3",44,0)
 . . S PCE=$P(ZNODE,"^",8) S:PCE="" PCE="NIL"
"RTN","MAGQE3",45,0)
 . . S:$D(^MAG(2005,D0,"PACS")) DICOM(PCE,0)=$G(DICOM(PCE,0))+1
"RTN","MAGQE3",46,0)
 . . S PCE=$P(ZNODE,"^",6) I PCE,$D(DOC(PCE)) S DOCGRP=DOCGRP+1
"RTN","MAGQE3",47,0)
 . . S:TRK'="" IMPORT(TRK,0)=$G(IMPORT(TRK,0))+1
"RTN","MAGQE3",48,0)
 . . Q
"RTN","MAGQE3",49,0)
 . S:TRK'="" IMPORT(TRK)=$G(IMPORT(TRK))+1
"RTN","MAGQE3",50,0)
 . I CPTR,$P($G(^MAG(2005,D0,40)),"^",3)=CPTR S CONSENTS=CONSENTS+1
"RTN","MAGQE3",51,0)
 . E  S PCE=$$UPPER^MAGQE4($P($G(^MAG(2005,D0,2)),"^",4)) S:PCE["CONSENT" OTHER(PCE)=$G(OTHER(PCE))+1
"RTN","MAGQE3",52,0)
 . S IMAGE=IMAGE+1
"RTN","MAGQE3",53,0)
 . S PCE=$P(ZNODE,"^",6) I PCE,$D(DOC(PCE)) S DOCUMENT=DOCUMENT+1
"RTN","MAGQE3",54,0)
 . S PCE=$P(ZNODE,"^",7) S:PCE="" PCE="NIL"
"RTN","MAGQE3",55,0)
 . S ^TMP($J,"MAGQ","ACQPAT",PCE)=""
"RTN","MAGQE3",56,0)
 . S ^TMP($J,"MAGQ","ALLPAT",PCE)=""
"RTN","MAGQE3",57,0)
 . S PCE=$P(ZNODE,"^",8) S:PCE="" PCE="NIL"
"RTN","MAGQE3",58,0)
 . I $D(^MAG(2005,D0,"PACS")) S DICOM(PCE)=$G(DICOM(PCE))+1
"RTN","MAGQE3",59,0)
 . E  S CLIN(PCE)=$G(CLIN(PCE))+1
"RTN","MAGQE3",60,0)
 . Q
"RTN","MAGQE3",61,0)
 S NAME="" F  S NAME=$O(DICOM(NAME)) Q:NAME=""  D
"RTN","MAGQE3",62,0)
 . D:$E(NAME,1,4)="RAD "
"RTN","MAGQE3",63,0)
 . . Q:'$D(DICOM(NAME,0))
"RTN","MAGQE3",64,0)
 . . S I=$E(NAME,5,$L(NAME)) Q:I=""
"RTN","MAGQE3",65,0)
 . . Q:$D(DICOM(I,0))
"RTN","MAGQE3",66,0)
 . . S DICOM(I,0)=DICOM(NAME,0) K DICOM(NAME,0) Q
"RTN","MAGQE3",67,0)
 . S PROC=$O(^RAMIS(73.1,"B",NAME,"")) Q:'PROC
"RTN","MAGQE3",68,0)
 . S $P(DICOM(NAME),"^",2)=$P($G(^RAMIS(73.1,PROC,0)),"^",2) Q
"RTN","MAGQE3",69,0)
 S D0=SD0 F  S D0=$O(^MAG(2005.1,D0)) Q:'D0  Q:D0'<ED0  D
"RTN","MAGQE3",70,0)
 . S PCE=$P($G(^MAG(2005.1,D0,100)),"^",3) I PCE Q:((PCE'=INST)&(AI'[("^"_PCE_"^")))
"RTN","MAGQE3",71,0)
 . S ID=ID+1
"RTN","MAGQE3",72,0)
 . S X=$P($G(^MAG(2005.1,D0,2)),"^",1) Q:'X  Q:X<SDATE  Q:X>EDATE
"RTN","MAGQE3",73,0)
 . S DELETED=DELETED+1 Q
"RTN","MAGQE3",74,0)
 S I="" F  S I=$O(DICOM(I)) Q:I=""  D
"RTN","MAGQE3",75,0)
 . S X=" DICOM CAPTURE: "_I_"^"_$G(DICOM(I))
"RTN","MAGQE3",76,0)
 . S:$G(DICOM(I,0)) $P(X,"^",4)=DICOM(I,0)
"RTN","MAGQE3",77,0)
 . D MSG^MAGQE2(X) Q
"RTN","MAGQE3",78,0)
 S I="" F  S I=$O(IMPORT(I)) Q:I=""  D
"RTN","MAGQE3",79,0)
 . S X=" IMPORT API: "_I_"^"_IMPORT(I)
"RTN","MAGQE3",80,0)
 . S:$G(IMPORT(I,0)) X=X_"^"_IMPORT(I,0)
"RTN","MAGQE3",81,0)
 . D MSG^MAGQE2(X) Q
"RTN","MAGQE3",82,0)
 D LLOAD^MAGQE5(.CLIN,"CLIN CAPTURE:")
"RTN","MAGQE3",83,0)
 D MSG^MAGQE2("CONSENT FORMS: "_CONSENTS)
"RTN","MAGQE3",84,0)
 D LLOAD^MAGQE5(.OTHER,"OTHER CONSENTS:")
"RTN","MAGQE3",85,0)
 D MSG^MAGQE2("Image file group parents: "_GRPPRNT)
"RTN","MAGQE3",86,0)
 D MSG^MAGQE2("Image file objects: "_IMAGE)
"RTN","MAGQE3",87,0)
 D MSG^MAGQE2("Image file deletes: "_DELETED)
"RTN","MAGQE3",88,0)
 D MSG^MAGQE2("Document Images (TIF): "_DOCUMENT)
"RTN","MAGQE3",89,0)
 D MSG^MAGQE2("Document Groups (TIF): "_DOCGRP)
"RTN","MAGQE3",90,0)
 Q
"RTN","MAGQE3",91,0)
 ;
"RTN","MAGQE3",92,0)
ACT(D0,DIS,CAP,VD,VI,RES) ;
"RTN","MAGQE3",93,0)
 N ACT,AN,AN2,D1,IMG
"RTN","MAGQE3",94,0)
 S D1=0 F  S D1=$O(^MAG(2006.82,D0,"ACT",D1)) Q:'D1  D
"RTN","MAGQE3",95,0)
 . S AN=^MAG(2006.82,D0,"ACT",D1,0)
"RTN","MAGQE3",96,0)
 . S ACT="^"_$P(AN,"^",1)_"^",AN2=+$P(AN,"^",2)
"RTN","MAGQE3",97,0)
 . Q:"^LOGON^LOGOFF^PAT^"[ACT
"RTN","MAGQE3",98,0)
 . I "^SC_BAD^SCR_OK^"[ACT D  Q
"RTN","MAGQE3",99,0)
 . . S AN=$P(AN,"^",10,14) Q:AN=""
"RTN","MAGQE3",100,0)
 . . S RES(ACT,AN)=$G(RES(ACT,AN))+1 Q
"RTN","MAGQE3",101,0)
 . I "^CAP^IMG^"[ACT D  Q
"RTN","MAGQE3",102,0)
 . . S IMG=+$P(AN,"^",3) Q:'IMG  Q:$P($G(^MAG(2005,IMG,0)),"^",2)=""
"RTN","MAGQE3",103,0)
 . . I ACT="^CAP^" S CAP=CAP+1 Q
"RTN","MAGQE3",104,0)
 . . S DIS=DIS+1,^TMP($J,"MAGQ","DISPAT",AN2)="",^TMP($J,"MAGQ","ALLPAT",AN2)=""
"RTN","MAGQE3",105,0)
 . . Q
"RTN","MAGQE3",106,0)
 . I "^VR-VW^"[ACT D VRAD(.VD,AN) S ^TMP($J,"MAGQ","DISPAT",AN2)="",^TMP($J,"MAGQ","ALLPAT",AN2)="" Q
"RTN","MAGQE3",107,0)
 . I "^VR-INT^"[ACT D VRAD(.VI,AN) S ^TMP($J,"MAGQ","DISPAT",AN2)="",^TMP($J,"MAGQ","ALLPAT",AN2)="" Q
"RTN","MAGQE3",108,0)
 . Q
"RTN","MAGQE3",109,0)
 Q
"RTN","MAGQE3",110,0)
 ;
"RTN","MAGQE3",111,0)
VRAD(ARR,AN) ;
"RTN","MAGQE3",112,0)
 ;ARR=STUDIES^IMAGES^PATIENTS^User Type(Rad/Non-Rad)^Remotes(Remote/Local)^Modalities
"RTN","MAGQE3",113,0)
 N P,X
"RTN","MAGQE3",114,0)
 S $P(ARR,"^",1)=$P($G(ARR),"^",1)+1 ; Studies
"RTN","MAGQE3",115,0)
 S $P(ARR,"^",2)=$P($G(ARR),"^",2)+$P(AN,"^",6) ; Images
"RTN","MAGQE3",116,0)
 S $P(ARR,"^",3)=$P($G(ARR),"^",3)+$P(AN,"^",7) ; Patients
"RTN","MAGQE3",117,0)
 S P=$P(ARR,"^",4)
"RTN","MAGQE3",118,0)
 I +$P(AN,"^",8)=1 S $P(P,"/",1)=$P(P,"/",1)+1
"RTN","MAGQE3",119,0)
 E  S $P(P,"/",2)=$P(P,"/",2)+1
"RTN","MAGQE3",120,0)
 S $P(ARR,"^",4)=P ; User Type
"RTN","MAGQE3",121,0)
 S P=$P(ARR,"^",5)
"RTN","MAGQE3",122,0)
 I +$P(AN,"^",9)=1 S $P(P,"/",1)=$P(P,"/",1)+1
"RTN","MAGQE3",123,0)
 E  S $P(P,"/",2)=$P(P,"/",2)+1
"RTN","MAGQE3",124,0)
 S $P(ARR,"^",5)=P ; Remotes
"RTN","MAGQE3",125,0)
 S P=$P(AN,"^",4) S:P="" P="unknown"
"RTN","MAGQE3",126,0)
 S ARR(P)=$G(ARR(P))+1
"RTN","MAGQE3",127,0)
 S (P,X)="" F  S P=$O(ARR(P)) Q:P=""  S X=X_"/"_P_"="_ARR(P)
"RTN","MAGQE3",128,0)
 S $P(ARR,"^",6)=X ; Modalities
"RTN","MAGQE3",129,0)
 Q
"RTN","MAGQE3",130,0)
 ;
"RTN","MAGQE3",131,0)
GPACHX() ; Get Package File Install History of Imaging
"RTN","MAGQE3",132,0)
 N I,LCNT,MSG,PKG,PKT,PV
"RTN","MAGQE3",133,0)
 S LCNT=0
"RTN","MAGQE3",134,0)
 F PKG="IMAGING","MAGJ RADIOLOGY" D
"RTN","MAGQE3",135,0)
 . N J,K,L,PKNAM,VERS
"RTN","MAGQE3",136,0)
 . S J=$$FIND1^DIC(9.4,",","MX",PKG) Q:'J
"RTN","MAGQE3",137,0)
 . I PKG="MAGJ RADIOLOGY" D  Q
"RTN","MAGQE3",138,0)
 . . N TAR
"RTN","MAGQE3",139,0)
 . . D LIST^DIC(9.49,","_J_",","@;.01;2;3","","","","","","","","TAR","MSG")
"RTN","MAGQE3",140,0)
 . . Q:$D(MSG("DIERR"))
"RTN","MAGQE3",141,0)
 . . S L=0 F  S L=$O(TAR("DILIST","ID",L)) Q:'L  D
"RTN","MAGQE3",142,0)
 . . . S LCNT=LCNT+1
"RTN","MAGQE3",143,0)
 . . . S PV(LCNT)=PKG_"^P"_$P(TAR("DILIST","ID",L,".01"),"^",1)
"RTN","MAGQE3",144,0)
 . . . S PV(LCNT)=PV(LCNT)_"^"_$P(TAR("DILIST","ID",L,"2"),"^",1)
"RTN","MAGQE3",145,0)
 . . . S PV(LCNT)=PV(LCNT)_"^"_$P(TAR("DILIST","ID",L,"3"),"^",1) Q
"RTN","MAGQE3",146,0)
 . . Q
"RTN","MAGQE3",147,0)
 . K PKT D LIST^DIC(9.49,","_J_",",.01,"","*","","","B","","","PKT","MSG")
"RTN","MAGQE3",148,0)
 . S VERS="" F  S VERS=$O(PKT("DILIST",2,VERS)) Q:VERS=""  S K=PKT("DILIST",2,VERS) D
"RTN","MAGQE3",149,0)
 . . K MSG
"RTN","MAGQE3",150,0)
 . . D LIST^DIC(9.4901,","_K_","_J_",","@;.01;.02;.03","","","","","","","","TAR","MSG")
"RTN","MAGQE3",151,0)
 . . Q:$D(MSG("DIERR"))
"RTN","MAGQE3",152,0)
 . . S L=0 F  S L=$O(TAR("DILIST","ID",L)) Q:'L  D
"RTN","MAGQE3",153,0)
 . . . S LCNT=LCNT+1
"RTN","MAGQE3",154,0)
 . . . S PV(LCNT)=PKG_"^"_VERS_"P"_$P(TAR("DILIST","ID",L,".01"),"^",1)
"RTN","MAGQE3",155,0)
 . . . S PV(LCNT)=PV(LCNT)_"^"_$P(TAR("DILIST","ID",L,".02"),"^",1)
"RTN","MAGQE3",156,0)
 . . . S PV(LCNT)=PV(LCNT)_"^"_$P(TAR("DILIST","ID",L,".03"),"^",1) Q
"RTN","MAGQE3",157,0)
 . . Q
"RTN","MAGQE3",158,0)
 . Q
"RTN","MAGQE3",159,0)
 S I="" F  S I=$O(PV(I)) Q:I=""  D
"RTN","MAGQE3",160,0)
 . D MSG^MAGQE2("IMAGING PACKAGE INSTALLATION HX: "_I_"^"_PV(I)) Q
"RTN","MAGQE3",161,0)
 Q
"RTN","MAGQE3",162,0)
 ;
"RTN","MAGQE3",163,0)
ADCNT(SDATE,EDATE,INST,AI) ;
"RTN","MAGQE3",164,0)
 ; SAC = Scanned, Administrative Closure SMC = Scanned, Manual Closure UMC = Unscanned, Manual Closure
"RTN","MAGQE3",165,0)
 N ARRY,D0,D1,DATE,DATES,DOC,HLOC,SAC,SCR,SMC,STAT,STATA,STATC,TITLE,TIUDA,UMC
"RTN","MAGQE3",166,0)
 S STATA="^",D0=0 F  S D0=$O(^TIU(8925.6,"B","AMENDED",D0)) Q:'D0  D
"RTN","MAGQE3",167,0)
 . S STATA=STATA_D0_"^" Q
"RTN","MAGQE3",168,0)
 S STATC="^",D0=0 F  S D0=$O(^TIU(8925.6,"B","COMPLETED",D0)) Q:'D0  D
"RTN","MAGQE3",169,0)
 . S STATC=STATC_D0_"^" Q
"RTN","MAGQE3",170,0)
 S DOC="ADVANCE DIRECTIVE"
"RTN","MAGQE3",171,0)
 S D0=0 F  S D0=$O(^TIU(8925.1,"B",DOC,D0)) Q:'D0  D
"RTN","MAGQE3",172,0)
 . Q:$P($G(^TIU(8925.1,D0,0)),"^",4)'="DC"
"RTN","MAGQE3",173,0)
 . S D1=0 F  S D1=$O(^TIU(8925.1,D0,10,"B",D1)) Q:'D1  D
"RTN","MAGQE3",174,0)
 . . S TITLE=$P($G(^TIU(8925.1,+D1,0)),"^",1) S:TITLE="" TITLE=" "
"RTN","MAGQE3",175,0)
 . . S ARRY(TITLE,D1)="" Q
"RTN","MAGQE3",176,0)
 . Q
"RTN","MAGQE3",177,0)
 S SCR="",(SAC,SMC,UMC)=0
"RTN","MAGQE3",178,0)
 S TITLE="" F  S TITLE=$O(ARRY(TITLE)) Q:TITLE=""  D
"RTN","MAGQE3",179,0)
 . S D1="" F  S D1=$O(ARRY(TITLE,D1)) Q:D1=""  D
"RTN","MAGQE3",180,0)
 . . S TIUDA=0 F  S TIUDA=$O(^TIU(8925,"B",D1,TIUDA)) Q:'TIUDA  D
"RTN","MAGQE3",181,0)
 . . . N MSG,TARGET
"RTN","MAGQE3",182,0)
 . . . S SCR="" ; INSTITUTION screen for consolidation sites only.
"RTN","MAGQE3",183,0)
 . . . D GETS^DIQ(8925,TIUDA,".05;1205;1501;1507;1603;1606;1613","IE","TARGET","MSG")
"RTN","MAGQE3",184,0)
 . . . Q:$D(MSG("DIERR"))
"RTN","MAGQE3",185,0)
 . . . I $$CONSOLID^MAGQE5() D  Q:SCR
"RTN","MAGQE3",186,0)
 . . . . S HLOC=TARGET(8925,TIUDA_",",1205,"I") ; INSTITUTION screen - dependent upon TIU*1*113
"RTN","MAGQE3",187,0)
 . . . . I HLOC="" S SCR=1
"RTN","MAGQE3",188,0)
 . . . . E  I (($P($G(^SC(HLOC,0)),"^",4)'=INST)&(AI'[("^"_$P($G(^SC(HLOC,0)),"^",4)_"^")))  S SCR=1
"RTN","MAGQE3",189,0)
 . . . . Q
"RTN","MAGQE3",190,0)
 . . . S STAT="^"_TARGET(8925,TIUDA_",",.05,"I")_"^"
"RTN","MAGQE3",191,0)
 . . . Q:STATA_STATC'[STAT
"RTN","MAGQE3",192,0)
 . . . I TARGET(8925,TIUDA_",",1613,"I")="S" D  Q
"RTN","MAGQE3",193,0)
 . . . . Q:TARGET(8925,TIUDA_",",1606,"I")<SDATE
"RTN","MAGQE3",194,0)
 . . . . Q:$P(TARGET(8925,TIUDA_",",1606,"I"),".")>EDATE
"RTN","MAGQE3",195,0)
 . . . . S SAC=SAC+1,SAC(TITLE)=$G(SAC(TITLE))+1 Q
"RTN","MAGQE3",196,0)
 . . . I STATC[STAT D  Q
"RTN","MAGQE3",197,0)
 . . . . S DATE=TARGET(8925,TIUDA_",",1507,"I")
"RTN","MAGQE3",198,0)
 . . . . S DATE=$S(DATE?1.N:DATE,1:+TARGET(8925,TIUDA_",",1501,"I"))
"RTN","MAGQE3",199,0)
 . . . . Q:DATE<SDATE
"RTN","MAGQE3",200,0)
 . . . . Q:$P(DATE,".")>EDATE
"RTN","MAGQE3",201,0)
 . . . . I $$SCAN(TIUDA) S SMC=SMC+1,SMC(TITLE)=$G(SMC(TITLE))+1 Q
"RTN","MAGQE3",202,0)
 . . . . S UMC=UMC+1,UMC(TITLE)=$G(UMC(TITLE))+1 Q
"RTN","MAGQE3",203,0)
 . . . I STATA[STAT D  Q
"RTN","MAGQE3",204,0)
 . . . . Q:TARGET(8925,TIUDA_",",1603,"I")<SDATE
"RTN","MAGQE3",205,0)
 . . . . Q:$P(TARGET(8925,TIUDA_",",1603,"I"),".")>EDATE
"RTN","MAGQE3",206,0)
 . . . . I $$SCAN(TIUDA) S SMC=SMC+1,SMC(TITLE)=$G(SMC(TITLE))+1 Q
"RTN","MAGQE3",207,0)
 . . . . S UMC=UMC+1,UMC(TITLE)=$G(UMC(TITLE))+1 Q
"RTN","MAGQE3",208,0)
 . . . Q
"RTN","MAGQE3",209,0)
 . . Q
"RTN","MAGQE3",210,0)
 . Q
"RTN","MAGQE3",211,0)
 D MSG^MAGQE2(DOC_" SCANNED ADMINISTRATIVE CLOSURE: "_SAC)
"RTN","MAGQE3",212,0)
 S TITLE="" F  S TITLE=$O(SAC(TITLE)) Q:TITLE=""  D
"RTN","MAGQE3",213,0)
 . D MSG^MAGQE2(DOC_" - SAC - "_TITLE_": "_SAC(TITLE)) Q
"RTN","MAGQE3",214,0)
 D MSG^MAGQE2(DOC_" UNSCANNED MANUAL CLOSURE: "_UMC)
"RTN","MAGQE3",215,0)
 S TITLE="" F  S TITLE=$O(UMC(TITLE)) Q:TITLE=""  D
"RTN","MAGQE3",216,0)
 . D MSG^MAGQE2(DOC_" - UMC - "_TITLE_": "_UMC(TITLE)) Q
"RTN","MAGQE3",217,0)
 D MSG^MAGQE2(DOC_" SCANNED MANUAL CLOSURE: "_SMC)
"RTN","MAGQE3",218,0)
 S TITLE="" F  S TITLE=$O(SMC(TITLE)) Q:TITLE=""  D
"RTN","MAGQE3",219,0)
 . D MSG^MAGQE2(DOC_" - SMC - "_TITLE_": "_SMC(TITLE)) Q
"RTN","MAGQE3",220,0)
 Q
"RTN","MAGQE3",221,0)
 ;
"RTN","MAGQE3",222,0)
SCAN(IEN) ;
"RTN","MAGQE3",223,0)
 N LINK
"RTN","MAGQE3",224,0)
 S LINK=$O(^TIU(8925.91,"B",IEN,"")) Q:'LINK 0
"RTN","MAGQE3",225,0)
 Q $S($P($G(^TIU(8925.1,LINK,0)),"^",2)?1.N:0,1:1)
"RTN","MAGQE3",226,0)
 ;
"RTN","MAGQE5")
0^33^B48023547
"RTN","MAGQE5",1,0)
MAGQE5 ;WOIFO/RMP - Support for MAG Enterprise ; 05/06/2004  06:32
"RTN","MAGQE5",2,0)
 ;;3.0;IMAGING;**27,29,8,30,20**;Apr 12, 2006
"RTN","MAGQE5",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQE5",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGQE5",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGQE5",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGQE5",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGQE5",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGQE5",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGQE5",10,0)
 ;; |                                                               |
"RTN","MAGQE5",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGQE5",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGQE5",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGQE5",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGQE5",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGQE5",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGQE5",17,0)
 ;;
"RTN","MAGQE5",18,0)
ISU2 ;
"RTN","MAGQE5",19,0)
 ; Workstation Session and Patient counts
"RTN","MAGQE5",20,0)
 N CCNT,D0,DATE,ICNT,M1,M2,PCNT,RES,SCNAD,SCNMN,SCNT,TD,TD1,UNSCN,VD,VI,X1,X2,YR,AI,GP,GO,ID
"RTN","MAGQE5",21,0)
 S (SCNT,PCNT,ICNT,CCNT,GP,GO,ID)=0
"RTN","MAGQE5",22,0)
 S (VD,VI)=""
"RTN","MAGQE5",23,0)
 I '$$CONSOLID() D
"RTN","MAGQE5",24,0)
 . S DATE="L"_START
"RTN","MAGQE5",25,0)
 . F  S DATE=$O(^MAG(2006.82,"AC",DATE)) Q:DATE=""  Q:$P(DATE,"L",2)\1>STOP  D
"RTN","MAGQE5",26,0)
 . . S D0=0 F  S D0=$O(^MAG(2006.82,"AC",DATE,D0)) Q:'D0  D
"RTN","MAGQE5",27,0)
 . . . Q:'$D(^MAG(2006.82,D0,1))
"RTN","MAGQE5",28,0)
 . . . S SCNT=SCNT+1
"RTN","MAGQE5",29,0)
 . . . S PCNT=PCNT+$P($G(^MAG(2006.82,D0,1)),"^",1)
"RTN","MAGQE5",30,0)
 . . . D ACT^MAGQE3(D0,.ICNT,.CCNT,.VD,.VI,.RES)
"RTN","MAGQE5",31,0)
 . . . Q
"RTN","MAGQE5",32,0)
 . . Q
"RTN","MAGQE5",33,0)
 . Q
"RTN","MAGQE5",34,0)
 E  D
"RTN","MAGQE5",35,0)
 . S DATE=START
"RTN","MAGQE5",36,0)
 . F  S DATE=$O(^MAG(2006.82,"APL",PLACE,DATE)) Q:DATE=""  Q:DATE\1>STOP  D
"RTN","MAGQE5",37,0)
 . . S D0=0 F  S D0=$O(^MAG(2006.82,"APL",PLACE,DATE,D0)) Q:D0'?1.N  D
"RTN","MAGQE5",38,0)
 . . . Q:'$D(^MAG(2006.82,D0,1))
"RTN","MAGQE5",39,0)
 . . . S SCNT=SCNT+1
"RTN","MAGQE5",40,0)
 . . . S PCNT=PCNT+$P($G(^MAG(2006.82,D0,1)),"^",1)
"RTN","MAGQE5",41,0)
 . . . D ACT^MAGQE3(D0,.ICNT,.CCNT,.VD,.VI,.RES)
"RTN","MAGQE5",42,0)
 . . . Q
"RTN","MAGQE5",43,0)
 . . Q
"RTN","MAGQE5",44,0)
 . Q
"RTN","MAGQE5",45,0)
 S X1=START,X2=STOP D ^%DTC S X=$TR(X,"-")+1_" day "
"RTN","MAGQE5",46,0)
 D MSG^MAGQE2(X_"Image Workstation Sessions: "_SCNT)
"RTN","MAGQE5",47,0)
 D MSG^MAGQE2(X_"Image Workstation Patients: "_PCNT)
"RTN","MAGQE5",48,0)
 D MSG^MAGQE2(X_"Image Workstation Images: "_ICNT)
"RTN","MAGQE5",49,0)
 D MSG^MAGQE2(X_"Image Workstation Captures: "_CCNT)
"RTN","MAGQE5",50,0)
 D MSG^MAGQE2(X_"VistaRad WS Display: "_VD)
"RTN","MAGQE5",51,0)
 D MSG^MAGQE2(X_"VistaRad WS Interpretations: "_VI)
"RTN","MAGQE5",52,0)
 K VD,VI
"RTN","MAGQE5",53,0)
 I $T(AVERAGE^MAGBRTLD)'="" D
"RTN","MAGQE5",54,0)
 . D MSG^MAGQE2(X_"average daily routed images: "_$$AVERAGE^MAGBRTLD())
"RTN","MAGQE5",55,0)
 . Q
"RTN","MAGQE5",56,0)
 D BPV^MAGQE1(PLACE)
"RTN","MAGQE5",57,0)
 D MSG^MAGQE2("Vista Image Version/Build: "_$$VSTAV^MAGQE1())
"RTN","MAGQE5",58,0)
 D DICOMV^MAGQE1()
"RTN","MAGQE5",59,0)
 D MSG^MAGQE2("Image file namespace(s): "_$$SNS^MAGQE1(PLACE))
"RTN","MAGQE5",60,0)
 S I="" F  S I=$O(RES(I)) Q:I=""  D
"RTN","MAGQE5",61,0)
 . S RES="" F  S RES=$O(RES(I,RES)) Q:RES=""  D
"RTN","MAGQE5",62,0)
 . . S X=$TR(I,"^")_"^"_RES S $P(X,"^",6)=RES(I,RES)
"RTN","MAGQE5",63,0)
 . . D MSG^MAGQE2(" RESOLUTION: "_X)
"RTN","MAGQE5",64,0)
 . . Q
"RTN","MAGQE5",65,0)
 . Q
"RTN","MAGQE5",66,0)
 K RES
"RTN","MAGQE5",67,0)
 ;
"RTN","MAGQE5",68,0)
 S AI=$$GETAI(PLACE)
"RTN","MAGQE5",69,0)
 D COUNT^MAGQE3(START,STOP,INST,AI,.GP,.GO,.ID)
"RTN","MAGQE5",70,0)
 ;
"RTN","MAGQE5",71,0)
 S (I,D0)=0 F  S D0=$O(^TMP($J,"MAGQ","ACQPAT",D0)) Q:D0=""  S I=I+1
"RTN","MAGQE5",72,0)
 D MSG^MAGQE2("Unique Image patients captured: "_I)
"RTN","MAGQE5",73,0)
 K ^TMP($J,"MAGQ","ACQPAT")
"RTN","MAGQE5",74,0)
 S (I,D0)=0 F  S D0=$O(^TMP($J,"MAGQ","DISPAT",D0)) Q:D0=""  S I=I+1
"RTN","MAGQE5",75,0)
 D MSG^MAGQE2("Unique Image patients display: "_I)
"RTN","MAGQE5",76,0)
 K ^TMP($J,"MAGQ","DISPAT")
"RTN","MAGQE5",77,0)
 S (I,D0)=0 F  S D0=$O(^TMP($J,"MAGQ","ALLPAT",D0)) Q:D0=""  S I=I+1
"RTN","MAGQE5",78,0)
 D MSG^MAGQE2("Unique Image patients All: "_I)
"RTN","MAGQE5",79,0)
 K ^TMP($J,"MAGQ","ALLPAT")
"RTN","MAGQE5",80,0)
 D MSG^MAGQE2("Total Group Parents for Place: "_GP)
"RTN","MAGQE5",81,0)
 D MSG^MAGQE2("Total Image Objects for Place: "_GO)
"RTN","MAGQE5",82,0)
 D MSG^MAGQE2("Total Image Entry Deletes for Place: "_ID)
"RTN","MAGQE5",83,0)
 D ADCNT^MAGQE3(START,STOP,INST,AI)
"RTN","MAGQE5",84,0)
 D GPACHX^MAGQE3()
"RTN","MAGQE5",85,0)
 D GS1^MAGQE5() ;Get Share data
"RTN","MAGQE5",86,0)
 D AI1^MAGQE5() ;Get Associated Institutions
"RTN","MAGQE5",87,0)
 Q
"RTN","MAGQE5",88,0)
 ;
"RTN","MAGQE5",89,0)
AHOPT ;
"RTN","MAGQE5",90,0)
 N %DT,START,STOP
"RTN","MAGQE5",91,0)
 S STOP=$$FMADD^XLFDT($$NOW^XLFDT()\100_"01",-1)
"RTN","MAGQE5",92,0)
 S START=STOP\100_"01"
"RTN","MAGQE5",93,0)
 S Y=START D DD^%DT S %DT("B")=Y
"RTN","MAGQE5",94,0)
 S %DT="AEXP",%DT("A")="Enter starting Date: "
"RTN","MAGQE5",95,0)
 D ^%DT I ((X="")!(X="^")!($D(DTOUT))) K %DT(0),DTOUT Q
"RTN","MAGQE5",96,0)
 S START=Y
"RTN","MAGQE5",97,0)
 S Y=STOP D DD^%DT S %DT("B")=Y
"RTN","MAGQE5",98,0)
 S %DT="AEXP",%DT("A")="Enter ending Date: "
"RTN","MAGQE5",99,0)
 D ^%DT I ((X="")!(X="^")!($D(DTOUT))) K %DT(0),DTOUT Q
"RTN","MAGQE5",100,0)
 S STOP=Y
"RTN","MAGQE5",101,0)
 W !!,"Creating ad-hoc report over the period "
"RTN","MAGQE5",102,0)
 W $$DT(START)," until ",$$DT(STOP),".",!
"RTN","MAGQE5",103,0)
 D AHISU^MAGQE2(START,STOP)
"RTN","MAGQE5",104,0)
 Q
"RTN","MAGQE5",105,0)
 ;
"RTN","MAGQE5",106,0)
DT(X) ;
"RTN","MAGQE5",107,0)
 Q (X\1#100)_"-"_$P("Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec"," ",X\100#100)_"-"_(X\10000+1700)
"RTN","MAGQE5",108,0)
 ;
"RTN","MAGQE5",109,0)
LLOAD(AR,LBL) ;
"RTN","MAGQE5",110,0)
 N I
"RTN","MAGQE5",111,0)
 S I="" F  S I=$O(AR(I)) Q:I=""  D MSG^MAGQE2(" "_LBL_" "_I_"^"_AR(I))
"RTN","MAGQE5",112,0)
 Q
"RTN","MAGQE5",113,0)
 ;
"RTN","MAGQE5",114,0)
GETPLACE(PLACE) ; Validate place
"RTN","MAGQE5",115,0)
 S PLACE=$S($$CONSOLID():$G(PLACE),1:+$O(^MAG(2006.1," "),-1)) Q:'PLACE 0
"RTN","MAGQE5",116,0)
 S:$P($G(^MAG(2006.1,PLACE,0)),"^",1)="" PLACE=0
"RTN","MAGQE5",117,0)
 Q PLACE
"RTN","MAGQE5",118,0)
 ;
"RTN","MAGQE5",119,0)
CONSOLID() ;
"RTN","MAGQE5",120,0)
 ; Return value: 0 = site not consolidated,
"RTN","MAGQE5",121,0)
 ;               1 = site is consolidated
"RTN","MAGQE5",122,0)
 N FLDNFO
"RTN","MAGQE5",123,0)
 D FIELD^DID(2006.1,.01,"","SPECIFIER","FLDNFO")
"RTN","MAGQE5",124,0)
 I $G(FLDNFO("SPECIFIER"))["P" Q 1
"RTN","MAGQE5",125,0)
 Q 0
"RTN","MAGQE5",126,0)
 ;
"RTN","MAGQE5",127,0)
PLACE(INST) ;
"RTN","MAGQE5",128,0)
 Q:'$$CONSOLID() +$O(^MAG(2006.1," "),-1)
"RTN","MAGQE5",129,0)
 Q $$GETPLACE(+$O(^MAG(2006.1,"B",INST,"")))
"RTN","MAGQE5",130,0)
 ;
"RTN","MAGQE5",131,0)
QCNT(READY,PLACE) ;
"RTN","MAGQE5",132,0)
 N D0,FAILED,NEXT,TYPE
"RTN","MAGQE5",133,0)
 S (READY,FAILED)=0
"RTN","MAGQE5",134,0)
 I $$CONSOLID() D
"RTN","MAGQE5",135,0)
 . S TYPE="" F  S TYPE=$O(^MAGQUEUE(2006.031,"C",PLACE,TYPE)) Q:TYPE=""  D
"RTN","MAGQE5",136,0)
 . . S NEXT=+$O(^MAGQUEUE(2006.031,"C",PLACE,TYPE,""))
"RTN","MAGQE5",137,0)
 . . S NEXT=+$P($G(^MAGQUEUE(2006.031,NEXT,0)),"^",2)
"RTN","MAGQE5",138,0)
 . . S D0=0 F  S D0=$O(^MAGQUEUE(2006.03,"C",PLACE,TYPE,D0)) Q:'D0  D
"RTN","MAGQE5",139,0)
 . . . I D0<NEXT S FAILED=FAILED+1
"RTN","MAGQE5",140,0)
 . . . E  S READY=READY+1
"RTN","MAGQE5",141,0)
 . . . Q
"RTN","MAGQE5",142,0)
 . . Q
"RTN","MAGQE5",143,0)
 E  D
"RTN","MAGQE5",144,0)
 . S TYPE="" F  S TYPE=$O(^MAGQUEUE(2006.031,"B",TYPE)) Q:TYPE=""  D
"RTN","MAGQE5",145,0)
 . . S NEXT=+$O(^MAGQUEUE(2006.031,"B",TYPE,""))
"RTN","MAGQE5",146,0)
 . . S NEXT=+$P($G(^MAGQUEUE(2006.031,NEXT,0)),"^",2)
"RTN","MAGQE5",147,0)
 . . S D0=0 F  S D0=$O(^MAGQUEUE(2006.03,"B",TYPE,D0)) Q:'D0  D
"RTN","MAGQE5",148,0)
 . . . I D0<NEXT S FAILED=FAILED+1
"RTN","MAGQE5",149,0)
 . . . E  S READY=READY+1
"RTN","MAGQE5",150,0)
 . . . Q
"RTN","MAGQE5",151,0)
 . . Q
"RTN","MAGQE5",152,0)
 . Q
"RTN","MAGQE5",153,0)
 Q READY+FAILED
"RTN","MAGQE5",154,0)
 ;
"RTN","MAGQE5",155,0)
WSP(PLACE) ; Imaging workstations per place
"RTN","MAGQE5",156,0)
 N COUNT,D0,RD
"RTN","MAGQE5",157,0)
 S RD=$$FMADD^XLFDT($$NOW^XLFDT,-180,"","","")
"RTN","MAGQE5",158,0)
 S (D0,COUNT)=0 F  S D0=$O(^MAG(2006.81,"C",PLACE,D0)) Q:'D0  D
"RTN","MAGQE5",159,0)
 . S:$P(^MAG(2006.81,D0,0),"^",3)'<RD COUNT=COUNT+1
"RTN","MAGQE5",160,0)
 . Q
"RTN","MAGQE5",161,0)
 Q COUNT
"RTN","MAGQE5",162,0)
 ;
"RTN","MAGQE5",163,0)
MAGDUZ2() Q $G(DUZ(2),$$KSP^XUPARAM("INST"))
"RTN","MAGQE5",164,0)
 ;
"RTN","MAGQE5",165,0)
GS1() ; Get local Network location share data
"RTN","MAGQE5",166,0)
 N I,L,M,MSG,RESULT,TAR
"RTN","MAGQE5",167,0)
 S RESULT(0)="NETWORK LOCATION^PHYSICAL REFERENCE^TOTAL SPACE^SPACE USED^FREE SPACE^OPERATIONAL STATUS^STORAGE TYPE^HASH"
"RTN","MAGQE5",168,0)
 D LIST^DIC(2005.2,"","@;.01;1;2;3;4;5;6;7","","","","","","I $P(^(0),U,10)=PLACE","","TAR","MSG")
"RTN","MAGQE5",169,0)
 Q:$D(MSG("DIERR"))
"RTN","MAGQE5",170,0)
 S L=0 F  S L=$O(TAR("DILIST","ID",L)) Q:'L  D
"RTN","MAGQE5",171,0)
 . S RESULT(L)=$P(TAR("DILIST","ID",L,.01),U,1)
"RTN","MAGQE5",172,0)
 . F M=1,2,3,4,5,6,7 S RESULT(L)=RESULT(L)_U_$P(TAR("DILIST","ID",L,M),U,1)
"RTN","MAGQE5",173,0)
 . Q
"RTN","MAGQE5",174,0)
 S I="" F  S I=$O(RESULT(I)) Q:I=""  D
"RTN","MAGQE5",175,0)
 . D MSG^MAGQE2("LOCAL NETWORK LOCATIONS: "_I_"^"_RESULT(I))
"RTN","MAGQE5",176,0)
 . Q
"RTN","MAGQE5",177,0)
 K TAR,MSG,RESULT
"RTN","MAGQE5",178,0)
 Q
"RTN","MAGQE5",179,0)
AI1() ; get Associated Institutions list per place
"RTN","MAGQE5",180,0)
 N I,L,M,MSG,RESULT,TAR
"RTN","MAGQE5",181,0)
 S RESULT(0)="Associated Institutions"
"RTN","MAGQE5",182,0)
 D LIST^DIC(2006.12,","_PLACE_",","@;.01","","","","","","","","TAR","MSG")
"RTN","MAGQE5",183,0)
 Q:$D(MSG("DIERR"))
"RTN","MAGQE5",184,0)
 S L=0 F  S L=$O(TAR("DILIST","ID",L)) Q:'L  D
"RTN","MAGQE5",185,0)
 . S RESULT(L)=$P(TAR("DILIST","ID",L,.01),U,1)
"RTN","MAGQE5",186,0)
 . Q
"RTN","MAGQE5",187,0)
 S I="" F  S I=$O(RESULT(I)) Q:I=""  D
"RTN","MAGQE5",188,0)
 . D MSG^MAGQE2("ASSOCIATED INSTITUTIONS: "_I_"^"_RESULT(I))
"RTN","MAGQE5",189,0)
 . Q
"RTN","MAGQE5",190,0)
 K TAR,MSG,RESULT
"RTN","MAGQE5",191,0)
 Q
"RTN","MAGQE5",192,0)
GETAI(PLACE,PARAM) ;
"RTN","MAGQE5",193,0)
 N I,J
"RTN","MAGQE5",194,0)
 S PARAM=$S('$D(PARAM):U,PARAM="":U,1:PARAM)
"RTN","MAGQE5",195,0)
 S I="",J=PARAM
"RTN","MAGQE5",196,0)
 F  S I=$O(^MAG(2006.1,PLACE,"INSTS","B",I)) Q:I=""  S J=J_I_PARAM
"RTN","MAGQE5",197,0)
 Q J
"RTN","MAGQE5",198,0)
 ;
"RTN","MAGQST")
1^17^B0
"RTN","MAGUSIT")
0^18^B17597745
"RTN","MAGUSIT",1,0)
MAGUSIT ;WOIFO/SRR/RMP - IMAGE SITE PARAMETERS COMPANION [ 06/29/2001 18:28 ]
"RTN","MAGUSIT",2,0)
 ;;3.0;IMAGING;**3,8,20**;Apr 12, 2006
"RTN","MAGUSIT",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGUSIT",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGUSIT",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGUSIT",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGUSIT",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGUSIT",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGUSIT",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGUSIT",10,0)
 ;; |                                                               |
"RTN","MAGUSIT",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGUSIT",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGUSIT",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGUSIT",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGUSIT",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGUSIT",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGUSIT",17,0)
 ;;
"RTN","MAGUSIT",18,0)
INI ;
"RTN","MAGUSIT",19,0)
 N NAME,D0,MAGDA,CNMSP,PLACE
"RTN","MAGUSIT",20,0)
 S PLACE=$$PLACE^MAGBAPI(+$G(DUZ(2)))
"RTN","MAGUSIT",21,0)
 I $D(^MAG(2006.1,PLACE,0)),$L($P(^(0),U,2))=3 Q
"RTN","MAGUSIT",22,0)
 S NAME=$$KSP^XUPARAM("WHERE")
"RTN","MAGUSIT",23,0)
 I NAME[".MED" S NAME=$P(NAME,".MED",1)_$P(NAME,".MED",2)
"RTN","MAGUSIT",24,0)
 S MAGDA=$O(^MAG(2006.19,"B",NAME,""))
"RTN","MAGUSIT",25,0)
 S FN=$S('MAGDA:$$UNDEF(NAME),1:$P($G(^MAG(2006.19,MAGDA,0)),U,4))
"RTN","MAGUSIT",26,0)
 I FN="" D LNOIS Q
"RTN","MAGUSIT",27,0)
 D PNMSP(PLACE,FN)
"RTN","MAGUSIT",28,0)
 Q
"RTN","MAGUSIT",29,0)
PNMSP(PLACE,FN) ;
"RTN","MAGUSIT",30,0)
 S CNMSP=$P(^MAG(2006.1,PLACE,0),U,2)
"RTN","MAGUSIT",31,0)
 I $L(CNMSP)>0 D  ;UPDATE MULTI NAMESPACE
"RTN","MAGUSIT",32,0)
 . K DIE,DINUM,FDA,DIERR
"RTN","MAGUSIT",33,0)
 . S FDA(2006.11,"+1,"_PLACE_",",.01)=CNMSP
"RTN","MAGUSIT",34,0)
 . D UPDATE^DIE("U","FDA")
"RTN","MAGUSIT",35,0)
 . K FDA Q
"RTN","MAGUSIT",36,0)
 I $D(DIERR) D LNOIS Q
"RTN","MAGUSIT",37,0)
 D BMES^XPDUTL("Imaging SITE is: "_NAME_" Namespace: "_FN)
"RTN","MAGUSIT",38,0)
 K FDA,DIE,DINUM,DIERR
"RTN","MAGUSIT",39,0)
 S FDA(2006.1,PLACE_",",.02)=FN
"RTN","MAGUSIT",40,0)
 D UPDATE^DIE("U","FDA")
"RTN","MAGUSIT",41,0)
 K FDA
"RTN","MAGUSIT",42,0)
 I $D(DIERR) D LNOIS
"RTN","MAGUSIT",43,0)
 Q
"RTN","MAGUSIT",44,0)
LNOIS ;
"RTN","MAGUSIT",45,0)
 D BMES^XPDUTL(" Contact the National Help desk to update a namespace!") Q
"RTN","MAGUSIT",46,0)
UNDEF(NAME) ;The domain is undefined in the Image site file (2006.19)
"RTN","MAGUSIT",47,0)
 N ASK,Y,FN
"RTN","MAGUSIT",48,0)
 S DIR("A")="Enter the type of account"
"RTN","MAGUSIT",49,0)
 S DIR("?")="Enter either T for a test account or P for a production account",DIR("B")="T"
"RTN","MAGUSIT",50,0)
 S DIR(0)="S0^T:Test;P:PRODUCTION"
"RTN","MAGUSIT",51,0)
 D ^DIR S ASK=Y
"RTN","MAGUSIT",52,0)
 K DIR
"RTN","MAGUSIT",53,0)
 I ASK="T" S FN="ZZT"
"RTN","MAGUSIT",54,0)
 I ASK="P" D
"RTN","MAGUSIT",55,0)
 . S FN=$$ONE^MAGQAI(NAME)
"RTN","MAGUSIT",56,0)
 . D UI(NAME,FN) ;MAIL MESSAGE TO LAVC-SERVER/IMAGE DEVELOPERS
"RTN","MAGUSIT",57,0)
 Q FN
"RTN","MAGUSIT",58,0)
EXIT ;EXIT
"RTN","MAGUSIT",59,0)
 K DIC,DIE,DA,DR,MAM,NET,WORK
"RTN","MAGUSIT",60,0)
 Q
"RTN","MAGUSIT",61,0)
UI(DOMAIN,INIT) ;UPDATE IMAGING DISTRIBUTION
"RTN","MAGUSIT",62,0)
 N Y,LOC
"RTN","MAGUSIT",63,0)
 D NOW^%DTC S Y=% D DD^%DT
"RTN","MAGUSIT",64,0)
 S LOC=$$KSP^XUPARAM("WHERE")
"RTN","MAGUSIT",65,0)
 S ^TMP($J,"MAGQ",1)="            SITE: "_LOC
"RTN","MAGUSIT",66,0)
 S ^TMP($J,"MAGQ",2)="            DATE: "_Y_" "_$G(^XMB("TIMEZONE"))
"RTN","MAGUSIT",67,0)
 S ^TMP($J,"MAGQ",3)="          DOMAIN: "_DOMAIN
"RTN","MAGUSIT",68,0)
 S ^TMP($J,"MAGQ",4)="        INITIALS: "_INIT
"RTN","MAGUSIT",69,0)
 D MAILIT
"RTN","MAGUSIT",70,0)
 K ^TMP($J,"MAGQ")
"RTN","MAGUSIT",71,0)
 Q
"RTN","MAGUSIT",72,0)
MAILIT ;Send the report to the Clinical Application Time
"RTN","MAGUSIT",73,0)
 N XMSUB
"RTN","MAGUSIT",74,0)
 S XMSUB="Update Site file from "_LOC
"RTN","MAGUSIT",75,0)
MAILSHR ;Shared Mail server code
"RTN","MAGUSIT",76,0)
 ;If droping in...must manage XMSUB
"RTN","MAGUSIT",77,0)
 N XMY,XMTEXT,D,D0,D1,D2,DG,DIC,DICR,DIW,INDX
"RTN","MAGUSIT",78,0)
 S XMTEXT="^TMP($J,""MAGQ"")"
"RTN","MAGUSIT",79,0)
 I $G(DUZ) S XMY(DUZ)="",XMDUZ=DUZ
"RTN","MAGUSIT",80,0)
 E  S XMY(.5)="",XMDUZ=.5
"RTN","MAGUSIT",81,0)
 S XMY("G.MAG SERVER")=""
"RTN","MAGUSIT",82,0)
 S:$G(MAGDUZ) XMY(MAGDUZ)=""
"RTN","MAGUSIT",83,0)
 S XMSUBJ=XMSUB
"RTN","MAGUSIT",84,0)
 S XMBODY=XMTEXT
"RTN","MAGUSIT",85,0)
 S INDX=""
"RTN","MAGUSIT",86,0)
 F  S INDX=$O(XMY(INDX)) Q:INDX=""  S XMTO(INDX)=""
"RTN","MAGUSIT",87,0)
 D SENDMSG^XMXAPI(XMDUZ,XMSUBJ,XMBODY,.XMTO,,.XMZ,)
"RTN","MAGUSIT",88,0)
 K XMBODY,XMSUBJ,XMTO,XMZ
"RTN","MAGUSIT",89,0)
 Q
"RTN","MAGUSIT",90,0)
ISN(RESULT,FILENAME,NETSIZE,JBSIZE) ; Image File Size variance Notice
"RTN","MAGUSIT",91,0)
 N Y,LOC,XMSUB,DIS,CAP,CNT,I,VR,DM,INST
"RTN","MAGUSIT",92,0)
 K ^TMP($J,"MAGQ")
"RTN","MAGUSIT",93,0)
 D NOW^%DTC S Y=% D DD^%DT
"RTN","MAGUSIT",94,0)
 S INST=$S($$CONSOLID^MAGBAPI():$$GET1^DIQ(2006.1,$$PLACE^MAGBAPI(+$G(DUZ(2))),.01),1:$$KSP^XUPARAM("INST"))
"RTN","MAGUSIT",95,0)
 S XMSUB="Image File Size Variance: "_$$GET1^DIQ(4,INST,.01)
"RTN","MAGUSIT",96,0)
 S ^TMP($J,"MAGQ",1)="            SITE: "_$$GET1^DIQ(4,INST,.01)_"^"_INST
"RTN","MAGUSIT",97,0)
 S ^TMP($J,"MAGQ",2)="            DATE: "_Y_" "_$G(^XMB("TIMEZONE"))
"RTN","MAGUSIT",98,0)
 S ^TMP($J,"MAGQ",3)="          DOMAIN: "_$$KSP^XUPARAM("WHERE")
"RTN","MAGUSIT",99,0)
 S ^TMP($J,"MAGQ",4)="        Filename: "_FILENAME
"RTN","MAGUSIT",100,0)
 S ^TMP($J,"MAGQ",5)="Vista Cache Size: "_NETSIZE
"RTN","MAGUSIT",101,0)
 S ^TMP($J,"MAGQ",6)="    Jukebox Size: "_JBSIZE
"RTN","MAGUSIT",102,0)
 D MAILSHR
"RTN","MAGUSIT",103,0)
 S RESULT="1"
"RTN","MAGUSIT",104,0)
 K ^TMP($J,"MAGQ")
"RTN","MAGUSIT",105,0)
 Q
"RTN","MAGUSIT",106,0)
 ;
"SEC","^DIC",2006.03,2006.03,0,"AUDIT")

"SEC","^DIC",2006.03,2006.03,0,"DD")
@
"SEC","^DIC",2006.03,2006.03,0,"DEL")
@
"SEC","^DIC",2006.03,2006.03,0,"LAYGO")
@
"SEC","^DIC",2006.03,2006.03,0,"RD")
@
"SEC","^DIC",2006.03,2006.03,0,"WR")
@
"SEC","^DIC",2006.031,2006.031,0,"AUDIT")

"SEC","^DIC",2006.031,2006.031,0,"DD")
@
"SEC","^DIC",2006.031,2006.031,0,"DEL")
@
"SEC","^DIC",2006.031,2006.031,0,"LAYGO")
@
"SEC","^DIC",2006.031,2006.031,0,"RD")
@
"SEC","^DIC",2006.031,2006.031,0,"WR")
@
"SEC","^DIC",2006.032,2006.032,0,"AUDIT")

"SEC","^DIC",2006.032,2006.032,0,"DD")
@
"SEC","^DIC",2006.032,2006.032,0,"DEL")
@
"SEC","^DIC",2006.032,2006.032,0,"LAYGO")
@
"SEC","^DIC",2006.032,2006.032,0,"RD")
@
"SEC","^DIC",2006.032,2006.032,0,"WR")
@
"SEC","^DIC",2006.1,2006.1,0,"DD")
@
"SEC","^DIC",2006.1,2006.1,0,"DEL")
@
"SEC","^DIC",2006.1,2006.1,0,"LAYGO")
@
"SEC","^DIC",2006.1,2006.1,0,"RD")
@
"SEC","^DIC",2006.1,2006.1,0,"WR")
@
"SEC","^DIC",2006.8,2006.8,0,"AUDIT")

"SEC","^DIC",2006.8,2006.8,0,"DD")
@
"SEC","^DIC",2006.8,2006.8,0,"DEL")
@
"SEC","^DIC",2006.8,2006.8,0,"LAYGO")
@
"SEC","^DIC",2006.8,2006.8,0,"RD")
@
"SEC","^DIC",2006.8,2006.8,0,"WR")
@
"UP",2005,2005.04,-1)
2005^1
"UP",2005,2005.04,0)
2005.04
"UP",2005.1,2005.14,-1)
2005.1^1
"UP",2005.1,2005.14,0)
2005.14
"VER")
8.0^22.0
"^DD",2005,2005,1,0)
FILEREF^F^^0;2^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>30!($L(X)<1) X
"^DD",2005,2005,1,1,0)
^.1^^0
"^DD",2005,2005,1,3)
Answer must be 1-30 characters in length.
"^DD",2005,2005,1,21,0)
^^8^8^3050412^
"^DD",2005,2005,1,21,1,0)
This field contains the unique image filename of the image stored on the 
"^DD",2005,2005,1,21,2,0)
Vista Imaging file servers.  It is either 12 or 18 characters long.  It 
"^DD",2005,2005,1,21,3,0)
contains three elements: the facility's Imaging Namespace, from the 
"^DD",2005,2005,1,21,4,0)
Current Namespace field (#.02) of the IMAGING SITE PARAMETERS file 
"^DD",2005,2005,1,21,5,0)
(#2006.1), the Image IEN, and padded with zeros if needed, and the 
"^DD",2005,2005,1,21,6,0)
extension that indicates the format of the image. Supported formats are 
"^DD",2005,2005,1,21,7,0)
stored in the IMAGE FILE TYPES (#2005.021) file.  This field is 
"^DD",2005,2005,1,21,8,0)
automatically set by the Imaging software.
"^DD",2005,2005,1,"DT")
3050412
"^DD",2005,2005,4,0)
OBJECT GROUP^2005.04P^^1;0
"^DD",2005,2005,4,21,0)
^^14^14^3000404^^
"^DD",2005,2005,4,21,1,0)
The object group is a multiple field pointing back to the Image file
"^DD",2005,2005,4,21,2,0)
(2005).  Only objects with an object type of GROUP have the Object Group
"^DD",2005,2005,4,21,3,0)
field defined.  These objects can be thought of as the "parent" of a set
"^DD",2005,2005,4,21,4,0)
of images.  Generally, instead of having their own abstract, objects of
"^DD",2005,2005,4,21,5,0)
the GROUP type use the abstract of the first entry in their object group
"^DD",2005,2005,4,21,6,0)
multiple.  Sometimes, text will be used in place of the GROUP abstract for
"^DD",2005,2005,4,21,7,0)
speed.  Methods for viewing a GROUP object generally allow viewing of all
"^DD",2005,2005,4,21,8,0)
the members of the group, either selectively or altogether.  A good
"^DD",2005,2005,4,21,9,0)
example would be a set of thirty CT scan images.  Using the Integrated
"^DD",2005,2005,4,21,10,0)
View menu option, the tiled display of image abstracts would contain only
"^DD",2005,2005,4,21,11,0)
one abstract for the group.  Selecting the group object for viewing
"^DD",2005,2005,4,21,12,0)
provides the user with a tiled display of the abstracts of the individual
"^DD",2005,2005,4,21,13,0)
CT scan images.  The user can then identify individual images for full
"^DD",2005,2005,4,21,14,0)
resolution viewing.
"^DD",2005,2005,13.5,0)
DUPE^S^1:YES;^0;12^Q
"^DD",2005,2005,13.5,21,0)
^.001^6^6^3050620^^
"^DD",2005,2005,13.5,21,1,0)
This field is to allow screening of images that
"^DD",2005,2005,13.5,21,2,0)
have duplicate instances in the archive file
"^DD",2005,2005,13.5,21,3,0)
and the image file.  The intent is to prevent
"^DD",2005,2005,13.5,21,4,0)
purging of these images on the raid until a
"^DD",2005,2005,13.5,21,5,0)
utility to store this file on the Jukebox is 
"^DD",2005,2005,13.5,21,6,0)
implemented.
"^DD",2005,2005,13.5,"DT")
3050620
"^DD",2005,2005.04,0)
OBJECT GROUP SUB-FIELD^^2^3
"^DD",2005,2005.04,0,"NM","OBJECT GROUP")

"^DD",2005,2005.04,.01,0)
OBJECT GROUP^MP2005'^MAG(2005,^0;1^Q
"^DD",2005,2005.04,.01,1,0)
^.1^^0
"^DD",2005,2005.04,.01,"DT")
2940519
"^DD",2005,2005.04,1,0)
DICOM SERIES NUM^NJ8,0^^0;2^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2005,2005.04,1,1,0)
^.1
"^DD",2005,2005.04,1,1,1,0)
2005.04^ADCM^MUMPS
"^DD",2005,2005.04,1,1,1,1)
D SETDCM^MAGUXRF
"^DD",2005,2005.04,1,1,1,2)
D KILLDSN^MAGUXRF
"^DD",2005,2005.04,1,1,1,"%D",0)
^^8^8^3001023^^
"^DD",2005,2005.04,1,1,1,"%D",1,0)
This cross-reference stores the "ADCM" index.
"^DD",2005,2005.04,1,1,1,"%D",2,0)
It is stored for the multiple in
"^DD",2005,2005.04,1,1,1,"%D",3,0)

"^DD",2005,2005.04,1,1,1,"%D",4,0)
 ^MAG(2005, DA(1), 1 ,"ADCM", DICOM SERIES, DICOM IMAGE, IMAGE IEN, DA)=""
"^DD",2005,2005.04,1,1,1,"%D",5,0)

"^DD",2005,2005.04,1,1,1,"%D",6,0)
This cross-reference keeps track of which images belong to
"^DD",2005,2005.04,1,1,1,"%D",7,0)
which group, and indicates in which sequence the images
"^DD",2005,2005.04,1,1,1,"%D",8,0)
are intended to appear.
"^DD",2005,2005.04,1,1,1,"DT")
2981118
"^DD",2005,2005.04,1,3)
This is the Dicom 'Series Number'
"^DD",2005,2005.04,1,"DT")
2981118
"^DD",2005,2005.04,2,0)
DICOM IMAGE NUM^NJ5,0^^0;3^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2005,2005.04,2,1,0)
^.1
"^DD",2005,2005.04,2,1,1,0)
2005.04^ADCM2^MUMPS
"^DD",2005,2005.04,2,1,1,1)
D SETDCM^MAGUXRF
"^DD",2005,2005.04,2,1,1,2)
D KILLDIN^MAGUXRF
"^DD",2005,2005.04,2,1,1,"%D",0)
^^8^8^3001023^^
"^DD",2005,2005.04,2,1,1,"%D",1,0)
This cross-reference stores the "ADCM" index.
"^DD",2005,2005.04,2,1,1,"%D",2,0)
It is stored for the multiple in
"^DD",2005,2005.04,2,1,1,"%D",3,0)

"^DD",2005,2005.04,2,1,1,"%D",4,0)
 ^MAG(2005, DA(1), 1 ,"ADCM", DICOM SERIES, DICOM IMAGE, IMAGE IEN, DA)=""
"^DD",2005,2005.04,2,1,1,"%D",5,0)

"^DD",2005,2005.04,2,1,1,"%D",6,0)
This cross-reference keeps track of which images belong to
"^DD",2005,2005.04,2,1,1,"%D",7,0)
which group, and indicates in which sequence the images
"^DD",2005,2005.04,2,1,1,"%D",8,0)
are intended to appear.
"^DD",2005,2005.04,2,1,1,"DT")
2981118
"^DD",2005,2005.04,2,3)
This is the Dicom 'Image Number'
"^DD",2005,2005.04,2,"DT")
2981118
"^DD",2005.1,2005.1,1,0)
FILEREF^F^^0;2^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>30!($L(X)<1) X
"^DD",2005.1,2005.1,1,1,0)
^.1
"^DD",2005.1,2005.1,1,1,1,0)
2005.1^E
"^DD",2005.1,2005.1,1,1,1,1)
S ^MAG(2005.1,"E",$E(X,1,30),DA)=""
"^DD",2005.1,2005.1,1,1,1,2)
K ^MAG(2005.1,"E",$E(X,1,30),DA)
"^DD",2005.1,2005.1,1,1,1,3)
DOS IMAGE file cross-reference.
"^DD",2005.1,2005.1,1,1,1,"%D",0)
^.101^4^4^3001025^^^
"^DD",2005.1,2005.1,1,1,1,"%D",1,0)
This cross-reference produces a list of unique entries as the DOS file
"^DD",2005.1,2005.1,1,1,1,"%D",2,0)
reference associated with each image/object is by definition unique.
"^DD",2005.1,2005.1,1,1,1,"%D",3,0)
This cross-reference is used by Multimedia mail to see whether an image
"^DD",2005.1,2005.1,1,1,1,"%D",4,0)
already is in the image file.
"^DD",2005.1,2005.1,1,1,1,"DT")
2930909
"^DD",2005.1,2005.1,1,3)
Answer must be 1-30 characters in length.
"^DD",2005.1,2005.1,1,21,0)
^^6^6^2940523^
"^DD",2005.1,2005.1,1,21,1,0)
This field contains the unique image filename of the image stored on the magnetic server (and the jukebox if you have one). It is always eight characters in length, starting with the facility's 2 character Imaging
"^DD",2005.1,2005.1,1,21,2,0)
namespace, with the remaining six characters ranging from 000001 to
"^DD",2005.1,2005.1,1,21,3,0)
999999.  The extensions indicate what type of image it is: .BW for Black
"^DD",2005.1,2005.1,1,21,4,0)
and White medium resolution (Cath, Path), .TGA for X-ray, .756 for 16-bit
"^DD",2005.1,2005.1,1,21,5,0)
namespace, with the remaining six characters ranging from 000001 to
"^DD",2005.1,2005.1,1,21,6,0)
set by the Imaging software.
"^DD",2005.1,2005.1,1,"DT")
3041221
"^DD",2005.1,2005.1,4,0)
OBJECT GROUP^2005.14P^^1;0
"^DD",2005.1,2005.1,4,21,0)
^.001^14^14^3001025^^^^
"^DD",2005.1,2005.1,4,21,1,0)
The object group is a multiple field pointing back to the Image file
"^DD",2005.1,2005.1,4,21,2,0)
(2005.1).  Only objects with an object type of GROUP have the object group
"^DD",2005.1,2005.1,4,21,3,0)
field defined.  These objects can be thought of as the 'parent' of a set
"^DD",2005.1,2005.1,4,21,4,0)
of images.  Generally, instead of having their own abstract, objects of
"^DD",2005.1,2005.1,4,21,5,0)
the GROUP type use the abstract of the first entry in their object group
"^DD",2005.1,2005.1,4,21,6,0)
multiple.  Sometimes, text will be used in place of the GROUP abstract for
"^DD",2005.1,2005.1,4,21,7,0)
speed.  Methods for viewing a GROUP object generally allow viewing of all
"^DD",2005.1,2005.1,4,21,8,0)
the members of the group, either selectively or altogether.  A good
"^DD",2005.1,2005.1,4,21,9,0)
example would be a set of thirty CT scan images.  Using the integrated
"^DD",2005.1,2005.1,4,21,10,0)
view menu option, the tiled display of image abstracts would contain only
"^DD",2005.1,2005.1,4,21,11,0)
one abstract for the group.  Selecting the group object for viewing
"^DD",2005.1,2005.1,4,21,12,0)
provides the user with a tiled display of the abstracts of the individual
"^DD",2005.1,2005.1,4,21,13,0)
CT scan images.  The user can then identify individual images for full
"^DD",2005.1,2005.1,4,21,14,0)
resolution viewing.
"^DD",2005.1,2005.1,13.5,0)
DUPE^S^1:YES;^0;12^Q
"^DD",2005.1,2005.1,13.5,21,0)
^^6^6^3050620^
"^DD",2005.1,2005.1,13.5,21,1,0)
This field is to allow screening of images that
"^DD",2005.1,2005.1,13.5,21,2,0)
have duplicate instances in the archive file
"^DD",2005.1,2005.1,13.5,21,3,0)
and the image file.  The intent is to prevent
"^DD",2005.1,2005.1,13.5,21,4,0)
purging of these images on the raid until a
"^DD",2005.1,2005.1,13.5,21,5,0)
utility to store this file on the Jukebox is 
"^DD",2005.1,2005.1,13.5,21,6,0)
implemented.
"^DD",2005.1,2005.1,13.5,"DT")
3050620
"^DD",2005.1,2005.14,0)
OBJECT GROUP SUB-FIELD^^2^3
"^DD",2005.1,2005.14,0,"NM","OBJECT GROUP")

"^DD",2005.1,2005.14,.01,0)
OBJECT GROUP^MP2005.1'^MAG(2005.1,^0;1^Q
"^DD",2005.1,2005.14,.01,1,0)
^.1^^0
"^DD",2005.1,2005.14,.01,21,0)
^^14^14^3001025^
"^DD",2005.1,2005.14,.01,21,1,0)
The object group is a multiple field pointing back to the Image file
"^DD",2005.1,2005.14,.01,21,2,0)
(2005.1).  Only objects with an object type of GROUP have the object group
"^DD",2005.1,2005.14,.01,21,3,0)
field defined.  These objects can be thought of as the 'parent' of a set
"^DD",2005.1,2005.14,.01,21,4,0)
of images.  Generally, instead of having their own abstract, objects of
"^DD",2005.1,2005.14,.01,21,5,0)
the GROUP type use the abstract of the first entry in their object group
"^DD",2005.1,2005.14,.01,21,6,0)
multiple.  Sometimes, text will be used in place of the GROUP abstract for
"^DD",2005.1,2005.14,.01,21,7,0)
speed.  Methods for viewing a GROUP object generally allow viewing of all
"^DD",2005.1,2005.14,.01,21,8,0)
the members of the group, either selectively or altogether.  A good
"^DD",2005.1,2005.14,.01,21,9,0)
example would be a set of thirty CT scan images.  Using the integrated
"^DD",2005.1,2005.14,.01,21,10,0)
view menu option, the tiled display of image abstracts would contain only
"^DD",2005.1,2005.14,.01,21,11,0)
one abstract for the group.  Selecting the group object for viewing
"^DD",2005.1,2005.14,.01,21,12,0)
provides the user with a tiled display of the abstracts of the individual
"^DD",2005.1,2005.14,.01,21,13,0)
CT scan images.  The user can then identify individual images for full
"^DD",2005.1,2005.14,.01,21,14,0)
resolution viewing.
"^DD",2005.1,2005.14,.01,"DT")
2940519
"^DD",2005.1,2005.14,1,0)
DICOM SERIES NUM^NJ5,0^^0;2^K:+X'=X!(X>99999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2005.1,2005.14,1,3)
This is the Dicom 'Series Number'
"^DD",2005.1,2005.14,1,"DT")
2981118
"^DD",2005.1,2005.14,2,0)
DICOM IMAGE NUM^NJ5,0^^0;3^K:+X'=X!(X>99999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2005.1,2005.14,2,3)
This is the Dicom 'Image Number'
"^DD",2005.1,2005.14,2,"DT")
2981118
"^DD",2005.2,2005.2,.04,0)
PLACE^RP2006.1'^MAG(2006.1,^0;10^Q
"^DD",2005.2,2005.2,.04,1,0)
^.1^^0
"^DD",2005.2,2005.2,.04,21,0)
^^3^3^3050414^
"^DD",2005.2,2005.2,.04,21,1,0)
This field references the site parameter file. The Site parameter entry 
"^DD",2005.2,2005.2,.04,21,2,0)
defines all of the attributes of Vista Imaging local area network. This 
"^DD",2005.2,2005.2,.04,21,3,0)
includes facility user preferences, network write locations, etc.
"^DD",2005.2,2005.2,.04,"DT")
3050414
"^DD",2005.2,2005.2,1,0)
PHYSICAL REFERENCE^RFX^^0;2^K:$L(X)>120!($L(X)<1)!'((X?1"\\".E1"\".E1"\")!(X?1A1":\"1E.E1"\")!($P($$UPPER^MAGQE4(X),"//")["HTTP")) X
"^DD",2005.2,2005.2,1,1,0)
^.1^^-1
"^DD",2005.2,2005.2,1,1,1,0)
2005.2^AC
"^DD",2005.2,2005.2,1,1,1,1)
S ^MAG(2005.2,"AC",X,DA)=""
"^DD",2005.2,2005.2,1,1,1,2)
K ^MAG(2005.2,"AC",X,DA)
"^DD",2005.2,2005.2,1,1,1,"%D",0)
^.101^2^2^3030220^^^^
"^DD",2005.2,2005.2,1,1,1,"%D",1,0)
This cross-reference allows a network location to be looked up
"^DD",2005.2,2005.2,1,1,1,"%D",2,0)
by physical name.
"^DD",2005.2,2005.2,1,1,1,"DT")
2951017
"^DD",2005.2,2005.2,1,3)
Enter the name of the physical location for this device. Answer must be 1-120 character in length.
"^DD",2005.2,2005.2,1,21,0)
^.001^3^3^3030226^^^^
"^DD",2005.2,2005.2,1,21,1,0)
This is the physical network location where the image is stored. This is
"^DD",2005.2,2005.2,1,21,2,0)
the Universal Naming Convention (UNC)PATH for the Image Storage. For
"^DD",2005.2,2005.2,1,21,3,0)
example: \\SERVER01\IMAGE1\
"^DD",2005.2,2005.2,1,"DT")
3050707
"^DD",2005.2,2005.2,2,0)
TOTAL SPACE^NJ7,0^^0;3^K:+X'=X!(X>9999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2005.2,2005.2,2,3)
Type a Number between 0 and 9999999, 0 Decimal Digits
"^DD",2005.2,2005.2,2,21,0)
^^1^1^2970721^^^
"^DD",2005.2,2005.2,2,21,1,0)
This is the total available formatted space of this network location (Device dependent).
"^DD",2005.2,2005.2,2,"DT")
2940609
"^DD",2005.2,2005.2,3,0)
SPACE USED^NJ7,0^^0;4^K:+X'=X!(X>9999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2005.2,2005.2,3,3)
Type a Number between 0 and 9999999, 0 Decimal Digits
"^DD",2005.2,2005.2,3,21,0)
^^2^2^2990301^^^^
"^DD",2005.2,2005.2,3,21,1,0)
This is the amount of space which has been used for this network location
"^DD",2005.2,2005.2,3,21,2,0)
- this value is device dependent.
"^DD",2005.2,2005.2,3,"DT")
2940505
"^DD",2005.2,2005.2,4,0)
FREE SPACE^NJ7,0^^0;5^K:+X'=X!(X>9999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2005.2,2005.2,4,3)
Type a Number between 0 and 9999999, 0 Decimal Digits
"^DD",2005.2,2005.2,4,21,0)
^^2^2^2990301^^^
"^DD",2005.2,2005.2,4,21,1,0)
This is the amount of available space remaining for this network location.
"^DD",2005.2,2005.2,4,21,2,0)
This value is device dependent.
"^DD",2005.2,2005.2,4,"DT")
2940505
"^DD",2005.2,2005.2,6,0)
STORAGE TYPE^RS^MAG:MAGNETIC;WORM-DG:WORM-DG;WORM-PDT:WORM-PDT;RW:READ/WRITE;WORM-OTG:WORM-OTG;EKG:MUSE-EKG;GCC:EXPORT;DGM:DIAGRAM;URL:URL;^0;7^Q
"^DD",2005.2,2005.2,6,1,0)
^.1
"^DD",2005.2,2005.2,6,1,1,0)
2005.2^E
"^DD",2005.2,2005.2,6,1,1,1)
S ^MAG(2005.2,"E",$E(X,1,30),DA)=""
"^DD",2005.2,2005.2,6,1,1,2)
K ^MAG(2005.2,"E",$E(X,1,30),DA)
"^DD",2005.2,2005.2,6,1,1,"%D",0)
^.101^1^1^3030813^^
"^DD",2005.2,2005.2,6,1,1,"%D",1,0)
Storage Type cross reference
"^DD",2005.2,2005.2,6,1,1,"DT")
3000131
"^DD",2005.2,2005.2,6,3)
Enter the type of storage this network location is i.e.
"^DD",2005.2,2005.2,6,21,0)
^.001^8^8^3050707^^^^
"^DD",2005.2,2005.2,6,21,1,0)
This field describes the media type of this network location. It should be
"^DD",2005.2,2005.2,6,21,2,0)
MAGNETIC for a magnetic disk server. Jukeboxes should be WORM-DG for Data
"^DD",2005.2,2005.2,6,21,3,0)
General Jukeboxes under Open Netware or WORM-PDT for Pegasus Jukeboxes or
"^DD",2005.2,2005.2,6,21,4,0)
WORM-OTG for OTG Disk Extender. WORM-DG and WORM-PDT are for backward
"^DD",2005.2,2005.2,6,21,5,0)
compatibility only.  Note: WORM stands for Write Once, Read Many
"^DD",2005.2,2005.2,6,21,6,0)
The GCC type refers to the Generic Carbon Copy (GCC) utility implemented
"^DD",2005.2,2005.2,6,21,7,0)
by the Health Eligibility Center application.
"^DD",2005.2,2005.2,6,21,8,0)
URL is used for Web based file access.
"^DD",2005.2,2005.2,6,"DT")
3050707
"^DD",2005.2,2005.2,14,0)
COMPRESSION^S^NONE:None;J2K:JPEG-2000;^1;7^Q
"^DD",2005.2,2005.2,14,.1)
Type of data compression
"^DD",2005.2,2005.2,14,3)
Enter a code for the type of compression (NONE means no compression).
"^DD",2005.2,2005.2,14,21,0)
^.001^2^2^3040903^^^
"^DD",2005.2,2005.2,14,21,1,0)
The value of this field is a code that indicate which type of compression,
"^DD",2005.2,2005.2,14,21,2,0)
if any, is to be used while transmitting files to this network location.
"^DD",2005.2,2005.2,14,"DT")
3040903
"^DD",2005.2,2005.2,26,0)
ROUTER^SOX^0:NO;1:YES;^0;9^Q:DA="+1"  S:$P(^MAG(2005.2,DA,0),U,9)="" $P(^MAG(2005.2,DA,0),U,9)="0"
"^DD",2005.2,2005.2,26,2)
S Y(0)=Y S:Y="" Y="0"
"^DD",2005.2,2005.2,26,2.1)
S:Y="" Y="0"
"^DD",2005.2,2005.2,26,21,0)
^.001^4^4^3050119^^^
"^DD",2005.2,2005.2,26,21,1,0)
This boolean value is used to designate certain network location shares
"^DD",2005.2,2005.2,26,21,2,0)
as routing shares.  This is necessary to allow clinical WS applications
"^DD",2005.2,2005.2,26,21,3,0)
access to images on these shares but to prevent the background processor
"^DD",2005.2,2005.2,26,21,4,0)
from designating this share as the current write location.
"^DD",2005.2,2005.2,26,"DT")
3050119
"^DD",2006.03,2006.03,0)
FIELD^^10^13
"^DD",2006.03,2006.03,0,"DDA")
N
"^DD",2006.03,2006.03,0,"DT")
3001213
"^DD",2006.03,2006.03,0,"ID",.001)
W "   ",Y
"^DD",2006.03,2006.03,0,"ID",.04)
S %I=Y,Y=$S('$D(^(0)):"",$D(^MAG(2006.1,+$P(^(0),U,12),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(2006.1,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",2006.03,2006.03,0,"NM","IMAGE BACKGROUND QUEUE")

"^DD",2006.03,2006.03,0,"PT",2006.031,1)

"^DD",2006.03,2006.03,0,"PT",2006.034,.01)

"^DD",2006.03,2006.03,0,"VRPK")
MAG
"^DD",2006.03,2006.03,.001,0)
NUMBER^NJ8,0^^ ^K:+X'=X!(X>99999999)!(X<1)!(X?.E1"."1.N) X
"^DD",2006.03,2006.03,.001,3)
Type a number between 1 and 99999999, 0 Decimal Digits
"^DD",2006.03,2006.03,.001,21,0)
^^1^1^3001025^
"^DD",2006.03,2006.03,.001,21,1,0)
This is the internal entry number (IEN) of the QUEUE entry.
"^DD",2006.03,2006.03,.001,"DT")
3001025
"^DD",2006.03,2006.03,.01,0)
QUEUE NAME^F^^0;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>10!($L(X)<1) X
"^DD",2006.03,2006.03,.01,1,0)
^.1^^0
"^DD",2006.03,2006.03,.01,3)
Answer must be 1-10 characters in length.
"^DD",2006.03,2006.03,.01,21,0)
^^1^1^2970721^^^
"^DD",2006.03,2006.03,.01,21,1,0)
Name of the queue holding the entry.
"^DD",2006.03,2006.03,.01,"DT")
3050107
"^DD",2006.03,2006.03,.04,0)
PLACE^RP2006.1'^MAG(2006.1,^0;12^Q
"^DD",2006.03,2006.03,.04,1,0)
^.1^^0
"^DD",2006.03,2006.03,.04,21,0)
^^3^3^3050414^
"^DD",2006.03,2006.03,.04,21,1,0)
This field references the site parameter file. The Site parameter entry 
"^DD",2006.03,2006.03,.04,21,2,0)
defines all of the attributes of Vista Imaging local area network. This 
"^DD",2006.03,2006.03,.04,21,3,0)
includes facility user preferences, network write locations, etc.
"^DD",2006.03,2006.03,.04,"DT")
3050414
"^DD",2006.03,2006.03,1,0)
USER^P200'^VA(200,^0;2^Q
"^DD",2006.03,2006.03,1,21,0)
^^1^1^2970721^^^
"^DD",2006.03,2006.03,1,21,1,0)
Pointer to the user creating the entry in the queue.
"^DD",2006.03,2006.03,1,"DT")
2941220
"^DD",2006.03,2006.03,2,0)
SYSTEM VOLUME GROUP ID^F^^0;3^K:$L(X)>3!($L(X)<3) X
"^DD",2006.03,2006.03,2,3)
Answer must be 3 characters in length
"^DD",2006.03,2006.03,2,21,0)
^^1^1^2970721^^
"^DD",2006.03,2006.03,2,21,1,0)
The identification of the system used to create the entry in the queue.
"^DD",2006.03,2006.03,2,"DT")
3001213
"^DD",2006.03,2006.03,3,0)
REQUEST DATE & TIME^D^^0;4^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",2006.03,2006.03,3,21,0)
^^1^1^2970721^^
"^DD",2006.03,2006.03,3,21,1,0)
The date and time that the entry was placed into the queue.
"^DD",2006.03,2006.03,3,"DT")
2941220
"^DD",2006.03,2006.03,4,0)
COMPLETION STATUS^F^^0;5^K:$L(X)>60!($L(X)<1) X
"^DD",2006.03,2006.03,4,1,0)
^.1^^0
"^DD",2006.03,2006.03,4,3)
Answer must be 1-60 characters in length.
"^DD",2006.03,2006.03,4,21,0)
^^5^5^2970721^
"^DD",2006.03,2006.03,4,21,1,0)
The status of the handing of the request by the Background Processor. The
"^DD",2006.03,2006.03,4,21,2,0)
field is null until the entry is processed in the background. A positive
"^DD",2006.03,2006.03,4,21,3,0)
value indicates a successful completion of the request. A negative value
"^DD",2006.03,2006.03,4,21,4,0)
indicates a failure to complete the request. Explanatory text follows the
"^DD",2006.03,2006.03,4,21,5,0)
numeric status in this field
"^DD",2006.03,2006.03,4,"DT")
3041022
"^DD",2006.03,2006.03,5,0)
COMPLETION DATE & TIME^D^^0;6^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",2006.03,2006.03,5,21,0)
^^1^1^2950318^
"^DD",2006.03,2006.03,5,21,1,0)
The date and time that the background processor finished the request.
"^DD",2006.03,2006.03,5,"DT")
2941220
"^DD",2006.03,2006.03,6,0)
IMAGE POINTER^F^^0;7^K:$L(X)>20!($L(X)<1) X
"^DD",2006.03,2006.03,6,1,0)
^.1^^0
"^DD",2006.03,2006.03,6,3)
Answer must be 1-20 characters in length.
"^DD",2006.03,2006.03,6,21,0)
^.001^1^1^3000705^^
"^DD",2006.03,2006.03,6,21,1,0)
Pointer to file 2005.
"^DD",2006.03,2006.03,6,"DT")
3041102
"^DD",2006.03,2006.03,7,0)
QUEUE TYPE^F^^0;8^K:$L(X)>20!($L(X)<1) X
"^DD",2006.03,2006.03,7,1,0)
^.1^^0
"^DD",2006.03,2006.03,7,3)
Answer must be 1-20 characters in length.
"^DD",2006.03,2006.03,7,21,0)
^^1^1^2980323^
"^DD",2006.03,2006.03,7,21,1,0)
Type of Background or DICOM processor queued process.
"^DD",2006.03,2006.03,7,"DT")
3041109
"^DD",2006.03,2006.03,8,0)
QUEUED SEQUENCE NUMBER^F^^0;9^K:$L(X)>20!($L(X)<1) X
"^DD",2006.03,2006.03,8,3)
Answer must be 1-20 characters in length.
"^DD",2006.03,2006.03,8,21,0)
^^2^2^2980323^
"^DD",2006.03,2006.03,8,21,1,0)
If this field is blank then this queued process record represents is
"^DD",2006.03,2006.03,8,21,2,0)
in its initial instantiation.
"^DD",2006.03,2006.03,8,"DT")
2980323
"^DD",2006.03,2006.03,9,0)
FILEPATH^F^^0;10^K:$L(X)>20!($L(X)<1) X
"^DD",2006.03,2006.03,9,3)
Answer must be 1-20 characters in length.
"^DD",2006.03,2006.03,9,21,0)
^.001^1^1^3000707^^
"^DD",2006.03,2006.03,9,21,1,0)
Complete Filepath passed from the foreground to the Background Processor.
"^DD",2006.03,2006.03,9,"DT")
2980423
"^DD",2006.03,2006.03,10,0)
QUEUE DATA ITEM 5^F^^0;11^K:$L(X)>20!($L(X)<1) X
"^DD",2006.03,2006.03,10,3)
Answer must be 1-20 characters in length.
"^DD",2006.03,2006.03,10,21,0)
^^1^1^2970721^^
"^DD",2006.03,2006.03,10,21,1,0)
Fifth parameter passed from the foreground to the Background Processor.
"^DD",2006.03,2006.03,10,"DT")
2950321
"^DD",2006.031,2006.031,0)
FIELD^^3^5
"^DD",2006.031,2006.031,0,"DDA")
N
"^DD",2006.031,2006.031,0,"DT")
3050328
"^DD",2006.031,2006.031,0,"ID",.04)
S %I=Y,Y=$S('$D(^(0)):"",$D(^MAG(2006.1,+$P(^(0),U,4),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(2006.1,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",2006.031,2006.031,0,"NM","IMAGE BACKGROUND QUEUE POINTER")

"^DD",2006.031,2006.031,0,"VRPK")
MAG
"^DD",2006.031,2006.031,.01,0)
QUEUE NAME^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",2006.031,2006.031,.01,1,0)
^.1^^0
"^DD",2006.031,2006.031,.01,3)
Answer must be 3-30 characters in length.
"^DD",2006.031,2006.031,.01,21,0)
^^2^2^3001215^
"^DD",2006.031,2006.031,.01,21,1,0)
Name of the queue holding the entry. The entry is controlled by the
"^DD",2006.031,2006.031,.01,21,2,0)
Imaging interfaces and should not be entered directly by any user.
"^DD",2006.031,2006.031,.01,"DT")
3050107
"^DD",2006.031,2006.031,.04,0)
PLACE^RP2006.1'^MAG(2006.1,^0;4^Q
"^DD",2006.031,2006.031,.04,1,0)
^.1^^0
"^DD",2006.031,2006.031,.04,21,0)
^^3^3^3050414^
"^DD",2006.031,2006.031,.04,21,1,0)
This field references the site parameter file.  The Site parameter entry 
"^DD",2006.031,2006.031,.04,21,2,0)
defines all of the attributes of Vista Imaging local area network.  This 
"^DD",2006.031,2006.031,.04,21,3,0)
includes facility user preferences, network write locations, etc.
"^DD",2006.031,2006.031,.04,"DT")
3050414
"^DD",2006.031,2006.031,1,0)
QUEUE POINTER^P2006.03'^MAGQUEUE(2006.03,^0;2^Q
"^DD",2006.031,2006.031,1,21,0)
^^1^1^2950318^
"^DD",2006.031,2006.031,1,21,1,0)
Pointer to the entry in the queue.
"^DD",2006.031,2006.031,1,"DT")
2941220
"^DD",2006.031,2006.031,2,0)
QUEUE COUNT^NJ7,0^^0;3^K:+X'=X!(X>9999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.031,2006.031,2,3)
Type a Number between 0 and 9999999, 0 Decimal Digits
"^DD",2006.031,2006.031,2,21,0)
^^2^2^3050328^
"^DD",2006.031,2006.031,2,21,1,0)
This field provides a count of the queue entries that have yet to be 
"^DD",2006.031,2006.031,2,21,2,0)
processed in the Queue file (#2006.03) for each queue type.
"^DD",2006.031,2006.031,2,"DT")
3050328
"^DD",2006.031,2006.031,3,0)
QUEUE TYPE TOTAL^NJ8,0^^0;5^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."1.N) X
"^DD",2006.031,2006.031,3,3)
Type a number between 0 and 99999999, 0 Decimal Digits
"^DD",2006.031,2006.031,3,21,0)
^^5^5^3050414^
"^DD",2006.031,2006.031,3,21,1,0)
This value is the total number of queues in the queue partition of this 
"^DD",2006.031,2006.031,3,21,2,0)
type for this local area Vista Imaging network.  This value can be used 
"^DD",2006.031,2006.031,3,21,3,0)
in conjunction with the Queue Count field (#2) to determine the number of
"^DD",2006.031,2006.031,3,21,4,0)
queues in the failed queue partition.  i.e. Queue Type Total - Queue 
"^DD",2006.031,2006.031,3,21,5,0)
Count = failed queues (for this "PLACE" and this queue type)..
"^DD",2006.031,2006.031,3,"DT")
3050414
"^DD",2006.032,2006.032,0)
FIELD^^9^11
"^DD",2006.032,2006.032,0,"DDA")
N
"^DD",2006.032,2006.032,0,"DT")
3050418
"^DD",2006.032,2006.032,0,"ID",.04)
S %I=Y,Y=$S('$D(^(0)):"",$D(^MAG(2006.1,+$P(^(0),U,11),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(2006.1,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",2006.032,2006.032,0,"IX","B",2006.032,.01)

"^DD",2006.032,2006.032,0,"NM","JUKEBOX")

"^DD",2006.032,2006.032,0,"PT",2006.1,54)

"^DD",2006.032,2006.032,0,"VRPK")
MAG
"^DD",2006.032,2006.032,.01,0)
JUKEBOX NAME^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",2006.032,2006.032,.01,1,0)
^.1^^0
"^DD",2006.032,2006.032,.01,1,1,0)
2006.032^B
"^DD",2006.032,2006.032,.01,1,1,1)
S ^MAGQUEUE(2006.032,"B",$E(X,1,30),DA)=""
"^DD",2006.032,2006.032,.01,1,1,2)
K ^MAGQUEUE(2006.032,"B",$E(X,1,30),DA)
"^DD",2006.032,2006.032,.01,3)
Answer must be 3-30 characters in length.
"^DD",2006.032,2006.032,.01,21,0)
^^2^2^2970721^^
"^DD",2006.032,2006.032,.01,21,1,0)
This is the name for the jukebox.  It is typically the name of the
"^DD",2006.032,2006.032,.01,21,2,0)
manufacturer of the jukebox hardware and/or software.
"^DD",2006.032,2006.032,.01,"DT")
3010313
"^DD",2006.032,2006.032,.04,0)
PLACE^RP2006.1'^MAG(2006.1,^0;11^Q
"^DD",2006.032,2006.032,.04,1,0)
^.1^^0
"^DD",2006.032,2006.032,.04,21,0)
^^3^3^3050414^
"^DD",2006.032,2006.032,.04,21,1,0)
This field references the site parameter file. The Site parameter entry 
"^DD",2006.032,2006.032,.04,21,2,0)
defines all of the attributes of Vista Imaging local area network. This 
"^DD",2006.032,2006.032,.04,21,3,0)
includes facility user preferences, network write locations, etc.
"^DD",2006.032,2006.032,.04,"DT")
3050414
"^DD",2006.032,2006.032,1,0)
JUKEBOX DEVICE^RFX^^0;2^K:$L(X)>30!($L(X)<2)!'((X?1"\\".E1"\".E1"\")!(X?1A1":")) X
"^DD",2006.032,2006.032,1,3)
Answer must be 2-30 characters in length.  Type ?? for more detailed help.
"^DD",2006.032,2006.032,1,21,0)
^^2^2^3001025^
"^DD",2006.032,2006.032,1,21,1,0)
This is the Universal Naming Convention (UNC) name for your jukebox share
"^DD",2006.032,2006.032,1,21,2,0)
(e.g. \\server\netshare$\). Format required: \\servername\sharename\
"^DD",2006.032,2006.032,1,"DT")
3001025
"^DD",2006.032,2006.032,2,0)
CURRENT WRITE PLATTER^R*P2005.2'^MAG(2005.2,^0;3^S DIC("S")="I $P(^MAGQUEUE(2006.032,DA,0),U,11)=$P(^MAG(2005.2,Y,0),U,10)" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",2006.032,2006.032,2,12)
The Jukebox and the Network Location file entries must be associated with the same Vista Imaging network or 'PLACE".
"^DD",2006.032,2006.032,2,12.1)
S DIC("S")="I $P(^MAGQUEUE(2006.032,DA,0),U,11)=$P(^MAG(2005.2,Y,0),U,10)"
"^DD",2006.032,2006.032,2,21,0)
^^2^2^2970721^
"^DD",2006.032,2006.032,2,21,1,0)
New files are written to this platter of the jukebox. This field is a
"^DD",2006.032,2006.032,2,21,2,0)
pointer to the Network Location file (2005.2).
"^DD",2006.032,2006.032,2,"DT")
3050418
"^DD",2006.032,2006.032,3,0)
NUMBER OF CARTRIDGES^NJ4,0^^0;4^K:+X'=X!(X>1000)!(X<1)!(X?.E1"."1N.N) X
"^DD",2006.032,2006.032,3,3)
Type a Number between 1 and 1000, 0 Decimal Digits
"^DD",2006.032,2006.032,3,21,0)
^^2^2^2970721^^
"^DD",2006.032,2006.032,3,21,1,0)
This field contains the number of cartridges that have been entered into
"^DD",2006.032,2006.032,3,21,2,0)
the jukebox.  The field is not decremented when cartridges are removed.
"^DD",2006.032,2006.032,3,"DT")
2950318
"^DD",2006.032,2006.032,4,0)
PERCENT FREE SPACE^NJ4,1^^0;5^K:+X'=X!(X>10)!(X<2.5)!(X?.E1"."2N.N) X
"^DD",2006.032,2006.032,4,3)
Type a Number between 2.5 and 10, 1 Decimal Digit
"^DD",2006.032,2006.032,4,21,0)
^^3^3^2991116^^^^
"^DD",2006.032,2006.032,4,21,1,0)
The minimum free space specifies the percentage of the platter to
"^DD",2006.032,2006.032,4,21,2,0)
be kept empty.  For example, if it is 10, then 90% of the platter can
"^DD",2006.032,2006.032,4,21,3,0)
written to, before swapping to the next platter.
"^DD",2006.032,2006.032,4,"DT")
2991116
"^DD",2006.032,2006.032,5,0)
LAST TIMESTAMP FOR SIZE^D^^0;6^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",2006.032,2006.032,5,21,0)
^^3^3^2950318^
"^DD",2006.032,2006.032,5,21,1,0)
The Background Poster must periodically check the amount of free-space
"^DD",2006.032,2006.032,5,21,2,0)
on the current jukebox platter.  This field records the last time that
"^DD",2006.032,2006.032,5,21,3,0)
this check was performed.
"^DD",2006.032,2006.032,5,"DT")
2950318
"^DD",2006.032,2006.032,6,0)
JB VOLUME SIZE ROUTINE^FX^^0;7^K:($E(X,1,3)'="MAG") X
"^DD",2006.032,2006.032,6,3)
Answer must be a routine in the "MAG" namespace and located in the routine file.
"^DD",2006.032,2006.032,6,21,0)
^^2^2^2991112^^
"^DD",2006.032,2006.032,6,21,1,0)
The Background Poster will invoke this MUMPS routine to determine
"^DD",2006.032,2006.032,6,21,2,0)
how much space is used, and how much is still available.
"^DD",2006.032,2006.032,6,"DT")
2991112
"^DD",2006.032,2006.032,7,0)
*USE SUBDIRECTORIES^S^Y:Use Subdirectories;N:Don't Use Subdirectories;^0;8^Q
"^DD",2006.032,2006.032,7,4)

"^DD",2006.032,2006.032,7,21,0)
^^4^4^2991112^^^^
"^DD",2006.032,2006.032,7,21,1,0)
DO NOT USE on an OTG jukebox. 
"^DD",2006.032,2006.032,7,21,2,0)
The Data General Jukebox requires subdirectories of the form
"^DD",2006.032,2006.032,7,21,3,0)
1a\image\nn\<image file>.  The Pegasus jukebox does not require
"^DD",2006.032,2006.032,7,21,4,0)
the subdirectories.
"^DD",2006.032,2006.032,7,"DT")
3001025
"^DD",2006.032,2006.032,8,0)
JUKEBOX VOLUME NAME^S^OJMI:Pegasus OJMI Jukebox;OPTICAL:Data General AViiON Jukebox;DEX:OTG Disk Extender;^0;9^Q
"^DD",2006.032,2006.032,8,21,0)
^^2^2^2980304^^^
"^DD",2006.032,2006.032,8,21,1,0)
This is the volume name for the jukebox.  For Pegasus jukebox software, it
"^DD",2006.032,2006.032,8,21,2,0)
is "OJMI" (Optical Jukebox Management Interface).
"^DD",2006.032,2006.032,8,"DT")
2980304
"^DD",2006.032,2006.032,9,0)
MEDIA NAME^S^WORM-PDT:Pegasus WORM cartridge;WORM-DG:Data General WORK cartridge;^0;10^Q
"^DD",2006.032,2006.032,9,21,0)
^^2^2^2950327^
"^DD",2006.032,2006.032,9,21,1,0)
This identifies the kind of jukebox cartridge.  Use "WORM-PDT" for
"^DD",2006.032,2006.032,9,21,2,0)
Pegasus WORM cartridge and "WORM-DG" for Data General WORM cartridges.
"^DD",2006.032,2006.032,9,"DT")
2950318
"^DD",2006.1,2006.1,0)
FIELD^^201^62
"^DD",2006.1,2006.1,0,"DDA")
N
"^DD",2006.1,2006.1,0,"DT")
3051116
"^DD",2006.1,2006.1,0,"IX","AC",2006.1,124)

"^DD",2006.1,2006.1,0,"IX","AD",2006.1,125)

"^DD",2006.1,2006.1,0,"IX","AE",2006.1,10)

"^DD",2006.1,2006.1,0,"IX","B",2006.1,.01)

"^DD",2006.1,2006.1,0,"IX","C",2006.12,.01)

"^DD",2006.1,2006.1,0,"NM","IMAGING SITE PARAMETERS")

"^DD",2006.1,2006.1,0,"PT",2005.2,.04)

"^DD",2006.1,2006.1,0,"PT",2006.03,.04)

"^DD",2006.1,2006.1,0,"PT",2006.031,.04)

"^DD",2006.1,2006.1,0,"PT",2006.032,.04)

"^DD",2006.1,2006.1,0,"PT",2006.8,.04)

"^DD",2006.1,2006.1,0,"PT",2006.81,.04)

"^DD",2006.1,2006.1,0,"PT",2006.82,.04)

"^DD",2006.1,2006.1,0,"VRPK")
MAG
"^DD",2006.1,2006.1,.01,0)
INSTITUTION NAME^RP4X^DIC(4,^0;1^I $D(^MAG(2006.1,"B",X)) K X
"^DD",2006.1,2006.1,.01,.1)
INSTITUTION NAME
"^DD",2006.1,2006.1,.01,1,0)
^.1
"^DD",2006.1,2006.1,.01,1,1,0)
2006.1^B
"^DD",2006.1,2006.1,.01,1,1,1)
S ^MAG(2006.1,"B",$E(X,1,30),DA)=""
"^DD",2006.1,2006.1,.01,1,1,2)
K ^MAG(2006.1,"B",$E(X,1,30),DA)
"^DD",2006.1,2006.1,.01,3)
Answer must be 3-30 characters in length
"^DD",2006.1,2006.1,.01,22)

"^DD",2006.1,2006.1,.01,"DT")
3050603
"^DD",2006.1,2006.1,.02,0)
CURRENT NAMESPACE^RFX^^0;2^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>45!($L(X)<1) X
"^DD",2006.1,2006.1,.02,3)
Answer must be 1-45 characters in length.
"^DD",2006.1,2006.1,.02,21,0)
^^2^2^3020411^
"^DD",2006.1,2006.1,.02,21,1,0)
The Image file is 14 characters. Each facility has it's own unique
"^DD",2006.1,2006.1,.02,21,2,0)
namespace (e.g., Washington is WAS, Baltimore is BAL).
"^DD",2006.1,2006.1,.02,"DT")
3020411
"^DD",2006.1,2006.1,.03,0)
IMAGE NETWORK WRITE LOCATION^P2005.2^MAG(2005.2,^0;3^Q
"^DD",2006.1,2006.1,.03,3)
Current Network Write Location for Image Storage
"^DD",2006.1,2006.1,.03,21,0)
^^7^7^2970722^
"^DD",2006.1,2006.1,.03,21,1,0)
This field is a pointer to the Network Location file defining the current
"^DD",2006.1,2006.1,.03,21,2,0)
NETWORK WRITE location for captured images. Enter the server that you have
"^DD",2006.1,2006.1,.03,21,3,0)
designated as the current write server.  There is a separate option to
"^DD",2006.1,2006.1,.03,21,4,0)
edit this field when this server either "goes down", or runs out of space.
"^DD",2006.1,2006.1,.03,21,5,0)
There is a cross-reference on the field ^MAG(2006.1,"ARITE")=X where X
"^DD",2006.1,2006.1,.03,21,6,0)
equals the Network Write Location pointer. The software checks this node
"^DD",2006.1,2006.1,.03,21,7,0)
before writing the DOS Image file to disk.
"^DD",2006.1,2006.1,.03,"DT")
2930909
"^DD",2006.1,2006.1,.04,0)
ASSOCIATED INSTITUTIONS^2006.12P^^INSTS;0
"^DD",2006.1,2006.1,.04,21,0)
^.001^3^3^3060127^^
"^DD",2006.1,2006.1,.04,21,1,0)
Through the use of the subfield's whole file cross-reference this set 
"^DD",2006.1,2006.1,.04,21,2,0)
of values will allow a site to make use of the imaging network of
"^DD",2006.1,2006.1,.04,21,3,0)
a second institution to store and support images.
"^DD",2006.1,2006.1,.07,0)
GCC EXPORT LOC^*P2005.2'X^MAG(2005.2,^0;7^S DIC("S")="I $P(^(0),U,6,7)=""1^GCC""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",2006.1,2006.1,.07,12)
Select GCC Network locations only.
"^DD",2006.1,2006.1,.07,12.1)
S DIC("S")="I $P(^(0),U,6,7)=""1^GCC"""
"^DD",2006.1,2006.1,.07,21,0)
^.001^4^4^3011217^^^^
"^DD",2006.1,2006.1,.07,21,1,0)
This field is a pointer to the Network Location file defining the 
"^DD",2006.1,2006.1,.07,21,2,0)
Generic Carbon Copy (GCC) share were copies of files are sent.
"^DD",2006.1,2006.1,.07,21,3,0)
When the software makes an export request, the file
"^DD",2006.1,2006.1,.07,21,4,0)
is copied here.
"^DD",2006.1,2006.1,.07,"DT")
3041102
"^DD",2006.1,2006.1,.08,0)
IMAGE NETWORK IMPORT LOCATION^P2005.2^MAG(2005.2,^0;8^Q
"^DD",2006.1,2006.1,.08,3)
Enter the Network Location to which Images are imported.
"^DD",2006.1,2006.1,.08,21,0)
^^8^8^2990224^^^^
"^DD",2006.1,2006.1,.08,21,1,0)
Analogous to the Export location, the image IMPORT location is the
"^DD",2006.1,2006.1,.08,21,2,0)
directory specified to receive incoming images.  This points to the
"^DD",2006.1,2006.1,.08,21,3,0)
Network Location file, and a MUMPS cross-reference permits quick access
"^DD",2006.1,2006.1,.08,21,4,0)
to the site specific location.
"^DD",2006.1,2006.1,.08,21,5,0)
 
"^DD",2006.1,2006.1,.08,21,6,0)
The format of this subdirectory must be x:\IMPORT\MAIL\.  It must be located
"^DD",2006.1,2006.1,.08,21,7,0)
on a file server that supports NFS so that it can be accessed by the main
"^DD",2006.1,2006.1,.08,21,8,0)
VistA systems.
"^DD",2006.1,2006.1,.08,"DT")
2940412
"^DD",2006.1,2006.1,.09,0)
SITE CODE^F^^0;9^K:$L(X)>3!($L(X)<3)!'(X?3UN) X
"^DD",2006.1,2006.1,.09,3)
The three-letter network abbreviation for the site.
"^DD",2006.1,2006.1,.09,21,0)
^^4^4^2981223^^
"^DD",2006.1,2006.1,.09,21,1,0)
This is a unique identifying string for the site where the Imaging Server
"^DD",2006.1,2006.1,.09,21,2,0)
is installed.  By convention, the abbreviation should correspond to the
"^DD",2006.1,2006.1,.09,21,3,0)
3-character string used for the site in naming the file servers.  E.g.,
"^DD",2006.1,2006.1,.09,21,4,0)
for Washington, D.C., the code is "WAS", corresponding to vhaWASimm1.
"^DD",2006.1,2006.1,.09,"DT")
2981223
"^DD",2006.1,2006.1,1.01,0)
PACS INTERFACE SWITCH^S^0:OFF PACS INTERFACE;1:ON PACS INTERFACE;^PACS;1^Q
"^DD",2006.1,2006.1,1.01,3)
DICOM Gateway INTERFACE SWITCH - Set ON/OFF
"^DD",2006.1,2006.1,1.01,21,0)
^^4^4^3001006^^
"^DD",2006.1,2006.1,1.01,21,1,0)
This field is "NULL" if there is no DICOM Gateway interface. If there is a
"^DD",2006.1,2006.1,1.01,21,2,0)
DICOM Gateway, this field serves as a switch to turn the interface ON or
"^DD",2006.1,2006.1,1.01,21,3,0)
OFF. If it is OFF no messages will be transmitted from VistA to the DICOM
"^DD",2006.1,2006.1,1.01,21,4,0)
Gateway; if ON, then the messages will be transmitted.
"^DD",2006.1,2006.1,1.01,23,0)
^.001^2^2^3001005^^
"^DD",2006.1,2006.1,1.01,23,1,0)
The routines to generate/move HL7 messages to the PACS MESSAGE file will
"^DD",2006.1,2006.1,1.01,23,2,0)
check the existence of this entry before processing. 
"^DD",2006.1,2006.1,1.01,"DT")
3001006
"^DD",2006.1,2006.1,1.02,0)
PACS DIRECTORY^P2005.2^MAG(2005.2,^PACS;2^Q
"^DD",2006.1,2006.1,1.02,3)
Enter Network Location where PACS images are written.
"^DD",2006.1,2006.1,1.02,21,0)
^.001^3^3^3001005^^^^
"^DD",2006.1,2006.1,1.02,21,1,0)
This is a pointer to the Network Location file giving the location where
"^DD",2006.1,2006.1,1.02,21,2,0)
PACS images are written by the Commercial PACS SYSTEM, and where VistA
"^DD",2006.1,2006.1,1.02,21,3,0)
first reads them.  (Used mainly if site has a GE PACS using ACRNEMA format.)
"^DD",2006.1,2006.1,1.02,23,0)
^.001^5^5^3001005^^^^
"^DD",2006.1,2006.1,1.02,23,1,0)
The PACS SYSTEM, to which VistA is interfaced, will write images to a
"^DD",2006.1,2006.1,1.02,23,2,0)
designated network location, as defined by this field which can be
"^DD",2006.1,2006.1,1.02,23,3,0)
changed if necessary. VistA will read from the directory specified
"^DD",2006.1,2006.1,1.02,23,4,0)
by this field. It points to the Network location file - so the full
"^DD",2006.1,2006.1,1.02,23,5,0)
network location must be defined in that file for this to work.
"^DD",2006.1,2006.1,1.02,"DT")
2940411
"^DD",2006.1,2006.1,1.03,0)
PACS IMAGE WRITE LOCATION^P2005.2^MAG(2005.2,^PACS;3^Q
"^DD",2006.1,2006.1,1.03,3)
Enter Network location where converted DICOM IMAGES are written.
"^DD",2006.1,2006.1,1.03,21,0)
^^4^4^3001006^^
"^DD",2006.1,2006.1,1.03,21,1,0)
This field points to the Network Location file and informs the DICOM
"^DD",2006.1,2006.1,1.03,21,2,0)
Image Gateway of the current write drive. DICOM images are first read from the
"^DD",2006.1,2006.1,1.03,21,3,0)
DICOM directory and later converted and copied to the network location
"^DD",2006.1,2006.1,1.03,21,4,0)
specified by this field.
"^DD",2006.1,2006.1,1.03,"DT")
3001006
"^DD",2006.1,2006.1,2.01,0)
JUKEBOX DEVICE^F^^JBX;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>2!($L(X)<2)!'(X?1.A.1":") X
"^DD",2006.1,2006.1,2.01,3)
Answer must be 2 characters in length.
"^DD",2006.1,2006.1,2.01,21,0)
^.001^6^6^3051025^^^^
"^DD",2006.1,2006.1,2.01,21,1,0)
If you do not have a jukebox in your Imaging System, press "Enter" to leave
"^DD",2006.1,2006.1,2.01,21,2,0)
this field "null" - this will signify that there is no jukebox.
"^DD",2006.1,2006.1,2.01,21,3,0)
 
"^DD",2006.1,2006.1,2.01,21,4,0)
This is the name of the DRIVE for the Jukebox e.g., S: and is the root of
"^DD",2006.1,2006.1,2.01,21,5,0)
the path for the jukebox files. If you have a jukebox in your Imaging
"^DD",2006.1,2006.1,2.01,21,6,0)
System, define this field and the following associated jukebox fields.
"^DD",2006.1,2006.1,2.01,"DT")
3001006
"^DD",2006.1,2006.1,2.02,0)
TOTAL #Platters^NJ3,0^^JBX;2^K:+X'=X!(X>100)!(X<1)!(X?.E1"."1.N) X
"^DD",2006.1,2006.1,2.02,3)
Type a number between 1 and 100, 0 Decimal Digits
"^DD",2006.1,2006.1,2.02,21,0)
^^3^3^3051116^
"^DD",2006.1,2006.1,2.02,21,1,0)
This is the total number of platters in the jukebox installed with your
"^DD",2006.1,2006.1,2.02,21,2,0)
Imaging System. The total number of platters will be a function of the
"^DD",2006.1,2006.1,2.02,21,3,0)
make of the jukebox.
"^DD",2006.1,2006.1,2.02,"DT")
3051116
"^DD",2006.1,2006.1,2.03,0)
CURRENT PLATTER^P2005.2^MAG(2005.2,^JBX;3^Q
"^DD",2006.1,2006.1,2.03,3)
CURRENT PLATTER BEING USED
"^DD",2006.1,2006.1,2.03,21,0)
^^5^5^3051116^
"^DD",2006.1,2006.1,2.03,21,1,0)
This is a pointer to the Network Location file and defines the jukebox
"^DD",2006.1,2006.1,2.03,21,2,0)
platter currently being used to copy images from the Network Write
"^DD",2006.1,2006.1,2.03,21,3,0)
Location file to the jukebox. When the current platter is filled,
"^DD",2006.1,2006.1,2.03,21,4,0)
this field is automatically changed to point to the next platter,
"^DD",2006.1,2006.1,2.03,21,5,0)
which then becomes the "current" platter.
"^DD",2006.1,2006.1,2.03,"DT")
3051116
"^DD",2006.1,2006.1,6,0)
TRACK ABSTRACT ACCESSES^S^1:YES;0:NO;^1;3^Q
"^DD",2006.1,2006.1,6,3)
Enter YES to use abstract accesses in determining archive times
"^DD",2006.1,2006.1,6,21,0)
^.001^5^5^3051025^^^^
"^DD",2006.1,2006.1,6,21,1,0)
This field controls whether user accesses to image abstracts will
"^DD",2006.1,2006.1,6,21,2,0)
cause the LAST ACCESS DATE field in the Image file to be updated.
"^DD",2006.1,2006.1,6,21,3,0)
The LAST ACCESS DATE field is used to determine when full and
"^DD",2006.1,2006.1,6,21,4,0)
abstract images are removed from magnetic disks and become available
"^DD",2006.1,2006.1,6,21,5,0)
only from optical disk.
"^DD",2006.1,2006.1,6,"DT")
3001006
"^DD",2006.1,2006.1,8,0)
PURGE-RETENTION DAYS FULL FILE^RNJ6,0^^1;2^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.1,2006.1,8,3)
Type a Number between 0 and 999999, 0 Decimal Digits
"^DD",2006.1,2006.1,8,21,0)
^^4^4^2990317^^
"^DD",2006.1,2006.1,8,21,1,0)
This field is used by the Background Processor purge to determine the
"^DD",2006.1,2006.1,8,21,2,0)
number of days to retain full image files. All FULL images that have not
"^DD",2006.1,2006.1,8,21,3,0)
been accessed in this many days will be removed from magnetic storage by
"^DD",2006.1,2006.1,8,21,4,0)
the Background Processor purge.
"^DD",2006.1,2006.1,8,"DT")
2980609
"^DD",2006.1,2006.1,9,0)
PURGE-RETENTION DAYS PACS FILE^NJ6,0^^1;5^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.1,2006.1,9,3)
Type a Number between 0 and 999999, 0 Decimal Digits
"^DD",2006.1,2006.1,9,21,0)
^^4^4^3001006^^
"^DD",2006.1,2006.1,9,21,1,0)
This field is used by the Background Processor purge to determine the
"^DD",2006.1,2006.1,9,21,2,0)
number of days to retain DICOM image files. All DICOM images that have not
"^DD",2006.1,2006.1,9,21,3,0)
been accessed in this many days will be removed from magnetic storage by
"^DD",2006.1,2006.1,9,21,4,0)
automatic file migration procedures.
"^DD",2006.1,2006.1,9,"DT")
3001006
"^DD",2006.1,2006.1,10,0)
SERVER TASK^NJ10,0^^1;7^K:+X'=X!(X>9999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.1,2006.1,10,1,0)
^.1
"^DD",2006.1,2006.1,10,1,1,0)
2006.1^AE^MUMPS
"^DD",2006.1,2006.1,10,1,1,1)
D SAME^MAGDRPC2(1,DA,1,7,X)
"^DD",2006.1,2006.1,10,1,1,2)
D SAME^MAGDRPC2(0,DA,1,7,X)
"^DD",2006.1,2006.1,10,1,1,"%D",0)
^^3^3^3051025^
"^DD",2006.1,2006.1,10,1,1,"%D",1,0)
This MUMPS cross reference is really a trigger that causes
"^DD",2006.1,2006.1,10,1,1,"%D",2,0)
the values for this field to be the same for all entries
"^DD",2006.1,2006.1,10,1,1,"%D",3,0)
in the Imaging Site Parameter file.
"^DD",2006.1,2006.1,10,1,1,"DT")
3051025
"^DD",2006.1,2006.1,10,3)
Type a Number between 0 and 9999999999, 0 Decimal Digits
"^DD",2006.1,2006.1,10,21,0)
^^4^4^3001025^
"^DD",2006.1,2006.1,10,21,1,0)
Maintains the last tasked Imaging site usage task number.
"^DD",2006.1,2006.1,10,21,2,0)
This field facilitates the site reporting mechanism.  This automated
"^DD",2006.1,2006.1,10,21,3,0)
process reports version and Imaging system status back to the
"^DD",2006.1,2006.1,10,21,4,0)
development site in order to serve the site better.
"^DD",2006.1,2006.1,10,"DT")
3051025
"^DD",2006.1,2006.1,11,0)
PERCENT SERVER RESERVE^NJ2,0X^^1;8^K:+X'=X!(X>50)!(X<2)!(X?.E1"."1N.N) X
"^DD",2006.1,2006.1,11,3)
Type a Number between 5 and 35, 0 Decimal Digits
"^DD",2006.1,2006.1,11,21,0)
^^9^9^2991130^
"^DD",2006.1,2006.1,11,21,1,0)
This field allows sites to increase the amount of space that is maintained
"^DD",2006.1,2006.1,11,21,2,0)
in reserve for each individual Image server share.  The minimum value is
"^DD",2006.1,2006.1,11,21,3,0)
5, which is the default value that the server reset process uses to
"^DD",2006.1,2006.1,11,21,4,0)
determine the eligibility of the share for current write location.  Also,
"^DD",2006.1,2006.1,11,21,5,0)
when this value cannot be maintained by the 'autowrite location update'
"^DD",2006.1,2006.1,11,21,6,0)
function of the Background processor for any current online server the
"^DD",2006.1,2006.1,11,21,7,0)
CRITICAL LOW MESSAGE is triggered. Be sure to add the local Image support
"^DD",2006.1,2006.1,11,21,8,0)
staff person into the local MAG SERVER mail group and at least one pager
"^DD",2006.1,2006.1,11,21,9,0)
number in the MEMBERS - REMOTE multiple.
"^DD",2006.1,2006.1,11,"DT")
3050608
"^DD",2006.1,2006.1,11.5,0)
CRITICAL LOW MESSAGE INTERVAL^RNJ2,0^^3;7^K:+X'=X!(X>96)!(X<1)!(X?.E1"."1N.N) X
"^DD",2006.1,2006.1,11.5,3)
Type a Number between 1 and 96, 0 Decimal Digits. This represents the hours between message transmissions.
"^DD",2006.1,2006.1,11.5,21,0)
^^4^4^2991130^
"^DD",2006.1,2006.1,11.5,21,1,0)
This represents the hours between message transmissions. The Default value
"^DD",2006.1,2006.1,11.5,21,2,0)
set during the package install is 6.  Be sure to add the local Image
"^DD",2006.1,2006.1,11.5,21,3,0)
support staff person into the local MAG SERVER mail group and at least one
"^DD",2006.1,2006.1,11.5,21,4,0)
pager number in the MEMBERS - REMOTE multiple.
"^DD",2006.1,2006.1,11.5,"DT")
2991101
"^DD",2006.1,2006.1,11.9,0)
DATE OF LAST CRITICAL MESSAGE^D^^3;11^S %DT="ESTR" D ^%DT S X=Y K:Y<1 X
"^DD",2006.1,2006.1,11.9,3)
This date/time field is automatically set each time a critical message is sent.
"^DD",2006.1,2006.1,11.9,21,0)
^^4^4^2991130^
"^DD",2006.1,2006.1,11.9,21,1,0)
It is a parameter used in combination with the CRITICAL LOW MESSAGE
"^DD",2006.1,2006.1,11.9,21,2,0)
INTERVAL to determine if it is appropriate to send a new message when the
"^DD",2006.1,2006.1,11.9,21,3,0)
Vista cache space falls below the PERCENT SERVER RESERVE value.
"^DD",2006.1,2006.1,11.9,21,4,0)
This field should not be edited directly by a user.
"^DD",2006.1,2006.1,11.9,"DT")
2991030
"^DD",2006.1,2006.1,12,0)
FILE TYPES^2006.112^^2;0
"^DD",2006.1,2006.1,12,21,0)
^^3^3^2990317^^
"^DD",2006.1,2006.1,12,21,1,0)
This multiple is used by the background processor to allow control of file
"^DD",2006.1,2006.1,12,21,2,0)
migration from the magnetic servers to the jukebox and allow site specific
"^DD",2006.1,2006.1,12,21,3,0)
file types to be managed.
"^DD",2006.1,2006.1,12.5,0)
MULTI NAMESPACE^2006.11^^4;0
"^DD",2006.1,2006.1,12.5,21,0)
^.001^3^3^3001024^^^^
"^DD",2006.1,2006.1,12.5,21,1,0)
This multiple field is used to store all previously used image
"^DD",2006.1,2006.1,12.5,21,2,0)
prefixes from the CURRENT NAMESPACE field. Any time the CURRENT NAMESPACE
"^DD",2006.1,2006.1,12.5,21,3,0)
field is changed, enter the previous name in this multiple field.
"^DD",2006.1,2006.1,12.5,23,0)
^.001^3^3^3001024^^^
"^DD",2006.1,2006.1,12.5,23,1,0)
This multiple field is used to store all previously used image
"^DD",2006.1,2006.1,12.5,23,2,0)
prefixes from the CURRENT NAMESPACE field. Any time the CURRENT NAMESPACE
"^DD",2006.1,2006.1,12.5,23,3,0)
field is changed, enter the previous name in this multiple field.
"^DD",2006.1,2006.1,13,0)
RADIOLOGY HOLDS^S^0:NO RADIOLOGY HOLDS;1:RADIOLOGY HOLDS;^1;9^Q
"^DD",2006.1,2006.1,13,21,0)
^^2^2^2990317^^^^
"^DD",2006.1,2006.1,13,21,1,0)
In order to configure a site which wants to screen out radiology
"^DD",2006.1,2006.1,13,21,2,0)
images from the purge process if the radiology hold node is set.
"^DD",2006.1,2006.1,13,"DT")
2980326
"^DD",2006.1,2006.1,14,0)
JBX ALL^SIX^0:false;1:true;^JBEX;1^K X Q
"^DD",2006.1,2006.1,14,3)

"^DD",2006.1,2006.1,14,21,0)
^^4^4^2990317^^^^
"^DD",2006.1,2006.1,14,21,1,0)
Purge control which defines the outcome of purge if magnetic
"^DD",2006.1,2006.1,14,21,2,0)
file is associated with 2005 entry with no Jukebox reference.
"^DD",2006.1,2006.1,14,21,3,0)
If set to 1 then ALL images with no Jukebox reference will be
"^DD",2006.1,2006.1,14,21,4,0)
purged within the date of last access aging criteria.
"^DD",2006.1,2006.1,14,"DT")
3001222
"^DD",2006.1,2006.1,15,0)
JBX ALL PACS^SIX^0:false;1:true;^JBEX;2^K X Q
"^DD",2006.1,2006.1,15,3)

"^DD",2006.1,2006.1,15,21,0)
^^4^4^2990317^^^^
"^DD",2006.1,2006.1,15,21,1,0)
Purge control which defines the outcome of purge if magnetic
"^DD",2006.1,2006.1,15,21,2,0)
file is associated with 2005 entry with no Jukebox reference.
"^DD",2006.1,2006.1,15,21,3,0)
If set to 1 then ALL PACS images with no Jukebox reference will be
"^DD",2006.1,2006.1,15,21,4,0)
purged within the date of last access aging criteria.
"^DD",2006.1,2006.1,15,"DT")
3001222
"^DD",2006.1,2006.1,16,0)
JBX PACS BIG^SIX^0:FALSE;1:TRUE;^JBEX;3^K X Q
"^DD",2006.1,2006.1,16,21,0)
^^4^4^2990302^^^
"^DD",2006.1,2006.1,16,21,1,0)
Purge control which defines the outcome of purge if magnetic
"^DD",2006.1,2006.1,16,21,2,0)
file is associated with 2005 entry with no Jukebox reference.
"^DD",2006.1,2006.1,16,21,3,0)
If set to 1 then BIG PACS images with no Jukebox reference will be
"^DD",2006.1,2006.1,16,21,4,0)
purged.
"^DD",2006.1,2006.1,16,"DT")
3001222
"^DD",2006.1,2006.1,17,0)
JBX BIG NON-PACS^SIX^0:FALSE;1:TRUE;^JBEX;4^K X Q
"^DD",2006.1,2006.1,17,3)

"^DD",2006.1,2006.1,17,21,0)
^^4^4^2990317^^^^
"^DD",2006.1,2006.1,17,21,1,0)
Purge control which defines the outcome of purge if magnetic
"^DD",2006.1,2006.1,17,21,2,0)
file is associated with 2005 entry with no Jukebox reference.
"^DD",2006.1,2006.1,17,21,3,0)
If set to 1 then BIG / NON-PACS images with no Jukebox reference
"^DD",2006.1,2006.1,17,21,4,0)
will be purged.
"^DD",2006.1,2006.1,17,"DT")
3001222
"^DD",2006.1,2006.1,18,0)
NO JB DELETE ENTRY^SIX^0:DON'T DELETE ENTRY;1:DELETE ENTRY;^JBEX;5^K X Q
"^DD",2006.1,2006.1,18,21,0)
^^2^2^2990317^^^^
"^DD",2006.1,2006.1,18,21,1,0)
This field is used during the purge at sites without jukeboxes
"^DD",2006.1,2006.1,18,21,2,0)
to determine whether to delete the 2005 entry or clear the pointers.
"^DD",2006.1,2006.1,18,"DT")
3001222
"^DD",2006.1,2006.1,19,0)
JBX PACS BIG VER TGA^SIX^0:FALSE;1:TRUE;^JBEX;6^K X Q
"^DD",2006.1,2006.1,19,3)
Purge PACS BIG files only if TGA file is in cache.
"^DD",2006.1,2006.1,19,21,0)
^^4^4^2990317^^
"^DD",2006.1,2006.1,19,21,1,0)
Purge control which defines the outcome of purge if magnetic
"^DD",2006.1,2006.1,19,21,2,0)
file is associated with 2005 entry with no Jukebox reference.
"^DD",2006.1,2006.1,19,21,3,0)
If set to "1" then BIG PACS files will be purged from the magnetic
"^DD",2006.1,2006.1,19,21,4,0)
servers, but only if the companion TGA file is present.
"^DD",2006.1,2006.1,19,"DT")
3001222
"^DD",2006.1,2006.1,20,0)
NO AUTOWRITE UPDATE^S^0:AUTOWRITE UPDATE OK;1:NO AUTOWRITE UPDATE;^1;10^Q
"^DD",2006.1,2006.1,20,21,0)
^^4^4^2991130^^^^
"^DD",2006.1,2006.1,20,21,1,0)
This field enables or disables the background processor function which
"^DD",2006.1,2006.1,20,21,2,0)
evaluates the space availability on each of the online magnetic shares
"^DD",2006.1,2006.1,20,21,3,0)
and assigns the current write location to the share with the greatest
"^DD",2006.1,2006.1,20,21,4,0)
space available both for PACS and regular image capture. 
"^DD",2006.1,2006.1,20,"DT")
2980512
"^DD",2006.1,2006.1,21,0)
PURGE-RETEN DAYS PACS BIG FILE^NJ5,0^^3;1^K:+X'=X!(X>99999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.1,2006.1,21,3)
Type a Number between 1 and 99999, 0 Decimal Digits
"^DD",2006.1,2006.1,21,21,0)
^^4^4^3001006^^
"^DD",2006.1,2006.1,21,21,1,0)
This field is used by the Background Processor purge to determine the number
"^DD",2006.1,2006.1,21,21,2,0)
of days to retain BIG DICOM files. All BIG DICOM images that have not been
"^DD",2006.1,2006.1,21,21,3,0)
accessed in this many days will be removed from magnetic storage by the
"^DD",2006.1,2006.1,21,21,4,0)
Background Processor purge.
"^DD",2006.1,2006.1,21,"DT")
3001006
"^DD",2006.1,2006.1,22,0)
PURGE-RETENTION DAYS BIG FILE^NJ5,0^^3;2^K:+X'=X!(X>99999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.1,2006.1,22,3)
Type a Number between 0 and 99999, 0 Decimal Digits
"^DD",2006.1,2006.1,22,21,0)
^^4^4^2990317^^
"^DD",2006.1,2006.1,22,21,1,0)
This field is used by the Background Processor purge to determine the
"^DD",2006.1,2006.1,22,21,2,0)
number of days to retain BIG files. All BIG images that have not been
"^DD",2006.1,2006.1,22,21,3,0)
accessed in this many days will be removed from magnetic storage by the
"^DD",2006.1,2006.1,22,21,4,0)
Background Processor purge.
"^DD",2006.1,2006.1,22,"DT")
2981210
"^DD",2006.1,2006.1,23,0)
PURGE-RETENTION DAYS ABS FILE^NJ4,0^^3;3^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.1,2006.1,23,3)
Type a Number between 0 and 9999, 0 Decimal Digits
"^DD",2006.1,2006.1,23,21,0)
^^4^4^3001006^^
"^DD",2006.1,2006.1,23,21,1,0)
This field is used by the Background Processor purge to determine the
"^DD",2006.1,2006.1,23,21,2,0)
number of days to retain ABS files. All ABS images that have not been
"^DD",2006.1,2006.1,23,21,3,0)
accessed in this many days will be removed from magnetic storage by the
"^DD",2006.1,2006.1,23,21,4,0)
Background Processor purge.
"^DD",2006.1,2006.1,23,"DT")
2990225
"^DD",2006.1,2006.1,24,0)
PURGE-RETENTION DAYS PACS ABS^NJ4,0^^3;4^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.1,2006.1,24,3)
Type a Number between 0 and 9999, 0 Decimal Digits
"^DD",2006.1,2006.1,24,21,0)
^.001^4^4^3001005^^^^
"^DD",2006.1,2006.1,24,21,1,0)
This field is used by the Background Processor purge to determine the
"^DD",2006.1,2006.1,24,21,2,0)
number of days to retain DICOM ABS files. All DICOM ABS images that have not
"^DD",2006.1,2006.1,24,21,3,0)
been accessed in this many days will be removed from magnetic storage by
"^DD",2006.1,2006.1,24,21,4,0)
the Background Processor purge.
"^DD",2006.1,2006.1,24,"DT")
3001006
"^DD",2006.1,2006.1,25,0)
IMPORT QUEUE SECURITY^S^0:OFF;1:ON;^3;12^Q
"^DD",2006.1,2006.1,25,21,0)
^^1^1^3050608^
"^DD",2006.1,2006.1,25,21,1,0)
This field enables network security for the Import Queue.
"^DD",2006.1,2006.1,25,"DT")
3050608
"^DD",2006.1,2006.1,50,0)
NET USERNAME^F^^NET;1^K:$L(X)>30!($L(X)<3) X
"^DD",2006.1,2006.1,50,3)
Answer must be 3-30 characters in length.
"^DD",2006.1,2006.1,50,21,0)
^.001^1^1^3000922^^^
"^DD",2006.1,2006.1,50,21,1,0)
This field contains the NT username that the Imaging application uses to access images from the Image shares.
"^DD",2006.1,2006.1,50,"DT")
2961119
"^DD",2006.1,2006.1,51,0)
NET PASSWORD^FXO^^NET;2^K:$L(X)>30!($L(X)<3) X S MAGPAS=X S X=$$ENCRYP^ROUTINE(MAGPAS)
"^DD",2006.1,2006.1,51,2)
S Y(0)=Y S Y="<Hidden>"
"^DD",2006.1,2006.1,51,2.1)
S Y="<Hidden>"
"^DD",2006.1,2006.1,51,3)
The encrypted network password (between 3 and 30 characters in length) for the NET USERNAME entity.
"^DD",2006.1,2006.1,51,21,0)
^.001^2^2^3000922^^^
"^DD",2006.1,2006.1,51,21,1,0)
This field contains the network password for the NET USERNAME entity.  The
"^DD",2006.1,2006.1,51,21,2,0)
password is encrypted.
"^DD",2006.1,2006.1,51,23,0)
^.001^2^2^3000922^^
"^DD",2006.1,2006.1,51,23,1,0)
This field must be set to the NT password for the IU account.
"^DD",2006.1,2006.1,51,23,2,0)
It will be encrypted before it is stored in the system.
"^DD",2006.1,2006.1,51,"DT")
2991130
"^DD",2006.1,2006.1,52,0)
NET UPDATE DIRECTORY^P2005.2'^MAG(2005.2,^NET;3^Q
"^DD",2006.1,2006.1,52,21,0)
^^8^8^2970722^
"^DD",2006.1,2006.1,52,21,1,0)
This is the directory where Imaging releases, to be tested, are copied.
"^DD",2006.1,2006.1,52,21,2,0)
Workstations with the "WRKS RUNS TEST UPDATES" field set to True will
"^DD",2006.1,2006.1,52,21,3,0)
check the directory, defined in this field, for the latest Imaging
"^DD",2006.1,2006.1,52,21,4,0)
software to test.  A site can limit the number of workstations that will
"^DD",2006.1,2006.1,52,21,5,0)
use this procedure to test new versions of the software.  When a site is
"^DD",2006.1,2006.1,52,21,6,0)
satisfied with the new version, it copies MAGSETUP.EXE to the NETUPDATE
"^DD",2006.1,2006.1,52,21,7,0)
DIRECTORY where all workstations will be updated. This field points to the
"^DD",2006.1,2006.1,52,21,8,0)
Network Location file (2005.2).
"^DD",2006.1,2006.1,52,"DT")
2970421
"^DD",2006.1,2006.1,53,0)
NET UPDATE TEST DIRECTORY^P2005.2'^MAG(2005.2,^NET;4^Q
"^DD",2006.1,2006.1,53,21,0)
^^9^9^2970421^
"^DD",2006.1,2006.1,53,21,1,0)
This is the directory where Imaging releases to be tested are
"^DD",2006.1,2006.1,53,21,2,0)
copied.  Workstations with NET UPDATE TEST DIRECTORY
"^DD",2006.1,2006.1,53,21,3,0)
Field of the IMAGING WORKSTATIONS file = TRUE
"^DD",2006.1,2006.1,53,21,4,0)
will check this directory for new versions of
"^DD",2006.1,2006.1,53,21,5,0)
Imaging (MAGSETUP.EXE)
"^DD",2006.1,2006.1,53,21,6,0)
A site can limit the number of workstations that will test new
"^DD",2006.1,2006.1,53,21,7,0)
versions of imaging this way.  When a site is satisfied with the
"^DD",2006.1,2006.1,53,21,8,0)
new version, they copy MAGSETUP.EXE to the NET UPDATE DIRECTORY where
"^DD",2006.1,2006.1,53,21,9,0)
all workstations will update from.
"^DD",2006.1,2006.1,53,"DT")
2970421
"^DD",2006.1,2006.1,54,0)
JUKEBOX DEFAULT^P2006.032'^MAGQUEUE(2006.032,^1;6^Q
"^DD",2006.1,2006.1,54,3)
If you have more than 1 jukebox, you will need to enter the active jukebox here
"^DD",2006.1,2006.1,54,21,0)
^^1^1^2970804^
"^DD",2006.1,2006.1,54,21,1,0)
This field will point to the currently active jukebox if more than 1 exists
"^DD",2006.1,2006.1,54,"DT")
2970804
"^DD",2006.1,2006.1,55,0)
NET SITE SERVICE^P2005.2'^MAG(2005.2,^NET;5^Q
"^DD",2006.1,2006.1,55,3)
This network location is used to access the VistA Site Service.  The VistA Site Service is used by Remote Image Views to gain access to remote sites.
"^DD",2006.1,2006.1,55,21,0)
^.001^2^2^3050722^^
"^DD",2006.1,2006.1,55,21,1,0)
The VistA Site Service is used by Remote Image Views to gain access
"^DD",2006.1,2006.1,55,21,2,0)
to remote sites.
"^DD",2006.1,2006.1,55,"DT")
3050722
"^DD",2006.1,2006.1,60,0)
NEW AUTOPURGE^S^0:OFF;1:ON;^5;1^Q
"^DD",2006.1,2006.1,60,3)
This value is used by the Background processor to determine whether to start a purge process when the Vista Cache low water mark has been reached.
"^DD",2006.1,2006.1,60,21,0)
^.001^2^2^3031205^^
"^DD",2006.1,2006.1,60,21,1,0)
This boolean value is used by the Background Processor to determine whether
"^DD",2006.1,2006.1,60,21,2,0)
to launch the purge when the Vista Cache low water mark has been reached.
"^DD",2006.1,2006.1,60,"DT")
3031205
"^DD",2006.1,2006.1,61,0)
CONTINUOUS PURGE^SX^0:OFF;1:ON;^5;2^S:X=1 $P(^MAG(2006.1,DA,5),U,3)=0
"^DD",2006.1,2006.1,61,3)
This value is used to determine whether the BP Queue processor should maintain a continuous Vista Cache purge process.
"^DD",2006.1,2006.1,61,21,0)
^^3^3^3031205^
"^DD",2006.1,2006.1,61,21,1,0)
This boolean value is used to determine whether the BP Queue processor should 
"^DD",2006.1,2006.1,61,21,2,0)
maintain a continuous purge process.  This process cannot be co-enabled with 
"^DD",2006.1,2006.1,61,21,3,0)
the scheduled purge process.
"^DD",2006.1,2006.1,61,"DT")
3031205
"^DD",2006.1,2006.1,62,0)
SCHEDULED PURGE^SX^0:OFF;1:ON;^5;3^S:X=1 $P(^MAG(2006.1,DA,5),U,2)=0
"^DD",2006.1,2006.1,62,3)
This value is used to determine whether the BP Queue Processor will trigger a purge process on a scheduled frequency.
"^DD",2006.1,2006.1,62,21,0)
^.001^6^6^3031205^^
"^DD",2006.1,2006.1,62,21,1,0)
This boolean value is used to determine whether the BP Queue Processor
"^DD",2006.1,2006.1,62,21,2,0)
will trigger a scheduled purge process.  This value cannot be co-enabled 
"^DD",2006.1,2006.1,62,21,3,0)
with the continuous purge process.  The frequency will be determined by
"^DD",2006.1,2006.1,62,21,4,0)
the frequency days and the date of the last purge. A default value of 28
"^DD",2006.1,2006.1,62,21,5,0)
days will be used if the frequency value is null.  A default vault of
"^DD",2006.1,2006.1,62,21,6,0)
2400 hour will be used if the Purge Time is not set.
"^DD",2006.1,2006.1,62,"DT")
3031205
"^DD",2006.1,2006.1,63,0)
SCHEDULED PURGE FREQUENCY^NJ3,0^^5;4^K:+X'=X!(X>365)!(X<1)!(X?.E1"."1N.N) X
"^DD",2006.1,2006.1,63,3)
Type a Number between 1 and 365, 0 Decimal Digits
"^DD",2006.1,2006.1,63,21,0)
^^5^5^3031205^
"^DD",2006.1,2006.1,63,21,1,0)
When Scheduled Purge process is enabled this value will be added
"^DD",2006.1,2006.1,63,21,2,0)
to the date of the last purge for the BP Queue processor to
"^DD",2006.1,2006.1,63,21,3,0)
evaluate for launching a purge process.  If the Schedule 
"^DD",2006.1,2006.1,63,21,4,0)
Purge process is enabled and this value is not set, then the
"^DD",2006.1,2006.1,63,21,5,0)
default value of 28 days will be used.
"^DD",2006.1,2006.1,63,"DT")
3031205
"^DD",2006.1,2006.1,64,0)
SCHEDULED PURGE TIME^NJ4,0X^^5;5^S X=+X K:(X>2400)!(X<0)!(X?.E1"."1N.N)!($E(X,$L(X)-1,$L(X))>59) X
"^DD",2006.1,2006.1,64,3)
Type a Number between 0000 and 2400, 0 Decimal Digits
"^DD",2006.1,2006.1,64,21,0)
^^5^5^3031205^
"^DD",2006.1,2006.1,64,21,1,0)
This military time value is used to determine what time of day the scheduled
"^DD",2006.1,2006.1,64,21,2,0)
purge will be triggered.  A default value of 2400 will be used by the 
"^DD",2006.1,2006.1,64,21,3,0)
BP Queue Processor if the Scheduled Purge option is enabled and the 
"^DD",2006.1,2006.1,64,21,4,0)
frequency days plus date of last purge threshold has been reached and this
"^DD",2006.1,2006.1,64,21,5,0)
value is undefined.
"^DD",2006.1,2006.1,64,"DT")
3031205
"^DD",2006.1,2006.1,65,0)
DATE OF LAST PURGE^D^^5;6^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",2006.1,2006.1,65,3)
This date is automatically set by the purge process when that process has successfully completed.
"^DD",2006.1,2006.1,65,21,0)
^^2^2^3031205^
"^DD",2006.1,2006.1,65,21,1,0)
This date is set by the BP Purge process.  It is used in conjunction with
"^DD",2006.1,2006.1,65,21,2,0)
the Scheduled purge process to automated the purge process execution.
"^DD",2006.1,2006.1,65,"DT")
3031205
"^DD",2006.1,2006.1,70,0)
CT PRESETS^F^^CT;1^K:$L(X)>245!($L(X)<3) X
"^DD",2006.1,2006.1,70,3)
These are used by the Imaging Display Radiology Viewer
"^DD",2006.1,2006.1,70,21,0)
^^5^5^3040407^
"^DD",2006.1,2006.1,70,21,1,0)
 A Series of CT Presets delimited by '~'.  Defined at the site.
"^DD",2006.1,2006.1,70,21,2,0)
 These are used by the Imaging Display Radiology Viewer.
"^DD",2006.1,2006.1,70,21,3,0)
 They are presented to the user on the CT Presets Menu Option.
"^DD",2006.1,2006.1,70,21,4,0)
 example of two :
"^DD",2006.1,2006.1,70,21,5,0)
 Abdomen|350|1041~Bone|500|1274
"^DD",2006.1,2006.1,70,"DT")
3040407
"^DD",2006.1,2006.1,100,0)
DEFAULT USER PREFERENCE^P2006.18'^MAG(2006.18,^USERPREF;1^Q
"^DD",2006.1,2006.1,100,3)
This is the default window setting for all new Imaging users.
"^DD",2006.1,2006.1,100,21,0)
^.001^4^4^3001025^^^^
"^DD",2006.1,2006.1,100,21,1,0)
This field contains the user preference setting for first time users of
"^DD",2006.1,2006.1,100,21,2,0)
the Imaging System.  This field points to the Imaging User Preference file
"^DD",2006.1,2006.1,100,21,3,0)
(2005.18).  If this field is empty, the default user preferences 
"^DD",2006.1,2006.1,100,21,4,0)
are created by the imaging routines.
"^DD",2006.1,2006.1,100,"DT")
2961114
"^DD",2006.1,2006.1,101,0)
DEFAULT MUSE SITE #^NJ2,0^^USERPREF;2^K:+X'=X!(X>20)!(X<1)!(X?.E1"."1.N) X
"^DD",2006.1,2006.1,101,3)
Type a number between 1 and 20, 0 Decimal Digits
"^DD",2006.1,2006.1,101,21,0)
^.001^14^14^3001002^^^
"^DD",2006.1,2006.1,101,21,1,0)
 
"^DD",2006.1,2006.1,101,21,2,0)
Enter the default MUSE
"^DD",2006.1,2006.1,101,21,3,0)
site that the Imaging Display application will connect to.
"^DD",2006.1,2006.1,101,21,4,0)
Site numbers are usually 1,2,3... etc.
"^DD",2006.1,2006.1,101,21,5,0)
If this field is empty, the application will default to 1.
"^DD",2006.1,2006.1,101,21,6,0)
 
"^DD",2006.1,2006.1,101,21,7,0)
Most sites that have a MUSE server that serves EKG data to a 
"^DD",2006.1,2006.1,101,21,8,0)
single Medical Center would
"^DD",2006.1,2006.1,101,21,9,0)
have the MUSE site number set to 1.  If multiple sites 
"^DD",2006.1,2006.1,101,21,10,0)
are sharing a single MUSE server, each site could be assigned 
"^DD",2006.1,2006.1,101,21,11,0)
a unique MUSE site number by Marquette.  In some cases a single 
"^DD",2006.1,2006.1,101,21,12,0)
shared MUSE database has been created to serve multiple Medical
"^DD",2006.1,2006.1,101,21,13,0)
Centers.  In this case all sites would most likely have the
"^DD",2006.1,2006.1,101,21,14,0)
MUSE site number set to 1.
"^DD",2006.1,2006.1,101,"DT")
3001002
"^DD",2006.1,2006.1,102,0)
PCT FREE SPACE DICOM MSGS^NJ3,0^^3;5^K:+X'=X!(X>100)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.1,2006.1,102,.1)
Percentage of free disk space for DICOM messages
"^DD",2006.1,2006.1,102,3)
Enter the minimum percentage (0 to 100) of free space for a DICOM server
"^DD",2006.1,2006.1,102,21,0)
^^2^2^2990618^^
"^DD",2006.1,2006.1,102,21,1,0)
The value of this field is the minimum percentage of free space
"^DD",2006.1,2006.1,102,21,2,0)
for a DICOM server.
"^DD",2006.1,2006.1,102,"DT")
2991130
"^DD",2006.1,2006.1,103,0)
RETENTION DAYS DICOM MSGS^NJ5,0^^3;6^K:+X'=X!(X>99999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.1,2006.1,103,.1)
Number of days to retain DICOM messages
"^DD",2006.1,2006.1,103,3)
Enter the number of days (Enter the number of days (between 0 and 99999) that DICOM messages are to be retained.) that DICOM messages are to be retained.
"^DD",2006.1,2006.1,103,21,0)
^^4^4^2990618^^
"^DD",2006.1,2006.1,103,21,1,0)
The value of this parameter is the number of days that DICOM
"^DD",2006.1,2006.1,103,21,2,0)
messages are to be retained.
"^DD",2006.1,2006.1,103,21,3,0)
The subroutine that purges old DICOM messages will only remove
"^DD",2006.1,2006.1,103,21,4,0)
messages that are older than this number of days.
"^DD",2006.1,2006.1,103,"DT")
2991130
"^DD",2006.1,2006.1,120,0)
USE CAPTURE KEYS^S^1:TRUE;0:FALSE;^KEYS;1^Q
"^DD",2006.1,2006.1,120,3)
True - Check users Imaging keys for permission to capture.
"^DD",2006.1,2006.1,120,21,0)
^.001^7^7^3001025^^^^
"^DD",2006.1,2006.1,120,21,1,0)
This field controls whether the Image capture security keys will be
"^DD",2006.1,2006.1,120,21,2,0)
used. If set to true, the appropriate keys must be given for the
"^DD",2006.1,2006.1,120,21,3,0)
appropriate Image capture.  'Capture' functionality and Procedure lookup
"^DD",2006.1,2006.1,120,21,4,0)
functionality will not be allowed from the capture window if the user does
"^DD",2006.1,2006.1,120,21,5,0)
not have the proper security key allocated.  The Medicine procedure
"^DD",2006.1,2006.1,120,21,6,0)
selection window will only display the types of procedures that the user
"^DD",2006.1,2006.1,120,21,7,0)
has keys for.
"^DD",2006.1,2006.1,120,"DT")
2970417
"^DD",2006.1,2006.1,121,0)
TIMEOUT WINDOWS DISPLAY^NJ3,0^^KEYS;2^K:+X'=X!(X>600)!(X<5)!(X?.E1"."1N.N) X
"^DD",2006.1,2006.1,121,3)
Enter the number of Minutes (between 6 and 600) until the Imaging Display Application will close due to inactivity.
"^DD",2006.1,2006.1,121,21,0)
^^4^4^2990504^^
"^DD",2006.1,2006.1,121,21,1,0)
  This is the number of Minutes used as the Time Out for the Imaging Display
"^DD",2006.1,2006.1,121,21,2,0)
  Application.  If no activity occurs for this number of minutes, the user
"^DD",2006.1,2006.1,121,21,3,0)
  will be prompted with a dialog window and given 30 seconds to
"^DD",2006.1,2006.1,121,21,4,0)
  'Click' on the 'Stay Connected' button or the application will be closed.
"^DD",2006.1,2006.1,121,"DT")
2991130
"^DD",2006.1,2006.1,122,0)
TIMEOUT WINDOWS CAPTURE^NJ3,0^^KEYS;3^K:+X'=X!(X>600)!(X<5)!(X?.E1"."1N.N) X
"^DD",2006.1,2006.1,122,3)
Enter the number of Minutes (between 6 and 600) until the Imaging Capture Application will close due to inactivity.
"^DD",2006.1,2006.1,122,21,0)
^^4^4^2990504^^^
"^DD",2006.1,2006.1,122,21,1,0)
This is the number of Minutes used as the Time Out for the Imaging Capture
"^DD",2006.1,2006.1,122,21,2,0)
Application.  If no activity occurs for this number of minutes, the user 
"^DD",2006.1,2006.1,122,21,3,0)
will be prompted with a dialog window and given 30 seconds to 
"^DD",2006.1,2006.1,122,21,4,0)
'Click' on the 'Stay Connected' button or the application will be closed.
"^DD",2006.1,2006.1,122,"DT")
2991130
"^DD",2006.1,2006.1,123,0)
TIMEOUT WINDOWS VISTARAD^NJ3,0^^KEYS;4^K:+X'=X!(X>600)!(X<5)!(X?.E1"."1N.N) X
"^DD",2006.1,2006.1,123,3)
Enter the number of Minutes(between 6 and 600) until the Imaging VISTARad Application will close due to inactivity.
"^DD",2006.1,2006.1,123,21,0)
^^4^4^2990504^^
"^DD",2006.1,2006.1,123,21,1,0)
  This is the number of Minutes used as Time Out for the Imaging VISTARad
"^DD",2006.1,2006.1,123,21,2,0)
  Application.  If no activity occurs for this number of minutes, the user
"^DD",2006.1,2006.1,123,21,3,0)
  will be prompted with a dialog window and given 30 seconds to
"^DD",2006.1,2006.1,123,21,4,0)
  'Click' on the 'Stay Connected' button or the application will be closed.
"^DD",2006.1,2006.1,123,"DT")
2991130
"^DD",2006.1,2006.1,124,0)
DICOM GATEWAY ACCESS CODE^FXO^^GW;1^K:$L(X)>30!($L(X)<3) X Q:'$D(X)  S X=$$ENCRYP^ROUTINE(X)
"^DD",2006.1,2006.1,124,1,0)
^.1
"^DD",2006.1,2006.1,124,1,1,0)
2006.1^AC^MUMPS
"^DD",2006.1,2006.1,124,1,1,1)
D SAME^MAGDRPC2(1,DA,"GW",1,X)
"^DD",2006.1,2006.1,124,1,1,2)
D SAME^MAGDRPC2(0,DA,"GW",1,X)
"^DD",2006.1,2006.1,124,1,1,"%D",0)
^.101^3^3^3051025^^^
"^DD",2006.1,2006.1,124,1,1,"%D",1,0)
This MUMPS cross reference is really a trigger that causes
"^DD",2006.1,2006.1,124,1,1,"%D",2,0)
the values for this field to be the same for all entries
"^DD",2006.1,2006.1,124,1,1,"%D",3,0)
in the Imaging Site Parameter file.
"^DD",2006.1,2006.1,124,1,1,"DT")
3031120
"^DD",2006.1,2006.1,124,2)
S Y(0)=Y S Y="<hidden>"
"^DD",2006.1,2006.1,124,2.1)
S Y="<hidden>"
"^DD",2006.1,2006.1,124,3)
Enter the access code that DICOM Gateways may use.
"^DD",2006.1,2006.1,124,21,0)
^^4^4^3031119^
"^DD",2006.1,2006.1,124,21,1,0)
The value of this field is a string that may be used by a DICOM
"^DD",2006.1,2006.1,124,21,2,0)
Gateway when it needs to provide an ACCESS CODE to the VistA system.
"^DD",2006.1,2006.1,124,21,3,0)
 
"^DD",2006.1,2006.1,124,21,4,0)
This value is stored encrypted.
"^DD",2006.1,2006.1,124,"DT")
3031120
"^DD",2006.1,2006.1,125,0)
DICOM GATEWAY VERIFY CODE^FXO^^GW;2^K:$L(X)>30!($L(X)<3) X Q:'$D(X)  S X=$$ENCRYP^ROUTINE(X)
"^DD",2006.1,2006.1,125,1,0)
^.1
"^DD",2006.1,2006.1,125,1,1,0)
2006.1^AD^MUMPS
"^DD",2006.1,2006.1,125,1,1,1)
D SAME^MAGDRPC2(1,DA,"GW",2,X)
"^DD",2006.1,2006.1,125,1,1,2)
D SAME^MAGDRPC2(0,DA,"GW",2,X)
"^DD",2006.1,2006.1,125,1,1,"%D",0)
^^3^3^3031120^
"^DD",2006.1,2006.1,125,1,1,"%D",1,0)
This MUMPS cross reference is really a trigger that causes
"^DD",2006.1,2006.1,125,1,1,"%D",2,0)
the values for this field to be the same for all entries
"^DD",2006.1,2006.1,125,1,1,"%D",3,0)
in the Imaging Site Parameter file.
"^DD",2006.1,2006.1,125,1,1,"DT")
3031120
"^DD",2006.1,2006.1,125,2)
S Y(0)=Y S Y="<hidden>"
"^DD",2006.1,2006.1,125,2.1)
S Y="<hidden>"
"^DD",2006.1,2006.1,125,3)
Enter the verify code that DICOM Gateways may use.
"^DD",2006.1,2006.1,125,21,0)
^^4^4^3031119^
"^DD",2006.1,2006.1,125,21,1,0)
>The value of this field is a string that may be used by a DICOM 
"^DD",2006.1,2006.1,125,21,2,0)
Gateway when it needs to provide a VERIFY CODE to a VistA system.
"^DD",2006.1,2006.1,125,21,3,0)
 
"^DD",2006.1,2006.1,125,21,4,0)
This value is stored encrypted.
"^DD",2006.1,2006.1,125,"DT")
3031120
"^DD",2006.1,2006.1,126,0)
LAST ROUTING ACTIVITY^D^^LASTROUTE;1^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",2006.1,2006.1,126,3)
Enter the date when routing was last active.
"^DD",2006.1,2006.1,126,21,0)
^^5^5^3050110^
"^DD",2006.1,2006.1,126,21,1,0)
The value of this field is a date (FileMan format, date only,
"^DD",2006.1,2006.1,126,21,2,0)
no time). This value indicates the most recent date
"^DD",2006.1,2006.1,126,21,3,0)
on which any routing activity took place at the current site.
"^DD",2006.1,2006.1,126,21,4,0)
  
"^DD",2006.1,2006.1,126,21,5,0)
Routing activity can be either Rule Evaluation or Image Transmission.
"^DD",2006.1,2006.1,126,"DT")
3050110
"^DD",2006.1,2006.1,127,0)
LAST ROUTING CHECK^D^^LASTROUTE;2^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",2006.1,2006.1,127,3)
Enter the date when routing activity was most recently checked.
"^DD",2006.1,2006.1,127,21,0)
^^4^4^3040603^
"^DD",2006.1,2006.1,127,21,1,0)
The value of this field is a date (FileMan format, date only,
"^DD",2006.1,2006.1,127,21,2,0)
no time part). This value indicates the most recent date
"^DD",2006.1,2006.1,127,21,3,0)
on which a check was performed whether or not Routing is
"^DD",2006.1,2006.1,127,21,4,0)
still active at the current site.
"^DD",2006.1,2006.1,127,"DT")
3040603
"^DD",2006.1,2006.1,130,0)
VERSION CHECKING^S^0:NO;1:YES;^KEYS;5^Q
"^DD",2006.1,2006.1,130,3)
Turn ON to stop Imaging Clients that are no longer supported, from connecting to VistA.
"^DD",2006.1,2006.1,130,21,0)
^.001^13^13^3050110^^
"^DD",2006.1,2006.1,130,21,1,0)
Turn ON to stop old versions of Imaging Display and Capture Clients
"^DD",2006.1,2006.1,130,21,2,0)
from connecting to VistA.
"^DD",2006.1,2006.1,130,21,3,0)
Old versions of the client software will sometimes not perform
"^DD",2006.1,2006.1,130,21,4,0)
correctly and will not have the latest updates and functionality.
"^DD",2006.1,2006.1,130,21,5,0)
When turned ON:
"^DD",2006.1,2006.1,130,21,6,0)
     The most recent versions of Client software will continue to
"^DD",2006.1,2006.1,130,21,7,0)
     work okay, but the user will be informed that a newer version
"^DD",2006.1,2006.1,130,21,8,0)
     exists.
"^DD",2006.1,2006.1,130,21,9,0)
     Old Client versions will not be allowed to connect to VistA.
"^DD",2006.1,2006.1,130,21,10,0)
     A message will be shown to the user, informing them that the
"^DD",2006.1,2006.1,130,21,11,0)
     version is too old, and will be aborted.
"^DD",2006.1,2006.1,130,21,12,0)
     Check the Imaging Patch Description for a list of
"^DD",2006.1,2006.1,130,21,13,0)
     previous versions that will be allowed to connect.
"^DD",2006.1,2006.1,130,"DT")
3050110
"^DD",2006.1,2006.1,201,0)
VISTARAD GROUPING^2006.1201P^^201;0
"^DD",2006.1,2006.1,201,21,0)
^^3^3^3060125^
"^DD",2006.1,2006.1,201,21,1,0)
This field allows multiple Institutions and/or Associated Institutions
"^DD",2006.1,2006.1,201,21,2,0)
to be grouped together within VistARad for purposes of Exam Locking
"^DD",2006.1,2006.1,201,21,3,0)
and Unread Exams lists display.
"^DD",2006.1,2006.1,201,"DT")
3060125
"^DD",2006.1,2006.11,0)
MULTI NAMESPACE SUB-FIELD^^.01^1
"^DD",2006.1,2006.11,0,"DT")
3001024
"^DD",2006.1,2006.11,0,"IX","B",2006.11,.01)

"^DD",2006.1,2006.11,0,"NM","MULTI NAMESPACE")

"^DD",2006.1,2006.11,0,"UP")
2006.1
"^DD",2006.1,2006.11,.01,0)
MULTI NAMESPACE^MFM^^0;1^K:$L(X)>45!($L(X)<1) X
"^DD",2006.1,2006.11,.01,1,0)
^.1
"^DD",2006.1,2006.11,.01,1,1,0)
2006.11^B
"^DD",2006.1,2006.11,.01,1,1,1)
S ^MAG(2006.1,DA(1),4,"B",$E(X,1,30),DA)=""
"^DD",2006.1,2006.11,.01,1,1,2)
K ^MAG(2006.1,DA(1),4,"B",$E(X,1,30),DA)
"^DD",2006.1,2006.11,.01,3)
Answer must be 1-45 characters in length
"^DD",2006.1,2006.11,.01,21,0)
^^4^4^3020411^
"^DD",2006.1,2006.11,.01,21,1,0)
This multiple field is used to store all previously used image 
"^DD",2006.1,2006.11,.01,21,2,0)
prefixes from the CURRENT NAMESPACE field. Any time the 
"^DD",2006.1,2006.11,.01,21,3,0)
CURRENT NAMESPACE field is changed, enter the previous name 
"^DD",2006.1,2006.11,.01,21,4,0)
in this multiple field.
"^DD",2006.1,2006.11,.01,23,0)
^.001^3^3^3001024^^^
"^DD",2006.1,2006.11,.01,23,1,0)
This multiple field is used to store all previously used image
"^DD",2006.1,2006.11,.01,23,2,0)
prefixes from the CURRENT NAMESPACE field. Any time the CURRENT NAMESPACE
"^DD",2006.1,2006.11,.01,23,3,0)
field is changed, enter the previous name in this multiple field.
"^DD",2006.1,2006.11,.01,"DT")
3020411
"^DD",2006.1,2006.112,0)
FILE TYPES SUB-FIELD^^.01^1
"^DD",2006.1,2006.112,0,"DT")
2980227
"^DD",2006.1,2006.112,0,"IX","B",2006.112,.01)

"^DD",2006.1,2006.112,0,"NM","FILE TYPES")

"^DD",2006.1,2006.112,0,"UP")
2006.1
"^DD",2006.1,2006.112,.01,0)
FILE TYPES^MF^^0;1^K:$L(X)>3!($L(X)<3) X
"^DD",2006.1,2006.112,.01,1,0)
^.1
"^DD",2006.1,2006.112,.01,1,1,0)
2006.112^B
"^DD",2006.1,2006.112,.01,1,1,1)
S ^MAG(2006.1,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",2006.1,2006.112,.01,1,1,2)
K ^MAG(2006.1,DA(1),2,"B",$E(X,1,30),DA)
"^DD",2006.1,2006.112,.01,3)
File extensions for background copies
"^DD",2006.1,2006.112,.01,"DT")
2980227
"^DD",2006.1,2006.12,0)
ASSOCIATED INSTITUTIONS SUB-FIELD^^201^2
"^DD",2006.1,2006.12,0,"DT")
3050520
"^DD",2006.1,2006.12,0,"IX","B",2006.12,.01)

"^DD",2006.1,2006.12,0,"NM","ASSOCIATED INSTITUTIONS")

"^DD",2006.1,2006.12,0,"UP")
2006.1
"^DD",2006.1,2006.12,.01,0)
ASSOCIATED INSTITUTIONS^P4'X^DIC(4,^0;1^Q
"^DD",2006.1,2006.12,.01,1,0)
^.1
"^DD",2006.1,2006.12,.01,1,1,0)
2006.12^B
"^DD",2006.1,2006.12,.01,1,1,1)
S ^MAG(2006.1,DA(1),"INSTS","B",$E(X,1,30),DA)=""
"^DD",2006.1,2006.12,.01,1,1,2)
K ^MAG(2006.1,DA(1),"INSTS","B",$E(X,1,30),DA)
"^DD",2006.1,2006.12,.01,1,2,0)
2006.1^C^MUMPS
"^DD",2006.1,2006.12,.01,1,2,1)
S ^MAG(2006.1,"B",$E(X,1,30),DA(1))=""
"^DD",2006.1,2006.12,.01,1,2,2)
K ^MAG(2006.1,"B",$E(X,1,30),DA(1))
"^DD",2006.1,2006.12,.01,1,2,"%D",0)
^.101^1^1^3060127^^
"^DD",2006.1,2006.12,.01,1,2,"%D",1,0)
This associates the institution with a set of site paramters.
"^DD",2006.1,2006.12,.01,1,2,"DT")
3050520
"^DD",2006.1,2006.12,.01,3)
Select an Institution that is a member of the Medical Division file.
"^DD",2006.1,2006.12,.01,21,0)
^.001^3^3^3060127^^
"^DD",2006.1,2006.12,.01,21,1,0)
This set of institution values will allow users to associate
"^DD",2006.1,2006.12,.01,21,2,0)
one institutions logon to an imaging network that hosts or stores 
"^DD",2006.1,2006.12,.01,21,3,0)
the images.
"^DD",2006.1,2006.12,.01,"DT")
3060127
"^DD",2006.1,2006.12,201,0)
VISTARAD GROUPING^2006.12201P^^201;0
"^DD",2006.1,2006.12,201,21,0)
^^3^3^3060125^
"^DD",2006.1,2006.12,201,21,1,0)
This field allows multiple Institutions and/or Associated Institutions
"^DD",2006.1,2006.12,201,21,2,0)
to be grouped together within VistARad for purposes of Exam Locking
"^DD",2006.1,2006.12,201,21,3,0)
and Unread Exams lists display.
"^DD",2006.1,2006.12,201,"DT")
3060125
"^DD",2006.1,2006.1201,0)
VISTARAD GROUPING SUB-FIELD^^.01^1
"^DD",2006.1,2006.1201,0,"DT")
3060124
"^DD",2006.1,2006.1201,0,"IX","B",2006.1201,.01)

"^DD",2006.1,2006.1201,0,"NM","VISTARAD GROUPING")

"^DD",2006.1,2006.1201,0,"UP")
2006.1
"^DD",2006.1,2006.1201,.01,0)
VISTARAD GROUP^MP4'X^DIC(4,^0;1^Q
"^DD",2006.1,2006.1201,.01,1,0)
^.1
"^DD",2006.1,2006.1201,.01,1,1,0)
2006.1201^B
"^DD",2006.1,2006.1201,.01,1,1,1)
S ^MAG(2006.1,DA(1),201,"B",$E(X,1,30),DA)=""
"^DD",2006.1,2006.1201,.01,1,1,2)
K ^MAG(2006.1,DA(1),201,"B",$E(X,1,30),DA)
"^DD",2006.1,2006.1201,.01,3)
To allow reading for other institutions, enter them here.
"^DD",2006.1,2006.1201,.01,21,0)
^.001^9^9^3060125^^^^
"^DD",2006.1,2006.1201,.01,21,1,0)
A radiologist logged in to this Institution (Division) can lock
"^DD",2006.1,2006.1201,.01,21,2,0)
and interpret exams for the logon division.  When logged in to
"^DD",2006.1,2006.1201,.01,21,3,0)
this Institution, IF you want the radiologist to be able to
"^DD",2006.1,2006.1201,.01,21,4,0)
lock/interpret exams for other divisions (including Associated
"^DD",2006.1,2006.1201,.01,21,5,0)
Institutions), enter those divisions here.  Note that this setting
"^DD",2006.1,2006.1201,.01,21,6,0)
controls exam locking and updating, as well as filtering of the
"^DD",2006.1,2006.1201,.01,21,7,0)
UNREAD Exams lists to show only the Institutions that are
"^DD",2006.1,2006.1201,.01,21,8,0)
defined here.  Normally, only Associated Institutions should be
"^DD",2006.1,2006.1201,.01,21,9,0)
entered here.
"^DD",2006.1,2006.1201,.01,"DT")
3060127
"^DD",2006.1,2006.12201,0)
VISTARAD GROUPING SUB-FIELD^^.01^1
"^DD",2006.1,2006.12201,0,"DT")
3060124
"^DD",2006.1,2006.12201,0,"IX","B",2006.12201,.01)

"^DD",2006.1,2006.12201,0,"NM","VISTARAD GROUPING")

"^DD",2006.1,2006.12201,0,"UP")
2006.12
"^DD",2006.1,2006.12201,.01,0)
VISTARAD GROUP^MP4'X^DIC(4,^0;1^Q
"^DD",2006.1,2006.12201,.01,1,0)
^.1
"^DD",2006.1,2006.12201,.01,1,1,0)
2006.12201^B
"^DD",2006.1,2006.12201,.01,1,1,1)
S ^MAG(2006.1,DA(2),"INSTS",DA(1),201,"B",$E(X,1,30),DA)=""
"^DD",2006.1,2006.12201,.01,1,1,2)
K ^MAG(2006.1,DA(2),"INSTS",DA(1),201,"B",$E(X,1,30),DA)
"^DD",2006.1,2006.12201,.01,3)
To allow reading for other institutions, enter them here.
"^DD",2006.1,2006.12201,.01,21,0)
^.001^8^8^3060125^^^^
"^DD",2006.1,2006.12201,.01,21,1,0)
A radiologist logged in to this Associated Institution (Division)
"^DD",2006.1,2006.12201,.01,21,2,0)
can lock and interpret exams for the logon division.  When logged
"^DD",2006.1,2006.12201,.01,21,3,0)
in to this Institution, IF you want the radiologist to be able to
"^DD",2006.1,2006.12201,.01,21,4,0)
lock/interpret exams for other divisions (including the Parent
"^DD",2006.1,2006.12201,.01,21,5,0)
Institution or other Associated Institutions), enter those
"^DD",2006.1,2006.12201,.01,21,6,0)
divisions here.  Note that this setting controls exam locking and
"^DD",2006.1,2006.12201,.01,21,7,0)
updating, as well as filtering of the UNREAD Exams lists to show
"^DD",2006.1,2006.12201,.01,21,8,0)
only the Institutions that are defined here.
"^DD",2006.1,2006.12201,.01,"DT")
3060127
"^DD",2006.8,2006.8,0)
FIELD^^53^16
"^DD",2006.8,2006.8,0,"DDA")
N
"^DD",2006.8,2006.8,0,"DT")
3011213
"^DD",2006.8,2006.8,0,"ID",.04)
S %I=Y,Y=$S('$D(^(0)):"",$D(^MAG(2006.1,+$P(^(0),U,2),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(2006.1,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",2006.8,2006.8,0,"IX","B",2006.8,.01)

"^DD",2006.8,2006.8,0,"NM","BP WORKSTATIONS")

"^DD",2006.8,2006.8,0,"VRPK")
MAG
"^DD",2006.8,2006.8,.01,0)
NAME^RFX^^0;1^S DIC("S")="I '$O(^MAG(2006.8,""B"",X,0))" K:($L(X)>3!($L(X)<3))!($O(^MAG(2006.8,"B",X,0))) X
"^DD",2006.8,2006.8,.01,1,0)
^.1
"^DD",2006.8,2006.8,.01,1,1,0)
2006.8^B
"^DD",2006.8,2006.8,.01,1,1,1)
S ^MAG(2006.8,"B",$E(X,1,30),DA)=""
"^DD",2006.8,2006.8,.01,1,1,2)
K ^MAG(2006.8,"B",$E(X,1,30),DA)
"^DD",2006.8,2006.8,.01,3)
This must be a unique three letter name.
"^DD",2006.8,2006.8,.01,12.1)
S DIC("S")="I '$O(^MAG(2006.8,""B"",X,0))"
"^DD",2006.8,2006.8,.01,21,0)
^^2^2^2990330^^^^
"^DD",2006.8,2006.8,.01,21,1,0)
This is the three letter name beginning with "I" that is given to a
"^DD",2006.8,2006.8,.01,21,2,0)
particular workstation. This identifying name remains with the system.
"^DD",2006.8,2006.8,.01,"DT")
2950315
"^DD",2006.8,2006.8,.04,0)
PLACE^RP2006.1'^MAG(2006.1,^0;2^Q
"^DD",2006.8,2006.8,.04,1,0)
^.1^^0
"^DD",2006.8,2006.8,.04,21,0)
^^3^3^3050414^
"^DD",2006.8,2006.8,.04,21,1,0)
This field references the site parameter file. The Site parameter entry 
"^DD",2006.8,2006.8,.04,21,2,0)
defines all of the attributes of Vista Imaging local area network. This 
"^DD",2006.8,2006.8,.04,21,3,0)
includes facility user preferences, network write locations, etc.
"^DD",2006.8,2006.8,.04,"DT")
3050414
"^DD",2006.8,2006.8,11,0)
BACKGROUND PROCESSOR^SX^0:NO;1:YES;^0;12^S DIC("S")="I $L($P(^(1),U))>2" D:'X BPCLR^MAGQBUT1(DA)
"^DD",2006.8,2006.8,11,3)
Enter YES if this system is to be used as a BACKGROUND PROCESSOR
"^DD",2006.8,2006.8,11,21,0)
^^4^4^2970722^^^^
"^DD",2006.8,2006.8,11,21,1,0)
This field identifies the BACKGROUND PROCESSOR system.
"^DD",2006.8,2006.8,11,21,2,0)
If this system functions as a BACKGROUND PROCESSOR system, this
"^DD",2006.8,2006.8,11,21,3,0)
field should be set to YES.  It should
"^DD",2006.8,2006.8,11,21,4,0)
be set to NO for Imaging Workstations.
"^DD",2006.8,2006.8,11,"DT")
2990325
"^DD",2006.8,2006.8,12,0)
ABSTRACT^*SX^0:NO;1:YES;^0;13^S DIC("S")="I $$BPPS^MAGQBUT1(X,DA,""ABSTRACT"")" S:'$$BPPS^MAGQBUT1(X,DA,"ABSTRACT") $P(^MAG(2006.8,DA,0),U,13)="0"
"^DD",2006.8,2006.8,12,3)
Only one Background Processor may be assigned this ask at a time.  Retire the Abstract assignment from its current assignee then reassign.
"^DD",2006.8,2006.8,12,12.1)
S DIC("S")="I $$BPPS^MAGQBUT1(X,DA,""ABSTRACT"")"
"^DD",2006.8,2006.8,12,21,0)
^^1^1^2990401^^^^
"^DD",2006.8,2006.8,12,21,1,0)
Indicate that this BACKGROUND PROCESSOR is to create Image ABSTRACTS
"^DD",2006.8,2006.8,12,"DT")
2990326
"^DD",2006.8,2006.8,13,0)
JUKEBOX^SX^0:NO;1:YES;^0;14^S DIC("S")="I $$BPPS^MAGQBUT1(X,DA,""JUKEBOX"")" S:'$$BPPS^MAGQBUT1(X,DA,"JUKEBOX") $P(^MAG(2006.8,DA,0),U,14)="0"
"^DD",2006.8,2006.8,13,3)
Only one Background Processor may be assigned this ask at a time.  Retire the JUKEBOX assignment from its current assignee then reassign.
"^DD",2006.8,2006.8,13,12.1)
S DIC("S")="I $$BPPS^MAGQBUT1(X,DA,""JUKEBOX"")"
"^DD",2006.8,2006.8,13,21,0)
^^2^2^2970722^^^^
"^DD",2006.8,2006.8,13,21,1,0)
This field indicates that this BACKGROUND PROCESSOR is to copy
"^DD",2006.8,2006.8,13,21,2,0)
files to the JUKEBOX
"^DD",2006.8,2006.8,13,"DT")
2990325
"^DD",2006.8,2006.8,14,0)
JBTOHD^SX^0:NO;1:YES;^0;15^S DIC("S")="I $$BPPS^MAGQBUT1(X,DA,""JBTOHD"")" S:'$$BPPS^MAGQBUT1(X,DA,"JBTOHD") $P(^MAG(2006.8,DA,0),U,15)="0"
"^DD",2006.8,2006.8,14,3)
Only one Background Processor may be assigned this ask at a time.  Retire the JBTOHD assignment from its current assignee then reassign.
"^DD",2006.8,2006.8,14,12.1)
S DIC("S")="I $$BPPS^MAGQBUT1(X,DA,""JBTOHD"")"
"^DD",2006.8,2006.8,14,21,0)
^^2^2^2950328^^^^
"^DD",2006.8,2006.8,14,21,1,0)
This field indicates that this BACKGROUND PROCESSOR is to copy
"^DD",2006.8,2006.8,14,21,2,0)
files from the JUKEBOX to the HARD DISK.
"^DD",2006.8,2006.8,14,"DT")
2990325
"^DD",2006.8,2006.8,15,0)
PREFET^*S^0:NO;1:YES;^0;16^S DIC("S")="I $$BPPS^MAGQBUT1(X,DA,""PREFET"")" S:'$$BPPS^MAGQBUT1(X,DA,"PREFET") $P(^MAG(2006.8,DA,0),U,16)="0"
"^DD",2006.8,2006.8,15,3)
Only one Background Processor may be assigned this ask at a time.  Retire the PREFET assignment from its current assignee then reassign.
"^DD",2006.8,2006.8,15,12)

"^DD",2006.8,2006.8,15,12.1)
S DIC("S")="I $$BPPS^MAGQBUT1(X,DA,""PREFET"")"
"^DD",2006.8,2006.8,15,21,0)
^^2^2^3000313^^^^
"^DD",2006.8,2006.8,15,21,1,0)
This field indicates that this BACKGROUND PROCESSOR is to copy
"^DD",2006.8,2006.8,15,21,2,0)
files from the JUKEBOX to the HARD DISK .
"^DD",2006.8,2006.8,15,"DT")
3000313
"^DD",2006.8,2006.8,16,0)
IMPORT^SX^0:NO;1:YES;^0;17^S DIC("S")="I $$BPPS^MAGQBUT1(X,DA,""IMPORT"")" S:'$$BPPS^MAGQBUT1(X,DA,"IMPORT") $P(^MAG(2006.8,DA,0),U,17)="0"
"^DD",2006.8,2006.8,16,3)
Only one Background Processor may be assigned this ask at a time.  Retire the IMPORT assignment from its current assignee then reassign.
"^DD",2006.8,2006.8,16,12.1)
S DIC("S")="I $$BPPS^MAGQBUT1(X,DA,""IMPORT"")"
"^DD",2006.8,2006.8,16,21,0)
^^2^2^2970722^^^^
"^DD",2006.8,2006.8,16,21,1,0)
This field indicates that this BACKGROUND PROCESSOR is to copy
"^DD",2006.8,2006.8,16,21,2,0)
files to the IMPORT
"^DD",2006.8,2006.8,16,"DT")
3010405
"^DD",2006.8,2006.8,17,0)
GCC^*SX^0:NO;1:YES;^0;18^S DIC("S")="I $$BPPS^MAGQBUT1(X,DA,""GCC"")" S:'$$BPPS^MAGQBUT1(X,DA,"GCC") $P(^MAG(2006.8,DA,0),U,18)="0"
"^DD",2006.8,2006.8,17,12.1)
S DIC("S")="I $$BPPS^MAGQBUT1(X,DA,""GCC"")"
"^DD",2006.8,2006.8,17,21,0)
^^1^1^3011213^
"^DD",2006.8,2006.8,17,21,1,0)
Indicate that this BACKGROUND PROCESSOR is to process Generic Carbon Copies.
"^DD",2006.8,2006.8,17,"DT")
3011129
"^DD",2006.8,2006.8,20,0)
DELETE^*SX^0:NO;1:YES;^0;23^S DIC("S")="I $$BPPS^MAGQBUT1(X,DA,""DELETE"")" S:'$$BPPS^MAGQBUT1(X,DA,"DELETE") $P(^MAG(2006.8,DA,0),U,23)="0"
"^DD",2006.8,2006.8,20,3)
Only one Background Processor may be assigned this ask at a time.  Retire the DELETE assignment from its current assignee then reassign.
"^DD",2006.8,2006.8,20,12.1)
S DIC("S")="I $$BPPS^MAGQBUT1(X,DA,""DELETE"")"
"^DD",2006.8,2006.8,20,21,0)
^^1^1^2970722^
"^DD",2006.8,2006.8,20,21,1,0)
Indicates that the background Processor is to delete image files.
"^DD",2006.8,2006.8,20,"DT")
2990325
"^DD",2006.8,2006.8,24,0)
EVALUATE^S^1:Yes;0:No;^0;24^Q
"^DD",2006.8,2006.8,24,3)
Enter 'Yes' when this processor evaluates routing rules.
"^DD",2006.8,2006.8,24,21,0)
^^2^2^2990129^^
"^DD",2006.8,2006.8,24,21,1,0)
This field indicates whether or not a background processor
"^DD",2006.8,2006.8,24,21,2,0)
evaluates routing rules.
"^DD",2006.8,2006.8,24,"DT")
2981014
"^DD",2006.8,2006.8,25,0)
SEND^S^1:Yes;0:No;^0;25^Q
"^DD",2006.8,2006.8,25,3)
Enter 'Yes' when this background processor processes 'SEND' actions.
"^DD",2006.8,2006.8,25,21,0)
^^2^2^2981014^
"^DD",2006.8,2006.8,25,21,1,0)
This field indicates whether or not a background processor
"^DD",2006.8,2006.8,25,21,2,0)
processes 'SEND' actions.
"^DD",2006.8,2006.8,25,"DT")
2981014
"^DD",2006.8,2006.8,50,0)
WRKS COMPUTER NAME^F^^1;1^S DIC("S")="I '$O(^MAG(2006.8,""C"",$$PLACE^MAGBAPI(+$G(DUZ(2))),X,0))" K:($L(X)>30!($L(X)<3))!($O(^MAG(2006.8,"C",$$PLACE^MAGBAPI(+$G(DUZ(2))),X,0))) X
"^DD",2006.8,2006.8,50,1,0)
^.1^^0
"^DD",2006.8,2006.8,50,3)
The computer name defined in network properties on the workstation
"^DD",2006.8,2006.8,50,12.1)
S DIC("S")="I '$O(^MAG(2006.8,""C"",$$PLACE^MAGBAPI(+$G(DUZ(2))),X,0))"
"^DD",2006.8,2006.8,50,21,0)
^^2^2^2970722^^^
"^DD",2006.8,2006.8,50,21,1,0)
This is the computer name defined on the workstation for network operation
"^DD",2006.8,2006.8,50,21,2,0)
(i.e. the Network computer name).
"^DD",2006.8,2006.8,50,"DT")
3041022
"^DD",2006.8,2006.8,51,0)
BP CLIENT VERSION^F^^1;2^K:$L(X)>24!($L(X)<3) X
"^DD",2006.8,2006.8,51,3)
Answer must be 3-24 characters in length
"^DD",2006.8,2006.8,51,"DT")
3000208
"^DD",2006.8,2006.8,52,0)
BP CLIENT DISTRIBUTION DATE^F^^1;3^K:$L(X)>32!($L(X)<1) X
"^DD",2006.8,2006.8,52,3)
Answer must be 1-32 characters in length
"^DD",2006.8,2006.8,52,"DT")
3000204
"^DD",2006.8,2006.8,53,0)
WORKSTATION OS^F^^1;4^K:$L(X)>60!($L(X)<3) X
"^DD",2006.8,2006.8,53,3)
Answer must be 3-60 characters in length.
"^DD",2006.8,2006.8,53,"DT")
3000329
"^DD",2006.81,2006.81,.04,0)
PLACE^P2006.1'^MAG(2006.1,^1;2^Q
"^DD",2006.81,2006.81,.04,1,0)
^.1
"^DD",2006.81,2006.81,.04,1,1,0)
2006.81^C
"^DD",2006.81,2006.81,.04,1,1,1)
S ^MAG(2006.81,"C",$E(X,1,30),DA)=""
"^DD",2006.81,2006.81,.04,1,1,2)
K ^MAG(2006.81,"C",$E(X,1,30),DA)
"^DD",2006.81,2006.81,.04,1,1,"%D",0)
^^1^1^3030514^
"^DD",2006.81,2006.81,.04,1,1,"%D",1,0)
This allows the workstations to be distinguishable between sites.
"^DD",2006.81,2006.81,.04,1,1,"DT")
3030514
"^DD",2006.81,2006.81,.04,21,0)
^^3^3^3050414^
"^DD",2006.81,2006.81,.04,21,1,0)
This field references the site parameter file. The Site parameter entry 
"^DD",2006.81,2006.81,.04,21,2,0)
defines all of the attributes of Vista Imaging local area network. This 
"^DD",2006.81,2006.81,.04,21,3,0)
includes facility user preferences, network write locations, etc.
"^DD",2006.81,2006.81,.04,"DT")
3050414
"^DD",2006.82,2006.82,.04,0)
PLACE^P2006.1'^MAG(2006.1,^1;4^Q
"^DD",2006.82,2006.82,.04,3)
Select the Imaging Site Parameter entry where this image was captured.
"^DD",2006.82,2006.82,.04,21,0)
^^3^3^3050414^
"^DD",2006.82,2006.82,.04,21,1,0)
This field references the site parameter file. The Site parameter entry 
"^DD",2006.82,2006.82,.04,21,2,0)
defines all of the attributes of Vista Imaging local area network. This 
"^DD",2006.82,2006.82,.04,21,3,0)
includes facility user preferences, network write locations, etc.
"^DD",2006.82,2006.82,.04,"DT")
3050414
"^DD",2006.82,2006.82,2,0)
START^D^^0;3^S %DT="ET" D ^%DT S X=Y K:Y<1 X
"^DD",2006.82,2006.82,2,1,0)
^.1^^-1
"^DD",2006.82,2006.82,2,1,1,0)
2006.82^AC^MUMPS
"^DD",2006.82,2006.82,2,1,1,1)
S ^MAG(2006.82,"AC","L"_X,DA)=""
"^DD",2006.82,2006.82,2,1,1,2)
K ^MAG(2006.82,"AC","L"_X,DA)
"^DD",2006.82,2006.82,2,1,1,"%D",0)
^^2^2^3001025^
"^DD",2006.82,2006.82,2,1,1,"%D",1,0)
This is the Start Time of the Session.  The Index is used by lookup routines to 
"^DD",2006.82,2006.82,2,1,1,"%D",2,0)
display a list sorted by the Start Time of the Imaging Session.
"^DD",2006.82,2006.82,2,1,1,"DT")
2980914
"^DD",2006.82,2006.82,2,21,0)
^.001^1^1^3001107^^^
"^DD",2006.82,2006.82,2,21,1,0)
This the Date Time (to the minute) when this imaging session started.
"^DD",2006.82,2006.82,2,"DT")
3041027
"^DIC",2006.03,2006.03,0)
IMAGE BACKGROUND QUEUE^2006.03
"^DIC",2006.03,2006.03,0,"GL")
^MAGQUEUE(2006.03,
"^DIC",2006.03,2006.03,"%",0)
^1.005^1^1
"^DIC",2006.03,2006.03,"%",1,0)
MAG
"^DIC",2006.03,2006.03,"%","B","MAG",1)

"^DIC",2006.03,2006.03,"%D",0)
^^23^23^3010619^
"^DIC",2006.03,2006.03,"%D",1,0)
 +---------------------------------------------------------------+
"^DIC",2006.03,2006.03,"%D",2,0)
 |                                                               |
"^DIC",2006.03,2006.03,"%D",3,0)
 | Property of the US Government.                                |
"^DIC",2006.03,2006.03,"%D",4,0)
 | No permission to copy or redistribute this software is given. |
"^DIC",2006.03,2006.03,"%D",5,0)
 | Use of unreleased versions of this software requires the user |
"^DIC",2006.03,2006.03,"%D",6,0)
 | to execute a written test agreement with the VistA Imaging    |
"^DIC",2006.03,2006.03,"%D",7,0)
 | Development Office of the Department of Veterans Affairs,     |
"^DIC",2006.03,2006.03,"%D",8,0)
 | telephone (301) 734-0100.                                     |
"^DIC",2006.03,2006.03,"%D",9,0)
 |                                                               |
"^DIC",2006.03,2006.03,"%D",10,0)
 | The Food and Drug Administration classifies this software as  |
"^DIC",2006.03,2006.03,"%D",11,0)
 | a medical device.  As such, it may not be changed in any way. |
"^DIC",2006.03,2006.03,"%D",12,0)
 | Modifications to this software may result in an adulterated   |
"^DIC",2006.03,2006.03,"%D",13,0)
 | medical device under 21CFR820, the use of which is considered |
"^DIC",2006.03,2006.03,"%D",14,0)
 | to be a violation of US Federal Statutes.                     |
"^DIC",2006.03,2006.03,"%D",15,0)
 |                                                               |
"^DIC",2006.03,2006.03,"%D",16,0)
 +---------------------------------------------------------------+
"^DIC",2006.03,2006.03,"%D",17,0)
 
"^DIC",2006.03,2006.03,"%D",18,0)
 The Image Background Queue file is a holding file for all the entries to
"^DIC",2006.03,2006.03,"%D",19,0)
be processed by the Background Processor.  Entries are made by Clinical
"^DIC",2006.03,2006.03,"%D",20,0)
Capture workstation, VistARad Diagnostic workstation, DICOM Image
"^DIC",2006.03,2006.03,"%D",21,0)
gateways or the Background Gui application for functions such as copying
"^DIC",2006.03,2006.03,"%D",22,0)
file to and from the jukebox and/or magnetic drives.   The Background GUI
"^DIC",2006.03,2006.03,"%D",23,0)
application will update entries as well as remove entries from this file.
"^DIC",2006.03,"B","IMAGE BACKGROUND QUEUE",2006.03)

"^DIC",2006.031,2006.031,0)
IMAGE BACKGROUND QUEUE POINTER^2006.031
"^DIC",2006.031,2006.031,0,"GL")
^MAGQUEUE(2006.031,
"^DIC",2006.031,2006.031,"%",0)
^1.005^1^1
"^DIC",2006.031,2006.031,"%",1,0)
MAG
"^DIC",2006.031,2006.031,"%","B","MAG",1)

"^DIC",2006.031,2006.031,"%D",0)
^^47^47^3010619^
"^DIC",2006.031,2006.031,"%D",1,0)
 +---------------------------------------------------------------+
"^DIC",2006.031,2006.031,"%D",2,0)
 |                                                               |
"^DIC",2006.031,2006.031,"%D",3,0)
 | Property of the US Government.                                |
"^DIC",2006.031,2006.031,"%D",4,0)
 | No permission to copy or redistribute this software is given. |
"^DIC",2006.031,2006.031,"%D",5,0)
 | Use of unreleased versions of this software requires the user |
"^DIC",2006.031,2006.031,"%D",6,0)
 | to execute a written test agreement with the VistA Imaging    |
"^DIC",2006.031,2006.031,"%D",7,0)
 | Development Office of the Department of Veterans Affairs,     |
"^DIC",2006.031,2006.031,"%D",8,0)
 | telephone (301) 734-0100.                                     |
"^DIC",2006.031,2006.031,"%D",9,0)
 |                                                               |
"^DIC",2006.031,2006.031,"%D",10,0)
 | The Food and Drug Administration classifies this software as  |
"^DIC",2006.031,2006.031,"%D",11,0)
 | a medical device.  As such, it may not be changed in any way. |
"^DIC",2006.031,2006.031,"%D",12,0)
 | Modifications to this software may result in an adulterated   |
"^DIC",2006.031,2006.031,"%D",13,0)
 | medical device under 21CFR820, the use of which is considered |
"^DIC",2006.031,2006.031,"%D",14,0)
 | to be a violation of US Federal Statutes.                     |
"^DIC",2006.031,2006.031,"%D",15,0)
 |                                                               |
"^DIC",2006.031,2006.031,"%D",16,0)
 +---------------------------------------------------------------+
"^DIC",2006.031,2006.031,"%D",17,0)
 
"^DIC",2006.031,2006.031,"%D",18,0)
This file contains the pointers for the Imaging Background Queue file. It
"^DIC",2006.031,2006.031,"%D",19,0)
tracks the status of queue processing.
"^DIC",2006.031,2006.031,"%D",20,0)
 
"^DIC",2006.031,2006.031,"%D",21,0)
 The Background Processor uses three files:
"^DIC",2006.031,2006.031,"%D",22,0)
              1. Queue   (2006.03)
"^DIC",2006.031,2006.031,"%D",23,0)
              2. Queue Pointer   (2006.031)
"^DIC",2006.031,2006.031,"%D",24,0)
              3. Jukebox  (2006.032)
"^DIC",2006.031,2006.031,"%D",25,0)
 
"^DIC",2006.031,2006.031,"%D",26,0)
There are five different tasks that can be performed by the background
"^DIC",2006.031,2006.031,"%D",27,0)
processor:
"^DIC",2006.031,2006.031,"%D",28,0)
 
"^DIC",2006.031,2006.031,"%D",29,0)
1. ABSTRACT -- create a small version of an image
"^DIC",2006.031,2006.031,"%D",30,0)
 
"^DIC",2006.031,2006.031,"%D",31,0)
2. EXPORT ---- copy an image to an export directory so that it can be used
"^DIC",2006.031,2006.031,"%D",32,0)
outside the imaging system
"^DIC",2006.031,2006.031,"%D",33,0)
 
"^DIC",2006.031,2006.031,"%D",34,0)
3. IMPORT ----copy an image from an import directory into the imaging system
"^DIC",2006.031,2006.031,"%D",35,0)
 
"^DIC",2006.031,2006.031,"%D",36,0)
4. JUKEBOX ---copy an image from hard disk to the jukebox
"^DIC",2006.031,2006.031,"%D",37,0)
 
"^DIC",2006.031,2006.031,"%D",38,0)
5. JBTOHD ----copy an image from the jukebox to the hard disk
"^DIC",2006.031,2006.031,"%D",39,0)
 
"^DIC",2006.031,2006.031,"%D",40,0)
There is a single Input Queue file for all the requests, with a
"^DIC",2006.031,2006.031,"%D",41,0)
cross-reference to request type.  The background processor processes the
"^DIC",2006.031,2006.031,"%D",42,0)
entries in a prioritized first-in first-out fashion, and uses the Queue
"^DIC",2006.031,2006.031,"%D",43,0)
Pointer file to record its progress. The background processor uses the
"^DIC",2006.031,2006.031,"%D",44,0)
Jukebox file for device-specific information.  The jukebox platters are
"^DIC",2006.031,2006.031,"%D",45,0)
logically placed into the Network Location file, and are pointed to by the
"^DIC",2006.031,2006.031,"%D",46,0)
Jukebox file and the Image file.  Jukeboxes, which can be configured as a
"^DIC",2006.031,2006.031,"%D",47,0)
single volume, only have a single entry in the network location file.
"^DIC",2006.031,"B","IMAGE BACKGROUND QUEUE POINTER",2006.031)

"^DIC",2006.032,2006.032,0)
JUKEBOX^2006.032
"^DIC",2006.032,2006.032,0,"GL")
^MAGQUEUE(2006.032,
"^DIC",2006.032,2006.032,"%",0)
^1.005^1^1
"^DIC",2006.032,2006.032,"%",1,0)
MAG
"^DIC",2006.032,2006.032,"%","B","MAG",1)

"^DIC",2006.032,2006.032,"%D",0)
^^22^22^3010619^
"^DIC",2006.032,2006.032,"%D",1,0)
 +---------------------------------------------------------------+
"^DIC",2006.032,2006.032,"%D",2,0)
 |                                                               |
"^DIC",2006.032,2006.032,"%D",3,0)
 | Property of the US Government.                                |
"^DIC",2006.032,2006.032,"%D",4,0)
 | No permission to copy or redistribute this software is given. |
"^DIC",2006.032,2006.032,"%D",5,0)
 | Use of unreleased versions of this software requires the user |
"^DIC",2006.032,2006.032,"%D",6,0)
 | to execute a written test agreement with the VistA Imaging    |
"^DIC",2006.032,2006.032,"%D",7,0)
 | Development Office of the Department of Veterans Affairs,     |
"^DIC",2006.032,2006.032,"%D",8,0)
 | telephone (301) 734-0100.                                     |
"^DIC",2006.032,2006.032,"%D",9,0)
 |                                                               |
"^DIC",2006.032,2006.032,"%D",10,0)
 | The Food and Drug Administration classifies this software as  |
"^DIC",2006.032,2006.032,"%D",11,0)
 | a medical device.  As such, it may not be changed in any way. |
"^DIC",2006.032,2006.032,"%D",12,0)
 | Modifications to this software may result in an adulterated   |
"^DIC",2006.032,2006.032,"%D",13,0)
 | medical device under 21CFR820, the use of which is considered |
"^DIC",2006.032,2006.032,"%D",14,0)
 | to be a violation of US Federal Statutes.                     |
"^DIC",2006.032,2006.032,"%D",15,0)
 |                                                               |
"^DIC",2006.032,2006.032,"%D",16,0)
 +---------------------------------------------------------------+
"^DIC",2006.032,2006.032,"%D",17,0)
 
"^DIC",2006.032,2006.032,"%D",18,0)
The Jukebox file contains information about a jukebox(s).  Some of the
"^DIC",2006.032,2006.032,"%D",19,0)
fields are not currently used but are reserved for future development.
"^DIC",2006.032,2006.032,"%D",20,0)
 
"^DIC",2006.032,2006.032,"%D",21,0)
Please note: Review the Imaging Installation Manual for instructions on
"^DIC",2006.032,2006.032,"%D",22,0)
Jukebox installation and creating entries into this file.
"^DIC",2006.032,"B","JUKEBOX",2006.032)

"^DIC",2006.1,2006.1,0)
IMAGING SITE PARAMETERS^2006.1I
"^DIC",2006.1,2006.1,0,"GL")
^MAG(2006.1,
"^DIC",2006.1,2006.1,"%",0)
^1.005^1^1
"^DIC",2006.1,2006.1,"%",1,0)
MAG
"^DIC",2006.1,2006.1,"%","B","MAG",1)

"^DIC",2006.1,2006.1,"%D",0)
^1.001^24^24^3051025^^
"^DIC",2006.1,2006.1,"%D",1,0)
 +---------------------------------------------------------------+
"^DIC",2006.1,2006.1,"%D",2,0)
 |                                                               |
"^DIC",2006.1,2006.1,"%D",3,0)
 | Property of the US Government.                                |
"^DIC",2006.1,2006.1,"%D",4,0)
 | No permission to copy or redistribute this software is given. |
"^DIC",2006.1,2006.1,"%D",5,0)
 | Use of unreleased versions of this software requires the user |
"^DIC",2006.1,2006.1,"%D",6,0)
 | to execute a written test agreement with the VistA Imaging    |
"^DIC",2006.1,2006.1,"%D",7,0)
 | Development Office of the Department of Veterans Affairs,     |
"^DIC",2006.1,2006.1,"%D",8,0)
 | telephone (301) 734-0100.                                     |
"^DIC",2006.1,2006.1,"%D",9,0)
 |                                                               |
"^DIC",2006.1,2006.1,"%D",10,0)
 | The Food and Drug Administration classifies this software as  |
"^DIC",2006.1,2006.1,"%D",11,0)
 | a medical device.  As such, it may not be changed in any way. |
"^DIC",2006.1,2006.1,"%D",12,0)
 | Modifications to this software may result in an adulterated   |
"^DIC",2006.1,2006.1,"%D",13,0)
 | medical device under 21CFR820, the use of which is considered |
"^DIC",2006.1,2006.1,"%D",14,0)
 | to be a violation of US Federal Statutes.                     |
"^DIC",2006.1,2006.1,"%D",15,0)
 |                                                               |
"^DIC",2006.1,2006.1,"%D",16,0)
 +---------------------------------------------------------------+
"^DIC",2006.1,2006.1,"%D",17,0)
 
"^DIC",2006.1,2006.1,"%D",18,0)
The Imaging Site Parameter file contains those variables which are site
"^DIC",2006.1,2006.1,"%D",19,0)
specific, and which are necessary for the Imaging Software to perform
"^DIC",2006.1,2006.1,"%D",20,0)
properly. Most of the fields have MUMPs cross-references with which they
"^DIC",2006.1,2006.1,"%D",21,0)
are associated that are used by the software for quick access to the
"^DIC",2006.1,2006.1,"%D",22,0)
specific data. Some of the fields defined may not be in use presently, but
"^DIC",2006.1,2006.1,"%D",23,0)
are reserved for future development.  Review the Imaging Installation
"^DIC",2006.1,2006.1,"%D",24,0)
Manual for instructions on making entries into this file.
"^DIC",2006.1,"B","IMAGING SITE PARAMETERS",2006.1)

"^DIC",2006.8,2006.8,0)
BP WORKSTATIONS^2006.8
"^DIC",2006.8,2006.8,0,"GL")
^MAG(2006.8,
"^DIC",2006.8,2006.8,"%",0)
^1.005^1^1
"^DIC",2006.8,2006.8,"%",1,0)
MAG
"^DIC",2006.8,2006.8,"%","B","MAG",1)

"^DIC",2006.8,2006.8,"%D",0)
^^26^26^3010620^
"^DIC",2006.8,2006.8,"%D",1,0)
 +---------------------------------------------------------------+
"^DIC",2006.8,2006.8,"%D",2,0)
 |                                                               |
"^DIC",2006.8,2006.8,"%D",3,0)
 | Property of the US Government.                                |
"^DIC",2006.8,2006.8,"%D",4,0)
 | No permission to copy or redistribute this software is given. |
"^DIC",2006.8,2006.8,"%D",5,0)
 | Use of unreleased versions of this software requires the user |
"^DIC",2006.8,2006.8,"%D",6,0)
 | to execute a written test agreement with the VistA Imaging    |
"^DIC",2006.8,2006.8,"%D",7,0)
 | Development Office of the Department of Veterans Affairs,     |
"^DIC",2006.8,2006.8,"%D",8,0)
 | telephone (301) 734-0100.                                     |
"^DIC",2006.8,2006.8,"%D",9,0)
 |                                                               |
"^DIC",2006.8,2006.8,"%D",10,0)
 | The Food and Drug Administration classifies this software as  |
"^DIC",2006.8,2006.8,"%D",11,0)
 | a medical device.  As such, it may not be changed in any way. |
"^DIC",2006.8,2006.8,"%D",12,0)
 | Modifications to this software may result in an adulterated   |
"^DIC",2006.8,2006.8,"%D",13,0)
 | medical device under 21CFR820, the use of which is considered |
"^DIC",2006.8,2006.8,"%D",14,0)
 | to be a violation of US Federal Statutes.                     |
"^DIC",2006.8,2006.8,"%D",15,0)
 |                                                               |
"^DIC",2006.8,2006.8,"%D",16,0)
 +---------------------------------------------------------------+
"^DIC",2006.8,2006.8,"%D",17,0)
 
"^DIC",2006.8,2006.8,"%D",18,0)
This file contains all the Background Processor workstations
"^DIC",2006.8,2006.8,"%D",19,0)
used in the Imaging System.
"^DIC",2006.8,2006.8,"%D",20,0)
It points to the Hospital Location file and has other identifying fields.
"^DIC",2006.8,2006.8,"%D",21,0)
 The Imaging Workstations file is designed to track imaging workstation:
"^DIC",2006.8,2006.8,"%D",22,0)
  * locations
"^DIC",2006.8,2006.8,"%D",23,0)
  * volume set names
"^DIC",2006.8,2006.8,"%D",24,0)
  * component serial numbers
"^DIC",2006.8,2006.8,"%D",25,0)
  * display modes  
"^DIC",2006.8,2006.8,"%D",26,0)
 It points to the Hospital Location file and has other identifying fields.
"^DIC",2006.8,"B","BP WORKSTATIONS",2006.8)

**END**
**END**
