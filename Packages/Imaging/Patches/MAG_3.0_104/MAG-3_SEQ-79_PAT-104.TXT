
=============================================================================
Run Date: NOV 03, 2011                     Designation: MAG*3*104
Package : MAG - IMAGING                       Priority: Mandatory
Version : 3        SEQ #79                      Status: Released
                  Compliance Date: DEC 05, 2011
=============================================================================

Associated patches: (v)MAG*3*83    <<= must be installed BEFORE `MAG*3*104'
                    (v)MAG*3*93    <<= must be installed BEFORE `MAG*3*104'
                    (v)MAG*3*115   <<= must be installed BEFORE `MAG*3*104'

Subject: Dept. of Defense (DoD) - Central Vista Imaging Exchange (CVIX)

Category: 
  - Enhancement (Mandatory)
  - Routine
  - Other

Description:
============

 Patch 104 Overview:
 ===================
 
 This document describes Imaging Patch MAG*3.0*104, which updates the Central 
 VistA Imaging Exchange (CVIX) and VistA Image Exchange (VIX) servers. 
 MAG*3.0*104 is part of the image sharing initiative to fulfill the 
 congressionally mandated exchange of medical images between the Department of 
 Veterans Affairs (VA) and the Department of Defense (DoD). 
 
 Implementing this patch will:
 
 *     Expand VA/DoD image sharing to provide VA access to DoD medical 
       artifacts such as non-radiology medical images, scanned documents, and 
       Neurocognitive Assessment Tool (NCAT) reports.
 
 *     Expand VA/DoD image sharing to provide DoD access to VA non-radiology 
       images. 
 
 *     Allow a site VIX to make a single query for DoD artifacts and radiology 
       images through the CVIX. The CVIX handles retrieving the needed data
       from the various DoD servers, and return a single combined response to a 
       VA site's VIX.
 
 *     Insulate the VIX from changes in the DoD information sharing architecture 
       as it continues to evolve from its original conception (National Defense 
       Authorization Act (NDAA)), near-term solution (Health Artifact and Image 
       Management Solution (HAIMS)), and final form (HAIMS II).
 
 *     Correct an issue that prevented VIX installation at integrated sites 
       using 4 character station numbers, and allow full use of VIXes at 
       consolidated VA sites (that is, non-primary divisions with local image 
       storage).
 
 *     Improve the performance and credentialing mechanisms for the existing 
       VA/DoD radiology image sharing established in MAG*3.0*83.
 
 *     Resolve certain issues by updating to a newer version of the Laurel 
       Bridge DCF (DICOM Connectivity Framework) toolkit.
 
 These changes are described in detail on the Patch 104 Changes Section. 
 
 For installation information, refer to the Installation Section.
 
 Note   All sites running Imaging 3.0 must install the Kernel Installation 
         & Distribution System (KIDS) portion of this patch. 
 
 Note   Sites that have implemented the MAG*3.0*83 VIX must install the updated 
         VIX software included with this patch. 
 
 Distribution of Software:
 =========================
 
 Imaging Patch 104 can be downloaded from: 
 
        ftp.imaging.med.va.gov/Software/Released_Software/Mag3_0P104
 
 Note   Any late-breaking news about this patch will be found in a readme 
         file. If present, this file will also be located in the ../MAG3_0P104 
         directory.
 
 Patch Contents:
 ===============
 
 This patch includes the following files:
 
 Software:
 =========
 
 MAG3_0P104.KID - KIDS package to be installed on the VistA System.
 
 MAG3_0P104_VIX_Setup.msi - Installation file for the VIX software. 
 
 Note   The CVIX software is not distributed with this patch; it is installed 
         in VA data centers co-resident with the Bidirectional Health 
         Information Exchange (BHIE) framework. The CVIX software is centrally 
         updated on release of this patch; pre-existing MAG*3.0*83 VIXes are 
         compatible with the MAG*3.0*104 CVIX.
 
 Documentation:
 ==============
 
      MAG3_0P104_Patch_Description.pdf - Patch Description.
 
      MAG_VIX_admin_guide.pdf - Revised VIX Administrator's Guide. 
 
      MAG_VIX_installation_guide.pdf - New VIX Installation Guide.
  
      MAG3_0P104_Technical_Manual_changes.pdf - Technical Manual change pages
      for this patch.
 
      MAG3_0P104_Install_Guide_changes.pdf - Installation Guide change pages
      for this patch. 
 
      MAG3_0P104_Security_Guide_changes.pdf - Security Guide change pages for
      this patch. 
 
 Associated Patches:
 ===================
 
 Before the MAG*3.0*104 KIDS file is installed, the following patches must be 
 installed: 
 
        MAG*3.0*93
        MAG*3.0*83
        MAG*3.0*115
 
 Note   Certain capabilities of Patch MAG*3.0*104 are not available unless 
         MAG*3.0*117 is installed as well.
 
 For a list of all released Imaging (MAG) patches, refer to the patch_list.txt
  file available on the Imaging FTP server (go to ftp://ftp.imaging.med.va.gov, 
 and then navigate to the \Docs\Imaging_Docs_Latest folder). 
 
 Test Sites:
 ===========
 
 This patch has been tested at the following sites:
  
      Fayetteville VA Medical Center (large)
      North Chicago VA Medical Center (medium)
      Ralph H. Johnson VA Medical Center - Charleston (large)
      VA Heartland - East (integrated)
      VA Heartland - West (integrated)
      VA Gulf Coast Veterans Health Care System - Biloxi  (large)
      VA Montana HCS -Ft. Harrison (integrated)
      Washington DC VA Medical Center (large)
  
 Remedy Calls:
 =============
 
 The following Remedy tickets are addressed in this patch:
 
 Ticket 479857
 Problem:  Increase in Jukebox pulls after VIX
 Solution: Add new parameter to MAGJ RADCASEIMAGES RPC to prevent unneeded 
           retrieves.
 
 Ticket 479913
 Problem:  VIX not starting after installation
 Solution: Modify installer to allocate sufficient memory on servers with more
           than 4 GB RAM.
 
 NSRs:
 =====
 
 The following New Service Request (NSR) is associated with this patch:
 
 20091208 - NCAT Data from DoD to VA: grant authorized VA users access to DoD 
            NCAT data for shared VA/DoD patients.
 
 Patch 104 Changes:
 ==================
 
 CVIX Changes:
 =============
 
 The CVIX (Centralized VIX), introduced in MAG*3.0*105, is a special 
 implementation of the VIX (VistA Imaging Exchange service). The CVIX is 
 deployed in the VA annex of the Philadelphia Sungard Spring Garden data 
 center.
 
 In MAG*3.0*104, the role of the CVIX is being expanded as described below. 
 The changes described in this section do not require any VA site action or 
 configuration changes.
 
 Expanded VA/DoD Image Exchange:
 ===============================
 
 When this patch is implemented, the CVIX will serve as the gateway for all 
 VA/DoD image and document exchanges.
 
 *     The CVIX extends VA/DoD image exchange to include non-radiology medical
       images, scanned documents, and PDF files such as DoD NCAT reports.  Use 
       of this functionality requires the Patch 117 clinical display client. 
 
 *     The CVIX extends VA/DoD image exchange to include more types of 
       radiology images. See the Appendix on page 15 for details.
 
 *     VA clinicians at sites that have implemented a MAG*3.0*104 VIX will be 
       able to retrieve the types of images described above from DoD facilities
       that are part of the El Paso/NDAA data sharing program as well as the 
       pending DoD HAIMS system.
 
 *     If not all of a DoD patient's data can be retrieved from applicable DoD
       servers because of network or connection issues, the CVIX will indicate
       that the data is incomplete when passing the data to a local site VIX.
 
 *     DoD clinicians will be able to receive the new documents and images 
       described above from all VA sites. Image requests are logged in the 
       IMAGE ACCESS LOG file (#2006.95) at the VA site where the images reside.
 
 Credentialing and CVIX Performance Improvements:
 ================================================
 
 *     When a DoD provider requests a VA radiology image, the request will now
       be sent to the CVIX before being passed to a VA site VIX. This allows 
       provider credentialing to be handled by the Station 200 VistA system, 
       and eliminates the need for VA sites to create a service account for DoD
       clinician access, as was done for MAG*3.0*83.
 
 *     The CVIX will be reconfigured as a load-balanced cluster to achieve the 
       scalability and reliability required by an enterprise gateway. 
 
 *     The CVIX will provide an additional layer of caching to reduce 
       unnecessary network traffic.
 
 Note   Because NCAT report identifiers are set dynamically at their source, 
         retrieval of previously requested NCAT reports from the VIX or CVIX 
         cache is not possible. NCAT reports are always retrieved from their 
         source as needed. This only applies to NCAT reports, and not to other 
         types of data from the DoD.
 
 Host VistA Site Service on CVIX:
 ================================
 
 The VistA Site Service (used by the VIX and other Imaging components to 
 connect to other sites) has been integrated with the CVIX for improved 
 availability. This change is transparent to the VIX and other Imaging 
 components, and no local configuration changes are needed for this.
 
 VIX Changes:
 ============
 
 The following changes have been made to the VIX service. Sites must implement
 the MAG*3.0*104 VIX to take advantage of these changes.
 
 Provide DoD Artifacts to Clinical Display Users:
 ================================================
  
 Implementing a MAG*3.0*104 VIX and MAG.3.0*117 Clinical Display gives VA 
 clinicians access to DoD artifacts and NCAT reports. 
 
 This process is triggered when a clinician uses Clinical Display's Remote 
 Image Views capability to connect to the DoD. Connecting to the DoD triggers 
 a single query for both radiology images and artifacts to the local VIX. The 
 VIX will forward the request to the CVIX for processing, and will pass the 
 results returned by the CVIX back to Clinical Display.
 
 Improved VA/DoD Radiology Image Sharing:
 ========================================
 
 The VIX will no longer communicate directly with the BIA to retrieve DoD 
 radiology images. Instead, when a VA clinician requests a DoD radiology image,
  the VIX will forward the requests to the CVIX for processing and will pass 
 the results returned by the CVIX back to Clinical Display or VistARad. 
 Likewise, all DoD requests for VA radiology images will be sent to the CVIX, 
 and the CVIX will query VA sites as needed.
 
 This change will:
 
 *     Reduce the timeouts some VA sites experience when attempting to retrieve
       DoD radiology images.
 
 *     Eliminate the need to have a manually configured VA service account for 
       VA/DoD image sharing.
 
 Improved Integrated/Consolidated Site Support:
 ==============================================
 
 *    The MAG*3.0*104 VIX can now be installed at sites that use station 
      numbers (as defined in the INSTITUTION file (#4)) with four or more 
      characters. Previously the VIX presumed the use of 3-digit station 
      numbers.
 
 *     When Clinical Display and VistARad are used for remote image retrieves 
       at a consolidated site, the VIX at the local division will now be used,
       rather than routing image retrieves though the VIX at the primary site.
 
 Note   This capability presumes MAG*3.0*117 Clinical Display (or later) 
         and/or MAG*3.0*90 VistARad (or later).
 
 Updated Laurel Bridge DCF Toolkit:
 ==================================
 
 The MAG*3.0*104 VIX uses an updated version (3.3.22c) of the Laurel Bridge 
 DICOM Connectivity Framework (DCF) Toolkit. 
 
 *     Laurel Bridge has implemented a new licensing method for this toolkit. 
       For information about updating the licenses of an existing VIX or about
       getting new licenses for a first-time VIX implementation refer to the 
       VIX Installation Guide distributed with this patch. 
 
 Note   The new licensing method requires that the VIX has access to the 
         Laurel Bridge site at  https://192.131.14.9. If this site is blocked,
         you can submit a Remedy ticket to have your facility's ACL (access 
         control lists) modified.
 
 *     The updated toolkit also addresses an issue that triggered questionable 
       integrity warnings in remote images retrieved through a VIX. This issue
       was limited to images that are stored originally as DICOM encapsulated 
       JPEG, that had patient information changes, and that were sent to remote
       sites by a VIX.
 
 New VIX Transaction Log Archiving Service:
 ==========================================
 
 MAG*3.0*104 introduces a new VIX Log Collector service that backs up site VIX 
 transaction logs.  The log collector service is deployed on and stores the 
 backed-up logs on a VA data center server. The log collector service uses 
 VistA site service to identify the VIXes (and any CVIXes) that logs need to be
  collected from.
 
 Each day, one day's worth of entries that are more than 48 hours old are 
 collected. For example, on Monday, the Log Collector service will collect all 
 VIX log entries from the previous Saturday.
 
 The VIX Log Collector service does not require any site-level or local VIX 
 configuration.
 
 Improved Exception Handling:
 ============================
 
 *     If the VIX cannot retrieve data from all locations where a patient has 
       been seen, the VIX will pass a "partial results  flag back to the 
       requesting system (such as Clinical Display).  For details about how 
       Clinical Display handles this information, see the MAG*3.0*117 Patch 
       Description.
 
 *     The VIX transaction logs have been modified to include additional 
       information for improved troubleshooting.
 
 Additional Changes:
 ===================
 
 *     In addition to Windows Server 2003 x32, the VIX now supports Windows 
       Server 2008 R2 x64.
 
 *     The VIX now requires the Microsoft Visual C++ 2005 SP1 Redistributable 
       Package (x86) to support the updated Laurel Bridge Toolkit included in 
       MAG*3.0*104. Information about downloading this package is covered in 
       the installation section.
 
 *     The VIX dependency for J# has been removed from the VIX installer; J# 
       no longer needs to be pre-installed on servers where the VIX will be 
       installed. 
 
 *     An issue that prevented the VIX installer from properly allocating 
       memory for the bundled Java Runtime Environment has been corrected. This
       issue was limited to servers that had more than 4 GB of memory (Remedy 
       #479913).
 
 *     The VIX now provides DoD data used by VistARad to populate the "Site  
       column in  VistARad's patient exams list.  Previously, this data was not
       provided by the VIX even if it was available from the DoD.  This change 
       does not require any VistARad software or configuration changes to 
       implement.
 
 VistA Changes:
 ==============
 
 MAG*3.0*104 includes a KIDS package to be installed on the VistA System. This 
 KIDS must be installed by all sites, even those that have not deployed a VIX.
 
 
 Data Dictionaries:
 ==================
 
 There are no new or modified data dictionaries in this patch.
 
 Security Keys:
 ==============
 
 There are no new or modified security keys in this patch.
 
 Remote Procedures:
 ==================
 
 There are no new or modified Remote Procedures.
 
 Menu Options:
 =============
 
 There are no new or modified menu options in this patch.
 
 Templates:
 ==========
 
 There are no new or modified templates in this patch.
   
 Installation:
 =============
 
 All sites must install the KIDS portion of this patch. The MAG*3.0*104 KIDS 
 can be loaded while VistA Imaging System is active. Installing the KIDS will 
 take less than one minute.
 
 Before installing this patch:
 
 *     Download the MAG*3.0*104 files from the Imaging FTP site to a local 
       storage location.
 
 *     Verify that required patches and any optional patches that support 
       desired or needed features have been installed. For a summary of 
       associated patches, see page 2.
 
 After the KIDS portion of this patch is installed, sites with an existing VIX
  will need to update their VIX and request updated Laurel Bridge licenses. For
  detailed information, refer to the VIX Installation Guide.
 
 Note   The MAG*3.0*83 VIX can be used after the KIDS for MAG*3.0*104 is 
         installed, but most changes described in this document will not take 
         effect until after the VIX is updated to MAG*3.0*104.
 
 Note   After a MAG*3.0*83 VIX has been updated to MAG*3.0*104, the VistA 
         service account established for the MAG*3.0*83 VIX  can be removed. It
         is recommended to wait until the MAG*3.0*104 VIX has been in place 
         with no issues before removing this account.
 
 KIDS Installation:
 ==================
 
 All sites must install the KIDS portion of this patch. 
 
 Installing the KIDS Package:
 ============================
 1.     Access the Kernel Installation and Distribution System Menu [XPD MAIN].
 
 2.     Run the Installation option [XPD INSTALLATION MENU].
 
 3.     Load the KIDS file by performing the following steps.
 
        a)  Run the Load a Distribution option [XPD LOAD DISTRIBUTION] to load 
           the KIDS distribution.
 
        b)  When prompted, enter the path and file name (MAG3_0P104.KID) of the 
           Patch 104 KIDS file that you downloaded from the Imaging FTP server.
 
        c)  When prompted to continue with the load, enter YES. A Distribution 
           OK! message will be displayed when the load is complete.
 
 4.     After loading the KIDS file, use the following options if you need to 
        verify the contents of the patch and to back up any affected routines.
 
            Verify Checksums in Transport Global [XPD PRINT CHECKSUM]   run 
            this option to ensure the integrity of the routines in the patch. 
 
            Compare Transport Global to Current System [XPD COMPARE TO SYSTEM] 
              run this option to view all changes that will be made when the 
            patch is installed. All components (routines, options, and so on) 
            in the patch will be compared.
 
            Backup a Transport Global [XPD BACKUP]   run this option to create 
            a backup message of any routines exported with the patch. It will 
            NOT back up any of the other changes.
 
 5.     After performing the load and any optional verification steps, perform 
        the following steps to install the KIDS file:
 
        a)  Run the Install Package(s) option [XPD INSTALL BUILD].
 
        b)  When prompted for the install name, enter MAG*3.0*104.
 
        c)  Answer NO to the following prompts:
 
           Want KIDS to INHIBIT LOGONs during the install? No//NO
           Want to DISABLE Scheduled Options, Menu Options, and Protocols? //NO
 
 
 6.     When installation has finished, an Install Complete message will be 
        displayed.
 
 Sample KIDS Installation:
 =========================
 
 The sample installation below illustrates the installation of the MAG*3.0*104 
 KIDS. 
 
 Select OPTION NAME: XPD MAIN  Kernel Installation & Distribution System
 
           Edits and Distribution ...
           Utilities ...
           Installation ...
           Patch Monitor Main Menu ...
 
 Select Kernel Installation & Distribution System Option: Installation
 
    1      Load a Distribution
    2      Verify Checksums in Transport Global
    3      Print Transport Global
    4      Compare Transport Global to Current System
    5      Backup a Transport Global
    6      Install Package(s)
           Restart Install of Package(s)
           Unload a Distribution
 
 Select Installation Option: 6  Install Package(s)
 Select INSTALL NAME: MAG*3.0*104      7/12/11@14:56:44
      => VistA Imaging V3.0 - Patch 104 - 07/12/2011 10:38AM  ;Created o
 
 This Distribution was loaded on Jul 12, 2011@14:56:44 with header of 
    VistA Imaging V3.0 - Patch 104 - 07/12/2011 10:38AM  ;Created on Jul 1
 2, 2011@10:38:15
    It consisted of the following Install(s):
     MAG*3.0*104
 Checking Install for Package MAG*3.0*104
 
 Install Questions for MAG*3.0*104
 
 Want KIDS to INHIBIT LOGONs during the install? NO// <enter>
 Want to DISABLE Scheduled Options, Menu Options, and Protocols? NO// <enter> 
 
 Enter the Device you want to print the Install messages.
 You can queue the install by enter a 'Q' at the device prompt.
 Enter a '^' to abort the install.
 
 DEVICE: HOME//   TELNET
  
  Install Started for MAG*3.0*104 : 
                Jul 12, 2011@14:56:49
  
 Build Distribution Date: Jul 12, 2011
  
  Installing Routines:
                Jul 12, 2011@14:56:49
  
  Running Pre-Install Routine: PRE^MAGIP104
 
  Running Post-Install Routine: POS^MAGIP104
 
  Updating Routine file...
 
  Updating KIDS files...
 
  MAG*3.0*104 Installed. 
                Jul 12, 2011@14:56:49
  
 Install Completed 
  Install Message sent #32579
 
 Appendix-DICOM Image Support:
 =============================
 
 MAG*3.0*83 supported VA/DoD radiology image exchange for a subset of radiology
 images based on DICOM modality type. In MAG*3.0*104, the types of radiology 
 images that can be exchanged has been significantly expanded.
 
 VA DICOM Provided to DoD:
 =========================
 
 DoD clinicians can request the following types of radiology exams from the VA 
 through the CVIX (the asterisks indicate identifiers supported in the previous
 VIX patch):
 
 VA DICOM Objects Provided to DoD:
 (For more information on the DICOM objects please refer to Patch Description 
 in the Appendix Section).
 
 DoD DICOM Provided to VA:
 =========================
 
 Study information (including reports) for studies associated with all DICOM 
 modality types can be retrieved from the DoD through the CVIX. 
 
 However, for certain DICOM object types, the associated objects are not 
 actually images and Clinical Display and VistARad cannot display them.. For 
 these types of DICOM studies, the VIX will provide the metadata (including 
 reports) but will not provide the image counts and/or image locations. The VIX
  only does this for following DICOM modality types, and only if the data 
 originates from the DoD:
 
 DoD objects not displayable at the VA (metadata and reports remain accessible):
 (For more information on DoD Objects please refer to the Patch Description in
 ithe Appendix Section)
 
 Routines:
 =========
 
 For each routine, the second line contains the following information: 
 
 ;;3.0;IMAGING;**[Patch List]**;MAR 19, 2002;;Build 2225;Jul 12, 2011
 
 New and modified routines for the VistA System are listed below. 
 
 CHECK1^XTSUMBLD is used to generate the checksums. Note that the "before  
 checksum may differ if any test software has been installed.
 
 MAGIP104 is a post-installation routine and is deleted after the is KIDS 
 installed.
 

Routine Information:
====================
The checksums below are new checksums, and
 can be checked with CHECK1^XTSUMBLD.

Routine Name: MAGDQR21
    Before:B147169782   After:B159758067  **83,104**
Routine Name: MAGIP104
    Before:       n/a   After:  B4514377  **104**
Routine Name: MAGJEX1
    Before: B78821225   After: B67789912  **16,22,18,65,101,115,104**
Routine Name: MAGJEX1B
    Before: B30045444   After: B25186309  **16,22,18,65,76,104**
Routine Name: MAGJUTL2
    Before: B48913977   After: B45983614  **18,65,76,104**
Routine Name: MAGJUTL5
    Before: B33147179   After: B38131193  **65,76,101,90,115,104**
 
Routine list of preceding patches: 83, 115

=============================================================================
User Information:
Entered By  : TROMBETTA,KATHY               Date Entered  : MAR 10, 2009
Completed By: CASUGAY,ELSIE G               Date Completed: NOV 03, 2011
Released By : FUGETT,BRENT                  Date Released : NOV 03, 2011
=============================================================================


Packman Mail Message:
=====================

No routines included
