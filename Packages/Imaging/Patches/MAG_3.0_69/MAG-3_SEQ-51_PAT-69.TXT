
=============================================================================
Run Date: NOV 07, 2007                     Designation: MAG*3*69
Package : MAG - IMAGING                       Priority: Mandatory
Version : 3        SEQ #51                      Status: Released
                  Compliance Date: FEB 05, 2008
=============================================================================


Subject: DICOM MSM TO CACHE CONVERSION

Category: 
  - Routine
  - Data Dictionary
  - Enhancement (Mandatory)

Description:
============

 This patch implements a decision from VA management to replace MSM with
 CACHE.  The following functional enhancements are also included that allow
 large images to be stored and displayed in the VistA Imaging Clinical
 Display:
  
 - Improved image quality of Targa images.
 - Improved image quality of Abstract images.
 - Addition of Reduction Factors for DICOM (Digital Imaging and 
   Communications in Medicine) images larger than 4192 x 4192 resolution.
 - All Targa images now contain even number of Columns.
 - No longer an image size restriction to create a Targa file.
  
 Installation Instructions:
 ==========================                                                
      
 Detailed patch information and installation instructions can be found in 
 the MAG3_0P69 Patch Description.  Any late-breaking news about this patch
 will be found in a readme file.  If present, this file will also be 
 located in the MAG3_0P69 directory.
  
 NOTE:  All sites running VistA Imaging 3.0 that have implemented DICOM 
 Gateways must install both the KIDS portion on their VistA system and the
 client portions of this patch on all relevant client systems.
                                                                                 
 This patch can be downloaded from:
 ==================================                                        
      
 ftp.imaging.med.va.gov/Software/Released_Software/Mag3_0P69 
  
 Terms of Use
 ============
  
 FDA (Food and Drug Administration) regulations require that each Imaging 
 software distribution is documented and tracked by the VistA Imaging project.  
  
 To receive this patch, sites must have a Site Agreement filed with and approved
 by the VistA Imaging Group.
  
 For information about the status of a Site Agreement, contact the VistA Imaging 
 Distribution Manager via email (VHAVISiteFeedback@va.gov).
  
 Patch Contents:
 ===============
  
 Patch 69 includes the following files:
  
 Software:
 =========
 - MAG3_0_DICOM_SetUp.exe - This file contains all that is needed to install 
   Patch 69 and can be used for an installation on the Imaging DICOM gateways.
 - MAG_Decompressor_Setup.exe - Installation Program for Automated Decompression 
   Service.
 - MAG3_0P69.KID - KIDS (Kernel Installation & Distribution System) package to 
   be installed on the VistA system.
  
 Documentation:
 ==============
 - MAG3_0P69_Patch_Description.pdf 
 - MAG3_0P69_Change_Pages_TechManual.pdf - Technical Manual change pages 
   for this patch.  
 - MAG_DICOMig.pdf - Imaging DICOM Gateway Installation Guide updated for 
   Patch 69.
 - MAG_DICOMug.pdf - Imaging DICOM Gateway User Manual updated for Patch 
   69.     
 - MAG_IMGerrormsg.pdf - Imaging Error Message Guide updated for Patch 
   69.   
  
  
 Associated Patches:
 ===================
  
 All released VistA Imaging patches are required before Patch 69 can be 
 installed. For a list of all released Imaging (MAG) patches, refer to the 
 patch_list.txt file available on the Imaging FTP server (go to 
 ftp://ftp.imagin.med.va.gov, then navigate to the \Docs\Imaging_Docs_Latest 
 folder).
  
 Associated Remedy Tickets: 
 ==========================  
  
 # 67983: Interface Vidar Digitizer to VistA Imaging.
 # 68150: DCMToTGA converter on the DICOM Gateway cannot handle a 41MB SC image 
   from a Vidar Film Digitizer.
 # 68538: Images from CR device are greater than 4095 pixel columns.
 # 101973: Images received from the Fuji CR modality generated images that are 
   greater than 4095 pixel columns.
 # 129531: Configuration issue no longer reproducible after installation of 
   patch 69.
 # 148430: The images are being displayed diagonally. 
   Image quality problems for MAG_DCMtoTGA.exe were discovered during Patch 51 
   Beta Testing.  This executable was removed from Patch 51 before release. 
   Image quality problems for MAG_AbstrTGA.exe were discovered during Patch 51 
   Beta Testing.  This executable was removed from Patch 51 before release.
 # 164276: Unable to view images through VistA Imaging.
 # 165565: DICOM Image Error, directory problem with temp Targa image file (3).
 # 166321: DOS Error, program terminated due to error #5.
 # 173114: Receiving the following error on the DICOM gateway VistA Imaging 
   server: Temporary Targa file has zero link.
 # 173154: MAG_MakeAbs.exe is not installed correctly (Temple, Central Texas).
 # 173217: Gateway errors from the CR X-Ray machines.
 # 173218: CR and DR images are generating too slow in VistA Imaging.
 # 173227: Need to wait between starting C-Store listeners.
 # 173877: Ability to have multiple Modality Worklist listeners no longer 
   available.
 # 175415: DICOM Image Process Error- won't process images.
 # 176078: Reports a problem with images skewing on a new Phillips DX system.
 # 176523: Image distorted using VistA Imaging Display.
 # 177309: Incorrect parameters in the Modality.DIC files.
 # 182070: Issue with corrupt images.
 # 182631: CT image that fails to convert from TGAtoDCM from reconstruction.
 # 185627: New AGFA SOLO CR device on station.
 # 185886: DICOM Processing Error, the gateways are down.
 # 187634: Image has ZERO LENGTH.
 # 190466: Unable to validate SOP class of request.
 # 192184: VistARAD Routing Hanging.
 # 203321: ^TMP fills up database
  
 Associated E3Rs:
 ================
  
 IMGT200000976: Reduction factors (for the modality.dic file) greater than 8:1 
                for larger images.  The intended goal is to have an approximatel
                1MB Targa file for Clinical Display.
 IMGT200001186: Allow more reduction factors for dcmtotga.exe
  
 Test Sites: 
 ===========
  
 The following sites are test sites for this patch:
  
 Charleston, SC (Large)
 Fayetteville, NC (Medium)
 Loma Linda, CA (Large)
 St. Louis, MO (Integrated)
 VISN2 (Integrated)
 White River Junction, VT (Medium)
  
 Patch Changes:
 ==============
  
 Patch 69 updates the operating platform for the VistA Imaging DICOM Gateway 
 application. 
  
 From the perspective of an end-user, the only changes that this patch brings 
 about are:
        - how the patch is installed
        - how the MUMPS server is started
  
 To ensure that the DICOM Gateway behaves the same using the Cache 
 platform as it did using the MSM platform, and to ensure that the 
 automated installation procedure for Cache will operate in a fashion 
 similar to the one for MSM, a number of MUMPS routines have been 
 changed to adapt to the platform change.
  
 Specific Changes:
 =================
  
 DICOM Gateway Setup
  
 - The various programs that are involved in the set-up of the DICOM 
 Gateway are replaced by one single InstallShield executable. 
  
 General:
 ========
  
 - Error trapping in the main menu was changed so that the Cache error 
   logger is called in such a way that control is returned to the menu 
   after an error is logged.  Also, the value of $ECode is set to empty 
   before the Cache error logger is invoked.
  
 - The ET-Phone-Home feature was modified to include information from 
   the Cache error log.
  
 - Two menu options were removed (4-3-5: Check Available Space in MUMPS
   Database and 4-3-6: Check Available Disk Space). These menu options 
   invoked MSM-specific utility programs for which there is no Cache 
   equivalent.
  
 - The software for the "import master file" feature was changed so 
   that all messages are displayed using ^MAGDMLOG, and so that no 
   interactive questions are asked when these programs are called 
   "from the background".  This makes it possible to call the software 
   for this feature from the automated installation program.
  
 - DICOM Gateways now use one of the "virus checking" e-mail post-
   offices for sending SMTP mail. Menu option 4-2-2 (Configure DICOM 
   Gateway Parameters) has been enhanced to support this directive. 
   (See the VistA Imaging DICOM Gateway User Manual for more details.)
  
 Image Gateway:
 ==============
  
 - The program that converts DICOM files to Targa format 
   (MAG_DCMtoTGA.exe) now applies reduction factors greater than 8.  
   This gives the ability to reduce images greater than 4Kx4K resolution 
   to a reasonable size for display by the Clinical Display.
  
      - R16 - 4x4 pixels ? 1 pixel (16 bits)
      - R32 - 4x4 pixels ? 1 pixel (8 bits)
  
 - The program that converts DICOM files to Targa format 
   (MAG_DCMtoTGA.exe) originally contained an image size limit of 4095 
   columns.  This limit was removed.  MAG_DCMtoTGA.exe now handles images 
   of any size.
  
 - The program that converts DICOM files to Targa format 
   (MAG_DCMtoTGA.exe) now creates images with an even number of columns, 
   regardless of how the image was processed.
  
 - The program that converts DICOM files to Targa format 
   (MAG_DCMtoTGA.exe) improves image quality where necessary.
  
 - The program that converts DICOM files to Targa format 
   (MAG_DCMtoTGA.exe) contained a bug discovered during beta testing of 
   Patch 51.  This bug had a pixel byte shift of 1 bit greater than 
   needed.  Thus, each pixel only contained 7 bits of data, not 8 bits.  
   This bug has been corrected.
  
 - The program that creates an Abstract file from the Targa file 
   (MAG_AbstrTGA.exe) improves image quality where necessary.
  
 - The program that creates an Abstract file from the Targa file 
   (MAG_AbstrTGA.exe) contained a bug discovered during beta testing of 
   Patch 51.  This bug had a pixel byte shift of 1 bit greater than 
   needed.  Thus, each pixel only contained 7 bits of data, not 8 bits.  
   This bug has been corrected.
  
 Text Gateway:
 =============
  
 - A new field is added to support WorkList queries on multiple TCP/IP 
   ports. In MSM, this functionality was configured through the MSM 
   "^SYSGEN" facility, in Cache this functionality is configured through 
   the DICOM Gateway application.
  
 - The system start-up program ^ZSTU uses the information in this new 
   field to start up "listeners" for all configured ports.
  
 - The software for menu option 4-2-2 (Configure DICOM Gateway 
   Parameters) is enhanced to support data-entry for this new field.
  
 Routing:
 ========
  
 - No changes
  
 Routine Summary:                        
 ================
  
 VistA Routines:
 ===============
  
 Other than the standard post-init routine, there are no new or 
 modified routines for VistA included in this patch.  Checksums are 
 calculated using the Kernel utility program CHECK^XTSUMBLD
  
         <tab>**[patch list]**;01-August-2007
  
 Routine                        
 Name      Before       After       Patch List
 MAGIPS69   new         5182371         **69**
  
 Routine MAGIPS69 is an installation routine that will be automatically 
 deleted after the KIDs installation.
  
 DICOM Gateway Routines:
 =======================
 New and modified routines for the Imaging DICOM Gateway are listed 
 below. For each routine, the second line will contain the following 
 information.
        <tab>**[patch list]**;01-August-2007
  
 Checksums are calculated using the Kernel utility program 
 CHECK^XTSUMBLD
  
 Routine         Before          After           Patch List
 MAGDACP1        13082461        13178335        **21,11,30,51,69**
 MAGDACP3        12867430        13191393        **30,69**
 MAGDBB          14376269        10245284        **9,10,11,30,51,69**
 MAGDBB2         new             6945759         **69**
 MAGDCIGL        new             6211109         **69**
 MAGDCIRL        new             6989334         **69**
 MAGDCST4        9397018         9608304         **10,11,30,51,69**
 MAGDDEL2        9198439         9332913         **10,11,51,69**
 MAGDEXC2        14237154        14725338        **11,69**
 MAGDGEX1        16529907        16837046        **11,30,51,50,69**
 MAGDIW3         6806486         7253705         **10,30,50,69**
 MAGDIW3A        15371109        15507879        **50,69**
 MAGDMENA        13188023        12906353        **9,21,10,11,30,69**
 MAGDMENO        11597436        11564776        **11,30,51,50,69**
 MAGDMENU        11739707        12112294        **9,21,11,30,51,69**
 MAGDMFB         7528731         11882622        **9,21,11,30,50,69**
 MAGDMFB1        16914544        17556286        **9,21,11,30,51,69**
 MAGDMFB2        11582703        11387457        **21,30,51,69**
 MAGDMFB3        9584475         10888355        **30,69**
 MAGDMFB4        6061587         6154458         **30,69**
 MAGDMFB5        8114945         8379729         **30,69**
 MAGDMFB6        7413233         7800123         **30,69**
 MAGDMFB7        10095497        8365084         **10,30,50,69**
 MAGDMFB9        7773766         8134459         **11,30,69**
 MAGDMFBA        6836769         6656306         **30,69**
 MAGDMFBB        13497051        12778786        **9,21,11,51,69**
 MAGDMFBD        10093867        11931284        **9,21,11,51,69**
 MAGDMFBE        13539021        15990142        **9,21,11,30,51,69**
 MAGDMFBI        8484980         8425117         **9,10,11,69**
 MAGDMFBM        16729029        18603370        **9,10,11,30,51,69**
 MAGDMFBP        6993972         7149176         **9,10,30,69**
 MAGDMFBS        11266458        13741786        **9,10,11,30,51,50,69**
 MAGDMFBW        11543013        12082057        **9,10,11,30,69**
 MAGDMFCC        new             7841701         **69**
 MAGDMFIC        14573770        14156950        **10,11,30,69**
 MAGDSSD         2615745         2967417         **69**
 MAGDSTAT        13756724        14075395        **10,11,30,69**
 MAGDSTRT        10446503        10794451        **21,11,30,51,69**
 MAGDTLOG        4356624         3519588         **30,69**
 MAGDVRSN        7050786         7248209         **1,7,9,26,21,10, 36,3,
                                                   11,30,5,51, 50,52,69**
 MAGM2VC         10793890        11138307        **11,30,51,69**
 MAGOSDIR        6268059         5739085         **10,51,69**
 MAGOSFIL        9440272         9975574         **11,69**
 MAGOSMSC        10016024        9053092         **69**
 MAGOSTCP        8036500         9384677         **11,30,69**
  
 Checksums are calculated using the Kernel utility 
 program                       
 CHECK1^XTSUMBLD     
  
 Routine         Before          After           Patch 
 List                                                                      
 MAGDACP1        59650730        61032941        **21,11,30,51,69**
 MAGDACP3        40860710        41778832        **30,69**
 MAGDBB          89797193        45698134        **9,10,11,30,51,69**
 MAGDBB2         new             21634234        **69**
 MAGDCIGL        new             1477288         **69**
 MAGDCIRL        new             19614608        **69**
 MAGDCST4        34633853        35153452        **10,11,30,51,69**
 MAGDDEL2        31010776        31175540        **10,11,51,69**
 MAGDEXC2        51123998        53421053        **11,69**
 MAGDGEX1        75064981        76377251        **11,30,51,50,69**
 MAGDIW3         18859883        20255166        **10,30,50,69**
 MAGDIW3A        85135481        86768833        **50,69**
 MAGDMENA        52546832        50444255        **9,21,10,11,30,69**
 MAGDMENO        38675689        37791052        **11,30,51,50,69**
 MAGDMENU        47753714        48648672        **9,21,11,30,51,69**
 MAGDMFB         18837400        46751723        **9,21,11,30,50,69**
 MAGDMFB1        85413954        90975135        **9,21,11,30,51,69**
 MAGDMFB2        42201847        48221936        **21,30,51,69**
 MAGDMFB3        37770144        41071819        **30,69**
 MAGDMFB4        12661619        15205941        **30,69**
 MAGDMFB5        23101804        25775790        **30,69**
 MAGDMFB6        17607661        19275620        **30,69**
 MAGDMFB7        39682152        26178773        **10,30,50,69**
 MAGDMFB9        26193988        25588255        **11,30,69**
 MAGDMFBA        18218893        16186541        **30,69**
 MAGDMFBB        61151108        53108146        **9,21,11,51,69**
 MAGDMFBD        29422066        37898955        **9,21,11,51,69**
 MAGDMFBE        46388838        61989197        **9,21,11,30,51,69**
 MAGDMFBI        25988633        23675432        **9,10,11,69**
 MAGDMFBM        82684867        85414926        **9,10,11,30,51,69**
 MAGDMFBP        18082898        17921307        **9,10,30,69**
 MAGDMFBS        36759007        49061654        **9,10,11,30,51,50,69**
 MAGDMFBW        45914050        44248405        **9,10,11,30,69**
 MAGDMFCC        new             25084521        **69**
 MAGDMFIC        57482191        51705421        **10,11,30,69**
 MAGDSSD         3495654         4287052         **69**
 MAGDSTAT        61033871        66601010        **10,11,30,69**
 MAGDSTRT        44172273        46356300        **21,11,30,51,69**
 MAGDTLOG        8250501         5398596         **30,69**
 MAGDVRSN        21032634        21494160        **1,7,9,26,21,10, 36,3,
                                                   11,30,5,51, 50,52,69**
 MAGM2VC         52209330        55948740        **11,30,51,69**
 MAGOSDIR        18403377        17707114        **10,51,69**
 MAGOSFIL        33818258        37905396        **11,69**
 MAGOSMSC        61266442        44422945        **69**
 MAGOSTCP        22152112        33263615        **11,30,69**
 
 
 
 

Routine Information:
====================
The checksums below are new checksums, and
 can be checked with CHECK1^XTSUMBLD.

Routine Name: MAGIPS69
    Before:       n/a   After:  B9191947  **69**

=============================================================================
User Information:
Entered By  : BARRIOS,LUCILLE               Date Entered  : MAY 11, 2006
Completed By: CASUGAY,ELSIE G               Date Completed: OCT 26, 2007
Released By : GENTRY,MELINDA                Date Released : NOV 07, 2007
=============================================================================


Packman Mail Message:
=====================

No routines included
