
=============================================================================
Run Date: NOV 20, 2003                     Designation: MAG*3*10
Package : MAG - IMAGING                       Priority: Mandatory
Version : 3        SEQ #17                      Status: Released
                  Compliance Date: DEC 31, 2003
=============================================================================

Associated patches: (v)MAG*3*1     <<= must be installed BEFORE `MAG*3*10'
                    (v)MAG*3*9     <<= must be installed BEFORE `MAG*3*10'
                    (v)MAG*3*21    <<= must be installed BEFORE `MAG*3*10'

Subject: DICOM - CONSULT AND PROCEDURES INTERFACE

Category: 
  - Enhancement (Mandatory)
  - Data Dictionary
  - Routine

Description:
============

 This is an enhancement support patch for the VistA DICOM Gateway software 
 that will now provide an interface to Healthcare Providers.   This 
 feature works in conjunction with CPRS Consult (Procedure) Request 
 Tracking application and the Appointment Management package.  It allows 
 DICOM-enabled image acquisition equipment to download patient and study 
 information, incorporate it into the images acquired from the patient, 
 and send them to VistA where they are stored associated to the medical 
 record.  The images can then be viewed on CPRS or Imaging Clinical 
 workstations through out the medical center. 
  
 This capability will be supported for Dental, Ophthalmology and other 
 clinical specialties.  Imaging is a subscriber to the GMRC EVSEND OR and 
 the SDAM APPOINTMENT EVENTS protocol to receive HL7 messages from these 
 events and are used to create a worklist that will be available for query 
 on the DICOM-enabled image acquisition equipment. 
  
 Also included in this patch is a new utility for displaying the DICOM 
 transaction log.  The real time log can be selectively viewed by 
 application in a user window, instead of having it displayed all together 
 on the console window.  (The capability of automatically displaying the 
 transaction log on the console window has been removed, allowing the 
 DICOM application to run faster.)
  
 Installation instructions are included in this document. FDA regulations 
 require that each Imaging software distribution is documented and tracked 
 by the VistA Imaging project. To receive this patch, a site must have 
 their Site Agreement filed with and approved by the VistA Imaging Group. 
 Once the required documents are received and approved, software will be 
 available on the Imaging FTP server in the \SOFTWARE\RELEASED_SOFTWARE 
 folder. For information concerning the status of a site agreement, 
 contact Kathy Trombetta via phone (301-734-0357) or email 
 (Kathy.Trombetta@med.va.gov).
  
  
 This patch consists of the following.  
 MAGDCM.RTN - Routines to be installed on DICOM Gateways.
  
 MAGMGR.RTN - Routines to be installed on DICOM Gateways.
  
 MAG3_0P10.KID - Kernel Installation & Distribution System (KIDS)
         application to be installed on hospital database.
  
 The following files are to be installed on the DICOM gateway in
 DICOM\DICT folder.
        DATAGECT.DIC
        DATAMISC.DIC
        DATA_CR.DIC
        DATA_MRI.DIC
        ELEMENT.DIC
        HL7.DIC
        SCP_LIST.DIC
        TEMPLATE.DIC
        UID.DIC
 The following files are to be installed on the DICOM gateway in the
 DICOM\Utility folder:
        DICOM_echo.exe
        MAG_AbstrTGA.exe
        MAG_CStore.exe
        MAG_DCM_Copy.exe
        MAG_DCMtoTGA.exe
        MAG_Recon.exe
        MAG_Recon.txt
        MAG_TGAtoDCM.exe
        MAG_VistA_Send_Image.exe
        send_image.exe
        MAG_MakeAbs.exe
  
 Documentation:
     DICOMug.doc - DICOM Users Guide
  
     MAG3_P10_IMGDICOM_Health_Providers_ig.pdf - Installation instructions
     for this patch.
  
 The following are change pages to our present documentation for patch 10. 
  
     MAG3_P10_IMGDICOMigAppendixB_4-B_4_7.pdf - DICOM Installation's
     Appendix B Site-Specific Master Files.
  
     MAG3_0P10_IMGDICOMigPreface.pdf - DICOM Installation's Preface.
  
     MAG3_0P10_IMGDICOMigSec3_14_2EstTransTbls.pdf - DICOM installation's 
     section 3.14.2 changes to the Translation Tables.
  
     MAG3_0P10IMGtechmanSec7_2_1VAFilemanfiles.pdf - Imaging Technical
     section 7.2.1 Imaging FileMan files.
  
     MAG3_IMGerrormsg.pdf - Imaging System Error Message Guide. This is a
     new document that describes all the error messages and possible fixes
     for VistA Imaging DICOM v3.0.
  
  
 NOIS:
 ========== 
 WAS-0902-21963
  
 Tested at the following sites:
 ======================== 
 Washington DC
 Mountain Home TN
 Dublin GA
 Baltimore MD
 Fayetteville NC 
  
  
 ROUTINE SUMMARY:
 ============= 
 The following is a list of the routines included in this patch.  The 
                                                                      
 second line of each of these routine(s) will look like:
  
      <space>;;3.0;IMAGING;**10**;6-November-2003
  
 Routines on VistA
  
 Routine       Checksum        Patch List
  
 MAGDCCS       12895252          **10** 
 MAGDCCS2       6369003          **10**
 MAGDCCS3       3965440          **10**
 MAGDCCSD       4446663          **10**
 MAGDCCSS       5605002          **10**
 MAGDGMRC       8587567          **10**
 MAGDHW0        4070033          **10**
 MAGDHWA       13363951          **10**
 MAGDHWC       10917214          **10**
 MAGDHWS        8433031          **10**
 MAGDLB6        3354488          **21,10**
 MAGDLBSR       5467588          **10**
 MAGDRA1        7630701          **10**
 MAGDRA2        7852272          **10**
 MAGDRCU1       8444320          **10**
 MAGDRCU2       9677365          **10**
 MAGDROUT       5323100          **10**
 MAGGNTI        9622527          **10**
 MAGGTIA2       7860990          **10**
 MAGIPS10       5448905          **10**
 MAGSDEL2       7540929          **10**
 MAGSDHCP       3713231          **10**
  
 Routine MAGIPS10 is a pre and post-init routine that is automatically 
 deleted after the KIDS application install.
  
 Routines on DICOM Gateway
  
 Routine       Checksum        Patch List
  
 MAGBRTE2       8122369          **9,10**
 MAGDACW1      12160791          **10**
 MAGDACW2       7796943          **10**
 MAGDAUD1       7957677          **10**
 MAGDAUD2       7757298          **10**
 MAGDBB        12001628          **9,10**
 MAGDCST1      14174847          **10**
 MAGDCST4       8360314          **10**
 MAGDCST5       4589478          **10**
 MAGDCST6       6482108          **10**
 MAGDDEL        3868910          **10**
 MAGDDEL1       4107760          **10**
 MAGDDEL2       9004724          **10**
 MAGDDEL3       3461285          **10**
 MAGDDR0        8701963          **1,10**
 MAGDDR1       11113591          **10**
 MAGDDR2        9357463          **10**
 MAGDDR2A      16272317          **1,10**
 MAGDDR3       10064054          **1,10**
 MAGDDR7        6813992          **10**
 MAGDDW0        4978990          **1,10**
 MAGDDW1       10657101          **10**
 MAGDDW2       11408048          **10**
 MAGDDW3       10931654          **10**
 MAGDDW4       16898926          **1,10**
 MAGDFCNS      12260347          **9,10**
 MAGDFCNV       4775309          **21,10**
 MAGDFND0       7247465          **10**
 MAGDFND2      17188374          **1,10**
 MAGDFND3      17538891          **10**
 MAGDFND4       7047596          **10**
 MAGDFND5       5324321          **10**
 MAGDGMRC       8587567          **10**
 MAGDHR1A       9088793          **10**
 MAGDHR2        8786658          **10**
 MAGDHR3        9980545          **10**
 MAGDHR3A       7394280          **10**
 MAGDHR4       15546629          **10**
 MAGDHR4A      13832072          **10**
 MAGDHR5        8703017          **10**
 MAGDHR5A       6175530          **10**
 MAGDHR9        4248557          **10**
 MAGDHRP        7376891          **10**
 MAGDIR1       18021681          **21,10**
 MAGDIR1A      13533063          **21,10**
 MAGDIR2        5760799          **9,21,10**
 MAGDIR2A      10977077          **21,10**
 MAGDIR2B      14339727          **9,21,10**
 MAGDIR2C      14658137          **26,21,10**
 MAGDIR2D      11930125          **26,21,10**
 MAGDIR2E      16030410          **10**
 MAGDIR2F       9471029          **10**
 MAGDIR3        7260737          **10**
 MAGDIR4       10479056          **21,10**
 MAGDIR5        4353316          **10**
 MAGDIRE       16738139          **21,10**
 MAGDIW1       13947244          **10**
 MAGDIW1A       5621081          **10**
 MAGDIW2       17498384          **10**
 MAGDIW2A       7024482          **10**
 MAGDIW3        6310840          **10**
 MAGDIW3A       6980480          **10**
 MAGDIW3C       6093199          **10**
 MAGDIW4        8202326          **10**
 MAGDIW5       15076844          **10**
 MAGDIX1        7560852          **10**
 MAGDLB1A      15035346          **21,10**
 MAGDMENA      11342445          **9,21,10**
 MAGDMFB7       4512733          **10**
 MAGDMFB8       6878070          **9,10**
 MAGDMFBI       7421804          **9,10**
 MAGDMFBM      14724898          **9,10**
 MAGDMFBP       7037084          **9,10**
 MAGDMFBS       8020332          **9,10**
 MAGDMFBW      11426333          **9,10**
 MAGDMFIC      13776474          **10**
 MAGDMLGV      12349230          **21,10**
 MAGDMLOG       8499798          **9,10**
 MAGDOS         3659416          **26,10**
 MAGDROUT       5323100          **10**
 MAGDSTAT      12031228          **10**
 MAGDUID1       6152091          **21,10**
 MAGDVRSN       3510833          **1,7,9,26,21,10**
 MAGDWLP1      14570016          **10**
 MAGDWLP4      13773170          **10**
 MAGDWLP5       9517432          **10**
 MAGDWLU1      11927190          **21,10**
 MAGDWLU3      13820948          **21,10**
 MAGDWLU4       3702140          **10**
 MAGGTIA2       7860990          **10**
 MAGOSDIR       6245226          **10**
 MAGSDEL2       7540929          **10**
 MAGSDHCP       3713231          **10**
 MAGUE         16427614          **21,10**
  
  
 Routines that run on the VistA server:
 ===================================== 
 MAGDCCS - Contains global set logic for fix option; global set logic for 
 delete option, including error recording.  Contains logic for sequential 
 looping and date looping over failed images file; patient SSN and case 
 number check logic; logic for displaying selected entry and confirming 
 selection.
  
 MAGDCCS2 - Contains single entry processing logic; logic for 
 consult/request lookup; date formatting logic; logic for retrieving 
 patient information.
  
 MAGDCCS3 - Contains logic to validate patient and verify that there are 
 requests/consults on file; logic to prompt, select, and validate entry of 
 a request/consult number.
  
 MAGDCCSD - Contains initial entry logic; logic for choosing whether to 
 process by sequential entry number looping, date looping, or single 
 entry; logic for selection by entry number or by date. 
  
 MAGDCCSS - Contains logic for sorting by patient or date (for unique 
 study UID), logic for selecting display by date, date range, or unique 
 entries.
  
 MAGDHWC - "GMRC EVSEND OR" protocol invocation point from the Consult 
 Request Tracking application.  This routine receives a skeletal HL7 
 message in the GMCRMSG array, copies it to the local HL7 array, and fills 
 in field data using the ^MAGDHWA routine, and then calls ^MAGDHW0 to puts 
 it into the ^MAGDHL7 global.
  
 MAGDHWS - "SDAM APPOINTMENT EVENTS" protocol invocation point from the 
 Appointment Management package.  This routine receives the SDATA array 
 containing appointment information.  It invokes GMCR routines to create a 
 skeletal HL7 message in the local HL7 array, and fills in field data 
 using the ^MAGDHWA routine, and then calls ^MAGDHW0 to puts it into the 
 ^MAGDHL7 global.
  
 MAGDHWA - Gets additional information for the HL7 message, for example, 
 certain fields like the SSN, and additional segments for allergies and 
 clinical warnings.  This routine also creates the association between 
 existing images and a new TIU note.
  
 MAGDHW0 - Provides the low level functions for the MAGDHW{A,C,S} routines 
 and copies records from the HL7 array to the ^MAGDHL7 global.
  
 MAGGNTI - Modified to return only <image IEN> to RPC call.
  
 Routines that run on the VistA DICOM Gateway:
 ============================================
 HL7 message processing routines:
 MAGDHR1 - First HL7 routine - skip sending Healthcare Providers messages 
 to PACS.
  
 MAGDHR2 - HL7 message segment processing dispatcher.  It invokes the 
 existing MAGHR3, MAGDHD4, and MAGDHR5 routines for radiology, and the 
 corresponding new MAGDH3A, MAGDHR4A, MAGDHR5A routines for Healthcare 
 Providers messages.
  
 MAGDHR3 -handles PID and PV1 segments for radiology (only change is RAD 
 banner at top).
  
 MAGDHR3A - handles PID and PV1 segments for Healthcare Providers software.
  
 MAGDHR4 - handles ORC and OBR segments for radiology (change is setting 
 of FORWARD and REQSTATE variables, plus the addition of the RAD banner at 
 the top).
  
 MAGDHR4A - handles ORC and OBR segments for Healthcare Providers software.
  
 MAGDHR5 - handles OBX segments for radiology  (only change is RAD banner 
 at top).
  
 MAGDHR5A - handles OBX segments for Healthcare Providers software.
  
 Modality Worklist routines:
 MAGDWLP1 - maintains the Patient MWL file.  Changes are to store new 
 integration control number field in MWL Patient file, and handle 
 scheduling.
  
 MAGDWLP4 - maintains the Study MWL file. Changes are to store scheduled 
 date/time in MWL database (new 2006.5622 file) and three new fields: 
 status, priority, and TIU note signed.  The scheduling data is needed to 
 provide lists of patients by clinic appointment by date.
  
 MAGDFND2 - queries the MWL database.  Change is to use the scheduled 
 date/time for lookup for Healthcare Providers software, in addition to 
 the radiology arrival time.
  
 MAGDFND3 - retrieve new fields from MWL database and pass them in the 
 results to the modality.
  
 MAGDFND4 - modified to handle ethnic group by passing RACE variable.
  
  
 Modality Worklist User routines for testing:
 MAGDWLU - Improved MWL simulator (generates queries).
 MAGDWLU1 - Added start date/time to broad patient query.
 MAGDWLU2 - Added more fields for query.
  
  
 Image Processing Routines:
 MAGDIR1 - First image processing routine - calls radiology and Healthcare 
 Providers software specialty lookup.
  
 MAGDIR1A - Performs radiology (RAD^MAGDIR1A) and Healthcare Providers 
 software (CON^MAGDIR1A) patient/study lookup.
  
 MAGDIR2 - Invokes ^MAGDIR2E to create the group for a Healthcare 
 Providers software image
  
 MAGDIR2A - Creates association between MAG group and Radiology Report 
 (only change is RAD banner at top).
  
 MAGDIR2B - Stores the image object in ^MAG(2005) (only change is to pass 
 the PARENT DATA FILE POINTER).
  
 MAGDIR2E - Create association between MAG group and TIU Note.
  
 MAGDIR3 - Accession number lookup (added CORRECT^MAGDIR3 for Healthcare 
 Providers software).
  
 MAGDIR5 - Outputs DICOM elements to *.TXT file.
  
 MAGDIRER - Error reporter (new TIUMISS^MAGDIRER called from ^MAGDIR2E).
  
 Image reconstruction routines:
 MAGDIX1 - routine to modify a DICOM header.
 MAGDIW3 - regenerate DICOM header from  *.TXT file - minor bug fixed.
  
 Dictionary Routines - 
 MAGDMFB7 - Imaging Service (2006.589) has been removed.
 MAGDMFB8 - Needed code for stand-alone & consolidated sites.
 MAGDMFBI - Placed check in for legal imaging service.
 MAGDMFBW - Placed check in for legal imaging service.
  
 Miscellaneous:
 MAGDSTRT - modified for better error reporting.
  
 DATA DICTIONARIES:
 ============ 
 KIDs installation will install the following dictionaries: 
 The entry 'DICOM GMRC TEMP LIST' will be added to the Parent Data File 
 (#2005.03). This file has all of the files that images can be associated 
 to during an image capture.
  
 DICOM WORKLIST PATIENT file (#2005.55) will be added. This file contains 
 all the patient information on a modality work list.
  
 DICOM WORKLIST STUDY file (#2005.56) will be added. This file contains 
 all the patient study information on a modality work list.
  
 MODALITY WORKLIST DICTIONARY file (#2005.583) will be added. This file 
 contains the various image acquisition devices for which the site 
 maintains a DICOM Modality Worklist.
  
 DICOM HEALTHCARE PROVIDERS SERVICES file (#2005.5831) will be added. 
 The purpose of this file is to link groups of request for services 
 (stored in file ^GMR(123,. .) to entities that are related to DICOMM 
 Worklist requests.
  
 DICOM GRMC TEMP LIST file (#2006.5839) will be added.  This file 
 temporarily stores image entries that have been acquire on the DICOM 
 gateways and do not have an associated applications parent report entry.
  
 Menu Options:
 ================= 
 There are 2 new options:
 1.  Correct Clinical Specialties DICOM File Entries [MAGD FIX CLINSPEC 
 DICOM FILE] is new and will be part of the MAGD DICOM MENU.  This menu 
 option is used to correct any image that failed the matching process on 
 the DICOM Image gateway.
 2.  List Unread Studies [MAGD LIST UNREAD STUDIES] menu option is used to 
 lists the entries in the temporary DICOM GMRC TEMP (#2006.5839) file. 
  
 Protocols:
 ================== 
 Protocol, MAGD APPOINTMENT, is exported and should be added to the SDAM 
 APPOINTMENT EVENTS protocol.  This protocol is used to pass HL7 messages 
 regarding Scheduling to Imaging for Modality Worklist.
  
 Protocol, MAGD RECEIVE EVENTS, is exported and should be added to the 
 GMRC EVSEND OR protocol.  This protocol is used to pass HL7 event 
 messages to Imaging for Modality Worklist.
  
  
 INSTALLATION
 ============ 
 Installation and setup instructions are outlined in document 
 MAG3_P10_IMGDICOM_Health_Providers_ig.pdf which is part of this patch and 
 is located on the Imaging FTP location.   
  
 PLEASE NOTE: Prior to installation, please correct all entries in the
 DICOM FIX files before installing.

Routine Information:
====================

=============================================================================
User Information:
Entered By  : BARRIOS,LUCILLE               Date Entered  : JUL 02, 2002
Completed By: CARR,ROSEMARY                 Date Completed: NOV 19, 2003
Released By : LOVING,MANLEY                 Date Released : NOV 20, 2003
=============================================================================


Packman Mail Message:
=====================

No routines included
