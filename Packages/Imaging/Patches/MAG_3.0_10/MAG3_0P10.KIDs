KIDS Distribution saved on Nov 06, 2003@09:55:16
VistA Imaging v3.0  - patch 10 build 32 11/6/03 9:42am
**KIDS**:MAG*3.0*10^

**INSTALL NAME**
MAG*3.0*10
"BLD",3009,0)
MAG*3.0*10^IMAGING^0^3031106^y
"BLD",3009,1,0)
^^30^30^3031106^
"BLD",3009,1,1,0)
                     
"BLD",3009,1,2,0)
Routines required for capturing DICOM images for Consults and Procedures.
"BLD",3009,1,3,0)
 
"BLD",3009,1,4,0)
Routine checksums:
"BLD",3009,1,5,0)
 
"BLD",3009,1,6,0)
MAGDCCS   value = 12895252
"BLD",3009,1,7,0)
MAGDCCS2  value = 6369003
"BLD",3009,1,8,0)
MAGDCCS3  value = 3965440
"BLD",3009,1,9,0)
MAGDCCSD  value = 4446663
"BLD",3009,1,10,0)
MAGDCCSS  value = 5605002
"BLD",3009,1,11,0)
MAGDGMRC  value = 8587567
"BLD",3009,1,12,0)
MAGDHW0   value = 4070033
"BLD",3009,1,13,0)
MAGDHWA   value = 13363951
"BLD",3009,1,14,0)
MAGDHWC   value = 10917214
"BLD",3009,1,15,0)
MAGDHWS   value = 8433031
"BLD",3009,1,16,0)
MAGDLB6   value = 3354488
"BLD",3009,1,17,0)
MAGDLBSR  value = 5467588
"BLD",3009,1,18,0)
MAGDRA1   value = 7630701
"BLD",3009,1,19,0)
MAGDRA2   value = 7852272
"BLD",3009,1,20,0)
MAGDRCU1  value = 8444320
"BLD",3009,1,21,0)
MAGDRCU2  value = 9677365
"BLD",3009,1,22,0)
MAGDROUT  value = 5323100
"BLD",3009,1,23,0)
MAGGNTI   value = 9622527
"BLD",3009,1,24,0)
MAGGTIA2  value = 7860990
"BLD",3009,1,25,0)
MAGIPS10  value = 5448905
"BLD",3009,1,26,0)
MAGSDEL2  value = 7540929
"BLD",3009,1,27,0)
MAGSDHCP  value = 3713231
"BLD",3009,1,28,0)
 
"BLD",3009,1,29,0)
Please note that routine MAGIPS10 will be deleted after the KIDS Build is 
"BLD",3009,1,30,0)
installed.
"BLD",3009,4,0)
^9.64PA^2006.582^8
"BLD",3009,4,2005.03,0)
2005.03
"BLD",3009,4,2005.03,222)
y^y^f^^n^^y^m^n
"BLD",3009,4,2005.03,224)
I $P(^(0),"^")="DICOM GMRC TEMP LIST"
"BLD",3009,4,2006.55,0)
2006.55
"BLD",3009,4,2006.55,222)
y^y^f^^n^^n^m^n
"BLD",3009,4,2006.56,0)
2006.56
"BLD",3009,4,2006.56,222)
y^y^f^^^^n
"BLD",3009,4,2006.574,0)
2006.574
"BLD",3009,4,2006.574,222)
y^y^f^^^^n
"BLD",3009,4,2006.582,0)
2006.582
"BLD",3009,4,2006.582,222)
y^y^f^^^^n
"BLD",3009,4,2006.583,0)
2006.583
"BLD",3009,4,2006.583,2,0)
^9.641^2006.583^1
"BLD",3009,4,2006.583,2,2006.583,0)
MODALITY WORKLIST DICTIONARY  (File-top level)
"BLD",3009,4,2006.583,2,2006.583,1,0)
^9.6411^3^1
"BLD",3009,4,2006.583,2,2006.583,1,3,0)
SERVICE
"BLD",3009,4,2006.583,222)
y^y^p^^^^n
"BLD",3009,4,2006.5831,0)
2006.5831
"BLD",3009,4,2006.5831,222)
y^y^f^^^^n
"BLD",3009,4,2006.5839,0)
2006.5839
"BLD",3009,4,2006.5839,222)
y^y^f^^^^n
"BLD",3009,4,"APDD",2006.583,2006.583)

"BLD",3009,4,"APDD",2006.583,2006.583,3)

"BLD",3009,4,"B",2005.03,2005.03)

"BLD",3009,4,"B",2006.55,2006.55)

"BLD",3009,4,"B",2006.56,2006.56)

"BLD",3009,4,"B",2006.574,2006.574)

"BLD",3009,4,"B",2006.582,2006.582)

"BLD",3009,4,"B",2006.583,2006.583)

"BLD",3009,4,"B",2006.5831,2006.5831)

"BLD",3009,4,"B",2006.5839,2006.5839)

"BLD",3009,"ABNS",0)
^9.66A^^
"BLD",3009,"ABPKG")
n^y^G.IMAGING DEVELOPMENT TEAM@DOMAIN.EXT
"BLD",3009,"INI")
PRE^MAGIPS10
"BLD",3009,"INID")
^y^
"BLD",3009,"INIT")
POST^MAGIPS10
"BLD",3009,"KRN",0)
^9.67PA^8989.52^19
"BLD",3009,"KRN",.4,0)
.4
"BLD",3009,"KRN",.401,0)
.401
"BLD",3009,"KRN",.402,0)
.402
"BLD",3009,"KRN",.403,0)
.403
"BLD",3009,"KRN",.5,0)
.5
"BLD",3009,"KRN",.84,0)
.84
"BLD",3009,"KRN",3.6,0)
3.6
"BLD",3009,"KRN",3.8,0)
3.8
"BLD",3009,"KRN",9.2,0)
9.2
"BLD",3009,"KRN",9.8,0)
9.8
"BLD",3009,"KRN",9.8,"NM",0)
^9.68A^26^21
"BLD",3009,"KRN",9.8,"NM",1,0)
MAGDHW0^^0^B8889432
"BLD",3009,"KRN",9.8,"NM",2,0)
MAGDHWA^^0^B58806153
"BLD",3009,"KRN",9.8,"NM",3,0)
MAGDHWC^^0^B40225649
"BLD",3009,"KRN",9.8,"NM",6,0)
MAGDHWS^^0^B24298670
"BLD",3009,"KRN",9.8,"NM",7,0)
MAGGNTI^^0^B25218336
"BLD",3009,"KRN",9.8,"NM",8,0)
MAGGTIA2^^0^B18840525
"BLD",3009,"KRN",9.8,"NM",9,0)
MAGDROUT^^0^B11345086
"BLD",3009,"KRN",9.8,"NM",10,0)
MAGDCCS^^0^B51999148
"BLD",3009,"KRN",9.8,"NM",11,0)
MAGDCCS2^^0^B15767698
"BLD",3009,"KRN",9.8,"NM",12,0)
MAGDCCS3^^0^B6214533
"BLD",3009,"KRN",9.8,"NM",13,0)
MAGDCCSD^^0^B8014848
"BLD",3009,"KRN",9.8,"NM",14,0)
MAGDCCSS^^0^B13079521
"BLD",3009,"KRN",9.8,"NM",15,0)
MAGDRA1^^0^B20446208
"BLD",3009,"KRN",9.8,"NM",16,0)
MAGDRA2^^0^B24362463
"BLD",3009,"KRN",9.8,"NM",17,0)
MAGSDEL2^^0^B14423252
"BLD",3009,"KRN",9.8,"NM",18,0)
MAGSDHCP^^0^B6123270
"BLD",3009,"KRN",9.8,"NM",21,0)
MAGDGMRC^^0^B32069859
"BLD",3009,"KRN",9.8,"NM",23,0)
MAGDRCU1^^0^B29520523
"BLD",3009,"KRN",9.8,"NM",24,0)
MAGDRCU2^^0^B38102722
"BLD",3009,"KRN",9.8,"NM",25,0)
MAGDLBSR^^0^B12292223
"BLD",3009,"KRN",9.8,"NM",26,0)
MAGDLB6^^0^B5513569
"BLD",3009,"KRN",9.8,"NM","B","MAGDCCS",10)

"BLD",3009,"KRN",9.8,"NM","B","MAGDCCS2",11)

"BLD",3009,"KRN",9.8,"NM","B","MAGDCCS3",12)

"BLD",3009,"KRN",9.8,"NM","B","MAGDCCSD",13)

"BLD",3009,"KRN",9.8,"NM","B","MAGDCCSS",14)

"BLD",3009,"KRN",9.8,"NM","B","MAGDGMRC",21)

"BLD",3009,"KRN",9.8,"NM","B","MAGDHW0",1)

"BLD",3009,"KRN",9.8,"NM","B","MAGDHWA",2)

"BLD",3009,"KRN",9.8,"NM","B","MAGDHWC",3)

"BLD",3009,"KRN",9.8,"NM","B","MAGDHWS",6)

"BLD",3009,"KRN",9.8,"NM","B","MAGDLB6",26)

"BLD",3009,"KRN",9.8,"NM","B","MAGDLBSR",25)

"BLD",3009,"KRN",9.8,"NM","B","MAGDRA1",15)

"BLD",3009,"KRN",9.8,"NM","B","MAGDRA2",16)

"BLD",3009,"KRN",9.8,"NM","B","MAGDRCU1",23)

"BLD",3009,"KRN",9.8,"NM","B","MAGDRCU2",24)

"BLD",3009,"KRN",9.8,"NM","B","MAGDROUT",9)

"BLD",3009,"KRN",9.8,"NM","B","MAGGNTI",7)

"BLD",3009,"KRN",9.8,"NM","B","MAGGTIA2",8)

"BLD",3009,"KRN",9.8,"NM","B","MAGSDEL2",17)

"BLD",3009,"KRN",9.8,"NM","B","MAGSDHCP",18)

"BLD",3009,"KRN",19,0)
19
"BLD",3009,"KRN",19,"NM",0)
^9.68A^3^3
"BLD",3009,"KRN",19,"NM",1,0)
MAGD FIX CLINSPEC DICOM FILE^^0
"BLD",3009,"KRN",19,"NM",2,0)
MAGD DICOM MENU^^2
"BLD",3009,"KRN",19,"NM",3,0)
MAGD LIST UNREAD STUDIES^^0
"BLD",3009,"KRN",19,"NM","B","MAGD DICOM MENU",2)

"BLD",3009,"KRN",19,"NM","B","MAGD FIX CLINSPEC DICOM FILE",1)

"BLD",3009,"KRN",19,"NM","B","MAGD LIST UNREAD STUDIES",3)

"BLD",3009,"KRN",19.1,0)
19.1
"BLD",3009,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",3009,"KRN",101,0)
101
"BLD",3009,"KRN",101,"NM",0)
^9.68A^2^2
"BLD",3009,"KRN",101,"NM",1,0)
MAGD APPOINTMENT^^0
"BLD",3009,"KRN",101,"NM",2,0)
MAGD RECEIVE EVENTS^^0
"BLD",3009,"KRN",101,"NM","B","MAGD APPOINTMENT",1)

"BLD",3009,"KRN",101,"NM","B","MAGD RECEIVE EVENTS",2)

"BLD",3009,"KRN",409.61,0)
409.61
"BLD",3009,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",3009,"KRN",771,0)
771
"BLD",3009,"KRN",771,"NM",0)
^9.68A^^
"BLD",3009,"KRN",870,0)
870
"BLD",3009,"KRN",870,"NM",0)
^9.68A^^
"BLD",3009,"KRN",8989.51,0)
8989.51
"BLD",3009,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",3009,"KRN",8989.52,0)
8989.52
"BLD",3009,"KRN",8994,0)
8994
"BLD",3009,"KRN","B",.4,.4)

"BLD",3009,"KRN","B",.401,.401)

"BLD",3009,"KRN","B",.402,.402)

"BLD",3009,"KRN","B",.403,.403)

"BLD",3009,"KRN","B",.5,.5)

"BLD",3009,"KRN","B",.84,.84)

"BLD",3009,"KRN","B",3.6,3.6)

"BLD",3009,"KRN","B",3.8,3.8)

"BLD",3009,"KRN","B",9.2,9.2)

"BLD",3009,"KRN","B",9.8,9.8)

"BLD",3009,"KRN","B",19,19)

"BLD",3009,"KRN","B",19.1,19.1)

"BLD",3009,"KRN","B",101,101)

"BLD",3009,"KRN","B",409.61,409.61)

"BLD",3009,"KRN","B",771,771)

"BLD",3009,"KRN","B",870,870)

"BLD",3009,"KRN","B",8989.51,8989.51)

"BLD",3009,"KRN","B",8989.52,8989.52)

"BLD",3009,"KRN","B",8994,8994)

"BLD",3009,"QUES",0)
^9.62^^
"BLD",3009,"REQB",0)
^9.611^3^3
"BLD",3009,"REQB",1,0)
MAG*3.0*1^2
"BLD",3009,"REQB",2,0)
MAG*3.0*7^2
"BLD",3009,"REQB",3,0)
MAG*3.0*21^2
"BLD",3009,"REQB","B","MAG*3.0*1",1)

"BLD",3009,"REQB","B","MAG*3.0*21",3)

"BLD",3009,"REQB","B","MAG*3.0*7",2)

"DATA",2005.03,2006.5839,0)
DICOM GMRC TEMP LIST^GMRC^1^2006.5839
"FIA",2005.03)
PARENT DATA FILE
"FIA",2005.03,0)
^MAG(2005.03,
"FIA",2005.03,0,0)
2005.03
"FIA",2005.03,0,1)
y^y^f^^n^^y^m^n
"FIA",2005.03,0,10)

"FIA",2005.03,0,11)
I $P(^(0),"^")="DICOM GMRC TEMP LIST"
"FIA",2005.03,0,"RLRO")

"FIA",2005.03,0,"VR")
3.0^MAG
"FIA",2005.03,2005.03)
0
"FIA",2006.55)
DICOM WORKLIST PATIENT
"FIA",2006.55,0)
^MAGDWLST(2006.55,
"FIA",2006.55,0,0)
2006.55P
"FIA",2006.55,0,1)
y^y^f^^n^^n^m^n
"FIA",2006.55,0,10)

"FIA",2006.55,0,11)

"FIA",2006.55,0,"RLRO")

"FIA",2006.55,0,"VR")
3.0^MAG
"FIA",2006.55,2006.55)
0
"FIA",2006.55,2006.552)
0
"FIA",2006.56)
DICOM WORKLIST STUDY
"FIA",2006.56,0)
^MAGDWLST(2006.56,
"FIA",2006.56,0,0)
2006.56P
"FIA",2006.56,0,1)
y^y^f^^^^n
"FIA",2006.56,0,10)

"FIA",2006.56,0,11)

"FIA",2006.56,0,"RLRO")

"FIA",2006.56,0,"VR")
3.0^MAG
"FIA",2006.56,2006.56)
0
"FIA",2006.56,2006.562)
0
"FIA",2006.56,2006.5621)
0
"FIA",2006.56,2006.5622)
0
"FIA",2006.574)
DICOM IMAGE OUTPUT
"FIA",2006.574,0)
^MAGDOUTP(2006.574,
"FIA",2006.574,0,0)
2006.574
"FIA",2006.574,0,1)
y^y^f^^^^n
"FIA",2006.574,0,10)

"FIA",2006.574,0,11)

"FIA",2006.574,0,"RLRO")

"FIA",2006.574,0,"VR")
3.0^MAG
"FIA",2006.574,2006.574)
0
"FIA",2006.574,2006.5744)
0
"FIA",2006.582)
MODALITY TYPE DICTIONARY
"FIA",2006.582,0)
^MAGDICOM(2006.582,
"FIA",2006.582,0,0)
2006.582
"FIA",2006.582,0,1)
y^y^f^^^^n
"FIA",2006.582,0,10)

"FIA",2006.582,0,11)

"FIA",2006.582,0,"RLRO")

"FIA",2006.582,0,"VR")
3.0^MAG
"FIA",2006.582,2006.582)
0
"FIA",2006.583)
MODALITY WORKLIST DICTIONARY
"FIA",2006.583,0)
^MAGDICOM(2006.583,
"FIA",2006.583,0,0)
2006.583
"FIA",2006.583,0,1)
y^y^p^^^^n
"FIA",2006.583,0,10)

"FIA",2006.583,0,11)

"FIA",2006.583,0,"RLRO")

"FIA",2006.583,0,"VR")
3.0^MAG
"FIA",2006.583,2006.583)
1
"FIA",2006.583,2006.583,3)

"FIA",2006.5831)
DICOM HEALTHCARE PROVIDER SERVICE
"FIA",2006.5831,0)
^MAG(2006.5831,
"FIA",2006.5831,0,0)
2006.5831P
"FIA",2006.5831,0,1)
y^y^f^^^^n
"FIA",2006.5831,0,10)

"FIA",2006.5831,0,11)

"FIA",2006.5831,0,"RLRO")

"FIA",2006.5831,0,"VR")
3.0^MAG
"FIA",2006.5831,2006.5831)
0
"FIA",2006.5831,2006.58314)
0
"FIA",2006.5839)
DICOM GMRC TEMP LIST
"FIA",2006.5839,0)
^MAG(2006.5839,
"FIA",2006.5839,0,0)
2006.5839S
"FIA",2006.5839,0,1)
y^y^f^^^^n
"FIA",2006.5839,0,10)

"FIA",2006.5839,0,11)

"FIA",2006.5839,0,"RLRO")

"FIA",2006.5839,0,"VR")
3.0^MAG
"FIA",2006.5839,2006.5839)
0
"INI")
PRE^MAGIPS10
"INIT")
POST^MAGIPS10
"IX",2006.56,2006.562,"C",0)
2006.562^C^Study and Service^R^^R^IR^I^2006.562^^^^^LS
"IX",2006.56,2006.562,"C",.1,0)
^^3^3^3001204^
"IX",2006.56,2006.562,"C",.1,1,0)
This cross reference keeps track of which accessions
"IX",2006.56,2006.562,"C",.1,2,0)
were perfromed 
"IX",2006.56,2006.562,"C",.1,3,0)
for which services.
"IX",2006.56,2006.562,"C",1)
S ^MAGDWLST(2006.56,DA(1),1,"C",X(1),X(2),DA)=""
"IX",2006.56,2006.562,"C",2)
K ^MAGDWLST(2006.56,DA(1),1,"C",X(1),X(2),DA)
"IX",2006.56,2006.562,"C",2.5)
K ^MAGDWLST(2006.56,DA(1),1,"C")
"IX",2006.56,2006.562,"C",11.1,0)
^.114IA^2^2
"IX",2006.56,2006.562,"C",11.1,1,0)
1^F^2006.562^.01^^1^F
"IX",2006.56,2006.562,"C",11.1,2,0)
2^F^2006.562^3^^2^F
"IX",2006.56,2006.562,"D",0)
2006.562^D^Service and Study ID^R^^R^IR^I^2006.562^^^^^LS
"IX",2006.56,2006.562,"D",.1,0)
^^2^2^3001204^
"IX",2006.56,2006.562,"D",.1,1,0)
This cross reference keeps track of which Study IDs are
"IX",2006.56,2006.562,"D",.1,2,0)
performed for which services.
"IX",2006.56,2006.562,"D",1)
S ^MAGDWLST(2006.56,DA(1),1,"D",X(1),X(2),DA)=""
"IX",2006.56,2006.562,"D",2)
K ^MAGDWLST(2006.56,DA(1),1,"D",X(1),X(2),DA)
"IX",2006.56,2006.562,"D",2.5)
K ^MAGDWLST(2006.56,DA(1),1,"D")
"IX",2006.56,2006.562,"D",11.1,0)
^.114IA^2^2
"IX",2006.56,2006.562,"D",11.1,1,0)
1^F^2006.562^.01^^1^F
"IX",2006.56,2006.562,"D",11.1,2,0)
2^F^2006.562^4^^2^F
"IX",2006.56,2006.562,"E",0)
2006.562^E^Service, timestamp and Modality^R^^R^IR^I^2006.562^^^^^LS
"IX",2006.56,2006.562,"E",.1,0)
^^2^2^3001204^
"IX",2006.56,2006.562,"E",.1,1,0)
This cross reference keeps track of which modalities have
"IX",2006.56,2006.562,"E",.1,2,0)
studies performed for which services.
"IX",2006.56,2006.562,"E",1)
S ^MAGDWLST(2006.56,DA(1),1,"E",X(1),X(2),X(3),DA)=""
"IX",2006.56,2006.562,"E",2)
K ^MAGDWLST(2006.56,DA(1),1,"E",X(1),X(2),X(3),DA)
"IX",2006.56,2006.562,"E",2.5)
K ^MAGDWLST(2006.56,DA(1),1,"E")
"IX",2006.56,2006.562,"E",11.1,0)
^.114IA^3^3
"IX",2006.56,2006.562,"E",11.1,1,0)
1^F^2006.562^.01^^1^F
"IX",2006.56,2006.562,"E",11.1,1,3)

"IX",2006.56,2006.562,"E",11.1,2,0)
2^F^2006.562^10^^2^F
"IX",2006.56,2006.562,"E",11.1,2,3)

"IX",2006.56,2006.562,"E",11.1,3,0)
3^F^2006.562^5^^3^F
"IX",2006.56,2006.562,"E",11.1,3,3)

"IX",2006.56,2006.562,"G",0)
2006.562^G^Services and modalities^R^^R^IR^I^2006.562^^^^^LS
"IX",2006.56,2006.562,"G",.1,0)
^^4^4^3030114^
"IX",2006.56,2006.562,"G",.1,1,0)
This cross reference keeps track of studies by:
"IX",2006.56,2006.562,"G",.1,2,0)
 1. service
"IX",2006.56,2006.562,"G",.1,3,0)
 2. modality code
"IX",2006.56,2006.562,"G",.1,4,0)
 3. timestamp
"IX",2006.56,2006.562,"G",1)
S ^MAGDWLST(2006.56,DA(1),1,"G",X(1),X(2),X(3),DA)=""
"IX",2006.56,2006.562,"G",2)
K ^MAGDWLST(2006.56,DA(1),1,"G",X(1),X(2),X(3),DA)
"IX",2006.56,2006.562,"G",2.5)
K ^MAGDWLST(2006.56,DA(1),1,"G")
"IX",2006.56,2006.562,"G",11.1,0)
^.114IA^3^3
"IX",2006.56,2006.562,"G",11.1,1,0)
1^F^2006.562^.01^^1^F
"IX",2006.56,2006.562,"G",11.1,1,3)

"IX",2006.56,2006.562,"G",11.1,2,0)
2^F^2006.562^10^^2^F
"IX",2006.56,2006.562,"G",11.1,2,3)

"IX",2006.56,2006.562,"G",11.1,3,0)
3^F^2006.562^5^^3^F
"IX",2006.56,2006.562,"G",11.1,3,3)

"IX",2006.582,2006.582,"B",0)
2006.582^B^Manufacturer, model and modality.^R^^R^IR^I^2006.582^^^^^LS
"IX",2006.582,2006.582,"B",.1,0)
^^1^1^2990830^
"IX",2006.582,2006.582,"B",.1,1,0)
This cross reference keeps track of manufacturer, model and modality.
"IX",2006.582,2006.582,"B",1)
S ^MAGDICOM(2006.582,"B",$E(X(1),1,30),$E(X(2),1,30),$E(X(3),1,30),DA)=""
"IX",2006.582,2006.582,"B",2)
K ^MAGDICOM(2006.582,"B",$E(X(1),1,30),$E(X(2),1,30),$E(X(3),1,30),DA)
"IX",2006.582,2006.582,"B",2.5)
K ^MAGDICOM(2006.582,"B")
"IX",2006.582,2006.582,"B",11.1,0)
^.114IA^3^3
"IX",2006.582,2006.582,"B",11.1,1,0)
1^F^2006.582^.01^30^1^F
"IX",2006.582,2006.582,"B",11.1,1,3)

"IX",2006.582,2006.582,"B",11.1,2,0)
2^F^2006.582^2^30^2^F
"IX",2006.582,2006.582,"B",11.1,2,3)

"IX",2006.582,2006.582,"B",11.1,3,0)
3^F^2006.582^3^30^3^F
"IX",2006.582,2006.582,"B",11.1,3,3)

"IX",2006.5839,2006.5839,"C",0)
2006.5839^C^Link image groups to temporary entities^R^^R^IR^I^2006.5839^^^^^LS
"IX",2006.5839,2006.5839,"C",.1,0)
^^5^5^3020409^
"IX",2006.5839,2006.5839,"C",.1,1,0)
This cross-reference keeps track of which image groups are
"IX",2006.5839,2006.5839,"C",.1,2,0)
associated with which temporary entities.
"IX",2006.5839,2006.5839,"C",.1,3,0)
 
"IX",2006.5839,2006.5839,"C",.1,4,0)
This cross-reference will be used to associate all images
"IX",2006.5839,2006.5839,"C",.1,5,0)
in these groups to their permanent "parent data file".
"IX",2006.5839,2006.5839,"C",1)
S ^MAG(2006.5839,"C",X(1),X(2),DA)=""
"IX",2006.5839,2006.5839,"C",2)
K ^MAG(2006.5839,"C",X(1),X(2),DA)
"IX",2006.5839,2006.5839,"C",2.5)
K ^MAG(2006.5839,"C")
"IX",2006.5839,2006.5839,"C",11.1,0)
^.114IA^2^2
"IX",2006.5839,2006.5839,"C",11.1,1,0)
1^F^2006.5839^.01^^1^F
"IX",2006.5839,2006.5839,"C",11.1,2,0)
2^F^2006.5839^2^^2^F
"KRN",19,21910,-1)
2^2
"KRN",19,21910,0)
MAGD DICOM MENU^Dicom Menu Options^^M^133^^^^^^^
"KRN",19,21910,10,0)
^19.01IP^5^5
"KRN",19,21910,10,4,0)
21937
"KRN",19,21910,10,4,"^")
MAGD FIX CLINSPEC DICOM FILE
"KRN",19,21910,10,5,0)
21938
"KRN",19,21910,10,5,"^")
MAGD LIST UNREAD STUDIES
"KRN",19,21910,"U")
DICOM MENU OPTIONS
"KRN",19,21937,-1)
0^1
"KRN",19,21937,0)
MAGD FIX CLINSPEC DICOM FILE^Correct Clinical Specialties DICOM File Entries^^R^^^^^^^^IMAGING
"KRN",19,21937,1,0)
^^7^7^3020816^
"KRN",19,21937,1,1,0)
This menu option will allow corrections to be made on DICOM files which 
"KRN",19,21937,1,2,0)
failed during the downloading process on DICOM Image gateways.  The 
"KRN",19,21937,1,3,0)
routine used on the Dicom Image gateway will sometime fail to match 
"KRN",19,21937,1,4,0)
exactly on the patient's name, ssn or GMR number and thus a reference to 
"KRN",19,21937,1,5,0)
the failed file will be written to the MAGD(2006.575 global. This menu 
"KRN",19,21937,1,6,0)
option will read from this global and allow manual corrections so the 
"KRN",19,21937,1,7,0)
entries can be reprocessed on the DICOM Image gateways.
"KRN",19,21937,25)
START^MAGDCCSD
"KRN",19,21937,"U")
CORRECT CLINICAL SPECIALTIES D
"KRN",19,21938,-1)
0^3
"KRN",19,21938,0)
MAGD LIST UNREAD STUDIES^List Unread Studies^^R^^^^^^^^
"KRN",19,21938,25)
ENTRY^MAGDRCU1
"KRN",19,21938,"U")
LIST UNREAD STUDIES
"KRN",101,5213,-1)
0^1
"KRN",101,5213,0)
MAGD APPOINTMENT^IMAGING APPOINTMENT SCHEDULER^^A^^^^^^^^
"KRN",101,5213,1,0)
^101.06^1^1^3020607^^^^
"KRN",101,5213,1,1,0)
This protocol will be used with Scheduling to pass information to Imaging.
"KRN",101,5213,4)
^^^MAGD
"KRN",101,5213,20)
D ^MAGDHWS
"KRN",101,5213,99)
59473,43690
"KRN",101,5214,-1)
0^2
"KRN",101,5214,0)
MAGD RECEIVE EVENTS^Imaging Receive GMRC Events^^A^^^^^^^^
"KRN",101,5214,1,0)
^^2^2^3020523^
"KRN",101,5214,1,1,0)
This protocol will be a subscriber to the GMRC EVSEND OR protocol and is
"KRN",101,5214,1,2,0)
used to pass HL7 event messages to Imaging. 
"KRN",101,5214,20)
D ENTRY^MAGDHWC
"KRN",101,5214,99)
59473,43690
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",481,-1)
1^1
"PKG",481,0)
IMAGING^MAG^VistA Imaging
"PKG",481,20,0)
^9.402P^^
"PKG",481,22,0)
^9.49I^1^1
"PKG",481,22,1,0)
3.0^3020319^3020821^133
"PKG",481,22,1,"PAH",1,0)
10^3031106^133
"PKG",481,22,1,"PAH",1,1,0)
^^30^30^3031106
"PKG",481,22,1,"PAH",1,1,1,0)
                     
"PKG",481,22,1,"PAH",1,1,2,0)
Routines required for capturing DICOM images for Consults and Procedures.
"PKG",481,22,1,"PAH",1,1,3,0)
 
"PKG",481,22,1,"PAH",1,1,4,0)
Routine checksums:
"PKG",481,22,1,"PAH",1,1,5,0)
 
"PKG",481,22,1,"PAH",1,1,6,0)
MAGDCCS   value = 12895252
"PKG",481,22,1,"PAH",1,1,7,0)
MAGDCCS2  value = 6369003
"PKG",481,22,1,"PAH",1,1,8,0)
MAGDCCS3  value = 3965440
"PKG",481,22,1,"PAH",1,1,9,0)
MAGDCCSD  value = 4446663
"PKG",481,22,1,"PAH",1,1,10,0)
MAGDCCSS  value = 5605002
"PKG",481,22,1,"PAH",1,1,11,0)
MAGDGMRC  value = 8587567
"PKG",481,22,1,"PAH",1,1,12,0)
MAGDHW0   value = 4070033
"PKG",481,22,1,"PAH",1,1,13,0)
MAGDHWA   value = 13363951
"PKG",481,22,1,"PAH",1,1,14,0)
MAGDHWC   value = 10917214
"PKG",481,22,1,"PAH",1,1,15,0)
MAGDHWS   value = 8433031
"PKG",481,22,1,"PAH",1,1,16,0)
MAGDLB6   value = 3354488
"PKG",481,22,1,"PAH",1,1,17,0)
MAGDLBSR  value = 5467588
"PKG",481,22,1,"PAH",1,1,18,0)
MAGDRA1   value = 7630701
"PKG",481,22,1,"PAH",1,1,19,0)
MAGDRA2   value = 7852272
"PKG",481,22,1,"PAH",1,1,20,0)
MAGDRCU1  value = 8444320
"PKG",481,22,1,"PAH",1,1,21,0)
MAGDRCU2  value = 9677365
"PKG",481,22,1,"PAH",1,1,22,0)
MAGDROUT  value = 5323100
"PKG",481,22,1,"PAH",1,1,23,0)
MAGGNTI   value = 9622527
"PKG",481,22,1,"PAH",1,1,24,0)
MAGGTIA2  value = 7860990
"PKG",481,22,1,"PAH",1,1,25,0)
MAGIPS10  value = 5448905
"PKG",481,22,1,"PAH",1,1,26,0)
MAGSDEL2  value = 7540929
"PKG",481,22,1,"PAH",1,1,27,0)
MAGSDHCP  value = 3713231
"PKG",481,22,1,"PAH",1,1,28,0)
 
"PKG",481,22,1,"PAH",1,1,29,0)
Please note that routine MAGIPS10 will be deleted after the KIDS Build is 
"PKG",481,22,1,"PAH",1,1,30,0)
installed.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
22
"RTN","MAGDCCS")
0^10^B51999148
"RTN","MAGDCCS",1,0)
MAGDCCS ;WOIFO/MLH - DICOM Correct - Clinical Specialties ; 24 Jul 2002  9:35 AM
"RTN","MAGDCCS",2,0)
 ;;3.0;IMAGING;**10**;Nov 06, 2003
"RTN","MAGDCCS",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDCCS",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDCCS",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDCCS",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDCCS",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDCCS",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDCCS",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDCCS",10,0)
 ;; |                                                               |
"RTN","MAGDCCS",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDCCS",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDCCS",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDCCS",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDCCS",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDCCS",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDCCS",17,0)
 ;;
"RTN","MAGDCCS",18,0)
 Q
"RTN","MAGDCCS",19,0)
L ;Loop thru the entire file for entries that need processing
"RTN","MAGDCCS",20,0)
 ;The "F" xref is set for unique Study UIDs. The entry setting this xref
"RTN","MAGDCCS",21,0)
 ;will also have a "RLATE" node with all the Xray images associated with
"RTN","MAGDCCS",22,0)
 ;that unique Study UID.
"RTN","MAGDCCS",23,0)
 N ANS,ANSR,CASENO,COMNT1,DATA,DATA1,DATA2,DATE,FILE,FIRST,FIRSTS
"RTN","MAGDCCS",24,0)
 N MACHID,MAGDY,MAGDIEN,MAGIEN,MAGTYPE,MSG,START,STOP
"RTN","MAGDCCS",25,0)
 N MOD,MODEL,NEWCAS,NEWDFN,NEWDTI,NEWDTIM,NEWMUL,NEWNME,NEWPIEN,NEWPROC
"RTN","MAGDCCS",26,0)
 N NEWSSN,OK,OOUT,OUT,PAT,PID,PP,PREV,PREVS,REASON,STUDYUID,WHY,MAGFIX
"RTN","MAGDCCS",27,0)
 I '$D(^MAGD(2006.575,"F")) W !,"Nothing to process!" Q
"RTN","MAGDCCS",28,0)
 S (MAGIEN,SUID,OOUT,OUT,PREV,FIRST)=0
"RTN","MAGDCCS",29,0)
 F  S SUID=$O(^MAGD(2006.575,"F",SUID)) Q:SUID=""!(OOUT)  D
"RTN","MAGDCCS",30,0)
 . S MAGIEN=$O(^MAGD(2006.575,"F",SUID,0)) Q:'MAGIEN
"RTN","MAGDCCS",31,0)
 . I '$D(^MAGD(2006.575,MAGIEN,0)) D  Q
"RTN","MAGDCCS",32,0)
 . . K ^MAGD(2006.575,"F",SUID,MAGIEN),^MAGD(2006.575,MAGIEN,0)
"RTN","MAGDCCS",33,0)
 . ;Only process clinical specialties images... radiology and medicine images done by other rtns.
"RTN","MAGDCCS",34,0)
 . S MAGTYPE=$P($G(^MAGD(2006.575,MAGIEN,"TYPE")),"^") I MAGTYPE'="CON" Q
"RTN","MAGDCCS",35,0)
 . I $D(^MAGD(2006.575,MAGIEN,"FIXD")),$P(^MAGD(2006.575,MAGIEN,"FIXD"),"^") Q
"RTN","MAGDCCS",36,0)
 . I 'FIRST S PREV=MAGIEN,PREVS=SUID,FIRST=MAGIEN
"RTN","MAGDCCS",37,0)
 . D SET
"RTN","MAGDCCS",38,0)
 Q
"RTN","MAGDCCS",39,0)
DISPLAY ;
"RTN","MAGDCCS",40,0)
 S OUT=0
"RTN","MAGDCCS",41,0)
 W !,"**************Processing entry**********"
"RTN","MAGDCCS",42,0)
 W !!,?2,"PATIENT: ",PAT,?50,"SSN: ",PID,!,"Request/Consultation #: ",CASENO
"RTN","MAGDCCS",43,0)
 W !,?2,"Equipment: ",MOD,?50,"Model: ",MODEL
"RTN","MAGDCCS",44,0)
 W !,?2,"Date Processed: ",DATE,?50,"Problem with: ",REASON
"RTN","MAGDCCS",45,0)
 W !,?2,"Comment: ",COMNT1
"RTN","MAGDCCS",46,0)
 W !,?2,"Correcting file on server ID: ",MACHID,!,?5,FILE
"RTN","MAGDCCS",47,0)
 S MSG="Do you want to Correct this entry? "
"RTN","MAGDCCS",48,0)
 Q
"RTN","MAGDCCS",49,0)
NEWCASE ;
"RTN","MAGDCCS",50,0)
 S NEWDFN=$P(MAGDY,"^"),NEWNME=$P(MAGDY,"^",2),NEWSSN=$P(MAGDY,"^",3)
"RTN","MAGDCCS",51,0)
 S NEWCAS=$P(MAGDY,"^",4),NEWPROC=$P(MAGDY,"^",5),NEWDTI=$P(MAGDY,"^",6)
"RTN","MAGDCCS",52,0)
 S NEWMUL=$P(MAGDY,"^",7),NEWPIEN=$P(MAGDY,"^",8),PP=$P(MAGDY,"^",9)
"RTN","MAGDCCS",53,0)
 Q
"RTN","MAGDCCS",54,0)
ASK() ;
"RTN","MAGDCCS",55,0)
 N ANS,ASK
"RTN","MAGDCCS",56,0)
ASK1 S ASK="Y/N/D/Q"
"RTN","MAGDCCS",57,0)
 I $G(PREV)'=$G(MAGIEN),MAGTYPE="CON" S ASK=ASK_"/P"
"RTN","MAGDCCS",58,0)
 W !,$G(MSG),"("_ASK_")// " R ANS:600
"RTN","MAGDCCS",59,0)
 I '$T!(ANS["^") Q "^"
"RTN","MAGDCCS",60,0)
 I ANS="" Q "N"
"RTN","MAGDCCS",61,0)
 I "YNDPQyndpq"'[$E(ANS) D  G ASK1
"RTN","MAGDCCS",62,0)
 . W !,"Please respond with one of the following codes."
"RTN","MAGDCCS",63,0)
 . W !,"Legend: Y=yes, N=no, D=delete, P=Previous entry, and Q=quit",!
"RTN","MAGDCCS",64,0)
 S ANS=$TR(ANS,"yndpq","YNDPQ")
"RTN","MAGDCCS",65,0)
 Q $E(ANS)
"RTN","MAGDCCS",66,0)
CHK ;remove any punctuation before doing comparison on SSN
"RTN","MAGDCCS",67,0)
 ;stop on 1st check.
"RTN","MAGDCCS",68,0)
 N OLD,I
"RTN","MAGDCCS",69,0)
 S OLD="" F I=1:1:$L(PID) I $E(PID,I)?1AN S OLD=OLD_$E(PID,I)
"RTN","MAGDCCS",70,0)
 I NEWSSN'=OLD D  Q
"RTN","MAGDCCS",71,0)
 . S MSG="Social Security numbers do not match. Update? "
"RTN","MAGDCCS",72,0)
 I NEWNME'=PAT D  Q
"RTN","MAGDCCS",73,0)
 . S MSG="Patient names do not match. Update? "
"RTN","MAGDCCS",74,0)
 ;Finally the problem is with the case number...either no longer in "C"
"RTN","MAGDCCS",75,0)
 ;xref or invalid number provided
"RTN","MAGDCCS",76,0)
 S MSG="Accession number different. Update? "
"RTN","MAGDCCS",77,0)
 Q
"RTN","MAGDCCS",78,0)
NEWDIS ;
"RTN","MAGDCCS",79,0)
 W !,?2,"****Please review the following: *****"
"RTN","MAGDCCS",80,0)
 W !,?2,"Previous name: ",PAT,!,?2,"     New name: ",NEWNME
"RTN","MAGDCCS",81,0)
 W !,?2,"Previous ssn: ",PID,!,?2,"     New ssn: ",NEWSSN
"RTN","MAGDCCS",82,0)
 W !,?2,"Previous request/consultation #: ",CASENO,!,?2,"     New request/consultation #: ",NEWCAS
"RTN","MAGDCCS",83,0)
 ; Variable PP already has text message about being part of printset.
"RTN","MAGDCCS",84,0)
 Q
"RTN","MAGDCCS",85,0)
UPDT ;
"RTN","MAGDCCS",86,0)
 W !,"Will change the following: " D NEWDIS
"RTN","MAGDCCS",87,0)
 W !,"Are you sure you want to correct this entry? " S %=2 D YN^DICN
"RTN","MAGDCCS",88,0)
 I %=-1!(%=2) S OUT=1 Q
"RTN","MAGDCCS",89,0)
 W !,"Updating the file."
"RTN","MAGDCCS",90,0)
 S NEWDTIM=$TR(NEWDTI,"0123456789","9876543210")
"RTN","MAGDCCS",91,0)
 S ^MAGD(2006.575,MAGIEN,"FIXD")="1^"_NEWDFN_"^"_NEWNME_"^"_NEWSSN_"^"_NEWCAS_"^"_NEWDTI_"^"_NEWMUL_"^"_NEWDTIM W "."
"RTN","MAGDCCS",92,0)
 S ^MAGD(2006.575,MAGIEN,"FIXPR")=NEWPIEN_"^"_NEWPROC W "."
"RTN","MAGDCCS",93,0)
 ;Same as ^radpt(newdfn,"DT",newdti,"P",newmul,0) & ^RAMIS(71,newpien,0)
"RTN","MAGDCCS",94,0)
 S MACHID=$S(MACHID="":"A",1:MACHID)   ;servier ID
"RTN","MAGDCCS",95,0)
 S ^MAGD(2006.575,"AFX",MACHID,MAGIEN)="" W "."
"RTN","MAGDCCS",96,0)
 ;Xref to loop & process entries; processing will be minimal.
"RTN","MAGDCCS",97,0)
 S MAGFIX(MAGIEN)="F"
"RTN","MAGDCCS",98,0)
 Q
"RTN","MAGDCCS",99,0)
SETDEL ;Entry to be deleted
"RTN","MAGDCCS",100,0)
 D LOGERR I ANS="^" S OUT=1 Q
"RTN","MAGDCCS",101,0)
 S ^MAGD(2006.575,"AFX",MACHID,MAGIEN)="D"
"RTN","MAGDCCS",102,0)
 S $P(^MAGD(2006.575,MAGIEN,0),"^",6)="1"
"RTN","MAGDCCS",103,0)
 S ^MAGD(2006.575,MAGIEN,"FIXD")=1
"RTN","MAGDCCS",104,0)
 S MAGFIX(MAGIEN)="D"
"RTN","MAGDCCS",105,0)
 Q
"RTN","MAGDCCS",106,0)
LOGERR ;Need to record error
"RTN","MAGDCCS",107,0)
 N DIR,DIRUT,DTOUT,ENTRY,I,MAGERR,MAGOUT,X,Y,WHY,WHO
"RTN","MAGDCCS",108,0)
 W !! F I=1:1:80 W "*"
"RTN","MAGDCCS",109,0)
 W !,"*** Will log in error log (file 2006.599). ****"
"RTN","MAGDCCS",110,0)
 D NOW^%DTC
"RTN","MAGDCCS",111,0)
 S DIR(0)="F^3:30"
"RTN","MAGDCCS",112,0)
 S DIR("A")="Reason for deletion"
"RTN","MAGDCCS",113,0)
 S DIR("A",1)="Please enter a reason for deleting."
"RTN","MAGDCCS",114,0)
 S DIR("A",2)="For example: TEST PATIENT"
"RTN","MAGDCCS",115,0)
 D ^DIR
"RTN","MAGDCCS",116,0)
 I $D(DIRUT)!($D(DTOUT))!(Y="") D  S ANS="^" Q
"RTN","MAGDCCS",117,0)
 . W !,"Can not delete if a reason is not provided."
"RTN","MAGDCCS",118,0)
 . Q
"RTN","MAGDCCS",119,0)
 S WHY=Y,WHO=$G(DUZ)
"RTN","MAGDCCS",120,0)
 I WHO D 
"RTN","MAGDCCS",121,0)
 . D GETS^DIQ(200,DUZ,".01","E","MAGOUT","MAGERR")
"RTN","MAGDCCS",122,0)
 . Q:$D(MAGERR("DIERR"))
"RTN","MAGDCCS",123,0)
 . S WHO=$G(MAGOUT(200,DUZ_",",.01,"E"))
"RTN","MAGDCCS",124,0)
 I WHO="" S WHO="UNKNOWN"
"RTN","MAGDCCS",125,0)
 I '$D(^MAGD(2006.599,0)) D
"RTN","MAGDCCS",126,0)
 . S ^MAGD(2006.599,0)="Dicom Error Log^2006.599^^"
"RTN","MAGDCCS",127,0)
 . Q
"RTN","MAGDCCS",128,0)
 S ENTRY=$P(^MAGD(2006.599,0),"^",3)+1
"RTN","MAGDCCS",129,0)
 S $P(^MAGD(2006.599,0),"^",3)=ENTRY
"RTN","MAGDCCS",130,0)
 S $P(^MAGD(2006.599,0),"^",4)=$P(^MAGD(2006.599,0),"^",4)+1
"RTN","MAGDCCS",131,0)
 S ^MAGD(2006.599,ENTRY,0)=%_"^"_WHY_"^"_FILE_"^"_MODEL
"RTN","MAGDCCS",132,0)
 S ^MAGD(2006.599,ENTRY,1)=WHO_"^"_PAT_"^"_PID_"^"_CASENO_"^"_MACHID
"RTN","MAGDCCS",133,0)
 S ^MAGD(2006.599,"B",%,ENTRY)=""
"RTN","MAGDCCS",134,0)
 Q
"RTN","MAGDCCS",135,0)
SET ;
"RTN","MAGDCCS",136,0)
 S MAGTYPE=$P(^MAGD(2006.575,MAGIEN,"TYPE"),"^")
"RTN","MAGDCCS",137,0)
 Q:$P($G(^MAGD(2006.575,MAGIEN,"FIXD")),"^")    ;Already fixed.
"RTN","MAGDCCS",138,0)
 ;Only process Clinical Specialties images...radiology & medicine images done by other rtns.
"RTN","MAGDCCS",139,0)
 I MAGTYPE'["CON" Q
"RTN","MAGDCCS",140,0)
 S DATA=^MAGD(2006.575,MAGIEN,0)
"RTN","MAGDCCS",141,0)
 S FILE=$P(^MAGD(2006.575,MAGIEN,0),"^")
"RTN","MAGDCCS",142,0)
 S DATA1=^MAGD(2006.575,MAGIEN,1)    ;Case no. info
"RTN","MAGDCCS",143,0)
 S DATA2=^MAGD(2006.575,MAGIEN,"AMFG")    ;Modality info
"RTN","MAGDCCS",144,0)
 S PAT=$P(DATA,"^",4),PID=$P(DATA,"^",3),REASON=$P(DATA,"^",2)
"RTN","MAGDCCS",145,0)
 S MOD=$P(DATA2,"^"),MODEL=$P(DATA2,"^",6)
"RTN","MAGDCCS",146,0)
 S CASENO=$P(DATA1,"^",2),MACHID=$P(DATA1,"^",4)
"RTN","MAGDCCS",147,0)
 S Y=$P(DATA1,"^",3) X ^DD("DD") S DATE=Y
"RTN","MAGDCCS",148,0)
 S COMNT1=$G(^MAGD(2006.575,MAGIEN,"ACSTXT")) ;1st line comment.
"RTN","MAGDCCS",149,0)
 S MACHID=$P(DATA1,"^",4)
"RTN","MAGDCCS",150,0)
 S ANS="" D DISPLAY S ANS=$$ASK
"RTN","MAGDCCS",151,0)
 I ANS="Q"!(ANS["^") S (OOUT,OUT)=1 D SETPREV Q
"RTN","MAGDCCS",152,0)
 I ANS="N" S OUT=1 D SETPREV Q
"RTN","MAGDCCS",153,0)
 I ANS="P" D CHKPREV Q
"RTN","MAGDCCS",154,0)
 I ANS="D" D SETDEL,SETPREV Q
"RTN","MAGDCCS",155,0)
 Q:OUT
"RTN","MAGDCCS",156,0)
 K MAGDY W !," Lookup by case number or patient name"
"RTN","MAGDCCS",157,0)
LOOK ;
"RTN","MAGDCCS",158,0)
 ;D ^MAGDLB2 Q:'$D(MAGDY)  Q:MAGDY'[""
"RTN","MAGDCCS",159,0)
 D EN^MAGDCCS2 Q:'$D(MAGDY)  Q:MAGDY'[""
"RTN","MAGDCCS",160,0)
 D NEWCASE,CHK,NEWDIS S ANS=$$ASK
"RTN","MAGDCCS",161,0)
 ;W !,"Sorry, under construction (",$T(+0),")... please try again later.",! Q
"RTN","MAGDCCS",162,0)
 I ANS="Q"!(ANS["^") S (OOUT,OUT)=1 D SETPREV Q
"RTN","MAGDCCS",163,0)
 I ANS="D" D SETDEL,SETPREV Q
"RTN","MAGDCCS",164,0)
 I ANS="P" D CHKPREV Q
"RTN","MAGDCCS",165,0)
 I ANS="N" S OUT=1 D SETPREV Q
"RTN","MAGDCCS",166,0)
 Q:OUT
"RTN","MAGDCCS",167,0)
 D UPDT
"RTN","MAGDCCS",168,0)
 I ANS="P" D CHKPREV Q
"RTN","MAGDCCS",169,0)
 D SETMAG
"RTN","MAGDCCS",170,0)
 Q
"RTN","MAGDCCS",171,0)
DATELOOP(START,STOP) ;Loop thru the "AD" cross reference
"RTN","MAGDCCS",172,0)
 N MAGIEN,SUID,THEDT,FIRST,OOUT,MAGFIX
"RTN","MAGDCCS",173,0)
 S THEDT=START-.1,(OOUT,FIRST)=0
"RTN","MAGDCCS",174,0)
 F  S THEDT=$O(^MAGD(2006.575,"AD",THEDT)) Q:'THEDT!(THEDT>STOP)!(OOUT)  D
"RTN","MAGDCCS",175,0)
 . S MAGIEN=0
"RTN","MAGDCCS",176,0)
 . F  S MAGIEN=$O(^MAGD(2006.575,"AD",THEDT,MAGIEN)) Q:'MAGIEN  D
"RTN","MAGDCCS",177,0)
 . . I '$D(^MAGD(2006.575,MAGIEN,0)) K ^MAGD(2006.575,"AD",THEDT,MAGIEN)
"RTN","MAGDCCS",178,0)
 . . I $D(^MAGD(2006.575,MAGIEN,"TYPE")),$P(^MAGD(2006.575,MAGIEN,"TYPE"),"^")'["CON" Q
"RTN","MAGDCCS",179,0)
 . . I 'FIRST S PREV=MAGIEN,FIRST=1
"RTN","MAGDCCS",180,0)
 . . D SET
"RTN","MAGDCCS",181,0)
 . . Q
"RTN","MAGDCCS",182,0)
 . Q
"RTN","MAGDCCS",183,0)
 Q
"RTN","MAGDCCS",184,0)
SETPREV ;
"RTN","MAGDCCS",185,0)
 S PREV=MAGIEN,PREVS=$G(SUID)
"RTN","MAGDCCS",186,0)
 Q
"RTN","MAGDCCS",187,0)
SETMAG ;
"RTN","MAGDCCS",188,0)
 S FIRST=MAGIEN,FIRSTS=$G(SUID),MAGIEN=PREV,SUID=$G(PREVS)
"RTN","MAGDCCS",189,0)
 S PREV=FIRST,PREVS=FIRSTS
"RTN","MAGDCCS",190,0)
 Q
"RTN","MAGDCCS",191,0)
CHKPREV ;
"RTN","MAGDCCS",192,0)
 S OUT=1 N STATUS
"RTN","MAGDCCS",193,0)
 I '$D(MAGFIX(PREV)) D SETMAG G SET
"RTN","MAGDCCS",194,0)
 S STATUS=$S($G(MAGFIX(PREV))="D":"deleted",1:"corrected")
"RTN","MAGDCCS",195,0)
 W !,"Previous entry has been "_STATUS_".",$C(7)
"RTN","MAGDCCS",196,0)
 G SET
"RTN","MAGDCCS",197,0)
 Q
"RTN","MAGDCCS2")
0^11^B15767698
"RTN","MAGDCCS2",1,0)
MAGDCCS2 ;WOIFO/MLH - DICOM Correct - Clinical Specialties - subroutines ; 12 Aug 2003  4:33 PM
"RTN","MAGDCCS2",2,0)
 ;;3.0;IMAGING;**10**;Nov 06, 2003
"RTN","MAGDCCS2",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDCCS2",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDCCS2",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDCCS2",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDCCS2",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDCCS2",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDCCS2",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDCCS2",10,0)
 ;; |                                                               |
"RTN","MAGDCCS2",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDCCS2",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDCCS2",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDCCS2",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDCCS2",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDCCS2",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDCCS2",17,0)
 ;;
"RTN","MAGDCCS2",18,0)
 Q
"RTN","MAGDCCS2",19,0)
 ;Routine to create the MAGDY variable needed by MAGDCCS routine when
"RTN","MAGDCCS2",20,0)
 ;manually correcting DICOM FIX files. 
"RTN","MAGDCCS2",21,0)
EN ;
"RTN","MAGDCCS2",22,0)
 ; MAGDY variable to be created during this execution.
"RTN","MAGDCCS2",23,0)
 N MAGBEG,MAGEND,MAGDFN,MAGOUT,MAGX,MAGXX,INFO,MAGNME,MAGSSN
"RTN","MAGDCCS2",24,0)
 S MAGBEG=1070101,MAGEND=$$DT^XLFDT
"RTN","MAGDCCS2",25,0)
READ ;
"RTN","MAGDCCS2",26,0)
 ;MLH Note to self:  Consider using GETS^DIQ here.
"RTN","MAGDCCS2",27,0)
 N MAGY0
"RTN","MAGDCCS2",28,0)
 W !,"*** Select a request/consult with whose ***"
"RTN","MAGDCCS2",29,0)
 W !,"***  TIU note to associate this image   ***"
"RTN","MAGDCCS2",30,0)
 S DIC="^GMR(123,",DIC(0)="AENZ"
"RTN","MAGDCCS2",31,0)
 S DIC("A")="Enter patient or request/consultation: "
"RTN","MAGDCCS2",32,0)
 S D="F",DZ="??"
"RTN","MAGDCCS2",33,0)
 S DIC("W")="S MAGY0=^GMR(123,Y,0) W ""  REQ/CON #"",Y"
"RTN","MAGDCCS2",34,0)
 S DIC("W")=DIC("W")_",""  "",$P($G(^GMR(123.5,+$P(MAGY0,U,5),0)),U)"
"RTN","MAGDCCS2",35,0)
 S DIC("W")=DIC("W")_",""  "",$P($G(^DPT(+$P(MAGY0,U,2),0)),U)"
"RTN","MAGDCCS2",36,0)
 ;S DIC("W")=DIC("W")_",""  X="",$G(X)" ; <<< *** debug / test
"RTN","MAGDCCS2",37,0)
 ;
"RTN","MAGDCCS2",38,0)
 D IX^DIC
"RTN","MAGDCCS2",39,0)
 Q:$D(DUOUT)
"RTN","MAGDCCS2",40,0)
 Q:'$D(Y(0))  ; nothing selected
"RTN","MAGDCCS2",41,0)
 S (MAGDFN,MAGX)=$P(Y(0),U,2)_"~"_Y
"RTN","MAGDCCS2",42,0)
 ;ZW MAGDFN ; <<< *** debug/test!
"RTN","MAGDCCS2",43,0)
 ;
"RTN","MAGDCCS2",44,0)
 D ONE  ;Lookup was on req/con number and successful
"RTN","MAGDCCS2",45,0)
 Q
"RTN","MAGDCCS2",46,0)
 ;
"RTN","MAGDCCS2",47,0)
PTINFO() ;
"RTN","MAGDCCS2",48,0)
 N INFO,MAGOUT
"RTN","MAGDCCS2",49,0)
 I '$D(MAGDFN) Q ""
"RTN","MAGDCCS2",50,0)
 D GETS^DIQ(2,MAGDFN,".01;.09","E","MAGOUT","MAGERR")
"RTN","MAGDCCS2",51,0)
 I $D(MAGERR) Q ""
"RTN","MAGDCCS2",52,0)
 I $D(MAGOUT) D  Q INFO
"RTN","MAGDCCS2",53,0)
 . S INFO=$G(MAGOUT(2,MAGDFN_",",.01,"E"))
"RTN","MAGDCCS2",54,0)
 . S INFO=INFO_"^"_$G(MAGOUT(2,MAGDFN_",",.09,"E"))
"RTN","MAGDCCS2",55,0)
 Q ""
"RTN","MAGDCCS2",56,0)
 ;
"RTN","MAGDCCS2",57,0)
ONE ;Process the single entry that was selected.
"RTN","MAGDCCS2",58,0)
 ;MAGDFN,MAGX variables expected from EN
"RTN","MAGDCCS2",59,0)
 I 'MAGDFN,'+MAGX Q
"RTN","MAGDCCS2",60,0)
 N BEG,CASE,CDATE,CS,DATA,END,FLDS,INFO,MAGCASE,MAGCNI,MAGDATE,MAGDTI
"RTN","MAGDCCS2",61,0)
 N MAGEXST,MAGLOC,MAGNME,MAGOUT,MAGPIEN,MAGPRC,MAGPSET,MAGPST,MAGRPT
"RTN","MAGDCCS2",62,0)
 N PP,PSET,RAENTRY,RAMEMLOW,RAPRTSET,RIEN,STAT,X,X1,X2,XX
"RTN","MAGDCCS2",63,0)
 N RARPT,RADFN,RADTI,RACNI ;<--Variables needed for EN1^RAUTL20
"RTN","MAGDCCS2",64,0)
 ; RAUTL20 used to retrieve if case is part of a print set.
"RTN","MAGDCCS2",65,0)
 N MAGRCARY ; array of req/con data from file 123
"RTN","MAGDCCS2",66,0)
 N MAGIENS  ; internal entry number for MAGRCARY
"RTN","MAGDCCS2",67,0)
 ;Q:'MAGDFN!'+$G(MAGX)
"RTN","MAGDCCS2",68,0)
 S MAGDFN=$P(MAGX,"~"),INFO=$$PTINFO
"RTN","MAGDCCS2",69,0)
 S MAGNME=$P(INFO,"^"),MAGSSN=$P(INFO,"^",2)
"RTN","MAGDCCS2",70,0)
 S MAGCASE=$P($P(MAGX,"~",2),U)
"RTN","MAGDCCS2",71,0)
 S (MAGPRC,MAGDTI,MAGCNI,MAGPIEN,MAGLOC,MAGDATE,MAGEXST,MAGPST)=""
"RTN","MAGDCCS2",72,0)
 K MAGRCARY D GETS^DIQ(123,MAGCASE,"*","EI","MAGRCARY")
"RTN","MAGDCCS2",73,0)
 ;I 1/0 ; debug breakpoint
"RTN","MAGDCCS2",74,0)
 S MAGIENS=$O(MAGRCARY(123,""))
"RTN","MAGDCCS2",75,0)
 S MAGPRC=MAGRCARY(123,MAGIENS,4,"E") ; procedure
"RTN","MAGDCCS2",76,0)
 S MAGLOC=MAGRCARY(123,MAGIENS,1,"E") ; to service
"RTN","MAGDCCS2",77,0)
 S MAGDATE=MAGRCARY(123,MAGIENS,.01,"E") ; request date
"RTN","MAGDCCS2",78,0)
 S MAGPST=MAGRCARY(123,MAGIENS,8,"E") ; procedure status
"RTN","MAGDCCS2",79,0)
 W !,"PATIENT: ",MAGNME,?51,"SSN: ",MAGSSN
"RTN","MAGDCCS2",80,0)
 W !,"Req/Con No.",?13,"Procedure",?38,"To Service",?58,"Req Date"
"RTN","MAGDCCS2",81,0)
 W !,"-----------",?13,"---------",?38,"----------------",?58,"--------"
"RTN","MAGDCCS2",82,0)
 W !,MAGCASE,?13,MAGPRC,?38,MAGLOC,?58,MAGDATE
"RTN","MAGDCCS2",83,0)
 W !,"Exam status: ",MAGEXST," "," ",$G(MAGPST)
"RTN","MAGDCCS2",84,0)
 D MAGDY
"RTN","MAGDCCS2",85,0)
 Q
"RTN","MAGDCCS2",86,0)
MAGDY ;
"RTN","MAGDCCS2",87,0)
 S MAGDY=MAGDFN_"^"_MAGNME_"^"_MAGSSN_"^"_"GMRC-"_MAGCASE_"^"_MAGPRC_"^"_MAGDTI
"RTN","MAGDCCS2",88,0)
 S MAGDY=MAGDY_"^"_MAGCNI_"^"_MAGPIEN_"^"_$G(MAGPST)_"^"
"RTN","MAGDCCS2",89,0)
 K MAGNME,MAGSSN,MAGCASE,MAGPRC,MAGDTI,MAGCNI,MAGPIEN,MAPST
"RTN","MAGDCCS2",90,0)
 Q
"RTN","MAGDCCS3")
0^12^B6214533
"RTN","MAGDCCS3",1,0)
MAGDCCS3 ;WOIFO/MLH - DICOM Correct - Clinical specialties - subroutines ; 12 Aug 2003  4:35 PM
"RTN","MAGDCCS3",2,0)
 ;;3.0;IMAGING;**10**;Nov 06, 2003
"RTN","MAGDCCS3",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDCCS3",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDCCS3",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDCCS3",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDCCS3",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDCCS3",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDCCS3",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDCCS3",10,0)
 ;; |                                                               |
"RTN","MAGDCCS3",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDCCS3",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDCCS3",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDCCS3",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDCCS3",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDCCS3",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDCCS3",17,0)
 ;;
"RTN","MAGDCCS3",18,0)
 Q
"RTN","MAGDCCS3",19,0)
ASK() ;Prompt user
"RTN","MAGDCCS3",20,0)
 N DIR,X,Y
"RTN","MAGDCCS3",21,0)
 S DIR(0)="F:1:30",DIR("A")="Enter patient or request/consultation number"
"RTN","MAGDCCS3",22,0)
 S DIR("?")="Enter a patient name or request/consultation number to associate with this image."
"RTN","MAGDCCS3",23,0)
 D ^DIR
"RTN","MAGDCCS3",24,0)
 Q Y
"RTN","MAGDCCS3",25,0)
READ(RESULT) ; Accept input for patient or request/consultation number.
"RTN","MAGDCCS3",26,0)
 ; We'll return patient DFN^NAME, or DFN~REQNO.
"RTN","MAGDCCS3",27,0)
 N ANS
"RTN","MAGDCCS3",28,0)
 S RESULT=0,ANS=$$ASK
"RTN","MAGDCCS3",29,0)
 I ANS=""!(ANS="^") S RESULT="^" Q RESULT
"RTN","MAGDCCS3",30,0)
 ;Is user trying to select on request/consult # or by patient?
"RTN","MAGDCCS3",31,0)
 I ANS?1.8N D REQCON(ANS,.RESULT) I +RESULT Q RESULT ; request/consult #
"RTN","MAGDCCS3",32,0)
 D:ANS'?.N1"-".E PAT(ANS,.RESULT) ; patient
"RTN","MAGDCCS3",33,0)
 Q RESULT
"RTN","MAGDCCS3",34,0)
REQCON(GMRIEN,RESULT) ; Validate existence of user-entered request/consultation number.
"RTN","MAGDCCS3",35,0)
 ;
"RTN","MAGDCCS3",36,0)
 I $D(^GMR(123,GMRIEN)) S RESULT=$P(^GMR(123,GMRIEN,0),"^",2)_"~"_GMRIEN
"RTN","MAGDCCS3",37,0)
 Q
"RTN","MAGDCCS3",38,0)
PAT(PAT,RESULT) ; Verify that patient exists and has requests/consults on file.
"RTN","MAGDCCS3",39,0)
 N DIR,X,Y
"RTN","MAGDCCS3",40,0)
 S DIR(0)="P^2:EMZ",DIR("B")=PAT
"RTN","MAGDCCS3",41,0)
 D ^DIR
"RTN","MAGDCCS3",42,0)
 I Y D
"RTN","MAGDCCS3",43,0)
 . W !,"Y=",Y,! ; ***<<< DEBUG
"RTN","MAGDCCS3",44,0)
 . I $D(^GMR(123,"F",+Y)) S RESULT=Y
"RTN","MAGDCCS3",45,0)
 . E  W !,"No requests/consultations on file for this patient.",!
"RTN","MAGDCCS3",46,0)
 . Q
"RTN","MAGDCCS3",47,0)
 Q
"RTN","MAGDCCSD")
0^13^B8014848
"RTN","MAGDCCSD",1,0)
MAGDCCSD ;WOIFO/MLH - DICOM Correct - Clinical Specialties - Driver ; 12 Aug 2003  12:52 PM
"RTN","MAGDCCSD",2,0)
 ;;3.0;IMAGING;**10**;Nov 06, 2003
"RTN","MAGDCCSD",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDCCSD",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDCCSD",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDCCSD",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDCCSD",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDCCSD",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDCCSD",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDCCSD",10,0)
 ;; |                                                               |
"RTN","MAGDCCSD",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDCCSD",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDCCSD",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDCCSD",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDCCSD",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDCCSD",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDCCSD",17,0)
 ;;
"RTN","MAGDCCSD",18,0)
 Q
"RTN","MAGDCCSD",19,0)
EN() ;Start looping either by patient or loop thru Study uid
"RTN","MAGDCCSD",20,0)
 N DIR,X,Y
"RTN","MAGDCCSD",21,0)
 S DIR(0)="S^P:Patient;L:Loop thru file;D:Specify a Date Range"
"RTN","MAGDCCSD",22,0)
 S DIR("A")="Update entries by"
"RTN","MAGDCCSD",23,0)
 D ^DIR
"RTN","MAGDCCSD",24,0)
 Q Y
"RTN","MAGDCCSD",25,0)
 ;
"RTN","MAGDCCSD",26,0)
START ;
"RTN","MAGDCCSD",27,0)
 N MAGSORT,MAGIEN,PREV,START,STOP,X,Y
"RTN","MAGDCCSD",28,0)
 S MAGSORT=$$EN Q:MAGSORT["^"
"RTN","MAGDCCSD",29,0)
 I MAGSORT="P" D  G EXIT
"RTN","MAGDCCSD",30,0)
 . L +^MAGD(2006.575,"D") D SRT^MAGDCCSS S MAGIEN=$$SELECT L -^MAGD(2006.575,"D") Q:MAGIEN<1
"RTN","MAGDCCSD",31,0)
 . I $D(^MAGD(2006.575,MAGIEN,"TYPE")),$P(^("TYPE"),"^")'="CON" D  Q
"RTN","MAGDCCSD",32,0)
 . . W !,"Only Clinical Specialties images may be fixed using this option."
"RTN","MAGDCCSD",33,0)
 . . Q
"RTN","MAGDCCSD",34,0)
 . S PREV=MAGIEN D SET^MAGDCCS
"RTN","MAGDCCSD",35,0)
 . Q
"RTN","MAGDCCSD",36,0)
 I MAGSORT="D" D  G EXIT
"RTN","MAGDCCSD",37,0)
 . D SRTDT^MAGDCCSS
"RTN","MAGDCCSD",38,0)
 . D ASKDT^MAGDCCSS
"RTN","MAGDCCSD",39,0)
 . I '$D(STR)!'($D(STP)) Q
"RTN","MAGDCCSD",40,0)
 . S START=STR,STOP=STP K STR,STP
"RTN","MAGDCCSD",41,0)
 . D DATELOOP^MAGDCCS(START,STOP)
"RTN","MAGDCCSD",42,0)
 . Q
"RTN","MAGDCCSD",43,0)
 E  D
"RTN","MAGDCCSD",44,0)
 . D L^MAGDCCS
"RTN","MAGDCCSD",45,0)
 . Q
"RTN","MAGDCCSD",46,0)
EXIT ;
"RTN","MAGDCCSD",47,0)
 K ANS,ANSR,CASENO,COMNT1,DATA,DATA1,DATA2,DATE,FILE,FIRST,FIRSTS,I,MACHID,MAGDY
"RTN","MAGDCCSD",48,0)
 K MAGDIEN,MAGCSE,MAGERR,MAGFIX,MAGDTPRT,MAGTYPE,MAGDTPRT,MAGSTP,MSG
"RTN","MAGDCCSD",49,0)
 K MOD,MODEL,NEWCAS,NEWDFN,NEWDTI,NEWDTIM,NEWMUL,NEWNME,NEWPIEN,NEWPROC
"RTN","MAGDCCSD",50,0)
 K NEWSSN,OK,OOUT,OUT,PAT,PID,PREV,PREVS,REASON,STUDYUID,SUID,WHY
"RTN","MAGDCCSD",51,0)
 Q
"RTN","MAGDCCSD",52,0)
SELECT() ;
"RTN","MAGDCCSD",53,0)
 N DIC,D,X,Y
"RTN","MAGDCCSD",54,0)
 S DIC="^MAGD(2006.575,",D="D",DIC(0)="AEQ"
"RTN","MAGDCCSD",55,0)
 D MIX^DIC1
"RTN","MAGDCCSD",56,0)
 Q +Y
"RTN","MAGDCCSD",57,0)
SLDATE() ;
"RTN","MAGDCCSD",58,0)
 N DIC,D,X,Y
"RTN","MAGDCCSD",59,0)
 S DIC="^MAGD(2006.575,",D="AD",DIC(0)="AE"
"RTN","MAGDCCSD",60,0)
 D MIX^DIC1
"RTN","MAGDCCSD",61,0)
 Q +Y
"RTN","MAGDCCSS")
0^14^B13079521
"RTN","MAGDCCSS",1,0)
MAGDCCSS ;WOIFO/MLH - DICOM Correct - Clinical Specialties - Sort/print for 2006.575 ; 12 Aug 2003  12:52 PM
"RTN","MAGDCCSS",2,0)
 ;;3.0;IMAGING;**10**;Nov 06, 2003
"RTN","MAGDCCSS",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDCCSS",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDCCSS",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDCCSS",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDCCSS",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDCCSS",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDCCSS",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDCCSS",10,0)
 ;; |                                                               |
"RTN","MAGDCCSS",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDCCSS",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDCCSS",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDCCSS",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDCCSS",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDCCSS",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDCCSS",17,0)
 ;;
"RTN","MAGDCCSS",18,0)
 Q
"RTN","MAGDCCSS",19,0)
SRT ;Sort the file first by the patient name but only the unique entries.
"RTN","MAGDCCSS",20,0)
 ;The "F" cross reference uses the study uid number.
"RTN","MAGDCCSS",21,0)
 N MAGSUID,MAGIEN,MAGPT ;
"RTN","MAGDCCSS",22,0)
 Q:'$D(^MAGD(2006.575,"F"))    ;nothing to sort
"RTN","MAGDCCSS",23,0)
 K ^MAGD(2006.575,"D")
"RTN","MAGDCCSS",24,0)
 S MAGSUID="" F  S MAGSUID=$O(^MAGD(2006.575,"F",MAGSUID)) Q:MAGSUID=""  D
"RTN","MAGDCCSS",25,0)
 . S MAGIEN=0 F  S MAGIEN=$O(^MAGD(2006.575,"F",MAGSUID,MAGIEN)) Q:'MAGIEN  D
"RTN","MAGDCCSS",26,0)
 . . I '$D(^MAGD(2006.575,MAGIEN,0)) D  Q   ;problem
"RTN","MAGDCCSS",27,0)
 . . . K ^MAGD(2006.575,"F",MAGSUID,MAGIEN)   ;clean up x-ref
"RTN","MAGDCCSS",28,0)
 . . . Q
"RTN","MAGDCCSS",29,0)
 . . ;Entry has been corrected do not include in sort
"RTN","MAGDCCSS",30,0)
 . . I $D(^MAGD(2006.575,MAGIEN,"FIXD")),$P(^("FIXD"),"^") Q
"RTN","MAGDCCSS",31,0)
 . . ;Only Clinical Specialties images!
"RTN","MAGDCCSS",32,0)
 . . S MAGTYPE=$P($G(^MAGD(2006.575,MAGIEN,"TYPE")),"^")
"RTN","MAGDCCSS",33,0)
 . . I MAGTYPE'="CON" Q
"RTN","MAGDCCSS",34,0)
 . . S MAGPT=$P(^MAGD(2006.575,MAGIEN,0),"^",4)
"RTN","MAGDCCSS",35,0)
 . . S ^MAGD(2006.575,"D",MAGPT,MAGIEN)=""
"RTN","MAGDCCSS",36,0)
 . . Q
"RTN","MAGDCCSS",37,0)
 . Q
"RTN","MAGDCCSS",38,0)
 Q
"RTN","MAGDCCSS",39,0)
SRTDT ;Provide sorting by date entry but only if NOT fixed and by unique suid
"RTN","MAGDCCSS",40,0)
 N MAGSUID,MAGIEN,MAGDT
"RTN","MAGDCCSS",41,0)
 Q:'$D(^MAGD(2006.575,"F"))
"RTN","MAGDCCSS",42,0)
 K ^MAGD(2006.575,"AD")
"RTN","MAGDCCSS",43,0)
 S MAGSUID="" F  S MAGSUID=$O(^MAGD(2006.575,"F",MAGSUID)) Q:MAGSUID=""  D
"RTN","MAGDCCSS",44,0)
 . S MAGIEN=0 F  S MAGIEN=$O(^MAGD(2006.575,"F",MAGSUID,MAGIEN)) Q:'MAGIEN  D
"RTN","MAGDCCSS",45,0)
 . . I '$D(^MAGD(2006.575,MAGIEN,0)) D  Q
"RTN","MAGDCCSS",46,0)
 . . . K ^MAGD(2006.575,"F",MAGSUID,MAGIEN)
"RTN","MAGDCCSS",47,0)
 . . . Q
"RTN","MAGDCCSS",48,0)
 . . I $D(^MAGD(2006.575,MAGIEN,"FIXD")),$P(^("FIXD"),"^") Q  ;corrected
"RTN","MAGDCCSS",49,0)
 . . Q:'$D(^MAGD(2006.575,MAGIEN,1))
"RTN","MAGDCCSS",50,0)
 . . S MAGDT=$P(^MAGD(2006.575,MAGIEN,1),"^",3)
"RTN","MAGDCCSS",51,0)
 . . S ^MAGD(2006.575,"AD",MAGDT,MAGIEN)=""
"RTN","MAGDCCSS",52,0)
 . . Q
"RTN","MAGDCCSS",53,0)
 . Q
"RTN","MAGDCCSS",54,0)
 Q
"RTN","MAGDCCSS",55,0)
PRTDT(SORT,START,STOP) ;
"RTN","MAGDCCSS",56,0)
 ;Print entries using the "AD" cross reference (date order)
"RTN","MAGDCCSS",57,0)
 ; OR the "F" cross reference (unique study uid)
"RTN","MAGDCCSS",58,0)
 I '$D(DUZ) W !,"DUZ variable not defined." Q
"RTN","MAGDCCSS",59,0)
 I "DF"'[SORT Q  ;only the date or unique suid
"RTN","MAGDCCSS",60,0)
 N DIC,BY,FLDS,L,FR,TO
"RTN","MAGDCCSS",61,0)
 ;I 'STOP!'START Q
"RTN","MAGDCCSS",62,0)
 S L(0)=2
"RTN","MAGDCCSS",63,0)
 I SORT="D" S SORT="AD" D
"RTN","MAGDCCSS",64,0)
 . I $L($G(START))>1,$L($G(STOP))>1 S FR(0,1)=START,TO(0,1)=STOP
"RTN","MAGDCCSS",65,0)
 S DIC="^MAGD(2006.575,",BY(0)="^MAGD(2006.575,"""_SORT_""","
"RTN","MAGDCCSS",66,0)
 S FLDS="[MAG FAILED IMAGES]",L=0
"RTN","MAGDCCSS",67,0)
 D EN1^DIP
"RTN","MAGDCCSS",68,0)
 Q
"RTN","MAGDCCSS",69,0)
ADATE() ;date
"RTN","MAGDCCSS",70,0)
 N DIR,X,Y
"RTN","MAGDCCSS",71,0)
 S DIR(0)="D^",DIR("A")=$G(MESSAGE) D ^DIR
"RTN","MAGDCCSS",72,0)
 Q Y
"RTN","MAGDCCSS",73,0)
ASKDT ;Ask date range
"RTN","MAGDCCSS",74,0)
 N MESSAGE
"RTN","MAGDCCSS",75,0)
 S MESSAGE="Enter start date" S STR=$$ADATE
"RTN","MAGDCCSS",76,0)
 Q:'STR
"RTN","MAGDCCSS",77,0)
 I STR'?7N W "Wrong date format." Q
"RTN","MAGDCCSS",78,0)
 S MESSAGE="Enter stop date" S STP=$$ADATE
"RTN","MAGDCCSS",79,0)
 I STP'?7N W "Wrong date format." Q
"RTN","MAGDCCSS",80,0)
 Q
"RTN","MAGDCCSS",81,0)
PRNT ;
"RTN","MAGDCCSS",82,0)
 N DIR,X,Y,BY
"RTN","MAGDCCSS",83,0)
 S DIR(0)="S^D:Date;F:Unique Entries"
"RTN","MAGDCCSS",84,0)
 D ^DIR
"RTN","MAGDCCSS",85,0)
 Q:"DF"'[Y
"RTN","MAGDCCSS",86,0)
 I 
"RTN","MAGDCCSS",87,0)
 I Y="D" D  Q:'$D(STR)!'$D(STP) 
"RTN","MAGDCCSS",88,0)
 . D ASKDT Q:'$D(STR)!'$D(STP)
"RTN","MAGDCCSS",89,0)
 . W !,"Please hold sorting by Date. " D SRTDT
"RTN","MAGDCCSS",90,0)
 S BY=Y K DIR,X,Y,DTOUT,DIRUT,DTOUT
"RTN","MAGDCCSS",91,0)
 D PRTDT(BY,$G(STR),$G(STP))
"RTN","MAGDCCSS",92,0)
 K BY,STR,STP
"RTN","MAGDCCSS",93,0)
 Q
"RTN","MAGDGMRC")
0^21^B32069859
"RTN","MAGDGMRC",1,0)
MAGDGMRC ;WOIFO/PMK - Read a DICOM image file ; 12 Sep 2003  4:01 PM
"RTN","MAGDGMRC",2,0)
 ;;3.0;IMAGING;**10**;Nov 06, 2003
"RTN","MAGDGMRC",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDGMRC",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDGMRC",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDGMRC",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDGMRC",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDGMRC",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDGMRC",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDGMRC",10,0)
 ;; |                                                               |
"RTN","MAGDGMRC",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDGMRC",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDGMRC",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDGMRC",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDGMRC",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDGMRC",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDGMRC",17,0)
 ;;
"RTN","MAGDGMRC",18,0)
 ;
"RTN","MAGDGMRC",19,0)
 ; This is the set of GMRC APIs that are use by the VistA Imaging
"RTN","MAGDGMRC",20,0)
 ; DICOM Gateway
"RTN","MAGDGMRC",21,0)
 ;
"RTN","MAGDGMRC",22,0)
ANYREQ(DFN) ; check if any GMRC requests are present for the patient
"RTN","MAGDGMRC",23,0)
 N ADFN ; ---- array of DFNs to look up
"RTN","MAGDGMRC",24,0)
 N WRK ; ----- work array for our results
"RTN","MAGDGMRC",25,0)
 N IX ; ------ results lookup index
"RTN","MAGDGMRC",26,0)
 N FHIT ; ---- flag - any results for the pt?
"RTN","MAGDGMRC",27,0)
 ;
"RTN","MAGDGMRC",28,0)
 ; ask for requests for the patient
"RTN","MAGDGMRC",29,0)
 S WRK=$NA(^TMP("MAG",$J,$T(+0))) K @WRK
"RTN","MAGDGMRC",30,0)
 S ADFN(1)=DFN
"RTN","MAGDGMRC",31,0)
 D FIND^DIC(123,,"@;.02I","Q",.ADFN,,"F",,,WRK,WRK)
"RTN","MAGDGMRC",32,0)
 ;
"RTN","MAGDGMRC",33,0)
 ; check returns to see if any are actually for this patient (see note
"RTN","MAGDGMRC",34,0)
 ; on SEARCH below)
"RTN","MAGDGMRC",35,0)
 S IX=0
"RTN","MAGDGMRC",36,0)
 F  S IX=$O(@WRK@("DILIST","ID",IX)) Q:'IX  D  Q:$G(FHIT)
"RTN","MAGDGMRC",37,0)
 . I $G(@WRK@("DILIST","ID",IX,.02))=DFN S FHIT=1
"RTN","MAGDGMRC",38,0)
 . Q
"RTN","MAGDGMRC",39,0)
 K @WRK
"RTN","MAGDGMRC",40,0)
 Q +$G(FHIT)
"RTN","MAGDGMRC",41,0)
 ;
"RTN","MAGDGMRC",42,0)
TIULAST(GMRCIEN) ; find the ien of the most recent TIU note for this request
"RTN","MAGDGMRC",43,0)
 N TIUIEN
"RTN","MAGDGMRC",44,0)
 N WRK ; root of work global
"RTN","MAGDGMRC",45,0)
 S TIUIEN=0
"RTN","MAGDGMRC",46,0)
 I GMRCIEN D  ; look for the most recent TIU note for this request
"RTN","MAGDGMRC",47,0)
 . ; set up the array to look through
"RTN","MAGDGMRC",48,0)
 . S WRK=$NA(^TMP("MAG",$J,$T(+0))) K @WRK
"RTN","MAGDGMRC",49,0)
 . D LIST^DIC(123.03,","_GMRCIEN_",",".01I",,,,,,,,WRK,WRK)
"RTN","MAGDGMRC",50,0)
 . ; traverse the array
"RTN","MAGDGMRC",51,0)
 . N TIUPTR
"RTN","MAGDGMRC",52,0)
 . S TIUPTR=" " ; setup for reverse $o from space (" ")
"RTN","MAGDGMRC",53,0)
 . F  S TIUPTR=$O(@WRK@("DILIST","ID",TIUPTR),-1) Q:'TIUPTR  D  Q:TIUIEN
"RTN","MAGDGMRC",54,0)
 . . S TIUIEN=$P($G(@WRK@("DILIST","ID",TIUPTR,.01)),"^",1)
"RTN","MAGDGMRC",55,0)
 . . I $P(TIUIEN,";",2)'="TIU(8925," S TIUIEN=0 ; not a TIU document
"RTN","MAGDGMRC",56,0)
 . . Q
"RTN","MAGDGMRC",57,0)
 . Q
"RTN","MAGDGMRC",58,0)
 K @WRK
"RTN","MAGDGMRC",59,0)
 Q +TIUIEN
"RTN","MAGDGMRC",60,0)
 ;
"RTN","MAGDGMRC",61,0)
TIUALL(GMRCIEN,RESULT) ; find all ien's for the TIU notes for this request
"RTN","MAGDGMRC",62,0)
 N MAGIEN,TIUIEN,TIUPTR,TIUXIEN
"RTN","MAGDGMRC",63,0)
 N WRK ; root of work global
"RTN","MAGDGMRC",64,0)
 K RESULT
"RTN","MAGDGMRC",65,0)
 ; set up the array to look through
"RTN","MAGDGMRC",66,0)
 S WRK=$NA(^TMP("MAG",$J,$T(+0))) K @WRK
"RTN","MAGDGMRC",67,0)
 D LIST^DIC(123.03,","_GMRCIEN_",",".01I",,,,,,,,WRK,WRK)
"RTN","MAGDGMRC",68,0)
 ; traverse the array
"RTN","MAGDGMRC",69,0)
 S (RESULT,TIUPTR)=0
"RTN","MAGDGMRC",70,0)
 F  S TIUPTR=$O(@WRK@("DILIST","ID",TIUPTR)) Q:'TIUPTR  D
"RTN","MAGDGMRC",71,0)
 . S TIUIEN=$P($G(@WRK@("DILIST","ID",TIUPTR,.01)),"^",1)
"RTN","MAGDGMRC",72,0)
 . I $P(TIUIEN,";",2)'="TIU(8925," Q  ; not a TIU document
"RTN","MAGDGMRC",73,0)
 . S TIUIEN=+TIUIEN ; strip off variable pointer stuff
"RTN","MAGDGMRC",74,0)
 . S DIC="^TIU(8925.91,",DIC(0)="SXZ",D="B",X=TIUIEN D IX^DIC Q:Y'>0
"RTN","MAGDGMRC",75,0)
 . S TIUXIEN=+Y,MAGIEN=$P($G(Y(0)),"^",2)
"RTN","MAGDGMRC",76,0)
 . S RESULT=RESULT+1
"RTN","MAGDGMRC",77,0)
 . S RESULT(RESULT)=TIUIEN_"^"_TIUXIEN_"^"_MAGIEN
"RTN","MAGDGMRC",78,0)
 . Q
"RTN","MAGDGMRC",79,0)
 K @WRK
"RTN","MAGDGMRC",80,0)
 Q
"RTN","MAGDGMRC",81,0)
 ;
"RTN","MAGDGMRC",82,0)
FWDFROM(GMRCIEN) ; for a forwarded reqest, determine the FORWARD FROM service
"RTN","MAGDGMRC",83,0)
 N FWDFROM,I
"RTN","MAGDGMRC",84,0)
 N WRK ; root of work global
"RTN","MAGDGMRC",85,0)
 ; set up the array to look through
"RTN","MAGDGMRC",86,0)
 S WRK=$NA(^TMP("MAG",$J,$T(+0))) K @WRK
"RTN","MAGDGMRC",87,0)
 D LIST^DIC(123.02,","_GMRCIEN_",",".01I;6I",,,,,,,,WRK,WRK)
"RTN","MAGDGMRC",88,0)
 ; traverse the array    
"RTN","MAGDGMRC",89,0)
 S FWDFROM=0
"RTN","MAGDGMRC",90,0)
 I GMRCIEN D
"RTN","MAGDGMRC",91,0)
 . S I=$O(@WRK@("DILIST","ID"," "),-1)
"RTN","MAGDGMRC",92,0)
 . I I D  ; get the FORWARDED FROM service 
"RTN","MAGDGMRC",93,0)
 . . S FWDFROM=$G(@WRK@("DILIST","ID",I,6))
"RTN","MAGDGMRC",94,0)
 . . Q
"RTN","MAGDGMRC",95,0)
 . Q
"RTN","MAGDGMRC",96,0)
 K @WRK
"RTN","MAGDGMRC",97,0)
 Q +FWDFROM
"RTN","MAGDGMRC",98,0)
 ;
"RTN","MAGDGMRC",99,0)
UNSIGNED(GMRCIEN) ; check if there are any unsigned TIU notes for the request
"RTN","MAGDGMRC",100,0)
 N TIUPTR,NRESULTS,TIUSTAT,UNSIGNED,X
"RTN","MAGDGMRC",101,0)
 N WRK ; root of work global
"RTN","MAGDGMRC",102,0)
 ; set up the array to look through
"RTN","MAGDGMRC",103,0)
 S WRK=$NA(^TMP("MAG",$J,$T(+0))) K @WRK
"RTN","MAGDGMRC",104,0)
 D LIST^DIC(123.03,","_GMRCIEN_",",".01I",,,,,,,,WRK,WRK)
"RTN","MAGDGMRC",105,0)
 S UNSIGNED=0,TIUPTR=""
"RTN","MAGDGMRC",106,0)
 ; traverse the array, check all associated results, bail if any unsigned
"RTN","MAGDGMRC",107,0)
 F  S TIUPTR=$O(@WRK@("DILIST","ID",TIUPTR)) Q:'TIUPTR  D  Q:UNSIGNED
"RTN","MAGDGMRC",108,0)
 . S X=$P($G(@WRK@("DILIST","ID",TIUPTR,.01)),"^",1)
"RTN","MAGDGMRC",109,0)
 . ; if TIU note, check if unsigned
"RTN","MAGDGMRC",110,0)
 . I X?.N1";TIU(8925," D  ; check status of TIU note for completion
"RTN","MAGDGMRC",111,0)
 . . ; status in ^TIU(8925.6) - use first 5 "UN's" per Margy McClenanhan
"RTN","MAGDGMRC",112,0)
 . . S TIUSTAT=$$GET1^DIQ(8925,+X,.05,"I")
"RTN","MAGDGMRC",113,0)
 . . I TIUSTAT,TIUSTAT<6 S UNSIGNED=1 ; got one!
"RTN","MAGDGMRC",114,0)
 . . Q
"RTN","MAGDGMRC",115,0)
 . Q
"RTN","MAGDGMRC",116,0)
 K @WRK
"RTN","MAGDGMRC",117,0)
 Q UNSIGNED
"RTN","MAGDGMRC",118,0)
 ;
"RTN","MAGDGMRC",119,0)
SEARCH(DFN,CUTOFF,CLINIC,REQUEST) ; search for requests for a given clinic
"RTN","MAGDGMRC",120,0)
 ;
"RTN","MAGDGMRC",121,0)
 ; It is a bit of a trick to determine if a given appointment is for
"RTN","MAGDGMRC",122,0)
 ; an existing GMRC request.  This determination is performed by using
"RTN","MAGDGMRC",123,0)
 ; an association between the SERVICE for the request and the CLINIC
"RTN","MAGDGMRC",124,0)
 ; where the request is to be performed.
"RTN","MAGDGMRC",125,0)
 ; 
"RTN","MAGDGMRC",126,0)
 ; This subroutine passes all of the (recent) requests for a patient and
"RTN","MAGDGMRC",127,0)
 ; builds a list of those that can be perfomed in the designated clinic.
"RTN","MAGDGMRC",128,0)
 ;
"RTN","MAGDGMRC",129,0)
 ; Maybe the replacement for Appointment Management and future versions
"RTN","MAGDGMRC",130,0)
 ; of CPRS Order Entry and Consult Request Tracking will capable of
"RTN","MAGDGMRC",131,0)
 ; correctly maintaining this essential association. 
"RTN","MAGDGMRC",132,0)
 ;
"RTN","MAGDGMRC",133,0)
 N GMRIDX,GMRC0,GMRCDATE,GMRCIEN,SERVICE,STATUS
"RTN","MAGDGMRC",134,0)
 N WRK ; --- root of results global
"RTN","MAGDGMRC",135,0)
 N ADFN ; -- array for DFNs to look up
"RTN","MAGDGMRC",136,0)
 K REQUEST S REQUEST=0
"RTN","MAGDGMRC",137,0)
 I 'DFN Q  ; no patient number provided
"RTN","MAGDGMRC",138,0)
 ; build the array of results
"RTN","MAGDGMRC",139,0)
 ; Note the use of the "Q[uick]" flag to allow lookup by *internal* DFN.
"RTN","MAGDGMRC",140,0)
 ; However, even though we define ADFN(1) to force lookup on the *first*
"RTN","MAGDGMRC",141,0)
 ; level subscript of the F index only, FileMan also looks up on the IEN
"RTN","MAGDGMRC",142,0)
 ; directly (because there is a .001 field defined in the DD of File
"RTN","MAGDGMRC",143,0)
 ; #123).  So we grab the DFN in the .02 field for later double-
"RTN","MAGDGMRC",144,0)
 ; checking.
"RTN","MAGDGMRC",145,0)
 ; 
"RTN","MAGDGMRC",146,0)
 S ADFN(1)=DFN
"RTN","MAGDGMRC",147,0)
 S WRK=$NA(^TMP("MAG",$J,$T(+0))) K @WRK
"RTN","MAGDGMRC",148,0)
 D FIND^DIC(123,,"@;.02I;1I;3I;5I;8I","Q",.ADFN,,"F",,,WRK,WRK)
"RTN","MAGDGMRC",149,0)
 ; traverse the results
"RTN","MAGDGMRC",150,0)
 S GMRIDX=""
"RTN","MAGDGMRC",151,0)
 F  S GMRIDX=$O(@WRK@("DILIST","ID",GMRIDX)) Q:'GMRIDX  D
"RTN","MAGDGMRC",152,0)
 . S GMRCIEN=+$G(@WRK@("DILIST",2,GMRIDX))
"RTN","MAGDGMRC",153,0)
 . I $G(@WRK@("DILIST","ID",GMRIDX,.02))'=DFN Q  ; not for this patient!
"RTN","MAGDGMRC",154,0)
 . I $G(@WRK@("DILIST","ID",GMRIDX,3))<CUTOFF Q  ; too far back
"RTN","MAGDGMRC",155,0)
 . S SERVICE=$G(@WRK@("DILIST","ID",GMRIDX,1)) Q:SERVICE=""
"RTN","MAGDGMRC",156,0)
 . I '$$ISCLINIC^MAGDGMRC(SERVICE,CLINIC) Q  ; not a service or clinic
"RTN","MAGDGMRC",157,0)
 . S STATUS=$G(@WRK@("DILIST","ID",GMRIDX,8)) ; cprs status
"RTN","MAGDGMRC",158,0)
 . I STATUS S STATUS=$$GET1^DIQ(100.01,STATUS,.1) ; cprs status abbrev
"RTN","MAGDGMRC",159,0)
 . S REQUEST=$G(REQUEST)+1
"RTN","MAGDGMRC",160,0)
 . S REQUEST(REQUEST)=GMRCIEN_"^"_SERVICE_"^"_STATUS
"RTN","MAGDGMRC",161,0)
 . Q
"RTN","MAGDGMRC",162,0)
 K @WRK
"RTN","MAGDGMRC",163,0)
 Q
"RTN","MAGDGMRC",164,0)
 ;
"RTN","MAGDGMRC",165,0)
ISCLINIC(SERVICE,CLINIC) ; is a particular clinic defined for a given service?
"RTN","MAGDGMRC",166,0)
 ; this entry point is called by ^MAGDGMRC as well as below
"RTN","MAGDGMRC",167,0)
 N ISCLINIC
"RTN","MAGDGMRC",168,0)
 S ISCLINIC=0
"RTN","MAGDGMRC",169,0)
 I SERVICE,CLINIC,$D(^MAG(2006.5831,SERVICE,1,"B",CLINIC)) S ISCLINIC=1
"RTN","MAGDGMRC",170,0)
 Q ISCLINIC
"RTN","MAGDHW0")
0^1^B8889432
"RTN","MAGDHW0",1,0)
MAGDHW0 ;WOIFO/PMK - Capture Consult/Request data ; 10/08/2003  09:53
"RTN","MAGDHW0",2,0)
 ;;3.0;IMAGING;**10**;Nov 06, 2003
"RTN","MAGDHW0",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHW0",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDHW0",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDHW0",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDHW0",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDHW0",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDHW0",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDHW0",10,0)
 ;; |                                                               |
"RTN","MAGDHW0",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDHW0",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDHW0",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDHW0",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDHW0",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDHW0",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHW0",17,0)
 ;;
"RTN","MAGDHW0",18,0)
 Q
"RTN","MAGDHW0",19,0)
 ;
"RTN","MAGDHW0",20,0)
INIT ;
"RTN","MAGDHW0",21,0)
 ; simulate call to INT^HLFNC2
"RTN","MAGDHW0",22,0)
 N I
"RTN","MAGDHW0",23,0)
 S HL("CC")="US"
"RTN","MAGDHW0",24,0)
 S HL("ECH")="^~\&"
"RTN","MAGDHW0",25,0)
 S HL("ETN")=""
"RTN","MAGDHW0",26,0)
 S HL("FS")="|"
"RTN","MAGDHW0",27,0)
 S HL("MTN")="ORM"
"RTN","MAGDHW0",28,0)
 S HL("PID")="D"
"RTN","MAGDHW0",29,0)
 S HL("Q")=""
"RTN","MAGDHW0",30,0)
 S HL("SAF")=^DD("SITE",1)
"RTN","MAGDHW0",31,0)
 S HL("SAN")="MAGD-SCH"
"RTN","MAGDHW0",32,0)
 S HL("VER")="2.3.1"
"RTN","MAGDHW0",33,0)
 S DEL=HL("FS")
"RTN","MAGDHW0",34,0)
 F I=1:1:$L(HL("ECH")) S @("DEL"_(I+1))=$E(HL("ECH"),I)
"RTN","MAGDHW0",35,0)
 S U="^"
"RTN","MAGDHW0",36,0)
 Q
"RTN","MAGDHW0",37,0)
 ;
"RTN","MAGDHW0",38,0)
FINDSEG(ARRAY,SEGMENT,I,X) ; find a specific HL7 segment in an array
"RTN","MAGDHW0",39,0)
 ; input -- ARRAY ---- an HL7 array
"RTN","MAGDHW0",40,0)
 ; input -- SEGMENT -- three-letter HL7 segment identifier 
"RTN","MAGDHW0",41,0)
 ; input -- I -------- index of the found segment (or null)
"RTN","MAGDHW0",42,0)
 ; output - I -------- index of the found segment (or null)
"RTN","MAGDHW0",43,0)
 ; output - X -------- string of fields sans segment identifier
"RTN","MAGDHW0",44,0)
 ; return - HIT ------ flag indicating segment found 
"RTN","MAGDHW0",45,0)
 ;
"RTN","MAGDHW0",46,0)
 N HIT
"RTN","MAGDHW0",47,0)
 S HIT=0
"RTN","MAGDHW0",48,0)
 F  S I=$O(ARRAY(I)) Q:I=""  I $P(ARRAY(I),DEL)=SEGMENT D  Q
"RTN","MAGDHW0",49,0)
 . S X=$P(ARRAY(I),DEL,2,99999) ; strip off the segment name
"RTN","MAGDHW0",50,0)
 . S HIT=1
"RTN","MAGDHW0",51,0)
 . Q
"RTN","MAGDHW0",52,0)
 Q HIT
"RTN","MAGDHW0",53,0)
 ;
"RTN","MAGDHW0",54,0)
SAVESEG(I,X) ; save updated segment
"RTN","MAGDHW0",55,0)
 S $P(HL7(I),DEL,2,999)=X
"RTN","MAGDHW0",56,0)
 Q
"RTN","MAGDHW0",57,0)
 ;
"RTN","MAGDHW0",58,0)
ADDSEG(X) ; add a new segment to the end if the message
"RTN","MAGDHW0",59,0)
 S HL7($O(HL7(""),-1)+1)=X
"RTN","MAGDHW0",60,0)
 Q
"RTN","MAGDHW0",61,0)
 ;
"RTN","MAGDHW0",62,0)
OUTPUT ; output the message to ^MAGDHL7
"RTN","MAGDHW0",63,0)
 N DIC,DIE,D0,DA,DR,I,J,K,X,Y,Z
"RTN","MAGDHW0",64,0)
 S X=FMDATE,DIC="^MAGDHL7(2006.5,",DIC(0)="LZ" D FILE^DICN S D0=+Y
"RTN","MAGDHW0",65,0)
 S DIE=DIC,DR=".03///^S X=FMDATETM",DA=D0 D ^DIE ; capture time
"RTN","MAGDHW0",66,0)
 S $P(^MAGDHL7(2006.5,D0,0),"^",2)="ORM" ; all are ORM
"RTN","MAGDHW0",67,0)
 S I="HL7",J=0 F  S I=$Q(@I) Q:I=""  D
"RTN","MAGDHW0",68,0)
 . S X=@I,Y=$P(X,DEL)
"RTN","MAGDHW0",69,0)
 . F K=2:1:$L(X,DEL) D  ; copy the lines to the ^MAGDHL7 global
"RTN","MAGDHW0",70,0)
 . . S Z=$P(X,DEL,K)
"RTN","MAGDHW0",71,0)
 . . I ($L(Y)+$L(Z))>200 D  ; keep lines short for the global
"RTN","MAGDHW0",72,0)
 . . . ; output one line of a spanned record
"RTN","MAGDHW0",73,0)
 . . . S J=J+1,^MAGDHL7(2006.5,D0,1,J,0)=Y,Y=""
"RTN","MAGDHW0",74,0)
 . . . Q
"RTN","MAGDHW0",75,0)
 . . S Y=Y_DEL_$P(X,DEL,K)
"RTN","MAGDHW0",76,0)
 . . Q
"RTN","MAGDHW0",77,0)
 . S J=J+1,^MAGDHL7(2006.5,D0,1,J,0)=Y
"RTN","MAGDHW0",78,0)
 . Q
"RTN","MAGDHW0",79,0)
 ; The next line must be last, since WAIT^MAGDHR1A
"RTN","MAGDHW0",80,0)
 ; uses this node to determine that the entry is complete.
"RTN","MAGDHW0",81,0)
 S ^MAGDHL7(2006.5,D0,1,0)="^^"_J_"^"_J_"^"_FMDATETM
"RTN","MAGDHW0",82,0)
 Q
"RTN","MAGDHWA")
0^2^B58806153
"RTN","MAGDHWA",1,0)
MAGDHWA ;WOIFO/PMK - Capture Consult/Request data ; 10/08/2003  09:54
"RTN","MAGDHWA",2,0)
 ;;3.0;IMAGING;**10**;Nov 06, 2003
"RTN","MAGDHWA",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHWA",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDHWA",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDHWA",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDHWA",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDHWA",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDHWA",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDHWA",10,0)
 ;; |                                                               |
"RTN","MAGDHWA",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDHWA",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDHWA",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDHWA",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDHWA",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDHWA",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHWA",17,0)
 ;;
"RTN","MAGDHWA",18,0)
 Q
"RTN","MAGDHWA",19,0)
 ; entry points called by both ^MAGDHWC and ^MAGDHWS
"RTN","MAGDHWA",20,0)
 ; 
"RTN","MAGDHWA",21,0)
MSH ; update MSH segment
"RTN","MAGDHWA",22,0)
 S $P(HL7(1),DEL,5)="VI-CONSULT" ; receiving application
"RTN","MAGDHWA",23,0)
 S $P(HL7(1),DEL,6)=$P(HL7(1),DEL,4) ; receiving facility
"RTN","MAGDHWA",24,0)
 S $P(HL7(1),DEL,7)=$$FMTHL7^XLFDT(FMDATETM)
"RTN","MAGDHWA",25,0)
 Q
"RTN","MAGDHWA",26,0)
 ;
"RTN","MAGDHWA",27,0)
PID ; update PID & PV1 segments
"RTN","MAGDHWA",28,0)
 N ADDRESS,FIRSTNAM,GEOLOC,I,J,LASTNAME,MIDNAME,PNAME
"RTN","MAGDHWA",29,0)
 N VA,VADM,VAIN,VAPA,VAERR,X,WARD,Z
"RTN","MAGDHWA",30,0)
 ; update PID segment
"RTN","MAGDHWA",31,0)
 S I=0 I $$FINDSEG^MAGDHW0(.HL7,"PID",.I,.X) D
"RTN","MAGDHWA",32,0)
 . S DFN=$P(X,DEL,3) D  ; protect I and X
"RTN","MAGDHWA",33,0)
 . . N %,DIQUIET,I,IO,X
"RTN","MAGDHWA",34,0)
 . . S DIQUIET=1 D DEM^VADPT,ADD^VADPT,INP^VADPT
"RTN","MAGDHWA",35,0)
 . . Q
"RTN","MAGDHWA",36,0)
 . S ADDRESS=VAPA(1) ; construct the patient's address string
"RTN","MAGDHWA",37,0)
 . F J=2:1:3 I VAPA(J)'="" S ADDRESS=ADDRESS_"^"_VAPA(J)
"RTN","MAGDHWA",38,0)
 . S GEOLOC=VAPA(4)_"^"_$P(VAPA(5),"^")_"^"_VAPA(6) ; city, state & zip
"RTN","MAGDHWA",39,0)
 . ; stuff the data into the segment
"RTN","MAGDHWA",40,0)
 . S $P(X,DEL,2)=VA("PID") ; patient id - ssn
"RTN","MAGDHWA",41,0)
 . S $P(X,DEL,4)=$E(VADM(1))_VA("BID") ; alt. patient id - quick pid
"RTN","MAGDHWA",42,0)
 . ; format patient name: last~first~middle
"RTN","MAGDHWA",43,0)
 . S LASTNAME=$P(VADM(1),","),Z=$P(VADM(1),",",2,999)
"RTN","MAGDHWA",44,0)
 . S FIRSTNAM=$P(Z," ",1),MIDNAME=$TR($P(Z," ",2,999),".")
"RTN","MAGDHWA",45,0)
 . S $P(X,DEL,5)=LASTNAME_DEL2_FIRSTNAM_DEL2_MIDNAME ; patient name
"RTN","MAGDHWA",46,0)
 . S $P(X,DEL,7)=17000000+VADM(3) ; dob
"RTN","MAGDHWA",47,0)
 . S $P(X,DEL,8)=$P(VADM(5),"^") ; sex
"RTN","MAGDHWA",48,0)
 . S $P(X,DEL,10)=DEL2_$P(VADM(8),"^",2) ; race
"RTN","MAGDHWA",49,0)
 . S $P(X,DEL,11)=$$HLADDR^HLFNC(ADDRESS,GEOLOC,DEL2)
"RTN","MAGDHWA",50,0)
 . S $P(X,DEL,13)=VAPA(8)_DEL2_"PRN" ; primary phone number
"RTN","MAGDHWA",51,0)
 . S $P(X,DEL,19)=$P(VADM(2),"^") ; ssn (without dashes)
"RTN","MAGDHWA",52,0)
 . D SAVESEG^MAGDHW0(I,X)
"RTN","MAGDHWA",53,0)
 . Q
"RTN","MAGDHWA",54,0)
 ;
"RTN","MAGDHWA",55,0)
 ; update PV1 segment for inpatients only
"RTN","MAGDHWA",56,0)
 S I=0 I $$FINDSEG^MAGDHW0(.HL7,"PV1",.I,.X) D
"RTN","MAGDHWA",57,0)
 . ; get assigned patient location
"RTN","MAGDHWA",58,0)
 . I VAIN(1) D  ; inpatient code
"RTN","MAGDHWA",59,0)
 . . S $P(X,DEL,2)="I" ; inpatient flag
"RTN","MAGDHWA",60,0)
 . . ; assigned patient location
"RTN","MAGDHWA",61,0)
 . . S Z=$TR(VAIN(4),"^",DEL5)_DEL5_"VISTA42"
"RTN","MAGDHWA",62,0)
 . . S $P(X,DEL,3)=Z_DEL2_$TR(VAIN(5),"-",DEL2)
"RTN","MAGDHWA",63,0)
 . . ; attending physician
"RTN","MAGDHWA",64,0)
 . . S $P(X,DEL,7)=$TR(VAIN(2),"^, ",DEL2_DEL2_DEL2)
"RTN","MAGDHWA",65,0)
 . . ; referring (primary care) physician
"RTN","MAGDHWA",66,0)
 . . S $P(X,DEL,8)=$TR(VAIN(11),"^, ",DEL2_DEL2_DEL2)
"RTN","MAGDHWA",67,0)
 . . ; hospital service
"RTN","MAGDHWA",68,0)
 . . S $P(X,DEL,10)=$TR(VAIN(3),"^",DEL2)
"RTN","MAGDHWA",69,0)
 . . ; visit number
"RTN","MAGDHWA",70,0)
 . . S $P(X,DEL,19)=VAIN(1)
"RTN","MAGDHWA",71,0)
 . . Q
"RTN","MAGDHWA",72,0)
 . E  S $P(X,DEL,2)="O" ; outpatient flag
"RTN","MAGDHWA",73,0)
 . D SAVESEG^MAGDHW0(I,X)
"RTN","MAGDHWA",74,0)
 . Q
"RTN","MAGDHWA",75,0)
 Q
"RTN","MAGDHWA",76,0)
 ;
"RTN","MAGDHWA",77,0)
ORC ; update ORC segment
"RTN","MAGDHWA",78,0)
 N D0,I,J,NAME,X
"RTN","MAGDHWA",79,0)
 S CONSULT=DEL2 ; consult always contains DEL2
"RTN","MAGDHWA",80,0)
 S I=0 I $$FINDSEG^MAGDHW0(.HL7,"ORC",.I,.X) D
"RTN","MAGDHWA",81,0)
 . ; get consult ien for OBR segment
"RTN","MAGDHWA",82,0)
 . S CONSULT=$P(X,DEL,3)
"RTN","MAGDHWA",83,0)
 . ; add names of order enterer and ordering provider
"RTN","MAGDHWA",84,0)
 . F J=10,12 D
"RTN","MAGDHWA",85,0)
 . . S D0=$P(X,DEL,J),NAME=$S(D0:$$GET1^DIQ(200,D0,.01),1:"")
"RTN","MAGDHWA",86,0)
 . . S NAME=$TR(NAME,", ",DEL2_DEL2)
"RTN","MAGDHWA",87,0)
 . . S $P(X,DEL,J)=D0_DEL2_NAME
"RTN","MAGDHWA",88,0)
 . . Q
"RTN","MAGDHWA",89,0)
 . D SAVESEG^MAGDHW0(I,X)
"RTN","MAGDHWA",90,0)
 . Q
"RTN","MAGDHWA",91,0)
 Q
"RTN","MAGDHWA",92,0)
 ;
"RTN","MAGDHWA",93,0)
OBR ; update OBR segment
"RTN","MAGDHWA",94,0)
 N I,X,Z
"RTN","MAGDHWA",95,0)
 S I=0 I $$FINDSEG^MAGDHW0(.HL7,"OBR",.I,.X) D
"RTN","MAGDHWA",96,0)
 . S $P(X,DEL,3)=CONSULT_DEL2_"L",GMRCIEN=+CONSULT
"RTN","MAGDHWA",97,0)
 . S Z=$$GET1^DIQ(123,GMRCIEN,5,"I") ; urgency
"RTN","MAGDHWA",98,0)
 . I Z S $P(X,DEL,5)=$$GET1^DIQ(101,Z,1) ; priority
"RTN","MAGDHWA",99,0)
 . ;
"RTN","MAGDHWA",100,0)
 . S Z=$$GET1^DIQ(123,GMRCIEN,6,"I") ; place of consult
"RTN","MAGDHWA",101,0)
 . I Z S $P(X,DEL,18)=$$GET1^DIQ(101,Z,1) ; placer field #1
"RTN","MAGDHWA",102,0)
 . ;
"RTN","MAGDHWA",103,0)
 . S Z=$$GET1^DIQ(123,GMRCIEN,13,"I") ; request type
"RTN","MAGDHWA",104,0)
 . S Z=$S(Z="C":"CONSULT",Z="P":"PROCEDURE",1:"UNKNOWN")
"RTN","MAGDHWA",105,0)
 . S $P(X,DEL,19)=Z ; consult/procedure flag - placer field #2
"RTN","MAGDHWA",106,0)
 . ;
"RTN","MAGDHWA",107,0)
 . ; store the current CPRS GMRC or Appointment Scheduling status
"RTN","MAGDHWA",108,0)
 . ; FILLER1 is also set in ^MAGDHRS
"RTN","MAGDHWA",109,0)
 . I '$D(FILLER1) S FILLER1="GMRC-"_$$GET1^DIQ(123,GMRCIEN,8)
"RTN","MAGDHWA",110,0)
 . ; make linkage between the image group and the TIU note, if necessary
"RTN","MAGDHWA",111,0)
 . I MSGTYPE["RESULT",$$NEWTIU(GMRCIEN) S $P(FILLER1,DEL2,2)="LINKED"
"RTN","MAGDHWA",112,0)
 . S $P(X,DEL,20)=FILLER1
"RTN","MAGDHWA",113,0)
 . ;
"RTN","MAGDHWA",114,0)
 . ; store the clinic for the appointment in "filler field 2"
"RTN","MAGDHWA",115,0)
 . I $D(APTSCHED("CLINIC IEN")),$D(APTSCHED("CLINIC NAME")) D
"RTN","MAGDHWA",116,0)
 . . S $P(X,DEL,21)=APTSCHED("CLINIC IEN")_DEL2_APTSCHED("CLINIC NAME")
"RTN","MAGDHWA",117,0)
 . . Q
"RTN","MAGDHWA",118,0)
 . ;
"RTN","MAGDHWA",119,0)
 . ; CPRS Attention - HL7 "Result Copies To" field
"RTN","MAGDHWA",120,0)
 . S Z=$$GET1^DIQ(123,GMRCIEN,7,"I") ; pointer to ^VA(200)
"RTN","MAGDHWA",121,0)
 . I Z S $P(X,DEL,28)=Z_DEL2_$TR($$GET1^DIQ(200,Z,.01),", ",DEL2_DEL2)
"RTN","MAGDHWA",122,0)
 . ;
"RTN","MAGDHWA",123,0)
 . ; date and time of scheduled appointment
"RTN","MAGDHWA",124,0)
 . I $D(APTSCHED("FM DATETIME")) D
"RTN","MAGDHWA",125,0)
 . . S $P(X,DEL,36)=$$FMTHL7^XLFDT(APTSCHED("FM DATETIME"))
"RTN","MAGDHWA",126,0)
 . . Q
"RTN","MAGDHWA",127,0)
 . ;
"RTN","MAGDHWA",128,0)
 . ; from service (requesting service)
"RTN","MAGDHWA",129,0)
 . S Z=$$GET1^DIQ(123,GMRCIEN,2,"I") ; pointer to ^SC(Z)
"RTN","MAGDHWA",130,0)
 . I Z S $P(X,DEL,47)=Z_DEL2_$$GET1^DIQ(44,Z,.01)
"RTN","MAGDHWA",131,0)
 . D SAVESEG^MAGDHW0(I,X)
"RTN","MAGDHWA",132,0)
 . Q
"RTN","MAGDHWA",133,0)
 Q
"RTN","MAGDHWA",134,0)
 ;
"RTN","MAGDHWA",135,0)
ZSV ; find ZSV segment and add imaging type code
"RTN","MAGDHWA",136,0)
 N I,Z
"RTN","MAGDHWA",137,0)
 S I=0 I $$FINDSEG^MAGDHW0(.HL7,"ZSV",.I,.X) D
"RTN","MAGDHWA",138,0)
 . S $P(X,DEL,3)=ITYPCODE_DEL2_ITYPNAME_DEL2_DIVISION
"RTN","MAGDHWA",139,0)
 . S $P(X,DEL,4)=$G(ORIGSERV) ; original service for a FORWARD request
"RTN","MAGDHWA",140,0)
 . D SAVESEG^MAGDHW0(I,X)
"RTN","MAGDHWA",141,0)
 . Q
"RTN","MAGDHWA",142,0)
 Q
"RTN","MAGDHWA",143,0)
 ;
"RTN","MAGDHWA",144,0)
ALLERGY ; check to see if patient has any allergies
"RTN","MAGDHWA",145,0)
 N GMRA,GMRAL,I,X
"RTN","MAGDHWA",146,0)
 D EN1^GMRADPT
"RTN","MAGDHWA",147,0)
 S I=0 F  S I=$O(GMRAL(I)) Q:'I  D  ; include each allergy string as an HL7 OBX segment
"RTN","MAGDHWA",148,0)
 . S OBXSEGNO=OBXSEGNO+1
"RTN","MAGDHWA",149,0)
 . S X="OBX|"_OBXSEGNO_"|TX|A^ALLERGIES^L||",X=$TR(X,"|^",DEL_DEL2)
"RTN","MAGDHWA",150,0)
 . S X=X_$P(GMRAL(I),"^",2)
"RTN","MAGDHWA",151,0)
 . S X=X_DEL_DEL_DEL_DEL_DEL_DEL ; final six delmimters
"RTN","MAGDHWA",152,0)
 . D ADDSEG^MAGDHW0(X)
"RTN","MAGDHWA",153,0)
 . Q
"RTN","MAGDHWA",154,0)
 Q
"RTN","MAGDHWA",155,0)
 ;
"RTN","MAGDHWA",156,0)
POSTINGS ; check if the patient has any other postings
"RTN","MAGDHWA",157,0)
 N I,HIT,MSG
"RTN","MAGDHWA",158,0)
 D ENCOVER^TIUPP3(DFN) I MSG Q  ; MSG="0^Patient posting found"
"RTN","MAGDHWA",159,0)
 S (I,HIT)=0
"RTN","MAGDHWA",160,0)
 F  S I=$O(^TMP("TIUPPCV",$J,I)) Q:'I  I $P(^(I),"^",2)'="A" S HIT=1 Q
"RTN","MAGDHWA",161,0)
 I HIT D
"RTN","MAGDHWA",162,0)
 . S X="OBX|"_OBXSEGNO_"|TX|P^POSTINGS^L||"
"RTN","MAGDHWA",163,0)
 . S X=$TR(X,"|^",DEL_DEL2)
"RTN","MAGDHWA",164,0)
 . S X=X_"Please see CPRS for additional information about Postings."
"RTN","MAGDHWA",165,0)
 . S X=X_DEL_DEL_DEL_DEL_DEL_DEL ; final six delmimters
"RTN","MAGDHWA",166,0)
 . D ADDSEG^MAGDHW0(X)
"RTN","MAGDHWA",167,0)
 . Q
"RTN","MAGDHWA",168,0)
 Q
"RTN","MAGDHWA",169,0)
 ;
"RTN","MAGDHWA",170,0)
NEWTIU(GMRCIEN) ; check if this is a TIU note to be linked to an image group
"RTN","MAGDHWA",171,0)
 ; if so, create the cross-linkages now
"RTN","MAGDHWA",172,0)
 N CROSSREF,D0,FILEDATA,HIT,MAGGP,MAGIEN,NIMAGE,TIUIEN
"RTN","MAGDHWA",173,0)
 S HIT=0
"RTN","MAGDHWA",174,0)
 S D0=""
"RTN","MAGDHWA",175,0)
 F  S D0=$O(^MAG(2006.5839,"C",123,GMRCIEN,D0)) Q:'D0  D
"RTN","MAGDHWA",176,0)
 . S MAGGP=$P($G(^MAG(2006.5839,D0,0)),"^",3) Q:'MAGGP
"RTN","MAGDHWA",177,0)
 . S TIUIEN=$$TIULAST^MAGDGMRC(GMRCIEN) Q:'TIUIEN
"RTN","MAGDHWA",178,0)
 . S $P(^MAG(2005,MAGGP,2),"^",6,7)="8925^"_TIUIEN
"RTN","MAGDHWA",179,0)
 . D TIUXLINK ; create the cross-linkages to TIU
"RTN","MAGDHWA",180,0)
 . ; update the parent file pointers for all the images
"RTN","MAGDHWA",181,0)
 . S CROSSREF="8925^"_TIUIEN_"^"_FILEDATA("PARENT FILE PTR")
"RTN","MAGDHWA",182,0)
 . S NIMAGE=0 F  S NIMAGE=$O(^MAG(2005,MAGGP,1,NIMAGE)) Q:'NIMAGE  D
"RTN","MAGDHWA",183,0)
 . . S MAGIEN=$P(^MAG(2005,MAGGP,1,NIMAGE,0),"^")
"RTN","MAGDHWA",184,0)
 . . S $P(^MAG(2005,MAGIEN,2),"^",6,8)=CROSSREF
"RTN","MAGDHWA",185,0)
 . . Q
"RTN","MAGDHWA",186,0)
 . ; remove entries from ^MAG(2006.5839) & decrement the counter
"RTN","MAGDHWA",187,0)
 . K ^MAG(2006.5839,D0),^MAG(2006.5839,"C",123,GMRCIEN,D0)
"RTN","MAGDHWA",188,0)
 . L +^MAG(2006.5839)
"RTN","MAGDHWA",189,0)
 . S $P(^MAG(2006.5839,0),"^",4)=$P(^MAG(2006.5839,0),"^",4)-1
"RTN","MAGDHWA",190,0)
 . L -^MAG(2006.5839)
"RTN","MAGDHWA",191,0)
 . S HIT=1
"RTN","MAGDHWA",192,0)
 . Q
"RTN","MAGDHWA",193,0)
 Q HIT
"RTN","MAGDHWA",194,0)
 ;
"RTN","MAGDHWA",195,0)
TIUXLINK ; create the cross-linkages to TIU EXTERNAL DATA LINK file
"RTN","MAGDHWA",196,0)
 N TIUXDIEN
"RTN","MAGDHWA",197,0)
 D PUTIMAGE^TIUSRVPL(.TIUXDIEN,TIUIEN,MAGGP)
"RTN","MAGDHWA",198,0)
 I TIUXDIEN D
"RTN","MAGDHWA",199,0)
 . S FILEDATA("PARENT FILE PTR")=TIUXDIEN
"RTN","MAGDHWA",200,0)
 . S $P(^MAG(2005,MAGGP,2),"^",8)=TIUXDIEN
"RTN","MAGDHWA",201,0)
 . Q
"RTN","MAGDHWA",202,0)
 E  D  ; fatal error
"RTN","MAGDHWA",203,0)
 . N MSG
"RTN","MAGDHWA",204,0)
 . S MSG(1)="ERROR ASSOCIATING WITH TIU EXTERNAL DATA LINK (file 8925.91):"
"RTN","MAGDHWA",205,0)
 . S MSG(2)=$P(TIUXDIEN,"^",2,999)
"RTN","MAGDHWA",206,0)
 . S X="ERR^MAGGTERR",@^%ZOSF("TRAP")
"RTN","MAGDHWA",207,0)
 . Q
"RTN","MAGDHWA",208,0)
 Q
"RTN","MAGDHWC")
0^3^B40225649
"RTN","MAGDHWC",1,0)
MAGDHWC ;WOIFO/PMK - Capture Consult/Procedure Request data ; 10/08/2003  09:54
"RTN","MAGDHWC",2,0)
 ;;3.0;IMAGING;**10**;Nov 06, 2003
"RTN","MAGDHWC",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHWC",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDHWC",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDHWC",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDHWC",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDHWC",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDHWC",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDHWC",10,0)
 ;; |                                                               |
"RTN","MAGDHWC",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDHWC",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDHWC",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDHWC",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDHWC",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDHWC",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHWC",17,0)
 ;;
"RTN","MAGDHWC",18,0)
 ;
"RTN","MAGDHWC",19,0)
ENTRY ;
"RTN","MAGDHWC",20,0)
 ; determine the kind of message and branch appropriately
"RTN","MAGDHWC",21,0)
 N %,APTSCHED,CONSULT,DATETIME,DEL,DEL2,DEL3,DEL4,DEL5,DFN
"RTN","MAGDHWC",22,0)
 N DIVISION,FILLER1,FWDFROM,FMDATE,FMDATETM,GMRCIEN,HL,HL7,HL7ORC,HL7REC
"RTN","MAGDHWC",23,0)
 N I,IGNORE,ITYPCODE,IGNORE,MSGTYPE,OBXSEGNO,ORIGSERV,SERVICE,X,Y,Z
"RTN","MAGDHWC",24,0)
 I '$D(GMRCMSG) Q  ; can't handle this!
"RTN","MAGDHWC",25,0)
 M HL7=GMRCMSG
"RTN","MAGDHWC",26,0)
 S HL7REC=HL7(1)
"RTN","MAGDHWC",27,0)
 S DEL=$E(HL7REC,4),X=$P(HL7REC,DEL,2)
"RTN","MAGDHWC",28,0)
 F I=1:1:$L(X) S @("DEL"_(I+1))=$E(X,I)
"RTN","MAGDHWC",29,0)
 D NOW^%DTC S FMDATE=%\1,FMDATETM=%
"RTN","MAGDHWC",30,0)
 ;
"RTN","MAGDHWC",31,0)
 S IGNORE=1 ; decide if service is one that requires HL7->DICOM gateway
"RTN","MAGDHWC",32,0)
 ;
"RTN","MAGDHWC",33,0)
 ; find PID sgement and get the DFN
"RTN","MAGDHWC",34,0)
 S I=0 I '$$FINDSEG^MAGDHW0(.HL7,"PID",.I,.X) Q  ; no PID segment
"RTN","MAGDHWC",35,0)
 S DFN=$P(X,DEL,3)
"RTN","MAGDHWC",36,0)
 ;
"RTN","MAGDHWC",37,0)
 ; find ORC segment and check for an "OK" order control value
"RTN","MAGDHWC",38,0)
 S I=0 I '$$FINDSEG^MAGDHW0(.HL7,"ORC",.I,.HL7ORC) Q  ; no ORC segment
"RTN","MAGDHWC",39,0)
 S GMRCIEN=+$P(HL7ORC,DEL,3) ; GMRC request is in ^GMR(123,GMRCIEN,...)
"RTN","MAGDHWC",40,0)
 I $P(HL7ORC,DEL)="OK" D  Q  ; generate message by ^MAGDHWS
"RTN","MAGDHWC",41,0)
 . S SERVICE=$$GET1^DIQ(123,GMRCIEN,1,"I")
"RTN","MAGDHWC",42,0)
 . D SERVICE ; send this transaction to the DICOM gateway?
"RTN","MAGDHWC",43,0)
 . I 'IGNORE D
"RTN","MAGDHWC",44,0)
 . . D INIT^MAGDHW0 ; initialize variables
"RTN","MAGDHWC",45,0)
 . . S DATETIME=""
"RTN","MAGDHWC",46,0)
 . . D MESSAGE^MAGDHWS("O") ; indicates new order
"RTN","MAGDHWC",47,0)
 . . Q
"RTN","MAGDHWC",48,0)
 . Q
"RTN","MAGDHWC",49,0)
 ;
"RTN","MAGDHWC",50,0)
 ; check for a FORWARD in the ORC segment
"RTN","MAGDHWC",51,0)
 I $P($P(HL7ORC,DEL,16),DEL2,5)="FORWARD" D
"RTN","MAGDHWC",52,0)
 . ; get previous service from REQUEST PROCESSING ACTIVITY
"RTN","MAGDHWC",53,0)
 . S FWDFROM=$$FWDFROM^MAGDGMRC(GMRCIEN) ; FORWARDED FROM service
"RTN","MAGDHWC",54,0)
 . S Y=0 I FWDFROM S Y=$G(^MAG(2006.5831,FWDFROM,0))
"RTN","MAGDHWC",55,0)
 . I Y D  ; forwarded from location was one in the service group
"RTN","MAGDHWC",56,0)
 . . N DIVISION,Z
"RTN","MAGDHWC",57,0)
 . . ; original service request probably was sent to DICOM Gateway
"RTN","MAGDHWC",58,0)
 . . S ORIGSERV=DEL2_DEL2_DEL2_FWDFROM_DEL2
"RTN","MAGDHWC",59,0)
 . . S ORIGSERV=ORIGSERV_$S(FWDFROM:$$GET1^DIQ(123.5,FWDFROM,.01),1:"")
"RTN","MAGDHWC",60,0)
 . . S ORIGSERV=ORIGSERV_DEL2_"99CON"
"RTN","MAGDHWC",61,0)
 . . D DIVISION(Y)
"RTN","MAGDHWC",62,0)
 . . S Z=$P(Y,"^",2)
"RTN","MAGDHWC",63,0)
 . . S ITYPNAME=$P(^MAG(2005.84,Z,0),"^",1)
"RTN","MAGDHWC",64,0)
 . . S ITYPCODE=$P(^MAG(2005.84,Z,2),"^",1)
"RTN","MAGDHWC",65,0)
 . . S ORIGSERV=ORIGSERV_DEL_ITYPCODE_DEL2_ITYPNAME_DEL2_DIVISION
"RTN","MAGDHWC",66,0)
 . . S (ITYPCODE,ITYPNAME)="" ; may need them nulled in ZSV^MAGDHWA
"RTN","MAGDHWC",67,0)
 . . S IGNORE=0
"RTN","MAGDHWC",68,0)
 . . Q
"RTN","MAGDHWC",69,0)
 . Q
"RTN","MAGDHWC",70,0)
 ;
"RTN","MAGDHWC",71,0)
 ; find ZSV segement and requested service - check if appropriate
"RTN","MAGDHWC",72,0)
 S I=0 I '$$FINDSEG^MAGDHW0(.HL7,"ZSV",.I,.X) Q  ; no ZSV segment
"RTN","MAGDHWC",73,0)
 S SERVICE=$P($P(X,DEL),DEL2,4)
"RTN","MAGDHWC",74,0)
 D SERVICE ; send this transaction to the DICOM gateway?
"RTN","MAGDHWC",75,0)
 I IGNORE Q  ; just ignore HL7 message, don't send it to DICOM gateway
"RTN","MAGDHWC",76,0)
 ;
"RTN","MAGDHWC",77,0)
 S Z=$P(HL7ORC,DEL,1) ; Order Control
"RTN","MAGDHWC",78,0)
 S Y=$P(HL7ORC,DEL,5) ; Order Status
"RTN","MAGDHWC",79,0)
 I Z="SC" S MSGTYPE="RECEIVED" ; received
"RTN","MAGDHWC",80,0)
 E  I Z="RE" D  ; result
"RTN","MAGDHWC",81,0)
 . I Y="A" S MSGTYPE="PARTIAL RESULT" ; unsigned TIU note
"RTN","MAGDHWC",82,0)
 . E  I Y="CM" D  ; check for a new unsigned note
"RTN","MAGDHWC",83,0)
 . . I $$UNSIGNED^MAGDGMRC(GMRCIEN) D
"RTN","MAGDHWC",84,0)
 . . . S MSGTYPE="PARTIAL RESULT" ; unsigned TIU note
"RTN","MAGDHWC",85,0)
 . . . S FILLER1="GMRC-NEW UNSIGNED RESULT"
"RTN","MAGDHWC",86,0)
 . . . Q
"RTN","MAGDHWC",87,0)
 . . E  S MSGTYPE="COMPLETE RESULT"  ; signed TIU note
"RTN","MAGDHWC",88,0)
 . . Q
"RTN","MAGDHWC",89,0)
 . Q
"RTN","MAGDHWC",90,0)
 E  S MSGTYPE="UNKNOWN"
"RTN","MAGDHWC",91,0)
 D MSH^MAGDHWA,PID^MAGDHWA,ORC^MAGDHWA,OBR^MAGDHWA,ZSV^MAGDHWA
"RTN","MAGDHWC",92,0)
 I '$$OBX() D  ; get OBX segment from database
"RTN","MAGDHWC",93,0)
 . S I=$O(HL7(""),-1)+1 S I=$$OBX^MAGDHWS(I)
"RTN","MAGDHWC",94,0)
 . Q
"RTN","MAGDHWC",95,0)
 E  D  ; process existing OBX segment
"RTN","MAGDHWC",96,0)
 . D OBX1
"RTN","MAGDHWC",97,0)
 . Q
"RTN","MAGDHWC",98,0)
 D ALLERGY^MAGDHWA,POSTINGS^MAGDHWA
"RTN","MAGDHWC",99,0)
 D OUTPUT^MAGDHW0
"RTN","MAGDHWC",100,0)
 Q
"RTN","MAGDHWC",101,0)
 ;
"RTN","MAGDHWC",102,0)
SERVICE ; check if the service is in the DICOM Clinical Service dictionary
"RTN","MAGDHWC",103,0)
 N Y
"RTN","MAGDHWC",104,0)
 I SERVICE D  ; ignore SERVICE if it is null
"RTN","MAGDHWC",105,0)
 . S Y=$G(^MAG(2006.5831,SERVICE,0))
"RTN","MAGDHWC",106,0)
 . S DIVISION=DEL2
"RTN","MAGDHWC",107,0)
 . I Y D  ; new service is of interest to DICOM Gateway
"RTN","MAGDHWC",108,0)
 . . D DIVISION(Y)
"RTN","MAGDHWC",109,0)
 . . S Z=$P(Y,"^",2)
"RTN","MAGDHWC",110,0)
 . . S ITYPNAME=$P(^MAG(2005.84,Z,0),"^",1)
"RTN","MAGDHWC",111,0)
 . . S ITYPCODE=$P(^MAG(2005.84,Z,2),"^",1)
"RTN","MAGDHWC",112,0)
 . . S IGNORE=0
"RTN","MAGDHWC",113,0)
 . . D APPOINT
"RTN","MAGDHWC",114,0)
 . . Q
"RTN","MAGDHWC",115,0)
 . Q
"RTN","MAGDHWC",116,0)
 Q
"RTN","MAGDHWC",117,0)
 ;
"RTN","MAGDHWC",118,0)
DIVISION(Y) ;
"RTN","MAGDHWC",119,0)
 S DIVISION=$P(Y,"^",3)
"RTN","MAGDHWC",120,0)
 S DIVISION=DIVISION_DEL2_$S(DIVISION:$$GET1^DIQ(4,DIVISION,.01),1:"")
"RTN","MAGDHWC",121,0)
 Q
"RTN","MAGDHWC",122,0)
 ;
"RTN","MAGDHWC",123,0)
APPOINT ; quite often the appointment is entered before the order is entered
"RTN","MAGDHWC",124,0)
 ; if this is the case, see if we can find the corresponding appointment
"RTN","MAGDHWC",125,0)
 N CLINIC,HIT,I,LOCIEN,ORDERIEN,VASD,XE,XI
"RTN","MAGDHWC",126,0)
 ; look for appointments for today or later - don't need VASD paramters
"RTN","MAGDHWC",127,0)
 D SDA^VADPT ; get the list of the appointments
"RTN","MAGDHWC",128,0)
 ; first check the order record for the patient location
"RTN","MAGDHWC",129,0)
 ; it might be the clinic for the appointment
"RTN","MAGDHWC",130,0)
 S HIT=0 ; indicator for finding an appointment match
"RTN","MAGDHWC",131,0)
 S ORDERIEN=$$GET1^DIQ(123,GMRCIEN,.03,"I")
"RTN","MAGDHWC",132,0)
 S LOCIEN=$S(ORDERIEN:$$GET1^DIQ(100,ORDERIEN,6,"I"),1:"")
"RTN","MAGDHWC",133,0)
 I LOCIEN?1N.N1";SC(" D
"RTN","MAGDHWC",134,0)
 . S CLINIC=+LOCIEN
"RTN","MAGDHWC",135,0)
 . I $$ISCLINIC^MAGDGMRC(SERVICE,CLINIC) D
"RTN","MAGDHWC",136,0)
 . . S I=0 F  S I=$O(^UTILITY("VASD",$J,I)) Q:'I  Q:HIT  D
"RTN","MAGDHWC",137,0)
 . . . S XI=^UTILITY("VASD",$J,I,"I"),XE=^("E")
"RTN","MAGDHWC",138,0)
 . . . ; check if there is an appointment in this clinic
"RTN","MAGDHWC",139,0)
 . . . I CLINIC=$P(XI,"^",2) D APPOINT1 ; select first apt. in clinic
"RTN","MAGDHWC",140,0)
 . . . Q
"RTN","MAGDHWC",141,0)
 . . Q
"RTN","MAGDHWC",142,0)
 . Q
"RTN","MAGDHWC",143,0)
 I 'HIT D  ; no appointment for the pt. location, look for other clinics
"RTN","MAGDHWC",144,0)
 . S I=0 F  S I=$O(^UTILITY("VASD",$J,I)) Q:'I  Q:HIT  D
"RTN","MAGDHWC",145,0)
 . . S XI=^UTILITY("VASD",$J,I,"I"),XE=^("E")
"RTN","MAGDHWC",146,0)
 . . S CLINIC=$P(XI,"^",2)
"RTN","MAGDHWC",147,0)
 . . I $$ISCLINIC^MAGDGMRC(SERVICE,CLINIC) D APPOINT1
"RTN","MAGDHWC",148,0)
 . . Q
"RTN","MAGDHWC",149,0)
 . Q
"RTN","MAGDHWC",150,0)
 K ^UTILITY("VASD",$J)
"RTN","MAGDHWC",151,0)
 Q
"RTN","MAGDHWC",152,0)
 ;
"RTN","MAGDHWC",153,0)
APPOINT1 ; fill the appontment schedule array
"RTN","MAGDHWC",154,0)
 S APTSCHED("FM DATETIME")=$P(XI,"^")
"RTN","MAGDHWC",155,0)
 S APTSCHED("CLINIC IEN")=CLINIC
"RTN","MAGDHWC",156,0)
 S APTSCHED("DATETIME")=$P(XE,"^")
"RTN","MAGDHWC",157,0)
 S APTSCHED("CLINIC NAME")=$P(XE,"^",2)
"RTN","MAGDHWC",158,0)
 S HIT=1 ; to exit loop
"RTN","MAGDHWC",159,0)
 Q
"RTN","MAGDHWC",160,0)
 ;
"RTN","MAGDHWC",161,0)
OBX() ; find OBX segments to determine the highest value of OBXSEGNO
"RTN","MAGDHWC",162,0)
 N I,X
"RTN","MAGDHWC",163,0)
 S OBXSEGNO=0
"RTN","MAGDHWC",164,0)
 S I=0 F  D  Q:I=""  ; $o through HL7 message - quit when at end
"RTN","MAGDHWC",165,0)
 . I $$FINDSEG^MAGDHW0(.HL7,"OBX",.I,.X) S OBXSEGNO=$P(X,DEL,1)
"RTN","MAGDHWC",166,0)
 . Q
"RTN","MAGDHWC",167,0)
 Q OBXSEGNO
"RTN","MAGDHWC",168,0)
 ;
"RTN","MAGDHWC",169,0)
OBX1 ; if there are second level OBX data, add OBX segment prefix
"RTN","MAGDHWC",170,0)
 ; add additional OBX segments to convey the Reason for the Request
"RTN","MAGDHWC",171,0)
 ; more than one, so can't use "I $$FINDSEG^MAGDHW0(.HL7,"OBX",.I) D  "
"RTN","MAGDHWC",172,0)
 S I="" F  S I=$O(HL7(I)) Q:I=""  I $P(HL7(I),DEL)="OBX" D
"RTN","MAGDHWC",173,0)
 . I '$D(HL7(I,1)) Q  ; no additional OBX segments needed
"RTN","MAGDHWC",174,0)
 . S X=$P(HL7(I),DEL,1,5) ; copy pieces 1-5 to other segments
"RTN","MAGDHWC",175,0)
 . S J="" F  S J=$O(HL7(I,J)) Q:'J  S HL7(I,J)=X_DEL_HL7(I,J)
"RTN","MAGDHWC",176,0)
 . Q
"RTN","MAGDHWC",177,0)
 Q
"RTN","MAGDHWS")
0^6^B24298670
"RTN","MAGDHWS",1,0)
MAGDHWS ;WOIFO/PMK - Capture Consult/GMRC data ; 10/08/2003  09:54
"RTN","MAGDHWS",2,0)
 ;;3.0;IMAGING;**10**;Nov 06, 2003
"RTN","MAGDHWS",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHWS",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDHWS",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDHWS",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDHWS",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDHWS",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDHWS",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDHWS",10,0)
 ;; |                                                               |
"RTN","MAGDHWS",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDHWS",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDHWS",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDHWS",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDHWS",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDHWS",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHWS",17,0)
 ;;
"RTN","MAGDHWS",18,0)
ENTRY ; entry point from scheduling package
"RTN","MAGDHWS",19,0)
 N %,AFTERSTS,APTNUMB,APTSCHED,CLINIC,CONSULTM,CUTOFF,DATETIME
"RTN","MAGDHWS",20,0)
 N DEL,DEL2,DEL3,DEL4,DEL5,DFN,DIVISION,DONE,FILLER1,FMDATE,FMDATETM
"RTN","MAGDHWS",21,0)
 N GMRCIEN,HL,IGNORE,IREQ,ITYPCODE,ITYPNAME,MSGTYPE,REQUEST
"RTN","MAGDHWS",22,0)
 N SERVICE,STATUS,UNKNOWN,X,Y,Z
"RTN","MAGDHWS",23,0)
 S APTNUMB=$P(SDATA,"^",1) I APTNUMB<1 Q  ; not a valid appointment
"RTN","MAGDHWS",24,0)
 D INIT^MAGDHW0 ; initialize variables
"RTN","MAGDHWS",25,0)
 D NOW^%DTC S FMDATE=%\1,FMDATETM=%
"RTN","MAGDHWS",26,0)
 S %H=%H-90 D TT^%DTC S CUTOFF=9999999-X ; cutoff date is 90 days ago
"RTN","MAGDHWS",27,0)
 S DFN=$P(SDATA,"^",2),DATETIME=$P(SDATA,"^",3),CLINIC=$P(SDATA,"^",4)
"RTN","MAGDHWS",28,0)
 S APTSCHED("CLINIC IEN")=CLINIC,APTSCHED("FM DATETIME")=DATETIME
"RTN","MAGDHWS",29,0)
 S AFTERSTS=SDATA("AFTER","STATUS"),X=$P(AFTERSTS,"^",3)
"RTN","MAGDHWS",30,0)
 ; appointment management transactions from ^SD(409.63)
"RTN","MAGDHWS",31,0)
 I X["CHECKED IN" S FILLER1="SDAM-CHECKIN"
"RTN","MAGDHWS",32,0)
 E  I X["CHECKED OUT" S FILLER1="SDAM-CHECKOUT"
"RTN","MAGDHWS",33,0)
 E  I X["AUTO RE-BOOK" S FILLER1="SDAM-SCHEDULED"
"RTN","MAGDHWS",34,0)
 E  I X["ACTION REQUIRED" S FILLER1="SDAM-SCHEDULED"
"RTN","MAGDHWS",35,0)
 E  I X["NON-COUNT" S FILLER1="SDAM-SCHEDULED"
"RTN","MAGDHWS",36,0)
 E  I X["CANCELLED" S FILLER1="SDAM-CANCELLED"
"RTN","MAGDHWS",37,0)
 E  I X["NO-SHOW" S FILLER1="SDAM-CANCELLED"
"RTN","MAGDHWS",38,0)
 E  I X["DELETED" S FILLER1="SDAM-CANCELLED"
"RTN","MAGDHWS",39,0)
 E  I X="FUTURE" S FILLER1="SDAM-FUTURE"
"RTN","MAGDHWS",40,0)
 E  I X="INPATIENT APPOINTMENT" S FILLER1="SDAM-SCHEDULED"
"RTN","MAGDHWS",41,0)
 E  I X["NO ACTION TAKEN" S FILLER1="SDAM-SCHEDULED"
"RTN","MAGDHWS",42,0)
 I  D  ; if one of the above condititions, do the following
"RTN","MAGDHWS",43,0)
 . S APTSCHED("CLINIC NAME")=$S(CLINIC:$$GET1^DIQ(44,CLINIC,.01),1:"")
"RTN","MAGDHWS",44,0)
 . Q
"RTN","MAGDHWS",45,0)
 E  D  Q
"RTN","MAGDHWS",46,0)
 . W !!,"Unknown Status: """,$P(AFTERSTS,"^",3),""""
"RTN","MAGDHWS",47,0)
 . W !,"Please notify the Imaging Project"
"RTN","MAGDHWS",48,0)
 . R !,"Push <Enter> to continue",X:$G(DTIME,300)
"RTN","MAGDHWS",49,0)
 . Q
"RTN","MAGDHWS",50,0)
 ;
"RTN","MAGDHWS",51,0)
 ; find requests that can be perfomed in this clinic
"RTN","MAGDHWS",52,0)
 D SEARCH^MAGDGMRC(DFN,CUTOFF,CLINIC,.REQUEST)
"RTN","MAGDHWS",53,0)
 ;
"RTN","MAGDHWS",54,0)
 ; output an HL7 message for each request related to this appointment
"RTN","MAGDHWS",55,0)
 F IREQ=1:1:REQUEST D
"RTN","MAGDHWS",56,0)
 . S GMRCIEN=$P(REQUEST(IREQ),"^",1),SERVICE=$P(REQUEST(IREQ),"^",2)
"RTN","MAGDHWS",57,0)
 . S STATUS=$P(REQUEST(IREQ),"^",3)
"RTN","MAGDHWS",58,0)
 . S IGNORE=1 D SERVICE^MAGDHWC Q:IGNORE  ; not a service of interest
"RTN","MAGDHWS",59,0)
 . ; if {pending, active, scheduled, partially resulted, or complete}
"RTN","MAGDHWS",60,0)
 . I "^p^a^s^pr^c^"[("^"_STATUS_"^") D
"RTN","MAGDHWS",61,0)
 . . ; completed requests can only be checked out or cancelled
"RTN","MAGDHWS",62,0)
 . . I STATUS="c","SDAM-CHECKOUT^SDAM-CANCELLED"'[FILLER1 Q
"RTN","MAGDHWS",63,0)
 . . D MESSAGE("S")
"RTN","MAGDHWS",64,0)
 . . Q
"RTN","MAGDHWS",65,0)
 . Q
"RTN","MAGDHWS",66,0)
 Q
"RTN","MAGDHWS",67,0)
 ;
"RTN","MAGDHWS",68,0)
MESSAGE(MSGTYPE) ; invoked above and also from ^MAGDHWC for the initial order
"RTN","MAGDHWS",69,0)
 N CONSULT,HL7,MSG,NEXT,OBXSEGNO,ORCTRL,ORSTATUS
"RTN","MAGDHWS",70,0)
 I MSGTYPE="O" D  ; ordered - set in ^MAGDHWC
"RTN","MAGDHWS",71,0)
 . S MSGTYPE="ORDERED"
"RTN","MAGDHWS",72,0)
 . S ORCTRL="NW" ; order control
"RTN","MAGDHWS",73,0)
 . S ORSTATUS="IP" ; order status
"RTN","MAGDHWS",74,0)
 . Q
"RTN","MAGDHWS",75,0)
 E  D
"RTN","MAGDHWS",76,0)
 . S MSGTYPE="SCHEDULED"
"RTN","MAGDHWS",77,0)
 . S ORCTRL="SC" ; order control -- status changed
"RTN","MAGDHWS",78,0)
 . S ORSTATUS="ZC" ; scheduling
"RTN","MAGDHWS",79,0)
 . Q
"RTN","MAGDHWS",80,0)
 D MSH^HLFNC2(.HL,100000,.MSG) S $P(MSG,DEL,9)="ORM"
"RTN","MAGDHWS",81,0)
 S NEXT=0
"RTN","MAGDHWS",82,0)
 S NEXT=NEXT+1,HL7(NEXT)=MSG D MSH^MAGDHWA
"RTN","MAGDHWS",83,0)
 S NEXT=NEXT+1,HL7(NEXT)="PID",$P(HL7(NEXT),DEL,1+3)=DFN
"RTN","MAGDHWS",84,0)
 S NEXT=NEXT+1,HL7(NEXT)="PV1"
"RTN","MAGDHWS",85,0)
 D PID^MAGDHWA ; generate PID and PV1 segments
"RTN","MAGDHWS",86,0)
 S NEXT=NEXT+1,HL7(NEXT)=$$ORC D ORC^MAGDHWA
"RTN","MAGDHWS",87,0)
 S NEXT=NEXT+1,HL7(NEXT)=$$OBR D OBR^MAGDHWA
"RTN","MAGDHWS",88,0)
 S NEXT=NEXT+1,HL7(NEXT)=$$ZSV D ZSV^MAGDHWA
"RTN","MAGDHWS",89,0)
 S NEXT=NEXT+1,NEXT=$$OBX(NEXT)
"RTN","MAGDHWS",90,0)
 D ALLERGY^MAGDHWA,POSTINGS^MAGDHWA
"RTN","MAGDHWS",91,0)
 D OUTPUT^MAGDHW0
"RTN","MAGDHWS",92,0)
 Q
"RTN","MAGDHWS",93,0)
 ;
"RTN","MAGDHWS",94,0)
PV1() ; build a PV1 segement
"RTN","MAGDHWS",95,0)
 N X,Z
"RTN","MAGDHWS",96,0)
 S FROM=$$GET1^DIQ(123,GMRCIEN,.04,"I") ; patient location
"RTN","MAGDHWS",97,0)
 S Z=FROM_DEL3_$S(FROM:$$GET1^DIQ(44,FROM,.01),1:"")_DEL3_SERVICE
"RTN","MAGDHWS",98,0)
 S $P(X,DEL,10)=Z
"RTN","MAGDHWS",99,0)
 Q "PV1"_DEL_X
"RTN","MAGDHWS",100,0)
 ;
"RTN","MAGDHWS",101,0)
ORC() ; build an ORC segment
"RTN","MAGDHWS",102,0)
 N ORC,ORCPLCR,ORURG
"RTN","MAGDHWS",103,0)
 S ORCPLCR=$$GET1^DIQ(123,GMRCIEN,10,"I") ; sending provider
"RTN","MAGDHWS",104,0)
 D ORC^GMRCHL7(GMRCIEN,ORCTRL,ORCPLCR,,FMDATETM)
"RTN","MAGDHWS",105,0)
 S $P(ORC,DEL,5+1)=ORSTATUS
"RTN","MAGDHWS",106,0)
 Q ORC
"RTN","MAGDHWS",107,0)
 ;
"RTN","MAGDHWS",108,0)
ZSV() ; build a ZSV segment
"RTN","MAGDHWS",109,0)
 N ZSV
"RTN","MAGDHWS",110,0)
 D ZSV^GMRCHL7(GMRCIEN)
"RTN","MAGDHWS",111,0)
 Q ZSV
"RTN","MAGDHWS",112,0)
 ;
"RTN","MAGDHWS",113,0)
OBR() ; build an OBR segment
"RTN","MAGDHWS",114,0)
 N NOTIFY,OBR
"RTN","MAGDHWS",115,0)
 D OBR^GMRCHL72(GMRCIEN,"",FMDATETM)
"RTN","MAGDHWS",116,0)
 Q OBR
"RTN","MAGDHWS",117,0)
 ;
"RTN","MAGDHWS",118,0)
OBX(NEXT) ; build one or more OBX segments
"RTN","MAGDHWS",119,0)
 N GMRCND,GMRCND1,I,J,OBX,X
"RTN","MAGDHWS",120,0)
 D OBX^GMRCHL72(GMRCIEN)
"RTN","MAGDHWS",121,0)
 S OBXSEGNO=0
"RTN","MAGDHWS",122,0)
 F I=1:1 Q:'$D(OBX(I))  D
"RTN","MAGDHWS",123,0)
 . D OBX1(OBX(I))
"RTN","MAGDHWS",124,0)
 . I $D(OBX(I,1)) S X=$P(OBX(I),DEL,1,5) F J=1:1 Q:'$D(OBX(I,J))  D
"RTN","MAGDHWS",125,0)
 . . D OBX1(X_DEL_OBX(I,J))
"RTN","MAGDHWS",126,0)
 . . Q
"RTN","MAGDHWS",127,0)
 . Q
"RTN","MAGDHWS",128,0)
 Q NEXT
"RTN","MAGDHWS",129,0)
 ;
"RTN","MAGDHWS",130,0)
OBX1(RECORD) ; store one OBX segment into the HL7 array
"RTN","MAGDHWS",131,0)
 S HL7(NEXT)=RECORD
"RTN","MAGDHWS",132,0)
 S OBXSEGNO=$P(RECORD,DEL,2) ; get the highest value of OBXSEGNO
"RTN","MAGDHWS",133,0)
 S NEXT=NEXT+1
"RTN","MAGDHWS",134,0)
 Q
"RTN","MAGDLB6")
0^26^B5513569
"RTN","MAGDLB6",1,0)
MAGDLB6 ;WOIFO/LB - DICOM file utilities ; 03 Sep 2003  2:45 PM
"RTN","MAGDLB6",2,0)
 ;;3.0;IMAGING;**21,10**;Nov 06, 2003
"RTN","MAGDLB6",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDLB6",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDLB6",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDLB6",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDLB6",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDLB6",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDLB6",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDLB6",10,0)
 ;; |                                                               |
"RTN","MAGDLB6",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDLB6",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDLB6",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDLB6",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDLB6",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDLB6",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDLB6",17,0)
 ;;
"RTN","MAGDLB6",18,0)
 Q
"RTN","MAGDLB6",19,0)
XREF ;set xref for field 9 - study uid
"RTN","MAGDLB6",20,0)
 N ORIG,PREX,PREDA
"RTN","MAGDLB6",21,0)
 S PREX=X
"RTN","MAGDLB6",22,0)
 I '$D(^MAGD(2006.575,"F",X)) D  Q
"RTN","MAGDLB6",23,0)
 . S ^MAGD(2006.575,"F",X,DA)=""
"RTN","MAGDLB6",24,0)
 S ORIG=$O(^MAGD(2006.575,"F",X,0))
"RTN","MAGDLB6",25,0)
 Q:'$D(^MAGD(2006.575,ORIG,0))   ;NO LONGER AN ENTRY
"RTN","MAGDLB6",26,0)
 S PREDA=DA D ADD
"RTN","MAGDLB6",27,0)
 S DA=PREDA,X=PREX
"RTN","MAGDLB6",28,0)
 Q
"RTN","MAGDLB6",29,0)
ADD ;
"RTN","MAGDLB6",30,0)
 N DA,DIE,DIC,DD,D0,X,Y
"RTN","MAGDLB6",31,0)
 S DIC="^MAGD(2006.575,"_ORIG_",""RLATE"","
"RTN","MAGDLB6",32,0)
 S DIC(0)="L"
"RTN","MAGDLB6",33,0)
 S DA(1)=ORIG,X=PREDA
"RTN","MAGDLB6",34,0)
 K DD D FILE^DICN
"RTN","MAGDLB6",35,0)
 I Y=-1 D EN^DDIOL("NOT FILED","","!")
"RTN","MAGDLB6",36,0)
 Q
"RTN","MAGDLB6",37,0)
FIXRF ;set xref for field 16 - fixed flag  - will incorporate the machine id
"RTN","MAGDLB6",38,0)
 ;machine id is for multiple machines being used processing images from
"RTN","MAGDLB6",39,0)
 ;xray modalities
"RTN","MAGDLB6",40,0)
 Q:'DA
"RTN","MAGDLB6",41,0)
 N MACH,STUDY
"RTN","MAGDLB6",42,0)
 S MACH=$P($G(^MAGD(2006.575,DA,1)),"^",4)
"RTN","MAGDLB6",43,0)
 S MACH=$S(MACH="":"A",1:MACH)    ;Use until peter sets his side up.
"RTN","MAGDLB6",44,0)
 S STUDY=$G(^MAGD(2006.575,DA,"ASUID"))
"RTN","MAGDLB6",45,0)
 Q:'$L(STUDY)      ;
"RTN","MAGDLB6",46,0)
 I '$D(^MAGD(2006.575,"F",STUDY,DA)) Q     ;Only unique study set this xref
"RTN","MAGDLB6",47,0)
 S ^MAGD(2006.575,"AFX",MACH,DA)=""
"RTN","MAGDLB6",48,0)
 Q
"RTN","MAGDLBSR")
0^25^B12292223
"RTN","MAGDLBSR",1,0)
MAGDLBSR ;WOIFO/LB,MLH - Sort/print for 2006.575 ; 21 Aug 2003  11:09 AM
"RTN","MAGDLBSR",2,0)
 ;;3.0;IMAGING;**10**;Nov 06, 2003
"RTN","MAGDLBSR",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDLBSR",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDLBSR",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDLBSR",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDLBSR",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDLBSR",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDLBSR",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDLBSR",10,0)
 ;; |                                                               |
"RTN","MAGDLBSR",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDLBSR",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDLBSR",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDLBSR",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDLBSR",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDLBSR",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDLBSR",17,0)
 ;;
"RTN","MAGDLBSR",18,0)
 Q
"RTN","MAGDLBSR",19,0)
SRT ;Sort the file first by the patient name but only the unique entries.
"RTN","MAGDLBSR",20,0)
 ;The "F" cross reference uses the study uid number.
"RTN","MAGDLBSR",21,0)
 N MAGSUID,MAGIEN,MAGPT
"RTN","MAGDLBSR",22,0)
 Q:'$D(^MAGD(2006.575,"F"))    ;nothing to sort
"RTN","MAGDLBSR",23,0)
 K ^MAGD(2006.575,"D")
"RTN","MAGDLBSR",24,0)
 S MAGSUID="" F  S MAGSUID=$O(^MAGD(2006.575,"F",MAGSUID)) Q:MAGSUID=""  D
"RTN","MAGDLBSR",25,0)
 . S MAGIEN=0 F  S MAGIEN=$O(^MAGD(2006.575,"F",MAGSUID,MAGIEN)) Q:'MAGIEN  D
"RTN","MAGDLBSR",26,0)
 . . I '$D(^MAGD(2006.575,MAGIEN,0)) D  Q   ;problem
"RTN","MAGDLBSR",27,0)
 . . . K ^MAGD(2006.575,"F",MAGSUID,MAGIEN)   ;clean up x-ref
"RTN","MAGDLBSR",28,0)
 . . I $D(^MAGD(2006.575,MAGIEN,"FIXD")),$P(^("FIXD"),"^") Q
"RTN","MAGDLBSR",29,0)
 . . ;Entry has been corrected do not include in sort
"RTN","MAGDLBSR",30,0)
 . . S MAGPT=$P(^MAGD(2006.575,MAGIEN,0),"^",4)
"RTN","MAGDLBSR",31,0)
 . . S ^MAGD(2006.575,"D",MAGPT,MAGIEN)=""
"RTN","MAGDLBSR",32,0)
 Q
"RTN","MAGDLBSR",33,0)
SRTDT ;Provide sorting by date entry but only if NOT fixed and by unique suid
"RTN","MAGDLBSR",34,0)
 N MAGSUID,MAGIEN,MAGDT
"RTN","MAGDLBSR",35,0)
 Q:'$D(^MAGD(2006.575,"F"))
"RTN","MAGDLBSR",36,0)
 K ^MAGD(2006.575,"AD")
"RTN","MAGDLBSR",37,0)
 S MAGSUID="" F  S MAGSUID=$O(^MAGD(2006.575,"F",MAGSUID)) Q:MAGSUID=""  D
"RTN","MAGDLBSR",38,0)
 . S MAGIEN=0 F  S MAGIEN=$O(^MAGD(2006.575,"F",MAGSUID,MAGIEN)) Q:'MAGIEN  D
"RTN","MAGDLBSR",39,0)
 . . I '$D(^MAGD(2006.575,MAGIEN,0)) D  Q
"RTN","MAGDLBSR",40,0)
 . . . K ^MAGD(2006.575,"F",MAGSUID,MAGIEN)
"RTN","MAGDLBSR",41,0)
 . . I $D(^MAGD(2006.575,MAGIEN,"FIXD")),$P(^("FIXD"),"^") Q  ;corrected
"RTN","MAGDLBSR",42,0)
 . . Q:'$D(^MAGD(2006.575,MAGIEN,1))
"RTN","MAGDLBSR",43,0)
 . . S MAGDT=$P(^MAGD(2006.575,MAGIEN,1),"^",3)
"RTN","MAGDLBSR",44,0)
 . . S ^MAGD(2006.575,"AD",MAGDT,MAGIEN)=""
"RTN","MAGDLBSR",45,0)
 Q
"RTN","MAGDLBSR",46,0)
PRTDT(SORT,START,STOP) ;
"RTN","MAGDLBSR",47,0)
 ;Print entries using the "AD" cross reference (date order)
"RTN","MAGDLBSR",48,0)
 ; OR the "F" cross reference (unique study uid)
"RTN","MAGDLBSR",49,0)
 I '$D(DUZ) W !,"DUZ variable not defined." Q
"RTN","MAGDLBSR",50,0)
 I "DF"'[SORT Q  ;only the date or unique suid
"RTN","MAGDLBSR",51,0)
 N DIC,BY,FLDS,L,FR,TO
"RTN","MAGDLBSR",52,0)
 ;I 'STOP!'START Q
"RTN","MAGDLBSR",53,0)
 S L(0)=2
"RTN","MAGDLBSR",54,0)
 I SORT="D" S SORT="AD" D
"RTN","MAGDLBSR",55,0)
 . I $L($G(START))>1,$L($G(STOP))>1 S FR(0,1)=START,TO(0,1)=STOP
"RTN","MAGDLBSR",56,0)
 S DIC="^MAGD(2006.575,",BY(0)="^MAGD(2006.575,"""_SORT_""","
"RTN","MAGDLBSR",57,0)
 S FLDS="[MAG FAILED IMAGES]",L=0
"RTN","MAGDLBSR",58,0)
 D EN1^DIP
"RTN","MAGDLBSR",59,0)
 Q
"RTN","MAGDLBSR",60,0)
ADATE() ;date
"RTN","MAGDLBSR",61,0)
 N DIR,X,Y
"RTN","MAGDLBSR",62,0)
 S DIR(0)="DU",DIR("A")=$G(MESSAGE) D ^DIR
"RTN","MAGDLBSR",63,0)
 Q Y
"RTN","MAGDLBSR",64,0)
ASKDT ;Ask date range
"RTN","MAGDLBSR",65,0)
 N MESSAGE
"RTN","MAGDLBSR",66,0)
 S MESSAGE="Enter start date" S STR=$$ADATE
"RTN","MAGDLBSR",67,0)
 I '$D(DTOUT),'$D(DUOUT)
"RTN","MAGDLBSR",68,0)
 E  K STR,STP Q
"RTN","MAGDLBSR",69,0)
 Q:'STR
"RTN","MAGDLBSR",70,0)
 I STR'?7N W "Wrong date format." Q
"RTN","MAGDLBSR",71,0)
 S MESSAGE="Enter stop date" S STP=$$ADATE
"RTN","MAGDLBSR",72,0)
 I '$D(DTOUT),'$D(DUOUT)
"RTN","MAGDLBSR",73,0)
 E  K STR,STP Q
"RTN","MAGDLBSR",74,0)
 I STP'?7N W "Wrong date format." Q
"RTN","MAGDLBSR",75,0)
 Q
"RTN","MAGDLBSR",76,0)
PRNT ;
"RTN","MAGDLBSR",77,0)
 N DIR,X,Y,BY
"RTN","MAGDLBSR",78,0)
 S DIR(0)="S^D:Date;F:Unique Entries"
"RTN","MAGDLBSR",79,0)
 D ^DIR
"RTN","MAGDLBSR",80,0)
 Q:"DF"'[Y
"RTN","MAGDLBSR",81,0)
 I Y="D" D  Q:'$D(STR)!'$D(STP) 
"RTN","MAGDLBSR",82,0)
 . D ASKDT Q:'$D(STR)!'$D(STP)
"RTN","MAGDLBSR",83,0)
 . W !,"Please hold sorting by Date. " D SRTDT
"RTN","MAGDLBSR",84,0)
 S BY=Y K DIR,X,Y,DTOUT,DIRUT,DTOUT
"RTN","MAGDLBSR",85,0)
 D PRTDT(BY,$G(STR),$G(STP))
"RTN","MAGDLBSR",86,0)
 K BY,STR,STP
"RTN","MAGDLBSR",87,0)
 Q
"RTN","MAGDRA1")
0^15^B20446208
"RTN","MAGDRA1",1,0)
MAGDRA1 ;WOIFO/LB -Routine for DICOM fix   [ 07/12/2001 15:48 ] ; 12 Aug 2003  12:53 PM
"RTN","MAGDRA1",2,0)
 ;;3.0;IMAGING;**10**;Nov 06, 2003
"RTN","MAGDRA1",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRA1",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRA1",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRA1",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRA1",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRA1",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRA1",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRA1",10,0)
 ;; |                                                               |
"RTN","MAGDRA1",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRA1",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRA1",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRA1",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRA1",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRA1",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRA1",17,0)
 ;;
"RTN","MAGDRA1",18,0)
 Q
"RTN","MAGDRA1",19,0)
LOOP ;Loop thru ^TMP($J,"RAE1" global
"RTN","MAGDRA1",20,0)
 ;MAGDFN should exist.
"RTN","MAGDRA1",21,0)
 ;MAGNME,MAGSSN may exist.
"RTN","MAGDRA1",22,0)
 Q:'$D(^TMP($J,"RAE1"))!('$D(MAGDFN))
"RTN","MAGDRA1",23,0)
 N CCASE,CASE,CDATE,CODE,DATA,DATE,ENTRY,ENTRIES,ERR,ESTAT,INDEX
"RTN","MAGDRA1",24,0)
 N LOC,MAGCASE,MAGCNI,MAGCPT,MAGDTI,MAGPIEN,MAGPRC,MAGPSET,MAGPST
"RTN","MAGDRA1",25,0)
 N OUT,OLDCNI,OLDDT,OLDENTRY,PROC,PSET,PTINFO,RARPT,RADTI,RACNI,RADFN
"RTN","MAGDRA1",26,0)
 N RAMELOW,RAPRTSET,REIN,STAT,X,Y
"RTN","MAGDRA1",27,0)
 S (ENTRY,ENTRIES,OLDDT)=0
"RTN","MAGDRA1",28,0)
 F  S ENTRY=$O(^TMP($J,"RAE1",MAGDFN,ENTRY)) Q:'ENTRY!$G(OUT)  D
"RTN","MAGDRA1",29,0)
 . S DATA=^TMP($J,"RAE1",MAGDFN,ENTRY),ENTRIES=ENTRIES+1
"RTN","MAGDRA1",30,0)
 . S DATE=$P(ENTRY,"-"),CDATE=9999999.9999-DATE
"RTN","MAGDRA1",31,0)
 . S DATE=$TR($$FMTE^XLFDT(CDATE,"2FD")," ","0")
"RTN","MAGDRA1",32,0)
 . S PROC=$P(DATA,"^"),CASE=$P(DATA,"^",2),STAT=$P(DATA,"^",6)
"RTN","MAGDRA1",33,0)
 . S ESTAT=$P(STAT,"~",2),LOC=$P(DATA,"^",7)
"RTN","MAGDRA1",34,0)
 . S RARPT=$P(DATA,"^",5)
"RTN","MAGDRA1",35,0)
 . S RADTI=$P(ENTRY,"-"),RACNI=$P(ENTRY,"-",2),RADFN=MAGDFN
"RTN","MAGDRA1",36,0)
 . S MAGCASE=$$LCASE^MAGDRA2(CDATE,CASE)
"RTN","MAGDRA1",37,0)
 . ;Above radiology variables needed for EN1^RAULT20
"RTN","MAGDRA1",38,0)
 . K RAMELOW,RAPRTSET
"RTN","MAGDRA1",39,0)
 . D EN1^RAUTL20
"RTN","MAGDRA1",40,0)
 . S (PSET,MAGPSET)=""
"RTN","MAGDRA1",41,0)
 . I OLDDT'=RADTI S OLDCNI=""
"RTN","MAGDRA1",42,0)
 . S PSET=$S(RAMEMLOW:"+",RAPRTSET:".",1:"")
"RTN","MAGDRA1",43,0)
 . I PSET="+" S OLDCNI=RACNI
"RTN","MAGDRA1",44,0)
 . I PSET=".",OLDCNI D
"RTN","MAGDRA1",45,0)
 . . N OLDENTRY S OLDENTRY=$P(ENTRY,"-")_"-"_OLDCNI
"RTN","MAGDRA1",46,0)
 . . I $D(^TMP($J,"RAE1",MAGDFN,OLDENTRY)) D
"RTN","MAGDRA1",47,0)
 . . . S MAGCASE=$P(^TMP($J,"RAE1",MAGDFN,OLDENTRY),"^",2)
"RTN","MAGDRA1",48,0)
 . . . S CDATE=$P(ENTRY,"-")
"RTN","MAGDRA1",49,0)
 . . . S CDATE=9999999.9999-CDATE,RADTI=$P(OLDENTRY,"-"),RACNI=OLDCNI
"RTN","MAGDRA1",50,0)
 . . . S MAGCASE=$$LCASE^MAGDRA2(CDATE,MAGCASE)
"RTN","MAGDRA1",51,0)
 . . . S MAGPSET=CASE_" is part of this printset."
"RTN","MAGDRA1",52,0)
 . . . Q
"RTN","MAGDRA1",53,0)
 . . Q
"RTN","MAGDRA1",54,0)
 . I '$D(MAGNME)!'($D(MAGSSN)) D
"RTN","MAGDRA1",55,0)
 . . S PTINFO=$$PTINFO^MAGDRA2
"RTN","MAGDRA1",56,0)
 . . S MAGNME=$P(PTINFO,"^"),MAGSSN=$P(PTINFO,"^",2)
"RTN","MAGDRA1",57,0)
 . . Q
"RTN","MAGDRA1",58,0)
 . S INDEX(ENTRIES)=PROC_"^"_$G(MAGPSET)_"^"_RADTI_"^"_RACNI_"^"_MAGCASE
"RTN","MAGDRA1",59,0)
 . ; Radiology procedure^Printset^Inverse radiology date/time^Radioloty multiple^radiology case number
"RTN","MAGDRA1",60,0)
 . D PRT S OLDDT=RADTI
"RTN","MAGDRA1",61,0)
 . Q
"RTN","MAGDRA1",62,0)
 D:'$G(OUT) SEL I +X,$D(INDEX(+X)) D SET
"RTN","MAGDRA1",63,0)
 K OUT
"RTN","MAGDRA1",64,0)
 Q
"RTN","MAGDRA1",65,0)
PRT ;
"RTN","MAGDRA1",66,0)
 S (X,Y)=0
"RTN","MAGDRA1",67,0)
 I ENTRIES=1 D HEAD
"RTN","MAGDRA1",68,0)
 I $Y+6>IOSL D HEAD
"RTN","MAGDRA1",69,0)
 W !?1,ENTRIES,?5,PSET,?6,CASE_$$IMG^MAGDRA2(RARPT),?12,$E(PROC,1,28)
"RTN","MAGDRA1",70,0)
 W ?41,DATE,?52,$E(ESTAT,1,12),?67,$E(LOC,1,12) Q:ENTRIES#15 
"RTN","MAGDRA1",71,0)
 D SEL
"RTN","MAGDRA1",72,0)
 Q
"RTN","MAGDRA1",73,0)
HEAD ;
"RTN","MAGDRA1",74,0)
 W @IOF,"Patient: ",MAGNME,?50,"SSN: ",MAGSSN
"RTN","MAGDRA1",75,0)
 W !!,?3,"Case #",?12,"Procedure",?41,"Exam Date",?52,"Status of"
"RTN","MAGDRA1",76,0)
 W "Exam",?69,"Imaging Loc"
"RTN","MAGDRA1",77,0)
 W !?3,"--------",?12,"-------------",?41,"---------"
"RTN","MAGDRA1",78,0)
 W ?52,"--------------",?67,"-----------"
"RTN","MAGDRA1",79,0)
 Q
"RTN","MAGDRA1",80,0)
SEL ;
"RTN","MAGDRA1",81,0)
 W !,"'i' next to a case number denotes images collected on study."
"RTN","MAGDRA1",82,0)
 W !,"Type '^' to STOP, or Choose from 1 - ",ENTRIES,": "
"RTN","MAGDRA1",83,0)
 R X:DTIME S:'$T X="^"
"RTN","MAGDRA1",84,0)
 I X="^" S OUT=1 Q
"RTN","MAGDRA1",85,0)
 I X["?" D HLP G SEL
"RTN","MAGDRA1",86,0)
 I $D(INDEX(+X)) D CHECK I 'X G SEL
"RTN","MAGDRA1",87,0)
 I X,'$D(INDEX(+X)) W $C(7)," ??" G SEL
"RTN","MAGDRA1",88,0)
 I +X S X=+X,Y=INDEX(+X) S OUT=1
"RTN","MAGDRA1",89,0)
 Q
"RTN","MAGDRA1",90,0)
HLP ;
"RTN","MAGDRA1",91,0)
 W !?3,"Enter the number corresponding to the exam you wish to select."
"RTN","MAGDRA1",92,0)
 Q
"RTN","MAGDRA1",93,0)
SET ;
"RTN","MAGDRA1",94,0)
 S DATA=Y K Y
"RTN","MAGDRA1",95,0)
 S MAGCASE=$P(INDEX(+X),"^",5)
"RTN","MAGDRA1",96,0)
 S MAGPRC=$P(INDEX(+X),"^"),MAGPIEN=$$PROC^MAGDRA2(MAGPRC)
"RTN","MAGDRA1",97,0)
 S MAGDTI=$P(INDEX(+X),"^",3)
"RTN","MAGDRA1",98,0)
 S MAGPST=$P(INDEX(+X),"^",2)
"RTN","MAGDRA1",99,0)
 S MAGCNI=$P(INDEX(+X),"^",4)
"RTN","MAGDRA1",100,0)
 D MAGDY^MAGDRA2
"RTN","MAGDRA1",101,0)
 Q
"RTN","MAGDRA1",102,0)
CHECK ;
"RTN","MAGDRA1",103,0)
 ;Check to see if the entry still exists.
"RTN","MAGDRA1",104,0)
 N RADTI,CNI
"RTN","MAGDRA1",105,0)
 Q:'MAGDFN
"RTN","MAGDRA1",106,0)
 S RADTI=$P(INDEX(X),"^",3),CNI=$P(INDEX(X),"^",4)
"RTN","MAGDRA1",107,0)
 I '$D(^RADPT(MAGDFN,"DT",RADTI,"P",CNI)) D
"RTN","MAGDRA1",108,0)
 . S X=""
"RTN","MAGDRA1",109,0)
 . W !,"There is a database problem with the entry selected.",!
"RTN","MAGDRA1",110,0)
 . Q
"RTN","MAGDRA1",111,0)
 I $P(INDEX(X),"^")="" D
"RTN","MAGDRA1",112,0)
 . S X=""
"RTN","MAGDRA1",113,0)
 . W !,"There is no procedures for the entry selected.",!
"RTN","MAGDRA1",114,0)
 Q
"RTN","MAGDRA2")
0^16^B24362463
"RTN","MAGDRA2",1,0)
MAGDRA2 ;WOIFO/LB -Routine for DICOM fix  [ 06/20/2001 08:56 ] ; 12 Aug 2003  12:53 PM
"RTN","MAGDRA2",2,0)
 ;;3.0;IMAGING;**10**;Nov 06, 2003
"RTN","MAGDRA2",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRA2",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRA2",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRA2",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRA2",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRA2",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRA2",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRA2",10,0)
 ;; |                                                               |
"RTN","MAGDRA2",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRA2",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRA2",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRA2",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRA2",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRA2",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRA2",17,0)
 ;;
"RTN","MAGDRA2",18,0)
 Q
"RTN","MAGDRA2",19,0)
 ;Routine to create the MAGDY variable needed by MAGDLB1 routine when
"RTN","MAGDRA2",20,0)
 ;mannually correcting DICOM FIX files. 
"RTN","MAGDRA2",21,0)
EN ;
"RTN","MAGDRA2",22,0)
 ; MAGDY variable to be created during this execution.
"RTN","MAGDRA2",23,0)
 N MAGBEG,MAGEND,MAGDFN,MAGOUT,MAGX,MAGXX,INFO,MAGNME,MAGSSN
"RTN","MAGDRA2",24,0)
 S MAGBEG=1070101,MAGEND=$$DT^XLFDT
"RTN","MAGDRA2",25,0)
READ ;
"RTN","MAGDRA2",26,0)
 S (MAGDFN,MAGX)=$$READ^MAGDRA3
"RTN","MAGDRA2",27,0)
 Q:MAGX="^"
"RTN","MAGDRA2",28,0)
 S MAGDFN=+MAGDFN
"RTN","MAGDRA2",29,0)
 I 'MAGDFN W !,"Entry not found, enter a ""^"" to quit." G READ
"RTN","MAGDRA2",30,0)
 ;
"RTN","MAGDRA2",31,0)
 I MAGX["~" G ONE  ;Lookup was on case number and successful
"RTN","MAGDRA2",32,0)
 S MAGXX=$$FIND1^DIC(70,"","","`"_MAGDFN)   ;Radiology patient
"RTN","MAGDRA2",33,0)
 ;
"RTN","MAGDRA2",34,0)
 I MAGDFN=MAGXX D
"RTN","MAGDRA2",35,0)
 . S INFO=$$PTINFO Q:$D(MAGERR)
"RTN","MAGDRA2",36,0)
 . S MAGNME=$P(INFO,"^"),MAGSSN=$P(INFO,"^",2)
"RTN","MAGDRA2",37,0)
 . K ^TMP($J,"RAE1")  ;Re-established by EN1^RA07PC1 -DBIA available
"RTN","MAGDRA2",38,0)
 . ;set the begining and ending date.
"RTN","MAGDRA2",39,0)
 . D EN1^RAO7PC1(MAGDFN,MAGBEG,MAGEND,500)
"RTN","MAGDRA2",40,0)
 . D:$D(^TMP($J,"RAE1")) LOOP^MAGDRA1
"RTN","MAGDRA2",41,0)
 E  D  G:MAGX'="^" READ
"RTN","MAGDRA2",42,0)
 . W !,"No Radiology information found for the supplied answer.",$C(7)
"RTN","MAGDRA2",43,0)
 Q
"RTN","MAGDRA2",44,0)
PTINFO() ;
"RTN","MAGDRA2",45,0)
 N INFO,MAGOUT
"RTN","MAGDRA2",46,0)
 I '$D(MAGDFN) Q ""
"RTN","MAGDRA2",47,0)
 D GETS^DIQ(2,MAGDFN,".01;.09","E","MAGOUT","MAGERR")
"RTN","MAGDRA2",48,0)
 I $D(MAGERR) Q ""
"RTN","MAGDRA2",49,0)
 I $D(MAGOUT) D  Q INFO
"RTN","MAGDRA2",50,0)
 . S INFO=$G(MAGOUT(2,MAGDFN_",",.01,"E"))
"RTN","MAGDRA2",51,0)
 . S INFO=INFO_"^"_$G(MAGOUT(2,MAGDFN_",",.09,"E"))
"RTN","MAGDRA2",52,0)
 Q ""
"RTN","MAGDRA2",53,0)
LCASE(MAGDT,MAGCASE) ;
"RTN","MAGDRA2",54,0)
 Q $TR($TR($$FMTE^XLFDT(MAGDT,"2FD")," ","0"),"/","")_"-"_MAGCASE
"RTN","MAGDRA2",55,0)
 ;
"RTN","MAGDRA2",56,0)
IMG(MAGRPT) ;
"RTN","MAGDRA2",57,0)
 N INFO,MAGOUT,MAGERR
"RTN","MAGDRA2",58,0)
 I 'MAGRPT Q ""
"RTN","MAGDRA2",59,0)
 D GETS^DIQ(74,MAGRPT,"2005*","I","MAGOUT","MAGERR")
"RTN","MAGDRA2",60,0)
 I $D(MAGERR) Q ""
"RTN","MAGDRA2",61,0)
 I $D(MAGOUT(74.02005)) Q " i"
"RTN","MAGDRA2",62,0)
 Q ""
"RTN","MAGDRA2",63,0)
PROC(MAGPRC) ;
"RTN","MAGDRA2",64,0)
 Q $$FIND1^DIC(71,,"XB",MAGPRC)
"RTN","MAGDRA2",65,0)
ONE ;
"RTN","MAGDRA2",66,0)
 ;MAGDFN,MAGX variables expected from EN
"RTN","MAGDRA2",67,0)
 I 'MAGDFN,'+MAGX Q
"RTN","MAGDRA2",68,0)
 N BEG,CASE,CDATE,CS,DATA,END,FLDS,INFO,MAGCASE,MAGCNI,MAGDATE,MAGDTI
"RTN","MAGDRA2",69,0)
 N MAGEXST,MAGLOC,MAGNME,MAGOUT,MAGPIEN,MAGPRC,MAGPSET,MAGPST,MAGRPT
"RTN","MAGDRA2",70,0)
 N PP,PSET,RAENTRY,RAMEMLOW,RAPRTSET,RIEN,STAT,X,X1,X2,XX
"RTN","MAGDRA2",71,0)
 N RARPT,RADFN,RADTI,RACNI ;<--Variables needed for EN1^RAUTL20
"RTN","MAGDRA2",72,0)
 ; RAUTL20 used to retrieve if case is part of a print set.
"RTN","MAGDRA2",73,0)
 ;Q:'MAGDFN!'+$G(MAGX)
"RTN","MAGDRA2",74,0)
 S MAGDFN=$P(MAGX,"~"),INFO=$$PTINFO
"RTN","MAGDRA2",75,0)
 S MAGNME=$P(INFO,"^"),MAGSSN=$P(INFO,"^",2)
"RTN","MAGDRA2",76,0)
 S RIEN=$P(MAGX,"~",2)_","_$P(MAGX,"~",1)
"RTN","MAGDRA2",77,0)
 ;S MAGDFN=$P(MAGX,"~")
"RTN","MAGDRA2",78,0)
 S X1=9999999.9999-$P(MAGX,"~",2),X2=+2 D C^%DTC
"RTN","MAGDRA2",79,0)
 S END=X,BEG=9999999.9999-$P(MAGX,"~",2)
"RTN","MAGDRA2",80,0)
 K ^TMP($J,"RAE1")
"RTN","MAGDRA2",81,0)
 D EN1^RAO7PC1(MAGDFN,BEG,END,20)
"RTN","MAGDRA2",82,0)
 S RAENTRY=$P(MAGX,"~",2)_"-"_$P(MAGX,"~",3)
"RTN","MAGDRA2",83,0)
 Q:'$D(^TMP($J,"RAE1"))
"RTN","MAGDRA2",84,0)
 Q:'$D(^TMP($J,"RAE1",MAGDFN,RAENTRY))
"RTN","MAGDRA2",85,0)
 S DATA=^TMP($J,"RAE1",MAGDFN,RAENTRY)
"RTN","MAGDRA2",86,0)
 S MAGDATE=$P(RAENTRY,"-"),CDATE=9999999.9999-MAGDATE
"RTN","MAGDRA2",87,0)
 S MAGDATE=$TR($$FMTE^XLFDT(CDATE,"2FD")," ","0")
"RTN","MAGDRA2",88,0)
 S MAGPRC=$P(DATA,"^"),CASE=$P(DATA,"^",2),STAT=$P(DATA,"^",6)
"RTN","MAGDRA2",89,0)
 S MAGEXST=$P(STAT,"~",2),MAGLOC=$P(DATA,"^",7)
"RTN","MAGDRA2",90,0)
 S (MAGRPT,RARPT)=$P(DATA,"^",5)
"RTN","MAGDRA2",91,0)
 S (MAGDTI,RADTI)=$P(RAENTRY,"-")
"RTN","MAGDRA2",92,0)
 S (MAGCNI,RACNI)=$P(RAENTRY,"-",2),RADFN=MAGDFN
"RTN","MAGDRA2",93,0)
 S MAGCASE=$$LCASE(CDATE,CASE),MAGPIEN=$$PROC(MAGPRC)
"RTN","MAGDRA2",94,0)
 ; RADTI, RADFN, RACNI variables needed for EN1^RAULT20
"RTN","MAGDRA2",95,0)
 D EN1^RAUTL20
"RTN","MAGDRA2",96,0)
 S (PSET,MAGPSET)=""
"RTN","MAGDRA2",97,0)
 S PSET=$S(RAMEMLOW:"+",RAPRTSET:".",1:"")
"RTN","MAGDRA2",98,0)
 I PSET=".",RACNI>1 D
"RTN","MAGDRA2",99,0)
 . N OLDENTRY S OLDENTRY=$P(RAENTRY,"-")_"-"
"RTN","MAGDRA2",100,0)
 . S OLDENTRY=$O(^TMP($J,"RAE1",MAGDFN,OLDENTRY)) I $L(OLDENTRY) D
"RTN","MAGDRA2",101,0)
 . . S MAGCASE=$P(^TMP($J,"RAE1",MAGDFN,OLDENTRY),"^",2)
"RTN","MAGDRA2",102,0)
 . . S CDATE=$P(RAENTRY,"-")
"RTN","MAGDRA2",103,0)
 . . S CDATE=9999999.9999-CDATE
"RTN","MAGDRA2",104,0)
 . . S MAGCASE=$$LCASE^MAGDRA2(CDATE,MAGCASE),RACNI=$P(OLDENTRY,"-",2)
"RTN","MAGDRA2",105,0)
 . . S MAGPST=CASE_" is part of this printset."
"RTN","MAGDRA2",106,0)
 . . Q
"RTN","MAGDRA2",107,0)
 . Q
"RTN","MAGDRA2",108,0)
 I $D(RAPRTSET) S PP=$S(MAGCNI>1:".",MAGCNI=1:"+",1:"")
"RTN","MAGDRA2",109,0)
 S MAGCNI=RACNI
"RTN","MAGDRA2",110,0)
 W !,"PATIENT: ",MAGNME,?51,"SSN: ",MAGSSN
"RTN","MAGDRA2",111,0)
 W !,"Case No.",?15,"Procedure",?42,"Location",?64,"Exam Date"
"RTN","MAGDRA2",112,0)
 W !,"________",?15,"_________",?42,"________________",?64,"________"
"RTN","MAGDRA2",113,0)
 W !,$G(PP),CASE,$$IMG(MAGRPT),?15,MAGPRC,?42,MAGLOC,?64,MAGDATE
"RTN","MAGDRA2",114,0)
 W !,"Exam status: ",MAGEXST," "," ",$G(MAGPST)
"RTN","MAGDRA2",115,0)
 D MAGDY
"RTN","MAGDRA2",116,0)
 Q
"RTN","MAGDRA2",117,0)
MAGDY ;
"RTN","MAGDRA2",118,0)
 S MAGDY=MAGDFN_"^"_MAGNME_"^"_MAGSSN_"^"_MAGCASE_"^"_MAGPRC_"^"_MAGDTI
"RTN","MAGDRA2",119,0)
 S MAGDY=MAGDY_"^"_MAGCNI_"^"_MAGPIEN_"^"_$G(MAGPST)_"^"
"RTN","MAGDRA2",120,0)
 K MAGNME,MAGSSN,MAGCASE,MAGPRC,MAGDTI,MAGCNI,MAGPIEN,MAPST
"RTN","MAGDRA2",121,0)
 Q
"RTN","MAGDRCU1")
0^23^B29520523
"RTN","MAGDRCU1",1,0)
MAGDRCU1 ;WOIFO/PMK - List entries in ^MAG(2006.5839) ; 30 Jul 2003  8:25 AM
"RTN","MAGDRCU1",2,0)
 ;;3.0;IMAGING;**10**;Nov 06, 2003
"RTN","MAGDRCU1",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRCU1",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRCU1",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRCU1",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRCU1",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRCU1",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRCU1",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRCU1",10,0)
 ;; |                                                               |
"RTN","MAGDRCU1",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRCU1",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRCU1",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRCU1",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRCU1",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRCU1",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRCU1",17,0)
 ;;
"RTN","MAGDRCU1",18,0)
 ; This routine lists the entries in the temporary Imaging/CPRS Consult
"RTN","MAGDRCU1",19,0)
 ; Request Tracking association file
"RTN","MAGDRCU1",20,0)
 ;
"RTN","MAGDRCU1",21,0)
 ;     XXXX                                         XXX       X
"RTN","MAGDRCU1",22,0)
 ;    XX  XX                                         XX      XX
"RTN","MAGDRCU1",23,0)
 ;   XX         XXXX    XX XXX  XXXXXXX  XX  XXX     XX     XXXXX
"RTN","MAGDRCU1",24,0)
 ;   XX        XX  XX   XXX XX  XX       XX  XX      XX      XX
"RTN","MAGDRCU1",25,0)
 ;   XX    X   XX  XX   XX  XX  XXXXXXX  XX  XX      XX      XX
"RTN","MAGDRCU1",26,0)
 ;    XX  XX   XX  XX   XX  XX       XX  XX  XX      XX      XX XX
"RTN","MAGDRCU1",27,0)
 ;     XXXX     XXXX    XX  XX  XXXXXXX   XXX XX    XXXX      XXX
"RTN","MAGDRCU1",28,0)
 ;
"RTN","MAGDRCU1",29,0)
 ;
"RTN","MAGDRCU1",30,0)
 ; Routine 1/2 for application
"RTN","MAGDRCU1",31,0)
 ;
"RTN","MAGDRCU1",32,0)
ENTRY ; read the entries in file ^MAG(2006.5839)
"RTN","MAGDRCU1",33,0)
 N COUNT,CUTOFF,DAYS,DIVISION,DONE,INDEX,SELECT,SERVICE,SORT,TITLE,X
"RTN","MAGDRCU1",34,0)
 ;
"RTN","MAGDRCU1",35,0)
 S TITLE="UNREAD LIST FOR HEALTHCARE PROVIDERS"
"RTN","MAGDRCU1",36,0)
 W !!,TITLE,!!
"RTN","MAGDRCU1",37,0)
 ;
"RTN","MAGDRCU1",38,0)
 ; get the division and service list
"RTN","MAGDRCU1",39,0)
 S SERVICE=0 F  S SERVICE=$O(^MAG(2006.5831,SERVICE)) Q:'SERVICE  D
"RTN","MAGDRCU1",40,0)
 . S X=^MAG(2006.5831,SERVICE,0)
"RTN","MAGDRCU1",41,0)
 . S INDEX=$P(X,"^",2),DIVISION=$P(X,"^",3)
"RTN","MAGDRCU1",42,0)
 . S SERVICE(DIVISION)=$$GET1^DIQ(4,DIVISION,.01)
"RTN","MAGDRCU1",43,0)
 . S SERVICE(DIVISION,INDEX)=$P(^MAG(2005.84,INDEX,0),"^",1)
"RTN","MAGDRCU1",44,0)
 . S SERVICE(DIVISION,INDEX,SERVICE)=$$GET1^DIQ(123.5,SERVICE,.01)
"RTN","MAGDRCU1",45,0)
 . Q
"RTN","MAGDRCU1",46,0)
 ;
"RTN","MAGDRCU1",47,0)
 ;
"RTN","MAGDRCU1",48,0)
 I '$D(SERVICE) W !,"No SERVICE are defined in file 2006.5831" Q
"RTN","MAGDRCU1",49,0)
 ;
"RTN","MAGDRCU1",50,0)
 ; select the SERVICE of interest
"RTN","MAGDRCU1",51,0)
 S DONE=0 F  D  Q:DONE
"RTN","MAGDRCU1",52,0)
 . S COUNT=0,DIVISION=""
"RTN","MAGDRCU1",53,0)
 . W !
"RTN","MAGDRCU1",54,0)
 . F  S DIVISION=$O(SERVICE(DIVISION)) Q:'DIVISION  D
"RTN","MAGDRCU1",55,0)
 . . S INDEX=""
"RTN","MAGDRCU1",56,0)
 . . F  S INDEX=$O(SERVICE(DIVISION,INDEX)) Q:INDEX=""  D
"RTN","MAGDRCU1",57,0)
 . . . S COUNT=COUNT+1
"RTN","MAGDRCU1",58,0)
 . . . W !,$J(COUNT,2),") ",$J(DIVISION,4)," -- ",SERVICE(DIVISION)
"RTN","MAGDRCU1",59,0)
 . . . W " -- ",SERVICE(DIVISION,INDEX)
"RTN","MAGDRCU1",60,0)
 . . . S SERVICE("B",COUNT)=DIVISION_"^"_INDEX
"RTN","MAGDRCU1",61,0)
 . . . Q
"RTN","MAGDRCU1",62,0)
 . . Q
"RTN","MAGDRCU1",63,0)
 . I COUNT=1 S SELECT="ALL",DONE=1
"RTN","MAGDRCU1",64,0)
 . E  D
"RTN","MAGDRCU1",65,0)
 . . W !!,"Select the proper service (1-",COUNT,") or enter ALL: " R X:DTIME
"RTN","MAGDRCU1",66,0)
 . . I X?.N,X,X'>COUNT S SELECT=SERVICE("B",X),DONE=1
"RTN","MAGDRCU1",67,0)
 . . E  I $L(X),"Aa"[$E(X) S SELECT="ALL",DONE=1
"RTN","MAGDRCU1",68,0)
 . . E  I X["^" S DONE=-1
"RTN","MAGDRCU1",69,0)
 . . E  I X["?" D
"RTN","MAGDRCU1",70,0)
 . . . W !!,"Please enter the number of the corresponding service."
"RTN","MAGDRCU1",71,0)
 . . . W !,"Enter ""ALL"" if you want all of the services."
"RTN","MAGDRCU1",72,0)
 . . . Q
"RTN","MAGDRCU1",73,0)
 . . E  W " ???"
"RTN","MAGDRCU1",74,0)
 . . Q
"RTN","MAGDRCU1",75,0)
 . Q
"RTN","MAGDRCU1",76,0)
 I DONE=-1 Q  ; cancelled by user
"RTN","MAGDRCU1",77,0)
 ;
"RTN","MAGDRCU1",78,0)
 I SELECT="ALL" D
"RTN","MAGDRCU1",79,0)
 . S DIVISION=""
"RTN","MAGDRCU1",80,0)
 . F  S DIVISION=$O(SERVICE(DIVISION)) Q:'DIVISION  D
"RTN","MAGDRCU1",81,0)
 . . S INDEX=""
"RTN","MAGDRCU1",82,0)
 . . F  S INDEX=$O(SERVICE(DIVISION,INDEX)) Q:INDEX=""  D
"RTN","MAGDRCU1",83,0)
 . . . D SELSERV(DIVISION,INDEX)
"RTN","MAGDRCU1",84,0)
 . . . Q
"RTN","MAGDRCU1",85,0)
 E  D
"RTN","MAGDRCU1",86,0)
 . S DIVISION=$P(SELECT,"^",1),INDEX=$P(SELECT,"^",2)
"RTN","MAGDRCU1",87,0)
 . D SELSERV(DIVISION,INDEX)
"RTN","MAGDRCU1",88,0)
 . Q
"RTN","MAGDRCU1",89,0)
 ;
"RTN","MAGDRCU1",90,0)
 S DONE=0 F  D  Q:DONE
"RTN","MAGDRCU1",91,0)
 . W !!,"Display studies older than how many days?  0// "
"RTN","MAGDRCU1",92,0)
 . R X:DTIME I X="" S X=0 W X
"RTN","MAGDRCU1",93,0)
 . I X?.N S DAYS=X,DONE=1 Q
"RTN","MAGDRCU1",94,0)
 . E  I X["^" S DONE=-1
"RTN","MAGDRCU1",95,0)
 . E  I X["?" D
"RTN","MAGDRCU1",96,0)
 . . W !!,"Please enter the minimum number of days that have elapsed since"
"RTN","MAGDRCU1",97,0)
 . . W !,"the examination was performed.  This allows only the old studies"
"RTN","MAGDRCU1",98,0)
 . . W !,"to be reported.  Enter 0 days to display all the studies."
"RTN","MAGDRCU1",99,0)
 . . Q
"RTN","MAGDRCU1",100,0)
 . E  W " ???"
"RTN","MAGDRCU1",101,0)
 . Q
"RTN","MAGDRCU1",102,0)
 I DONE=-1 Q  ; cancelled by user
"RTN","MAGDRCU1",103,0)
 S %H=($H+1)-DAYS D YMD^%DTC S CUTOFF=X
"RTN","MAGDRCU1",104,0)
 ;
"RTN","MAGDRCU1",105,0)
 S DONE=0 F  D  Q:DONE
"RTN","MAGDRCU1",106,0)
 . W !!,"Sort by patient name or examination date? (N or D) D// "
"RTN","MAGDRCU1",107,0)
 . R X:DTIME I X="" S X="D" W X
"RTN","MAGDRCU1",108,0)
 . I "NnDd"[$E(X) S SORT=X,DONE=1 Q
"RTN","MAGDRCU1",109,0)
 . E  I X["^" S DONE=-1
"RTN","MAGDRCU1",110,0)
 . E  I X["?" D
"RTN","MAGDRCU1",111,0)
 . . W !!,"Designate the sort order for the report, alphabetically by patient"
"RTN","MAGDRCU1",112,0)
 . . W !,"name or chronologically by the examination date."
"RTN","MAGDRCU1",113,0)
 . . Q
"RTN","MAGDRCU1",114,0)
 . E  W " ???"
"RTN","MAGDRCU1",115,0)
 . Q
"RTN","MAGDRCU1",116,0)
 I DONE=-1 Q  ; cancelled by user
"RTN","MAGDRCU1",117,0)
 ;
"RTN","MAGDRCU1",118,0)
 I SELECT="ALL" S SUBTITLE(1)="ALL SERVICES"
"RTN","MAGDRCU1",119,0)
 E  D
"RTN","MAGDRCU1",120,0)
 . S SUBTITLE(1)=$P(SELECT,"^",1)_" -- "_SERVICE($P(SELECT,"^",1))
"RTN","MAGDRCU1",121,0)
 . S SUBTITLE(1)=SUBTITLE(1)_" -- "_SERVICE($P(SELECT,"^",1),$P(SELECT,"^",2))
"RTN","MAGDRCU1",122,0)
 . Q
"RTN","MAGDRCU1",123,0)
 I DAYS S SUBTITLE(2)="Studies more than "_DAYS_" days old"
"RTN","MAGDRCU1",124,0)
 E  S SUBTITLE(2)="All studies regardless of age"
"RTN","MAGDRCU1",125,0)
 S SUBTITLE(2)=SUBTITLE(2)_" sorted by "_$S(SORT="D":"date",1:"name")
"RTN","MAGDRCU1",126,0)
 ;
"RTN","MAGDRCU1",127,0)
 ; Output the report
"RTN","MAGDRCU1",128,0)
 ;
"RTN","MAGDRCU1",129,0)
 W ! S %ZIS="Q" D ^%ZIS I POP Q  ; select the output device, quit if none
"RTN","MAGDRCU1",130,0)
 ;
"RTN","MAGDRCU1",131,0)
 ; setup for queueing the report to print in the background via Taskman 
"RTN","MAGDRCU1",132,0)
 I $D(IO("Q")) D  ; queued
"RTN","MAGDRCU1",133,0)
 . S ZTSAVE("CUTOFF")=""
"RTN","MAGDRCU1",134,0)
 . S ZTSAVE("SELECT")=""
"RTN","MAGDRCU1",135,0)
 . S ZTSAVE("SERVICE(")=""
"RTN","MAGDRCU1",136,0)
 . S ZTSAVE("SORT")=""
"RTN","MAGDRCU1",137,0)
 . S ZTSAVE("SUBTITLE(")=""
"RTN","MAGDRCU1",138,0)
 . S ZTSAVE("TITLE")=""
"RTN","MAGDRCU1",139,0)
 . S ZTSAVE("WRK")=""
"RTN","MAGDRCU1",140,0)
 . S ZTRTN="REPORT^MAGDRCU2",ZTDESC=TITLE
"RTN","MAGDRCU1",141,0)
 . D ^%ZTLOAD D HOME^%ZIS K IO("Q")
"RTN","MAGDRCU1",142,0)
 . Q
"RTN","MAGDRCU1",143,0)
 E  D  ; immediate
"RTN","MAGDRCU1",144,0)
 . D REPORT^MAGDRCU2
"RTN","MAGDRCU1",145,0)
 . Q
"RTN","MAGDRCU1",146,0)
 Q
"RTN","MAGDRCU1",147,0)
 ;
"RTN","MAGDRCU1",148,0)
SELSERV(DIVISION,INDEX) ; select service
"RTN","MAGDRCU1",149,0)
 N S
"RTN","MAGDRCU1",150,0)
 S S=""
"RTN","MAGDRCU1",151,0)
 F  S S=$O(SERVICE(DIVISION,INDEX,S)) Q:S=""  D
"RTN","MAGDRCU1",152,0)
 . S SERVICE("S",S)=SERVICE(DIVISION,INDEX,S)
"RTN","MAGDRCU1",153,0)
 . Q
"RTN","MAGDRCU1",154,0)
 Q
"RTN","MAGDRCU1",155,0)
 ;
"RTN","MAGDRCU2")
0^24^B38102722
"RTN","MAGDRCU2",1,0)
MAGDRCU2 ;WOIFO/PMK - List entries in ^MAG(2006.5839) ; 19 Aug 2003  10:17 AM
"RTN","MAGDRCU2",2,0)
 ;;3.0;IMAGING;**10**;Nov 06, 2003
"RTN","MAGDRCU2",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRCU2",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRCU2",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRCU2",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRCU2",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRCU2",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRCU2",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRCU2",10,0)
 ;; |                                                               |
"RTN","MAGDRCU2",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRCU2",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRCU2",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRCU2",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRCU2",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRCU2",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRCU2",17,0)
 ;;
"RTN","MAGDRCU2",18,0)
 ; This routine lists the entries in the temporary Imaging/CPRS Consult
"RTN","MAGDRCU2",19,0)
 ; Request Tracking association file
"RTN","MAGDRCU2",20,0)
 ;
"RTN","MAGDRCU2",21,0)
 ;
"RTN","MAGDRCU2",22,0)
 ;     XXXX                                         XXX       X
"RTN","MAGDRCU2",23,0)
 ;    XX  XX                                         XX      XX
"RTN","MAGDRCU2",24,0)
 ;   XX         XXXX    XX XXX  XXXXXXX  XX  XXX     XX     XXXXX
"RTN","MAGDRCU2",25,0)
 ;   XX        XX  XX   XXX XX  XX       XX  XX      XX      XX
"RTN","MAGDRCU2",26,0)
 ;   XX    X   XX  XX   XX  XX  XXXXXXX  XX  XX      XX      XX
"RTN","MAGDRCU2",27,0)
 ;    XX  XX   XX  XX   XX  XX       XX  XX  XX      XX      XX XX
"RTN","MAGDRCU2",28,0)
 ;     XXXX     XXXX    XX  XX  XXXXXXX   XXX XX    XXXX      XXX
"RTN","MAGDRCU2",29,0)
 ;
"RTN","MAGDRCU2",30,0)
 ;
"RTN","MAGDRCU2",31,0)
 ; Routine 2/2 in for application
"RTN","MAGDRCU2",32,0)
 ;
"RTN","MAGDRCU2",33,0)
REPORT ; now scan the database and generate the report
"RTN","MAGDRCU2",34,0)
 N D0,DATE,DFN,DOB,EXAMDATE,GMRCDFN,GMRCIEN,I,LASTDFN,LASTEXAM
"RTN","MAGDRCU2",35,0)
 N MAGIEN,MAGIEN1,NOW,ORDRDATE,PAGE,PID,PNAME,REQTYPE
"RTN","MAGDRCU2",36,0)
 N SEX,STATUS,STOP,VA,VAERR,VADM,WRK,X,Y,Z
"RTN","MAGDRCU2",37,0)
 ;
"RTN","MAGDRCU2",38,0)
 S WRK=$NA(^TMP("MAG",$J,"GMRC"))
"RTN","MAGDRCU2",39,0)
 D NOW^%DTC,YX^%DTC S NOW=Y
"RTN","MAGDRCU2",40,0)
 K @WRK
"RTN","MAGDRCU2",41,0)
 ;
"RTN","MAGDRCU2",42,0)
 S D0=0
"RTN","MAGDRCU2",43,0)
 I $E(IOST)="C" W !,"Building"
"RTN","MAGDRCU2",44,0)
 F  S D0=$O(^MAG(2006.5839,D0)) Q:'D0  S X=^(D0,0) D
"RTN","MAGDRCU2",45,0)
 . I $P(X,"^",1)'="123" D
"RTN","MAGDRCU2",46,0)
 . . N MSG
"RTN","MAGDRCU2",47,0)
 . . S MSG(1)="Problem with Temporary Imaging/CPRS file"
"RTN","MAGDRCU2",48,0)
 . . S MSG(2)="Entry #"_D0_" in ^MAG(2006.5839) does not begin"
"RTN","MAGDRCU2",49,0)
 . . S MSG(3)="with 123 - it doesn't point to CPRS Consult Request Tracking"
"RTN","MAGDRCU2",50,0)
 . . S MSG(4)="Bad record: <<"_X_">>"
"RTN","MAGDRCU2",51,0)
 . . D ERROR(.MSG)
"RTN","MAGDRCU2",52,0)
 . . Q
"RTN","MAGDRCU2",53,0)
 . E  D
"RTN","MAGDRCU2",54,0)
 . . S GMRCIEN=$P(X,"^",2),MAGIEN=$P(X,"^",3)
"RTN","MAGDRCU2",55,0)
 . . S DFN=$P(^MAG(2005,MAGIEN,0),"^",7)
"RTN","MAGDRCU2",56,0)
 . . S GMRCDFN=$$GET1^DIQ(123,GMRCIEN,.02,"I")
"RTN","MAGDRCU2",57,0)
 . . I DFN'=GMRCDFN D
"RTN","MAGDRCU2",58,0)
 . . . N MSG
"RTN","MAGDRCU2",59,0)
 . . . S MSG(1)="DICOM IMAGE PROCESSING ERROR - CONSULT/IMAGING PATIENT MISMATCH"
"RTN","MAGDRCU2",60,0)
 . . . S MSG(2)="The image and the consult point to different patients."
"RTN","MAGDRCU2",61,0)
 . . . S MSG(3)=""
"RTN","MAGDRCU2",62,0)
 . . . S MSG(4)="The Image points to PATIENT file internal entry number "_DFN
"RTN","MAGDRCU2",63,0)
 . . . S MSG(5)=$$PATDEMO^MAGDIRE(DFN)
"RTN","MAGDRCU2",64,0)
 . . . S MSG(6)=""
"RTN","MAGDRCU2",65,0)
 . . . S MSG(7)="The Consult points to PATIENT file internal entry number "_GMRCDFN
"RTN","MAGDRCU2",66,0)
 . . . S MSG(8)=$$PATDEMO^MAGDIRE(GMRCDFN)
"RTN","MAGDRCU2",67,0)
 . . . S MSG(9)=""
"RTN","MAGDRCU2",68,0)
 . . . D ERROR(.MSG)
"RTN","MAGDRCU2",69,0)
 . . . Q
"RTN","MAGDRCU2",70,0)
 . . E  D
"RTN","MAGDRCU2",71,0)
 . . . ; check that this is a service of interest
"RTN","MAGDRCU2",72,0)
 . . . S SERVICE=$$GET1^DIQ(123,GMRCIEN,1,"I")
"RTN","MAGDRCU2",73,0)
 . . . I '$D(SERVICE("S",SERVICE)) Q
"RTN","MAGDRCU2",74,0)
 . . . ; check cutoff date
"RTN","MAGDRCU2",75,0)
 . . . S I=$O(^MAG(2005,MAGIEN,1,0)),MAGIEN1=$P(^(I,0),"^",1)
"RTN","MAGDRCU2",76,0)
 . . . S EXAMDATE=$P(^MAG(2005,MAGIEN1,2),"^",1) I EXAMDATE>CUTOFF Q
"RTN","MAGDRCU2",77,0)
 . . . S ORDRDATE=$$GET1^DIQ(123,GMRCIEN,.01)
"RTN","MAGDRCU2",78,0)
 . . . S ORDRDATE=$P(ORDRDATE,",",1)_","_$E($P(ORDRDATE,",",2),4,5)
"RTN","MAGDRCU2",79,0)
 . . . S STATUS=$$GET1^DIQ(123,GMRCIEN,8,"I")
"RTN","MAGDRCU2",80,0)
 . . . I '$D(STATUS(STATUS)) D
"RTN","MAGDRCU2",81,0)
 . . . . S STATUS(STATUS)=$$GET1^DIQ(100.01,STATUS,.1)
"RTN","MAGDRCU2",82,0)
 . . . . Q
"RTN","MAGDRCU2",83,0)
 . . . S REQTYPE=$$GET1^DIQ(123,GMRCIEN,13,"I")
"RTN","MAGDRCU2",84,0)
 . . . D DEM^VADPT
"RTN","MAGDRCU2",85,0)
 . . . S PNAME=VADM(1),PID=VA("PID")
"RTN","MAGDRCU2",86,0)
 . . . S DOB=$P(VADM(3),"^",2),SEX=$P(VADM(5),"^",2)
"RTN","MAGDRCU2",87,0)
 . . . S (I,@WRK@(0))=$G(@WRK@(0))+1
"RTN","MAGDRCU2",88,0)
 . . . S Z=DFN_"^"_PNAME_"^"_PID_"^"_SEX_"^"_DOB
"RTN","MAGDRCU2",89,0)
 . . . S Z=Z_"^"_GMRCIEN_"^"_SERVICE_"^"_ORDRDATE_"^"_STATUS
"RTN","MAGDRCU2",90,0)
 . . . S Z=Z_"^"_REQTYPE_"^"_EXAMDATE
"RTN","MAGDRCU2",91,0)
 . . . S @WRK@(I)=Z
"RTN","MAGDRCU2",92,0)
 . . . S @WRK@("P",PNAME,DFN,I)=""
"RTN","MAGDRCU2",93,0)
 . . . S @WRK@("D",EXAMDATE\1,PNAME,DFN,I)=""
"RTN","MAGDRCU2",94,0)
 . . . I $E(IOST)="C" W:$X>79 ! W "."
"RTN","MAGDRCU2",95,0)
 . . . Q
"RTN","MAGDRCU2",96,0)
 . . Q
"RTN","MAGDRCU2",97,0)
 . Q
"RTN","MAGDRCU2",98,0)
 ;
"RTN","MAGDRCU2",99,0)
 ; output the report
"RTN","MAGDRCU2",100,0)
 ; 
"RTN","MAGDRCU2",101,0)
 U IO D HEADING
"RTN","MAGDRCU2",102,0)
 S STOP=0
"RTN","MAGDRCU2",103,0)
 ;
"RTN","MAGDRCU2",104,0)
 I "Dd"[SORT D  ; output sorted by examination date
"RTN","MAGDRCU2",105,0)
 . S DATE="" F  S DATE=$O(@WRK@("D",DATE)) Q:DATE=""!STOP  D
"RTN","MAGDRCU2",106,0)
 . . D NEWLINE(5)
"RTN","MAGDRCU2",107,0)
 . . K LASTDFN ; force output of name
"RTN","MAGDRCU2",108,0)
 . . S PNAME="" F  S PNAME=$O(@WRK@("D",DATE,PNAME)) Q:PNAME=""!STOP  D
"RTN","MAGDRCU2",109,0)
 . . . S DFN="" F  S DFN=$O(@WRK@("D",DATE,PNAME,DFN)) Q:DFN=""!STOP  D
"RTN","MAGDRCU2",110,0)
 . . . . S I="" F  S I=$O(@WRK@("D",DATE,PNAME,DFN,I)) Q:I=""!STOP  D
"RTN","MAGDRCU2",111,0)
 . . . . . D ONELINE
"RTN","MAGDRCU2",112,0)
 . . . . . Q
"RTN","MAGDRCU2",113,0)
 . . . . Q
"RTN","MAGDRCU2",114,0)
 . . . Q
"RTN","MAGDRCU2",115,0)
 . . Q
"RTN","MAGDRCU2",116,0)
 . Q
"RTN","MAGDRCU2",117,0)
 ;
"RTN","MAGDRCU2",118,0)
 E  D  ; output sorted by name
"RTN","MAGDRCU2",119,0)
 . S PNAME="" F  S PNAME=$O(@WRK@("P",PNAME)) Q:PNAME=""!STOP  D
"RTN","MAGDRCU2",120,0)
 . . S DFN="" F  S DFN=$O(@WRK@("P",PNAME,DFN)) Q:DFN=""!STOP  D
"RTN","MAGDRCU2",121,0)
 . . . S I="" F  S I=$O(@WRK@("P",PNAME,DFN,I)) Q:I=""!STOP  D
"RTN","MAGDRCU2",122,0)
 . . . . K LASTEXAM ; force output of examination date
"RTN","MAGDRCU2",123,0)
 . . . . D ONELINE
"RTN","MAGDRCU2",124,0)
 . . . . Q
"RTN","MAGDRCU2",125,0)
 . . . Q
"RTN","MAGDRCU2",126,0)
 . . Q
"RTN","MAGDRCU2",127,0)
 . Q
"RTN","MAGDRCU2",128,0)
 ;
"RTN","MAGDRCU2",129,0)
 D ^%ZISC I $D(ZTQUEUED) S ZTREQ="@" ; standard kernel exit
"RTN","MAGDRCU2",130,0)
 K @WRK
"RTN","MAGDRCU2",131,0)
 Q
"RTN","MAGDRCU2",132,0)
 ;
"RTN","MAGDRCU2",133,0)
ONELINE ; output one line of the report
"RTN","MAGDRCU2",134,0)
 S X=@WRK@(I)
"RTN","MAGDRCU2",135,0)
 I DFN'=$G(LASTDFN) D
"RTN","MAGDRCU2",136,0)
 . S PID=$P(X,"^",3),SEX=$P(X,"^",4),DOB=$P(X,"^",5)
"RTN","MAGDRCU2",137,0)
 . D NEWLINE(4),NEWLINE(3)
"RTN","MAGDRCU2",138,0)
 . W PNAME,"   ",PID,"   (",SEX,")   ",DOB
"RTN","MAGDRCU2",139,0)
 . S LASTDFN=DFN
"RTN","MAGDRCU2",140,0)
 . Q
"RTN","MAGDRCU2",141,0)
 S GMRCIEN=$P(X,"^",6),SERVICE=$P(X,"^",7),ORDRDATE=$P(X,"^",8)
"RTN","MAGDRCU2",142,0)
 S STATUS=$P(X,"^",9),REQTYPE=$P(X,"^",10),EXAMDATE=$P(X,"^",11)
"RTN","MAGDRCU2",143,0)
 S REQTYPE=$S(REQTYPE="C":"Consult",REQTYPE="P":"Procedure",1:"Unknown")
"RTN","MAGDRCU2",144,0)
 D NEWLINE(1)
"RTN","MAGDRCU2",145,0)
 W "  ",ORDRDATE," (",STATUS(STATUS),") ",$E(SERVICE("S",SERVICE),1,30)
"RTN","MAGDRCU2",146,0)
 W "  ",REQTYPE," #",GMRCIEN
"RTN","MAGDRCU2",147,0)
 S Y=EXAMDATE D DD^%DT S EXAMDATE=$P(Y,",",1)_","_$E($P(Y,",",2),4,5)
"RTN","MAGDRCU2",148,0)
 I EXAMDATE'=$G(LASTEXAM) D
"RTN","MAGDRCU2",149,0)
 . W ?65,"Exam: ",EXAMDATE
"RTN","MAGDRCU2",150,0)
 . S LASTEXAM=EXAMDATE
"RTN","MAGDRCU2",151,0)
 . Q
"RTN","MAGDRCU2",152,0)
 Q
"RTN","MAGDRCU2",153,0)
 ;
"RTN","MAGDRCU2",154,0)
NEWLINE(J) ; output a <cr> <lf> with scrolling control or pagination
"RTN","MAGDRCU2",155,0)
 N I
"RTN","MAGDRCU2",156,0)
 W !
"RTN","MAGDRCU2",157,0)
 I $Y<(IOSL-J) Q  ; nothing else do do
"RTN","MAGDRCU2",158,0)
 I $E(IOST)="C" D  ; scrolling for a crt
"RTN","MAGDRCU2",159,0)
 . N I,X
"RTN","MAGDRCU2",160,0)
 . W "more..." R X:DTIME F I=1:1:$X W $C(8,32,8)
"RTN","MAGDRCU2",161,0)
 . S $Y=0 Q:X=""
"RTN","MAGDRCU2",162,0)
 . S:$TR(X,"quitexnQUITEXN","^^^^^^^^^^^^^^")["^" STOP=1
"RTN","MAGDRCU2",163,0)
 . Q
"RTN","MAGDRCU2",164,0)
 E  D  ; pagination for a file or a printer
"RTN","MAGDRCU2",165,0)
 . F Y=$Y:1:(IOSL-1) W !
"RTN","MAGDRCU2",166,0)
 . S PAGE=$G(PAGE)+1 W ?IOM-10,"Page ",PAGE,!
"RTN","MAGDRCU2",167,0)
 . D HEADING
"RTN","MAGDRCU2",168,0)
 . Q
"RTN","MAGDRCU2",169,0)
 Q
"RTN","MAGDRCU2",170,0)
 ;
"RTN","MAGDRCU2",171,0)
HEADING ; print heading
"RTN","MAGDRCU2",172,0)
 W @IOF,TITLE,?IOM-$L(NOW),NOW,!
"RTN","MAGDRCU2",173,0)
 I ($L(SUBTITLE(1))+$L(SUBTITLE(2)))<(IOM-4) D
"RTN","MAGDRCU2",174,0)
 . W SUBTITLE(1)," -- ",SUBTITLE(2)
"RTN","MAGDRCU2",175,0)
 . Q
"RTN","MAGDRCU2",176,0)
 E  D
"RTN","MAGDRCU2",177,0)
 . W SUBTITLE(1),!,SUBTITLE(2)
"RTN","MAGDRCU2",178,0)
 . Q
"RTN","MAGDRCU2",179,0)
 W !
"RTN","MAGDRCU2",180,0)
 Q
"RTN","MAGDRCU2",181,0)
 ;
"RTN","MAGDRCU2",182,0)
ERROR(MSG) ; Error Message
"RTN","MAGDRCU2",183,0)
 N I
"RTN","MAGDRCU2",184,0)
 W ! F I=1:1:80 W "*"
"RTN","MAGDRCU2",185,0)
 F I=1:1 Q:'$D(MSG(I))  W !,"*** ",MSG(I),?76," ***"
"RTN","MAGDRCU2",186,0)
 W ! F I=1:1:80 W "*"
"RTN","MAGDRCU2",187,0)
 Q
"RTN","MAGDROUT")
0^9^B11345086
"RTN","MAGDROUT",1,0)
MAGDROUT ;WOIFO/EdM - Copy routine code ; 07 Oct 2003  3:07 PM
"RTN","MAGDROUT",2,0)
 ;;3.0;IMAGING;**10**;Nov 06, 2003
"RTN","MAGDROUT",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDROUT",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDROUT",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDROUT",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDROUT",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDROUT",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDROUT",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDROUT",10,0)
 ;; |                                                               |
"RTN","MAGDROUT",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDROUT",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDROUT",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDROUT",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDROUT",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDROUT",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDROUT",17,0)
 ;;
"RTN","MAGDROUT",18,0)
 ; This routine can be used to copy code from the VistA system
"RTN","MAGDROUT",19,0)
 ; to a DICOM Gateway computer.
"RTN","MAGDROUT",20,0)
 ;
"RTN","MAGDROUT",21,0)
 ; The entry point VISTA collects the software from the live system
"RTN","MAGDROUT",22,0)
 ; and stores it in ^MAGD.
"RTN","MAGDROUT",23,0)
 ;
"RTN","MAGDROUT",24,0)
 ; The entry point DICOM takes the software from the global variable
"RTN","MAGDROUT",25,0)
 ; and stores it in the local system.
"RTN","MAGDROUT",26,0)
 Q
"RTN","MAGDROUT",27,0)
 ;
"RTN","MAGDROUT",28,0)
VISTA D SAVE(1)
"RTN","MAGDROUT",29,0)
 Q
"RTN","MAGDROUT",30,0)
 ;
"RTN","MAGDROUT",31,0)
SILENT D SAVE(0)
"RTN","MAGDROUT",32,0)
 Q
"RTN","MAGDROUT",33,0)
 ;
"RTN","MAGDROUT",34,0)
SAVE(VERBOSE) ; Collect active code
"RTN","MAGDROUT",35,0)
 N D0,D1,I,N,R,X
"RTN","MAGDROUT",36,0)
 S VERBOSE=+$G(VERBOSE),N=0
"RTN","MAGDROUT",37,0)
 ;
"RTN","MAGDROUT",38,0)
 ; From Kernel:
"RTN","MAGDROUT",39,0)
 F R="XLFDT","XUSRB1" S R(R)=""
"RTN","MAGDROUT",40,0)
 ; From Radiology 5.0
"RTN","MAGDROUT",41,0)
 F R="RARIC","RARTE2","RAUTL","RAUTL1","RAUTL2","RAUTL20","RAUTL3","RAUTL5","RAXREF" S R(R)=""
"RTN","MAGDROUT",42,0)
 ; From MAS
"RTN","MAGDROUT",43,0)
 F R="VADPT","VADPT0","VADPT1","VADPT2","VADPT3","VADPT30","VADPT31","VADPT32","VADPT4","VADPT5","VADPT6","VADPT60","VADPT61","VADPT62" S R(R)=""
"RTN","MAGDROUT",44,0)
 ; From TIU
"RTN","MAGDROUT",45,0)
 F R="TIULC1","TIULS","TIUSRVPL" S R(R)=""
"RTN","MAGDROUT",46,0)
 ; From Medicine
"RTN","MAGDROUT",47,0)
 S R="MCUIMAG0",R(R)=""
"RTN","MAGDROUT",48,0)
 ;
"RTN","MAGDROUT",49,0)
 ; Store the code from the routines:
"RTN","MAGDROUT",50,0)
 W !!,"Saving source code for Imaging..."
"RTN","MAGDROUT",51,0)
 W:VERBOSE !!,"Now copying:",!
"RTN","MAGDROUT",52,0)
 S R="" F  S R=$O(R(R)) Q:R=""  D
"RTN","MAGDROUT",53,0)
 . N %
"RTN","MAGDROUT",54,0)
 . W:VERBOSE !,R,?15 S N=N+1
"RTN","MAGDROUT",55,0)
 . D NOW^%DTC
"RTN","MAGDROUT",56,0)
 . S D0=$O(^MAGD(2006.79,"B",R,"")) D:'D0
"RTN","MAGDROUT",57,0)
 . . L +^MAGD(2006.79)
"RTN","MAGDROUT",58,0)
 . . S X=$G(^MAGD(2006.79,0)),$P(X,"^",1,2)="DICOM ROUTINE COPY^2006.79"
"RTN","MAGDROUT",59,0)
 . . S D0=$O(^MAGD(2006.79," "),-1)+1
"RTN","MAGDROUT",60,0)
 . . S ^MAGD(2006.79,D0,0)=R_"^"_%,^MAGD(2006.79,"B",R,D0)=""
"RTN","MAGDROUT",61,0)
 . . S $P(X,"^",3)=D0,$P(X,"^",4)=$P(X,"^",4)+1
"RTN","MAGDROUT",62,0)
 . . S ^MAGD(2006.79,0)=X
"RTN","MAGDROUT",63,0)
 . . L -^MAGD(2006.79)
"RTN","MAGDROUT",64,0)
 . . Q
"RTN","MAGDROUT",65,0)
 . S X=$G(^MAGD(2006.79,D0,0)),$P(X,"^",2)=%
"RTN","MAGDROUT",66,0)
 . L +^MAGD(2006.79,D0)
"RTN","MAGDROUT",67,0)
 . K ^MAGD(2006.79,D0,1)
"RTN","MAGDROUT",68,0)
 . S D1=0 F I=1:1 S X=$T(+I^@R) Q:X=""  S D1=D1+1,^MAGD(2006.79,D0,1,D1,0)=X
"RTN","MAGDROUT",69,0)
 . S ^MAGD(2006.79,D0,1,0)="^2006.791^"_D1_"^"_D1
"RTN","MAGDROUT",70,0)
 . L -^MAGD(2006.79,D0)
"RTN","MAGDROUT",71,0)
 . I VERBOSE W $J(D1,4)," line" W:D1'=1 "s"
"RTN","MAGDROUT",72,0)
 . Q
"RTN","MAGDROUT",73,0)
 W !,"Code saved for ",N," routine" W:N'=1 "s" W "."
"RTN","MAGDROUT",74,0)
 Q
"RTN","MAGDROUT",75,0)
 ;
"RTN","MAGDROUT",76,0)
DICOM ; Restore routines in DICOM environment
"RTN","MAGDROUT",77,0)
 ;N D0,D1,L,N,R,S,X
"RTN","MAGDROUT",78,0)
 S R="" F  S R=$O(^MAGD(2006.79,"B",R)) Q:R=""  D
"RTN","MAGDROUT",79,0)
 . S D0="" F  S D0=$O(^MAGD(2006.79,"B",R,D0)) Q:D0=""  D
"RTN","MAGDROUT",80,0)
 . . W !,R,?15
"RTN","MAGDROUT",81,0)
 . . S X="ZR  S D1=0 F  S D1=$O(^MAGD(2006.79,D0,1,D1)),L="""" S:D1 L=^MAGD(2006.79,D0,1,D1,0),N=D1 ZI:L'="""" L I 'D1 ZS "_R_" ZL "_$T(+0)_" Q"
"RTN","MAGDROUT",82,0)
 . . X X
"RTN","MAGDROUT",83,0)
 . . W $J(N,4)," line" W:N'=1 "s"
"RTN","MAGDROUT",84,0)
 . . Q
"RTN","MAGDROUT",85,0)
 . Q
"RTN","MAGDROUT",86,0)
 Q
"RTN","MAGGNTI")
0^7^B25218336
"RTN","MAGGNTI",1,0)
MAGGNTI ;WOIFO/GEK - Imaging interface to TIU RPC Calls etc. ; 04 Apr 2002  2:37 PM
"RTN","MAGGNTI",2,0)
 ;;3.0;IMAGING;**10**;Nov 06, 2003
"RTN","MAGGNTI",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGNTI",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGGNTI",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGGNTI",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGGNTI",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGGNTI",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGGNTI",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGGNTI",10,0)
 ;; |                                                               |
"RTN","MAGGNTI",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGGNTI",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGGNTI",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGGNTI",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGGNTI",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGGNTI",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGNTI",17,0)
 ;;
"RTN","MAGGNTI",18,0)
 Q
"RTN","MAGGNTI",19,0)
FILE(MAGRY,MAGDA,TIUDA) ; RPC Call to file TIU and Imaging Pointers
"RTN","MAGGNTI",20,0)
 ; TIU API to add image to TIU
"RTN","MAGGNTI",21,0)
 I $P(^TIU(8925,TIUDA,0),U,2)'=$P(^MAG(2005,MAGDA,0),U,7) S MAGRY="0^Patient Mismatch." Q
"RTN","MAGGNTI",22,0)
 D PUTIMAGE^TIUSRVPL(.MAGRY,TIUDA,MAGDA) ;
"RTN","MAGGNTI",23,0)
 I 'MAGRY Q
"RTN","MAGGNTI",24,0)
 ; Now SET the Parent fields in the Image File
"RTN","MAGGNTI",25,0)
 S $P(^MAG(2005,MAGDA,2),U,6,8)=8925_U_TIUDA_U_+MAGRY
"RTN","MAGGNTI",26,0)
 ; DONE.
"RTN","MAGGNTI",27,0)
 S MAGRY="1^Image pointer filed successfully"
"RTN","MAGGNTI",28,0)
 Q
"RTN","MAGGNTI",29,0)
DATA(MAGRY,TIUDA) ;RPC Call to get TIU data from the TIUDA
"RTN","MAGGNTI",30,0)
 ; Return =     TIUDA^Document Type ^Document Date
"RTN","MAGGNTI",31,0)
 ;
"RTN","MAGGNTI",32,0)
 S MAGRY=TIUDA_U_$$GET1^DIQ(8925,TIUDA,".01","E")_U_$$GET1^DIQ(8925,TIUDA,"1201","I")
"RTN","MAGGNTI",33,0)
 Q
"RTN","MAGGNTI",34,0)
IMAGES(MAGRY,TIUDA) ;RPC Call to get all images for a given TIU DA
"RTN","MAGGNTI",35,0)
 ; We first get all Image IEN's breaking groups into seperate images
"RTN","MAGGNTI",36,0)
 ; Then get Image Info for each one.
"RTN","MAGGNTI",37,0)
 ; MAGRY    -     Return array of Image Data entries
"RTN","MAGGNTI",38,0)
 ; MAGRY(0)    is   1 ^ message  if successful
"RTN","MAGGNTI",39,0)
 ;                  0 ^ Error message if error;
"RTN","MAGGNTI",40,0)
 ; TIUDA  is IEN in ^TIU(8925
"RTN","MAGGNTI",41,0)
 ;
"RTN","MAGGNTI",42,0)
 ; Call TIU API to get list of Image IEN's
"RTN","MAGGNTI",43,0)
 N MAGARR,CT,TCT K ^TMP("MAGGX",$J)
"RTN","MAGGNTI",44,0)
 N MAGZZ,DA,MAGQI,MAGNCHK
"RTN","MAGGNTI",45,0)
 N TIUDFN,MAGQUIT ; MAGQI 8/22/01
"RTN","MAGGNTI",46,0)
 S MAGQUIT=0 ; MAGQI 8/22/01
"RTN","MAGGNTI",47,0)
 S TIUDFN=$P(^TIU(8925,TIUDA,0),U,2) ;MAGQI 8/22/01
"RTN","MAGGNTI",48,0)
 D GETILST^TIUSRVPL(.MAGARR,TIUDA)
"RTN","MAGGNTI",49,0)
 S CT=0,TCT=0
"RTN","MAGGNTI",50,0)
 ; Now get all images for all groups and single images.
"RTN","MAGGNTI",51,0)
 S I="" F  S I=$O(MAGARR(I)) Q:'I  S DA=MAGARR(I) D  ;Q:MAGQUIT
"RTN","MAGGNTI",52,0)
 . S Z=$$ISDELIMG(DA) I Z S TCT=TCT+1,MAGRY(TCT)="B2^"_Z Q
"RTN","MAGGNTI",53,0)
 . ; Check that array of images from selected TIUDA have 
"RTN","MAGGNTI",54,0)
 . ;     same patient's and valid backward pointers
"RTN","MAGGNTI",55,0)
 . I $P($G(^MAG(2005,DA,0)),U,7)'=TIUDFN S MAGQUIT=1,MAGNCHK="Patient Mismatch. TIU: "_TIUDA
"RTN","MAGGNTI",56,0)
 . I $P($G(^MAG(2005,DA,2)),U,7)'=TIUDA S MAGQUIT=1,MAGNCHK="Pointer Mismatch. TIU: "_TIUDA
"RTN","MAGGNTI",57,0)
 . I MAGQUIT S MAGXX=DA D INFO^MAGGTII D  Q
"RTN","MAGGNTI",58,0)
 . . ; remove the Abstract and Image File Names
"RTN","MAGGNTI",59,0)
 . . S $P(MAGFILE,U,2,3)="-1~Questionable Data Integrity^c:\program files\vista\imaging\bmp\imageQA.bmp"
"RTN","MAGGNTI",60,0)
 . . ;this stops Delphi App from changing Abstract BMP to OFFLINE IMAGE
"RTN","MAGGNTI",61,0)
 . . S $P(MAGFILE,U,6)=$S(($P(MAGFILE,U,6)'=11):"99",1:11)
"RTN","MAGGNTI",62,0)
 . . S $P(MAGFILE,U,10)="M"
"RTN","MAGGNTI",63,0)
 . . ;Send the error message
"RTN","MAGGNTI",64,0)
 . . S $P(MAGFILE,U,17)=MAGNCHK
"RTN","MAGGNTI",65,0)
 . . S TCT=TCT+1,MAGRY(TCT)="B2^"_MAGFILE
"RTN","MAGGNTI",66,0)
 . ;
"RTN","MAGGNTI",67,0)
 . I $O(^MAG(2005,DA,1,0)) D  Q
"RTN","MAGGNTI",68,0)
 . . ; Integrity check, if group is questionable, add it's ien to list, not it's 
"RTN","MAGGNTI",69,0)
 . . ;   children.  Later when list is looped through, it's INFO^MAGGTII will be in 
"RTN","MAGGNTI",70,0)
 . . ;   list.  Have to do this to allow other images in list from TIU to be processed.
"RTN","MAGGNTI",71,0)
 . . D CHK^MAGGSQI(.MAGQI,DA) I 'MAGQI(0) S CT=CT+1,^TMP("MAGGX",$J,CT)=DA Q
"RTN","MAGGNTI",72,0)
 . . S J=0 ; the following line needs to take only the first piece of the node - PMK 4/4/02
"RTN","MAGGNTI",73,0)
 . . F  S J=$O(^MAG(2005,DA,1,J)) Q:'J  S CT=CT+1,^TMP("MAGGX",$J,CT)=$P(^(J,0),"^")
"RTN","MAGGNTI",74,0)
 . S CT=CT+1
"RTN","MAGGNTI",75,0)
 . S ^TMP("MAGGX",$J,CT)=DA
"RTN","MAGGNTI",76,0)
 ; Now get image info for each image
"RTN","MAGGNTI",77,0)
 ;
"RTN","MAGGNTI",78,0)
 S Z=""
"RTN","MAGGNTI",79,0)
 S MAGQUIET=1
"RTN","MAGGNTI",80,0)
 F  S Z=$O(^TMP("MAGGX",$J,Z)) Q:Z=""  D
"RTN","MAGGNTI",81,0)
 . S TCT=TCT+1,MAGXX=^TMP("MAGGX",$J,Z)
"RTN","MAGGNTI",82,0)
 . ;GEK 8/24/00 Stoping the Invalid Image IEN's and Deleted Images
"RTN","MAGGNTI",83,0)
 . I '$D(^MAG(2005,MAGXX)) D  Q
"RTN","MAGGNTI",84,0)
 . . D INVALID^MAGGTIG(MAGXX,.MSGX) S MAGRY(CT)=MSGX
"RTN","MAGGNTI",85,0)
 . D BOTH^MAGFILEB
"RTN","MAGGNTI",86,0)
 . S MAGRY(TCT)="B2^"_MAGFILE
"RTN","MAGGNTI",87,0)
 K MAGQUIET
"RTN","MAGGNTI",88,0)
 S MAGRY(0)=TCT_"^"_TCT_" Images for the selected TIU NOTE"
"RTN","MAGGNTI",89,0)
 ; PUT THE Image IEN of the last image into the group ien field.
"RTN","MAGGNTI",90,0)
 Q:'TCT
"RTN","MAGGNTI",91,0)
 S $P(MAGRY(0),U,3)=TIUDA
"RTN","MAGGNTI",92,0)
 D DATA(.MAGZZ,TIUDA)
"RTN","MAGGNTI",93,0)
 S $P(MAGRY(0),U,4)=$$GET1^DIQ(8925,TIUDA,".02","E")_"  "_$P(MAGZZ,U,2)_"  "_$$FMTE^XLFDT($P(MAGZZ,U,3),"8")
"RTN","MAGGNTI",94,0)
 ;
"RTN","MAGGNTI",95,0)
 S $P(MAGRY(0),U,5)=$S($P($G(MAGFILE),U):$P(MAGFILE,U),1:MAGXX)
"RTN","MAGGNTI",96,0)
 Q
"RTN","MAGGNTI",97,0)
 ;. S Z=ISDELIMG(DA) I Z S TCT=TCT+1,MAGRY(TCT)="B2^"_$P(Z,U,2) Q
"RTN","MAGGNTI",98,0)
ISDELIMG(MAGIEN) ; Is this a deleted Image.
"RTN","MAGGNTI",99,0)
 N MAGEL,MAGIMG,MAGR,Z,MAGT
"RTN","MAGGNTI",100,0)
 S MAGDEL=$D(^MAG(2005.1,MAGIEN))
"RTN","MAGGNTI",101,0)
 S MAGIMG=$D(^MAG(2005,MAGIEN))
"RTN","MAGGNTI",102,0)
 I MAGIMG,'MAGDEL S MAGR="0^Valid Image"
"RTN","MAGGNTI",103,0)
 I 'MAGIMG,MAGDEL S MAGR="1^Deleted Image",MAGT=66
"RTN","MAGGNTI",104,0)
 I 'MAGIMG,'MAGDEL S MAGR="1^Invalid Image pointer",MAGT=67
"RTN","MAGGNTI",105,0)
 I MAGIMG,MAGDEL S MAGR="0^Image IEN exists, and is Deleted !"
"RTN","MAGGNTI",106,0)
 I 'MAGR Q MAGR
"RTN","MAGGNTI",107,0)
 S MAGR=$P(MAGR,U,2)
"RTN","MAGGNTI",108,0)
 S $P(Z,U,1,4)=MAGIEN_"^-1~"_MAGR_"^-1~"_MAGR_"^"_MAGR ;c:\program files\vista\imaging\bmp\imageQA.bmp"
"RTN","MAGGNTI",109,0)
 S $P(Z,U,6)=MAGT
"RTN","MAGGNTI",110,0)
 ;this stops Delphi App from changing Abstract BMP to OFFLINE IMAGE
"RTN","MAGGNTI",111,0)
 S $P(Z,U,10)="M"
"RTN","MAGGNTI",112,0)
 ;Send the error message
"RTN","MAGGNTI",113,0)
 S $P(Z,U,17)=$P(MAGR,U,2)
"RTN","MAGGNTI",114,0)
 Q Z
"RTN","MAGGNTI",115,0)
 ;
"RTN","MAGGTIA2")
0^8^B18840525
"RTN","MAGGTIA2",1,0)
MAGGTIA2 ;WOIFO/GEK - Imaging Utilities for Add/Modify Image entry ; 07 Jun 2002  12:00 PM [ 07/08/2002  12:08 PM ]
"RTN","MAGGTIA2",2,0)
 ;;3.0;IMAGING;**10**;Nov 06, 2003
"RTN","MAGGTIA2",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGTIA2",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGGTIA2",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGGTIA2",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGGTIA2",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGGTIA2",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGGTIA2",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGGTIA2",10,0)
 ;; |                                                               |
"RTN","MAGGTIA2",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGGTIA2",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGGTIA2",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGGTIA2",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGGTIA2",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGGTIA2",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGTIA2",17,0)
 ;;
"RTN","MAGGTIA2",18,0)
 Q
"RTN","MAGGTIA2",19,0)
RSLVPLC ;VISN15  We are here to resolve the institution pointer 
"RTN","MAGGTIA2",20,0)
 ;  field .05  In consolidated sites, we need this field.
"RTN","MAGGTIA2",21,0)
 ;  But if workstation hasn't updated yet, we'll try DUZ(2) for Capture Workstations
"RTN","MAGGTIA2",22,0)
 N PLC
"RTN","MAGGTIA2",23,0)
 ; USE of MAGJOB("VERSION") for this purpose will have to change.  All calls will be setting it later.
"RTN","MAGGTIA2",24,0)
 I '$D(MAGJOB("VERSION")) D  ; Peter or Import API is calling;
"RTN","MAGGTIA2",25,0)
 . I '$D(MAGGFDA(2005,"+1,",.05)) S MAGERR="0^Required data missing: INSTITUTION.!" Q
"RTN","MAGGTIA2",26,0)
 . I '$D(DUZ(2)) S DUZ(2)=MAGGFDA(2005,"+1,",.05) ; Peter's change.
"RTN","MAGGTIA2",27,0)
 ;. I '$D(MAGGFDA(2005,"+1,",.04)) D
"RTN","MAGGTIA2",28,0)
 ;. . S PLC=+$$PLACE^MAGBAPI(MAGGFDA(2005,"+1,",.05))
"RTN","MAGGTIA2",29,0)
 ;. . I 'PLC S MAGERR="0^Institution isn't registered in Imaging Site Parameters File.!" Q
"RTN","MAGGTIA2",30,0)
 ;. . S MAGGFDA(2005,"+1,",.04)=PLC
"RTN","MAGGTIA2",31,0)
 I $D(MAGJOB("VERSION")) D  ; Capture Workstation is calling;
"RTN","MAGGTIA2",32,0)
 . I '$D(MAGGFDA(2005,"+1,",.05)) D DUZ2INST I $L(MAGERR) Q
"RTN","MAGGTIA2",33,0)
 ;. I '$D(MAGGFDA(2005,"+1,",.04)) D
"RTN","MAGGTIA2",34,0)
 ;. . S PLC=+$$PLACE^MAGBAPI(MAGGFDA(2005,"+1,",.05))
"RTN","MAGGTIA2",35,0)
 ;. . I 'PLC S MAGERR="0^Institution isn't registered in Imaging Site Parameters File.!" Q
"RTN","MAGGTIA2",36,0)
 ;. . S MAGGFDA(2005,"+1,",.04)=PLC
"RTN","MAGGTIA2",37,0)
 Q
"RTN","MAGGTIA2",38,0)
DUZ2INST ;VISN15 Compute the Users Institution for older versions of Imaging Capture workstation.
"RTN","MAGGTIA2",39,0)
 ; Newer versions will have DUZ(2) defined.  Either from New Person, or default from
"RTN","MAGGTIA2",40,0)
 ; Kernel System Parameter file.
"RTN","MAGGTIA2",41,0)
 N MAGINST
"RTN","MAGGTIA2",42,0)
 S MAGINST=+$G(DUZ(2))
"RTN","MAGGTIA2",43,0)
 I 'MAGINST D  ; If we don't have a DUZ(2) check the user's Divisions in New Person.
"RTN","MAGGTIA2",44,0)
 . I +$P($G(^VA(200,DUZ,2,0)),U,4)=0 Q
"RTN","MAGGTIA2",45,0)
 . I $P($G(^VA(200,DUZ,2,0)),U,4)=1 S MAGINST=$O(^VA(200,DUZ,2,0))
"RTN","MAGGTIA2",46,0)
 . I 'MAGINST S MAGINST=+$O(^VA(200,DUZ,2,"AX1",1,""))
"RTN","MAGGTIA2",47,0)
 I 'MAGINST S MAGERR="You must update your workstation to the latest Version of Imaging.  Call IRM." Q
"RTN","MAGGTIA2",48,0)
 S MAGGFDA(2005,"+1,",.05)=MAGINST
"RTN","MAGGTIA2",49,0)
 Q
"RTN","MAGGTIA2",50,0)
 ;
"RTN","MAGGTIA2",51,0)
QACHK(MAGY,MAGDFN,MAGPK,MAGPKDA) ; Check Patient of Parent Report against patient we 
"RTN","MAGGTIA2",52,0)
 ;   are saving image too.
"RTN","MAGGTIA2",53,0)
 ;
"RTN","MAGGTIA2",54,0)
 S MAGDFN=$G(MAGDFN),MAGPK=$G(MAGPK),MAGPKDA=$G(MAGPKDA)
"RTN","MAGGTIA2",55,0)
 S ^TMP("MAGFDA",$J,"DFN")=MAGDFN
"RTN","MAGGTIA2",56,0)
 S ^TMP("MAGFDA",$J,"PK")=MAGPK
"RTN","MAGGTIA2",57,0)
 S ^TMP("MAGFDA",$J,"PKDA")=MAGPKDA
"RTN","MAGGTIA2",58,0)
 S MAGY="0^Checking for Matching Patients..."
"RTN","MAGGTIA2",59,0)
 I 'MAGDFN S MAGY="0^Missing Patient ID." Q
"RTN","MAGGTIA2",60,0)
 I 'MAGPK,'MAGPKDA S MAGY="1^No Report associated with Image." Q
"RTN","MAGGTIA2",61,0)
 I MAGPK,'MAGPKDA S MAGY="0^Missing Parent root" Q
"RTN","MAGGTIA2",62,0)
 I 'MAGPK,MAGPKDA S MAGY="0^Parent root, but Missing Parent." Q
"RTN","MAGGTIA2",63,0)
 ; Here we have Parent and root. and Patient DFN.
"RTN","MAGGTIA2",64,0)
 ; Surgery reports
"RTN","MAGGTIA2",65,0)
 I (MAGPK=130) D  Q
"RTN","MAGGTIA2",66,0)
 . I '(MAGDFN=$P(^SRF(MAGPKDA,0),U,1)) S MAGY="0^Patient Mismatch" Q
"RTN","MAGGTIA2",67,0)
 . S MAGY="1^Image and Report Package Patients are the same."
"RTN","MAGGTIA2",68,0)
 ; TIU documents;
"RTN","MAGGTIA2",69,0)
 I MAGPK=8925 D  Q
"RTN","MAGGTIA2",70,0)
 . I '(MAGDFN=$P($G(^TIU(8925,MAGPKDA,0)),U,2)) S MAGY="0^Patient Mismatch" Q
"RTN","MAGGTIA2",71,0)
 . S MAGY="1^Image and Report Package Patients are the same."
"RTN","MAGGTIA2",72,0)
 ; Medicine reports
"RTN","MAGGTIA2",73,0)
 I ((MAGPK>689.999)&(MAGPK<703)) D  Q
"RTN","MAGGTIA2",74,0)
 . I '(MAGDFN=$P($G(^MCAR(MAGPK,MAGPKDA,0)),U,2)) S MAGY="0^Patient Mismatch" Q
"RTN","MAGGTIA2",75,0)
 . S MAGY="1^Image and Report Package Patients are the same."
"RTN","MAGGTIA2",76,0)
 ; Radiology reports
"RTN","MAGGTIA2",77,0)
 I MAGPK=74 D  Q
"RTN","MAGGTIA2",78,0)
 . I '(MAGDFN=$P($G(^RARPT(MAGPKDA,0)),U,2)) S MAGY="0^Patient Mismatch" Q
"RTN","MAGGTIA2",79,0)
 . S MAGY="1^Image and Report Package Patients are the same."
"RTN","MAGGTIA2",80,0)
 ; Laboratory reports
"RTN","MAGGTIA2",81,0)
 I (MAGPK>62.999)&(MAGPK<64) D  Q
"RTN","MAGGTIA2",82,0)
 . ;I $P(^MAG(2005.03,MAGTMPRT,0),"^",4)=63
"RTN","MAGGTIA2",83,0)
 . S MAGY="1^Lab image not checked "
"RTN","MAGGTIA2",84,0)
 . S MAGY="1^Image and Report Package Patients are the same."
"RTN","MAGGTIA2",85,0)
 ; temporary DICOM GMRC list (waiting for TIU notes for the association)
"RTN","MAGGTIA2",86,0)
 I MAGPK=2006.5839 D  Q
"RTN","MAGGTIA2",87,0)
 . N GMRCIEN
"RTN","MAGGTIA2",88,0)
 . I '$D(^MAG(2006.5839,MAGPKDA,0)) S MAGY="1^Temporary GMRC Link not made yet" Q
"RTN","MAGGTIA2",89,0)
 . S GMRCIEN=$P(^MAG(2006.5839,MAGPKDA,0),U,2)
"RTN","MAGGTIA2",90,0)
 . I '(MAGDFN=$P(^GMR(123,GMRCIEN,0),U,2)) S MAGY="0^Patient Mismatch" Q
"RTN","MAGGTIA2",91,0)
 . S MAGY="1^Image and Report Package Patients are the same."
"RTN","MAGGTIA2",92,0)
 S MAGY="0^Invalid Parent Package Pointer: "_MAGPK
"RTN","MAGGTIA2",93,0)
 Q
"RTN","MAGIPS10")
0^^B13283667
"RTN","MAGIPS10",1,0)
MAGIPS10 ;Post init routine to queue site activity at install. ; 11/06/2003  08:38
"RTN","MAGIPS10",2,0)
 ;;3.0;IMAGING;**10**;Nov 06, 2003
"RTN","MAGIPS10",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGIPS10",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGIPS10",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGIPS10",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGIPS10",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGIPS10",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGIPS10",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGIPS10",10,0)
 ;; |                                                               |
"RTN","MAGIPS10",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGIPS10",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGIPS10",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGIPS10",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGIPS10",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGIPS10",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGIPS10",17,0)
 ;;
"RTN","MAGIPS10",18,0)
 Q
"RTN","MAGIPS10",19,0)
POST ;
"RTN","MAGIPS10",20,0)
 D REMTASK^MAGQE4
"RTN","MAGIPS10",21,0)
 D STTASK^MAGQE4
"RTN","MAGIPS10",22,0)
 D INS(XPDNM,DUZ,$$NOW^XLFDT,XPDA)
"RTN","MAGIPS10",23,0)
 D POSTI^MAGQBUT
"RTN","MAGIPS10",24,0)
 Q
"RTN","MAGIPS10",25,0)
PRE ;Problems with DDs for the worklist.
"RTN","MAGIPS10",26,0)
 N FILE,ZOUT,DATA
"RTN","MAGIPS10",27,0)
 F FILE=2006.55,2006.56 I $$VFILE^DILFD(FILE) D DELFILE(FILE)
"RTN","MAGIPS10",28,0)
 ;Remove the test file 2006.555 & 2006.5832 - Remove data
"RTN","MAGIPS10",29,0)
 ;File 2006.5832 is no longer used t9 
"RTN","MAGIPS10",30,0)
 ;File 2006.5831 has changed in t9
"RTN","MAGIPS10",31,0)
 F FILE=2006.555,2006.5832 I $$VFILE^DILFD(FILE) D DELFILE(FILE,1)
"RTN","MAGIPS10",32,0)
 S FILE=2006.5831,DATA=1
"RTN","MAGIPS10",33,0)
 I $$VFILE^DILFD(FILE) D 
"RTN","MAGIPS10",34,0)
 . D FIELD^DID(FILE,2,"","SPECIFIER","ZOUT")
"RTN","MAGIPS10",35,0)
 . I $G(ZOUT("SPECIFIER"))="RP2005.84'" S DATA=0
"RTN","MAGIPS10",36,0)
 . D DELFILE(FILE,DATA)
"RTN","MAGIPS10",37,0)
 . Q
"RTN","MAGIPS10",38,0)
 Q
"RTN","MAGIPS10",39,0)
DELFILE(NUMBER,DATA) ;
"RTN","MAGIPS10",40,0)
 N DIU,SNDX
"RTN","MAGIPS10",41,0)
 I '$D(DATA) S DATA=0
"RTN","MAGIPS10",42,0)
 Q:'NUMBER
"RTN","MAGIPS10",43,0)
 I (NUMBER<2005)!(NUMBER>2006.9999) Q
"RTN","MAGIPS10",44,0)
 ; Remove subfile before deleting the file.
"RTN","MAGIPS10",45,0)
 S SNDX="" F  S SNDX=$O(^DD(NUMBER,"SB",SNDX)) Q:SNDX'?1N.N.".".N  D
"RTN","MAGIPS10",46,0)
 . S DIU=SNDX,DIU(0)="S" D EN^DIU2
"RTN","MAGIPS10",47,0)
 . Q
"RTN","MAGIPS10",48,0)
 S DIU=NUMBER,DIU(0)="E"
"RTN","MAGIPS10",49,0)
 I DATA S DIU(0)="DE"
"RTN","MAGIPS10",50,0)
 W !,"FILE # ",NUMBER D EN^DIU2
"RTN","MAGIPS10",51,0)
 K DIU
"RTN","MAGIPS10",52,0)
 Q
"RTN","MAGIPS10",53,0)
 ;
"RTN","MAGIPS10",54,0)
INS(XP,DUZ,DATE,IDA) ;
"RTN","MAGIPS10",55,0)
 N CT,CNT,COM,D,D0,D1,D2,DDATE,DG,DIC,DICR,DIW,MAGMSG,ST,XMID,XMY
"RTN","MAGIPS10",56,0)
 D GETENV^%ZOSV
"RTN","MAGIPS10",57,0)
 S CNT=0
"RTN","MAGIPS10",58,0)
 S CNT=CNT+1,MAGMSG(CNT)="PACKAGE INSTALL"
"RTN","MAGIPS10",59,0)
 S CNT=CNT+1,MAGMSG(CNT)="SITE: "_$$KSP^XUPARAM("WHERE")
"RTN","MAGIPS10",60,0)
 S CNT=CNT+1,MAGMSG(CNT)="PACKAGE: "_XP
"RTN","MAGIPS10",61,0)
 S CNT=CNT+1,MAGMSG(CNT)="Version: "_$$VER^XPDUTL(XP)
"RTN","MAGIPS10",62,0)
 S ST=$$GET1^DIQ(9.7,IDA,11,"I")
"RTN","MAGIPS10",63,0)
 S CNT=CNT+1,MAGMSG(CNT)="Start time: "_$$FMTE^XLFDT(ST)
"RTN","MAGIPS10",64,0)
 S CT=$$GET1^DIQ(9.7,IDA,17,"I") S:+CT'=CT CT=$$NOW^XLFDT
"RTN","MAGIPS10",65,0)
 S CNT=CNT+1,MAGMSG(CNT)="Completion time: "_$$FMTE^XLFDT(CT)
"RTN","MAGIPS10",66,0)
 S CNT=CNT+1,MAGMSG(CNT)="Run time: "_$$FMDIFF^XLFDT(CT,ST,3)
"RTN","MAGIPS10",67,0)
 S CNT=CNT+1,MAGMSG(CNT)="Environment: "_Y
"RTN","MAGIPS10",68,0)
 S COM=$$GET1^DIQ(9.7,IDA,6,"I")
"RTN","MAGIPS10",69,0)
 S CNT=CNT+1,MAGMSG(CNT)="FILE COMMENT: "_COM
"RTN","MAGIPS10",70,0)
 S CNT=CNT+1,MAGMSG(CNT)="DATE: "_DATE
"RTN","MAGIPS10",71,0)
 S CNT=CNT+1,MAGMSG(CNT)="Installed by: "_$$GET1^DIQ(9.7,IDA,9,"E")
"RTN","MAGIPS10",72,0)
 S CNT=CNT+1,MAGMSG(CNT)="Install Name: "_$$GET1^DIQ(9.7,IDA,.01,"E")
"RTN","MAGIPS10",73,0)
 S DDATE=$$GET1^DIQ(9.7,IDA,51,"I")
"RTN","MAGIPS10",74,0)
 S CNT=CNT+1,MAGMSG(CNT)="Distribution Date: "_$$FMTE^XLFDT(DDATE)
"RTN","MAGIPS10",75,0)
 S XMSUB=XP_" INSTALLATION"
"RTN","MAGIPS10",76,0)
 S XMID=$G(DUZ) S:'XMID XMID=.5
"RTN","MAGIPS10",77,0)
 S XMY(XMID)=""
"RTN","MAGIPS10",78,0)
 S XMY("G.MAG SERVER")=""
"RTN","MAGIPS10",79,0)
 S:$G(MAGDUZ) XMY(MAGDUZ)=""
"RTN","MAGIPS10",80,0)
 S XMSUB=$E(XMSUB,1,63)
"RTN","MAGIPS10",81,0)
 D SENDMSG^XMXAPI(XMID,XMSUB,"MAGMSG",.XMY,,.XMZ,)
"RTN","MAGIPS10",82,0)
 I $G(XMERR) M XMERR=^TMP("XMERR",$J) S $EC=",U13-Cannot send MailMan message,"
"RTN","MAGIPS10",83,0)
 Q
"RTN","MAGIPS10",84,0)
 ;
"RTN","MAGSDEL2")
0^17^B14423252
"RTN","MAGSDEL2",1,0)
MAGSDEL2 ;WOIFO/SRR/RED - Delete parent pointers ; [ 06/20/2001 08:57 ]
"RTN","MAGSDEL2",2,0)
 ;;3.0;IMAGING;**10**;Nov 06, 2003
"RTN","MAGSDEL2",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGSDEL2",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGSDEL2",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGSDEL2",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGSDEL2",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGSDEL2",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGSDEL2",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGSDEL2",10,0)
 ;; |                                                               |
"RTN","MAGSDEL2",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGSDEL2",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGSDEL2",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGSDEL2",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGSDEL2",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGSDEL2",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGSDEL2",17,0)
 ;;
"RTN","MAGSDEL2",18,0)
DELPAR ; delete parent pointers
"RTN","MAGSDEL2",19,0)
 I '$D(^MAG(2005,MAGIEN,2)) S DELMSG="Image IEN doesn't Exist in Image File" G ERROR
"RTN","MAGSDEL2",20,0)
 S MAGTMP=^MAG(2005,MAGIEN,2),MAGSTORE=$P(MAGTMP,"^",6)_":"_$P(MAGTMP,"^",7)_":"_$P(MAGTMP,"^",8)_":"_$P(MAGTMP,"^",10)
"RTN","MAGSDEL2",21,0)
 S MAGPARRT=$P(MAGTMP,"^",6) I MAGPARRT="" G EXIT ;No parent pointer
"RTN","MAGSDEL2",22,0)
 I '$D(^MAG(2005.03,MAGPARRT,0)) S DELMSG="Image Entry has INVALID Pointer to Imaging Parent Data File " G ERROR
"RTN","MAGSDEL2",23,0)
 S MAGPAR=^MAG(2005.03,MAGPARRT,0)
"RTN","MAGSDEL2",24,0)
 S MAGTYP=$P(MAGPAR,"^",3)
"RTN","MAGSDEL2",25,0)
 S MAGPARRT=$P(MAGPAR,"^",4) I MAGPARRT="" S DELMSG="Parent Data File entry is missing field 'File Pointer'" G ERROR
"RTN","MAGSDEL2",26,0)
 S DA=$P(MAGTMP,"^",8) ;G:DA="" ERROR
"RTN","MAGSDEL2",27,0)
 ; /GEK added next 2 lines, comment out G:DA in line above
"RTN","MAGSDEL2",28,0)
 ; this will catch PACS images that don't send IEN of the 2005 Multiple
"RTN","MAGSDEL2",29,0)
 ; in the parent file.
"RTN","MAGSDEL2",30,0)
 N MAGRT,MAGROOT
"RTN","MAGSDEL2",31,0)
 I 'DA,MAGPARRT[2006.5839 S DA=123
"RTN","MAGSDEL2",32,0)
 ; Setting DA to 123 is for the DICOM TEMP file.
"RTN","MAGSDEL2",33,0)
 I 'DA D GETDA^MAGSDEL4(MAGPARRT,$P(MAGTMP,"^",7),MAGIEN,.DA)
"RTN","MAGSDEL2",34,0)
 I 'DA I '$P(^MAG(2005,MAGIEN,0),"^",10) D  G ERROR
"RTN","MAGSDEL2",35,0)
 . S DELMSG="Image entry invalid field: PARENT DATA FILE IMAGE POINTER"
"RTN","MAGSDEL2",36,0)
 I 'DA I $P(^MAG(2005,MAGIEN,0),"^",10) G EXIT
"RTN","MAGSDEL2",37,0)
 ;G:'DA ERROR
"RTN","MAGSDEL2",38,0)
 D FILE^DID(MAGPARRT,"","GLOBAL NAME","MAGRT")
"RTN","MAGSDEL2",39,0)
 S MAGROOT=$G(MAGRT("GLOBAL NAME")) Q:MAGROOT=""
"RTN","MAGSDEL2",40,0)
 I MAGTYP<3 S DA(1)=$P(MAGTMP,"^",7),DIK=MAGROOT_DA(1)_",2005," K DA(2) G CHECK
"RTN","MAGSDEL2",41,0)
 S DA(2)=$P(MAGTMP,"^",7),DA(1)=$P(MAGTMP,"^",10)
"RTN","MAGSDEL2",42,0)
 S DIK=MAGROOT_DA(2)_","""_$E($P(MAGPAR,"^",2),1,2)_""","_DA(1)_","_2005_","
"RTN","MAGSDEL2",43,0)
CHECK I DIK'["^" S DELMSG="Can't resolve 'DIK' Global Node. " G ERROR
"RTN","MAGSDEL2",44,0)
 ;I $D(MAGVERB) W !,"Ready to delete ",DIK,DA R !,"ok? ",ANS:DTIME Q:ANS="N"
"RTN","MAGSDEL2",45,0)
 ;if medicine, call medicine api
"RTN","MAGSDEL2",46,0)
 I MAGPARRT>690,MAGPARRT<705 G DELMED
"RTN","MAGSDEL2",47,0)
 ;if TIU goto call TIU api
"RTN","MAGSDEL2",48,0)
 I MAGPARRT=8925 G DELTIU
"RTN","MAGSDEL2",49,0)
 ;if lab, call lab api
"RTN","MAGSDEL2",50,0)
 I MAGPARRT["63" G DELLAB
"RTN","MAGSDEL2",51,0)
 I MAGPARRT["2006.5839" G DELHCP
"RTN","MAGSDEL2",52,0)
 D ^DIK
"RTN","MAGSDEL2",53,0)
 I $D(MAGVERB) W !,"Parent pointer deleted from ",$P(MAGPAR,"^",1),"..."
"RTN","MAGSDEL2",54,0)
EXIT K DA,DA(1),DIK,DA(2) Q
"RTN","MAGSDEL2",55,0)
DELMED ;
"RTN","MAGSDEL2",56,0)
 D KILL^MCUIMAG0(MAGPARRT,DA(1),DA,.MAGSTAT)
"RTN","MAGSDEL2",57,0)
 I +MAGSTAT=1 G EXIT
"RTN","MAGSDEL2",58,0)
 E  S DELMSG="Error calling Medicine Routine to Delete Pointer." G ERROR
"RTN","MAGSDEL2",59,0)
 Q
"RTN","MAGSDEL2",60,0)
DELTIU ;  Delete the TIU pointers
"RTN","MAGSDEL2",61,0)
 Q:$P(^MAG(2005,MAGIEN,0),"^",10)
"RTN","MAGSDEL2",62,0)
 ; Quit if image is a child of a group.
"RTN","MAGSDEL2",63,0)
 D DELIMAGE^TIUSRVPL(.MAGY,DA(1),MAGIEN)
"RTN","MAGSDEL2",64,0)
 I 'MAGY S DELMSG="Error calling TIU API : "_$P(MAGY,"^",2) G ERROR
"RTN","MAGSDEL2",65,0)
 G EXIT
"RTN","MAGSDEL2",66,0)
DELLAB ; delete lab pointer entries
"RTN","MAGSDEL2",67,0)
 D EN^MAGSDEL3(MAGIEN,.MAGRES)
"RTN","MAGSDEL2",68,0)
 I '+MAGRES S DELMSG="Error calling Lab Routine to Delete Pointer." G ERROR
"RTN","MAGSDEL2",69,0)
 Q
"RTN","MAGSDEL2",70,0)
DELHCP ;Delete the DICOM GMRC TEMP file entry pointers
"RTN","MAGSDEL2",71,0)
 D DCMTEMP^MAGSDHCP(.MAGY,MAGIEN)
"RTN","MAGSDEL2",72,0)
 I '+MAGY S DELMSG=$G(MAGY(0)) G ERROR
"RTN","MAGSDEL2",73,0)
 G EXIT
"RTN","MAGSDEL2",74,0)
ERROR I $D(MAGVERB) W !,"The backwards pointers are not correct.  Image pointers cannot be removed from parent file."
"RTN","MAGSDEL2",75,0)
 S MAGERR=1 G EXIT
"RTN","MAGSDHCP")
0^18^B6123270
"RTN","MAGSDHCP",1,0)
MAGSDHCP ;WOIFO/LB - Routine to delete entries in file 2006.5839 ; 10/08/2003  09:54
"RTN","MAGSDHCP",2,0)
 ;;3.0;IMAGING;**10**;Nov 06, 2003
"RTN","MAGSDHCP",3,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGSDHCP",4,0)
 ;; | Property of the US Government.                                |
"RTN","MAGSDHCP",5,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGSDHCP",6,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGSDHCP",7,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGSDHCP",8,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGSDHCP",9,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGSDHCP",10,0)
 ;; |                                                               |
"RTN","MAGSDHCP",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGSDHCP",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGSDHCP",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGSDHCP",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGSDHCP",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGSDHCP",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGSDHCP",17,0)
 ;;
"RTN","MAGSDHCP",18,0)
 Q
"RTN","MAGSDHCP",19,0)
 ;
"RTN","MAGSDHCP",20,0)
DCMTEMP(RESULT,IMAGE) ;
"RTN","MAGSDHCP",21,0)
 N DA,DIK,IEN,FILE,ENTRY,IMG
"RTN","MAGSDHCP",22,0)
 S RESULT="0^Failure could not delete entry from file."
"RTN","MAGSDHCP",23,0)
 Q:'IMAGE
"RTN","MAGSDHCP",24,0)
 Q:'$D(^MAG(2005,IMAGE,0))
"RTN","MAGSDHCP",25,0)
 I $P(^MAG(2005,IMAGE,0),"^",10) D  Q
"RTN","MAGSDHCP",26,0)
 . S RESULT="1^Parent pointer does not need to be resolved."
"RTN","MAGSDHCP",27,0)
 . ; This should allow code to continue deleting image entry.
"RTN","MAGSDHCP",28,0)
 . Q
"RTN","MAGSDHCP",29,0)
 ; Can only delete if the image is a group entry.
"RTN","MAGSDHCP",30,0)
 ; Find the DA entry. 
"RTN","MAGSDHCP",31,0)
 S DA=0
"RTN","MAGSDHCP",32,0)
 S FILE=$P(^MAG(2005,IMAGE,2),"^",6) Q:FILE'=2006.5839
"RTN","MAGSDHCP",33,0)
 S ENTRY=$P(^MAG(2005,IMAGE,2),"^",7) Q:'ENTRY
"RTN","MAGSDHCP",34,0)
 I $D(^MAG(2006.5839,"C",123,ENTRY)) D
"RTN","MAGSDHCP",35,0)
 . S IEN=$O(^MAG(2006.5839,"C",123,ENTRY,0)) Q:'IEN
"RTN","MAGSDHCP",36,0)
 . Q:'$D(^MAG(2006.5839,IEN,0))
"RTN","MAGSDHCP",37,0)
 . S IMG=$P(^MAG(2006.5839,IEN,0),"^",3)
"RTN","MAGSDHCP",38,0)
 . I IMAGE'=IMG S DA=0
"RTN","MAGSDHCP",39,0)
 . S DA=IEN
"RTN","MAGSDHCP",40,0)
 . Q
"RTN","MAGSDHCP",41,0)
 I 'DA S RESULT="0^Entry in file 2006.5839 does not exist" Q
"RTN","MAGSDHCP",42,0)
 S IEN=DA
"RTN","MAGSDHCP",43,0)
 S DIK="^MAG(2006.5839," D ^DIK
"RTN","MAGSDHCP",44,0)
 I '$D(^MAG(2006.5839,IEN,0)) D
"RTN","MAGSDHCP",45,0)
 . S RESULT="1^Success in deleting entry in file 2006.5839."
"RTN","MAGSDHCP",46,0)
 . Q
"RTN","MAGSDHCP",47,0)
 Q
"SEC","^DD",2006.582,2006.582,5,8)
@
"SEC","^DD",2006.582,2006.582,6,8)
@
"SEC","^DD",2006.582,2006.582,8,8)
@
"SEC","^DIC",2005.03,2005.03,0,"AUDIT")

"SEC","^DIC",2005.03,2005.03,0,"DD")
@
"SEC","^DIC",2005.03,2005.03,0,"DEL")
@
"SEC","^DIC",2005.03,2005.03,0,"LAYGO")
@
"SEC","^DIC",2005.03,2005.03,0,"RD")
@
"SEC","^DIC",2005.03,2005.03,0,"WR")
@
"SEC","^DIC",2006.55,2006.55,0,"AUDIT")
@
"SEC","^DIC",2006.55,2006.55,0,"DD")
@
"SEC","^DIC",2006.55,2006.55,0,"DEL")
@
"SEC","^DIC",2006.55,2006.55,0,"LAYGO")
@
"SEC","^DIC",2006.55,2006.55,0,"RD")
@
"SEC","^DIC",2006.55,2006.55,0,"WR")
@
"SEC","^DIC",2006.56,2006.56,0,"AUDIT")
@
"SEC","^DIC",2006.56,2006.56,0,"DD")
@
"SEC","^DIC",2006.56,2006.56,0,"DEL")
@
"SEC","^DIC",2006.56,2006.56,0,"LAYGO")
@
"SEC","^DIC",2006.56,2006.56,0,"RD")
@
"SEC","^DIC",2006.56,2006.56,0,"WR")
@
"SEC","^DIC",2006.574,2006.574,0,"AUDIT")
@
"SEC","^DIC",2006.574,2006.574,0,"DD")
@
"SEC","^DIC",2006.574,2006.574,0,"DEL")
@
"SEC","^DIC",2006.574,2006.574,0,"LAYGO")
@
"SEC","^DIC",2006.574,2006.574,0,"RD")
@
"SEC","^DIC",2006.574,2006.574,0,"WR")
@
"SEC","^DIC",2006.582,2006.582,0,"AUDIT")
@
"SEC","^DIC",2006.582,2006.582,0,"DD")
@
"SEC","^DIC",2006.582,2006.582,0,"DEL")
@
"SEC","^DIC",2006.582,2006.582,0,"LAYGO")
@
"SEC","^DIC",2006.582,2006.582,0,"RD")
@
"SEC","^DIC",2006.582,2006.582,0,"WR")
@
"SEC","^DIC",2006.5831,2006.5831,0,"AUDIT")
@
"SEC","^DIC",2006.5831,2006.5831,0,"DD")
@
"SEC","^DIC",2006.5831,2006.5831,0,"DEL")
@
"SEC","^DIC",2006.5831,2006.5831,0,"LAYGO")
@
"SEC","^DIC",2006.5831,2006.5831,0,"RD")
@
"SEC","^DIC",2006.5831,2006.5831,0,"WR")
@
"SEC","^DIC",2006.5839,2006.5839,0,"AUDIT")
@
"SEC","^DIC",2006.5839,2006.5839,0,"DD")
@
"SEC","^DIC",2006.5839,2006.5839,0,"DEL")
@
"SEC","^DIC",2006.5839,2006.5839,0,"LAYGO")
@
"SEC","^DIC",2006.5839,2006.5839,0,"RD")
@
"SEC","^DIC",2006.5839,2006.5839,0,"WR")
@
"VER")
8.0^22.0
"^DD",2005.03,2005.03,0)
FIELD^^45^11
"^DD",2005.03,2005.03,0,"DDA")
N
"^DD",2005.03,2005.03,0,"DT")
3030814
"^DD",2005.03,2005.03,0,"IX","B",2005.03,.01)

"^DD",2005.03,2005.03,0,"NM","PARENT DATA FILE")

"^DD",2005.03,2005.03,0,"PT",2005,16)

"^DD",2005.03,2005.03,0,"PT",2005.1,16)

"^DD",2005.03,2005.03,0,"VRPK")
MAG
"^DD",2005.03,2005.03,.001,0)
FILE/SUBFILE NUMBER^NJ14,5^^ ^K:+X'=X!(X>99999999)!(X<1)!(X?.E1"."6N.N) X
"^DD",2005.03,2005.03,.001,3)
Type a Number between 1 and 99999999, 5 Decimal Digits
"^DD",2005.03,2005.03,.001,21,0)
^^5^5^2970721^
"^DD",2005.03,2005.03,.001,21,1,0)
This is the actual number of a file or sub-file of a file. Some examples of
"^DD",2005.03,2005.03,.001,21,2,0)
the .001 field are: For Radiology Reports file it is 74, for the Message
"^DD",2005.03,2005.03,.001,21,3,0)
file (MailMan) it is 3.9, for Endoscopy (Medicine) 655, for Surgery 130,
"^DD",2005.03,2005.03,.001,21,4,0)
and for Surgical Pathology it is 63.08 (the sub-file number of Lab Data
"^DD",2005.03,2005.03,.001,21,5,0)
file, 63).
"^DD",2005.03,2005.03,.001,"DT")
2930705
"^DD",2005.03,2005.03,.01,0)
FILE/SUBFILE NAME^RF^^0;1^K:$L(X)>40!($L(X)<3)!'(X?1.E) X
"^DD",2005.03,2005.03,.01,1,0)
^.1
"^DD",2005.03,2005.03,.01,1,1,0)
2005.03^B
"^DD",2005.03,2005.03,.01,1,1,1)
S ^MAG(2005.03,"B",$E(X,1,30),DA)=""
"^DD",2005.03,2005.03,.01,1,1,2)
K ^MAG(2005.03,"B",$E(X,1,30),DA)
"^DD",2005.03,2005.03,.01,3)
Answer must be 3-40 characters in length.
"^DD",2005.03,2005.03,.01,21,0)
^.001^2^2^3001006^^
"^DD",2005.03,2005.03,.01,21,1,0)
This is the actual name of the file or sub-file of a file. Some examples
"^DD",2005.03,2005.03,.01,21,2,0)
would be Message, Surgery, Surgical Pathology.
"^DD",2005.03,2005.03,.01,"DT")
2930909
"^DD",2005.03,2005.03,.02,0)
ABBREVIATION^F^^0;2^K:$L(X)>8!($L(X)<2) X
"^DD",2005.03,2005.03,.02,3)
Answer must be 2-8 characters in length.
"^DD",2005.03,2005.03,.02,21,0)
^.001^2^2^3001006^^^^
"^DD",2005.03,2005.03,.02,21,1,0)
This is the commonly used abbreviation for the file or sub-file.
"^DD",2005.03,2005.03,.02,21,2,0)
Some examples would be SUR, MAIL, ENDO, SP etc.
"^DD",2005.03,2005.03,.02,"DT")
2930712
"^DD",2005.03,2005.03,.03,0)
GLOBAL ROOT TYPE^S^1:ROOT1;2:ROOT2;3:ROOT3;^0;3^Q
"^DD",2005.03,2005.03,.03,3)
Enter the global root type of the file or sub-file.
"^DD",2005.03,2005.03,.03,21,0)
^.001^9^9^3001006^^^^
"^DD",2005.03,2005.03,.03,21,1,0)
This is used in the editing and deletion of image pointers in other files.
"^DD",2005.03,2005.03,.03,21,2,0)
Since the Image file (2005) is pointed to by a variety of files a system
"^DD",2005.03,2005.03,.03,21,3,0)
had to be created to enable backward navigation. The global root data
"^DD",2005.03,2005.03,.03,21,4,0)
types or forms have been put into three groups:
"^DD",2005.03,2005.03,.03,21,5,0)
 
"^DD",2005.03,2005.03,.03,21,6,0)
 ROOT1 -   like "^RARPT("; "^SRO("; "^LR(";
"^DD",2005.03,2005.03,.03,21,7,0)
 ROOT2 -   like "^XMB(3.9,"; "^MCAR(699,"
"^DD",2005.03,2005.03,.03,21,8,0)
 ROOT3 -   like "^LR(D0,""SP"","                  SUB-FILE of ^LR(
"^DD",2005.03,2005.03,.03,21,9,0)
                   (where D0 = LRDFN)
"^DD",2005.03,2005.03,.03,"DT")
2940419
"^DD",2005.03,2005.03,.04,0)
FILE POINTER^P1'^DIC(^0;4^Q
"^DD",2005.03,2005.03,.04,3)
POINTS TO ^DIC if regular file.
"^DD",2005.03,2005.03,.04,21,0)
^^6^6^2970721^^
"^DD",2005.03,2005.03,.04,21,1,0)
This is the parent file pointing to ^DIC( - in most cases it will also
"^DD",2005.03,2005.03,.04,21,2,0)
be the .001 field since it will be a parent file itself. But in the
"^DD",2005.03,2005.03,.04,21,3,0)
case of sub-files, like the laboratory sub-files, it will not be the .001
"^DD",2005.03,2005.03,.04,21,4,0)
field, but the number of the parent file. For example the Radiology entry
"^DD",2005.03,2005.03,.04,21,5,0)
has 74 for the .001 field and 74 for this field. However the Surgical
"^DD",2005.03,2005.03,.04,21,6,0)
Pathology entry has 68.03 for the .001 field, and 63 for the .04 field.
"^DD",2005.03,2005.03,.04,"DT")
2930909
"^DD",2005.03,2005.03,40,0)
PACKAGE INDEX^S^RAD:RAD;LAB:LAB;MED:MED;NOTE:NOTE;CP:CP;SUR:SUR;CONS:CONS;PHOTOID:PHOTOID;NONE:NONE;^2;1^Q
"^DD",2005.03,2005.03,40,3)
The Package associated with the image.
"^DD",2005.03,2005.03,40,21,0)
^.001^2^2^3020819^^
"^DD",2005.03,2005.03,40,21,1,0)
This is the abbreviation of the application (package) that the image is
"^DD",2005.03,2005.03,40,21,2,0)
attached to. 
"^DD",2005.03,2005.03,40,"DT")
3030203
"^DD",2005.03,2005.03,41,0)
CLASS INDEX^P2005.82'^MAG(2005.82,^2;2^Q
"^DD",2005.03,2005.03,41,21,0)
^^2^2^3020819^
"^DD",2005.03,2005.03,41,21,1,0)
The classification of the image.  CLASS is an index field used for
"^DD",2005.03,2005.03,41,21,2,0)
sorting and searching.
"^DD",2005.03,2005.03,41,"DT")
3030203
"^DD",2005.03,2005.03,42,0)
TYPE INDEX^P2005.83'^MAG(2005.83,^2;3^Q
"^DD",2005.03,2005.03,42,21,0)
^^1^1^3020819^
"^DD",2005.03,2005.03,42,21,1,0)
The TYPE of image. TYPE is an index field used for sorting and searching.
"^DD",2005.03,2005.03,42,"DT")
3030203
"^DD",2005.03,2005.03,43,0)
PROC/EVENT INDEX^P2005.85'^MAG(2005.85,^2;4^Q
"^DD",2005.03,2005.03,43,21,0)
^^2^2^3020819^
"^DD",2005.03,2005.03,43,21,1,0)
The PROCEDURE/EVENT for the image.  PROCEDURE/EVENT is an index field
"^DD",2005.03,2005.03,43,21,2,0)
used for sorting and searching.
"^DD",2005.03,2005.03,43,"DT")
3030203
"^DD",2005.03,2005.03,44,0)
SPEC/SUBSPEC INDEX^P2005.84'^MAG(2005.84,^2;5^Q
"^DD",2005.03,2005.03,44,21,0)
^^2^2^3020819^
"^DD",2005.03,2005.03,44,21,1,0)
The SPECIALTY/SUBSPECIALTY of the image.  SPECIALTY/SUBSPECIALTY is an
"^DD",2005.03,2005.03,44,21,2,0)
index field used for sorting and searching.
"^DD",2005.03,2005.03,44,"DT")
3030203
"^DD",2005.03,2005.03,45,0)
ORIGIN INDEX^S^V:VA;N:NON-VA;^2;6^Q
"^DD",2005.03,2005.03,45,21,0)
^^2^2^3030814^
"^DD",2005.03,2005.03,45,21,1,0)
This field indicates whether an image or document originated inside or 
"^DD",2005.03,2005.03,45,21,2,0)
outside of VA.
"^DD",2005.03,2005.03,45,"DT")
3030814
"^DD",2006.55,2006.55,0)
FIELD^^2^2
"^DD",2006.55,2006.55,0,"DDA")
N
"^DD",2006.55,2006.55,0,"DT")
3020605
"^DD",2006.55,2006.55,0,"IX","C",2006.552,2)

"^DD",2006.55,2006.55,0,"IX","D",2006.552,3)

"^DD",2006.55,2006.55,0,"IX","E",2006.552,7)

"^DD",2006.55,2006.55,0,"NM","DICOM WORKLIST PATIENT")

"^DD",2006.55,2006.55,0,"VRPK")
MAG
"^DD",2006.55,2006.55,.01,0)
DIVISION^RP4'XI^DIC(4,^0;1^S DINUM=X
"^DD",2006.55,2006.55,.01,1,0)
^.1^^0
"^DD",2006.55,2006.55,.01,3)
Enter the name of the division.
"^DD",2006.55,2006.55,.01,21,0)
^^3^3^2990202^^^
"^DD",2006.55,2006.55,.01,21,1,0)
The value of this field is a pointer into the INSTITUTION file (#4).
"^DD",2006.55,2006.55,.01,21,2,0)
The pointed to location is the division where a study for a patient
"^DD",2006.55,2006.55,.01,21,3,0)
is scheduled to be performed.
"^DD",2006.55,2006.55,.01,"DT")
2990203
"^DD",2006.55,2006.55,2,0)
PATIENT^2006.552PA^^1;0
"^DD",2006.55,2006.552,0)
PATIENT SUB-FIELD^^12^13
"^DD",2006.55,2006.552,0,"DT")
3020605
"^DD",2006.55,2006.552,0,"IX","B",2006.552,.01)

"^DD",2006.55,2006.552,0,"IX","C",2006.552,2)

"^DD",2006.55,2006.552,0,"IX","D",2006.552,3)

"^DD",2006.55,2006.552,0,"IX","E",2006.552,7)

"^DD",2006.55,2006.552,0,"NM","PATIENT")

"^DD",2006.55,2006.552,0,"UP")
2006.55
"^DD",2006.55,2006.552,.001,0)
PATIENT-NUMBER^P2'^DPT(^ ^Q
"^DD",2006.55,2006.552,.001,3)
Enter the name of the patient.
"^DD",2006.55,2006.552,.001,21,0)
^^2^2^3000218^^
"^DD",2006.55,2006.552,.001,21,1,0)
The value of this field is the internal entry number of the patient
"^DD",2006.55,2006.552,.001,21,2,0)
for whom the study is scheduled in the VistA Database.
"^DD",2006.55,2006.552,.001,"DT")
3000218
"^DD",2006.55,2006.552,.01,0)
SITE^RP4'^DIC(4,^0;1^Q
"^DD",2006.55,2006.552,.01,1,0)
^.1^^0
"^DD",2006.55,2006.552,.01,1,1,0)
2006.552^B
"^DD",2006.55,2006.552,.01,1,1,1)
S ^MAGDWLST(2006.55,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",2006.55,2006.552,.01,1,1,2)
K ^MAGDWLST(2006.55,DA(1),1,"B",$E(X,1,30),DA)
"^DD",2006.55,2006.552,.01,3)
Enter the name of the site where this study is to be performed.
"^DD",2006.55,2006.552,.01,21,0)
^^3^3^2990202^^^
"^DD",2006.55,2006.552,.01,21,1,0)
The value of this field is a pointer into the INSTITUTION file (#4).
"^DD",2006.55,2006.552,.01,21,2,0)
The pointed to location is the division where a study for a patient
"^DD",2006.55,2006.552,.01,21,3,0)
is scheduled to be performed.
"^DD",2006.55,2006.552,.01,"DT")
3000218
"^DD",2006.55,2006.552,2,0)
PATIENT NAME^RF^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",2006.55,2006.552,2,1,0)
^.1
"^DD",2006.55,2006.552,2,1,1,0)
2006.552^C
"^DD",2006.55,2006.552,2,1,1,1)
S ^MAGDWLST(2006.55,DA(1),1,"C",$E(X,1,30),DA)=""
"^DD",2006.55,2006.552,2,1,1,2)
K ^MAGDWLST(2006.55,DA(1),1,"C",$E(X,1,30),DA)
"^DD",2006.55,2006.552,2,1,1,"%D",0)
^^2^2^3001204^
"^DD",2006.55,2006.552,2,1,1,"%D",1,0)
This cross reference keeps track of which patients (name) are
"^DD",2006.55,2006.552,2,1,1,"%D",2,0)
seen at which location.
"^DD",2006.55,2006.552,2,1,1,"DT")
3001204
"^DD",2006.55,2006.552,2,3)
Enter the name of the patient.
"^DD",2006.55,2006.552,2,21,0)
^^7^7^3000218^^
"^DD",2006.55,2006.552,2,21,1,0)
The value of this field is the name of the patient
"^DD",2006.55,2006.552,2,21,2,0)
for whom the study is scheduled.
"^DD",2006.55,2006.552,2,21,3,0)
 
"^DD",2006.55,2006.552,2,21,4,0)
This value if copied from the VistA Database, so that
"^DD",2006.55,2006.552,2,21,5,0)
worklist queries can also be performed when the network
"^DD",2006.55,2006.552,2,21,6,0)
connection (DDP) with the main Hospital Information System
"^DD",2006.55,2006.552,2,21,7,0)
is not available.
"^DD",2006.55,2006.552,2,"DT")
3001204
"^DD",2006.55,2006.552,3,0)
PID^RF^^0;3^K:$L(X)>20!($L(X)<1) X
"^DD",2006.55,2006.552,3,1,0)
^.1
"^DD",2006.55,2006.552,3,1,1,0)
2006.552^D
"^DD",2006.55,2006.552,3,1,1,1)
S ^MAGDWLST(2006.55,DA(1),1,"D",$E(X,1,30),DA)=""
"^DD",2006.55,2006.552,3,1,1,2)
K ^MAGDWLST(2006.55,DA(1),1,"D",$E(X,1,30),DA)
"^DD",2006.55,2006.552,3,1,1,"%D",0)
^^2^2^3001204^
"^DD",2006.55,2006.552,3,1,1,"%D",1,0)
This cross reference keeps track of which patients (ID) are
"^DD",2006.55,2006.552,3,1,1,"%D",2,0)
seen at which location.
"^DD",2006.55,2006.552,3,1,1,"DT")
3001204
"^DD",2006.55,2006.552,3,3)
Enter the Patient ID
"^DD",2006.55,2006.552,3,21,0)
^^11^11^3001006^^
"^DD",2006.55,2006.552,3,21,1,0)
The value of this field is the value that is transmitted
"^DD",2006.55,2006.552,3,21,2,0)
for DICOM element 0010,0020.
"^DD",2006.55,2006.552,3,21,3,0)
Typically, the value of this field is equal to
"^DD",2006.55,2006.552,3,21,4,0)
the Social Security Number of the patient
"^DD",2006.55,2006.552,3,21,5,0)
for whom the study is scheduled.
"^DD",2006.55,2006.552,3,21,6,0)
(Without the dashes between the number-groups.)
"^DD",2006.55,2006.552,3,21,7,0)
 
"^DD",2006.55,2006.552,3,21,8,0)
This value is copied from the VistA Database, so that
"^DD",2006.55,2006.552,3,21,9,0)
worklist queries can also be performed when the network
"^DD",2006.55,2006.552,3,21,10,0)
connection (DDP) with the main Hospital Information System
"^DD",2006.55,2006.552,3,21,11,0)
is not available.
"^DD",2006.55,2006.552,3,"DT")
3001204
"^DD",2006.55,2006.552,4,0)
SSN^RF^^0;4^K:$L(X)>11!($L(X)<1) X
"^DD",2006.55,2006.552,4,3)
Enter the patient's SSN
"^DD",2006.55,2006.552,4,21,0)
^^8^8^3000218^^
"^DD",2006.55,2006.552,4,21,1,0)
The value of this field is the Social Security Number of the patient
"^DD",2006.55,2006.552,4,21,2,0)
for whom the study is scheduled.
"^DD",2006.55,2006.552,4,21,3,0)
(With the dashes between the number-groups.)
"^DD",2006.55,2006.552,4,21,4,0)
 
"^DD",2006.55,2006.552,4,21,5,0)
This value if copied from the VistA Database, so that
"^DD",2006.55,2006.552,4,21,6,0)
worklist queries can also be performed when the network
"^DD",2006.55,2006.552,4,21,7,0)
connection (DDP) with the main Hospital Information System
"^DD",2006.55,2006.552,4,21,8,0)
is not available.
"^DD",2006.55,2006.552,4,"DT")
2990311
"^DD",2006.55,2006.552,5,0)
DOB^RD^^0;5^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",2006.55,2006.552,5,3)
Enter the patient's date of birth.
"^DD",2006.55,2006.552,5,21,0)
^^7^7^3000218^^
"^DD",2006.55,2006.552,5,21,1,0)
The value of this field is the date of birth of the patient
"^DD",2006.55,2006.552,5,21,2,0)
for whom the study is scheduled.
"^DD",2006.55,2006.552,5,21,3,0)
 
"^DD",2006.55,2006.552,5,21,4,0)
This value if copied from the VistA Database, so that
"^DD",2006.55,2006.552,5,21,5,0)
worklist queries can also be performed when the network
"^DD",2006.55,2006.552,5,21,6,0)
connection (DDP) with the main Hospital Information System
"^DD",2006.55,2006.552,5,21,7,0)
is not available.
"^DD",2006.55,2006.552,5,"DT")
2990311
"^DD",2006.55,2006.552,6,0)
GENDER^S^M:Male;F:Female;U:Unknown;^0;6^Q
"^DD",2006.55,2006.552,6,3)
Enter the patient's gender.
"^DD",2006.55,2006.552,6,21,0)
^^7^7^3000218^^
"^DD",2006.55,2006.552,6,21,1,0)
The value of this field is the gender of the patient
"^DD",2006.55,2006.552,6,21,2,0)
for whom the study is scheduled.
"^DD",2006.55,2006.552,6,21,3,0)
 
"^DD",2006.55,2006.552,6,21,4,0)
This value if copied from the VistA Database, so that
"^DD",2006.55,2006.552,6,21,5,0)
worklist queries can also be performed when the network
"^DD",2006.55,2006.552,6,21,6,0)
connection (DDP) with the main Hospital Information System
"^DD",2006.55,2006.552,6,21,7,0)
is not available.
"^DD",2006.55,2006.552,6,"DT")
2990311
"^DD",2006.55,2006.552,7,0)
SHORT ID^F^^0;7^K:$L(X)>30!($L(X)<1) X
"^DD",2006.55,2006.552,7,1,0)
^.1
"^DD",2006.55,2006.552,7,1,1,0)
2006.552^E
"^DD",2006.55,2006.552,7,1,1,1)
S ^MAGDWLST(2006.55,DA(1),1,"E",$E(X,1,30),DA)=""
"^DD",2006.55,2006.552,7,1,1,2)
K ^MAGDWLST(2006.55,DA(1),1,"E",$E(X,1,30),DA)
"^DD",2006.55,2006.552,7,1,1,"%D",0)
^^2^2^3001204^
"^DD",2006.55,2006.552,7,1,1,"%D",1,0)
This cross reference keeps track of which patients (short ID)
"^DD",2006.55,2006.552,7,1,1,"%D",2,0)
are seen at which location.
"^DD",2006.55,2006.552,7,1,1,"DT")
3001204
"^DD",2006.55,2006.552,7,3)
Enter any other IDs for this patient.
"^DD",2006.55,2006.552,7,21,0)
^^13^13^3001006^^
"^DD",2006.55,2006.552,7,21,1,0)
The value of this field is the value that is transmitted
"^DD",2006.55,2006.552,7,21,2,0)
for DICOM element 0010,1000.
"^DD",2006.55,2006.552,7,21,3,0)
Typically, the value of this field is equal to
"^DD",2006.55,2006.552,7,21,4,0)
the first letter of the last name of the patient, followed by
"^DD",2006.55,2006.552,7,21,5,0)
the last four digits of the Social Security Number of the patient
"^DD",2006.55,2006.552,7,21,6,0)
for whom the study is scheduled.
"^DD",2006.55,2006.552,7,21,7,0)

"^DD",2006.55,2006.552,7,21,8,0)
Sometimes, this data element is also referred to as the "Quick ID".
"^DD",2006.55,2006.552,7,21,9,0)
 
"^DD",2006.55,2006.552,7,21,10,0)
This value is copied from the VistA Database, so that
"^DD",2006.55,2006.552,7,21,11,0)
worklist queries can also be performed when the network
"^DD",2006.55,2006.552,7,21,12,0)
connection (DDP) with the main Hospital Information System
"^DD",2006.55,2006.552,7,21,13,0)
is not available.
"^DD",2006.55,2006.552,7,"DT")
3001204
"^DD",2006.55,2006.552,8,0)
RACE^F^^0;8^K:$L(X)>20!($L(X)<1) X
"^DD",2006.55,2006.552,8,3)
Enter the patient's race.
"^DD",2006.55,2006.552,8,21,0)
^^7^7^3001024^^
"^DD",2006.55,2006.552,8,21,1,0)
The value of this field is the race of the patient
"^DD",2006.55,2006.552,8,21,2,0)
for whom the study is scheduled.
"^DD",2006.55,2006.552,8,21,3,0)
 
"^DD",2006.55,2006.552,8,21,4,0)
This value if copied from the VistA Database, so that
"^DD",2006.55,2006.552,8,21,5,0)
worklist queries can also be performed when the network
"^DD",2006.55,2006.552,8,21,6,0)
connection (DDP) with the main Hospital Information System
"^DD",2006.55,2006.552,8,21,7,0)
is not available.
"^DD",2006.55,2006.552,8,"DT")
2990311
"^DD",2006.55,2006.552,9,0)
PREGNANCY STATUS^S^1:Not pregnant;2:Possibly pregnant;3:Definitely pregnant;4:Unknown;^0;9^Q
"^DD",2006.55,2006.552,9,3)
Indicate whether or not the patient is pregnant.
"^DD",2006.55,2006.552,9,21,0)
^^7^7^3001024^^
"^DD",2006.55,2006.552,9,21,1,0)
The value of this field is the pregnancy status of the patient
"^DD",2006.55,2006.552,9,21,2,0)
for whom the study is scheduled.
"^DD",2006.55,2006.552,9,21,3,0)
 
"^DD",2006.55,2006.552,9,21,4,0)
This value if copied from the VistA Database, so that
"^DD",2006.55,2006.552,9,21,5,0)
worklist queries can also be performed when the network
"^DD",2006.55,2006.552,9,21,6,0)
connection (DDP) with the main Hospital Information System
"^DD",2006.55,2006.552,9,21,7,0)
is not available.
"^DD",2006.55,2006.552,9,"DT")
3001011
"^DD",2006.55,2006.552,10,0)
CURRENT PATIENT LOCATION^F^^0;10^K:$L(X)>20!($L(X)<1) X
"^DD",2006.55,2006.552,10,3)
Indicate where the patient currently is located.
"^DD",2006.55,2006.552,10,21,0)
^^7^7^3001024^^
"^DD",2006.55,2006.552,10,21,1,0)
The value of this field is the location of the patient
"^DD",2006.55,2006.552,10,21,2,0)
for whom the study is scheduled.
"^DD",2006.55,2006.552,10,21,3,0)
 
"^DD",2006.55,2006.552,10,21,4,0)
This value if copied from the VistA Database, so that
"^DD",2006.55,2006.552,10,21,5,0)
worklist queries can also be performed when the network
"^DD",2006.55,2006.552,10,21,6,0)
connection (DDP) with the main Hospital Information System
"^DD",2006.55,2006.552,10,21,7,0)
is not available.
"^DD",2006.55,2006.552,10,"DT")
3001011
"^DD",2006.55,2006.552,11,0)
PATIENT ADDRESS^F^^0;11^K:$L(X)>30!($L(X)<1) X
"^DD",2006.55,2006.552,11,3)
Enter the Patient's address, 1-30 characters.
"^DD",2006.55,2006.552,11,21,0)
^^1^1^3020605^
"^DD",2006.55,2006.552,11,21,1,0)
This field stores the patient address.
"^DD",2006.55,2006.552,11,"DT")
3020401
"^DD",2006.55,2006.552,12,0)
INTEGRATION CONTROL NUMBER^F^^0;12^K:$L(X)>30!($L(X)<1) X
"^DD",2006.55,2006.552,12,3)
Enter the Integration Control Number for this patient.
"^DD",2006.55,2006.552,12,21,0)
^.001^8^8^3020605^^^
"^DD",2006.55,2006.552,12,21,1,0)
The value of this field is an Integration Control Number.
"^DD",2006.55,2006.552,12,21,2,0)
 
"^DD",2006.55,2006.552,12,21,3,0)
The format and possible values for this field are determined by the
"^DD",2006.55,2006.552,12,21,4,0)
software that maintains the Master Patient Index.
"^DD",2006.55,2006.552,12,21,5,0)
 
"^DD",2006.55,2006.552,12,21,6,0)
Values for this field are obtained by calling $$GETICN^MPIF001(dfn) (only
"^DD",2006.55,2006.552,12,21,7,0)
the first piece of the return value is retained (ICNVICN), not the
"^DD",2006.55,2006.552,12,21,8,0)
checksum).
"^DD",2006.55,2006.552,12,"DT")
3020605
"^DD",2006.56,2006.56,0)
FIELD^^2^2
"^DD",2006.56,2006.56,0,"DDA")
N
"^DD",2006.56,2006.56,0,"DT")
3000218
"^DD",2006.56,2006.56,0,"IX","AC",2006.562,3)

"^DD",2006.56,2006.56,0,"IX","AD",2006.562,4)

"^DD",2006.56,2006.56,0,"IX","AF",2006.562,5)

"^DD",2006.56,2006.56,0,"IX","C",2006.562,.01)

"^DD",2006.56,2006.56,0,"IX","D",2006.562,.01)

"^DD",2006.56,2006.56,0,"IX","E",2006.562,.01)

"^DD",2006.56,2006.56,0,"IX","F",2006.562,11)

"^DD",2006.56,2006.56,0,"IX","S",2006.562,2)

"^DD",2006.56,2006.56,0,"NM","DICOM WORKLIST STUDY")

"^DD",2006.56,2006.56,0,"VRPK")
MAG
"^DD",2006.56,2006.56,.01,0)
DIVISION^RP4'XI^DIC(4,^0;1^S DINUM=X
"^DD",2006.56,2006.56,.01,1,0)
^.1^^0
"^DD",2006.56,2006.56,.01,3)
Enter the name of the division.
"^DD",2006.56,2006.56,.01,21,0)
^^3^3^2990202^^^
"^DD",2006.56,2006.56,.01,21,1,0)
The value of this field is a pointer into the INSTITUTION file (#4).
"^DD",2006.56,2006.56,.01,21,2,0)
The pointed to location is the division where a study for a patient
"^DD",2006.56,2006.56,.01,21,3,0)
is scheduled to be performed.
"^DD",2006.56,2006.56,.01,"DT")
2990203
"^DD",2006.56,2006.56,2,0)
STUDY^2006.562A^^1;0
"^DD",2006.56,2006.56,2,21,0)
^.001^1^1^3030114^^^^
"^DD",2006.56,2006.56,2,21,1,0)
This subfile holds the studies for the current division.
"^DD",2006.56,2006.56,2,"DT")
2990615
"^DD",2006.56,2006.562,0)
STUDY SUB-FIELD^^23^23
"^DD",2006.56,2006.562,0,"DT")
3000218
"^DD",2006.56,2006.562,0,"IX","S",2006.562,2)

"^DD",2006.56,2006.562,0,"NM","STUDY")

"^DD",2006.56,2006.562,0,"UP")
2006.56
"^DD",2006.56,2006.562,.01,0)
SERVICE^RF^^0;1^K:$L(X)>10!($L(X)<1) X
"^DD",2006.56,2006.562,.01,1,0)
^.1^^0
"^DD",2006.56,2006.562,.01,1,1,0)
2006.56^C^MUMPS
"^DD",2006.56,2006.562,.01,1,1,1)
N ACC S ACC=$P($G(^MAGDWLST(2006.56,DA(1),1,DA,0)),"^",3) S:ACC'="" ^MAGDWLST(2006.56,"C",DA(1),X,ACC,DA)=""
"^DD",2006.56,2006.562,.01,1,1,2)
N ACC S ACC=$P($G(^MAGDWLST(2006.56,DA(1),1,DA,0)),"^",3) K:ACC'="" ^MAGDWLST(2006.56,"C",DA(1),X,ACC,DA)
"^DD",2006.56,2006.562,.01,1,1,"%D",0)
^^1^1^2990312^
"^DD",2006.56,2006.562,.01,1,1,"%D",1,0)
This cross reference keeps track of which accession numbers belong to which services.
"^DD",2006.56,2006.562,.01,1,1,"DT")
2990312
"^DD",2006.56,2006.562,.01,1,2,0)
2006.56^D^MUMPS
"^DD",2006.56,2006.562,.01,1,2,1)
N SID S SID=$P($G(^MAGDWLST(2006.56,DA(1),1,DA,0)),"^",4) S:SID'="" ^MAGDWLST(2006.56,"D",DA(1),X,SID,DA)=""
"^DD",2006.56,2006.562,.01,1,2,2)
N SID S SID=$P($G(^MAGDWLST(2006.56,DA(1),1,DA,0)),"^",4) K:SID'="" ^MAGDWLST(2006.56,"D",DA(1),X,SID,DA)
"^DD",2006.56,2006.562,.01,1,2,"%D",0)
^^1^1^2990312^
"^DD",2006.56,2006.562,.01,1,2,"%D",1,0)
This cross reference keeps track of which study-IDs belong to which services.
"^DD",2006.56,2006.562,.01,1,2,"DT")
2990312
"^DD",2006.56,2006.562,.01,1,3,0)
2006.56^E^MUMPS
"^DD",2006.56,2006.562,.01,1,3,1)
N MOD,TIM,Z S Z=$G(^MAGDWLST(2006.56,DA(1),1,DA,0)),MOD=$P(Z,"^",10),TIM=$P(X,"^",5) I MOD'="",TIM'="" S ^MAGDWLST(2006.56,"E",DA(1),X,MOD,TIM,DA)=""
"^DD",2006.56,2006.562,.01,1,3,2)
N MOD,TIM,Z S Z=$G(^MAGDWLST(2006.56,DA(1),1,DA,0)),MOD=$P(Z,"^",10),TIM=$P(X,"^",5) I MOD'="",TIM'="" K ^MAGDWLST(2006.56,"E",DA(1),X,MOD,TIM,DA)
"^DD",2006.56,2006.562,.01,1,3,"%D",0)
^^1^1^2990312^^
"^DD",2006.56,2006.562,.01,1,3,"%D",1,0)
This cross reference keeps track of which modalities perform which services, and when these services are scheduled.
"^DD",2006.56,2006.562,.01,1,3,"DT")
2990312
"^DD",2006.56,2006.562,.01,3)
Enter the name of a service
"^DD",2006.56,2006.562,.01,21,0)
^.001^2^2^3021105^^^^
"^DD",2006.56,2006.562,.01,21,1,0)
The value of this field identifies the service to be
"^DD",2006.56,2006.562,.01,21,2,0)
performed for the patient.
"^DD",2006.56,2006.562,.01,"DT")
3030114
"^DD",2006.56,2006.562,2,0)
PATIENT^P2'^DPT(^0;2^Q
"^DD",2006.56,2006.562,2,1,0)
^.1
"^DD",2006.56,2006.562,2,1,1,0)
2006.562^S
"^DD",2006.56,2006.562,2,1,1,1)
S ^MAGDWLST(2006.56,DA(1),1,"S",$E(X,1,30),DA)=""
"^DD",2006.56,2006.562,2,1,1,2)
K ^MAGDWLST(2006.56,DA(1),1,"S",$E(X,1,30),DA)
"^DD",2006.56,2006.562,2,1,1,"%D",0)
^^1^1^3001204^
"^DD",2006.56,2006.562,2,1,1,"%D",1,0)
This cross reference keeps track of which studies belong to which patients.
"^DD",2006.56,2006.562,2,1,1,"DT")
3001204
"^DD",2006.56,2006.562,2,3)
Enter the name of a patient.
"^DD",2006.56,2006.562,2,21,0)
^^3^3^2990311^
"^DD",2006.56,2006.562,2,21,1,0)
The value of this field is a pointer into the PATIENT file (#2).
"^DD",2006.56,2006.562,2,21,2,0)
The patient being pointed to is a patient for whom a study
"^DD",2006.56,2006.562,2,21,3,0)
being scheduled.
"^DD",2006.56,2006.562,2,"DT")
3001204
"^DD",2006.56,2006.562,3,0)
ACCESSION^F^^0;3^K:$L(X)>20!($L(X)<1) X
"^DD",2006.56,2006.562,3,1,0)
^.1^^0
"^DD",2006.56,2006.562,3,1,1,0)
2006.56^AC^MUMPS
"^DD",2006.56,2006.562,3,1,1,1)
N SVC S SVC=$P($G(^MAGDWLST(2006.56,DA(1),1,DA,0)),"^",1) I SVC'="" S ^MAGDWLST(2006.56,"C",DA(1),SVC,X,DA)=""
"^DD",2006.56,2006.562,3,1,1,2)
N SVC S SVC=$P($G(^MAGDWLST(2006.56,DA(1),1,DA,0)),"^",1) I SVC'="" K ^MAGDWLST(2006.56,"C",DA(1),SVC,X,DA)
"^DD",2006.56,2006.562,3,1,1,"DT")
2990312
"^DD",2006.56,2006.562,3,3)
Enter an accession number.
"^DD",2006.56,2006.562,3,21,0)
^^7^7^3000218^^
"^DD",2006.56,2006.562,3,21,1,0)
The value of this field is the (long) accession number
"^DD",2006.56,2006.562,3,21,2,0)
for the study being performed.
"^DD",2006.56,2006.562,3,21,3,0)
 
"^DD",2006.56,2006.562,3,21,4,0)
An accession number is created by encoding the date
"^DD",2006.56,2006.562,3,21,5,0)
in six digits (ddmmyy), and suffixing a dash and an
"^DD",2006.56,2006.562,3,21,6,0)
integer number (no leading zeroes) that uniquely identifies the study
"^DD",2006.56,2006.562,3,21,7,0)
for that date.
"^DD",2006.56,2006.562,3,"DT")
3030114
"^DD",2006.56,2006.562,4,0)
STUDY ID^F^^0;4^K:$L(X)>20!($L(X)<1) X
"^DD",2006.56,2006.562,4,1,0)
^.1^^0
"^DD",2006.56,2006.562,4,1,1,0)
2006.56^AD^MUMPS
"^DD",2006.56,2006.562,4,1,1,1)
N SVC S SVC=$P($G(^MAGDWLST(2006.56,DA(1),1,DA,0)),"^",1) I SVC'="" S ^MAGDWLST(2006.56,"D",DA(1),SVC,X,DA)=""
"^DD",2006.56,2006.562,4,1,1,2)
N SVC S SVC=$P($G(^MAGDWLST(2006.56,DA(1),1,DA,0)),"^",1) I SVC'="" K ^MAGDWLST(2006.56,"D",DA(1),SVC,X,DA)
"^DD",2006.56,2006.562,4,1,1,"DT")
2990312
"^DD",2006.56,2006.562,4,3)
Enter a Study ID.
"^DD",2006.56,2006.562,4,21,0)
^^6^6^3000218^^
"^DD",2006.56,2006.562,4,21,1,0)
The value of this field is the (short) accession number
"^DD",2006.56,2006.562,4,21,2,0)
for the study being performed.
"^DD",2006.56,2006.562,4,21,3,0)
 
"^DD",2006.56,2006.562,4,21,4,0)
A short accession number is an
"^DD",2006.56,2006.562,4,21,5,0)
integer number (no leading zeroes) that uniquely identifies
"^DD",2006.56,2006.562,4,21,6,0)
a study during the day on which it occurs.
"^DD",2006.56,2006.562,4,"DT")
3030114
"^DD",2006.56,2006.562,5,0)
TIMESTAMP^D^^0;5^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",2006.56,2006.562,5,1,0)
^.1^^0
"^DD",2006.56,2006.562,5,1,1,0)
2006.56^AF^MUMPS
"^DD",2006.56,2006.562,5,1,1,1)
N MOD,SVC,Z S Z=$G(^MAGDWLST(2006.56,DA(1),1,DA,0)),SVC=$P(Z,"^",1),MOD=$P(Z,"^",10) I SVC'="",MOD'="" S ^MAGDWLST(2006.56,"E",DA(1),SVC,MOD,X,DA)=""
"^DD",2006.56,2006.562,5,1,1,2)
N MOD,SVC,Z S Z=$G(^MAGDWLST(2006.56,DA(1),1,DA,0)),SVC=$P(Z,"^",1),MOD=$P(Z,"^",10) I SVC'="",MOD'="" K ^MAGDWLST(2006.56,"E",DA(1),SVC,MOD,X,DA)
"^DD",2006.56,2006.562,5,1,1,"DT")
2990312
"^DD",2006.56,2006.562,5,3)
Enter the date and time of the study.
"^DD",2006.56,2006.562,5,21,0)
^^3^3^3000218^^
"^DD",2006.56,2006.562,5,21,1,0)
The value of this field indicates the date and time
"^DD",2006.56,2006.562,5,21,2,0)
for which the procedure that is described in this
"^DD",2006.56,2006.562,5,21,3,0)
entry has been scheduled.
"^DD",2006.56,2006.562,5,"DT")
3030114
"^DD",2006.56,2006.562,6,0)
PROCEDURE^F^^0;6^K:$L(X)>10!($L(X)<1) X
"^DD",2006.56,2006.562,6,3)
Enter a code for the procedure to be performed during the study.
"^DD",2006.56,2006.562,6,21,0)
^^5^5^3000218^^
"^DD",2006.56,2006.562,6,21,1,0)
The value of this field is the internal entry number
"^DD",2006.56,2006.562,6,21,2,0)
in ^RAMIS(71,... that identifies the procedure
"^DD",2006.56,2006.562,6,21,3,0)
that is described in this entry.
"^DD",2006.56,2006.562,6,21,4,0)
 
"^DD",2006.56,2006.562,6,21,5,0)
VA-FileMan file 71 (RAD/NUC MED procedures) is stored in ^RAMIS(71,...
"^DD",2006.56,2006.562,6,"DT")
2990202
"^DD",2006.56,2006.562,7,0)
PROCEDURE DESCRIPTION^F^^4;1^K:$L(X)>30!($L(X)<1) X
"^DD",2006.56,2006.562,7,3)
Enter a description of the procedure to be performed.
"^DD",2006.56,2006.562,7,21,0)
^^6^6^3000218^^
"^DD",2006.56,2006.562,7,21,1,0)
The value of this field is the name of the procedure
"^DD",2006.56,2006.562,7,21,2,0)
that is described in this entry.
"^DD",2006.56,2006.562,7,21,3,0)
This name is copied from ^RAMIS(71,... so that
"^DD",2006.56,2006.562,7,21,4,0)
worklist queries can also be performed when the network
"^DD",2006.56,2006.562,7,21,5,0)
connection (DDP) with the main Hospital Information System
"^DD",2006.56,2006.562,7,21,6,0)
is not available.
"^DD",2006.56,2006.562,7,"DT")
2990202
"^DD",2006.56,2006.562,8,0)
CPT CODE^F^^0;8^K:$L(X)>10!($L(X)<1) X
"^DD",2006.56,2006.562,8,3)
Enter the CPT code for the procedure to be performed.
"^DD",2006.56,2006.562,8,21,0)
^^5^5^3000218^^
"^DD",2006.56,2006.562,8,21,1,0)
The value of this field is the internal entry number
"^DD",2006.56,2006.562,8,21,2,0)
in ^ICPT(... that identifies the procedure
"^DD",2006.56,2006.562,8,21,3,0)
that is described in this entry.
"^DD",2006.56,2006.562,8,21,4,0)
 
"^DD",2006.56,2006.562,8,21,5,0)
VA-FileMan file 81 (CPT codes) is stored in ^ICPT(...
"^DD",2006.56,2006.562,8,"DT")
2990202
"^DD",2006.56,2006.562,9,0)
CPT DESCRIPTION^F^^5;1^K:$L(X)>10!($L(X)<1) X
"^DD",2006.56,2006.562,9,3)
Enter the description of the CPT code for the procedure to be performed.
"^DD",2006.56,2006.562,9,21,0)
^^9^9^3000218^^
"^DD",2006.56,2006.562,9,21,1,0)
The value of this field is the name of the procedure
"^DD",2006.56,2006.562,9,21,2,0)
that is described in this entry.
"^DD",2006.56,2006.562,9,21,3,0)
 
"^DD",2006.56,2006.562,9,21,4,0)
CPT stands for Current Procedural Terminology.
"^DD",2006.56,2006.562,9,21,5,0)
 
"^DD",2006.56,2006.562,9,21,6,0)
This name is copied from ^ICPT(... so that
"^DD",2006.56,2006.562,9,21,7,0)
worklist queries can also be performed when the network
"^DD",2006.56,2006.562,9,21,8,0)
connection (DDP) with the main Hospital Information System
"^DD",2006.56,2006.562,9,21,9,0)
is not available.
"^DD",2006.56,2006.562,9,"DT")
2990312
"^DD",2006.56,2006.562,10,0)
MODALITY^F^^0;10^K:$L(X)>20!($L(X)<1) X
"^DD",2006.56,2006.562,10,1,0)
^.1^^0
"^DD",2006.56,2006.562,10,3)
Enter the name of the modality.
"^DD",2006.56,2006.562,10,21,0)
^^43^43^3000218^^
"^DD",2006.56,2006.562,10,21,1,0)
The value of this field is a list of codes, separated
"^DD",2006.56,2006.562,10,21,2,0)
by commas, that each identify a modality on which the
"^DD",2006.56,2006.562,10,21,3,0)
requested procedure can be performed.
"^DD",2006.56,2006.562,10,21,4,0)
 
"^DD",2006.56,2006.562,10,21,5,0)
Possible codes for modalities are:
"^DD",2006.56,2006.562,10,21,6,0)
   AS: Angioscopy
"^DD",2006.56,2006.562,10,21,7,0)
   BI: Biomagnetic imaging
"^DD",2006.56,2006.562,10,21,8,0)
   CD: Color flow Doppler
"^DD",2006.56,2006.562,10,21,9,0)
   CF: Cinefluorography
"^DD",2006.56,2006.562,10,21,10,0)
   CP: Culposcopy
"^DD",2006.56,2006.562,10,21,11,0)
   CR: Computed Radiography
"^DD",2006.56,2006.562,10,21,12,0)
   CS: Cystoscopy
"^DD",2006.56,2006.562,10,21,13,0)
   CT: Computed Tomography
"^DD",2006.56,2006.562,10,21,14,0)
   DD: Duplex Doppler
"^DD",2006.56,2006.562,10,21,15,0)
   DF: Digital fluoroscopy
"^DD",2006.56,2006.562,10,21,16,0)
   DG: Diaphanography
"^DD",2006.56,2006.562,10,21,17,0)
   DM: Digital microscopy
"^DD",2006.56,2006.562,10,21,18,0)
   DS: Digital Subtraction Angiography
"^DD",2006.56,2006.562,10,21,19,0)
   DX: Digital Radiography
"^DD",2006.56,2006.562,10,21,20,0)
   EC: Echocardiography
"^DD",2006.56,2006.562,10,21,21,0)
   ES: Endoscopy
"^DD",2006.56,2006.562,10,21,22,0)
   FA: Fluorescein angiography
"^DD",2006.56,2006.562,10,21,23,0)
   FS: Fundoscopy
"^DD",2006.56,2006.562,10,21,24,0)
   IO: Intra-oral Radiology
"^DD",2006.56,2006.562,10,21,25,0)
   LP: Laparoscopy
"^DD",2006.56,2006.562,10,21,26,0)
   LS: Laser surface scan
"^DD",2006.56,2006.562,10,21,27,0)
   MA: Magnetic resonance angiography
"^DD",2006.56,2006.562,10,21,28,0)
   MG: Mammography
"^DD",2006.56,2006.562,10,21,29,0)
   MR: Magnetic Resonance
"^DD",2006.56,2006.562,10,21,30,0)
   MS: Magnetic resonance spectroscopy
"^DD",2006.56,2006.562,10,21,31,0)
   NM: Nuclear Medicine
"^DD",2006.56,2006.562,10,21,32,0)
   OT: Other
"^DD",2006.56,2006.562,10,21,33,0)
   PT: Positron emission tomography (PET)
"^DD",2006.56,2006.562,10,21,34,0)
   RF: Radio Fluoroscopy
"^DD",2006.56,2006.562,10,21,35,0)
   RG: Radiographic imaging (conventional film/screen)
"^DD",2006.56,2006.562,10,21,36,0)
   ST: Single-photon emission computed tomography (SPECT)
"^DD",2006.56,2006.562,10,21,37,0)
   TG: Thermography
"^DD",2006.56,2006.562,10,21,38,0)
   US: Ultrasound
"^DD",2006.56,2006.562,10,21,39,0)
   VF: Videofluorography
"^DD",2006.56,2006.562,10,21,40,0)
   VL: Visable Light
"^DD",2006.56,2006.562,10,21,41,0)
   XA: X-Ray Angiography
"^DD",2006.56,2006.562,10,21,42,0)
 
"^DD",2006.56,2006.562,10,21,43,0)
These codes are also stored in ^RAMIS(73.1,...
"^DD",2006.56,2006.562,10,"DT")
3030114
"^DD",2006.56,2006.562,11,0)
STUDY UID^F^^1;1^K:$L(X)>99!($L(X)<1) X
"^DD",2006.56,2006.562,11,1,0)
^.1
"^DD",2006.56,2006.562,11,1,1,0)
2006.56^F^MUMPS
"^DD",2006.56,2006.562,11,1,1,1)
S ^MAGDWLST(2006.56,"F",X,DA(1),DA)=""
"^DD",2006.56,2006.562,11,1,1,2)
K ^MAGDWLST(2006.56,"F",X,DA(1),DA)
"^DD",2006.56,2006.562,11,1,1,"%D",0)
^^3^3^2990615^^
"^DD",2006.56,2006.562,11,1,1,"%D",1,0)
This cross reference keeps track of the Study UIDs.
"^DD",2006.56,2006.562,11,1,1,"%D",2,0)
Since the UIDs are unique, the division is a later subscript
"^DD",2006.56,2006.562,11,1,1,"%D",3,0)
in this cross reference than in all other cross references on this file.
"^DD",2006.56,2006.562,11,1,1,"DT")
2990615
"^DD",2006.56,2006.562,11,3)
Enter the unqique identifier for the study to be performed.
"^DD",2006.56,2006.562,11,21,0)
^^2^2^3000218^^
"^DD",2006.56,2006.562,11,21,1,0)
The value of this field is a unique identifier for
"^DD",2006.56,2006.562,11,21,2,0)
the study that is described in this entry.
"^DD",2006.56,2006.562,11,"DT")
2990615
"^DD",2006.56,2006.562,12,0)
PATIENT HISTORY^2006.5621A^^2;0
"^DD",2006.56,2006.562,13,0)
REFERRING PHYSICIAN^F^^3;1^K:$L(X)>20!($L(X)<1) X
"^DD",2006.56,2006.562,13,1,0)
^.1^^0
"^DD",2006.56,2006.562,13,3)
Enter the name of the referring phycisian.
"^DD",2006.56,2006.562,13,21,0)
^^2^2^3000218^^
"^DD",2006.56,2006.562,13,21,1,0)
The value of this field, if any, is the name of the
"^DD",2006.56,2006.562,13,21,2,0)
phycisian who ...
"^DD",2006.56,2006.562,13,"DT")
2990312
"^DD",2006.56,2006.562,14,0)
ATTENDING PHYSICIAN^F^^3;2^K:$L(X)>20!($L(X)<1) X
"^DD",2006.56,2006.562,14,3)
Enter the name of the attending phycisian.
"^DD",2006.56,2006.562,14,21,0)
^^2^2^3000218^^
"^DD",2006.56,2006.562,14,21,1,0)
The value of this field, if any, is the name of the
"^DD",2006.56,2006.562,14,21,2,0)
phycisian who ...
"^DD",2006.56,2006.562,14,"DT")
2990312
"^DD",2006.56,2006.562,15,0)
REQUESTING PHYSICIAN^F^^3;3^K:$L(X)>20!($L(X)<1) X
"^DD",2006.56,2006.562,15,3)
Enter the name of the requesting phycisian
"^DD",2006.56,2006.562,15,21,0)
^^3^3^3000218^^
"^DD",2006.56,2006.562,15,21,1,0)
The value of this field, if any, is the name of the
"^DD",2006.56,2006.562,15,21,2,0)
phycisian who requested the study that is described
"^DD",2006.56,2006.562,15,21,3,0)
in this entry.
"^DD",2006.56,2006.562,15,"DT")
2990312
"^DD",2006.56,2006.562,16,0)
REQUESTED SERVICE^F^^3;4^K:$L(X)>20!($L(X)<1) X
"^DD",2006.56,2006.562,16,3)
Enter the name of the requested service.
"^DD",2006.56,2006.562,16,21,0)
^^4^4^3000218^^
"^DD",2006.56,2006.562,16,21,1,0)
The value of this field, if any, is the name of the
"^DD",2006.56,2006.562,16,21,2,0)
service that was requested for the study that is described
"^DD",2006.56,2006.562,16,21,3,0)
in this entry.
"^DD",2006.56,2006.562,16,21,4,0)

"^DD",2006.56,2006.562,16,"DT")
2990311
"^DD",2006.56,2006.562,17,0)
TYPE CODE^F^^0;11^K:$L(X)>10!($L(X)<1) X
"^DD",2006.56,2006.562,17,3)
Enter the 'type code'.
"^DD",2006.56,2006.562,17,21,0)
^.001^19^19^3020401^^^
"^DD",2006.56,2006.562,17,21,1,0)
The value of this field is a code for the type of imaging
"^DD",2006.56,2006.562,17,21,2,0)
activity.
"^DD",2006.56,2006.562,17,21,3,0)

"^DD",2006.56,2006.562,17,21,4,0)
The value for this field is obtained from the HL7 message
"^DD",2006.56,2006.562,17,21,5,0)
that was transmitted for this event.
"^DD",2006.56,2006.562,17,21,6,0)

"^DD",2006.56,2006.562,17,21,7,0)
Typical values are codes like:
"^DD",2006.56,2006.562,17,21,8,0)
   ANI
"^DD",2006.56,2006.562,17,21,9,0)
   CT
"^DD",2006.56,2006.562,17,21,10,0)
   MAM
"^DD",2006.56,2006.562,17,21,11,0)
   MRI
"^DD",2006.56,2006.562,17,21,12,0)
   NM
"^DD",2006.56,2006.562,17,21,13,0)
   RAD
"^DD",2006.56,2006.562,17,21,14,0)
   US
"^DD",2006.56,2006.562,17,21,15,0)
   VAS
"^DD",2006.56,2006.562,17,21,16,0)

"^DD",2006.56,2006.562,17,21,17,0)
Since any value obtained from an HL7 message will be considered
"^DD",2006.56,2006.562,17,21,18,0)
valid when entering data into this file, this field is typed as
"^DD",2006.56,2006.562,17,21,19,0)
"free text", rather than as a "set of codes".
"^DD",2006.56,2006.562,17,"DT")
2990318
"^DD",2006.56,2006.562,18,0)
MODIFIER^F^^0;10^K:$L(X)>20!($L(X)<1) X
"^DD",2006.56,2006.562,18,3)
Enter a further specification for the procedure code.
"^DD",2006.56,2006.562,18,21,0)
^^4^4^3000218^
"^DD",2006.56,2006.562,18,21,1,0)
The value of this field, if present, is a 'modifier' that further
"^DD",2006.56,2006.562,18,21,2,0)
specifies the CPT (Current Procedural Terminology) code for the
"^DD",2006.56,2006.562,18,21,3,0)
procedure being performed.
"^DD",2006.56,2006.562,18,21,4,0)
Typical values for such modifiers are 'Left', 'Right', etcetera.
"^DD",2006.56,2006.562,18,"DT")
3000218
"^DD",2006.56,2006.562,19,0)
STATUS^S^CREATED:Created;SCHEDULED:Scheduled;ARRIVED:Arrived;STARTED:Started;COMPLETED:Completed;VERIFIED:Verified;^0;7^Q
"^DD",2006.56,2006.562,19,3)
Enter a code for the status of this study.
"^DD",2006.56,2006.562,19,21,0)
^^10^10^3020401^
"^DD",2006.56,2006.562,19,21,1,0)
The value of this field is a code that identifies the current
"^DD",2006.56,2006.562,19,21,2,0)
status of the study.
"^DD",2006.56,2006.562,19,21,3,0)
 
"^DD",2006.56,2006.562,19,21,4,0)
Initially, the following possible values are defined:
"^DD",2006.56,2006.562,19,21,5,0)
  CREATED      Ordered or Created, but not yet Scheduled
"^DD",2006.56,2006.562,19,21,6,0)
  SCHEDULED    Scheduled, but not yet started
"^DD",2006.56,2006.562,19,21,7,0)
  ARRIVED      Patient has arrived, but study has not yet started
"^DD",2006.56,2006.562,19,21,8,0)
  STARTED      Study has started, but not yet finished
"^DD",2006.56,2006.562,19,21,9,0)
  COMPLETED    Study has completed
"^DD",2006.56,2006.562,19,21,10,0)
  VERIFIED     Study has completed, and image quality has been verified
"^DD",2006.56,2006.562,19,"DT")
3020401
"^DD",2006.56,2006.562,20,0)
PRIORITY^S^STAT:STAT;HIGH:High;MEDIUM:Medium;ROUTINE:Routine;LOW:Low;^0;9^Q
"^DD",2006.56,2006.562,20,3)
Enter a code for the priority of this study.
"^DD",2006.56,2006.562,20,21,0)
^^2^2^3020401^
"^DD",2006.56,2006.562,20,21,1,0)
The value of this field is a code that identifies the
"^DD",2006.56,2006.562,20,21,2,0)
priority of the study.
"^DD",2006.56,2006.562,20,"DT")
3020401
"^DD",2006.56,2006.562,21,0)
TIU NOTE SIGNED^S^0:No;1:Yes;^0;12^Q
"^DD",2006.56,2006.562,21,3)
Indicate whether or not the TIU note has been signed.
"^DD",2006.56,2006.562,21,21,0)
^.001^6^6^3020422^^^^
"^DD",2006.56,2006.562,21,21,1,0)
The value for this field is a code that indicates
"^DD",2006.56,2006.562,21,21,2,0)
whether or not the TIU note with which this study is
"^DD",2006.56,2006.562,21,21,3,0)
associated has been signed.
"^DD",2006.56,2006.562,21,21,4,0)
 
"^DD",2006.56,2006.562,21,21,5,0)
A value of 0 indicates that the note has not yet been signed.
"^DD",2006.56,2006.562,21,21,6,0)
A value of 1 indicates that the note has been signed.
"^DD",2006.56,2006.562,21,"DT")
3020422
"^DD",2006.56,2006.562,22,0)
INTENDED RECIPIENT OF RESULTS^F^^3;5^K:$L(X)>30!($L(X)<1) X
"^DD",2006.56,2006.562,22,3)
Enter the name of the recipient of the results of this study.
"^DD",2006.56,2006.562,22,21,0)
^.001^6^6^3021105^^^
"^DD",2006.56,2006.562,22,21,1,0)
The value of this field is a string that contains the name of
"^DD",2006.56,2006.562,22,21,2,0)
the person who is intended to receive the results of this study.
"^DD",2006.56,2006.562,22,21,3,0)
 
"^DD",2006.56,2006.562,22,21,4,0)
(Intentionally, this field is NOT a pointer to the Person File
"^DD",2006.56,2006.562,22,21,5,0)
(#200), because that file may not be accessible when the value
"^DD",2006.56,2006.562,22,21,6,0)
for this field is being retrieved.)
"^DD",2006.56,2006.562,22,"DT")
3020401
"^DD",2006.56,2006.562,23,0)
APPOINTMENT SCHEDULE^2006.5622A^^7;0
"^DD",2006.56,2006.5621,0)
PATIENT HISTORY SUB-FIELD^^.01^1
"^DD",2006.56,2006.5621,0,"DT")
2990202
"^DD",2006.56,2006.5621,0,"NM","PATIENT HISTORY")

"^DD",2006.56,2006.5621,0,"UP")
2006.562
"^DD",2006.56,2006.5621,.01,0)
PATIENT HISTORY^F^^0;1^K:$L(X)>99!($L(X)<1) X
"^DD",2006.56,2006.5621,.01,1,0)
^.1^^0
"^DD",2006.56,2006.5621,.01,3)
Enter a line of patient history text.
"^DD",2006.56,2006.5621,.01,21,0)
^^6^6^3000218^^
"^DD",2006.56,2006.5621,.01,21,1,0)
The text in this multi-line entry describes any
"^DD",2006.56,2006.5621,.01,21,2,0)
patient history that is germane in the context
"^DD",2006.56,2006.5621,.01,21,3,0)
of the study that is described in this entry.
"^DD",2006.56,2006.5621,.01,21,4,0)
 
"^DD",2006.56,2006.5621,.01,21,5,0)
Often, this section of the patient's history is
"^DD",2006.56,2006.5621,.01,21,6,0)
referred to as the 'reason for study'.
"^DD",2006.56,2006.5621,.01,"DT")
2990202
"^DD",2006.56,2006.5622,0)
APPOINTMENT SCHEDULE SUB-FIELD^^1^2
"^DD",2006.56,2006.5622,0,"DT")
3020521
"^DD",2006.56,2006.5622,0,"IX","B",2006.5622,.01)

"^DD",2006.56,2006.5622,0,"NM","APPOINTMENT SCHEDULE")

"^DD",2006.56,2006.5622,0,"UP")
2006.562
"^DD",2006.56,2006.5622,.01,0)
CLINIC NAME^F^^0;1^K:$L(X)>60!($L(X)<3) X
"^DD",2006.56,2006.5622,.01,1,0)
^.1^^0
"^DD",2006.56,2006.5622,.01,1,1,0)
2006.5622^B
"^DD",2006.56,2006.5622,.01,1,1,1)
S ^MAGDWLST(2006.56,DA(2),1,DA(1),7,"B",$E(X,1,30),DA)=""
"^DD",2006.56,2006.5622,.01,1,1,2)
K ^MAGDWLST(2006.56,DA(2),1,DA(1),7,"B",$E(X,1,30),DA)
"^DD",2006.56,2006.5622,.01,3)
Enter the name of the clinic where the appointment will take place.
"^DD",2006.56,2006.5622,.01,21,0)
^.001^3^3^3021105^^^
"^DD",2006.56,2006.5622,.01,21,1,0)
The value of this field is a string that identifies
"^DD",2006.56,2006.5622,.01,21,2,0)
the name of the clinic where the appointment will
"^DD",2006.56,2006.5622,.01,21,3,0)
take place.
"^DD",2006.56,2006.5622,.01,"DT")
3030114
"^DD",2006.56,2006.5622,1,0)
DATE/TIME^D^^0;2^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",2006.56,2006.5622,1,21,0)
^^1^1^3020521^
"^DD",2006.56,2006.5622,1,21,1,0)
Date and time of appointment.
"^DD",2006.56,2006.5622,1,"DT")
3020521
"^DD",2006.574,2006.574,0)
FIELD^^5^5
"^DD",2006.574,2006.574,0,"DDA")
N
"^DD",2006.574,2006.574,0,"DT")
3000222
"^DD",2006.574,2006.574,0,"IX","C",2006.574,5)

"^DD",2006.574,2006.574,0,"NM","DICOM IMAGE OUTPUT")

"^DD",2006.574,2006.574,0,"VRPK")
MAG
"^DD",2006.574,2006.574,.01,0)
APPLICATION^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",2006.574,2006.574,.01,1,0)
^.1^^0
"^DD",2006.574,2006.574,.01,3)
Enter the name of the application that will receive the file(s).
"^DD",2006.574,2006.574,.01,21,0)
^^8^8^3000222^^
"^DD",2006.574,2006.574,.01,21,1,0)
The value of this field is a string that identifies
"^DD",2006.574,2006.574,.01,21,2,0)
the application that will receive the image files
"^DD",2006.574,2006.574,.01,21,3,0)
for which this entry describes the parameters.
"^DD",2006.574,2006.574,.01,21,4,0)
 
"^DD",2006.574,2006.574,.01,21,5,0)
The name that is entered here corresponds to the
"^DD",2006.574,2006.574,.01,21,6,0)
name (.01 field) in file 2006.585 (stored in ^MAGDICOM(2006.585,...)
"^DD",2006.574,2006.574,.01,21,7,0)
of the storage provider that will receive the image
"^DD",2006.574,2006.574,.01,21,8,0)
files.
"^DD",2006.574,2006.574,.01,"DT")
3000222
"^DD",2006.574,2006.574,2,0)
GROUP^P2005'^MAG(2005,^0;2^Q
"^DD",2006.574,2006.574,2,3)
Identify the group of images that is to be transported.
"^DD",2006.574,2006.574,2,21,0)
^^7^7^3000222^^
"^DD",2006.574,2006.574,2,21,1,0)
The value of this field is a pointer that identifies
"^DD",2006.574,2006.574,2,21,2,0)
the image that is the 'parent' of the group of images
"^DD",2006.574,2006.574,2,21,3,0)
for which this entry describes the transmission to
"^DD",2006.574,2006.574,2,21,4,0)
another storage provider.
"^DD",2006.574,2006.574,2,21,5,0)
 
"^DD",2006.574,2006.574,2,21,6,0)
The value of this field is a pointer to the Image File
"^DD",2006.574,2006.574,2,21,7,0)
(2005, stored in ^MAG(2005,...).
"^DD",2006.574,2006.574,2,"DT")
3000222
"^DD",2006.574,2006.574,3,0)
ACCESSION NUMBER^F^^0;3^K:$L(X)>20!($L(X)<1) X
"^DD",2006.574,2006.574,3,3)
Enter the accession number for the (group of) image(s) to be transported.
"^DD",2006.574,2006.574,3,21,0)
^^10^10^3000222^^
"^DD",2006.574,2006.574,3,21,1,0)
The value of this field is the (short) case number
"^DD",2006.574,2006.574,3,21,2,0)
for the study that is referenced in this entry.
"^DD",2006.574,2006.574,3,21,3,0)
 
"^DD",2006.574,2006.574,3,21,4,0)
A long case number consists of two groups of digits
"^DD",2006.574,2006.574,3,21,5,0)
separated by a dash. The first group is 6 digits,
"^DD",2006.574,2006.574,3,21,6,0)
and is derived from the date. The second group is
"^DD",2006.574,2006.574,3,21,7,0)
an integer number that uniquely identifies the study
"^DD",2006.574,2006.574,3,21,8,0)
for that date.
"^DD",2006.574,2006.574,3,21,9,0)
 
"^DD",2006.574,2006.574,3,21,10,0)
For this field, the whole accession number is entered.
"^DD",2006.574,2006.574,3,"DT")
3000222
"^DD",2006.574,2006.574,4,0)
IMAGE^2006.5744PA^^1;0
"^DD",2006.574,2006.574,5,0)
FROM^P4'^DIC(4,^0;4^Q
"^DD",2006.574,2006.574,5,1,0)
^.1
"^DD",2006.574,2006.574,5,1,1,0)
2006.574^C
"^DD",2006.574,2006.574,5,1,1,1)
S ^MAGDOUTP(2006.574,"C",$E(X,1,30),DA)=""
"^DD",2006.574,2006.574,5,1,1,2)
K ^MAGDOUTP(2006.574,"C",$E(X,1,30),DA)
"^DD",2006.574,2006.574,5,1,1,"%D",0)
^^3^3^3010312^
"^DD",2006.574,2006.574,5,1,1,"%D",1,0)
This cross reference keeps track of which entries in
"^DD",2006.574,2006.574,5,1,1,"%D",2,0)
this queues still have to be transmitted from
"^DD",2006.574,2006.574,5,1,1,"%D",3,0)
this institution.
"^DD",2006.574,2006.574,5,1,1,"DT")
3010312
"^DD",2006.574,2006.574,5,3)
Enter the name of the "place" from which the image originates.
"^DD",2006.574,2006.574,5,21,0)
^^3^3^3010308^
"^DD",2006.574,2006.574,5,21,1,0)
The value of this field is a pointer (to the Institution file, #4).
"^DD",2006.574,2006.574,5,21,2,0)
This pointer identifies the "place" where the image is permanently
"^DD",2006.574,2006.574,5,21,3,0)
stored.
"^DD",2006.574,2006.574,5,"DT")
3010312
"^DD",2006.574,2006.5744,0)
IMAGE SUB-FIELD^^8^8
"^DD",2006.574,2006.5744,0,"DT")
3000222
"^DD",2006.574,2006.5744,0,"NM","IMAGE")

"^DD",2006.574,2006.5744,0,"UP")
2006.574
"^DD",2006.574,2006.5744,.01,0)
IMAGE^P2005'^MAG(2005,^0;1^Q
"^DD",2006.574,2006.5744,.01,1,0)
^.1^^0
"^DD",2006.574,2006.5744,.01,3)
Identify the image(s) in this transmission.
"^DD",2006.574,2006.5744,.01,21,0)
^^6^6^3000222^^
"^DD",2006.574,2006.5744,.01,21,1,0)
The value of this field is a pointer that identifies
"^DD",2006.574,2006.5744,.01,21,2,0)
one of the images that is to be transmitted to
"^DD",2006.574,2006.5744,.01,21,3,0)
another storage provider.
"^DD",2006.574,2006.5744,.01,21,4,0)
 
"^DD",2006.574,2006.5744,.01,21,5,0)
The value of this field is a pointer to the Image File
"^DD",2006.574,2006.5744,.01,21,6,0)
(2005, stored in ^MAG(2005,...).
"^DD",2006.574,2006.5744,.01,"DT")
3000222
"^DD",2006.574,2006.5744,2,0)
SOP CLASS^F^^SOP CLASS;1^K:$L(X)>100!($L(X)<1) X
"^DD",2006.574,2006.5744,2,3)
Enter the name of the SOP Class.
"^DD",2006.574,2006.5744,2,21,0)
^^3^3^3010312^
"^DD",2006.574,2006.5744,2,21,1,0)
The value of this field is a string that identifies the
"^DD",2006.574,2006.5744,2,21,2,0)
SOP Class that is to be used for the transmission of
"^DD",2006.574,2006.5744,2,21,3,0)
this image.
"^DD",2006.574,2006.5744,2,"DT")
3010312
"^DD",2006.574,2006.5744,3,0)
TRANSFER SYNTAX^F^^TRANSFER SYNTAX;1^K:$L(X)>50!($L(X)<1) X
"^DD",2006.574,2006.5744,3,3)
Enter the name of the transfer syntax.
"^DD",2006.574,2006.5744,3,21,0)
^^4^4^3010312^
"^DD",2006.574,2006.5744,3,21,1,0)
The value of this field is a string that identifies the
"^DD",2006.574,2006.5744,3,21,2,0)
transfer syntax to be used for the transmission of this
"^DD",2006.574,2006.5744,3,21,3,0)
image. A transfer syntax specifies little or big endianism
"^DD",2006.574,2006.5744,3,21,4,0)
and whether data typing is implicit or explicit.
"^DD",2006.574,2006.5744,3,"DT")
3010312
"^DD",2006.574,2006.5744,4,0)
FILE PATH^F^^FILE PATH;1^K:$L(X)>200!($L(X)<1) X
"^DD",2006.574,2006.5744,4,3)
Enter the name of the file to be transmitted.
"^DD",2006.574,2006.5744,4,21,0)
^^3^3^3010312^
"^DD",2006.574,2006.5744,4,21,1,0)
The value of this field is a string that identifies the name
"^DD",2006.574,2006.5744,4,21,2,0)
(and directory path prefix) of the host system file that
"^DD",2006.574,2006.5744,4,21,3,0)
is to be transmitted.
"^DD",2006.574,2006.5744,4,"DT")
3010312
"^DD",2006.574,2006.5744,5,0)
OFFSET^NJ10,0^^OFFSET;1^K:+X'=X!(X>9999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.574,2006.5744,5,3)
Enter the offset in the file where the image starts.
"^DD",2006.574,2006.5744,5,21,0)
^^3^3^3010312^
"^DD",2006.574,2006.5744,5,21,1,0)
The value of this field is an integer number that identifies
"^DD",2006.574,2006.5744,5,21,2,0)
the offset (byte-position from the start of the file) where
"^DD",2006.574,2006.5744,5,21,3,0)
the actual image starts.
"^DD",2006.574,2006.5744,5,"DT")
3010312
"^DD",2006.574,2006.5744,6,0)
STATUS^S^SUCCESS:SUCCESS;FAILURE:FAILURE;^STATUS;1^Q
"^DD",2006.574,2006.5744,6,3)
Indicate whether the transmission of this file was successful.
"^DD",2006.574,2006.5744,6,21,0)
^^2^2^3010312^
"^DD",2006.574,2006.5744,6,21,1,0)
The value of this field is a code that specifies whether or not
"^DD",2006.574,2006.5744,6,21,2,0)
the transmission of a (host-system) file was successful.
"^DD",2006.574,2006.5744,6,"DT")
3010312
"^DD",2006.574,2006.5744,7,0)
ERROR ID^NJ10,0^^STATUS;2^K:+X'=X!(X>9999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.574,2006.5744,7,3)
Enter the error number.
"^DD",2006.574,2006.5744,7,21,0)
^^6^6^3010312^
"^DD",2006.574,2006.5744,7,21,1,0)
The value of this field is an integer number that represents
"^DD",2006.574,2006.5744,7,21,2,0)
a code for the error that was reported when the transmission
"^DD",2006.574,2006.5744,7,21,3,0)
of the (host system) file failed.
"^DD",2006.574,2006.5744,7,21,4,0)
 
"^DD",2006.574,2006.5744,7,21,5,0)
Possible values for such codes are specific to the operating
"^DD",2006.574,2006.5744,7,21,6,0)
system being used.
"^DD",2006.574,2006.5744,7,"DT")
3010312
"^DD",2006.574,2006.5744,8,0)
COMMENT^F^^STATUS;3^K:$L(X)>100!($L(X)<1) X
"^DD",2006.574,2006.5744,8,3)
Enter the error message.
"^DD",2006.574,2006.5744,8,21,0)
^^6^6^3010312^
"^DD",2006.574,2006.5744,8,21,1,0)
The value of this field is a string that represents the error message
"^DD",2006.574,2006.5744,8,21,2,0)
that was reported when the transmission of the (host system) file
"^DD",2006.574,2006.5744,8,21,3,0)
filed.
"^DD",2006.574,2006.5744,8,21,4,0)
 
"^DD",2006.574,2006.5744,8,21,5,0)
Possible values for such strings depend on the operating system being
"^DD",2006.574,2006.5744,8,21,6,0)
used.
"^DD",2006.574,2006.5744,8,"DT")
3010312
"^DD",2006.582,2006.582,0)
FIELD^^8^8
"^DD",2006.582,2006.582,0,"DDA")
N
"^DD",2006.582,2006.582,0,"DT")
3030610
"^DD",2006.582,2006.582,0,"NM","MODALITY TYPE DICTIONARY")

"^DD",2006.582,2006.582,0,"VRPK")
MAG
"^DD",2006.582,2006.582,.01,0)
MANUFACTURER^RF^^0;1^K:$L(X)>30!($L(X)<1)!'(X'?1P.E) X
"^DD",2006.582,2006.582,.01,1,0)
^.1^^0
"^DD",2006.582,2006.582,.01,3)
Enter the name of the manufacturer of this equipment.
"^DD",2006.582,2006.582,.01,21,0)
^^8^8^3021121^^
"^DD",2006.582,2006.582,.01,21,1,0)
Name of the company the produces this equipment.
"^DD",2006.582,2006.582,.01,21,2,0)
The value of this field is a text that identifies the
"^DD",2006.582,2006.582,.01,21,3,0)
manufacturer of the modality that is described in the
"^DD",2006.582,2006.582,.01,21,4,0)
current entry.
"^DD",2006.582,2006.582,.01,21,5,0)
 
"^DD",2006.582,2006.582,.01,21,6,0)
This name must be spelled exactly as it is presented
"^DD",2006.582,2006.582,.01,21,7,0)
in the headers of the image files that are produced
"^DD",2006.582,2006.582,.01,21,8,0)
by modalities of this type.
"^DD",2006.582,2006.582,.01,"DT")
2990830
"^DD",2006.582,2006.582,2,0)
MODEL^F^^0;2^K:$L(X)>20!($L(X)<1) X
"^DD",2006.582,2006.582,2,3)
Enter the name of the model of this equipment.
"^DD",2006.582,2006.582,2,21,0)
^^7^7^3021121^^
"^DD",2006.582,2006.582,2,21,1,0)
The value of this field is a text that identifies the
"^DD",2006.582,2006.582,2,21,2,0)
model of the modality that is described in the
"^DD",2006.582,2006.582,2,21,3,0)
current entry.
"^DD",2006.582,2006.582,2,21,4,0)
 
"^DD",2006.582,2006.582,2,21,5,0)
This name must be spelled exactly as it is presented
"^DD",2006.582,2006.582,2,21,6,0)
in the headers of the image files that are produced
"^DD",2006.582,2006.582,2,21,7,0)
by modalities of this type.
"^DD",2006.582,2006.582,2,"DT")
2990830
"^DD",2006.582,2006.582,3,0)
MODALITY^F^^0;3^K:$L(X)>20!($L(X)<1) X
"^DD",2006.582,2006.582,3,3)
Enter the code for the modality.
"^DD",2006.582,2006.582,3,21,0)
^^6^6^3021121^^
"^DD",2006.582,2006.582,3,21,1,0)
The value of this field is a code that identifies the
"^DD",2006.582,2006.582,3,21,2,0)
type of modality for the current entry.
"^DD",2006.582,2006.582,3,21,3,0)
 
"^DD",2006.582,2006.582,3,21,4,0)
The possible values for this two-letter code are
"^DD",2006.582,2006.582,3,21,5,0)
defined in the DICOM standard, and are also stored in
"^DD",2006.582,2006.582,3,21,6,0)
file 73.1, stored in ^RAMIS(73.1,...)
"^DD",2006.582,2006.582,3,"DT")
2990830
"^DD",2006.582,2006.582,4,0)
DICOM TO TARGA PARAMETERS^F^^0;4^K:$L(X)>40!($L(X)<1) X
"^DD",2006.582,2006.582,4,.1)
Dicom To Targa Parameters
"^DD",2006.582,2006.582,4,3)
Enter the parameter list for the program dcmtotga.exe.
"^DD",2006.582,2006.582,4,21,0)
^^15^15^3000302^^
"^DD",2006.582,2006.582,4,21,1,0)
The value of this field is a string that provides the
"^DD",2006.582,2006.582,4,21,2,0)
parameters that are to be specified when the program
"^DD",2006.582,2006.582,4,21,3,0)
is called that converts an image in DICOM format to
"^DD",2006.582,2006.582,4,21,4,0)
Targa(TM) format.
"^DD",2006.582,2006.582,4,21,5,0)
 
"^DD",2006.582,2006.582,4,21,6,0)
These parameters will apply to files that originate from
"^DD",2006.582,2006.582,4,21,7,0)
the type of modality that is described in the current entry.
"^DD",2006.582,2006.582,4,21,8,0)
 
"^DD",2006.582,2006.582,4,21,9,0)
When the parameters are different for the conversion
"^DD",2006.582,2006.582,4,21,10,0)
to an 'clinical resolution' image than they are
"^DD",2006.582,2006.582,4,21,11,0)
for a 'full resolution' image, the value of this field consists
"^DD",2006.582,2006.582,4,21,12,0)
of two parts, separated by a slash ("/").
"^DD",2006.582,2006.582,4,21,13,0)
In that case, the first part specifies the parameters
"^DD",2006.582,2006.582,4,21,14,0)
for clinical images, and the second part specifies the
"^DD",2006.582,2006.582,4,21,15,0)
parameters for the full images.
"^DD",2006.582,2006.582,4,"DT")
2981013
"^DD",2006.582,2006.582,5,0)
CASE LOOKUP^F^^0;5^K:$L(X)>17!($L(X)<1) X
"^DD",2006.582,2006.582,5,.1)
Accession Number Lookup
"^DD",2006.582,2006.582,5,3)
Enter the entry point for the Accession Number lookup code.
"^DD",2006.582,2006.582,5,8.5)
@
"^DD",2006.582,2006.582,5,9)
@
"^DD",2006.582,2006.582,5,21,0)
^^9^9^3000302^^
"^DD",2006.582,2006.582,5,21,1,0)
The value of this field is a string that identifies
"^DD",2006.582,2006.582,5,21,2,0)
the entry point that is called as a subroutine when
"^DD",2006.582,2006.582,5,21,3,0)
the DICOM Image Gateway needs to look up the Accession Number
"^DD",2006.582,2006.582,5,21,4,0)
number, given the information provided by the modality
"^DD",2006.582,2006.582,5,21,5,0)
that is described in this entry.
"^DD",2006.582,2006.582,5,21,6,0)
 
"^DD",2006.582,2006.582,5,21,7,0)
In the name of this entry point, the caret that separates
"^DD",2006.582,2006.582,5,21,8,0)
the name of the label from the name of the routine
"^DD",2006.582,2006.582,5,21,9,0)
is replaced by a period.
"^DD",2006.582,2006.582,5,"DT")
2981013
"^DD",2006.582,2006.582,6,0)
DATA EXTRACTION^F^^0;6^K:$L(X)>17!($L(X)<1) X
"^DD",2006.582,2006.582,6,3)
Enter the entry point for the data extraction code.
"^DD",2006.582,2006.582,6,8.5)
@
"^DD",2006.582,2006.582,6,9)
@
"^DD",2006.582,2006.582,6,21,0)
^^9^9^3000222^^
"^DD",2006.582,2006.582,6,21,1,0)
The value of this field is a string that identifies
"^DD",2006.582,2006.582,6,21,2,0)
the entry point that is called as a subroutine when
"^DD",2006.582,2006.582,6,21,3,0)
the DICOM Image Gateway needs to extract data,
"^DD",2006.582,2006.582,6,21,4,0)
given the information provided by the modality
"^DD",2006.582,2006.582,6,21,5,0)
that is described in this entry.
"^DD",2006.582,2006.582,6,21,6,0)
 
"^DD",2006.582,2006.582,6,21,7,0)
In the name of this entry point, the caret that separates
"^DD",2006.582,2006.582,6,21,8,0)
the name of the label from the name of the routine
"^DD",2006.582,2006.582,6,21,9,0)
is replaced by a period.
"^DD",2006.582,2006.582,6,"DT")
2981013
"^DD",2006.582,2006.582,7,0)
EXTRACTION FILE^F^^0;7^K:$L(X)>16!($L(X)<1) X
"^DD",2006.582,2006.582,7,3)
Enter the name of the file that describes the extraction parameters.
"^DD",2006.582,2006.582,7,21,0)
^^9^9^3000222^^
"^DD",2006.582,2006.582,7,21,1,0)
The value of this field is the name of a file that
"^DD",2006.582,2006.582,7,21,2,0)
contains a list of additional fields to be displayed
"^DD",2006.582,2006.582,7,21,3,0)
on a diagnostic workstation for images that are produced
"^DD",2006.582,2006.582,7,21,4,0)
by a modality of the type that is described in the current entry.
"^DD",2006.582,2006.582,7,21,5,0)
 
"^DD",2006.582,2006.582,7,21,6,0)
Currently, three such files exist:
"^DD",2006.582,2006.582,7,21,7,0)
   datamisc.dic
"^DD",2006.582,2006.582,7,21,8,0)
   data_cr.dic
"^DD",2006.582,2006.582,7,21,9,0)
   datagect.dic
"^DD",2006.582,2006.582,7,"DT")
2981013
"^DD",2006.582,2006.582,8,0)
IMAGING SERVICE^S^RAD:Radiology;CON:Consults;^0;8^Q
"^DD",2006.582,2006.582,8,3)
Indicate the Imaging Service (RAD or CON).
"^DD",2006.582,2006.582,8,8.5)
@
"^DD",2006.582,2006.582,8,9)
@
"^DD",2006.582,2006.582,8,21,0)
^^6^6^3030610^^
"^DD",2006.582,2006.582,8,21,1,0)
The value of this field is a code that indicates the "Imaging Service"
"^DD",2006.582,2006.582,8,21,2,0)
for this type of instrument.
"^DD",2006.582,2006.582,8,21,3,0)

"^DD",2006.582,2006.582,8,21,4,0)
Possible Imaging Services are:
"^DD",2006.582,2006.582,8,21,5,0)
   RAD:   Radiology
"^DD",2006.582,2006.582,8,21,6,0)
   CON:   Consults
"^DD",2006.582,2006.582,8,"DT")
3030610
"^DD",2006.583,2006.583,3,0)
SERVICE^F^^0;3^K:$L(X)>30!($L(X)<3) X
"^DD",2006.583,2006.583,3,3)
Enter the name of the Imaging Service.
"^DD",2006.583,2006.583,3,21,0)
^^3^3^3020919^^
"^DD",2006.583,2006.583,3,21,1,0)
The value of this field is a string that identifies
"^DD",2006.583,2006.583,3,21,2,0)
the 'Imaging Service' that is performed by the
"^DD",2006.583,2006.583,3,21,3,0)
instrument that is described in this entry.
"^DD",2006.583,2006.583,3,"DT")
2990830
"^DD",2006.5831,2006.5831,0)
FIELD^^4^4
"^DD",2006.5831,2006.5831,0,"DDA")
N
"^DD",2006.5831,2006.5831,0,"DT")
3030512
"^DD",2006.5831,2006.5831,0,"NM","DICOM HEALTHCARE PROVIDER SERVICE")

"^DD",2006.5831,2006.5831,0,"VRPK")
MAG
"^DD",2006.5831,2006.5831,.01,0)
REQUESTED SERVICE^RP123.5'X^GMR(123.5,^0;1^S DINUM=X
"^DD",2006.5831,2006.5831,.01,1,0)
^.1^^0
"^DD",2006.5831,2006.5831,.01,3)
Enter the name of the service being requested.
"^DD",2006.5831,2006.5831,.01,21,0)
^.001^8^8^3020409^^
"^DD",2006.5831,2006.5831,.01,21,1,0)
The value of this field is a pointer into the "Request Services"
"^DD",2006.5831,2006.5831,.01,21,2,0)
file (#123.5).
"^DD",2006.5831,2006.5831,.01,21,3,0)
 
"^DD",2006.5831,2006.5831,.01,21,4,0)
The purpose of this file is to link groups of types of
"^DD",2006.5831,2006.5831,.01,21,5,0)
Requests for Consults to entities that we'll call
"^DD",2006.5831,2006.5831,.01,21,6,0)
"Worklist Classes".
"^DD",2006.5831,2006.5831,.01,21,7,0)
 
"^DD",2006.5831,2006.5831,.01,21,8,0)
This file is DINUMed with file #123.5.
"^DD",2006.5831,2006.5831,.01,"DT")
3020409
"^DD",2006.5831,2006.5831,2,0)
SERVICE GROUP^RP2005.84'^MAG(2005.84,^0;2^Q
"^DD",2006.5831,2006.5831,2,3)
Enter the name of the WorkList Class.
"^DD",2006.5831,2006.5831,2,21,0)
^^10^10^3020730^^
"^DD",2006.5831,2006.5831,2,21,1,0)
The value of this field is a pointer to the SPECIALTY or SUBSPECIALTY
"^DD",2006.5831,2006.5831,2,21,2,0)
file.
"^DD",2006.5831,2006.5831,2,21,3,0)
 
"^DD",2006.5831,2006.5831,2,21,4,0)
Image Types are groups of services that are being treated
"^DD",2006.5831,2006.5831,2,21,5,0)
the same as far as DICOM WorkList requests are concerned.
"^DD",2006.5831,2006.5831,2,21,6,0)
 
"^DD",2006.5831,2006.5831,2,21,7,0)
Service Requests are described in file 123.5, and (sub)specialties
"^DD",2006.5831,2006.5831,2,21,8,0)
are described in file 2005.84.
"^DD",2006.5831,2006.5831,2,21,9,0)
 
"^DD",2006.5831,2006.5831,2,21,10,0)
The purpose of this file is to establish a link between the two.
"^DD",2006.5831,2006.5831,2,"DT")
3020730
"^DD",2006.5831,2006.5831,3,0)
SERVICE DIVISION^P4'^DIC(4,^0;3^Q
"^DD",2006.5831,2006.5831,3,3)
Identify the division where these procedures are executed.
"^DD",2006.5831,2006.5831,3,21,0)
^.001^4^4^3020827^^^^
"^DD",2006.5831,2006.5831,3,21,1,0)
The value of this field is a pointer to the
"^DD",2006.5831,2006.5831,3,21,2,0)
INSTITUTION file.
"^DD",2006.5831,2006.5831,3,21,3,0)
 
"^DD",2006.5831,2006.5831,3,21,4,0)
This value identifies the division where the request will be performed.
"^DD",2006.5831,2006.5831,3,"DT")
3020827
"^DD",2006.5831,2006.5831,4,0)
CLINIC^2006.58314PA^^1;0
"^DD",2006.5831,2006.58314,0)
CLINIC SUB-FIELD^^.01^1
"^DD",2006.5831,2006.58314,0,"DT")
3030512
"^DD",2006.5831,2006.58314,0,"IX","B",2006.58314,.01)

"^DD",2006.5831,2006.58314,0,"NM","CLINIC")

"^DD",2006.5831,2006.58314,0,"UP")
2006.5831
"^DD",2006.5831,2006.58314,.01,0)
CLINIC^MP44'^SC(^0;1^Q
"^DD",2006.5831,2006.58314,.01,1,0)
^.1
"^DD",2006.5831,2006.58314,.01,1,1,0)
2006.58314^B
"^DD",2006.5831,2006.58314,.01,1,1,1)
S ^MAG(2006.5831,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",2006.5831,2006.58314,.01,1,1,2)
K ^MAG(2006.5831,DA(1),1,"B",$E(X,1,30),DA)
"^DD",2006.5831,2006.58314,.01,3)
Identify the clinic where this service may take place.
"^DD",2006.5831,2006.58314,.01,21,0)
^^3^3^3030512^
"^DD",2006.5831,2006.58314,.01,21,1,0)
The value of this field is a pointer to file #44 (Hospital Location).
"^DD",2006.5831,2006.58314,.01,21,2,0)
This value identifies a clinic where a specific kind of service
"^DD",2006.5831,2006.58314,.01,21,3,0)
may be provided.
"^DD",2006.5831,2006.58314,.01,"DT")
3030512
"^DD",2006.5839,2006.5839,0)
FIELD^^3^3
"^DD",2006.5839,2006.5839,0,"DDA")
N
"^DD",2006.5839,2006.5839,0,"DT")
3020409
"^DD",2006.5839,2006.5839,0,"IX","B",2006.5839,.01)

"^DD",2006.5839,2006.5839,0,"NM","DICOM GMRC TEMP LIST")

"^DD",2006.5839,2006.5839,0,"VRPK")
MAG
"^DD",2006.5839,2006.5839,.01,0)
FILE NUMBER^RS^123:Consults/Requests;^0;1^Q
"^DD",2006.5839,2006.5839,.01,1,0)
^.1^^0
"^DD",2006.5839,2006.5839,.01,1,1,0)
2006.5839^B
"^DD",2006.5839,2006.5839,.01,1,1,1)
S ^MAG(2006.5839,"B",$E(X,1,30),DA)=""
"^DD",2006.5839,2006.5839,.01,1,1,2)
K ^MAG(2006.5839,"B",$E(X,1,30),DA)
"^DD",2006.5839,2006.5839,.01,1,1,"DT")
3021107
"^DD",2006.5839,2006.5839,.01,3)
Enter the number of the file to which this image will be connected temporarily.
"^DD",2006.5839,2006.5839,.01,21,0)
^^7^7^3020409^
"^DD",2006.5839,2006.5839,.01,21,1,0)
The value of this field is a pointer to a file.
"^DD",2006.5839,2006.5839,.01,21,2,0)
 
"^DD",2006.5839,2006.5839,.01,21,3,0)
Since this field may point only to a very limited number
"^DD",2006.5839,2006.5839,.01,21,4,0)
of files, the datatype for this field is a SET OF CODES,
"^DD",2006.5839,2006.5839,.01,21,5,0)
rather than a pointer to the File of Files.
"^DD",2006.5839,2006.5839,.01,21,6,0)
 
"^DD",2006.5839,2006.5839,.01,21,7,0)
Currently, the only possible value is 123 (Consults).
"^DD",2006.5839,2006.5839,.01,"DT")
3021114
"^DD",2006.5839,2006.5839,2,0)
ENTRY NUMBER^RNJ13,0^^0;2^K:+X'=X!(X>9999999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",2006.5839,2006.5839,2,3)
Enter the internal entry number in the temporary file.
"^DD",2006.5839,2006.5839,2,21,0)
^^7^7^3020409^
"^DD",2006.5839,2006.5839,2,21,1,0)
The value of this field is a pointer into a file.
"^DD",2006.5839,2006.5839,2,21,2,0)
 
"^DD",2006.5839,2006.5839,2,21,3,0)
The file number of the file into which this field points
"^DD",2006.5839,2006.5839,2,21,4,0)
is stored as the value of field FILE NUMBER.
"^DD",2006.5839,2006.5839,2,21,5,0)
 
"^DD",2006.5839,2006.5839,2,21,6,0)
Since this value is not a "variable pointer", nor a "normal pointer",
"^DD",2006.5839,2006.5839,2,21,7,0)
the data type of this field is NUMBER, not POINTER.
"^DD",2006.5839,2006.5839,2,"DT")
3021106
"^DD",2006.5839,2006.5839,3,0)
IMAGE^RP2005'^MAG(2005,^0;3^Q
"^DD",2006.5839,2006.5839,3,3)
Enter the internal entry number of the image.
"^DD",2006.5839,2006.5839,3,21,0)
^^9^9^3020409^
"^DD",2006.5839,2006.5839,3,21,1,0)
The value of this field is a pointer into the Image File (2005).
"^DD",2006.5839,2006.5839,3,21,2,0)
 
"^DD",2006.5839,2006.5839,3,21,3,0)
The image that is being pointed to is usually the group-parent
"^DD",2006.5839,2006.5839,3,21,4,0)
of the group of images that is linked to the entity in the
"^DD",2006.5839,2006.5839,3,21,5,0)
temporary file.
"^DD",2006.5839,2006.5839,3,21,6,0)
 
"^DD",2006.5839,2006.5839,3,21,7,0)
(When the image group consists of one single image,
"^DD",2006.5839,2006.5839,3,21,8,0)
that image won't have a "group parent", and this field
"^DD",2006.5839,2006.5839,3,21,9,0)
will point to the image itself.)
"^DD",2006.5839,2006.5839,3,"DT")
3021106
"^DIC",2005.03,2005.03,0)
PARENT DATA FILE^2005.03
"^DIC",2005.03,2005.03,0,"GL")
^MAG(2005.03,
"^DIC",2005.03,2005.03,"%",0)
^1.005^1^1
"^DIC",2005.03,2005.03,"%",1,0)
MAG
"^DIC",2005.03,2005.03,"%","B","MAG",1)

"^DIC",2005.03,2005.03,"%D",0)
^^40^40^3010619^
"^DIC",2005.03,2005.03,"%D",1,0)
 +---------------------------------------------------------------+
"^DIC",2005.03,2005.03,"%D",2,0)
 |                                                               |
"^DIC",2005.03,2005.03,"%D",3,0)
 | Property of the US Government.                                |
"^DIC",2005.03,2005.03,"%D",4,0)
 | No permission to copy or redistribute this software is given. |
"^DIC",2005.03,2005.03,"%D",5,0)
 | Use of unreleased versions of this software requires the user |
"^DIC",2005.03,2005.03,"%D",6,0)
 | to execute a written test agreement with the VistA Imaging    |
"^DIC",2005.03,2005.03,"%D",7,0)
 | Development Office of the Department of Veterans Affairs,     |
"^DIC",2005.03,2005.03,"%D",8,0)
 | telephone (301) 734-0100.                                     |
"^DIC",2005.03,2005.03,"%D",9,0)
 |                                                               |
"^DIC",2005.03,2005.03,"%D",10,0)
 | The Food and Drug Administration classifies this software as  |
"^DIC",2005.03,2005.03,"%D",11,0)
 | a medical device.  As such, it may not be changed in any way. |
"^DIC",2005.03,2005.03,"%D",12,0)
 | Modifications to this software may result in an adulterated   |
"^DIC",2005.03,2005.03,"%D",13,0)
 | medical device under 21CFR820, the use of which is considered |
"^DIC",2005.03,2005.03,"%D",14,0)
 | to be a violation of US Federal Statutes.                     |
"^DIC",2005.03,2005.03,"%D",15,0)
 |                                                               |
"^DIC",2005.03,2005.03,"%D",16,0)
 +---------------------------------------------------------------+
"^DIC",2005.03,2005.03,"%D",17,0)
 
"^DIC",2005.03,2005.03,"%D",18,0)
The Imaging File (2005) has many "imaging multiples" pointing to it from
"^DIC",2005.03,2005.03,"%D",19,0)
other packages such as Radiology, Medicine, Surgery, Mailman and the
"^DIC",2005.03,2005.03,"%D",20,0)
various sub-files of Laboratory such as Surgical Pathology etc.  In order
"^DIC",2005.03,2005.03,"%D",21,0)
to have a method of tracing back from the Image file to the parent file
"^DIC",2005.03,2005.03,"%D",22,0)
multiple, a file was developed to aid in this process, along with some
"^DIC",2005.03,2005.03,"%D",23,0)
additional fields in the Image file. Using these fields along with the
"^DIC",2005.03,2005.03,"%D",24,0)
PARENT DATA FILE, backward navigation is possible whether it be to a
"^DIC",2005.03,2005.03,"%D",25,0)
multiple of a file, or a multiple of a sub-file of a file. Each image that
"^DIC",2005.03,2005.03,"%D",26,0)
is captured is associated with a procedure or test report.  Depending on
"^DIC",2005.03,2005.03,"%D",27,0)
the service collecting the image, different types of reports will be
"^DIC",2005.03,2005.03,"%D",28,0)
associated.  For example:
"^DIC",2005.03,2005.03,"%D",29,0)
 
"^DIC",2005.03,2005.03,"%D",30,0)
  * Medical Procedures:  Endoscopy, Dermatology, Hematology, Rheumatology, etc.
"^DIC",2005.03,2005.03,"%D",31,0)
  * Anatomic Pathology:  Surgical Pathology, Cytology, Autopsy, Electron Microscopy
"^DIC",2005.03,2005.03,"%D",32,0)
  * Radiology:  Xray, CT, MRI, Ultrasound
"^DIC",2005.03,2005.03,"%D",33,0)
  * Surgery  Operation reports
"^DIC",2005.03,2005.03,"%D",34,0)
  * Text Integration Utility  Progress notes
"^DIC",2005.03,2005.03,"%D",35,0)
 
"^DIC",2005.03,2005.03,"%D",36,0)
 In order to be able to display information from the associated
"^DIC",2005.03,2005.03,"%D",37,0)
report, references to that report are stored in the Image file. 
"^DIC",2005.03,2005.03,"%D",38,0)
One of these references is a pointer to the Parent Report file
"^DIC",2005.03,2005.03,"%D",39,0)
(2005.03), which contains an entry for each package's report file
"^DIC",2005.03,2005.03,"%D",40,0)
that is currently supported.
"^DIC",2005.03,"B","PARENT DATA FILE",2005.03)

"^DIC",2006.55,2006.55,0)
DICOM WORKLIST PATIENT^2006.55
"^DIC",2006.55,2006.55,0,"GL")
^MAGDWLST(2006.55,
"^DIC",2006.55,2006.55,"%",0)
^1.005^^0
"^DIC",2006.55,2006.55,"%D",0)
^^36^36^3010620^
"^DIC",2006.55,2006.55,"%D",1,0)
 +---------------------------------------------------------------+
"^DIC",2006.55,2006.55,"%D",2,0)
 |                                                               |
"^DIC",2006.55,2006.55,"%D",3,0)
 | Property of the US Government.                                |
"^DIC",2006.55,2006.55,"%D",4,0)
 | No permission to copy or redistribute this software is given. |
"^DIC",2006.55,2006.55,"%D",5,0)
 | Use of unreleased versions of this software requires the user |
"^DIC",2006.55,2006.55,"%D",6,0)
 | to execute a written test agreement with the VistA Imaging    |
"^DIC",2006.55,2006.55,"%D",7,0)
 | Development Office of the Department of Veterans Affairs,     |
"^DIC",2006.55,2006.55,"%D",8,0)
 | telephone (301) 734-0100.                                     |
"^DIC",2006.55,2006.55,"%D",9,0)
 |                                                               |
"^DIC",2006.55,2006.55,"%D",10,0)
 | The Food and Drug Administration classifies this software as  |
"^DIC",2006.55,2006.55,"%D",11,0)
 | a medical device.  As such, it may not be changed in any way. |
"^DIC",2006.55,2006.55,"%D",12,0)
 | Modifications to this software may result in an adulterated   |
"^DIC",2006.55,2006.55,"%D",13,0)
 | medical device under 21CFR820, the use of which is considered |
"^DIC",2006.55,2006.55,"%D",14,0)
 | to be a violation of US Federal Statutes.                     |
"^DIC",2006.55,2006.55,"%D",15,0)
 |                                                               |
"^DIC",2006.55,2006.55,"%D",16,0)
 +---------------------------------------------------------------+
"^DIC",2006.55,2006.55,"%D",17,0)
 
"^DIC",2006.55,2006.55,"%D",18,0)
The entries in this table contain the demographic information for the various
"^DIC",2006.55,2006.55,"%D",19,0)
patients, for whom tasks are recorded on the worklist for a DICOM "modality".
"^DIC",2006.55,2006.55,"%D",20,0)
The top-level information in this table separates the patients from the
"^DIC",2006.55,2006.55,"%D",21,0)
various clinics at a consolidated site; the next level contains the patient
"^DIC",2006.55,2006.55,"%D",22,0)
information.
"^DIC",2006.55,2006.55,"%D",23,0)
 
"^DIC",2006.55,2006.55,"%D",24,0)
This file contains temporary copies of information from the VistA
"^DIC",2006.55,2006.55,"%D",25,0)
system that live on our satellite systems for the duration of the
"^DIC",2006.55,2006.55,"%D",26,0)
study that produces the images, and the only reason for
"^DIC",2006.55,2006.55,"%D",27,0)
replicating the information onto these "DICOM Gateway Stations"
"^DIC",2006.55,2006.55,"%D",28,0)
is that we want to be able to allow the acquisition of images and
"^DIC",2006.55,2006.55,"%D",29,0)
the presentation of "worklist information" to continue, even
"^DIC",2006.55,2006.55,"%D",30,0)
while the VistA system is down, or when the DDP connection
"^DIC",2006.55,2006.55,"%D",31,0)
between our Gateways and the VistA system is not operating. 
"^DIC",2006.55,2006.55,"%D",32,0)
 
"^DIC",2006.55,2006.55,"%D",33,0)
Information is copied from VistA to DICOM Gateway when an HL7
"^DIC",2006.55,2006.55,"%D",34,0)
message is processed that announces the "exam", and removed when
"^DIC",2006.55,2006.55,"%D",35,0)
an HL7 message is processed that announces that the exam is
"^DIC",2006.55,2006.55,"%D",36,0)
carried out. 
"^DIC",2006.55,"B","DICOM WORKLIST PATIENT",2006.55)

"^DIC",2006.56,2006.56,0)
DICOM WORKLIST STUDY^2006.56
"^DIC",2006.56,2006.56,0,"GL")
^MAGDWLST(2006.56,
"^DIC",2006.56,2006.56,"%",0)
^1.005^^0
"^DIC",2006.56,2006.56,"%D",0)
^^36^36^3010619^
"^DIC",2006.56,2006.56,"%D",1,0)
 +---------------------------------------------------------------+
"^DIC",2006.56,2006.56,"%D",2,0)
 |                                                               |
"^DIC",2006.56,2006.56,"%D",3,0)
 | Property of the US Government.                                |
"^DIC",2006.56,2006.56,"%D",4,0)
 | No permission to copy or redistribute this software is given. |
"^DIC",2006.56,2006.56,"%D",5,0)
 | Use of unreleased versions of this software requires the user |
"^DIC",2006.56,2006.56,"%D",6,0)
 | to execute a written test agreement with the VistA Imaging    |
"^DIC",2006.56,2006.56,"%D",7,0)
 | Development Office of the Department of Veterans Affairs,     |
"^DIC",2006.56,2006.56,"%D",8,0)
 | telephone (301) 734-0100.                                     |
"^DIC",2006.56,2006.56,"%D",9,0)
 |                                                               |
"^DIC",2006.56,2006.56,"%D",10,0)
 | The Food and Drug Administration classifies this software as  |
"^DIC",2006.56,2006.56,"%D",11,0)
 | a medical device.  As such, it may not be changed in any way. |
"^DIC",2006.56,2006.56,"%D",12,0)
 | Modifications to this software may result in an adulterated   |
"^DIC",2006.56,2006.56,"%D",13,0)
 | medical device under 21CFR820, the use of which is considered |
"^DIC",2006.56,2006.56,"%D",14,0)
 | to be a violation of US Federal Statutes.                     |
"^DIC",2006.56,2006.56,"%D",15,0)
 |                                                               |
"^DIC",2006.56,2006.56,"%D",16,0)
 +---------------------------------------------------------------+
"^DIC",2006.56,2006.56,"%D",17,0)
 
"^DIC",2006.56,2006.56,"%D",18,0)
The entries in this table contain the information about the various
"^DIC",2006.56,2006.56,"%D",19,0)
studies that are recorded as tasks on the worklist for a DICOM "modality".
"^DIC",2006.56,2006.56,"%D",20,0)
The top-level information in this table separates the activities from the
"^DIC",2006.56,2006.56,"%D",21,0)
various clinics at a consolidated site; the next level contains the study
"^DIC",2006.56,2006.56,"%D",22,0)
information.
"^DIC",2006.56,2006.56,"%D",23,0)
 
"^DIC",2006.56,2006.56,"%D",24,0)
This file contains temporary copies of information from the VistA
"^DIC",2006.56,2006.56,"%D",25,0)
system that live on our satellite systems for the duration of the
"^DIC",2006.56,2006.56,"%D",26,0)
study that produces the images, and the only reason for
"^DIC",2006.56,2006.56,"%D",27,0)
replicating the information onto these "DICOM Gateway Stations"
"^DIC",2006.56,2006.56,"%D",28,0)
is that we want to be able to allow the acquisition of images and
"^DIC",2006.56,2006.56,"%D",29,0)
the presentation of "worklist information" to continue, even
"^DIC",2006.56,2006.56,"%D",30,0)
while the VistA system is down, or when the DDP connection
"^DIC",2006.56,2006.56,"%D",31,0)
between our Gateways and the VistA system is not operating. 
"^DIC",2006.56,2006.56,"%D",32,0)
 
"^DIC",2006.56,2006.56,"%D",33,0)
Information is copied from VistA to DICOM Gateway when an HL7
"^DIC",2006.56,2006.56,"%D",34,0)
message is processed that announces the "exam", and removed when
"^DIC",2006.56,2006.56,"%D",35,0)
an HL7 message is processed that announces that the exam is
"^DIC",2006.56,2006.56,"%D",36,0)
carried out. 
"^DIC",2006.56,"B","DICOM WORKLIST STUDY",2006.56)

"^DIC",2006.574,2006.574,0)
DICOM IMAGE OUTPUT^2006.574
"^DIC",2006.574,2006.574,0,"GL")
^MAGDOUTP(2006.574,
"^DIC",2006.574,2006.574,"%",0)
^1.005^^0
"^DIC",2006.574,2006.574,"%D",0)
^^21^21^3010619^
"^DIC",2006.574,2006.574,"%D",1,0)
 +---------------------------------------------------------------+
"^DIC",2006.574,2006.574,"%D",2,0)
 |                                                               |
"^DIC",2006.574,2006.574,"%D",3,0)
 | Property of the US Government.                                |
"^DIC",2006.574,2006.574,"%D",4,0)
 | No permission to copy or redistribute this software is given. |
"^DIC",2006.574,2006.574,"%D",5,0)
 | Use of unreleased versions of this software requires the user |
"^DIC",2006.574,2006.574,"%D",6,0)
 | to execute a written test agreement with the VistA Imaging    |
"^DIC",2006.574,2006.574,"%D",7,0)
 | Development Office of the Department of Veterans Affairs,     |
"^DIC",2006.574,2006.574,"%D",8,0)
 | telephone (301) 734-0100.                                     |
"^DIC",2006.574,2006.574,"%D",9,0)
 |                                                               |
"^DIC",2006.574,2006.574,"%D",10,0)
 | The Food and Drug Administration classifies this software as  |
"^DIC",2006.574,2006.574,"%D",11,0)
 | a medical device.  As such, it may not be changed in any way. |
"^DIC",2006.574,2006.574,"%D",12,0)
 | Modifications to this software may result in an adulterated   |
"^DIC",2006.574,2006.574,"%D",13,0)
 | medical device under 21CFR820, the use of which is considered |
"^DIC",2006.574,2006.574,"%D",14,0)
 | to be a violation of US Federal Statutes.                     |
"^DIC",2006.574,2006.574,"%D",15,0)
 |                                                               |
"^DIC",2006.574,2006.574,"%D",16,0)
 +---------------------------------------------------------------+
"^DIC",2006.574,2006.574,"%D",17,0)
 
"^DIC",2006.574,2006.574,"%D",18,0)
The entries in this table describe requests to transmit image files
"^DIC",2006.574,2006.574,"%D",19,0)
to an alternate storage provider.
"^DIC",2006.574,2006.574,"%D",20,0)
The top-level of this table identifies the storage provider, the next
"^DIC",2006.574,2006.574,"%D",21,0)
level identifies the images for which files are to be transmitted.
"^DIC",2006.574,"B","DICOM IMAGE OUTPUT",2006.574)

"^DIC",2006.582,2006.582,0)
MODALITY TYPE DICTIONARY^2006.582
"^DIC",2006.582,2006.582,0,"GL")
^MAGDICOM(2006.582,
"^DIC",2006.582,2006.582,"%",0)
^1.005^^0
"^DIC",2006.582,2006.582,"%D",0)
^^22^22^3010619^
"^DIC",2006.582,2006.582,"%D",1,0)
 +---------------------------------------------------------------+
"^DIC",2006.582,2006.582,"%D",2,0)
 |                                                               |
"^DIC",2006.582,2006.582,"%D",3,0)
 | Property of the US Government.                                |
"^DIC",2006.582,2006.582,"%D",4,0)
 | No permission to copy or redistribute this software is given. |
"^DIC",2006.582,2006.582,"%D",5,0)
 | Use of unreleased versions of this software requires the user |
"^DIC",2006.582,2006.582,"%D",6,0)
 | to execute a written test agreement with the VistA Imaging    |
"^DIC",2006.582,2006.582,"%D",7,0)
 | Development Office of the Department of Veterans Affairs,     |
"^DIC",2006.582,2006.582,"%D",8,0)
 | telephone (301) 734-0100.                                     |
"^DIC",2006.582,2006.582,"%D",9,0)
 |                                                               |
"^DIC",2006.582,2006.582,"%D",10,0)
 | The Food and Drug Administration classifies this software as  |
"^DIC",2006.582,2006.582,"%D",11,0)
 | a medical device.  As such, it may not be changed in any way. |
"^DIC",2006.582,2006.582,"%D",12,0)
 | Modifications to this software may result in an adulterated   |
"^DIC",2006.582,2006.582,"%D",13,0)
 
"^DIC",2006.582,2006.582,"%D",14,0)
 | medical device under 21CFR820, the use of which is considered |
"^DIC",2006.582,2006.582,"%D",15,0)
 | to be a violation of US Federal Statutes.                     |
"^DIC",2006.582,2006.582,"%D",16,0)
 |                                                               ||
"^DIC",2006.582,2006.582,"%D",17,0)
 +---------------------------------------------------------------+
"^DIC",2006.582,2006.582,"%D",18,0)
 
"^DIC",2006.582,2006.582,"%D",19,0)
The entries in this table describe the various types of image
"^DIC",2006.582,2006.582,"%D",20,0)
acquisition devices that are present at a site.
"^DIC",2006.582,2006.582,"%D",21,0)
Note: a "modality" is a class of devices, an "instrument" is a
"^DIC",2006.582,2006.582,"%D",22,0)
specific device, or an instance of such a class.
"^DIC",2006.582,"B","MODALITY TYPE DICTIONARY",2006.582)

"^DIC",2006.5831,2006.5831,0)
DICOM HEALTHCARE PROVIDER SERVICE^2006.5831
"^DIC",2006.5831,2006.5831,0,"GL")
^MAG(2006.5831,
"^DIC",2006.5831,2006.5831,"%",0)
^1.005^^0
"^DIC",2006.5831,2006.5831,"%D",0)
^^23^23^3020409^^
"^DIC",2006.5831,2006.5831,"%D",1,0)
 +---------------------------------------------------------------+
"^DIC",2006.5831,2006.5831,"%D",2,0)
 |                                                               |
"^DIC",2006.5831,2006.5831,"%D",3,0)
 | Property of the US Government.                                |
"^DIC",2006.5831,2006.5831,"%D",4,0)
 | No permission to copy or redistribute this software is given. |
"^DIC",2006.5831,2006.5831,"%D",5,0)
 | Use of unreleased versions of this software requires the user |
"^DIC",2006.5831,2006.5831,"%D",6,0)
 | to execute a written test agreement with the VistA Imaging    |
"^DIC",2006.5831,2006.5831,"%D",7,0)
 | Development Office of the Department of Veterans Affairs,     |
"^DIC",2006.5831,2006.5831,"%D",8,0)
 | telephone (301) 734-0100.                                     |
"^DIC",2006.5831,2006.5831,"%D",9,0)
 |                                                               |
"^DIC",2006.5831,2006.5831,"%D",10,0)
 | The Food and Drug Administration classifies this software as  |
"^DIC",2006.5831,2006.5831,"%D",11,0)
 | a medical device.  As such, it may not be changed in any way. |
"^DIC",2006.5831,2006.5831,"%D",12,0)
 | Modifications to this software may result in an adulterated   |
"^DIC",2006.5831,2006.5831,"%D",13,0)
 | medical device under 21CFR820, the use of which is considered |
"^DIC",2006.5831,2006.5831,"%D",14,0)
 | to be a violation of US Federal Statutes.                     |
"^DIC",2006.5831,2006.5831,"%D",15,0)
 |                                                               |
"^DIC",2006.5831,2006.5831,"%D",16,0)
 +---------------------------------------------------------------+
"^DIC",2006.5831,2006.5831,"%D",17,0)

"^DIC",2006.5831,2006.5831,"%D",18,0)
The purpose of this file is to link groups of requests for services
"^DIC",2006.5831,2006.5831,"%D",19,0)
(stored in file ^GMR(123.5,...) to entities that are related to
"^DIC",2006.5831,2006.5831,"%D",20,0)
DICOM WorkList requests.
"^DIC",2006.5831,2006.5831,"%D",21,0)

"^DIC",2006.5831,2006.5831,"%D",22,0)
The DICOM WorkList Classes are defined and maintained by the sites.
"^DIC",2006.5831,2006.5831,"%D",23,0)
These are stored in ^MAG(2006.5832,... 
"^DIC",2006.5831,"B","DICOM HEALTHCARE PROVIDER SERVICE",2006.5831)

"^DIC",2006.5839,2006.5839,0)
DICOM GMRC TEMP LIST^2006.5839
"^DIC",2006.5839,2006.5839,0,"GL")
^MAG(2006.5839,
"^DIC",2006.5839,2006.5839,"%",0)
^1.005^^0
"^DIC",2006.5839,2006.5839,"%D",0)
^^27^27^3020529^
"^DIC",2006.5839,2006.5839,"%D",1,0)
 +---------------------------------------------------------------+
"^DIC",2006.5839,2006.5839,"%D",2,0)
 |                                                               |
"^DIC",2006.5839,2006.5839,"%D",3,0)
 | Property of the US Government.                                |
"^DIC",2006.5839,2006.5839,"%D",4,0)
 | No permission to copy or redistribute this software is given. |
"^DIC",2006.5839,2006.5839,"%D",5,0)
 | Use of unreleased versions of this software requires the user |
"^DIC",2006.5839,2006.5839,"%D",6,0)
 | to execute a written test agreement with the VistA Imaging    |
"^DIC",2006.5839,2006.5839,"%D",7,0)
 | Development Office of the Department of Veterans Affairs,     |
"^DIC",2006.5839,2006.5839,"%D",8,0)
 | telephone (301) 734-0100.                                     |
"^DIC",2006.5839,2006.5839,"%D",9,0)
 |                                                               |
"^DIC",2006.5839,2006.5839,"%D",10,0)
 | The Food and Drug Administration classifies this software as  |
"^DIC",2006.5839,2006.5839,"%D",11,0)
 | a medical device.  As such, it may not be changed in any way. |
"^DIC",2006.5839,2006.5839,"%D",12,0)
 | Modifications to this software may result in an adulterated   |
"^DIC",2006.5839,2006.5839,"%D",13,0)
 | medical device under 21CFR820, the use of which is considered |
"^DIC",2006.5839,2006.5839,"%D",14,0)
 | to be a violation of US Federal Statutes.                     |
"^DIC",2006.5839,2006.5839,"%D",15,0)
 |                                                               |
"^DIC",2006.5839,2006.5839,"%D",16,0)
 +---------------------------------------------------------------+
"^DIC",2006.5839,2006.5839,"%D",17,0)
 
"^DIC",2006.5839,2006.5839,"%D",18,0)
This is an Imaging file that temporarily stores image entries that have
"^DIC",2006.5839,2006.5839,"%D",19,0)
been acquired on the DICOM gateways and do not have an associated
"^DIC",2006.5839,2006.5839,"%D",20,0)
application parent report entry.  Imaging is a subscriber to the protocol
"^DIC",2006.5839,2006.5839,"%D",21,0)
entry GMRC EVSEND OR (Consults event sent to OE/RR) and evaluates all HL7
"^DIC",2006.5839,2006.5839,"%D",22,0)
message segments received from this protocol.  When an ORC message segment
"^DIC",2006.5839,2006.5839,"%D",23,0)
is received for a signed result (signed TIU note) then a module is called
"^DIC",2006.5839,2006.5839,"%D",24,0)
to lookup the entry in this file for possible matches and once found will
"^DIC",2006.5839,2006.5839,"%D",25,0)
update the image entry in the Image file with it's associated parent
"^DIC",2006.5839,2006.5839,"%D",26,0)
report and file the image pointer in the associated parent report.  The
"^DIC",2006.5839,2006.5839,"%D",27,0)
matched entry is then deleted from this file.  
"^DIC",2006.5839,"B","DICOM GMRC TEMP LIST",2006.5839)

**END**
**END**
