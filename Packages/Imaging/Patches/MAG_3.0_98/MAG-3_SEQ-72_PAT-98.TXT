
=============================================================================
Run Date: JAN 18, 2011                     Designation: MAG*3*98
Package : MAG - IMAGING                       Priority: Mandatory
Version : 3        SEQ #72                      Status: Released
                  Compliance Date: FEB 18, 2011
=============================================================================

Associated patches: (v)MAG*3*81    <<= must be installed BEFORE `MAG*3*98'

Subject: STORAGE SITE UTILITIES

Category: 
  - Routine
  - Data Dictionary
  - Enhancement (Mandatory)
  - Other

Description:
============

 Patch 98 Overview:
 ==================
 
 This document describes Patch 98, the MAG*3.0*98 Storage Utilities patch, and
 provides the following new maintenance utilities:
 
      *  MagUtility used for various maintenance tasks related to the RAID, 
         database, and jukebox
 
      *  MagDexter used to provide jukebox data reports for use with the new 
         MagKat utility
 
      *  MagKat, a database maintenance tool used to backfill specific fields 
         in the IMAGE file (#2005)
 
 For detailed information about each of these utilities, refer to the chapter 
 Patch 98 Changes.
 
 This patch also applies updates to the Device file (#3.5) and Terminal file 
 (#3.2) settings to eliminate the "Can t open device  error in viewing reports
 in Clinical Display.  For detailed information, see section VistA System 
 Changes.
 
 Distribution of Software:
 =========================
 
 This patch can be downloaded from:
 ==================================
 
 ftp.imaging.med.va.gov/Software/Released_Software/Mag3_0P98
 
 Installation instructions are included in this document.
 
 NOTE   Any late-breaking news about this patch will be found in a readme 
         file.  If present, this file will also be located in the MAG3_0P98 
         directory.
 
 Patch Contents:
 ===============
 
 Software:
 =========
 
      MAG3_0P98.KID   KIDS (Kernel Installation & Distribution System) package
      to be installed on the VistA System.
 
      MagDexerSetup.msi   Installation file for MagDexter.
 
      MagKatInstall.exe   Installation file for MagKat.
 
      MagUtilityInstall.exe   Installation file for MagUtility.
 
 Documents:
 ==========
 
      MAG3_0P98_Patch_Desc.pdf   Patch 98 Description
 
      MAG3_0P98_InstallGuide_ChangePages.pdf
 
      MAG3_0P98_SecurityGuide_ChangePages.pdf
 
      MAG3_0P98_TechnicalManual_ChangePages.pdf
 
      MAG_Storage_Utilities_User_Manual.pdf containing the setup and operation
      instructions for MagDexter, MagKat, and MagUtility
 
 Associated Patches:
 ===================
 
 Before Patch 98 is installed, the following patch must be installed:
 
      MAG*3.0*81
 
 For a list of all released Imaging (MAG) patches, refer to the patch_list.txt
 file available on the Imaging FTP server (go to ftp://ftp.imaging.med.va.gov,
 and then navigate to the \Docs\Imaging_Docs_Latest folder).
 
 Test Sites:
 ===========
 
 The following are test sites for this patch:
 ============================================
 
 El Paso, TX - Medium
 
 Fayetteville, NC - Large
 
 Portland, OR - Large
 
 Puget Sound, WA - Integrated
 
 VISN 2 - Integrated 
 
 Washington, DC - Large
 
 Remedy Calls:
 =============
 
 The following Remedy help desk calls are addressed in this patch:
 =================================================================
 
 148079     Fayetteville NC - Site receiving file writing errors
            (Has 10.3 formatted files on RAID)
 
 154046     Phoenix AZ - Verifier Message - You have multiple, on-line Jukebox
            shares with the same physical reference.
            (Duplicate RAID and jukebox shares   some are ONLINE.)
 
 154535     Providence, RI   Need assistance with Network Location cleanup
 
 183382     VA HC Network Upstate NY - FUT 49 not working as expected
 
 184323     Little Rock, AR   Share Folder Improperly assigned
            (Has 10.3 formatted files on RAID)
 
 208404     Providence, RI   file does  not exit
            (Need to migrate files from jukebox to RAID)
 
 223728     North Texas, TX   Issue with repairing an old file for migration
            (Has unhashed files on RAID/jukebox)
 
 310183     Roseburg HCS - Unable to access Vista Imaging files
 
 413820     Asheville VAMC - Prefetch Utility
 
 418092     Cincinnati VAMC - Restoring some images from his jukebox to his 
            RAID
 
 NSR and Enhancement Request Entries:
 ====================================
 
 No NSRs (New Service Requests) are addressed in this patch.
 
 No E3R (Electronic Error and Enhancement Reporting package) entries are 
 addressed in this patch.
 
 Patch 98 Changes:
 =================
 
 Patch 98 introduces three new VistA Imaging maintenance utilities, and 
 includes minor changes to the VistA Imaging portion of the VistA System.
 
 MagUtility:
 ===========
 
 MagUtility is a GUI (Graphical User Interface)-based program that can be used
 to:
 
      *  Identify orphan files (both text and image) on the Imaging 
         shares/RAID,and optionally resolve IMAGE file (#2005) references to 
         those files and/or remove un-resolvable files.
 
      Note  Back up the target share before using the Orphan Files process.
 
      *  Delete unused and/or erroneous RAID- and jukebox-related entries from 
         the NETWORK LOCATION file (#2005.2).
 
      *  Update the OFFLINE IMAGES file (#2006.033) to reflect the removal or 
         return of specific jukebox platters.
 
      *  Copy and/or transfer images and text files from one physical storage 
         location to another storage location (earlier versions of this feature
         were available in FUT (Field Unit Test) 49).
 
      Note  The MagUtility storage copy process should NOT be used as a 
            migration tool. 
 
      Note  When files are copied to a destination physical location, the 
            storage structure will be hashed, and then converted into 
            acceptable formats (8.3 or 14.3) if necessary.
 
 Most MagUtility processes can be run concurrently and/or from multiple 
 instances of MagUtility on multiple servers.  However, extra care should be 
 taken when running the Orphan Files and Storage Copy processes. 
 
 Recommendation Do not run the Orphan Files and Storage Copy processes 
 concurrently. If you need to run these processes at the same time on the same
 shares, contact the Imaging Group for guidance before proceeding. 
 
 MagUtility is intended for Imaging Coordinator use only. The VistA account 
 used to run MagUtility must be assigned the MAG UTILITY secondary menu 
 option.
 
 Note  If any MagUtility processes will be used, they should be run before 
 executing MagDexter and MagKat (described below). 
 
 Note  To eliminate any potential performance issues, do not run MagUtility 
 concurrently with MagKat (described below).
 
 For detailed information about MagUtility, see the 
 MAG_Storage_Utilities_User_Manual.pdf included in this patch. 
 
 MagDexter:
 ==========
 
 Important:
 1) If any MagUtility processes (described above) will be used, they should be 
    run before executing MagDexter.
 2) If MagDexter is used, platter compaction must be disabled on the jukebox 
    before running MagDexter, and compaction must remain disabled until MagKat
    (see below) processing is complete.
 
 MagDexter is a GUI-based utility used to generate reports of all files and 
 platters on a DiskXtender-managed jukebox. The MagKat utility uses these 
 reports (described below) for jukebox processing.
 
 Note  If MagDexter is used, it must be installed on the DiskXtender server 
 (version 4.x or 5.x). While MagDexter should work with later versions of 
 DiskXtender, it is certified for use with version 4.x or 5.x only at this 
 time.
 
 Users installing and running MagDexter must have Windows Administrator 
 privileges on the DiskXtender server. VistA credentials are not needed.
 
 After MagDexter has been installed, it must be executed at all sites that use
 DiskXtender version 4.x or 5.x jukebox management software. For detailed 
 information about MagDexter, see the MAG_Storage_Utilities_User_Manual.pdf 
 included in this patch. 
 
 MagKat:
 =======
 
 Important  If any MagUtility processes (described above) will be used, they 
 should be run before executing MagKat.
 
 MagKat is used to backfill specific fields in the IMAGE file (#2005) using 
 data from images  associated text files. 
 
      *  MagKat must be run by sites that intend to share images with the 
         Department of Defense. (VA/DoD image sharing is implemented in 
         MAG*3.0*83.)
         Recommendation  All sites should run MagKat in any case, since the 
         expectation is that all VA sites will be sharing data with DoD in the
         near future.
 
      *  Sites that also use VistARad may want to use MagKat to take advantage
         of improved date reporting for pre-patch MAG*3.0*54 exams in 
         VistARad s exam lists.
 
 MagKat is run in two steps:
 ===========================
 
 1)  For images on the RAID (short-term image storage)
 2)  If possible, for images on the jukebox (archive).  For the jukebox only, 
     MagKat requires the reports produced by the new MagDexter utility 
     (described above). 
 
 The VistA account used to run MagKat must have the MAG DOD FIX security key 
 and the [MAGKAT] secondary menu option.
 
 After MagKat is installed, it must be executed at all sites. For detailed 
 information about MagKat, see the MAG_Storage_Utilities_User_Manual.pdf 
 included in this patch. 
 
 VistA System Changes:
 =====================
 
 The KIDS portion of this patch modifies the VistA host to support the new 
 MagUtility and MagKat applications described above.
 
 Installing the KIDS will also update entries in the Device (#3.5) and 
 Terminal Type (#3.2) files to ensure that newly installed sites do not 
 encounter the "Can t open device IMAGING WORKSTATION  error reported by some
 sites in the past.  The entries in question are shown below; the altered 
 portions of the entries are indicated in underline.
 
 Terminal Type:
 ==============
 
        NAME: P-IMAGING                 SELECTABLE AT SIGN-ON: NO
          RIGHT MARGIN: 80                      FORM FEED: #
          PAGE LENGTH: 64                       BACK SPACE: $C(8)
          CLOSE EXECUTE: D CLOSE^MAGGTU5 X "C IO:""D""" K IO
           __________________________________________________
 
 Device:
 =======
 
        NAME: IMAGING WORKSTATION               $I: WS.DAT
          ASK DEVICE: NO                        ASK PARAMETERS: NO
          LOCATION OF TERMINAL: BROKER          
          OPEN PARAMETERS: "NWS"
          PRE-OPEN EXECUTE: S IO=$P(IO,".")_$J_"."_$P(IO,".",2)
           _____________________________________________________
 
 Data Dictionaries:
 ==================
 
 DICOM GATEWAY PARAMETER file (#2006.563) contains the following two new 
 fields for MagKat in this patch:
 
      *  LAST IMAGE SCANNED BY MAGKAT field (#200)
         DESCRIPTION:  This is the last image scanned by the MAGKAT utility.  
         The MagKat utility will update this field as it processes images.
 
      *  MAGKAT SCAN DIRECTION field (#201)
         DESCRIPTION:  This field controls the scanning direction used by the 
         MagKat utility.  Negative 1 (-1) will scan in reverse order and 
         (positive) 1 will scan for the next image using the value for the LAST
         IMAGE SCANNED BY MAGKAT field (#200). The MagKat utility will update 
         the MAGKAT SCAN DIRECTION field  (#201), as well as the LAST IMAGE 
         SCANNED BY MAGKAT field (#200).
 
 Security Keys:
 ==============
 
 The following security key is included in this patch:
  
      MAG DOD FIX - This key gives the holder permission to run the MagKat 
      utility.
 
 Remote Procedures:
 ==================
 
 The following remote procedures are included in this patch:
 
      MAG FIND IMAGE TEXT FILE - New. Used by MagKat to find an image entry 
      based on the full path of the IMAGE file.  Used while processing 
      jukebox platters.
 
      MAG SCAN IMAGE TEXT FILES - New.  Used by MagKat to return information 
      about the current scan status, to return the file name for the next 
      (or previous) image text file to scan, and optionally to reset internal
      counters so that the next scan will re-scan the whole database. 
   
      MAG STORAGE FETCH   New. Used by the Storage Copy process to copy files
      from one RAID or Jukebox share to another.
 
      MAG STORAGE FETCH SET   New. Used by the Storage Copy process to update
      IMAGE file (#2005) references for files that have been moved from one 
      RAID or Jukebox share to another.
 
      MAG STORE TEXT FILE DETAILS - New.  Used by MagKat to check/update 
      certain fields in the IMAGE file (#2005) based on data in image headers.
  
      MAG UTIL BKONLJB - New. Updates entries in the OFFLINE IMAGES file 
      (#2006.033) to indicate that a jukebox platter with image files has been
      put back online.
 
      MAG UTIL CLNLOC - New. Used by the Network Location Cleanup process to 
      remove a user-specified NETWORK LOCATION file (#2005.2) entry after 
      verifying that the entry is not referenced by any IMAGE file (#2005) 
      entries. 
 
      MAG UTIL DT2IEN - New.  Used by the Storage Copy and HEC 10-10 processes
      to locate the first IMAGE file (#2005) IENs for a user-supplied date. 
 
      MAG UTIL GETNETLOC - New. Used by the Network Location Cleanup process 
      to retrieve the current list of Network Locations from VistA.
 
      MAG UTIL JBOFFLN - New. Used to mark multiple platters offline in the 
      OFFLINE IMAGES file (#2006.033).
 
      MAG UTIL LSTOFLJB - New.  Used to retrieve a list of offline jukebox 
      platters from the OFFLINE IMAGES file (#2006.033).
 
 Menu Options:
 =============
 
 The following menu options are included in this patch:
 
      TRACK OFFLINE JUKEBOX IMAGES [MAG JB OFFLINE]   Modified. This option 
      adds options to list offline jukebox platters and to mark multiple 
      platters offline. These options duplicate functions in the MagUtility 
      program.
 
      SET CONTEXT FOR MAGKAT RPCS [MAGKAT]   New. This option grants access to
      RPCs used by MagKat and must be assigned to the account used to run the 
      MagKat utility.
 
      SET CONTEXT FOR MAGUTILITY RPCS [MAG UTILITY]   New. This option grants
      access to RPCs used by MagUtility and must be assigned to the account 
      used to run MagUtility.
 
 Templates:
 ==========
 
 There are no new or modified templates included in this patch.
 
 Installation:
 =============
 
 The KIDS portion of this patch is to be installed on the VistA System. 
 Installation locations for the client portions of this patch vary; see the 
 client-specific installation section for details.
 
 NOTE   All sites running VistA Imaging must install the KIDS portion of this
         patch.
 
 NOTE   All sites using Disk Xtender 4.x or 5.x must install and execute 
         MagDexter.
 
 NOTE   All sites must also install and use MagKat to process images stored 
         on the RAID and jukebox.
 
 Installation and use of MagUtility is recommended but not required. 
 
 This patch may be loaded while VistA Imaging System is active.  Installation
 for each component of this patch will take less than one minute per 
 component.
 
 Installation Prerequisites:
 ===========================
 
 Before installing this patch, you will need to download the Patch 98 files 
 from the Imaging FTP server to a local storage location.
 
 Verify that the patches listed in the Associated Patches section have been 
 installed.
 
 Important: If there is no VA Kernel RPC Broker installed beforehand on your 
 workstation/server, be sure to install the VA Kernel RPC Broker. For the 
 procedure, see the section VistA RPC Broker Installation in the VistA 
 Imaging System Installation Guide.
 
 VistA System (KIDS) Installation:
 =================================
 
 Installing the KIDS Package
 1.  Access the Kernel Installation and Distribution System Menu [XPD MAIN].
 
 2.  Run the Installation option [XPD INSTALLATION MENU].
 
 3.  Load the KIDS file by performing the following steps:
 
     a)  Run the Load a Distribution option [XPD LOAD DISTRIBUTION] to load 
         the KIDS distribution.
 
     b)  When prompted, enter the path and file name (MAG3_0P98.KID) of the 
         Patch 98 KIDS file that you downloaded from the Imaging FTP server.
 
     c)  When prompted to continue with the load, enter YES.  
         A Distribution OK! message will be displayed when the load is 
         complete.
 
 4.  After loading the KIDS file, use the following options to verify the 
     contents of the patch and back up any affected routines.
 
     *  Verify Checksums in Transport Global [XPD PRINT CHECKSUM]  Run this 
        option if you want to ensure the integrity of the routines in the 
        patch.
 
     *  Compare Transport Global to Current System [XPD COMPARE TO SYSTEM]   
        Run this option if you want to view all changes that will be made when
        the patch is installed.  All components (routines, options, and so on)
        in the patch will be compared.
 
     *  Backup a Transport Global [XPD BACKUP]   Run this option if you want 
        to create a backup message of any routines exported with the patch.  
        It will NOT back up any of the other changes.
 
 5.  After performing the load and any optional verification steps, install 
     the KIDS file by performing the following steps:
 
     a)  Run the Install Package(s) [XPD INSTALL BUILD] option.
  
     b)  When prompted for the install name, enter MAG*3.0*98.
 
     c)  Answer NO to the following prompts:
 
     Want KIDS to Rebuild Menu Trees Upon Completion of Install? No//NO
     Want KIDS to INHIBIT LOGONs during the install? No//NO
     Want to DISABLE Scheduled Options, Menu Options, and Protocols? No//NO
 
 
 6.  When the installation is finished, an Install Complete message will be 
     displayed.
  
 KIDS Installation Example:
 ==========================
 
 Select Installation Option: INStall Package(s)
 Select INSTALL NAME:    MAG*3.0*98     Loaded from Distribution  
 9/22/10@14:27:15
 
      => VistA Imaging V3.0 - Patch 98 - 09/22/2010 14:04PM  ;Created o
  
 This Distribution was loaded on Sep 22, 2010@14:27:15 with header of
    VistA Imaging V3.0 - Patch 98 - 09/22/2010 14:04PM  ;Created on Sep 2
 2, 2010@14:04:44
    It consisted of the following Install(s):
      MAG*3.0*98
 Checking Install for Package MAG*3.0*98
  
 Install Questions for MAG*3.0*98
  
 Incoming Files:
  
    2006.563  DICOM GATEWAY PARAMETER  (Partial Definition)
 Note:  You already have the 'DICOM GATEWAY PARAMETER' File.
  
 Want KIDS to Rebuild Menu Trees Upon Completion of Install? NO//
  
 Want KIDS to INHIBIT LOGONs during the install? NO//
 Want to DISABLE Scheduled Options, Menu Options, and Protocols? NO//
  
 Enter the Device you want to print the Install messages.
 You can queue the install by enter a 'Q' at the device prompt.
 Enter a '^' to abort the install.
  
 DEVICE: HOME// ;;9999  HERE 
                                    MAG*3.0*98
  Installing REMOTE PROCEDURE
  
  Installing OPTION
                Sep 22, 2010@14:42:18
  
  Running Post-Install Routine: POST^MAGIPS98
 I will check the 'P-IMAGING' entry in the Terminal Type file.
 I will check an 'Imaging Workstation' entry in the Device file.
  
  Updating Routine file...
  
  Updating KIDS files...
  
  MAG*3.0*98 Installed.
                Sep 22, 2010@14:42:18
  
  Install Message sent #32414
    
 Install Completed
 
 For Sites with VistA Running on a Cachi/Linux Platform:
 =======================================================
 
 For Sites with VistA Running on a Cachi/Linux Platform
 Important: Sites that recently converted to Cachi on Linux reported a problem 
 viewing reports in the VistA Imaging Clinical Display and VistARad 
 applications.  If your site is using Cachi with a Linux operating system, be 
 sure to follow these instructions after the KIDS installation. This problem 
 does not occur at sites that have Cachi on VMS or Cachi on Windows.
 
 The P-IMAGING entry in the VistA TERMINAL TYPE file (#3.2) that was updated 
 during the KIDS Post Install process can be modified using FileMan to work at 
 any Cachi site.  It is imperative that Cachi/Linux sites perform the following 
 one-time update but it can be done at all sites.
 
 VAH>D P^DI  
 
 VA FileMan 22.0
  
 Select OPTION: ENTER OR EDIT FILE ENTRIES
   
 INPUT TO WHAT FILE: TERMINAL TYPE
 EDIT WHICH FIELD: ALL// CLOSE EXECUTE
 THEN EDIT FIELD:
  
 Select TERMINAL TYPE NAME: P-IMAGING
 CLOSE EXECUTE: D CLOSE^MAGGTU5 X "C IO:""D""" K IO
            Replace END With (1,IO)  Replace  <-Press the Enter key here. 
    D CLOSE^MAGGTU5 X "C IO:""D""" K IO(1,IO)
  
 [The following prompt is displayed after you press Enter.] 
 Select TERMINAL TYPE NAME:
 
 MagUtility Installation:
 ========================
 
 MagUtility can be installed on any Windows server that has full read/write 
 access to Imaging shares.  To accommodate the maximum number of log files, 
 it is recommended that the server have at least 600 MB of available disk 
 space and at least 2 GB system memory.
 
 Note  Installation on a server class machine is recommended (not recommended 
 for workstations).
 
 Installation typically takes less than 30 seconds.
 
 For the installation steps, see the MAG_Storage_Utilities_User_Manual.pdf 
 included in this patch.
 
 MagKat Installation:
 ====================
 
 MagKat can be installed on any server that has read access to Imaging shares 
 and ten GB of available space. (MagKat log files can be very large, and the 
 Dexter reports used by MagKat may be up to 4 MB in size, with one report 
 generated for each side of each platter scanned.)
 
 Note  For sites that store more than one site s files on their equipment, 
 send a copy of the report to all of the sites that have files stored at the 
 one site.  
 
 Installation typically takes less than 30 seconds.
 
 For the installation steps, see the MAG_Storage_Utilities_User_Manual.pdf 
 included in this patch.
 
 MagDexter Installation:
 =======================
 
 MagDexter must be installed on the server hosting the EMC DiskXtender 
 version 4.x or 5.x software to function properly.  .NET 2.0 must also be 
 present. The application and log files require less than 5 MB of disk space.
 
 Installation typically takes less than 30 seconds.
 
 For the installation steps, see the MAG_Storage_Utilities_User_Manual.pdf 
 included in this patch.
 
 Routines:
 =========
 
 New and modified routines for the VistA System are listed below. For each 
 routine, the second line will contain the following information. Please note 
 that the "before  checksum may differ if any test software has been 
 installed.
 
 ;;3.0;IMAGING;**[patch list]**;Mar 19, 2002;Build 1849;Sep 22, 2010
 
 Checksums are calculated using the Kernel utility program CHECK1^XTSUMBLD.
 
 *  Note  MAGIPS98 is a post install routine and is deleted after the KIDS 
 install.
 

Routine Information:
====================
The checksums below are new checksums, and
 can be checked with CHECK1^XTSUMBLD.

Routine Name: MAGDOD01
    Before:       n/a   After: B50553020  **98**
Routine Name: MAGGDEV
    Before: B10702116   After: B10186131  **98**
Routine Name: MAGIPS98
    Before:       n/a   After:  B3955404  **98**
Routine Name: MAGSDEL5
    Before:       n/a   After: B35873021  **98**
Routine Name: MAGSDOFL
    Before: B20838310   After: B58680175  **18,98**
Routine Name: MAGSFTCH
    Before:       n/a   After:B159297363  **98**
Routine Name: MAGSHEC
    Before:       n/a   After: B11280563  **98**
Routine Name: MAGUF
    Before:       n/a   After: B12071947  **98**
 
Routine list of preceding patches: 18

=============================================================================
User Information:                          Hold Date     : DEC 09, 2010
Entered By  : TROMBETTA,KATHY               Date Entered  : AUG 05, 2008
Completed By: CASUGAY,ELSIE G               Date Completed: NOV 09, 2010
Released By : ANDKHOIE,MOSA                 Date Released : JAN 18, 2011
=============================================================================


Packman Mail Message:
=====================

No routines included
