KIDS Distribution saved on Jul 03, 2009@16:41:38
VistA Imaging V3.0 - Released MAG*3*54 SEQ #60 - 07/03/2009 16:41PM
**KIDS**:MAG*3.0*54^

**INSTALL NAME**
MAG*3.0*54
"BLD",3463,0)
MAG*3.0*54^IMAGING^0^3090703^y
"BLD",3463,1,0)
^^210^210^3090703^
"BLD",3463,1,1,0)
Version 3.0 Patch 054 - DICOM Maintenance IV
"BLD",3463,1,2,0)
 
"BLD",3463,1,3,0)
 
"BLD",3463,1,4,0)
This package contains a KIDS component
"BLD",3463,1,5,0)
for patch 54.
"BLD",3463,1,6,0)
 
"BLD",3463,1,7,0)
This package transports the FileMan data dictionary named 2005;110.
"BLD",3463,1,8,0)
 
"BLD",3463,1,9,0)
This package contains a KIDS component
"BLD",3463,1,10,0)
for patch 54.
"BLD",3463,1,11,0)
 
"BLD",3463,1,12,0)
This package transports the FileMan data dictionary named 2005.1;110.
"BLD",3463,1,13,0)
 
"BLD",3463,1,14,0)
KIDS file for one single file
"BLD",3463,1,15,0)
 
"BLD",3463,1,16,0)
This package contains a KIDS component
"BLD",3463,1,17,0)
for Patch 54.
"BLD",3463,1,18,0)
 
"BLD",3463,1,19,0)
This package transports the FileMan data dictionary named 
"BLD",3463,1,20,0)
2006.563;106,107,108,109,110,111,112,113.
"BLD",3463,1,21,0)
 
"BLD",3463,1,22,0)
This package contains a KIDS component
"BLD",3463,1,23,0)
for patch 54.
"BLD",3463,1,24,0)
 
"BLD",3463,1,25,0)
This package transports the FileMan data dictionary named 2006.5641;.01.
"BLD",3463,1,26,0)
 
"BLD",3463,1,27,0)
KIDS file for one single file
"BLD",3463,1,28,0)
 
"BLD",3463,1,29,0)
This package contains a KIDS component
"BLD",3463,1,30,0)
for patch 54.
"BLD",3463,1,31,0)
 
"BLD",3463,1,32,0)
This package transports the FileMan data dictionary named 2006.574.
"BLD",3463,1,33,0)
 
"BLD",3463,1,34,0)
This package contains a KIDS component
"BLD",3463,1,35,0)
for Patch 54.
"BLD",3463,1,36,0)
 
"BLD",3463,1,37,0)
This package transports the FileMan data dictionary named 
"BLD",3463,1,38,0)
2006.575;(2006.575;.01).
"BLD",3463,1,39,0)
 
"BLD",3463,1,40,0)
This package contains a KIDS component
"BLD",3463,1,41,0)
for Patch 54.
"BLD",3463,1,42,0)
 
"BLD",3463,1,43,0)
This package transports the FileMan data dictionary named 2006.5821.
"BLD",3463,1,44,0)
 
"BLD",3463,1,45,0)
This package contains a KIDS component
"BLD",3463,1,46,0)
for Running Baseline.
"BLD",3463,1,47,0)
 
"BLD",3463,1,48,0)
This package transports the FileMan data dictionary named 2006.5849.
"BLD",3463,1,49,0)
 
"BLD",3463,1,50,0)
KIDS file for one single file
"BLD",3463,1,51,0)
 
"BLD",3463,1,52,0)
This package contains menu option MAGD REMOVE GATEWAY FAILED.
"BLD",3463,1,53,0)
 
"BLD",3463,1,54,0)
This package contains menu option MAGD REMOVE GATEWAY XMIT.
"BLD",3463,1,55,0)
 
"BLD",3463,1,56,0)
This package contains menu option MAGD RENAME GATEWAY FAILED.
"BLD",3463,1,57,0)
 
"BLD",3463,1,58,0)
This package contains menu option MAGD RENAME GATEWAY XMIT.
"BLD",3463,1,59,0)
 
"BLD",3463,1,60,0)
This package contains a KIDS component
"BLD",3463,1,61,0)
for patch 66.
"BLD",3463,1,62,0)
 
"BLD",3463,1,63,0)
This package transports the remote procedure call named MAG DICOM CHECK 
"BLD",3463,1,64,0)
AE TITLE.
"BLD",3463,1,65,0)
 
"BLD",3463,1,66,0)
This package removes the RPC called MAG DICOM CHECK MACHINE ID.
"BLD",3463,1,67,0)
 
"BLD",3463,1,68,0)
This package contains a KIDS component
"BLD",3463,1,69,0)
for patch 66.
"BLD",3463,1,70,0)
 
"BLD",3463,1,71,0)
This package transports the remote procedure call named MAG DICOM GET 
"BLD",3463,1,72,0)
GATEWAY INFO.
"BLD",3463,1,73,0)
 
"BLD",3463,1,74,0)
This package contains a KIDS component
"BLD",3463,1,75,0)
for patch 54.
"BLD",3463,1,76,0)
 
"BLD",3463,1,77,0)
This package transports the remote procedure call named MAG DICOM GET 
"BLD",3463,1,78,0)
MACHINE ID.
"BLD",3463,1,79,0)
 
"BLD",3463,1,80,0)
This package contains a KIDS component
"BLD",3463,1,81,0)
for patch 54.
"BLD",3463,1,82,0)
 
"BLD",3463,1,83,0)
This package transports the remote procedure call named MAG DICOM GET UID 
"BLD",3463,1,84,0)
ROOT.
"BLD",3463,1,85,0)
 
"BLD",3463,1,86,0)
This package contains a KIDS component
"BLD",3463,1,87,0)
for Patch 54.
"BLD",3463,1,88,0)
 
"BLD",3463,1,89,0)
This package transports the remote procedure call named MAG DICOM GET UID 
"BLD",3463,1,90,0)
TABLE.
"BLD",3463,1,91,0)
 
"BLD",3463,1,92,0)
This package contains a KIDS component
"BLD",3463,1,93,0)
for patch 54.
"BLD",3463,1,94,0)
 
"BLD",3463,1,95,0)
This package transports the remote procedure call named MAG DICOM IMAGE 
"BLD",3463,1,96,0)
AUDIT GET.
"BLD",3463,1,97,0)
 
"BLD",3463,1,98,0)
This package contains a KIDS component
"BLD",3463,1,99,0)
for patch 66.
"BLD",3463,1,100,0)
 
"BLD",3463,1,101,0)
This package transports the remote procedure call named MAG DICOM STORE 
"BLD",3463,1,102,0)
GATEWAY INFO.
"BLD",3463,1,103,0)
 
"BLD",3463,1,104,0)
This package removes the RPC called MAG DICOM UPDATE MACHINE ID.
"BLD",3463,1,105,0)
 
"BLD",3463,1,106,0)
This package contains a KIDS component
"BLD",3463,1,107,0)
for patch 66.
"BLD",3463,1,108,0)
 
"BLD",3463,1,109,0)
This package transports the remote procedure call named MAG DICOM VISTA 
"BLD",3463,1,110,0)
AE TITLE.
"BLD",3463,1,111,0)
 
"BLD",3463,1,112,0)
This package contains a KIDS component
"BLD",3463,1,113,0)
for patch 54.
"BLD",3463,1,114,0)
 
"BLD",3463,1,115,0)
This package transports the remote procedure call named MAG GET DICOM 
"BLD",3463,1,116,0)
XMIT ORIGIN.
"BLD",3463,1,117,0)
 
"BLD",3463,1,118,0)
This package contains a KIDS component
"BLD",3463,1,119,0)
for patch 50.
"BLD",3463,1,120,0)
 
"BLD",3463,1,121,0)
This package transports the remote procedure call named MAG IMAGE CURRENT 
"BLD",3463,1,122,0)
INFO.
"BLD",3463,1,123,0)
 
"BLD",3463,1,124,0)
This package contains a KIDS component
"BLD",3463,1,125,0)
for patch 66.
"BLD",3463,1,126,0)
 
"BLD",3463,1,127,0)
This package transports the FileMan data dictionary named 2006.563;112.
"BLD",3463,1,128,0)
 
"BLD",3463,1,129,0)
This package contains a KIDS component
"BLD",3463,1,130,0)
for patch 66.
"BLD",3463,1,131,0)
 
"BLD",3463,1,132,0)
This package transports the FileMan data dictionary named 2006.5733.
"BLD",3463,1,133,0)
 
"BLD",3463,1,134,0)
This package contains a KIDS component
"BLD",3463,1,135,0)
for patch 66.
"BLD",3463,1,136,0)
 
"BLD",3463,1,137,0)
This package transports the FileMan data dictionary named 2006.587.
"BLD",3463,1,138,0)
 
"BLD",3463,1,139,0)
This package contains a KIDS component
"BLD",3463,1,140,0)
for patch 66.
"BLD",3463,1,141,0)
 
"BLD",3463,1,142,0)
This package transports the FileMan data dictionary named 2006.87.
"BLD",3463,1,143,0)
 
"BLD",3463,1,144,0)
Routines:
"BLD",3463,1,145,0)
MAG7UM      new value = 23898950
"BLD",3463,1,146,0)
MAGBRTE4    new value = 74476689
"BLD",3463,1,147,0)
MAGBRTE5    new value = 47168607
"BLD",3463,1,148,0)
MAGBRTUT    new value = 44621391
"BLD",3463,1,149,0)
MAGDCCS     new value = 64783985
"BLD",3463,1,150,0)
MAGDCCS2    new value = 16336800
"BLD",3463,1,151,0)
MAGDCCU1    new value = 26965378
"BLD",3463,1,152,0)
MAGDHL7     new value = 23868283
"BLD",3463,1,153,0)
MAGDHLE     new value = 9902651
"BLD",3463,1,154,0)
MAGDHRC0    new value = 7715030
"BLD",3463,1,155,0)
MAGDHWC     new value = 46762790
"BLD",3463,1,156,0)
MAGDHWS     new value = 26963690
"BLD",3463,1,157,0)
MAGDIR8     new value = 10992780
"BLD",3463,1,158,0)
MAGDIR81    new value = 74364862
"BLD",3463,1,159,0)
MAGDIR82    new value = 63521425
"BLD",3463,1,160,0)
MAGDIR83    new value = 24823552
"BLD",3463,1,161,0)
MAGDIR84    new value = 17691728
"BLD",3463,1,162,0)
MAGDIR9A    new value = 51676993
"BLD",3463,1,163,0)
MAGDIR9B    new value = 19108558
"BLD",3463,1,164,0)
MAGDIR9E    new value = 68376397
"BLD",3463,1,165,0)
MAGDIRVE    new value = 64787457
"BLD",3463,1,166,0)
MAGDLB1     new value = 53612286
"BLD",3463,1,167,0)
MAGDLBAA    new value = 12894366
"BLD",3463,1,168,0)
MAGDMEDL    new value = 20217185
"BLD",3463,1,169,0)
MAGDQR00    new value = 3247668
"BLD",3463,1,170,0)
MAGDQR01    new value = 45027255
"BLD",3463,1,171,0)
MAGDQR02    new value = 67333649
"BLD",3463,1,172,0)
MAGDQR03    new value = 150326376
"BLD",3463,1,173,0)
MAGDQR04    new value = 73426432
"BLD",3463,1,174,0)
MAGDQR05    new value = 45801758
"BLD",3463,1,175,0)
MAGDQR06    new value = 31960461
"BLD",3463,1,176,0)
MAGDQR07    new value = 30347605
"BLD",3463,1,177,0)
MAGDQR08    new value = 33379098
"BLD",3463,1,178,0)
MAGDRA2     new value = 25170126
"BLD",3463,1,179,0)
MAGDRCU1    new value = 29329943
"BLD",3463,1,180,0)
MAGDRCU2    new value = 37774357
"BLD",3463,1,181,0)
MAGDRPC1    new value = 45275966
"BLD",3463,1,182,0)
MAGDRPC2    new value = 65411497
"BLD",3463,1,183,0)
MAGDRPC3    new value = 64771366
"BLD",3463,1,184,0)
MAGDRPC4    new value = 79966759
"BLD",3463,1,185,0)
MAGDRPC5    new value = 81877416
"BLD",3463,1,186,0)
MAGDRPC6    new value = 36205278
"BLD",3463,1,187,0)
MAGDRPC7    new value = 36219173
"BLD",3463,1,188,0)
MAGDRPC8    new value = 62107213
"BLD",3463,1,189,0)
MAGDRPC9    new value = 42474076
"BLD",3463,1,190,0)
MAGDRUID    new value = 4073143
"BLD",3463,1,191,0)
MAGDTR02    new value = 34307133
"BLD",3463,1,192,0)
MAGDTR03    new value = 73363614
"BLD",3463,1,193,0)
MAGDTR05    new value = 47569511
"BLD",3463,1,194,0)
MAGDTR06    new value = 25510598
"BLD",3463,1,195,0)
MAGDUID3    new value = 4496619
"BLD",3463,1,196,0)
MAGENCHK    new value = 4666319
"BLD",3463,1,197,0)
MAGIPS54    new value = 43549700
"BLD",3463,1,198,0)
MAGUE001    new value = 8353040
"BLD",3463,1,199,0)
MAGUE002    new value = 6508124
"BLD",3463,1,200,0)
MAGUE003    new value = 3998805
"BLD",3463,1,201,0)
MAGVCHK     new value = 23304941
"BLD",3463,1,202,0)
MAGXCVC     new value = 40623229
"BLD",3463,1,203,0)
MAGXCVI     new value = 45675104
"BLD",3463,1,204,0)
MAGXCVP     new value = 27908665
"BLD",3463,1,205,0)
MAGXCVR     new value = 56935964
"BLD",3463,1,206,0)
MAGXCVS     new value = 57771019
"BLD",3463,1,207,0)
MAGXIDXU    new value = 82620851
"BLD",3463,1,208,0)
 
"BLD",3463,1,209,0)
Please note that routine MAGIPS54 is deleted after the KIDS Build is
"BLD",3463,1,210,0)
installed.
"BLD",3463,4,0)
^9.64PA^2006.87^13
"BLD",3463,6.3)
1424
"BLD",3463,4,2005,0)
2005
"BLD",3463,4,2005,2,0)
^9.641^2005^1
"BLD",3463,4,2005,2,2005,0)
IMAGE  (File-top level)
"BLD",3463,4,2005,2,2005,1,0)
^9.6411^110^1
"BLD",3463,4,2005,2,2005,1,110,0)
DOCUMENT DATE
"BLD",3463,4,2005,222)
y^y^p^^^^n^^n
"BLD",3463,4,2005,224)

"BLD",3463,4,2005.1,0)
2005.1
"BLD",3463,4,2005.1,2,0)
^9.641^2005.1^1
"BLD",3463,4,2005.1,2,2005.1,0)
IMAGE  (File-top level)
"BLD",3463,4,2005.1,2,2005.1,1,0)
^9.6411^110^1
"BLD",3463,4,2005.1,2,2005.1,1,110,0)
DOCUMENT DATE
"BLD",3463,4,2005.1,222)
y^y^p^^^^n^^n
"BLD",3463,4,2005.1,224)

"BLD",3463,4,2006.539,0)
2006.539
"BLD",3463,4,2006.539,222)
y^y^f^^n^^y^o^n
"BLD",3463,4,2006.563,0)
2006.563
"BLD",3463,4,2006.563,2,0)
^9.641^2006.563^1
"BLD",3463,4,2006.563,2,2006.563,0)
DICOM GATEWAY PARAMETER  (File-top level)
"BLD",3463,4,2006.563,2,2006.563,1,0)
^9.6411^112^1
"BLD",3463,4,2006.563,2,2006.563,1,112,0)
VISTA STORAGE
"BLD",3463,4,2006.563,222)
y^y^p^^^^n^^n
"BLD",3463,4,2006.563,224)

"BLD",3463,4,2006.5641,0)
2006.5641
"BLD",3463,4,2006.5641,2,0)
^9.641^2006.5641^1
"BLD",3463,4,2006.5641,2,2006.5641,0)
DICOM GATEWAY MACHINE ID  (File-top level)
"BLD",3463,4,2006.5641,2,2006.5641,1,0)
^9.6411^.01^1
"BLD",3463,4,2006.5641,2,2006.5641,1,.01,0)
MACHINE ID
"BLD",3463,4,2006.5641,222)
y^y^p^^^^n^^n
"BLD",3463,4,2006.5641,224)

"BLD",3463,4,2006.5714,0)
2006.5714
"BLD",3463,4,2006.5714,222)
y^y^f^^^^n
"BLD",3463,4,2006.5733,0)
2006.5733
"BLD",3463,4,2006.5733,222)
y^y^f^^^^n
"BLD",3463,4,2006.574,0)
2006.574
"BLD",3463,4,2006.574,222)
y^y^f^^^^n
"BLD",3463,4,2006.575,0)
2006.575
"BLD",3463,4,2006.575,2,0)
^9.641^2006.575^1
"BLD",3463,4,2006.575,2,2006.575,0)
DICOM FAILED IMAGES  (File-top level)
"BLD",3463,4,2006.575,2,2006.575,1,0)
^9.6411^^
"BLD",3463,4,2006.575,222)
y^y^p^^^^n^^n
"BLD",3463,4,2006.575,224)

"BLD",3463,4,2006.5821,0)
2006.5821
"BLD",3463,4,2006.5821,222)
y^y^f^^^^n
"BLD",3463,4,2006.5849,0)
2006.5849
"BLD",3463,4,2006.5849,222)
y^y^f^^^^n
"BLD",3463,4,2006.587,0)
2006.587
"BLD",3463,4,2006.587,222)
y^y^f^^^^n
"BLD",3463,4,2006.87,0)
2006.87
"BLD",3463,4,2006.87,222)
y^y^f^^^^n
"BLD",3463,4,"APDD",2006.563,2006.563)

"BLD",3463,4,"APDD",2005,2005)

"BLD",3463,4,"APDD",2005,2005,110)

"BLD",3463,4,"APDD",2005.1,2005.1)

"BLD",3463,4,"APDD",2005.1,2005.1,110)

"BLD",3463,4,"APDD",2006.563,2006.563)

"BLD",3463,4,"APDD",2006.563,2006.563,106)

"BLD",3463,4,"APDD",2006.563,2006.563,107)

"BLD",3463,4,"APDD",2006.563,2006.563,108)

"BLD",3463,4,"APDD",2006.563,2006.563,109)

"BLD",3463,4,"APDD",2006.563,2006.563,110)

"BLD",3463,4,"APDD",2006.563,2006.563,111)

"BLD",3463,4,"APDD",2006.563,2006.563,112)

"BLD",3463,4,"APDD",2006.563,2006.563,113)

"BLD",3463,4,"APDD",2006.5641,2006.5641)

"BLD",3463,4,"APDD",2006.5641,2006.5641,.01)

"BLD",3463,4,"APDD",2006.575,2006.575)

"BLD",3463,4,"B",2005,2005)

"BLD",3463,4,"B",2005.1,2005.1)

"BLD",3463,4,"B",2006.539,2006.539)

"BLD",3463,4,"B",2006.563,2006.563)

"BLD",3463,4,"B",2006.5641,2006.5641)

"BLD",3463,4,"B",2006.5714,2006.5714)

"BLD",3463,4,"B",2006.5733,2006.5733)

"BLD",3463,4,"B",2006.574,2006.574)

"BLD",3463,4,"B",2006.575,2006.575)

"BLD",3463,4,"B",2006.5821,2006.5821)

"BLD",3463,4,"B",2006.5849,2006.5849)

"BLD",3463,4,"B",2006.587,2006.587)

"BLD",3463,4,"B",2006.87,2006.87)

"BLD",3463,"ABNS",0)
^9.66A^^
"BLD",3463,"ABPKG")
y^y^G.IMAGING DEVELOPMENT TEAM@DOMAIN.EXT
"BLD",3463,"INI")
PRE^MAGIPS54
"BLD",3463,"INID")
y^y^n
"BLD",3463,"INIT")
POST^MAGIPS54
"BLD",3463,"KRN",0)
^9.67PA^8994^19
"BLD",3463,"KRN",.4,0)
.4
"BLD",3463,"KRN",.4,"NM",0)
^9.68A^^
"BLD",3463,"KRN",.401,0)
.401
"BLD",3463,"KRN",.401,"NM",0)
^9.68A^^
"BLD",3463,"KRN",.402,0)
.402
"BLD",3463,"KRN",.402,"NM",0)
^9.68A^^
"BLD",3463,"KRN",.403,0)
.403
"BLD",3463,"KRN",.5,0)
.5
"BLD",3463,"KRN",.84,0)
.84
"BLD",3463,"KRN",.84,"NM",0)
^9.68A^^
"BLD",3463,"KRN",3.6,0)
3.6
"BLD",3463,"KRN",3.8,0)
3.8
"BLD",3463,"KRN",9.2,0)
9.2
"BLD",3463,"KRN",9.8,0)
9.8
"BLD",3463,"KRN",9.8,"NM",0)
^9.68A^62^62
"BLD",3463,"KRN",9.8,"NM",1,0)
MAG7UM^^0^B23898950
"BLD",3463,"KRN",9.8,"NM",2,0)
MAGBRTE4^^0^B74476689
"BLD",3463,"KRN",9.8,"NM",3,0)
MAGBRTE5^^0^B47168607
"BLD",3463,"KRN",9.8,"NM",4,0)
MAGBRTUT^^0^B44621391
"BLD",3463,"KRN",9.8,"NM",5,0)
MAGDCCS^^0^B64783985
"BLD",3463,"KRN",9.8,"NM",6,0)
MAGDCCS2^^0^B16336800
"BLD",3463,"KRN",9.8,"NM",7,0)
MAGDCCU1^^0^B26965378
"BLD",3463,"KRN",9.8,"NM",8,0)
MAGDHL7^^0^B23868283
"BLD",3463,"KRN",9.8,"NM",9,0)
MAGDHLE^^0^B9902651
"BLD",3463,"KRN",9.8,"NM",10,0)
MAGDHRC0^^0^B7715030
"BLD",3463,"KRN",9.8,"NM",11,0)
MAGDHWC^^0^B46762790
"BLD",3463,"KRN",9.8,"NM",12,0)
MAGDHWS^^0^B26963690
"BLD",3463,"KRN",9.8,"NM",13,0)
MAGDIR8^^0^B10992780
"BLD",3463,"KRN",9.8,"NM",14,0)
MAGDIR81^^0^B74364862
"BLD",3463,"KRN",9.8,"NM",15,0)
MAGDIR82^^0^B63521425
"BLD",3463,"KRN",9.8,"NM",16,0)
MAGDIR83^^0^B24823552
"BLD",3463,"KRN",9.8,"NM",17,0)
MAGDIR84^^0^B17691728
"BLD",3463,"KRN",9.8,"NM",18,0)
MAGDIR9A^^0^B51676993
"BLD",3463,"KRN",9.8,"NM",19,0)
MAGDIR9B^^0^B19108558
"BLD",3463,"KRN",9.8,"NM",20,0)
MAGDIR9E^^0^B68376397
"BLD",3463,"KRN",9.8,"NM",21,0)
MAGDIRVE^^0^B64787457
"BLD",3463,"KRN",9.8,"NM",22,0)
MAGDLB1^^0^B53612286
"BLD",3463,"KRN",9.8,"NM",23,0)
MAGDLBAA^^0^B12894366
"BLD",3463,"KRN",9.8,"NM",24,0)
MAGDMEDL^^0^B20217185
"BLD",3463,"KRN",9.8,"NM",25,0)
MAGDQR00^^0^B3247668
"BLD",3463,"KRN",9.8,"NM",26,0)
MAGDQR01^^0^B45027255
"BLD",3463,"KRN",9.8,"NM",27,0)
MAGDQR02^^0^B67333649
"BLD",3463,"KRN",9.8,"NM",28,0)
MAGDQR03^^0^B150326376
"BLD",3463,"KRN",9.8,"NM",29,0)
MAGDQR04^^0^B73426432
"BLD",3463,"KRN",9.8,"NM",30,0)
MAGDQR05^^0^B45801758
"BLD",3463,"KRN",9.8,"NM",31,0)
MAGDQR06^^0^B31960461
"BLD",3463,"KRN",9.8,"NM",32,0)
MAGDQR07^^0^B30347605
"BLD",3463,"KRN",9.8,"NM",33,0)
MAGDQR08^^0^B33379098
"BLD",3463,"KRN",9.8,"NM",34,0)
MAGDRA2^^0^B25170126
"BLD",3463,"KRN",9.8,"NM",35,0)
MAGDRCU1^^0^B29329943
"BLD",3463,"KRN",9.8,"NM",36,0)
MAGDRCU2^^0^B37774357
"BLD",3463,"KRN",9.8,"NM",37,0)
MAGDRPC1^^0^B45275966
"BLD",3463,"KRN",9.8,"NM",38,0)
MAGDRPC2^^0^B65411497
"BLD",3463,"KRN",9.8,"NM",39,0)
MAGDRPC3^^0^B64771366
"BLD",3463,"KRN",9.8,"NM",40,0)
MAGDRPC4^^0^B79966759
"BLD",3463,"KRN",9.8,"NM",41,0)
MAGDRPC5^^0^B81877416
"BLD",3463,"KRN",9.8,"NM",42,0)
MAGDRPC6^^0^B36205278
"BLD",3463,"KRN",9.8,"NM",43,0)
MAGDRPC7^^0^B36219173
"BLD",3463,"KRN",9.8,"NM",44,0)
MAGDRPC8^^0^B62107213
"BLD",3463,"KRN",9.8,"NM",45,0)
MAGDRPC9^^0^B42474076
"BLD",3463,"KRN",9.8,"NM",46,0)
MAGDRUID^^0^B4073143
"BLD",3463,"KRN",9.8,"NM",47,0)
MAGDTR02^^0^B34307133
"BLD",3463,"KRN",9.8,"NM",48,0)
MAGDTR03^^0^B73363614
"BLD",3463,"KRN",9.8,"NM",49,0)
MAGDTR05^^0^B47569511
"BLD",3463,"KRN",9.8,"NM",50,0)
MAGDTR06^^0^B25510598
"BLD",3463,"KRN",9.8,"NM",51,0)
MAGDUID3^^0^B4496619
"BLD",3463,"KRN",9.8,"NM",52,0)
MAGENCHK^^0^B4666319
"BLD",3463,"KRN",9.8,"NM",53,0)
MAGUE001^^0^B8353040
"BLD",3463,"KRN",9.8,"NM",54,0)
MAGUE002^^0^B6508124
"BLD",3463,"KRN",9.8,"NM",55,0)
MAGUE003^^0^B3998805
"BLD",3463,"KRN",9.8,"NM",56,0)
MAGVCHK^^0^B23304941
"BLD",3463,"KRN",9.8,"NM",57,0)
MAGXCVC^^0^B40623229
"BLD",3463,"KRN",9.8,"NM",58,0)
MAGXCVI^^0^B45675104
"BLD",3463,"KRN",9.8,"NM",59,0)
MAGXCVP^^0^B27908665
"BLD",3463,"KRN",9.8,"NM",60,0)
MAGXCVR^^0^B56935964
"BLD",3463,"KRN",9.8,"NM",61,0)
MAGXCVS^^0^B57771019
"BLD",3463,"KRN",9.8,"NM",62,0)
MAGXIDXU^^0^B82620851
"BLD",3463,"KRN",9.8,"NM","B","MAG7UM",1)

"BLD",3463,"KRN",9.8,"NM","B","MAGBRTE4",2)

"BLD",3463,"KRN",9.8,"NM","B","MAGBRTE5",3)

"BLD",3463,"KRN",9.8,"NM","B","MAGBRTUT",4)

"BLD",3463,"KRN",9.8,"NM","B","MAGDCCS",5)

"BLD",3463,"KRN",9.8,"NM","B","MAGDCCS2",6)

"BLD",3463,"KRN",9.8,"NM","B","MAGDCCU1",7)

"BLD",3463,"KRN",9.8,"NM","B","MAGDHL7",8)

"BLD",3463,"KRN",9.8,"NM","B","MAGDHLE",9)

"BLD",3463,"KRN",9.8,"NM","B","MAGDHRC0",10)

"BLD",3463,"KRN",9.8,"NM","B","MAGDHWC",11)

"BLD",3463,"KRN",9.8,"NM","B","MAGDHWS",12)

"BLD",3463,"KRN",9.8,"NM","B","MAGDIR8",13)

"BLD",3463,"KRN",9.8,"NM","B","MAGDIR81",14)

"BLD",3463,"KRN",9.8,"NM","B","MAGDIR82",15)

"BLD",3463,"KRN",9.8,"NM","B","MAGDIR83",16)

"BLD",3463,"KRN",9.8,"NM","B","MAGDIR84",17)

"BLD",3463,"KRN",9.8,"NM","B","MAGDIR9A",18)

"BLD",3463,"KRN",9.8,"NM","B","MAGDIR9B",19)

"BLD",3463,"KRN",9.8,"NM","B","MAGDIR9E",20)

"BLD",3463,"KRN",9.8,"NM","B","MAGDIRVE",21)

"BLD",3463,"KRN",9.8,"NM","B","MAGDLB1",22)

"BLD",3463,"KRN",9.8,"NM","B","MAGDLBAA",23)

"BLD",3463,"KRN",9.8,"NM","B","MAGDMEDL",24)

"BLD",3463,"KRN",9.8,"NM","B","MAGDQR00",25)

"BLD",3463,"KRN",9.8,"NM","B","MAGDQR01",26)

"BLD",3463,"KRN",9.8,"NM","B","MAGDQR02",27)

"BLD",3463,"KRN",9.8,"NM","B","MAGDQR03",28)

"BLD",3463,"KRN",9.8,"NM","B","MAGDQR04",29)

"BLD",3463,"KRN",9.8,"NM","B","MAGDQR05",30)

"BLD",3463,"KRN",9.8,"NM","B","MAGDQR06",31)

"BLD",3463,"KRN",9.8,"NM","B","MAGDQR07",32)

"BLD",3463,"KRN",9.8,"NM","B","MAGDQR08",33)

"BLD",3463,"KRN",9.8,"NM","B","MAGDRA2",34)

"BLD",3463,"KRN",9.8,"NM","B","MAGDRCU1",35)

"BLD",3463,"KRN",9.8,"NM","B","MAGDRCU2",36)

"BLD",3463,"KRN",9.8,"NM","B","MAGDRPC1",37)

"BLD",3463,"KRN",9.8,"NM","B","MAGDRPC2",38)

"BLD",3463,"KRN",9.8,"NM","B","MAGDRPC3",39)

"BLD",3463,"KRN",9.8,"NM","B","MAGDRPC4",40)

"BLD",3463,"KRN",9.8,"NM","B","MAGDRPC5",41)

"BLD",3463,"KRN",9.8,"NM","B","MAGDRPC6",42)

"BLD",3463,"KRN",9.8,"NM","B","MAGDRPC7",43)

"BLD",3463,"KRN",9.8,"NM","B","MAGDRPC8",44)

"BLD",3463,"KRN",9.8,"NM","B","MAGDRPC9",45)

"BLD",3463,"KRN",9.8,"NM","B","MAGDRUID",46)

"BLD",3463,"KRN",9.8,"NM","B","MAGDTR02",47)

"BLD",3463,"KRN",9.8,"NM","B","MAGDTR03",48)

"BLD",3463,"KRN",9.8,"NM","B","MAGDTR05",49)

"BLD",3463,"KRN",9.8,"NM","B","MAGDTR06",50)

"BLD",3463,"KRN",9.8,"NM","B","MAGDUID3",51)

"BLD",3463,"KRN",9.8,"NM","B","MAGENCHK",52)

"BLD",3463,"KRN",9.8,"NM","B","MAGUE001",53)

"BLD",3463,"KRN",9.8,"NM","B","MAGUE002",54)

"BLD",3463,"KRN",9.8,"NM","B","MAGUE003",55)

"BLD",3463,"KRN",9.8,"NM","B","MAGVCHK",56)

"BLD",3463,"KRN",9.8,"NM","B","MAGXCVC",57)

"BLD",3463,"KRN",9.8,"NM","B","MAGXCVI",58)

"BLD",3463,"KRN",9.8,"NM","B","MAGXCVP",59)

"BLD",3463,"KRN",9.8,"NM","B","MAGXCVR",60)

"BLD",3463,"KRN",9.8,"NM","B","MAGXCVS",61)

"BLD",3463,"KRN",9.8,"NM","B","MAGXIDXU",62)

"BLD",3463,"KRN",19,0)
19
"BLD",3463,"KRN",19,"NM",0)
^9.68A^6^6
"BLD",3463,"KRN",19,"NM",1,0)
MAG DICOM QUERY RETRIEVE^^0
"BLD",3463,"KRN",19,"NM",2,0)
MAGD DICOM MENU^^2
"BLD",3463,"KRN",19,"NM",3,0)
MAGD REMOVE GATEWAY FAILED^^0
"BLD",3463,"KRN",19,"NM",4,0)
MAGD REMOVE GATEWAY XMIT^^0
"BLD",3463,"KRN",19,"NM",5,0)
MAGD RENAME GATEWAY FAILED^^0
"BLD",3463,"KRN",19,"NM",6,0)
MAGD RENAME GATEWAY XMIT^^0
"BLD",3463,"KRN",19,"NM","B","MAG DICOM QUERY RETRIEVE",1)

"BLD",3463,"KRN",19,"NM","B","MAGD DICOM MENU",2)

"BLD",3463,"KRN",19,"NM","B","MAGD REMOVE GATEWAY FAILED",3)

"BLD",3463,"KRN",19,"NM","B","MAGD REMOVE GATEWAY XMIT",4)

"BLD",3463,"KRN",19,"NM","B","MAGD RENAME GATEWAY FAILED",5)

"BLD",3463,"KRN",19,"NM","B","MAGD RENAME GATEWAY XMIT",6)

"BLD",3463,"KRN",19.1,0)
19.1
"BLD",3463,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",3463,"KRN",101,0)
101
"BLD",3463,"KRN",101,"NM",0)
^9.68A^^
"BLD",3463,"KRN",409.61,0)
409.61
"BLD",3463,"KRN",771,0)
771
"BLD",3463,"KRN",771,"NM",0)
^9.68A^^
"BLD",3463,"KRN",870,0)
870
"BLD",3463,"KRN",870,"NM",0)
^9.68A^^
"BLD",3463,"KRN",8989.51,0)
8989.51
"BLD",3463,"KRN",8989.52,0)
8989.52
"BLD",3463,"KRN",8994,0)
8994
"BLD",3463,"KRN",8994,"NM",0)
^9.68A^12^12
"BLD",3463,"KRN",8994,"NM",1,0)
MAG DICOM CHECK AE TITLE^^0
"BLD",3463,"KRN",8994,"NM",2,0)
MAG DICOM CHECK MACHINE ID^^1
"BLD",3463,"KRN",8994,"NM",3,0)
MAG DICOM GET GATEWAY INFO^^0
"BLD",3463,"KRN",8994,"NM",4,0)
MAG DICOM GET MACHINE ID^^0
"BLD",3463,"KRN",8994,"NM",5,0)
MAG DICOM GET UID ROOT^^0
"BLD",3463,"KRN",8994,"NM",6,0)
MAG DICOM GET UID TABLE^^0
"BLD",3463,"KRN",8994,"NM",7,0)
MAG DICOM IMAGE AUDIT GET^^0
"BLD",3463,"KRN",8994,"NM",8,0)
MAG DICOM STORE GATEWAY INFO^^0
"BLD",3463,"KRN",8994,"NM",9,0)
MAG DICOM UPDATE MACHINE ID^^1
"BLD",3463,"KRN",8994,"NM",10,0)
MAG DICOM VISTA AE TITLE^^0
"BLD",3463,"KRN",8994,"NM",11,0)
MAG GET DICOM XMIT ORIGIN^^0
"BLD",3463,"KRN",8994,"NM",12,0)
MAG IMAGE CURRENT INFO^^0
"BLD",3463,"KRN",8994,"NM","B","MAG DICOM CHECK AE TITLE",1)

"BLD",3463,"KRN",8994,"NM","B","MAG DICOM CHECK MACHINE ID",2)

"BLD",3463,"KRN",8994,"NM","B","MAG DICOM GET GATEWAY INFO",3)

"BLD",3463,"KRN",8994,"NM","B","MAG DICOM GET MACHINE ID",4)

"BLD",3463,"KRN",8994,"NM","B","MAG DICOM GET UID ROOT",5)

"BLD",3463,"KRN",8994,"NM","B","MAG DICOM GET UID TABLE",6)

"BLD",3463,"KRN",8994,"NM","B","MAG DICOM IMAGE AUDIT GET",7)

"BLD",3463,"KRN",8994,"NM","B","MAG DICOM STORE GATEWAY INFO",8)

"BLD",3463,"KRN",8994,"NM","B","MAG DICOM UPDATE MACHINE ID",9)

"BLD",3463,"KRN",8994,"NM","B","MAG DICOM VISTA AE TITLE",10)

"BLD",3463,"KRN",8994,"NM","B","MAG GET DICOM XMIT ORIGIN",11)

"BLD",3463,"KRN",8994,"NM","B","MAG IMAGE CURRENT INFO",12)

"BLD",3463,"KRN","B",.4,.4)

"BLD",3463,"KRN","B",.401,.401)

"BLD",3463,"KRN","B",.402,.402)

"BLD",3463,"KRN","B",.403,.403)

"BLD",3463,"KRN","B",.5,.5)

"BLD",3463,"KRN","B",.84,.84)

"BLD",3463,"KRN","B",3.6,3.6)

"BLD",3463,"KRN","B",3.8,3.8)

"BLD",3463,"KRN","B",9.2,9.2)

"BLD",3463,"KRN","B",9.8,9.8)

"BLD",3463,"KRN","B",19,19)

"BLD",3463,"KRN","B",19.1,19.1)

"BLD",3463,"KRN","B",101,101)

"BLD",3463,"KRN","B",409.61,409.61)

"BLD",3463,"KRN","B",771,771)

"BLD",3463,"KRN","B",870,870)

"BLD",3463,"KRN","B",8989.51,8989.51)

"BLD",3463,"KRN","B",8989.52,8989.52)

"BLD",3463,"KRN","B",8994,8994)

"BLD",3463,"PRE")
MAGENCHK
"BLD",3463,"REQB",0)
^9.611^1^1
"BLD",3463,"REQB",1,0)
MAG*3.0*69^2
"BLD",3463,"REQB","B","MAG*3.0*69",1)

"DATA",2006.539,1,0)
1.2.840.10008.1.1^Verification SOP Class^SOP Class
"DATA",2006.539,1,1,0)
^2006.5391A^6^6
"DATA",2006.539,1,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,1,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,1,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,1,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,1,1,5,0)
DICOM Query/Retrieve^1^Accept
"DATA",2006.539,1,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,2,0)
1.2.840.10008.1.2^Implicit VR Little Endian: Default Transfer Syntax for DICOM^Transfer Syntax
"DATA",2006.539,2,1,0)
^2006.5391A^6^6
"DATA",2006.539,2,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,2,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,2,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,2,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,2,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,2,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,3,0)
1.2.840.10008.1.2.1^Explicit VR Little Endian^Transfer Syntax
"DATA",2006.539,3,1,0)
^2006.5391A^6^6
"DATA",2006.539,3,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,3,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,3,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,3,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,3,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,3,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,4,0)
1.2.840.10008.1.2.1.99^Deflated Explicit VR Little Endian^Transfer Syntax
"DATA",2006.539,4,1,0)
^2006.5391A^6^6
"DATA",2006.539,4,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,4,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,4,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,4,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,4,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,4,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,5,0)
1.2.840.10008.1.2.2^Explicit VR Big Endian^Transfer Syntax
"DATA",2006.539,5,1,0)
^2006.5391A^6^6
"DATA",2006.539,5,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,5,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,5,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,5,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,5,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,5,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,6,0)
1.2.840.10008.1.2.4.100^MPEG2 Main Profile @ Main Level^Transfer Syntax
"DATA",2006.539,6,1,0)
^2006.5391A^6^6
"DATA",2006.539,6,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,6,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,6,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,6,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,6,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,6,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,7,0)
1.2.840.10008.1.2.4.50^JPEG Baseline (Process 1): Default Transfer Syntax for Lossy JPEG 8 Bit Image Compression^Transfer Syntax
"DATA",2006.539,7,1,0)
^2006.5391A^6^6
"DATA",2006.539,7,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,7,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,7,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,7,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,7,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,7,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,8,0)
1.2.840.10008.1.2.4.51^JPEG Extended (Process 2 & 4): Default Transfer Syntax for Lossy JPEG 12 Bit Image Compression (Process 4 only)^Transfer Syntax
"DATA",2006.539,8,1,0)
^2006.5391A^6^6
"DATA",2006.539,8,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,8,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,8,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,8,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,8,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,8,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,9,0)
1.2.840.10008.1.2.4.52^JPEG Extended (Process 3 & 5) (Retired)^Transfer Syntax
"DATA",2006.539,9,1,0)
^2006.5391A^6^6
"DATA",2006.539,9,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,9,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,9,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,9,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,9,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,9,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,10,0)
1.2.840.10008.1.2.4.53^JPEG Spectral Selection, Non-Hierarchical (Process 6 & 8) (Retired)^Transfer Syntax
"DATA",2006.539,10,1,0)
^2006.5391A^6^6
"DATA",2006.539,10,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,10,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,10,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,10,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,10,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,10,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,11,0)
1.2.840.10008.1.2.4.54^JPEG Spectral Selection, Non-Hierarchical (Process 7 & 9) (Retired)^Transfer Syntax
"DATA",2006.539,11,1,0)
^2006.5391A^6^6
"DATA",2006.539,11,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,11,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,11,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,11,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,11,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,11,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,12,0)
1.2.840.10008.1.2.4.55^JPEG Full Progression, Non-Hierarchical (Process 10 & 12) (Retired)^Transfer Syntax
"DATA",2006.539,12,1,0)
^2006.5391A^6^6
"DATA",2006.539,12,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,12,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,12,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,12,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,12,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,12,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,13,0)
1.2.840.10008.1.2.4.56^JPEG Full Progression, Non-Hierarchical (Process 11 & 13) (Retired)^Transfer Syntax
"DATA",2006.539,13,1,0)
^2006.5391A^6^6
"DATA",2006.539,13,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,13,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,13,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,13,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,13,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,13,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,14,0)
1.2.840.10008.1.2.4.57^JPEG Lossless, Non-Hierarchical (Process 14)^Transfer Syntax
"DATA",2006.539,14,1,0)
^2006.5391A^6^6
"DATA",2006.539,14,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,14,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,14,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,14,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,14,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,14,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,15,0)
1.2.840.10008.1.2.4.58^JPEG Lossless, Non-Hierarchical (Process 15) (Retired)^Transfer Syntax
"DATA",2006.539,15,1,0)
^2006.5391A^6^6
"DATA",2006.539,15,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,15,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,15,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,15,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,15,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,15,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,16,0)
1.2.840.10008.1.2.4.59^JPEG Extended, Hierarchical (Process 16 & 18) (Retired)^Transfer Syntax
"DATA",2006.539,16,1,0)
^2006.5391A^6^6
"DATA",2006.539,16,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,16,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,16,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,16,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,16,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,16,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,17,0)
1.2.840.10008.1.2.4.60^JPEG Extended, Hierarchical (Process 17 & 19) (Retired)^Transfer Syntax
"DATA",2006.539,17,1,0)
^2006.5391A^6^6
"DATA",2006.539,17,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,17,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,17,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,17,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,17,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,17,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,18,0)
1.2.840.10008.1.2.4.61^JPEG Spectral Selection, Hierarchical (Process 20 & 22) (Retired)^Transfer Syntax
"DATA",2006.539,18,1,0)
^2006.5391A^6^6
"DATA",2006.539,18,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,18,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,18,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,18,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,18,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,18,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,19,0)
1.2.840.10008.1.2.4.62^JPEG Spectral Selection, Hierarchical (Process 21 & 23) (Retired)^Transfer Syntax
"DATA",2006.539,19,1,0)
^2006.5391A^6^6
"DATA",2006.539,19,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,19,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,19,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,19,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,19,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,19,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,20,0)
1.2.840.10008.1.2.4.63^JPEG Full Progression, Hierarchical (Process 24 & 26) (Retired)^Transfer Syntax
"DATA",2006.539,20,1,0)
^2006.5391A^6^6
"DATA",2006.539,20,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,20,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,20,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,20,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,20,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,20,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,21,0)
1.2.840.10008.1.2.4.64^JPEG Full Progression, Hierarchical (Process 25 & 27) (Retired)^Transfer Syntax
"DATA",2006.539,21,1,0)
^2006.5391A^6^6
"DATA",2006.539,21,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,21,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,21,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,21,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,21,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,21,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,22,0)
1.2.840.10008.1.2.4.65^JPEG Lossless, Hierarchical (Process 28) (Retired)^Transfer Syntax
"DATA",2006.539,22,1,0)
^2006.5391A^6^6
"DATA",2006.539,22,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,22,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,22,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,22,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,22,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,22,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,23,0)
1.2.840.10008.1.2.4.66^JPEG Lossless, Hierarchical (Process 29) (Retired)^Transfer Syntax
"DATA",2006.539,23,1,0)
^2006.5391A^6^6
"DATA",2006.539,23,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,23,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,23,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,23,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,23,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,23,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,24,0)
1.2.840.10008.1.2.4.70^JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1]): Default Transfer Syntax for Lossless JPEG Image Compression^Transfer Syntax
"DATA",2006.539,24,1,0)
^2006.5391A^6^6
"DATA",2006.539,24,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,24,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,24,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,24,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,24,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,24,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,25,0)
1.2.840.10008.1.2.4.80^JPEG-LS Lossless Image Compression^Transfer Syntax
"DATA",2006.539,25,1,0)
^2006.5391A^6^6
"DATA",2006.539,25,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,25,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,25,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,25,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,25,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,25,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,26,0)
1.2.840.10008.1.2.4.81^JPEG-LS Lossy (Near-Lossless) Image Compression^Transfer Syntax
"DATA",2006.539,26,1,0)
^2006.5391A^6^6
"DATA",2006.539,26,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,26,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,26,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,26,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,26,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,26,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,27,0)
1.2.840.10008.1.2.4.90^JPEG 2000 Image Compression (Lossless Only)^Transfer Syntax
"DATA",2006.539,27,1,0)
^2006.5391A^6^6
"DATA",2006.539,27,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,27,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,27,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,27,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,27,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,27,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,28,0)
1.2.840.10008.1.2.4.91^JPEG 2000 Image Compression^Transfer Syntax
"DATA",2006.539,28,1,0)
^2006.5391A^6^6
"DATA",2006.539,28,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,28,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,28,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,28,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,28,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,28,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,29,0)
1.2.840.10008.1.2.4.92^JPEG 2000 Part 2 Multi-component  Image Compression (Lossless Only)^Transfer Syntax
"DATA",2006.539,29,1,0)
^2006.5391A^6^6
"DATA",2006.539,29,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,29,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,29,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,29,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,29,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,29,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,30,0)
1.2.840.10008.1.2.4.93^JPEG 2000 Part 2 Multi-component  Image Compression^Transfer Syntax
"DATA",2006.539,30,1,0)
^2006.5391A^6^6
"DATA",2006.539,30,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,30,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,30,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,30,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,30,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,30,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,31,0)
1.2.840.10008.1.2.4.94^JPIP Referenced^Transfer Syntax
"DATA",2006.539,31,1,0)
^2006.5391A^6^6
"DATA",2006.539,31,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,31,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,31,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,31,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,31,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,31,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,32,0)
1.2.840.10008.1.2.4.95^JPIP Referenced Deflate^Transfer Syntax
"DATA",2006.539,32,1,0)
^2006.5391A^6^6
"DATA",2006.539,32,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,32,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,32,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,32,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,32,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,32,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,33,0)
1.2.840.10008.1.2.5^RLE Lossless^Transfer Syntax
"DATA",2006.539,33,1,0)
^2006.5391A^6^6
"DATA",2006.539,33,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,33,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,33,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,33,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,33,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,33,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,34,0)
1.2.840.10008.1.2.6.1^RFC 2557 MIME encapsulation^Transfer Syntax
"DATA",2006.539,34,1,0)
^2006.5391A^6^6
"DATA",2006.539,34,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,34,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,34,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,34,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,34,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,34,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,35,0)
1.2.840.10008.1.20.1^Storage Commitment Push Model SOP Class^SOP Class
"DATA",2006.539,35,1,0)
^2006.5391A^6^6
"DATA",2006.539,35,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,35,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,35,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,35,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,35,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,35,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,36,0)
1.2.840.10008.1.20.1.1^Storage Commitment Push Model SOP Instance^Well-known SOP Instance
"DATA",2006.539,36,1,0)
^2006.5391A^6^6
"DATA",2006.539,36,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,36,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,36,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,36,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,36,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,36,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,37,0)
1.2.840.10008.1.20.2^Storage Commitment Pull Model SOP Class (Retired)^SOP Class
"DATA",2006.539,37,1,0)
^2006.5391A^6^6
"DATA",2006.539,37,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,37,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,37,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,37,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,37,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,37,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,38,0)
1.2.840.10008.1.20.2.1^Storage Commitment Pull Model SOP Instance (Retired)^Well-known SOP Instance
"DATA",2006.539,38,1,0)
^2006.5391A^6^6
"DATA",2006.539,38,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,38,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,38,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,38,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,38,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,38,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,39,0)
1.2.840.10008.1.3.10^Media Storage Directory Storage^SOP Class
"DATA",2006.539,39,1,0)
^2006.5391A^6^6
"DATA",2006.539,39,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,39,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,39,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,39,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,39,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,39,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,40,0)
1.2.840.10008.1.4.1.1^Talairach Brain Atlas Frame of Reference^Well-known frame of reference
"DATA",2006.539,40,1,0)
^2006.5391A^6^6
"DATA",2006.539,40,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,40,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,40,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,40,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,40,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,40,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,41,0)
1.2.840.10008.1.4.1.10^SPM2 GRAY Frame of Reference^Well-known frame of reference
"DATA",2006.539,41,1,0)
^2006.5391A^6^6
"DATA",2006.539,41,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,41,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,41,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,41,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,41,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,41,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,42,0)
1.2.840.10008.1.4.1.11^SPM2 WHITE Frame of Reference^Well-known frame of reference
"DATA",2006.539,42,1,0)
^2006.5391A^6^6
"DATA",2006.539,42,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,42,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,42,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,42,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,42,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,42,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,43,0)
1.2.840.10008.1.4.1.12^SPM2 CSF Frame of Reference^Well-known frame of reference
"DATA",2006.539,43,1,0)
^2006.5391A^6^6
"DATA",2006.539,43,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,43,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,43,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,43,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,43,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,43,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,44,0)
1.2.840.10008.1.4.1.13^SPM2 BRAINMASK Frame of Reference^Well-known frame of reference
"DATA",2006.539,44,1,0)
^2006.5391A^6^6
"DATA",2006.539,44,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,44,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,44,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,44,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,44,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,44,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,45,0)
1.2.840.10008.1.4.1.14^SPM2 AVG305T1 Frame of Reference^Well-known frame of reference
"DATA",2006.539,45,1,0)
^2006.5391A^6^6
"DATA",2006.539,45,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,45,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,45,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,45,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,45,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,45,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,46,0)
1.2.840.10008.1.4.1.15^SPM2 AVG152T1 Frame of Reference^Well-known frame of reference
"DATA",2006.539,46,1,0)
^2006.5391A^6^6
"DATA",2006.539,46,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,46,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,46,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,46,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,46,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,46,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,47,0)
1.2.840.10008.1.4.1.16^SPM2 AVG152T2 Frame of Reference^Well-known frame of reference
"DATA",2006.539,47,1,0)
^2006.5391A^6^6
"DATA",2006.539,47,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,47,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,47,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,47,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,47,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,47,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,48,0)
1.2.840.10008.1.4.1.17^SPM2 AVG152PD Frame of Reference^Well-known frame of reference
"DATA",2006.539,48,1,0)
^2006.5391A^6^6
"DATA",2006.539,48,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,48,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,48,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,48,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,48,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,48,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,49,0)
1.2.840.10008.1.4.1.18^SPM2 SINGLESUBJT1 Frame of Reference^Well-known frame of reference
"DATA",2006.539,49,1,0)
^2006.5391A^6^6
"DATA",2006.539,49,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,49,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,49,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,49,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,49,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,49,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,50,0)
1.2.840.10008.1.4.1.2^SPM2 T1 Frame of Reference^Well-known frame of reference
"DATA",2006.539,50,1,0)
^2006.5391A^6^6
"DATA",2006.539,50,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,50,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,50,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,50,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,50,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,50,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,51,0)
1.2.840.10008.1.4.1.3^SPM2 T2 Frame of Reference^Well-known frame of reference
"DATA",2006.539,51,1,0)
^2006.5391A^6^6
"DATA",2006.539,51,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,51,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,51,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,51,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,51,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,51,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,52,0)
1.2.840.10008.1.4.1.4^SPM2 PD Frame of Reference^Well-known frame of reference
"DATA",2006.539,52,1,0)
^2006.5391A^6^6
"DATA",2006.539,52,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,52,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,52,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,52,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,52,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,52,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,53,0)
1.2.840.10008.1.4.1.5^SPM2 EPI Frame of Reference^Well-known frame of reference
"DATA",2006.539,53,1,0)
^2006.5391A^6^6
"DATA",2006.539,53,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,53,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,53,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,53,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,53,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,53,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,54,0)
1.2.840.10008.1.4.1.6^SPM2 FIL T1 Frame of Reference^Well-known frame of reference
"DATA",2006.539,54,1,0)
^2006.5391A^6^6
"DATA",2006.539,54,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,54,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,54,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,54,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,54,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,54,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,55,0)
1.2.840.10008.1.4.1.7^SPM2 PET Frame of Reference^Well-known frame of reference
"DATA",2006.539,55,1,0)
^2006.5391A^6^6
"DATA",2006.539,55,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,55,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,55,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,55,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,55,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,55,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,56,0)
1.2.840.10008.1.4.1.8^SPM2 TRANSM Frame of Reference^Well-known frame of reference
"DATA",2006.539,56,1,0)
^2006.5391A^6^6
"DATA",2006.539,56,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,56,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,56,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,56,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,56,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,56,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,57,0)
1.2.840.10008.1.4.1.9^SPM2 SPECT Frame of Reference^Well-known frame of reference
"DATA",2006.539,57,1,0)
^2006.5391A^6^6
"DATA",2006.539,57,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,57,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,57,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,57,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,57,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,57,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,58,0)
1.2.840.10008.1.4.2.1^ICBM 452 T1 Frame of Reference^Well-known frame of reference
"DATA",2006.539,58,1,0)
^2006.5391A^6^6
"DATA",2006.539,58,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,58,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,58,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,58,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,58,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,58,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,59,0)
1.2.840.10008.1.4.2.2^ICBM Single Subject MRI Frame of Reference^Well-known frame of reference
"DATA",2006.539,59,1,0)
^2006.5391A^6^6
"DATA",2006.539,59,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,59,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,59,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,59,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,59,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,59,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,60,0)
1.2.840.10008.1.40^Procedural Event Logging SOP Class^SOP Class
"DATA",2006.539,60,1,0)
^2006.5391A^6^6
"DATA",2006.539,60,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,60,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,60,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,60,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,60,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,60,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,61,0)
1.2.840.10008.1.40.1^Procedural Event Logging SOP Instance^Well-known SOP Instance
"DATA",2006.539,61,1,0)
^2006.5391A^6^6
"DATA",2006.539,61,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,61,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,61,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,61,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,61,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,61,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,62,0)
1.2.840.10008.1.9^Basic Study Content Notification SOP Class (Retired)^SOP Class
"DATA",2006.539,62,1,0)
^2006.5391A^6^6
"DATA",2006.539,62,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,62,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,62,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,62,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,62,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,62,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,63,0)
1.2.840.10008.15.0.3.1^dicomDeviceName^LDAP OID
"DATA",2006.539,63,1,0)
^2006.5391A^9^9
"DATA",2006.539,63,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,63,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,63,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,63,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,63,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,63,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,63,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,63,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,63,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,64,0)
1.2.840.10008.15.0.3.10^dicomAssociationInitiator^LDAP OID
"DATA",2006.539,64,1,0)
^2006.5391A^9^9
"DATA",2006.539,64,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,64,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,64,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,64,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,64,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,64,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,64,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,64,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,64,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,65,0)
1.2.840.10008.15.0.3.11^dicomAssociationAcceptor^LDAP OID
"DATA",2006.539,65,1,0)
^2006.5391A^9^9
"DATA",2006.539,65,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,65,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,65,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,65,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,65,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,65,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,65,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,65,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,65,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,66,0)
1.2.840.10008.15.0.3.12^dicomHostname^LDAP OID
"DATA",2006.539,66,1,0)
^2006.5391A^9^9
"DATA",2006.539,66,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,66,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,66,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,66,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,66,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,66,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,66,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,66,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,66,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,67,0)
1.2.840.10008.15.0.3.13^dicomPort^LDAP OID
"DATA",2006.539,67,1,0)
^2006.5391A^9^9
"DATA",2006.539,67,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,67,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,67,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,67,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,67,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,67,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,67,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,67,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,67,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,68,0)
1.2.840.10008.15.0.3.14^dicomSOPClass^LDAP OID
"DATA",2006.539,68,1,0)
^2006.5391A^9^9
"DATA",2006.539,68,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,68,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,68,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,68,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,68,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,68,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,68,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,68,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,68,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,69,0)
1.2.840.10008.15.0.3.15^dicomTransferRole^LDAP OID
"DATA",2006.539,69,1,0)
^2006.5391A^9^9
"DATA",2006.539,69,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,69,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,69,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,69,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,69,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,69,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,69,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,69,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,69,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,70,0)
1.2.840.10008.15.0.3.16^dicomTransferSyntax^LDAP OID
"DATA",2006.539,70,1,0)
^2006.5391A^9^9
"DATA",2006.539,70,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,70,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,70,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,70,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,70,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,70,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,70,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,70,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,70,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,71,0)
1.2.840.10008.15.0.3.17^dicomPrimaryDeviceType^LDAP OID
"DATA",2006.539,71,1,0)
^2006.5391A^9^9
"DATA",2006.539,71,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,71,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,71,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,71,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,71,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,71,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,71,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,71,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,71,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,72,0)
1.2.840.10008.15.0.3.18^dicomRelatedDeviceReference^LDAP OID
"DATA",2006.539,72,1,0)
^2006.5391A^9^9
"DATA",2006.539,72,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,72,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,72,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,72,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,72,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,72,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,72,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,72,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,72,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,73,0)
1.2.840.10008.15.0.3.19^dicomPreferredCalledAETitle^LDAP OID
"DATA",2006.539,73,1,0)
^2006.5391A^9^9
"DATA",2006.539,73,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,73,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,73,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,73,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,73,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,73,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,73,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,73,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,73,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,74,0)
1.2.840.10008.15.0.3.2^dicomDescription^LDAP OID
"DATA",2006.539,74,1,0)
^2006.5391A^9^9
"DATA",2006.539,74,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,74,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,74,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,74,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,74,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,74,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,74,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,74,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,74,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,75,0)
1.2.840.10008.15.0.3.20^dicomTLSCyphersuite^LDAP OID
"DATA",2006.539,75,1,0)
^2006.5391A^9^9
"DATA",2006.539,75,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,75,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,75,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,75,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,75,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,75,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,75,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,75,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,75,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,76,0)
1.2.840.10008.15.0.3.21^dicomAuthorizedNodeCertificateReference^LDAP OID
"DATA",2006.539,76,1,0)
^2006.5391A^9^9
"DATA",2006.539,76,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,76,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,76,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,76,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,76,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,76,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,76,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,76,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,76,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,77,0)
1.2.840.10008.15.0.3.22^dicomThisNodeCertificateReference^LDAP OID
"DATA",2006.539,77,1,0)
^2006.5391A^9^9
"DATA",2006.539,77,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,77,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,77,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,77,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,77,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,77,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,77,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,77,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,77,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,78,0)
1.2.840.10008.15.0.3.23^dicomInstalled^LDAP OID
"DATA",2006.539,78,1,0)
^2006.5391A^9^9
"DATA",2006.539,78,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,78,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,78,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,78,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,78,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,78,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,78,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,78,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,78,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,79,0)
1.2.840.10008.15.0.3.24^dicomStationName^LDAP OID
"DATA",2006.539,79,1,0)
^2006.5391A^9^9
"DATA",2006.539,79,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,79,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,79,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,79,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,79,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,79,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,79,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,79,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,79,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,80,0)
1.2.840.10008.15.0.3.25^dicomDeviceSerialNumber^LDAP OID
"DATA",2006.539,80,1,0)
^2006.5391A^9^9
"DATA",2006.539,80,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,80,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,80,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,80,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,80,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,80,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,80,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,80,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,80,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,81,0)
1.2.840.10008.15.0.3.26^dicomInstitutionName^LDAP OID
"DATA",2006.539,81,1,0)
^2006.5391A^9^9
"DATA",2006.539,81,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,81,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,81,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,81,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,81,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,81,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,81,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,81,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,81,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,82,0)
1.2.840.10008.15.0.3.27^dicomInstitutionAddress^LDAP OID
"DATA",2006.539,82,1,0)
^2006.5391A^9^9
"DATA",2006.539,82,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,82,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,82,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,82,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,82,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,82,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,82,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,82,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,82,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,83,0)
1.2.840.10008.15.0.3.28^dicomInstitutionDepartmentName^LDAP OID
"DATA",2006.539,83,1,0)
^2006.5391A^9^9
"DATA",2006.539,83,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,83,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,83,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,83,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,83,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,83,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,83,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,83,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,83,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,84,0)
1.2.840.10008.15.0.3.29^dicomIssuerOfPatientID^LDAP OID
"DATA",2006.539,84,1,0)
^2006.5391A^9^9
"DATA",2006.539,84,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,84,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,84,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,84,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,84,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,84,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,84,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,84,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,84,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,85,0)
1.2.840.10008.15.0.3.3^dicomManufacturer^LDAP OID
"DATA",2006.539,85,1,0)
^2006.5391A^9^9
"DATA",2006.539,85,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,85,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,85,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,85,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,85,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,85,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,85,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,85,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,85,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,86,0)
1.2.840.10008.15.0.3.30^dicomPreferredCallingAETitle^LDAP OID
"DATA",2006.539,86,1,0)
^2006.5391A^9^9
"DATA",2006.539,86,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,86,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,86,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,86,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,86,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,86,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,86,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,86,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,86,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,87,0)
1.2.840.10008.15.0.3.31^dicomSupportedCharacterSet^LDAP OID
"DATA",2006.539,87,1,0)
^2006.5391A^9^9
"DATA",2006.539,87,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,87,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,87,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,87,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,87,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,87,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,87,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,87,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,87,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,88,0)
1.2.840.10008.15.0.3.4^dicomManufacturerModelName^LDAP OID
"DATA",2006.539,88,1,0)
^2006.5391A^9^9
"DATA",2006.539,88,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,88,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,88,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,88,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,88,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,88,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,88,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,88,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,88,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,89,0)
1.2.840.10008.15.0.3.5^dicomSoftwareVersion^LDAP OID
"DATA",2006.539,89,1,0)
^2006.5391A^9^9
"DATA",2006.539,89,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,89,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,89,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,89,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,89,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,89,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,89,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,89,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,89,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,90,0)
1.2.840.10008.15.0.3.6^dicomVendorData^LDAP OID
"DATA",2006.539,90,1,0)
^2006.5391A^9^9
"DATA",2006.539,90,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,90,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,90,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,90,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,90,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,90,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,90,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,90,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,90,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,91,0)
1.2.840.10008.15.0.3.7^dicomAETitle^LDAP OID
"DATA",2006.539,91,1,0)
^2006.5391A^9^9
"DATA",2006.539,91,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,91,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,91,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,91,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,91,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,91,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,91,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,91,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,91,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,92,0)
1.2.840.10008.15.0.3.8^dicomNetworkConnectionReference^LDAP OID
"DATA",2006.539,92,1,0)
^2006.5391A^9^9
"DATA",2006.539,92,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,92,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,92,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,92,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,92,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,92,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,92,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,92,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,92,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,93,0)
1.2.840.10008.15.0.3.9^dicomApplicationCluster^LDAP OID
"DATA",2006.539,93,1,0)
^2006.5391A^9^9
"DATA",2006.539,93,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,93,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,93,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,93,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,93,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,93,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,93,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,93,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,93,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,94,0)
1.2.840.10008.15.0.4.1^dicomConfigurationRoot^LDAP OID
"DATA",2006.539,94,1,0)
^2006.5391A^9^9
"DATA",2006.539,94,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,94,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,94,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,94,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,94,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,94,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,94,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,94,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,94,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,95,0)
1.2.840.10008.15.0.4.2^dicomDevicesRoot^LDAP OID
"DATA",2006.539,95,1,0)
^2006.5391A^9^9
"DATA",2006.539,95,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,95,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,95,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,95,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,95,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,95,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,95,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,95,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,95,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,96,0)
1.2.840.10008.15.0.4.3^dicomUniqueAETitlesRegistryRoot^LDAP OID
"DATA",2006.539,96,1,0)
^2006.5391A^9^9
"DATA",2006.539,96,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,96,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,96,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,96,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,96,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,96,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,96,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,96,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,96,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,97,0)
1.2.840.10008.15.0.4.4^dicomDevice^LDAP OID
"DATA",2006.539,97,1,0)
^2006.5391A^9^9
"DATA",2006.539,97,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,97,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,97,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,97,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,97,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,97,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,97,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,97,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,97,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,98,0)
1.2.840.10008.15.0.4.5^dicomNetworkAE^LDAP OID
"DATA",2006.539,98,1,0)
^2006.5391A^9^9
"DATA",2006.539,98,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,98,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,98,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,98,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,98,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,98,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,98,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,98,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,98,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,99,0)
1.2.840.10008.15.0.4.6^dicomNetworkConnection^LDAP OID
"DATA",2006.539,99,1,0)
^2006.5391A^9^9
"DATA",2006.539,99,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,99,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,99,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,99,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,99,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,99,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,99,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,99,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,99,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,100,0)
1.2.840.10008.15.0.4.7^dicomUniqueAETitle^LDAP OID
"DATA",2006.539,100,1,0)
^2006.5391A^9^9
"DATA",2006.539,100,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,100,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,100,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,100,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,100,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,100,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,100,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,100,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,100,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,101,0)
1.2.840.10008.15.0.4.8^dicomTransferCapability^LDAP OID
"DATA",2006.539,101,1,0)
^2006.5391A^9^9
"DATA",2006.539,101,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,101,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,101,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,101,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,101,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,101,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,101,1,7,0)
ViX^0^Not Applicable
"DATA",2006.539,101,1,8,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,101,1,9,0)
Reconstruct^0^Not Applicable
"DATA",2006.539,102,0)
1.2.840.10008.2.16.4^DICOM Controlled Terminology^Coding Scheme
"DATA",2006.539,102,1,0)
^2006.5391A^7^7
"DATA",2006.539,102,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,102,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,102,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,102,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,102,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,102,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,102,1,7,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,103,0)
1.2.840.10008.2.6.1^DICOM UID Registry^DICOM UIDs as a Coding Scheme
"DATA",2006.539,103,1,0)
^2006.5391A^6^6
"DATA",2006.539,103,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,103,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,103,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,103,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,103,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,103,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,104,0)
1.2.840.10008.3.1.1.1^DICOM Application Context Name^Application Context Name
"DATA",2006.539,104,1,0)
^2006.5391A^7^7
"DATA",2006.539,104,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,104,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,104,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,104,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,104,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,104,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,104,1,7,0)
Create Abstract^0^Not Applicable
"DATA",2006.539,105,0)
1.2.840.10008.3.1.2.1.1^Detached Patient Management SOP Class (Retired)^SOP Class^Management
"DATA",2006.539,105,1,0)
^2006.5391A^6^6
"DATA",2006.539,105,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,105,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,105,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,105,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,105,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,105,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,106,0)
1.2.840.10008.3.1.2.1.4^Detached Patient Management Meta SOP Class (Retired)^Meta SOP Class
"DATA",2006.539,106,1,0)
^2006.5391A^6^6
"DATA",2006.539,106,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,106,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,106,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,106,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,106,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,106,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,107,0)
1.2.840.10008.3.1.2.2.1^Detached Visit Management SOP Class (Retired)^SOP Class^Management
"DATA",2006.539,107,1,0)
^2006.5391A^6^6
"DATA",2006.539,107,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,107,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,107,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,107,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,107,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,107,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,108,0)
1.2.840.10008.3.1.2.3.1^Detached Study Management SOP Class (Retired)^SOP Class^Management
"DATA",2006.539,108,1,0)
^2006.5391A^6^6
"DATA",2006.539,108,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,108,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,108,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,108,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,108,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,108,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,109,0)
1.2.840.10008.3.1.2.3.2^Study Component Management SOP Class (Retired)^SOP Class^Management
"DATA",2006.539,109,1,0)
^2006.5391A^6^6
"DATA",2006.539,109,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,109,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,109,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,109,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,109,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,109,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,110,0)
1.2.840.10008.3.1.2.3.3^Modality Performed Procedure Step SOP Class^SOP Class
"DATA",2006.539,110,1,0)
^2006.5391A^6^6
"DATA",2006.539,110,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,110,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,110,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,110,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,110,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,110,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,111,0)
1.2.840.10008.3.1.2.3.4^Modality Performed Procedure Step Retrieve SOP Class^SOP Class
"DATA",2006.539,111,1,0)
^2006.5391A^6^6
"DATA",2006.539,111,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,111,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,111,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,111,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,111,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,111,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,112,0)
1.2.840.10008.3.1.2.3.5^Modality Performed Procedure Step Notification SOP Class^SOP Class
"DATA",2006.539,112,1,0)
^2006.5391A^6^6
"DATA",2006.539,112,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,112,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,112,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,112,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,112,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,112,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,113,0)
1.2.840.10008.3.1.2.5.1^Detached Results Management SOP Class (Retired)^SOP Class^Management
"DATA",2006.539,113,1,0)
^2006.5391A^6^6
"DATA",2006.539,113,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,113,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,113,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,113,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,113,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,113,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,114,0)
1.2.840.10008.3.1.2.5.4^Detached Results Management Meta SOP Class (Retired)^Meta SOP Class
"DATA",2006.539,114,1,0)
^2006.5391A^6^6
"DATA",2006.539,114,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,114,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,114,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,114,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,114,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,114,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,115,0)
1.2.840.10008.3.1.2.5.5^Detached Study Management Meta SOP Class (Retired)^Meta SOP Class
"DATA",2006.539,115,1,0)
^2006.5391A^6^6
"DATA",2006.539,115,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,115,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,115,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,115,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,115,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,115,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,116,0)
1.2.840.10008.3.1.2.6.1^Detached Interpretation Management SOP Class (Retired)^SOP Class^Management
"DATA",2006.539,116,1,0)
^2006.5391A^6^6
"DATA",2006.539,116,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,116,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,116,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,116,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,116,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,116,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,117,0)
1.2.840.10008.4.2^Storage Service Class^Service Class
"DATA",2006.539,117,1,0)
^2006.5391A^6^6
"DATA",2006.539,117,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,117,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,117,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,117,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,117,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,117,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,118,0)
1.2.840.10008.5.1.1.1^Basic Film Session SOP Class^SOP Class
"DATA",2006.539,118,1,0)
^2006.5391A^6^6
"DATA",2006.539,118,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,118,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,118,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,118,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,118,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,118,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,119,0)
1.2.840.10008.5.1.1.14^Print Job SOP Class^SOP Class
"DATA",2006.539,119,1,0)
^2006.5391A^6^6
"DATA",2006.539,119,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,119,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,119,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,119,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,119,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,119,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,120,0)
1.2.840.10008.5.1.1.15^Basic Annotation Box SOP Class^SOP Class
"DATA",2006.539,120,1,0)
^2006.5391A^6^6
"DATA",2006.539,120,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,120,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,120,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,120,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,120,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,120,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,121,0)
1.2.840.10008.5.1.1.16^Printer SOP Class^SOP Class
"DATA",2006.539,121,1,0)
^2006.5391A^6^6
"DATA",2006.539,121,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,121,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,121,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,121,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,121,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,121,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,122,0)
1.2.840.10008.5.1.1.16.376^Printer Configuration Retrieval SOP Class^SOP Class
"DATA",2006.539,122,1,0)
^2006.5391A^6^6
"DATA",2006.539,122,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,122,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,122,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,122,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,122,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,122,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,123,0)
1.2.840.10008.5.1.1.17^Printer SOP Instance^Well-known Printer SOP Instance
"DATA",2006.539,123,1,0)
^2006.5391A^6^6
"DATA",2006.539,123,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,123,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,123,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,123,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,123,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,123,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,124,0)
1.2.840.10008.5.1.1.17.376^Printer Configuration Retrieval SOP Instance^Well-known Printer SOP Instance
"DATA",2006.539,124,1,0)
^2006.5391A^6^6
"DATA",2006.539,124,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,124,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,124,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,124,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,124,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,124,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,125,0)
1.2.840.10008.5.1.1.18^Basic Color Print Management Meta SOP Class^Meta SOP Class
"DATA",2006.539,125,1,0)
^2006.5391A^6^6
"DATA",2006.539,125,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,125,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,125,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,125,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,125,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,125,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,126,0)
1.2.840.10008.5.1.1.18.1^Referenced Color Print Management Meta SOP Class (Retired)^Meta SOP Class
"DATA",2006.539,126,1,0)
^2006.5391A^6^6
"DATA",2006.539,126,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,126,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,126,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,126,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,126,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,126,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,127,0)
1.2.840.10008.5.1.1.2^Basic Film Box SOP Class^SOP Class
"DATA",2006.539,127,1,0)
^2006.5391A^6^6
"DATA",2006.539,127,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,127,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,127,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,127,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,127,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,127,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,128,0)
1.2.840.10008.5.1.1.22^VOI LUT Box SOP Class^SOP Class
"DATA",2006.539,128,1,0)
^2006.5391A^6^6
"DATA",2006.539,128,1,1,0)
Storage^2^Store
"DATA",2006.539,128,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,128,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,128,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,128,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,128,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,129,0)
1.2.840.10008.5.1.1.23^Presentation LUT SOP Class^SOP Class
"DATA",2006.539,129,1,0)
^2006.5391A^6^6
"DATA",2006.539,129,1,1,0)
Storage^2^Store
"DATA",2006.539,129,1,2,0)
Clinical Display^5^Apply
"DATA",2006.539,129,1,3,0)
VistaRad^5^Apply
"DATA",2006.539,129,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,129,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,129,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,130,0)
1.2.840.10008.5.1.1.24^Image Overlay Box SOP Class (Retired)^SOP Class
"DATA",2006.539,130,1,0)
^2006.5391A^6^6
"DATA",2006.539,130,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,130,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,130,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,130,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,130,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,130,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,131,0)
1.2.840.10008.5.1.1.24.1^Basic Print Image Overlay Box SOP Class (Retired)^SOP Class
"DATA",2006.539,131,1,0)
^2006.5391A^6^6
"DATA",2006.539,131,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,131,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,131,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,131,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,131,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,131,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,132,0)
1.2.840.10008.5.1.1.25^Print Queue SOP Instance (Retired)^Well-known Print Queue SOP Instance
"DATA",2006.539,132,1,0)
^2006.5391A^6^6
"DATA",2006.539,132,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,132,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,132,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,132,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,132,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,132,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,133,0)
1.2.840.10008.5.1.1.26^Print Queue Management SOP Class (Retired)^SOP Class^Management
"DATA",2006.539,133,1,0)
^2006.5391A^6^6
"DATA",2006.539,133,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,133,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,133,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,133,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,133,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,133,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,134,0)
1.2.840.10008.5.1.1.27^Stored Print Storage SOP Class (Retired)^SOP Class^Storage
"DATA",2006.539,134,1,0)
^2006.5391A^6^6
"DATA",2006.539,134,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,134,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,134,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,134,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,134,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,134,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,135,0)
1.2.840.10008.5.1.1.29^Hardcopy  Grayscale Image Storage SOP Class (Retired)^SOP Class^Storage
"DATA",2006.539,135,1,0)
^2006.5391A^6^6
"DATA",2006.539,135,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,135,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,135,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,135,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,135,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,135,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,136,0)
1.2.840.10008.5.1.1.30^Hardcopy Color Image Storage SOP Class (Retired)^SOP Class^Storage
"DATA",2006.539,136,1,0)
^2006.5391A^6^6
"DATA",2006.539,136,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,136,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,136,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,136,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,136,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,136,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,137,0)
1.2.840.10008.5.1.1.31^Pull Print Request SOP Class (Retired)^SOP Class
"DATA",2006.539,137,1,0)
^2006.5391A^6^6
"DATA",2006.539,137,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,137,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,137,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,137,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,137,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,137,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,138,0)
1.2.840.10008.5.1.1.32^Pull Stored Print Management Meta SOP Class (Retired)^Meta SOP Class
"DATA",2006.539,138,1,0)
^2006.5391A^6^6
"DATA",2006.539,138,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,138,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,138,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,138,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,138,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,138,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,139,0)
1.2.840.10008.5.1.1.33^Media Creation Management SOP Class UID^SOP Class^Management
"DATA",2006.539,139,1,0)
^2006.5391A^6^6
"DATA",2006.539,139,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,139,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,139,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,139,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,139,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,139,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,140,0)
1.2.840.10008.5.1.1.4^Basic Grayscale Image Box SOP Class^SOP Class
"DATA",2006.539,140,1,0)
^2006.5391A^6^6
"DATA",2006.539,140,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,140,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,140,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,140,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,140,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,140,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,141,0)
1.2.840.10008.5.1.1.4.1^Basic Color Image Box SOP Class^SOP Class
"DATA",2006.539,141,1,0)
^2006.5391A^6^6
"DATA",2006.539,141,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,141,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,141,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,141,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,141,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,141,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,142,0)
1.2.840.10008.5.1.1.4.2^Referenced Image Box SOP Class (Retired)^SOP Class
"DATA",2006.539,142,1,0)
^2006.5391A^6^6
"DATA",2006.539,142,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,142,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,142,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,142,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,142,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,142,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,143,0)
1.2.840.10008.5.1.1.9^Basic Grayscale Print Management Meta SOP Class^Meta SOP Class
"DATA",2006.539,143,1,0)
^2006.5391A^6^6
"DATA",2006.539,143,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,143,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,143,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,143,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,143,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,143,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,144,0)
1.2.840.10008.5.1.1.9.1^Referenced Grayscale Print Management Meta SOP Class (Retired)^Meta SOP Class
"DATA",2006.539,144,1,0)
^2006.5391A^6^6
"DATA",2006.539,144,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,144,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,144,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,144,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,144,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,144,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,145,0)
1.2.840.10008.5.1.4.1.1.1^Computed Radiography Image Storage^SOP Class^Storage
"DATA",2006.539,145,1,0)
^2006.5391A^7^7
"DATA",2006.539,145,1,1,0)
Storage^2^Store
"DATA",2006.539,145,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,145,1,3,0)
VistaRad^6^Display
"DATA",2006.539,145,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,145,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,145,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,145,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,146,0)
1.2.840.10008.5.1.4.1.1.1.1^Digital X-Ray Image Storage - For Presentation^SOP Class^Storage
"DATA",2006.539,146,1,0)
^2006.5391A^7^7
"DATA",2006.539,146,1,1,0)
Storage^2^Store
"DATA",2006.539,146,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,146,1,3,0)
VistaRad^6^Display
"DATA",2006.539,146,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,146,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,146,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,146,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,147,0)
1.2.840.10008.5.1.4.1.1.1.1.1^Digital X-Ray Image Storage - For Processing^SOP Class^Storage
"DATA",2006.539,147,1,0)
^2006.5391A^7^7
"DATA",2006.539,147,1,1,0)
Storage^2^Store
"DATA",2006.539,147,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,147,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,147,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,147,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,147,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,147,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,148,0)
1.2.840.10008.5.1.4.1.1.1.2^Digital Mammography X-Ray Image Storage - For Presentation^SOP Class^Storage
"DATA",2006.539,148,1,0)
^2006.5391A^7^7
"DATA",2006.539,148,1,1,0)
Storage^2^Store
"DATA",2006.539,148,1,2,0)
Clinical Display^7^Warning with display
"DATA",2006.539,148,1,3,0)
VistaRad^6^Display
"DATA",2006.539,148,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,148,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,148,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,148,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,149,0)
1.2.840.10008.5.1.4.1.1.1.2.1^Digital Mammography X-Ray Image Storage - For Processing^SOP Class^Storage
"DATA",2006.539,149,1,0)
^2006.5391A^7^7
"DATA",2006.539,149,1,1,0)
Storage^2^Store
"DATA",2006.539,149,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,149,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,149,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,149,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,149,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,149,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,150,0)
1.2.840.10008.5.1.4.1.1.1.3^Digital Intra-oral X-Ray Image Storage - For Presentation^SOP Class^Storage
"DATA",2006.539,150,1,0)
^2006.5391A^7^7
"DATA",2006.539,150,1,1,0)
Storage^2^Store
"DATA",2006.539,150,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,150,1,3,0)
VistaRad^6^Display
"DATA",2006.539,150,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,150,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,150,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,150,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,151,0)
1.2.840.10008.5.1.4.1.1.1.3.1^Digital Intra-oral X-Ray Image Storage - For Processing^SOP Class^Storage
"DATA",2006.539,151,1,0)
^2006.5391A^7^7
"DATA",2006.539,151,1,1,0)
Storage^2^Store
"DATA",2006.539,151,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,151,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,151,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,151,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,151,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,151,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,152,0)
1.2.840.10008.5.1.4.1.1.10^Standalone Modality LUT Storage (Retired)^SOP Class^Storage
"DATA",2006.539,152,1,0)
^2006.5391A^6^6
"DATA",2006.539,152,1,1,0)
Storage^2^Store
"DATA",2006.539,152,1,2,0)
Clinical Display^5^Apply
"DATA",2006.539,152,1,3,0)
VistaRad^5^Apply
"DATA",2006.539,152,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,152,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,152,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,153,0)
1.2.840.10008.5.1.4.1.1.104.1^Encapsulated PDF Storage^SOP Class^Storage
"DATA",2006.539,153,1,0)
^2006.5391A^8^7
"DATA",2006.539,153,1,1,0)
Storage^2^Store
"DATA",2006.539,153,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,153,1,3,0)
VistaRad^6^Display
"DATA",2006.539,153,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,153,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,153,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,153,1,8,0)
Create Abstract^2^Canned icon for PDF
"DATA",2006.539,154,0)
1.2.840.10008.5.1.4.1.1.11^Standalone VOI LUT Storage (Retired)^SOP Class^Storage
"DATA",2006.539,154,1,0)
^2006.5391A^6^6
"DATA",2006.539,154,1,1,0)
Storage^2^Store
"DATA",2006.539,154,1,2,0)
Clinical Display^5^Apply
"DATA",2006.539,154,1,3,0)
VistaRad^5^Apply
"DATA",2006.539,154,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,154,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,154,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,155,0)
1.2.840.10008.5.1.4.1.1.11.1^Grayscale Softcopy Presentation State Storage SOP Class^SOP Class^Storage
"DATA",2006.539,155,1,0)
^2006.5391A^6^6
"DATA",2006.539,155,1,1,0)
Storage^2^Store
"DATA",2006.539,155,1,2,0)
Clinical Display^5^Apply
"DATA",2006.539,155,1,3,0)
VistaRad^5^Apply
"DATA",2006.539,155,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,155,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,155,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,156,0)
1.2.840.10008.5.1.4.1.1.11.2^Color Softcopy Presentation State Storage SOP Class^SOP Class^Storage
"DATA",2006.539,156,1,0)
^2006.5391A^6^6
"DATA",2006.539,156,1,1,0)
Storage^2^Store
"DATA",2006.539,156,1,2,0)
Clinical Display^5^Apply
"DATA",2006.539,156,1,3,0)
VistaRad^5^Apply
"DATA",2006.539,156,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,156,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,156,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,157,0)
1.2.840.10008.5.1.4.1.1.11.3^Pseudo-Color Softcopy Presentation State Storage SOP Class^SOP Class^Storage
"DATA",2006.539,157,1,0)
^2006.5391A^6^6
"DATA",2006.539,157,1,1,0)
Storage^2^Store
"DATA",2006.539,157,1,2,0)
Clinical Display^5^Apply
"DATA",2006.539,157,1,3,0)
VistaRad^5^Apply
"DATA",2006.539,157,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,157,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,157,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,158,0)
1.2.840.10008.5.1.4.1.1.11.4^Blending Softcopy Presentation State Storage SOP Class^SOP Class^Storage
"DATA",2006.539,158,1,0)
^2006.5391A^6^6
"DATA",2006.539,158,1,1,0)
Storage^2^Store
"DATA",2006.539,158,1,2,0)
Clinical Display^5^Apply
"DATA",2006.539,158,1,3,0)
VistaRad^5^Apply
"DATA",2006.539,158,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,158,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,158,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,159,0)
1.2.840.10008.5.1.4.1.1.12.1^X-Ray Angiographic Image Storage^SOP Class^Storage
"DATA",2006.539,159,1,0)
^2006.5391A^7^7
"DATA",2006.539,159,1,1,0)
Storage^2^Store
"DATA",2006.539,159,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,159,1,3,0)
VistaRad^6^Display
"DATA",2006.539,159,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,159,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,159,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,159,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,160,0)
1.2.840.10008.5.1.4.1.1.12.1.1^Enhanced XA Image Storage^SOP Class^Storage
"DATA",2006.539,160,1,0)
^2006.5391A^6^6
"DATA",2006.539,160,1,1,0)
Storage^2^Store
"DATA",2006.539,160,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,160,1,3,0)
VistaRad^6^Display
"DATA",2006.539,160,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,160,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,160,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,161,0)
1.2.840.10008.5.1.4.1.1.12.2^X-Ray Radiofluoroscopic Image Storage^SOP Class^Storage
"DATA",2006.539,161,1,0)
^2006.5391A^7^7
"DATA",2006.539,161,1,1,0)
Storage^2^Store
"DATA",2006.539,161,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,161,1,3,0)
VistaRad^6^Display
"DATA",2006.539,161,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,161,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,161,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,161,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,162,0)
1.2.840.10008.5.1.4.1.1.12.2.1^Enhanced XRF Image Storage^SOP Class^Storage
"DATA",2006.539,162,1,0)
^2006.5391A^6^6
"DATA",2006.539,162,1,1,0)
Storage^2^Store
"DATA",2006.539,162,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,162,1,3,0)
VistaRad^6^Display
"DATA",2006.539,162,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,162,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,162,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,163,0)
1.2.840.10008.5.1.4.1.1.12.3^X-Ray Angiographic Bi-Plane Image Storage (Retired)^SOP Class^Storage
"DATA",2006.539,163,1,0)
^2006.5391A^6^6
"DATA",2006.539,163,1,1,0)
Storage^2^Store
"DATA",2006.539,163,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,163,1,3,0)
VistaRad^6^Display
"DATA",2006.539,163,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,163,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,163,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,164,0)
1.2.840.10008.5.1.4.1.1.128^Positron Emission Tomography Image Storage^SOP Class^Storage
"DATA",2006.539,164,1,0)
^2006.5391A^7^7
"DATA",2006.539,164,1,1,0)
Storage^2^Store
"DATA",2006.539,164,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,164,1,3,0)
VistaRad^6^Display
"DATA",2006.539,164,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,164,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,164,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,164,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,165,0)
1.2.840.10008.5.1.4.1.1.129^Standalone PET Curve Storage (Retired)^SOP Class^Storage
"DATA",2006.539,165,1,0)
^2006.5391A^6^6
"DATA",2006.539,165,1,1,0)
Storage^2^Store
"DATA",2006.539,165,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,165,1,3,0)
VistaRad^6^Display
"DATA",2006.539,165,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,165,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,165,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,166,0)
1.2.840.10008.5.1.4.1.1.2^CT Image Storage^SOP Class^Storage
"DATA",2006.539,166,1,0)
^2006.5391A^10^7
"DATA",2006.539,166,1,1,0)
Storage^2^Store
"DATA",2006.539,166,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,166,1,3,0)
VistaRad^6^Display
"DATA",2006.539,166,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,166,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,166,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,166,1,10,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,167,0)
1.2.840.10008.5.1.4.1.1.2.1^Enhanced CT Image Storage^SOP Class^Storage
"DATA",2006.539,167,1,0)
^2006.5391A^6^6
"DATA",2006.539,167,1,1,0)
Storage^2^Store
"DATA",2006.539,167,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,167,1,3,0)
VistaRad^6^Display
"DATA",2006.539,167,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,167,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,167,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,168,0)
1.2.840.10008.5.1.4.1.1.20^Nuclear Medicine Image Storage^SOP Class^Storage
"DATA",2006.539,168,1,0)
^2006.5391A^7^7
"DATA",2006.539,168,1,1,0)
Storage^2^Store
"DATA",2006.539,168,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,168,1,3,0)
VistaRad^6^Display
"DATA",2006.539,168,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,168,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,168,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,168,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,169,0)
1.2.840.10008.5.1.4.1.1.3^Ultrasound Multi-frame Image Storage (Retired)^SOP Class^Storage
"DATA",2006.539,169,1,0)
^2006.5391A^7^7
"DATA",2006.539,169,1,1,0)
Storage^2^Store
"DATA",2006.539,169,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,169,1,3,0)
VistaRad^6^Display
"DATA",2006.539,169,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,169,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,169,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,169,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,170,0)
1.2.840.10008.5.1.4.1.1.3.1^Ultrasound Multi-frame Image Storage^SOP Class^Storage
"DATA",2006.539,170,1,0)
^2006.5391A^7^7
"DATA",2006.539,170,1,1,0)
Storage^2^Store
"DATA",2006.539,170,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,170,1,3,0)
VistaRad^6^Display
"DATA",2006.539,170,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,170,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,170,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,170,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,171,0)
1.2.840.10008.5.1.4.1.1.4^MR Image Storage^SOP Class^Storage
"DATA",2006.539,171,1,0)
^2006.5391A^7^7
"DATA",2006.539,171,1,1,0)
Storage^2^Store
"DATA",2006.539,171,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,171,1,3,0)
VistaRad^6^Display
"DATA",2006.539,171,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,171,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,171,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,171,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,172,0)
1.2.840.10008.5.1.4.1.1.4.1^Enhanced MR Image Storage^SOP Class^Storage
"DATA",2006.539,172,1,0)
^2006.5391A^6^6
"DATA",2006.539,172,1,1,0)
Storage^2^Store
"DATA",2006.539,172,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,172,1,3,0)
VistaRad^6^Display
"DATA",2006.539,172,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,172,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,172,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,173,0)
1.2.840.10008.5.1.4.1.1.4.2^MR Spectroscopy Storage^SOP Class^Storage
"DATA",2006.539,173,1,0)
^2006.5391A^6^6
"DATA",2006.539,173,1,1,0)
Storage^2^Store
"DATA",2006.539,173,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,173,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,173,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,173,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,173,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,174,0)
1.2.840.10008.5.1.4.1.1.481.1^RT Image Storage^SOP Class^Storage
"DATA",2006.539,174,1,0)
^2006.5391A^7^7
"DATA",2006.539,174,1,1,0)
Storage^2^Store
"DATA",2006.539,174,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,174,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,174,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,174,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,174,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,174,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,175,0)
1.2.840.10008.5.1.4.1.1.481.2^RT Dose Storage^SOP Class^Storage
"DATA",2006.539,175,1,0)
^2006.5391A^6^6
"DATA",2006.539,175,1,1,0)
Storage^2^Store
"DATA",2006.539,175,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,175,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,175,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,175,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,175,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,176,0)
1.2.840.10008.5.1.4.1.1.481.3^RT Structure Set Storage^SOP Class^Storage
"DATA",2006.539,176,1,0)
^2006.5391A^6^6
"DATA",2006.539,176,1,1,0)
Storage^2^Store
"DATA",2006.539,176,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,176,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,176,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,176,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,176,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,177,0)
1.2.840.10008.5.1.4.1.1.481.4^RT Beams Treatment Record Storage^SOP Class^Storage
"DATA",2006.539,177,1,0)
^2006.5391A^6^6
"DATA",2006.539,177,1,1,0)
Storage^2^Store
"DATA",2006.539,177,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,177,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,177,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,177,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,177,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,178,0)
1.2.840.10008.5.1.4.1.1.481.5^RT Plan Storage^SOP Class^Storage
"DATA",2006.539,178,1,0)
^2006.5391A^6^6
"DATA",2006.539,178,1,1,0)
Storage^2^Store
"DATA",2006.539,178,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,178,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,178,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,178,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,178,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,179,0)
1.2.840.10008.5.1.4.1.1.481.6^RT Brachy Treatment Record Storage^SOP Class^Storage
"DATA",2006.539,179,1,0)
^2006.5391A^6^6
"DATA",2006.539,179,1,1,0)
Storage^2^Store
"DATA",2006.539,179,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,179,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,179,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,179,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,179,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,180,0)
1.2.840.10008.5.1.4.1.1.481.7^RT Treatment Summary Record Storage^SOP Class^Storage
"DATA",2006.539,180,1,0)
^2006.5391A^6^6
"DATA",2006.539,180,1,1,0)
Storage^2^Store
"DATA",2006.539,180,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,180,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,180,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,180,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,180,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,181,0)
1.2.840.10008.5.1.4.1.1.481.8^RT Ion Plan Storage^SOP Class^Storage
"DATA",2006.539,181,1,0)
^2006.5391A^6^6
"DATA",2006.539,181,1,1,0)
Storage^2^Store
"DATA",2006.539,181,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,181,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,181,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,181,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,181,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,182,0)
1.2.840.10008.5.1.4.1.1.481.9^RT Ion Beams Treatment Record Storage^SOP Class^Storage
"DATA",2006.539,182,1,0)
^2006.5391A^6^6
"DATA",2006.539,182,1,1,0)
Storage^2^Store
"DATA",2006.539,182,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,182,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,182,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,182,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,182,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,183,0)
1.2.840.10008.5.1.4.1.1.5^Nuclear Medicine Image  Storage (Retired)^SOP Class^Storage
"DATA",2006.539,183,1,0)
^2006.5391A^7^7
"DATA",2006.539,183,1,1,0)
Storage^2^Store
"DATA",2006.539,183,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,183,1,3,0)
VistaRad^6^Display
"DATA",2006.539,183,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,183,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,183,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,183,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,184,0)
1.2.840.10008.5.1.4.1.1.6^Ultrasound Image Storage (Retired)^SOP Class^Storage
"DATA",2006.539,184,1,0)
^2006.5391A^7^7
"DATA",2006.539,184,1,1,0)
Storage^2^Store
"DATA",2006.539,184,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,184,1,3,0)
VistaRad^6^Display
"DATA",2006.539,184,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,184,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,184,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,184,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,185,0)
1.2.840.10008.5.1.4.1.1.6.1^Ultrasound Image Storage^SOP Class^Storage
"DATA",2006.539,185,1,0)
^2006.5391A^7^7
"DATA",2006.539,185,1,1,0)
Storage^2^Store
"DATA",2006.539,185,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,185,1,3,0)
VistaRad^6^Display
"DATA",2006.539,185,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,185,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,185,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,185,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,186,0)
1.2.840.10008.5.1.4.1.1.66^Raw Data Storage^SOP Class^Storage
"DATA",2006.539,186,1,0)
^2006.5391A^6^6
"DATA",2006.539,186,1,1,0)
Storage^2^Store
"DATA",2006.539,186,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,186,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,186,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,186,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,186,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,187,0)
1.2.840.10008.5.1.4.1.1.66.1^Spatial Registration Storage^SOP Class^Storage
"DATA",2006.539,187,1,0)
^2006.5391A^6^6
"DATA",2006.539,187,1,1,0)
Storage^2^Store
"DATA",2006.539,187,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,187,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,187,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,187,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,187,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,188,0)
1.2.840.10008.5.1.4.1.1.66.2^Spatial Fiducials Storage^SOP Class^Storage
"DATA",2006.539,188,1,0)
^2006.5391A^6^6
"DATA",2006.539,188,1,1,0)
Storage^2^Store
"DATA",2006.539,188,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,188,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,188,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,188,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,188,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,189,0)
1.2.840.10008.5.1.4.1.1.66.3^Deformable Spatial Registration Storage^SOP Class^Storage
"DATA",2006.539,189,1,0)
^2006.5391A^6^6
"DATA",2006.539,189,1,1,0)
Storage^2^Store
"DATA",2006.539,189,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,189,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,189,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,189,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,189,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,190,0)
1.2.840.10008.5.1.4.1.1.66.4^Segmentation Storage^SOP Class^Storage
"DATA",2006.539,190,1,0)
^2006.5391A^6^6
"DATA",2006.539,190,1,1,0)
Storage^2^Store
"DATA",2006.539,190,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,190,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,190,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,190,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,190,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,191,0)
1.2.840.10008.5.1.4.1.1.67^Real World Value Mapping Storage^SOP Class^Storage
"DATA",2006.539,191,1,0)
^2006.5391A^6^6
"DATA",2006.539,191,1,1,0)
Storage^2^Store
"DATA",2006.539,191,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,191,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,191,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,191,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,191,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,192,0)
1.2.840.10008.5.1.4.1.1.7^Secondary Capture Image Storage^SOP Class^Storage
"DATA",2006.539,192,1,0)
^2006.5391A^8^8
"DATA",2006.539,192,1,1,0)
Storage^2^Store
"DATA",2006.539,192,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,192,1,3,0)
VistaRad^6^Display
"DATA",2006.539,192,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,192,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,192,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,192,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,192,1,8,0)
Process Image^2^Treat as Secondary Capture
"DATA",2006.539,193,0)
1.2.840.10008.5.1.4.1.1.7.1^Multi-frame Single Bit Secondary Capture Image Storage^SOP Class^Storage
"DATA",2006.539,193,1,0)
^2006.5391A^8^8
"DATA",2006.539,193,1,1,0)
Storage^2^Store
"DATA",2006.539,193,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,193,1,3,0)
VistaRad^6^Display
"DATA",2006.539,193,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,193,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,193,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,193,1,7,0)
Process Image^2^Treat as Secondary Capture
"DATA",2006.539,193,1,8,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,194,0)
1.2.840.10008.5.1.4.1.1.7.2^Multi-frame Grayscale Byte Secondary Capture Image Storage^SOP Class^Storage
"DATA",2006.539,194,1,0)
^2006.5391A^8^8
"DATA",2006.539,194,1,1,0)
Storage^2^Store
"DATA",2006.539,194,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,194,1,3,0)
VistaRad^6^Display
"DATA",2006.539,194,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,194,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,194,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,194,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,194,1,8,0)
Process Image^2^Treat as Secondary Capture
"DATA",2006.539,195,0)
1.2.840.10008.5.1.4.1.1.7.3^Multi-frame Grayscale Word Secondary Capture Image Storage^SOP Class^Storage
"DATA",2006.539,195,1,0)
^2006.5391A^8^8
"DATA",2006.539,195,1,1,0)
Storage^2^Store
"DATA",2006.539,195,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,195,1,3,0)
VistaRad^6^Display
"DATA",2006.539,195,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,195,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,195,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,195,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,195,1,8,0)
Process Image^2^Treat as Secondary Capture
"DATA",2006.539,196,0)
1.2.840.10008.5.1.4.1.1.7.4^Multi-frame True Color Secondary Capture Image Storage^SOP Class^Storage
"DATA",2006.539,196,1,0)
^2006.5391A^8^8
"DATA",2006.539,196,1,1,0)
Storage^2^Store
"DATA",2006.539,196,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,196,1,3,0)
VistaRad^6^Display
"DATA",2006.539,196,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,196,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,196,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,196,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,196,1,8,0)
Process Image^2^Treat as Secondary Capture
"DATA",2006.539,197,0)
1.2.840.10008.5.1.4.1.1.77.1^VL Image Storage (Retired)^SOP Class^Storage
"DATA",2006.539,197,1,0)
^2006.5391A^7^7
"DATA",2006.539,197,1,1,0)
Storage^2^Store
"DATA",2006.539,197,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,197,1,3,0)
VistaRad^6^Display
"DATA",2006.539,197,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,197,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,197,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,197,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,198,0)
1.2.840.10008.5.1.4.1.1.77.1.1^VL Endoscopic Image Storage^SOP Class^Storage
"DATA",2006.539,198,1,0)
^2006.5391A^7^7
"DATA",2006.539,198,1,1,0)
Storage^2^Store
"DATA",2006.539,198,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,198,1,3,0)
VistaRad^6^Display
"DATA",2006.539,198,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,198,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,198,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,198,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,199,0)
1.2.840.10008.5.1.4.1.1.77.1.1.1^Video Endoscopic Image Storage^SOP Class^Storage
"DATA",2006.539,199,1,0)
^2006.5391A^6^6
"DATA",2006.539,199,1,1,0)
Storage^2^Store
"DATA",2006.539,199,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,199,1,3,0)
VistaRad^6^Display
"DATA",2006.539,199,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,199,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,199,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,200,0)
1.2.840.10008.5.1.4.1.1.77.1.2^VL Microscopic Image Storage^SOP Class^Storage
"DATA",2006.539,200,1,0)
^2006.5391A^7^7
"DATA",2006.539,200,1,1,0)
Storage^2^Store
"DATA",2006.539,200,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,200,1,3,0)
VistaRad^6^Display
"DATA",2006.539,200,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,200,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,200,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,200,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,201,0)
1.2.840.10008.5.1.4.1.1.77.1.2.1^Video Microscopic Image Storage^SOP Class^Storage
"DATA",2006.539,201,1,0)
^2006.5391A^6^6
"DATA",2006.539,201,1,1,0)
Storage^2^Store
"DATA",2006.539,201,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,201,1,3,0)
VistaRad^6^Display
"DATA",2006.539,201,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,201,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,201,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,202,0)
1.2.840.10008.5.1.4.1.1.77.1.3^VL Slide-Coordinates Microscopic Image Storage^SOP Class^Storage
"DATA",2006.539,202,1,0)
^2006.5391A^7^7
"DATA",2006.539,202,1,1,0)
Storage^2^Store
"DATA",2006.539,202,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,202,1,3,0)
VistaRad^6^Display
"DATA",2006.539,202,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,202,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,202,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,202,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,203,0)
1.2.840.10008.5.1.4.1.1.77.1.4^VL Photographic Image Storage^SOP Class^Storage
"DATA",2006.539,203,1,0)
^2006.5391A^7^7
"DATA",2006.539,203,1,1,0)
Storage^2^Store
"DATA",2006.539,203,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,203,1,3,0)
VistaRad^6^Display
"DATA",2006.539,203,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,203,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,203,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,203,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,204,0)
1.2.840.10008.5.1.4.1.1.77.1.4.1^Video Photographic Image Storage^SOP Class^Storage
"DATA",2006.539,204,1,0)
^2006.5391A^6^6
"DATA",2006.539,204,1,1,0)
Storage^2^Store
"DATA",2006.539,204,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,204,1,3,0)
VistaRad^6^Display
"DATA",2006.539,204,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,204,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,204,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,205,0)
1.2.840.10008.5.1.4.1.1.77.1.5.1^Ophthalmic Photography 8 Bit Image Storage^SOP Class^Storage
"DATA",2006.539,205,1,0)
^2006.5391A^7^7
"DATA",2006.539,205,1,1,0)
Storage^2^Store
"DATA",2006.539,205,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,205,1,3,0)
VistaRad^6^Display
"DATA",2006.539,205,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,205,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,205,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,205,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,206,0)
1.2.840.10008.5.1.4.1.1.77.1.5.2^Ophthalmic Photography 16 Bit Image Storage^SOP Class^Storage
"DATA",2006.539,206,1,0)
^2006.5391A^7^7
"DATA",2006.539,206,1,1,0)
Storage^2^Store
"DATA",2006.539,206,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,206,1,3,0)
VistaRad^6^Display
"DATA",2006.539,206,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,206,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,206,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,206,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,207,0)
1.2.840.10008.5.1.4.1.1.77.1.5.3^Stereometric Relationship Storage^SOP Class^Storage
"DATA",2006.539,207,1,0)
^2006.5391A^6^6
"DATA",2006.539,207,1,1,0)
Storage^2^Store
"DATA",2006.539,207,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,207,1,3,0)
VistaRad^6^Display
"DATA",2006.539,207,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,207,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,207,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,208,0)
1.2.840.10008.5.1.4.1.1.77.2^VL Multi-frame Image Storage (Retired)^SOP Class^Storage
"DATA",2006.539,208,1,0)
^2006.5391A^7^7
"DATA",2006.539,208,1,1,0)
Storage^2^Store
"DATA",2006.539,208,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,208,1,3,0)
VistaRad^6^Display
"DATA",2006.539,208,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,208,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,208,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,208,1,7,0)
Create Abstract^1^Use MAG_MakeAbs.exe
"DATA",2006.539,209,0)
1.2.840.10008.5.1.4.1.1.8^Standalone Overlay Storage (Retired)^SOP Class^Storage
"DATA",2006.539,209,1,0)
^2006.5391A^6^6
"DATA",2006.539,209,1,1,0)
Storage^2^Store
"DATA",2006.539,209,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,209,1,3,0)
VistaRad^6^Display
"DATA",2006.539,209,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,209,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,209,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,210,0)
1.2.840.10008.5.1.4.1.1.88.11^Basic Text SR^SOP Class^Storage
"DATA",2006.539,210,1,0)
^2006.5391A^7^7
"DATA",2006.539,210,1,1,0)
Storage^2^Store
"DATA",2006.539,210,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,210,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,210,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,210,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,210,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,210,1,7,0)
Create Abstract^4^Canned icon for SR
"DATA",2006.539,211,0)
1.2.840.10008.5.1.4.1.1.88.22^Enhanced SR^SOP Class^Storage
"DATA",2006.539,211,1,0)
^2006.5391A^7^7
"DATA",2006.539,211,1,1,0)
Storage^2^Store
"DATA",2006.539,211,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,211,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,211,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,211,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,211,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,211,1,7,0)
Create Abstract^4^Canned icon for SR
"DATA",2006.539,212,0)
1.2.840.10008.5.1.4.1.1.88.33^Comprehensive SR^SOP Class^Storage
"DATA",2006.539,212,1,0)
^2006.5391A^7^7
"DATA",2006.539,212,1,1,0)
Storage^2^Store
"DATA",2006.539,212,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,212,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,212,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,212,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,212,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,212,1,7,0)
Create Abstract^4^Canned icon for SR
"DATA",2006.539,213,0)
1.2.840.10008.5.1.4.1.1.88.40^Procedure Log Storage^SOP Class^Storage
"DATA",2006.539,213,1,0)
^2006.5391A^6^6
"DATA",2006.539,213,1,1,0)
Storage^2^Store
"DATA",2006.539,213,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,213,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,213,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,213,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,213,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,214,0)
1.2.840.10008.5.1.4.1.1.88.50^Mammography CAD SR^SOP Class^Storage
"DATA",2006.539,214,1,0)
^2006.5391A^7^7
"DATA",2006.539,214,1,1,0)
Storage^2^Store
"DATA",2006.539,214,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,214,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,214,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,214,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,214,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,214,1,7,0)
Create Abstract^4^Canned icon for SR
"DATA",2006.539,215,0)
1.2.840.10008.5.1.4.1.1.88.59^Key Object Selection Document^SOP Class^Storage
"DATA",2006.539,215,1,0)
^2006.5391A^6^6
"DATA",2006.539,215,1,1,0)
Storage^2^Store
"DATA",2006.539,215,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,215,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,215,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,215,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,215,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,216,0)
1.2.840.10008.5.1.4.1.1.88.65^Chest CAD SR^SOP Class^Storage
"DATA",2006.539,216,1,0)
^2006.5391A^7^7
"DATA",2006.539,216,1,1,0)
Storage^2^Store
"DATA",2006.539,216,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,216,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,216,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,216,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,216,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,216,1,7,0)
Create Abstract^4^Canned icon for SR
"DATA",2006.539,217,0)
1.2.840.10008.5.1.4.1.1.88.67^X-Ray Radiation Dose SR^SOP Class^Storage
"DATA",2006.539,217,1,0)
^2006.5391A^7^7
"DATA",2006.539,217,1,1,0)
Storage^2^Store
"DATA",2006.539,217,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,217,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,217,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,217,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,217,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,217,1,7,0)
Create Abstract^4^Canned icon for SR
"DATA",2006.539,218,0)
1.2.840.10008.5.1.4.1.1.9^Standalone Curve Storage (Retired)^SOP Class^Storage
"DATA",2006.539,218,1,0)
^2006.5391A^6^6
"DATA",2006.539,218,1,1,0)
Storage^2^Store
"DATA",2006.539,218,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,218,1,3,0)
VistaRad^6^Display
"DATA",2006.539,218,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,218,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,218,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,219,0)
1.2.840.10008.5.1.4.1.1.9.1.1^12-lead ECG Waveform Storage^SOP Class^Storage
"DATA",2006.539,219,1,0)
^2006.5391A^7^7
"DATA",2006.539,219,1,1,0)
Storage^2^Store
"DATA",2006.539,219,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,219,1,3,0)
VistaRad^6^Display
"DATA",2006.539,219,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,219,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,219,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,219,1,7,0)
Create Abstract^3^Canned icon for ECG
"DATA",2006.539,220,0)
1.2.840.10008.5.1.4.1.1.9.1.2^General ECG Waveform Storage^SOP Class^Storage
"DATA",2006.539,220,1,0)
^2006.5391A^7^7
"DATA",2006.539,220,1,1,0)
Storage^2^Store
"DATA",2006.539,220,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,220,1,3,0)
VistaRad^6^Display
"DATA",2006.539,220,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,220,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,220,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,220,1,7,0)
Create Abstract^3^Canned icon for ECG
"DATA",2006.539,221,0)
1.2.840.10008.5.1.4.1.1.9.1.3^Ambulatory ECG Waveform Storage^SOP Class^Storage
"DATA",2006.539,221,1,0)
^2006.5391A^7^7
"DATA",2006.539,221,1,1,0)
Storage^2^Store
"DATA",2006.539,221,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,221,1,3,0)
VistaRad^6^Display
"DATA",2006.539,221,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,221,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,221,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,221,1,7,0)
Create Abstract^3^Canned icon for ECG
"DATA",2006.539,222,0)
1.2.840.10008.5.1.4.1.1.9.2.1^Hemodynamic Waveform Storage^SOP Class^Storage
"DATA",2006.539,222,1,0)
^2006.5391A^6^6
"DATA",2006.539,222,1,1,0)
Storage^2^Store
"DATA",2006.539,222,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,222,1,3,0)
VistaRad^6^Display
"DATA",2006.539,222,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,222,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,222,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,223,0)
1.2.840.10008.5.1.4.1.1.9.3.1^Cardiac Electrophysiology Waveform Storage^SOP Class^Storage
"DATA",2006.539,223,1,0)
^2006.5391A^7^7
"DATA",2006.539,223,1,1,0)
Storage^2^Store
"DATA",2006.539,223,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,223,1,3,0)
VistaRad^6^Display
"DATA",2006.539,223,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,223,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,223,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,223,1,7,0)
Create Abstract^3^Canned icon for ECG
"DATA",2006.539,224,0)
1.2.840.10008.5.1.4.1.1.9.4.1^Basic Voice Audio Waveform Storage^SOP Class^Storage
"DATA",2006.539,224,1,0)
^2006.5391A^6^6
"DATA",2006.539,224,1,1,0)
Storage^2^Store
"DATA",2006.539,224,1,2,0)
Clinical Display^6^Display
"DATA",2006.539,224,1,3,0)
VistaRad^6^Display
"DATA",2006.539,224,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,224,1,5,0)
DICOM Query/Retrieve^4^Retrieve
"DATA",2006.539,224,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,225,0)
1.2.840.10008.5.1.4.1.2.1.1^Patient Root Query/Retrieve Information Model - FIND^SOP Class
"DATA",2006.539,225,1,0)
^2006.5391A^6^6
"DATA",2006.539,225,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,225,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,225,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,225,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,225,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,225,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,226,0)
1.2.840.10008.5.1.4.1.2.1.2^Patient Root Query/Retrieve Information Model - MOVE^SOP Class
"DATA",2006.539,226,1,0)
^2006.5391A^6^6
"DATA",2006.539,226,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,226,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,226,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,226,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,226,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,226,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,227,0)
1.2.840.10008.5.1.4.1.2.1.3^Patient Root Query/Retrieve Information Model - GET^SOP Class
"DATA",2006.539,227,1,0)
^2006.5391A^6^6
"DATA",2006.539,227,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,227,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,227,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,227,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,227,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,227,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,228,0)
1.2.840.10008.5.1.4.1.2.2.1^Study Root Query/Retrieve Information Model - FIND^SOP Class
"DATA",2006.539,228,1,0)
^2006.5391A^6^6
"DATA",2006.539,228,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,228,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,228,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,228,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,228,1,5,0)
DICOM Query/Retrieve^1^Accept
"DATA",2006.539,228,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,229,0)
1.2.840.10008.5.1.4.1.2.2.2^Study Root Query/Retrieve Information Model - MOVE^SOP Class
"DATA",2006.539,229,1,0)
^2006.5391A^6^6
"DATA",2006.539,229,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,229,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,229,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,229,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,229,1,5,0)
DICOM Query/Retrieve^1^Accept
"DATA",2006.539,229,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,230,0)
1.2.840.10008.5.1.4.1.2.2.3^Study Root Query/Retrieve Information Model - GET^SOP Class
"DATA",2006.539,230,1,0)
^2006.5391A^6^6
"DATA",2006.539,230,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,230,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,230,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,230,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,230,1,5,0)
DICOM Query/Retrieve^1^Accept
"DATA",2006.539,230,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,231,0)
1.2.840.10008.5.1.4.1.2.3.1^Patient/Study Only Query/Retrieve Information Model  - FIND (Retired)^SOP Class
"DATA",2006.539,231,1,0)
^2006.5391A^6^6
"DATA",2006.539,231,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,231,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,231,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,231,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,231,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,231,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,232,0)
1.2.840.10008.5.1.4.1.2.3.2^Patient/Study Only Query/Retrieve Information Model  - MOVE (Retired)^SOP Class
"DATA",2006.539,232,1,0)
^2006.5391A^6^6
"DATA",2006.539,232,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,232,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,232,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,232,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,232,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,232,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,233,0)
1.2.840.10008.5.1.4.1.2.3.3^Patient/Study Only Query/Retrieve Information Model  - GET (Retired)^SOP Class
"DATA",2006.539,233,1,0)
^2006.5391A^6^6
"DATA",2006.539,233,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,233,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,233,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,233,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,233,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,233,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,234,0)
1.2.840.10008.5.1.4.31^Modality Worklist Information Model - FIND^SOP Class
"DATA",2006.539,234,1,0)
^2006.5391A^6^6
"DATA",2006.539,234,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,234,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,234,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,234,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,234,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,234,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,235,0)
1.2.840.10008.5.1.4.32^General Purpose Worklist Management Meta SOP Class^Meta SOP Class
"DATA",2006.539,235,1,0)
^2006.5391A^6^6
"DATA",2006.539,235,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,235,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,235,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,235,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,235,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,235,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,236,0)
1.2.840.10008.5.1.4.32.1^General Purpose Worklist Information Model - FIND^SOP Class
"DATA",2006.539,236,1,0)
^2006.5391A^6^6
"DATA",2006.539,236,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,236,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,236,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,236,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,236,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,236,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,237,0)
1.2.840.10008.5.1.4.32.2^General Purpose Scheduled Procedure Step SOP Class^SOP Class
"DATA",2006.539,237,1,0)
^2006.5391A^6^6
"DATA",2006.539,237,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,237,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,237,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,237,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,237,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,237,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,238,0)
1.2.840.10008.5.1.4.32.3^General Purpose Performed Procedure Step SOP Class^SOP Class
"DATA",2006.539,238,1,0)
^2006.5391A^6^6
"DATA",2006.539,238,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,238,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,238,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,238,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,238,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,238,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,239,0)
1.2.840.10008.5.1.4.33^Instance Availability Notification SOP Class^SOP Class
"DATA",2006.539,239,1,0)
^2006.5391A^6^6
"DATA",2006.539,239,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,239,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,239,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,239,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,239,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,239,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,240,0)
1.2.840.10008.5.1.4.37.1^General Relevant Patient Information Query^SOP Class
"DATA",2006.539,240,1,0)
^2006.5391A^6^6
"DATA",2006.539,240,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,240,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,240,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,240,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,240,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,240,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,241,0)
1.2.840.10008.5.1.4.37.2^Breast Imaging Relevant Patient Information Query^SOP Class
"DATA",2006.539,241,1,0)
^2006.5391A^6^6
"DATA",2006.539,241,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,241,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,241,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,241,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,241,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,241,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,242,0)
1.2.840.10008.5.1.4.37.3^Cardiac Relevant Patient Information Query^SOP Class
"DATA",2006.539,242,1,0)
^2006.5391A^6^6
"DATA",2006.539,242,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,242,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,242,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,242,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,242,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,242,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,243,0)
1.2.840.10008.5.1.4.38.1^Hanging Protocol Storage^SOP Class
"DATA",2006.539,243,1,0)
^2006.5391A^6^6
"DATA",2006.539,243,1,1,0)
Storage^2^Store
"DATA",2006.539,243,1,2,0)
Clinical Display^5^Apply
"DATA",2006.539,243,1,3,0)
VistaRad^5^Apply
"DATA",2006.539,243,1,4,0)
Backround Processor^3^Manage
"DATA",2006.539,243,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,243,1,6,0)
DICOM Gateway^1^Accept
"DATA",2006.539,244,0)
1.2.840.10008.5.1.4.38.2^Hanging Protocol Information Model - FIND^SOP Class
"DATA",2006.539,244,1,0)
^2006.5391A^6^6
"DATA",2006.539,244,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,244,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,244,1,3,0)
VistaRad^9^Use
"DATA",2006.539,244,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,244,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,244,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,245,0)
1.2.840.10008.5.1.4.38.3^Hanging Protocol Information Model - MOVE^SOP Class
"DATA",2006.539,245,1,0)
^2006.5391A^6^6
"DATA",2006.539,245,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,245,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,245,1,3,0)
VistaRad^9^Use
"DATA",2006.539,245,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,245,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,245,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,246,0)
1.2.840.113754.2.1.1.0^VA DICOM V1.0
"DATA",2006.539,246,1,0)
^2006.5391A^6^6
"DATA",2006.539,246,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,246,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,246,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,246,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,246,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,246,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,247,0)
1.2.840.113754.2.1.2.5^VA DICOM V2.5
"DATA",2006.539,247,1,0)
^2006.5391A^6^6
"DATA",2006.539,247,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,247,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,247,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,247,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,247,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,247,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,248,0)
1.2.840.113754.2.1.3.0^VA DICOM V3.0
"DATA",2006.539,248,1,0)
^2006.5391A^6^6
"DATA",2006.539,248,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,248,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,248,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,248,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,248,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,248,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,249,0)
1.2.840.113754.3.1.2.1.1^VA Detached Patient Management SOP Class^SOP Class^Management
"DATA",2006.539,249,1,0)
^2006.5391A^6^6
"DATA",2006.539,249,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,249,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,249,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,249,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,249,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,249,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,250,0)
1.2.840.113754.3.1.2.1.4^VA Detached Patient Management Meta SOP Class^Meta SOP Class
"DATA",2006.539,250,1,0)
^2006.5391A^6^6
"DATA",2006.539,250,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,250,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,250,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,250,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,250,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,250,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,252,0)
1.2.840.113754.3.1.2.2.1^VA Detached Visit Management SOP Class^SOP Class^Management
"DATA",2006.539,252,1,0)
^2006.5391A^6^6
"DATA",2006.539,252,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,252,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,252,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,252,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,252,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,252,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,254,0)
1.2.840.113754.3.1.2.3.1^VA Detached Study Management SOP Class^SOP Class^Management
"DATA",2006.539,254,1,0)
^2006.5391A^6^6
"DATA",2006.539,254,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,254,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,254,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,254,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,254,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,254,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,255,0)
1.2.840.113754.3.1.2.3.2^VA Study Component Management SOP Class^SOP Class^Management
"DATA",2006.539,255,1,0)
^2006.5391A^6^6
"DATA",2006.539,255,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,255,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,255,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,255,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,255,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,255,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,256,0)
1.2.840.113754.3.1.2.5.1^VA Detached Results Management SOP Class^SOP Class^Management
"DATA",2006.539,256,1,0)
^2006.5391A^6^6
"DATA",2006.539,256,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,256,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,256,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,256,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,256,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,256,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,257,0)
1.2.840.113754.3.1.2.5.4^VA Detached Results Management Meta SOP Class^Meta SOP Class
"DATA",2006.539,257,1,0)
^2006.5391A^6^6
"DATA",2006.539,257,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,257,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,257,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,257,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,257,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,257,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,259,0)
1.2.840.113754.3.1.2.6.1^VA Detached Interpretation Management SOP Class^SOP Class^Management
"DATA",2006.539,259,1,0)
^2006.5391A^6^6
"DATA",2006.539,259,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,259,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,259,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,259,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,259,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,259,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,260,0)
1.2.840.113754.3.1.2.5.5^VA Detached Study Management Meta SOP Class^Meta SOP Class
"DATA",2006.539,260,1,0)
^2006.5391A^6^6
"DATA",2006.539,260,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,260,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,260,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,260,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,260,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,260,1,6,0)
DICOM Gateway^0^Not Applicable
"DATA",2006.539,264,0)
1.2.840.113754.3.5.1.4.1.1.99.1^VA Composite Binary Object SOP Class^SOP Class
"DATA",2006.539,264,1,0)
^2006.5391A^6^6
"DATA",2006.539,264,1,1,0)
Storage^0^Not Applicable
"DATA",2006.539,264,1,2,0)
Clinical Display^0^Not Applicable
"DATA",2006.539,264,1,3,0)
VistaRad^0^Not Applicable
"DATA",2006.539,264,1,4,0)
Backround Processor^0^Not Applicable
"DATA",2006.539,264,1,5,0)
DICOM Query/Retrieve^0^Not Applicable
"DATA",2006.539,264,1,6,0)
DICOM Gateway^0^Not Applicable
"FIA",2005)
IMAGE
"FIA",2005,0)
^MAG(2005,
"FIA",2005,0,0)
2005I
"FIA",2005,0,1)
y^y^p^^^^n^^n
"FIA",2005,0,10)

"FIA",2005,0,11)

"FIA",2005,0,"RLRO")

"FIA",2005,2005)
1
"FIA",2005,2005,110)

"FIA",2005.1)
IMAGE
"FIA",2005.1,0)
^MAG(2005.1,
"FIA",2005.1,0,0)
2005.1I
"FIA",2005.1,0,1)
y^y^p^^^^n^^n
"FIA",2005.1,0,10)

"FIA",2005.1,0,11)

"FIA",2005.1,0,"RLRO")

"FIA",2005.1,2005.1)
1
"FIA",2005.1,2005.1,110)

"FIA",2006.539)
DICOM UID SPECIFIC ACTION
"FIA",2006.539,0)
^MAGDICOM(2006.539,
"FIA",2006.539,0,0)
2006.539
"FIA",2006.539,0,1)
y^y^f^^n^^y^o^n
"FIA",2006.539,0,10)

"FIA",2006.539,0,11)

"FIA",2006.539,0,"RLRO")

"FIA",2006.539,2006.539)
0
"FIA",2006.539,2006.5391)
0
"FIA",2006.563)
DICOM GATEWAY PARAMETER
"FIA",2006.563,0)
^MAGDICOM(2006.563,
"FIA",2006.563,0,0)
2006.563
"FIA",2006.563,0,1)
y^y^p^^^^n^^n
"FIA",2006.563,0,10)

"FIA",2006.563,0,11)

"FIA",2006.563,0,"RLRO")

"FIA",2006.563,2006.563)
1
"FIA",2006.563,2006.563,112)

"FIA",2006.5641)
DICOM GATEWAY MACHINE ID
"FIA",2006.5641,0)
^MAGDICOM(2006.5641,
"FIA",2006.5641,0,0)
2006.5641
"FIA",2006.5641,0,1)
y^y^p^^^^n^^n
"FIA",2006.5641,0,10)

"FIA",2006.5641,0,11)

"FIA",2006.5641,0,"RLRO")

"FIA",2006.5641,2006.5641)
1
"FIA",2006.5641,2006.5641,.01)

"FIA",2006.5714)
DICOM INCOMPLETE OBJECT
"FIA",2006.5714,0)
^MAGDINPT(2006.5714,
"FIA",2006.5714,0,0)
2006.5714
"FIA",2006.5714,0,1)
y^y^f^^^^n
"FIA",2006.5714,0,10)

"FIA",2006.5714,0,11)

"FIA",2006.5714,0,"RLRO")

"FIA",2006.5714,2006.5714)
0
"FIA",2006.5733)
QUERY/RETRIEVE STATISTICS
"FIA",2006.5733,0)
^MAGDAUDT(2006.5733,
"FIA",2006.5733,0,0)
2006.5733
"FIA",2006.5733,0,1)
y^y^f^^^^n
"FIA",2006.5733,0,10)

"FIA",2006.5733,0,11)

"FIA",2006.5733,0,"RLRO")

"FIA",2006.5733,2006.5733)
0
"FIA",2006.5733,2006.57331)
0
"FIA",2006.5733,2006.57332)
0
"FIA",2006.5733,2006.57333)
0
"FIA",2006.574)
DICOM IMAGE OUTPUT
"FIA",2006.574,0)
^MAGDOUTP(2006.574,
"FIA",2006.574,0,0)
2006.574
"FIA",2006.574,0,1)
y^y^f^^^^n
"FIA",2006.574,0,10)

"FIA",2006.574,0,11)

"FIA",2006.574,0,"RLRO")

"FIA",2006.574,2006.574)
0
"FIA",2006.574,2006.5744)
0
"FIA",2006.575)
DICOM FAILED IMAGES
"FIA",2006.575,0)
^MAGD(2006.575,
"FIA",2006.575,0,0)
2006.575
"FIA",2006.575,0,1)
y^y^f^^^^n^^n
"FIA",2006.575,0,10)

"FIA",2006.575,0,11)

"FIA",2006.575,0,"RLRO")

"FIA",2006.575,2006.575)
0
"FIA",2006.575,2006.57526)
0
"FIA",2006.5821)
CT CONVERSION PARAMETERS
"FIA",2006.5821,0)
^MAGDICOM(2006.5821,
"FIA",2006.5821,0,0)
2006.5821P
"FIA",2006.5821,0,1)
y^y^f^^^^n
"FIA",2006.5821,0,10)

"FIA",2006.5821,0,11)

"FIA",2006.5821,0,"RLRO")

"FIA",2006.5821,2006.5821)
0
"FIA",2006.5849)
TELEREADER READ/UNREAD LIST
"FIA",2006.5849,0)
^MAG(2006.5849,
"FIA",2006.5849,0,0)
2006.5849
"FIA",2006.5849,0,1)
y^y^f^^^^n
"FIA",2006.5849,0,10)

"FIA",2006.5849,0,11)

"FIA",2006.5849,0,"RLRO")

"FIA",2006.5849,2006.5849)
0
"FIA",2006.587)
DICOM TRANSMIT DESTINATION
"FIA",2006.587,0)
^MAG(2006.587,
"FIA",2006.587,0,0)
2006.587
"FIA",2006.587,0,1)
y^y^f^^^^n
"FIA",2006.587,0,10)

"FIA",2006.587,0,11)

"FIA",2006.587,0,"RLRO")

"FIA",2006.587,2006.587)
0
"FIA",2006.587,2006.5871)
0
"FIA",2006.87)
DICOM GATEWAY INFORMATION
"FIA",2006.87,0)
^MAG(2006.87,
"FIA",2006.87,0,0)
2006.87
"FIA",2006.87,0,1)
y^y^f^^^^n
"FIA",2006.87,0,10)

"FIA",2006.87,0,11)

"FIA",2006.87,0,"RLRO")

"FIA",2006.87,2006.87)
0
"INI")
PRE^MAGIPS54
"INIT")
POST^MAGIPS54
"IX",2006.539,2006.539,"D",0)
2006.539^D^Track type and subtype^R^^R^IR^I^2006.539^^^^^LS
"IX",2006.539,2006.539,"D",.1,0)
^^2^2^3071105^
"IX",2006.539,2006.539,"D",.1,1,0)
This cross-reference keeps track of which UIDs belong
"IX",2006.539,2006.539,"D",.1,2,0)
to which types and subtypes.
"IX",2006.539,2006.539,"D",1)
S ^MAGDICOM(2006.539,"D",X(1),X(2),DA)=""
"IX",2006.539,2006.539,"D",2)
K ^MAGDICOM(2006.539,"D",X(1),X(2),DA)
"IX",2006.539,2006.539,"D",2.5)
K ^MAGDICOM(2006.539,"D")
"IX",2006.539,2006.539,"D",11.1,0)
^.114IA^2^2
"IX",2006.539,2006.539,"D",11.1,1,0)
1^F^2006.539^3^^1^F
"IX",2006.539,2006.539,"D",11.1,1,3)

"IX",2006.539,2006.539,"D",11.1,2,0)
2^F^2006.539^4^^2^F
"IX",2006.539,2006.539,"D",11.1,2,3)

"IX",2006.574,2006.574,"STS",0)
2006.574^STS^Origin and Status^R^^R^IR^W^2006.5744^^^^^LS
"IX",2006.574,2006.574,"STS",.1,0)
^^5^5^3041029^
"IX",2006.574,2006.574,"STS",.1,1,0)
 
"IX",2006.574,2006.574,"STS",.1,2,0)
 
"IX",2006.574,2006.574,"STS",.1,3,0)
This cross-reference keeps track of ORIGIN and STATUS.
"IX",2006.574,2006.574,"STS",.1,4,0)
The main purpose of this cross-reference is to make sure
"IX",2006.574,2006.574,"STS",.1,5,0)
that files are issued to only one transmission process.
"IX",2006.574,2006.574,"STS",1)
S ^MAGDOUTP(2006.574,"STS",X(1),X(2),X(3),DA(1),DA)=""
"IX",2006.574,2006.574,"STS",2)
K ^MAGDOUTP(2006.574,"STS",X(1),X(2),X(3),DA(1),DA)
"IX",2006.574,2006.574,"STS",2.5)
K ^MAGDOUTP(2006.574,"STS")
"IX",2006.574,2006.574,"STS",11.1,0)
^.114IA^5^3
"IX",2006.574,2006.574,"STS",11.1,3,0)
1^C^^^^1^^Origin
"IX",2006.574,2006.574,"STS",11.1,3,1.5)
S X=$P(^MAGDOUTP(2006.574,DA(1),0),"^",4)
"IX",2006.574,2006.574,"STS",11.1,4,0)
2^C^^^^2
"IX",2006.574,2006.574,"STS",11.1,4,1.5)
S X=$P(^MAGDOUTP(2006.574,DA(1),0),"^",5)
"IX",2006.574,2006.574,"STS",11.1,5,0)
3^F^2006.5744^2^^3^F
"IX",2006.574,2006.574,"STS",11.1,5,3)

"IX",2006.575,2006.575,"AD",0)
2006.575^AD^Date Entered^MU^^F^IR^I^2006.575^^^^^S
"IX",2006.575,2006.575,"AD",.1,0)
^^6^6^3041216^
"IX",2006.575,2006.575,"AD",.1,1,0)
This cross-reference keeps track of when the various entries were
"IX",2006.575,2006.575,"AD",.1,2,0)
created.
"IX",2006.575,2006.575,"AD",.1,3,0)
 
"IX",2006.575,2006.575,"AD",.1,4,0)
This cross-reference is only created for entries that are not yet "fixed".
"IX",2006.575,2006.575,"AD",.1,5,0)
This cross-reference is only created for entries that result from
"IX",2006.575,2006.575,"AD",.1,6,0)
Consults.
"IX",2006.575,2006.575,"AD",1)
S ^MAGD(2006.575,"AD",X(1),DA)=""
"IX",2006.575,2006.575,"AD",1.4)
I 'X(2),X(3)="CON"
"IX",2006.575,2006.575,"AD",2)
K ^MAGD(2006.575,"AD",X(1),DA)
"IX",2006.575,2006.575,"AD",2.5)
K ^MAGD(2006.575,"AD")
"IX",2006.575,2006.575,"AD",11.1,0)
^.114IA^3^3
"IX",2006.575,2006.575,"AD",11.1,1,0)
1^F^2006.575^7^^1^F
"IX",2006.575,2006.575,"AD",11.1,1,3)

"IX",2006.575,2006.575,"AD",11.1,2,0)
2^F^2006.575^16^^^F
"IX",2006.575,2006.575,"AD",11.1,2,3)

"IX",2006.575,2006.575,"AD",11.1,3,0)
3^F^2006.575^32^^^F
"IX",2006.575,2006.575,"AD",11.1,3,3)

"IX",2006.575,2006.575,"AFX",0)
2006.575^AFX^Location and Machine ID^MU^^F^IR^I^2006.575^^^^^S
"IX",2006.575,2006.575,"AFX",.1,0)
^^3^3^3041216^
"IX",2006.575,2006.575,"AFX",.1,1,0)
This cross-reference keeps track of
"IX",2006.575,2006.575,"AFX",.1,2,0)
which computers (Machine ID) belong to
"IX",2006.575,2006.575,"AFX",.1,3,0)
which location.
"IX",2006.575,2006.575,"AFX",1)
S ^MAGD(2006.575,"AFX",X(1),X(2),DA)=""
"IX",2006.575,2006.575,"AFX",1.4)
I $D(^MAGD(2006.575,"F",X(1),X(3),DA))
"IX",2006.575,2006.575,"AFX",2)
K ^MAGD(2006.575,"AFX",X(1),X(2),DA)
"IX",2006.575,2006.575,"AFX",2.5)
K ^MAGD(2006.575,"AFX")
"IX",2006.575,2006.575,"AFX",11.1,0)
^.114IA^3^3
"IX",2006.575,2006.575,"AFX",11.1,1,0)
1^F^2006.575^36^^1^F
"IX",2006.575,2006.575,"AFX",11.1,1,3)

"IX",2006.575,2006.575,"AFX",11.1,2,0)
2^F^2006.575^28^^2^F
"IX",2006.575,2006.575,"AFX",11.1,2,3)

"IX",2006.575,2006.575,"AFX",11.1,3,0)
3^F^2006.575^9^^^F
"IX",2006.575,2006.575,"AFX",11.1,3,3)

"IX",2006.575,2006.575,"D",0)
2006.575^D^Patient ID^MU^^F^IR^I^2006.575^^^^^LS
"IX",2006.575,2006.575,"D",.1,0)
^^6^6^3041216^
"IX",2006.575,2006.575,"D",.1,1,0)
This cross-reference keeps track of which Patient ID belongs to which
"IX",2006.575,2006.575,"D",.1,2,0)
study.
"IX",2006.575,2006.575,"D",.1,3,0)
 
"IX",2006.575,2006.575,"D",.1,4,0)
This cross-reference is only created for entries that are not yet "fixed".
"IX",2006.575,2006.575,"D",.1,5,0)
This cross-reference is only created for entries that result from
"IX",2006.575,2006.575,"D",.1,6,0)
Consults.
"IX",2006.575,2006.575,"D",1)
S ^MAGD(2006.575,"D",X(1),DA)=""
"IX",2006.575,2006.575,"D",1.4)
I 'X(3),X(2)="CON"
"IX",2006.575,2006.575,"D",2)
K ^MAGD(2006.575,"D",X(1),DA)
"IX",2006.575,2006.575,"D",2.5)
K ^MAGD(2006.575,"D")
"IX",2006.575,2006.575,"D",11.1,0)
^.114IA^3^3
"IX",2006.575,2006.575,"D",11.1,1,0)
1^F^2006.575^2^^1^F
"IX",2006.575,2006.575,"D",11.1,1,3)

"IX",2006.575,2006.575,"D",11.1,2,0)
2^F^2006.575^32^^^F
"IX",2006.575,2006.575,"D",11.1,2,3)

"IX",2006.575,2006.575,"D",11.1,3,0)
3^F^2006.575^16^^^F
"IX",2006.575,2006.575,"D",11.1,3,3)

"IX",2006.5821,2006.5821,"C",0)
2006.5821^C^Quick lookup by location, make, model and date^R^^R^IR^I^2006.5821^^^^^LS
"IX",2006.5821,2006.5821,"C",.1,0)
^^8^8^3071003^
"IX",2006.5821,2006.5821,"C",.1,1,0)
This cross-reference keeps track of when parameters became active for
"IX",2006.5821,2006.5821,"C",.1,2,0)
a certain CT scanner.
"IX",2006.5821,2006.5821,"C",.1,3,0)
 
"IX",2006.5821,2006.5821,"C",.1,4,0)
The subscripts are:
"IX",2006.5821,2006.5821,"C",.1,5,0)
   Location
"IX",2006.5821,2006.5821,"C",.1,6,0)
   Manufacturer
"IX",2006.5821,2006.5821,"C",.1,7,0)
   Model
"IX",2006.5821,2006.5821,"C",.1,8,0)
   Date
"IX",2006.5821,2006.5821,"C",1)
S ^MAGDICOM(2006.5821,"C",X(1),X(2),X(3),X(4),DA)=""
"IX",2006.5821,2006.5821,"C",2)
K ^MAGDICOM(2006.5821,"C",X(1),X(2),X(3),X(4),DA)
"IX",2006.5821,2006.5821,"C",2.5)
K ^MAGDICOM(2006.5821,"C")
"IX",2006.5821,2006.5821,"C",11.1,0)
^.114IA^4^4
"IX",2006.5821,2006.5821,"C",11.1,1,0)
1^F^2006.5821^.01^^1^F
"IX",2006.5821,2006.5821,"C",11.1,1,3)

"IX",2006.5821,2006.5821,"C",11.1,2,0)
2^F^2006.5821^2^^2^F
"IX",2006.5821,2006.5821,"C",11.1,2,3)

"IX",2006.5821,2006.5821,"C",11.1,3,0)
3^F^2006.5821^3^^3^F
"IX",2006.5821,2006.5821,"C",11.1,3,3)

"IX",2006.5821,2006.5821,"C",11.1,4,0)
4^F^2006.5821^4^^4^F
"IX",2006.5821,2006.5821,"C",11.1,4,3)

"IX",2006.5849,2006.5849,"AC",0)
2006.5849^AC^Specialty/Index^R^^R^IR^I^2006.5849^^^^^S
"IX",2006.5849,2006.5849,"AC",1)
S ^MAG(2006.5849,"AC",$E(X(1),1,30),$E(X(2),1,30),$E(X(3),1,30),$E(X(4),1,30),DA)=""
"IX",2006.5849,2006.5849,"AC",2)
K ^MAG(2006.5849,"AC",$E(X(1),1,30),$E(X(2),1,30),$E(X(3),1,30),$E(X(4),1,30),DA)
"IX",2006.5849,2006.5849,"AC",2.5)
K ^MAG(2006.5849,"AC")
"IX",2006.5849,2006.5849,"AC",11.1,0)
^.114IA^4^4
"IX",2006.5849,2006.5849,"AC",11.1,1,0)
1^F^2006.5849^1^30^1^F
"IX",2006.5849,2006.5849,"AC",11.1,1,3)

"IX",2006.5849,2006.5849,"AC",11.1,2,0)
2^F^2006.5849^2^30^2^F
"IX",2006.5849,2006.5849,"AC",11.1,2,3)

"IX",2006.5849,2006.5849,"AC",11.1,3,0)
3^F^2006.5849^3^30^3^F
"IX",2006.5849,2006.5849,"AC",11.1,3,3)

"IX",2006.5849,2006.5849,"AC",11.1,4,0)
4^F^2006.5849^8^30^4^F
"IX",2006.5849,2006.5849,"AC",11.1,4,3)

"IX",2006.5849,2006.5849,"D",0)
2006.5849^D^Sort for Display^R^^R^IR^I^2006.5849^^^^^LS
"IX",2006.5849,2006.5849,"D",1)
S ^MAG(2006.5849,"D",$E(X(1),1,30),$E(X(2),1,30),$E(X(3),1,30),$E(X(4),1,30),DA)=""
"IX",2006.5849,2006.5849,"D",2)
K ^MAG(2006.5849,"D",$E(X(1),1,30),$E(X(2),1,30),$E(X(3),1,30),$E(X(4),1,30),DA)
"IX",2006.5849,2006.5849,"D",2.5)
K ^MAG(2006.5849,"D")
"IX",2006.5849,2006.5849,"D",11.1,0)
^.114IA^4^4
"IX",2006.5849,2006.5849,"D",11.1,1,0)
1^F^2006.5849^1^30^1^F
"IX",2006.5849,2006.5849,"D",11.1,1,3)

"IX",2006.5849,2006.5849,"D",11.1,2,0)
2^F^2006.5849^2^30^2^F
"IX",2006.5849,2006.5849,"D",11.1,2,3)

"IX",2006.5849,2006.5849,"D",11.1,3,0)
3^F^2006.5849^3^30^3^F
"IX",2006.5849,2006.5849,"D",11.1,3,3)

"IX",2006.5849,2006.5849,"D",11.1,4,0)
4^F^2006.5849^10^30^4^F
"IX",2006.5849,2006.5849,"D",11.1,4,3)

"IX",2006.5849,2006.5849,"E",0)
2006.5849^E^Allow sorting by Acquisition Site and Date^R^^R^IR^I^2006.5849^^^^^LS
"IX",2006.5849,2006.5849,"E",1)
S ^MAG(2006.5849,"E",$E(X(1),1,4),$E(X(2),1,7),DA)=""
"IX",2006.5849,2006.5849,"E",2)
K ^MAG(2006.5849,"E",$E(X(1),1,4),$E(X(2),1,7),DA)
"IX",2006.5849,2006.5849,"E",2.5)
K ^MAG(2006.5849,"E")
"IX",2006.5849,2006.5849,"E",11.1,0)
^.114IA^2^2
"IX",2006.5849,2006.5849,"E",11.1,1,0)
1^F^2006.5849^1^4^1^F
"IX",2006.5849,2006.5849,"E",11.1,1,3)

"IX",2006.5849,2006.5849,"E",11.1,2,0)
2^F^2006.5849^17^7^2^F
"IX",2006.5849,2006.5849,"E",11.1,2,2)
S X=$E($P(X,"."),1,30)
"IX",2006.5849,2006.5849,"E",11.1,2,3)

"IX",2006.587,2006.587,"C",0)
2006.587^C^Services per Gateway^R^^R^IR^I^2006.587^^^^^LS
"IX",2006.587,2006.587,"C",.1,0)
^^6^6^3030514^
"IX",2006.587,2006.587,"C",.1,1,0)
This cross-reference keeps track of which services are accessed
"IX",2006.587,2006.587,"C",.1,2,0)
from which DICOM Gateway:
"IX",2006.587,2006.587,"C",.1,3,0)
  Service Name
"IX",2006.587,2006.587,"C",.1,4,0)
    Gateway Location
"IX",2006.587,2006.587,"C",.1,5,0)
      Gateway System Title
"IX",2006.587,2006.587,"C",.1,6,0)
e
"IX",2006.587,2006.587,"C",1)
S ^MAG(2006.587,"C",X(1),X(2),X(3),DA)=""
"IX",2006.587,2006.587,"C",2)
K ^MAG(2006.587,"C",X(1),X(2),X(3),DA)
"IX",2006.587,2006.587,"C",2.5)
K ^MAG(2006.587,"C")
"IX",2006.587,2006.587,"C",11.1,0)
^.114IA^3^3
"IX",2006.587,2006.587,"C",11.1,1,0)
1^F^2006.587^.01^^1^F
"IX",2006.587,2006.587,"C",11.1,1,3)

"IX",2006.587,2006.587,"C",11.1,2,0)
2^F^2006.587^5^^2^F
"IX",2006.587,2006.587,"C",11.1,2,3)

"IX",2006.587,2006.587,"C",11.1,3,0)
3^F^2006.587^7^^3^F
"IX",2006.587,2006.587,"C",11.1,3,3)

"IX",2006.587,2006.587,"D",0)
2006.587^D^Gateway per location^R^^R^IR^I^2006.587^^^^^LS
"IX",2006.587,2006.587,"D",.1,0)
^^4^4^3030514^
"IX",2006.587,2006.587,"D",.1,1,0)
This cross reference keeps track of which DICOM Gateway is located
"IX",2006.587,2006.587,"D",.1,2,0)
at which location:
"IX",2006.587,2006.587,"D",.1,3,0)
    Gateway System Title
"IX",2006.587,2006.587,"D",.1,4,0)
      Gateway Location
"IX",2006.587,2006.587,"D",1)
S ^MAG(2006.587,"D",X(1),X(2),DA)=""
"IX",2006.587,2006.587,"D",2)
K ^MAG(2006.587,"D",X(1),X(2),DA)
"IX",2006.587,2006.587,"D",2.5)
K ^MAG(2006.587,"D")
"IX",2006.587,2006.587,"D",11.1,0)
^.114IA^2^2
"IX",2006.587,2006.587,"D",11.1,1,0)
1^F^2006.587^5^^1^F
"IX",2006.587,2006.587,"D",11.1,1,3)

"IX",2006.587,2006.587,"D",11.1,2,0)
2^F^2006.587^7^^2^F
"IX",2006.587,2006.587,"D",11.1,2,3)

"KRN",19,123457,-1)
0^1
"KRN",19,123457,0)
MAG DICOM QUERY RETRIEVE^DICOM Query/Retrieve^^B^^^^^^^^
"KRN",19,123457,1,0)
^^3^3^3041214^
"KRN",19,123457,1,1,0)
This menu option exists for the RPC Broker to establish
"KRN",19,123457,1,2,0)
an environment that grants a user access to the RPC subroutines
"KRN",19,123457,1,3,0)
that support DICOM Query/Retrieve.
"KRN",19,123457,"RPC",0)
^19.05P^9^8
"KRN",19,123457,"RPC",1,0)
MAG CFIND QUERY
"KRN",19,123457,"RPC",2,0)
MAG STUDY UID QUERY
"KRN",19,123457,"RPC",3,0)
XUS DIVISION GET
"KRN",19,123457,"RPC",4,0)
XUS DIVISION SET
"KRN",19,123457,"RPC",6,0)
MAG DICOM CHECK AE TITLE
"KRN",19,123457,"RPC",7,0)
MAG DICOM VISTA AE TITLE
"KRN",19,123457,"RPC",8,0)
MAG IMAGE CURRENT INFO
"KRN",19,123457,"RPC",9,0)
MAG DICOM GET GATEWAY INFO
"KRN",19,123457,"U")
DICOM QUERY/RETRIEVE
"KRN",19,123458,-1)
2^2
"KRN",19,123458,10,7,0)
22988
"KRN",19,123458,10,7,"^")
MAGD REMOVE GATEWAY FAILED
"KRN",19,123458,10,8,0)
22989
"KRN",19,123458,10,8,"^")
MAGD REMOVE GATEWAY XMIT
"KRN",19,123458,10,9,0)
22990
"KRN",19,123458,10,9,"^")
MAGD RENAME GATEWAY FAILED
"KRN",19,123458,0)
MAGD DICOM MENU^Dicom Menu Options^^M^126^^^^^^^
"KRN",19,123458,10,0)
^19.01IP^10^10
"KRN",19,123458,10,10,0)
22991
"KRN",19,123458,10,10,"^")
MAGD RENAME GATEWAY XMIT
"KRN",19,123458,"U")
DICOM MENU OPTIONS
"KRN",19,123459,-1)
0^3
"KRN",19,123459,0)
MAGD REMOVE GATEWAY FAILED^Clean Up DICOM Gateway (Failed Images)^^A^^^^^^^^^^1
"KRN",19,123459,1,0)
^^7^7^3061222^
"KRN",19,123459,1,1,0)
This menu option invokes a utility program that removes
"KRN",19,123459,1,2,0)
all entries that have been made for a specific DICOM Gateway
"KRN",19,123459,1,3,0)
from the DICOM FAILED IMAGES table (# 2006.575).
"KRN",19,123459,1,4,0)
 
"KRN",19,123459,1,5,0)
This option should be used when a DICOM Gateway is decommissioned
"KRN",19,123459,1,6,0)
without first correcting all failed images that were associated
"KRN",19,123459,1,7,0)
with that DICOM Gateway.
"KRN",19,123459,20)
D REMOFAIL^MAGDCCU1
"KRN",19,123459,"U")
REMOVE DICOM GATEWAY (FAILED I
"KRN",19,123460,-1)
0^4
"KRN",19,123460,0)
MAGD REMOVE GATEWAY XMIT^Clean Up Gateway (DICOM Destinations)^^A^^^^^^^^^^1
"KRN",19,123460,1,0)
^^7^7^3061222^
"KRN",19,123460,1,1,0)
This menu option invokes a utility program that removes
"KRN",19,123460,1,2,0)
all entries that have been made for a specific DICOM Gateway
"KRN",19,123460,1,3,0)
from the DICOM TRANSMIT DESTINATION table (#2006.587).
"KRN",19,123460,1,4,0)
 
"KRN",19,123460,1,5,0)
This option should be used when a DICOM Gateway is decommissioned
"KRN",19,123460,1,6,0)
without first removing all SCU_List entries that were associated
"KRN",19,123460,1,7,0)
with that DICOM gateway.
"KRN",19,123460,20)
D REMOXMIT^MAGDCCU1
"KRN",19,123460,"U")
REMOVE DICOM GATEWAY (TRANSMIT
"KRN",19,123461,-1)
0^5
"KRN",19,123461,0)
MAGD RENAME GATEWAY FAILED^Rename DICOM Gateway (Failed Images)^^A^^^^^^^^^^1
"KRN",19,123461,1,0)
^^7^7^3061222^
"KRN",19,123461,1,1,0)
This menu option invokes a utility program that renames
"KRN",19,123461,1,2,0)
all entries that have been made for a specific DICOM Gateway
"KRN",19,123461,1,3,0)
in the DICOM FAILED IMAGES table (#2006.575).
"KRN",19,123461,1,4,0)
 
"KRN",19,123461,1,5,0)
This option should be used when a DICOM Gateway is replaced
"KRN",19,123461,1,6,0)
with a new computer that has a different name, while there still
"KRN",19,123461,1,7,0)
are failed images to be corrected for that DICOM Gateway.
"KRN",19,123461,20)
D RENAFAIL^MAGDCCU1
"KRN",19,123461,"U")
RENAME DICOM GATEWAY (FAILED I
"KRN",19,123462,-1)
0^6
"KRN",19,123462,0)
MAGD RENAME GATEWAY XMIT^Rename DICOM Gateway (DICOM Destinations)^^A^^^^^^^^^^1
"KRN",19,123462,1,0)
^^7^7^3061222^
"KRN",19,123462,1,1,0)
This menu option invokes a utility program that renames
"KRN",19,123462,1,2,0)
all entries that have been made for a specific DICOM Gateway
"KRN",19,123462,1,3,0)
in the DICOM TRANSMIT DESTINATION table (#2006.587).
"KRN",19,123462,1,4,0)
 
"KRN",19,123462,1,5,0)
This option should be used when a DICOM Gateway is replaced
"KRN",19,123462,1,6,0)
with a new computer that has a different name, while there
"KRN",19,123462,1,7,0)
still are SCU_List entries registered for that DICOM Gateway.
"KRN",19,123462,20)
D RENAXMIT^MAGDCCU1
"KRN",19,123462,"U")
RENAME DICOM GATEWAY (TRANSMIT
"KRN",8994,123463,-1)
0^1
"KRN",8994,123463,0)
MAG DICOM CHECK AE TITLE^AETITLE^MAGDQR05^2^R^0^^0^4
"KRN",8994,123463,1,0)
^8994.01^2^2^3080327^^^^
"KRN",8994,123463,1,1,0)
This Remote Procedure checks whether an Application Entity
"KRN",8994,123463,1,2,0)
is specified on a DICOM Gateway that has the specified name.
"KRN",8994,123463,2,0)
^8994.02A^4^4
"KRN",8994,123463,2,1,0)
TITLE^1^16^1^1
"KRN",8994,123463,2,1,1,0)
^8994.021^4^4^3080327^^^
"KRN",8994,123463,2,1,1,1,0)
The value of this parameter is a string. This string is
"KRN",8994,123463,2,1,1,2,0)
constrained by the definition in the DICOM Standard
"KRN",8994,123463,2,1,1,3,0)
for the "title" of an Application Entity, that is: non-empty
"KRN",8994,123463,2,1,1,4,0)
and at most 16 characters in length.
"KRN",8994,123463,2,2,0)
SERVICE^1^20^1^2
"KRN",8994,123463,2,2,1,0)
^8994.021^5^5^3080327^^^^
"KRN",8994,123463,2,2,1,1,0)
The value of this parameter is a string. This string
"KRN",8994,123463,2,2,1,2,0)
identifies a DICOM DIMSE Service.
"KRN",8994,123463,2,2,1,3,0)
The procedure will validate that the specified Application
"KRN",8994,123463,2,2,1,4,0)
Entity is permitted to perform the service specified in
"KRN",8994,123463,2,2,1,5,0)
this parameter.
"KRN",8994,123463,2,3,0)
ROLE^1^3^1^3
"KRN",8994,123463,2,3,1,0)
^8994.021^5^5^3080327^^^^
"KRN",8994,123463,2,3,1,1,0)
The value of this parameter is a string. This string should
"KRN",8994,123463,2,3,1,2,0)
be equal to either "SCU" (Service Class User) or
"KRN",8994,123463,2,3,1,3,0)
"SCP" (Service Class Provider).
"KRN",8994,123463,2,3,1,4,0)
The procedure will validate that the specified Application
"KRN",8994,123463,2,3,1,5,0)
Entity is permitted to operate in the specified role.
"KRN",8994,123463,2,4,0)
LOCATION^1^6^1^4
"KRN",8994,123463,2,4,1,0)
^8994.021^3^3^3080327^^^^
"KRN",8994,123463,2,4,1,1,0)
The value of this parameter is a string.
"KRN",8994,123463,2,4,1,2,0)
  This string should be equal to a value from the INSTITIUTION File (#4).
"KRN",8994,123463,2,4,1,3,0)
  This is needed to return the appropriate AETitle.
"KRN",8994,123463,2,"B","LOCATION",4)

"KRN",8994,123463,2,"B","ROLE",3)

"KRN",8994,123463,2,"B","SERVICE",2)

"KRN",8994,123463,2,"B","TITLE",1)

"KRN",8994,123463,2,"PARAMSEQ",1,1)

"KRN",8994,123463,2,"PARAMSEQ",2,2)

"KRN",8994,123463,2,"PARAMSEQ",3,3)

"KRN",8994,123463,2,"PARAMSEQ",4,4)

"KRN",8994,123463,3,0)
^8994.03^9^9^3080327^^^^
"KRN",8994,123463,3,1,0)
The return parameter is an array. When the supplied title is
"KRN",8994,123463,3,2,0)
valid, the first element of the return array indicates the number
"KRN",8994,123463,3,3,0)
of entries, and the other elements are strings that look like
"KRN",8994,123463,3,4,0)
   service name ^ IP address ^ port number
"KRN",8994,123463,3,5,0)
 
"KRN",8994,123463,3,6,0)
When the supplied title is not valid, the array will have
"KRN",8994,123463,3,7,0)
only one element, which can have the values:
"KRN",8994,123463,3,8,0)
   -1,No AE Title specified
"KRN",8994,123463,3,9,0)
   -2,No entry for AE Title "xxx".
"KRN",8994,123464,-1)
1^2
"KRN",8994,123464,0)
MAG DICOM CHECK MACHINE ID
"KRN",8994,123465,-1)
0^3
"KRN",8994,123465,0)
MAG DICOM GET GATEWAY INFO^GETINFO^MAGDQR05^2^R^0^^0^3
"KRN",8994,123465,1,0)
^^2^2^3060215^
"KRN",8994,123465,1,1,0)
This Remote Procedure returns information about a
"KRN",8994,123465,1,2,0)
DICOM Gateway.
"KRN",8994,123465,2,0)
^8994.02A^1^1
"KRN",8994,123465,2,1,0)
HOSTNAME^1^30^1^1
"KRN",8994,123465,2,1,1,0)
^^4^4^3060215^
"KRN",8994,123465,2,1,1,1,0)
The value of this parameter is a string.
"KRN",8994,123465,2,1,1,2,0)
This string must be the "hostname" of the computer that is
"KRN",8994,123465,2,1,1,3,0)
being used to operate the DICOM Gateway for which information
"KRN",8994,123465,2,1,1,4,0)
is to be returned.
"KRN",8994,123465,2,"B","HOSTNAME",1)

"KRN",8994,123465,2,"PARAMSEQ",1,1)

"KRN",8994,123465,3,0)
^^13^13^3060215^
"KRN",8994,123465,3,1,0)
The return information for this Remote Procedure is returned
"KRN",8994,123465,3,2,0)
as an array.
"KRN",8994,123465,3,3,0)
 
"KRN",8994,123465,3,4,0)
When there is an error in the operation of this procedure,
"KRN",8994,123465,3,5,0)
the array will contain only one entry that describes the error,
"KRN",8994,123465,3,6,0)
e.g.:
"KRN",8994,123465,3,7,0)
   -1,No HostName provided.
"KRN",8994,123465,3,8,0)
   -2,Cannot find info for "xxx".
"KRN",8994,123465,3,9,0)
 
"KRN",8994,123465,3,10,0)
When there is information to be returned, the first array element
"KRN",8994,123465,3,11,0)
will indicate the number of valid entries in the result-array,
"KRN",8994,123465,3,12,0)
and the further elements will contain data in the form of
"KRN",8994,123465,3,13,0)
   keyword=value
"KRN",8994,123466,-1)
0^4
"KRN",8994,123466,0)
MAG DICOM GET MACHINE ID^GETID^MAGDRPC1^1^R^0^^0^3
"KRN",8994,123466,1,0)
^8994.01^18^18^3060711^
"KRN",8994,123466,1,1,0)
 +---------------------------------------------------------------+
"KRN",8994,123466,1,2,0)
 | Property of the US Government.                                |
"KRN",8994,123466,1,3,0)
 | No permission to copy or redistribute this software is given. |
"KRN",8994,123466,1,4,0)
 | Use of unreleased versions of this software requires the user |
"KRN",8994,123466,1,5,0)
 | to execute a written test agreement with the VistA Imaging    |
"KRN",8994,123466,1,6,0)
 | Development Office of the Department of Veterans Affairs,     |
"KRN",8994,123466,1,7,0)
 | telephone (301) 734-0100.                                     |
"KRN",8994,123466,1,8,0)
 |                                                               |
"KRN",8994,123466,1,9,0)
 | The Food and Drug Administration classifies this software as  |
"KRN",8994,123466,1,10,0)
 | a medical device.  As such, it may not be changed in any way. |
"KRN",8994,123466,1,11,0)
 | Modifications to this software may result in an adulterated   |
"KRN",8994,123466,1,12,0)
 | medical device under 21CFR820, the use of which is considered |
"KRN",8994,123466,1,13,0)
 | to be a violation of US Federal Statutes.                     |
"KRN",8994,123466,1,14,0)
 +---------------------------------------------------------------+
"KRN",8994,123466,1,15,0)
 
"KRN",8994,123466,1,16,0)
This Remote Procedure returns the internal entry number of
"KRN",8994,123466,1,17,0)
the entry for the specified computer in the table of registered
"KRN",8994,123466,1,18,0)
DICOM Gateways.
"KRN",8994,123466,2,0)
^8994.02A^1^1
"KRN",8994,123466,2,1,0)
HOSTNAME^1^30^1^1
"KRN",8994,123466,2,1,1,0)
^^5^5^3060711^
"KRN",8994,123466,2,1,1,1,0)
The value of this parameter is a string. This string is the
"KRN",8994,123466,2,1,1,2,0)
"host name" of a computer. Many sites follow the standard
"KRN",8994,123466,2,1,1,3,0)
to use names like VHAxxxabcde, where xxx is a three-letter
"KRN",8994,123466,2,1,1,4,0)
abbreviation for the name of the site, and abcde is the
"KRN",8994,123466,2,1,1,5,0)
actual name of the computer.
"KRN",8994,123466,2,"B","HOSTNAME",1)

"KRN",8994,123466,2,"PARAMSEQ",1,1)

"KRN",8994,123466,3,0)
^^11^11^3060711^
"KRN",8994,123466,3,1,0)
The value of the return parameter is a string.
"KRN",8994,123466,3,2,0)
When the numeric interpretation of this string is a negative
"KRN",8994,123466,3,3,0)
number, the value indicates an error condition, e.g.:
"KRN",8994,123466,3,4,0)
   -1,No Hostname Specified
"KRN",8994,123466,3,5,0)
 
"KRN",8994,123466,3,6,0)
When the value of the return parameter is a positive number,
"KRN",8994,123466,3,7,0)
this number is the internal entry number for the entry
"KRN",8994,123466,3,8,0)
in the table of registered DICOM Gateways (#2006.5641).
"KRN",8994,123466,3,9,0)
 
"KRN",8994,123466,3,10,0)
When no entry exists for the specified computer, this RPC
"KRN",8994,123466,3,11,0)
will create a new entry.
"KRN",8994,123467,-1)
0^5
"KRN",8994,123467,0)
MAG DICOM GET UID ROOT^UIDROOT^MAGDRPC9^1^R^0^^0^3
"KRN",8994,123467,1,0)
^8994.01^20^20^3061115^^
"KRN",8994,123467,1,1,0)
 +---------------------------------------------------------------+
"KRN",8994,123467,1,2,0)
 | Property of the US Government.                                |
"KRN",8994,123467,1,3,0)
 | No permission to copy or redistribute this software is given. |
"KRN",8994,123467,1,4,0)
 | Use of unreleased versions of this software requires the user |
"KRN",8994,123467,1,5,0)
 | to execute a written test agreement with the VistA Imaging    |
"KRN",8994,123467,1,6,0)
 | Development Office of the Department of Veterans Affairs,     |
"KRN",8994,123467,1,7,0)
 | telephone (301) 734-0100.                                     |
"KRN",8994,123467,1,8,0)
 |                                                               |
"KRN",8994,123467,1,9,0)
 | The Food and Drug Administration classifies this software as  |
"KRN",8994,123467,1,10,0)
 | a medical device.  As such, it may not be changed in any way. |
"KRN",8994,123467,1,11,0)
 | Modifications to this software may result in an adulterated   |
"KRN",8994,123467,1,12,0)
 | medical device under 21CFR820, the use of which is considered |
"KRN",8994,123467,1,13,0)
 | to be a violation of US Federal Statutes.                     |
"KRN",8994,123467,1,14,0)
 +---------------------------------------------------------------+
"KRN",8994,123467,1,15,0)
 
"KRN",8994,123467,1,16,0)
This Remote Procedure returns the value of the DICOM root UID
"KRN",8994,123467,1,17,0)
that is to be prefixed to all UIDs that are generated on this system
"KRN",8994,123467,1,18,0)
and its client systems.
"KRN",8994,123467,1,19,0)
 
"KRN",8994,123467,1,20,0)
The format and meaning of a DICOM UID is specified in the DICOM Standard.
"KRN",8994,123467,3,0)
^^3^3^3061115^
"KRN",8994,123467,3,1,0)
The return value of this Remote Procedure is a string.
"KRN",8994,123467,3,2,0)
This string is a series of digits and periods that meets the definition
"KRN",8994,123467,3,3,0)
of an UID as specified in the DICOM standard.
"KRN",8994,123468,-1)
0^6
"KRN",8994,123468,0)
MAG DICOM GET UID TABLE^SERVER^MAGDUID3^2^R^^^^3
"KRN",8994,123468,1,0)
^8994.01^17^17^3071003^^
"KRN",8994,123468,1,1,0)
 +---------------------------------------------------------------+
"KRN",8994,123468,1,2,0)
 | Property of the US Government.                                |
"KRN",8994,123468,1,3,0)
 | No permission to copy or redistribute this software is given. |
"KRN",8994,123468,1,4,0)
 | Use of unreleased versions of this software requires the user |
"KRN",8994,123468,1,5,0)
 | to execute a written test agreement with the VistA Imaging    |
"KRN",8994,123468,1,6,0)
 | Development Office of the Department of Veterans Affairs,     |
"KRN",8994,123468,1,7,0)
 | telephone (301) 734-0100.                                     |
"KRN",8994,123468,1,8,0)
 |                                                               |
"KRN",8994,123468,1,9,0)
 | The Food and Drug Administration classifies this software as  |
"KRN",8994,123468,1,10,0)
 | a medical device.  As such, it may not be changed in any way. |
"KRN",8994,123468,1,11,0)
 | Modifications to this software may result in an adulterated   |
"KRN",8994,123468,1,12,0)
 | medical device under 21CFR820, the use of which is considered |
"KRN",8994,123468,1,13,0)
 | to be a violation of US Federal Statutes.                     |
"KRN",8994,123468,1,14,0)
 +---------------------------------------------------------------+
"KRN",8994,123468,1,15,0)
 
"KRN",8994,123468,1,16,0)
This Remote Procedure transmits the current content of the
"KRN",8994,123468,1,17,0)
UID table from VistA to the DICOM Gateways.
"KRN",8994,123468,2,0)
^8994.02A^2^2
"KRN",8994,123468,2,1,0)
OFFSET^1^100^1^2
"KRN",8994,123468,2,1,1,0)
^^9^9^3071001^
"KRN",8994,123468,2,1,1,1,0)
The value of this parameter is a string.
"KRN",8994,123468,2,1,1,2,0)
 
"KRN",8994,123468,2,1,1,3,0)
The first time this Remote Procedure is called for a certain
"KRN",8994,123468,2,1,1,4,0)
"master file", the value of this parameter must be empty.
"KRN",8994,123468,2,1,1,5,0)
 
"KRN",8994,123468,2,1,1,6,0)
Each next time this Remote Procedure is called for the same
"KRN",8994,123468,2,1,1,7,0)
"master file", the value of this parameter must be copied from
"KRN",8994,123468,2,1,1,8,0)
the return array, so that the Remote Procedure will continue
"KRN",8994,123468,2,1,1,9,0)
where it left off in the previous call.
"KRN",8994,123468,2,2,0)
MAX^1^15^1^3
"KRN",8994,123468,2,2,1,0)
^8994.021^3^3^3071003^^
"KRN",8994,123468,2,2,1,1,0)
The value of this parameter is a positive integer number.
"KRN",8994,123468,2,2,1,2,0)
This value indicates the maximum number of values that may be
"KRN",8994,123468,2,2,1,3,0)
returned in each call to this Remote Procedure.
"KRN",8994,123468,2,"B","MAX",2)

"KRN",8994,123468,2,"B","OFFSET",1)

"KRN",8994,123468,2,"PARAMSEQ",1,1)

"KRN",8994,123468,2,"PARAMSEQ",2,1)

"KRN",8994,123468,2,"PARAMSEQ",2,2)

"KRN",8994,123468,2,"PARAMSEQ",3,2)

"KRN",8994,123468,3,0)
^8994.03^10^10^3071003^^
"KRN",8994,123468,3,1,0)
The return parameter for this Remote Procedure is an array.
"KRN",8994,123468,3,2,0)
 
"KRN",8994,123468,3,3,0)
The first element of this array is either a positive
"KRN",8994,123468,3,4,0)
integer number that indicates the number of elements that follow,
"KRN",8994,123468,3,5,0)
or a negative number that indicates an error condition.
"KRN",8994,123468,3,6,0)
 
"KRN",8994,123468,3,7,0)
The subsequent elements of this array are organized in pairs.
"KRN",8994,123468,3,8,0)
The first element of each pair is a reference to a global variable.
"KRN",8994,123468,3,9,0)
The second element of each pair is the value that is to be stored
"KRN",8994,123468,3,10,0)
in that global variable.
"KRN",8994,123469,-1)
0^7
"KRN",8994,123469,0)
MAG DICOM IMAGE AUDIT GET^GET2^MAGDRPC7^2^R^0^0^1^3^0
"KRN",8994,123469,1,0)
^8994.01^17^17^3060515^
"KRN",8994,123469,1,1,0)
 +---------------------------------------------------------------+
"KRN",8994,123469,1,2,0)
 | Property of the US Government.                                |
"KRN",8994,123469,1,3,0)
 | No permission to copy or redistribute this software is given. |
"KRN",8994,123469,1,4,0)
 | Use of unreleased versions of this software requires the user |
"KRN",8994,123469,1,5,0)
 | to execute a written test agreement with the VistA Imaging    |
"KRN",8994,123469,1,6,0)
 | Development Office of the Department of Veterans Affairs,     |
"KRN",8994,123469,1,7,0)
 | telephone (301) 734-0100.                                     |
"KRN",8994,123469,1,8,0)
 |                                                               |
"KRN",8994,123469,1,9,0)
 | The Food and Drug Administration classifies this software as  |
"KRN",8994,123469,1,10,0)
 | a medical device.  As such, it may not be changed in any way. |
"KRN",8994,123469,1,11,0)
 | Modifications to this software may result in an adulterated   |
"KRN",8994,123469,1,12,0)
 | medical device under 21CFR820, the use of which is considered |
"KRN",8994,123469,1,13,0)
 | to be a violation of US Federal Statutes.                     |
"KRN",8994,123469,1,14,0)
 +---------------------------------------------------------------+
"KRN",8994,123469,1,15,0)
 
"KRN",8994,123469,1,16,0)
This RPC call fetches the statistical information
"KRN",8994,123469,1,17,0)
that is collected about the acquisition of images.
"KRN",8994,123469,2,0)
^8994.02A^5^5
"KRN",8994,123469,2,1,0)
LOCATION^1^10^1^1
"KRN",8994,123469,2,1,1,0)
^8994.021^2^2
"KRN",8994,123469,2,1,1,1,0)
The value of this parameter is a pointer to ^DIC(4).
"KRN",8994,123469,2,1,1,2,0)
This pointer identifies the location at which images were acquired.
"KRN",8994,123469,2,2,0)
START^1^10^0^2
"KRN",8994,123469,2,2,1,0)
^8994.021^3^3
"KRN",8994,123469,2,2,1,1,0)
The value of this parameter is a (FileMan) date.
"KRN",8994,123469,2,2,1,2,0)
This date, if specified, indicates the first day for which statistics
"KRN",8994,123469,2,2,1,3,0)
are to be returned.
"KRN",8994,123469,2,3,0)
STOP^1^10^0^3
"KRN",8994,123469,2,3,1,0)
^8994.021^3^3^3060515^
"KRN",8994,123469,2,3,1,1,0)
The value of this parameter is a (FileMan) date.
"KRN",8994,123469,2,3,1,2,0)
This date, if specified, indicates the last day for which statistics
"KRN",8994,123469,2,3,1,3,0)
are to be returned.
"KRN",8994,123469,2,4,0)
MAX^1^10^0^4
"KRN",8994,123469,2,4,1,0)
^^6^6^3060515^
"KRN",8994,123469,2,4,1,1,0)
The value of this parameter is an integer number. This number
"KRN",8994,123469,2,4,1,2,0)
indicates the maximum number of audit-data records that is
"KRN",8994,123469,2,4,1,3,0)
to be returned in each call to this RPC.
"KRN",8994,123469,2,4,1,4,0)
 
"KRN",8994,123469,2,4,1,5,0)
When this parameter is not specified, a default value of 100
"KRN",8994,123469,2,4,1,6,0)
will be assumed.
"KRN",8994,123469,2,5,0)
OFFSET^1^10^0^5
"KRN",8994,123469,2,5,1,0)
^^11^11^3060515^
"KRN",8994,123469,2,5,1,1,0)
The value of this parameter is a positive integer number.
"KRN",8994,123469,2,5,1,2,0)
This number indicates the point in the retrieval sequence where
"KRN",8994,123469,2,5,1,3,0)
a previous call to this RPC "left off".
"KRN",8994,123469,2,5,1,4,0)
 
"KRN",8994,123469,2,5,1,5,0)
On the initial call of a series to obtain audit information,
"KRN",8994,123469,2,5,1,6,0)
the value of this parameter should be equal to 0.
"KRN",8994,123469,2,5,1,7,0)
 
"KRN",8994,123469,2,5,1,8,0)
On each subsequent call, the value that should be specified for
"KRN",8994,123469,2,5,1,9,0)
the OFFSET should be equal to the value that was returned in
"KRN",8994,123469,2,5,1,10,0)
the previous call as the second (comma-separated) piece of
"KRN",8994,123469,2,5,1,11,0)
the value in the first element of the OUT array.
"KRN",8994,123469,2,"B","LOCATION",1)

"KRN",8994,123469,2,"B","MAX",4)

"KRN",8994,123469,2,"B","OFFSET",5)

"KRN",8994,123469,2,"B","START",2)

"KRN",8994,123469,2,"B","STOP",3)

"KRN",8994,123469,2,"PARAMSEQ",1,1)

"KRN",8994,123469,2,"PARAMSEQ",2,2)

"KRN",8994,123469,2,"PARAMSEQ",3,3)

"KRN",8994,123469,2,"PARAMSEQ",4,4)

"KRN",8994,123469,2,"PARAMSEQ",5,5)

"KRN",8994,123469,3,0)
^8994.03^10^10^3060515^
"KRN",8994,123469,3,1,0)
The output array contains a number of entries.
"KRN",8994,123469,3,2,0)
 
"KRN",8994,123469,3,3,0)
Each entry has up to six pieces:
"KRN",8994,123469,3,4,0)
  date ^ acquisition count ^ instrument ^ last acquisition ^
"KRN",8994,123469,3,5,0)
         processing count ^ last processing timestamp
"KRN",8994,123469,3,6,0)
 
"KRN",8994,123469,3,7,0)
The first couple of entries have no values for date
"KRN",8994,123469,3,8,0)
and count; these entries are there to be able to first
"KRN",8994,123469,3,9,0)
establish a list of all relevant instruments,
"KRN",8994,123469,3,10,0)
and then present the counts for the various dates.
"KRN",8994,123470,-1)
0^8
"KRN",8994,123470,0)
MAG DICOM STORE GATEWAY INFO^GWINFO^MAGDQR05^1^R^0^^0^4
"KRN",8994,123470,1,0)
^8994.01^2^2^3060216^^
"KRN",8994,123470,1,1,0)
This Remote Procedure stores information about a DICOM Gateway
"KRN",8994,123470,1,2,0)
in the VistA system.
"KRN",8994,123470,2,0)
^8994.02A^5^4
"KRN",8994,123470,2,1,0)
HOSTNAME^1^30^1^1
"KRN",8994,123470,2,1,1,0)
^8994.021^4^4^3080327^^
"KRN",8994,123470,2,1,1,1,0)
The value of this parameter is a string.
"KRN",8994,123470,2,1,1,2,0)
This value must be the "hostname" of a computer that is being
"KRN",8994,123470,2,1,1,3,0)
used to operate the DICOM Gateway for which the information
"KRN",8994,123470,2,1,1,4,0)
is being stored.
"KRN",8994,123470,2,3,0)
LOCATION^1^10^1^2
"KRN",8994,123470,2,3,1,0)
^8994.021^3^3^3080327^^^
"KRN",8994,123470,2,3,1,1,0)
The value of this parameter is a pointer to the Institution file (#4).
"KRN",8994,123470,2,3,1,2,0)
The location being pointed to is the one for which the DICOM Gateway
"KRN",8994,123470,2,3,1,3,0)
operates.
"KRN",8994,123470,2,4,0)
FILES^2^32000^1^3
"KRN",8994,123470,2,4,1,0)
^8994.021^5^5^3080327^^^
"KRN",8994,123470,2,4,1,1,0)
This parameter is an array.
"KRN",8994,123470,2,4,1,2,0)
The entries in this array contain information about files
"KRN",8994,123470,2,4,1,3,0)
on the DICOM Gateway.
"KRN",8994,123470,2,4,1,4,0)
For each file, a timestamp (most recent modification) and
"KRN",8994,123470,2,4,1,5,0)
the full path+file name is included.
"KRN",8994,123470,2,5,0)
VERSION^2^32000^1^4
"KRN",8994,123470,2,5,1,0)
^8994.021^6^6^3080327^^^^
"KRN",8994,123470,2,5,1,1,0)
This parameter is an array.
"KRN",8994,123470,2,5,1,2,0)
The entries in this array contain information about the
"KRN",8994,123470,2,5,1,3,0)
version stamps of the various executables in the DICOM
"KRN",8994,123470,2,5,1,4,0)
Gateway application.
"KRN",8994,123470,2,5,1,5,0)
For each component, a timestamp (most recent modification)
"KRN",8994,123470,2,5,1,6,0)
and the full path+file name is included.
"KRN",8994,123470,2,"B","FILES",4)

"KRN",8994,123470,2,"B","HOSTNAME",1)

"KRN",8994,123470,2,"B","LOCATION",3)

"KRN",8994,123470,2,"B","VERSION",5)

"KRN",8994,123470,2,"PARAMSEQ",1,1)

"KRN",8994,123470,2,"PARAMSEQ",2,3)

"KRN",8994,123470,2,"PARAMSEQ",3,4)

"KRN",8994,123470,2,"PARAMSEQ",4,5)

"KRN",8994,123470,3,0)
^8994.03^6^6^3060216^^
"KRN",8994,123470,3,1,0)
The return value for this procedure is a single value.
"KRN",8994,123470,3,2,0)
This value is either 0 (successful completion) or a negative
"KRN",8994,123470,3,3,0)
number indication an error, such as:
"KRN",8994,123470,3,4,0)
   -1,No HostName provided.
"KRN",8994,123470,3,5,0)
   -2,No Machine ID provided.
"KRN",8994,123470,3,6,0)
   -3,No location provided.
"KRN",8994,123471,-1)
1^9
"KRN",8994,123471,0)
MAG DICOM UPDATE MACHINE ID
"KRN",8994,123472,-1)
0^10
"KRN",8994,123472,0)
MAG DICOM VISTA AE TITLE^VATITLE^MAGDQR05^1^R^0^^0^3
"KRN",8994,123472,1,0)
^^3^3^3051115^
"KRN",8994,123472,1,1,0)
This Remote Procedure returns a string that can be used
"KRN",8994,123472,1,2,0)
as a DICOM Application Entity title for the purpose
"KRN",8994,123472,1,3,0)
established by the parameters to this procedure.
"KRN",8994,123472,2,0)
^8994.02A^3^3
"KRN",8994,123472,2,1,0)
SERVICE^1^20^1^1
"KRN",8994,123472,2,1,1,0)
^^5^5^3051115^
"KRN",8994,123472,2,1,1,1,0)
The value of this parameter is a string. This string
"KRN",8994,123472,2,1,1,2,0)
identifies a DICOM DIMSE Service.
"KRN",8994,123472,2,1,1,3,0)
The procedure will validate that the specified Application
"KRN",8994,123472,2,1,1,4,0)
Entity is permitted to perform the service specified in
"KRN",8994,123472,2,1,1,5,0)
this parameter.
"KRN",8994,123472,2,2,0)
ROLE^1^3^1^2
"KRN",8994,123472,2,2,1,0)
^8994.021^5^5^3080327^^^
"KRN",8994,123472,2,2,1,1,0)
The value of this parameter is a string. This string should
"KRN",8994,123472,2,2,1,2,0)
be equal to either "SCU" (Service Class User) or
"KRN",8994,123472,2,2,1,3,0)
"SCP" (Service Class Provider).
"KRN",8994,123472,2,2,1,4,0)
The procedure will validate that the specified Application
"KRN",8994,123472,2,2,1,5,0)
Entity is permitted to operate in the specified role.
"KRN",8994,123472,2,3,0)
LOCATION^1^6^1^3
"KRN",8994,123472,2,3,1,0)
^^4^4^3080327^
"KRN",8994,123472,2,3,1,1,0)
The value of this parameter is a string.  This string is compared to
"KRN",8994,123472,2,3,1,2,0)
the appropriate value in the INSTITUTION File (#4).
"KRN",8994,123472,2,3,1,3,0)
This is needed to return the appropriate AETitle that represents a
"KRN",8994,123472,2,3,1,4,0)
specific division.
"KRN",8994,123472,2,"B","LOCATION",3)

"KRN",8994,123472,2,"B","ROLE",2)

"KRN",8994,123472,2,"B","SERVICE",1)

"KRN",8994,123472,2,"PARAMSEQ",1,1)

"KRN",8994,123472,2,"PARAMSEQ",2,2)

"KRN",8994,123472,2,"PARAMSEQ",3,3)

"KRN",8994,123473,-1)
0^11
"KRN",8994,123473,0)
MAG GET DICOM XMIT ORIGIN^LISTORIG^MAGDRPC1^2^R^^^^3
"KRN",8994,123473,1,0)
^^5^5^3070601^
"KRN",8994,123473,1,0)
^8994.01^18^18^3060515^
"KRN",8994,123473,1,1,0)
 +---------------------------------------------------------------+
"KRN",8994,123473,1,2,0)
 | Property of the US Government.                                |
"KRN",8994,123473,1,3,0)
 | No permission to copy or redistribute this software is given. |
"KRN",8994,123473,1,4,0)
 | Use of unreleased versions of this software requires the user |
"KRN",8994,123473,1,5,0)
 | to execute a written test agreement with the VistA Imaging    |
"KRN",8994,123473,1,6,0)
 | Development Office of the Department of Veterans Affairs,     |
"KRN",8994,123473,1,7,0)
 | telephone (301) 734-0100.                                     |
"KRN",8994,123473,1,8,0)
 |                                                               |
"KRN",8994,123473,1,9,0)
 | The Food and Drug Administration classifies this software as  |
"KRN",8994,123473,1,10,0)
 | a medical device.  As such, it may not be changed in any way. |
"KRN",8994,123473,1,11,0)
 | Modifications to this software may result in an adulterated   |
"KRN",8994,123473,1,12,0)
 | medical device under 21CFR820, the use of which is considered |
"KRN",8994,123473,1,13,0)
 | to be a violation of US Federal Statutes.                     |
"KRN",8994,123473,1,14,0)
 +---------------------------------------------------------------+
"KRN",8994,123473,1,15,0)
 
"KRN",8994,123473,1,16,0)
This Remote Procedure returns the list of locations for which
"KRN",8994,123473,1,17,0)
currently images are queued to be transmitted using the DICOM
"KRN",8994,123473,1,18,0)
protocol.
"KRN",8994,123473,3,0)
^^9^9^3070601^
"KRN",8994,123473,3,1,0)
The return parameter of this remote procedure is an array.
"KRN",8994,123473,3,2,0)
When the transmission queue is empty, this array contains only
"KRN",8994,123473,3,3,0)
one element, with the value:
"KRN",8994,123473,3,4,0)
   "No entries in transmission queue"
"KRN",8994,123473,3,5,0)
When there are entries in the transmission queue, the first
"KRN",8994,123473,3,6,0)
element of the array will be a counter, and each further element
"KRN",8994,123473,3,7,0)
will contain two values:
"KRN",8994,123473,3,8,0)
    IEN of location ^ name of location
"KRN",8994,123473,3,9,0)
e.g. "660^SALT LAKE CITY"
"KRN",8994,123474,-1)
0^12
"KRN",8994,123474,0)
MAG IMAGE CURRENT INFO^INFO^MAGDQR04^2^R^0^^0^3
"KRN",8994,123474,1,0)
^^3^3^3050713^
"KRN",8994,123474,1,1,0)
This Remote Procedure returns current values for the various
"KRN",8994,123474,1,2,0)
DICOM tags that are to be included in the header of an exported
"KRN",8994,123474,1,3,0)
image.
"KRN",8994,123474,2,0)
^8994.02A^1^1
"KRN",8994,123474,2,1,0)
IMAGE^1^20^1^1
"KRN",8994,123474,2,1,1,0)
^^4^4^3050713^
"KRN",8994,123474,2,1,1,1,0)
The value of this parameter is a number. This number is a pointer
"KRN",8994,123474,2,1,1,2,0)
into the Image File (#2005).
"KRN",8994,123474,2,1,1,3,0)
This RPC will return information for the image that is identified
"KRN",8994,123474,2,1,1,4,0)
by this pointer-value.
"KRN",8994,123474,2,"B","IMAGE",1)

"KRN",8994,123474,2,"PARAMSEQ",1,1)

"KRN",8994,123474,3,0)
^^7^7^3050713^
"KRN",8994,123474,3,1,0)
The return parameter for this Remote Procedure is an array.
"KRN",8994,123474,3,2,0)
The first element contains a status for the execution of
"KRN",8994,123474,3,3,0)
the request. A negative value indicates a problem,
"KRN",8994,123474,3,4,0)
a positive value represents the number of DICOM tags returned.
"KRN",8994,123474,3,5,0)
 
"KRN",8994,123474,3,6,0)
The other array elements contain the relevant return-values
"KRN",8994,123474,3,7,0)
in the format tag, caret, value.
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",454,-1)
1^1
"PKG",454,0)
IMAGING^MAG^Imaging Release History
"PKG",454,22,0)
^9.49I^1^1
"PKG",454,22,1,0)
3.0^3020328^3020328^.5
"PKG",454,22,1,"PAH",1,0)
54^3090703^.5
"PKG",454,22,1,"PAH",1,1,0)
^9.49011^69^69^3090703
"PKG",454,22,1,"PAH",1,1,1,0)
Routines for Patch 54, Test Build 40.
"PKG",454,22,1,"PAH",1,1,2,0)
 
"PKG",454,22,1,"PAH",1,1,3,0)
Routines:
"PKG",454,22,1,"PAH",1,1,4,0)
MAG7UM      value = 8243232
"PKG",454,22,1,"PAH",1,1,5,0)
MAGBRTE4    value = 15309819
"PKG",454,22,1,"PAH",1,1,6,0)
MAGBRTE5    value = 11533293
"PKG",454,22,1,"PAH",1,1,7,0)
MAGBRTUT    value = 10523100
"PKG",454,22,1,"PAH",1,1,8,0)
MAGDCCS     value = 14420572
"PKG",454,22,1,"PAH",1,1,9,0)
MAGDCCS2    value = 6833559
"PKG",454,22,1,"PAH",1,1,10,0)
MAGDCCU1    value = 8041167
"PKG",454,22,1,"PAH",1,1,11,0)
MAGDHL7     value = 7011790
"PKG",454,22,1,"PAH",1,1,12,0)
MAGDHLE     value = 4675728
"PKG",454,22,1,"PAH",1,1,13,0)
MAGDHRC0    value = 4527100
"PKG",454,22,1,"PAH",1,1,14,0)
MAGDHWC     value = 12121799
"PKG",454,22,1,"PAH",1,1,15,0)
MAGDHWS     value = 8776710
"PKG",454,22,1,"PAH",1,1,16,0)
MAGDIR8     value = 5249219
"PKG",454,22,1,"PAH",1,1,17,0)
MAGDIR81    value = 16249703
"PKG",454,22,1,"PAH",1,1,18,0)
MAGDIR82    value = 13986318
"PKG",454,22,1,"PAH",1,1,19,0)
MAGDIR83    value = 8305683
"PKG",454,22,1,"PAH",1,1,20,0)
MAGDIR84    value = 7051552
"PKG",454,22,1,"PAH",1,1,21,0)
MAGDIR9A    value = 11702546
"PKG",454,22,1,"PAH",1,1,22,0)
MAGDIR9B    value = 7619455
"PKG",454,22,1,"PAH",1,1,23,0)
MAGDIR9E    value = 14977047
"PKG",454,22,1,"PAH",1,1,24,0)
MAGDIRVE    value = 15724398
"PKG",454,22,1,"PAH",1,1,25,0)
MAGDLB1     value = 12075022
"PKG",454,22,1,"PAH",1,1,26,0)
MAGDLBAA    value = 6712810
"PKG",454,22,1,"PAH",1,1,27,0)
MAGDMEDL    value = 6951528
"PKG",454,22,1,"PAH",1,1,28,0)
MAGDQR00    value = 2548544
"PKG",454,22,1,"PAH",1,1,29,0)
MAGDQR01    value = 11135896
"PKG",454,22,1,"PAH",1,1,30,0)
MAGDQR02    value = 14306691
"PKG",454,22,1,"PAH",1,1,31,0)
MAGDQR03    value = 17339843
"PKG",454,22,1,"PAH",1,1,32,0)
MAGDQR04    value = 14824047
"PKG",454,22,1,"PAH",1,1,33,0)
MAGDQR05    value = 10792454
"PKG",454,22,1,"PAH",1,1,34,0)
MAGDQR06    value = 7405913
"PKG",454,22,1,"PAH",1,1,35,0)
MAGDQR07    value = 10362545
"PKG",454,22,1,"PAH",1,1,36,0)
MAGDQR08    value = 8854962
"PKG",454,22,1,"PAH",1,1,37,0)
MAGDRA2     value = 7976145
"PKG",454,22,1,"PAH",1,1,38,0)
MAGDRCU1    value = 8596186
"PKG",454,22,1,"PAH",1,1,39,0)
MAGDRCU2    value = 9821221
"PKG",454,22,1,"PAH",1,1,40,0)
MAGDRPC1    value = 9674272
"PKG",454,22,1,"PAH",1,1,41,0)
MAGDRPC2    value = 13440631
"PKG",454,22,1,"PAH",1,1,42,0)
MAGDRPC3    value = 14608057
"PKG",454,22,1,"PAH",1,1,43,0)
MAGDRPC4    value = 17974720
"PKG",454,22,1,"PAH",1,1,44,0)
MAGDRPC5    value = 15092525
"PKG",454,22,1,"PAH",1,1,45,0)
MAGDRPC6    value = 11312515
"PKG",454,22,1,"PAH",1,1,46,0)
MAGDRPC7    value = 9459019
"PKG",454,22,1,"PAH",1,1,47,0)
MAGDRPC8    value = 11952944
"PKG",454,22,1,"PAH",1,1,48,0)
MAGDRPC9    value = 11126815
"PKG",454,22,1,"PAH",1,1,49,0)
MAGDRUID    value = 2900467
"PKG",454,22,1,"PAH",1,1,50,0)
MAGDTR02    value = 11542094
"PKG",454,22,1,"PAH",1,1,51,0)
MAGDTR03    value = 17495982
"PKG",454,22,1,"PAH",1,1,52,0)
MAGDTR05    value = 12670562
"PKG",454,22,1,"PAH",1,1,53,0)
MAGDTR06    value = 10445490
"PKG",454,22,1,"PAH",1,1,54,0)
MAGDUID3    value = 3204144
"PKG",454,22,1,"PAH",1,1,55,0)
MAGENCHK    value = 3430893
"PKG",454,22,1,"PAH",1,1,56,0)
MAGIPS54    value = 11466893
"PKG",454,22,1,"PAH",1,1,57,0)
MAGUE001    value = 4780297
"PKG",454,22,1,"PAH",1,1,58,0)
MAGUE002    value = 3962070
"PKG",454,22,1,"PAH",1,1,59,0)
MAGUE003    value = 2916905
"PKG",454,22,1,"PAH",1,1,60,0)
MAGVCHK     value = 8124399
"PKG",454,22,1,"PAH",1,1,61,0)
MAGXCVC     value = 12902535
"PKG",454,22,1,"PAH",1,1,62,0)
MAGXCVI     value = 12650053
"PKG",454,22,1,"PAH",1,1,63,0)
MAGXCVP     value = 10064211
"PKG",454,22,1,"PAH",1,1,64,0)
MAGXCVR     value = 16926210
"PKG",454,22,1,"PAH",1,1,65,0)
MAGXCVS     value = 18315672
"PKG",454,22,1,"PAH",1,1,66,0)
MAGXIDXU    value = 21366591
"PKG",454,22,1,"PAH",1,1,67,0)
 
"PKG",454,22,1,"PAH",1,1,68,0)
Please note that routine MAGIPS54 is deleted after the KIDS Build is
"PKG",454,22,1,"PAH",1,1,69,0)
installed.
"PRE")
MAGENCHK
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
63
"RTN","MAG7UM")
0^1^B23898950
"RTN","MAG7UM",1,0)
MAG7UM ;WOIFO/MLH - Imaging - HL7 - utilities - make a message from a parse tree; 05/18/2007 11:23
"RTN","MAG7UM",2,0)
 ;;3.0;IMAGING;**11,54**;03-July-2009;;Build 1424
"RTN","MAG7UM",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAG7UM",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAG7UM",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAG7UM",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAG7UM",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAG7UM",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAG7UM",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAG7UM",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAG7UM",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAG7UM",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAG7UM",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAG7UM",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAG7UM",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAG7UM",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAG7UM",17,0)
 ;;
"RTN","MAG7UM",18,0)
 Q
"RTN","MAG7UM",19,0)
 ;
"RTN","MAG7UM",20,0)
MAKE(XTREE,XMSG) ; make a parse tree into an array of message lines
"RTN","MAG7UM",21,0)
 ;
"RTN","MAG7UM",22,0)
 ; INPUT:     XTREE     The name of the parse tree ($NA format)
"RTN","MAG7UM",23,0)
 ;   Parse tree structure:
"RTN","MAG7UM",24,0)
 ;   @XTREE@(NSEG,0)                    segment name
"RTN","MAG7UM",25,0)
 ;   @XTREE@(NSEG,NFLD,NREP,NCMP,NSCM)  element data
"RTN","MAG7UM",26,0)
 ;   @XTREE@("B",SEGID,NSEG)            null
"RTN","MAG7UM",27,0)
 ;   
"RTN","MAG7UM",28,0)
 ;            XMSG      The name of a single-dimensional array to be populated
"RTN","MAG7UM",29,0)
 ;                      with message lines ($NA format).  This array is
"RTN","MAG7UM",30,0)
 ;                      cleared on invocation.
"RTN","MAG7UM",31,0)
 ;                      
"RTN","MAG7UM",32,0)
 ;  OUTPUT:   XMSG      The array after being populated with message lines
"RTN","MAG7UM",33,0)
 ; 
"RTN","MAG7UM",34,0)
 N UFS,UCS,URS,UEC,USS ;---------------- HL7 delimiters (universal)
"RTN","MAG7UM",35,0)
 N X,I ; --------------------------------- scratch var
"RTN","MAG7UM",36,0)
 N ERR ; ------------------------------- error flag
"RTN","MAG7UM",37,0)
 N ENC ; ------------------------------- encoding characters string
"RTN","MAG7UM",38,0)
 N NSEG ; ------------------------------ segment number in the parse tree
"RTN","MAG7UM",39,0)
 N NMSEG ; ----------------------------- segment number in the message
"RTN","MAG7UM",40,0)
 N IMSG ; ------------------------------ message array index
"RTN","MAG7UM",41,0)
 N SEG ; ------------------------------- segment data
"RTN","MAG7UM",42,0)
 N NFLD ; ------------------------------ field number in the segment
"RTN","MAG7UM",43,0)
 N FLD ; ------------------------------- field data
"RTN","MAG7UM",44,0)
 ;
"RTN","MAG7UM",45,0)
 K @XMSG ; refresh target array
"RTN","MAG7UM",46,0)
 ; process MSH segment
"RTN","MAG7UM",47,0)
 Q:$D(@XTREE)<10 -1 ; parse tree sent?
"RTN","MAG7UM",48,0)
 S NSEG=$O(@XTREE@("")),NMSEG=1
"RTN","MAG7UM",49,0)
 Q:$G(@XTREE@(NSEG,0))'="MSH" -2 ; an HL7 message?
"RTN","MAG7UM",50,0)
 Q:$D(@XTREE@(NSEG,9,1,1,1))#10=0 -3 ; message type provided? 
"RTN","MAG7UM",51,0)
 ; get delimiters or define defaults
"RTN","MAG7UM",52,0)
 S UFS=$G(@XTREE@(NSEG,1,1,1,1)) I $L(UFS)-1 S UFS="|"
"RTN","MAG7UM",53,0)
 S ENC=$G(@XTREE@(NSEG,2,1,1,1)) I $L(ENC)-4 S ENC="^~\&"
"RTN","MAG7UM",54,0)
 S UCS=$E(ENC),URS=$E(ENC,2),UEC=$E(ENC,3),USS=$E(ENC,4)
"RTN","MAG7UM",55,0)
 I $D(@XTREE@(NSEG,3,1,1,1))#10=0 S @XTREE@(1,3,1,1,1)="VistA Imaging"
"RTN","MAG7UM",56,0)
 S @XTREE@(NSEG,7,1,1,1)=$$NOW^XLFDT()+17000000*1000000
"RTN","MAG7UM",57,0)
 I $D(@XTREE@(NSEG,10,1,1,1))#10=0 D
"RTN","MAG7UM",58,0)
 . S X=""
"RTN","MAG7UM",59,0)
 . F I=1:1:16 S X=X_$E("0123456789ABCDEF",$R(16)+1)
"RTN","MAG7UM",60,0)
 . S @XTREE@(NSEG,10,1,1,1)=X
"RTN","MAG7UM",61,0)
 . Q
"RTN","MAG7UM",62,0)
 I $D(@XTREE@(NSEG,11,1,1,1))#10=0 S @XTREE@(NSEG,11,1,1,1)="D"
"RTN","MAG7UM",63,0)
 I $D(@XTREE@(NSEG,12,1,1,1))#10=0 S @XTREE@(NSEG,12,1,1,1)="2.3.1"
"RTN","MAG7UM",64,0)
 S SEG="MSH"_UFS_ENC
"RTN","MAG7UM",65,0)
 S NFLD=2
"RTN","MAG7UM",66,0)
 F  S NFLD=$O(@XTREE@(NSEG,NFLD)) Q:NFLD=""  D PROCFLD(XTREE,NSEG,NFLD,.SEG)
"RTN","MAG7UM",67,0)
 S @XMSG@(NMSEG)=SEG
"RTN","MAG7UM",68,0)
 F  S NSEG=$O(@XTREE@(NSEG)) Q:'NSEG  D
"RTN","MAG7UM",69,0)
 . K SEG
"RTN","MAG7UM",70,0)
 . S NMSEG=NMSEG+1
"RTN","MAG7UM",71,0)
 . S NFLD=0
"RTN","MAG7UM",72,0)
 . F  S NFLD=$O(@XTREE@(NSEG,NFLD)) Q:NFLD=""  D PROCFLD(XTREE,NSEG,NFLD,.SEG)
"RTN","MAG7UM",73,0)
 . S @XMSG@(NMSEG)=$G(@XTREE@(NSEG,0))_$S($G(SEG)]"":UFS_SEG,1:"")
"RTN","MAG7UM",74,0)
 . Q
"RTN","MAG7UM",75,0)
 Q 0
"RTN","MAG7UM",76,0)
 ;
"RTN","MAG7UM",77,0)
PROCFLD(XTREE,XNSEG,XNFLD,XSEG) ; process a field
"RTN","MAG7UM",78,0)
 ;
"RTN","MAG7UM",79,0)
 ; input:  XTREE   name of MUMPS array for parse tree ($NA format)
"RTN","MAG7UM",80,0)
 ;         XNSEG   segment number for parse tree
"RTN","MAG7UM",81,0)
 ;         XNFLD   field number for parse tree
"RTN","MAG7UM",82,0)
 ;         .XSEG   segment before addition of field
"RTN","MAG7UM",83,0)
 ;         
"RTN","MAG7UM",84,0)
 ; output: .XSEG   segment after addition of field
"RTN","MAG7UM",85,0)
 ;
"RTN","MAG7UM",86,0)
 N NREP ; ---- repetition (occurrence) number
"RTN","MAG7UM",87,0)
 N REP ; ----- repetition data
"RTN","MAG7UM",88,0)
 N NCMP ; ---- component number
"RTN","MAG7UM",89,0)
 N CMP ; ----- component data
"RTN","MAG7UM",90,0)
 N NSCM ; ---- subcomponent number
"RTN","MAG7UM",91,0)
 N SCM ; ----- subcomponent data
"RTN","MAG7UM",92,0)
 N FLD ; ----- field data
"RTN","MAG7UM",93,0)
 ;
"RTN","MAG7UM",94,0)
 S NREP=""
"RTN","MAG7UM",95,0)
 F  S NREP=$O(@XTREE@(XNSEG,XNFLD,NREP)) Q:NREP=""  D
"RTN","MAG7UM",96,0)
 . K REP
"RTN","MAG7UM",97,0)
 . S NCMP=""
"RTN","MAG7UM",98,0)
 . F  S NCMP=$O(@XTREE@(XNSEG,XNFLD,NREP,NCMP)) Q:NCMP=""  D
"RTN","MAG7UM",99,0)
 . . K CMP
"RTN","MAG7UM",100,0)
 . . S NSCM=""
"RTN","MAG7UM",101,0)
 . . F  S NSCM=$O(@XTREE@(XNSEG,XNFLD,NREP,NCMP,NSCM)) Q:NSCM=""  D
"RTN","MAG7UM",102,0)
 . . . S SCM=@XTREE@(XNSEG,XNFLD,NREP,NCMP,NSCM)
"RTN","MAG7UM",103,0)
 . . . S $P(CMP,USS,NSCM)=$$ESC(.SCM)
"RTN","MAG7UM",104,0)
 . . . Q
"RTN","MAG7UM",105,0)
 . . S $P(REP,UCS,NCMP)=CMP
"RTN","MAG7UM",106,0)
 . . Q
"RTN","MAG7UM",107,0)
 . S $P(FLD,URS,NREP)=REP
"RTN","MAG7UM",108,0)
 . Q
"RTN","MAG7UM",109,0)
 S $P(XSEG,UFS,NFLD)=$G(FLD)
"RTN","MAG7UM",110,0)
 Q
"RTN","MAG7UM",111,0)
 ;
"RTN","MAG7UM",112,0)
ESC(XDTA) ;apply escape sequence to data
"RTN","MAG7UM",113,0)
 ; Insert an intermediate token, then expand the intermediate token to
"RTN","MAG7UM",114,0)
 ; the real escape sequence.  (We have to do 2 steps because the escape
"RTN","MAG7UM",115,0)
 ; sequence uses the escape character.)
"RTN","MAG7UM",116,0)
 F  Q:XDTA'[UFS  S XDTA=$P(XDTA,UFS)_$C(1)_$P(XDTA,UFS,2,999)
"RTN","MAG7UM",117,0)
 F  Q:XDTA'[UCS  S XDTA=$P(XDTA,UCS)_$C(2)_$P(XDTA,UCS,2,999)
"RTN","MAG7UM",118,0)
 F  Q:XDTA'[URS  S XDTA=$P(XDTA,URS)_$C(3)_$P(XDTA,URS,2,999)
"RTN","MAG7UM",119,0)
 F  Q:XDTA'[UEC  S XDTA=$P(XDTA,UEC)_$C(4)_$P(XDTA,UEC,2,999)
"RTN","MAG7UM",120,0)
 F  Q:XDTA'[USS  S XDTA=$P(XDTA,USS)_$C(5)_$P(XDTA,USS,2,999)
"RTN","MAG7UM",121,0)
 F  Q:XDTA'[$C(1)  S XDTA=$P(XDTA,$C(1))_UEC_"F"_UEC_$P(XDTA,$C(1),2,999)
"RTN","MAG7UM",122,0)
 F  Q:XDTA'[$C(2)  S XDTA=$P(XDTA,$C(2))_UEC_"S"_UEC_$P(XDTA,$C(2),2,999)
"RTN","MAG7UM",123,0)
 F  Q:XDTA'[$C(3)  S XDTA=$P(XDTA,$C(3))_UEC_"R"_UEC_$P(XDTA,$C(3),2,999)
"RTN","MAG7UM",124,0)
 F  Q:XDTA'[$C(4)  S XDTA=$P(XDTA,$C(4))_UEC_"E"_UEC_$P(XDTA,$C(4),2,999)
"RTN","MAG7UM",125,0)
 F  Q:XDTA'[$C(5)  S XDTA=$P(XDTA,$C(5))_UEC_"T"_UEC_$P(XDTA,$C(5),2,999)
"RTN","MAG7UM",126,0)
 Q XDTA
"RTN","MAG7UM",127,0)
 ;
"RTN","MAGBRTE4")
0^2^B74476689
"RTN","MAGBRTE4",1,0)
MAGBRTE4 ;WOIFO/EdM - Process Routing Rule Evaluation Queue ; 06/08/2007 10:28
"RTN","MAGBRTE4",2,0)
 ;;3.0;IMAGING;**11,30,51,85,54**;03-July-2009;;Build 1424
"RTN","MAGBRTE4",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGBRTE4",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGBRTE4",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGBRTE4",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGBRTE4",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGBRTE4",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGBRTE4",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGBRTE4",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGBRTE4",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGBRTE4",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGBRTE4",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGBRTE4",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGBRTE4",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGBRTE4",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGBRTE4",17,0)
 ;;
"RTN","MAGBRTE4",18,0)
 Q
"RTN","MAGBRTE4",19,0)
 ;
"RTN","MAGBRTE4",20,0)
EVAL ;
"RTN","MAGBRTE4",21,0)
 N ACTIVE ;--- Switch that controls start/stop queue processor
"RTN","MAGBRTE4",22,0)
 N ANY ;------ Flag: processed any rule
"RTN","MAGBRTE4",23,0)
 N CONS ;----- Switch that indicates whether or not site has "consolidated" code
"RTN","MAGBRTE4",24,0)
 N KEYWORD ;-- Array with all keywords
"RTN","MAGBRTE4",25,0)
 N MAGFILE1 ;- Name of file
"RTN","MAGBRTE4",26,0)
 N XMSG ;----- Message counter
"RTN","MAGBRTE4",27,0)
 ;
"RTN","MAGBRTE4",28,0)
 F I="MAGEVAL","MAGEVALSTUDY" K ^XTMP(I,ZTSK)
"RTN","MAGBRTE4",29,0)
 D LOG^MAGBRTE5("Started at "_$H)
"RTN","MAGBRTE4",30,0)
 S XMSG=1,CONS=$$CONSOLID^MAGBAPI()
"RTN","MAGBRTE4",31,0)
 S PLACE=$S(CONS:$O(^MAG(2006.1,"B",LOCATION,"")),1:1)
"RTN","MAGBRTE4",32,0)
 L +^MAGDICOM(2006.563,1,"EVAL",LOCATION):0 E  D  Q
"RTN","MAGBRTE4",33,0)
 . D LOG^MAGBRTE5("A rule evaluator is already running for "_$$GET1^DIQ(4,LOCATION,.01))
"RTN","MAGBRTE4",34,0)
 . Q
"RTN","MAGBRTE4",35,0)
 S ^MAGDICOM(2006.563,1,"EVAL")=1
"RTN","MAGBRTE4",36,0)
 ;
"RTN","MAGBRTE4",37,0)
 S I="" F  S I=$O(RULES(I)) Q:I=""  D
"RTN","MAGBRTE4",38,0)
 . N D0,D1,D2,L,Q1
"RTN","MAGBRTE4",39,0)
 . S X=RULES(I),D0=$P(X,"^",1),Q1=$P(X,"^",2),L=$L(X,"^")
"RTN","MAGBRTE4",40,0)
 . I L=3 S RULE(D0,Q1)=$P(X,"^",3) Q
"RTN","MAGBRTE4",41,0)
 . I Q1="ACTION" S RULE(D0,Q1,$P(X,"^",3))=$P(X,"^",4,L) Q
"RTN","MAGBRTE4",42,0)
 . I Q1'="CONDITION" D LOG^MAGBRTE5("Rule "_D0_" has a qualifier """_Q1_""".") Q
"RTN","MAGBRTE4",43,0)
 . I L=5 S RULE(D0,Q1,$P(X,"^",3),$P(X,"^",4))=$P(X,"^",5) Q
"RTN","MAGBRTE4",44,0)
 . S RULE(D0,Q1,$P(X,"^",3),$P(X,"^",4),$P(X,"^",6),$P(X,"^",5))=$P(X,"^",7)
"RTN","MAGBRTE4",45,0)
 . Q
"RTN","MAGBRTE4",46,0)
 K RULES
"RTN","MAGBRTE4",47,0)
 ;
"RTN","MAGBRTE4",48,0)
 S ACTIVE=1 F  D  Q:'ACTIVE
"RTN","MAGBRTE4",49,0)
 . S ANY=0
"RTN","MAGBRTE4",50,0)
 . S ACTIVE=+$G(^MAGDICOM(2006.563,1,"EVAL")) I 'ACTIVE D  Q
"RTN","MAGBRTE4",51,0)
 . . D LOG^MAGBRTE5("Stopped at "_$H)
"RTN","MAGBRTE4",52,0)
 . . Q
"RTN","MAGBRTE4",53,0)
 . D
"RTN","MAGBRTE4",54,0)
 . . N IMAGE,QPTR,QPTR2,STATUS,X
"RTN","MAGBRTE4",55,0)
 . . D:'CONS ADD^MAGBAPI(0,"EVAL")
"RTN","MAGBRTE4",56,0)
 . . D:CONS ADD^MAGBAPI(0,"EVAL",PLACE)
"RTN","MAGBRTE4",57,0)
 . . S QPTR2=$O(^MAGQUEUE(2006.031,"B","EVAL",""))
"RTN","MAGBRTE4",58,0)
 . . S QPTR=$S(QPTR2:$P(^MAGQUEUE(2006.031,QPTR2,0),"^",2),1:"")
"RTN","MAGBRTE4",59,0)
 . . ; Get next queue pointer value
"RTN","MAGBRTE4",60,0)
 . . S:'CONS QPTR=$O(^MAGQUEUE(2006.03,"B","EVAL",QPTR))
"RTN","MAGBRTE4",61,0)
 . . S:CONS QPTR=$O(^MAGQUEUE(2006.03,"C",PLACE,"EVAL",QPTR))
"RTN","MAGBRTE4",62,0)
 . . I QPTR="" Q  ; Nothing to do
"RTN","MAGBRTE4",63,0)
 . . ;
"RTN","MAGBRTE4",64,0)
 . . S X=$G(^MAGQUEUE(2006.03,QPTR,0))
"RTN","MAGBRTE4",65,0)
 . . ; After an error, sometimes the entry is purged,
"RTN","MAGBRTE4",66,0)
 . . ; but the cross reference is still present.
"RTN","MAGBRTE4",67,0)
 . . ; In such a case, remove the cross reference.
"RTN","MAGBRTE4",68,0)
 . . I X="" D  Q
"RTN","MAGBRTE4",69,0)
 . . . K:'CONS ^MAGQUEUE(2006.03,"B","EVAL",QPTR)
"RTN","MAGBRTE4",70,0)
 . . . K:CONS ^MAGQUEUE(2006.03,"C",PLACE,"EVAL",QPTR)
"RTN","MAGBRTE4",71,0)
 . . . Q
"RTN","MAGBRTE4",72,0)
 . . ;
"RTN","MAGBRTE4",73,0)
 . . S IMAGE=$P(X,"^",7),ANY=1
"RTN","MAGBRTE4",74,0)
 . . I IMAGE,$D(^MAG(2005,IMAGE,0)) D
"RTN","MAGBRTE4",75,0)
 . . . S STATUS=$$RULES() Q:STATUS'<0
"RTN","MAGBRTE4",76,0)
 . . . I STATUS["NO NETWORK LOCATION" D  Q
"RTN","MAGBRTE4",77,0)
 . . . . D LOG^MAGBRTE5("Image "_IMAGE_" has no files associated with it")
"RTN","MAGBRTE4",78,0)
 . . . . Q
"RTN","MAGBRTE4",79,0)
 . . . D LOG^MAGBRTE5("*** EVAL queue error: "_STATUS_" ***")
"RTN","MAGBRTE4",80,0)
 . . . Q
"RTN","MAGBRTE4",81,0)
 . . K ^MAGQUEUE(2006.03,QPTR)
"RTN","MAGBRTE4",82,0)
 . . K:'CONS ^MAGQUEUE(2006.03,"B","EVAL",QPTR)
"RTN","MAGBRTE4",83,0)
 . . K:CONS ^MAGQUEUE(2006.03,"C",PLACE,"EVAL",QPTR)
"RTN","MAGBRTE4",84,0)
 . . S $P(^MAGQUEUE(2006.03,0),"^",4)=$P(^MAGQUEUE(2006.03,0),"^",4)-1
"RTN","MAGBRTE4",85,0)
 . . Q
"RTN","MAGBRTE4",86,0)
 . H:'ANY 1
"RTN","MAGBRTE4",87,0)
 . D:'$D(^XTMP("MAGEVAL",ZTSK)) XTINIT^MAGDRPC5,LOG^MAGBRTE5("^XTMP was cleaned up.")
"RTN","MAGBRTE4",88,0)
 . Q
"RTN","MAGBRTE4",89,0)
 L -^MAGDICOM(2006.563,1,"EVAL",LOCATION)
"RTN","MAGBRTE4",90,0)
 Q
"RTN","MAGBRTE4",91,0)
 ;
"RTN","MAGBRTE4",92,0)
RULES() ; To be called from above
"RTN","MAGBRTE4",93,0)
 ; IMAGE ;---- IEN for image (2005)
"RTN","MAGBRTE4",94,0)
 ; LOCATION ;- Location from which queue entry originates
"RTN","MAGBRTE4",95,0)
 N ACTION ;--- Action to be taken (SEND)
"RTN","MAGBRTE4",96,0)
 N C ;-------- Loop-variable for looping through parameters and conditions
"RTN","MAGBRTE4",97,0)
 N D ;-------- Data type
"RTN","MAGBRTE4",98,0)
 N DS ;------- Data type enclosed in space-characters
"RTN","MAGBRTE4",99,0)
 N F ;-------- ...
"RTN","MAGBRTE4",100,0)
 N METMSG ;--- Message to be issued when rule is evaluated
"RTN","MAGBRTE4",101,0)
 N O ;-------- Operator
"RTN","MAGBRTE4",102,0)
 N OK ;------- Flag: indicates whether or not rule is met
"RTN","MAGBRTE4",103,0)
 N RDT ;------ Current date (don't use DT, process might run over midnight)
"RTN","MAGBRTE4",104,0)
 N STUDYUID ;- Study UID
"RTN","MAGBRTE4",105,0)
 N V ;-------- Value for property as specified in rule
"RTN","MAGBRTE4",106,0)
 N VAL ;------ Actual value of property
"RTN","MAGBRTE4",107,0)
 N VRS ;------ String of Queue Entry numbers when rule(s) are met
"RTN","MAGBRTE4",108,0)
 N X ;-------- Scratch variable
"RTN","MAGBRTE4",109,0)
 ;
"RTN","MAGBRTE4",110,0)
 S VRS=""
"RTN","MAGBRTE4",111,0)
 ;
"RTN","MAGBRTE4",112,0)
 D KEYWORD^MAGBRTK
"RTN","MAGBRTE4",113,0)
 ;
"RTN","MAGBRTE4",114,0)
 D FILEFIND^MAGDFB(IMAGE,"FULL",0,0,.MAGFILE1)
"RTN","MAGBRTE4",115,0)
 Q:MAGFILE1<0 MAGFILE1
"RTN","MAGBRTE4",116,0)
 ;
"RTN","MAGBRTE4",117,0)
 S STUDYUID=$P($G(^MAG(2005,IMAGE,"PACS")),"^",1)
"RTN","MAGBRTE4",118,0)
 S X=$P($G(^MAG(2005,IMAGE,0)),"^",10)
"RTN","MAGBRTE4",119,0)
 S:X STUDYUID=$P($G(^MAG(2005,X,"PACS")),"^",1)
"RTN","MAGBRTE4",120,0)
 ;
"RTN","MAGBRTE4",121,0)
 S RULE=0 F  S RULE=$O(RULE(RULE)) Q:'RULE  D
"RTN","MAGBRTE4",122,0)
 . S METMSG=$G(RULE(RULE,"ACTION"))
"RTN","MAGBRTE4",123,0)
 . S X=" (",C=0 F  S C=$O(RULE(RULE,"ACTION",C)) Q:'C  D
"RTN","MAGBRTE4",124,0)
 . . S METMSG=METMSG_X_$G(RULE(RULE,"ACTION",C)),X=", "
"RTN","MAGBRTE4",125,0)
 . . Q
"RTN","MAGBRTE4",126,0)
 . S:X'=" (" METMSG=METMSG_")"
"RTN","MAGBRTE4",127,0)
 . S:METMSG="" METMSG="Rule #"_RULE
"RTN","MAGBRTE4",128,0)
 . S OK=$G(^XTMP("MAGEVALSTUDY",ZTSK,STUDYUID,RULE))
"RTN","MAGBRTE4",129,0)
 . I OK="" S OK=1,C=0 F  S C=$O(RULE(RULE,"CONDITION",C)) Q:'C  D  Q:'OK
"RTN","MAGBRTE4",130,0)
 . . S F=$G(RULE(RULE,"CONDITION",C,"KW")) Q:F=""
"RTN","MAGBRTE4",131,0)
 . . S X=$G(KEYWORD("CONDITION",F),"^DICOM^MAGBRTE3(F,""OUT"",.VAL)")
"RTN","MAGBRTE4",132,0)
 . . K VAL D @$P(X,"^",2,9)
"RTN","MAGBRTE4",133,0)
 . . ; If the field is not defined, the test passes...
"RTN","MAGBRTE4",134,0)
 . . Q:$D(VAL)'=1  ; We won't deal with multiple values just yet...
"RTN","MAGBRTE4",135,0)
 . . ;
"RTN","MAGBRTE4",136,0)
 . . S V=$G(RULE(RULE,"CONDITION",C,"VA"))
"RTN","MAGBRTE4",137,0)
 . . S D=$G(RULE(RULE,"CONDITION",C,"DT"))
"RTN","MAGBRTE4",138,0)
 . . S O=$G(RULE(RULE,"CONDITION",C,"OP"))
"RTN","MAGBRTE4",139,0)
 . . S:D="" D="S"
"RTN","MAGBRTE4",140,0)
 . . S DS=" "_D_" "
"RTN","MAGBRTE4",141,0)
 . . D:" S CS DS IS LO LT OB OW PN SH ST "[DS
"RTN","MAGBRTE4",142,0)
 . . . N WILD ;-- Wildcard to be matched
"RTN","MAGBRTE4",143,0)
 . . . S WILD=$$WLDMATCH^MAGBRTE5(VAL,V)
"RTN","MAGBRTE4",144,0)
 . . . I O="=",'WILD S OK=0 Q
"RTN","MAGBRTE4",145,0)
 . . . I O="!=",WILD S OK=0 Q
"RTN","MAGBRTE4",146,0)
 . . . Q
"RTN","MAGBRTE4",147,0)
 . . D:" DT DA TM "[DS
"RTN","MAGBRTE4",148,0)
 . . . Q:O'="="  ; Only "within range" comparisons allowed currently
"RTN","MAGBRTE4",149,0)
 . . . ;
"RTN","MAGBRTE4",150,0)
 . . . N A ;--- Flag: indicates whether at least one time-frame matches
"RTN","MAGBRTE4",151,0)
 . . . N B ;--- Begin date/time
"RTN","MAGBRTE4",152,0)
 . . . N E ;--- End date/time
"RTN","MAGBRTE4",153,0)
 . . . N I ;--- Loopcounter
"RTN","MAGBRTE4",154,0)
 . . . N M ;--- Date/time mask
"RTN","MAGBRTE4",155,0)
 . . . N N ;--- Loopcounter (time-frames)
"RTN","MAGBRTE4",156,0)
 . . . N %T ;-- FileMan internal variable
"RTN","MAGBRTE4",157,0)
 . . . N VV ;-- Actual value
"RTN","MAGBRTE4",158,0)
 . . . N WD ;-- Weekday
"RTN","MAGBRTE4",159,0)
 . . . N X1 ;-- FileMan API parameter value -- date
"RTN","MAGBRTE4",160,0)
 . . . N X2 ;-- FileMan API parameter value -- date
"RTN","MAGBRTE4",161,0)
 . . . ;
"RTN","MAGBRTE4",162,0)
 . . . ; convert the literal date/time field into the format for comparison
"RTN","MAGBRTE4",163,0)
 . . . S VV=VAL
"RTN","MAGBRTE4",164,0)
 . . . ;
"RTN","MAGBRTE4",165,0)
 . . . S (A,N)=0 F  S N=$O(RULE(RULE,"CONDITION",C,"VA",N)) Q:'N  D
"RTN","MAGBRTE4",166,0)
 . . . . N T,VB,VC,VE
"RTN","MAGBRTE4",167,0)
 . . . . S M=$G(RULE(RULE,"CONDITION",C,"VA",N,"M"))
"RTN","MAGBRTE4",168,0)
 . . . . S B=$G(RULE(RULE,"CONDITION",C,"VA",N,"B"))
"RTN","MAGBRTE4",169,0)
 . . . . S E=$G(RULE(RULE,"CONDITION",C,"VA",N,"E"))
"RTN","MAGBRTE4",170,0)
 . . . . S T=1
"RTN","MAGBRTE4",171,0)
 . . . . I $E(M,1,3)="HOL" S:$$GET1^DIQ(40.5,+$E(VV,5,11),.01)="" T=0 ; IA 10038
"RTN","MAGBRTE4",172,0)
 . . . . I $E(M,1,3)="DDD",$E(B,1,3)'=$E(VAL,1,3) S T=0
"RTN","MAGBRTE4",173,0)
 . . . . S (VB,VC,VE)=""
"RTN","MAGBRTE4",174,0)
 . . . . F I=4:1:$L(M) S:$E(M,I)?1U VC=VC_$E(VV,I),VB=VB_$E(B,I),VE=VE_$E(E,I)
"RTN","MAGBRTE4",175,0)
 . . . . S:VB>VC T=0
"RTN","MAGBRTE4",176,0)
 . . . . S:VE<VC T=0
"RTN","MAGBRTE4",177,0)
 . . . . S:T A=1
"RTN","MAGBRTE4",178,0)
 . . . . Q
"RTN","MAGBRTE4",179,0)
 . . . S:'A OK=0
"RTN","MAGBRTE4",180,0)
 . . . Q
"RTN","MAGBRTE4",181,0)
 . . Q
"RTN","MAGBRTE4",182,0)
 . S ^XTMP("MAGEVALSTUDY",ZTSK,STUDYUID,RULE)=OK
"RTN","MAGBRTE4",183,0)
 . S METMSG(OK,METMSG)=""
"RTN","MAGBRTE4",184,0)
 . S RDT=$$NOW^XLFDT()\1
"RTN","MAGBRTE4",185,0)
 . Q:'OK
"RTN","MAGBRTE4",186,0)
 . S ACTION=$G(RULE(RULE,"ACTION"))
"RTN","MAGBRTE4",187,0)
 . Q:ACTION=""
"RTN","MAGBRTE4",188,0)
 . I ACTION="SEND" D  Q
"RTN","MAGBRTE4",189,0)
 . . N D,PRI,X
"RTN","MAGBRTE4",190,0)
 . . S X=$G(RULE(RULE,"ACTION",1))
"RTN","MAGBRTE4",191,0)
 . . I X="" S METMSG(0,"No location for rule "_RULE)="" Q
"RTN","MAGBRTE4",192,0)
 . . D VALDEST^MAGDRPC1(.D,X)
"RTN","MAGBRTE4",193,0)
 . . I D<0 S METMSG(0,"Cannot find location """_X_""".")="" Q
"RTN","MAGBRTE4",194,0)
 . . S PRI=$$PRI($G(RULE(RULE,"PRIORITY")),IMAGE)
"RTN","MAGBRTE4",195,0)
 . . S VRS=$$VRS^MAGBRTE5(VRS,$$SEND^MAGBRTE5(IMAGE,D,PRI,1,LOCATION))
"RTN","MAGBRTE4",196,0)
 . . Q
"RTN","MAGBRTE4",197,0)
 . I ACTION="DICOM" D  Q
"RTN","MAGBRTE4",198,0)
 . . N D,PRI,X
"RTN","MAGBRTE4",199,0)
 . . S X=$G(RULE(RULE,"ACTION",1))
"RTN","MAGBRTE4",200,0)
 . . I X="" S METMSG(0,"No location for rule "_RULE)="" Q
"RTN","MAGBRTE4",201,0)
 . . S D=$O(^MAG(2006.587,"B",X,""))
"RTN","MAGBRTE4",202,0)
 . . I D="" S METMSG(0,"Cannot find location """_X_""".")="" Q
"RTN","MAGBRTE4",203,0)
 . . S PRI=$$PRI($G(RULE(RULE,"PRIORITY")),IMAGE)
"RTN","MAGBRTE4",204,0)
 . . S VRS=$$VRS^MAGBRTE5(VRS,$$SEND^MAGBRTE5(IMAGE,D,PRI,2,LOCATION))
"RTN","MAGBRTE4",205,0)
 . . Q
"RTN","MAGBRTE4",206,0)
 . I ACTION="BALANCE" D BALANCE^MAGBRTE5(IMAGE,.RULE) Q
"RTN","MAGBRTE4",207,0)
 . ;
"RTN","MAGBRTE4",208,0)
 . ; Other actions to be inserted here...
"RTN","MAGBRTE4",209,0)
 . ;
"RTN","MAGBRTE4",210,0)
 . Q
"RTN","MAGBRTE4",211,0)
 ;
"RTN","MAGBRTE4",212,0)
 ; Note: we may have:
"RTN","MAGBRTE4",213,0)
 ;    Rule 1: If CR, send to XXX
"RTN","MAGBRTE4",214,0)
 ;    Rule 2: If CT, send to XXX
"RTN","MAGBRTE4",215,0)
 ; For a CR, this would cause an entry of
"RTN","MAGBRTE4",216,0)
 ;    METMSG(0,"SEND(XXX)") for rule 2
"RTN","MAGBRTE4",217,0)
 ; and an entry of
"RTN","MAGBRTE4",218,0)
 ;    METMSG(1,"SEND(XXX)") for rule 1
"RTN","MAGBRTE4",219,0)
 ; and for a CT it would be the other way around.
"RTN","MAGBRTE4",220,0)
 ; So, first remove all "failed" entries that were successful
"RTN","MAGBRTE4",221,0)
 ; for a different rule.
"RTN","MAGBRTE4",222,0)
 ;
"RTN","MAGBRTE4",223,0)
 S X="" F  S X=$O(METMSG(1,X)) Q:X=""  D
"RTN","MAGBRTE4",224,0)
 . D LOG^MAGBRTE5("Image "_IMAGE_": "_X)
"RTN","MAGBRTE4",225,0)
 . K METMSG(0,X)
"RTN","MAGBRTE4",226,0)
 . Q
"RTN","MAGBRTE4",227,0)
 S X="" F  S X=$O(METMSG(0,X)) Q:X=""  D
"RTN","MAGBRTE4",228,0)
 . D LOG^MAGBRTE5("Image "_IMAGE_": Do not "_X)
"RTN","MAGBRTE4",229,0)
 . Q
"RTN","MAGBRTE4",230,0)
 Q VRS
"RTN","MAGBRTE4",231,0)
 ;
"RTN","MAGBRTE4",232,0)
 ;
"RTN","MAGBRTE4",233,0)
PRI(PRI,IMAGE) N C,D0,D1,D2,O,P,R,X
"RTN","MAGBRTE4",234,0)
 S PRI=$S(PRI="HIGH":750,PRI="NORMAL":500,PRI="LOW":250,1:500)
"RTN","MAGBRTE4",235,0)
 S X=$G(^MAG(2005,IMAGE,2))
"RTN","MAGBRTE4",236,0)
 S P=$P(X,"^",6) Q:P'=74 PRI
"RTN","MAGBRTE4",237,0)
 S R=$P(X,"^",7) Q:'R PRI
"RTN","MAGBRTE4",238,0)
 S C=$P($G(^RARPT(R,0)),"^",1) Q:C="" PRI  ; IA 1171
"RTN","MAGBRTE4",239,0)
 S D0=$O(^RADPT("ADC",C,"")) Q:'D0 PRI  ; IA 1172
"RTN","MAGBRTE4",240,0)
 S D1=$O(^RADPT("ADC",C,D0,"")) Q:'D1 PRI  ; IA 1172
"RTN","MAGBRTE4",241,0)
 S D2=$O(^RADPT("ADC",C,D0,D1,"")) Q:'D2 PRI  ; IA 1172
"RTN","MAGBRTE4",242,0)
 S O=$P($G(^RADPT(D0,"DT",D1,"P",D2,0)),"^",11) Q:'O PRI  ; IA 1172
"RTN","MAGBRTE4",243,0)
 S X=$P($G(^RAO(75.1,O,0)),"^",6) ; IA 3074
"RTN","MAGBRTE4",244,0)
 Q PRI+$S(X=1:20,X=2:10,1:0)
"RTN","MAGBRTE4",245,0)
 ;
"RTN","MAGBRTE5")
0^3^B47168607
"RTN","MAGBRTE5",1,0)
MAGBRTE5 ;WOIFO/PMK - Background Routing - Load Balance ; 06/08/2007 10:28
"RTN","MAGBRTE5",2,0)
 ;;3.0;IMAGING;**11,30,51,85,54**;03-July-2009;;Build 1424
"RTN","MAGBRTE5",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGBRTE5",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGBRTE5",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGBRTE5",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGBRTE5",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGBRTE5",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGBRTE5",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGBRTE5",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGBRTE5",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGBRTE5",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGBRTE5",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGBRTE5",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGBRTE5",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGBRTE5",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGBRTE5",17,0)
 ;;
"RTN","MAGBRTE5",18,0)
 Q
"RTN","MAGBRTE5",19,0)
 ;
"RTN","MAGBRTE5",20,0)
BALANCE(IMAGE,RULE) N %,D,DEST,PARENT,PRI,X
"RTN","MAGBRTE5",21,0)
 S PARENT=$P(^MAG(2005,IMAGE,0),"^",10) ; ~~~
"RTN","MAGBRTE5",22,0)
 D:'$D(^MAGRT(2006.5906,RULE,1,PARENT))
"RTN","MAGBRTE5",23,0)
 . N CP,M1,M2,MAX,B,E,L,RD,T
"RTN","MAGBRTE5",24,0)
 . ;
"RTN","MAGBRTE5",25,0)
 . L +^MAGRT(2006.5906,0):1E9 ; Background task must wait for lock
"RTN","MAGBRTE5",26,0)
 . ;
"RTN","MAGBRTE5",27,0)
 . ; Clean up old info
"RTN","MAGBRTE5",28,0)
 . ; Allow for a study to cross one day boundary,
"RTN","MAGBRTE5",29,0)
 . ; and remove everything that is older than a day.
"RTN","MAGBRTE5",30,0)
 . ;
"RTN","MAGBRTE5",31,0)
 . S RD=RDT-1 F  S RD=$O(^MAGRT(2006.5906,"D",RD),-1) Q:'RD  D
"RTN","MAGBRTE5",32,0)
 . . N DE,RU,PA
"RTN","MAGBRTE5",33,0)
 . . S DE="" F  S DE=$O(^MAGRT(2006.5906,"D",RD,DE)) Q:DE=""  D
"RTN","MAGBRTE5",34,0)
 . . . S RU="" F  S RU=$O(^MAGRT(2006.5906,"D",RD,DE,RU)) Q:RU=""  D
"RTN","MAGBRTE5",35,0)
 . . . . S PA="" F  S PA=$O(^MAGRT(2006.5906,"D",RD,DE,RU,PA)) Q:PA=""  D
"RTN","MAGBRTE5",36,0)
 . . . . . K ^MAGRT(2006.5906,"D",RD,DE,RU,PA)
"RTN","MAGBRTE5",37,0)
 . . . . . K ^MAGRT(2006.5906,RU,1,PA)
"RTN","MAGBRTE5",38,0)
 . . . . . S X=^MAGRT(2006.5906,RU,1,0)
"RTN","MAGBRTE5",39,0)
 . . . . . S $P(X,"^",4)=$P(X,"^",4)-1
"RTN","MAGBRTE5",40,0)
 . . . . . S ^MAGRT(2006.5906,RU,1,0)=X
"RTN","MAGBRTE5",41,0)
 . . . . . Q
"RTN","MAGBRTE5",42,0)
 . . . . Q
"RTN","MAGBRTE5",43,0)
 . . . Q
"RTN","MAGBRTE5",44,0)
 . . Q
"RTN","MAGBRTE5",45,0)
 . ;
"RTN","MAGBRTE5",46,0)
 . D:'$D(^MAGRT(2006.5906,RULE))
"RTN","MAGBRTE5",47,0)
 . . S X=$G(^MAGRT(2006.5906,0))
"RTN","MAGBRTE5",48,0)
 . . S $P(X,"^",1,2)="ROUTE LOAD BALANCE^2006.5906"
"RTN","MAGBRTE5",49,0)
 . . S:RULE>$P(X,"^",3) $P(X,"^",3)=RULE
"RTN","MAGBRTE5",50,0)
 . . S $P(X,"^",4)=$P(X,"^",4)+1
"RTN","MAGBRTE5",51,0)
 . . S:RULE>$P(X,"^",3) $P(X,"^",3)=RULE
"RTN","MAGBRTE5",52,0)
 . . S ^MAGRT(2006.5906,0)=X
"RTN","MAGBRTE5",53,0)
 . . S ^MAGRT(2006.5906,RULE,0)=RULE
"RTN","MAGBRTE5",54,0)
 . . Q
"RTN","MAGBRTE5",55,0)
 . ;
"RTN","MAGBRTE5",56,0)
 . M CP=^MAGRT(2006.5906,"D",RDT)
"RTN","MAGBRTE5",57,0)
 . S (B,DEST,L,M1,M2,MAX)=0
"RTN","MAGBRTE5",58,0)
 . F  S DEST=$O(RULE(RULE,"ACTION",DEST)) Q:'DEST  D
"RTN","MAGBRTE5",59,0)
 . . N I,T
"RTN","MAGBRTE5",60,0)
 . . S B=B+1,B(B)=DEST
"RTN","MAGBRTE5",61,0)
 . . S X=RULE(RULE,"ACTION",DEST)
"RTN","MAGBRTE5",62,0)
 . . S M(B)=$P(X,"^",2),MAX=MAX+M(B)
"RTN","MAGBRTE5",63,0)
 . . ; Don't exceed maximum number of studies per day days
"RTN","MAGBRTE5",64,0)
 . . S T=0,I="" F  S I=$O(CP(DEST,I)) Q:I=""  S T=T+1
"RTN","MAGBRTE5",65,0)
 . . I $P(X,"^",3),T'<$P(X,"^",3) S M2=M2+M(B),M(B)=-1,M1=M1+1
"RTN","MAGBRTE5",66,0)
 . . Q
"RTN","MAGBRTE5",67,0)
 . ; If one destination has reached its cap, redistribute...
"RTN","MAGBRTE5",68,0)
 . D:M1
"RTN","MAGBRTE5",69,0)
 . . N I,L,R
"RTN","MAGBRTE5",70,0)
 . . S R=M2#M1,L=0
"RTN","MAGBRTE5",71,0)
 . . F I=1:1:B S:M(I)>0 M(I)=M2\M1+M(I),L=I
"RTN","MAGBRTE5",72,0)
 . . S M(L)=M(L)+R
"RTN","MAGBRTE5",73,0)
 . . Q
"RTN","MAGBRTE5",74,0)
 . ;
"RTN","MAGBRTE5",75,0)
 . S X=$G(^MAGRT(2006.5906,RULE,2))
"RTN","MAGBRTE5",76,0)
 . ; X = LAST ^ TOTAL ^ COUNT(DEST) ^ COUNT(DEST) ^ ...
"RTN","MAGBRTE5",77,0)
 . F L=1:1:B S E(L)=+$P(X,"^",L+2)
"RTN","MAGBRTE5",78,0)
 . S L=$P(X,"^",1) F  S L=L+1 S:L>B L=1 Q:E(L)<M(L)
"RTN","MAGBRTE5",79,0)
 . S T=$P(X,"^",2)+1,E(L)=E(L)+1,DEST=B(L)
"RTN","MAGBRTE5",80,0)
 . I T'<MAX S T=0 F L=1:1:B S E(L)=0
"RTN","MAGBRTE5",81,0)
 . S X=L_"^"_T F L=1:1:B S X=X_"^"_E(L)
"RTN","MAGBRTE5",82,0)
 . S ^MAGRT(2006.5906,RULE,2)=X
"RTN","MAGBRTE5",83,0)
 . ;
"RTN","MAGBRTE5",84,0)
 . ; Note: on consolidated sites 'origins' and 'destinations'
"RTN","MAGBRTE5",85,0)
 . ; matter even more than on non-consolidated ones.
"RTN","MAGBRTE5",86,0)
 . ; In the case of load-balancing, however, the 'destinations'
"RTN","MAGBRTE5",87,0)
 . ; part is taken care of by the balancing parameters, and the
"RTN","MAGBRTE5",88,0)
 . ; origin is moot, because each study has one (and only one)
"RTN","MAGBRTE5",89,0)
 . ; origin.
"RTN","MAGBRTE5",90,0)
 . ;
"RTN","MAGBRTE5",91,0)
 . D:'$D(^MAGRT(2006.5906,RULE,1,PARENT))
"RTN","MAGBRTE5",92,0)
 . . S X=$G(^MAGRT(2006.5906,RULE,1,0))
"RTN","MAGBRTE5",93,0)
 . . S $P(X,"^",1,2)="^2006.59061"
"RTN","MAGBRTE5",94,0)
 . . S:PARENT>$P(X,"^",3) $P(X,"^",3)=PARENT
"RTN","MAGBRTE5",95,0)
 . . S $P(X,"^",4)=$P(X,"^",4)+1
"RTN","MAGBRTE5",96,0)
 . . S ^MAGRT(2006.5906,RULE,1,0)=X
"RTN","MAGBRTE5",97,0)
 . . S ^MAGRT(2006.5906,RULE,1,PARENT,0)=PARENT_"^"_RDT_"^"_DEST
"RTN","MAGBRTE5",98,0)
 . . Q
"RTN","MAGBRTE5",99,0)
 . L -^MAGRT(2006.5906,0)
"RTN","MAGBRTE5",100,0)
 . Q
"RTN","MAGBRTE5",101,0)
 S DEST=$P(^MAGRT(2006.5906,RULE,1,PARENT,0),"^",3)
"RTN","MAGBRTE5",102,0)
 S X=$G(RULE(RULE,"ACTION",DEST))
"RTN","MAGBRTE5",103,0)
 I X="" S METMSG(0,"No location for rule "_RULE_", alternative "_DEST)="" Q
"RTN","MAGBRTE5",104,0)
 S X=$P(X,"^",1) Q:X="<LOCAL>"
"RTN","MAGBRTE5",105,0)
 S DEST=0
"RTN","MAGBRTE5",106,0)
 S D=0 F  S D=$O(RULE(RULE,"ACTION",D)) Q:'D  D  Q:DEST
"RTN","MAGBRTE5",107,0)
 . Q:$P($G(RULE(RULE,"ACTION",D)),"^",1)'=X
"RTN","MAGBRTE5",108,0)
 . S DEST=D
"RTN","MAGBRTE5",109,0)
 . Q
"RTN","MAGBRTE5",110,0)
 I 'DEST S METMSG(0,"Cannot find location """_X_""".")="" Q
"RTN","MAGBRTE5",111,0)
 S ^MAGRT(2006.5906,"D",RDT,DEST,RULE,PARENT)=""
"RTN","MAGBRTE5",112,0)
 ;
"RTN","MAGBRTE5",113,0)
 ; Current version assumes that BALANCE means DOS-Copy, not DICOM...
"RTN","MAGBRTE5",114,0)
 D VALDEST^MAGDRPC1(.DEST,X)
"RTN","MAGBRTE5",115,0)
 D LOG("Load-Balance Destination is "_X)
"RTN","MAGBRTE5",116,0)
 S PRI=$$PRI^MAGBRTE4($G(RULE(RULE,"PRIORITY")),IMAGE)
"RTN","MAGBRTE5",117,0)
 S VRS=$$VRS(VRS,$$SEND(IMAGE,DEST,PRI,1,LOCATION))
"RTN","MAGBRTE5",118,0)
 Q
"RTN","MAGBRTE5",119,0)
 ;
"RTN","MAGBRTE5",120,0)
VARNAME(F) ;
"RTN","MAGBRTE5",121,0)
 S F=$TR(F," !""#$%&'()*+,-./:;<=>?@[\]^_`{|}~","_________________________________")
"RTN","MAGBRTE5",122,0)
 F  Q:F'["__"  S F=$P(F,"__",1)_"_"_$P(F,"__",2,$L(F)+2)
"RTN","MAGBRTE5",123,0)
 F  Q:$E(F,1)'="_"  S F=$E(F,2,$L(F))
"RTN","MAGBRTE5",124,0)
 F  Q:$E(F,$L(F))'="_"  S F=$E(F,1,$L(F)-1)
"RTN","MAGBRTE5",125,0)
 S F=$TR(F,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","MAGBRTE5",126,0)
 Q F
"RTN","MAGBRTE5",127,0)
 ;
"RTN","MAGBRTE5",128,0)
SEND(IMAGE,DEST,PRI,MECH,LOCATION) N D1,D2,IM,IMG,O,OUT,PRE,RADFN,RADTI,RACNI,RARPT,VRS,X
"RTN","MAGBRTE5",129,0)
 S VRS=$$VRS("",$$SEND^MAGBRTUT(IMAGE,DEST,PRI,MECH,LOCATION))
"RTN","MAGBRTE5",130,0)
 Q:$G(RULE(RULE,"PRIORSTUDY"))'="YES" VRS
"RTN","MAGBRTE5",131,0)
 Q:'$G(IMAGE) VRS
"RTN","MAGBRTE5",132,0)
 S X=$G(^MAG(2005,IMAGE,2))
"RTN","MAGBRTE5",133,0)
 I $P(X,"^",6)'=74 Q VRS
"RTN","MAGBRTE5",134,0)
 S RARPT=$P(X,"^",7) I 'RARPT Q VRS
"RTN","MAGBRTE5",135,0)
 S X=$G(^RARPT(RARPT,0)) ; IA # 1171
"RTN","MAGBRTE5",136,0)
 S RADFN=$P(X,"^",2),RADTI=9999999.9999-$P(X,"^",3),RACNI=$P(X,"^",4)
"RTN","MAGBRTE5",137,0)
 S:RACNI RACNI=$O(^RADPT(+RADFN,"DT",+RADTI,"P","B",RACNI,"")) ; IA # 1172
"RTN","MAGBRTE5",138,0)
 S PRE="A^"_RADFN_"^"_RADTI_"^"_RACNI_"^"_RARPT
"RTN","MAGBRTE5",139,0)
 D PRIOR1^MAGJEX2(.OUT,PRE)
"RTN","MAGBRTE5",140,0)
 S O=0 F  S O=$O(OUT(O))  Q:O=""  D
"RTN","MAGBRTE5",141,0)
 . S X=$G(OUT(O)) Q:'$P(X,"^",2)
"RTN","MAGBRTE5",142,0)
 . S X=$P(X,"|",2) Q:'X
"RTN","MAGBRTE5",143,0)
 . S RARPT=$P(X,"^",4) Q:'RARPT
"RTN","MAGBRTE5",144,0)
 . S D1=0 F  S D1=$O(^RARPT(RARPT,2005,D1)) Q:'D1  D  ; IA # 1171
"RTN","MAGBRTE5",145,0)
 . . S IM=+$G(^RARPT(RARPT,2005,D1,0)) Q:'IM  ; IA # 1171
"RTN","MAGBRTE5",146,0)
 . . S D2=0 F  S D2=$O(^MAG(2005,IM,1,D2)) Q:'D2  D
"RTN","MAGBRTE5",147,0)
 . . . S IMG=+$G(^MAG(2005,IM,1,D2,0)) Q:'IMG
"RTN","MAGBRTE5",148,0)
 . . . S VRS=$$VRS(VRS,$$SEND^MAGBRTUT(IMG,DEST,PRI,MECH,LOCATION))
"RTN","MAGBRTE5",149,0)
 . . . S METMSG(1,"SEND also image #"_IMG_" from prior study")=""
"RTN","MAGBRTE5",150,0)
 . . . Q
"RTN","MAGBRTE5",151,0)
 . . Q
"RTN","MAGBRTE5",152,0)
 . Q
"RTN","MAGBRTE5",153,0)
 Q VRS
"RTN","MAGBRTE5",154,0)
 ;
"RTN","MAGBRTE5",155,0)
VRS(OLD,NEW) N OUT
"RTN","MAGBRTE5",156,0)
 S OUT=""
"RTN","MAGBRTE5",157,0)
 S:OLD OUT=OLD_"^"
"RTN","MAGBRTE5",158,0)
 S:NEW OUT=OUT_NEW
"RTN","MAGBRTE5",159,0)
 F  Q:OUT'["^^"  S OUT=$P(OUT,"^^",1)_"^"_$P(OUT,"^^",2,$L(OUT)+2)
"RTN","MAGBRTE5",160,0)
 Q:$L(OUT)<100 OUT
"RTN","MAGBRTE5",161,0)
 Q $P(OUT,"^",1)_"^...^"_$P(OUT,"^",$L(OUT,"^"))
"RTN","MAGBRTE5",162,0)
 ;
"RTN","MAGBRTE5",163,0)
LOG(X) N D,H,I,M,T
"RTN","MAGBRTE5",164,0)
 S I=$O(^XTMP("MAGEVAL",ZTSK," "),-1)+1
"RTN","MAGBRTE5",165,0)
 S XMSG=$G(XMSG)+1 S:I>XMSG XMSG=I
"RTN","MAGBRTE5",166,0)
 S D=$P("Thu Fri Sat Sun Mon Tue Wed"," ",$H#7+1)
"RTN","MAGBRTE5",167,0)
 S T=$P($H,",",2),H=T\3600,M=T\60#60 S:H<10 H=0_H S:M<10 M=0_M
"RTN","MAGBRTE5",168,0)
 S ^XTMP("MAGEVAL",ZTSK,XMSG)=D_" "_H_":"_M_" "_X
"RTN","MAGBRTE5",169,0)
 Q
"RTN","MAGBRTE5",170,0)
 ;
"RTN","MAGBRTE5",171,0)
WLDMATCH(VAL,WILD) ;
"RTN","MAGBRTE5",172,0)
 ;
"RTN","MAGBRTE5",173,0)
 ; Returns true if VAL=WILD (Val=Actual value, Wild=Wildcard)
"RTN","MAGBRTE5",174,0)
 ;
"RTN","MAGBRTE5",175,0)
 ; Wild characters are:
"RTN","MAGBRTE5",176,0)
 ;   ?   matches any single character
"RTN","MAGBRTE5",177,0)
 ;   *   matches any string of characters
"RTN","MAGBRTE5",178,0)
 ;
"RTN","MAGBRTE5",179,0)
 N I,M
"RTN","MAGBRTE5",180,0)
 F  Q:VAL=""  Q:WILD=""  D
"RTN","MAGBRTE5",181,0)
 . I $E(VAL,1)=$E(WILD,1) S VAL=$E(VAL,2,$L(VAL)),WILD=$E(WILD,2,$L(WILD)) Q
"RTN","MAGBRTE5",182,0)
 . I $E(WILD,1)="?" S VAL=$E(VAL,2,$L(VAL)),WILD=$E(WILD,2,$L(WILD)) Q
"RTN","MAGBRTE5",183,0)
 . I $E(WILD,1)="*" D  Q:M
"RTN","MAGBRTE5",184,0)
 . . I WILD="*" S (VAL,WILD)="",M=1 Q
"RTN","MAGBRTE5",185,0)
 . . S WILD=$E(WILD,2,$L(WILD)),M=0
"RTN","MAGBRTE5",186,0)
 . . F I=1:1:$L(VAL) I $$WLDMATCH($E(VAL,I,$L(VAL)),WILD) S M=1,VAL=$E(VAL,I,$L(VAL)) Q
"RTN","MAGBRTE5",187,0)
 . . Q
"RTN","MAGBRTE5",188,0)
 . S VAL="!",WILD=""
"RTN","MAGBRTE5",189,0)
 . Q
"RTN","MAGBRTE5",190,0)
 Q:VAL'="" 0 Q:WILD'="" 0 Q 1
"RTN","MAGBRTE5",191,0)
 ;
"RTN","MAGBRTUT")
0^4^B44621391
"RTN","MAGBRTUT",1,0)
MAGBRTUT ;WOIFO/EdM - Routing Utilities ; 10/30/2008 09:20
"RTN","MAGBRTUT",2,0)
 ;;3.0;IMAGING;**9,11,30,51,50,85,54**;03-July-2009;;Build 1424
"RTN","MAGBRTUT",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGBRTUT",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGBRTUT",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGBRTUT",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGBRTUT",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGBRTUT",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGBRTUT",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGBRTUT",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGBRTUT",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGBRTUT",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGBRTUT",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGBRTUT",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGBRTUT",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGBRTUT",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGBRTUT",17,0)
 ;;
"RTN","MAGBRTUT",18,0)
 Q
"RTN","MAGBRTUT",19,0)
 ;
"RTN","MAGBRTUT",20,0)
SEND(IMAGE,LOC,PRI,MECH,FROM,ID) ; Enter image into Routing Queue
"RTN","MAGBRTUT",21,0)
 ; IMAGE ;---- Internal Entry Number in Image FIle
"RTN","MAGBRTUT",22,0)
 ; LOC ;------ Internal Entry Number in either Network Location file
"RTN","MAGBRTUT",23,0)
 ;             or SCU_List file
"RTN","MAGBRTUT",24,0)
 ; PRI ;------ Priority
"RTN","MAGBRTUT",25,0)
 ; MECHanism = 1: Send using MS-DOS-Copy
"RTN","MAGBRTUT",26,0)
 ;           = 2: Send using DICOM_Send
"RTN","MAGBRTUT",27,0)
 ; FROM ;----- Location from which request originates
"RTN","MAGBRTUT",28,0)
 ; ID ;------- Transaction ID
"RTN","MAGBRTUT",29,0)
 N D0 ;------- Internal Entry number
"RTN","MAGBRTUT",30,0)
 N FLAG ;----- List of file-types to transmit
"RTN","MAGBRTUT",31,0)
 N I ;-------- Scratch and loop counter
"RTN","MAGBRTUT",32,0)
 N ORIGIN ;--- Location from which image is being sent (IEN in Institution file)
"RTN","MAGBRTUT",33,0)
 N QQ ;------- List of queue-entries created
"RTN","MAGBRTUT",34,0)
 ;
"RTN","MAGBRTUT",35,0)
 S QQ="",MECH=$G(MECH) S:'MECH MECH=1
"RTN","MAGBRTUT",36,0)
 I '$D(^MAG(2005,+$G(IMAGE))) Q:$Q QQ Q
"RTN","MAGBRTUT",37,0)
 I MECH=1,'$D(^MAG(2005.2,+$G(LOC))) Q:$Q QQ Q
"RTN","MAGBRTUT",38,0)
 I MECH=2,'$D(^MAG(2006.587,+$G(LOC))) Q:$Q QQ Q
"RTN","MAGBRTUT",39,0)
 I MECH'=1,MECH'=2 Q:$Q QQ Q
"RTN","MAGBRTUT",40,0)
 S:MECH=1 LOC=(+LOC)_";MAG(2005.2,"
"RTN","MAGBRTUT",41,0)
 S:MECH=2 LOC=(+LOC)_";MAG(2006.587,"
"RTN","MAGBRTUT",42,0)
 ;
"RTN","MAGBRTUT",43,0)
 S ORIGIN=$G(FROM) D:'ORIGIN
"RTN","MAGBRTUT",44,0)
 . S ORIGIN=$P($G(^MAG(2005,IMAGE,100)),"^",3)
"RTN","MAGBRTUT",45,0)
 . S:'ORIGIN ORIGIN=$G(DUZ(2))
"RTN","MAGBRTUT",46,0)
 . S:'ORIGIN ORIGIN=$$KSP^XUPARAM("INST")
"RTN","MAGBRTUT",47,0)
 . Q
"RTN","MAGBRTUT",48,0)
 ;
"RTN","MAGBRTUT",49,0)
 S PRI=$G(PRI,500),ID=$G(ID)
"RTN","MAGBRTUT",50,0)
 S FLAG=$G(^MAG(2005.2,+LOC,1)) S:MECH=2 FLAG="^^^^5"
"RTN","MAGBRTUT",51,0)
 ;
"RTN","MAGBRTUT",52,0)
 I MECH=2 D  Q:$Q QQ Q
"RTN","MAGBRTUT",53,0)
 . ; Stopgap until "native DICOM" storage is supported
"RTN","MAGBRTUT",54,0)
 . N APPNAM
"RTN","MAGBRTUT",55,0)
 . S APPNAM=$P($G(^MAG(2006.587,+LOC,0)),"^",1)
"RTN","MAGBRTUT",56,0)
 . D QUEUE^MAGDRPC3(.QQ,IMAGE,APPNAM,ORIGIN,"","6: Copy to HIPAA Compliant Storage",,PRI)
"RTN","MAGBRTUT",57,0)
 . Q
"RTN","MAGBRTUT",58,0)
 ;
"RTN","MAGBRTUT",59,0)
 F I=1:1:5 D:$P(FLAG,"^",I)
"RTN","MAGBRTUT",60,0)
 . N D0,T,X
"RTN","MAGBRTUT",61,0)
 . S T=$P("ABSTRACT FULL BIG TEXT DICOM"," ",I)
"RTN","MAGBRTUT",62,0)
 . ;
"RTN","MAGBRTUT",63,0)
 . S D0=$O(^MAGQUEUE(2006.035,"DEST",LOC,"WAITING",IMAGE,T,"")) I D0 D  Q
"RTN","MAGBRTUT",64,0)
 . . N O,P,T,X0,X1
"RTN","MAGBRTUT",65,0)
 . . S X0=$G(^MAGQUEUE(2006.035,D0,0)),O=$P(X0,"^",5),T=$P(X0,"^",6)
"RTN","MAGBRTUT",66,0)
 . . S X1=$G(^MAGQUEUE(2006.035,D0,1)),P=$P(X1,"^",2)
"RTN","MAGBRTUT",67,0)
 . . ; Don't send multiple copies, but do increase priority if needed
"RTN","MAGBRTUT",68,0)
 . . Q:PRI'>P
"RTN","MAGBRTUT",69,0)
 . . S $P(X0,"^",5)=ORIGIN,^MAGQUEUE(2006.035,D0,0)=X0
"RTN","MAGBRTUT",70,0)
 . . I T'=ID,ID'="" D
"RTN","MAGBRTUT",71,0)
 . . . S $P(X0,"^",6)=ID
"RTN","MAGBRTUT",72,0)
 . . . S ^MAGQUEUE(2006.035,D0,0)=X0
"RTN","MAGBRTUT",73,0)
 . . . K:O'="" ^MAGQUEUE(2006.035,"ID",T,D0)
"RTN","MAGBRTUT",74,0)
 . . . S ^MAGQUEUE(2006.035,"ID",ID,D0)=""
"RTN","MAGBRTUT",75,0)
 . . . Q
"RTN","MAGBRTUT",76,0)
 . . S $P(X1,"^",2)=PRI,^MAGQUEUE(2006.035,D0,1)=X1
"RTN","MAGBRTUT",77,0)
 . . K:O ^MAGQUEUE(2006.035,"STS",O,"WAITING",P,LOC,D0)
"RTN","MAGBRTUT",78,0)
 . . S ^MAGQUEUE(2006.035,"STS",ORIGIN,"WAITING",PRI,LOC,D0)=""
"RTN","MAGBRTUT",79,0)
 . . Q
"RTN","MAGBRTUT",80,0)
 . ;
"RTN","MAGBRTUT",81,0)
 . L +^MAGQUEUE(2006.035,0):1E9 ; Background job MUST wait
"RTN","MAGBRTUT",82,0)
 . S D0=$O(^MAGQUEUE(2006.035," "),-1)+1
"RTN","MAGBRTUT",83,0)
 . S X=$G(^MAGQUEUE(2006.035,0))
"RTN","MAGBRTUT",84,0)
 . S $P(X,"^",1,2)="SEND QUEUE^2006.035"
"RTN","MAGBRTUT",85,0)
 . S $P(X,"^",3)=D0
"RTN","MAGBRTUT",86,0)
 . S $P(X,"^",4)=$P(X,"^",4)+1
"RTN","MAGBRTUT",87,0)
 . S ^MAGQUEUE(2006.035,0)=X
"RTN","MAGBRTUT",88,0)
 . S X=IMAGE_"^"_LOC_"^"_T_"^"_MECH_"^"_ORIGIN_"^"_ID
"RTN","MAGBRTUT",89,0)
 . S:ID'="" ^MAGQUEUE(2006.035,"ID",ID,D0)=""
"RTN","MAGBRTUT",90,0)
 . S ^MAGQUEUE(2006.035,D0,0)=X
"RTN","MAGBRTUT",91,0)
 . S ^MAGQUEUE(2006.035,D0,1)="WAITING^"_PRI_"^"_$$NOW^XLFDT()
"RTN","MAGBRTUT",92,0)
 . S ^MAGQUEUE(2006.035,"STS",ORIGIN,"WAITING",PRI,LOC,D0)=""
"RTN","MAGBRTUT",93,0)
 . S ^MAGQUEUE(2006.035,"DEST",LOC,"WAITING",IMAGE,T,D0)=""
"RTN","MAGBRTUT",94,0)
 . L -^MAGQUEUE(2006.035,0)
"RTN","MAGBRTUT",95,0)
 . S QQ=QQ_D0_"^"
"RTN","MAGBRTUT",96,0)
 . Q
"RTN","MAGBRTUT",97,0)
 Q:$Q QQ Q
"RTN","MAGBRTUT",98,0)
 ;
"RTN","MAGBRTUT",99,0)
DCMLIST(OUT,LOCATION) N D0,LO,LST,N,NM,X
"RTN","MAGBRTUT",100,0)
 S LOCATION=+$G(LOCATION)
"RTN","MAGBRTUT",101,0)
 S D0=0 F  S D0=$O(^MAG(2006.587,D0)) Q:'D0  D
"RTN","MAGBRTUT",102,0)
 . S X=$G(^MAG(2006.587,D0,0))
"RTN","MAGBRTUT",103,0)
 . S NM=$P(X,"^",1),LO=$P(X,"^",7) Q:NM=""
"RTN","MAGBRTUT",104,0)
 . I LOCATION,LO,LO'=LOCATION Q
"RTN","MAGBRTUT",105,0)
 . S LST(NM,LO)=D0
"RTN","MAGBRTUT",106,0)
 . Q
"RTN","MAGBRTUT",107,0)
 S N=1,NM="" F  S NM=$O(LST(NM)) Q:NM=""  D
"RTN","MAGBRTUT",108,0)
 . S LO="",X=0 F  S LO=$O(LST(NM,LO)) Q:LO=""  S X=X+1,D0=LST(NM,LO)
"RTN","MAGBRTUT",109,0)
 . I X=1 S N=N+1,OUT(N)=NM_"^"_D0 Q
"RTN","MAGBRTUT",110,0)
 . S LO="" F  S LO=$O(LST(NM,LO)) Q:LO=""  S N=N+1,OUT(N)=NM_" ("_LO_")^"_LST(NM,LO)
"RTN","MAGBRTUT",111,0)
 . Q
"RTN","MAGBRTUT",112,0)
 S OUT(1)=N-1
"RTN","MAGBRTUT",113,0)
 Q
"RTN","MAGBRTUT",114,0)
 ;
"RTN","MAGBRTUT",115,0)
EVALPU(OUT,UNTIL) ; RPC = MAG DICOM ROUTE EVAL PURGE
"RTN","MAGBRTUT",116,0)
 N D0,MORE,N,P1,P4,P5,P6,P7,P8,TIME
"RTN","MAGBRTUT",117,0)
 S TIME=$$STAMP($H)+55,N=0,MORE=0
"RTN","MAGBRTUT",118,0)
 L +^MAGQUEUE(2006.03,0):1E9 ; Background process must wait
"RTN","MAGBRTUT",119,0)
 S D0="" F  S D0=$O(^MAGQUEUE(2006.03,"B","EVAL",D0)) Q:D0=""  D  Q:MORE
"RTN","MAGBRTUT",120,0)
 . S X=$G(^MAGQUEUE(2006.03,D0,0))
"RTN","MAGBRTUT",121,0)
 . S P4=$P(X,"^",4),P6=$P(X,"^",6)
"RTN","MAGBRTUT",122,0)
 . S:P6 P4=-1
"RTN","MAGBRTUT",123,0)
 . Q:P4>UNTIL
"RTN","MAGBRTUT",124,0)
 . I $$STAMP($H)>TIME S MORE=1 Q
"RTN","MAGBRTUT",125,0)
 . S N=N+1,P1=$P(X,"^",1),P5=$P(X,"^",5),P7=$P(X,"^",7),P8=$P(X,"^",8)
"RTN","MAGBRTUT",126,0)
 . I P1'="" K ^MAGQUEUE(2006.03,"B",P1,D0)
"RTN","MAGBRTUT",127,0)
 . I P5'="" K ^MAGQUEUE(2006.03,"C",P5,D0)
"RTN","MAGBRTUT",128,0)
 . I P7'="",P8'="" K ^MAGQUEUE(2006.03,"JD",P7,P8,D0)
"RTN","MAGBRTUT",129,0)
 . I P7'="" K ^MAGQUEUE(2006.03,"JX",P7,D0)
"RTN","MAGBRTUT",130,0)
 . K ^MAGQUEUE(2006.03,D0)
"RTN","MAGBRTUT",131,0)
 . Q
"RTN","MAGBRTUT",132,0)
 S X=$G(^MAGQUEUE(2006.03,0))
"RTN","MAGBRTUT",133,0)
 S P1=$P(X,"^",4)-N S:P1<1 P1=0 S $P(X,"^",4)=P1
"RTN","MAGBRTUT",134,0)
 S $P(X,"^",1,2)="IMAGE BACKGROUND QUEUE^2006.03"
"RTN","MAGBRTUT",135,0)
 S ^MAGQUEUE(2006.03,0)=X
"RTN","MAGBRTUT",136,0)
 L -^MAGQUEUE(2006.03,0)
"RTN","MAGBRTUT",137,0)
 S OUT=N_"^"_MORE
"RTN","MAGBRTUT",138,0)
 Q
"RTN","MAGBRTUT",139,0)
 ;
"RTN","MAGBRTUT",140,0)
STAMP(H) Q H*86400+$P(H,",",2)
"RTN","MAGBRTUT",141,0)
 ;
"RTN","MAGBRTUT",142,0)
RENAME(OUT,OLD,NEW,KEY) ; RPC = MAG DICOM XMIT RENAME GATEWAY
"RTN","MAGBRTUT",143,0)
 N D0,ID,LOC,SVC,N,X
"RTN","MAGBRTUT",144,0)
 I $G(OLD)="" S OUT="-1,No previous Gateway name specified" Q
"RTN","MAGBRTUT",145,0)
 I $G(NEW)="" S OUT="-2,No new Gateway name specified" Q
"RTN","MAGBRTUT",146,0)
 S:'$G(KEY) KEY=5
"RTN","MAGBRTUT",147,0)
 I KEY'=5,KEY'=6 S OUT="-3,Invalid key specified ("_KEY_")" Q
"RTN","MAGBRTUT",148,0)
 ;
"RTN","MAGBRTUT",149,0)
 S (N,D0)=0 F  S D0=$O(^MAG(2006.587,D0)) Q:'D0  D
"RTN","MAGBRTUT",150,0)
 . S X=$G(^MAG(2006.587,D0,0)),ID=$P(X,"^",KEY) Q:ID'=OLD
"RTN","MAGBRTUT",151,0)
 . S N=N+1
"RTN","MAGBRTUT",152,0)
 . S $P(X,"^",KEY)=NEW
"RTN","MAGBRTUT",153,0)
 . Q:KEY'=5
"RTN","MAGBRTUT",154,0)
 . S LOC=$P(X,"^",7),SVC=$P(X,"^",1)
"RTN","MAGBRTUT",155,0)
 . I LOC'="",SVC'="" K ^MAG(2006.587,"C",SVC,OLD,LOC,D0)
"RTN","MAGBRTUT",156,0)
 . I LOC'="" K ^MAG(2006.587,"D",OLD,LOC,D0)
"RTN","MAGBRTUT",157,0)
 . I LOC'="",SVC'="" S ^MAG(2006.587,"C",SVC,NEW,LOC,D0)=""
"RTN","MAGBRTUT",158,0)
 . I LOC'="" S ^MAG(2006.587,"D",NEW,LOC,D0)=""
"RTN","MAGBRTUT",159,0)
 . Q
"RTN","MAGBRTUT",160,0)
 S OUT=N_" entr"_$S(N=1:"y",1:"ies")_" renamed"
"RTN","MAGBRTUT",161,0)
 Q
"RTN","MAGBRTUT",162,0)
 ;
"RTN","MAGBRTUT",163,0)
REMOVE(OUT,OLD,KEY) ; RPC = MAG DICOM XMIT REMOVE GATEWAY
"RTN","MAGBRTUT",164,0)
 N D0,ID,LOC,SVC,N,T,X
"RTN","MAGBRTUT",165,0)
 I $G(OLD)="" S OUT="-1,No Gateway name specified" Q
"RTN","MAGBRTUT",166,0)
 S:'$G(KEY) KEY=5
"RTN","MAGBRTUT",167,0)
 I KEY'=5,KEY'=6 S OUT="-3,Invalid key specified ("_KEY_")" Q
"RTN","MAGBRTUT",168,0)
 ;
"RTN","MAGBRTUT",169,0)
 L +^MAG(2006.587,0):1E9 ; Background process MUST wait
"RTN","MAGBRTUT",170,0)
 S (N,D0)=0 F  S D0=$O(^MAG(2006.587,D0)) Q:'D0  D
"RTN","MAGBRTUT",171,0)
 . S X=$G(^MAG(2006.587,D0,0)),ID=$P(X,"^",KEY) Q:ID'=OLD
"RTN","MAGBRTUT",172,0)
 . S N=N+1
"RTN","MAGBRTUT",173,0)
 . S LOC=$P(X,"^",7),SVC=$P(X,"^",1)
"RTN","MAGBRTUT",174,0)
 . I LOC'="",SVC'="" K ^MAG(2006.587,"C",SVC,OLD,LOC,D0)
"RTN","MAGBRTUT",175,0)
 . I LOC'="" K ^MAG(2006.587,"D",OLD,LOC,D0)
"RTN","MAGBRTUT",176,0)
 . I SVC'="" K ^MAG(2006.587,"B",SVC,D0)
"RTN","MAGBRTUT",177,0)
 . K ^MAG(2006.587,D0)
"RTN","MAGBRTUT",178,0)
 . Q
"RTN","MAGBRTUT",179,0)
 S X=$G(^MAG(2006.587,0))
"RTN","MAGBRTUT",180,0)
 S $P(X,"^",1,2)="DICOM TRANSMIT DESTINATION^2006.587"
"RTN","MAGBRTUT",181,0)
 S $P(X,"^",3)=$O(^MAG(2006.587," "),-1)
"RTN","MAGBRTUT",182,0)
 S T=$P(X,"^",4)-N S:T<1 T="" S $P(X,"^",4)=T
"RTN","MAGBRTUT",183,0)
 S ^MAG(2006.587,0)=X
"RTN","MAGBRTUT",184,0)
 L -^MAG(2006.587,0)
"RTN","MAGBRTUT",185,0)
 S OUT=N_" entr"_$S(N=1:"y",1:"ies")_" removed"
"RTN","MAGBRTUT",186,0)
 Q
"RTN","MAGBRTUT",187,0)
 ;
"RTN","MAGDCCS")
0^5^B64783985
"RTN","MAGDCCS",1,0)
MAGDCCS ;WOIFO/MLH - DICOM Correct - Clinical Specialties ; 05/18/2007 11:23
"RTN","MAGDCCS",2,0)
 ;;3.0;IMAGING;**10,11,85,54**;03-July-2009;;Build 1424
"RTN","MAGDCCS",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDCCS",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDCCS",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDCCS",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDCCS",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDCCS",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDCCS",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDCCS",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDCCS",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDCCS",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDCCS",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDCCS",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDCCS",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDCCS",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDCCS",17,0)
 ;;
"RTN","MAGDCCS",18,0)
 Q
"RTN","MAGDCCS",19,0)
 ;
"RTN","MAGDCCS",20,0)
L ;Loop thru the entire file for entries that need processing
"RTN","MAGDCCS",21,0)
 ;The "F" xref is set for unique Study UIDs. The entry setting this xref
"RTN","MAGDCCS",22,0)
 ;will also have a "RLATE" node with all the Xray images associated with
"RTN","MAGDCCS",23,0)
 ;that unique Study UID.
"RTN","MAGDCCS",24,0)
 N ANS,ANSR,CASENO,COMNT1,DATA,DATA1,DATA2,DATE,FILE,FIRST,FIRSTS
"RTN","MAGDCCS",25,0)
 N MACHID,MAGDY,MAGDIEN,MAGIEN,MAGTYPE,MSG,START,STOP
"RTN","MAGDCCS",26,0)
 N MOD,MODEL,NEWCAS,NEWDFN,NEWDTI,NEWDTIM,NEWMUL,NEWNME,NEWPIEN,NEWPROC
"RTN","MAGDCCS",27,0)
 N NEWSSN,OK,OOUT,OUT,PAT,PID,PP,PREV,PREVS,REASON,STUDYUID,WHY,MAGFIX
"RTN","MAGDCCS",28,0)
 N KFIXALL ; --- does user hold MAGDFIX ALL key
"RTN","MAGDCCS",29,0)
 N GWLOC ; -- gateway site
"RTN","MAGDCCS",30,0)
 ;
"RTN","MAGDCCS",31,0)
 S KFIXALL=$$SECKEY^MAGDLB12()
"RTN","MAGDCCS",32,0)
 I '$D(^MAGD(2006.575,"F")) W !,"Nothing to process!" Q
"RTN","MAGDCCS",33,0)
 S (OOUT,OUT,PREV,FIRST)=0
"RTN","MAGDCCS",34,0)
 S GWLOC=0
"RTN","MAGDCCS",35,0)
 F  S GWLOC=$O(^MAGD(2006.575,"F",GWLOC)) Q:'GWLOC  D
"RTN","MAGDCCS",36,0)
 . S SUID=""
"RTN","MAGDCCS",37,0)
 . F  S SUID=$O(^MAGD(2006.575,"F",GWLOC,SUID)) Q:SUID=""!(OOUT)  D
"RTN","MAGDCCS",38,0)
 . . S MAGIEN=$O(^MAGD(2006.575,"F",GWLOC,SUID,0)) Q:'MAGIEN
"RTN","MAGDCCS",39,0)
 . . ; if no main failed image rec, there's a xref prob, so bail
"RTN","MAGDCCS",40,0)
 . . I '$D(^MAGD(2006.575,MAGIEN,0)) D  Q  ; clean up xref
"RTN","MAGDCCS",41,0)
 . . . K ^MAGD(2006.575,"F",GWLOC,SUID,MAGIEN)
"RTN","MAGDCCS",42,0)
 . . . Q
"RTN","MAGDCCS",43,0)
 . . ;Only process clinical specialties images... radiology and medicine images done by other rtns.
"RTN","MAGDCCS",44,0)
 . . S MAGTYPE=$P($G(^MAGD(2006.575,MAGIEN,"TYPE")),"^") I MAGTYPE'="CON" Q
"RTN","MAGDCCS",45,0)
 . . I $D(^MAGD(2006.575,MAGIEN,"FIXD")),$P(^MAGD(2006.575,MAGIEN,"FIXD"),"^") Q
"RTN","MAGDCCS",46,0)
 . . I 'FIRST S PREV=MAGIEN,PREVS=SUID,FIRST=MAGIEN
"RTN","MAGDCCS",47,0)
 . . D SET
"RTN","MAGDCCS",48,0)
 . Q
"RTN","MAGDCCS",49,0)
 Q
"RTN","MAGDCCS",50,0)
 ;
"RTN","MAGDCCS",51,0)
DISPLAY ;
"RTN","MAGDCCS",52,0)
 S OUT=0
"RTN","MAGDCCS",53,0)
 W !,"**************Processing entry**********"
"RTN","MAGDCCS",54,0)
 W !!,?2,"PATIENT: ",PAT,?50,"SSN: ",PID,!,"Request/Consultation #: ",CASENO
"RTN","MAGDCCS",55,0)
 W !,?2,"Equipment: ",MOD,?50,"Model: ",MODEL
"RTN","MAGDCCS",56,0)
 W !,?2,"Date Processed: ",DATE,?50,"Problem with: ",REASON
"RTN","MAGDCCS",57,0)
 W !,?2,"Comment: ",COMNT1
"RTN","MAGDCCS",58,0)
 W !,?2,"Correcting file on server ID: ",MACHID,!,?5,FILE
"RTN","MAGDCCS",59,0)
 S MSG="Do you want to Correct this entry? "
"RTN","MAGDCCS",60,0)
 Q
"RTN","MAGDCCS",61,0)
 ;
"RTN","MAGDCCS",62,0)
NEWCASE ;
"RTN","MAGDCCS",63,0)
 S NEWDFN=$P(MAGDY,"^"),NEWNME=$P(MAGDY,"^",2),NEWSSN=$P(MAGDY,"^",3)
"RTN","MAGDCCS",64,0)
 S NEWCAS=$P(MAGDY,"^",4),NEWPROC=$P(MAGDY,"^",5),NEWDTI=$P(MAGDY,"^",6)
"RTN","MAGDCCS",65,0)
 S NEWMUL=$P(MAGDY,"^",7),NEWPIEN=$P(MAGDY,"^",8),PP=$P(MAGDY,"^",9)
"RTN","MAGDCCS",66,0)
 Q
"RTN","MAGDCCS",67,0)
 ;
"RTN","MAGDCCS",68,0)
ASK() ;
"RTN","MAGDCCS",69,0)
 N ANS,ASK
"RTN","MAGDCCS",70,0)
ASK1 S ASK="Y/N/D/Q"
"RTN","MAGDCCS",71,0)
 I $G(PREV)'=$G(MAGIEN),MAGTYPE="CON" S ASK=ASK_"/P"
"RTN","MAGDCCS",72,0)
 W !,$G(MSG),"("_ASK_")// " R ANS:600
"RTN","MAGDCCS",73,0)
 I '$T!(ANS["^") Q "^"
"RTN","MAGDCCS",74,0)
 I ANS="" Q "N"
"RTN","MAGDCCS",75,0)
 I "YNDPQyndpq"'[$E(ANS) D  G ASK1
"RTN","MAGDCCS",76,0)
 . W !,"Please respond with one of the following codes."
"RTN","MAGDCCS",77,0)
 . W !,"Legend: Y=yes, N=no, D=delete, P=Previous entry, and Q=quit",!
"RTN","MAGDCCS",78,0)
 S ANS=$TR(ANS,"yndpq","YNDPQ")
"RTN","MAGDCCS",79,0)
 Q $E(ANS)
"RTN","MAGDCCS",80,0)
 ;
"RTN","MAGDCCS",81,0)
CHK ;remove any punctuation before doing comparison on SSN
"RTN","MAGDCCS",82,0)
 ;stop on 1st check.
"RTN","MAGDCCS",83,0)
 N OLD,I
"RTN","MAGDCCS",84,0)
 S OLD="" F I=1:1:$L(PID) I $E(PID,I)?1AN S OLD=OLD_$E(PID,I)
"RTN","MAGDCCS",85,0)
 I NEWSSN'=OLD D  Q
"RTN","MAGDCCS",86,0)
 . S MSG="Social Security numbers do not match. Update? "
"RTN","MAGDCCS",87,0)
 I NEWNME'=PAT D  Q
"RTN","MAGDCCS",88,0)
 . S MSG="Patient names do not match. Update? "
"RTN","MAGDCCS",89,0)
 ;Finally the problem is with the case number...either no longer in "C"
"RTN","MAGDCCS",90,0)
 ;xref or invalid number provided
"RTN","MAGDCCS",91,0)
 S MSG="Accession number different. Update? "
"RTN","MAGDCCS",92,0)
 Q
"RTN","MAGDCCS",93,0)
 ;
"RTN","MAGDCCS",94,0)
NEWDIS ;
"RTN","MAGDCCS",95,0)
 W !,?2,"****Please review the following: *****"
"RTN","MAGDCCS",96,0)
 W !,?2,"Previous name: ",PAT,!,?2,"     New name: ",NEWNME
"RTN","MAGDCCS",97,0)
 W !,?2,"Previous ssn: ",PID,!,?2,"     New ssn: ",NEWSSN
"RTN","MAGDCCS",98,0)
 W !,?2,"Previous request/consultation #: ",CASENO,!,?2,"     New request/consultation #: ",NEWCAS
"RTN","MAGDCCS",99,0)
 ; Variable PP already has text message about being part of printset.
"RTN","MAGDCCS",100,0)
 Q
"RTN","MAGDCCS",101,0)
 ;
"RTN","MAGDCCS",102,0)
UPDT ;
"RTN","MAGDCCS",103,0)
 N GWLOC ; -- gateway location
"RTN","MAGDCCS",104,0)
 W !,"Will change the following: " D NEWDIS
"RTN","MAGDCCS",105,0)
 W !,"Are you sure you want to correct this entry? " S %=2 D YN^DICN
"RTN","MAGDCCS",106,0)
 I %=-1!(%=2) S OUT=1 Q
"RTN","MAGDCCS",107,0)
 W !,"Updating the file."
"RTN","MAGDCCS",108,0)
 S NEWDTIM=$TR(NEWDTI,"0123456789","9876543210")
"RTN","MAGDCCS",109,0)
 S ^MAGD(2006.575,MAGIEN,"FIXD")="1^"_NEWDFN_"^"_NEWNME_"^"_NEWSSN_"^"_NEWCAS_"^"_NEWDTI_"^"_NEWMUL_"^"_NEWDTIM W "."
"RTN","MAGDCCS",110,0)
 S ^MAGD(2006.575,MAGIEN,"FIXPR")=NEWPIEN_"^"_NEWPROC W "."
"RTN","MAGDCCS",111,0)
 ;Same as ^radpt(newdfn,"DT",newdti,"P",newmul,0) & ^RAMIS(71,newpien,0)
"RTN","MAGDCCS",112,0)
 S GWLOC=$P($G(^MAGD(2006.575,MAGIEN,1)),"^",5)
"RTN","MAGDCCS",113,0)
 S MACHID=$S(MACHID="":"A",1:MACHID) ; server ID
"RTN","MAGDCCS",114,0)
 I GWLOC S ^MAGD(2006.575,"AFX",GWLOC,MACHID,MAGIEN)="" W "."
"RTN","MAGDCCS",115,0)
 E  W !,"Gateway place not defined on image entry "_MAGIEN_", continuing.."
"RTN","MAGDCCS",116,0)
 ;Xref to loop & process entries; processing will be minimal.
"RTN","MAGDCCS",117,0)
 S MAGFIX(MAGIEN)="F"
"RTN","MAGDCCS",118,0)
 Q
"RTN","MAGDCCS",119,0)
 ;
"RTN","MAGDCCS",120,0)
SETDEL ;Entry to be deleted
"RTN","MAGDCCS",121,0)
 N GWLOC ; -- gateway location
"RTN","MAGDCCS",122,0)
 D LOGERR I ANS="^" S OUT=1 Q
"RTN","MAGDCCS",123,0)
 S GWLOC=$P($G(^MAGD(2006.575,MAGIEN,1)),"^",5)
"RTN","MAGDCCS",124,0)
 I GWLOC S ^MAGD(2006.575,"AFX",GWLOC,MACHID,MAGIEN)="D" W "."
"RTN","MAGDCCS",125,0)
 E  W !,"Gateway place not defined on image entry "_MAGIEN_", continuing.."
"RTN","MAGDCCS",126,0)
 S $P(^MAGD(2006.575,MAGIEN,0),"^",6)="1"
"RTN","MAGDCCS",127,0)
 S ^MAGD(2006.575,MAGIEN,"FIXD")=1
"RTN","MAGDCCS",128,0)
 S MAGFIX(MAGIEN)="D"
"RTN","MAGDCCS",129,0)
 Q
"RTN","MAGDCCS",130,0)
 ;
"RTN","MAGDCCS",131,0)
LOGERR ;Need to record error
"RTN","MAGDCCS",132,0)
 N DIR,DIRUT,DTOUT,ENTRY,I,MAGERR,MAGOUT,NOW,WHY,WHO,X,Y
"RTN","MAGDCCS",133,0)
 W !! F I=1:1:80 W "*"
"RTN","MAGDCCS",134,0)
 W !,"*** Will log in error log (file 2006.599). ****"
"RTN","MAGDCCS",135,0)
 S NOW=$$NOW^XLFDT()
"RTN","MAGDCCS",136,0)
 S DIR(0)="F^3:30"
"RTN","MAGDCCS",137,0)
 S DIR("A")="Reason for deletion"
"RTN","MAGDCCS",138,0)
 S DIR("A",1)="Please enter a reason for deleting."
"RTN","MAGDCCS",139,0)
 S DIR("A",2)="For example: TEST PATIENT"
"RTN","MAGDCCS",140,0)
 D ^DIR
"RTN","MAGDCCS",141,0)
 I $D(DIRUT)!($D(DTOUT))!(Y="") D  S ANS="^" Q
"RTN","MAGDCCS",142,0)
 . W !,"Can not delete if a reason is not provided."
"RTN","MAGDCCS",143,0)
 . Q
"RTN","MAGDCCS",144,0)
 S WHY=Y,WHO=$G(DUZ)
"RTN","MAGDCCS",145,0)
 I WHO D 
"RTN","MAGDCCS",146,0)
 . D GETS^DIQ(200,DUZ,".01","E","MAGOUT","MAGERR")
"RTN","MAGDCCS",147,0)
 . Q:$D(MAGERR("DIERR"))
"RTN","MAGDCCS",148,0)
 . S WHO=$G(MAGOUT(200,DUZ_",",.01,"E"))
"RTN","MAGDCCS",149,0)
 I WHO="" S WHO="UNKNOWN"
"RTN","MAGDCCS",150,0)
 I '$D(^MAGD(2006.599,0)) D
"RTN","MAGDCCS",151,0)
 . S ^MAGD(2006.599,0)="Dicom Error Log^2006.599^^"
"RTN","MAGDCCS",152,0)
 . Q
"RTN","MAGDCCS",153,0)
 S ENTRY=$P(^MAGD(2006.599,0),"^",3)+1
"RTN","MAGDCCS",154,0)
 S $P(^MAGD(2006.599,0),"^",3)=ENTRY
"RTN","MAGDCCS",155,0)
 S $P(^MAGD(2006.599,0),"^",4)=$P(^MAGD(2006.599,0),"^",4)+1
"RTN","MAGDCCS",156,0)
 S ^MAGD(2006.599,ENTRY,0)=NOW_"^"_WHY_"^"_FILE_"^"_MODEL
"RTN","MAGDCCS",157,0)
 S ^MAGD(2006.599,ENTRY,1)=WHO_"^"_PAT_"^"_PID_"^"_CASENO_"^"_MACHID
"RTN","MAGDCCS",158,0)
 S ^MAGD(2006.599,"B",NOW,ENTRY)=""
"RTN","MAGDCCS",159,0)
 Q
"RTN","MAGDCCS",160,0)
 ;
"RTN","MAGDCCS",161,0)
SET ;
"RTN","MAGDCCS",162,0)
 S MAGTYPE=$P(^MAGD(2006.575,MAGIEN,"TYPE"),"^")
"RTN","MAGDCCS",163,0)
 Q:$P($G(^MAGD(2006.575,MAGIEN,"FIXD")),"^")    ;Already fixed.
"RTN","MAGDCCS",164,0)
 ;Only process Clinical Specialties images...radiology & medicine images done by other rtns.
"RTN","MAGDCCS",165,0)
 I $E(MAGTYPE,1,3)'="CON" Q
"RTN","MAGDCCS",166,0)
 S DATA=^MAGD(2006.575,MAGIEN,0)
"RTN","MAGDCCS",167,0)
 S FILE=$P(^MAGD(2006.575,MAGIEN,0),"^")
"RTN","MAGDCCS",168,0)
 S DATA1=^MAGD(2006.575,MAGIEN,1)    ;Case no. info
"RTN","MAGDCCS",169,0)
 S DATA2=^MAGD(2006.575,MAGIEN,"AMFG")    ;Modality info
"RTN","MAGDCCS",170,0)
 S PAT=$P(DATA,"^",4),PID=$P(DATA,"^",3),REASON=$P(DATA,"^",2)
"RTN","MAGDCCS",171,0)
 S MOD=$P(DATA2,"^"),MODEL=$P(DATA2,"^",6)
"RTN","MAGDCCS",172,0)
 S CASENO=$P(DATA1,"^",2),MACHID=$P(DATA1,"^",4)
"RTN","MAGDCCS",173,0)
 S Y=$P(DATA1,"^",3) X ^DD("DD") S DATE=Y
"RTN","MAGDCCS",174,0)
 S COMNT1=$G(^MAGD(2006.575,MAGIEN,"ACSTXT")) ;1st line comment.
"RTN","MAGDCCS",175,0)
 S MACHID=$P(DATA1,"^",4)
"RTN","MAGDCCS",176,0)
 S ANS="" D DISPLAY S ANS=$$ASK
"RTN","MAGDCCS",177,0)
 I ANS="Q"!(ANS["^") S (OOUT,OUT)=1 D SETPREV Q
"RTN","MAGDCCS",178,0)
 I ANS="N" S OUT=1 D SETPREV Q
"RTN","MAGDCCS",179,0)
 I ANS="P" D CHKPREV Q
"RTN","MAGDCCS",180,0)
 I ANS="D" D SETDEL,SETPREV Q
"RTN","MAGDCCS",181,0)
 Q:OUT
"RTN","MAGDCCS",182,0)
 K MAGDY W !," Lookup by case number or patient name"
"RTN","MAGDCCS",183,0)
 ;
"RTN","MAGDCCS",184,0)
LOOK ;
"RTN","MAGDCCS",185,0)
 ;D ^MAGDLB2 Q:'$D(MAGDY)  Q:MAGDY'[""
"RTN","MAGDCCS",186,0)
 D EN^MAGDCCS2 Q:'$D(MAGDY)  Q:MAGDY'[""
"RTN","MAGDCCS",187,0)
 D NEWCASE,CHK,NEWDIS S ANS=$$ASK
"RTN","MAGDCCS",188,0)
 ;W !,"Sorry, under construction (",$T(+0),")... please try again later.",! Q
"RTN","MAGDCCS",189,0)
 I ANS="Q"!(ANS["^") S (OOUT,OUT)=1 D SETPREV Q
"RTN","MAGDCCS",190,0)
 I ANS="D" D SETDEL,SETPREV Q
"RTN","MAGDCCS",191,0)
 I ANS="P" D CHKPREV Q
"RTN","MAGDCCS",192,0)
 I ANS="N" S OUT=1 D SETPREV Q
"RTN","MAGDCCS",193,0)
 Q:OUT
"RTN","MAGDCCS",194,0)
 D UPDT
"RTN","MAGDCCS",195,0)
 I ANS="P" D CHKPREV Q
"RTN","MAGDCCS",196,0)
 D SETMAG
"RTN","MAGDCCS",197,0)
 Q
"RTN","MAGDCCS",198,0)
 ;
"RTN","MAGDCCS",199,0)
DATELOOP(START,STOP) ;Loop thru the "AD" cross reference
"RTN","MAGDCCS",200,0)
 N MAGIEN,SUID,THEDT,FIRST,OOUT,MAGFIX
"RTN","MAGDCCS",201,0)
 S THEDT=START-.1,(OOUT,FIRST)=0
"RTN","MAGDCCS",202,0)
 F  S THEDT=$O(^MAGD(2006.575,"AD",THEDT)) Q:'THEDT!(THEDT>STOP)!(OOUT)  D
"RTN","MAGDCCS",203,0)
 . S MAGIEN=0
"RTN","MAGDCCS",204,0)
 . F  S MAGIEN=$O(^MAGD(2006.575,"AD",THEDT,MAGIEN)) Q:'MAGIEN  D
"RTN","MAGDCCS",205,0)
 . . I '$D(^MAGD(2006.575,MAGIEN,0)) K ^MAGD(2006.575,"AD",THEDT,MAGIEN)
"RTN","MAGDCCS",206,0)
 . . I $D(^MAGD(2006.575,MAGIEN,"TYPE")),$E($P(^MAGD(2006.575,MAGIEN,"TYPE"),"^"),1,3)'="CON" Q
"RTN","MAGDCCS",207,0)
 . . I 'FIRST S PREV=MAGIEN,FIRST=1
"RTN","MAGDCCS",208,0)
 . . D SET
"RTN","MAGDCCS",209,0)
 . . Q
"RTN","MAGDCCS",210,0)
 . Q
"RTN","MAGDCCS",211,0)
 Q
"RTN","MAGDCCS",212,0)
 ;
"RTN","MAGDCCS",213,0)
SETPREV ;
"RTN","MAGDCCS",214,0)
 S PREV=MAGIEN,PREVS=$G(SUID)
"RTN","MAGDCCS",215,0)
 Q
"RTN","MAGDCCS",216,0)
 ;
"RTN","MAGDCCS",217,0)
SETMAG ;
"RTN","MAGDCCS",218,0)
 S FIRST=MAGIEN,FIRSTS=$G(SUID),MAGIEN=PREV,SUID=$G(PREVS)
"RTN","MAGDCCS",219,0)
 S PREV=FIRST,PREVS=FIRSTS
"RTN","MAGDCCS",220,0)
 Q
"RTN","MAGDCCS",221,0)
 ;
"RTN","MAGDCCS",222,0)
CHKPREV ;
"RTN","MAGDCCS",223,0)
 S OUT=1 N STATUS
"RTN","MAGDCCS",224,0)
 I '$D(MAGFIX(PREV)) D SETMAG G SET
"RTN","MAGDCCS",225,0)
 S STATUS=$S($G(MAGFIX(PREV))="D":"deleted",1:"corrected")
"RTN","MAGDCCS",226,0)
 W !,"Previous entry has been "_STATUS_".",$C(7)
"RTN","MAGDCCS",227,0)
 G SET
"RTN","MAGDCCS",228,0)
 Q
"RTN","MAGDCCS",229,0)
 ;
"RTN","MAGDCCS2")
0^6^B16336800
"RTN","MAGDCCS2",1,0)
MAGDCCS2 ;WOIFO/MLH - DICOM Correct - Clinical Specialties - subroutines ; 13 Nov 2007 1:40 PM
"RTN","MAGDCCS2",2,0)
 ;;3.0;IMAGING;**10,11,30,54**;03-July-2009;;Build 1424
"RTN","MAGDCCS2",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDCCS2",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDCCS2",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDCCS2",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDCCS2",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDCCS2",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDCCS2",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDCCS2",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDCCS2",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDCCS2",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDCCS2",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDCCS2",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDCCS2",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDCCS2",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDCCS2",17,0)
 ;;
"RTN","MAGDCCS2",18,0)
 Q
"RTN","MAGDCCS2",19,0)
 ; Routine to create the MAGDY variable needed by MAGDCCS routine when
"RTN","MAGDCCS2",20,0)
 ; manually correcting DICOM FIX files. 
"RTN","MAGDCCS2",21,0)
EN ;
"RTN","MAGDCCS2",22,0)
 ; MAGDY variable to be created during this execution.
"RTN","MAGDCCS2",23,0)
 N D,DIC,DUOUT,DZ,MAGBEG,MAGEND,MAGDFN,MAGOUT,MAGX,MAGXX,INFO,MAGNME,MAGSSN,Y
"RTN","MAGDCCS2",24,0)
 S MAGBEG=1070101,MAGEND=$$DT^XLFDT
"RTN","MAGDCCS2",25,0)
 W !,"*** Select a request/consult with whose ***"
"RTN","MAGDCCS2",26,0)
 W !,"***  TIU note to associate this image   ***"
"RTN","MAGDCCS2",27,0)
 S DIC="^GMR(123,",DIC(0)="AENZ"
"RTN","MAGDCCS2",28,0)
 S DIC("A")="Enter patient or request/consultation: "
"RTN","MAGDCCS2",29,0)
 S D="F",DZ="??"
"RTN","MAGDCCS2",30,0)
 S DIC("W")="W ""  REQ/CON #"",Y"
"RTN","MAGDCCS2",31,0)
 S DIC("W")=DIC("W")_",""  "",$$GET1^DIQ(123,Y,1)" ; TO SERVICE
"RTN","MAGDCCS2",32,0)
 S DIC("W")=DIC("W")_",""  "",$$GET1^DIQ(123,Y,.02)" ; PATIENT NAME
"RTN","MAGDCCS2",33,0)
 ;
"RTN","MAGDCCS2",34,0)
 D IX^DIC
"RTN","MAGDCCS2",35,0)
 Q:$D(DUOUT)
"RTN","MAGDCCS2",36,0)
 Q:'$D(Y(0))  ; 
"RTN","MAGDCCS2",37,0)
 I "^DISCONTINUED^CANCELLED^"[("^"_$$GET1^DIQ(123,+Y,8)_"^") D  Q
"RTN","MAGDCCS2",38,0)
 . W !!,"This consult has been cancelled and cannot be selected." H 2
"RTN","MAGDCCS2",39,0)
 . Q
"RTN","MAGDCCS2",40,0)
 S (MAGDFN,MAGX)=$P(Y(0),U,2)_"~"_Y
"RTN","MAGDCCS2",41,0)
 ;
"RTN","MAGDCCS2",42,0)
 D ONE ; Lookup was on req/con number and successful
"RTN","MAGDCCS2",43,0)
 Q
"RTN","MAGDCCS2",44,0)
 ;
"RTN","MAGDCCS2",45,0)
PTINFO() ;
"RTN","MAGDCCS2",46,0)
 N INFO,MAGOUT,MAGERR
"RTN","MAGDCCS2",47,0)
 I '$D(MAGDFN) Q ""
"RTN","MAGDCCS2",48,0)
 D GETS^DIQ(2,MAGDFN,".01;.09","E","MAGOUT","MAGERR")
"RTN","MAGDCCS2",49,0)
 I $D(MAGERR) Q ""
"RTN","MAGDCCS2",50,0)
 I $D(MAGOUT) D  Q INFO
"RTN","MAGDCCS2",51,0)
 . S INFO=$G(MAGOUT(2,MAGDFN_",",.01,"E"))
"RTN","MAGDCCS2",52,0)
 . S INFO=INFO_"^"_$G(MAGOUT(2,MAGDFN_",",.09,"E"))
"RTN","MAGDCCS2",53,0)
 Q ""
"RTN","MAGDCCS2",54,0)
 ;
"RTN","MAGDCCS2",55,0)
ONE ; Process the single entry that was selected.
"RTN","MAGDCCS2",56,0)
 ; MAGDFN,MAGX variables expected from EN
"RTN","MAGDCCS2",57,0)
 I 'MAGDFN,'+MAGX Q
"RTN","MAGDCCS2",58,0)
 N BEG,CASE,CDATE,CS,DATA,END,FLDS,INFO,MAGCASE,MAGCNI,MAGDATE,MAGDTI
"RTN","MAGDCCS2",59,0)
 N MAGEXST,MAGLOC,MAGNME,MAGOUT,MAGPIEN,MAGPRC,MAGPSET,MAGPST,MAGRPT
"RTN","MAGDCCS2",60,0)
 N PP,PSET,RAENTRY,RAMEMLOW,RAPRTSET,RIEN,STAT,X,X1,X2,XX
"RTN","MAGDCCS2",61,0)
 N RARPT,RADFN,RADTI,RACNI ;<--Variables needed for EN1^RAUTL20
"RTN","MAGDCCS2",62,0)
 ; RAUTL20 used to retrieve if case is part of a print set.
"RTN","MAGDCCS2",63,0)
 N MAGRCARY ; array of req/con data from file 123
"RTN","MAGDCCS2",64,0)
 N MAGIENS  ; internal entry number for MAGRCARY
"RTN","MAGDCCS2",65,0)
 ;
"RTN","MAGDCCS2",66,0)
 S MAGDFN=$P(MAGX,"~"),INFO=$$PTINFO
"RTN","MAGDCCS2",67,0)
 S MAGNME=$P(INFO,"^"),MAGSSN=$P(INFO,"^",2)
"RTN","MAGDCCS2",68,0)
 S MAGCASE=$P($P(MAGX,"~",2),U)
"RTN","MAGDCCS2",69,0)
 S (MAGPRC,MAGDTI,MAGCNI,MAGPIEN,MAGLOC,MAGDATE,MAGEXST,MAGPST)=""
"RTN","MAGDCCS2",70,0)
 K MAGRCARY D GETS^DIQ(123,MAGCASE,"*","EI","MAGRCARY")
"RTN","MAGDCCS2",71,0)
 ;
"RTN","MAGDCCS2",72,0)
 S MAGIENS=$O(MAGRCARY(123,""))
"RTN","MAGDCCS2",73,0)
 S MAGPRC=MAGRCARY(123,MAGIENS,4,"E") ; procedure
"RTN","MAGDCCS2",74,0)
 S MAGLOC=MAGRCARY(123,MAGIENS,1,"E") ; to service
"RTN","MAGDCCS2",75,0)
 S MAGDATE=MAGRCARY(123,MAGIENS,.01,"E") ; request date
"RTN","MAGDCCS2",76,0)
 S MAGPST=MAGRCARY(123,MAGIENS,8,"E") ; procedure status
"RTN","MAGDCCS2",77,0)
 W !,"PATIENT: ",MAGNME,?51,"SSN: ",MAGSSN
"RTN","MAGDCCS2",78,0)
 W !,"Req/Con No.",?13,"Procedure",?38,"To Service",?58,"Req Date"
"RTN","MAGDCCS2",79,0)
 W !,"-----------",?13,"---------",?38,"----------------",?58,"--------"
"RTN","MAGDCCS2",80,0)
 W !,MAGCASE,?13,MAGPRC,?38,MAGLOC,?58,MAGDATE
"RTN","MAGDCCS2",81,0)
 W !,"Exam status: ",MAGEXST," "," ",$G(MAGPST)
"RTN","MAGDCCS2",82,0)
 D MAGDY
"RTN","MAGDCCS2",83,0)
 Q
"RTN","MAGDCCS2",84,0)
 ;
"RTN","MAGDCCS2",85,0)
MAGDY ;
"RTN","MAGDCCS2",86,0)
 K MAGDY
"RTN","MAGDCCS2",87,0)
 S MAGDY=MAGDFN_"^"_MAGNME_"^"_MAGSSN_"^"_"GMRC-"_MAGCASE_"^"_MAGPRC_"^"_MAGDTI
"RTN","MAGDCCS2",88,0)
 S MAGDY=MAGDY_"^"_MAGCNI_"^"_MAGPIEN_"^"_$G(MAGPST)_"^"
"RTN","MAGDCCS2",89,0)
 K MAGNME,MAGSSN,MAGCASE,MAGPRC,MAGDTI,MAGCNI,MAGPIEN,MAPST
"RTN","MAGDCCS2",90,0)
 Q
"RTN","MAGDCCU1")
0^7^B26965378
"RTN","MAGDCCU1",1,0)
MAGDCCU1 ;WOIFO/EdM - Failed Images Maintenance ; 01/03/2007 10:54
"RTN","MAGDCCU1",2,0)
 ;;3.0;IMAGING;**54**;03-July-2009;;Build 1424
"RTN","MAGDCCU1",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDCCU1",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDCCU1",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDCCU1",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDCCU1",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDCCU1",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDCCU1",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDCCU1",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDCCU1",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDCCU1",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDCCU1",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDCCU1",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDCCU1",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDCCU1",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDCCU1",17,0)
 ;;
"RTN","MAGDCCU1",18,0)
 Q
"RTN","MAGDCCU1",19,0)
 ;
"RTN","MAGDCCU1",20,0)
REMOFAIL ; Remove all entries for a specific retired DICOM Gateway
"RTN","MAGDCCU1",21,0)
 N ACT,D0,LO,M,N,OLD,P1,P2,P3,UP,X,X0,X1
"RTN","MAGDCCU1",22,0)
 S OLD=$$GETGW(1,1) Q:OLD=""
"RTN","MAGDCCU1",23,0)
 Q:'$$WARN(OLD)
"RTN","MAGDCCU1",24,0)
 S (D0,N)=0 F  S D0=$O(^MAGD(2006.575,D0)) Q:'D0  D
"RTN","MAGDCCU1",25,0)
 . S X1=$G(^MAGD(2006.575,D0,1)),ACT=$P(X1,"^",4) Q:$TR(ACT,LO,UP)'=OLD
"RTN","MAGDCCU1",26,0)
 . S N=N+1
"RTN","MAGDCCU1",27,0)
 . S X0=$G(^MAGD(2006.575,D0,0))
"RTN","MAGDCCU1",28,0)
 . S P1=$P(X0,"^",1) K:P1'="" ^MAGD(2006.575,"B",P1,D0)
"RTN","MAGDCCU1",29,0)
 . S P1=$P(X1,"^",3) K:P1'="" ^MAGD(2006.575,"AD",P1,D0)
"RTN","MAGDCCU1",30,0)
 . S P1=$P(X1,"^",5) K:P1'="" ^MAGD(2006.575,"AFX",P1,ACT,D0)
"RTN","MAGDCCU1",31,0)
 . S P2=$P($G(^MAGD(2006.575,D0,"ASUID")),"^",1)
"RTN","MAGDCCU1",32,0)
 . I P1'="",P2'="" K ^MAGD(2006.575,"F",P1,P2,D0)
"RTN","MAGDCCU1",33,0)
 . S P1=$P(X0,"^",3) K:P1'="" ^MAGD(2006.575,"D",P1,D0)
"RTN","MAGDCCU1",34,0)
 . K ^MAGD(2006.575,D0)
"RTN","MAGDCCU1",35,0)
 . Q
"RTN","MAGDCCU1",36,0)
 L +^MAGD(2006.575,0):1E9
"RTN","MAGDCCU1",37,0)
 S X=$G(^MAGD(2006.575,0))
"RTN","MAGDCCU1",38,0)
 S $P(X,"^",1,2)="DICOM FAILED IMAGES^2006.575"
"RTN","MAGDCCU1",39,0)
 S M=$P(X,"^",4)-N S:M<1 M=0
"RTN","MAGDCCU1",40,0)
 S $P(X,"^",4)=M
"RTN","MAGDCCU1",41,0)
 S ^MAGD(2006.575,0)=X
"RTN","MAGDCCU1",42,0)
 L -^MAGD(2006.575,0)
"RTN","MAGDCCU1",43,0)
 W !!,N," Entr",$S(N=1:"y",1:"ies")," removed.",!
"RTN","MAGDCCU1",44,0)
 Q
"RTN","MAGDCCU1",45,0)
 ;
"RTN","MAGDCCU1",46,0)
REMOXMIT ; Remove all entries for a specific retired DICOM Gateway
"RTN","MAGDCCU1",47,0)
 N ACT,D0,LO,M,N,OLD,P1,P2,P3,UP,X,X0,X1
"RTN","MAGDCCU1",48,0)
 S OLD=$$GETGW(1,2) Q:OLD=""
"RTN","MAGDCCU1",49,0)
 Q:'$$WARN(OLD)
"RTN","MAGDCCU1",50,0)
 S (D0,N)=0 F  S D0=$O(^MAG(2006.587,D0)) Q:'D0  D
"RTN","MAGDCCU1",51,0)
 . S X0=$G(^MAG(2006.587,D0,0)),ACT=$P(X0,"^",5) Q:$TR(ACT,LO,UP)'=OLD
"RTN","MAGDCCU1",52,0)
 . S N=N+1
"RTN","MAGDCCU1",53,0)
 . S P1=$P(X0,"^",1),P2=$P(X0,"^",7)
"RTN","MAGDCCU1",54,0)
 . K:P1'="" ^MAG(2006.587,"B",P1,D0)
"RTN","MAGDCCU1",55,0)
 . I P1'="",P2'="" K ^MAG(2006.587,"C",P1,P2,ACT,D0)
"RTN","MAGDCCU1",56,0)
 . I P2'="" K ^MAG(2006.587,"D",ACT,P2,D0)
"RTN","MAGDCCU1",57,0)
 . K ^MAG(2006.587,D0)
"RTN","MAGDCCU1",58,0)
 . Q
"RTN","MAGDCCU1",59,0)
 L +^MAG(2006.587,0):1E9
"RTN","MAGDCCU1",60,0)
 S X=$G(^MAG(2006.587,0))
"RTN","MAGDCCU1",61,0)
 S $P(X,"^",1,2)="DICOM TRANSMIT DESTINATION^2006.587"
"RTN","MAGDCCU1",62,0)
 S M=$P(X,"^",4)-N S:M<1 M=0
"RTN","MAGDCCU1",63,0)
 S $P(X,"^",4)=M
"RTN","MAGDCCU1",64,0)
 S ^MAG(2006.587,0)=X
"RTN","MAGDCCU1",65,0)
 L -^MAG(2006.587,0)
"RTN","MAGDCCU1",66,0)
 W !!,N," Entr",$S(N=1:"y",1:"ies")," removed.",!
"RTN","MAGDCCU1",67,0)
 Q
"RTN","MAGDCCU1",68,0)
 ;
"RTN","MAGDCCU1",69,0)
RENAFAIL ; Rename all entries for a specific replaced DICOM Gateway
"RTN","MAGDCCU1",70,0)
 N ACT,D0,LO,N,NEW,OLD,P1,P2,P3,UP,X,X0,X1
"RTN","MAGDCCU1",71,0)
 S OLD=$$GETGW(1,1) Q:OLD=""
"RTN","MAGDCCU1",72,0)
 S NEW=$$GETGW(0,1) Q:NEW=""
"RTN","MAGDCCU1",73,0)
 I OLD=NEW D  Q
"RTN","MAGDCCU1",74,0)
 . W !,"Old and new names should be different..."
"RTN","MAGDCCU1",75,0)
 . Q
"RTN","MAGDCCU1",76,0)
 S (D0,N)=0 F  S D0=$O(^MAGD(2006.575,D0)) Q:'D0  D
"RTN","MAGDCCU1",77,0)
 . S X1=$G(^MAGD(2006.575,D0,1)),ACT=$P(X1,"^",4) Q:$TR(ACT,LO,UP)'=OLD
"RTN","MAGDCCU1",78,0)
 . S N=N+1
"RTN","MAGDCCU1",79,0)
 . S P1=$P(X1,"^",5) D:P1'=""
"RTN","MAGDCCU1",80,0)
 . . S:$D(^MAGD(2006.575,"AFX",P1,ACT,D0)) ^MAGD(2006.575,"AFX",P1,NEW,D0)=""
"RTN","MAGDCCU1",81,0)
 . . K ^MAGD(2006.575,"AFX",P1,ACT,D0)
"RTN","MAGDCCU1",82,0)
 . . Q
"RTN","MAGDCCU1",83,0)
 . S $P(^MAGD(2006.575,D0,1),"^",4)=NEW
"RTN","MAGDCCU1",84,0)
 . Q
"RTN","MAGDCCU1",85,0)
 W !!,N," Entr",$S(N=1:"y",1:"ies")," renamed.",!
"RTN","MAGDCCU1",86,0)
 Q
"RTN","MAGDCCU1",87,0)
 ;
"RTN","MAGDCCU1",88,0)
RENAXMIT ; Rename all entries for a specific replaced DICOM Gateway
"RTN","MAGDCCU1",89,0)
 N ACT,D0,LO,N,NEW,OLD,P1,P2,P3,UP,X,X0,X1
"RTN","MAGDCCU1",90,0)
 S OLD=$$GETGW(1,2) Q:OLD=""
"RTN","MAGDCCU1",91,0)
 S NEW=$$GETGW(0,2) Q:NEW=""
"RTN","MAGDCCU1",92,0)
 I OLD=NEW D  Q
"RTN","MAGDCCU1",93,0)
 . W !,"Old and new names should be different..."
"RTN","MAGDCCU1",94,0)
 . Q
"RTN","MAGDCCU1",95,0)
 S (D0,N)=0 F  S D0=$O(^MAG(2006.587,D0)) Q:'D0  D
"RTN","MAGDCCU1",96,0)
 . S X0=$G(^MAG(2006.587,D0,0)),ACT=$P(X0,"^",5) Q:$TR(ACT,LO,UP)'=OLD
"RTN","MAGDCCU1",97,0)
 . S N=N+1
"RTN","MAGDCCU1",98,0)
 . S P1=$P(X0,"^",1),P2=$P(X0,"^",7)
"RTN","MAGDCCU1",99,0)
 . I P1'="",P2'="" K ^MAG(2006.587,"C",P1,P2,ACT,D0)
"RTN","MAGDCCU1",100,0)
 . I P2'="" K ^MAG(2006.587,"D",ACT,P2,D0)
"RTN","MAGDCCU1",101,0)
 . I P1'="",P2'="" S ^MAG(2006.587,"C",P1,P2,NEW,D0)=""
"RTN","MAGDCCU1",102,0)
 . I P2'="" S ^MAG(2006.587,"D",NEW,P2,D0)=""
"RTN","MAGDCCU1",103,0)
 . S $P(^MAG(2006.587,D0,0),"^",5)=NEW
"RTN","MAGDCCU1",104,0)
 . Q
"RTN","MAGDCCU1",105,0)
 W !!,N," Entr",$S(N=1:"y",1:"ies")," renamed.",!
"RTN","MAGDCCU1",106,0)
 Q
"RTN","MAGDCCU1",107,0)
 ;
"RTN","MAGDCCU1",108,0)
GETGW(EXIST,WHERE) ; Get the name of a DICOM Gateway
"RTN","MAGDCCU1",109,0)
 N OK,TBL,TYPE,X
"RTN","MAGDCCU1",110,0)
 S UP="ABCDEFGHIJKLMNOPQRSTUVWXYZ"
"RTN","MAGDCCU1",111,0)
 S LO="abcdefghijklmnopqrstuvwxyz"
"RTN","MAGDCCU1",112,0)
 S WHERE=+$G(WHERE),TBL=$S(WHERE=1:"Host Name",WHERE=2:"System Title",1:"?")
"RTN","MAGDCCU1",113,0)
 Q:TBL="?"
"RTN","MAGDCCU1",114,0)
 S TYPE=$S($G(EXIST):"current",1:"new")
"RTN","MAGDCCU1",115,0)
 S OK=0 F  D  Q:OK
"RTN","MAGDCCU1",116,0)
 . W !,"Enter the ",TYPE," ",TBL," of the DICOM Gateway: "
"RTN","MAGDCCU1",117,0)
 . R X:$G(DTIME,300) E  S X="^"
"RTN","MAGDCCU1",118,0)
 . S X=$TR(X,LO,UP)
"RTN","MAGDCCU1",119,0)
 . I X["^" S X="",OK=1
"RTN","MAGDCCU1",120,0)
 . I X'["?",X'="" S OK=1 Q
"RTN","MAGDCCU1",121,0)
 . W !,"Enter the appropriate name for the DICOM Gateway."
"RTN","MAGDCCU1",122,0)
 . W !,"The ""Host Name"" is the name of the computer that is assigned"
"RTN","MAGDCCU1",123,0)
 . W !,"by the site's IRM and that follows official naming rules."
"RTN","MAGDCCU1",124,0)
 . W !,"The ""System Title"" is the name that is assigned by the staff"
"RTN","MAGDCCU1",125,0)
 . W !,"who operates the DICOM Gateway."
"RTN","MAGDCCU1",126,0)
 . W !
"RTN","MAGDCCU1",127,0)
 . Q
"RTN","MAGDCCU1",128,0)
 Q X
"RTN","MAGDCCU1",129,0)
 ;
"RTN","MAGDCCU1",130,0)
WARN(NAME) N X
"RTN","MAGDCCU1",131,0)
 W !!,"WARNING: this operation will irrevocably remove all entries"
"RTN","MAGDCCU1",132,0)
 W !,"for the DICOM Gateway named """,NAME,"""."
"RTN","MAGDCCU1",133,0)
 W !!,"Are you certain you wish to remove these entries? No//"
"RTN","MAGDCCU1",134,0)
 R X:$G(DTIME,300) E  Q 0
"RTN","MAGDCCU1",135,0)
 Q "Yy"[$E(X_"N",1)
"RTN","MAGDCCU1",136,0)
 ;
"RTN","MAGDHL7")
0^8^B23868283
"RTN","MAGDHL7",1,0)
MAGDHL7 ;WOIFO/PMK,MLH - Routine to copy HL7 data from HLSDATA to ^MAGDHL7 ; 05/18/2007 11:23
"RTN","MAGDHL7",2,0)
 ;;3.0;IMAGING;**11,30,86,54**;03-July-2009;;Build 1424
"RTN","MAGDHL7",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDHL7",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHL7",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDHL7",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDHL7",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDHL7",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDHL7",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDHL7",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDHL7",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDHL7",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDHL7",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDHL7",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDHL7",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDHL7",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHL7",17,0)
 ;;
"RTN","MAGDHL7",18,0)
 Q
"RTN","MAGDHL7",19,0)
 ;Steps for setting up the HL7 package. Version 1.5
"RTN","MAGDHL7",20,0)
 ;1) Create an entry in the HL7 APPLICATION PARAMETER file (771) called
"RTN","MAGDHL7",21,0)
 ;   'PACS GATEWAY' and set ACTIVE/INACTIVE field to ACTIVE.
"RTN","MAGDHL7",22,0)
 ;2) Create an entry in the HL7 NON-DHCP APPLICATION PARAMETER file (770)
"RTN","MAGDHL7",23,0)
 ;   called 'PACS GATEWAY' and set DHCP APPLICATION field to 'PACS GATEWAY'
"RTN","MAGDHL7",24,0)
 ;   (repoint to file 771).
"RTN","MAGDHL7",25,0)
 ;3) Set the Entry Action field of the RA SEND entry in the Protocol file
"RTN","MAGDHL7",26,0)
 ;   (101) to call 'PACS GATEWAY
"RTN","MAGDHL7",27,0)
 ;   EXAMPLE:  Replace xxxx With PACS GATEWAY
"RTN","MAGDHL7",28,0)
 ;
"RTN","MAGDHL7",29,0)
ENTRY ; Entry point for HL7 1.5 version
"RTN","MAGDHL7",30,0)
 N DA,EDT,DIK,DIR,HLSDT,IX,KDT,MAGN,MAGOUT,POP
"RTN","MAGDHL7",31,0)
 ; Entry point from ^HLTRANS to copy the data from HLSDATA to ^MAGDHL7(
"RTN","MAGDHL7",32,0)
 ; This code was reset due to a max. string code error.  Peter indicated
"RTN","MAGDHL7",33,0)
 ; he did not need the 5th piece of the OBR segment.
"RTN","MAGDHL7",34,0)
 I $D(HLSDATA(3)),$P(HLSDATA(3),"^")="OBR" S $P(HLSDATA(3),"^",5)=""
"RTN","MAGDHL7",35,0)
 D ADDDTA($NA(HLSDATA))
"RTN","MAGDHL7",36,0)
 ; Adjust the returned HLSDATA array to start at 0 instead of 1
"RTN","MAGDHL7",37,0)
 S IX=1
"RTN","MAGDHL7",38,0)
 F  Q:'IX  Q:'$D(HLSDATA(IX))  D
"RTN","MAGDHL7",39,0)
 . S HLSDATA(IX-1)=HLSDATA(IX) K HLSDATA(IX)
"RTN","MAGDHL7",40,0)
 . S IX=$O(HLSDATA(IX))
"RTN","MAGDHL7",41,0)
 . Q
"RTN","MAGDHL7",42,0)
 Q:$D(HLSDT)
"RTN","MAGDHL7",43,0)
 S Y=$$NEWMSG($$NOW^XLFDT()\1)
"RTN","MAGDHL7",44,0)
 S $P(^MAGDHL7(2006.5,+Y,0),"^",2)=$P(HLSDATA(0),"^",9) ; Message type
"RTN","MAGDHL7",45,0)
 S L=1,J=0 S ^MAGDHL7(2006.5,+Y,1,L,0)=HLSDATA(0)
"RTN","MAGDHL7",46,0)
 F  S J=$O(HLSDATA(J)) Q:J'>0  D
"RTN","MAGDHL7",47,0)
 . S L=L+1,^MAGDHL7(2006.5,+Y,1,L,0)=HLSDATA(J)
"RTN","MAGDHL7",48,0)
 . Q
"RTN","MAGDHL7",49,0)
 S ^MAGDHL7(2006.5,+Y,1,0)="^^"_L_U_L_U_DT
"RTN","MAGDHL7",50,0)
 ; Capture time
"RTN","MAGDHL7",51,0)
 S X=$P($G(^MAGDHL7(2006.5,+Y,0)),"^",3)
"RTN","MAGDHL7",52,0)
 K:X ^MAGDHL7(2006.5,"C",X,+Y)
"RTN","MAGDHL7",53,0)
 S X=$$NOW^XLFDT()
"RTN","MAGDHL7",54,0)
 S $P(^MAGDHL7(2006.5,+Y,0),"^",3)=X
"RTN","MAGDHL7",55,0)
 S ^MAGDHL7(2006.5,"C",X,+Y)=""
"RTN","MAGDHL7",56,0)
 Q
"RTN","MAGDHL7",57,0)
 ;
"RTN","MAGDHL7",58,0)
EN ; Entry point for HL7 1.6. Called from the MAG SEND ORU/ORM protocols.
"RTN","MAGDHL7",59,0)
 ; Executed after the RA protocols setup the HL7 message segments.
"RTN","MAGDHL7",60,0)
 D EN2
"RTN","MAGDHL7",61,0)
 Q
"RTN","MAGDHL7",62,0)
 ;
"RTN","MAGDHL7",63,0)
EN2 ;
"RTN","MAGDHL7",64,0)
 N DA,DIE,DIC,DR,I,J,K,L,MAGRAD,MAGRAN,MAGSAN,MAGTYPE,Y,X
"RTN","MAGDHL7",65,0)
 I $D(HLQUIT),HLQUIT Q  ; HL7 routines may have failed.
"RTN","MAGDHL7",66,0)
 S MAGRAD=""
"RTN","MAGDHL7",67,0)
 F I=1:1 X HLNEXT Q:HLQUIT'>0  D
"RTN","MAGDHL7",68,0)
 . S MAGRAD(I)=HLNODE,J=0
"RTN","MAGDHL7",69,0)
 . F  S J=$O(HLNODE(J)) Q:'J  S MAGRAD(I)=MAGRAD(I)_HLNODE(J)
"RTN","MAGDHL7",70,0)
 . Q
"RTN","MAGDHL7",71,0)
 ; Above code needed for segments greater than 245 characters.
"RTN","MAGDHL7",72,0)
 S MAGTYPE=$G(HL("MTN")),MAGRAN=$G(HL("RAN")),MAGSAN=$G(HL("SAN"))
"RTN","MAGDHL7",73,0)
 ; Add demo and modality info expected by MAGDHR* routines on gateway
"RTN","MAGDHL7",74,0)
 D ADDDTA($NA(MAGRAD))
"RTN","MAGDHL7",75,0)
 ; Fall-Through intentional
"RTN","MAGDHL7",76,0)
 ; EdM: I can find no evidence that the label below is invoked from anywhere
"RTN","MAGDHL7",77,0)
 ;      in the released code...
"RTN","MAGDHL7",78,0)
UPDATE ; Add the entry in the MAGDHL7(2006.5 global.
"RTN","MAGDHL7",79,0)
 S Y=$$NEWMSG($$NOW^XLFDT()\1)
"RTN","MAGDHL7",80,0)
 I +Y<1 Q  ; Entry not made in file.
"RTN","MAGDHL7",81,0)
 S $P(^MAGDHL7(2006.5,+Y,0),"^",2)=MAGTYPE
"RTN","MAGDHL7",82,0)
 ; Add HL7 message into word processing field.
"RTN","MAGDHL7",83,0)
 S (L,K)=0 F  S K=$O(MAGRAD(K)) Q:'K  S L=L+1,^MAGDHL7(2006.5,+Y,1,L,0)=MAGRAD(K) D
"RTN","MAGDHL7",84,0)
 . ; If segment has more than one line of data, add as a single line
"RTN","MAGDHL7",85,0)
 . ; Peter's code will take care of this.
"RTN","MAGDHL7",86,0)
 . S J=0 F  S J=$O(MAGRAD(K,J)) Q:'J  S L=L+1,^MAGDHL7(2006.5,+Y,1,L,0)=MAGRAD(K,J)
"RTN","MAGDHL7",87,0)
 S ^MAGDHL7(2006.5,+Y,1,0)="^2006.502^"_L_"^"_L_"^"_DT
"RTN","MAGDHL7",88,0)
 S X=$P($G(^MAGDHL7(2006.5,+Y,0)),"^",3)
"RTN","MAGDHL7",89,0)
 K:X ^MAGDHL7(2006.5,"C",X,+Y)
"RTN","MAGDHL7",90,0)
 S X=$$NOW^XLFDT
"RTN","MAGDHL7",91,0)
 S $P(^MAGDHL7(2006.5,+Y,0),"^",3)=X
"RTN","MAGDHL7",92,0)
 S ^MAGDHL7(2006.5,"C",X,+Y)=""
"RTN","MAGDHL7",93,0)
 Q
"RTN","MAGDHL7",94,0)
 ;
"RTN","MAGDHL7",95,0)
ADDDTA(XARY) ; SUBROUTINE - called by ENTRY, EN2
"RTN","MAGDHL7",96,0)
 ; Add demographic, visit, and modality information to HL7 messages.
"RTN","MAGDHL7",97,0)
 ; 
"RTN","MAGDHL7",98,0)
 ; input:  XARY   name of array into which additional HL7 message data is to 
"RTN","MAGDHL7",99,0)
 ;                be populated (@XARY should already contain HL7 msg segments)
"RTN","MAGDHL7",100,0)
 ;                valued  "MAGRAD"   for radiology orders
"RTN","MAGDHL7",101,0)
 ;                        "HLSDATA"  for ADT messages
"RTN","MAGDHL7",102,0)
 ;                        
"RTN","MAGDHL7",103,0)
 ; output: @XARY  with demo, visit, modality segments added
"RTN","MAGDHL7",104,0)
 ;                or NTE segment added after MSH if there was a problem
"RTN","MAGDHL7",105,0)
 ; 
"RTN","MAGDHL7",106,0)
 ; The DICOM gateway's MAGDHR* routines formerly expected to be able to use
"RTN","MAGDHL7",107,0)
 ; a DDP link to gather supplementary information about patient demographics
"RTN","MAGDHL7",108,0)
 ; and modality.  This subroutine populates the HL7 segments with the
"RTN","MAGDHL7",109,0)
 ; supplementary data, eliminating the need for the DDP link.
"RTN","MAGDHL7",110,0)
 ;
"RTN","MAGDHL7",111,0)
 N MAG7WRK ; -- work array for HL7 message
"RTN","MAGDHL7",112,0)
 N STSRBLD ; -- rebuild status
"RTN","MAGDHL7",113,0)
 N S1,S2 ; ---- scratch segment index vars
"RTN","MAGDHL7",114,0)
 ;
"RTN","MAGDHL7",115,0)
 ; Break out message -- If parse fails, insert a NTE segment and bail
"RTN","MAGDHL7",116,0)
 ; 
"RTN","MAGDHL7",117,0)
 I $$PARSE^MAG7UP(XARY,$NA(MAG7WRK)) D  Q
"RTN","MAGDHL7",118,0)
 . ; Set 1st, 2nd seg indices - don't overwrite bare MSH
"RTN","MAGDHL7",119,0)
 . S S1=$O(@XARY@(0)) S:'S1 S1=1
"RTN","MAGDHL7",120,0)
 . S S2=$O(@XARY@(S1)) S:'S2 S2=S1+1
"RTN","MAGDHL7",121,0)
 . S @XARY@((S1+S2)/2)="NTE|1||bad HL7 message structure"
"RTN","MAGDHL7",122,0)
 . Q
"RTN","MAGDHL7",123,0)
 D PIDADD^MAG7RS ; Add patient demographic data
"RTN","MAGDHL7",124,0)
 D ADDVSDG^MAG7RS ; Add patient visit and diagnosis data
"RTN","MAGDHL7",125,0)
 I MAG7WRK(1,9,1,1,1)="ORU" D OBXUPD^MAG7RSO ; Add numeric diag codes
"RTN","MAGDHL7",126,0)
 S STSRBLD=$$MAKE^MAG7UM($NA(MAG7WRK),XARY)
"RTN","MAGDHL7",127,0)
 I STSRBLD D  Q
"RTN","MAGDHL7",128,0)
 . ; Set 1st, 2nd seg indices - don't overwrite bare MSH
"RTN","MAGDHL7",129,0)
 . S S1=$O(@XARY@(0)) S:'S1 S1=1
"RTN","MAGDHL7",130,0)
 . S S2=$O(@XARY@(S1)) S:'S2 S2=S1+1
"RTN","MAGDHL7",131,0)
 . S @XARY@((S1+S2)/2)="NTE|1||bad HL7 message structure"
"RTN","MAGDHL7",132,0)
 . Q
"RTN","MAGDHL7",133,0)
 Q
"RTN","MAGDHL7",134,0)
 ;
"RTN","MAGDHL7",135,0)
NEWMSG(DATE) ; Add a stub for a new message
"RTN","MAGDHL7",136,0)
 N D0,HDR
"RTN","MAGDHL7",137,0)
 S DATE=DATE\1
"RTN","MAGDHL7",138,0)
 L +^MAGDHL7(2006.5,0):1E9 ; Background process MUST wait
"RTN","MAGDHL7",139,0)
 S D0=$O(^MAGDHL7(2006.5," "),-1)+1
"RTN","MAGDHL7",140,0)
 S ^MAGDHL7(2006.5,D0,0)=DATE
"RTN","MAGDHL7",141,0)
 S:DATE'="" ^MAGDHL7(2006.5,"B",DATE,D0)=""
"RTN","MAGDHL7",142,0)
 S HDR=$G(^MAGDHL7(2006.5,0))
"RTN","MAGDHL7",143,0)
 S ^MAGDHL7(2006.5,0)="PACS MESSAGE^2006.5D^"_D0_"^"_($P(HDR,"^",4)+1)
"RTN","MAGDHL7",144,0)
 L -^MAGDHL7(2006.5,0)
"RTN","MAGDHL7",145,0)
 Q D0
"RTN","MAGDHL7",146,0)
 ;
"RTN","MAGDHLE")
0^9^B9902651
"RTN","MAGDHLE",1,0)
MAGDHLE ;WOIFO/SRR - PACS INTERFACE PID TRIGGERS ; 05/18/2007 11:23
"RTN","MAGDHLE",2,0)
 ;;3.0;IMAGING;**54**;03-July-2009;;Build 1424
"RTN","MAGDHLE",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDHLE",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHLE",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDHLE",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDHLE",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDHLE",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDHLE",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDHLE",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDHLE",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDHLE",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDHLE",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDHLE",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDHLE",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDHLE",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHLE",17,0)
 ;;
"RTN","MAGDHLE",18,0)
SET ;Set Logic from MUMPS x-ref on fields .01,.03,.09 of ^DD(2 (^DPT)
"RTN","MAGDHLE",19,0)
 ;Kill logic: S MAGKPID=X for all 3 fields
"RTN","MAGDHLE",20,0)
 ;IN - MAGKPID = old value
"RTN","MAGDHLE",21,0)
 ;   - MAGKTYP = Message type (from field)
"RTN","MAGDHLE",22,0)
 N MAGDPTCL
"RTN","MAGDHLE",23,0)
 Q:'$G(^MAG(2006.1,"APACS"))
"RTN","MAGDHLE",24,0)
 Q
"RTN","MAGDHLE",25,0)
 G EX:'$D(MAGKPID),EX:MAGKPID=X
"RTN","MAGDHLE",26,0)
 S DFN=DA,MAGKTYP=8,MAGDPTCL="Pt. Demo."
"RTN","MAGDHLE",27,0)
 G TSK
"RTN","MAGDHLE",28,0)
 ;
"RTN","MAGDHLE",29,0)
KIL ;Kill logic "AKn" cross references
"RTN","MAGDHLE",30,0)
 Q:'$G(^MAG(2006.1,"APACS"))
"RTN","MAGDHLE",31,0)
 Q
"RTN","MAGDHLE",32,0)
 S MAGKPID=X
"RTN","MAGDHLE",33,0)
 Q
"RTN","MAGDHLE",34,0)
 ;
"RTN","MAGDHLE",35,0)
ADT ;ADT EVENTS ;From EVENT driver
"RTN","MAGDHLE",36,0)
 ;Protocol = MAGK DHCP-PACS ADT EVENTS
"RTN","MAGDHLE",37,0)
 ;IN ;DFN
"RTN","MAGDHLE",38,0)
 ;DGPMDA = IFN Primary Movement
"RTN","MAGDHLE",39,0)
 ;DGPMA = 0th node Primary Movement AFTER movement
"RTN","MAGDHLE",40,0)
 ;DGPMP = 0th node PRIOR to movement
"RTN","MAGDHLE",41,0)
 ;^UTILITY("DGPM",$J,TRANSACTION (1,2,3,6),MOVEMENT (IFN),"P"/"A")
"RTN","MAGDHLE",42,0)
 ;
"RTN","MAGDHLE",43,0)
 K MAGKTYP F I=1,2,3 I $D(^UTILITY("DGPM",$J,I,DGPMDA)) S MAGKTYP=I
"RTN","MAGDHLE",44,0)
 Q:'$D(MAGKTYP)  I MAGKTYP=2,$P(^UTILITY("DGPM",$J,2,DGPMDA,"A"),U,6)=$P(^("P"),U,6) G EX
"RTN","MAGDHLE",45,0)
TSK ;CREATE TASK to make HL7 messages
"RTN","MAGDHLE",46,0)
 S ZTSAVE("MAGKTYP")="",ZTSAVE("MAGDPTCL")=""
"RTN","MAGDHLE",47,0)
 S ZTSAVE("DFN")="",ZTDTH=$H,ZTIO=""
"RTN","MAGDHLE",48,0)
 S ZTRTN="HL7^MAGDHLE",ZTDESC=$S(MAGKTYP=8:"PID",1:"ADT")_" HL7 PACS MESSAGE"
"RTN","MAGDHLE",49,0)
 W !?5,"*** HL7 TASK FOR PACS ***" D ^%ZTLOAD G EX
"RTN","MAGDHLE",50,0)
 ;
"RTN","MAGDHLE",51,0)
HL7 ;Create HL7 message
"RTN","MAGDHLE",52,0)
 Q:'$D(^DPT(DFN,0))
"RTN","MAGDHLE",53,0)
 S N0=^DPT(DFN,0),HLNDAP="PACS GATEWAY",HLMTN="ADT"
"RTN","MAGDHLE",54,0)
 D INIT^HLTRANS
"RTN","MAGDHLE",55,0)
 D EVN,PID,NK1,PV1 K N0,N1 D EN^MAGDHL7T,KILL^HLTRANS
"RTN","MAGDHLE",56,0)
 ;D EN^HLTRANS,KILL^HLTRANS
"RTN","MAGDHLE",57,0)
EX ;EXIT
"RTN","MAGDHLE",58,0)
 K ZTRTN,ZTDESC,ZTIO,ZTDTH,ZTSAVE
"RTN","MAGDHLE",59,0)
 K MAGKPID,MAGKTYP
"RTN","MAGDHLE",60,0)
 Q
"RTN","MAGDHLE",61,0)
 ;
"RTN","MAGDHLE",62,0)
EVN ;EVENT SEGMENT
"RTN","MAGDHLE",63,0)
 S HLSDATA(2)="EVN^"_$P($T(ETYP+MAGKTYP),";",3)_"^"_$$HLDATE^HLFNC(DT)
"RTN","MAGDHLE",64,0)
 Q
"RTN","MAGDHLE",65,0)
PID ;PID SEGMENT
"RTN","MAGDHLE",66,0)
 I '$P(N0,U,9) S N0=^DPT(DFN,0)
"RTN","MAGDHLE",67,0)
 S $P(N1,U,1,7)="PID^^^"_$$M11^HLFNC(DFN)_"^^"_$$HLNAME^HLFNC($P(N0,U))_"^^"_$$HLDATE^HLFNC($P(N0,U,3))_"^"_$P(N0,U,2)
"RTN","MAGDHLE",68,0)
 S $P(N1,U,20)=$P(N0,U,9),HLSDATA(3)=N1
"RTN","MAGDHLE",69,0)
 Q
"RTN","MAGDHLE",70,0)
 ;
"RTN","MAGDHLE",71,0)
NK1 ;NEXT OF KIN
"RTN","MAGDHLE",72,0)
 S HLSDATA(4)="NK1^"
"RTN","MAGDHLE",73,0)
 Q
"RTN","MAGDHLE",74,0)
PV1 ;PV1 SEGMENT
"RTN","MAGDHLE",75,0)
 S HLSDATA(5)="PV1^^"_$S($D(^DPT(DFN,.1)):"I",1:"O")_"^"_$G(^DPT(DFN,.1))
"RTN","MAGDHLE",76,0)
 Q
"RTN","MAGDHLE",77,0)
 ;
"RTN","MAGDHLE",78,0)
ETYP ;EVENT TYPE; for later possible use
"RTN","MAGDHLE",79,0)
 ;;A01;ADMIT
"RTN","MAGDHLE",80,0)
 ;;A02;TRANSFER
"RTN","MAGDHLE",81,0)
 ;;A03;DISCHARGE
"RTN","MAGDHLE",82,0)
 ;;A04;REGISTER
"RTN","MAGDHLE",83,0)
 ;;A05;PRE-ADMIT
"RTN","MAGDHLE",84,0)
 ;;A06;TRANSFER OUT/IN
"RTN","MAGDHLE",85,0)
 ;;A07;TRANSFER IN/OUT
"RTN","MAGDHLE",86,0)
 ;;A08;UPDATE PATIENT INFORMATION
"RTN","MAGDHLE",87,0)
 Q
"RTN","MAGDHLE",88,0)
HLDT1 ;TEMP FIX FOR HLTRANS UNDEF
"RTN","MAGDHLE",89,0)
 Q
"RTN","MAGDHLE",90,0)
FIX ;
"RTN","MAGDHLE",91,0)
 Q
"RTN","MAGDHRC0")
0^10^B7715030
"RTN","MAGDHRC0",1,0)
MAGDHRC0 ;WOIFO/PMK - Read HL7 and generate DICOM ; 04/23/2007 14:45
"RTN","MAGDHRC0",2,0)
 ;;3.0;IMAGING;**46,54**;03-July-2009;;Build 1424
"RTN","MAGDHRC0",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDHRC0",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHRC0",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDHRC0",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDHRC0",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDHRC0",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDHRC0",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDHRC0",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDHRC0",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDHRC0",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDHRC0",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDHRC0",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDHRC0",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDHRC0",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHRC0",17,0)
 ;;
"RTN","MAGDHRC0",18,0)
 Q
"RTN","MAGDHRC0",19,0)
 ;
"RTN","MAGDHRC0",20,0)
 ; Functions for accessing parsed HL7 data
"RTN","MAGDHRC0",21,0)
 ;
"RTN","MAGDHRC0",22,0)
GETDATA(FLD,REP,CMP,SUB) ; get an element from HL7PARSE
"RTN","MAGDHRC0",23,0)
 Q:'$D(FLD) $$DEQUOTE($G(@HL7PARSE@(HL7SEGNO))) ; segment
"RTN","MAGDHRC0",24,0)
 Q:'$D(REP) $$DEQUOTE($G(@HL7PARSE@(HL7SEGNO,FLD))) ; field
"RTN","MAGDHRC0",25,0)
 Q:'$D(CMP) $$DEQUOTE($G(@HL7PARSE@(HL7SEGNO,FLD,REP))) ; repetition
"RTN","MAGDHRC0",26,0)
 Q:'$D(SUB) $$DEQUOTE($G(@HL7PARSE@(HL7SEGNO,FLD,REP,CMP))) ; component
"RTN","MAGDHRC0",27,0)
 Q $$DEQUOTE($G(@HL7PARSE@(HL7SEGNO,FLD,REP,CMP,SUB))) ; subcomponent
"RTN","MAGDHRC0",28,0)
 ;
"RTN","MAGDHRC0",29,0)
DEQUOTE(X) ; convert HL7 double quote data (that is, "") to empty string
"RTN","MAGDHRC0",30,0)
 Q $S(X="""""":"",1:X)
"RTN","MAGDHRC0",31,0)
 ;
"RTN","MAGDHRC0",32,0)
GETEXIST(FLD,REP,CMP,SUB) ; does the element (segment/field/rep/comp) exist
"RTN","MAGDHRC0",33,0)
 Q:'$D(FLD) $D(@HL7PARSE@(HL7SEGNO)) ; segment
"RTN","MAGDHRC0",34,0)
 Q:'$D(REP) $D(@HL7PARSE@(HL7SEGNO,FLD)) ; field
"RTN","MAGDHRC0",35,0)
 Q:'$D(CMP) $D(@HL7PARSE@(HL7SEGNO,FLD,REP)) ; repetition
"RTN","MAGDHRC0",36,0)
 Q:'$D(SUB) $D(@HL7PARSE@(HL7SEGNO,FLD,REP,CMP)) ; component
"RTN","MAGDHRC0",37,0)
 Q $D(@HL7PARSE@(HL7SEGNO,FLD,REP,CMP,SUB)) ; subcomponent
"RTN","MAGDHRC0",38,0)
 ;
"RTN","MAGDHRC0",39,0)
GETSEG(SEGMENT) ; check if the named segment exists
"RTN","MAGDHRC0",40,0)
 Q:SEGMENT'="" $O(@HL7PARSE@("B",SEGMENT,""))
"RTN","MAGDHRC0",41,0)
 Q 0
"RTN","MAGDHRC0",42,0)
 ;
"RTN","MAGDHRC0",43,0)
GETCOUNT() ; get highest index number from HL7PARSE
"RTN","MAGDHRC0",44,0)
 Q $O(@HL7PARSE@(" "),-1)
"RTN","MAGDHRC0",45,0)
 ;
"RTN","MAGDHRC0",46,0)
GETNAME(J) ; get a person's name - return in DICOM format
"RTN","MAGDHRC0",47,0)
 ; also used for provider's name - first piece is code - others shifted
"RTN","MAGDHRC0",48,0)
 N I,LAST,NAME,X
"RTN","MAGDHRC0",49,0)
 S NAME="",LAST=0 F I=1:1:6 D
"RTN","MAGDHRC0",50,0)
 . N X ; name component: last ^ first ^ mi ^ prefix ^ suffix
"RTN","MAGDHRC0",51,0)
 . S X=$$GETDATA^MAGDHRC0(J,1,I) I $L(X) S LAST=I
"RTN","MAGDHRC0",52,0)
 . S NAME=NAME_$S(I>1:"^",1:"")_$TR(X,"^\","") ; no ^ or \ chars in name
"RTN","MAGDHRC0",53,0)
 . Q
"RTN","MAGDHRC0",54,0)
 Q $P(NAME,"^",1,LAST)
"RTN","MAGDHRC0",55,0)
 ;
"RTN","MAGDHWC")
0^11^B46762790
"RTN","MAGDHWC",1,0)
MAGDHWC ;WOIFO/PMK - Capture Consult/Procedure Request data ; 05/18/2007 11:23
"RTN","MAGDHWC",2,0)
 ;;3.0;IMAGING;**10,51,46,54**;03-July-2009;;Build 1424
"RTN","MAGDHWC",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDHWC",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHWC",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDHWC",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDHWC",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDHWC",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDHWC",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDHWC",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDHWC",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDHWC",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDHWC",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDHWC",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDHWC",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDHWC",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHWC",17,0)
 ;;
"RTN","MAGDHWC",18,0)
ENTRY ;
"RTN","MAGDHWC",19,0)
 ; determine the kind of message and branch appropriately
"RTN","MAGDHWC",20,0)
 N APTSCHED,CONSULT,DATETIME,DEL,DEL2,DEL3,DEL4,DEL5,DFN
"RTN","MAGDHWC",21,0)
 N DIVISION,FILLER1,FWDFROM,FMDATE,FMDATETM,GMRCIEN,HL,HL7,HL7ORC,HL7REC
"RTN","MAGDHWC",22,0)
 N I,IGNORE,ITYPCODE,ITYPNAME,IGNORE,MSGTYPE,OBXSEGNO,ORIGSERV,SERVICE,X,Y,Z
"RTN","MAGDHWC",23,0)
 I $D(GMRCMSG) M HL7=GMRCMSG
"RTN","MAGDHWC",24,0)
 E  I $D(XQORHSTK(0)) M HL7=XQORHSTK(0)
"RTN","MAGDHWC",25,0)
 E  Q  ; can't find HL7 data to handle this!
"RTN","MAGDHWC",26,0)
 S HL7REC=HL7(1)
"RTN","MAGDHWC",27,0)
 S DEL=$E(HL7REC,4),X=$P(HL7REC,DEL,2)
"RTN","MAGDHWC",28,0)
 F I=1:1:$L(X) S @("DEL"_(I+1))=$E(X,I)
"RTN","MAGDHWC",29,0)
 S FMDATETM=$$NOW^XLFDT(),FMDATE=FMDATETM\1
"RTN","MAGDHWC",30,0)
 ;
"RTN","MAGDHWC",31,0)
 ; find PID segment and get the DFN
"RTN","MAGDHWC",32,0)
 S I=0 I '$$FINDSEG^MAGDHW0(.HL7,"PID",.I,.X) Q  ; no PID segment
"RTN","MAGDHWC",33,0)
 S DFN=$P(X,DEL,3)
"RTN","MAGDHWC",34,0)
 ;
"RTN","MAGDHWC",35,0)
 ; find ORC segment and get GMRCIEN
"RTN","MAGDHWC",36,0)
 S I=0 I '$$FINDSEG^MAGDHW0(.HL7,"ORC",.I,.HL7ORC) Q  ; no ORC segment
"RTN","MAGDHWC",37,0)
 S GMRCIEN=+$P(HL7ORC,DEL,3) ; GMRC request is in ^GMR(123,GMRCIEN,...)
"RTN","MAGDHWC",38,0)
 ;
"RTN","MAGDHWC",39,0)
 D ^MAGDTR01 ; update the Read/Unread list with the data from the HL7 message
"RTN","MAGDHWC",40,0)
 ;
"RTN","MAGDHWC",41,0)
 S IGNORE=1 ; decide if service is one that requires HL7->DICOM gateway
"RTN","MAGDHWC",42,0)
 ;
"RTN","MAGDHWC",43,0)
 ; find ORC segment and check for an "OK" order control value
"RTN","MAGDHWC",44,0)
 I $P(HL7ORC,DEL)="OK" D  Q  ; generate message by ^MAGDHWS
"RTN","MAGDHWC",45,0)
 . S SERVICE=$$GET1^DIQ(123,GMRCIEN,1,"I")
"RTN","MAGDHWC",46,0)
 . D SERVICE ; send this transaction to the DICOM gateway?
"RTN","MAGDHWC",47,0)
 . I 'IGNORE D
"RTN","MAGDHWC",48,0)
 . . D INIT^MAGDHW0 ; initialize variables
"RTN","MAGDHWC",49,0)
 . . S DATETIME=""
"RTN","MAGDHWC",50,0)
 . . D MESSAGE^MAGDHWS("O") ; indicates new order
"RTN","MAGDHWC",51,0)
 . . Q
"RTN","MAGDHWC",52,0)
 . Q
"RTN","MAGDHWC",53,0)
 ;
"RTN","MAGDHWC",54,0)
 I " CA CR DR OC OD "[(" "_$P(HL7ORC,DEL)_" ") D  Q  ; Discontinued order
"RTN","MAGDHWC",55,0)
 . S SERVICE=$$GET1^DIQ(123,GMRCIEN,1,"I")
"RTN","MAGDHWC",56,0)
 . D SERVICE ; send this transaction to the DICOM gateway?
"RTN","MAGDHWC",57,0)
 . I 'IGNORE D
"RTN","MAGDHWC",58,0)
 . . D INIT^MAGDHW0 ; initialize variables
"RTN","MAGDHWC",59,0)
 . . S DATETIME=""
"RTN","MAGDHWC",60,0)
 . . D MESSAGE^MAGDHWS("C") ; Cancelled/Discontinued order
"RTN","MAGDHWC",61,0)
 . . Q
"RTN","MAGDHWC",62,0)
 . Q
"RTN","MAGDHWC",63,0)
 ;
"RTN","MAGDHWC",64,0)
 ; check for a FORWARD in the ORC segment
"RTN","MAGDHWC",65,0)
 I $P($P(HL7ORC,DEL,16),DEL2,5)="FORWARD" D
"RTN","MAGDHWC",66,0)
 . ; get previous service from REQUEST PROCESSING ACTIVITY
"RTN","MAGDHWC",67,0)
 . S FWDFROM=$$FWDFROM^MAGDGMRC(GMRCIEN) ; FORWARDED FROM service
"RTN","MAGDHWC",68,0)
 . S Y=0 I FWDFROM S Y=$G(^MAG(2006.5831,FWDFROM,0))
"RTN","MAGDHWC",69,0)
 . I Y D  ; forwarded from location was one in the service group
"RTN","MAGDHWC",70,0)
 . . N DIVISION,Z
"RTN","MAGDHWC",71,0)
 . . ; original service request probably was sent to DICOM Gateway
"RTN","MAGDHWC",72,0)
 . . S ORIGSERV=DEL2_DEL2_DEL2_FWDFROM_DEL2
"RTN","MAGDHWC",73,0)
 . . S ORIGSERV=ORIGSERV_$S(FWDFROM:$$GET1^DIQ(123.5,FWDFROM,.01),1:"")
"RTN","MAGDHWC",74,0)
 . . S ORIGSERV=ORIGSERV_DEL2_"99CON"
"RTN","MAGDHWC",75,0)
 . . D DIVISION(Y)
"RTN","MAGDHWC",76,0)
 . . S Z=$P(Y,"^",2)
"RTN","MAGDHWC",77,0)
 . . S ITYPNAME=$P(^MAG(2005.84,Z,0),"^",1)
"RTN","MAGDHWC",78,0)
 . . S ITYPCODE=$P(^MAG(2005.84,Z,2),"^",1)
"RTN","MAGDHWC",79,0)
 . . S ORIGSERV=ORIGSERV_DEL_ITYPCODE_DEL2_ITYPNAME_DEL2_DIVISION
"RTN","MAGDHWC",80,0)
 . . S (ITYPCODE,ITYPNAME)="" ; may need them nulled in ZSV^MAGDHWA
"RTN","MAGDHWC",81,0)
 . . S IGNORE=0
"RTN","MAGDHWC",82,0)
 . . Q
"RTN","MAGDHWC",83,0)
 . Q
"RTN","MAGDHWC",84,0)
 ;
"RTN","MAGDHWC",85,0)
 ; find ZSV segment and requested service - check if appropriate
"RTN","MAGDHWC",86,0)
 S I=0 I '$$FINDSEG^MAGDHW0(.HL7,"ZSV",.I,.X) Q  ; no ZSV segment
"RTN","MAGDHWC",87,0)
 S SERVICE=$P($P(X,DEL),DEL2,4)
"RTN","MAGDHWC",88,0)
 D SERVICE ; send this transaction to the DICOM gateway?
"RTN","MAGDHWC",89,0)
 I IGNORE Q  ; just ignore HL7 message, don't send it to DICOM gateway
"RTN","MAGDHWC",90,0)
 ;
"RTN","MAGDHWC",91,0)
 S Z=$P(HL7ORC,DEL,1) ; Order Control
"RTN","MAGDHWC",92,0)
 S Y=$P(HL7ORC,DEL,5) ; Order Status
"RTN","MAGDHWC",93,0)
 I Z="SC" S MSGTYPE="RECEIVED" ; received
"RTN","MAGDHWC",94,0)
 E  I Z="RE" D  ; result
"RTN","MAGDHWC",95,0)
 . I Y="A" S MSGTYPE="PARTIAL RESULT" ; unsigned TIU note
"RTN","MAGDHWC",96,0)
 . E  I Y="CM" D  ; check for a new unsigned note
"RTN","MAGDHWC",97,0)
 . . I $$UNSIGNED^MAGDGMRC(GMRCIEN) D
"RTN","MAGDHWC",98,0)
 . . . S MSGTYPE="PARTIAL RESULT" ; unsigned TIU note
"RTN","MAGDHWC",99,0)
 . . . S FILLER1="GMRC-NEW UNSIGNED RESULT"
"RTN","MAGDHWC",100,0)
 . . . Q
"RTN","MAGDHWC",101,0)
 . . E  S MSGTYPE="COMPLETE RESULT"  ; signed TIU note
"RTN","MAGDHWC",102,0)
 . . Q
"RTN","MAGDHWC",103,0)
 . Q
"RTN","MAGDHWC",104,0)
 E  S MSGTYPE="UNKNOWN"
"RTN","MAGDHWC",105,0)
 D MSH^MAGDHWA,PID^MAGDHWA,ORC^MAGDHWA,OBR^MAGDHWA,ZSV^MAGDHWA
"RTN","MAGDHWC",106,0)
 I '$$OBX() D  ; get OBX segment from database
"RTN","MAGDHWC",107,0)
 . S I=$O(HL7(""),-1)+1 S I=$$OBX^MAGDHWS(I)
"RTN","MAGDHWC",108,0)
 . Q
"RTN","MAGDHWC",109,0)
 E  D  ; process existing OBX segment
"RTN","MAGDHWC",110,0)
 . D OBX1
"RTN","MAGDHWC",111,0)
 . Q
"RTN","MAGDHWC",112,0)
 D ALLERGY^MAGDHWA,POSTINGS^MAGDHWA
"RTN","MAGDHWC",113,0)
 D OUTPUT^MAGDHW0
"RTN","MAGDHWC",114,0)
 Q
"RTN","MAGDHWC",115,0)
 ;
"RTN","MAGDHWC",116,0)
SERVICE ; check if the service is in the DICOM Clinical Service dictionary
"RTN","MAGDHWC",117,0)
 N Y
"RTN","MAGDHWC",118,0)
 I SERVICE D  ; ignore SERVICE if it is null
"RTN","MAGDHWC",119,0)
 . S Y=$G(^MAG(2006.5831,SERVICE,0))
"RTN","MAGDHWC",120,0)
 . S DIVISION=DEL2
"RTN","MAGDHWC",121,0)
 . I Y D  ; new service is of interest to DICOM Gateway
"RTN","MAGDHWC",122,0)
 . . D DIVISION(Y)
"RTN","MAGDHWC",123,0)
 . . S Z=$P(Y,"^",2)
"RTN","MAGDHWC",124,0)
 . . S ITYPNAME=$P(^MAG(2005.84,Z,0),"^",1)
"RTN","MAGDHWC",125,0)
 . . S ITYPCODE=$P(^MAG(2005.84,Z,2),"^",1)
"RTN","MAGDHWC",126,0)
 . . S IGNORE=0
"RTN","MAGDHWC",127,0)
 . . D APPOINT
"RTN","MAGDHWC",128,0)
 . . Q
"RTN","MAGDHWC",129,0)
 . Q
"RTN","MAGDHWC",130,0)
 Q
"RTN","MAGDHWC",131,0)
 ;
"RTN","MAGDHWC",132,0)
DIVISION(Y) ;
"RTN","MAGDHWC",133,0)
 S DIVISION=$P(Y,"^",3)
"RTN","MAGDHWC",134,0)
 S DIVISION=DIVISION_DEL2_$S(DIVISION:$$GET1^DIQ(4,DIVISION,.01),1:"")
"RTN","MAGDHWC",135,0)
 Q
"RTN","MAGDHWC",136,0)
 ;
"RTN","MAGDHWC",137,0)
APPOINT ; quite often the appointment is entered before the order is entered
"RTN","MAGDHWC",138,0)
 ; if this is the case, see if we can find the corresponding appointment
"RTN","MAGDHWC",139,0)
 N CLINIC,HIT,I,LOCIEN,ORDERIEN,VASD,XE,XI
"RTN","MAGDHWC",140,0)
 ; look for appointments for today or later - don't need VASD parameters
"RTN","MAGDHWC",141,0)
 D SDA^VADPT ; get the list of the appointments
"RTN","MAGDHWC",142,0)
 ; first check the order record for the patient location
"RTN","MAGDHWC",143,0)
 ; it might be the clinic for the appointment
"RTN","MAGDHWC",144,0)
 S HIT=0 ; indicator for finding an appointment match
"RTN","MAGDHWC",145,0)
 S ORDERIEN=$$GET1^DIQ(123,GMRCIEN,.03,"I")
"RTN","MAGDHWC",146,0)
 S LOCIEN=$S(ORDERIEN:$$GET1^DIQ(100,ORDERIEN,6,"I"),1:"")
"RTN","MAGDHWC",147,0)
 I LOCIEN?1N.N1";SC(" D
"RTN","MAGDHWC",148,0)
 . S CLINIC=+LOCIEN
"RTN","MAGDHWC",149,0)
 . I $$ISCLINIC^MAGDGMRC(SERVICE,CLINIC) D
"RTN","MAGDHWC",150,0)
 . . S I=0 F  S I=$O(^UTILITY("VASD",$J,I)) Q:'I  Q:HIT  D
"RTN","MAGDHWC",151,0)
 . . . S XI=^UTILITY("VASD",$J,I,"I"),XE=^("E")
"RTN","MAGDHWC",152,0)
 . . . ; check if there is an appointment in this clinic
"RTN","MAGDHWC",153,0)
 . . . I CLINIC=$P(XI,"^",2) D APPOINT1 ; select first apt. in clinic
"RTN","MAGDHWC",154,0)
 . . . Q
"RTN","MAGDHWC",155,0)
 . . Q
"RTN","MAGDHWC",156,0)
 . Q
"RTN","MAGDHWC",157,0)
 I 'HIT D  ; no appointment for the pt. location, look for other clinics
"RTN","MAGDHWC",158,0)
 . S I=0 F  S I=$O(^UTILITY("VASD",$J,I)) Q:'I  Q:HIT  D
"RTN","MAGDHWC",159,0)
 . . S XI=^UTILITY("VASD",$J,I,"I"),XE=^("E")
"RTN","MAGDHWC",160,0)
 . . S CLINIC=$P(XI,"^",2)
"RTN","MAGDHWC",161,0)
 . . I $$ISCLINIC^MAGDGMRC(SERVICE,CLINIC) D APPOINT1
"RTN","MAGDHWC",162,0)
 . . Q
"RTN","MAGDHWC",163,0)
 . Q
"RTN","MAGDHWC",164,0)
 K ^UTILITY("VASD",$J)
"RTN","MAGDHWC",165,0)
 Q
"RTN","MAGDHWC",166,0)
 ;
"RTN","MAGDHWC",167,0)
APPOINT1 ; fill the appointment schedule array
"RTN","MAGDHWC",168,0)
 S APTSCHED("FM DATETIME")=$P(XI,"^")
"RTN","MAGDHWC",169,0)
 S APTSCHED("CLINIC IEN")=CLINIC
"RTN","MAGDHWC",170,0)
 S APTSCHED("DATETIME")=$P(XE,"^")
"RTN","MAGDHWC",171,0)
 S APTSCHED("CLINIC NAME")=$P(XE,"^",2)
"RTN","MAGDHWC",172,0)
 S HIT=1 ; to exit loop
"RTN","MAGDHWC",173,0)
 Q
"RTN","MAGDHWC",174,0)
 ;
"RTN","MAGDHWC",175,0)
OBX() ; find OBX segments to determine the highest value of OBXSEGNO
"RTN","MAGDHWC",176,0)
 N I,X
"RTN","MAGDHWC",177,0)
 S OBXSEGNO=0
"RTN","MAGDHWC",178,0)
 S I=0 F  D  Q:I=""  ; $o through HL7 message - quit when at end
"RTN","MAGDHWC",179,0)
 . I $$FINDSEG^MAGDHW0(.HL7,"OBX",.I,.X) S OBXSEGNO=$P(X,DEL,1)
"RTN","MAGDHWC",180,0)
 . Q
"RTN","MAGDHWC",181,0)
 Q OBXSEGNO
"RTN","MAGDHWC",182,0)
 ;
"RTN","MAGDHWC",183,0)
OBX1 ; if there are second level OBX data, add OBX segment prefix
"RTN","MAGDHWC",184,0)
 N I,J
"RTN","MAGDHWC",185,0)
 ; add additional OBX segments to convey the Reason for the Request
"RTN","MAGDHWC",186,0)
 ; more than one, so can't use "I $$FINDSEG^MAGDHW0(.HL7,"OBX",.I) D  "
"RTN","MAGDHWC",187,0)
 S I="" F  S I=$O(HL7(I)) Q:I=""  I $P(HL7(I),DEL)="OBX" D
"RTN","MAGDHWC",188,0)
 . I '$D(HL7(I,1)) Q  ; no additional OBX segments needed
"RTN","MAGDHWC",189,0)
 . S X=$P(HL7(I),DEL,1,5) ; copy pieces 1-5 to other segments
"RTN","MAGDHWC",190,0)
 . S J="" F  S J=$O(HL7(I,J)) Q:'J  S HL7(I,J)=X_DEL_HL7(I,J)
"RTN","MAGDHWC",191,0)
 . Q
"RTN","MAGDHWC",192,0)
 Q
"RTN","MAGDHWS")
0^12^B26963690
"RTN","MAGDHWS",1,0)
MAGDHWS ;WOIFO/PMK - Capture Consult/GMRC data ; 05/18/2007 11:23
"RTN","MAGDHWS",2,0)
 ;;3.0;IMAGING;**10,11,51,84,85,54**;03-July-2009;;Build 1424
"RTN","MAGDHWS",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDHWS",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHWS",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDHWS",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDHWS",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDHWS",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDHWS",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDHWS",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDHWS",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDHWS",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDHWS",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDHWS",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDHWS",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDHWS",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHWS",17,0)
 ;;
"RTN","MAGDHWS",18,0)
 ; Called from PROTOCOL called MAGD APPOINTMENT (^ORD(101,...))
"RTN","MAGDHWS",19,0)
 ; through the scheduling package
"RTN","MAGDHWS",20,0)
 ;
"RTN","MAGDHWS",21,0)
 N %,AFTERSTS,APTSCHED,CLINIC,CONSULTM,CUTOFF,DATETIME
"RTN","MAGDHWS",22,0)
 N DEL,DEL2,DEL3,DEL4,DEL5,DFN,DIVISION,DONE,FILLER1,FMDATE,FMDATETM
"RTN","MAGDHWS",23,0)
 N GMRCIEN,HL,IGNORE,IREQ,ITYPCODE,ITYPNAME,MSGTYPE,REQUEST
"RTN","MAGDHWS",24,0)
 N SERVICE,STATUS,UNKNOWN,X,Y,Z
"RTN","MAGDHWS",25,0)
 ;
"RTN","MAGDHWS",26,0)
 Q:$P($G(SDATA("AFTER","STATUS")),"^",3)=""  ; Not a valid appointment
"RTN","MAGDHWS",27,0)
 ;
"RTN","MAGDHWS",28,0)
 D INIT^MAGDHW0 ; initialize variables
"RTN","MAGDHWS",29,0)
 S FMDATETM=$$NOW^XLFDT(),FMDATE=FMDATETM\1
"RTN","MAGDHWS",30,0)
 S CUTOFF=$$HTFM^XLFDT($H-90) ; cutoff date is 90 days ago
"RTN","MAGDHWS",31,0)
 S DFN=$P(SDATA,"^",2),DATETIME=$P(SDATA,"^",3),CLINIC=$P(SDATA,"^",4)
"RTN","MAGDHWS",32,0)
 S APTSCHED("CLINIC IEN")=CLINIC,APTSCHED("FM DATETIME")=DATETIME
"RTN","MAGDHWS",33,0)
 S AFTERSTS=SDATA("AFTER","STATUS"),X=$P(AFTERSTS,"^",3)
"RTN","MAGDHWS",34,0)
 ; appointment management transactions from ^SD(409.63)
"RTN","MAGDHWS",35,0)
 S FILLER1="" D  Q:FILLER1=""
"RTN","MAGDHWS",36,0)
 . I X["CHECK IN" S FILLER1="SDAM-CHECKIN" Q
"RTN","MAGDHWS",37,0)
 . I X["CHECKED IN" S FILLER1="SDAM-CHECKIN" Q
"RTN","MAGDHWS",38,0)
 . I X["CHECK OUT" S FILLER1="SDAM-CHECKOUT" Q
"RTN","MAGDHWS",39,0)
 . I X["CHECKED OUT" S FILLER1="SDAM-CHECKOUT" Q
"RTN","MAGDHWS",40,0)
 . I X["AUTO RE-" S FILLER1="SDAM-SCHEDULED" Q
"RTN","MAGDHWS",41,0)
 . I X["AUTO-RE" S FILLER1="SDAM-SCHEDULED" Q
"RTN","MAGDHWS",42,0)
 . I X["ACTION REQUIRED" S FILLER1="SDAM-SCHEDULED" Q
"RTN","MAGDHWS",43,0)
 . I X["ACT REQ" S FILLER1="SDAM-SCHEDULED" Q
"RTN","MAGDHWS",44,0)
 . I X["NON-COUNT" S FILLER1="SDAM-SCHEDULED" Q
"RTN","MAGDHWS",45,0)
 . I X["CANCELLED" S FILLER1="SDAM-CANCELLED" Q
"RTN","MAGDHWS",46,0)
 . I X["NO-SHOW" S FILLER1="SDAM-CANCELLED" Q
"RTN","MAGDHWS",47,0)
 . I X["DELETED" S FILLER1="SDAM-CANCELLED" Q
"RTN","MAGDHWS",48,0)
 . I X["FUTURE" S FILLER1="SDAM-FUTURE" Q
"RTN","MAGDHWS",49,0)
 . I X["NO ACTION TAKEN" S FILLER1="SDAM-SCHEDULED" Q
"RTN","MAGDHWS",50,0)
 . I X["NO ACT TAKN" S FILLER1="SDAM-SCHEDULED" Q
"RTN","MAGDHWS",51,0)
 . I X["INPATIENT" S FILLER1="SDAM-SCHEDULED" Q
"RTN","MAGDHWS",52,0)
 . ;
"RTN","MAGDHWS",53,0)
 . W !!,"Unexpected Status: """,X,""" in protocol MAGD APPOINTMENT."
"RTN","MAGDHWS",54,0)
 . W !,"Please notify Customer Support"
"RTN","MAGDHWS",55,0)
 . W !!,"Press <Enter> to continue: " R X:$G(DTIME,300)
"RTN","MAGDHWS",56,0)
 . Q
"RTN","MAGDHWS",57,0)
 ;
"RTN","MAGDHWS",58,0)
 S APTSCHED("CLINIC NAME")=$S(CLINIC:$$GET1^DIQ(44,CLINIC,.01),1:"")
"RTN","MAGDHWS",59,0)
 ;
"RTN","MAGDHWS",60,0)
 ; find requests that can be performed in this clinic
"RTN","MAGDHWS",61,0)
 D SEARCH^MAGDGMRC(DFN,CUTOFF,CLINIC,.REQUEST)
"RTN","MAGDHWS",62,0)
 ;
"RTN","MAGDHWS",63,0)
 ; output an HL7 message for each request related to this appointment
"RTN","MAGDHWS",64,0)
 F IREQ=1:1:REQUEST D
"RTN","MAGDHWS",65,0)
 . S GMRCIEN=$P(REQUEST(IREQ),"^",1),SERVICE=$P(REQUEST(IREQ),"^",2)
"RTN","MAGDHWS",66,0)
 . S STATUS=$P(REQUEST(IREQ),"^",3)
"RTN","MAGDHWS",67,0)
 . S IGNORE=1 D SERVICE^MAGDHWC Q:IGNORE  ; not a service of interest
"RTN","MAGDHWS",68,0)
 . ; if {pending, active, scheduled, partially resulted, or complete}
"RTN","MAGDHWS",69,0)
 . I "^p^a^s^pr^c^"[("^"_STATUS_"^") D
"RTN","MAGDHWS",70,0)
 . . ; completed requests can only be checked out or cancelled
"RTN","MAGDHWS",71,0)
 . . I STATUS="c","SDAM-CHECKOUT^SDAM-CANCELLED"'[FILLER1 Q
"RTN","MAGDHWS",72,0)
 . . D MESSAGE("S")
"RTN","MAGDHWS",73,0)
 . . Q
"RTN","MAGDHWS",74,0)
 . Q
"RTN","MAGDHWS",75,0)
 Q
"RTN","MAGDHWS",76,0)
 ;
"RTN","MAGDHWS",77,0)
MESSAGE(MSGTYPE) ; invoked above and also from ^MAGDHWC for the initial order
"RTN","MAGDHWS",78,0)
 N CONSULT,HL7,MSG,NEXT,OBXSEGNO,ORCTRL,ORSTATUS
"RTN","MAGDHWS",79,0)
 I MSGTYPE="O" D  ; ordered - set in ^MAGDHWC
"RTN","MAGDHWS",80,0)
 . S MSGTYPE="ORDERED"
"RTN","MAGDHWS",81,0)
 . S ORCTRL="NW" ; order control
"RTN","MAGDHWS",82,0)
 . S ORSTATUS="IP" ; order status
"RTN","MAGDHWS",83,0)
 . Q
"RTN","MAGDHWS",84,0)
 E  D
"RTN","MAGDHWS",85,0)
 . S MSGTYPE="SCHEDULED"
"RTN","MAGDHWS",86,0)
 . S ORCTRL="SC" ; order control -- status changed
"RTN","MAGDHWS",87,0)
 . S ORSTATUS="ZC" ; scheduling
"RTN","MAGDHWS",88,0)
 . Q
"RTN","MAGDHWS",89,0)
 D MSH^HLFNC2(.HL,100000,.MSG) S $P(MSG,DEL,9)="ORM"
"RTN","MAGDHWS",90,0)
 S NEXT=0
"RTN","MAGDHWS",91,0)
 S NEXT=NEXT+1,HL7(NEXT)=MSG D MSH^MAGDHWA
"RTN","MAGDHWS",92,0)
 S NEXT=NEXT+1,HL7(NEXT)="PID",$P(HL7(NEXT),DEL,1+3)=DFN
"RTN","MAGDHWS",93,0)
 S NEXT=NEXT+1,HL7(NEXT)="PV1"
"RTN","MAGDHWS",94,0)
 D PID^MAGDHWA ; generate PID and PV1 segments
"RTN","MAGDHWS",95,0)
 S NEXT=NEXT+1,HL7(NEXT)=$$ORC D ORC^MAGDHWA
"RTN","MAGDHWS",96,0)
 S NEXT=NEXT+1,HL7(NEXT)=$$OBR D OBR^MAGDHWA
"RTN","MAGDHWS",97,0)
 S NEXT=NEXT+1,HL7(NEXT)=$$ZSV D ZSV^MAGDHWA
"RTN","MAGDHWS",98,0)
 S NEXT=NEXT+1,NEXT=$$OBX(NEXT)
"RTN","MAGDHWS",99,0)
 D ALLERGY^MAGDHWA,POSTINGS^MAGDHWA
"RTN","MAGDHWS",100,0)
 D OUTPUT^MAGDHW0
"RTN","MAGDHWS",101,0)
 Q
"RTN","MAGDHWS",102,0)
 ;
"RTN","MAGDHWS",103,0)
PV1() ; build a PV1 segment
"RTN","MAGDHWS",104,0)
 N X,Z
"RTN","MAGDHWS",105,0)
 S FROM=$$GET1^DIQ(123,GMRCIEN,.04,"I") ; patient location
"RTN","MAGDHWS",106,0)
 S Z=FROM_DEL3_$S(FROM:$$GET1^DIQ(44,FROM,.01),1:"")_DEL3_SERVICE
"RTN","MAGDHWS",107,0)
 S $P(X,DEL,10)=Z
"RTN","MAGDHWS",108,0)
 Q "PV1"_DEL_X
"RTN","MAGDHWS",109,0)
 ;
"RTN","MAGDHWS",110,0)
ORC() ; build an ORC segment
"RTN","MAGDHWS",111,0)
 N ORC,ORCPLCR,ORURG
"RTN","MAGDHWS",112,0)
 S ORCPLCR=$$GET1^DIQ(123,GMRCIEN,10,"I") ; sending provider
"RTN","MAGDHWS",113,0)
 D ORC^GMRCHL7(GMRCIEN,ORCTRL,ORCPLCR,,FMDATETM)
"RTN","MAGDHWS",114,0)
 S $P(ORC,DEL,5+1)=ORSTATUS
"RTN","MAGDHWS",115,0)
 Q ORC
"RTN","MAGDHWS",116,0)
 ;
"RTN","MAGDHWS",117,0)
ZSV() ; build a ZSV segment
"RTN","MAGDHWS",118,0)
 N ZSV
"RTN","MAGDHWS",119,0)
 D ZSV^GMRCHL7(GMRCIEN)
"RTN","MAGDHWS",120,0)
 Q ZSV
"RTN","MAGDHWS",121,0)
 ;
"RTN","MAGDHWS",122,0)
OBR() ; build an OBR segment
"RTN","MAGDHWS",123,0)
 N NOTIFY,OBR
"RTN","MAGDHWS",124,0)
 D OBR^GMRCHL72(GMRCIEN,"",FMDATETM)
"RTN","MAGDHWS",125,0)
 Q OBR
"RTN","MAGDHWS",126,0)
 ;
"RTN","MAGDHWS",127,0)
OBX(NEXT) ; build one or more OBX segments
"RTN","MAGDHWS",128,0)
 N GMRCND,GMRCND1,I,J,OBX,X
"RTN","MAGDHWS",129,0)
 D OBX^GMRCHL72(GMRCIEN)
"RTN","MAGDHWS",130,0)
 S OBXSEGNO=0
"RTN","MAGDHWS",131,0)
 F I=1:1 Q:'$D(OBX(I))  D
"RTN","MAGDHWS",132,0)
 . D OBX1(OBX(I))
"RTN","MAGDHWS",133,0)
 . I $D(OBX(I,1)) S X=$P(OBX(I),DEL,1,5) F J=1:1 Q:'$D(OBX(I,J))  D
"RTN","MAGDHWS",134,0)
 . . D OBX1(X_DEL_OBX(I,J))
"RTN","MAGDHWS",135,0)
 . . Q
"RTN","MAGDHWS",136,0)
 . Q
"RTN","MAGDHWS",137,0)
 Q NEXT
"RTN","MAGDHWS",138,0)
 ;
"RTN","MAGDHWS",139,0)
OBX1(RECORD) ; store one OBX segment into the HL7 array
"RTN","MAGDHWS",140,0)
 S HL7(NEXT)=RECORD
"RTN","MAGDHWS",141,0)
 S OBXSEGNO=$P(RECORD,DEL,2) ; get the highest value of OBXSEGNO
"RTN","MAGDHWS",142,0)
 S NEXT=NEXT+1
"RTN","MAGDHWS",143,0)
 Q
"RTN","MAGDIR8")
0^13^B10992780
"RTN","MAGDIR8",1,0)
MAGDIR8 ;WOIFO/PMK - Read a DICOM image file ; 08 Feb 2008 11:27 AM
"RTN","MAGDIR8",2,0)
 ;;3.0;IMAGING;**11,51,54**;03-July-2009;;Build 1424
"RTN","MAGDIR8",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDIR8",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR8",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDIR8",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDIR8",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDIR8",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDIR8",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDIR8",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDIR8",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDIR8",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDIR8",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDIR8",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDIR8",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDIR8",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR8",17,0)
 ;;
"RTN","MAGDIR8",18,0)
 Q
"RTN","MAGDIR8",19,0)
 ; M2MB server
"RTN","MAGDIR8",20,0)
 ;
"RTN","MAGDIR8",21,0)
 ; This routine is invoked by the M2M Broker RPC to process an image.
"RTN","MAGDIR8",22,0)
 ; It extracts each item from the REQUEST list and transfers control
"RTN","MAGDIR8",23,0)
 ; to the appropriate routine to process it.  These routines, in turn,
"RTN","MAGDIR8",24,0)
 ; add items to the RESULT list for processing back on the gateway.
"RTN","MAGDIR8",25,0)
 ;
"RTN","MAGDIR8",26,0)
ENTRY(RESULT,REQUEST) ; RPC = MAG DICOM IMAGE PROCESSING
"RTN","MAGDIR8",27,0)
 N ARGS ; ---- argument string of the REQUEST item
"RTN","MAGDIR8",28,0)
 N DATETIME ;- fileman date/time of the study
"RTN","MAGDIR8",29,0)
 N DCMPID ;--- DICOM patient id
"RTN","MAGDIR8",30,0)
 N DFN ;------ VistA's internal patient identifier
"RTN","MAGDIR8",31,0)
 N ERRCODE ;-- code for an error, if encountered
"RTN","MAGDIR8",32,0)
 N IREQUEST ;- pointer to item in REQUEST array
"RTN","MAGDIR8",33,0)
 N MSG ; ----- error message array
"RTN","MAGDIR8",34,0)
 N OPCODE ;--- operation code of the REQUEST item
"RTN","MAGDIR8",35,0)
 N RETURN ;--- intermediate return code
"RTN","MAGDIR8",36,0)
 ;
"RTN","MAGDIR8",37,0)
 ; pass the request list and determine what has to be done
"RTN","MAGDIR8",38,0)
 F IREQUEST=2:1:$G(REQUEST(1)) D
"RTN","MAGDIR8",39,0)
 . S OPCODE=$P(REQUEST(IREQUEST),"|")
"RTN","MAGDIR8",40,0)
 . S ARGS=$P(REQUEST(IREQUEST),"|",2,999)
"RTN","MAGDIR8",41,0)
 . I OPCODE="STORE1"          D ENTRY^MAGDIR81     Q
"RTN","MAGDIR8",42,0)
 . I OPCODE="ACQUIRED"        D ACQUIRED^MAGDIR82  Q
"RTN","MAGDIR8",43,0)
 . I OPCODE="PROCESSED"       D POSTPROC^MAGDIR82  Q
"RTN","MAGDIR8",44,0)
 . I OPCODE="CORRECT"         D ENTRY^MAGDIR83     Q
"RTN","MAGDIR8",45,0)
 . I OPCODE="PATIENT SAFETY"  D ENTRY^MAGDIR84     Q
"RTN","MAGDIR8",46,0)
 . I OPCODE="ROLLBACK"        D ENTRY^MAGDIR85     Q
"RTN","MAGDIR8",47,0)
 . I OPCODE="CRASH"           D                    Q
"RTN","MAGDIR8",48,0)
 . . S I=1/0 ; generate an error on the server to test error trapping
"RTN","MAGDIR8",49,0)
 . . Q
"RTN","MAGDIR8",50,0)
 . Q
"RTN","MAGDIR8",51,0)
 Q
"RTN","MAGDIR8",52,0)
 ;
"RTN","MAGDIR8",53,0)
ERROR(OPCODE,ERRCODE,MSG,ROUTINE) ; build the RESULT array for the error
"RTN","MAGDIR8",54,0)
 ; this must be called after ^MAGDIRVE is invoked to put the message
"RTN","MAGDIR8",55,0)
 ; into the RESULT array - otherwise the message will be lost
"RTN","MAGDIR8",56,0)
 N I,OK,X
"RTN","MAGDIR8",57,0)
 S X=ERRCODE_"|"_$G(MSG("TITLE"))_"|"_ROUTINE_"|"_$G(MSG("CRITICAL"))
"RTN","MAGDIR8",58,0)
 D RESULT^MAGDIR8(OPCODE,X)
"RTN","MAGDIR8",59,0)
 S OK=0,I="" F  S I=$O(MSG(I)) Q:'I  D
"RTN","MAGDIR8",60,0)
 . I MSG(I)?1"Problem detected by routine".E  D
"RTN","MAGDIR8",61,0)
 . . ; add error code to the message
"RTN","MAGDIR8",62,0)
 . . S MSG(I)=MSG(I)_"  Error Code: "_ERRCODE
"RTN","MAGDIR8",63,0)
 . . Q
"RTN","MAGDIR8",64,0)
 . S OK=1 D RESULT^MAGDIR8("MSG","|"_MSG(I))
"RTN","MAGDIR8",65,0)
 . Q
"RTN","MAGDIR8",66,0)
 D:'OK RESULT^MAGDIR8("MSG","|--no details specified--")
"RTN","MAGDIR8",67,0)
 S $P(RESULT(RESULT(1)),"|",2)="END"
"RTN","MAGDIR8",68,0)
 Q
"RTN","MAGDIR8",69,0)
 ;
"RTN","MAGDIR8",70,0)
RESULT(OPCODE,ARGS) ; add an item to the RESULT list
"RTN","MAGDIR8",71,0)
 S RESULT(1)=$G(RESULT(1),1)+1 ; first element in array is counter
"RTN","MAGDIR8",72,0)
 S RESULT(RESULT(1))=OPCODE_"|"_ARGS
"RTN","MAGDIR8",73,0)
 Q
"RTN","MAGDIR81")
0^14^B74364862
"RTN","MAGDIR81",1,0)
MAGDIR81 ;WOIFO/PMK - Read a DICOM image file ; 08 Feb 2008 11:13 AM
"RTN","MAGDIR81",2,0)
 ;;3.0;IMAGING;**11,30,51,50,46,54**;03-July-2009;;Build 1424
"RTN","MAGDIR81",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDIR81",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR81",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDIR81",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDIR81",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDIR81",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDIR81",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDIR81",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDIR81",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDIR81",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDIR81",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDIR81",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDIR81",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDIR81",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR81",17,0)
 ;;
"RTN","MAGDIR81",18,0)
 ; M2MB server
"RTN","MAGDIR81",19,0)
 ;
"RTN","MAGDIR81",20,0)
 ; This routine is invoked by the ^MAGDIR8 for the "STORE1/STORE2"
"RTN","MAGDIR81",21,0)
 ; REQUEST items when there is an image to be stored into the database.
"RTN","MAGDIR81",22,0)
 ; It adds it to the ^MAG global with appropriate pointers to the
"RTN","MAGDIR81",23,0)
 ; "parent data files".
"RTN","MAGDIR81",24,0)
 ;
"RTN","MAGDIR81",25,0)
ENTRY ; process one image
"RTN","MAGDIR81",26,0)
 N MEDATA ;--- medicine pkg patient & study data (set in ^MAGDIR8A)
"RTN","MAGDIR81",27,0)
 N FILEDATA ;- array of data to be passed between routines
"RTN","MAGDIR81",28,0)
 N FIRSTDCM ;- patient first name from the image header (ie, PNAMEDCM)
"RTN","MAGDIR81",29,0)
 N GMRCIEN ;-- internal entry number of consult/procedure request
"RTN","MAGDIR81",30,0)
 N LASTDCM ;-- patient last name from the image header (ie, PNAMEDCM)
"RTN","MAGDIR81",31,0)
 N MAGGP ;---- image's group pointer in ^MAG(2005)
"RTN","MAGDIR81",32,0)
 N MAGIEN ;--- pointer to the entry for the image in ^MAG(2005)
"RTN","MAGDIR81",33,0)
 N MIDCM ;---- patient middle initial from the image header (PNAMEDCM)
"RTN","MAGDIR81",34,0)
 N PNAMEVAH ;- patient name from VADM(1)
"RTN","MAGDIR81",35,0)
 N PROCDESC ;- procedure description (VA's name)
"RTN","MAGDIR81",36,0)
 N RADATA ;--- radiology pkg patient & study data (set in ^MAGDIR8A)
"RTN","MAGDIR81",37,0)
 N VADM ;----- array of demographic variables filled in by DEM^VADPT
"RTN","MAGDIR81",38,0)
 N I,MAG0,MAG1,MAG2,QUIT,X
"RTN","MAGDIR81",39,0)
 ;
"RTN","MAGDIR81",40,0)
 N ACNUMB,CASENUMB,EMAIL,FROMPATH,IMAGEUID,IMAGNAME,IMAGNUMB,IMGSVC
"RTN","MAGDIR81",41,0)
 N INSTLOC,INSTNAME,LASTIMG,LOCATION,MACHID,MFGR,MODALITY,MODEL,MODPARMS
"RTN","MAGDIR81",42,0)
 N MULTFRAM,PID,PNAMEDCM,ROUTRULE,SERINUMB,SERIEUID,SOPCLASS,STAMP,STATUS
"RTN","MAGDIR81",43,0)
 N STUDYDAT,STUDYTIM,STUDYDAT,STUDYTIM,STUDYUID,SYSTITLE
"RTN","MAGDIR81",44,0)
 ;
"RTN","MAGDIR81",45,0)
 S STATUS=$P(ARGS,"|",1),LOCATION=$P(ARGS,"|",2)
"RTN","MAGDIR81",46,0)
 S MACHID=$P(ARGS,"|",3),IMGSVC=$P(ARGS,"|",4)
"RTN","MAGDIR81",47,0)
 S INSTNAME=$P(ARGS,"|",5),FROMPATH=$P(ARGS,"|",6)
"RTN","MAGDIR81",48,0)
 S PID=$P(ARGS,"|",7),PNAMEDCM=$P(ARGS,"|",8)
"RTN","MAGDIR81",49,0)
 S CASENUMB=$P(ARGS,"|",9),ACNUMB=$P(ARGS,"|",10)
"RTN","MAGDIR81",50,0)
 S STUDYDAT=$P(ARGS,"|",11),STUDYTIM=$P(ARGS,"|",12)
"RTN","MAGDIR81",51,0)
 S MODALITY=$P(ARGS,"|",14)
"RTN","MAGDIR81",52,0)
 S IMAGNAME=$P(ARGS,"|",15),MODPARMS=$P(ARGS,"|",16)
"RTN","MAGDIR81",53,0)
 S SERINUMB=$P(ARGS,"|",17),IMAGNUMB=$P(ARGS,"|",18)
"RTN","MAGDIR81",54,0)
 S INSTLOC=$P(ARGS,"|",19),MULTFRAM=$P(ARGS,"|",20)
"RTN","MAGDIR81",55,0)
 S SYSTITLE=$P(ARGS,"|",21),EMAIL=$P(ARGS,"|",22)
"RTN","MAGDIR81",56,0)
 S IREQUEST=IREQUEST+1,OPCODE=$P(REQUEST(IREQUEST),"|")
"RTN","MAGDIR81",57,0)
 I OPCODE'="STORE2" D  Q
"RTN","MAGDIR81",58,0)
 . D RESULT^MAGDIR8("STORE","-101 Expecting STORE2, got """_OPCODE_"""")
"RTN","MAGDIR81",59,0)
 . Q
"RTN","MAGDIR81",60,0)
 S ARGS=$P(REQUEST(IREQUEST),"|",2,999)
"RTN","MAGDIR81",61,0)
 S STUDYUID=$P(ARGS,"|",1),SERIEUID=$P(ARGS,"|",2)
"RTN","MAGDIR81",62,0)
 S IMAGEUID=$P(ARGS,"|",3),SOPCLASS=$P(ARGS,"|",4)
"RTN","MAGDIR81",63,0)
 S LASTIMG=$P(ARGS,"|",5),ROUTRULE=$P(ARGS,"|",6)
"RTN","MAGDIR81",64,0)
 S MFGR=$P(ARGS,"|",7),MODEL=$P(ARGS,"|",8)
"RTN","MAGDIR81",65,0)
 S STAMP=$P(ARGS,"|",9)
"RTN","MAGDIR81",66,0)
 ;
"RTN","MAGDIR81",67,0)
 ; get a pointer to the image, if it is already on file
"RTN","MAGDIR81",68,0)
 S MAGIEN=$O(^MAG(2005,"P",IMAGEUID,0))
"RTN","MAGDIR81",69,0)
 ;
"RTN","MAGDIR81",70,0)
 ; the following line will have to be adjusted for DICOM SR
"RTN","MAGDIR81",71,0)
 S FILEDATA("TYPE")=$O(^MAG(2005.83,"B","IMAGE",""))
"RTN","MAGDIR81",72,0)
 ;
"RTN","MAGDIR81",73,0)
 I MULTFRAM,MAGIEN D  ; subsequent image of a multiframe object
"RTN","MAGDIR81",74,0)
 . D MULTFRAM ; require both MULTFRAM and MAGIEN to be non-zero
"RTN","MAGDIR81",75,0)
 . Q
"RTN","MAGDIR81",76,0)
 E  D  Q:ERRCODE  ; new image
"RTN","MAGDIR81",77,0)
 . S ERRCODE=$$NEWIMAGE()
"RTN","MAGDIR81",78,0)
 . I ERRCODE D  ; error - abort image processing
"RTN","MAGDIR81",79,0)
 . . D ERROR^MAGDIR8("STORE",ERRCODE,.MSG,$T(+0))
"RTN","MAGDIR81",80,0)
 . . Q
"RTN","MAGDIR81",81,0)
 . Q
"RTN","MAGDIR81",82,0)
 ;
"RTN","MAGDIR81",83,0)
 ;create the image pointer
"RTN","MAGDIR81",84,0)
 I MODPARMS="<DICOM>" D  ; store DICOM image type in VistA
"RTN","MAGDIR81",85,0)
 . S FILEDATA("OBJECT TYPE")=100 ; DICOM image type
"RTN","MAGDIR81",86,0)
 . S FILEDATA("EXTENSION")="EXT^DCM" ; specify the DICOM file extension
"RTN","MAGDIR81",87,0)
 . Q
"RTN","MAGDIR81",88,0)
 E  D  ; convert DICOM image type to TGA and store it in VistA
"RTN","MAGDIR81",89,0)
 . S FILEDATA("OBJECT TYPE")=3 ; XRAY image type
"RTN","MAGDIR81",90,0)
 . S FILEDATA("EXTENSION")="EXT^TGA" ; specify the TGA file extension
"RTN","MAGDIR81",91,0)
 . Q
"RTN","MAGDIR81",92,0)
 S FILEDATA("ABSTRACT")="ABS^STUFFONLY" ; specify the abstract net loc
"RTN","MAGDIR81",93,0)
 ;
"RTN","MAGDIR81",94,0)
 S ERRCODE=$$IMAGE^MAGDIR9B ; create the ^MAG(2005) entry for the image
"RTN","MAGDIR81",95,0)
 I ERRCODE D  ; error - abort image processing
"RTN","MAGDIR81",96,0)
 . D ERROR^MAGDIR8("STORE",ERRCODE,.MSG,$T(+0))
"RTN","MAGDIR81",97,0)
 . Q
"RTN","MAGDIR81",98,0)
 E  D  ; no error
"RTN","MAGDIR81",99,0)
 . S X="0|"_RETURN
"RTN","MAGDIR81",100,0)
 . ; save pname, pid, dob, age, and sex from DEM^VADPT for gateway
"RTN","MAGDIR81",101,0)
 . F I=1:1:5 S X=X_"|"_VADM(I)
"RTN","MAGDIR81",102,0)
 . S X=X_"|"_$$GETICN^MPIF001(DFN) ; save ICN value
"RTN","MAGDIR81",103,0)
 . D RESULT^MAGDIR8("STORE",X)
"RTN","MAGDIR81",104,0)
 . Q
"RTN","MAGDIR81",105,0)
 Q
"RTN","MAGDIR81",106,0)
 ;
"RTN","MAGDIR81",107,0)
NEWIMAGE() ; processing for a new image
"RTN","MAGDIR81",108,0)
 N ERRORMSG ;- error message causing processing to stop
"RTN","MAGDIR81",109,0)
 N PIDCHECK ;- return value of from $$PIDCHECK^MAGDIR8A()
"RTN","MAGDIR81",110,0)
 ;
"RTN","MAGDIR81",111,0)
 I MAGIEN D  I $L(ERRORMSG) Q ERRORMSG
"RTN","MAGDIR81",112,0)
 . N I,X
"RTN","MAGDIR81",113,0)
 . K MSG S I=0
"RTN","MAGDIR81",114,0)
 . I IMAGEUID=$$GETUID(MACHID) D  ; same image as last one
"RTN","MAGDIR81",115,0)
 . . ; process the image again, after software crash
"RTN","MAGDIR81",116,0)
 . . ; If the software crashed processing the first image, it might
"RTN","MAGDIR81",117,0)
 . . ; delete the image without ever writing it to the file server.
"RTN","MAGDIR81",118,0)
 . . ; Now, the image processing software has a second chance.
"RTN","MAGDIR81",119,0)
 . . S I=I+1,MSG(I)="Reprocessing image """_FROMPATH_""""
"RTN","MAGDIR81",120,0)
 . . S I=I+1,MSG(I)="which is partially in the database (#"_MAGIEN_") for"
"RTN","MAGDIR81",121,0)
 . . D ERROR^MAGDIR8("STORE","1 Image partially in the database",.MSG,$T(+0))
"RTN","MAGDIR81",122,0)
 . . S ERRORMSG="" ; this is not an error!
"RTN","MAGDIR81",123,0)
 . . Q
"RTN","MAGDIR81",124,0)
 . E  D  ; don't accept images with duplicate UIDs
"RTN","MAGDIR81",125,0)
 . . S I=I+1,MSG(I)="Image """_FROMPATH_""""
"RTN","MAGDIR81",126,0)
 . . S I=I+1,MSG(I)="is already in the database (#"_MAGIEN_") for"
"RTN","MAGDIR81",127,0)
 . . S ERRORMSG="-1 Image already in database"
"RTN","MAGDIR81",128,0)
 . . Q
"RTN","MAGDIR81",129,0)
 . S X=$P($G(^MAG(2005,MAGIEN,2)),"^",1)
"RTN","MAGDIR81",130,0)
 . S X=$S(X:$$FMTE^XLFDT(X,1),1:"<no date known>")
"RTN","MAGDIR81",131,0)
 . S I=I+1,MSG(I)=""""_$P($G(^MAG(2005,MAGIEN,0)),"^")_""""
"RTN","MAGDIR81",132,0)
 . S I=I+1,MSG(I)="Entered into VistA database on "_X
"RTN","MAGDIR81",133,0)
 . S I=I+1,MSG(I)="UID = "_IMAGEUID
"RTN","MAGDIR81",134,0)
 . Q
"RTN","MAGDIR81",135,0)
 ;
"RTN","MAGDIR81",136,0)
 D SAVEUID(MACHID,IMAGEUID) ; record the UID of the image being processed
"RTN","MAGDIR81",137,0)
 ;
"RTN","MAGDIR81",138,0)
 ; lookup the study by ACNUMB/CASENUMB, get DFN, and double-check PID
"RTN","MAGDIR81",139,0)
 S ERRCODE=$$LOOKUP Q:ERRCODE ERRCODE
"RTN","MAGDIR81",140,0)
 ;
"RTN","MAGDIR81",141,0)
 S PIDCHECK=$$PIDCHECK^MAGDIR8A()
"RTN","MAGDIR81",142,0)
 I PIDCHECK D  Q "-2 Image Association Problem" ; didn't find the study
"RTN","MAGDIR81",143,0)
 . N CASETEXT,COLUMNS,MFGR,MODEL,MODIEN,OFFSET,ROWS
"RTN","MAGDIR81",144,0)
 . ; formulate error message
"RTN","MAGDIR81",145,0)
 . K MSG
"RTN","MAGDIR81",146,0)
 . S MSG(1)=PIDCHECK
"RTN","MAGDIR81",147,0)
 . S (ROWS,COLUMNS,OFFSET,MODIEN,MFGR,MODEL,CASETEXT)=""
"RTN","MAGDIR81",148,0)
 . D MOVE^MAGDLBAA
"RTN","MAGDIR81",149,0)
 . Q
"RTN","MAGDIR81",150,0)
 ; create the group pointer
"RTN","MAGDIR81",151,0)
 I IMGSVC="RAD" D  Q:ERRCODE ERRCODE
"RTN","MAGDIR81",152,0)
 . S ERRCODE=$$GROUP^MAGDIR9A
"RTN","MAGDIR81",153,0)
 . Q
"RTN","MAGDIR81",154,0)
 E  I IMGSVC="CON" D  Q:ERRCODE ERRCODE
"RTN","MAGDIR81",155,0)
 . S ERRCODE=$$GROUP^MAGDIR9E
"RTN","MAGDIR81",156,0)
 . Q
"RTN","MAGDIR81",157,0)
 E  D  Q 3  ; undefined imaging service - same as error #4 in LOOKUP
"RTN","MAGDIR81",158,0)
 . K MSG
"RTN","MAGDIR81",159,0)
 . S MSG(1)="Undefined Imaging Service: "_IMGSVC
"RTN","MAGDIR81",160,0)
 . D ERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR81",161,0)
 . Q
"RTN","MAGDIR81",162,0)
 Q 0
"RTN","MAGDIR81",163,0)
 ;
"RTN","MAGDIR81",164,0)
SAVEUID(MACHID,UID) ; record the UID of the image being processed
"RTN","MAGDIR81",165,0)
 N D0,X
"RTN","MAGDIR81",166,0)
 S D0=$O(^MAGD(2006.5715,"B",MACHID,"")) D:'D0
"RTN","MAGDIR81",167,0)
 . L +^MAGD(2006.5715):1E9 ; Background process MUST wait
"RTN","MAGDIR81",168,0)
 . S D0=$O(^MAGD(2006.5715," "),-1)+1
"RTN","MAGDIR81",169,0)
 . S X=$G(^MAGD(2006.5715,0))
"RTN","MAGDIR81",170,0)
 . S $P(X,"^",1,2)="CURRENT IMAGE^2006.5715"
"RTN","MAGDIR81",171,0)
 . S $P(X,"^",3)=D0
"RTN","MAGDIR81",172,0)
 . S $P(X,"^",4)=$P(X,"^",4)+1
"RTN","MAGDIR81",173,0)
 . S ^MAGD(2006.5715,0)=X
"RTN","MAGDIR81",174,0)
 . S ^MAGD(2006.5715,D0,0)=MACHID
"RTN","MAGDIR81",175,0)
 . S ^MAGD(2006.5715,"B",MACHID,D0)=""
"RTN","MAGDIR81",176,0)
 . L -^MAGD(2006.5715)
"RTN","MAGDIR81",177,0)
 . Q
"RTN","MAGDIR81",178,0)
 S $P(^MAGD(2006.5715,D0,0),"^",2)=UID
"RTN","MAGDIR81",179,0)
 Q
"RTN","MAGDIR81",180,0)
 ;
"RTN","MAGDIR81",181,0)
GETUID(MACHID) ; lookup the UID of the last image processed
"RTN","MAGDIR81",182,0)
 N D0
"RTN","MAGDIR81",183,0)
 S D0=+$O(^MAGD(2006.5715,"B",MACHID,""))
"RTN","MAGDIR81",184,0)
 Q $P($G(^MAGD(2006.5715,D0,0)),"^",2)
"RTN","MAGDIR81",185,0)
 ;
"RTN","MAGDIR81",186,0)
MULTFRAM ; Handle additional images in a multiframe object
"RTN","MAGDIR81",187,0)
 ; Get the information from the first image for the additional ones
"RTN","MAGDIR81",188,0)
 ;
"RTN","MAGDIR81",189,0)
 N DIQUIET,INAME,MAG0,MAG40,MAG100,MAGPACS
"RTN","MAGDIR81",190,0)
 N SOPCLASP ; pointer to SOP Class file (#2006.532)
"RTN","MAGDIR81",191,0)
 S MAG0=^MAG(2005,MAGIEN,0),MAG1=$G(^(1)),MAG2=$G(^(2))
"RTN","MAGDIR81",192,0)
 S MAG40=$G(^MAG(2005,MAGIEN,40)),MAG100=$G(^(100))
"RTN","MAGDIR81",193,0)
 S MAGPACS=$G(^MAG(2005,MAGIEN,"PACS"))
"RTN","MAGDIR81",194,0)
 S INAME=$P(MAG0,"^",1) ; field .01
"RTN","MAGDIR81",195,0)
 S PNAMEVAH=$P(INAME,"  ",1),DCMPID=$P(INAME,"  ",2)
"RTN","MAGDIR81",196,0)
 S DFN=$P(MAG0,"^",7) ; field 5
"RTN","MAGDIR81",197,0)
 S MAGGP=$P(MAG0,"^",10) ; field 14
"RTN","MAGDIR81",198,0)
 S DATETIME=$P(MAG2,"^",5) ; field 15
"RTN","MAGDIR81",199,0)
 S FILEDATA("MODALITY")=MODALITY
"RTN","MAGDIR81",200,0)
 S FILEDATA("PARENT FILE")=$P(MAG2,"^",6) ; field 16
"RTN","MAGDIR81",201,0)
 S FILEDATA("PARENT IEN")=$P(MAG2,"^",7) ; field 17
"RTN","MAGDIR81",202,0)
 S FILEDATA("PARENT FILE PTR")=$P(MAG2,"^",8) ; field 18
"RTN","MAGDIR81",203,0)
 S FILEDATA("RAD REPORT")=$P(MAGPACS,"^",2) ; field 61
"RTN","MAGDIR81",204,0)
 S FILEDATA("RAD PROC PTR")=$P(MAGPACS,"^",3) ; field 62
"RTN","MAGDIR81",205,0)
 S FILEDATA("PACKAGE")=$P(MAG40,"^",1) ; field 40
"RTN","MAGDIR81",206,0)
 ; field 41 is not needed
"RTN","MAGDIR81",207,0)
 S FILEDATA("TYPE")=$P(MAG40,"^",3) ; field 42
"RTN","MAGDIR81",208,0)
 S FILEDATA("PROC/EVENT")=$P(MAG40,"^",4) ; field 43
"RTN","MAGDIR81",209,0)
 S FILEDATA("SPEC/SUBSPEC")=$P(MAG40,"^",5) ; field 44
"RTN","MAGDIR81",210,0)
 S FILEDATA("ACQUISITION DEVICE")=$P(MAG100,"^",4) ; field 107
"RTN","MAGDIR81",211,0)
 ; get the SOP Class pointer (file 2005, field 251)
"RTN","MAGDIR81",212,0)
 S SOPCLASP=$O(^MAG(2006.532,"B",SOPCLASS,""))
"RTN","MAGDIR81",213,0)
 S FILEDATA("SOP CLASS POINTER")=SOPCLASP
"RTN","MAGDIR81",214,0)
 S PROCDESC=$P(MAG2,"^",4) ; field 10
"RTN","MAGDIR81",215,0)
 ; S X="" F  S X=$O(FILEDATA(X)) Q:X=""  I FILEDATA(X)="" K FILEDATA(X)
"RTN","MAGDIR81",216,0)
 I PROCDESC?.E1" (#".N1")" S PROCDESC=$P(PROCDESC," (#")
"RTN","MAGDIR81",217,0)
 ; lookup patient in VistA database - needed to build VADM array
"RTN","MAGDIR81",218,0)
 S DIQUIET=1 D DEM^VADPT
"RTN","MAGDIR81",219,0)
 Q
"RTN","MAGDIR81",220,0)
 ;
"RTN","MAGDIR81",221,0)
LOOKUP() ; lookup the patient/study using cross-reference
"RTN","MAGDIR81",222,0)
 I IMGSVC="RAD" D
"RTN","MAGDIR81",223,0)
 . D RADLKUP^MAGDIR8A
"RTN","MAGDIR81",224,0)
 . Q
"RTN","MAGDIR81",225,0)
 E  I IMGSVC="CON" D
"RTN","MAGDIR81",226,0)
 . S ACNUMB=CASENUMB
"RTN","MAGDIR81",227,0)
 . D CONLKUP^MAGDIR8A
"RTN","MAGDIR81",228,0)
 . Q
"RTN","MAGDIR81",229,0)
 E  D  Q 4 ; undefined imaging service - same as error #3 in NEWIMAGE
"RTN","MAGDIR81",230,0)
 . K MSG
"RTN","MAGDIR81",231,0)
 . S MSG(1)="Undefined Imaging Service: "_IMGSVC
"RTN","MAGDIR81",232,0)
 . D ERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR81",233,0)
 . Q
"RTN","MAGDIR81",234,0)
 Q 0
"RTN","MAGDIR82")
0^15^B63521425
"RTN","MAGDIR82",1,0)
MAGDIR82 ;WOIFO/PMK - Read a DICOM image file ; 10/30/2008 09:20
"RTN","MAGDIR82",2,0)
 ;;3.0;IMAGING;**11,30,51,20,54**;03-July-2009;;Build 1424
"RTN","MAGDIR82",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDIR82",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR82",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDIR82",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDIR82",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDIR82",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDIR82",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDIR82",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDIR82",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDIR82",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDIR82",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDIR82",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDIR82",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDIR82",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR82",17,0)
 ;;
"RTN","MAGDIR82",18,0)
 ; M2MB server
"RTN","MAGDIR82",19,0)
 ;
"RTN","MAGDIR82",20,0)
 ; This routine is invoked by the ^MAGDIR8 to update statistics & add
"RTN","MAGDIR82",21,0)
 ; an image to the background processor and auto-router queues.
"RTN","MAGDIR82",22,0)
 ;
"RTN","MAGDIR82",23,0)
 ; There are two entry points, one for the "ACQUIRED" RESULT item, and
"RTN","MAGDIR82",24,0)
 ; the other (POSTPROC) for the "PROCESSED" RESULT item.
"RTN","MAGDIR82",25,0)
 ;
"RTN","MAGDIR82",26,0)
ACQUIRED ; update image acquisition statistics
"RTN","MAGDIR82",27,0)
 N INSTNAME,LOCATION,STATUS
"RTN","MAGDIR82",28,0)
 S STATUS=$P(ARGS,"|",1)
"RTN","MAGDIR82",29,0)
 S LOCATION=$P(ARGS,"|",2)
"RTN","MAGDIR82",30,0)
 S INSTNAME=$P(ARGS,"|",3)
"RTN","MAGDIR82",31,0)
 D COUNT("ACQUIRED")
"RTN","MAGDIR82",32,0)
 Q
"RTN","MAGDIR82",33,0)
 ;
"RTN","MAGDIR82",34,0)
POSTPROC ; update image processing statistics and add to BP & AR queues
"RTN","MAGDIR82",35,0)
 N COUNTFLG,ERRCODE,EVAL,I,IMAGEPTR,INSTNAME,LOCATION,MACHID,MSG,STATUS
"RTN","MAGDIR82",36,0)
 S STATUS=$P(ARGS,"|",1)
"RTN","MAGDIR82",37,0)
 S LOCATION=$P(ARGS,"|",2)
"RTN","MAGDIR82",38,0)
 S INSTNAME=$P(ARGS,"|",3)
"RTN","MAGDIR82",39,0)
 S IMAGEPTR=$P(ARGS,"|",4)
"RTN","MAGDIR82",40,0)
 S COUNTFLG=$P(ARGS,"|",5) ; zero for multiframe images
"RTN","MAGDIR82",41,0)
 S EVAL=$P(ARGS,"|",6)
"RTN","MAGDIR82",42,0)
 S MACHID=$P(ARGS,"|",7)
"RTN","MAGDIR82",43,0)
 I COUNTFLG D
"RTN","MAGDIR82",44,0)
 . D COUNT("PROCESSED") ; update the count
"RTN","MAGDIR82",45,0)
 . Q:$T(SAVEUID^MAGDIR81)=""
"RTN","MAGDIR82",46,0)
 . D SAVEUID^MAGDIR81(MACHID,"") ; clear the last image UID
"RTN","MAGDIR82",47,0)
 . Q
"RTN","MAGDIR82",48,0)
 ;
"RTN","MAGDIR82",49,0)
 S ERRCODE=""
"RTN","MAGDIR82",50,0)
 ;
"RTN","MAGDIR82",51,0)
 I $$CONSOLID^MAGDFCNV D
"RTN","MAGDIR82",52,0)
 . D POSTPRO2 ; consolidation code
"RTN","MAGDIR82",53,0)
 . Q
"RTN","MAGDIR82",54,0)
 E  D
"RTN","MAGDIR82",55,0)
 . D POSTPRO1 ; non-consolidation code
"RTN","MAGDIR82",56,0)
 . Q
"RTN","MAGDIR82",57,0)
 I ERRCODE="" D
"RTN","MAGDIR82",58,0)
 . D RESULT^MAGDIR8(OPCODE,"|"_$P(ARGS,"|",2,999))
"RTN","MAGDIR82",59,0)
 . Q
"RTN","MAGDIR82",60,0)
 E  D
"RTN","MAGDIR82",61,0)
 . D ERROR^MAGDIR8(OPCODE,ERRCODE,.MSG,$T(+0))
"RTN","MAGDIR82",62,0)
 . Q
"RTN","MAGDIR82",63,0)
 Q
"RTN","MAGDIR82",64,0)
 ;
"RTN","MAGDIR82",65,0)
POSTPRO1 ; non-consolidation code version of post processing
"RTN","MAGDIR82",66,0)
 Q:IMAGEPTR<0
"RTN","MAGDIR82",67,0)
 ; add the image to the jukebox queue
"RTN","MAGDIR82",68,0)
 D:'$$JUKEBOX^MAGBAPI(IMAGEPTR)
"RTN","MAGDIR82",69,0)
 . S I=$O(MSG(" "),-1)
"RTN","MAGDIR82",70,0)
 . S:I I=I+1,MSG(I)=" "
"RTN","MAGDIR82",71,0)
 . S I=I+1,MSG(I)="JUKEBOX QUEUE CREATION ERROR:"
"RTN","MAGDIR82",72,0)
 . S I=I+1,MSG(I)="An image has not been entered into the jukebox queue."
"RTN","MAGDIR82",73,0)
 . S I=I+1,MSG(I)="Image pointer: "_IMAGEPTR
"RTN","MAGDIR82",74,0)
 . D ERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR82",75,0)
 . S ERRCODE=-401
"RTN","MAGDIR82",76,0)
 . Q
"RTN","MAGDIR82",77,0)
 ;
"RTN","MAGDIR82",78,0)
 D:EVAL  ; Add the image to the routing evaluator queue
"RTN","MAGDIR82",79,0)
 . D WARNROUT(0)
"RTN","MAGDIR82",80,0)
 . D:$$EVAL^MAGBAPI(IMAGEPTR)<0
"RTN","MAGDIR82",81,0)
 . . S I=$O(MSG(" "),-1)
"RTN","MAGDIR82",82,0)
 . . S:I I=I+1,MSG(I)=" "
"RTN","MAGDIR82",83,0)
 . . S I=I+1,MSG(I)="AUTOROUTER EVALUATION QUEUE CREATION ERROR:"
"RTN","MAGDIR82",84,0)
 . . S I=I+1,MSG(I)="An image could not be evaluated for autorouting purposes."
"RTN","MAGDIR82",85,0)
 . . S I=I+1,MSG(I)="Image pointer: "_IMAGEPTR
"RTN","MAGDIR82",86,0)
 . . S I=I+1,MSG(I)="Error code is """_Z_"""."
"RTN","MAGDIR82",87,0)
 . . D ERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR82",88,0)
 . . S ERRCODE=ERRCODE_"-402"
"RTN","MAGDIR82",89,0)
 . . Q
"RTN","MAGDIR82",90,0)
 . Q
"RTN","MAGDIR82",91,0)
 Q
"RTN","MAGDIR82",92,0)
 ;
"RTN","MAGDIR82",93,0)
POSTPRO2 ; consolidation code version of post processing
"RTN","MAGDIR82",94,0)
 N PLACE
"RTN","MAGDIR82",95,0)
 Q:IMAGEPTR<0
"RTN","MAGDIR82",96,0)
 S PLACE=$O(^MAG(2006.1,"B",LOCATION,""))
"RTN","MAGDIR82",97,0)
 ;
"RTN","MAGDIR82",98,0)
 ; add the image to the jukebox queue
"RTN","MAGDIR82",99,0)
 D:'$$JUKEBOX^MAGBAPI(IMAGEPTR,PLACE)
"RTN","MAGDIR82",100,0)
 . S I=$O(MSG(" "),-1)
"RTN","MAGDIR82",101,0)
 . S:I I=I+1,MSG(I)=" "
"RTN","MAGDIR82",102,0)
 . S I=I+1,MSG(I)="JUKEBOX QUEUE CREATION ERROR:"
"RTN","MAGDIR82",103,0)
 . S I=I+1,MSG(I)="An image has not been entered into the jukebox queue."
"RTN","MAGDIR82",104,0)
 . S I=I+1,MSG(I)="Image pointer: "_IMAGEPTR_"   Location: "_LOCATION
"RTN","MAGDIR82",105,0)
 . D ERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR82",106,0)
 . S ERRCODE=-403
"RTN","MAGDIR82",107,0)
 . Q
"RTN","MAGDIR82",108,0)
 ;
"RTN","MAGDIR82",109,0)
 D:EVAL  ; Add the image to the routing evaluator queue
"RTN","MAGDIR82",110,0)
 . D WARNROUT(PLACE)
"RTN","MAGDIR82",111,0)
 . D:$$EVAL^MAGBAPI(IMAGEPTR,PLACE)<0
"RTN","MAGDIR82",112,0)
 . . S I=$O(MSG(" "),-1)
"RTN","MAGDIR82",113,0)
 . . S:I I=I+1,MSG(I)=" "
"RTN","MAGDIR82",114,0)
 . . S I=I+1,MSG(I)="AUTOROUTER EVALUATION QUEUE CREATION ERROR:"
"RTN","MAGDIR82",115,0)
 . . S I=I+1,MSG(I)="An image could not be evaluated for autorouting purposes."
"RTN","MAGDIR82",116,0)
 . . S I=I+1,MSG(I)="Image pointer: "_IMAGEPTR_"   Place: "_PLACE
"RTN","MAGDIR82",117,0)
 . . S I=I+1,MSG(I)="Error code is """_Z_"""."
"RTN","MAGDIR82",118,0)
 . . D ERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR82",119,0)
 . . S ERRCODE=ERRCODE_"-404"
"RTN","MAGDIR82",120,0)
 . . Q
"RTN","MAGDIR82",121,0)
 . Q
"RTN","MAGDIR82",122,0)
 Q
"RTN","MAGDIR82",123,0)
 ;
"RTN","MAGDIR82",124,0)
COUNT(STEP) ; update today's count
"RTN","MAGDIR82",125,0)
 N D2,NOW,PC,TODAY,X
"RTN","MAGDIR82",126,0)
 S NOW=$$NOW^XLFDT,TODAY=NOW\1
"RTN","MAGDIR82",127,0)
 L +^MAGDAUDT(2006.5762,TODAY):1E9 ; Background job MUST wait
"RTN","MAGDIR82",128,0)
 D:'$D(^MAGDAUDT(2006.5762,TODAY))
"RTN","MAGDIR82",129,0)
 . S X=$G(^MAGDAUDT(2006.5762,0))
"RTN","MAGDIR82",130,0)
 . S $P(X,"^",1,2)="DICOM INSTRUMENT STATISTICS^2006.5762"
"RTN","MAGDIR82",131,0)
 . S $P(X,"^",3)=TODAY
"RTN","MAGDIR82",132,0)
 . S $P(X,"^",4)=$P(X,"^",4)+1
"RTN","MAGDIR82",133,0)
 . S ^MAGDAUDT(2006.5762,0)=X
"RTN","MAGDIR82",134,0)
 . S ^MAGDAUDT(2006.5762,TODAY,0)=TODAY
"RTN","MAGDIR82",135,0)
 . S ^MAGDAUDT(2006.5762,"B",TODAY,TODAY)=""
"RTN","MAGDIR82",136,0)
 . Q
"RTN","MAGDIR82",137,0)
 S D2=$O(^MAGDAUDT(2006.5762,TODAY,1,LOCATION,1,"B",INSTNAME,""))
"RTN","MAGDIR82",138,0)
 D:'D2
"RTN","MAGDIR82",139,0)
 . S D2=$O(^MAGDAUDT(2006.5762,TODAY,1,LOCATION,1," "),-1)+1
"RTN","MAGDIR82",140,0)
 . S X=$G(^MAGDAUDT(2006.5762,TODAY,1,LOCATION,1,0))
"RTN","MAGDIR82",141,0)
 . S $P(X,"^",2)="2006.576211"
"RTN","MAGDIR82",142,0)
 . S $P(X,"^",3)=D2
"RTN","MAGDIR82",143,0)
 . S $P(X,"^",4)=$P(X,"^",4)+1
"RTN","MAGDIR82",144,0)
 . S ^MAGDAUDT(2006.5762,TODAY,1,LOCATION,0)=LOCATION
"RTN","MAGDIR82",145,0)
 . S ^MAGDAUDT(2006.5762,TODAY,1,LOCATION,1,0)=X
"RTN","MAGDIR82",146,0)
 . S ^MAGDAUDT(2006.5762,TODAY,1,LOCATION,1,D2,0)=INSTNAME
"RTN","MAGDIR82",147,0)
 . S ^MAGDAUDT(2006.5762,TODAY,1,LOCATION,1,"B",INSTNAME,D2)=""
"RTN","MAGDIR82",148,0)
 . Q
"RTN","MAGDIR82",149,0)
 S X=$G(^MAGDAUDT(2006.5762,TODAY,1,LOCATION,1,D2,0))
"RTN","MAGDIR82",150,0)
 S PC=$S(STEP="ACQUIRED":2,STEP="PROCESSED":4,1:6)
"RTN","MAGDIR82",151,0)
 S $P(X,"^",PC)=$P(X,"^",PC)+1
"RTN","MAGDIR82",152,0)
 S $P(X,"^",PC+1)=NOW
"RTN","MAGDIR82",153,0)
 S ^MAGDAUDT(2006.5762,TODAY,1,LOCATION,1,D2,0)=X
"RTN","MAGDIR82",154,0)
 L -^MAGDAUDT(2006.5762,TODAY)
"RTN","MAGDIR82",155,0)
 Q
"RTN","MAGDIR82",156,0)
 ;
"RTN","MAGDIR82",157,0)
WARNROUT(PLACE) N LAST,X2,X3
"RTN","MAGDIR82",158,0)
 D:'PLACE
"RTN","MAGDIR82",159,0)
 . S PLACE=$$PLACE^MAGDRPC2(LOCATION)
"RTN","MAGDIR82",160,0)
 . Q
"RTN","MAGDIR82",161,0)
 S LAST=$G(^MAG(2006.1,+PLACE,"LASTROUTE"))
"RTN","MAGDIR82",162,0)
 S (X2,X3)=LAST\1 D:X3
"RTN","MAGDIR82",163,0)
 . N DEST,E,I,PRI,T
"RTN","MAGDIR82",164,0)
 . Q:$$FMDIFF^XLFDT(DT,X2,1)<7
"RTN","MAGDIR82",165,0)
 . S X2=$P(LAST,"^",2) Q:X2'<DT  ; Only send one message per day
"RTN","MAGDIR82",166,0)
 . S (E,T,I)=0 F  S I=$O(^MAGQUEUE(2006.03,"C",PLACE,"EVAL",I)) Q:I=""  S E=E+1
"RTN","MAGDIR82",167,0)
 . S PRI="" F  S PRI=$O(^MAGQUEUE(2006.035,"STS",LOCATION,"WAITING",PRI)) Q:PRI=""  D
"RTN","MAGDIR82",168,0)
 . . S DEST="" F  S DEST=$O(^MAGQUEUE(2006.035,"STS",LOCATION,"WAITING",PRI,DEST)) Q:DEST=""  D
"RTN","MAGDIR82",169,0)
 . . . S I="" F  S I=$O(^MAGQUEUE(2006.035,"STS",LOCATION,"WAITING",PRI,DEST,I)) Q:I=""  S T=T+1
"RTN","MAGDIR82",170,0)
 . . . Q
"RTN","MAGDIR82",171,0)
 . . Q
"RTN","MAGDIR82",172,0)
 . S I=$O(MSG(" "),-1)
"RTN","MAGDIR82",173,0)
 . S:I I=I+1,MSG(I)=" "
"RTN","MAGDIR82",174,0)
 . S I=I+1,MSG(I)="More than a week has elapsed since "_(X3#100)_"-"_$P("Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec"," ",X3\100#100)_"-"_(X3\10000+1700)
"RTN","MAGDIR82",175,0)
 . S I=I+1,MSG(I)="when the last activity occurred that is related"
"RTN","MAGDIR82",176,0)
 . S I=I+1,MSG(I)="to the processing of Routed Image files."
"RTN","MAGDIR82",177,0)
 . S I=I+1,MSG(I)=" "
"RTN","MAGDIR82",178,0)
 . S I=I+1,MSG(I)="The site parameter for ""This is a Routing Site"" is"
"RTN","MAGDIR82",179,0)
 . S I=I+1,MSG(I)="currently turned ON."
"RTN","MAGDIR82",180,0)
 . S I=I+1,MSG(I)="If this site is no longer actively routing image files"
"RTN","MAGDIR82",181,0)
 . S I=I+1,MSG(I)="this site parameter must be turned OFF."
"RTN","MAGDIR82",182,0)
 . S I=I+1,MSG(I)="This parameter needs to be turned OFF on each VistA"
"RTN","MAGDIR82",183,0)
 . S I=I+1,MSG(I)="DICOM Gateway that processes incoming images."
"RTN","MAGDIR82",184,0)
 . S I=I+1,MSG(I)=" "
"RTN","MAGDIR82",185,0)
 . S I=I+1,MSG(I)="There are currently "_E_" entr"_$S(E=1:"y",1:"ies")
"RTN","MAGDIR82",186,0)
 . S I=I+1,MSG(I)="waiting to be processed in the evaluation queue."
"RTN","MAGDIR82",187,0)
 . S I=I+1,MSG(I)=" "
"RTN","MAGDIR82",188,0)
 . S I=I+1,MSG(I)="There are currently "_T_" entr"_$S(T=1:"y",1:"ies")
"RTN","MAGDIR82",189,0)
 . S I=I+1,MSG(I)="waiting to be processed in the transmission queue."
"RTN","MAGDIR82",190,0)
 . S I=I+1,MSG(I)=" "
"RTN","MAGDIR82",191,0)
 . S I=I+1,MSG(I)="If this site is still a routing site, then both the"
"RTN","MAGDIR82",192,0)
 . S I=I+1,MSG(I)="Routing Rule Evaluator and the Routing Transmitter"
"RTN","MAGDIR82",193,0)
 . S I=I+1,MSG(I)="must be restarted."
"RTN","MAGDIR82",194,0)
 . D ERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR82",195,0)
 . S ERRCODE=ERRCODE_"-405"
"RTN","MAGDIR82",196,0)
 . S $P(^MAG(2006.1,PLACE,"LASTROUTE"),"^",2)=DT
"RTN","MAGDIR82",197,0)
 . Q
"RTN","MAGDIR82",198,0)
 Q
"RTN","MAGDIR82",199,0)
 ;
"RTN","MAGDIR83")
0^16^B24823552
"RTN","MAGDIR83",1,0)
MAGDIR83 ;WOIFO/PMK - Read a DICOM image file ; 06/06/2005  09:20
"RTN","MAGDIR83",2,0)
 ;;3.0;IMAGING;**11,30,51,54**;03-July-2009;;Build 1424
"RTN","MAGDIR83",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDIR83",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR83",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDIR83",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDIR83",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDIR83",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDIR83",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDIR83",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDIR83",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDIR83",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDIR83",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDIR83",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDIR83",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDIR83",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR83",17,0)
 ;;
"RTN","MAGDIR83",18,0)
 ;
"RTN","MAGDIR83",19,0)
 ; M2MB server
"RTN","MAGDIR83",20,0)
 ;
"RTN","MAGDIR83",21,0)
 ; This routine is invoked by the ^MAGDIR8 to update handle DICOM
"RTN","MAGDIR83",22,0)
 ; CORRECT functions, that is, the "CORRECT" REQUEST item.
"RTN","MAGDIR83",23,0)
 ;
"RTN","MAGDIR83",24,0)
 ; This is a four-step process:
"RTN","MAGDIR83",25,0)
 ;
"RTN","MAGDIR83",26,0)
 ;    1) The "QUERY" record is sent, to obtain a list of corrected
"RTN","MAGDIR83",27,0)
 ;       images.  The list is sent back to the gateway in a list of
"RTN","MAGDIR83",28,0)
 ;       "CORRECT" RESULT items, each with new patient/study values.
"RTN","MAGDIR83",29,0)
 ;       If the images are to be deleted, the list will contain "DELETE"
"RTN","MAGDIR83",30,0)
 ;       instead of "FIXED" RESULT items.
"RTN","MAGDIR83",31,0)
 ;    2) The gateway processes each corrected/deleted image, one at a
"RTN","MAGDIR83",32,0)
 ;       time.
"RTN","MAGDIR83",33,0)
 ;    3) The gateway sends a "PROCESSED | IMAGE" record is sent back to
"RTN","MAGDIR83",34,0)
 ;       the server for each corrected image, so that each can be
"RTN","MAGDIR83",35,0)
 ;       deleted from the list.  (This is called an RPC Callback.)
"RTN","MAGDIR83",36,0)
 ;    4) Finally, the gateway sends a "PROCESSED | STUDY" record back to
"RTN","MAGDIR83",37,0)
 ;       the server to delete the remainder of the study from the list.
"RTN","MAGDIR83",38,0)
 ;
"RTN","MAGDIR83",39,0)
ENTRY ; update image acquisition statistics
"RTN","MAGDIR83",40,0)
 N LOCATION,MACHID,STATUS
"RTN","MAGDIR83",41,0)
 S STATUS=$P(ARGS,"|",1)
"RTN","MAGDIR83",42,0)
 I STATUS="QUERY" D
"RTN","MAGDIR83",43,0)
 . D QUERY
"RTN","MAGDIR83",44,0)
 . Q
"RTN","MAGDIR83",45,0)
 E  I STATUS="PROCESSED" D
"RTN","MAGDIR83",46,0)
 . D PROCESS
"RTN","MAGDIR83",47,0)
 . Q
"RTN","MAGDIR83",48,0)
 Q
"RTN","MAGDIR83",49,0)
 ;
"RTN","MAGDIR83",50,0)
QUERY ; get the list of DICOM CORRECTED files
"RTN","MAGDIR83",51,0)
 N DELFLAG,ICOUNT,IMAGEIEN,INSTNAME,LOCATION,MACHID
"RTN","MAGDIR83",52,0)
 N NEW,NEWNAME,NEWPID,NEWACN,NIMAGES,STUDYIEN,STUDYUID
"RTN","MAGDIR83",53,0)
 ;
"RTN","MAGDIR83",54,0)
 S LOCATION=$P(ARGS,"|",2),MACHID=$P(ARGS,"|",3)
"RTN","MAGDIR83",55,0)
 S NIMAGES=0,STUDYIEN=""
"RTN","MAGDIR83",56,0)
 F  S STUDYIEN=$O(^MAGD(2006.575,"AFX",LOCATION,MACHID,STUDYIEN)) Q:'STUDYIEN  Q:NIMAGES>24  D
"RTN","MAGDIR83",57,0)
 . S DELFLAG=^MAGD(2006.575,"AFX",LOCATION,MACHID,STUDYIEN)
"RTN","MAGDIR83",58,0)
 . S INSTNAME=$P(^MAGD(2006.575,STUDYIEN,"AMFG"),"^",1)
"RTN","MAGDIR83",59,0)
 . S STUDYUID=^MAGD(2006.575,STUDYIEN,"ASUID")
"RTN","MAGDIR83",60,0)
 . S NEW=^MAGD(2006.575,STUDYIEN,"FIXD")
"RTN","MAGDIR83",61,0)
 . S NEWNAME=$P(NEW,"^",3),NEWPID=$P(NEW,"^",4),NEWACN=$P(NEW,"^",5)
"RTN","MAGDIR83",62,0)
 . S IMAGEIEN=STUDYIEN ; need to process the first image
"RTN","MAGDIR83",63,0)
 . D QUERY1("NONE") ; first time - defer deleting this node
"RTN","MAGDIR83",64,0)
 . S ICOUNT=0
"RTN","MAGDIR83",65,0)
 . F  S ICOUNT=$O(^MAGD(2006.575,STUDYIEN,"RLATE",ICOUNT)) Q:'ICOUNT  Q:NIMAGES>24  D
"RTN","MAGDIR83",66,0)
 . . S IMAGEIEN=^MAGD(2006.575,STUDYIEN,"RLATE",ICOUNT,0)
"RTN","MAGDIR83",67,0)
 . . D QUERY1("IMAGE") ; regular image - delete it
"RTN","MAGDIR83",68,0)
 . . S NIMAGES=NIMAGES+1
"RTN","MAGDIR83",69,0)
 . . Q
"RTN","MAGDIR83",70,0)
 . I 'ICOUNT D  ; end of study reached - delete first image & study
"RTN","MAGDIR83",71,0)
 . . S IMAGEIEN=STUDYIEN ; need to delete first image and the study
"RTN","MAGDIR83",72,0)
 . . D QUERY1("STUDY") ; second time, now delete the study entry
"RTN","MAGDIR83",73,0)
 . . Q
"RTN","MAGDIR83",74,0)
 . Q
"RTN","MAGDIR83",75,0)
 Q
"RTN","MAGDIR83",76,0)
 ;
"RTN","MAGDIR83",77,0)
QUERY1(DELTYPE) ; build one CORRECT Result PROCESS array node
"RTN","MAGDIR83",78,0)
 N FROMPATH,X
"RTN","MAGDIR83",79,0)
 S FROMPATH=$P($G(^MAGD(2006.575,IMAGEIEN,0)),"^",1) Q:FROMPATH=""
"RTN","MAGDIR83",80,0)
 S X=$S(DELFLAG="D":"DELETE",1:"FIXED")
"RTN","MAGDIR83",81,0)
 S X=X_"|"_IMAGEIEN_"|"_STUDYIEN_"|"_DELTYPE_"|"_INSTNAME
"RTN","MAGDIR83",82,0)
 S X=X_"|"_FROMPATH_"|"_STUDYUID_"|"_NEWNAME_"|"_NEWPID_"|"_NEWACN
"RTN","MAGDIR83",83,0)
 D RESULT^MAGDIR8("CORRECT",X)
"RTN","MAGDIR83",84,0)
 Q
"RTN","MAGDIR83",85,0)
 ;
"RTN","MAGDIR83",86,0)
 ; -----------------------  RPC CALLBACK ------------------------------
"RTN","MAGDIR83",87,0)
 ;
"RTN","MAGDIR83",88,0)
PROCESS ; delete the processed corrected entry from the ^MAGD(2006.575) file
"RTN","MAGDIR83",89,0)
 N DELTYPE,EXIST,FILEPATH,IMAGEIEN,LOCATION,RLATEIEN,STUDYIEN
"RTN","MAGDIR83",90,0)
 S IMAGEIEN=$P(ARGS,"|",2),STUDYIEN=$P(ARGS,"|",3)
"RTN","MAGDIR83",91,0)
 S DELTYPE=$P(ARGS,"|",4),FILEPATH=$P(ARGS,"|",6) ; ignore piece #5
"RTN","MAGDIR83",92,0)
 I DELTYPE'="NONE" D  ; don't delete the first image/study in the list
"RTN","MAGDIR83",93,0)
 . L +^MAGD(2006.575,0):1E9 ; Background process MUST wait
"RTN","MAGDIR83",94,0)
 . I DELTYPE="IMAGE" D  ; delete this image
"RTN","MAGDIR83",95,0)
 . . ; remove the related image cross-references
"RTN","MAGDIR83",96,0)
 . . S RLATEIEN=$O(^MAGD(2006.575,STUDYIEN,"RLATE","B",IMAGEIEN,""))
"RTN","MAGDIR83",97,0)
 . . I RLATEIEN D
"RTN","MAGDIR83",98,0)
 . . . K ^MAGD(2006.575,STUDYIEN,"RLATE",RLATEIEN)
"RTN","MAGDIR83",99,0)
 . . . K ^MAGD(2006.575,STUDYIEN,"RLATE","B",IMAGEIEN,RLATEIEN)
"RTN","MAGDIR83",100,0)
 . . . S $P(^(0),"^",4)=$P(^MAGD(2006.575,STUDYIEN,"RLATE",0),"^",4)-1
"RTN","MAGDIR83",101,0)
 . . . Q
"RTN","MAGDIR83",102,0)
 . . Q
"RTN","MAGDIR83",103,0)
 . E  I DELTYPE="STUDY" D  ; delete the first image and study information
"RTN","MAGDIR83",104,0)
 . . ; remove the "AFX" and "F" cross-references
"RTN","MAGDIR83",105,0)
 . . S STUDYUID=$P(ARGS,"|",7),MACHID=$P(ARGS,"|",8)
"RTN","MAGDIR83",106,0)
 . . S LOCATION=$P(ARGS,"|",9)
"RTN","MAGDIR83",107,0)
 . . K ^MAGD(2006.575,"AFX",LOCATION,MACHID,STUDYIEN)
"RTN","MAGDIR83",108,0)
 . . K ^MAGD(2006.575,"F",LOCATION,STUDYUID,STUDYIEN)
"RTN","MAGDIR83",109,0)
 . . Q
"RTN","MAGDIR83",110,0)
 . ; Only subtract 1 from #entries, if we're actually deleting one:
"RTN","MAGDIR83",111,0)
 . S EXIST=$D(^MAGD(2006.575,IMAGEIEN))
"RTN","MAGDIR83",112,0)
 . K ^MAGD(2006.575,IMAGEIEN)
"RTN","MAGDIR83",113,0)
 . K ^MAGD(2006.575,"B",FILEPATH,IMAGEIEN)
"RTN","MAGDIR83",114,0)
 . S:EXIST $P(^(0),"^",4)=$P(^MAGD(2006.575,0),"^",4)-1
"RTN","MAGDIR83",115,0)
 . L -^MAGD(2006.575,0)
"RTN","MAGDIR83",116,0)
 . Q
"RTN","MAGDIR83",117,0)
 D RESULT^MAGDIR8("CORRECT","COMPLETE|"_IMAGEIEN_"|"_STUDYIEN_"|"_DELTYPE)
"RTN","MAGDIR83",118,0)
 Q
"RTN","MAGDIR84")
0^17^B17691728
"RTN","MAGDIR84",1,0)
MAGDIR84 ;WOIFO/PMK - Read a DICOM image file ; 19 Sep 2007 9:43 AM
"RTN","MAGDIR84",2,0)
 ;;3.0;IMAGING;**11,54**;03-July-2009;;Build 1424
"RTN","MAGDIR84",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDIR84",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR84",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDIR84",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDIR84",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDIR84",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDIR84",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDIR84",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDIR84",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDIR84",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDIR84",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDIR84",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDIR84",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDIR84",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR84",17,0)
 ;;
"RTN","MAGDIR84",18,0)
 ; M2MB server
"RTN","MAGDIR84",19,0)
 ;
"RTN","MAGDIR84",20,0)
 ; This routine handles the "PATIENT SAFETY" REQUEST item.
"RTN","MAGDIR84",21,0)
 ;
"RTN","MAGDIR84",22,0)
 ; It checks the 0-node of ^MAG(2005) and other files to verify that
"RTN","MAGDIR84",23,0)
 ; they have not been unintentionally decremented.  This is a safety
"RTN","MAGDIR84",24,0)
 ; precaution to prevent an earlier copy of the global from being used.
"RTN","MAGDIR84",25,0)
 ; 
"RTN","MAGDIR84",26,0)
 ; This problem can be caused either by using the VA AXP DSM 
"RTN","MAGDIR84",27,0)
 ; Global/Volume Set Repacking Utility or by restoring an old
"RTN","MAGDIR84",28,0)
 ; copy of the global.
"RTN","MAGDIR84",29,0)
 ; 
"RTN","MAGDIR84",30,0)
ENTRY ; entry point from ^MAGDIR8
"RTN","MAGDIR84",31,0)
 N LASTIEN ;-- internal entry number of last image in ^MAG(2005)
"RTN","MAGDIR84",32,0)
 N LASTPTR ;-- value of "LAST IMAGE POINTER"
"RTN","MAGDIR84",33,0)
 N FILE ;----- name of MUMPS file containing 0-node for testing
"RTN","MAGDIR84",34,0)
 N FILENAME ;- human-readable name of file begin tested
"RTN","MAGDIR84",35,0)
 N NEWVALUE ;- updated value for the last pointer
"RTN","MAGDIR84",36,0)
 N RESULTS ;-- result string (working variable)
"RTN","MAGDIR84",37,0)
 ;
"RTN","MAGDIR84",38,0)
 N EMAIL,LASTIMG,LASTRAD,SYSTITLE
"RTN","MAGDIR84",39,0)
 ;
"RTN","MAGDIR84",40,0)
 S LASTIMG=$P(ARGS,"|",2),LASTRAD=$P(ARGS,"|",3)
"RTN","MAGDIR84",41,0)
 S SYSTITLE=$P(ARGS,"|",4),EMAIL=$P(ARGS,"|",5)
"RTN","MAGDIR84",42,0)
 ;
"RTN","MAGDIR84",43,0)
 I $$MAG D  ; imaging file (2005)
"RTN","MAGDIR84",44,0)
 . ; error with imaging file
"RTN","MAGDIR84",45,0)
 . D ERROR^MAGDIR8("PATIENT SAFETY","-1 IMAGE FILE CORRUPTION",.MSG,$T(+0))
"RTN","MAGDIR84",46,0)
 . Q
"RTN","MAGDIR84",47,0)
 E  D  ; no error with imaging file
"RTN","MAGDIR84",48,0)
 . S RESULTS="0|"_NEWVALUE ; new IMAGEPTR
"RTN","MAGDIR84",49,0)
 . ;
"RTN","MAGDIR84",50,0)
 . I $$RARPT D  ; radiology report file
"RTN","MAGDIR84",51,0)
 . . ; error with radiology report file
"RTN","MAGDIR84",52,0)
 . . D ERROR^MAGDIR8("PATIENT SAFETY","-2 RAD REPORT FILE CORRUPTION",.MSG,$T(+0))
"RTN","MAGDIR84",53,0)
 . . Q
"RTN","MAGDIR84",54,0)
 . E  D  ; no errors
"RTN","MAGDIR84",55,0)
 . . S RESULTS=RESULTS_"|"_NEWVALUE ; new RADPT
"RTN","MAGDIR84",56,0)
 . . I RESULTS'=$P(ARGS,"|",1,3) D  ; do this only if there are changes
"RTN","MAGDIR84",57,0)
 . . . D RESULT^MAGDIR8("PATIENT SAFETY",RESULTS)
"RTN","MAGDIR84",58,0)
 . . . Q
"RTN","MAGDIR84",59,0)
 . . Q
"RTN","MAGDIR84",60,0)
 . Q
"RTN","MAGDIR84",61,0)
 Q
"RTN","MAGDIR84",62,0)
 ;
"RTN","MAGDIR84",63,0)
MAG() ; check that the last image pointer is monotonically increasing
"RTN","MAGDIR84",64,0)
 S FILE="^MAG(2005)",FILENAME="IMAGE",LASTPTR=LASTIMG
"RTN","MAGDIR84",65,0)
 I $$CHECK1'<0 Q 0 ; normal exit, everything is consistent
"RTN","MAGDIR84",66,0)
 ;
"RTN","MAGDIR84",67,0)
 ; Something fishy may be up ... look for multiple deleted entries
"RTN","MAGDIR84",68,0)
 N LAST,LASTDEL,LASTMAG
"RTN","MAGDIR84",69,0)
 H 5 ; wait for other image gateways to complete file update
"RTN","MAGDIR84",70,0)
 S LASTMAG=$O(^MAG(2005," "),-1) ; last image file ien
"RTN","MAGDIR84",71,0)
 S LASTDEL=$O(^MAG(2005.1," "),-1) ; last delete file ien
"RTN","MAGDIR84",72,0)
 S LAST=$S(LASTDEL>LASTMAG:LASTDEL,1:LASTMAG) ; greater of these
"RTN","MAGDIR84",73,0)
 I LAST<LASTPTR D  Q 1  ; issue an error message, as data is missing
"RTN","MAGDIR84",74,0)
 . D MAGZERO^MAGDIRVE($T(+0),LASTIEN,LASTIMG)
"RTN","MAGDIR84",75,0)
 . Q
"RTN","MAGDIR84",76,0)
 Q 0
"RTN","MAGDIR84",77,0)
 ;
"RTN","MAGDIR84",78,0)
RARPT() ; check ^RARPT to make sure that it isn't decremented abnormally
"RTN","MAGDIR84",79,0)
 S FILE="^RARPT",FILENAME="RAD REPORT",LASTPTR=LASTRAD
"RTN","MAGDIR84",80,0)
 Q $$CHECK
"RTN","MAGDIR84",81,0)
 ;
"RTN","MAGDIR84",82,0)
CHECK() ; check the last internal entry with that previously saved
"RTN","MAGDIR84",83,0)
 I $$CHECK1'<0 Q 0 ; normal exit, everything is consistent
"RTN","MAGDIR84",84,0)
 ;
"RTN","MAGDIR84",85,0)
 ; Something fishy may be up ... flag the error
"RTN","MAGDIR84",86,0)
 D ZERONODE^MAGDIRVE($T(+0),LASTIEN,LASTPTR,FILE,FILENAME)
"RTN","MAGDIR84",87,0)
 Q 1
"RTN","MAGDIR84",88,0)
 ;
"RTN","MAGDIR84",89,0)
CHECK1() ; check the last internal entry number against the largest know value
"RTN","MAGDIR84",90,0)
 S LASTIEN=$O(@FILE@(" "),-1) ; changed from piece 3 of zero node - PMK 6/4/02
"RTN","MAGDIR84",91,0)
 S NEWVALUE=LASTPTR,LASTPTR=+LASTPTR
"RTN","MAGDIR84",92,0)
 I LASTIEN=LASTPTR Q 0 ; no change
"RTN","MAGDIR84",93,0)
 I LASTIEN>LASTPTR D UPDATE Q 1 ; record last ien in ^MAGDICOM
"RTN","MAGDIR84",94,0)
 ;
"RTN","MAGDIR84",95,0)
 ; if last entry was deleted, LASTIEN should be one less than LASTPTR 
"RTN","MAGDIR84",96,0)
 I LASTIEN=(LASTPTR-1) D UPDATE Q 1 ; a delete must have happened
"RTN","MAGDIR84",97,0)
 Q -1 ; the last entry number is less that it should be
"RTN","MAGDIR84",98,0)
 ;
"RTN","MAGDIR84",99,0)
UPDATE ; record the largest known internal entry number in ^MAGDICOM
"RTN","MAGDIR84",100,0)
 N Y
"RTN","MAGDIR84",101,0)
 S Y=$$HTE^XLFDT($H,1)
"RTN","MAGDIR84",102,0)
 S NEWVALUE=LASTIEN_" "_$P(Y,",")_" at "_$P(Y,"@",2)
"RTN","MAGDIR84",103,0)
 Q
"RTN","MAGDIR84",104,0)
 ;
"RTN","MAGDIR9A")
0^18^B51676993
"RTN","MAGDIR9A",1,0)
MAGDIR9A ;WOIFO/PMK - Read a DICOM image file ; 10/31/2007 12:28
"RTN","MAGDIR9A",2,0)
 ;;3.0;IMAGING;**11,30,51,46,54**;03-July-2009;;Build 1424
"RTN","MAGDIR9A",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDIR9A",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR9A",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDIR9A",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDIR9A",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDIR9A",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDIR9A",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDIR9A",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDIR9A",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDIR9A",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDIR9A",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDIR9A",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDIR9A",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDIR9A",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR9A",17,0)
 ;;
"RTN","MAGDIR9A",18,0)
 Q
"RTN","MAGDIR9A",19,0)
 ; M2MB server
"RTN","MAGDIR9A",20,0)
 ;
"RTN","MAGDIR9A",21,0)
 ; This routine creates a ^mag(2005) group entry and links it to the
"RTN","MAGDIR9A",22,0)
 ; associated radiology report
"RTN","MAGDIR9A",23,0)
 ;
"RTN","MAGDIR9A",24,0)
 ;   XXXXXX      XX    XXXXXX
"RTN","MAGDIR9A",25,0)
 ;    XX  XX    XXXX    XX  XX
"RTN","MAGDIR9A",26,0)
 ;    XX  XX   XX  XX   XX  XX
"RTN","MAGDIR9A",27,0)
 ;    XXXXX    XX  XX   XX  XX
"RTN","MAGDIR9A",28,0)
 ;    XX XX    XXXXXX   XX  XX
"RTN","MAGDIR9A",29,0)
 ;    XX  XX   XX  XX   XX  XX
"RTN","MAGDIR9A",30,0)
 ;   XXX  XX   XX  XX  XXXXXX
"RTN","MAGDIR9A",31,0)
 ;
"RTN","MAGDIR9A",32,0)
GROUP() ; entry point from ^MAGDIR81
"RTN","MAGDIR9A",33,0)
 N ACQDEVP ;-- pointer to acquisition device file (#2006.04)
"RTN","MAGDIR9A",34,0)
 N DA ;------ fileman variable
"RTN","MAGDIR9A",35,0)
 N ERRCODE ;- error trap code
"RTN","MAGDIR9A",36,0)
 N GROUP ;--- array to pass group data to ^MAGGTIA
"RTN","MAGDIR9A",37,0)
 N GROUPDFN ; DFN value from image group entry for double checking
"RTN","MAGDIR9A",38,0)
 N P ;-------- scratch variable (pointer to ACQUISITION DEVICE file)
"RTN","MAGDIR9A",39,0)
 N RACNE ;--- external "3rd level" subscript in ^RADPT
"RTN","MAGDIR9A",40,0)
 N RACNI ;--- internal "3rd level" subscript in ^RADPT
"RTN","MAGDIR9A",41,0)
 N RADFN ;--- radiology package's DFN
"RTN","MAGDIR9A",42,0)
 N RADTE ;--- external "2nd level" subscript in ^RADPT
"RTN","MAGDIR9A",43,0)
 N RADTI ;--- internal "2nd level" subscript in ^RADPT
"RTN","MAGDIR9A",44,0)
 N RARPT ;--- 1st level node in ^RARPT for report (ie, the ien)
"RTN","MAGDIR9A",45,0)
 N RARPT3 ;-- 3rd level node for 2005 multiple under ^RARPT's report
"RTN","MAGDIR9A",46,0)
 N RARPTDFN ; DFN value from ^RARPT for double checking
"RTN","MAGDIR9A",47,0)
 N SOPCLASP ; pointer to SOP Class file (#2006.532)
"RTN","MAGDIR9A",48,0)
 N HIT,ISPECIDX,X,Y ; scratch variables
"RTN","MAGDIR9A",49,0)
 ;
"RTN","MAGDIR9A",50,0)
 S ERRCODE=""
"RTN","MAGDIR9A",51,0)
 ;
"RTN","MAGDIR9A",52,0)
 S (RADFN,DA(2))=DFN ; patient DFN variables
"RTN","MAGDIR9A",53,0)
 S RADTI=RADATA("RADPT2") ; case subscript
"RTN","MAGDIR9A",54,0)
 I RADTI="" D  Q ERRCODE
"RTN","MAGDIR9A",55,0)
 . K MSG
"RTN","MAGDIR9A",56,0)
 . S MSG(1)="No radiology case number specified for patient "_DFN
"RTN","MAGDIR9A",57,0)
 . D ERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR9A",58,0)
 . S ERRCODE=-301
"RTN","MAGDIR9A",59,0)
 . Q
"RTN","MAGDIR9A",60,0)
 ;
"RTN","MAGDIR9A",61,0)
 S RADTE=$TR(RADATA("RADPT2"),"0123456789","9876543210")
"RTN","MAGDIR9A",62,0)
 S RACNI=RADATA("RADPT3")
"RTN","MAGDIR9A",63,0)
 S RACNE=$S(CASENUMB["-":$P(CASENUMB,"-",2),1:CASENUMB) ; short case #
"RTN","MAGDIR9A",64,0)
 ;
"RTN","MAGDIR9A",65,0)
 ; check for the existence of the entry in ^RADPT (redundant)
"RTN","MAGDIR9A",66,0)
 I '$D(^RADPT(RADFN,"DT",RADTI,0)) D  Q ERRCODE ; can't process further
"RTN","MAGDIR9A",67,0)
 . K MSG
"RTN","MAGDIR9A",68,0)
 . S MSG(1)="Radiology case "_RADTI_" is not in ^RADPT("_RADFN_")"
"RTN","MAGDIR9A",69,0)
 . D ERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR9A",70,0)
 . S ERRCODE=-302
"RTN","MAGDIR9A",71,0)
 . Q
"RTN","MAGDIR9A",72,0)
 ;
"RTN","MAGDIR9A",73,0)
 ; check for the existence of the report pointer
"RTN","MAGDIR9A",74,0)
 S RARPT=$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),"^",17)
"RTN","MAGDIR9A",75,0)
 ; if the report does not yet exist, create it
"RTN","MAGDIR9A",76,0)
 D:RARPT=""
"RTN","MAGDIR9A",77,0)
 . N RACN
"RTN","MAGDIR9A",78,0)
 . S RACN=RACNE D CREATE^RARIC ; create the report
"RTN","MAGDIR9A",79,0)
 . Q
"RTN","MAGDIR9A",80,0)
 ;
"RTN","MAGDIR9A",81,0)
 ; If RARPT is no longer defined at this point, this means
"RTN","MAGDIR9A",82,0)
 ; that we're dealing with an old study, and the report has
"RTN","MAGDIR9A",83,0)
 ; been archived and purged.
"RTN","MAGDIR9A",84,0)
 ;
"RTN","MAGDIR9A",85,0)
 I '$G(RARPT) D  Q ERRCODE
"RTN","MAGDIR9A",86,0)
 . K MSG
"RTN","MAGDIR9A",87,0)
 . S MSG(1)="IMAGE GROUP CREATION ERROR:"
"RTN","MAGDIR9A",88,0)
 . S MSG(2)="Radiology Report has been archived and purged."
"RTN","MAGDIR9A",89,0)
 . S MSG(3)="Patient "_$G(RADFN)_", Date "_$G(RADTI)_", Case "_$G(RACNI)
"RTN","MAGDIR9A",90,0)
 . D ERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR9A",91,0)
 . S ERRCODE=-303
"RTN","MAGDIR9A",92,0)
 . Q
"RTN","MAGDIR9A",93,0)
 ;
"RTN","MAGDIR9A",94,0)
 ; double check the DFN value from ^RARPT to make sure its right
"RTN","MAGDIR9A",95,0)
 S RARPTDFN=$P($G(^RARPT(RARPT,0)),"^",2)
"RTN","MAGDIR9A",96,0)
 I RARPTDFN'=DFN D  Q ERRCODE ; fatal error
"RTN","MAGDIR9A",97,0)
 . D RADMISS^MAGDIRVE($T(+0),DFN,RARPT,RARPTDFN)
"RTN","MAGDIR9A",98,0)
 . S ERRCODE=-304
"RTN","MAGDIR9A",99,0)
 . Q
"RTN","MAGDIR9A",100,0)
 ;
"RTN","MAGDIR9A",101,0)
 ; initialize FILEDATA for GROUP and IMAGE
"RTN","MAGDIR9A",102,0)
 ; get the acquisition device pointer (file 2005, field 107)
"RTN","MAGDIR9A",103,0)
 S ACQDEVP=$$ACQDEV^MAGDFCNV(MFGR,MODEL,INSTLOC)
"RTN","MAGDIR9A",104,0)
 S FILEDATA("ACQUISITION DEVICE")=ACQDEVP
"RTN","MAGDIR9A",105,0)
 ; get the SOP Class pointer (file 2005, field 251)
"RTN","MAGDIR9A",106,0)
 S SOPCLASP=$O(^MAG(2006.532,"B",SOPCLASS,""))
"RTN","MAGDIR9A",107,0)
 S FILEDATA("SOP CLASS POINTER")=SOPCLASP
"RTN","MAGDIR9A",108,0)
 ;
"RTN","MAGDIR9A",109,0)
 S FILEDATA("MODALITY")=MODALITY
"RTN","MAGDIR9A",110,0)
 S FILEDATA("PARENT FILE")=74
"RTN","MAGDIR9A",111,0)
 S FILEDATA("PARENT IEN")=RARPT
"RTN","MAGDIR9A",112,0)
 S FILEDATA("RAD REPORT")=RARPT
"RTN","MAGDIR9A",113,0)
 S FILEDATA("RAD PROC PTR")=RADATA("PROCIEN")
"RTN","MAGDIR9A",114,0)
 S FILEDATA("PACKAGE")="RAD"
"RTN","MAGDIR9A",115,0)
 S X=$S(MODALITY="NM":"NUCLEAR MEDICINE",1:"RADIOLOGY")
"RTN","MAGDIR9A",116,0)
 S ISPECIDX=$O(^MAG(2005.84,"B",X,""))
"RTN","MAGDIR9A",117,0)
 S X=$$FIELD43^MAGXMA(MODALITY,ISPECIDX,.Y)
"RTN","MAGDIR9A",118,0)
 S FILEDATA("PROC/EVENT")=$S(X=0:Y,1:"")
"RTN","MAGDIR9A",119,0)
 S FILEDATA("SPEC/SUBSPEC")=ISPECIDX
"RTN","MAGDIR9A",120,0)
 ;
"RTN","MAGDIR9A",121,0)
 ; find the corresponding image group node under the report
"RTN","MAGDIR9A",122,0)
 S (HIT,RARPT3)=0
"RTN","MAGDIR9A",123,0)
 F  S RARPT3=$O(^RARPT(RARPT,2005,RARPT3)) Q:'RARPT3  D  Q:HIT  Q:ERRCODE
"RTN","MAGDIR9A",124,0)
 . S MAGGP=+$G(^RARPT(RARPT,2005,RARPT3,0)) ; get imaging group pointer
"RTN","MAGDIR9A",125,0)
 . S GROUPDFN=$P($G(^MAG(2005,MAGGP,0)),"^",7) ; check image DFN value
"RTN","MAGDIR9A",126,0)
 . I GROUPDFN'=DFN D  ; fatal error
"RTN","MAGDIR9A",127,0)
 . . D MISMATCH^MAGDIRVE($T(+0),DFN,MAGGP)
"RTN","MAGDIR9A",128,0)
 . . S ERRCODE=-305
"RTN","MAGDIR9A",129,0)
 . . Q
"RTN","MAGDIR9A",130,0)
 . E  I $P($G(^MAG(2005,MAGGP,0)),"^",6)=11 D
"RTN","MAGDIR9A",131,0)
 . . ; check to see that this group is for the same SOP Class
"RTN","MAGDIR9A",132,0)
 . . S P=$P($G(^MAG(2005,MAGGP,"SOP")),"^",1)
"RTN","MAGDIR9A",133,0)
 . . S HIT=$$EQUIVGRP^MAGDFCNV(P,SOPCLASP) ; equivalent groups?
"RTN","MAGDIR9A",134,0)
 . . Q
"RTN","MAGDIR9A",135,0)
 . Q
"RTN","MAGDIR9A",136,0)
 ;
"RTN","MAGDIR9A",137,0)
 I ERRCODE Q ERRCODE ; fatal image DFN problem
"RTN","MAGDIR9A",138,0)
 ;
"RTN","MAGDIR9A",139,0)
 I 'HIT D  Q:ERRCODE ERRCODE ; the 2005 node does not yet exist
"RTN","MAGDIR9A",140,0)
 . ; create the radiology imaging group
"RTN","MAGDIR9A",141,0)
 . N PROCEDUR,RADRPT,RADPTR
"RTN","MAGDIR9A",142,0)
 . S PROCEDUR="RAD "_FILEDATA("MODALITY")
"RTN","MAGDIR9A",143,0)
 . S RADRPT=FILEDATA("RAD REPORT")
"RTN","MAGDIR9A",144,0)
 . S RADPTR=FILEDATA("RAD PROC PTR")
"RTN","MAGDIR9A",145,0)
 . D NEWGROUP(PROCEDUR,RADRPT,RADPTR) Q:ERRCODE
"RTN","MAGDIR9A",146,0)
 . ;
"RTN","MAGDIR9A",147,0)
 . ; store the cross-reference for the report
"RTN","MAGDIR9A",148,0)
 . D PTR^RARIC
"RTN","MAGDIR9A",149,0)
 . Q
"RTN","MAGDIR9A",150,0)
 ;
"RTN","MAGDIR9A",151,0)
 I 'MAGGP D  Q ERRCODE ; fatal error
"RTN","MAGDIR9A",152,0)
 . K MSG
"RTN","MAGDIR9A",153,0)
 . S MSG(1)="IMAGE GROUP LOOKUP ERROR:"
"RTN","MAGDIR9A",154,0)
 . S MSG(2)="Looking for 2005 cross reference in ^RARPT("_RARPT_")"
"RTN","MAGDIR9A",155,0)
 . D ERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR9A",156,0)
 . S ERRCODE=-308
"RTN","MAGDIR9A",157,0)
 . Q
"RTN","MAGDIR9A",158,0)
 Q 0
"RTN","MAGDIR9A",159,0)
 ;
"RTN","MAGDIR9A",160,0)
NEWGROUP(PROCEDUR,RADRPT,RADPTR) ; create an imaging group (called by ^MAGDIR9E)
"RTN","MAGDIR9A",161,0)
 N I
"RTN","MAGDIR9A",162,0)
 K GROUP S I=0
"RTN","MAGDIR9A",163,0)
 S I=I+1,GROUP(I)=".01^"_PNAMEVAH_"  "_DCMPID_"  "_PROCDESC
"RTN","MAGDIR9A",164,0)
 S I=I+1,GROUP(I)="3^11" ; Object Type -- XRAY Group
"RTN","MAGDIR9A",165,0)
 S I=I+1,GROUP(I)="5^"_DFN
"RTN","MAGDIR9A",166,0)
 S I=I+1,GROUP(I)="6^"_PROCEDUR
"RTN","MAGDIR9A",167,0)
 S I=I+1,GROUP(I)="2005.04^0"
"RTN","MAGDIR9A",168,0)
 S I=I+1,GROUP(I)="10^"_PROCDESC
"RTN","MAGDIR9A",169,0)
 S I=I+1,GROUP(I)="15^"_DATETIME
"RTN","MAGDIR9A",170,0)
 S I=I+1,GROUP(I)="16^"_FILEDATA("PARENT FILE")
"RTN","MAGDIR9A",171,0)
 S I=I+1,GROUP(I)="17^"_FILEDATA("PARENT IEN")
"RTN","MAGDIR9A",172,0)
 S I=I+1,GROUP(I)="60^"_STUDYUID
"RTN","MAGDIR9A",173,0)
 ;
"RTN","MAGDIR9A",174,0)
 ; the following two fields are only for radiology
"RTN","MAGDIR9A",175,0)
 I $D(RADRPT) S I=I+1,GROUP(I)="61^"_RADRPT
"RTN","MAGDIR9A",176,0)
 I $D(RADPTR) S I=I+1,GROUP(I)="62^"_RADPTR
"RTN","MAGDIR9A",177,0)
 ;
"RTN","MAGDIR9A",178,0)
 S I=I+1,GROUP(I)=".05^"_INSTLOC
"RTN","MAGDIR9A",179,0)
 S I=I+1,GROUP(I)="40^"_FILEDATA("PACKAGE")
"RTN","MAGDIR9A",180,0)
 S I=I+1,GROUP(I)="41^"_$O(^MAG(2005.82,"B","CLIN",""))
"RTN","MAGDIR9A",181,0)
 S I=I+1,GROUP(I)="42^"_FILEDATA("TYPE")
"RTN","MAGDIR9A",182,0)
 S I=I+1,GROUP(I)="43^"_FILEDATA("PROC/EVENT")
"RTN","MAGDIR9A",183,0)
 S I=I+1,GROUP(I)="44^"_FILEDATA("SPEC/SUBSPEC")
"RTN","MAGDIR9A",184,0)
 S I=I+1,GROUP(I)="107^"_FILEDATA("ACQUISITION DEVICE")
"RTN","MAGDIR9A",185,0)
 S I=I+1,GROUP(I)="110^"_STAMP
"RTN","MAGDIR9A",186,0)
 S I=I+1,GROUP(I)="251^"_FILEDATA("SOP CLASS POINTER")
"RTN","MAGDIR9A",187,0)
 D ADD^MAGGTIA(.RETURN,.GROUP)
"RTN","MAGDIR9A",188,0)
 S MAGGP=+RETURN
"RTN","MAGDIR9A",189,0)
 I 'MAGGP D  Q  ; fatal error
"RTN","MAGDIR9A",190,0)
 . K MSG
"RTN","MAGDIR9A",191,0)
 . S MSG(1)="IMAGE GROUP CREATION ERROR:"
"RTN","MAGDIR9A",192,0)
 . S MSG(2)=$P(RETURN,"^",2,999)
"RTN","MAGDIR9A",193,0)
 . D BADERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR9A",194,0)
 . S ERRCODE=-306
"RTN","MAGDIR9A",195,0)
 . Q
"RTN","MAGDIR9A",196,0)
 ;
"RTN","MAGDIR9A",197,0)
 I MAGGP<LASTIMG D  Q  ; fatal last image pointer error
"RTN","MAGDIR9A",198,0)
 . D GROUPPTR^MAGDIRVE($T(+0),MAGGP,LASTIMG)
"RTN","MAGDIR9A",199,0)
 . S ERRCODE=-307
"RTN","MAGDIR9A",200,0)
 . Q
"RTN","MAGDIR9A",201,0)
 Q
"RTN","MAGDIR9A",202,0)
 ;
"RTN","MAGDIR9B")
0^19^B19108558
"RTN","MAGDIR9B",1,0)
MAGDIR9B ;WOIFO/PMK - Read a DICOM image file ; 01/19/2007 06:20
"RTN","MAGDIR9B",2,0)
 ;;3.0;IMAGING;**11,51,50,54**;03-July-2009;;Build 1424
"RTN","MAGDIR9B",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDIR9B",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR9B",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDIR9B",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDIR9B",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDIR9B",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDIR9B",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDIR9B",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDIR9B",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDIR9B",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDIR9B",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDIR9B",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDIR9B",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDIR9B",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR9B",17,0)
 ;;
"RTN","MAGDIR9B",18,0)
 Q
"RTN","MAGDIR9B",19,0)
 ; Create an image entry in ^MAG(2005)
"RTN","MAGDIR9B",20,0)
 ;
"RTN","MAGDIR9B",21,0)
IMAGE() ; entry point from ^MAGDIR81 to create an image entry in ^MAG(2005)
"RTN","MAGDIR9B",22,0)
 N I ;-------- scratch counter
"RTN","MAGDIR9B",23,0)
 N IMAGE ;---- image array for ^MAGGTIA
"RTN","MAGDIR9B",24,0)
 N IMAGECNT ;- counter of image in the group
"RTN","MAGDIR9B",25,0)
 N IMAGEPTR ;- value returned by ^MAGGTIA
"RTN","MAGDIR9B",26,0)
 ;
"RTN","MAGDIR9B",27,0)
 ; check that the group has right object type and is for the same person
"RTN","MAGDIR9B",28,0)
 I $P($G(^MAG(2005,MAGGP,0)),"^",6)'=11 D  Q -101 ; fatal error
"RTN","MAGDIR9B",29,0)
 . D OBJECT^MAGDIRVE($T(+0),MAGGP)
"RTN","MAGDIR9B",30,0)
 . Q
"RTN","MAGDIR9B",31,0)
 ;
"RTN","MAGDIR9B",32,0)
 ; check that the group patient DFN matches the image patient DFN
"RTN","MAGDIR9B",33,0)
 I $P(^MAG(2005,MAGGP,0),"^",7)'=DFN D  Q -102 ; fatal error
"RTN","MAGDIR9B",34,0)
 . D MISMATCH^MAGDIRVE($T(+0),DFN,MAGGP)
"RTN","MAGDIR9B",35,0)
 . Q
"RTN","MAGDIR9B",36,0)
 ;
"RTN","MAGDIR9B",37,0)
 ; get the next file number and create the entry for this image
"RTN","MAGDIR9B",38,0)
 ;
"RTN","MAGDIR9B",39,0)
 S IMAGECNT=$P($G(^MAG(2005,MAGGP,1,0)),"^",4)+1 ; next image # in group
"RTN","MAGDIR9B",40,0)
 ;
"RTN","MAGDIR9B",41,0)
 K IMAGE S I=0
"RTN","MAGDIR9B",42,0)
 S I=I+1,IMAGE(I)=".01^"_PNAMEVAH_"  "_DCMPID_"  "_PROCDESC ; used in ^MAGDIR8
"RTN","MAGDIR9B",43,0)
 S I=I+1,IMAGE(I)="5^"_DFN
"RTN","MAGDIR9B",44,0)
 I $D(FILEDATA("SHORT DESCRIPTION")) D  ; set in ^MAGDIR7F
"RTN","MAGDIR9B",45,0)
 . S I=I+1,IMAGE(I)="10^"_FILEDATA("SHORT DESCRIPTION")
"RTN","MAGDIR9B",46,0)
 . Q
"RTN","MAGDIR9B",47,0)
 E  S I=I+1,IMAGE(I)="10^"_PROCDESC_" (#"_IMAGECNT_")" ; used in ^MAGDIR81
"RTN","MAGDIR9B",48,0)
 S I=I+1,IMAGE(I)="14^"_MAGGP
"RTN","MAGDIR9B",49,0)
 S I=I+1,IMAGE(I)="15^"_DATETIME
"RTN","MAGDIR9B",50,0)
 S I=I+1,IMAGE(I)="60^"_IMAGEUID
"RTN","MAGDIR9B",51,0)
 S I=I+1,IMAGE(I)=FILEDATA("EXTENSION") ; specify the image file extension
"RTN","MAGDIR9B",52,0)
 S:$D(FILEDATA("ABSTRACT")) I=I+1,IMAGE(I)=FILEDATA("ABSTRACT")
"RTN","MAGDIR9B",53,0)
 S I=I+1,IMAGE(I)="WRITE^PACS" ; select the PACS Image write location
"RTN","MAGDIR9B",54,0)
 S I=I+1,IMAGE(I)="3^"_FILEDATA("OBJECT TYPE")
"RTN","MAGDIR9B",55,0)
 S I=I+1,IMAGE(I)="6^"_FILEDATA("MODALITY")
"RTN","MAGDIR9B",56,0)
 S I=I+1,IMAGE(I)="16^"_FILEDATA("PARENT FILE")
"RTN","MAGDIR9B",57,0)
 S I=I+1,IMAGE(I)="17^"_FILEDATA("PARENT IEN")
"RTN","MAGDIR9B",58,0)
 S:$D(FILEDATA("PARENT FILE PTR")) I=I+1,IMAGE(I)="18^"_FILEDATA("PARENT FILE PTR")
"RTN","MAGDIR9B",59,0)
 S:$D(FILEDATA("RAD REPORT")) I=I+1,IMAGE(I)="61^"_FILEDATA("RAD REPORT")
"RTN","MAGDIR9B",60,0)
 S:$D(FILEDATA("RAD PROC PTR")) I=I+1,IMAGE(I)="62^"_FILEDATA("RAD PROC PTR")
"RTN","MAGDIR9B",61,0)
 S:MODPARMS["/" I=I+1,IMAGE(I)="BIG^1" ; big file will be output
"RTN","MAGDIR9B",62,0)
 S I=I+1,IMAGE(I)="DICOMSN^"_SERINUMB ; series number
"RTN","MAGDIR9B",63,0)
 S I=I+1,IMAGE(I)="DICOMIN^"_IMAGNUMB ; image number
"RTN","MAGDIR9B",64,0)
 S I=I+1,IMAGE(I)=".05^"_INSTLOC
"RTN","MAGDIR9B",65,0)
 S I=I+1,IMAGE(I)="40^"_FILEDATA("PACKAGE")
"RTN","MAGDIR9B",66,0)
 S I=I+1,IMAGE(I)="41^"_$O(^MAG(2005.82,"B","CLIN",""))
"RTN","MAGDIR9B",67,0)
 S I=I+1,IMAGE(I)="42^"_FILEDATA("TYPE")
"RTN","MAGDIR9B",68,0)
 S I=I+1,IMAGE(I)="43^"_FILEDATA("PROC/EVENT")
"RTN","MAGDIR9B",69,0)
 S I=I+1,IMAGE(I)="44^"_FILEDATA("SPEC/SUBSPEC")
"RTN","MAGDIR9B",70,0)
 S I=I+1,IMAGE(I)="107^"_FILEDATA("ACQUISITION DEVICE")
"RTN","MAGDIR9B",71,0)
 S I=I+1,IMAGE(I)="110^"_STAMP
"RTN","MAGDIR9B",72,0)
 S I=I+1,IMAGE(I)="251^"_FILEDATA("SOP CLASS POINTER")
"RTN","MAGDIR9B",73,0)
 S I=I+1,IMAGE(I)="253^"_SERIEUID
"RTN","MAGDIR9B",74,0)
 D ADD^MAGGTIA(.RETURN,.IMAGE)
"RTN","MAGDIR9B",75,0)
 ;
"RTN","MAGDIR9B",76,0)
 S IMAGEPTR=+RETURN
"RTN","MAGDIR9B",77,0)
 I 'IMAGEPTR D  Q -103 ; fatal error
"RTN","MAGDIR9B",78,0)
 . K MSG
"RTN","MAGDIR9B",79,0)
 . S MSG(1)="IMAGE FILE CREATION ERROR:"
"RTN","MAGDIR9B",80,0)
 . S MSG(2)=$P(RETURN,"^",2,999)
"RTN","MAGDIR9B",81,0)
 . D BADERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR9B",82,0)
 . Q
"RTN","MAGDIR9B",83,0)
 ;
"RTN","MAGDIR9B",84,0)
 I IMAGEPTR<LASTIMG D  Q -104 ; fatal last image pointer error
"RTN","MAGDIR9B",85,0)
 . D IMAGEPTR^MAGDIRVE($T(+0),IMAGEPTR,LASTIMG)
"RTN","MAGDIR9B",86,0)
 . Q
"RTN","MAGDIR9B",87,0)
 ;
"RTN","MAGDIR9B",88,0)
 S $P(RETURN,"^",4)=$$CHKPATH() ; hierarchal file patch check
"RTN","MAGDIR9B",89,0)
 ;
"RTN","MAGDIR9B",90,0)
 Q 0
"RTN","MAGDIR9B",91,0)
 ;
"RTN","MAGDIR9B",92,0)
CHKPATH() ; determine if the path is hierarchal (true) or not (false)
"RTN","MAGDIR9B",93,0)
 N D0,PATH
"RTN","MAGDIR9B",94,0)
 S D0="",PATH=$P(RETURN,"^",2)
"RTN","MAGDIR9B",95,0)
 I $D(^MAG(2005.2,"AC")) S D0=$O(^MAG(2005.2,"AC",PATH,""))
"RTN","MAGDIR9B",96,0)
 E  D
"RTN","MAGDIR9B",97,0)
 . N PLACE
"RTN","MAGDIR9B",98,0)
 . S PLACE=""
"RTN","MAGDIR9B",99,0)
 . F  S PLACE=$O(^MAG(2005.2,"E",PLACE)) Q:PLACE=""  D  Q:D0
"RTN","MAGDIR9B",100,0)
 . . S D0=$O(^MAG(2005.2,"E",PLACE,PATH,""))
"RTN","MAGDIR9B",101,0)
 . . Q
"RTN","MAGDIR9B",102,0)
 . Q
"RTN","MAGDIR9B",103,0)
 Q 'D0 ; network location file
"RTN","MAGDIR9B",104,0)
 ;
"RTN","MAGDIR9E")
0^20^B68376397
"RTN","MAGDIR9E",1,0)
MAGDIR9E ;WOIFO/PMK - Read a DICOM image file ; 10/30/2008 09:20
"RTN","MAGDIR9E",2,0)
 ;;3.0;IMAGING;**11,51,46,54**;03-July-2009;;Build 1424
"RTN","MAGDIR9E",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDIR9E",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR9E",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDIR9E",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDIR9E",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDIR9E",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDIR9E",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDIR9E",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDIR9E",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDIR9E",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDIR9E",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDIR9E",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDIR9E",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDIR9E",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR9E",17,0)
 ;;
"RTN","MAGDIR9E",18,0)
 ; M2MB server
"RTN","MAGDIR9E",19,0)
 ;
"RTN","MAGDIR9E",20,0)
 ; This routine creates the group entry in ^MAG(2005) and links it
"RTN","MAGDIR9E",21,0)
 ; to the consult/procedure request in GMRC.
"RTN","MAGDIR9E",22,0)
 ;
"RTN","MAGDIR9E",23,0)
 ;     XXXX                                         XXX       X
"RTN","MAGDIR9E",24,0)
 ;    XX  XX                                         XX      XX
"RTN","MAGDIR9E",25,0)
 ;   XX         XXXX    XX XXX  XXXXXXX  XX  XXX     XX     XXXXX
"RTN","MAGDIR9E",26,0)
 ;   XX        XX  XX   XXX XX  XX       XX  XX      XX      XX
"RTN","MAGDIR9E",27,0)
 ;   XX    X   XX  XX   XX  XX  XXXXXXX  XX  XX      XX      XX
"RTN","MAGDIR9E",28,0)
 ;    XX  XX   XX  XX   XX  XX       XX  XX  XX      XX      XX XX
"RTN","MAGDIR9E",29,0)
 ;     XXXX     XXXX    XX  XX  XXXXXXX   XXX XX    XXXX      XXX
"RTN","MAGDIR9E",30,0)
 ;
"RTN","MAGDIR9E",31,0)
GROUP() ; entry point from ^MAGDIR8 for consult/procedure groups
"RTN","MAGDIR9E",32,0)
 N ACQDEVP ;-- pointer to acquisition device file (#2006.04)
"RTN","MAGDIR9E",33,0)
 N D0 ;------- fileman variable
"RTN","MAGDIR9E",34,0)
 N ERRCODE ;-- error trap code
"RTN","MAGDIR9E",35,0)
 N GROUP ;---- array to pass group data to ^MAGGTIA
"RTN","MAGDIR9E",36,0)
 N MAGGPP ;--- pointer to group in DICOM GMRC TEMP LIST ^MAG(20006.5839)
"RTN","MAGDIR9E",37,0)
 N P ;-------- scratch variable (pointer to ACQUISITION DEVICE file)
"RTN","MAGDIR9E",38,0)
 N RESULT ;--- scratch variable
"RTN","MAGDIR9E",39,0)
 N SERVICE ;-- service performing the consult/procedure - ^GMR(123.5)
"RTN","MAGDIR9E",40,0)
 N SOPCLASP ;- pointer to SOP Class file (#2006.532)
"RTN","MAGDIR9E",41,0)
 N TIUIEN ;--- TIU file 8925 IEN value
"RTN","MAGDIR9E",42,0)
 ;
"RTN","MAGDIR9E",43,0)
 S ERRCODE=""
"RTN","MAGDIR9E",44,0)
 ;
"RTN","MAGDIR9E",45,0)
 I STUDYDAT,STUDYTIM D  ; get study date/time from image header
"RTN","MAGDIR9E",46,0)
 . S DATETIME=(STUDYDAT_"."_STUDYTIM)-17000000 ; FileMan date.time fmt
"RTN","MAGDIR9E",47,0)
 . Q
"RTN","MAGDIR9E",48,0)
 E  S DATETIME=$$NOW^XLFDT() ; use current date/time
"RTN","MAGDIR9E",49,0)
 ;
"RTN","MAGDIR9E",50,0)
 ; initialize FILEDATA for GROUP and IMAGE
"RTN","MAGDIR9E",51,0)
 ; get the acquisition device pointer (file 2005, field 107)
"RTN","MAGDIR9E",52,0)
 S ACQDEVP=$$ACQDEV^MAGDFCNV(MFGR,MODEL,INSTLOC)
"RTN","MAGDIR9E",53,0)
 S FILEDATA("ACQUISITION DEVICE")=ACQDEVP
"RTN","MAGDIR9E",54,0)
 ; get the SOP Class pointer (file 2005, field 251)
"RTN","MAGDIR9E",55,0)
 S SOPCLASP=$O(^MAG(2006.532,"B",SOPCLASS,""))
"RTN","MAGDIR9E",56,0)
 S FILEDATA("SOP CLASS POINTER")=SOPCLASP
"RTN","MAGDIR9E",57,0)
 ;
"RTN","MAGDIR9E",58,0)
 S MAGGP="" ; initialize pointer to the image group
"RTN","MAGDIR9E",59,0)
 ;
"RTN","MAGDIR9E",60,0)
 ; check if there already is a TIU note attached to this request
"RTN","MAGDIR9E",61,0)
 ;
"RTN","MAGDIR9E",62,0)
 S TIUIEN=$$TIULAST^MAGDGMRC(GMRCIEN)
"RTN","MAGDIR9E",63,0)
 I TIUIEN D  Q:ERRCODE ERRCODE ; there is TIU note already
"RTN","MAGDIR9E",64,0)
 . ; double check TIU note DFN to make sure that it matches
"RTN","MAGDIR9E",65,0)
 . N HIT ; scratch variable used in finding corresponding image group
"RTN","MAGDIR9E",66,0)
 . N TIUDFN ; DFN value from ^TIU for double checking
"RTN","MAGDIR9E",67,0)
 . N TIUXDIEN ; TIU External Data File IEN
"RTN","MAGDIR9E",68,0)
 . S TIUDFN=$P($G(^TIU(8925,TIUIEN,0)),"^",2)
"RTN","MAGDIR9E",69,0)
 . I TIUDFN'=DFN D  Q  ; fatal error
"RTN","MAGDIR9E",70,0)
 . . D TIUMISS^MAGDIRVE($T(+0),DFN,TIUIEN,TIUDFN)
"RTN","MAGDIR9E",71,0)
 . . S ERRCODE=-501
"RTN","MAGDIR9E",72,0)
 . . Q
"RTN","MAGDIR9E",73,0)
 . ;
"RTN","MAGDIR9E",74,0)
 . S FILEDATA("PARENT FILE")=8925 ; TIU file
"RTN","MAGDIR9E",75,0)
 . S FILEDATA("PARENT IEN")=TIUIEN
"RTN","MAGDIR9E",76,0)
 . ;
"RTN","MAGDIR9E",77,0)
 . ; is there an entry in TIU External Data File for this note
"RTN","MAGDIR9E",78,0)
 . S (HIT,TIUXDIEN)=0
"RTN","MAGDIR9E",79,0)
 . F  S TIUXDIEN=$O(^TIU(8925.91,"B",TIUIEN,TIUXDIEN)) Q:'TIUXDIEN  D  Q:HIT  Q:ERRCODE
"RTN","MAGDIR9E",80,0)
 . . N MAG2 ;----- data value for getting parent file attributes
"RTN","MAGDIR9E",81,0)
 . . N GROUPDFN ;- DFN value from image group entry for double checking
"RTN","MAGDIR9E",82,0)
 . . ; there is a TIU External Data File
"RTN","MAGDIR9E",83,0)
 . . ; does the TIU External Data File entry point to an image group?
"RTN","MAGDIR9E",84,0)
 . . S MAGGP=$$GET1^DIQ(8925.91,TIUXDIEN,.02,"I") Q:'MAGGP
"RTN","MAGDIR9E",85,0)
 . . ; double check image group entry DFN
"RTN","MAGDIR9E",86,0)
 . . S GROUPDFN=$P($G(^MAG(2005,MAGGP,0)),"^",7)
"RTN","MAGDIR9E",87,0)
 . . I GROUPDFN'=DFN D  Q  ; fatal error
"RTN","MAGDIR9E",88,0)
 . . . D MISMATCH^MAGDIRVE($T(+0),DFN,MAGGP)
"RTN","MAGDIR9E",89,0)
 . . . S ERRCODE=-502
"RTN","MAGDIR9E",90,0)
 . . . Q
"RTN","MAGDIR9E",91,0)
 . . I $P($G(^MAG(2005,MAGGP,0)),"^",6)'=11 D  Q  ; 11=XRAY GROUP
"RTN","MAGDIR9E",92,0)
 . . . S MAGGP="" ; wrong object type - skip this image group
"RTN","MAGDIR9E",93,0)
 . . . Q
"RTN","MAGDIR9E",94,0)
 . . S P=$P($G(^MAG(2005,MAGGP,"SOP")),"^",1)
"RTN","MAGDIR9E",95,0)
 . . ; skip this image group if wrong SOP Class
"RTN","MAGDIR9E",96,0)
 . . I '$$EQUIVGRP^MAGDFCNV(P,SOPCLASP) S MAGGP="" Q
"RTN","MAGDIR9E",97,0)
 . . ; add the new image to this existing image group
"RTN","MAGDIR9E",98,0)
 . . S HIT=1,MAG2=$G(^MAG(2005,MAGGP,2))
"RTN","MAGDIR9E",99,0)
 . . S FILEDATA("PARENT FILE")=$P(MAG2,"^",6)
"RTN","MAGDIR9E",100,0)
 . . S FILEDATA("PARENT IEN")=$P(MAG2,"^",7)
"RTN","MAGDIR9E",101,0)
 . . S FILEDATA("PARENT FILE PTR")=$P(MAG2,"^",8)
"RTN","MAGDIR9E",102,0)
 . . I FILEDATA("PARENT IEN")'=TIUIEN D  ; fatal error
"RTN","MAGDIR9E",103,0)
 . . . D TIUMISS2^MAGDIRVE($T(+0),TIUIEN,FILEDATA("PARENT IEN"),TIUXDIEN,MAGGP)
"RTN","MAGDIR9E",104,0)
 . . . S ERRCODE=-503
"RTN","MAGDIR9E",105,0)
 . . . Q
"RTN","MAGDIR9E",106,0)
 . . Q
"RTN","MAGDIR9E",107,0)
 . Q
"RTN","MAGDIR9E",108,0)
 ;
"RTN","MAGDIR9E",109,0)
 ; need a temporary association for the consult/procedure request
"RTN","MAGDIR9E",110,0)
 ;
"RTN","MAGDIR9E",111,0)
 E  D  Q:ERRCODE ERRCODE ; check if there is a temporary association
"RTN","MAGDIR9E",112,0)
 . ;
"RTN","MAGDIR9E",113,0)
 . ; Note: this algorithm creates multiple groups for a study,
"RTN","MAGDIR9E",114,0)
 . ;       for instance a GI fluoroscopy + color images
"RTN","MAGDIR9E",115,0)
 . ;
"RTN","MAGDIR9E",116,0)
 . S MAGGPP=""
"RTN","MAGDIR9E",117,0)
 . F  S MAGGPP=$O(^MAG(2006.5839,"C",123,GMRCIEN,MAGGPP)) Q:'MAGGPP  D  Q:ERRCODE
"RTN","MAGDIR9E",118,0)
 . . N GROUPDFN ; DFN value from image group entry for double checking
"RTN","MAGDIR9E",119,0)
 . . S MAGGP=$P(^MAG(2006.5839,MAGGPP,0),"^",3)
"RTN","MAGDIR9E",120,0)
 . . ; double check image group entry DFN in existing 2005 group node
"RTN","MAGDIR9E",121,0)
 . . S GROUPDFN=$P($G(^MAG(2005,MAGGP,0)),"^",7)
"RTN","MAGDIR9E",122,0)
 . . I GROUPDFN'=DFN D  ; fatal error
"RTN","MAGDIR9E",123,0)
 . . . D MISMATCH^MAGDIRVE($T(+0),DFN,MAGGP)
"RTN","MAGDIR9E",124,0)
 . . . S MAGGP="" ; bad group
"RTN","MAGDIR9E",125,0)
 . . . S ERRCODE=-504
"RTN","MAGDIR9E",126,0)
 . . . Q
"RTN","MAGDIR9E",127,0)
 . . E  S P=$P($G(^MAG(2005,MAGGP,100)),"^",4) I P,P'=ACQDEVP D  ; wrong device
"RTN","MAGDIR9E",128,0)
 . . . S MAGGP="" ; wrong acquisition device - skip this image group
"RTN","MAGDIR9E",129,0)
 . . . Q
"RTN","MAGDIR9E",130,0)
 . . E  D  ; add the new image to this existing image group
"RTN","MAGDIR9E",131,0)
 . . . N MAG2 ; data value for getting parent file attributes
"RTN","MAGDIR9E",132,0)
 . . . S MAG2=$G(^MAG(2005,MAGGP,2))
"RTN","MAGDIR9E",133,0)
 . . . S FILEDATA("PARENT FILE")=$P(MAG2,"^",6)
"RTN","MAGDIR9E",134,0)
 . . . S FILEDATA("PARENT IEN")=$P(MAG2,"^",7)
"RTN","MAGDIR9E",135,0)
 . . . S FILEDATA("PARENT FILE PTR")=$P(MAG2,"^",8) ; should be null
"RTN","MAGDIR9E",136,0)
 . . . I FILEDATA("PARENT FILE")'=2006.5839 D  ; fatal error
"RTN","MAGDIR9E",137,0)
 . . . . D TMPMISS^MAGDIRVE($T(+0),FILEDATA("PARENT FILE"),MAGGP)
"RTN","MAGDIR9E",138,0)
 . . . . S ERRCODE=-505
"RTN","MAGDIR9E",139,0)
 . . . . Q
"RTN","MAGDIR9E",140,0)
 . . . Q
"RTN","MAGDIR9E",141,0)
 . . Q
"RTN","MAGDIR9E",142,0)
 . ;
"RTN","MAGDIR9E",143,0)
 . I 'MAGGP  D  ; no group exists yet create a temporary association
"RTN","MAGDIR9E",144,0)
 . . S FILEDATA("PARENT FILE")=2006.5839 ; GMRC file
"RTN","MAGDIR9E",145,0)
 . . S FILEDATA("PARENT IEN")=GMRCIEN
"RTN","MAGDIR9E",146,0)
 . . Q
"RTN","MAGDIR9E",147,0)
 . Q
"RTN","MAGDIR9E",148,0)
 ;
"RTN","MAGDIR9E",149,0)
 S FILEDATA("MODALITY")=MODALITY
"RTN","MAGDIR9E",150,0)
 S FILEDATA("PACKAGE")="CONS"
"RTN","MAGDIR9E",151,0)
 ;
"RTN","MAGDIR9E",152,0)
 ; add the study to the Consult Unread List, if necessary
"RTN","MAGDIR9E",153,0)
 D ADD^MAGDTR03(.RESULT,GMRCIEN,"I",1) ; add if "on image" is set
"RTN","MAGDIR9E",154,0)
 ;
"RTN","MAGDIR9E",155,0)
 ; lookup study in ^GMR(123) and get FILEDATA variables
"RTN","MAGDIR9E",156,0)
 S SERVICE=$$GET1^DIQ(123,GMRCIEN,1,"I")
"RTN","MAGDIR9E",157,0)
 I SERVICE D
"RTN","MAGDIR9E",158,0)
 . N ISPECIDX,IPROCIDX,UNREAD,X,Y
"RTN","MAGDIR9E",159,0)
 . S UNREAD=$O(^MAG(2006.5849,"B",GMRCIEN,""))
"RTN","MAGDIR9E",160,0)
 . I UNREAD D  ; get indices from Unread List
"RTN","MAGDIR9E",161,0)
 . . S X=^MAG(2006.5849,UNREAD,0)
"RTN","MAGDIR9E",162,0)
 . . S ISPECIDX=$P(X,"^",3),IPROCIDX=$P(X,"^",4)
"RTN","MAGDIR9E",163,0)
 . . S FILEDATA("SPEC/SUBSPEC")=ISPECIDX
"RTN","MAGDIR9E",164,0)
 . . I "A"[$P(^MAG(2005.85,IPROCIDX,0),"^",3) D
"RTN","MAGDIR9E",165,0)
 . . . S FILEDATA("PROC/EVENT")=IPROCIDX
"RTN","MAGDIR9E",166,0)
 . . . Q
"RTN","MAGDIR9E",167,0)
 . . E  D  ; inactive index to procedure
"RTN","MAGDIR9E",168,0)
 . . . S X=$$FIELD43^MAGXMA(MODALITY,ISPECIDX,.Y)
"RTN","MAGDIR9E",169,0)
 . . . S FILEDATA("PROC/EVENT")=$S(X=0:Y,1:"")
"RTN","MAGDIR9E",170,0)
 . . . Q
"RTN","MAGDIR9E",171,0)
 . . Q
"RTN","MAGDIR9E",172,0)
 . E  I $D(^MAG(2006.5831,SERVICE,0)) D
"RTN","MAGDIR9E",173,0)
 . . S ISPECIDX=$P(^MAG(2006.5831,SERVICE,0),"^",2)
"RTN","MAGDIR9E",174,0)
 . . S X=$$FIELD43^MAGXMA(MODALITY,ISPECIDX,.Y)
"RTN","MAGDIR9E",175,0)
 . . S FILEDATA("PROC/EVENT")=$S(X=0:Y,1:"")
"RTN","MAGDIR9E",176,0)
 . . S FILEDATA("SPEC/SUBSPEC")=ISPECIDX
"RTN","MAGDIR9E",177,0)
 . . Q
"RTN","MAGDIR9E",178,0)
 . E  D  ; service was removed from ^MAG(2006.5831)
"RTN","MAGDIR9E",179,0)
 . . S FILEDATA("PROC/EVENT")=""
"RTN","MAGDIR9E",180,0)
 . . S FILEDATA("SPEC/SUBSPEC")=""
"RTN","MAGDIR9E",181,0)
 . . Q
"RTN","MAGDIR9E",182,0)
 . Q
"RTN","MAGDIR9E",183,0)
 E  D
"RTN","MAGDIR9E",184,0)
 . S FILEDATA("PROC/EVENT")=""
"RTN","MAGDIR9E",185,0)
 . S FILEDATA("SPEC/SUBSPEC")=""
"RTN","MAGDIR9E",186,0)
 . Q
"RTN","MAGDIR9E",187,0)
 ;
"RTN","MAGDIR9E",188,0)
 ; if the 2005 group node does not yet exist, create it
"RTN","MAGDIR9E",189,0)
 ;
"RTN","MAGDIR9E",190,0)
 I 'MAGGP D  Q:ERRCODE ERRCODE ; create the imaging group
"RTN","MAGDIR9E",191,0)
 . D NEWGROUP^MAGDIR9A("CON/PROC") Q:ERRCODE
"RTN","MAGDIR9E",192,0)
 . ;
"RTN","MAGDIR9E",193,0)
 . I FILEDATA("PARENT FILE")=8925 D  Q:ERRCODE  ; fix for ^TIU
"RTN","MAGDIR9E",194,0)
 . . S ERRCODE=$$TIUXLINK^MAGDIR9E()
"RTN","MAGDIR9E",195,0)
 . . Q
"RTN","MAGDIR9E",196,0)
 . E  I FILEDATA("PARENT FILE")=2006.5839 D  ; fix for ^GMR
"RTN","MAGDIR9E",197,0)
 . . L +^MAG(2006.5839):1E9 ; Background job MUST wait
"RTN","MAGDIR9E",198,0)
 . . I '$D(^MAG(2006.5839,0)) D
"RTN","MAGDIR9E",199,0)
 . . . S ^MAG(2006.5839,0)="DICOM GMRC TEMP LIST^^0^0"
"RTN","MAGDIR9E",200,0)
 . . . Q
"RTN","MAGDIR9E",201,0)
 . . S D0=$P(^MAG(2006.5839,0),"^",3)+1
"RTN","MAGDIR9E",202,0)
 . . S $P(^MAG(2006.5839,0),"^",3)=D0,$P(^(0),"^",4)=$P(^(0),"^",4)+1
"RTN","MAGDIR9E",203,0)
 . . L -^MAG(2006.5839)
"RTN","MAGDIR9E",204,0)
 . . S ^MAG(2006.5839,D0,0)="123^"_GMRCIEN_"^"_MAGGP
"RTN","MAGDIR9E",205,0)
 . . S ^MAG(2006.5839,"C",123,GMRCIEN,D0)=""
"RTN","MAGDIR9E",206,0)
 . . Q
"RTN","MAGDIR9E",207,0)
 . Q
"RTN","MAGDIR9E",208,0)
 ;
"RTN","MAGDIR9E",209,0)
 ; check for intra-oral x-ray images & get tooth number(s)
"RTN","MAGDIR9E",210,0)
 I IMAGNAME'="" S FILEDATA("SHORT DESCRIPTION")=IMAGNAME
"RTN","MAGDIR9E",211,0)
 ;
"RTN","MAGDIR9E",212,0)
 Q 0
"RTN","MAGDIR9E",213,0)
 ;
"RTN","MAGDIR9E",214,0)
TIUXLINK() ; create the cross-linkages to TIU EXTERNAL DATA LINK file
"RTN","MAGDIR9E",215,0)
 N TIUXDIEN
"RTN","MAGDIR9E",216,0)
 D PUTIMAGE^TIUSRVPL(.TIUXDIEN,TIUIEN,MAGGP)
"RTN","MAGDIR9E",217,0)
 I TIUXDIEN D
"RTN","MAGDIR9E",218,0)
 . S FILEDATA("PARENT FILE PTR")=TIUXDIEN
"RTN","MAGDIR9E",219,0)
 . S $P(^MAG(2005,MAGGP,2),"^",8)=TIUXDIEN
"RTN","MAGDIR9E",220,0)
 . Q
"RTN","MAGDIR9E",221,0)
 E  D  Q ERRCODE ; fatal error
"RTN","MAGDIR9E",222,0)
 . K MSG
"RTN","MAGDIR9E",223,0)
 . S MSG(1)="ERROR ASSOCIATING WITH TIU EXTERNAL DATA LINK (file 8925.91):"
"RTN","MAGDIR9E",224,0)
 . S MSG(2)=$P(TIUXDIEN,"^",2,999)
"RTN","MAGDIR9E",225,0)
 . D BADERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR9E",226,0)
 . S ERRCODE=-508
"RTN","MAGDIR9E",227,0)
 . Q
"RTN","MAGDIR9E",228,0)
 Q 0
"RTN","MAGDIR9E",229,0)
 ;
"RTN","MAGDIRVE")
0^21^B64787457
"RTN","MAGDIRVE",1,0)
MAGDIRVE ;WOIFO/PMK - Serious Fatal Image Processing Error Messages ; 17 Sep 2008 7:42 AM
"RTN","MAGDIRVE",2,0)
 ;;3.0;IMAGING;**11,30,54**;03-July-2009;;Build 1424
"RTN","MAGDIRVE",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDIRVE",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIRVE",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDIRVE",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDIRVE",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDIRVE",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDIRVE",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDIRVE",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDIRVE",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDIRVE",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDIRVE",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDIRVE",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDIRVE",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDIRVE",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIRVE",17,0)
 ;;
"RTN","MAGDIRVE",18,0)
 Q
"RTN","MAGDIRVE",19,0)
 ;
"RTN","MAGDIRVE",20,0)
 ; new version for RPC client-server image processing error messages
"RTN","MAGDIRVE",21,0)
 ;
"RTN","MAGDIRVE",22,0)
MAGZERO(RTN,LASTIEN,LASTIMG) ; from ^MAGDIR84 for bad ^MAG(2005)
"RTN","MAGDIRVE",23,0)
 N TITLE
"RTN","MAGDIRVE",24,0)
 K MSG
"RTN","MAGDIRVE",25,0)
 S TITLE="DICOM IMAGE PROCESSING ERROR - IMAGE FILE CORRUPTION"
"RTN","MAGDIRVE",26,0)
 S MSG(2)="The ^MAG(2005) file has been corrupted so that new images will"
"RTN","MAGDIRVE",27,0)
 S MSG(3)="overwrite old ones and general image database inconsistency"
"RTN","MAGDIRVE",28,0)
 S MSG(4)="will result."
"RTN","MAGDIRVE",29,0)
 S MSG(5)=""
"RTN","MAGDIRVE",30,0)
 S MSG(6)="Latest internal entry number processed: "
"RTN","MAGDIRVE",31,0)
 S MSG(6)=MSG(6)_LASTIMG ; ^MAGDICOM(2006.563,1,"LAST IMAGE POINTER")
"RTN","MAGDIRVE",32,0)
 S MSG(7)="Bad ^MAG(2005,0) internal entry number: "_LASTIEN
"RTN","MAGDIRVE",33,0)
 D BADERROR(RTN,TITLE,.MSG)
"RTN","MAGDIRVE",34,0)
 Q
"RTN","MAGDIRVE",35,0)
 ;
"RTN","MAGDIRVE",36,0)
ZERONODE(RTN,LASTIEN,LASTPTR,FILE,FILENAME) ; from ^MAGDIR84
"RTN","MAGDIRVE",37,0)
 ; invoked for an arbitrary file corrupted value
"RTN","MAGDIRVE",38,0)
 N TITLE,ZERONODE
"RTN","MAGDIRVE",39,0)
 K MSG
"RTN","MAGDIRVE",40,0)
 S TITLE="DICOM IMAGE PROCESSING ERROR - "_FILE_" FILE CORRUPTION"
"RTN","MAGDIRVE",41,0)
 S MSG(2)="The "_FILENAME_" file has been corrupted so that new reports will"
"RTN","MAGDIRVE",42,0)
 S MSG(3)="overwrite old ones and general image/report database inconsistency"
"RTN","MAGDIRVE",43,0)
 S MSG(4)="will result."
"RTN","MAGDIRVE",44,0)
 S MSG(5)=""
"RTN","MAGDIRVE",45,0)
 S MSG(6)="Latest internal entry number processed: "
"RTN","MAGDIRVE",46,0)
 S MSG(6)=MSG(6)_LASTPTR ; from ^MAGDICOM(2006.563,1,"LAST ... POINTER")
"RTN","MAGDIRVE",47,0)
 S ZERONODE=$S(FILE[")":$P(FILE,")")_",0)",1:FILE_"(0)")
"RTN","MAGDIRVE",48,0)
 S MSG(7)="Bad "_ZERONODE_" internal entry number: "_LASTIEN
"RTN","MAGDIRVE",49,0)
 D BADERROR(RTN,TITLE,.MSG)
"RTN","MAGDIRVE",50,0)
 Q
"RTN","MAGDIRVE",51,0)
 ;
"RTN","MAGDIRVE",52,0)
OBJECT(RTN,MAGGP) ; from ^MAGDIR9B
"RTN","MAGDIRVE",53,0)
 N TITLE
"RTN","MAGDIRVE",54,0)
 K MSG
"RTN","MAGDIRVE",55,0)
 S TITLE="DICOM IMAGE PROCESSING ERROR - WRONG GROUP OBJECT TYPE"
"RTN","MAGDIRVE",56,0)
 S MSG(2)="The group entry in ^MAG(2005) does not have the proper group"
"RTN","MAGDIRVE",57,0)
 S MSG(3)="object type."
"RTN","MAGDIRVE",58,0)
 S MSG(4)=""
"RTN","MAGDIRVE",59,0)
 S MSG(5)="The expected value is 11.  The value in the group entry is "
"RTN","MAGDIRVE",60,0)
 S MSG(5)=MSG(5)_$P($G(^MAG(2005,MAGGP,0),"^^^^^not defined"),"^",6)_"."
"RTN","MAGDIRVE",61,0)
 S MSG(6)=""
"RTN","MAGDIRVE",62,0)
 S MSG(7)="Internal entry number of incorrect group: "_MAGGP
"RTN","MAGDIRVE",63,0)
 D BADERROR(RTN,TITLE,.MSG)
"RTN","MAGDIRVE",64,0)
 Q
"RTN","MAGDIRVE",65,0)
 ;
"RTN","MAGDIRVE",66,0)
MISMATCH(RTN,DFN,MAGGP) ; from ^MAGDIR9A/B/E for a patient mismatch
"RTN","MAGDIRVE",67,0)
 N GROUPDFN,TITLE
"RTN","MAGDIRVE",68,0)
 K MSG
"RTN","MAGDIRVE",69,0)
 S TITLE="DICOM IMAGE PROCESSING ERROR - PATIENT MISMATCH PROBLEM"
"RTN","MAGDIRVE",70,0)
 S GROUPDFN=$P($G(^MAG(2005,MAGGP,0)),"^",7)
"RTN","MAGDIRVE",71,0)
 S MSG(2)="The image and the group point to different patients."
"RTN","MAGDIRVE",72,0)
 S MSG(3)=""
"RTN","MAGDIRVE",73,0)
 S MSG(4)="The Image points to PATIENT file internal entry number "_DFN
"RTN","MAGDIRVE",74,0)
 S MSG(5)=$$PATDEMO(DFN)
"RTN","MAGDIRVE",75,0)
 S MSG(6)=""
"RTN","MAGDIRVE",76,0)
 S MSG(7)="The Group points to PATIENT file internal entry number "_GROUPDFN
"RTN","MAGDIRVE",77,0)
 S MSG(8)=$$PATDEMO(GROUPDFN)
"RTN","MAGDIRVE",78,0)
 S MSG(9)=""
"RTN","MAGDIRVE",79,0)
 S MSG(10)="Internal entry number of group: ^MAG(2005,"_MAGGP_")"
"RTN","MAGDIRVE",80,0)
 D BADERROR(RTN,TITLE,.MSG)
"RTN","MAGDIRVE",81,0)
 Q
"RTN","MAGDIRVE",82,0)
 ;
"RTN","MAGDIRVE",83,0)
PATDEMO(DFN) ; display patient demographics
"RTN","MAGDIRVE",84,0)
 N %,%H,DISYS,DTIME,VA,VADM,VAERR
"RTN","MAGDIRVE",85,0)
 Q:'$G(DFN) "<null DFN>"
"RTN","MAGDIRVE",86,0)
 D DEM^VADPT
"RTN","MAGDIRVE",87,0)
 Q "("_$P($G(VADM(5)),"^",2)_" - "_$P($G(VADM(3)),"^",2)_")" ; sex & dob
"RTN","MAGDIRVE",88,0)
 ;
"RTN","MAGDIRVE",89,0)
RADMISS(RTN,DFN,RARPT,RARPTDFN) ; from ^MAGDIR9A for a patient mismatch
"RTN","MAGDIRVE",90,0)
 ; this is bad DFN value for the radiology report in ^RARPT
"RTN","MAGDIRVE",91,0)
 N TITLE
"RTN","MAGDIRVE",92,0)
 K MSG
"RTN","MAGDIRVE",93,0)
 S TITLE="DICOM IMAGE PROCESSING ERROR - RAD PATIENT/REPORT MISMATCH"
"RTN","MAGDIRVE",94,0)
 S MSG(2)="The image and the radiology report point to different patients."
"RTN","MAGDIRVE",95,0)
 S MSG(3)=""
"RTN","MAGDIRVE",96,0)
 S MSG(4)="The Image points to PATIENT file internal entry number "_DFN
"RTN","MAGDIRVE",97,0)
 S MSG(5)=$$PATDEMO(DFN)
"RTN","MAGDIRVE",98,0)
 S MSG(6)=""
"RTN","MAGDIRVE",99,0)
 S MSG(7)="The Rad Report points to PATIENT file internal entry number "_RARPTDFN
"RTN","MAGDIRVE",100,0)
 S MSG(8)=$$PATDEMO(RARPTDFN)
"RTN","MAGDIRVE",101,0)
 S MSG(9)=""
"RTN","MAGDIRVE",102,0)
 S MSG(10)="Internal entry number of report: ^RARPT("_RARPT_")"
"RTN","MAGDIRVE",103,0)
 D BADERROR(RTN,TITLE,.MSG)
"RTN","MAGDIRVE",104,0)
 Q
"RTN","MAGDIRVE",105,0)
 ;
"RTN","MAGDIRVE",106,0)
TIUMISS(RTN,DFN,TIUIEN,TIUDFN) ; from ^MAGDIR9E for a patient mismatch
"RTN","MAGDIRVE",107,0)
 ; this is bad DFN value for the consult/procedure request note in ^TIU(8925)
"RTN","MAGDIRVE",108,0)
 N TITLE
"RTN","MAGDIRVE",109,0)
 K MSG
"RTN","MAGDIRVE",110,0)
 S TITLE="DICOM IMAGE PROCESSING ERROR - TIU PATIENT/REPORT MISMATCH"
"RTN","MAGDIRVE",111,0)
 S MSG(2)="The image and the TIU note point to different patients."
"RTN","MAGDIRVE",112,0)
 S MSG(3)=""
"RTN","MAGDIRVE",113,0)
 S MSG(4)="The Image points to PATIENT file internal entry number "_DFN
"RTN","MAGDIRVE",114,0)
 S MSG(5)=$$PATDEMO(DFN)
"RTN","MAGDIRVE",115,0)
 S MSG(6)=""
"RTN","MAGDIRVE",116,0)
 S MSG(7)="The TIU note points to PATIENT file internal entry number "_TIUDFN
"RTN","MAGDIRVE",117,0)
 S MSG(8)=$$PATDEMO(TIUDFN)
"RTN","MAGDIRVE",118,0)
 S MSG(9)=""
"RTN","MAGDIRVE",119,0)
 S MSG(10)="Internal entry number of TIU note: ^TIU(8925,"_TIUIEN_")"
"RTN","MAGDIRVE",120,0)
 D BADERROR(RTN,TITLE,.MSG)
"RTN","MAGDIRVE",121,0)
 Q
"RTN","MAGDIRVE",122,0)
 ;
"RTN","MAGDIRVE",123,0)
TIUMISS2(RTN,TIUIEN1,TIUIEN2,TIUXDIEN,MAGGP) ; from ^MAGDIR9E - TIU mismatch
"RTN","MAGDIRVE",124,0)
 ; mismatch between TIU, TIU External Data File, and the image group  
"RTN","MAGDIRVE",125,0)
 N TITLE
"RTN","MAGDIRVE",126,0)
 K MSG
"RTN","MAGDIRVE",127,0)
 S TITLE="DICOM IMAGE PROCESSING ERROR - TIU/IMAGE GROUP MISMATCH"
"RTN","MAGDIRVE",128,0)
 S MSG(2)="The image group and TIU point to different notes."
"RTN","MAGDIRVE",129,0)
 S MSG(3)=""
"RTN","MAGDIRVE",130,0)
 S MSG(4)="TIU points to TUI note ien #"_TIUIEN1
"RTN","MAGDIRVE",131,0)
 S MSG(5)="The image points to TIU note ien #"_TIUIEN2
"RTN","MAGDIRVE",132,0)
 S MSG(6)="TIU External Data File (8925.91) ien #"_TIUXDIEN
"RTN","MAGDIRVE",133,0)
 S MSG(7)="points to image group ien #"_MAGGP
"RTN","MAGDIRVE",134,0)
 D BADERROR(RTN,TITLE,.MSG)
"RTN","MAGDIRVE",135,0)
 Q
"RTN","MAGDIRVE",136,0)
 ;
"RTN","MAGDIRVE",137,0)
TMPMISS(RTN,PARENTFP,MAGGP) ; from ^MAGDIR9E
"RTN","MAGDIRVE",138,0)
 ; the image group does not have 2006.5839 for the PARENT FILE
"RTN","MAGDIRVE",139,0)
 N TITLE
"RTN","MAGDIRVE",140,0)
 K MSG
"RTN","MAGDIRVE",141,0)
 S TITLE="DICOM IMAGE PROCESSING ERROR - IMAGE GROUP MISMATCH"
"RTN","MAGDIRVE",142,0)
 S MSG(2)="The image group does not point to PARENT FILE 2006.5839."
"RTN","MAGDIRVE",143,0)
 S MSG(3)=""
"RTN","MAGDIRVE",144,0)
 S MSG(4)="The image group should point to PARENT FILE 2006.5839."
"RTN","MAGDIRVE",145,0)
 S MSG(5)="Instead it point to PARENT FILE #"_PARENTFP
"RTN","MAGDIRVE",146,0)
 S MSG(6)="The image group is ^MAG(2005,"_MAGGP_")"
"RTN","MAGDIRVE",147,0)
 D BADERROR(RTN,TITLE,.MSG)
"RTN","MAGDIRVE",148,0)
 Q
"RTN","MAGDIRVE",149,0)
 ;
"RTN","MAGDIRVE",150,0)
IMAGEPTR(RTN,IMAGEPTR,LASTIMG) ; from ^MAGDIR9B for a corrupted image pointer value
"RTN","MAGDIRVE",151,0)
 N TITLE
"RTN","MAGDIRVE",152,0)
 K MSG
"RTN","MAGDIRVE",153,0)
 S TITLE="DICOM IMAGE PROCESSING ERROR - IMAGE ENTRY NUMBER PROBLEM"
"RTN","MAGDIRVE",154,0)
 S MSG(2)="The internal entry number for this image is less than that of the"
"RTN","MAGDIRVE",155,0)
 S MSG(3)="last processed image.  This will cause new images to overwrite"
"RTN","MAGDIRVE",156,0)
 S MSG(4)="old ones and general image database inconsistency will result."
"RTN","MAGDIRVE",157,0)
 S MSG(5)=""
"RTN","MAGDIRVE",158,0)
 S MSG(6)="Latest internal entry number processed: "
"RTN","MAGDIRVE",159,0)
 S MSG(6)=MSG(6)_LASTIMG ; ^MAGDICOM(2006.563,1,"LAST IMAGE POINTER")
"RTN","MAGDIRVE",160,0)
 S MSG(7)="Bad internal entry number of new image: "_IMAGEPTR
"RTN","MAGDIRVE",161,0)
 D BADERROR(RTN,TITLE,.MSG)
"RTN","MAGDIRVE",162,0)
 Q
"RTN","MAGDIRVE",163,0)
 ;
"RTN","MAGDIRVE",164,0)
GROUPPTR(RTN,MAGGP,LASTIMG) ; from ^MAGDIR9A for bad group pointer
"RTN","MAGDIRVE",165,0)
 N TITLE
"RTN","MAGDIRVE",166,0)
 K MSG
"RTN","MAGDIRVE",167,0)
 S TITLE="DICOM IMAGE PROCESSING ERROR - GROUP ENTRY NUMBER PROBLEM"
"RTN","MAGDIRVE",168,0)
 S MSG(2)="The internal entry number for this group is less than that of the"
"RTN","MAGDIRVE",169,0)
 S MSG(3)="last processed image.  This will cause new images to overwrite"
"RTN","MAGDIRVE",170,0)
 S MSG(4)="old ones and general image database inconsistency will result."
"RTN","MAGDIRVE",171,0)
 S MSG(5)=""
"RTN","MAGDIRVE",172,0)
 S MSG(6)="Latest internal entry number processed: "
"RTN","MAGDIRVE",173,0)
 S MSG(6)=MSG(6)_LASTIMG ; ^MAGDICOM(2006.563,1,"LAST IMAGE POINTER")
"RTN","MAGDIRVE",174,0)
 S MSG(7)="Bad internal entry number of new group: "_MAGGP
"RTN","MAGDIRVE",175,0)
 D BADERROR(RTN,TITLE,.MSG)
"RTN","MAGDIRVE",176,0)
 Q
"RTN","MAGDIRVE",177,0)
 ;
"RTN","MAGDIRVE",178,0)
BADERROR(RTN,TITLE,MSG) ; final common pathway for all msgs
"RTN","MAGDIRVE",179,0)
 ; invoked by other image processing error checking code as well
"RTN","MAGDIRVE",180,0)
 N I
"RTN","MAGDIRVE",181,0)
 S I=$O(MSG(" "),-1)
"RTN","MAGDIRVE",182,0)
 S MSG(1)=$G(MSG(1)) ; usually null
"RTN","MAGDIRVE",183,0)
 S MSG(I+1)="Gateway: """_$G(SYSTITLE,"<unknown>")_""""
"RTN","MAGDIRVE",184,0)
 S MSG(I+2)=""
"RTN","MAGDIRVE",185,0)
 S MSG(I+3)="          This is a VERY SERIOUS ERROR.  Image processing"
"RTN","MAGDIRVE",186,0)
 S MSG(I+4)="              will be halted until it is resolved."
"RTN","MAGDIRVE",187,0)
 S MSG(I+5)=""
"RTN","MAGDIRVE",188,0)
 S MSG(I+6)="Call IRM and the National VistA Support Help Desk (888) 596-HELP"
"RTN","MAGDIRVE",189,0)
 S MSG(I+7)=""
"RTN","MAGDIRVE",190,0)
 S MSG(I+8)="Problem detected by routine "_RTN_"."
"RTN","MAGDIRVE",191,0)
 S MSG(I+9)=""
"RTN","MAGDIRVE",192,0)
 S MSG("TITLE")=TITLE,MSG("CRITICAL")=1 ; send email to Silver Spring
"RTN","MAGDIRVE",193,0)
 Q
"RTN","MAGDIRVE",194,0)
 ;
"RTN","MAGDIRVE",195,0)
ERROR(RTN,TITLE,MSG) ; application error - local to the site - no email
"RTN","MAGDIRVE",196,0)
 N I
"RTN","MAGDIRVE",197,0)
 S I=$O(MSG(" "),-1)
"RTN","MAGDIRVE",198,0)
 S MSG(I+1)="Problem detected by routine "_RTN_"."
"RTN","MAGDIRVE",199,0)
 S MSG(I+2)=""
"RTN","MAGDIRVE",200,0)
 S MSG("TITLE")=TITLE,MSG("CRITICAL")=0 ; no email to Silver Spring
"RTN","MAGDIRVE",201,0)
 Q
"RTN","MAGDLB1")
0^22^B53612286
"RTN","MAGDLB1",1,0)
MAGDLB1 ;WOIFO/LB - Routine to fix failed DICOM entries ; 05/18/2007 11:23
"RTN","MAGDLB1",2,0)
 ;;3.0;IMAGING;**11,30,54**;03-July-2009;;Build 1424
"RTN","MAGDLB1",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDLB1",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDLB1",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDLB1",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDLB1",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDLB1",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDLB1",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDLB1",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDLB1",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDLB1",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDLB1",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDLB1",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDLB1",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDLB1",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDLB1",17,0)
 ;;
"RTN","MAGDLB1",18,0)
 Q
"RTN","MAGDLB1",19,0)
 ;
"RTN","MAGDLB1",20,0)
DISPLAY ;
"RTN","MAGDLB1",21,0)
 S OUT=0
"RTN","MAGDLB1",22,0)
 W !,"**************Processing entry**********"
"RTN","MAGDLB1",23,0)
 W !!?2,"PATIENT: ",PAT,?50,"SSN: ",PID,!,"RADIOLOGY CASE #: ",CASENO
"RTN","MAGDLB1",24,0)
 W !?2,"Equipment: ",MOD,?50,"Model: ",MODEL
"RTN","MAGDLB1",25,0)
 W !?2,"Date Processed: ",DATE,?50,"Problem with: ",REASON
"RTN","MAGDLB1",26,0)
 W !?2,"Comment: ",COMNT1
"RTN","MAGDLB1",27,0)
 W !?2,"Correcting file on Image gateway server ID: ",MACHID,!?5,FILE
"RTN","MAGDLB1",28,0)
 S MSG="Do you want to Correct this entry? "
"RTN","MAGDLB1",29,0)
 Q
"RTN","MAGDLB1",30,0)
 ;
"RTN","MAGDLB1",31,0)
NEWCASE ;
"RTN","MAGDLB1",32,0)
 S NEWDFN=$P(MAGDY,"^"),NEWNME=$P(MAGDY,"^",2),NEWSSN=$P(MAGDY,"^",3)
"RTN","MAGDLB1",33,0)
 S NEWCAS=$P(MAGDY,"^",4),NEWPROC=$P(MAGDY,"^",5),NEWDTI=$P(MAGDY,"^",6)
"RTN","MAGDLB1",34,0)
 S NEWMUL=$P(MAGDY,"^",7),NEWPIEN=$P(MAGDY,"^",8),PP=$P(MAGDY,"^",9)
"RTN","MAGDLB1",35,0)
 Q
"RTN","MAGDLB1",36,0)
 ;
"RTN","MAGDLB1",37,0)
ASK() ;
"RTN","MAGDLB1",38,0)
 N ANS,ASK
"RTN","MAGDLB1",39,0)
 ;
"RTN","MAGDLB1",40,0)
ASK1 S ASK="Y/N/D/Q"
"RTN","MAGDLB1",41,0)
 I $G(PREV)'=$G(MAGIEN),MAGTYPE="RAD" S ASK=ASK_"/P"
"RTN","MAGDLB1",42,0)
 W !,$G(MSG),"("_ASK_")// " R ANS:600
"RTN","MAGDLB1",43,0)
 I '$T!(ANS["^") Q "^"
"RTN","MAGDLB1",44,0)
 I ANS="" Q "N"
"RTN","MAGDLB1",45,0)
 I "YNDPQyndpq"'[$E(ANS) D  G ASK1
"RTN","MAGDLB1",46,0)
 . W !,"Please respond with one of the following codes."
"RTN","MAGDLB1",47,0)
 . W !,"Legend: Y=yes, N=no, D=delete, P=Previous entry, and Q=quit",!
"RTN","MAGDLB1",48,0)
 S ANS=$TR(ANS,"yndpq","YNDPQ")
"RTN","MAGDLB1",49,0)
 Q $E(ANS)
"RTN","MAGDLB1",50,0)
 ;
"RTN","MAGDLB1",51,0)
CHK ;remove any punctuation before doing comparison on SSN
"RTN","MAGDLB1",52,0)
 ;stop on 1st check.
"RTN","MAGDLB1",53,0)
 N OLD,I
"RTN","MAGDLB1",54,0)
 S OLD="" F I=1:1:$L(PID) I $E(PID,I)?1AN S OLD=OLD_$E(PID,I)
"RTN","MAGDLB1",55,0)
 I NEWSSN'=OLD D  Q
"RTN","MAGDLB1",56,0)
 . S MSG="Social Security numbers do not match. Update? "
"RTN","MAGDLB1",57,0)
 I NEWNME'=PAT D  Q
"RTN","MAGDLB1",58,0)
 . S MSG="Patient names do not match. Update? "
"RTN","MAGDLB1",59,0)
 ;Finally the problem is with the case number...either no longer in "C"
"RTN","MAGDLB1",60,0)
 ;xref or invalid number provided
"RTN","MAGDLB1",61,0)
 S MSG="Radiology case number different. Update? "
"RTN","MAGDLB1",62,0)
 Q
"RTN","MAGDLB1",63,0)
 ;
"RTN","MAGDLB1",64,0)
NEWDIS ;
"RTN","MAGDLB1",65,0)
 W !?2,"****Please review the following: *****"
"RTN","MAGDLB1",66,0)
 W !?2,"Previous name: ",PAT,!?2,"     New name: ",NEWNME
"RTN","MAGDLB1",67,0)
 W !?2,"Previous ssn: ",PID,!?2,"     New ssn: ",NEWSSN
"RTN","MAGDLB1",68,0)
 W !?2,"Previous case #: ",CASENO,!?2,"     New case #: ",NEWCAS
"RTN","MAGDLB1",69,0)
 I $L($G(PP)) W !?15,"Case number selected: ",PP
"RTN","MAGDLB1",70,0)
 ; Variable PP already has text message about being part of printset.
"RTN","MAGDLB1",71,0)
 Q
"RTN","MAGDLB1",72,0)
 ;
"RTN","MAGDLB1",73,0)
UPDT ;
"RTN","MAGDLB1",74,0)
 N GWLOC ; -- gateway location
"RTN","MAGDLB1",75,0)
 W !,"Will change the following: " D NEWDIS
"RTN","MAGDLB1",76,0)
 W !,"Are you sure you want to correct this entry? " S %=2 D YN^DICN
"RTN","MAGDLB1",77,0)
 I %=-1!(%=2) S OUT=1 Q
"RTN","MAGDLB1",78,0)
 W !,"Updating the file."
"RTN","MAGDLB1",79,0)
 S NEWDTIM=$TR(NEWDTI,"0123456789","9876543210")
"RTN","MAGDLB1",80,0)
 S ^MAGD(2006.575,MAGIEN,"FIXD")="1^"_NEWDFN_"^"_NEWNME_"^"_NEWSSN_"^"_NEWCAS_"^"_NEWDTI_"^"_NEWMUL_"^"_NEWDTIM W "."
"RTN","MAGDLB1",81,0)
 S ^MAGD(2006.575,MAGIEN,"FIXPR")=NEWPIEN_"^"_NEWPROC W "."
"RTN","MAGDLB1",82,0)
 ;Same as ^radpt(newdfn,"DT",newdti,"P",newmul,0) & ^RAMIS(71,newpien,0)
"RTN","MAGDLB1",83,0)
 S MACHID=$S(MACHID="":"A",1:MACHID) ; server ID
"RTN","MAGDLB1",84,0)
 S GWLOC=$P($G(^MAGD(2006.575,MAGIEN,1)),"^",5)
"RTN","MAGDLB1",85,0)
 I GWLOC S ^MAGD(2006.575,"AFX",GWLOC,MACHID,MAGIEN)="" W "."
"RTN","MAGDLB1",86,0)
 E  W !,"Gateway place not defined on image entry "_MAGIEN_", continuing.."
"RTN","MAGDLB1",87,0)
 ;Xref to loop & process entries; processing will be minimal.
"RTN","MAGDLB1",88,0)
 S MAGFIX(MAGIEN)="F"
"RTN","MAGDLB1",89,0)
 Q
"RTN","MAGDLB1",90,0)
 ;
"RTN","MAGDLB1",91,0)
SETDEL ;Entry to be deleted
"RTN","MAGDLB1",92,0)
 N GWLOC ; -- gateway location
"RTN","MAGDLB1",93,0)
 D LOGERR I ANS="^" S OUT=1 Q
"RTN","MAGDLB1",94,0)
 S GWLOC=$P($G(^MAGD(2006.575,MAGIEN,1)),"^",5)
"RTN","MAGDLB1",95,0)
 I GWLOC S ^MAGD(2006.575,"AFX",GWLOC,MACHID,MAGIEN)="D" W "."
"RTN","MAGDLB1",96,0)
 E  W !,"Gateway place not defined on this image entry "_MAGIEN_", continuing.."
"RTN","MAGDLB1",97,0)
 S $P(^MAGD(2006.575,MAGIEN,0),"^",6)="1"
"RTN","MAGDLB1",98,0)
 S ^MAGD(2006.575,MAGIEN,"FIXD")=1
"RTN","MAGDLB1",99,0)
 S MAGFIX(MAGIEN)="D"
"RTN","MAGDLB1",100,0)
 Q
"RTN","MAGDLB1",101,0)
 ;
"RTN","MAGDLB1",102,0)
LOGERR ;Need to record error
"RTN","MAGDLB1",103,0)
 N DIR,DIRUT,DTOUT,ENTRY,I,MAGERR,MAGOUT,NOW,WHY,WHO,X,Y
"RTN","MAGDLB1",104,0)
 W !! F I=1:1:80 W "*"
"RTN","MAGDLB1",105,0)
 W !,"*** Will log in error log (file 2006.599). ****"
"RTN","MAGDLB1",106,0)
 S NOW=$$NOW^XLFDT()
"RTN","MAGDLB1",107,0)
 S DIR(0)="F^3:30"
"RTN","MAGDLB1",108,0)
 S DIR("A")="Reason for deletion"
"RTN","MAGDLB1",109,0)
 S DIR("A",1)="Please enter a reason for deleting."
"RTN","MAGDLB1",110,0)
 S DIR("A",2)="For example: TEST PATIENT"
"RTN","MAGDLB1",111,0)
 D ^DIR
"RTN","MAGDLB1",112,0)
 I $D(DIRUT)!($D(DTOUT))!(Y="") D  S ANS="^" Q
"RTN","MAGDLB1",113,0)
 . W !,"Can not delete if a reason is not provided."
"RTN","MAGDLB1",114,0)
 . Q
"RTN","MAGDLB1",115,0)
 S WHY=Y,WHO=$G(DUZ)
"RTN","MAGDLB1",116,0)
 I WHO D 
"RTN","MAGDLB1",117,0)
 . D GETS^DIQ(200,DUZ,".01","E","MAGOUT","MAGERR")
"RTN","MAGDLB1",118,0)
 . Q:$D(MAGERR("DIERR"))
"RTN","MAGDLB1",119,0)
 . S WHO=$G(MAGOUT(200,DUZ_",",.01,"E"))
"RTN","MAGDLB1",120,0)
 I WHO="" S WHO="UNKNOWN"
"RTN","MAGDLB1",121,0)
 I '$D(^MAGD(2006.599,0)) D
"RTN","MAGDLB1",122,0)
 . S ^MAGD(2006.599,0)="Dicom Error Log^2006.599^^"
"RTN","MAGDLB1",123,0)
 . Q
"RTN","MAGDLB1",124,0)
 S ENTRY=$P(^MAGD(2006.599,0),"^",3)+1
"RTN","MAGDLB1",125,0)
 S $P(^MAGD(2006.599,0),"^",3)=ENTRY
"RTN","MAGDLB1",126,0)
 S $P(^MAGD(2006.599,0),"^",4)=$P(^MAGD(2006.599,0),"^",4)+1
"RTN","MAGDLB1",127,0)
 S ^MAGD(2006.599,ENTRY,0)=NOW_"^"_WHY_"^"_FILE_"^"_MODEL
"RTN","MAGDLB1",128,0)
 S ^MAGD(2006.599,ENTRY,1)=WHO_"^"_PAT_"^"_PID_"^"_CASENO_"^"_MACHID
"RTN","MAGDLB1",129,0)
 S ^MAGD(2006.599,"B",NOW,ENTRY)=""
"RTN","MAGDLB1",130,0)
 Q
"RTN","MAGDLB1",131,0)
 ;
"RTN","MAGDLB1",132,0)
SET ;
"RTN","MAGDLB1",133,0)
 S MAGTYPE=$P(^MAGD(2006.575,MAGIEN,"TYPE"),"^")
"RTN","MAGDLB1",134,0)
 Q:$P($G(^MAGD(2006.575,MAGIEN,"FIXD")),"^")  ; Already fixed.
"RTN","MAGDLB1",135,0)
 ; Only process Radiology images...medicine images done by other rtns.
"RTN","MAGDLB1",136,0)
 I MAGTYPE'["RAD" Q
"RTN","MAGDLB1",137,0)
 S DATA=^MAGD(2006.575,MAGIEN,0)
"RTN","MAGDLB1",138,0)
 S FILE=$P(^MAGD(2006.575,MAGIEN,0),"^")
"RTN","MAGDLB1",139,0)
 S DATA1=^MAGD(2006.575,MAGIEN,1) ; Case no. info
"RTN","MAGDLB1",140,0)
 S DATA2=^MAGD(2006.575,MAGIEN,"AMFG") ; Modality info
"RTN","MAGDLB1",141,0)
 S PAT=$P(DATA,"^",4),PID=$P(DATA,"^",3),REASON=$P(DATA,"^",2)
"RTN","MAGDLB1",142,0)
 S MOD=$P(DATA2,"^"),MODEL=$P(DATA2,"^",6)
"RTN","MAGDLB1",143,0)
 S CASENO=$P(DATA1,"^",2),MACHID=$P(DATA1,"^",4)
"RTN","MAGDLB1",144,0)
 S Y=$P(DATA1,"^",3) X ^DD("DD") S DATE=Y
"RTN","MAGDLB1",145,0)
 S COMNT1=$G(^MAGD(2006.575,MAGIEN,"ACSTXT")) ; 1st line comment.
"RTN","MAGDLB1",146,0)
 S MACHID=$P(DATA1,"^",4),GWLOC=$P(DATA2,"^",9)
"RTN","MAGDLB1",147,0)
 S ANS="" D DISPLAY S ANS=$$ASK
"RTN","MAGDLB1",148,0)
 I ANS="Q"!(ANS["^") S (OOUT,OUT)=1 D SETPREV Q
"RTN","MAGDLB1",149,0)
 I ANS="N" S OUT=1 D SETPREV Q
"RTN","MAGDLB1",150,0)
 I ANS="P" D CHKPREV Q
"RTN","MAGDLB1",151,0)
 I ANS="D" D SETDEL,SETPREV Q
"RTN","MAGDLB1",152,0)
 Q:OUT
"RTN","MAGDLB1",153,0)
 K MAGDY W !," Lookup by case number or patient name"
"RTN","MAGDLB1",154,0)
 ;
"RTN","MAGDLB1",155,0)
 ; Fall Through intended
"RTN","MAGDLB1",156,0)
LOOK ;
"RTN","MAGDLB1",157,0)
 ;D ^MAGDLB2 Q:'$D(MAGDY)  Q:MAGDY'[""
"RTN","MAGDLB1",158,0)
 D EN^MAGDRA2 Q:'$D(MAGDY)  Q:MAGDY'[""
"RTN","MAGDLB1",159,0)
 D NEWCASE,CHK,NEWDIS S ANS=$$ASK
"RTN","MAGDLB1",160,0)
 I ANS="Q"!(ANS["^") S (OOUT,OUT)=1 D SETPREV Q
"RTN","MAGDLB1",161,0)
 I ANS="D" D SETDEL,SETPREV Q
"RTN","MAGDLB1",162,0)
 I ANS="P" D CHKPREV Q
"RTN","MAGDLB1",163,0)
 I ANS="N" S OUT=1 D SETPREV Q
"RTN","MAGDLB1",164,0)
 Q:OUT
"RTN","MAGDLB1",165,0)
 D UPDT
"RTN","MAGDLB1",166,0)
 I ANS="P" D CHKPREV Q
"RTN","MAGDLB1",167,0)
 D SETMAG
"RTN","MAGDLB1",168,0)
 Q
"RTN","MAGDLB1",169,0)
 ;
"RTN","MAGDLB1",170,0)
DATELOOP(START,STOP) ;Loop thru the "AD" cross reference
"RTN","MAGDLB1",171,0)
 N MAGIEN,SUID,THEDT,FIRST,OOUT,MAGFIX,MDV
"RTN","MAGDLB1",172,0)
 S KFIXALL=$$SECKEY^MAGDLB12
"RTN","MAGDLB1",173,0)
 S THEDT=START-.1,(OOUT,FIRST)=0
"RTN","MAGDLB1",174,0)
 F  S THEDT=$O(^MAGD(2006.575,"AD",THEDT)) Q:'THEDT!(THEDT>STOP)!(OOUT)  D
"RTN","MAGDLB1",175,0)
 . S MAGIEN=0
"RTN","MAGDLB1",176,0)
 . F  S MAGIEN=$O(^MAGD(2006.575,"AD",THEDT,MAGIEN)) Q:'MAGIEN  D
"RTN","MAGDLB1",177,0)
 . . I '$D(^MAGD(2006.575,MAGIEN,0)) D  Q
"RTN","MAGDLB1",178,0)
 . . . K ^MAGD(2006.575,"AD",THEDT,MAGIEN)
"RTN","MAGDLB1",179,0)
 . . . Q
"RTN","MAGDLB1",180,0)
 . . I $P($G(^MAGD(2006.575,MAGIEN,"TYPE")),U,1)'["RAD" Q
"RTN","MAGDLB1",181,0)
 . . ; No security key, or gateway site other than this site
"RTN","MAGDLB1",182,0)
 . . I 'KFIXALL,$P($G(^MAGD(2006.575,MAGIEN,1)),U,5)'=$G(DUZ(2)) Q
"RTN","MAGDLB1",183,0)
 . . I 'FIRST S PREV=MAGIEN,FIRST=1
"RTN","MAGDLB1",184,0)
 . . D SET
"RTN","MAGDLB1",185,0)
 . . Q
"RTN","MAGDLB1",186,0)
 . Q
"RTN","MAGDLB1",187,0)
 Q
"RTN","MAGDLB1",188,0)
 ;
"RTN","MAGDLB1",189,0)
SETPREV ;
"RTN","MAGDLB1",190,0)
 S PREV=MAGIEN,PREVS=$G(SUID)
"RTN","MAGDLB1",191,0)
 Q
"RTN","MAGDLB1",192,0)
 ;
"RTN","MAGDLB1",193,0)
SETMAG ;
"RTN","MAGDLB1",194,0)
 S FIRST=MAGIEN,FIRSTS=$G(SUID),MAGIEN=PREV,SUID=$G(PREVS)
"RTN","MAGDLB1",195,0)
 S PREV=FIRST,PREVS=FIRSTS
"RTN","MAGDLB1",196,0)
 Q
"RTN","MAGDLB1",197,0)
 ;
"RTN","MAGDLB1",198,0)
CHKPREV ;
"RTN","MAGDLB1",199,0)
 S OUT=1 N STATUS
"RTN","MAGDLB1",200,0)
 I '$D(MAGFIX(PREV)) D SETMAG G SET
"RTN","MAGDLB1",201,0)
 S STATUS=$S($G(MAGFIX(PREV))="D":"deleted",1:"corrected")
"RTN","MAGDLB1",202,0)
 W !,"Previous entry has been "_STATUS_".",$C(7)
"RTN","MAGDLB1",203,0)
 G SET
"RTN","MAGDLB1",204,0)
 Q
"RTN","MAGDLB1",205,0)
 ;
"RTN","MAGDLB1",206,0)
NAME(ENTRY) ;SITE NAME
"RTN","MAGDLB1",207,0)
 N NAME,MAGOUT,MAGERR
"RTN","MAGDLB1",208,0)
 I '$G(ENTRY) Q ""
"RTN","MAGDLB1",209,0)
 D GETS^DIQ(4,ENTRY,".01","E","MAGOUT","MAGERR")
"RTN","MAGDLB1",210,0)
 I $D(MAGERR("DIERR")) Q ""
"RTN","MAGDLB1",211,0)
 S NAME=$G(MAGOUT(4,ENTRY_",",.01,"E"))
"RTN","MAGDLB1",212,0)
 Q NAME
"RTN","MAGDLB1",213,0)
 ;
"RTN","MAGDLBAA")
0^23^B12894366
"RTN","MAGDLBAA",1,0)
MAGDLBAA ;WOIFO/LB - Routine to move failed dicom images to ^MAG(2006.575 ; 05/18/2007 11:23
"RTN","MAGDLBAA",2,0)
 ;;3.0;IMAGING;**11,51,54**;03-July-2009;;Build 1424
"RTN","MAGDLBAA",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDLBAA",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDLBAA",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDLBAA",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDLBAA",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDLBAA",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDLBAA",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDLBAA",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDLBAA",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDLBAA",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDLBAA",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDLBAA",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDLBAA",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDLBAA",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDLBAA",17,0)
 ;;
"RTN","MAGDLBAA",18,0)
 Q
"RTN","MAGDLBAA",19,0)
MOVE ;called from MAGDIR1 to move entries not matching Radiology case #.
"RTN","MAGDLBAA",20,0)
 ;Not done thru FM because the system should be independent.
"RTN","MAGDLBAA",21,0)
 ;These variable are needed to be defined before using this routine:
"RTN","MAGDLBAA",22,0)
 ;PIDCHECK, FIRSTDCM, IMGSVC, MIDCM, MACHID,ACNUMB, CASENUMB, PNAMEDCM, PID
"RTN","MAGDLBAA",23,0)
 ;MODALITY, CASETEXT
"RTN","MAGDLBAA",24,0)
 N DATE,REASON,IEN,NIEN,ORIG,DCMPNME,CASE,CASENUM,PATIENT
"RTN","MAGDLBAA",25,0)
 S DATE=$$NOW^XLFDT()\1
"RTN","MAGDLBAA",26,0)
 ;ADD ENTRY
"RTN","MAGDLBAA",27,0)
 L +^MAGD(2006.575,0):1E9 ; Background process MUST wait
"RTN","MAGDLBAA",28,0)
 S X=$G(^MAGD(2006.575,0))
"RTN","MAGDLBAA",29,0)
 S $P(X,"^",1,2)="DICOM FAILED IMAGES^2006.575"
"RTN","MAGDLBAA",30,0)
 S IEN=$O(^MAGD(2006.575," "),-1)+1,$P(X,"^",3)=IEN
"RTN","MAGDLBAA",31,0)
 S $P(X,"^",4)=$P(X,"^",4)+1 ; # entries
"RTN","MAGDLBAA",32,0)
 S ^MAGD(2006.575,0)=X
"RTN","MAGDLBAA",33,0)
 ;
"RTN","MAGDLBAA",34,0)
 S REASON=$P(PIDCHECK,",",2)
"RTN","MAGDLBAA",35,0)
 S PATIENT=LASTDCM_","_FIRSTDCM_$S($L(MIDCM)>0:" "_MIDCM,1:"")
"RTN","MAGDLBAA",36,0)
 S MACHID=$G(MACHID,"A")
"RTN","MAGDLBAA",37,0)
 ; PNAMEDCM usually contains an "^" between last & first name
"RTN","MAGDLBAA",38,0)
 ; CHANGE ^ TO ~
"RTN","MAGDLBAA",39,0)
 S CASE=$TR(ACNUMB,"^","~"),CASENUM=$TR(CASENUMB,"^","~")
"RTN","MAGDLBAA",40,0)
 S DCMPNME=$TR(PNAMEDCM,"^","~")
"RTN","MAGDLBAA",41,0)
 S ^MAGD(2006.575,IEN,0)=FROMPATH_"^"_REASON_"^"_PID_"^"_PATIENT_"^"_DCMPNME
"RTN","MAGDLBAA",42,0)
 S ^MAGD(2006.575,IEN,1)=CASE_"^"_CASENUM_"^"_DATE_"^"_MACHID_"^"_LOCATION
"RTN","MAGDLBAA",43,0)
 S ^MAGD(2006.575,IEN,"AIUID")=$G(IMAGEUID)
"RTN","MAGDLBAA",44,0)
 S ^MAGD(2006.575,IEN,"ASUID")=STUDYUID
"RTN","MAGDLBAA",45,0)
 S ^MAGD(2006.575,IEN,"AMFG")=$G(INSTNAME)_"^"_$G(ROWS)_"^"_$G(COLUMNS)_"^"_$G(OFFSET)_"^"_$G(MODIEN)_"^"_$G(MODALITY)_"^"_$$UP^MAGDFCNV($G(MFGR))_"^"_$$UP^MAGDFCNV($G(MODEL))_"^"_LOCATION
"RTN","MAGDLBAA",46,0)
 S ^MAGD(2006.575,IEN,"ACSTXT")=$G(CASETEXT)
"RTN","MAGDLBAA",47,0)
 ; Image type can be RAD, MEDICINE, SURGERY, etc.
"RTN","MAGDLBAA",48,0)
 S ^MAGD(2006.575,IEN,"TYPE")=$G(IMGSVC)
"RTN","MAGDLBAA",49,0)
 ;Setting xrefs
"RTN","MAGDLBAA",50,0)
 S ^MAGD(2006.575,"B",FROMPATH,IEN)=""
"RTN","MAGDLBAA",51,0)
 ; Clean up---no longer need this cross reference
"RTN","MAGDLBAA",52,0)
 K ^MAGD(2006.575,"D") ; Used for Consults only
"RTN","MAGDLBAA",53,0)
 L -^MAGD(2006.575,0)
"RTN","MAGDLBAA",54,0)
 ;
"RTN","MAGDLBAA",55,0)
 ;The following xref ("F") will be set on the 1st entry having a unique
"RTN","MAGDLBAA",56,0)
 ;STUDYUID. The remaining entries with the same # will be added
"RTN","MAGDLBAA",57,0)
 ;to the RELATED IMAGES multiple field for the entry that set the
"RTN","MAGDLBAA",58,0)
 ;F xref.
"RTN","MAGDLBAA",59,0)
 S ORIG=0
"RTN","MAGDLBAA",60,0)
 I '$D(^MAGD(2006.575,"F",LOCATION,STUDYUID)) D  Q  ; Quit if 1st entry
"RTN","MAGDLBAA",61,0)
 . S ^MAGD(2006.575,"F",LOCATION,STUDYUID,IEN)=""
"RTN","MAGDLBAA",62,0)
 . Q
"RTN","MAGDLBAA",63,0)
 S ORIG=$O(^MAGD(2006.575,"F",LOCATION,STUDYUID,0))
"RTN","MAGDLBAA",64,0)
 Q:'ORIG
"RTN","MAGDLBAA",65,0)
 I ORIG'=IEN D
"RTN","MAGDLBAA",66,0)
 . I '$D(^MAGD(2006.575,ORIG,"RLATE",0)) D
"RTN","MAGDLBAA",67,0)
 . . S ^MAGD(2006.575,ORIG,"RLATE",0)="^2006.57526PA^^"
"RTN","MAGDLBAA",68,0)
 . S NIEN=$P(^MAGD(2006.575,ORIG,"RLATE",0),"^",3),NIEN=NIEN+1
"RTN","MAGDLBAA",69,0)
 . S $P(^MAGD(2006.575,ORIG,"RLATE",0),"^",3)=NIEN ; #next ien entry
"RTN","MAGDLBAA",70,0)
 . S $P(^MAGD(2006.575,ORIG,"RLATE",0),"^",4)=$P(^MAGD(2006.575,ORIG,"RLATE",0),"^",4)+1 ; #record for multiple field
"RTN","MAGDLBAA",71,0)
 . S ^MAGD(2006.575,ORIG,"RLATE",NIEN,0)=IEN
"RTN","MAGDLBAA",72,0)
 . S ^MAGD(2006.575,ORIG,"RLATE","B",IEN,NIEN)=""
"RTN","MAGDLBAA",73,0)
 . Q
"RTN","MAGDLBAA",74,0)
 Q
"RTN","MAGDLBAA",75,0)
 ;
"RTN","MAGDMEDL")
0^24^B20217185
"RTN","MAGDMEDL",1,0)
MAGDMEDL ;WOIFO/LB - Routine to look up entries in the Medicine files ; 06/06/2007 09:42
"RTN","MAGDMEDL",2,0)
 ;;3.0;IMAGING;**51,54**;03-July-2009;;Build 1424
"RTN","MAGDMEDL",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDMEDL",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDMEDL",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDMEDL",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDMEDL",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDMEDL",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDMEDL",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDMEDL",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDMEDL",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDMEDL",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDMEDL",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDMEDL",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDMEDL",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDMEDL",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDMEDL",17,0)
 ;;
"RTN","MAGDMEDL",18,0)
 Q
"RTN","MAGDMEDL",19,0)
 ;
"RTN","MAGDMEDL",20,0)
SELECT(ITEM,ARRAY) ;
"RTN","MAGDMEDL",21,0)
 ;
"RTN","MAGDMEDL",22,0)
 N CNT,DIR,DIROUT,DIRUT,ENTRY
"RTN","MAGDMEDL",23,0)
 S CNT=+ARRAY
"RTN","MAGDMEDL",24,0)
 I 'CNT Q 0
"RTN","MAGDMEDL",25,0)
 S DIR(0)="NO^1:"_CNT,DIR("A")="Select a Medicine Procedure"
"RTN","MAGDMEDL",26,0)
 S DIR("T")=600 D ^DIR
"RTN","MAGDMEDL",27,0)
 I $D(DIRUT)!($D(DIROUT)) Q 0
"RTN","MAGDMEDL",28,0)
 S ENTRY=+Y
"RTN","MAGDMEDL",29,0)
 I '$D(ARRAY(ENTRY)) D  G SELECT
"RTN","MAGDMEDL",30,0)
 . W !,"Please select an entry or use '^' to exit"
"RTN","MAGDMEDL",31,0)
 W !,"You have selected ",$P(ARRAY(ENTRY),"^"),"."
"RTN","MAGDMEDL",32,0)
 Q $P(ARRAY(ENTRY),"^",2)
"RTN","MAGDMEDL",33,0)
 ;
"RTN","MAGDMEDL",34,0)
LOOP(ARRAY,MAGPAT,SUB,CASEDT) ;
"RTN","MAGDMEDL",35,0)
 ; MAGPAT = patient's dfn
"RTN","MAGDMEDL",36,0)
 ; SUB = Medicine specialty
"RTN","MAGDMEDL",37,0)
 ; CASEDT = case date
"RTN","MAGDMEDL",38,0)
 ;  array(0)= 1 or 0 ^ # entries found ^ message text
"RTN","MAGDMEDL",39,0)
 ;  array(#)= formatted out display without delimiters
"RTN","MAGDMEDL",40,0)
 ;  array(#,1) = internal stored values
"RTN","MAGDMEDL",41,0)
 ; Variable MAGDIMG
"RTN","MAGDMEDL",42,0)
 S ARRAY(0)="0^^No entries found"
"RTN","MAGDMEDL",43,0)
 Q:'MAGPAT
"RTN","MAGDMEDL",44,0)
 Q:'$D(MAGMC)#10   ;Array should be available.
"RTN","MAGDMEDL",45,0)
 N BEG,CDT,CNT,DATA,DICOM,EN,END,IMG,IMAGEPTR,MAGDIMG,PATIENT,PATNME,PRC,PRCNM,SSN,THEDT,X1,X2,X
"RTN","MAGDMEDL",46,0)
 N IEN,II,IOUT,MAGMC,MEDFILE
"RTN","MAGDMEDL",47,0)
 Q:'$$FIND1^DIC(2,,"A",MAGPAT,"","")
"RTN","MAGDMEDL",48,0)
 S PATNME=$P(^DPT(MAGPAT,0),"^"),SSN=$P(^(0),"^",9)
"RTN","MAGDMEDL",49,0)
 S PATIENT=PATNME_" "_SSN
"RTN","MAGDMEDL",50,0)
 S:'CASEDT CASEDT=DT
"RTN","MAGDMEDL",51,0)
 S BEG=$$FMADD^XLFDT(CASEDT,-3),END=CASEDT+.9999,CNT=0,CDT=BEG-.001
"RTN","MAGDMEDL",52,0)
 F  S CDT=$O(MAGMC(MAGPAT,SUB,CDT)) Q:'CDT!(CDT>END)  D
"RTN","MAGDMEDL",53,0)
 . S EN=0 F  S EN=$O(MAGMC(MAGPAT,SUB,CDT,EN)) Q:'EN  D
"RTN","MAGDMEDL",54,0)
 . . S DATA=MAGMC(MAGPAT,SUB,CDT,EN)
"RTN","MAGDMEDL",55,0)
 . . S PRCNM=$P(DATA,"^",2),PRC=SUB
"RTN","MAGDMEDL",56,0)
 . . S THEDT=$P(DATA,"^"),IEN=$P(DATA,"^",5)
"RTN","MAGDMEDL",57,0)
 . . I $D(MAGMC(MAGPAT,SUB,CDT,EN,2005)) S (IOUT,II)=0 D
"RTN","MAGDMEDL",58,0)
 . . . F  S II=$O(MAGMC(MAGPAT,SUB,CDT,EN,2005,II)) Q:'II!IOUT  D
"RTN","MAGDMEDL",59,0)
 . . . . S IMAGEPTR=MAGMC(MAGPAT,SUB,CDT,EN,2005,II)
"RTN","MAGDMEDL",60,0)
 . . . . I '$D(^MAG(2005,IMAGEPTR)) S IMAGEPTR="" Q
"RTN","MAGDMEDL",61,0)
 . . . . I '$D(^MAG(2005,IMAGEPTR,"PACS"))  S IMAGEPTR="",IOUT=1
"RTN","MAGDMEDL",62,0)
 . . S MEDFILE=$P(DATA,"^",4),MEDFILE=$P(MEDFILE,"MCAR(",2)
"RTN","MAGDMEDL",63,0)
 . . S DICOM="" D DICOMID^MAGDMEDI(.DICOM,MEDFILE,IEN,PRC,MAGPAT)
"RTN","MAGDMEDL",64,0)
 . . I DICOM'="" D
"RTN","MAGDMEDL",65,0)
 . . . S DICOM=$P(DICOM,":",2)
"RTN","MAGDMEDL",66,0)
 . . . S CNT=CNT+1
"RTN","MAGDMEDL",67,0)
 . . . S ARRAY(CNT)=DICOM_" "_PRCNM_", "_THEDT_" "_PATIENT
"RTN","MAGDMEDL",68,0)
 . . . S ARRAY(CNT,1)=DICOM_"^"_PATNME_"^"_SSN_"^"_EN_"^"_PRCNM_"^"_PRC_"^"_$G(IMAGEPTR)_"^"_MEDFILE
"RTN","MAGDMEDL",69,0)
 I CNT S ARRAY(0)="1^"_CNT_"^Medicine file entries for "_PATIENT
"RTN","MAGDMEDL",70,0)
 Q
"RTN","MAGDMEDL",71,0)
 ;
"RTN","MAGDMEDL",72,0)
DISPLAY(ARRAY) ;
"RTN","MAGDMEDL",73,0)
 ; Call routine needs to pass array in the following sequence
"RTN","MAGDMEDL",74,0)
 ; ARRAY(0)= 1 or 0 ^ #entries ^ message
"RTN","MAGDMEDL",75,0)
 ; ARRAY(#)=  Formatted output to be displayed.
"RTN","MAGDMEDL",76,0)
 ; Will set the RES variable for selected entry.
"RTN","MAGDMEDL",77,0)
 I '$D(ARRAY(0)) Q 0
"RTN","MAGDMEDL",78,0)
 ; If only one entry return the subscript variable.
"RTN","MAGDMEDL",79,0)
 I $P(ARRAY(0),"^",2)=1 Q 1
"RTN","MAGDMEDL",80,0)
 I $P(ARRAY(0),"^")'=1 Q 0
"RTN","MAGDMEDL",81,0)
 N ENTRY,ITEM,ITEMS,MSG,OUT,OUTPUT,RES
"RTN","MAGDMEDL",82,0)
 S RES=0,MSG=$P(ARRAY(0),"^",3)
"RTN","MAGDMEDL",83,0)
 S IOF="#,$C(27,91,72,27,91,74,8,8,8,8)",IO=0,IOSL=24,POP=0
"RTN","MAGDMEDL",84,0)
 D HEAD
"RTN","MAGDMEDL",85,0)
 S (ENTRY,OUT)=0,ITEMS=$P(ARRAY(0),"^",2)
"RTN","MAGDMEDL",86,0)
 F  S ENTRY=$O(ARRAY(ENTRY)) Q:'ENTRY!OUT  D
"RTN","MAGDMEDL",87,0)
 . S OUTPUT=$G(ARRAY(ENTRY))
"RTN","MAGDMEDL",88,0)
 . D:$Y+3>IOSL HEAD D LINE
"RTN","MAGDMEDL",89,0)
 . D:$Y+3>IOSL ASKQ
"RTN","MAGDMEDL",90,0)
 I 'OUT D ASKQ S RES=ITEM
"RTN","MAGDMEDL",91,0)
 Q RES
"RTN","MAGDMEDL",92,0)
 ;
"RTN","MAGDMEDL",93,0)
HEAD ;
"RTN","MAGDMEDL",94,0)
 W:$Y+3>IOSL @IOF W !,MSG
"RTN","MAGDMEDL",95,0)
 Q
"RTN","MAGDMEDL",96,0)
 ;
"RTN","MAGDMEDL",97,0)
LINE ;
"RTN","MAGDMEDL",98,0)
 W !,ENTRY,".) "_OUTPUT
"RTN","MAGDMEDL",99,0)
 Q
"RTN","MAGDMEDL",100,0)
 ;
"RTN","MAGDMEDL",101,0)
ASKQ ;
"RTN","MAGDMEDL",102,0)
 N X,Y,DIR
"RTN","MAGDMEDL",103,0)
 S DIR(0)="L^1:"_$S('ENTRY:ITEMS,1:ENTRY)
"RTN","MAGDMEDL",104,0)
 S DIR("T")=600,DIR("A")="Select an entry: " D ^DIR
"RTN","MAGDMEDL",105,0)
 S ITEM=+Y
"RTN","MAGDMEDL",106,0)
 Q:$D(DIRUT)!($D(DIROUT))
"RTN","MAGDMEDL",107,0)
 Q:'ITEM
"RTN","MAGDMEDL",108,0)
 I '$D(ARRAY(ITEM)) W !,"Please select an entry or '^' to exit" G ASKQ
"RTN","MAGDMEDL",109,0)
 W !,"You have selected ",$P($G(ARRAY(ITEM)),"^")
"RTN","MAGDMEDL",110,0)
 S OUT=1
"RTN","MAGDMEDL",111,0)
 Q
"RTN","MAGDMEDL",112,0)
 ;
"RTN","MAGDMEDL",113,0)
ASKMORE() ;
"RTN","MAGDMEDL",114,0)
 N DIR,DATE,X,XX,Y
"RTN","MAGDMEDL",115,0)
 Q:'$D(MAGPAT)
"RTN","MAGDMEDL",116,0)
 Q:'$D(SUB)
"RTN","MAGDMEDL",117,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","MAGDMEDL",118,0)
 S DIR("A")="Search further"
"RTN","MAGDMEDL",119,0)
 D ^DIR K DIR
"RTN","MAGDMEDL",120,0)
 I 'Y Q 0
"RTN","MAGDMEDL",121,0)
 W !,"Search will include 3 days prior to the day specified."
"RTN","MAGDMEDL",122,0)
 S DIR(0)="D^::EXP" D ^DIR
"RTN","MAGDMEDL",123,0)
 ; Y2K compliance all calls to %DT must have either past or future date
"RTN","MAGDMEDL",124,0)
 I 'Y Q 0
"RTN","MAGDMEDL",125,0)
 S DATE=Y
"RTN","MAGDMEDL",126,0)
 D LOOP(.XX,MAGPAT,SUB,DATE)
"RTN","MAGDMEDL",127,0)
 I $D(XX(0)),$P(XX(0),"^")=0 D  Q 0
"RTN","MAGDMEDL",128,0)
 . W "No entries found."
"RTN","MAGDMEDL",129,0)
 Q 1
"RTN","MAGDMEDL",130,0)
 ;
"RTN","MAGDQR00")
0^25^B3247668
"RTN","MAGDQR00",1,0)
MAGDQR00 ;WOIFO/EdM - Imaging RPCs for Query/Retrieve ; 04/05/2006 08:43
"RTN","MAGDQR00",2,0)
 ;;3.0;IMAGING;**51,54**;03-July-2009;;Build 1424
"RTN","MAGDQR00",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDQR00",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDQR00",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDQR00",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDQR00",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDQR00",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDQR00",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDQR00",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDQR00",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDQR00",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDQR00",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDQR00",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDQR00",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDQR00",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDQR00",17,0)
 ;;
"RTN","MAGDQR00",18,0)
 Q
"RTN","MAGDQR00",19,0)
 ;
"RTN","MAGDQR00",20,0)
 ; Query/Retrieve
"RTN","MAGDQR00",21,0)
 ;
"RTN","MAGDQR00",22,0)
 ; Step 1: The application (Java system) receives a C-FIND request
"RTN","MAGDQR00",23,0)
 ;
"RTN","MAGDQR00",24,0)
 ; Step 2: The application interprets the DICOM message and
"RTN","MAGDQR00",25,0)
 ;         calls an RPC on traditional VistA
"RTN","MAGDQR00",26,0)
 ;
"RTN","MAGDQR00",27,0)
 ;           RPC name: MAG CFIND QUERY
"RTN","MAGDQR00",28,0)
 ;             input:  array of:    tag | VR | flag | value
"RTN","MAGDQR00",29,0)
 ;             input:  scalar:      batch-identifier, see below
"RTN","MAGDQR00",30,0)
 ;             input:  scalar:      max # entities in response
"RTN","MAGDQR00",31,0)
 ;             output: array of:    header = # entities total | # in current batch
"RTN","MAGDQR00",32,0)
 ;                    followed by   tag | VR | flag | value
"RTN","MAGDQR00",33,0)
 ;                             or   <start sequence>
"RTN","MAGDQR00",34,0)
 ;                             or   <end sequence>
"RTN","MAGDQR00",35,0)
 ;
"RTN","MAGDQR00",36,0)
 ;          Batch-identifier:
"RTN","MAGDQR00",37,0)
 ;          There are four kinds of calls:
"RTN","MAGDQR00",38,0)
 ;           1. initial call
"RTN","MAGDQR00",39,0)
 ;              value of this parameter is "0"
"RTN","MAGDQR00",40,0)
 ;              RPC will create result-set and start a background process to
"RTN","MAGDQR00",41,0)
 ;              perform the query
"RTN","MAGDQR00",42,0)
 ;           2. "are you ready" call
"RTN","MAGDQR00",43,0)
 ;              value of this parameter is "n|0"
"RTN","MAGDQR00",44,0)
 ;              where 'n' identifies the result-set
"RTN","MAGDQR00",45,0)
 ;              RPC will check if the query is ready and, when available, will
"RTN","MAGDQR00",46,0)
 ;              return "initial batch" of responses
"RTN","MAGDQR00",47,0)
 ;           3. continuation call
"RTN","MAGDQR00",48,0)
 ;              value of this parameter is "n|m"
"RTN","MAGDQR00",49,0)
 ;              where 'n' identifies the result-set
"RTN","MAGDQR00",50,0)
 ;              where 'm' identifies the sequence
"RTN","MAGDQR00",51,0)
 ;              number of the first item to be returned RPC will return
"RTN","MAGDQR00",52,0)
 ;              next batch of responses
"RTN","MAGDQR00",53,0)
 ;           4. final call
"RTN","MAGDQR00",54,0)
 ;              value of this parameter is "n|-1"
"RTN","MAGDQR00",55,0)
 ;              where 'n' identifies the result-set
"RTN","MAGDQR00",56,0)
 ;              RPC will not return any responses but clean-up any storage used
"RTN","MAGDQR00",57,0)
 ;              for result-set
"RTN","MAGDQR00",58,0)
 ;
"RTN","MAGDQR00",59,0)
 ;          Suggested values for second parameter:
"RTN","MAGDQR00",60,0)
 ;            0 for initial call
"RTN","MAGDQR00",61,0)
 ;           -1 for final call
"RTN","MAGDQR00",62,0)
 ;           >0 (sequence number of first entity to be returned)
"RTN","MAGDQR00",63,0)
 ;              for continuation call
"RTN","MAGDQR00",64,0)
 ;          Result-set will also have a "time stamp of last access"
"RTN","MAGDQR00",65,0)
 ;          so that an overall clean-up process can get rid of
"RTN","MAGDQR00",66,0)
 ;          obsolete result-sets.
"RTN","MAGDQR00",67,0)
 ;
"RTN","MAGDQR00",68,0)
 ; Step 3: The application interprets the results from the RPC
"RTN","MAGDQR00",69,0)
 ;         and will ask VistA which images belong to a
"RTN","MAGDQR00",70,0)
 ;         study-UID:
"RTN","MAGDQR00",71,0)
 ;
"RTN","MAGDQR00",72,0)
 ;           RPC name: MAG STUDY UID QUERY
"RTN","MAGDQR00",73,0)
 ;             input:  scalar       study uid
"RTN","MAGDQR00",74,0)
 ;             input:  scalar       flag: include routed copies in result
"RTN","MAGDQR00",75,0)
 ;             input:  scalar       "my location" identifier
"RTN","MAGDQR00",76,0)
 ;             output: array of:    header = # of entities in response
"RTN","MAGDQR00",77,0)
 ;                                  image# | path+file name | username | password
"RTN","MAGDQR00",78,0)
 ;
"RTN","MAGDQR00",79,0)
 ;         Do we want to return the username and password in each
"RTN","MAGDQR00",80,0)
 ;         result, or do we want two separate RPC calls: one to
"RTN","MAGDQR00",81,0)
 ;         get path+filename for each file, and one that returns
"RTN","MAGDQR00",82,0)
 ;         the username and password given a path?
"RTN","MAGDQR00",83,0)
 ;
"RTN","MAGDQR00",84,0)
 ; Step 4: The application will create new DICOM entities to transmit
"RTN","MAGDQR00",85,0)
 ;         to its client. It has the information to access the
"RTN","MAGDQR00",86,0)
 ;         image files that exist on VistA (either .dcm files or
"RTN","MAGDQR00",87,0)
 ;         .txt + .tga pairs). It needs to ask VistA for the
"RTN","MAGDQR00",88,0)
 ;         current and correct information to place in the headers
"RTN","MAGDQR00",89,0)
 ;         of the DICOM entities to be transmitted:
"RTN","MAGDQR00",90,0)
 ;
"RTN","MAGDQR00",91,0)
 ;           RPC name: MAG IMAGE CURRENT INFO
"RTN","MAGDQR00",92,0)
 ;             input:  scalar       image #
"RTN","MAGDQR00",93,0)
 ;             output: array of:    header = # of entities in response
"RTN","MAGDQR00",94,0)
 ;                                  tag | VS | flag | value
"RTN","MAGDQR00",95,0)
 ;
"RTN","MAGDQR00",96,0)
 ;         Do we need an additional input array to specify the
"RTN","MAGDQR00",97,0)
 ;         list of data-fields to be returned?
"RTN","MAGDQR00",98,0)
 ;
"RTN","MAGDQR00",99,0)
 ; Non-supported tags for Query/Retrieve
"RTN","MAGDQR00",100,0)
 ; 0008,1110  O  Referenced Study Sequence
"RTN","MAGDQR00",101,0)
 ; 0008,1150  O  >Referenced SOP Class UID
"RTN","MAGDQR00",102,0)
 ; 0008,1155  O  >Referenced SOP Instance UID
"RTN","MAGDQR00",103,0)
 ; 0008,1120  O  Referenced Patient Sequence
"RTN","MAGDQR00",104,0)
 ; 0008,1150  O  >Referenced SOP Class UID
"RTN","MAGDQR00",105,0)
 ; 0008,1155  O  >Referenced SOP Instance UID
"RTN","MAGDQR00",106,0)
 ; 0010,1020  O  Patient's Size   [field not populated]
"RTN","MAGDQR00",107,0)
 ; 0010,1030  O  Patient's Weight [field not populated]
"RTN","MAGDQR00",108,0)
 ; 0020,1070  O  Other Study Numbers
"RTN","MAGDQR00",109,0)
 ; 0020,1200  O  Number of Patient Related Studies
"RTN","MAGDQR00",110,0)
 ; 0020,1202  O  Number of Patient Related Series
"RTN","MAGDQR00",111,0)
 ; 0020,1204  O  Number of Patient Related Instances
"RTN","MAGDQR00",112,0)
 ;
"RTN","MAGDQR00",113,0)
 ; Supported tags
"RTN","MAGDQR00",114,0)
 ; 0008,0020  R  Study Date
"RTN","MAGDQR00",115,0)
 ; 0008,0030  R  Study Time
"RTN","MAGDQR00",116,0)
 ; 0008,0050  R  Accession Number
"RTN","MAGDQR00",117,0)
 ; 0010,0010  R  Patient's Name
"RTN","MAGDQR00",118,0)
 ; 0010,0020  R  Patient ID
"RTN","MAGDQR00",119,0)
 ; 0020,0010  R  Study ID
"RTN","MAGDQR00",120,0)
 ; 0020,000D  U  Study Instance UID
"RTN","MAGDQR00",121,0)
 ; 0008,0018  U  Image Instance UID
"RTN","MAGDQR00",122,0)
 ; 0020,000E  U  Series Instance UID
"RTN","MAGDQR00",123,0)
 ;
"RTN","MAGDQR00",124,0)
 ; 0008,0061  O  Modalities in Study
"RTN","MAGDQR00",125,0)
 ; 0008,0090  O  Referring Physician's Name
"RTN","MAGDQR00",126,0)
 ; 0008,1030  O  Study Description
"RTN","MAGDQR00",127,0)
 ; 0008,1032  O  Procedure Code Sequence
"RTN","MAGDQR00",128,0)
 ; 0008,0100  O  >Code Value
"RTN","MAGDQR00",129,0)
 ; 0008,0102  O  >Coding Scheme Designator
"RTN","MAGDQR00",130,0)
 ; 0008,0103  O  >Coding Scheme Version
"RTN","MAGDQR00",131,0)
 ; 0008,0104  O  >Code Meaning
"RTN","MAGDQR00",132,0)
 ; 0008,1060  O  Name of Physician(s) Reading Study
"RTN","MAGDQR00",133,0)
 ; 0010,0030  O  Patient's Birth Date
"RTN","MAGDQR00",134,0)
 ; 0010,0032  O  Patient's Birth Time [probably always blank]
"RTN","MAGDQR00",135,0)
 ; 0010,0040  O  Patient's Sex
"RTN","MAGDQR00",136,0)
 ; 0010,1000  O  Other Patient IDs
"RTN","MAGDQR00",137,0)
 ; 0010,1001  O  Other Patient Names
"RTN","MAGDQR00",138,0)
 ; 0010,1010  O  Patient's Age
"RTN","MAGDQR00",139,0)
 ; 0010,2160  O  Ethnic Group
"RTN","MAGDQR00",140,0)
 ; 0010,2180  O  Occupation
"RTN","MAGDQR00",141,0)
 ; 0010,21B0  O  Additional Patient History
"RTN","MAGDQR00",142,0)
 ; 0020,1206  O  Number of Study Related Series
"RTN","MAGDQR00",143,0)
 ; 0020,1208  O  Number of Study Related Instances
"RTN","MAGDQR00",144,0)
 ; 4008,010C  O  Interpretation Author
"RTN","MAGDQR00",145,0)
 ;
"RTN","MAGDQR00",146,0)
 ; Problem cases left over:
"RTN","MAGDQR00",147,0)
 ; 0008,0062  O  SOP Classes in Study [supported?]
"RTN","MAGDQR00",148,0)
 ; 0008,1080  O  Admitting Diagnoses Description
"RTN","MAGDQR00",149,0)
 ; 0010,4000  O  Patient Comments
"RTN","MAGDQR00",150,0)
 ;
"RTN","MAGDQR01")
0^26^B45027255
"RTN","MAGDQR01",1,0)
MAGDQR01 ;WOIFO/EdM - Imaging RPCs for Query/Retrieve ; 14 Oct 2008 3:45 PM
"RTN","MAGDQR01",2,0)
 ;;3.0;IMAGING;**51,54**;03-July-2009;;Build 1424
"RTN","MAGDQR01",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDQR01",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDQR01",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDQR01",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDQR01",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDQR01",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDQR01",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDQR01",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDQR01",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDQR01",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDQR01",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDQR01",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDQR01",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDQR01",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDQR01",17,0)
 ;;
"RTN","MAGDQR01",18,0)
 Q
"RTN","MAGDQR01",19,0)
 ;
"RTN","MAGDQR01",20,0)
FIND(OUT,TAGS,RESULT,OFFSET,MAX) ; RPC = MAG CFIND QUERY
"RTN","MAGDQR01",21,0)
 N ERROR,I,N,P,REQ,T,V,X,ZTDESC,ZTDTH,ZTRTN,ZTSAVE,ZTSK
"RTN","MAGDQR01",22,0)
 ;
"RTN","MAGDQR01",23,0)
 S RESULT=$G(RESULT),OFFSET=$G(OFFSET)
"RTN","MAGDQR01",24,0)
 S ERROR=0
"RTN","MAGDQR01",25,0)
 ;
"RTN","MAGDQR01",26,0)
 I 'RESULT D  Q
"RTN","MAGDQR01",27,0)
 . ; TAGS(i) = tag | VR | flag | value
"RTN","MAGDQR01",28,0)
 . S I="" F  S I=$O(TAGS(I)) Q:I=""  D
"RTN","MAGDQR01",29,0)
 . . S X=TAGS(I),T=$P(X,"|",1) Q:T=""
"RTN","MAGDQR01",30,0)
 . . S T=$TR(T,"abcdef","ABCDEF"),$P(TAGS(I),"|",1)=T
"RTN","MAGDQR01",31,0)
 . . S V=$P(X,"|",4,$L(X)+2) S:V="*" V=""
"RTN","MAGDQR01",32,0)
 . . S:$TR(V,"UNKOW","unkow")="<unknown>" V=""
"RTN","MAGDQR01",33,0)
 . . S L=$L(V,"\") S:V="" L=0
"RTN","MAGDQR01",34,0)
 . . S REQ(T)=L F P=1:1:L S REQ(T,P)=$P(V,"\",P)
"RTN","MAGDQR01",35,0)
 . . Q
"RTN","MAGDQR01",36,0)
 . S X=0,T="" F  S T=$O(REQ(T)) Q:T=""  D  Q:X
"RTN","MAGDQR01",37,0)
 . . S P="" F  S P=$O(REQ(T,P)) Q:P=""  S:REQ(T,P)'="" X=1
"RTN","MAGDQR01",38,0)
 . . Q
"RTN","MAGDQR01",39,0)
 . D:'X ERR("No permission to query whole database.")
"RTN","MAGDQR01",40,0)
 . S T="" F  S T=$O(REQ(T)) Q:T=""  D:REQ(T)<-1 ERR("Missing required tag """_T_""".")
"RTN","MAGDQR01",41,0)
 . I ERROR D ERRLOG Q
"RTN","MAGDQR01",42,0)
 . ;
"RTN","MAGDQR01",43,0)
 . ; Convert DICOM name to VA name
"RTN","MAGDQR01",44,0)
 . ;
"RTN","MAGDQR01",45,0)
 . S T="0010,0010"
"RTN","MAGDQR01",46,0)
 . S P="" F  S P=$O(REQ(T,P)) Q:P=""  S REQ(T,P)=$$DCM2VA(REQ(T,P))
"RTN","MAGDQR01",47,0)
 . ;
"RTN","MAGDQR01",48,0)
 . ; Initialize Result Set
"RTN","MAGDQR01",49,0)
 . ;
"RTN","MAGDQR01",50,0)
 . L +^MAGDQR(2006.5732,0):1E9 ; Background process MUST wait
"RTN","MAGDQR01",51,0)
 . S X=$G(^MAGDQR(2006.5732,0))
"RTN","MAGDQR01",52,0)
 . S $P(X,"^",1,2)="DICOM QUERY RETRIEVE RESULT^2006.5732"
"RTN","MAGDQR01",53,0)
 . S RESULT=$O(^MAGDQR(2006.5732," "),-1)+1
"RTN","MAGDQR01",54,0)
 . S $P(X,"^",3)=RESULT
"RTN","MAGDQR01",55,0)
 . S $P(X,"^",4)=$P(X,"^",4)+1
"RTN","MAGDQR01",56,0)
 . S ^MAGDQR(2006.5732,0)=X
"RTN","MAGDQR01",57,0)
 . S ^MAGDQR(2006.5732,RESULT,0)=RESULT_"^IP^"_$$NOW^XLFDT()
"RTN","MAGDQR01",58,0)
 . S ^MAGDQR(2006.5732,"B",RESULT,RESULT)=""
"RTN","MAGDQR01",59,0)
 . L -^MAGDQR(2006.5732,0)
"RTN","MAGDQR01",60,0)
 . ;
"RTN","MAGDQR01",61,0)
 . ; Queue up actual query
"RTN","MAGDQR01",62,0)
 . ;
"RTN","MAGDQR01",63,0)
 . S ZTRTN="QUERY^MAGDQR02"
"RTN","MAGDQR01",64,0)
 . S ZTDESC="Perform DICOM Query, result-set="_RESULT
"RTN","MAGDQR01",65,0)
 . S ZTDTH=$H
"RTN","MAGDQR01",66,0)
 . S ZTSAVE("RESULT")=RESULT
"RTN","MAGDQR01",67,0)
 . S T="" F  S T=$O(REQ(T)) Q:T=""  D
"RTN","MAGDQR01",68,0)
 . . S ZTSAVE("REQ("""_T_""")")=REQ(T)
"RTN","MAGDQR01",69,0)
 . . S P="" F  S P=$O(REQ(T,P)) Q:P=""  S ZTSAVE("REQ("""_T_""","_P_")")=REQ(T,P)
"RTN","MAGDQR01",70,0)
 . . Q
"RTN","MAGDQR01",71,0)
 . D ^%ZTLOAD,HOME^%ZIS
"RTN","MAGDQR01",72,0)
 . D:'$G(ZTSK) ERR("TaskMan did not Accept Request")
"RTN","MAGDQR01",73,0)
 . S:$G(ZTSK) $P(^MAGDQR(2006.5732,RESULT,0),"^",4)=ZTSK
"RTN","MAGDQR01",74,0)
 . I ERROR D ERRLOG Q
"RTN","MAGDQR01",75,0)
 . D LOG("TaskMan","","0,"_RESULT_",Query Started through TaskMan")
"RTN","MAGDQR01",76,0)
 . Q
"RTN","MAGDQR01",77,0)
 ;
"RTN","MAGDQR01",78,0)
 I OFFSET<0 D  Q  ; All done, clean up result-set
"RTN","MAGDQR01",79,0)
 . D LOG("CleanUp","","1,Result Set Cleaned Up")
"RTN","MAGDQR01",80,0)
 . Q:'$D(^MAGDQR(2006.5732,RESULT))
"RTN","MAGDQR01",81,0)
 . L +^MAGDQR(2006.5732,0):1E9 ; Background process MUST wait
"RTN","MAGDQR01",82,0)
 . S X=$G(^MAGDQR(2006.5732,0))
"RTN","MAGDQR01",83,0)
 . S $P(X,"^",1,2)="DICOM QUERY RETRIEVE RESULT^2006.5732"
"RTN","MAGDQR01",84,0)
 . S:$P(X,"^",4)>0 $P(X,"^",4)=$P(X,"^",4)-1
"RTN","MAGDQR01",85,0)
 . S ^MAGDQR(2006.5732,0)=X
"RTN","MAGDQR01",86,0)
 . K ^MAGDQR(2006.5732,RESULT)
"RTN","MAGDQR01",87,0)
 . K ^MAGDQR(2006.5732,"B",RESULT)
"RTN","MAGDQR01",88,0)
 . L -^MAGDQR(2006.5732,0)
"RTN","MAGDQR01",89,0)
 . Q
"RTN","MAGDQR01",90,0)
 ;
"RTN","MAGDQR01",91,0)
 I 'OFFSET D  Q:V'="OK"  ; Is the query done?
"RTN","MAGDQR01",92,0)
 . S X=$G(^MAGDQR(2006.5732,RESULT,0))
"RTN","MAGDQR01",93,0)
 . S V=$P(X,"^",2) Q:V="OK"
"RTN","MAGDQR01",94,0)
 . I V="X" D LOG("NoResult","","-2,No result returned") S V="OK" Q
"RTN","MAGDQR01",95,0)
 . S ZTSK=$P(X,"^",4) D STAT^%ZTLOAD
"RTN","MAGDQR01",96,0)
 . I $G(ZTSK(2))'["Inactive" S OUT(1)="-1,TaskMan still active" Q
"RTN","MAGDQR01",97,0)
 . I ZTSK(2)["Finished" S V="OK" Q
"RTN","MAGDQR01",98,0)
 . D LOG("TaskManAbort",ZTSK(2),"-13,TaskMan aborted: "_ZTSK(2))
"RTN","MAGDQR01",99,0)
 . Q
"RTN","MAGDQR01",100,0)
 ;
"RTN","MAGDQR01",101,0)
 S:'$G(MAX) MAX=100
"RTN","MAGDQR01",102,0)
 S I=OFFSET,N=1 F  S I=$O(^MAGDQR(2006.5732,RESULT,1,I)) Q:'I  D  Q:N>MAX
"RTN","MAGDQR01",103,0)
 . S OFFSET=I
"RTN","MAGDQR01",104,0)
 . S N=N+1,OUT(N)=$G(^MAGDQR(2006.5732,RESULT,1,I,0))
"RTN","MAGDQR01",105,0)
 . Q
"RTN","MAGDQR01",106,0)
 I N=1 D  Q
"RTN","MAGDQR01",107,0)
 . S N=0,I=" " F  S I=$O(^MAGDQR(2006.5732,RESULT,1,I),-1) Q:'I  D  Q:'I
"RTN","MAGDQR01",108,0)
 . . S X=$G(^MAGDQR(2006.5732,RESULT,1,I,0)) Q:X'["0000,0902^Result #"
"RTN","MAGDQR01",109,0)
 . . S N=$P(X," # ",2),I=0
"RTN","MAGDQR01",110,0)
 . . Q
"RTN","MAGDQR01",111,0)
 . D LOG("Done",N,"0,No more results.")
"RTN","MAGDQR01",112,0)
 . Q
"RTN","MAGDQR01",113,0)
 I N=2,OFFSET=1 D LOG("Error",$P(OUT(2),"^",2),"")
"RTN","MAGDQR01",114,0)
 S OUT(1)=(N-1)_","_OFFSET_",result(s)."
"RTN","MAGDQR01",115,0)
 Q
"RTN","MAGDQR01",116,0)
 ;
"RTN","MAGDQR01",117,0)
DCM2VA(NAME) N I,P
"RTN","MAGDQR01",118,0)
 S NAME=$TR(NAME,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","MAGDQR01",119,0)
 ; Ignore prefixes and suffices
"RTN","MAGDQR01",120,0)
 F I=1:1:3 D
"RTN","MAGDQR01",121,0)
 . S P(I)=$P(NAME,"^",I)
"RTN","MAGDQR01",122,0)
 . F  Q:$E(P(I),1)'=" "   S P(I)=$E(P(I),2,$L(P(I)))
"RTN","MAGDQR01",123,0)
 . F  Q:$E(P(I),$L(P(I)))'=" "   S P(I)=$E(P(I),1,$L(P(I))-1)
"RTN","MAGDQR01",124,0)
 . Q
"RTN","MAGDQR01",125,0)
 S NAME=P(1)_","_P(2) S:P(3)'="" NAME=NAME_" "_P(3)
"RTN","MAGDQR01",126,0)
 S:$E(NAME,$L(NAME))="," NAME=NAME_"*"
"RTN","MAGDQR01",127,0)
 Q NAME
"RTN","MAGDQR01",128,0)
 ;
"RTN","MAGDQR01",129,0)
ERR(X) S ERROR=ERROR+1,ERROR(ERROR)=X
"RTN","MAGDQR01",130,0)
 Q
"RTN","MAGDQR01",131,0)
 ;
"RTN","MAGDQR01",132,0)
ERRLOG N I,O
"RTN","MAGDQR01",133,0)
 S O=1,I="" F  S I=$O(ERROR(I)) Q:I=""  S O=O+1,OUT(O)=ERROR(I)
"RTN","MAGDQR01",134,0)
 D LOG("Error","",(-O)_",Errors encountered")
"RTN","MAGDQR01",135,0)
 Q
"RTN","MAGDQR01",136,0)
 ;
"RTN","MAGDQR01",137,0)
ERRSAV N I,O
"RTN","MAGDQR01",138,0)
 S $P(^MAGDQR(2006.5732,RESULT,0),"^",2,3)="OK^"_$$NOW^XLFDT()
"RTN","MAGDQR01",139,0)
 K ^MAGDQR(2006.5732,RESULT,1)
"RTN","MAGDQR01",140,0)
 S O=0,I="" F  S I=$O(ERROR(I)) Q:I=""  D
"RTN","MAGDQR01",141,0)
 . S O=O+1,^MAGDQR(2006.5732,RESULT,1,O,0)="0000,0902^"_ERROR(I)
"RTN","MAGDQR01",142,0)
 . Q
"RTN","MAGDQR01",143,0)
 Q
"RTN","MAGDQR01",144,0)
 ;
"RTN","MAGDQR01",145,0)
LOG(TYP,DETAIL,TXT) N D1,D2,D3,LOC,X
"RTN","MAGDQR01",146,0)
 D:'$G(DT) DT^DICRW
"RTN","MAGDQR01",147,0)
 S D1=$O(^MAGDAUDT(2006.5733,"B",DT,""))
"RTN","MAGDQR01",148,0)
 S:'D1 D1=$$ADD($NA(^MAGDAUDT(2006.5733)),"QUERY/RETRIEVE STATISTICS",2006.57633,DT,1)
"RTN","MAGDQR01",149,0)
 ;
"RTN","MAGDQR01",150,0)
 S LOC=$G(DUZ(2)) S:'LOC LOC=$$KSP^XUPARAM("INST")
"RTN","MAGDQR01",151,0)
 S D1=$O(^MAGDAUDT(2006.5733,DT,1,"B",LOC,""))
"RTN","MAGDQR01",152,0)
 S:'D1 D1=$$ADD($NA(^MAGDAUDT(2006.5733,DT,1)),"",2006.576331,LOC,1)
"RTN","MAGDQR01",153,0)
 ;
"RTN","MAGDQR01",154,0)
 S D2=$O(^MAGDAUDT(2006.5733,DT,1,D1,1,"B",TYP,""))
"RTN","MAGDQR01",155,0)
 S:'D2 D2=$$ADD($NA(^MAGDAUDT(2006.5733,DT,1,D1,1)),"",2006.576332,TYP,0)
"RTN","MAGDQR01",156,0)
 L +^MAGDAUDT(2006.5733,DT,1,D1,1,D2):1E9 ; Background job MUST wait
"RTN","MAGDQR01",157,0)
 S X=$G(^MAGDAUDT(2006.5733,DT,1,D1,1,D2,0))
"RTN","MAGDQR01",158,0)
 S $P(X,"^",2)=$P(X,"^",2)+1
"RTN","MAGDQR01",159,0)
 S ^MAGDAUDT(2006.5733,DT,1,D1,1,D2,0)=X
"RTN","MAGDQR01",160,0)
 L -^MAGDAUDT(2006.5733,DT,1,D1,1,D2)
"RTN","MAGDQR01",161,0)
 ;
"RTN","MAGDQR01",162,0)
 D:DETAIL'=""
"RTN","MAGDQR01",163,0)
 . S D3=$O(^MAGDAUDT(2006.5733,DT,1,D1,1,D2,1,"B",DETAIL,""))
"RTN","MAGDQR01",164,0)
 . S:'D3 D3=$$ADD($NA(^MAGDAUDT(2006.5733,DT,1,D1,1,D2,1)),"",2006.576333,DETAIL,0)
"RTN","MAGDQR01",165,0)
 . L +^MAGDAUDT(2006.5733,DT,1,D1,1,D2,1,D3):1E9 ; Background job MUST wait
"RTN","MAGDQR01",166,0)
 . S X=$G(^MAGDAUDT(2006.5733,DT,1,D1,1,D2,1,D3,0))
"RTN","MAGDQR01",167,0)
 . S $P(X,"^",2)=$P(X,"^",2)+1
"RTN","MAGDQR01",168,0)
 . S ^MAGDAUDT(2006.5733,DT,1,D1,1,D2,1,D3,0)=X
"RTN","MAGDQR01",169,0)
 . L -^MAGDAUDT(2006.5733,DT,1,D1,1,D2,1,D3)
"RTN","MAGDQR01",170,0)
 . Q
"RTN","MAGDQR01",171,0)
 ;
"RTN","MAGDQR01",172,0)
 S OUT(1)=TXT
"RTN","MAGDQR01",173,0)
 Q
"RTN","MAGDQR01",174,0)
 ;
"RTN","MAGDQR01",175,0)
ADD(ROOT,F1,F2,VAL,DINUM) N D0,NAM,O,X
"RTN","MAGDQR01",176,0)
 S ROOT=$E(ROOT,1,$L(ROOT)-1)_",",NAM=ROOT_"0)",O=ROOT_""" "")"
"RTN","MAGDQR01",177,0)
 L +@NAM:1E9 ; Background job MUST wait
"RTN","MAGDQR01",178,0)
 S X=$G(@NAM)
"RTN","MAGDQR01",179,0)
 S $P(X,"^",1,2)=F1_"^"_F2
"RTN","MAGDQR01",180,0)
 S D0=$S(DINUM:+VAL,1:$O(@O,-1)+1),$P(X,"^",3)=D0
"RTN","MAGDQR01",181,0)
 S $P(X,"^",4)=$P(X,"^",4)+1
"RTN","MAGDQR01",182,0)
 S @NAM=X
"RTN","MAGDQR01",183,0)
 S @(ROOT_D0_",0)")=VAL
"RTN","MAGDQR01",184,0)
 S @(ROOT_"""B"",$P(VAL,""^"",1),D0)")=""
"RTN","MAGDQR01",185,0)
 L -@NAM
"RTN","MAGDQR01",186,0)
 Q D0
"RTN","MAGDQR01",187,0)
 ;
"RTN","MAGDQR02")
0^27^B67333649
"RTN","MAGDQR02",1,0)
MAGDQR02 ;WOIFO/EdM - Imaging RPCs for Query/Retrieve ; 07/05/2007 07:51
"RTN","MAGDQR02",2,0)
 ;;3.0;IMAGING;**51,54**;03-July-2009;;Build 1424
"RTN","MAGDQR02",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDQR02",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDQR02",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDQR02",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDQR02",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDQR02",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDQR02",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDQR02",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDQR02",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDQR02",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDQR02",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDQR02",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDQR02",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDQR02",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDQR02",17,0)
 ;;
"RTN","MAGDQR02",18,0)
 Q
"RTN","MAGDQR02",19,0)
 ;
"RTN","MAGDQR02",20,0)
QUERY ; --- perform actual query --- Called by TaskMan
"RTN","MAGDQR02",21,0)
 N ACC,ANY,FATAL,MAGD0,MAGD1,MAGD2,ERROR,FD,FT,I,IMAGE,L,LD,LT,OFFSET,P,PAT,PRMUID,SID,SSN,T,TIM,UID,V,X
"RTN","MAGDQR02",22,0)
 ;
"RTN","MAGDQR02",23,0)
 K ^TMP("MAG",$J,"QR")
"RTN","MAGDQR02",24,0)
 S (PAT,SSN,ACC,UID,SID,SDT,TIM,ERROR,FATAL)=0
"RTN","MAGDQR02",25,0)
 S FD=0,LD=9999999,FT=0,LT=240000
"RTN","MAGDQR02",26,0)
 ;
"RTN","MAGDQR02",27,0)
 S PRMUID=0 ; 0=error, 1=all, 2=oldest, 3=newest
"RTN","MAGDQR02",28,0)
 S T="0000,0902",I=0 ; Duplicate UID handling parameter
"RTN","MAGDQR02",29,0)
 S P="" F  S P=$O(REQ(T,P)) Q:P=""  D:REQ(T,P)'=""
"RTN","MAGDQR02",30,0)
 . S PRMUID=REQ(T,P)
"RTN","MAGDQR02",31,0)
 . Q
"RTN","MAGDQR02",32,0)
 K REQ(T)
"RTN","MAGDQR02",33,0)
 S:($L(PRMUID)'=1)!(123'[PRMUID) PRMUID=0
"RTN","MAGDQR02",34,0)
 ;
"RTN","MAGDQR02",35,0)
 S T="0008,0020",I=0 ; R  Study Date
"RTN","MAGDQR02",36,0)
 S P="" F  S P=$O(REQ(T,P)) Q:P=""  D:REQ(T,P)'=""
"RTN","MAGDQR02",37,0)
 . N FR,UT
"RTN","MAGDQR02",38,0)
 . S I=I+1 I I>1 D ERR^MAGDQR01("More than one study date specified.") Q
"RTN","MAGDQR02",39,0)
 . S (X,FR,UT)=REQ(T,P) S:X["-" FR=$P(X,"-",1),UT=$P(X,"-",2)
"RTN","MAGDQR02",40,0)
 . I FR'="",FR'?8N D ERR^MAGDQR01("Invalid 'from' date: """_FR_""".")
"RTN","MAGDQR02",41,0)
 . I UT'="",UT'?8N D ERR^MAGDQR01("Invalid 'until' date: """_UT_""".")
"RTN","MAGDQR02",42,0)
 . S FD=+FR S:FD FD=FD-17000000
"RTN","MAGDQR02",43,0)
 . S LD=+UT S:LD LD=LD-17000000
"RTN","MAGDQR02",44,0)
 . S TIM=1
"RTN","MAGDQR02",45,0)
 . Q
"RTN","MAGDQR02",46,0)
 ;
"RTN","MAGDQR02",47,0)
 S T="0008,0030",I=0 ; R  Study Time
"RTN","MAGDQR02",48,0)
 S P="" F  S P=$O(REQ(T,P)) Q:P=""  D:REQ(T,P)'=""
"RTN","MAGDQR02",49,0)
 . N FR,UT
"RTN","MAGDQR02",50,0)
 . S I=I+1 I I>1 D ERR^MAGDQR01("More than one study time specified.") Q
"RTN","MAGDQR02",51,0)
 . S (X,FR,UT)=REQ(T,P) S:X["-" FR=$P(X,"-",1),UT=$P(X,"-",2)
"RTN","MAGDQR02",52,0)
 . D CHKTIM(FR,"from")
"RTN","MAGDQR02",53,0)
 . D CHKTIM(UT,"until")
"RTN","MAGDQR02",54,0)
 . S FT=+$E(FR_"000000",1,6)
"RTN","MAGDQR02",55,0)
 . S LT=+$E(UT_"000000",1,6)
"RTN","MAGDQR02",56,0)
 . S TIM=1
"RTN","MAGDQR02",57,0)
 . Q
"RTN","MAGDQR02",58,0)
 I ERROR D ERRSAV^MAGDQR01 Q
"RTN","MAGDQR02",59,0)
 ;
"RTN","MAGDQR02",60,0)
 S FD=FT/1E6+FD,LD=LT/1E6+LD
"RTN","MAGDQR02",61,0)
 ;
"RTN","MAGDQR02",62,0)
 S T="0010,0010",ANY=0 ; R  Patient's Name
"RTN","MAGDQR02",63,0)
 S P="" F  S P=$O(REQ(T,P)) Q:P=""  D:REQ(T,P)'=""
"RTN","MAGDQR02",64,0)
 . ; The references below to ^DPT are permitted according to the
"RTN","MAGDQR02",65,0)
 . ; explicit permission in Section II of the PIMS V5.3 technical manual
"RTN","MAGDQR02",66,0)
 . ; (dated 23 Nov 2004)
"RTN","MAGDQR02",67,0)
 . S ANY=1
"RTN","MAGDQR02",68,0)
 . S I=$$MATCHD^MAGDQR03(REQ(T,P),"^DPT(""B"",LOOP)","^TMP(""MAG"",$J,""QR"",1,LOOP)")
"RTN","MAGDQR02",69,0)
 . S V="" F  S V=$O(^TMP("MAG",$J,"QR",1,V)) Q:V=""  D
"RTN","MAGDQR02",70,0)
 . . S I="" F  S I=$O(^DPT("B",V,I)) Q:I=""  S ^TMP("MAG",$J,"QR",2,I)="",PAT=1
"RTN","MAGDQR02",71,0)
 . . Q
"RTN","MAGDQR02",72,0)
 . Q
"RTN","MAGDQR02",73,0)
 I ANY,'PAT D  Q
"RTN","MAGDQR02",74,0)
 . D ERR^MAGDQR01("No matches for tag "_T)
"RTN","MAGDQR02",75,0)
 . D ERRSAV^MAGDQR01
"RTN","MAGDQR02",76,0)
 . Q
"RTN","MAGDQR02",77,0)
 ;
"RTN","MAGDQR02",78,0)
 S T="0010,0020",ANY=0 ; R  Patient ID
"RTN","MAGDQR02",79,0)
 S P="" F  S P=$O(REQ(T,P)) Q:P=""  D:REQ(T,P)'=""
"RTN","MAGDQR02",80,0)
 . ; The references below to ^DPT are permitted according to the
"RTN","MAGDQR02",81,0)
 . ; explicit permission in Section II of the PIMS V5.3 technical manual
"RTN","MAGDQR02",82,0)
 . ; (dated 23 Nov 2004)
"RTN","MAGDQR02",83,0)
 . S ANY=1
"RTN","MAGDQR02",84,0)
 . S I=$$MATCHD^MAGDQR03($TR(REQ(T,P),"-"),"^DPT(""SSN"",LOOP)","^TMP(""MAG"",$J,""QR"",3,LOOP)")
"RTN","MAGDQR02",85,0)
 . S V="" F  S V=$O(^TMP("MAG",$J,"QR",3,V)) Q:V=""  D
"RTN","MAGDQR02",86,0)
 . . S I="" F  S I=$O(^DPT("SSN",V,I)) Q:I=""  S ^TMP("MAG",$J,"QR",4,I)="",SSN=1
"RTN","MAGDQR02",87,0)
 . . Q
"RTN","MAGDQR02",88,0)
 . Q
"RTN","MAGDQR02",89,0)
 I ANY,'SSN D  Q
"RTN","MAGDQR02",90,0)
 . D ERR^MAGDQR01("No matches for tag "_T)
"RTN","MAGDQR02",91,0)
 . D ERRSAV^MAGDQR01
"RTN","MAGDQR02",92,0)
 . Q
"RTN","MAGDQR02",93,0)
 ;
"RTN","MAGDQR02",94,0)
 S T="0008,0050",ANY=0 ; R  Accession Number
"RTN","MAGDQR02",95,0)
 D ACCNUM^MAGDQR07
"RTN","MAGDQR02",96,0)
 I ANY,'ACC D  Q
"RTN","MAGDQR02",97,0)
 . D ERR^MAGDQR01("No matches for tag "_T)
"RTN","MAGDQR02",98,0)
 . D ERRSAV^MAGDQR01
"RTN","MAGDQR02",99,0)
 . Q
"RTN","MAGDQR02",100,0)
 ;
"RTN","MAGDQR02",101,0)
 S T="0020,0010",ANY=0 ; R  Study ID
"RTN","MAGDQR02",102,0)
 D STUDYID^MAGDQR07
"RTN","MAGDQR02",103,0)
 I ANY,'SID D  Q
"RTN","MAGDQR02",104,0)
 . D ERR^MAGDQR01("No matches for tag "_T)
"RTN","MAGDQR02",105,0)
 . D ERRSAV^MAGDQR01
"RTN","MAGDQR02",106,0)
 . Q
"RTN","MAGDQR02",107,0)
 ;
"RTN","MAGDQR02",108,0)
 D  I ANY,'UID Q
"RTN","MAGDQR02",109,0)
 . N OK,UIDS
"RTN","MAGDQR02",110,0)
 . D UIDS^MAGDQR08
"RTN","MAGDQR02",111,0)
 . Q:'ANY  Q:OK
"RTN","MAGDQR02",112,0)
 . S UID=0
"RTN","MAGDQR02",113,0)
 . D ERR^MAGDQR01("Conflicting UIDs: "_UIDS)
"RTN","MAGDQR02",114,0)
 . D ERRSAV^MAGDQR01
"RTN","MAGDQR02",115,0)
 . Q
"RTN","MAGDQR02",116,0)
 ;
"RTN","MAGDQR02",117,0)
 I TIM,'(PAT+SSN+SID+UID+ACC) D TIM^MAGDQR05
"RTN","MAGDQR02",118,0)
 ;
"RTN","MAGDQR02",119,0)
 I '(PAT+SSN+SID+UID+ACC) D  Q
"RTN","MAGDQR02",120,0)
 . D ERR^MAGDQR01("No Selection Specified.")
"RTN","MAGDQR02",121,0)
 . D ERRSAV^MAGDQR01
"RTN","MAGDQR02",122,0)
 . Q
"RTN","MAGDQR02",123,0)
 ;
"RTN","MAGDQR02",124,0)
 D ELIM(ACC,SID,6,10,"Accession and Study ID",0)
"RTN","MAGDQR02",125,0)
 M ^TMP("MAG",$J,"QR",12)=^TMP("MAG",$J,"QR",6)
"RTN","MAGDQR02",126,0)
 M ^TMP("MAG",$J,"QR",12)=^TMP("MAG",$J,"QR",10)
"RTN","MAGDQR02",127,0)
 ;
"RTN","MAGDQR02",128,0)
 D ELIM(PAT,SSN,2,4,"Patient Name and ID",0)
"RTN","MAGDQR02",129,0)
 M ^TMP("MAG",$J,"QR",11)=^TMP("MAG",$J,"QR",2)
"RTN","MAGDQR02",130,0)
 M ^TMP("MAG",$J,"QR",11)=^TMP("MAG",$J,"QR",4)
"RTN","MAGDQR02",131,0)
 ;
"RTN","MAGDQR02",132,0)
 D ELIMB(PAT+SSN,ACC+SID,11,12,"Patient and Study Info")
"RTN","MAGDQR02",133,0)
 I ERROR D ERRSAV^MAGDQR01 Q
"RTN","MAGDQR02",134,0)
 ;
"RTN","MAGDQR02",135,0)
 K ^TMP("MAG",$J,"DICOMQR")
"RTN","MAGDQR02",136,0)
 S ^TMP("MAG",$J,"DICOMQR","RESULTSET")=0
"RTN","MAGDQR02",137,0)
 S ^TMP("MAG",$J,"DICOMQR","DUMMY SIUID")=0
"RTN","MAGDQR02",138,0)
 D
"RTN","MAGDQR02",139,0)
 . I UID D  Q
"RTN","MAGDQR02",140,0)
 . . S IMAGE="" F  S IMAGE=$O(^TMP("MAG",$J,"QR",8,IMAGE)) Q:IMAGE=""  D  Q:FATAL
"RTN","MAGDQR02",141,0)
 . . . S X=$G(^MAG(2005,IMAGE,0)),P=+$P(X,"^",7)
"RTN","MAGDQR02",142,0)
 . . . I PAT+SSN,P,'$D(^TMP("MAG",$J,"QR",11,P)) Q
"RTN","MAGDQR02",143,0)
 . . . S X=$G(^MAG(2005,IMAGE,2))
"RTN","MAGDQR02",144,0)
 . . . S V=$P(X,"^",5) I V,(V<FD)!(V>LD) Q
"RTN","MAGDQR02",145,0)
 . . . S V=$P(X,"^",6)
"RTN","MAGDQR02",146,0)
 . . . ; Radiology Image
"RTN","MAGDQR02",147,0)
 . . . I V=74 D  Q  ; Radiology Image
"RTN","MAGDQR02",148,0)
 . . . . S X=$G(^RARPT(+$P(X,"^",7),0)) ; IA # 1171
"RTN","MAGDQR02",149,0)
 . . . . S MAGD0=$P(X,"^",2),MAGD1=9999999.9999-$P(X,"^",3),V=$P(X,"^",4)
"RTN","MAGDQR02",150,0)
 . . . . S MAGD2=$O(^RADPT(MAGD0,"DT",MAGD1,"P","B",V,"")) ; IA # 1172
"RTN","MAGDQR02",151,0)
 . . . . I ACC+SID,'$D(^TMP("MAG",$J,"QR",12,"R^"_MAGD0_"^"_MAGD1_"^"_MAGD2)) Q
"RTN","MAGDQR02",152,0)
 . . . . D RESULT^MAGDQR03("R",RESULT,IMAGE,MAGD0,MAGD1,MAGD2)
"RTN","MAGDQR02",153,0)
 . . . . Q
"RTN","MAGDQR02",154,0)
 . . . ; Consult Image
"RTN","MAGDQR02",155,0)
 . . . I (V=8925)!(V=2006.5839) D RESULT^MAGDQR03("C",RESULT,IMAGE,P) Q
"RTN","MAGDQR02",156,0)
 . . . Q
"RTN","MAGDQR02",157,0)
 . . Q
"RTN","MAGDQR02",158,0)
 . ;
"RTN","MAGDQR02",159,0)
 . I ACC+SID D ACCSID^MAGDQR07 Q
"RTN","MAGDQR02",160,0)
 . ;
"RTN","MAGDQR02",161,0)
 . I PAT+SSN D  Q
"RTN","MAGDQR02",162,0)
 . . S P="" F  S P=$O(^TMP("MAG",$J,"QR",11,P)) Q:P=""  D  Q:FATAL
"RTN","MAGDQR02",163,0)
 . . . S IMAGE="" F  S IMAGE=$O(^MAG(2005,"AC",P,IMAGE)) Q:IMAGE=""  D  Q:FATAL
"RTN","MAGDQR02",164,0)
 . . . . Q:$P($G(^MAG(2005,IMAGE,0)),"^",10)
"RTN","MAGDQR02",165,0)
 . . . . S X=$G(^MAG(2005,IMAGE,2))
"RTN","MAGDQR02",166,0)
 . . . . S V=$P(X,"^",5) I V,(V<FD)!(V>LD) Q
"RTN","MAGDQR02",167,0)
 . . . . S V=$P(X,"^",6)
"RTN","MAGDQR02",168,0)
 . . . . I V=74 D  Q  ; Radiology Image
"RTN","MAGDQR02",169,0)
 . . . . . S V=$P(X,"^",5) I V,(V<FD)!(V>LD) Q
"RTN","MAGDQR02",170,0)
 . . . . . S X=$G(^RARPT(+$P(X,"^",7),0)) ; IA # 1171
"RTN","MAGDQR02",171,0)
 . . . . . S MAGD0=$P(X,"^",2),MAGD1=9999999.9999-$P(X,"^",3),V=$P(X,"^",4)
"RTN","MAGDQR02",172,0)
 . . . . . S MAGD2=$O(^RADPT(MAGD0,"DT",MAGD1,"P","B",V,"")) ; IA # 1172
"RTN","MAGDQR02",173,0)
 . . . . . I ACC+SID,'$D(^TMP("MAG",$J,"QR",12,"R^"_MAGD0_"^"_MAGD1_"^"_MAGD2)) Q
"RTN","MAGDQR02",174,0)
 . . . . . D RESULT^MAGDQR03("R",RESULT,IMAGE,MAGD0,MAGD1,MAGD2)
"RTN","MAGDQR02",175,0)
 . . . . . Q
"RTN","MAGDQR02",176,0)
 . . . . I (V=8925)!(V=2006.5839) D  Q  ; Consult Image
"RTN","MAGDQR02",177,0)
 . . . . . S MAGD0=+$P($G(^MAG(2005,IMAGE,0)),"^",7)
"RTN","MAGDQR02",178,0)
 . . . . . D RESULT^MAGDQR03("C",RESULT,IMAGE,MAGD0)
"RTN","MAGDQR02",179,0)
 . . . . . Q
"RTN","MAGDQR02",180,0)
 . . . . Q
"RTN","MAGDQR02",181,0)
 . . . Q
"RTN","MAGDQR02",182,0)
 . . Q
"RTN","MAGDQR02",183,0)
 . Q
"RTN","MAGDQR02",184,0)
 ;
"RTN","MAGDQR02",185,0)
 D:$O(PRMUID(""))'="" PRUNE^MAGDQR08 ; There are duplicate UIDs
"RTN","MAGDQR02",186,0)
 S $P(^MAGDQR(2006.5732,RESULT,0),"^",2,3)="OK^"_$$NOW^XLFDT()
"RTN","MAGDQR02",187,0)
 K ^TMP("MAG",$J,"QR")
"RTN","MAGDQR02",188,0)
 K ^TMP("MAG",$J,"DICOMQR")
"RTN","MAGDQR02",189,0)
 Q
"RTN","MAGDQR02",190,0)
 ;
"RTN","MAGDQR02",191,0)
CHKTIM(V,L) ;
"RTN","MAGDQR02",192,0)
 Q:V=""
"RTN","MAGDQR02",193,0)
 I V'?1.6N D ERR^MAGDQR01("Invalid '"_L_"' time: """_V_""".")
"RTN","MAGDQR02",194,0)
 I $E(V,1,2)>23 D ERR^MAGDQR01("Invalid hours in '"_L_"' time: """_V_""".")
"RTN","MAGDQR02",195,0)
 I $E(V,3,4),$E(V,3,4)>59 D ERR^MAGDQR01("Invalid minutes in '"_L_"' time: """_V_""".")
"RTN","MAGDQR02",196,0)
 I $E(V,5,6),$E(V,5,6)>59 D ERR^MAGDQR01("Invalid seconds '"_L_"' time: """_V_""".")
"RTN","MAGDQR02",197,0)
 Q
"RTN","MAGDQR02",198,0)
 ;
"RTN","MAGDQR02",199,0)
ELIM(ONE,TWO,I1,I2,E,C) N ANY,I,O
"RTN","MAGDQR02",200,0)
 Q:'ONE  Q:'TWO
"RTN","MAGDQR02",201,0)
 S I="" F  S I=$O(^TMP("MAG",$J,"QR",I1,I)) Q:I=""  D
"RTN","MAGDQR02",202,0)
 . S O=I I C Q:I'["^"  S O=+I
"RTN","MAGDQR02",203,0)
 . I '$D(^TMP("MAG",$J,"QR",I2,O)) K ^TMP("MAG",$J,"QR",I1,I)
"RTN","MAGDQR02",204,0)
 . Q
"RTN","MAGDQR02",205,0)
 S I="" F  S I=$O(^TMP("MAG",$J,"QR",I2,I)) Q:I=""  D
"RTN","MAGDQR02",206,0)
 . S O=I I C Q:I'["^"  S O=+I
"RTN","MAGDQR02",207,0)
 . I '$D(^TMP("MAG",$J,"QR",I1,O)) K ^TMP("MAG",$J,"QR",I2,I)
"RTN","MAGDQR02",208,0)
 . Q
"RTN","MAGDQR02",209,0)
 S ANY=($D(^TMP("MAG",$J,"QR",I1))>9)*($D(^TMP("MAG",$J,"QR",I2))>9)
"RTN","MAGDQR02",210,0)
 D:'ANY ERR^MAGDQR01("No matches left, conflict between "_E)
"RTN","MAGDQR02",211,0)
 Q
"RTN","MAGDQR02",212,0)
 ;
"RTN","MAGDQR02",213,0)
ELIMB(ONE,TWO,I1,I2,E) N ANY,I,O
"RTN","MAGDQR02",214,0)
 ; elimination logic between subtrees w/different data structures,
"RTN","MAGDQR02",215,0)
 ; e.g., 11 (I1) and 12 (I2)
"RTN","MAGDQR02",216,0)
 N HIT ; match flag
"RTN","MAGDQR02",217,0)
 Q:'ONE  Q:'TWO
"RTN","MAGDQR02",218,0)
 S I="" F  S I=$O(^TMP("MAG",$J,"QR",I1,I)) Q:I=""  D
"RTN","MAGDQR02",219,0)
 . S O="",HIT=0
"RTN","MAGDQR02",220,0)
 . ; match?
"RTN","MAGDQR02",221,0)
 . F  S O=$O(^TMP("MAG",$J,"QR",I2,O)) Q:O=""  I $P(O,"^",2)=I S HIT=1 Q  ; yes
"RTN","MAGDQR02",222,0)
 . K:'HIT ^TMP("MAG",$J,"QR",I1,I) ; no
"RTN","MAGDQR02",223,0)
 . Q
"RTN","MAGDQR02",224,0)
 S I="" F  S I=$O(^TMP("MAG",$J,"QR",I2,I)) Q:I=""  D
"RTN","MAGDQR02",225,0)
 . S O=$P(I,"^",2) I O,$D(^TMP("MAG",$J,"QR",I1,O)) Q  ; match
"RTN","MAGDQR02",226,0)
 . K ^TMP("MAG",$J,"QR",I2,I) ; no match
"RTN","MAGDQR02",227,0)
 . Q
"RTN","MAGDQR02",228,0)
 S ANY=($D(^TMP("MAG",$J,"QR",I1))>9)*($D(^TMP("MAG",$J,"QR",I2))>9)
"RTN","MAGDQR02",229,0)
 D:'ANY ERR^MAGDQR01("No matches left, conflict between "_E)
"RTN","MAGDQR02",230,0)
 Q
"RTN","MAGDQR02",231,0)
 ;
"RTN","MAGDQR03")
0^28^B150326376
"RTN","MAGDQR03",1,0)
MAGDQR03 ;WOIFO/EdM - Imaging RPCs for Query/Retrieve ; 01 Dec 2008 11:18 AM
"RTN","MAGDQR03",2,0)
 ;;3.0;IMAGING;**51,54**;03-July-2009;;Build 1424
"RTN","MAGDQR03",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDQR03",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDQR03",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDQR03",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDQR03",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDQR03",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDQR03",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDQR03",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDQR03",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDQR03",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDQR03",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDQR03",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDQR03",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDQR03",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDQR03",17,0)
 ;;
"RTN","MAGDQR03",18,0)
 Q
"RTN","MAGDQR03",19,0)
 ;
"RTN","MAGDQR03",20,0)
 ; When RESULT^MAGDQR03 is called, the following input parameters
"RTN","MAGDQR03",21,0)
 ; should be properly defined:
"RTN","MAGDQR03",22,0)
 ;   TYPE   = R(adiology) or C(onsult)
"RTN","MAGDQR03",23,0)
 ;   RESULT = pointer into results global (#2006.5732)
"RTN","MAGDQR03",24,0)
 ;   MAGIEN = pointer into the Image File (#2005)
"RTN","MAGDQR03",25,0)
 ;   MAGDFN = pointer into the Patient File (#2)
"RTN","MAGDQR03",26,0)
 ;   MAGRORD = second level pointer into the Rad/Nuc Med Patient File (#70)
"RTN","MAGDQR03",27,0)
 ;             (Radiology orders only)
"RTN","MAGDQR03",28,0)
 ;   MAGINTERP = third level pointer into the Rad/Nuc Med Patient File (#70)
"RTN","MAGDQR03",29,0)
 ;             (Radiology orders only) 
"RTN","MAGDQR03",30,0)
 ; 
"RTN","MAGDQR03",31,0)
 ; This routine contains code to calculate values for DICOM Tags
"RTN","MAGDQR03",32,0)
 ; that can be derived from those two pointers.
"RTN","MAGDQR03",33,0)
 ; All other DICOM Tags are computed in MAGDQR06.
"RTN","MAGDQR03",34,0)
 ; (This routine does the things that are the same for all images.
"RTN","MAGDQR03",35,0)
 ; MAGDQR06 differentiates between Radiology, Consults, and anything else.)
"RTN","MAGDQR03",36,0)
 ;
"RTN","MAGDQR03",37,0)
RESULT(TYPE,RESULT,MAGIEN,MAGDFN,MAGRORD,MAGINTERP) ;
"RTN","MAGDQR03",38,0)
 ; validate input parameters
"RTN","MAGDQR03",39,0)
 I "^R^C^"'[("^"_TYPE_"^") D ERR^MAGDQR01("Study type (radiology/consult) not defined") Q
"RTN","MAGDQR03",40,0)
 I '$G(RESULT) D ERR^MAGDQR01("Invalid query result set "_RESULT_" specified") Q
"RTN","MAGDQR03",41,0)
 I $D(MAGIEN),$D(^MAG(2005,MAGIEN))
"RTN","MAGDQR03",42,0)
 E  D ERR^MAGDQR01("Invalid image ID "_MAGIEN_" specified for result") Q
"RTN","MAGDQR03",43,0)
 I $D(MAGDFN),$D(^DPT(MAGDFN))
"RTN","MAGDQR03",44,0)
 E  D ERR^MAGDQR01("Invalid patient ID "_MAGDFN_" specified for result") Q
"RTN","MAGDQR03",45,0)
 I TYPE="R",'$G(MAGRORD) D  Q
"RTN","MAGDQR03",46,0)
 . D ERR^MAGDQR01("Invalid Radiology order number "_MAGRORD_" specified")
"RTN","MAGDQR03",47,0)
 . Q
"RTN","MAGDQR03",48,0)
 I TYPE="R",'$G(MAGINTERP) D  Q
"RTN","MAGDQR03",49,0)
 . D ERR^MAGDQR01("Invalid Radiology interpretation "_MAGINTERP_" specified")
"RTN","MAGDQR03",50,0)
 . Q
"RTN","MAGDQR03",51,0)
 ;
"RTN","MAGDQR03",52,0)
 N E,L,OK,V,X,T
"RTN","MAGDQR03",53,0)
 N SENSEMP ; ----- sensitive/employee flag
"RTN","MAGDQR03",54,0)
 S SENSEMP=0,OK=1
"RTN","MAGDQR03",55,0)
 ;
"RTN","MAGDQR03",56,0)
 ; new specs for sens/emp patients 3/20/09 - data will be picked up, but scrubbed
"RTN","MAGDQR03",57,0)
 ;
"RTN","MAGDQR03",58,0)
 S SENSEMP=SENSEMP+($$EMPL^DGSEC4(MAGDFN)=1) ; IA #3646
"RTN","MAGDQR03",59,0)
 S SENSEMP=SENSEMP+($P($G(^DGSL(38.1,MAGDFN,0)),"^",2)=1) ; IA #767
"RTN","MAGDQR03",60,0)
 ; increment (static) dummy Study Instance UID if sensitive/employee
"RTN","MAGDQR03",61,0)
 S:SENSEMP ^("DUMMY SIUID")=^TMP("MAG",$J,"DICOMQR","DUMMY SIUID")+1
"RTN","MAGDQR03",62,0)
 ;
"RTN","MAGDQR03",63,0)
 ; retrieve element values, indicate unsupported elements
"RTN","MAGDQR03",64,0)
 S T="" F  S T=$O(REQ(T)) Q:T=""  D
"RTN","MAGDQR03",65,0)
 . S L=$TR(T,",")
"RTN","MAGDQR03",66,0)
 . S E=$TR($E(L,1),"0123456789abcdef","QRSTUVWXYZABCDEF")
"RTN","MAGDQR03",67,0)
 . S $E(L,1)=E S:L'?8UN L=""
"RTN","MAGDQR03",68,0)
 . I L'="",$T(@L)'="" D @L S V(T)=$G(V(T)) Q
"RTN","MAGDQR03",69,0)
 . ; unsupported tag <> fatal error
"RTN","MAGDQR03",70,0)
 . D ERR^MAGDQR01("Cannot calculate value for tag: """_T_""".") S ERROR=0
"RTN","MAGDQR03",71,0)
 . Q
"RTN","MAGDQR03",72,0)
 ;
"RTN","MAGDQR03",73,0)
 I ERROR D ERRSAV^MAGDQR01 S FATAL=1 Q
"RTN","MAGDQR03",74,0)
 ;
"RTN","MAGDQR03",75,0)
 Q:'OK  ; don't return result on key mismatch
"RTN","MAGDQR03",76,0)
 ;
"RTN","MAGDQR03",77,0)
 D  Q:'OK  ; There must be a valid Study Instance UID
"RTN","MAGDQR03",78,0)
 . N V,T
"RTN","MAGDQR03",79,0)
 . S T="0020,000D" D Q020000D
"RTN","MAGDQR03",80,0)
 . S OK=(V(T)'="")
"RTN","MAGDQR03",81,0)
 . Q
"RTN","MAGDQR03",82,0)
 ;
"RTN","MAGDQR03",83,0)
 S ^("RESULTSET")=^TMP("MAG",$J,"DICOMQR","RESULTSET")+1
"RTN","MAGDQR03",84,0)
 D
"RTN","MAGDQR03",85,0)
 . N RSLTHDR,R1,V1,V2,VAL
"RTN","MAGDQR03",86,0)
 . S RSLTHDR="0000,0902^Result # "_^TMP("MAG",$J,"DICOMQR","RESULTSET")
"RTN","MAGDQR03",87,0)
 . S R1=$O(^MAGDQR(2006.5732,RESULT,1," "),-1)+1
"RTN","MAGDQR03",88,0)
 . S ^MAGDQR(2006.5732,RESULT,1,R1,0)=RSLTHDR
"RTN","MAGDQR03",89,0)
 . S VAL=$G(^MAG(2005,MAGIEN,2))\1
"RTN","MAGDQR03",90,0)
 . S ^TMP("MAG",$J,"QR",99,VAL_" "_MAGDFN,R1)=MAGIEN
"RTN","MAGDQR03",91,0)
 . S T="" F  S T=$O(V(T)) Q:T=""  D
"RTN","MAGDQR03",92,0)
 . . S VAL=$G(V(T))
"RTN","MAGDQR03",93,0)
 . . S V1="" F  S V1=$O(V(T,V1)) Q:V1=""  D
"RTN","MAGDQR03",94,0)
 . . . Q:$G(V(T,V1))=""
"RTN","MAGDQR03",95,0)
 . . . S:VAL'="" VAL=VAL_"\" S VAL=VAL_V(T,V1)
"RTN","MAGDQR03",96,0)
 . . . Q
"RTN","MAGDQR03",97,0)
 . . S R1=R1+1,^MAGDQR(2006.5732,RESULT,1,R1,0)=T_"^"_VAL
"RTN","MAGDQR03",98,0)
 . . S ^MAGDQR(2006.5732,RESULT,1,"B",T,R1)=""
"RTN","MAGDQR03",99,0)
 . . Q:$D(V(T))<10
"RTN","MAGDQR03",100,0)
 . . S V1="" F  S V1=$O(V(T,V1)) Q:V1=""  D
"RTN","MAGDQR03",101,0)
 . . . S V2="" F  S V2=$O(V(T,V1,V2)) Q:V2=""  D
"RTN","MAGDQR03",102,0)
 . . . . S VAL=$G(V(T,V1,V2)) Q:VAL=""
"RTN","MAGDQR03",103,0)
 . . . . S R1=R1+1,^MAGDQR(2006.5732,RESULT,1,R1,0)=T_"^"_VAL
"RTN","MAGDQR03",104,0)
 . . . . S ^MAGDQR(2006.5732,RESULT,1,"B",T,R1)=""
"RTN","MAGDQR03",105,0)
 . . . . Q
"RTN","MAGDQR03",106,0)
 . . . Q
"RTN","MAGDQR03",107,0)
 . . Q
"RTN","MAGDQR03",108,0)
 . Q
"RTN","MAGDQR03",109,0)
 Q
"RTN","MAGDQR03",110,0)
 ;
"RTN","MAGDQR03",111,0)
COMPARE(TAG,ACTUAL) N LOC,TMP,WILD
"RTN","MAGDQR03",112,0)
 Q:'$G(REQ(TAG)) 1
"RTN","MAGDQR03",113,0)
 S WILD=$G(REQ(TAG,1)) Q:WILD="" 0
"RTN","MAGDQR03",114,0)
 Q:$G(ACTUAL)="" 0
"RTN","MAGDQR03",115,0)
 S LOC(ACTUAL)=""
"RTN","MAGDQR03",116,0)
 Q $$MATCHD(WILD,"LOC(LOOP)","TMP(LOOP)")
"RTN","MAGDQR03",117,0)
 ;
"RTN","MAGDQR03",118,0)
MATCH1(X,Y) N I,M
"RTN","MAGDQR03",119,0)
 F  Q:X=""  Q:Y=""  D
"RTN","MAGDQR03",120,0)
 . I $E(X,1)=$E(Y,1) S X=$E(X,2,$L(X)),Y=$E(Y,2,$L(Y)) Q
"RTN","MAGDQR03",121,0)
 . I $E(Y,1)="?" S X=$E(X,2,$L(X)),Y=$E(Y,2,$L(Y)) Q
"RTN","MAGDQR03",122,0)
 . I $E(Y,1)="*" D  Q:M
"RTN","MAGDQR03",123,0)
 . . I Y="*" S (X,Y)="",M=1 Q
"RTN","MAGDQR03",124,0)
 . . S Y=$E(Y,2,$L(Y)),M=0
"RTN","MAGDQR03",125,0)
 . . F I=1:1:$L(X) I $$MATCH1($E(X,I,$L(X)),Y) S M=1,X=$E(X,I,$L(X)) Q
"RTN","MAGDQR03",126,0)
 . . Q
"RTN","MAGDQR03",127,0)
 . S X="!",Y=""
"RTN","MAGDQR03",128,0)
 . Q
"RTN","MAGDQR03",129,0)
 S:$TR(Y,"*")="" Y="" Q:X'="" 0 Q:Y'="" 0
"RTN","MAGDQR03",130,0)
 Q 1
"RTN","MAGDQR03",131,0)
 ;
"RTN","MAGDQR03",132,0)
MATCHD(WILDCARD,STRUCTUR,FOUND) N C,LOOP,L1,L9,SEEK,X,Y
"RTN","MAGDQR03",133,0)
 ;  -- Scans a structure,
"RTN","MAGDQR03",134,0)
 ;     reports entries in @STRUCTUR that match WILDCARD;
"RTN","MAGDQR03",135,0)
 ;     the result is reported in local array @FOUND
"RTN","MAGDQR03",136,0)
 S C=0
"RTN","MAGDQR03",137,0)
 S L1=$P($P(WILDCARD,"?",1),"*",1),L9=L1_"~"
"RTN","MAGDQR03",138,0)
 I L1=WILDCARD D  Q C
"RTN","MAGDQR03",139,0)
 . S LOOP=L1
"RTN","MAGDQR03",140,0)
 . I $D(@STRUCTUR) S @FOUND="",C=C+1 Q
"RTN","MAGDQR03",141,0)
 . Q
"RTN","MAGDQR03",142,0)
 S LOOP=L1 F  D  S LOOP=$O(@STRUCTUR) Q:LOOP=""  Q:LOOP]]L9
"RTN","MAGDQR03",143,0)
 . Q:LOOP=""  Q:'$D(@STRUCTUR)
"RTN","MAGDQR03",144,0)
 . Q:'$$MATCH1(LOOP,WILDCARD)
"RTN","MAGDQR03",145,0)
 . S @FOUND="",C=C+1
"RTN","MAGDQR03",146,0)
 . Q
"RTN","MAGDQR03",147,0)
 Q C
"RTN","MAGDQR03",148,0)
 ;
"RTN","MAGDQR03",149,0)
Q0080018 ;U Image Instance UID
"RTN","MAGDQR03",150,0)
 ; sensitive/employee?
"RTN","MAGDQR03",151,0)
 I SENSEMP D  Q  ; yes, scrub
"RTN","MAGDQR03",152,0)
 . S V(T)="1.2.840.113754.2.1.3.1.1.1.1.66."_$G(^TMP("MAG",$J,"DICOMQR","DUMMY SIUID"))
"RTN","MAGDQR03",153,0)
 . Q
"RTN","MAGDQR03",154,0)
 ; no
"RTN","MAGDQR03",155,0)
 N SOPUID
"RTN","MAGDQR03",156,0)
 I MAGIEN="" S V(T)="" Q
"RTN","MAGDQR03",157,0)
 S V(T)=$P($G(^MAG(2005,MAGIEN,"PACS")),"^",1)
"RTN","MAGDQR03",158,0)
 S SOPUID=$P($G(^MAG(2005,MAGIEN,"SOP")),"^",2)
"RTN","MAGDQR03",159,0)
 S:SOPUID'="" V(T)=SOPUID
"RTN","MAGDQR03",160,0)
 Q
"RTN","MAGDQR03",161,0)
 ;
"RTN","MAGDQR03",162,0)
Q0080020 ;R Study Date
"RTN","MAGDQR03",163,0)
 ; sensitive/employee?
"RTN","MAGDQR03",164,0)
 I SENSEMP D  Q  ; yes, scrub
"RTN","MAGDQR03",165,0)
 . N I,REQDT S I=$O(REQ(T,"")) S:I REQDT=$TR($P($G(REQ(T,I)),"-",1),"*")
"RTN","MAGDQR03",166,0)
 . S V(T)=$S($G(REQDT)?8N:REQDT,1:$$DT^XLFDT+17000000)
"RTN","MAGDQR03",167,0)
 . Q
"RTN","MAGDQR03",168,0)
 ; no
"RTN","MAGDQR03",169,0)
 I MAGIEN="" S V(T)="" Q
"RTN","MAGDQR03",170,0)
 S V(T)=$P($G(^MAG(2005,MAGIEN,2)),"^",5)\1+17000000
"RTN","MAGDQR03",171,0)
 Q
"RTN","MAGDQR03",172,0)
 ;
"RTN","MAGDQR03",173,0)
Q0080030 ;R  Study Time
"RTN","MAGDQR03",174,0)
 ; sensitive/employee?
"RTN","MAGDQR03",175,0)
 I SENSEMP D  Q  ; yes, scrub
"RTN","MAGDQR03",176,0)
 . N I,REQTM S I=$O(REQ(T,"")) S:I REQTM=$TR($P($G(REQ(T,I)),"-",1),"*")
"RTN","MAGDQR03",177,0)
 . S V(T)=$S($G(REQTM)?6N:REQTM,1:$E($P($$NOW^XLFDT,".",2)_"000000",1,6))
"RTN","MAGDQR03",178,0)
 . Q
"RTN","MAGDQR03",179,0)
 ; no
"RTN","MAGDQR03",180,0)
 I MAGIEN="" S V(T)="" Q
"RTN","MAGDQR03",181,0)
 S V(T)=$TR($J("."_$P($P($G(^MAG(2005,MAGIEN,2)),"^",5),".",2)*1E6,6)," ",0)
"RTN","MAGDQR03",182,0)
 Q
"RTN","MAGDQR03",183,0)
 ;
"RTN","MAGDQR03",184,0)
Q0080050 D Q0080050^MAGDQR06 ;R  Accession Number
"RTN","MAGDQR03",185,0)
 Q
"RTN","MAGDQR03",186,0)
 ;
"RTN","MAGDQR03",187,0)
Q0100010 ;R  Patient's Name
"RTN","MAGDQR03",188,0)
 ; No IA needed, PIMS 5.3
"RTN","MAGDQR03",189,0)
 S V(T)=$S('SENSEMP:$P($G(^DPT(MAGDFN,0)),"^",1),1:"IMAGPATIENT,SENSITIVE")
"RTN","MAGDQR03",190,0)
 Q
"RTN","MAGDQR03",191,0)
 ;
"RTN","MAGDQR03",192,0)
Q0100020 ;R  Patient ID
"RTN","MAGDQR03",193,0)
 ; No IA needed, PIMS 5.3
"RTN","MAGDQR03",194,0)
 S V(T)=$S('SENSEMP:$P($G(^DPT(MAGDFN,0)),"^",9),1:"000001234")
"RTN","MAGDQR03",195,0)
 Q
"RTN","MAGDQR03",196,0)
 ;
"RTN","MAGDQR03",197,0)
Q0200010 D Q0200010^MAGDQR06 ;R  Study ID
"RTN","MAGDQR03",198,0)
 Q
"RTN","MAGDQR03",199,0)
 ;
"RTN","MAGDQR03",200,0)
Q020000D ;U  Study Instance UID
"RTN","MAGDQR03",201,0)
 ; sensitive/employee?
"RTN","MAGDQR03",202,0)
 I SENSEMP D  Q  ; yes, scrub
"RTN","MAGDQR03",203,0)
 . S V(T)="1.2.840.113754.2.1.3.1.1.66."_$G(^TMP("MAG",$J,"DICOMQR","DUMMY SIUID"))
"RTN","MAGDQR03",204,0)
 . Q
"RTN","MAGDQR03",205,0)
 ; no
"RTN","MAGDQR03",206,0)
 I MAGIEN="" S V(T)="" Q
"RTN","MAGDQR03",207,0)
 N PARENT
"RTN","MAGDQR03",208,0)
 S PARENT=$P($G(^MAG(2005,MAGIEN,0)),"^",10)
"RTN","MAGDQR03",209,0)
 S:'PARENT PARENT=MAGIEN
"RTN","MAGDQR03",210,0)
 S V(T)=$P($G(^MAG(2005,PARENT,"PACS")),"^",1)
"RTN","MAGDQR03",211,0)
 Q
"RTN","MAGDQR03",212,0)
 ;
"RTN","MAGDQR03",213,0)
Q020000E ;U  Series Instance UID
"RTN","MAGDQR03",214,0)
 ; sensitive/employee?
"RTN","MAGDQR03",215,0)
 I SENSEMP D  Q  ; yes, scrub
"RTN","MAGDQR03",216,0)
 . S V(T)="1.2.840.113754.2.1.3.1.1.1.66."_$G(^TMP("MAG",$J,"DICOMQR","DUMMY SIUID"))
"RTN","MAGDQR03",217,0)
 . Q
"RTN","MAGDQR03",218,0)
 ; no
"RTN","MAGDQR03",219,0)
 I MAGIEN="" S V(T)="" Q
"RTN","MAGDQR03",220,0)
 S V(T)=$P($G(^MAG(2005,MAGIEN,"SERIESUID")),"^",1)
"RTN","MAGDQR03",221,0)
 Q
"RTN","MAGDQR03",222,0)
 ;
"RTN","MAGDQR03",223,0)
Q0080052 ;O  Query Level
"RTN","MAGDQR03",224,0)
 N I
"RTN","MAGDQR03",225,0)
 S I=$O(REQ(T,"")),V(T)=""
"RTN","MAGDQR03",226,0)
 S:I V(T)=$G(REQ(T,I))
"RTN","MAGDQR03",227,0)
 Q
"RTN","MAGDQR03",228,0)
 ;
"RTN","MAGDQR03",229,0)
Q0080061 ;O  Modalities in Study
"RTN","MAGDQR03",230,0)
 ; sensitive/employee?
"RTN","MAGDQR03",231,0)
 I SENSEMP D  Q  ; yes, scrub
"RTN","MAGDQR03",232,0)
 . N I
"RTN","MAGDQR03",233,0)
 . S I=$O(REQ(T,""))
"RTN","MAGDQR03",234,0)
 . S V(T)="OT" I I,$G(REQ(T,I))]"" S V(T)=REQ(T,I)
"RTN","MAGDQR03",235,0)
 . Q
"RTN","MAGDQR03",236,0)
 ; no
"RTN","MAGDQR03",237,0)
 N ANY,I1,I2,LIST,MOD,P1,P2,R,TMP
"RTN","MAGDQR03",238,0)
 I MAGIEN="" S V(T)="" Q
"RTN","MAGDQR03",239,0)
 ;
"RTN","MAGDQR03",240,0)
 S I1="" F  S I1=$O(REQ(T,I1)) Q:I1=""  D
"RTN","MAGDQR03",241,0)
 . S R=$TR(REQ(T,I1),"/","\")
"RTN","MAGDQR03",242,0)
 . F I2=1:1:$L(R,"\") S X=$P(R,"\",I2) S:X'="" LIST(X)=1
"RTN","MAGDQR03",243,0)
 . Q
"RTN","MAGDQR03",244,0)
 ;
"RTN","MAGDQR03",245,0)
 S X=$P($G(^MAG(2005,MAGIEN,0)),"^",8) S:$E(X,1,4)="RAD " X=$E(X,5,$L(X))
"RTN","MAGDQR03",246,0)
 S:X'="" MOD(X)=""
"RTN","MAGDQR03",247,0)
 S R="",P1=0 F  S P1=$O(^MAG(2005,MAGIEN,1,P1)) Q:'P1  D
"RTN","MAGDQR03",248,0)
 . S P2=+$G(^MAG(2005,MAGIEN,1,P1,0)) Q:'P2
"RTN","MAGDQR03",249,0)
 . S X=$P($G(^MAG(2005,P2,0)),"^",8)
"RTN","MAGDQR03",250,0)
 . S:$E(X,1,4)="RAD " X=$E(X,5,$L(X))
"RTN","MAGDQR03",251,0)
 . S:X'="" MOD(X)=""
"RTN","MAGDQR03",252,0)
 . Q
"RTN","MAGDQR03",253,0)
 S R="",ANY=0,X="" F  S X=$O(MOD(X)) Q:X=""  D
"RTN","MAGDQR03",254,0)
 . D  ; filter out consult-related noise
"RTN","MAGDQR03",255,0)
 . . Q:$E(X,1,7)="CONSULT"  Q:X="CON/PROC"
"RTN","MAGDQR03",256,0)
 . . S:R'="" R=R_"," S R=R_X
"RTN","MAGDQR03",257,0)
 . . Q
"RTN","MAGDQR03",258,0)
 . I $O(LIST(""))="" S ANY=1 Q
"RTN","MAGDQR03",259,0)
 . S I1="" F  S I1=$O(LIST(I1)) Q:I1=""  D  Q:ANY
"RTN","MAGDQR03",260,0)
 . . S:$$MATCHD(X,"LIST(LOOP)","TMP(LOOP)") ANY=1
"RTN","MAGDQR03",261,0)
 . . Q
"RTN","MAGDQR03",262,0)
 . Q
"RTN","MAGDQR03",263,0)
 S V(T)=R
"RTN","MAGDQR03",264,0)
 S:'ANY OK=0
"RTN","MAGDQR03",265,0)
 Q
"RTN","MAGDQR03",266,0)
 ;
"RTN","MAGDQR03",267,0)
Q0080062 D Q0080062^MAGDQR06 ;O  SOP Classes in Study
"RTN","MAGDQR03",268,0)
 Q
"RTN","MAGDQR03",269,0)
 ;
"RTN","MAGDQR03",270,0)
Q0080090 D Q0080090^MAGDQR06 ;O  Referring Physician's Name
"RTN","MAGDQR03",271,0)
 Q
"RTN","MAGDQR03",272,0)
 ;
"RTN","MAGDQR03",273,0)
Q0081030 D Q0081030^MAGDQR06 ;O  Study Description
"RTN","MAGDQR03",274,0)
 Q
"RTN","MAGDQR03",275,0)
 ;
"RTN","MAGDQR03",276,0)
Q0081032 ;O  Procedure Code Sequence
"RTN","MAGDQR03",277,0)
 Q
"RTN","MAGDQR03",278,0)
 ;
"RTN","MAGDQR03",279,0)
Q0080100 D Q0080100^MAGDQR06 ;O  >Code Value
"RTN","MAGDQR03",280,0)
 Q
"RTN","MAGDQR03",281,0)
 ;
"RTN","MAGDQR03",282,0)
Q0080102 ;O  >Coding Scheme Designator
"RTN","MAGDQR03",283,0)
 S V("0008,1030",1,T)="C4"
"RTN","MAGDQR03",284,0)
 Q
"RTN","MAGDQR03",285,0)
 ;
"RTN","MAGDQR03",286,0)
Q0080103 ;O  >Coding Scheme Version
"RTN","MAGDQR03",287,0)
 S V("0008,1030",1,T)=4
"RTN","MAGDQR03",288,0)
 Q
"RTN","MAGDQR03",289,0)
 ;
"RTN","MAGDQR03",290,0)
Q0080104 D Q0080104^MAGDQR06 ;O  >Code Meaning
"RTN","MAGDQR03",291,0)
 Q
"RTN","MAGDQR03",292,0)
 ;
"RTN","MAGDQR03",293,0)
Q0081060 D Q0081060^MAGDQR06 ;O  Name of Physician(s) Reading Study
"RTN","MAGDQR03",294,0)
 Q
"RTN","MAGDQR03",295,0)
 ;
"RTN","MAGDQR03",296,0)
Q0081080 D Q0081080^MAGDQR06 ;O  Admitting Diagnosis Description
"RTN","MAGDQR03",297,0)
 Q
"RTN","MAGDQR03",298,0)
 ;
"RTN","MAGDQR03",299,0)
Q0100021 ;O  Issuer of Patient ID
"RTN","MAGDQR03",300,0)
 S V(T)="USSSA"
"RTN","MAGDQR03",301,0)
 S:'$$COMPARE(T,V(T)) OK=0
"RTN","MAGDQR03",302,0)
 Q
"RTN","MAGDQR03",303,0)
 ;
"RTN","MAGDQR03",304,0)
Q0100030 ;O  Patient's Birth Date
"RTN","MAGDQR03",305,0)
 ; sensitive/employee?
"RTN","MAGDQR03",306,0)
 I SENSEMP D  Q  ; yes, scrub
"RTN","MAGDQR03",307,0)
 . N I,REQDT S I=$O(REQ(T,"")) S:I REQDT=$TR($P($G(REQ(T,I)),"-",1),"*")
"RTN","MAGDQR03",308,0)
 . S V(T)=$S($G(REQDT)?8N:REQDT,1:$$DT^XLFDT+17000000)
"RTN","MAGDQR03",309,0)
 . Q
"RTN","MAGDQR03",310,0)
 ; no
"RTN","MAGDQR03",311,0)
 S V(T)=$P($G(^DPT(MAGDFN,0)),"^",3)\1+17000000
"RTN","MAGDQR03",312,0)
 I $E(V(T),5,6)="00" S V(T)="" ; invalid month for DICOM
"RTN","MAGDQR03",313,0)
 I $E(V(T),7,8)="00" S V(T)="" ; invalid year for DICOM
"RTN","MAGDQR03",314,0)
 S:'$$COMPARE(T,V(T)) OK=0
"RTN","MAGDQR03",315,0)
 Q
"RTN","MAGDQR03",316,0)
 ;
"RTN","MAGDQR03",317,0)
Q0100032 ;O  Patient's Birth Time
"RTN","MAGDQR03",318,0)
 ; sensitive/employee?
"RTN","MAGDQR03",319,0)
 I SENSEMP D  Q  ; yes, scrub
"RTN","MAGDQR03",320,0)
 . N I,REQTM S I=$O(REQ(T,"")) S:I REQTM=$TR($P($G(REQ(T,I)),"-",1),"*")
"RTN","MAGDQR03",321,0)
 . S V(T)=$S($G(REQTM)?6N:REQTM,1:$E($P($$NOW^XLFDT,".",2)_"000000",1,6))
"RTN","MAGDQR03",322,0)
 . Q
"RTN","MAGDQR03",323,0)
 ; no
"RTN","MAGDQR03",324,0)
 S V(T)=$TR($J("."_$P($P($G(^DPT(MAGDFN,0)),"^",3),".",2)*1E6,6)," ",0)
"RTN","MAGDQR03",325,0)
 S:V(T)="000000" V(T)="" ; no time on file
"RTN","MAGDQR03",326,0)
 S:'$$COMPARE(T,V(T)) OK=0
"RTN","MAGDQR03",327,0)
 Q
"RTN","MAGDQR03",328,0)
 ;
"RTN","MAGDQR03",329,0)
Q0100040 ;O  Patient's Sex
"RTN","MAGDQR03",330,0)
 ; sensitive/employee?
"RTN","MAGDQR03",331,0)
 I SENSEMP D  Q  ; yes, scrub
"RTN","MAGDQR03",332,0)
 . N I S I=$O(REQ(T,"")) S V(T)=$S(I:$S($G(REQ(T,I))]"":REQ(T,I),1:"O"),1:"O")
"RTN","MAGDQR03",333,0)
 . Q
"RTN","MAGDQR03",334,0)
 ; no
"RTN","MAGDQR03",335,0)
 S V(T)=$P($G(^DPT(MAGDFN,0)),"^",2)
"RTN","MAGDQR03",336,0)
 S:'$$COMPARE(T,V(T)) OK=0
"RTN","MAGDQR03",337,0)
 Q
"RTN","MAGDQR03",338,0)
 ;
"RTN","MAGDQR03",339,0)
Q0101000 ;O  Other Patient IDs
"RTN","MAGDQR03",340,0)
 ; sensitive/employee?
"RTN","MAGDQR03",341,0)
 I SENSEMP S V(T)="000001234" Q  ; yes, scrub
"RTN","MAGDQR03",342,0)
 ; no
"RTN","MAGDQR03",343,0)
 N DFN,I,VA,VADPT
"RTN","MAGDQR03",344,0)
 S DFN=MAGDFN D DEM^VADPT
"RTN","MAGDQR03",345,0)
 S X=$P(^DPT(DFN,0),"^",9) S:X'="" DFN(X)=""
"RTN","MAGDQR03",346,0)
 S:$G(VA("PID"))'="" DFN(VA("PID"))=""
"RTN","MAGDQR03",347,0)
 S:$G(VA("BID"))'="" DFN(VA("BID"))=""
"RTN","MAGDQR03",348,0)
 S X=$$GETICN^MPIF001(DFN) S:X'="" DFN(X)=""
"RTN","MAGDQR03",349,0)
 S I=0,X="" F  S X=$O(DFN(X)) Q:X=""  S I=I+1,V(T,I)=X
"RTN","MAGDQR03",350,0)
 ;;;S:'$$COMPARE(T,V(T)) OK=0
"RTN","MAGDQR03",351,0)
 Q
"RTN","MAGDQR03",352,0)
 ;
"RTN","MAGDQR03",353,0)
Q0101001 ;O  Other Patient Names
"RTN","MAGDQR03",354,0)
 ; sensitive/employee?
"RTN","MAGDQR03",355,0)
 I SENSEMP S V(T)="IMAGPATIENT,SENSITIVE" Q  ; yes, scrub
"RTN","MAGDQR03",356,0)
 ; no
"RTN","MAGDQR03",357,0)
 N D1,I
"RTN","MAGDQR03",358,0)
 S (I,D1)=0 F  S D1=$O(^DPT(MAGDFN,0.01,D1)) Q:'D1  D
"RTN","MAGDQR03",359,0)
 . S X=$P($G(^DPT(MAGDFN,0.01,D1,0)),"^",1)
"RTN","MAGDQR03",360,0)
 . S:X'="" I=I+1,V(T,I)=X
"RTN","MAGDQR03",361,0)
 . Q
"RTN","MAGDQR03",362,0)
 ;;;S:'$$COMPARE(T,V(T)) OK=0
"RTN","MAGDQR03",363,0)
 Q
"RTN","MAGDQR03",364,0)
 ;
"RTN","MAGDQR03",365,0)
Q0101010 ;O  Patient's Age
"RTN","MAGDQR03",366,0)
 ; sensitive/employee?
"RTN","MAGDQR03",367,0)
 I SENSEMP D  Q  ; yes, scrub
"RTN","MAGDQR03",368,0)
 . N I S I=$O(REQ(T,"")) S:I V(T)=$S($G(REQ(T,I))]"":REQ(T,I),1:"")
"RTN","MAGDQR03",369,0)
 . Q
"RTN","MAGDQR03",370,0)
 ; no
"RTN","MAGDQR03",371,0)
 N DOB,FROM,YEARS
"RTN","MAGDQR03",372,0)
 S DOB=$P($G(^DPT(MAGDFN,0)),"^",3)
"RTN","MAGDQR03",373,0)
 S FROM=$P($G(^DPT(MAGDFN,.35)),"^",1) S:'FROM FROM=DT
"RTN","MAGDQR03",374,0)
 S YEARS=$E(FROM,1,3)-$E(DOB,1,3)
"RTN","MAGDQR03",375,0)
 S:$E(FROM,4,7)<$E(DOB,4,7) YEARS=YEARS-1
"RTN","MAGDQR03",376,0)
 S V(T)=($P($J(YEARS/1000,0,3),".",2))_"Y"
"RTN","MAGDQR03",377,0)
 ;;;S:'$$COMPARE(T,V(T)) OK=0
"RTN","MAGDQR03",378,0)
 Q
"RTN","MAGDQR03",379,0)
 ;
"RTN","MAGDQR03",380,0)
Q0101020 ;O  Patient's Size
"RTN","MAGDQR03",381,0)
 ; sensitive/employee?
"RTN","MAGDQR03",382,0)
 I SENSEMP D  Q  ; yes, scrub
"RTN","MAGDQR03",383,0)
 . N I S I=$O(REQ(T,"")) S:I V(T)=$S($G(REQ(T,I))]"":REQ(T,I),1:"")
"RTN","MAGDQR03",384,0)
 . Q
"RTN","MAGDQR03",385,0)
 ; no
"RTN","MAGDQR03",386,0)
 S V(T)=$P($G(^DPT(MAGDFN,57)),"^",1) ; height in cm - field not populated
"RTN","MAGDQR03",387,0)
 S:'$$COMPARE(T,V(T)) OK=0
"RTN","MAGDQR03",388,0)
 Q
"RTN","MAGDQR03",389,0)
 ;
"RTN","MAGDQR03",390,0)
Q0101030 ;O  Patient's Weight
"RTN","MAGDQR03",391,0)
 ; sensitive/employee?
"RTN","MAGDQR03",392,0)
 I SENSEMP D  Q  ; yes, scrub
"RTN","MAGDQR03",393,0)
 . N I S I=$O(REQ(T,"")) S:I V(T)=$S($G(REQ(T,I))]"":REQ(T,I),1:"")
"RTN","MAGDQR03",394,0)
 . Q
"RTN","MAGDQR03",395,0)
 ; no
"RTN","MAGDQR03",396,0)
 S V(T)=$P($G(^DPT(MAGDFN,57)),"^",2) ; weight in kg - field not populated
"RTN","MAGDQR03",397,0)
 S:'$$COMPARE(T,V(T)) OK=0
"RTN","MAGDQR03",398,0)
 Q
"RTN","MAGDQR03",399,0)
 ;
"RTN","MAGDQR03",400,0)
Q0102160 ;O  Ethnic Group
"RTN","MAGDQR03",401,0)
 ; sensitive/employee?
"RTN","MAGDQR03",402,0)
 I SENSEMP D  Q  ; yes, scrub
"RTN","MAGDQR03",403,0)
 . N I S I=$O(REQ(T,"")) S:I V(T)=$S($G(REQ(T,I))]"":REQ(T,I),1:"")
"RTN","MAGDQR03",404,0)
 . Q
"RTN","MAGDQR03",405,0)
 ; no
"RTN","MAGDQR03",406,0)
 S V(T)=$P($G(^DPT(MAGDFN,0)),"^",6)
"RTN","MAGDQR03",407,0)
 S:'$$COMPARE(T,V(T)) OK=0
"RTN","MAGDQR03",408,0)
 Q
"RTN","MAGDQR03",409,0)
 ;
"RTN","MAGDQR03",410,0)
Q0102180 ;O  Occupation
"RTN","MAGDQR03",411,0)
 ; sensitive/employee?
"RTN","MAGDQR03",412,0)
 I SENSEMP D  Q  ; yes, scrub
"RTN","MAGDQR03",413,0)
 . N I S I=$O(REQ(T,"")) S:I V(T)=$S($G(REQ(T,I))]"":REQ(T,I),1:"")
"RTN","MAGDQR03",414,0)
 . Q
"RTN","MAGDQR03",415,0)
 ; no
"RTN","MAGDQR03",416,0)
 S V(T)=$P($G(^DPT(MAGDFN,0)),"^",7)
"RTN","MAGDQR03",417,0)
 S:'$$COMPARE(T,V(T)) OK=0
"RTN","MAGDQR03",418,0)
 Q
"RTN","MAGDQR03",419,0)
 ;
"RTN","MAGDQR03",420,0)
Q01021B0 D Q01021B0^MAGDQR06 ;O  Additional Patient History
"RTN","MAGDQR03",421,0)
 Q
"RTN","MAGDQR03",422,0)
 ;
"RTN","MAGDQR03",423,0)
Q0104000 D Q0104000^MAGDQR06 ;O  Patient Comments
"RTN","MAGDQR03",424,0)
 Q
"RTN","MAGDQR03",425,0)
 ;
"RTN","MAGDQR03",426,0)
Q0201206 ;O  Number of Study Related Series
"RTN","MAGDQR03",427,0)
 ; sensitive/employee?
"RTN","MAGDQR03",428,0)
 I SENSEMP D  Q  ; yes, scrub
"RTN","MAGDQR03",429,0)
 . N I S I=$O(REQ(T,"")) S:I V(T)=$S($G(REQ(T,I))]"":REQ(T,I),1:"")
"RTN","MAGDQR03",430,0)
 . Q
"RTN","MAGDQR03",431,0)
 ; no
"RTN","MAGDQR03",432,0)
 N N,S,UID
"RTN","MAGDQR03",433,0)
 S UID=$G(V("0020,000D")),N=0
"RTN","MAGDQR03",434,0)
 I UID'=""  S S="" F  S S=$O(^MAG(2005,"P",UID,S)) Q:S=""  S N=N+1
"RTN","MAGDQR03",435,0)
 S V(T)=N
"RTN","MAGDQR03",436,0)
 S:'$$COMPARE(T,V(T)) OK=0
"RTN","MAGDQR03",437,0)
 Q
"RTN","MAGDQR03",438,0)
 ;
"RTN","MAGDQR03",439,0)
Q0201208 ;O  Number of Study Related Instances
"RTN","MAGDQR03",440,0)
 ; sensitive/employee?
"RTN","MAGDQR03",441,0)
 I SENSEMP D  Q  ; yes, scrub
"RTN","MAGDQR03",442,0)
 . N I S I=$O(REQ(T,"")) S:I V(T)=$S($G(REQ(T,I))]"":REQ(T,I),1:"")
"RTN","MAGDQR03",443,0)
 . Q
"RTN","MAGDQR03",444,0)
 ; no
"RTN","MAGDQR03",445,0)
 N N,P1,P2,S,UID
"RTN","MAGDQR03",446,0)
 S UID=$G(V("0020,000D")),N=0
"RTN","MAGDQR03",447,0)
 I UID'=""  S S="" F  S S=$O(^MAG(2005,"P",UID,S)) Q:S=""  D
"RTN","MAGDQR03",448,0)
 . S P1=0 F  S P1=$O(^MAG(2005,S,1,P1)) Q:'P1  D
"RTN","MAGDQR03",449,0)
 . . S P2=+$G(^MAG(2005,S,1,P1,0)) Q:'P2
"RTN","MAGDQR03",450,0)
 . . S N=N+1
"RTN","MAGDQR03",451,0)
 . . Q
"RTN","MAGDQR03",452,0)
 . Q
"RTN","MAGDQR03",453,0)
 S V(T)=N
"RTN","MAGDQR03",454,0)
 S:'$$COMPARE(T,V(T)) OK=0
"RTN","MAGDQR03",455,0)
 Q
"RTN","MAGDQR03",456,0)
 ;
"RTN","MAGDQR03",457,0)
U008010C D U008010C^MAGDQR06 ;O  Interpretation Author
"RTN","MAGDQR03",458,0)
 Q
"RTN","MAGDQR03",459,0)
 ;
"RTN","MAGDQR04")
0^29^B73426432
"RTN","MAGDQR04",1,0)
MAGDQR04 ;WOIFO/EdM - Imaging RPCs for Query/Retrieve ; 08 Aug 2008 9:26 AM
"RTN","MAGDQR04",2,0)
 ;;3.0;IMAGING;**51,54**;03-July-2009;;Build 1424
"RTN","MAGDQR04",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDQR04",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDQR04",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDQR04",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDQR04",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDQR04",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDQR04",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDQR04",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDQR04",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDQR04",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDQR04",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDQR04",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDQR04",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDQR04",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDQR04",17,0)
 ;;
"RTN","MAGDQR04",18,0)
 Q
"RTN","MAGDQR04",19,0)
 ;
"RTN","MAGDQR04",20,0)
STUDY(OUT,UID,PRMUID) ; RPC = MAG STUDY UID QUERY
"RTN","MAGDQR04",21,0)
 N D1,F1,F2,F3,F4,F5,F6,IMAGE,N,NET,PASS,PAT,PAT0,SERIES,USER,X
"RTN","MAGDQR04",22,0)
 I $G(UID)="" S OUT(1)="-1,No UID specified." Q
"RTN","MAGDQR04",23,0)
 I UID'?1.64(1N,1".") S OUT(1)="-2,Invalid UID format: """_UID_"""." Q
"RTN","MAGDQR04",24,0)
 S PRMUID=$G(PRMUID) S:($L(PRMUID)'=1)!(123'[PRMUID) PRMUID=0
"RTN","MAGDQR04",25,0)
 S N=1,PAT=""
"RTN","MAGDQR04",26,0)
 S SERIES="" F  S SERIES=$O(^MAG(2005,"P",UID,SERIES)) Q:SERIES=""  D
"RTN","MAGDQR04",27,0)
 . S X=$G(^MAG(2005,SERIES,0))
"RTN","MAGDQR04",28,0)
 . S PAT0=$P(X,"^",7) D:PAT0
"RTN","MAGDQR04",29,0)
 . . I PAT="" S PAT=PAT0 Q
"RTN","MAGDQR04",30,0)
 . . Q:PRMUID=1
"RTN","MAGDQR04",31,0)
 . . S:PAT'=PAT0 PAT=-1
"RTN","MAGDQR04",32,0)
 . . Q
"RTN","MAGDQR04",33,0)
 . I $P(X,"^",10) D VALID(SERIES) Q
"RTN","MAGDQR04",34,0)
 . S D1=0 F  S D1=$O(^MAG(2005,SERIES,1,D1)) Q:'D1  D
"RTN","MAGDQR04",35,0)
 . . S IMAGE=+$G(^MAG(2005,SERIES,1,D1,0)) D:IMAGE VALID(IMAGE)
"RTN","MAGDQR04",36,0)
 . . Q
"RTN","MAGDQR04",37,0)
 . Q
"RTN","MAGDQR04",38,0)
 I PAT<0 S OUT(1)="-13,Duplicate Study UID" Q
"RTN","MAGDQR04",39,0)
 S SERIES="" F  S SERIES=$O(^MAG(2005,"SERIESUID",UID,SERIES)) Q:SERIES=""  D
"RTN","MAGDQR04",40,0)
 . I $P($G(^MAG(2005,SERIES,0)),"^",10) D VALID(SERIES) Q
"RTN","MAGDQR04",41,0)
 . S D1=0 F  S D1=$O(^MAG(2005,SERIES,1,D1)) Q:'D1  D
"RTN","MAGDQR04",42,0)
 . . S IMAGE=+$G(^MAG(2005,SERIES,1,D1,0)) D:IMAGE VALID(IMAGE)
"RTN","MAGDQR04",43,0)
 . . Q
"RTN","MAGDQR04",44,0)
 . Q
"RTN","MAGDQR04",45,0)
 S X=" image" S:N'=2 X=X_"s" S X=X_" found"
"RTN","MAGDQR04",46,0)
 S OUT(1)=(N-1)_X
"RTN","MAGDQR04",47,0)
 Q
"RTN","MAGDQR04",48,0)
 ;
"RTN","MAGDQR04",49,0)
VALID(IMAGE) N T,UID,UNIQ
"RTN","MAGDQR04",50,0)
 N DATE,Q,T1,T2,T3
"RTN","MAGDQR04",51,0)
 D CHK^MAGGSQI(.X,IMAGE) I +$G(X(0))'=1 D  Q
"RTN","MAGDQR04",52,0)
 . S N=N+1,OUT(N)=IMAGE_"^-13,Questionable Integrity"
"RTN","MAGDQR04",53,0)
 . Q
"RTN","MAGDQR04",54,0)
 S UNIQ=0,UID=$P($G(^MAG(2005,IMAGE,"PACS")),"^",1) D:UID'=""
"RTN","MAGDQR04",55,0)
 . S T="" F  S T=$O(^MAG(2005,"P",UID,T)) Q:T=""  D
"RTN","MAGDQR04",56,0)
 . . S UNIQ=UNIQ+1
"RTN","MAGDQR04",57,0)
 . . S DATE($G(^MAG(2005,T,2))\1_" ",T)=""
"RTN","MAGDQR04",58,0)
 . . Q
"RTN","MAGDQR04",59,0)
 . Q
"RTN","MAGDQR04",60,0)
 S Q=0 I UNIQ>1 D  Q:Q
"RTN","MAGDQR04",61,0)
 . Q:PRMUID=1
"RTN","MAGDQR04",62,0)
 . I PRMUID=0 S Q=1,N=N+1,OUT(N)=IMAGE_"^-14,Multiple images with UID="""_UID_"""." Q
"RTN","MAGDQR04",63,0)
 . S DATE=$O(DATE(""),-PRMUID*2+5) S:DATE="" DATE="?"
"RTN","MAGDQR04",64,0)
 . S:'$D(DATE(DATE,IMAGE)) Q=1
"RTN","MAGDQR04",65,0)
 . Q
"RTN","MAGDQR04",66,0)
 S NET=$P($G(^MAG(2005,IMAGE,0)),"^",3),(USER,PASS)=""
"RTN","MAGDQR04",67,0)
 I NET S X=$G(^MAG(2005.2,NET,2)),USER=$P(X,"^",1),PASS=$P(X,"^",2)
"RTN","MAGDQR04",68,0)
 D FILEFIND^MAGDFB(IMAGE,"FULL",0,0,.F1,.F2,.F3)
"RTN","MAGDQR04",69,0)
 D FILEFIND^MAGDFB(IMAGE,"BIG",0,0,.T1,.T2,.T3)
"RTN","MAGDQR04",70,0)
 S:T2'<0 F2=T2
"RTN","MAGDQR04",71,0)
 D FILEFIND^MAGDFB(IMAGE,"TEXT",0,0,.F4,.F5,.F6)
"RTN","MAGDQR04",72,0)
 S N=N+1,OUT(N)=IMAGE_"^"_F2_"^"_USER_"^"_PASS_"^"_F5
"RTN","MAGDQR04",73,0)
 Q
"RTN","MAGDQR04",74,0)
 ;
"RTN","MAGDQR04",75,0)
INFO(OUT,IMAGE) ; RPC = MAG IMAGE CURRENT INFO
"RTN","MAGDQR04",76,0)
 ;
"RTN","MAGDQR04",77,0)
 ; 0008,0018  SOP Instance UID (Create new one, if needed)
"RTN","MAGDQR04",78,0)
 ; 0008,0020  Study Date
"RTN","MAGDQR04",79,0)
 ; 0008,0050  Accession Number
"RTN","MAGDQR04",80,0)
 ; 0008,0060  Modality
"RTN","MAGDQR04",81,0)
 ; 0008,0090  Referring Physician's Name
"RTN","MAGDQR04",82,0)
 ; 0008,1030  Study Description (may be VA procedure name)
"RTN","MAGDQR04",83,0)
 ; 0008,1050  Performing (attending) Physician
"RTN","MAGDQR04",84,0)
 ; 0010,0010  Patient Name
"RTN","MAGDQR04",85,0)
 ; 0010,0020  Patient ID
"RTN","MAGDQR04",86,0)
 ; 0010,0030  Patient's Birth Date
"RTN","MAGDQR04",87,0)
 ; 0010,0040  Patient's Sex
"RTN","MAGDQR04",88,0)
 ; 0010,1000  Other Patient IDs (= ICN, Integration Control Number)
"RTN","MAGDQR04",89,0)
 ; 0010,1040  Address
"RTN","MAGDQR04",90,0)
 ; 0010,2160  Ethnic Group
"RTN","MAGDQR04",91,0)
 ; 0010,2000  Medical Alerts
"RTN","MAGDQR04",92,0)
 ; 0020,000D  Study Instance UID
"RTN","MAGDQR04",93,0)
 ; 0020,000E  Series Instance UID
"RTN","MAGDQR04",94,0)
 ; 0020,000D  Study Instance UID
"RTN","MAGDQR04",95,0)
 ; 0032,1032  Requesting Physician
"RTN","MAGDQR04",96,0)
 ; 0032,1033  Requesting Service
"RTN","MAGDQR04",97,0)
 ; 0032,1060  Requested Procedure Description (CPT name)
"RTN","MAGDQR04",98,0)
 ; 0032,1064  Requested Procedure Code Sequence
"RTN","MAGDQR04",99,0)
 ; 0008,0100  > Code Value (CPT code)
"RTN","MAGDQR04",100,0)
 ; 0008,0102  > Coding Scheme Designator ("C4")
"RTN","MAGDQR04",101,0)
 ; 0008,0104  > Code Meaning (CPT name)
"RTN","MAGDQR04",102,0)
 ; 0038,0300  Current Patient Location (ward)
"RTN","MAGDQR04",103,0)
 ; 0032,1020  Scheduled Study Location
"RTN","MAGDQR04",104,0)
 ;
"RTN","MAGDQR04",105,0)
 N ACN,ATP,CPT,D0,D1,D2,D3,DFN,ERR,I,IT,MO,N,P,PDT,PP,REQP,RFP,RQL,T,TAG,UID,V,WRD,X
"RTN","MAGDQR04",106,0)
 I '$G(IMAGE) S OUT(1)="-1,No Image Specified." Q
"RTN","MAGDQR04",107,0)
 I '$D(^MAG(2005,IMAGE)) S OUT(1)="-2,No Such Image ("_IMAGE_")." Q
"RTN","MAGDQR04",108,0)
 ;
"RTN","MAGDQR04",109,0)
 S X=$G(^MAG(2005,IMAGE,0)),P=$P(X,"^",10)
"RTN","MAGDQR04",110,0)
 S TAG("0008,1030")=$$STYDESC^MAGUE001(IMAGE,.ERR) ; Study Description
"RTN","MAGDQR04",111,0)
 S DFN=$P(X,"^",7) D:DFN
"RTN","MAGDQR04",112,0)
 . N VA,VADM,VAPA,VAERR,DOB,TOB ; return arrays from VADPT
"RTN","MAGDQR04",113,0)
 . N I ; scratch loop array
"RTN","MAGDQR04",114,0)
 . D ^VADPT ; populate standard patient data array VADM()
"RTN","MAGDQR04",115,0)
 . S TAG("0010,0010")=$G(VADM(1)) ; Patient Name
"RTN","MAGDQR04",116,0)
 . S TAG("0010,0020")=$G(VADM(2)) ; Patient ID (SSN)
"RTN","MAGDQR04",117,0)
 . S DOB=$G(VADM(3))\1+17000000 ; Patient's Birth Date
"RTN","MAGDQR04",118,0)
 . ; make sure month and year are DICOM valid
"RTN","MAGDQR04",119,0)
 . S TAG("0010,0030")=$S($E(DOB,5,6)="00":"",$E(DOB,7,8)="00":"",1:DOB)
"RTN","MAGDQR04",120,0)
 . ; Patient's Birth Time [probably always blank]
"RTN","MAGDQR04",121,0)
 . S TAG("0010,0032")=$S(VADM(3)[".":$TR($J("."_$P($G(VADM(3)),".",2)*1E6,6)," ",0),1:"")
"RTN","MAGDQR04",122,0)
 . S TAG("0010,2160")=$G(VADM(8)) ; Patient's Race
"RTN","MAGDQR04",123,0)
 . S TAG("0010,0040")=$P($G(VADM(5)),"^",1) ; Patient's Sex
"RTN","MAGDQR04",124,0)
 . S X=$$GETICN^MPIF001(DFN)
"RTN","MAGDQR04",125,0)
 . S TAG("0010,1000")=$S(X<0:$E(TAG("0010,0010"),1)_$E(TAG("0010,0020"),6,99),1:X) ; Other Patient ID
"RTN","MAGDQR04",126,0)
 . D ADD^VADPT ; populate patient address array
"RTN","MAGDQR04",127,0)
 . F I=1,2,3,4,6 S $P(TAG("0010,1040"),"^",I)=$G(VAPA(I))
"RTN","MAGDQR04",128,0)
 . S $P(TAG("0010,1040"),"^",5)=$P($G(VAPA(5)),"^",2)
"RTN","MAGDQR04",129,0)
 . Q
"RTN","MAGDQR04",130,0)
 ;
"RTN","MAGDQR04",131,0)
 S:P TAG("0008,0018")=$$QRNEWUID^MAGDRPC9(IMAGE)
"RTN","MAGDQR04",132,0)
 ;
"RTN","MAGDQR04",133,0)
 S TAG("0020,000D")=$P($G(^MAG(2005,$S(P:+P,1:IMAGE),"PACS")),"^",1)
"RTN","MAGDQR04",134,0)
 S X=$P($G(^MAG(2005,IMAGE,"SERIESUID")),"^",1)
"RTN","MAGDQR04",135,0)
 S:X'="" TAG("0020,000E")=X
"RTN","MAGDQR04",136,0)
 ;
"RTN","MAGDQR04",137,0)
 ; The following references to ^RADPT are allowed according to IA # 1172
"RTN","MAGDQR04",138,0)
 S X=$G(^MAG(2005,IMAGE,2)),ACN="" D:$P(X,"^",6)=74
"RTN","MAGDQR04",139,0)
 . N P5,P7
"RTN","MAGDQR04",140,0)
 . S P5=$P(X,"^",5),P7=$P(X,"^",7),X=$G(^RARPT(+P7,0))
"RTN","MAGDQR04",141,0)
 . S D0=$P(X,"^",2),D1=9999999.9999=$P(X,"^",3),ACN=$P(X,"^",1)
"RTN","MAGDQR04",142,0)
 . Q
"RTN","MAGDQR04",143,0)
 S IT=0
"RTN","MAGDQR04",144,0)
 I ACN'="" S D0="" F  S D0=$O(^RADPT("ADC",ACN,D0)) Q:D0=""  D
"RTN","MAGDQR04",145,0)
 . S D1="" F  S D1=$O(^RADPT("ADC",ACN,D0,D1)) Q:D1=""  D
"RTN","MAGDQR04",146,0)
 . . N M1,VAIN,VAINDT
"RTN","MAGDQR04",147,0)
 . . S IT=IT+1,TAG("0008,0020",IT)=9999999.9999-D1\1+17000000 ; Study Date
"RTN","MAGDQR04",148,0)
 . . S VAINDT=9999999.9999-D1 D INP^VADPT ; Supported reference
"RTN","MAGDQR04",149,0)
 . . S:$G(VAIN(2))'="" RFP(VAIN(2))="" ; Referring Physician's Name
"RTN","MAGDQR04",150,0)
 . . S:$G(VAIN(4))'="" RFP(VAIN(4))="" ; Current Ward
"RTN","MAGDQR04",151,0)
 . . S:$G(VAIN(11))'="" ATP(VAIN(11))="" ; Performing (attending) Physician
"RTN","MAGDQR04",152,0)
 . . S D2="" F  S D2=$O(^RADPT("ADC",ACN,D0,D1,D2)) Q:D2=""  D
"RTN","MAGDQR04",153,0)
 . . . S X=$G(^RADPT(D0,"DT",D1,"P",D2,0))
"RTN","MAGDQR04",154,0)
 . . . S P=$P(X,"^",2) D:P
"RTN","MAGDQR04",155,0)
 . . . . S M1=0 F  S M1=$O(^RAMIS(71,+P,"MDL",M1)) Q:'M1  D  ; IA # 1174
"RTN","MAGDQR04",156,0)
 . . . . . S V=$P($G(^RAMIS(71,+P,"MDL",M1,0)),"^",1) Q:'V  ; IA # 1174
"RTN","MAGDQR04",157,0)
 . . . . . S V=$P($G(^RAMIS(73.1,+V,0)),"^",1) S:V'="" MO(V)="" ; IA # 1174
"RTN","MAGDQR04",158,0)
 . . . . . Q
"RTN","MAGDQR04",159,0)
 . . . . S V=$P($G(^RAMIS(71,+P,0)),"^",9) S:V CPT(+V)="" ; IA # 1174
"RTN","MAGDQR04",160,0)
 . . . . Q
"RTN","MAGDQR04",161,0)
 . . . S P=$P(X,"^",14) D:P
"RTN","MAGDQR04",162,0)
 . . . . S V=$P($G(^VA(200,+P,0)),"^",1)
"RTN","MAGDQR04",163,0)
 . . . . S:V'="" REQP(V)=""
"RTN","MAGDQR04",164,0)
 . . . . Q
"RTN","MAGDQR04",165,0)
 . . . S P=$P(X,"^",17) D:P
"RTN","MAGDQR04",166,0)
 . . . . S X=$G(^RARPT(+P,0)) Q:X=""  ; IA # 1171
"RTN","MAGDQR04",167,0)
 . . . . S V=$P(X,"^",1) S:V'="" ACN(V)=""
"RTN","MAGDQR04",168,0)
 . . . . Q
"RTN","MAGDQR04",169,0)
 . . . S P=$P(X,"^",22) D:P
"RTN","MAGDQR04",170,0)
 . . . . S X=$G(^SC(+P,0)) Q:X=""  ; IA # 10040
"RTN","MAGDQR04",171,0)
 . . . . S V=$P(X,"^",1) S:V'="" RQL(V)=""
"RTN","MAGDQR04",172,0)
 . . . . Q
"RTN","MAGDQR04",173,0)
 . . . S P=0,D3=0 F  S D3=$O(^RADPT(D0,"P",D1,"DT",D2,"H",D3)) Q:'D3  D
"RTN","MAGDQR04",174,0)
 . . . . S X=$G(^RADPT(D0,"P",D1,"DT",D2,"H",D3,0)) Q:X=""
"RTN","MAGDQR04",175,0)
 . . . . S P=P+1,TAG("0010,2000  "_$J(P,5))=X
"RTN","MAGDQR04",176,0)
 . . . . Q
"RTN","MAGDQR04",177,0)
 . . . Q
"RTN","MAGDQR04",178,0)
 . . Q
"RTN","MAGDQR04",179,0)
 . Q
"RTN","MAGDQR04",180,0)
 S V="" F  S V=$O(ACN(V)) Q:V=""  D
"RTN","MAGDQR04",181,0)
 . S IT=IT+1,TAG("0008,0050",IT)=V ; Accession Number
"RTN","MAGDQR04",182,0)
 . Q
"RTN","MAGDQR04",183,0)
 S V="" F  S V=$O(WRD(V)) Q:V=""  D
"RTN","MAGDQR04",184,0)
 . S IT=IT+1,TAG("0038,0300",IT)=$P(V,"^",2) ; Current Patient Location
"RTN","MAGDQR04",185,0)
 . Q
"RTN","MAGDQR04",186,0)
 S V="" F  S V=$O(RFP(V)) Q:V=""  D
"RTN","MAGDQR04",187,0)
 . S IT=IT+1,TAG("0008,0090",IT)=$P(V,"^",2) ; Referring Physician's Name
"RTN","MAGDQR04",188,0)
 . Q
"RTN","MAGDQR04",189,0)
 S V="" F  S V=$O(ATP(V)) Q:V=""  D
"RTN","MAGDQR04",190,0)
 . S IT=IT+1,TAG("0008,1050",IT)=$P(V,"^",2) ; Performing (attending) Physician
"RTN","MAGDQR04",191,0)
 . Q
"RTN","MAGDQR04",192,0)
 S V="" F  S V=$O(RQL(V)) Q:V=""  D
"RTN","MAGDQR04",193,0)
 . S IT=IT+1,TAG("0032,1033",IT)=V ; Requesting Service
"RTN","MAGDQR04",194,0)
 . Q
"RTN","MAGDQR04",195,0)
 S V="" F  S V=$O(MO(V)) Q:V=""  D
"RTN","MAGDQR04",196,0)
 . S IT=IT+1,TAG("0008,0060",IT)=V ; Modality
"RTN","MAGDQR04",197,0)
 . Q
"RTN","MAGDQR04",198,0)
 S V="" F  S V=$O(REQP(V)) Q:V=""  D
"RTN","MAGDQR04",199,0)
 . S IT=IT+1,TAG("0032,1032",IT)=V ; Requesting Physician
"RTN","MAGDQR04",200,0)
 . Q
"RTN","MAGDQR04",201,0)
 S V="" F  S V=$O(CPT(V)) Q:V=""  D
"RTN","MAGDQR04",202,0)
 . S X=$$CPT^ICPTCOD(V) ; IA # 1995, supported reference
"RTN","MAGDQR04",203,0)
 . Q:$P(X,"^",2)=""
"RTN","MAGDQR04",204,0)
 . S IT=IT+1
"RTN","MAGDQR04",205,0)
 . S TAG("0032,1064 0008,0100",IT)=$P(X,"^",2) ; CPT Code
"RTN","MAGDQR04",206,0)
 . S TAG("0032,1064 0008,0104",IT)=$P(X,"^",3) ; Code Meaning
"RTN","MAGDQR04",207,0)
 . S TAG("0032,1060",IT)=$P(X,"^",3) ; Requested Procedure Description
"RTN","MAGDQR04",208,0)
 . S TAG("0032,1064 0008,0102",IT)="C4" ; Coding Scheme Designator
"RTN","MAGDQR04",209,0)
 . Q
"RTN","MAGDQR04",210,0)
 ;
"RTN","MAGDQR04",211,0)
 S V=$P($G(^MAG(2005,IMAGE,100)),"^",3) D:V=""
"RTN","MAGDQR04",212,0)
 . ; Find Acquisition site when not filled in in Image File
"RTN","MAGDQR04",213,0)
 . N D0,LOC,N
"RTN","MAGDQR04",214,0)
 . S (N,D0,LOC)=0 F  S D0=$O(^MAG(2006.1,D0)) Q:'D0  D
"RTN","MAGDQR04",215,0)
 . . S N=N+1,LOC=$P($G(^MAG(2006.1,D0,0)),"^",1)
"RTN","MAGDQR04",216,0)
 . . Q
"RTN","MAGDQR04",217,0)
 . Q:N>2  ; Too many to choose from...
"RTN","MAGDQR04",218,0)
 . S:LOC V=LOC
"RTN","MAGDQR04",219,0)
 . Q
"RTN","MAGDQR04",220,0)
 S:V'="" TAG("0032,1020")=V ; Acquisition Site
"RTN","MAGDQR04",221,0)
 ;
"RTN","MAGDQR04",222,0)
 S N=1,T="" F  S T=$O(TAG(T)) Q:T=""  D
"RTN","MAGDQR04",223,0)
 . S V=""
"RTN","MAGDQR04",224,0)
 . S:$D(TAG(T))#2 V=TAG(T)
"RTN","MAGDQR04",225,0)
 . S I="" F  S I=$O(TAG(T,I)) Q:I=""  S:V'="" V=V_"\" S V=V_TAG(T,I)
"RTN","MAGDQR04",226,0)
 . S:V'="" N=N+1,OUT(N)=T_"^"_V
"RTN","MAGDQR04",227,0)
 . Q
"RTN","MAGDQR04",228,0)
 ;
"RTN","MAGDQR04",229,0)
 S OUT(1)=(N-1)_" data fields returned."
"RTN","MAGDQR04",230,0)
 Q
"RTN","MAGDQR04",231,0)
 ;
"RTN","MAGDQR04",232,0)
CLEAN(OUT) ; RPC = MAG DICOM QUERY CLEANUP
"RTN","MAGDQR04",233,0)
 N D0,H,N,STAMP
"RTN","MAGDQR04",234,0)
 L +^MAGDQR(2006.5732,0):1E6 ; Background task MUST wait
"RTN","MAGDQR04",235,0)
 S D0=0 F  S D0=$O(^MAGDQR(2006.5732,D0)) Q:'D0  D
"RTN","MAGDQR04",236,0)
 . S X=$G(^MAGDQR(2006.5732,D0,0)),STAMP=$P(X,"^",3)
"RTN","MAGDQR04",237,0)
 . Q:$$FMDIFF^XLFDT(DT,STAMP,1)<5
"RTN","MAGDQR04",238,0)
 . K ^MAGDQR(2006.5732,D0)
"RTN","MAGDQR04",239,0)
 . K ^MAGDQR(2006.5732,"B",D0)
"RTN","MAGDQR04",240,0)
 . Q
"RTN","MAGDQR04",241,0)
 S (D0,N,H)=0 F  S D0=$O(^MAGDQR(2006.5732,D0)) Q:'D0  S N=N+1,H=D0
"RTN","MAGDQR04",242,0)
 S X="DICOM QUERY RETRIEVE RESULT^2006.5732^"_H_"^"_N
"RTN","MAGDQR04",243,0)
 S ^MAGDQR(2006.5732,0)=X
"RTN","MAGDQR04",244,0)
 L -^MAGDQR(2006.5732,0)
"RTN","MAGDQR04",245,0)
 Q
"RTN","MAGDQR04",246,0)
 ;
"RTN","MAGDQR05")
0^30^B45801758
"RTN","MAGDQR05",1,0)
MAGDQR05 ;WOIFO/EdM - Imaging RPCs for Query/Retrieve ; 26 Mar 2009 11:33 PM
"RTN","MAGDQR05",2,0)
 ;;3.0;IMAGING;**54**;03-July-2009;;Build 1424
"RTN","MAGDQR05",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDQR05",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDQR05",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDQR05",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDQR05",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDQR05",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDQR05",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDQR05",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDQR05",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDQR05",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDQR05",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDQR05",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDQR05",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDQR05",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDQR05",17,0)
 ;;
"RTN","MAGDQR05",18,0)
 Q
"RTN","MAGDQR05",19,0)
 ;
"RTN","MAGDQR05",20,0)
TIM ; Overflow from MAGDQR02
"RTN","MAGDQR05",21,0)
 N D0,D1,D2,PAT,SDT,V,X
"RTN","MAGDQR05",22,0)
 ; The references below to ^RADPT are permitted according to the
"RTN","MAGDQR05",23,0)
 ; existing Integration Agreement # 1172
"RTN","MAGDQR05",24,0)
 S V="" F  S V=$O(^RADPT("ADC",V)) Q:V=""  D
"RTN","MAGDQR05",25,0)
 . S D0="" F  S D0=$O(^RADPT("ADC",V,D0)) Q:D0=""  D
"RTN","MAGDQR05",26,0)
 . . S D1="" F  S D1=$O(^RADPT("ADC",V,D0,D1)) Q:D1=""  D
"RTN","MAGDQR05",27,0)
 . . . S SDT=9999999.9999-D1 Q:SDT<FD  Q:SDT>LD
"RTN","MAGDQR05",28,0)
 . . . S D2="" F  S D2=$O(^RADPT("ADC",V,D0,D1,D2)) Q:D2=""  D
"RTN","MAGDQR05",29,0)
 . . . . Q:'$P($G(^RADPT(D0,"DT",D1,"P",D2,0)),"^",17)
"RTN","MAGDQR05",30,0)
 . . . . S ^TMP("MAG",$J,"QR",10,"R^"_D0_"^"_D1_"^"_D2)="",TIM=2
"RTN","MAGDQR05",31,0)
 . . . . S ANY=1,SID=1
"RTN","MAGDQR05",32,0)
 . . . . Q
"RTN","MAGDQR05",33,0)
 . . . Q
"RTN","MAGDQR05",34,0)
 . . Q
"RTN","MAGDQR05",35,0)
 . Q
"RTN","MAGDQR05",36,0)
 S PAT="" F  S PAT=$O(^MAG(2005,"APDTPX",PAT)) Q:PAT=""  D
"RTN","MAGDQR05",37,0)
 . S D1="" F  S D1=$O(^MAG(2005,"APDTPX",PAT,D1)) Q:D1=""  D
"RTN","MAGDQR05",38,0)
 . . S SDT=9999999.9999-D1 Q:SDT<FD  Q:SDT>LD
"RTN","MAGDQR05",39,0)
 . . S D0="" F  S D0=$O(^MAG(2005,"APDTPX",PAT,D1,"CON/PROC",D0)) Q:D0=""  D
"RTN","MAGDQR05",40,0)
 . . . S X=$G(^MAG(2005,D0,2)),V=""
"RTN","MAGDQR05",41,0)
 . . . D:$P(X,"^",6)=2006.5839
"RTN","MAGDQR05",42,0)
 . . . . S V="123^"_$P(X,"^",7)_"^"_D0_"^"_$P(X,"^",7)
"RTN","MAGDQR05",43,0)
 . . . . Q
"RTN","MAGDQR05",44,0)
 . . . D:$P(X,"^",6)=8925
"RTN","MAGDQR05",45,0)
 . . . . N T
"RTN","MAGDQR05",46,0)
 . . . . S T=$P($G(^TIU(8925,+$P(X,"^",7),14)),"^",5) ; IA# 3268
"RTN","MAGDQR05",47,0)
 . . . . S T=$S(T[";GMR(123,":"GMRC-"_(+T),1:"") ; Should use FileMan
"RTN","MAGDQR05",48,0)
 . . . . S V="8925^"_$P(X,"^",7)_"^"_D0_"^"_T
"RTN","MAGDQR05",49,0)
 . . . . Q
"RTN","MAGDQR05",50,0)
 . . . S ^TMP("MAG",$J,"QR",10,"C^"_PAT_"^"_V)="",TIM=2
"RTN","MAGDQR05",51,0)
 . . . S ANY=1,SID=1
"RTN","MAGDQR05",52,0)
 . . . Q
"RTN","MAGDQR05",53,0)
 . . Q
"RTN","MAGDQR05",54,0)
 . Q
"RTN","MAGDQR05",55,0)
 I TIM=1 D  Q
"RTN","MAGDQR05",56,0)
 . D ERR^MAGDQR01("No matches for tag 0008,0020 / 0008,0030")
"RTN","MAGDQR05",57,0)
 . D ERRSAV^MAGDQR01
"RTN","MAGDQR05",58,0)
 . Q
"RTN","MAGDQR05",59,0)
 ;
"RTN","MAGDQR05",60,0)
 Q
"RTN","MAGDQR05",61,0)
 ;
"RTN","MAGDQR05",62,0)
AETITLE(OUT,TITLE,SERVICE,MODE,LOCATION) ; RPC = MAG DICOM CHECK AE TITLE
"RTN","MAGDQR05",63,0)
 N D0,D1,LO,N,OK,SERV,T,UP,X,L
"RTN","MAGDQR05",64,0)
 I $G(TITLE)="" S OUT(1)="-1,No AE Title specified" Q
"RTN","MAGDQR05",65,0)
 S LO="abcdefghijklmnopqrstuvwxyz"
"RTN","MAGDQR05",66,0)
 S UP="ABCDEFGHIJKLMNOPQRSTUVWXYZ"
"RTN","MAGDQR05",67,0)
 S TITLE=$TR(TITLE,UP,LO),N=1
"RTN","MAGDQR05",68,0)
 S D0=0 F  S D0=$O(^MAG(2006.587,D0)) Q:'D0  D
"RTN","MAGDQR05",69,0)
 . S X=$G(^MAG(2006.587,D0,0)) S T=$TR($P(X,"^",2),UP,LO) Q:T'=TITLE
"RTN","MAGDQR05",70,0)
 . S L=$P(X,"^",7)  Q:L'=LOCATION
"RTN","MAGDQR05",71,0)
 . S SERV=$P(X,"^",1) S:SERV="" SERV="?" Q:$G(SERV(SERV))
"RTN","MAGDQR05",72,0)
 . I $G(SERVICE)'="",$G(MODE)'="" D  Q:'OK
"RTN","MAGDQR05",73,0)
 . . S OK=0,D1=0 F  S D1=$O(^MAG(2006.587,D0,1,D1)) Q:'D1  D  Q:OK
"RTN","MAGDQR05",74,0)
 . . . S T=$G(^MAG(2006.587,D0,1,D1,0)) Q:T=""
"RTN","MAGDQR05",75,0)
 . . . Q:$TR($P(T,"^",1),UP,LO)'=$TR(SERVICE,UP,LO)
"RTN","MAGDQR05",76,0)
 . . . I $TR(MODE,UP,LO)="scu",'$P(T,"^",2) Q
"RTN","MAGDQR05",77,0)
 . . . I $TR(MODE,UP,LO)="scp",'$P(T,"^",3) Q
"RTN","MAGDQR05",78,0)
 . . . S OK=1
"RTN","MAGDQR05",79,0)
 . . . Q
"RTN","MAGDQR05",80,0)
 . . Q
"RTN","MAGDQR05",81,0)
 . S SERV(SERV)=1
"RTN","MAGDQR05",82,0)
 . S N=N+1,OUT(N)=SERV_"^"_$P(X,"^",3)_"^"_$P(X,"^",4)
"RTN","MAGDQR05",83,0)
 . Q
"RTN","MAGDQR05",84,0)
 I N=1 S OUT(1)="-2,No entry for AE Title """_TITLE_""" at location """_LOCATION_"""." Q
"RTN","MAGDQR05",85,0)
 S OUT(1)=N-1_",OK"
"RTN","MAGDQR05",86,0)
 Q
"RTN","MAGDQR05",87,0)
 ;
"RTN","MAGDQR05",88,0)
VATITLE(OUT,SERVICE,MODE,LOCATION) ; RPC = MAG DICOM VISTA AE TITLE
"RTN","MAGDQR05",89,0)
 N AE,D0,D1,LO,OK,UP,X0,X1,L
"RTN","MAGDQR05",90,0)
 S LO="abcdefghijklmnopqrstuvwxyz"
"RTN","MAGDQR05",91,0)
 S UP="ABCDEFGHIJKLMNOPQRSTUVWXYZ"
"RTN","MAGDQR05",92,0)
 S SERVICE=$TR($G(SERVICE),LO,UP)
"RTN","MAGDQR05",93,0)
 S MODE=$TR($G(MODE),LO,UP)
"RTN","MAGDQR05",94,0)
 S AE("C-MOVE","SCU")="VistA_QR_SCU"
"RTN","MAGDQR05",95,0)
 S AE("C-STORE","SCU")="VistA_Send_Image"
"RTN","MAGDQR05",96,0)
 S AE("C-FIND","SCU")="VISTA_QR_SCU"
"RTN","MAGDQR05",97,0)
 S AE("C-MOVE","SCP")="VistA_QR_SCP"
"RTN","MAGDQR05",98,0)
 S AE("C-STORE","SCP")="VistA_Storage"
"RTN","MAGDQR05",99,0)
 S AE("C-FIND","SCP")="VISTA_QR_SCP"
"RTN","MAGDQR05",100,0)
 S OUT="" I SERVICE'="",MODE'="" D
"RTN","MAGDQR05",101,0)
 . S OUT=$G(AE(SERVICE,MODE)) S:OUT'="" OUT="1,"_OUT
"RTN","MAGDQR05",102,0)
 . S (D0,OK)=0 F  S D0=$O(^MAG(2006.587,D0)) Q:'D0  D  Q:OK
"RTN","MAGDQR05",103,0)
 . . S X0=$G(^MAG(2006.587,D0,0))
"RTN","MAGDQR05",104,0)
 . . S L=$P(X0,"^",7)  Q:L'=LOCATION
"RTN","MAGDQR05",105,0)
 . . S D1=0 F  S D1=$O(^MAG(2006.587,D0,1,D1)) Q:'D1  D  Q:OK
"RTN","MAGDQR05",106,0)
 . . . S X1=$G(^MAG(2006.587,D0,1,D1,0))
"RTN","MAGDQR05",107,0)
 . . . Q:$P(X1,"^",1)'=SERVICE
"RTN","MAGDQR05",108,0)
 . . . I MODE="SCU",$P(X1,"^",2) S OK=1
"RTN","MAGDQR05",109,0)
 . . . I MODE="SCP",$P(X1,"^",3) S OK=1
"RTN","MAGDQR05",110,0)
 . . . S:OK OUT="1,"_$P(X0,"^",2)
"RTN","MAGDQR05",111,0)
 . . . Q
"RTN","MAGDQR05",112,0)
 . . Q
"RTN","MAGDQR05",113,0)
 . Q
"RTN","MAGDQR05",114,0)
 S:OUT="" OUT="-1,No title for """_SERVICE_""", """_MODE_""" at location """_LOCATION_"""."
"RTN","MAGDQR05",115,0)
 Q
"RTN","MAGDQR05",116,0)
 ;
"RTN","MAGDQR05",117,0)
GWINFO(OUT,HOSTNAME,LOCATION,FILES,VER) ; RPC = MAG DICOM STORE GATEWAY INFO
"RTN","MAGDQR05",118,0)
 N D0,X
"RTN","MAGDQR05",119,0)
 I $G(HOSTNAME)="" S OUT="-1,No HostName provided." Q
"RTN","MAGDQR05",120,0)
 I '$G(LOCATION) S OUT="-3,No location provided." Q
"RTN","MAGDQR05",121,0)
 S HOSTNAME=$TR(HOSTNAME,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","MAGDQR05",122,0)
 S D0=$O(^MAG(2006.87,"B",HOSTNAME,"")) D:'D0
"RTN","MAGDQR05",123,0)
 . L +^MAG(2006.87,0):1E9 ; Background process MUST wait
"RTN","MAGDQR05",124,0)
 . S X=$G(^MAG(2006.87,0))
"RTN","MAGDQR05",125,0)
 . S $P(X,"^",1,2)="DICOM GATEWAY INFORMATION^2006.87"
"RTN","MAGDQR05",126,0)
 . S D0=$O(^MAG(2006.87," "),-1)+1
"RTN","MAGDQR05",127,0)
 . S $P(X,"^",3)=D0
"RTN","MAGDQR05",128,0)
 . S $P(X,"^",4)=$P(X,"^",4)+1
"RTN","MAGDQR05",129,0)
 . S ^MAG(2006.87,0)=X
"RTN","MAGDQR05",130,0)
 . S ^MAG(2006.87,D0,0)=HOSTNAME
"RTN","MAGDQR05",131,0)
 . S ^MAG(2006.87,"B",HOSTNAME,D0)=""
"RTN","MAGDQR05",132,0)
 . L -^MAG(2006.87,0)
"RTN","MAGDQR05",133,0)
 . Q
"RTN","MAGDQR05",134,0)
 S ^MAG(2006.87,D0,0)=HOSTNAME_"^"_"^"_(+LOCATION)
"RTN","MAGDQR05",135,0)
 D GWLOG(.FILES,"INSTRUMENT",D0,1)
"RTN","MAGDQR05",136,0)
 D GWLOG(.FILES,"MODALITY",D0,2)
"RTN","MAGDQR05",137,0)
 D GWLOG(.FILES,"PORTLIST",D0,3)
"RTN","MAGDQR05",138,0)
 D GWLOG(.FILES,"SCU_LIST",D0,4)
"RTN","MAGDQR05",139,0)
 D GWLOG(.FILES,"WORKLIST",D0,5)
"RTN","MAGDQR05",140,0)
 D GWLOG(.FILES,"CT_PARAM",D0,6)
"RTN","MAGDQR05",141,0)
 D GWLOG(.VER,"GW",D0,100)
"RTN","MAGDQR05",142,0)
 D GWLOG(.VER,"MAG_DCMVIEW",D0,101)
"RTN","MAGDQR05",143,0)
 D GWLOG(.VER,"MAG_MAKEABS",D0,102)
"RTN","MAGDQR05",144,0)
 D GWLOG(.VER,"MAG_CSTORE",D0,103)
"RTN","MAGDQR05",145,0)
 D GWLOG(.VER,"MAG_RECON",D0,104)
"RTN","MAGDQR05",146,0)
 D GWLOG(.VER,"MAG_DCMTOTGA",D0,105)
"RTN","MAGDQR05",147,0)
 S OUT=0
"RTN","MAGDQR05",148,0)
 Q
"RTN","MAGDQR05",149,0)
 ;
"RTN","MAGDQR05",150,0)
GWLOG(ARRAY,NAME,D0,F) ;
"RTN","MAGDQR05",151,0)
 S:$D(ARRAY(NAME)) ^MAG(2006.87,D0,F)=ARRAY(NAME)
"RTN","MAGDQR05",152,0)
 Q
"RTN","MAGDQR05",153,0)
 ;
"RTN","MAGDQR05",154,0)
GETINFO(OUT,HOSTNAME) ; RPC = MAG DICOM GET GATEWAY INFO
"RTN","MAGDQR05",155,0)
 N D0,N,X
"RTN","MAGDQR05",156,0)
 I $G(HOSTNAME)="" S OUT="-1,No HostName provided." Q
"RTN","MAGDQR05",157,0)
 S HOSTNAME=$TR(HOSTNAME,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","MAGDQR05",158,0)
 S D0=$O(^MAG(2006.87,"B",HOSTNAME,""))
"RTN","MAGDQR05",159,0)
 I 'D0 S OUT(1)="-2,Cannot find info for """_HOSTNAME_"""." Q
"RTN","MAGDQR05",160,0)
 S N=1
"RTN","MAGDQR05",161,0)
 S X=$G(^MAG(2006.87,D0,0))
"RTN","MAGDQR05",162,0)
 S:$P(X,"^",3) N=N+1,OUT(N)="Loc="_$P(X,"^",3)
"RTN","MAGDQR05",163,0)
 D GWGET($G(^MAG(2006.87,D0,1)),"In")
"RTN","MAGDQR05",164,0)
 D GWGET($G(^MAG(2006.87,D0,2)),"Mo")
"RTN","MAGDQR05",165,0)
 D GWGET($G(^MAG(2006.87,D0,3)),"PL")
"RTN","MAGDQR05",166,0)
 D GWGET($G(^MAG(2006.87,D0,4)),"SL")
"RTN","MAGDQR05",167,0)
 D GWGET($G(^MAG(2006.87,D0,5)),"WL")
"RTN","MAGDQR05",168,0)
 D GWGET($G(^MAG(2006.87,D0,6)),"CP")
"RTN","MAGDQR05",169,0)
 S X=$G(^MAG(2006.87,D0,100)) S:X'="" N=N+1,OUT(N)="Ver="_X
"RTN","MAGDQR05",170,0)
 D GWGET($G(^MAG(2006.87,D0,101)),"Vw")
"RTN","MAGDQR05",171,0)
 D GWGET($G(^MAG(2006.87,D0,102)),"Ab")
"RTN","MAGDQR05",172,0)
 D GWGET($G(^MAG(2006.87,D0,103)),"CS")
"RTN","MAGDQR05",173,0)
 D GWGET($G(^MAG(2006.87,D0,104)),"Rc")
"RTN","MAGDQR05",174,0)
 D GWGET($G(^MAG(2006.87,D0,105)),"DT")
"RTN","MAGDQR05",175,0)
 S OUT(1)=N
"RTN","MAGDQR05",176,0)
 Q
"RTN","MAGDQR05",177,0)
 ;
"RTN","MAGDQR05",178,0)
GWGET(X,K) N T
"RTN","MAGDQR05",179,0)
 Q:X=""
"RTN","MAGDQR05",180,0)
 S:$P(X,"^",2)'="" N=N+1,OUT(N)=K_"_p="_$P(X,"^",2)
"RTN","MAGDQR05",181,0)
 S T=$P(X,"^",1) Q:'T
"RTN","MAGDQR05",182,0)
 S N=N+1,OUT(N)=K_"_s="_$$STAMP(T)
"RTN","MAGDQR05",183,0)
 Q
"RTN","MAGDQR05",184,0)
 ;
"RTN","MAGDQR05",185,0)
STAMP(T) N O,V
"RTN","MAGDQR05",186,0)
 S V=(T\1#100)_"-"_$P("JAN FEB MAR APR MAY JUN JUL AUG SEP OCT NOV DEC"," ",T\100#100)_"-"_(T\10000+1700)
"RTN","MAGDQR05",187,0)
 S O=$E($P(T,".",2)_"000000",1,6),V=V_" "_$E(O,1,2)_":"_$E(O,3,4)_":"_$E(O,5,6)
"RTN","MAGDQR05",188,0)
 Q V
"RTN","MAGDQR05",189,0)
 ;
"RTN","MAGDQR06")
0^31^B31960461
"RTN","MAGDQR06",1,0)
MAGDQR06 ;WOIFO/EdM - Imaging RPCs for Query/Retrieve ; 08 Aug 2008 9:53 AM
"RTN","MAGDQR06",2,0)
 ;;3.0;IMAGING;**54**;03-July-2009;;Build 1424
"RTN","MAGDQR06",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDQR06",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDQR06",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDQR06",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDQR06",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDQR06",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDQR06",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDQR06",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDQR06",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDQR06",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDQR06",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDQR06",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDQR06",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDQR06",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDQR06",17,0)
 ;;
"RTN","MAGDQR06",18,0)
 Q
"RTN","MAGDQR06",19,0)
 ;
"RTN","MAGDQR06",20,0)
Q0080050 ;R  Accession Number
"RTN","MAGDQR06",21,0)
 ; sensitive/employee?
"RTN","MAGDQR06",22,0)
 I SENSEMP D  Q  ; yes, scrub
"RTN","MAGDQR06",23,0)
 . N WRKDT
"RTN","MAGDQR06",24,0)
 . S WRKDT=$$DT^XLFDT
"RTN","MAGDQR06",25,0)
 . S V(T)=$E(WRKDT,4,7)_$E(WRKDT,2,3)_"-0000"
"RTN","MAGDQR06",26,0)
 . Q
"RTN","MAGDQR06",27,0)
 ; no
"RTN","MAGDQR06",28,0)
 D:TYPE="R"
"RTN","MAGDQR06",29,0)
 . S X=$P($G(^RADPT(MAGDFN,"DT",MAGRORD,"P",MAGINTERP,0)),"^",17) ; IA # 1172
"RTN","MAGDQR06",30,0)
 . S V(T)=$P($G(^RARPT(+X,0)),"^",1) ; IA # 1171
"RTN","MAGDQR06",31,0)
 . Q
"RTN","MAGDQR06",32,0)
 D:TYPE="C"
"RTN","MAGDQR06",33,0)
 . N R2,TIUNUM,CONSIX
"RTN","MAGDQR06",34,0)
 . S R2=$G(^MAG(2005,MAGIEN,2)) Q:R2=""
"RTN","MAGDQR06",35,0)
 . I $P(R2,"^",6)=2006.5839 D  Q
"RTN","MAGDQR06",36,0)
 . . S CONSIX=$P(R2,"^",7)
"RTN","MAGDQR06",37,0)
 . . S V(T)="GMRC-"_CONSIX
"RTN","MAGDQR06",38,0)
 . . Q
"RTN","MAGDQR06",39,0)
 . I $P(R2,"^",6)=8925 D  Q
"RTN","MAGDQR06",40,0)
 . . S TIUNUM=$P(R2,"^",7) Q:'TIUNUM
"RTN","MAGDQR06",41,0)
 . . S CONSIX=$P($G(^TIU(8925,TIUNUM,14)),"^",5)
"RTN","MAGDQR06",42,0)
 . . S:$P(CONSIX,";",2)="GMR(123," V(T)="GMRC-"_$P(CONSIX,";",1)
"RTN","MAGDQR06",43,0)
 . . Q
"RTN","MAGDQR06",44,0)
 . Q
"RTN","MAGDQR06",45,0)
 Q
"RTN","MAGDQR06",46,0)
 ;
"RTN","MAGDQR06",47,0)
Q0200010 ;R  Study ID
"RTN","MAGDQR06",48,0)
 ; sensitive/employee?
"RTN","MAGDQR06",49,0)
 I SENSEMP D  Q  ; yes, scrub
"RTN","MAGDQR06",50,0)
 . N I S I=$O(REQ(T,"")) S V(T)=$S(I:$S($G(REQ(T,I))]"":REQ(T,I),1:"0"),1:"0")
"RTN","MAGDQR06",51,0)
 . Q
"RTN","MAGDQR06",52,0)
 ; no
"RTN","MAGDQR06",53,0)
 D:TYPE="R"
"RTN","MAGDQR06",54,0)
 . S V(T)=$P($G(^RADPT(MAGDFN,"DT",MAGRORD,"P",MAGINTERP,0)),"^",1) ; IA # 1172
"RTN","MAGDQR06",55,0)
 . Q
"RTN","MAGDQR06",56,0)
 D:TYPE="C"
"RTN","MAGDQR06",57,0)
 . S V(T)=$P($G(ACCNUM),"-",2)
"RTN","MAGDQR06",58,0)
 . Q
"RTN","MAGDQR06",59,0)
 Q
"RTN","MAGDQR06",60,0)
 ;
"RTN","MAGDQR06",61,0)
Q0080062 ;O  SOP Classes in Study
"RTN","MAGDQR06",62,0)
 ; --- probably not supported --- ?
"RTN","MAGDQR06",63,0)
 ; ? ? ?
"RTN","MAGDQR06",64,0)
 ;;;S:'$$COMPARE^MAGDQR03(T,V(T)) OK=0
"RTN","MAGDQR06",65,0)
 Q
"RTN","MAGDQR06",66,0)
 ;
"RTN","MAGDQR06",67,0)
Q0080090 ;O  Referring Physician's Name
"RTN","MAGDQR06",68,0)
 ; sensitive/employee?
"RTN","MAGDQR06",69,0)
 I SENSEMP D  Q  ; yes, scrub
"RTN","MAGDQR06",70,0)
 . S V(T)="IMAGPROVIDER,SENSITIVE"
"RTN","MAGDQR06",71,0)
 . Q
"RTN","MAGDQR06",72,0)
 ; no
"RTN","MAGDQR06",73,0)
 D:TYPE="R"
"RTN","MAGDQR06",74,0)
 . S X=$P($G(^RADPT(MAGDFN,"DT",MAGRORD,"P",MAGINTERP,0)),"^",14) ; IA # 1172
"RTN","MAGDQR06",75,0)
 . S V(T)=$$GET1^DIQ(200,(+X)_",",.01)
"RTN","MAGDQR06",76,0)
 . Q
"RTN","MAGDQR06",77,0)
 D:TYPE="C"
"RTN","MAGDQR06",78,0)
 . N G0
"RTN","MAGDQR06",79,0)
 . I IMAGE="" S V(T)="" Q
"RTN","MAGDQR06",80,0)
 . S G0=$$GMRC($G(ACCNUM),MAGIEN) I 'G0 S V(T)="" Q
"RTN","MAGDQR06",81,0)
 . S V(T)=$$GET1^DIQ(123,G0,10,"E") ; IA # 4110
"RTN","MAGDQR06",82,0)
 . Q
"RTN","MAGDQR06",83,0)
 ; MLH: do not match per WP 3/25/09
"RTN","MAGDQR06",84,0)
 ;;;S:'$$COMPARE^MAGDQR03(T,V(T)) OK=0
"RTN","MAGDQR06",85,0)
 Q
"RTN","MAGDQR06",86,0)
 ;
"RTN","MAGDQR06",87,0)
Q0081030 ;O  Study Description
"RTN","MAGDQR06",88,0)
 ; sensitive/employee?
"RTN","MAGDQR06",89,0)
 I SENSEMP D  Q  ; yes, scrub
"RTN","MAGDQR06",90,0)
 . N I S I=$O(REQ(T,"")) S:I V(T)=$S($G(REQ(T,I))]"":REQ(T,I),1:"")
"RTN","MAGDQR06",91,0)
 . Q
"RTN","MAGDQR06",92,0)
 ; no
"RTN","MAGDQR06",93,0)
 S V(T)=$$STYDESC^MAGUE001(IMAGE)
"RTN","MAGDQR06",94,0)
 S:'$$COMPARE^MAGDQR03(T,V(T)) OK=0
"RTN","MAGDQR06",95,0)
 Q
"RTN","MAGDQR06",96,0)
 ;
"RTN","MAGDQR06",97,0)
Q0080100 ;O  >Code Value
"RTN","MAGDQR06",98,0)
 D:TYPE="R"
"RTN","MAGDQR06",99,0)
 . S X=$P($G(^RADPT(MAGDFN,"DT",MAGRORD,"P",MAGINTERP,0)),"^",2) ; IA # 1172
"RTN","MAGDQR06",100,0)
 . S X=$P($G(^RAMIS(71,+X,0)),"^",9) ; IA # 1174
"RTN","MAGDQR06",101,0)
 . S X=$$CPT^ICPTCOD(+X) ; IA # 1995, supported reference
"RTN","MAGDQR06",102,0)
 . S V("0008,1030",1,T)=$P(X,"^",2)
"RTN","MAGDQR06",103,0)
 . Q
"RTN","MAGDQR06",104,0)
 D:TYPE="C"
"RTN","MAGDQR06",105,0)
 . N G0
"RTN","MAGDQR06",106,0)
 . I IMAGE="" S V(T)="" Q
"RTN","MAGDQR06",107,0)
 . S G0=$$GMRC($G(ACCNUM),IMAGE) I 'G0 S V(T)="" Q
"RTN","MAGDQR06",108,0)
 . S V(T)=$$GET1^DIQ(123,G0,4,"I") ; IA # 4110
"RTN","MAGDQR06",109,0)
 . Q
"RTN","MAGDQR06",110,0)
 Q
"RTN","MAGDQR06",111,0)
 ;
"RTN","MAGDQR06",112,0)
Q0080104 ;O  >Code Meaning
"RTN","MAGDQR06",113,0)
 D:TYPE="R"
"RTN","MAGDQR06",114,0)
 . S X=$P($G(^RADPT(MAGDFN,"DT",MAGRORD,"P",MAGINTERP,0)),"^",2) ; IA # 1172
"RTN","MAGDQR06",115,0)
 . S X=$P($G(^RAMIS(71,+X,0)),"^",9) ; IA # 1174
"RTN","MAGDQR06",116,0)
 . S X=$$CPT^ICPTCOD(+X) ; IA # 1995, supported reference
"RTN","MAGDQR06",117,0)
 . S V("0008,1030",1,T)=$P(X,"^",3)
"RTN","MAGDQR06",118,0)
 . Q
"RTN","MAGDQR06",119,0)
 D:TYPE="C"
"RTN","MAGDQR06",120,0)
 . N G0
"RTN","MAGDQR06",121,0)
 . I IMAGE="" S V(T)="" Q
"RTN","MAGDQR06",122,0)
 . S G0=$$GMRC($G(ACCNUM),IMAGE) I 'G0 S V(T)="" Q
"RTN","MAGDQR06",123,0)
 . S V(T)=$$GET1^DIQ(123,G0,4,"E") ; IA # 4110
"RTN","MAGDQR06",124,0)
 . Q
"RTN","MAGDQR06",125,0)
 Q
"RTN","MAGDQR06",126,0)
 ;
"RTN","MAGDQR06",127,0)
Q0081060 ;O  Name of Physician(s) Reading Study
"RTN","MAGDQR06",128,0)
 I SENSEMP D  Q  ; yes, scrub
"RTN","MAGDQR06",129,0)
 . S V(T)="IMAGPROVIDER,SENSITIVE"
"RTN","MAGDQR06",130,0)
 . Q
"RTN","MAGDQR06",131,0)
 ; no
"RTN","MAGDQR06",132,0)
 D:TYPE="R"
"RTN","MAGDQR06",133,0)
 . S X=$P($G(^RADPT(MAGDFN,"DT",MAGRORD,"P",MAGINTERP,0)),"^",17) ; IA # 1172
"RTN","MAGDQR06",134,0)
 . S X=$P($G(^RARPT(+X,0)),"^",9) ; IA # 1171
"RTN","MAGDQR06",135,0)
 . S V(T)=$$GET1^DIQ(200,(+X)_",",.01)
"RTN","MAGDQR06",136,0)
 . Q
"RTN","MAGDQR06",137,0)
 Q:TYPE="C"
"RTN","MAGDQR06",138,0)
 ; MLH:  do not match per WP 3/25/09
"RTN","MAGDQR06",139,0)
 ;;;S:'$$COMPARE^MAGDQR03(T,V(T)) OK=0
"RTN","MAGDQR06",140,0)
 Q
"RTN","MAGDQR06",141,0)
 ;
"RTN","MAGDQR06",142,0)
Q0081080 ;O  Admitting Diagnosis Description
"RTN","MAGDQR06",143,0)
 ; ? ? ?
"RTN","MAGDQR06",144,0)
 ;;;S:'$$COMPARE^MAGDQR03(T,V(T)) OK=0
"RTN","MAGDQR06",145,0)
 Q
"RTN","MAGDQR06",146,0)
 ;
"RTN","MAGDQR06",147,0)
Q01021B0 ;O  Additional Patient History
"RTN","MAGDQR06",148,0)
 ; sensitive/employee?
"RTN","MAGDQR06",149,0)
 I SENSEMP D  Q  ; yes, scrub
"RTN","MAGDQR06",150,0)
 . N I S I=$O(REQ(T,"")) S:I V(T)=$S($G(REQ(T,I))]"":REQ(T,I),1:"")
"RTN","MAGDQR06",151,0)
 . Q
"RTN","MAGDQR06",152,0)
 ; no
"RTN","MAGDQR06",153,0)
 N D1,I,T0,X
"RTN","MAGDQR06",154,0)
 Q:TYPE="R"
"RTN","MAGDQR06",155,0)
 D:TYPE="C"
"RTN","MAGDQR06",156,0)
 . I IMAGE="" S V(T)="" Q
"RTN","MAGDQR06",157,0)
 . S X=$G(^MAG(2005,MAGIEN,2))
"RTN","MAGDQR06",158,0)
 . I $P(X,"^",6)'=8925 S V(T)="" Q
"RTN","MAGDQR06",159,0)
 . S X=$P($G(^TIU(8925,+$P(X,"^",7),15)),"^",2) ; Signed By field
"RTN","MAGDQR06",160,0)
 . S:X X=$$GET1^DIQ(200,(+X)_",",.01)
"RTN","MAGDQR06",161,0)
 . S V(T)=X
"RTN","MAGDQR06",162,0)
 . Q
"RTN","MAGDQR06",163,0)
 S:'$$COMPARE^MAGDQR03(T,V(T)) OK=0
"RTN","MAGDQR06",164,0)
 Q
"RTN","MAGDQR06",165,0)
 ;
"RTN","MAGDQR06",166,0)
Q0104000 ;O  Patient Comments
"RTN","MAGDQR06",167,0)
 ; ? ? ?
"RTN","MAGDQR06",168,0)
 ; (there is a modality that passes the accession number in this field)
"RTN","MAGDQR06",169,0)
 ;;;S:'$$COMPARE^MAGDQR03(T,V(T)) OK=0
"RTN","MAGDQR06",170,0)
 Q
"RTN","MAGDQR06",171,0)
 ;
"RTN","MAGDQR06",172,0)
U008010C ;O  Interpretation Author
"RTN","MAGDQR06",173,0)
 I SENSEMP D  Q  ; yes, scrub
"RTN","MAGDQR06",174,0)
 . S V(T)="IMAGPROVIDER,SENSITIVE"
"RTN","MAGDQR06",175,0)
 . Q
"RTN","MAGDQR06",176,0)
 ; no
"RTN","MAGDQR06",177,0)
 D:TYPE="R"
"RTN","MAGDQR06",178,0)
 . S X=+$P($G(^RADPT(MAGDFN,"DT",MAGRORD,"P",MAGINTERP,0)),"^",12) ; IA # 1172
"RTN","MAGDQR06",179,0)
 . S V(T)=$$GET1^DIQ(200,(+X)_",",.01)
"RTN","MAGDQR06",180,0)
 . Q
"RTN","MAGDQR06",181,0)
 D:TYPE="C"
"RTN","MAGDQR06",182,0)
 . I MAGIEN="" S V(T)="" Q
"RTN","MAGDQR06",183,0)
 . S X=$G(^MAG(2005,MAGIEN,2))
"RTN","MAGDQR06",184,0)
 . I $P(X,"^",6)'=8925 S V(T)="" Q
"RTN","MAGDQR06",185,0)
 . S X=$P($G(^TIU(8925,+$P(X,"^",7),15)),"^",2) ; Signed By field
"RTN","MAGDQR06",186,0)
 . S:X X=$$GET1^DIQ(200,(+X)_",",.01)
"RTN","MAGDQR06",187,0)
 . S V(T)=X
"RTN","MAGDQR06",188,0)
 . Q
"RTN","MAGDQR06",189,0)
 ; MLH:  do not match per WP 3/25/09
"RTN","MAGDQR06",190,0)
 ;;;S:'$$COMPARE^MAGDQR03(T,V(T)) OK=0
"RTN","MAGDQR06",191,0)
 Q
"RTN","MAGDQR06",192,0)
 ;
"RTN","MAGDQR06",193,0)
GMRC(ACCNUM,IMAGE) ; Return consult number for image
"RTN","MAGDQR06",194,0)
 N G0,P,T0,X
"RTN","MAGDQR06",195,0)
 S G0=+$TR($G(ACCNUM),"GMRCgmrc-") Q:G0 G0
"RTN","MAGDQR06",196,0)
 S X=$G(^MAG(2005,+IMAGE,2)),P=$P(X,"^",6) Q:P'=8925 0
"RTN","MAGDQR06",197,0)
 S T0=$P(X,"^",7) Q:'T0 0
"RTN","MAGDQR06",198,0)
 S X=$P($G(^TIU(8925,T0,14)),"^",5) Q:X'[";GMR(123," 0
"RTN","MAGDQR06",199,0)
 Q +X
"RTN","MAGDQR07")
0^32^B30347605
"RTN","MAGDQR07",1,0)
MAGDQR07 ;WOIFO/EdM - Imaging RPCs for Query/Retrieve ; 25 Sep 2008 5:15 PM
"RTN","MAGDQR07",2,0)
 ;;3.0;IMAGING;**54**;03-July-2009;;Build 1424
"RTN","MAGDQR07",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDQR07",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDQR07",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDQR07",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDQR07",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDQR07",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDQR07",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDQR07",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDQR07",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDQR07",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDQR07",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDQR07",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDQR07",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDQR07",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDQR07",17,0)
 ;;
"RTN","MAGDQR07",18,0)
 Q
"RTN","MAGDQR07",19,0)
 ; -- overflow from MAGDQR02
"RTN","MAGDQR07",20,0)
 ;
"RTN","MAGDQR07",21,0)
ACCNUM ; TAG = 0008,0050  R  Accession Number
"RTN","MAGDQR07",22,0)
 N ACCNUM,D0,IMAGE
"RTN","MAGDQR07",23,0)
 S P="" F  S P=$O(REQ(T,P)) Q:P=""  D:REQ(T,P)'=""
"RTN","MAGDQR07",24,0)
 . ; The references below to ^RADPT are permitted according to the
"RTN","MAGDQR07",25,0)
 . ; existing Integration Agreement # 1172
"RTN","MAGDQR07",26,0)
 . ;
"RTN","MAGDQR07",27,0)
 . ; First scan for Radiology Related Images
"RTN","MAGDQR07",28,0)
 . S ANY=1
"RTN","MAGDQR07",29,0)
 . S I=$$MATCHD^MAGDQR03(REQ(T,P),"^RADPT(""ADC"",LOOP)","^TMP(""MAG"",$J,""QR"",5,LOOP)")
"RTN","MAGDQR07",30,0)
 . S V="" F  S V=$O(^TMP("MAG",$J,"QR",5,V)) Q:V=""  D
"RTN","MAGDQR07",31,0)
 . . S MAGD0="" F  S MAGD0=$O(^RADPT("ADC",V,MAGD0)) Q:MAGD0=""  D
"RTN","MAGDQR07",32,0)
 . . . S MAGD1="" F  S MAGD1=$O(^RADPT("ADC",V,MAGD0,MAGD1)) Q:MAGD1=""  D
"RTN","MAGDQR07",33,0)
 . . . . S MAGD2="" F  S MAGD2=$O(^RADPT("ADC",V,MAGD0,MAGD1,MAGD2)) Q:MAGD2=""  D
"RTN","MAGDQR07",34,0)
 . . . . . S ^TMP("MAG",$J,"QR",6,"R^"_MAGD0_"^"_MAGD1_"^"_MAGD2)="",ACC=1
"RTN","MAGDQR07",35,0)
 . . . . . Q
"RTN","MAGDQR07",36,0)
 . . . . Q
"RTN","MAGDQR07",37,0)
 . . . Q
"RTN","MAGDQR07",38,0)
 . . Q
"RTN","MAGDQR07",39,0)
 . ; Then scan for Consult Related Images
"RTN","MAGDQR07",40,0)
 . S ACCNUM=REQ(T,P) S:$E(ACCNUM,1,5)="GMRC-" ACCNUM=$E(ACCNUM,6,$L(ACCNUM))
"RTN","MAGDQR07",41,0)
 . K ^TMP("MAG",$J,"QR",5)
"RTN","MAGDQR07",42,0)
 . ; For the time being, we can only do this:
"RTN","MAGDQR07",43,0)
 . S:ACCNUM ^TMP("MAG",$J,"QR",5,ACCNUM)=""
"RTN","MAGDQR07",44,0)
 . S I=$$MATCHD^MAGDQR03(ACCNUM,"^GMR(123,LOOP)","^TMP(""MAG"",$J,""QR"",5,LOOP)")
"RTN","MAGDQR07",45,0)
 . S D0="" F  S D0=$O(^TMP("MAG",$J,"QR",5,D0)) Q:D0=""  D
"RTN","MAGDQR07",46,0)
 . . N MAGDFN
"RTN","MAGDQR07",47,0)
 . . S MAGDFN=$$GET1^DIQ(123,D0,.02,"I") Q:'MAGDFN  ; No Patient IEN
"RTN","MAGDQR07",48,0)
 . . Q:$$GET1^DIQ(123,D0,8)="CANCELLED"
"RTN","MAGDQR07",49,0)
 . . I $O(^MAG(2006.5839,"C",123,D0,0)) D  Q  ; 1+ studies assoc w/consult
"RTN","MAGDQR07",50,0)
 . . . S IMAGE=0
"RTN","MAGDQR07",51,0)
 . . . F  S IMAGE=$O(^MAG(2006.5839,"C",123,D0,IMAGE)) Q:'IMAGE  D
"RTN","MAGDQR07",52,0)
 . . . . S X=$G(^MAG(2006.5839,IMAGE,0)) Q:X=""
"RTN","MAGDQR07",53,0)
 . . . . S X=MAGDFN_"^"_$P(X,"^",1)_"^"_$P(X,"^",2)_"^"_$P(X,"^",3)_"^"_ACCNUM
"RTN","MAGDQR07",54,0)
 . . . . S ^TMP("MAG",$J,"QR",6,"C^"_X)="",ACC=1
"RTN","MAGDQR07",55,0)
 . . . . Q
"RTN","MAGDQR07",56,0)
 . . . Q
"RTN","MAGDQR07",57,0)
 . . D  ; Otherwise find images in ^TIU
"RTN","MAGDQR07",58,0)
 . . . N I,RESULT,X
"RTN","MAGDQR07",59,0)
 . . . D TIUALL^MAGDGMRC(D0,.RESULT)
"RTN","MAGDQR07",60,0)
 . . . S I="" F  S I=$O(RESULT(I)) Q:I=""  D
"RTN","MAGDQR07",61,0)
 . . . . S X=MAGDFN_"^8925^"_$P(RESULT(I),"^",1)_"^"_$P(RESULT(I),"^",3)_"^"_$P(RESULT(I),"^",2)
"RTN","MAGDQR07",62,0)
 . . . . S ^TMP("MAG",$J,"QR",6,"C^"_X)="",ACC=1
"RTN","MAGDQR07",63,0)
 . . . . Q
"RTN","MAGDQR07",64,0)
 . . . Q
"RTN","MAGDQR07",65,0)
 . . Q
"RTN","MAGDQR07",66,0)
 . Q
"RTN","MAGDQR07",67,0)
 Q
"RTN","MAGDQR07",68,0)
 ;
"RTN","MAGDQR07",69,0)
STUDYID ; TAG = 0020,0010  R  Study ID
"RTN","MAGDQR07",70,0)
 ; The references below to ^RADPT are permitted according to the
"RTN","MAGDQR07",71,0)
 ; existing Integration Agreement # 1172
"RTN","MAGDQR07",72,0)
 N D1,ID
"RTN","MAGDQR07",73,0)
 S P="" F  S P=$O(REQ(T,P)) Q:P=""  S ID=+REQ(T,P) D:ID
"RTN","MAGDQR07",74,0)
 . S ANY=1
"RTN","MAGDQR07",75,0)
 . ; First scan for Radiology Related Images
"RTN","MAGDQR07",76,0)
 . S I=$$MATCHD^MAGDQR03("*-"_ID,"^RADPT(""ADC"",LOOP)","^TMP(""MAG"",$J,""QR"",9,LOOP)")
"RTN","MAGDQR07",77,0)
 . S V="" F  S V=$O(^TMP("MAG",$J,"QR",9,V)) Q:V=""  D
"RTN","MAGDQR07",78,0)
 . . S MAGD0="" F  S MAGD0=$O(^RADPT("ADC",V,MAGD0)) Q:MAGD0=""  D
"RTN","MAGDQR07",79,0)
 . . . S MAGD1="" F  S MAGD1=$O(^RADPT("ADC",V,MAGD0,MAGD1)) Q:MAGD1=""  D
"RTN","MAGDQR07",80,0)
 . . . . S MAGD2="" F  S MAGD2=$O(^RADPT("ADC",V,MAGD0,MAGD1,MAGD2)) Q:MAGD2=""  D
"RTN","MAGDQR07",81,0)
 . . . . . S ^TMP("MAG",$J,"QR",10,"R^"_MAGD0_"^"_MAGD1_"^"_MAGD2)="",SID=1
"RTN","MAGDQR07",82,0)
 . . . . . Q
"RTN","MAGDQR07",83,0)
 . . . . Q
"RTN","MAGDQR07",84,0)
 . . . Q
"RTN","MAGDQR07",85,0)
 . . Q
"RTN","MAGDQR07",86,0)
 . ; Then scan for Consult Related Images
"RTN","MAGDQR07",87,0)
 . S D1=0 F  S D1=$O(^GMR(123,ID,50,D1)) Q:'D1  D
"RTN","MAGDQR07",88,0)
 . . N I,T,X
"RTN","MAGDQR07",89,0)
 . . S X=$P($G(^GMR(123,ID,50,D1,0)),"^",1) Q:X'[";TIU(8925,"
"RTN","MAGDQR07",90,0)
 . . S T=+X
"RTN","MAGDQR07",91,0)
 . . S MAGD1="" F  S MAGD1=$O(^TIU(8925.91,"B",T,MAGD1)) Q:MAGD1=""  D
"RTN","MAGDQR07",92,0)
 . . . S X=$G(^TIU(8925.91,MAGD1,0)),I=$P(X,"^",2) Q:'I
"RTN","MAGDQR07",93,0)
 . . . S ^TMP("MAG",$J,"QR",10,"C^"_MAGD0_"^8925^"_T_"^"_I_"^"_ID)="",SID=1
"RTN","MAGDQR07",94,0)
 . . . Q
"RTN","MAGDQR07",95,0)
 . . Q
"RTN","MAGDQR07",96,0)
 . Q
"RTN","MAGDQR07",97,0)
 Q
"RTN","MAGDQR07",98,0)
 ;
"RTN","MAGDQR07",99,0)
ACCSID ; Overflow from MAGDQR02
"RTN","MAGDQR07",100,0)
 N OK,P1,P2,P3,P4,TYPE
"RTN","MAGDQR07",101,0)
 S P="" F  S P=$O(^TMP("MAG",$J,"QR",12,P)) Q:P=""  D  Q:FATAL
"RTN","MAGDQR07",102,0)
 . N IMAGE,IARRAY
"RTN","MAGDQR07",103,0)
 . S TYPE=$P(P,"^",1)
"RTN","MAGDQR07",104,0)
 . D:TYPE="R"  ; Radiology Images
"RTN","MAGDQR07",105,0)
 . . S MAGD0=$P(P,"^",2),MAGD1=$P(P,"^",3),MAGD2=$P(P,"^",4)
"RTN","MAGDQR07",106,0)
 . . I PAT+SSN,'$D(^TMP("MAG",$J,"QR",11,MAGD0)) Q
"RTN","MAGDQR07",107,0)
 . . S OK=0 D  Q:'OK  Q:FATAL
"RTN","MAGDQR07",108,0)
 . . . S V=$P($G(^RADPT(MAGD0,"DT",MAGD1,"P",MAGD2,0)),"^",17) Q:'V  ; IA # 1172
"RTN","MAGDQR07",109,0)
 . . . S P1=0 F  S P1=$O(^RARPT(V,2005,P1)) Q:'P1  D  Q:OK  Q:FATAL  ; IA # 1171
"RTN","MAGDQR07",110,0)
 . . . . S P2=+$G(^RARPT(V,2005,P1,0)) Q:'P2  ; IA # 1171
"RTN","MAGDQR07",111,0)
 . . . . I UID,$D(^TMP("MAG",$J,"QR",8,P2)) S OK=1,IARRAY(P2)="" Q
"RTN","MAGDQR07",112,0)
 . . . . ; don't set 'OK' flag next line, allow mult. studies per acc#
"RTN","MAGDQR07",113,0)
 . . . . I 'UID S IARRAY(P2)="" Q
"RTN","MAGDQR07",114,0)
 . . . . S P3=0 F  S P3=$O(^MAG(2005,P2,1,P3)) Q:'P3  D  Q:OK  Q:FATAL
"RTN","MAGDQR07",115,0)
 . . . . . S P4=$P($G(^MAG(2005,P2,1,P3,0)),"^",1) Q:'P4
"RTN","MAGDQR07",116,0)
 . . . . . I UID,$D(^TMP("MAG",$J,"QR",8,P4)) S OK=1,IARRAY(P4)="" Q
"RTN","MAGDQR07",117,0)
 . . . . . ; don't set 'OK' flag next line, allow mult. studies / acc#
"RTN","MAGDQR07",118,0)
 . . . . . I 'UID S OK=1,IARRAY(P4)="" Q
"RTN","MAGDQR07",119,0)
 . . . . . Q
"RTN","MAGDQR07",120,0)
 . . . . Q
"RTN","MAGDQR07",121,0)
 . . . Q
"RTN","MAGDQR07",122,0)
 . . Q
"RTN","MAGDQR07",123,0)
 . D:TYPE="C"  ; Consult Images
"RTN","MAGDQR07",124,0)
 . . ; P = C ^ DFN ^ File# ^ IEN ^ Image# ^ Accession#
"RTN","MAGDQR07",125,0)
 . . S IMAGE=$P(P,"^",5) Q:'IMAGE  S IARRAY(IMAGE)=""
"RTN","MAGDQR07",126,0)
 . . S MAGD0=+$P($G(^MAG(2005,+IMAGE,0)),"^",7)
"RTN","MAGDQR07",127,0)
 . . S (MAGD1,MAGD2)=0 ; Not a radiology study...
"RTN","MAGDQR07",128,0)
 . . S ACCNUM=$P(P,"^",6)
"RTN","MAGDQR07",129,0)
 . . Q
"RTN","MAGDQR07",130,0)
 . S IMAGE=""
"RTN","MAGDQR07",131,0)
 . F  S IMAGE=$O(IARRAY(IMAGE)) Q:'IMAGE  D
"RTN","MAGDQR07",132,0)
 . . D RESULT^MAGDQR03(TYPE,RESULT,IMAGE,MAGD0,MAGD1,MAGD2)
"RTN","MAGDQR07",133,0)
 . . Q
"RTN","MAGDQR07",134,0)
 . Q
"RTN","MAGDQR07",135,0)
 Q
"RTN","MAGDQR07",136,0)
 ;
"RTN","MAGDQR08")
0^33^B33379098
"RTN","MAGDQR08",1,0)
MAGDQR08 ;WOIFO/EdM - Cross-References for Query/Retrieve ; 10/10/2007 07:40
"RTN","MAGDQR08",2,0)
 ;;3.0;IMAGING;**54**;03-July-2009;;Build 1424
"RTN","MAGDQR08",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDQR08",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDQR08",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDQR08",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDQR08",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDQR08",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDQR08",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDQR08",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDQR08",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDQR08",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDQR08",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDQR08",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDQR08",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDQR08",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDQR08",17,0)
 ;;
"RTN","MAGDQR08",18,0)
 Q
"RTN","MAGDQR08",19,0)
 ;
"RTN","MAGDQR08",20,0)
UIDS ; Overflow from MAGDQR02
"RTN","MAGDQR08",21,0)
 N FATAL,IDX,PAT,PAT0
"RTN","MAGDQR08",22,0)
 S FATAL=0
"RTN","MAGDQR08",23,0)
 F I=20:1:23 K ^TMP("MAG",$J,"QR",I)
"RTN","MAGDQR08",24,0)
 S T="0020,000D",(ANY,PAT)=0
"RTN","MAGDQR08",25,0)
 S P="" F  S P=$O(REQ(T,P)) Q:P=""  D:REQ(T,P)'=""
"RTN","MAGDQR08",26,0)
 . S ANY=1 K ^TMP("MAG",$J,"QR",7)
"RTN","MAGDQR08",27,0)
 . S I=$$MATCHD^MAGDQR03(REQ(T,P),"^MAG(2005,""P"",LOOP)","^TMP(""MAG"",$J,""QR"",7,LOOP)")
"RTN","MAGDQR08",28,0)
 . S V="" F  S V=$O(^TMP("MAG",$J,"QR",7,V)) Q:V=""  D
"RTN","MAGDQR08",29,0)
 . . S PAT=""
"RTN","MAGDQR08",30,0)
 . . S I="" F  S I=$O(^MAG(2005,"P",V,I)) Q:I=""  D
"RTN","MAGDQR08",31,0)
 . . . N C,X
"RTN","MAGDQR08",32,0)
 . . . ; If this image has a parent,
"RTN","MAGDQR08",33,0)
 . . . ; its UID is an image UID and not a study UID
"RTN","MAGDQR08",34,0)
 . . . S X=$G(^MAG(2005,I,0)),PAT0=$P(X,"^",7)
"RTN","MAGDQR08",35,0)
 . . . S IDX=$G(^MAG(2005,I,2))\2_" "_PAT0
"RTN","MAGDQR08",36,0)
 . . . D:PAT0
"RTN","MAGDQR08",37,0)
 . . . . I PAT="" S PAT=PAT0 Q
"RTN","MAGDQR08",38,0)
 . . . . Q:PRMUID=1
"RTN","MAGDQR08",39,0)
 . . . . S:PAT'=PAT0 PAT=-1 ; Duplicate UID if different patient...
"RTN","MAGDQR08",40,0)
 . . . . Q
"RTN","MAGDQR08",41,0)
 . . . Q:$P(X,"^",10)
"RTN","MAGDQR08",42,0)
 . . . S UID=1,^TMP("MAG",$J,"QR",20,I)=""
"RTN","MAGDQR08",43,0)
 . . . S C=0 F  S C=$O(^MAG(2005,I,1,C)) Q:'C  D
"RTN","MAGDQR08",44,0)
 . . . . S X=+$P($G(^MAG(2005,I,1,C,0)),"^",1)
"RTN","MAGDQR08",45,0)
 . . . . S:X ^TMP("MAG",$J,"QR",21,X)=""
"RTN","MAGDQR08",46,0)
 . . . . Q
"RTN","MAGDQR08",47,0)
 . . . Q
"RTN","MAGDQR08",48,0)
 . . Q
"RTN","MAGDQR08",49,0)
 . Q
"RTN","MAGDQR08",50,0)
 D:PAT<0
"RTN","MAGDQR08",51,0)
 . I (PRMUID=2)!(PRMUID=3) S PRMUID(T)="" Q
"RTN","MAGDQR08",52,0)
 . D ERR^MAGDQR01("Duplicate Study UID (tag 0020,000D)")
"RTN","MAGDQR08",53,0)
 . S FATAL=1
"RTN","MAGDQR08",54,0)
 . Q
"RTN","MAGDQR08",55,0)
 S T="0020,000E"
"RTN","MAGDQR08",56,0)
 S P="" F  S P=$O(REQ(T,P)) Q:P=""  D:REQ(T,P)'=""
"RTN","MAGDQR08",57,0)
 . S ANY=1 K ^TMP("MAG",$J,"QR",7)
"RTN","MAGDQR08",58,0)
 . S I=$$MATCHD^MAGDQR03(REQ(T,P),"^MAG(2005,""SERIESUID"",LOOP)","^TMP(""MAG"",$J,""QR"",7,LOOP)")
"RTN","MAGDQR08",59,0)
 . S V="" F  S V=$O(^TMP("MAG",$J,"QR",7,V)) Q:V=""  D
"RTN","MAGDQR08",60,0)
 . . S I="" F  S I=$O(^MAG(2005,"SERIESUID",V,I)) Q:I=""  D
"RTN","MAGDQR08",61,0)
 . . . S UID=1,^TMP("MAG",$J,"QR",22,I)=""
"RTN","MAGDQR08",62,0)
 . . . Q
"RTN","MAGDQR08",63,0)
 . . Q
"RTN","MAGDQR08",64,0)
 . Q
"RTN","MAGDQR08",65,0)
 S T="0008,0018"
"RTN","MAGDQR08",66,0)
 S P="" F  S P=$O(REQ(T,P)) Q:P=""  D:REQ(T,P)'=""
"RTN","MAGDQR08",67,0)
 . S ANY=1 K ^TMP("MAG",$J,"QR",7)
"RTN","MAGDQR08",68,0)
 . S I=$$MATCHD^MAGDQR03(REQ(T,P),"^MAG(2005,""P"",LOOP)","^TMP(""MAG"",$J,""QR"",7,LOOP)")
"RTN","MAGDQR08",69,0)
 . S V="" F  S V=$O(^TMP("MAG",$J,"QR",7,V)) Q:V=""  D
"RTN","MAGDQR08",70,0)
 . . S PAT=""
"RTN","MAGDQR08",71,0)
 . . S I="" F  S I=$O(^MAG(2005,"P",V,I)) Q:I=""  D
"RTN","MAGDQR08",72,0)
 . . . ; If this image has a parent,
"RTN","MAGDQR08",73,0)
 . . . ; its UID is an image UID and not a study UID
"RTN","MAGDQR08",74,0)
 . . . S X=$G(^MAG(2005,I,0)),PAT0=$P(X,"^",7)
"RTN","MAGDQR08",75,0)
 . . . S IDX=$G(^MAG(2005,I,2))\2_" "_PAT0
"RTN","MAGDQR08",76,0)
 . . . D:PAT0
"RTN","MAGDQR08",77,0)
 . . . . I PAT="" S PAT=PAT0 Q
"RTN","MAGDQR08",78,0)
 . . . . Q:PRMUID=1
"RTN","MAGDQR08",79,0)
 . . . . S:PAT'=PAT0 PAT=-1 ; Duplicate UID if different patient...
"RTN","MAGDQR08",80,0)
 . . . . Q
"RTN","MAGDQR08",81,0)
 . . . Q:$P(X,"^",10)
"RTN","MAGDQR08",82,0)
 . . . S UID=1,^TMP("MAG",$J,"QR",23,I)=""
"RTN","MAGDQR08",83,0)
 . . . Q
"RTN","MAGDQR08",84,0)
 . . Q
"RTN","MAGDQR08",85,0)
 . Q
"RTN","MAGDQR08",86,0)
 D:PAT<0
"RTN","MAGDQR08",87,0)
 . I (PRMUID=2)!(PRMUID=3) S PRMUID(T)="" Q
"RTN","MAGDQR08",88,0)
 . D ERR^MAGDQR01("Duplicate Series UID (tag 0008,0018)")
"RTN","MAGDQR08",89,0)
 . S FATAL=1,ANY=0
"RTN","MAGDQR08",90,0)
 . Q
"RTN","MAGDQR08",91,0)
 I FATAL D ERRSAV^MAGDQR01 Q
"RTN","MAGDQR08",92,0)
 ;
"RTN","MAGDQR08",93,0)
 S OK=1,X="Study Series Image",UIDS=""
"RTN","MAGDQR08",94,0)
 F T=23,22 S I="" F  S I=$O(^TMP("MAG",$J,"QR",T,I)) Q:I=""  D  Q:'OK
"RTN","MAGDQR08",95,0)
 . F P=22,21 D
"RTN","MAGDQR08",96,0)
 . . Q:P'<T  Q:'$D(^TMP("MAG",$J,"QR",P))  Q:$D(^TMP("MAG",$J,"QR",P,I))
"RTN","MAGDQR08",97,0)
 . . S OK=0 S:UIDS'="" UIDS=UIDS=UIDS_", "
"RTN","MAGDQR08",98,0)
 . . S UIDS=UIDS_$P(X," ",P)_"/"_$P(X," ",T)
"RTN","MAGDQR08",99,0)
 . . Q
"RTN","MAGDQR08",100,0)
 . Q
"RTN","MAGDQR08",101,0)
 S T=0 S:OK T=1 F I=23,22,20 D:T
"RTN","MAGDQR08",102,0)
 . Q:'$D(^TMP("MAG",$J,"QR",I))
"RTN","MAGDQR08",103,0)
 . M ^TMP("MAG",$J,"QR",8)=^TMP("MAG",$J,"QR",I)
"RTN","MAGDQR08",104,0)
 . S T=0
"RTN","MAGDQR08",105,0)
 . Q
"RTN","MAGDQR08",106,0)
 F I=20:1:23 K ^TMP("MAG",$J,"QR",I)
"RTN","MAGDQR08",107,0)
 Q
"RTN","MAGDQR08",108,0)
 ;
"RTN","MAGDQR08",109,0)
PRUNE ; Remove results from duplicate UIDs
"RTN","MAGDQR08",110,0)
 N ANY,IDX,OK,R1,X
"RTN","MAGDQR08",111,0)
 I PRMUID'=2,PRMUID'=3 Q
"RTN","MAGDQR08",112,0)
 S IDX=$O(^TMP("MAG",$J,"QR",99,""),-PRMUID*2+5) Q:IDX=""
"RTN","MAGDQR08",113,0)
 S ANY=0,OK=0
"RTN","MAGDQR08",114,0)
 S R1=0 F  S R1=$O(^MAGDQR(2006.5732,RESULT,1,R1)) Q:'R1  D
"RTN","MAGDQR08",115,0)
 . S X=$G(^MAGDQR(2006.5732,RESULT,1,R1,0))
"RTN","MAGDQR08",116,0)
 . S:$E(X,1,19)="0000,0902^Result # " OK=$D(^TMP("MAG",$J,"QR",99,IDX,R1))
"RTN","MAGDQR08",117,0)
 . I 'OK K ^MAGDQR(2006.5732,RESULT,1,R1) Q
"RTN","MAGDQR08",118,0)
 . Q:$E(X,1,19)'="0000,0902^Result # "
"RTN","MAGDQR08",119,0)
 . S ANY=ANY+1,$P(X,"# ",2)=ANY
"RTN","MAGDQR08",120,0)
 . S ^MAGDQR(2006.5732,RESULT,1,R1,0)=X
"RTN","MAGDQR08",121,0)
 . Q
"RTN","MAGDQR08",122,0)
 Q
"RTN","MAGDQR08",123,0)
 ;
"RTN","MAGDQR08",124,0)
ACCNUM(IMAGE) ; Calculate Accession Number for Image
"RTN","MAGDQR08",125,0)
 N GMRCPTR,PARENT,TIUPTR,X
"RTN","MAGDQR08",126,0)
 S X=$G(^MAG(2005,IMAGE,2)),PARENT=+$P(X,"^",6),TIUPTR=$P(X,"^",7)
"RTN","MAGDQR08",127,0)
 I PARENT'=8925,PARENT'=2006.5839 Q ""
"RTN","MAGDQR08",128,0)
 Q:'TIUPTR ""
"RTN","MAGDQR08",129,0)
 S GMRCPTR=$$GET1^DIQ(8925,TIUPTR,1405,"I") Q:GMRCPTR'[";GMR(123" "" ; IA # 3268
"RTN","MAGDQR08",130,0)
 Q "GMRC-"_(+GMRCPTR)
"RTN","MAGDQR08",131,0)
 ;
"RTN","MAGDQR08",132,0)
PROCNAM(IMAGE) ; Calculate Procedure Name for Image
"RTN","MAGDQR08",133,0)
 N PROCPTR,X
"RTN","MAGDQR08",134,0)
 S X=$G(^MAG(2005,IMAGE,40)),PROCPTR=$P(X,"^",4) Q:'PROCPTR ""
"RTN","MAGDQR08",135,0)
 S X=$G(^MAG(2005.84,PROCPTR,0))
"RTN","MAGDQR08",136,0)
 Q $P(X,"^",1)
"RTN","MAGDQR08",137,0)
 ;
"RTN","MAGDQR08",138,0)
PROCNUM(IMAGE) ; Calculate Procedure Number for Image
"RTN","MAGDQR08",139,0)
 N X
"RTN","MAGDQR08",140,0)
 S X=$G(^MAG(2005,IMAGE,40))
"RTN","MAGDQR08",141,0)
 Q $P(X,"^",4)
"RTN","MAGDQR08",142,0)
 ;
"RTN","MAGDQR08",143,0)
 ;
"RTN","MAGDQR08",144,0)
 ; This routine takes care of two cross-references on the Image File
"RTN","MAGDQR08",145,0)
 ;
"RTN","MAGDQR08",146,0)
 ;    ^MAG(2005,"CONSULT1",accession,image)=""
"RTN","MAGDQR08",147,0)
 ;    ^MAG(2005,"CONSULT2",procedure,accession,image)=""
"RTN","MAGDQR08",148,0)
 ;
"RTN","MAGDQR08",149,0)
 ; DA ---- Image #
"RTN","MAGDQR08",150,0)
 ; KILL -- flag: 0=SET, 1=KILL
"RTN","MAGDQR08",151,0)
 ;
"RTN","MAGDQR08",152,0)
X1(DA,KILL) N GP,PA,T0,X
"RTN","MAGDQR08",153,0)
 S X=$G(^MAG(2005,IMAGE,2)),PA=+$P(X,"^",6),T0=$P(X,"^",7)
"RTN","MAGDQR08",154,0)
 I PA'=8925,PA'=2006.5839 Q
"RTN","MAGDQR08",155,0)
 Q:'T0
"RTN","MAGDQR08",156,0)
 S GP=$$GET1^DIQ(8925,T0,1405,"I") Q:GP'[";GMR(123"
"RTN","MAGDQR08",157,0)
 I KILL K ^MAG(2005,"CONSULT1","GMRC-"_(+GP),IMAGE) Q
"RTN","MAGDQR08",158,0)
 S ^MAG(2005,"CONSULT1","GMRC-"_(+GP),IMAGE)=""
"RTN","MAGDQR08",159,0)
 Q
"RTN","MAGDQR08",160,0)
 ;
"RTN","MAGDQR08",161,0)
X2(IMAGE,KILL) N CO,GP,PA,PR,T0,X
"RTN","MAGDQR08",162,0)
 S X=$G(^MAG(2005,IMAGE,2)),PA=+$P(X,"^",6),T0=$P(X,"^",7)
"RTN","MAGDQR08",163,0)
 I PA'=8925,PA'=2006.5839 Q
"RTN","MAGDQR08",164,0)
 Q:'T0
"RTN","MAGDQR08",165,0)
 S X=$G(^MAG(2005,IMAGE,40)),PR=$P(X,"^",4) Q:'PR
"RTN","MAGDQR08",166,0)
 S X=$G(^MAG(2005.84,PR,0)),CO=$P(X,"^",1) Q:CO=""
"RTN","MAGDQR08",167,0)
 S GP=$$GET1^DIQ(8925,T0,1405,"I") Q:GP'[";GMR(123"
"RTN","MAGDQR08",168,0)
 I KILL K ^MAG(2005,"CONSULT2",CO,"GMRC-"_(+GP),IMAGE) Q
"RTN","MAGDQR08",169,0)
 S ^MAG(2005,"CONSULT2",CO,"GMRC-"_(+GP),IMAGE)=""
"RTN","MAGDQR08",170,0)
 Q
"RTN","MAGDQR08",171,0)
 ;
"RTN","MAGDQR08",172,0)
 ; ============================================================
"RTN","MAGDQR08",173,0)
 ; To be included in post-init (through TaskMan?):
"RTN","MAGDQR08",174,0)
 ;
"RTN","MAGDQR08",175,0)
REDO F X="CONSULT1","CONSULT2" K ^MAG(2005,X)
"RTN","MAGDQR08",176,0)
 S DA=0 F  S DA=$O(^MAG(2005,DA)) Q:'DA  D
"RTN","MAGDQR08",177,0)
 . D X1(DA,0)
"RTN","MAGDQR08",178,0)
 . D X2(DA,0)
"RTN","MAGDQR08",179,0)
 . Q
"RTN","MAGDQR08",180,0)
 Q
"RTN","MAGDQR08",181,0)
 ;
"RTN","MAGDRA2")
0^34^B25170126
"RTN","MAGDRA2",1,0)
MAGDRA2 ;WOIFO/LB -Routine for DICOM fix  [ 06/20/2001 08:56 ] ; 05/18/2007 11:23
"RTN","MAGDRA2",2,0)
 ;;3.0;IMAGING;**10,11,51,54**;03-July-2009;;Build 1424
"RTN","MAGDRA2",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDRA2",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRA2",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRA2",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRA2",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRA2",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRA2",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRA2",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRA2",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRA2",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRA2",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRA2",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRA2",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRA2",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRA2",17,0)
 ;;
"RTN","MAGDRA2",18,0)
 Q
"RTN","MAGDRA2",19,0)
 ; Routine to create the MAGDY variable needed by MAGDLB1 routine when
"RTN","MAGDRA2",20,0)
 ; manually correcting DICOM FIX files.
"RTN","MAGDRA2",21,0)
EN ;
"RTN","MAGDRA2",22,0)
 ; MAGDY variable to be created during this execution.
"RTN","MAGDRA2",23,0)
 N MAGBEG,MAGEND,MAGDFN,MAGOUT,MAGX,MAGXX,INFO,MAGNME,MAGSSN
"RTN","MAGDRA2",24,0)
 S MAGBEG=1070101,MAGEND=$$DT^XLFDT
"RTN","MAGDRA2",25,0)
READ ;
"RTN","MAGDRA2",26,0)
 S (MAGDFN,MAGX)=$$READ^MAGDRA3
"RTN","MAGDRA2",27,0)
 Q:MAGX="^"
"RTN","MAGDRA2",28,0)
 S MAGDFN=+MAGDFN
"RTN","MAGDRA2",29,0)
 I 'MAGDFN W !,"Entry not found, enter a ""^"" to quit." G READ
"RTN","MAGDRA2",30,0)
 ;
"RTN","MAGDRA2",31,0)
 I MAGX["~" G ONE  ;Lookup was on case number and successful
"RTN","MAGDRA2",32,0)
 S MAGXX=$$FIND1^DIC(70,"","","`"_MAGDFN)   ;Radiology patient
"RTN","MAGDRA2",33,0)
 ;
"RTN","MAGDRA2",34,0)
 I MAGDFN=MAGXX D
"RTN","MAGDRA2",35,0)
 . S INFO=$$PTINFO Q:$D(MAGERR)
"RTN","MAGDRA2",36,0)
 . S MAGNME=$P(INFO,"^"),MAGSSN=$P(INFO,"^",2)
"RTN","MAGDRA2",37,0)
 . K ^TMP($J,"RAE1")  ;Re-established by EN1^RA07PC1 -DBIA available
"RTN","MAGDRA2",38,0)
 . ; Set the beginning and ending date.
"RTN","MAGDRA2",39,0)
 . D EN1^RAO7PC1(MAGDFN,MAGBEG,MAGEND,500)
"RTN","MAGDRA2",40,0)
 . D:$D(^TMP($J,"RAE1")) LOOP^MAGDRA1
"RTN","MAGDRA2",41,0)
 . Q
"RTN","MAGDRA2",42,0)
 E  D  G:MAGX'="^" READ
"RTN","MAGDRA2",43,0)
 . W !,"No Radiology information found for the supplied answer.",$C(7)
"RTN","MAGDRA2",44,0)
 . Q
"RTN","MAGDRA2",45,0)
 Q
"RTN","MAGDRA2",46,0)
 ;
"RTN","MAGDRA2",47,0)
PTINFO() ;
"RTN","MAGDRA2",48,0)
 N INFO,MAGOUT
"RTN","MAGDRA2",49,0)
 I '$D(MAGDFN) Q ""
"RTN","MAGDRA2",50,0)
 D GETS^DIQ(2,MAGDFN,".01;.09","E","MAGOUT","MAGERR")
"RTN","MAGDRA2",51,0)
 I $D(MAGERR) Q ""
"RTN","MAGDRA2",52,0)
 I $D(MAGOUT) D  Q INFO
"RTN","MAGDRA2",53,0)
 . S INFO=$G(MAGOUT(2,MAGDFN_",",.01,"E"))
"RTN","MAGDRA2",54,0)
 . S INFO=INFO_"^"_$G(MAGOUT(2,MAGDFN_",",.09,"E"))
"RTN","MAGDRA2",55,0)
 . Q
"RTN","MAGDRA2",56,0)
 Q ""
"RTN","MAGDRA2",57,0)
 ;
"RTN","MAGDRA2",58,0)
LCASE(MAGDT,MAGCASE) ;
"RTN","MAGDRA2",59,0)
 Q $TR($TR($$FMTE^XLFDT(MAGDT,"2FD")," ","0"),"/","")_"-"_MAGCASE
"RTN","MAGDRA2",60,0)
 ;
"RTN","MAGDRA2",61,0)
IMG(MAGRPT) ;
"RTN","MAGDRA2",62,0)
 N INFO,MAGOUT,MAGERR
"RTN","MAGDRA2",63,0)
 I 'MAGRPT Q ""
"RTN","MAGDRA2",64,0)
 D GETS^DIQ(74,MAGRPT,"2005*","I","MAGOUT","MAGERR")
"RTN","MAGDRA2",65,0)
 I $D(MAGERR) Q ""
"RTN","MAGDRA2",66,0)
 I $D(MAGOUT(74.02005)) Q " i"
"RTN","MAGDRA2",67,0)
 Q ""
"RTN","MAGDRA2",68,0)
 ;
"RTN","MAGDRA2",69,0)
PROC(MAGPRC) ;
"RTN","MAGDRA2",70,0)
 Q $$FIND1^DIC(71,,"XB",MAGPRC)
"RTN","MAGDRA2",71,0)
 ;
"RTN","MAGDRA2",72,0)
ONE ;
"RTN","MAGDRA2",73,0)
 ;MAGDFN,MAGX variables expected from EN
"RTN","MAGDRA2",74,0)
 I 'MAGDFN,'+MAGX Q
"RTN","MAGDRA2",75,0)
 N BEG,CASE,CDATE,CS,DATA,END,FLDS,INFO,MAGCASE,MAGCNI,MAGDATE,MAGDTI
"RTN","MAGDRA2",76,0)
 N MAGEXST,MAGLOC,MAGNME,MAGOUT,MAGPIEN,MAGPRC,MAGPSET,MAGPST,MAGRPT
"RTN","MAGDRA2",77,0)
 N PP,PSET,RAENTRY,RAMEMLOW,RAPRTSET,RIEN,STAT,X,X1,X2,XX
"RTN","MAGDRA2",78,0)
 N RARPT,RADFN,RADTI,RACNI ;<--Variables needed for EN1^RAUTL20
"RTN","MAGDRA2",79,0)
 ; RAUTL20 used to retrieve if case is part of a print set.
"RTN","MAGDRA2",80,0)
 S MAGDFN=$P(MAGX,"~"),INFO=$$PTINFO
"RTN","MAGDRA2",81,0)
 S MAGNME=$P(INFO,"^"),MAGSSN=$P(INFO,"^",2)
"RTN","MAGDRA2",82,0)
 S RIEN=$P(MAGX,"~",2)_","_$P(MAGX,"~",1)
"RTN","MAGDRA2",83,0)
 S BEG=9999999.9999-$P(MAGX,"~",2),END=$$FMADD^XLFDT(BEG,2)
"RTN","MAGDRA2",84,0)
 K ^TMP($J,"RAE1")
"RTN","MAGDRA2",85,0)
 D EN1^RAO7PC1(MAGDFN,BEG,END,20)
"RTN","MAGDRA2",86,0)
 S RAENTRY=$P(MAGX,"~",2)_"-"_$P(MAGX,"~",3)
"RTN","MAGDRA2",87,0)
 Q:'$D(^TMP($J,"RAE1"))
"RTN","MAGDRA2",88,0)
 Q:'$D(^TMP($J,"RAE1",MAGDFN,RAENTRY))
"RTN","MAGDRA2",89,0)
 S DATA=^TMP($J,"RAE1",MAGDFN,RAENTRY)
"RTN","MAGDRA2",90,0)
 S MAGDATE=$P(RAENTRY,"-"),CDATE=9999999.9999-MAGDATE
"RTN","MAGDRA2",91,0)
 S MAGDATE=$TR($$FMTE^XLFDT(CDATE,"2FD")," ","0")
"RTN","MAGDRA2",92,0)
 S MAGPRC=$P(DATA,"^"),CASE=$P(DATA,"^",2),STAT=$P(DATA,"^",6)
"RTN","MAGDRA2",93,0)
 S MAGEXST=$P(STAT,"~",2),MAGLOC=$P(DATA,"^",7)
"RTN","MAGDRA2",94,0)
 S (MAGRPT,RARPT)=$P(DATA,"^",5)
"RTN","MAGDRA2",95,0)
 S (MAGDTI,RADTI)=$P(RAENTRY,"-")
"RTN","MAGDRA2",96,0)
 S (MAGCNI,RACNI)=$P(RAENTRY,"-",2),RADFN=MAGDFN
"RTN","MAGDRA2",97,0)
 S MAGCASE=$$LCASE(CDATE,CASE),MAGPIEN=$$PROC(MAGPRC)
"RTN","MAGDRA2",98,0)
 ; RADTI, RADFN, RACNI variables needed for EN1^RAULT20
"RTN","MAGDRA2",99,0)
 D EN1^RAUTL20
"RTN","MAGDRA2",100,0)
 S (PSET,MAGPSET)=""
"RTN","MAGDRA2",101,0)
 S PSET=$S(RAMEMLOW:"+",RAPRTSET:".",1:"")
"RTN","MAGDRA2",102,0)
 I PSET=".",RACNI>1 D
"RTN","MAGDRA2",103,0)
 . N OLDENTRY S OLDENTRY=$P(RAENTRY,"-")_"-"
"RTN","MAGDRA2",104,0)
 . S OLDENTRY=$O(^TMP($J,"RAE1",MAGDFN,OLDENTRY)) I $L(OLDENTRY) D
"RTN","MAGDRA2",105,0)
 . . S MAGCASE=$P(^TMP($J,"RAE1",MAGDFN,OLDENTRY),"^",2)
"RTN","MAGDRA2",106,0)
 . . S CDATE=$P(RAENTRY,"-")
"RTN","MAGDRA2",107,0)
 . . S CDATE=9999999.9999-CDATE
"RTN","MAGDRA2",108,0)
 . . S MAGCASE=$$LCASE^MAGDRA2(CDATE,MAGCASE),RACNI=$P(OLDENTRY,"-",2)
"RTN","MAGDRA2",109,0)
 . . S MAGPST=CASE_" is part of this printset."
"RTN","MAGDRA2",110,0)
 . . Q
"RTN","MAGDRA2",111,0)
 . Q
"RTN","MAGDRA2",112,0)
 I $D(RAPRTSET) S PP=$S(MAGCNI>1:".",MAGCNI=1:"+",1:"")
"RTN","MAGDRA2",113,0)
 S MAGCNI=RACNI
"RTN","MAGDRA2",114,0)
 W !,"PATIENT: ",MAGNME,?51,"SSN: ",MAGSSN
"RTN","MAGDRA2",115,0)
 W !,"Case No.",?15,"Procedure",?42,"Location",?64,"Exam Date"
"RTN","MAGDRA2",116,0)
 W !,"________",?15,"_________",?42,"________________",?64,"________"
"RTN","MAGDRA2",117,0)
 W !,$G(PP),CASE,$$IMG(MAGRPT),?15,MAGPRC,?42,MAGLOC,?64,MAGDATE
"RTN","MAGDRA2",118,0)
 W !,"Exam status: ",MAGEXST," "," ",$G(MAGPST)
"RTN","MAGDRA2",119,0)
 D MAGDY
"RTN","MAGDRA2",120,0)
 Q
"RTN","MAGDRA2",121,0)
 ;
"RTN","MAGDRA2",122,0)
MAGDY ;
"RTN","MAGDRA2",123,0)
 S MAGDY=MAGDFN_"^"_MAGNME_"^"_MAGSSN_"^"_MAGCASE_"^"_MAGPRC_"^"_MAGDTI
"RTN","MAGDRA2",124,0)
 S MAGDY=MAGDY_"^"_MAGCNI_"^"_MAGPIEN_"^"_$G(MAGPST)_"^"
"RTN","MAGDRA2",125,0)
 K MAGNME,MAGSSN,MAGCASE,MAGPRC,MAGDTI,MAGCNI,MAGPIEN,MAPST
"RTN","MAGDRA2",126,0)
 Q
"RTN","MAGDRA2",127,0)
 ;
"RTN","MAGDRCU1")
0^35^B29329943
"RTN","MAGDRCU1",1,0)
MAGDRCU1 ;WOIFO/PMK - List entries in ^MAG(2006.5839) ; 05/18/2007 11:23
"RTN","MAGDRCU1",2,0)
 ;;3.0;IMAGING;**10,30,54**;03-July-2009;;Build 1424
"RTN","MAGDRCU1",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDRCU1",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRCU1",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRCU1",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRCU1",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRCU1",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRCU1",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRCU1",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRCU1",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRCU1",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRCU1",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRCU1",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRCU1",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRCU1",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRCU1",17,0)
 ;;
"RTN","MAGDRCU1",18,0)
 Q
"RTN","MAGDRCU1",19,0)
 ; This routine lists the entries in the temporary Imaging/CPRS Consult
"RTN","MAGDRCU1",20,0)
 ; Request Tracking association file
"RTN","MAGDRCU1",21,0)
 ;
"RTN","MAGDRCU1",22,0)
 ;     XXXX                                         XXX       X
"RTN","MAGDRCU1",23,0)
 ;    XX  XX                                         XX      XX
"RTN","MAGDRCU1",24,0)
 ;   XX         XXXX    XX XXX  XXXXXXX  XX  XXX     XX     XXXXX
"RTN","MAGDRCU1",25,0)
 ;   XX        XX  XX   XXX XX  XX       XX  XX      XX      XX
"RTN","MAGDRCU1",26,0)
 ;   XX    X   XX  XX   XX  XX  XXXXXXX  XX  XX      XX      XX
"RTN","MAGDRCU1",27,0)
 ;    XX  XX   XX  XX   XX  XX       XX  XX  XX      XX      XX XX
"RTN","MAGDRCU1",28,0)
 ;     XXXX     XXXX    XX  XX  XXXXXXX   XXX XX    XXXX      XXX
"RTN","MAGDRCU1",29,0)
 ;
"RTN","MAGDRCU1",30,0)
 ; Routine 1/2 for application
"RTN","MAGDRCU1",31,0)
 ;
"RTN","MAGDRCU1",32,0)
ENTRY ; read the entries in file ^MAG(2006.5839)
"RTN","MAGDRCU1",33,0)
 N COUNT,CUTOFF,DAYS,DIVISION,DONE,INDEX,SELECT,SERVICE,SORT,SUBTITLE,TITLE,X
"RTN","MAGDRCU1",34,0)
 ;
"RTN","MAGDRCU1",35,0)
 S TITLE="UNREAD LIST FOR HEALTHCARE PROVIDERS"
"RTN","MAGDRCU1",36,0)
 W !!,TITLE,!!
"RTN","MAGDRCU1",37,0)
 ;
"RTN","MAGDRCU1",38,0)
 ; get the division and service list
"RTN","MAGDRCU1",39,0)
 S SERVICE=0 F  S SERVICE=$O(^MAG(2006.5831,SERVICE)) Q:'SERVICE  D
"RTN","MAGDRCU1",40,0)
 . S X=^MAG(2006.5831,SERVICE,0)
"RTN","MAGDRCU1",41,0)
 . S INDEX=$P(X,"^",2),DIVISION=$P(X,"^",3)
"RTN","MAGDRCU1",42,0)
 . S SERVICE(DIVISION)=$$GET1^DIQ(4,DIVISION,.01)
"RTN","MAGDRCU1",43,0)
 . S SERVICE(DIVISION,INDEX)=$P(^MAG(2005.84,INDEX,0),"^",1)
"RTN","MAGDRCU1",44,0)
 . S SERVICE(DIVISION,INDEX,SERVICE)=$$GET1^DIQ(123.5,SERVICE,.01)
"RTN","MAGDRCU1",45,0)
 . Q
"RTN","MAGDRCU1",46,0)
 ;
"RTN","MAGDRCU1",47,0)
 I '$D(SERVICE) W !,"No SERVICEs are defined in file 2006.5831" Q
"RTN","MAGDRCU1",48,0)
 ;
"RTN","MAGDRCU1",49,0)
 ; select the SERVICE of interest
"RTN","MAGDRCU1",50,0)
 S DONE=0 F  D  Q:DONE
"RTN","MAGDRCU1",51,0)
 . S COUNT=0,DIVISION=""
"RTN","MAGDRCU1",52,0)
 . W !
"RTN","MAGDRCU1",53,0)
 . F  S DIVISION=$O(SERVICE(DIVISION)) Q:'DIVISION  D
"RTN","MAGDRCU1",54,0)
 . . S INDEX=""
"RTN","MAGDRCU1",55,0)
 . . F  S INDEX=$O(SERVICE(DIVISION,INDEX)) Q:INDEX=""  D
"RTN","MAGDRCU1",56,0)
 . . . S COUNT=COUNT+1
"RTN","MAGDRCU1",57,0)
 . . . W !,$J(COUNT,2),") ",$J(DIVISION,4)," -- ",SERVICE(DIVISION)
"RTN","MAGDRCU1",58,0)
 . . . W " -- ",SERVICE(DIVISION,INDEX)
"RTN","MAGDRCU1",59,0)
 . . . S SERVICE("B",COUNT)=DIVISION_"^"_INDEX
"RTN","MAGDRCU1",60,0)
 . . . Q
"RTN","MAGDRCU1",61,0)
 . . Q
"RTN","MAGDRCU1",62,0)
 . I COUNT=1 S SELECT="ALL",DONE=1
"RTN","MAGDRCU1",63,0)
 . E  D
"RTN","MAGDRCU1",64,0)
 . . W !!,"Select the proper service (1-",COUNT,") or enter ALL: " R X:DTIME
"RTN","MAGDRCU1",65,0)
 . . I X?.N,X,X'>COUNT S SELECT=SERVICE("B",X),DONE=1
"RTN","MAGDRCU1",66,0)
 . . E  I $L(X),"Aa"[$E(X) S SELECT="ALL",DONE=1
"RTN","MAGDRCU1",67,0)
 . . E  I X["^" S DONE=-1
"RTN","MAGDRCU1",68,0)
 . . E  I X["?" D
"RTN","MAGDRCU1",69,0)
 . . . W !!,"Please enter the number of the corresponding service."
"RTN","MAGDRCU1",70,0)
 . . . W !,"Enter ""ALL"" if you want all of the services."
"RTN","MAGDRCU1",71,0)
 . . . Q
"RTN","MAGDRCU1",72,0)
 . . E  W " ???"
"RTN","MAGDRCU1",73,0)
 . . Q
"RTN","MAGDRCU1",74,0)
 . Q
"RTN","MAGDRCU1",75,0)
 I DONE=-1 Q  ; cancelled by user
"RTN","MAGDRCU1",76,0)
 ;
"RTN","MAGDRCU1",77,0)
 I SELECT="ALL" D
"RTN","MAGDRCU1",78,0)
 . S DIVISION=""
"RTN","MAGDRCU1",79,0)
 . F  S DIVISION=$O(SERVICE(DIVISION)) Q:'DIVISION  D
"RTN","MAGDRCU1",80,0)
 . . S INDEX=""
"RTN","MAGDRCU1",81,0)
 . . F  S INDEX=$O(SERVICE(DIVISION,INDEX)) Q:INDEX=""  D
"RTN","MAGDRCU1",82,0)
 . . . D SELSERV(DIVISION,INDEX)
"RTN","MAGDRCU1",83,0)
 . . . Q
"RTN","MAGDRCU1",84,0)
 E  D
"RTN","MAGDRCU1",85,0)
 . S DIVISION=$P(SELECT,"^",1),INDEX=$P(SELECT,"^",2)
"RTN","MAGDRCU1",86,0)
 . D SELSERV(DIVISION,INDEX)
"RTN","MAGDRCU1",87,0)
 . Q
"RTN","MAGDRCU1",88,0)
 ;
"RTN","MAGDRCU1",89,0)
 S DONE=0 F  D  Q:DONE
"RTN","MAGDRCU1",90,0)
 . W !!,"Display studies older than how many days?  0// "
"RTN","MAGDRCU1",91,0)
 . R X:DTIME I X="" S X=0 W X
"RTN","MAGDRCU1",92,0)
 . I X?.N S DAYS=X,DONE=1 Q
"RTN","MAGDRCU1",93,0)
 . E  I X["^" S DONE=-1
"RTN","MAGDRCU1",94,0)
 . E  I X["?" D
"RTN","MAGDRCU1",95,0)
 . . W !!,"Please enter the minimum number of days that have elapsed since"
"RTN","MAGDRCU1",96,0)
 . . W !,"the examination was performed.  This allows only the old studies"
"RTN","MAGDRCU1",97,0)
 . . W !,"to be reported.  Enter 0 days to display all the studies."
"RTN","MAGDRCU1",98,0)
 . . Q
"RTN","MAGDRCU1",99,0)
 . E  W " ???"
"RTN","MAGDRCU1",100,0)
 . Q
"RTN","MAGDRCU1",101,0)
 I DONE=-1 Q  ; cancelled by user
"RTN","MAGDRCU1",102,0)
 S CUTOFF=$$HTFM^XLFDT($H+1-DAYS,0)
"RTN","MAGDRCU1",103,0)
 ;
"RTN","MAGDRCU1",104,0)
 S DONE=0 F  D  Q:DONE
"RTN","MAGDRCU1",105,0)
 . W !!,"Sort by patient name or examination date? (N or D) D// "
"RTN","MAGDRCU1",106,0)
 . R X:DTIME I X="" S X="D" W X
"RTN","MAGDRCU1",107,0)
 . I "NnDd"[$E(X) S SORT=X,DONE=1 Q
"RTN","MAGDRCU1",108,0)
 . E  I X["^" S DONE=-1
"RTN","MAGDRCU1",109,0)
 . E  I X["?" D
"RTN","MAGDRCU1",110,0)
 . . W !!,"Designate the sort order for the report, alphabetically by patient"
"RTN","MAGDRCU1",111,0)
 . . W !,"name or chronologically by the examination date."
"RTN","MAGDRCU1",112,0)
 . . Q
"RTN","MAGDRCU1",113,0)
 . E  W " ???"
"RTN","MAGDRCU1",114,0)
 . Q
"RTN","MAGDRCU1",115,0)
 I DONE=-1 Q  ; cancelled by user
"RTN","MAGDRCU1",116,0)
 ;
"RTN","MAGDRCU1",117,0)
 I SELECT="ALL" S SUBTITLE(1)="ALL SERVICES"
"RTN","MAGDRCU1",118,0)
 E  D
"RTN","MAGDRCU1",119,0)
 . S SUBTITLE(1)=$P(SELECT,"^",1)_" -- "_SERVICE($P(SELECT,"^",1))
"RTN","MAGDRCU1",120,0)
 . S SUBTITLE(1)=SUBTITLE(1)_" -- "_SERVICE($P(SELECT,"^",1),$P(SELECT,"^",2))
"RTN","MAGDRCU1",121,0)
 . Q
"RTN","MAGDRCU1",122,0)
 I DAYS S SUBTITLE(2)="Studies more than "_DAYS_" days old"
"RTN","MAGDRCU1",123,0)
 E  S SUBTITLE(2)="All studies regardless of age"
"RTN","MAGDRCU1",124,0)
 S SUBTITLE(2)=SUBTITLE(2)_" sorted by "_$S(SORT="D":"date",1:"name")
"RTN","MAGDRCU1",125,0)
 ;
"RTN","MAGDRCU1",126,0)
 ; Output the report
"RTN","MAGDRCU1",127,0)
 ;
"RTN","MAGDRCU1",128,0)
 W ! S %ZIS="Q" D ^%ZIS I POP Q  ; select the output device, quit if none
"RTN","MAGDRCU1",129,0)
 ;
"RTN","MAGDRCU1",130,0)
 ; setup for queueing the report to print in the background via Taskman 
"RTN","MAGDRCU1",131,0)
 I $D(IO("Q")) D  ; queued
"RTN","MAGDRCU1",132,0)
 . S ZTSAVE("CUTOFF")=""
"RTN","MAGDRCU1",133,0)
 . S ZTSAVE("SELECT")=""
"RTN","MAGDRCU1",134,0)
 . S ZTSAVE("SERVICE(")=""
"RTN","MAGDRCU1",135,0)
 . S ZTSAVE("SORT")=""
"RTN","MAGDRCU1",136,0)
 . S ZTSAVE("SUBTITLE(")=""
"RTN","MAGDRCU1",137,0)
 . S ZTSAVE("TITLE")=""
"RTN","MAGDRCU1",138,0)
 . S ZTRTN="REPORT^MAGDRCU2",ZTDESC=TITLE
"RTN","MAGDRCU1",139,0)
 . D ^%ZTLOAD D HOME^%ZIS K IO("Q")
"RTN","MAGDRCU1",140,0)
 . Q
"RTN","MAGDRCU1",141,0)
 E  D  ; immediate
"RTN","MAGDRCU1",142,0)
 . D REPORT^MAGDRCU2
"RTN","MAGDRCU1",143,0)
 . Q
"RTN","MAGDRCU1",144,0)
 Q
"RTN","MAGDRCU1",145,0)
 ;
"RTN","MAGDRCU1",146,0)
SELSERV(DIVISION,INDEX) ; select service
"RTN","MAGDRCU1",147,0)
 N S
"RTN","MAGDRCU1",148,0)
 S S=""
"RTN","MAGDRCU1",149,0)
 F  S S=$O(SERVICE(DIVISION,INDEX,S)) Q:S=""  D
"RTN","MAGDRCU1",150,0)
 . S SERVICE("S",S)=SERVICE(DIVISION,INDEX,S)
"RTN","MAGDRCU1",151,0)
 . Q
"RTN","MAGDRCU1",152,0)
 Q
"RTN","MAGDRCU1",153,0)
 ;
"RTN","MAGDRCU2")
0^36^B37774357
"RTN","MAGDRCU2",1,0)
MAGDRCU2 ;WOIFO/PMK - List entries in ^MAG(2006.5839) ; 05/18/2007 11:23
"RTN","MAGDRCU2",2,0)
 ;;3.0;IMAGING;**10,11,51,54**;03-July-2009;;Build 1424
"RTN","MAGDRCU2",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDRCU2",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRCU2",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRCU2",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRCU2",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRCU2",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRCU2",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRCU2",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRCU2",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRCU2",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRCU2",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRCU2",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRCU2",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRCU2",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRCU2",17,0)
 ;;
"RTN","MAGDRCU2",18,0)
 ; This routine lists the entries in the temporary Imaging/CPRS Consult
"RTN","MAGDRCU2",19,0)
 ; Request Tracking association file
"RTN","MAGDRCU2",20,0)
 ;
"RTN","MAGDRCU2",21,0)
 ;     XXXX                                         XXX       X
"RTN","MAGDRCU2",22,0)
 ;    XX  XX                                         XX      XX
"RTN","MAGDRCU2",23,0)
 ;   XX         XXXX    XX XXX  XXXXXXX  XX  XXX     XX     XXXXX
"RTN","MAGDRCU2",24,0)
 ;   XX        XX  XX   XXX XX  XX       XX  XX      XX      XX
"RTN","MAGDRCU2",25,0)
 ;   XX    X   XX  XX   XX  XX  XXXXXXX  XX  XX      XX      XX
"RTN","MAGDRCU2",26,0)
 ;    XX  XX   XX  XX   XX  XX       XX  XX  XX      XX      XX XX
"RTN","MAGDRCU2",27,0)
 ;     XXXX     XXXX    XX  XX  XXXXXXX   XXX XX    XXXX      XXX
"RTN","MAGDRCU2",28,0)
 ;
"RTN","MAGDRCU2",29,0)
 ; Routine 2/2 in for application
"RTN","MAGDRCU2",30,0)
 ;
"RTN","MAGDRCU2",31,0)
REPORT ; now scan the database and generate the report
"RTN","MAGDRCU2",32,0)
 N D0,DATE,DFN,DOB,EXAMDATE,GMRCDFN,GMRCIEN,I,LASTDFN,LASTEXAM
"RTN","MAGDRCU2",33,0)
 N MAGIEN,MAGIEN1,NOW,ORDRDATE,PAGE,PID,PNAME,REQTYPE
"RTN","MAGDRCU2",34,0)
 N SEX,STATUS,STOP,VA,VAERR,VADM,WRK,X,Y,Z
"RTN","MAGDRCU2",35,0)
 ;
"RTN","MAGDRCU2",36,0)
 S WRK=$NA(^TMP("MAG",$J,"GMRC"))
"RTN","MAGDRCU2",37,0)
 S NOW=$$HTE^XLFDT($H,0)
"RTN","MAGDRCU2",38,0)
 K @WRK
"RTN","MAGDRCU2",39,0)
 ;
"RTN","MAGDRCU2",40,0)
 S D0=0
"RTN","MAGDRCU2",41,0)
 I $E(IOST)="C" W !,"Building"
"RTN","MAGDRCU2",42,0)
 F  S D0=$O(^MAG(2006.5839,D0)) Q:'D0  S X=^(D0,0) D
"RTN","MAGDRCU2",43,0)
 . I $P(X,"^",1)'="123" D
"RTN","MAGDRCU2",44,0)
 . . N MSG
"RTN","MAGDRCU2",45,0)
 . . S MSG(1)="Problem with Temporary Imaging/CPRS file"
"RTN","MAGDRCU2",46,0)
 . . S MSG(2)="Entry #"_D0_" in ^MAG(2006.5839) does not begin"
"RTN","MAGDRCU2",47,0)
 . . S MSG(3)="with 123 - it doesn't point to CPRS Consult Request Tracking"
"RTN","MAGDRCU2",48,0)
 . . S MSG(4)="Bad record: <<"_X_">>"
"RTN","MAGDRCU2",49,0)
 . . D ERROR(.MSG)
"RTN","MAGDRCU2",50,0)
 . . Q
"RTN","MAGDRCU2",51,0)
 . E  D
"RTN","MAGDRCU2",52,0)
 . . S GMRCIEN=$P(X,"^",2),MAGIEN=$P(X,"^",3)
"RTN","MAGDRCU2",53,0)
 . . S DFN=$P(^MAG(2005,MAGIEN,0),"^",7)
"RTN","MAGDRCU2",54,0)
 . . S GMRCDFN=$$GET1^DIQ(123,GMRCIEN,.02,"I")
"RTN","MAGDRCU2",55,0)
 . . I DFN'=GMRCDFN D
"RTN","MAGDRCU2",56,0)
 . . . N MSG
"RTN","MAGDRCU2",57,0)
 . . . S MSG(1)="DICOM IMAGE PROCESSING ERROR - CONSULT/IMAGING PATIENT MISMATCH"
"RTN","MAGDRCU2",58,0)
 . . . S MSG(2)="The image and the consult point to different patients."
"RTN","MAGDRCU2",59,0)
 . . . S MSG(3)=""
"RTN","MAGDRCU2",60,0)
 . . . S MSG(4)="The Image points to PATIENT file internal entry number "_DFN
"RTN","MAGDRCU2",61,0)
 . . . S MSG(5)=$$PATDEMO^MAGDIRVE(DFN)
"RTN","MAGDRCU2",62,0)
 . . . S MSG(6)=""
"RTN","MAGDRCU2",63,0)
 . . . S MSG(7)="The Consult points to PATIENT file internal entry number "_GMRCDFN
"RTN","MAGDRCU2",64,0)
 . . . S MSG(8)=$$PATDEMO^MAGDIRVE(GMRCDFN)
"RTN","MAGDRCU2",65,0)
 . . . S MSG(9)=""
"RTN","MAGDRCU2",66,0)
 . . . D ERROR(.MSG)
"RTN","MAGDRCU2",67,0)
 . . . Q
"RTN","MAGDRCU2",68,0)
 . . E  D
"RTN","MAGDRCU2",69,0)
 . . . ; check that this is a service of interest
"RTN","MAGDRCU2",70,0)
 . . . S SERVICE=$$GET1^DIQ(123,GMRCIEN,1,"I")
"RTN","MAGDRCU2",71,0)
 . . . I '$D(SERVICE("S",SERVICE)) Q
"RTN","MAGDRCU2",72,0)
 . . . ; check cutoff date
"RTN","MAGDRCU2",73,0)
 . . . S I=$O(^MAG(2005,MAGIEN,1,0)),MAGIEN1=$P(^(I,0),"^",1)
"RTN","MAGDRCU2",74,0)
 . . . S EXAMDATE=$P(^MAG(2005,MAGIEN1,2),"^",1) I EXAMDATE>CUTOFF Q
"RTN","MAGDRCU2",75,0)
 . . . S ORDRDATE=$$GET1^DIQ(123,GMRCIEN,.01)
"RTN","MAGDRCU2",76,0)
 . . . S ORDRDATE=$P(ORDRDATE,",",1)_","_$E($P(ORDRDATE,",",2),4,5)
"RTN","MAGDRCU2",77,0)
 . . . S STATUS=$$GET1^DIQ(123,GMRCIEN,8,"I")
"RTN","MAGDRCU2",78,0)
 . . . I '$D(STATUS(STATUS)) D
"RTN","MAGDRCU2",79,0)
 . . . . S STATUS(STATUS)=$$GET1^DIQ(100.01,STATUS,.1)
"RTN","MAGDRCU2",80,0)
 . . . . Q
"RTN","MAGDRCU2",81,0)
 . . . S REQTYPE=$$GET1^DIQ(123,GMRCIEN,13,"I")
"RTN","MAGDRCU2",82,0)
 . . . D DEM^VADPT
"RTN","MAGDRCU2",83,0)
 . . . S PNAME=VADM(1),PID=VA("PID")
"RTN","MAGDRCU2",84,0)
 . . . S DOB=$P(VADM(3),"^",2),SEX=$P(VADM(5),"^",2)
"RTN","MAGDRCU2",85,0)
 . . . S (I,@WRK@(0))=$G(@WRK@(0))+1
"RTN","MAGDRCU2",86,0)
 . . . S Z=DFN_"^"_PNAME_"^"_PID_"^"_SEX_"^"_DOB
"RTN","MAGDRCU2",87,0)
 . . . S Z=Z_"^"_GMRCIEN_"^"_SERVICE_"^"_ORDRDATE_"^"_STATUS
"RTN","MAGDRCU2",88,0)
 . . . S Z=Z_"^"_REQTYPE_"^"_EXAMDATE
"RTN","MAGDRCU2",89,0)
 . . . S @WRK@(I)=Z
"RTN","MAGDRCU2",90,0)
 . . . S @WRK@("P",PNAME,DFN,I)=""
"RTN","MAGDRCU2",91,0)
 . . . S @WRK@("D",EXAMDATE\1,PNAME,DFN,I)=""
"RTN","MAGDRCU2",92,0)
 . . . I $E(IOST)="C" W:$X>79 ! W "."
"RTN","MAGDRCU2",93,0)
 . . . Q
"RTN","MAGDRCU2",94,0)
 . . Q
"RTN","MAGDRCU2",95,0)
 . Q
"RTN","MAGDRCU2",96,0)
 ;
"RTN","MAGDRCU2",97,0)
 ; output the report
"RTN","MAGDRCU2",98,0)
 ;
"RTN","MAGDRCU2",99,0)
 U IO D HEADING
"RTN","MAGDRCU2",100,0)
 S STOP=0
"RTN","MAGDRCU2",101,0)
 ;
"RTN","MAGDRCU2",102,0)
 I "Dd"[SORT D  ; output sorted by examination date
"RTN","MAGDRCU2",103,0)
 . S DATE="" F  S DATE=$O(@WRK@("D",DATE)) Q:DATE=""!STOP  D
"RTN","MAGDRCU2",104,0)
 . . D NEWLINE(5)
"RTN","MAGDRCU2",105,0)
 . . K LASTDFN ; force output of name
"RTN","MAGDRCU2",106,0)
 . . S PNAME="" F  S PNAME=$O(@WRK@("D",DATE,PNAME)) Q:PNAME=""!STOP  D
"RTN","MAGDRCU2",107,0)
 . . . S DFN="" F  S DFN=$O(@WRK@("D",DATE,PNAME,DFN)) Q:DFN=""!STOP  D
"RTN","MAGDRCU2",108,0)
 . . . . S I="" F  S I=$O(@WRK@("D",DATE,PNAME,DFN,I)) Q:I=""!STOP  D
"RTN","MAGDRCU2",109,0)
 . . . . . D ONELINE
"RTN","MAGDRCU2",110,0)
 . . . . . Q
"RTN","MAGDRCU2",111,0)
 . . . . Q
"RTN","MAGDRCU2",112,0)
 . . . Q
"RTN","MAGDRCU2",113,0)
 . . Q
"RTN","MAGDRCU2",114,0)
 . Q
"RTN","MAGDRCU2",115,0)
 ;
"RTN","MAGDRCU2",116,0)
 E  D  ; output sorted by name
"RTN","MAGDRCU2",117,0)
 . S PNAME="" F  S PNAME=$O(@WRK@("P",PNAME)) Q:PNAME=""!STOP  D
"RTN","MAGDRCU2",118,0)
 . . S DFN="" F  S DFN=$O(@WRK@("P",PNAME,DFN)) Q:DFN=""!STOP  D
"RTN","MAGDRCU2",119,0)
 . . . S I="" F  S I=$O(@WRK@("P",PNAME,DFN,I)) Q:I=""!STOP  D
"RTN","MAGDRCU2",120,0)
 . . . . K LASTEXAM ; force output of examination date
"RTN","MAGDRCU2",121,0)
 . . . . D ONELINE
"RTN","MAGDRCU2",122,0)
 . . . . Q
"RTN","MAGDRCU2",123,0)
 . . . Q
"RTN","MAGDRCU2",124,0)
 . . Q
"RTN","MAGDRCU2",125,0)
 . Q
"RTN","MAGDRCU2",126,0)
 ;
"RTN","MAGDRCU2",127,0)
 D ^%ZISC I $D(ZTQUEUED) S ZTREQ="@" ; standard kernel exit
"RTN","MAGDRCU2",128,0)
 K @WRK
"RTN","MAGDRCU2",129,0)
 Q
"RTN","MAGDRCU2",130,0)
 ;
"RTN","MAGDRCU2",131,0)
ONELINE ; output one line of the report
"RTN","MAGDRCU2",132,0)
 S X=@WRK@(I)
"RTN","MAGDRCU2",133,0)
 I DFN'=$G(LASTDFN) D
"RTN","MAGDRCU2",134,0)
 . S PID=$P(X,"^",3),SEX=$P(X,"^",4),DOB=$P(X,"^",5)
"RTN","MAGDRCU2",135,0)
 . D NEWLINE(4),NEWLINE(3)
"RTN","MAGDRCU2",136,0)
 . W PNAME,"   ",PID,"   (",SEX,")   ",DOB
"RTN","MAGDRCU2",137,0)
 . S LASTDFN=DFN
"RTN","MAGDRCU2",138,0)
 . Q
"RTN","MAGDRCU2",139,0)
 S GMRCIEN=$P(X,"^",6),SERVICE=$P(X,"^",7),ORDRDATE=$P(X,"^",8)
"RTN","MAGDRCU2",140,0)
 S STATUS=$P(X,"^",9),REQTYPE=$P(X,"^",10),EXAMDATE=$P(X,"^",11)
"RTN","MAGDRCU2",141,0)
 S REQTYPE=$S(REQTYPE="C":"Consult",REQTYPE="P":"Procedure",1:"Unknown")
"RTN","MAGDRCU2",142,0)
 D NEWLINE(1)
"RTN","MAGDRCU2",143,0)
 W "  ",ORDRDATE," (",STATUS(STATUS),") ",$E(SERVICE("S",SERVICE),1,30)
"RTN","MAGDRCU2",144,0)
 W "  ",REQTYPE," #",GMRCIEN
"RTN","MAGDRCU2",145,0)
 S Y=$$FMTE^XLFDT(EXAMDATE,1),EXAMDATE=$P(Y,",",1)_","_$E($P(Y,",",2),4,5)
"RTN","MAGDRCU2",146,0)
 I EXAMDATE'=$G(LASTEXAM) D
"RTN","MAGDRCU2",147,0)
 . W ?65,"Exam: ",EXAMDATE
"RTN","MAGDRCU2",148,0)
 . S LASTEXAM=EXAMDATE
"RTN","MAGDRCU2",149,0)
 . Q
"RTN","MAGDRCU2",150,0)
 Q
"RTN","MAGDRCU2",151,0)
 ;
"RTN","MAGDRCU2",152,0)
NEWLINE(J) ; output a <cr> <lf> with scrolling control or pagination
"RTN","MAGDRCU2",153,0)
 N I
"RTN","MAGDRCU2",154,0)
 W !
"RTN","MAGDRCU2",155,0)
 I $Y<(IOSL-J) Q  ; nothing else to do
"RTN","MAGDRCU2",156,0)
 I $E(IOST)="C" D  ; scrolling for a crt
"RTN","MAGDRCU2",157,0)
 . N I,X
"RTN","MAGDRCU2",158,0)
 . W "more..." R X:DTIME F I=1:1:$X W $C(8,32,8)
"RTN","MAGDRCU2",159,0)
 . S $Y=0 Q:X=""
"RTN","MAGDRCU2",160,0)
 . S:$TR(X,"quitexnQUITEXN","^^^^^^^^^^^^^^")["^" STOP=1
"RTN","MAGDRCU2",161,0)
 . Q
"RTN","MAGDRCU2",162,0)
 E  D  ; pagination for a file or a printer
"RTN","MAGDRCU2",163,0)
 . F Y=$Y:1:(IOSL-1) W !
"RTN","MAGDRCU2",164,0)
 . S PAGE=$G(PAGE)+1 W ?IOM-10,"Page ",PAGE,!
"RTN","MAGDRCU2",165,0)
 . D HEADING
"RTN","MAGDRCU2",166,0)
 . Q
"RTN","MAGDRCU2",167,0)
 Q
"RTN","MAGDRCU2",168,0)
 ;
"RTN","MAGDRCU2",169,0)
HEADING ; print heading
"RTN","MAGDRCU2",170,0)
 W @IOF,TITLE,?IOM-$L(NOW),NOW,!
"RTN","MAGDRCU2",171,0)
 I ($L(SUBTITLE(1))+$L(SUBTITLE(2)))<(IOM-4) D
"RTN","MAGDRCU2",172,0)
 . W SUBTITLE(1)," -- ",SUBTITLE(2)
"RTN","MAGDRCU2",173,0)
 . Q
"RTN","MAGDRCU2",174,0)
 E  D
"RTN","MAGDRCU2",175,0)
 . W SUBTITLE(1),!,SUBTITLE(2)
"RTN","MAGDRCU2",176,0)
 . Q
"RTN","MAGDRCU2",177,0)
 W !
"RTN","MAGDRCU2",178,0)
 Q
"RTN","MAGDRCU2",179,0)
 ;
"RTN","MAGDRCU2",180,0)
ERROR(MSG) ; Error Message
"RTN","MAGDRCU2",181,0)
 N I
"RTN","MAGDRCU2",182,0)
 W ! F I=1:1:80 W "*"
"RTN","MAGDRCU2",183,0)
 F I=1:1 Q:'$D(MSG(I))  W !,"*** ",MSG(I),?76," ***"
"RTN","MAGDRCU2",184,0)
 W ! F I=1:1:80 W "*"
"RTN","MAGDRCU2",185,0)
 Q
"RTN","MAGDRCU2",186,0)
 ;
"RTN","MAGDRPC1")
0^37^B45328996
"RTN","MAGDRPC1",1,0)
MAGDRPC1 ;WOIFO/EdM - Imaging RPCs ; 11/09/2007 07:19
"RTN","MAGDRPC1",2,0)
 ;;3.0;IMAGING;**11,30,51,50,54**;03-July-2009;;Build 1424
"RTN","MAGDRPC1",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDRPC1",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC1",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRPC1",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRPC1",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRPC1",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRPC1",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRPC1",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRPC1",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRPC1",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRPC1",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRPC1",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRPC1",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRPC1",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC1",17,0)
 ;;
"RTN","MAGDRPC1",18,0)
 Q
"RTN","MAGDRPC1",19,0)
 ;
"RTN","MAGDRPC1",20,0)
GETID(OUT,HOSTNAME) ; RPC = MAG DICOM GET MACHINE ID
"RTN","MAGDRPC1",21,0)
 N D0,I,LO,N,UP,X
"RTN","MAGDRPC1",22,0)
 S HOSTNAME=$TR($G(HOSTNAME),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","MAGDRPC1",23,0)
 I HOSTNAME="" S OUT="-1,No Hostname Specified" Q
"RTN","MAGDRPC1",24,0)
 S OUT=$O(^MAGDICOM(2006.5641,"C",HOSTNAME,""))
"RTN","MAGDRPC1",25,0)
 Q:OUT>0
"RTN","MAGDRPC1",26,0)
 L +^MAGDICOM(2006.5641,0):1E9 ; Background process MUST wait
"RTN","MAGDRPC1",27,0)
 S D0=$O(^MAGDICOM(2006.5641," "),-1)+1
"RTN","MAGDRPC1",28,0)
 S ^MAGDICOM(2006.5641,D0,0)=D0_"^"_HOSTNAME_"^"_$H
"RTN","MAGDRPC1",29,0)
 S ^MAGDICOM(2006.5641,"B",D0,D0)=""
"RTN","MAGDRPC1",30,0)
 S ^MAGDICOM(2006.5641,"C",HOSTNAME,D0)=""
"RTN","MAGDRPC1",31,0)
 S (N,I,D0)=0 F  S D0=$O(^MAGDICOM(2006.5641,D0)) Q:'D0  S N=N+1,I=D0
"RTN","MAGDRPC1",32,0)
 S ^MAGDICOM(2006.5641,0)="DICOM GATEWAY MACHINE ID^2006.5641^"_I_"^"_N
"RTN","MAGDRPC1",33,0)
 L -^MAGDICOM(2006.5641,0)
"RTN","MAGDRPC1",34,0)
 S OUT=D0
"RTN","MAGDRPC1",35,0)
 Q
"RTN","MAGDRPC1",36,0)
 ;
"RTN","MAGDRPC1",37,0)
DOMAIN(OUT) ; RPC = MAG DICOM GET DOMAIN
"RTN","MAGDRPC1",38,0)
 N X
"RTN","MAGDRPC1",39,0)
 I $T(WHERE^XUPARAM)'="" S OUT=$$KSP^XUPARAM("WHERE") Q
"RTN","MAGDRPC1",40,0)
 ; The coding standards frown upon the line below,
"RTN","MAGDRPC1",41,0)
 ; but it is the best we can do when the line above cannot be used.
"RTN","MAGDRPC1",42,0)
 S X=^DD("SITE") S:X'[".DOMAIN.EXT" X=X_".DOMAIN.EXT"
"RTN","MAGDRPC1",43,0)
 S OUT=X
"RTN","MAGDRPC1",44,0)
 Q
"RTN","MAGDRPC1",45,0)
 ;
"RTN","MAGDRPC1",46,0)
INFO(OUT,LOCATION) ; RPC = MAG DICOM ET PHONE HOME
"RTN","MAGDRPC1",47,0)
 N FST,N,X
"RTN","MAGDRPC1",48,0)
 K OUT
"RTN","MAGDRPC1",49,0)
 S FST=$$FMADD^XLFDT(DT,-25)
"RTN","MAGDRPC1",50,0)
 S N=2
"RTN","MAGDRPC1",51,0)
 ;
"RTN","MAGDRPC1",52,0)
 ; Site-ID
"RTN","MAGDRPC1",53,0)
 D DOMAIN(.X)
"RTN","MAGDRPC1",54,0)
 S OUT(N)=X
"RTN","MAGDRPC1",55,0)
 ;
"RTN","MAGDRPC1",56,0)
 D ROUTEDAY^MAGDRPC2 ; Get routing statistics
"RTN","MAGDRPC1",57,0)
 ;
"RTN","MAGDRPC1",58,0)
 D  ; Text Gateway Statistics
"RTN","MAGDRPC1",59,0)
 . N A,C,D0,D2,M,X
"RTN","MAGDRPC1",60,0)
 . S A=0,D0=FST F  S D0=$O(^MAGDAUDT(2006.5761,D0)) Q:'D0  D
"RTN","MAGDRPC1",61,0)
 . . S D2=0 F  S D2=$O(^MAGDAUDT(2006.5761,D0,1,LOCATION,1,D2)) Q:'D2  D
"RTN","MAGDRPC1",62,0)
 . . . S X=$G(^MAGDAUDT(2006.5761,D0,1,LOCATION,1,D2,0))
"RTN","MAGDRPC1",63,0)
 . . . S M=$P(X,"^",2) Q:'M
"RTN","MAGDRPC1",64,0)
 . . . S:'A N=N+1,OUT(N)="Audit",A=1
"RTN","MAGDRPC1",65,0)
 . . . S N=N+1,OUT(N)="STTX="_D0_"^"_$P(X,"^",1)_"^"_M
"RTN","MAGDRPC1",66,0)
 . . . Q
"RTN","MAGDRPC1",67,0)
 . . Q
"RTN","MAGDRPC1",68,0)
 . Q
"RTN","MAGDRPC1",69,0)
 ;
"RTN","MAGDRPC1",70,0)
 S OUT(1)=N-1
"RTN","MAGDRPC1",71,0)
 Q
"RTN","MAGDRPC1",72,0)
 ;
"RTN","MAGDRPC1",73,0)
STATION(OUT,STATION,VERSION) ; RPC = MAG DICOM WORKSTATION VERSION
"RTN","MAGDRPC1",74,0)
 N D0,X
"RTN","MAGDRPC1",75,0)
 I $G(STATION)="" S OUT="-1,No Station Identifier Specified" Q
"RTN","MAGDRPC1",76,0)
 ;
"RTN","MAGDRPC1",77,0)
 S D0=$O(^MAG(2006.83,"B",STATION,"")) D:'D0
"RTN","MAGDRPC1",78,0)
 . L +^MAG(2006.83,0):1E9 ; Background process must wait for LOCK
"RTN","MAGDRPC1",79,0)
 . S X=$G(^MAG(2006.83,0))
"RTN","MAGDRPC1",80,0)
 . S $P(X,"^",1,2)="DICOM WORKSTATION^2006.83"
"RTN","MAGDRPC1",81,0)
 . S D0=$O(^MAG(2006.83," "),-1)+1
"RTN","MAGDRPC1",82,0)
 . S $P(X,"^",3)=D0
"RTN","MAGDRPC1",83,0)
 . S $P(X,"^",4)=$P(X,"^",4)+1
"RTN","MAGDRPC1",84,0)
 . S ^MAG(2006.83,0)=X,^MAG(2006.83,D0,0)=STATION
"RTN","MAGDRPC1",85,0)
 . S ^MAG(2006.83,"B",STATION,D0)=""
"RTN","MAGDRPC1",86,0)
 . L -^MAG(2006.83,0)
"RTN","MAGDRPC1",87,0)
 . Q
"RTN","MAGDRPC1",88,0)
 S $P(^MAG(2006.83,D0,0),"^",3)=VERSION
"RTN","MAGDRPC1",89,0)
 S X=$P(^MAG(2006.83,D0,0),"^",2)
"RTN","MAGDRPC1",90,0)
 S $P(^MAG(2006.83,D0,0),"^",2)=$$NOW^XLFDT()
"RTN","MAGDRPC1",91,0)
 S OUT=D0
"RTN","MAGDRPC1",92,0)
 Q
"RTN","MAGDRPC1",93,0)
 ;
"RTN","MAGDRPC1",94,0)
FMGET(OUT,FILE,D0,FIELD) ; RPC = MAG DICOM FILEMAN GET
"RTN","MAGDRPC1",95,0)
 ; Get the value of a data field
"RTN","MAGDRPC1",96,0)
 S OUT=$$GET1^DIQ(FILE,D0,FIELD)
"RTN","MAGDRPC1",97,0)
 Q
"RTN","MAGDRPC1",98,0)
 ;
"RTN","MAGDRPC1",99,0)
CUTOFF(OUT,D0) ; RPC = MAG DICOM PACS CUTOFF DATE
"RTN","MAGDRPC1",100,0)
 ; Retention Period for PACS
"RTN","MAGDRPC1",101,0)
 N X
"RTN","MAGDRPC1",102,0)
 I '$$CONSOLID^MAGBAPI() D  Q
"RTN","MAGDRPC1",103,0)
 . ; Non-consolidated site
"RTN","MAGDRPC1",104,0)
 . I '$D(^MAG(2006.1,"APACS")) S OUT="-2,No PACS Installed" Q
"RTN","MAGDRPC1",105,0)
 . ;
"RTN","MAGDRPC1",106,0)
 . S X=$G(^MAG(2006.1,"AIMDELPACS"))
"RTN","MAGDRPC1",107,0)
 . I X="" S OUT="-3,PACS Retention Parameter not defined" Q
"RTN","MAGDRPC1",108,0)
 . S OUT=X
"RTN","MAGDRPC1",109,0)
 . Q
"RTN","MAGDRPC1",110,0)
 ; Consolidated site:
"RTN","MAGDRPC1",111,0)
 I '$P($G(^MAG(2006.1,D0,"PACS")),"^",1) S OUT="-2,No PACS Installed" Q
"RTN","MAGDRPC1",112,0)
 ;
"RTN","MAGDRPC1",113,0)
 S X=$P($G(^MAG(2006.1,D0,1)),"^",5)
"RTN","MAGDRPC1",114,0)
 I X="" S OUT="-3,PACS Retention Parameter not defined" Q
"RTN","MAGDRPC1",115,0)
 S OUT=X
"RTN","MAGDRPC1",116,0)
 Q
"RTN","MAGDRPC1",117,0)
 ;
"RTN","MAGDRPC1",118,0)
MINSPACE(OUT,D0) ; RPC = MAG DICOM PACS MINIMUM SPACE
"RTN","MAGDRPC1",119,0)
 ; Minimum Percentage of Free Disk Space
"RTN","MAGDRPC1",120,0)
 N X
"RTN","MAGDRPC1",121,0)
 I '$$CONSOLID^MAGBAPI() D  Q
"RTN","MAGDRPC1",122,0)
 . ; Non-consolidated site
"RTN","MAGDRPC1",123,0)
 . I '$D(^MAG(2006.1,"APACS")) S OUT="-2,No PACS Installed" Q
"RTN","MAGDRPC1",124,0)
 . ;
"RTN","MAGDRPC1",125,0)
 . S X=$G(^MAG(2006.1,"AIMDELPACS2"))
"RTN","MAGDRPC1",126,0)
 . I X="" S OUT="-3,PACS Minimum Space Percentage Parameter not defined" Q
"RTN","MAGDRPC1",127,0)
 . S OUT=X
"RTN","MAGDRPC1",128,0)
 . Q
"RTN","MAGDRPC1",129,0)
 ; Consolidated site:
"RTN","MAGDRPC1",130,0)
 I '$P($G(^MAG(2006.1,D0,"PACS")),"^",1) S OUT="-2,No PACS Installed" Q
"RTN","MAGDRPC1",131,0)
 ;
"RTN","MAGDRPC1",132,0)
 S X=$P($G(^MAG(2006.1,D0,3)),"^",5)
"RTN","MAGDRPC1",133,0)
 I X="" S OUT="-3,PACS Minimum Space Percentage Parameter not defined" Q
"RTN","MAGDRPC1",134,0)
 S OUT=X
"RTN","MAGDRPC1",135,0)
 Q
"RTN","MAGDRPC1",136,0)
 ;
"RTN","MAGDRPC1",137,0)
HL7PURGE(OUT,CUTOFF) ; RPC = MAG DICOM PURGE HL7
"RTN","MAGDRPC1",138,0)
 ; Purge HL7 transactions
"RTN","MAGDRPC1",139,0)
 N D,D0,P,T,X
"RTN","MAGDRPC1",140,0)
 S OUT=0
"RTN","MAGDRPC1",141,0)
 S D="" F  S D=$O(^MAGDHL7(2006.5,"B",D)) Q:'D  Q:D'<CUTOFF  D
"RTN","MAGDRPC1",142,0)
 . S D0="" F  S D0=$O(^MAGDHL7(2006.5,"B",D,D0)) Q:'D0  D
"RTN","MAGDRPC1",143,0)
 . . S X=$G(^MAGDHL7(2006.5,D0,0)),P=$P(X,"^",4),T=$P(X,"^",3)
"RTN","MAGDRPC1",144,0)
 . . K ^MAGDHL7(2006.5,D0)
"RTN","MAGDRPC1",145,0)
 . . K ^MAGDHL7(2006.5,"B",D,D0)
"RTN","MAGDRPC1",146,0)
 . . K:T'="" ^MAGDHL7(2006.5,"C",T,D0)
"RTN","MAGDRPC1",147,0)
 . . K:P'="" ^MAGDHL7(2006.5,"D",P,D0)
"RTN","MAGDRPC1",148,0)
 . . S OUT=OUT+1
"RTN","MAGDRPC1",149,0)
 . . Q
"RTN","MAGDRPC1",150,0)
 . Q
"RTN","MAGDRPC1",151,0)
 D:OUT
"RTN","MAGDRPC1",152,0)
 . L +^MAGDHL7(2006.5,0):1E9
"RTN","MAGDRPC1",153,0)
 . S X=$G(^MAGDHL7(2006.5,0))
"RTN","MAGDRPC1",154,0)
 . S $P(X,"^",1,2)="PACS MESSAGES^2006.5D"
"RTN","MAGDRPC1",155,0)
 . S $P(X,"^",4)=$P(X,"^",4)-OUT
"RTN","MAGDRPC1",156,0)
 . S ^MAGDHL7(2006.5,0)=X
"RTN","MAGDRPC1",157,0)
 . L -^MAGDHL7(2006.5,0)
"RTN","MAGDRPC1",158,0)
 . Q
"RTN","MAGDRPC1",159,0)
 Q
"RTN","MAGDRPC1",160,0)
 ;
"RTN","MAGDRPC1",161,0)
VALDEST(OUT,NAME) ; RPC = MAG DICOM ROUTE VALID DEST
"RTN","MAGDRPC1",162,0)
 N D0,PLACE,X
"RTN","MAGDRPC1",163,0)
 ; This function is also called from various routines
"RTN","MAGDRPC1",164,0)
 ; that belong to automated routing.
"RTN","MAGDRPC1",165,0)
 ;
"RTN","MAGDRPC1",166,0)
 S OUT="-1,"""_NAME_""" is not a valid destination"
"RTN","MAGDRPC1",167,0)
 ;
"RTN","MAGDRPC1",168,0)
 I $D(^MAG(2005.2,"B")) D  Q
"RTN","MAGDRPC1",169,0)
 . S D0=$O(^MAG(2005.2,"B",NAME,"")) Q:'D0
"RTN","MAGDRPC1",170,0)
 . S:$P($G(^MAG(2005.2,D0,0)),"^",9) OUT=D0
"RTN","MAGDRPC1",171,0)
 . Q
"RTN","MAGDRPC1",172,0)
 ;
"RTN","MAGDRPC1",173,0)
 S D0=""
"RTN","MAGDRPC1",174,0)
 S PLACE="" F  S PLACE=$O(^MAG(2005.2,"D",PLACE)) Q:PLACE=""  D  Q:OUT>0
"RTN","MAGDRPC1",175,0)
 . S D0=$O(^MAG(2005.2,"D",PLACE,NAME,""))
"RTN","MAGDRPC1",176,0)
 . S:$P($G(^MAG(2005.2,D0,0)),"^",9) OUT=D0
"RTN","MAGDRPC1",177,0)
 . Q
"RTN","MAGDRPC1",178,0)
 Q
"RTN","MAGDRPC1",179,0)
 ;
"RTN","MAGDRPC1",180,0)
PAT(OUT,DFN) ; RPC = MAG DICOM GET PATIENT
"RTN","MAGDRPC1",181,0)
 N DIQUIET,I,N,VADM,VAIN,VAPA,VASD
"RTN","MAGDRPC1",182,0)
 K OUT
"RTN","MAGDRPC1",183,0)
 I '$G(DFN) S OUT(1)="-1,No Patient Identified" Q
"RTN","MAGDRPC1",184,0)
 S N=1,DIQUIET=1
"RTN","MAGDRPC1",185,0)
 D DEM^VADPT,VA("DEM","VADM","")
"RTN","MAGDRPC1",186,0)
 D ADD^VADPT,VA("ADD","VAPA","")
"RTN","MAGDRPC1",187,0)
 D INP^VADPT,VA("INP","VAIN","")
"RTN","MAGDRPC1",188,0)
 D SDA^VADPT,VA("SDA","VASD","")
"RTN","MAGDRPC1",189,0)
 S X=$$GETICN^MPIF001(DFN) S:X'<0 N=N+1,OUT(N)="ICN^1^"_X
"RTN","MAGDRPC1",190,0)
 S OUT(1)=N-1
"RTN","MAGDRPC1",191,0)
 Q
"RTN","MAGDRPC1",192,0)
 ;
"RTN","MAGDRPC1",193,0)
VA(PRE,ARR,SUB) N A,I,X
"RTN","MAGDRPC1",194,0)
 S I="" F  S I=$O(@ARR@(I)) Q:I=""  D
"RTN","MAGDRPC1",195,0)
 . S A=$NAME(@ARR@(I))
"RTN","MAGDRPC1",196,0)
 . S X=$G(@A) S:X'="" N=N+1,OUT(N)=PRE_"^"_SUB_I_"^"_X
"RTN","MAGDRPC1",197,0)
 . D:$D(@A)>9 VA(PRE,A,SUB_I_",")
"RTN","MAGDRPC1",198,0)
 . Q
"RTN","MAGDRPC1",199,0)
 Q
"RTN","MAGDRPC1",200,0)
 ;
"RTN","MAGDRPC1",201,0)
RARPTO(OUT,TYPE,D0,F,D1) ; RPC = MAG DICOM GET RAD RPT INFO
"RTN","MAGDRPC1",202,0)
 S TYPE=$G(TYPE),D0=$G(D0),F=$G(F,1),D1=+$G(D1)
"RTN","MAGDRPC1",203,0)
 I TYPE="O1" S OUT=+$O(^RARPT(D0),F) Q
"RTN","MAGDRPC1",204,0)
 I TYPE="O2" S OUT=+$O(^RARPT(D0,F,D1)) Q
"RTN","MAGDRPC1",205,0)
 I TYPE="G1" S OUT=$G(^RARPT(D0,0)) Q
"RTN","MAGDRPC1",206,0)
 I TYPE="G2" S OUT=$G(^RARPT(D0,F,D1,0)) Q
"RTN","MAGDRPC1",207,0)
 S OUT="-1,Invalid request type ("""_TYPE_""")"
"RTN","MAGDRPC1",208,0)
 Q
"RTN","MAGDRPC1",209,0)
 ;
"RTN","MAGDRPC1",210,0)
LISTORIG(OUT) ; RPC = MAG GET DICOM XMIT ORIGIN
"RTN","MAGDRPC1",211,0)
 N FROM,MSG,N,PRI,RTN
"RTN","MAGDRPC1",212,0)
 S N=1,OUT(1)="No entries in transmission queue"
"RTN","MAGDRPC1",213,0)
 S FROM="" F  S FROM=$O(^MAGDOUTP(2006.574,"STS",FROM)) Q:FROM=""  D
"RTN","MAGDRPC1",214,0)
 . D GETS^DIQ(4,FROM,.01,"","RTN","MSG")
"RTN","MAGDRPC1",215,0)
 . S N=N+1,OUT(N)=FROM_"^"_$G(RTN(4,FROM_",",.01))
"RTN","MAGDRPC1",216,0)
 . Q
"RTN","MAGDRPC1",217,0)
 S:N>1 OUT(1)=N
"RTN","MAGDRPC1",218,0)
 Q
"RTN","MAGDRPC1",219,0)
 ;
"RTN","MAGDRPC2")
0^38^B65430513
"RTN","MAGDRPC2",1,0)
MAGDRPC2 ;WOIFO/EdM - Imaging RPCs ; 05/18/2007 11:23
"RTN","MAGDRPC2",2,0)
 ;;3.0;IMAGING;**11,30,51,50,54**;03-July-2009;;Build 1424
"RTN","MAGDRPC2",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDRPC2",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC2",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRPC2",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRPC2",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRPC2",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRPC2",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRPC2",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRPC2",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRPC2",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRPC2",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRPC2",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRPC2",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRPC2",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC2",17,0)
 ;;
"RTN","MAGDRPC2",18,0)
 Q
"RTN","MAGDRPC2",19,0)
 ;
"RTN","MAGDRPC2",20,0)
SERVICE(OUT) ; RPC = MAG DICOM GET SERVICE INFO
"RTN","MAGDRPC2",21,0)
 N D0,X
"RTN","MAGDRPC2",22,0)
 S D0=$O(^MAG(2006.1,0)),OUT="-1,No Imaging Site Parameters defined" Q:'D0
"RTN","MAGDRPC2",23,0)
 S X=$G(^MAG(2006.1,D0,"GW"))
"RTN","MAGDRPC2",24,0)
 S OUT=$$ENCRYP^ROUTINE($$DECRYP($P(X,"^",1))_";"_$$DECRYP($P(X,"^",2)))
"RTN","MAGDRPC2",25,0)
 Q
"RTN","MAGDRPC2",26,0)
 ;
"RTN","MAGDRPC2",27,0)
SAME(SET,D0,NODE,PIECE,X) ; Called from FileMan ^DD
"RTN","MAGDRPC2",28,0)
 N L0
"RTN","MAGDRPC2",29,0)
 S L0=0 F  S L0=$O(^MAG(2006.1,L0)) Q:'L0  D:L0'=D0
"RTN","MAGDRPC2",30,0)
 . S $P(^MAG(2006.1,L0,NODE),"^",PIECE)=$S(SET:X,1:"")
"RTN","MAGDRPC2",31,0)
 . Q
"RTN","MAGDRPC2",32,0)
 Q
"RTN","MAGDRPC2",33,0)
 ;
"RTN","MAGDRPC2",34,0)
IMAGE(OUT,D0) ; RPC = MAG DICOM GET BASIC IMAGE
"RTN","MAGDRPC2",35,0)
 N I,MSG,TARGET,V,VE,VI,X
"RTN","MAGDRPC2",36,0)
 K OUT S I=1
"RTN","MAGDRPC2",37,0)
 I '$G(D0) S OUT(1)="-1,Invalid IEN ("_$G(D0)_")" Q
"RTN","MAGDRPC2",38,0)
 I $D(^MAG(2005.1,D0,0)) S OUT(1)="-3,Image #"_D0_" has been deleted." Q
"RTN","MAGDRPC2",39,0)
 I '$D(^MAG(2005,D0,0)) S OUT(1)="-2,No data for """_D0_"""." Q
"RTN","MAGDRPC2",40,0)
 ;
"RTN","MAGDRPC2",41,0)
 D GETS^DIQ(2005,D0_",","*","REIN","TARGET","MSG")
"RTN","MAGDRPC2",42,0)
 S X="" F  S X=$O(TARGET(2005,D0_",",X)) Q:X=""  D
"RTN","MAGDRPC2",43,0)
 . S VI=$G(TARGET(2005,D0_",",X,"I"))
"RTN","MAGDRPC2",44,0)
 . S VE=$G(TARGET(2005,D0_",",X,"E"))
"RTN","MAGDRPC2",45,0)
 . S I=I+1,OUT(I)=X_"^"_VI S:VI'=VE OUT(I)=OUT(I)_"^"_VE
"RTN","MAGDRPC2",46,0)
 . Q
"RTN","MAGDRPC2",47,0)
 ;
"RTN","MAGDRPC2",48,0)
 D FILEFIND^MAGDFB(D0,"FULL",0,0,.X,.V)
"RTN","MAGDRPC2",49,0)
 S:X'<0 I=I+1,OUT(I)="Full FileName^"_X
"RTN","MAGDRPC2",50,0)
 S:V'<0 I=I+1,OUT(I)="Full Path+FileName^"_V
"RTN","MAGDRPC2",51,0)
 ;
"RTN","MAGDRPC2",52,0)
 D FILEFIND^MAGDFB(D0,"BIG",0,0,.X,.V)
"RTN","MAGDRPC2",53,0)
 S:X'<0 I=I+1,OUT(I)="Big FileName^"_X
"RTN","MAGDRPC2",54,0)
 S:V'<0 I=I+1,OUT(I)="Big Path+FileName^"_V
"RTN","MAGDRPC2",55,0)
 ;
"RTN","MAGDRPC2",56,0)
 D FILEFIND^MAGDFB(D0,"ABSTRACT",0,0,.X,.V)
"RTN","MAGDRPC2",57,0)
 S:X'<0 I=I+1,OUT(I)="Abstract FileName^"_X
"RTN","MAGDRPC2",58,0)
 S:V'<0 I=I+1,OUT(I)="Abstract Path+FileName^"_V
"RTN","MAGDRPC2",59,0)
 ;
"RTN","MAGDRPC2",60,0)
 S (V,X)=0 F  S X=$O(^MAG(2005,D0,1,X)) Q:'X  S V=V+1
"RTN","MAGDRPC2",61,0)
 S:V I=I+1,OUT(I)="# Images^"_V
"RTN","MAGDRPC2",62,0)
 ;
"RTN","MAGDRPC2",63,0)
 S OUT(1)=I-1
"RTN","MAGDRPC2",64,0)
 Q
"RTN","MAGDRPC2",65,0)
 ;
"RTN","MAGDRPC2",66,0)
GRPIMG(OUT,D0) ; RPC = MAG DICOM GET IMAGE GROUP
"RTN","MAGDRPC2",67,0)
 N I,D1,X
"RTN","MAGDRPC2",68,0)
 D CHK^MAGGSQI(.OUT,D0) I +$G(OUT(0))'=1 Q  ; patient safety
"RTN","MAGDRPC2",69,0)
 K OUT S I=1
"RTN","MAGDRPC2",70,0)
 S D1=0 F  S D1=$O(^MAG(2005,D0,1,D1)) Q:'D1  D
"RTN","MAGDRPC2",71,0)
 . S X=$P($G(^MAG(2005,D0,1,D1,0)),"^",1) Q:'X
"RTN","MAGDRPC2",72,0)
 . S I=I+1,OUT(I)=X
"RTN","MAGDRPC2",73,0)
 . Q
"RTN","MAGDRPC2",74,0)
 S OUT(1)=I-1
"RTN","MAGDRPC2",75,0)
 Q
"RTN","MAGDRPC2",76,0)
 ;
"RTN","MAGDRPC2",77,0)
DECRYP(X) Q $S(X="":"",1:$$DECRYP^ROUTINE(X))
"RTN","MAGDRPC2",78,0)
 ;
"RTN","MAGDRPC2",79,0)
IMGVER(OUT) ; RPC = MAG DICOM GET VERSION
"RTN","MAGDRPC2",80,0)
 N D0,DATINS,FME,FML,I,L,N,P,PATCH,X
"RTN","MAGDRPC2",81,0)
 D FIND^DIC(9.7,"",".01;2I;51I","QU","MAG*3.0","*","B","","","FML","FME")
"RTN","MAGDRPC2",82,0)
 S I="" F  S I=$O(FML("DILIST","ID",I)) Q:I=""  D
"RTN","MAGDRPC2",83,0)
 . S N=$G(FML("DILIST","ID",I,.01)) Q:$P(N,"*",2)'="3.0"
"RTN","MAGDRPC2",84,0)
 . S PATCH=$P(N,"*",3) Q:'PATCH
"RTN","MAGDRPC2",85,0)
 . S PATCH(PATCH)=1
"RTN","MAGDRPC2",86,0)
 . S DATINS=$G(FML("DILIST","ID",I,2)) Q:DATINS=""
"RTN","MAGDRPC2",87,0)
 . S P=$G(FML("DILIST","ID",I,51)) Q:P=""
"RTN","MAGDRPC2",88,0)
 . S L(DATINS,PATCH_"-"_P)=""
"RTN","MAGDRPC2",89,0)
 . Q
"RTN","MAGDRPC2",90,0)
 ;
"RTN","MAGDRPC2",91,0)
 S (DATINS,L,OUT)="" F  S DATINS=$O(L(DATINS),-1) Q:DATINS=""  D
"RTN","MAGDRPC2",92,0)
 . S PATCH="" F  S PATCH=$O(L(DATINS,PATCH)) Q:PATCH=""  D
"RTN","MAGDRPC2",93,0)
 . . S:OUT="" OUT=PATCH
"RTN","MAGDRPC2",94,0)
 . . S:$G(PATCH(+PATCH)) PATCH(+PATCH)=0,L=(+PATCH)_","_L
"RTN","MAGDRPC2",95,0)
 . . Q
"RTN","MAGDRPC2",96,0)
 . Q
"RTN","MAGDRPC2",97,0)
 S OUT=L_OUT
"RTN","MAGDRPC2",98,0)
 Q
"RTN","MAGDRPC2",99,0)
 ;
"RTN","MAGDRPC2",100,0)
PLACE(LOCATION) N D0,FST,LST
"RTN","MAGDRPC2",101,0)
 S FST=+$O(^MAG(2006.1,0)),LST=+$O(^MAG(2006.1," "),-1) Q:LST=FST FST
"RTN","MAGDRPC2",102,0)
 S D0=$O(^MAG(2006.1,"B",+$G(LOCATION),"")) Q:D0 D0
"RTN","MAGDRPC2",103,0)
 Q FST
"RTN","MAGDRPC2",104,0)
 ;
"RTN","MAGDRPC2",105,0)
ROUTEDAY ; Scan for Routing Activity
"RTN","MAGDRPC2",106,0)
 N BUCKET ;- Daily tallies
"RTN","MAGDRPC2",107,0)
 N D0 ;----- Image pointer for child of current parent
"RTN","MAGDRPC2",108,0)
 N D1 ;----- Pointer to multiple in image file
"RTN","MAGDRPC2",109,0)
 N D4 ;----- Loop counter
"RTN","MAGDRPC2",110,0)
 N DAY ;---- Current FileMan date
"RTN","MAGDRPC2",111,0)
 N DAYTIM ;- Current FileMan timestamp
"RTN","MAGDRPC2",112,0)
 N DEST ;--- Destination
"RTN","MAGDRPC2",113,0)
 N FIRST ;-- First date for scan
"RTN","MAGDRPC2",114,0)
 N FSTX ;--- First transmission for current study
"RTN","MAGDRPC2",115,0)
 N IMAGE ;-- Image Pointer for current image
"RTN","MAGDRPC2",116,0)
 N LAST ;--- Last date for scan
"RTN","MAGDRPC2",117,0)
 N LSTQ ;--- Timestamp for last queue entry in current study
"RTN","MAGDRPC2",118,0)
 N P3 ;----- Highest IEN in statistics file
"RTN","MAGDRPC2",119,0)
 N P4 ;----- Number of entries in statistics file
"RTN","MAGDRPC2",120,0)
 N PARENT ;- Image Pointer for parent of current image
"RTN","MAGDRPC2",121,0)
 N R ;------ Retention Period
"RTN","MAGDRPC2",122,0)
 N X ;------ Scratch
"RTN","MAGDRPC2",123,0)
 N XMIT ;--- Total duration of transmissions for current study
"RTN","MAGDRPC2",124,0)
 ;
"RTN","MAGDRPC2",125,0)
 K ^TMP("MAG",$J,"RTD1")
"RTN","MAGDRPC2",126,0)
 K ^TMP("MAG",$J,"RTD2")
"RTN","MAGDRPC2",127,0)
 K ^TMP("MAG",$J,"RTD3")
"RTN","MAGDRPC2",128,0)
 S FIRST=$$HTFM^XLFDT($H-4)
"RTN","MAGDRPC2",129,0)
 S LAST=$$HTFM^XLFDT($H+2)
"RTN","MAGDRPC2",130,0)
 ;
"RTN","MAGDRPC2",131,0)
 S DEST="" F  S DEST=$O(^MAG(2005,"ROUTE",DEST)) Q:DEST=""  D
"RTN","MAGDRPC2",132,0)
 . S NAME(DEST)=$P($G(^MAG(2005.2,DEST,0)," ? "_DEST),"^",1)
"RTN","MAGDRPC2",133,0)
 . S DAYTIM=FIRST F  D  S DAYTIM=$O(^MAG(2005,"ROUTE",DEST,DAYTIM)) Q:DAYTIM=""  Q:DAYTIM'<LAST
"RTN","MAGDRPC2",134,0)
 . . S DAY=DAYTIM\1
"RTN","MAGDRPC2",135,0)
 . . S IMAGE="" F  S IMAGE=$O(^MAG(2005,"ROUTE",DEST,DAYTIM,IMAGE)) Q:IMAGE=""  D
"RTN","MAGDRPC2",136,0)
 . . . S PARENT=$P($G(^MAG(2005,IMAGE,0)),"^",10)
"RTN","MAGDRPC2",137,0)
 . . . I PARENT,$G(^TMP("MAG",$J,"RTD3",PARENT)) S PARENT=0
"RTN","MAGDRPC2",138,0)
 . . . S:PARENT ^TMP("MAG",$J,"RTD3",PARENT)=1
"RTN","MAGDRPC2",139,0)
 . . . S (XMIT,LSTQ)=0,FSTX=1E9
"RTN","MAGDRPC2",140,0)
 . . . S D0=IMAGE,D1=0 D  I PARENT F  S D1=$O(^MAG(2005,PARENT,1,D1)) Q:'D1  S D0=+$P($G(^MAG(2005,PARENT,1,D1,0)),"^",1) D
"RTN","MAGDRPC2",141,0)
 . . . . Q:'D0
"RTN","MAGDRPC2",142,0)
 . . . . Q:$D(^TMP("MAG",$J,"RTD1",D0,D1))
"RTN","MAGDRPC2",143,0)
 . . . . S ^TMP("MAG",$J,"RTD1",D0,D1)=""
"RTN","MAGDRPC2",144,0)
 . . . . S D4=0 F  S D4=$O(^MAG(2005,D0,4,D4)) Q:'D4  D
"RTN","MAGDRPC2",145,0)
 . . . . . S X=$G(^MAG(2005,D0,4,D4,0))
"RTN","MAGDRPC2",146,0)
 . . . . . Q:$P($P(X,"^",1),".",1)'=DAY
"RTN","MAGDRPC2",147,0)
 . . . . . Q:$P(X,"^",2)'=DEST
"RTN","MAGDRPC2",148,0)
 . . . . . S:$P(X,"^",6)>LSTQ LSTQ=$P(X,"^",6)
"RTN","MAGDRPC2",149,0)
 . . . . . S:$P(X,"^",5)<FSTX FSTX=$P(X,"^",5)
"RTN","MAGDRPC2",150,0)
 . . . . . S XMIT=XMIT+$$DELTA($P(X,"^",5),$P(X,"^",1))
"RTN","MAGDRPC2",151,0)
 . . . . . Q
"RTN","MAGDRPC2",152,0)
 . . . . Q
"RTN","MAGDRPC2",153,0)
 . . . S X=$$DELTA(LSTQ,FSTX)
"RTN","MAGDRPC2",154,0)
 . . . S:X>$G(BUCKET(DAY,DEST,1)) BUCKET(DAY,DEST,1)=X
"RTN","MAGDRPC2",155,0)
 . . . S X=$S(X<300:1,X<900:2,X<3600:3,1:4)
"RTN","MAGDRPC2",156,0)
 . . . S BUCKET(DAY,DEST,1,X)=$G(BUCKET(DAY,DEST,1,X))+1
"RTN","MAGDRPC2",157,0)
 . . . S:XMIT>$G(BUCKET(DAY,DEST,2)) BUCKET(DAY,DEST,2)=XMIT
"RTN","MAGDRPC2",158,0)
 . . . S X=$S(XMIT<300:1,XMIT<900:2,XMIT<3600:3,1:4)
"RTN","MAGDRPC2",159,0)
 . . . S BUCKET(DAY,DEST,2,X)=$G(BUCKET(DAY,DEST,2,X))+1
"RTN","MAGDRPC2",160,0)
 . . . Q
"RTN","MAGDRPC2",161,0)
 . . Q
"RTN","MAGDRPC2",162,0)
 . Q
"RTN","MAGDRPC2",163,0)
 ;
"RTN","MAGDRPC2",164,0)
 S X=$G(^TMP("MAG",$J,"RTD2",0)),P3=+$P(X,"^",3),P4=+$P(X,"^",4)
"RTN","MAGDRPC2",165,0)
 S DAY="" F  S DAY=$O(BUCKET(DAY)) Q:DAY=""  D
"RTN","MAGDRPC2",166,0)
 . S:'$D(^TMP("MAG",$J,"RTD2",DAY)) P4=P4+1,^TMP("MAG",$J,"RTD2",DAY,0)=DAY
"RTN","MAGDRPC2",167,0)
 . S D1=0,DEST="" F  S DEST=$O(BUCKET(DAY,DEST)) Q:DEST=""  D
"RTN","MAGDRPC2",168,0)
 . . S D1=D1+1
"RTN","MAGDRPC2",169,0)
 . . S X=$G(BUCKET(DAY,DEST,2,1))       ; Less than 5 minutes
"RTN","MAGDRPC2",170,0)
 . . S X=X_"^"_$G(BUCKET(DAY,DEST,2,2)) ; Less than 15 minutes
"RTN","MAGDRPC2",171,0)
 . . S X=X_"^"_$G(BUCKET(DAY,DEST,2,3)) ; Less than 1 hour
"RTN","MAGDRPC2",172,0)
 . . S X=X_"^"_$G(BUCKET(DAY,DEST,2,4)) ; 1 hour or more
"RTN","MAGDRPC2",173,0)
 . . S X=X_"^"_$G(BUCKET(DAY,DEST,2))   ; Longest
"RTN","MAGDRPC2",174,0)
 . . S X=X_"^Duration ("_NAME(DEST)_")"
"RTN","MAGDRPC2",175,0)
 . . S ^TMP("MAG",$J,"RTD2",DAY,1,D1,0)=X
"RTN","MAGDRPC2",176,0)
 . . S D1=D1+1
"RTN","MAGDRPC2",177,0)
 . . S X=$G(BUCKET(DAY,DEST,1,1))       ; Less than 5 minutes
"RTN","MAGDRPC2",178,0)
 . . S X=X_"^"_$G(BUCKET(DAY,DEST,1,2)) ; Less than 15 minutes
"RTN","MAGDRPC2",179,0)
 . . S X=X_"^"_$G(BUCKET(DAY,DEST,1,3)) ; Less than 1 hour
"RTN","MAGDRPC2",180,0)
 . . S X=X_"^"_$G(BUCKET(DAY,DEST,1,4)) ; 1 hour or more
"RTN","MAGDRPC2",181,0)
 . . S X=X_"^"_$G(BUCKET(DAY,DEST,1))   ; Longest
"RTN","MAGDRPC2",182,0)
 . . S X=X_"^Lag ("_NAME(DEST)_")"
"RTN","MAGDRPC2",183,0)
 . . S ^TMP("MAG",$J,"RTD2",DAY,1,D1,0)=X
"RTN","MAGDRPC2",184,0)
 . . Q
"RTN","MAGDRPC2",185,0)
 . S:DAY>P3 P3=DAY
"RTN","MAGDRPC2",186,0)
 . Q
"RTN","MAGDRPC2",187,0)
 ; Purge old entries
"RTN","MAGDRPC2",188,0)
 S R=$G(^MAGDICOM(2006.563,1,"RETAIN ROUTING STATISTICS")) S:R<1 R=30
"RTN","MAGDRPC2",189,0)
 S DAY=$$HTFM^XLFDT($H-R)
"RTN","MAGDRPC2",190,0)
 S D0=0 F  S D0=$O(^TMP("MAG",$J,"RTD2",D0)) Q:'D0  Q:D0'<DAY  D
"RTN","MAGDRPC2",191,0)
 . K ^TMP("MAG",$J,"RTD2",D0) S P4=P4-1
"RTN","MAGDRPC2",192,0)
 . Q
"RTN","MAGDRPC2",193,0)
 ;
"RTN","MAGDRPC2",194,0)
 D  ; Get routing statistics
"RTN","MAGDRPC2",195,0)
 . N A,W
"RTN","MAGDRPC2",196,0)
 . S (A,DAY)=0 F  S DAY=$O(^TMP("MAG",$J,"RTD2",DAY)) Q:'DAY  D
"RTN","MAGDRPC2",197,0)
 . . S:'A N=N+1,OUT(N)="Route",A=1
"RTN","MAGDRPC2",198,0)
 . . S N=N+1,OUT(N)="RDT="_DAY
"RTN","MAGDRPC2",199,0)
 . . S W=0 F  S W=$O(^TMP("MAG",$J,"RTD2",DAY,1,W)) Q:'W  D
"RTN","MAGDRPC2",200,0)
 . . . S X=$G(^TMP("MAG",$J,"RTD2",DAY,1,W,0))
"RTN","MAGDRPC2",201,0)
 . . . S N=N+1,OUT(N)="DST="_$P($P($P(X,"^",6),"(",2),")",1)
"RTN","MAGDRPC2",202,0)
 . . . S W=W+1,$P(X,"^",6,10)=$P($G(^TMP("MAG",$J,"RTD2",DAY,1,W,0)),"^",1,5)
"RTN","MAGDRPC2",203,0)
 . . . S N=N+1,OUT(N)="RST="_X
"RTN","MAGDRPC2",204,0)
 . . . Q
"RTN","MAGDRPC2",205,0)
 . . Q
"RTN","MAGDRPC2",206,0)
 . S:A N=N+1,OUT(N)="RouteEnd"
"RTN","MAGDRPC2",207,0)
 . Q
"RTN","MAGDRPC2",208,0)
 K ^TMP("MAG",$J,"RTD1")
"RTN","MAGDRPC2",209,0)
 K ^TMP("MAG",$J,"RTD2")
"RTN","MAGDRPC2",210,0)
 K ^TMP("MAG",$J,"RTD3")
"RTN","MAGDRPC2",211,0)
 Q
"RTN","MAGDRPC2",212,0)
 ;
"RTN","MAGDRPC2",213,0)
DELTA(START,STOP) N D,D1,D2,T1,T2
"RTN","MAGDRPC2",214,0)
 S D1=$P(START,".",1),D2=$P(STOP,".",1)
"RTN","MAGDRPC2",215,0)
 S T1=START*1E6#1E6,T2=STOP*1E6#1E6
"RTN","MAGDRPC2",216,0)
 S T1=T1\10000*60+(T1\100#100)*60+(T1#100)
"RTN","MAGDRPC2",217,0)
 S T2=T2\10000*60+(T2\100#100)*60+(T2#100)
"RTN","MAGDRPC2",218,0)
 S D=0 S:D1'=D2 D=$$FMTH^XLFDT(D2)-$$FMTH^XLFDT(D1)
"RTN","MAGDRPC2",219,0)
 Q D*86400+T2-T1
"RTN","MAGDRPC2",220,0)
 ;
"RTN","MAGDRPC3")
0^39^B64771366
"RTN","MAGDRPC3",1,0)
MAGDRPC3 ;WOIFO/EdM - Imaging RPCs ; 05/18/2007 11:23
"RTN","MAGDRPC3",2,0)
 ;;3.0;IMAGING;**11,30,51,50,85,54**;03-July-2009;;Build 1424
"RTN","MAGDRPC3",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDRPC3",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC3",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRPC3",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRPC3",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRPC3",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRPC3",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRPC3",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRPC3",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRPC3",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRPC3",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRPC3",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRPC3",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRPC3",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC3",17,0)
 ;;
"RTN","MAGDRPC3",18,0)
 Q
"RTN","MAGDRPC3",19,0)
 ;
"RTN","MAGDRPC3",20,0)
RADLKUP(OUT,CASENUMB,STUDYDAT) ; RPC = MAG DICOM LOOKUP RAD STUDY
"RTN","MAGDRPC3",21,0)
 ; Radiology patient/study lookup
"RTN","MAGDRPC3",22,0)
 N ACCNUM ;--- Accession Number
"RTN","MAGDRPC3",23,0)
 N CPTCODE ;-- CPT code for the procedure
"RTN","MAGDRPC3",24,0)
 N CPTNAME ;-- CPT name for the procedure
"RTN","MAGDRPC3",25,0)
 N DATETIME ;- Timestamp
"RTN","MAGDRPC3",26,0)
 N EXAMSTS ;-- Exam status (don't post images to CANCELLED exams)
"RTN","MAGDRPC3",27,0)
 N PROCDESC ;- Procedure description
"RTN","MAGDRPC3",28,0)
 N PROCIEN ;-- radiology procedure ien in ^RAMIS(71)
"RTN","MAGDRPC3",29,0)
 N RAIX ;----- cross reference subscript for case number lookup
"RTN","MAGDRPC3",30,0)
 N RADPT1 ;--- first level subscript in ^RADPT
"RTN","MAGDRPC3",31,0)
 N RADPT2 ;--- second level subscript in ^RADPT (after "DT")
"RTN","MAGDRPC3",32,0)
 N RADPT3 ;--- third level subscript in ^RADPT (after "P")
"RTN","MAGDRPC3",33,0)
 N D1,I,LIST,X,Z
"RTN","MAGDRPC3",34,0)
 ;
"RTN","MAGDRPC3",35,0)
 ; find the patient/study in ^RADPT using the Radiology Case Number
"RTN","MAGDRPC3",36,0)
 K OUT
"RTN","MAGDRPC3",37,0)
 D
"RTN","MAGDRPC3",38,0)
 . I $G(CASENUMB)="" S OUT(1)="-1,No Case Number Specified" Q
"RTN","MAGDRPC3",39,0)
 . S RAIX=$S($D(^RADPT("C")):"C",1:"AE") ; for Radiology Patch RA*5*7
"RTN","MAGDRPC3",40,0)
 . S RAIX=$S(CASENUMB["-":"ADC",1:RAIX) ; select the cross-reference
"RTN","MAGDRPC3",41,0)
 . S RADPT1=$O(^RADPT(RAIX,CASENUMB,"")) I 'RADPT1 D  Q:'RADPT1
"RTN","MAGDRPC3",42,0)
 . . I '$G(STUDYDAT) S OUT(1)="-2,No Study Date Specified",RADPT1=0 Q
"RTN","MAGDRPC3",43,0)
 . . ;
"RTN","MAGDRPC3",44,0)
 . . ; Search 1-3 days prior the study date OR a day in advance but only
"RTN","MAGDRPC3",45,0)
 . . ; if the study date is not equal to today or greater than today.
"RTN","MAGDRPC3",46,0)
 . . ; Has to be long case number or must have an image study date
"RTN","MAGDRPC3",47,0)
 . . ;
"RTN","MAGDRPC3",48,0)
 . . N II,RCASE,SDATE,TODAY,X,Y
"RTN","MAGDRPC3",49,0)
 . . ;
"RTN","MAGDRPC3",50,0)
 . . S RCASE=$S(CASENUMB["-":$P(CASENUMB,"-",2),1:CASENUMB)
"RTN","MAGDRPC3",51,0)
 . . I 'RCASE S RADPT1=0 Q
"RTN","MAGDRPC3",52,0)
 . . ;
"RTN","MAGDRPC3",53,0)
 . . S TODAY=$$NOW^XLFDT()\1
"RTN","MAGDRPC3",54,0)
 . . S X=$P(STUDYDAT,"."),SDATE=$E(X,1,4)-1700_$E(X,5,8) ; FileMan date
"RTN","MAGDRPC3",55,0)
 . . ;
"RTN","MAGDRPC3",56,0)
 . . ; 1-3 days prior study date
"RTN","MAGDRPC3",57,0)
 . . F II=1:1:3 S RADPT1=$$FIND(SDATE,RCASE,-II) Q:RADPT1
"RTN","MAGDRPC3",58,0)
 . . Q:RADPT1
"RTN","MAGDRPC3",59,0)
 . . ;
"RTN","MAGDRPC3",60,0)
 . . ; Wild goose chase, but check for today's case
"RTN","MAGDRPC3",61,0)
 . . S RADPT1=$O(^RADPT("ADC",$$MMDDYY(TODAY)_"-"_RCASE,"")) Q:RADPT1
"RTN","MAGDRPC3",62,0)
 . . ;
"RTN","MAGDRPC3",63,0)
 . . I SDATE'<TODAY S RADPT1=0 Q
"RTN","MAGDRPC3",64,0)
 . . ;
"RTN","MAGDRPC3",65,0)
 . . ; One day in advance?
"RTN","MAGDRPC3",66,0)
 . . S RADPT1=$$FIND(SDATE,RCASE,1) Q:RADPT1
"RTN","MAGDRPC3",67,0)
 . . ;
"RTN","MAGDRPC3",68,0)
 . . ; Finally just check the "C" or "AE" x-reference for the case number
"RTN","MAGDRPC3",69,0)
 . . S X=$S($O(^RADPT("C","")):"C",1:"AE") ; RA*5*7 patch
"RTN","MAGDRPC3",70,0)
 . . S RADPT1=$O(^RADPT(X,RCASE,""))
"RTN","MAGDRPC3",71,0)
 . . Q
"RTN","MAGDRPC3",72,0)
 . S RADPT2=$O(^RADPT(RAIX,CASENUMB,RADPT1,"")) Q:'RADPT2
"RTN","MAGDRPC3",73,0)
 . S RADPT3=$O(^RADPT(RAIX,CASENUMB,RADPT1,RADPT2,"")) Q:'RADPT3
"RTN","MAGDRPC3",74,0)
 . Q:'$D(^RADPT(RADPT1,0))  ; no patient demographics file pointer
"RTN","MAGDRPC3",75,0)
 . ; get patient demographics file pointer
"RTN","MAGDRPC3",76,0)
 . S DFN=$P(^RADPT(RADPT1,0),"^",1)
"RTN","MAGDRPC3",77,0)
 . Q:'$D(^RADPT(RADPT1,"DT",RADPT2,0))  ; no datetime level
"RTN","MAGDRPC3",78,0)
 . ; get date and time of examination
"RTN","MAGDRPC3",79,0)
 . S DATETIME=$P($G(^RADPT(RADPT1,"DT",RADPT2,0)),"^",1)
"RTN","MAGDRPC3",80,0)
 . ; get case info
"RTN","MAGDRPC3",81,0)
 . S X=$G(^RADPT(RADPT1,"DT",RADPT2,"P",RADPT3,0))
"RTN","MAGDRPC3",82,0)
 . S Z=$P(X,"^",17) I Z S Z=$P($G(^RARPT(Z,0)),"^",1) S:Z'="" ACCNUM=Z
"RTN","MAGDRPC3",83,0)
 . S PROCIEN=$P(X,"^",2),EXAMSTS=$P(X,"^",3)
"RTN","MAGDRPC3",84,0)
 . S:EXAMSTS EXAMSTS=$$GET1^DIQ(72,EXAMSTS,.01)
"RTN","MAGDRPC3",85,0)
 . S (PROCDESC,CPTNAME,CPTCODE)=""
"RTN","MAGDRPC3",86,0)
 . Q:'PROCIEN  ; need PROCIEN to do lookup in ^RAMIS
"RTN","MAGDRPC3",87,0)
 . S Z=$G(^RAMIS(71,PROCIEN,0))
"RTN","MAGDRPC3",88,0)
 . S PROCDESC=$P(Z,"^",1),CPTCODE=$P(Z,"^",9)
"RTN","MAGDRPC3",89,0)
 . S CPTNAME=$P($$CPT^ICPTCOD(+CPTCODE),"^",3) ; IA 1995
"RTN","MAGDRPC3",90,0)
 . S:CPTNAME="" CPTNAME=PROCDESC
"RTN","MAGDRPC3",91,0)
 . Q
"RTN","MAGDRPC3",92,0)
 S OUT(2)=$G(RADPT1)
"RTN","MAGDRPC3",93,0)
 S OUT(3)=$G(RADPT2)
"RTN","MAGDRPC3",94,0)
 S OUT(4)=$G(RADPT3)
"RTN","MAGDRPC3",95,0)
 S OUT(5)=$G(PROCIEN)
"RTN","MAGDRPC3",96,0)
 S OUT(6)=$G(CPTCODE)
"RTN","MAGDRPC3",97,0)
 S OUT(7)=$G(CPTNAME)
"RTN","MAGDRPC3",98,0)
 S OUT(8)=$G(Z)
"RTN","MAGDRPC3",99,0)
 S OUT(9)=$G(EXAMSTS)
"RTN","MAGDRPC3",100,0)
 S OUT(10)=$G(DFN)
"RTN","MAGDRPC3",101,0)
 S OUT(11)=$G(DATETIME)
"RTN","MAGDRPC3",102,0)
 S OUT(12)=$G(PROCDESC)
"RTN","MAGDRPC3",103,0)
 S X=""
"RTN","MAGDRPC3",104,0)
 I $G(PROCIEN) S D1=0 F  S D1=$O(^RAMIS(71,PROCIEN,"MDL",D1)) Q:'D1  D
"RTN","MAGDRPC3",105,0)
 . S Z=+$P($G(^RAMIS(71,PROCIEN,"MDL",D1,0)),"^",1) Q:'Z
"RTN","MAGDRPC3",106,0)
 . S Z=$P($G(^RAMIS(73.1,Z,0)),"^",1) Q:Z=""
"RTN","MAGDRPC3",107,0)
 . S:X'="" X=X_"," S X=X_Z
"RTN","MAGDRPC3",108,0)
 . Q
"RTN","MAGDRPC3",109,0)
 S OUT(13)=X ; List of Modality-codes
"RTN","MAGDRPC3",110,0)
 S X="" I $G(RADPT1),$G(RADPT2) S X=$G(^RADPT(RADPT1,"DT",RADPT2,0))
"RTN","MAGDRPC3",111,0)
 S OUT(14)=$P(X,"^",3) ; Site
"RTN","MAGDRPC3",112,0)
 ; Patient's pregnancy status at the time of the exam
"RTN","MAGDRPC3",113,0)
 S X="" I $G(DFN),$G(RADPT2),$G(RADPT3) S X=$G(^RADPT(DFN,"DT",RADPT2,"P",RADPT3,0))
"RTN","MAGDRPC3",114,0)
 S OUT(15)=$P($G(^RAO(75.1,+$P(X,"^",11),0)),"^",13)
"RTN","MAGDRPC3",115,0)
 S OUT(16)=$G(ACCNUM)
"RTN","MAGDRPC3",116,0)
 S OUT(1)=1 ; OK
"RTN","MAGDRPC3",117,0)
 Q
"RTN","MAGDRPC3",118,0)
 ;
"RTN","MAGDRPC3",119,0)
QUEUE(OUT,IMAGE,APPNAM,LOCATION,ACCNUM,REASON,EMAIL,PRIOR,JBTOHD) ; RPC = MAG DICOM QUEUE IMAGE
"RTN","MAGDRPC3",120,0)
 ; Add the DICOM study send image request to the queue
"RTN","MAGDRPC3",121,0)
 N COUNT,D0,D1,DFN,LOG,OK,PROBLEM,TYPE,X
"RTN","MAGDRPC3",122,0)
 ;
"RTN","MAGDRPC3",123,0)
 I '$G(IMAGE) S OUT="-1,No Image specified" Q
"RTN","MAGDRPC3",124,0)
 I $G(APPNAM)="" S OUT="-2,No Destination specified" Q
"RTN","MAGDRPC3",125,0)
 I '$G(LOCATION) S OUT="-3,No Origin specified" Q
"RTN","MAGDRPC3",126,0)
 S PRIOR=+$G(PRIOR) S:'PRIOR PRIOR=500
"RTN","MAGDRPC3",127,0)
 S JBTOHD=$S($G(JBTOHD):1,1:0)
"RTN","MAGDRPC3",128,0)
 ;
"RTN","MAGDRPC3",129,0)
 S X=$G(^MAG(2005,IMAGE,0))
"RTN","MAGDRPC3",130,0)
 S TYPE=+$P(X,"^",6),DFN=$P(X,"^",7)
"RTN","MAGDRPC3",131,0)
 I " 0 11 3 100 "'[(" "_TYPE_" ") D  Q
"RTN","MAGDRPC3",132,0)
 . S OUT="-4,Cannot Queue Image Object Type """_TYPE_"""."
"RTN","MAGDRPC3",133,0)
 . Q
"RTN","MAGDRPC3",134,0)
 ;
"RTN","MAGDRPC3",135,0)
 L +^MAGDOUTP(2006.574,0):1E9 ; Background process MUST wait
"RTN","MAGDRPC3",136,0)
 S P=$P($G(^MAG(2005,IMAGE,0)),"^",10),P=$S(P:P,1:IMAGE)
"RTN","MAGDRPC3",137,0)
 S STUID=$P($G(^MAG(2005,P,"PACS")),"^",1) S:STUID="" STUID="?"
"RTN","MAGDRPC3",138,0)
 S OK=0,D0="" F  S D0=$O(^MAGDOUTP(2006.574,"STUDY",STUID,D0)) Q:'D0  D  Q:OK
"RTN","MAGDRPC3",139,0)
 . Q:'$D(^MAGDOUTP(2006.574,"STS",LOCATION,PRIOR,"WAITING",D0))
"RTN","MAGDRPC3",140,0)
 . Q:$P($G(^MAGDOUTP(2006.574,D0,0)),"^",1)'=APPNAM
"RTN","MAGDRPC3",141,0)
 . S OK=D0
"RTN","MAGDRPC3",142,0)
 . Q
"RTN","MAGDRPC3",143,0)
 S D0=OK D:'D0
"RTN","MAGDRPC3",144,0)
 . S X=$G(^MAGDOUTP(2006.574,0))
"RTN","MAGDRPC3",145,0)
 . S $P(X,"^",1,2)="DICOM IMAGE OUTPUT FILE^2006.574"
"RTN","MAGDRPC3",146,0)
 . S D0=$O(^MAGDOUTP(2006.574," "),-1)+1 ; Next number
"RTN","MAGDRPC3",147,0)
 . S $P(X,"^",3)=D0
"RTN","MAGDRPC3",148,0)
 . S $P(X,"^",4)=$P(X,"^",4)+1 ; Total count
"RTN","MAGDRPC3",149,0)
 . S ^MAGDOUTP(2006.574,0)=X
"RTN","MAGDRPC3",150,0)
 . ;
"RTN","MAGDRPC3",151,0)
 . S ^MAGDOUTP(2006.574,D0,0)=APPNAM_"^"_P_"^"_$G(ACCNUM)_"^"_LOCATION_"^"_PRIOR_"^"_JBTOHD
"RTN","MAGDRPC3",152,0)
 . S ^MAGDOUTP(2006.574,D0,2)=STUID
"RTN","MAGDRPC3",153,0)
 . S ^MAGDOUTP(2006.574,"STUDY",STUID,D0)=""
"RTN","MAGDRPC3",154,0)
 . Q
"RTN","MAGDRPC3",155,0)
 L -^MAGDOUTP(2006.574,0)
"RTN","MAGDRPC3",156,0)
 ;
"RTN","MAGDRPC3",157,0)
 S COUNT=0,PROBLEM=3
"RTN","MAGDRPC3",158,0)
 I (TYPE=3)!(TYPE=100) D  ; Single XRAY or DICOM image
"RTN","MAGDRPC3",159,0)
 . S COUNT=COUNT+$$ENQUEUE(IMAGE,D0,PRIOR)
"RTN","MAGDRPC3",160,0)
 . Q
"RTN","MAGDRPC3",161,0)
 I TYPE=11 D  ; Process all the images in an XRAY group
"RTN","MAGDRPC3",162,0)
 . S D1=0 F  S D1=$O(^MAG(2005,IMAGE,1,D1)) Q:'D1  D
"RTN","MAGDRPC3",163,0)
 . . S COUNT=COUNT+$$ENQUEUE($P($G(^MAG(2005,IMAGE,1,D1,0)),"^",1),D0,PRIOR)
"RTN","MAGDRPC3",164,0)
 . . Q
"RTN","MAGDRPC3",165,0)
 . Q
"RTN","MAGDRPC3",166,0)
 ;
"RTN","MAGDRPC3",167,0)
 S LOG="DICOM transmit to "_APPNAM_" for reason "_REASON
"RTN","MAGDRPC3",168,0)
 D:COUNT ENTRY^MAGLOG($C(REASON+64),DUZ,IMAGE,"DICOM Gateway",DFN,COUNT,LOG)
"RTN","MAGDRPC3",169,0)
 D:PROBLEM>3
"RTN","MAGDRPC3",170,0)
 . N XMERR,XMID,XMSUB,XMY
"RTN","MAGDRPC3",171,0)
 . S PROBLEM(1)="Error while queueing image for Transmission:"
"RTN","MAGDRPC3",172,0)
 . S PROBLEM(2)=LOG
"RTN","MAGDRPC3",173,0)
 . S PROBLEM(3)=" "
"RTN","MAGDRPC3",174,0)
 . ; --- send MailMan message...
"RTN","MAGDRPC3",175,0)
 . S XMID=$G(DUZ) S:'XMID XMID=.5
"RTN","MAGDRPC3",176,0)
 . S XMY(XMID)=""
"RTN","MAGDRPC3",177,0)
 . S:$G(EMAIL)'="" XMY(EMAIL)=""
"RTN","MAGDRPC3",178,0)
 . S XMSUB=$E("Cannot transmit image(s) to "_APPNAM,1,63)
"RTN","MAGDRPC3",179,0)
 . D SENDMSG^XMXAPI(XMID,XMSUB,"PROBLEM",.XMY,,.XMZ,)
"RTN","MAGDRPC3",180,0)
 . Q:'$G(XMERR)
"RTN","MAGDRPC3",181,0)
 . M XMERR=^TMP("XMERR",$J) S $EC=",U13-Cannot send MailMan message,"
"RTN","MAGDRPC3",182,0)
 . Q
"RTN","MAGDRPC3",183,0)
 S OUT=1
"RTN","MAGDRPC3",184,0)
 Q
"RTN","MAGDRPC3",185,0)
 ;
"RTN","MAGDRPC3",186,0)
ENQUEUE(IMAGE,D0,PRIOR) ; Add an image to the DICOM send image request queue sub-file
"RTN","MAGDRPC3",187,0)
 Q:'IMAGE 0
"RTN","MAGDRPC3",188,0)
 N D1,I,OLD,X
"RTN","MAGDRPC3",189,0)
 D CHK^MAGGSQI(.X,IMAGE) I +$G(X(0))'=1 D  Q 0
"RTN","MAGDRPC3",190,0)
 . S PROBLEM=PROBLEM+1,PROBLEM(PROBLEM)=" "
"RTN","MAGDRPC3",191,0)
 . S PROBLEM=PROBLEM+1,PROBLEM(PROBLEM)="Image # "_IMAGE_":"
"RTN","MAGDRPC3",192,0)
 . S I="" F  S I=$O(X(I)) Q:I=""  S PROBLEM=PROBLEM+1,PROBLEM(PROBLEM)=X(I)
"RTN","MAGDRPC3",193,0)
 . Q
"RTN","MAGDRPC3",194,0)
 ;
"RTN","MAGDRPC3",195,0)
 ; Enter each image at most once in each transmission request
"RTN","MAGDRPC3",196,0)
 S (D1,OLD)=0 F  S D1=$O(^MAGDOUTP(2006.574,D0,1,D1)) Q:'D1  D  Q:OLD
"RTN","MAGDRPC3",197,0)
 . S:$P($G(^MAGDOUTP(2006.574,D0,1,D1,0)),"^",1)=IMAGE OLD=1
"RTN","MAGDRPC3",198,0)
 . Q
"RTN","MAGDRPC3",199,0)
 Q:OLD 1
"RTN","MAGDRPC3",200,0)
 ;
"RTN","MAGDRPC3",201,0)
 L +^MAGDOUTP(2006.574,D0,1,0):1E9 ; Background Process MUST wait
"RTN","MAGDRPC3",202,0)
 S X=$G(^MAGDOUTP(2006.574,D0,1,0))
"RTN","MAGDRPC3",203,0)
 S $P(X,"^",1,2)="^2006.5744"
"RTN","MAGDRPC3",204,0)
 S D1=$O(^MAGDOUTP(2006.574,D0,1," "),-1)+1,$P(X,"^",3)=D1
"RTN","MAGDRPC3",205,0)
 S $P(X,"^",4)=$P(X,"^",4)+1,OUT=$P(X,"^",4)
"RTN","MAGDRPC3",206,0)
 S ^MAGDOUTP(2006.574,D0,1,0)=X
"RTN","MAGDRPC3",207,0)
 S ^MAGDOUTP(2006.574,D0,1,D1,0)=IMAGE_"^WAITING^"_$H
"RTN","MAGDRPC3",208,0)
 S ^MAGDOUTP(2006.574,"STS",LOCATION,PRIOR,"WAITING",D0,D1)=""
"RTN","MAGDRPC3",209,0)
 L -^MAGDOUTP(2006.574,D0,1,0)
"RTN","MAGDRPC3",210,0)
 Q 1
"RTN","MAGDRPC3",211,0)
 ;
"RTN","MAGDRPC3",212,0)
FIND(DATE,CASE,NUM) ; ADC x-reference (Radiology patient file)
"RTN","MAGDRPC3",213,0)
 N X
"RTN","MAGDRPC3",214,0)
 Q:'$G(DATE) 0
"RTN","MAGDRPC3",215,0)
 S X=DATE S:$G(NUM) X=$$FMADD^XLFDT(DATE,NUM) Q:X<1 0
"RTN","MAGDRPC3",216,0)
 Q $O(^RADPT("ADC",$$MMDDYY(X)_"-"_CASE,""))
"RTN","MAGDRPC3",217,0)
 ;
"RTN","MAGDRPC3",218,0)
MMDDYY(DAY) ; YYYMMDD --> MMDDYY
"RTN","MAGDRPC3",219,0)
 I DAY'?7N Q 0
"RTN","MAGDRPC3",220,0)
 Q $E(DAY,4,7)_$E(DAY,2,3)
"RTN","MAGDRPC3",221,0)
 ;
"RTN","MAGDRPC4")
0^40^B79966759
"RTN","MAGDRPC4",1,0)
MAGDRPC4 ;WOIFO/EdM - Imaging RPCs ; 07/10/2007 13:30
"RTN","MAGDRPC4",2,0)
 ;;3.0;IMAGING;**11,30,51,50,54**;03-July-2009;;Build 1424
"RTN","MAGDRPC4",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDRPC4",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC4",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRPC4",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRPC4",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRPC4",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRPC4",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRPC4",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRPC4",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRPC4",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRPC4",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRPC4",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRPC4",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRPC4",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC4",17,0)
 ;;
"RTN","MAGDRPC4",18,0)
 Q
"RTN","MAGDRPC4",19,0)
 ;
"RTN","MAGDRPC4",20,0)
LOOKUP(OUT,NUMBER) ; RPC = MAG DICOM LOOKUP STUDY
"RTN","MAGDRPC4",21,0)
 ; Look Up for both Radiology and Consults
"RTN","MAGDRPC4",22,0)
 N ACCNUM ;--- Accession Number
"RTN","MAGDRPC4",23,0)
 N CPTCODE ;-- CPT code for the procedure
"RTN","MAGDRPC4",24,0)
 N CPTNAME ;-- CPT name for the procedure
"RTN","MAGDRPC4",25,0)
 N DFN ;------ Patient pointer
"RTN","MAGDRPC4",26,0)
 N EXAMSTS ;-- Exam status (don't post images to CANCELLED exams)
"RTN","MAGDRPC4",27,0)
 N EXAMTYP ;-- Type of exam (Rad or Con)
"RTN","MAGDRPC4",28,0)
 N GMRCIEN ;-- Pointer for GMRC
"RTN","MAGDRPC4",29,0)
 N PROCDESC ;- Procedure description
"RTN","MAGDRPC4",30,0)
 N PROCIEN ;-- Radiology procedure IEN in ^RAMIS(71)
"RTN","MAGDRPC4",31,0)
 N RAIX ;----- cross reference subscript for case number lookup
"RTN","MAGDRPC4",32,0)
 N RADFN ;---- first level subscript in ^RADPT
"RTN","MAGDRPC4",33,0)
 N RADTI ;---- second level subscript in ^RADPT (after "DT")
"RTN","MAGDRPC4",34,0)
 N RACNI ;---- third level subscript in ^RADPT (after "P")
"RTN","MAGDRPC4",35,0)
 N RARPT ;---- Radiology Report pointer
"RTN","MAGDRPC4",36,0)
 N I,LIST,NOUT,X,Z
"RTN","MAGDRPC4",37,0)
 ;
"RTN","MAGDRPC4",38,0)
 K OUT S NOUT=1
"RTN","MAGDRPC4",39,0)
 I $G(NUMBER)="" S OUT(1)="-1,No Case or Consult Number Specified" Q
"RTN","MAGDRPC4",40,0)
 I $E(NUMBER,2)="`" D  Q
"RTN","MAGDRPC4",41,0)
 . ; lookup the image by the IEN
"RTN","MAGDRPC4",42,0)
 . D IENLOOK^MAGDRPC9
"RTN","MAGDRPC4",43,0)
 . Q
"RTN","MAGDRPC4",44,0)
 ;
"RTN","MAGDRPC4",45,0)
 S EXAMTYP=$E(NUMBER,1)
"RTN","MAGDRPC4",46,0)
 I "RC"[EXAMTYP S NUMBER=$E(NUMBER,2,$L(NUMBER))
"RTN","MAGDRPC4",47,0)
 E  S EXAMTYP=""
"RTN","MAGDRPC4",48,0)
 K DFN
"RTN","MAGDRPC4",49,0)
 D  ; First try Radiology candidates
"RTN","MAGDRPC4",50,0)
 . I EXAMTYP'="",EXAMTYP'="R" Q
"RTN","MAGDRPC4",51,0)
 . D  ; Look for the patient/study in ^RADPT using the Radiology Case Number
"RTN","MAGDRPC4",52,0)
 . . N RAIX ;----- cross reference subscript for case number lookup
"RTN","MAGDRPC4",53,0)
 . . S RAIX=$S($D(^RADPT("C")):"C",1:"AE") ; for Radiology Patch RA*5*7
"RTN","MAGDRPC4",54,0)
 . . S RAIX=$S(NUMBER["-":"ADC",1:RAIX) ; select the cross-reference
"RTN","MAGDRPC4",55,0)
 . . S RADFN=$O(^RADPT(RAIX,NUMBER,"")) I 'RADFN D  Q:'RADFN
"RTN","MAGDRPC4",56,0)
 . . . I NUMBER'["-" S OUT(1)="-2,No Study Date Specified" Q
"RTN","MAGDRPC4",57,0)
 . . . S X=$P(NUMBER,"-",1)
"RTN","MAGDRPC4",58,0)
 . . . I $L(X)'=6 S OUT(1)="-3,Invalid study date """_X_"""." Q
"RTN","MAGDRPC4",59,0)
 . . . S SDATE=$S($E(X,5,6)<30:3,1:2)_$E(X,5,6)_$E(X,1,4)
"RTN","MAGDRPC4",60,0)
 . . . D:SDATE
"RTN","MAGDRPC4",61,0)
 . . . . ; Search 1-3 days prior the study date OR a day in advance but only
"RTN","MAGDRPC4",62,0)
 . . . . ; if the study date is not equal to today or greater than today.
"RTN","MAGDRPC4",63,0)
 . . . . ; Has to be long case number or must have an image study date
"RTN","MAGDRPC4",64,0)
 . . . . N II,RCASE,TODAY,X,Y
"RTN","MAGDRPC4",65,0)
 . . . . S RCASE=$S(NUMBER["-":$P(NUMBER,"-",2),1:NUMBER) Q:'RCASE
"RTN","MAGDRPC4",66,0)
 . . . . S TODAY=$$NOW^XLFDT()\1
"RTN","MAGDRPC4",67,0)
 . . . . ;
"RTN","MAGDRPC4",68,0)
 . . . . ;  1-3 days prior study date
"RTN","MAGDRPC4",69,0)
 . . . . F II=1:1:3 S RADFN=$$FIND(SDATE,RCASE,-II) Q:RADFN
"RTN","MAGDRPC4",70,0)
 . . . . Q:RADFN
"RTN","MAGDRPC4",71,0)
 . . . . ;
"RTN","MAGDRPC4",72,0)
 . . . . ; Wild goose chase but check for today's case
"RTN","MAGDRPC4",73,0)
 . . . . S RADFN=$O(^RADPT("ADC",$$MMDDYY(TODAY)_"-"_RCASE,"")) Q:RADFN
"RTN","MAGDRPC4",74,0)
 . . . . ;
"RTN","MAGDRPC4",75,0)
 . . . . Q:SDATE'<TODAY
"RTN","MAGDRPC4",76,0)
 . . . . S RADFN=$$FIND(SDATE,RCASE,1) Q:RADFN  ; Advance a day
"RTN","MAGDRPC4",77,0)
 . . . . ;
"RTN","MAGDRPC4",78,0)
 . . . . ; Finally just check the "C" or "AE" x-reference for the case number
"RTN","MAGDRPC4",79,0)
 . . . . ; based on RA*5*7 patch
"RTN","MAGDRPC4",80,0)
 . . . . S RADFN=$O(^RADPT($S($O(^RADPT("C","")):"C",1:"AE"),RCASE,""))
"RTN","MAGDRPC4",81,0)
 . . . . Q
"RTN","MAGDRPC4",82,0)
 . . . Q
"RTN","MAGDRPC4",83,0)
 . . S RADTI=$O(^RADPT(RAIX,NUMBER,RADFN,"")) Q:'RADTI
"RTN","MAGDRPC4",84,0)
 . . S RACNI=$O(^RADPT(RAIX,NUMBER,RADFN,RADTI,"")) Q:'RACNI
"RTN","MAGDRPC4",85,0)
 . . Q:'$D(^RADPT(RADFN,0))  ; No patient demographics file pointer
"RTN","MAGDRPC4",86,0)
 . . S DFN=$P(^RADPT(RADFN,0),"^",1)
"RTN","MAGDRPC4",87,0)
 . . Q
"RTN","MAGDRPC4",88,0)
 . Q:'$G(DFN)
"RTN","MAGDRPC4",89,0)
 . Q:'$D(^RADPT(DFN,"DT",RADTI,0))
"RTN","MAGDRPC4",90,0)
 . S RARPT=$P($G(^RADPT(DFN,"DT",RADTI,"P",RACNI,0)),"^",17) Q:'RARPT
"RTN","MAGDRPC4",91,0)
 . S ACCNUM=$P($G(^RARPT(RARPT,0)),"^",1)
"RTN","MAGDRPC4",92,0)
 . S I=0 F  S I=$O(^RARPT(RARPT,2005,I)) Q:'I  D
"RTN","MAGDRPC4",93,0)
 . . S X="74^"_RARPT_"^"_$P($G(^RARPT(RARPT,2005,I,0)),"^",1)_"^"_ACCNUM
"RTN","MAGDRPC4",94,0)
 . . S NOUT=NOUT+1,OUT(NOUT)=X
"RTN","MAGDRPC4",95,0)
 . . Q
"RTN","MAGDRPC4",96,0)
 . Q
"RTN","MAGDRPC4",97,0)
 ;
"RTN","MAGDRPC4",98,0)
 K DFN
"RTN","MAGDRPC4",99,0)
 D  ; Now look for any consults that might qualify
"RTN","MAGDRPC4",100,0)
 . N ACCNUM,MAGIEN,MAGPTR,REPORTF,REPORTI,TIUIEN,TIUPTR,TIUXIEN
"RTN","MAGDRPC4",101,0)
 . I EXAMTYP'="",EXAMTYP'="C" Q
"RTN","MAGDRPC4",102,0)
 . S ACCNUM="GMRC-"_$S(NUMBER?1"GMRC-"1.N:$P(NUMBER,"GMRC-",2),1:NUMBER)
"RTN","MAGDRPC4",103,0)
 . S GMRCIEN=$P(ACCNUM,"-",2)
"RTN","MAGDRPC4",104,0)
 . D
"RTN","MAGDRPC4",105,0)
 . . N D0,Z
"RTN","MAGDRPC4",106,0)
 . . S D0=$P(ACCNUM,"-",2)
"RTN","MAGDRPC4",107,0)
 . . S DFN=$$GET1^DIQ(123,D0,.02,"I") Q:'DFN
"RTN","MAGDRPC4",108,0)
 . . S EXAMSTS=$$GET1^DIQ(123,D0,8) ; check for cancelled exam
"RTN","MAGDRPC4",109,0)
 . . I EXAMSTS="CANCELLED" S OUT(1)="-4,Consult is cancelled" Q
"RTN","MAGDRPC4",110,0)
 . . S PROCDESC=$$GET1^DIQ(123,D0,1)
"RTN","MAGDRPC4",111,0)
 . . S Z=$$GET1^DIQ(123,D0,13,"I") ; request type
"RTN","MAGDRPC4",112,0)
 . . Q
"RTN","MAGDRPC4",113,0)
 . I '$G(DFN) S OUT(1)="-5,Consult/procedure not on file" Q
"RTN","MAGDRPC4",114,0)
 . ; Find the images - they can be linked to TIU or imaging file 2006.5839
"RTN","MAGDRPC4",115,0)
 . S MAGPTR=$O(^MAG(2006.5839,"C",123,GMRCIEN,0))
"RTN","MAGDRPC4",116,0)
 . I MAGPTR D  Q  ; Found it in ^MAG(2006.5839 - not in ^TIU yet
"RTN","MAGDRPC4",117,0)
 . . S X=^MAG(2006.5839,MAGPTR,0)
"RTN","MAGDRPC4",118,0)
 . . S X=$P(X,"^",1)_"^"_$P(X,"^",2)_"^"_$P(X,"^",3)_"^"_ACCNUM
"RTN","MAGDRPC4",119,0)
 . . S NOUT=NOUT+1,OUT(NOUT)=X
"RTN","MAGDRPC4",120,0)
 . . Q
"RTN","MAGDRPC4",121,0)
 . D  ; Otherwise find images in ^TIU
"RTN","MAGDRPC4",122,0)
 . . N I,X
"RTN","MAGDRPC4",123,0)
 . . D TIUALL^MAGDGMRC(GMRCIEN,.RESULT)
"RTN","MAGDRPC4",124,0)
 . . S I="" F  S I=$O(RESULT(I)) Q:I=""  D
"RTN","MAGDRPC4",125,0)
 . . . S X="8925^"_$P(RESULT(I),"^",1)_"^"_$P(RESULT(I),"^",3)_"^"_$P(RESULT(I),"^",2)
"RTN","MAGDRPC4",126,0)
 . . . S NOUT=NOUT+1,OUT(NOUT)=X
"RTN","MAGDRPC4",127,0)
 . . . Q
"RTN","MAGDRPC4",128,0)
 . . Q
"RTN","MAGDRPC4",129,0)
 . Q
"RTN","MAGDRPC4",130,0)
 S OUT(1)=NOUT-1
"RTN","MAGDRPC4",131,0)
 Q
"RTN","MAGDRPC4",132,0)
 ;
"RTN","MAGDRPC4",133,0)
NEXTIMG(OUT,FROMS,SENT,CHECK) ; RPC = MAG DICOM GET NEXT QUEUE ENTRY
"RTN","MAGDRPC4",134,0)
 ; Get next file to be DICOM transmitted
"RTN","MAGDRPC4",135,0)
 N H,F1,F2,F3,FROM,I,JBTOHD,LOC,N,PRI,S0,S1,STS,TYPE,X
"RTN","MAGDRPC4",136,0)
 S X=$G(FROMS) S:X FROM(X)=1
"RTN","MAGDRPC4",137,0)
 S I="" F  S I=$O(FROMS(I)) Q:I=""  S X=$G(FROMS(I)) S:X FROM(X)=1
"RTN","MAGDRPC4",138,0)
 I '$O(FROM("")) S OUT(1)="-1,No Origin Specified" Q
"RTN","MAGDRPC4",139,0)
 ; First clean up transmitted queue entries
"RTN","MAGDRPC4",140,0)
 S I="" F  S I=$O(SENT(I)) Q:I=""  D CLEAN^MAGDRPC9
"RTN","MAGDRPC4",141,0)
 S H=$$SECOND($H)
"RTN","MAGDRPC4",142,0)
 L +^MAGDOUTP(2006.574,"STS"):1E9 ; Background process MUST wait
"RTN","MAGDRPC4",143,0)
 I '$G(CHECK) D  ; do only when called from a transmission process
"RTN","MAGDRPC4",144,0)
 . S FROM="" F  S FROM=$O(FROM(FROM)) Q:FROM=""  D
"RTN","MAGDRPC4",145,0)
 . . S PRI="" F  S PRI=$O(^MAGDOUTP(2006.574,"STS",FROM,PRI)) Q:PRI=""  D
"RTN","MAGDRPC4",146,0)
 . . . S S0="" F  S S0=$O(^MAGDOUTP(2006.574,"STS",FROM,PRI,"XMIT",S0)) Q:S0=""  D
"RTN","MAGDRPC4",147,0)
 . . . . S S1="" F  S S1=$O(^MAGDOUTP(2006.574,"STS",FROM,PRI,"XMIT",S0,S1)) Q:S1=""  D
"RTN","MAGDRPC4",148,0)
 . . . . . S X=$$SECOND($P($G(^MAGDOUTP(2006.574,S0,1,S1,0),"^^"_$H),"^",3))
"RTN","MAGDRPC4",149,0)
 . . . . . Q:H-X<300
"RTN","MAGDRPC4",150,0)
 . . . . . S $P(^MAGDOUTP(2006.574,S0,1,S1,0),"^",2)="WAITING"
"RTN","MAGDRPC4",151,0)
 . . . . . K ^MAGDOUTP(2006.574,"STS",FROM,PRI,"XMIT",S0,S1)
"RTN","MAGDRPC4",152,0)
 . . . . . S ^MAGDOUTP(2006.574,"STS",FROM,PRI,"WAITING",S0,S1)=""
"RTN","MAGDRPC4",153,0)
 . . . . . Q
"RTN","MAGDRPC4",154,0)
 . . . . Q
"RTN","MAGDRPC4",155,0)
 . . . Q
"RTN","MAGDRPC4",156,0)
 . . Q
"RTN","MAGDRPC4",157,0)
 . Q
"RTN","MAGDRPC4",158,0)
 ; Find the highest priority among the selected FROM locations
"RTN","MAGDRPC4",159,0)
 S FROM="" F  S FROM=$O(FROM(FROM)) Q:FROM=""  D
"RTN","MAGDRPC4",160,0)
 . S PRI="" F  S PRI=$O(^MAGDOUTP(2006.574,"STS",FROM,PRI)) Q:PRI=""  D
"RTN","MAGDRPC4",161,0)
 . . S X=$O(^MAGDOUTP(2006.574,"STS",FROM,PRI,"WAITING","")) S:X PRI(PRI,FROM)=""
"RTN","MAGDRPC4",162,0)
 . . Q
"RTN","MAGDRPC4",163,0)
 . Q
"RTN","MAGDRPC4",164,0)
 S OUT(1)="",PRI=$O(PRI(""),-1) D:PRI'=""
"RTN","MAGDRPC4",165,0)
 . S FROM=$O(PRI(PRI,""))
"RTN","MAGDRPC4",166,0)
 . S S0="" F  S S0=$O(^MAGDOUTP(2006.574,"STS",FROM,PRI,"WAITING",S0)) Q:S0=""  D  Q:OUT(1)'=""
"RTN","MAGDRPC4",167,0)
 . . S S1="" F  S S1=$O(^MAGDOUTP(2006.574,"STS",FROM,PRI,"WAITING",S0,S1)) Q:S1=""  D  Q:OUT(1)'=""
"RTN","MAGDRPC4",168,0)
 . . . I '$G(CHECK) D  ; do only when called from a transmission process
"RTN","MAGDRPC4",169,0)
 . . . . S $P(^MAGDOUTP(2006.574,S0,1,S1,0),"^",2,3)="XMIT^"_$H
"RTN","MAGDRPC4",170,0)
 . . . . K ^MAGDOUTP(2006.574,"STS",FROM,PRI,"WAITING",S0,S1)
"RTN","MAGDRPC4",171,0)
 . . . . S ^MAGDOUTP(2006.574,"STS",FROM,PRI,"XMIT",S0,S1)=""
"RTN","MAGDRPC4",172,0)
 . . . . Q
"RTN","MAGDRPC4",173,0)
 . . . S OUT(1)=1
"RTN","MAGDRPC4",174,0)
 . . . S OUT(2)=S0
"RTN","MAGDRPC4",175,0)
 . . . S OUT(3)=S1
"RTN","MAGDRPC4",176,0)
 . . . S X=$G(^MAGDOUTP(2006.574,S0,0))
"RTN","MAGDRPC4",177,0)
 . . . S OUT(4)=$P(X,"^",1) ; Application
"RTN","MAGDRPC4",178,0)
 . . . S OUT(5)=$P(X,"^",2) ; Group
"RTN","MAGDRPC4",179,0)
 . . . S OUT(6)=$P(X,"^",3) ; Accession Number
"RTN","MAGDRPC4",180,0)
 . . . S JBTOHD=+$P(X,"^",6)
"RTN","MAGDRPC4",181,0)
 . . . S OUT(7)=+$G(^MAGDOUTP(2006.574,S0,1,S1,0)) ; Image
"RTN","MAGDRPC4",182,0)
 . . . S OUT(8)=$P($G(^MAG(2005,+OUT(7),0)),"^",6)
"RTN","MAGDRPC4",183,0)
 . . . S TYPE=$S($G(^MAG(2005,+OUT(7),"FBIG"))'="":"BIG",1:"FULL")
"RTN","MAGDRPC4",184,0)
 . . . ; 3rd parameter set to 1 to allow retrieval from jukebox
"RTN","MAGDRPC4",185,0)
 . . . D FILEFIND^MAGDFB(+OUT(7),TYPE,1,0,.F1,.F2)
"RTN","MAGDRPC4",186,0)
 . . . S OUT(9)=F1
"RTN","MAGDRPC4",187,0)
 . . . S OUT(10)=F2
"RTN","MAGDRPC4",188,0)
 . . . S OUT(11)=$P($G(^MAG(2005,+OUT(5),0)),"^",7) ; get DFN
"RTN","MAGDRPC4",189,0)
 . . . ; get path for *.TXT, always the same as the FULL file
"RTN","MAGDRPC4",190,0)
 . . . D FILEFIND^MAGDFB(+OUT(7),"FULL",JBTOHD,0,.F1,.F3)
"RTN","MAGDRPC4",191,0)
 . . . S OUT(12)=F3
"RTN","MAGDRPC4",192,0)
 . . . Q
"RTN","MAGDRPC4",193,0)
 . . Q
"RTN","MAGDRPC4",194,0)
 . Q
"RTN","MAGDRPC4",195,0)
 S:OUT(1)="" OUT(1)="-2,Nothing to be transmitted."
"RTN","MAGDRPC4",196,0)
 L -^MAGDOUTP(2006.574,"STS")
"RTN","MAGDRPC4",197,0)
 Q
"RTN","MAGDRPC4",198,0)
 ;
"RTN","MAGDRPC4",199,0)
FIND(DATE,CASE,NUM) ;
"RTN","MAGDRPC4",200,0)
 ; Use the ADC x-reference in the radiology patient file
"RTN","MAGDRPC4",201,0)
 N NDATE
"RTN","MAGDRPC4",202,0)
 S NDATE=$$FMADD^XLFDT(DATE,NUM) Q:NDATE<1 0
"RTN","MAGDRPC4",203,0)
 Q $O(^RADPT("ADC",$$MMDDYY(NDATE)_"-"_CASE,""))
"RTN","MAGDRPC4",204,0)
 ;
"RTN","MAGDRPC4",205,0)
MMDDYY(DAY) ; Convert Fileman date to mmddyy
"RTN","MAGDRPC4",206,0)
 I DAY'?7N Q 0
"RTN","MAGDRPC4",207,0)
 Q $E(DAY,4,7)_$E(DAY,2,3)
"RTN","MAGDRPC4",208,0)
 ;
"RTN","MAGDRPC4",209,0)
INIT(OUT,LOCATION) ; RPC = MAG DICOM QUEUE INIT
"RTN","MAGDRPC4",210,0)
 N D0,N,PRI,STS,STUID
"RTN","MAGDRPC4",211,0)
 I '$G(LOCATION) S OUT="-3,No origin specified." Q
"RTN","MAGDRPC4",212,0)
 I '$D(^MAGDOUTP(2006.574,0)) S OUT="-1,No entries at all in queue." Q
"RTN","MAGDRPC4",213,0)
 ;
"RTN","MAGDRPC4",214,0)
 S N=0
"RTN","MAGDRPC4",215,0)
 S PRI="" F  S PRI=$O(^MAGDOUTP(2006.574,"STS",LOCATION,PRI)) Q:PRI=""  D
"RTN","MAGDRPC4",216,0)
 . S STS="" F  S STS=$O(^MAGDOUTP(2006.574,"STS",LOCATION,PRI,STS)) Q:STS=""  D
"RTN","MAGDRPC4",217,0)
 . . S D0="" F  S D0=$O(^MAGDOUTP(2006.574,"STS",LOCATION,PRI,STS,D0)) Q:D0=""  D
"RTN","MAGDRPC4",218,0)
 . . . S STUID=$G(^MAGDOUTP(2006.574,D0,2))
"RTN","MAGDRPC4",219,0)
 . . . K ^MAGDOUTP(2006.574,D0)
"RTN","MAGDRPC4",220,0)
 . . . K:STUID'="" ^MAGDOUTP(2006.574,"STUDY",STUID,D0)
"RTN","MAGDRPC4",221,0)
 . . . K ^MAGDOUTP(2006.574,"STS",LOCATION,PRI,STS,D0)
"RTN","MAGDRPC4",222,0)
 . . . S N=N+1
"RTN","MAGDRPC4",223,0)
 . . . Q
"RTN","MAGDRPC4",224,0)
 . . Q
"RTN","MAGDRPC4",225,0)
 . Q
"RTN","MAGDRPC4",226,0)
 ;
"RTN","MAGDRPC4",227,0)
 I 'N S OUT="-2,No entries present for "_$$GET1^DIQ(4,LOCATION,.01)_"." Q
"RTN","MAGDRPC4",228,0)
 ;
"RTN","MAGDRPC4",229,0)
 S $P(^MAGDOUTP(2006.574,0),"^",4)=$P(^MAGDOUTP(2006.574,0),"^",4)-N
"RTN","MAGDRPC4",230,0)
 S OUT=N_" entr"_$S(N=1:"y",1:"ies")_" removed from Image Transmission Queue."
"RTN","MAGDRPC4",231,0)
 Q
"RTN","MAGDRPC4",232,0)
 ;
"RTN","MAGDRPC4",233,0)
SECOND(H) Q H*86400+$P(H,",",2)
"RTN","MAGDRPC4",234,0)
 ;
"RTN","MAGDRPC5")
0^41^B81877416
"RTN","MAGDRPC5",1,0)
MAGDRPC5 ;WOIFO/EdM - Routing RPCs ; 06/08/2007 10:12
"RTN","MAGDRPC5",2,0)
 ;;3.0;IMAGING;**11,30,51,85,54**;03-July-2009;;Build 1424
"RTN","MAGDRPC5",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDRPC5",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC5",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRPC5",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRPC5",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRPC5",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRPC5",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRPC5",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRPC5",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRPC5",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRPC5",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRPC5",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRPC5",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRPC5",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC5",17,0)
 ;;
"RTN","MAGDRPC5",18,0)
 Q
"RTN","MAGDRPC5",19,0)
 ;
"RTN","MAGDRPC5",20,0)
START(OUT,LOCATION,RULES) ; RPC = MAG DICOM ROUTE EVAL START
"RTN","MAGDRPC5",21,0)
 N I,LOC,X,ZTDESC,ZTDTH,ZTRTN,ZTSAVE
"RTN","MAGDRPC5",22,0)
 ;
"RTN","MAGDRPC5",23,0)
 D XTINIT
"RTN","MAGDRPC5",24,0)
 ;
"RTN","MAGDRPC5",25,0)
 I '$G(LOCATION) S OUT="-1,No Location Specified" Q
"RTN","MAGDRPC5",26,0)
 I '$O(RULES("")) S OUT="-2,No Routing Rules Specified" Q
"RTN","MAGDRPC5",27,0)
 ;
"RTN","MAGDRPC5",28,0)
 S LOC=$$GET1^DIQ(4,LOCATION,.01)
"RTN","MAGDRPC5",29,0)
 L +^MAGDICOM(2006.563,1,"EVAL",LOCATION):0 E  D  Q
"RTN","MAGDRPC5",30,0)
 . S OUT="-3,A Rule Evaluator is Already Running for "_LOC
"RTN","MAGDRPC5",31,0)
 . Q
"RTN","MAGDRPC5",32,0)
 ;
"RTN","MAGDRPC5",33,0)
 S ^MAGDICOM(2006.563,1,"EVAL")=1
"RTN","MAGDRPC5",34,0)
 S ZTRTN="EVAL^MAGBRTE4"
"RTN","MAGDRPC5",35,0)
 S ZTDESC="Evaluate Routing Rules for Origin="_LOC
"RTN","MAGDRPC5",36,0)
 S ZTDTH=$H
"RTN","MAGDRPC5",37,0)
 S ZTSAVE("LOCATION")=LOCATION
"RTN","MAGDRPC5",38,0)
 S I="" F  S I=$O(RULES(I)) Q:I=""  S:+I=I ZTSAVE("RULES("_I_")")=RULES(I)
"RTN","MAGDRPC5",39,0)
 D ^%ZTLOAD,HOME^%ZIS
"RTN","MAGDRPC5",40,0)
 L -^MAGDICOM(2006.563,1,"EVAL",LOCATION)
"RTN","MAGDRPC5",41,0)
 I '$D(ZTSK) S OUT="-4,TaskMan did not Accept Request" Q
"RTN","MAGDRPC5",42,0)
 S OUT="0,TaskMan task#="_ZTSK
"RTN","MAGDRPC5",43,0)
 Q
"RTN","MAGDRPC5",44,0)
 ;
"RTN","MAGDRPC5",45,0)
STOP(OUT) ; RPC = MAG DICOM ROUTE EVAL STOP
"RTN","MAGDRPC5",46,0)
 S ^MAGDICOM(2006.563,1,"EVAL")=0,OUT=1
"RTN","MAGDRPC5",47,0)
 Q
"RTN","MAGDRPC5",48,0)
 ;
"RTN","MAGDRPC5",49,0)
XMIT(OUT,LOCATION,DEST,PRIOR,MECH,DESTS) ; RPC = MAG DICOM ROUTE NEXT FILE
"RTN","MAGDRPC5",50,0)
 N D0,DIR,DL,IM,M,NOW,OK,PLACE,TP,VP,X
"RTN","MAGDRPC5",51,0)
 ;
"RTN","MAGDRPC5",52,0)
 S PLACE=$$PLACE^MAGDRPC2(LOCATION)
"RTN","MAGDRPC5",53,0)
 S $P(^MAG(2006.1,PLACE,"LASTROUTE"),"^",1)=DT
"RTN","MAGDRPC5",54,0)
 ;
"RTN","MAGDRPC5",55,0)
 K OUT S OUT(1)=0,OK=0
"RTN","MAGDRPC5",56,0)
 S:'$G(MECH) MECH=1 I MECH'=1,MECH'=2 S MECH=1
"RTN","MAGDRPC5",57,0)
 I '$G(LOCATION) S OUT(1)="-1,No Location Specified" Q
"RTN","MAGDRPC5",58,0)
 S VP(1)=";MAG(2005.2,"
"RTN","MAGDRPC5",59,0)
 S VP(2)=";MAG(2006.587,"
"RTN","MAGDRPC5",60,0)
 S:$G(DEST) DEST=+DEST_VP(MECH)
"RTN","MAGDRPC5",61,0)
 S M="" F  S M=$O(DESTS(M)) Q:M=""  D
"RTN","MAGDRPC5",62,0)
 . S X=DESTS(M) Q:X'["^"  Q:$P(X,"^",1)'=MECH  Q:'$P(X,"^",2)
"RTN","MAGDRPC5",63,0)
 . S DL($P(X,"^",2)_VP(MECH))=""
"RTN","MAGDRPC5",64,0)
 . Q
"RTN","MAGDRPC5",65,0)
 I $O(DL(""))="" S OUT(1)="-2,No Valid Destinations Specified" Q
"RTN","MAGDRPC5",66,0)
 S:'$G(DEST) (PRIOR,DEST)=""
"RTN","MAGDRPC5",67,0)
 I $G(PRIOR) D
"RTN","MAGDRPC5",68,0)
 . I DEST S X=0 F  D  Q:X
"RTN","MAGDRPC5",69,0)
 . . N NXT
"RTN","MAGDRPC5",70,0)
 . . I $P($G(^MAG(2005.2,+DEST,0)),"^",6) S X=1 Q
"RTN","MAGDRPC5",71,0)
 . . S NOW=$$NOW^XLFDT()*1E6
"RTN","MAGDRPC5",72,0)
 . . S X=$P($G(^MAG(2005.2,+DEST,3)),"^",6)*1E6
"RTN","MAGDRPC5",73,0)
 . . I NOW-X>1500 D ONOFLINE(.X,+DEST,1) Q
"RTN","MAGDRPC5",74,0)
 . . S X=0,NXT=0
"RTN","MAGDRPC5",75,0)
 . . F  S DEST=$O(^MAGQUEUE(2006.035,"STS",LOCATION,"WAITING",PRIOR,DEST)) Q:DEST=""  D  Q:NXT
"RTN","MAGDRPC5",76,0)
 . . . S:$D(DL(DEST)) NXT=1
"RTN","MAGDRPC5",77,0)
 . . . Q
"RTN","MAGDRPC5",78,0)
 . . S:'DEST X=1
"RTN","MAGDRPC5",79,0)
 . . Q
"RTN","MAGDRPC5",80,0)
 . I 'DEST S (PRIOR,DEST)="" Q
"RTN","MAGDRPC5",81,0)
 . F  D  Q:OK
"RTN","MAGDRPC5",82,0)
 . . S D0=+$G(D0)
"RTN","MAGDRPC5",83,0)
 . . S D0=$O(^MAGQUEUE(2006.035,"STS",LOCATION,"WAITING",PRIOR,DEST,D0))
"RTN","MAGDRPC5",84,0)
 . . I 'D0 S OK=1 Q
"RTN","MAGDRPC5",85,0)
 . . S M=$P($G(^MAGQUEUE(2006.035,D0,0)),"^",4) I M'=1,M'=2 S M=1
"RTN","MAGDRPC5",86,0)
 . . I M=MECH S OK=1 Q
"RTN","MAGDRPC5",87,0)
 . . S (PRIOR,DEST)=""
"RTN","MAGDRPC5",88,0)
 . . Q
"RTN","MAGDRPC5",89,0)
 . Q
"RTN","MAGDRPC5",90,0)
 I OK D:$O(^MAGQUEUE(2006.035,"STS",LOCATION,"WAITING",PRIOR))
"RTN","MAGDRPC5",91,0)
 . ;
"RTN","MAGDRPC5",92,0)
 . ; Ignore higher priority items for destinations that are not accessible
"RTN","MAGDRPC5",93,0)
 . ;
"RTN","MAGDRPC5",94,0)
 . N A,D,P,T,X
"RTN","MAGDRPC5",95,0)
 . S P=PRIOR F  S P=$O(^MAGQUEUE(2006.035,"STS",LOCATION,"WAITING",P)) Q:'P  D  Q:'PRIOR
"RTN","MAGDRPC5",96,0)
 . . S D="" F  S D=$O(^MAGQUEUE(2006.035,"STS",LOCATION,"WAITING",P,D)) Q:D=""  D  Q:'PRIOR
"RTN","MAGDRPC5",97,0)
 . . . ; Interrupt only if we're transmitting there
"RTN","MAGDRPC5",98,0)
 . . . Q:'$D(DL(D))
"RTN","MAGDRPC5",99,0)
 . . . ;
"RTN","MAGDRPC5",100,0)
 . . . D:'$P(^MAG(2005.2,+D,0),"^",6)
"RTN","MAGDRPC5",101,0)
 . . . . S NOW=$$NOW^XLFDT()*1E6
"RTN","MAGDRPC5",102,0)
 . . . . S X=$P($G(^MAG(2005.2,+D,3)),"^",6)*1E6 Q:NOW-X<1500
"RTN","MAGDRPC5",103,0)
 . . . . D ONOFLINE(.X,+D,1)
"RTN","MAGDRPC5",104,0)
 . . . . Q
"RTN","MAGDRPC5",105,0)
 . . . S:$P(^MAG(2005.2,+D,0),"^",6) PRIOR=0
"RTN","MAGDRPC5",106,0)
 . . . Q
"RTN","MAGDRPC5",107,0)
 . . Q
"RTN","MAGDRPC5",108,0)
 . Q
"RTN","MAGDRPC5",109,0)
 I '$G(PRIOR) F  D  Q:OK  Q:'PRIOR
"RTN","MAGDRPC5",110,0)
 . S PRIOR=" " F  S PRIOR=$O(^MAGQUEUE(2006.035,"STS",LOCATION,"WAITING",PRIOR),-1) Q:'PRIOR  D  Q:OK
"RTN","MAGDRPC5",111,0)
 . . S DEST="" F  S DEST=$O(^MAGQUEUE(2006.035,"STS",LOCATION,"WAITING",PRIOR,DEST)) Q:DEST=""  D:$D(DL(DEST))  Q:OK
"RTN","MAGDRPC5",112,0)
 . . . D:'$P(^MAG(2005.2,+DEST,0),"^",6)
"RTN","MAGDRPC5",113,0)
 . . . . S NOW=$$NOW^XLFDT()*1E6
"RTN","MAGDRPC5",114,0)
 . . . . S X=$P($G(^MAG(2005.2,+DEST,3)),"^",6)*1E6 Q:NOW-X<1500
"RTN","MAGDRPC5",115,0)
 . . . . D ONOFLINE(.X,+DEST,1)
"RTN","MAGDRPC5",116,0)
 . . . . Q
"RTN","MAGDRPC5",117,0)
 . . . Q:'$P(^MAG(2005.2,+DEST,0),"^",6)
"RTN","MAGDRPC5",118,0)
 . . . S D0="" F  S D0=$O(^MAGQUEUE(2006.035,"STS",LOCATION,"WAITING",PRIOR,DEST,D0)) Q:D0=""  D  Q:OK
"RTN","MAGDRPC5",119,0)
 . . . . S M=$P($G(^MAGQUEUE(2006.035,D0,0)),"^",4) I M'=1,M'=2 S M=1
"RTN","MAGDRPC5",120,0)
 . . . . I M=MECH S OK=1 Q
"RTN","MAGDRPC5",121,0)
 . . . . Q
"RTN","MAGDRPC5",122,0)
 . . . Q
"RTN","MAGDRPC5",123,0)
 . . Q
"RTN","MAGDRPC5",124,0)
 . Q
"RTN","MAGDRPC5",125,0)
 Q:'PRIOR
"RTN","MAGDRPC5",126,0)
 Q:'OK
"RTN","MAGDRPC5",127,0)
 I 'D0 S OUT(1)=0 Q  ; All files transmitted
"RTN","MAGDRPC5",128,0)
 ;
"RTN","MAGDRPC5",129,0)
 S X=^MAGQUEUE(2006.035,D0,0),IM=$P(X,"^",1),TP=$P(X,"^",3)
"RTN","MAGDRPC5",130,0)
 I 'IM D STATUS(X,D0,"SENT",LOCATION) S OUT(1)=2 Q
"RTN","MAGDRPC5",131,0)
 S OUT(2)=+DEST,OUT(3)=PRIOR,OUT(4)=MECH,OUT(9)=D0
"RTN","MAGDRPC5",132,0)
 S X=$G(^MAG(2005.2,+DEST,2)),OUT(5)=$P(X,"^",1),OUT(6)=$P(X,"^",2)
"RTN","MAGDRPC5",133,0)
 D STATUS(X,D0,"SENDING",LOCATION)
"RTN","MAGDRPC5",134,0)
 S OUT(10)=$P(^MAG(2005.2,+DEST,0),"^",2)
"RTN","MAGDRPC5",135,0)
 S DIR=$P($G(^MAG(2005.2,+DEST,4)),"^",2)
"RTN","MAGDRPC5",136,0)
 S OUT(11)=$G(^MAG(2005.2,+DEST,3))
"RTN","MAGDRPC5",137,0)
 S OUT(12)=IM
"RTN","MAGDRPC5",138,0)
 S OUT(13)=$P($G(^MAGQUEUE(2006.035,D0,1)),"^",3)
"RTN","MAGDRPC5",139,0)
 S OUT(14)=$P($G(^MAG(2005.2,+DEST,1)),"^",7) S:OUT(14)="" OUT(14)="NONE"
"RTN","MAGDRPC5",140,0)
 D XMIT^MAGDRPC6 ; Routine grew over 10,000 characters
"RTN","MAGDRPC5",141,0)
 I MECH=2 S OUT(2)=OUT(2)_"^"_$P($G(^MAG(2006.587,+DEST,0)),"^",1)
"RTN","MAGDRPC5",142,0)
 Q
"RTN","MAGDRPC5",143,0)
 ;
"RTN","MAGDRPC5",144,0)
PURGE(OUT,LOCATION,DEST,MAX,DONE) ; RPC = MAG DICOM ROUTE GET PURGE
"RTN","MAGDRPC5",145,0)
 N D0,D1,FILE,FMFILE,I,LIMIT,MORE,NOW,RETAIN,STAMP,STATUS,X
"RTN","MAGDRPC5",146,0)
 ;
"RTN","MAGDRPC5",147,0)
 S NOW=$$NOW^XLFDT()
"RTN","MAGDRPC5",148,0)
 K OUT S OUT(1)=1
"RTN","MAGDRPC5",149,0)
 S:$D(^MAG(2005.2,DEST,0)) $P(^MAG(2005.2,DEST,3),"^",4)=DT
"RTN","MAGDRPC5",150,0)
 S X=^MAG(2005.2,DEST,3)
"RTN","MAGDRPC5",151,0)
 S RETAIN=$P(X,"^",1) S:RETAIN="" RETAIN=32 S:RETAIN<0 RETAIN=0
"RTN","MAGDRPC5",152,0)
 S LIMIT=$H-RETAIN
"RTN","MAGDRPC5",153,0)
 ;
"RTN","MAGDRPC5",154,0)
 S X=$G(DONE(1)),MORE="" S:$E(X,1)="^" MORE=$P(X,"^",4,6)
"RTN","MAGDRPC5",155,0)
 ;
"RTN","MAGDRPC5",156,0)
 S I="" F  S I=$O(DONE(I)) Q:I=""  D
"RTN","MAGDRPC5",157,0)
 . N D41,D61
"RTN","MAGDRPC5",158,0)
 . S X=$G(DONE(I))
"RTN","MAGDRPC5",159,0)
 . S D0=$P(X,"^",2),D41=$P(X,"^",3)
"RTN","MAGDRPC5",160,0)
 . S STAMP=$P(X,"^",4)
"RTN","MAGDRPC5",161,0)
 . Q:'D0  Q:'D41
"RTN","MAGDRPC5",162,0)
 . ; Just in case the image is being deleted as this purge is taking place
"RTN","MAGDRPC5",163,0)
 . F FMFILE=2005,2005.1 D
"RTN","MAGDRPC5",164,0)
 . . K ^MAG(FMFILE,"ROUTE",DEST,STAMP,D0,D41)
"RTN","MAGDRPC5",165,0)
 . . S D61=$P($G(^MAG(FMFILE,D0,4,D41,0)),"^",7)
"RTN","MAGDRPC5",166,0)
 . . K ^MAG(FMFILE,D0,4,"LOC",DEST,D41)
"RTN","MAGDRPC5",167,0)
 . . K ^MAG(FMFILE,D0,4,D41,0)
"RTN","MAGDRPC5",168,0)
 . . S:D61 $P(^MAG(FMFILE,D0,6,D61,0),"^",5)=NOW
"RTN","MAGDRPC5",169,0)
 . . Q
"RTN","MAGDRPC5",170,0)
 . S MORE=""
"RTN","MAGDRPC5",171,0)
 . Q
"RTN","MAGDRPC5",172,0)
 ;
"RTN","MAGDRPC5",173,0)
 S LIMIT=$$HTFM^XLFDT(LIMIT,1)
"RTN","MAGDRPC5",174,0)
 ;
"RTN","MAGDRPC5",175,0)
 S MAX=$G(MAX) S:MAX<1 MAX=100
"RTN","MAGDRPC5",176,0)
 F FMFILE=2005,2005.1 D  Q:OUT(1)'<MAX
"RTN","MAGDRPC5",177,0)
 . S STAMP="" F  S STAMP=$O(^MAG(FMFILE,"ROUTE",DEST,STAMP)) Q:STAMP=""  Q:STAMP'<LIMIT  D  Q:OUT(1)'<MAX
"RTN","MAGDRPC5",178,0)
 . . S D0="" F  S D0=$O(^MAG(FMFILE,"ROUTE",DEST,STAMP,D0)) Q:D0=""  D  Q:OUT(1)'<MAX
"RTN","MAGDRPC5",179,0)
 . . . S D1="" F  S D1=$O(^MAG(FMFILE,"ROUTE",DEST,STAMP,D0,D1)) Q:D1=""  D  Q:OUT(1)'<MAX
"RTN","MAGDRPC5",180,0)
 . . . . I MORE'="",FMFILE_"^"_D0_"^"_D1'=MORE Q
"RTN","MAGDRPC5",181,0)
 . . . . S MORE=""
"RTN","MAGDRPC5",182,0)
 . . . . S FILE=$P($G(^MAG(FMFILE,D0,4,D1,0)),"^",4),STATUS=0
"RTN","MAGDRPC5",183,0)
 . . . . S:FILE="" FILE=$P($G(^MAG(2005.1,D0,4,D1,0)),"^",4)
"RTN","MAGDRPC5",184,0)
 . . . . I FILE="" D  Q
"RTN","MAGDRPC5",185,0)
 . . . . . K ^MAG(FMFILE,"ROUTE",DEST,STAMP,D0,D1)
"RTN","MAGDRPC5",186,0)
 . . . . . K ^MAG(FMFILE,D0,4,"LOC",DEST,D1)
"RTN","MAGDRPC5",187,0)
 . . . . . K ^MAG(FMFILE,D0,4,D1,0)
"RTN","MAGDRPC5",188,0)
 . . . . . Q
"RTN","MAGDRPC5",189,0)
 . . . . S OUT(1)=OUT(1)+1,OUT(OUT(1))=FMFILE_"^"_D0_"^"_D1_"^"_STAMP_"^"_FILE
"RTN","MAGDRPC5",190,0)
 . . . . Q
"RTN","MAGDRPC5",191,0)
 . . . Q
"RTN","MAGDRPC5",192,0)
 . . Q
"RTN","MAGDRPC5",193,0)
 . Q
"RTN","MAGDRPC5",194,0)
 Q
"RTN","MAGDRPC5",195,0)
 ;
"RTN","MAGDRPC5",196,0)
STATUS(OUT,D0,STATUS,LOCATION) ; RPC = MAG DICOM ROUTE STATUS
"RTN","MAGDRPC5",197,0)
 ; D0 ------- Internal Entry Number of Send Queue Entry
"RTN","MAGDRPC5",198,0)
 ; STATUS --- New Status
"RTN","MAGDRPC5",199,0)
 N DEST ;---- Internal Entry Number of destination
"RTN","MAGDRPC5",200,0)
 N IMAGE ;--- Internal Entry Number of image
"RTN","MAGDRPC5",201,0)
 N OLD ;----- Old Status Value
"RTN","MAGDRPC5",202,0)
 N ORIGIN ;-- Origin of image
"RTN","MAGDRPC5",203,0)
 N PRIOR ;--- Priority
"RTN","MAGDRPC5",204,0)
 N TYPE ;---- File Type (Big, Text, DICOM, etc)
"RTN","MAGDRPC5",205,0)
 N X0,X1 ;--- Queue data
"RTN","MAGDRPC5",206,0)
 ;
"RTN","MAGDRPC5",207,0)
 I '$G(D0) S OUT="-1,Invalid queue identifier: """_$G(D0)_"""." Q
"RTN","MAGDRPC5",208,0)
 ;
"RTN","MAGDRPC5",209,0)
 S X0=$G(^MAGQUEUE(2006.035,D0,0))
"RTN","MAGDRPC5",210,0)
 S X1=$G(^MAGQUEUE(2006.035,D0,1))
"RTN","MAGDRPC5",211,0)
 S OUT=0
"RTN","MAGDRPC5",212,0)
 ;
"RTN","MAGDRPC5",213,0)
 S DEST=$P(X0,"^",2) Q:DEST=""
"RTN","MAGDRPC5",214,0)
 S PRIOR=$P(X1,"^",2) Q:PRIOR=""
"RTN","MAGDRPC5",215,0)
 S ORIGIN=$P(X0,"^",5)
"RTN","MAGDRPC5",216,0)
 S:'ORIGIN ORIGIN=$G(LOCATION) Q:'ORIGIN
"RTN","MAGDRPC5",217,0)
 S OLD=$P(X1,"^",1),IMAGE=$P(X0,"^",1),TYPE=$P(X0,"^",3)
"RTN","MAGDRPC5",218,0)
 ;
"RTN","MAGDRPC5",219,0)
 K:OLD'="" ^MAGQUEUE(2006.035,"DEST",DEST,OLD,IMAGE,TYPE,D0)
"RTN","MAGDRPC5",220,0)
 K:OLD'="" ^MAGQUEUE(2006.035,"STS",ORIGIN,OLD,PRIOR,DEST,D0)
"RTN","MAGDRPC5",221,0)
 Q:STATUS=""
"RTN","MAGDRPC5",222,0)
 S $P(^MAGQUEUE(2006.035,D0,0),"^",5)=ORIGIN
"RTN","MAGDRPC5",223,0)
 S $P(^MAGQUEUE(2006.035,D0,1),"^",1)=STATUS
"RTN","MAGDRPC5",224,0)
 S ^MAGQUEUE(2006.035,"DEST",DEST,STATUS,IMAGE,TYPE,D0)=""
"RTN","MAGDRPC5",225,0)
 S ^MAGQUEUE(2006.035,"STS",ORIGIN,STATUS,PRIOR,DEST,D0)=""
"RTN","MAGDRPC5",226,0)
 S OUT=1
"RTN","MAGDRPC5",227,0)
 Q
"RTN","MAGDRPC5",228,0)
 ;
"RTN","MAGDRPC5",229,0)
LISTDEST(OUT,LOCATION) ; RPC = MAG DICOM ROUTE LIST DESTI
"RTN","MAGDRPC5",230,0)
 N D0,F,I,X
"RTN","MAGDRPC5",231,0)
 ; Return list of possible routing destinations
"RTN","MAGDRPC5",232,0)
 K OUT
"RTN","MAGDRPC5",233,0)
 S I=1,D0=0 F  S D0=$O(^MAG(2005.2,D0)) Q:'D0  D
"RTN","MAGDRPC5",234,0)
 . S X=$G(^MAG(2005.2,D0,0)) Q:'$P(X,"^",9)
"RTN","MAGDRPC5",235,0)
 . L +^MAGQUEUE("ROUTE",LOCATION,D0):0 S F='$T
"RTN","MAGDRPC5",236,0)
 . L:'F -^MAGQUEUE("ROUTE",LOCATION,D0)
"RTN","MAGDRPC5",237,0)
 . S I=I+1,OUT(I)=D0_"^"_F_"^"_$P(X,"^",1,2)
"RTN","MAGDRPC5",238,0)
 . Q
"RTN","MAGDRPC5",239,0)
 S OUT(1)=I-1
"RTN","MAGDRPC5",240,0)
 Q
"RTN","MAGDRPC5",241,0)
 ;
"RTN","MAGDRPC5",242,0)
LOCK(OUT,D0,LOCATION,PLUSMIN) ; RPC = MAG DICOM ROUTE LOCK TRANSMIT
"RTN","MAGDRPC5",243,0)
 S OUT=0
"RTN","MAGDRPC5",244,0)
 I $G(PLUSMIN) L +^MAGQUEUE("ROUTE",LOCATION,D0):0 S OUT=$T Q
"RTN","MAGDRPC5",245,0)
 L -^MAGQUEUE("ROUTE",LOCATION,D0) S OUT=2
"RTN","MAGDRPC5",246,0)
 Q
"RTN","MAGDRPC5",247,0)
 ;
"RTN","MAGDRPC5",248,0)
ONOFLINE(OUT,DEST,STATUS) ; RPC = MAG DICOM NETWORK STATUS
"RTN","MAGDRPC5",249,0)
 N NET
"RTN","MAGDRPC5",250,0)
 I '$G(DEST) S OUT="-1,No Network Location Specified" Q
"RTN","MAGDRPC5",251,0)
 S STATUS=''$G(STATUS)
"RTN","MAGDRPC5",252,0)
 S NET=$P($G(^MAG(2005.2,DEST,0)),"^",2)
"RTN","MAGDRPC5",253,0)
 K ^MAG(2005.2,"C",NET,0,DEST)
"RTN","MAGDRPC5",254,0)
 K ^MAG(2005.2,"C",NET,1,DEST)
"RTN","MAGDRPC5",255,0)
 S ^MAG(2005.2,"C",NET,STATUS,DEST)=""
"RTN","MAGDRPC5",256,0)
 S $P(^MAG(2005.2,DEST,0),"^",6)=STATUS
"RTN","MAGDRPC5",257,0)
 S $P(^MAG(2005.2,DEST,3),"^",6)=$S(STATUS:"",1:$$NOW^XLFDT())
"RTN","MAGDRPC5",258,0)
 S OUT=1
"RTN","MAGDRPC5",259,0)
 Q
"RTN","MAGDRPC5",260,0)
 ;
"RTN","MAGDRPC5",261,0)
XTINIT N NODE
"RTN","MAGDRPC5",262,0)
 D DT^DICRW
"RTN","MAGDRPC5",263,0)
 F NODE="MAGEVAL","MAGEVALSTUDY" D
"RTN","MAGDRPC5",264,0)
 . S X=$G(^XTMP(NODE,0))
"RTN","MAGDRPC5",265,0)
 . S $P(X,"^",2)=DT
"RTN","MAGDRPC5",266,0)
 . S $P(X,"^",3)="Routing Rule Evaluator Log - Can be purged at any time"
"RTN","MAGDRPC5",267,0)
 . S ^XTMP(NODE,0)=X
"RTN","MAGDRPC5",268,0)
 . Q
"RTN","MAGDRPC5",269,0)
 Q
"RTN","MAGDRPC5",270,0)
 ;
"RTN","MAGDRPC6")
0^42^B36205278
"RTN","MAGDRPC6",1,0)
MAGDRPC6 ;WOIFO/EdM - Routing RPCs ; 05/18/2007 11:23
"RTN","MAGDRPC6",2,0)
 ;;3.0;IMAGING;**11,30,51,54**;03-July-2009;;Build 1424
"RTN","MAGDRPC6",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDRPC6",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC6",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRPC6",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRPC6",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRPC6",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRPC6",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRPC6",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRPC6",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRPC6",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRPC6",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRPC6",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRPC6",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRPC6",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC6",17,0)
 ;;
"RTN","MAGDRPC6",18,0)
 Q
"RTN","MAGDRPC6",19,0)
 ;
"RTN","MAGDRPC6",20,0)
PURGDONE(OUT,DAYS,LOCATION) ; RPC = MAG DICOM ROUTE PURGE DONE
"RTN","MAGDRPC6",21,0)
 ; Purge Entries from Queue that have been sent successfully
"RTN","MAGDRPC6",22,0)
 N D0,DE,ID,IM,LIM,PR,RT,STS,TP,TX,X
"RTN","MAGDRPC6",23,0)
 I '$G(LOCATION) S OUT="-1,No Location Specified" Q
"RTN","MAGDRPC6",24,0)
 ;
"RTN","MAGDRPC6",25,0)
 S OUT=0
"RTN","MAGDRPC6",26,0)
 F STS="SENT","NOT FOUND" D
"RTN","MAGDRPC6",27,0)
 . S PR="" F  S PR=$O(^MAGQUEUE(2006.035,"STS",LOCATION,STS,PR)) Q:PR=""  D
"RTN","MAGDRPC6",28,0)
 . . S DE="" F  S DE=$O(^MAGQUEUE(2006.035,"STS",LOCATION,STS,PR,DE)) Q:DE=""  D
"RTN","MAGDRPC6",29,0)
 . . . S RT=$P($G(^MAG(2005.2,DE,3)),"^",1) S:'RT RT=31
"RTN","MAGDRPC6",30,0)
 . . . S:$G(DAYS)'<1 RT=DAYS
"RTN","MAGDRPC6",31,0)
 . . . S LIM=$H-RT
"RTN","MAGDRPC6",32,0)
 . . . S D0="" F  S D0=$O(^MAGQUEUE(2006.035,"STS",LOCATION,STS,PR,DE,D0)) Q:D0=""  D
"RTN","MAGDRPC6",33,0)
 . . . . Q:$$FMTH^XLFDT($P($G(^MAGQUEUE(2006.035,D0,1)),"^",4)\1)'<LIM
"RTN","MAGDRPC6",34,0)
 . . . . S X=$G(^MAGQUEUE(2006.035,D0,0)),IM=$P(X,"^",1),TP=$P(X,"^",3),ID=$P(X,"^",6)
"RTN","MAGDRPC6",35,0)
 . . . . K ^MAGQUEUE(2006.035,"STS",LOCATION,STS,PR,DE,D0)
"RTN","MAGDRPC6",36,0)
 . . . . K:ID'="" ^MAGQUEUE(2006.035,"ID",ID,D0)
"RTN","MAGDRPC6",37,0)
 . . . . I IM'="",TP'="" K ^MAGQUEUE(2006.035,"DEST",DE,STS,IM,TP,D0)
"RTN","MAGDRPC6",38,0)
 . . . . K ^MAGQUEUE(2006.035,D0)
"RTN","MAGDRPC6",39,0)
 . . . . S OUT=OUT+1
"RTN","MAGDRPC6",40,0)
 . . . . Q
"RTN","MAGDRPC6",41,0)
 . . . Q
"RTN","MAGDRPC6",42,0)
 . . Q
"RTN","MAGDRPC6",43,0)
 . S DE="" F  S DE=$O(^MAGQUEUE(2006.035,"DEST",DE)) Q:DE=""  D
"RTN","MAGDRPC6",44,0)
 . . S IM="" F  S IM=$O(^MAGQUEUE(2006.035,"DEST",DE,STS,IM)) Q:IM=""  D
"RTN","MAGDRPC6",45,0)
 . . . S TP="" F  S TP=$O(^MAGQUEUE(2006.035,"DEST",DE,STS,IM,TP)) Q:TP=""  D
"RTN","MAGDRPC6",46,0)
 . . . . S D0="" F  S D0=$O(^MAGQUEUE(2006.035,"DEST",DE,STS,IM,TP,D0)) Q:D0=""  D
"RTN","MAGDRPC6",47,0)
 . . . . . S PR=$P($G(^MAGQUEUE(2006.035,D0,1)),"^",2)
"RTN","MAGDRPC6",48,0)
 . . . . . S ID=$P($G(^MAGQUEUE(2006.035,D0,0)),"^",6)
"RTN","MAGDRPC6",49,0)
 . . . . . K ^MAGQUEUE(2006.035,D0)
"RTN","MAGDRPC6",50,0)
 . . . . . K:ID'="" ^MAGQUEUE(2006.035,"ID",ID,D0)
"RTN","MAGDRPC6",51,0)
 . . . . . K ^MAGQUEUE(2006.035,"DEST",DE,STS,IM,TP,D0)
"RTN","MAGDRPC6",52,0)
 . . . . . K:PR'="" ^MAGQUEUE(2006.035,"STS",LOCATION,STS,PR,DE,D0)
"RTN","MAGDRPC6",53,0)
 . . . . . S OUT=OUT+1
"RTN","MAGDRPC6",54,0)
 . . . . . Q
"RTN","MAGDRPC6",55,0)
 . . . . Q
"RTN","MAGDRPC6",56,0)
 . . . Q
"RTN","MAGDRPC6",57,0)
 . . Q
"RTN","MAGDRPC6",58,0)
 . Q
"RTN","MAGDRPC6",59,0)
 S D0=0 F  S D0=$O(^MAGQUEUE(2006.035,D0)) Q:'D0  D
"RTN","MAGDRPC6",60,0)
 . S X=$P($G(^MAGQUEUE(2006.035,D0,1)),"^",1) I X'="SENT",X'="NOT FOUND" Q
"RTN","MAGDRPC6",61,0)
 . S ID=$P($G(^MAGQUEUE(2006.035,D0,0)),"^",6)
"RTN","MAGDRPC6",62,0)
 . K ^MAGQUEUE(2006.035,D0)
"RTN","MAGDRPC6",63,0)
 . K:ID'="" ^MAGQUEUE(2006.035,"ID",ID,D0)
"RTN","MAGDRPC6",64,0)
 . S OUT=OUT+1
"RTN","MAGDRPC6",65,0)
 . Q
"RTN","MAGDRPC6",66,0)
 Q
"RTN","MAGDRPC6",67,0)
 ;
"RTN","MAGDRPC6",68,0)
REQUEUE(OUT,LOCATION) ; RPC = MAG DICOM ROUTE REQUEUE
"RTN","MAGDRPC6",69,0)
 ; ReQueue Files that Failed during transmission
"RTN","MAGDRPC6",70,0)
 N D0,DE,FL,IM,PR,TP,WW,X
"RTN","MAGDRPC6",71,0)
 I '$G(LOCATION) S OUT="-1,No Location Specified" Q
"RTN","MAGDRPC6",72,0)
 ;
"RTN","MAGDRPC6",73,0)
 S WW="WAITING",OUT=0
"RTN","MAGDRPC6",74,0)
 F FL="FAILED","SENDING" D
"RTN","MAGDRPC6",75,0)
 . S PR="" F  S PR=$O(^MAGQUEUE(2006.035,"STS",LOCATION,FL,PR)) Q:PR=""  D
"RTN","MAGDRPC6",76,0)
 . . S DE="" F  S DE=$O(^MAGQUEUE(2006.035,"STS",LOCATION,FL,PR,DE)) Q:DE=""  D
"RTN","MAGDRPC6",77,0)
 . . . S D0="" F  S D0=$O(^MAGQUEUE(2006.035,"STS",LOCATION,FL,PR,DE,D0)) Q:D0=""  D
"RTN","MAGDRPC6",78,0)
 . . . . K ^MAGQUEUE(2006.035,"STS",LOCATION,FL,PR,DE,D0)
"RTN","MAGDRPC6",79,0)
 . . . . I '$D(^MAGQUEUE(2006.035,D0,0)) K ^MAGQUEUE(2006.035,D0) Q
"RTN","MAGDRPC6",80,0)
 . . . . S $P(^MAGQUEUE(2006.035,D0,1),"^",1)=WW
"RTN","MAGDRPC6",81,0)
 . . . . S ^MAGQUEUE(2006.035,"STS",LOCATION,WW,PR,DE,D0)=""
"RTN","MAGDRPC6",82,0)
 . . . . S X=^MAGQUEUE(2006.035,D0,0),IM=$P(X,"^",1),TP=$P(X,"^",3)
"RTN","MAGDRPC6",83,0)
 . . . . I IM'="",TP'="" K ^MAGQUEUE(2006.035,"DEST",DE,FL,IM,TP,D0)
"RTN","MAGDRPC6",84,0)
 . . . . I IM'="",TP'="" S ^MAGQUEUE(2006.035,"DEST",DE,WW,IM,TP,D0)=""
"RTN","MAGDRPC6",85,0)
 . . . . S OUT=OUT+1
"RTN","MAGDRPC6",86,0)
 . . . . Q
"RTN","MAGDRPC6",87,0)
 . . . Q
"RTN","MAGDRPC6",88,0)
 . . Q
"RTN","MAGDRPC6",89,0)
 . Q
"RTN","MAGDRPC6",90,0)
 Q
"RTN","MAGDRPC6",91,0)
 ;
"RTN","MAGDRPC6",92,0)
REMOBSO(OUT,UPTO,LOCATION) ; RPC = MAG DICOM ROUTE REMOVE OBSO
"RTN","MAGDRPC6",93,0)
 ; Purge Unprocessed entries requested before a certain date
"RTN","MAGDRPC6",94,0)
 N D0,DE,ID,IM,N,PRI,RDT,ST,TY
"RTN","MAGDRPC6",95,0)
 I '$G(LOCATION) S OUT="-1,No Location Specified" Q
"RTN","MAGDRPC6",96,0)
 ;
"RTN","MAGDRPC6",97,0)
 S OUT=0
"RTN","MAGDRPC6",98,0)
 S PRI="" F  S PRI=$O(^MAGQUEUE(2006.035,"STS",LOCATION,"WAITING",PRI)) Q:PRI=""  D
"RTN","MAGDRPC6",99,0)
 . S DE="" F  S DE=$O(^MAGQUEUE(2006.035,"STS",LOCATION,"WAITING",PRI,DE)) Q:DE=""  D
"RTN","MAGDRPC6",100,0)
 . . S D0="" F  S D0=$O(^MAGQUEUE(2006.035,"STS",LOCATION,"WAITING",PRI,DE,D0)) Q:D0=""  D  Q:'D0
"RTN","MAGDRPC6",101,0)
 . . . S X=$G(^MAGQUEUE(2006.035,D0,0)),IM=$P(X,"^",1),TY=$P(X,"^",3),ID=$P(X,"^",6)
"RTN","MAGDRPC6",102,0)
 . . . S X=$G(^MAGQUEUE(2006.035,D0,1)),ST=$P(X,"^",1),RDT=$P(X,"^",3)
"RTN","MAGDRPC6",103,0)
 . . . I RDT'<UPTO S D0=0 Q
"RTN","MAGDRPC6",104,0)
 . . . I ST'="",IM'="",TY'="" K ^MAGQUEUE(2006.035,"DEST",DE,ST,IM,TY,D0)
"RTN","MAGDRPC6",105,0)
 . . . K ^MAGQUEUE(2006.035,"STS",LOCATION,"WAITING",PRI,DE,D0)
"RTN","MAGDRPC6",106,0)
 . . . K:ID'="" ^MAGQUEUE(2006.035,"ID",ID,D0)
"RTN","MAGDRPC6",107,0)
 . . . K ^MAGQUEUE(2006.035,D0)
"RTN","MAGDRPC6",108,0)
 . . . S OUT=OUT+1
"RTN","MAGDRPC6",109,0)
 . . . Q
"RTN","MAGDRPC6",110,0)
 . . Q
"RTN","MAGDRPC6",111,0)
 . Q
"RTN","MAGDRPC6",112,0)
 Q
"RTN","MAGDRPC6",113,0)
 ;
"RTN","MAGDRPC6",114,0)
EVALLOG(OUT,TASK,MSG,MAX,LOCATION) ; RPC = MAG DICOM ROUTE EVAL LOG
"RTN","MAGDRPC6",115,0)
 N L,N,PLACE,ZTSK
"RTN","MAGDRPC6",116,0)
 ;
"RTN","MAGDRPC6",117,0)
 S PLACE=$$PLACE^MAGDRPC2(LOCATION)
"RTN","MAGDRPC6",118,0)
 S $P(^MAG(2006.1,PLACE,"LASTROUTE"),"^",1)=DT
"RTN","MAGDRPC6",119,0)
 ;
"RTN","MAGDRPC6",120,0)
 I '$D(^XTMP("MAGEVAL",+$G(TASK))) S OUT(1)="-1,No task #"_(+$G(TASK)) Q
"RTN","MAGDRPC6",121,0)
 I $G(MAX)<1 S OUT(1)="-2,MAXIMUM parameter = "_$G(MAX)_" < 1" Q
"RTN","MAGDRPC6",122,0)
 S (L,MSG)=+$G(MSG),N=1
"RTN","MAGDRPC6",123,0)
 F  S MSG=$O(^XTMP("MAGEVAL",TASK,MSG)) Q:MSG=""  D  Q:N'<MAX
"RTN","MAGDRPC6",124,0)
 . S L=MSG,N=N+1,OUT(N)=^XTMP("MAGEVAL",TASK,MSG)
"RTN","MAGDRPC6",125,0)
 . Q
"RTN","MAGDRPC6",126,0)
 S OUT(1)=(N-1)_" "_L
"RTN","MAGDRPC6",127,0)
 Q:N>1
"RTN","MAGDRPC6",128,0)
 S ZTSK=TASK D STAT^%ZTLOAD
"RTN","MAGDRPC6",129,0)
 I $G(ZTSK(2))["Inactive" S OUT(1)="-3,"_ZTSK(2) Q
"RTN","MAGDRPC6",130,0)
 Q
"RTN","MAGDRPC6",131,0)
 ;
"RTN","MAGDRPC6",132,0)
XMIT ; Continuation from MAGDRPC5
"RTN","MAGDRPC6",133,0)
 N FROM,HASH,TO,TTP
"RTN","MAGDRPC6",134,0)
 S (FROM,TO,OUT(7),OUT(8))=-13
"RTN","MAGDRPC6",135,0)
 S TTP=TP S:TP="TEXT" TTP="FULL" ; MAGFILEB does not support type="TEXT"
"RTN","MAGDRPC6",136,0)
 D FILEFIND^MAGDFB(IM,TTP,0,0,.TO,.FROM)
"RTN","MAGDRPC6",137,0)
 S:FROM["~NO NETWORK LOCATION DEFINED" (FROM,TO)="-1~No routable files found for image "_IM
"RTN","MAGDRPC6",138,0)
 I TP="TEXT" S TO=$E(TO,1,$L(TO)-4)_".TXT",FROM=$E(FROM,1,$L(FROM)-4)_".TXT"
"RTN","MAGDRPC6",139,0)
 I (FROM<0)!(TO<0)!(FROM="") D STATUS^MAGDRPC5(X,D0,"SENT",LOCATION) S OUT(1)=2 Q
"RTN","MAGDRPC6",140,0)
 S HASH=$$DIRHASH^MAGFILEB(TO,+DEST) D:HASH'=""
"RTN","MAGDRPC6",141,0)
 . I $E(TO,1)="\",$E(HASH,$L(HASH))="\" S HASH=$E(HASH,1,$L(HASH)-1)
"RTN","MAGDRPC6",142,0)
 . I $E(TO,1)'="\",$E(HASH,$L(HASH))'="\" S HASH=HASH_"\"
"RTN","MAGDRPC6",143,0)
 . S TO=HASH_TO
"RTN","MAGDRPC6",144,0)
 . Q
"RTN","MAGDRPC6",145,0)
 D:DIR'=""
"RTN","MAGDRPC6",146,0)
 . I $E(TO,1)="\",$E(DIR,$L(DIR))="\" S DIR=$E(DIR,1,$L(DIR)-1)
"RTN","MAGDRPC6",147,0)
 . I $E(TO,1)'="\",$E(DIR,$L(DIR))'="\" S DIR=DIR_"\"
"RTN","MAGDRPC6",148,0)
 . S TO=DIR_TO
"RTN","MAGDRPC6",149,0)
 . Q
"RTN","MAGDRPC6",150,0)
 S:$E(TO,1)'="\" TO="\"_TO
"RTN","MAGDRPC6",151,0)
 S OUT(7)=FROM,OUT(8)=TO
"RTN","MAGDRPC6",152,0)
 S OUT(1)=1
"RTN","MAGDRPC6",153,0)
 Q
"RTN","MAGDRPC6",154,0)
 ;
"RTN","MAGDRPC7")
0^43^B36219173
"RTN","MAGDRPC7",1,0)
MAGDRPC7 ;WOIFO/EdM - RPC to fetch a Audit Info ; 10/30/2008 09:20
"RTN","MAGDRPC7",2,0)
 ;;3.0;IMAGING;**11,51,54**;03-July-2009;;Build 1424
"RTN","MAGDRPC7",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDRPC7",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC7",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRPC7",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRPC7",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRPC7",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRPC7",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRPC7",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRPC7",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRPC7",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRPC7",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRPC7",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRPC7",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRPC7",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC7",17,0)
 ;;
"RTN","MAGDRPC7",18,0)
 Q
"RTN","MAGDRPC7",19,0)
 ;
"RTN","MAGDRPC7",20,0)
GET1(OUT,LOCATION,TODAY) ; RPC = MAG DICOM TEXT AUDIT GET
"RTN","MAGDRPC7",21,0)
 ; Get the numbers of text-messages per day per purpose
"RTN","MAGDRPC7",22,0)
 N COUNT,D2,DATE,I,MSG,N,X
"RTN","MAGDRPC7",23,0)
 D:'$D(DT) DT^DICRW
"RTN","MAGDRPC7",24,0)
 K OUT S (OUT(1),N)=1,I=100
"RTN","MAGDRPC7",25,0)
 S TODAY=+$G(TODAY),DATE=DT
"RTN","MAGDRPC7",26,0)
 D:TODAY  I 'TODAY S DATE=0 F  S DATE=$O(^MAGDAUDT(2006.5761,DATE)) Q:'DATE  D
"RTN","MAGDRPC7",27,0)
 . Q:'$D(^MAGDAUDT(2006.5761,DATE,1,LOCATION))
"RTN","MAGDRPC7",28,0)
 . ; Retrieve one day's statistics
"RTN","MAGDRPC7",29,0)
 . S MSG="" F  S MSG=$O(^MAGDAUDT(2006.5761,DATE,1,LOCATION,1,"B",MSG)) Q:MSG=""  D
"RTN","MAGDRPC7",30,0)
 . . S D2=$O(^MAGDAUDT(2006.5761,DATE,1,LOCATION,1,"B",MSG,"")) Q:'D2
"RTN","MAGDRPC7",31,0)
 . . S X=$G(^MAGDAUDT(2006.5761,DATE,1,LOCATION,1,D2,0))
"RTN","MAGDRPC7",32,0)
 . . S COUNT=$P(X,"^",2) Q:'COUNT
"RTN","MAGDRPC7",33,0)
 . . S LAST=$P(X,"^",3)
"RTN","MAGDRPC7",34,0)
 . . S I=I+1,N=N+1,OUT(I)=DATE_"^"_COUNT_"^"_MSG_"^"_LAST,MSG(MSG)=""
"RTN","MAGDRPC7",35,0)
 . . Q
"RTN","MAGDRPC7",36,0)
 . Q
"RTN","MAGDRPC7",37,0)
 S I=1,MSG="" F  S MSG=$O(MSG(MSG)) Q:MSG=""  D
"RTN","MAGDRPC7",38,0)
 . S I=I+1,N=N+1,OUT(I)="^^"_MSG
"RTN","MAGDRPC7",39,0)
 . Q
"RTN","MAGDRPC7",40,0)
 S OUT(1)=N-1
"RTN","MAGDRPC7",41,0)
 Q
"RTN","MAGDRPC7",42,0)
 ;
"RTN","MAGDRPC7",43,0)
GET2(OUT,LOCATION,START,STOP,MAX,OFFSET) ; RPC = MAG DICOM IMAGE AUDIT GET
"RTN","MAGDRPC7",44,0)
 ; Get the numbers of messages per day per instrument
"RTN","MAGDRPC7",45,0)
 N COUNT,D2,DATE,F1,F2,I,INSTR,LAST,N,X
"RTN","MAGDRPC7",46,0)
 D:'$D(DT) DT^DICRW
"RTN","MAGDRPC7",47,0)
 S MAX=+$G(MAX),OFFSET=+$G(OFFSET),(F1,F2,LAST)=0 S:'MAX MAX=100
"RTN","MAGDRPC7",48,0)
 K OUT S (OUT(1),N)=1,I=1000
"RTN","MAGDRPC7",49,0)
 S START=+$G(START)-1,STOP=+$G(STOP)
"RTN","MAGDRPC7",50,0)
 S:START<0 START=0
"RTN","MAGDRPC7",51,0)
 S:'STOP STOP=9999999
"RTN","MAGDRPC7",52,0)
 S DATE=START F  S DATE=$O(^MAGDAUDT(2006.5762,DATE)) Q:'DATE  Q:DATE>STOP  D
"RTN","MAGDRPC7",53,0)
 . Q:'$D(^MAGDAUDT(2006.5762,DATE,1,LOCATION))
"RTN","MAGDRPC7",54,0)
 . ; Retrieve one day's statistics
"RTN","MAGDRPC7",55,0)
 . S INSTR="" F  S INSTR=$O(^MAGDAUDT(2006.5762,DATE,1,LOCATION,1,"B",INSTR)) Q:INSTR=""  D
"RTN","MAGDRPC7",56,0)
 . . S D2=$O(^MAGDAUDT(2006.5762,DATE,1,LOCATION,1,"B",INSTR,"")) Q:'D2
"RTN","MAGDRPC7",57,0)
 . . S X=$G(^MAGDAUDT(2006.5762,DATE,1,LOCATION,1,D2,0))
"RTN","MAGDRPC7",58,0)
 . . S COUNT=$P(X,"^",2) S:$P(X,"^",4)>COUNT COUNT=$P(X,"^",4)
"RTN","MAGDRPC7",59,0)
 . . Q:'COUNT
"RTN","MAGDRPC7",60,0)
 . . S INSTR(INSTR)=""
"RTN","MAGDRPC7",61,0)
 . . S F1=F1+1 Q:F1'>OFFSET
"RTN","MAGDRPC7",62,0)
 . . S F2=F2+1 Q:F2>MAX
"RTN","MAGDRPC7",63,0)
 . . S LAST=F1
"RTN","MAGDRPC7",64,0)
 . . S I=I+1,N=N+1,OUT(I)=DATE_"^"_$P(X,"^",2)_"^"_INSTR_"^"_$P(X,"^",3,5)
"RTN","MAGDRPC7",65,0)
 . . Q
"RTN","MAGDRPC7",66,0)
 . Q
"RTN","MAGDRPC7",67,0)
 S I=1,INSTR="" F  S INSTR=$O(INSTR(INSTR)) Q:INSTR=""  D
"RTN","MAGDRPC7",68,0)
 . S I=I+1,N=N+1,OUT(I)="^^"_INSTR
"RTN","MAGDRPC7",69,0)
 . Q
"RTN","MAGDRPC7",70,0)
 S OUT(1)=(N-1)_","_LAST
"RTN","MAGDRPC7",71,0)
 Q
"RTN","MAGDRPC7",72,0)
 ;
"RTN","MAGDRPC7",73,0)
RANGE(OUT) ; RPC = MAG DICOM AUDIT RANGE
"RTN","MAGDRPC7",74,0)
 ; Get the date-ranges for the various audit files
"RTN","MAGDRPC7",75,0)
 N DF,DL,FM,N
"RTN","MAGDRPC7",76,0)
 K OUT S N=1
"RTN","MAGDRPC7",77,0)
 F FM=2006.5761,2006.5762 D
"RTN","MAGDRPC7",78,0)
 . S DF=$O(^MAGDAUDT(FM,0)) S:'DF DF=""
"RTN","MAGDRPC7",79,0)
 . S DL=$O(^MAGDAUDT(FM," "),-1) S:'DL DL=""
"RTN","MAGDRPC7",80,0)
 . S N=N+1,OUT(N)=FM_"^"_DF_"^"_DL
"RTN","MAGDRPC7",81,0)
 . Q
"RTN","MAGDRPC7",82,0)
 S N=N+1,OUT(N)="-END-"
"RTN","MAGDRPC7",83,0)
 Q
"RTN","MAGDRPC7",84,0)
 ;
"RTN","MAGDRPC7",85,0)
PURGE(OUT,FM,DATE) ; RPC = MAG DICOM AUDIT PURGE
"RTN","MAGDRPC7",86,0)
 ; Purge Audit FIle
"RTN","MAGDRPC7",87,0)
 N D0,DAYS,X
"RTN","MAGDRPC7",88,0)
 L +^MAGDAUDT(FM):1E9 ; Background job MUST wait
"RTN","MAGDRPC7",89,0)
 S DAYS=$P($G(^MAGDAUDT(FM,0)),"^",4),OUT=0
"RTN","MAGDRPC7",90,0)
 S X=0 F  S X=$O(^MAGDAUDT(FM,X)) Q:'X  Q:X'<DATE  D
"RTN","MAGDRPC7",91,0)
 . K ^MAGDAUDT(FM,X)
"RTN","MAGDRPC7",92,0)
 . S DAYS=DAYS-1,OUT=OUT+1
"RTN","MAGDRPC7",93,0)
 . Q
"RTN","MAGDRPC7",94,0)
 S:DAYS<1 DAYS=0
"RTN","MAGDRPC7",95,0)
 S $P(^MAGDAUDT(FM,0),"^",4)=DAYS
"RTN","MAGDRPC7",96,0)
 L -^MAGDAUDT(FM)
"RTN","MAGDRPC7",97,0)
 S OUT=OUT_" day"_$S(OUT=1:"",1:"s")_" purged."
"RTN","MAGDRPC7",98,0)
 Q
"RTN","MAGDRPC7",99,0)
 ;
"RTN","MAGDRPC7",100,0)
COUNT(OUT,LOCATION,MESSAGE) ; RPC = MAG DICOM AUDIT COUNT
"RTN","MAGDRPC7",101,0)
 ; update today's count
"RTN","MAGDRPC7",102,0)
 N D2,TODAY,NOW,X
"RTN","MAGDRPC7",103,0)
 I '$G(LOCATION) S OUT="-1,No Location Specified" Q
"RTN","MAGDRPC7",104,0)
 I $G(MESSAGE)="" S OUT="-2,No Message Specified" Q
"RTN","MAGDRPC7",105,0)
 ;
"RTN","MAGDRPC7",106,0)
 S NOW=$$NOW^XLFDT(),TODAY=NOW\1
"RTN","MAGDRPC7",107,0)
 S D2=$O(^MAGDAUDT(2006.5761,TODAY,1,LOCATION,1,"B",MESSAGE,""))
"RTN","MAGDRPC7",108,0)
 D:'D2
"RTN","MAGDRPC7",109,0)
 . L +^MAGDAUDT(2006.5761,TODAY):1E9 ; Background job MUST wait
"RTN","MAGDRPC7",110,0)
 . S D2=$O(^MAGDAUDT(2006.5761,TODAY,1,LOCATION,1," "),-1)+1
"RTN","MAGDRPC7",111,0)
 . S X=$G(^MAGDAUDT(2006.5761,TODAY,1,LOCATION,1,0))
"RTN","MAGDRPC7",112,0)
 . S $P(X,"^",2)="2006.576111"
"RTN","MAGDRPC7",113,0)
 . S $P(X,"^",3)=D2
"RTN","MAGDRPC7",114,0)
 . S $P(X,"^",4)=$P(X,"^",4)+1
"RTN","MAGDRPC7",115,0)
 . S ^MAGDAUDT(2006.5761,TODAY,1,LOCATION,0)=LOCATION
"RTN","MAGDRPC7",116,0)
 . S ^MAGDAUDT(2006.5761,TODAY,1,LOCATION,1,0)=X
"RTN","MAGDRPC7",117,0)
 . S ^MAGDAUDT(2006.5761,TODAY,1,LOCATION,1,D2,0)=MESSAGE
"RTN","MAGDRPC7",118,0)
 . S ^MAGDAUDT(2006.5761,TODAY,1,LOCATION,1,"B",MESSAGE,D2)=""
"RTN","MAGDRPC7",119,0)
 . L -^MAGDAUDT(2006.5761,TODAY)
"RTN","MAGDRPC7",120,0)
 . Q
"RTN","MAGDRPC7",121,0)
 S X=$G(^MAGDAUDT(2006.5761,TODAY,1,LOCATION,1,D2,0))
"RTN","MAGDRPC7",122,0)
 S X=MESSAGE_"^"_($P(X,"^",2)+1)_"^"_NOW
"RTN","MAGDRPC7",123,0)
 S ^MAGDAUDT(2006.5761,TODAY,1,LOCATION,1,D2,0)=X
"RTN","MAGDRPC7",124,0)
 S OUT=$P(X,"^",2)
"RTN","MAGDRPC7",125,0)
 Q
"RTN","MAGDRPC7",126,0)
 ;
"RTN","MAGDRPC7",127,0)
LOGXIMG(OUT,D0,DEST,LOCATION,STATUS,TO,XMIT,MECH) ; RPC = MAG DICOM ROUTE LOG XMIT
"RTN","MAGDRPC7",128,0)
 N X
"RTN","MAGDRPC7",129,0)
 ; D0 ;---- IEN of queue entry (2006.035)
"RTN","MAGDRPC7",130,0)
 ; DEST ;-- IEN of destination in 2005.2 or in 2006.585
"RTN","MAGDRPC7",131,0)
 ; TO ;---- Name of file at destination
"RTN","MAGDRPC7",132,0)
 ; XMIT ;-- Date and time transmission started
"RTN","MAGDRPC7",133,0)
 N D41 ;--- IEN in "routed" multiple
"RTN","MAGDRPC7",134,0)
 N D61 ;--- IEN in "permanent" multiple
"RTN","MAGDRPC7",135,0)
 N IMG ;--- IEN of Image in 2005
"RTN","MAGDRPC7",136,0)
 N NOW ;----- Current date and time
"RTN","MAGDRPC7",137,0)
 N QUEUED ; Date and time file was queued
"RTN","MAGDRPC7",138,0)
 N TP ;---- File TP (FULL, ABS, BIG, TXT, DICOM)
"RTN","MAGDRPC7",139,0)
 ;
"RTN","MAGDRPC7",140,0)
 D STATUS^MAGDRPC5(.X,D0,STATUS,LOCATION) I X<1 S OUT="-1,"_X Q
"RTN","MAGDRPC7",141,0)
 I STATUS="FAILED" S OUT=1 Q
"RTN","MAGDRPC7",142,0)
 S X=$G(^MAGQUEUE(2006.035,D0,0)),IMG=$P(X,"^",1),TP=$P(X,"^",3)
"RTN","MAGDRPC7",143,0)
 S QUEUED=$P($G(^MAGQUEUE(2006.035,D0,1)),"^",3)
"RTN","MAGDRPC7",144,0)
 ;
"RTN","MAGDRPC7",145,0)
 S NOW=$$NOW^XLFDT()
"RTN","MAGDRPC7",146,0)
 S $P(^MAGQUEUE(2006.035,D0,1),"^",4)=NOW
"RTN","MAGDRPC7",147,0)
 L +^MAG(2005,IMG):1E9 ; Background job MUST wait
"RTN","MAGDRPC7",148,0)
 S D41=$O(^MAG(2005,IMG,4," "),-1)+1
"RTN","MAGDRPC7",149,0)
 S D61=$O(^MAG(2005,IMG,6," "),-1)+1
"RTN","MAGDRPC7",150,0)
 D:MECH=1
"RTN","MAGDRPC7",151,0)
 . S ^MAG(2005,IMG,4,0)="^2005.0106^"_D41_"^"_D41
"RTN","MAGDRPC7",152,0)
 . S ^MAG(2005,IMG,4,D41,0)=NOW_"^"_DEST_"^"_TP_"^"_TO_"^"_$G(XMIT)_"^"_QUEUED_"^"_D61
"RTN","MAGDRPC7",153,0)
 . S ^MAG(2005,IMG,4,"LOC",DEST,D41)=""
"RTN","MAGDRPC7",154,0)
 . S ^MAG(2005,"ROUTE",DEST,NOW,IMG,D41)=""
"RTN","MAGDRPC7",155,0)
 . Q
"RTN","MAGDRPC7",156,0)
 S X=""
"RTN","MAGDRPC7",157,0)
 I MECH=1 S X=$P($G(^MAG(2005.2,+DEST,0)),"^",1)_"^"_(+DEST)_"^"
"RTN","MAGDRPC7",158,0)
 I MECH=2 S X=$P($G(^MAG(2006.587,+DEST,0)),"^",1)_"^^"_(+DEST)
"RTN","MAGDRPC7",159,0)
 S $P(X,"^",4)=NOW ; Timestamp of transmission
"RTN","MAGDRPC7",160,0)
 S $P(X,"^",6)=TO ; Filename at destination
"RTN","MAGDRPC7",161,0)
 S $P(X,"^",7)=TP ; File Type
"RTN","MAGDRPC7",162,0)
 S ^MAG(2005,IMG,6,0)="^2005.0106^"_D61_"^"_D61
"RTN","MAGDRPC7",163,0)
 S ^MAG(2005,IMG,6,D61,0)=X
"RTN","MAGDRPC7",164,0)
 L -^MAG(2005,IMG)
"RTN","MAGDRPC7",165,0)
 S OUT=1
"RTN","MAGDRPC7",166,0)
 Q
"RTN","MAGDRPC7",167,0)
 ;
"RTN","MAGDRPC8")
0^44^B62107213
"RTN","MAGDRPC8",1,0)
MAGDRPC8 ;WOIFO/EdM - RPCs for Master Files ; 24 Jul 2008 4:26 PM
"RTN","MAGDRPC8",2,0)
 ;;3.0;IMAGING;**11,30,51,54**;03-July-2009;;Build 1424
"RTN","MAGDRPC8",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDRPC8",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC8",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRPC8",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRPC8",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRPC8",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRPC8",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRPC8",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRPC8",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRPC8",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRPC8",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRPC8",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRPC8",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRPC8",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC8",17,0)
 ;;
"RTN","MAGDRPC8",18,0)
 Q
"RTN","MAGDRPC8",19,0)
 ;
"RTN","MAGDRPC8",20,0)
UPDTAPP(OUT,APP) ; RPC = MAG DICOM UPDATE SCU LIST
"RTN","MAGDRPC8",21,0)
 N A,D0,D1,DIMSE,GWLOC,GWNAM,HDR,I,MIN,N,NOW,P5,P7,PLUS,SERVNAM,UP,X
"RTN","MAGDRPC8",22,0)
 S (GWNAM,GWLOC)="",N=0
"RTN","MAGDRPC8",23,0)
 S A="" F  S A=$O(APP(A)) Q:A=""  D
"RTN","MAGDRPC8",24,0)
 . Q:A["_"
"RTN","MAGDRPC8",25,0)
 . S X=APP(A) F I=1:1:7 S:$P(X,"^",I)="" N=N+1
"RTN","MAGDRPC8",26,0)
 . S:GWNAM="" GWNAM=$P(X,"^",5)
"RTN","MAGDRPC8",27,0)
 . S:GWLOC="" GWLOC=$P(X,"^",7)
"RTN","MAGDRPC8",28,0)
 . S:GWNAM'=$P(X,"^",5) N=N+1
"RTN","MAGDRPC8",29,0)
 . S:GWLOC'=$P(X,"^",7) N=N+1
"RTN","MAGDRPC8",30,0)
 . S:'N A($P(X,"^",1))=A ; ^MAGDMFBS guarantees unique names
"RTN","MAGDRPC8",31,0)
 . Q
"RTN","MAGDRPC8",32,0)
 I N S OUT="-1,Missing or Inconsistent Parameters." Q
"RTN","MAGDRPC8",33,0)
 ;
"RTN","MAGDRPC8",34,0)
 L +^MAG(2006.587,0):1E9 ; Background task MUST wait
"RTN","MAGDRPC8",35,0)
 S HDR=$G(^MAG(2006.587,0))
"RTN","MAGDRPC8",36,0)
 S $P(HDR,"^",1,2)="DICOM TRANSMIT DESTINATION^2006.587"
"RTN","MAGDRPC8",37,0)
 ;
"RTN","MAGDRPC8",38,0)
 S NOW=$$NOW^XLFDT(),(MIN,PLUS,UP)=0
"RTN","MAGDRPC8",39,0)
 ;
"RTN","MAGDRPC8",40,0)
 S D0="" F  S D0=$O(^MAG(2006.587,"D",GWNAM,GWLOC,D0)) Q:D0=""  D
"RTN","MAGDRPC8",41,0)
 . S X=$G(^MAG(2006.587,D0,0)),SERVNAM=$P(X,"^",1) Q:SERVNAM=""
"RTN","MAGDRPC8",42,0)
 . S P5=$P(X,"^",5),P7=$P(X,"^",7)
"RTN","MAGDRPC8",43,0)
 . I P5'="",P7'="" K ^MAG(2006.587,"C",SERVNAM,P7,P5,D0),^MAG(2006.587,"D",P5,P7,D0)
"RTN","MAGDRPC8",44,0)
 . I '$D(A(SERVNAM)) D  Q
"RTN","MAGDRPC8",45,0)
 . . K ^MAG(2006.587,D0),^MAG(2006.587,"B",SERVNAM,D0) S MIN=MIN+1
"RTN","MAGDRPC8",46,0)
 . . Q
"RTN","MAGDRPC8",47,0)
 . S X=APP(A(SERVNAM)),$P(X,"^",8)=NOW K APP(A(SERVNAM))
"RTN","MAGDRPC8",48,0)
 . S ^MAG(2006.587,D0,0)=$P(X,"^",1,8),UP=UP+1
"RTN","MAGDRPC8",49,0)
 . S ^MAG(2006.587,"C",SERVNAM,GWLOC,GWNAM,D0)=""
"RTN","MAGDRPC8",50,0)
 . S ^MAG(2006.587,"D",GWNAM,GWLOC,D0)=""
"RTN","MAGDRPC8",51,0)
 . K DIMSE S DIMSE=A(SERVNAM)_"_"
"RTN","MAGDRPC8",52,0)
 . S X=DIMSE F  S X=$O(APP(X)) Q:$E(X,1,$L(DIMSE))'=DIMSE  D
"RTN","MAGDRPC8",53,0)
 . . S N=$P(X,"_",2) Q:N=""
"RTN","MAGDRPC8",54,0)
 . . S DIMSE(N)=APP(X)
"RTN","MAGDRPC8",55,0)
 . . S DIMSE("C-ECHO")="1^1"
"RTN","MAGDRPC8",56,0)
 . . Q
"RTN","MAGDRPC8",57,0)
 . K ^MAG(2006.587,D0,1)
"RTN","MAGDRPC8",58,0)
 . S D1=0,X="" F  S X=$O(DIMSE(X)) Q:X=""  D
"RTN","MAGDRPC8",59,0)
 . . S D1=D1+1,^MAG(2006.587,D0,1,D1,0)=X_"^"_DIMSE(X)
"RTN","MAGDRPC8",60,0)
 . . S ^MAG(2006.587,D0,1,"B",X,D1)=""
"RTN","MAGDRPC8",61,0)
 . . Q
"RTN","MAGDRPC8",62,0)
 . S:D1 ^MAG(2006.587,D0,1,0)="^2006.5871SA^"_D1_"^"_D1
"RTN","MAGDRPC8",63,0)
 . Q
"RTN","MAGDRPC8",64,0)
 S $P(HDR,"^",4)=$P(HDR,"^",4)-MIN
"RTN","MAGDRPC8",65,0)
 ;
"RTN","MAGDRPC8",66,0)
 S A="" F  S A=$O(APP(A)) Q:A=""  D
"RTN","MAGDRPC8",67,0)
 . Q:A["_"
"RTN","MAGDRPC8",68,0)
 . S X=APP(A),$P(X,"^",8)=NOW
"RTN","MAGDRPC8",69,0)
 . S D0=$O(^MAG(2006.587," "),-1)+1,PLUS=PLUS+1,$P(HDR,"^",3)=D0
"RTN","MAGDRPC8",70,0)
 . S ^MAG(2006.587,D0,0)=$P(X,"^",1,8),SERVNAM=$P(X,"^",1)
"RTN","MAGDRPC8",71,0)
 . S ^MAG(2006.587,"B",SERVNAM,D0)=""
"RTN","MAGDRPC8",72,0)
 . S ^MAG(2006.587,"C",SERVNAM,GWLOC,GWNAM,D0)=""
"RTN","MAGDRPC8",73,0)
 . S ^MAG(2006.587,"D",GWNAM,GWLOC,D0)=""
"RTN","MAGDRPC8",74,0)
 . K DIMSE S DIMSE=A_"_"
"RTN","MAGDRPC8",75,0)
 . S X=DIMSE F  S X=$O(APP(X)) Q:$E(X,1,$L(DIMSE))'=DIMSE  D
"RTN","MAGDRPC8",76,0)
 . . S N=$P(X,"_",2) Q:N=""
"RTN","MAGDRPC8",77,0)
 . . S DIMSE(N)=APP(X)
"RTN","MAGDRPC8",78,0)
 . . S DIMSE("C-ECHO")="1^1"
"RTN","MAGDRPC8",79,0)
 . . Q
"RTN","MAGDRPC8",80,0)
 . K ^MAG(2006.587,D0,1)
"RTN","MAGDRPC8",81,0)
 . S D1=0,X="" F  S X=$O(DIMSE(X)) Q:X=""  D
"RTN","MAGDRPC8",82,0)
 . . S D1=D1+1,^MAG(2006.587,D0,1,D1,0)=X_"^"_DIMSE(X)
"RTN","MAGDRPC8",83,0)
 . . S ^MAG(2006.587,D0,1,"B",X,D1)=""
"RTN","MAGDRPC8",84,0)
 . . Q
"RTN","MAGDRPC8",85,0)
 . S:D1 ^MAG(2006.587,D0,1,0)="^2006.5871SA^"_D1_"^"_D1
"RTN","MAGDRPC8",86,0)
 . Q
"RTN","MAGDRPC8",87,0)
 S (N,D0)=0 F  S D0=$O(^MAG(2006.587,D0)) Q:'D0  S N=N+1
"RTN","MAGDRPC8",88,0)
 S $P(HDR,"^",4)=N
"RTN","MAGDRPC8",89,0)
 S ^MAG(2006.587,0)=HDR
"RTN","MAGDRPC8",90,0)
 L -^MAG(2006.587,0)
"RTN","MAGDRPC8",91,0)
 S OUT="1"
"RTN","MAGDRPC8",92,0)
 S:PLUS OUT=OUT_", "_PLUS_" added"
"RTN","MAGDRPC8",93,0)
 S:MIN OUT=OUT_", "_MIN_" removed"
"RTN","MAGDRPC8",94,0)
 S:UP OUT=OUT_", "_UP_" updated"
"RTN","MAGDRPC8",95,0)
 Q
"RTN","MAGDRPC8",96,0)
 ;
"RTN","MAGDRPC8",97,0)
UPDTGW(OUT,ONAM,NNAM,OLOC,NLOC) ; RPC = MAG DICOM UPDATE GATEWAY NAME
"RTN","MAGDRPC8",98,0)
 N D0,P1,P5,P7,N
"RTN","MAGDRPC8",99,0)
 I $G(NNAM)="" S OUT="-1,No Gateway Name specified" Q
"RTN","MAGDRPC8",100,0)
 I '$G(NLOC) S OUT="-2,No Gateway Location specified" Q
"RTN","MAGDRPC8",101,0)
 S OLOC=$G(OLOC),ONAM=$G(ONAM)
"RTN","MAGDRPC8",102,0)
 S (N,D0)=0 F  S D0=$O(^MAG(2006.587,D0)) Q:'D0  D
"RTN","MAGDRPC8",103,0)
 . S X=$G(^MAG(2006.587,D0,0)),P5=$P(X,"^",5) Q:P5'=ONAM
"RTN","MAGDRPC8",104,0)
 . S P1=$P(X,"^",1),P7=$P(X,"^",7)
"RTN","MAGDRPC8",105,0)
 . I OLOC'="",P5'="",P1'="" K ^MAG(2006.587,"C",P1,OLOC,P5,D0)
"RTN","MAGDRPC8",106,0)
 . I OLOC'="",P5'="" K ^MAG(2006.587,"D",P5,OLOC,D0)
"RTN","MAGDRPC8",107,0)
 . S $P(X,"^",5)=NNAM,$P(X,"^",7)=NLOC
"RTN","MAGDRPC8",108,0)
 . S ^MAG(2006.587,D0,0)=X
"RTN","MAGDRPC8",109,0)
 . S:P1'="" ^MAG(2006.587,"C",P1,NLOC,NNAM,D0)=""
"RTN","MAGDRPC8",110,0)
 . S ^MAG(2006.587,"D",NNAM,NLOC,D0)=""
"RTN","MAGDRPC8",111,0)
 . S N=N+1
"RTN","MAGDRPC8",112,0)
 . Q
"RTN","MAGDRPC8",113,0)
 S OUT=N
"RTN","MAGDRPC8",114,0)
 Q
"RTN","MAGDRPC8",115,0)
 ;
"RTN","MAGDRPC8",116,0)
SIBS(P0,T) N MAGLOC,P1,P2
"RTN","MAGDRPC8",117,0)
 S T(P0)=""
"RTN","MAGDRPC8",118,0)
 D SIBLING^XUAF4("MAGLOC",P0,"PARENT FACILITY") ; General API, IA #2171
"RTN","MAGDRPC8",119,0)
 S P1="" F  S P1=$O(MAGLOC("P",P1)) Q:P1=""  D
"RTN","MAGDRPC8",120,0)
 . S P2="" F  S P2=$O(MAGLOC("P",P1,"C",P2)) Q:P2=""  S T(P2)=""
"RTN","MAGDRPC8",121,0)
 . Q
"RTN","MAGDRPC8",122,0)
 Q
"RTN","MAGDRPC8",123,0)
 ;
"RTN","MAGDRPC8",124,0)
LOCS(OUT) ; RPC = MAG DICOM VALID LOCATIONS
"RTN","MAGDRPC8",125,0)
 N D0,I,MAGM,N,P1,MAGR,T
"RTN","MAGDRPC8",126,0)
 S N=1
"RTN","MAGDRPC8",127,0)
 S D0=0 F  S D0=$O(^MAG(2006.1,D0)) Q:'D0  D
"RTN","MAGDRPC8",128,0)
 . S X=$G(^MAG(2006.1,D0,0)),P1=$P(X,"^",1) Q:P1=""
"RTN","MAGDRPC8",129,0)
 . I +P1=P1 S T(P1)="" Q
"RTN","MAGDRPC8",130,0)
 . D FIND^DIC(4,"","","BX",P1,"*","","","","MAGR","MAGM") ; IA #4389
"RTN","MAGDRPC8",131,0)
 . S I=0 F  S I=$O(MAGR("DILIST",2,I)) Q:'I  D
"RTN","MAGDRPC8",132,0)
 . . S P1=MAGR("DILIST",2,I) I P1 K MAGR S T(P1)=""
"RTN","MAGDRPC8",133,0)
 . . Q
"RTN","MAGDRPC8",134,0)
 . Q
"RTN","MAGDRPC8",135,0)
 I $T(+1^XUPARAM)'="" S P1=$$KSP^XUPARAM("INST") D:P1 SIBS(P1,.T)
"RTN","MAGDRPC8",136,0)
 S P1=+$G(^DD("SITE",1)) D:P1 SIBS(P1,.T)
"RTN","MAGDRPC8",137,0)
 ;
"RTN","MAGDRPC8",138,0)
 S P1="" F  S P1=$O(T(P1)) Q:P1=""  D
"RTN","MAGDRPC8",139,0)
 . S N=N+1,OUT(N)=P1_"^"_$$GET1^DIQ(4,P1,.01)_"^"_$$GET1^DIQ(4,P1,99)
"RTN","MAGDRPC8",140,0)
 . Q
"RTN","MAGDRPC8",141,0)
 S OUT(1)=N-1
"RTN","MAGDRPC8",142,0)
 Q
"RTN","MAGDRPC8",143,0)
 ;
"RTN","MAGDRPC8",144,0)
GETPLACE(OUT,LOCATION) ; RPC = MAG DICOM GET PLACE
"RTN","MAGDRPC8",145,0)
 N D0,P1,MAGM,MAGR,X
"RTN","MAGDRPC8",146,0)
 S LOCATION=+$G(LOCATION)
"RTN","MAGDRPC8",147,0)
 S OUT="-1,Location """_LOCATION_""" not found."
"RTN","MAGDRPC8",148,0)
 S D0=0 F  S D0=$O(^MAG(2006.1,D0)) Q:'D0  D  Q:OUT>0
"RTN","MAGDRPC8",149,0)
 . S X=$G(^MAG(2006.1,D0,0)),P1=$P(X,"^",1) Q:P1=""
"RTN","MAGDRPC8",150,0)
 . I +P1=P1,LOCATION=P1 S OUT=D0 Q
"RTN","MAGDRPC8",151,0)
 . D FIND^DIC(4,"","","BX",P1,"*","","","","MAGR","MAGM")
"RTN","MAGDRPC8",152,0)
 . S I=0 F  S I=$O(MAGR("DILIST",2,I)) Q:'I  D
"RTN","MAGDRPC8",153,0)
 . . I LOCATION=MAGR("DILIST",2,I) S OUT=D0
"RTN","MAGDRPC8",154,0)
 . . Q
"RTN","MAGDRPC8",155,0)
 . Q
"RTN","MAGDRPC8",156,0)
 Q
"RTN","MAGDRPC8",157,0)
 ;
"RTN","MAGDRPC8",158,0)
SETPACS(OUT,D0) ; RPC = MAG DICOM SET PACS PARAMS
"RTN","MAGDRPC8",159,0)
 N X
"RTN","MAGDRPC8",160,0)
 I '$G(D0) S OUT="-1,No Place Specified." Q
"RTN","MAGDRPC8",161,0)
 I '$D(^MAG(2006.1,D0)) S OUT="-2,Invalid Place Specified." Q
"RTN","MAGDRPC8",162,0)
 ;
"RTN","MAGDRPC8",163,0)
 ; There is a PACS
"RTN","MAGDRPC8",164,0)
 S $P(^MAG(2006.1,D0,"PACS"),"^",1)=1
"RTN","MAGDRPC8",165,0)
 ;
"RTN","MAGDRPC8",166,0)
 ; Number of days to retain "PACS" images
"RTN","MAGDRPC8",167,0)
 S X=$P($G(^MAG(2006.1,D0,1)),"^",5)
"RTN","MAGDRPC8",168,0)
 S:'X $P(^MAG(2006.1,D0,1),"^",5)=30
"RTN","MAGDRPC8",169,0)
 ;
"RTN","MAGDRPC8",170,0)
 ; Set minimum % of free disk space to trigger automatic file delete
"RTN","MAGDRPC8",171,0)
 S X=$P($G(^MAG(2006.1,D0,3)),"^",6)
"RTN","MAGDRPC8",172,0)
 S:'X $P(^MAG(2006.1,D0,3),"^",6)=25
"RTN","MAGDRPC8",173,0)
 S OUT=1
"RTN","MAGDRPC8",174,0)
 Q
"RTN","MAGDRPC8",175,0)
 ;
"RTN","MAGDRPC8",176,0)
HIGHHL7(OUT) ; RPC = MAG DICOM GET HIGHEST HL7
"RTN","MAGDRPC8",177,0)
 S OUT=+$O(^MAGDHL7(2006.5," "),-1)
"RTN","MAGDRPC8",178,0)
 Q
"RTN","MAGDRPC8",179,0)
 ;
"RTN","MAGDRPC8",180,0)
FINDLOC(OUT,NAME) ; RPC = MAG DICOM FIND LOCATION
"RTN","MAGDRPC8",181,0)
 N I,MAGM,P1,MAGR,X
"RTN","MAGDRPC8",182,0)
 S OUT="-1,Invalid location """_NAME_"""."
"RTN","MAGDRPC8",183,0)
 D FIND^DIC(4,"",.01,"BXA",NAME,"*","","","","MAGR","MAGM")
"RTN","MAGDRPC8",184,0)
 S I=0 F  S I=$O(MAGR("DILIST",2,I)) Q:'I  D
"RTN","MAGDRPC8",185,0)
 . S P1=MAGR("DILIST",2,I) I P1 K MAGR S OUT=P1
"RTN","MAGDRPC8",186,0)
 . Q
"RTN","MAGDRPC8",187,0)
 Q
"RTN","MAGDRPC8",188,0)
 ;
"RTN","MAGDRPC8",189,0)
VALIMGT(OUT) ; RPC = MAG DICOM GET IMAGING TYPES
"RTN","MAGDRPC8",190,0)
 N N,X
"RTN","MAGDRPC8",191,0)
 S N=1
"RTN","MAGDRPC8",192,0)
 ; Lists of valid imaging types
"RTN","MAGDRPC8",193,0)
 S X="" F  S X=$O(^RA(79.2,"C",X)) Q:X=""  S N=N+1,OUT(N)="RAD^"_X
"RTN","MAGDRPC8",194,0)
 S X="" F  S X=$O(^MAG(2005.84,"C",X)) Q:X=""  S N=N+1,OUT(N)="CON^"_X
"RTN","MAGDRPC8",195,0)
 S OUT(1)=N-1
"RTN","MAGDRPC8",196,0)
 Q
"RTN","MAGDRPC8",197,0)
 ;
"RTN","MAGDRPC8",198,0)
CORRECT(OUT,LOCATION,MACHID) ; RPC = MAG DICOM INCORRECT IMAGE CT
"RTN","MAGDRPC8",199,0)
 ; Check for images needing corrections
"RTN","MAGDRPC8",200,0)
 N CNT,D0,STUDY
"RTN","MAGDRPC8",201,0)
 I '$G(LOCATION) S OUT="-1,No Location Specified" Q
"RTN","MAGDRPC8",202,0)
 I $G(MACHID)="" S OUT="-2,No Gateway Specified" Q
"RTN","MAGDRPC8",203,0)
 S OUT=0
"RTN","MAGDRPC8",204,0)
 Q:'$O(^MAGD(2006.575,0))
"RTN","MAGDRPC8",205,0)
 Q:'$D(^MAGD(2006.575,"F",LOCATION))
"RTN","MAGDRPC8",206,0)
 S STUDY="" F  S STUDY=$O(^MAGD(2006.575,"F",LOCATION,STUDY)) Q:STUDY=""  D
"RTN","MAGDRPC8",207,0)
 . S D0=0 S D0=$O(^MAGD(2006.575,"F",LOCATION,STUDY,D0)) Q:'D0  D
"RTN","MAGDRPC8",208,0)
 . . Q:'$D(^MAGD(2006.575,D0,0))
"RTN","MAGDRPC8",209,0)
 . . S:MACHID=$P($G(^MAGD(2006.575,D0,1)),"^",4) OUT=OUT+1
"RTN","MAGDRPC8",210,0)
 . . Q
"RTN","MAGDRPC8",211,0)
 . Q
"RTN","MAGDRPC8",212,0)
 Q
"RTN","MAGDRPC8",213,0)
 ;
"RTN","MAGDRPC8",214,0)
HL7PTR(OUT,ACTION,VALUE) ; RPC = MAG DICOM HL7 POINTER ACTION
"RTN","MAGDRPC8",215,0)
 ; Manipulate HL7 Pointer
"RTN","MAGDRPC8",216,0)
 N D0,P1,P2,X,Y
"RTN","MAGDRPC8",217,0)
 S ACTION=$G(ACTION),VALUE=$G(VALUE)
"RTN","MAGDRPC8",218,0)
 S OUT="-2,Invalid Request: """_ACTION_"""."
"RTN","MAGDRPC8",219,0)
 I ACTION="GetDate" D  Q
"RTN","MAGDRPC8",220,0)
 . S X=$G(^MAGDHL7(2006.5,+VALUE,0))
"RTN","MAGDRPC8",221,0)
 . I X="" S OUT="-1,Invalid Pointer """_VALUE_"""." Q
"RTN","MAGDRPC8",222,0)
 . S OUT=$$FMTE^XLFDT($P(X,"^",3),1)
"RTN","MAGDRPC8",223,0)
 . Q
"RTN","MAGDRPC8",224,0)
 I ACTION="DatePtr" D  Q
"RTN","MAGDRPC8",225,0)
 . S Y=$O(^MAGDHL7(2006.5,"C",VALUE),-1)
"RTN","MAGDRPC8",226,0)
 . I 'Y D  ; before any date on file
"RTN","MAGDRPC8",227,0)
 . . ; if the requested date is before the first entry,
"RTN","MAGDRPC8",228,0)
 . . ; move the pointer to the first entry
"RTN","MAGDRPC8",229,0)
 . . S OUT=0
"RTN","MAGDRPC8",230,0)
 . . Q
"RTN","MAGDRPC8",231,0)
 . E  D  ; if the requested date is in the cross reference, use it.
"RTN","MAGDRPC8",232,0)
 . . S Y=$O(^MAGDHL7(2006.5,"C",Y,""))
"RTN","MAGDRPC8",233,0)
 . . I Y S OUT=Y ; found date
"RTN","MAGDRPC8",234,0)
 . . E  D
"RTN","MAGDRPC8",235,0)
 . . . ; otherwise, find the appropriate entry the hard way
"RTN","MAGDRPC8",236,0)
 . . . S D0=$O(^MAGDHL7(2006.5,0))
"RTN","MAGDRPC8",237,0)
 . . . S Y=$P($G(^MAGDHL7(2006.5,D0,0)),"^",3) I Y'<X S OUT=0 Q
"RTN","MAGDRPC8",238,0)
 . . . S D0=" " F  S D0=$O(^MAGDHL7(2006.5,D0),-1) Q:'D0  D  Q:OUT
"RTN","MAGDRPC8",239,0)
 . . . . S Y=$P($G(^MAGDHL7(2006.5,D0,0)),"^",3) S:Y<X OUT=D0
"RTN","MAGDRPC8",240,0)
 . . . . Q
"RTN","MAGDRPC8",241,0)
 . . . Q
"RTN","MAGDRPC8",242,0)
 . . Q
"RTN","MAGDRPC8",243,0)
 . Q
"RTN","MAGDRPC8",244,0)
 Q
"RTN","MAGDRPC8",245,0)
 ;
"RTN","MAGDRPC9")
0^45^B42474076
"RTN","MAGDRPC9",1,0)
MAGDRPC9 ;WOIFO/EdM - Imaging RPCs ; 11/30/2007 13:20
"RTN","MAGDRPC9",2,0)
 ;;3.0;IMAGING;**50,54**;03-July-2009;;Build 1424
"RTN","MAGDRPC9",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDRPC9",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC9",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRPC9",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRPC9",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRPC9",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRPC9",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRPC9",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRPC9",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRPC9",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRPC9",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRPC9",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRPC9",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRPC9",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC9",17,0)
 ;;
"RTN","MAGDRPC9",18,0)
 Q
"RTN","MAGDRPC9",19,0)
 ;
"RTN","MAGDRPC9",20,0)
UIDROOT(OUT) ; RPC = MAG DICOM GET UID ROOT
"RTN","MAGDRPC9",21,0)
 S OUT=$G(^MAGD(2006.15,1,"UID ROOT"))
"RTN","MAGDRPC9",22,0)
 Q
"RTN","MAGDRPC9",23,0)
 ;
"RTN","MAGDRPC9",24,0)
NEWUID(OUT,OLD,NEW,IMAGE) ; RPC = MAG NEW SOP INSTANCE UID
"RTN","MAGDRPC9",25,0)
 N D0,L,X
"RTN","MAGDRPC9",26,0)
 S IMAGE=+$G(IMAGE),OLD=$G(OLD)
"RTN","MAGDRPC9",27,0)
 S:$G(NEW)="" NEW=OLD
"RTN","MAGDRPC9",28,0)
 S D0=0 S:OLD'="" D0=$O(^MAG(2005,"P",OLD,""))
"RTN","MAGDRPC9",29,0)
 I IMAGE,D0,IMAGE'=D0 S OUT="-1,UID cannot belong to multiple images ("_IMAGE_"/"_D0_")" Q
"RTN","MAGDRPC9",30,0)
 I IMAGE,'D0 S D0=IMAGE
"RTN","MAGDRPC9",31,0)
 I 'D0 S OUT="-2,Cannot find image with UID "_OLD Q
"RTN","MAGDRPC9",32,0)
 S OUT=$P($G(^MAG(2005,D0,"SOP")),"^",2) Q:OUT'=""
"RTN","MAGDRPC9",33,0)
 S L=$L(NEW,".")-1,X=$P(NEW,".",L+1),L=$P(NEW,".",1,L)_"."
"RTN","MAGDRPC9",34,0)
 L +^MAG(2005,"P"):1E9 ; Background process MUST wait
"RTN","MAGDRPC9",35,0)
 S OUT="" F  D  Q:OUT'=""
"RTN","MAGDRPC9",36,0)
 . S OUT=L_X
"RTN","MAGDRPC9",37,0)
 . I $L(OUT)>64 S OUT="-3,Cannot use "_NEW_" to create valid UID" Q
"RTN","MAGDRPC9",38,0)
 . I $D(^MAG(2005,"P",OUT)) S OUT="",X=X+1 Q
"RTN","MAGDRPC9",39,0)
 . S $P(^MAG(2005,D0,"SOP"),"^",2)=OUT
"RTN","MAGDRPC9",40,0)
 . S ^MAG(2005,"P",OUT,D0)=1
"RTN","MAGDRPC9",41,0)
 . Q
"RTN","MAGDRPC9",42,0)
 L -^MAG(2005,"P")
"RTN","MAGDRPC9",43,0)
 Q
"RTN","MAGDRPC9",44,0)
 ;
"RTN","MAGDRPC9",45,0)
QRNEWUID(IMAGE) ; Get updated UID for Query/Retrieve
"RTN","MAGDRPC9",46,0)
 N DATE,DH,FAIL,I,OLD,OUT,NEW,LASTUID,NEXTUID,TIME,X,Y
"RTN","MAGDRPC9",47,0)
 S IMAGE=+$G(IMAGE)
"RTN","MAGDRPC9",48,0)
 S NEW=$P($G(^MAG(2005,IMAGE,"SOP")),"^",2)
"RTN","MAGDRPC9",49,0)
 Q:NEW'="" NEW  ; There already is a new UID
"RTN","MAGDRPC9",50,0)
 ; Generate the next UID using date/time and counter
"RTN","MAGDRPC9",51,0)
 L +^MAGDICOM(2006.563,1,"MACHINE ID"):1E9 ; Background process must wait
"RTN","MAGDRPC9",52,0)
 S LASTUID=$G(^MAGDICOM(2006.563,1,"LAST UID"))
"RTN","MAGDRPC9",53,0)
 ; Can't use D NOW^XLFDT to set DH because it is incorrect at midnight
"RTN","MAGDRPC9",54,0)
 S DH=$H,X=$$HTFM^XLFDT(DH,1),DATE=X+17000000
"RTN","MAGDRPC9",55,0)
 S X=$P(DH,",",2) D
"RTN","MAGDRPC9",56,0)
 . N H,M,S
"RTN","MAGDRPC9",57,0)
 . S H=X\3600,M=X\60#60,S=X#60
"RTN","MAGDRPC9",58,0)
 . S TIME=H*100+M*100+S
"RTN","MAGDRPC9",59,0)
 . Q
"RTN","MAGDRPC9",60,0)
 S NEXTUID=$G(^MAGD(2006.15,1,"UID ROOT"))
"RTN","MAGDRPC9",61,0)
 I NEXTUID="" S $EC=",13:No UID Root defined - Run INIT^MAGDRUID," ; Fatal Error
"RTN","MAGDRPC9",62,0)
 ; UID type = 7, Machine ID = 0
"RTN","MAGDRPC9",63,0)
 S NEXTUID=NEXTUID_".1.7."_(+$G(DUZ(2)))_".0."_DATE_"."_TIME_".0"
"RTN","MAGDRPC9",64,0)
 ; Remove leading 0s from UID components
"RTN","MAGDRPC9",65,0)
 F I=1:1:$L(NEXTUID,".") S $P(NEXTUID,".",I)=+$P(NEXTUID,".",I)
"RTN","MAGDRPC9",66,0)
 I $P(NEXTUID,".",1,10)=$P(LASTUID,".",1,10) D
"RTN","MAGDRPC9",67,0)
 . S NEXTUID=LASTUID
"RTN","MAGDRPC9",68,0)
 . S $P(NEXTUID,".",11)=$P(NEXTUID,".",11)+1
"RTN","MAGDRPC9",69,0)
 . Q
"RTN","MAGDRPC9",70,0)
 S ^MAGDICOM(2006.563,1,"LAST UID")=NEXTUID
"RTN","MAGDRPC9",71,0)
 L -^MAGDICOM(2006.563,1,"MACHINE ID")
"RTN","MAGDRPC9",72,0)
 S OLD=$P($G(^MAG(2005,IMAGE,"PACS")),"^",1)
"RTN","MAGDRPC9",73,0)
 D NEWUID(.OUT,OLD,NEXTUID,IMAGE) ; Store the new UID with the image
"RTN","MAGDRPC9",74,0)
 Q OUT
"RTN","MAGDRPC9",75,0)
 ;
"RTN","MAGDRPC9",76,0)
NEXT(OUT,SEED,DIR) ; RPC = MAG RAD GET NEXT RPT BY DATE
"RTN","MAGDRPC9",77,0)
 N D2,DFN,EXAMDATE,NAME
"RTN","MAGDRPC9",78,0)
 ;
"RTN","MAGDRPC9",79,0)
 ; ^RADPT(DFN,"DT",D1,"P",D2,0) = Data, $P(17) = pointer to report
"RTN","MAGDRPC9",80,0)
 ; ^RADPT("AR",9999999.9999-D1,DFN,D1)="" ; IA # 65
"RTN","MAGDRPC9",81,0)
 ;
"RTN","MAGDRPC9",82,0)
 ; OUT = report_pointer ^ ExamDate ^ Patient ^ D2
"RTN","MAGDRPC9",83,0)
 ;
"RTN","MAGDRPC9",84,0)
 S SEED=$G(SEED),DIR=$S($G(DIR)<0:-1,1:1) ; default is ascending order
"RTN","MAGDRPC9",85,0)
 S EXAMDATE=$P(SEED,"^",1),DFN=$P(SEED,"^",2),D2=$P(SEED,"^",3)
"RTN","MAGDRPC9",86,0)
 S OUT=0 F  D  Q:OUT
"RTN","MAGDRPC9",87,0)
 . I EXAMDATE="" S EXAMDATE=$O(^RADPT("AR",""),DIR),DFN="" ; IA # 65
"RTN","MAGDRPC9",88,0)
 . I EXAMDATE="" S OUT=-1 Q
"RTN","MAGDRPC9",89,0)
 . I DFN="" S DFN=$O(^RADPT("AR",EXAMDATE,""),DIR) ; IA # 65
"RTN","MAGDRPC9",90,0)
 . I DFN="" S EXAMDATE=$O(^RADPT("AR",EXAMDATE),DIR),D2="" Q  ; IA # 65
"RTN","MAGDRPC9",91,0)
 . S:'D2 D2=$S(DIR>0:0,1:" ")
"RTN","MAGDRPC9",92,0)
 . S D2=$O(^RADPT(DFN,"DT",9999999.9999-EXAMDATE,"P",D2),DIR) ; IA # 1172
"RTN","MAGDRPC9",93,0)
 . I 'D2 D  Q
"RTN","MAGDRPC9",94,0)
 . . S DFN=$O(^RADPT("AR",EXAMDATE,DFN),DIR),D2="" ; IA # 65
"RTN","MAGDRPC9",95,0)
 . . I 'DFN D
"RTN","MAGDRPC9",96,0)
 . . . S EXAMDATE=$O(^RADPT("AR",EXAMDATE),DIR),DFN="" ; IA # 65
"RTN","MAGDRPC9",97,0)
 . . . I EXAMDATE="" S OUT=-1
"RTN","MAGDRPC9",98,0)
 . . . Q
"RTN","MAGDRPC9",99,0)
 . . Q
"RTN","MAGDRPC9",100,0)
 . S OUT=$P($G(^RADPT(DFN,"DT",9999999.9999-EXAMDATE,"P",D2,0)),"^",17) ; IA # 1172
"RTN","MAGDRPC9",101,0)
 . S:OUT OUT=OUT_"^"_EXAMDATE_"^"_DFN_"^"_D2
"RTN","MAGDRPC9",102,0)
 . Q
"RTN","MAGDRPC9",103,0)
 Q
"RTN","MAGDRPC9",104,0)
 ;
"RTN","MAGDRPC9",105,0)
NXTPTRPT(OUT,DFN,RARPT1,DIR) ; RPC = MAG RAD GET NEXT RPT BY PT
"RTN","MAGDRPC9",106,0)
 S DFN=$G(DFN)
"RTN","MAGDRPC9",107,0)
 I 'DFN S OUT="-1,Patient DFN not passed" Q
"RTN","MAGDRPC9",108,0)
 I '$D(^RARPT("C",DFN)) S OUT="-2,Patient does not have any radiology reports" Q  ; IA # 2442
"RTN","MAGDRPC9",109,0)
 S RARPT1=$G(RARPT1),DIR=$S($G(DIR)<0:-1,1:1) ; default is ascending order
"RTN","MAGDRPC9",110,0)
 S OUT=$O(^RARPT("C",DFN,RARPT1),DIR) ; IA # 2442
"RTN","MAGDRPC9",111,0)
 Q
"RTN","MAGDRPC9",112,0)
 ;
"RTN","MAGDRPC9",113,0)
GETICN(OUT,DFN) ; RPC = MAG DICOM GET ICN
"RTN","MAGDRPC9",114,0)
 S OUT=$$GETICN^MPIF001(DFN)
"RTN","MAGDRPC9",115,0)
 Q
"RTN","MAGDRPC9",116,0)
 ;
"RTN","MAGDRPC9",117,0)
CLEAN ; Overflow from MAGDRPC4
"RTN","MAGDRPC9",118,0)
 N STUID
"RTN","MAGDRPC9",119,0)
 S S0=$P(SENT(I),"^",1),S1=$P(SENT(I),"^",2)
"RTN","MAGDRPC9",120,0)
 Q:'$D(^MAGDOUTP(2006.574,S0,1,S1))
"RTN","MAGDRPC9",121,0)
 L +^MAGDOUTP(2006.574,S0,1,0):1E9 ; Background process MUST wait
"RTN","MAGDRPC9",122,0)
 S X=$G(^MAGDOUTP(2006.574,S0,0)),LOC=$P(X,"^",4),PRI=+$P(X,"^",5)
"RTN","MAGDRPC9",123,0)
 S STS=$P($G(^MAGDOUTP(2006.574,S0,1,S1,0)),"^",2)
"RTN","MAGDRPC9",124,0)
 K ^MAGDOUTP(2006.574,S0,1,S1)
"RTN","MAGDRPC9",125,0)
 I LOC'="",STS'="" K ^MAGDOUTP(2006.574,"STS",LOC,PRI,STS,S0,S1)
"RTN","MAGDRPC9",126,0)
 S X=$G(^MAGDOUTP(2006.574,S0,1,0))
"RTN","MAGDRPC9",127,0)
 S $P(X,"^",4)=$P(X,"^",4)-1
"RTN","MAGDRPC9",128,0)
 S ^MAGDOUTP(2006.574,S0,1,0)=X
"RTN","MAGDRPC9",129,0)
 L -^MAGDOUTP(2006.574,S0,1,0)
"RTN","MAGDRPC9",130,0)
 Q:$O(^MAGDOUTP(2006.574,S0,1,0))
"RTN","MAGDRPC9",131,0)
 L +^MAGDOUTP(2006.574,0):1E9 ; Background process MUST wait
"RTN","MAGDRPC9",132,0)
 S STUID=$G(^MAGDOUTP(2006.574,S0,2))
"RTN","MAGDRPC9",133,0)
 K ^MAGDOUTP(2006.574,S0)
"RTN","MAGDRPC9",134,0)
 K:STUID'="" ^MAGDOUTP(2006.574,"STUDY",STUID)
"RTN","MAGDRPC9",135,0)
 S X=$G(^MAGDOUTP(2006.574,0))
"RTN","MAGDRPC9",136,0)
 S $P(X,"^",4)=$P(X,"^",4)-1
"RTN","MAGDRPC9",137,0)
 S ^MAGDOUTP(2006.574,0)=X
"RTN","MAGDRPC9",138,0)
 L -^MAGDOUTP(2006.574,0)
"RTN","MAGDRPC9",139,0)
 Q
"RTN","MAGDRPC9",140,0)
 ;
"RTN","MAGDRPC9",141,0)
IENLOOK ; Overflow from MAGDRPC4
"RTN","MAGDRPC9",142,0)
 ; lookup image by the IEN
"RTN","MAGDRPC9",143,0)
 N D0,GROUPIEN,P,X
"RTN","MAGDRPC9",144,0)
 S NUMBER=+$P(NUMBER,"`",2)
"RTN","MAGDRPC9",145,0)
 ; patient safety checks
"RTN","MAGDRPC9",146,0)
 D CHK^MAGGSQI(.X,NUMBER) I +$G(X(0))'=1 D  Q
"RTN","MAGDRPC9",147,0)
 . S OUT(1)="-9,"_$P(X(0),"^",2,999)
"RTN","MAGDRPC9",148,0)
 . Q
"RTN","MAGDRPC9",149,0)
 S GROUPIEN=$P($G(^MAG(2005,NUMBER,0)),"^",10)
"RTN","MAGDRPC9",150,0)
 I GROUPIEN D CHK^MAGGSQI(.X,GROUPIEN) I +$G(X(0))'=1 D  Q
"RTN","MAGDRPC9",151,0)
 . S OUT(1)="-10,Group #"_GROUPIEN_": "_$P(X(0),"^",2,999)
"RTN","MAGDRPC9",152,0)
 . Q
"RTN","MAGDRPC9",153,0)
 ;
"RTN","MAGDRPC9",154,0)
 S X=$G(^MAG(2005,NUMBER,2)),P=$P(X,"^",6),D0=$P(X,"^",7)
"RTN","MAGDRPC9",155,0)
 I 'P!'D0 D  ; get parent from group
"RTN","MAGDRPC9",156,0)
 . S:GROUPIEN X=$G(^MAG(2005,GROUPIEN,2)),P=$P(X,"^",6),D0=$P(X,"^",7)
"RTN","MAGDRPC9",157,0)
 . Q
"RTN","MAGDRPC9",158,0)
 ;
"RTN","MAGDRPC9",159,0)
 S OUT(2)=P_"^"_D0_"^"_NUMBER_"^" ; result w/o Accession Number
"RTN","MAGDRPC9",160,0)
 I 'P!'D0 S OUT(1)="-6,Warning - Parent file entry is not present - no Accession Number."
"RTN","MAGDRPC9",161,0)
 E  I P=74 D
"RTN","MAGDRPC9",162,0)
 . S X=P_"^"_D0_"^"_NUMBER_"^"_$P($G(^RARPT(D0,0)),"^",1) ; IA # 1171
"RTN","MAGDRPC9",163,0)
 . S OUT(1)=1,OUT(2)=X
"RTN","MAGDRPC9",164,0)
 . Q
"RTN","MAGDRPC9",165,0)
 E  I P=8925 D
"RTN","MAGDRPC9",166,0)
 . ; get pointer from TIU to consult request
"RTN","MAGDRPC9",167,0)
 . S X=$$GET1^DIQ(8925,D0,1405,"I") ; IA ???
"RTN","MAGDRPC9",168,0)
 . I $P(X,";",2)="GMR(123," D
"RTN","MAGDRPC9",169,0)
 . . S X=P_"^"_D0_"^"_NUMBER_"^GMRC-"_$P(X,";")
"RTN","MAGDRPC9",170,0)
 . . S OUT(1)=1,OUT(2)=X
"RTN","MAGDRPC9",171,0)
 . . Q
"RTN","MAGDRPC9",172,0)
 . E  S OUT(1)="-8,Problem with parent file "_P_", internal entry number "_D0_" - no Accession Number."
"RTN","MAGDRPC9",173,0)
 . Q
"RTN","MAGDRPC9",174,0)
 E  S OUT(1)="-7,Parent file "_P_" not yet supported - no Accession Number."
"RTN","MAGDRPC9",175,0)
 Q
"RTN","MAGDRPC9",176,0)
 ;
"RTN","MAGDRUID")
0^46^B4273247
"RTN","MAGDRUID",1,0)
MAGDRUID ;WOIFO/PMK - Program to read a DICOM file ; 04/23/2007 14:43
"RTN","MAGDRUID",2,0)
 ;;3.0;IMAGING;**54**;03-July-2009;;Build 1424
"RTN","MAGDRUID",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDRUID",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRUID",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRUID",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRUID",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRUID",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRUID",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRUID",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRUID",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRUID",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRUID",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRUID",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRUID",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRUID",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRUID",17,0)
 ;;
"RTN","MAGDRUID",18,0)
 ; Attention!
"RTN","MAGDRUID",19,0)
 ; ----------
"RTN","MAGDRUID",20,0)
 ; This routine is solely for the use of the VA and is not to be
"RTN","MAGDRUID",21,0)
 ; included in a FOIA Act distribution.
"RTN","MAGDRUID",22,0)
 ; 
"RTN","MAGDRUID",23,0)
 ;
"RTN","MAGDRUID",24,0)
INIT ; run this to initialize the VA's UID root
"RTN","MAGDRUID",25,0)
 ; This sets the UID ROOT for the U.S. Department of Veterans Affairs.
"RTN","MAGDRUID",26,0)
 ; Other organizations using this code (IHS, FOIA, etc.) may not use
"RTN","MAGDRUID",27,0)
 ; this UID ROOT but need to obtain one for themselves.  See the DICOM
"RTN","MAGDRUID",28,0)
 ; standard (www.nema.org/dicom) PS 3.8 Annex A for instructions on how
"RTN","MAGDRUID",29,0)
 ; to do this.
"RTN","MAGDRUID",30,0)
 ;
"RTN","MAGDRUID",31,0)
 K ^MAGD(2006.15)
"RTN","MAGDRUID",32,0)
 S ^MAGD(2006.15,0)="DICOM UID ROOT^2006.15^1^1"
"RTN","MAGDRUID",33,0)
 S ^MAGD(2006.15,1,0)="<Your Agency Name goes Here>"
"RTN","MAGDRUID",34,0)
 S ^MAGD(2006.15,1,"UID ROOT")="<Your Agency UID Root goes Here>"
"RTN","MAGDRUID",35,0)
 S ^MAGD(2006.15,"B","<Your Agency Name goes Here>",1)=""
"RTN","MAGDRUID",36,0)
 Q
"RTN","MAGDRUID",37,0)
 ;
"RTN","MAGDTR02")
0^47^B34307133
"RTN","MAGDTR02",1,0)
MAGDTR02 ;WOIFO/PMK - Unread List for Consult/Procedure Request ; 05/18/2007 11:23
"RTN","MAGDTR02",2,0)
 ;;3.0;IMAGING;**46,54**;03-July-2009;;Build 1424
"RTN","MAGDTR02",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDTR02",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDTR02",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDTR02",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDTR02",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDTR02",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDTR02",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDTR02",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDTR02",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDTR02",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDTR02",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDTR02",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDTR02",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDTR02",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDTR02",17,0)
 ;;
"RTN","MAGDTR02",18,0)
FORWARD ; entry point from ^MAGDT01 for a FORWARD request
"RTN","MAGDTR02",19,0)
 N FWDFROM ;-- forwarded from service
"RTN","MAGDTR02",20,0)
 N ISPECIDX ;- index to specialties - read/unread list sort key
"RTN","MAGDTR02",21,0)
 N IPROCIDX ;- index to procedures - read/unread list sort key (may be null)
"RTN","MAGDTR02",22,0)
 N LISTDATA ;- read/unread list data
"RTN","MAGDTR02",23,0)
 N UNREAD ;--- pointer to an entry in the read/unread list
"RTN","MAGDTR02",24,0)
 N OUNREAD,NUNREAD ; old and new unread list dictionary pointers
"RTN","MAGDTR02",25,0)
 N OACQSITE,NACQSITE ; old and new unread list acquisition sites
"RTN","MAGDTR02",26,0)
 N OPROCIDX,NPROCIDX ; old and new unread list procedure indexes
"RTN","MAGDTR02",27,0)
 N OSPECIDX,NSPECIDX ; old and new unread list specialty indexes
"RTN","MAGDTR02",28,0)
 N NEWENTRY ; - pointer to new entry in unread list
"RTN","MAGDTR02",29,0)
 N I,X
"RTN","MAGDTR02",30,0)
 ;
"RTN","MAGDTR02",31,0)
 ; get previous service from REQUEST PROCESSING ACTIVITY
"RTN","MAGDTR02",32,0)
 S FWDFROM=$$FWDFROM^MAGDGMRC(GMRCIEN) ; FORWARDED FROM service
"RTN","MAGDTR02",33,0)
 S OUNREAD=$$FINDLIST^MAGDTR01(GMRCIEN,.OSPECIDX,.OPROCIDX,.OACQSITE,,,FWDFROM)
"RTN","MAGDTR02",34,0)
 S NUNREAD=$$FINDLIST^MAGDTR01(GMRCIEN,.NSPECIDX,.NPROCIDX,.NACQSITE)
"RTN","MAGDTR02",35,0)
 ;
"RTN","MAGDTR02",36,0)
 I 'OUNREAD,'NUNREAD Q  ; neither old nor new TO SERVICE have unread lists
"RTN","MAGDTR02",37,0)
 ;
"RTN","MAGDTR02",38,0)
 I 'OUNREAD,NUNREAD D  Q  ; only new TO SERVICE has an unread list
"RTN","MAGDTR02",39,0)
 . N D0,IMAGECNT,MAGIEN,TRIGGER
"RTN","MAGDTR02",40,0)
 . S IMAGECNT=0
"RTN","MAGDTR02",41,0)
 . ; count the number of images, if any
"RTN","MAGDTR02",42,0)
 . S D0="" F  S D0=$O(^MAG(2006.5839,"C",123,GMRCIEN,D0)) Q:'D0  D
"RTN","MAGDTR02",43,0)
 . . S MAGIEN=$P($G(^MAG(2006.5839,D0,0)),"^",3)
"RTN","MAGDTR02",44,0)
 . . I MAGIEN D  ; make sure you got a good group pointer
"RTN","MAGDTR02",45,0)
 . . . ; get #images from Object Group file (2005.04)
"RTN","MAGDTR02",46,0)
 . . . S IMAGECNT=IMAGECNT+$P($G(^MAG(2005,MAGIEN,1,0)),"^",4)
"RTN","MAGDTR02",47,0)
 . . . Q
"RTN","MAGDTR02",48,0)
 . . Q
"RTN","MAGDTR02",49,0)
 . S TRIGGER=$S(IMAGECNT:"I",1:"")_"OF"
"RTN","MAGDTR02",50,0)
 . ; create the new unread list entry
"RTN","MAGDTR02",51,0)
 . D ADD^MAGDTR03(.NEWENTRY,GMRCIEN,TRIGGER,IMAGECNT)
"RTN","MAGDTR02",52,0)
 . Q
"RTN","MAGDTR02",53,0)
 ;
"RTN","MAGDTR02",54,0)
 I OUNREAD,'NUNREAD D  Q  ; only old TO SERVICE has an unread list
"RTN","MAGDTR02",55,0)
 . S UNREAD=$$UNREAD^MAGDTR02(GMRCIEN)
"RTN","MAGDTR02",56,0)
 . S X=$$STATUPDT^MAGDTR02(UNREAD,"D") ; set status of old entry to DELETE
"RTN","MAGDTR02",57,0)
 . Q
"RTN","MAGDTR02",58,0)
 ;
"RTN","MAGDTR02",59,0)
 ; both the old TO SERVICE and the new TO SERVICE have unread lists
"RTN","MAGDTR02",60,0)
 ; 
"RTN","MAGDTR02",61,0)
 ; are the old and new unread lists the same?
"RTN","MAGDTR02",62,0)
 ;
"RTN","MAGDTR02",63,0)
 S UNREAD=$$UNREAD^MAGDTR02(GMRCIEN)
"RTN","MAGDTR02",64,0)
 I OACQSITE=NACQSITE,OSPECIDX=NSPECIDX,OPROCIDX=NPROCIDX D  Q
"RTN","MAGDTR02",65,0)
 . ; exactly the same unread lists for old and new TO SERVICES
"RTN","MAGDTR02",66,0)
 . I UNREAD S X=$$TIMESTMP^MAGDTR02(UNREAD) ; update the timestamp
"RTN","MAGDTR02",67,0)
 . Q
"RTN","MAGDTR02",68,0)
 ;
"RTN","MAGDTR02",69,0)
 ; different unread lists for old and new TO SERVICES
"RTN","MAGDTR02",70,0)
 ;
"RTN","MAGDTR02",71,0)
 ; is there an old unread list?
"RTN","MAGDTR02",72,0)
 S LISTDATA=$S(UNREAD:$G(^MAG(2006.5849,UNREAD,0)),1:"")
"RTN","MAGDTR02",73,0)
 I LISTDATA="" D  Q  ; no old unread list
"RTN","MAGDTR02",74,0)
 . D ADD^MAGDTR03(.NEWENTRY,GMRCIEN,"OF") ; create the new unread list entry
"RTN","MAGDTR02",75,0)
 . Q
"RTN","MAGDTR02",76,0)
 ;
"RTN","MAGDTR02",77,0)
 ; there is an old unread list entry
"RTN","MAGDTR02",78,0)
 ; create the new unread list and copy the data from the old unread list entry
"RTN","MAGDTR02",79,0)
 S X=$$STATUPDT^MAGDTR02(UNREAD,"D")
"RTN","MAGDTR02",80,0)
 D ADD^MAGDTR03(.NEWENTRY,GMRCIEN,"IOF") Q:'NEWENTRY  ; create the new unread list entry
"RTN","MAGDTR02",81,0)
 F I=7,8,10 D  ; copy acquisition start, next acquisition, and number of images
"RTN","MAGDTR02",82,0)
 . S $P(^MAG(2006.5849,NEWENTRY,0),"^",I)=$P(^MAG(2006.5849,UNREAD,0),"^",I)
"RTN","MAGDTR02",83,0)
 . Q
"RTN","MAGDTR02",84,0)
 Q
"RTN","MAGDTR02",85,0)
 ;
"RTN","MAGDTR02",86,0)
 ;
"RTN","MAGDTR02",87,0)
 ; common functions
"RTN","MAGDTR02",88,0)
 ;
"RTN","MAGDTR02",89,0)
UNREAD(GMRCIEN) ; look up unread list internal entry number
"RTN","MAGDTR02",90,0)
 N HIT,LISTDATA,UNREAD,STATUS
"RTN","MAGDTR02",91,0)
 Q:'$G(GMRCIEN) ""
"RTN","MAGDTR02",92,0)
 S UNREAD="",HIT=0
"RTN","MAGDTR02",93,0)
 F  S UNREAD=$O(^MAG(2006.5849,"B",GMRCIEN,UNREAD)) Q:'UNREAD  D  Q:HIT
"RTN","MAGDTR02",94,0)
 . S LISTDATA=$G(^MAG(2006.5849,UNREAD,0))
"RTN","MAGDTR02",95,0)
 . S STATUS=$P(LISTDATA,"^",11)
"RTN","MAGDTR02",96,0)
 . I STATUS'="D" S HIT=1 ; ignore deleted entries
"RTN","MAGDTR02",97,0)
 . Q
"RTN","MAGDTR02",98,0)
 Q UNREAD
"RTN","MAGDTR02",99,0)
 ;
"RTN","MAGDTR02",100,0)
STATUPDT(UNREAD,STATUS) ; update the status
"RTN","MAGDTR02",101,0)
 N ACQSITE,IPROCIDX,ISPECIDX,OSTATUS,LISTDATA,TIMESTMP
"RTN","MAGDTR02",102,0)
 S TIMESTMP=0
"RTN","MAGDTR02",103,0)
 I $G(UNREAD),$G(STATUS)'="",$D(^MAG(2006.5849,UNREAD,0)) D
"RTN","MAGDTR02",104,0)
 . S LISTDATA=$G(^MAG(2006.5849,UNREAD,0))
"RTN","MAGDTR02",105,0)
 . S ACQSITE=$P(LISTDATA,"^",2) Q:ACQSITE=""
"RTN","MAGDTR02",106,0)
 . S ISPECIDX=$P(LISTDATA,"^",3) Q:ISPECIDX=""
"RTN","MAGDTR02",107,0)
 . S IPROCIDX=$P(LISTDATA,"^",4) Q:IPROCIDX=""
"RTN","MAGDTR02",108,0)
 . S OSTATUS=$P(LISTDATA,"^",11) Q:OSTATUS=""
"RTN","MAGDTR02",109,0)
 . K ^MAG(2006.5849,"D",ACQSITE,ISPECIDX,IPROCIDX,OSTATUS,UNREAD)
"RTN","MAGDTR02",110,0)
 . S $P(^MAG(2006.5849,UNREAD,0),"^",11)=STATUS
"RTN","MAGDTR02",111,0)
 . S ^MAG(2006.5849,"D",ACQSITE,ISPECIDX,IPROCIDX,STATUS,UNREAD)=""
"RTN","MAGDTR02",112,0)
 . S TIMESTMP=$$TIMESTMP^MAGDTR02(UNREAD) ; update time stamp piece of last activity
"RTN","MAGDTR02",113,0)
 . Q
"RTN","MAGDTR02",114,0)
 Q TIMESTMP
"RTN","MAGDTR02",115,0)
 ; 
"RTN","MAGDTR02",116,0)
TIMESTMP(UNREAD) ; update the transaction's timestamp and cross-reference
"RTN","MAGDTR02",117,0)
 N ACQSITE ;-- acquisition site
"RTN","MAGDTR02",118,0)
 N NEWTIME ;-- time stamp of the current transaction
"RTN","MAGDTR02",119,0)
 N OLDTIME ;-- time stamp of the previous transaction
"RTN","MAGDTR02",120,0)
 N LISTDATA ;- read/unread list data
"RTN","MAGDTR02",121,0)
 N ISPECIDX ;- index to specialties - read/unread list sort key
"RTN","MAGDTR02",122,0)
 N IPROCIDX ;- index to procedures - read/unread list sort key (may be null)
"RTN","MAGDTR02",123,0)
 Q:'$G(UNREAD) ""
"RTN","MAGDTR02",124,0)
 S NEWTIME=$$NOW^XLFDT()
"RTN","MAGDTR02",125,0)
 L +^MAG(2006.5849,UNREAD):1E9
"RTN","MAGDTR02",126,0)
 S LISTDATA=^MAG(2006.5849,UNREAD,0)
"RTN","MAGDTR02",127,0)
 S ACQSITE=$P(LISTDATA,"^",2) I ACQSITE="" Q 0
"RTN","MAGDTR02",128,0)
 S ISPECIDX=$P(LISTDATA,"^",3) I ISPECIDX="" Q 0
"RTN","MAGDTR02",129,0)
 S IPROCIDX=$P(LISTDATA,"^",4) I IPROCIDX="" Q 0
"RTN","MAGDTR02",130,0)
 S OLDTIME=$P(LISTDATA,"^",9)
"RTN","MAGDTR02",131,0)
 I ACQSITE'="",ISPECIDX'="",IPROCIDX'="" D
"RTN","MAGDTR02",132,0)
 . K:OLDTIME ^MAG(2006.5849,"AC",ACQSITE,ISPECIDX,IPROCIDX,OLDTIME,UNREAD)
"RTN","MAGDTR02",133,0)
 . S ^MAG(2006.5849,"AC",ACQSITE,ISPECIDX,IPROCIDX,NEWTIME,UNREAD)=""
"RTN","MAGDTR02",134,0)
 . Q
"RTN","MAGDTR02",135,0)
 S $P(^MAG(2006.5849,UNREAD,0),"^",9)=NEWTIME
"RTN","MAGDTR02",136,0)
 L -^MAG(2006.5849,UNREAD)
"RTN","MAGDTR02",137,0)
 Q NEWTIME
"RTN","MAGDTR03")
0^48^B73363614
"RTN","MAGDTR03",1,0)
MAGDTR03 ;WOIFO/PMK - Read a DICOM image file ; 30 Oct 2008 3:21 PM
"RTN","MAGDTR03",2,0)
 ;;3.0;IMAGING;**46,54**;03-July-2009;;Build 1424
"RTN","MAGDTR03",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDTR03",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDTR03",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDTR03",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDTR03",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDTR03",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDTR03",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDTR03",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDTR03",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDTR03",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDTR03",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDTR03",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDTR03",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDTR03",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDTR03",17,0)
 ;;
"RTN","MAGDTR03",18,0)
 ;
"RTN","MAGDTR03",19,0)
ADD(OUT,GMRCIEN,EVENT,IMAGECNT) ; add an entry to the read/unread list
"RTN","MAGDTR03",20,0)
 N ACQSITE ;-- the site where the images were acquired
"RTN","MAGDTR03",21,0)
 N IFCIEN ;--- the IEN of the IFC consult at the reading site
"RTN","MAGDTR03",22,0)
 N IFCSITE ;-- 0 if not IFC
"RTN","MAGDTR03",23,0)
 N ISPECIDX ;- index to specialties - read/unread list sort key
"RTN","MAGDTR03",24,0)
 N IPROCIDX ;- index to procedures - read/unread list sort key (may be null)
"RTN","MAGDTR03",25,0)
 N STATUS ;--- status of unread list entry (Unread or Waiting)
"RTN","MAGDTR03",26,0)
 N TIMESTMP ;- FM date/time
"RTN","MAGDTR03",27,0)
 N TRIGGER ;-- create unread list trigger: Forward, Image, or Order
"RTN","MAGDTR03",28,0)
 N UNREAD ;-- pointer to entry in unread list
"RTN","MAGDTR03",29,0)
 N X
"RTN","MAGDTR03",30,0)
 ; should this consult be added to the Unread List?
"RTN","MAGDTR03",31,0)
 S OUT=0 ; return variable
"RTN","MAGDTR03",32,0)
 Q:$G(EVENT)=""  ; nope, an event F, I, or O must be specified
"RTN","MAGDTR03",33,0)
 Q:$$FINDLIST^MAGDTR01(GMRCIEN,.ISPECIDX,.IPROCIDX,.ACQSITE,.TRIGGER)<1
"RTN","MAGDTR03",34,0)
 S IMAGECNT=+$G(IMAGECNT) ; count of images
"RTN","MAGDTR03",35,0)
 ;
"RTN","MAGDTR03",36,0)
 S UNREAD=$$UNREAD^MAGDTR02(GMRCIEN)
"RTN","MAGDTR03",37,0)
 I UNREAD="",EVENT'[TRIGGER Q  ; nope, don't create it now
"RTN","MAGDTR03",38,0)
 ;
"RTN","MAGDTR03",39,0)
 ; get IFC information
"RTN","MAGDTR03",40,0)
 S IFCSITE=$$GET1^DIQ(123,GMRCIEN,.07,"I") ; Routing Facility
"RTN","MAGDTR03",41,0)
 S IFCIEN=$$GET1^DIQ(123,GMRCIEN,.06,"I") ; remote consult file entry
"RTN","MAGDTR03",42,0)
 ;
"RTN","MAGDTR03",43,0)
 I UNREAD="" D  ; add record to the unread list
"RTN","MAGDTR03",44,0)
 . N X
"RTN","MAGDTR03",45,0)
 . L +^MAG(2006.5849,0):1E9 ; serial generation
"RTN","MAGDTR03",46,0)
 . S UNREAD=$O(^MAG(2006.5849," "),-1)+1 ; get next IEN
"RTN","MAGDTR03",47,0)
 . L +^MAG(2006.5849,UNREAD):1E9
"RTN","MAGDTR03",48,0)
 . S X=$G(^MAG(2006.5849,0))
"RTN","MAGDTR03",49,0)
 . S X="TELEREADER READ/UNREAD LIST^2006.5849^"_UNREAD_"^"_($P(X,"^",4)+1)
"RTN","MAGDTR03",50,0)
 . S ^MAG(2006.5849,0)=X
"RTN","MAGDTR03",51,0)
 . S ^MAG(2006.5849,UNREAD,0)=GMRCIEN_"^"_ACQSITE_"^"_ISPECIDX_"^"_IPROCIDX
"RTN","MAGDTR03",52,0)
 . L -^MAG(2006.5849,0) ; end serial generation
"RTN","MAGDTR03",53,0)
 . S TIMESTMP=$$TIMESTMP^MAGDTR02(UNREAD)
"RTN","MAGDTR03",54,0)
 . S $P(^MAG(2006.5849,UNREAD,0),"^",7)=TIMESTMP ; acquisition start d/t
"RTN","MAGDTR03",55,0)
 . S ^MAG(2006.5849,"B",GMRCIEN,UNREAD)=""
"RTN","MAGDTR03",56,0)
 . ;
"RTN","MAGDTR03",57,0)
 . ; set status -- if unpaired IFC, status="Waiting", otherwise "Unread"
"RTN","MAGDTR03",58,0)
 . S STATUS=$S(IFCSITE&'IFCIEN:"W",1:"U")
"RTN","MAGDTR03",59,0)
 . S $P(^MAG(2006.5849,UNREAD,0),"^",11)=STATUS
"RTN","MAGDTR03",60,0)
 . S ^MAG(2006.5849,"D",ACQSITE,ISPECIDX,IPROCIDX,STATUS,UNREAD)=""
"RTN","MAGDTR03",61,0)
 . L -^MAG(2006.5849,UNREAD)
"RTN","MAGDTR03",62,0)
 . Q
"RTN","MAGDTR03",63,0)
 E  D
"RTN","MAGDTR03",64,0)
 . S TIMESTMP=$$TIMESTMP^MAGDTR02(UNREAD) ; update d/t piece of last activity
"RTN","MAGDTR03",65,0)
 . Q
"RTN","MAGDTR03",66,0)
 ;
"RTN","MAGDTR03",67,0)
 I IFCSITE D  ; record the IFC remote site times, if they are not set
"RTN","MAGDTR03",68,0)
 . ; save time the entry is added to the unread list, if not set
"RTN","MAGDTR03",69,0)
 . I $P($G(^MAG(2006.5849,UNREAD,0)),"^",5)="" S $P(^(0),"^",5)=TIMESTMP
"RTN","MAGDTR03",70,0)
 . I IFCIEN D
"RTN","MAGDTR03",71,0)
 . . ; IFC remote consult already created - save same time, if not set
"RTN","MAGDTR03",72,0)
 . . I $P($G(^MAG(2006.5849,UNREAD,0)),"^",6)="" S $P(^(0),"^",6)=TIMESTMP
"RTN","MAGDTR03",73,0)
 . . Q
"RTN","MAGDTR03",74,0)
 . Q
"RTN","MAGDTR03",75,0)
 ;
"RTN","MAGDTR03",76,0)
 I IMAGECNT D
"RTN","MAGDTR03",77,0)
 . S $P(^MAG(2006.5849,UNREAD,0),"^",8)=TIMESTMP ; last acquisition d/t
"RTN","MAGDTR03",78,0)
 . S $P(^(0),"^",10)=$P(^MAG(2006.5849,UNREAD,0),"^",10)+IMAGECNT
"RTN","MAGDTR03",79,0)
 . Q
"RTN","MAGDTR03",80,0)
 ;
"RTN","MAGDTR03",81,0)
 S OUT=UNREAD
"RTN","MAGDTR03",82,0)
 Q
"RTN","MAGDTR03",83,0)
 ;
"RTN","MAGDTR03",84,0)
COMPLETE ; entry point from ^MAGDTR01 & ^MAGDTRLU for COMPLETED consults
"RTN","MAGDTR03",85,0)
 N LOCATION,MAGPTR,TIMESTMP,UNREAD
"RTN","MAGDTR03",86,0)
 S UNREAD=$$UNREAD^MAGDTR02(GMRCIEN)
"RTN","MAGDTR03",87,0)
 S TIMESTMP=$$STATUPDT^MAGDTR02(UNREAD,"R")
"RTN","MAGDTR03",88,0)
 I TIMESTMP D  ; changed status to Resulted
"RTN","MAGDTR03",89,0)
 . D FINISH ; record who updated the consult
"RTN","MAGDTR03",90,0)
 . ; check if there is an image
"RTN","MAGDTR03",91,0)
 . S MAGPTR=$O(^MAG(2006.5839,"C",123,GMRCIEN,0))
"RTN","MAGDTR03",92,0)
 . I MAGPTR,'$$TIULAST^MAGDGMRC(GMRCIEN) D
"RTN","MAGDTR03",93,0)
 . . ; there is an image but no TIU note
"RTN","MAGDTR03",94,0)
 . . D TIUNOTE ; create a TIU note for the image
"RTN","MAGDTR03",95,0)
 . . Q
"RTN","MAGDTR03",96,0)
 . Q
"RTN","MAGDTR03",97,0)
 Q
"RTN","MAGDTR03",98,0)
 ;
"RTN","MAGDTR03",99,0)
CANCEL ; entry point from ^MAGDTR01 & ^MAGDTRLU for CANCELLED consults
"RTN","MAGDTR03",100,0)
 N TIMESTMP,UNREAD
"RTN","MAGDTR03",101,0)
 S UNREAD=$$UNREAD^MAGDTR02(GMRCIEN)
"RTN","MAGDTR03",102,0)
 S TIMESTMP=$$STATUPDT^MAGDTR02(UNREAD,"C")
"RTN","MAGDTR03",103,0)
 I TIMESTMP D  ; changed status to Cancelled
"RTN","MAGDTR03",104,0)
 . ; remove any old data about the reading activities
"RTN","MAGDTR03",105,0)
 . S $P(^MAG(2006.5849,UNREAD,0),"^",12,16)="^^^^"
"RTN","MAGDTR03",106,0)
 . D FINISH ; record who cancelled the consult
"RTN","MAGDTR03",107,0)
 . Q
"RTN","MAGDTR03",108,0)
 Q
"RTN","MAGDTR03",109,0)
 ;
"RTN","MAGDTR03",110,0)
FINISH ; finalize resulted or cancelled consult
"RTN","MAGDTR03",111,0)
 N DUZACQ,FULLNAME,INITIALS,LOCKNAME,X
"RTN","MAGDTR03",112,0)
 ; record who resulted or cancelled the consult
"RTN","MAGDTR03",113,0)
 ;
"RTN","MAGDTR03",114,0)
 I $G(MODE)="REPAIR" G REPAIR ; set in ^MAGDTRLU
"RTN","MAGDTR03",115,0)
 ;
"RTN","MAGDTR03",116,0)
 ; process the transaction
"RTN","MAGDTR03",117,0)
 I $D(HLNEXT) D  ; IFC - data comes from HL7 message
"RTN","MAGDTR03",118,0)
 . D GETHL7B^MAGDTR01(.FULLNAME,.LOCATION)
"RTN","MAGDTR03",119,0)
 . ; if resulter is not the person who locked the study, update name
"RTN","MAGDTR03",120,0)
 . S LOCKNAME=$P(^MAG(2006.5849,UNREAD,0),"^",12)
"RTN","MAGDTR03",121,0)
 . I LOCKNAME'=FULLNAME,FULLNAME'="" D  ; not the same person, update
"RTN","MAGDTR03",122,0)
 . . ; look up resulter in file 200 - check for >1 people with same name
"RTN","MAGDTR03",123,0)
 . . S DUZACQ=$$FIND1^DIC(200,"","BX",FULLNAME) ; IA # 10060
"RTN","MAGDTR03",124,0)
 . . S INITIALS=$$GET1^DIQ(200,DUZACQ,1) ; initial
"RTN","MAGDTR03",125,0)
 . . ; DUZread (piece 4) is not known - set to null
"RTN","MAGDTR03",126,0)
 . . S X=FULLNAME_"^"_INITIALS_"^"_DUZACQ_"^^"_LOCATION
"RTN","MAGDTR03",127,0)
 . . S $P(^MAG(2006.5849,UNREAD,0),"^",12,16)=X ; reader identification
"RTN","MAGDTR03",128,0)
 . . Q
"RTN","MAGDTR03",129,0)
 . Q
"RTN","MAGDTR03",130,0)
 E  D  ; local consult - FULLNAME array is for IFCs only
"RTN","MAGDTR03",131,0)
 . ; record the id of the resulter - DUZ comes from RPC session
"RTN","MAGDTR03",132,0)
 . ; assumes that the results were entered directly, not via IFC/HL7
"RTN","MAGDTR03",133,0)
 . S FULLNAME=$$GET1^DIQ(200,DUZ,.01)
"RTN","MAGDTR03",134,0)
 . S INITIALS=$$GET1^DIQ(200,DUZ,1) ; initial
"RTN","MAGDTR03",135,0)
 . S X=FULLNAME_"^"_INITIALS_"^"_DUZ_"^"_DUZ_"^"_DUZ(2) ; DUZacq=DUZread
"RTN","MAGDTR03",136,0)
 . S $P(^MAG(2006.5849,UNREAD,0),"^",12,16)=X ; reader identification
"RTN","MAGDTR03",137,0)
 . Q
"RTN","MAGDTR03",138,0)
 ;
"RTN","MAGDTR03",139,0)
 D EXREF(UNREAD,TIMESTMP) ; set "E" cross-reference
"RTN","MAGDTR03",140,0)
 Q
"RTN","MAGDTR03",141,0)
 ;
"RTN","MAGDTR03",142,0)
EXREF(UNREAD,TIMESTMP) ; set cancellation or reading stop date/time and "E" cross-reference
"RTN","MAGDTR03",143,0)
 N ACQSITE ;-- acquisition site
"RTN","MAGDTR03",144,0)
 N LISTDATA ;- read/unread list data
"RTN","MAGDTR03",145,0)
 Q:UNREAD=""  Q:TIMESTMP=""
"RTN","MAGDTR03",146,0)
 S LISTDATA=^MAG(2006.5849,UNREAD,0)
"RTN","MAGDTR03",147,0)
 S ACQSITE=$P(LISTDATA,"^",2) Q:ACQSITE=""
"RTN","MAGDTR03",148,0)
 S $P(^MAG(2006.5849,UNREAD,0),"^",18)=TIMESTMP
"RTN","MAGDTR03",149,0)
 S ^MAG(2006.5849,"E",ACQSITE,TIMESTMP\1,UNREAD)=""
"RTN","MAGDTR03",150,0)
 Q
"RTN","MAGDTR03",151,0)
 ;
"RTN","MAGDTR03",152,0)
REPAIR ; code to repair a defective unread list entry
"RTN","MAGDTR03",153,0)
 N ACTIVITY,DUZACQ,FULLNAME,HIT,I,IFCSITE,INITIALS,LOCATION,SUBFILE,TIMESTMP
"RTN","MAGDTR03",154,0)
 S IFCSITE=$$GET1^DIQ(123,GMRCIEN,.07,"I") ; routing facility
"RTN","MAGDTR03",155,0)
 ;
"RTN","MAGDTR03",156,0)
 ; first find the consult request tracking "completion" activity in cprs 
"RTN","MAGDTR03",157,0)
 S HIT=0 F I=1:1 D  Q:HIT  Q:ACTIVITY=""
"RTN","MAGDTR03",158,0)
 . S SUBFILE=I_","_GMRCIEN ; format: <subfile ien>,<gmrc ien>
"RTN","MAGDTR03",159,0)
 . S ACTIVITY=$$GET1^DIQ(123.02,SUBFILE,1) ; activity - from ^GMR(123.1)
"RTN","MAGDTR03",160,0)
 . I ACTIVITY="COMPLETE/UPDATE" S HIT=1
"RTN","MAGDTR03",161,0)
 . E  I ACTIVITY="CANCELLED" S HIT=2
"RTN","MAGDTR03",162,0)
 . E  I ACTIVITY="DISCONTINUED" S HIT=3
"RTN","MAGDTR03",163,0)
 . Q
"RTN","MAGDTR03",164,0)
 I 'HIT S SUBFILE=(I-1)_","_GMRCIEN ; use the last entry
"RTN","MAGDTR03",165,0)
 ;
"RTN","MAGDTR03",166,0)
 ; now make the corrections
"RTN","MAGDTR03",167,0)
 S TIMESTMP=$$GET1^DIQ(123.02,SUBFILE,2,"I") ; date/time of actual activity
"RTN","MAGDTR03",168,0)
 S DUZACQ=$$GET1^DIQ(123.02,SUBFILE,3,"I") ; who's responsible for activity
"RTN","MAGDTR03",169,0)
 I DUZACQ D  ; action was perfomed locally
"RTN","MAGDTR03",170,0)
 . S FULLNAME=$$GET1^DIQ(200,DUZACQ,.01) ; name
"RTN","MAGDTR03",171,0)
 . S INITIALS=$$GET1^DIQ(200,DUZACQ,1) ; initials
"RTN","MAGDTR03",172,0)
 . S LOCATION=ACQSITE
"RTN","MAGDTR03",173,0)
 . S X=FULLNAME_"^"_INITIALS_"^"_DUZACQ_"^"_DUZACQ_"^"_ACQSITE ; DUZacq=DUZread
"RTN","MAGDTR03",174,0)
 . Q
"RTN","MAGDTR03",175,0)
 E  I IFCSITE D  ; remotely completed IFC
"RTN","MAGDTR03",176,0)
 . S FULLNAME=$$GET1^DIQ(123.02,SUBFILE,.22) ; remote responsible person
"RTN","MAGDTR03",177,0)
 . ; look up resulter in file 200 - check for >1 people with same name
"RTN","MAGDTR03",178,0)
 . S DUZACQ=$$FIND1^DIC(200,"","BX",FULLNAME) ; IA # 10060
"RTN","MAGDTR03",179,0)
 . S INITIALS=$$GET1^DIQ(200,DUZACQ,1) ; initials
"RTN","MAGDTR03",180,0)
 . ; DUZread (piece 4) is not known - set to null
"RTN","MAGDTR03",181,0)
 . S X=FULLNAME_"^"_INITIALS_"^"_DUZACQ_"^^"_IFCSITE
"RTN","MAGDTR03",182,0)
 . Q
"RTN","MAGDTR03",183,0)
 E  S X="^^^^" ; problem with cprs consult
"RTN","MAGDTR03",184,0)
 S $P(^MAG(2006.5849,UNREAD,0),"^",12,16)=X ; reader identification
"RTN","MAGDTR03",185,0)
 S $P(^MAG(2006.5849,UNREAD,0),"^",19)=$$NOW^XLFDT() ; Record Repair TimeStamp in piece 19 Field #18
"RTN","MAGDTR03",186,0)
 D EXREF(UNREAD,TIMESTMP) ; set "E" cross-reference
"RTN","MAGDTR03",187,0)
 Q
"RTN","MAGDTR03",188,0)
 ;
"RTN","MAGDTR03",189,0)
TIUNOTE ; create a TIU result note, if one is not present
"RTN","MAGDTR03",190,0)
 N DUZ ; this is called by the HL7 - DUZ and DUZ(2) are not set
"RTN","MAGDTR03",191,0)
 N MAGDFN,MAGTEXT,MAGTITLE,UNREAD,XECUTE,ZZ
"RTN","MAGDTR03",192,0)
 Q:'$D(HLNEXT)  ; only create TIU result note for IFCs
"RTN","MAGDTR03",193,0)
 Q:'$$FINDLIST^MAGDTR01(GMRCIEN,,,,,.MAGTITLE)
"RTN","MAGDTR03",194,0)
 S UNREAD=$$UNREAD^MAGDTR02(GMRCIEN) Q:'UNREAD
"RTN","MAGDTR03",195,0)
 S MAGTEXT(1)="Please refer to Inter-facility Consult for results."
"RTN","MAGDTR03",196,0)
 S MAGTEXT(2)=""
"RTN","MAGDTR03",197,0)
 S MAGTEXT(3)="Automatically generated note - signature not required."
"RTN","MAGDTR03",198,0)
 S DUZ=$P(^MAG(2006.5849,UNREAD,0),"^",14) Q:'DUZ  ; get DUZacq
"RTN","MAGDTR03",199,0)
 S DUZ(0)="@",DUZ(2)=LOCATION ; get reading site ien
"RTN","MAGDTR03",200,0)
 S MAGDFN=$$GET1^DIQ(123,GMRCIEN,.02,"I")
"RTN","MAGDTR03",201,0)
 D NEW^MAGGNTI1(.ZZ,MAGDFN,MAGTITLE,1,"E",,DUZ,,,GMRCIEN,.MAGTEXT)
"RTN","MAGDTR03",202,0)
 Q
"RTN","MAGDTR03",203,0)
 ;
"RTN","MAGDTR05")
0^49^B47569511
"RTN","MAGDTR05",1,0)
MAGDTR05 ;WOIFO/PMK - Read a DICOM image file ; 25 Sep 2008 10:53 AM
"RTN","MAGDTR05",2,0)
 ;;3.0;IMAGING;**46,54**;03-July-2009;;Build 1424
"RTN","MAGDTR05",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDTR05",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDTR05",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDTR05",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDTR05",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDTR05",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDTR05",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDTR05",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDTR05",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDTR05",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDTR05",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDTR05",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDTR05",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDTR05",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDTR05",17,0)
 ;;
"RTN","MAGDTR05",18,0)
LOOKUP(OUT,STATNUMB,ISPECIDX,IPROCS,STARTING,DUZREAD,DUZREAD2,LOCKTIME,STATLIST) ; RPC = MAG DICOM CON UNREADLIST GET
"RTN","MAGDTR05",19,0)
 ; entry point to lookup entries in file
"RTN","MAGDTR05",20,0)
 ; 
"RTN","MAGDTR05",21,0)
 ; OUT ------- Return array
"RTN","MAGDTR05",22,0)
 ; STATNUMB -- Acquisition Station Number
"RTN","MAGDTR05",23,0)
 ; ISPECIDX -- Index to Specialties (2005.84)
"RTN","MAGDTR05",24,0)
 ; IPROCS ---- Indexes to Procedures (2005.85) - this is a comma-delimited list
"RTN","MAGDTR05",25,0)
 ; STARTING -- Fileman date/time to begin sequential search
"RTN","MAGDTR05",26,0)
 ; DUZREAD --- User's DUZ at the Reading Site
"RTN","MAGDTR05",27,0)
 ; DUZREAD2 -- DIC(4) pointer to Reading Site
"RTN","MAGDTR05",28,0)
 ; LOCKTIME -- timeout value for LOCKTIME
"RTN","MAGDTR05",29,0)
 ; STATLIST -- status of entry (C, L, R, U, or W, in any combination)
"RTN","MAGDTR05",30,0)
 ; 
"RTN","MAGDTR05",31,0)
 N ACQSITE ;- site index in Unread List
"RTN","MAGDTR05",32,0)
 N ISTATUS ;-- counter to the status in STATLIST
"RTN","MAGDTR05",33,0)
 N IPROC ;---- counter to IPROCS
"RTN","MAGDTR05",34,0)
 N IPROCIDX ;- index to procedures (2005.85)
"RTN","MAGDTR05",35,0)
 N TIMESTMP ;- last activity date/time for the entry
"RTN","MAGDTR05",36,0)
 N SITENAME ;- name of acquisition site
"RTN","MAGDTR05",37,0)
 N STATUS1 ;-- one status out of the STATLIST
"RTN","MAGDTR05",38,0)
 N UNREAD ;--- pointer to entry in unread list
"RTN","MAGDTR05",39,0)
 ;
"RTN","MAGDTR05",40,0)
 S DUZREAD=$G(DUZREAD,0),DUZREAD2=$G(DUZREAD2,0),LOCKTIME=$G(LOCKTIME,0)
"RTN","MAGDTR05",41,0)
 S STATLIST=$$UP^MAGDFCNV($G(STATLIST))
"RTN","MAGDTR05",42,0)
 I STATLIST="" S STATLIST="CDLRUW" ; default to all STATUS values
"RTN","MAGDTR05",43,0)
 ;
"RTN","MAGDTR05",44,0)
 S ACQSITE=$$ACQSITE^MAGDTR06(STATNUMB)
"RTN","MAGDTR05",45,0)
 I ACQSITE<0  S OUT="-1, ACQUISITION STATION NUMBER "_STATNUMB_" IS NOT DEFINED IN FILE 4" Q
"RTN","MAGDTR05",46,0)
 S SITENAME=$P(ACQSITE,"^",2),ACQSITE=$P(ACQSITE,"^",1)
"RTN","MAGDTR05",47,0)
 ;
"RTN","MAGDTR05",48,0)
 I LOCKTIME,DUZREAD2 D UNLOCKER ; automatically unlock timed out studies
"RTN","MAGDTR05",49,0)
 ;
"RTN","MAGDTR05",50,0)
 K OUT
"RTN","MAGDTR05",51,0)
 I STARTING=0 D  ; loop through the STATUS index because it is faster
"RTN","MAGDTR05",52,0)
 . S STATLIST=$TR(STATLIST,"D") ; remove the DELETED status from STATLIST
"RTN","MAGDTR05",53,0)
 . F ISTATUS=1:1:$L(STATLIST) S STATUS1=$E(STATLIST,ISTATUS) D
"RTN","MAGDTR05",54,0)
 . . F IPROC=1:1:$L(IPROCS,",") S IPROCIDX=$P(IPROCS,",",IPROC) D
"RTN","MAGDTR05",55,0)
 . . . S UNREAD=""
"RTN","MAGDTR05",56,0)
 . . . F  S UNREAD=$O(^MAG(2006.5849,"D",ACQSITE,ISPECIDX,IPROCIDX,STATUS1,UNREAD)) Q:UNREAD=""  D
"RTN","MAGDTR05",57,0)
 . . . . D LOOKUP1(UNREAD)
"RTN","MAGDTR05",58,0)
 . . . . Q
"RTN","MAGDTR05",59,0)
 . . . Q
"RTN","MAGDTR05",60,0)
 . . Q
"RTN","MAGDTR05",61,0)
 . Q
"RTN","MAGDTR05",62,0)
 E  D  ; retrieve just the latest events
"RTN","MAGDTR05",63,0)
 . F IPROC=1:1:$L(IPROCS,",") S IPROCIDX=$P(IPROCS,",",IPROC) D
"RTN","MAGDTR05",64,0)
 . . S TIMESTMP=STARTING ; reinitialize the starting date & time for each index to procedures
"RTN","MAGDTR05",65,0)
 . . F  S TIMESTMP=$O(^MAG(2006.5849,"AC",ACQSITE,ISPECIDX,IPROCIDX,TIMESTMP)) Q:TIMESTMP=""  D
"RTN","MAGDTR05",66,0)
 . . . S UNREAD=""
"RTN","MAGDTR05",67,0)
 . . . F  S UNREAD=$O(^MAG(2006.5849,"AC",ACQSITE,ISPECIDX,IPROCIDX,TIMESTMP,UNREAD)) Q:UNREAD=""  D
"RTN","MAGDTR05",68,0)
 . . . . D LOOKUP1(UNREAD)
"RTN","MAGDTR05",69,0)
 . . . . Q
"RTN","MAGDTR05",70,0)
 . . . Q
"RTN","MAGDTR05",71,0)
 . . Q
"RTN","MAGDTR05",72,0)
 . Q
"RTN","MAGDTR05",73,0)
 Q
"RTN","MAGDTR05",74,0)
 ;
"RTN","MAGDTR05",75,0)
LOOKUP1(UNREAD) ; retrieve one entry from the unread list
"RTN","MAGDTR05",76,0)
 N GMRCIEN
"RTN","MAGDTR05",77,0)
 N DFN
"RTN","MAGDTR05",78,0)
 N VADM
"RTN","MAGDTR05",79,0)
 N ICN
"RTN","MAGDTR05",80,0)
 N IFCSITE,IFCIEN,IFCSITEA,IFCRTIME,IFCLTIME,IFCETIME
"RTN","MAGDTR05",81,0)
 N LISTDATA ;- read/unread list data
"RTN","MAGDTR05",82,0)
 N QUIT
"RTN","MAGDTR05",83,0)
 N READER
"RTN","MAGDTR05",84,0)
 N SHORTID
"RTN","MAGDTR05",85,0)
 N STATUS
"RTN","MAGDTR05",86,0)
 N VA,VADM,VAERR
"RTN","MAGDTR05",87,0)
 N VIPSTS ; VIP status
"RTN","MAGDTR05",88,0)
 N I,LAST,X,Z
"RTN","MAGDTR05",89,0)
 ;
"RTN","MAGDTR05",90,0)
 S LISTDATA=$G(^MAG(2006.5849,UNREAD,0))
"RTN","MAGDTR05",91,0)
 S STATUS=$P(LISTDATA,"^",11) ; status
"RTN","MAGDTR05",92,0)
 Q:STATLIST'[STATUS  ; skip the entry if it is not the right STATUS
"RTN","MAGDTR05",93,0)
 ;
"RTN","MAGDTR05",94,0)
 S GMRCIEN=$P(LISTDATA,"^",1)
"RTN","MAGDTR05",95,0)
 S IFCSITE=$$GET1^DIQ(123,GMRCIEN,.07,"I") ; Routing Facility
"RTN","MAGDTR05",96,0)
 ;
"RTN","MAGDTR05",97,0)
 ; check if this consult can it be displayed to the reader
"RTN","MAGDTR05",98,0)
 S QUIT=0
"RTN","MAGDTR05",99,0)
 I DUZREAD D  Q:QUIT
"RTN","MAGDTR05",100,0)
 . I IFCSITE D  Q:QUIT  ; IFC reading site
"RTN","MAGDTR05",101,0)
 . . I IFCSITE'=DUZREAD2 S QUIT=1
"RTN","MAGDTR05",102,0)
 . . Q
"RTN","MAGDTR05",103,0)
 . I STATUS="W" S QUIT=2 Q
"RTN","MAGDTR05",104,0)
 . I STATUS="L" D  Q:QUIT
"RTN","MAGDTR05",105,0)
 . . S READER=$P(LISTDATA,"^",15) ; reader
"RTN","MAGDTR05",106,0)
 . . I READER,READER'=DUZREAD S QUIT=3
"RTN","MAGDTR05",107,0)
 . . Q
"RTN","MAGDTR05",108,0)
 . Q
"RTN","MAGDTR05",109,0)
 ;
"RTN","MAGDTR05",110,0)
 ; acquisition site identification
"RTN","MAGDTR05",111,0)
 S Z=UNREAD_"|"_GMRCIEN_"|"_STATNUMB_"|"_SITENAME
"RTN","MAGDTR05",112,0)
 ; patient information
"RTN","MAGDTR05",113,0)
 S DFN=$$GET1^DIQ(123,GMRCIEN,.02,"I")
"RTN","MAGDTR05",114,0)
 D DEM^VADPT,PTSEC^DGSEC4(.VIPSTS,DFN)
"RTN","MAGDTR05",115,0)
 S ICN=$$GETICN^MPIF001(DFN)
"RTN","MAGDTR05",116,0)
 S X=$P(VADM(2),"^",1),SHORTID=$E(VADM(1),1)_$E(X,$L(X)-3,$L(X))
"RTN","MAGDTR05",117,0)
 S Z=Z_"|"_VADM(1)_"|"_$P(VADM(2),"^",2)_"|"_ICN_"|"_SHORTID
"RTN","MAGDTR05",118,0)
 S Z=Z_"|"_VIPSTS(1) ; VIP status
"RTN","MAGDTR05",119,0)
 S Z=Z_"|"_$P(^MAG(2005.84,ISPECIDX,0),"^",1)_"|"_$P(^MAG(2005.84,ISPECIDX,2),"^",1)
"RTN","MAGDTR05",120,0)
 S Z=Z_"|"_$P(^MAG(2005.85,IPROCIDX,0),"^",1)_"|"_$P(^MAG(2005.85,IPROCIDX,2),"^",1)
"RTN","MAGDTR05",121,0)
 ; time stamps and image acquisition statistics
"RTN","MAGDTR05",122,0)
 S Z=Z_"|"_$P(LISTDATA,"^",7) ; time of first image
"RTN","MAGDTR05",123,0)
 S Z=Z_"|"_$P(LISTDATA,"^",8) ; time of last image
"RTN","MAGDTR05",124,0)
 S Z=Z_"|"_$P(LISTDATA,"^",9) ; time of last activity
"RTN","MAGDTR05",125,0)
 S Z=Z_"|"_(+$P(LISTDATA,"^",10)) ; #images
"RTN","MAGDTR05",126,0)
 S Z=Z_"|"_STATUS
"RTN","MAGDTR05",127,0)
 S Z=Z_"|"_$$GET1^DIQ(123,GMRCIEN,13,"I") ; consult/procedure flag
"RTN","MAGDTR05",128,0)
 S Z=Z_"|"_$P($$GET1^DIQ(123,GMRCIEN,5)," - ",2) ; GMRC urgency
"RTN","MAGDTR05",129,0)
 ;
"RTN","MAGDTR05",130,0)
 ; get inter-facility consult data
"RTN","MAGDTR05",131,0)
 S IFCSITE=$$GET1^DIQ(123,GMRCIEN,.07,"I") ; Routing Facility
"RTN","MAGDTR05",132,0)
 I IFCSITE D  ; inter-facility consult
"RTN","MAGDTR05",133,0)
 . S IFCIEN=$$GET1^DIQ(123,GMRCIEN,.06,"I") ; remote consult file entry
"RTN","MAGDTR05",134,0)
 . ; get IFC site abbreviation
"RTN","MAGDTR05",135,0)
 . S I=$O(^MAG(2006.19,"D",IFCSITE,""))
"RTN","MAGDTR05",136,0)
 . S IFCSITEA=$S(I:$P($G(^MAG(2006.19,I,0)),"^",4),1:"?")
"RTN","MAGDTR05",137,0)
 . S IFCLTIME=$P(LISTDATA,"^",5),IFCRTIME=$P(LISTDATA,"^",6)
"RTN","MAGDTR05",138,0)
 . I IFCLTIME,IFCRTIME S IFCETIME=$$FMDIFF^XLFDT(IFCRTIME,IFCLTIME,2)
"RTN","MAGDTR05",139,0)
 . E  S IFCETIME=""
"RTN","MAGDTR05",140,0)
 . Q
"RTN","MAGDTR05",141,0)
 E  D  ; local consult
"RTN","MAGDTR05",142,0)
 . S (IFCIEN,IFCSITEA,IFCRTIME,IFCLTIME,IFCETIME)=""
"RTN","MAGDTR05",143,0)
 . Q
"RTN","MAGDTR05",144,0)
 S Z=Z_"|"_IFCSITE_"|"_IFCSITEA_"|"_IFCIEN
"RTN","MAGDTR05",145,0)
 S Z=Z_"|"_IFCLTIME_"|"_IFCRTIME_"|"_IFCETIME
"RTN","MAGDTR05",146,0)
 F I=12:1:16 S Z=Z_"|"_$P(LISTDATA,"^",I) ; reader identification
"RTN","MAGDTR05",147,0)
 S Z=Z_"|"_$P(LISTDATA,"^",17) ; start of reading
"RTN","MAGDTR05",148,0)
 S Z=Z_"|"_$P(LISTDATA,"^",18) ; end of reading
"RTN","MAGDTR05",149,0)
 S LAST=$G(OUT(1),1) ; first element in the array is the counter
"RTN","MAGDTR05",150,0)
 S LAST=LAST+1,OUT(LAST)=Z,OUT(1)=LAST
"RTN","MAGDTR05",151,0)
 Q
"RTN","MAGDTR05",152,0)
 ;
"RTN","MAGDTR05",153,0)
UNLOCKER ; automatically unlock any timed out studies
"RTN","MAGDTR05",154,0)
 N GMRCIEN
"RTN","MAGDTR05",155,0)
 N IFCSITE
"RTN","MAGDTR05",156,0)
 N SECONDS ;-- date/time in seconds
"RTN","MAGDTR05",157,0)
 N STATUS
"RTN","MAGDTR05",158,0)
 N UNLOCKTM ;- earliest date/time for a lock (FM format)
"RTN","MAGDTR05",159,0)
 N UNREAD ;--- pointer to entry in unread list
"RTN","MAGDTR05",160,0)
 N X
"RTN","MAGDTR05",161,0)
 ;
"RTN","MAGDTR05",162,0)
 ; calculate the earliest automatic unlock date/time
"RTN","MAGDTR05",163,0)
 S SECONDS=86400*$H+$P($H,",",2)-(60*LOCKTIME)
"RTN","MAGDTR05",164,0)
 ; convert to FM format
"RTN","MAGDTR05",165,0)
 S UNLOCKTM=$$HTFM^XLFDT((SECONDS\86400)_","_(SECONDS#86400),0)
"RTN","MAGDTR05",166,0)
 ;
"RTN","MAGDTR05",167,0)
 ; traverse the "lock list" and unlock those that have timed out
"RTN","MAGDTR05",168,0)
 F IPROC=1:1:$L(IPROCS,",") S IPROCIDX=$P(IPROCS,",",IPROC) D
"RTN","MAGDTR05",169,0)
 . S UNREAD=""
"RTN","MAGDTR05",170,0)
 . F  S UNREAD=$O(^MAG(2006.5849,"D",ACQSITE,ISPECIDX,IPROCIDX,"L",UNREAD)) Q:UNREAD=""  D
"RTN","MAGDTR05",171,0)
 . . S LISTDATA=$G(^MAG(2006.5849,UNREAD,0))
"RTN","MAGDTR05",172,0)
 . . ; check for a lock timeout
"RTN","MAGDTR05",173,0)
 . . I $P(LISTDATA,"^",17)<UNLOCKTM D  ; lock timeout
"RTN","MAGDTR05",174,0)
 . . . ; only unlock studies that are to be done at the reading site
"RTN","MAGDTR05",175,0)
 . . . I DUZREAD2=$P(LISTDATA,"^",16) D UNLOCK^MAGDTR04(UNREAD,.STATUS)
"RTN","MAGDTR05",176,0)
 . . . Q
"RTN","MAGDTR05",177,0)
 . . Q
"RTN","MAGDTR05",178,0)
 . Q
"RTN","MAGDTR05",179,0)
 Q
"RTN","MAGDTR06")
0^50^B25510598
"RTN","MAGDTR06",1,0)
MAGDTR06 ;WOIFO/PMK - Read a DICOM image file ; 29 Sep 2008 10:51 AM
"RTN","MAGDTR06",2,0)
 ;;3.0;IMAGING;**46,54**;03-July-2009;;Build 1424
"RTN","MAGDTR06",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDTR06",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDTR06",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDTR06",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDTR06",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDTR06",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDTR06",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDTR06",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDTR06",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDTR06",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDTR06",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDTR06",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDTR06",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDTR06",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDTR06",17,0)
 ;;
"RTN","MAGDTR06",18,0)
GETSITES(OUT) ; MAG DICOM CON UNREAD ACQ SITES
"RTN","MAGDTR06",19,0)
 N ACQSITE,ADMNSITE,I,J,LOCKTIME,PRIMARY,X
"RTN","MAGDTR06",20,0)
 S J=0
"RTN","MAGDTR06",21,0)
 S I=0 F  S I=$O(^MAG(2006.5842,I)) Q:'I  S X=^(I,0) D GETSITE1
"RTN","MAGDTR06",22,0)
 S OUT(1)=J
"RTN","MAGDTR06",23,0)
 Q
"RTN","MAGDTR06",24,0)
 ;
"RTN","MAGDTR06",25,0)
GETSITE1 ;
"RTN","MAGDTR06",26,0)
 S J=J+1
"RTN","MAGDTR06",27,0)
 S ACQSITE=$P(X,"^",1),PRIMARY=$P(X,"^",2)
"RTN","MAGDTR06",28,0)
 S PRIMARY=$$GET1^DIQ(4,PRIMARY,99) ; use station number
"RTN","MAGDTR06",29,0)
 S ADMNSITE=$P(X,"^",3),LOCKTIME=$P(X,"^",4)
"RTN","MAGDTR06",30,0)
 S OUT(J+1)=$$GET1^DIQ(4,ACQSITE,99)_"|"_$$GET1^DIQ(4,ACQSITE,.01)_"|"_PRIMARY_"|"_ADMNSITE_"|"_LOCKTIME
"RTN","MAGDTR06",31,0)
 Q
"RTN","MAGDTR06",32,0)
 ;
"RTN","MAGDTR06",33,0)
GETREAD(OUT) ; MAG DICOM CON GET TELE READER
"RTN","MAGDTR06",34,0)
 N ACQSITE,I,IPROCIDX,ISPECIDX,LOCKTIME,PRIMARY,XACQSITE,X,XDUZ,XPROCIDX,XSPECIDX
"RTN","MAGDTR06",35,0)
 N ADMNPROC,ADMNSITE,ADMNSPEC,USERPREF
"RTN","MAGDTR06",36,0)
 ;
"RTN","MAGDTR06",37,0)
 S (I,XDUZ)=0
"RTN","MAGDTR06",38,0)
 F  S XDUZ=$O(^MAG(2006.5843,"B",DUZ,XDUZ)) Q:'XDUZ  S XACQSITE=0 D
"RTN","MAGDTR06",39,0)
 . F  S XACQSITE=$O(^MAG(2006.5843,XDUZ,1,XACQSITE)) Q:'XACQSITE  D
"RTN","MAGDTR06",40,0)
 . . S X=^MAG(2006.5843,XDUZ,1,XACQSITE,0)
"RTN","MAGDTR06",41,0)
 . . S ACQSITE=$P(X,"^",1),ADMNSITE=$P(X,"^",2)
"RTN","MAGDTR06",42,0)
 . . S PRIMARY=$P(^MAG(2006.5842,ACQSITE,0),"^",2),LOCKTIME=$P(^(0),"^",4)
"RTN","MAGDTR06",43,0)
 . . S PRIMARY=$$GET1^DIQ(4,PRIMARY,99) ; use station number
"RTN","MAGDTR06",44,0)
 . . ; an inactive site in file 2006.5842 overrides the active for the user
"RTN","MAGDTR06",45,0)
 . . I ADMNSITE S ADMNSITE=$P(^MAG(2006.5842,ACQSITE,0),"^",3)  ; site is not active
"RTN","MAGDTR06",46,0)
 . . S XSPECIDX=0
"RTN","MAGDTR06",47,0)
 . . F  S XSPECIDX=$O(^MAG(2006.5843,XDUZ,1,XACQSITE,1,XSPECIDX)) Q:'XSPECIDX  D
"RTN","MAGDTR06",48,0)
 . . . S X=^MAG(2006.5843,XDUZ,1,XACQSITE,1,XSPECIDX,0)
"RTN","MAGDTR06",49,0)
 . . . S ISPECIDX=$P(X,"^",1),ADMNSPEC=$P(X,"^",2)
"RTN","MAGDTR06",50,0)
 . . . S XPROCIDX=0
"RTN","MAGDTR06",51,0)
 . . . F  S XPROCIDX=$O(^MAG(2006.5843,XDUZ,1,XACQSITE,1,XSPECIDX,1,XPROCIDX)) Q:'XPROCIDX  D
"RTN","MAGDTR06",52,0)
 . . . . S X=^MAG(2006.5843,XDUZ,1,XACQSITE,1,XSPECIDX,1,XPROCIDX,0)
"RTN","MAGDTR06",53,0)
 . . . . S IPROCIDX=$P(X,"^",1),ADMNPROC=$P(X,"^",2),USERPREF=$P(X,"^",3)
"RTN","MAGDTR06",54,0)
 . . . . S X=$$GET1^DIQ(4,ACQSITE,99)_"|"_$$GET1^DIQ(4,ACQSITE,.01)
"RTN","MAGDTR06",55,0)
 . . . . S X=X_"|"_PRIMARY_"|"_ADMNSITE_"|"_LOCKTIME
"RTN","MAGDTR06",56,0)
 . . . . S X=X_"|"_ISPECIDX_"|"_$$GET1^DIQ(2005.84,ISPECIDX,.01)_"|"_ADMNSPEC
"RTN","MAGDTR06",57,0)
 . . . . S X=X_"|"_IPROCIDX_"|"_$$GET1^DIQ(2005.85,IPROCIDX,.01)_"|"_ADMNPROC
"RTN","MAGDTR06",58,0)
 . . . . S X=X_"|"_USERPREF
"RTN","MAGDTR06",59,0)
 . . . . S I=I+1,OUT(I+1)=X
"RTN","MAGDTR06",60,0)
 . . . . Q
"RTN","MAGDTR06",61,0)
 . . . Q
"RTN","MAGDTR06",62,0)
 . . Q
"RTN","MAGDTR06",63,0)
 . Q
"RTN","MAGDTR06",64,0)
 S OUT(1)=I
"RTN","MAGDTR06",65,0)
 Q
"RTN","MAGDTR06",66,0)
 ;
"RTN","MAGDTR06",67,0)
SETREAD(OUT,STATNUMB,ISPECIDX,IPROCIDX,USERPREF) ;  MAG DICOM CON SET TELE READER
"RTN","MAGDTR06",68,0)
 N ACQSITE,IENDUZ,IENSITE,IENSPEC,IENPROC,X
"RTN","MAGDTR06",69,0)
 I '$G(STATNUMB) S OUT="-1, ACQUISITION STATION NUMBER PARAMETER IS NOT DEFINED"
"RTN","MAGDTR06",70,0)
 E  I '$G(ISPECIDX) S OUT="-2, SPECIALTY PARAMETER IS NOT DEFINED"
"RTN","MAGDTR06",71,0)
 E  I '$G(IPROCIDX) S OUT="-3, PROCEDURE PARAMETER IS NOT DEFINED"
"RTN","MAGDTR06",72,0)
 E  I '$D(USERPREF) S OUT="-4, USER PREFERENCE SELCTION IS NOT DEFINED"
"RTN","MAGDTR06",73,0)
 E  I USERPREF'=0,USERPREF'=1 S OUT="-5, ILLEGAL VALUE FOR USER PREFERENCE: <<"_USERPREF_">>"
"RTN","MAGDTR06",74,0)
 E  D
"RTN","MAGDTR06",75,0)
 . S IENDUZ=$O(^MAG(2006.5843,"B",DUZ,0))
"RTN","MAGDTR06",76,0)
 . I 'IENDUZ S OUT="-6, USER (DUZ) #"_DUZ_" IS NOT DEFINED IN FILE 2006.5849" Q
"RTN","MAGDTR06",77,0)
 . ;
"RTN","MAGDTR06",78,0)
 . S ACQSITE=+$$ACQSITE(STATNUMB)
"RTN","MAGDTR06",79,0)
 . I ACQSITE<0 S OUT="-7, ACQUISITION STATION NUMBER "_STATNUMB_" IS NOT DEFINED IN FILE 4" Q
"RTN","MAGDTR06",80,0)
 . ;
"RTN","MAGDTR06",81,0)
 . S IENSITE=$O(^MAG(2006.5843,IENDUZ,1,"B",ACQSITE,0))
"RTN","MAGDTR06",82,0)
 . I 'IENSITE S OUT="-8, ACQUISITION SITE #"_ACQSITE_" IS NOT DEFINED IN FILE 2006.5849" Q
"RTN","MAGDTR06",83,0)
 . ;
"RTN","MAGDTR06",84,0)
 . S IENSPEC=$O(^MAG(2006.5843,IENDUZ,1,IENSITE,1,"B",ISPECIDX,0))
"RTN","MAGDTR06",85,0)
 . I 'IENSPEC S OUT="-9, SPECIALTY #"_ISPECIDX_" IS NOT DEFINED IN FILE 2006.5849" Q
"RTN","MAGDTR06",86,0)
 . ;
"RTN","MAGDTR06",87,0)
 . S IENPROC=$O(^MAG(2006.5843,IENDUZ,1,IENSITE,1,IENSPEC,1,"B",IPROCIDX,0))
"RTN","MAGDTR06",88,0)
 . I 'IENPROC S OUT="-10, PROCEDURE #"_IPROCIDX_" IS NOT DEFINED IN FILE 2006.5849" Q
"RTN","MAGDTR06",89,0)
 . ;
"RTN","MAGDTR06",90,0)
 . I $D(^MAG(2006.5843,IENDUZ,1,IENSITE,1,IENSPEC,1,IENPROC,0)) S X=^(0) D
"RTN","MAGDTR06",91,0)
 . . I $P(X,"^",3)=USERPREF S OUT="2, USER PREFERENCE ALREADY SET"
"RTN","MAGDTR06",92,0)
 . . E  D
"RTN","MAGDTR06",93,0)
 . . . S $P(^MAG(2006.5843,IENDUZ,1,IENSITE,1,IENSPEC,1,IENPROC,0),"^",3)=USERPREF
"RTN","MAGDTR06",94,0)
 . . . S OUT="1, USER PREFERENCE SET"
"RTN","MAGDTR06",95,0)
 . . . Q
"RTN","MAGDTR06",96,0)
 . . Q
"RTN","MAGDTR06",97,0)
 . E  S OUT="-10, PROCEDURE #"_IPROCIDX_" IS NOT DEFINED IN FILE 2006.5849"
"RTN","MAGDTR06",98,0)
 . Q
"RTN","MAGDTR06",99,0)
 Q
"RTN","MAGDTR06",100,0)
 ;
"RTN","MAGDTR06",101,0)
ACQSITE(STATNUMB) ; lookup an institution by the station number
"RTN","MAGDTR06",102,0)
 N D,DIC,U,X,Y
"RTN","MAGDTR06",103,0)
 S DIC="^DIC(4," ; INSTITUTION is file #4 
"RTN","MAGDTR06",104,0)
 S D="D" ; use the "D" cross-reference
"RTN","MAGDTR06",105,0)
 S DIC(0)="X" ; only find the exact matching entry
"RTN","MAGDTR06",106,0)
 S X=STATNUMB
"RTN","MAGDTR06",107,0)
 D IX^DIC
"RTN","MAGDTR06",108,0)
 Q Y
"RTN","MAGDUID3")
0^51^B4496619
"RTN","MAGDUID3",1,0)
MAGDUID3 ;WOIFO/EdM - UID Table Management - Server Part ; 11/09/2007 07:11
"RTN","MAGDUID3",2,0)
 ;;3.0;IMAGING;**54**;03-July-2009;;Build 1424
"RTN","MAGDUID3",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDUID3",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDUID3",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDUID3",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDUID3",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDUID3",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDUID3",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDUID3",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDUID3",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDUID3",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDUID3",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDUID3",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDUID3",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDUID3",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDUID3",17,0)
 ;;
"RTN","MAGDUID3",18,0)
 Q
"RTN","MAGDUID3",19,0)
 ;
"RTN","MAGDUID3",20,0)
SERVER(OUT,OFFSET,MAX) ; RPC = MAG DICOM GET UID TABLE
"RTN","MAGDUID3",21,0)
 N BEGIN,COUNT,LAST,REF
"RTN","MAGDUID3",22,0)
 S REF=$G(OFFSET) S:$TR(REF,"^")="" REF="^MAGDICOM(2006.539)"
"RTN","MAGDUID3",23,0)
 S BEGIN="^MAGDICOM(2006.539,"
"RTN","MAGDUID3",24,0)
 S LAST="",COUNT=0 F  S REF=$Q(@REF) Q:REF=""  Q:$E(REF,1,$L(BEGIN))'=BEGIN  D  Q:COUNT>MAX
"RTN","MAGDUID3",25,0)
 . S COUNT=COUNT+1,OUT(COUNT)=REF,LAST=REF
"RTN","MAGDUID3",26,0)
 . S COUNT=COUNT+1,OUT(COUNT)=@REF
"RTN","MAGDUID3",27,0)
 . QUIT
"RTN","MAGDUID3",28,0)
 S:$E(REF,1,$L(BEGIN))'=BEGIN COUNT=COUNT+1,OUT(COUNT)="^"
"RTN","MAGDUID3",29,0)
 S OUT(0)=COUNT
"RTN","MAGDUID3",30,0)
 Q
"RTN","MAGDUID3",31,0)
 ;
"RTN","MAGENCHK")
0^52^B4666319
"RTN","MAGENCHK",1,0)
MAGENCHK ;Patch 54 Environment Checking Routine; 08 Sep 2008 2:16 PM ; 09 Sep 2008 6:21 AM
"RTN","MAGENCHK",2,0)
 ;;3.0;IMAGING;**54**;03-July-2009;;Build 1424
"RTN","MAGENCHK",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGENCHK",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGENCHK",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGENCHK",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGENCHK",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGENCHK",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGENCHK",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGENCHK",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGENCHK",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGENCHK",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGENCHK",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGENCHK",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGENCHK",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGENCHK",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGENCHK",17,0)
 ;;
"RTN","MAGENCHK",18,0)
EN ; environment check
"RTN","MAGENCHK",19,0)
 ; See Kernel Developer's Guide: http://www.va.gov/vdl/documents/Infrastructure/Kernel/krn8_0dg.doc
"RTN","MAGENCHK",20,0)
 I '$O(^MAGD(2006.575,0)) Q
"RTN","MAGENCHK",21,0)
 N MSG
"RTN","MAGENCHK",22,0)
 S XPDQUIT=2 ; Do not install this transport global but leave it in ^XTMP.
"RTN","MAGENCHK",23,0)
 S MSG(1)="The DICOM FAILED IMAGES file is not empty.  Please correct all failed images"
"RTN","MAGENCHK",24,0)
 S MSG(2)="before attempting to continue with the installation of Patch 54."
"RTN","MAGENCHK",25,0)
 D BMES^XPDUTL(.MSG)
"RTN","MAGENCHK",26,0)
 Q
"RTN","MAGIPS54")
0^^B43549700
"RTN","MAGIPS54",1,0)
MAGIPS54 ;Post init routine to queue site activity at install. ; 09/11/2008 02:17 pm
"RTN","MAGIPS54",2,0)
 ;;3.0;IMAGING;**54**;03-July-2009;;Build 1424
"RTN","MAGIPS54",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGIPS54",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGIPS54",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGIPS54",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGIPS54",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGIPS54",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGIPS54",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGIPS54",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGIPS54",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGIPS54",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGIPS54",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGIPS54",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGIPS54",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGIPS54",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGIPS54",17,0)
 ;;
"RTN","MAGIPS54",18,0)
 Q
"RTN","MAGIPS54",19,0)
 ;
"RTN","MAGIPS54",20,0)
PRE ;
"RTN","MAGIPS54",21,0)
 N DIU
"RTN","MAGIPS54",22,0)
 ; Remove obsolete DD definitions
"RTN","MAGIPS54",23,0)
 F DIU=2006.589 D
"RTN","MAGIPS54",24,0)
 . S DIU(0)="" D EN^DIU2
"RTN","MAGIPS54",25,0)
 . Q
"RTN","MAGIPS54",26,0)
 K ^MAGDICOM(2006.589)
"RTN","MAGIPS54",27,0)
 Q
"RTN","MAGIPS54",28,0)
 ;
"RTN","MAGIPS54",29,0)
POST N CVT,OPT
"RTN","MAGIPS54",30,0)
 ;  1. Add RPCs to Secondary menu(s)
"RTN","MAGIPS54",31,0)
 ;  2. Convert tables
"RTN","MAGIPS54",32,0)
 ;  3. Run INIT^MAGDRUID (create UID root)
"RTN","MAGIPS54",33,0)
 ;  4. Remove any dangling cross references from #2006.575
"RTN","MAGIPS54",34,0)
 ;
"RTN","MAGIPS54",35,0)
 F OPT="MAG DICOM GATEWAY FULL","MAG DICOM GATEWAY VIEW" D
"RTN","MAGIPS54",36,0)
 . ; Don't ADDRPC("MAG DICOM CHECK MACHINE ID",OPT) ; removed at site
"RTN","MAGIPS54",37,0)
 . D ADDRPC("MAG DICOM GET MACHINE ID",OPT)
"RTN","MAGIPS54",38,0)
 . D ADDRPC("MAG DICOM GET UID ROOT",OPT)
"RTN","MAGIPS54",39,0)
 . ; Don't ADDRPC("MAG DICOM UPDATE MACHINE ID",OPT) ; removed at site
"RTN","MAGIPS54",40,0)
 . D ADDRPC("MAG GET SOP CLASS METHOD",OPT)
"RTN","MAGIPS54",41,0)
 . Q
"RTN","MAGIPS54",42,0)
 ;
"RTN","MAGIPS54",43,0)
 D  ; Convert Tables:
"RTN","MAGIPS54",44,0)
 . ; 2006.5641 (Gateway Registry)
"RTN","MAGIPS54",45,0)
 . ; 2006.5715 (Last Image UID)
"RTN","MAGIPS54",46,0)
 . ;
"RTN","MAGIPS54",47,0)
 . ; NOTE: The code below is such that if this routine
"RTN","MAGIPS54",48,0)
 . ;       is run multiple times, the 2nd and later times
"RTN","MAGIPS54",49,0)
 . ;       are no-ops.
"RTN","MAGIPS54",50,0)
 . ;
"RTN","MAGIPS54",51,0)
 . N D0,ID,HN,HOST,L,LO,LOC,N,NA,UID,UP,X
"RTN","MAGIPS54",52,0)
 . S LO="abcdefghijklmnopqrstuvwxyz"
"RTN","MAGIPS54",53,0)
 . S UP="ABCDEFGHIJKLMNOPQRSTUVWXYZ"
"RTN","MAGIPS54",54,0)
 . S D0=0 F  S D0=$O(^MAGDICOM(2006.5641,D0)) Q:'D0  D
"RTN","MAGIPS54",55,0)
 . . S X=$G(^MAGDICOM(2006.5641,D0,0)),ID=$P(X,"^",1),NA=$P(X,"^",2)
"RTN","MAGIPS54",56,0)
 . . Q:ID  ; Entry is already converted
"RTN","MAGIPS54",57,0)
 . . S HN=$TR(NA,LO,UP)
"RTN","MAGIPS54",58,0)
 . . D:ID'=""
"RTN","MAGIPS54",59,0)
 . . . K ^MAGDICOM(2006.5641,"B",ID,D0)
"RTN","MAGIPS54",60,0)
 . . . S ^MAGDICOM(2006.5641,"B",D0,D0)=""
"RTN","MAGIPS54",61,0)
 . . . S $P(^MAGDICOM(2006.5641,D0,0),"^",1,2)=D0_"^"_HN
"RTN","MAGIPS54",62,0)
 . . . S HOST(ID)=HN
"RTN","MAGIPS54",63,0)
 . . . Q
"RTN","MAGIPS54",64,0)
 . . D:NA'=""
"RTN","MAGIPS54",65,0)
 . . . K ^MAGDICOM(2006.5641,"C",NA,D0)
"RTN","MAGIPS54",66,0)
 . . . S ^MAGDICOM(2006.5641,"C",HN,D0)=""
"RTN","MAGIPS54",67,0)
 . . . Q
"RTN","MAGIPS54",68,0)
 . . Q
"RTN","MAGIPS54",69,0)
 . S (N,L,D0)=0 F  S D0=$O(^MAGD(2006.5715,D0)) Q:'D0  D
"RTN","MAGIPS54",70,0)
 . . S X=$G(^MAGD(2006.5715,D0,0)),UID=$P(X,"^",2),X=$P(X,"^",1)
"RTN","MAGIPS54",71,0)
 . . Q:X'?1U  ; Entry is empty or already converted
"RTN","MAGIPS54",72,0)
 . . I X'="" K ^MAGD(2006.5715,"B",X,D0) S X=$G(HOST(X))
"RTN","MAGIPS54",73,0)
 . . I X="" K ^MAGD(2006.5715,D0) Q
"RTN","MAGIPS54",74,0)
 . . S N=N+1,L=D0,^MAGD(2006.5715,D0,0)=X_"^"_UID
"RTN","MAGIPS54",75,0)
 . . S ^MAGD(2006.5715,"B",X,D0)=""
"RTN","MAGIPS54",76,0)
 . . Q
"RTN","MAGIPS54",77,0)
 . S ^MAGD(2006.5715,0)="CURRENT IMAGE^2006.5715^"_L_"^"_N
"RTN","MAGIPS54",78,0)
 . Q
"RTN","MAGIPS54",79,0)
 ;
"RTN","MAGIPS54",80,0)
 D INIT^MAGDRUID
"RTN","MAGIPS54",81,0)
 D UPDATE
"RTN","MAGIPS54",82,0)
 ;
"RTN","MAGIPS54",83,0)
 D  ; Add shortcuts to DICOM Correct
"RTN","MAGIPS54",84,0)
 . N FDA,IEN,LBL,MSG,SUB
"RTN","MAGIPS54",85,0)
 . S SUB(1)="MAGD FIX DICOM FILE",LBL(1)="RAD"
"RTN","MAGIPS54",86,0)
 . S SUB(2)="MAGD FIX CLINSPEC DICOM FILE",LBL(2)="CLN"
"RTN","MAGIPS54",87,0)
 . D FIND^DIC(19,"",".001","","MAGD DICOM MENU","","B","","","LST","MSG")
"RTN","MAGIPS54",88,0)
 . S LST="" F  S LST=$O(LST("DILIST",2,LST)) Q:LST=""  D
"RTN","MAGIPS54",89,0)
 . . F SUB=1,2 D
"RTN","MAGIPS54",90,0)
 . . . K FDA,IEN,MSG
"RTN","MAGIPS54",91,0)
 . . . S FDA(19.01,"?1,"_LST("DILIST",2,LST)_",",.01)=SUB(SUB)
"RTN","MAGIPS54",92,0)
 . . . S FDA(19.01,"?1,"_LST("DILIST",2,LST)_",",2)=LBL(SUB)
"RTN","MAGIPS54",93,0)
 . . . D UPDATE^DIE("E","FDA","IEN","MSG")
"RTN","MAGIPS54",94,0)
 . . . Q
"RTN","MAGIPS54",95,0)
 . . Q
"RTN","MAGIPS54",96,0)
 . Q
"RTN","MAGIPS54",97,0)
 ;
"RTN","MAGIPS54",98,0)
 D  ; Confirmation message
"RTN","MAGIPS54",99,0)
 . N CT,CNT,D,D0,D1,D2,DDATE,DG,DIC,DICR,DIW,MAGMSG,ST,XMID,XMY
"RTN","MAGIPS54",100,0)
 . ;
"RTN","MAGIPS54",101,0)
 . D GETENV^%ZOSV
"RTN","MAGIPS54",102,0)
 . S CNT=0
"RTN","MAGIPS54",103,0)
 . S CNT=CNT+1,MAGMSG(CNT)="PACKAGE INSTALL"
"RTN","MAGIPS54",104,0)
 . S CNT=CNT+1,MAGMSG(CNT)="SITE: "_$$KSP^XUPARAM("WHERE")
"RTN","MAGIPS54",105,0)
 . S CNT=CNT+1,MAGMSG(CNT)="PACKAGE: "_XPDNM
"RTN","MAGIPS54",106,0)
 . S CNT=CNT+1,MAGMSG(CNT)="Version: "_$$VER^XPDUTL(XPDNM)
"RTN","MAGIPS54",107,0)
 . S ST=$$GET1^DIQ(9.7,XPDA,11,"I")
"RTN","MAGIPS54",108,0)
 . S CNT=CNT+1,MAGMSG(CNT)="Start time: "_$$FMTE^XLFDT(ST)
"RTN","MAGIPS54",109,0)
 . S CT=$$GET1^DIQ(9.7,XPDA,17,"I") S:+CT'=CT CT=$$NOW^XLFDT()
"RTN","MAGIPS54",110,0)
 . S CNT=CNT+1,MAGMSG(CNT)="Completion time: "_$$FMTE^XLFDT(CT)
"RTN","MAGIPS54",111,0)
 . S CNT=CNT+1,MAGMSG(CNT)="Run time: "_$$FMDIFF^XLFDT(CT,ST,3)
"RTN","MAGIPS54",112,0)
 . S CNT=CNT+1,MAGMSG(CNT)="Environment: "_Y
"RTN","MAGIPS54",113,0)
 . S CNT=CNT+1,MAGMSG(CNT)="FILE COMMENT: "_$$GET1^DIQ(9.7,XPDA,6,"I")
"RTN","MAGIPS54",114,0)
 . S CNT=CNT+1,MAGMSG(CNT)="DATE: "_$$NOW^XLFDT()
"RTN","MAGIPS54",115,0)
 . S CNT=CNT+1,MAGMSG(CNT)="Installed by: "_$$GET1^DIQ(9.7,XPDA,9,"E")
"RTN","MAGIPS54",116,0)
 . S CNT=CNT+1,MAGMSG(CNT)="Install Name: "_$$GET1^DIQ(9.7,XPDA,.01,"E")
"RTN","MAGIPS54",117,0)
 . S DDATE=$$GET1^DIQ(9.7,XPDA,51,"I")
"RTN","MAGIPS54",118,0)
 . S CNT=CNT+1,MAGMSG(CNT)="Distribution Date: "_$$FMTE^XLFDT(DDATE)
"RTN","MAGIPS54",119,0)
 . S:$G(CVT)'="" CNT=CNT+1,MAGMSG(CNT)="Conversion time: "_CVT
"RTN","MAGIPS54",120,0)
 . S XMSUB=XPDNM_" INSTALLATION"
"RTN","MAGIPS54",121,0)
 . S XMID=$G(DUZ) S:'XMID XMID=.5
"RTN","MAGIPS54",122,0)
 . S XMY(XMID)=""
"RTN","MAGIPS54",123,0)
 . S XMY("G.MAG SERVER")=""
"RTN","MAGIPS54",124,0)
 . S:$G(MAGDUZ) XMY(MAGDUZ)=""
"RTN","MAGIPS54",125,0)
 . S XMSUB=$E(XMSUB,1,63)
"RTN","MAGIPS54",126,0)
 . D SENDMSG^XMXAPI(XMID,XMSUB,"MAGMSG",.XMY,,.XMZ,)
"RTN","MAGIPS54",127,0)
 . I $G(XMERR) M XMERR=^TMP("XMERR",$J) S $EC=",U13-Cannot send MailMan message,"
"RTN","MAGIPS54",128,0)
 . Q
"RTN","MAGIPS54",129,0)
 K ^MAGD(2006.575) S ^MAGD(2006.575,0)="DICOM FAILED IMAGES^2006.575" ; remove any vestigal nodes
"RTN","MAGIPS54",130,0)
 Q
"RTN","MAGIPS54",131,0)
 ;
"RTN","MAGIPS54",132,0)
ADDRPC(RPCNAME,OPTNAME) N DA,DIC
"RTN","MAGIPS54",133,0)
 S DIC="^DIC(19,",DIC(0)="",X=OPTNAME D ^DIC
"RTN","MAGIPS54",134,0)
 I Y<0 D  Q
"RTN","MAGIPS54",135,0)
 . W !,"Cannot add """_RPCNAME_""" to """_OPTNAME_"""."
"RTN","MAGIPS54",136,0)
 . W !,"Cannot find """_OPTNAME_"""."
"RTN","MAGIPS54",137,0)
 . Q
"RTN","MAGIPS54",138,0)
 S DA(1)=+Y
"RTN","MAGIPS54",139,0)
 S DIC=DIC_DA(1)_",""RPC"","
"RTN","MAGIPS54",140,0)
 S DIC(0)="L" ; LAYGO should be allowed here
"RTN","MAGIPS54",141,0)
 S X=RPCNAME
"RTN","MAGIPS54",142,0)
 D ^DIC
"RTN","MAGIPS54",143,0)
 I Y<0 D  Q
"RTN","MAGIPS54",144,0)
 . W !,"Cannot add """_RPCNAME_""" to """_OPTNAME_"""."
"RTN","MAGIPS54",145,0)
 . W !,"Cannot find """_RPCNAME_"""."
"RTN","MAGIPS54",146,0)
 . Q
"RTN","MAGIPS54",147,0)
 Q
"RTN","MAGIPS54",148,0)
 ;
"RTN","MAGIPS54",149,0)
UP(X) ; special UPPER CASE function -- removes redundant blanks as well
"RTN","MAGIPS54",150,0)
 F  Q:X'["  "  S $E(X,$F(X,"  ")-1)=""  ; remove redundant blank
"RTN","MAGIPS54",151,0)
 I $E(X)=" " S $E(X)=""  ; remove leading blank
"RTN","MAGIPS54",152,0)
 I $E(X,$L(X))=" " S $E(X,$L(X))=""  ; remove trailing blank
"RTN","MAGIPS54",153,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz^|","ABCDEFGHIJKLMNOPQRSTUVWXYZ~~")
"RTN","MAGIPS54",154,0)
 ;
"RTN","MAGIPS54",155,0)
UPDATE ;Update description for menu option
"RTN","MAGIPS54",156,0)
 N IEN
"RTN","MAGIPS54",157,0)
 S IEN=$$FIND1^DIC(19,"","X","MAGD DICOM MENU","","","")
"RTN","MAGIPS54",158,0)
 I 'IEN D BMES^XPDUTL("Menu option MAGD DICOM MENU is undefined in the Option file!") Q
"RTN","MAGIPS54",159,0)
 S ^TMP($J,"WP",1)="Menu to allow correcting of DICOM Image file references that failed"
"RTN","MAGIPS54",160,0)
 S ^TMP($J,"WP",2)="the matching process during the initial DICOM image acquistion."
"RTN","MAGIPS54",161,0)
 D WP^DIE(19,IEN_",",3.5,"","^TMP($J,""WP"")","MAGMSG")
"RTN","MAGIPS54",162,0)
 I $D(MAGMSG) D BMES^XPDUTL("Error setting the description field for MAGD DICOM MENU")
"RTN","MAGIPS54",163,0)
 K ^TMP($J,"WP")
"RTN","MAGIPS54",164,0)
 Q
"RTN","MAGIPS54",165,0)
 
"RTN","MAGUE001")
0^53^B8353040
"RTN","MAGUE001",1,0)
MAGUE001 ;WOIFO/MLH - database encapsulation - study description for DICOM ; 08 Aug 2008 9:57 AM
"RTN","MAGUE001",2,0)
 ;;3.0;IMAGING;**54**;03-July-2009;;Build 1424
"RTN","MAGUE001",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGUE001",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGUE001",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGUE001",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGUE001",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGUE001",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGUE001",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGUE001",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGUE001",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGUE001",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGUE001",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGUE001",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGUE001",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGUE001",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGUE001",17,0)
 ;;
"RTN","MAGUE001",18,0)
 Q
"RTN","MAGUE001",19,0)
 ;
"RTN","MAGUE001",20,0)
STYDESC(IMAGE,ERR) ;FUNCTION - return study description for an image
"RTN","MAGUE001",21,0)
 ; input:    IMAGE     IEN of the image on ^MAG(2005)
"RTN","MAGUE001",22,0)
 ; function return:    p1   study description of the image
"RTN","MAGUE001",23,0)
 ;   (^-pieces)        p2   descriptive error message if any
"RTN","MAGUE001",24,0)
 ; 
"RTN","MAGUE001",25,0)
 N STYDESC ; -- study description
"RTN","MAGUE001",26,0)
 N MAGR2 ; ---- 2 node of the image on ^MAG(2005)
"RTN","MAGUE001",27,0)
 N MAGPKG ; --- name of package with which image is associated
"RTN","MAGUE001",28,0)
 S ERR=""
"RTN","MAGUE001",29,0)
 I '$D(^MAG(2005,IMAGE)) S ERR="13~Image record not defined" Q ""
"RTN","MAGUE001",30,0)
 S MAGR2=$G(^MAG(2005,IMAGE,2))
"RTN","MAGUE001",31,0)
 I MAGR2="" S ERR="11~2 node missing from image file" Q ""
"RTN","MAGUE001",32,0)
 S MAGPKG=$P(MAGR2,"^",6)
"RTN","MAGUE001",33,0)
 I MAGPKG="" S ERR="12~Image not associated with any known package" Q ""
"RTN","MAGUE001",34,0)
 D  ; radiology or consult procedure?
"RTN","MAGUE001",35,0)
 . I MAGPKG=74 D  Q  ; radiology image
"RTN","MAGUE001",36,0)
 . . N MAGRRPTI ; -- radiology report index
"RTN","MAGUE001",37,0)
 . . N MAGRORDR ; -- radiology order record
"RTN","MAGUE001",38,0)
 . . N MAGRPROC ; -- radiology procedure code
"RTN","MAGUE001",39,0)
 . . S MAGRRPTI=$P(MAGR2,"^",7)
"RTN","MAGUE001",40,0)
 . . S MAGRORDR=$$RORDRR^MAGUE002(MAGRRPTI,.ERR)
"RTN","MAGUE001",41,0)
 . . I ERR'="" S STYDESC="" Q
"RTN","MAGUE001",42,0)
 . . S MAGRPROC=$P(MAGRORDR,"^",2)
"RTN","MAGUE001",43,0)
 . . I 'MAGRPROC S STYDESC="",ERR="13~Procedure code missing from radiology order" Q
"RTN","MAGUE001",44,0)
 . . S STYDESC=$$PROCDESC^MAGUE003(MAGRPROC,.ERR)
"RTN","MAGUE001",45,0)
 . . Q
"RTN","MAGUE001",46,0)
 . I (MAGPKG=8925)!(MAGPKG=2006.5839) D  Q  ; consult image
"RTN","MAGUE001",47,0)
 . . S STYDESC=$P(MAGR2,"^",4)
"RTN","MAGUE001",48,0)
 . . Q
"RTN","MAGUE001",49,0)
 . S STYDESC="",ERR="14~Study description access method not defined"
"RTN","MAGUE001",50,0)
 . Q
"RTN","MAGUE001",51,0)
 Q STYDESC
"RTN","MAGUE002")
0^54^B6508124
"RTN","MAGUE002",1,0)
MAGUE002 ;WOIFO/MLH - database encapsulation - radiology order record ; 08 Aug 2008 9:41 AM
"RTN","MAGUE002",2,0)
 ;;3.0;IMAGING;**54**;03-July-2009;;Build 1424
"RTN","MAGUE002",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGUE002",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGUE002",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGUE002",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGUE002",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGUE002",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGUE002",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGUE002",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGUE002",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGUE002",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGUE002",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGUE002",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGUE002",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGUE002",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGUE002",17,0)
 ;;
"RTN","MAGUE002",18,0)
 Q
"RTN","MAGUE002",19,0)
 ;
"RTN","MAGUE002",20,0)
RORDRR(MAGRRPTI,ERR) ;FUNCTION - return a radiology order record
"RTN","MAGUE002",21,0)
 ; input:    MAGRRPTI  radiology report index from image record
"RTN","MAGUE002",22,0)
 ; output:   ERR       error message if couldn't get record
"RTN","MAGUE002",23,0)
 ; function return:    radiology order record
"RTN","MAGUE002",24,0)
 ; 
"RTN","MAGUE002",25,0)
 N MAGRRPTR ; -- radiology report record
"RTN","MAGUE002",26,0)
 N MAGD0 ; ----- Radiology patient file IEN
"RTN","MAGUE002",27,0)
 N MAGD1 ; ----- date index to order record in rad pt file
"RTN","MAGUE002",28,0)
 N MAGD2 ; ----- subdate index to order record in rad pt file
"RTN","MAGUE002",29,0)
 N V ; --------- scratch var
"RTN","MAGUE002",30,0)
 N MAGRORDR ; -- radiology order record
"RTN","MAGUE002",31,0)
 N MAGRPROC ; -- radiology procedure code
"RTN","MAGUE002",32,0)
 S ERR=""
"RTN","MAGUE002",33,0)
 S MAGRRPTR=$G(^RARPT(MAGRRPTI,0))
"RTN","MAGUE002",34,0)
 S MAGD0=$P(MAGRRPTR,"^",2)
"RTN","MAGUE002",35,0)
 I 'MAGD0 S ERR="1~Radiology patient not found" Q ""
"RTN","MAGUE002",36,0)
 S MAGD1=9999999.9999-$P(MAGRRPTR,"^",3)
"RTN","MAGUE002",37,0)
 S V=$P(MAGRRPTR,"^",4)
"RTN","MAGUE002",38,0)
 S MAGD2=$O(^RADPT(MAGD0,"DT",MAGD1,"P","B",V,"")) ; IA # 1172
"RTN","MAGUE002",39,0)
 I 'MAGD2 S ERR="3~Order record pointer not found" Q ""
"RTN","MAGUE002",40,0)
 S MAGRORDR=$G(^RADPT(MAGD0,"DT",MAGD1,"P",MAGD2,0)) ; IA # 1172
"RTN","MAGUE002",41,0)
 I 'MAGRORDR S ERR="4~Radiology order record not found" Q ""
"RTN","MAGUE002",42,0)
 S ERR=""
"RTN","MAGUE002",43,0)
 Q MAGRORDR
"RTN","MAGUE003")
0^55^B3998805
"RTN","MAGUE003",1,0)
MAGUE003 ;WOIFO/MLH - database encapsulation - radiology procedure description ; 08 Aug 2008 9:49 AM
"RTN","MAGUE003",2,0)
 ;;3.0;IMAGING;**54**;03-July-2009;;Build 1424
"RTN","MAGUE003",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGUE003",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGUE003",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGUE003",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGUE003",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGUE003",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGUE003",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGUE003",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGUE003",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGUE003",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGUE003",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGUE003",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGUE003",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGUE003",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGUE003",17,0)
 ;;
"RTN","MAGUE003",18,0)
 Q
"RTN","MAGUE003",19,0)
 ;
"RTN","MAGUE003",20,0)
PROCDESC(PROCCD,ERR) ;FUNCTION - return study description for an image
"RTN","MAGUE003",21,0)
 ; input:    PROCCD    procedure IEN on ^RAMIS(71)
"RTN","MAGUE003",22,0)
 ; output:   ERR       descriptive error message if any
"RTN","MAGUE003",23,0)
 ; function return:    procedure code description
"RTN","MAGUE003",24,0)
 ; 
"RTN","MAGUE003",25,0)
 N RPROCR ; ---- radiology procedure record
"RTN","MAGUE003",26,0)
 S RPROCR=$G(^RAMIS(71,+PROCCD,0)) ; IA # 1174
"RTN","MAGUE003",27,0)
 I RPROCR="" S ERR="1~Missing radiology procedure code record" Q ""
"RTN","MAGUE003",28,0)
 S ERR=""
"RTN","MAGUE003",29,0)
 Q $P(RPROCR,"^",1)
"RTN","MAGVCHK")
0^56^B23304941
"RTN","MAGVCHK",1,0)
MAGVCHK ;WOIFO/EdM - Checksums of Imaging Routines ; 01/08/2007 10:39
"RTN","MAGVCHK",2,0)
 ;;3.0;IMAGING;**51,54**;03-July-2009;;Build 1424
"RTN","MAGVCHK",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGVCHK",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGVCHK",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGVCHK",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGVCHK",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGVCHK",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGVCHK",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGVCHK",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGVCHK",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGVCHK",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGVCHK",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGVCHK",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGVCHK",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGVCHK",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGVCHK",17,0)
 ;;
"RTN","MAGVCHK",18,0)
 Q
"RTN","MAGVCHK",19,0)
 ; The entry below is called from ET-Phone-Home
"RTN","MAGVCHK",20,0)
 ;
"RTN","MAGVCHK",21,0)
GATEWAY(ZTSK,MAGDBB) ; RPC = MAG VISTA CHECKSUMS
"RTN","MAGVCHK",22,0)
 N D0,X,ZTDESC,ZTDTH,ZTRTN,ZTSAVE
"RTN","MAGVCHK",23,0)
 S ZTSK=0,D0=$O(^MAG(2006.1,0)) Q:'D0
"RTN","MAGVCHK",24,0)
 Q:$G(MAGDBB)'["@"  ; Must be valid e-mail address
"RTN","MAGVCHK",25,0)
 L +^MAG(2006.1,"CHECKSUM"):10 Q:'$T  ; Don't hold up other processing...
"RTN","MAGVCHK",26,0)
 D:$G(^MAG(2006.1,D0,"LAST CHECKSUM"))<DT
"RTN","MAGVCHK",27,0)
 . ;
"RTN","MAGVCHK",28,0)
 . S ZTRTN="CHECK^"_$T(+0)
"RTN","MAGVCHK",29,0)
 . S ZTDESC="Imaging Checksum Collection"
"RTN","MAGVCHK",30,0)
 . S ZTDTH=$H ; Now!
"RTN","MAGVCHK",31,0)
 . S ZTSAVE("MAGDBB")=MAGDBB
"RTN","MAGVCHK",32,0)
 . D ^%ZTLOAD,HOME^%ZIS
"RTN","MAGVCHK",33,0)
 . I '$D(ZTSK) S ZTSK=0 Q  ; TaskMan did not Accept Request
"RTN","MAGVCHK",34,0)
 . ; No matter how many sub-sites in the consolidated site,
"RTN","MAGVCHK",35,0)
 . ; run this program only once per day:
"RTN","MAGVCHK",36,0)
 . S D0=0 F  S D0=$O(^MAG(2006.1,D0)) Q:'D0  S ^MAG(2006.1,D0,"LAST CHECKSUM")=DT
"RTN","MAGVCHK",37,0)
 . Q
"RTN","MAGVCHK",38,0)
 L -^MAG(2006.1,"CHECKSUM")
"RTN","MAGVCHK",39,0)
 Q
"RTN","MAGVCHK",40,0)
 ;
"RTN","MAGVCHK",41,0)
CHECK ; Collect checksums for Imaging Routines
"RTN","MAGVCHK",42,0)
 N CUR,I,MAGFM,R,SITE,X,XMERR,XMID,XMSUB,XMY,XMZ
"RTN","MAGVCHK",43,0)
 Q:$G(MAGDBB)'["@"  ; Must be valid e-mail address
"RTN","MAGVCHK",44,0)
 D DT^DICRW
"RTN","MAGVCHK",45,0)
 D
"RTN","MAGVCHK",46,0)
 . N D1,D2,DATE,I,MAGDATA,MSG,N,PKG,PKT,PV
"RTN","MAGVCHK",47,0)
 . S CUR=$$VERSION^XPDUTL("IMAGING")
"RTN","MAGVCHK",48,0)
 . D LIST^DIC(9.7,,".01;2I;51I","K","*","MAG","MAG*","B",,,"MAGDATA","MSG")
"RTN","MAGVCHK",49,0)
 . S I="" F  S I=$O(MAGDATA("DILIST",2,I)) Q:I=""  D
"RTN","MAGVCHK",50,0)
 . . S I(+$G(MAGDATA("DILIST","ID",I,2)),I)=""
"RTN","MAGVCHK",51,0)
 . . S X=$G(MAGDATA("DILIST","ID",I,.01)) Q:X=""
"RTN","MAGVCHK",52,0)
 . . S D1=$G(MAGDATA("DILIST","ID",I,51)) Q:D1=""
"RTN","MAGVCHK",53,0)
 . . S D2=$G(MAGDATA("DILIST","ID",I,2))
"RTN","MAGVCHK",54,0)
 . . S CUR(X)=D1_"^"_D2
"RTN","MAGVCHK",55,0)
 . . Q
"RTN","MAGVCHK",56,0)
 . S N=0,DATE="" F  S DATE=$O(I(DATE)) Q:DATE=""  D
"RTN","MAGVCHK",57,0)
 . . S I="" F  S I=$O(I(DATE,I)) Q:I=""  D
"RTN","MAGVCHK",58,0)
 . . . S X=$G(MAGDATA("DILIST","ID",I,.01)) Q:$P(X,"*",2)'=CUR
"RTN","MAGVCHK",59,0)
 . . . S PATCH=+$P(X,"*",3) Q:'PATCH
"RTN","MAGVCHK",60,0)
 . . . K:$G(N(1,PATCH)) N(2,N(1,PATCH))
"RTN","MAGVCHK",61,0)
 . . . S N=N+1,N(1,PATCH)=N,N(2,N)=PATCH
"RTN","MAGVCHK",62,0)
 . . . S N(3,N)=$G(MAGDATA("DILIST","ID",I,51))
"RTN","MAGVCHK",63,0)
 . . . Q
"RTN","MAGVCHK",64,0)
 . . Q
"RTN","MAGVCHK",65,0)
 . S CUR=CUR_";IMAGING;",I="**",X=""
"RTN","MAGVCHK",66,0)
 . S N="" F  S N=$O(N(2,N)) Q:N=""  S CUR=CUR_I_N(2,N),X=N(3,N),I=","
"RTN","MAGVCHK",67,0)
 . S:I'="**" CUR=CUR_"**"
"RTN","MAGVCHK",68,0)
 . S:X'="" CUR=CUR_";"_$$FMDATE(X)
"RTN","MAGVCHK",69,0)
 . Q
"RTN","MAGVCHK",70,0)
 S SITE=0 S:$T(INST^XUPARAM)'="" SITE=$$KSP^XUPARAM("INST")
"RTN","MAGVCHK",71,0)
 D:SITE FIND^DIC(4,"",.01,"A",SITE,"*",,,,"MAGFM")
"RTN","MAGVCHK",72,0)
 S SITE=$G(MAGFM("DILIST",1,1)) S:SITE'="" SITE=SITE_" "
"RTN","MAGVCHK",73,0)
 S SITE=SITE_"VistA System"
"RTN","MAGVCHK",74,0)
 K ^TMP("MAG",$J,"CHECKSUM"),MAGFM
"RTN","MAGVCHK",75,0)
 S I=0
"RTN","MAGVCHK",76,0)
 K X D DOMAIN^MAGDRPC1(.X)
"RTN","MAGVCHK",77,0)
 S I=I+1,^TMP("MAG",$J,"CHECKSUM",I)="SID="_X
"RTN","MAGVCHK",78,0)
 S I=I+1,^TMP("MAG",$J,"CHECKSUM",I)="DT="_DT
"RTN","MAGVCHK",79,0)
 S I=I+1,^TMP("MAG",$J,"CHECKSUM",I)="IP=VistA"
"RTN","MAGVCHK",80,0)
 S I=I+1,^TMP("MAG",$J,"CHECKSUM",I)="BLD="_CUR
"RTN","MAGVCHK",81,0)
 S CUR="" F  S CUR=$O(CUR(CUR)) Q:CUR=""  D
"RTN","MAGVCHK",82,0)
 . S I=I+1,^TMP("MAG",$J,"CHECKSUM",I)="PAT="_CUR_"^"_CUR(CUR)
"RTN","MAGVCHK",83,0)
 . Q
"RTN","MAGVCHK",84,0)
 S I=I+1,^TMP("MAG",$J,"CHECKSUM",I)="TTL="_SITE
"RTN","MAGVCHK",85,0)
 S I=I+1,^TMP("MAG",$J,"CHECKSUM",I)="PHY=VistA"
"RTN","MAGVCHK",86,0)
 S R="MAG" F  S R=$O(^$R(R)) Q:$E(R,1,3)'="MAG"  D
"RTN","MAGVCHK",87,0)
 . S I=I+1,^TMP("MAG",$J,"CHECKSUM",I)="RTN="_R
"RTN","MAGVCHK",88,0)
 . S I=I+1,^TMP("MAG",$J,"CHECKSUM",I)="CHK="_$$CHK1(R)_"^"_$$CHK2(R)
"RTN","MAGVCHK",89,0)
 . Q
"RTN","MAGVCHK",90,0)
 S I=I+1,^TMP("MAG",$J,"CHECKSUM",I)=""
"RTN","MAGVCHK",91,0)
 S XMSUB="Daily Report"
"RTN","MAGVCHK",92,0)
 S XMID=$G(DUZ) S:'XMID XMID=.5
"RTN","MAGVCHK",93,0)
 S XMY(XMID)=""
"RTN","MAGVCHK",94,0)
 S XMY(MAGDBB)=""
"RTN","MAGVCHK",95,0)
 D SENDMSG^XMXAPI(XMID,XMSUB,$NAME(^TMP("MAG",$J,"CHECKSUM")),.XMY,,.XMZ,)
"RTN","MAGVCHK",96,0)
 I $G(XMERR) M XMERR=^TMP("XMERR",$J) S $EC=",U13-Cannot send MailMan message,"
"RTN","MAGVCHK",97,0)
 K ^TMP("MAG",$J,"CHECKSUM")
"RTN","MAGVCHK",98,0)
 Q
"RTN","MAGVCHK",99,0)
 ;
"RTN","MAGVCHK",100,0)
CHK1(R) N K,X,Y
"RTN","MAGVCHK",101,0)
 S Y=0
"RTN","MAGVCHK",102,0)
 F K=1:1 S X=$T(+K^@R) Q:X=""  S:K'=2 Y=Y+$$C1(X)
"RTN","MAGVCHK",103,0)
 Q Y
"RTN","MAGVCHK",104,0)
 ;
"RTN","MAGVCHK",105,0)
C1(X) N F,I,Y
"RTN","MAGVCHK",106,0)
 S Y=0
"RTN","MAGVCHK",107,0)
 S F=$F(X," "),F=$S($E(X,F)'=";":$L(X),$E(X,F+1)=";":$L(X),1:F-2)
"RTN","MAGVCHK",108,0)
 F I=1:1:F S Y=$A(X,I)*I+Y
"RTN","MAGVCHK",109,0)
 Q Y
"RTN","MAGVCHK",110,0)
 ;
"RTN","MAGVCHK",111,0)
CHK2(R) N K,X,Y
"RTN","MAGVCHK",112,0)
 S Y=0
"RTN","MAGVCHK",113,0)
 F K=1:1 S X=$T(+K^@R) Q:X=""  S:K'=2 Y=Y+$$C2(X,K)
"RTN","MAGVCHK",114,0)
 Q Y
"RTN","MAGVCHK",115,0)
 ;
"RTN","MAGVCHK",116,0)
C2(X,K) N F,I,Y
"RTN","MAGVCHK",117,0)
 S Y=0
"RTN","MAGVCHK",118,0)
 S F=$F(X," "),F=$S($E(X,F)'=";":$L(X),$E(X,F+1)=";":$L(X),1:F-2)
"RTN","MAGVCHK",119,0)
 F I=1:1:F S Y=$A(X,I)*(I+K)+Y
"RTN","MAGVCHK",120,0)
 Q Y
"RTN","MAGVCHK",121,0)
 ;
"RTN","MAGVCHK",122,0)
FMDATE(X) N D,M,Y
"RTN","MAGVCHK",123,0)
 S X=X\1,D=X#100,M=X\100#100,Y=X\10000+1700
"RTN","MAGVCHK",124,0)
 Q D_"-"_$P("January February March April May June July August September October November December"," ",M)_"-"_Y
"RTN","MAGVCHK",125,0)
 ;
"RTN","MAGXCVC")
0^57^B40623229
"RTN","MAGXCVC",1,0)
MAGXCVC ;WOIFO/SEB,MLH - Image Index Conversion Commit ; 05/18/2007 11:23
"RTN","MAGXCVC",2,0)
 ;;3.0;IMAGING;**17,25,31,54**;03-July-2009;;Build 1424
"RTN","MAGXCVC",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGXCVC",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGXCVC",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGXCVC",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGXCVC",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGXCVC",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGXCVC",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGXCVC",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGXCVC",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGXCVC",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGXCVC",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGXCVC",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGXCVC",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGXCVC",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGXCVC",17,0)
 ;;
"RTN","MAGXCVC",18,0)
 Q
"RTN","MAGXCVC",19,0)
 ;
"RTN","MAGXCVC",20,0)
 ; Entry point for the commit image indices option (MAG IMAGE INDEX COMMIT indices)
"RTN","MAGXCVC",21,0)
COMMIT N START,END,FLAG,TMF,STATUS
"RTN","MAGXCVC",22,0)
 N ZTDTH,ZTIO,ZTRTN,ZTDESC,ZTSAVE,ZTSK ; -- TaskMan variables
"RTN","MAGXCVC",23,0)
 N INPUT ; -------------------------------- user input holder
"RTN","MAGXCVC",24,0)
 ;
"RTN","MAGXCVC",25,0)
 S STATUS=$G(^XTMP("MAG30P25","STATUS"))
"RTN","MAGXCVC",26,0)
 L +MAGTMP("IMAGE INDEX GENERATE"):0 E  D  G COMMITX
"RTN","MAGXCVC",27,0)
 . W !,"Image index generation still in progress. Please try again later."
"RTN","MAGXCVC",28,0)
 . Q
"RTN","MAGXCVC",29,0)
 L +MAGTMP("IMAGE INDEX COMMIT"):0 E  D  G COMMITX
"RTN","MAGXCVC",30,0)
 . W !,"Image index commit still in progress. Please try again later."
"RTN","MAGXCVC",31,0)
 . Q
"RTN","MAGXCVC",32,0)
 I '$D(^XTMP("MAGIXCVGEN")) D  G COMMITX
"RTN","MAGXCVC",33,0)
 . W !,"You must generate the image indices before running this option."
"RTN","MAGXCVC",34,0)
 . Q
"RTN","MAGXCVC",35,0)
 S (START,END)=0,FLAG=""
"RTN","MAGXCVC",36,0)
 D BOUNDS^MAGXCVP(.START,.END) I START="^" G COMMITX
"RTN","MAGXCVC",37,0)
 D RECREATE^MAGXCVP(.FLAG) I FLAG="^" G COMMITX
"RTN","MAGXCVC",38,0)
 R !!,"Commit new index entries? N // ",INPUT:DTIME
"RTN","MAGXCVC",39,0)
 I INPUT="" S INPUT="N"
"RTN","MAGXCVC",40,0)
 S INPUT=$$UCASE^MAGXCVP($E(INPUT))
"RTN","MAGXCVC",41,0)
 I INPUT'="Y" W !,"OK, entries not committed." G COMMITX
"RTN","MAGXCVC",42,0)
 D TASKMAN^MAGXCVP(.TMF) I TMF="^" G COMMITX
"RTN","MAGXCVC",43,0)
 S ZTSK=0 I TMF="" D COM1(START,END,FLAG,0) G COMMITX
"RTN","MAGXCVC",44,0)
 S ZTRTN="COMTM^MAGXCVC",ZTDESC="COMMIT IMAGE INDEX VALUES",ZTDTH=TMF,ZTIO=""
"RTN","MAGXCVC",45,0)
 S ZTSAVE("START")=START,ZTSAVE("END")=END,ZTSAVE("FLAG")=FLAG
"RTN","MAGXCVC",46,0)
 D ^%ZTLOAD
"RTN","MAGXCVC",47,0)
 W !!,"Image index commitment has been queued as task #"_ZTSK_"."
"RTN","MAGXCVC",48,0)
 ;
"RTN","MAGXCVC",49,0)
COMMITX ; Clean up locks from COMMIT initial processing.
"RTN","MAGXCVC",50,0)
 L -MAGTMP("IMAGE INDEX GENERATE")
"RTN","MAGXCVC",51,0)
 L -MAGTMP("IMAGE INDEX COMMIT")
"RTN","MAGXCVC",52,0)
 Q
"RTN","MAGXCVC",53,0)
 ;
"RTN","MAGXCVC",54,0)
 ; TaskMan entry point for committing image indices
"RTN","MAGXCVC",55,0)
COMTM D COM1(START,END,FLAG,1)
"RTN","MAGXCVC",56,0)
 Q
"RTN","MAGXCVC",57,0)
 ;
"RTN","MAGXCVC",58,0)
COM1(START,END,FLAG,QUEUED) N MAGIEN,CT,INDXDATA,INDX,STARTDT,ENDDT,SUMMARY,STOP,HISTORY,RESULT
"RTN","MAGXCVC",59,0)
 N PREVLOG ; ------ log entry of a previous committal
"RTN","MAGXCVC",60,0)
 N PREV0 ; -------- beginning MAGIEN of previous range
"RTN","MAGXCVC",61,0)
 N PREVF ; -------- ending MAGIEN of previous range
"RTN","MAGXCVC",62,0)
 N RANGE ; -------- array containing the current range being committed
"RTN","MAGXCVC",63,0)
 N T0 ; ----------- internal index of ^TMP($J,"PREVRNG") for range checks
"RTN","MAGXCVC",64,0)
 ;
"RTN","MAGXCVC",65,0)
 L +MAGTMP("IMAGE INDEX COMMIT"):900 E  Q  ; don't let more than one commit run at once!
"RTN","MAGXCVC",66,0)
 K ^XTMP("MAG30P25","SUMMARY") S $P(^XTMP("MAG30P25","STATUS"),U,13,14)=4_U_ZTSK
"RTN","MAGXCVC",67,0)
 S STARTDT=$$HTE^XLFDT($H,1)
"RTN","MAGXCVC",68,0)
 S START=+$G(START),END=+$G(END),STOP=0
"RTN","MAGXCVC",69,0)
 I END=0 S END=+$P($G(^MAG(2005,0)),U,3)
"RTN","MAGXCVC",70,0)
 S MAGIEN=START-1 I MAGIEN=-1 S MAGIEN=0
"RTN","MAGXCVC",71,0)
 S $P(^XTMP("MAG30P25","STATUS"),U,7,11)=DUZ_U_START_U_STARTDT_U_U
"RTN","MAGXCVC",72,0)
 I 'QUEUED W !!
"RTN","MAGXCVC",73,0)
 ; Now run the entries that are ready to commit.
"RTN","MAGXCVC",74,0)
 ; 
"RTN","MAGXCVC",75,0)
 K RANGE
"RTN","MAGXCVC",76,0)
 F CT=0:1 S MAGIEN=$O(^XTMP("MAGIXCVGEN",MAGIEN)) Q:MAGIEN>END!(+MAGIEN'=MAGIEN)  D  I STOP Q
"RTN","MAGXCVC",77,0)
 . D COM2(MAGIEN,CT,FLAG,QUEUED)
"RTN","MAGXCVC",78,0)
 . S $P(^XTMP("MAG30P25","STATUS"),U,12)=MAGIEN
"RTN","MAGXCVC",79,0)
 . I QUEUED,$$S^%ZTLOAD S STOP=1,$P(^XTMP("MAG30P25","STATUS"),U,13)=5
"RTN","MAGXCVC",80,0)
 . Q
"RTN","MAGXCVC",81,0)
 S ENDDT=$$HTE^XLFDT($H,1)
"RTN","MAGXCVC",82,0)
 S $P(^XTMP("MAG30P25","STATUS"),U,10,11)=$S(STOP:MAGIEN,1:END)_U_ENDDT
"RTN","MAGXCVC",83,0)
 S ^XTMP("MAG30P25","SUMMARY")=$P(^XTMP("MAG30P25","STATUS"),U,8,11)
"RTN","MAGXCVC",84,0)
 S HISTORY=$G(^XTMP("MAG30P25","HISTORY"))+1,^XTMP("MAG30P25","HISTORY")=HISTORY
"RTN","MAGXCVC",85,0)
 S ^XTMP("MAG30P25","HISTORY",HISTORY)=$P(^XTMP("MAG30P25","STATUS"),U,8,11)
"RTN","MAGXCVC",86,0)
 I 'STOP D  ; end-of-processing cleanup
"RTN","MAGXCVC",87,0)
 . S $P(^XTMP("MAG30P25","STATUS"),U,13)=6
"RTN","MAGXCVC",88,0)
 . D ENTRY^MAGLOG("P17CV",$G(DUZ),START,$T(+0),"","",START_"_"_END)
"RTN","MAGXCVC",89,0)
 . D NOTIFY^MAGXCVP(.RESULT,2,STARTDT,ENDDT,START,END,FLAG)
"RTN","MAGXCVC",90,0)
 . Q
"RTN","MAGXCVC",91,0)
 L -MAGTMP("IMAGE INDEX COMMIT")
"RTN","MAGXCVC",92,0)
 Q
"RTN","MAGXCVC",93,0)
 ;
"RTN","MAGXCVC",94,0)
COM2(MAGIEN,CT,FREC,QUEUED) N INDXDATA,SUMMARY
"RTN","MAGXCVC",95,0)
 N FQUIT ; -------- quit flag
"RTN","MAGXCVC",96,0)
 N PREV0 ; -------- beginning MAGIEN of previous range
"RTN","MAGXCVC",97,0)
 ;
"RTN","MAGXCVC",98,0)
 I 'QUEUED,CT#100=0 W MAGIEN
"RTN","MAGXCVC",99,0)
 I 'QUEUED,CT#10=0 W "."
"RTN","MAGXCVC",100,0)
 ;Patch 8 has been installed (NOOP MLH 12/6/02)
"RTN","MAGXCVC",101,0)
 ;or "recreate previously calculated indices" question answered no.
"RTN","MAGXCVC",102,0)
 I $TR($G(^MAG(2005,MAGIEN,40)),"^")]"" D
"RTN","MAGXCVC",103,0)
 . S FQUIT=1 ; Assume they may not recreate.
"RTN","MAGXCVC",104,0)
 . I $E($G(FREC))="N" Q  ; "Recreate previously calculated indices" question answered no.
"RTN","MAGXCVC",105,0)
 . ; Don't allow committal unless the previous calculation was done by us.
"RTN","MAGXCVC",106,0)
 . I $D(^MAGIXCVT(2006.96,MAGIEN)) K FQUIT ; ok
"RTN","MAGXCVC",107,0)
 . Q
"RTN","MAGXCVC",108,0)
 Q:$G(FQUIT)
"RTN","MAGXCVC",109,0)
 ;
"RTN","MAGXCVC",110,0)
 S INDXDATA="" D COMIEN(MAGIEN,.INDXDATA)
"RTN","MAGXCVC",111,0)
 K ^XTMP("MAGIXCVGEN",MAGIEN)
"RTN","MAGXCVC",112,0)
 I INDXDATA="" S INDXDATA="(none)"
"RTN","MAGXCVC",113,0)
 S SUMMARY=$G(^XTMP("MAG30P25","SUMMARY",INDXDATA))
"RTN","MAGXCVC",114,0)
 I SUMMARY="" S ^XTMP("MAG30P25","SUMMARY",INDXDATA)=1_U_MAGIEN_U_MAGIEN
"RTN","MAGXCVC",115,0)
 E  S ^XTMP("MAG30P25","SUMMARY",INDXDATA)=(SUMMARY+1)_U_$P(SUMMARY,U,2)_U_MAGIEN
"RTN","MAGXCVC",116,0)
 S ^XTMP("MAG30P25","SUMMARY",INDXDATA,MAGIEN)=""
"RTN","MAGXCVC",117,0)
 S ^MAGIXCVT(2006.96,MAGIEN)=1 ; flag as converted by index generation
"RTN","MAGXCVC",118,0)
 Q
"RTN","MAGXCVC",119,0)
 ;
"RTN","MAGXCVC",120,0)
COMIEN(MAGIEN,INDXDATA) ; Commit indices for one image (IEN=MAGIEN), return indices in INDXDATA
"RTN","MAGXCVC",121,0)
 N VAL40 ; --- values on the 40 node
"RTN","MAGXCVC",122,0)
 N IX40 ; ---- index to pieces of the 40 node
"RTN","MAGXCVC",123,0)
 ;
"RTN","MAGXCVC",124,0)
 S INDXDATA=$G(INDXDATA)
"RTN","MAGXCVC",125,0)
 I INDXDATA="" S INDXDATA=$P($G(^XTMP("MAGIXCVGEN",MAGIEN)),U,2,7)
"RTN","MAGXCVC",126,0)
 I INDXDATA="" D GENIEN^MAGXCVI(MAGIEN,.INDXDATA)
"RTN","MAGXCVC",127,0)
 F  Q:$E(INDXDATA,$L(INDXDATA))'=U  S INDXDATA=$E(INDXDATA,1,$L(INDXDATA)-1)
"RTN","MAGXCVC",128,0)
 I INDXDATA]"" D
"RTN","MAGXCVC",129,0)
 . S ^MAG(2005,MAGIEN,40)=INDXDATA
"RTN","MAGXCVC",130,0)
 . Q
"RTN","MAGXCVC",131,0)
 E  D
"RTN","MAGXCVC",132,0)
 . K ^MAG(2005,MAGIEN,40)
"RTN","MAGXCVC",133,0)
 . Q
"RTN","MAGXCVC",134,0)
 Q
"RTN","MAGXCVC",135,0)
 ;
"RTN","MAGXCVC",136,0)
 ; Direct edit of image index fields (#40-44) in the image file (#2005).
"RTN","MAGXCVC",137,0)
IMAGE N I,DIC,DIE,DA,DR,X,Y,MAGIEN,MAGDFN,MAGTMP,BEFORE,AFTER
"RTN","MAGXCVC",138,0)
 W ! S DIC=2005,DIC(0)="AEQ" D ^DIC I Y=-1 Q
"RTN","MAGXCVC",139,0)
 S DIE=DIC,DR="[MAG IMAGE INDEX EDIT]",(MAGIEN,DA)=$P(Y,U)
"RTN","MAGXCVC",140,0)
 S MAGDFN=$P($G(^MAG(2005,MAGIEN,0)),"^",7)
"RTN","MAGXCVC",141,0)
 K MAGTMP
"RTN","MAGXCVC",142,0)
 D GETS^DIQ(2005,MAGIEN_",","40:45","I","MAGTMP")
"RTN","MAGXCVC",143,0)
 S BEFORE="" F I=40:1:45 S:BEFORE'="" BEFORE=BEFORE_"|" S BEFORE=BEFORE_MAGTMP(2005,MAGIEN_",",I,"I")
"RTN","MAGXCVC",144,0)
 D ^DIE
"RTN","MAGXCVC",145,0)
 K MAGTMP
"RTN","MAGXCVC",146,0)
 D GETS^DIQ(2005,MAGIEN_",","40:45","I","MAGTMP")
"RTN","MAGXCVC",147,0)
 S AFTER="" F I=40:1:45 S:AFTER'="" AFTER=AFTER_"|" S AFTER=AFTER_MAGTMP(2005,MAGIEN_",",I,"I")
"RTN","MAGXCVC",148,0)
 D ENTRY^MAGLOG("INDXCHG",$G(DUZ),$G(MAGIEN),"BEFORE: "_BEFORE_" "_"AFTER: "_AFTER,$G(MAGDFN),1)
"RTN","MAGXCVC",149,0)
 G IMAGE
"RTN","MAGXCVC",150,0)
 ;
"RTN","MAGXCVI")
0^58^B45675104
"RTN","MAGXCVI",1,0)
MAGXCVI ;WOIFO/SEB,MLH - Image Index Conversion Generate ; 05/18/2007 11:23
"RTN","MAGXCVI",2,0)
 ;;3.0;IMAGING;**17,25,31,54**;03-July-2009;;Build 1424
"RTN","MAGXCVI",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGXCVI",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGXCVI",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGXCVI",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGXCVI",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGXCVI",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGXCVI",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGXCVI",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGXCVI",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGXCVI",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGXCVI",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGXCVI",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGXCVI",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGXCVI",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGXCVI",17,0)
 ;;
"RTN","MAGXCVI",18,0)
 Q
"RTN","MAGXCVI",19,0)
 ; Extract fields from an image record and look them up in the
"RTN","MAGXCVI",20,0)
 ; conversion global ^XTMP("MAG30P25","MAPPING") for possible values for
"RTN","MAGXCVI",21,0)
 ; Package, Class, Type, Procedure/Event and Specialty.
"RTN","MAGXCVI",22,0)
 ; Currently uses the following fields:
"RTN","MAGXCVI",23,0)
 ; #3 - Object Type (0;6)
"RTN","MAGXCVI",24,0)
 ; #6 - Procedure (0;8)
"RTN","MAGXCVI",25,0)
 ; #8 - Image Save By (2;2)
"RTN","MAGXCVI",26,0)
 ; #10 - Short Desc (2;4)
"RTN","MAGXCVI",27,0)
 ; #14 - Group Parent (0;10)
"RTN","MAGXCVI",28,0)
 ; #16 - Parent Data File (2;6)
"RTN","MAGXCVI",29,0)
 ; #100 - Document Category (100;1)
"RTN","MAGXCVI",30,0)
 ;
"RTN","MAGXCVI",31,0)
 ; Entry point for the generate image indices option (MAG IMAGE INDEX GEN indices)
"RTN","MAGXCVI",32,0)
GEN N START,END,RUN,TMF
"RTN","MAGXCVI",33,0)
 N ZTRTN,ZTDESC,ZTSAVE,ZTSK,ZTDTH,ZTIO ; -- TaskMan control variables
"RTN","MAGXCVI",34,0)
 N RECFLAG ; ------------------------------ true (1) if all image index entries should be recreated
"RTN","MAGXCVI",35,0)
 ;
"RTN","MAGXCVI",36,0)
 I '$D(^XTMP("MAG30P25","MAPPING")) D  Q
"RTN","MAGXCVI",37,0)
 . W !,"You must load the mapping file before running this option."
"RTN","MAGXCVI",38,0)
 . Q
"RTN","MAGXCVI",39,0)
 L +MAGTMP("IMAGE INDEX GENERATION"):0 E  D  Q
"RTN","MAGXCVI",40,0)
 . W !,"Image index generation still in progress. Please try again later."
"RTN","MAGXCVI",41,0)
 . Q
"RTN","MAGXCVI",42,0)
 L +MAGTMP("IMAGE INDEX COMMIT"):0 E  D  Q
"RTN","MAGXCVI",43,0)
 . W !,"Image index commit still in progress. Please try again later."
"RTN","MAGXCVI",44,0)
 . Q
"RTN","MAGXCVI",45,0)
 S (START,END)=0,RECFLAG=""
"RTN","MAGXCVI",46,0)
 D BOUNDS^MAGXCVP(.START,.END) I START="^" Q
"RTN","MAGXCVI",47,0)
 D RECREATE^MAGXCVP(.RECFLAG) I RECFLAG="^" Q
"RTN","MAGXCVI",48,0)
 D TASKMAN^MAGXCVP(.TMF) I TMF="^" G DONE
"RTN","MAGXCVI",49,0)
 S ZTSK=0 I TMF="" D GEN1(START,END,RECFLAG,0) G DONE
"RTN","MAGXCVI",50,0)
 S ZTRTN="GENTM^MAGXCVI",ZTDESC="GENERATE IMAGE INDEX VALUES",ZTDTH=TMF
"RTN","MAGXCVI",51,0)
 S ZTSAVE("START")=START,ZTSAVE("END")=END,ZTSAVE("RECFLAG")=RECFLAG,ZTIO=""
"RTN","MAGXCVI",52,0)
 D ^%ZTLOAD
"RTN","MAGXCVI",53,0)
 W !!,"Image index generation has been queued as task #"_ZTSK_"."
"RTN","MAGXCVI",54,0)
 L -MAGTMP("IMAGE INDEX COMMIT")
"RTN","MAGXCVI",55,0)
 L -MAGTMP("IMAGE INDEX GENERATION")
"RTN","MAGXCVI",56,0)
 Q
"RTN","MAGXCVI",57,0)
 ;
"RTN","MAGXCVI",58,0)
 ; TaskMan entry point for generating image indices
"RTN","MAGXCVI",59,0)
GENTM D GEN1(START,END,RECFLAG,1)
"RTN","MAGXCVI",60,0)
 Q
"RTN","MAGXCVI",61,0)
 ;
"RTN","MAGXCVI",62,0)
GEN1(START,END,RECFLAG,QUEUED) ; Main entry point.
"RTN","MAGXCVI",63,0)
 ;
"RTN","MAGXCVI",64,0)
 N MAGIEN,CT,RESULT,STARTDT,ENDDT,SUMMARY,STOP
"RTN","MAGXCVI",65,0)
 N CURDAT ; -- current FileMan date
"RTN","MAGXCVI",66,0)
 N EXPDAT ; -- expiration date for ^XTMP
"RTN","MAGXCVI",67,0)
 ;
"RTN","MAGXCVI",68,0)
 ; Don't let others run while we're running, but give adequate quit time
"RTN","MAGXCVI",69,0)
 ; to the foreground process that generated us.
"RTN","MAGXCVI",70,0)
 L +MAGTMP("IMAGE INDEX GENERATION"):1800 E  Q
"RTN","MAGXCVI",71,0)
 ; 10-day retention for the ^XTMP output node
"RTN","MAGXCVI",72,0)
 S CURDAT=$$DT^XLFDT
"RTN","MAGXCVI",73,0)
 S EXPDAT=$$FMADD^XLFDT(CURDAT,10)
"RTN","MAGXCVI",74,0)
 K ^XTMP("MAGCVIXGEN")
"RTN","MAGXCVI",75,0)
 S ^XTMP("MAGCVIXGEN",0)=EXPDAT_U_CURDAT_U_"IMAGE INDEX CONVERSION"
"RTN","MAGXCVI",76,0)
 K ^XTMP("MAG30P25","SUMMARY"),^TMP($J)
"RTN","MAGXCVI",77,0)
 S $P(^XTMP("MAG30P25","STATUS"),U,13,14)=1_U_ZTSK
"RTN","MAGXCVI",78,0)
 S STARTDT=$$HTE^XLFDT($H,1)
"RTN","MAGXCVI",79,0)
 S START=+$G(START),END=+$G(END),STOP=0
"RTN","MAGXCVI",80,0)
 I END=0 S END=+$P($G(^MAG(2005,0)),U,3)
"RTN","MAGXCVI",81,0)
 S $P(^XTMP("MAG30P25","STATUS"),U,1,5)=DUZ_U_START_U_STARTDT_U_U
"RTN","MAGXCVI",82,0)
 S MAGIEN=START-1 I MAGIEN=-1 S MAGIEN=0
"RTN","MAGXCVI",83,0)
 I 'QUEUED W !!
"RTN","MAGXCVI",84,0)
 F CT=0:1 S MAGIEN=$O(^MAG(2005,MAGIEN)) Q:MAGIEN>END!(+MAGIEN'=MAGIEN)  D  I STOP Q
"RTN","MAGXCVI",85,0)
 . D GEN2(MAGIEN,CT,RECFLAG,QUEUED) S $P(^XTMP("MAG30P25","STATUS"),U,6)=MAGIEN
"RTN","MAGXCVI",86,0)
 . I QUEUED,$$S^%ZTLOAD S STOP=1,$P(^XTMP("MAG30P25","STATUS"),U,13)=2
"RTN","MAGXCVI",87,0)
 . Q
"RTN","MAGXCVI",88,0)
 S ENDDT=$$HTE^XLFDT($H,1)
"RTN","MAGXCVI",89,0)
 S $P(^XTMP("MAG30P25","STATUS"),U,4,5)=$S(STOP:MAGIEN,1:END)_U_ENDDT
"RTN","MAGXCVI",90,0)
 S ^XTMP("MAG30P25","SUMMARY")=$P(^XTMP("MAG30P25","STATUS"),U,2,5)
"RTN","MAGXCVI",91,0)
 I 'STOP S $P(^XTMP("MAG30P25","STATUS"),U,13)=3
"RTN","MAGXCVI",92,0)
 D NOTIFY^MAGXCVP(.RESULT,1,STARTDT,ENDDT,START,END,RECFLAG)
"RTN","MAGXCVI",93,0)
 L -MAGTMP("IMAGE INDEX GENERATION") ; now others can get in
"RTN","MAGXCVI",94,0)
 Q
"RTN","MAGXCVI",95,0)
 ;
"RTN","MAGXCVI",96,0)
GEN2(MAGIEN,CT,XFREC,QUEUED) N INDXDATA
"RTN","MAGXCVI",97,0)
 N SUMMARY ; ---- summary node for this set of index field values
"RTN","MAGXCVI",98,0)
 N FQUIT ; -- flag to bypass records w/existing values not to be regen'd
"RTN","MAGXCVI",99,0)
 ;
"RTN","MAGXCVI",100,0)
 ;Patch 8 has been installed
"RTN","MAGXCVI",101,0)
 ;or "recreate previously calculated indices" question answered no.
"RTN","MAGXCVI",102,0)
 I $TR($G(^MAG(2005,MAGIEN,40)),"^")'="" D  Q:$G(FQUIT)
"RTN","MAGXCVI",103,0)
 . S FQUIT=1 ; Assume they may not recreate.
"RTN","MAGXCVI",104,0)
 . ; "Recreate previously calculated indices" question answered no?
"RTN","MAGXCVI",105,0)
 . I $E($G(XFREC))="N" K ^XTMP("MAGIXCVGEN",MAGIEN) Q  ; yes
"RTN","MAGXCVI",106,0)
 . ; Don't allow generation unless the previous calculation was done by us.
"RTN","MAGXCVI",107,0)
 . I $D(^MAGIXCVT(2006.96,MAGIEN)) K FQUIT ; ok
"RTN","MAGXCVI",108,0)
 . Q
"RTN","MAGXCVI",109,0)
 I 'QUEUED,CT#100=0 W MAGIEN
"RTN","MAGXCVI",110,0)
 I 'QUEUED,CT#10=0 W "."
"RTN","MAGXCVI",111,0)
 I XFREC="N",$D(^XTMP("MAGIXCVGEN",MAGIEN)) Q
"RTN","MAGXCVI",112,0)
 K ^XTMP("MAGIXCVGEN",MAGIEN)
"RTN","MAGXCVI",113,0)
 D GENIEN(MAGIEN,.INDXDATA)
"RTN","MAGXCVI",114,0)
 S ^XTMP("MAGIXCVGEN",MAGIEN)=$$NOW^XLFDT()_U_INDXDATA
"RTN","MAGXCVI",115,0)
 I INDXDATA="" S INDXDATA="(none)"
"RTN","MAGXCVI",116,0)
 S SUMMARY=$G(^XTMP("MAG30P25","SUMMARY",INDXDATA))
"RTN","MAGXCVI",117,0)
 I $P(SUMMARY,U,2)="" S $P(SUMMARY,U,2)=MAGIEN
"RTN","MAGXCVI",118,0)
 S $P(SUMMARY,U,3)=MAGIEN
"RTN","MAGXCVI",119,0)
 S $P(SUMMARY,U)=$P(SUMMARY,U)+1
"RTN","MAGXCVI",120,0)
 S ^XTMP("MAG30P25","SUMMARY",INDXDATA)=SUMMARY,^(INDXDATA,MAGIEN)=""
"RTN","MAGXCVI",121,0)
 Q
"RTN","MAGXCVI",122,0)
 ;
"RTN","MAGXCVI",123,0)
 ; Generate indices for one image (IEN=MAGIEN), return indices in INDXDATA
"RTN","MAGXCVI",124,0)
GENIEN(MAGIEN,INDXDATA) N GRPIEN,MAGTMP,MAGVALS,FLDDATA,MAPDATA,FLDNUM,UTYPE
"RTN","MAGXCVI",125,0)
 N D0,D1,INDXVAL,UNIQUE,FIRSTVAL,DESC,CHILD1
"RTN","MAGXCVI",126,0)
 N I ; --------- loop index
"RTN","MAGXCVI",127,0)
 N MAGNOD ; ---- nodes of the current record, for fast lookup
"RTN","MAGXCVI",128,0)
 N HITDESC ; --- flag set to TRUE if we get a hit on SHORT DESCRIPTION
"RTN","MAGXCVI",129,0)
 N SHDSCTXT ; -- short description text
"RTN","MAGXCVI",130,0)
 N CMPIDX ; ---- index array for comparison (to see if we already mapped)
"RTN","MAGXCVI",131,0)
 ;
"RTN","MAGXCVI",132,0)
 S GRPIEN=$P($G(^MAG(2005,MAGIEN,0)),U,10)
"RTN","MAGXCVI",133,0)
 I GRPIEN="" S GRPIEN=MAGIEN ; this image is not in a group
"RTN","MAGXCVI",134,0)
 I '$D(^MAG(2005,GRPIEN)) S GRPIEN=MAGIEN
"RTN","MAGXCVI",135,0)
 F I=0,2,100 S MAGNOD(I)=$G(^MAG(2005,GRPIEN,I))
"RTN","MAGXCVI",136,0)
 K MAGVALS
"RTN","MAGXCVI",137,0)
 S MAGVALS(3,"I")=$P(MAGNOD(0),U,6) ; object type
"RTN","MAGXCVI",138,0)
 S MAGVALS(6,"I")=$P(MAGNOD(0),U,8) ; procedure
"RTN","MAGXCVI",139,0)
 S MAGVALS(8,"I")=$P(MAGNOD(2),U,2) ; image save by
"RTN","MAGXCVI",140,0)
 S MAGVALS(10,"I")=$P(MAGNOD(2),U,4) ; short description
"RTN","MAGXCVI",141,0)
 S MAGVALS(16,"I")=$P(MAGNOD(2),U,6) ; parent data file
"RTN","MAGXCVI",142,0)
 S MAGVALS(100,"I")=$P(MAGNOD(100),U) ; descriptive category
"RTN","MAGXCVI",143,0)
 S CHILD1=$P($G(^MAG(2005,GRPIEN,1,1,0)),U)
"RTN","MAGXCVI",144,0)
 I CHILD1="" S CHILD1=MAGIEN ; this image is not in a group
"RTN","MAGXCVI",145,0)
 I CHILD1'="" S MAGVALS(3,"I")=$P($G(^MAG(2005,CHILD1,0)),U,6)
"RTN","MAGXCVI",146,0)
 S INDXDATA=""
"RTN","MAGXCVI",147,0)
 ; If these field values have already been indexed, reuse the previously
"RTN","MAGXCVI",148,0)
 ; mapped-to values.
"RTN","MAGXCVI",149,0)
 F FLDNUM=3,6,8,10,16,100 D
"RTN","MAGXCVI",150,0)
 . S X=$G(MAGVALS(FLDNUM,"I")),CMPIDX(FLDNUM)=$S(X]"":X,1:"@")
"RTN","MAGXCVI",151,0)
 . Q
"RTN","MAGXCVI",152,0)
 S INDXDATA=$G(^TMP($J,"CMPIDX",CMPIDX(3),CMPIDX(6),CMPIDX(8),CMPIDX(10),CMPIDX(16),CMPIDX(100)))
"RTN","MAGXCVI",153,0)
 I INDXDATA="" D GENINEW^MAGXCVI1 ; no previous indexing on these values
"RTN","MAGXCVI",154,0)
 ; save indices for possible later re-use
"RTN","MAGXCVI",155,0)
 S ^TMP($J,"CMPIDX",CMPIDX(3),CMPIDX(6),CMPIDX(8),CMPIDX(10),CMPIDX(16),CMPIDX(100))=INDXDATA
"RTN","MAGXCVI",156,0)
 Q
"RTN","MAGXCVI",157,0)
 ;
"RTN","MAGXCVI",158,0)
DONE W !!,"Done!"
"RTN","MAGXCVI",159,0)
 Q
"RTN","MAGXCVI",160,0)
 ;
"RTN","MAGXCVI",161,0)
 ; Silent call to generate and commit image indices for one image (IEN=MAGIEN)
"RTN","MAGXCVI",162,0)
ONE(MAGIEN) N INDXDATA
"RTN","MAGXCVI",163,0)
 D GENIEN(MAGIEN,.INDXDATA),COMIEN^MAGXCVC(MAGIEN,.INDXDATA)
"RTN","MAGXCVI",164,0)
 Q
"RTN","MAGXCVP")
0^59^B27908665
"RTN","MAGXCVP",1,0)
MAGXCVP ;WOIFO/SEB,MLH - Image Index Conversion Generate & Commit ; 05/18/2007 11:23
"RTN","MAGXCVP",2,0)
 ;;3.0;IMAGING;**17,25,31,54**;03-July-2009;;Build 1424
"RTN","MAGXCVP",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGXCVP",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGXCVP",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGXCVP",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGXCVP",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGXCVP",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGXCVP",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGXCVP",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGXCVP",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGXCVP",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGXCVP",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGXCVP",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGXCVP",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGXCVP",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGXCVP",17,0)
 ;;
"RTN","MAGXCVP",18,0)
 Q
"RTN","MAGXCVP",19,0)
 ;
"RTN","MAGXCVP",20,0)
 ; Input starting and ending IENs. Return in variables START and END.
"RTN","MAGXCVP",21,0)
BOUNDS(START,END) N TEMP
"RTN","MAGXCVP",22,0)
START R !,"From ID: 1 // ",START:DTIME
"RTN","MAGXCVP",23,0)
 I $E(START)="?" D  G START
"RTN","MAGXCVP",24,0)
 . W !!,"Please enter the ID of an entry in the image file. This will be the first image"
"RTN","MAGXCVP",25,0)
 . W !,"in the range of images processed by this menu option.",!
"RTN","MAGXCVP",26,0)
 . Q
"RTN","MAGXCVP",27,0)
 I START="" S START=1
"RTN","MAGXCVP",28,0)
 I START="^" Q
"RTN","MAGXCVP",29,0)
 I +START'=START W !!,"Please enter a starting image ID - numbers only." G START
"RTN","MAGXCVP",30,0)
END R !,"To ID: LAST // ",END:DTIME
"RTN","MAGXCVP",31,0)
 I $E(END)="?" D  G END
"RTN","MAGXCVP",32,0)
 . W !!,"Please enter the ID of an entry in the image file. This will be the last image"
"RTN","MAGXCVP",33,0)
 . W !,"in the range of images processed by this menu option.",!
"RTN","MAGXCVP",34,0)
 . Q
"RTN","MAGXCVP",35,0)
 I "^LAST"[("^"_$$UCASE(END)) D  ; includes null response default
"RTN","MAGXCVP",36,0)
 . W "  LAST"
"RTN","MAGXCVP",37,0)
 . S END=+$P($G(^MAG(2005,0)),U,3)
"RTN","MAGXCVP",38,0)
 . Q
"RTN","MAGXCVP",39,0)
 I END="^" S START="^" Q
"RTN","MAGXCVP",40,0)
 I +END'=END W !!,"Please enter an ending image ID - numbers only." G END
"RTN","MAGXCVP",41,0)
 I START>END D  G END ;S TEMP=END,END=START,START=TEMP
"RTN","MAGXCVP",42,0)
 . W !!,"'To ID' value must not be less than 'From ID' value."
"RTN","MAGXCVP",43,0)
 . Q
"RTN","MAGXCVP",44,0)
 Q
"RTN","MAGXCVP",45,0)
 ;
"RTN","MAGXCVP",46,0)
 ; Prompt whether the user wishes to recreate previously-calculated indices. Return in FLAG.
"RTN","MAGXCVP",47,0)
RECREATE(FLAG) S FLAG=""
"RTN","MAGXCVP",48,0)
RECR R !,"Recreate previously calculated indices? Y // ",FLAG:DTIME
"RTN","MAGXCVP",49,0)
 S FLAG=$$UCASE($E(FLAG)) I FLAG="" S FLAG="Y"
"RTN","MAGXCVP",50,0)
 I FLAG="?" D  G RECR
"RTN","MAGXCVP",51,0)
 . W !!,"Entering YES will cause index fields that have been calculated by a previous"
"RTN","MAGXCVP",52,0)
 . W !,"execution of this option to be recalculated. Entering NO will cause the option"
"RTN","MAGXCVP",53,0)
 . W !,"to skip images that already have index fields.",!
"RTN","MAGXCVP",54,0)
 . Q
"RTN","MAGXCVP",55,0)
 I "YN^"'[FLAG W !!,"Please enter YES or NO." G RECR
"RTN","MAGXCVP",56,0)
 Q
"RTN","MAGXCVP",57,0)
 ;
"RTN","MAGXCVP",58,0)
 ; Ask if user wishes to job a task into the background with TaskMan. Returns NULL if
"RTN","MAGXCVP",59,0)
 ; the user wishes to run it in the foreground, and a schedule date/time if the user
"RTN","MAGXCVP",60,0)
 ; wishes to use TaskMan.
"RTN","MAGXCVP",61,0)
TASKMAN(RETURN) N ASK,X,%DT
"RTN","MAGXCVP",62,0)
 I '$$TM^%ZTLOAD() S RETURN="" Q
"RTN","MAGXCVP",63,0)
TMA R !,"Would you like to schedule this with TaskMan? Y // ",ASK:DTIME
"RTN","MAGXCVP",64,0)
 S ASK=$$UCASE($E(ASK))
"RTN","MAGXCVP",65,0)
 I ASK="?" D  G TMA
"RTN","MAGXCVP",66,0)
 . W !!,"Entering YES will run this task with TaskMan. Entering NO will cause it to"
"RTN","MAGXCVP",67,0)
 . W !,"run in the foreground.",!
"RTN","MAGXCVP",68,0)
 I "YN^"'[ASK W !!,"Please enter YES or NO." G TMA
"RTN","MAGXCVP",69,0)
 I ASK="^" S RETURN="^" Q
"RTN","MAGXCVP",70,0)
 I ASK="N" S RETURN="" Q
"RTN","MAGXCVP",71,0)
SCHED R !!,"Please enter the date/time for scheduling the task: NOW // ",X:DTIME I X="" S X="NOW"
"RTN","MAGXCVP",72,0)
 I X="^" S RETURN="^" Q
"RTN","MAGXCVP",73,0)
 S %DT="R" D ^%DT I Y=-1 G SCHED
"RTN","MAGXCVP",74,0)
 S RETURN=Y Q
"RTN","MAGXCVP",75,0)
 Q
"RTN","MAGXCVP",76,0)
 ;
"RTN","MAGXCVP",77,0)
DONE W !!,"Done!"
"RTN","MAGXCVP",78,0)
 Q
"RTN","MAGXCVP",79,0)
 ;
"RTN","MAGXCVP",80,0)
 ; Generate a notification message and send it to group MAG SERVER
"RTN","MAGXCVP",81,0)
NOTIFY(RESULT,SUBJECT,STARTDT,ENDDT,STARTIEN,ENDIEN,RECR) N Y,LOC,XMSUB,DIS,CAP,CNT,I,VR,DM,SUMMARY
"RTN","MAGXCVP",82,0)
 K ^TMP($J,"MAGQ")
"RTN","MAGXCVP",83,0)
 S Y=$$HTE^XLFDT($H,1) ; EdM: is Y used anywhere?
"RTN","MAGXCVP",84,0)
 S U="^",LOC=$$KSP^XUPARAM("WHERE")
"RTN","MAGXCVP",85,0)
 S SUBJECT=$G(SUBJECT)
"RTN","MAGXCVP",86,0)
 I +SUBJECT=SUBJECT S SUBJECT=$P("Generate^Commit",U,SUBJECT)
"RTN","MAGXCVP",87,0)
 S XMSUB=SUBJECT_" Image Index Conversion Values: "_$G(ENDDT)
"RTN","MAGXCVP",88,0)
 S ^TMP($J,"MAGQ",1)="Status: "_$$ST^MAGXCVR
"RTN","MAGXCVP",89,0)
 S ^TMP($J,"MAGQ",2)="Started on: "_$G(STARTDT)
"RTN","MAGXCVP",90,0)
 S ^TMP($J,"MAGQ",3)="Finished on: "_$G(ENDDT)
"RTN","MAGXCVP",91,0)
 S ^TMP($J,"MAGQ",4)="Starting IEN: "_$G(STARTIEN)
"RTN","MAGXCVP",92,0)
 S ^TMP($J,"MAGQ",5)="Ending IEN: "_$G(ENDIEN)
"RTN","MAGXCVP",93,0)
 S ^TMP($J,"MAGQ",6)="Recreate Indices: "_$G(RECR)
"RTN","MAGXCVP",94,0)
 S SUMMARY=""
"RTN","MAGXCVP",95,0)
 F I=7:1 S SUMMARY=$O(^XTMP("MAG30P25","SUMMARY",SUMMARY)) Q:SUMMARY=""  D
"RTN","MAGXCVP",96,0)
 . S ^TMP($J,"MAGQ",I)=SUMMARY_U_^XTMP("MAG30P25","SUMMARY",SUMMARY)
"RTN","MAGXCVP",97,0)
 . Q
"RTN","MAGXCVP",98,0)
 N XMY,XMTEXT
"RTN","MAGXCVP",99,0)
 S XMTEXT="^TMP($J,""MAGQ"","
"RTN","MAGXCVP",100,0)
 S:$G(DUZ) XMY(DUZ)=""
"RTN","MAGXCVP",101,0)
 S XMY("G.MAG SERVER")=""
"RTN","MAGXCVP",102,0)
 S:$G(MAGDUZ) XMY(MAGDUZ)=""
"RTN","MAGXCVP",103,0)
 D ^XMD
"RTN","MAGXCVP",104,0)
 S RESULT="1"
"RTN","MAGXCVP",105,0)
 K ^TMP($J,"MAGQ")
"RTN","MAGXCVP",106,0)
 Q
"RTN","MAGXCVP",107,0)
 ; 
"RTN","MAGXCVP",108,0)
 ; Convert a string to all uppercase.
"RTN","MAGXCVP",109,0)
UCASE(STRING) N OUTPUT
"RTN","MAGXCVP",110,0)
 S OUTPUT=$TR(STRING,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","MAGXCVP",111,0)
 Q OUTPUT
"RTN","MAGXCVP",112,0)
 ;
"RTN","MAGXCVP",113,0)
 ; Convert a string to all lowercase.
"RTN","MAGXCVP",114,0)
LCASE(STRING) N OUTPUT
"RTN","MAGXCVP",115,0)
 S OUTPUT=$TR(STRING,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","MAGXCVP",116,0)
 Q OUTPUT
"RTN","MAGXCVP",117,0)
 ;
"RTN","MAGXCVP",118,0)
 ; Strip leading and trailing spaces.
"RTN","MAGXCVP",119,0)
STRIP(STRING) N START,END
"RTN","MAGXCVP",120,0)
 F START=1:1:$L(STRING) I $E(STRING,START)'=" " Q
"RTN","MAGXCVP",121,0)
 F END=$L(STRING):-1:1 I $E(STRING,END)'=" " Q
"RTN","MAGXCVP",122,0)
 Q $E(STRING,START,END)
"RTN","MAGXCVP",123,0)
 ;
"RTN","MAGXCVP",124,0)
SCRUBTKN(XSTRING) ; FUNCTION - Create standard token delimiters for parsing
"RTN","MAGXCVP",125,0)
 ; by changing all punctuation to spaces.
"RTN","MAGXCVP",126,0)
 N STRING ; output string
"RTN","MAGXCVP",127,0)
 S STRING=$TR(XSTRING,"+-/\.,~`!@#$%^&*()_-={}[]|:;""'<>?","                                 ")
"RTN","MAGXCVP",128,0)
 ; compress multiple spaces to single space
"RTN","MAGXCVP",129,0)
 F  Q:STRING'["  "  S STRING=$P(STRING,"  ",1)_" "_$P(STRING,"  ",2,999)
"RTN","MAGXCVP",130,0)
 Q STRING
"RTN","MAGXCVP",131,0)
 ;
"RTN","MAGXCVR")
0^60^B56935964
"RTN","MAGXCVR",1,0)
MAGXCVR ;WOIFO/SEB,MLH - Image File Conversion Reports ; 05/18/2007 11:23
"RTN","MAGXCVR",2,0)
 ;;3.0;IMAGING;**17,25,31,54**;03-July-2009;;Build 1424
"RTN","MAGXCVR",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGXCVR",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGXCVR",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGXCVR",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGXCVR",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGXCVR",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGXCVR",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGXCVR",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGXCVR",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGXCVR",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGXCVR",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGXCVR",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGXCVR",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGXCVR",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGXCVR",17,0)
 ;;
"RTN","MAGXCVR",18,0)
 Q
"RTN","MAGXCVR",19,0)
 ;
"RTN","MAGXCVR",20,0)
 ; Entry point for the detail report option (MAG IMAGE INDEX DETAIL REPORT)
"RTN","MAGXCVR",21,0)
REPORT N START,END S (START,END)=0
"RTN","MAGXCVR",22,0)
 D BOUNDS^MAGXCVP(.START,.END) I START="^" Q
"RTN","MAGXCVR",23,0)
 W !!,"Are you sure that you want to run this report for ",(END-START+1)," images? Y // " R RUN:DTIME
"RTN","MAGXCVR",24,0)
 I "Yy"'[RUN W !,"OK, report not printed." G DONE
"RTN","MAGXCVR",25,0)
 N ZTSAVE S ZTSAVE("START")=START,ZTSAVE("END")=END
"RTN","MAGXCVR",26,0)
 U IO(0) W !,"This report must be run on a device at least 132 columns wide."
"RTN","MAGXCVR",27,0)
 D EN^XUTMDEVQ("REPORT1^"_$T(+0),"Print Image Index Detail Report",.ZTSAVE)
"RTN","MAGXCVR",28,0)
 G DONE
"RTN","MAGXCVR",29,0)
 ;
"RTN","MAGXCVR",30,0)
REPORT1 N MAGIEN,LINENUM,PAGE,RET,STARTDT,ENDDT
"RTN","MAGXCVR",31,0)
 I IOM<132 W !,"This report must be run on a device at least 132 columns wide. Goodbye!" Q
"RTN","MAGXCVR",32,0)
 S STARTDT=$$HTE^XLFDT($H,1)
"RTN","MAGXCVR",33,0)
 S LINENUM=0,PAGE=0,RET="" D HEADER(1)
"RTN","MAGXCVR",34,0)
 S START=+$G(START),END=+$G(END)
"RTN","MAGXCVR",35,0)
 I END=0 S END=+$P($G(^MAG(2005,0)),U,3)
"RTN","MAGXCVR",36,0)
 S MAGIEN=START-1 I MAGIEN=-1 S MAGIEN=0
"RTN","MAGXCVR",37,0)
 F  S MAGIEN=$O(^MAG(2005,MAGIEN)) Q:MAGIEN>END!(+MAGIEN'=MAGIEN)  D REPONE(MAGIEN,1) I RET="^" Q
"RTN","MAGXCVR",38,0)
 S ENDDT=$$HTE^XLFDT($H,1)
"RTN","MAGXCVR",39,0)
 Q
"RTN","MAGXCVR",40,0)
 ;
"RTN","MAGXCVR",41,0)
 ; Print data for one image (IEN=MAGIEN)
"RTN","MAGXCVR",42,0)
REPONE(MAGIEN,TYPE) N MAGTMP,MAGVALS,GRPIEN,UTYPE,INDXDATA,CHILD1
"RTN","MAGXCVR",43,0)
 N GRPFLG ; ------- true (1) if this image is part of a group
"RTN","MAGXCVR",44,0)
 ;
"RTN","MAGXCVR",45,0)
 S GRPIEN=$$GET1^DIQ(2005,MAGIEN_",",14,"I"),GRPFLG=1
"RTN","MAGXCVR",46,0)
 ; NEW:  Skip child images (for MRs, CTs, etc.)
"RTN","MAGXCVR",47,0)
 I GRPIEN]"" Q
"RTN","MAGXCVR",48,0)
 I GRPIEN="" S GRPIEN=MAGIEN,GRPFLG=0
"RTN","MAGXCVR",49,0)
 S LINENUM=LINENUM+1 I LINENUM>(IOSL-2) D HEADER(TYPE) I RET="^" Q
"RTN","MAGXCVR",50,0)
 W !,MAGIEN
"RTN","MAGXCVR",51,0)
 I '$D(^MAG(2005,GRPIEN)) D  Q
"RTN","MAGXCVR",52,0)
 . W ?9,"<<< "_$S(GRPFLG:"PARENT ",1:"")_"IMAGE RECORD DOES NOT EXIST! >>>"
"RTN","MAGXCVR",53,0)
 . Q
"RTN","MAGXCVR",54,0)
 K MAGTMP
"RTN","MAGXCVR",55,0)
 D GETS^DIQ(2005,GRPIEN_",","3;6;8;10;16;100","EI","MAGTMP")
"RTN","MAGXCVR",56,0)
 K MAGVALS M MAGVALS=MAGTMP(2005,GRPIEN_",")
"RTN","MAGXCVR",57,0)
 S CHILD1=$G(^MAG(2005,GRPIEN,1,1,0))
"RTN","MAGXCVR",58,0)
 I CHILD1'="" S MAGVALS(3,"E")=$$GET1^DIQ(2005,CHILD1_",",3,"E")
"RTN","MAGXCVR",59,0)
 S UTYPE="" I $G(MAGVALS(8,"I"))]"" S UTYPE=$$GET1^DIQ(200,MAGVALS(8,"I")_",",29,"E")
"RTN","MAGXCVR",60,0)
 W ?9,$E($G(MAGVALS(6,"E")),1,16),?27,$E($G(MAGVALS(10,"E")),1,27),?56,$E($G(MAGVALS(16,"E")),1,20)
"RTN","MAGXCVR",61,0)
 W ?78,$E($G(MAGVALS(100,"E")),1,23),?103,$E($G(MAGVALS(3,"E")),1,17),?120,$E(UTYPE,1,10)
"RTN","MAGXCVR",62,0)
 S INDXDATA=$G(^XTMP("MAGIXCVGEN",MAGIEN)) I INDXDATA="" Q
"RTN","MAGXCVR",63,0)
 I TYPE=1 D INDICES(INDXDATA,TYPE) ;I RET'="^" W ! S LINENUM=LINENUM+1 I LINENUM>(IOSL-3) D HEADER(TYPE) I RET="^" Q
"RTN","MAGXCVR",64,0)
 Q
"RTN","MAGXCVR",65,0)
 ;
"RTN","MAGXCVR",66,0)
 ; Print index values for the current image
"RTN","MAGXCVR",67,0)
INDICES(INDXDATA,TYPE) N D0,INDXVAL,INDXNUM,TAB,LEN,SPACES
"RTN","MAGXCVR",68,0)
 S SPACES="",$P(SPACES," ",21)=""
"RTN","MAGXCVR",69,0)
 W !
"RTN","MAGXCVR",70,0)
 F D0=1:1:5 D
"RTN","MAGXCVR",71,0)
 . S INDXVAL=$P(INDXDATA,U,D0+1)
"RTN","MAGXCVR",72,0)
 . S INDXNUM=$S(D0=2:2005.82,D0=3:2005.83,D0=4:2005.85,D0=5:2005.84,1:"")
"RTN","MAGXCVR",73,0)
 . I D0>1,INDXVAL]"" S INDXVAL=$$GET1^DIQ(INDXNUM,INDXVAL,.01,"E")
"RTN","MAGXCVR",74,0)
 . S TAB=$P("9^27^36^56^78",U,D0),LEN=$P("20^7^18^20^20",U,D0)
"RTN","MAGXCVR",75,0)
 . I TYPE=1 W ?TAB,$E(INDXVAL,1,LEN),"  "
"RTN","MAGXCVR",76,0)
 . I TYPE=2 W $P("Package^Class^Type^Procedure^Specialty",U,D0),": ",$E(INDXVAL,1,LEN),$E(SPACES,1,LEN-$L(INDXVAL))
"RTN","MAGXCVR",77,0)
 . Q
"RTN","MAGXCVR",78,0)
 S LINENUM=LINENUM+1 I LINENUM>(IOSL-3) D HEADER(TYPE) I RET="^" Q
"RTN","MAGXCVR",79,0)
 Q
"RTN","MAGXCVR",80,0)
 ;
"RTN","MAGXCVR",81,0)
 ; Entry point for the summary report option (MAG IMAGE INDEX SUMMARY REPORT)
"RTN","MAGXCVR",82,0)
SUMMARY N ZTSAVE,DETAIL
"RTN","MAGXCVR",83,0)
ALL R !!,"Display data for all images? N // ",DETAIL:DTIME
"RTN","MAGXCVR",84,0)
 S DETAIL=$$UCASE^MAGXCVP(DETAIL) I DETAIL="^" G DONE
"RTN","MAGXCVR",85,0)
 I DETAIL'="Y" S DETAIL="N"
"RTN","MAGXCVR",86,0)
 S ZTSAVE("DETAIL")=DETAIL
"RTN","MAGXCVR",87,0)
 D EN^XUTMDEVQ("SUMMARY1^"_$T(+0),"Print Image Index Summary Report",.ZTSAVE)
"RTN","MAGXCVR",88,0)
 G DONE
"RTN","MAGXCVR",89,0)
 ;
"RTN","MAGXCVR",90,0)
SUMMARY1 N SUMMARY,SUMDATA,PAGE,LINENUM,RET,MAGIEN
"RTN","MAGXCVR",91,0)
 I IOM'=132 W !,"This report must be run on a 132-column device. Goodbye!" Q
"RTN","MAGXCVR",92,0)
 S SUMMARY="",PAGE=0,LINENUM=0,RET="" D HEADER(2)
"RTN","MAGXCVR",93,0)
 F  S SUMMARY=$O(^XTMP("MAG30P25","SUMMARY",SUMMARY)) Q:SUMMARY=""!(RET="^")  D
"RTN","MAGXCVR",94,0)
 . S SUMDATA=$G(^XTMP("MAG30P25","SUMMARY",SUMMARY))
"RTN","MAGXCVR",95,0)
 . D INDICES(U_SUMMARY,2) I RET="^" Q
"RTN","MAGXCVR",96,0)
 . W ! S LINENUM=LINENUM+1 I LINENUM>(IOSL-3) D HEADER(2) I RET="^" Q
"RTN","MAGXCVR",97,0)
 . I DETAIL="Y" D DETL(SUMMARY) I RET="^" Q
"RTN","MAGXCVR",98,0)
 . I DETAIL="N" D SUMM(SUMDATA) I RET="^" Q
"RTN","MAGXCVR",99,0)
 . W ! F I=1:1:132 W "-"
"RTN","MAGXCVR",100,0)
 . S LINENUM=LINENUM+1 I LINENUM>(IOSL-3) D HEADER(2) I RET="^" Q
"RTN","MAGXCVR",101,0)
 . Q
"RTN","MAGXCVR",102,0)
 I RET="^" Q
"RTN","MAGXCVR",103,0)
 W !!,"Index Commit History:" S LINENUM=LINENUM+1 I LINENUM>(IOSL-3) D HEADER(2) I RET="^" Q
"RTN","MAGXCVR",104,0)
 F I=1:1:+$G(^XTMP("MAG30P25","HISTORY")) Q:I=""  D
"RTN","MAGXCVR",105,0)
 . S SUMDATA=$G(^XTMP("MAG30P25","HISTORY",I))
"RTN","MAGXCVR",106,0)
 . W !?2,I,?8,$P(SUMDATA,U),"-",$P(SUMDATA,U,3)," started on ",$P(SUMDATA,U,2),", finished on ",$P(SUMDATA,U,4)
"RTN","MAGXCVR",107,0)
 . S LINENUM=LINENUM+1 I LINENUM>(IOSL-3) D HEADER(2) I RET="^" Q
"RTN","MAGXCVR",108,0)
 . Q
"RTN","MAGXCVR",109,0)
 Q
"RTN","MAGXCVR",110,0)
 ;
"RTN","MAGXCVR",111,0)
 ; Print the header of the report
"RTN","MAGXCVR",112,0)
HEADER(TYPE) N I,STATUS ; TYPE = 1: Detail, 2: Summary
"RTN","MAGXCVR",113,0)
 S STATUS=$G(^XTMP("MAG30P25","SUMMARY"))
"RTN","MAGXCVR",114,0)
 I PAGE>0,IOT="TRM"!(IOT="VTRM") R !!,"Press <RETURN> to continue, or '^' to exit: ",RET:DTIME I RET="^" Q
"RTN","MAGXCVR",115,0)
 S LINENUM=$P("6^5",U,TYPE),PAGE=PAGE+1
"RTN","MAGXCVR",116,0)
 W:PAGE>0 # W ! F I=1:1:132 W "-"
"RTN","MAGXCVR",117,0)
 W !?53,"Image Index Report ",$S(TYPE=1:"Detail",1:"Summary"),?106,"Page #",PAGE
"RTN","MAGXCVR",118,0)
 I TYPE=1 D
"RTN","MAGXCVR",119,0)
 . W !,"Img ID",?9,"Procedure",?27,"Short Description",?56,"Parent Data File"
"RTN","MAGXCVR",120,0)
 . W ?78,"Document Category",?103,"Obj. Type",?120,"User Type"
"RTN","MAGXCVR",121,0)
 . W !?9,"Package",?27,"Class",?36,"Type",?56,"Procedure/Event",?78,"Specialty"
"RTN","MAGXCVR",122,0)
 . Q
"RTN","MAGXCVR",123,0)
 I TYPE=2 D
"RTN","MAGXCVR",124,0)
 . W !?40,"Compiled: ",$P(STATUS,U,2),"-",$P(STATUS,U,4)
"RTN","MAGXCVR",125,0)
 . W !?(132-11-$L($P(STATUS,U))-$L($P(STATUS,U,3))/2),"Image IDs: ",$P(STATUS,U),"-",$P(STATUS,U,3)
"RTN","MAGXCVR",126,0)
 . Q
"RTN","MAGXCVR",127,0)
 W ! F I=1:1:132 W "-"
"RTN","MAGXCVR",128,0)
 Q
"RTN","MAGXCVR",129,0)
 ;
"RTN","MAGXCVR",130,0)
SUMM(SUMDATA) W !,"Total: ",$P(SUMDATA,U),?15,"First IEN: ",$P(SUMDATA,U,2),?35,"Last IEN: ",$P(SUMDATA,U,3)
"RTN","MAGXCVR",131,0)
 S LINENUM=LINENUM+2 I LINENUM>(IOSL-3) D HEADER(2) I RET="^" Q
"RTN","MAGXCVR",132,0)
 W !,"Img ID",?9,"Procedure",?27,"Short Description",?56,"Parent Data File"
"RTN","MAGXCVR",133,0)
 W ?78,"Document Category",?103,"Obj. Type",?120,"User Type"
"RTN","MAGXCVR",134,0)
 S LINENUM=LINENUM+1 I LINENUM>(IOSL-3) D HEADER(2) I RET="^" Q
"RTN","MAGXCVR",135,0)
 ;D REPONE($P(SUMDATA,U,2),2) I RET="^" Q
"RTN","MAGXCVR",136,0)
 I $P(SUMDATA,U,2)'=$P(SUMDATA,U,3) D  I RET="^" Q
"RTN","MAGXCVR",137,0)
 . ;D REPONE($P(SUMDATA,U,3),2) I RET="^" Q
"RTN","MAGXCVR",138,0)
 . Q
"RTN","MAGXCVR",139,0)
 Q
"RTN","MAGXCVR",140,0)
 ;
"RTN","MAGXCVR",141,0)
DETL(SUMMARY) N MAGIEN
"RTN","MAGXCVR",142,0)
 W !,"Img ID",?9,"Procedure",?27,"Short Description",?56,"Parent Data File"
"RTN","MAGXCVR",143,0)
 W ?78,"Document Category",?103,"Obj. Type",?120,"User Type"
"RTN","MAGXCVR",144,0)
 S LINENUM=LINENUM+2 I LINENUM>(IOSL-3) D HEADER(2) I RET="^" Q
"RTN","MAGXCVR",145,0)
 S MAGIEN="" F  S MAGIEN=$O(^XTMP("MAG30P25","SUMMARY",SUMMARY,MAGIEN)) Q:MAGIEN=""!(RET="^")  D
"RTN","MAGXCVR",146,0)
 . D REPONE(MAGIEN,2) I RET="^" Q
"RTN","MAGXCVR",147,0)
 . Q
"RTN","MAGXCVR",148,0)
 Q
"RTN","MAGXCVR",149,0)
 ;
"RTN","MAGXCVR",150,0)
DONE W !!,"Done!"
"RTN","MAGXCVR",151,0)
 Q
"RTN","MAGXCVR",152,0)
 ;
"RTN","MAGXCVR",153,0)
 ; Entry point for the status report option (MAG IMAGE INDEX STATUS)
"RTN","MAGXCVR",154,0)
STATUS N STDATA,STFLAG,TASKNUM
"RTN","MAGXCVR",155,0)
 S STDATA=$G(^XTMP("MAG30P25","STATUS")),STFLAG=$P(STDATA,U,13),TASKNUM=$P(STDATA,U,14)
"RTN","MAGXCVR",156,0)
 W ! F CT=1:1:80 W "-"
"RTN","MAGXCVR",157,0)
 W !,"Current status: ",$$ST I TASKNUM>0 W " (#",TASKNUM,")"
"RTN","MAGXCVR",158,0)
 W ?60,"Current IEN: ",$P(STDATA,U,((STFLAG>3)+1)*6)
"RTN","MAGXCVR",159,0)
 W !!,"Last generation started on: ",$P(STDATA,U,3),?53,"Starting IEN: ",$P(STDATA,U,2)
"RTN","MAGXCVR",160,0)
 W !?18,"ended on: ",$P(STDATA,U,5),?55,"Ending IEN: ",$P(STDATA,U,4)
"RTN","MAGXCVR",161,0)
 W !!?4,"Last commit started on: ",$P(STDATA,U,9),?53,"Starting IEN: ",$P(STDATA,U,8)
"RTN","MAGXCVR",162,0)
 W !?18,"ended on: ",$P(STDATA,U,11),?55,"Ending IEN: ",$P(STDATA,U,10)
"RTN","MAGXCVR",163,0)
 W ! F CT=1:1:80 W "-"
"RTN","MAGXCVR",164,0)
 Q
"RTN","MAGXCVR",165,0)
 ;
"RTN","MAGXCVR",166,0)
ST() N STDATA,STFLAG,STATUS
"RTN","MAGXCVR",167,0)
 S STDATA=$G(^XTMP("MAG30P25","STATUS"))
"RTN","MAGXCVR",168,0)
 S STFLAG=$P(STDATA,U,13)
"RTN","MAGXCVR",169,0)
 I +STFLAG=0 Q "Image index conversion not started yet"
"RTN","MAGXCVR",170,0)
 S STATUS="Image index "_$S(STFLAG<4:"generation",1:"commit")_" "_$S(STFLAG#3=0:"done",STFLAG#3=1:"in progress",1:"aborted")
"RTN","MAGXCVR",171,0)
 Q STATUS
"RTN","MAGXCVR",172,0)
 ;
"RTN","MAGXCVS")
0^61^B57771019
"RTN","MAGXCVS",1,0)
MAGXCVS ;WOIFO/MLH - Imaging - index conversion - summary report ; 05/18/2007 11:23
"RTN","MAGXCVS",2,0)
 ;;3.0;IMAGING;**17,25,31,54**;03-July-2009;;Build 1424
"RTN","MAGXCVS",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGXCVS",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGXCVS",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGXCVS",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGXCVS",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGXCVS",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGXCVS",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGXCVS",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGXCVS",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGXCVS",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGXCVS",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGXCVS",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGXCVS",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGXCVS",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGXCVS",17,0)
 ;;
"RTN","MAGXCVS",18,0)
 Q
"RTN","MAGXCVS",19,0)
 ;
"RTN","MAGXCVS",20,0)
MAKESUMM ; entry point - construct a summary report from site data
"RTN","MAGXCVS",21,0)
 ; This expects that the site will already have created an export file.
"RTN","MAGXCVS",22,0)
 ;
"RTN","MAGXCVS",23,0)
 N %ZIS,IOP,X,COUNT,LN,DATA,MAGIEN,PKG,CLS,TYP,SPEC,PROC,PROC2,DESC,PG
"RTN","MAGXCVS",24,0)
 N FRQTHRS ; --- frequency threshold for abridged report
"RTN","MAGXCVS",25,0)
 N NUPG ; ------ new-page flag
"RTN","MAGXCVS",26,0)
 N PROCTXT ; --- procedure text
"RTN","MAGXCVS",27,0)
 N PARENT ; ---- parent data file
"RTN","MAGXCVS",28,0)
 N DOCCAT ; ---- document category
"RTN","MAGXCVS",29,0)
 N OBJTYP ; ---- image object type
"RTN","MAGXCVS",30,0)
 N SAVBYGRP ; -- save-by group
"RTN","MAGXCVS",31,0)
 N KT ; -------- count for comparison with frequency threshold
"RTN","MAGXCVS",32,0)
 N SUB ; ------- station or substation mnemonic
"RTN","MAGXCVS",33,0)
 N FQFNAME ; --- fully qualified file name to process
"RTN","MAGXCVS",34,0)
 N FNAME ; ----- file name without directory or extension
"RTN","MAGXCVS",35,0)
 N RANGE ; ----- range of records (for documentation)
"RTN","MAGXCVS",36,0)
 N DTIME ; ----- timeout (in seconds) for input
"RTN","MAGXCVS",37,0)
 N FULABR ; ---- Full or Abridged report flag
"RTN","MAGXCVS",38,0)
 ;
"RTN","MAGXCVS",39,0)
 K ^TMP($J,"MAGIXCVSTAT")
"RTN","MAGXCVS",40,0)
 S COUNT=0
"RTN","MAGXCVS",41,0)
 S:'$D(DTIME) DTIME=$$DTIME^XUP(DUZ)
"RTN","MAGXCVS",42,0)
SM1 ; set frequency threshold based on full or abridged report
"RTN","MAGXCVS",43,0)
 ;
"RTN","MAGXCVS",44,0)
 K DIR S DIR(0)="SB^A:Abridged;F:Full"
"RTN","MAGXCVS",45,0)
 S DIR("A")="Abridged or Full report"
"RTN","MAGXCVS",46,0)
 S DIR("?",1)="Enter A if you wish to see the mapping only for those combinations"
"RTN","MAGXCVS",47,0)
 S DIR("?",2)="  of source field values that occurred more than 50 times."
"RTN","MAGXCVS",48,0)
 S DIR("?",3)=" "
"RTN","MAGXCVS",49,0)
 S DIR("?",4)="Enter F if you wish to see the mapping for all combinations of source"
"RTN","MAGXCVS",50,0)
 S DIR("?",5)="  field values in the range of image IENs that you mapped, even those"
"RTN","MAGXCVS",51,0)
 S DIR("?",6)="  that occurred fewer than 50 times."
"RTN","MAGXCVS",52,0)
 S DIR("?")=" "
"RTN","MAGXCVS",53,0)
 D ^DIR Q:$D(DTOUT)  Q:$D(DUOUT)  S FRQTHRS=$S(Y="A":50,1:1)
"RTN","MAGXCVS",54,0)
 ;
"RTN","MAGXCVS",55,0)
SM15 ; what export file?
"RTN","MAGXCVS",56,0)
 ;
"RTN","MAGXCVS",57,0)
 K DIR S DIR(0)="FO"
"RTN","MAGXCVS",58,0)
 S DIR("A")="Please enter the filename of the export file to use for input"
"RTN","MAGXCVS",59,0)
 S DIR("?")="Enter a file name, including the path, of the export file that contains the data to be summarized in the report."
"RTN","MAGXCVS",60,0)
 D ^DIR Q:$D(DTOUT)  Q:$D(DUOUT)  S FQFNAME=Y
"RTN","MAGXCVS",61,0)
 I FQFNAME="" W !!,"No filename entered. Goodbye!" Q
"RTN","MAGXCVS",62,0)
 S %ZIS="",%ZIS("HFSNAME")=FQFNAME,%ZIS("HFSMODE")="R",IOP="HFS"
"RTN","MAGXCVS",63,0)
 S $ET="G ERR^"_$T(+0)
"RTN","MAGXCVS",64,0)
 D ^%ZIS I POP=1 W !,"Unable to open "_FQFNAME_". Please try again." G SM15
"RTN","MAGXCVS",65,0)
 W ! S FNAME=$P($P(FQFNAME,"\",$L(FQFNAME,"\")),".")
"RTN","MAGXCVS",66,0)
 S SUB=$$UCASE^MAGXCVP($P(FNAME,"_")),RANGE=$P(FNAME,"_",2)
"RTN","MAGXCVS",67,0)
 I RANGE="" S RANGE="not given"
"RTN","MAGXCVS",68,0)
 K ^TMP($J,"MAGIXCVSTAT") S ^TMP($J,"MAGIXCVSTAT",0)=SUB_"^"_RANGE
"RTN","MAGXCVS",69,0)
 F LN=1:1 U IO R DATA:99999 Q:DATA="***end***"  I LN>1 D  ; Skip header
"RTN","MAGXCVS",70,0)
 . S MAGIEN=$P(DATA,$C(9))
"RTN","MAGXCVS",71,0)
 . S PKG=$P(DATA,$C(9),8) I PKG="" S PKG="(none)"
"RTN","MAGXCVS",72,0)
 . S CLS=+$P(DATA,$C(9),9),TYP=+$P(DATA,$C(9),10),SPEC=+$P(DATA,$C(9),11)
"RTN","MAGXCVS",73,0)
 . S PROC=+$P(DATA,$C(9),12)
"RTN","MAGXCVS",74,0)
 . S X=$P(DATA,$C(9),13),ORIG=$S(X="":"(none)",1:$P(X,"-")_" - "_$P(X,"-",2,999))
"RTN","MAGXCVS",75,0)
 . I ORIG="" S ORIG="(none)"
"RTN","MAGXCVS",76,0)
 . S DESC=$$STRIP^MAGXCVP($$UCASE^MAGXCVP($P(DATA,$C(9),2))) I DESC="" S DESC="(none)"
"RTN","MAGXCVS",77,0)
 . S PROCTXT=$$STRIP^MAGXCVP($$UCASE^MAGXCVP($P(DATA,$C(9),3))) I PROCTXT="" S PROCTXT="(none)"
"RTN","MAGXCVS",78,0)
 . S PARENT=$P(DATA,$C(9),4) I PARENT="" S PARENT="(none)"
"RTN","MAGXCVS",79,0)
 . S DOCCAT=$P(DATA,$C(9),5) I DOCCAT="" S DOCCAT="(none)"
"RTN","MAGXCVS",80,0)
 . S OBJTYP=$P(DATA,$C(9),6) I OBJTYP="" S OBJTYP="(none)"
"RTN","MAGXCVS",81,0)
 . S SAVBYGRP=$P(DATA,$C(9),7) I SAVBYGRP="" S SAVBYGRP="(none)"
"RTN","MAGXCVS",82,0)
 . S ^(SAVBYGRP)=$G(^TMP($J,"MAGIXCVSTAT",PKG,CLS,TYP,PROC,SPEC,ORIG,DESC,PROCTXT,PARENT,DOCCAT,OBJTYP,SAVBYGRP))+1
"RTN","MAGXCVS",83,0)
 . I LN#100=0 U IO(0) W "."
"RTN","MAGXCVS",84,0)
 . I LN#5000=0 U IO(0) W LN,!
"RTN","MAGXCVS",85,0)
 . Q
"RTN","MAGXCVS",86,0)
 D ^%ZISC
"RTN","MAGXCVS",87,0)
 U IO(0) W !,"File import complete.",! G SM2
"RTN","MAGXCVS",88,0)
 ;
"RTN","MAGXCVS",89,0)
 ; Reached when an error (including end-of-file) occurs.
"RTN","MAGXCVS",90,0)
ERR ;
"RTN","MAGXCVS",91,0)
 S $ET=""
"RTN","MAGXCVS",92,0)
 D ^%ZISC
"RTN","MAGXCVS",93,0)
 U IO(0) X "W !,$ZE" W !,"Processing interrupted after ",LN," lines.",!
"RTN","MAGXCVS",94,0)
 ;
"RTN","MAGXCVS",95,0)
SM2 ;
"RTN","MAGXCVS",96,0)
 W !,"This report must be run on at least a 132-column device.",!
"RTN","MAGXCVS",97,0)
 D EN^XUTMDEVQ("ANZRPT^"_$T(+0),"Print Image Index Summary Report",.ZTSAVE)
"RTN","MAGXCVS",98,0)
 Q
"RTN","MAGXCVS",99,0)
 ;
"RTN","MAGXCVS",100,0)
ANZRPT ;
"RTN","MAGXCVS",101,0)
 I IOM<132 W !,"This report must be run on at least a 132-column device.  Goodbye!",! Q
"RTN","MAGXCVS",102,0)
 N KT,NUPG,OBJTYP,PG,PROCTXT,SAVBYGRP
"RTN","MAGXCVS",103,0)
 N FQUIT ; --- quit flag from header logic
"RTN","MAGXCVS",104,0)
 N RDATE ; --- report date
"RTN","MAGXCVS",105,0)
 ;
"RTN","MAGXCVS",106,0)
 S RDATE=$$HTE^XLFDT($H,1)
"RTN","MAGXCVS",107,0)
 S PG=0
"RTN","MAGXCVS",108,0)
 S FQUIT=0
"RTN","MAGXCVS",109,0)
 S SUB=$O(^MAG(2006.1,0)) I SUB S SUB=$P($G(^MAG(2006.1,SUB,0)),U)
"RTN","MAGXCVS",110,0)
 ;
"RTN","MAGXCVS",111,0)
 S PKG=""
"RTN","MAGXCVS",112,0)
 F  S PKG=$O(^TMP($J,"MAGIXCVSTAT",PKG)) Q:PKG=""  D  Q:FQUIT
"RTN","MAGXCVS",113,0)
 . S CLS=""
"RTN","MAGXCVS",114,0)
 . F  S CLS=$O(^TMP($J,"MAGIXCVSTAT",PKG,CLS)) Q:CLS=""  D  Q:FQUIT
"RTN","MAGXCVS",115,0)
 . . S TYP=""
"RTN","MAGXCVS",116,0)
 . . F  S TYP=$O(^TMP($J,"MAGIXCVSTAT",PKG,CLS,TYP)) Q:TYP=""  D  Q:FQUIT
"RTN","MAGXCVS",117,0)
 . . . S PROC=""
"RTN","MAGXCVS",118,0)
 . . . F  S PROC=$O(^TMP($J,"MAGIXCVSTAT",PKG,CLS,TYP,PROC)) Q:PROC=""  D  Q:FQUIT
"RTN","MAGXCVS",119,0)
 . . . . S SPEC=""
"RTN","MAGXCVS",120,0)
 . . . . F  S SPEC=$O(^TMP($J,"MAGIXCVSTAT",PKG,CLS,TYP,PROC,SPEC)) Q:SPEC=""  D  Q:FQUIT
"RTN","MAGXCVS",121,0)
 . . . . . S ORIG=""
"RTN","MAGXCVS",122,0)
 . . . . . F  S ORIG=$O(^TMP($J,"MAGIXCVSTAT",PKG,CLS,TYP,PROC,SPEC,ORIG)) Q:ORIG=""  D SPEC1 Q:FQUIT
"RTN","MAGXCVS",123,0)
 . . . . Q
"RTN","MAGXCVS",124,0)
 . . . Q
"RTN","MAGXCVS",125,0)
 . . Q
"RTN","MAGXCVS",126,0)
 . Q
"RTN","MAGXCVS",127,0)
 Q
"RTN","MAGXCVS",128,0)
 ;
"RTN","MAGXCVS",129,0)
SPEC1 ;
"RTN","MAGXCVS",130,0)
 S NUPG=1
"RTN","MAGXCVS",131,0)
 S DESC=""
"RTN","MAGXCVS",132,0)
 F  S DESC=$O(^TMP($J,"MAGIXCVSTAT",PKG,CLS,TYP,PROC,SPEC,ORIG,DESC)) Q:DESC=""  D  Q:FQUIT
"RTN","MAGXCVS",133,0)
 . S PROCTXT=""
"RTN","MAGXCVS",134,0)
 . F  S PROCTXT=$O(^TMP($J,"MAGIXCVSTAT",PKG,CLS,TYP,PROC,SPEC,ORIG,DESC,PROCTXT)) Q:PROCTXT=""  D  Q:FQUIT
"RTN","MAGXCVS",135,0)
 . . S PARENT=""
"RTN","MAGXCVS",136,0)
 . . F  S PARENT=$O(^TMP($J,"MAGIXCVSTAT",PKG,CLS,TYP,PROC,SPEC,ORIG,DESC,PROCTXT,PARENT)) Q:PARENT=""  D  Q:FQUIT
"RTN","MAGXCVS",137,0)
 . . . S DOCCAT=""
"RTN","MAGXCVS",138,0)
 . . . F  S DOCCAT=$O(^TMP($J,"MAGIXCVSTAT",PKG,CLS,TYP,PROC,SPEC,ORIG,DESC,PROCTXT,PARENT,DOCCAT)) Q:DOCCAT=""  D  Q:FQUIT
"RTN","MAGXCVS",139,0)
 . . . . S OBJTYP=""
"RTN","MAGXCVS",140,0)
 . . . . F  S OBJTYP=$O(^TMP($J,"MAGIXCVSTAT",PKG,CLS,TYP,PROC,SPEC,ORIG,DESC,PROCTXT,PARENT,DOCCAT,OBJTYP)) Q:OBJTYP=""  D  Q:FQUIT
"RTN","MAGXCVS",141,0)
 . . . . . S SAVBYGRP=""
"RTN","MAGXCVS",142,0)
 . . . . . F  S SAVBYGRP=$O(^TMP($J,"MAGIXCVSTAT",PKG,CLS,TYP,PROC,SPEC,ORIG,DESC,PROCTXT,PARENT,DOCCAT,OBJTYP,SAVBYGRP)) Q:SAVBYGRP=""  S KT=^(SAVBYGRP) D  Q:FQUIT
"RTN","MAGXCVS",143,0)
 . . . . . . I KT<FRQTHRS Q  ; count must exceed frequency threshold
"RTN","MAGXCVS",144,0)
 . . . . . . I ($Y>(IOSL-3))!NUPG D ANZHED Q:FQUIT
"RTN","MAGXCVS",145,0)
 . . . . . . W DESC,"  ",?34,PROCTXT,"  ",?64,PARENT,"  ",?78,DOCCAT,"  ",?92,OBJTYP,"  ",?106,SAVBYGRP,"  ",?150,$J(KT,8),!
"RTN","MAGXCVS",146,0)
 . . . . . . Q
"RTN","MAGXCVS",147,0)
 . . . . . Q
"RTN","MAGXCVS",148,0)
 . . . . Q
"RTN","MAGXCVS",149,0)
 . . . Q
"RTN","MAGXCVS",150,0)
 . . Q
"RTN","MAGXCVS",151,0)
 . Q
"RTN","MAGXCVS",152,0)
 Q
"RTN","MAGXCVS",153,0)
 ;
"RTN","MAGXCVS",154,0)
ANZHED ;
"RTN","MAGXCVS",155,0)
 I PG>0,IOT="TRM"!(IOT="VTRM") D  Q:FQUIT
"RTN","MAGXCVS",156,0)
 . R !!,"Press <RETURN> to continue, or '^' to exit: ",RET:DTIME
"RTN","MAGXCVS",157,0)
 . S FQUIT=(RET="^")
"RTN","MAGXCVS",158,0)
 . Q
"RTN","MAGXCVS",159,0)
 S PG=PG+1,NUPG=0
"RTN","MAGXCVS",160,0)
 W #!,"Site: ",SUB D CTR("IMAGE INDEX GENERATION REPORT") W ?115,"DATE ",RDATE,!
"RTN","MAGXCVS",161,0)
 ;W "Range: ",RANGE
"RTN","MAGXCVS",162,0)
 D CTR("Package: "_PKG)
"RTN","MAGXCVS",163,0)
 W ?122,$J("PAGE "_PG,8),!
"RTN","MAGXCVS",164,0)
 D CTR("Class: "_$S(CLS:CLS_" - "_$P($G(^MAG(2005.82,CLS,0)),"^"),1:"(none)")) W !
"RTN","MAGXCVS",165,0)
 D CTR("Type: "_$S(TYP:TYP_" - "_$P($G(^MAG(2005.83,TYP,0)),"^"),1:"(none)")) W !
"RTN","MAGXCVS",166,0)
 D CTR("Procedure/Event: "_$S(PROC:PROC_" - "_$P($G(^MAG(2005.85,PROC,0)),"^"),1:"(none)")) W !
"RTN","MAGXCVS",167,0)
 D CTR("Specialty: "_$S(SPEC:SPEC_" - "_$P($G(^MAG(2005.84,SPEC,0)),"^"),1:"(none)")) W !
"RTN","MAGXCVS",168,0)
 D CTR("Origin: "_ORIG) W !!
"RTN","MAGXCVS",169,0)
 W ?64,"Parent",!
"RTN","MAGXCVS",170,0)
 W "Short Description",?34,"Procedure Text",?64,"Data File",?78,"Document Cat",?92,"Object Type",?106,"Save By Group",?153,"Count",!!
"RTN","MAGXCVS",171,0)
 Q 
"RTN","MAGXCVS",172,0)
 ;
"RTN","MAGXCVS",173,0)
CTR(X) W ?65-($L(X)/2),X Q
"RTN","MAGXCVS",174,0)
EOR ;END ROUTINE
"RTN","MAGXIDXU")
0^62^B82620851
"RTN","MAGXIDXU",1,0)
MAGXIDXU ;WOIFO/JSL - MAG INDEX TERMS BUILD/UPDATE Utilities for Imaging Version 3.0; 06/29/2007 10:15
"RTN","MAGXIDXU",2,0)
 ;;3.0;IMAGING;**61,54**;03-July-2009;;Build 1424
"RTN","MAGXIDXU",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGXIDXU",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGXIDXU",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGXIDXU",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGXIDXU",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGXIDXU",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGXIDXU",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGXIDXU",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGXIDXU",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGXIDXU",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGXIDXU",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGXIDXU",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGXIDXU",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGXIDXU",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGXIDXU",17,0)
 ;;
"RTN","MAGXIDXU",18,0)
 Q
"RTN","MAGXIDXU",19,0)
 ;
"RTN","MAGXIDXU",20,0)
IDXUPDT ;API call - OPTION (MAG IMAGE INDEX TERMS UPDATE)
"RTN","MAGXIDXU",21,0)
 N DATE,IDA,SUB,XP,EOF,IN,MAGMSG,INXMB,LINE,LN,NEWSN,START,TKID,X,Y,XMZ,XMER,DIR
"RTN","MAGXIDXU",22,0)
 D GETENV^%ZOSV,KILL^XM
"RTN","MAGXIDXU",23,0)
 I '$D(^XUSEC("MAG SYSTEM",+$G(DUZ))) U IO(0) W !,"Calling user does not have security key MAG SYSTEM" Q
"RTN","MAGXIDXU",24,0)
 U IO(0) S DIR("A")="Update your local Index Terms with the latest Index Term Distribution (Y/N)",DIR("B")="Y",DIR(0)="Y" D ^DIR I '$G(Y) Q
"RTN","MAGXIDXU",25,0)
 S SUB="MAG INDEX TERMS UPDATE" K ^TMP(SUB,$J)
"RTN","MAGXIDXU",26,0)
 S TKID=$H*86400+$P($H,",",2)
"RTN","MAGXIDXU",27,0)
 S X="ERR^MAGXIDXU",@^%ZOSF("TRAP")
"RTN","MAGXIDXU",28,0)
 L +^XTMP(SUB):5 I '$T U IO(0) W !,"Some one is also updating Index Terms, ^XTMP("_SUB_") locked." H 5 Q
"RTN","MAGXIDXU",29,0)
 S INXMB=$$INXMB^MAGXIDX0 I 'INXMB U IO(0) W !,"No updated distribution." H 2 Q  ;latest idx update
"RTN","MAGXIDXU",30,0)
 U IO(0) W !
"RTN","MAGXIDXU",31,0)
 ;;IA 1048 - $$READ^XMGAPI1 Get the next line of XMZ message text.
"RTN","MAGXIDXU",32,0)
 S XMZ=INXMB F LN=1:1:256 S LINE=$$READ^XMGAPI1() Q:XMER=-1  I LINE[SUB Q
"RTN","MAGXIDXU",33,0)
 S LINE=$$READ^XMGAPI1() Q:XMER=-1  Q:LINE=""  S NEWSN=+$P(LINE,"SERIAL#",2)  ;new serial#
"RTN","MAGXIDXU",34,0)
 I +$G(^MAG(2005.82,"SERIAL#"))'<NEWSN U IO(0) W !,"The version is up-to-date." Q
"RTN","MAGXIDXU",35,0)
 F LN=1:1 S LINE=$$READ^XMGAPI1() Q:XMER=-1  S ^TMP(SUB,$J,LN)=LINE
"RTN","MAGXIDXU",36,0)
 I +$G(^MAG(2005.82,"SERIAL#"))<NEWSN D:$$PRECHK()
"RTN","MAGXIDXU",37,0)
 . S START=$$NOW^XLFDT
"RTN","MAGXIDXU",38,0)
 . F IN=2005.82,2005.83,2005.84,2005.85 I $D(^MAG(IN)) D
"RTN","MAGXIDXU",39,0)
 . . M ^XTMP("MAG INDEX TERMS BACKUP",TKID,IN)=^MAG(IN)
"RTN","MAGXIDXU",40,0)
 . . Q
"RTN","MAGXIDXU",41,0)
 . D UPDATE I $G(EOF)'=1 D UFAIL U IO(0) D  Q
"RTN","MAGXIDXU",42,0)
 . . W !,"The Update of Imaging Index Terms was Aborted.",!
"RTN","MAGXIDXU",43,0)
 . . W "The entire Distribution Mail Message was not received at this Site.",!
"RTN","MAGXIDXU",44,0)
 . . W "You need to call Imaging Support and have the Distribution Message Re-Sent to this site.",!
"RTN","MAGXIDXU",45,0)
 . . Q
"RTN","MAGXIDXU",46,0)
 . D INS("MAG INDEX TERMS UPDATE ",DUZ,START,""),MKBASE
"RTN","MAGXIDXU",47,0)
 . Q
"RTN","MAGXIDXU",48,0)
 L -^XTMP(SUB)
"RTN","MAGXIDXU",49,0)
 Q
"RTN","MAGXIDXU",50,0)
ERR ;error handler
"RTN","MAGXIDXU",51,0)
 Q:'$G(DUZ)
"RTN","MAGXIDXU",52,0)
 I $G(TKID) I $D(^XTMP("MAG INDEX TERMS BACKUP",TKID)) D RECOVER
"RTN","MAGXIDXU",53,0)
 D @^%ZOSF("ERRTN")
"RTN","MAGXIDXU",54,0)
 Q
"RTN","MAGXIDXU",55,0)
UPDATE ;called by IDXUPDT
"RTN","MAGXIDXU",56,0)
 NEW LN,MSG,Y,Y1,SCODE,SAVMAG,X
"RTN","MAGXIDXU",57,0)
 S LN=0 F  S LN=$O(^TMP(SUB,$J,LN)) Q:'LN!$G(EOF)  S Y=$G(^(LN)) DO
"RTN","MAGXIDXU",58,0)
 . I Y["Total Count:= " S EOF=1 U IO(0) W ! Q  ;EOF mark
"RTN","MAGXIDXU",59,0)
 . I Y["INDEX TABLE GLOBAL"&(Y["MAG") D
"RTN","MAGXIDXU",60,0)
 . . S SCODE="S ^TMP("""_SUB_""","_$J_",0,"_$P(Y,"^MAG(",2)_"="
"RTN","MAGXIDXU",61,0)
 . . S LN=$O(^TMP(SUB,$J,LN)) Q:'LN  S Y1=$G(^(LN))
"RTN","MAGXIDXU",62,0)
 . . S SCODE=SCODE_""""_Y1_""""
"RTN","MAGXIDXU",63,0)
 . . X SCODE U IO(0) W "*"
"RTN","MAGXIDXU",64,0)
 . . Q
"RTN","MAGXIDXU",65,0)
 . Q
"RTN","MAGXIDXU",66,0)
 I $G(EOF) U IO(0) W !,"Restore Code: "_TKID,! F IN=2005.82,2005.83,2005.84,2005.85 I $D(^TMP(SUB,$J,0,IN)) D
"RTN","MAGXIDXU",67,0)
 . W !,$P(^MAG(IN,0),"^"),"(#",IN,") ...updated.",!
"RTN","MAGXIDXU",68,0)
 . D CHKSTA
"RTN","MAGXIDXU",69,0)
 . K ^MAG(IN) M ^MAG(IN)=^TMP(SUB,$J,0,IN) ;set value
"RTN","MAGXIDXU",70,0)
 . S ^MAG(IN,"SERIAL#")=NEWSN
"RTN","MAGXIDXU",71,0)
 . Q
"RTN","MAGXIDXU",72,0)
 S Y=$$NOW^XLFDT()\1,X=$$FMADD^XLFDT(Y,7)
"RTN","MAGXIDXU",73,0)
 S ^XTMP("MAG INDEX TERMS BACKUP",0)=X_U_Y_U_SUB
"RTN","MAGXIDXU",74,0)
 Q
"RTN","MAGXIDXU",75,0)
CHKSTA ;verify current status w/ National ^TMP
"RTN","MAGXIDXU",76,0)
 N IEN,STA,STO S IEN=0
"RTN","MAGXIDXU",77,0)
 I IN=2005.84 F  S IEN=$O(^TMP(SUB,$J,0,IN,IEN)) Q:'IEN  D
"RTN","MAGXIDXU",78,0)
 . S STA=$P(^TMP(SUB,$J,0,IN,IEN,0),U,4),STO=$P($G(^MAG(IN,IEN,0)),U,4)
"RTN","MAGXIDXU",79,0)
 . I STA="I" Q  ;disable by national
"RTN","MAGXIDXU",80,0)
 . I STO="I" S $P(^TMP(SUB,$J,0,IN,IEN,0),U,4)=STO Q  ;kp site
"RTN","MAGXIDXU",81,0)
 . Q
"RTN","MAGXIDXU",82,0)
 I IN=2005.85 F  S IEN=$O(^TMP(SUB,$J,0,IN,IEN)) Q:'IEN  D
"RTN","MAGXIDXU",83,0)
 . S STA=$P(^TMP(SUB,$J,0,IN,IEN,0),U,3),STO=$P($G(^MAG(IN,IEN,0)),U,3)
"RTN","MAGXIDXU",84,0)
 . I STA="I" Q  ;disable by national
"RTN","MAGXIDXU",85,0)
 . I STO="I" S $P(^TMP(SUB,$J,0,IN,IEN,0),U,3)=STO Q  ;kp site
"RTN","MAGXIDXU",86,0)
 . Q
"RTN","MAGXIDXU",87,0)
 Q
"RTN","MAGXIDXU",88,0)
UFAIL ;UPDATE FAIL, no End Of File
"RTN","MAGXIDXU",89,0)
 N CT,CNT,COM,D,D0,D1,D2,DDATE,DG,DIC,DICR,DIW,MAGMSG,ST,XMID,XMY,XMSUB,XMERR
"RTN","MAGXIDXU",90,0)
 D GETENV^%ZOSV
"RTN","MAGXIDXU",91,0)
 S CNT=1,MAGMSG(CNT)="MAG INDEX TERMS UPDATE FAILED"
"RTN","MAGXIDXU",92,0)
 S CNT=CNT+1,MAGMSG(CNT)="SITE: "_$$KSP^XUPARAM("WHERE")
"RTN","MAGXIDXU",93,0)
 S CNT=CNT+1,MAGMSG(CNT)="PACKAGE: MAG INDEX TERMS UPDATE"
"RTN","MAGXIDXU",94,0)
 S CNT=CNT+1,MAGMSG(CNT)="Distribution: "_$G(NEWSN)
"RTN","MAGXIDXU",95,0)
 S CNT=CNT+1,MAGMSG(CNT)="Installed by: "_$$GET1^DIQ(200,DUZ,.01,"E")
"RTN","MAGXIDXU",96,0)
 S CNT=CNT+1,MAGMSG(CNT)="Did not receive whole package, there was no EOF mark"
"RTN","MAGXIDXU",97,0)
 S CNT=CNT+1,MAGMSG(CNT)="Please re-send new Index Terms message."
"RTN","MAGXIDXU",98,0)
 S XMSUB="MAG INDEX TERMS UPDATE #"_NEWSN_" Failed!"
"RTN","MAGXIDXU",99,0)
 S XMID=+$G(DUZ),XMY(XMID)=""
"RTN","MAGXIDXU",100,0)
 S XMY("G.MAG SERVER")=""
"RTN","MAGXIDXU",101,0)
 S:$G(MAGDUZ) XMY(MAGDUZ)=""
"RTN","MAGXIDXU",102,0)
 D SENDMSG^XMXAPI(XMID,XMSUB,"MAGMSG",.XMY,,.XMZ,)
"RTN","MAGXIDXU",103,0)
 D RECOVER
"RTN","MAGXIDXU",104,0)
 Q
"RTN","MAGXIDXU",105,0)
INS(XP,DUZ,DATE,IDA) ;return msg
"RTN","MAGXIDXU",106,0)
 N CT,CNT,COM,D,D0,D1,D2,DDATE,DG,DIC,DICR,DIW,MAGMSG,ST,XMID,XMY,XMSUB,XMERR
"RTN","MAGXIDXU",107,0)
 D GETENV^%ZOSV
"RTN","MAGXIDXU",108,0)
 S CNT=1,MAGMSG(CNT)="MAG INDEX TERMS Update is completed"
"RTN","MAGXIDXU",109,0)
 S CNT=CNT+1,MAGMSG(CNT)="SITE: "_$$KSP^XUPARAM("WHERE")
"RTN","MAGXIDXU",110,0)
 S CNT=CNT+1,MAGMSG(CNT)="PACKAGE: "_XP
"RTN","MAGXIDXU",111,0)
 S CNT=CNT+1,MAGMSG(CNT)="Distribution: "_$G(NEWSN)
"RTN","MAGXIDXU",112,0)
 S CNT=CNT+1,MAGMSG(CNT)="Start time: "_$$FMTE^XLFDT(DATE)
"RTN","MAGXIDXU",113,0)
 S CT=$$NOW^XLFDT  ;Time stamp
"RTN","MAGXIDXU",114,0)
 S CNT=CNT+1,MAGMSG(CNT)="Completion time: "_$$FMTE^XLFDT(CT)
"RTN","MAGXIDXU",115,0)
 S CNT=CNT+1,MAGMSG(CNT)="Run time: "_$$FMDIFF^XLFDT(CT,DATE,3)
"RTN","MAGXIDXU",116,0)
 S CNT=CNT+1,MAGMSG(CNT)="Environment: "_Y
"RTN","MAGXIDXU",117,0)
 S CNT=CNT+1,MAGMSG(CNT)="Restore Code: "_TKID
"RTN","MAGXIDXU",118,0)
 S CNT=CNT+1,MAGMSG(CNT)="DATE: "_$$FMTE^XLFDT(DATE)
"RTN","MAGXIDXU",119,0)
 S CNT=CNT+1,MAGMSG(CNT)="Installed by: "_$$GET1^DIQ(200,DUZ,.01,"E")
"RTN","MAGXIDXU",120,0)
 S CNT=CNT+1,MAGMSG(CNT)="Install Name: "_XP
"RTN","MAGXIDXU",121,0)
 S XMSUB=XP_"#"_NEWSN_" INSTALLATION"
"RTN","MAGXIDXU",122,0)
 S XMID=+$G(DUZ),XMY(XMID)=""
"RTN","MAGXIDXU",123,0)
 S XMY("G.MAG SERVER")=""
"RTN","MAGXIDXU",124,0)
 S:$G(MAGDUZ) XMY(MAGDUZ)=""
"RTN","MAGXIDXU",125,0)
 S XMSUB=$E(XMSUB,1,63)
"RTN","MAGXIDXU",126,0)
 D SENDMSG^XMXAPI(XMID,XMSUB,"MAGMSG",.XMY,,.XMZ,)
"RTN","MAGXIDXU",127,0)
 I $G(XMERR) M XMERR=^TMP("XMERR",$J) S $EC=",U13-Cannot send MailMan message,"
"RTN","MAGXIDXU",128,0)
 Q
"RTN","MAGXIDXU",129,0)
RESTORE ;API call - MAG INDXE TERM RESTORE
"RTN","MAGXIDXU",130,0)
 N ANS,IN,TKID,DIR,Y
"RTN","MAGXIDXU",131,0)
 D GETENV^%ZOSV
"RTN","MAGXIDXU",132,0)
 I '$D(^XUSEC("MAG SYSTEM",+$G(DUZ))) U IO(0) W !,"Calling user does not have security key MAG SYSTEM" Q
"RTN","MAGXIDXU",133,0)
 F IN=1:1:5 U IO(0) D  Q:$D(^XTMP("MAG INDEX TERMS BACKUP",+$G(TKID)))!($G(TKID)="^")
"RTN","MAGXIDXU",134,0)
 . W !,"To UnDo the Index Term updates and restore this site's Index Term files you need"
"RTN","MAGXIDXU",135,0)
 . W !,"the Restore Code that was included in the last INDEX TERMS UPDATE #",$G(^MAG(2005.82,"SERIAL#"))
"RTN","MAGXIDXU",136,0)
 . W !,"INSTALLATION message.",!
"RTN","MAGXIDXU",137,0)
 . W ! R "Enter Restore Code: ",TKID:360 I $G(TKID)["?" W " Restore Code please!",! S TKID=-1 Q
"RTN","MAGXIDXU",138,0)
 . W:'$D(^XTMP("MAG INDEX TERMS BACKUP",+$G(TKID))) !!,"Incorrect Restore Code, cannot restore the Index Term files."
"RTN","MAGXIDXU",139,0)
 . Q
"RTN","MAGXIDXU",140,0)
 Q:'$G(TKID)
"RTN","MAGXIDXU",141,0)
 S DIR("A")="Continue to restore Index Terms",DIR("B")="N",DIR(0)="Y" D ^DIR
"RTN","MAGXIDXU",142,0)
 I '$G(Y) U IO(0) W !,"Nothing done.",! Q 
"RTN","MAGXIDXU",143,0)
 D RECOVER,MKBASE
"RTN","MAGXIDXU",144,0)
 U IO(0) W !,"Done.",!
"RTN","MAGXIDXU",145,0)
 Q
"RTN","MAGXIDXU",146,0)
RECOVER ;Call by RESTORE
"RTN","MAGXIDXU",147,0)
 Q:$G(TKID)=""
"RTN","MAGXIDXU",148,0)
 F IN=2005.82,2005.83,2005.84,2005.85 D
"RTN","MAGXIDXU",149,0)
 . I $D(^MAG(IN))&$D(^XTMP("MAG INDEX TERMS BACKUP",TKID,IN)) D
"RTN","MAGXIDXU",150,0)
 . . K ^MAG(IN) M ^MAG(IN)=^XTMP("MAG INDEX TERMS BACKUP",TKID,IN) ;recoverd
"RTN","MAGXIDXU",151,0)
 . Q
"RTN","MAGXIDXU",152,0)
 Q
"RTN","MAGXIDXU",153,0)
MKBASE ;make last known base
"RTN","MAGXIDXU",154,0)
 N IN,SUBJ,X,X0,X1,X2 S SUBJ="MAG INDEX TERMS UPDATE"
"RTN","MAGXIDXU",155,0)
 F IN=2005.82,2005.83,2005.84,2005.85 M ^XTMP(SUBJ,0,"BASE",IN)=^MAG(IN)
"RTN","MAGXIDXU",156,0)
 S X0=$$NOW^XLFDT()\1,X=$$FMADD^XLFDT(X0,180),^XTMP(SUBJ,0)=X_U_X0_U_SUBJ
"RTN","MAGXIDXU",157,0)
 S ^XTMP(SUBJ,0,"BASE")=X0+17000000  ;yyyymmdd.hhmmss
"RTN","MAGXIDXU",158,0)
 Q
"RTN","MAGXIDXU",159,0)
PRECHK() ;check to see if should overwrite old
"RTN","MAGXIDXU",160,0)
 N X,Y,DIFF,DCNT  S (DIFF,DCNT)=0
"RTN","MAGXIDXU",161,0)
 I '$D(^XTMP(SUB,0,"BASE")) Q 1  ;no base to check
"RTN","MAGXIDXU",162,0)
 F IN="^MAG(2005.82","^MAG(2005.83" D  ;compare contain
"RTN","MAGXIDXU",163,0)
 . S X=IN_")" F  S X=$Q(@X) Q:X'[IN  I X[",0)",$L(X,",")=3 D
"RTN","MAGXIDXU",164,0)
 . . S Y="^XTMP("""_SUB_""","_0_",""BASE"","_$P(X,"^MAG(",2)
"RTN","MAGXIDXU",165,0)
 . . I $G(@Y)="" S DCNT=DCNT+1,DIFF=1,DIFF(DCNT)="Addition: "_X_" := "_@X Q
"RTN","MAGXIDXU",166,0)
 . . I $TR(@(X),U)'=$TR($G(@Y),U) D
"RTN","MAGXIDXU",167,0)
 . . . S DCNT=DCNT+1,DIFF=1,DIFF(DCNT)="Changed :  "_X_" := "_@X
"RTN","MAGXIDXU",168,0)
 . . . S DCNT=DCNT+1,DIFF=1,DIFF(DCNT)="Expected value:                "_$G(@Y)
"RTN","MAGXIDXU",169,0)
 . . Q
"RTN","MAGXIDXU",170,0)
 . Q
"RTN","MAGXIDXU",171,0)
 F IN="^MAG(2005.84","^MAG(2005.85" D  ;compare contain but STATUS
"RTN","MAGXIDXU",172,0)
 . S X=IN_")" F  S X=$Q(@X) Q:X'[IN  I X[",0)",$L(X,",")=3 D
"RTN","MAGXIDXU",173,0)
 . . S Y="^XTMP("""_SUB_""","_0_",""BASE"","_$P(X,"^MAG(",2)
"RTN","MAGXIDXU",174,0)
 . . I $TR(@(X),U)=$TR($G(@Y),U) Q
"RTN","MAGXIDXU",175,0)
 . . I $G(@Y)="" S DCNT=DCNT+1,DIFF=1,DIFF(DCNT)="Addition: "_X_" := "_@X Q
"RTN","MAGXIDXU",176,0)
 . . I IN["2005.84" I $TR($P(@X,U,1,3),U)=$TR($P($G(@Y),U,1,3),U) Q
"RTN","MAGXIDXU",177,0)
 . . I $TR($P(@X,U,1,2),U)=$TR($P($G(@Y),U,1,2),U) Q
"RTN","MAGXIDXU",178,0)
 . . S DCNT=DCNT+1,DIFF=1,DIFF(DCNT)="Changed :  "_X_" := "_@X
"RTN","MAGXIDXU",179,0)
 . . S DCNT=DCNT+1,DIFF=1,DIFF(DCNT)="Expected value:                "_$G(@Y)
"RTN","MAGXIDXU",180,0)
 . . Q
"RTN","MAGXIDXU",181,0)
 . Q
"RTN","MAGXIDXU",182,0)
 I DIFF S (DCNT,CNT)=0 D  ;find/report the difference
"RTN","MAGXIDXU",183,0)
 . S CNT=CNT+1,MAGMSG(CNT)="MAG INDEX TERMS UPDATE - PRE_CHECK FAILED"
"RTN","MAGXIDXU",184,0)
 . S CNT=CNT+1,MAGMSG(CNT)="SITE: "_$$KSP^XUPARAM("WHERE")
"RTN","MAGXIDXU",185,0)
 . S CNT=CNT+1,MAGMSG(CNT)="PACKAGE: MAG INDEX TERMS UPDATE"
"RTN","MAGXIDXU",186,0)
 . S CNT=CNT+1,MAGMSG(CNT)="Distribution: "_$G(NEWSN)
"RTN","MAGXIDXU",187,0)
 . S CNT=CNT+1,MAGMSG(CNT)="Changes have been made to the Index Term files at your site."
"RTN","MAGXIDXU",188,0)
 . S CNT=CNT+1,MAGMSG(CNT)="You must remove local Changes to these files before update can continue."
"RTN","MAGXIDXU",189,0)
 . S CNT=CNT+1,MAGMSG(CNT)=" - - - - - "
"RTN","MAGXIDXU",190,0)
 . S CNT=CNT+1,MAGMSG(CNT)="The Changes/Additions found were:"
"RTN","MAGXIDXU",191,0)
 . F CNT=CNT:1 S DCNT=$O(DIFF(DCNT)) Q:'DCNT  S MAGMSG(CNT+1)=DIFF(DCNT)
"RTN","MAGXIDXU",192,0)
 . S CNT=CNT+2 S MAGMSG(CNT)=" - - - - - "
"RTN","MAGXIDXU",193,0)
 . S CNT=CNT+1 S MAGMSG(CNT)="Log a Remedy Ticket with VistA Imaging Support for help"
"RTN","MAGXIDXU",194,0)
 . S XMSUB="MAG INDEX TERMS UPDATE #"_$G(NEWSN)_" update has Failed!"
"RTN","MAGXIDXU",195,0)
 . S XMID=+$G(DUZ),XMY(XMID)=""
"RTN","MAGXIDXU",196,0)
 . S XMY("G.MAG SERVER")=""
"RTN","MAGXIDXU",197,0)
 . S:$G(MAGDUZ) XMY(MAGDUZ)=""
"RTN","MAGXIDXU",198,0)
 . D WARNMSG^MAGXIDX0 F IN=1:1:CNT U IO(0) W !,$G(MAGMSG(IN)),!
"RTN","MAGXIDXU",199,0)
 . D SENDMSG^XMXAPI(XMID,XMSUB,"MAGMSG",.XMY,,.XMZ,)
"RTN","MAGXIDXU",200,0)
 . Q
"RTN","MAGXIDXU",201,0)
 Q $S(DIFF:0,1:1)
"RTN","MAGXIDXU",202,0)
 ;
"SEC","^DIC",2006.539,2006.539,0,"AUDIT")
@
"SEC","^DIC",2006.539,2006.539,0,"DD")
@
"SEC","^DIC",2006.539,2006.539,0,"DEL")
@
"SEC","^DIC",2006.539,2006.539,0,"LAYGO")
@
"SEC","^DIC",2006.539,2006.539,0,"RD")
@
"SEC","^DIC",2006.539,2006.539,0,"WR")
@
"SEC","^DIC",2006.5714,2006.5714,0,"AUDIT")
@
"SEC","^DIC",2006.5714,2006.5714,0,"DD")
@
"SEC","^DIC",2006.5714,2006.5714,0,"DEL")
@
"SEC","^DIC",2006.5714,2006.5714,0,"LAYGO")
@
"SEC","^DIC",2006.5714,2006.5714,0,"RD")
@
"SEC","^DIC",2006.5714,2006.5714,0,"WR")
@
"SEC","^DIC",2006.5733,2006.5733,0,"AUDIT")
@
"SEC","^DIC",2006.5733,2006.5733,0,"DD")
@
"SEC","^DIC",2006.5733,2006.5733,0,"DEL")
@
"SEC","^DIC",2006.5733,2006.5733,0,"LAYGO")
@
"SEC","^DIC",2006.5733,2006.5733,0,"RD")
@
"SEC","^DIC",2006.5733,2006.5733,0,"WR")
@
"SEC","^DIC",2006.574,2006.574,0,"AUDIT")
@
"SEC","^DIC",2006.574,2006.574,0,"DD")
@
"SEC","^DIC",2006.574,2006.574,0,"DEL")
@
"SEC","^DIC",2006.574,2006.574,0,"LAYGO")
@
"SEC","^DIC",2006.574,2006.574,0,"RD")
@
"SEC","^DIC",2006.574,2006.574,0,"WR")
@
"SEC","^DIC",2006.575,2006.575,0,"AUDIT")
@
"SEC","^DIC",2006.575,2006.575,0,"DD")
@
"SEC","^DIC",2006.575,2006.575,0,"DEL")
@
"SEC","^DIC",2006.575,2006.575,0,"LAYGO")
@
"SEC","^DIC",2006.575,2006.575,0,"RD")
@
"SEC","^DIC",2006.575,2006.575,0,"WR")
@
"SEC","^DIC",2006.5821,2006.5821,0,"AUDIT")
@
"SEC","^DIC",2006.5821,2006.5821,0,"DD")
@
"SEC","^DIC",2006.5821,2006.5821,0,"DEL")
@
"SEC","^DIC",2006.5821,2006.5821,0,"LAYGO")
@
"SEC","^DIC",2006.5821,2006.5821,0,"RD")
@
"SEC","^DIC",2006.5821,2006.5821,0,"WR")
@
"SEC","^DIC",2006.5849,2006.5849,0,"AUDIT")
@
"SEC","^DIC",2006.5849,2006.5849,0,"DD")
@
"SEC","^DIC",2006.5849,2006.5849,0,"DEL")
@
"SEC","^DIC",2006.5849,2006.5849,0,"LAYGO")
@
"SEC","^DIC",2006.5849,2006.5849,0,"RD")
@
"SEC","^DIC",2006.5849,2006.5849,0,"WR")
@
"SEC","^DIC",2006.587,2006.587,0,"AUDIT")
@
"SEC","^DIC",2006.587,2006.587,0,"DD")
@
"SEC","^DIC",2006.587,2006.587,0,"DEL")
@
"SEC","^DIC",2006.587,2006.587,0,"LAYGO")
@
"SEC","^DIC",2006.587,2006.587,0,"RD")
@
"SEC","^DIC",2006.587,2006.587,0,"WR")
@
"SEC","^DIC",2006.87,2006.87,0,"AUDIT")
@
"SEC","^DIC",2006.87,2006.87,0,"DD")
@
"SEC","^DIC",2006.87,2006.87,0,"DEL")
@
"SEC","^DIC",2006.87,2006.87,0,"LAYGO")
@
"SEC","^DIC",2006.87,2006.87,0,"RD")
@
"SEC","^DIC",2006.87,2006.87,0,"WR")
@
"VER")
8.0^22.0
"^DD",2005,2005,110,0)
DOCUMENT DATE^D^^100;6^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",2005,2005,110,3)
Enter the date (optionally time too) when this document was created.
"^DD",2005,2005,110,21,0)
^.001^1^1^3070118^^
"^DD",2005,2005,110,21,1,0)
Document Images can have a separate date, unlike clinical images that are attached to a procedure, and only procedure date is needed.
"^DD",2005,2005,110,"DT")
3070118
"^DD",2005.1,2005.1,110,0)
DOCUMENT DATE^D^^100;6^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",2005.1,2005.1,110,3)
Enter the date (optionally time too) when this document was created.
"^DD",2005.1,2005.1,110,21,0)
^.001^1^1^3070118^^
"^DD",2005.1,2005.1,110,21,1,0)
Document Images can have a separate date, unlike clinical images that are attached to a procedure, and only procedure date is needed.
"^DD",2005.1,2005.1,110,"DT")
3070118
"^DD",2006.539,2006.539,0)
FIELD^^5^5
"^DD",2006.539,2006.539,0,"DDA")
N
"^DD",2006.539,2006.539,0,"DT")
3071102
"^DD",2006.539,2006.539,0,"IX","B",2006.539,.01)

"^DD",2006.539,2006.539,0,"IX","C",2006.539,3)

"^DD",2006.539,2006.539,0,"IX","E",2006.5391,.01)

"^DD",2006.539,2006.539,0,"NM","DICOM UID SPECIFIC ACTION")

"^DD",2006.539,2006.539,.01,0)
UID^RF^^0;1^K:$L(X)>64!($L(X)<1)!'(X'?1P.E) X
"^DD",2006.539,2006.539,.01,1,0)
^.1
"^DD",2006.539,2006.539,.01,1,1,0)
2006.539^B
"^DD",2006.539,2006.539,.01,1,1,1)
S ^MAGDICOM(2006.539,"B",X,DA)=""
"^DD",2006.539,2006.539,.01,1,1,2)
K ^MAGDICOM(2006.539,"B",X,DA)
"^DD",2006.539,2006.539,.01,3)
Enter the UID for this entry.
"^DD",2006.539,2006.539,.01,21,0)
^^8^8^3071102^
"^DD",2006.539,2006.539,.01,21,1,0)
The value of this field is a string that conforms to the format
"^DD",2006.539,2006.539,.01,21,2,0)
of a DICOM UID (Unique Object Identifier).
"^DD",2006.539,2006.539,.01,21,3,0)
A UID is a string that consists of only digits and periods.
"^DD",2006.539,2006.539,.01,21,4,0)
The first and the last characters must be digits, and none of
"^DD",2006.539,2006.539,.01,21,5,0)
the integer numbers in the string (that are separated by periods)
"^DD",2006.539,2006.539,.01,21,6,0)
may have leading or trailing zeroes.
"^DD",2006.539,2006.539,.01,21,7,0)
 
"^DD",2006.539,2006.539,.01,21,8,0)
The meanings of UIDs are defined in the DICOM standard.
"^DD",2006.539,2006.539,.01,"DT")
3071102
"^DD",2006.539,2006.539,2,0)
DESCRIPTION^RF^^0;2^K:$L(X)>64!($L(X)<1) X
"^DD",2006.539,2006.539,2,3)
Enter the description for this UID.
"^DD",2006.539,2006.539,2,21,0)
^^2^2^3071102^
"^DD",2006.539,2006.539,2,21,1,0)
The value of this field is a string. This string is a descriptive
"^DD",2006.539,2006.539,2,21,2,0)
text that explains the meaning of the UID in this record.
"^DD",2006.539,2006.539,2,"DT")
3071102
"^DD",2006.539,2006.539,3,0)
TYPE^F^^0;3^K:$L(X)>20!($L(X)<1) X
"^DD",2006.539,2006.539,3,1,0)
^.1
"^DD",2006.539,2006.539,3,1,1,0)
2006.539^C
"^DD",2006.539,2006.539,3,1,1,1)
S ^MAGDICOM(2006.539,"C",X,DA)=""
"^DD",2006.539,2006.539,3,1,1,2)
K ^MAGDICOM(2006.539,"C",X,DA)
"^DD",2006.539,2006.539,3,1,1,"%D",0)
^^2^2^3071105^
"^DD",2006.539,2006.539,3,1,1,"%D",1,0)
This cross-reference keeps track of which UID belongs
"^DD",2006.539,2006.539,3,1,1,"%D",2,0)
to which type of object that has a UID.
"^DD",2006.539,2006.539,3,1,1,"DT")
3071105
"^DD",2006.539,2006.539,3,3)
Describe the type of entity for which this UID is used.
"^DD",2006.539,2006.539,3,21,0)
^^16^16^3071102^
"^DD",2006.539,2006.539,3,21,1,0)
The value of this field is a string. This string describes the
"^DD",2006.539,2006.539,3,21,2,0)
usage of this UID.
"^DD",2006.539,2006.539,3,21,3,0)
 
"^DD",2006.539,2006.539,3,21,4,0)
The DICOM standard currently identifies the following possible values:
"^DD",2006.539,2006.539,3,21,5,0)
   Application Context Name
"^DD",2006.539,2006.539,3,21,6,0)
   Coding Scheme
"^DD",2006.539,2006.539,3,21,7,0)
   DICOM UIDs as a Coding Scheme
"^DD",2006.539,2006.539,3,21,8,0)
   LDAP OID
"^DD",2006.539,2006.539,3,21,9,0)
   Meta SOP Class
"^DD",2006.539,2006.539,3,21,10,0)
   SOP Class
"^DD",2006.539,2006.539,3,21,11,0)
   Service Class
"^DD",2006.539,2006.539,3,21,12,0)
   Transfer Syntax
"^DD",2006.539,2006.539,3,21,13,0)
   Well-known Print Queue SOP Instance
"^DD",2006.539,2006.539,3,21,14,0)
   Well-known Printer SOP Instance
"^DD",2006.539,2006.539,3,21,15,0)
   Well-known SOP Instance
"^DD",2006.539,2006.539,3,21,16,0)
   Well-known frame of reference
"^DD",2006.539,2006.539,3,"DT")
3071105
"^DD",2006.539,2006.539,4,0)
SUBTYPE^F^^0;4^K:$L(X)>10!($L(X)<1) X
"^DD",2006.539,2006.539,4,3)
Indicate a sub-type (if any) for this UID.
"^DD",2006.539,2006.539,4,21,0)
^^6^6^3071102^
"^DD",2006.539,2006.539,4,21,1,0)
The value of this field is a string that identifies a sub-type for
"^DD",2006.539,2006.539,4,21,2,0)
the UID. Sub-types are not defined in the DICOM standard but are
"^DD",2006.539,2006.539,4,21,3,0)
used to distinguish between application-specific usages of UIDs.
"^DD",2006.539,2006.539,4,21,4,0)
 
"^DD",2006.539,2006.539,4,21,5,0)
For instance, an UID that has a "type" of "SOP Class" may have
"^DD",2006.539,2006.539,4,21,6,0)
a "sub-type" of "Storage".
"^DD",2006.539,2006.539,4,"DT")
3071105
"^DD",2006.539,2006.539,5,0)
PURPOSE^2006.5391A^^1;0
"^DD",2006.539,2006.5391,0)
PURPOSE SUB-FIELD^^3^3
"^DD",2006.539,2006.5391,0,"DT")
3071102
"^DD",2006.539,2006.5391,0,"IX","B",2006.5391,.01)

"^DD",2006.539,2006.5391,0,"NM","PURPOSE")

"^DD",2006.539,2006.5391,0,"UP")
2006.539
"^DD",2006.539,2006.5391,.01,0)
PURPOSE^MF^^0;1^K:$L(X)>64!($L(X)<1) X
"^DD",2006.539,2006.5391,.01,1,0)
^.1
"^DD",2006.539,2006.5391,.01,1,1,0)
2006.5391^B
"^DD",2006.539,2006.5391,.01,1,1,1)
S ^MAGDICOM(2006.539,DA(1),1,"B",X,DA)=""
"^DD",2006.539,2006.5391,.01,1,1,2)
K ^MAGDICOM(2006.539,DA(1),1,"B",X,DA)
"^DD",2006.539,2006.5391,.01,1,2,0)
2006.539^E
"^DD",2006.539,2006.5391,.01,1,2,1)
S ^MAGDICOM(2006.539,"E",X,DA(1),DA)=""
"^DD",2006.539,2006.5391,.01,1,2,2)
K ^MAGDICOM(2006.539,"E",X,DA(1),DA)
"^DD",2006.539,2006.5391,.01,1,2,"%D",0)
^^2^2^3071105^
"^DD",2006.539,2006.5391,.01,1,2,"%D",1,0)
This cross-reference keeps track of the various purposes for
"^DD",2006.539,2006.5391,.01,1,2,"%D",2,0)
which actions have been defined across all UIDs.
"^DD",2006.539,2006.5391,.01,1,2,"DT")
3071105
"^DD",2006.539,2006.5391,.01,3)
Enter the name of a purpose for which an action may be executed.
"^DD",2006.539,2006.5391,.01,21,0)
^^6^6^3071102^
"^DD",2006.539,2006.5391,.01,21,1,0)
The value of this field is a string. This string identifies an action
"^DD",2006.539,2006.5391,.01,21,2,0)
that may be executed by the application software.
"^DD",2006.539,2006.5391,.01,21,3,0)
 
"^DD",2006.539,2006.5391,.01,21,4,0)
Depending on the UID of the object being manipulated, the application
"^DD",2006.539,2006.5391,.01,21,5,0)
will find in this table which specific action is to be executed
"^DD",2006.539,2006.5391,.01,21,6,0)
for which specific purpose.
"^DD",2006.539,2006.5391,.01,"DT")
3071105
"^DD",2006.539,2006.5391,2,0)
ACTION^F^^0;2^K:$L(X)>10!($L(X)<1) X
"^DD",2006.539,2006.5391,2,3)
Answer must be 1-10 characters in length.
"^DD",2006.539,2006.5391,2,21,0)
^^11^11^3071102^
"^DD",2006.539,2006.5391,2,21,1,0)
The value of this field is a string. This string identifies the
"^DD",2006.539,2006.5391,2,21,2,0)
action to be taken by the application for this purpose for this UID.
"^DD",2006.539,2006.5391,2,21,3,0)
 
"^DD",2006.539,2006.5391,2,21,4,0)
Since the value in this field by be used by an application that runs
"^DD",2006.539,2006.5391,2,21,5,0)
on VistA, as well as by a client-application that acquires this
"^DD",2006.539,2006.5391,2,21,6,0)
value through a remote procedure, no assumption can be made about
"^DD",2006.539,2006.5391,2,21,7,0)
the mechanism that may be used to invoke the software to perform this
"^DD",2006.539,2006.5391,2,21,8,0)
action (it may be MUMPS, Delphi, Java, et cetera).
"^DD",2006.539,2006.5391,2,21,9,0)
 
"^DD",2006.539,2006.5391,2,21,10,0)
Hence, the value in this field will be a numeric code. The meaning of
"^DD",2006.539,2006.5391,2,21,11,0)
this code is specific to each purpose for which an action may be taken.
"^DD",2006.539,2006.5391,2,"DT")
3071102
"^DD",2006.539,2006.5391,3,0)
COMMENT^F^^0;3^K:$L(X)>100!($L(X)<1) X
"^DD",2006.539,2006.5391,3,3)
Enter a comment that describes this action.
"^DD",2006.539,2006.5391,3,21,0)
^^7^7^3071102^
"^DD",2006.539,2006.5391,3,21,1,0)
The value of this field is a string.
"^DD",2006.539,2006.5391,3,21,2,0)
The value that will be used by the applications to determine which
"^DD",2006.539,2006.5391,3,21,3,0)
action to take is taken from a different field in this record (ACTION).
"^DD",2006.539,2006.5391,3,21,4,0)
 
"^DD",2006.539,2006.5391,3,21,5,0)
In order to facilitate debugging and consistency checking, a semi
"^DD",2006.539,2006.5391,3,21,6,0)
free text is entered in this field that described the action to take
"^DD",2006.539,2006.5391,3,21,7,0)
in a human-readable form.
"^DD",2006.539,2006.5391,3,"DT")
3071102
"^DD",2006.563,2006.563,112,0)
VISTA STORAGE^F^^MOVE DESTINATION AE TITLE;1^K:$L(X)>16!($L(X)<1) X
"^DD",2006.563,2006.563,112,3)
Enter the AE Title of the VistA system for DICOM C-Move Storage
"^DD",2006.563,2006.563,112,21,0)
^^10^10^3060405^
"^DD",2006.563,2006.563,112,21,1,0)
The value of this field is a string.
"^DD",2006.563,2006.563,112,21,2,0)
This string represents the Application Entity that a PACS system
"^DD",2006.563,2006.563,112,21,3,0)
would use when transmitting image files to VistA using the
"^DD",2006.563,2006.563,112,21,4,0)
DICOM C-Move protocol.
"^DD",2006.563,2006.563,112,21,5,0)
 
"^DD",2006.563,2006.563,112,21,6,0)
(AE Title, C-Move and PACS are described in the DICOM Standard.)
"^DD",2006.563,2006.563,112,21,7,0)
 
"^DD",2006.563,2006.563,112,21,8,0)
An AE-Title is a string of up to 16 characters.
"^DD",2006.563,2006.563,112,21,9,0)
Since some systems also use AE-Titles as host-names for computers,
"^DD",2006.563,2006.563,112,21,10,0)
it is recommended that no spaces be used in AE-Titles.
"^DD",2006.563,2006.563,112,"DT")
3060405
"^DD",2006.5641,2006.5641,.01,0)
MACHINE ID^RNJ5,0^^0;1^K:+X'=X!(X>99999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.5641,2006.5641,.01,1,0)
^.1
"^DD",2006.5641,2006.5641,.01,1,1,0)
2006.5641^B
"^DD",2006.5641,2006.5641,.01,1,1,1)
S ^MAGDICOM(2006.5641,"B",$E(X,1,30),DA)=""
"^DD",2006.5641,2006.5641,.01,1,1,2)
K ^MAGDICOM(2006.5641,"B",$E(X,1,30),DA)
"^DD",2006.5641,2006.5641,.01,3)
Enter the unique identifier for this computer.
"^DD",2006.5641,2006.5641,.01,21,0)
^.001^1^1^3060711^^^
"^DD",2006.5641,2006.5641,.01,21,1,0)
The value of this field is the same as the internal entry number.
"^DD",2006.5641,2006.5641,.01,"DT")
3060711
"^DD",2006.5714,2006.5714,0)
FIELD^^4^5
"^DD",2006.5714,2006.5714,0,"DT")
3080530
"^DD",2006.5714,2006.5714,0,"IX","B",2006.5714,.01)

"^DD",2006.5714,2006.5714,0,"NM","DICOM INCOMPLETE OBJECT")

"^DD",2006.5714,2006.5714,.01,0)
DATE/TIME ADDED ($H)^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X?1.N1","1.N) X
"^DD",2006.5714,2006.5714,.01,1,0)
^.1
"^DD",2006.5714,2006.5714,.01,1,1,0)
2006.5714^B
"^DD",2006.5714,2006.5714,.01,1,1,1)
S ^MAGDINPT(2006.5714,"B",$E(X,1,30),DA)=""
"^DD",2006.5714,2006.5714,.01,1,1,2)
K ^MAGDINPT(2006.5714,"B",$E(X,1,30),DA)
"^DD",2006.5714,2006.5714,.01,3)
Answer must be 3-30 characters in length.
"^DD",2006.5714,2006.5714,.01,21,0)
^.001^2^2^3080530^^
"^DD",2006.5714,2006.5714,.01,21,1,0)
This is the date and time that the incomplete file was recorded, in $H
"^DD",2006.5714,2006.5714,.01,21,2,0)
format.
"^DD",2006.5714,2006.5714,.01,"DT")
3080530
"^DD",2006.5714,2006.5714,1,0)
RAW IMAGE^RP2006.571'^MAGDINPT(2006.571,^0;2^Q
"^DD",2006.5714,2006.5714,1,3)
This is the number of the corresponding entry in the DICOM RAW IMAGE File (#2006.571).
"^DD",2006.5714,2006.5714,1,21,0)
^.001^2^2^3080602^^^
"^DD",2006.5714,2006.5714,1,21,1,0)
This is the ID of the raw image that is to be processed as an incomplete 
"^DD",2006.5714,2006.5714,1,21,2,0)
object.
"^DD",2006.5714,2006.5714,1,"DT")
3080530
"^DD",2006.5714,2006.5714,2,0)
FILE PATH^F^^0;3^K:$L(X)>30!($L(X)<3) X
"^DD",2006.5714,2006.5714,2,3)
Answer must be 3-30 characters in length.
"^DD",2006.5714,2006.5714,2,21,0)
^.001^2^2^3080530^^
"^DD",2006.5714,2006.5714,2,21,1,0)
This is the path for the DICOM file.  Usually, this will be 
"^DD",2006.5714,2006.5714,2,21,2,0)
C:\DICOM\Image_In.
"^DD",2006.5714,2006.5714,2,"DT")
3080530
"^DD",2006.5714,2006.5714,3,0)
INSTRUMENT^RF^^0;4^K:$L(X)>30!($L(X)<3) X
"^DD",2006.5714,2006.5714,3,3)
Answer must be 3-30 characters in length.
"^DD",2006.5714,2006.5714,3,21,0)
^^2^2^3080530^
"^DD",2006.5714,2006.5714,3,21,1,0)
This is the piece of imaging equipment that captured the file that is 
"^DD",2006.5714,2006.5714,3,21,2,0)
marked as incomplete.
"^DD",2006.5714,2006.5714,3,"DT")
3080530
"^DD",2006.5714,2006.5714,4,0)
DATE/TIME ADDED (FILEMAN)^D^^0;5^S %DT="ESTR" D ^%DT S X=Y K:Y<1 X
"^DD",2006.5714,2006.5714,4,3)
This is the date and time that the incomplete file was recorded, in Fileman format.
"^DD",2006.5714,2006.5714,4,21,0)
^.001^2^2^3080602^^
"^DD",2006.5714,2006.5714,4,21,1,0)
This is the date and time that the incomplete file was recorded, in 
"^DD",2006.5714,2006.5714,4,21,2,0)
Fileman format.
"^DD",2006.5714,2006.5714,4,"DT")
3080530
"^DD",2006.5733,2006.5733,0)
FIELD^^2^2
"^DD",2006.5733,2006.5733,0,"DT")
3050804
"^DD",2006.5733,2006.5733,0,"IX","B",2006.5733,.01)

"^DD",2006.5733,2006.5733,0,"NM","QUERY/RETRIEVE STATISTICS")

"^DD",2006.5733,2006.5733,.01,0)
DATE^RDX^^0;1^S %DT="EX" D ^%DT S X=Y K:Y<1 X S:$D(X) DINUM=X
"^DD",2006.5733,2006.5733,.01,1,0)
^.1
"^DD",2006.5733,2006.5733,.01,1,1,0)
2006.5733^B
"^DD",2006.5733,2006.5733,.01,1,1,1)
S ^MAGDAUDT(2006.5733,"B",$E(X,1,30),DA)=""
"^DD",2006.5733,2006.5733,.01,1,1,2)
K ^MAGDAUDT(2006.5733,"B",$E(X,1,30),DA)
"^DD",2006.5733,2006.5733,.01,3)
Enter the date for which statistics are being entered.
"^DD",2006.5733,2006.5733,.01,21,0)
^.001^3^3^3050804^^^
"^DD",2006.5733,2006.5733,.01,21,1,0)
The value of this field is a date.
"^DD",2006.5733,2006.5733,.01,21,2,0)
This date identifies the date for which statistics
"^DD",2006.5733,2006.5733,.01,21,3,0)
are being recorded.
"^DD",2006.5733,2006.5733,.01,"DT")
3050804
"^DD",2006.5733,2006.5733,2,0)
LOCATION^2006.57331PA^^1;0
"^DD",2006.5733,2006.57331,0)
LOCATION SUB-FIELD^^2^2
"^DD",2006.5733,2006.57331,0,"DT")
3050804
"^DD",2006.5733,2006.57331,0,"IX","B",2006.57331,.01)

"^DD",2006.5733,2006.57331,0,"NM","LOCATION")

"^DD",2006.5733,2006.57331,0,"UP")
2006.5733
"^DD",2006.5733,2006.57331,.01,0)
LOCATION^RP4'^DIC(4,^0;1^Q
"^DD",2006.5733,2006.57331,.01,1,0)
^.1
"^DD",2006.5733,2006.57331,.01,1,1,0)
2006.57331^B
"^DD",2006.5733,2006.57331,.01,1,1,1)
S ^MAGDAUDT(2006.5733,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",2006.5733,2006.57331,.01,1,1,2)
K ^MAGDAUDT(2006.5733,DA(1),1,"B",$E(X,1,30),DA)
"^DD",2006.5733,2006.57331,.01,3)
Enter the location for the DICOM Gateway that performs the queries.
"^DD",2006.5733,2006.57331,.01,21,0)
^^4^4^3050804^
"^DD",2006.5733,2006.57331,.01,21,1,0)
The value of this field is a pointer to the Institution File (#4).
"^DD",2006.5733,2006.57331,.01,21,2,0)
The institution that is identified by this pointer is the
"^DD",2006.5733,2006.57331,.01,21,3,0)
institution for the DICOM Gateway from which the Query requests
"^DD",2006.5733,2006.57331,.01,21,4,0)
are being posted.
"^DD",2006.5733,2006.57331,.01,"DT")
3050804
"^DD",2006.5733,2006.57331,2,0)
TYPE^2006.57332A^^1;0
"^DD",2006.5733,2006.57332,0)
TYPE SUB-FIELD^^3^3
"^DD",2006.5733,2006.57332,0,"DT")
3050804
"^DD",2006.5733,2006.57332,0,"IX","B",2006.57332,.01)

"^DD",2006.5733,2006.57332,0,"NM","TYPE")

"^DD",2006.5733,2006.57332,0,"UP")
2006.57331
"^DD",2006.5733,2006.57332,.01,0)
TYPE^RF^^0;1^K:$L(X)>30!($L(X)<1) X
"^DD",2006.5733,2006.57332,.01,1,0)
^.1
"^DD",2006.5733,2006.57332,.01,1,1,0)
2006.57332^B
"^DD",2006.5733,2006.57332,.01,1,1,1)
S ^MAGDAUDT(2006.5733,DA(2),1,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",2006.5733,2006.57332,.01,1,1,2)
K ^MAGDAUDT(2006.5733,DA(2),1,DA(1),1,"B",$E(X,1,30),DA)
"^DD",2006.5733,2006.57332,.01,3)
Identify the type of RPC call being processed.
"^DD",2006.5733,2006.57332,.01,21,0)
^^2^2^3050804^
"^DD",2006.5733,2006.57332,.01,21,1,0)
The value of this field is a string.
"^DD",2006.5733,2006.57332,.01,21,2,0)
This string identifies the kind of Remote Procedure call that was processed for a query.
"^DD",2006.5733,2006.57332,.01,"DT")
3050804
"^DD",2006.5733,2006.57332,2,0)
COUNT^RNJ15,0^^0;2^K:+X'=X!(X>999999999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.5733,2006.57332,2,3)
Indicate how often a transaction of this type has taken place.
"^DD",2006.5733,2006.57332,2,21,0)
^^2^2^3050804^
"^DD",2006.5733,2006.57332,2,21,1,0)
The value of this field is a positive integer number.
"^DD",2006.5733,2006.57332,2,21,2,0)
This number indicates how often a certain type of RPC call has occurred.
"^DD",2006.5733,2006.57332,2,"DT")
3050804
"^DD",2006.5733,2006.57332,3,0)
DETAIL^2006.57333A^^1;0
"^DD",2006.5733,2006.57333,0)
DETAIL SUB-FIELD^^2^2
"^DD",2006.5733,2006.57333,0,"DT")
3050804
"^DD",2006.5733,2006.57333,0,"IX","B",2006.57333,.01)

"^DD",2006.5733,2006.57333,0,"NM","DETAIL")

"^DD",2006.5733,2006.57333,0,"UP")
2006.57332
"^DD",2006.5733,2006.57333,.01,0)
DETAIL^F^^0;1^K:$L(X)>30!($L(X)<1) X
"^DD",2006.5733,2006.57333,.01,1,0)
^.1
"^DD",2006.5733,2006.57333,.01,1,1,0)
2006.57333^B
"^DD",2006.5733,2006.57333,.01,1,1,1)
S ^MAGDAUDT(2006.5733,DA(3),1,DA(2),1,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",2006.5733,2006.57333,.01,1,1,2)
K ^MAGDAUDT(2006.5733,DA(3),1,DA(2),1,DA(1),1,"B",$E(X,1,30),DA)
"^DD",2006.5733,2006.57333,.01,3)
Indicate specifics about this RPC call.
"^DD",2006.5733,2006.57333,.01,21,0)
^^7^7^3050804^
"^DD",2006.5733,2006.57333,.01,21,1,0)
The value of this field is a string.
"^DD",2006.5733,2006.57333,.01,21,2,0)
This string identifies any detail about a transaction that is worth tallying 
"^DD",2006.5733,2006.57333,.01,21,3,0)
(e.g. in case a transaction has the type "Error",
"^DD",2006.5733,2006.57333,.01,21,4,0)
the value of this field would indicate the specific error and
"^DD",2006.5733,2006.57333,.01,21,5,0)
in case a transaction has the type "Done",
"^DD",2006.5733,2006.57333,.01,21,6,0)
he value of this field would indicate the number of rows in
"^DD",2006.5733,2006.57333,.01,21,7,0)
returned result.
"^DD",2006.5733,2006.57333,.01,"DT")
3050804
"^DD",2006.5733,2006.57333,2,0)
COUNT^NJ15,0^^0;2^K:+X'=X!(X>999999999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.5733,2006.57333,2,3)
Indicate how often this specific transaction has taken place.
"^DD",2006.5733,2006.57333,2,21,0)
^^3^3^3050804^
"^DD",2006.5733,2006.57333,2,21,1,0)
The value of this field is a positive integer number.
"^DD",2006.5733,2006.57333,2,21,2,0)
This number indicates how often a transaction of the same
"^DD",2006.5733,2006.57333,2,21,3,0)
type and specifics has occurred.
"^DD",2006.5733,2006.57333,2,"DT")
3050804
"^DD",2006.574,2006.574,0)
FIELD^^8^8
"^DD",2006.574,2006.574,0,"DDA")
N
"^DD",2006.574,2006.574,0,"DT")
3060213
"^DD",2006.574,2006.574,0,"IX","STUDY",2006.574,7)

"^DD",2006.574,2006.574,0,"NM","DICOM IMAGE OUTPUT")

"^DD",2006.574,2006.574,0,"VRPK")
IMAGING
"^DD",2006.574,2006.574,.01,0)
APPLICATION^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",2006.574,2006.574,.01,1,0)
^.1^^0
"^DD",2006.574,2006.574,.01,3)
Enter the name of the application that will receive the file(s).
"^DD",2006.574,2006.574,.01,21,0)
^^8^8^3000222^^
"^DD",2006.574,2006.574,.01,21,1,0)
The value of this field is a string that identifies
"^DD",2006.574,2006.574,.01,21,2,0)
the application that will receive the image files
"^DD",2006.574,2006.574,.01,21,3,0)
for which this entry describes the parameters.
"^DD",2006.574,2006.574,.01,21,4,0)
 
"^DD",2006.574,2006.574,.01,21,5,0)
The name that is entered here corresponds to the
"^DD",2006.574,2006.574,.01,21,6,0)
name (.01 field) in file 2006.585 (stored in ^MAGDICOM(2006.585,...)
"^DD",2006.574,2006.574,.01,21,7,0)
of the storage provider that will receive the image
"^DD",2006.574,2006.574,.01,21,8,0)
files.
"^DD",2006.574,2006.574,.01,"DT")
3000222
"^DD",2006.574,2006.574,2,0)
GROUP^P2005'^MAG(2005,^0;2^Q
"^DD",2006.574,2006.574,2,3)
Identify the group of images that is to be transported.
"^DD",2006.574,2006.574,2,21,0)
^^7^7^3000222^^
"^DD",2006.574,2006.574,2,21,1,0)
The value of this field is a pointer that identifies
"^DD",2006.574,2006.574,2,21,2,0)
the image that is the 'parent' of the group of images
"^DD",2006.574,2006.574,2,21,3,0)
for which this entry describes the transmission to
"^DD",2006.574,2006.574,2,21,4,0)
another storage provider.
"^DD",2006.574,2006.574,2,21,5,0)
 
"^DD",2006.574,2006.574,2,21,6,0)
The value of this field is a pointer to the Image File
"^DD",2006.574,2006.574,2,21,7,0)
(2005, stored in ^MAG(2005,...).
"^DD",2006.574,2006.574,2,"DT")
3000222
"^DD",2006.574,2006.574,3,0)
ACCESSION NUMBER^F^^0;3^K:$L(X)>20!($L(X)<1) X
"^DD",2006.574,2006.574,3,3)
Enter the accession number for the (group of) image(s) to be transported.
"^DD",2006.574,2006.574,3,21,0)
^^10^10^3000222^^
"^DD",2006.574,2006.574,3,21,1,0)
The value of this field is the (short) case number
"^DD",2006.574,2006.574,3,21,2,0)
for the study that is referenced in this entry.
"^DD",2006.574,2006.574,3,21,3,0)
 
"^DD",2006.574,2006.574,3,21,4,0)
A long case number consists of two groups of digits
"^DD",2006.574,2006.574,3,21,5,0)
separated by a dash. The first group is 6 digits,
"^DD",2006.574,2006.574,3,21,6,0)
and is derived from the date. The second group is
"^DD",2006.574,2006.574,3,21,7,0)
an integer number that uniquely identifies the study
"^DD",2006.574,2006.574,3,21,8,0)
for that date.
"^DD",2006.574,2006.574,3,21,9,0)
 
"^DD",2006.574,2006.574,3,21,10,0)
For this field, the whole accession number is entered.
"^DD",2006.574,2006.574,3,"DT")
3000222
"^DD",2006.574,2006.574,4,0)
IMAGE^2006.5744PA^^1;0
"^DD",2006.574,2006.574,5,0)
FROM^P4'^DIC(4,^0;4^Q
"^DD",2006.574,2006.574,5,1,0)
^.1^^0
"^DD",2006.574,2006.574,5,3)
Enter the name of the site from which the image routing request originates.
"^DD",2006.574,2006.574,5,21,0)
^^3^3^3010308^
"^DD",2006.574,2006.574,5,21,1,0)
The value of this field is a pointer (to the Institution file, #4).
"^DD",2006.574,2006.574,5,21,2,0)
This pointer identifies the location from which the image routing request
"^DD",2006.574,2006.574,5,21,3,0)
originated.
"^DD",2006.574,2006.574,5,"DT")
3041029
"^DD",2006.574,2006.574,6,0)
PRIORITY^NJ9,0^^0;5^K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",2006.574,2006.574,6,3)
Enter an integer number to represent the priority of this queue entry.
"^DD",2006.574,2006.574,6,21,0)
^^6^6^3050602^
"^DD",2006.574,2006.574,6,21,1,0)
The value of this field is a positive integer number.
"^DD",2006.574,2006.574,6,21,2,0)
This number indicates the relative priority of an entry in the queue.
"^DD",2006.574,2006.574,6,21,3,0)
 
"^DD",2006.574,2006.574,6,21,4,0)
A higher number indicates a higher priority, i.e. when two entries
"^DD",2006.574,2006.574,6,21,5,0)
have different priorities, the entry with the higher priority
"^DD",2006.574,2006.574,6,21,6,0)
will be processed before the one with the lower priority.
"^DD",2006.574,2006.574,6,"DT")
3050602
"^DD",2006.574,2006.574,7,0)
STUDY UID^F^^2;1^K:$L(X)>64!($L(X)<1)!'(X?1.(1N,1".")) X
"^DD",2006.574,2006.574,7,1,0)
^.1
"^DD",2006.574,2006.574,7,1,1,0)
2006.574^STUDY
"^DD",2006.574,2006.574,7,1,1,1)
S ^MAGDOUTP(2006.574,"STUDY",$E(X,1,30),DA)=""
"^DD",2006.574,2006.574,7,1,1,2)
K ^MAGDOUTP(2006.574,"STUDY",$E(X,1,30),DA)
"^DD",2006.574,2006.574,7,1,1,"%D",0)
^^2^2^3050818^
"^DD",2006.574,2006.574,7,1,1,"%D",1,0)
This cross reference keeps track of which "studies" are currently
"^DD",2006.574,2006.574,7,1,1,"%D",2,0)
queued for transmission.
"^DD",2006.574,2006.574,7,1,1,"DT")
3050818
"^DD",2006.574,2006.574,7,3)
Enter the Study UID for this group of images.
"^DD",2006.574,2006.574,7,21,0)
^^9^9^3050818^
"^DD",2006.574,2006.574,7,21,1,0)
The value of this field is a string that represents a
"^DD",2006.574,2006.574,7,21,2,0)
DICOM Unique Object Identifier. A DICOM UID is a string
"^DD",2006.574,2006.574,7,21,3,0)
that consists of up to 64 characters, each character must
"^DD",2006.574,2006.574,7,21,4,0)
be either a digit or a period, no two consecutive periods
"^DD",2006.574,2006.574,7,21,5,0)
are allowed, none of the series of consecutive digits
"^DD",2006.574,2006.574,7,21,6,0)
may start with a zero.
"^DD",2006.574,2006.574,7,21,7,0)
 
"^DD",2006.574,2006.574,7,21,8,0)
This UID identifies the study to which the images
"^DD",2006.574,2006.574,7,21,9,0)
belong that are included in the current entry.
"^DD",2006.574,2006.574,7,"DT")
3050818
"^DD",2006.574,2006.574,8,0)
COPY TO RAID^S^0:Do not copy;1:Make a copy;^0;6^Q
"^DD",2006.574,2006.574,8,3)
Indicate whether or not a copy of the image is to be made on RAID.
"^DD",2006.574,2006.574,8,21,0)
^^4^4^3060213^
"^DD",2006.574,2006.574,8,21,1,0)
The value of this field is a code that indicates whether or not
"^DD",2006.574,2006.574,8,21,2,0)
a copy of the image file(s) is to be made on RAID.
"^DD",2006.574,2006.574,8,21,3,0)
A value of 0 indicates that no copy is to be made on RAID.
"^DD",2006.574,2006.574,8,21,4,0)
A value of 1 indicates that a copy should be made.
"^DD",2006.574,2006.574,8,"DT")
3060213
"^DD",2006.574,2006.5744,0)
IMAGE SUB-FIELD^^3^3
"^DD",2006.574,2006.5744,0,"DT")
3041029
"^DD",2006.574,2006.5744,0,"NM","IMAGE")

"^DD",2006.574,2006.5744,0,"UP")
2006.574
"^DD",2006.574,2006.5744,.01,0)
IMAGE^P2005'^MAG(2005,^0;1^Q
"^DD",2006.574,2006.5744,.01,1,0)
^.1^^0
"^DD",2006.574,2006.5744,.01,3)
Identify the image(s) in this transmission.
"^DD",2006.574,2006.5744,.01,21,0)
^^6^6^3000222^^
"^DD",2006.574,2006.5744,.01,21,1,0)
The value of this field is a pointer that identifies
"^DD",2006.574,2006.5744,.01,21,2,0)
one of the images that is to be transmitted to
"^DD",2006.574,2006.5744,.01,21,3,0)
another storage provider.
"^DD",2006.574,2006.5744,.01,21,4,0)
 
"^DD",2006.574,2006.5744,.01,21,5,0)
The value of this field is a pointer to the Image File
"^DD",2006.574,2006.5744,.01,21,6,0)
(2005, stored in ^MAG(2005,...).
"^DD",2006.574,2006.5744,.01,"DT")
3000222
"^DD",2006.574,2006.5744,2,0)
STATUS^S^WAITING:Waiting to be transmitted;XMIT:Transmission in progress;FAIL:Transmission failed;SUCCESS:Transmission successfully completed;^0;2^Q
"^DD",2006.574,2006.5744,2,3)
Indicate the current status of this entry.
"^DD",2006.574,2006.5744,2,21,0)
^^7^7^3041029^
"^DD",2006.574,2006.5744,2,21,1,0)
The value of this field is a code that indicates the current
"^DD",2006.574,2006.5744,2,21,2,0)
status of the entry in this table.
"^DD",2006.574,2006.5744,2,21,3,0)
Possible values are "waiting to be transmitted", "transmission
"^DD",2006.574,2006.5744,2,21,4,0)
in progress" and "successful transmission" or "failed transmission".
"^DD",2006.574,2006.5744,2,21,5,0)
 
"^DD",2006.574,2006.5744,2,21,6,0)
A cross-reference on this field is used to prevent issuing the
"^DD",2006.574,2006.5744,2,21,7,0)
same file to multiple transmission processes.
"^DD",2006.574,2006.5744,2,"DT")
3070625
"^DD",2006.574,2006.5744,3,0)
TIMESTAMP^F^^0;3^K:$L(X)>15!($L(X)<3)!'(X?1.N1","1.N) X
"^DD",2006.574,2006.5744,3,3)
Indicate the current time ($H format).
"^DD",2006.574,2006.5744,3,21,0)
^^10^10^3041029^
"^DD",2006.574,2006.5744,3,21,1,0)
The value of this field is a string ($Horolog format) that
"^DD",2006.574,2006.5744,3,21,2,0)
indicates the date and time that the current status was established.
"^DD",2006.574,2006.5744,3,21,3,0)
 
"^DD",2006.574,2006.5744,3,21,4,0)
This value is used when checking on files that are in a status
"^DD",2006.574,2006.5744,3,21,5,0)
of "transmission in progress". When a file is too long in this
"^DD",2006.574,2006.5744,3,21,6,0)
status, the current entry will be moved back to a status of
"^DD",2006.574,2006.5744,3,21,7,0)
"waiting for transmission".
"^DD",2006.574,2006.5744,3,21,8,0)
 
"^DD",2006.574,2006.5744,3,21,9,0)
See the RPC named "MAG DICOM GET NEXT QUEUE ENTRY" for the
"^DD",2006.574,2006.5744,3,21,10,0)
actual time-lag that decides on a change-back of the status.
"^DD",2006.574,2006.5744,3,"DT")
3041029
"^DD",2006.575,2006.575,0)
FIELD^^37^37
"^DD",2006.575,2006.575,0,"DDA")
N
"^DD",2006.575,2006.575,0,"DT")
3040609
"^DD",2006.575,2006.575,0,"IX","B",2006.575,.01)

"^DD",2006.575,2006.575,0,"IX","F",2006.575,9)

"^DD",2006.575,2006.575,0,"NM","DICOM FAILED IMAGES")

"^DD",2006.575,2006.575,0,"PT",2006.5712,.01)

"^DD",2006.575,2006.575,0,"PT",2006.5712,2)

"^DD",2006.575,2006.575,0,"PT",2006.57526,.01)

"^DD",2006.575,2006.575,0,"VRPK")
MAG
"^DD",2006.575,2006.575,.01,0)
FILEPATH^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",2006.575,2006.575,.01,.1)
File Path
"^DD",2006.575,2006.575,.01,1,0)
^.1
"^DD",2006.575,2006.575,.01,1,1,0)
2006.575^B
"^DD",2006.575,2006.575,.01,1,1,1)
S ^MAGD(2006.575,"B",X,DA)=""
"^DD",2006.575,2006.575,.01,1,1,2)
K ^MAGD(2006.575,"B",X,DA)
"^DD",2006.575,2006.575,.01,3)
Enter the name of the image file (including directory path).
"^DD",2006.575,2006.575,.01,21,0)
^^3^3^3000306^^
"^DD",2006.575,2006.575,.01,21,1,0)
The value of this field is a string that represents
"^DD",2006.575,2006.575,.01,21,2,0)
the name of the image file that failed the matching
"^DD",2006.575,2006.575,.01,21,3,0)
process on the local DICOM Image gateway processing the image.
"^DD",2006.575,2006.575,.01,"DT")
2970226
"^DD",2006.575,2006.575,1,0)
FAILED REASON^S^NO CASE #:No case number;PID ERROR:Could not match patient;UNKNOWN:Any other reason;BAD CASE #:Format error in case number;CANCELLED:Case cancelled;^0;2^Q
"^DD",2006.575,2006.575,1,.1)
Reason for Failure
"^DD",2006.575,2006.575,1,3)
Enter 'No Case #', 'Bad Case #', 'PID Error' or 'Unknown' or 'Cancelled'.
"^DD",2006.575,2006.575,1,21,0)
^^11^11^3030421^
"^DD",2006.575,2006.575,1,21,1,0)
The value of this field is a code that indicates the
"^DD",2006.575,2006.575,1,21,2,0)
reason why the image file that is described in the
"^DD",2006.575,2006.575,1,21,3,0)
current entry could not be matched with a patient
"^DD",2006.575,2006.575,1,21,4,0)
and study.
"^DD",2006.575,2006.575,1,21,5,0)
 
"^DD",2006.575,2006.575,1,21,6,0)
The possible values for this field are NOCASE#, PATIENT, UNKNOWN or 
"^DD",2006.575,2006.575,1,21,7,0)
CANCELLED.
"^DD",2006.575,2006.575,1,21,8,0)
 
"^DD",2006.575,2006.575,1,21,9,0)
When the entry is processed the match for the Radiology entry is by
"^DD",2006.575,2006.575,1,21,10,0)
case number and then by patient ID. If these entries are not provided
"^DD",2006.575,2006.575,1,21,11,0)
correctly then entries are made into this file.
"^DD",2006.575,2006.575,1,"DT")
3030421
"^DD",2006.575,2006.575,2,0)
PID^F^^0;3^K:$L(X)>12!($L(X)<3) X
"^DD",2006.575,2006.575,2,.1)
Patient ID
"^DD",2006.575,2006.575,2,1,0)
^.1^^0
"^DD",2006.575,2006.575,2,3)
Enter the patient's SSN.
"^DD",2006.575,2006.575,2,21,0)
^^11^11^3001006^^
"^DD",2006.575,2006.575,2,21,1,0)
The value of this field is the value that is transmitted
"^DD",2006.575,2006.575,2,21,2,0)
by the modality for DICOM element 0010,0020.
"^DD",2006.575,2006.575,2,21,3,0)
Typically, the value of this field is equal to
"^DD",2006.575,2006.575,2,21,4,0)
the Social Security Number of the patient
"^DD",2006.575,2006.575,2,21,5,0)
for whom the study is scheduled.
"^DD",2006.575,2006.575,2,21,6,0)
(Without the dashes between the number-groups.)
"^DD",2006.575,2006.575,2,21,7,0)
 
"^DD",2006.575,2006.575,2,21,8,0)
This value is copied from the VistA Database, so that
"^DD",2006.575,2006.575,2,21,9,0)
worklist queries can also be performed when the network
"^DD",2006.575,2006.575,2,21,10,0)
connection (DDP) with the main Hospital Information System
"^DD",2006.575,2006.575,2,21,11,0)
is not available.
"^DD",2006.575,2006.575,2,"DT")
3041216
"^DD",2006.575,2006.575,3,0)
PATIENT^F^^0;4^K:$L(X)>35!($L(X)<3) X
"^DD",2006.575,2006.575,3,.1)
Patient Name (VA)
"^DD",2006.575,2006.575,3,1,0)
^.1^^0
"^DD",2006.575,2006.575,3,3)
Enter the name of the patient.
"^DD",2006.575,2006.575,3,21,0)
^^7^7^3000306^^
"^DD",2006.575,2006.575,3,21,1,0)
The value of this field is a string that represents
"^DD",2006.575,2006.575,3,21,2,0)
the name of the patient.
"^DD",2006.575,2006.575,3,21,3,0)
 
"^DD",2006.575,2006.575,3,21,4,0)
This value is reformatted as LAST NAME,FIRST NAME MID. The actual
"^DD",2006.575,2006.575,3,21,5,0)
name sent by the Radiology modality is in field PNAMEDCM. This field
"^DD",2006.575,2006.575,3,21,6,0)
will be used as one of the possible lookups for correction to this
"^DD",2006.575,2006.575,3,21,7,0)
entry.
"^DD",2006.575,2006.575,3,"DT")
3041216
"^DD",2006.575,2006.575,4,0)
PNAMEDCM^F^^0;5^K:$L(X)>35!($L(X)<3) X
"^DD",2006.575,2006.575,4,.1)
Patient Name (DICOM)
"^DD",2006.575,2006.575,4,1,0)
^.1^^0
"^DD",2006.575,2006.575,4,3)
Enter the name of the patient.
"^DD",2006.575,2006.575,4,21,0)
^^6^6^3000306^^
"^DD",2006.575,2006.575,4,21,1,0)
The value of this field is a string that represents
"^DD",2006.575,2006.575,4,21,2,0)
the name of the patient.
"^DD",2006.575,2006.575,4,21,3,0)
 
"^DD",2006.575,2006.575,4,21,4,0)
This value is copied from the information that was
"^DD",2006.575,2006.575,4,21,5,0)
transmitted by the Radiology
"^DD",2006.575,2006.575,4,21,6,0)
modality.
"^DD",2006.575,2006.575,4,"DT")
3041216
"^DD",2006.575,2006.575,5,0)
CASENUMB^F^^1;1^K:$L(X)>20!($L(X)<1) X
"^DD",2006.575,2006.575,5,.1)
Case Number (Modality)
"^DD",2006.575,2006.575,5,3)
Enter the case number.
"^DD",2006.575,2006.575,5,21,0)
^^6^6^3000306^^
"^DD",2006.575,2006.575,5,21,1,0)
The value of this field is a string that represents
"^DD",2006.575,2006.575,5,21,2,0)
the case number for the study.
"^DD",2006.575,2006.575,5,21,3,0)
 
"^DD",2006.575,2006.575,5,21,4,0)
This value is copied from the information that was
"^DD",2006.575,2006.575,5,21,5,0)
transmitted by the Radiology
"^DD",2006.575,2006.575,5,21,6,0)
X-Ray equipment.
"^DD",2006.575,2006.575,5,"DT")
2970226
"^DD",2006.575,2006.575,6,0)
CASE NO.^F^^1;2^K:$L(X)>20!($L(X)<1) X
"^DD",2006.575,2006.575,6,.1)
Case Number (Technician)
"^DD",2006.575,2006.575,6,3)
Enter the case number.
"^DD",2006.575,2006.575,6,21,0)
^^8^8^3000306^^
"^DD",2006.575,2006.575,6,21,1,0)
The value of this field is a string that represents
"^DD",2006.575,2006.575,6,21,2,0)
the case number for the study.
"^DD",2006.575,2006.575,6,21,3,0)
 
"^DD",2006.575,2006.575,6,21,4,0)
This value is copied from the information that was
"^DD",2006.575,2006.575,6,21,5,0)
entered by the technician during the image capture at
"^DD",2006.575,2006.575,6,21,6,0)
the Radiology X-Ray modality. This field will usually be empty since the
"^DD",2006.575,2006.575,6,21,7,0)
file will contain only entries that failed during the copying of images
"^DD",2006.575,2006.575,6,21,8,0)
to the Imaging file.
"^DD",2006.575,2006.575,6,"DT")
2970226
"^DD",2006.575,2006.575,7,0)
DATE ENTERED^D^^1;3^S %DT="E" D ^%DT S X=Y K:X<1 X
"^DD",2006.575,2006.575,7,.1)
Date Entered
"^DD",2006.575,2006.575,7,3)
Enter today's date.
"^DD",2006.575,2006.575,7,21,0)
^^4^4^3000306^^
"^DD",2006.575,2006.575,7,21,1,0)
The value of this field is a date value.
"^DD",2006.575,2006.575,7,21,2,0)
 
"^DD",2006.575,2006.575,7,21,3,0)
This value must be an exact date and represents
"^DD",2006.575,2006.575,7,21,4,0)
the date on which the entry was made into this file.
"^DD",2006.575,2006.575,7,"DT")
3041216
"^DD",2006.575,2006.575,8,0)
IMAGE UID^F^^AIUID;1^K:$L(X)>70!($L(X)<1) X
"^DD",2006.575,2006.575,8,.1)
Image UID
"^DD",2006.575,2006.575,8,3)
Enter the Image UID code.
"^DD",2006.575,2006.575,8,21,0)
^^7^7^3000306^^
"^DD",2006.575,2006.575,8,21,1,0)
The value of this field is a string that represents
"^DD",2006.575,2006.575,8,21,2,0)
the Image UID.
"^DD",2006.575,2006.575,8,21,3,0)
 
"^DD",2006.575,2006.575,8,21,4,0)
This value is copied from the information that is
"^DD",2006.575,2006.575,8,21,5,0)
transmitted by the modality. The Image UID is
"^DD",2006.575,2006.575,8,21,6,0)
a unique ID number assigned to the image by the Radiology X-Ray
"^DD",2006.575,2006.575,8,21,7,0)
modality.
"^DD",2006.575,2006.575,8,"DT")
2970226
"^DD",2006.575,2006.575,9,0)
STUDY UID^F^^ASUID;1^K:$L(X)>70!($L(X)<1) X
"^DD",2006.575,2006.575,9,.1)
Study UID
"^DD",2006.575,2006.575,9,1,0)
^.1^^-1
"^DD",2006.575,2006.575,9,1,1,0)
2006.575^F^MUMPS
"^DD",2006.575,2006.575,9,1,1,1)
D XREF^MAGDLB6
"^DD",2006.575,2006.575,9,1,1,2)
D XREFK^MAGDLB6
"^DD",2006.575,2006.575,9,1,1,"%D",0)
^^2^2^3030828^
"^DD",2006.575,2006.575,9,1,1,"%D",1,0)
This cross-reference indexes failed images by location and study instance 
"^DD",2006.575,2006.575,9,1,1,"%D",2,0)
UID.
"^DD",2006.575,2006.575,9,1,1,"DT")
3030828
"^DD",2006.575,2006.575,9,3)
Enter the Study UID code.
"^DD",2006.575,2006.575,9,21,0)
^.001^9^9^3021018^^^
"^DD",2006.575,2006.575,9,21,1,0)
The value of this field is a string that represents
"^DD",2006.575,2006.575,9,21,2,0)
the Study UID.
"^DD",2006.575,2006.575,9,21,3,0)
 
"^DD",2006.575,2006.575,9,21,4,0)
This value is copied from the information that is
"^DD",2006.575,2006.575,9,21,5,0)
transmitted by the modality. The Image UID is
"^DD",2006.575,2006.575,9,21,6,0)
a unique ID number assigned to the image by the Radiology X-Ray
"^DD",2006.575,2006.575,9,21,7,0)
modality.
"^DD",2006.575,2006.575,9,21,8,0)
A case study will consist of several images, each of which has its
"^DD",2006.575,2006.575,9,21,9,0)
own unique Image UID code.
"^DD",2006.575,2006.575,9,"DT")
3041216
"^DD",2006.575,2006.575,10,0)
INSTRUMENT NAME^F^^AMFG;1^K:$L(X)>10!($L(X)<1) X
"^DD",2006.575,2006.575,10,.1)
Instrument Name
"^DD",2006.575,2006.575,10,1,0)
^.1^^0
"^DD",2006.575,2006.575,10,3)
Enter the name of the instrument.
"^DD",2006.575,2006.575,10,21,0)
^^5^5^3000306^^
"^DD",2006.575,2006.575,10,21,1,0)
The value of this field is a string that represents
"^DD",2006.575,2006.575,10,21,2,0)
the name of the instrument that produced the image file.
"^DD",2006.575,2006.575,10,21,3,0)
 
"^DD",2006.575,2006.575,10,21,4,0)
Typical values for this field are texts like
"^DD",2006.575,2006.575,10,21,5,0)
CT1, CT2, CR3, and so forth.
"^DD",2006.575,2006.575,10,"DT")
3041216
"^DD",2006.575,2006.575,11,0)
ROWS^F^^AMFG;2^K:$L(X)>10!($L(X)<1) X
"^DD",2006.575,2006.575,11,.1)
Rows
"^DD",2006.575,2006.575,11,3)
Enter the number of pixel rows in the image.
"^DD",2006.575,2006.575,11,21,0)
^^5^5^3000306^^
"^DD",2006.575,2006.575,11,21,1,0)
The value of this field is an integer number that
"^DD",2006.575,2006.575,11,21,2,0)
represents the number of pixel rows in the image.
"^DD",2006.575,2006.575,11,21,3,0)
 
"^DD",2006.575,2006.575,11,21,4,0)
This value is copied from the information that is
"^DD",2006.575,2006.575,11,21,5,0)
transmitted by the Radiology modality.
"^DD",2006.575,2006.575,11,"DT")
2970226
"^DD",2006.575,2006.575,12,0)
COLUMNS^F^^AMFG;3^K:$L(X)>10!($L(X)<1) X
"^DD",2006.575,2006.575,12,.1)
Columns
"^DD",2006.575,2006.575,12,3)
Enter the number of pixel columns in the image.
"^DD",2006.575,2006.575,12,21,0)
^^5^5^3000306^^
"^DD",2006.575,2006.575,12,21,1,0)
The value of this field is an integer number that
"^DD",2006.575,2006.575,12,21,2,0)
represents the number of pixel columns in the image.
"^DD",2006.575,2006.575,12,21,3,0)
 
"^DD",2006.575,2006.575,12,21,4,0)
This value is copied from the information that is
"^DD",2006.575,2006.575,12,21,5,0)
transmitted by the Radiology modality.
"^DD",2006.575,2006.575,12,"DT")
2970226
"^DD",2006.575,2006.575,13,0)
OFFSET^F^^AMFG;4^K:$L(X)>20!($L(X)<1) X
"^DD",2006.575,2006.575,13,.1)
Offset
"^DD",2006.575,2006.575,13,3)
Enter the byte address where the image data begins.
"^DD",2006.575,2006.575,13,21,0)
^^6^6^3000306^^
"^DD",2006.575,2006.575,13,21,1,0)
The value of this field is an integer number that
"^DD",2006.575,2006.575,13,21,2,0)
represents the byte address in the image file where
"^DD",2006.575,2006.575,13,21,3,0)
the image data begins.
"^DD",2006.575,2006.575,13,21,4,0)
 
"^DD",2006.575,2006.575,13,21,5,0)
This value is copied from the information that is
"^DD",2006.575,2006.575,13,21,6,0)
transmitted by the Radiology modality.
"^DD",2006.575,2006.575,13,"DT")
2970226
"^DD",2006.575,2006.575,14,0)
MODIEN^F^^AMFG;5^K:$L(X)>10!($L(X)<1) X
"^DD",2006.575,2006.575,14,.1)
Modien
"^DD",2006.575,2006.575,14,3)
Identify the modality.
"^DD",2006.575,2006.575,14,21,0)
^^5^5^3000306^^
"^DD",2006.575,2006.575,14,21,1,0)
The value of this field is a pointer to the Modality
"^DD",2006.575,2006.575,14,21,2,0)
file (# 2006.582, stored in ^MAGDICOM(2006.582,...).
"^DD",2006.575,2006.575,14,21,3,0)
 
"^DD",2006.575,2006.575,14,21,4,0)
This value identifies the modality (type of instrument)
"^DD",2006.575,2006.575,14,21,5,0)
that transmitted the image file.
"^DD",2006.575,2006.575,14,"DT")
2970226
"^DD",2006.575,2006.575,16,0)
FIXED^S^1:YES;^FIXD;1^Q
"^DD",2006.575,2006.575,16,.1)
Fixed
"^DD",2006.575,2006.575,16,1,0)
^.1^^0
"^DD",2006.575,2006.575,16,3)
Identify whether or not this entry has been corrected.
"^DD",2006.575,2006.575,16,21,0)
^^12^12^3000306^^
"^DD",2006.575,2006.575,16,21,1,0)
The value of this field is a code that identifies
"^DD",2006.575,2006.575,16,21,2,0)
whether or not the problem that is reported in the
"^DD",2006.575,2006.575,16,21,3,0)
current entry has been corrected.
"^DD",2006.575,2006.575,16,21,4,0)
 
"^DD",2006.575,2006.575,16,21,5,0)
Entries are corrected in this file using either of
"^DD",2006.575,2006.575,16,21,6,0)
the menu options
"^DD",2006.575,2006.575,16,21,7,0)
 MAGD FIX DICOM or
"^DD",2006.575,2006.575,16,21,8,0)
 MAGD FIX MEDICINE
"^DD",2006.575,2006.575,16,21,9,0)
 
"^DD",2006.575,2006.575,16,21,10,0)
When the entry is
"^DD",2006.575,2006.575,16,21,11,0)
manually matched with a patient and procedure the correction routine will
"^DD",2006.575,2006.575,16,21,12,0)
update this field.
"^DD",2006.575,2006.575,16,23,0)
^^2^2^3000216^
"^DD",2006.575,2006.575,16,23,1,0)
This field creates a cross reference used by the DICOM Image server to know
"^DD",2006.575,2006.575,16,23,2,0)
which entries are ready for re-processing. 
"^DD",2006.575,2006.575,16,"DT")
3041216
"^DD",2006.575,2006.575,17,0)
NEWDFN^F^^FIXD;2^K:$L(X)>10!($L(X)<1) X
"^DD",2006.575,2006.575,17,.1)
New DFN
"^DD",2006.575,2006.575,17,3)
Identify the patient.
"^DD",2006.575,2006.575,17,21,0)
^^8^8^3000306^^
"^DD",2006.575,2006.575,17,21,1,0)
The value of this field is a pointer to the Patient
"^DD",2006.575,2006.575,17,21,2,0)
file (# 2, stored in ^DPT(...).
"^DD",2006.575,2006.575,17,21,3,0)
 
"^DD",2006.575,2006.575,17,21,4,0)
This value identifies the (new) patient, and is
"^DD",2006.575,2006.575,17,21,5,0)
defined using either of
"^DD",2006.575,2006.575,17,21,6,0)
the menu options
"^DD",2006.575,2006.575,17,21,7,0)
 MAGD FIX DICOM or
"^DD",2006.575,2006.575,17,21,8,0)
 MAGD FIX MEDICINE
"^DD",2006.575,2006.575,17,"DT")
2970226
"^DD",2006.575,2006.575,18,0)
NEWNME^F^^FIXD;3^K:$L(X)>35!($L(X)<1) X
"^DD",2006.575,2006.575,18,.1)
New Name
"^DD",2006.575,2006.575,18,3)
Enter the name of the patient.
"^DD",2006.575,2006.575,18,21,0)
^^8^8^3000306^^
"^DD",2006.575,2006.575,18,21,1,0)
The value of this field is a string that represents
"^DD",2006.575,2006.575,18,21,2,0)
the name of a patient.
"^DD",2006.575,2006.575,18,21,3,0)
 
"^DD",2006.575,2006.575,18,21,4,0)
This value identifies the (new) patient, and is
"^DD",2006.575,2006.575,18,21,5,0)
defined using either of
"^DD",2006.575,2006.575,18,21,6,0)
the menu options
"^DD",2006.575,2006.575,18,21,7,0)
 MAGD FIX DICOM or
"^DD",2006.575,2006.575,18,21,8,0)
 MAGD FIX MEDICINE
"^DD",2006.575,2006.575,18,"DT")
2970226
"^DD",2006.575,2006.575,19,0)
NEWSSN^F^^FIXD;4^K:$L(X)>10!($L(X)<1) X
"^DD",2006.575,2006.575,19,.1)
Newssn
"^DD",2006.575,2006.575,19,3)
Enter the patient's SSN.
"^DD",2006.575,2006.575,19,21,0)
^^8^8^3000306^^
"^DD",2006.575,2006.575,19,21,1,0)
The value of this field is a string that represents
"^DD",2006.575,2006.575,19,21,2,0)
the Social Security Number of a patient.
"^DD",2006.575,2006.575,19,21,3,0)
 
"^DD",2006.575,2006.575,19,21,4,0)
This value identifies the (new) patient, and is
"^DD",2006.575,2006.575,19,21,5,0)
defined using either of
"^DD",2006.575,2006.575,19,21,6,0)
the menu options
"^DD",2006.575,2006.575,19,21,7,0)
 MAGD FIX DICOM or
"^DD",2006.575,2006.575,19,21,8,0)
 MAGD FIX MEDICINE
"^DD",2006.575,2006.575,19,"DT")
2970226
"^DD",2006.575,2006.575,20,0)
NEWCASE NO^F^^FIXD;5^K:$L(X)>20!($L(X)<1) X
"^DD",2006.575,2006.575,20,.1)
New Case Number
"^DD",2006.575,2006.575,20,3)
Enter the case number.
"^DD",2006.575,2006.575,20,21,0)
^^8^8^3000306^^
"^DD",2006.575,2006.575,20,21,1,0)
The value of this field is a string that represents
"^DD",2006.575,2006.575,20,21,2,0)
the accession number for a study.
"^DD",2006.575,2006.575,20,21,3,0)
 
"^DD",2006.575,2006.575,20,21,4,0)
This value identifies the (new) study, and is
"^DD",2006.575,2006.575,20,21,5,0)
defined using either of
"^DD",2006.575,2006.575,20,21,6,0)
the menu options
"^DD",2006.575,2006.575,20,21,7,0)
 MAGD FIX DICOM or
"^DD",2006.575,2006.575,20,21,8,0)
 MAGD FIX MEDICINE
"^DD",2006.575,2006.575,20,"DT")
2970226
"^DD",2006.575,2006.575,21,0)
NEW RADTI^F^^FIXD;6^K:$L(X)>20!($L(X)<1) X
"^DD",2006.575,2006.575,21,.1)
New Reverse Date
"^DD",2006.575,2006.575,21,3)
Identify the date/time of the study.
"^DD",2006.575,2006.575,21,21,0)
^^12^12^3000306^^
"^DD",2006.575,2006.575,21,21,1,0)
The value of this field is a string that represents
"^DD",2006.575,2006.575,21,21,2,0)
the date and time when the study was executed.
"^DD",2006.575,2006.575,21,21,3,0)
 
"^DD",2006.575,2006.575,21,21,4,0)
This value is a 'reverse' date time, as defined by
"^DD",2006.575,2006.575,21,21,5,0)
the Radiology software. It is used as the second subscript (RADTI)
"^DD",2006.575,2006.575,21,21,6,0)
in references like ^RARPT(RADPT,"DT",RADTI,"P",RACNI
"^DD",2006.575,2006.575,21,21,7,0)
 
"^DD",2006.575,2006.575,21,21,8,0)
This value timestamps the (new) study, and is
"^DD",2006.575,2006.575,21,21,9,0)
defined using either of
"^DD",2006.575,2006.575,21,21,10,0)
the menu options
"^DD",2006.575,2006.575,21,21,11,0)
 MAGD FIX DICOM or
"^DD",2006.575,2006.575,21,21,12,0)
 MAGD FIX MEDICINE
"^DD",2006.575,2006.575,21,"DT")
2970226
"^DD",2006.575,2006.575,22,0)
NEW RACNI^F^^FIXD;7^K:$L(X)>20!($L(X)<1) X
"^DD",2006.575,2006.575,22,.1)
New Case Number
"^DD",2006.575,2006.575,22,3)
Enter the case number.
"^DD",2006.575,2006.575,22,21,0)
^^11^11^3000306^^
"^DD",2006.575,2006.575,22,21,1,0)
The value of this field is a string that represents
"^DD",2006.575,2006.575,22,21,2,0)
the case number for the study.
"^DD",2006.575,2006.575,22,21,3,0)
 
"^DD",2006.575,2006.575,22,21,4,0)
This value is used as the third subscript (RADCNI)
"^DD",2006.575,2006.575,22,21,5,0)
in references like ^RARPT(RADPT,"DT",RADTI,"P",RACNI
"^DD",2006.575,2006.575,22,21,6,0)
 
"^DD",2006.575,2006.575,22,21,7,0)
This value identifies the (new) study, and is
"^DD",2006.575,2006.575,22,21,8,0)
defined using either of
"^DD",2006.575,2006.575,22,21,9,0)
the menu options
"^DD",2006.575,2006.575,22,21,10,0)
 MAGD FIX DICOM or
"^DD",2006.575,2006.575,22,21,11,0)
 MAGD FIX MEDICINE
"^DD",2006.575,2006.575,22,"DT")
2970226
"^DD",2006.575,2006.575,23,0)
DATE/TIME^F^^FIXD;8^K:$L(X)>20!($L(X)<1) X
"^DD",2006.575,2006.575,23,.1)
Date/Time
"^DD",2006.575,2006.575,23,3)
Enter this moment's date and time.
"^DD",2006.575,2006.575,23,21,0)
^^7^7^3000306^^
"^DD",2006.575,2006.575,23,21,1,0)
The value of this field is a string that represents
"^DD",2006.575,2006.575,23,21,2,0)
a date/time value.
"^DD",2006.575,2006.575,23,21,3,0)
 
"^DD",2006.575,2006.575,23,21,4,0)
This value is copied from the information that was
"^DD",2006.575,2006.575,23,21,5,0)
transmitted by the Radiology modality. It is
"^DD",2006.575,2006.575,23,21,6,0)
a timestamp for the moment when the image
"^DD",2006.575,2006.575,23,21,7,0)
file was processed.
"^DD",2006.575,2006.575,23,"DT")
2970226
"^DD",2006.575,2006.575,24,0)
NEW PROC IEN^F^^FIXPR;1^K:$L(X)>20!($L(X)<1) X
"^DD",2006.575,2006.575,24,.1)
New Procedure IEN
"^DD",2006.575,2006.575,24,3)
Identify the procedure.
"^DD",2006.575,2006.575,24,21,0)
^^8^8^3000306^^
"^DD",2006.575,2006.575,24,21,1,0)
The value of this field is a pointer to the
"^DD",2006.575,2006.575,24,21,2,0)
Rad/Nuc procedure file (#71, stored in ^RAMIS(71,...).
"^DD",2006.575,2006.575,24,21,3,0)
 
"^DD",2006.575,2006.575,24,21,4,0)
This value is an internal entry number, and is
"^DD",2006.575,2006.575,24,21,5,0)
defined using either of
"^DD",2006.575,2006.575,24,21,6,0)
the menu options
"^DD",2006.575,2006.575,24,21,7,0)
 MAGD FIX DICOM or
"^DD",2006.575,2006.575,24,21,8,0)
 MAGD FIX MEDICINE
"^DD",2006.575,2006.575,24,"DT")
2970226
"^DD",2006.575,2006.575,25,0)
NEW PROCEDURE^F^^FIXPR;2^K:$L(X)>70!($L(X)<1) X
"^DD",2006.575,2006.575,25,.1)
New Procedure
"^DD",2006.575,2006.575,25,3)
Enter the name of the procedure.
"^DD",2006.575,2006.575,25,21,0)
^^9^9^3000306^^
"^DD",2006.575,2006.575,25,21,1,0)
This is the new procedure name defined using the MAGD FIX DICOM or MAGD FIX MEDICINE menu option.
"^DD",2006.575,2006.575,25,21,2,0)
The value of this field is a string that represents
"^DD",2006.575,2006.575,25,21,3,0)
the name of a procedure found in the Rad/Nuc procedure file (#71, stored in ^RAMIS(71,...).
"^DD",2006.575,2006.575,25,21,4,0)
 
"^DD",2006.575,2006.575,25,21,5,0)
This value is the name of a procedure, and is
"^DD",2006.575,2006.575,25,21,6,0)
defined using either of
"^DD",2006.575,2006.575,25,21,7,0)
the menu options
"^DD",2006.575,2006.575,25,21,8,0)
 MAGD FIX DICOM or
"^DD",2006.575,2006.575,25,21,9,0)
 MAGD FIX MEDICINE
"^DD",2006.575,2006.575,25,"DT")
2970226
"^DD",2006.575,2006.575,26,0)
RELATED IMAGES^2006.57526PA^^RLATE;0
"^DD",2006.575,2006.575,26,21,0)
^^2^2^3000216^
"^DD",2006.575,2006.575,26,21,1,0)
This is the multiple sub-file that repoints to this file.  This sub-file
"^DD",2006.575,2006.575,26,21,2,0)
will point to all the related images having the same study instance UID.
"^DD",2006.575,2006.575,26,23,0)
^^5^5^3000216^
"^DD",2006.575,2006.575,26,23,1,0)
This field creates a cross reference that is used by the DICOM Image
"^DD",2006.575,2006.575,26,23,2,0)
gateway to process all images pertaining to one unique study instance UID.
"^DD",2006.575,2006.575,26,23,3,0)
 This field also allow the manual correction routines to only
"^DD",2006.575,2006.575,26,23,4,0)
prompt/display a single entry needing corrections and will apply the
"^DD",2006.575,2006.575,26,23,5,0)
corrections made to all entries in this sub-file.
"^DD",2006.575,2006.575,27,0)
MODALITY^F^^AMFG;6^K:$L(X)>30!($L(X)<1) X
"^DD",2006.575,2006.575,27,.1)
Modality
"^DD",2006.575,2006.575,27,3)
Enter the name of the modality (instrument type).
"^DD",2006.575,2006.575,27,21,0)
^^5^5^3000306^^
"^DD",2006.575,2006.575,27,21,1,0)
The value of this field is a string that represents
"^DD",2006.575,2006.575,27,21,2,0)
the name of a modality.
"^DD",2006.575,2006.575,27,21,3,0)
 
"^DD",2006.575,2006.575,27,21,4,0)
This value represents the name of the modality
"^DD",2006.575,2006.575,27,21,5,0)
(i.e., the type of of instrument) for the images requiring manual correction.
"^DD",2006.575,2006.575,27,"DT")
2970305
"^DD",2006.575,2006.575,28,0)
MACHINE ID^F^^1;4^K:$L(X)>10!($L(X)<1) X
"^DD",2006.575,2006.575,28,.1)
Machine ID
"^DD",2006.575,2006.575,28,3)
Identify the Image Gateway that received the image file.
"^DD",2006.575,2006.575,28,21,0)
^^5^5^3000306^^
"^DD",2006.575,2006.575,28,21,1,0)
The value of this field is a code that identifies
"^DD",2006.575,2006.575,28,21,2,0)
the VistA DICOM Image Gateway computer that received
"^DD",2006.575,2006.575,28,21,3,0)
the image file.
"^DD",2006.575,2006.575,28,21,4,0)
 
"^DD",2006.575,2006.575,28,21,5,0)
Such a code is a single alphabetic letter.
"^DD",2006.575,2006.575,28,"DT")
3041216
"^DD",2006.575,2006.575,29,0)
COMMENT^F^^ACSTXT;1^K:$L(X)>250!($L(X)<2) X
"^DD",2006.575,2006.575,29,.1)
Comment
"^DD",2006.575,2006.575,29,3)
Enter a comment.
"^DD",2006.575,2006.575,29,21,0)
^^7^7^3000306^^
"^DD",2006.575,2006.575,29,21,1,0)
The value of this field is a string that represents
"^DD",2006.575,2006.575,29,21,2,0)
a comment.
"^DD",2006.575,2006.575,29,21,3,0)
 
"^DD",2006.575,2006.575,29,21,4,0)
This value is copied from the information that was
"^DD",2006.575,2006.575,29,21,5,0)
transmitted by the Radiology equipment.
"^DD",2006.575,2006.575,29,21,6,0)
 
"^DD",2006.575,2006.575,29,21,7,0)
Typically, this value contains the accession number.
"^DD",2006.575,2006.575,29,"DT")
2970521
"^DD",2006.575,2006.575,30,0)
IMAGE POINTER^NJ11,0^^FIXPR;3^K:+X'=X!(X>99999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.575,2006.575,30,.1)
Image Pointer
"^DD",2006.575,2006.575,30,3)
Identify the image.
"^DD",2006.575,2006.575,30,21,0)
^^6^6^3000306^^
"^DD",2006.575,2006.575,30,21,1,0)
The value of this field is a pointer to the Image
"^DD",2006.575,2006.575,30,21,2,0)
file (#2005, stored in ^MAG(2005,...).
"^DD",2006.575,2006.575,30,21,3,0)
 
"^DD",2006.575,2006.575,30,21,4,0)
This value identifies the image that is the 'parent'
"^DD",2006.575,2006.575,30,21,5,0)
of the group to which the image that is described in
"^DD",2006.575,2006.575,30,21,6,0)
this entry belongs.
"^DD",2006.575,2006.575,30,"DT")
2980501
"^DD",2006.575,2006.575,31,0)
PARENT FILE^NJ10,0^^FIXPR;4^K:+X'=X!(X>9999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.575,2006.575,31,.1)
Parent File
"^DD",2006.575,2006.575,31,3)
Identity the parent file.
"^DD",2006.575,2006.575,31,21,0)
^^23^23^3000306^^
"^DD",2006.575,2006.575,31,21,1,0)
The value of this field is a pointer to the File of
"^DD",2006.575,2006.575,31,21,2,0)
Files (#1, stored in ^DIC(...).
"^DD",2006.575,2006.575,31,21,3,0)
 
"^DD",2006.575,2006.575,31,21,4,0)
This value identifies the Imaging Parent file that
"^DD",2006.575,2006.575,31,21,5,0)
contains the clinical information of which the image
"^DD",2006.575,2006.575,31,21,6,0)
file that is described in this entry is a part.
"^DD",2006.575,2006.575,31,21,7,0)
 
"^DD",2006.575,2006.575,31,21,8,0)
Possible parent files are:
"^DD",2006.575,2006.575,31,21,9,0)
    3.9    MAIL MESSAGE
"^DD",2006.575,2006.575,31,21,10,0)
   63      AUTOPSY (MICROSCOPIC)
"^DD",2006.575,2006.575,31,21,11,0)
   63.02   ELECTRON MICROSCOPY
"^DD",2006.575,2006.575,31,21,12,0)
   63.08   SURGICAL PATHOLOGY
"^DD",2006.575,2006.575,31,21,13,0)
   63.09   CYTOLOGY
"^DD",2006.575,2006.575,31,21,14,0)
   63.2    AUTOPSY (GROSS)
"^DD",2006.575,2006.575,31,21,15,0)
   74      RADIOLOGY
"^DD",2006.575,2006.575,31,21,16,0)
  130      SURGERY
"^DD",2006.575,2006.575,31,21,17,0)
  691      ECHOCARDIOGRAM
"^DD",2006.575,2006.575,31,21,18,0)
  691.1    CARDIAC CATHETERIZATION
"^DD",2006.575,2006.575,31,21,19,0)
  691.5    ELECTROCARDIOGRAPHY
"^DD",2006.575,2006.575,31,21,20,0)
  694      HEMATOLOGY
"^DD",2006.575,2006.575,31,21,21,0)
  699      ENDOSCOPY
"^DD",2006.575,2006.575,31,21,22,0)
  699.5    GENERIC MEDICINE
"^DD",2006.575,2006.575,31,21,23,0)
 8925      TIU
"^DD",2006.575,2006.575,31,"DT")
2980501
"^DD",2006.575,2006.575,32,0)
SERVICE TYPE^F^^TYPE;1^K:$L(X)>20!($L(X)<1) X
"^DD",2006.575,2006.575,32,.1)
Service Type
"^DD",2006.575,2006.575,32,3)
Enter the name of the imaging service.
"^DD",2006.575,2006.575,32,21,0)
^^9^9^3000306^^
"^DD",2006.575,2006.575,32,21,1,0)
The value of this field is a string that identifies
"^DD",2006.575,2006.575,32,21,2,0)
the 'imaging service' that is performed by the
"^DD",2006.575,2006.575,32,21,3,0)
instrument that is described in this entry.
"^DD",2006.575,2006.575,32,21,4,0)
 
"^DD",2006.575,2006.575,32,21,5,0)
The imaging services are itemized in file 2006.589
"^DD",2006.575,2006.575,32,21,6,0)
(stored in ^MAGDICOM(2006.589,...)
"^DD",2006.575,2006.575,32,21,7,0)
 
"^DD",2006.575,2006.575,32,21,8,0)
Currently, the only entries in this file are RAD
"^DD",2006.575,2006.575,32,21,9,0)
and MED-ENDO.
"^DD",2006.575,2006.575,32,"DT")
3041216
"^DD",2006.575,2006.575,33,0)
DELETE FLAG^S^1:FILE IS DELETED;^0;6^Q
"^DD",2006.575,2006.575,33,.1)
Delete Flag
"^DD",2006.575,2006.575,33,3)
Indicate whether or not this file is to be deleted.
"^DD",2006.575,2006.575,33,21,0)
^^12^12^3000306^^
"^DD",2006.575,2006.575,33,21,1,0)
The value of this field is a code that indicates
"^DD",2006.575,2006.575,33,21,2,0)
whether of not the image file that is described
"^DD",2006.575,2006.575,33,21,3,0)
in this entry is to be deleted.
"^DD",2006.575,2006.575,33,21,4,0)
 
"^DD",2006.575,2006.575,33,21,5,0)
Corrections are made using either of
"^DD",2006.575,2006.575,33,21,6,0)
the menu options
"^DD",2006.575,2006.575,33,21,7,0)
 MAGD FIX DICOM or
"^DD",2006.575,2006.575,33,21,8,0)
 MAGD FIX MEDICINE
"^DD",2006.575,2006.575,33,21,9,0)
 
"^DD",2006.575,2006.575,33,21,10,0)
If the images files are for a test patient, then
"^DD",2006.575,2006.575,33,21,11,0)
setting this field will not process the images but delete the files from
"^DD",2006.575,2006.575,33,21,12,0)
the DICOM Image gateway. 
"^DD",2006.575,2006.575,33,23,0)
^^2^2^3000216^^
"^DD",2006.575,2006.575,33,23,1,0)
If this field is present, the software on the DICOM Image gateway will
"^DD",2006.575,2006.575,33,23,2,0)
not process this image file but will delete it from the IMAGE_IN directory.
"^DD",2006.575,2006.575,33,"DT")
3000216
"^DD",2006.575,2006.575,34,0)
MANUFACTURER^F^^AMFG;7^K:$L(X)>20!($L(X)<1) X
"^DD",2006.575,2006.575,34,.1)
Manufacturer
"^DD",2006.575,2006.575,34,3)
Enter the name of the manufacturer of the modality
"^DD",2006.575,2006.575,34,21,0)
^^3^3^3000306^^
"^DD",2006.575,2006.575,34,21,1,0)
The value of this field is a string that identifies
"^DD",2006.575,2006.575,34,21,2,0)
the manufacturer of the instrument that transmitted
"^DD",2006.575,2006.575,34,21,3,0)
the images that require manual correction.
"^DD",2006.575,2006.575,34,"DT")
2991210
"^DD",2006.575,2006.575,35,0)
MODEL^F^^AMFG;8^K:$L(X)>10!($L(X)<1) X
"^DD",2006.575,2006.575,35,.1)
Model
"^DD",2006.575,2006.575,35,3)
Enter the name of the model of the modality.
"^DD",2006.575,2006.575,35,21,0)
^^3^3^3000306^^
"^DD",2006.575,2006.575,35,21,1,0)
The value of this field is a string that identifies
"^DD",2006.575,2006.575,35,21,2,0)
the model of the instrument that transmitted
"^DD",2006.575,2006.575,35,21,3,0)
the images that require manual correction.
"^DD",2006.575,2006.575,35,"DT")
2991210
"^DD",2006.575,2006.575,36,0)
GATEWAY LOCATION^P4'^DIC(4,^1;5^Q
"^DD",2006.575,2006.575,36,3)
Identify the institution where the gateway is located.
"^DD",2006.575,2006.575,36,21,0)
^.001^1^1^3041216^^^
"^DD",2006.575,2006.575,36,21,1,0)
This field will contain the institution where the gateway is located.
"^DD",2006.575,2006.575,36,"DT")
3041216
"^DD",2006.575,2006.575,37,0)
Instrument Site^F^^AMFG;9^K:$L(X)>30!($L(X)<1) X
"^DD",2006.575,2006.575,37,3)
Answer must be 1-30 characters in length.
"^DD",2006.575,2006.575,37,21,0)
^^1^1^3010319^
"^DD",2006.575,2006.575,37,21,1,0)
This field will contain the institution where the instrument is located.
"^DD",2006.575,2006.575,37,"DT")
3010319
"^DD",2006.575,2006.57526,0)
RELATED IMAGES SUB-FIELD^^.01^1
"^DD",2006.575,2006.57526,0,"DT")
2970226
"^DD",2006.575,2006.57526,0,"IX","B",2006.57526,.01)

"^DD",2006.575,2006.57526,0,"NM","RELATED IMAGES")

"^DD",2006.575,2006.57526,0,"UP")
2006.575
"^DD",2006.575,2006.57526,.01,0)
RELATED IMAGES^P2006.575'^MAGD(2006.575,^0;1^Q
"^DD",2006.575,2006.57526,.01,.1)
Related Image
"^DD",2006.575,2006.57526,.01,1,0)
^.1
"^DD",2006.575,2006.57526,.01,1,1,0)
2006.57526^B
"^DD",2006.575,2006.57526,.01,1,1,1)
S ^MAGD(2006.575,DA(1),"RLATE","B",$E(X,1,30),DA)=""
"^DD",2006.575,2006.57526,.01,1,1,2)
K ^MAGD(2006.575,DA(1),"RLATE","B",$E(X,1,30),DA)
"^DD",2006.575,2006.57526,.01,3)

"^DD",2006.575,2006.57526,.01,21,0)
^^7^7^3000306^^
"^DD",2006.575,2006.57526,.01,21,1,0)
The value of this field is a pointer to the Image
"^DD",2006.575,2006.57526,.01,21,2,0)
file (#2005, stored in ^MAG(2005,...).
"^DD",2006.575,2006.57526,.01,21,3,0)
 
"^DD",2006.575,2006.57526,.01,21,4,0)
The entries in this subfile constitute the list of
"^DD",2006.575,2006.57526,.01,21,5,0)
all images which have the same unique study UID.
"^DD",2006.575,2006.57526,.01,21,6,0)
The first entry made into this subfile will be the parent entry. The next images with
"^DD",2006.575,2006.57526,.01,21,7,0)
the same Study UID will be entered as additional entries in this subfile.
"^DD",2006.575,2006.57526,.01,"DT")
2970226
"^DD",2006.5821,2006.5821,0)
FIELD^^5^5
"^DD",2006.5821,2006.5821,0,"DT")
3071003
"^DD",2006.5821,2006.5821,0,"IX","B",2006.5821,.01)

"^DD",2006.5821,2006.5821,0,"NM","CT CONVERSION PARAMETERS")

"^DD",2006.5821,2006.5821,.01,0)
LOCATION^RP4'^DIC(4,^0;1^Q
"^DD",2006.5821,2006.5821,.01,1,0)
^.1
"^DD",2006.5821,2006.5821,.01,1,1,0)
2006.5821^B
"^DD",2006.5821,2006.5821,.01,1,1,1)
S ^MAGDICOM(2006.5821,"B",$E(X,1,30),DA)=""
"^DD",2006.5821,2006.5821,.01,1,1,2)
K ^MAGDICOM(2006.5821,"B",$E(X,1,30),DA)
"^DD",2006.5821,2006.5821,.01,3)
Identify the site for these CT conversion parameters.
"^DD",2006.5821,2006.5821,.01,21,0)
^^2^2^3071003^
"^DD",2006.5821,2006.5821,.01,21,1,0)
The value of this field is a pointer to the Institution table (#4).
"^DD",2006.5821,2006.5821,.01,21,2,0)
This pointer identifies the site to which the current record applies.
"^DD",2006.5821,2006.5821,.01,"DT")
3071003
"^DD",2006.5821,2006.5821,2,0)
MANUFACTURER^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",2006.5821,2006.5821,2,3)
Identify the manufacturer of this CT scanner.
"^DD",2006.5821,2006.5821,2,21,0)
^^3^3^3071003^
"^DD",2006.5821,2006.5821,2,21,1,0)
The value of this field is a string. This string is the name of the
"^DD",2006.5821,2006.5821,2,21,2,0)
manufacturer of the CT scanner for which parameters are described
"^DD",2006.5821,2006.5821,2,21,3,0)
in this record.
"^DD",2006.5821,2006.5821,2,"DT")
3071003
"^DD",2006.5821,2006.5821,3,0)
MODEL^F^^0;3^K:$L(X)>30!($L(X)<1) X
"^DD",2006.5821,2006.5821,3,3)
Identify the model name for this CT scanner.
"^DD",2006.5821,2006.5821,3,21,0)
^^3^3^3071003^
"^DD",2006.5821,2006.5821,3,21,1,0)
The value of this field is a string.
"^DD",2006.5821,2006.5821,3,21,2,0)
This string identifies the model name of the CT scanner
"^DD",2006.5821,2006.5821,3,21,3,0)
for which the conversion parameters are described in this record.
"^DD",2006.5821,2006.5821,3,"DT")
3071003
"^DD",2006.5821,2006.5821,4,0)
DATE^D^^0;4^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",2006.5821,2006.5821,4,3)
Specify the date on which these parameters were established.
"^DD",2006.5821,2006.5821,4,21,0)
^^3^3^3071003^
"^DD",2006.5821,2006.5821,4,21,1,0)
The value of this field is a FileMan date (date only, no time).
"^DD",2006.5821,2006.5821,4,21,2,0)
This date identifies the day on which the conversion parameters
"^DD",2006.5821,2006.5821,4,21,3,0)
were established that are described in this record.
"^DD",2006.5821,2006.5821,4,"DT")
3071003
"^DD",2006.5821,2006.5821,5,0)
CONVERSION PARAMETERS^F^^0;5^K:$L(X)>100!($L(X)<1) X
"^DD",2006.5821,2006.5821,5,3)
Enter the parameters that were applied for this CT scanner.
"^DD",2006.5821,2006.5821,5,21,0)
^^4^4^3071003^
"^DD",2006.5821,2006.5821,5,21,1,0)
The value of this field is a string.
"^DD",2006.5821,2006.5821,5,21,2,0)
This string represents the conversion parameters (DICOM to Targa
"^DD",2006.5821,2006.5821,5,21,3,0)
conversion) that were applied for the CT scanner on the date specified
"^DD",2006.5821,2006.5821,5,21,4,0)
elsewhere in this record.
"^DD",2006.5821,2006.5821,5,"DT")
3071003
"^DD",2006.5849,2006.5849,0)
FIELD^^18^19
"^DD",2006.5849,2006.5849,0,"DDA")
N
"^DD",2006.5849,2006.5849,0,"DT")
3060921
"^DD",2006.5849,2006.5849,0,"IX","B",2006.5849,.01)

"^DD",2006.5849,2006.5849,0,"IX","C",2006.5849,1)

"^DD",2006.5849,2006.5849,0,"NM","TELEREADER READ/UNREAD LIST")

"^DD",2006.5849,2006.5849,.01,0)
CONSULT REQUEST^RP123'^GMR(123,^0;1^Q
"^DD",2006.5849,2006.5849,.01,1,0)
^.1
"^DD",2006.5849,2006.5849,.01,1,1,0)
2006.5849^B
"^DD",2006.5849,2006.5849,.01,1,1,1)
S ^MAG(2006.5849,"B",$E(X,1,30),DA)=""
"^DD",2006.5849,2006.5849,.01,1,1,2)
K ^MAG(2006.5849,"B",$E(X,1,30),DA)
"^DD",2006.5849,2006.5849,.01,3)

"^DD",2006.5849,2006.5849,.01,21,0)
^^1^1^3060509^
"^DD",2006.5849,2006.5849,.01,21,1,0)
The date and time the consult was requested.
"^DD",2006.5849,2006.5849,.01,"DT")
3060509
"^DD",2006.5849,2006.5849,1,0)
ACQUISITION DIVISION NUMBER^P4'^DIC(4,^0;2^Q
"^DD",2006.5849,2006.5849,1,1,0)
^.1
"^DD",2006.5849,2006.5849,1,1,1,0)
2006.5849^C
"^DD",2006.5849,2006.5849,1,1,1,1)
S ^MAG(2006.5849,"C",$E(X,1,30),DA)=""
"^DD",2006.5849,2006.5849,1,1,1,2)
K ^MAG(2006.5849,"C",$E(X,1,30),DA)
"^DD",2006.5849,2006.5849,1,1,1,"DT")
3060421
"^DD",2006.5849,2006.5849,1,21,0)
^^1^1^3060509^
"^DD",2006.5849,2006.5849,1,21,1,0)
The site where the images are acquired.
"^DD",2006.5849,2006.5849,1,"DT")
3060509
"^DD",2006.5849,2006.5849,2,0)
IMAGE INDEX FOR SPECIALTY^P2005.84'^MAG(2005.84,^0;3^Q
"^DD",2006.5849,2006.5849,2,21,0)
^^1^1^3060509^
"^DD",2006.5849,2006.5849,2,21,1,0)
The specific specialty as requested by the acquisition site.
"^DD",2006.5849,2006.5849,2,"DT")
3060509
"^DD",2006.5849,2006.5849,3,0)
IMAGE INDEX FOR PROCEDURE^P2005.85'^MAG(2005.85,^0;4^Q
"^DD",2006.5849,2006.5849,3,21,0)
^^1^1^3060503^
"^DD",2006.5849,2006.5849,3,21,1,0)
The procedure performed by the acquisition site.
"^DD",2006.5849,2006.5849,3,"DT")
3060117
"^DD",2006.5849,2006.5849,4,0)
CONSULT ORDERED/FORWARDED^D^^0;5^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",2006.5849,2006.5849,4,21,0)
^^2^2^3060503^
"^DD",2006.5849,2006.5849,4,21,1,0)
The Date/Time that the consult was ordered or forwarded to the remote
"^DD",2006.5849,2006.5849,4,21,2,0)
site.
"^DD",2006.5849,2006.5849,4,"DT")
3051212
"^DD",2006.5849,2006.5849,5,0)
REMOTE SITE RESPONSE^D^^0;6^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",2006.5849,2006.5849,5,3)

"^DD",2006.5849,2006.5849,5,21,0)
^^2^2^3060503^
"^DD",2006.5849,2006.5849,5,21,1,0)
The Date/Time that the remote site responds to the IFC request by creating
"^DD",2006.5849,2006.5849,5,21,2,0)
a remote consult.
"^DD",2006.5849,2006.5849,5,"DT")
3051212
"^DD",2006.5849,2006.5849,6,0)
ACQUISITION START^D^^0;7^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",2006.5849,2006.5849,6,3)

"^DD",2006.5849,2006.5849,6,21,0)
^^1^1^3060503^
"^DD",2006.5849,2006.5849,6,21,1,0)
The start date and time of the acquisition of images.
"^DD",2006.5849,2006.5849,6,"DT")
3051212
"^DD",2006.5849,2006.5849,7,0)
NEXT ACQUISITION^D^^0;8^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",2006.5849,2006.5849,7,3)

"^DD",2006.5849,2006.5849,7,21,0)
^^1^1^3060503^
"^DD",2006.5849,2006.5849,7,21,1,0)
The date and time of the acquisition of additional images.
"^DD",2006.5849,2006.5849,7,"DT")
3051212
"^DD",2006.5849,2006.5849,8,0)
LAST ACTIVITY^D^^0;9^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",2006.5849,2006.5849,8,3)

"^DD",2006.5849,2006.5849,8,21,0)
^^1^1^3060503^
"^DD",2006.5849,2006.5849,8,21,1,0)
The date and time of the last activity.
"^DD",2006.5849,2006.5849,8,"DT")
3051212
"^DD",2006.5849,2006.5849,9,0)
NUMBER OF IMAGES^NJ5,0^^0;10^K:+X'=X!(X>99999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.5849,2006.5849,9,3)
Type a Number between 0 and 99999, 0 Decimal Digits
"^DD",2006.5849,2006.5849,9,21,0)
^^1^1^3060503^
"^DD",2006.5849,2006.5849,9,21,1,0)
The number of images acquired.
"^DD",2006.5849,2006.5849,9,"DT")
3051212
"^DD",2006.5849,2006.5849,10,0)
STATUS^S^C:Cancelled;W:Waiting;R:Read;L:Locked;U:Unread;D:Deleted;^0;11^Q
"^DD",2006.5849,2006.5849,10,1,0)
^.1^^0
"^DD",2006.5849,2006.5849,10,21,0)
^^1^1^3060509^
"^DD",2006.5849,2006.5849,10,21,1,0)
The status of the exam; read, unread, etc., in the TeleReader program.
"^DD",2006.5849,2006.5849,10,"DT")
3060509
"^DD",2006.5849,2006.5849,11,0)
FULL NAME OF READER^F^^0;12^K:$L(X)>35!($L(X)<1) X
"^DD",2006.5849,2006.5849,11,3)
Answer must be 1-35 characters in length.
"^DD",2006.5849,2006.5849,11,21,0)
^^1^1^3060509^
"^DD",2006.5849,2006.5849,11,21,1,0)
The name of the person who will be reading the exam.
"^DD",2006.5849,2006.5849,11,"DT")
3060509
"^DD",2006.5849,2006.5849,12,0)
READER'S INITIALS^F^^0;13^K:$L(X)>5!($L(X)<1) X
"^DD",2006.5849,2006.5849,12,3)
Answer must be 1-5 characters in length.
"^DD",2006.5849,2006.5849,12,21,0)
^^1^1^3060503^
"^DD",2006.5849,2006.5849,12,21,1,0)
The initials of the person responsible for reading the exam.
"^DD",2006.5849,2006.5849,12,"DT")
3051212
"^DD",2006.5849,2006.5849,13,0)
READER DUZ AT ACQUISITION SITE^P200'^VA(200,^0;14^Q
"^DD",2006.5849,2006.5849,13,3)

"^DD",2006.5849,2006.5849,13,21,0)
^^1^1^3060503^
"^DD",2006.5849,2006.5849,13,21,1,0)
The Reader's DUZ at the Acquisition Site.
"^DD",2006.5849,2006.5849,13,"DT")
3060203
"^DD",2006.5849,2006.5849,14,0)
READER DUZ AT READING SITE^NJ10,0^^0;15^K:+X'=X!(X>9999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",2006.5849,2006.5849,14,3)
Type a Number between 1 and 9999999999, 0 Decimal Digits
"^DD",2006.5849,2006.5849,14,21,0)
^^1^1^3060509^
"^DD",2006.5849,2006.5849,14,21,1,0)
The DUZ of the person reading the exam at the Reader's Site.
"^DD",2006.5849,2006.5849,14,"DT")
3060509
"^DD",2006.5849,2006.5849,15,0)
READER SITE^P4'^DIC(4,^0;16^Q
"^DD",2006.5849,2006.5849,15,3)

"^DD",2006.5849,2006.5849,15,21,0)
^^1^1^3060503^
"^DD",2006.5849,2006.5849,15,21,1,0)
The division where the reader is located.
"^DD",2006.5849,2006.5849,15,"DT")
3060203
"^DD",2006.5849,2006.5849,16,0)
READING START^D^^0;17^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",2006.5849,2006.5849,16,3)

"^DD",2006.5849,2006.5849,16,21,0)
^^1^1^3060503^
"^DD",2006.5849,2006.5849,16,21,1,0)
The date and time when the exam is selected to be read.
"^DD",2006.5849,2006.5849,16,"DT")
3060203
"^DD",2006.5849,2006.5849,17,0)
READING STOP^D^^0;18^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",2006.5849,2006.5849,17,1,0)
^.1^^0
"^DD",2006.5849,2006.5849,17,21,0)
^^1^1^3060503^
"^DD",2006.5849,2006.5849,17,21,1,0)
The date and time when the reader completes the reading of the exam.
"^DD",2006.5849,2006.5849,17,"DT")
3060421
"^DD",2006.5849,2006.5849,18,0)
REPAIR DATE/TIME^D^^0;19^S %DT="ET" D ^%DT S X=Y K:Y<1 X
"^DD",2006.5849,2006.5849,18,3)
DATE AND TIME OF REPAIRING ENTRY
"^DD",2006.5849,2006.5849,18,"DT")
3060921
"^DD",2006.587,2006.587,0)
FIELD^^9^9
"^DD",2006.587,2006.587,0,"DT")
3051115
"^DD",2006.587,2006.587,0,"IX","B",2006.587,.01)

"^DD",2006.587,2006.587,0,"NM","DICOM TRANSMIT DESTINATION")

"^DD",2006.587,2006.587,0,"PT",2005.0111,3)

"^DD",2006.587,2006.587,0,"PT",2005.1111,3)

"^DD",2006.587,2006.587,0,"PT",2006.035,1)

"^DD",2006.587,2006.587,.01,0)
SERVICE NAME^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",2006.587,2006.587,.01,1,0)
^.1
"^DD",2006.587,2006.587,.01,1,1,0)
2006.587^B
"^DD",2006.587,2006.587,.01,1,1,1)
S ^MAG(2006.587,"B",$E(X,1,30),DA)=""
"^DD",2006.587,2006.587,.01,1,1,2)
K ^MAG(2006.587,"B",$E(X,1,30),DA)
"^DD",2006.587,2006.587,.01,3)
Enter the name of the Service Class Provider.
"^DD",2006.587,2006.587,.01,21,0)
^^2^2^3030514^^
"^DD",2006.587,2006.587,.01,21,1,0)
The value of this field is a string that specifies the name of the
"^DD",2006.587,2006.587,.01,21,2,0)
service that is called for the application described in the current entry.
"^DD",2006.587,2006.587,.01,"DT")
3050609
"^DD",2006.587,2006.587,2,0)
SERVICE PROVIDER AE^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",2006.587,2006.587,2,3)
Enter the Application Entity Title of the Service Class Provider.
"^DD",2006.587,2006.587,2,21,0)
^^3^3^3030514^^
"^DD",2006.587,2006.587,2,21,1,0)
The value of this field is a string that specifies the Application
"^DD",2006.587,2006.587,2,21,2,0)
Entity Title for the equipment being called for the application that
"^DD",2006.587,2006.587,2,21,3,0)
is described in the current entry.
"^DD",2006.587,2006.587,2,"DT")
3030514
"^DD",2006.587,2006.587,3,0)
IP ADDRESS^F^^0;3^K:$L(X)>30!($L(X)<1) X
"^DD",2006.587,2006.587,3,3)
Enter the TCP/IP address of the Service Class Provider.
"^DD",2006.587,2006.587,3,21,0)
^^2^2^3030514^^
"^DD",2006.587,2006.587,3,21,1,0)
The value of this field is a string that specifies the TCP/IP address
"^DD",2006.587,2006.587,3,21,2,0)
of the called application entity.
"^DD",2006.587,2006.587,3,"DT")
3030514
"^DD",2006.587,2006.587,4,0)
PORT NUMBER^NJ5,0^^0;4^K:+X'=X!(X>65535)!(X<1)!(X?.E1"."1N.N) X
"^DD",2006.587,2006.587,4,3)
Enter the port number for the Service Class Provider.
"^DD",2006.587,2006.587,4,21,0)
^^3^3^3030514^^
"^DD",2006.587,2006.587,4,21,1,0)
The value of this field is an integer number that identifies the TCP/IP
"^DD",2006.587,2006.587,4,21,2,0)
port number to which the equipment connects calls the application that
"^DD",2006.587,2006.587,4,21,3,0)
is described in this entry. 
"^DD",2006.587,2006.587,4,"DT")
3030514
"^DD",2006.587,2006.587,5,0)
GATEWAY SYSTEM TITLE^F^^0;5^K:$L(X)>30!($L(X)<1) X
"^DD",2006.587,2006.587,5,3)
Enter the system title of the DICOM Gateway.
"^DD",2006.587,2006.587,5,21,0)
^^5^5^3030514^^
"^DD",2006.587,2006.587,5,21,1,0)
The value of this field is a text that identifies the computer that
"^DD",2006.587,2006.587,5,21,2,0)
communicates with this service class provider.
"^DD",2006.587,2006.587,5,21,3,0)
 
"^DD",2006.587,2006.587,5,21,4,0)
Note that each VistA DICOM Gateway computer has its own copy of ^MAGDICOM,
"^DD",2006.587,2006.587,5,21,5,0)
in which its station-parameters are stored.
"^DD",2006.587,2006.587,5,"DT")
3050609
"^DD",2006.587,2006.587,6,0)
GATEWAY AE^F^^0;6^K:$L(X)>30!($L(X)<1) X
"^DD",2006.587,2006.587,6,3)
Enter the Application Entity Title of the DICOM Gateway
"^DD",2006.587,2006.587,6,21,0)
^^3^3^3030514^^
"^DD",2006.587,2006.587,6,21,1,0)
The value of this field is a string that specifies the Application
"^DD",2006.587,2006.587,6,21,2,0)
Entity Title for the VistA DICOM Gatewat from which the application is called
"^DD",2006.587,2006.587,6,21,3,0)
that is described in the current entry.
"^DD",2006.587,2006.587,6,"DT")
3030514
"^DD",2006.587,2006.587,7,0)
GATEWAY LOCATION^RP4'^DIC(4,^0;7^Q
"^DD",2006.587,2006.587,7,3)
Identify the clinic where the DICOM Gateway is located.
"^DD",2006.587,2006.587,7,21,0)
^^2^2^3030514^^
"^DD",2006.587,2006.587,7,21,1,0)
The value of this field is a pointer to the Institution file (#4).
"^DD",2006.587,2006.587,7,21,2,0)
This value identifies the institution where this DICOM Gateway computer resides.
"^DD",2006.587,2006.587,7,"DT")
3050609
"^DD",2006.587,2006.587,8,0)
TIMESTAMP^RD^^0;8^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",2006.587,2006.587,8,3)
Enter the date and time of this update.
"^DD",2006.587,2006.587,8,"DT")
3030514
"^DD",2006.587,2006.587,9,0)
SERVICE TYPE^2006.5871SA^^1;0
"^DD",2006.587,2006.5871,0)
SERVICE TYPE SUB-FIELD^^2^3
"^DD",2006.587,2006.5871,0,"DT")
3051115
"^DD",2006.587,2006.5871,0,"IX","B",2006.5871,.01)

"^DD",2006.587,2006.5871,0,"NM","SERVICE TYPE")

"^DD",2006.587,2006.5871,0,"UP")
2006.587
"^DD",2006.587,2006.5871,.01,0)
SERVICE TYPE^MS^C-STORE:C-Store;C-GET:C-Get;C-MOVE:C-Move;C-FIND:C-Find;C-ECHO:C-Echo;N-EVENT-REPORT:N-Event-Report;N-GET:N-Get;N-SET:N-Set;N-ACTION:N-Action;N-CREATE:N-Create;N-DELETE:N-Delete;^0;1^Q
"^DD",2006.587,2006.5871,.01,1,0)
^.1
"^DD",2006.587,2006.5871,.01,1,1,0)
2006.5871^B
"^DD",2006.587,2006.5871,.01,1,1,1)
S ^MAG(2006.587,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",2006.587,2006.5871,.01,1,1,2)
K ^MAG(2006.587,DA(1),1,"B",$E(X,1,30),DA)
"^DD",2006.587,2006.5871,.01,3)
Enter the name of a DICOM DIMSE Service.
"^DD",2006.587,2006.5871,.01,21,0)
^^10^10^3051115^
"^DD",2006.587,2006.5871,.01,21,1,0)
The value of this field is a code that identifies a DICOM DIMSE Service.
"^DD",2006.587,2006.5871,.01,21,2,0)
The complete list of DIMSE Services is defined in the DICOM Standard.
"^DD",2006.587,2006.5871,.01,21,3,0)
 
"^DD",2006.587,2006.5871,.01,21,4,0)
The Application Entity that is defined in the current record
"^DD",2006.587,2006.5871,.01,21,5,0)
is permitted to perform only those services that are itemized
"^DD",2006.587,2006.5871,.01,21,6,0)
in this multiple-valued field.
"^DD",2006.587,2006.5871,.01,21,7,0)
 
"^DD",2006.587,2006.5871,.01,21,8,0)
Note: if there are no values in this multiple-valued field, the
"^DD",2006.587,2006.5871,.01,21,9,0)
current Application Entity is not allowed to perform any DICOM
"^DD",2006.587,2006.5871,.01,21,10,0)
DIMSE Services.
"^DD",2006.587,2006.5871,.01,"DT")
3051115
"^DD",2006.587,2006.5871,1,0)
SCU^S^0:No;1:Yes;^0;2^Q
"^DD",2006.587,2006.5871,1,3)
Indicate whether this service may be performed as an SCU.
"^DD",2006.587,2006.5871,1,21,0)
^.001^4^4^3051115^^^^
"^DD",2006.587,2006.5871,1,21,1,0)
The value of this field is a code that indicates whether
"^DD",2006.587,2006.5871,1,21,2,0)
or not the service described in this record may be performed
"^DD",2006.587,2006.5871,1,21,3,0)
in such a way that the Application Entity from the main record
"^DD",2006.587,2006.5871,1,21,4,0)
is an SCU (Service Class User).
"^DD",2006.587,2006.5871,1,"DT")
3051115
"^DD",2006.587,2006.5871,2,0)
SCP^S^0:No;1:Yes;^0;3^Q
"^DD",2006.587,2006.5871,2,3)
Indicate whether this service may be performed as an SCP.
"^DD",2006.587,2006.5871,2,21,0)
^^4^4^3051115^
"^DD",2006.587,2006.5871,2,21,1,0)
The value of this field is a code that indicates whether
"^DD",2006.587,2006.5871,2,21,2,0)
or not the service described in this record may be performed
"^DD",2006.587,2006.5871,2,21,3,0)
in such a way that the Application Entity from the main record
"^DD",2006.587,2006.5871,2,21,4,0)
is an SCP (Service Class Provider).
"^DD",2006.587,2006.5871,2,"DT")
3051115
"^DD",2006.87,2006.87,0)
FIELD^^1001^25
"^DD",2006.87,2006.87,0,"DDA")
N
"^DD",2006.87,2006.87,0,"DT")
3060216
"^DD",2006.87,2006.87,0,"IX","B",2006.87,.01)

"^DD",2006.87,2006.87,0,"NM","DICOM GATEWAY INFORMATION")

"^DD",2006.87,2006.87,.01,0)
HOSTNAME^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",2006.87,2006.87,.01,1,0)
^.1
"^DD",2006.87,2006.87,.01,1,1,0)
2006.87^B
"^DD",2006.87,2006.87,.01,1,1,1)
S ^MAG(2006.87,"B",$E(X,1,30),DA)=""
"^DD",2006.87,2006.87,.01,1,1,2)
K ^MAG(2006.87,"B",$E(X,1,30),DA)
"^DD",2006.87,2006.87,.01,3)
Enter the name of the computer.
"^DD",2006.87,2006.87,.01,21,0)
^^8^8^3060215^
"^DD",2006.87,2006.87,.01,21,1,0)
The value of this field is a string that represents the name
"^DD",2006.87,2006.87,.01,21,2,0)
of a computer.
"^DD",2006.87,2006.87,.01,21,3,0)
 
"^DD",2006.87,2006.87,.01,21,4,0)
Names of computers typically look like
"^DD",2006.87,2006.87,.01,21,5,0)
  xxx-yyyzzzzz
"^DD",2006.87,2006.87,.01,21,6,0)
where xxx is the three-letter abbreviation for the name of
"^DD",2006.87,2006.87,.01,21,7,0)
the institution, yyy is the abbreviation for the name of the
"^DD",2006.87,2006.87,.01,21,8,0)
department, and zzzzz is the identifier assigned to the computer.
"^DD",2006.87,2006.87,.01,"DT")
3060215
"^DD",2006.87,2006.87,3,0)
LOCATION^P4'^DIC(4,^0;3^Q
"^DD",2006.87,2006.87,3,3)
Enter the location of this DICOM Gateway.
"^DD",2006.87,2006.87,3,21,0)
^^3^3^3060215^
"^DD",2006.87,2006.87,3,21,1,0)
The value of this field is a pointer to the Institution File (#4).
"^DD",2006.87,2006.87,3,21,2,0)
This pointer identifies the location for which the DICOM Gateway
"^DD",2006.87,2006.87,3,21,3,0)
operates.
"^DD",2006.87,2006.87,3,"DT")
3060215
"^DD",2006.87,2006.87,11,0)
TIMESTAMP INSTRUMENT^D^^1;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",2006.87,2006.87,11,3)
Enter the date and time when this file was most recently modified.
"^DD",2006.87,2006.87,11,21,0)
^^4^4^3060215^
"^DD",2006.87,2006.87,11,21,1,0)
The value of this field is a timestamp (VA-FileMan format).
"^DD",2006.87,2006.87,11,21,2,0)
This timestamp identifies the date and time when the file
"^DD",2006.87,2006.87,11,21,3,0)
  x:\DICOM\Dict\Instrument.dic
"^DD",2006.87,2006.87,11,21,4,0)
was most recently updated.
"^DD",2006.87,2006.87,11,"DT")
3060215
"^DD",2006.87,2006.87,12,0)
FILENAME INSTRUMENT^F^^1;2^K:$L(X)>100!($L(X)<3) X
"^DD",2006.87,2006.87,12,3)
Enter the full path+file name for this file.
"^DD",2006.87,2006.87,12,21,0)
^^5^5^3060215^
"^DD",2006.87,2006.87,12,21,1,0)
The value if this field is a string that identifies the full
"^DD",2006.87,2006.87,12,21,2,0)
pathname (drive or disk-share + (sub)directories + file name)
"^DD",2006.87,2006.87,12,21,3,0)
of the text file that holds the instrument definitions.
"^DD",2006.87,2006.87,12,21,4,0)
Usually the name of this file looks like
"^DD",2006.87,2006.87,12,21,5,0)
   x:\DICOM\Dict\Instrument.dic
"^DD",2006.87,2006.87,12,"DT")
3060215
"^DD",2006.87,2006.87,21,0)
TIMESTAMP MODALITY^D^^2;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",2006.87,2006.87,21,3)
Enter the date and time when this file was most recently modified.
"^DD",2006.87,2006.87,21,21,0)
^^4^4^3060215^
"^DD",2006.87,2006.87,21,21,1,0)
The value of this field is a timestamp (VA-FileMan format).
"^DD",2006.87,2006.87,21,21,2,0)
This timestamp identifies the date and time when the file
"^DD",2006.87,2006.87,21,21,3,0)
  x:\DICOM\Dict\Modality.dic
"^DD",2006.87,2006.87,21,21,4,0)
was most recently updated.
"^DD",2006.87,2006.87,21,"DT")
3060215
"^DD",2006.87,2006.87,22,0)
FILENAME MODALITY^F^^2;2^K:$L(X)>100!($L(X)<1) X
"^DD",2006.87,2006.87,22,3)
Enter the full path+file name for this file.
"^DD",2006.87,2006.87,22,21,0)
^.001^5^5^3060215^^
"^DD",2006.87,2006.87,22,21,1,0)
The value if this field is a string that identifies the full
"^DD",2006.87,2006.87,22,21,2,0)
pathname (drive or disk-share + (sub)directories + file name)
"^DD",2006.87,2006.87,22,21,3,0)
of the text file that holds the definitions of the supported modalities.
"^DD",2006.87,2006.87,22,21,4,0)
Usually the name of this file looks like
"^DD",2006.87,2006.87,22,21,5,0)
  x:\DICOM\Dict\Modality.dic
"^DD",2006.87,2006.87,22,"DT")
3060215
"^DD",2006.87,2006.87,31,0)
TIMESTAMP PORTLIST^D^^3;1^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",2006.87,2006.87,31,3)
Enter the date and time when this file was most recently modified.
"^DD",2006.87,2006.87,31,21,0)
^^4^4^3060215^
"^DD",2006.87,2006.87,31,21,1,0)
The value of this field is a timestamp (VA-FileMan format).
"^DD",2006.87,2006.87,31,21,2,0)
This timestamp identifies the date and time when the file
"^DD",2006.87,2006.87,31,21,3,0)
  x:\DICOM\Dict\PortList.dic
"^DD",2006.87,2006.87,31,21,4,0)
was most recently updated.
"^DD",2006.87,2006.87,31,"DT")
3060215
"^DD",2006.87,2006.87,32,0)
FILENAME PORTLIST^F^^3;2^K:$L(X)>100!($L(X)<1) X
"^DD",2006.87,2006.87,32,3)
Enter the full path+file name for this file.
"^DD",2006.87,2006.87,32,21,0)
^.001^5^5^3060215^^
"^DD",2006.87,2006.87,32,21,1,0)
The value if this field is a string that identifies the full
"^DD",2006.87,2006.87,32,21,2,0)
pathname (drive or disk-share + (sub)directories + file name)
"^DD",2006.87,2006.87,32,21,3,0)
of the text file that holds the definitions of the TCP/IP ports.
"^DD",2006.87,2006.87,32,21,4,0)
Usually the name of this file looks like
"^DD",2006.87,2006.87,32,21,5,0)
  x:\DICOM\Dict\PortList.dic
"^DD",2006.87,2006.87,32,"DT")
3060215
"^DD",2006.87,2006.87,41,0)
TIMESTAMP SCU_LIST^D^^4;1^S %DT="ESTR" D ^%DT S X=Y K:Y<1 X
"^DD",2006.87,2006.87,41,3)
Enter the date and time when this file was most recently modified.
"^DD",2006.87,2006.87,41,21,0)
^^4^4^3060215^
"^DD",2006.87,2006.87,41,21,1,0)
The value of this field is a timestamp (VA-FileMan format).
"^DD",2006.87,2006.87,41,21,2,0)
This timestamp identifies the date and time when the file
"^DD",2006.87,2006.87,41,21,3,0)
  x:\DICOM\Dict\SCU_List.dic
"^DD",2006.87,2006.87,41,21,4,0)
was most recently updated.
"^DD",2006.87,2006.87,41,"DT")
3060215
"^DD",2006.87,2006.87,42,0)
FILENAME SCU_LIST^F^^4;2^K:$L(X)>100!($L(X)<1) X
"^DD",2006.87,2006.87,42,3)
Enter the full path+file name for this file.
"^DD",2006.87,2006.87,42,21,0)
^^5^5^3060215^
"^DD",2006.87,2006.87,42,21,1,0)
The value if this field is a string that identifies the full
"^DD",2006.87,2006.87,42,21,2,0)
pathname (drive or disk-share + (sub)directories + file name)
"^DD",2006.87,2006.87,42,21,3,0)
of the text file that holds the SCU (Service Class User) definitions.
"^DD",2006.87,2006.87,42,21,4,0)
Usually the name of this file looks like
"^DD",2006.87,2006.87,42,21,5,0)
  x:\DICOM\Dict\SCU_List.dic
"^DD",2006.87,2006.87,42,"DT")
3060215
"^DD",2006.87,2006.87,51,0)
TIMESTAMP WORKLIST^D^^5;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",2006.87,2006.87,51,3)
Enter the date and time when this file was most recently modified.
"^DD",2006.87,2006.87,51,21,0)
^.001^4^4^3060215^^
"^DD",2006.87,2006.87,51,21,1,0)
The value of this field is a timestamp (VA-FileMan format).
"^DD",2006.87,2006.87,51,21,2,0)
This timestamp identifies the date and time when the file
"^DD",2006.87,2006.87,51,21,3,0)
  x:\DICOM\Dict\WorkList.dic
"^DD",2006.87,2006.87,51,21,4,0)
was most recently updated.
"^DD",2006.87,2006.87,51,"DT")
3060215
"^DD",2006.87,2006.87,52,0)
FILENAME WORKLIST^F^^5;2^K:$L(X)>100!($L(X)<1) X
"^DD",2006.87,2006.87,52,3)
Enter the full path+file name for this file.
"^DD",2006.87,2006.87,52,21,0)
^^5^5^3060215^
"^DD",2006.87,2006.87,52,21,1,0)
The value if this field is a string that identifies the full
"^DD",2006.87,2006.87,52,21,2,0)
pathname (drive or disk-share + (sub)directories + file name)
"^DD",2006.87,2006.87,52,21,3,0)
of the text file that holds the definitions for the Modality WorkList Applications.
"^DD",2006.87,2006.87,52,21,4,0)
Usually the name of this file looks like
"^DD",2006.87,2006.87,52,21,5,0)
  x:\DICOM\Dict\WorkList.dic
"^DD",2006.87,2006.87,52,"DT")
3060215
"^DD",2006.87,2006.87,61,0)
TIMESTAMP CT_PARAMS^D^^6;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",2006.87,2006.87,61,3)
Enter the date and time when this file was most recently modified.
"^DD",2006.87,2006.87,61,21,0)
^^4^4^3060215^
"^DD",2006.87,2006.87,61,21,1,0)
The value of this field is a timestamp (VA-FileMan format).
"^DD",2006.87,2006.87,61,21,2,0)
This timestamp identifies the date and time when the file
"^DD",2006.87,2006.87,61,21,3,0)
  x:\DICOM\Dict\CT_Params.dic
"^DD",2006.87,2006.87,61,21,4,0)
was most recently updated.
"^DD",2006.87,2006.87,61,"DT")
3060215
"^DD",2006.87,2006.87,62,0)
FILENAME CT_PARAMS^F^^6;2^K:$L(X)>100!($L(X)<1) X
"^DD",2006.87,2006.87,62,3)
Enter the full path+file name for this file.
"^DD",2006.87,2006.87,62,21,0)
^^6^6^3060215^
"^DD",2006.87,2006.87,62,21,1,0)
The value if this field is a string that identifies the full
"^DD",2006.87,2006.87,62,21,2,0)
pathname (drive or disk-share + (sub)directories + file name)
"^DD",2006.87,2006.87,62,21,3,0)
of the text file that holds the definitions for the conversion
"^DD",2006.87,2006.87,62,21,4,0)
of images from CT modalities.
"^DD",2006.87,2006.87,62,21,5,0)
Usually the name of this file looks like
"^DD",2006.87,2006.87,62,21,6,0)
  x:\DICOM\Dict\CT_Params.dic
"^DD",2006.87,2006.87,62,"DT")
3060215
"^DD",2006.87,2006.87,1001,0)
DICOM GATEWAY VERSION^F^^100;1^K:$L(X)>240!($L(X)<1) X
"^DD",2006.87,2006.87,1001,3)
Enter the version of the DICOM Gateway on this computer.
"^DD",2006.87,2006.87,1001,21,0)
^^7^7^3060216^
"^DD",2006.87,2006.87,1001,21,1,0)
The value of this field is a string that identifies the
"^DD",2006.87,2006.87,1001,21,2,0)
version of the DICOM Gateway application that is running
"^DD",2006.87,2006.87,1001,21,3,0)
on the this computer.
"^DD",2006.87,2006.87,1001,21,4,0)
 
"^DD",2006.87,2006.87,1001,21,5,0)
This value is copied from the second line of routine MAGDVRSN.
"^DD",2006.87,2006.87,1001,21,6,0)
(Note that different DICOM Gateways at a single site may be
"^DD",2006.87,2006.87,1001,21,7,0)
running different versions of the DICOM Gateway application.)
"^DD",2006.87,2006.87,1001,"DT")
3060216
"^DD",2006.87,2006.87,1011,0)
TIMESTAMP DICOM VIEWER^D^^101;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",2006.87,2006.87,1011,3)
Enter the date and time when this file was most recently modified.
"^DD",2006.87,2006.87,1011,21,0)
^^4^4^3060216^
"^DD",2006.87,2006.87,1011,21,1,0)
The value of this field is a timestamp (VA-FileMan format).
"^DD",2006.87,2006.87,1011,21,2,0)
This timestamp identifies the date and time when the file
"^DD",2006.87,2006.87,1011,21,3,0)
  C:\Program Files\VistA\Imaging\DCMView\MAG_DCMView.exe
"^DD",2006.87,2006.87,1011,21,4,0)
was most recently updated.
"^DD",2006.87,2006.87,1011,"DT")
3060216
"^DD",2006.87,2006.87,1012,0)
FILENAME DICOM VIEWER^F^^101;2^K:$L(X)>100!($L(X)<1) X
"^DD",2006.87,2006.87,1012,3)
Enter the full path+file name for this file.
"^DD",2006.87,2006.87,1012,21,0)
^^5^5^3060216^
"^DD",2006.87,2006.87,1012,21,1,0)
The value if this field is a string that identifies the full
"^DD",2006.87,2006.87,1012,21,2,0)
pathname (drive or disk-share + (sub)directories + file name)
"^DD",2006.87,2006.87,1012,21,3,0)
of the executable file that holds this application.
"^DD",2006.87,2006.87,1012,21,4,0)
Usually the name of this file looks like
"^DD",2006.87,2006.87,1012,21,5,0)
  C:\Program Files\VistA\Imaging\DCMView\MAG_DCMView.exe
"^DD",2006.87,2006.87,1012,"DT")
3060216
"^DD",2006.87,2006.87,1021,0)
TIMESTAMP ABSTRACT MAKER^D^^102;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",2006.87,2006.87,1021,3)
Enter the date and time when this file was most recently modified.
"^DD",2006.87,2006.87,1021,21,0)
^^4^4^3060216^
"^DD",2006.87,2006.87,1021,21,1,0)
The value of this field is a timestamp (VA-FileMan format).
"^DD",2006.87,2006.87,1021,21,2,0)
This timestamp identifies the date and time when the file
"^DD",2006.87,2006.87,1021,21,3,0)
  C:\Program Files\VistA\Imaging\DICOM\MAG_MakeAbs.exe
"^DD",2006.87,2006.87,1021,21,4,0)
was most recently updated.
"^DD",2006.87,2006.87,1021,"DT")
3060216
"^DD",2006.87,2006.87,1022,0)
FILENAME ABSTRACT MAKER^F^^102;2^K:$L(X)>100!($L(X)<1) X
"^DD",2006.87,2006.87,1022,3)
Answer must be 1-100 characters in length.
"^DD",2006.87,2006.87,1022,21,0)
^^5^5^3060216^
"^DD",2006.87,2006.87,1022,21,1,0)
The value if this field is a string that identifies the full
"^DD",2006.87,2006.87,1022,21,2,0)
pathname (drive or disk-share + (sub)directories + file name)
"^DD",2006.87,2006.87,1022,21,3,0)
of the executable file that holds this application.
"^DD",2006.87,2006.87,1022,21,4,0)
Usually the name of this file looks like
"^DD",2006.87,2006.87,1022,21,5,0)
  C:\Program Files\VistA\Imaging\DICOM\MAG_MakeAbs.exe
"^DD",2006.87,2006.87,1022,"DT")
3060216
"^DD",2006.87,2006.87,1031,0)
TIMESTAMP C-STORE^D^^103;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",2006.87,2006.87,1031,3)
Enter the date and time when this file was most recently modified.
"^DD",2006.87,2006.87,1031,21,0)
^^4^4^3060216^
"^DD",2006.87,2006.87,1031,21,1,0)
The value of this field is a timestamp (VA-FileMan format).
"^DD",2006.87,2006.87,1031,21,2,0)
This timestamp identifies the date and time when the file
"^DD",2006.87,2006.87,1031,21,3,0)
  C:\Program Files\VistA\Imaging\DICOM\MAG_CStore.exe
"^DD",2006.87,2006.87,1031,21,4,0)
was most recently updated.
"^DD",2006.87,2006.87,1031,"DT")
3060216
"^DD",2006.87,2006.87,1032,0)
FILENAME C-STORE^F^^103;2^K:$L(X)>100!($L(X)<1) X
"^DD",2006.87,2006.87,1032,3)
Enter the full path+file name for this file.
"^DD",2006.87,2006.87,1032,21,0)
^^5^5^3060216^
"^DD",2006.87,2006.87,1032,21,1,0)
The value if this field is a string that identifies the full
"^DD",2006.87,2006.87,1032,21,2,0)
pathname (drive or disk-share + (sub)directories + file name)
"^DD",2006.87,2006.87,1032,21,3,0)
of the executable file that holds this application.
"^DD",2006.87,2006.87,1032,21,4,0)
Usually the name of this file looks like
"^DD",2006.87,2006.87,1032,21,5,0)
  C:\Program Files\VistA\Imaging\DICOM\MAG_CStore.exe
"^DD",2006.87,2006.87,1032,"DT")
3060216
"^DD",2006.87,2006.87,1041,0)
TIMESTAMP RECONSTRUCTOR^D^^104;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",2006.87,2006.87,1041,3)
Enter the date and time when this file was most recently modified.
"^DD",2006.87,2006.87,1041,21,0)
^^4^4^3060216^
"^DD",2006.87,2006.87,1041,21,1,0)
The value of this field is a timestamp (VA-FileMan format).
"^DD",2006.87,2006.87,1041,21,2,0)
This timestamp identifies the date and time when the file
"^DD",2006.87,2006.87,1041,21,3,0)
  C:\Program Files\VistA\Imaging\DICOM\MAG_Recon.exe
"^DD",2006.87,2006.87,1041,21,4,0)
was most recently updated.
"^DD",2006.87,2006.87,1041,"DT")
3060216
"^DD",2006.87,2006.87,1042,0)
FILENAME RECONSTRUCTOR^F^^104;2^K:$L(X)>100!($L(X)<1) X
"^DD",2006.87,2006.87,1042,3)
Enter the full path+file name for this file.
"^DD",2006.87,2006.87,1042,21,0)
^^5^5^3060216^
"^DD",2006.87,2006.87,1042,21,1,0)
The value if this field is a string that identifies the full
"^DD",2006.87,2006.87,1042,21,2,0)
pathname (drive or disk-share + (sub)directories + file name)
"^DD",2006.87,2006.87,1042,21,3,0)
of the executable file that holds this application.
"^DD",2006.87,2006.87,1042,21,4,0)
Usually the name of this file looks like
"^DD",2006.87,2006.87,1042,21,5,0)
  C:\Program Files\VistA\Imaging\DICOM\MAG_Recon.exe
"^DD",2006.87,2006.87,1042,"DT")
3060216
"^DD",2006.87,2006.87,1051,0)
TIMESTAMP DICOM TO TARGA^D^^105;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",2006.87,2006.87,1051,3)
Enter the date and time when this file was most recently modified.
"^DD",2006.87,2006.87,1051,21,0)
^^4^4^3060216^
"^DD",2006.87,2006.87,1051,21,1,0)
The value of this field is a timestamp (VA-FileMan format).
"^DD",2006.87,2006.87,1051,21,2,0)
This timestamp identifies the date and time when the file
"^DD",2006.87,2006.87,1051,21,3,0)
  C:\Program Files\VistA\Imaging\DICOM\MAG_DCMtoTGA.exe
"^DD",2006.87,2006.87,1051,21,4,0)
was most recently updated.
"^DD",2006.87,2006.87,1051,"DT")
3060216
"^DD",2006.87,2006.87,1052,0)
FILENAME DICOM TO TARGA^F^^105;2^K:$L(X)>100!($L(X)<1) X
"^DD",2006.87,2006.87,1052,3)
Enter the date and time when this file was most recently modified.
"^DD",2006.87,2006.87,1052,21,0)
^^5^5^3060216^
"^DD",2006.87,2006.87,1052,21,1,0)
The value if this field is a string that identifies the full
"^DD",2006.87,2006.87,1052,21,2,0)
pathname (drive or disk-share + (sub)directories + file name)
"^DD",2006.87,2006.87,1052,21,3,0)
of the executable file that holds this application.
"^DD",2006.87,2006.87,1052,21,4,0)
Usually the name of this file looks like
"^DD",2006.87,2006.87,1052,21,5,0)
  C:\Program Files\VistA\Imaging\DICOM\MAG_DCMtoTGA.exe
"^DD",2006.87,2006.87,1052,"DT")
3060216
"^DIC",2006.539,2006.539,0)
DICOM UID SPECIFIC ACTION^2006.539
"^DIC",2006.539,2006.539,0,"GL")
^MAGDICOM(2006.539,
"^DIC",2006.539,2006.539,"%",0)
^1.005^^
"^DIC",2006.539,2006.539,"%D",0)
^^19^19^3080519^
"^DIC",2006.539,2006.539,"%D",1,0)
 +---------------------------------------------------------------+
"^DIC",2006.539,2006.539,"%D",2,0)
 |                                                               |
"^DIC",2006.539,2006.539,"%D",3,0)
 | Property of the US Government.                                |
"^DIC",2006.539,2006.539,"%D",4,0)
 | No permission to copy or redistribute this software is given. |
"^DIC",2006.539,2006.539,"%D",5,0)
 | Use of unreleased versions of this software requires the user |
"^DIC",2006.539,2006.539,"%D",6,0)
 | to execute a written test agreement with the VistA Imaging    |
"^DIC",2006.539,2006.539,"%D",7,0)
 | Development Office of the Department of Veterans Affairs,     |
"^DIC",2006.539,2006.539,"%D",8,0)
 | telephone (301) 734-0100.                                     |
"^DIC",2006.539,2006.539,"%D",9,0)
 |                                                               |
"^DIC",2006.539,2006.539,"%D",10,0)
 | The Food and Drug Administration classifies this software as  |
"^DIC",2006.539,2006.539,"%D",11,0)
 | a medical device.  As such, it may not be changed in any way. |
"^DIC",2006.539,2006.539,"%D",12,0)
 | Modifications to this software may result in an adulterated   |
"^DIC",2006.539,2006.539,"%D",13,0)
 | medical device under 21CFR820, the use of which is considered |
"^DIC",2006.539,2006.539,"%D",14,0)
 | to be a violation of US Federal Statutes.                     |
"^DIC",2006.539,2006.539,"%D",15,0)
 |                                                               |
"^DIC",2006.539,2006.539,"%D",16,0)
 +---------------------------------------------------------------+
"^DIC",2006.539,2006.539,"%D",17,0)
This file documents specific actions to be taken to process various kinds 
"^DIC",2006.539,2006.539,"%D",18,0)
of DICOM-defined entities or attributes, such as SOP Classes, application 
"^DIC",2006.539,2006.539,"%D",19,0)
contexts, etc.
"^DIC",2006.539,"B","DICOM UID SPECIFIC ACTION",2006.539)

"^DIC",2006.5714,2006.5714,0)
DICOM INCOMPLETE OBJECT^2006.5714
"^DIC",2006.5714,2006.5714,0,"GL")
^MAGDINPT(2006.5714,
"^DIC",2006.5714,2006.5714,"%D",0)
^1.001^19^19^3080530^^
"^DIC",2006.5714,2006.5714,"%D",1,0)
 +---------------------------------------------------------------+
"^DIC",2006.5714,2006.5714,"%D",2,0)
 |                                                               |
"^DIC",2006.5714,2006.5714,"%D",3,0)
 | Property of the US Government.                                |
"^DIC",2006.5714,2006.5714,"%D",4,0)
 | No permission to copy or redistribute this software is given. |
"^DIC",2006.5714,2006.5714,"%D",5,0)
 | Use of unreleased versions of this software requires the user |
"^DIC",2006.5714,2006.5714,"%D",6,0)
 | to execute a written test agreement with the VistA Imaging    |
"^DIC",2006.5714,2006.5714,"%D",7,0)
 | Development Office of the Department of Veterans Affairs,     |
"^DIC",2006.5714,2006.5714,"%D",8,0)
 | telephone (301) 734-0100.                                     |
"^DIC",2006.5714,2006.5714,"%D",9,0)
 |                                                               |
"^DIC",2006.5714,2006.5714,"%D",10,0)
 | The Food and Drug Administration classifies this software as  |
"^DIC",2006.5714,2006.5714,"%D",11,0)
 | a medical device.  As such, it may not be changed in any way. |
"^DIC",2006.5714,2006.5714,"%D",12,0)
 | Modifications to this software may result in an adulterated   |
"^DIC",2006.5714,2006.5714,"%D",13,0)
 | medical device under 21CFR820, the use of which is considered |
"^DIC",2006.5714,2006.5714,"%D",14,0)
 | to be a violation of US Federal Statutes.                     |
"^DIC",2006.5714,2006.5714,"%D",15,0)
 |                                                               |
"^DIC",2006.5714,2006.5714,"%D",16,0)
 +---------------------------------------------------------------+
"^DIC",2006.5714,2006.5714,"%D",17,0)
 
"^DIC",2006.5714,2006.5714,"%D",18,0)
The entries in this table describe images that could not be processed 
"^DIC",2006.5714,2006.5714,"%D",19,0)
because they were incompletely captured.
"^DIC",2006.5714,"B","DICOM INCOMPLETE OBJECT",2006.5714)

"^DIC",2006.5733,2006.5733,0)
QUERY/RETRIEVE STATISTICS^2006.5733
"^DIC",2006.5733,2006.5733,0,"GL")
^MAGDAUDT(2006.5733,
"^DIC",2006.5733,2006.5733,"%D",0)
^^22^22^3050803^
"^DIC",2006.5733,2006.5733,"%D",1,0)
 +---------------------------------------------------------------+
"^DIC",2006.5733,2006.5733,"%D",2,0)
 |                                                               |
"^DIC",2006.5733,2006.5733,"%D",3,0)
 | Property of the US Government.                                |
"^DIC",2006.5733,2006.5733,"%D",4,0)
 | No permission to copy or redistribute this software is given. |
"^DIC",2006.5733,2006.5733,"%D",5,0)
 | Use of unreleased versions of this software requires the user |
"^DIC",2006.5733,2006.5733,"%D",6,0)
 | to execute a written test agreement with the VistA Imaging    |
"^DIC",2006.5733,2006.5733,"%D",7,0)
 | Development Office of the Department of Veterans Affairs,     |
"^DIC",2006.5733,2006.5733,"%D",8,0)
 | telephone (301) 734-0100.                                     |
"^DIC",2006.5733,2006.5733,"%D",9,0)
 |                                                               |
"^DIC",2006.5733,2006.5733,"%D",10,0)
 | The Food and Drug Administration classifies this software as  |
"^DIC",2006.5733,2006.5733,"%D",11,0)
 | a medical device.  As such, it may not be changed in any way. |
"^DIC",2006.5733,2006.5733,"%D",12,0)
 | Modifications to this software may result in an adulterated   |
"^DIC",2006.5733,2006.5733,"%D",13,0)
 | medical device under 21CFR820, the use of which is considered |
"^DIC",2006.5733,2006.5733,"%D",14,0)
 | to be a violation of US Federal Statutes.                     |
"^DIC",2006.5733,2006.5733,"%D",15,0)
 |                                                               |
"^DIC",2006.5733,2006.5733,"%D",16,0)
 +---------------------------------------------------------------+
"^DIC",2006.5733,2006.5733,"%D",17,0)
 
"^DIC",2006.5733,2006.5733,"%D",18,0)
The entries in this table are statistics about the usage
"^DIC",2006.5733,2006.5733,"%D",19,0)
of the DICOM Query/Retrieve facility.
"^DIC",2006.5733,2006.5733,"%D",20,0)
Each entry in this table tallies how often a specific query occurred.
"^DIC",2006.5733,2006.5733,"%D",21,0)
Some entries in this table have sub-records that tally how often
"^DIC",2006.5733,2006.5733,"%D",22,0)
specific results occurred.
"^DIC",2006.5733,"B","QUERY/RETRIEVE STATISTICS",2006.5733)

"^DIC",2006.574,2006.574,0)
DICOM IMAGE OUTPUT^2006.574
"^DIC",2006.574,2006.574,0,"GL")
^MAGDOUTP(2006.574,
"^DIC",2006.574,2006.574,"%",0)
^1.005^^0
"^DIC",2006.574,2006.574,"%D",0)
^^21^21^3010619^
"^DIC",2006.574,2006.574,"%D",1,0)
 +---------------------------------------------------------------+
"^DIC",2006.574,2006.574,"%D",2,0)
 |                                                               |
"^DIC",2006.574,2006.574,"%D",3,0)
 | Property of the US Government.                                |
"^DIC",2006.574,2006.574,"%D",4,0)
 | No permission to copy or redistribute this software is given. |
"^DIC",2006.574,2006.574,"%D",5,0)
 | Use of unreleased versions of this software requires the user |
"^DIC",2006.574,2006.574,"%D",6,0)
 | to execute a written test agreement with the VistA Imaging    |
"^DIC",2006.574,2006.574,"%D",7,0)
 | Development Office of the Department of Veterans Affairs,     |
"^DIC",2006.574,2006.574,"%D",8,0)
 | telephone (301) 734-0100.                                     |
"^DIC",2006.574,2006.574,"%D",9,0)
 |                                                               |
"^DIC",2006.574,2006.574,"%D",10,0)
 | The Food and Drug Administration classifies this software as  |
"^DIC",2006.574,2006.574,"%D",11,0)
 | a medical device.  As such, it may not be changed in any way. |
"^DIC",2006.574,2006.574,"%D",12,0)
 | Modifications to this software may result in an adulterated   |
"^DIC",2006.574,2006.574,"%D",13,0)
 | medical device under 21CFR820, the use of which is considered |
"^DIC",2006.574,2006.574,"%D",14,0)
 | to be a violation of US Federal Statutes.                     |
"^DIC",2006.574,2006.574,"%D",15,0)
 |                                                               |
"^DIC",2006.574,2006.574,"%D",16,0)
 +---------------------------------------------------------------+
"^DIC",2006.574,2006.574,"%D",17,0)
 
"^DIC",2006.574,2006.574,"%D",18,0)
The entries in this table describe requests to transmit image files
"^DIC",2006.574,2006.574,"%D",19,0)
to an alternate storage provider.
"^DIC",2006.574,2006.574,"%D",20,0)
The top-level of this table identifies the storage provider, the next
"^DIC",2006.574,2006.574,"%D",21,0)
level identifies the images for which files are to be transmitted.
"^DIC",2006.574,"B","DICOM IMAGE OUTPUT",2006.574)

"^DIC",2006.575,2006.575,0)
DICOM FAILED IMAGES^2006.575
"^DIC",2006.575,2006.575,0,"GL")
^MAGD(2006.575,
"^DIC",2006.575,2006.575,"%",0)
^1.005^^0
"^DIC",2006.575,2006.575,"%D",0)
^^32^32^3010619^
"^DIC",2006.575,2006.575,"%D",1,0)
 +---------------------------------------------------------------+
"^DIC",2006.575,2006.575,"%D",2,0)
 |                                                               |
"^DIC",2006.575,2006.575,"%D",3,0)
 | Property of the US Government.                                |
"^DIC",2006.575,2006.575,"%D",4,0)
 | No permission to copy or redistribute this software is given. |
"^DIC",2006.575,2006.575,"%D",5,0)
 | Use of unreleased versions of this software requires the user |
"^DIC",2006.575,2006.575,"%D",6,0)
 | to execute a written test agreement with the VistA Imaging    |
"^DIC",2006.575,2006.575,"%D",7,0)
 | Development Office of the Department of Veterans Affairs,     |
"^DIC",2006.575,2006.575,"%D",8,0)
 | telephone (301) 734-0100.                                     |
"^DIC",2006.575,2006.575,"%D",9,0)
 |                                                               |
"^DIC",2006.575,2006.575,"%D",10,0)
 | The Food and Drug Administration classifies this software as  |
"^DIC",2006.575,2006.575,"%D",11,0)
 | a medical device.  As such, it may not be changed in any way. |
"^DIC",2006.575,2006.575,"%D",12,0)
 | Modifications to this software may result in an adulterated   |
"^DIC",2006.575,2006.575,"%D",13,0)
 | medical device under 21CFR820, the use of which is considered |
"^DIC",2006.575,2006.575,"%D",14,0)
 | to be a violation of US Federal Statutes.                     |
"^DIC",2006.575,2006.575,"%D",15,0)
 |                                                               |
"^DIC",2006.575,2006.575,"%D",16,0)
 +---------------------------------------------------------------+
"^DIC",2006.575,2006.575,"%D",17,0)
 
"^DIC",2006.575,2006.575,"%D",18,0)
The entries in this table describe image files that were received by the
"^DIC",2006.575,2006.575,"%D",19,0)
DICOM Image Gateway, and could not be matched with a patient and an
"^DIC",2006.575,2006.575,"%D",20,0)
ordered study.
"^DIC",2006.575,2006.575,"%D",21,0)
 
"^DIC",2006.575,2006.575,"%D",22,0)
The MAGD FIX DICOM FILE and MAGD FIX MEDICINE DICOM FILE menu options are
"^DIC",2006.575,2006.575,"%D",23,0)
used to update the entries in this file.  The DICOM Image Gateway will
"^DIC",2006.575,2006.575,"%D",24,0)
poll this file for corrected entries. The cross reference used to poll
"^DIC",2006.575,2006.575,"%D",25,0)
this information is ^MAGD(2006.575,"AFX".
"^DIC",2006.575,2006.575,"%D",26,0)
 
"^DIC",2006.575,2006.575,"%D",27,0)
The routine L^MAGDLB1 is used by the above menu options and will loop thru
"^DIC",2006.575,2006.575,"%D",28,0)
the following cross reference ^MAGD(2006.575,"F".  This cross reference is
"^DIC",2006.575,2006.575,"%D",29,0)
set by the DICOM Study Instance UID; this is a unique number assigned by
"^DIC",2006.575,2006.575,"%D",30,0)
modalities (imaging equipment) and is unique by case study.  So it is
"^DIC",2006.575,2006.575,"%D",31,0)
possible to have over 20 entries in the file and only one unique "F" cross
"^DIC",2006.575,2006.575,"%D",32,0)
reference. 
"^DIC",2006.575,"B","DICOM FAILED IMAGES",2006.575)

"^DIC",2006.5821,2006.5821,0)
CT CONVERSION PARAMETERS^2006.5821
"^DIC",2006.5821,2006.5821,0,"GL")
^MAGDICOM(2006.5821,
"^DIC",2006.5821,2006.5821,"%D",0)
^^21^21^3050803^
"^DIC",2006.5821,2006.5821,"%D",1,0)
 +---------------------------------------------------------------+
"^DIC",2006.5821,2006.5821,"%D",2,0)
 |                                                               |
"^DIC",2006.5821,2006.5821,"%D",3,0)
 | Property of the US Government.                                |
"^DIC",2006.5821,2006.5821,"%D",4,0)
 | No permission to copy or redistribute this software is given. |
"^DIC",2006.5821,2006.5821,"%D",5,0)
 | Use of unreleased versions of this software requires the user |
"^DIC",2006.5821,2006.5821,"%D",6,0)
 | to execute a written test agreement with the VistA Imaging    |
"^DIC",2006.5821,2006.5821,"%D",7,0)
 | Development Office of the Department of Veterans Affairs,     |
"^DIC",2006.5821,2006.5821,"%D",8,0)
 | telephone (301) 734-0100.                                     |
"^DIC",2006.5821,2006.5821,"%D",9,0)
 |                                                               |
"^DIC",2006.5821,2006.5821,"%D",10,0)
 | The Food and Drug Administration classifies this software as  |
"^DIC",2006.5821,2006.5821,"%D",11,0)
 | a medical device.  As such, it may not be changed in any way. |
"^DIC",2006.5821,2006.5821,"%D",12,0)
 | Modifications to this software may result in an adulterated   |
"^DIC",2006.5821,2006.5821,"%D",13,0)
 | medical device under 21CFR820, the use of which is considered |
"^DIC",2006.5821,2006.5821,"%D",14,0)
 | to be a violation of US Federal Statutes.                     |
"^DIC",2006.5821,2006.5821,"%D",15,0)
 |                                                               |
"^DIC",2006.5821,2006.5821,"%D",16,0)
 +---------------------------------------------------------------+
"^DIC",2006.5821,2006.5821,"%D",17,0)
 
"^DIC",2006.5821,2006.5821,"%D",18,0)
The entries in this table document about the history of
"^DIC",2006.5821,2006.5821,"%D",19,0)
of the conversion parameters that were used to create Targa files from DICOM streams.
"^DIC",2006.5821,2006.5821,"%D",20,0)
The history in this table is used to reconstruct DICOM files when needed
"^DIC",2006.5821,2006.5821,"%D",21,0)
for export to external devices.
"^DIC",2006.5821,"B","CT CONVERSION PARAMETERS",2006.5821)

"^DIC",2006.5849,2006.5849,0)
TELEREADER READ/UNREAD LIST^2006.5849
"^DIC",2006.5849,2006.5849,0,"GL")
^MAG(2006.5849,
"^DIC",2006.5849,2006.5849,"%",0)
^1.005^^0
"^DIC",2006.5849,2006.5849,"%D",0)
^^3^3^3051212^
"^DIC",2006.5849,2006.5849,"%D",1,0)
This is the Unread/Read list and is stored on the Acquisition Site's Vista system.  
"^DIC",2006.5849,2006.5849,"%D",2,0)
The file is indexed by pointers to file IMAGE INDEX FOR SPECIALTY/SUBSPECIALTY file (#2005.84)
"^DIC",2006.5849,2006.5849,"%D",3,0)
 and IMAGE INDEX FOR PROCEDURE/EVENT file (#2005.85).
"^DIC",2006.5849,"B","TELEREADER READ/UNREAD LIST",2006.5849)

"^DIC",2006.587,2006.587,0)
DICOM TRANSMIT DESTINATION^2006.587
"^DIC",2006.587,2006.587,0,"GL")
^MAG(2006.587,
"^DIC",2006.587,2006.587,"%D",0)
^^33^33^3030804^^
"^DIC",2006.587,2006.587,"%D",1,0)
 +---------------------------------------------------------------+
"^DIC",2006.587,2006.587,"%D",2,0)
 |                                                               |
"^DIC",2006.587,2006.587,"%D",3,0)
 | Property of the US Government.                                |
"^DIC",2006.587,2006.587,"%D",4,0)
 | No permission to copy or redistribute this software is given. |
"^DIC",2006.587,2006.587,"%D",5,0)
 | Use of unreleased versions of this software requires the user |
"^DIC",2006.587,2006.587,"%D",6,0)
 | to execute a written test agreement with the VistA Imaging    |
"^DIC",2006.587,2006.587,"%D",7,0)
 | Development Office of the Department of Veterans Affairs,     |
"^DIC",2006.587,2006.587,"%D",8,0)
 | telephone (301) 734-0100.                                     |
"^DIC",2006.587,2006.587,"%D",9,0)
 |                                                               |
"^DIC",2006.587,2006.587,"%D",10,0)
 | The Food and Drug Administration classifies this software as  |
"^DIC",2006.587,2006.587,"%D",11,0)
 | a medical device.  As such, it may not be changed in any way. |
"^DIC",2006.587,2006.587,"%D",12,0)
 | Modifications to this software may result in an adulterated   |
"^DIC",2006.587,2006.587,"%D",13,0)
 | medical device under 21CFR820, the use of which is considered |
"^DIC",2006.587,2006.587,"%D",14,0)
 | to be a violation of US Federal Statutes.                     |
"^DIC",2006.587,2006.587,"%D",15,0)
 |                                                               |
"^DIC",2006.587,2006.587,"%D",16,0)
 +---------------------------------------------------------------+
"^DIC",2006.587,2006.587,"%D",17,0)
 
"^DIC",2006.587,2006.587,"%D",18,0)
The routing software is able to transmit image files from the
"^DIC",2006.587,2006.587,"%D",19,0)
VistA system where the images are stored permanently to various
"^DIC",2006.587,2006.587,"%D",20,0)
destinations that may receive temporary copies of images.
"^DIC",2006.587,2006.587,"%D",21,0)
Files can be transmitted to these destinations using several
"^DIC",2006.587,2006.587,"%D",22,0)
protocols. Valid destinations for files that are transmitted
"^DIC",2006.587,2006.587,"%D",23,0)
using the MS-DOS copy protocol are stored in the Network Location
"^DIC",2006.587,2006.587,"%D",24,0)
table (FileMan file #2005.2).
"^DIC",2006.587,2006.587,"%D",25,0)
Valid destinations for files that are transmitted using the
"^DIC",2006.587,2006.587,"%D",26,0)
DICOM C-Store protocol are stored in this file.
"^DIC",2006.587,2006.587,"%D",27,0)
 
"^DIC",2006.587,2006.587,"%D",28,0)
For each destination, this table contains the identifying information
"^DIC",2006.587,2006.587,"%D",29,0)
for the destinations, as well as the identifying information for
"^DIC",2006.587,2006.587,"%D",30,0)
the DICOM Gateways that are allowed to transmit images to these
"^DIC",2006.587,2006.587,"%D",31,0)
destinations. If multiple DICOM Gateways are allowed to transmit
"^DIC",2006.587,2006.587,"%D",32,0)
images to a specific destination, this table will contain multiple
"^DIC",2006.587,2006.587,"%D",33,0)
entries for that destination, one for each source and destination pair.
"^DIC",2006.587,"B","DICOM TRANSMIT DESTINATION",2006.587)

"^DIC",2006.87,2006.87,0)
DICOM GATEWAY INFORMATION^2006.87
"^DIC",2006.87,2006.87,0,"GL")
^MAG(2006.87,
"^DIC",2006.87,2006.87,"%",0)
^1.005^^
"^DIC",2006.87,2006.87,"%D",0)
^1.001^22^22^3080331^^^^
"^DIC",2006.87,2006.87,"%D",1,0)
 +---------------------------------------------------------------+
"^DIC",2006.87,2006.87,"%D",2,0)
 |                                                               |
"^DIC",2006.87,2006.87,"%D",3,0)
 | Property of the US Government.                                |
"^DIC",2006.87,2006.87,"%D",4,0)
 | No permission to copy or redistribute this software is given. |
"^DIC",2006.87,2006.87,"%D",5,0)
 | Use of unreleased versions of this software requires the user |
"^DIC",2006.87,2006.87,"%D",6,0)
 | to execute a written test agreement with the VistA Imaging    |
"^DIC",2006.87,2006.87,"%D",7,0)
 | Development Office of the Department of Veterans Affairs,     |
"^DIC",2006.87,2006.87,"%D",8,0)
 | telephone (301) 734-0100.                                     |
"^DIC",2006.87,2006.87,"%D",9,0)
 |                                                               |
"^DIC",2006.87,2006.87,"%D",10,0)
 | The Food and Drug Administration classifies this software as  |
"^DIC",2006.87,2006.87,"%D",11,0)
 | a medical device.  As such, it may not be changed in any way. |
"^DIC",2006.87,2006.87,"%D",12,0)
 | Modifications to this software may result in an adulterated   |
"^DIC",2006.87,2006.87,"%D",13,0)
 | medical device under 21CFR820, the use of which is considered |
"^DIC",2006.87,2006.87,"%D",14,0)
 | to be a violation of US Federal Statutes.                     |
"^DIC",2006.87,2006.87,"%D",15,0)
 |                                                               |
"^DIC",2006.87,2006.87,"%D",16,0)
 +---------------------------------------------------------------+
"^DIC",2006.87,2006.87,"%D",17,0)
 
"^DIC",2006.87,2006.87,"%D",18,0)
This table contains information about the various DICOM Gateways.
"^DIC",2006.87,2006.87,"%D",19,0)
For each DICOM Gateway, the name of its computer,
"^DIC",2006.87,2006.87,"%D",20,0)
the pointer to the "location" for which the Gateway operates are
"^DIC",2006.87,2006.87,"%D",21,0)
stored, as well as a number of timestamps and file-names
"^DIC",2006.87,2006.87,"%D",22,0)
of files that are relevant for external applications.
"^DIC",2006.87,"B","DICOM GATEWAY INFORMATION",2006.87)

**END**
**END**


****
****
