
=============================================================================
Run Date: MAR 23, 2004                     Designation: MAG*3*3
Package : MAG - IMAGING                       Priority: Mandatory
Version : 3        SEQ #19                      Status: Released
                  Compliance Date: APR 23, 2004
=============================================================================

Associated patches: (c)MAG*3*3         install with patch       `MAG*3*3'
                    (v)MAG*3*7         install with patch       `MAG*3*3'

Subject: LONG FILE NAMES                                                        

Category: 
  - Other
  - Routine
  - Data Dictionary
  - Enhancement (Mandatory)

Description:
============

 This patch corrects the limitation on filenames that are over 8 
 characters, the directory hashing for these files, and corrects the 
 retrieval of these files on the clinical display workstations.  The patch 
 also assigns a 3-character namespace to the site to insure that the 
 hashing of the 14.3 formatted files will be correct.  The Purge function 
 of the Background Processor functions with 14.3 files as noted below.  
 However, the Verifier functionality of the background processor is to be 
 corrected in a later patch, also as noted below.
  
 Imaging sites that are alpha/beta testing Imaging's Consolidation code 
 SHOULD NOT install this patch. A t# version of the consolidation code to
 install on VistA Imaging V2.5 sites will be released closely after this
 V3.0 Patch.
  
 ***************** ATTENTION ****************************
 A subsequent Imaging patch, MAG*3.0*13, will correct known 14.3 filename 
 structure issues with the Background Processor's Verifier function.  
 Please be advised: DO NOT execute the Verifier software module until 
 patch MAG*3.0*13 has been released and installed on your system. 
  
 Patch 13 (MAG*3.0*13) test sites may continue testing the Verifier
 software.
 ****************************************************
  
 The patch consists of the following files:
 MAG3_0P3.KID - Kernel Installation & Distribution System (KIDS)
              application to be installed on hospital database.
 MAGDCM.RTN - Digital Imaging and Communication in Medicine (DICOM)
              Image and Text gateway software.  The only changes in
              the DICOM routines are in the shared routines between
              the Clinical software and DICOM.
 Change pages to documentation:
 MAG3_0P3_BPUG_3_1_8_11_HASH.PDF - Change pages for the Background 
              Processor User Guide.
 MAG3_0P3_IG_2_4_5_1-2_Net_Loc_Setup.PDF - Change pages for the Imaging 
              Install Guide for the Network Location Setup section.
  
 To receive this patch, a site must have their Site Agreement on file with 
 and approved by the VistA Imaging Group.
  
 Once the required documents are received and approved, software will be
 available on the Imaging FTP server under 
 Software\Software_Released\Mag3_0p3 folder. For information concerning the
 status of a site, contact Kathy Trombetta via phone (301-734-0357) or
 email (Kathy.Trombetta@med.va.gov).
  
 Field test sites:
 =============================== 
 Phoenix, AZ
 Little Rock, AK
 El Paso, TX
 Biloxi, MS
  
  
 NOIS:
 ===== 
 WIM-0302-22412
 MOU-0402-30075
 BAY-0103-30363
  
 This patch corrects the problem observed at sites that have collected 
 over a million images and are using hashing when writing images to the 
 magnetic cache shares and jukebox.  Imaging had a file name limitation of 
 8 characters for the file name and 3 characters for the file extension.  
 For example, for an 8.3 filename, AB123456.jpg, the directory hash was 
 AB\12\34 and then folder 34 could contain 100  entries for Image 
 filenames AB123400 through AB123499. When file AB123500 was captured then 
 a \35 directory was created and so forth.   When the site reached the 
 one-millionth image the directory structure created was AB00\00\00\0\\ 
 where the last directory would only contain one file entry.  The software 
 has been modified to accept a 14.3 filename, 14 characters for the file 
 name with a 3 character file extension.  As part of the 14 character file 
 name, the leading 3 characters will be a unique Namespace with the 
 remaining 11 characters for the Image IEN.  For example, a file name of 
 ABC01234567890.jpg will be written as the ninetieth entry to the 
 directory ABC0\12\34\56\78, with ABC as the unique Namespace and the 
 1234567890 IEN.  
  
 After installation of this patch all new filenames will be 14 characters 
 in length with a 3-character extension, and all production file 
 namespaces will assigned a unique three characters (ABC rather then AB 
 from the example above).  Image names and IENs assigned to images 
 acquired before the patch installation will remain in the 8.3 name format 
 and the software is able to locate and display both the 8.3 and the 14.3 
 file format.  If a group of images is being acquired and processed at the
 time of the patch installation, the image names might begin with the 8.3
 format and after the patch has been installed, the rest of the images in
 the group would be in the 14.3 format. 
  
 Updating field CURRENT NAMESPACE of the IMAGING SITE PARAMETER file:
 ==================================================================== 
 The KIDS build has a post install routine that will update the CURRENT 
 NAMESPACE field in the Imaging Site Parameter file (#2006.1) with the 
 newly assigned three-character namespace.  The previous entry for the 
 field CURRENT NAMESPACE will be added to the multiple field, MULTI 
 NAMESPACE (#12.5). After the installation any new image captures will 
 have a filename with the new three-character namespace preceding the 
 numeric IEN.  The following list is provided to inform you of your site's 
 new three-character namespace. 
  
 IMAGING USERS LIST                           DEC 11,2003 17:26  PAGE 1
                                 NEW
 DOMAIN NAME                     NMSP
 ----------------------------------------------------------------------
 ALBUQUERQUE.VA.GOV              ALB
 ALEXANDRIA.VA.GOV               ALX
 ALTOONA.VA.GOV                  ALT
 AMARILLO.VA.GOV                 AMA
 ANCHORAGE.VA.GOV                ANC
 ANN-ARBOR.VA.GOV                ANN
 ASHEVILLE.VA.GOV                ASH
 ATLANTA.VA.GOV                  ATG
 AUGUSTA.VA.GOV                  AUG
 BALTIMORE.VA.GOV                BAL
 BATAVIA.VA.GOV                  NYB
 BATTLE-CREEK.VA.GOV             BAC
 BAY-PINES.VA.GOV                BAY
 BECKLEY.VA.GOV                  BEC
 BEDFORD.VA.GOV                  BED
 BIG-SPRING.VA.GOV               BIG
 BILOXI.VA.GOV                   BIL
 BIRMINGHAM.VA.GOV               BIR
 BOISE.VA.GOV                    BOI
 BONHAM.VA.GOV                   BON
 BOSTON.VA.GOV                   BHS
 BRONX.VA.GOV                    BRX
 BROOKLYN.VA.GOV                 BYN
 BUFFALO.VA.GOV                  WNY
 BUTLER.VA.GOV                   BUT
 CASTLE-POINT.VA.GOV             CAP
 CENTRAL-PLAINS.VA.GOV           OMA
 CENTRAL-TEXAS.VA.GOV            CTX
 CHARLESTON.VA.GOV               CHA
 CHEYENNE.VA.GOV                 CHY
 CHICAGO-LAKE.VA.GOV             CHL
 CHICAGO-WEST.VA.GOV             CHS
 CHILLICOTHE.VA.GOV              CLL
 CINCINNATI.VA.GOV               CIN
 CLARKSBURG.VA.GOV               CLA
 CLEVELAND.VA.GOV                CLE
 COATESVILLE.VA.GOV              COA
 COLUMBIA MO [EFF. 4/1/01]       CMO
 COLUMBIA-SC.VA.GOV              CMS
 COLUMBUS.VA.GOV                 COS
 DALLAS.VA.GOV                   NTH
 DANVILLE.VA.GOV                 DAN
 DAYTON.VA.GOV                   DAY
 DAYTONA.VA.GOV                  DTA
 DENVER.VA.GOV                   DEN
 DES-MOINES.VA.GOV               DES
 DETROIT.VA.GOV                  DET
 DUBLIN.VA.GOV                   DUB
 DURHAM.VA.GOV                   DUR
 EAST-ORANGE.VA.GOV              NJH
 EFFINGHAM CBOC-MA EFF 7-1-01    EFF
 EL-PASO.VA.GOV                  ELP
 ERIE.VA.GOV                     ERI
 EVANSVILLE CBOC-MA EFF 7/1/01   EVA
 FARGO.VA.GOV                    FAR
 FAYETTVL-AR.VA.GOV              FAV
 FAYETTVL-NC.VA.GOV              FNC
 FORT-LYON.VA.GOV                FTL
 FORT-MEADE.VA.GOV               BHH
 FRESNO.VA.GOV                   FRE
 FT-HARRISON.VA.GOV              FHM
 GRAND-JUNCT.VA.GOV              GRJ
 HAMPTON.VA.GOV                  HAM
 HINES.VA.GOV                    HIN
 HONOLULU.VA.GOV                 HON
 HOT-SPRINGS.VA.GOV              HSP
 HOUSTON.VA.GOV                  HOU
 HUNTINGTON.VA.GOV               HUN
 INDIANAPOLIS.VA.GOV             IND
 IOWA-CITY.VA.GOV                IOW
 IRON-MTN.VA.GOV                 IRO
 JACKSON.VA.GOV                  JAC
 JACKSONVILLE.VA.GOV             JKV
 KANSAS-CITY.VA.GOV              KAN
 KNOXVILLE.VA.GOV                KNX
 LAKE-CITY.VA.GOV                LAC
 LAS-VEGAS.VA.GOV                LAS
 LEAVENWORTH - EFF. 7/1/01       LEA
 LEBANON.VA.GOV                  LEB
 LEXINGTON.VA.GOV                LEX
 LINCOLN.VA.GOV                  LIN
 LITTLE-ROCK.VA.GOV              LIT
 LOMA-LINDA.VA.GOV               LOM
 LONG-BEACH.VA.GOV               LON
 LOUISVILLE.VA.GOV               LOU
 LYONS.VA.GOV                    LYN
 MADISON.VA.GOV                  MAD
 MANCHESTER.VA.GOV               MAN
 MARION IL - EFF. 7/1/01         MRN
 MARION-IN.VA.GOV                MID
 MARTINEZ.VA.GOV                 MAC
 MARTINSBURG.VA.GOV              MWV
 MEMPHIS.VA.GOV                  MEM
 MIAMI.VA.GOV                    MIA
 MILWAUKEE.VA.GOV                MIW
 MINNEAPOLIS.VA.GOV              MIN
 MONTGOMERY.VA.GOV               CAH
 MONTROSE.VA.GOV                 HVH
 MTN-HOME.VA.GOV                 MOU
 MURFREESBORO.VA.GOV             TVH
 MUSKOGEE.VA.GOV                 MUS
 N-CHICAGO.VA.GOV                NCH
 NEW-ORLEANS.VA.GOV              NOL
 NORTH-FLORIDA.VA.GOV            GAI
 NORTHAMPTON.VA.GOV              NHM
 NORTHERN-INDIANA.VA.GOV         NIN
 NORTHPORT.VA.GOV                NOP
 NY-HARBOR.VA.GOV                NYN
 OKLAHOMA.VA.GOV                 OKL
 PALO-ALTO.VA.GOV                PAL
 PERRY-POINT.VA.GOV              PER
 PHILADELPHIA.VA.GOV             PHI
 PHOENIX.VA.GOV                  PHO
 PITTSBURGH.VA.GOV               PTH
 POPLAR BLUFF, MO-EFF 4/1/01     POP
 PORTLAND.VA.GOV                 POR
 PRESCOTT.VA.GOV                 PRE
 PROVIDENCE.VA.GOV               PRO
 PUGET-SOUND.VA.GOV              PUG
 RENO.VA.GOV                     REN
 RICHMOND.VA.GOV                 RIC
 ROSEBURG.VA.GOV                 ROS
 SAGINAW.VA.GOV                  SAG
 SALEM.VA.GOV                    SAM
 SALISBURY.VA.GOV                SBY
 SALT-LAKE.VA.GOV                SLC
 SAN-ANTONIO.VA.GOV              STX
 SAN-DIEGO.VA.GOV                SDC
 SAN-JUAN.VA.GOV                 SAJ
 SANFRANCISCO.VA.GOV             SFC
 SEPULVEDA.VA.GOV                SEP
 SHERIDAN.VA.GOV                 SHE
 SHREVEPORT.VA.GOV               SHR
 SPOKANE.VA.GOV                  SPO
 ST CHARLES CBOC                 SCH
 ST-CLOUD.VA.GOV                 STC
 ST-LOUIS.VA.GOV                 STL
 TALLAHASSEE.VA.GOV              TAL
 TAMPA.VA.GOV                    TAM
 TENNESSEEVALLEY.VA.GOV          NAS
 TOGUS.VA.GOV                    TOG
 TOMAH.VA.GOV                    TOM
 TOPEKA - Eff. 7/1/01            TOP
 TUCSON.VA.GOV                   TUC
 TUSCALOOSA.VA.GOV               TUA
 TUSKEGEE.VA.GOV                 TUS
 VAMC ALBANY N.Y. [EFF. 7/1/00]  ALN
 VAMC BATH [7-1-00]              BAN
 VAMC CANANDAIGUA,NY [10/1/99]   CAN
 VAMC SYRACUSE,NY [4/1/00]       SYR
 WACO.VA.GOV                     WAC
 WALLA-WALLA.VA.GOV              WWW
 WASHINGTON.VA.GOV               WAS
 WEST-HAVEN.VA.GOV               CON
 WEST-LA.VA.GOV                  WLA
 WEST-PALM.VA.GOV                WPB
 WHITE-CITY.VA.GOV               WCO
 WHITE-RIVER.VA.GOV              WRJ
 WICHITA VAMC EFF. 10/1/01       WIC
 WILKES-BARRE.VA.GOV             WBP
 WILMINGTON.VA.GOV               WIM
  
 Please NOTE:  The following message will be displayed if the KIDS post 
 install could not create the new three-character namespace: "Contact the 
 National Help desk to update a namespace!"  This message is also recorded 
 in the Install file for this patch.  The display of this message will not 
 abort the KIDS installation. The processing of images will continue using 
 the existing CURRENT NAMESPACE entry but with the 14.3 file format. 
  
 Please check the install log for presence of this message and contact the 
 National Help desk if the message is found.  Please follow the VERIFY 
 Namespace Change instructions at the end of the installation instructions 
 and note the IEN and the full path name of the test image acquired and 
 processed.  This will provide both you and the Help Desk representative 
 with the needed information about your current Namespace and the hashing 
 directory tree structure following the installation of the patch.
   
  
   ROUTINE SUMMARY:
                                                                                 
 =======================================                                   
      
 The following is a list of the routine(s) included in this patch.  The
 second line of each of these routine(s) will look like:
                                                                                 
      <tab>;;3.0;Imaging;**3**;January 26, 2004
                                                                                 
                                                                                 
                             CHECK^XTSUMBLD results
                                                                                 
   Routine name      After Patch         Patch List
   ============      ============        =========== 
    MAGGTU1            3618392              **3**
    MAGIPOS3           4950507              **3**
    MAGQBPRG           9753805              **7,3**
    MAGUSIT            7097852              **3**
  
 DICOM Gateways routines are:
                                                                                    
      <tab>;;3.0;Imaging;**3**;November  06, 2003     
                                                                                
  
   Routine name      After Patch         Patch List
   ============      ===========         ==========
    MAGGTU1            3618392             **3**
    MAGDVRSN           3510833             **1,7,9,26,21,10,3** 
  
 Routine MAGIPOS3 is a post installation routine that is deleted at the end
 of the KIDS install.
  
 Routine MAGGTU1 has been modified to create filename in the new 14.3 
 format.
  
 Routine MAGQBPRG has been modified to purge file in the new 14.3 format.
  
 Routine MAGUSIT has been modified to automatically update the new file 
 namespace in the Imaging Site Parameter file (2006.1).
  
 Routine MAGDVRSN is only present on the DICOM gateways and is not in the 
 KIDS build.  This routine is used in displaying the patch list installed 
 on the DICOM gateway.
  
 Data Dictionary Changes:
 ======================== 
 The KIDS application contains data dictionary updates.
  
 A full data dictionary with data for file 2006.19, IMAGING USERS, will be 
 installed.  The data to be installed is listed above in the section 
 'Updating CURRENT NAMESPACE field of the IMAGING SITE PARAMETER file".  
 Field #.02, IMAGE FILE NAMESPACE, has been updated to store 1 to 45 
 characters. New fields added are: #2 NEW NMSP and #3 PRODUCTION.  This 
 file is a static file used by Imaging developers for retrieval of site 
 information.
  
 A partial data dictionary update for file 2006.1, IMAGING SITE PARAMETER, 
 will be installed.  The following fields have been updated to store 1 to 
 45 characters: #.02 CURRENT NAMESPACE and #12.5 MULTI NAMESPACE.
  
 Menu Option:
 ===========
 The KID application will delete menu option 'Edit Image WRITE LOCATION 
 only' [MAG SYS-EDIT WRITE LOCATION].  This menu option was used to edit 
 fields IMAGE NETWORK WRITE LOCATION (#.02) and PACS IMAGE WRITE LOCATION 
 (#1.03) in the IMAGE SITE PARAMETER file (#2006.1).  Enter/Editing 
 entries into the file can be accomplished using VistA Imaging Background 
 Processor.     
  
 Input Template:
 =========== 
 The KID application will delete input template 'MAG IMAGE NETWORK WRITE 
 LOC'.  This input template was called from menu option 'Edit Image WRITE 
 LOCATION only' [MAG SYS-EDIT WRITE LOCATION].
  
  
 INSTALLATION INSTRUCTIONS: 
 ==========================
 IMPORTANT note:  
 This patch should be loaded with Imaging users off of the system. Imaging 
 users would be anyone using the VistA Imaging Capture software and does 
 include the DICOM Gateways.  STOP ALL PROCESS ON THE DICOM and ROUTING 
 GATEWAYS. Load this patch in both your test and production areas. 
  
 Note: Patch MAG*3.0*7 is a REQUIRED BUILD for this KIDS distribution.     
 Installation will take less than one minute; verification will take 5 
 minutes.
                                                                                 
  1.  From the Kernel Installation and Distribution System Menu, select
      the Installation menu.
  2.  Use the Kernel Installation and Distribution System Menu option to
      load the MAG3_0P3.KID.
  3.  From this menu, you may elect to use the following options (when
      prompted for the INSTALL NAME, enter MAG*3.0*3).
                                                                                 
     a. Backup a Transport Global - this option will create a backup
        message of any routines exported with the patch.  It will NOT
        backup any of the other changes.
     b. Compare Transport Global to Current System - this option will
        allow you to view all changes that will be made when the patch
        is installed.  It compares all components of the patch (routines
        and options).          
     c. Verify Checksums in Transport Global - this option will allow
        you to ensure the integrity of the routines that are in the
        transport global.
                                                                                 
  4.  Use the Install Package(s) option to select the package MAG*3.0*3.
  5.  When prompted "Want KIDS to Rebuild Menu Trees Upon Completion of
      Install? Yes// " respond "NO".
  6.  When Prompted to "Want KIDS to INHIBIT LOGONs during the install?
      NO//" respond "NO".
  7.  When prompted "Want to DISABLE Scheduled Options, Menu Options,
      and Protocols? YES//" respond "NO".  
  
 VERIFY the Namespace change:
 1.  Perform a FileMan Inquiry on your site.  Inspect the CURRENT
     NAMESPACE field in the Imaging Site Parameter file (2006.1) with
     the newly assigned three-character namespace.
 2.  Capture a test image.  Verify that the hashing is correct, and
     that the three character namespace was used.
 3.  Display the image using the Clinical Display and right click the
     the image ABSTRACT icon and select Image Info.  The Yellow
     window "Image Information/properties" will display the Image
     IEN, followed by the full hashing directory structure and the
     Image Name contained in the last hash folder in the directory
     Tree.
  
 DICOM Gateway installation instructions for MAGDCM.RTN file:
 ======================================================                    
      
 IMPORTANT Note:  It is imperative that all DICOM gateways, including 
 ROUTING gateways, be updated as soon as the above installation 
 instructions have been completed. No gateway should be running a prior 
 version of the software because the hashing format will be incorrect.
  
 1)      STOP ALL PROCESSES on the gateway being updated.        
 2)      Use a telnet session to 127.0.0.1.
 3)      Provide the access and verify codes as prompted.
 4)      Select the System Maintenance menu option and then select the 
         Programmer's Mode menu option.
 5)      Provide the programmer's access code. (This code was setup during 
         the initial installation of the DICOM software.) 
 6)      The computer prompt should have [DCM,DCM]; this prompt will 
         indicate whether or not you are in the correct UCI.  If you are
         not please exit and go back to step 1.
 7)      In programmers mode execute the Routine Restore program (^%RR) to 
         restore the routines in MAGDCM.RTN file in the DCM. This file
         contains two routines.
 8)      Provide the correct full path for the MAGDCM.RTN 
 9)      The following is an example:
  
  
 [DCM,DCM]>D ^%RR
  
           MSM - Routine Restore Utility
  
 Enter input device <HFS>:   Host File Server
 File Name >: F:\3_0PATCH3\MAGDCM.RTN
 Routine(s) saved at 06:54 AM 11/06/2003
 Header comment is: DICOM Gateway MUMPS routines Build V3.0p3Build485_T25
 Selective restore? (allows rename) <N>: NO
 Restoring...                                                              
      
                                                                                 
 MAGDVRSN  MAGGTU1                       
                                                                                 
 2 Routines restored.
 [DCM,DCM]>
  
 Verification:
 ===========
 To verify that the correct version has been installed use the menu option 
 on the DICOM Gateways.  The path is the following:
      4- System Maintenance, 
         1 - System Operation,  
             4 - Display the Version of the Software.
  
 This is "IMAGING 3.0" created on 06-November-2003.
 Installed patches:
 Patch 1: 28-March-2002
 Patch 3: 06-November-2003
 Patch 7: 25-Jul-2002
 Patch 9: 31-March-2003
 Patch 10: 10-November-2003
 Patch 21: 30-October-2003 
 Patch 36: 12-February-2004

Routine Information:
====================

=============================================================================
User Information:
Entered By  : BARRIOS,LUCILLE               Date Entered  : APR 26, 2002
Completed By: CARR,ROSEMARY                 Date Completed: MAR 22, 2004
Released By : LOVING,MANLEY                 Date Released : MAR 23, 2004
=============================================================================


Packman Mail Message:
=====================

No routines included
