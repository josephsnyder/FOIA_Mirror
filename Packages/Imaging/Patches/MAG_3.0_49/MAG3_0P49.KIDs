KIDS Distribution saved on Apr 07, 2011@13:07:06
VistA Imaging V3.0 - Patch 49 - 04/07/2011 13:07PM
**KIDS**:MAG*3.0*49^

**INSTALL NAME**
MAG*3.0*49
"BLD",3463,0)
MAG*3.0*49^IMAGING^0^3110407^y
"BLD",3463,1,0)
^^36^36^3110407^
"BLD",3463,1,1,0)
Version 3.0 Patch 049 - HL7 ADT Transmission to Commercial PACS
"BLD",3463,1,2,0)
 
"BLD",3463,1,3,0)
 
"BLD",3463,1,4,0)
Routines:
"BLD",3463,1,5,0)
MAG7UCFG    new value = 21073435
"BLD",3463,1,6,0)
MAG7UD      new value = 4685901
"BLD",3463,1,7,0)
MAGDHLE     new value = 10197843
"BLD",3463,1,8,0)
MAGDHLI     new value = 5220582
"BLD",3463,1,9,0)
MAGDHLL     new value = 7511757
"BLD",3463,1,10,0)
MAGDHLS     new value = 67817009
"BLD",3463,1,11,0)
MAGDHLSO    new value = 9961335
"BLD",3463,1,12,0)
MAGDHLSV    new value = 49332835
"BLD",3463,1,13,0)
MAGDHLT     new value = 5153872
"BLD",3463,1,14,0)
MAGDHLTA    new value = 23848932
"BLD",3463,1,15,0)
MAGDHLTC    new value = 20360006
"BLD",3463,1,16,0)
MAGDHPS     new value = 35750729
"BLD",3463,1,17,0)
MAGDHRC0    new value = 7768511
"BLD",3463,1,18,0)
MAGDHW0     new value = 9185901
"BLD",3463,1,19,0)
MAGDHWA     new value = 45705303
"BLD",3463,1,20,0)
MAGDHWR     new value = 7473279
"BLD",3463,1,21,0)
MAGDIR8A    new value = 35665323
"BLD",3463,1,22,0)
MAGDIR8R    new value = 55950540
"BLD",3463,1,23,0)
MAGDIR9A    new value = 60148803
"BLD",3463,1,24,0)
MAGDRA2     new value = 28718021
"BLD",3463,1,25,0)
MAGDRA3     new value = 6846608
"BLD",3463,1,26,0)
MAGDRAHL    new value = 8520421
"BLD",3463,1,27,0)
MAGDRPC1    new value = 46610398
"BLD",3463,1,28,0)
MAGDRPC3    new value = 57242503
"BLD",3463,1,29,0)
MAGDRPC4    new value = 61111180
"BLD",3463,1,30,0)
MAGDRPC9    new value = 55355495
"BLD",3463,1,31,0)
MAGDRUID    new value = 4073143
"BLD",3463,1,32,0)
MAGENV49    new value = 6706010
"BLD",3463,1,33,0)
MAGIPS49    new value = 10146824
"BLD",3463,1,34,0)
 
"BLD",3463,1,35,0)
Please note that routine MAGIPS49 is deleted after the KIDS Build is
"BLD",3463,1,36,0)
installed.
"BLD",3463,4,0)
^9.64PA^2006.563^5
"BLD",3463,6.3)
V3.0p49Build2033_T32
"BLD",3463,4,2006.1,0)
2006.1
"BLD",3463,4,2006.1,2,0)
^9.641^2006.1^1
"BLD",3463,4,2006.1,2,2006.1,0)
IMAGING SITE PARAMETERS  (File-top level)
"BLD",3463,4,2006.1,2,2006.1,1,0)
^9.6411^3.01^1
"BLD",3463,4,2006.1,2,2006.1,1,3.01,0)
IHE PACS HL7 INTERFACE ACTIVE
"BLD",3463,4,2006.1,222)
y^y^p^^^^n^^n
"BLD",3463,4,2006.1,224)

"BLD",3463,4,2006.15,0)
2006.15
"BLD",3463,4,2006.15,222)
y^y^f^^^^n
"BLD",3463,4,2006.55,0)
2006.55
"BLD",3463,4,2006.55,222)
y^y^f^^^^n^^n
"BLD",3463,4,2006.55,224)

"BLD",3463,4,2006.56,0)
2006.56
"BLD",3463,4,2006.56,222)
y^y^f^^^^n
"BLD",3463,4,2006.563,0)
2006.563
"BLD",3463,4,2006.563,222)
y^y^f^^^^n
"BLD",3463,4,"APDD",2006.1,2006.1)

"BLD",3463,4,"APDD",2006.1,2006.1)

"BLD",3463,4,"APDD",2006.1,2006.1,3.01)

"BLD",3463,4,"B",2006.1,2006.1)

"BLD",3463,4,"B",2006.15,2006.15)

"BLD",3463,4,"B",2006.55,2006.55)

"BLD",3463,4,"B",2006.56,2006.56)

"BLD",3463,4,"B",2006.563,2006.563)

"BLD",3463,"ABNS",0)
^9.66A^^
"BLD",3463,"ABPKG")
n^n^G.IMAGING DEVELOPMENT TEAM@DOMAIN.EXT
"BLD",3463,"INID")
y^y^n
"BLD",3463,"INIT")
POST^MAGIPS49
"BLD",3463,"KRN",0)
^9.67PA^8994^19
"BLD",3463,"KRN",.4,0)
.4
"BLD",3463,"KRN",.4,"NM",0)
^9.68A^^
"BLD",3463,"KRN",.401,0)
.401
"BLD",3463,"KRN",.401,"NM",0)
^9.68A^^
"BLD",3463,"KRN",.402,0)
.402
"BLD",3463,"KRN",.402,"NM",0)
^9.68A^^
"BLD",3463,"KRN",.403,0)
.403
"BLD",3463,"KRN",.5,0)
.5
"BLD",3463,"KRN",.84,0)
.84
"BLD",3463,"KRN",.84,"NM",0)
^9.68A^^
"BLD",3463,"KRN",3.6,0)
3.6
"BLD",3463,"KRN",3.8,0)
3.8
"BLD",3463,"KRN",9.2,0)
9.2
"BLD",3463,"KRN",9.8,0)
9.8
"BLD",3463,"KRN",9.8,"NM",0)
^9.68A^28^28
"BLD",3463,"KRN",9.8,"NM",1,0)
MAG7UCFG^^0^B21073435
"BLD",3463,"KRN",9.8,"NM",2,0)
MAG7UD^^0^B4685901
"BLD",3463,"KRN",9.8,"NM",3,0)
MAGDHLE^^0^B10197843
"BLD",3463,"KRN",9.8,"NM",4,0)
MAGDHLI^^0^B5220582
"BLD",3463,"KRN",9.8,"NM",5,0)
MAGDHLL^^0^B7511757
"BLD",3463,"KRN",9.8,"NM",6,0)
MAGDHLS^^0^B67817009
"BLD",3463,"KRN",9.8,"NM",7,0)
MAGDHLSO^^0^B9961335
"BLD",3463,"KRN",9.8,"NM",8,0)
MAGDHLSV^^0^B49332835
"BLD",3463,"KRN",9.8,"NM",9,0)
MAGDHLT^^0^B5153872
"BLD",3463,"KRN",9.8,"NM",10,0)
MAGDHLTA^^0^B23848932
"BLD",3463,"KRN",9.8,"NM",11,0)
MAGDHLTC^^0^B20360006
"BLD",3463,"KRN",9.8,"NM",12,0)
MAGDHPS^^0^B35750729
"BLD",3463,"KRN",9.8,"NM",13,0)
MAGDHRC0^^0^B7768511
"BLD",3463,"KRN",9.8,"NM",14,0)
MAGDHW0^^0^B9185901
"BLD",3463,"KRN",9.8,"NM",15,0)
MAGDHWA^^0^B45705303
"BLD",3463,"KRN",9.8,"NM",16,0)
MAGDHWR^^0^B7473279
"BLD",3463,"KRN",9.8,"NM",17,0)
MAGDIR8A^^0^B35665323
"BLD",3463,"KRN",9.8,"NM",18,0)
MAGDIR8R^^0^B55950540
"BLD",3463,"KRN",9.8,"NM",19,0)
MAGDIR9A^^0^B60148803
"BLD",3463,"KRN",9.8,"NM",20,0)
MAGDRA2^^0^B28718021
"BLD",3463,"KRN",9.8,"NM",21,0)
MAGDRA3^^0^B6846608
"BLD",3463,"KRN",9.8,"NM",22,0)
MAGDRAHL^^0^B8520421
"BLD",3463,"KRN",9.8,"NM",23,0)
MAGDRPC1^^0^B46610398
"BLD",3463,"KRN",9.8,"NM",24,0)
MAGDRPC3^^0^B57242503
"BLD",3463,"KRN",9.8,"NM",25,0)
MAGDRPC4^^0^B61111180
"BLD",3463,"KRN",9.8,"NM",26,0)
MAGDRPC9^^0^B55355495
"BLD",3463,"KRN",9.8,"NM",27,0)
MAGDRUID^^0^B4073143
"BLD",3463,"KRN",9.8,"NM",28,0)
MAGENV49^^0^B6706010
"BLD",3463,"KRN",9.8,"NM","B","MAG7UCFG",1)

"BLD",3463,"KRN",9.8,"NM","B","MAG7UD",2)

"BLD",3463,"KRN",9.8,"NM","B","MAGDHLE",3)

"BLD",3463,"KRN",9.8,"NM","B","MAGDHLI",4)

"BLD",3463,"KRN",9.8,"NM","B","MAGDHLL",5)

"BLD",3463,"KRN",9.8,"NM","B","MAGDHLS",6)

"BLD",3463,"KRN",9.8,"NM","B","MAGDHLSO",7)

"BLD",3463,"KRN",9.8,"NM","B","MAGDHLSV",8)

"BLD",3463,"KRN",9.8,"NM","B","MAGDHLT",9)

"BLD",3463,"KRN",9.8,"NM","B","MAGDHLTA",10)

"BLD",3463,"KRN",9.8,"NM","B","MAGDHLTC",11)

"BLD",3463,"KRN",9.8,"NM","B","MAGDHPS",12)

"BLD",3463,"KRN",9.8,"NM","B","MAGDHRC0",13)

"BLD",3463,"KRN",9.8,"NM","B","MAGDHW0",14)

"BLD",3463,"KRN",9.8,"NM","B","MAGDHWA",15)

"BLD",3463,"KRN",9.8,"NM","B","MAGDHWR",16)

"BLD",3463,"KRN",9.8,"NM","B","MAGDIR8A",17)

"BLD",3463,"KRN",9.8,"NM","B","MAGDIR8R",18)

"BLD",3463,"KRN",9.8,"NM","B","MAGDIR9A",19)

"BLD",3463,"KRN",9.8,"NM","B","MAGDRA2",20)

"BLD",3463,"KRN",9.8,"NM","B","MAGDRA3",21)

"BLD",3463,"KRN",9.8,"NM","B","MAGDRAHL",22)

"BLD",3463,"KRN",9.8,"NM","B","MAGDRPC1",23)

"BLD",3463,"KRN",9.8,"NM","B","MAGDRPC3",24)

"BLD",3463,"KRN",9.8,"NM","B","MAGDRPC4",25)

"BLD",3463,"KRN",9.8,"NM","B","MAGDRPC9",26)

"BLD",3463,"KRN",9.8,"NM","B","MAGDRUID",27)

"BLD",3463,"KRN",9.8,"NM","B","MAGENV49",28)

"BLD",3463,"KRN",19,0)
19
"BLD",3463,"KRN",19,"NM",0)
^9.68A^4^4
"BLD",3463,"KRN",19,"NM",1,0)
MAG CONFIGURE IHE PACS HL7 I/F^^0
"BLD",3463,"KRN",19,"NM",2,0)
MAG HL7 MAINT^^0
"BLD",3463,"KRN",19,"NM",3,0)
MAG SYS MENU^^2
"BLD",3463,"KRN",19,"NM",4,0)
MAGD MAINT RAD HL7 SUBS^^0
"BLD",3463,"KRN",19,"NM","B","MAG CONFIGURE IHE PACS HL7 I/F",1)

"BLD",3463,"KRN",19,"NM","B","MAG HL7 MAINT",2)

"BLD",3463,"KRN",19,"NM","B","MAG SYS MENU",3)

"BLD",3463,"KRN",19,"NM","B","MAGD MAINT RAD HL7 SUBS",4)

"BLD",3463,"KRN",19.1,0)
19.1
"BLD",3463,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",3463,"KRN",101,0)
101
"BLD",3463,"KRN",101,"NM",0)
^9.68A^12^12
"BLD",3463,"KRN",101,"NM",1,0)
MAG CPACS A01^^0
"BLD",3463,"KRN",101,"NM",2,0)
MAG CPACS A01 SUBS^^0
"BLD",3463,"KRN",101,"NM",3,0)
MAG CPACS A02^^0
"BLD",3463,"KRN",101,"NM",4,0)
MAG CPACS A02 SUBS^^0
"BLD",3463,"KRN",101,"NM",5,0)
MAG CPACS A03^^0
"BLD",3463,"KRN",101,"NM",6,0)
MAG CPACS A03 SUBS^^0
"BLD",3463,"KRN",101,"NM",7,0)
MAG CPACS A11^^0
"BLD",3463,"KRN",101,"NM",8,0)
MAG CPACS A11 SUBS^^0
"BLD",3463,"KRN",101,"NM",9,0)
MAG CPACS A12^^0
"BLD",3463,"KRN",101,"NM",10,0)
MAG CPACS A12 SUBS^^0
"BLD",3463,"KRN",101,"NM",11,0)
MAG CPACS A13^^0
"BLD",3463,"KRN",101,"NM",12,0)
MAG CPACS A13 SUBS^^0
"BLD",3463,"KRN",101,"NM","B","MAG CPACS A01",1)

"BLD",3463,"KRN",101,"NM","B","MAG CPACS A01 SUBS",2)

"BLD",3463,"KRN",101,"NM","B","MAG CPACS A02",3)

"BLD",3463,"KRN",101,"NM","B","MAG CPACS A02 SUBS",4)

"BLD",3463,"KRN",101,"NM","B","MAG CPACS A03",5)

"BLD",3463,"KRN",101,"NM","B","MAG CPACS A03 SUBS",6)

"BLD",3463,"KRN",101,"NM","B","MAG CPACS A11",7)

"BLD",3463,"KRN",101,"NM","B","MAG CPACS A11 SUBS",8)

"BLD",3463,"KRN",101,"NM","B","MAG CPACS A12",9)

"BLD",3463,"KRN",101,"NM","B","MAG CPACS A12 SUBS",10)

"BLD",3463,"KRN",101,"NM","B","MAG CPACS A13",11)

"BLD",3463,"KRN",101,"NM","B","MAG CPACS A13 SUBS",12)

"BLD",3463,"KRN",409.61,0)
409.61
"BLD",3463,"KRN",771,0)
771
"BLD",3463,"KRN",771,"NM",0)
^9.68A^2^2
"BLD",3463,"KRN",771,"NM",1,0)
MAG COMRCL PACS^^0
"BLD",3463,"KRN",771,"NM",2,0)
MAG VISTA IMGNG^^0
"BLD",3463,"KRN",771,"NM","B","MAG COMRCL PACS",1)

"BLD",3463,"KRN",771,"NM","B","MAG VISTA IMGNG",2)

"BLD",3463,"KRN",870,0)
870
"BLD",3463,"KRN",870,"NM",0)
^9.68A^1^1
"BLD",3463,"KRN",870,"NM",1,0)
MAG CPACS^^0
"BLD",3463,"KRN",870,"NM","B","MAG CPACS",1)

"BLD",3463,"KRN",8989.51,0)
8989.51
"BLD",3463,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",3463,"KRN",8989.52,0)
8989.52
"BLD",3463,"KRN",8994,0)
8994
"BLD",3463,"KRN",8994,"NM",0)
^9.68A^1^1
"BLD",3463,"KRN",8994,"NM",1,0)
MAG DICOM GET PATIENT VITALS^^0
"BLD",3463,"KRN",8994,"NM","B","MAG DICOM GET PATIENT VITALS",1)

"BLD",3463,"KRN","B",.4,.4)

"BLD",3463,"KRN","B",.401,.401)

"BLD",3463,"KRN","B",.402,.402)

"BLD",3463,"KRN","B",.403,.403)

"BLD",3463,"KRN","B",.5,.5)

"BLD",3463,"KRN","B",.84,.84)

"BLD",3463,"KRN","B",3.6,3.6)

"BLD",3463,"KRN","B",3.8,3.8)

"BLD",3463,"KRN","B",9.2,9.2)

"BLD",3463,"KRN","B",9.8,9.8)

"BLD",3463,"KRN","B",19,19)

"BLD",3463,"KRN","B",19.1,19.1)

"BLD",3463,"KRN","B",101,101)

"BLD",3463,"KRN","B",409.61,409.61)

"BLD",3463,"KRN","B",771,771)

"BLD",3463,"KRN","B",870,870)

"BLD",3463,"KRN","B",8989.51,8989.51)

"BLD",3463,"KRN","B",8989.52,8989.52)

"BLD",3463,"KRN","B",8994,8994)

"BLD",3463,"PRE")
MAGENV49
"BLD",3463,"REQB",0)
^9.611^2^2
"BLD",3463,"REQB",1,0)
MAG*3.0*66^2
"BLD",3463,"REQB",2,0)
RA*5.0*47^2
"BLD",3463,"REQB","B","MAG*3.0*66",1)

"BLD",3463,"REQB","B","RA*5.0*47",2)

"FIA",2006.1)
IMAGING SITE PARAMETERS
"FIA",2006.1,0)
^MAG(2006.1,
"FIA",2006.1,0,0)
2006.1P
"FIA",2006.1,0,1)
y^y^p^^^^n^^n
"FIA",2006.1,0,10)

"FIA",2006.1,0,11)

"FIA",2006.1,0,"RLRO")

"FIA",2006.1,2006.1)
1
"FIA",2006.1,2006.1,3.01)

"FIA",2006.15)
DICOM UID ROOT
"FIA",2006.15,0)
^MAGD(2006.15,
"FIA",2006.15,0,0)
2006.15
"FIA",2006.15,0,1)
y^y^f^^^^n
"FIA",2006.15,0,10)

"FIA",2006.15,0,11)

"FIA",2006.15,0,"RLRO")

"FIA",2006.15,2006.15)
0
"FIA",2006.55)
DICOM WORKLIST PATIENT
"FIA",2006.55,0)
^MAGDWLST(2006.55,
"FIA",2006.55,0,0)
2006.55P
"FIA",2006.55,0,1)
y^y^f^^^^n^^n
"FIA",2006.55,0,10)

"FIA",2006.55,0,11)

"FIA",2006.55,0,"RLRO")

"FIA",2006.55,2006.55)
0
"FIA",2006.55,2006.552)
0
"FIA",2006.55,2006.5522)
0
"FIA",2006.55,2006.553)
0
"FIA",2006.55,2006.5533)
0
"FIA",2006.56)
DICOM WORKLIST STUDY
"FIA",2006.56,0)
^MAGDWLST(2006.56,
"FIA",2006.56,0,0)
2006.56P
"FIA",2006.56,0,1)
y^y^f^^^^n
"FIA",2006.56,0,10)

"FIA",2006.56,0,11)

"FIA",2006.56,0,"RLRO")

"FIA",2006.56,2006.56)
0
"FIA",2006.56,2006.562)
0
"FIA",2006.56,2006.5621)
0
"FIA",2006.56,2006.5622)
0
"FIA",2006.56,2006.5623)
0
"FIA",2006.56,2006.5624)
0
"FIA",2006.563)
DICOM GATEWAY PARAMETER
"FIA",2006.563,0)
^MAGDICOM(2006.563,
"FIA",2006.563,0,0)
2006.563
"FIA",2006.563,0,1)
y^y^f^^^^n
"FIA",2006.563,0,10)

"FIA",2006.563,0,11)

"FIA",2006.563,0,"RLRO")

"FIA",2006.563,2006.563)
0
"FIA",2006.563,2006.5631)
0
"FIA",2006.563,2006.5632)
0
"FIA",2006.563,2006.5633)
0
"FIA",2006.563,2006.5634)
0
"FIA",2006.563,2006.5635)
0
"INIT")
POST^MAGIPS49
"IX",2006.56,2006.562,"C",0)
2006.562^C^Study and Service^R^^R^IR^I^2006.562^^^^^LS
"IX",2006.56,2006.562,"C",.1,0)
^^3^3^3001204^
"IX",2006.56,2006.562,"C",.1,1,0)
This cross reference keeps track of which accessions
"IX",2006.56,2006.562,"C",.1,2,0)
were perfromed 
"IX",2006.56,2006.562,"C",.1,3,0)
for which services.
"IX",2006.56,2006.562,"C",1)
S ^MAGDWLST(2006.56,DA(1),1,"C",X(1),X(2),DA)=""
"IX",2006.56,2006.562,"C",2)
K ^MAGDWLST(2006.56,DA(1),1,"C",X(1),X(2),DA)
"IX",2006.56,2006.562,"C",2.5)
K ^MAGDWLST(2006.56,DA(1),1,"C")
"IX",2006.56,2006.562,"C",11.1,0)
^.114IA^2^2
"IX",2006.56,2006.562,"C",11.1,1,0)
1^F^2006.562^.01^^1^F
"IX",2006.56,2006.562,"C",11.1,2,0)
2^F^2006.562^3^^2^F
"IX",2006.56,2006.562,"D",0)
2006.562^D^Service and Study ID^R^^R^IR^I^2006.562^^^^^LS
"IX",2006.56,2006.562,"D",.1,0)
^^2^2^3001204^
"IX",2006.56,2006.562,"D",.1,1,0)
This cross reference keeps track of which Study IDs are
"IX",2006.56,2006.562,"D",.1,2,0)
performed for which services.
"IX",2006.56,2006.562,"D",1)
S ^MAGDWLST(2006.56,DA(1),1,"D",X(1),X(2),DA)=""
"IX",2006.56,2006.562,"D",2)
K ^MAGDWLST(2006.56,DA(1),1,"D",X(1),X(2),DA)
"IX",2006.56,2006.562,"D",2.5)
K ^MAGDWLST(2006.56,DA(1),1,"D")
"IX",2006.56,2006.562,"D",11.1,0)
^.114IA^2^2
"IX",2006.56,2006.562,"D",11.1,1,0)
1^F^2006.562^.01^^1^F
"IX",2006.56,2006.562,"D",11.1,2,0)
2^F^2006.562^4^^2^F
"IX",2006.56,2006.562,"E",0)
2006.562^E^Service, timestamp and Modality^R^^R^IR^I^2006.562^^^^^LS
"IX",2006.56,2006.562,"E",.1,0)
^^2^2^3001204^
"IX",2006.56,2006.562,"E",.1,1,0)
This cross reference keeps track of which modalities have
"IX",2006.56,2006.562,"E",.1,2,0)
studies performed for which services.
"IX",2006.56,2006.562,"E",1)
S ^MAGDWLST(2006.56,DA(1),1,"E",X(1),X(2),X(3),DA)=""
"IX",2006.56,2006.562,"E",2)
K ^MAGDWLST(2006.56,DA(1),1,"E",X(1),X(2),X(3),DA)
"IX",2006.56,2006.562,"E",2.5)
K ^MAGDWLST(2006.56,DA(1),1,"E")
"IX",2006.56,2006.562,"E",11.1,0)
^.114IA^3^3
"IX",2006.56,2006.562,"E",11.1,1,0)
1^F^2006.562^.01^^1^F
"IX",2006.56,2006.562,"E",11.1,1,3)

"IX",2006.56,2006.562,"E",11.1,2,0)
2^F^2006.562^10^^2^F
"IX",2006.56,2006.562,"E",11.1,2,3)

"IX",2006.56,2006.562,"E",11.1,3,0)
3^F^2006.562^5^^3^F
"IX",2006.56,2006.562,"E",11.1,3,3)

"IX",2006.56,2006.562,"G",0)
2006.562^G^Services and modalities^R^^R^IR^I^2006.562^^^^^LS
"IX",2006.56,2006.562,"G",.1,0)
^^4^4^3030114^
"IX",2006.56,2006.562,"G",.1,1,0)
This cross reference keeps track of studies by:
"IX",2006.56,2006.562,"G",.1,2,0)
 1. service
"IX",2006.56,2006.562,"G",.1,3,0)
 2. modality code
"IX",2006.56,2006.562,"G",.1,4,0)
 3. timestamp
"IX",2006.56,2006.562,"G",1)
S ^MAGDWLST(2006.56,DA(1),1,"G",X(1),X(2),X(3),DA)=""
"IX",2006.56,2006.562,"G",2)
K ^MAGDWLST(2006.56,DA(1),1,"G",X(1),X(2),X(3),DA)
"IX",2006.56,2006.562,"G",2.5)
K ^MAGDWLST(2006.56,DA(1),1,"G")
"IX",2006.56,2006.562,"G",11.1,0)
^.114IA^3^3
"IX",2006.56,2006.562,"G",11.1,1,0)
1^F^2006.562^.01^^1^F
"IX",2006.56,2006.562,"G",11.1,1,3)

"IX",2006.56,2006.562,"G",11.1,2,0)
2^F^2006.562^10^^2^F
"IX",2006.56,2006.562,"G",11.1,2,3)

"IX",2006.56,2006.562,"G",11.1,3,0)
3^F^2006.562^5^^3^F
"IX",2006.56,2006.562,"G",11.1,3,3)

"IX",2006.56,2006.562,"H",0)
2006.562^H^Accession Number and Service^R^^R^IR^I^2006.562^^^^^LS
"IX",2006.56,2006.562,"H",.1,0)
^^1^1^3090813^
"IX",2006.56,2006.562,"H",.1,1,0)
This cross reference tracks the accession number by service.
"IX",2006.56,2006.562,"H",1)
S ^MAGDWLST(2006.56,DA(1),1,"H",$E(X(1),1,30),$E(X(2),1,30),DA)=""
"IX",2006.56,2006.562,"H",2)
K ^MAGDWLST(2006.56,DA(1),1,"H",$E(X(1),1,30),$E(X(2),1,30),DA)
"IX",2006.56,2006.562,"H",2.5)
K ^MAGDWLST(2006.56,DA(1),1,"H")
"IX",2006.56,2006.562,"H",11.1,0)
^.114IA^2^2
"IX",2006.56,2006.562,"H",11.1,1,0)
1^F^2006.562^.01^30^1^F
"IX",2006.56,2006.562,"H",11.1,1,3)

"IX",2006.56,2006.562,"H",11.1,2,0)
2^F^2006.562^25^30^2^F
"IX",2006.56,2006.562,"H",11.1,2,3)

"KRN",19,123457,-1)
0^1
"KRN",19,123457,0)
MAG CONFIGURE IHE PACS HL7 I/F^Configure IHE-Based HL7 Interface to PACS^^R^^^^^^^y^IMAGING
"KRN",19,123457,1,0)
^^3^3^3060127^
"KRN",19,123457,1,1,0)
This option allows the user to specify sender and receiver names 
"KRN",19,123457,1,2,0)
associated with the IHE-based interface for sending HL7 ADT messages to 
"KRN",19,123457,1,3,0)
commercial PACS and to the DICOM/Text Gateway.
"KRN",19,123457,25)
CONFIG^MAG7UCFG
"KRN",19,123457,"U")
CONFIGURE IHE-BASED HL7 INTERF
"KRN",19,123458,-1)
0^2
"KRN",19,123458,1,1,0)
This option provides a menu of selections to perform maintenance on HL7 
"KRN",19,123458,1,2,0)
messaging interfaces between the VistA HIS, the VistA Text/DICOM Gateway, 
"KRN",19,123458,1,3,0)
and commercial imaging systems.
"KRN",19,123458,10,1,0)
22405^RHL7^10
"KRN",19,123458,10,1,"^")
MAGD MAINT RAD HL7 SUBS
"KRN",19,123458,0)
MAG HL7 MAINT^Imaging HL7 Messaging Maintenance^^M^^^^^^^^IMAGING
"KRN",19,123458,1,0)
^19.06^3^3^3060127^^^
"KRN",19,123458,1,1,0)
This option provides a menu of selections to perform maintenance on HL7 
"KRN",19,123458,1,2,0)
messaging interfaces between the VistA HIS, the VistA Text/DICOM Gateway, 
"KRN",19,123458,1,3,0)
and commercial imaging systems.
"KRN",19,123458,10,0)
^19.01IP^2^2
"KRN",19,123458,10,1,0)
22405^RHL7^10
"KRN",19,123458,10,1,"^")
MAGD MAINT RAD HL7 SUBS
"KRN",19,123458,10,2,0)
22406^IHE
"KRN",19,123458,10,2,"^")
MAG CONFIGURE IHE PACS HL7 I/F
"KRN",19,123458,99)
60292,35243
"KRN",19,123458,"U")
IMAGING HL7 MESSAGING MAINTENA
"KRN",19,123459,-1)
2^3
"KRN",19,123459,10,15,0)
22404^HL7^7
"KRN",19,123459,10,15,"^")
MAG HL7 MAINT
"KRN",19,123459,0)
MAG SYS MENU^Imaging System Manager Menu^^M^133^MAG SYSTEM^^^^^^454
"KRN",19,123459,10,0)
^19.01IP^15^14
"KRN",19,123459,10,15,0)
22404^HL7^7
"KRN",19,123459,10,15,"^")
MAG HL7 MAINT
"KRN",19,123459,"U")
IMAGING SYSTEM MANAGER MENU
"KRN",19,123460,-1)
0^4
"KRN",19,123460,1,1,0)
This option allows the user to select the version of HL7 that will be 
"KRN",19,123460,1,2,0)
used to create Radiology messages to the VistA Text/DICOM Gateway and to 
"KRN",19,123460,1,3,0)
commercial imaging systems.
"KRN",19,123460,0)
MAGD MAINT RAD HL7 SUBS^Maintain Subscriptions to Radiology HL7 Drivers^^R^^^^^^^^
"KRN",19,123460,1,0)
^^3^3^3051222^
"KRN",19,123460,1,1,0)
This option allows the user to select the version of HL7 that will be 
"KRN",19,123460,1,2,0)
used to create Radiology messages to the VistA Text/DICOM Gateway and to 
"KRN",19,123460,1,3,0)
commercial imaging systems.
"KRN",19,123460,25)
MAINT^MAGDHPS
"KRN",19,123460,"U")
MAINTAIN SUBSCRIPTIONS TO RADI
"KRN",101,123461,-1)
0^1
"KRN",101,123461,0)
MAG CPACS A01^^^E^^^^^^^^
"KRN",101,123461,1,0)
^^2^2^3060120^
"KRN",101,123461,1,1,0)
This protocol generates headers for IHE-based inpatient admission 
"KRN",101,123461,1,2,0)
messages to be delivered to a commercial PACS system by VistA Imaging.
"KRN",101,123461,770)
MAG VISTA IMGNG^^ADT^A01^^^^^^2.4^
"KRN",101,123461,775,0)
^101.0775PA^1^1
"KRN",101,123461,775,1,0)
5681
"KRN",101,123461,775,1,"^")
MAG CPACS A01 SUBS
"KRN",101,123462,-1)
0^2
"KRN",101,123462,0)
MAG CPACS A01 SUBS^^^S^^^^^^^^
"KRN",101,123462,1,0)
^^2^2^3060120^
"KRN",101,123462,1,1,0)
This protocol routes inpatient admission messages to a commercial PACS 
"KRN",101,123462,1,2,0)
system.
"KRN",101,123462,770)
^MAG COMRCL PACS^^A01^^^MAG CPACS^^^^ACK
"KRN",101,123463,-1)
0^3
"KRN",101,123463,0)
MAG CPACS A02^^^E^^^^^^^^
"KRN",101,123463,1,0)
^101.06^2^2^3060120^^
"KRN",101,123463,1,1,0)
This protocol generates the header for patient transfer messages to be 
"KRN",101,123463,1,2,0)
delivered to a commercial PACS system by VistA Imaging.
"KRN",101,123463,770)
MAG VISTA IMGNG^^ADT^A02^2^D^^^^2.4^
"KRN",101,123463,775,0)
^101.0775PA^1^1
"KRN",101,123463,775,1,0)
5664
"KRN",101,123463,775,1,"^")
MAG CPACS A02 SUBS
"KRN",101,123464,-1)
0^4
"KRN",101,123464,0)
MAG CPACS A02 SUBS^^^S^^^^^^^^
"KRN",101,123464,1,0)
^^2^2^3060120^
"KRN",101,123464,1,1,0)
This protocol routes patient transfer messages to a commercial PACS 
"KRN",101,123464,1,2,0)
system.
"KRN",101,123464,770)
^MAG COMRCL PACS^^A02^^^MAG CPACS^^^^ACK
"KRN",101,123465,-1)
0^5
"KRN",101,123465,0)
MAG CPACS A03^^^E^^^^^^^^
"KRN",101,123465,1,0)
^^2^2^3060120^
"KRN",101,123465,1,1,0)
This protocol generates headers for IHE-based patient discharge/end visit 
"KRN",101,123465,1,2,0)
messages to be delivered to a commercial PACS system by VistA Imaging.
"KRN",101,123465,770)
MAG VISTA IMGNG^^ADT^A03^3^^^^^2.4^
"KRN",101,123465,775,0)
^101.0775PA^1^1
"KRN",101,123465,775,1,0)
5674
"KRN",101,123465,775,1,"^")
MAG CPACS A03 SUBS
"KRN",101,123466,-1)
0^6
"KRN",101,123466,0)
MAG CPACS A03 SUBS^^^S^^^^^^^^
"KRN",101,123466,1,0)
^^2^2^3060120^
"KRN",101,123466,1,1,0)
This protocol routes inpatient patient discharge/end visit messages to a 
"KRN",101,123466,1,2,0)
commercial PACS system.
"KRN",101,123466,770)
^MAG COMRCL PACS^^A03^^^MAG CPACS^^^^ACK
"KRN",101,123467,-1)
0^7
"KRN",101,123467,0)
MAG CPACS A11^^^E^^^^^^^^
"KRN",101,123467,1,0)
^^2^2^3061018^
"KRN",101,123467,1,1,0)
This protocol initializes the A11 message to be sent from VistA Imaging 
"KRN",101,123467,1,2,0)
to commercial PACS.
"KRN",101,123467,770)
MAG VISTA IMGNG^^ADT^A11^^^^^^2.4^
"KRN",101,123467,775,0)
^101.0775PA^1^1
"KRN",101,123467,775,1,0)
6259
"KRN",101,123467,775,1,"^")
MAG CPACS A11 SUBS
"KRN",101,123468,-1)
0^8
"KRN",101,123468,0)
MAG CPACS A11 SUBS^^^S^^^^^^^^
"KRN",101,123468,1,0)
^^2^2^3090318^
"KRN",101,123468,1,1,0)
This protocol routes admission cancellation messages to a commercial PACS 
"KRN",101,123468,1,2,0)
system.
"KRN",101,123468,770)
^MAG COMRCL PACS^^A11^^^MAG CPACS^^^^ACK
"KRN",101,123468,773)
1^1
"KRN",101,123469,-1)
0^9
"KRN",101,123469,0)
MAG CPACS A12^^^E^^^^^^^^
"KRN",101,123469,1,0)
^^2^2^3060126^
"KRN",101,123469,1,1,0)
This protocol generates headers for IHE-based transfer cancellation
"KRN",101,123469,1,2,0)
messages to be delivered to a commercial PACS system by VistA Imaging.
"KRN",101,123469,770)
MAG VISTA IMGNG^^ADT^A12^^^^^^2.4^
"KRN",101,123469,775,0)
^101.0775PA^1^1
"KRN",101,123469,775,1,0)
5686
"KRN",101,123469,775,1,"^")
MAG CPACS A12 SUBS
"KRN",101,123470,-1)
0^10
"KRN",101,123470,0)
MAG CPACS A12 SUBS^^^S^^^^^^^^
"KRN",101,123470,1,0)
^^2^2^3060126^
"KRN",101,123470,1,1,0)
This protocol routes transfer cancellation messages to a commercial PACS 
"KRN",101,123470,1,2,0)
system.
"KRN",101,123470,770)
^MAG COMRCL PACS^^A12^^^MAG CPACS^^^^ACK
"KRN",101,123471,-1)
0^11
"KRN",101,123471,0)
MAG CPACS A13^^^E^^^^^^^^
"KRN",101,123471,1,0)
^^3^3^3060126^
"KRN",101,123471,1,1,0)
This protocol generates headers for IHE-based inpatient discharge
"KRN",101,123471,1,2,0)
cancellation messages to be delivered to a commercial PACS system by VistA
"KRN",101,123471,1,3,0)
Imaging.
"KRN",101,123471,770)
MAG VISTA IMGNG^^ADT^A13^^^^^^2.4^
"KRN",101,123471,775,0)
^101.0775PA^1^1
"KRN",101,123471,775,1,0)
5688
"KRN",101,123471,775,1,"^")
MAG CPACS A13 SUBS
"KRN",101,123472,-1)
0^12
"KRN",101,123472,0)
MAG CPACS A13 SUBS^^^S^^^^^^^^
"KRN",101,123472,1,0)
^^3^3^3060126^
"KRN",101,123472,1,1,0)
This protocol routes inpatient discharge
"KRN",101,123472,1,2,0)
cancellation messages to a commercial PACS
"KRN",101,123472,1,3,0)
system.
"KRN",101,123472,770)
^MAG COMRCL PACS^^A13^^^MAG CPACS^^^^ACK
"KRN",771,123473,-1)
0^1
"KRN",771,123473,0)
MAG COMRCL PACS^a^CPACS FACILITY^^^^US
"KRN",771,123474,-1)
0^2
"KRN",771,123474,0)
MAG VISTA IMGNG^a^VA-WOIFO^^^^US
"KRN",771,123474,"FS")

"KRN",870,123475,-1)
0^1
"KRN",870,123475,0)
MAG CPACS^^TCP^^^^^^^^^^^^^^^^^^10
"KRN",870,123475,200)
^^^90^90
"KRN",870,123475,400)
^^C^^^
"KRN",8994,123476,-1)
0^1
"KRN",8994,123476,0)
MAG DICOM GET PATIENT VITALS^GETPAT^MAGDHWR^2^R^0^^0^3
"KRN",8994,123476,1,0)
^^6^6^3061023^
"KRN",8994,123476,1,1,0)
This Remote Procedure returns some information about a patient.
"KRN",8994,123476,1,2,0)
At this time, the values returned are
"KRN",8994,123476,1,3,0)
   VIP-code
"KRN",8994,123476,1,4,0)
   Height
"KRN",8994,123476,1,5,0)
   Weight
"KRN",8994,123476,1,6,0)
This list may be extended in the future.
"KRN",8994,123476,2,0)
^8994.02A^1^1
"KRN",8994,123476,2,1,0)
DFN^1^20^1^1
"KRN",8994,123476,2,1,1,0)
^^2^2^3061023^
"KRN",8994,123476,2,1,1,1,0)
The value of this parameter is the VA-defined DFN patient identifier.
"KRN",8994,123476,2,1,1,2,0)
This is the internal entry number for the patient at the local hospital.
"KRN",8994,123476,2,"B","DFN",1)

"KRN",8994,123476,2,"PARAMSEQ",1,1)

"KRN",8994,123476,3,0)
^^10^10^3061023^
"KRN",8994,123476,3,1,0)
The return parameter for this procedure is an array.
"KRN",8994,123476,3,2,0)
If the procedure encounters an error, the value of
"KRN",8994,123476,3,3,0)
   OUT(1) is:
"KRN",8994,123476,3,4,0)
          a negative number, followed by an explanation
"KRN",8994,123476,3,5,0)
 
"KRN",8994,123476,3,6,0)
If the procedure completes successfully, the array contains values
"KRN",8994,123476,3,7,0)
that provide values for some vital statistics of the patient, e.g.:
"KRN",8994,123476,3,8,0)
   OUT(1)="HEIGHT^190.50^cm^centimeter"
"KRN",8994,123476,3,9,0)
   OUT(2)="WEIGHT^104.55^kg^kilogram"
"KRN",8994,123476,3,10,0)
   OUT(3)="VIP^"
"MBREQ")
0
"ORD",13,870)
870;13;1;;HLLL^XPDTA1;;HLLLE^XPDIA1;;;HLLLDEL^XPDIA1(%)
"ORD",13,870,0)
HL LOGICAL LINK
"ORD",14,771)
771;14;;;HLAP^XPDTA1;HLAPF1^XPDIA1;HLAPE1^XPDIA1;HLAPF2^XPDIA1;;HLAPDEL^XPDIA1(%)
"ORD",14,771,0)
HL7 APPLICATION PARAMETER
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",454,-1)
1^1
"PKG",454,0)
IMAGING^MAG^Imaging Release History
"PKG",454,22,0)
^9.49I^1^1
"PKG",454,22,1,0)
3.0^3020328^3020328^.5
"PKG",454,22,1,"PAH",1,0)
49^3110407^.5
"PKG",454,22,1,"PAH",1,1,0)
^9.49011^35^35^3110407
"PKG",454,22,1,"PAH",1,1,1,0)
Routines for Patch 49, Test Build 32.
"PKG",454,22,1,"PAH",1,1,2,0)
 
"PKG",454,22,1,"PAH",1,1,3,0)
Routines:
"PKG",454,22,1,"PAH",1,1,4,0)
MAG7UCFG    value = 8010888
"PKG",454,22,1,"PAH",1,1,5,0)
MAG7UD      value = 3154695
"PKG",454,22,1,"PAH",1,1,6,0)
MAGDHLE     value = 5022942
"PKG",454,22,1,"PAH",1,1,7,0)
MAGDHLI     value = 3542011
"PKG",454,22,1,"PAH",1,1,8,0)
MAGDHLL     value = 4260332
"PKG",454,22,1,"PAH",1,1,9,0)
MAGDHLS     value = 13291597
"PKG",454,22,1,"PAH",1,1,10,0)
MAGDHLSO    value = 4951039
"PKG",454,22,1,"PAH",1,1,11,0)
MAGDHLSV    value = 15085746
"PKG",454,22,1,"PAH",1,1,12,0)
MAGDHLT     value = 3638769
"PKG",454,22,1,"PAH",1,1,13,0)
MAGDHLTA    value = 7653532
"PKG",454,22,1,"PAH",1,1,14,0)
MAGDHLTC    value = 6732337
"PKG",454,22,1,"PAH",1,1,15,0)
MAGDHPS     value = 10198148
"PKG",454,22,1,"PAH",1,1,16,0)
MAGDHRC0    value = 4547517
"PKG",454,22,1,"PAH",1,1,17,0)
MAGDHW0     value = 4192697
"PKG",454,22,1,"PAH",1,1,18,0)
MAGDHWA     value = 11046156
"PKG",454,22,1,"PAH",1,1,19,0)
MAGDHWR     value = 4356893
"PKG",454,22,1,"PAH",1,1,20,0)
MAGDIR8A    value = 10347815
"PKG",454,22,1,"PAH",1,1,21,0)
MAGDIR8R    value = 11916565
"PKG",454,22,1,"PAH",1,1,22,0)
MAGDIR9A    value = 13157136
"PKG",454,22,1,"PAH",1,1,23,0)
MAGDRA2     value = 8580195
"PKG",454,22,1,"PAH",1,1,24,0)
MAGDRA3     value = 4189221
"PKG",454,22,1,"PAH",1,1,25,0)
MAGDRAHL    value = 4739804
"PKG",454,22,1,"PAH",1,1,26,0)
MAGDRPC1    value = 9912701
"PKG",454,22,1,"PAH",1,1,27,0)
MAGDRPC3    value = 13481361
"PKG",454,22,1,"PAH",1,1,28,0)
MAGDRPC4    value = 14864088
"PKG",454,22,1,"PAH",1,1,29,0)
MAGDRPC9    value = 12920297
"PKG",454,22,1,"PAH",1,1,30,0)
MAGDRUID    value = 2900467
"PKG",454,22,1,"PAH",1,1,31,0)
MAGENV49    value = 4103690
"PKG",454,22,1,"PAH",1,1,32,0)
MAGIPS49    value = 5298688
"PKG",454,22,1,"PAH",1,1,33,0)
 
"PKG",454,22,1,"PAH",1,1,34,0)
Please note that routine MAGIPS49 is deleted after the KIDS Build is
"PKG",454,22,1,"PAH",1,1,35,0)
installed.
"PRE")
MAGENV49
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
29
"RTN","MAG7UCFG")
0^1^B21073435
"RTN","MAG7UCFG",1,0)
MAG7UCFG ;WOIFO/MLH - Configure HL7 PACS interface ; 02 Apr 2008 4:29 PM
"RTN","MAG7UCFG",2,0)
 ;;3.0;IMAGING;**49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAG7UCFG",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAG7UCFG",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAG7UCFG",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAG7UCFG",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAG7UCFG",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAG7UCFG",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAG7UCFG",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAG7UCFG",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAG7UCFG",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAG7UCFG",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAG7UCFG",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAG7UCFG",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAG7UCFG",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAG7UCFG",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAG7UCFG",17,0)
 ;;
"RTN","MAG7UCFG",18,0)
 Q
"RTN","MAG7UCFG",19,0)
 ;
"RTN","MAG7UCFG",20,0)
CONFIG ; MAIN ENTRY POINT - Configure the HL7 PACS interface
"RTN","MAG7UCFG",21,0)
 ; Allow user to specify sender and receiver names, and to toggle
"RTN","MAG7UCFG",22,0)
 ; the interface between active/inactive.
"RTN","MAG7UCFG",23,0)
 ; 
"RTN","MAG7UCFG",24,0)
 ; Called by Option MAG CONFIGURE IHE PACS HL7 I/F.
"RTN","MAG7UCFG",25,0)
 ; 
"RTN","MAG7UCFG",26,0)
 N DA,DIC,DIE,DIQ,DR,DTOUT,DUOUT ; -- FileMan work variables
"RTN","MAG7UCFG",27,0)
 N APP ; ------ work array for DIQ application lookups
"RTN","MAG7UCFG",28,0)
 N SNDIX ; ---- IEN of the sending application
"RTN","MAG7UCFG",29,0)
 N SNDNAME ; -- name of the sending application
"RTN","MAG7UCFG",30,0)
 N RCVIX ; ---- IEN of the receiving application
"RTN","MAG7UCFG",31,0)
 N RCVNAME ; -- name of the receiving application
"RTN","MAG7UCFG",32,0)
 N LINKIX ; --- IEN of the logical link
"RTN","MAG7UCFG",33,0)
 ;
"RTN","MAG7UCFG",34,0)
 W !!,"HL7 PACS Interface Configuration",!!
"RTN","MAG7UCFG",35,0)
 ;
"RTN","MAG7UCFG",36,0)
 ; Look up the sending application
"RTN","MAG7UCFG",37,0)
 S DIC="^ORD(101,",X="MAG CPACS A01",DIC(0)="X"
"RTN","MAG7UCFG",38,0)
 D ^DIC I Y<0 D  G ABEND
"RTN","MAG7UCFG",39,0)
 . W !,"ERROR:  HL7 messaging event driver protocol(s) missing."
"RTN","MAG7UCFG",40,0)
 . Q
"RTN","MAG7UCFG",41,0)
 K APP S DIQ="APP",DIQ(0)="I",DIC="^ORD(101,",DA=$P(Y,U,1),DR=770.1
"RTN","MAG7UCFG",42,0)
 D EN^DIQ1 S SNDIX=$G(APP(101,DA,770.1,"I"))
"RTN","MAG7UCFG",43,0)
 I SNDIX'>0 D  G ABEND
"RTN","MAG7UCFG",44,0)
 . W !,"ERROR:  No sending application defined."
"RTN","MAG7UCFG",45,0)
 . Q
"RTN","MAG7UCFG",46,0)
 ; Look up sender name directly in application file - this allows
"RTN","MAG7UCFG",47,0)
 ; us to catch a missing pointer
"RTN","MAG7UCFG",48,0)
 K APP S DIQ="APP",DIQ(0)="IE",DIC="^HL(771,",DA=SNDIX,DR=.01
"RTN","MAG7UCFG",49,0)
 D EN^DIQ1 I '$D(APP) D  G ABEND
"RTN","MAG7UCFG",50,0)
 . W !,"ERROR:  Pointed-to sender entry ("_DA_") missing"
"RTN","MAG7UCFG",51,0)
 . W !,"        from HL7 APPLICATION PARAMETER File (#771)."
"RTN","MAG7UCFG",52,0)
 . Q
"RTN","MAG7UCFG",53,0)
 S SNDNAME=$G(APP(771,DA,.01,"E"))
"RTN","MAG7UCFG",54,0)
 ;
"RTN","MAG7UCFG",55,0)
 ; Look up the receiving application
"RTN","MAG7UCFG",56,0)
 S DIC="^ORD(101,",X="MAG CPACS A01 SUBS",DIC(0)="X"
"RTN","MAG7UCFG",57,0)
 D ^DIC I Y<0 D  G ABEND
"RTN","MAG7UCFG",58,0)
 . W !,"ERROR:  HL7 messaging subscriber protocol(s) missing."
"RTN","MAG7UCFG",59,0)
 . Q
"RTN","MAG7UCFG",60,0)
 K APP S DIQ="APP",DIQ(0)="I",DIC="^ORD(101,",DA=$P(Y,U,1),DR=770.2
"RTN","MAG7UCFG",61,0)
 D EN^DIQ1 S RCVIX=$G(APP(101,DA,770.2,"I"))
"RTN","MAG7UCFG",62,0)
 I RCVIX'>0 D  G ABEND
"RTN","MAG7UCFG",63,0)
 . W !,"ERROR:  No receiving application defined."
"RTN","MAG7UCFG",64,0)
 . Q
"RTN","MAG7UCFG",65,0)
 ; Look up receiver name directly in application file - this allows
"RTN","MAG7UCFG",66,0)
 ; us to catch a missing pointer
"RTN","MAG7UCFG",67,0)
 K APP S DIQ="APP",DIQ(0)="IE",DIC="^HL(771,",DA=RCVIX,DR=.01
"RTN","MAG7UCFG",68,0)
 D EN^DIQ1 I '$D(APP) D  G ABEND
"RTN","MAG7UCFG",69,0)
 . W !,"ERROR:  Pointed-to receiver entry ("_DA_") missing"
"RTN","MAG7UCFG",70,0)
 . W !,"        from HL7 APPLICATION PARAMETER File (#771)."
"RTN","MAG7UCFG",71,0)
 . Q
"RTN","MAG7UCFG",72,0)
 S RCVNAME=$G(APP(771,DA,.01,"E"))
"RTN","MAG7UCFG",73,0)
 ;
"RTN","MAG7UCFG",74,0)
 W !,"Sending application name:    "_SNDNAME,!
"RTN","MAG7UCFG",75,0)
 W "Receiving application name:  "_RCVNAME,!
"RTN","MAG7UCFG",76,0)
 S DIR("A")="Do you wish to change either of these names? ",DIR(0)="YA"
"RTN","MAG7UCFG",77,0)
 D ^DIR G END:$D(DTOUT),END:$D(DUOUT)
"RTN","MAG7UCFG",78,0)
 I Y D  G END:$D(DTOUT),END:$D(Y)
"RTN","MAG7UCFG",79,0)
 . W !!,"Please enter the name of the SENDING application."
"RTN","MAG7UCFG",80,0)
 . S DIE="^HL(771,",DA=SNDIX,DR=.01 D ^DIE Q:$D(DTOUT)  Q:$D(Y)
"RTN","MAG7UCFG",81,0)
 . W !,"Please enter the name of the RECEIVING application."
"RTN","MAG7UCFG",82,0)
 . S DIE="^HL(771,",DA=RCVIX,DR=.01 D ^DIE Q:$D(DTOUT)  Q:$D(Y)
"RTN","MAG7UCFG",83,0)
 . Q
"RTN","MAG7UCFG",84,0)
 ;
"RTN","MAG7UCFG",85,0)
 ; Look up the logical link
"RTN","MAG7UCFG",86,0)
 S DIC="^HLCS(870,",X="MAG CPACS",DIC(0)="X"
"RTN","MAG7UCFG",87,0)
 D ^DIC I Y<0 D  G ABEND
"RTN","MAG7UCFG",88,0)
 . W !,"ERROR:  HL7 logical link missing."
"RTN","MAG7UCFG",89,0)
 . Q
"RTN","MAG7UCFG",90,0)
 D  G END:$D(DTOUT),END:$D(Y) ; update link information
"RTN","MAG7UCFG",91,0)
 . S LINKIX=+Y
"RTN","MAG7UCFG",92,0)
 . W !!,"Please enter the TCP/IP address and port number for the logical link."
"RTN","MAG7UCFG",93,0)
 . S DIE="^HLCS(870,",DA=LINKIX,DR="400.01;400.02" D ^DIE Q:$D(DTOUT)  Q:$D(Y)
"RTN","MAG7UCFG",94,0)
 . Q
"RTN","MAG7UCFG",95,0)
 ;
"RTN","MAG7UCFG",96,0)
 ; Toggle the interface
"RTN","MAG7UCFG",97,0)
 W !!,"Enter Y or YES below to turn the IHE-based HL7 PACS interface ON;",!
"RTN","MAG7UCFG",98,0)
 W "enter N or NO to turn the interface OFF.",!
"RTN","MAG7UCFG",99,0)
 S DIE="^MAG(2006.1,",DA=1,DR=3.01 D ^DIE Q:$D(DTOUT)  Q:$D(Y)
"RTN","MAG7UCFG",100,0)
 G END
"RTN","MAG7UCFG",101,0)
 ;
"RTN","MAG7UCFG",102,0)
ABEND ;
"RTN","MAG7UCFG",103,0)
 W !,"PACS HL7 messaging must be installed before using this option."
"RTN","MAG7UCFG",104,0)
 W !,"Please contact Imaging Support for further assistance."
"RTN","MAG7UCFG",105,0)
END ;
"RTN","MAG7UCFG",106,0)
 Q
"RTN","MAG7UD")
0^2^B4685901
"RTN","MAG7UD",1,0)
MAG7UD ;WOIFO/MLH - Imaging - HL7 - utilities - dates ; 11/15/2006 08:35
"RTN","MAG7UD",2,0)
 ;;3.0;IMAGING;**49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAG7UD",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAG7UD",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAG7UD",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAG7UD",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAG7UD",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAG7UD",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAG7UD",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAG7UD",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAG7UD",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAG7UD",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAG7UD",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAG7UD",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAG7UD",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAG7UD",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAG7UD",17,0)
 ;;
"RTN","MAG7UD",18,0)
 Q
"RTN","MAG7UD",19,0)
 ;
"RTN","MAG7UD",20,0)
STRIP0(XDATELOC) ; FUNCTION - strip zeros off HL7 dates
"RTN","MAG7UD",21,0)
 ; input:  XDATELOC   variable containing any 8-digit HL7 date with or w/o TZ offset (+/-ZZZZ)
"RTN","MAG7UD",22,0)
 ; function return:   always 0 (success)
"RTN","MAG7UD",23,0)
 ; 
"RTN","MAG7UD",24,0)
 N MAGDATE ; -- working date
"RTN","MAG7UD",25,0)
 N OFSGN ; ---- offset sign
"RTN","MAG7UD",26,0)
 N TZ ; ------- time zone offset
"RTN","MAG7UD",27,0)
 ;
"RTN","MAG7UD",28,0)
 ; '*' for offset sign means there isn't one, but the date is valid
"RTN","MAG7UD",29,0)
 S MAGDATE=@XDATELOC
"RTN","MAG7UD",30,0)
 S OFSGN=$S(MAGDATE?1.N1"-"1.N:"-",MAGDATE?1.N1"+"1.N:"+",MAGDATE?1.N:"*",1:"")
"RTN","MAG7UD",31,0)
 I OFSGN="" Q ""
"RTN","MAG7UD",32,0)
 S TZ=$P(MAGDATE,OFSGN,2),MAGDATE=$P(MAGDATE,OFSGN,1)
"RTN","MAG7UD",33,0)
 I MAGDATE?6N1"00" S MAGDATE=MAGDATE/100
"RTN","MAG7UD",34,0)
 I MAGDATE?4N1"00" S MAGDATE=MAGDATE/100
"RTN","MAG7UD",35,0)
 S @XDATELOC=MAGDATE_$S(OFSGN'="*":OFSGN,1:"")_TZ
"RTN","MAG7UD",36,0)
 Q 0 ; success always
"RTN","MAGDHLE")
0^3^B10197843
"RTN","MAGDHLE",1,0)
MAGDHLE ;WOIFO/SRR - PACS INTERFACE PID TRIGGERS ; 04 Jan 2011 8:38 AM
"RTN","MAGDHLE",2,0)
 ;;3.0;IMAGING;**54,49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGDHLE",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDHLE",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHLE",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDHLE",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDHLE",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDHLE",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDHLE",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDHLE",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDHLE",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDHLE",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDHLE",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDHLE",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDHLE",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDHLE",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHLE",17,0)
 ;;
"RTN","MAGDHLE",18,0)
SET ;Set Logic from MUMPS x-ref on fields .01,.03,.09 of ^DD(2 (^DPT)
"RTN","MAGDHLE",19,0)
 ;Kill logic: S MAGKPID=X for all 3 fields
"RTN","MAGDHLE",20,0)
 ;IN - MAGKPID = old value
"RTN","MAGDHLE",21,0)
 ;   - MAGKTYP = Message type (from field)
"RTN","MAGDHLE",22,0)
 Q
"RTN","MAGDHLE",23,0)
 ;
"RTN","MAGDHLE",24,0)
KIL ;Kill logic "AKn" cross references
"RTN","MAGDHLE",25,0)
 Q
"RTN","MAGDHLE",26,0)
 ;
"RTN","MAGDHLE",27,0)
ADT ;ADT EVENTS ;From EVENT driver
"RTN","MAGDHLE",28,0)
 ;Protocol = MAGD DHCP-PACS ADT EVENTS
"RTN","MAGDHLE",29,0)
 ;IN ;DFN
"RTN","MAGDHLE",30,0)
 ;DGPMDA = IFN Primary Movement
"RTN","MAGDHLE",31,0)
 ;DGPMA = 0th node Primary Movement AFTER movement
"RTN","MAGDHLE",32,0)
 ;DGPMP = 0th node PRIOR to movement
"RTN","MAGDHLE",33,0)
 ;^UTILITY("DGPM",$J,TRANSACTION (1,2,3,6),MOVEMENT (IFN),"P"/"A")
"RTN","MAGDHLE",34,0)
 ;
"RTN","MAGDHLE",35,0)
 K MAGKTYP F I=1,2,3 I $D(^UTILITY("DGPM",$J,I,DGPMDA)) S MAGKTYP=I
"RTN","MAGDHLE",36,0)
 Q:'$D(MAGKTYP)  I MAGKTYP=2,$P(^UTILITY("DGPM",$J,2,DGPMDA,"A"),U,6)=$P(^("P"),U,6) G EX
"RTN","MAGDHLE",37,0)
TSK ;CREATE TASK to make HL7 messages
"RTN","MAGDHLE",38,0)
 S ZTSAVE("MAGKTYP")="",ZTSAVE("MAGDPTCL")=""
"RTN","MAGDHLE",39,0)
 S ZTSAVE("DGPMDA")="",ZTSAVE("DGNOW")="",ZTSAVE("DGPMA")=""
"RTN","MAGDHLE",40,0)
 S ZTSAVE("DFN")="",ZTSAVE("DGPMT")="",ZTDTH=$H,ZTIO=""
"RTN","MAGDHLE",41,0)
 S ZTRTN="HL7^MAGDHLE",ZTDESC=$S(MAGKTYP=8:"PID",1:"ADT")_" HL7 PACS MESSAGE"
"RTN","MAGDHLE",42,0)
 W !?5,"*** HL7 TASK FOR PACS ***"
"RTN","MAGDHLE",43,0)
 D @$S($$PROD^XUPROD:"^%ZTLOAD",1:"HL7^"_$T(+0)) ; enable debugging in development
"RTN","MAGDHLE",44,0)
 G EX
"RTN","MAGDHLE",45,0)
 ;
"RTN","MAGDHLE",46,0)
HL7 ;Create HL7 message
"RTN","MAGDHLE",47,0)
 I $P($G(^MAG(2006.1,1,"IHE")),"^",1)="Y" G ADT^MAGDHLI
"RTN","MAGDHLE",48,0)
 Q:'$D(^DPT(DFN,0))
"RTN","MAGDHLE",49,0)
 S N0=^DPT(DFN,0),HLNDAP="PACS GATEWAY",HLMTN="ADT"
"RTN","MAGDHLE",50,0)
 D INIT^HLTRANS
"RTN","MAGDHLE",51,0)
 D EVN,PID,NK1,PV1 K N0,N1 D EN^MAGDHL7T,KILL^HLTRANS
"RTN","MAGDHLE",52,0)
 ;D EN^HLTRANS,KILL^HLTRANS
"RTN","MAGDHLE",53,0)
EX ;EXIT
"RTN","MAGDHLE",54,0)
 K ZTRTN,ZTDESC,ZTIO,ZTDTH,ZTSAVE
"RTN","MAGDHLE",55,0)
 K MAGKPID,MAGKTYP
"RTN","MAGDHLE",56,0)
 Q
"RTN","MAGDHLE",57,0)
 ;
"RTN","MAGDHLE",58,0)
EVN ;EVENT SEGMENT
"RTN","MAGDHLE",59,0)
 S HLSDATA(2)="EVN^"_$P($T(ETYP+MAGKTYP),";",3)_"^"_$$HLDATE^HLFNC(DT)
"RTN","MAGDHLE",60,0)
 Q
"RTN","MAGDHLE",61,0)
PID ;PID SEGMENT
"RTN","MAGDHLE",62,0)
 I '$P(N0,U,9) S N0=^DPT(DFN,0)
"RTN","MAGDHLE",63,0)
 S $P(N1,U,1,7)="PID^^^"_$$M11^HLFNC(DFN)_"^^"_$$HLNAME^HLFNC($P(N0,U))_"^^"_$$HLDATE^HLFNC($P(N0,U,3))_"^"_$P(N0,U,2)
"RTN","MAGDHLE",64,0)
 S $P(N1,U,20)=$P(N0,U,9),HLSDATA(3)=N1
"RTN","MAGDHLE",65,0)
 Q
"RTN","MAGDHLE",66,0)
 ;
"RTN","MAGDHLE",67,0)
NK1 ;NEXT OF KIN
"RTN","MAGDHLE",68,0)
 S HLSDATA(4)="NK1^"
"RTN","MAGDHLE",69,0)
 Q
"RTN","MAGDHLE",70,0)
PV1 ;PV1 SEGMENT
"RTN","MAGDHLE",71,0)
 S HLSDATA(5)="PV1^^"_$S($D(^DPT(DFN,.1)):"I",1:"O")_"^"_$G(^DPT(DFN,.1))
"RTN","MAGDHLE",72,0)
 Q
"RTN","MAGDHLE",73,0)
 ;
"RTN","MAGDHLE",74,0)
ETYP ;EVENT TYPE; for later possible use
"RTN","MAGDHLE",75,0)
 ;;A01;ADMIT
"RTN","MAGDHLE",76,0)
 ;;A02;TRANSFER
"RTN","MAGDHLE",77,0)
 ;;A03;DISCHARGE
"RTN","MAGDHLE",78,0)
 ;;A04;REGISTER
"RTN","MAGDHLE",79,0)
 ;;A05;PRE-ADMIT
"RTN","MAGDHLE",80,0)
 ;;A06;TRANSFER OUT/IN
"RTN","MAGDHLE",81,0)
 ;;A07;TRANSFER IN/OUT
"RTN","MAGDHLE",82,0)
 ;;A08;UPDATE PATIENT INFORMATION
"RTN","MAGDHLE",83,0)
 Q
"RTN","MAGDHLE",84,0)
HLDT1 ;TEMP FIX FOR HLTRANS UNDEF
"RTN","MAGDHLE",85,0)
 Q
"RTN","MAGDHLE",86,0)
FIX ;
"RTN","MAGDHLE",87,0)
 Q
"RTN","MAGDHLI")
0^4^B5220582
"RTN","MAGDHLI",1,0)
MAGDHLI ;WOIFO/MLH - IHE-based ADT interface for PACS ; 01 Jun 2009 2:32 PM
"RTN","MAGDHLI",2,0)
 ;;3.0;IMAGING;**49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGDHLI",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDHLI",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHLI",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDHLI",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDHLI",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDHLI",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDHLI",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDHLI",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDHLI",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDHLI",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDHLI",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDHLI",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDHLI",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDHLI",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHLI",17,0)
 ;;
"RTN","MAGDHLI",18,0)
 Q
"RTN","MAGDHLI",19,0)
 ;
"RTN","MAGDHLI",20,0)
ADT ; MAIN ENTRY POINT - Generate the appropriate ADT message.
"RTN","MAGDHLI",21,0)
 N STAT ; status of HL7 message generation
"RTN","MAGDHLI",22,0)
 N OCCURRED ; date/time the event occurred (from DGPMA)
"RTN","MAGDHLI",23,0)
 ;
"RTN","MAGDHLI",24,0)
 I DGPMT=1 D  Q  ; admission
"RTN","MAGDHLI",25,0)
 . S OCCURRED=$P($G(DGPMA),"^",1)
"RTN","MAGDHLI",26,0)
 . S STAT=$S(OCCURRED:$$A01^MAGDHLT(DFN,OCCURRED),1:$$A11^MAGDHLT(DFN,DGNOW))
"RTN","MAGDHLI",27,0)
 . Q
"RTN","MAGDHLI",28,0)
 I DGPMT=2 D  Q  ; transfer
"RTN","MAGDHLI",29,0)
 . S OCCURRED=$P($G(DGPMA),"^",1)
"RTN","MAGDHLI",30,0)
 . S STAT=$S(OCCURRED:$$A02^MAGDHLT(DFN,OCCURRED),1:$$A12^MAGDHLT(DFN,DGNOW))
"RTN","MAGDHLI",31,0)
 . Q
"RTN","MAGDHLI",32,0)
 I DGPMT=3 D  Q  ; discharge
"RTN","MAGDHLI",33,0)
 . S OCCURRED=$P($G(DGPMA),"^",1)
"RTN","MAGDHLI",34,0)
 . S STAT=$S(OCCURRED:$$A03^MAGDHLT(DFN,OCCURRED),1:$$A13^MAGDHLT(DFN,DGNOW))
"RTN","MAGDHLI",35,0)
 . Q
"RTN","MAGDHLI",36,0)
 Q
"RTN","MAGDHLL")
0^5^B7511757
"RTN","MAGDHLL",1,0)
MAGDHLL ;WOIFO/MLH - IHE-based ADT interface for PACS - log to gateway ; 11/15/2006 08:36
"RTN","MAGDHLL",2,0)
 ;;3.0;IMAGING;**49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGDHLL",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDHLL",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHLL",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDHLL",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDHLL",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDHLL",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDHLL",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDHLL",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDHLL",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDHLL",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDHLL",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDHLL",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDHLL",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDHLL",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHLL",17,0)
 ;;
"RTN","MAGDHLL",18,0)
 Q
"RTN","MAGDHLL",19,0)
 ;
"RTN","MAGDHLL",20,0)
LOGGW(XTYP) ; SUBROUTINE - log a generated message to the DICOM/text gateway
"RTN","MAGDHLL",21,0)
 ; input:    XTYP      message type (= MSH-9.1)
"RTN","MAGDHLL",22,0)
 ; expects:  HL()      array of HL7 variables
"RTN","MAGDHLL",23,0)
 ;           HLHDR()   array containing MSH segment info
"RTN","MAGDHLL",24,0)
 ;           HLA()     array of HL7 segments
"RTN","MAGDHLL",25,0)
 ;
"RTN","MAGDHLL",26,0)
 N MSGDT ; ----- message date and time from MSH-7 (in HL7 format)
"RTN","MAGDHLL",27,0)
 N MSGDFM ; ---- MSGDT date only (no time) in FileMan format
"RTN","MAGDHLL",28,0)
 N MSGDTFM ; --- MSGDT date and time in FileMan format
"RTN","MAGDHLL",29,0)
 N GWIX ; ------ gateway message index
"RTN","MAGDHLL",30,0)
 N GWHDR ; ----- 0 node of gateway message file
"RTN","MAGDHLL",31,0)
 N MSH ; ------- message header for gateway
"RTN","MAGDHLL",32,0)
 N GWSGIX ; ---- gateway segment index
"RTN","MAGDHLL",33,0)
 ;
"RTN","MAGDHLL",34,0)
 L +^MAGDHL7(2006.5,0):1E9 E  Q
"RTN","MAGDHLL",35,0)
 S GWIX=$O(^MAGDHL7(2006.5," "),-1)+1
"RTN","MAGDHLL",36,0)
 S GWHDR=$G(^MAGDHL7(2006.5,0))
"RTN","MAGDHLL",37,0)
 S $P(GWHDR,U,3)=GWIX,$P(GWHDR,U,4)=$P(GWHDR,U,4)+1
"RTN","MAGDHLL",38,0)
 S ^MAGDHL7(2006.5,0)=GWHDR
"RTN","MAGDHLL",39,0)
 S MSH=HLHDR(1),$P(MSH,HL("FS"),5)="VISTA DICOM/TEXT GATEWAY"
"RTN","MAGDHLL",40,0)
 S ^MAGDHL7(2006.5,GWIX,1,1,0)=MSH
"RTN","MAGDHLL",41,0)
 S IX=0,GWSGIX=1
"RTN","MAGDHLL",42,0)
 F I=1:1 S IX=$O(HLA("HLS",IX)) Q:'IX  D
"RTN","MAGDHLL",43,0)
 . S GWSGIX=GWSGIX+1
"RTN","MAGDHLL",44,0)
 . S ^MAGDHL7(2006.5,GWIX,1,GWSGIX,0)=HLA("HLS",IX)
"RTN","MAGDHLL",45,0)
 . Q
"RTN","MAGDHLL",46,0)
 S MSGDT=$P($P(HLHDR(1),HL("FS"),7),"-",1) ; omit TZ offset
"RTN","MAGDHLL",47,0)
 S MSGDFM=$E(MSGDT,1,8)-17000000
"RTN","MAGDHLL",48,0)
 S MSGDTFM=+(MSGDFM_"."_$E(MSGDT,9,12))
"RTN","MAGDHLL",49,0)
 S ^MAGDHL7(2006.5,GWIX,1,0)=U_U_GWSGIX_U_GWSGIX_U_MSGDFM
"RTN","MAGDHLL",50,0)
 S ^MAGDHL7(2006.5,GWIX,0)=MSGDFM_U_XTYP_U_MSGDTFM
"RTN","MAGDHLL",51,0)
 L -^MAGDHL7(2006.5,0)
"RTN","MAGDHLL",52,0)
 Q
"RTN","MAGDHLS")
0^6^B67817009
"RTN","MAGDHLS",1,0)
MAGDHLS ;WOIFO/MLH - IHE-based ADT interface for PACS - segments ; 23 Jul 2009 8:15 AM
"RTN","MAGDHLS",2,0)
 ;;3.0;IMAGING;**49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGDHLS",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDHLS",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHLS",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDHLS",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDHLS",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDHLS",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDHLS",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDHLS",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDHLS",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDHLS",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDHLS",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDHLS",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDHLS",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDHLS",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHLS",17,0)
 ;;
"RTN","MAGDHLS",18,0)
 Q
"RTN","MAGDHLS",19,0)
 ;
"RTN","MAGDHLS",20,0)
 ; It is always expected that the HL7 environment variables will have
"RTN","MAGDHLS",21,0)
 ; been initialized by a call to INIT^HLFNC2 for the appropriate event
"RTN","MAGDHLS",22,0)
 ; driver protocol.
"RTN","MAGDHLS",23,0)
 ; 
"RTN","MAGDHLS",24,0)
AL1(XDFN,XYMSG) ; patient allergies
"RTN","MAGDHLS",25,0)
 ; input:  XDFN      internal entry number of the patient on global ^DPT
"RTN","MAGDHLS",26,0)
 ;         XYMSG     name of array to which to add message elts
"RTN","MAGDHLS",27,0)
 ; output: @XYMSG    input array plus new subtree containing EVN elts
"RTN","MAGDHLS",28,0)
 ;         function return   0 (success) always
"RTN","MAGDHLS",29,0)
 ; 
"RTN","MAGDHLS",30,0)
 N DFN ; ------ internal entry number on ^DPT
"RTN","MAGDHLS",31,0)
 N IXAL ; ----- allergy index (on GMRAL array)
"RTN","MAGDHLS",32,0)
 N SETID ; ---- index of the AL1 segment on this message
"RTN","MAGDHLS",33,0)
 N ALDTA ; ---- allergy data
"RTN","MAGDHLS",34,0)
 N IXREAC ; --- reaction index
"RTN","MAGDHLS",35,0)
 N REPIX ; ---- field repetition index
"RTN","MAGDHLS",36,0)
 ;
"RTN","MAGDHLS",37,0)
 K YSEGA
"RTN","MAGDHLS",38,0)
 S DFN=XDFN D ^GMRADPT ; get patient's allergies
"RTN","MAGDHLS",39,0)
 S IXAL=0
"RTN","MAGDHLS",40,0)
 F SETID=1:1 S IXAL=$O(GMRAL(IXAL)) Q:'IXAL  D
"RTN","MAGDHLS",41,0)
 . S ALDTA=$G(GMRAL(IXAL))
"RTN","MAGDHLS",42,0)
 . S SEGIX=$O(@XYMSG@(" "),-1)+1
"RTN","MAGDHLS",43,0)
 . S @XYMSG@(SEGIX,0)="AL1"
"RTN","MAGDHLS",44,0)
 . S @XYMSG@(SEGIX,1,1,1,1)=SETID
"RTN","MAGDHLS",45,0)
 . S @XYMSG@(SEGIX,2,1,1,1)=$P(ALDTA,U,7) ; type
"RTN","MAGDHLS",46,0)
 . S @XYMSG@(SEGIX,3,1,2,1)=$P(ALDTA,U,2) ; description
"RTN","MAGDHLS",47,0)
 . S IXREAC=0
"RTN","MAGDHLS",48,0)
 . F REPIX=1:1 S IXREAC=$O(GMRAL(IXAL,"S",IXREAC)) Q:'IXREAC  D
"RTN","MAGDHLS",49,0)
 . . S @XYMSG@(SEGIX,5,REPIX,1,1)=$P($G(GMRAL(IXAL,"S",IXREAC)),";",1) ; reaction
"RTN","MAGDHLS",50,0)
 . . Q
"RTN","MAGDHLS",51,0)
 . Q
"RTN","MAGDHLS",52,0)
 Q 0
"RTN","MAGDHLS",53,0)
 ;
"RTN","MAGDHLS",54,0)
DG1(XDFN,XYMSG) ; FUNCTION - diagnosis
"RTN","MAGDHLS",55,0)
 ; input:  XDFN      internal entry number of the patient on global ^DPT
"RTN","MAGDHLS",56,0)
 ;         XYMSG     name of array to which to add message elts
"RTN","MAGDHLS",57,0)
 ; output: @XYMSG    input array plus new subtree containing EVN elts
"RTN","MAGDHLS",58,0)
 ;         function return   0 (success) always
"RTN","MAGDHLS",59,0)
 ;
"RTN","MAGDHLS",60,0)
 N DFN ; ----- internal entry number on ^DPT
"RTN","MAGDHLS",61,0)
 N VAIP ; ---- inpatient episode data array
"RTN","MAGDHLS",62,0)
 N SETID ; --- segment index for diagnoses
"RTN","MAGDHLS",63,0)
 N APROB ; --- problem list array
"RTN","MAGDHLS",64,0)
 N PROBIX ; -- problem list index
"RTN","MAGDHLS",65,0)
 ;
"RTN","MAGDHLS",66,0)
 S SETID=0 ; segment increment base
"RTN","MAGDHLS",67,0)
 S DFN=XDFN D IN5^VADPT ; get patient's inpatient episode data
"RTN","MAGDHLS",68,0)
 I $G(VAIP(9))'="" D  ; is there a diag assoc'd w/the latest movement?
"RTN","MAGDHLS",69,0)
 . ; yes, populate data for the DG1 segment
"RTN","MAGDHLS",70,0)
 . S SEGIX=$O(@XYMSG@(" "),-1)+1
"RTN","MAGDHLS",71,0)
 . S @XYMSG@(SEGIX,0)="DG1" ; segment ID
"RTN","MAGDHLS",72,0)
 . ; populate element leaves
"RTN","MAGDHLS",73,0)
 . S SETID=SETID+1
"RTN","MAGDHLS",74,0)
 . S @XYMSG@(SEGIX,1,1,1,1)=SETID
"RTN","MAGDHLS",75,0)
 . S @XYMSG@(SEGIX,3,1,2,1)=$E(VAIP(9),1,249) ; diagnosis text
"RTN","MAGDHLS",76,0)
 . ; either admitting or working diagnosis
"RTN","MAGDHLS",77,0)
 . S @XYMSG@(SEGIX,6,1,1,1)=$S($P($G(VAIP(2)),"^",1)=1:"A",1:"W")
"RTN","MAGDHLS",78,0)
 . Q
"RTN","MAGDHLS",79,0)
 ;
"RTN","MAGDHLS",80,0)
 ; get patient's active problem list
"RTN","MAGDHLS",81,0)
 D ACTIVE^GMPLUTL(XDFN,.APROB) ; DBIA #928
"RTN","MAGDHLS",82,0)
 S PROBIX=0
"RTN","MAGDHLS",83,0)
 F  S PROBIX=$O(APROB(PROBIX)) Q:'PROBIX  D
"RTN","MAGDHLS",84,0)
 . S SEGIX=$O(@XYMSG@(" "),-1)+1
"RTN","MAGDHLS",85,0)
 . S @XYMSG@(SEGIX,0)="DG1" ; segment ID
"RTN","MAGDHLS",86,0)
 . ; populate element leaves
"RTN","MAGDHLS",87,0)
 . S SETID=SETID+1
"RTN","MAGDHLS",88,0)
 . S @XYMSG@(SEGIX,1,1,1,1)=SETID
"RTN","MAGDHLS",89,0)
 . S @XYMSG@(SEGIX,3,1,2,1)=$E($P(APROB(PROBIX,1),"^",2),1,249) ; problem text
"RTN","MAGDHLS",90,0)
 . S @XYMSG@(SEGIX,6,1,1,1)="W" ; working diagnosis
"RTN","MAGDHLS",91,0)
 . Q
"RTN","MAGDHLS",92,0)
 ;
"RTN","MAGDHLS",93,0)
 Q 0
"RTN","MAGDHLS",94,0)
 ;
"RTN","MAGDHLS",95,0)
EVN(XEVENT,XEVNRDT,XEVNODT,XYMSG) ; FUNCTION - event
"RTN","MAGDHLS",96,0)
 ; input:  XEVENT   trigger event code
"RTN","MAGDHLS",97,0)
 ;         XEVNRDT  date/time the event was recorded (FM format)
"RTN","MAGDHLS",98,0)
 ;         XEVNODT  date/time the event occurred (FM format)
"RTN","MAGDHLS",99,0)
 ;         XYMSG    name of array to which to add message elts
"RTN","MAGDHLS",100,0)
 ; output: @XYMSG   input array plus new subtree containing EVN elts
"RTN","MAGDHLS",101,0)
 ;         function return   0 (success) always
"RTN","MAGDHLS",102,0)
 ; 
"RTN","MAGDHLS",103,0)
 N SEGIX ; ---- segment index on @XYMSG
"RTN","MAGDHLS",104,0)
 N STAT ; ----- status return from function calls
"RTN","MAGDHLS",105,0)
 N FLDIX ; ---- field index on @XYMSG
"RTN","MAGDHLS",106,0)
 ;
"RTN","MAGDHLS",107,0)
 S SEGIX=$O(@XYMSG@(" "),-1)+1
"RTN","MAGDHLS",108,0)
 S @XYMSG@(SEGIX,0)="EVN"
"RTN","MAGDHLS",109,0)
 ; populate trigger event code and dates into element leaves
"RTN","MAGDHLS",110,0)
 S @XYMSG@(SEGIX,1,1,1,1)=XEVENT
"RTN","MAGDHLS",111,0)
 S @XYMSG@(SEGIX,2,1,1,1)=$$FMTHL7^XLFDT(XEVNRDT)
"RTN","MAGDHLS",112,0)
 S @XYMSG@(SEGIX,6,1,1,1)=$$FMTHL7^XLFDT(XEVNODT)
"RTN","MAGDHLS",113,0)
 F FLDIX=2,6 S STAT=$$STRIP0^MAG7UD($NA(@XYMSG@(SEGIX,FLDIX,1,1,1)))
"RTN","MAGDHLS",114,0)
 Q 0
"RTN","MAGDHLS",115,0)
 ;
"RTN","MAGDHLS",116,0)
MRG(XMRGICN,XYMSG) ; FUNCTION - merge ICNs
"RTN","MAGDHLS",117,0)
 ; input:  XMRGICN   DFN being merged from
"RTN","MAGDHLS",118,0)
 ;         XYMSG     name of array to which to add MRG segment
"RTN","MAGDHLS",119,0)
 ; output: @XYMSG    input array plus new subtree containing MRG elts
"RTN","MAGDHLS",120,0)
 ;         function return   0 (success) always
"RTN","MAGDHLS",121,0)
 ;         
"RTN","MAGDHLS",122,0)
 N SEGIX ; ---- segment index on @XYMSG
"RTN","MAGDHLS",123,0)
 N STAT ; ----- status return from function calls
"RTN","MAGDHLS",124,0)
 ;
"RTN","MAGDHLS",125,0)
 S SEGIX=$O(@XYMSG@(" "),-1)+1
"RTN","MAGDHLS",126,0)
 S @XYMSG@(SEGIX,0)="MRG"
"RTN","MAGDHLS",127,0)
 ; populate ICN info into element leaves
"RTN","MAGDHLS",128,0)
 S @XYMSG@(SEGIX,1,1,1,1)=XMRGICN
"RTN","MAGDHLS",129,0)
 S @XYMSG@(SEGIX,1,1,4,1)="USVHA"
"RTN","MAGDHLS",130,0)
 S @XYMSG@(SEGIX,1,1,5,1)="NI"
"RTN","MAGDHLS",131,0)
 Q 0
"RTN","MAGDHLS",132,0)
 ;
"RTN","MAGDHLS",133,0)
OBXADT(XDFN,XYMSG) G OBXADT^MAGDHLSO ; FUNCTION - patient height/weight
"RTN","MAGDHLS",134,0)
 ;
"RTN","MAGDHLS",135,0)
PID(XDFN,XYMSG) ; FUNCTION - patient ID/demo
"RTN","MAGDHLS",136,0)
 ; input:  XDFN      internal entry number of the pt on gbl ^DPT
"RTN","MAGDHLS",137,0)
 ;         XYMSG    name of array to which to add message elts
"RTN","MAGDHLS",138,0)
 ; output: @XYMSG    input array plus new subtree containing PID elts
"RTN","MAGDHLS",139,0)
 ;         function return   0 (success) always
"RTN","MAGDHLS",140,0)
 ;
"RTN","MAGDHLS",141,0)
 N PIDARY ; --- array for segment to be returned by VistA HL7 fcn
"RTN","MAGDHLS",142,0)
 N HL ; ------- array containing delims, etc. expected by VistA HL7 fcn
"RTN","MAGDHLS",143,0)
 N MSGDMY ; --- dummy array of scalar message lines for parser
"RTN","MAGDHLS",144,0)
 N I ; -------- loop counter
"RTN","MAGDHLS",145,0)
 N IX,IX1,IX2,IX3,IX4 ; dummy indices
"RTN","MAGDHLS",146,0)
 N SEGIX ; ---- segment index on @XYMSG
"RTN","MAGDHLS",147,0)
 N NUL ; ------ null return from called function
"RTN","MAGDHLS",148,0)
 N MSGTREE ; -- tree of message elements to be returned by $$PARSE^MAG7UP
"RTN","MAGDHLS",149,0)
 N STATNUMB ; - station number
"RTN","MAGDHLS",150,0)
 N STAT ; ----- status return from function calls
"RTN","MAGDHLS",151,0)
 N PTICN ; ---- patient integration control number
"RTN","MAGDHLS",152,0)
 ;
"RTN","MAGDHLS",153,0)
 S HL("ECH")=HLECH,HL("FS")=HLFS,HL("Q")=HLQ
"RTN","MAGDHLS",154,0)
 S STATNUMB=$E($P($$NS^XUAF4($$KSP^XUPARAM("INST")),U,2),1,3) ; station number
"RTN","MAGDHLS",155,0)
 ; does pt have a national ICN?
"RTN","MAGDHLS",156,0)
 S PTICN=$$GETICN^MPIF001(XDFN) ; ICR #2701
"RTN","MAGDHLS",157,0)
 K:PTICN<0 PTICN ; no ICN exists
"RTN","MAGDHLS",158,0)
 K:$$IFLOCAL^MPIF001(XDFN)=1 PTICN ; ICR #2701 - ICN is local, not national
"RTN","MAGDHLS",159,0)
 ; build a dummy message including MSH, PID
"RTN","MAGDHLS",160,0)
 ; (MSH required for $$PARSE^MAG7UP to work)
"RTN","MAGDHLS",161,0)
 S MSGDMY(1)="MSH"_HLFS_HLECH
"RTN","MAGDHLS",162,0)
 S MSGDMY(2)=$$EN^VAFHLPID(XDFN,"5,7,8,10BN,11,19,22B"),IX=0 ; DBIA #263
"RTN","MAGDHLS",163,0)
 S NUL=$$PARSE^MAG7UP("MSGDMY","MSGTREE") ; parse the message
"RTN","MAGDHLS",164,0)
 ; purge patient identifiers PID-2 thru PID-4
"RTN","MAGDHLS",165,0)
 F IX=2,3,4 K MSGTREE(2,IX)
"RTN","MAGDHLS",166,0)
 ; assign station number-dfn to PID-2
"RTN","MAGDHLS",167,0)
 S MSGTREE(2,2,1,1,1)=STATNUMB_"-"_XDFN
"RTN","MAGDHLS",168,0)
 S MSGTREE(2,2,1,2,1)=""
"RTN","MAGDHLS",169,0)
 S MSGTREE(2,2,1,3,1)=""
"RTN","MAGDHLS",170,0)
 S MSGTREE(2,2,1,4,1)="USVHA"
"RTN","MAGDHLS",171,0)
 S MSGTREE(2,2,1,5,1)="PI"
"RTN","MAGDHLS",172,0)
 ; assign social security number to PID-3
"RTN","MAGDHLS",173,0)
 S MSGTREE(2,3,1,1,1)=MSGTREE(2,19,1,1,1)
"RTN","MAGDHLS",174,0)
 S MSGTREE(2,3,1,2,1)=""
"RTN","MAGDHLS",175,0)
 S MSGTREE(2,3,1,3,1)=""
"RTN","MAGDHLS",176,0)
 S MSGTREE(2,3,1,4,1)="USVHA"
"RTN","MAGDHLS",177,0)
 S MSGTREE(2,3,1,5,1)="NI"
"RTN","MAGDHLS",178,0)
 D:$D(PTICN)  ; use nat'l ICN (if available) as the alternate pt id in PID-4
"RTN","MAGDHLS",179,0)
 . S MSGTREE(2,4,1,1,1)=PTICN
"RTN","MAGDHLS",180,0)
 . S MSGTREE(2,4,1,2,1)="" ; no checksum (included in ICN)
"RTN","MAGDHLS",181,0)
 . S MSGTREE(2,4,1,3,1)="" ; no checksum (included in ICN)
"RTN","MAGDHLS",182,0)
 . S MSGTREE(2,4,1,4,1)="USVHA"
"RTN","MAGDHLS",183,0)
 . S MSGTREE(2,4,1,5,1)="NI"
"RTN","MAGDHLS",184,0)
 . Q
"RTN","MAGDHLS",185,0)
 ; strip suffix, if any, off race and ethnicity codes
"RTN","MAGDHLS",186,0)
 F IX1=10,22 D
"RTN","MAGDHLS",187,0)
 . S:$G(MSGTREE(2,IX1,1,1,1))["-" MSGTREE(2,IX1,1,1,1)=$P(MSGTREE(2,IX1,1,1,1),"-",1,2)
"RTN","MAGDHLS",188,0)
 . Q
"RTN","MAGDHLS",189,0)
 ; insert PID subtree into passed-in element array
"RTN","MAGDHLS",190,0)
 ; this code eliminates values on intermediate (i.e., non-leaf) nodes
"RTN","MAGDHLS",191,0)
 S SEGIX=$O(@XYMSG@(" "),-1)+1
"RTN","MAGDHLS",192,0)
 S @XYMSG@(SEGIX,0)="PID" ; segment tag
"RTN","MAGDHLS",193,0)
 S IX1=0 F  S IX1=$O(MSGTREE(2,IX1)) Q:'IX1  D
"RTN","MAGDHLS",194,0)
 . S IX2=0 F  S IX2=$O(MSGTREE(2,IX1,IX2)) Q:'IX2  D
"RTN","MAGDHLS",195,0)
 . . S IX3=0 F  S IX3=$O(MSGTREE(2,IX1,IX2,IX3)) Q:'IX3  D
"RTN","MAGDHLS",196,0)
 . . . S IX4=0 F  S IX4=$O(MSGTREE(2,IX1,IX2,IX3,IX4)) Q:'IX4  D
"RTN","MAGDHLS",197,0)
 . . . . S @XYMSG@(SEGIX,IX1,IX2,IX3,IX4)=MSGTREE(2,IX1,IX2,IX3,IX4)
"RTN","MAGDHLS",198,0)
 . . . . Q
"RTN","MAGDHLS",199,0)
 . . . Q
"RTN","MAGDHLS",200,0)
 . . Q
"RTN","MAGDHLS",201,0)
 . Q
"RTN","MAGDHLS",202,0)
 S STAT=$$STRIP0^MAG7UD($NA(@XYMSG@(SEGIX,7,1,1,1))) ; strip 0's off DOB
"RTN","MAGDHLS",203,0)
 Q 0
"RTN","MAGDHLS",204,0)
 ;
"RTN","MAGDHLS",205,0)
PV1(XDFN,XEVN,XEVNDT,XYMSG) G PV1^MAGDHLSV ; FUNCTION - patient visit
"RTN","MAGDHLS",206,0)
 ;
"RTN","MAGDHLS",207,0)
ROL(XDFN,XYMSG) ; FUNCTION role (for physicians) - propagate from PV1
"RTN","MAGDHLS",208,0)
 ; assumes PV1 segment is already populated
"RTN","MAGDHLS",209,0)
 ; 
"RTN","MAGDHLS",210,0)
 ; input:  XDFN      internal entry number of the pt on gbl ^DPT
"RTN","MAGDHLS",211,0)
 ;         XYMSG    name of array to which to add message elts
"RTN","MAGDHLS",212,0)
 ; output: @XYMSG    input array plus new subtree containing PID elts
"RTN","MAGDHLS",213,0)
 ;         function return   0 (success) always
"RTN","MAGDHLS",214,0)
 ;
"RTN","MAGDHLS",215,0)
 N PRCTYP ; -- type of practitioner
"RTN","MAGDHLS",216,0)
 N NUL ; ----- null return from called function
"RTN","MAGDHLS",217,0)
 N SETID ; --- sequential index of ROL seg(s) in this message
"RTN","MAGDHLS",218,0)
 N PV1IX ; --- index of PV1 segment in message array
"RTN","MAGDHLS",219,0)
 N PHYSELT ; - element index of attending / referring physician on PV1 segment
"RTN","MAGDHLS",220,0)
 N I ; ------- scratch loop counter
"RTN","MAGDHLS",221,0)
 ;
"RTN","MAGDHLS",222,0)
 S DFN=XDFN,SETID=0
"RTN","MAGDHLS",223,0)
 S PV1IX="",I=0 F  S I=$O(@XYMSG@(I)) Q:'I  I @XYMSG@(I,0)="PV1" S PV1IX=I Q
"RTN","MAGDHLS",224,0)
 Q:'PV1IX  ; no physicians to propagate
"RTN","MAGDHLS",225,0)
 F PRCTYP="ATT","REF" D
"RTN","MAGDHLS",226,0)
 . S PHYSELT=$S(PRCTYP="ATT":7,1:8) Q:'$D(@XYMSG@(PV1IX,PHYSELT))
"RTN","MAGDHLS",227,0)
 . S SEGIX=$O(@XYMSG@(" "),-1)+1,SETID=SETID+1
"RTN","MAGDHLS",228,0)
 . S @XYMSG@(SEGIX,0)="ROL"
"RTN","MAGDHLS",229,0)
 . S @XYMSG@(SEGIX,1,1,1,1)=SETID
"RTN","MAGDHLS",230,0)
 . S @XYMSG@(SEGIX,2,1,1,1)="UP" ; receiver should always update
"RTN","MAGDHLS",231,0)
 . S @XYMSG@(SEGIX,3,1,1,1)=$S(PRCTYP="ATT":"AT",1:"RP")
"RTN","MAGDHLS",232,0)
 . M @XYMSG@(SEGIX,4)=@XYMSG@(PV1IX,PHYSELT)
"RTN","MAGDHLS",233,0)
 . S NUL=$$NPFON^MAG7UFO($NA(@XYMSG@(SEGIX,12)),$G(@XYMSG@(SEGIX,4,1,1,1)))
"RTN","MAGDHLS",234,0)
 . Q
"RTN","MAGDHLS",235,0)
 Q 0
"RTN","MAGDHLSO")
0^7^B9961335
"RTN","MAGDHLSO",1,0)
MAGDHLSO ;WOIFO/MLH - IHE-based ADT interface for PACS - OBX segments ; 12 Jun 2006  3:05 PM
"RTN","MAGDHLSO",2,0)
 ;;3.0;IMAGING;**49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGDHLSO",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDHLSO",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHLSO",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDHLSO",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDHLSO",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDHLSO",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDHLSO",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDHLSO",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDHLSO",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDHLSO",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDHLSO",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDHLSO",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDHLSO",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDHLSO",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHLSO",17,0)
 ;;
"RTN","MAGDHLSO",18,0)
 Q
"RTN","MAGDHLSO",19,0)
 ;
"RTN","MAGDHLSO",20,0)
OBXADT ; GOTO entry point from MAGDHLS - patient height/weight - NOT FOR DIRECT ENTRY
"RTN","MAGDHLSO",21,0)
 ; input:  XDFN      internal entry number of the patient on global ^DPT
"RTN","MAGDHLSO",22,0)
 ;         XYMSG     name of array to which to add message elts
"RTN","MAGDHLSO",23,0)
 ; output: @XYMSG    input array plus new subtree containing EVN elts
"RTN","MAGDHLSO",24,0)
 ;         function return   0 (success) always
"RTN","MAGDHLSO",25,0)
 ;
"RTN","MAGDHLSO",26,0)
 N DFN ; ----- internal entry number on ^DPT
"RTN","MAGDHLSO",27,0)
 N VTYPIX ; -- vitals type index on ^UTILITY($J)
"RTN","MAGDHLSO",28,0)
 N RDTIX ; --- reverse date/time index on ^UTILITY($J)
"RTN","MAGDHLSO",29,0)
 N SEGIX ; --- segment index on @XYMSG
"RTN","MAGDHLSO",30,0)
 N SETID ; --- set ID element for HL7 segments
"RTN","MAGDHLSO",31,0)
 N VDTM ; ---- date/time of vitals data
"RTN","MAGDHLSO",32,0)
 N VIEN ; ---- vitals IEN for measurement
"RTN","MAGDHLSO",33,0)
 N VDTA ; ---- vitals data
"RTN","MAGDHLSO",34,0)
 N UNITS ; --- labels for units of measure
"RTN","MAGDHLSO",35,0)
 ;
"RTN","MAGDHLSO",36,0)
 K ^UTILITY($J,"GMRVD") ; refresh the return array
"RTN","MAGDHLSO",37,0)
 S DFN=XDFN,GMRVSTR="HT;WT"
"RTN","MAGDHLSO",38,0)
 S GMRVSTR(0)="^^1" ; one occurrence each of height and weight
"RTN","MAGDHLSO",39,0)
 D EN1^GMRVUT0
"RTN","MAGDHLSO",40,0)
 S SETID=0
"RTN","MAGDHLSO",41,0)
 S UNITS("HT")="HEIGHT|m|meter"
"RTN","MAGDHLSO",42,0)
 S UNITS("WT")="WEIGHT|kg|kilogram"
"RTN","MAGDHLSO",43,0)
 ;
"RTN","MAGDHLSO",44,0)
 F VTYPIX="HT","WT" I $D(^UTILITY($J,"GMRVD",VTYPIX)) D
"RTN","MAGDHLSO",45,0)
 . S RDTIX=$O(^UTILITY($J,"GMRVD",VTYPIX,0))
"RTN","MAGDHLSO",46,0)
 . I RDTIX D
"RTN","MAGDHLSO",47,0)
 . . S VDTM=9999999-RDTIX
"RTN","MAGDHLSO",48,0)
 . . S VIEN=$O(^UTILITY($J,"GMRVD",VTYPIX,RDTIX,0))
"RTN","MAGDHLSO",49,0)
 . . ; if a measurement exists, populate the message array
"RTN","MAGDHLSO",50,0)
 . . I VIEN D OBXAHW(UNITS(VTYPIX))
"RTN","MAGDHLSO",51,0)
 . . Q
"RTN","MAGDHLSO",52,0)
 . Q
"RTN","MAGDHLSO",53,0)
 Q 0
"RTN","MAGDHLSO",54,0)
 ;
"RTN","MAGDHLSO",55,0)
OBXAHW(XUNITS) ; SUBROUTINE - called by OBXADT - NOT FOR DIRECT ENTRY
"RTN","MAGDHLSO",56,0)
 ; if a measurement exists, populate the message array
"RTN","MAGDHLSO",57,0)
 ; INPUT:  XUNITS      labels for units of measure
"RTN","MAGDHLSO",58,0)
 ;                     format:  MEASUREMENT|abbrev|unit
"RTN","MAGDHLSO",59,0)
 ;                     
"RTN","MAGDHLSO",60,0)
 S SEGIX=$O(@XYMSG@(" "),-1)+1
"RTN","MAGDHLSO",61,0)
 S @XYMSG@(SEGIX,0)="OBX"
"RTN","MAGDHLSO",62,0)
 S SETID=SETID+1,@XYMSG@(SEGIX,1,1,1,1)=SETID
"RTN","MAGDHLSO",63,0)
 S @XYMSG@(SEGIX,2,1,1,1)="ST"
"RTN","MAGDHLSO",64,0)
 S @XYMSG@(SEGIX,3,1,2,1)=$P(XUNITS,"|",1)
"RTN","MAGDHLSO",65,0)
 S @XYMSG@(SEGIX,5,1,1,1)=$J($P($G(^UTILITY($J,"GMRVD",VTYPIX,RDTIX,VIEN)),U,13)/$S($P(XUNITS,"|",2)="m":100,1:1),0,2)
"RTN","MAGDHLSO",66,0)
 S @XYMSG@(SEGIX,6,1,1,1)=$P(XUNITS,"|",2)
"RTN","MAGDHLSO",67,0)
 S @XYMSG@(SEGIX,6,1,2,1)=$P(XUNITS,"|",3)
"RTN","MAGDHLSO",68,0)
 S @XYMSG@(SEGIX,6,1,3,1)="ISO+"
"RTN","MAGDHLSO",69,0)
 S @XYMSG@(SEGIX,11,1,1,1)="F"
"RTN","MAGDHLSO",70,0)
 Q
"RTN","MAGDHLSV")
0^8^B49332835
"RTN","MAGDHLSV",1,0)
MAGDHLSV ;WOIFO/MLH - IHE-based ADT interface for PACS - PV1 segment ; 13 Aug 2009 9:15 AM
"RTN","MAGDHLSV",2,0)
 ;;3.0;IMAGING;**49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGDHLSV",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDHLSV",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHLSV",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDHLSV",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDHLSV",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDHLSV",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDHLSV",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDHLSV",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDHLSV",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDHLSV",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDHLSV",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDHLSV",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDHLSV",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDHLSV",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHLSV",17,0)
 ;;
"RTN","MAGDHLSV",18,0)
 Q
"RTN","MAGDHLSV",19,0)
 ;
"RTN","MAGDHLSV",20,0)
PV1 ; GOTO entry point from MAGDHLS - patient visit - NOT FOR DIRECT ENTRY
"RTN","MAGDHLSV",21,0)
 ; input:  XDFN      internal entry number of the patient on global ^DPT/^RADPT
"RTN","MAGDHLSV",22,0)
 ;         XEVN      event type of this message
"RTN","MAGDHLSV",23,0)
 ;         XEVNDT    event date/time (FileMan format)
"RTN","MAGDHLSV",24,0)
 ;         XYMSG     name of array to which to add message elts
"RTN","MAGDHLSV",25,0)
 ; output: @XYMSG    input array plus new subtree containing PV1 elts
"RTN","MAGDHLSV",26,0)
 ;         function return   0 (success) always
"RTN","MAGDHLSV",27,0)
 ;
"RTN","MAGDHLSV",28,0)
 N SEGIX ; ----- segment index on array @XYMSG
"RTN","MAGDHLSV",29,0)
 N MAGNME ; ---- array for HL7-formatted name lookup info
"RTN","MAGDHLSV",30,0)
 N I ; --------- loop index for $Piece calls
"RTN","MAGDHLSV",31,0)
 N BDT ; ----- beginning date for call to EN1^RAO7PC1
"RTN","MAGDHLSV",32,0)
 N EDT ; ----- ending date for call to EN1^RAO7PC1
"RTN","MAGDHLSV",33,0)
 N EXN ; ----- max # of exams for call to EN1^RAO7PC1
"RTN","MAGDHLSV",34,0)
 N DTCS ; ---- date/case index from RAO7PC1 lookup
"RTN","MAGDHLSV",35,0)
 N RVDT ; ---- reverse date time entry on global ^RADPT
"RTN","MAGDHLSV",36,0)
 N CSIX ; ---- case number index under RVDT on global ^RADPT
"RTN","MAGDHLSV",37,0)
 N VAIP ; ---- patient data array from call to IN5^VADPT
"RTN","MAGDHLSV",38,0)
 N RAXSET ; -- exam set data from ^RADPT
"RTN","MAGDHLSV",39,0)
 N RAXWRD ; -- exam ward (entry in File 42)
"RTN","MAGDHLSV",40,0)
 N RASCIX ; -- ward location service/section index (entry in File 44)
"RTN","MAGDHLSV",41,0)
 N RASVC ; --- service/section name from File 44
"RTN","MAGDHLSV",42,0)
 N RAORIX ; -- order index on ^RAO(75.1)
"RTN","MAGDHLSV",43,0)
 N RAORDR ; -- order data from ^RAO(75.1)
"RTN","MAGDHLSV",44,0)
 N ERPTSS ; -- element repetition subscript
"RTN","MAGDHLSV",45,0)
 N RAXPRT ; -- transport mode from RAORDR
"RTN","MAGDHLSV",46,0)
 N VAIN ; ---- inpatient data array from call to INP^VADPT
"RTN","MAGDHLSV",47,0)
 N RESULT ; -- return array from entry point PTSEG^DGSEC4
"RTN","MAGDHLSV",48,0)
 N VISNO ; --- visit number
"RTN","MAGDHLSV",49,0)
 ;
"RTN","MAGDHLSV",50,0)
 ; set up the PV1 segment
"RTN","MAGDHLSV",51,0)
 S SEGIX=$O(@XYMSG@(" "),-1)+1 ; segment index
"RTN","MAGDHLSV",52,0)
 S @XYMSG@(SEGIX,0)="PV1"
"RTN","MAGDHLSV",53,0)
 I '$D(XDFN) S @XYMSG@(SEGIX,2,1,1,1)="N" Q 0 ; no DFN, can't get IP/OP info
"RTN","MAGDHLSV",54,0)
 S DFN=XDFN D IN5^VADPT ; supported PIMS call - get IP info if any into VAIP()
"RTN","MAGDHLSV",55,0)
 D @$S($G(VAIP(13)):"IN",1:"OUT") ;inpatient/outpatient
"RTN","MAGDHLSV",56,0)
 D  ; insert admit date/time from current status date @ 0000H
"RTN","MAGDHLSV",57,0)
 . N VAINDT ; -- date/time of status
"RTN","MAGDHLSV",58,0)
 . S VAINDT=XEVNDT\1 D INP^VADPT ; inpt info into VAIN()
"RTN","MAGDHLSV",59,0)
 . S:VAIN(7) @XYMSG@(SEGIX,44,1,1,1)=$$FMTHL7^XLFDT($P(VAIN(7),"^",1))
"RTN","MAGDHLSV",60,0)
 . Q
"RTN","MAGDHLSV",61,0)
 ; IA #3646:  employee flag
"RTN","MAGDHLSV",62,0)
 S:$$EMPL^DGSEC4(XDFN)=1 @XYMSG@(SEGIX,16,1,1,1)="E"
"RTN","MAGDHLSV",63,0)
 ; IA #767:  sensitive flag
"RTN","MAGDHLSV",64,0)
 S:$P($G(^DGSL(38.1,XDFN,0)),"^",2)=1 @XYMSG@(SEGIX,16,1,1,1)=$G(@XYMSG@(SEGIX,16,1,1,1))_"S"
"RTN","MAGDHLSV",65,0)
 ; insert visit number <- admission number (IP) or date (OP)
"RTN","MAGDHLSV",66,0)
 S VISNO=$S($G(VAIN(1))'="":"I"_VAIN(1),1:"O"_($$HTFM^XLFDT($H,1)+17000000))
"RTN","MAGDHLSV",67,0)
 S @XYMSG@(SEGIX,19,1,1,1)=VISNO
"RTN","MAGDHLSV",68,0)
 S:XEVN="A11" @XYMSG@(SEGIX,2,1,1,1)="N" ; cancel an admit - IP/OP doesn't apply in PV1-2
"RTN","MAGDHLSV",69,0)
 Q 0
"RTN","MAGDHLSV",70,0)
 ;
"RTN","MAGDHLSV",71,0)
IN ; SUBROUTINE - patient is now an inpatient
"RTN","MAGDHLSV",72,0)
 ;
"RTN","MAGDHLSV",73,0)
 N ROOMBED ; --- patient's room and bed
"RTN","MAGDHLSV",74,0)
 N ATTPHYIX ; -- patient's attending physician index on NEW PERSON (#200)
"RTN","MAGDHLSV",75,0)
 N ATTPHY ; ---- patient's attending physician information
"RTN","MAGDHLSV",76,0)
 N ADMPHYIX ; -- patient's admitting physician index on NEW PERSON
"RTN","MAGDHLSV",77,0)
 N ADMPHY ; ---- patient's admitting physician information
"RTN","MAGDHLSV",78,0)
 N RADSVCIX ; -- patient's service/section associated with Rad order - index
"RTN","MAGDHLSV",79,0)
 N SVC ; ------- service/section name
"RTN","MAGDHLSV",80,0)
 N TMP ; ------- scratch variable
"RTN","MAGDHLSV",81,0)
 N WARDREC ; --- ward record from VAIP(5)
"RTN","MAGDHLSV",82,0)
 N WARDIX ; ---- ward index on WARD LOCATION File (#44)
"RTN","MAGDHLSV",83,0)
 N WARDNAM ; --- name of ward
"RTN","MAGDHLSV",84,0)
 ;
"RTN","MAGDHLSV",85,0)
 ; fetch information
"RTN","MAGDHLSV",86,0)
 S ROOMBED=$P($G(VAIP(6)),U,2) ; patient's room and bed
"RTN","MAGDHLSV",87,0)
 S ATTPHYIX=+$G(VAIP(18)),ATTPHY="" ; attending physician
"RTN","MAGDHLSV",88,0)
 I ATTPHYIX D
"RTN","MAGDHLSV",89,0)
 . S MAGNME("FILE")=200,MAGNME("IENS")=ATTPHYIX,MAGNME("FIELD")=.01
"RTN","MAGDHLSV",90,0)
 . S ATTPHY=ATTPHYIX_U_$$HLNAME^XLFNAME(.MAGNME,"S",U)
"RTN","MAGDHLSV",91,0)
 . Q
"RTN","MAGDHLSV",92,0)
 S ADMPHYIX=+$G(VAIP(13,5)),ADMPHY="" ; admitting physician
"RTN","MAGDHLSV",93,0)
 I ADMPHYIX D
"RTN","MAGDHLSV",94,0)
 . S MAGNME("FILE")=200,MAGNME("IENS")=ADMPHYIX,MAGNME("FIELD")=.01
"RTN","MAGDHLSV",95,0)
 . S ADMPHY=ADMPHYIX_U_$$HLNAME^XLFNAME(.MAGNME,"S",U)
"RTN","MAGDHLSV",96,0)
 . Q
"RTN","MAGDHLSV",97,0)
 ; populate message array
"RTN","MAGDHLSV",98,0)
 S @XYMSG@(SEGIX,2,1,1,1)="I" ; patient class
"RTN","MAGDHLSV",99,0)
 S WARDREC=$G(VAIP(5)),WARDIX=$P(WARDREC,U,1),WARDNAM=$P(WARDREC,U,2)
"RTN","MAGDHLSV",100,0)
 S @XYMSG@(SEGIX,3,1,1,1)=WARDNAM ; patient location - ward
"RTN","MAGDHLSV",101,0)
 S @XYMSG@(SEGIX,3,1,2,1)=$P(ROOMBED,"-",1) ; patient location - room
"RTN","MAGDHLSV",102,0)
 S @XYMSG@(SEGIX,3,1,3,1)=$P(ROOMBED,"-",2) ; patient location - bed
"RTN","MAGDHLSV",103,0)
 S:WARDNAM'="" @XYMSG@(SEGIX,3,1,4,1)=$$FACILIX(WARDIX) ; pt loc - facility
"RTN","MAGDHLSV",104,0)
 I XEVN="A02" D  ; transfer -> get previous location
"RTN","MAGDHLSV",105,0)
 . S TMP=$G(VAIP(15)) Q:'TMP  K VAIP
"RTN","MAGDHLSV",106,0)
 . S VAIP("E")=TMP D IN5^VADPT
"RTN","MAGDHLSV",107,0)
 . S ROOMBED=$P($G(VAIP(6)),U,2) ; previous room and bed
"RTN","MAGDHLSV",108,0)
 . S WARDREC=$G(VAIP(5)),WARDIX=$P(WARDREC,U,1),WARDNAM=$P(WARDREC,U,2)
"RTN","MAGDHLSV",109,0)
 . S @XYMSG@(SEGIX,6,1,1,1)=WARDNAM ; previous location - ward
"RTN","MAGDHLSV",110,0)
 . S @XYMSG@(SEGIX,6,1,2,1)=$P(ROOMBED,"-",1) ; previous location - room
"RTN","MAGDHLSV",111,0)
 . S @XYMSG@(SEGIX,6,1,3,1)=$P(ROOMBED,"-",2) ; previous location - bed
"RTN","MAGDHLSV",112,0)
 . S:WARDNAM'="" @XYMSG@(SEGIX,6,1,4,1)=$$FACILIX(WARDIX) ; prev loc - facility
"RTN","MAGDHLSV",113,0)
 . Q
"RTN","MAGDHLSV",114,0)
 F I=1:1:$L(ATTPHY,U) S @XYMSG@(SEGIX,7,1,I,1)=$P(ATTPHY,U,I) ; attending physician
"RTN","MAGDHLSV",115,0)
 S @XYMSG@(SEGIX,10,1,1,1)=$P(VAIP(8),"^",2) ; hospital service <- treating specialty
"RTN","MAGDHLSV",116,0)
 F I=1:1:$L(ADMPHY,U) S @XYMSG@(SEGIX,8,1,I,1)=$P(ADMPHY,U,I) ; referring = admitting physician
"RTN","MAGDHLSV",117,0)
 F I=1:1:$L(ADMPHY,U) S @XYMSG@(SEGIX,17,1,I,1)=$P(ADMPHY,U,I) ; admitting physician
"RTN","MAGDHLSV",118,0)
 Q
"RTN","MAGDHLSV",119,0)
 ;
"RTN","MAGDHLSV",120,0)
OUT ; SUBROUTINE - patient is now an outpatient
"RTN","MAGDHLSV",121,0)
 ;
"RTN","MAGDHLSV",122,0)
 N REFPHYIX ; -- referring/requesting physician index on NEW PERSON
"RTN","MAGDHLSV",123,0)
 N REFPHY ; ---- referring/requesting physician information
"RTN","MAGDHLSV",124,0)
 ;
"RTN","MAGDHLSV",125,0)
 S @XYMSG@(SEGIX,2,1,1,1)="O" ; patient class
"RTN","MAGDHLSV",126,0)
 S:XEVN="A03" @XYMSG@(SEGIX,45,1,1,1)=$$FMTHL7^XLFDT(XEVNDT) ; discharge date/time
"RTN","MAGDHLSV",127,0)
 ; insert admit date/time as appropriate
"RTN","MAGDHLSV",128,0)
 Q
"RTN","MAGDHLSV",129,0)
 ;
"RTN","MAGDHLSV",130,0)
FACILIX(XWARDIX) ; FUNCTION - return the facility associated with a ward, if any,
"RTN","MAGDHLSV",131,0)
 ;   otherwise return user's default facility
"RTN","MAGDHLSV",132,0)
 ;   
"RTN","MAGDHLSV",133,0)
 ; input:      XWARDIX = IEN of the ward in WARD LOCATION File (#42))
"RTN","MAGDHLSV",134,0)
 ;
"RTN","MAGDHLSV",135,0)
 ; function return:    <facility code>_"_"_<facility name>
"RTN","MAGDHLSV",136,0)
 ;   
"RTN","MAGDHLSV",137,0)
 N DA,DIC,DR,X ;  FileMan work variables
"RTN","MAGDHLSV",138,0)
 N WARDIX ; ----- IEN of ward in WARD LOCATION File (#42)
"RTN","MAGDHLSV",139,0)
 N HOSPLOCIX ; -- IEN of hospital location in HOSPITAL LOCATION File (#44)
"RTN","MAGDHLSV",140,0)
 N FACILIX ; ---- IEN of facility on INSTITUTION File (#4)
"RTN","MAGDHLSV",141,0)
 N FACILNAM ; --- name of facility on INSTITUTION File (#4)
"RTN","MAGDHLSV",142,0)
 N MAGLOC ; ----- work array for FileMan search results
"RTN","MAGDHLSV",143,0)
 ;
"RTN","MAGDHLSV",144,0)
 D:$G(XWARDIX)
"RTN","MAGDHLSV",145,0)
 . Q:XWARDIX'=+XWARDIX
"RTN","MAGDHLSV",146,0)
 . S HOSPLOCIX=$P($G(^DIC(42,XWARDIX,44)),U,1) ; look up hospital location - ICR 10039
"RTN","MAGDHLSV",147,0)
 . Q:HOSPLOCIX'>0  Q:'$D(^SC(HOSPLOCIX))  ; hospital location not on file
"RTN","MAGDHLSV",148,0)
 . S FACILIX=$P($G(^SC(HOSPLOCIX,0)),"^",4) ; look up facility - ICR 10040
"RTN","MAGDHLSV",149,0)
 . Q
"RTN","MAGDHLSV",150,0)
 S:'$G(FACILIX) FACILIX=$G(DUZ(2))
"RTN","MAGDHLSV",151,0)
 D:FACILIX  ; get facility name - ICR 10090
"RTN","MAGDHLSV",152,0)
 . S DIC=4,DR=.01,DA=FACILIX,DIQ="MAGLOC",DIQ(0)="E"
"RTN","MAGDHLSV",153,0)
 . D EN^DIQ1 S FACILNAM=$G(MAGLOC(4,FACILIX,.01,"E"))
"RTN","MAGDHLSV",154,0)
 . Q
"RTN","MAGDHLSV",155,0)
 Q $S(FACILIX:FACILIX_"_"_$G(FACILNAM),1:"")
"RTN","MAGDHLT")
0^9^B5153872
"RTN","MAGDHLT",1,0)
MAGDHLT ;WOIFO/MLH - IHE-based ADT interface for PACS - trigger event vectors ; 31 Aug 2009 09:09 AM
"RTN","MAGDHLT",2,0)
 ;;3.0;IMAGING;**49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGDHLT",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDHLT",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHLT",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDHLT",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDHLT",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDHLT",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDHLT",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDHLT",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDHLT",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDHLT",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDHLT",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDHLT",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDHLT",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDHLT",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHLT",17,0)
 ;;
"RTN","MAGDHLT",18,0)
 Q
"RTN","MAGDHLT",19,0)
 ;
"RTN","MAGDHLT",20,0)
A01(XDFN,XOCCURRED) G A01^MAGDHLTA ; patient admission
"RTN","MAGDHLT",21,0)
A02(XDFN,XOCCURRED) G A02^MAGDHLTA ; patient transfer
"RTN","MAGDHLT",22,0)
A03(XDFN,XOCCURRED) G A03^MAGDHLTA ; patient discharge
"RTN","MAGDHLT",23,0)
A08 Q  ;G A08^MAGDHLTD ; patient demo updates - not now used
"RTN","MAGDHLT",24,0)
A11(XDFN,XDT) G A11^MAGDHLTC ; cancel patient admission
"RTN","MAGDHLT",25,0)
A12(XDFN,XDT) G A12^MAGDHLTC ; cancel patient transfer
"RTN","MAGDHLT",26,0)
A13(XDFN,XDT) G A13^MAGDHLTC ; cancel patient discharge
"RTN","MAGDHLT",27,0)
A40 Q  ;G A40^MAGDHLTM ; patient ID list merge - not now used
"RTN","MAGDHLTA")
0^10^B23848932
"RTN","MAGDHLTA",1,0)
MAGDHLTA ;WOIFO/MLH - IHE-based ADT interface for PACS - trigger events - A01, A02, A03 ; 23 Apr 2009 3:40 PM
"RTN","MAGDHLTA",2,0)
 ;;3.0;IMAGING;**49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGDHLTA",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDHLTA",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHLTA",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDHLTA",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDHLTA",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDHLTA",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDHLTA",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDHLTA",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDHLTA",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDHLTA",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDHLTA",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDHLTA",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDHLTA",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDHLTA",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHLTA",17,0)
 ;;
"RTN","MAGDHLTA",18,0)
 Q
"RTN","MAGDHLTA",19,0)
 ;
"RTN","MAGDHLTA",20,0)
A01 ; GOTO entry point from MAGDHLT - patient admission 
"RTN","MAGDHLTA",21,0)
 ; INPUT:  XDFN       patient's internal entry number on PATIENT File (#2)
"RTN","MAGDHLTA",22,0)
 ;         XOCCURRED  date/time of the admission in FileMan format
"RTN","MAGDHLTA",23,0)
 ; function return:   result of message generation from call to GENERATE^HLMA
"RTN","MAGDHLTA",24,0)
 ;
"RTN","MAGDHLTA",25,0)
 N HL ; -------- HL7 initialization function status return
"RTN","MAGDHLTA",26,0)
 N HLA ; ------- array of HL7 message segments
"RTN","MAGDHLTA",27,0)
 N MSGA01A ; --- A01 message array
"RTN","MAGDHLTA",28,0)
 N MSG ; ------- message status
"RTN","MAGDHLTA",29,0)
 N RESULT ; ---- status message returned by message generator
"RTN","MAGDHLTA",30,0)
 ;
"RTN","MAGDHLTA",31,0)
 D INIT^HLFNC2("MAG CPACS A01",.HL)
"RTN","MAGDHLTA",32,0)
 I $G(HL) Q -1_U_$P(HL,"^",2) ; error
"RTN","MAGDHLTA",33,0)
 S HLCS=$E(HLECH,1),HLRS=$E(HLECH,2),HLSS=$E(HLECH,4)
"RTN","MAGDHLTA",34,0)
 ;
"RTN","MAGDHLTA",35,0)
 ; build a dummy MSH segment for the $$MAKE^MAG7UM function
"RTN","MAGDHLTA",36,0)
 S MSGA01A(1,0)="MSH"
"RTN","MAGDHLTA",37,0)
 S MSGA01A(1,1,1,1,1)=HLFS
"RTN","MAGDHLTA",38,0)
 S MSGA01A(1,2,1,1,1)=HLECH
"RTN","MAGDHLTA",39,0)
 S MSGA01A(1,9,1,1,1)="ADT"
"RTN","MAGDHLTA",40,0)
 S MSGA01A(1,9,1,2,1)="A01"
"RTN","MAGDHLTA",41,0)
 ;
"RTN","MAGDHLTA",42,0)
 S MSG=$$EVN^MAGDHLS("A01",$$NOW^XLFDT,XOCCURRED,"MSGA01A")
"RTN","MAGDHLTA",43,0)
 S MSG=$$PID^MAGDHLS(XDFN,"MSGA01A")
"RTN","MAGDHLTA",44,0)
 S MSG=$$PV1^MAGDHLS(XDFN,"A01",XOCCURRED,"MSGA01A")
"RTN","MAGDHLTA",45,0)
 S MSG=$$ROL^MAGDHLS(XDFN,"MSGA01A")
"RTN","MAGDHLTA",46,0)
 S MSG=$$OBXADT^MAGDHLS(XDFN,"MSGA01A")
"RTN","MAGDHLTA",47,0)
 S MSG=$$AL1^MAGDHLS(XDFN,"MSGA01A")
"RTN","MAGDHLTA",48,0)
 S MSG=$$DG1^MAGDHLS(XDFN,"MSGA01A")
"RTN","MAGDHLTA",49,0)
 ;
"RTN","MAGDHLTA",50,0)
 ; assemble message into segments
"RTN","MAGDHLTA",51,0)
 S MSG=$$MAKE^MAG7UM("MSGA01A",$NA(HLA("HLS")))
"RTN","MAGDHLTA",52,0)
 K HLA("HLS",1) ; remove dummy MSH segment
"RTN","MAGDHLTA",53,0)
 ;
"RTN","MAGDHLTA",54,0)
 ; send message to receiver and gateway
"RTN","MAGDHLTA",55,0)
 D GENERATE^HLMA("MAG CPACS A01","LM",1,.RESULT) ; generate & send message
"RTN","MAGDHLTA",56,0)
 D LOGGW^MAGDHLL("ADT") ; log message to gateway
"RTN","MAGDHLTA",57,0)
 Q $S($P($G(RESULT),U,2,$L(RESULT,U))="":0,1:-1_U_RESULT)
"RTN","MAGDHLTA",58,0)
 ;
"RTN","MAGDHLTA",59,0)
A02 ; GOTO entry point from MAGDHLT - patient transfer
"RTN","MAGDHLTA",60,0)
 ; INPUT:  XDFN       patient's internal entry number on PATIENT File (#2)
"RTN","MAGDHLTA",61,0)
 ;         XOCCURRED  date/time of the admission in FileMan format
"RTN","MAGDHLTA",62,0)
 ; function return:   result of message generation from call to GENERATE^HLMA
"RTN","MAGDHLTA",63,0)
 ;
"RTN","MAGDHLTA",64,0)
 N HL ; -------- HL7 initialization function status return
"RTN","MAGDHLTA",65,0)
 N HLA ; ------- array of HL7 message segments
"RTN","MAGDHLTA",66,0)
 N MSGA02A ; --- A02 message array
"RTN","MAGDHLTA",67,0)
 N MSG ; ------- message status
"RTN","MAGDHLTA",68,0)
 N RESULT ; ---- status message returned by message generator
"RTN","MAGDHLTA",69,0)
 ;
"RTN","MAGDHLTA",70,0)
 D INIT^HLFNC2("MAG CPACS A02",.HL)
"RTN","MAGDHLTA",71,0)
 I $G(HL) Q -1_U_$P(HL,"^",2) ; error
"RTN","MAGDHLTA",72,0)
 S HLCS=$E(HLECH,1),HLRS=$E(HLECH,2),HLSS=$E(HLECH,4)
"RTN","MAGDHLTA",73,0)
 ;
"RTN","MAGDHLTA",74,0)
 ; build a dummy MSH segment for the $$MAKE^MAG7UM function
"RTN","MAGDHLTA",75,0)
 S MSGA02A(1,0)="MSH"
"RTN","MAGDHLTA",76,0)
 S MSGA02A(1,1,1,1,1)=HLFS
"RTN","MAGDHLTA",77,0)
 S MSGA02A(1,2,1,1,1)=HLECH
"RTN","MAGDHLTA",78,0)
 S MSGA02A(1,9,1,1,1)="ADT"
"RTN","MAGDHLTA",79,0)
 S MSGA02A(1,9,1,2,1)="A02"
"RTN","MAGDHLTA",80,0)
 ;
"RTN","MAGDHLTA",81,0)
 ; get patient movement event information and build EVN segment
"RTN","MAGDHLTA",82,0)
 S MSG=$$EVN^MAGDHLS("A02",$$NOW^XLFDT,XOCCURRED,"MSGA02A")
"RTN","MAGDHLTA",83,0)
 S MSG=$$PID^MAGDHLS(XDFN,"MSGA02A")
"RTN","MAGDHLTA",84,0)
 S MSG=$$PV1^MAGDHLS(XDFN,"A02",XOCCURRED,"MSGA02A")
"RTN","MAGDHLTA",85,0)
 S MSG=$$ROL^MAGDHLS(XDFN,"MSGA02A")
"RTN","MAGDHLTA",86,0)
 ;
"RTN","MAGDHLTA",87,0)
 ; assemble message into segments
"RTN","MAGDHLTA",88,0)
 S MSG=$$MAKE^MAG7UM("MSGA02A",$NA(HLA("HLS")))
"RTN","MAGDHLTA",89,0)
 K HLA("HLS",1) ; remove dummy MSH segment
"RTN","MAGDHLTA",90,0)
 ;
"RTN","MAGDHLTA",91,0)
 ; send message to receiver and gateway
"RTN","MAGDHLTA",92,0)
 D GENERATE^HLMA("MAG CPACS A02","LM",1,.RESULT) ; generate & send message
"RTN","MAGDHLTA",93,0)
 D LOGGW^MAGDHLL("ADT") ; log message to gateway
"RTN","MAGDHLTA",94,0)
 Q $S($P($G(RESULT),U,2,$L(RESULT,U))="":0,1:-1_U_RESULT)
"RTN","MAGDHLTA",95,0)
 ;
"RTN","MAGDHLTA",96,0)
A03 ; GOTO entry point from MAGDHLT - patient discharge
"RTN","MAGDHLTA",97,0)
 ; INPUT:  XDFN       patient's internal entry number on PATIENT File (#2)
"RTN","MAGDHLTA",98,0)
 ;         XOCCURRED  date/time of the admission in FileMan format
"RTN","MAGDHLTA",99,0)
 ; function return:   result of message generation from call to GENERATE^HLMA
"RTN","MAGDHLTA",100,0)
 ;
"RTN","MAGDHLTA",101,0)
 N HL ; -------- HL7 initialization function status return
"RTN","MAGDHLTA",102,0)
 N HLA ; ------- array of HL7 message segments
"RTN","MAGDHLTA",103,0)
 N MSGA03A ; --- A03 message array
"RTN","MAGDHLTA",104,0)
 N MSG ; ------- message status
"RTN","MAGDHLTA",105,0)
 N RESULT ; ---- status message returned by message generator
"RTN","MAGDHLTA",106,0)
 ;
"RTN","MAGDHLTA",107,0)
 D INIT^HLFNC2("MAG CPACS A03",.HL)
"RTN","MAGDHLTA",108,0)
 I $G(HL) Q -1_U_$P(HL,"^",2) ; error
"RTN","MAGDHLTA",109,0)
 S HLCS=$E(HLECH,1),HLRS=$E(HLECH,2),HLSS=$E(HLECH,4)
"RTN","MAGDHLTA",110,0)
 ;
"RTN","MAGDHLTA",111,0)
 ; build a dummy MSH segment for the $$MAKE^MAG7UM function
"RTN","MAGDHLTA",112,0)
 S MSGA03A(1,0)="MSH"
"RTN","MAGDHLTA",113,0)
 S MSGA03A(1,1,1,1,1)=HLFS
"RTN","MAGDHLTA",114,0)
 S MSGA03A(1,2,1,1,1)=HLECH
"RTN","MAGDHLTA",115,0)
 S MSGA03A(1,9,1,1,1)="ADT"
"RTN","MAGDHLTA",116,0)
 S MSGA03A(1,9,1,2,1)="A03"
"RTN","MAGDHLTA",117,0)
 ;
"RTN","MAGDHLTA",118,0)
 ; get patient movement event information and build EVN segment
"RTN","MAGDHLTA",119,0)
 S MSG=$$EVN^MAGDHLS("A03",$$NOW^XLFDT,XOCCURRED,"MSGA03A")
"RTN","MAGDHLTA",120,0)
 S MSG=$$PID^MAGDHLS(XDFN,"MSGA03A")
"RTN","MAGDHLTA",121,0)
 S MSG=$$PV1^MAGDHLS(XDFN,"A03",XOCCURRED,"MSGA03A")
"RTN","MAGDHLTA",122,0)
 S MSG=$$ROL^MAGDHLS(XDFN,"MSGA03A")
"RTN","MAGDHLTA",123,0)
 S MSG=$$DG1^MAGDHLS(XDFN,"MSGA03A")
"RTN","MAGDHLTA",124,0)
 ;
"RTN","MAGDHLTA",125,0)
 ; assemble message into segments
"RTN","MAGDHLTA",126,0)
 S MSG=$$MAKE^MAG7UM("MSGA03A",$NA(HLA("HLS")))
"RTN","MAGDHLTA",127,0)
 K HLA("HLS",1) ; remove dummy MSH segment
"RTN","MAGDHLTA",128,0)
 ;
"RTN","MAGDHLTA",129,0)
 ; send message to receiver and gateway
"RTN","MAGDHLTA",130,0)
 D GENERATE^HLMA("MAG CPACS A03","LM",1,.RESULT) ; generate & send message
"RTN","MAGDHLTA",131,0)
 D LOGGW^MAGDHLL("ADT") ; log message to gateway
"RTN","MAGDHLTA",132,0)
 Q $S($P($G(RESULT),U,2,$L(RESULT,U))="":0,1:-1_U_RESULT)
"RTN","MAGDHLTC")
0^11^B20360006
"RTN","MAGDHLTC",1,0)
MAGDHLTC ;WOIFO/MLH - IHE-based ADT interface for PACS - trigger events - A11, A12, A13 ; 14 Jun 2006  5:00 PM
"RTN","MAGDHLTC",2,0)
 ;;3.0;IMAGING;**49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGDHLTC",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDHLTC",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHLTC",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDHLTC",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDHLTC",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDHLTC",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDHLTC",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDHLTC",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDHLTC",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDHLTC",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDHLTC",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDHLTC",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDHLTC",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDHLTC",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHLTC",17,0)
 ;;
"RTN","MAGDHLTC",18,0)
 Q
"RTN","MAGDHLTC",19,0)
 ;
"RTN","MAGDHLTC",20,0)
A11 ; GOTO entry point from MAGDHLT - patient admission cancel
"RTN","MAGDHLTC",21,0)
 ; INPUT:  XDFN      IEN of pt whose admission is being cancelled
"RTN","MAGDHLTC",22,0)
 ;         XDT       date/time of cancellation
"RTN","MAGDHLTC",23,0)
 ; function return:   result of message generation from call to GENERATE^HLMA
"RTN","MAGDHLTC",24,0)
 ;
"RTN","MAGDHLTC",25,0)
 N HL ; -------- HL7 initialization function status return
"RTN","MAGDHLTC",26,0)
 N HLA ; ------- array of HL7 message segments
"RTN","MAGDHLTC",27,0)
 N MSGA11A ; --- A11 message array
"RTN","MAGDHLTC",28,0)
 N MSG ; ------- message status
"RTN","MAGDHLTC",29,0)
 ;
"RTN","MAGDHLTC",30,0)
 D INIT^HLFNC2("MAG CPACS A11",.HL)
"RTN","MAGDHLTC",31,0)
 I $G(HL) Q -1_U_$P(HL,"^",2) ; error
"RTN","MAGDHLTC",32,0)
 S HLCS=$E(HLECH,1),HLRS=$E(HLECH,2),HLSS=$E(HLECH,4)
"RTN","MAGDHLTC",33,0)
 ;
"RTN","MAGDHLTC",34,0)
 ; build a dummy MSH segment for the $$MAKE^MAG7UM function
"RTN","MAGDHLTC",35,0)
 S MSGA11A(1,0)="MSH"
"RTN","MAGDHLTC",36,0)
 S MSGA11A(1,1,1,1,1)=HLFS
"RTN","MAGDHLTC",37,0)
 S MSGA11A(1,2,1,1,1)=HLECH
"RTN","MAGDHLTC",38,0)
 S MSGA11A(1,9,1,1,1)="ADT"
"RTN","MAGDHLTC",39,0)
 S MSGA11A(1,9,1,2,1)="A11"
"RTN","MAGDHLTC",40,0)
 ;
"RTN","MAGDHLTC",41,0)
 ; gather patient information and populate segment array elements
"RTN","MAGDHLTC",42,0)
 S MSG=$$EVN^MAGDHLS("A11",XDT,XDT,"MSGA11A")
"RTN","MAGDHLTC",43,0)
 S MSG=$$PID^MAGDHLS(XDFN,"MSGA11A")
"RTN","MAGDHLTC",44,0)
 S MSG=$$PV1^MAGDHLS(XDFN,"A11",XDT,"MSGA11A")
"RTN","MAGDHLTC",45,0)
 ;
"RTN","MAGDHLTC",46,0)
 ; assemble message into segments
"RTN","MAGDHLTC",47,0)
 S MSG=$$MAKE^MAG7UM("MSGA11A",$NA(HLA("HLS")))
"RTN","MAGDHLTC",48,0)
 K HLA("HLS",1) ; remove dummy MSH segment
"RTN","MAGDHLTC",49,0)
 ;
"RTN","MAGDHLTC",50,0)
 ; send message to receiver and gateway
"RTN","MAGDHLTC",51,0)
 D GENERATE^HLMA("MAG CPACS A11","LM",1,.RESULT) ; generate & send message
"RTN","MAGDHLTC",52,0)
 D LOGGW^MAGDHLL("ADT") ; log message to gateway
"RTN","MAGDHLTC",53,0)
 Q $S($P($G(RESULT),U,2,$L(RESULT,U))="":0,1:-1_U_RESULT)
"RTN","MAGDHLTC",54,0)
 ;
"RTN","MAGDHLTC",55,0)
A12 ; GOTO entry point from MAGDHLT - cancel patient transfer
"RTN","MAGDHLTC",56,0)
 ; INPUT:  XDFN      IEN of pt whose admission is being cancelled
"RTN","MAGDHLTC",57,0)
 ;         XDT       date/time of cancellation
"RTN","MAGDHLTC",58,0)
 ; function return:   result of message generation from call to GENERATE^HLMA
"RTN","MAGDHLTC",59,0)
 ;
"RTN","MAGDHLTC",60,0)
 N HL ; -------- HL7 initialization function status return
"RTN","MAGDHLTC",61,0)
 N HLA ; ------- array of HL7 message segments
"RTN","MAGDHLTC",62,0)
 N MSGA12A ; --- A02 message array
"RTN","MAGDHLTC",63,0)
 N MSG ; ------- message status
"RTN","MAGDHLTC",64,0)
 ;
"RTN","MAGDHLTC",65,0)
 D INIT^HLFNC2("MAG CPACS A12",.HL)
"RTN","MAGDHLTC",66,0)
 I $G(HL) Q -1_U_$P(HL,"^",2) ; error
"RTN","MAGDHLTC",67,0)
 S HLCS=$E(HLECH,1),HLRS=$E(HLECH,2),HLSS=$E(HLECH,4)
"RTN","MAGDHLTC",68,0)
 ;
"RTN","MAGDHLTC",69,0)
 ; build a dummy MSH segment for the $$MAKE^MAG7UM function
"RTN","MAGDHLTC",70,0)
 S MSGA12A(1,0)="MSH"
"RTN","MAGDHLTC",71,0)
 S MSGA12A(1,1,1,1,1)=HLFS
"RTN","MAGDHLTC",72,0)
 S MSGA12A(1,2,1,1,1)=HLECH
"RTN","MAGDHLTC",73,0)
 S MSGA12A(1,9,1,1,1)="ADT"
"RTN","MAGDHLTC",74,0)
 S MSGA12A(1,9,1,2,1)="A12"
"RTN","MAGDHLTC",75,0)
 ;
"RTN","MAGDHLTC",76,0)
 ; gather patient information and populate segment array elements
"RTN","MAGDHLTC",77,0)
 S MSG=$$EVN^MAGDHLS("A12",XDT,XDT,"MSGA12A")
"RTN","MAGDHLTC",78,0)
 S MSG=$$PID^MAGDHLS(XDFN,"MSGA12A")
"RTN","MAGDHLTC",79,0)
 S MSG=$$PV1^MAGDHLS(XDFN,"A12",XDT,"MSGA12A")
"RTN","MAGDHLTC",80,0)
 S MSG=$$ROL^MAGDHLS(XDFN,"MSGA12A")
"RTN","MAGDHLTC",81,0)
 S MSG=$$OBXADT^MAGDHLS(XDFN,"MSGA12A")
"RTN","MAGDHLTC",82,0)
 ;
"RTN","MAGDHLTC",83,0)
 ; assemble message into segments
"RTN","MAGDHLTC",84,0)
 S MSG=$$MAKE^MAG7UM("MSGA12A",$NA(HLA("HLS")))
"RTN","MAGDHLTC",85,0)
 K HLA("HLS",1) ; remove dummy MSH segment
"RTN","MAGDHLTC",86,0)
 ;
"RTN","MAGDHLTC",87,0)
 ; send message to receiver and gateway
"RTN","MAGDHLTC",88,0)
 D GENERATE^HLMA("MAG CPACS A12","LM",1,.RESULT) ; generate & send message
"RTN","MAGDHLTC",89,0)
 D LOGGW^MAGDHLL("ADT") ; log message to gateway
"RTN","MAGDHLTC",90,0)
 Q $S($P($G(RESULT),U,2,$L(RESULT,U))="":0,1:-1_U_RESULT)
"RTN","MAGDHLTC",91,0)
 ;
"RTN","MAGDHLTC",92,0)
A13 ; GOTO entry point from MAGDHLT - cancel patient discharge
"RTN","MAGDHLTC",93,0)
 ; INPUT:  XDFN      IEN of pt whose admission is being cancelled
"RTN","MAGDHLTC",94,0)
 ;         XDT       date/time of cancellation
"RTN","MAGDHLTC",95,0)
 ; function return:   result of message generation from call to GENERATE^HLMA
"RTN","MAGDHLTC",96,0)
 ;
"RTN","MAGDHLTC",97,0)
 N HL ; -------- HL7 initialization function status return
"RTN","MAGDHLTC",98,0)
 N HLA ; ------- array of HL7 message segments
"RTN","MAGDHLTC",99,0)
 N MSGA13A ; --- A13 message array
"RTN","MAGDHLTC",100,0)
 N MSG ; ------- message status
"RTN","MAGDHLTC",101,0)
 ;
"RTN","MAGDHLTC",102,0)
 D INIT^HLFNC2("MAG CPACS A13",.HL)
"RTN","MAGDHLTC",103,0)
 I $G(HL) Q -1_U_$P(HL,"^",2) ; error
"RTN","MAGDHLTC",104,0)
 S HLCS=$E(HLECH,1),HLRS=$E(HLECH,2),HLSS=$E(HLECH,4)
"RTN","MAGDHLTC",105,0)
 ;
"RTN","MAGDHLTC",106,0)
 ; build a dummy MSH segment for the $$MAKE^MAG7UM function
"RTN","MAGDHLTC",107,0)
 S MSGA13A(1,0)="MSH"
"RTN","MAGDHLTC",108,0)
 S MSGA13A(1,1,1,1,1)=HLFS
"RTN","MAGDHLTC",109,0)
 S MSGA13A(1,2,1,1,1)=HLECH
"RTN","MAGDHLTC",110,0)
 S MSGA13A(1,9,1,1,1)="ADT"
"RTN","MAGDHLTC",111,0)
 S MSGA13A(1,9,1,2,1)="A13"
"RTN","MAGDHLTC",112,0)
 ;
"RTN","MAGDHLTC",113,0)
 ; gather patient information and populate segment array elements
"RTN","MAGDHLTC",114,0)
 S MSG=$$EVN^MAGDHLS("A13",XDT,XDT,"MSGA13A")
"RTN","MAGDHLTC",115,0)
 S MSG=$$PID^MAGDHLS(XDFN,"MSGA13A")
"RTN","MAGDHLTC",116,0)
 S MSG=$$PV1^MAGDHLS(XDFN,"A13",XDT,"MSGA13A")
"RTN","MAGDHLTC",117,0)
 S MSG=$$ROL^MAGDHLS(XDFN,"MSGA13A")
"RTN","MAGDHLTC",118,0)
 ;
"RTN","MAGDHLTC",119,0)
 ; assemble message into segments
"RTN","MAGDHLTC",120,0)
 S MSG=$$MAKE^MAG7UM("MSGA13A",$NA(HLA("HLS")))
"RTN","MAGDHLTC",121,0)
 K HLA("HLS",1) ; remove dummy MSH segment
"RTN","MAGDHLTC",122,0)
 ;
"RTN","MAGDHLTC",123,0)
 ; send message to receiver and gateway
"RTN","MAGDHLTC",124,0)
 D GENERATE^HLMA("MAG CPACS A13","LM",1,.RESULT) ; generate & send message
"RTN","MAGDHLTC",125,0)
 D LOGGW^MAGDHLL("ADT") ; log message to gateway
"RTN","MAGDHLTC",126,0)
 Q $S($P($G(RESULT),U,2,$L(RESULT,U))="":0,1:-1_U_RESULT)
"RTN","MAGDHPS")
0^12^B35750729
"RTN","MAGDHPS",1,0)
MAGDHPS ;WOIFO/MLH - Maintain subscriptions to Rad HL7 drivers ; 02 Apr 2008 4:30 PM
"RTN","MAGDHPS",2,0)
 ;;3.0;IMAGING;**49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGDHPS",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDHPS",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHPS",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDHPS",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDHPS",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDHPS",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDHPS",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDHPS",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDHPS",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDHPS",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDHPS",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDHPS",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDHPS",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDHPS",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHPS",17,0)
 ;;
"RTN","MAGDHPS",18,0)
 Q
"RTN","MAGDHPS",19,0)
 ;
"RTN","MAGDHPS",20,0)
MAINT ; MAIN ENTRY POINT - allow the user to select the version of HL7
"RTN","MAGDHPS",21,0)
 ; that will be used to create Radiology messages to the VistA Text/
"RTN","MAGDHPS",22,0)
 ; DICOM Gateway and to commercial imaging systems.
"RTN","MAGDHPS",23,0)
 ; 
"RTN","MAGDHPS",24,0)
 N MAGPIX ; --- protocol index
"RTN","MAGDHPS",25,0)
 N MAGPIXO ; -- protocol index for MAGD SEND ORM
"RTN","MAGDHPS",26,0)
 N MAGPIXR ; -- protocol index for MAGD SEND ORU
"RTN","MAGDHPS",27,0)
 N RADPSTR ; -- Radiology protocol name string
"RTN","MAGDHPS",28,0)
 N I ; -------- scratch index variable
"RTN","MAGDHPS",29,0)
 N RADPA ; ---- array containing Radiology protocol names and IENs
"RTN","MAGDHPS",30,0)
 N RADPEX ; --- exception flag for Radiology protocol name processing
"RTN","MAGDHPS",31,0)
 N RADPI ; ---- Radiology protocol IEN
"RTN","MAGDHPS",32,0)
 N DA,DIC,DIK,DIR,DTOUT,DUOUT,X,Y ; -- FileMan work variables
"RTN","MAGDHPS",33,0)
 N HL7VER ; --- HL7 version desired 
"RTN","MAGDHPS",34,0)
 ;
"RTN","MAGDHPS",35,0)
 ; Are there a MAGD SEND ORM and MAGD SEND ORU protocols for us to subscribe?
"RTN","MAGDHPS",36,0)
 S MAGPIXO=$O(^ORD(101,"B","MAGD SEND ORM",0))
"RTN","MAGDHPS",37,0)
 I MAGPIXO D  ; yes
"RTN","MAGDHPS",38,0)
 . U IO(0) W !!,"MAGD SEND ORM protocol found...",!
"RTN","MAGDHPS",39,0)
 . Q
"RTN","MAGDHPS",40,0)
 E  D  G ABEND  ; no, bail
"RTN","MAGDHPS",41,0)
 . U IO(0) W !!,"ATTENTION:  The MAGD SEND ORM protocol does not exist"
"RTN","MAGDHPS",42,0)
 . W !,"on this system."
"RTN","MAGDHPS",43,0)
 . Q
"RTN","MAGDHPS",44,0)
 ;
"RTN","MAGDHPS",45,0)
 S MAGPIXR=$O(^ORD(101,"B","MAGD SEND ORU",0))
"RTN","MAGDHPS",46,0)
 I MAGPIXR D  ; yes
"RTN","MAGDHPS",47,0)
 . U IO(0) W !!,"MAGD SEND ORU protocol found...",!
"RTN","MAGDHPS",48,0)
 . Q
"RTN","MAGDHPS",49,0)
 E  D  G ABEND  ; no, bail
"RTN","MAGDHPS",50,0)
 . U IO(0) W !!,"ATTENTION:  The MAGD SEND ORU protocol does not exist"
"RTN","MAGDHPS",51,0)
 . W !,"on this system."
"RTN","MAGDHPS",52,0)
 . Q
"RTN","MAGDHPS",53,0)
 ;
"RTN","MAGDHPS",54,0)
 ; Make sure we have all the Radiology protocols we need.
"RTN","MAGDHPS",55,0)
 S RADPSTR="RA CANCEL^RA EXAMINED^RA REG^RA RPT"
"RTN","MAGDHPS",56,0)
 F I=1:1:4 S RADPA(I,0)=$P(RADPSTR,"^",I),RADPA(I+4,0)=RADPA(I,0)_" 2.4"
"RTN","MAGDHPS",57,0)
 S RADPEX=0
"RTN","MAGDHPS",58,0)
 F I=1:1:8 D  G ABEND:RADPEX
"RTN","MAGDHPS",59,0)
 . U IO(0) W !,RADPA(I,0)_" protocol "
"RTN","MAGDHPS",60,0)
 . S RADPI=$O(^ORD(101,"B",RADPA(I,0),0))
"RTN","MAGDHPS",61,0)
 . I RADPI D
"RTN","MAGDHPS",62,0)
 . . U IO(0) W "found..."
"RTN","MAGDHPS",63,0)
 . . S RADPA(I,1)=RADPI
"RTN","MAGDHPS",64,0)
 . . Q
"RTN","MAGDHPS",65,0)
 . E  D
"RTN","MAGDHPS",66,0)
 . . U IO(0) W "not found..."
"RTN","MAGDHPS",67,0)
 . . S RADPEX=1
"RTN","MAGDHPS",68,0)
 . . Q
"RTN","MAGDHPS",69,0)
 . Q
"RTN","MAGDHPS",70,0)
 ;
"RTN","MAGDHPS",71,0)
 ; Find out which version of HL7 they want to send.
"RTN","MAGDHPS",72,0)
 S DIR(0)="SAX^2.1:HL7 Version 2.1;2.4:HL7 Version 2.4"
"RTN","MAGDHPS",73,0)
 S DIR("A")="Enter the desired version of HL7: "
"RTN","MAGDHPS",74,0)
 U IO(0) W !
"RTN","MAGDHPS",75,0)
 D ^DIR G END:$D(DTOUT),END:$D(DUOUT)
"RTN","MAGDHPS",76,0)
 S HL7VER=Y
"RTN","MAGDHPS",77,0)
 U IO(0) W !,"Subscribing to HL7 version "_HL7VER_" protocols..."
"RTN","MAGDHPS",78,0)
 ;
"RTN","MAGDHPS",79,0)
 S RADPEX=0
"RTN","MAGDHPS",80,0)
 I HL7VER=2.1 D  G ABEND:RADPEX
"RTN","MAGDHPS",81,0)
 . ; If 2.1 protocols are already subscribed to, do nothing;
"RTN","MAGDHPS",82,0)
 . ; otherwise, subscribe to them.
"RTN","MAGDHPS",83,0)
 . F I=1:1:4 D  Q:RADPEX
"RTN","MAGDHPS",84,0)
 . . ; associate Imaging and Radiology order and report protocols appropriately
"RTN","MAGDHPS",85,0)
 . . S MAGPIX=$S(I=4:MAGPIXR,1:MAGPIXO)
"RTN","MAGDHPS",86,0)
 . . U IO(0) W !,"   Protocol "_RADPA(I,0)_" "
"RTN","MAGDHPS",87,0)
 . . I $D(^ORD(101,RADPA(I,1),775,"B",MAGPIX)) D
"RTN","MAGDHPS",88,0)
 . . . W "is already subscribed to, no action taken"
"RTN","MAGDHPS",89,0)
 . . . Q
"RTN","MAGDHPS",90,0)
 . . E  D ADD(MAGPIX,RADPA(I,1),.RADPEX)
"RTN","MAGDHPS",91,0)
 . . W "..."
"RTN","MAGDHPS",92,0)
 . . Q
"RTN","MAGDHPS",93,0)
 . ; If 2.4 protocols are currently subscribed to, unsubscribe from them;
"RTN","MAGDHPS",94,0)
 . ; otherwise, do nothing.
"RTN","MAGDHPS",95,0)
 . F I=5:1:8 D
"RTN","MAGDHPS",96,0)
 . . ; associate Imaging and Radiology order and report protocols appropriately
"RTN","MAGDHPS",97,0)
 . . S MAGPIX=$S(I=8:MAGPIXR,1:MAGPIXO)
"RTN","MAGDHPS",98,0)
 . . U IO(0) W !,"   Protocol "_RADPA(I,0)_" "
"RTN","MAGDHPS",99,0)
 . . I $D(^ORD(101,RADPA(I,1),775,"B",MAGPIX)) D
"RTN","MAGDHPS",100,0)
 . . . D KILL(MAGPIX,RADPA(I,1))
"RTN","MAGDHPS",101,0)
 . . . Q
"RTN","MAGDHPS",102,0)
 . . E  D
"RTN","MAGDHPS",103,0)
 . . . W "is not currently subscribed to, no action taken"
"RTN","MAGDHPS",104,0)
 . . . Q
"RTN","MAGDHPS",105,0)
 . . W "..."
"RTN","MAGDHPS",106,0)
 . . Q
"RTN","MAGDHPS",107,0)
 . Q
"RTN","MAGDHPS",108,0)
 ;
"RTN","MAGDHPS",109,0)
 I HL7VER=2.4 D  G ABEND:RADPEX
"RTN","MAGDHPS",110,0)
 . ; If 2.1 protocols are currently subscribed to, unsubscribe from them;
"RTN","MAGDHPS",111,0)
 . ; otherwise, do nothing.
"RTN","MAGDHPS",112,0)
 . F I=1:1:4 D
"RTN","MAGDHPS",113,0)
 . . ; associate Imaging and Radiology order and report protocols appropriately
"RTN","MAGDHPS",114,0)
 . . S MAGPIX=$S(I=4:MAGPIXR,1:MAGPIXO)
"RTN","MAGDHPS",115,0)
 . . U IO(0) W !,"   Protocol "_RADPA(I,0)_" "
"RTN","MAGDHPS",116,0)
 . . I $D(^ORD(101,RADPA(I,1),775,"B",MAGPIX)) D
"RTN","MAGDHPS",117,0)
 . . . D KILL(MAGPIX,RADPA(I,1))
"RTN","MAGDHPS",118,0)
 . . . Q
"RTN","MAGDHPS",119,0)
 . . E  D
"RTN","MAGDHPS",120,0)
 . . . W "is not currently subscribed to, no action taken"
"RTN","MAGDHPS",121,0)
 . . . Q
"RTN","MAGDHPS",122,0)
 . . W "..."
"RTN","MAGDHPS",123,0)
 . . Q
"RTN","MAGDHPS",124,0)
 . ; If 2.4 protocols are already subscribed to, do nothing;
"RTN","MAGDHPS",125,0)
 . ; otherwise, subscribe to them.
"RTN","MAGDHPS",126,0)
 . F I=5:1:8 D  Q:RADPEX
"RTN","MAGDHPS",127,0)
 . . ; associate Imaging and Radiology order and report protocols appropriately
"RTN","MAGDHPS",128,0)
 . . S MAGPIX=$S(I=8:MAGPIXR,1:MAGPIXO)
"RTN","MAGDHPS",129,0)
 . . U IO(0) W !,"   Protocol "_RADPA(I,0)_" "
"RTN","MAGDHPS",130,0)
 . . I $D(^ORD(101,RADPA(I,1),775,"B",MAGPIX)) D
"RTN","MAGDHPS",131,0)
 . . . W "is already subscribed to, no action taken"
"RTN","MAGDHPS",132,0)
 . . . Q
"RTN","MAGDHPS",133,0)
 . . E  D ADD(MAGPIX,RADPA(I,1),.RADPEX)
"RTN","MAGDHPS",134,0)
 . . W "..."
"RTN","MAGDHPS",135,0)
 . . Q
"RTN","MAGDHPS",136,0)
 . Q
"RTN","MAGDHPS",137,0)
 ;
"RTN","MAGDHPS",138,0)
 G END
"RTN","MAGDHPS",139,0)
 ; 
"RTN","MAGDHPS",140,0)
ABEND ; exception raised
"RTN","MAGDHPS",141,0)
 U IO(0) W !,"Please contact Imaging Support for further assistance."
"RTN","MAGDHPS",142,0)
END ;
"RTN","MAGDHPS",143,0)
 Q
"RTN","MAGDHPS",144,0)
 ;
"RTN","MAGDHPS",145,0)
ADD(SUB,EVENTDRV,STATFLAG) ; SUBROUTINE - not to be invoked except from within this routine
"RTN","MAGDHPS",146,0)
 ; Subscribe gateway protocol SUB to the Radiology event driver protocol EVENTDRV.
"RTN","MAGDHPS",147,0)
 N Y,DIC,DA,X ; -- Fileman variables
"RTN","MAGDHPS",148,0)
 S DIC="^ORD(101,"_EVENTDRV_",775,",DIC(0)="L",DA(1)=EVENTDRV,X=SUB
"RTN","MAGDHPS",149,0)
 D FILE^DICN
"RTN","MAGDHPS",150,0)
 I Y=-1 S STATFLAG=1
"RTN","MAGDHPS",151,0)
 W $S('$G(STATFLAG):"has been",1:"could not be")_" subscribed to"
"RTN","MAGDHPS",152,0)
 Q
"RTN","MAGDHPS",153,0)
 ;
"RTN","MAGDHPS",154,0)
KILL(SUB,EVENTDRV) ; SUBROUTINE - not to be invoked except from within this routine
"RTN","MAGDHPS",155,0)
 ; Unsubscribe gateway protocol SUB from the Radiology event driver protocol EVENTDRV.
"RTN","MAGDHPS",156,0)
 N DA,DIK ; -- Fileman variables
"RTN","MAGDHPS",157,0)
 S DA(1)=EVENTDRV,DA=$O(^ORD(101,DA(1),775,"B",SUB,0))
"RTN","MAGDHPS",158,0)
 S DIK="^ORD(101,"_EVENTDRV_",775,"
"RTN","MAGDHPS",159,0)
 D ^DIK
"RTN","MAGDHPS",160,0)
 W "has been unsubscribed from"
"RTN","MAGDHPS",161,0)
 Q
"RTN","MAGDHRC0")
0^13^B7768511
"RTN","MAGDHRC0",1,0)
MAGDHRC0 ;WOIFO/PMK - Read HL7 and generate DICOM ; 28 Mar 2011 10:30 AM
"RTN","MAGDHRC0",2,0)
 ;;3.0;IMAGING;**46,54,49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGDHRC0",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDHRC0",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHRC0",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDHRC0",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDHRC0",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDHRC0",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDHRC0",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDHRC0",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDHRC0",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDHRC0",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDHRC0",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDHRC0",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDHRC0",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDHRC0",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHRC0",17,0)
 ;;
"RTN","MAGDHRC0",18,0)
 Q
"RTN","MAGDHRC0",19,0)
 ;
"RTN","MAGDHRC0",20,0)
 ; Functions for accessing parsed HL7 data
"RTN","MAGDHRC0",21,0)
 ;
"RTN","MAGDHRC0",22,0)
GETDATA(FLD,REP,CMP,SUB) ; get an element from HL7PARSE
"RTN","MAGDHRC0",23,0)
 Q:'$D(FLD) $$DEQUOTE($G(@HL7PARSE@(HL7SEGNO))) ; segment
"RTN","MAGDHRC0",24,0)
 Q:'$D(REP) $$DEQUOTE($G(@HL7PARSE@(HL7SEGNO,FLD))) ; field
"RTN","MAGDHRC0",25,0)
 Q:'$D(CMP) $$DEQUOTE($G(@HL7PARSE@(HL7SEGNO,FLD,REP))) ; repetition
"RTN","MAGDHRC0",26,0)
 Q:'$D(SUB) $$DEQUOTE($G(@HL7PARSE@(HL7SEGNO,FLD,REP,CMP))) ; component
"RTN","MAGDHRC0",27,0)
 Q $$DEQUOTE($G(@HL7PARSE@(HL7SEGNO,FLD,REP,CMP,SUB))) ; subcomponent
"RTN","MAGDHRC0",28,0)
 ;
"RTN","MAGDHRC0",29,0)
DEQUOTE(X) ; convert HL7 double quote data (that is, "") to empty string
"RTN","MAGDHRC0",30,0)
 Q $S(X="""""":"",1:X)
"RTN","MAGDHRC0",31,0)
 ;
"RTN","MAGDHRC0",32,0)
GETEXIST(FLD,REP,CMP,SUB) ; does the element (segment/field/rep/comp) exist
"RTN","MAGDHRC0",33,0)
 Q:'$D(FLD) $D(@HL7PARSE@(HL7SEGNO)) ; segment
"RTN","MAGDHRC0",34,0)
 Q:'$D(REP) $D(@HL7PARSE@(HL7SEGNO,FLD)) ; field
"RTN","MAGDHRC0",35,0)
 Q:'$D(CMP) $D(@HL7PARSE@(HL7SEGNO,FLD,REP)) ; repetition
"RTN","MAGDHRC0",36,0)
 Q:'$D(SUB) $D(@HL7PARSE@(HL7SEGNO,FLD,REP,CMP)) ; component
"RTN","MAGDHRC0",37,0)
 Q $D(@HL7PARSE@(HL7SEGNO,FLD,REP,CMP,SUB)) ; subcomponent
"RTN","MAGDHRC0",38,0)
 ;
"RTN","MAGDHRC0",39,0)
GETSEG(SEGMENT) ; check if the named segment exists
"RTN","MAGDHRC0",40,0)
 Q:SEGMENT'="" $O(@HL7PARSE@("B",SEGMENT,""))
"RTN","MAGDHRC0",41,0)
 Q 0
"RTN","MAGDHRC0",42,0)
 ;
"RTN","MAGDHRC0",43,0)
GETCOUNT() ; get highest index number from HL7PARSE
"RTN","MAGDHRC0",44,0)
 Q $O(@HL7PARSE@(" "),-1)
"RTN","MAGDHRC0",45,0)
 ;
"RTN","MAGDHRC0",46,0)
GETNAME(J,K) ; get a person's name - return in DICOM format
"RTN","MAGDHRC0",47,0)
 ; also used for provider's name - first piece is code - others shifted
"RTN","MAGDHRC0",48,0)
 N I,LAST,NAME,X
"RTN","MAGDHRC0",49,0)
 S NAME="",LAST=0,K=$G(K,1) F I=1:1:6 D
"RTN","MAGDHRC0",50,0)
 . N X ; name component: last ^ first ^ mi ^ prefix ^ suffix
"RTN","MAGDHRC0",51,0)
 . S X=$$GETDATA^MAGDHRC0(J,K,I) I $L(X) S LAST=I
"RTN","MAGDHRC0",52,0)
 . S NAME=NAME_$S(I>1:"^",1:"")_$TR(X,"^\","") ; no ^ or \ chars in name
"RTN","MAGDHRC0",53,0)
 . Q
"RTN","MAGDHRC0",54,0)
 Q $P(NAME,"^",1,LAST)
"RTN","MAGDHRC0",55,0)
 ;
"RTN","MAGDHW0")
0^14^B9185901
"RTN","MAGDHW0",1,0)
MAGDHW0 ;WOIFO/PMK - Capture Consult/Request data ; 28 Mar 2006  9:07 AM
"RTN","MAGDHW0",2,0)
 ;;3.0;IMAGING;**10,86,49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGDHW0",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDHW0",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHW0",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDHW0",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDHW0",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDHW0",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDHW0",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDHW0",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDHW0",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDHW0",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDHW0",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDHW0",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDHW0",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDHW0",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHW0",17,0)
 ;;
"RTN","MAGDHW0",18,0)
 ;
"RTN","MAGDHW0",19,0)
 ;
"RTN","MAGDHW0",20,0)
 Q
"RTN","MAGDHW0",21,0)
 ;
"RTN","MAGDHW0",22,0)
INIT ;
"RTN","MAGDHW0",23,0)
 ; simulate call to INT^HLFNC2
"RTN","MAGDHW0",24,0)
 N I
"RTN","MAGDHW0",25,0)
 S HL("CC")="US"
"RTN","MAGDHW0",26,0)
 S HL("ECH")="^~\&"
"RTN","MAGDHW0",27,0)
 S HL("ETN")=""
"RTN","MAGDHW0",28,0)
 S HL("FS")="|"
"RTN","MAGDHW0",29,0)
 S HL("MTN")="ORM"
"RTN","MAGDHW0",30,0)
 S HL("PID")="D"
"RTN","MAGDHW0",31,0)
 S HL("Q")=""
"RTN","MAGDHW0",32,0)
 S HL("SAF")=^DD("SITE",1)
"RTN","MAGDHW0",33,0)
 S HL("SAN")="MAGD-SCH"
"RTN","MAGDHW0",34,0)
 S HL("VER")="2.3.1"
"RTN","MAGDHW0",35,0)
 S DEL=HL("FS")
"RTN","MAGDHW0",36,0)
 F I=1:1:$L(HL("ECH")) S @("DEL"_(I+1))=$E(HL("ECH"),I)
"RTN","MAGDHW0",37,0)
 S U="^"
"RTN","MAGDHW0",38,0)
 Q
"RTN","MAGDHW0",39,0)
 ;
"RTN","MAGDHW0",40,0)
FINDSEG(ARRAY,SEGMENT,I,X) ; find a specific HL7 segment in an array
"RTN","MAGDHW0",41,0)
 ; input -- ARRAY ---- an HL7 array
"RTN","MAGDHW0",42,0)
 ; input -- SEGMENT -- three-letter HL7 segment identifier 
"RTN","MAGDHW0",43,0)
 ; input -- I -------- index of the found segment (or null)
"RTN","MAGDHW0",44,0)
 ; output - I -------- index of the found segment (or null)
"RTN","MAGDHW0",45,0)
 ; output - X -------- string of fields sans segment identifier
"RTN","MAGDHW0",46,0)
 ; return - HIT ------ flag indicating segment found 
"RTN","MAGDHW0",47,0)
 ;
"RTN","MAGDHW0",48,0)
 N HIT
"RTN","MAGDHW0",49,0)
 S HIT=0
"RTN","MAGDHW0",50,0)
 F  S I=$O(ARRAY(I)) Q:I=""  I $P(ARRAY(I),DEL)=SEGMENT D  Q
"RTN","MAGDHW0",51,0)
 . S X=$P(ARRAY(I),DEL,2,99999) ; strip off the segment name
"RTN","MAGDHW0",52,0)
 . S HIT=1
"RTN","MAGDHW0",53,0)
 . Q
"RTN","MAGDHW0",54,0)
 Q HIT
"RTN","MAGDHW0",55,0)
 ;
"RTN","MAGDHW0",56,0)
SAVESEG(I,X) ; save updated segment
"RTN","MAGDHW0",57,0)
 S $P(HL7(I),DEL,2,999)=X
"RTN","MAGDHW0",58,0)
 Q
"RTN","MAGDHW0",59,0)
 ;
"RTN","MAGDHW0",60,0)
ADDSEG(X) ; add a new segment to the end if the message
"RTN","MAGDHW0",61,0)
 S HL7($O(HL7(""),-1)+1)=X
"RTN","MAGDHW0",62,0)
 Q
"RTN","MAGDHW0",63,0)
 ;
"RTN","MAGDHW0",64,0)
OUTPUT ; output the message to ^MAGDHL7
"RTN","MAGDHW0",65,0)
 N DIC,DIE,D0,DA,DR,I,J,K,X,Y,Z
"RTN","MAGDHW0",66,0)
 S X=FMDATE,DIC="^MAGDHL7(2006.5,",DIC(0)="LZ" D FILE^DICN S D0=+Y
"RTN","MAGDHW0",67,0)
 S DIE=DIC,DR=".03///^S X=FMDATETM",DA=D0 D ^DIE ; capture time
"RTN","MAGDHW0",68,0)
 S $P(^MAGDHL7(2006.5,D0,0),"^",2)="ORM" ; all are ORM
"RTN","MAGDHW0",69,0)
 S I="HL7",J=0 F  S I=$Q(@I) Q:I=""  D
"RTN","MAGDHW0",70,0)
 . S X=@I,Y=$P(X,DEL)
"RTN","MAGDHW0",71,0)
 . F K=2:1:$L(X,DEL) D  ; copy the lines to the ^MAGDHL7 global
"RTN","MAGDHW0",72,0)
 . . S Z=$P(X,DEL,K)
"RTN","MAGDHW0",73,0)
 . . I ($L(Y)+$L(Z))>200 D  ; keep lines short for the global
"RTN","MAGDHW0",74,0)
 . . . ; output one line of a spanned record
"RTN","MAGDHW0",75,0)
 . . . S J=J+1,^MAGDHL7(2006.5,D0,1,J,0)=Y,Y=""
"RTN","MAGDHW0",76,0)
 . . . Q
"RTN","MAGDHW0",77,0)
 . . S Y=Y_DEL_$P(X,DEL,K)
"RTN","MAGDHW0",78,0)
 . . Q
"RTN","MAGDHW0",79,0)
 . S J=J+1,^MAGDHL7(2006.5,D0,1,J,0)=Y
"RTN","MAGDHW0",80,0)
 . Q
"RTN","MAGDHW0",81,0)
 ; The next line must be last, since WAIT^MAGDHRS1
"RTN","MAGDHW0",82,0)
 ; uses this node to determine that the entry is complete.
"RTN","MAGDHW0",83,0)
 S ^MAGDHL7(2006.5,D0,1,0)="^^"_J_"^"_J_"^"_FMDATETM
"RTN","MAGDHW0",84,0)
 Q
"RTN","MAGDHWA")
0^15^B45705303
"RTN","MAGDHWA",1,0)
MAGDHWA ;WOIFO/PMK - Capture Consult/Request data ; 19 Mar 2009 6:36 AM
"RTN","MAGDHWA",2,0)
 ;;3.0;IMAGING;**10,51,50,49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGDHWA",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDHWA",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHWA",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDHWA",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDHWA",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDHWA",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDHWA",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDHWA",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDHWA",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDHWA",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDHWA",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDHWA",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDHWA",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDHWA",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHWA",17,0)
 ;;
"RTN","MAGDHWA",18,0)
 Q
"RTN","MAGDHWA",19,0)
 ; entry points called by both ^MAGDHWC and ^MAGDHWS
"RTN","MAGDHWA",20,0)
 ;
"RTN","MAGDHWA",21,0)
MSH ; update MSH segment
"RTN","MAGDHWA",22,0)
 S $P(HL7(1),DEL,5)="VI-CONSULT" ; receiving application
"RTN","MAGDHWA",23,0)
 S $P(HL7(1),DEL,6)=$P(HL7(1),DEL,4) ; receiving facility
"RTN","MAGDHWA",24,0)
 S $P(HL7(1),DEL,7)=$$FMTHL7^XLFDT(FMDATETM)
"RTN","MAGDHWA",25,0)
 Q
"RTN","MAGDHWA",26,0)
 ;
"RTN","MAGDHWA",27,0)
PID ; update PID & PV1 segments
"RTN","MAGDHWA",28,0)
 N DFN,HL7SEG,I,X
"RTN","MAGDHWA",29,0)
 ; update PID segment
"RTN","MAGDHWA",30,0)
 S I=0 I $$FINDSEG^MAGDHW0(.HL7,"PID",.I,.X) D
"RTN","MAGDHWA",31,0)
 . N HL,HL7ARRAY,HLECH,HLFS,HLQ,NUL
"RTN","MAGDHWA",32,0)
 . S DFN=$P(X,DEL,3)
"RTN","MAGDHWA",33,0)
 . D INIT^MAGDHW0
"RTN","MAGDHWA",34,0)
 . S HLECH=HL("ECH")
"RTN","MAGDHWA",35,0)
 . S HLFS=HL("FS")
"RTN","MAGDHWA",36,0)
 . S HLQ=HL("Q")
"RTN","MAGDHWA",37,0)
 . S HL7ARRAY(1,9,1,1,1)=""
"RTN","MAGDHWA",38,0)
 . S HL7ARRAY(1,0)="MSH"
"RTN","MAGDHWA",39,0)
 . S HL7ARRAY(1,1,1,1,1)=HLFS
"RTN","MAGDHWA",40,0)
 . S HL7ARRAY(1,2,1,1,1)=HLECH
"RTN","MAGDHWA",41,0)
 . D PID^MAGDHLS(DFN,"HL7ARRAY")
"RTN","MAGDHWA",42,0)
 . D PV1^MAGDHLS(DFN,"",DT,"HL7ARRAY")
"RTN","MAGDHWA",43,0)
 . ;
"RTN","MAGDHWA",44,0)
 . S NUL=$$MAKE^MAG7UM("HL7ARRAY","HL7SEG")
"RTN","MAGDHWA",45,0)
 . S HL7(I)=HL7SEG(2)
"RTN","MAGDHWA",46,0)
 . Q
"RTN","MAGDHWA",47,0)
 ; update PV1 segment
"RTN","MAGDHWA",48,0)
 S I=0 I $$FINDSEG^MAGDHW0(.HL7,"PV1",.I,.X) D
"RTN","MAGDHWA",49,0)
 . S HL7(I)=HL7SEG(3)
"RTN","MAGDHWA",50,0)
 . Q
"RTN","MAGDHWA",51,0)
 Q
"RTN","MAGDHWA",52,0)
 ;
"RTN","MAGDHWA",53,0)
ORC ; update ORC segment
"RTN","MAGDHWA",54,0)
 N D0,I,J,NAME,X
"RTN","MAGDHWA",55,0)
 S CONSULT=DEL2 ; consult always contains DEL2
"RTN","MAGDHWA",56,0)
 S I=0 I $$FINDSEG^MAGDHW0(.HL7,"ORC",.I,.X) D
"RTN","MAGDHWA",57,0)
 . ; get consult ien for OBR segment
"RTN","MAGDHWA",58,0)
 . S CONSULT=$P(X,DEL,3)
"RTN","MAGDHWA",59,0)
 . ; add names of order enterer and ordering provider
"RTN","MAGDHWA",60,0)
 . F J=10,12 D
"RTN","MAGDHWA",61,0)
 . . S D0=$P(X,DEL,J),NAME=$S(D0:$$GET1^DIQ(200,D0,.01),1:"")
"RTN","MAGDHWA",62,0)
 . . S NAME=$TR(NAME,", ",DEL2_DEL2)
"RTN","MAGDHWA",63,0)
 . . S $P(X,DEL,J)=D0_DEL2_NAME
"RTN","MAGDHWA",64,0)
 . . Q
"RTN","MAGDHWA",65,0)
 . D SAVESEG^MAGDHW0(I,X)
"RTN","MAGDHWA",66,0)
 . Q
"RTN","MAGDHWA",67,0)
 Q
"RTN","MAGDHWA",68,0)
 ;
"RTN","MAGDHWA",69,0)
OBR ; update OBR segment
"RTN","MAGDHWA",70,0)
 N I,X,Z
"RTN","MAGDHWA",71,0)
 S I=0 I $$FINDSEG^MAGDHW0(.HL7,"OBR",.I,.X) D
"RTN","MAGDHWA",72,0)
 . S $P(X,DEL,3)=CONSULT_DEL2_"L",GMRCIEN=+CONSULT
"RTN","MAGDHWA",73,0)
 . S Z=$$GET1^DIQ(123,GMRCIEN,5,"I") ; urgency
"RTN","MAGDHWA",74,0)
 . I Z S $P(X,DEL,5)=$$GET1^DIQ(101,Z,1) ; priority
"RTN","MAGDHWA",75,0)
 . ;
"RTN","MAGDHWA",76,0)
 . S Z=$$GET1^DIQ(123,GMRCIEN,6,"I") ; place of consult
"RTN","MAGDHWA",77,0)
 . I Z S $P(X,DEL,18)=$$GET1^DIQ(101,Z,1) ; placer field #1
"RTN","MAGDHWA",78,0)
 . ;
"RTN","MAGDHWA",79,0)
 . S Z=$$GET1^DIQ(123,GMRCIEN,13,"I") ; request type
"RTN","MAGDHWA",80,0)
 . S Z=$S(Z="C":"CONSULT",Z="P":"PROCEDURE",1:"UNKNOWN")
"RTN","MAGDHWA",81,0)
 . S $P(X,DEL,19)=Z ; consult/procedure flag - placer field #2
"RTN","MAGDHWA",82,0)
 . ;
"RTN","MAGDHWA",83,0)
 . ; store the current CPRS GMRC or Appointment Scheduling status
"RTN","MAGDHWA",84,0)
 . ; FILLER1 is also set in ^MAGDHWS
"RTN","MAGDHWA",85,0)
 . I '$D(FILLER1) S FILLER1="GMRC-"_$$GET1^DIQ(123,GMRCIEN,8)
"RTN","MAGDHWA",86,0)
 . ; make linkage between the image group and the TIU note, if necessary
"RTN","MAGDHWA",87,0)
 . I MSGTYPE["RESULT",$$NEWTIU(GMRCIEN) S $P(FILLER1,DEL2,2)="LINKED"
"RTN","MAGDHWA",88,0)
 . S $P(X,DEL,20)=FILLER1
"RTN","MAGDHWA",89,0)
 . ;
"RTN","MAGDHWA",90,0)
 . ; store the clinic for the appointment in "filler field 2"
"RTN","MAGDHWA",91,0)
 . I $D(APTSCHED("CLINIC IEN")),$D(APTSCHED("CLINIC NAME")) D
"RTN","MAGDHWA",92,0)
 . . S $P(X,DEL,21)=APTSCHED("CLINIC IEN")_DEL2_APTSCHED("CLINIC NAME")
"RTN","MAGDHWA",93,0)
 . . Q
"RTN","MAGDHWA",94,0)
 . ;
"RTN","MAGDHWA",95,0)
 . ; CPRS Attention - HL7 "Result Copies To" field
"RTN","MAGDHWA",96,0)
 . S Z=$$GET1^DIQ(123,GMRCIEN,7,"I") ; pointer to ^VA(200)
"RTN","MAGDHWA",97,0)
 . I Z S $P(X,DEL,28)=Z_DEL2_$TR($$GET1^DIQ(200,Z,.01),", ",DEL2_DEL2)
"RTN","MAGDHWA",98,0)
 . ;
"RTN","MAGDHWA",99,0)
 . ; date and time of scheduled appointment
"RTN","MAGDHWA",100,0)
 . I $D(APTSCHED("FM DATETIME")) D
"RTN","MAGDHWA",101,0)
 . . S $P(X,DEL,36)=$$FMTHL7^XLFDT(APTSCHED("FM DATETIME"))
"RTN","MAGDHWA",102,0)
 . . Q
"RTN","MAGDHWA",103,0)
 . ;
"RTN","MAGDHWA",104,0)
 . ; from service (requesting service)
"RTN","MAGDHWA",105,0)
 . S Z=$$GET1^DIQ(123,GMRCIEN,2,"I") ; pointer to ^SC(Z)
"RTN","MAGDHWA",106,0)
 . I Z S $P(X,DEL,47)=Z_DEL2_$$GET1^DIQ(44,Z,.01)
"RTN","MAGDHWA",107,0)
 . D SAVESEG^MAGDHW0(I,X)
"RTN","MAGDHWA",108,0)
 . Q
"RTN","MAGDHWA",109,0)
 Q
"RTN","MAGDHWA",110,0)
 ;
"RTN","MAGDHWA",111,0)
ZSV ; find ZSV segment and add imaging type code
"RTN","MAGDHWA",112,0)
 N I,Z
"RTN","MAGDHWA",113,0)
 S I=0 I $$FINDSEG^MAGDHW0(.HL7,"ZSV",.I,.X) D
"RTN","MAGDHWA",114,0)
 . S $P(X,DEL,3)=ITYPCODE_DEL2_ITYPNAME_DEL2_DIVISION
"RTN","MAGDHWA",115,0)
 . S $P(X,DEL,4)=$G(ORIGSERV) ; original service for a FORWARD request
"RTN","MAGDHWA",116,0)
 . D SAVESEG^MAGDHW0(I,X)
"RTN","MAGDHWA",117,0)
 . Q
"RTN","MAGDHWA",118,0)
 Q
"RTN","MAGDHWA",119,0)
 ;
"RTN","MAGDHWA",120,0)
ALLERGY ; check to see if patient has any allergies
"RTN","MAGDHWA",121,0)
 N GMRA,GMRAL,I,X
"RTN","MAGDHWA",122,0)
 D EN1^GMRADPT
"RTN","MAGDHWA",123,0)
 S I=0 F  S I=$O(GMRAL(I)) Q:'I  D  ; include each allergy string as an HL7 OBX segment
"RTN","MAGDHWA",124,0)
 . S OBXSEGNO=OBXSEGNO+1
"RTN","MAGDHWA",125,0)
 . S X="OBX|"_OBXSEGNO_"|TX|A^ALLERGIES^L||",X=$TR(X,"|^",DEL_DEL2)
"RTN","MAGDHWA",126,0)
 . S X=X_$P(GMRAL(I),"^",2)
"RTN","MAGDHWA",127,0)
 . S X=X_DEL_DEL_DEL_DEL_DEL_DEL ; final six delimiters
"RTN","MAGDHWA",128,0)
 . D ADDSEG^MAGDHW0(X)
"RTN","MAGDHWA",129,0)
 . Q
"RTN","MAGDHWA",130,0)
 Q
"RTN","MAGDHWA",131,0)
 ;
"RTN","MAGDHWA",132,0)
POSTINGS ; check if the patient has any other postings
"RTN","MAGDHWA",133,0)
 N I,HIT,MSG
"RTN","MAGDHWA",134,0)
 D ENCOVER^TIUPP3(DFN) I MSG Q  ; MSG="0^Patient posting found"
"RTN","MAGDHWA",135,0)
 S (I,HIT)=0
"RTN","MAGDHWA",136,0)
 F  S I=$O(^TMP("TIUPPCV",$J,I)) Q:'I  I $P(^(I),"^",2)'="A" S HIT=1 Q
"RTN","MAGDHWA",137,0)
 I HIT D
"RTN","MAGDHWA",138,0)
 . S X="OBX|"_OBXSEGNO_"|TX|P^POSTINGS^L||"
"RTN","MAGDHWA",139,0)
 . S X=$TR(X,"|^",DEL_DEL2)
"RTN","MAGDHWA",140,0)
 . S X=X_"Please see CPRS for additional information about Postings."
"RTN","MAGDHWA",141,0)
 . S X=X_DEL_DEL_DEL_DEL_DEL_DEL ; final six delimiters
"RTN","MAGDHWA",142,0)
 . D ADDSEG^MAGDHW0(X)
"RTN","MAGDHWA",143,0)
 . Q
"RTN","MAGDHWA",144,0)
 Q
"RTN","MAGDHWA",145,0)
 ;
"RTN","MAGDHWA",146,0)
NEWTIU(GMRCIEN) ; check if this is a TIU note to be linked to an image group
"RTN","MAGDHWA",147,0)
 ; if so, create the cross-linkages now
"RTN","MAGDHWA",148,0)
 N CROSSREF,D0,FILEDATA,HIT,MAGGP,MAGIEN,NIMAGE,TIUIEN
"RTN","MAGDHWA",149,0)
 S HIT=0
"RTN","MAGDHWA",150,0)
 S D0=""
"RTN","MAGDHWA",151,0)
 F  S D0=$O(^MAG(2006.5839,"C",123,GMRCIEN,D0)) Q:'D0  D
"RTN","MAGDHWA",152,0)
 . S MAGGP=$P($G(^MAG(2006.5839,D0,0)),"^",3) Q:'MAGGP
"RTN","MAGDHWA",153,0)
 . S TIUIEN=$$TIULAST^MAGDGMRC(GMRCIEN) Q:'TIUIEN
"RTN","MAGDHWA",154,0)
 . S $P(^MAG(2005,MAGGP,2),"^",6,7)="8925^"_TIUIEN
"RTN","MAGDHWA",155,0)
 . D TIUXLINK ; create the cross-linkages to TIU
"RTN","MAGDHWA",156,0)
 . ; update the parent file pointers for all the images
"RTN","MAGDHWA",157,0)
 . S CROSSREF="8925^"_TIUIEN_"^"_FILEDATA("PARENT FILE PTR")
"RTN","MAGDHWA",158,0)
 . S NIMAGE=0 F  S NIMAGE=$O(^MAG(2005,MAGGP,1,NIMAGE)) Q:'NIMAGE  D
"RTN","MAGDHWA",159,0)
 . . S MAGIEN=$P(^MAG(2005,MAGGP,1,NIMAGE,0),"^")
"RTN","MAGDHWA",160,0)
 . . S $P(^MAG(2005,MAGIEN,2),"^",6,8)=CROSSREF
"RTN","MAGDHWA",161,0)
 . . Q
"RTN","MAGDHWA",162,0)
 . ; remove entries from ^MAG(2006.5839) & decrement the counter
"RTN","MAGDHWA",163,0)
 . K ^MAG(2006.5839,D0),^MAG(2006.5839,"C",123,GMRCIEN,D0)
"RTN","MAGDHWA",164,0)
 . L +^MAG(2006.5839):1E9 ; Background process MUST wait
"RTN","MAGDHWA",165,0)
 . S $P(^MAG(2006.5839,0),"^",4)=$P(^MAG(2006.5839,0),"^",4)-1
"RTN","MAGDHWA",166,0)
 . L -^MAG(2006.5839)
"RTN","MAGDHWA",167,0)
 . S HIT=1
"RTN","MAGDHWA",168,0)
 . Q
"RTN","MAGDHWA",169,0)
 Q HIT
"RTN","MAGDHWA",170,0)
 ;
"RTN","MAGDHWA",171,0)
TIUXLINK ; create the cross-linkages to TIU EXTERNAL DATA LINK file
"RTN","MAGDHWA",172,0)
 N TIUXDIEN
"RTN","MAGDHWA",173,0)
 D PUTIMAGE^TIUSRVPL(.TIUXDIEN,TIUIEN,MAGGP)
"RTN","MAGDHWA",174,0)
 I TIUXDIEN D
"RTN","MAGDHWA",175,0)
 . S FILEDATA("PARENT FILE PTR")=TIUXDIEN
"RTN","MAGDHWA",176,0)
 . S $P(^MAG(2005,MAGGP,2),"^",8)=TIUXDIEN
"RTN","MAGDHWA",177,0)
 . Q
"RTN","MAGDHWA",178,0)
 E  D  ; fatal error
"RTN","MAGDHWA",179,0)
 . N MSG
"RTN","MAGDHWA",180,0)
 . S MSG(1)="ERROR ASSOCIATING WITH TIU EXTERNAL DATA LINK (file 8925.91):"
"RTN","MAGDHWA",181,0)
 . S MSG(2)=$P(TIUXDIEN,"^",2,999)
"RTN","MAGDHWA",182,0)
 . S X="ERR^MAGGTERR",@^%ZOSF("TRAP")
"RTN","MAGDHWA",183,0)
 . Q
"RTN","MAGDHWA",184,0)
 Q
"RTN","MAGDHWR")
0^16^B7473279
"RTN","MAGDHWR",1,0)
MAGDHWR ;WOIFO/EdM - RPCs for ADT ; 31 Aug 2010 2:19 PM
"RTN","MAGDHWR",2,0)
 ;;3.0;IMAGING;**49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGDHWR",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDHWR",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHWR",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDHWR",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDHWR",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDHWR",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDHWR",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDHWR",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDHWR",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDHWR",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDHWR",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDHWR",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDHWR",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDHWR",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDHWR",17,0)
 ;;
"RTN","MAGDHWR",18,0)
 Q
"RTN","MAGDHWR",19,0)
 ;
"RTN","MAGDHWR",20,0)
GETPAT(OUT,DFN) ; RPC = MAG DICOM GET PATIENT VITALS
"RTN","MAGDHWR",21,0)
 N GMRVSTR,IDX,N,REVDAT,T,UNITS,VIEN,X
"RTN","MAGDHWR",22,0)
 K OUT
"RTN","MAGDHWR",23,0)
 I '$G(DFN) S OUT(1)="-1,No DFN specified" Q
"RTN","MAGDHWR",24,0)
 I $$GET1^DIQ(2,DFN,.01)="" S OUT(1)="-2,No Patient has DFN """_DFN_"""." Q
"RTN","MAGDHWR",25,0)
 ;
"RTN","MAGDHWR",26,0)
 K ^UTILITY($J,"GMRVD") ; refresh the return array
"RTN","MAGDHWR",27,0)
 S GMRVSTR="HT;WT"
"RTN","MAGDHWR",28,0)
 S GMRVSTR(0)="^^1" ; one occurrence each of height and weight
"RTN","MAGDHWR",29,0)
 D EN1^GMRVUT0 ; IA # 14 (currently retired, though)
"RTN","MAGDHWR",30,0)
 S N=0
"RTN","MAGDHWR",31,0)
 ;
"RTN","MAGDHWR",32,0)
 S UNITS("HT")="HEIGHT^^m^meter"
"RTN","MAGDHWR",33,0)
 S UNITS("WT")="WEIGHT^^kg^kilogram"
"RTN","MAGDHWR",34,0)
 ;
"RTN","MAGDHWR",35,0)
 ; Height and Weight
"RTN","MAGDHWR",36,0)
 F IDX="HT","WT" D:$D(^UTILITY($J,"GMRVD",IDX))
"RTN","MAGDHWR",37,0)
 . S REVDAT=$O(^UTILITY($J,"GMRVD",IDX,0)) Q:'REVDAT
"RTN","MAGDHWR",38,0)
 . S VIEN=$O(^UTILITY($J,"GMRVD",IDX,REVDAT,"")) Q:'VIEN
"RTN","MAGDHWR",39,0)
 . ; if a measurement exists, populate the message array
"RTN","MAGDHWR",40,0)
 . S X=UNITS(IDX)
"RTN","MAGDHWR",41,0)
 . S T=$P($G(^UTILITY($J,"GMRVD",IDX,REVDAT,VIEN)),U,13)
"RTN","MAGDHWR",42,0)
 . ; Height is provided in centimeters, should be returned in meters
"RTN","MAGDHWR",43,0)
 . S:IDX="HT" T=T/100
"RTN","MAGDHWR",44,0)
 . S $P(X,"^",2)=T
"RTN","MAGDHWR",45,0)
 . S N=N+1,OUT(N)=X
"RTN","MAGDHWR",46,0)
 . Q
"RTN","MAGDHWR",47,0)
 ;
"RTN","MAGDHWR",48,0)
 ; VIP Indicator
"RTN","MAGDHWR",49,0)
 ;E - Patient is a VA employee
"RTN","MAGDHWR",50,0)
 ;S - Patient record is sensitive
"RTN","MAGDHWR",51,0)
 ;ES - Patient is a VA employee and patient record is sensitive
"RTN","MAGDHWR",52,0)
 S X=$S($$EMPL^DGSEC4(DFN)=1:"E",1:"") ; IA # 3646
"RTN","MAGDHWR",53,0)
 S X=X_$S($P($G(^DGSL(38.1,DFN,0)),"^",2)=1:"S",1:"") ; IA # 767
"RTN","MAGDHWR",54,0)
 S N=N+1,OUT(N)="VIP^"_X
"RTN","MAGDHWR",55,0)
 Q
"RTN","MAGDIR8A")
0^17^B35665323
"RTN","MAGDIR8A",1,0)
MAGDIR8A ;WOIFO/PMK - Read a DICOM image file ; 15 May 2007  10:42 AM
"RTN","MAGDIR8A",2,0)
 ;;3.0;IMAGING;**11,51,49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGDIR8A",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDIR8A",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR8A",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDIR8A",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDIR8A",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDIR8A",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDIR8A",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDIR8A",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDIR8A",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDIR8A",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDIR8A",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDIR8A",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDIR8A",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDIR8A",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR8A",17,0)
 ;;
"RTN","MAGDIR8A",18,0)
 ;
"RTN","MAGDIR8A",19,0)
 ; M2MB server
"RTN","MAGDIR8A",20,0)
 ;
"RTN","MAGDIR8A",21,0)
 ; Lookup the patient/study in the imaging service's database
"RTN","MAGDIR8A",22,0)
 ; Different entry points are invoked from LOOKUP^MAGDIR81
"RTN","MAGDIR8A",23,0)
 ;
"RTN","MAGDIR8A",24,0)
RADLKUP ; Radiology patient/study lookup -- called by ^MAGDIR81
"RTN","MAGDIR8A",25,0)
 ; (also invoked by ^MAGDEXC4, ^MAGDFND4 and ^MAGDIW1)
"RTN","MAGDIR8A",26,0)
 ;
"RTN","MAGDIR8A",27,0)
 ; returns RADATA array DFN, DATETIME, and PROCDESC
"RTN","MAGDIR8A",28,0)
 ;
"RTN","MAGDIR8A",29,0)
 N CPTCODE ;-- CPT code for the procedure
"RTN","MAGDIR8A",30,0)
 N CPTNAME ;-- CPT name for the procedure
"RTN","MAGDIR8A",31,0)
 N EXAMSTS ;-- Exam status (don't post images to CANCELLED exams)
"RTN","MAGDIR8A",32,0)
 N PROCIEN ;-- radiology procedure ien in ^RAMIS(71)
"RTN","MAGDIR8A",33,0)
 N RAIX ;----- cross reference subscript for case number lookup
"RTN","MAGDIR8A",34,0)
 N RADPT1 ;--- first level subscript in ^RADPT
"RTN","MAGDIR8A",35,0)
 N RADPT2 ;--- second level subscript in ^RADPT (after "DT")
"RTN","MAGDIR8A",36,0)
 N RADPT3 ;--- third level subscript in ^RADPT (after "P")
"RTN","MAGDIR8A",37,0)
 N I,LIST,VARIABLE,X,Z
"RTN","MAGDIR8A",38,0)
 ;
"RTN","MAGDIR8A",39,0)
 ; find the patient/study in ^RARPT using the Radiology Case Number
"RTN","MAGDIR8A",40,0)
 K RADATA ; kill returned array of Radiology Package data
"RTN","MAGDIR8A",41,0)
 D RADLKUP1
"RTN","MAGDIR8A",42,0)
 S LIST="RADPT1^RADPT2^RADPT3^PROCIEN^CPTCODE^CPTNAME^Z^EXAMSTS"
"RTN","MAGDIR8A",43,0)
 F I=1:1:$L(LIST,"^") D
"RTN","MAGDIR8A",44,0)
 . S VARIABLE=$P(LIST,"^",I)
"RTN","MAGDIR8A",45,0)
 . S RADATA(VARIABLE)=$G(@VARIABLE)
"RTN","MAGDIR8A",46,0)
 . Q
"RTN","MAGDIR8A",47,0)
 Q
"RTN","MAGDIR8A",48,0)
 ;
"RTN","MAGDIR8A",49,0)
RADLKUP1 ; not an entry point
"RTN","MAGDIR8A",50,0)
 N LIST
"RTN","MAGDIR8A",51,0)
 Q:CASENUMB=""    ;LB 12/16/98
"RTN","MAGDIR8A",52,0)
 S X=$$ACCFIND^RAAPI(CASENUMB,.LIST)
"RTN","MAGDIR8A",53,0)
 Q:X'=1  S X=LIST(1) ; two conditions, no accession number & duplicate
"RTN","MAGDIR8A",54,0)
 S RADPT1=$P(X,"^",1),RADPT2=$P(X,"^",2),RADPT3=$P(X,"^",3)
"RTN","MAGDIR8A",55,0)
 I '$D(^RADPT(RADPT1,0)) Q  ; no patient demographics file pointer
"RTN","MAGDIR8A",56,0)
 ; get patient demographics file pointer
"RTN","MAGDIR8A",57,0)
 S X=^RADPT(RADPT1,0),DFN=$P(X,"^")
"RTN","MAGDIR8A",58,0)
 I '$D(^RADPT(RADPT1,"DT",RADPT2,0)) Q  ; no datetime level
"RTN","MAGDIR8A",59,0)
 ; get date and time of examination
"RTN","MAGDIR8A",60,0)
 S DATETIME=$P($G(^RADPT(RADPT1,"DT",RADPT2,0)),"^",1)
"RTN","MAGDIR8A",61,0)
 ; get case info
"RTN","MAGDIR8A",62,0)
 S X=$G(^RADPT(RADPT1,"DT",RADPT2,"P",RADPT3,0))
"RTN","MAGDIR8A",63,0)
 S PROCIEN=$P(X,"^",2),EXAMSTS=$P(X,"^",3)
"RTN","MAGDIR8A",64,0)
 I EXAMSTS S EXAMSTS=$$GET1^DIQ(72,EXAMSTS,.01)
"RTN","MAGDIR8A",65,0)
 S (PROCDESC,CPTNAME,CPTCODE)=""
"RTN","MAGDIR8A",66,0)
 I 'PROCIEN Q  ; need PROCIEN to do lookup in ^RAMIS
"RTN","MAGDIR8A",67,0)
 S Z=$G(^RAMIS(71,PROCIEN,0))
"RTN","MAGDIR8A",68,0)
 S PROCDESC=$P(Z,"^"),CPTCODE=$P(Z,"^",9)
"RTN","MAGDIR8A",69,0)
 S CPTNAME=PROCDESC ; approximate value since ^ICPT is not translated
"RTN","MAGDIR8A",70,0)
 Q
"RTN","MAGDIR8A",71,0)
 ;
"RTN","MAGDIR8A",72,0)
CONLKUP ; CPRS Consult/Procedure patient/study lookup -- called by ^MAGDIR81
"RTN","MAGDIR8A",73,0)
 N EXAMSTS ;-- Exam status (don't post images to CANCELLED exams)
"RTN","MAGDIR8A",74,0)
 N CONPROC,Z
"RTN","MAGDIR8A",75,0)
 I ACNUMB'?1"GMRC-".1N.N Q
"RTN","MAGDIR8A",76,0)
 S GMRCIEN=$P(ACNUMB,"-",2)
"RTN","MAGDIR8A",77,0)
 S DFN=$$GET1^DIQ(123,GMRCIEN,.02,"I")
"RTN","MAGDIR8A",78,0)
 I DFN="" Q  ; no patient demographics file pointer
"RTN","MAGDIR8A",79,0)
 S EXAMSTS=$$GET1^DIQ(123,GMRCIEN,8) ; check for cancelled exam
"RTN","MAGDIR8A",80,0)
 I EXAMSTS="CANCELLED" S RADATA("EXAMSTS")=EXAMSTS Q
"RTN","MAGDIR8A",81,0)
 S PROCDESC=$$GET1^DIQ(123,GMRCIEN,1)
"RTN","MAGDIR8A",82,0)
 S Z=$$GET1^DIQ(123,GMRCIEN,13,"I") ; request type
"RTN","MAGDIR8A",83,0)
 S CONPROC=$S(Z="C":"CONSULT",Z="P":"PROCEDURE",1:"UNKNOWN")
"RTN","MAGDIR8A",84,0)
 Q
"RTN","MAGDIR8A",85,0)
 ;
"RTN","MAGDIR8A",86,0)
PIDCHECK() ; compare VistA patient ID with DICOM patient ID
"RTN","MAGDIR8A",87,0)
 N CHECK ;---- patient demographic comparison check value
"RTN","MAGDIR8A",88,0)
 N FIRSTVAH ;- patient first name from VADM(1)
"RTN","MAGDIR8A",89,0)
 N IDDCM ;---- patient id, w/o punctuation, from image header
"RTN","MAGDIR8A",90,0)
 N IDVAH ;---- patient id from VADM(2)
"RTN","MAGDIR8A",91,0)
 N LASTVAH ;-- patient last name from VADM(1)
"RTN","MAGDIR8A",92,0)
 N MIVAH ;---- patient middle initial from VADM(1)
"RTN","MAGDIR8A",93,0)
 N DIQUIET,I,VA,VAERR,X,Y
"RTN","MAGDIR8A",94,0)
 ;
"RTN","MAGDIR8A",95,0)
 S X=PNAMEDCM X ^%ZOSF("UPPERCASE") S PNAMEDCM=Y
"RTN","MAGDIR8A",96,0)
 ; parse the DICOM patient name (2 formats)
"RTN","MAGDIR8A",97,0)
 I PNAMEDCM["^" D  ; DICOM format patient name
"RTN","MAGDIR8A",98,0)
 . S LASTDCM=$P(PNAMEDCM,"^"),FIRSTDCM=$P(PNAMEDCM,"^",2)
"RTN","MAGDIR8A",99,0)
 . S MIDCM=$P(PNAMEDCM,"^",3)
"RTN","MAGDIR8A",100,0)
 . Q
"RTN","MAGDIR8A",101,0)
 E  I PNAMEDCM["," D  ; ACR-NEMA format patient name
"RTN","MAGDIR8A",102,0)
 . F  Q:'$F(PNAMEDCM,", ")  D  ; remove blanks after last name comma
"RTN","MAGDIR8A",103,0)
 . . S PNAMEDCM=$P(PNAMEDCM,", ")_","_$P(PNAMEDCM,", ",2,999)
"RTN","MAGDIR8A",104,0)
 . . Q
"RTN","MAGDIR8A",105,0)
 . S LASTDCM=$P(PNAMEDCM,","),FIRSTDCM=$P(PNAMEDCM,",",2)
"RTN","MAGDIR8A",106,0)
 . S MIDCM=$S(PNAMEDCM[",":$P(FIRSTDCM,",",2),1:$P(FIRSTDCM," ",2,999))
"RTN","MAGDIR8A",107,0)
 . Q
"RTN","MAGDIR8A",108,0)
 E  D  ; patient name in "last first mi" order with space delimiters
"RTN","MAGDIR8A",109,0)
 . S LASTDCM=$P(PNAMEDCM," "),FIRSTDCM=$P(PNAMEDCM," ",2)
"RTN","MAGDIR8A",110,0)
 . S MIDCM=$P(PNAMEDCM," ",3)
"RTN","MAGDIR8A",111,0)
 . Q
"RTN","MAGDIR8A",112,0)
 S FIRSTDCM=$S(FIRSTDCM[",":$P(FIRSTDCM,","),1:$P(FIRSTDCM," "))
"RTN","MAGDIR8A",113,0)
 ; only check the first part of the name
"RTN","MAGDIR8A",114,0)
 ; remove dashes and atypical punctuation from the DICOM PID
"RTN","MAGDIR8A",115,0)
 S IDDCM="" F I=1:1:$L(PID) I $E(PID,I)?1AN S IDDCM=IDDCM_$E(PID,I)
"RTN","MAGDIR8A",116,0)
 ;
"RTN","MAGDIR8A",117,0)
 I CASENUMB="" Q "-1,NO CASE #"
"RTN","MAGDIR8A",118,0)
 I '$G(DFN) Q "-2,BAD CASE #"
"RTN","MAGDIR8A",119,0)
 I $G(RADATA("EXAMSTS"))="CANCELLED" Q "-3,CANCELLED"
"RTN","MAGDIR8A",120,0)
 ;
"RTN","MAGDIR8A",121,0)
 ; lookup patient in VistA database
"RTN","MAGDIR8A",122,0)
 S DIQUIET=1 D DEM^VADPT
"RTN","MAGDIR8A",123,0)
 S PNAMEVAH=VADM(1)
"RTN","MAGDIR8A",124,0)
 S LASTVAH=$P(PNAMEVAH,","),FIRSTVAH=$P(PNAMEVAH,",",2)
"RTN","MAGDIR8A",125,0)
 S MIVAH=$TR($P(FIRSTVAH," ",2,999),"."),FIRSTVAH=$P(FIRSTVAH," ")
"RTN","MAGDIR8A",126,0)
 S IDVAH=$P(VADM(2),"^"),DCMPID=$P(VADM(2),"^",2)
"RTN","MAGDIR8A",127,0)
 ;
"RTN","MAGDIR8A",128,0)
 ; compare the values - allow a single transposition in the patient name,
"RTN","MAGDIR8A",129,0)
 ; but require exact patient id values (i.e., social security numbers)
"RTN","MAGDIR8A",130,0)
 S CHECK=(5*$$COMPARE(LASTDCM,LASTVAH))
"RTN","MAGDIR8A",131,0)
 S CHECK=CHECK+(5*$$COMPARE($E(FIRSTDCM,1,6),$E(FIRSTVAH,1,6)))
"RTN","MAGDIR8A",132,0)
 S CHECK=CHECK+(1*$$COMPARE(MIDCM,MIVAH))
"RTN","MAGDIR8A",133,0)
 S CHECK=CHECK+(5*(IDDCM=IDVAH)) ; patient id requires an exact match
"RTN","MAGDIR8A",134,0)
 I CHECK<14.5 Q "-4,PID ERROR" ; require an "almost exact" match
"RTN","MAGDIR8A",135,0)
 Q 0  ; correct patient
"RTN","MAGDIR8A",136,0)
 ;
"RTN","MAGDIR8A",137,0)
COMPARE(A,B) ; pattern match checker
"RTN","MAGDIR8A",138,0)
 Q:A=B 1 ; exact match
"RTN","MAGDIR8A",139,0)
 Q:A="" 0 Q:B="" 0 ; don't count missing data
"RTN","MAGDIR8A",140,0)
 ; calculate fractional value for pattern match
"RTN","MAGDIR8A",141,0)
 N I,LENGTH,MATCH
"RTN","MAGDIR8A",142,0)
 S MATCH=0,LENGTH=$S($L(B)>$L(A):$L(B),1:$L(A))
"RTN","MAGDIR8A",143,0)
 F I=1:1:LENGTH D
"RTN","MAGDIR8A",144,0)
 . I $E(A,I)=$E(B,I) S MATCH=MATCH+1
"RTN","MAGDIR8A",145,0)
 . E  I $E(A,I)=$E(B,I-1) S MATCH=MATCH+.25
"RTN","MAGDIR8A",146,0)
 . E  I $E(A,I)=$E(B,I+1) S MATCH=MATCH+.25
"RTN","MAGDIR8A",147,0)
 . E  I $E(A,I-1)=$E(B,I) S MATCH=MATCH+.25
"RTN","MAGDIR8A",148,0)
 . E  I $E(A,I+1)=$E(B,I) S MATCH=MATCH+.25
"RTN","MAGDIR8A",149,0)
 . Q
"RTN","MAGDIR8A",150,0)
 Q MATCH/LENGTH ; return fractional pattern match value
"RTN","MAGDIR8R")
0^18^B55950540
"RTN","MAGDIR8R",1,0)
MAGDIR8R ;WOIFO/PMK - Automatic Import Reconciliation Workflow ; 27 Sep 2010 1:00 PM
"RTN","MAGDIR8R",2,0)
 ;;3.0;IMAGING;**53,49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGDIR8R",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDIR8R",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR8R",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDIR8R",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDIR8R",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDIR8R",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDIR8R",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDIR8R",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDIR8R",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDIR8R",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDIR8R",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDIR8R",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDIR8R",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDIR8R",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR8R",17,0)
 ;;
"RTN","MAGDIR8R",18,0)
 ;
"RTN","MAGDIR8R",19,0)
DISPLAY ;Display a study
"RTN","MAGDIR8R",20,0)
 N HEADING ;-- title of display
"RTN","MAGDIR8R",21,0)
 N IEN ;------ internal entry number in DATAFILE
"RTN","MAGDIR8R",22,0)
 N MACHID ;--- machine id (hostname)
"RTN","MAGDIR8R",23,0)
 N MODALITY ;- DICOM modality, for counting how many images
"RTN","MAGDIR8R",24,0)
 N NONE ;----- flag indicating whether or not there are studies
"RTN","MAGDIR8R",25,0)
 N PNAMEDCM ;- patient name in DICOM format
"RTN","MAGDIR8R",26,0)
 N SERIEUID ;- DICOM series instance uid
"RTN","MAGDIR8R",27,0)
 N STUDYUID ;- DICOM study instance uid array
"RTN","MAGDIR8R",28,0)
 N I,J,K,X
"RTN","MAGDIR8R",29,0)
 ;
"RTN","MAGDIR8R",30,0)
 S IOF="#" ; remove this later
"RTN","MAGDIR8R",31,0)
 ;
"RTN","MAGDIR8R",32,0)
 S HEADING="DICOM Images that need to be Reconciled and Imported"
"RTN","MAGDIR8R",33,0)
 S X=$$BUILD()
"RTN","MAGDIR8R",34,0)
 S NONE=1,MACHID=""
"RTN","MAGDIR8R",35,0)
 F  S MACHID=$O(^TMP("MAG",$J,"IRWF",MACHID)) Q:MACHID=""  D
"RTN","MAGDIR8R",36,0)
 . D DISPLAY1
"RTN","MAGDIR8R",37,0)
 . D CONTINUE
"RTN","MAGDIR8R",38,0)
 . Q
"RTN","MAGDIR8R",39,0)
 I NONE W !!,"No images to correct" D CONTINUE
"RTN","MAGDIR8R",40,0)
 Q
"RTN","MAGDIR8R",41,0)
 ;
"RTN","MAGDIR8R",42,0)
DISPLAY1 ; Display for one machine 
"RTN","MAGDIR8R",43,0)
 N DATA ;----- data about the entry
"RTN","MAGDIR8R",44,0)
 D HEADING
"RTN","MAGDIR8R",45,0)
 S I=0 F  S I=$O(^TMP("MAG",$J,"IRWF",MACHID,I)) Q:'I  D
"RTN","MAGDIR8R",46,0)
 . I '$$GETDATA(I,"LIST",.DATA) Q
"RTN","MAGDIR8R",47,0)
 . S NONE=0 ; there are studies to correct
"RTN","MAGDIR8R",48,0)
 . I $Y>43 D CONTINUE,HEADING
"RTN","MAGDIR8R",49,0)
 . W !,$J(I,3),")"
"RTN","MAGDIR8R",50,0)
 . W ?5,$J(DATA("PID"),14) ; DoD pid is 14 characters: FP/***********
"RTN","MAGDIR8R",51,0)
 . W ?20,$E($$NAME(DATA("PNAMEDCM")),1,25)
"RTN","MAGDIR8R",52,0)
 . W ?47,DATA("ACNUMB"),?64,$$DATE(DATA("STUDYDAT"),"S")
"RTN","MAGDIR8R",53,0)
 . W ?72
"RTN","MAGDIR8R",54,0)
 . S MODALITY=""
"RTN","MAGDIR8R",55,0)
 . F  S MODALITY=$O(^TMP("MAG",$J,"IRWF",MACHID,I,"MOD",MODALITY)) Q:MODALITY=""  D
"RTN","MAGDIR8R",56,0)
 . . W " ",MODALITY,"=",^TMP("MAG",$J,"IRWF",MACHID,I,"MOD",MODALITY)
"RTN","MAGDIR8R",57,0)
 . . Q
"RTN","MAGDIR8R",58,0)
 . Q
"RTN","MAGDIR8R",59,0)
 Q
"RTN","MAGDIR8R",60,0)
 ;
"RTN","MAGDIR8R",61,0)
HEADING ; output the heading
"RTN","MAGDIR8R",62,0)
 N TAB,X
"RTN","MAGDIR8R",63,0)
 S X=HEADING_" ("_MACHID_")"
"RTN","MAGDIR8R",64,0)
 S TAB=(80-$L(X))/2
"RTN","MAGDIR8R",65,0)
 W @IOF,?TAB,X
"RTN","MAGDIR8R",66,0)
 W !?TAB,$TR($J("",$L(X))," ","-")
"RTN","MAGDIR8R",67,0)
 W !!,"  #",?7,"Patient ID",?22,"DICOM Patient Name"
"RTN","MAGDIR8R",68,0)
 W ?49,"Accession #",?66,"Date",?73,"Images"
"RTN","MAGDIR8R",69,0)
 W !,"----",?5,"--------------",?20,"-------------------------",?47,"----------------"
"RTN","MAGDIR8R",70,0)
 W ?64,"--------",?73,"------"
"RTN","MAGDIR8R",71,0)
 Q
"RTN","MAGDIR8R",72,0)
 ;
"RTN","MAGDIR8R",73,0)
NAME(NAME) ; convert person name from DICOM format to displayable one
"RTN","MAGDIR8R",74,0)
 N CHAR,I,X
"RTN","MAGDIR8R",75,0)
 S X=""
"RTN","MAGDIR8R",76,0)
 F I=1:1:$L(NAME) D
"RTN","MAGDIR8R",77,0)
 . S CHAR=$E(NAME,I)
"RTN","MAGDIR8R",78,0)
 . I CHAR="^" D
"RTN","MAGDIR8R",79,0)
 . . ; the first "^" becomes a comma, while the others become spaces
"RTN","MAGDIR8R",80,0)
 . . S X=X_$S($F(NAME,"^")=(I+1):",",1:" ")
"RTN","MAGDIR8R",81,0)
 . . Q
"RTN","MAGDIR8R",82,0)
 . E  S X=X_$E(NAME,I)
"RTN","MAGDIR8R",83,0)
 Q X
"RTN","MAGDIR8R",84,0)
 ;
"RTN","MAGDIR8R",85,0)
DATE(YYYYMMDD,FORMAT) ; convert date from DICOM format to displayable one
"RTN","MAGDIR8R",86,0)
 ; FORMAT: B for birthday mm/dd/yyyy, S for short mm/dd/yy, L for long
"RTN","MAGDIR8R",87,0)
 N M
"RTN","MAGDIR8R",88,0)
 S FORMAT=$G(FORMAT)
"RTN","MAGDIR8R",89,0)
 I FORMAT'="B",FORMAT'="S",FORMAT'="L" Q "Wrong format: "_FORMAT
"RTN","MAGDIR8R",90,0)
 I YYYYMMDD="" Q ""
"RTN","MAGDIR8R",91,0)
 I YYYYMMDD="<unknown>" Q YYYYMMDD
"RTN","MAGDIR8R",92,0)
 I FORMAT="B" Q $E(YYYYMMDD,5,6)_"/"_$E(YYYYMMDD,7,8)_"/"_$E(YYYYMMDD,1,4)
"RTN","MAGDIR8R",93,0)
 I FORMAT="S" Q $E(YYYYMMDD,5,6)_"/"_$E(YYYYMMDD,7,8)_"/"_$E(YYYYMMDD,3,4)
"RTN","MAGDIR8R",94,0)
 S M=+$E(YYYYMMDD,5,6),M=(3*(M-1))+1
"RTN","MAGDIR8R",95,0)
 S M=$E("JanFebMarAprMayJunJulAugSepOctNovDec",M,M+2)
"RTN","MAGDIR8R",96,0)
 Q M_" "_(+$E(YYYYMMDD,7,8))_", "_$E(YYYYMMDD,1,4)
"RTN","MAGDIR8R",97,0)
 ;
"RTN","MAGDIR8R",98,0)
CONTINUE ; prompt
"RTN","MAGDIR8R",99,0)
 R !!,"Press <Enter> to continue...",X:$G(DTIME,1E5)
"RTN","MAGDIR8R",100,0)
 Q
"RTN","MAGDIR8R",101,0)
 ;
"RTN","MAGDIR8R",102,0)
BUILD() ;
"RTN","MAGDIR8R",103,0)
 N COUNT ;---- count of images
"RTN","MAGDIR8R",104,0)
 N DATA ;----- data about the entry
"RTN","MAGDIR8R",105,0)
 ;
"RTN","MAGDIR8R",106,0)
 K ^TMP("MAG",$J,"IRWF")
"RTN","MAGDIR8R",107,0)
 S COUNT=0
"RTN","MAGDIR8R",108,0)
 ; prevent update of DATAFILE while someone is starting Importer
"RTN","MAGDIR8R",109,0)
 L +^MAGD(2006.5752,0):1E9
"RTN","MAGDIR8R",110,0)
 S IEN=0 F  S IEN=$O(^MAGD(2006.5752,IEN)) Q:'IEN  D
"RTN","MAGDIR8R",111,0)
 . S X=$$GETDATA(IEN,"IEN",.DATA)
"RTN","MAGDIR8R",112,0)
 . S MACHID=DATA("MACHID")
"RTN","MAGDIR8R",113,0)
 . S MODALITY=DATA("MODALITY")
"RTN","MAGDIR8R",114,0)
 . S STUDYUID=DATA("STUDYUID")
"RTN","MAGDIR8R",115,0)
 . S SERIEUID=DATA("SERIEUID")
"RTN","MAGDIR8R",116,0)
 . S I=$G(STUDYUID(STUDYUID))
"RTN","MAGDIR8R",117,0)
 . I I="" S (I,COUNT)=COUNT+1,STUDYUID(STUDYUID)=COUNT
"RTN","MAGDIR8R",118,0)
 . S ^TMP("MAG",$J,"IRWF",MACHID,I,"IEN",SERIEUID,IEN)=""
"RTN","MAGDIR8R",119,0)
 . S ^(MODALITY)=$G(^TMP("MAG",$J,"IRWF",MACHID,I,"MOD",MODALITY))+1
"RTN","MAGDIR8R",120,0)
 . Q
"RTN","MAGDIR8R",121,0)
 L -^MAGD(2006.5752,0)
"RTN","MAGDIR8R",122,0)
 Q COUNT
"RTN","MAGDIR8R",123,0)
 ;
"RTN","MAGDIR8R",124,0)
GETDATA(I,MODE,DATA) ; get the data from the I-th entry in the DATAFILE
"RTN","MAGDIR8R",125,0)
 ; if MODE="LIST", then I is the index into the LIST
"RTN","MAGDIR8R",126,0)
 ; if MODE="IEN", then I is the actual internal entry number
"RTN","MAGDIR8R",127,0)
 N IEN,J,K,SERIEUID,VARS,X
"RTN","MAGDIR8R",128,0)
 K DATA Q:'$G(I) 0  Q:'$D(MODE) 0
"RTN","MAGDIR8R",129,0)
 I MODE="LIST" D
"RTN","MAGDIR8R",130,0)
 . S SERIEUID=$O(^TMP("MAG",$J,"IRWF",MACHID,I,"IEN",""))
"RTN","MAGDIR8R",131,0)
 . S IEN=$O(^TMP("MAG",$J,"IRWF",MACHID,I,"IEN",SERIEUID,""))
"RTN","MAGDIR8R",132,0)
 . Q
"RTN","MAGDIR8R",133,0)
 E  I MODE="IEN" S IEN=I
"RTN","MAGDIR8R",134,0)
 E  Q 0
"RTN","MAGDIR8R",135,0)
 M X=^MAGD(2006.5752,IEN)
"RTN","MAGDIR8R",136,0)
 F J=0:1:3 F K=1:1:$L(X(J),"^") I $P(X(J),"^",K)="<unknown>" S $P(X(J),"^",K)=""
"RTN","MAGDIR8R",137,0)
 S VARS(0)="PNAME^PID^MACHID" ; 0 = patient level
"RTN","MAGDIR8R",138,0)
 S VARS(1)="STUDYDAT^ACNUMB^STUDYUID" ; 1 = study level
"RTN","MAGDIR8R",139,0)
 S VARS(2)="MODALITY^SERIEUID" ; 2 = series level
"RTN","MAGDIR8R",140,0)
 S VARS(3)="FROMPATH^IMAGEUID" ; 3 = instance level
"RTN","MAGDIR8R",141,0)
 F J=0:1:3 D  ; iterate through the levels
"RTN","MAGDIR8R",142,0)
 . F K=1:1:$L(VARS(J),"^") S DATA($P(VARS(J),"^",K))=$P(X(J),"^",K)
"RTN","MAGDIR8R",143,0)
 . Q
"RTN","MAGDIR8R",144,0)
 S DATA("PNAMEDCM")=$TR(DATA("PNAME"),"|","^") K DATA("PNAME")
"RTN","MAGDIR8R",145,0)
 Q 1
"RTN","MAGDIR8R",146,0)
 ;
"RTN","MAGDIR8R",147,0)
STORE ;  store an entry
"RTN","MAGDIR8R",148,0)
 N I,IEN,PNAME,X
"RTN","MAGDIR8R",149,0)
 ; patient data
"RTN","MAGDIR8R",150,0)
 S PNAME=$TR(PNAMEDCM,"^","|")
"RTN","MAGDIR8R",151,0)
 ; patient data
"RTN","MAGDIR8R",152,0)
 S X(0)=PNAME_"^"_PID_"^"_MACHID
"RTN","MAGDIR8R",153,0)
 ; study data
"RTN","MAGDIR8R",154,0)
 S X(1)=STUDYDAT_"^"_ACNUMB_"^"_STUDYUID
"RTN","MAGDIR8R",155,0)
 ; series data
"RTN","MAGDIR8R",156,0)
 S X(2)=MODALITY_"^"_SERIEUID
"RTN","MAGDIR8R",157,0)
 ; object data
"RTN","MAGDIR8R",158,0)
 S X(3)=FROMPATH_"^"_IMAGEUID
"RTN","MAGDIR8R",159,0)
 ;
"RTN","MAGDIR8R",160,0)
 ; prevent update of DATAFILE while someone is starting Importer
"RTN","MAGDIR8R",161,0)
 L +^MAGD(2006.5752,0):1E9 ; serialize name generation code
"RTN","MAGDIR8R",162,0)
 I '$D(^MAGD(2006.5752,0)) S ^MAGD(2006.5752,0)="Importable DICOM Objects^^0^0"
"RTN","MAGDIR8R",163,0)
 S IEN=$P(^MAGD(2006.5752,0),"^",3)+1
"RTN","MAGDIR8R",164,0)
 S $P(^MAGD(2006.5752,0),"^",3,4)=IEN_"^"_IEN
"RTN","MAGDIR8R",165,0)
 M ^MAGD(2006.5752,IEN)=X
"RTN","MAGDIR8R",166,0)
 L -^MAGD(2006.5752,0)
"RTN","MAGDIR8R",167,0)
 S ^MAGD(2006.5752,"C",IMAGEUID,IEN)="" ; index by SOP Instance UID
"RTN","MAGDIR8R",168,0)
 S ^MAGD(2006.5752,"D",MACHID,FROMPATH,IEN)="" ; index by file path
"RTN","MAGDIR8R",169,0)
 Q
"RTN","MAGDIR8R",170,0)
 ;
"RTN","MAGDIR8R",171,0)
DELETE(IMAGEUID,MACHID,OLDPATH) ; remove an entry
"RTN","MAGDIR8R",172,0)
 N DUPIEN,RETURN
"RTN","MAGDIR8R",173,0)
 L +^MAGD(2006.5752,0):1E9 ; serialize name generation code
"RTN","MAGDIR8R",174,0)
 S RETURN=$$DELETE1(IMAGEUID,MACHID,OLDPATH)
"RTN","MAGDIR8R",175,0)
 ;
"RTN","MAGDIR8R",176,0)
 ; check for duplicate SOP Instances and delete them
"RTN","MAGDIR8R",177,0)
 F  S DUPIEN=$O(^MAGD(2006.5752,"C",IMAGEUID,"")) Q:'DUPIEN  D
"RTN","MAGDIR8R",178,0)
 . N MACHID,OLDPATH,RETURN,X
"RTN","MAGDIR8R",179,0)
 . M X=^MAGD(2006.5752,DUPIEN)
"RTN","MAGDIR8R",180,0)
 . S MACHID=$P(X(0),"^",3),OLDPATH=$P(X(3),"^",1)
"RTN","MAGDIR8R",181,0)
 . S RETURN=$$DELETE1(IMAGEUID,MACHID,OLDPATH)
"RTN","MAGDIR8R",182,0)
 . Q
"RTN","MAGDIR8R",183,0)
 ;
"RTN","MAGDIR8R",184,0)
 L -^MAGD(2006.5752,0)
"RTN","MAGDIR8R",185,0)
 Q RETURN
"RTN","MAGDIR8R",186,0)
 ;
"RTN","MAGDIR8R",187,0)
DELETE1(IMAGEUID,MACHID,OLDPATH) ; remove the single entry
"RTN","MAGDIR8R",188,0)
 ; Note: ^MAGD(2006.5752,0) must be locked prior to invocation
"RTN","MAGDIR8R",189,0)
 N EXIST,IEN,X
"RTN","MAGDIR8R",190,0)
 S IEN=$O(^MAGD(2006.5752,"D",MACHID,OLDPATH,"")) Q:'IEN 0
"RTN","MAGDIR8R",191,0)
 M X=^MAGD(2006.5752,IEN)
"RTN","MAGDIR8R",192,0)
 ; image uid's should match (defined as zero for MAGDRPCA call)
"RTN","MAGDIR8R",193,0)
 I IMAGEUID'=$P(X(3),"^",2) D  Q -99
"RTN","MAGDIR8R",194,0)
 . K I,MSG
"RTN","MAGDIR8R",195,0)
 . S I=0
"RTN","MAGDIR8R",196,0)
 . S I=I+1,MSG(I)="IMPORT RECONCILIATION DATABASE FILE DELETION ERROR:"
"RTN","MAGDIR8R",197,0)
 . S I=I+1,MSG(I)="The DICOM SOP Instance UIDs don't agree."
"RTN","MAGDIR8R",198,0)
 . S I=I+1,MSG(I)="Current UID: "_IMAGEUID
"RTN","MAGDIR8R",199,0)
 . S I=I+1,MSG(I)="Previous UID: "_$P(X(3),"^",2)
"RTN","MAGDIR8R",200,0)
 . S I=I+1,MSG(I)="Dump of File ^MAGD(2006.5752,"_IEN_")"
"RTN","MAGDIR8R",201,0)
 . S I=I+1,MSG(I)="^MAGD(2006.5752,"_IEN_",0)="_X(0)
"RTN","MAGDIR8R",202,0)
 . S I=I+1,MSG(I)="^MAGD(2006.5752,"_IEN_",1)="_X(1)
"RTN","MAGDIR8R",203,0)
 . S I=I+1,MSG(I)="^MAGD(2006.5752,"_IEN_",2)="_X(2)
"RTN","MAGDIR8R",204,0)
 . S I=I+1,MSG(I)="^MAGD(2006.5752,"_IEN_",3)="_X(3)
"RTN","MAGDIR8R",205,0)
 . S I=I+1,MSG(I)="Argument 1: "_ARGS
"RTN","MAGDIR8R",206,0)
 . S I=I+1,MSG(I)="Argument 2: "_ARG2
"RTN","MAGDIR8R",207,0)
 . D BADERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR8R",208,0)
 . Q 
"RTN","MAGDIR8R",209,0)
 ; remove the entry
"RTN","MAGDIR8R",210,0)
 S EXIST=$D(^MAGD(2006.5752,IEN))
"RTN","MAGDIR8R",211,0)
 K ^MAGD(2006.5752,IEN)
"RTN","MAGDIR8R",212,0)
 K ^MAGD(2006.5752,"C",IMAGEUID,IEN) ; index by SOP Instance UID
"RTN","MAGDIR8R",213,0)
 K ^MAGD(2006.5752,"D",MACHID,OLDPATH,IEN) ; index by file path
"RTN","MAGDIR8R",214,0)
 ; Only subtract 1 from #entries, if we're actually deleting one
"RTN","MAGDIR8R",215,0)
 I EXIST S $P(^(0),"^",4)=$P(^MAGD(2006.5752,0),"^",4)-1
"RTN","MAGDIR8R",216,0)
 Q 0
"RTN","MAGDIR9A")
0^19^B60148803
"RTN","MAGDIR9A",1,0)
MAGDIR9A ;WOIFO/PMK - Read a DICOM image file ; 05 Apr 2011 8:21 AM
"RTN","MAGDIR9A",2,0)
 ;;3.0;IMAGING;**11,30,51,46,54,53,49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGDIR9A",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDIR9A",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR9A",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDIR9A",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDIR9A",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDIR9A",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDIR9A",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDIR9A",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDIR9A",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDIR9A",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDIR9A",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDIR9A",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDIR9A",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDIR9A",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDIR9A",17,0)
 ;;
"RTN","MAGDIR9A",18,0)
 Q
"RTN","MAGDIR9A",19,0)
 ; M2MB server
"RTN","MAGDIR9A",20,0)
 ;
"RTN","MAGDIR9A",21,0)
 ; This routine creates a ^mag(2005) group entry and links it to the
"RTN","MAGDIR9A",22,0)
 ; associated radiology report
"RTN","MAGDIR9A",23,0)
 ;
"RTN","MAGDIR9A",24,0)
 ;   XXXXXX      XX    XXXXXX
"RTN","MAGDIR9A",25,0)
 ;    XX  XX    XXXX    XX  XX
"RTN","MAGDIR9A",26,0)
 ;    XX  XX   XX  XX   XX  XX
"RTN","MAGDIR9A",27,0)
 ;    XXXXX    XX  XX   XX  XX
"RTN","MAGDIR9A",28,0)
 ;    XX XX    XXXXXX   XX  XX
"RTN","MAGDIR9A",29,0)
 ;    XX  XX   XX  XX   XX  XX
"RTN","MAGDIR9A",30,0)
 ;   XXX  XX   XX  XX  XXXXXX
"RTN","MAGDIR9A",31,0)
 ;
"RTN","MAGDIR9A",32,0)
GROUP() ; entry point from ^MAGDIR81
"RTN","MAGDIR9A",33,0)
 N ACQDEVP ;-- pointer to acquisition device file (#2006.04)
"RTN","MAGDIR9A",34,0)
 N DA ;------ fileman variable
"RTN","MAGDIR9A",35,0)
 N ERRCODE ;- error trap code
"RTN","MAGDIR9A",36,0)
 N GROUP ;--- array to pass group data to ^MAGGTIA
"RTN","MAGDIR9A",37,0)
 N GROUPDFN ; DFN value from image group entry for double checking
"RTN","MAGDIR9A",38,0)
 N P ;------- scratch variable (pointer to ACQUISITION DEVICE file)
"RTN","MAGDIR9A",39,0)
 N RACNE ;--- external "3rd level" subscript in ^RADPT
"RTN","MAGDIR9A",40,0)
 N RACNI ;--- internal "3rd level" subscript in ^RADPT
"RTN","MAGDIR9A",41,0)
 N RADFN ;--- radiology package's DFN
"RTN","MAGDIR9A",42,0)
 N RADTE ;--- external "2nd level" subscript in ^RADPT
"RTN","MAGDIR9A",43,0)
 N RADTI ;--- internal "2nd level" subscript in ^RADPT
"RTN","MAGDIR9A",44,0)
 N RARPT ;--- 1st level node in ^RARPT for report (ie, the ien)
"RTN","MAGDIR9A",45,0)
 N RARPT3 ;-- 3rd level node for 2005 multiple under ^RARPT's report
"RTN","MAGDIR9A",46,0)
 N RARPTDFN ; DFN value from ^RARPT for double checking
"RTN","MAGDIR9A",47,0)
 N RETURN ;-- variable returned by ^MAGGTIA
"RTN","MAGDIR9A",48,0)
 N SOPCLASP ; pointer to SOP Class file (#2006.532)
"RTN","MAGDIR9A",49,0)
 N HIT,ISPECIDX,X,Y ; scratch variables
"RTN","MAGDIR9A",50,0)
 ;
"RTN","MAGDIR9A",51,0)
 S ERRCODE=""
"RTN","MAGDIR9A",52,0)
 ;
"RTN","MAGDIR9A",53,0)
 S (RADFN,DA(2))=DFN ; patient DFN variables
"RTN","MAGDIR9A",54,0)
 S RADTI=RADATA("RADPT2") ; case subscript
"RTN","MAGDIR9A",55,0)
 I RADTI="" D  Q ERRCODE
"RTN","MAGDIR9A",56,0)
 . K MSG
"RTN","MAGDIR9A",57,0)
 . S MSG(1)="No radiology case number specified for patient "_DFN
"RTN","MAGDIR9A",58,0)
 . D ERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR9A",59,0)
 . S ERRCODE=-301
"RTN","MAGDIR9A",60,0)
 . Q
"RTN","MAGDIR9A",61,0)
 ;
"RTN","MAGDIR9A",62,0)
 S RADTE=9999999.9999-RADTI ; 9's complement conversion
"RTN","MAGDIR9A",63,0)
 S RACNI=RADATA("RADPT3")
"RTN","MAGDIR9A",64,0)
 S RACNE=$P(CASENUMB,"-",$L(CASENUMB,"-")) ; short case #
"RTN","MAGDIR9A",65,0)
 ;
"RTN","MAGDIR9A",66,0)
 ; check for the existence of the entry in ^RADPT (redundant)
"RTN","MAGDIR9A",67,0)
 I '$D(^RADPT(RADFN,"DT",RADTI,0)) D  Q ERRCODE ; can't process further
"RTN","MAGDIR9A",68,0)
 . K MSG
"RTN","MAGDIR9A",69,0)
 . S MSG(1)="Radiology case "_RADTI_" is not in ^RADPT("_RADFN_")"
"RTN","MAGDIR9A",70,0)
 . D ERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR9A",71,0)
 . S ERRCODE=-302
"RTN","MAGDIR9A",72,0)
 . Q
"RTN","MAGDIR9A",73,0)
 ;
"RTN","MAGDIR9A",74,0)
 ; check for the existence of the report pointer
"RTN","MAGDIR9A",75,0)
 S RARPT=$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),"^",17)
"RTN","MAGDIR9A",76,0)
 ; if the report does not yet exist, create it
"RTN","MAGDIR9A",77,0)
 ; 
"RTN","MAGDIR9A",78,0)
 I RARPT="" D  Q:ERRCODE ERRCODE ; can't process further
"RTN","MAGDIR9A",79,0)
 . N RACN,RATIMEOUT
"RTN","MAGDIR9A",80,0)
 . S RATIMEOUT=1
"RTN","MAGDIR9A",81,0)
 . S RACN=RACNE D CREATE^RARIC ; create the report
"RTN","MAGDIR9A",82,0)
 . ;
"RTN","MAGDIR9A",83,0)
 . I RARPT="-1^radiology exam locked" S ERRCODE="-399^"_$P(RARPT,"^",2) Q
"RTN","MAGDIR9A",84,0)
 . ;
"RTN","MAGDIR9A",85,0)
 . ; If RARPT is no longer defined at this point, this means
"RTN","MAGDIR9A",86,0)
 . ; that we're dealing with an old study, and the report has
"RTN","MAGDIR9A",87,0)
 . ; been archived and purged.
"RTN","MAGDIR9A",88,0)
 . ;
"RTN","MAGDIR9A",89,0)
 . I '$G(RARPT) D  Q
"RTN","MAGDIR9A",90,0)
 . . K MSG
"RTN","MAGDIR9A",91,0)
 . . S MSG(1)="IMAGE GROUP CREATION ERROR:"
"RTN","MAGDIR9A",92,0)
 . . S MSG(2)="Radiology Report has been archived and purged."
"RTN","MAGDIR9A",93,0)
 . . S MSG(3)="Patient "_$G(RADFN)_", 9's Complement Date "_$G(RADTI)_", Case "_$G(RACNI)
"RTN","MAGDIR9A",94,0)
 . . D ERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR9A",95,0)
 . . S ERRCODE=-303
"RTN","MAGDIR9A",96,0)
 . . Q
"RTN","MAGDIR9A",97,0)
 . Q
"RTN","MAGDIR9A",98,0)
 ;
"RTN","MAGDIR9A",99,0)
 ; double check the DFN value from ^RARPT to make sure its right
"RTN","MAGDIR9A",100,0)
 S RARPTDFN=$P($G(^RARPT(RARPT,0)),"^",2)
"RTN","MAGDIR9A",101,0)
 I RARPTDFN'=DFN D  Q ERRCODE ; fatal error
"RTN","MAGDIR9A",102,0)
 . D RADMISS^MAGDIRVE($T(+0),DFN,RARPT,RARPTDFN)
"RTN","MAGDIR9A",103,0)
 . S ERRCODE=-304
"RTN","MAGDIR9A",104,0)
 . Q
"RTN","MAGDIR9A",105,0)
 ;
"RTN","MAGDIR9A",106,0)
 ; initialize FILEDATA for GROUP and IMAGE
"RTN","MAGDIR9A",107,0)
 ; get the acquisition device pointer (file 2005, field 107)
"RTN","MAGDIR9A",108,0)
 S ACQDEVP=$$ACQDEV^MAGDFCNV(MFGR,MODEL,INSTLOC)
"RTN","MAGDIR9A",109,0)
 S FILEDATA("ACQUISITION DEVICE")=ACQDEVP
"RTN","MAGDIR9A",110,0)
 ; get the SOP Class pointer (file 2005, field 251)
"RTN","MAGDIR9A",111,0)
 S SOPCLASP=$O(^MAG(2006.532,"B",SOPCLASS,""))
"RTN","MAGDIR9A",112,0)
 S FILEDATA("SOP CLASS POINTER")=SOPCLASP
"RTN","MAGDIR9A",113,0)
 ;
"RTN","MAGDIR9A",114,0)
 S FILEDATA("MODALITY")=MODALITY
"RTN","MAGDIR9A",115,0)
 S FILEDATA("PARENT FILE")=74
"RTN","MAGDIR9A",116,0)
 S FILEDATA("PARENT IEN")=RARPT
"RTN","MAGDIR9A",117,0)
 S FILEDATA("RAD REPORT")=RARPT
"RTN","MAGDIR9A",118,0)
 S FILEDATA("RAD PROC PTR")=RADATA("PROCIEN")
"RTN","MAGDIR9A",119,0)
 S FILEDATA("PACKAGE")="RAD"
"RTN","MAGDIR9A",120,0)
 S X=$S(MODALITY="NM":"NUCLEAR MEDICINE",1:"RADIOLOGY")
"RTN","MAGDIR9A",121,0)
 S ISPECIDX=$O(^MAG(2005.84,"B",X,""))
"RTN","MAGDIR9A",122,0)
 S X=$$FIELD43^MAGXMA(MODALITY,ISPECIDX,.Y)
"RTN","MAGDIR9A",123,0)
 S FILEDATA("PROC/EVENT")=$S(X=0:Y,1:"")
"RTN","MAGDIR9A",124,0)
 S FILEDATA("SPEC/SUBSPEC")=ISPECIDX
"RTN","MAGDIR9A",125,0)
 ;
"RTN","MAGDIR9A",126,0)
 ; find the corresponding image group node under the report
"RTN","MAGDIR9A",127,0)
 S (HIT,RARPT3)=0
"RTN","MAGDIR9A",128,0)
 F  S RARPT3=$O(^RARPT(RARPT,2005,RARPT3)) Q:'RARPT3  D  Q:HIT  Q:ERRCODE
"RTN","MAGDIR9A",129,0)
 . S MAGGP=+$G(^RARPT(RARPT,2005,RARPT3,0)) ; get imaging group pointer
"RTN","MAGDIR9A",130,0)
 . S GROUPDFN=$P($G(^MAG(2005,MAGGP,0)),"^",7) ; check image DFN value
"RTN","MAGDIR9A",131,0)
 . I GROUPDFN'=DFN D  ; fatal error
"RTN","MAGDIR9A",132,0)
 . . D MISMATCH^MAGDIRVE($T(+0),DFN,MAGGP)
"RTN","MAGDIR9A",133,0)
 . . S ERRCODE=-305
"RTN","MAGDIR9A",134,0)
 . . Q
"RTN","MAGDIR9A",135,0)
 . E  I $P($G(^MAG(2005,MAGGP,0)),"^",6)=11 D
"RTN","MAGDIR9A",136,0)
 . . ; create a new group if this is for a different Study Instance UID
"RTN","MAGDIR9A",137,0)
 . . I STUDYUID'=$P($G(^MAG(2005,MAGGP,"PACS")),"^",1) Q
"RTN","MAGDIR9A",138,0)
 . . ; check to see that this group is for the same SOP Class
"RTN","MAGDIR9A",139,0)
 . . S P=$P($G(^MAG(2005,MAGGP,"SOP")),"^",1)
"RTN","MAGDIR9A",140,0)
 . . S HIT=$$EQUIVGRP^MAGDFCNV(P,SOPCLASP) ; equivalent groups?
"RTN","MAGDIR9A",141,0)
 . . Q
"RTN","MAGDIR9A",142,0)
 . Q
"RTN","MAGDIR9A",143,0)
 ;
"RTN","MAGDIR9A",144,0)
 I ERRCODE Q ERRCODE ; fatal image DFN problem
"RTN","MAGDIR9A",145,0)
 ;
"RTN","MAGDIR9A",146,0)
 I 'HIT D  Q:ERRCODE ERRCODE ; the 2005 node does not yet exist
"RTN","MAGDIR9A",147,0)
 . ; create the radiology imaging group
"RTN","MAGDIR9A",148,0)
 . N PROCEDUR,RADRPT,RADPTR
"RTN","MAGDIR9A",149,0)
 . S PROCEDUR="RAD "_FILEDATA("MODALITY")
"RTN","MAGDIR9A",150,0)
 . S RADRPT=FILEDATA("RAD REPORT")
"RTN","MAGDIR9A",151,0)
 . S RADPTR=FILEDATA("RAD PROC PTR")
"RTN","MAGDIR9A",152,0)
 . D NEWGROUP(PROCEDUR,RADRPT,RADPTR) Q:ERRCODE
"RTN","MAGDIR9A",153,0)
 . ;
"RTN","MAGDIR9A",154,0)
 . ; store the cross-reference for the report
"RTN","MAGDIR9A",155,0)
 . D PTR^RARIC Q:Y>0
"RTN","MAGDIR9A",156,0)
 . I Y="-1^radiology report locked" S ERRCODE="-399^"_$P(Y,"^",2)
"RTN","MAGDIR9A",157,0)
 . E  I Y=0 S ERRCODE=-311
"RTN","MAGDIR9A",158,0)
 . E  S ERRCODE=-312
"RTN","MAGDIR9A",159,0)
 . Q
"RTN","MAGDIR9A",160,0)
 ;
"RTN","MAGDIR9A",161,0)
 I 'MAGGP D  Q ERRCODE ; fatal error
"RTN","MAGDIR9A",162,0)
 . K MSG
"RTN","MAGDIR9A",163,0)
 . S MSG(1)="IMAGE GROUP LOOKUP ERROR:"
"RTN","MAGDIR9A",164,0)
 . S MSG(2)="Looking for 2005 cross reference in ^RARPT("_RARPT_")"
"RTN","MAGDIR9A",165,0)
 . D ERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR9A",166,0)
 . S ERRCODE=-308
"RTN","MAGDIR9A",167,0)
 . Q
"RTN","MAGDIR9A",168,0)
 Q 0
"RTN","MAGDIR9A",169,0)
 ;
"RTN","MAGDIR9A",170,0)
NEWGROUP(PROCEDUR,RADRPT,RADPTR) ; create an imaging group (called by ^MAGDIR9E)
"RTN","MAGDIR9A",171,0)
 N I
"RTN","MAGDIR9A",172,0)
 K GROUP S I=0
"RTN","MAGDIR9A",173,0)
 S I=I+1,GROUP(I)=".01^"_PNAMEVAH_"  "_DCMPID_"  "_PROCDESC
"RTN","MAGDIR9A",174,0)
 S I=I+1,GROUP(I)="3^11" ; Object Type -- XRAY Group
"RTN","MAGDIR9A",175,0)
 S I=I+1,GROUP(I)="5^"_DFN
"RTN","MAGDIR9A",176,0)
 S I=I+1,GROUP(I)="6^"_PROCEDUR
"RTN","MAGDIR9A",177,0)
 S I=I+1,GROUP(I)="2005.04^0"
"RTN","MAGDIR9A",178,0)
 S I=I+1,GROUP(I)="10^"_PROCDESC
"RTN","MAGDIR9A",179,0)
 S I=I+1,GROUP(I)="15^"_DATETIME
"RTN","MAGDIR9A",180,0)
 S I=I+1,GROUP(I)="16^"_FILEDATA("PARENT FILE")
"RTN","MAGDIR9A",181,0)
 S I=I+1,GROUP(I)="17^"_FILEDATA("PARENT IEN")
"RTN","MAGDIR9A",182,0)
 S I=I+1,GROUP(I)="60^"_STUDYUID
"RTN","MAGDIR9A",183,0)
 ;
"RTN","MAGDIR9A",184,0)
 ; the following two fields are only for radiology
"RTN","MAGDIR9A",185,0)
 I $D(RADRPT) S I=I+1,GROUP(I)="61^"_RADRPT
"RTN","MAGDIR9A",186,0)
 I $D(RADPTR) S I=I+1,GROUP(I)="62^"_RADPTR
"RTN","MAGDIR9A",187,0)
 ;
"RTN","MAGDIR9A",188,0)
 S I=I+1,GROUP(I)=".05^"_INSTLOC
"RTN","MAGDIR9A",189,0)
 S I=I+1,GROUP(I)="40^"_FILEDATA("PACKAGE")
"RTN","MAGDIR9A",190,0)
 S I=I+1,GROUP(I)="41^"_$O(^MAG(2005.82,"B","CLIN",""))
"RTN","MAGDIR9A",191,0)
 S I=I+1,GROUP(I)="42^"_FILEDATA("TYPE")
"RTN","MAGDIR9A",192,0)
 S I=I+1,GROUP(I)="43^"_FILEDATA("PROC/EVENT")
"RTN","MAGDIR9A",193,0)
 S I=I+1,GROUP(I)="44^"_FILEDATA("SPEC/SUBSPEC")
"RTN","MAGDIR9A",194,0)
 S I=I+1,GROUP(I)="45^"_ORIGINDX
"RTN","MAGDIR9A",195,0)
 S I=I+1,GROUP(I)="107^"_FILEDATA("ACQUISITION DEVICE")
"RTN","MAGDIR9A",196,0)
 S I=I+1,GROUP(I)="110^"_STAMP
"RTN","MAGDIR9A",197,0)
 S I=I+1,GROUP(I)="251^"_FILEDATA("SOP CLASS POINTER")
"RTN","MAGDIR9A",198,0)
 D ADD^MAGGTIA(.RETURN,.GROUP)
"RTN","MAGDIR9A",199,0)
 S MAGGP=+RETURN
"RTN","MAGDIR9A",200,0)
 I 'MAGGP D  Q  ; fatal error
"RTN","MAGDIR9A",201,0)
 . K MSG
"RTN","MAGDIR9A",202,0)
 . S MSG(1)="IMAGE GROUP CREATION ERROR:"
"RTN","MAGDIR9A",203,0)
 . S MSG(2)=$P(RETURN,"^",2,999)
"RTN","MAGDIR9A",204,0)
 . D BADERROR^MAGDIRVE($T(+0),"DICOM IMAGE PROCESSING ERROR",.MSG)
"RTN","MAGDIR9A",205,0)
 . S ERRCODE=-306
"RTN","MAGDIR9A",206,0)
 . Q
"RTN","MAGDIR9A",207,0)
 ;
"RTN","MAGDIR9A",208,0)
 I MAGGP<LASTIMG D  Q  ; fatal last image pointer error
"RTN","MAGDIR9A",209,0)
 . D GROUPPTR^MAGDIRVE($T(+0),MAGGP,LASTIMG)
"RTN","MAGDIR9A",210,0)
 . S ERRCODE=-307
"RTN","MAGDIR9A",211,0)
 . Q
"RTN","MAGDIR9A",212,0)
 Q
"RTN","MAGDIR9A",213,0)
 ;
"RTN","MAGDRA2")
0^20^B28718021
"RTN","MAGDRA2",1,0)
MAGDRA2 ;WOIFO/LB - Routine for DICOM fix ; 08 Feb 2011 10:22 AM
"RTN","MAGDRA2",2,0)
 ;;3.0;IMAGING;**10,11,51,54,49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGDRA2",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDRA2",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRA2",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRA2",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRA2",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRA2",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRA2",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRA2",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRA2",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRA2",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRA2",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRA2",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRA2",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRA2",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRA2",17,0)
 ;;
"RTN","MAGDRA2",18,0)
 Q
"RTN","MAGDRA2",19,0)
 ; Routine to create the MAGDY variable needed by MAGDLB1 routine when
"RTN","MAGDRA2",20,0)
 ; manually correcting DICOM FIX files.
"RTN","MAGDRA2",21,0)
EN ;
"RTN","MAGDRA2",22,0)
 ; MAGDY variable to be created during this execution.
"RTN","MAGDRA2",23,0)
 N MAGBEG,MAGEND,MAGDFN,MAGOUT,MAGX,MAGXX,INFO,MAGNME,MAGSSN
"RTN","MAGDRA2",24,0)
 S MAGBEG=1070101,MAGEND=$$DT^XLFDT
"RTN","MAGDRA2",25,0)
READ ;
"RTN","MAGDRA2",26,0)
 S (MAGDFN,MAGX)=$$READ^MAGDRA3
"RTN","MAGDRA2",27,0)
 Q:MAGX="^"
"RTN","MAGDRA2",28,0)
 S MAGDFN=+MAGDFN
"RTN","MAGDRA2",29,0)
 I 'MAGDFN W !,"Entry not found, enter a ""^"" to quit." G READ
"RTN","MAGDRA2",30,0)
 ;
"RTN","MAGDRA2",31,0)
 I MAGX["~" G ONE  ;Lookup was on case number and successful
"RTN","MAGDRA2",32,0)
 S MAGXX=$$FIND1^DIC(70,"","","`"_MAGDFN)   ;Radiology patient
"RTN","MAGDRA2",33,0)
 ;
"RTN","MAGDRA2",34,0)
 I MAGDFN=MAGXX D
"RTN","MAGDRA2",35,0)
 . S INFO=$$PTINFO Q:$D(MAGERR)
"RTN","MAGDRA2",36,0)
 . S MAGNME=$P(INFO,"^"),MAGSSN=$P(INFO,"^",2)
"RTN","MAGDRA2",37,0)
 . K ^TMP($J,"RAE1")  ;Re-established by EN1^RA07PC1 -DBIA available
"RTN","MAGDRA2",38,0)
 . ; Set the beginning and ending date.
"RTN","MAGDRA2",39,0)
 . D EN1^RAO7PC1(MAGDFN,MAGBEG,MAGEND,500)
"RTN","MAGDRA2",40,0)
 . D:$D(^TMP($J,"RAE1")) LOOP^MAGDRA1
"RTN","MAGDRA2",41,0)
 . Q
"RTN","MAGDRA2",42,0)
 E  D  G:MAGX'="^" READ
"RTN","MAGDRA2",43,0)
 . W !,"No Radiology information found for the supplied answer.",$C(7)
"RTN","MAGDRA2",44,0)
 . Q
"RTN","MAGDRA2",45,0)
 Q
"RTN","MAGDRA2",46,0)
 ;
"RTN","MAGDRA2",47,0)
PTINFO() ;
"RTN","MAGDRA2",48,0)
 N INFO,MAGOUT
"RTN","MAGDRA2",49,0)
 I '$D(MAGDFN) Q ""
"RTN","MAGDRA2",50,0)
 D GETS^DIQ(2,MAGDFN,".01;.09","E","MAGOUT","MAGERR")
"RTN","MAGDRA2",51,0)
 I $D(MAGERR) Q ""
"RTN","MAGDRA2",52,0)
 I $D(MAGOUT) D  Q INFO
"RTN","MAGDRA2",53,0)
 . S INFO=$G(MAGOUT(2,MAGDFN_",",.01,"E"))
"RTN","MAGDRA2",54,0)
 . S INFO=INFO_"^"_$G(MAGOUT(2,MAGDFN_",",.09,"E"))
"RTN","MAGDRA2",55,0)
 . Q
"RTN","MAGDRA2",56,0)
 Q ""
"RTN","MAGDRA2",57,0)
 ;
"RTN","MAGDRA2",58,0)
LCASE(MAGDT,MAGCASE) ; return the accession number
"RTN","MAGDRA2",59,0)
 N ACNUMB,ARESULT
"RTN","MAGDRA2",60,0)
 S ACNUMB=$TR($TR($$FMTE^XLFDT(MAGDT,"2FD")," ","0"),"/","")_"-"_MAGCASE
"RTN","MAGDRA2",61,0)
 I $$USESSAN^RAHLRU1(),$$ACCFIND^RAAPI(ACNUMB,.ARESULT)>0 D  ; ICR 5600
"RTN","MAGDRA2",62,0)
 . ; lookup site-specific accession number
"RTN","MAGDRA2",63,0)
 . N ACNUMB1,RADFN,RADTI,RACNI
"RTN","MAGDRA2",64,0)
 . S RADFN=$P(ARESULT(1),"^",1),RADTI=$P(ARESULT(1),"^",2)
"RTN","MAGDRA2",65,0)
 . S RACNI=$P(ARESULT(1),"^",3)
"RTN","MAGDRA2",66,0)
 . S ACNUMB1=$$GET1^DIQ(70.03,(RACNI_","_RADTI_","_RADFN),31)
"RTN","MAGDRA2",67,0)
 . I ACNUMB1'="" S ACNUMB=ACNUMB1
"RTN","MAGDRA2",68,0)
 . Q
"RTN","MAGDRA2",69,0)
 Q ACNUMB
"RTN","MAGDRA2",70,0)
 ;
"RTN","MAGDRA2",71,0)
IMG(MAGRPT) ;
"RTN","MAGDRA2",72,0)
 N INFO,MAGOUT,MAGERR
"RTN","MAGDRA2",73,0)
 I 'MAGRPT Q ""
"RTN","MAGDRA2",74,0)
 D GETS^DIQ(74,MAGRPT,"2005*","I","MAGOUT","MAGERR")
"RTN","MAGDRA2",75,0)
 I $D(MAGERR) Q ""
"RTN","MAGDRA2",76,0)
 I $D(MAGOUT(74.02005)) Q " i"
"RTN","MAGDRA2",77,0)
 Q ""
"RTN","MAGDRA2",78,0)
 ;
"RTN","MAGDRA2",79,0)
PROC(MAGPRC) ;
"RTN","MAGDRA2",80,0)
 Q $$FIND1^DIC(71,,"XB",MAGPRC)
"RTN","MAGDRA2",81,0)
 ;
"RTN","MAGDRA2",82,0)
ONE ;
"RTN","MAGDRA2",83,0)
 ;MAGDFN,MAGX variables expected from EN
"RTN","MAGDRA2",84,0)
 I 'MAGDFN,'+MAGX Q
"RTN","MAGDRA2",85,0)
 N BEG,CASE,CDATE,CS,DATA,END,FLDS,INFO,MAGCASE,MAGCNI,MAGDATE,MAGDTI
"RTN","MAGDRA2",86,0)
 N MAGEXST,MAGLOC,MAGNME,MAGOUT,MAGPIEN,MAGPRC,MAGPSET,MAGPST,MAGRPT
"RTN","MAGDRA2",87,0)
 N PP,PSET,RAENTRY,RAMEMLOW,RAPRTSET,RIEN,STAT,X,X1,X2,XX
"RTN","MAGDRA2",88,0)
 N RARPT,RADFN,RADTI,RACNI ;<--Variables needed for EN1^RAUTL20
"RTN","MAGDRA2",89,0)
 ; RAUTL20 used to retrieve if case is part of a print set.
"RTN","MAGDRA2",90,0)
 S MAGDFN=$P(MAGX,"~"),INFO=$$PTINFO
"RTN","MAGDRA2",91,0)
 S MAGNME=$P(INFO,"^"),MAGSSN=$P(INFO,"^",2)
"RTN","MAGDRA2",92,0)
 S RIEN=$P(MAGX,"~",2)_","_$P(MAGX,"~",1)
"RTN","MAGDRA2",93,0)
 S BEG=9999999.9999-$P(MAGX,"~",2),END=$$FMADD^XLFDT(BEG,2)
"RTN","MAGDRA2",94,0)
 K ^TMP($J,"RAE1")
"RTN","MAGDRA2",95,0)
 D EN1^RAO7PC1(MAGDFN,BEG,END,20)
"RTN","MAGDRA2",96,0)
 S RAENTRY=$P(MAGX,"~",2)_"-"_$P(MAGX,"~",3)
"RTN","MAGDRA2",97,0)
 Q:'$D(^TMP($J,"RAE1"))
"RTN","MAGDRA2",98,0)
 Q:'$D(^TMP($J,"RAE1",MAGDFN,RAENTRY))
"RTN","MAGDRA2",99,0)
 S DATA=^TMP($J,"RAE1",MAGDFN,RAENTRY)
"RTN","MAGDRA2",100,0)
 S MAGDATE=$P(RAENTRY,"-"),CDATE=9999999.9999-MAGDATE
"RTN","MAGDRA2",101,0)
 S MAGDATE=$TR($$FMTE^XLFDT(CDATE,"2FD")," ","0")
"RTN","MAGDRA2",102,0)
 S MAGPRC=$P(DATA,"^"),CASE=$P(DATA,"^",2),STAT=$P(DATA,"^",6)
"RTN","MAGDRA2",103,0)
 S MAGEXST=$P(STAT,"~",2),MAGLOC=$P(DATA,"^",7)
"RTN","MAGDRA2",104,0)
 S (MAGRPT,RARPT)=$P(DATA,"^",5)
"RTN","MAGDRA2",105,0)
 S (MAGDTI,RADTI)=$P(RAENTRY,"-")
"RTN","MAGDRA2",106,0)
 S (MAGCNI,RACNI)=$P(RAENTRY,"-",2),RADFN=MAGDFN
"RTN","MAGDRA2",107,0)
 S MAGCASE=$$LCASE(CDATE,CASE),MAGPIEN=$$PROC(MAGPRC)
"RTN","MAGDRA2",108,0)
 ; RADTI, RADFN, RACNI variables needed for EN1^RAUTL20
"RTN","MAGDRA2",109,0)
 D EN1^RAUTL20
"RTN","MAGDRA2",110,0)
 S (PSET,MAGPSET)=""
"RTN","MAGDRA2",111,0)
 S PSET=$S(RAMEMLOW:"+",RAPRTSET:".",1:"")
"RTN","MAGDRA2",112,0)
 I PSET=".",RACNI>1 D
"RTN","MAGDRA2",113,0)
 . N OLDENTRY S OLDENTRY=$P(RAENTRY,"-")_"-"
"RTN","MAGDRA2",114,0)
 . S OLDENTRY=$O(^TMP($J,"RAE1",MAGDFN,OLDENTRY)) I $L(OLDENTRY) D
"RTN","MAGDRA2",115,0)
 . . S MAGCASE=$P(^TMP($J,"RAE1",MAGDFN,OLDENTRY),"^",2)
"RTN","MAGDRA2",116,0)
 . . S CDATE=$P(RAENTRY,"-")
"RTN","MAGDRA2",117,0)
 . . S CDATE=9999999.9999-CDATE
"RTN","MAGDRA2",118,0)
 . . S MAGCASE=$$LCASE^MAGDRA2(CDATE,MAGCASE),RACNI=$P(OLDENTRY,"-",2)
"RTN","MAGDRA2",119,0)
 . . S MAGPST=CASE_" is part of this printset."
"RTN","MAGDRA2",120,0)
 . . Q
"RTN","MAGDRA2",121,0)
 . Q
"RTN","MAGDRA2",122,0)
 I $D(RAPRTSET) S PP=$S(MAGCNI>1:".",MAGCNI=1:"+",1:"")
"RTN","MAGDRA2",123,0)
 S MAGCNI=RACNI
"RTN","MAGDRA2",124,0)
 W !,"PATIENT: ",MAGNME,?51,"SSN: ",MAGSSN
"RTN","MAGDRA2",125,0)
 W !,"Case No.",?15,"Procedure",?42,"Location",?64,"Exam Date"
"RTN","MAGDRA2",126,0)
 W !,"________",?15,"_________",?42,"________________",?64,"________"
"RTN","MAGDRA2",127,0)
 W !,$G(PP),CASE,$$IMG(MAGRPT),?15,MAGPRC,?42,MAGLOC,?64,MAGDATE
"RTN","MAGDRA2",128,0)
 W !,"Exam status: ",MAGEXST," "," ",$G(MAGPST)
"RTN","MAGDRA2",129,0)
 D MAGDY
"RTN","MAGDRA2",130,0)
 Q
"RTN","MAGDRA2",131,0)
 ;
"RTN","MAGDRA2",132,0)
MAGDY ;
"RTN","MAGDRA2",133,0)
 S MAGDY=MAGDFN_"^"_MAGNME_"^"_MAGSSN_"^"_MAGCASE_"^"_MAGPRC_"^"_MAGDTI
"RTN","MAGDRA2",134,0)
 S MAGDY=MAGDY_"^"_MAGCNI_"^"_MAGPIEN_"^"_$G(MAGPST)_"^"
"RTN","MAGDRA2",135,0)
 K MAGNME,MAGSSN,MAGCASE,MAGPRC,MAGDTI,MAGCNI,MAGPIEN,MAPST
"RTN","MAGDRA2",136,0)
 Q
"RTN","MAGDRA2",137,0)
 ;
"RTN","MAGDRA3")
0^21^B6846608
"RTN","MAGDRA3",1,0)
MAGDRA3 ;WOIFO/LB - Routine to lookup patient by casenumber of name ; 05 Apr 2011 8:50 AM
"RTN","MAGDRA3",2,0)
 ;;3.0;IMAGING;**49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGDRA3",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDRA3",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRA3",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRA3",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRA3",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRA3",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRA3",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRA3",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRA3",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRA3",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRA3",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRA3",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRA3",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRA3",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRA3",17,0)
 ;;
"RTN","MAGDRA3",18,0)
 Q
"RTN","MAGDRA3",19,0)
ASK() ;Prompt user
"RTN","MAGDRA3",20,0)
 N DIR,X,Y
"RTN","MAGDRA3",21,0)
 S DIR(0)="F:1:30",DIR("A")="Enter patient or case number"
"RTN","MAGDRA3",22,0)
 S DIR("?")="Enter a patient name or case number to associate this image."
"RTN","MAGDRA3",23,0)
 D ^DIR
"RTN","MAGDRA3",24,0)
 Q Y
"RTN","MAGDRA3",25,0)
READ(RESULT) ;
"RTN","MAGDRA3",26,0)
 N ANS
"RTN","MAGDRA3",27,0)
 S RESULT=0,ANS=$$ASK
"RTN","MAGDRA3",28,0)
 I ANS=""!(ANS="^") S RESULT="^" Q RESULT
"RTN","MAGDRA3",29,0)
 I ANS?1.5N!(ANS?6N1"-".N)!(ANS?3N1"-"6N1"-".N) D CASE(ANS,.RESULT) I +RESULT Q RESULT
"RTN","MAGDRA3",30,0)
 I ANS?1.8N Q RESULT  ;Incomplete ssn sent. Couldn't be a case number?
"RTN","MAGDRA3",31,0)
 D:ANS'?.N1"-".E PAT(ANS,.RESULT)
"RTN","MAGDRA3",32,0)
 Q RESULT
"RTN","MAGDRA3",33,0)
CASE(CASE,RESULT) ;
"RTN","MAGDRA3",34,0)
 N MAGXR,MAGDFN,MAGDTI,MAGCNI,ARESULT
"RTN","MAGDRA3",35,0)
 S MAGXR=$S($L(CASE,"-")>1:"RAAPI",1:"AE")
"RTN","MAGDRA3",36,0)
 I MAGXR="RAAPI",$$ACCFIND^RAAPI(CASE,.ARESULT)>0 S RESULT=$TR(ARESULT(1),"^","~")
"RTN","MAGDRA3",37,0)
 I MAGXR="AE",$D(^RADPT(MAGXR,CASE)) D
"RTN","MAGDRA3",38,0)
 . S MAGDFN=$O(^RADPT(MAGXR,CASE,0))
"RTN","MAGDRA3",39,0)
 . S MAGDTI=$O(^RADPT(MAGXR,CASE,MAGDFN,0))
"RTN","MAGDRA3",40,0)
 . S MAGCNI=$O(^RADPT(MAGXR,CASE,MAGDFN,MAGDTI,0))
"RTN","MAGDRA3",41,0)
 . S RESULT=MAGDFN_"~"_MAGDTI_"~"_MAGCNI
"RTN","MAGDRA3",42,0)
 Q 
"RTN","MAGDRA3",43,0)
PAT(PAT,RESULT) ;
"RTN","MAGDRA3",44,0)
 N DIR,X,Y
"RTN","MAGDRA3",45,0)
 S DIR(0)="P^70:EMZ",DIR("B")=PAT
"RTN","MAGDRA3",46,0)
 D ^DIR
"RTN","MAGDRA3",47,0)
 S RESULT=Y
"RTN","MAGDRA3",48,0)
 Q
"RTN","MAGDRAHL")
0^22^B8520421
"RTN","MAGDRAHL",1,0)
MAGDRAHL ;WOIFO/PMK - Program to read a DICOM file ; 21 Oct 2010 3:01 PM
"RTN","MAGDRAHL",2,0)
 ;;3.0;IMAGING;**49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGDRAHL",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDRAHL",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRAHL",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRAHL",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRAHL",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRAHL",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRAHL",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRAHL",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRAHL",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRAHL",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRAHL",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRAHL",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRAHL",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRAHL",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRAHL",17,0)
 ;;
"RTN","MAGDRAHL",18,0)
 ; This routine is invoked by RAHLR to create the HL7 ZDS segment with
"RTN","MAGDRAHL",19,0)
 ; the Study Instance UID
"RTN","MAGDRAHL",20,0)
 ;
"RTN","MAGDRAHL",21,0)
 ; The following code creates a DICOM Study Instance UID from three
"RTN","MAGDRAHL",22,0)
 ; Radiology Package variables: RADTI, RACNI, and ACNUMB
"RTN","MAGDRAHL",23,0)
 ; Input:
"RTN","MAGDRAHL",24,0)
 ;   RADTI -- internal subscript for the study in RADPT - reverse date/time  
"RTN","MAGDRAHL",25,0)
 ;   RACNI -- internal subscript for the study in RADPT - counter
"RTN","MAGDRAHL",26,0)
 ;   ACNUMB - external identifier for the study - [site number -] date-case number
"RTN","MAGDRAHL",27,0)
 ;   
"RTN","MAGDRAHL",28,0)
STUDYUID(RADTI,RACNI,ACNUMB) ; return the Study Instance UID
"RTN","MAGDRAHL",29,0)
 N FLAG ;----- Flag to prevent multiple dots in a row or leading zeroes
"RTN","MAGDRAHL",30,0)
 N I ;-------- Loop counter
"RTN","MAGDRAHL",31,0)
 N RAW ;----- "Raw" STUDYUID
"RTN","MAGDRAHL",32,0)
 N STATNUMB ;- Station number
"RTN","MAGDRAHL",33,0)
 N STUDYUID ;- Resulting unique identifier
"RTN","MAGDRAHL",34,0)
 ;
"RTN","MAGDRAHL",35,0)
 S STATNUMB=$E($P($$NS^XUAF4($$KSP^XUPARAM("INST")),U,2),1,3) ; station number
"RTN","MAGDRAHL",36,0)
 S RAW=^MAGD(2006.15,1,"UID ROOT")_".1.4."_STATNUMB_"."_RADTI_"."_RACNI_"."_ACNUMB
"RTN","MAGDRAHL",37,0)
 S STUDYUID="",FLAG=0 F I=1:1:$L(RAW) D
"RTN","MAGDRAHL",38,0)
 . N E
"RTN","MAGDRAHL",39,0)
 . S E=$E(RAW,I) S:E'?1AN E="."
"RTN","MAGDRAHL",40,0)
 . I "123456789"[E S STUDYUID=STUDYUID_E,FLAG=1 Q
"RTN","MAGDRAHL",41,0)
 . I E="0" S:$E(RAW,I+1)'?1AN FLAG=1 S:FLAG STUDYUID=STUDYUID_E Q
"RTN","MAGDRAHL",42,0)
 . I E?1U S STUDYUID=STUDYUID_($A(E)),FLAG=1 Q
"RTN","MAGDRAHL",43,0)
 . I E?1L S STUDYUID=STUDYUID_($A(E)-32),FLAG=1 Q
"RTN","MAGDRAHL",44,0)
 . I E="." S:FLAG STUDYUID=STUDYUID_E S FLAG=0 Q
"RTN","MAGDRAHL",45,0)
 . Q
"RTN","MAGDRAHL",46,0)
 ; No trailing dots either
"RTN","MAGDRAHL",47,0)
 F  Q:$E(STUDYUID,$L(STUDYUID))'="."  S STUDYUID=$E(STUDYUID,1,$L(STUDYUID)-1)
"RTN","MAGDRAHL",48,0)
 I $L(STUDYUID)>64 S $EC=",U13-STUDY UID too long,"
"RTN","MAGDRAHL",49,0)
 Q STUDYUID
"RTN","MAGDRAHL",50,0)
 ;
"RTN","MAGDRAHL",51,0)
ZDS(STUDYUID) ; returns the ZDS segment
"RTN","MAGDRAHL",52,0)
 N HLECH1 ;--- HL7 component separator
"RTN","MAGDRAHL",53,0)
 S HLECH1=$E(HLECH) ; HL7 component separator
"RTN","MAGDRAHL",54,0)
 I $L(STUDYUID)>64 S $EC=",U13-STUDY UID too long,"
"RTN","MAGDRAHL",55,0)
 Q "ZDS"_HLFS_STUDYUID_HLECH1_"VISTA"_HLECH1_"Application"_HLECH1_"DICOM"
"RTN","MAGDRPC1")
0^23^B46663428
"RTN","MAGDRPC1",1,0)
MAGDRPC1 ;WOIFO/EdM - Imaging RPCs ; 27 Jul 2010 6:50 AM
"RTN","MAGDRPC1",2,0)
 ;;3.0;IMAGING;**11,30,51,50,54,49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGDRPC1",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDRPC1",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC1",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRPC1",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRPC1",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRPC1",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRPC1",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRPC1",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRPC1",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRPC1",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRPC1",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRPC1",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRPC1",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRPC1",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC1",17,0)
 ;;
"RTN","MAGDRPC1",18,0)
 Q
"RTN","MAGDRPC1",19,0)
 ;
"RTN","MAGDRPC1",20,0)
GETID(OUT,HOSTNAME) ; RPC = MAG DICOM GET MACHINE ID
"RTN","MAGDRPC1",21,0)
 N D0,I,LO,N,UP,X
"RTN","MAGDRPC1",22,0)
 S HOSTNAME=$TR($G(HOSTNAME),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","MAGDRPC1",23,0)
 I HOSTNAME="" S OUT="-1,No Hostname Specified" Q
"RTN","MAGDRPC1",24,0)
 S OUT=$O(^MAGDICOM(2006.5641,"C",HOSTNAME,""))
"RTN","MAGDRPC1",25,0)
 Q:OUT>0
"RTN","MAGDRPC1",26,0)
 L +^MAGDICOM(2006.5641,0):1E9 ; Background process MUST wait
"RTN","MAGDRPC1",27,0)
 S D0=$O(^MAGDICOM(2006.5641," "),-1)+1
"RTN","MAGDRPC1",28,0)
 S ^MAGDICOM(2006.5641,D0,0)=D0_"^"_HOSTNAME_"^"_$H
"RTN","MAGDRPC1",29,0)
 S ^MAGDICOM(2006.5641,"B",D0,D0)=""
"RTN","MAGDRPC1",30,0)
 S ^MAGDICOM(2006.5641,"C",HOSTNAME,D0)=""
"RTN","MAGDRPC1",31,0)
 S (N,I,D0)=0 F  S D0=$O(^MAGDICOM(2006.5641,D0)) Q:'D0  S N=N+1,I=D0
"RTN","MAGDRPC1",32,0)
 S ^MAGDICOM(2006.5641,0)="DICOM GATEWAY MACHINE ID^2006.5641^"_I_"^"_N
"RTN","MAGDRPC1",33,0)
 L -^MAGDICOM(2006.5641,0)
"RTN","MAGDRPC1",34,0)
 S OUT=D0
"RTN","MAGDRPC1",35,0)
 Q
"RTN","MAGDRPC1",36,0)
 ;
"RTN","MAGDRPC1",37,0)
DOMAIN(OUT) ; RPC = MAG DICOM GET DOMAIN
"RTN","MAGDRPC1",38,0)
 N X
"RTN","MAGDRPC1",39,0)
 I $T(WHERE^XUPARAM)'="" S OUT=$$KSP^XUPARAM("WHERE") Q
"RTN","MAGDRPC1",40,0)
 ; The coding standards frown upon the line below,
"RTN","MAGDRPC1",41,0)
 ; but it is the best we can do when the line above cannot be used.
"RTN","MAGDRPC1",42,0)
 S X=^DD("SITE") S:X'[".DOMAIN.EXT" X=X_".DOMAIN.EXT"
"RTN","MAGDRPC1",43,0)
 S OUT=X
"RTN","MAGDRPC1",44,0)
 Q
"RTN","MAGDRPC1",45,0)
 ;
"RTN","MAGDRPC1",46,0)
INFO(OUT,LOCATION) ; RPC = MAG DICOM ET PHONE HOME
"RTN","MAGDRPC1",47,0)
 N FST,N,X
"RTN","MAGDRPC1",48,0)
 K OUT
"RTN","MAGDRPC1",49,0)
 S FST=$$FMADD^XLFDT(DT,-25)
"RTN","MAGDRPC1",50,0)
 S N=2
"RTN","MAGDRPC1",51,0)
 ;
"RTN","MAGDRPC1",52,0)
 ; Site-ID
"RTN","MAGDRPC1",53,0)
 D DOMAIN(.X)
"RTN","MAGDRPC1",54,0)
 S OUT(N)=X
"RTN","MAGDRPC1",55,0)
 ;
"RTN","MAGDRPC1",56,0)
 D ROUTEDAY^MAGDRPC2 ; Get routing statistics
"RTN","MAGDRPC1",57,0)
 ;
"RTN","MAGDRPC1",58,0)
 D  ; Text Gateway Statistics
"RTN","MAGDRPC1",59,0)
 . N A,C,D0,D2,M,X
"RTN","MAGDRPC1",60,0)
 . S A=0,D0=FST F  S D0=$O(^MAGDAUDT(2006.5761,D0)) Q:'D0  D
"RTN","MAGDRPC1",61,0)
 . . S D2=0 F  S D2=$O(^MAGDAUDT(2006.5761,D0,1,LOCATION,1,D2)) Q:'D2  D
"RTN","MAGDRPC1",62,0)
 . . . S X=$G(^MAGDAUDT(2006.5761,D0,1,LOCATION,1,D2,0))
"RTN","MAGDRPC1",63,0)
 . . . S M=$P(X,"^",2) Q:'M
"RTN","MAGDRPC1",64,0)
 . . . S:'A N=N+1,OUT(N)="Audit",A=1
"RTN","MAGDRPC1",65,0)
 . . . S N=N+1,OUT(N)="STTX="_D0_"^"_$P(X,"^",1)_"^"_M
"RTN","MAGDRPC1",66,0)
 . . . Q
"RTN","MAGDRPC1",67,0)
 . . Q
"RTN","MAGDRPC1",68,0)
 . Q
"RTN","MAGDRPC1",69,0)
 ;
"RTN","MAGDRPC1",70,0)
 S OUT(1)=N-1
"RTN","MAGDRPC1",71,0)
 Q
"RTN","MAGDRPC1",72,0)
 ;
"RTN","MAGDRPC1",73,0)
STATION(OUT,STATION,VERSION) ; RPC = MAG DICOM WORKSTATION VERSION
"RTN","MAGDRPC1",74,0)
 N D0,X
"RTN","MAGDRPC1",75,0)
 I $G(STATION)="" S OUT="-1,No Station Identifier Specified" Q
"RTN","MAGDRPC1",76,0)
 ;
"RTN","MAGDRPC1",77,0)
 S D0=$O(^MAG(2006.83,"B",STATION,"")) D:'D0
"RTN","MAGDRPC1",78,0)
 . L +^MAG(2006.83,0):1E9 ; Background process must wait for LOCK
"RTN","MAGDRPC1",79,0)
 . S X=$G(^MAG(2006.83,0))
"RTN","MAGDRPC1",80,0)
 . S $P(X,"^",1,2)="DICOM WORKSTATION^2006.83"
"RTN","MAGDRPC1",81,0)
 . S D0=$O(^MAG(2006.83," "),-1)+1
"RTN","MAGDRPC1",82,0)
 . S $P(X,"^",3)=D0
"RTN","MAGDRPC1",83,0)
 . S $P(X,"^",4)=$P(X,"^",4)+1
"RTN","MAGDRPC1",84,0)
 . S ^MAG(2006.83,0)=X,^MAG(2006.83,D0,0)=STATION
"RTN","MAGDRPC1",85,0)
 . S ^MAG(2006.83,"B",STATION,D0)=""
"RTN","MAGDRPC1",86,0)
 . L -^MAG(2006.83,0)
"RTN","MAGDRPC1",87,0)
 . Q
"RTN","MAGDRPC1",88,0)
 S $P(^MAG(2006.83,D0,0),"^",3)=VERSION
"RTN","MAGDRPC1",89,0)
 S X=$P(^MAG(2006.83,D0,0),"^",2)
"RTN","MAGDRPC1",90,0)
 S $P(^MAG(2006.83,D0,0),"^",2)=$$NOW^XLFDT()
"RTN","MAGDRPC1",91,0)
 S OUT=D0
"RTN","MAGDRPC1",92,0)
 Q
"RTN","MAGDRPC1",93,0)
 ;
"RTN","MAGDRPC1",94,0)
FMGET(OUT,FILE,D0,FIELD) ; RPC = MAG DICOM FILEMAN GET
"RTN","MAGDRPC1",95,0)
 ; Get the value of a data field
"RTN","MAGDRPC1",96,0)
 S OUT=$$GET1^DIQ(FILE,D0,FIELD)
"RTN","MAGDRPC1",97,0)
 Q
"RTN","MAGDRPC1",98,0)
 ;
"RTN","MAGDRPC1",99,0)
CUTOFF(OUT,D0) ; RPC = MAG DICOM PACS CUTOFF DATE
"RTN","MAGDRPC1",100,0)
 ; Retention Period for PACS
"RTN","MAGDRPC1",101,0)
 N X
"RTN","MAGDRPC1",102,0)
 I '$$CONSOLID^MAGBAPI() D  Q
"RTN","MAGDRPC1",103,0)
 . ; Non-consolidated site
"RTN","MAGDRPC1",104,0)
 . I '$D(^MAG(2006.1,"APACS")) S OUT="-2,No PACS Installed" Q
"RTN","MAGDRPC1",105,0)
 . ;
"RTN","MAGDRPC1",106,0)
 . S X=$G(^MAG(2006.1,"AIMDELPACS"))
"RTN","MAGDRPC1",107,0)
 . I X="" S OUT="-3,PACS Retention Parameter not defined" Q
"RTN","MAGDRPC1",108,0)
 . S OUT=X
"RTN","MAGDRPC1",109,0)
 . Q
"RTN","MAGDRPC1",110,0)
 ; Consolidated site:
"RTN","MAGDRPC1",111,0)
 I '$P($G(^MAG(2006.1,D0,"PACS")),"^",1) S OUT="-2,No PACS Installed" Q
"RTN","MAGDRPC1",112,0)
 ;
"RTN","MAGDRPC1",113,0)
 S X=$P($G(^MAG(2006.1,D0,1)),"^",5)
"RTN","MAGDRPC1",114,0)
 I X="" S OUT="-3,PACS Retention Parameter not defined" Q
"RTN","MAGDRPC1",115,0)
 S OUT=X
"RTN","MAGDRPC1",116,0)
 Q
"RTN","MAGDRPC1",117,0)
 ;
"RTN","MAGDRPC1",118,0)
MINSPACE(OUT,D0) ; RPC = MAG DICOM PACS MINIMUM SPACE
"RTN","MAGDRPC1",119,0)
 ; Minimum Percentage of Free Disk Space
"RTN","MAGDRPC1",120,0)
 N X
"RTN","MAGDRPC1",121,0)
 I '$$CONSOLID^MAGBAPI() D  Q
"RTN","MAGDRPC1",122,0)
 . ; Non-consolidated site
"RTN","MAGDRPC1",123,0)
 . I '$D(^MAG(2006.1,"APACS")) S OUT="-2,No PACS Installed" Q
"RTN","MAGDRPC1",124,0)
 . ;
"RTN","MAGDRPC1",125,0)
 . S X=$G(^MAG(2006.1,"AIMDELPACS2"))
"RTN","MAGDRPC1",126,0)
 . I X="" S OUT="-3,PACS Minimum Space Percentage Parameter not defined" Q
"RTN","MAGDRPC1",127,0)
 . S OUT=X
"RTN","MAGDRPC1",128,0)
 . Q
"RTN","MAGDRPC1",129,0)
 ; Consolidated site:
"RTN","MAGDRPC1",130,0)
 I '$P($G(^MAG(2006.1,D0,"PACS")),"^",1) S OUT="-2,No PACS Installed" Q
"RTN","MAGDRPC1",131,0)
 ;
"RTN","MAGDRPC1",132,0)
 S X=$P($G(^MAG(2006.1,D0,3)),"^",5)
"RTN","MAGDRPC1",133,0)
 I X="" S OUT="-3,PACS Minimum Space Percentage Parameter not defined" Q
"RTN","MAGDRPC1",134,0)
 S OUT=X
"RTN","MAGDRPC1",135,0)
 Q
"RTN","MAGDRPC1",136,0)
 ;
"RTN","MAGDRPC1",137,0)
HL7PURGE(OUT,CUTOFF) ; RPC = MAG DICOM PURGE HL7
"RTN","MAGDRPC1",138,0)
 ; Purge HL7 transactions
"RTN","MAGDRPC1",139,0)
 N D,D0,P,T,X
"RTN","MAGDRPC1",140,0)
 S OUT=0
"RTN","MAGDRPC1",141,0)
 S D="" F  S D=$O(^MAGDHL7(2006.5,"B",D)) Q:'D  Q:D'<CUTOFF  D
"RTN","MAGDRPC1",142,0)
 . S D0="" F  S D0=$O(^MAGDHL7(2006.5,"B",D,D0)) Q:'D0  D
"RTN","MAGDRPC1",143,0)
 . . S X=$G(^MAGDHL7(2006.5,D0,0)),P=$P(X,"^",4),T=$P(X,"^",3)
"RTN","MAGDRPC1",144,0)
 . . K ^MAGDHL7(2006.5,D0)
"RTN","MAGDRPC1",145,0)
 . . K ^MAGDHL7(2006.5,"B",D,D0)
"RTN","MAGDRPC1",146,0)
 . . K:T'="" ^MAGDHL7(2006.5,"C",T,D0)
"RTN","MAGDRPC1",147,0)
 . . K:P'="" ^MAGDHL7(2006.5,"D",P,D0)
"RTN","MAGDRPC1",148,0)
 . . S OUT=OUT+1
"RTN","MAGDRPC1",149,0)
 . . Q
"RTN","MAGDRPC1",150,0)
 . Q
"RTN","MAGDRPC1",151,0)
 D:OUT
"RTN","MAGDRPC1",152,0)
 . L +^MAGDHL7(2006.5,0):1E9
"RTN","MAGDRPC1",153,0)
 . S X=$G(^MAGDHL7(2006.5,0))
"RTN","MAGDRPC1",154,0)
 . S $P(X,"^",1,2)="PACS MESSAGES^2006.5D"
"RTN","MAGDRPC1",155,0)
 . S $P(X,"^",4)=$P(X,"^",4)-OUT
"RTN","MAGDRPC1",156,0)
 . S ^MAGDHL7(2006.5,0)=X
"RTN","MAGDRPC1",157,0)
 . L -^MAGDHL7(2006.5,0)
"RTN","MAGDRPC1",158,0)
 . Q
"RTN","MAGDRPC1",159,0)
 Q
"RTN","MAGDRPC1",160,0)
 ;
"RTN","MAGDRPC1",161,0)
VALDEST(OUT,NAME) ; RPC = MAG DICOM ROUTE VALID DEST
"RTN","MAGDRPC1",162,0)
 N D0,PLACE,X
"RTN","MAGDRPC1",163,0)
 ; This function is also called from various routines
"RTN","MAGDRPC1",164,0)
 ; that belong to automated routing.
"RTN","MAGDRPC1",165,0)
 ;
"RTN","MAGDRPC1",166,0)
 S OUT="-1,"""_NAME_""" is not a valid destination"
"RTN","MAGDRPC1",167,0)
 ;
"RTN","MAGDRPC1",168,0)
 I $D(^MAG(2005.2,"B")) D  Q
"RTN","MAGDRPC1",169,0)
 . S D0=$O(^MAG(2005.2,"B",NAME,"")) Q:'D0
"RTN","MAGDRPC1",170,0)
 . S:$P($G(^MAG(2005.2,D0,0)),"^",9) OUT=D0
"RTN","MAGDRPC1",171,0)
 . Q
"RTN","MAGDRPC1",172,0)
 ;
"RTN","MAGDRPC1",173,0)
 S D0=""
"RTN","MAGDRPC1",174,0)
 S PLACE="" F  S PLACE=$O(^MAG(2005.2,"D",PLACE)) Q:PLACE=""  D  Q:OUT>0
"RTN","MAGDRPC1",175,0)
 . S D0=$O(^MAG(2005.2,"D",PLACE,NAME,""))
"RTN","MAGDRPC1",176,0)
 . S:$P($G(^MAG(2005.2,D0,0)),"^",9) OUT=D0
"RTN","MAGDRPC1",177,0)
 . Q
"RTN","MAGDRPC1",178,0)
 Q
"RTN","MAGDRPC1",179,0)
 ;
"RTN","MAGDRPC1",180,0)
PAT(OUT,DFN) ; RPC = MAG DICOM GET PATIENT
"RTN","MAGDRPC1",181,0)
 N DIQUIET,I,N,VADM,VAIN,VAPA,VASD
"RTN","MAGDRPC1",182,0)
 K OUT
"RTN","MAGDRPC1",183,0)
 I '$G(DFN) S OUT(1)="-1,No Patient Identified" Q
"RTN","MAGDRPC1",184,0)
 S N=1,DIQUIET=1
"RTN","MAGDRPC1",185,0)
 D DEM^VADPT,VA("DEM","VADM","")
"RTN","MAGDRPC1",186,0)
 D ADD^VADPT,VA("ADD","VAPA","")
"RTN","MAGDRPC1",187,0)
 D INP^VADPT,VA("INP","VAIN","")
"RTN","MAGDRPC1",188,0)
 D SDA^VADPT,VA("SDA","VASD","")
"RTN","MAGDRPC1",189,0)
 S X=$$GETICN^MPIF001(DFN) S:X'<0 N=N+1,OUT(N)="ICN^1^"_X
"RTN","MAGDRPC1",190,0)
 S N=N+1,OUT(N)="Site-DFN^1^"_$E($P($$NS^XUAF4($$KSP^XUPARAM("INST")),U,2),1,3)_"-"_DFN
"RTN","MAGDRPC1",191,0)
 S OUT(1)=N-1
"RTN","MAGDRPC1",192,0)
 Q
"RTN","MAGDRPC1",193,0)
 ;
"RTN","MAGDRPC1",194,0)
VA(PRE,ARR,SUB) N A,I,X
"RTN","MAGDRPC1",195,0)
 S I="" F  S I=$O(@ARR@(I)) Q:I=""  D
"RTN","MAGDRPC1",196,0)
 . S A=$NAME(@ARR@(I))
"RTN","MAGDRPC1",197,0)
 . S X=$G(@A) S:X'="" N=N+1,OUT(N)=PRE_"^"_SUB_I_"^"_X
"RTN","MAGDRPC1",198,0)
 . D:$D(@A)>9 VA(PRE,A,SUB_I_",")
"RTN","MAGDRPC1",199,0)
 . Q
"RTN","MAGDRPC1",200,0)
 Q
"RTN","MAGDRPC1",201,0)
 ;
"RTN","MAGDRPC1",202,0)
RARPTO(OUT,TYPE,D0,F,D1) ; RPC = MAG DICOM GET RAD RPT INFO
"RTN","MAGDRPC1",203,0)
 S TYPE=$G(TYPE),D0=$G(D0),F=$G(F,1),D1=+$G(D1)
"RTN","MAGDRPC1",204,0)
 I TYPE="O1" S OUT=+$O(^RARPT(D0),F) Q
"RTN","MAGDRPC1",205,0)
 I TYPE="O2" S OUT=+$O(^RARPT(D0,F,D1)) Q
"RTN","MAGDRPC1",206,0)
 I TYPE="G1" S OUT=$G(^RARPT(D0,0)) Q
"RTN","MAGDRPC1",207,0)
 I TYPE="G2" S OUT=$G(^RARPT(D0,F,D1,0)) Q
"RTN","MAGDRPC1",208,0)
 S OUT="-1,Invalid request type ("""_TYPE_""")"
"RTN","MAGDRPC1",209,0)
 Q
"RTN","MAGDRPC1",210,0)
 ;
"RTN","MAGDRPC1",211,0)
LISTORIG(OUT) ; RPC = MAG GET DICOM XMIT ORIGIN
"RTN","MAGDRPC1",212,0)
 N FROM,MSG,N,PRI,RTN
"RTN","MAGDRPC1",213,0)
 S N=1,OUT(1)="No entries in transmission queue"
"RTN","MAGDRPC1",214,0)
 S FROM="" F  S FROM=$O(^MAGDOUTP(2006.574,"STS",FROM)) Q:FROM=""  D
"RTN","MAGDRPC1",215,0)
 . D GETS^DIQ(4,FROM,.01,"","RTN","MSG")
"RTN","MAGDRPC1",216,0)
 . S N=N+1,OUT(N)=FROM_"^"_$G(RTN(4,FROM_",",.01))
"RTN","MAGDRPC1",217,0)
 . Q
"RTN","MAGDRPC1",218,0)
 S:N>1 OUT(1)=N
"RTN","MAGDRPC1",219,0)
 Q
"RTN","MAGDRPC1",220,0)
 ;
"RTN","MAGDRPC3")
0^24^B57242503
"RTN","MAGDRPC3",1,0)
MAGDRPC3 ;WOIFO/EdM - Imaging RPCs ; 04 Jan 2011 8:37 AM
"RTN","MAGDRPC3",2,0)
 ;;3.0;IMAGING;**11,30,51,50,85,54,49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGDRPC3",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDRPC3",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC3",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRPC3",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRPC3",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRPC3",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRPC3",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRPC3",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRPC3",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRPC3",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRPC3",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRPC3",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRPC3",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRPC3",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC3",17,0)
 ;;
"RTN","MAGDRPC3",18,0)
 Q
"RTN","MAGDRPC3",19,0)
 ;
"RTN","MAGDRPC3",20,0)
RADLKUP(OUT,CASENUMB,STUDYDAT) ; RPC = MAG DICOM LOOKUP RAD STUDY
"RTN","MAGDRPC3",21,0)
 ; Radiology patient/study lookup
"RTN","MAGDRPC3",22,0)
 ; STUDYDAT is a vestigial input parameter, it is not used
"RTN","MAGDRPC3",23,0)
 N ACCNUM ;--- Accession Number
"RTN","MAGDRPC3",24,0)
 N CPTCODE ;-- CPT code for the procedure
"RTN","MAGDRPC3",25,0)
 N CPTNAME ;-- CPT name for the procedure
"RTN","MAGDRPC3",26,0)
 N DATETIME ;- Timestamp
"RTN","MAGDRPC3",27,0)
 N DIVISION ;- pointer to INSTITUTION file (#4)
"RTN","MAGDRPC3",28,0)
 N EXAMSTS ;-- Exam status (don't post images to CANCELLED exams)
"RTN","MAGDRPC3",29,0)
 N PROCDESC ;- Procedure description
"RTN","MAGDRPC3",30,0)
 N PROCIEN ;-- radiology procedure ien in ^RAMIS(71)
"RTN","MAGDRPC3",31,0)
 N RAA ;------ array for returned value
"RTN","MAGDRPC3",32,0)
 N RAIX ;----- cross reference subscript for case number lookup
"RTN","MAGDRPC3",33,0)
 N RADPT1 ;--- first level subscript in ^RADPT
"RTN","MAGDRPC3",34,0)
 N RADPT2 ;--- second level subscript in ^RADPT (after "DT")
"RTN","MAGDRPC3",35,0)
 N RADPT3 ;--- third level subscript in ^RADPT (after "P")
"RTN","MAGDRPC3",36,0)
 N D1,I,LIST,X,Z
"RTN","MAGDRPC3",37,0)
 ;
"RTN","MAGDRPC3",38,0)
 ; find the patient/study in ^RADPT using the Radiology Case Number
"RTN","MAGDRPC3",39,0)
 K OUT
"RTN","MAGDRPC3",40,0)
 ;
"RTN","MAGDRPC3",41,0)
 I $G(CASENUMB)="" S OUT(1)="-1,No Case Number Specified" Q
"RTN","MAGDRPC3",42,0)
 ;
"RTN","MAGDRPC3",43,0)
 S X=$$ACCFIND^RAAPI(CASENUMB,.RAA) ; IA 5020
"RTN","MAGDRPC3",44,0)
 ;
"RTN","MAGDRPC3",45,0)
 I X<0 S OUT(1)="-2,Error in Accession Number Lookup: <<"_X_">>" Q
"RTN","MAGDRPC3",46,0)
 ;
"RTN","MAGDRPC3",47,0)
 S RADPT1=$P(RAA(1),"^",1),RADPT2=$P(RAA(1),"^",2),RADPT3=$P(RAA(1),"^",3)
"RTN","MAGDRPC3",48,0)
 ;
"RTN","MAGDRPC3",49,0)
 I RADPT1="" S OUT(1)="-3,Null RADPT1 entry returned by $$ACCFIND^RAAPI" Q
"RTN","MAGDRPC3",50,0)
 I RADPT2="" S OUT(1)="-4,Null RADPT2 entry returned by $$ACCFIND^RAAPI" Q
"RTN","MAGDRPC3",51,0)
 I RADPT3="" S OUT(1)="-5,Null RADPT3 entry returned by $$ACCFIND^RAAPI" Q
"RTN","MAGDRPC3",52,0)
 ;
"RTN","MAGDRPC3",53,0)
 I '$D(^RADPT(RADPT1,0)) S OUT(1)="-6,No patient demographics file pointer" Q
"RTN","MAGDRPC3",54,0)
 ;
"RTN","MAGDRPC3",55,0)
 ; get patient demographics file pointer
"RTN","MAGDRPC3",56,0)
 S DFN=$P(^RADPT(RADPT1,0),"^",1)
"RTN","MAGDRPC3",57,0)
 ;
"RTN","MAGDRPC3",58,0)
 I '$D(^RADPT(RADPT1,"DT",RADPT2,0)) S OUT(1)="-7,No datetime level" Q
"RTN","MAGDRPC3",59,0)
 ;
"RTN","MAGDRPC3",60,0)
 ; get date and time of examination
"RTN","MAGDRPC3",61,0)
 S DATETIME=$P($G(^RADPT(RADPT1,"DT",RADPT2,0)),"^",1)
"RTN","MAGDRPC3",62,0)
 ; get case info
"RTN","MAGDRPC3",63,0)
 ;
"RTN","MAGDRPC3",64,0)
 I '$D(^RADPT(RADPT1,"DT",RADPT2,"P",RADPT3,0)) S OUT(1)="-8,No study level" Q
"RTN","MAGDRPC3",65,0)
 ;
"RTN","MAGDRPC3",66,0)
 S X=^RADPT(RADPT1,"DT",RADPT2,"P",RADPT3,0)
"RTN","MAGDRPC3",67,0)
 S Z=$P(X,"^",17) I Z S Z=$$ACCRPT^RAAPI(Z,.RAA) S ACCNUM=RAA(1)
"RTN","MAGDRPC3",68,0)
 S PROCIEN=$P(X,"^",2),EXAMSTS=$P(X,"^",3)
"RTN","MAGDRPC3",69,0)
 S:EXAMSTS EXAMSTS=$$GET1^DIQ(72,EXAMSTS,.01)
"RTN","MAGDRPC3",70,0)
 S (PROCDESC,CPTNAME,CPTCODE)=""
"RTN","MAGDRPC3",71,0)
 ;
"RTN","MAGDRPC3",72,0)
 ; need PROCIEN to do lookup in ^RAMIS
"RTN","MAGDRPC3",73,0)
 I 'PROCIEN S OUT(1)="-9,No procedure identifier" Q
"RTN","MAGDRPC3",74,0)
 ;
"RTN","MAGDRPC3",75,0)
 S Z=$G(^RAMIS(71,PROCIEN,0))
"RTN","MAGDRPC3",76,0)
 S PROCDESC=$P(Z,"^",1),CPTCODE=$P(Z,"^",9)
"RTN","MAGDRPC3",77,0)
 S CPTNAME=$P($$CPT^ICPTCOD(+CPTCODE),"^",3) ; IA 1995
"RTN","MAGDRPC3",78,0)
 S:CPTNAME="" CPTNAME=PROCDESC
"RTN","MAGDRPC3",79,0)
 S OUT(2)=$G(RADPT1)
"RTN","MAGDRPC3",80,0)
 S OUT(3)=$G(RADPT2)
"RTN","MAGDRPC3",81,0)
 S OUT(4)=$G(RADPT3)
"RTN","MAGDRPC3",82,0)
 S OUT(5)=$G(PROCIEN)
"RTN","MAGDRPC3",83,0)
 S OUT(6)=$G(CPTCODE)
"RTN","MAGDRPC3",84,0)
 S OUT(7)=$G(CPTNAME)
"RTN","MAGDRPC3",85,0)
 S OUT(8)=$G(Z)
"RTN","MAGDRPC3",86,0)
 S OUT(9)=$G(EXAMSTS)
"RTN","MAGDRPC3",87,0)
 S OUT(10)=$G(DFN)
"RTN","MAGDRPC3",88,0)
 S OUT(11)=$G(DATETIME)
"RTN","MAGDRPC3",89,0)
 S OUT(12)=$G(PROCDESC)
"RTN","MAGDRPC3",90,0)
 S X=""
"RTN","MAGDRPC3",91,0)
 I $G(PROCIEN) S D1=0 F  S D1=$O(^RAMIS(71,PROCIEN,"MDL",D1)) Q:'D1  D
"RTN","MAGDRPC3",92,0)
 . S Z=+$P($G(^RAMIS(71,PROCIEN,"MDL",D1,0)),"^",1) Q:'Z
"RTN","MAGDRPC3",93,0)
 . S Z=$P($G(^RAMIS(73.1,Z,0)),"^",1) Q:Z=""
"RTN","MAGDRPC3",94,0)
 . S:X'="" X=X_"," S X=X_Z
"RTN","MAGDRPC3",95,0)
 . Q
"RTN","MAGDRPC3",96,0)
 S OUT(13)=X ; List of Modality-codes
"RTN","MAGDRPC3",97,0)
 S X="" I $G(RADPT1),$G(RADPT2) S X=$G(^RADPT(RADPT1,"DT",RADPT2,0))
"RTN","MAGDRPC3",98,0)
 S DIVISION=$P(X,"^",3) ; pointer to INSTITUION file (#4) for division
"RTN","MAGDRPC3",99,0)
 S OUT(14)=$E($$GET1^DIQ(4,DIVISION,99),1,3) ; station number, exclusive of any modifiers
"RTN","MAGDRPC3",100,0)
 ; Patient's pregnancy status at the time of the exam
"RTN","MAGDRPC3",101,0)
 S X="" I $G(DFN),$G(RADPT2),$G(RADPT3) S X=$G(^RADPT(DFN,"DT",RADPT2,"P",RADPT3,0))
"RTN","MAGDRPC3",102,0)
 S OUT(15)=$P($G(^RAO(75.1,+$P(X,"^",11),0)),"^",13)
"RTN","MAGDRPC3",103,0)
 S OUT(16)=$G(ACCNUM)
"RTN","MAGDRPC3",104,0)
 S OUT(1)=1 ; OK
"RTN","MAGDRPC3",105,0)
 Q
"RTN","MAGDRPC3",106,0)
 ;
"RTN","MAGDRPC3",107,0)
QUEUE(OUT,IMAGE,APPNAM,LOCATION,ACCNUM,REASON,EMAIL,PRIOR,JBTOHD) ; RPC = MAG DICOM QUEUE IMAGE
"RTN","MAGDRPC3",108,0)
 ; Add the DICOM study send image request to the queue
"RTN","MAGDRPC3",109,0)
 N COUNT,D0,D1,DFN,LOG,OK,PROBLEM,TYPE,X
"RTN","MAGDRPC3",110,0)
 ;
"RTN","MAGDRPC3",111,0)
 I '$G(IMAGE) S OUT="-1,No Image specified" Q
"RTN","MAGDRPC3",112,0)
 I $G(APPNAM)="" S OUT="-2,No Destination specified" Q
"RTN","MAGDRPC3",113,0)
 I '$G(LOCATION) S OUT="-3,No Origin specified" Q
"RTN","MAGDRPC3",114,0)
 S PRIOR=+$G(PRIOR) S:'PRIOR PRIOR=500
"RTN","MAGDRPC3",115,0)
 S JBTOHD=$S($G(JBTOHD):1,1:0)
"RTN","MAGDRPC3",116,0)
 ;
"RTN","MAGDRPC3",117,0)
 S X=$G(^MAG(2005,IMAGE,0))
"RTN","MAGDRPC3",118,0)
 S TYPE=+$P(X,"^",6),DFN=$P(X,"^",7)
"RTN","MAGDRPC3",119,0)
 I " 0 11 3 100 "'[(" "_TYPE_" ") D  Q
"RTN","MAGDRPC3",120,0)
 . S OUT="-4,Cannot Queue Image Object Type """_TYPE_"""."
"RTN","MAGDRPC3",121,0)
 . Q
"RTN","MAGDRPC3",122,0)
 ;
"RTN","MAGDRPC3",123,0)
 L +^MAGDOUTP(2006.574,0):1E9 ; Background process MUST wait
"RTN","MAGDRPC3",124,0)
 S P=$P($G(^MAG(2005,IMAGE,0)),"^",10),P=$S(P:P,1:IMAGE)
"RTN","MAGDRPC3",125,0)
 S STUID=$P($G(^MAG(2005,P,"PACS")),"^",1) S:STUID="" STUID="?"
"RTN","MAGDRPC3",126,0)
 S OK=0,D0="" F  S D0=$O(^MAGDOUTP(2006.574,"STUDY",STUID,D0)) Q:'D0  D  Q:OK
"RTN","MAGDRPC3",127,0)
 . Q:'$D(^MAGDOUTP(2006.574,"STS",LOCATION,PRIOR,"WAITING",D0))
"RTN","MAGDRPC3",128,0)
 . Q:$P($G(^MAGDOUTP(2006.574,D0,0)),"^",1)'=APPNAM
"RTN","MAGDRPC3",129,0)
 . S OK=D0
"RTN","MAGDRPC3",130,0)
 . Q
"RTN","MAGDRPC3",131,0)
 S D0=OK D:'D0
"RTN","MAGDRPC3",132,0)
 . S X=$G(^MAGDOUTP(2006.574,0))
"RTN","MAGDRPC3",133,0)
 . S $P(X,"^",1,2)="DICOM IMAGE OUTPUT FILE^2006.574"
"RTN","MAGDRPC3",134,0)
 . S D0=$O(^MAGDOUTP(2006.574," "),-1)+1 ; Next number
"RTN","MAGDRPC3",135,0)
 . S $P(X,"^",3)=D0
"RTN","MAGDRPC3",136,0)
 . S $P(X,"^",4)=$P(X,"^",4)+1 ; Total count
"RTN","MAGDRPC3",137,0)
 . S ^MAGDOUTP(2006.574,0)=X
"RTN","MAGDRPC3",138,0)
 . ;
"RTN","MAGDRPC3",139,0)
 . S ^MAGDOUTP(2006.574,D0,0)=APPNAM_"^"_P_"^"_$G(ACCNUM)_"^"_LOCATION_"^"_PRIOR_"^"_JBTOHD
"RTN","MAGDRPC3",140,0)
 . S ^MAGDOUTP(2006.574,D0,2)=STUID
"RTN","MAGDRPC3",141,0)
 . S ^MAGDOUTP(2006.574,"STUDY",STUID,D0)=""
"RTN","MAGDRPC3",142,0)
 . Q
"RTN","MAGDRPC3",143,0)
 L -^MAGDOUTP(2006.574,0)
"RTN","MAGDRPC3",144,0)
 ;
"RTN","MAGDRPC3",145,0)
 S COUNT=0,PROBLEM=3
"RTN","MAGDRPC3",146,0)
 I (TYPE=3)!(TYPE=100) D  ; Single XRAY or DICOM image
"RTN","MAGDRPC3",147,0)
 . S COUNT=COUNT+$$ENQUEUE(IMAGE,D0,PRIOR)
"RTN","MAGDRPC3",148,0)
 . Q
"RTN","MAGDRPC3",149,0)
 I TYPE=11 D  ; Process all the images in an XRAY group
"RTN","MAGDRPC3",150,0)
 . S D1=0 F  S D1=$O(^MAG(2005,IMAGE,1,D1)) Q:'D1  D
"RTN","MAGDRPC3",151,0)
 . . S COUNT=COUNT+$$ENQUEUE($P($G(^MAG(2005,IMAGE,1,D1,0)),"^",1),D0,PRIOR)
"RTN","MAGDRPC3",152,0)
 . . Q
"RTN","MAGDRPC3",153,0)
 . Q
"RTN","MAGDRPC3",154,0)
 ;
"RTN","MAGDRPC3",155,0)
 S LOG="DICOM transmit to "_APPNAM_" for reason "_REASON
"RTN","MAGDRPC3",156,0)
 D:COUNT ENTRY^MAGLOG($C(REASON+64),DUZ,IMAGE,"DICOM Gateway",DFN,COUNT,LOG)
"RTN","MAGDRPC3",157,0)
 D:PROBLEM>3
"RTN","MAGDRPC3",158,0)
 . N XMERR,XMID,XMSUB,XMY,XMZ
"RTN","MAGDRPC3",159,0)
 . S PROBLEM(1)="Error while queueing image for Transmission:"
"RTN","MAGDRPC3",160,0)
 . S PROBLEM(2)=LOG
"RTN","MAGDRPC3",161,0)
 . S PROBLEM(3)=" "
"RTN","MAGDRPC3",162,0)
 . ; --- send MailMan message...
"RTN","MAGDRPC3",163,0)
 . S XMID=$G(DUZ) S:'XMID XMID=.5
"RTN","MAGDRPC3",164,0)
 . S XMY(XMID)=""
"RTN","MAGDRPC3",165,0)
 . S:$G(EMAIL)'="" XMY(EMAIL)=""
"RTN","MAGDRPC3",166,0)
 . S XMSUB=$E("Cannot transmit image(s) to "_APPNAM,1,63)
"RTN","MAGDRPC3",167,0)
 . D SENDMSG^XMXAPI(XMID,XMSUB,"PROBLEM",.XMY,,.XMZ,)
"RTN","MAGDRPC3",168,0)
 . Q:'$G(XMERR)
"RTN","MAGDRPC3",169,0)
 . M XMERR=^TMP("XMERR",$J) S $EC=",U13-Cannot send MailMan message,"
"RTN","MAGDRPC3",170,0)
 . Q
"RTN","MAGDRPC3",171,0)
 S OUT=1
"RTN","MAGDRPC3",172,0)
 Q
"RTN","MAGDRPC3",173,0)
 ;
"RTN","MAGDRPC3",174,0)
ENQUEUE(IMAGE,D0,PRIOR) ; Add an image to the DICOM send image request queue sub-file
"RTN","MAGDRPC3",175,0)
 Q:'IMAGE 0
"RTN","MAGDRPC3",176,0)
 N D1,I,OLD,X
"RTN","MAGDRPC3",177,0)
 D CHK^MAGGSQI(.X,IMAGE) I +$G(X(0))'=1 D  Q 0
"RTN","MAGDRPC3",178,0)
 . S PROBLEM=PROBLEM+1,PROBLEM(PROBLEM)=" "
"RTN","MAGDRPC3",179,0)
 . S PROBLEM=PROBLEM+1,PROBLEM(PROBLEM)="Image # "_IMAGE_":"
"RTN","MAGDRPC3",180,0)
 . S I="" F  S I=$O(X(I)) Q:I=""  S PROBLEM=PROBLEM+1,PROBLEM(PROBLEM)=X(I)
"RTN","MAGDRPC3",181,0)
 . Q
"RTN","MAGDRPC3",182,0)
 ;
"RTN","MAGDRPC3",183,0)
 ; Enter each image at most once in each transmission request
"RTN","MAGDRPC3",184,0)
 S (D1,OLD)=0 F  S D1=$O(^MAGDOUTP(2006.574,D0,1,D1)) Q:'D1  D  Q:OLD
"RTN","MAGDRPC3",185,0)
 . S:$P($G(^MAGDOUTP(2006.574,D0,1,D1,0)),"^",1)=IMAGE OLD=1
"RTN","MAGDRPC3",186,0)
 . Q
"RTN","MAGDRPC3",187,0)
 Q:OLD 1
"RTN","MAGDRPC3",188,0)
 ;
"RTN","MAGDRPC3",189,0)
 L +^MAGDOUTP(2006.574,D0,1,0):1E9 ; Background Process MUST wait
"RTN","MAGDRPC3",190,0)
 S X=$G(^MAGDOUTP(2006.574,D0,1,0))
"RTN","MAGDRPC3",191,0)
 S $P(X,"^",1,2)="^2006.5744"
"RTN","MAGDRPC3",192,0)
 S D1=$O(^MAGDOUTP(2006.574,D0,1," "),-1)+1,$P(X,"^",3)=D1
"RTN","MAGDRPC3",193,0)
 S $P(X,"^",4)=$P(X,"^",4)+1,OUT=$P(X,"^",4)
"RTN","MAGDRPC3",194,0)
 S ^MAGDOUTP(2006.574,D0,1,0)=X
"RTN","MAGDRPC3",195,0)
 S ^MAGDOUTP(2006.574,D0,1,D1,0)=IMAGE_"^WAITING^"_$H
"RTN","MAGDRPC3",196,0)
 S ^MAGDOUTP(2006.574,"STS",LOCATION,PRIOR,"WAITING",D0,D1)=""
"RTN","MAGDRPC3",197,0)
 L -^MAGDOUTP(2006.574,D0,1,0)
"RTN","MAGDRPC3",198,0)
 Q 1
"RTN","MAGDRPC3",199,0)
 ;
"RTN","MAGDRPC3",200,0)
FIND(DATE,CASE,NUM) ; ADC x-reference (Radiology patient file)
"RTN","MAGDRPC3",201,0)
 N X
"RTN","MAGDRPC3",202,0)
 Q:'$G(DATE) 0
"RTN","MAGDRPC3",203,0)
 S X=DATE S:$G(NUM) X=$$FMADD^XLFDT(DATE,NUM) Q:X<1 0
"RTN","MAGDRPC3",204,0)
 Q $O(^RADPT("ADC",$$MMDDYY(X)_"-"_CASE,""))
"RTN","MAGDRPC3",205,0)
 ;
"RTN","MAGDRPC3",206,0)
MMDDYY(DAY) ; YYYMMDD --> MMDDYY
"RTN","MAGDRPC3",207,0)
 I DAY'?7N Q 0
"RTN","MAGDRPC3",208,0)
 Q $E(DAY,4,7)_$E(DAY,2,3)
"RTN","MAGDRPC3",209,0)
 ;
"RTN","MAGDRPC4")
0^25^B61111180
"RTN","MAGDRPC4",1,0)
MAGDRPC4 ;WOIFO/EdM - Imaging RPCs ; 02 Apr 2008 1:44 PM
"RTN","MAGDRPC4",2,0)
 ;;3.0;IMAGING;**11,30,51,50,54,49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGDRPC4",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDRPC4",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC4",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRPC4",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRPC4",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRPC4",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRPC4",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRPC4",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRPC4",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRPC4",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRPC4",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRPC4",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRPC4",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRPC4",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC4",17,0)
 ;;
"RTN","MAGDRPC4",18,0)
 Q
"RTN","MAGDRPC4",19,0)
 ;
"RTN","MAGDRPC4",20,0)
LOOKUP(OUT,NUMBER) ; RPC = MAG DICOM LOOKUP STUDY
"RTN","MAGDRPC4",21,0)
 ; Look Up for both Radiology and Consults
"RTN","MAGDRPC4",22,0)
 N ACCNUM ;--- Accession Number
"RTN","MAGDRPC4",23,0)
 N CPTCODE ;-- CPT code for the procedure
"RTN","MAGDRPC4",24,0)
 N CPTNAME ;-- CPT name for the procedure
"RTN","MAGDRPC4",25,0)
 N DFN ;------ Patient pointer
"RTN","MAGDRPC4",26,0)
 N EXAMSTS ;-- Exam status (don't post images to CANCELLED exams)
"RTN","MAGDRPC4",27,0)
 N EXAMTYP ;-- Type of exam (Rad or Con)
"RTN","MAGDRPC4",28,0)
 N GMRCIEN ;-- Pointer for GMRC
"RTN","MAGDRPC4",29,0)
 N PROCDESC ;- Procedure description
"RTN","MAGDRPC4",30,0)
 N PROCIEN ;-- Radiology procedure IEN in ^RAMIS(71)
"RTN","MAGDRPC4",31,0)
 N RAA ;------ Radiology array (for $$ACCFIND)
"RTN","MAGDRPC4",32,0)
 N RAIX ;----- cross reference subscript for case number lookup
"RTN","MAGDRPC4",33,0)
 N RADFN ;---- first level subscript in ^RADPT
"RTN","MAGDRPC4",34,0)
 N RADTI ;---- second level subscript in ^RADPT (after "DT")
"RTN","MAGDRPC4",35,0)
 N RACNI ;---- third level subscript in ^RADPT (after "P")
"RTN","MAGDRPC4",36,0)
 N RARPT ;---- Radiology Report pointer
"RTN","MAGDRPC4",37,0)
 N I,LIST,NOUT,X,Y,Z
"RTN","MAGDRPC4",38,0)
 ;
"RTN","MAGDRPC4",39,0)
 K OUT S NOUT=1
"RTN","MAGDRPC4",40,0)
 I $G(NUMBER)="" S OUT(1)="-1,No Case or Consult Number Specified" Q
"RTN","MAGDRPC4",41,0)
 I $E(NUMBER,2)="`" D  Q
"RTN","MAGDRPC4",42,0)
 . ; lookup the image by the IEN
"RTN","MAGDRPC4",43,0)
 . D IENLOOK^MAGDRPC9
"RTN","MAGDRPC4",44,0)
 . Q
"RTN","MAGDRPC4",45,0)
 ;
"RTN","MAGDRPC4",46,0)
 S EXAMTYP=$E(NUMBER,1)
"RTN","MAGDRPC4",47,0)
 I "RC"[EXAMTYP S NUMBER=$E(NUMBER,2,$L(NUMBER))
"RTN","MAGDRPC4",48,0)
 E  S EXAMTYP=""
"RTN","MAGDRPC4",49,0)
 K DFN
"RTN","MAGDRPC4",50,0)
 D  ; First try Radiology candidates
"RTN","MAGDRPC4",51,0)
 . I EXAMTYP'="",EXAMTYP'="R" Q
"RTN","MAGDRPC4",52,0)
 . ; Look for the patient/study in ^RADPT using the Radiology Case Number
"RTN","MAGDRPC4",53,0)
 . S X=$$ACCFIND^RAAPI(NUMBER,.RAA)
"RTN","MAGDRPC4",54,0)
 . I X<0 Q
"RTN","MAGDRPC4",55,0)
 . S Y=RAA(1)
"RTN","MAGDRPC4",56,0)
 . S RADFN=$P(Y,"^",1),RADTI=$P(Y,"^",2),RACNI=$P(Y,"^",3)
"RTN","MAGDRPC4",57,0)
 . Q:'$D(^RADPT(RADFN,0))  ; No patient demographics file pointer
"RTN","MAGDRPC4",58,0)
 . S DFN=$P(^RADPT(RADFN,0),"^",1)
"RTN","MAGDRPC4",59,0)
 . Q:'$G(DFN)
"RTN","MAGDRPC4",60,0)
 . Q:'$D(^RADPT(DFN,"DT",RADTI,0))
"RTN","MAGDRPC4",61,0)
 . S ACCNUM=$$ACCNUM^RAAPI(RADFN,RADTI,RACNI)
"RTN","MAGDRPC4",62,0)
 . S RARPT=$P($G(^RADPT(DFN,"DT",RADTI,"P",RACNI,0)),"^",17) Q:'RARPT
"RTN","MAGDRPC4",63,0)
 . S I=0 F  S I=$O(^RARPT(RARPT,2005,I)) Q:'I  D
"RTN","MAGDRPC4",64,0)
 . . S X="74^"_RARPT_"^"_$P($G(^RARPT(RARPT,2005,I,0)),"^",1)_"^"_ACCNUM
"RTN","MAGDRPC4",65,0)
 . . S NOUT=NOUT+1,OUT(NOUT)=X
"RTN","MAGDRPC4",66,0)
 . . Q
"RTN","MAGDRPC4",67,0)
 . Q
"RTN","MAGDRPC4",68,0)
 ;
"RTN","MAGDRPC4",69,0)
 K DFN
"RTN","MAGDRPC4",70,0)
 D  ; Now look for any consults that might qualify
"RTN","MAGDRPC4",71,0)
 . N ACCNUM,MAGIEN,MAGPTR,REPORTF,REPORTI,TIUIEN,TIUPTR,TIUXIEN
"RTN","MAGDRPC4",72,0)
 . I EXAMTYP'="",EXAMTYP'="C" Q
"RTN","MAGDRPC4",73,0)
 . S ACCNUM="GMRC-"_$S(NUMBER?1"GMRC-"1.N:$P(NUMBER,"GMRC-",2),1:NUMBER)
"RTN","MAGDRPC4",74,0)
 . S GMRCIEN=$P(ACCNUM,"-",2)
"RTN","MAGDRPC4",75,0)
 . D
"RTN","MAGDRPC4",76,0)
 . . N D0,Z
"RTN","MAGDRPC4",77,0)
 . . S D0=$P(ACCNUM,"-",2)
"RTN","MAGDRPC4",78,0)
 . . S DFN=$$GET1^DIQ(123,D0,.02,"I") Q:'DFN
"RTN","MAGDRPC4",79,0)
 . . S EXAMSTS=$$GET1^DIQ(123,D0,8) ; check for cancelled exam
"RTN","MAGDRPC4",80,0)
 . . I EXAMSTS="CANCELLED" S OUT(1)="-4,Consult is cancelled" Q
"RTN","MAGDRPC4",81,0)
 . . S PROCDESC=$$GET1^DIQ(123,D0,1)
"RTN","MAGDRPC4",82,0)
 . . S Z=$$GET1^DIQ(123,D0,13,"I") ; request type
"RTN","MAGDRPC4",83,0)
 . . Q
"RTN","MAGDRPC4",84,0)
 . I '$G(DFN) S OUT(1)="-5,Consult/procedure not on file" Q
"RTN","MAGDRPC4",85,0)
 . ; Find the images - they can be linked to TIU or imaging file 2006.5839
"RTN","MAGDRPC4",86,0)
 . S MAGPTR=$O(^MAG(2006.5839,"C",123,GMRCIEN,0))
"RTN","MAGDRPC4",87,0)
 . I MAGPTR D  Q  ; Found it in ^MAG(2006.5839 - not in ^TIU yet
"RTN","MAGDRPC4",88,0)
 . . S X=^MAG(2006.5839,MAGPTR,0)
"RTN","MAGDRPC4",89,0)
 . . S X=$P(X,"^",1)_"^"_$P(X,"^",2)_"^"_$P(X,"^",3)_"^"_ACCNUM
"RTN","MAGDRPC4",90,0)
 . . S NOUT=NOUT+1,OUT(NOUT)=X
"RTN","MAGDRPC4",91,0)
 . . Q
"RTN","MAGDRPC4",92,0)
 . D  ; Otherwise find images in ^TIU
"RTN","MAGDRPC4",93,0)
 . . N I,X
"RTN","MAGDRPC4",94,0)
 . . D TIUALL^MAGDGMRC(GMRCIEN,.RESULT)
"RTN","MAGDRPC4",95,0)
 . . S I="" F  S I=$O(RESULT(I)) Q:I=""  D
"RTN","MAGDRPC4",96,0)
 . . . S X="8925^"_$P(RESULT(I),"^",1)_"^"_$P(RESULT(I),"^",3)_"^"_$P(RESULT(I),"^",2)
"RTN","MAGDRPC4",97,0)
 . . . S NOUT=NOUT+1,OUT(NOUT)=X
"RTN","MAGDRPC4",98,0)
 . . . Q
"RTN","MAGDRPC4",99,0)
 . . Q
"RTN","MAGDRPC4",100,0)
 . Q
"RTN","MAGDRPC4",101,0)
 S OUT(1)=NOUT-1
"RTN","MAGDRPC4",102,0)
 Q
"RTN","MAGDRPC4",103,0)
 ;
"RTN","MAGDRPC4",104,0)
NEXTIMG(OUT,FROMS,SENT,CHECK) ; RPC = MAG DICOM GET NEXT QUEUE ENTRY
"RTN","MAGDRPC4",105,0)
 ; Get next file to be DICOM transmitted
"RTN","MAGDRPC4",106,0)
 N H,F1,F2,F3,FROM,I,JBTOHD,LOC,N,PRI,S0,S1,STS,TYPE,X
"RTN","MAGDRPC4",107,0)
 S X=$G(FROMS) S:X FROM(X)=1
"RTN","MAGDRPC4",108,0)
 S I="" F  S I=$O(FROMS(I)) Q:I=""  S X=$G(FROMS(I)) S:X FROM(X)=1
"RTN","MAGDRPC4",109,0)
 I '$O(FROM("")) S OUT(1)="-1,No Origin Specified" Q
"RTN","MAGDRPC4",110,0)
 ; First clean up transmitted queue entries
"RTN","MAGDRPC4",111,0)
 S I="" F  S I=$O(SENT(I)) Q:I=""  D CLEAN^MAGDRPC9
"RTN","MAGDRPC4",112,0)
 S H=$$SECOND($H)
"RTN","MAGDRPC4",113,0)
 L +^MAGDOUTP(2006.574,"STS"):1E9 ; Background process MUST wait
"RTN","MAGDRPC4",114,0)
 I '$G(CHECK) D  ; do only when called from a transmission process
"RTN","MAGDRPC4",115,0)
 . S FROM="" F  S FROM=$O(FROM(FROM)) Q:FROM=""  D
"RTN","MAGDRPC4",116,0)
 . . S PRI="" F  S PRI=$O(^MAGDOUTP(2006.574,"STS",FROM,PRI)) Q:PRI=""  D
"RTN","MAGDRPC4",117,0)
 . . . S S0="" F  S S0=$O(^MAGDOUTP(2006.574,"STS",FROM,PRI,"XMIT",S0)) Q:S0=""  D
"RTN","MAGDRPC4",118,0)
 . . . . S S1="" F  S S1=$O(^MAGDOUTP(2006.574,"STS",FROM,PRI,"XMIT",S0,S1)) Q:S1=""  D
"RTN","MAGDRPC4",119,0)
 . . . . . S X=$$SECOND($P($G(^MAGDOUTP(2006.574,S0,1,S1,0),"^^"_$H),"^",3))
"RTN","MAGDRPC4",120,0)
 . . . . . Q:H-X<300
"RTN","MAGDRPC4",121,0)
 . . . . . S $P(^MAGDOUTP(2006.574,S0,1,S1,0),"^",2)="WAITING"
"RTN","MAGDRPC4",122,0)
 . . . . . K ^MAGDOUTP(2006.574,"STS",FROM,PRI,"XMIT",S0,S1)
"RTN","MAGDRPC4",123,0)
 . . . . . S ^MAGDOUTP(2006.574,"STS",FROM,PRI,"WAITING",S0,S1)=""
"RTN","MAGDRPC4",124,0)
 . . . . . Q
"RTN","MAGDRPC4",125,0)
 . . . . Q
"RTN","MAGDRPC4",126,0)
 . . . Q
"RTN","MAGDRPC4",127,0)
 . . Q
"RTN","MAGDRPC4",128,0)
 . Q
"RTN","MAGDRPC4",129,0)
 ; Find the highest priority among the selected FROM locations
"RTN","MAGDRPC4",130,0)
 S FROM="" F  S FROM=$O(FROM(FROM)) Q:FROM=""  D
"RTN","MAGDRPC4",131,0)
 . S PRI="" F  S PRI=$O(^MAGDOUTP(2006.574,"STS",FROM,PRI)) Q:PRI=""  D
"RTN","MAGDRPC4",132,0)
 . . S X=$O(^MAGDOUTP(2006.574,"STS",FROM,PRI,"WAITING","")) S:X PRI(PRI,FROM)=""
"RTN","MAGDRPC4",133,0)
 . . Q
"RTN","MAGDRPC4",134,0)
 . Q
"RTN","MAGDRPC4",135,0)
 S OUT(1)="",PRI=$O(PRI(""),-1) D:PRI'=""
"RTN","MAGDRPC4",136,0)
 . S FROM=$O(PRI(PRI,""))
"RTN","MAGDRPC4",137,0)
 . S S0="" F  S S0=$O(^MAGDOUTP(2006.574,"STS",FROM,PRI,"WAITING",S0)) Q:S0=""  D  Q:OUT(1)'=""
"RTN","MAGDRPC4",138,0)
 . . S S1="" F  S S1=$O(^MAGDOUTP(2006.574,"STS",FROM,PRI,"WAITING",S0,S1)) Q:S1=""  D  Q:OUT(1)'=""
"RTN","MAGDRPC4",139,0)
 . . . I '$G(CHECK) D  ; do only when called from a transmission process
"RTN","MAGDRPC4",140,0)
 . . . . S $P(^MAGDOUTP(2006.574,S0,1,S1,0),"^",2,3)="XMIT^"_$H
"RTN","MAGDRPC4",141,0)
 . . . . K ^MAGDOUTP(2006.574,"STS",FROM,PRI,"WAITING",S0,S1)
"RTN","MAGDRPC4",142,0)
 . . . . S ^MAGDOUTP(2006.574,"STS",FROM,PRI,"XMIT",S0,S1)=""
"RTN","MAGDRPC4",143,0)
 . . . . Q
"RTN","MAGDRPC4",144,0)
 . . . S OUT(1)=1
"RTN","MAGDRPC4",145,0)
 . . . S OUT(2)=S0
"RTN","MAGDRPC4",146,0)
 . . . S OUT(3)=S1
"RTN","MAGDRPC4",147,0)
 . . . S X=$G(^MAGDOUTP(2006.574,S0,0))
"RTN","MAGDRPC4",148,0)
 . . . S OUT(4)=$P(X,"^",1) ; Application
"RTN","MAGDRPC4",149,0)
 . . . S OUT(5)=$P(X,"^",2) ; Group
"RTN","MAGDRPC4",150,0)
 . . . S OUT(6)=$P(X,"^",3) ; Accession Number
"RTN","MAGDRPC4",151,0)
 . . . S JBTOHD=+$P(X,"^",6)
"RTN","MAGDRPC4",152,0)
 . . . S OUT(7)=+$G(^MAGDOUTP(2006.574,S0,1,S1,0)) ; Image
"RTN","MAGDRPC4",153,0)
 . . . S OUT(8)=$P($G(^MAG(2005,+OUT(7),0)),"^",6)
"RTN","MAGDRPC4",154,0)
 . . . S TYPE=$S($G(^MAG(2005,+OUT(7),"FBIG"))'="":"BIG",1:"FULL")
"RTN","MAGDRPC4",155,0)
 . . . ; 3rd parameter set to 1 to allow retrieval from jukebox
"RTN","MAGDRPC4",156,0)
 . . . D FILEFIND^MAGDFB(+OUT(7),TYPE,1,0,.F1,.F2)
"RTN","MAGDRPC4",157,0)
 . . . S OUT(9)=F1
"RTN","MAGDRPC4",158,0)
 . . . S OUT(10)=F2
"RTN","MAGDRPC4",159,0)
 . . . S OUT(11)=$P($G(^MAG(2005,+OUT(5),0)),"^",7) ; get DFN
"RTN","MAGDRPC4",160,0)
 . . . ; get path for *.TXT, always the same as the FULL file
"RTN","MAGDRPC4",161,0)
 . . . D FILEFIND^MAGDFB(+OUT(7),"FULL",JBTOHD,0,.F1,.F3)
"RTN","MAGDRPC4",162,0)
 . . . S OUT(12)=F3
"RTN","MAGDRPC4",163,0)
 . . . Q
"RTN","MAGDRPC4",164,0)
 . . Q
"RTN","MAGDRPC4",165,0)
 . Q
"RTN","MAGDRPC4",166,0)
 S:OUT(1)="" OUT(1)="-2,Nothing to be transmitted."
"RTN","MAGDRPC4",167,0)
 L -^MAGDOUTP(2006.574,"STS")
"RTN","MAGDRPC4",168,0)
 Q
"RTN","MAGDRPC4",169,0)
 ;
"RTN","MAGDRPC4",170,0)
FIND(DATE,CASE,NUM) ;
"RTN","MAGDRPC4",171,0)
 ; Use the ADC x-reference in the radiology patient file
"RTN","MAGDRPC4",172,0)
 N NDATE
"RTN","MAGDRPC4",173,0)
 S NDATE=$$FMADD^XLFDT(DATE,NUM) Q:NDATE<1 0
"RTN","MAGDRPC4",174,0)
 Q $O(^RADPT("ADC",$$MMDDYY(NDATE)_"-"_CASE,""))
"RTN","MAGDRPC4",175,0)
 ;
"RTN","MAGDRPC4",176,0)
MMDDYY(DAY) ; Convert Fileman date to mmddyy
"RTN","MAGDRPC4",177,0)
 I DAY'?7N Q 0
"RTN","MAGDRPC4",178,0)
 Q $E(DAY,4,7)_$E(DAY,2,3)
"RTN","MAGDRPC4",179,0)
 ;
"RTN","MAGDRPC4",180,0)
INIT(OUT,LOCATION) ; RPC = MAG DICOM QUEUE INIT
"RTN","MAGDRPC4",181,0)
 N D0,N,PRI,STS,STUID
"RTN","MAGDRPC4",182,0)
 I '$G(LOCATION) S OUT="-3,No origin specified." Q
"RTN","MAGDRPC4",183,0)
 I '$D(^MAGDOUTP(2006.574,0)) S OUT="-1,No entries at all in queue." Q
"RTN","MAGDRPC4",184,0)
 ;
"RTN","MAGDRPC4",185,0)
 S N=0
"RTN","MAGDRPC4",186,0)
 S PRI="" F  S PRI=$O(^MAGDOUTP(2006.574,"STS",LOCATION,PRI)) Q:PRI=""  D
"RTN","MAGDRPC4",187,0)
 . S STS="" F  S STS=$O(^MAGDOUTP(2006.574,"STS",LOCATION,PRI,STS)) Q:STS=""  D
"RTN","MAGDRPC4",188,0)
 . . S D0="" F  S D0=$O(^MAGDOUTP(2006.574,"STS",LOCATION,PRI,STS,D0)) Q:D0=""  D
"RTN","MAGDRPC4",189,0)
 . . . S STUID=$G(^MAGDOUTP(2006.574,D0,2))
"RTN","MAGDRPC4",190,0)
 . . . K ^MAGDOUTP(2006.574,D0)
"RTN","MAGDRPC4",191,0)
 . . . K:STUID'="" ^MAGDOUTP(2006.574,"STUDY",STUID,D0)
"RTN","MAGDRPC4",192,0)
 . . . K ^MAGDOUTP(2006.574,"STS",LOCATION,PRI,STS,D0)
"RTN","MAGDRPC4",193,0)
 . . . S N=N+1
"RTN","MAGDRPC4",194,0)
 . . . Q
"RTN","MAGDRPC4",195,0)
 . . Q
"RTN","MAGDRPC4",196,0)
 . Q
"RTN","MAGDRPC4",197,0)
 ;
"RTN","MAGDRPC4",198,0)
 I 'N S OUT="-2,No entries present for "_$$GET1^DIQ(4,LOCATION,.01)_"." Q
"RTN","MAGDRPC4",199,0)
 ;
"RTN","MAGDRPC4",200,0)
 S $P(^MAGDOUTP(2006.574,0),"^",4)=$P(^MAGDOUTP(2006.574,0),"^",4)-N
"RTN","MAGDRPC4",201,0)
 S OUT=N_" entr"_$S(N=1:"y",1:"ies")_" removed from Image Transmission Queue."
"RTN","MAGDRPC4",202,0)
 Q
"RTN","MAGDRPC4",203,0)
 ;
"RTN","MAGDRPC4",204,0)
SECOND(H) Q H*86400+$P(H,",",2)
"RTN","MAGDRPC4",205,0)
 ;
"RTN","MAGDRPC9")
0^26^B55355495
"RTN","MAGDRPC9",1,0)
MAGDRPC9 ;WOIFO/EdM - Imaging RPCs ; 11 Feb 2008 12:36 PM
"RTN","MAGDRPC9",2,0)
 ;;3.0;IMAGING;**50,54,53,49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGDRPC9",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDRPC9",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC9",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRPC9",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRPC9",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRPC9",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRPC9",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRPC9",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRPC9",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRPC9",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRPC9",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRPC9",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRPC9",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRPC9",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRPC9",17,0)
 ;;
"RTN","MAGDRPC9",18,0)
 Q
"RTN","MAGDRPC9",19,0)
 ;
"RTN","MAGDRPC9",20,0)
UIDROOT(OUT) ; RPC = MAG DICOM GET UID ROOT
"RTN","MAGDRPC9",21,0)
 S OUT=$G(^MAGD(2006.15,1,"UID ROOT"))
"RTN","MAGDRPC9",22,0)
 Q
"RTN","MAGDRPC9",23,0)
 ;
"RTN","MAGDRPC9",24,0)
NEWUID(OUT,OLD,NEW,IMAGE) ; RPC = MAG NEW SOP INSTANCE UID
"RTN","MAGDRPC9",25,0)
 N D0,L,X
"RTN","MAGDRPC9",26,0)
 S IMAGE=+$G(IMAGE),OLD=$G(OLD)
"RTN","MAGDRPC9",27,0)
 S:$G(NEW)="" NEW=OLD
"RTN","MAGDRPC9",28,0)
 S D0=0 S:OLD'="" D0=$O(^MAG(2005,"P",OLD,""))
"RTN","MAGDRPC9",29,0)
 I IMAGE,D0,IMAGE'=D0 S OUT="-1,UID cannot belong to multiple images ("_IMAGE_"/"_D0_")" Q
"RTN","MAGDRPC9",30,0)
 I IMAGE,'D0 S D0=IMAGE
"RTN","MAGDRPC9",31,0)
 I 'D0 S OUT="-2,Cannot find image with UID "_OLD Q
"RTN","MAGDRPC9",32,0)
 S OUT=$P($G(^MAG(2005,D0,"SOP")),"^",2) Q:OUT'=""
"RTN","MAGDRPC9",33,0)
 S L=$L(NEW,".")-1,X=$P(NEW,".",L+1),L=$P(NEW,".",1,L)_"."
"RTN","MAGDRPC9",34,0)
 L +^MAG(2005,"P"):1E9 ; Background process MUST wait
"RTN","MAGDRPC9",35,0)
 S OUT="" F  D  Q:OUT'=""
"RTN","MAGDRPC9",36,0)
 . S OUT=L_X
"RTN","MAGDRPC9",37,0)
 . I $L(OUT)>64 S OUT="-3,Cannot use "_NEW_" to create valid UID" Q
"RTN","MAGDRPC9",38,0)
 . I $D(^MAG(2005,"P",OUT)) S OUT="",X=X+1 Q
"RTN","MAGDRPC9",39,0)
 . S $P(^MAG(2005,D0,"SOP"),"^",2)=OUT
"RTN","MAGDRPC9",40,0)
 . S ^MAG(2005,"P",OUT,D0)=1
"RTN","MAGDRPC9",41,0)
 . Q
"RTN","MAGDRPC9",42,0)
 L -^MAG(2005,"P")
"RTN","MAGDRPC9",43,0)
 Q
"RTN","MAGDRPC9",44,0)
 ;
"RTN","MAGDRPC9",45,0)
QRNEWUID(IMAGE) ; Get updated UID for Query/Retrieve
"RTN","MAGDRPC9",46,0)
 N DATE,DH,FAIL,I,OLD,OUT,NEW,LASTUID,NEXTUID,TIME,X,Y
"RTN","MAGDRPC9",47,0)
 S IMAGE=+$G(IMAGE)
"RTN","MAGDRPC9",48,0)
 S NEW=$P($G(^MAG(2005,IMAGE,"SOP")),"^",2)
"RTN","MAGDRPC9",49,0)
 Q:NEW'="" NEW  ; There already is a new UID
"RTN","MAGDRPC9",50,0)
 ; Generate the next UID using date/time and counter
"RTN","MAGDRPC9",51,0)
 L +^MAGDICOM(2006.563,1,"MACHINE ID"):1E9 ; Background process must wait
"RTN","MAGDRPC9",52,0)
 S LASTUID=$G(^MAGDICOM(2006.563,1,"LAST UID"))
"RTN","MAGDRPC9",53,0)
 ; Can't use D NOW^XLFDT to set DH because it is incorrect at midnight
"RTN","MAGDRPC9",54,0)
 S DH=$H,X=$$HTFM^XLFDT(DH,1),DATE=X+17000000
"RTN","MAGDRPC9",55,0)
 S X=$P(DH,",",2) D
"RTN","MAGDRPC9",56,0)
 . N H,M,S
"RTN","MAGDRPC9",57,0)
 . S H=X\3600,M=X\60#60,S=X#60
"RTN","MAGDRPC9",58,0)
 . S TIME=H*100+M*100+S
"RTN","MAGDRPC9",59,0)
 . Q
"RTN","MAGDRPC9",60,0)
 S NEXTUID=$G(^MAGD(2006.15,1,"UID ROOT"))
"RTN","MAGDRPC9",61,0)
 I NEXTUID="" S $EC=",13:No UID Root defined - Run INIT^MAGDRUID," ; Fatal Error
"RTN","MAGDRPC9",62,0)
 ; UID type = 7, Machine ID = 0
"RTN","MAGDRPC9",63,0)
 S NEXTUID=NEXTUID_".1.7."_(+$G(DUZ(2)))_".0."_DATE_"."_TIME_".0"
"RTN","MAGDRPC9",64,0)
 ; Remove leading 0s from UID components
"RTN","MAGDRPC9",65,0)
 F I=1:1:$L(NEXTUID,".") S $P(NEXTUID,".",I)=+$P(NEXTUID,".",I)
"RTN","MAGDRPC9",66,0)
 I $P(NEXTUID,".",1,10)=$P(LASTUID,".",1,10) D
"RTN","MAGDRPC9",67,0)
 . S NEXTUID=LASTUID
"RTN","MAGDRPC9",68,0)
 . S $P(NEXTUID,".",11)=$P(NEXTUID,".",11)+1
"RTN","MAGDRPC9",69,0)
 . Q
"RTN","MAGDRPC9",70,0)
 S ^MAGDICOM(2006.563,1,"LAST UID")=NEXTUID
"RTN","MAGDRPC9",71,0)
 L -^MAGDICOM(2006.563,1,"MACHINE ID")
"RTN","MAGDRPC9",72,0)
 S OLD=$P($G(^MAG(2005,IMAGE,"PACS")),"^",1)
"RTN","MAGDRPC9",73,0)
 D NEWUID(.OUT,OLD,NEXTUID,IMAGE) ; Store the new UID with the image
"RTN","MAGDRPC9",74,0)
 Q OUT
"RTN","MAGDRPC9",75,0)
 ;
"RTN","MAGDRPC9",76,0)
NEXT(OUT,SEED,DIR) ; RPC = MAG RAD GET NEXT RPT BY DATE
"RTN","MAGDRPC9",77,0)
 N D2,DFN,EXAMDATE,NAME
"RTN","MAGDRPC9",78,0)
 ;
"RTN","MAGDRPC9",79,0)
 ; ^RADPT(DFN,"DT",D1,"P",D2,0) = Data, $P(17) = pointer to report
"RTN","MAGDRPC9",80,0)
 ; ^RADPT("AR",9999999.9999-D1,DFN,D1)="" ; IA # 65
"RTN","MAGDRPC9",81,0)
 ;
"RTN","MAGDRPC9",82,0)
 ; OUT = report_pointer ^ ExamDate ^ Patient ^ D2
"RTN","MAGDRPC9",83,0)
 ;
"RTN","MAGDRPC9",84,0)
 S SEED=$G(SEED),DIR=$S($G(DIR)<0:-1,1:1) ; default is ascending order
"RTN","MAGDRPC9",85,0)
 S EXAMDATE=$P(SEED,"^",1),DFN=$P(SEED,"^",2),D2=$P(SEED,"^",3)
"RTN","MAGDRPC9",86,0)
 S OUT=0 F  D  Q:OUT
"RTN","MAGDRPC9",87,0)
 . I EXAMDATE="" S EXAMDATE=$O(^RADPT("AR",""),DIR),DFN="" ; IA # 65
"RTN","MAGDRPC9",88,0)
 . I EXAMDATE="" S OUT=-1 Q
"RTN","MAGDRPC9",89,0)
 . I DFN="" S DFN=$O(^RADPT("AR",EXAMDATE,""),DIR) ; IA # 65
"RTN","MAGDRPC9",90,0)
 . I DFN="" S EXAMDATE=$O(^RADPT("AR",EXAMDATE),DIR),D2="" Q  ; IA # 65
"RTN","MAGDRPC9",91,0)
 . S:'D2 D2=$S(DIR>0:0,1:" ")
"RTN","MAGDRPC9",92,0)
 . S D2=$O(^RADPT(DFN,"DT",9999999.9999-EXAMDATE,"P",D2),DIR) ; IA # 1172
"RTN","MAGDRPC9",93,0)
 . I 'D2 D  Q
"RTN","MAGDRPC9",94,0)
 . . S DFN=$O(^RADPT("AR",EXAMDATE,DFN),DIR),D2="" ; IA # 65
"RTN","MAGDRPC9",95,0)
 . . I 'DFN D
"RTN","MAGDRPC9",96,0)
 . . . S EXAMDATE=$O(^RADPT("AR",EXAMDATE),DIR),DFN="" ; IA # 65
"RTN","MAGDRPC9",97,0)
 . . . I EXAMDATE="" S OUT=-1
"RTN","MAGDRPC9",98,0)
 . . . Q
"RTN","MAGDRPC9",99,0)
 . . Q
"RTN","MAGDRPC9",100,0)
 . S OUT=$P($G(^RADPT(DFN,"DT",9999999.9999-EXAMDATE,"P",D2,0)),"^",17) ; IA # 1172
"RTN","MAGDRPC9",101,0)
 . S:OUT OUT=OUT_"^"_EXAMDATE_"^"_DFN_"^"_D2
"RTN","MAGDRPC9",102,0)
 . Q
"RTN","MAGDRPC9",103,0)
 Q
"RTN","MAGDRPC9",104,0)
 ;
"RTN","MAGDRPC9",105,0)
NXTPTRPT(OUT,DFN,RARPT1,DIR) ; RPC = MAG RAD GET NEXT RPT BY PT
"RTN","MAGDRPC9",106,0)
 S DFN=$G(DFN)
"RTN","MAGDRPC9",107,0)
 I 'DFN S OUT="-1,Patient DFN not passed" Q
"RTN","MAGDRPC9",108,0)
 I '$D(^RARPT("C",DFN)) S OUT="-2,Patient does not have any radiology reports" Q  ; IA # 2442
"RTN","MAGDRPC9",109,0)
 S RARPT1=$G(RARPT1),DIR=$S($G(DIR)<0:-1,1:1) ; default is ascending order
"RTN","MAGDRPC9",110,0)
 S OUT=$O(^RARPT("C",DFN,RARPT1),DIR) ; IA # 2442
"RTN","MAGDRPC9",111,0)
 Q
"RTN","MAGDRPC9",112,0)
 ;
"RTN","MAGDRPC9",113,0)
GETICN(OUT,DFN) ; RPC = MAG DICOM GET ICN
"RTN","MAGDRPC9",114,0)
 S OUT=$$GETICN^MPIF001(DFN)
"RTN","MAGDRPC9",115,0)
 Q
"RTN","MAGDRPC9",116,0)
 ;
"RTN","MAGDRPC9",117,0)
CLEAN ; Overflow from MAGDRPC4
"RTN","MAGDRPC9",118,0)
 N STUID
"RTN","MAGDRPC9",119,0)
 S S0=$P(SENT(I),"^",1),S1=$P(SENT(I),"^",2)
"RTN","MAGDRPC9",120,0)
 Q:'$D(^MAGDOUTP(2006.574,S0,1,S1))
"RTN","MAGDRPC9",121,0)
 L +^MAGDOUTP(2006.574,S0,1,0):1E9 ; Background process MUST wait
"RTN","MAGDRPC9",122,0)
 S X=$G(^MAGDOUTP(2006.574,S0,0)),LOC=$P(X,"^",4),PRI=+$P(X,"^",5)
"RTN","MAGDRPC9",123,0)
 S STS=$P($G(^MAGDOUTP(2006.574,S0,1,S1,0)),"^",2)
"RTN","MAGDRPC9",124,0)
 K ^MAGDOUTP(2006.574,S0,1,S1)
"RTN","MAGDRPC9",125,0)
 I LOC'="",STS'="" K ^MAGDOUTP(2006.574,"STS",LOC,PRI,STS,S0,S1)
"RTN","MAGDRPC9",126,0)
 S X=$G(^MAGDOUTP(2006.574,S0,1,0))
"RTN","MAGDRPC9",127,0)
 S $P(X,"^",4)=$P(X,"^",4)-1
"RTN","MAGDRPC9",128,0)
 S ^MAGDOUTP(2006.574,S0,1,0)=X
"RTN","MAGDRPC9",129,0)
 L -^MAGDOUTP(2006.574,S0,1,0)
"RTN","MAGDRPC9",130,0)
 Q:$O(^MAGDOUTP(2006.574,S0,1,0))
"RTN","MAGDRPC9",131,0)
 L +^MAGDOUTP(2006.574,0):1E9 ; Background process MUST wait
"RTN","MAGDRPC9",132,0)
 S STUID=$G(^MAGDOUTP(2006.574,S0,2))
"RTN","MAGDRPC9",133,0)
 K ^MAGDOUTP(2006.574,S0)
"RTN","MAGDRPC9",134,0)
 K:STUID'="" ^MAGDOUTP(2006.574,"STUDY",STUID)
"RTN","MAGDRPC9",135,0)
 S X=$G(^MAGDOUTP(2006.574,0))
"RTN","MAGDRPC9",136,0)
 S $P(X,"^",4)=$P(X,"^",4)-1
"RTN","MAGDRPC9",137,0)
 S ^MAGDOUTP(2006.574,0)=X
"RTN","MAGDRPC9",138,0)
 L -^MAGDOUTP(2006.574,0)
"RTN","MAGDRPC9",139,0)
 Q
"RTN","MAGDRPC9",140,0)
 ;
"RTN","MAGDRPC9",141,0)
IENLOOK ; Overflow from MAGDRPC4
"RTN","MAGDRPC9",142,0)
 ; lookup image by the IEN
"RTN","MAGDRPC9",143,0)
 N ACNUMB,D0,DFN,GROUPIEN,MODIFIER,P,PROCNAME,STUDYDAT,X,Y
"RTN","MAGDRPC9",144,0)
 S NUMBER=+$P(NUMBER,"`",2)
"RTN","MAGDRPC9",145,0)
 ; patient safety checks
"RTN","MAGDRPC9",146,0)
 D CHK^MAGGSQI(.X,NUMBER) I +$G(X(0))'=1 D  Q
"RTN","MAGDRPC9",147,0)
 . S OUT(1)="-9,"_$P(X(0),"^",2,999)
"RTN","MAGDRPC9",148,0)
 . Q
"RTN","MAGDRPC9",149,0)
 S GROUPIEN=$P($G(^MAG(2005,NUMBER,0)),"^",10)
"RTN","MAGDRPC9",150,0)
 I GROUPIEN D CHK^MAGGSQI(.X,GROUPIEN) I +$G(X(0))'=1 D  Q
"RTN","MAGDRPC9",151,0)
 . S OUT(1)="-10,Group #"_GROUPIEN_": "_$P(X(0),"^",2,999)
"RTN","MAGDRPC9",152,0)
 . Q
"RTN","MAGDRPC9",153,0)
 ;
"RTN","MAGDRPC9",154,0)
 S X=$G(^MAG(2005,NUMBER,2)),P=$P(X,"^",6),D0=$P(X,"^",7)
"RTN","MAGDRPC9",155,0)
 I 'P!'D0 D  ; get parent from group
"RTN","MAGDRPC9",156,0)
 . S:GROUPIEN X=$G(^MAG(2005,GROUPIEN,2)),P=$P(X,"^",6),D0=$P(X,"^",7)
"RTN","MAGDRPC9",157,0)
 . Q
"RTN","MAGDRPC9",158,0)
 ;
"RTN","MAGDRPC9",159,0)
 S OUT(2)=P_"^"_D0_"^"_NUMBER_"^" ; result w/o Accession Number
"RTN","MAGDRPC9",160,0)
 I 'P!'D0 S OUT(1)="-6,Warning - Parent file entry is not present - no Accession Number."
"RTN","MAGDRPC9",161,0)
 E  I P=74 D
"RTN","MAGDRPC9",162,0)
 . N DATETIME,I,INFO,PROC,RADPT0,RADPT1,RADPT2,RADPT3,RARPT0
"RTN","MAGDRPC9",163,0)
 . S X=$$ACCRPT^RAAPI(D0,.INFO)
"RTN","MAGDRPC9",164,0)
 . I X<0 S OUT(1)="-11,Radiology Problem: "_X Q
"RTN","MAGDRPC9",165,0)
 . S ACNUMB=INFO(1)
"RTN","MAGDRPC9",166,0)
 . S RARPT0=$G(^RARPT(D0,0)) ; IA # 1171
"RTN","MAGDRPC9",167,0)
 . S RADPT1=$P(RARPT0,"^",2),DATETIME=$P(RARPT0,"^",3)
"RTN","MAGDRPC9",168,0)
 . S RADPT2=9999999.9999-DATETIME,RADPT3=1
"RTN","MAGDRPC9",169,0)
 . S RADPT0=$G(^RADPT(RADPT1,"DT",RADPT2,"P",RADPT3,0))
"RTN","MAGDRPC9",170,0)
 . S PROCNAME=$$GET1^DIQ(71,$P(RADPT0,"^",2),.01)
"RTN","MAGDRPC9",171,0)
 . S STUDYDAT=17000000+(DATETIME\1)
"RTN","MAGDRPC9",172,0)
 . S MODIFIER=""
"RTN","MAGDRPC9",173,0)
 . S I=0 F  S I=$O(^RADPT(RADPT1,"DT",RADPT2,"P",RADPT3,"M",I)) Q:'I  D
"RTN","MAGDRPC9",174,0)
 . . S X=^RADPT(RADPT1,"DT",RADPT2,"P",RADPT3,"M",I,0)
"RTN","MAGDRPC9",175,0)
 . . S:I>1 MODIFIER=MODIFIER_", " S MODIFIER=MODIFIER_$$GET1^DIQ(71.2,X,.01)
"RTN","MAGDRPC9",176,0)
 . . Q
"RTN","MAGDRPC9",177,0)
 . S X=P_"^"_D0_"^"_NUMBER_"^"_ACNUMB_"^"_STUDYDAT_"^"_PROCNAME_"^"_MODIFIER
"RTN","MAGDRPC9",178,0)
 . S OUT(1)=1,OUT(2)=X
"RTN","MAGDRPC9",179,0)
 . Q
"RTN","MAGDRPC9",180,0)
 E  I P=8925 D
"RTN","MAGDRPC9",181,0)
 . N GMRCIEN
"RTN","MAGDRPC9",182,0)
 . ; get pointer from TIU to consult request
"RTN","MAGDRPC9",183,0)
 . S X=$$GET1^DIQ(8925,D0,1405,"I") ; IA ???
"RTN","MAGDRPC9",184,0)
 . I $P(X,";",2)="GMR(123," D
"RTN","MAGDRPC9",185,0)
 . . S GMRCIEN=$P(X,";"),ACNUMB="GMRC-"_GMRCIEN
"RTN","MAGDRPC9",186,0)
 . . S STUDYDAT=17000000+($$GET1^DIQ(123,GMRCIEN,.01,"I")\1)
"RTN","MAGDRPC9",187,0)
 . . S PROCNAME=$$GET1^DIQ(123,GMRCIEN,1) ; TO SERVICE
"RTN","MAGDRPC9",188,0)
 . . S MODIFIER=$$GET1^DIQ(123,GMRCIEN,4) ; PROCEDURE
"RTN","MAGDRPC9",189,0)
 . . S X=P_"^"_D0_"^"_NUMBER_"^"_ACNUMB_"^"_STUDYDAT_"^"_PROCNAME_"^"_MODIFIER
"RTN","MAGDRPC9",190,0)
 . . S OUT(1)=1,OUT(2)=X
"RTN","MAGDRPC9",191,0)
 . . Q
"RTN","MAGDRPC9",192,0)
 . E  S OUT(1)="-8,Problem with parent file "_P_", internal entry number "_D0_" - no Accession Number."
"RTN","MAGDRPC9",193,0)
 . Q
"RTN","MAGDRPC9",194,0)
 E  S OUT(1)="-7,Parent file "_P_" not yet supported - no Accession Number."
"RTN","MAGDRPC9",195,0)
 Q
"RTN","MAGDRUID")
0^27^B4273247
"RTN","MAGDRUID",1,0)
MAGDRUID ;WOIFO/PMK - Program to read a DICOM file ; 02/04/2004  08:04
"RTN","MAGDRUID",2,0)
 ;;3.0;IMAGING;**54,49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGDRUID",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGDRUID",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRUID",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGDRUID",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGDRUID",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGDRUID",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGDRUID",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGDRUID",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGDRUID",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGDRUID",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGDRUID",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGDRUID",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGDRUID",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGDRUID",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGDRUID",17,0)
 ;;
"RTN","MAGDRUID",18,0)
 ; Attention!
"RTN","MAGDRUID",19,0)
 ; ----------
"RTN","MAGDRUID",20,0)
 ; This routine is solely for the use of the VA and is not to be
"RTN","MAGDRUID",21,0)
 ; included in a FOIA Act distribution.
"RTN","MAGDRUID",22,0)
 ; 
"RTN","MAGDRUID",23,0)
 ;
"RTN","MAGDRUID",24,0)
INIT ; run this to initialize the VA's UID root
"RTN","MAGDRUID",25,0)
 ; This sets the UID ROOT for the U.S. Department of Veterans Affairs.
"RTN","MAGDRUID",26,0)
 ; Other organizations using this code (IHS, FOIA, etc.) may not use
"RTN","MAGDRUID",27,0)
 ; this UID ROOT but need to obtain one for themselves.  See the DICOM
"RTN","MAGDRUID",28,0)
 ; standard (www.nema.org/dicom) PS 3.8 Annex A for instructions on how
"RTN","MAGDRUID",29,0)
 ; to do this.
"RTN","MAGDRUID",30,0)
 ;
"RTN","MAGDRUID",31,0)
 K ^MAGD(2006.15)
"RTN","MAGDRUID",32,0)
 S ^MAGD(2006.15,0)="DICOM UID ROOT^2006.15^1^1"
"RTN","MAGDRUID",33,0)
 S ^MAGD(2006.15,1,0)="<Your Agency Name goes Here>"
"RTN","MAGDRUID",34,0)
 S ^MAGD(2006.15,1,"UID ROOT")="<Your Agency UID Root goes Here>"
"RTN","MAGDRUID",35,0)
 S ^MAGD(2006.15,"B","<Your Agency Name goes Here>",1)=""
"RTN","MAGDRUID",36,0)
 Q
"RTN","MAGENV49")
0^28^B6706010
"RTN","MAGENV49",1,0)
MAGENV49 ;WOIFO/MLH - Environment check routine to abort if Rad Patch 47 not installed ; 08/17/2010 13:21
"RTN","MAGENV49",2,0)
 ;;3.0;IMAGING;**49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGENV49",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGENV49",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGENV49",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGENV49",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGENV49",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGENV49",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGENV49",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGENV49",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGENV49",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGENV49",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGENV49",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGENV49",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGENV49",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGENV49",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGENV49",17,0)
 ;;
"RTN","MAGENV49",18,0)
ENV ; environment check - don't let them install if the new Radiology
"RTN","MAGENV49",19,0)
 ; event drivers are not available (because they haven't installed
"RTN","MAGENV49",20,0)
 ; Radiology Patch 47)
"RTN","MAGENV49",21,0)
 ; Abort ONLY during installation, not during load
"RTN","MAGENV49",22,0)
 ; 
"RTN","MAGENV49",23,0)
 ; Expects:  XPDENV   Kernel variable set 0 if this is load phase
"RTN","MAGENV49",24,0)
 ;                                        1 if this is install phase
"RTN","MAGENV49",25,0)
 ;
"RTN","MAGENV49",26,0)
 N OK,P101,ROU,X
"RTN","MAGENV49",27,0)
 K XPDABORT ; -- variable checked by Kernel, aborts install if defined
"RTN","MAGENV49",28,0)
 ;
"RTN","MAGENV49",29,0)
 D  Q:$D(XPDABORT)  ; are new event drivers available (i.e., Rad Patch 47 installed)?
"RTN","MAGENV49",30,0)
 . S OK=1
"RTN","MAGENV49",31,0)
 . S:'$D(^ORD(101,"B","RA CANCEL 2.4")) OK=0
"RTN","MAGENV49",32,0)
 . S:'$D(^ORD(101,"B","RA EXAMINED 2.4")) OK=0
"RTN","MAGENV49",33,0)
 . S:'$D(^ORD(101,"B","RA REG 2.4")) OK=0
"RTN","MAGENV49",34,0)
 . Q:OK  ; yes, proceed
"RTN","MAGENV49",35,0)
 . ;
"RTN","MAGENV49",36,0)
 . ;  no, abort the installation (but not the load)
"RTN","MAGENV49",37,0)
 . W !,"**********   A T T E N T I O N   **********"
"RTN","MAGENV49",38,0)
 . W !,"You must install Radiology V5 Patch 47 before"
"RTN","MAGENV49",39,0)
 . W !,"installing Imaging V3 Patch 49."
"RTN","MAGENV49",40,0)
 . ;
"RTN","MAGENV49",41,0)
 . I $G(XPDENV)=1 D  Q  ; abort during Install Package(s)
"RTN","MAGENV49",42,0)
 . . W !!,"Aborting...",! S XPDABORT=2 ; don't kill transport global
"RTN","MAGENV49",43,0)
 . . Q
"RTN","MAGENV49",44,0)
 . ;
"RTN","MAGENV49",45,0)
 . ; don't abort during Load a Distribution
"RTN","MAGENV49",46,0)
 . W !!,"Continuing...",!
"RTN","MAGENV49",47,0)
 . Q
"RTN","MAGENV49",48,0)
 Q
"RTN","MAGENV49",49,0)
 ;
"RTN","MAGIPS49")
0^^B10146824
"RTN","MAGIPS49",1,0)
MAGIPS49 ;Post init routine to queue site activity at install. ; 10/21/2010 15:11
"RTN","MAGIPS49",2,0)
 ;;3.0;IMAGING;**49**;Mar 19, 2002;Build 2033;Apr 07, 2011
"RTN","MAGIPS49",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGIPS49",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGIPS49",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGIPS49",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGIPS49",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGIPS49",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGIPS49",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGIPS49",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGIPS49",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGIPS49",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGIPS49",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGIPS49",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGIPS49",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGIPS49",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGIPS49",17,0)
 ;;
"RTN","MAGIPS49",18,0)
 Q
"RTN","MAGIPS49",19,0)
 ;
"RTN","MAGIPS49",20,0)
PRE ;
"RTN","MAGIPS49",21,0)
 Q
"RTN","MAGIPS49",22,0)
 ;
"RTN","MAGIPS49",23,0)
POST ;
"RTN","MAGIPS49",24,0)
 ; create and send the site installation message
"RTN","MAGIPS49",25,0)
 D REMTASK^MAGQE4
"RTN","MAGIPS49",26,0)
 D STTASK^MAGQE4
"RTN","MAGIPS49",27,0)
 ;
"RTN","MAGIPS49",28,0)
 D  ;  Confirmation message
"RTN","MAGIPS49",29,0)
 . ;
"RTN","MAGIPS49",30,0)
 . NEW %,CT,CNT,D,D0,D1,D2,DDATE,DG,DIC,DICR,DIW,MAGMSG,ST,X,XMID,XMSUB,XMY,XMZ,Y
"RTN","MAGIPS49",31,0)
 . ;
"RTN","MAGIPS49",32,0)
 . D GETENV^%ZOSV
"RTN","MAGIPS49",33,0)
 . S CNT=0
"RTN","MAGIPS49",34,0)
 . S CNT=CNT+1,MAGMSG(CNT)="PACKAGE INSTALL"
"RTN","MAGIPS49",35,0)
 . S CNT=CNT+1,MAGMSG(CNT)="SITE: "_$$KSP^XUPARAM("WHERE")
"RTN","MAGIPS49",36,0)
 . S CNT=CNT+1,MAGMSG(CNT)="PACKAGE: "_XPDNM
"RTN","MAGIPS49",37,0)
 . S CNT=CNT+1,MAGMSG(CNT)="Version: "_$$VER^XPDUTL(XPDNM)
"RTN","MAGIPS49",38,0)
 . S ST=$$GET1^DIQ(9.7,XPDA,11,"I")
"RTN","MAGIPS49",39,0)
 . S CNT=CNT+1,MAGMSG(CNT)="Start time: "_$$FMTE^XLFDT(ST)
"RTN","MAGIPS49",40,0)
 . S CT=$$GET1^DIQ(9.7,XPDA,17,"I") S:+CT'=CT CT=$$NOW^XLFDT()
"RTN","MAGIPS49",41,0)
 . S CNT=CNT+1,MAGMSG(CNT)="Completion time: "_$$FMTE^XLFDT(CT)
"RTN","MAGIPS49",42,0)
 . S CNT=CNT+1,MAGMSG(CNT)="Run time: "_$$FMDIFF^XLFDT(CT,ST,3)
"RTN","MAGIPS49",43,0)
 . S CNT=CNT+1,MAGMSG(CNT)="Environment: "_Y
"RTN","MAGIPS49",44,0)
 . S CNT=CNT+1,MAGMSG(CNT)="FILE COMMENT: "_$$GET1^DIQ(9.7,XPDA,6,"I")
"RTN","MAGIPS49",45,0)
 . S CNT=CNT+1,MAGMSG(CNT)="DATE: "_$$NOW^XLFDT()
"RTN","MAGIPS49",46,0)
 . S CNT=CNT+1,MAGMSG(CNT)="Installed by: "_$$GET1^DIQ(9.7,XPDA,9,"E")
"RTN","MAGIPS49",47,0)
 . S CNT=CNT+1,MAGMSG(CNT)="Install Name: "_$$GET1^DIQ(9.7,XPDA,.01,"E")
"RTN","MAGIPS49",48,0)
 . S DDATE=$$GET1^DIQ(9.7,XPDA,51,"I")
"RTN","MAGIPS49",49,0)
 . S CNT=CNT+1,MAGMSG(CNT)="Distribution Date: "_$$FMTE^XLFDT(DDATE)
"RTN","MAGIPS49",50,0)
 . S:$G(CVT)'="" CNT=CNT+1,MAGMSG(CNT)="Conversion time: "_CVT
"RTN","MAGIPS49",51,0)
 . S XMSUB=XPDNM_" INSTALLATION"
"RTN","MAGIPS49",52,0)
 . S XMID=$G(DUZ) S:'XMID XMID=.5
"RTN","MAGIPS49",53,0)
 . S XMY(XMID)=""
"RTN","MAGIPS49",54,0)
 . S XMY("G.MAG SERVER")=""
"RTN","MAGIPS49",55,0)
 . S:$G(MAGDUZ) XMY(MAGDUZ)=""
"RTN","MAGIPS49",56,0)
 . S XMSUB=$E(XMSUB,1,63)
"RTN","MAGIPS49",57,0)
 . D SENDMSG^XMXAPI(XMID,XMSUB,"MAGMSG",.XMY,,.XMZ,)
"RTN","MAGIPS49",58,0)
 . I $G(XMERR) M XMERR=^TMP("XMERR",$J) S $EC=",U13-Cannot send MailMan message,"
"RTN","MAGIPS49",59,0)
 . Q
"RTN","MAGIPS49",60,0)
 ;
"RTN","MAGIPS49",61,0)
 Q
"SEC","^DIC",2006.15,2006.15,0,"AUDIT")
@
"SEC","^DIC",2006.15,2006.15,0,"DD")
@
"SEC","^DIC",2006.15,2006.15,0,"DEL")
@
"SEC","^DIC",2006.15,2006.15,0,"LAYGO")
@
"SEC","^DIC",2006.15,2006.15,0,"RD")
@
"SEC","^DIC",2006.15,2006.15,0,"WR")
@
"SEC","^DIC",2006.55,2006.55,0,"AUDIT")
@
"SEC","^DIC",2006.55,2006.55,0,"DD")
@
"SEC","^DIC",2006.55,2006.55,0,"DEL")
@
"SEC","^DIC",2006.55,2006.55,0,"LAYGO")
@
"SEC","^DIC",2006.55,2006.55,0,"RD")
@
"SEC","^DIC",2006.55,2006.55,0,"WR")
@
"SEC","^DIC",2006.56,2006.56,0,"AUDIT")
@
"SEC","^DIC",2006.56,2006.56,0,"DD")
@
"SEC","^DIC",2006.56,2006.56,0,"DEL")
@
"SEC","^DIC",2006.56,2006.56,0,"LAYGO")
@
"SEC","^DIC",2006.56,2006.56,0,"RD")
@
"SEC","^DIC",2006.56,2006.56,0,"WR")
@
"SEC","^DIC",2006.563,2006.563,0,"AUDIT")
@
"SEC","^DIC",2006.563,2006.563,0,"DD")
@
"SEC","^DIC",2006.563,2006.563,0,"DEL")
@
"SEC","^DIC",2006.563,2006.563,0,"LAYGO")
@
"SEC","^DIC",2006.563,2006.563,0,"RD")
@
"SEC","^DIC",2006.563,2006.563,0,"WR")
@
"VER")
8.0^22.0
"^DD",2006.1,2006.1,3.01,0)
IHE PACS HL7 INTERFACE ACTIVE^S^Y:YES;N:NO;^IHE;1^Q
"^DD",2006.1,2006.1,3.01,3)
Enter 'Y' to activate IHE-based HL7 messaging, or 'N' to retain legacy (HL7 V2.1) messaging.
"^DD",2006.1,2006.1,3.01,21,0)
^.001^3^3^3100209^^
"^DD",2006.1,2006.1,3.01,21,1,0)
This field contains a flag that indicates whether HL7 ADT messages should 
"^DD",2006.1,2006.1,3.01,21,2,0)
be sent using the IHE-based interface developed in Imaging Patch 
"^DD",2006.1,2006.1,3.01,21,3,0)
MAG*3.0*49.
"^DD",2006.1,2006.1,3.01,"DT")
3060120
"^DD",2006.15,2006.15,0)
FIELD^^1^2
"^DD",2006.15,2006.15,0,"DT")
3040204
"^DD",2006.15,2006.15,0,"IX","B",2006.15,.01)

"^DD",2006.15,2006.15,0,"NM","DICOM UID ROOT")

"^DD",2006.15,2006.15,.01,0)
OWNER^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",2006.15,2006.15,.01,1,0)
^.1
"^DD",2006.15,2006.15,.01,1,1,0)
2006.15^B
"^DD",2006.15,2006.15,.01,1,1,1)
S ^MAGD(2006.15,"B",$E(X,1,30),DA)=""
"^DD",2006.15,2006.15,.01,1,1,2)
K ^MAGD(2006.15,"B",$E(X,1,30),DA)
"^DD",2006.15,2006.15,.01,3)
Enter the name of the owner of this UID root code (3-30 chars).
"^DD",2006.15,2006.15,.01,21,0)
^.001^2^2^3100212^^
"^DD",2006.15,2006.15,.01,21,1,0)
The value of this field is a string that identifies the organization
"^DD",2006.15,2006.15,.01,21,2,0)
to which the UID root code that is stored in this record is assigned.
"^DD",2006.15,2006.15,.01,"DT")
3040204
"^DD",2006.15,2006.15,1,0)
UID ROOT^RF^^UID ROOT;1^K:$L(X)>90!($L(X)<1) X
"^DD",2006.15,2006.15,1,3)
Enter this organization's UID root code as obtained from ISO (1-90 chars).
"^DD",2006.15,2006.15,1,21,0)
^.001^15^15^3100212^^
"^DD",2006.15,2006.15,1,21,1,0)
The value of this field is a string that represents this organization's
"^DD",2006.15,2006.15,1,21,2,0)
UID root code.
"^DD",2006.15,2006.15,1,21,3,0)
 
"^DD",2006.15,2006.15,1,21,4,0)
Values for this code must be obtained from the International Standards
"^DD",2006.15,2006.15,1,21,5,0)
Organization (ISO) or from their national representative bodies (for the
"^DD",2006.15,2006.15,1,21,6,0)
USA, this is ANSI).
"^DD",2006.15,2006.15,1,21,7,0)
 
"^DD",2006.15,2006.15,1,21,8,0)
The format of an UID root code looks like a list of integer numbers,
"^DD",2006.15,2006.15,1,21,9,0)
separated by periods.
"^DD",2006.15,2006.15,1,21,10,0)
 
"^DD",2006.15,2006.15,1,21,11,0)
For VA hospitals, the value for this field will be automatically entered.
"^DD",2006.15,2006.15,1,21,12,0)
 
"^DD",2006.15,2006.15,1,21,13,0)
Other organizations first need to obtain their "root code" from the
"^DD",2006.15,2006.15,1,21,14,0)
appropriate standards organization, and then manually enter the assigned
"^DD",2006.15,2006.15,1,21,15,0)
value into this field.
"^DD",2006.15,2006.15,1,"DT")
3040204
"^DD",2006.55,2006.55,0)
FIELD^^2^2
"^DD",2006.55,2006.55,0,"DDA")
N
"^DD",2006.55,2006.55,0,"DT")
3100727
"^DD",2006.55,2006.55,0,"IX","C",2006.552,2)

"^DD",2006.55,2006.55,0,"IX","D",2006.552,3)

"^DD",2006.55,2006.55,0,"IX","E",2006.552,7)

"^DD",2006.55,2006.55,0,"NM","DICOM WORKLIST PATIENT")

"^DD",2006.55,2006.55,0,"VRPK")
MAG
"^DD",2006.55,2006.55,.01,0)
DIVISION^RP4'XI^DIC(4,^0;1^S DINUM=X
"^DD",2006.55,2006.55,.01,1,0)
^.1^^0
"^DD",2006.55,2006.55,.01,3)
Enter the name of the division.
"^DD",2006.55,2006.55,.01,21,0)
^^3^3^2990202^^^
"^DD",2006.55,2006.55,.01,21,1,0)
The value of this field is a pointer into the INSTITUTION file (#4).
"^DD",2006.55,2006.55,.01,21,2,0)
The pointed to location is the division where a study for a patient
"^DD",2006.55,2006.55,.01,21,3,0)
is scheduled to be performed.
"^DD",2006.55,2006.55,.01,"DT")
2990203
"^DD",2006.55,2006.55,2,0)
PATIENT^2006.552PA^^1;0
"^DD",2006.55,2006.552,0)
PATIENT SUB-FIELD^^15^16
"^DD",2006.55,2006.552,0,"DT")
3100727
"^DD",2006.55,2006.552,0,"IX","B",2006.552,.01)

"^DD",2006.55,2006.552,0,"IX","C",2006.552,2)

"^DD",2006.55,2006.552,0,"IX","D",2006.552,3)

"^DD",2006.55,2006.552,0,"IX","E",2006.552,7)

"^DD",2006.55,2006.552,0,"NM","PATIENT")

"^DD",2006.55,2006.552,0,"UP")
2006.55
"^DD",2006.55,2006.552,.001,0)
PATIENT-NUMBER^P2'^DPT(^ ^Q
"^DD",2006.55,2006.552,.001,3)
Enter the name of the patient.
"^DD",2006.55,2006.552,.001,21,0)
^^2^2^3000218^^
"^DD",2006.55,2006.552,.001,21,1,0)
The value of this field is the internal entry number of the patient
"^DD",2006.55,2006.552,.001,21,2,0)
for whom the study is scheduled in the VistA Database.
"^DD",2006.55,2006.552,.001,"DT")
3000218
"^DD",2006.55,2006.552,.01,0)
SITE^RP4'^DIC(4,^0;1^Q
"^DD",2006.55,2006.552,.01,1,0)
^.1^^0
"^DD",2006.55,2006.552,.01,1,1,0)
2006.552^B
"^DD",2006.55,2006.552,.01,1,1,1)
S ^MAGDWLST(2006.55,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",2006.55,2006.552,.01,1,1,2)
K ^MAGDWLST(2006.55,DA(1),1,"B",$E(X,1,30),DA)
"^DD",2006.55,2006.552,.01,3)
Enter the name of the site where this study is to be performed.
"^DD",2006.55,2006.552,.01,21,0)
^^3^3^2990202^^^
"^DD",2006.55,2006.552,.01,21,1,0)
The value of this field is a pointer into the INSTITUTION file (#4).
"^DD",2006.55,2006.552,.01,21,2,0)
The pointed to location is the division where a study for a patient
"^DD",2006.55,2006.552,.01,21,3,0)
is scheduled to be performed.
"^DD",2006.55,2006.552,.01,"DT")
3000218
"^DD",2006.55,2006.552,2,0)
PATIENT NAME^RF^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",2006.55,2006.552,2,1,0)
^.1
"^DD",2006.55,2006.552,2,1,1,0)
2006.552^C
"^DD",2006.55,2006.552,2,1,1,1)
S ^MAGDWLST(2006.55,DA(1),1,"C",$E(X,1,30),DA)=""
"^DD",2006.55,2006.552,2,1,1,2)
K ^MAGDWLST(2006.55,DA(1),1,"C",$E(X,1,30),DA)
"^DD",2006.55,2006.552,2,1,1,"%D",0)
^^2^2^3001204^
"^DD",2006.55,2006.552,2,1,1,"%D",1,0)
This cross reference keeps track of which patients (name) are
"^DD",2006.55,2006.552,2,1,1,"%D",2,0)
seen at which location.
"^DD",2006.55,2006.552,2,1,1,"DT")
3001204
"^DD",2006.55,2006.552,2,3)
Enter the name of the patient.
"^DD",2006.55,2006.552,2,21,0)
^^7^7^3000218^^
"^DD",2006.55,2006.552,2,21,1,0)
The value of this field is the name of the patient
"^DD",2006.55,2006.552,2,21,2,0)
for whom the study is scheduled.
"^DD",2006.55,2006.552,2,21,3,0)
 
"^DD",2006.55,2006.552,2,21,4,0)
This value if copied from the VistA Database, so that
"^DD",2006.55,2006.552,2,21,5,0)
worklist queries can also be performed when the network
"^DD",2006.55,2006.552,2,21,6,0)
connection (RPC) with the main Hospital Information System
"^DD",2006.55,2006.552,2,21,7,0)
is not available.
"^DD",2006.55,2006.552,2,"DT")
3001204
"^DD",2006.55,2006.552,3,0)
PID^RF^^0;3^K:$L(X)>20!($L(X)<1) X
"^DD",2006.55,2006.552,3,1,0)
^.1
"^DD",2006.55,2006.552,3,1,1,0)
2006.552^D
"^DD",2006.55,2006.552,3,1,1,1)
S ^MAGDWLST(2006.55,DA(1),1,"D",$E(X,1,30),DA)=""
"^DD",2006.55,2006.552,3,1,1,2)
K ^MAGDWLST(2006.55,DA(1),1,"D",$E(X,1,30),DA)
"^DD",2006.55,2006.552,3,1,1,"%D",0)
^^2^2^3001204^
"^DD",2006.55,2006.552,3,1,1,"%D",1,0)
This cross reference keeps track of which patients (ID) are
"^DD",2006.55,2006.552,3,1,1,"%D",2,0)
seen at which location.
"^DD",2006.55,2006.552,3,1,1,"DT")
3001204
"^DD",2006.55,2006.552,3,3)
Enter the Patient ID
"^DD",2006.55,2006.552,3,21,0)
^^11^11^3001006^^
"^DD",2006.55,2006.552,3,21,1,0)
The value of this field is the value that is transmitted
"^DD",2006.55,2006.552,3,21,2,0)
for DICOM element 0010,0020.
"^DD",2006.55,2006.552,3,21,3,0)
Typically, the value of this field is equal to
"^DD",2006.55,2006.552,3,21,4,0)
the Social Security Number of the patient
"^DD",2006.55,2006.552,3,21,5,0)
for whom the study is scheduled.
"^DD",2006.55,2006.552,3,21,6,0)
(Without the dashes between the number-groups.)
"^DD",2006.55,2006.552,3,21,7,0)
 
"^DD",2006.55,2006.552,3,21,8,0)
This value is copied from the VistA Database, so that
"^DD",2006.55,2006.552,3,21,9,0)
worklist queries can also be performed when the network
"^DD",2006.55,2006.552,3,21,10,0)
connection (RPC) with the main Hospital Information System
"^DD",2006.55,2006.552,3,21,11,0)
is not available.
"^DD",2006.55,2006.552,3,"DT")
3001204
"^DD",2006.55,2006.552,4,0)
SSN^RF^^0;4^K:$L(X)>11!($L(X)<1) X
"^DD",2006.55,2006.552,4,3)
Enter the patient's SSN
"^DD",2006.55,2006.552,4,21,0)
^^8^8^3000218^^
"^DD",2006.55,2006.552,4,21,1,0)
The value of this field is the Social Security Number of the patient
"^DD",2006.55,2006.552,4,21,2,0)
for whom the study is scheduled.
"^DD",2006.55,2006.552,4,21,3,0)
(With the dashes between the number-groups.)
"^DD",2006.55,2006.552,4,21,4,0)
 
"^DD",2006.55,2006.552,4,21,5,0)
This value if copied from the VistA Database, so that
"^DD",2006.55,2006.552,4,21,6,0)
worklist queries can also be performed when the network
"^DD",2006.55,2006.552,4,21,7,0)
connection (RPC) with the main Hospital Information System
"^DD",2006.55,2006.552,4,21,8,0)
is not available.
"^DD",2006.55,2006.552,4,"DT")
2990311
"^DD",2006.55,2006.552,5,0)
DOB^RD^^0;5^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",2006.55,2006.552,5,3)
Enter the patient's date of birth.
"^DD",2006.55,2006.552,5,21,0)
^^7^7^3000218^^
"^DD",2006.55,2006.552,5,21,1,0)
The value of this field is the date of birth of the patient
"^DD",2006.55,2006.552,5,21,2,0)
for whom the study is scheduled.
"^DD",2006.55,2006.552,5,21,3,0)
 
"^DD",2006.55,2006.552,5,21,4,0)
This value if copied from the VistA Database, so that
"^DD",2006.55,2006.552,5,21,5,0)
worklist queries can also be performed when the network
"^DD",2006.55,2006.552,5,21,6,0)
connection (RPC) with the main Hospital Information System
"^DD",2006.55,2006.552,5,21,7,0)
is not available.
"^DD",2006.55,2006.552,5,"DT")
2990311
"^DD",2006.55,2006.552,6,0)
GENDER^S^M:Male;F:Female;U:Unknown;^0;6^Q
"^DD",2006.55,2006.552,6,3)
Enter the patient's gender.
"^DD",2006.55,2006.552,6,21,0)
^^7^7^3000218^^
"^DD",2006.55,2006.552,6,21,1,0)
The value of this field is the gender of the patient
"^DD",2006.55,2006.552,6,21,2,0)
for whom the study is scheduled.
"^DD",2006.55,2006.552,6,21,3,0)
 
"^DD",2006.55,2006.552,6,21,4,0)
This value if copied from the VistA Database, so that
"^DD",2006.55,2006.552,6,21,5,0)
worklist queries can also be performed when the network
"^DD",2006.55,2006.552,6,21,6,0)
connection (RPC) with the main Hospital Information System
"^DD",2006.55,2006.552,6,21,7,0)
is not available.
"^DD",2006.55,2006.552,6,"DT")
2990311
"^DD",2006.55,2006.552,7,0)
SHORT ID^F^^0;7^K:$L(X)>30!($L(X)<1) X
"^DD",2006.55,2006.552,7,1,0)
^.1
"^DD",2006.55,2006.552,7,1,1,0)
2006.552^E
"^DD",2006.55,2006.552,7,1,1,1)
S ^MAGDWLST(2006.55,DA(1),1,"E",$E(X,1,30),DA)=""
"^DD",2006.55,2006.552,7,1,1,2)
K ^MAGDWLST(2006.55,DA(1),1,"E",$E(X,1,30),DA)
"^DD",2006.55,2006.552,7,1,1,"%D",0)
^^2^2^3001204^
"^DD",2006.55,2006.552,7,1,1,"%D",1,0)
This cross reference keeps track of which patients (short ID)
"^DD",2006.55,2006.552,7,1,1,"%D",2,0)
are seen at which location.
"^DD",2006.55,2006.552,7,1,1,"DT")
3001204
"^DD",2006.55,2006.552,7,3)
Enter any other IDs for this patient.
"^DD",2006.55,2006.552,7,21,0)
^^13^13^3001006^^
"^DD",2006.55,2006.552,7,21,1,0)
The value of this field is the value that is transmitted
"^DD",2006.55,2006.552,7,21,2,0)
for DICOM element 0010,1000.
"^DD",2006.55,2006.552,7,21,3,0)
Typically, the value of this field is equal to
"^DD",2006.55,2006.552,7,21,4,0)
the first letter of the last name of the patient, followed by
"^DD",2006.55,2006.552,7,21,5,0)
the last four digits of the Social Security Number of the patient
"^DD",2006.55,2006.552,7,21,6,0)
for whom the study is scheduled.
"^DD",2006.55,2006.552,7,21,7,0)

"^DD",2006.55,2006.552,7,21,8,0)
Sometimes, this data element is also referred to as the "Quick ID".
"^DD",2006.55,2006.552,7,21,9,0)
 
"^DD",2006.55,2006.552,7,21,10,0)
This value is copied from the VistA Database, so that
"^DD",2006.55,2006.552,7,21,11,0)
worklist queries can also be performed when the network
"^DD",2006.55,2006.552,7,21,12,0)
connection (RPC) with the main Hospital Information System
"^DD",2006.55,2006.552,7,21,13,0)
is not available.
"^DD",2006.55,2006.552,7,"DT")
3001204
"^DD",2006.55,2006.552,8,0)
RACE^F^^0;8^K:$L(X)>20!($L(X)<1) X
"^DD",2006.55,2006.552,8,3)
Enter the patient's race.
"^DD",2006.55,2006.552,8,21,0)
^^7^7^3001024^^
"^DD",2006.55,2006.552,8,21,1,0)
The value of this field is the race of the patient
"^DD",2006.55,2006.552,8,21,2,0)
for whom the study is scheduled.
"^DD",2006.55,2006.552,8,21,3,0)
 
"^DD",2006.55,2006.552,8,21,4,0)
This value if copied from the VistA Database, so that
"^DD",2006.55,2006.552,8,21,5,0)
worklist queries can also be performed when the network
"^DD",2006.55,2006.552,8,21,6,0)
connection (RPC) with the main Hospital Information System
"^DD",2006.55,2006.552,8,21,7,0)
is not available.
"^DD",2006.55,2006.552,8,"DT")
2990311
"^DD",2006.55,2006.552,9,0)
PREGNANCY STATUS^S^1:Not pregnant;2:Possibly pregnant;3:Definitely pregnant;4:Unknown;^0;9^Q
"^DD",2006.55,2006.552,9,3)
Indicate whether or not the patient is pregnant.
"^DD",2006.55,2006.552,9,21,0)
^^7^7^3001024^^
"^DD",2006.55,2006.552,9,21,1,0)
The value of this field is the pregnancy status of the patient
"^DD",2006.55,2006.552,9,21,2,0)
for whom the study is scheduled.
"^DD",2006.55,2006.552,9,21,3,0)
 
"^DD",2006.55,2006.552,9,21,4,0)
This value if copied from the VistA Database, so that
"^DD",2006.55,2006.552,9,21,5,0)
worklist queries can also be performed when the network
"^DD",2006.55,2006.552,9,21,6,0)
connection (RPC) with the main Hospital Information System
"^DD",2006.55,2006.552,9,21,7,0)
is not available.
"^DD",2006.55,2006.552,9,"DT")
3001011
"^DD",2006.55,2006.552,10,0)
CURRENT PATIENT LOCATION^F^^0;10^K:$L(X)>20!($L(X)<1) X
"^DD",2006.55,2006.552,10,3)
Indicate where the patient currently is located.
"^DD",2006.55,2006.552,10,21,0)
^^7^7^3001024^^
"^DD",2006.55,2006.552,10,21,1,0)
The value of this field is the location of the patient
"^DD",2006.55,2006.552,10,21,2,0)
for whom the study is scheduled.
"^DD",2006.55,2006.552,10,21,3,0)
 
"^DD",2006.55,2006.552,10,21,4,0)
This value if copied from the VistA Database, so that
"^DD",2006.55,2006.552,10,21,5,0)
worklist queries can also be performed when the network
"^DD",2006.55,2006.552,10,21,6,0)
connection (RPC) with the main Hospital Information System
"^DD",2006.55,2006.552,10,21,7,0)
is not available.
"^DD",2006.55,2006.552,10,"DT")
3001011
"^DD",2006.55,2006.552,11,0)
PATIENT ADDRESS^F^^0;11^K:$L(X)>30!($L(X)<1) X
"^DD",2006.55,2006.552,11,3)
Enter the Patient's address, 1-30 characters.
"^DD",2006.55,2006.552,11,21,0)
^^1^1^3020605^
"^DD",2006.55,2006.552,11,21,1,0)
This field stores the patient address.
"^DD",2006.55,2006.552,11,"DT")
3020401
"^DD",2006.55,2006.552,12,0)
INTEGRATION CONTROL NUMBER^F^^0;12^K:$L(X)>30!($L(X)<1) X
"^DD",2006.55,2006.552,12,3)
Enter the Integration Control Number for this patient.
"^DD",2006.55,2006.552,12,21,0)
^.001^8^8^3020605^^^
"^DD",2006.55,2006.552,12,21,1,0)
The value of this field is an Integration Control Number.
"^DD",2006.55,2006.552,12,21,2,0)
 
"^DD",2006.55,2006.552,12,21,3,0)
The format and possible values for this field are determined by the
"^DD",2006.55,2006.552,12,21,4,0)
software that maintains the Master Patient Index.
"^DD",2006.55,2006.552,12,21,5,0)
 
"^DD",2006.55,2006.552,12,21,6,0)
Values for this field are obtained by calling $$GETICN^MPIF001(dfn) (only
"^DD",2006.55,2006.552,12,21,7,0)
the first piece of the return value is retained (ICNVICN), not the
"^DD",2006.55,2006.552,12,21,8,0)
checksum).
"^DD",2006.55,2006.552,12,"DT")
3020605
"^DD",2006.55,2006.552,13,0)
TAG^2006.553^^2;0
"^DD",2006.55,2006.552,13,21,0)
^.001^2^2^3100212^^^^
"^DD",2006.55,2006.552,13,21,1,0)
This multiple contains the DICOM tag-value pairs that record the patient 
"^DD",2006.55,2006.552,13,21,2,0)
and study information that will be returned in a Modality Worklist query.
"^DD",2006.55,2006.552,14,0)
MEDICAL ALERT^2006.5522^^1;0
"^DD",2006.55,2006.552,14,21,0)
^^1^1^3100212^
"^DD",2006.55,2006.552,14,21,1,0)
This multiple contains lines of text that describe a medical alert.
"^DD",2006.55,2006.552,15,0)
SITE-DFN^F^^0;13^K:$L(X)>20!($L(X)<5)!'(X?3N.N1"-"1N.N) X
"^DD",2006.55,2006.552,15,.1)
STATION NUMBER - DFN
"^DD",2006.55,2006.552,15,3)
Answer must be 5-20 characters in length.
"^DD",2006.55,2006.552,15,21,0)
^^1^1^3100820^
"^DD",2006.55,2006.552,15,21,1,0)
This is the 3-digit Station Number concatenated with the DFN, separated by a dash.
"^DD",2006.55,2006.552,15,"DT")
3100727
"^DD",2006.55,2006.5522,0)
MEDICAL ALERT SUB-FIELD^^.01^1
"^DD",2006.55,2006.5522,0,"DT")
3061006
"^DD",2006.55,2006.5522,0,"IX","B",2006.5522,.01)

"^DD",2006.55,2006.5522,0,"NM","MEDICAL ALERT")

"^DD",2006.55,2006.5522,0,"UP")
2006.552
"^DD",2006.55,2006.5522,.01,0)
MEDICAL ALERT^MF^^0;1^K:$L(X)>240!($L(X)<1) X
"^DD",2006.55,2006.5522,.01,1,0)
^.1
"^DD",2006.55,2006.5522,.01,1,1,0)
2006.5522^B
"^DD",2006.55,2006.5522,.01,1,1,1)
S ^MAGDWLST(2006.55,DA(2),1,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",2006.55,2006.5522,.01,1,1,2)
K ^MAGDWLST(2006.55,DA(2),1,DA(1),1,"B",$E(X,1,30),DA)
"^DD",2006.55,2006.5522,.01,3)
Enter text that describes the medical alert (1-240 char).
"^DD",2006.55,2006.5522,.01,21,0)
^^2^2^3100212^
"^DD",2006.55,2006.5522,.01,21,1,0)
The value of this field is a line of free text that describes a medical
"^DD",2006.55,2006.5522,.01,21,2,0)
alert.
"^DD",2006.55,2006.5522,.01,"DT")
3061006
"^DD",2006.55,2006.553,0)
TAG SUB-FIELD^^3^3
"^DD",2006.55,2006.553,0,"DT")
3061006
"^DD",2006.55,2006.553,0,"IX","B",2006.553,.01)

"^DD",2006.55,2006.553,0,"NM","TAG")

"^DD",2006.55,2006.553,0,"UP")
2006.552
"^DD",2006.55,2006.553,.01,0)
TAG^MF^^0;1^K:$L(X)>30!($L(X)<1) X
"^DD",2006.55,2006.553,.01,1,0)
^.1
"^DD",2006.55,2006.553,.01,1,1,0)
2006.553^B
"^DD",2006.55,2006.553,.01,1,1,1)
S ^MAGDWLST(2006.55,DA(2),1,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",2006.55,2006.553,.01,1,1,2)
K ^MAGDWLST(2006.55,DA(2),1,DA(1),1,"B",$E(X,1,30),DA)
"^DD",2006.55,2006.553,.01,3)
Enter the code for the tag (1-30 char).
"^DD",2006.55,2006.553,.01,21,0)
^.001^3^3^3100212^^
"^DD",2006.55,2006.553,.01,21,1,0)
The value of this field is a string.  This string corresponds to the tag
"^DD",2006.55,2006.553,.01,21,2,0)
in the DICOM standard.  Each tag corresponds to a data item, e.g.,
"^DD",2006.55,2006.553,.01,21,3,0)
0010,0010 identifies the patient's name.
"^DD",2006.55,2006.553,.01,"DT")
3061006
"^DD",2006.55,2006.553,2,0)
VALUE^F^^0;2^K:$L(X)>200!($L(X)<1) X
"^DD",2006.55,2006.553,2,3)
Enter the value for this tag (1-200 chars).
"^DD",2006.55,2006.553,2,21,0)
^^5^5^3100212^
"^DD",2006.55,2006.553,2,21,1,0)
The value of this field is a string.  This string is the value that is
"^DD",2006.55,2006.553,2,21,2,0)
associated with the tag that is stored in the .01 field of this multiple.
"^DD",2006.55,2006.553,2,21,3,0)
 
"^DD",2006.55,2006.553,2,21,4,0)
E.g., for the DICOM tag "0010,0010" (patient's name), the value could be
"^DD",2006.55,2006.553,2,21,5,0)
"DOE,JOHN Q".
"^DD",2006.55,2006.553,2,"DT")
3061006
"^DD",2006.55,2006.553,3,0)
TEXT^2006.5533^^1;0
"^DD",2006.55,2006.553,3,21,0)
^^4^4^3100212^
"^DD",2006.55,2006.553,3,21,1,0)
This multiple contains text that will populate a DICOM element whose value
"^DD",2006.55,2006.553,3,21,2,0)
representation allows it to contain one to many lines of text.  The 
"^DD",2006.55,2006.553,3,21,3,0)
meaning of this text is determined by the value of the .01 field in this 
"^DD",2006.55,2006.553,3,21,4,0)
multiple.
"^DD",2006.55,2006.5533,0)
TEXT SUB-FIELD^^.01^1
"^DD",2006.55,2006.5533,0,"DT")
3061006
"^DD",2006.55,2006.5533,0,"NM","TEXT")

"^DD",2006.55,2006.5533,0,"UP")
2006.553
"^DD",2006.55,2006.5533,.01,0)
TEXT^MF^^0;1^K:$L(X)>240!($L(X)<1) X
"^DD",2006.55,2006.5533,.01,1,0)
^.1^^0
"^DD",2006.55,2006.5533,.01,3)
Enter a line of text (1-240 chars).
"^DD",2006.55,2006.5533,.01,21,0)
^^1^1^3100212^
"^DD",2006.55,2006.5533,.01,21,1,0)
The value of this field is a single line of text.
"^DD",2006.55,2006.5533,.01,"DT")
3061006
"^DD",2006.56,2006.56,0)
FIELD^^2^2
"^DD",2006.56,2006.56,0,"DDA")
N
"^DD",2006.56,2006.56,0,"DT")
3101207
"^DD",2006.56,2006.56,0,"IX","AC",2006.562,3)

"^DD",2006.56,2006.56,0,"IX","AD",2006.562,4)

"^DD",2006.56,2006.56,0,"IX","AF",2006.562,5)

"^DD",2006.56,2006.56,0,"IX","C",2006.562,.01)

"^DD",2006.56,2006.56,0,"IX","D",2006.562,.01)

"^DD",2006.56,2006.56,0,"IX","E",2006.562,.01)

"^DD",2006.56,2006.56,0,"IX","F",2006.562,11)

"^DD",2006.56,2006.56,0,"IX","S",2006.562,2)

"^DD",2006.56,2006.56,0,"NM","DICOM WORKLIST STUDY")

"^DD",2006.56,2006.56,0,"VRPK")
MAG
"^DD",2006.56,2006.56,.01,0)
DIVISION^RP4'XI^DIC(4,^0;1^S DINUM=X
"^DD",2006.56,2006.56,.01,1,0)
^.1^^0
"^DD",2006.56,2006.56,.01,3)
Enter the name of the division.
"^DD",2006.56,2006.56,.01,21,0)
^.001^3^3^3090721^^^^
"^DD",2006.56,2006.56,.01,21,1,0)
The value of this field is a pointer into the INSTITUTION file (#4).
"^DD",2006.56,2006.56,.01,21,2,0)
The pointed to location is the division where a study for a patient
"^DD",2006.56,2006.56,.01,21,3,0)
is scheduled to be performed.
"^DD",2006.56,2006.56,.01,"DT")
2990203
"^DD",2006.56,2006.56,2,0)
STUDY^2006.562A^^1;0
"^DD",2006.56,2006.56,2,21,0)
^.001^1^1^3101207^^^^
"^DD",2006.56,2006.56,2,21,1,0)
This subfile holds the studies for the current division.
"^DD",2006.56,2006.56,2,"DT")
2990615
"^DD",2006.56,2006.562,0)
STUDY SUB-FIELD^^26^25
"^DD",2006.56,2006.562,0,"DT")
3101207
"^DD",2006.56,2006.562,0,"IX","S",2006.562,2)

"^DD",2006.56,2006.562,0,"NM","STUDY")

"^DD",2006.56,2006.562,0,"UP")
2006.56
"^DD",2006.56,2006.562,.01,0)
SERVICE^RF^^0;1^K:$L(X)>10!($L(X)<1) X
"^DD",2006.56,2006.562,.01,1,0)
^.1^^0
"^DD",2006.56,2006.562,.01,1,1,0)
2006.56^C^MUMPS
"^DD",2006.56,2006.562,.01,1,1,1)
N ACC S ACC=$P($G(^MAGDWLST(2006.56,DA(1),1,DA,0)),"^",3) S:ACC'="" ^MAGDWLST(2006.56,"C",DA(1),X,ACC,DA)=""
"^DD",2006.56,2006.562,.01,1,1,2)
N ACC S ACC=$P($G(^MAGDWLST(2006.56,DA(1),1,DA,0)),"^",3) K:ACC'="" ^MAGDWLST(2006.56,"C",DA(1),X,ACC,DA)
"^DD",2006.56,2006.562,.01,1,1,"%D",0)
^.101^1^1^3100212^^
"^DD",2006.56,2006.562,.01,1,1,"%D",1,0)
This cross reference keeps track of which accession numbers belong to which services.
"^DD",2006.56,2006.562,.01,1,1,"DT")
2990312
"^DD",2006.56,2006.562,.01,1,2,0)
2006.56^D^MUMPS
"^DD",2006.56,2006.562,.01,1,2,1)
N SID S SID=$P($G(^MAGDWLST(2006.56,DA(1),1,DA,0)),"^",4) S:SID'="" ^MAGDWLST(2006.56,"D",DA(1),X,SID,DA)=""
"^DD",2006.56,2006.562,.01,1,2,2)
N SID S SID=$P($G(^MAGDWLST(2006.56,DA(1),1,DA,0)),"^",4) K:SID'="" ^MAGDWLST(2006.56,"D",DA(1),X,SID,DA)
"^DD",2006.56,2006.562,.01,1,2,"%D",0)
^^1^1^2990312^
"^DD",2006.56,2006.562,.01,1,2,"%D",1,0)
This cross reference keeps track of which study-IDs belong to which services.
"^DD",2006.56,2006.562,.01,1,2,"DT")
2990312
"^DD",2006.56,2006.562,.01,1,3,0)
2006.56^E^MUMPS
"^DD",2006.56,2006.562,.01,1,3,1)
N MOD,TIM,Z S Z=$G(^MAGDWLST(2006.56,DA(1),1,DA,0)),MOD=$P(Z,"^",10),TIM=$P(X,"^",5) I MOD'="",TIM'="" S ^MAGDWLST(2006.56,"E",DA(1),X,MOD,TIM,DA)=""
"^DD",2006.56,2006.562,.01,1,3,2)
N MOD,TIM,Z S Z=$G(^MAGDWLST(2006.56,DA(1),1,DA,0)),MOD=$P(Z,"^",10),TIM=$P(X,"^",5) I MOD'="",TIM'="" K ^MAGDWLST(2006.56,"E",DA(1),X,MOD,TIM,DA)
"^DD",2006.56,2006.562,.01,1,3,"%D",0)
^^1^1^2990312^^
"^DD",2006.56,2006.562,.01,1,3,"%D",1,0)
This cross reference keeps track of which modalities perform which services, and when these services are scheduled.
"^DD",2006.56,2006.562,.01,1,3,"DT")
2990312
"^DD",2006.56,2006.562,.01,3)
Enter the name of a service
"^DD",2006.56,2006.562,.01,21,0)
^.001^2^2^3021105^^^^
"^DD",2006.56,2006.562,.01,21,1,0)
The value of this field identifies the service to be
"^DD",2006.56,2006.562,.01,21,2,0)
performed for the patient.
"^DD",2006.56,2006.562,.01,"DT")
3090813
"^DD",2006.56,2006.562,2,0)
PATIENT^P2'^DPT(^0;2^Q
"^DD",2006.56,2006.562,2,1,0)
^.1^^0
"^DD",2006.56,2006.562,2,1,1,0)
2006.562^S
"^DD",2006.56,2006.562,2,1,1,1)
S ^MAGDWLST(2006.56,DA(1),1,"S",$E(X,1,30),DA)=""
"^DD",2006.56,2006.562,2,1,1,2)
K ^MAGDWLST(2006.56,DA(1),1,"S",$E(X,1,30),DA)
"^DD",2006.56,2006.562,2,1,1,"%D",0)
^^1^1^3001204^
"^DD",2006.56,2006.562,2,1,1,"%D",1,0)
This cross reference keeps track of which studies belong to which patients.
"^DD",2006.56,2006.562,2,1,1,"DT")
3001204
"^DD",2006.56,2006.562,2,3)
Enter the name of a patient.
"^DD",2006.56,2006.562,2,21,0)
^^3^3^2990311^
"^DD",2006.56,2006.562,2,21,1,0)
The value of this field is a pointer into the PATIENT file (#2).
"^DD",2006.56,2006.562,2,21,2,0)
The patient being pointed to is a patient for whom a study
"^DD",2006.56,2006.562,2,21,3,0)
being scheduled.
"^DD",2006.56,2006.562,2,"DT")
3061006
"^DD",2006.56,2006.562,3,0)
DATE-CASE NUMBER^F^^0;3^K:$L(X)>20!($L(X)<1) X
"^DD",2006.56,2006.562,3,1,0)
^.1^^0
"^DD",2006.56,2006.562,3,1,1,0)
2006.56^AC^MUMPS
"^DD",2006.56,2006.562,3,1,1,1)
N SVC S SVC=$P($G(^MAGDWLST(2006.56,DA(1),1,DA,0)),"^",1) I SVC'="" S ^MAGDWLST(2006.56,"C",DA(1),SVC,X,DA)=""
"^DD",2006.56,2006.562,3,1,1,2)
N SVC S SVC=$P($G(^MAGDWLST(2006.56,DA(1),1,DA,0)),"^",1) I SVC'="" K ^MAGDWLST(2006.56,"C",DA(1),SVC,X,DA)
"^DD",2006.56,2006.562,3,1,1,"%D",0)
^^2^2^3100212^
"^DD",2006.56,2006.562,3,1,1,"%D",1,0)
This cross reference allows studies to be located by division, service, 
"^DD",2006.56,2006.562,3,1,1,"%D",2,0)
and date-case number.
"^DD",2006.56,2006.562,3,1,1,"DT")
2990312
"^DD",2006.56,2006.562,3,3)
Enter an accession number (1-20 chars).
"^DD",2006.56,2006.562,3,21,0)
^.001^7^7^3100212^^^^
"^DD",2006.56,2006.562,3,21,1,0)
The value of this field is the (long) accession number
"^DD",2006.56,2006.562,3,21,2,0)
for the study being performed.
"^DD",2006.56,2006.562,3,21,3,0)
 
"^DD",2006.56,2006.562,3,21,4,0)
An accession number is created by encoding the date
"^DD",2006.56,2006.562,3,21,5,0)
in six digits (ddmmyy), and suffixing a dash and an
"^DD",2006.56,2006.562,3,21,6,0)
integer number (no leading zeroes) that uniquely identifies the study
"^DD",2006.56,2006.562,3,21,7,0)
for that date.
"^DD",2006.56,2006.562,3,"DT")
3090722
"^DD",2006.56,2006.562,4,0)
STUDY ID^F^^0;4^K:$L(X)>20!($L(X)<1) X
"^DD",2006.56,2006.562,4,1,0)
^.1^^0
"^DD",2006.56,2006.562,4,1,1,0)
2006.56^AD^MUMPS
"^DD",2006.56,2006.562,4,1,1,1)
N SVC S SVC=$P($G(^MAGDWLST(2006.56,DA(1),1,DA,0)),"^",1) I SVC'="" S ^MAGDWLST(2006.56,"D",DA(1),SVC,X,DA)=""
"^DD",2006.56,2006.562,4,1,1,2)
N SVC S SVC=$P($G(^MAGDWLST(2006.56,DA(1),1,DA,0)),"^",1) I SVC'="" K ^MAGDWLST(2006.56,"D",DA(1),SVC,X,DA)
"^DD",2006.56,2006.562,4,1,1,"DT")
2990312
"^DD",2006.56,2006.562,4,3)
Enter a Study ID.
"^DD",2006.56,2006.562,4,21,0)
^^6^6^3000218^^
"^DD",2006.56,2006.562,4,21,1,0)
The value of this field is the (short) accession number
"^DD",2006.56,2006.562,4,21,2,0)
for the study being performed.
"^DD",2006.56,2006.562,4,21,3,0)
 
"^DD",2006.56,2006.562,4,21,4,0)
A short accession number is an
"^DD",2006.56,2006.562,4,21,5,0)
integer number (no leading zeroes) that uniquely identifies
"^DD",2006.56,2006.562,4,21,6,0)
a study during the day on which it occurs.
"^DD",2006.56,2006.562,4,"DT")
3061006
"^DD",2006.56,2006.562,5,0)
TIMESTAMP^D^^0;5^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",2006.56,2006.562,5,1,0)
^.1^^0
"^DD",2006.56,2006.562,5,1,1,0)
2006.56^AF^MUMPS
"^DD",2006.56,2006.562,5,1,1,1)
N MOD,SVC,Z S Z=$G(^MAGDWLST(2006.56,DA(1),1,DA,0)),SVC=$P(Z,"^",1),MOD=$P(Z,"^",10) I SVC'="",MOD'="" S ^MAGDWLST(2006.56,"E",DA(1),SVC,MOD,X,DA)=""
"^DD",2006.56,2006.562,5,1,1,2)
N MOD,SVC,Z S Z=$G(^MAGDWLST(2006.56,DA(1),1,DA,0)),SVC=$P(Z,"^",1),MOD=$P(Z,"^",10) I SVC'="",MOD'="" K ^MAGDWLST(2006.56,"E",DA(1),SVC,MOD,X,DA)
"^DD",2006.56,2006.562,5,1,1,"DT")
2990312
"^DD",2006.56,2006.562,5,3)
Enter the date and time of the study.
"^DD",2006.56,2006.562,5,21,0)
^^3^3^3000218^^
"^DD",2006.56,2006.562,5,21,1,0)
The value of this field indicates the date and time
"^DD",2006.56,2006.562,5,21,2,0)
for which the procedure that is described in this
"^DD",2006.56,2006.562,5,21,3,0)
entry has been scheduled.
"^DD",2006.56,2006.562,5,"DT")
3061006
"^DD",2006.56,2006.562,6,0)
PROCEDURE^F^^0;6^K:$L(X)>10!($L(X)<1) X
"^DD",2006.56,2006.562,6,3)
Enter a code for the procedure to be performed during the study.
"^DD",2006.56,2006.562,6,21,0)
^^5^5^3000218^^
"^DD",2006.56,2006.562,6,21,1,0)
The value of this field is the internal entry number
"^DD",2006.56,2006.562,6,21,2,0)
in ^RAMIS(71,... that identifies the procedure
"^DD",2006.56,2006.562,6,21,3,0)
that is described in this entry.
"^DD",2006.56,2006.562,6,21,4,0)
 
"^DD",2006.56,2006.562,6,21,5,0)
VA-FileMan file 71 (RAD/NUC MED procedures) is stored in ^RAMIS(71,...
"^DD",2006.56,2006.562,6,"DT")
2990202
"^DD",2006.56,2006.562,7,0)
PROCEDURE DESCRIPTION^F^^4;1^K:$L(X)>30!($L(X)<1) X
"^DD",2006.56,2006.562,7,3)
Enter a description of the procedure to be performed.
"^DD",2006.56,2006.562,7,21,0)
^^6^6^3000218^^
"^DD",2006.56,2006.562,7,21,1,0)
The value of this field is the name of the procedure
"^DD",2006.56,2006.562,7,21,2,0)
that is described in this entry.
"^DD",2006.56,2006.562,7,21,3,0)
This name is copied from ^RAMIS(71,... so that
"^DD",2006.56,2006.562,7,21,4,0)
worklist queries can also be performed when the network
"^DD",2006.56,2006.562,7,21,5,0)
connection (DDP) with the main Hospital Information System
"^DD",2006.56,2006.562,7,21,6,0)
is not available.
"^DD",2006.56,2006.562,7,"DT")
2990202
"^DD",2006.56,2006.562,8,0)
CPT CODE^F^^0;8^K:$L(X)>10!($L(X)<1) X
"^DD",2006.56,2006.562,8,3)
Enter the CPT code for the procedure to be performed.
"^DD",2006.56,2006.562,8,21,0)
^^5^5^3000218^^
"^DD",2006.56,2006.562,8,21,1,0)
The value of this field is the internal entry number
"^DD",2006.56,2006.562,8,21,2,0)
in ^ICPT(... that identifies the procedure
"^DD",2006.56,2006.562,8,21,3,0)
that is described in this entry.
"^DD",2006.56,2006.562,8,21,4,0)
 
"^DD",2006.56,2006.562,8,21,5,0)
VA-FileMan file 81 (CPT codes) is stored in ^ICPT(...
"^DD",2006.56,2006.562,8,"DT")
2990202
"^DD",2006.56,2006.562,9,0)
CPT DESCRIPTION^F^^5;1^K:$L(X)>10!($L(X)<1) X
"^DD",2006.56,2006.562,9,3)
Enter the description of the CPT code for the procedure to be performed.
"^DD",2006.56,2006.562,9,21,0)
^^9^9^3000218^^
"^DD",2006.56,2006.562,9,21,1,0)
The value of this field is the name of the procedure
"^DD",2006.56,2006.562,9,21,2,0)
that is described in this entry.
"^DD",2006.56,2006.562,9,21,3,0)
 
"^DD",2006.56,2006.562,9,21,4,0)
CPT stands for Current Procedural Terminology.
"^DD",2006.56,2006.562,9,21,5,0)
 
"^DD",2006.56,2006.562,9,21,6,0)
This name is copied from ^ICPT(... so that
"^DD",2006.56,2006.562,9,21,7,0)
worklist queries can also be performed when the network
"^DD",2006.56,2006.562,9,21,8,0)
connection (DDP) with the main Hospital Information System
"^DD",2006.56,2006.562,9,21,9,0)
is not available.
"^DD",2006.56,2006.562,9,"DT")
2990312
"^DD",2006.56,2006.562,10,0)
MODALITY^F^^0;10^K:$L(X)>20!($L(X)<1) X
"^DD",2006.56,2006.562,10,1,0)
^.1^^0
"^DD",2006.56,2006.562,10,3)
Enter the name of the modality.
"^DD",2006.56,2006.562,10,21,0)
^^43^43^3000218^^
"^DD",2006.56,2006.562,10,21,1,0)
The value of this field is a list of codes, separated
"^DD",2006.56,2006.562,10,21,2,0)
by commas, that each identify a modality on which the
"^DD",2006.56,2006.562,10,21,3,0)
requested procedure can be performed.
"^DD",2006.56,2006.562,10,21,4,0)
 
"^DD",2006.56,2006.562,10,21,5,0)
Possible codes for modalities are:
"^DD",2006.56,2006.562,10,21,6,0)
   AS: Angioscopy
"^DD",2006.56,2006.562,10,21,7,0)
   BI: Biomagnetic imaging
"^DD",2006.56,2006.562,10,21,8,0)
   CD: Color flow Doppler
"^DD",2006.56,2006.562,10,21,9,0)
   CF: Cinefluorography
"^DD",2006.56,2006.562,10,21,10,0)
   CP: Culposcopy
"^DD",2006.56,2006.562,10,21,11,0)
   CR: Computed Radiography
"^DD",2006.56,2006.562,10,21,12,0)
   CS: Cystoscopy
"^DD",2006.56,2006.562,10,21,13,0)
   CT: Computed Tomography
"^DD",2006.56,2006.562,10,21,14,0)
   DD: Duplex Doppler
"^DD",2006.56,2006.562,10,21,15,0)
   DF: Digital fluoroscopy
"^DD",2006.56,2006.562,10,21,16,0)
   DG: Diaphanography
"^DD",2006.56,2006.562,10,21,17,0)
   DM: Digital microscopy
"^DD",2006.56,2006.562,10,21,18,0)
   DS: Digital Subtraction Angiography
"^DD",2006.56,2006.562,10,21,19,0)
   DX: Digital Radiography
"^DD",2006.56,2006.562,10,21,20,0)
   EC: Echocardiography
"^DD",2006.56,2006.562,10,21,21,0)
   ES: Endoscopy
"^DD",2006.56,2006.562,10,21,22,0)
   FA: Fluorescein angiography
"^DD",2006.56,2006.562,10,21,23,0)
   FS: Fundoscopy
"^DD",2006.56,2006.562,10,21,24,0)
   IO: Intra-oral Radiology
"^DD",2006.56,2006.562,10,21,25,0)
   LP: Laparoscopy
"^DD",2006.56,2006.562,10,21,26,0)
   LS: Laser surface scan
"^DD",2006.56,2006.562,10,21,27,0)
   MA: Magnetic resonance angiography
"^DD",2006.56,2006.562,10,21,28,0)
   MG: Mammography
"^DD",2006.56,2006.562,10,21,29,0)
   MR: Magnetic Resonance
"^DD",2006.56,2006.562,10,21,30,0)
   MS: Magnetic resonance spectroscopy
"^DD",2006.56,2006.562,10,21,31,0)
   NM: Nuclear Medicine
"^DD",2006.56,2006.562,10,21,32,0)
   OT: Other
"^DD",2006.56,2006.562,10,21,33,0)
   PT: Positron emission tomography (PET)
"^DD",2006.56,2006.562,10,21,34,0)
   RF: Radio Fluoroscopy
"^DD",2006.56,2006.562,10,21,35,0)
   RG: Radiographic imaging (conventional film/screen)
"^DD",2006.56,2006.562,10,21,36,0)
   ST: Single-photon emission computed tomography (SPECT)
"^DD",2006.56,2006.562,10,21,37,0)
   TG: Thermography
"^DD",2006.56,2006.562,10,21,38,0)
   US: Ultrasound
"^DD",2006.56,2006.562,10,21,39,0)
   VF: Videofluorography
"^DD",2006.56,2006.562,10,21,40,0)
   VL: Visable Light
"^DD",2006.56,2006.562,10,21,41,0)
   XA: X-Ray Angiography
"^DD",2006.56,2006.562,10,21,42,0)
 
"^DD",2006.56,2006.562,10,21,43,0)
These codes are also stored in ^RAMIS(73.1,...
"^DD",2006.56,2006.562,10,"DT")
3030114
"^DD",2006.56,2006.562,11,0)
STUDY UID^F^^1;1^K:$L(X)>99!($L(X)<1) X
"^DD",2006.56,2006.562,11,1,0)
^.1
"^DD",2006.56,2006.562,11,1,1,0)
2006.56^F^MUMPS
"^DD",2006.56,2006.562,11,1,1,1)
S ^MAGDWLST(2006.56,"F",X,DA(1),DA)=""
"^DD",2006.56,2006.562,11,1,1,2)
K ^MAGDWLST(2006.56,"F",X,DA(1),DA)
"^DD",2006.56,2006.562,11,1,1,"%D",0)
^^3^3^2990615^^
"^DD",2006.56,2006.562,11,1,1,"%D",1,0)
This cross reference keeps track of the Study UIDs.
"^DD",2006.56,2006.562,11,1,1,"%D",2,0)
Since the UIDs are unique, the division is a later subscript
"^DD",2006.56,2006.562,11,1,1,"%D",3,0)
in this cross reference than in all other cross references on this file.
"^DD",2006.56,2006.562,11,1,1,"DT")
2990615
"^DD",2006.56,2006.562,11,3)
Enter the unique identifier for the study to be performed.
"^DD",2006.56,2006.562,11,21,0)
^^2^2^3000218^^
"^DD",2006.56,2006.562,11,21,1,0)
The value of this field is a unique identifier for
"^DD",2006.56,2006.562,11,21,2,0)
the study that is described in this entry.
"^DD",2006.56,2006.562,11,"DT")
2990615
"^DD",2006.56,2006.562,12,0)
PATIENT HISTORY^2006.5621A^^2;0
"^DD",2006.56,2006.562,13,0)
REFERRING PHYSICIAN^F^^3;1^K:$L(X)>20!($L(X)<1) X
"^DD",2006.56,2006.562,13,1,0)
^.1^^0
"^DD",2006.56,2006.562,13,3)
Enter the name of the referring physician.
"^DD",2006.56,2006.562,13,21,0)
^^2^2^3000218^^
"^DD",2006.56,2006.562,13,21,1,0)
The value of this field, if any, is the name of the
"^DD",2006.56,2006.562,13,21,2,0)
physician who ...
"^DD",2006.56,2006.562,13,"DT")
2990312
"^DD",2006.56,2006.562,14,0)
ATTENDING PHYSICIAN^F^^3;2^K:$L(X)>20!($L(X)<1) X
"^DD",2006.56,2006.562,14,3)
Enter the name of the attending physician.
"^DD",2006.56,2006.562,14,21,0)
^^2^2^3000218^^
"^DD",2006.56,2006.562,14,21,1,0)
The value of this field, if any, is the name of the
"^DD",2006.56,2006.562,14,21,2,0)
physician who ...
"^DD",2006.56,2006.562,14,"DT")
2990312
"^DD",2006.56,2006.562,15,0)
REQUESTING PHYSICIAN^F^^3;3^K:$L(X)>20!($L(X)<1) X
"^DD",2006.56,2006.562,15,3)
Enter the name of the requesting physician
"^DD",2006.56,2006.562,15,21,0)
^^3^3^3000218^^
"^DD",2006.56,2006.562,15,21,1,0)
The value of this field, if any, is the name of the
"^DD",2006.56,2006.562,15,21,2,0)
physician who requested the study that is described
"^DD",2006.56,2006.562,15,21,3,0)
in this entry.
"^DD",2006.56,2006.562,15,"DT")
2990312
"^DD",2006.56,2006.562,16,0)
REQUESTED SERVICE^F^^3;4^K:$L(X)>20!($L(X)<1) X
"^DD",2006.56,2006.562,16,3)
Enter the name of the requested service.
"^DD",2006.56,2006.562,16,21,0)
^^4^4^3000218^^
"^DD",2006.56,2006.562,16,21,1,0)
The value of this field, if any, is the name of the
"^DD",2006.56,2006.562,16,21,2,0)
service that was requested for the study that is described
"^DD",2006.56,2006.562,16,21,3,0)
in this entry.
"^DD",2006.56,2006.562,16,21,4,0)

"^DD",2006.56,2006.562,16,"DT")
2990311
"^DD",2006.56,2006.562,17,0)
TYPE CODE^F^^0;11^K:$L(X)>10!($L(X)<1) X
"^DD",2006.56,2006.562,17,3)
Enter the 'type code'.
"^DD",2006.56,2006.562,17,21,0)
^.001^19^19^3020401^^^
"^DD",2006.56,2006.562,17,21,1,0)
The value of this field is a code for the type of imaging
"^DD",2006.56,2006.562,17,21,2,0)
activity.
"^DD",2006.56,2006.562,17,21,3,0)

"^DD",2006.56,2006.562,17,21,4,0)
The value for this field is obtained from the HL7 message
"^DD",2006.56,2006.562,17,21,5,0)
that was transmitted for this event.
"^DD",2006.56,2006.562,17,21,6,0)

"^DD",2006.56,2006.562,17,21,7,0)
Typical values are codes like:
"^DD",2006.56,2006.562,17,21,8,0)
   ANI
"^DD",2006.56,2006.562,17,21,9,0)
   CT
"^DD",2006.56,2006.562,17,21,10,0)
   MAM
"^DD",2006.56,2006.562,17,21,11,0)
   MRI
"^DD",2006.56,2006.562,17,21,12,0)
   NM
"^DD",2006.56,2006.562,17,21,13,0)
   RAD
"^DD",2006.56,2006.562,17,21,14,0)
   US
"^DD",2006.56,2006.562,17,21,15,0)
   VAS
"^DD",2006.56,2006.562,17,21,16,0)

"^DD",2006.56,2006.562,17,21,17,0)
Since any value obtained from an HL7 message will be considered
"^DD",2006.56,2006.562,17,21,18,0)
valid when entering data into this file, this field is typed as
"^DD",2006.56,2006.562,17,21,19,0)
"free text", rather than as a "set of codes".
"^DD",2006.56,2006.562,17,"DT")
2990318
"^DD",2006.56,2006.562,19,0)
STATUS^S^CREATED:Created;SCHEDULED:Scheduled;ARRIVED:Arrived;STARTED:Started;COMPLETED:Completed;VERIFIED:Verified;^0;7^Q
"^DD",2006.56,2006.562,19,3)
Enter a code for the status of this study.
"^DD",2006.56,2006.562,19,21,0)
^^10^10^3020401^
"^DD",2006.56,2006.562,19,21,1,0)
The value of this field is a code that identifies the current
"^DD",2006.56,2006.562,19,21,2,0)
status of the study.
"^DD",2006.56,2006.562,19,21,3,0)
 
"^DD",2006.56,2006.562,19,21,4,0)
Initially, the following possible values are defined:
"^DD",2006.56,2006.562,19,21,5,0)
  CREATED      Ordered or Created, but not yet Scheduled
"^DD",2006.56,2006.562,19,21,6,0)
  SCHEDULED    Scheduled, but not yet started
"^DD",2006.56,2006.562,19,21,7,0)
  ARRIVED      Patient has arrived, but study has not yet started
"^DD",2006.56,2006.562,19,21,8,0)
  STARTED      Study has started, but not yet finished
"^DD",2006.56,2006.562,19,21,9,0)
  COMPLETED    Study has completed
"^DD",2006.56,2006.562,19,21,10,0)
  VERIFIED     Study has completed, and image quality has been verified
"^DD",2006.56,2006.562,19,"DT")
3020401
"^DD",2006.56,2006.562,20,0)
PRIORITY^S^STAT:STAT;HIGH:High;MEDIUM:Medium;ROUTINE:Routine;LOW:Low;^0;9^Q
"^DD",2006.56,2006.562,20,3)
Enter a code for the priority of this study.
"^DD",2006.56,2006.562,20,21,0)
^^2^2^3020401^
"^DD",2006.56,2006.562,20,21,1,0)
The value of this field is a code that identifies the
"^DD",2006.56,2006.562,20,21,2,0)
priority of the study.
"^DD",2006.56,2006.562,20,"DT")
3020401
"^DD",2006.56,2006.562,21,0)
TIU NOTE SIGNED^S^0:No;1:Yes;^0;12^Q
"^DD",2006.56,2006.562,21,3)
Indicate whether or not the TIU note has been signed.
"^DD",2006.56,2006.562,21,21,0)
^.001^6^6^3020422^^^^
"^DD",2006.56,2006.562,21,21,1,0)
The value for this field is a code that indicates
"^DD",2006.56,2006.562,21,21,2,0)
whether or not the TIU note with which this study is
"^DD",2006.56,2006.562,21,21,3,0)
associated has been signed.
"^DD",2006.56,2006.562,21,21,4,0)
 
"^DD",2006.56,2006.562,21,21,5,0)
A value of 0 indicates that the note has not yet been signed.
"^DD",2006.56,2006.562,21,21,6,0)
A value of 1 indicates that the note has been signed.
"^DD",2006.56,2006.562,21,"DT")
3020422
"^DD",2006.56,2006.562,22,0)
INTENDED RECIPIENT OF RESULTS^F^^3;5^K:$L(X)>30!($L(X)<1) X
"^DD",2006.56,2006.562,22,3)
Enter the name of the recipient of the results of this study.
"^DD",2006.56,2006.562,22,21,0)
^.001^6^6^3021105^^^
"^DD",2006.56,2006.562,22,21,1,0)
The value of this field is a string that contains the name of
"^DD",2006.56,2006.562,22,21,2,0)
the person who is intended to receive the results of this study.
"^DD",2006.56,2006.562,22,21,3,0)
 
"^DD",2006.56,2006.562,22,21,4,0)
(Intentionally, this field is NOT a pointer to the Person File
"^DD",2006.56,2006.562,22,21,5,0)
(#200), because that file may not be accessible when the value
"^DD",2006.56,2006.562,22,21,6,0)
for this field is being retrieved.)
"^DD",2006.56,2006.562,22,"DT")
3020401
"^DD",2006.56,2006.562,23,0)
APPOINTMENT SCHEDULE^2006.5622A^^7;0
"^DD",2006.56,2006.562,24,0)
TAG^2006.5623^^8;0
"^DD",2006.56,2006.562,24,21,0)
^.001^2^2^3100407^^
"^DD",2006.56,2006.562,24,21,1,0)
This multiple contains the DICOM tag-value pairs that record the patient 
"^DD",2006.56,2006.562,24,21,2,0)
and study information that will be returned in a Modality Worklist query.
"^DD",2006.56,2006.562,25,0)
ACCESSION NUMBER^F^^0;13^K:$L(X)>16!($L(X)<1) X
"^DD",2006.56,2006.562,25,3)
This is the full-length accession number (1-16 chars).
"^DD",2006.56,2006.562,25,21,0)
^.001^8^8^3100212^^
"^DD",2006.56,2006.562,25,21,1,0)
The accession number should be placed into this field.  The format of the 
"^DD",2006.56,2006.562,25,21,2,0)
accession number varies by service.
"^DD",2006.56,2006.562,25,21,3,0)
 
"^DD",2006.56,2006.562,25,21,4,0)
For Radiology studies, the accession number can be either the old
"^DD",2006.56,2006.562,25,21,5,0)
date-case number (mmddyy-nnnnn format) or the new site-specific accession
"^DD",2006.56,2006.562,25,21,6,0)
number (sss-mmddyy-nnnnn format).
"^DD",2006.56,2006.562,25,21,7,0)
 
"^DD",2006.56,2006.562,25,21,8,0)
For Consult studies, the format of the accession number is GMRC-nnnnnnnn.
"^DD",2006.56,2006.562,25,"DT")
3090813
"^DD",2006.56,2006.562,26,0)
CPT CODING SCHEME^F^^0;14^K:$L(X)>15!($L(X)<1) X
"^DD",2006.56,2006.562,26,3)
Answer must be 1-15 characters in length.
"^DD",2006.56,2006.562,26,21,0)
^^1^1^3101207^
"^DD",2006.56,2006.562,26,21,1,0)
This is the CPT Coding Scheme as defined by the DICOM Standard.
"^DD",2006.56,2006.562,26,"DT")
3101207
"^DD",2006.56,2006.5621,0)
PATIENT HISTORY SUB-FIELD^^.01^1
"^DD",2006.56,2006.5621,0,"DT")
2990202
"^DD",2006.56,2006.5621,0,"NM","PATIENT HISTORY")

"^DD",2006.56,2006.5621,0,"UP")
2006.562
"^DD",2006.56,2006.5621,.01,0)
PATIENT HISTORY^F^^0;1^K:$L(X)>99!($L(X)<1) X
"^DD",2006.56,2006.5621,.01,1,0)
^.1^^0
"^DD",2006.56,2006.5621,.01,3)
Enter a line of patient history text.
"^DD",2006.56,2006.5621,.01,21,0)
^^6^6^3000218^^
"^DD",2006.56,2006.5621,.01,21,1,0)
The text in this multi-line entry describes any
"^DD",2006.56,2006.5621,.01,21,2,0)
patient history that is germane in the context
"^DD",2006.56,2006.5621,.01,21,3,0)
of the study that is described in this entry.
"^DD",2006.56,2006.5621,.01,21,4,0)
 
"^DD",2006.56,2006.5621,.01,21,5,0)
Often, this section of the patient's history is
"^DD",2006.56,2006.5621,.01,21,6,0)
referred to as the 'reason for study'.
"^DD",2006.56,2006.5621,.01,"DT")
2990202
"^DD",2006.56,2006.5622,0)
APPOINTMENT SCHEDULE SUB-FIELD^^1^2
"^DD",2006.56,2006.5622,0,"DT")
3020521
"^DD",2006.56,2006.5622,0,"IX","B",2006.5622,.01)

"^DD",2006.56,2006.5622,0,"NM","APPOINTMENT SCHEDULE")

"^DD",2006.56,2006.5622,0,"UP")
2006.562
"^DD",2006.56,2006.5622,.01,0)
CLINIC NAME^F^^0;1^K:$L(X)>60!($L(X)<3) X
"^DD",2006.56,2006.5622,.01,1,0)
^.1^^0
"^DD",2006.56,2006.5622,.01,1,1,0)
2006.5622^B
"^DD",2006.56,2006.5622,.01,1,1,1)
S ^MAGDWLST(2006.56,DA(2),1,DA(1),7,"B",$E(X,1,30),DA)=""
"^DD",2006.56,2006.5622,.01,1,1,2)
K ^MAGDWLST(2006.56,DA(2),1,DA(1),7,"B",$E(X,1,30),DA)
"^DD",2006.56,2006.5622,.01,3)
Enter the name of the clinic where the appointment will take place.
"^DD",2006.56,2006.5622,.01,21,0)
^.001^3^3^3021105^^^
"^DD",2006.56,2006.5622,.01,21,1,0)
The value of this field is a string that identifies
"^DD",2006.56,2006.5622,.01,21,2,0)
the name of the clinic where the appointment will
"^DD",2006.56,2006.5622,.01,21,3,0)
take place.
"^DD",2006.56,2006.5622,.01,"DT")
3030114
"^DD",2006.56,2006.5622,1,0)
DATE/TIME^D^^0;2^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",2006.56,2006.5622,1,21,0)
^^1^1^3020521^
"^DD",2006.56,2006.5622,1,21,1,0)
Date and time of appointment.
"^DD",2006.56,2006.5622,1,"DT")
3020521
"^DD",2006.56,2006.5623,0)
TAG SUB-FIELD^^2^3
"^DD",2006.56,2006.5623,0,"DT")
3061006
"^DD",2006.56,2006.5623,0,"IX","B",2006.5623,.01)

"^DD",2006.56,2006.5623,0,"NM","TAG")

"^DD",2006.56,2006.5623,0,"UP")
2006.562
"^DD",2006.56,2006.5623,.01,0)
TAG^MF^^0;1^K:$L(X)>30!($L(X)<1) X
"^DD",2006.56,2006.5623,.01,1,0)
^.1
"^DD",2006.56,2006.5623,.01,1,1,0)
2006.5623^B
"^DD",2006.56,2006.5623,.01,1,1,1)
S ^MAGDWLST(2006.56,DA(2),1,DA(1),8,"B",$E(X,1,30),DA)=""
"^DD",2006.56,2006.5623,.01,1,1,2)
K ^MAGDWLST(2006.56,DA(2),1,DA(1),8,"B",$E(X,1,30),DA)
"^DD",2006.56,2006.5623,.01,3)
Enter the tag for this entry (1-30 char).
"^DD",2006.56,2006.5623,.01,21,0)
^.001^3^3^3100212^^
"^DD",2006.56,2006.5623,.01,21,1,0)
The value of this field is a string. This string corresponds to the tag in
"^DD",2006.56,2006.5623,.01,21,2,0)
the DICOM standard. Each tag corresponds to a data item, e.g., 0010,0010
"^DD",2006.56,2006.5623,.01,21,3,0)
identifies the patient's name.
"^DD",2006.56,2006.5623,.01,"DT")
3061006
"^DD",2006.56,2006.5623,1,0)
VALUE^F^^0;2^K:$L(X)>100!($L(X)<1) X
"^DD",2006.56,2006.5623,1,3)
Enter the value for this tag (1-100 char).
"^DD",2006.56,2006.5623,1,21,0)
^.001^5^5^3100407^^^^
"^DD",2006.56,2006.5623,1,21,1,0)
The value of this field is a string. This string is the value that is
"^DD",2006.56,2006.5623,1,21,2,0)
associated with the tag that is stored in the .01 field of this multiple.
"^DD",2006.56,2006.5623,1,21,3,0)
 
"^DD",2006.56,2006.5623,1,21,4,0)
E.g. for the DICOM tag "0010,0010" (patient's name),
"^DD",2006.56,2006.5623,1,21,5,0)
the value could be "DOE,JOHN Q".
"^DD",2006.56,2006.5623,1,"DT")
3061006
"^DD",2006.56,2006.5623,2,0)
TEXT^2006.5624^^1;0
"^DD",2006.56,2006.5623,2,21,0)
^.001^4^4^3100407^^
"^DD",2006.56,2006.5623,2,21,1,0)
This multiple contains text that will populate a DICOM element whose 
"^DD",2006.56,2006.5623,2,21,2,0)
value representation allows it to contain one to many lines of text.  The 
"^DD",2006.56,2006.5623,2,21,3,0)
meaning of this text is determined by the value of the .01 field in this 
"^DD",2006.56,2006.5623,2,21,4,0)
multiple.
"^DD",2006.56,2006.5624,0)
TEXT SUB-FIELD^^.01^1
"^DD",2006.56,2006.5624,0,"DT")
3061006
"^DD",2006.56,2006.5624,0,"NM","TEXT")

"^DD",2006.56,2006.5624,0,"UP")
2006.5623
"^DD",2006.56,2006.5624,.01,0)
TEXT^MF^^0;1^K:$L(X)>240!($L(X)<1) X
"^DD",2006.56,2006.5624,.01,1,0)
^.1^^0
"^DD",2006.56,2006.5624,.01,3)
Enter a line of text (1-240 char).
"^DD",2006.56,2006.5624,.01,21,0)
^^1^1^3100212^
"^DD",2006.56,2006.5624,.01,21,1,0)
The value of this field is a single line of text. 
"^DD",2006.56,2006.5624,.01,"DT")
3100407
"^DD",2006.563,2006.563,0)
FIELD^^130^115
"^DD",2006.563,2006.563,0,"DDA")
N
"^DD",2006.563,2006.563,0,"DT")
3100702
"^DD",2006.563,2006.563,0,"NM","DICOM GATEWAY PARAMETER")

"^DD",2006.563,2006.563,0,"VRPK")
IMAGING
"^DD",2006.563,2006.563,.01,0)
SYSTEM TITLE^RF^^SYSTEM TITLE;1^K:$L(X)>60!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",2006.563,2006.563,.01,1,0)
^.1^^0
"^DD",2006.563,2006.563,.01,3)
Enter a descriptive text for this Gateway Station.
"^DD",2006.563,2006.563,.01,21,0)
^^6^6^3000218^^
"^DD",2006.563,2006.563,.01,21,1,0)
The value of this field is a text that identifies
"^DD",2006.563,2006.563,.01,21,2,0)
the computer on which this database is stored.
"^DD",2006.563,2006.563,.01,21,3,0)
 
"^DD",2006.563,2006.563,.01,21,4,0)
Note that each VistA DICOM Gateway computer has its
"^DD",2006.563,2006.563,.01,21,5,0)
own copy of ^MAGDICOM, in which these site-parameters
"^DD",2006.563,2006.563,.01,21,6,0)
are stored.
"^DD",2006.563,2006.563,2,0)
ASCII DICOM TEXT^F^^ASCII DICOM TEXT;1^K:$L(X)>10!($L(X)<1) X
"^DD",2006.563,2006.563,2,3)
Indicate whether or not ASCII Text files are to be produced.
"^DD",2006.563,2006.563,2,21,0)
^^16^16^3000218^^
"^DD",2006.563,2006.563,2,21,1,0)
The value of this field is a code that indicates
"^DD",2006.563,2006.563,2,21,2,0)
whether or not files will be created that make the
"^DD",2006.563,2006.563,2,21,3,0)
data-streams that are exchanged according to the
"^DD",2006.563,2006.563,2,21,4,0)
DICOM protocol available in a human-readable form.
"^DD",2006.563,2006.563,2,21,5,0)
 
"^DD",2006.563,2006.563,2,21,6,0)
Possible values for this code are 'YES' and 'NO'
"^DD",2006.563,2006.563,2,21,7,0)
(fully spelled, in capitals).
"^DD",2006.563,2006.563,2,21,8,0)
 
"^DD",2006.563,2006.563,2,21,9,0)
The human-readable files will have a file name
"^DD",2006.563,2006.563,2,21,10,0)
extension of '.TXT'.
"^DD",2006.563,2006.563,2,21,11,0)
 
"^DD",2006.563,2006.563,2,21,12,0)
This value is stored in this table (^MAGDICOM(2006.563,...
"^DD",2006.563,2006.563,2,21,13,0)
rather than in ^MAG(2006.1,...), because the VistA
"^DD",2006.563,2006.563,2,21,14,0)
DICOM Gateway will need to be able to access this
"^DD",2006.563,2006.563,2,21,15,0)
value whether or not the network link with the VistA
"^DD",2006.563,2006.563,2,21,16,0)
system (DDP) is available.
"^DD",2006.563,2006.563,2,"DT")
2991018
"^DD",2006.563,2006.563,3,0)
COMMERCIAL PACS^F^^COMMERCIAL PACS;1^K:$L(X)>10!($L(X)<1) X
"^DD",2006.563,2006.563,3,3)
Indicate whether or not a commercial PACS is present.
"^DD",2006.563,2006.563,3,21,0)
^^13^13^3000218^^
"^DD",2006.563,2006.563,3,21,1,0)
The value of this field is a code that indicates
"^DD",2006.563,2006.563,3,21,2,0)
if a PACS is present at the site, and, if so,
"^DD",2006.563,2006.563,3,21,3,0)
whether or not this PACS has a brand-name of
"^DD",2006.563,2006.563,3,21,4,0)
General Electric.
"^DD",2006.563,2006.563,3,21,5,0)
 
"^DD",2006.563,2006.563,3,21,6,0)
Possible values for this code are 'N/A',
"^DD",2006.563,2006.563,3,21,7,0)
'GE' and 'NON-GE'.
"^DD",2006.563,2006.563,3,21,8,0)
 
"^DD",2006.563,2006.563,3,21,9,0)
This value is stored in this table (^MAGDICOM(2006.563,...
"^DD",2006.563,2006.563,3,21,10,0)
rather than in ^MAG(2006.1,...), because the VistA
"^DD",2006.563,2006.563,3,21,11,0)
DICOM Gateway will need to be able to access this
"^DD",2006.563,2006.563,3,21,12,0)
value whether or not the network link with the VistA
"^DD",2006.563,2006.563,3,21,13,0)
system (DDP) is available.
"^DD",2006.563,2006.563,3,"DT")
2991018
"^DD",2006.563,2006.563,4,0)
DATA PATH^2006.5631A^^DATA PATH;0
"^DD",2006.563,2006.563,4,3)
Enter the directory path name for the location where data is to be stored.
"^DD",2006.563,2006.563,4,"DT")
2991018
"^DD",2006.563,2006.563,5,0)
DICT PATH^F^^DICT PATH;1^K:$L(X)>10!($L(X)<1) X
"^DD",2006.563,2006.563,5,3)
Enter the directory path name for the location where master files are stored.
"^DD",2006.563,2006.563,5,21,0)
^^6^6^3000218^^
"^DD",2006.563,2006.563,5,21,1,0)
The value of this field is the 'path-prefix'
"^DD",2006.563,2006.563,5,21,2,0)
that needs to be applied to gain access to the
"^DD",2006.563,2006.563,5,21,3,0)
'dictionary' files (also known as 'master files).
"^DD",2006.563,2006.563,5,21,4,0)
 
"^DD",2006.563,2006.563,5,21,5,0)
These 'master files' contain the various tables
"^DD",2006.563,2006.563,5,21,6,0)
that drive the operation of the VistA DICOM Gateways.
"^DD",2006.563,2006.563,5,"DT")
2991018
"^DD",2006.563,2006.563,6,0)
HIS/RIS^F^^HIS/RIS;1^K:$L(X)>10!($L(X)<1) X
"^DD",2006.563,2006.563,6,3)
Enter the name of the HIS or RIS that is being used.
"^DD",2006.563,2006.563,6,21,0)
^^11^11^3000218^^
"^DD",2006.563,2006.563,6,21,1,0)
The value of this field is a code that identifies
"^DD",2006.563,2006.563,6,21,2,0)
the type of Hospital Information System that is being
"^DD",2006.563,2006.563,6,21,3,0)
used at the site.
"^DD",2006.563,2006.563,6,21,4,0)
 
"^DD",2006.563,2006.563,6,21,5,0)
Currently, this value is always equal to 'VISTA'.
"^DD",2006.563,2006.563,6,21,6,0)
 
"^DD",2006.563,2006.563,6,21,7,0)
This value is stored in this table (^MAGDICOM(2006.563,...
"^DD",2006.563,2006.563,6,21,8,0)
rather than in ^MAG(2006.1,...), because the VistA
"^DD",2006.563,2006.563,6,21,9,0)
DICOM Gateway will need to be able to access this
"^DD",2006.563,2006.563,6,21,10,0)
value whether or not the network link with the VistA
"^DD",2006.563,2006.563,6,21,11,0)
system (DDP) is available.
"^DD",2006.563,2006.563,6,"DT")
2991018
"^DD",2006.563,2006.563,7,0)
IMAGE INPUT PATH^F^^IMAGE INPUT PATH;1^K:$L(X)>50!($L(X)<1) X
"^DD",2006.563,2006.563,7,3)
Enter the name of the directory where incoming images are stored.
"^DD",2006.563,2006.563,7,21,0)
^^4^4^3000218^^
"^DD",2006.563,2006.563,7,21,1,0)
The value of this field is the 'path-prefix'
"^DD",2006.563,2006.563,7,21,2,0)
that needs to be applied to gain access to the
"^DD",2006.563,2006.563,7,21,3,0)
files that are being used by the VistA DICOM Image
"^DD",2006.563,2006.563,7,21,4,0)
Gateway for newly created image files.
"^DD",2006.563,2006.563,7,"DT")
2991018
"^DD",2006.563,2006.563,8,0)
IMAGE OUTPUT PATH^F^^IMAGE OUTPUT PATH;1^K:$L(X)>50!($L(X)<1) X
"^DD",2006.563,2006.563,8,3)
Enter the name of the directory where outgoing images are stored.
"^DD",2006.563,2006.563,8,21,0)
^^5^5^3000218^^
"^DD",2006.563,2006.563,8,21,1,0)
The value of this field is the 'path-prefix'
"^DD",2006.563,2006.563,8,21,2,0)
that needs to be applied to gain access to the
"^DD",2006.563,2006.563,8,21,3,0)
files that are being used by the VistA DICOM Image
"^DD",2006.563,2006.563,8,21,4,0)
Gateway for image files that need to be copied
"^DD",2006.563,2006.563,8,21,5,0)
to other destinations.
"^DD",2006.563,2006.563,8,"DT")
2991018
"^DD",2006.563,2006.563,9,0)
MACHINE ID^F^^MACHINE ID;1^K:$L(X)>1!($L(X)<1) X
"^DD",2006.563,2006.563,9,.1)
Machine ID
"^DD",2006.563,2006.563,9,3)
Enter the letter for the current processor.
"^DD",2006.563,2006.563,9,21,0)
^^7^7^3000229^^
"^DD",2006.563,2006.563,9,21,1,0)
The value of this field is a single-character
"^DD",2006.563,2006.563,9,21,2,0)
code that identifies the computer on which this
"^DD",2006.563,2006.563,9,21,3,0)
database is stored.
"^DD",2006.563,2006.563,9,21,4,0)
 
"^DD",2006.563,2006.563,9,21,5,0)
This code will be used as a prefix for names
"^DD",2006.563,2006.563,9,21,6,0)
of image files that are created by the software
"^DD",2006.563,2006.563,9,21,7,0)
that runs on this computer.
"^DD",2006.563,2006.563,9,"DT")
2991018
"^DD",2006.563,2006.563,10,0)
MESSAGE LOG^S^YES:YES;NO:NO;^MESSAGE LOG;1^Q
"^DD",2006.563,2006.563,10,3)
Enter 'YES' or 'NO'.
"^DD",2006.563,2006.563,10,21,0)
^.001^15^15^3001004^^^
"^DD",2006.563,2006.563,10,21,1,0)
The value of this field is a code that indicates
"^DD",2006.563,2006.563,10,21,2,0)
whether or not diagnostic messages will be kept in
"^DD",2006.563,2006.563,10,21,3,0)
a global variable after they have been displayed on
"^DD",2006.563,2006.563,10,21,4,0)
a monitor.
"^DD",2006.563,2006.563,10,21,5,0)
 
"^DD",2006.563,2006.563,10,21,6,0)
Possible values for this code are 'YES' and 'NO'
"^DD",2006.563,2006.563,10,21,7,0)
(fully spelled, in capitals).
"^DD",2006.563,2006.563,10,21,8,0)
 
"^DD",2006.563,2006.563,10,21,9,0)
It is recommended that this value always be set to 'YES'.
"^DD",2006.563,2006.563,10,21,10,0)
 
"^DD",2006.563,2006.563,10,21,11,0)
This value is stored in this table (^MAGDICOM(2006.563,...
"^DD",2006.563,2006.563,10,21,12,0)
rather than in ^MAG(2006.1,...), because the VistA
"^DD",2006.563,2006.563,10,21,13,0)
DICOM Gateway will need to be able to access this
"^DD",2006.563,2006.563,10,21,14,0)
value whether or not the network link with the VistA
"^DD",2006.563,2006.563,10,21,15,0)
system (DDP) is available.
"^DD",2006.563,2006.563,10,"DT")
3001004
"^DD",2006.563,2006.563,11,0)
INSTRUMENT PATH^F^^INSTRUMENT PATH;1^K:$L(X)>50!($L(X)<1) X
"^DD",2006.563,2006.563,11,3)
Enter the name of the directory where the ASCII Text files are stored.
"^DD",2006.563,2006.563,11,21,0)
^^5^5^3000218^^
"^DD",2006.563,2006.563,11,21,1,0)
The value of this field is the 'path-prefix'
"^DD",2006.563,2006.563,11,21,2,0)
that needs to be applied to gain access to the
"^DD",2006.563,2006.563,11,21,3,0)
files that are being used by the VistA DICOM Image
"^DD",2006.563,2006.563,11,21,4,0)
Gateway to store intermediate copies of image files
"^DD",2006.563,2006.563,11,21,5,0)
as they are received by the C-Store program.
"^DD",2006.563,2006.563,11,"DT")
3000218
"^DD",2006.563,2006.563,12,0)
MODALITY WORKLIST^S^YES:YES;NO:NO;^MODALITY WORKLIST;1^Q
"^DD",2006.563,2006.563,12,3)
Enter 'YES' or 'NO'.
"^DD",2006.563,2006.563,12,21,0)
^.001^7^7^3001004^^^^
"^DD",2006.563,2006.563,12,21,1,0)
The value of this field is a code that indicates
"^DD",2006.563,2006.563,12,21,2,0)
whether or not the machine on which this table is
"^DD",2006.563,2006.563,12,21,3,0)
stored will be executing the tasks of a Modality
"^DD",2006.563,2006.563,12,21,4,0)
Worklist Provider.
"^DD",2006.563,2006.563,12,21,5,0)
 
"^DD",2006.563,2006.563,12,21,6,0)
Possible values for this code are 'YES' and 'NO'
"^DD",2006.563,2006.563,12,21,7,0)
(fully spelled, in capitals).
"^DD",2006.563,2006.563,12,"DT")
3001004
"^DD",2006.563,2006.563,13,0)
PACS IMAGES^S^YES:YES;NO:NO;^PACS IMAGES;1^Q
"^DD",2006.563,2006.563,13,3)
Enter 'YES' or 'NO'.
"^DD",2006.563,2006.563,13,21,0)
^.001^12^12^3001004^^^
"^DD",2006.563,2006.563,13,21,1,0)
The value of this field is a code that indicates
"^DD",2006.563,2006.563,13,21,2,0)
whether or not a PACS will be sending images to
"^DD",2006.563,2006.563,13,21,3,0)
the VistA Hospital Information System.
"^DD",2006.563,2006.563,13,21,4,0)
 
"^DD",2006.563,2006.563,13,21,5,0)
Possible values for this code are 'YES' and 'NO'
"^DD",2006.563,2006.563,13,21,6,0)
(fully spelled, in capitals).
"^DD",2006.563,2006.563,13,21,7,0)
 
"^DD",2006.563,2006.563,13,21,8,0)
This value is stored in this table (^MAGDICOM(2006.563,...
"^DD",2006.563,2006.563,13,21,9,0)
rather than in ^MAG(2006.1,...), because the VistA
"^DD",2006.563,2006.563,13,21,10,0)
DICOM Gateway will need to be able to access this
"^DD",2006.563,2006.563,13,21,11,0)
value whether or not the network link with the VistA
"^DD",2006.563,2006.563,13,21,12,0)
system (DDP) is available.
"^DD",2006.563,2006.563,13,"DT")
3001004
"^DD",2006.563,2006.563,14,0)
ROUTING RULES^S^YES:YES;NO:NO;^ROUTING RULES;1^Q
"^DD",2006.563,2006.563,14,3)
Enter 'YES' or 'NO'.
"^DD",2006.563,2006.563,14,21,0)
^.001^19^19^3021209^^^^
"^DD",2006.563,2006.563,14,21,1,0)
The value of this field is a code that indicates
"^DD",2006.563,2006.563,14,21,2,0)
whether or not the site where this table is stored
"^DD",2006.563,2006.563,14,21,3,0)
is using the automated routing facility that is part
"^DD",2006.563,2006.563,14,21,4,0)
of the VistA DICOM Gateway.
"^DD",2006.563,2006.563,14,21,5,0)
 
"^DD",2006.563,2006.563,14,21,6,0)
Automated routing is not included in Version 2.5
"^DD",2006.563,2006.563,14,21,7,0)
of the VistA DICOM Gateway and only sites that are
"^DD",2006.563,2006.563,14,21,8,0)
executing an pre-alpha test of this functionality
"^DD",2006.563,2006.563,14,21,9,0)
should set this parameter to YES.
"^DD",2006.563,2006.563,14,21,10,0)
All other sites should set this parameter to NO.
"^DD",2006.563,2006.563,14,21,11,0)
 
"^DD",2006.563,2006.563,14,21,12,0)
Possible values for this code are 'YES' and 'NO'
"^DD",2006.563,2006.563,14,21,13,0)
(fully spelled, in capitals).
"^DD",2006.563,2006.563,14,21,14,0)
 
"^DD",2006.563,2006.563,14,21,15,0)
This value is stored in this table (^MAGDICOM(2006.563,...
"^DD",2006.563,2006.563,14,21,16,0)
rather than in ^MAG(2006.1,...), because the VistA
"^DD",2006.563,2006.563,14,21,17,0)
DICOM Gateway will need to be able to access this
"^DD",2006.563,2006.563,14,21,18,0)
value whether or not the network link with the VistA
"^DD",2006.563,2006.563,14,21,19,0)
system (DDP) is available.
"^DD",2006.563,2006.563,14,"DT")
3021209
"^DD",2006.563,2006.563,15,0)
SCRATCH^F^^SCRATCH;1^K:$L(X)>50!($L(X)<1) X
"^DD",2006.563,2006.563,15,3)
Enter the name of the directory where scratch files may be stored.
"^DD",2006.563,2006.563,15,21,0)
^^7^7^3000218^^
"^DD",2006.563,2006.563,15,21,1,0)
The value of this field is the 'path-prefix'
"^DD",2006.563,2006.563,15,21,2,0)
that needs to be applied to gain access to the
"^DD",2006.563,2006.563,15,21,3,0)
temporary files that are used by the VistA DICOM
"^DD",2006.563,2006.563,15,21,4,0)
Gateway.
"^DD",2006.563,2006.563,15,21,5,0)
 
"^DD",2006.563,2006.563,15,21,6,0)
Typically, the value of this field will be equal to
"^DD",2006.563,2006.563,15,21,7,0)
c:\temp\
"^DD",2006.563,2006.563,15,"DT")
2991018
"^DD",2006.563,2006.563,16,0)
SEND PACS TEXT^S^YES:YES;NO:NO;^SEND PACS TEXT;1^Q
"^DD",2006.563,2006.563,16,3)
Enter 'YES' or 'NO'.
"^DD",2006.563,2006.563,16,21,0)
^.001^7^7^3001004^^^
"^DD",2006.563,2006.563,16,21,1,0)
The value of this field is a code that indicates
"^DD",2006.563,2006.563,16,21,2,0)
whether or not the VistA DICOM Gateway computer
"^DD",2006.563,2006.563,16,21,3,0)
on which this table is stored will be transmitting
"^DD",2006.563,2006.563,16,21,4,0)
text messages to a PACS.
"^DD",2006.563,2006.563,16,21,5,0)
 
"^DD",2006.563,2006.563,16,21,6,0)
Possible values for this code are 'YES' and 'NO'
"^DD",2006.563,2006.563,16,21,7,0)
(fully spelled, in capitals).
"^DD",2006.563,2006.563,16,"DT")
3001004
"^DD",2006.563,2006.563,17,0)
LOCATION^P4'^DIC(4,^LOCATION;1^Q
"^DD",2006.563,2006.563,17,3)
Select the institution where this gateway resides.
"^DD",2006.563,2006.563,17,21,0)
^.001^2^2^3100702^^^^
"^DD",2006.563,2006.563,17,21,1,0)
This is the institution where this DICOM Gateway
"^DD",2006.563,2006.563,17,21,2,0)
computer resides.
"^DD",2006.563,2006.563,17,"DT")
3100702
"^DD",2006.563,2006.563,18,0)
UID ROOT^F^^UID ROOT;1^K:$L(X)>64!($L(X)<1) X
"^DD",2006.563,2006.563,18,3)
Enter the UID root for this installation.
"^DD",2006.563,2006.563,18,21,0)
^^14^14^3000218^^
"^DD",2006.563,2006.563,18,21,1,0)
The value of this field is a code that identifies
"^DD",2006.563,2006.563,18,21,2,0)
the 'root' for unique identifiers that are
"^DD",2006.563,2006.563,18,21,3,0)
created for the purpose of uniquely identifying
"^DD",2006.563,2006.563,18,21,4,0)
DICOM objects.
"^DD",2006.563,2006.563,18,21,5,0)
 
"^DD",2006.563,2006.563,18,21,6,0)
This value has been assigned to the Veterans Administration
"^DD",2006.563,2006.563,18,21,7,0)
by the American National Standards Institute and
"^DD",2006.563,2006.563,18,21,8,0)
may not be changed by any site.
"^DD",2006.563,2006.563,18,21,9,0)
 
"^DD",2006.563,2006.563,18,21,10,0)
This value is stored in this table (^MAGDICOM(2006.563,...
"^DD",2006.563,2006.563,18,21,11,0)
rather than in ^MAG(2006.1,...), because the VistA
"^DD",2006.563,2006.563,18,21,12,0)
DICOM Gateway will need to be able to access this
"^DD",2006.563,2006.563,18,21,13,0)
value whether or not the network link with the VistA
"^DD",2006.563,2006.563,18,21,14,0)
system (DDP) is available.
"^DD",2006.563,2006.563,18,"DT")
2991018
"^DD",2006.563,2006.563,19,0)
VERSION^F^^VERSION;1^K:$L(X)>64!($L(X)<1) X
"^DD",2006.563,2006.563,19,3)
Answer must be 1-64 characters in length.
"^DD",2006.563,2006.563,19,21,0)
^^11^11^3000218^^
"^DD",2006.563,2006.563,19,21,1,0)
The value of this field is a code that identifies
"^DD",2006.563,2006.563,19,21,2,0)
the version of the implementation of the VA DICOM
"^DD",2006.563,2006.563,19,21,3,0)
SOP Classes.
"^DD",2006.563,2006.563,19,21,4,0)
 
"^DD",2006.563,2006.563,19,21,5,0)
This value should not be modified by any sites.
"^DD",2006.563,2006.563,19,21,6,0)
 
"^DD",2006.563,2006.563,19,21,7,0)
This value is stored in this table (^MAGDICOM(2006.563,...
"^DD",2006.563,2006.563,19,21,8,0)
rather than in ^MAG(2006.1,...), because the VistA
"^DD",2006.563,2006.563,19,21,9,0)
DICOM Gateway will need to be able to access this
"^DD",2006.563,2006.563,19,21,10,0)
value whether or not the network link with the VistA
"^DD",2006.563,2006.563,19,21,11,0)
system (DDP) is available.
"^DD",2006.563,2006.563,19,"DT")
2991018
"^DD",2006.563,2006.563,20,0)
HL7 POINTER^P2006.5'^MAGDHL7(2006.5,^HL7_PTR;1^Q
"^DD",2006.563,2006.563,20,3)
Enter the internal entry number of a HL7 message.
"^DD",2006.563,2006.563,20,21,0)
^^11^11^3000218^^
"^DD",2006.563,2006.563,20,21,1,0)
The value of this field is a pointer to the table that
"^DD",2006.563,2006.563,20,21,2,0)
contains the HL7-messages that are to be processed by
"^DD",2006.563,2006.563,20,21,3,0)
a VistA DICOM Text Gateway.
"^DD",2006.563,2006.563,20,21,4,0)
This value corresponds to the internal entry number
"^DD",2006.563,2006.563,20,21,5,0)
of the last message that was processed.
"^DD",2006.563,2006.563,20,21,6,0)
 
"^DD",2006.563,2006.563,20,21,7,0)
This value is stored in this table (^MAGDICOM(2006.563,...
"^DD",2006.563,2006.563,20,21,8,0)
rather than in ^MAG(2006.1,...), because the VistA
"^DD",2006.563,2006.563,20,21,9,0)
DICOM Gateway will need to be able to access this
"^DD",2006.563,2006.563,20,21,10,0)
value whether or not the network link with the VistA
"^DD",2006.563,2006.563,20,21,11,0)
system (DDP) is available.
"^DD",2006.563,2006.563,20,"DT")
3000222
"^DD",2006.563,2006.563,21,0)
FREE DISK SPACE^NJ3,0^^FREE DISK SPACE;1^K:+X'=X!(X>100)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.563,2006.563,21,3)
Enter the percentage of free disk space required to allow C-Store.
"^DD",2006.563,2006.563,21,21,0)
^^5^5^3000218^^
"^DD",2006.563,2006.563,21,21,1,0)
The value of this field is an integer number that
"^DD",2006.563,2006.563,21,21,2,0)
indicates the percentage of disk space that needs to
"^DD",2006.563,2006.563,21,21,3,0)
be left as free space. The acquisition of image files
"^DD",2006.563,2006.563,21,21,4,0)
will be suspended when the amount of free disk space
"^DD",2006.563,2006.563,21,21,5,0)
drops below this threshold.
"^DD",2006.563,2006.563,21,"DT")
2991020
"^DD",2006.563,2006.563,22,0)
TEXT GATEWAY^S^YES:YES;NO:NO;^TEXT GATEWAY;1^Q
"^DD",2006.563,2006.563,22,3)
Enter 'YES' or 'NO'.
"^DD",2006.563,2006.563,22,21,0)
^.001^6^6^3001004^^^
"^DD",2006.563,2006.563,22,21,1,0)
The value of this field is a code that indicates
"^DD",2006.563,2006.563,22,21,2,0)
whether or not the computer on which this table
"^DD",2006.563,2006.563,22,21,3,0)
is stored will operate as a Text Gateway.
"^DD",2006.563,2006.563,22,21,4,0)
 
"^DD",2006.563,2006.563,22,21,5,0)
Possible values for this code are 'YES' and 'NO'
"^DD",2006.563,2006.563,22,21,6,0)
(fully spelled, in capitals).
"^DD",2006.563,2006.563,22,"DT")
3001004
"^DD",2006.563,2006.563,23,0)
LAST SYSTEM REPORT^NJ7,0^^DAILY REPORT;1^K:+X'=X!(X>9999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",2006.563,2006.563,23,3)
Enter the $HOROLOG number of the date of the last site report.
"^DD",2006.563,2006.563,23,21,0)
^^7^7^3001004^^
"^DD",2006.563,2006.563,23,21,1,0)
The value of this field is a code for the date on which
"^DD",2006.563,2006.563,23,21,2,0)
the most recent system report was e-mailed to the VistA
"^DD",2006.563,2006.563,23,21,3,0)
central repository.
"^DD",2006.563,2006.563,23,21,4,0)
This value is encoded as a $HOROLOG date.
"^DD",2006.563,2006.563,23,21,5,0)
This value is calculated by the application as the
"^DD",2006.563,2006.563,23,21,6,0)
report in question is being produced, and never entered
"^DD",2006.563,2006.563,23,21,7,0)
by an end-user.
"^DD",2006.563,2006.563,23,"DT")
3000222
"^DD",2006.563,2006.563,24,0)
POST OFFICE^F^^POST OFFICE;1^K:$L(X)>64!($L(X)<1) X
"^DD",2006.563,2006.563,24,3)
Enter the IP address of the SMTP post office for this site.
"^DD",2006.563,2006.563,24,21,0)
^^9^9^3000218^^
"^DD",2006.563,2006.563,24,21,1,0)
The value of this field is the IP address of the
"^DD",2006.563,2006.563,24,21,2,0)
computer that will function as the SMTP post office
"^DD",2006.563,2006.563,24,21,3,0)
for sending e-mail from this site.
"^DD",2006.563,2006.563,24,21,4,0)
 
"^DD",2006.563,2006.563,24,21,5,0)
This value is stored in this table (^MAGDICOM(2006.563,...
"^DD",2006.563,2006.563,24,21,6,0)
rather than in ^MAG(2006.1,...), because the VistA
"^DD",2006.563,2006.563,24,21,7,0)
DICOM Gateway will need to be able to access this
"^DD",2006.563,2006.563,24,21,8,0)
value whether or not the network link with the VistA
"^DD",2006.563,2006.563,24,21,9,0)
system (DDP) is available.
"^DD",2006.563,2006.563,24,"DT")
3000222
"^DD",2006.563,2006.563,25,0)
CONSOLIDATED IMAGING SOFTWARE^S^YES:Consolidated;NO:Non-Consolidated;^CONSOLIDATED;1^Q
"^DD",2006.563,2006.563,25,3)
Indicate whether or not this site is running the consolidated Imaging software.
"^DD",2006.563,2006.563,25,21,0)
^^6^6^3021212^
"^DD",2006.563,2006.563,25,21,1,0)
The value of this field is a code that indicates whether or not
"^DD",2006.563,2006.563,25,21,2,0)
the current site is running the consolidated version of the Imaging
"^DD",2006.563,2006.563,25,21,3,0)
software.
"^DD",2006.563,2006.563,25,21,4,0)
 
"^DD",2006.563,2006.563,25,21,5,0)
A value of "YES" indicates that the consolidated software is in use.
"^DD",2006.563,2006.563,25,21,6,0)
A value of "NO" indicates that the non-consolidated software is in use.
"^DD",2006.563,2006.563,25,"DT")
3021212
"^DD",2006.563,2006.563,26,0)
CPT MODIFIER^S^YES:YES;NO:NO;^SEND CPT MODIFIERS;1^Q
"^DD",2006.563,2006.563,26,3)
Indicate whether or not this computer will include CPT modifier codes in messages.
"^DD",2006.563,2006.563,26,21,0)
^^7^7^3000218^^
"^DD",2006.563,2006.563,26,21,1,0)
The value of this field is a code that indicates
"^DD",2006.563,2006.563,26,21,2,0)
whether or not CPT modifier codes will be included in
"^DD",2006.563,2006.563,26,21,3,0)
messages that are transmitted by the computer on which
"^DD",2006.563,2006.563,26,21,4,0)
this table is stored.
"^DD",2006.563,2006.563,26,21,5,0)
 
"^DD",2006.563,2006.563,26,21,6,0)
Possible values for this code are 'YES' and 'NO'
"^DD",2006.563,2006.563,26,21,7,0)
(fully spelled, in capitals).
"^DD",2006.563,2006.563,26,"DT")
3000222
"^DD",2006.563,2006.563,27,0)
TIME ZONE OFFSET^NJ4,0^^TIME ZONE;1^K:+X'=X!(X>2500)!(X<-2500)!(X?.E1"."1N.N) X
"^DD",2006.563,2006.563,27,3)
Enter the ISO code for the time zone offset for this computer.
"^DD",2006.563,2006.563,27,21,0)
^^17^17^3000218^^
"^DD",2006.563,2006.563,27,21,1,0)
The value of this field is an integer number that
"^DD",2006.563,2006.563,27,21,2,0)
indicates the time zone offset for the computer on
"^DD",2006.563,2006.563,27,21,3,0)
which this table is stored.
"^DD",2006.563,2006.563,27,21,4,0)
 
"^DD",2006.563,2006.563,27,21,5,0)
The time zone offset is encoded as 100*hours+minutes,
"^DD",2006.563,2006.563,27,21,6,0)
and is a positive number when the time is later than
"^DD",2006.563,2006.563,27,21,7,0)
GMT (Greenwich Mean Time), or a negative number when
"^DD",2006.563,2006.563,27,21,8,0)
the time is earlier than GMT.
"^DD",2006.563,2006.563,27,21,9,0)
 
"^DD",2006.563,2006.563,27,21,10,0)
E.g. EST in the USA corresponds to a time zone offset
"^DD",2006.563,2006.563,27,21,11,0)
of -500.
"^DD",2006.563,2006.563,27,21,12,0)
 
"^DD",2006.563,2006.563,27,21,13,0)
This value is stored in this table (^MAGDICOM(2006.563,...
"^DD",2006.563,2006.563,27,21,14,0)
rather than in ^MAG(2006.1,...), because the VistA
"^DD",2006.563,2006.563,27,21,15,0)
DICOM Gateway will need to be able to access this
"^DD",2006.563,2006.563,27,21,16,0)
value whether or not the network link with the VistA
"^DD",2006.563,2006.563,27,21,17,0)
system (DDP) is available.
"^DD",2006.563,2006.563,27,"DT")
3000222
"^DD",2006.563,2006.563,28,0)
LOCATION NAME^F^^LOCATION NAME;1^K:$L(X)>30!($L(X)<1) X
"^DD",2006.563,2006.563,28,3)
Enter the name of the location to which this station belongs.
"^DD",2006.563,2006.563,28,21,0)
^.001^7^7^3100702^^
"^DD",2006.563,2006.563,28,21,1,0)
The value of this field is a string that represents the name
"^DD",2006.563,2006.563,28,21,2,0)
of a site. Its value is copied from the INSTITUTION file when
"^DD",2006.563,2006.563,28,21,3,0)
a value is assigned to the field LOCATION in this table.
"^DD",2006.563,2006.563,28,21,4,0)
 
"^DD",2006.563,2006.563,28,21,5,0)
A DICOM Gateway stores a redundant copy of this name, so that
"^DD",2006.563,2006.563,28,21,6,0)
it will be able to display the name when DDP is not available,
"^DD",2006.563,2006.563,28,21,7,0)
and the value cannot be fetched from ^DIC.
"^DD",2006.563,2006.563,28,"DT")
3011016
"^DD",2006.563,2006.563,29,0)
ACCESS CODE^F^^LOGIN ACCESS;1^K:$L(X)>30!($L(X)<1) X
"^DD",2006.563,2006.563,29,3)
Enter the access code for this gateway.
"^DD",2006.563,2006.563,29,21,0)
^^2^2^3010226^
"^DD",2006.563,2006.563,29,21,1,0)
The value of this field is a string that represents the access code that will be used
"^DD",2006.563,2006.563,29,21,2,0)
to operate this DICOM Gateway.
"^DD",2006.563,2006.563,29,"DT")
3010226
"^DD",2006.563,2006.563,30,0)
VERIFY CODE^F^^LOGIN VERIFY;1^K:$L(X)>30!($L(X)<1) X
"^DD",2006.563,2006.563,30,3)
Enter the verify code for this gateway.
"^DD",2006.563,2006.563,30,21,0)
^^2^2^3010226^
"^DD",2006.563,2006.563,30,21,1,0)
The value of this field is a string that represents the verify
"^DD",2006.563,2006.563,30,21,2,0)
code that will be used to operate this DICOM Gateway.
"^DD",2006.563,2006.563,30,"DT")
3010226
"^DD",2006.563,2006.563,31,0)
READ ONLY ACCESS^F^^LOGIN PRINT/VIEW ONLY;1^K:$L(X)>30!($L(X)<1) X
"^DD",2006.563,2006.563,31,3)
Enter the read-only access code for this gateway.
"^DD",2006.563,2006.563,31,21,0)
^^2^2^3010226^
"^DD",2006.563,2006.563,31,21,1,0)
The value of this field is a string that represents the access
"^DD",2006.563,2006.563,31,21,2,0)
code that will be used to operate this gateway in "read only" mode.
"^DD",2006.563,2006.563,31,"DT")
3010226
"^DD",2006.563,2006.563,32,0)
PROGRAMMER ACCESS^F^^LOGIN PROGRAMMER ACCESS;1^K:$L(X)>30!($L(X)<1) X
"^DD",2006.563,2006.563,32,3)
Enter the programmer access code for this gateway.
"^DD",2006.563,2006.563,32,21,0)
^^2^2^3010226^
"^DD",2006.563,2006.563,32,21,1,0)
The value of this field is a string that represents the access
"^DD",2006.563,2006.563,32,21,2,0)
code that will be used to gain programmer access to this gateway.
"^DD",2006.563,2006.563,32,"DT")
3010226
"^DD",2006.563,2006.563,33,0)
EVALUATOR^S^0:No;1:Yes;^EVAL;1^Q
"^DD",2006.563,2006.563,33,3)
Indicate whether a Rule Evaluator may currently run on this computer.
"^DD",2006.563,2006.563,33,21,0)
^^7^7^3020809^
"^DD",2006.563,2006.563,33,21,1,0)
The value of this field is a code that indicates whether or not
"^DD",2006.563,2006.563,33,21,2,0)
a Rule Evaluator may currently run on this computer.
"^DD",2006.563,2006.563,33,21,3,0)
 
"^DD",2006.563,2006.563,33,21,4,0)
This flag is automatically set to 1 (yes) when the menu option
"^DD",2006.563,2006.563,33,21,5,0)
is used to start a Rule Evaluator, and to 0 (no) when the
"^DD",2006.563,2006.563,33,21,6,0)
menu option is used to stop all Rule Evaluators.
"^DD",2006.563,2006.563,33,21,7,0)
 
"^DD",2006.563,2006.563,33,"DT")
3020809
"^DD",2006.563,2006.563,34,0)
CSTORE CONTROL PORT^NJ5,0^^CSTORE CONTROL PORT;1^K:+X'=X!(X>65535)!(X<1)!(X?.E1"."1N.N) X
"^DD",2006.563,2006.563,34,3)
Enter a TCP/IP port number (between 1 and 65535).
"^DD",2006.563,2006.563,34,21,0)
^.001^6^6^3020828^^
"^DD",2006.563,2006.563,34,21,1,0)
The value of this field is an integer number that identifies
"^DD",2006.563,2006.563,34,21,2,0)
the TCP/IP port that will be used by each C-Store process to
"^DD",2006.563,2006.563,34,21,3,0)
obtain information from a DICOM Gateway.
"^DD",2006.563,2006.563,34,21,4,0)
 
"^DD",2006.563,2006.563,34,21,5,0)
The information provided is limited to known "modalities" and
"^DD",2006.563,2006.563,34,21,6,0)
which port numbers are assigned to these modalities.
"^DD",2006.563,2006.563,34,"DT")
3020828
"^DD",2006.563,2006.563,35,0)
WORKLIST PORT^NJ5,0^^WORKLIST PORT;1^K:+X'=X!(X>65535)!(X<1)!(X?.E1"."1N.N) X
"^DD",2006.563,2006.563,35,3)
Enter a TCP/IP port number (between 1 and 65535).
"^DD",2006.563,2006.563,35,21,0)
^^3^3^3020828^
"^DD",2006.563,2006.563,35,21,1,0)
The value of this field is an integer number that identifies
"^DD",2006.563,2006.563,35,21,2,0)
the TCP/IP port that will be used by DICOM WorkList processes
"^DD",2006.563,2006.563,35,21,3,0)
to post their requests and obtain their results.
"^DD",2006.563,2006.563,35,"DT")
3020828
"^DD",2006.563,2006.563,36,0)
VISTA RPC PORT^NJ5,0^^M-to-M BROKER PORT;1^K:+X'=X!(X>65535)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.563,2006.563,36,3)
Enter the port number for the MUMPS-to-MUMPS broker on the VistA system
"^DD",2006.563,2006.563,36,21,0)
^.001^3^3^3021107^^
"^DD",2006.563,2006.563,36,21,1,0)
The value of this field is an integer number between 0 and
"^DD",2006.563,2006.563,36,21,2,0)
65,535 that identifies the port number on which a
"^DD",2006.563,2006.563,36,21,3,0)
(MUMPS-to-MUMPS) RPC broker is "listening" on the VistA system.
"^DD",2006.563,2006.563,36,"DT")
3021002
"^DD",2006.563,2006.563,37,0)
VISTA RPC IP ADDRESS^F^^M-to-M BROKER ADDR;1^K:$L(X)>63!($L(X)<1) X
"^DD",2006.563,2006.563,37,3)
Enter the IP address of the VistA system.
"^DD",2006.563,2006.563,37,21,0)
^^3^3^3021002^
"^DD",2006.563,2006.563,37,21,1,0)
The value of this field is a string that identifies the IP address
"^DD",2006.563,2006.563,37,21,2,0)
of the VistA system. This IP address is used to establish
"^DD",2006.563,2006.563,37,21,3,0)
a MUMPS-to-MUMPS RPC broker connection.
"^DD",2006.563,2006.563,37,"DT")
3021002
"^DD",2006.563,2006.563,38,0)
PROFILE^2006.5632A^^PROFILE;0
"^DD",2006.563,2006.563,40,0)
MAILGROUP^F^^MAILGROUP;1^K:$L(X)>240!($L(X)<5) X
"^DD",2006.563,2006.563,40,3)
Enter the name of a mailgroup for emergency messages.
"^DD",2006.563,2006.563,40,21,0)
^^6^6^3021118^
"^DD",2006.563,2006.563,40,21,1,0)
The value of this field is a string that identifies a (SMTP) mailgroup.
"^DD",2006.563,2006.563,40,21,2,0)
When emergencies arise, a DICOM Gateway will send an e-mail message
"^DD",2006.563,2006.563,40,21,3,0)
to this mailgroup.
"^DD",2006.563,2006.563,40,21,4,0)
Since the emergency might be that the connection with the VistA system
"^DD",2006.563,2006.563,40,21,5,0)
is temporarily not available, such messages are sent by SMTP mail,
"^DD",2006.563,2006.563,40,21,6,0)
not by FORUM mail.
"^DD",2006.563,2006.563,40,"DT")
3021118
"^DD",2006.563,2006.563,46,0)
DELAY FOR C-MOVE TO EMED^NJ5,0^^EMED_C_MOVE_DELAY;1^K:+X'=X!(X>36000)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.563,2006.563,46,3)
Enter the waiting time (seconds) before a C-Move to an E-Med may occur.
"^DD",2006.563,2006.563,46,21,0)
^^4^4^3021212^
"^DD",2006.563,2006.563,46,21,1,0)
The value of this field is an integer number. This number indicates
"^DD",2006.563,2006.563,46,21,2,0)
the waiting time (in seconds) that has to elapse between the
"^DD",2006.563,2006.563,46,21,3,0)
acquisition of an image and the time when this image may be
"^DD",2006.563,2006.563,46,21,4,0)
relayed on to an E-Med picture archival system.
"^DD",2006.563,2006.563,46,"DT")
3021212
"^DD",2006.563,2006.563,47,0)
LAST IMAGE POINTER^P2005'^MAG(2005,^LAST IMAGE POINTER;1^Q
"^DD",2006.563,2006.563,47,3)
Indicate the highest-numbered image processed.
"^DD",2006.563,2006.563,47,21,0)
^^10^10^3021212^^
"^DD",2006.563,2006.563,47,21,1,0)
The value of this field is a pointer to the Image File (#2005).
"^DD",2006.563,2006.563,47,21,2,0)
The pointed-to image is the one with the highest IEN that has
"^DD",2006.563,2006.563,47,21,3,0)
been processed by a DICOM Gateway.
"^DD",2006.563,2006.563,47,21,4,0)
 
"^DD",2006.563,2006.563,47,21,5,0)
This value is being tracked for patient-safety reasons.
"^DD",2006.563,2006.563,47,21,6,0)
 
"^DD",2006.563,2006.563,47,21,7,0)
At a number of sites it has happened that procedural mistakes during
"^DD",2006.563,2006.563,47,21,8,0)
normal maintenance caused part of the Image File to "disappear".
"^DD",2006.563,2006.563,47,21,9,0)
Keeping track of this highest IEN allows the imaging software to
"^DD",2006.563,2006.563,47,21,10,0)
cause a "controlled shut-down" when such a situation occurs.
"^DD",2006.563,2006.563,47,"DT")
3021212
"^DD",2006.563,2006.563,48,0)
LAST RAD REPORT POINTER^P74'^RARPT(^LAST RAD REPORT POINTER;1^Q
"^DD",2006.563,2006.563,48,3)
Indicate the highest numbered Radiology Report processed.
"^DD",2006.563,2006.563,48,21,0)
^^10^10^3021212^^
"^DD",2006.563,2006.563,48,21,1,0)
The value of this field is a pointer to the Rad/Nuc Report File (#74).
"^DD",2006.563,2006.563,48,21,2,0)
The pointed-to report is the one with the highest IEN that has
"^DD",2006.563,2006.563,48,21,3,0)
been processed by a DICOM Gateway.
"^DD",2006.563,2006.563,48,21,4,0)
 
"^DD",2006.563,2006.563,48,21,5,0)
This value is being tracked for patient-safety reasons.
"^DD",2006.563,2006.563,48,21,6,0)
 
"^DD",2006.563,2006.563,48,21,7,0)
At a number of sites it has happened that procedural mistakes during
"^DD",2006.563,2006.563,48,21,8,0)
normal maintenance caused part of the Rad/Nuc Report to "disappear".
"^DD",2006.563,2006.563,48,21,9,0)
Keeping track of this highest IEN allows the imaging software to
"^DD",2006.563,2006.563,48,21,10,0)
cause a "controlled shut-down" when such a situation occurs.
"^DD",2006.563,2006.563,48,"DT")
3021212
"^DD",2006.563,2006.563,49,0)
SUPPORT ACCESS^F^^LOGIN SUPPORT;1^K:$L(X)>30!($L(X)<1) X
"^DD",2006.563,2006.563,49,3)
Enter the code that allows support staff local access to a DICOM Gateway.
"^DD",2006.563,2006.563,49,21,0)
^^2^2^3021212^^
"^DD",2006.563,2006.563,49,21,1,0)
The value of this field is a string that represents the access
"^DD",2006.563,2006.563,49,21,2,0)
code that will be used to gain 'support staff' access to this gateway.
"^DD",2006.563,2006.563,49,"DT")
3021212
"^DD",2006.563,2006.563,50,0)
ET PHONES HOME^S^YES:Yes;NO:No;^MAGDBB;1^Q
"^DD",2006.563,2006.563,50,3)
Indicate whether or not the ET-Phone Home service will be active.
"^DD",2006.563,2006.563,50,21,0)
^^8^8^3021212^
"^DD",2006.563,2006.563,50,21,1,0)
The value of this field is a code that indicates whether or
"^DD",2006.563,2006.563,50,21,2,0)
not the "ET-Phone Home" feature will be enabled.
"^DD",2006.563,2006.563,50,21,3,0)
 
"^DD",2006.563,2006.563,50,21,4,0)
When the value of this field is equal to "YES", the DICOM Gateway
"^DD",2006.563,2006.563,50,21,5,0)
will send a report to the support-organization in Silver Spring
"^DD",2006.563,2006.563,50,21,6,0)
each day. This report includes a summary of the entries in the
"^DD",2006.563,2006.563,50,21,7,0)
error trap, information of site-specific parameters and station-specific
"^DD",2006.563,2006.563,50,21,8,0)
parameters, checksums of routines, and usage statistics.
"^DD",2006.563,2006.563,50,"DT")
3021212
"^DD",2006.563,2006.563,51,0)
M-to-M BROKER MESSAGES^S^YES:Yes;NO:No;^M-to-M BROKER MSGS;1^Q
"^DD",2006.563,2006.563,51,3)
Indicate whether or not messages about the M-to-M broker will be logged.
"^DD",2006.563,2006.563,51,21,0)
^^6^6^3021212^
"^DD",2006.563,2006.563,51,21,1,0)
The value of this field is a code that indicates whether or not
"^DD",2006.563,2006.563,51,21,2,0)
messages will be logged that report on the usage of the MUMPS-to-MUMPS
"^DD",2006.563,2006.563,51,21,3,0)
RPC Broker.
"^DD",2006.563,2006.563,51,21,4,0)
 
"^DD",2006.563,2006.563,51,21,5,0)
When the value of this field is equal to "YES", such
"^DD",2006.563,2006.563,51,21,6,0)
messages will be logged.
"^DD",2006.563,2006.563,51,"DT")
3021212
"^DD",2006.563,2006.563,52,0)
PACS EXAM COMPLETE^S^YES:Yes;NO:No;^PACS EXAM COMPLETE;1^Q
"^DD",2006.563,2006.563,52,3)
Indicate whether or not a PACS will be sending Exam Complete messages.
"^DD",2006.563,2006.563,52,21,0)
^^6^6^3021212^
"^DD",2006.563,2006.563,52,21,1,0)
The value of this field is a code that indicates whether or not
"^DD",2006.563,2006.563,52,21,2,0)
this DICOM Gateway will be receiving "Exam Complete" messages
"^DD",2006.563,2006.563,52,21,3,0)
from a PACS.
"^DD",2006.563,2006.563,52,21,4,0)
 
"^DD",2006.563,2006.563,52,21,5,0)
When the value of this field is "YES", such messages will be
"^DD",2006.563,2006.563,52,21,6,0)
processed.
"^DD",2006.563,2006.563,52,"DT")
3021212
"^DD",2006.563,2006.563,54,0)
STOP ROUTING TRANSMITTER^S^1:Stop;0:Run;^ROUTE AQ EXIT;1^Q
"^DD",2006.563,2006.563,54,3)
Indicate whether routing transmitters may run.
"^DD",2006.563,2006.563,54,21,0)
^^13^13^3021212^
"^DD",2006.563,2006.563,54,21,1,0)
The value of this field is a code that indicates whether or not
"^DD",2006.563,2006.563,54,21,2,0)
routing transmitters are currently allowed to run on a suite
"^DD",2006.563,2006.563,54,21,3,0)
of DICOM Gateways.
"^DD",2006.563,2006.563,54,21,4,0)
 
"^DD",2006.563,2006.563,54,21,5,0)
When a routing transmitter process is started, the value of this
"^DD",2006.563,2006.563,54,21,6,0)
field is set to 0 (run).
"^DD",2006.563,2006.563,54,21,7,0)
 
"^DD",2006.563,2006.563,54,21,8,0)
When the menu option "Stop Transmission Processors" is executed,
"^DD",2006.563,2006.563,54,21,9,0)
the value of this field is set to 1 (Stop).
"^DD",2006.563,2006.563,54,21,10,0)
 
"^DD",2006.563,2006.563,54,21,11,0)
The software of the transmission processor checks this value to
"^DD",2006.563,2006.563,54,21,12,0)
determine whether to stop gracefully, or to continue transmitting
"^DD",2006.563,2006.563,54,21,13,0)
the next file.
"^DD",2006.563,2006.563,54,"DT")
3021212
"^DD",2006.563,2006.563,55,0)
DASHES IN SSN FOR PACS^S^YES:Include dashes;NO:Omit dashes;^SSN DASHES FOR PACS;1^Q
"^DD",2006.563,2006.563,55,3)
Indicate whether or not the PACS wants dashes in SSNs.
"^DD",2006.563,2006.563,55,21,0)
^^8^8^3021212^
"^DD",2006.563,2006.563,55,21,1,0)
The value of this field is a code that indicates whether or not
"^DD",2006.563,2006.563,55,21,2,0)
the PACS (Picture Archival and Communication System) that
"^DD",2006.563,2006.563,55,21,3,0)
is connected to this DICOM Gateway requires that SSNs are
"^DD",2006.563,2006.563,55,21,4,0)
transmitted with dashes included or not.
"^DD",2006.563,2006.563,55,21,5,0)
 
"^DD",2006.563,2006.563,55,21,6,0)
When the value of this field is equal to "YES", SSNs will be
"^DD",2006.563,2006.563,55,21,7,0)
transmitted to this PACS with dashed included; otherwise the
"^DD",2006.563,2006.563,55,21,8,0)
dashes will be omitted.
"^DD",2006.563,2006.563,55,"DT")
3021212
"^DD",2006.563,2006.563,56,0)
INSTALLATION^2006.5634A^^INSTALL;0
"^DD",2006.563,2006.563,56,"DT")
3021212
"^DD",2006.563,2006.563,58,0)
LAST CONFIGURATION CHANGE^D^^CONFIG DATE/TIME;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",2006.563,2006.563,58,3)
Enter the date and time the configuration was last changed.
"^DD",2006.563,2006.563,58,21,0)
^^3^3^3040303^
"^DD",2006.563,2006.563,58,21,1,0)
The value of this field is a timestamp (VA-FileMan format)
"^DD",2006.563,2006.563,58,21,2,0)
that indicates the date and time when the most recent configuration
"^DD",2006.563,2006.563,58,21,3,0)
update occurred on this DICOM Gateway.
"^DD",2006.563,2006.563,58,"DT")
3040303
"^DD",2006.563,2006.563,59,0)
DICOM TRANSMITTER ACTIVE^S^RUN:Running;STOP:Inactive;^DICOM XMIT;1^Q
"^DD",2006.563,2006.563,59,3)
Indicate whether a DICOM transmitter is running or not.
"^DD",2006.563,2006.563,59,21,0)
^^6^6^3040303^
"^DD",2006.563,2006.563,59,21,1,0)
The value of this field is a code that indicates whether or
"^DD",2006.563,2006.563,59,21,2,0)
not a DICOM Transmitter is currently running.
"^DD",2006.563,2006.563,59,21,3,0)
Possible values are "RUN" and "STOP".
"^DD",2006.563,2006.563,59,21,4,0)
Each active DICOM Transmitter will periodically check the value of
"^DD",2006.563,2006.563,59,21,5,0)
this field, and gracefully terminate if the value of this field
"^DD",2006.563,2006.563,59,21,6,0)
has been set to "STOP".
"^DD",2006.563,2006.563,59,"DT")
3040303
"^DD",2006.563,2006.563,60,0)
DOMAIN^F^^DOMAIN;1^K:$L(X)>63!($L(X)<1) X
"^DD",2006.563,2006.563,60,3)
Enter the site's domain name.
"^DD",2006.563,2006.563,60,21,0)
^^5^5^3040303^
"^DD",2006.563,2006.563,60,21,1,0)
The value of this field is a string that identifies the domain
"^DD",2006.563,2006.563,60,21,2,0)
to which the site belongs at which this DICOM Gateway is located.
"^DD",2006.563,2006.563,60,21,3,0)
This field is populated automatically, using an RPC to query
"^DD",2006.563,2006.563,60,21,4,0)
the VistA system for the current values of its Kernel Site Parameters
"^DD",2006.563,2006.563,60,21,5,0)
when the configuration of the DICOM Gateway is updated.
"^DD",2006.563,2006.563,60,"DT")
3040303
"^DD",2006.563,2006.563,61,0)
PACS QUERY^2006.5633A^^GE CONV #HRS;0
"^DD",2006.563,2006.563,62,0)
PACS QUERY ACTIVE^S^YES:Active;NO:Idle;STOP:Stop Requested;^GE CONV ACTIVE;1^Q
"^DD",2006.563,2006.563,62,3)
Indicate whether a PACS Query is currently running.
"^DD",2006.563,2006.563,62,21,0)
^^10^10^3040303^
"^DD",2006.563,2006.563,62,21,1,0)
The value of this field is a code that indicates whether
"^DD",2006.563,2006.563,62,21,2,0)
a PACS query process is currently active.
"^DD",2006.563,2006.563,62,21,3,0)
Possible values are "YES", "NO" and "STOP".
"^DD",2006.563,2006.563,62,21,4,0)
 
"^DD",2006.563,2006.563,62,21,5,0)
Each PACS Query process will periodically check the value of
"^DD",2006.563,2006.563,62,21,6,0)
this field, and gracefully terminate if the value of this field
"^DD",2006.563,2006.563,62,21,7,0)
has been set to "STOP".
"^DD",2006.563,2006.563,62,21,8,0)
 
"^DD",2006.563,2006.563,62,21,9,0)
When a PACS Query Process fully completed its activity, it
"^DD",2006.563,2006.563,62,21,10,0)
will set the value of this field to "NO".
"^DD",2006.563,2006.563,62,"DT")
3040303
"^DD",2006.563,2006.563,63,0)
PACS QUERY DIRECTION^S^ASCENDING:Ascending Order;DESCENDING:Descending Order;^GE CONV DIR;1^Q
"^DD",2006.563,2006.563,63,3)
Indicate the traversal direction.
"^DD",2006.563,2006.563,63,21,0)
^^3^3^3040303^
"^DD",2006.563,2006.563,63,21,1,0)
The value of this field is a code that indicates in which direction
"^DD",2006.563,2006.563,63,21,2,0)
the PACS QUery process will traverse the database.
"^DD",2006.563,2006.563,63,21,3,0)
Possible values are "ASCENDING" and "DESCENDING".
"^DD",2006.563,2006.563,63,"DT")
3040303
"^DD",2006.563,2006.563,64,0)
PACS QUERY ERA 1 START^D^^GE CONV ERA1;1^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",2006.563,2006.563,64,3)
Indicate the start of the ACR/NEMA era.
"^DD",2006.563,2006.563,64,21,0)
^^16^16^3040303^
"^DD",2006.563,2006.563,64,21,1,0)
The value of this field is a timestamp (VA FileMan format,
"^DD",2006.563,2006.563,64,21,2,0)
date only) that indicates the start of the time-period during
"^DD",2006.563,2006.563,64,21,3,0)
which communication with the PACS was conducted using the
"^DD",2006.563,2006.563,64,21,4,0)
ACR/NEMA protocol.
"^DD",2006.563,2006.563,64,21,5,0)
 
"^DD",2006.563,2006.563,64,21,6,0)
When querying the PACS, the query process will issue its queries
"^DD",2006.563,2006.563,64,21,7,0)
according to this protocol for all studies that were conducted
"^DD",2006.563,2006.563,64,21,8,0)
between the start and end dates that are registered in this
"^DD",2006.563,2006.563,64,21,9,0)
field (and the next).
"^DD",2006.563,2006.563,64,21,10,0)
 
"^DD",2006.563,2006.563,64,21,11,0)
Note that protocol-eras are allowed to overlap. The result
"^DD",2006.563,2006.563,64,21,12,0)
of registering overlapping protocol eras will be that the
"^DD",2006.563,2006.563,64,21,13,0)
query process will issues its requests according to all protocols
"^DD",2006.563,2006.563,64,21,14,0)
that could have been valid at the time. The PACS, on the other
"^DD",2006.563,2006.563,64,21,15,0)
hand, will only respond to requests that correspond to the
"^DD",2006.563,2006.563,64,21,16,0)
protocol that was actually active at the time.
"^DD",2006.563,2006.563,64,"DT")
3040303
"^DD",2006.563,2006.563,65,0)
PACS QUERY ERA 1 END^D^^GE CONV ERA1;2^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",2006.563,2006.563,65,3)
Indicate the end of the ACR/NEMA era.
"^DD",2006.563,2006.563,65,21,0)
^^16^16^3040303^
"^DD",2006.563,2006.563,65,21,1,0)
The value of this field is a timestamp (VA FileMan format,
"^DD",2006.563,2006.563,65,21,2,0)
date only) that indicates the end of the time-period during
"^DD",2006.563,2006.563,65,21,3,0)
which communication with the PACS was conducted using the
"^DD",2006.563,2006.563,65,21,4,0)
ACR/NEMA protocol.
"^DD",2006.563,2006.563,65,21,5,0)
 
"^DD",2006.563,2006.563,65,21,6,0)
When querying the PACS, the query process will issue its queries
"^DD",2006.563,2006.563,65,21,7,0)
according to this protocol for all studies that were conducted
"^DD",2006.563,2006.563,65,21,8,0)
between the start and end dates that are registered in this
"^DD",2006.563,2006.563,65,21,9,0)
field (and the previous).
"^DD",2006.563,2006.563,65,21,10,0)
 
"^DD",2006.563,2006.563,65,21,11,0)
Note that protocol-eras are allowed to overlap. The result
"^DD",2006.563,2006.563,65,21,12,0)
of registering overlapping protocol eras will be that the
"^DD",2006.563,2006.563,65,21,13,0)
query process will issues its requests according to all protocols
"^DD",2006.563,2006.563,65,21,14,0)
that could have been valid at the time. The PACS, on the other
"^DD",2006.563,2006.563,65,21,15,0)
hand, will only respond to requests that correspond to the
"^DD",2006.563,2006.563,65,21,16,0)
protocol that was actually active at the time.
"^DD",2006.563,2006.563,65,"DT")
3040303
"^DD",2006.563,2006.563,66,0)
PACS QUERY ERA 2 START^D^^GE CONV ERA2;1^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",2006.563,2006.563,66,3)
Indicate the start of the Pre 12.1 era.
"^DD",2006.563,2006.563,66,21,0)
^^16^16^3040303^
"^DD",2006.563,2006.563,66,21,1,0)
The value of this field is a timestamp (VA FileMan format,
"^DD",2006.563,2006.563,66,21,2,0)
date only) that indicates the start of the time-period during
"^DD",2006.563,2006.563,66,21,3,0)
which communication with the PACS was conducted using the
"^DD",2006.563,2006.563,66,21,4,0)
Pre Version 12.1 protocol.
"^DD",2006.563,2006.563,66,21,5,0)
 
"^DD",2006.563,2006.563,66,21,6,0)
When querying the PACS, the query process will issue its queries
"^DD",2006.563,2006.563,66,21,7,0)
according to this protocol for all studies that were conducted
"^DD",2006.563,2006.563,66,21,8,0)
between the start and end dates that are registered in this
"^DD",2006.563,2006.563,66,21,9,0)
field (and the next).
"^DD",2006.563,2006.563,66,21,10,0)
 
"^DD",2006.563,2006.563,66,21,11,0)
Note that protocol-eras are allowed to overlap. The result
"^DD",2006.563,2006.563,66,21,12,0)
of registering overlapping protocol eras will be that the
"^DD",2006.563,2006.563,66,21,13,0)
query process will issues its requests according to all protocols
"^DD",2006.563,2006.563,66,21,14,0)
that could have been valid at the time. The PACS, on the other
"^DD",2006.563,2006.563,66,21,15,0)
hand, will only respond to requests that correspond to the
"^DD",2006.563,2006.563,66,21,16,0)
protocol that was actually active at the time.
"^DD",2006.563,2006.563,66,"DT")
3040303
"^DD",2006.563,2006.563,67,0)
PACS QUERY ERA 2 END^D^^GE CONV ERA2;2^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",2006.563,2006.563,67,3)
Indicate the end of the Pre 12.1 era.
"^DD",2006.563,2006.563,67,21,0)
^^16^16^3040303^
"^DD",2006.563,2006.563,67,21,1,0)
The value of this field is a timestamp (VA FileMan format,
"^DD",2006.563,2006.563,67,21,2,0)
date only) that indicates the end of the time-period during
"^DD",2006.563,2006.563,67,21,3,0)
which communication with the PACS was conducted using the
"^DD",2006.563,2006.563,67,21,4,0)
Pre Version 12.1 protocol.
"^DD",2006.563,2006.563,67,21,5,0)
 
"^DD",2006.563,2006.563,67,21,6,0)
When querying the PACS, the query process will issue its queries
"^DD",2006.563,2006.563,67,21,7,0)
according to this protocol for all studies that were conducted
"^DD",2006.563,2006.563,67,21,8,0)
between the start and end dates that are registered in this
"^DD",2006.563,2006.563,67,21,9,0)
field (and the previous).
"^DD",2006.563,2006.563,67,21,10,0)
 
"^DD",2006.563,2006.563,67,21,11,0)
Note that protocol-eras are allowed to overlap. The result
"^DD",2006.563,2006.563,67,21,12,0)
of registering overlapping protocol eras will be that the
"^DD",2006.563,2006.563,67,21,13,0)
query process will issues its requests according to all protocols
"^DD",2006.563,2006.563,67,21,14,0)
that could have been valid at the time. The PACS, on the other
"^DD",2006.563,2006.563,67,21,15,0)
hand, will only respond to requests that correspond to the
"^DD",2006.563,2006.563,67,21,16,0)
protocol that was actually active at the time.
"^DD",2006.563,2006.563,67,"DT")
3040303
"^DD",2006.563,2006.563,68,0)
PACS QUERY ERA 3 START^D^^GE CONV ERA3;1^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",2006.563,2006.563,68,3)
Indicate the start of the Post 12.1 era.
"^DD",2006.563,2006.563,68,21,0)
^^16^16^3040303^
"^DD",2006.563,2006.563,68,21,1,0)
The value of this field is a timestamp (VA FileMan format,
"^DD",2006.563,2006.563,68,21,2,0)
date only) that indicates the start of the time-period during
"^DD",2006.563,2006.563,68,21,3,0)
which communication with the PACS was conducted using the
"^DD",2006.563,2006.563,68,21,4,0)
Post Version 12.1 protocol.
"^DD",2006.563,2006.563,68,21,5,0)
 
"^DD",2006.563,2006.563,68,21,6,0)
When querying the PACS, the query process will issue its queries
"^DD",2006.563,2006.563,68,21,7,0)
according to this protocol for all studies that were conducted
"^DD",2006.563,2006.563,68,21,8,0)
between the start and end dates that are registered in this
"^DD",2006.563,2006.563,68,21,9,0)
field (and the next).
"^DD",2006.563,2006.563,68,21,10,0)
 
"^DD",2006.563,2006.563,68,21,11,0)
Note that protocol-eras are allowed to overlap. The result
"^DD",2006.563,2006.563,68,21,12,0)
of registering overlapping protocol eras will be that the
"^DD",2006.563,2006.563,68,21,13,0)
query process will issues its requests according to all protocols
"^DD",2006.563,2006.563,68,21,14,0)
that could have been valid at the time. The PACS, on the other
"^DD",2006.563,2006.563,68,21,15,0)
hand, will only respond to requests that correspond to the
"^DD",2006.563,2006.563,68,21,16,0)
protocol that was actually active at the time.
"^DD",2006.563,2006.563,68,"DT")
3040303
"^DD",2006.563,2006.563,69,0)
PACS QUERY ERA 3 END^D^^GE CONV ERA3;2^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",2006.563,2006.563,69,3)
Indicate the end of the Post 12.1 era.
"^DD",2006.563,2006.563,69,21,0)
^^16^16^3040303^
"^DD",2006.563,2006.563,69,21,1,0)
The value of this field is a timestamp (VA FileMan format,
"^DD",2006.563,2006.563,69,21,2,0)
date only) that indicates the end of the time-period during
"^DD",2006.563,2006.563,69,21,3,0)
which communication with the PACS was conducted using the
"^DD",2006.563,2006.563,69,21,4,0)
Post Version 12.1 protocol.
"^DD",2006.563,2006.563,69,21,5,0)
 
"^DD",2006.563,2006.563,69,21,6,0)
When querying the PACS, the query process will issue its queries
"^DD",2006.563,2006.563,69,21,7,0)
according to this protocol for all studies that were conducted
"^DD",2006.563,2006.563,69,21,8,0)
between the start and end dates that are registered in this
"^DD",2006.563,2006.563,69,21,9,0)
field (and the previous).
"^DD",2006.563,2006.563,69,21,10,0)
 
"^DD",2006.563,2006.563,69,21,11,0)
Note that protocol-eras are allowed to overlap. The result
"^DD",2006.563,2006.563,69,21,12,0)
of registering overlapping protocol eras will be that the
"^DD",2006.563,2006.563,69,21,13,0)
query process will issues its requests according to all protocols
"^DD",2006.563,2006.563,69,21,14,0)
that could have been valid at the time. The PACS, on the other
"^DD",2006.563,2006.563,69,21,15,0)
hand, will only respond to requests that correspond to the
"^DD",2006.563,2006.563,69,21,16,0)
protocol that was actually active at the time.
"^DD",2006.563,2006.563,69,"DT")
3040303
"^DD",2006.563,2006.563,70,0)
PACS QUERY UPPER LIMIT^P74'^RARPT(^GE CONV HI;1^Q
"^DD",2006.563,2006.563,70,3)
Identify the most recent Radiology Report to be queried.
"^DD",2006.563,2006.563,70,21,0)
^^9^9^3040303^
"^DD",2006.563,2006.563,70,21,1,0)
The value of this field is a pointer to the Radiology Report Table
"^DD",2006.563,2006.563,70,21,2,0)
(#74). This pointer identifies the highest internal entry number of
"^DD",2006.563,2006.563,70,21,3,0)
a report that was scanned by the PACS Query Process.
"^DD",2006.563,2006.563,70,21,4,0)
 
"^DD",2006.563,2006.563,70,21,5,0)
When the "highest" and "lowest" pointer values "pass" one another,
"^DD",2006.563,2006.563,70,21,6,0)
the scanning process is complete.
"^DD",2006.563,2006.563,70,21,7,0)
 
"^DD",2006.563,2006.563,70,21,8,0)
Note that the end-user may decide to switch the scanning direction
"^DD",2006.563,2006.563,70,21,9,0)
from "ASCENDING" to "DESCENDING" (or the other way about) at any time.
"^DD",2006.563,2006.563,70,"DT")
3040303
"^DD",2006.563,2006.563,71,0)
PACS QUERY LOWER LIMIT^P74'^RARPT(^GE CONV LO;1^Q
"^DD",2006.563,2006.563,71,3)
Indicate the oldest Radiology Report to be queried.
"^DD",2006.563,2006.563,71,21,0)
^^9^9^3040303^
"^DD",2006.563,2006.563,71,21,1,0)
The value of this field is a pointer to the Radiology Report Table
"^DD",2006.563,2006.563,71,21,2,0)
(#74). This pointer identifies the lowest internal entry number of
"^DD",2006.563,2006.563,71,21,3,0)
a report that was scanned by the PACS Query Process.
"^DD",2006.563,2006.563,71,21,4,0)
 
"^DD",2006.563,2006.563,71,21,5,0)
When the "highest" and "lowest" pointer values "pass" one another,
"^DD",2006.563,2006.563,71,21,6,0)
the scanning process is complete.
"^DD",2006.563,2006.563,71,21,7,0)
 
"^DD",2006.563,2006.563,71,21,8,0)
Note that the end-user may decide to switch the scanning direction
"^DD",2006.563,2006.563,71,21,9,0)
from "ASCENDING" to "DESCENDING" (or the other way about) at any time.
"^DD",2006.563,2006.563,71,"DT")
3040303
"^DD",2006.563,2006.563,72,0)
PACS QUERY ALLOW ACTIVITY^F^^GE CONV HRS;1^K:$L(X)>24!($L(X)<24) X
"^DD",2006.563,2006.563,72,3)
Indicate when PACS Queries may be active.
"^DD",2006.563,2006.563,72,21,0)
^^10^10^3040303^
"^DD",2006.563,2006.563,72,21,1,0)
The value of this field is a string of exactly 24 characters.
"^DD",2006.563,2006.563,72,21,2,0)
Each of these characters is either a "Y" or an "N".
"^DD",2006.563,2006.563,72,21,3,0)
Each character in this string corresponds to an hour of the day,
"^DD",2006.563,2006.563,72,21,4,0)
and indicates whether or not a PACS Query Process is allowed to
"^DD",2006.563,2006.563,72,21,5,0)
be active during that hour of the day.
"^DD",2006.563,2006.563,72,21,6,0)
 
"^DD",2006.563,2006.563,72,21,7,0)
The first character corresponds to the hour between midnight and 1am,
"^DD",2006.563,2006.563,72,21,8,0)
the last one corresponds to the hour between 11pm and midnight.
"^DD",2006.563,2006.563,72,21,9,0)
 
"^DD",2006.563,2006.563,72,21,10,0)
The default value of this field is "YYYYYYYYYYYYYYYYYYYYYYYY".
"^DD",2006.563,2006.563,72,"DT")
3040303
"^DD",2006.563,2006.563,73,0)
CURRENT IMAGE POINTER^P2005'^MAG(2005,^CURRENT IMAGE POINTER;1^Q
"^DD",2006.563,2006.563,73,3)
Identify the image currently being processed.
"^DD",2006.563,2006.563,73,21,0)
^^3^3^3040303^
"^DD",2006.563,2006.563,73,21,1,0)
The value of this field is a pointer to the Image Table
"^DD",2006.563,2006.563,73,21,2,0)
(#2005). This value identifies the image that is currently
"^DD",2006.563,2006.563,73,21,3,0)
being processed.
"^DD",2006.563,2006.563,73,"DT")
3040303
"^DD",2006.563,2006.563,74,0)
CURRENT IMAGE DESTINATION^F^^CURRENT IMAGE DESTINATION;1^K:$L(X)>250!($L(X)<1) X
"^DD",2006.563,2006.563,74,3)
Identify the directory and file name where this image will be stored.
"^DD",2006.563,2006.563,74,21,0)
^^3^3^3040303^
"^DD",2006.563,2006.563,74,21,1,0)
The value of this field is a string that identifies the image file
"^DD",2006.563,2006.563,74,21,2,0)
(host system file name, including directory path) that is
"^DD",2006.563,2006.563,74,21,3,0)
currently being created.
"^DD",2006.563,2006.563,74,"DT")
3040303
"^DD",2006.563,2006.563,75,0)
CURRENT IMAGE FILE NAME^F^^CURRENT IMAGE FILE NAME;1^K:$L(X)>240!($L(X)<1) X
"^DD",2006.563,2006.563,75,3)
Identify the file (HSF) currently being processed.
"^DD",2006.563,2006.563,75,21,0)
^^3^3^3040303^
"^DD",2006.563,2006.563,75,21,1,0)
The value of this field is a string that identifies the image file
"^DD",2006.563,2006.563,75,21,2,0)
(host system file name, no directory path) that is
"^DD",2006.563,2006.563,75,21,3,0)
currently being processed.
"^DD",2006.563,2006.563,75,"DT")
3040303
"^DD",2006.563,2006.563,76,0)
CURRENT IMAGE SOURCE^F^^CURRENT IMAGE SOURCE;1^K:$L(X)>240!($L(X)<1) X
"^DD",2006.563,2006.563,76,3)
Identify the directory where the current file resides.
"^DD",2006.563,2006.563,76,21,0)
^^2^2^3040303^
"^DD",2006.563,2006.563,76,21,1,0)
The value of this field is a string that identifies the image file
"^DD",2006.563,2006.563,76,21,2,0)
(directory path, no file name) that is currently being processed.
"^DD",2006.563,2006.563,76,"DT")
3040303
"^DD",2006.563,2006.563,77,0)
LAST UID^F^^LAST UID;1^K:$L(X)>64!($L(X)<1) X
"^DD",2006.563,2006.563,77,3)
Record the most recently issued UID for a new object.
"^DD",2006.563,2006.563,77,21,0)
^^6^6^3040303^
"^DD",2006.563,2006.563,77,21,1,0)
The value of this field is a string that meets the format
"^DD",2006.563,2006.563,77,21,2,0)
of a Unique Object Identifier as specified in the DICOM Standard
"^DD",2006.563,2006.563,77,21,3,0)
(maximum 64 characters, only digits and periods, leading characters
"^DD",2006.563,2006.563,77,21,4,0)
are the root-numbers that are assigned by ANSI to the VA).
"^DD",2006.563,2006.563,77,21,5,0)
The value of this field is the UID that was most recently assigned
"^DD",2006.563,2006.563,77,21,6,0)
by the DICOM Gateway.
"^DD",2006.563,2006.563,77,"DT")
3040303
"^DD",2006.563,2006.563,78,0)
BACKGROUND PROCESS ACCESS^F^^M-to-M BROKER BGND ACCESS;1^K:$L(X)>63!($L(X)<1) X
"^DD",2006.563,2006.563,78,3)
Enter the access code for background processes.
"^DD",2006.563,2006.563,78,21,0)
^^8^8^3040303^
"^DD",2006.563,2006.563,78,21,1,0)
The value of this field is an (encrypted) string. This value will
"^DD",2006.563,2006.563,78,21,2,0)
be used as an access code by the DICOM Gateway when a "modality"
"^DD",2006.563,2006.563,78,21,3,0)
performs a Modality Worklist Query, in those special cases where
"^DD",2006.563,2006.563,78,21,4,0)
the DICOM Gateway needs to query the VistA system about details
"^DD",2006.563,2006.563,78,21,5,0)
about "old" Radiology studies. (Under normal circumstances, a
"^DD",2006.563,2006.563,78,21,6,0)
DICOM Gateway will be able to respond to a Modality Worklist
"^DD",2006.563,2006.563,78,21,7,0)
QUery using only information that is stored on the DICOM Gateway
"^DD",2006.563,2006.563,78,21,8,0)
itself.)
"^DD",2006.563,2006.563,78,"DT")
3040303
"^DD",2006.563,2006.563,79,0)
BACKGROUND PROCESS VERIFY^F^^M-to-M BROKER BGND VERIFY;1^K:$L(X)>63!($L(X)<1) X
"^DD",2006.563,2006.563,79,3)
Enter the verify code for background processes.
"^DD",2006.563,2006.563,79,21,0)
^.001^8^8^3090929^^
"^DD",2006.563,2006.563,79,21,1,0)
The value of this field is an (encrypted) string. This value will
"^DD",2006.563,2006.563,79,21,2,0)
be used as a verify code by the DICOM Gateway when a "modality"
"^DD",2006.563,2006.563,79,21,3,0)
performs a Modality Worklist Query, in those special cases where
"^DD",2006.563,2006.563,79,21,4,0)
the DICOM Gateway needs to query the VistA system about details
"^DD",2006.563,2006.563,79,21,5,0)
about "old" Radiology studies. (Under normal circumstances, a
"^DD",2006.563,2006.563,79,21,6,0)
DICOM Gateway will be able to respond to a Modality Worklist
"^DD",2006.563,2006.563,79,21,7,0)
Query using only information that is stored on the DICOM Gateway
"^DD",2006.563,2006.563,79,21,8,0)
itself.)
"^DD",2006.563,2006.563,79,"DT")
3040303
"^DD",2006.563,2006.563,80,0)
M2M BROKER DEBUG^S^1:Yes;0:No;^M2M DEBUG;1^Q
"^DD",2006.563,2006.563,80,3)
Indicate whether or not debugging is active for M2M Broker sessions.
"^DD",2006.563,2006.563,80,21,0)
^^13^13^3040303^
"^DD",2006.563,2006.563,80,21,1,0)
The value of this field is a code that indicates whether
"^DD",2006.563,2006.563,80,21,2,0)
or not the client for the MUMPS-to-MUMPS Broker should record
"^DD",2006.563,2006.563,80,21,3,0)
any debugging information. Possible values are 1 (do record
"^DD",2006.563,2006.563,80,21,4,0)
information) and 0 (do NOT record any information).
"^DD",2006.563,2006.563,80,21,5,0)
 
"^DD",2006.563,2006.563,80,21,6,0)
When a DICOM Gateway is installed at a new site, the value of
"^DD",2006.563,2006.563,80,21,7,0)
this field is "false", and this field can only receive a "true"
"^DD",2006.563,2006.563,80,21,8,0)
value through a manual operation from "programmer mode".
"^DD",2006.563,2006.563,80,21,9,0)
 
"^DD",2006.563,2006.563,80,21,10,0)
Since the information that is recorded when this switch is turned
"^DD",2006.563,2006.563,80,21,11,0)
"on" is quite voluminous, this switch should only be used by
"^DD",2006.563,2006.563,80,21,12,0)
support personnel to diagnose a problem, and turned off 
"^DD",2006.563,2006.563,80,21,13,0)
immediately after the problem is diagnosed.
"^DD",2006.563,2006.563,80,"DT")
3040303
"^DD",2006.563,2006.563,81,0)
MULTIFRAME COUNTER^NJ9,0^^MULTIFRAME COUNTER;1^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.563,2006.563,81,3)
Record the sequence number of the last-processed frame.
"^DD",2006.563,2006.563,81,21,0)
^.001^13^13^3090929^^
"^DD",2006.563,2006.563,81,21,1,0)
The value of this field is an integer number that records the
"^DD",2006.563,2006.563,81,21,2,0)
progress through the various frames of a multi-frame image
"^DD",2006.563,2006.563,81,21,3,0)
as data for that image is being received.
"^DD",2006.563,2006.563,81,21,4,0)
 
"^DD",2006.563,2006.563,81,21,5,0)
Under normal circumstances, the various "frames" are converted
"^DD",2006.563,2006.563,81,21,6,0)
to individual images, and there is no need to know the number of
"^DD",2006.563,2006.563,81,21,7,0)
frames processed to any process other than the one
"^DD",2006.563,2006.563,81,21,8,0)
receiving the image data.
"^DD",2006.563,2006.563,81,21,9,0)
 
"^DD",2006.563,2006.563,81,21,10,0)
However, if that process is interrupted (user interrupt, network
"^DD",2006.563,2006.563,81,21,11,0)
outage, power failure), a subsequent process will need to know
"^DD",2006.563,2006.563,81,21,12,0)
which sub-images have already been created when it starts processing
"^DD",2006.563,2006.563,81,21,13,0)
the re-transmission of the image data.
"^DD",2006.563,2006.563,81,"DT")
3040303
"^DD",2006.563,2006.563,82,0)
SHOW PATIENT IDENTIFIERS^S^YES:Yes;NO:No;^SHOW PATIENT NAME & ID;1^Q
"^DD",2006.563,2006.563,82,3)
Indicate whether or not Patient Identifiers will be displayed.
"^DD",2006.563,2006.563,82,21,0)
^^11^11^3040303^
"^DD",2006.563,2006.563,82,21,1,0)
The value of this field is a code that indicates whether or not
"^DD",2006.563,2006.563,82,21,2,0)
an Image Gateway is to display patient identifying information
"^DD",2006.563,2006.563,82,21,3,0)
while processing images.
"^DD",2006.563,2006.563,82,21,4,0)
Possible values are "YES" and "NO".
"^DD",2006.563,2006.563,82,21,5,0)
 
"^DD",2006.563,2006.563,82,21,6,0)
When a DICOM Gateway is located in a well-protected area, it is
"^DD",2006.563,2006.563,82,21,7,0)
permissible to leave the value of this field equal to "YES".
"^DD",2006.563,2006.563,82,21,8,0)
When a DICOM Gateway is located in a publicly accessible area,
"^DD",2006.563,2006.563,82,21,9,0)
the value of this field may only be set to "YES" while an
"^DD",2006.563,2006.563,82,21,10,0)
adequately privileged user is diagnosing a problem, and should
"^DD",2006.563,2006.563,82,21,11,0)
be set to "NO" at all other times.
"^DD",2006.563,2006.563,82,"DT")
3040303
"^DD",2006.563,2006.563,83,0)
TEXT GATEWAY SERVICE^S^RAD:Radiology;CON:Consults;^TEXT GATEWAY SERVICE;1^Q
"^DD",2006.563,2006.563,83,3)
Identify the kind of Imaging Service that is processed by this Gateway.
"^DD",2006.563,2006.563,83,21,0)
^^3^3^3040303^
"^DD",2006.563,2006.563,83,21,1,0)
The value of this field is a code that indicates which imaging
"^DD",2006.563,2006.563,83,21,2,0)
service is being performed by this Text Gateway.
"^DD",2006.563,2006.563,83,21,3,0)
Possible values are "RAD" (Radiology) and "CON" (Consults).
"^DD",2006.563,2006.563,83,"DT")
3040303
"^DD",2006.563,2006.563,84,0)
ET ADDRESS^F^^ET ADDRESS;1^K:$L(X)>100!($L(X)<3) X
"^DD",2006.563,2006.563,84,3)
Enter the e-mail address for the ET Phone Home mailgroup.
"^DD",2006.563,2006.563,84,21,0)
^^5^5^3050224^
"^DD",2006.563,2006.563,84,21,1,0)
The value of this field is a string. This string identifies
"^DD",2006.563,2006.563,84,21,2,0)
the mail-group that is used to process messages containing
"^DD",2006.563,2006.563,84,21,3,0)
routine checksum information.
"^DD",2006.563,2006.563,84,21,4,0)
 
"^DD",2006.563,2006.563,84,21,5,0)
Typically, the value will look like: G.MAGDBB@DOMAIN.EXT
"^DD",2006.563,2006.563,84,"DT")
3050224
"^DD",2006.563,2006.563,85,0)
MAG VISTA CHECKSUMS^S^YES:Yes;NO:No;^MAG VISTA CHECKSUMS;1^Q
"^DD",2006.563,2006.563,85,3)
Indicate whether or not reports with VistA routine checksums are to be sent.
"^DD",2006.563,2006.563,85,21,0)
^^6^6^3050224^
"^DD",2006.563,2006.563,85,21,1,0)
The value of this field is a code that indicates whether or not
"^DD",2006.563,2006.563,85,21,2,0)
reports will be sent containing the checksums of all imaging
"^DD",2006.563,2006.563,85,21,3,0)
routines on the VistA system.
"^DD",2006.563,2006.563,85,21,4,0)
 
"^DD",2006.563,2006.563,85,21,5,0)
A value of YES indicates that reports are to be sent.
"^DD",2006.563,2006.563,85,21,6,0)
A value of NO indicates that no reports are to be sent.
"^DD",2006.563,2006.563,85,"DT")
3050224
"^DD",2006.563,2006.563,86,0)
EXPORT ACTIVE^S^YES:Yes;NO:No;^EXPORT ACTIVE;1^Q
"^DD",2006.563,2006.563,86,3)
Indicate whether or not an export batch run is active.
"^DD",2006.563,2006.563,86,21,0)
^^3^3^3051006^
"^DD",2006.563,2006.563,86,21,1,0)
The value of this field is a code that indicates whether or
"^DD",2006.563,2006.563,86,21,2,0)
not a batch export run is currently active.
"^DD",2006.563,2006.563,86,21,3,0)
Possible values are "YES" and "NO".
"^DD",2006.563,2006.563,86,"DT")
3051006
"^DD",2006.563,2006.563,87,0)
EXPORT BATCH IMAGES^NJ12,0^^EXPORT BATCH #IMAGES;1^K:+X'=X!(X>999999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.563,2006.563,87,3)
Indicate how many images are queued up for batch transmission.
"^DD",2006.563,2006.563,87,21,0)
^^3^3^3051006^
"^DD",2006.563,2006.563,87,21,1,0)
The value of this field is an integer number. This number
"^DD",2006.563,2006.563,87,21,2,0)
indicates the number of images that have been queued up for
"^DD",2006.563,2006.563,87,21,3,0)
batch transmission.
"^DD",2006.563,2006.563,87,"DT")
3051006
"^DD",2006.563,2006.563,88,0)
EXPORT BATCH GROUP COUNT^NJ12,0^^EXPORT BATCH COUNT;1^K:+X'=X!(X>999999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.563,2006.563,88,3)
Indicate how many groups have been queued up for transmission.
"^DD",2006.563,2006.563,88,21,0)
^^3^3^3051006^
"^DD",2006.563,2006.563,88,21,1,0)
The value of this field is an integer number. This number
"^DD",2006.563,2006.563,88,21,2,0)
indicates the number of image groups that have been queued up for
"^DD",2006.563,2006.563,88,21,3,0)
batch transmission.
"^DD",2006.563,2006.563,88,"DT")
3051006
"^DD",2006.563,2006.563,89,0)
EXPORT BATCH MAX GROUP^NJ12,0^^EXPORT BATCH SIZE;1^K:+X'=X!(X>999999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.563,2006.563,89,3)
Indicate the maximum number of image groups for a batch run.
"^DD",2006.563,2006.563,89,21,0)
^^2^2^3051006^
"^DD",2006.563,2006.563,89,21,1,0)
is the default value for the maximum number of image groups that may be
"^DD",2006.563,2006.563,89,21,2,0)
queued up in the next batch transmission.
"^DD",2006.563,2006.563,89,"DT")
3051006
"^DD",2006.563,2006.563,90,0)
EXPORT BEGIN DATE^D^^EXPORT BEGIN DATE;1^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",2006.563,2006.563,90,3)
Indicate the first date to include in scans of Radiology reports.
"^DD",2006.563,2006.563,90,21,0)
^^3^3^3051006^
"^DD",2006.563,2006.563,90,21,1,0)
The value of this field is a (VA-FileMan formatted) date.
"^DD",2006.563,2006.563,90,21,2,0)
This date is the default value for the first day of the period that is
"^DD",2006.563,2006.563,90,21,3,0)
intended to be included in the next DICOM export batch.
"^DD",2006.563,2006.563,90,"DT")
3051006
"^DD",2006.563,2006.563,91,0)
EXPORT FIRST REPORT NUMBER^P74'^RARPT(^EXPORT RADIOLOGY REPORT # START;1^Q
"^DD",2006.563,2006.563,91,3)
Identify the first report to be included in the next batch scan.
"^DD",2006.563,2006.563,91,21,0)
^^4^4^3051006^
"^DD",2006.563,2006.563,91,21,1,0)
The value of this field is a pointer to the Radiology Report
"^DD",2006.563,2006.563,91,21,2,0)
table (FileMan file # 74).
"^DD",2006.563,2006.563,91,21,3,0)
This pointer is the default value for the first report for which images
"^DD",2006.563,2006.563,91,21,4,0)
will be included in the next DICOM batch transmission.
"^DD",2006.563,2006.563,91,"DT")
3051006
"^DD",2006.563,2006.563,92,0)
EXPORT LAST REPORT NUMBER^P74'^RARPT(^EXPORT RADIOLOGY REPORT # STOP;1^Q
"^DD",2006.563,2006.563,92,3)
Identify the last report to include in the next batch scan.
"^DD",2006.563,2006.563,92,21,0)
^^4^4^3051006^
"^DD",2006.563,2006.563,92,21,1,0)
The value of this field is a pointer to the Radiology Report
"^DD",2006.563,2006.563,92,21,2,0)
table (FileMan file # 74).
"^DD",2006.563,2006.563,92,21,3,0)
This pointer is the default value for the last report for which images
"^DD",2006.563,2006.563,92,21,4,0)
will be included in a DICOM batch transmission.
"^DD",2006.563,2006.563,92,"DT")
3051006
"^DD",2006.563,2006.563,93,0)
DICOM EXPORT RUN NUMBER^P2006.565'^MAGDICOM(2006.565,^EXPORT DICOM RUN NUMBER;1^Q
"^DD",2006.563,2006.563,93,3)
Identify the latest DICOM export batch run.
"^DD",2006.563,2006.563,93,21,0)
^.001^3^3^3090929^^
"^DD",2006.563,2006.563,93,21,1,0)
The value of this field is a pointer to the table that
"^DD",2006.563,2006.563,93,21,2,0)
keeps track of the various DICOM export batch runs (#2006.565).
"^DD",2006.563,2006.563,93,21,3,0)
This field identifies the most recently added entry to that table.
"^DD",2006.563,2006.563,93,"DT")
3051007
"^DD",2006.563,2006.563,94,0)
EXPORT DICOM STORAGE SCP^P2006.585'^MAGDICOM(2006.585,^EXPORT DICOM STORAGE SCP;1^Q
"^DD",2006.563,2006.563,94,3)
Identify the (default) destination of the next batch transmission.
"^DD",2006.563,2006.563,94,21,0)
^^4^4^3051006^
"^DD",2006.563,2006.563,94,21,1,0)
The value of this field is a pointer to the User Application table
"^DD",2006.563,2006.563,94,21,2,0)
(FileMan file # 2006.585). This pointer is the default value for
"^DD",2006.563,2006.563,94,21,3,0)
the Storage SCP to which the images are to be transmitted in
"^DD",2006.563,2006.563,94,21,4,0)
the next batch run.
"^DD",2006.563,2006.563,94,"DT")
3051006
"^DD",2006.563,2006.563,95,0)
EXPORT DIRECTION^S^ASCENDING:Ascending;DESCENDING:Descending;^EXPORT DIRECTION;1^Q
"^DD",2006.563,2006.563,95,3)
Indicate the (default) scanning direction for the next batch run.
"^DD",2006.563,2006.563,95,21,0)
^^4^4^3051006^
"^DD",2006.563,2006.563,95,21,1,0)
The value of this field is a code that indicates the direction
"^DD",2006.563,2006.563,95,21,2,0)
in which the Radiology Report table is to be scanned.
"^DD",2006.563,2006.563,95,21,3,0)
This value is the default code to be used in the next batch run.
"^DD",2006.563,2006.563,95,21,4,0)
Possible values are "ASCENDING" and "DESCENDING".
"^DD",2006.563,2006.563,95,"DT")
3051006
"^DD",2006.563,2006.563,96,0)
EXPORT HOURS OF OPERATION^F^^EXPORT HOURS OF OPERATION;1^K:$L(X)>24!($L(X)<24) X
"^DD",2006.563,2006.563,96,3)
Indicate when batch runs are allowed to be active.
"^DD",2006.563,2006.563,96,21,0)
^^12^12^3051006^
"^DD",2006.563,2006.563,96,21,1,0)
The value of this field is a string. This string consists of
"^DD",2006.563,2006.563,96,21,2,0)
the letters "Y" and "N". This value indicates during which hours
"^DD",2006.563,2006.563,96,21,3,0)
of the day this batch run may be active.
"^DD",2006.563,2006.563,96,21,4,0)
 
"^DD",2006.563,2006.563,96,21,5,0)
A string of 24 letters "Y" denotes a batch run that may run all day long.
"^DD",2006.563,2006.563,96,21,6,0)
 
"^DD",2006.563,2006.563,96,21,7,0)
A string like "YYYYYYYYNNNNNNNNNYYYYYYY" denotes a batch run
"^DD",2006.563,2006.563,96,21,8,0)
that may only run outside of regular office hours (midnight to 9am
"^DD",2006.563,2006.563,96,21,9,0)
and 6pm to midnight).
"^DD",2006.563,2006.563,96,21,10,0)
 
"^DD",2006.563,2006.563,96,21,11,0)
This value is the default for the setting to be used in the
"^DD",2006.563,2006.563,96,21,12,0)
next batch run.
"^DD",2006.563,2006.563,96,"DT")
3051006
"^DD",2006.563,2006.563,97,0)
EXPORT PATIENT^P2'^DPT(^EXPORT PATIENT;1^Q
"^DD",2006.563,2006.563,97,3)
Identify the patient for whom to scan reports in the next batch run.
"^DD",2006.563,2006.563,97,21,0)
^^1^1^3051006^
"^DD",2006.563,2006.563,97,21,1,0)
---???---
"^DD",2006.563,2006.563,97,"DT")
3051006
"^DD",2006.563,2006.563,98,0)
EXPORT RADIOLOGY REPORT^P74'^RARPT(^EXPORT RADIOLOGY REPORT #;1^Q
"^DD",2006.563,2006.563,98,3)
Identify the Radiology Report that was processed most recently.
"^DD",2006.563,2006.563,98,21,0)
^^4^4^3051006^
"^DD",2006.563,2006.563,98,21,1,0)
The value of this field is a pointer to the Radiology Report
"^DD",2006.563,2006.563,98,21,2,0)
table (FileMan file # 74).
"^DD",2006.563,2006.563,98,21,3,0)
This pointer identifies the report that has been scanned most
"^DD",2006.563,2006.563,98,21,4,0)
recently in a batch run.
"^DD",2006.563,2006.563,98,"DT")
3051006
"^DD",2006.563,2006.563,99,0)
EXPORT SCAN MODE^S^DATE:Date;NUMBER:Report;PATIENT:Patient;^EXPORT SCAN MODE;1^Q
"^DD",2006.563,2006.563,99,3)
Identify the primary scanning criterion for the next batch run.
"^DD",2006.563,2006.563,99,21,0)
^.001^14^14^3090929^^^
"^DD",2006.563,2006.563,99,21,1,0)
Set of codes: DATE, NUMBER, PATIENT
"^DD",2006.563,2006.563,99,21,2,0)
The value of this field is a code that identifies the method
"^DD",2006.563,2006.563,99,21,3,0)
of scanning the Radiology Reports.
"^DD",2006.563,2006.563,99,21,4,0)
Possible values are "DATE", "NUMBER" and "PATIENT".
"^DD",2006.563,2006.563,99,21,5,0)
 
"^DD",2006.563,2006.563,99,21,6,0)
A value of "DATE" indicates that the reports are scanned by date.
"^DD",2006.563,2006.563,99,21,7,0)
 
"^DD",2006.563,2006.563,99,21,8,0)
A value of "PATIENT" indicates that the reports are scanned
"^DD",2006.563,2006.563,99,21,9,0)
by (internal entry number of) patient.
"^DD",2006.563,2006.563,99,21,10,0)
 
"^DD",2006.563,2006.563,99,21,11,0)
A value of "NUMBER" indicates that the reports are scanned
"^DD",2006.563,2006.563,99,21,12,0)
by (internal entry number of) report.
"^DD",2006.563,2006.563,99,21,13,0)
 
"^DD",2006.563,2006.563,99,21,14,0)
This value is the default to be used in the next batch run.
"^DD",2006.563,2006.563,99,"DT")
3051006
"^DD",2006.563,2006.563,100,0)
FUJI PACS START DATE^D^^GE CONV ERA4;1^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",2006.563,2006.563,100,3)
Indicate when the Fuji PACS became active.
"^DD",2006.563,2006.563,100,21,0)
^^4^4^3051006^
"^DD",2006.563,2006.563,100,21,1,0)
The value of this field is a (VA-FileMan formatted) date
"^DD",2006.563,2006.563,100,21,2,0)
that indicates the first day of the period during which
"^DD",2006.563,2006.563,100,21,3,0)
information was stored according to the format for a
"^DD",2006.563,2006.563,100,21,4,0)
Fuji PACS.
"^DD",2006.563,2006.563,100,"DT")
3051006
"^DD",2006.563,2006.563,101,0)
FUJI PACS END DATE^D^^GE CONV ERA4;2^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",2006.563,2006.563,101,3)
Indicate when the Fuji PACS ceased to be active.
"^DD",2006.563,2006.563,101,21,0)
^^4^4^3051006^
"^DD",2006.563,2006.563,101,21,1,0)
The value of this field is a (VA-FileMan formatted) date
"^DD",2006.563,2006.563,101,21,2,0)
that indicates the last day of the period during which
"^DD",2006.563,2006.563,101,21,3,0)
information was stored according to the format for a
"^DD",2006.563,2006.563,101,21,4,0)
Fuji PACS.
"^DD",2006.563,2006.563,101,"DT")
3051006
"^DD",2006.563,2006.563,102,0)
QUERY STUDY SELECTION^S^1:All Studies;2:Studies without images;3:Studies with images;^GE CONV IMGSTU;1^Q
"^DD",2006.563,2006.563,102,3)
Indicate for which studies queries should be issued.
"^DD",2006.563,2006.563,102,21,0)
^^5^5^3051006^
"^DD",2006.563,2006.563,102,21,1,0)
The value of this field is a code that indicates for
"^DD",2006.563,2006.563,102,21,2,0)
which studies queries will be issued:
"^DD",2006.563,2006.563,102,21,3,0)
  1 = for all studies
"^DD",2006.563,2006.563,102,21,4,0)
  2 = only for studies that don't currently have images
"^DD",2006.563,2006.563,102,21,5,0)
  3 = only for studies that already have images
"^DD",2006.563,2006.563,102,"DT")
3051006
"^DD",2006.563,2006.563,103,0)
DASHES FOR SSN IN PACS QUERY^S^YES:Yes;NO:No;^GE CONV SSNDASH;1^Q
"^DD",2006.563,2006.563,103,3)
Indicate whether or not to include dashes in SSNs for PACS queries.
"^DD",2006.563,2006.563,103,21,0)
^^4^4^3051006^
"^DD",2006.563,2006.563,103,21,1,0)
The value of this field is a code that indicates whether
"^DD",2006.563,2006.563,103,21,2,0)
or not dashes are to be included in values of SSNs that
"^DD",2006.563,2006.563,103,21,3,0)
are transmitted to the external PACS.
"^DD",2006.563,2006.563,103,21,4,0)
Possible values are "YES" and "NO".
"^DD",2006.563,2006.563,103,"DT")
3051006
"^DD",2006.563,2006.563,104,0)
EXPORT STOP DATE^D^^EXPORT STOP DATE;1^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",2006.563,2006.563,104,3)
Indicate the last date to be scanned in the next batch run.
"^DD",2006.563,2006.563,104,21,0)
^^3^3^3051006^
"^DD",2006.563,2006.563,104,21,1,0)
The value of this field is a (VA-FileMan formatted) date.
"^DD",2006.563,2006.563,104,21,2,0)
This date is the default value for the last day of the period
"^DD",2006.563,2006.563,104,21,3,0)
that is intended to be included in the next DICOM export batch.
"^DD",2006.563,2006.563,104,"DT")
3051006
"^DD",2006.563,2006.563,105,0)
WORKLIST PORT^2006.5635A^^WORKLIST PORT;0
"^DD",2006.563,2006.563,112,0)
VISTA STORAGE^F^^MOVE DESTINATION AE TITLE;1^K:$L(X)>16!($L(X)<1) X
"^DD",2006.563,2006.563,112,3)
Enter the AE Title of the VistA system for DICOM C-Move Storage
"^DD",2006.563,2006.563,112,21,0)
^^10^10^3060405^
"^DD",2006.563,2006.563,112,21,1,0)
The value of this field is a string.
"^DD",2006.563,2006.563,112,21,2,0)
This string represents the Application Entity that a PACS system
"^DD",2006.563,2006.563,112,21,3,0)
would use when transmitting image files to VistA using the
"^DD",2006.563,2006.563,112,21,4,0)
DICOM C-Move protocol.
"^DD",2006.563,2006.563,112,21,5,0)
 
"^DD",2006.563,2006.563,112,21,6,0)
(AE Title, C-Move and PACS are described in the DICOM Standard.)
"^DD",2006.563,2006.563,112,21,7,0)
 
"^DD",2006.563,2006.563,112,21,8,0)
An AE-Title is a string of up to 16 characters.
"^DD",2006.563,2006.563,112,21,9,0)
Since some systems also use AE-Titles as host-names for computers,
"^DD",2006.563,2006.563,112,21,10,0)
it is recommended that no spaces be used in AE-Titles.
"^DD",2006.563,2006.563,112,"DT")
3060405
"^DD",2006.563,2006.563,114,0)
IMPORTER^S^YES:YES;NO:NO;^IMPORTER;1^Q
"^DD",2006.563,2006.563,114,3)
Use Importer?
"^DD",2006.563,2006.563,114,21,0)
^.001^1^1^3090422^^^^
"^DD",2006.563,2006.563,114,21,1,0)
Indicates whether or not the Importer is to be used on the DICOM Image Gateway.  
"^DD",2006.563,2006.563,114,"DT")
3080618
"^DD",2006.563,2006.563,115,0)
IMPORTER LOG^F^^IMPORTER LOG;1^K:$L(X)>200!($L(X)<1) X
"^DD",2006.563,2006.563,115,3)
Provide the Importer's directory path; answer must be 1-200 characters in length.
"^DD",2006.563,2006.563,115,21,0)
^.001^1^1^3090422^^^^
"^DD",2006.563,2006.563,115,21,1,0)
The value of this field is the directory where the summary importer reports are created.
"^DD",2006.563,2006.563,115,"DT")
3080618
"^DD",2006.563,2006.563,116,0)
IMPORTER DRIVE^F^^IMPORTER DRIVE;1^K:$L(X)>3!($L(X)<1) X
"^DD",2006.563,2006.563,116,3)
Enter the drive letter; answer must be 1-3 characters in length.
"^DD",2006.563,2006.563,116,21,0)
^.001^1^1^3090422^^^^
"^DD",2006.563,2006.563,116,21,1,0)
This is the CD/DVD drive letter that is used by the Importer application.
"^DD",2006.563,2006.563,116,"DT")
3080618
"^DD",2006.563,2006.563,117,0)
IMPORTER ORDER LOCATION^P44'^SC(^IMPORTER ORDER LOCATION;1^Q
"^DD",2006.563,2006.563,117,3)
Select the Hospital Location entry.
"^DD",2006.563,2006.563,117,21,0)
^.001^3^3^3090422^^^
"^DD",2006.563,2006.563,117,21,1,0)
This field records the last hospital location used when placing a study
"^DD",2006.563,2006.563,117,21,2,0)
order on the DICOM Gateway.  This location is used as a default for the
"^DD",2006.563,2006.563,117,21,3,0)
next case to facilitate the ordering process. 
"^DD",2006.563,2006.563,117,"DT")
3080618
"^DD",2006.563,2006.563,118,0)
IMPORTER ORDER LOCATION NAME^F^^IMPORTER ORDER LOCATION NAME;1^K:$L(X)>30!($L(X)<2) X
"^DD",2006.563,2006.563,118,3)
Enter the name of the last location used in the ordering process; answer must be 2-30 characters in length.
"^DD",2006.563,2006.563,118,21,0)
^.001^2^2^3091228^^
"^DD",2006.563,2006.563,118,21,1,0)
The actual Hospital Location name is copied to this field when IMPORTER 
"^DD",2006.563,2006.563,118,21,2,0)
ORDER LOCATION field (#117) is updated.
"^DD",2006.563,2006.563,118,23,0)
^^2^2^3091228^
"^DD",2006.563,2006.563,118,23,1,0)
DICOM Gateway stores a redundant copy of this location, so that it is 
"^DD",2006.563,2006.563,118,23,2,0)
available for display when a connection to VistA is not available.
"^DD",2006.563,2006.563,118,"DT")
3091228
"^DD",2006.563,2006.563,119,0)
IMPORTER ORDER PROVIDER^P200'^VA(200,^IMPORTER ORDER PROVIDER;1^Q
"^DD",2006.563,2006.563,119,3)
Select the provider for this order.
"^DD",2006.563,2006.563,119,21,0)
^^3^3^3091228^
"^DD",2006.563,2006.563,119,21,1,0)
This field records the last provider used when placing a study order on 
"^DD",2006.563,2006.563,119,21,2,0)
the DICOM Gateway.  This provider is used as a default to facilitate the 
"^DD",2006.563,2006.563,119,21,3,0)
next order process.
"^DD",2006.563,2006.563,119,"DT")
3091228
"^DD",2006.563,2006.563,120,0)
IMPORTER ORDER PROVIDER NAME^F^^IMPORTER ORDER PROVIDER NAME;1^K:$L(X)>35!($L(X)<1) X
"^DD",2006.563,2006.563,120,3)
Enter the name of the last ordering provider; answer must be 1-35 characters in length.
"^DD",2006.563,2006.563,120,21,0)
^.001^4^4^3090422^^^^
"^DD",2006.563,2006.563,120,21,1,0)
The actual Provider's name is copied to this field when IMPORTER ORDER
"^DD",2006.563,2006.563,120,21,2,0)
PROVIDER field (#119) is updated.
"^DD",2006.563,2006.563,120,21,3,0)
DICOM Gateway store a redundant copy of the provider name, so that it 
"^DD",2006.563,2006.563,120,21,4,0)
is available for display when a connection to VistA is not available.
"^DD",2006.563,2006.563,120,"DT")
3090408
"^DD",2006.563,2006.563,121,0)
IMPORTER RAD DICT DOWNLOAD^D^^IMPORTER RAD DICT DOWNLOAD;1^S %DT="ETXR" D ^%DT S X=Y K:Y<1 X
"^DD",2006.563,2006.563,121,3)
Enter the date and time when the Radiology dictionaries were last downloaded.
"^DD",2006.563,2006.563,121,21,0)
^.001^3^3^3090422^^^^
"^DD",2006.563,2006.563,121,21,1,0)
The value of this field is the date/time the Radiology Procedure and
"^DD",2006.563,2006.563,121,21,2,0)
Modifier dictionaries were last downloaded.  Downloading automatically occurs
"^DD",2006.563,2006.563,121,21,3,0)
the first time the Importer is used each day.
"^DD",2006.563,2006.563,121,"DT")
3080618
"^DD",2006.563,2006.563,122,0)
IMPORTER RAD CAMERA^P78.6^RA(78.6,^IMPORTER RAD CAMERA;1^Q
"^DD",2006.563,2006.563,122,3)
Select the camera/equip/rm for this order.
"^DD",2006.563,2006.563,122,21,0)
^^3^3^3091228^
"^DD",2006.563,2006.563,122,21,1,0)
This field records the last camera/equip/rm used when placing a study 
"^DD",2006.563,2006.563,122,21,2,0)
order on the DICOM Gateway.  The camera/equip/rm is used as a default for 
"^DD",2006.563,2006.563,122,21,3,0)
the next case to facilitate the ordering process.
"^DD",2006.563,2006.563,122,"DT")
3091228
"^DD",2006.563,2006.563,123,0)
IMPORTER RAD CAMERA NAME^F^^IMPORTER RAD CAMERA NAME;1^K:$L(X)>30!($L(X)<1) X
"^DD",2006.563,2006.563,123,3)
Enter the name of the last camera/equip/rm used by the Importer; answer must be 1-30 characters in length.
"^DD",2006.563,2006.563,123,21,0)
^.001^5^5^3090424^^^
"^DD",2006.563,2006.563,123,21,1,0)
The actual Camera/Equip/Rm name is copied to this field when IMPORTER RAD
"^DD",2006.563,2006.563,123,21,2,0)
CAMERA FIELD (#122) is updated.
"^DD",2006.563,2006.563,123,21,3,0)
 
"^DD",2006.563,2006.563,123,21,4,0)
DICOM Gateway stores a redundant copy of the camera/equip/rm so that it is
"^DD",2006.563,2006.563,123,21,5,0)
available for display when a connection to VistA is not available.
"^DD",2006.563,2006.563,123,"DT")
3090424
"^DD",2006.563,2006.563,124,0)
IMPORTER RAD DX CODE^P78.3'^RA(78.3,^IMPORTER RAD DX CODE;1^Q
"^DD",2006.563,2006.563,124,3)
Select the diagnostic code for this order.
"^DD",2006.563,2006.563,124,21,0)
^.001^3^3^3090424^^^
"^DD",2006.563,2006.563,124,21,1,0)
This field records the last diagnostic code used when placing a study order
"^DD",2006.563,2006.563,124,21,2,0)
on the DICOM Gateway.  This location is used as a default for the next
"^DD",2006.563,2006.563,124,21,3,0)
case to facilitate the ordering process.
"^DD",2006.563,2006.563,124,"DT")
3090424
"^DD",2006.563,2006.563,125,0)
IMPORTER RAD DX CODE NAME^F^^IMPORTER RAD DX CODE NAME;1^K:$L(X)>60!($L(X)<1) X
"^DD",2006.563,2006.563,125,3)
Enter the name of the last diagnostic code used by the Importer; answer must be 1-60 characters in length.
"^DD",2006.563,2006.563,125,21,0)
^.001^6^6^3090424^^
"^DD",2006.563,2006.563,125,21,1,0)
The actual NAME OF THE DIAGNOSTIC CODE is copied to this field when
"^DD",2006.563,2006.563,125,21,2,0)
IMPORTER RAD DX CODE is updated.
"^DD",2006.563,2006.563,125,21,3,0)
 
"^DD",2006.563,2006.563,125,21,4,0)
DICOM Gateway stores a redundant copy of the Radiology diagnostic code
"^DD",2006.563,2006.563,125,21,5,0)
so that it is available for display when a connection to VistA is not
"^DD",2006.563,2006.563,125,21,6,0)
available.
"^DD",2006.563,2006.563,125,"DT")
3090424
"^DD",2006.563,2006.563,126,0)
IMPORTER RAD FILM SIZE^P78.4'^RA(78.4,^IMPORTER RAD FILM SIZE;1^Q
"^DD",2006.563,2006.563,126,3)
Select the film size for this order.
"^DD",2006.563,2006.563,126,21,0)
^^3^3^3091228^
"^DD",2006.563,2006.563,126,21,1,0)
This field records the last film size used when placing a study order on 
"^DD",2006.563,2006.563,126,21,2,0)
the DICOM Gateway.  This film size will be used as a default for the next 
"^DD",2006.563,2006.563,126,21,3,0)
case to facilitate the ordering process.
"^DD",2006.563,2006.563,126,"DT")
3091228
"^DD",2006.563,2006.563,127,0)
IMPORTER RAD FILM SIZE NAME^F^^IMPORTER RAD FILM SIZE NAME;1^K:$L(X)>30!($L(X)<1) X
"^DD",2006.563,2006.563,127,3)
Enter the last film size used by the Importer; answer must be 1-30 characters in length.
"^DD",2006.563,2006.563,127,21,0)
^.001^5^5^3090506^^^^
"^DD",2006.563,2006.563,127,21,1,0)
The actual Film Size name is copied to this field when IMPORTER RAD FILM
"^DD",2006.563,2006.563,127,21,2,0)
SIZE field (#126) is updated.
"^DD",2006.563,2006.563,127,21,3,0)
 
"^DD",2006.563,2006.563,127,21,4,0)
DICOM Gateway stores a redundant copy of this Film Size name so that it is
"^DD",2006.563,2006.563,127,21,5,0)
available for display when a connection to VistA is not available.
"^DD",2006.563,2006.563,127,"DT")
3090424
"^DD",2006.563,2006.563,128,0)
IMPORT RAD TECH^P200'^VA(200,^IMPORTER RAD TECH;1^Q
"^DD",2006.563,2006.563,128,3)
Select the Radiology technician for this order.
"^DD",2006.563,2006.563,128,21,0)
^.001^3^3^3090424^^
"^DD",2006.563,2006.563,128,21,1,0)
This field records the last Radiology technician used when placing a 
"^DD",2006.563,2006.563,128,21,2,0)
study order on the DICOM Gateway.  This technician will be used as the
"^DD",2006.563,2006.563,128,21,3,0)
default for the next case to facilitate the ordering process.
"^DD",2006.563,2006.563,128,"DT")
3090424
"^DD",2006.563,2006.563,129,0)
IMPORTER RAD TECH NAME^F^^IMPORTER RAD TECH NAME;1^K:$L(X)>35!($L(X)<1) X
"^DD",2006.563,2006.563,129,3)
Enter the last Radiology technician used by the Importer; answer must be 1-35 characters in length.
"^DD",2006.563,2006.563,129,21,0)
^.001^4^4^3090428^^
"^DD",2006.563,2006.563,129,21,1,0)
The actual Radiology technician name is copied to this field when the IMPORTER RAD TECH field (#128) is updated.
"^DD",2006.563,2006.563,129,21,2,0)
 
"^DD",2006.563,2006.563,129,21,3,0)
DICOM Gateway stores a redundant copy of the technician name, so that it is
"^DD",2006.563,2006.563,129,21,4,0)
available for display when a connection to VistA is not available.
"^DD",2006.563,2006.563,129,"DT")
3090424
"^DD",2006.563,2006.563,130,0)
LOCATION STATION NUMBER^RF^^LOCATION STATION NUMBER;1^K:$L(X)>7!($L(X)<3)!'(X?3N.AN) X
"^DD",2006.563,2006.563,130,3)
Answer must be 3-7 characters in length.
"^DD",2006.563,2006.563,130,21,0)
^.001^4^4^3100820^^^^
"^DD",2006.563,2006.563,130,21,1,0)
This is the 3 digit station number plus any modifiers.
"^DD",2006.563,2006.563,130,21,2,0)
The value of this field is the same as the STATION NUMBER
"^DD",2006.563,2006.563,130,21,3,0)
field (#99) of the INSTITUTION file (#4), as pointed to by
"^DD",2006.563,2006.563,130,21,4,0)
the LOCATION field (#17) of this file.
"^DD",2006.563,2006.563,130,"DT")
3100702
"^DD",2006.563,2006.5631,0)
DATA PATH SUB-FIELD^^2^3
"^DD",2006.563,2006.5631,0,"DT")
3010227
"^DD",2006.563,2006.5631,0,"IX","B",2006.5631,.01)

"^DD",2006.563,2006.5631,0,"NM","DATA PATH")

"^DD",2006.563,2006.5631,0,"UP")
2006.563
"^DD",2006.563,2006.5631,.001,0)
NUMBER^NJ3,0^^ ^K:+X'=X!(X>999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.563,2006.5631,.001,3)
Enter the sequence number of this data channel.
"^DD",2006.563,2006.5631,.001,21,0)
^^2^2^3010227^^
"^DD",2006.563,2006.5631,.001,21,1,0)
The value of this field is an integer number that represents
"^DD",2006.563,2006.5631,.001,21,2,0)
the channel number of the data channel being described in this record.
"^DD",2006.563,2006.5631,.001,"DT")
3010227
"^DD",2006.563,2006.5631,.01,0)
CHANNEL^RNJ3,0X^^0;1^K:+X'=X!(X>999)!(X<0)!(X?.E1"."1N.N) X S:$D(X) DINUM=X
"^DD",2006.563,2006.5631,.01,1,0)
^.1
"^DD",2006.563,2006.5631,.01,1,1,0)
2006.5631^B
"^DD",2006.563,2006.5631,.01,1,1,1)
S ^MAGDICOM(2006.563,DA(1),"DATA PATH","B",$E(X,1,30),DA)=""
"^DD",2006.563,2006.5631,.01,1,1,2)
K ^MAGDICOM(2006.563,DA(1),"DATA PATH","B",$E(X,1,30),DA)
"^DD",2006.563,2006.5631,.01,3)
Enter the sequence number of this data channel.
"^DD",2006.563,2006.5631,.01,21,0)
^^2^2^3010227^^
"^DD",2006.563,2006.5631,.01,21,1,0)
The value of this field is an integer number that represents
"^DD",2006.563,2006.5631,.01,21,2,0)
the channel number of the data channel being described in this record.
"^DD",2006.563,2006.5631,.01,"DT")
3010227
"^DD",2006.563,2006.5631,2,0)
PATH^F^^0;2^K:$L(X)>50!($L(X)<1) X
"^DD",2006.563,2006.5631,2,3)
Enter the directory-prefix for this data channel.
"^DD",2006.563,2006.5631,2,21,0)
^^4^4^3010227^^
"^DD",2006.563,2006.5631,2,21,1,0)
The value of this field is the 'path-prefix'
"^DD",2006.563,2006.5631,2,21,2,0)
that needs to be applied to gain access to the
"^DD",2006.563,2006.5631,2,21,3,0)
files that are created to implement the FIFO
"^DD",2006.563,2006.5631,2,21,4,0)
queues.
"^DD",2006.563,2006.5631,2,"DT")
3010227
"^DD",2006.563,2006.5632,0)
PROFILE SUB-FIELD^^4^4
"^DD",2006.563,2006.5632,0,"DT")
3040303
"^DD",2006.563,2006.5632,0,"IX","B",2006.5632,.01)

"^DD",2006.563,2006.5632,0,"NM","PROFILE")

"^DD",2006.563,2006.5632,0,"UP")
2006.563
"^DD",2006.563,2006.5632,.01,0)
USER^NJ12,0^^0;1^K:+X'=X!(X>999999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2006.563,2006.5632,.01,1,0)
^.1
"^DD",2006.563,2006.5632,.01,1,1,0)
2006.5632^B
"^DD",2006.563,2006.5632,.01,1,1,1)
S ^MAGDICOM(2006.563,DA(1),"PROFILE","B",$E(X,1,30),DA)=""
"^DD",2006.563,2006.5632,.01,1,1,2)
K ^MAGDICOM(2006.563,DA(1),"PROFILE","B",$E(X,1,30),DA)
"^DD",2006.563,2006.5632,.01,3)
Enter a number that uniquely identifies this user.
"^DD",2006.563,2006.5632,.01,21,0)
^.001^3^3^3021002^^
"^DD",2006.563,2006.5632,.01,21,1,0)
The value of this field is an integer number that identifies a user.
"^DD",2006.563,2006.5632,.01,21,2,0)
The value for this field is copied from the value of "DUZ" (user number)
"^DD",2006.563,2006.5632,.01,21,3,0)
on the VistA system where this number is registered.
"^DD",2006.563,2006.5632,.01,"DT")
3021002
"^DD",2006.563,2006.5632,1,0)
ACCESS LEVEL^S^1:Full Access;2:View Only Access;^0;2^Q
"^DD",2006.563,2006.5632,1,3)
Indicate the access level for this user.
"^DD",2006.563,2006.5632,1,21,0)
^^5^5^3021002^
"^DD",2006.563,2006.5632,1,21,1,0)
The value of this field is a code that identifies the
"^DD",2006.563,2006.5632,1,21,2,0)
access level (on the DICOM Gateway) for the current user.
"^DD",2006.563,2006.5632,1,21,3,0)
 
"^DD",2006.563,2006.5632,1,21,4,0)
On a DICOM Gateway, a user can have full access (value is 1)
"^DD",2006.563,2006.5632,1,21,5,0)
or view only access (value is 2).
"^DD",2006.563,2006.5632,1,"DT")
3021002
"^DD",2006.563,2006.5632,2,0)
VISTA ACCESS INFO^F^^0;3^K:$L(X)>63!($L(X)<1) X
"^DD",2006.563,2006.5632,2,3)
Enter access information for this user.
"^DD",2006.563,2006.5632,2,21,0)
^^3^3^3021002^
"^DD",2006.563,2006.5632,2,21,1,0)
The value of this field, which is stored in an encrypted
"^DD",2006.563,2006.5632,2,21,2,0)
fashion, is a string that is passed to a VistA system as
"^DD",2006.563,2006.5632,2,21,3,0)
the access and verify codes for the current user.
"^DD",2006.563,2006.5632,2,"DT")
3021002
"^DD",2006.563,2006.5632,4,0)
VISTA SERVICE ACCOUNT^F^^0;4^K:$L(X)>63!($L(X)<1) X
"^DD",2006.563,2006.5632,4,3)
Enter the (encrypted) service credentials.
"^DD",2006.563,2006.5632,4,21,0)
^^11^11^3040303^
"^DD",2006.563,2006.5632,4,21,1,0)
The value of this field is a string containing encrypted data.
"^DD",2006.563,2006.5632,4,21,2,0)
This value contains the access and verify codes that the DICOM Gateway
"^DD",2006.563,2006.5632,4,21,3,0)
is allowed to use as a "service account" when the credentials that
"^DD",2006.563,2006.5632,4,21,4,0)
were provided by the end-user during login expire during the course
"^DD",2006.563,2006.5632,4,21,5,0)
of the session.
"^DD",2006.563,2006.5632,4,21,6,0)
 
"^DD",2006.563,2006.5632,4,21,7,0)
This field is automatically populated when an end-user successfully
"^DD",2006.563,2006.5632,4,21,8,0)
logs in on a DICOM Gateway.
"^DD",2006.563,2006.5632,4,21,9,0)
 
"^DD",2006.563,2006.5632,4,21,10,0)
When a site decides not to have such a service account, the value
"^DD",2006.563,2006.5632,4,21,11,0)
of this field will be an encrypted value for the string ";".
"^DD",2006.563,2006.5632,4,"DT")
3040303
"^DD",2006.563,2006.5633,0)
PACS QUERY SUB-FIELD^^2^2
"^DD",2006.563,2006.5633,0,"DT")
3040303
"^DD",2006.563,2006.5633,0,"IX","B",2006.5633,.01)

"^DD",2006.563,2006.5633,0,"NM","PACS QUERY")

"^DD",2006.563,2006.5633,0,"UP")
2006.563
"^DD",2006.563,2006.5633,.01,0)
PACS QUERY START^F^^0;1^K:$L(X)>20!($L(X)<1) X
"^DD",2006.563,2006.5633,.01,1,0)
^.1
"^DD",2006.563,2006.5633,.01,1,1,0)
2006.5633^B
"^DD",2006.563,2006.5633,.01,1,1,1)
S ^MAGDICOM(2006.563,DA(1),"GE CONV #HRS","B",$E(X,1,30),DA)=""
"^DD",2006.563,2006.5633,.01,1,1,2)
K ^MAGDICOM(2006.563,DA(1),"GE CONV #HRS","B",$E(X,1,30),DA)
"^DD",2006.563,2006.5633,.01,3)
Indicate when this query session started.
"^DD",2006.563,2006.5633,.01,21,0)
^.001^3^3^3040303^^
"^DD",2006.563,2006.5633,.01,21,1,0)
The value of this field is a timestamp ($HOROLOG) that
"^DD",2006.563,2006.5633,.01,21,2,0)
indicates the date and time when a PACS query process
"^DD",2006.563,2006.5633,.01,21,3,0)
was started.
"^DD",2006.563,2006.5633,.01,"DT")
3040303
"^DD",2006.563,2006.5633,2,0)
PACS QUERY END^F^^1;1^K:$L(X)>20!($L(X)<1) X
"^DD",2006.563,2006.5633,2,3)
Indicate when this query ended.
"^DD",2006.563,2006.5633,2,21,0)
^^7^7^3040303^
"^DD",2006.563,2006.5633,2,21,1,0)
The value of this field is a timestamp ($HOROLOG) that
"^DD",2006.563,2006.5633,2,21,2,0)
indicates the date and time when a PACS query process
"^DD",2006.563,2006.5633,2,21,3,0)
completed.
"^DD",2006.563,2006.5633,2,21,4,0)
  
"^DD",2006.563,2006.5633,2,21,5,0)
Note: when a PACS query process was terminated as a side-effect
"^DD",2006.563,2006.5633,2,21,6,0)
of a system-shut-down operation, no completion time
"^DD",2006.563,2006.5633,2,21,7,0)
will be recorded.
"^DD",2006.563,2006.5633,2,"DT")
3040303
"^DD",2006.563,2006.5634,0)
INSTALLATION SUB-FIELD^^1^2
"^DD",2006.563,2006.5634,0,"DT")
3021212
"^DD",2006.563,2006.5634,0,"NM","INSTALLATION")

"^DD",2006.563,2006.5634,0,"UP")
2006.563
"^DD",2006.563,2006.5634,.01,0)
INSTALLATION^F^^0;1^K:$L(X)>14!($L(X)<3)!'(X?1.N1"."1.5N) X
"^DD",2006.563,2006.5634,.01,1,0)
^.1^^0
"^DD",2006.563,2006.5634,.01,3)
Enter the time-stamp ($H-format) for this installation.
"^DD",2006.563,2006.5634,.01,21,0)
^.001^3^3^3021212^^
"^DD",2006.563,2006.5634,.01,21,1,0)
The value of this field is a time-stamp (in $Horolog-format) that
"^DD",2006.563,2006.5634,.01,21,2,0)
identifies the date and time when the current installation of
"^DD",2006.563,2006.5634,.01,21,3,0)
software on the current DICOM Gateway completed.
"^DD",2006.563,2006.5634,.01,"DT")
3021212
"^DD",2006.563,2006.5634,1,0)
COMMENT^F^^0;2^K:$L(X)>60!($L(X)<1) X
"^DD",2006.563,2006.5634,1,3)
Enter a comment that identifies this installation.
"^DD",2006.563,2006.5634,1,21,0)
^^2^2^3021212^
"^DD",2006.563,2006.5634,1,21,1,0)
The value of this field is a text that describes the
"^DD",2006.563,2006.5634,1,21,2,0)
software that was installed.
"^DD",2006.563,2006.5634,1,"DT")
3021212
"^DD",2006.563,2006.5635,0)
WORKLIST PORT SUB-FIELD^^.01^1
"^DD",2006.563,2006.5635,0,"DT")
3051028
"^DD",2006.563,2006.5635,0,"IX","B",2006.5635,.01)

"^DD",2006.563,2006.5635,0,"NM","WORKLIST PORT")

"^DD",2006.563,2006.5635,0,"UP")
2006.563
"^DD",2006.563,2006.5635,.01,0)
WORKLIST PORT^NJ5,0^^0;1^K:+X'=X!(X>65535)!(X<1)!(X?.E1"."1N.N) X
"^DD",2006.563,2006.5635,.01,1,0)
^.1
"^DD",2006.563,2006.5635,.01,1,1,0)
2006.5635^B
"^DD",2006.563,2006.5635,.01,1,1,1)
S ^MAGDICOM(2006.563,DA(1),"WORKLIST PORT","B",$E(X,1,30),DA)=""
"^DD",2006.563,2006.5635,.01,1,1,2)
K ^MAGDICOM(2006.563,DA(1),"WORKLIST PORT","B",$E(X,1,30),DA)
"^DD",2006.563,2006.5635,.01,3)
Enter a TCP/IP port number (between 1 and 65536).
"^DD",2006.563,2006.5635,.01,21,0)
^^3^3^3051028^
"^DD",2006.563,2006.5635,.01,21,1,0)
The value of this field is an integer number that identifies
"^DD",2006.563,2006.5635,.01,21,2,0)
the TCP/IP port that will be used by DICOM WorkList processes
"^DD",2006.563,2006.5635,.01,21,3,0)
to post their requests and obtain their results.
"^DD",2006.563,2006.5635,.01,"DT")
3051028
"^DIC",2006.15,2006.15,0)
DICOM UID ROOT^2006.15
"^DIC",2006.15,2006.15,0,"GL")
^MAGD(2006.15,
"^DIC",2006.15,2006.15,"%D",0)
^^24^24^3040212^^
"^DIC",2006.15,2006.15,"%D",1,0)
 +---------------------------------------------------------------+
"^DIC",2006.15,2006.15,"%D",2,0)
 | Property of the US Government.                                |
"^DIC",2006.15,2006.15,"%D",3,0)
 | No permission to copy or redistribute this software is given. |
"^DIC",2006.15,2006.15,"%D",4,0)
 | Use of unreleased versions of this software requires the user |
"^DIC",2006.15,2006.15,"%D",5,0)
 | to execute a written test agreement with the VistA Imaging    |
"^DIC",2006.15,2006.15,"%D",6,0)
 | Development Office of the Department of Veterans Affairs,     |
"^DIC",2006.15,2006.15,"%D",7,0)
 | telephone (301) 734-0100.                                     |
"^DIC",2006.15,2006.15,"%D",8,0)
 |                                                               |
"^DIC",2006.15,2006.15,"%D",9,0)
 | The Food and Drug Administration classifies this software as  |
"^DIC",2006.15,2006.15,"%D",10,0)
 | a medical device.  As such, it may not be changed in any way. |
"^DIC",2006.15,2006.15,"%D",11,0)
 | Modifications to this software may result in an adulterated   |
"^DIC",2006.15,2006.15,"%D",12,0)
 | medical device under 21CFR820, the use of which is considered |
"^DIC",2006.15,2006.15,"%D",13,0)
 | to be a violation of US Federal Statutes.                     |
"^DIC",2006.15,2006.15,"%D",14,0)
 +---------------------------------------------------------------+
"^DIC",2006.15,2006.15,"%D",15,0)
 
"^DIC",2006.15,2006.15,"%D",16,0)
The purpose of this table is to specify the first groups
"^DIC",2006.15,2006.15,"%D",17,0)
of digits for the unique object identifiers that will be
"^DIC",2006.15,2006.15,"%D",18,0)
generated by the software.
"^DIC",2006.15,2006.15,"%D",19,0)
Note that this "root" for the UIDs is organization-specific,
"^DIC",2006.15,2006.15,"%D",20,0)
and that the FOIA release of this software will only
"^DIC",2006.15,2006.15,"%D",21,0)
include data for this table for VA sites.
"^DIC",2006.15,2006.15,"%D",22,0)
 
"^DIC",2006.15,2006.15,"%D",23,0)
See the DICOM Standard (www.nema.org/dicom) PS 3.8 Annex A
"^DIC",2006.15,2006.15,"%D",24,0)
for instructions on how to obtain a valid UID root.
"^DIC",2006.15,"B","DICOM UID ROOT",2006.15)

"^DIC",2006.55,2006.55,0)
DICOM WORKLIST PATIENT^2006.55
"^DIC",2006.55,2006.55,0,"GL")
^MAGDWLST(2006.55,
"^DIC",2006.55,2006.55,"%",0)
^1.005^^0
"^DIC",2006.55,2006.55,"%D",0)
^^36^36^3010620^
"^DIC",2006.55,2006.55,"%D",1,0)
 +---------------------------------------------------------------+
"^DIC",2006.55,2006.55,"%D",2,0)
 |                                                               |
"^DIC",2006.55,2006.55,"%D",3,0)
 | Property of the US Government.                                |
"^DIC",2006.55,2006.55,"%D",4,0)
 | No permission to copy or redistribute this software is given. |
"^DIC",2006.55,2006.55,"%D",5,0)
 | Use of unreleased versions of this software requires the user |
"^DIC",2006.55,2006.55,"%D",6,0)
 | to execute a written test agreement with the VistA Imaging    |
"^DIC",2006.55,2006.55,"%D",7,0)
 | Development Office of the Department of Veterans Affairs,     |
"^DIC",2006.55,2006.55,"%D",8,0)
 | telephone (301) 734-0100.                                     |
"^DIC",2006.55,2006.55,"%D",9,0)
 |                                                               |
"^DIC",2006.55,2006.55,"%D",10,0)
 | The Food and Drug Administration classifies this software as  |
"^DIC",2006.55,2006.55,"%D",11,0)
 | a medical device.  As such, it may not be changed in any way. |
"^DIC",2006.55,2006.55,"%D",12,0)
 | Modifications to this software may result in an adulterated   |
"^DIC",2006.55,2006.55,"%D",13,0)
 | medical device under 21CFR820, the use of which is considered |
"^DIC",2006.55,2006.55,"%D",14,0)
 | to be a violation of US Federal Statutes.                     |
"^DIC",2006.55,2006.55,"%D",15,0)
 |                                                               |
"^DIC",2006.55,2006.55,"%D",16,0)
 +---------------------------------------------------------------+
"^DIC",2006.55,2006.55,"%D",17,0)
 
"^DIC",2006.55,2006.55,"%D",18,0)
The entries in this table contain the demographic information for the various
"^DIC",2006.55,2006.55,"%D",19,0)
patients, for whom tasks are recorded on the worklist for a DICOM "modality".
"^DIC",2006.55,2006.55,"%D",20,0)
The top-level information in this table separates the patients from the
"^DIC",2006.55,2006.55,"%D",21,0)
various clinics at a consolidated site; the next level contains the patient
"^DIC",2006.55,2006.55,"%D",22,0)
information.
"^DIC",2006.55,2006.55,"%D",23,0)
 
"^DIC",2006.55,2006.55,"%D",24,0)
This file contains temporary copies of information from the VistA
"^DIC",2006.55,2006.55,"%D",25,0)
system that live on our satellite systems for the duration of the
"^DIC",2006.55,2006.55,"%D",26,0)
study that produces the images, and the only reason for
"^DIC",2006.55,2006.55,"%D",27,0)
replicating the information onto these "DICOM Gateway Stations"
"^DIC",2006.55,2006.55,"%D",28,0)
is that we want to be able to allow the acquisition of images and
"^DIC",2006.55,2006.55,"%D",29,0)
the presentation of "worklist information" to continue, even
"^DIC",2006.55,2006.55,"%D",30,0)
while the VistA system is down, or when the RPC connection
"^DIC",2006.55,2006.55,"%D",31,0)
between our Gateways and the VistA system is not operating. 
"^DIC",2006.55,2006.55,"%D",32,0)
 
"^DIC",2006.55,2006.55,"%D",33,0)
Information is copied from VistA to DICOM Gateway when an HL7
"^DIC",2006.55,2006.55,"%D",34,0)
message is processed that announces the "exam", and removed when
"^DIC",2006.55,2006.55,"%D",35,0)
an HL7 message is processed that announces that the exam is
"^DIC",2006.55,2006.55,"%D",36,0)
carried out. 
"^DIC",2006.55,"B","DICOM WORKLIST PATIENT",2006.55)

"^DIC",2006.56,2006.56,0)
DICOM WORKLIST STUDY^2006.56
"^DIC",2006.56,2006.56,0,"GL")
^MAGDWLST(2006.56,
"^DIC",2006.56,2006.56,"%",0)
^1.005^^0
"^DIC",2006.56,2006.56,"%D",0)
^^36^36^3010619^
"^DIC",2006.56,2006.56,"%D",1,0)
 +---------------------------------------------------------------+
"^DIC",2006.56,2006.56,"%D",2,0)
 |                                                               |
"^DIC",2006.56,2006.56,"%D",3,0)
 | Property of the US Government.                                |
"^DIC",2006.56,2006.56,"%D",4,0)
 | No permission to copy or redistribute this software is given. |
"^DIC",2006.56,2006.56,"%D",5,0)
 | Use of unreleased versions of this software requires the user |
"^DIC",2006.56,2006.56,"%D",6,0)
 | to execute a written test agreement with the VistA Imaging    |
"^DIC",2006.56,2006.56,"%D",7,0)
 | Development Office of the Department of Veterans Affairs,     |
"^DIC",2006.56,2006.56,"%D",8,0)
 | telephone (301) 734-0100.                                     |
"^DIC",2006.56,2006.56,"%D",9,0)
 |                                                               |
"^DIC",2006.56,2006.56,"%D",10,0)
 | The Food and Drug Administration classifies this software as  |
"^DIC",2006.56,2006.56,"%D",11,0)
 | a medical device.  As such, it may not be changed in any way. |
"^DIC",2006.56,2006.56,"%D",12,0)
 | Modifications to this software may result in an adulterated   |
"^DIC",2006.56,2006.56,"%D",13,0)
 | medical device under 21CFR820, the use of which is considered |
"^DIC",2006.56,2006.56,"%D",14,0)
 | to be a violation of US Federal Statutes.                     |
"^DIC",2006.56,2006.56,"%D",15,0)
 |                                                               |
"^DIC",2006.56,2006.56,"%D",16,0)
 +---------------------------------------------------------------+
"^DIC",2006.56,2006.56,"%D",17,0)
 
"^DIC",2006.56,2006.56,"%D",18,0)
The entries in this table contain the information about the various
"^DIC",2006.56,2006.56,"%D",19,0)
studies that are recorded as tasks on the worklist for a DICOM "modality".
"^DIC",2006.56,2006.56,"%D",20,0)
The top-level information in this table separates the activities from the
"^DIC",2006.56,2006.56,"%D",21,0)
various clinics at a consolidated site; the next level contains the study
"^DIC",2006.56,2006.56,"%D",22,0)
information.
"^DIC",2006.56,2006.56,"%D",23,0)
 
"^DIC",2006.56,2006.56,"%D",24,0)
This file contains temporary copies of information from the VistA
"^DIC",2006.56,2006.56,"%D",25,0)
system that live on our satellite systems for the duration of the
"^DIC",2006.56,2006.56,"%D",26,0)
study that produces the images, and the only reason for
"^DIC",2006.56,2006.56,"%D",27,0)
replicating the information onto these "DICOM Gateway Stations"
"^DIC",2006.56,2006.56,"%D",28,0)
is that we want to be able to allow the acquisition of images and
"^DIC",2006.56,2006.56,"%D",29,0)
the presentation of "worklist information" to continue, even
"^DIC",2006.56,2006.56,"%D",30,0)
while the VistA system is down, or when the DDP connection
"^DIC",2006.56,2006.56,"%D",31,0)
between our Gateways and the VistA system is not operating. 
"^DIC",2006.56,2006.56,"%D",32,0)
 
"^DIC",2006.56,2006.56,"%D",33,0)
Information is copied from VistA to DICOM Gateway when an HL7
"^DIC",2006.56,2006.56,"%D",34,0)
message is processed that announces the "exam", and removed when
"^DIC",2006.56,2006.56,"%D",35,0)
an HL7 message is processed that announces that the exam is
"^DIC",2006.56,2006.56,"%D",36,0)
carried out. 
"^DIC",2006.563,2006.563,0)
DICOM GATEWAY PARAMETER^2006.563
"^DIC",2006.563,2006.563,0,"GL")
^MAGDICOM(2006.563,
"^DIC",2006.563,2006.563,"%",0)
^1.005^^0
"^DIC",2006.563,2006.563,"%D",0)
^^24^24^3020815^
"^DIC",2006.563,2006.563,"%D",1,0)
 +---------------------------------------------------------------+
"^DIC",2006.563,2006.563,"%D",2,0)
 |                                                               |
"^DIC",2006.563,2006.563,"%D",3,0)
 | Property of the US Government.                                |
"^DIC",2006.563,2006.563,"%D",4,0)
 | No permission to copy or redistribute this software is given. |
"^DIC",2006.563,2006.563,"%D",5,0)
 | Use of unreleased versions of this software requires the user |
"^DIC",2006.563,2006.563,"%D",6,0)
 | to execute a written test agreement with the VistA Imaging    |
"^DIC",2006.563,2006.563,"%D",7,0)
 | Development Office of the Department of Veterans Affairs,     |
"^DIC",2006.563,2006.563,"%D",8,0)
 | telephone (301) 734-0100.                                     |
"^DIC",2006.563,2006.563,"%D",9,0)
 |                                                               |
"^DIC",2006.563,2006.563,"%D",10,0)
 | The Food and Drug Administration classifies this software as  |
"^DIC",2006.563,2006.563,"%D",11,0)
 | a medical device.  As such, it may not be changed in any way. |
"^DIC",2006.563,2006.563,"%D",12,0)
 | Modifications to this software may result in an adulterated   |
"^DIC",2006.563,2006.563,"%D",13,0)
 | medical device under 21CFR820, the use of which is considered |
"^DIC",2006.563,2006.563,"%D",14,0)
 | to be a violation of US Federal Statutes.                     |
"^DIC",2006.563,2006.563,"%D",15,0)
 |                                                               |
"^DIC",2006.563,2006.563,"%D",16,0)
 +---------------------------------------------------------------+
"^DIC",2006.563,2006.563,"%D",17,0)
 
"^DIC",2006.563,2006.563,"%D",18,0)
This table contains only one entry.
"^DIC",2006.563,2006.563,"%D",19,0)
The information in this entry defines the customization for the DICOM
"^DIC",2006.563,2006.563,"%D",20,0)
Gateway Processor on which this table is stored.
"^DIC",2006.563,2006.563,"%D",21,0)
Note that some site-specific parameters apply to the whole site, those
"^DIC",2006.563,2006.563,"%D",22,0)
parameters are stored in the table "IMAGING SITE PARAMETERS", and other
"^DIC",2006.563,2006.563,"%D",23,0)
parameters apply to the individual PCs. The latter parameters are stored
"^DIC",2006.563,2006.563,"%D",24,0)
in this table.
"^DIC",2006.563,"B","DICOM GATEWAY PARAMETER",2006.563)

"^DIC",2006.56,"B","DICOM WORKLIST STUDY",2006.56)

**END**
**END**


****
****
