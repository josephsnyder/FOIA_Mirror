
=============================================================================
Run Date: SEP 30, 2011                     Designation: MAG*3*99
Package : MAG - IMAGING                       Priority: Mandatory
Version : 3        SEQ #78                      Status: Released
                  Compliance Date: NOV 30, 2011
=============================================================================

Associated patches: (v)MAG*3*39    <<= must be installed BEFORE `MAG*3*99'
                    (v)MAG*3*49    <<= must be installed BEFORE `MAG*3*99'
                    (v)MAG*3*53    <<= must be installed BEFORE `MAG*3*99'
                    (v)RA*5*90     <<= must be installed BEFORE `MAG*3*99'
                    (v)MAG*3*106   <<= must be installed BEFORE `MAG*3*99'

Subject: STORING DICOM OBJECT, PHASE III

Category: 
  - Routine
  - Data Dictionary
  - Enhancement (Mandatory)

Description:
============

 This patch:
  
 * Allows the optional storage of currently supported DICOM images in 
   DICOM format without changing or transforming the presentation. This 
   includes files from modalities, such as CR and DX, which previously
   could only be stored in TGA format.
  
 * Enhances error checking of the Modality dictionary (Modality.dic) 
   settings to prevent changes to the original image files and to ensure 
   that the reduction values are appropriately applied to the reduced 
   version of the images.
  
 * Allows users to revert back to storing DICOM images in TGA format for a 
   specific modality, if necessary.
  
 * Includes a new abstract maker, which is more efficient and which will 
   replace both abstract makers that currently reside on the DICOM Gateway.
  
 * Updates the Registry of Standard SOP Classes and UIDs in the DICOM 
   Gateway dictionaries and software to reflect the current DICOM standard 
   from Table A.1, PS 3.6 2008.
  
 * Allows the transparent operation of:
   - Image storage on the VistA HIS
   - Clinical Display
   - Clinical Capture
   - Remote Image View
   - VistARad
   - VIX 
   - Routing
   - Background Processor
   - DICOM Export
   - Abstract Creation
  
 NOTE: All sites running VistA Imaging 3.0 that have implemented DICOM 
       Gateways must install the KIDS portion of this patch on the VistA
       system and the updated DICOM Gateway software on all DICOM Gateway
       systems.
  
 Distribution of Software
 ========================
  
 The release build of this patch can be downloaded from the individual 
 site folders for the controlled release:
  
 ftp.imaging.med.va.gov/Software/Sites/<yoursite>/Mag3_0P99
  
 Site will be contacted to schedule the installation.
  
 Installation instructions are included in this document.
  
 NOTE: Information about last-minute changes to this patch will be 
       provided in a readme file. If present, this file will also be
       located in the MAG3_0P99 directory.
  
 Patch Contents
 ==============
  
 This patch includes the following files:
  
 Software
 ========
  
 MAG3_0P99_DICOM_SETUP.exe - Installation Program for DICOM Gateway.
  
 MAG3_0P99.KID - KIDS (Kernel Installation & Distribution System) package 
                 to be installed on the VistA system.
  
 Documentation 
 =============
  
 MAG3_0P99_Patch_Description.pdf - Detailed patch description, with DICOM 
                                   Gateway installation instructions.
  
 MAG3_0P99_DICOM_user_change.pdf - Updated information for the DICOM 
                                   Gateway User Manual.
  
 MAG3_0P99_DICOM_install_change.pdf - Updates for the DICOM Gateway 
                                      Installation Guide.
  
 MAG3_0P99_tech_man_change.pdf - Updates for the Technical Manual. 
  
 Associated Patches
 ==================
  
 All released VistA Imaging patches are required and must be installed on 
 the VistA system before Patch 99 can be installed.
  
 The KIDS files to be installed on VistA:
  
     MAG*3.0*99
  
 For a list of all released Imaging (MAG) patches, refer to the 
 patch_list.txt file, which is available on the Imaging FTP server. To 
 locate the file, go to ftp://ftp.imaging.med.va.gov. Then, navigate to 
 the \Docs\Imaging_Docs_Latest folder.
  
 Patches to be installed on the DICOM Gateway:
  
         MAG*3.0*99
  
 Test Sites
 ==========
  
 The following sites are test sites for this patch:
  
  Charleston, SC (Large)
  Fayetteville, NC (Large)
  Seattle, WA (Integrated, Large)
  
 Remedy Calls
 ============
  
 The following Remedy help desk calls are addressed in this patch:
  
 139805  Patient Info doesn t transfer to Imaging from a new Siemens  
         The patient information of images acquired using a new Siemens
         angiography unit did not transfer to VistA. 
         MAG*3.0*99 resolves this issue by enabling all currently 
         supported SOP classes to be stored in DICOM format. 
  
 211340  Images not being saved  
         Some mammography images could not be stored. 
         MAG*3.0*99 resolves this issue by enabling all currently 
         supported SOP classes to be stored in DICOM format.
  
 227843  Storing mammograms in DICOM format   
         There was a problem storing some mammograms in DICOM format. 
         MAG*3.0*99 resolves this issue by enabling all currently 
         supported SOP classes to be stored in DICOM format.
  
 253811  Undefined modalities  
         MAG*3.0*99 resolves this issue by introducing default 
         modalities.
  
 265268  Vista Img 3.0-PET/CT (fused MPR images)  
         The images belong to a supported SOP class that must be saved
         in DICOM format.
         MAG*3.0*99 resolves the issue by allowing images from currently
         supported SOP classes to be stored in DICOM format.
  
 296933  Adding Petscan modality  
         The images from the modality belong to currently supported SOP
         classes.
         MAG*3.0*99 resolves the issue by allowing images from currently
         supported SOP classes to be stored in DICOM format.
  
  
 NSRs
 ====
  
 There are no National Service Requests (NSRs) addressed in this patch. 
  
 KIDS File Summary
 =================
  
 Security Keys
 =============
  
 There are no new or modified security keys included in this patch.
  
 Remote Procedure Calls
 ======================
  
 No Procedure calls are affected by this patch
  
 Menu Options
 ============
  
 There are no new menu options in this patch.
  
 Data Dictionaries
 =================
  
 The following files are new or modified in Patch 99:
  
 IMAGE FILE (#2005) - Modified field: 
  
   - BIG FILE EXTENSION field (#104) This field holds the image file 
     extension, such as DCM or BIG. It is a free text field (3-5
     characters). Previously this field was not used.
  
 IMAGE AUDIT (#2005.1) - Modified field: 
  
   - BIG FILE EXTENSION field (#104) This field holds the image file 
     extension, such as DCM or BIG. It is a free text field (3-5
     characters). Previously this field was not used.
  
 INSTRUMENT DICTIONARY (#2006.581)
  
   o MACHINE ID (#6) 
  
     Field description changed
     
       From: The value of this field is a single-code that identifies
             the computer on which the image files for this instrument
             are stored.
     
       To: This is the hostname of the computer on which the image files
           for this instrument are stored.
  
     Help-Prompt changed
  
       From: Enter the letter for the processor that receives files from
             this instrument.
  
       To: Answer must be 1-30 characters in length.
  
 Installation
 ============
  
 Installation Planning
 =====================
  
 When planning the installation of Patch 99, consider the following 
 factors.
  
 * This patch is to be installed on the VistA system and on all DICOM 
   Gateways. Installing the KIDS on the VistA system will take less than
   one minute. Each DICOM Gateway installation will take 15 -60 minutes.
  
 * Before installing the KIDS portion of Patch 99 on the VistA system, all 
   processing on all DICOM Gateways must be stopped. Users can remain on
   the system during the KIDS installation.
  
 * After the KIDS portion of Patch 99 is installed, the client (DICOM 
   Gateway) portion of Patch 99 must be installed on all DICOM Gateways at 
   once.
  
 * All DICOM Gateways must be updated to Patch 99 by the compliance date 
   for this patch.
  
 Users installing the patch should review all installation instructions in 
 this document before beginning the installation process.
  
 NOTE: Do not use Remote Desktop to install the DICOM Gateway software.
       Attempts to perform the installation using Remote Desktop will not 
       succeed. You can use other applications, such as PC Anywhere and
       DameWare for remote installations.
  
 Installation Prerequisites
 ==========================
  
 NOTE: All released VistA Imaging patches must be installed on the VistA
       system and on all DICOM Gateways before installing Patch 99. 
  
 Before installing this patch, it is recommended that sites address any
 failed images using the following two menu options on the VistA system:
  
 * Correct RAD-DICOM File Entries [MAGD FIX DICOM FILE].
  
 * Correct Clinical Specialties DICOM File Entries [MAGD FIX CLINSPEC 
   DICOM FILE] (if sites acquire Consults studies).
  
 Sites should also create a backup copy of their current dictionary (.dic) 
 Make sure that all images are cleard from he Image_In folder.  This 
 includes processing undefined modalities.
  
 You can download the patch installation files from the Imaging FTP site.
 All instructions in this section assume that the distribution files for
 this patch have been copied to a local storage location. For the list of
 distribution files for this patch, see the Associated Patches section in 
 this document.
  
 VistA System (KIDS) Installation
 ================================
  
 KIDS installation will take less than one minute.
  
 1 Important: Before installing the KIDS, perform the following steps for 
   each DICOM Gateway:
  
   a Stop each process (use CTRL+C if needed) in each active process/telnet
     window. (Note that clicking X in the red box only closes the window;
     it does not stop the process).
  
   b Navigate to the main DICOM Gateway menu and enter 5 (Quit).
  
   c Ensure that Cache is running. (When Cache is running, Cache cube in
     the Windows taskbar is blue, not grey).
  
 2 On the VistA system, access the Kernel Installation and Distribution 
   System Menu [XPD MAIN].
  
 3 Run the Installation option [XPD INSTALLATION MENU].
  
 4 Load the KIDS file by performing the following step:
  
   a Run the Load a Distribution option [XPD LOAD DISTRIBUTION] to load the
     KIDS distribution.
  
   b When prompted, enter the path and file name (MAG3_0P99.KID) of the 
     Patch 99 KIDS file.
  
   c When prompted to continue with the load, enter YES. A Distribution OK!
     message will be displayed when the load is complete.
  
 5 After loading the KIDS file, use the following options to verify the 
   contents of the patch and to back up any affected routines.
  
   a Verify Checksums in Transport Global [XPD PRINT CHECKSUM] - Run this 
     option if you want to ensure the integrity of the routines in the
     patch.
  
   b Compare Transport Global to Current System [XPD COMPARE TO SYSTEM] - 
     Run this option if you want to view all changes that will be made when
     the patch is installed. All components (routines, options, and so on)
     in the patch will be compared.
  
   c Backup a Transport Global [XPD BACKUP] - Run this option if you want
     to create a backup message of any routines exported with the patch. It
     will NOT back up any of the other changes.
  
 6 After performing the load and any optional verification steps, install 
   the KIDS file by performing the following steps:
  
   a Run the Install Package(s) [XPD INSTALL BUILD] option.
  
   b When prompted for the install name, enter MAG*3.0*99.
  
   c Answer NO to the following prompts:
  
     Want KIDS to Rebuild Menu Trees Upon Completion of Install? NO//
     Want KIDS to INHIBIT LOGONs during the install? NO//
     Want to DISABLE Scheduled Options, Menu Options, and Protocols? NO//
  
 7 When installation is finished, an Install Complete message will be 
   displayed.
  
 8 Update the DICOM Gateways using teh instructions in DICOM Gateway 
   Installation.
  
 KIDS Installation Example
 =========================
  
 Select Installation Option: 6  Install Package(s)
 Select INSTALL NAME: MAG*3.0*99      4/19/11@12:31:20
      => VistA Imaging V3.0 - Patch 99 - 04/19/2011 09:59AM  ;Created o
  
 This Distribution was loaded on Apr 19, 2011@12:31:20 with header of 
    VistA Imaging V3.0 - Patch 99 - 04/19/2011 09:59AM  ;Created on Apr 1
 9, 2011@09:59:01
    It consisted of the following Install(s):
      MAG*3.0*99
 Checking Install for Package MAG*3.0*99
  
 Install Questions for MAG*3.0*99
  
 Incoming Files:
  
  
    2005      IMAGE  (Partial Definition)
 Note:  You already have the 'IMAGE' File.
  
  
    2005.1    IMAGE AUDIT  (Partial Definition)
 Note:  You already have the 'IMAGE AUDIT' File.
  
  
    2006.581  INSTRUMENT DICTIONARY
 Note:  You already have the 'INSTRUMENT DICTIONARY' File.
  
  
 Want KIDS to INHIBIT LOGONs during the install? NO// 
 Want to DISABLE Scheduled Options, Menu Options, and Protocols? NO// 
  
 Enter the Device you want to print the Install messages.
 You can queue the install by enter a 'Q' at the device prompt.
 Enter a '^' to abort the install.
  
 DEVICE: HOME//   HERE
  
  
  Install Started for MAG*3.0*99 : 
                Apr 19, 2011@12:32:05
  
 Build Distribution Date: Apr 19, 2011
  
  Installing Routines:........
                Apr 19, 2011@12:32:05
  
  Installing Data Dictionaries: ....
                Apr 19, 2011@12:32:06
  
  Running Post-Install Routine: POST^MAGIPS99.
  
  Updating Routine file......
  
  Updating KIDS files.......
  
  MAG*3.0*99 Installed. 
                Apr 19, 2011@12:32:06
  
  
 DICOM Gateway Installation
 ==========================
  
 Refer to the Installation section of the MAG3_0P99_Patch_Description.pdf
 for DICOM gateway installation instructions.
  
 DICOM Gateway Routines
 ======================
  
 This section lists new and modified routines for the Imaging DICOM 
 Gateway. Please note that the before checksum may differ if an Imaging 
 Field Unit Test has been installed. 
  
 ;;3.0;IMAGING;**[Patch List]**; Mar 19, 2002; Build 2056; April 18, 2011 
  
  
 Routine   Checksum  Checksum   Patch List
 Name      Before    After
  
 MAGDDR2A  68048092  72483962  **1,10,51,54,99**
 MAGDFND3  68870242  87847559  **10,30,51,54,53,49,99**
 MAGDIR6B  19665726  19607847  **11,30,51,54,53,99**
 MAGDIR6C  35046065  38621123  **11,30,51,54,53,99**
 MAGDIR75  35557528  49544197  **11,51,99**
 MAGDIR7C  70785160  86128520  **11,30,51,54,49,99**
 MAGDIR7D  20617095  16648443  **11,51,54,99**
 MAGDIWB2  86161827  87452809  **11,30,51,50,54,99**
 MAGDMFB6  19275620  19405158  **30,69,99**
 MAGDMFBM  77364611  86611155  **9,10,11,30,51,69,54,53,99**
 MAGDVRSN  21494340  21494340  **1,7,9,26,21,10,36,3,11,30,5,51,50,
                                 52,69,75,102,103,54,53,66,49,99**
  
  
 VistA Routines 
 ==============
  
 This section lists new and modified Imaging routines for the VistA 
 system. For each routine, the second line will contain the following 
 information.
  
 ;;3.0;IMAGING;**[Patch List]**; Mar 19, 2057; Build 2057; April 19, 2011 
  
 Please note that the before checksum may differ if an Imaging Field Unit 
 Test has been installed.
  
 Checksum values are calculated using the kernel utility program 
 CHECK1^XTSUMBLD.
  
 Routines MAGIPS99, MAGZTEMP1, and MAGZTEMP2 are automatically deleted 
 after the KIDS installation.

Routine Information:
====================
The checksums below are new checksums, and
 can be checked with CHECK1^XTSUMBLD.

Routine Name: MAGDIR9A
    Before: B60148803   After: B60148803  **11,30,51,46,54,53,49,99**
Routine Name: MAGDIR9B
    Before: B19341690   After: B20256312  **11,51,50,54,53,99**
Routine Name: MAGDIR9E
    Before: B68376397   After: B70227374  **11,51,46,54,99**
Routine Name: MAGGTIA
    Before: B48548549   After: B43239609  **8,48,99**
Routine Name: MAGIPS99
    Before:       n/a   After: B16982015  **99**
Routine Name: MAGZTEMP1
    Before:       n/a   After: B48548549  **8,48,106,117,99**
Routine Name: MAGZTEMP2
    Before:       n/a   After: B47129366  **8,48,106,99**
 
Routine list of preceding patches: 49, 117

=============================================================================
User Information:
Entered By  : TROMBETTA,KATHY               Date Entered  : AUG 05, 2008
Completed By: CASUGAY,ELSIE G               Date Completed: SEP 30, 2011
Released By : SCHOONOVER,JOHN E             Date Released : SEP 30, 2011
=============================================================================


Packman Mail Message:
=====================

No routines included
