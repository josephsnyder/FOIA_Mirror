Released PX*1*194 SEQ #150
Extracted from mail message
**KIDS**:PX*1.0*194^

**INSTALL NAME**
PX*1.0*194
"BLD",7482,0)
PX*1.0*194^PCE PATIENT CARE ENCOUNTER^0^3090605^y
"BLD",7482,1,0)
^^4^4^3090528^
"BLD",7482,1,1,0)
This patch addresses the upcoming deletion of unsupported fields in the
"BLD",7482,1,2,0)
ICD Diagnosis File, #80, and the CPT File, #81. Modifications are being
"BLD",7482,1,3,0)
made to affected Patient Care Encounter routines to replace unsupported
"BLD",7482,1,4,0)
calls to the deleted data fields with the appropriate supported API.
"BLD",7482,4,0)
^9.64PA^^
"BLD",7482,6.3)
2
"BLD",7482,"ABPKG")
n
"BLD",7482,"KRN",0)
^9.67PA^779.2^20
"BLD",7482,"KRN",.4,0)
.4
"BLD",7482,"KRN",.401,0)
.401
"BLD",7482,"KRN",.402,0)
.402
"BLD",7482,"KRN",.403,0)
.403
"BLD",7482,"KRN",.5,0)
.5
"BLD",7482,"KRN",.84,0)
.84
"BLD",7482,"KRN",3.6,0)
3.6
"BLD",7482,"KRN",3.8,0)
3.8
"BLD",7482,"KRN",9.2,0)
9.2
"BLD",7482,"KRN",9.8,0)
9.8
"BLD",7482,"KRN",9.8,"NM",0)
^9.68A^13^13
"BLD",7482,"KRN",9.8,"NM",1,0)
AUPNSICD^^0^B1050074
"BLD",7482,"KRN",9.8,"NM",2,0)
PXCACPT^^0^B47966106
"BLD",7482,"KRN",9.8,"NM",3,0)
PXBGCPT2^^0^B35739040
"BLD",7482,"KRN",9.8,"NM",4,0)
PXCADXP1^^0^B24306608
"BLD",7482,"KRN",9.8,"NM",5,0)
PXCAPL^^0^B33553090
"BLD",7482,"KRN",9.8,"NM",6,0)
PXKFCPT1^^0^B23493411
"BLD",7482,"KRN",9.8,"NM",7,0)
PXPXRMI1^^0^B51661630
"BLD",7482,"KRN",9.8,"NM",8,0)
PXPXRMI2^^0^B80236604
"BLD",7482,"KRN",9.8,"NM",9,0)
PXSCH2^^0^B7363078
"BLD",7482,"KRN",9.8,"NM",10,0)
PXSCH4^^0^B8097371
"BLD",7482,"KRN",9.8,"NM",11,0)
PXAICPT^^0^B26308932
"BLD",7482,"KRN",9.8,"NM",12,0)
PXAICPTV^^0^B16278915
"BLD",7482,"KRN",9.8,"NM",13,0)
PXAIPOVV^^0^B2638479
"BLD",7482,"KRN",9.8,"NM","B","AUPNSICD",1)

"BLD",7482,"KRN",9.8,"NM","B","PXAICPT",11)

"BLD",7482,"KRN",9.8,"NM","B","PXAICPTV",12)

"BLD",7482,"KRN",9.8,"NM","B","PXAIPOVV",13)

"BLD",7482,"KRN",9.8,"NM","B","PXBGCPT2",3)

"BLD",7482,"KRN",9.8,"NM","B","PXCACPT",2)

"BLD",7482,"KRN",9.8,"NM","B","PXCADXP1",4)

"BLD",7482,"KRN",9.8,"NM","B","PXCAPL",5)

"BLD",7482,"KRN",9.8,"NM","B","PXKFCPT1",6)

"BLD",7482,"KRN",9.8,"NM","B","PXPXRMI1",7)

"BLD",7482,"KRN",9.8,"NM","B","PXPXRMI2",8)

"BLD",7482,"KRN",9.8,"NM","B","PXSCH2",9)

"BLD",7482,"KRN",9.8,"NM","B","PXSCH4",10)

"BLD",7482,"KRN",19,0)
19
"BLD",7482,"KRN",19.1,0)
19.1
"BLD",7482,"KRN",101,0)
101
"BLD",7482,"KRN",409.61,0)
409.61
"BLD",7482,"KRN",771,0)
771
"BLD",7482,"KRN",779.2,0)
779.2
"BLD",7482,"KRN",870,0)
870
"BLD",7482,"KRN",8989.51,0)
8989.51
"BLD",7482,"KRN",8989.52,0)
8989.52
"BLD",7482,"KRN",8994,0)
8994
"BLD",7482,"KRN","B",.4,.4)

"BLD",7482,"KRN","B",.401,.401)

"BLD",7482,"KRN","B",.402,.402)

"BLD",7482,"KRN","B",.403,.403)

"BLD",7482,"KRN","B",.5,.5)

"BLD",7482,"KRN","B",.84,.84)

"BLD",7482,"KRN","B",3.6,3.6)

"BLD",7482,"KRN","B",3.8,3.8)

"BLD",7482,"KRN","B",9.2,9.2)

"BLD",7482,"KRN","B",9.8,9.8)

"BLD",7482,"KRN","B",19,19)

"BLD",7482,"KRN","B",19.1,19.1)

"BLD",7482,"KRN","B",101,101)

"BLD",7482,"KRN","B",409.61,409.61)

"BLD",7482,"KRN","B",771,771)

"BLD",7482,"KRN","B",779.2,779.2)

"BLD",7482,"KRN","B",870,870)

"BLD",7482,"KRN","B",8989.51,8989.51)

"BLD",7482,"KRN","B",8989.52,8989.52)

"BLD",7482,"KRN","B",8994,8994)

"BLD",7482,"QDEF")
^^^^NO^^^^NO
"BLD",7482,"QUES",0)
^9.62^^
"BLD",7482,"REQB",0)
^9.611^9^9
"BLD",7482,"REQB",1,0)
PX*1.0*124^2
"BLD",7482,"REQB",2,0)
PX*1.0*149^2
"BLD",7482,"REQB",3,0)
PX*1.0*33^2
"BLD",7482,"REQB",4,0)
PX*1.0*168^2
"BLD",7482,"REQB",5,0)
PX*1.0*119^2
"BLD",7482,"REQB",6,0)
PX*1.0*73^2
"BLD",7482,"REQB",7,0)
PX*1.0*164^2
"BLD",7482,"REQB",8,0)
PX*1.0*121^2
"BLD",7482,"REQB",9,0)
PX*1.0*190^2
"BLD",7482,"REQB","B","PX*1.0*119",5)

"BLD",7482,"REQB","B","PX*1.0*121",8)

"BLD",7482,"REQB","B","PX*1.0*124",1)

"BLD",7482,"REQB","B","PX*1.0*149",2)

"BLD",7482,"REQB","B","PX*1.0*164",7)

"BLD",7482,"REQB","B","PX*1.0*168",4)

"BLD",7482,"REQB","B","PX*1.0*190",9)

"BLD",7482,"REQB","B","PX*1.0*33",3)

"BLD",7482,"REQB","B","PX*1.0*73",6)

"MBREQ")
0
"PKG",413,-1)
1^1
"PKG",413,0)
PCE PATIENT CARE ENCOUNTER^PX^Patient Care Encounter (VA Parent package)^
"PKG",413,20,0)
^9.402P^^
"PKG",413,22,0)
^9.49I^1^1
"PKG",413,22,1,0)
1.0^2960812^2960913^12537
"PKG",413,22,1,"PAH",1,0)
194^3090605
"PKG",413,22,1,"PAH",1,1,0)
^^4^4^3090605
"PKG",413,22,1,"PAH",1,1,1,0)
This patch addresses the upcoming deletion of unsupported fields in the
"PKG",413,22,1,"PAH",1,1,2,0)
ICD Diagnosis File, #80, and the CPT File, #81. Modifications are being
"PKG",413,22,1,"PAH",1,1,3,0)
made to affected Patient Care Encounter routines to replace unsupported
"PKG",413,22,1,"PAH",1,1,4,0)
calls to the deleted data fields with the appropriate supported API.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
13
"RTN","AUPNSICD")
0^1^B1050074^B1070925
"RTN","AUPNSICD",1,0)
AUPNSICD ;OHPRD/LAB,SCK - Screen Purpose of Visit/ICD9 codes ; 5/1/03 11:52am
"RTN","AUPNSICD",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**121,149,190,194**;Aug 12, 1996;Build 2
"RTN","AUPNSICD",3,0)
 ;;93.2;IHS PATIENT DICTIONARIES.;;JUL 01, 1993
"RTN","AUPNSICD",4,0)
 ;
"RTN","AUPNSICD",5,0)
 N ICDSTR,ICDVDT
"RTN","AUPNSICD",6,0)
 ; Define variable PXCEVIEN - PX*1*190
"RTN","AUPNSICD",7,0)
 I '$D(PXCEVIEN) I DA I $G(^AUPNVPOV(DA,0)) S PXCEVIEN=$P(^AUPNVPOV(DA,0),U,3)
"RTN","AUPNSICD",8,0)
 ;S ICDSTR=$$ICDDX^ICDCODE(Y,$P(^AUPNVSIT(PXCEVIEN,0),"^",2))
"RTN","AUPNSICD",9,0)
 S ICDSTR=$$ICDDX^ICDCODE(Y,+^AUPNVSIT(PXCEVIEN,0)),ICDVDT=+^AUPNVSIT(PXCEVIEN,0)
"RTN","AUPNSICD",10,0)
 G:$G(DUZ("AG"))="V" VAIN
"RTN","AUPNSICD",11,0)
 ;
"RTN","AUPNSICD",12,0)
 ;I 1 Q:$G(DUZ("AG"))'="I"
"RTN","AUPNSICD",13,0)
EIN ; SCREEN OUT E CODES AND INACTIVE CODES
"RTN","AUPNSICD",14,0)
 ;I $E(^ICD9(Y,0),U,1)'="E",$P(^(0),U,9)=""
"RTN","AUPNSICD",15,0)
 ;I $P(^ICD9(Y,0),U,1)'="E",$P(^(0),U,9)=""
"RTN","AUPNSICD",16,0)
 I $P(ICDSTR,U,2)'="E",$P(ICDSTR,U,10)=1
"RTN","AUPNSICD",17,0)
 G:'$T XIT
"RTN","AUPNSICD",18,0)
SEX ; IF 'USE WITH SEX' FIELD HAS A VALUE CHECK THAT VALUE AGAINST AUPNSEX
"RTN","AUPNSICD",19,0)
 G:'$D(AUPNSEX) AGE
"RTN","AUPNSICD",20,0)
 ;I $P(^ICD9(Y,0),U,10)=""!($P(^ICD9(Y,0),U,10)=AUPNSEX)
"RTN","AUPNSICD",21,0)
 I $P(ICDSTR,U,11)=""!($P(ICDSTR,U,11)=AUPNSEX)
"RTN","AUPNSICD",22,0)
 G:'$T XIT
"RTN","AUPNSICD",23,0)
AGE ; IF THERE IS AGE CRITERIA DATA AVAILABLE CHECK TO SEE THAT IT FITS THE CRITERIA
"RTN","AUPNSICD",24,0)
 ;G:'$D(AUPNDAYS) XIT
"RTN","AUPNSICD",25,0)
 ;G:'$D(^ICD9(Y,9999999)) XIT
"RTN","AUPNSICD",26,0)
 ;I $P(^(9999999),U,1)=""!($P(^(9999999),U,1)<AUPNDAYS)
"RTN","AUPNSICD",27,0)
 ;G:'$T XIT
"RTN","AUPNSICD",28,0)
 ;I $P(^(9999999),U,2)=""!($P(^(9999999),U,2)>AUPNDAYS)
"RTN","AUPNSICD",29,0)
XIT ;
"RTN","AUPNSICD",30,0)
 K DA,PXCEVIEN
"RTN","AUPNSICD",31,0)
 Q
"RTN","AUPNSICD",32,0)
 ;
"RTN","AUPNSICD",33,0)
VAIN ;SCREEN OUT INACTIVE CODES
"RTN","AUPNSICD",34,0)
 ; E codes are ok in the VA
"RTN","AUPNSICD",35,0)
 ;I $P(^ICD9(Y,0),U,9)'=1
"RTN","AUPNSICD",36,0)
 I $P(ICDSTR,U,10)=1
"RTN","AUPNSICD",37,0)
 Q
"RTN","AUPNSICD",38,0)
 ;
"RTN","PXAICPT")
0^11^B26308932^B24514877
"RTN","PXAICPT",1,0)
PXAICPT ;ISL/JVS,ISA/KWP,ESW,SCK - SET THE PROCEDURE(CPT) NODES ;8/10/04 4:39pm
"RTN","PXAICPT",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**19,73,108,112,149,124,164,194**;Aug 12, 1996;Build 2
"RTN","PXAICPT",3,0)
 ;
"RTN","PXAICPT",4,0)
 ;
"RTN","PXAICPT",5,0)
 Q
"RTN","PXAICPT",6,0)
CPT ;--CREAT PROVIDERS
"RTN","PXAICPT",7,0)
 ;
"RTN","PXAICPT",8,0)
 ;
"RTN","PXAICPT",9,0)
SET ;--SET AND NEW VARIABLES
"RTN","PXAICPT",10,0)
 N AFTER0,AFTER1,AFTER12,AFTER801,AFTER802,AFTER811,AFTER812
"RTN","PXAICPT",11,0)
 N BEFOR0,BEFOR1,BEFOR12,BEFOR801,BEFOR802,BEFOR811,BEFOR812
"RTN","PXAICPT",12,0)
 N PXAA,PXAB,SUB,PIECE,PXAAX,IENB,STOP
"RTN","PXAICPT",13,0)
 ;New Modifier Variables
"RTN","PXAICPT",14,0)
 D SET^PXAIMOD
"RTN","PXAICPT",15,0)
 K PXAERR
"RTN","PXAICPT",16,0)
 S PXAERR(8)=PXAK
"RTN","PXAICPT",17,0)
 S PXAERR(7)="PROCEDURE"
"RTN","PXAICPT",18,0)
 ;
"RTN","PXAICPT",19,0)
 S SUB="" F  S SUB=$O(@PXADATA@("PROCEDURE",PXAK,SUB)) Q:SUB=""  D
"RTN","PXAICPT",20,0)
 .S PXAA(SUB)=$G(@PXADATA@("PROCEDURE",PXAK,SUB))
"RTN","PXAICPT",21,0)
 ;Setup PXAA array for Modifiers
"RTN","PXAICPT",22,0)
 S SUB=""
"RTN","PXAICPT",23,0)
 F  S SUB=$O(@PXADATA@("PROCEDURE",PXAK,"MODIFIERS",SUB)) Q:SUB=""  D
"RTN","PXAICPT",24,0)
 .S PXAA("MODIFIERS",SUB)=""
"RTN","PXAICPT",25,0)
 ;
"RTN","PXAICPT",26,0)
VAL ;--VALIDATE ENOUGH DATA
"RTN","PXAICPT",27,0)
 D VAL^PXAICPTV Q:$G(STOP)
"RTN","PXAICPT",28,0)
 ;
"RTN","PXAICPT",29,0)
 ;
"RTN","PXAICPT",30,0)
SETVARA ;--SET VISIT VARIABLES
"RTN","PXAICPT",31,0)
 S $P(AFTER0,"^",1)=$G(PXAA("PROCEDURE"))
"RTN","PXAICPT",32,0)
 I $G(PXAA("DELETE")) S $P(AFTER0,"^",1)="@"
"RTN","PXAICPT",33,0)
 S $P(AFTER0,"^",2)=$G(PATIENT)
"RTN","PXAICPT",34,0)
 S $P(AFTER0,"^",3)=$G(PXAVISIT)
"RTN","PXAICPT",35,0)
 S $P(AFTER0,"^",4)=$G(PXAA("NARRATIVE")) D
"RTN","PXAICPT",36,0)
 .I $G(PXAA("NARRATIVE"))']""!($L($G(PXAA("NARRATIVE")))>245) D
"RTN","PXAICPT",37,0)
 ..S $P(AFTER0,"^",4)=$P($$CPT^ICPTCOD($G(PXAA("PROCEDURE")),$G(IDATE)),"^",3) ;-- TEXT OF NARRATIVE
"RTN","PXAICPT",38,0)
 .I $G(PXAA("NARRATIVE"))]"" S $P(AFTER0,"^",4)=+$$PROVNARR^PXAPI($G(PXAA("NARRATIVE")),9000010.18)
"RTN","PXAICPT",39,0)
 I $P(AFTER0,"^",4)<0 D VAL04^PXAICPTV,ERR^PXAI Q:$D(STOP)
"RTN","PXAICPT",40,0)
 S $P(AFTER0,"^",5)=$G(PXAA("DIAGNOSIS"))
"RTN","PXAICPT",41,0)
 ;PX*1*124 - add dx
"RTN","PXAICPT",42,0)
 S $P(AFTER0,"^",9)=$G(PXAA("DIAGNOSIS 2"))
"RTN","PXAICPT",43,0)
 S $P(AFTER0,"^",10)=$G(PXAA("DIAGNOSIS 3"))
"RTN","PXAICPT",44,0)
 S $P(AFTER0,"^",11)=$G(PXAA("DIAGNOSIS 4"))
"RTN","PXAICPT",45,0)
 S $P(AFTER0,"^",12)=$G(PXAA("DIAGNOSIS 5"))
"RTN","PXAICPT",46,0)
 S $P(AFTER0,"^",13)=$G(PXAA("DIAGNOSIS 6"))
"RTN","PXAICPT",47,0)
 S $P(AFTER0,"^",14)=$G(PXAA("DIAGNOSIS 7"))
"RTN","PXAICPT",48,0)
 S $P(AFTER0,"^",15)=$G(PXAA("DIAGNOSIS 8"))
"RTN","PXAICPT",49,0)
 I $G(PXAA("QTY"))="" S PXAA("QTY")=1
"RTN","PXAICPT",50,0)
 S $P(AFTER0,"^",16)=$G(PXAA("QTY")) I $G(PXAA("QTY"))<1 S PXAA("DELETE")=1
"RTN","PXAICPT",51,0)
 S $P(AFTER0,"^",17)=$G(PXAA("ORD REFERENCE"))
"RTN","PXAICPT",52,0)
 I $$SWSTAT^IBBAPI() D  ;PX*1.0*164
"RTN","PXAICPT",53,0)
 . S $P(AFTER0,"^",19)=$G(PXAA("DEPARTMENT"))
"RTN","PXAICPT",54,0)
 . I $P(AFTER0,"^",19)="",$G(^AUPNVSIT(PXAVISIT,0)),$P(^AUPNVSIT(PXAVISIT,0),"^",8) S $P(AFTER0,"^",19)=$P($G(^DIC(40.7,$P(^AUPNVSIT(PXAVISIT,0),"^",8),0)),"^",2)
"RTN","PXAICPT",55,0)
 ;Set Modifier nodes in AFTER1
"RTN","PXAICPT",56,0)
 D SETVARA^PXAIMOD
"RTN","PXAICPT",57,0)
 ;
"RTN","PXAICPT",58,0)
 S $P(AFTER12,"^",1)=$G(PXAA("EVENT D/T"))
"RTN","PXAICPT",59,0)
 ;PX*1*124 - add ord prv
"RTN","PXAICPT",60,0)
 S $P(AFTER12,"^",2)=$G(PXAA("ORD PROVIDER"))
"RTN","PXAICPT",61,0)
 S $P(AFTER12,"^",4)=$G(PXAA("ENC PROVIDER"))
"RTN","PXAICPT",62,0)
 ;PX*1*108 - do not try to file a provider from a "DELETED" cpt
"RTN","PXAICPT",63,0)
 I $G(PXAA("ENC PROVIDER"))]"",'$G(PXAA("DELETE")) D
"RTN","PXAICPT",64,0)
 .S ^TMP("PXAIADDPRV",$J,$G(PXAA("ENC PROVIDER")))=""
"RTN","PXAICPT",65,0)
 ;PX*1*124 - do not try to file a provider from a "DELETED" cpt
"RTN","PXAICPT",66,0)
 I $G(PXAA("ORD PROVIDER"))]"",'$G(PXAA("DELETE")) D
"RTN","PXAICPT",67,0)
 .S ^TMP("PXAIADDPRV",$J,$G(PXAA("ORD PROVIDER")))=""
"RTN","PXAICPT",68,0)
 ;
"RTN","PXAICPT",69,0)
 S $P(AFTER802,"^",1)=$G(PXAA("CATEGORY"))
"RTN","PXAICPT",70,0)
 I $G(PXAA("CATEGORY"))]"" S $P(AFTER802,"^",1)=+$$PROVNARR^PXAPI($G(PXAA("CATEGORY")),9000010.18)
"RTN","PXAICPT",71,0)
 I $P(AFTER802,"^",1)<0 D VAL45^PXAICPTV,ERR^PXAI Q:$D(STOP)
"RTN","PXAICPT",72,0)
 S $P(AFTER811,"^",1)=$G(PXAA("COMMENT"))
"RTN","PXAICPT",73,0)
 ;
"RTN","PXAICPT",74,0)
 ;
"RTN","PXAICPT",75,0)
 ;
"RTN","PXAICPT",76,0)
 ;--PACKAGE AND SOURCE
"RTN","PXAICPT",77,0)
 ;
"RTN","PXAICPT",78,0)
 S $P(AFTER812,"^",2)=$G(PXAPKG)
"RTN","PXAICPT",79,0)
 S $P(AFTER812,"^",3)=$G(PXASOURC)
"RTN","PXAICPT",80,0)
 ;
"RTN","PXAICPT",81,0)
SETPXKA ;--SET PXK ARRAY AFTER
"RTN","PXAICPT",82,0)
 S ^TMP("PXK",$J,"CPT",PXAK,0,"AFTER")=AFTER0
"RTN","PXAICPT",83,0)
 ;Set ^TMP("PXK",$J,"CPT",PXAK,1,ien,"AFTER")=MODIEN
"RTN","PXAICPT",84,0)
 D SETPXKA^PXAIMOD
"RTN","PXAICPT",85,0)
 S ^TMP("PXK",$J,"CPT",PXAK,12,"AFTER")=AFTER12
"RTN","PXAICPT",86,0)
 S ^TMP("PXK",$J,"CPT",PXAK,802,"AFTER")=AFTER802
"RTN","PXAICPT",87,0)
 S ^TMP("PXK",$J,"CPT",PXAK,811,"AFTER")=AFTER811
"RTN","PXAICPT",88,0)
 S ^TMP("PXK",$J,"CPT",PXAK,812,"AFTER")=AFTER812
"RTN","PXAICPT",89,0)
 ;
"RTN","PXAICPT",90,0)
SETVARB ;--SET VARIABLES BEFORE
"RTN","PXAICPT",91,0)
 D
"RTN","PXAICPT",92,0)
 .N PXBKY,PXBSAM,PXBSKY,PXBCNT,PXI,PRV,ITEM,PXICPT
"RTN","PXAICPT",93,0)
 .D CPT^PXBGCPT(PXAVISIT)
"RTN","PXAICPT",94,0)
 .;S PXAAX("PROCEDURE")=$P($G(^ICPT($G(PXAA("PROCEDURE")),0)),"^",1)
"RTN","PXAICPT",95,0)
 .S PXICPT=$$CPT^ICPTCOD($G(PXAA("PROCEDURE")))
"RTN","PXAICPT",96,0)
 .S PXAAX("PROCEDURE")=$S(+PXICPT>0:$P(PXICPT,"^",2),1:"")
"RTN","PXAICPT",97,0)
 .;I $G(PXAA("DELETE"))=1 S PXAAX("PROCEDURE")=$P($G(^ICPT($G(PXAA("PROCEDURE")),0)),"^",1)
"RTN","PXAICPT",98,0)
 .I $G(PXAA("DELETE"))=1 S PXAAX("PROCEDURE")=$S(+PXICPT>0:$P(PXICPT,"^",2),1:"")
"RTN","PXAICPT",99,0)
 .S ITEM=""
"RTN","PXAICPT",100,0)
 .I PXBCNT>0,$G(PXAAX("PROCEDURE"))]"" S ITEM=$O(PXBKY(PXAAX("PROCEDURE"),0))
"RTN","PXAICPT",101,0)
 .I ITEM]"" D
"RTN","PXAICPT",102,0)
 ..;--LOOK UP USING CPT AND PROVIDER
"RTN","PXAICPT",103,0)
 ..S PXI="" F  S PXI=$O(PXBKY(PXAAX("PROCEDURE"),PXI)) Q:PXI=""  D
"RTN","PXAICPT",104,0)
 ...I $D(^IBE(357.69,PXAAX("PROCEDURE"))) D  Q  ;DBIA #: 1906
"RTN","PXAICPT",105,0)
 ....S (^TMP("PXK",$J,"CPT",PXAK,"IEN"),IENB)=$O(PXBSKY(PXI,0))
"RTN","PXAICPT",106,0)
 ...I $G(PXAA("ENC PROVIDER")) D  Q
"RTN","PXAICPT",107,0)
 ....S PRV=$P(^VA(200,$G(PXAA("ENC PROVIDER")),0),"^",1)
"RTN","PXAICPT",108,0)
 ....I $P($G(PXBKY(PXAAX("PROCEDURE"),PXI)),"^",3)=PRV D
"RTN","PXAICPT",109,0)
 .....S (^TMP("PXK",$J,"CPT",PXAK,"IEN"),IENB)=$O(PXBSKY(PXI,0))
"RTN","PXAICPT",110,0)
 I $G(IENB) D
"RTN","PXAICPT",111,0)
 .F PIECE=0,12,802,811,812 S ^TMP("PXK",$J,"CPT",PXAK,PIECE,"BEFORE")=$G(^AUPNVCPT(IENB,PIECE))
"RTN","PXAICPT",112,0)
 .;Set ^TMP("PXK",$J,"CPT",PXAK,1,ien,"BEFORE")=MODIEN
"RTN","PXAICPT",113,0)
 .D SETVARB^PXAIMOD
"RTN","PXAICPT",114,0)
 E  D
"RTN","PXAICPT",115,0)
 .S (BEFOR0,BEFOR12,BEFOR802,BEFOR811,BEFOR812)=""
"RTN","PXAICPT",116,0)
 .;
"RTN","PXAICPT",117,0)
SETPXKB .;--SET PXK ARRAY BEFORE
"RTN","PXAICPT",118,0)
 .S ^TMP("PXK",$J,"CPT",PXAK,0,"BEFORE")=BEFOR0
"RTN","PXAICPT",119,0)
 .;Set ^TMP("PXK",$J,"CPT",PXAK,1,ien,"BEFORE")=MODIEN
"RTN","PXAICPT",120,0)
 .D SETPXKB^PXAIMOD
"RTN","PXAICPT",121,0)
 .S ^TMP("PXK",$J,"CPT",PXAK,12,"BEFORE")=BEFOR12
"RTN","PXAICPT",122,0)
 .S ^TMP("PXK",$J,"CPT",PXAK,802,"BEFORE")=BEFOR802
"RTN","PXAICPT",123,0)
 .S ^TMP("PXK",$J,"CPT",PXAK,811,"BEFORE")=BEFOR811
"RTN","PXAICPT",124,0)
 .S ^TMP("PXK",$J,"CPT",PXAK,812,"BEFORE")=BEFOR812
"RTN","PXAICPT",125,0)
 .S ^TMP("PXK",$J,"CPT",PXAK,"IEN")=""
"RTN","PXAICPT",126,0)
 ;
"RTN","PXAICPT",127,0)
MISC ;--MISCELLANEOUS NODE
"RTN","PXAICPT",128,0)
 ;
"RTN","PXAICPT",129,0)
 Q
"RTN","PXAICPTV")
0^12^B16278915^B16252625
"RTN","PXAICPTV",1,0)
PXAICPTV ;ISL/JVS,ISA/KWP,SCK - VALADATE PROCEDURES(CPT) ;11/14/96  12:46
"RTN","PXAICPTV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**15,73,74,111,121,130,168,194**;Aug 12, 1996;Build 2
"RTN","PXAICPTV",3,0)
 ;
"RTN","PXAICPTV",4,0)
VAL ;--VALIDATE ENOUGH DATA
"RTN","PXAICPTV",5,0)
 ;----Missing a pointer to PROCEDURE(CPT) name
"RTN","PXAICPTV",6,0)
 I $G(PXAA("PROCEDURE"))']"" D  Q:$G(STOP)
"RTN","PXAICPTV",7,0)
 .S STOP=1 ;--USED TO STOP DO LOOP
"RTN","PXAICPTV",8,0)
 .S PXAERRF=1 ;--FLAG INDICATES THERE IS AN ERR
"RTN","PXAICPTV",9,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","PXAICPTV",10,0)
 .S PXAERR(9)="PROCEDURE"
"RTN","PXAICPTV",11,0)
 .S PXAERR(11)=$G(PXAA("PROCEDURE"))
"RTN","PXAICPTV",12,0)
 .S PXAERR(12)="You are missing a pointer to the PROCEDURE CPT FILE#81 that represents the procedure's name"
"RTN","PXAICPTV",13,0)
 ;
"RTN","PXAICPTV",14,0)
 ;----NOT a pointer to PROCEDURE CPT FILE#81
"RTN","PXAICPTV",15,0)
 I +$$CPT^ICPTCOD($G(PXAA("PROCEDURE")))'>0 D  Q:$G(STOP) 
"RTN","PXAICPTV",16,0)
 .S STOP=1
"RTN","PXAICPTV",17,0)
 .S PXAERRF=1
"RTN","PXAICPTV",18,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","PXAICPTV",19,0)
 .S PXAERR(9)="PROCEDURE"
"RTN","PXAICPTV",20,0)
 .S PXAERR(11)=$G(PXAA("PROCEDURE"))
"RTN","PXAICPTV",21,0)
 .S PXAERR(12)=PXAERR(11)_" is NOT a pointer value to the CPT FILE #81"
"RTN","PXAICPTV",22,0)
 ;
"RTN","PXAICPTV",23,0)
 ;----Not a valid CPT
"RTN","PXAICPTV",24,0)
 I '$P($$CPT^ICPTCOD(PXAA("PROCEDURE"),+^AUPNVSIT(PXAVISIT,0)),"^",7) D  Q:$G(STOP)
"RTN","PXAICPTV",25,0)
 .S STOP=1
"RTN","PXAICPTV",26,0)
 .S PXAERRF=1
"RTN","PXAICPTV",27,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","PXAICPTV",28,0)
 .S PXAERR(9)="PROCEDURE"
"RTN","PXAICPTV",29,0)
 .S PXAERR(11)=$G(PXAA("PROCEDURE"))
"RTN","PXAICPTV",30,0)
 .S PXAERR(12)=PXAERR(11)_" is NOT a valid CPT code"
"RTN","PXAICPTV",31,0)
 ;
"RTN","PXAICPTV",32,0)
 ;----Not a valid modifier
"RTN","PXAICPTV",33,0)
 N SUB,MODIEN
"RTN","PXAICPTV",34,0)
 S SUB=""
"RTN","PXAICPTV",35,0)
 F  S SUB=$O(PXAA("MODIFIERS",SUB)) Q:SUB=""!($G(STOP))  D
"RTN","PXAICPTV",36,0)
 .;S MODIEN=$$MODP^ICPTMOD(PXAA("PROCEDURE"),SUB,"E","",0)
"RTN","PXAICPTV",37,0)
 .S MODIEN=$$MODP^ICPTMOD(PXAA("PROCEDURE"),SUB,"E",+^AUPNVSIT(PXAVISIT,0),0)
"RTN","PXAICPTV",38,0)
 .I $P(MODIEN,"^")>0 Q
"RTN","PXAICPTV",39,0)
 .S STOP=1
"RTN","PXAICPTV",40,0)
 .S PXAERRF=1
"RTN","PXAICPTV",41,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","PXAICPTV",42,0)
 .S PXAERR(9)="MODIFIERS"_","_SUB
"RTN","PXAICPTV",43,0)
 .S PXAERR(11)=""
"RTN","PXAICPTV",44,0)
 .S PXAERR(12)=SUB_" is NOT a valid modifier for procedure "_$G(PXAA("PROCEDURE"))
"RTN","PXAICPTV",45,0)
 ;----"Missing the number of times the procedure was performed.
"RTN","PXAICPTV",46,0)
 I $G(PXAA("QTY"))<1 D
"RTN","PXAICPTV",47,0)
 .S STOP=0
"RTN","PXAICPTV",48,0)
 .S PXAERRF=1
"RTN","PXAICPTV",49,0)
 .S PXADI("DIALOG")=8390001.002
"RTN","PXAICPTV",50,0)
 .S PXAERR(9)="QTY"
"RTN","PXAICPTV",51,0)
 .S PXAERR(11)=$G(PXAA("QTY"))
"RTN","PXAICPTV",52,0)
 .S PXAERR(12)="If this node is empty we will assume it should be '1'. If it is a less than '1' we will delete any reference to it in the data base."
"RTN","PXAICPTV",53,0)
 ;
"RTN","PXAICPTV",54,0)
 ;
"RTN","PXAICPTV",55,0)
 Q
"RTN","PXAICPTV",56,0)
VAL04 ;---PROVIDER NARRATIVE
"RTN","PXAICPTV",57,0)
 S STOP=1
"RTN","PXAICPTV",58,0)
 S PXAERRF=1
"RTN","PXAICPTV",59,0)
 S PXADI("DIALOG")=8390001.001
"RTN","PXAICPTV",60,0)
 S PXAERR(9)="NARRATIVE"
"RTN","PXAICPTV",61,0)
 S PXAERR(11)=$G(PXAA("NARRATIVE"))
"RTN","PXAICPTV",62,0)
 S PXAERR(12)="We are unable to retrive a narrative from the PROVIDER NARRATIVE file #9999999.27"
"RTN","PXAICPTV",63,0)
 Q
"RTN","PXAICPTV",64,0)
VAL45 ;---PROVIDER NARRATIVE CATEGORY
"RTN","PXAICPTV",65,0)
 S STOP=0
"RTN","PXAICPTV",66,0)
 S PXAERRF=1
"RTN","PXAICPTV",67,0)
 S PXADI("DIALOG")=8390001.002
"RTN","PXAICPTV",68,0)
 S PXAERR(9)="CATEGORY"
"RTN","PXAICPTV",69,0)
 S PXAERR(11)=$G(PXAA("CATEGORY"))
"RTN","PXAICPTV",70,0)
 S PXAERR(12)="We are unable to retrieve a narrative from the PROVIDER NARRATIVE file #9999999.27"
"RTN","PXAICPTV",71,0)
 Q
"RTN","PXAICPTV",72,0)
 ;---------------------SUBROUTINE------------------------------
"RTN","PXAICPTV",73,0)
ARRAY ;--SET ERRORS AND WARNINGS INTO AN ARRAY TO RETURN TO CALLER
"RTN","PXAICPTV",74,0)
 I PXADI("DIALOG")=8390001.001 D
"RTN","PXAICPTV",75,0)
 .S PXASUB=PXASUB+1
"RTN","PXAICPTV",76,0)
 .S PXAPROB($J,PXASUB,"ERROR1",PXAERR(7),PXAERR(9),PXAK)=$G(PXAERR(12))
"RTN","PXAICPTV",77,0)
 I PXADI("DIALOG")=8390001.002 D
"RTN","PXAICPTV",78,0)
 .S PXASUB=PXASUB+1
"RTN","PXAICPTV",79,0)
 .S PXAPROB($J,PXASUB,"WARNING2",PXAERR(7),PXAERR(9),PXAK)=$G(PXAERR(12))
"RTN","PXAICPTV",80,0)
 I PXADI("DIALOG")=8390001.003 D
"RTN","PXAICPTV",81,0)
 .S PXASUB=PXASUB+1
"RTN","PXAICPTV",82,0)
 .S PXAPROB($J,PXASUB,"WARNING3","ENCOUNTER",1,"SC")=$G(PXAERR("6W"))
"RTN","PXAICPTV",83,0)
 .S PXAPROB($J,PXASUB,"WARNING3","ENCOUNTER",1,"AO")=$G(PXAERR("7W"))
"RTN","PXAICPTV",84,0)
 .S PXAPROB($J,PXASUB,"WARNING3","ENCOUNTER",1,"IR")=$G(PXAERR("8W"))
"RTN","PXAICPTV",85,0)
 .S PXAPROB($J,PXASUB,"WARNING3","ENCOUNTER",1,"EC")=$G(PXAERR("9W"))
"RTN","PXAICPTV",86,0)
 .S PXAPROB($J,PXASUB,"WARNING3","ENCOUNTER",1,"MST")=$G(PXAERR("10W"))
"RTN","PXAICPTV",87,0)
 .;PX*1*111 - Add HNC
"RTN","PXAICPTV",88,0)
 .S PXAPROB($J,PXASUB,"WARNING3","ENCOUNTER",1,"HNC")=$G(PXAERR("17W"))
"RTN","PXAICPTV",89,0)
 .S PXAPROB($J,PXASUB,"WARNING3","ENCOUNTER",1,"CV")=$G(PXAERR("18W"))
"RTN","PXAICPTV",90,0)
 .S PXAPROB($J,PXASUB,"WARNING3","ENCOUNTER",1,"SHAD")=$G(PXAERR("19W"))
"RTN","PXAICPTV",91,0)
 I PXADI("DIALOG")=8390001.004 D
"RTN","PXAICPTV",92,0)
 .S PXASUB=PXASUB+1
"RTN","PXAICPTV",93,0)
 .S PXAPROB($J,PXASUB,"ERROR4","PX/DL",PXAK)=$G(PXAERR("PL1"))
"RTN","PXAICPTV",94,0)
 Q
"RTN","PXAIPOVV")
0^13^B2638479^B2601600
"RTN","PXAIPOVV",1,0)
PXAIPOVV ;ISL/JVS,SCK - VALADATE DIAGNOSIS ;6/6/96  07:40
"RTN","PXAIPOVV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**121,194**;Aug 12, 1996;Build 2
"RTN","PXAIPOVV",3,0)
 ;
"RTN","PXAIPOVV",4,0)
VAL ;--VALIDATE ENOUGH DATA
"RTN","PXAIPOVV",5,0)
 ;----Missing a pointer to PROCEDURE(CPT) name
"RTN","PXAIPOVV",6,0)
 I $G(PXAA("DIAGNOSIS"))']"" D  Q:$G(STOP)
"RTN","PXAIPOVV",7,0)
 .S STOP=1 ;--USED TO STOP DO LOOP
"RTN","PXAIPOVV",8,0)
 .S PXAERRF=1 ;--FLAG INDICATES THERE IS AN ERR
"RTN","PXAIPOVV",9,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","PXAIPOVV",10,0)
 .S PXAERR(9)="DIAGNOSIS"
"RTN","PXAIPOVV",11,0)
 .S PXAERR(11)=$G(PXAA("DIAGNOSIS"))
"RTN","PXAIPOVV",12,0)
 .S PXAERR(12)="You are missing a pointer to the DIAGNOSIS FILE#80 that represents the diagnosises name"
"RTN","PXAIPOVV",13,0)
 ;
"RTN","PXAIPOVV",14,0)
 ;----NOT a pointer to PROCEDURE CPT FILE#80
"RTN","PXAIPOVV",15,0)
 I $$ICDDX^ICDCODE($G(PXAA("DIAGNOSIS")))'>0,$G(PXAA("DELETE"))'=1 D  Q:$G(STOP)
"RTN","PXAIPOVV",16,0)
 .S STOP=1
"RTN","PXAIPOVV",17,0)
 .S PXAERRF=1
"RTN","PXAIPOVV",18,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","PXAIPOVV",19,0)
 .S PXAERR(9)="DIAGNOSIS"
"RTN","PXAIPOVV",20,0)
 .S PXAERR(11)=$G(PXAA("DIAGNOSIS"))
"RTN","PXAIPOVV",21,0)
 .S PXAERR(12)=PXAERR(11)_" is NOT a pointer value to the CPT FILE #80"
"RTN","PXAIPOVV",22,0)
 ;
"RTN","PXAIPOVV",23,0)
 ;----not a valid ICD9 code
"RTN","PXAIPOVV",24,0)
 I $P($$ICDDX^ICDCODE(PXAA("DIAGNOSIS"),+^AUPNVSIT(PXAVISIT,0)),"^",10)'=1 D  Q:$G(STOP)
"RTN","PXAIPOVV",25,0)
 .S STOP=1
"RTN","PXAIPOVV",26,0)
 .S PXAERRF=1
"RTN","PXAIPOVV",27,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","PXAIPOVV",28,0)
 .S PXAERR(9)="DIAGNOSIS"
"RTN","PXAIPOVV",29,0)
 .S PXAERR(11)=$G(PXAA("DIAGNOSIS"))
"RTN","PXAIPOVV",30,0)
 .S PXAERR(12)=PXAERR(11)_" is NOT an valid ICD9 code"
"RTN","PXAIPOVV",31,0)
 ;
"RTN","PXAIPOVV",32,0)
 ;
"RTN","PXAIPOVV",33,0)
 Q
"RTN","PXBGCPT2")
0^3^B35739040^B35781906
"RTN","PXBGCPT2",1,0)
PXBGCPT2 ;ISL/JVS,ESW - DOUBLE ?? GATHERING OF CPT CODES ; 10/31/02 12:05pm
"RTN","PXBGCPT2",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,19,108,149,194**;Aug 12, 1996;Build 2
"RTN","PXBGCPT2",3,0)
 ;
"RTN","PXBGCPT2",4,0)
 ;
"RTN","PXBGCPT2",5,0)
 ;
"RTN","PXBGCPT2",6,0)
 W !,"NOT" Q
"RTN","PXBGCPT2",7,0)
 ;
"RTN","PXBGCPT2",8,0)
DOUBLE(FROM) ;--Entry
"RTN","PXBGCPT2",9,0)
 ;
"RTN","PXBGCPT2",10,0)
 N FILE,FIELD,TITLE,HEADING,SUB,CODE,NAME,START,SCREEN,BACK,NUM
"RTN","PXBGCPT2",11,0)
 N SCREEN,TEMP,FIRST
"RTN","PXBGCPT2",12,0)
 S BACK="",NUM=0,SCREEN=""
"RTN","PXBGCPT2",13,0)
 D LOC
"RTN","PXBGCPT2",14,0)
 I $D(DIC("S")) S SCREEN=DIC("S")
"RTN","PXBGCPT2",15,0)
 ;
"RTN","PXBGCPT2",16,0)
START ;
"RTN","PXBGCPT2",17,0)
 ;
"RTN","PXBGCPT2",18,0)
 S TITLE="- - A L L  P R O C E D U R E (CPT CODES) - -"
"RTN","PXBGCPT2",19,0)
 ;
"RTN","PXBGCPT2",20,0)
 D SETUP
"RTN","PXBGCPT2",21,0)
 D LIST^DIC(FILE,"",FIELD,BACK,10,.START,"","",SCREEN,"","^TMP(""PXBTANA"",$J)","^TMP(""PXBTANA"",$J)")
"RTN","PXBGCPT2",22,0)
 ;
"RTN","PXBGCPT2",23,0)
 D LOC,HEAD,SUB
"RTN","PXBGCPT2",24,0)
 ;
"RTN","PXBGCPT2",25,0)
PROMPT ;--PROMPT
"RTN","PXBGCPT2",26,0)
 D WIN17^PXBCC(PXBCNT),LOC^PXBCC(15,1)
"RTN","PXBGCPT2",27,0)
 W !!,"Enter '^' to quit,  '-' for previous page."
"RTN","PXBGCPT2",28,0)
 S DIR("A")="Select a single 'ITEM NUMBER' or 'RETURN' to continue: "
"RTN","PXBGCPT2",29,0)
 S DIR("?")="Enter ITEM 'No' to select , '^' to quit,  '-' for previous page."
"RTN","PXBGCPT2",30,0)
 S DIR(0)="N,A,O^0:10:0^I X'?.1""-"".1""^"".2N!(+X>10) K X"
"RTN","PXBGCPT2",31,0)
 D ^DIR
"RTN","PXBGCPT2",32,0)
 I X="-" S BACK="B" D BACK G START
"RTN","PXBGCPT2",33,0)
 I X="" S BACK="" D FORWARD G START
"RTN","PXBGCPT2",34,0)
 I $G(DIRUT) K DIRUT S VAL="^C" G EXIT
"RTN","PXBGCPT2",35,0)
FINISH ;--FINISH
"RTN","PXBGCPT2",36,0)
 ;
"RTN","PXBGCPT2",37,0)
 S VAL=$G(^TMP("PXBTANA",$J,"DILIST",2,X))_U_$G(^TMP("PXBTANA",$J,"DILIST","ID",X,FIRST))_"--"_$G(^TMP("PXBTANA",$J,"DILIST","ID",X,SECOND))
"RTN","PXBGCPT2",38,0)
EXIT ;--EXIT
"RTN","PXBGCPT2",39,0)
 K DIR,^TMP("PXBTANA",$J),^TMP("PXBTOTAL",$J)
"RTN","PXBGCPT2",40,0)
 Q VAL
"RTN","PXBGCPT2",41,0)
 ;
"RTN","PXBGCPT2",42,0)
DOUBLE1(FROM) ;--Entry
"RTN","PXBGCPT2",43,0)
 ;
"RTN","PXBGCPT2",44,0)
NEW ;
"RTN","PXBGCPT2",45,0)
 N FILE,FIELD,TITLE,HEADING,SUB,CODE,NAME,START,SCREEN,CNT,OK,INDEX,CYCLE
"RTN","PXBGCPT2",46,0)
 N TOTAL,FIRST,SUB2
"RTN","PXBGCPT2",47,0)
 ;---SETUP
"RTN","PXBGCPT2",48,0)
 S BACK="",INDEX=""
"RTN","PXBGCPT2",49,0)
 S START=DATA,SUB=0,SUB2=0
"RTN","PXBGCPT2",50,0)
 ;
"RTN","PXBGCPT2",51,0)
START1 ;--RECYCLE
"RTN","PXBGCPT2",52,0)
 S TITLE="- - S E L E C T E D  P R O C E D U R E S (CPT CODES) - -"
"RTN","PXBGCPT2",53,0)
 S FILE=81
"RTN","PXBGCPT2",54,0)
 S FIELD=".01;2"
"RTN","PXBGCPT2",55,0)
 N TMP,LL,TT
"RTN","PXBGCPT2",56,0)
 S LL=$L(DATA),TT="0000"
"RTN","PXBGCPT2",57,0)
 I DATA?1.4N!(DATA?1A.3N) D
"RTN","PXBGCPT2",58,0)
 .S START=$O(^ICPT("B",DATA_$E(TT,1,5-LL)),-1)
"RTN","PXBGCPT2",59,0)
 I DATA?5N!(DATA?1A4N)!(DATA?4N1A) D
"RTN","PXBGCPT2",60,0)
 .S START=$O(^ICPT("B",START),-1)
"RTN","PXBGCPT2",61,0)
XXX W IOCUOFF,IOCUF,IOCUF
"RTN","PXBGCPT2",62,0)
 N TMP
"RTN","PXBGCPT2",63,0)
 S SUBT=START,TOTAL=0 F  S SUBT=$O(^ICPT("B",SUBT)) Q:SUBT'[DATA  D
"RTN","PXBGCPT2",64,0)
 .I '$$CPTSCREN^PXBUTL($O(^ICPT("B",SUBT,0)),IDATE) Q
"RTN","PXBGCPT2",65,0)
 .S TOTAL=TOTAL+1 S PXBMOD=TOTAL#100 D WAIT^PXBUTL
"RTN","PXBGCPT2",66,0)
 .S ^TMP("PXBTOTAL",$J,"DILIST","ID",TOTAL,.01)=SUBT
"RTN","PXBGCPT2",67,0)
 .S ^TMP("PXBTOTAL",$J,"DILIST","ID",TOTAL,2)=$P($$CPT^ICPTCOD($O(^ICPT("B",SUBT,0)),IDATE),U,3)
"RTN","PXBGCPT2",68,0)
 .S TMP(SUBT)=""
"RTN","PXBGCPT2",69,0)
 I DATA?1.4N!(DATA?.3N1A) D
"RTN","PXBGCPT2",70,0)
 .S START=$O(^ICPT("B",$E(TT,1,5-LL)_DATA),-1)
"RTN","PXBGCPT2",71,0)
 .S SUBT=START F  S SUBT=$O(^ICPT("B",SUBT)) Q:SUBT'[DATA  D
"RTN","PXBGCPT2",72,0)
 ..Q:$D(TMP(SUBT))
"RTN","PXBGCPT2",73,0)
 ..I '$$CPTSCREN^PXBUTL($O(^ICPT("B",SUBT,0)),IDATE) Q
"RTN","PXBGCPT2",74,0)
 ..S TOTAL=TOTAL+1 S PXBMOD=TOTAL#100 D WAIT^PXBUTL
"RTN","PXBGCPT2",75,0)
 ..S ^TMP("PXBTOTAL",$J,"DILIST","ID",TOTAL,.01)=SUBT
"RTN","PXBGCPT2",76,0)
 ..S ^TMP("PXBTOTAL",$J,"DILIST","ID",TOTAL,2)=$P($$CPT^ICPTCOD($O(^ICPT("B",SUBT,0)),IDATE),U,3)
"RTN","PXBGCPT2",77,0)
 W IOCUON
"RTN","PXBGCPT2",78,0)
 ;
"RTN","PXBGCPT2",79,0)
 ;
"RTN","PXBGCPT2",80,0)
 ;
"RTN","PXBGCPT2",81,0)
 I DATA?2.A W IOCUOFF,IOCUF,IOCUF D
"RTN","PXBGCPT2",82,0)
 .N IEN,CODE,ARRAY,XX
"RTN","PXBGCPT2",83,0)
 .D FIND^DIC(81,"","","M",DATA,"","","","","ARRAY")
"RTN","PXBGCPT2",84,0)
 .I $D(ARRAY("DILIST"))<10 S Y=-1 Q
"RTN","PXBGCPT2",85,0)
 .S I=0 F  S I=$O(ARRAY("DILIST",2,I)) Q:'I  D
"RTN","PXBGCPT2",86,0)
 ..S MIEN=ARRAY("DILIST",2,I),XX=$$CPT^ICPTCOD(MIEN,IDATE)
"RTN","PXBGCPT2",87,0)
 ..Q:'$P(XX,U,7)
"RTN","PXBGCPT2",88,0)
 ..S TOTAL=TOTAL+1 S PXBMOD=TOTAL#100 D WAIT^PXBUTL
"RTN","PXBGCPT2",89,0)
 ..S ^TMP("PXBTOTAL",$J,"DILIST","ID",TOTAL,.01)=$P(XX,U,2)
"RTN","PXBGCPT2",90,0)
 ..S ^TMP("PXBTOTAL",$J,"DILIST","ID",TOTAL,2)=DATA_", "_$P(XX,U,3)
"RTN","PXBGCPT2",91,0)
 W IOCUON
"RTN","PXBGCPT2",92,0)
 K SUBT
"RTN","PXBGCPT2",93,0)
 ;
"RTN","PXBGCPT2",94,0)
 ;
"RTN","PXBGCPT2",95,0)
 ;
"RTN","PXBGCPT2",96,0)
 ;--NO MATCH
"RTN","PXBGCPT2",97,0)
 I TOTAL=0 D
"RTN","PXBGCPT2",98,0)
 .I DATA?1A W ! D HELP^PXBUTL0("CPT4")
"RTN","PXBGCPT2",99,0)
 .I DATA'?1A W ! D HELP^PXBUTL0("CPTM")
"RTN","PXBGCPT2",100,0)
 .S ERROR=1,CYCL=1
"RTN","PXBGCPT2",101,0)
 I TOTAL=0 Q TOTAL
"RTN","PXBGCPT2",102,0)
 ;
"RTN","PXBGCPT2",103,0)
 ;--LIST
"RTN","PXBGCPT2",104,0)
 S HEADING="W !,""ITEM"",?6,""CODE"",?15,""DESCRIPTION   "",IOINHI,TOTAL,"" MATCHES"",IOINLOW"
"RTN","PXBGCPT2",105,0)
LIST ;-DISPLAY LIST TO THE SCREEN
"RTN","PXBGCPT2",106,0)
 I TOTAL=1 S X=1 G VAL
"RTN","PXBGCPT2",107,0)
 D LOC W !
"RTN","PXBGCPT2",108,0)
 X HEADING
"RTN","PXBGCPT2",109,0)
 S SUB=SUB-1
"RTN","PXBGCPT2",110,0)
 S NUM=0 F  S SUB=$O(^TMP("PXBTOTAL",$J,"DILIST","ID",SUB)) S NUM=NUM+1 Q:NUM=11  Q:SUB'>0  S SUB2=SUB2+1 D
"RTN","PXBGCPT2",111,0)
 .S CODE=$G(^TMP("PXBTOTAL",$J,"DILIST","ID",SUB,.01))
"RTN","PXBGCPT2",112,0)
 .S NAME=$E($G(^TMP("PXBTOTAL",$J,"DILIST","ID",SUB,2)),1,64)
"RTN","PXBGCPT2",113,0)
 .W !,SUB,?6,CODE,?15,NAME
"RTN","PXBGCPT2",114,0)
 ;
"RTN","PXBGCPT2",115,0)
 ;--one
"RTN","PXBGCPT2",116,0)
 I TOTAL=1 G PRMPT2
"RTN","PXBGCPT2",117,0)
 ;
"RTN","PXBGCPT2",118,0)
PRMPT ;--PROMPT
"RTN","PXBGCPT2",119,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBGCPT2",120,0)
 D LOC^PXBCC(15,1)
"RTN","PXBGCPT2",121,0)
 W !
"RTN","PXBGCPT2",122,0)
 I SUB>0 W !,"Enter '^' to quit"
"RTN","PXBGCPT2",123,0)
 E  I TOTAL>10 W !,"               END OF LIST"
"RTN","PXBGCPT2",124,0)
 I SUB>0 S DIR("A")="Select a single 'ITEM NUMBER' or 'RETURN' to continue: "
"RTN","PXBGCPT2",125,0)
 E  S DIR("A")="Select a single 'ITEM NUMBER' or 'RETURN' to exit: "
"RTN","PXBGCPT2",126,0)
 S DIR("?")="Enter ITEM 'No' to select , '^' to quit"
"RTN","PXBGCPT2",127,0)
 S DIR(0)="N,A,O^0:"_SUB2_":0^I X'?.1""^"".N K X"
"RTN","PXBGCPT2",128,0)
 D ^DIR
"RTN","PXBGCPT2",129,0)
 I X="",SUB>0 G LIST
"RTN","PXBGCPT2",130,0)
 I X="",SUB'>0 S X="^"
"RTN","PXBGCPT2",131,0)
VAL ;--VAL equal value
"RTN","PXBGCPT2",132,0)
 S VAL=$G(^TMP("PXBTOTAL",$J,"DILIST",2,X))_U_$G(^TMP("PXBTOTAL",$J,"DILIST","ID",X,.01))_"--"_$G(^TMP("PXBTOTAL",$J,"DILIST","ID",X,2))
"RTN","PXBGCPT2",133,0)
EXITNEW ;--EXIT
"RTN","PXBGCPT2",134,0)
 K DIR,DIRUT,^TMP("PXBTANA",$J),^TMP("PXBTOTAL",$J)
"RTN","PXBGCPT2",135,0)
 K TANA,TOTAL
"RTN","PXBGCPT2",136,0)
 Q VAL
"RTN","PXBGCPT2",137,0)
 Q
"RTN","PXBGCPT2",138,0)
 ;
"RTN","PXBGCPT2",139,0)
 ;--SUBROUTINES
"RTN","PXBGCPT2",140,0)
BACK ;
"RTN","PXBGCPT2",141,0)
 S START=$G(^TMP("PXBTANA",$J,"DILIST",1,1))
"RTN","PXBGCPT2",142,0)
 S START("IEN")=$G(^TMP("PXBTANA",$J,"DILIST",2,1))
"RTN","PXBGCPT2",143,0)
 Q
"RTN","PXBGCPT2",144,0)
FORWARD ;
"RTN","PXBGCPT2",145,0)
 S START=$G(^TMP("PXBTANA",$J,"DILIST",1,10))
"RTN","PXBGCPT2",146,0)
 S START("IEN")=$G(^TMP("PXBTANA",$J,"DILIST",2,10))
"RTN","PXBGCPT2",147,0)
 Q
"RTN","PXBGCPT2",148,0)
LOC ;--LOCATE CURSOR
"RTN","PXBGCPT2",149,0)
 D LOC^PXBCC(3,1) ;--LOCATE THE CURSOR
"RTN","PXBGCPT2",150,0)
 W IOEDEOP ;--CLEAR THE PAGE
"RTN","PXBGCPT2",151,0)
 Q
"RTN","PXBGCPT2",152,0)
HEAD ;--HEAD
"RTN","PXBGCPT2",153,0)
 W !,IOCUU,IOBON,"HELP SCREEN",IOSGR0,?(IOM-$L(TITLE))\2,IOINHI,TITLE,IOINLOW,IOELEOL
"RTN","PXBGCPT2",154,0)
 Q
"RTN","PXBGCPT2",155,0)
SUB ;--LIST
"RTN","PXBGCPT2",156,0)
 I $P(^TMP("PXBTANA",$J,"DILIST",0),U)=0 W !!,"     E N D  O F  L I S T" Q
"RTN","PXBGCPT2",157,0)
 X HEADING
"RTN","PXBGCPT2",158,0)
 S SUB=0,CNT=0 F  S SUB=$O(^TMP("PXBTANA",$J,"DILIST","ID",SUB)) Q:SUB'>0  S CNT=CNT+1 D
"RTN","PXBGCPT2",159,0)
 .S CODE=$G(^TMP("PXBTANA",$J,"DILIST","ID",SUB,FIRST))
"RTN","PXBGCPT2",160,0)
 .S NAME=$G(^TMP("PXBTANA",$J,"DILIST","ID",SUB,SECOND))
"RTN","PXBGCPT2",161,0)
 .W !,SUB,?6,CODE,?15,NAME
"RTN","PXBGCPT2",162,0)
 Q
"RTN","PXBGCPT2",163,0)
SETUP ;--SET
"RTN","PXBGCPT2",164,0)
 S FILE=81,FIRST=.01,SECOND=2
"RTN","PXBGCPT2",165,0)
 S FIELD=FIRST_";"_SECOND
"RTN","PXBGCPT2",166,0)
 S HEADING="W !,""ITEM"",?6,""CODE"",?15,""DESCRIPTION"""
"RTN","PXBGCPT2",167,0)
 Q
"RTN","PXBGCPT2",168,0)
PRMPT2 ;--Yes and No prompt
"RTN","PXBGCPT2",169,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBGCPT2",170,0)
 D LOC^PXBCC(15,1)
"RTN","PXBGCPT2",171,0)
 S DIR("A")="Is this the correct entry "
"RTN","PXBGCPT2",172,0)
 S DIR("B")="YES"
"RTN","PXBGCPT2",173,0)
 S DIR(0)="Y"
"RTN","PXBGCPT2",174,0)
 D ^DIR
"RTN","PXBGCPT2",175,0)
 I Y=0 S X="^"
"RTN","PXBGCPT2",176,0)
 I Y=1 S X=1
"RTN","PXBGCPT2",177,0)
 G VAL
"RTN","PXBGCPT2",178,0)
 ;
"RTN","PXCACPT")
0^2^B47966106^B47517284
"RTN","PXCACPT",1,0)
PXCACPT ;ISL/dee & LEA/Chylton,SCK - Validates & Translates data from the PCE Device Interface into PCE's PXK format for CPTs ;5/24/04 3:51pm
"RTN","PXCACPT",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**27,33,73,121,124,194**;Aug 12, 1996;Build 2
"RTN","PXCACPT",3,0)
 Q
"RTN","PXCACPT",4,0)
 ; Variables
"RTN","PXCACPT",5,0)
 ;   PXCAPROC  Copy of a Procedure node of the PXCA array
"RTN","PXCACPT",6,0)
 ;   PXCAPRV   Pointer to the provider (200)
"RTN","PXCACPT",7,0)
 ;   PXCANUMB  Count of the number of CPTs and treatments
"RTN","PXCACPT",8,0)
 ;   PXCAINDX  Count of the number of procedures for one provider
"RTN","PXCACPT",9,0)
 ;   PXCAPNAR  Pointer to the provider narrative (9999999.27)
"RTN","PXCACPT",10,0)
 ;   PXCATRT   Pointer to the Treatment file (9999999.17)
"RTN","PXCACPT",11,0)
 ;
"RTN","PXCACPT",12,0)
PROC(PXCA,PXCABULD,PXCAERRS,PXCAEVAL) ;
"RTN","PXCACPT",13,0)
 I '$D(PXCA("PROCEDURE")),'PXCAEVAL,$P($G(^PX(815,1,"DI")),"^",1),'$D(^AUPNVCPT("AD",+PXCAVSIT)) S PXCA("WARNING","PROCEDURE",0,0,0)="PROCEDURE data missing" Q
"RTN","PXCACPT",14,0)
 N PXCAPROC,PXCAPRV,PXCANUMB,PXCAINDX,PXCAITEM,PXCALEN
"RTN","PXCACPT",15,0)
 N PXCAPNAR,PXCANARC
"RTN","PXCACPT",16,0)
 S PXCAPRV=""
"RTN","PXCACPT",17,0)
 S PXCANUMB=1
"RTN","PXCACPT",18,0)
 F  S PXCAPRV=$O(PXCA("PROCEDURE",PXCAPRV)) Q:PXCAPRV']""  D
"RTN","PXCACPT",19,0)
 . I PXCAPRV>0 D
"RTN","PXCACPT",20,0)
 .. I '$$ACTIVPRV^PXAPI(PXCAPRV,PXCADT) S PXCA("ERROR","PROCEDURE",PXCAPRV,0,0)="Provider is not active or valid^"_PXCAPRV
"RTN","PXCACPT",21,0)
 . I '$T&PXCABULD!PXCAERRS D ANOTHPRV^PXCAPRV(PXCAPRV)
"RTN","PXCACPT",22,0)
 . S PXCAINDX=0
"RTN","PXCACPT",23,0)
 . F  S PXCAINDX=$O(PXCA("PROCEDURE",PXCAPRV,PXCAINDX)) Q:PXCAINDX']""  D
"RTN","PXCACPT",24,0)
 .. N PXCATRT
"RTN","PXCACPT",25,0)
 .. S PXCANUMB=PXCANUMB+1
"RTN","PXCACPT",26,0)
 .. S PXCAPROC=$G(PXCA("PROCEDURE",PXCAPRV,PXCAINDX))
"RTN","PXCACPT",27,0)
 .. I PXCAPROC="" S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,0)="PROCEDURE data missing" Q
"RTN","PXCACPT",28,0)
 .. S PXCAITEM=$P(PXCAPROC,U,1)
"RTN","PXCACPT",29,0)
 .. I PXCAITEM]"" D
"RTN","PXCACPT",30,0)
 ... ;S D=$G(^ICPT(+PXCAITEM,0))
"RTN","PXCACPT",31,0)
 ... S D=$$CPT^ICPTCOD(+PXCAITEM)
"RTN","PXCACPT",32,0)
 ... I D<0 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,1)="CPT code not in File 81^"_PXCAITEM
"RTN","PXCACPT",33,0)
 ... E  I '(+$$CPTSCREN^PXBUTL(PXCAITEM,+PXCADT)) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,1)="CPT code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",34,0)
 .. E  D
"RTN","PXCACPT",35,0)
 ... S PXCATRT=$O(^AUTTTRT("B",+$P(PXCAPROC,"^",6),""))
"RTN","PXCACPT",36,0)
 ... S:PXCATRT="" PXCATRT=$O(^AUTTTRT("B","OTHER",""))
"RTN","PXCACPT",37,0)
 ... I 'PXCATRT S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,6)="Could not get pointer to treatment term^"_$P(PXCAPROC,"^",6)
"RTN","PXCACPT",38,0)
 .. S PXCAITEM=$P(PXCAPROC,U,2)
"RTN","PXCACPT",39,0)
 .. I PXCAITEM="" S PXCAITEM=1,$P(PXCAPROC,U,2)=PXCAITEM
"RTN","PXCACPT",40,0)
 .. I PXCAITEM'>0 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,2)="CPT Quantity must be > 0^"_PXCAITEM
"RTN","PXCACPT",41,0)
 .. S PXCAITEM=$P(PXCAPROC,U,3)
"RTN","PXCACPT",42,0)
 .. I '(PXCAITEM=""!(PXCAITEM="P")!(PXCAITEM="S")) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,3)="Specification code must be P|S^"_PXCAITEM
"RTN","PXCACPT",43,0)
 .. S PXCAITEM=+$P(PXCAPROC,U,5)
"RTN","PXCACPT",44,0)
 .. I PXCAITEM D
"RTN","PXCACPT",45,0)
 ... ; S D=$G(^ICD9(PXCAITEM,0))
"RTN","PXCACPT",46,0)
 ... S D=$$ICDDX^ICDCODE(PXCAITEM,PXCADT)
"RTN","PXCACPT",47,0)
 ... I D="" S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,5)="Associated Primary Diagnosis ICD9 Code not in File 81^"_PXCAITEM
"RTN","PXCACPT",48,0)
 ... E  I '(+$$ICDDX^ICDCODE(PXCAITEM,+PXCADT)) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,1)="ICD code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",49,0)
 .. S PXCAITEM=+$P(PXCAPROC,U,8)
"RTN","PXCACPT",50,0)
 .. I PXCAITEM D
"RTN","PXCACPT",51,0)
 ... ; S D=$G(^ICD9(PXCAITEM,0))
"RTN","PXCACPT",52,0)
 ... S D=$$ICDDX^ICDCODE(PXCAITEM,PXCADT)
"RTN","PXCACPT",53,0)
 ... I D="" S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,8)="Associated Diagnosis 2 ICD9 Code not in file 80^"_PXCAITEM
"RTN","PXCACPT",54,0)
 ... E  I '(+$$ICDDX^ICDCODE(PXCAITEM,+PXCADT)) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,8)="Associated Diagnosis 2 ICD9 Code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",55,0)
 .. S PXCAITEM=+$P(PXCAPROC,U,9)
"RTN","PXCACPT",56,0)
 .. I PXCAITEM D
"RTN","PXCACPT",57,0)
 ... ; S D=$G(^ICD9(PXCAITEM,0))
"RTN","PXCACPT",58,0)
 ... S D=$$ICDDX^ICDCODE(PXCAITEM,PXCADT)
"RTN","PXCACPT",59,0)
 ... I D="" S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,9)="Associated Diagnosis 3 ICD9 Code not in file 80^"_PXCAITEM
"RTN","PXCACPT",60,0)
 ... E  I '(+$$ICDDX^ICDCODE(PXCAITEM,+PXCADT)) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,9)="Associated Diagnosis 3 ICD9 Code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",61,0)
 .. S PXCAITEM=+$P(PXCAPROC,U,10)
"RTN","PXCACPT",62,0)
 .. I PXCAITEM D
"RTN","PXCACPT",63,0)
 ...  ; S D=$G(^ICD9(PXCAITEM,0))
"RTN","PXCACPT",64,0)
 ... S D=$$ICDDX^ICDCODE(PXCAITEM,PXCADT)
"RTN","PXCACPT",65,0)
 ... I D="" S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,10)="Associated Diagnosis 4 ICD9 Code not in file 80^"_PXCAITEM
"RTN","PXCACPT",66,0)
 ... E  I '(+$$ICDDX^ICDCODE(PXCAITEM,+PXCADT)) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,10)="Associated Diagnosis 4 ICD9 Code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",67,0)
 .. S PXCAITEM=+$P(PXCAPROC,U,11)
"RTN","PXCACPT",68,0)
 .. I PXCAITEM D
"RTN","PXCACPT",69,0)
 ... ; S D=$G(^ICD9(PXCAITEM,0))
"RTN","PXCACPT",70,0)
 ... S D=$$ICDDX^ICDCODE(PXCAITEM,PXCADT)
"RTN","PXCACPT",71,0)
 ... I D="" S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,11)="Associated Diagnosis 5 ICD9 Code not in file 80^"_PXCAITEM
"RTN","PXCACPT",72,0)
 ... E  I '(+$$ICDDX^ICDCODE(PXCAITEM,+PXCADT)) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,11)="Associated Diagnosis 5 ICD9 Code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",73,0)
 .. S PXCAITEM=+$P(PXCAPROC,U,12)
"RTN","PXCACPT",74,0)
 .. I PXCAITEM D
"RTN","PXCACPT",75,0)
 ... ; S D=$G(^ICD9(PXCAITEM,0))
"RTN","PXCACPT",76,0)
 ... S D=$$ICDDX^ICDCODE(PXCAITEM,PXCADT)
"RTN","PXCACPT",77,0)
 ... I D="" S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,12)="Associated Diagnosis 6 ICD9 Code not in file 80^"_PXCAITEM
"RTN","PXCACPT",78,0)
 ... E  I '(+$$ICDDX^ICDCODE(PXCAITEM,+PXCADT)) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,12)="Associated Diagnosis 6 ICD9 Code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",79,0)
 .. S PXCAITEM=+$P(PXCAPROC,U,13)
"RTN","PXCACPT",80,0)
 .. I PXCAITEM D
"RTN","PXCACPT",81,0)
 ... ; S D=$G(^ICD9(PXCAITEM,0))
"RTN","PXCACPT",82,0)
 ... S D=$$ICDDX^ICDCODE(PXCAITEM,PXCADT)
"RTN","PXCACPT",83,0)
 ... I D="" S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,13)="Associated Diagnosis 7 ICD9 Code not in file 80^"_PXCAITEM
"RTN","PXCACPT",84,0)
 ... E  I '(+$$ICDDX^ICDCODE(PXCAITEM,+PXCADT)) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,13)="Associated Diagnosis 7 ICD9 Code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",85,0)
 .. S PXCAITEM=+$P(PXCAPROC,U,14)
"RTN","PXCACPT",86,0)
 .. I PXCAITEM D
"RTN","PXCACPT",87,0)
 ... ; S D=$G(^ICD9(PXCAITEM,0))
"RTN","PXCACPT",88,0)
 ... S D=$$ICDDX^ICDCODE(PXCAITEM,PXCADT)
"RTN","PXCACPT",89,0)
 ... I D="" S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,14)="Associated Diagnosis 8 ICD9 Code not in file 80^"_PXCAITEM
"RTN","PXCACPT",90,0)
 ... E  I '(+$$ICDDX^ICDCODE(PXCAITEM,+PXCADT)) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,14)="Associated Diagnosis 8 ICD9 Code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",91,0)
 .. S PXCAITEM=$P(PXCAPROC,U,6),PXCALEN=$L(PXCAITEM)
"RTN","PXCACPT",92,0)
 .. I PXCALEN<2!(PXCALEN>80) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,6)="Provider's PROCEDURE term must be 2-80 Characters^"_PXCAITEM
"RTN","PXCACPT",93,0)
 .. E  D
"RTN","PXCACPT",94,0)
 ... S PXCAPNAR=+$$PROVNARR^PXAPI(PXCAITEM,$S($P(PXCAPROC,"^",1)="":9000010.15,1:9000010.18))
"RTN","PXCACPT",95,0)
 ... I PXCAPNAR'>0 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,6)="Could not get pointer to Provider's PROCEDURE term^"_$P(PXCAPROC,"^",6) Q:'PXCAERRS
"RTN","PXCACPT",96,0)
 ... S $P(PXCAPROC,"^",6)=PXCAPNAR
"RTN","PXCACPT",97,0)
 .. S PXCAITEM=$P(PXCAPROC,U,7),PXCALEN=$L(PXCAITEM)
"RTN","PXCACPT",98,0)
 .. I PXCALEN>0 D
"RTN","PXCACPT",99,0)
 ... I PXCALEN<2!(PXCALEN>80) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,7)="Provider's PROCEDURE grouper must be 2-80 Characters^"_PXCAITEM
"RTN","PXCACPT",100,0)
 ... E  D
"RTN","PXCACPT",101,0)
 .... S PXCANARC=+$$PROVNARR^PXAPI(PXCAITEM,$S($P(PXCAPROC,"^",1)="":9000010.15,1:9000010.18))
"RTN","PXCACPT",102,0)
 .... I PXCANARC'>0 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,7)="Could not get pointer to Provider's PROCEDURE grouper^"_PXCAITEM
"RTN","PXCACPT",103,0)
 .... E  S $P(PXCAPROC,"^",7)=PXCANARC
"RTN","PXCACPT",104,0)
 .. I PXCABULD&'$D(PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX))!PXCAERRS D
"RTN","PXCACPT",105,0)
 ... I $P(PXCAPROC,"^",1)]"" D
"RTN","PXCACPT",106,0)
 .... D CPT^PXCACPT1(.PXCA,PXCAPROC,PXCANUMB,PXCAPRV,PXCAINDX,PXCAERRS)
"RTN","PXCACPT",107,0)
 ... E  D TRT^PXCATRT(PXCAPROC,PXCANUMB,PXCAPRV,PXCAINDX,PXCAERRS,PXCATRT)
"RTN","PXCACPT",108,0)
 Q
"RTN","PXCACPT",109,0)
 ;
"RTN","PXCADXP1")
0^4^B24306608^B22182571
"RTN","PXCADXP1",1,0)
PXCADXP1 ;ISL/dee & LEA/Chylton,SCK - Validates & Translates data from the PCE Device Interface into a call to V POV & update Problem List ;3/20/97
"RTN","PXCADXP1",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**24,33,194**;Aug 12, 1996;Build 2
"RTN","PXCADXP1",3,0)
 Q
"RTN","PXCADXP1",4,0)
 ;
"RTN","PXCADXP1",5,0)
PART1 ;
"RTN","PXCADXP1",6,0)
 N PXCACLEX
"RTN","PXCADXP1",7,0)
 S (PXCADIAG,PXCAPROB)=0
"RTN","PXCADXP1",8,0)
 I "^^^"'[$P(PXCADXPL,"^",5,8) S PXCAPROB=1
"RTN","PXCADXP1",9,0)
 ;Note
"RTN","PXCADXP1",10,0)
 S PXCAITEM=$P($G(PXCA("DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,"NOTE")),"^",1),PXCAITM2=$L(PXCAITEM)
"RTN","PXCADXP1",11,0)
 I PXCAITEM]"" D
"RTN","PXCADXP1",12,0)
 . I PXCAITM2<3!(PXCAITM2>60) S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,"NOTE",1)="PROBLEM Note must be 1-60 Characters^"_PXCAITEM
"RTN","PXCADXP1",13,0)
 . S PXCAPROB=1
"RTN","PXCADXP1",14,0)
 ;
"RTN","PXCADXP1",15,0)
 ;Diagnosis Code
"RTN","PXCADXP1",16,0)
 S PXCAITEM=$P(PXCADXPL,"^",1)
"RTN","PXCADXP1",17,0)
 I PXCAITEM>0 D
"RTN","PXCADXP1",18,0)
 . S PXCADIQ1=$$ICDDX^ICDCODE(PXCAITEM)
"RTN","PXCADXP1",19,0)
 . I PXCADIQ1<0 S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,1)="ICD9 Code not in file 80^"_PXCAITEM
"RTN","PXCADXP1",20,0)
 . E  I $P(PXCADIQ1,U,12),$P(PXCADIQ1,U,12)'>+PXCADT S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,1)="ICD9 Code is INACTIVE^"_PXCAITEM
"RTN","PXCADXP1",21,0)
 . ;N DIC,DR,DA,DIQ,PXCADIQ1
"RTN","PXCADXP1",22,0)
 . ;S DIC=80
"RTN","PXCADXP1",23,0)
 . ;S DR=".01;102"
"RTN","PXCADXP1",24,0)
 . ;S DA=PXCAITEM
"RTN","PXCADXP1",25,0)
 . ;S DIQ="PXCADIQ1("
"RTN","PXCADXP1",26,0)
 . ;S DIQ(0)="I"
"RTN","PXCADXP1",27,0)
 . ;D EN^DIQ1
"RTN","PXCADXP1",28,0)
 . ;I $G(PXCADIQ1(80,DA,.01,"I"))="" S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,1)="ICD9 Code not in file 80^"_PXCAITEM
"RTN","PXCADXP1",29,0)
 . ;E  I $G(PXCADIQ1(80,DA,102,"I")),PXCADIQ1(80,DA,102,"I")'>+PXCADT S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,1)="ICD9 Code is INACTIVE^"_PXCAITEM
"RTN","PXCADXP1",30,0)
 ;
"RTN","PXCADXP1",31,0)
 ;Diagnosis Specification Code
"RTN","PXCADXP1",32,0)
 S PXCAITM2=$P(PXCADXPL,"^",2)
"RTN","PXCADXP1",33,0)
 I PXCAITM2'="" D
"RTN","PXCADXP1",34,0)
 . S PXCADIAG=1
"RTN","PXCADXP1",35,0)
 . I '((PXCAITM2="P")!(PXCAITM2="S")!(PXCAITM2="PS")!(PXCAITM2="SP")) S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,2)="Diagnosis specification code must be P|S^"_PXCAITM2
"RTN","PXCADXP1",36,0)
 . E  I PXCAITM2["P",PXCAITEM>0 D
"RTN","PXCADXP1",37,0)
 .. I 'PXCAPDX S PXCAPDX=PXCAITEM
"RTN","PXCADXP1",38,0)
 .. E  I $P($G(^PX(815,1,"DI")),"^",2) S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,2)="There is already a Primary Diagnosis for this encounter^"_PXCAITM2
"RTN","PXCADXP1",39,0)
 .. E  D
"RTN","PXCADXP1",40,0)
 ... S PXCA("WARNING","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,2)="There is already a Primary Diagnosis. This one is changed to Secondary^"_PXCAITM2
"RTN","PXCADXP1",41,0)
 ... S $P(PXCADXPL,"^",2)="S"
"RTN","PXCADXP1",42,0)
 . I PXCAITEM'>0 S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,1)="ICD9 Code is required for DIAGNOSIS^"_PXCAITEM
"RTN","PXCADXP1",43,0)
 ;
"RTN","PXCADXP1",44,0)
 ;Clinical Lexicon Term
"RTN","PXCADXP1",45,0)
 S PXCAITEM=$P(PXCADXPL,"^",3)
"RTN","PXCADXP1",46,0)
 I PXCAITEM]"" D
"RTN","PXCADXP1",47,0)
 . I $D(^LEX(757.01)) D
"RTN","PXCADXP1",48,0)
 .. I $D(^LEX(757.01,PXCAITEM,0))#2'=1 S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,3)="Lexicon Utility term is not in file 757.01^"_PXCAITEM
"RTN","PXCADXP1",49,0)
 .. E  S PXCACLEX=PXCAITEM
"RTN","PXCADXP1",50,0)
 . E  I $D(^GMP(757.01)) D
"RTN","PXCADXP1",51,0)
 .. I $D(^GMP(757.01,PXCAITEM,0))#2'=1 S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,3)="Clinical Lexicon Utility term is not in file 757.01^"_PXCAITEM
"RTN","PXCADXP1",52,0)
 .. E  S PXCACLEX=PXCAITEM
"RTN","PXCADXP1",53,0)
 . E  S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,3)="Lexicon Utility is not installed^"_PXCAITEM
"RTN","PXCADXP1",54,0)
 ;
"RTN","PXCADXP1",55,0)
 ;Problem List IEN
"RTN","PXCADXP1",56,0)
 S PXCAITEM=$P(PXCADXPL,"^",4)
"RTN","PXCADXP1",57,0)
 ;Add to Problem List
"RTN","PXCADXP1",58,0)
 S PXCAITM2=$P(PXCADXPL,"^",5)
"RTN","PXCADXP1",59,0)
 I PXCAITEM]"" D
"RTN","PXCADXP1",60,0)
 . I $G(^AUPNPROB(PXCAITEM,0))="" S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,4)="Problem not in file 9000011^"_PXCAITEM
"RTN","PXCADXP1",61,0)
 . E  I PXCAPAT'=$P($G(^AUPNPROB(PXCAITEM,0)),"^",2) S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,4)="Problem in file 9000011 is for a different Patient^"_PXCAITEM
"RTN","PXCADXP1",62,0)
 . I PXCAITM2=1 S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,5)="Cannot ADD existing Problem to file 9000011^"_PXCAITM2
"RTN","PXCADXP1",63,0)
 E  I PXCAPROB,PXCAITM2'=1 S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,4)="Cannot update an existing Problem with out an IEN to file 9000011^"_PXCAITEM
"RTN","PXCADXP1",64,0)
 I '(PXCAITM2=1!(PXCAITM2=0)!(PXCAITM2="")) S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,5)="Add to Problem List flag bad^"_PXCAITM2
"RTN","PXCADXP1",65,0)
 I PXCAITM2=1,PXCAPRV'>0 S PXCA("ERROR","DIAGNOSIS/PROBLEM",PXCAPRV,PXCAINDX,0)="Provider is required to add a new Problem^"_PXCAPRV
"RTN","PXCADXP1",66,0)
 ;
"RTN","PXCADXP1",67,0)
 Q
"RTN","PXCADXP1",68,0)
 ;
"RTN","PXCAPL")
0^5^B33553090^B31157708
"RTN","PXCAPL",1,0)
PXCAPL ;ISL/dee & LEA/Chylton,SCK - Validates data from the PCE Device Interface into a call to update Problem List ;6/6/05
"RTN","PXCAPL",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**24,27,115,130,168,194**;Aug 12, 1996;Build 2
"RTN","PXCAPL",3,0)
 Q
"RTN","PXCAPL",4,0)
 ;   PXCAPROB  Copy of a Problem node of the PXCA array
"RTN","PXCAPL",5,0)
 ;   PXCAPRV   Pointer to the provider (200)
"RTN","PXCAPL",6,0)
 ;   PXCAINDX  Count of the number of problems for one provider
"RTN","PXCAPL",7,0)
 ;   PXCAPL    The parameter array passed to Problem List
"RTN","PXCAPL",8,0)
 ;   PXCARES   The result back from Problem List
"RTN","PXCAPL",9,0)
 ;   PXCANUMB  Count of the total number of problems
"RTN","PXCAPL",10,0)
 ;
"RTN","PXCAPL",11,0)
 ;
"RTN","PXCAPL",12,0)
PROBLEM(PXCA,PXCABULD,PXCAERRS) ;
"RTN","PXCAPL",13,0)
 Q:'$D(PXCA("PROBLEM"))
"RTN","PXCAPL",14,0)
 I '$D(^AUPNPROB)!($T(UPDATE^GMPLUTL)="") S PXCA("WARNING","PROBLEM",0,0,0)="Problem List Package is not installed" Q
"RTN","PXCAPL",15,0)
 N PXCAPROB,PXCAPRV,PXCAINDX
"RTN","PXCAPL",16,0)
 N PXCAITEM,PXCAITM2
"RTN","PXCAPL",17,0)
 S PXCAPRV=""
"RTN","PXCAPL",18,0)
 F  S PXCAPRV=$O(PXCA("PROBLEM",PXCAPRV)) Q:PXCAPRV']""  D
"RTN","PXCAPL",19,0)
 . I '$$ACTIVPRV^PXAPI(PXCAPRV,PXCADT) S PXCA("ERROR","PROBLEM",PXCAPRV,0,0)="Provider is not active or valid^"_PXCAPRV
"RTN","PXCAPL",20,0)
 . E  I PXCABULD!PXCAERRS D ANOTHPRV^PXCAPRV(PXCAPRV)
"RTN","PXCAPL",21,0)
 . S PXCAINDX=0
"RTN","PXCAPL",22,0)
 . F  S PXCAINDX=$O(PXCA("PROBLEM",PXCAPRV,PXCAINDX)) Q:PXCAINDX']""  D
"RTN","PXCAPL",23,0)
 .. S PXCAPROB=$G(PXCA("PROBLEM",PXCAPRV,PXCAINDX))
"RTN","PXCAPL",24,0)
 .. I PXCAPROB="" S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,0)="PROBLEM data missing" Q
"RTN","PXCAPL",25,0)
 .. S PXCAITEM=$P(PXCAPROB,U,1),PXCAITM2=$L(PXCAITEM)
"RTN","PXCAPL",26,0)
 .. I PXCAITEM]"",PXCAITM2<2!(PXCAITM2>80) S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,1)="Problem Name must be 2-80 Characters^"_PXCAITEM
"RTN","PXCAPL",27,0)
 .. S PXCAITEM=$P(PXCAPROB,U,2)
"RTN","PXCAPL",28,0)
 .. I PXCAITEM]"",PXCAITEM>DT!(PXCAITEM<1800000)!($P(+PXCAITEM,".")'=PXCAITEM)!(PXCAITEM>+$P($P(PXCA("ENCOUNTER"),"^"),".")) S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,7)="Problem Onset Date is bad^"_PXCAITEM
"RTN","PXCAPL",29,0)
 .. S PXCAITEM=$P(PXCAPROB,U,3)
"RTN","PXCAPL",30,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,3)="Problem Active flag bad^"_PXCAITEM
"RTN","PXCAPL",31,0)
 .. E  I PXCAITEM="" S $P(PXCA("PROBLEM",PXCAPRV,PXCAINDX),U,3)=1
"RTN","PXCAPL",32,0)
 .. S PXCAITEM=$P(PXCAPROB,U,4)
"RTN","PXCAPL",33,0)
 .. I PXCAITEM]"",PXCAITEM>DT!(PXCAITEM<1800000)!($P(+PXCAITEM,".")'=PXCAITEM)!(PXCAITEM>+$P($P(PXCA("ENCOUNTER"),"^"),".")) S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,7)="Problem Resolved Date is bad^"_PXCAITEM
"RTN","PXCAPL",34,0)
 .. S PXCAITEM=$P(PXCAPROB,U,5)
"RTN","PXCAPL",35,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,5)="SC flag bad^"_PXCAITEM
"RTN","PXCAPL",36,0)
 .. S PXCAITEM=$P(PXCAPROB,U,6)
"RTN","PXCAPL",37,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,6)="AO flag bad^"_PXCAITEM
"RTN","PXCAPL",38,0)
 .. S PXCAITEM=$P(PXCAPROB,U,7)
"RTN","PXCAPL",39,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,7)="IR flag bad^"_PXCAITEM
"RTN","PXCAPL",40,0)
 .. S PXCAITEM=$P(PXCAPROB,U,8)
"RTN","PXCAPL",41,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,8)="EC flag bad^"_PXCAITEM
"RTN","PXCAPL",42,0)
 .. ;PX*1*115 - ADD MST & HNC
"RTN","PXCAPL",43,0)
 .. S PXCAITEM=$P(PXCAPROB,U,13)
"RTN","PXCAPL",44,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,13)="MST flag bad^"_PXCAITEM
"RTN","PXCAPL",45,0)
 .. S PXCAITEM=$P(PXCAPROB,U,14)
"RTN","PXCAPL",46,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,14)="HNC flag bad^"_PXCAITEM
"RTN","PXCAPL",47,0)
 .. S PXCAITEM=$P(PXCAPROB,U,15)
"RTN","PXCAPL",48,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,14)="CV flag bad^"_PXCAITEM
"RTN","PXCAPL",49,0)
 .. S PXCAITEM=$P(PXCAPROB,U,16)
"RTN","PXCAPL",50,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,16)="PROJ 112/SHAD flag bad^"_PXCAITEM
"RTN","PXCAPL",51,0)
 .. S PXCAITEM=$P(PXCAPROB,U,9)
"RTN","PXCAPL",52,0)
 .. I PXCAITEM>0 D
"RTN","PXCAPL",53,0)
 ... S PXCADIQ1=$$ICDDX^ICDCODE(PXCAITEM)
"RTN","PXCAPL",54,0)
 ... I PXCADIQ1<0 S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,9)="ICD9 Code not in file 80^"_PXCAITEM
"RTN","PXCAPL",55,0)
 ... E  I $P(PXCADIQ1,U,12),$P(PXCADIQ1,U,12)'>+PXCADT S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,9)="ICD9 Code is INACTIVE^"_PXCAITEM
"RTN","PXCAPL",56,0)
 ... ;N DIC,DR,DA,DIQ,PXCADIQ1
"RTN","PXCAPL",57,0)
 ... ;S DIC=80
"RTN","PXCAPL",58,0)
 ... ;S DR=".01;102"
"RTN","PXCAPL",59,0)
 ... ;S DA=PXCAITEM
"RTN","PXCAPL",60,0)
 ... ;S DIQ="PXCADIQ1("
"RTN","PXCAPL",61,0)
 ... ;S DIQ(0)="I"
"RTN","PXCAPL",62,0)
 ... ;D EN^DIQ1
"RTN","PXCAPL",63,0)
 ... ;I $G(PXCADIQ1(80,DA,.01,"I"))="" S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,9)="ICD9 Code not in file 80^"_PXCAITEM
"RTN","PXCAPL",64,0)
 ... ;E  I $G(PXCADIQ1(80,DA,102,"I")),PXCADIQ1(80,DA,102,"I")'>+PXCADT S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,9)="ICD9 Code is INACTIVE^"_PXCAITEM
"RTN","PXCAPL",65,0)
 .. S PXCAITEM=$P(PXCAPROB,U,10)
"RTN","PXCAPL",66,0)
 .. I PXCAITEM]"" D
"RTN","PXCAPL",67,0)
 ... I $G(^AUPNPROB(PXCAITEM,0))="" S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,10)="Problem not in file 9000011^"_PXCAITEM
"RTN","PXCAPL",68,0)
 ... E  I PXCAPAT'=$P($G(^AUPNPROB(PXCAITEM,0)),"^",2) S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,10)="Problem in file 9000011 is for a different Patient^"_PXCAITEM
"RTN","PXCAPL",69,0)
 .. E  S PXCAITEM=$P(PXCAPROB,U,1) I PXCAITEM']"" S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,1)="Problem Name required for a new Problem List entry^"_PXCAITEM
"RTN","PXCAPL",70,0)
 .. S PXCAITEM=$P(PXCAPROB,U,11),PXCAITM2=$L(PXCAITEM)
"RTN","PXCAPL",71,0)
 .. I PXCAITM2>60 S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,11)="PROBLEM comment must be 1-60 Characters^"_PXCAITEM
"RTN","PXCAPL",72,0)
 .. ;
"RTN","PXCAPL",73,0)
 .. ;Clinical Lexicon Term
"RTN","PXCAPL",74,0)
 .. S PXCAITEM=$P(PXCAPROB,"^",12)
"RTN","PXCAPL",75,0)
 .. I PXCAITEM]"" D
"RTN","PXCAPL",76,0)
 ... I $D(^LEX(757.01)) D
"RTN","PXCAPL",77,0)
 .... I $D(^LEX(757.01,PXCAITEM,0))#2'=1 S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,12)="Lexicon Utility term is not in file 757.01^"_PXCAITEM
"RTN","PXCAPL",78,0)
 .... E  S PXCACLEX=PXCAITEM
"RTN","PXCAPL",79,0)
 ... E  I $D(^GMP(757.01)) D
"RTN","PXCAPL",80,0)
 .... I $D(^GMP(757.01,PXCAITEM,0))#2'=1 S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,12)="Clinical Lexicon Utility term is not in file 757.01^"_PXCAITEM
"RTN","PXCAPL",81,0)
 .... E  S PXCACLEX=PXCAITEM
"RTN","PXCAPL",82,0)
 ... E  S PXCA("ERROR","PROBLEM",PXCAPRV,PXCAINDX,12)="Lexicon Utility is not installed^"_PXCAITEM
"RTN","PXCAPL",83,0)
 ;
"RTN","PXCAPL",84,0)
 Q
"RTN","PXCAPL",85,0)
 ;
"RTN","PXKFCPT1")
0^6^B23493411^B22284185
"RTN","PXKFCPT1",1,0)
PXKFCPT1 ;ISL/JVS,SCK - PROCEDURES Routine #2 ;2/11/04 4:18pm
"RTN","PXKFCPT1",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,73,124,194**;Aug 12, 1996;Build 2
"RTN","PXKFCPT1",3,0)
 ;
"RTN","PXKFCPT1",4,0)
 ;
"RTN","PXKFCPT1",5,0)
IMM ;
"RTN","PXKFCPT1",6,0)
 N PXKSEQ1
"RTN","PXKFCPT1",7,0)
 I PXKFGAD=1 D IMMADD
"RTN","PXKFCPT1",8,0)
 I PXKFGDE=1 D IMMDEL
"RTN","PXKFCPT1",9,0)
 Q
"RTN","PXKFCPT1",10,0)
IMMADD ;
"RTN","PXKFCPT1",11,0)
 S PXKKK=""
"RTN","PXKFCPT1",12,0)
 S PXKSEQ1=PXKSEQ+PXKXX
"RTN","PXKFCPT1",13,0)
 S PXKCPT=$P($P(PXKPXD(PXKX),"^",2),";")
"RTN","PXKFCPT1",14,0)
POVNAR ;
"RTN","PXKFCPT1",15,0)
 N PXK1
"RTN","PXKFCPT1",16,0)
 ;K ^UTILITY("DIQ1",$J) 
"RTN","PXKFCPT1",17,0)
 ;S DIC=81,DA=PXKCPT,DR=2 D EN^DIQ1
"RTN","PXKFCPT1",18,0)
 ;S PXKCPTN=$G(^UTILITY("DIQ1",$J,81,DA,2))
"RTN","PXKFCPT1",19,0)
 ;K ^UTILITY("DIQ1",$J),DIC,DA,DR D
"RTN","PXKFCPT1",20,0)
 S PXK1=$$CPT^ICPTCOD(PXKCPT)
"RTN","PXKFCPT1",21,0)
 S PXKCPTN=$P(PXK1,U,3) D
"RTN","PXKFCPT1",22,0)
 .Q:PXKCPTN=""  I $D(^AUTNPOV("B",PXKCPTN)) S PXKCPTN=$O(^AUTNPOV("B",PXKCPTN,0))
"RTN","PXKFCPT1",23,0)
 ;
"RTN","PXKFCPT1",24,0)
QUANTIT S PXKQUN=1,PXSTOP=0
"RTN","PXKFCPT1",25,0)
 S PXXX=0
"RTN","PXKFCPT1",26,0)
 F  S PXXX=$O(^AUPNVCPT("AD",PXKAV(0,3),PXXX)) Q:PXXX=""  D  Q:$G(PXSTOP)
"RTN","PXKFCPT1",27,0)
 .I +$P(^AUPNVCPT(PXXX,0),"^")=PXKCPT D
"RTN","PXKFCPT1",28,0)
 ..S PXKQUN=($P(^AUPNVCPT(PXXX,0),"^",16)+1)
"RTN","PXKFCPT1",29,0)
 ..S PXSTOP=1
"RTN","PXKFCPT1",30,0)
 ..S PXKKK=PXXX
"RTN","PXKFCPT1",31,0)
 ..S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"BEFORE")=$G(^AUPNVCPT(PXXX,0))
"RTN","PXKFCPT1",32,0)
 K PXSTOP
"RTN","PXKFCPT1",33,0)
CATEGOR ;
"RTN","PXKFCPT1",34,0)
 N PXKSEQ2,PXK1,PXK2
"RTN","PXKFCPT1",35,0)
 S PXKCPTT(1)=$P(PXKCPT,"^",1)
"RTN","PXKFCPT1",36,0)
 ;K ^UTILITY("DIQ1",$J)
"RTN","PXKFCPT1",37,0)
 ;S DIC=81,DA=PXKCPTT(1),DR=3 D EN^DIQ1
"RTN","PXKFCPT1",38,0)
 S PXK1=$P($$CPT^ICPTCOD(PXKCPTT(1)),U,4)
"RTN","PXKFCPT1",39,0)
 S PXK2=$$GET1^DIQ(81.1,PXK1,.01)
"RTN","PXKFCPT1",40,0)
 Q:PXK2=""
"RTN","PXKFCPT1",41,0)
 ;Q:$G(^UTILITY("DIQ1",$J,81,DA,3))=""
"RTN","PXKFCPT1",42,0)
 ;S PXKCPTT(4.1)=$G(^UTILITY("DIQ1",$J,81,DA,3))
"RTN","PXKFCPT1",43,0)
 S PXKCPTT(4.1)=PXK2
"RTN","PXKFCPT1",44,0)
 S PXKCPTT(5)=$E(PXKCPTT(4.1),1,30)
"RTN","PXKFCPT1",45,0)
 S PXKCPTT(6)=$O(^AUTNPOV("B",PXKCPTT(5),0))
"RTN","PXKFCPT1",46,0)
 S PXKPCA=$S(PXKCPTT(6)="":PXKCPTT(5),PXKCPTT(6)'="":PXKCPTT(6),1:"")
"RTN","PXKFCPT1",47,0)
 K PXKCPTT ;,^UTILITY("DIQ1",$J),DIC,DR,DA
"RTN","PXKFCPT1",48,0)
 ;PX*1*124
"RTN","PXKFCPT1",49,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"AFTER")=$G(PXKCPT)_"^"_$G(PXKAV(0,2))_"^"_$G(PXKAV(0,3))_"^"_$G(PXKCPTN)_"^"_$G(PXKAV(0,8))_"^^^^"
"RTN","PXKFCPT1",50,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"AFTER")=^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"AFTER")_$G(PXKAV(0,9))_"^"_$G(PXKAV(0,10))_"^"_$G(PXKAV(0,11))_"^"_$G(PXKAV(0,12))_"^"_$G(PXKAV(0,13))_"^"_$G(PXKAV(0,14))_"^"_$G(PXKAV(0,15))_"^"_$G(PXKQUN)
"RTN","PXKFCPT1",51,0)
 S PXKSEQ2=0
"RTN","PXKFCPT1",52,0)
 F  S PXKSEQ2=$O(PXKAFT(1,PXKSEQ2)) Q:'PXKSEQ2  D
"RTN","PXKFCPT1",53,0)
 .S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,1,PXKSEQ2,"AFTER")=PXKAFT(1,PXKSEQ2)
"RTN","PXKFCPT1",54,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,12,"AFTER")=$G(PXKAFT(12))
"RTN","PXKFCPT1",55,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,802,"AFTER")=$G(PXKCA)
"RTN","PXKFCPT1",56,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,812,"AFTER")=$G(PXKAFT(812))
"RTN","PXKFCPT1",57,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,"IEN")=PXKKK
"RTN","PXKFCPT1",58,0)
 K PXKQUN,PXKCPTN,PXKCA,PXXX,PXKKK
"RTN","PXKFCPT1",59,0)
 Q
"RTN","PXKFCPT1",60,0)
IMMDEL ;Retrieve all CPT information for VISIT from V CPT file
"RTN","PXKFCPT1",61,0)
 S PXKSEQ1=PXKSEQ+PXKXX
"RTN","PXKFCPT1",62,0)
 S (XPFG,XP)=0 F  Q:XPFG  S XP=$O(^AUPNVCPT("AD",PXKVST,XP)) Q:XP=""  D
"RTN","PXKFCPT1",63,0)
 .I $P(^AUPNVCPT(XP,0),"^",1)=$P($P(PXKPXD(PXKX),"^",2),";") D  S XPFG=1
"RTN","PXKFCPT1",64,0)
 ..I $P($G(^AUPNVCPT(XP,0)),"^",16)=1 D IMMDEL1
"RTN","PXKFCPT1",65,0)
 ..I $D(XP),$P($G(^AUPNVCPT(XP,0)),"^",16)>1 D IMMDEL2
"RTN","PXKFCPT1",66,0)
 Q
"RTN","PXKFCPT1",67,0)
IMMDEL1 ;
"RTN","PXKFCPT1",68,0)
 N PXKSEQ2,PXKMOD
"RTN","PXKFCPT1",69,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"BEFORE")=$G(^AUPNVCPT(XP,0))
"RTN","PXKFCPT1",70,0)
 S PXKSEQ2=0
"RTN","PXKFCPT1",71,0)
 F  S PXKSEQ2=$O(^AUPNVCPT(XP,1,PXKSEQ2)) Q:'PXKSEQ2  D
"RTN","PXKFCPT1",72,0)
 .S PXKMOD=^AUPNVCPT(XP,1,PXKSEQ2,0)
"RTN","PXKFCPT1",73,0)
 .S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,1,PXKSEQ2,"BEFORE")=PXKMOD
"RTN","PXKFCPT1",74,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,12,"BEFORE")=$G(^AUPNVCPT(XP,12))
"RTN","PXKFCPT1",75,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,802,"BEFORE")=$G(^AUPNVCPT(XP,802))
"RTN","PXKFCPT1",76,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,812,"BEFORE")=$G(^AUPNVCPT(XP,812))
"RTN","PXKFCPT1",77,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,"IEN")=XP
"RTN","PXKFCPT1",78,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"AFTER")="@"
"RTN","PXKFCPT1",79,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,12,"AFTER")=""
"RTN","PXKFCPT1",80,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,802,"AFTER")=""
"RTN","PXKFCPT1",81,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,812,"AFTER")=""
"RTN","PXKFCPT1",82,0)
 K XPFG,XP
"RTN","PXKFCPT1",83,0)
 Q
"RTN","PXKFCPT1",84,0)
IMMDEL2 ;
"RTN","PXKFCPT1",85,0)
 N PXKSEQ2,PXKMOD
"RTN","PXKFCPT1",86,0)
 S PXTEMP=$P($G(^AUPNVCPT(XP,0)),"^",16)
"RTN","PXKFCPT1",87,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"BEFORE")=$G(^AUPNVCPT(XP,0))
"RTN","PXKFCPT1",88,0)
 S PXKSEQ2=0
"RTN","PXKFCPT1",89,0)
 F  S PXKSEQ2=$O(^AUPNVCPT(XP,1,PXKSEQ2)) Q:'PXKSEQ2  D
"RTN","PXKFCPT1",90,0)
 .S PXKMOD=^AUPNVCPT(XP,1,PXKSEQ2,0)
"RTN","PXKFCPT1",91,0)
 .S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,1,PXKSEQ2,"BEFORE")=PXKMOD
"RTN","PXKFCPT1",92,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,12,"BEFORE")=$G(^AUPNVCPT(XP,12))
"RTN","PXKFCPT1",93,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,802,"BEFORE")=$G(^AUPNVCPT(XP,802))
"RTN","PXKFCPT1",94,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,812,"BEFORE")=$G(^AUPNVCPT(XP,812))
"RTN","PXKFCPT1",95,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,"IEN")=XP
"RTN","PXKFCPT1",96,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"AFTER")=$G(^AUPNVCPT(XP,0))
"RTN","PXKFCPT1",97,0)
 S PXKSEQ2=0
"RTN","PXKFCPT1",98,0)
 F  S PXKSEQ2=$O(^AUPNVCPT(XP,1,PXKSEQ2)) Q:'PXKSEQ2  D
"RTN","PXKFCPT1",99,0)
 .S PXKMOD=^AUPNVCPT(XP,1,PXKSEQ2,0)
"RTN","PXKFCPT1",100,0)
 .S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,1,PXKSEQ2,"BEFORE")=PXKMOD
"RTN","PXKFCPT1",101,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,12,"AFTER")=$G(^AUPNVCPT(XP,12))
"RTN","PXKFCPT1",102,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,802,"AFTER")=$G(^AUPNVCPT(XP,802))
"RTN","PXKFCPT1",103,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,812,"AFTER")=$G(^AUPNVCPT(XP,812))
"RTN","PXKFCPT1",104,0)
 S $P(^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"AFTER"),"^",16)=((PXTEMP)-(1))
"RTN","PXKFCPT1",105,0)
 K XPFG,XP,PXTEMP
"RTN","PXKFCPT1",106,0)
 Q
"RTN","PXKFCPT1",107,0)
SK ;--START OF SKIN TEST
"RTN","PXKFCPT1",108,0)
 D IMM
"RTN","PXKFCPT1",109,0)
 Q
"RTN","PXPXRMI1")
0^7^B51661630^B51224708
"RTN","PXPXRMI1",1,0)
PXPXRMI1 ; SLC/PKR,SCK - Build indexes for the V files. ;06/17/2003
"RTN","PXPXRMI1",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**119,194**;Aug 12, 1996;Build 2
"RTN","PXPXRMI1",3,0)
 ;DBIA 4113 supports PXRMSXRM entry points. 
"RTN","PXPXRMI1",4,0)
 ;DBIA 4114 supports setting and killing ^PXRMINDX
"RTN","PXPXRMI1",5,0)
 ;===============================================================
"RTN","PXPXRMI1",6,0)
VCPT ;Build the indexes for V CPT.
"RTN","PXPXRMI1",7,0)
 N CPT,DAS,DATE,DFN,DIFF,DONE,END,ENTRIES,ETEXT,GLOBAL,IND,NE,NERROR,PP
"RTN","PXPXRMI1",8,0)
 N START,TEMP,TENP,TEXT,VISIT
"RTN","PXPXRMI1",9,0)
 ;Don't leave any old stuff around.
"RTN","PXPXRMI1",10,0)
 K ^PXRMINDX(9000010.18)
"RTN","PXPXRMI1",11,0)
 S GLOBAL=$$GET1^DID(9000010.18,"","","GLOBAL NAME")
"RTN","PXPXRMI1",12,0)
 S ENTRIES=$P(^AUPNVCPT(0),U,4)
"RTN","PXPXRMI1",13,0)
 S TENP=ENTRIES/10
"RTN","PXPXRMI1",14,0)
 S TENP=+$P(TENP,".",1)
"RTN","PXPXRMI1",15,0)
 I TENP<1 S TENP=1
"RTN","PXPXRMI1",16,0)
 D BMES^XPDUTL("Building indexes for V CPT")
"RTN","PXPXRMI1",17,0)
 S TEXT="There are "_ENTRIES_" entries to process."
"RTN","PXPXRMI1",18,0)
 D MES^XPDUTL(TEXT)
"RTN","PXPXRMI1",19,0)
 S START=$H
"RTN","PXPXRMI1",20,0)
 S (DAS,DONE,IND,NE,NERROR)=0
"RTN","PXPXRMI1",21,0)
 F  S DAS=$O(^AUPNVCPT(DAS)) Q:DONE  D
"RTN","PXPXRMI1",22,0)
 . I +DAS=0 S DONE=1 Q
"RTN","PXPXRMI1",23,0)
 . I +DAS'=DAS D  Q
"RTN","PXPXRMI1",24,0)
 .. S DONE=1
"RTN","PXPXRMI1",25,0)
 .. S ETEXT="Bad ien: "_DAS_", cannot continue."
"RTN","PXPXRMI1",26,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI1",27,0)
 . S IND=IND+1
"RTN","PXPXRMI1",28,0)
 . I IND#TENP=0 D
"RTN","PXPXRMI1",29,0)
 .. S TEXT="Processing entry "_IND
"RTN","PXPXRMI1",30,0)
 .. D MES^XPDUTL(TEXT)
"RTN","PXPXRMI1",31,0)
 . I IND#10000=0 W "."
"RTN","PXPXRMI1",32,0)
 . S TEMP=^AUPNVCPT(DAS,0)
"RTN","PXPXRMI1",33,0)
 . S CPT=$P(TEMP,U,1)
"RTN","PXPXRMI1",34,0)
 . I CPT="" D  Q
"RTN","PXPXRMI1",35,0)
 .. S ETEXT=DAS_" missing CPT"
"RTN","PXPXRMI1",36,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI1",37,0)
 . ;I '$D(^ICPT(CPT)) D  Q
"RTN","PXPXRMI1",38,0)
 . I $$CPT^ICPTCOD(CPT)<0 D  Q
"RTN","PXPXRMI1",39,0)
 .. S ETEXT=DAS_" invalid CPT"
"RTN","PXPXRMI1",40,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI1",41,0)
 . S DFN=$P(TEMP,U,2)
"RTN","PXPXRMI1",42,0)
 . I DFN="" D  Q
"RTN","PXPXRMI1",43,0)
 .. S ETEXT=DAS_" missing DFN"
"RTN","PXPXRMI1",44,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI1",45,0)
 . S VISIT=$P(TEMP,U,3)
"RTN","PXPXRMI1",46,0)
 . I VISIT="" D  Q
"RTN","PXPXRMI1",47,0)
 .. S ETEXT=DAS_" missing visit"
"RTN","PXPXRMI1",48,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI1",49,0)
 . I '$D(^AUPNVSIT(VISIT)) D  Q
"RTN","PXPXRMI1",50,0)
 .. S ETEXT=DAS_" invalid visit"
"RTN","PXPXRMI1",51,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI1",52,0)
 . S DATE=$P(^AUPNVSIT(VISIT,0),U,1)
"RTN","PXPXRMI1",53,0)
 . I DATE="" D  Q
"RTN","PXPXRMI1",54,0)
 .. S ETEXT=DAS_" missing visit date"
"RTN","PXPXRMI1",55,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI1",56,0)
 . S PP=$P(TEMP,U,7)
"RTN","PXPXRMI1",57,0)
 . I PP="" S PP="U"
"RTN","PXPXRMI1",58,0)
 . S NE=NE+1
"RTN","PXPXRMI1",59,0)
 . S ^PXRMINDX(9000010.18,"IPP",CPT,PP,DFN,DATE,DAS)=""
"RTN","PXPXRMI1",60,0)
 . S ^PXRMINDX(9000010.18,"PPI",DFN,PP,CPT,DATE,DAS)=""
"RTN","PXPXRMI1",61,0)
 S END=$H
"RTN","PXPXRMI1",62,0)
 S TEXT=NE_" V CPT results indexed."
"RTN","PXPXRMI1",63,0)
 D MES^XPDUTL(TEXT)
"RTN","PXPXRMI1",64,0)
 D DETIME^PXRMSXRM(START,END)
"RTN","PXPXRMI1",65,0)
 ;If there were errors send a message.
"RTN","PXPXRMI1",66,0)
 I NERROR>0 D ERRMSG^PXRMSXRM(NERROR,GLOBAL)
"RTN","PXPXRMI1",67,0)
 ;Send a MailMan message with the results.
"RTN","PXPXRMI1",68,0)
 D COMMSG^PXRMSXRM(GLOBAL,START,END,NE,NERROR)
"RTN","PXPXRMI1",69,0)
 S ^PXRMINDX(9000010.18,"GLOBAL NAME")=GLOBAL
"RTN","PXPXRMI1",70,0)
 S ^PXRMINDX(9000010.18,"BUILT BY")=DUZ
"RTN","PXPXRMI1",71,0)
 S ^PXRMINDX(9000010.18,"DATE BUILT")=$$NOW^XLFDT
"RTN","PXPXRMI1",72,0)
 Q
"RTN","PXPXRMI1",73,0)
 ;
"RTN","PXPXRMI1",74,0)
 ;===============================================================
"RTN","PXPXRMI1",75,0)
VHF ;Build the indexes for V HEALTH FACTORS.
"RTN","PXPXRMI1",76,0)
 N CAT,DAS,DATE,DFN,DIFF,DONE,END,ENTRIES,ETEXT,GLOBAL,HF,IND,NE,NERROR
"RTN","PXPXRMI1",77,0)
 N START,TEMP,TENP,TEXT,VISIT
"RTN","PXPXRMI1",78,0)
 ;Don't leave any old stuff around.
"RTN","PXPXRMI1",79,0)
 K ^PXRMINDX(9000010.23)
"RTN","PXPXRMI1",80,0)
 S GLOBAL=$$GET1^DID(9000010.23,"","","GLOBAL NAME")
"RTN","PXPXRMI1",81,0)
 S ENTRIES=$P(^AUPNVHF(0),U,4)
"RTN","PXPXRMI1",82,0)
 S TENP=ENTRIES/10
"RTN","PXPXRMI1",83,0)
 S TENP=+$P(TENP,".",1)
"RTN","PXPXRMI1",84,0)
 I TENP<1 S TENP=1
"RTN","PXPXRMI1",85,0)
 D BMES^XPDUTL("Building indexes for V HEALTH FACTORS")
"RTN","PXPXRMI1",86,0)
 S TEXT="There are "_ENTRIES_" entries to process."
"RTN","PXPXRMI1",87,0)
 D MES^XPDUTL(TEXT)
"RTN","PXPXRMI1",88,0)
 S START=$H
"RTN","PXPXRMI1",89,0)
 S (DAS,DONE,IND,NE,NERROR)=0
"RTN","PXPXRMI1",90,0)
 F  S DAS=$O(^AUPNVHF(DAS)) Q:DONE  D
"RTN","PXPXRMI1",91,0)
 . I +DAS=0 S DONE=1 Q
"RTN","PXPXRMI1",92,0)
 . I +DAS'=DAS D  Q
"RTN","PXPXRMI1",93,0)
 .. S DONE=1
"RTN","PXPXRMI1",94,0)
 .. S ETEXT="Bad ien: "_DAS_", cannot continue."
"RTN","PXPXRMI1",95,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI1",96,0)
 . S IND=IND+1
"RTN","PXPXRMI1",97,0)
 . I IND#TENP=0 D
"RTN","PXPXRMI1",98,0)
 .. S TEXT="Processing entry "_IND
"RTN","PXPXRMI1",99,0)
 .. D MES^XPDUTL(TEXT)
"RTN","PXPXRMI1",100,0)
 . I IND#10000=0 W "."
"RTN","PXPXRMI1",101,0)
 . S TEMP=^AUPNVHF(DAS,0)
"RTN","PXPXRMI1",102,0)
 . S HF=$P(TEMP,U,1)
"RTN","PXPXRMI1",103,0)
 . I HF="" D  Q
"RTN","PXPXRMI1",104,0)
 .. S ETEXT=DAS_" missing HF"
"RTN","PXPXRMI1",105,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI1",106,0)
 . I '$D(^AUTTHF(HF)) D  Q
"RTN","PXPXRMI1",107,0)
 .. S ETEXT=DAS_" invalid HF"
"RTN","PXPXRMI1",108,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI1",109,0)
 . S DFN=$P(TEMP,U,2)
"RTN","PXPXRMI1",110,0)
 . I DFN="" D  Q
"RTN","PXPXRMI1",111,0)
 .. S ETEXT=DAS_" missing DFN"
"RTN","PXPXRMI1",112,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI1",113,0)
 . S CAT=$P(^AUTTHF(HF,0),U,3)
"RTN","PXPXRMI1",114,0)
 . I CAT="" D  Q
"RTN","PXPXRMI1",115,0)
 .. S ETEXT=DAS_" HF "_HF_" missing category"
"RTN","PXPXRMI1",116,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI1",117,0)
 . I HF=CAT D  Q
"RTN","PXPXRMI1",118,0)
 .. S ETEXT=DAS_" HF "_HF_" is a category"
"RTN","PXPXRMI1",119,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI1",120,0)
 . S VISIT=$P(TEMP,U,3)
"RTN","PXPXRMI1",121,0)
 . I VISIT="" D  Q
"RTN","PXPXRMI1",122,0)
 .. S ETEXT=DAS_" missing visit"
"RTN","PXPXRMI1",123,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI1",124,0)
 . I '$D(^AUPNVSIT(VISIT)) D  Q
"RTN","PXPXRMI1",125,0)
 .. S ETEXT=DAS_" invalid visit"
"RTN","PXPXRMI1",126,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI1",127,0)
 . S DATE=$P(^AUPNVSIT(VISIT,0),U,1)
"RTN","PXPXRMI1",128,0)
 . I DATE="" D  Q
"RTN","PXPXRMI1",129,0)
 .. S ETEXT=DAS_" missing visit date"
"RTN","PXPXRMI1",130,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI1",131,0)
 . S NE=NE+1
"RTN","PXPXRMI1",132,0)
 . S ^PXRMINDX(9000010.23,"IP",HF,DFN,DATE,DAS)=""
"RTN","PXPXRMI1",133,0)
 . S ^PXRMINDX(9000010.23,"PI",DFN,HF,DATE,DAS)=""
"RTN","PXPXRMI1",134,0)
 S END=$H
"RTN","PXPXRMI1",135,0)
 S TEXT=NE_" V HEALTH FACTOR results indexed."
"RTN","PXPXRMI1",136,0)
 D MES^XPDUTL(TEXT)
"RTN","PXPXRMI1",137,0)
 D DETIME^PXRMSXRM(START,END)
"RTN","PXPXRMI1",138,0)
 ;If there were errors send a message.
"RTN","PXPXRMI1",139,0)
 I NERROR>0 D ERRMSG^PXRMSXRM(NERROR,GLOBAL)
"RTN","PXPXRMI1",140,0)
 ;Send a MailMan message with the results.
"RTN","PXPXRMI1",141,0)
 D COMMSG^PXRMSXRM(GLOBAL,START,END,NE,NERROR)
"RTN","PXPXRMI1",142,0)
 S ^PXRMINDX(9000010.23,"GLOBAL NAME")=GLOBAL
"RTN","PXPXRMI1",143,0)
 S ^PXRMINDX(9000010.23,"BUILT BY")=DUZ
"RTN","PXPXRMI1",144,0)
 S ^PXRMINDX(9000010.23,"DATE BUILT")=$$NOW^XLFDT
"RTN","PXPXRMI1",145,0)
 Q
"RTN","PXPXRMI1",146,0)
 ;
"RTN","PXPXRMI1",147,0)
 ;===============================================================
"RTN","PXPXRMI1",148,0)
VIMM ;Build the indexes for V IMMUNIZATION.
"RTN","PXPXRMI1",149,0)
 N DAS,DATE,DFN,DIFF,DONE,END,ENTRIES,ETEXT,GLOBAL,IMM,IND,NE,NERROR
"RTN","PXPXRMI1",150,0)
 N START,TEMP,TENP,TEXT,VISIT
"RTN","PXPXRMI1",151,0)
 ;Don't leave any old stuff around.
"RTN","PXPXRMI1",152,0)
 K ^PXRMINDX(9000010.11)
"RTN","PXPXRMI1",153,0)
 S GLOBAL=$$GET1^DID(9000010.11,"","","GLOBAL NAME")
"RTN","PXPXRMI1",154,0)
 S ENTRIES=$P(^AUPNVIMM(0),U,4)
"RTN","PXPXRMI1",155,0)
 S TENP=ENTRIES/10
"RTN","PXPXRMI1",156,0)
 S TENP=+$P(TENP,".",1)
"RTN","PXPXRMI1",157,0)
 I TENP<1 S TENP=1
"RTN","PXPXRMI1",158,0)
 D BMES^XPDUTL("Building indexes for V IMMUNIZATION")
"RTN","PXPXRMI1",159,0)
 S TEXT="There are "_ENTRIES_" entries to process."
"RTN","PXPXRMI1",160,0)
 D MES^XPDUTL(TEXT)
"RTN","PXPXRMI1",161,0)
 S START=$H
"RTN","PXPXRMI1",162,0)
 S (DAS,DONE,IND,NE,NERROR)=0
"RTN","PXPXRMI1",163,0)
 F  S DAS=$O(^AUPNVIMM(DAS)) Q:DONE  D
"RTN","PXPXRMI1",164,0)
 . I +DAS=0 S DONE=1 Q
"RTN","PXPXRMI1",165,0)
 . I +DAS'=DAS D  Q
"RTN","PXPXRMI1",166,0)
 .. S DONE=1
"RTN","PXPXRMI1",167,0)
 .. S ETEXT="Bad ien: "_DAS_", cannot continue."
"RTN","PXPXRMI1",168,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI1",169,0)
 . S IND=IND+1
"RTN","PXPXRMI1",170,0)
 . I IND#TENP=0 D
"RTN","PXPXRMI1",171,0)
 .. S TEXT="Processing entry "_IND
"RTN","PXPXRMI1",172,0)
 .. D MES^XPDUTL(TEXT)
"RTN","PXPXRMI1",173,0)
 . I IND#10000=0 W "."
"RTN","PXPXRMI1",174,0)
 . S TEMP=^AUPNVIMM(DAS,0)
"RTN","PXPXRMI1",175,0)
 . S IMM=$P(TEMP,U,1)
"RTN","PXPXRMI1",176,0)
 . I IMM="" D  Q
"RTN","PXPXRMI1",177,0)
 .. S ETEXT=DAS_" missing immunization"
"RTN","PXPXRMI1",178,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI1",179,0)
 . I '$D(^AUTTIMM(IMM)) D  Q
"RTN","PXPXRMI1",180,0)
 .. S ETEXT=DAS_" invalid immunization"
"RTN","PXPXRMI1",181,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI1",182,0)
 . S DFN=$P(TEMP,U,2)
"RTN","PXPXRMI1",183,0)
 . I DFN="" D  Q
"RTN","PXPXRMI1",184,0)
 .. S ETEXT=DAS_" missing DFN"
"RTN","PXPXRMI1",185,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI1",186,0)
 . S VISIT=$P(TEMP,U,3)
"RTN","PXPXRMI1",187,0)
 . I VISIT="" D  Q
"RTN","PXPXRMI1",188,0)
 .. S ETEXT=DAS_" missing visit"
"RTN","PXPXRMI1",189,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI1",190,0)
 . I '$D(^AUPNVSIT(VISIT)) D  Q
"RTN","PXPXRMI1",191,0)
 .. S ETEXT=DAS_" invalid visit"
"RTN","PXPXRMI1",192,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI1",193,0)
 . S DATE=$P(^AUPNVSIT(VISIT,0),U,1)
"RTN","PXPXRMI1",194,0)
 . I DATE="" D  Q
"RTN","PXPXRMI1",195,0)
 .. S ETEXT=DAS_" missing visit date"
"RTN","PXPXRMI1",196,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI1",197,0)
 . S NE=NE+1
"RTN","PXPXRMI1",198,0)
 . S ^PXRMINDX(9000010.11,"IP",IMM,DFN,DATE,DAS)=""
"RTN","PXPXRMI1",199,0)
 . S ^PXRMINDX(9000010.11,"PI",DFN,IMM,DATE,DAS)=""
"RTN","PXPXRMI1",200,0)
 S END=$H
"RTN","PXPXRMI1",201,0)
 S TEXT=NE_" V IMMUNIZATION results indexed."
"RTN","PXPXRMI1",202,0)
 D MES^XPDUTL(TEXT)
"RTN","PXPXRMI1",203,0)
 D DETIME^PXRMSXRM(START,END)
"RTN","PXPXRMI1",204,0)
 ;If there were errors send a message.
"RTN","PXPXRMI1",205,0)
 I NERROR>0 D ERRMSG^PXRMSXRM(NERROR,GLOBAL)
"RTN","PXPXRMI1",206,0)
 ;Send a MailMan message with the results.
"RTN","PXPXRMI1",207,0)
 D COMMSG^PXRMSXRM(GLOBAL,START,END,NE,NERROR)
"RTN","PXPXRMI1",208,0)
 S ^PXRMINDX(9000010.11,"GLOBAL NAME")=GLOBAL
"RTN","PXPXRMI1",209,0)
 S ^PXRMINDX(9000010.11,"BUILT BY")=DUZ
"RTN","PXPXRMI1",210,0)
 S ^PXRMINDX(9000010.11,"DATE BUILT")=$$NOW^XLFDT
"RTN","PXPXRMI1",211,0)
 Q
"RTN","PXPXRMI1",212,0)
 ;
"RTN","PXPXRMI2")
0^8^B80236604^B79678940
"RTN","PXPXRMI2",1,0)
PXPXRMI2 ; SLC/PKR,SCK - Build indexes for the V files (continued). ;06/17/2003
"RTN","PXPXRMI2",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**119,194**;Aug 12, 1996;Build 2
"RTN","PXPXRMI2",3,0)
 ;DBIA 4113 supports PXRMSXRM entry points. 
"RTN","PXPXRMI2",4,0)
 ;DBIA 4114 supports setting and killing ^PXRMINDX
"RTN","PXPXRMI2",5,0)
 ;===============================================================
"RTN","PXPXRMI2",6,0)
VPED ;Build the indexes for V PATIENT ED.
"RTN","PXPXRMI2",7,0)
 N DAS,DATE,DFN,DIFF,DONE,EDU,END,ENTRIES,ETEXT,GLOBAL,IND,NE,NERROR
"RTN","PXPXRMI2",8,0)
 N START,TEMP,TENP,TEXT,VISIT
"RTN","PXPXRMI2",9,0)
 ;Don't leave any old stuff around.
"RTN","PXPXRMI2",10,0)
 K ^PXRMINDX(9000010.16)
"RTN","PXPXRMI2",11,0)
 S GLOBAL=$$GET1^DID(9000010.16,"","","GLOBAL NAME")
"RTN","PXPXRMI2",12,0)
 S ENTRIES=$P(^AUPNVPED(0),U,4)
"RTN","PXPXRMI2",13,0)
 S TENP=ENTRIES/10
"RTN","PXPXRMI2",14,0)
 S TENP=+$P(TENP,".",1)
"RTN","PXPXRMI2",15,0)
 I TENP<1 S TENP=1
"RTN","PXPXRMI2",16,0)
 D BMES^XPDUTL("Building indexes for V PATIENT ED")
"RTN","PXPXRMI2",17,0)
 S TEXT="There are "_ENTRIES_" entries to process."
"RTN","PXPXRMI2",18,0)
 D MES^XPDUTL(TEXT)
"RTN","PXPXRMI2",19,0)
 S START=$H
"RTN","PXPXRMI2",20,0)
 S (DAS,DONE,IND,NE,NERROR)=0
"RTN","PXPXRMI2",21,0)
 F  S DAS=$O(^AUPNVPED(DAS)) Q:DONE  D
"RTN","PXPXRMI2",22,0)
 . I +DAS=0 S DONE=1 Q
"RTN","PXPXRMI2",23,0)
 . I +DAS'=DAS D  Q
"RTN","PXPXRMI2",24,0)
 .. S DONE=1
"RTN","PXPXRMI2",25,0)
 .. S ETEXT="Bad ien: "_DAS_", cannot continue."
"RTN","PXPXRMI2",26,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",27,0)
 . S IND=IND+1
"RTN","PXPXRMI2",28,0)
 . I IND#TENP=0 D
"RTN","PXPXRMI2",29,0)
 .. S TEXT="Processing entry "_IND
"RTN","PXPXRMI2",30,0)
 .. D MES^XPDUTL(TEXT)
"RTN","PXPXRMI2",31,0)
 . I IND#10000=0 W "."
"RTN","PXPXRMI2",32,0)
 . S TEMP=^AUPNVPED(DAS,0)
"RTN","PXPXRMI2",33,0)
 . S EDU=$P(TEMP,U,1)
"RTN","PXPXRMI2",34,0)
 . I EDU="" D  Q
"RTN","PXPXRMI2",35,0)
 .. S ETEXT=DAS_" missing education topic"
"RTN","PXPXRMI2",36,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",37,0)
 . I '$D(^AUTTEDT(EDU)) D  Q
"RTN","PXPXRMI2",38,0)
 .. S ETEXT=DAS_" invalid education topic"
"RTN","PXPXRMI2",39,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",40,0)
 . S DFN=$P(TEMP,U,2)
"RTN","PXPXRMI2",41,0)
 . I DFN="" D  Q
"RTN","PXPXRMI2",42,0)
 .. S ETEXT=DAS_" missing DFN"
"RTN","PXPXRMI2",43,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",44,0)
 . S VISIT=$P(TEMP,U,3)
"RTN","PXPXRMI2",45,0)
 . I VISIT="" D  Q
"RTN","PXPXRMI2",46,0)
 .. S ETEXT=DAS_" missing visit"
"RTN","PXPXRMI2",47,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",48,0)
 . I '$D(^AUPNVSIT(VISIT)) D  Q
"RTN","PXPXRMI2",49,0)
 .. S ETEXT=DAS_" invalid visit"
"RTN","PXPXRMI2",50,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",51,0)
 . S DATE=$P(^AUPNVSIT(VISIT,0),U,1)
"RTN","PXPXRMI2",52,0)
 . I DATE="" D  Q
"RTN","PXPXRMI2",53,0)
 .. S ETEXT=DAS_" missing visit date"
"RTN","PXPXRMI2",54,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",55,0)
 . S NE=NE+1
"RTN","PXPXRMI2",56,0)
 . S ^PXRMINDX(9000010.16,"IP",EDU,DFN,DATE,DAS)=""
"RTN","PXPXRMI2",57,0)
 . S ^PXRMINDX(9000010.16,"PI",DFN,EDU,DATE,DAS)=""
"RTN","PXPXRMI2",58,0)
 S END=$H
"RTN","PXPXRMI2",59,0)
 S TEXT=NE_" V PATIENT ED results indexed."
"RTN","PXPXRMI2",60,0)
 D MES^XPDUTL(TEXT)
"RTN","PXPXRMI2",61,0)
 D DETIME^PXRMSXRM(START,END)
"RTN","PXPXRMI2",62,0)
 ;If there were errors send a message.
"RTN","PXPXRMI2",63,0)
 I NERROR>0 D ERRMSG^PXRMSXRM(NERROR,GLOBAL)
"RTN","PXPXRMI2",64,0)
 ;Send a MailMan message with the results.
"RTN","PXPXRMI2",65,0)
 D COMMSG^PXRMSXRM(GLOBAL,START,END,NE,NERROR)
"RTN","PXPXRMI2",66,0)
 S ^PXRMINDX(9000010.16,"GLOBAL NAME")=GLOBAL
"RTN","PXPXRMI2",67,0)
 S ^PXRMINDX(9000010.16,"BUILT BY")=DUZ
"RTN","PXPXRMI2",68,0)
 S ^PXRMINDX(9000010.16,"DATE BUILT")=$$NOW^XLFDT
"RTN","PXPXRMI2",69,0)
 Q
"RTN","PXPXRMI2",70,0)
 ;
"RTN","PXPXRMI2",71,0)
 ;===============================================================
"RTN","PXPXRMI2",72,0)
VPOV ;Build the indexes for V POV.
"RTN","PXPXRMI2",73,0)
 N DAS,DATE,DFN,DIFF,DONE,END,ENTRIES,ETEXT,GLOBAL,IND,NE,NERROR,POV,PS
"RTN","PXPXRMI2",74,0)
 N START,TEMP,TENP,TEXT,VISIT
"RTN","PXPXRMI2",75,0)
 ;Don't leave any old stuff around.
"RTN","PXPXRMI2",76,0)
 K ^PXRMINDX(9000010.07)
"RTN","PXPXRMI2",77,0)
 S GLOBAL=$$GET1^DID(9000010.07,"","","GLOBAL NAME")
"RTN","PXPXRMI2",78,0)
 S ENTRIES=$P(^AUPNVPOV(0),U,4)
"RTN","PXPXRMI2",79,0)
 S TENP=ENTRIES/10
"RTN","PXPXRMI2",80,0)
 S TENP=+$P(TENP,".",1)
"RTN","PXPXRMI2",81,0)
 I TENP<1 S TENP=1
"RTN","PXPXRMI2",82,0)
 D BMES^XPDUTL("Building indexes for V POV")
"RTN","PXPXRMI2",83,0)
 S TEXT="There are "_ENTRIES_" entries to process."
"RTN","PXPXRMI2",84,0)
 D MES^XPDUTL(TEXT)
"RTN","PXPXRMI2",85,0)
 S START=$H
"RTN","PXPXRMI2",86,0)
 S (DAS,DONE,IND,NE,NERROR)=0
"RTN","PXPXRMI2",87,0)
 F  S DAS=$O(^AUPNVPOV(DAS)) Q:DONE  D
"RTN","PXPXRMI2",88,0)
 . I +DAS=0 S DONE=1 Q
"RTN","PXPXRMI2",89,0)
 . I +DAS'=DAS D  Q
"RTN","PXPXRMI2",90,0)
 .. S DONE=1
"RTN","PXPXRMI2",91,0)
 .. S ETEXT="Bad ien: "_DAS_", cannot continue."
"RTN","PXPXRMI2",92,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",93,0)
 . S IND=IND+1
"RTN","PXPXRMI2",94,0)
 . I IND#TENP=0 D
"RTN","PXPXRMI2",95,0)
 .. S TEXT="Processing entry "_IND
"RTN","PXPXRMI2",96,0)
 .. D MES^XPDUTL(TEXT)
"RTN","PXPXRMI2",97,0)
 . I IND#10000=0 W "."
"RTN","PXPXRMI2",98,0)
 . S TEMP=^AUPNVPOV(DAS,0)
"RTN","PXPXRMI2",99,0)
 . S POV=$P(TEMP,U,1)
"RTN","PXPXRMI2",100,0)
 . I POV="" D  Q
"RTN","PXPXRMI2",101,0)
 .. S ETEXT=DAS_" missing POV (ICD9)"
"RTN","PXPXRMI2",102,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",103,0)
 . ;I '$D(^ICD9(POV)) D  Q
"RTN","PXPXRMI2",104,0)
 . I $$ICDDX^ICDCODE(POV)<0 D  Q
"RTN","PXPXRMI2",105,0)
 .. S ETEXT=DAS_" invalid ICD9"
"RTN","PXPXRMI2",106,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",107,0)
 . S DFN=$P(TEMP,U,2)
"RTN","PXPXRMI2",108,0)
 . I DFN="" D  Q
"RTN","PXPXRMI2",109,0)
 .. S ETEXT=DAS_" missing DFN"
"RTN","PXPXRMI2",110,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",111,0)
 . S VISIT=$P(TEMP,U,3)
"RTN","PXPXRMI2",112,0)
 . I VISIT="" D  Q
"RTN","PXPXRMI2",113,0)
 .. S ETEXT=DAS_" missing visit"
"RTN","PXPXRMI2",114,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",115,0)
 . I '$D(^AUPNVSIT(VISIT)) D  Q
"RTN","PXPXRMI2",116,0)
 .. S ETEXT=DAS_" invalid visit"
"RTN","PXPXRMI2",117,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",118,0)
 . S PS=$P(TEMP,U,12)
"RTN","PXPXRMI2",119,0)
 . I PS="" S PS="U"
"RTN","PXPXRMI2",120,0)
 . S DATE=$P(^AUPNVSIT(VISIT,0),U,1)
"RTN","PXPXRMI2",121,0)
 . I DATE="" D  Q
"RTN","PXPXRMI2",122,0)
 .. S ETEXT=DAS_" missing visit date"
"RTN","PXPXRMI2",123,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",124,0)
 . S NE=NE+1
"RTN","PXPXRMI2",125,0)
 . S ^PXRMINDX(9000010.07,"IPP",POV,PS,DFN,DATE,DAS)=""
"RTN","PXPXRMI2",126,0)
 . S ^PXRMINDX(9000010.07,"PPI",DFN,PS,POV,DATE,DAS)=""
"RTN","PXPXRMI2",127,0)
 S END=$H
"RTN","PXPXRMI2",128,0)
 S TEXT=NE_" V POV results indexed."
"RTN","PXPXRMI2",129,0)
 D MES^XPDUTL(TEXT)
"RTN","PXPXRMI2",130,0)
 D DETIME^PXRMSXRM(START,END)
"RTN","PXPXRMI2",131,0)
 ;If there were errors send a message.
"RTN","PXPXRMI2",132,0)
 I NERROR>0 D ERRMSG^PXRMSXRM(NERROR,GLOBAL)
"RTN","PXPXRMI2",133,0)
 ;Send a MailMan message with the results.
"RTN","PXPXRMI2",134,0)
 D COMMSG^PXRMSXRM(GLOBAL,START,END,NE,NERROR)
"RTN","PXPXRMI2",135,0)
 S ^PXRMINDX(9000010.07,"GLOBAL NAME")=GLOBAL
"RTN","PXPXRMI2",136,0)
 S ^PXRMINDX(9000010.07,"BUILT BY")=DUZ
"RTN","PXPXRMI2",137,0)
 S ^PXRMINDX(9000010.07,"DATE BUILT")=$$NOW^XLFDT
"RTN","PXPXRMI2",138,0)
 Q
"RTN","PXPXRMI2",139,0)
 ;
"RTN","PXPXRMI2",140,0)
 ;===============================================================
"RTN","PXPXRMI2",141,0)
VSK ;Build the indexes for V SKIN TEST.
"RTN","PXPXRMI2",142,0)
 N DAS,DATE,DFN,DIFF,DONE,END,ENTRIES,GLOBAL,IND,NE,NERROR
"RTN","PXPXRMI2",143,0)
 N SK,START,TEMP,TENP,TEXT,VISIT
"RTN","PXPXRMI2",144,0)
 ;Don't leave any old stuff around.
"RTN","PXPXRMI2",145,0)
 K ^PXRMINDX(9000010.12)
"RTN","PXPXRMI2",146,0)
 S GLOBAL=$$GET1^DID(9000010.12,"","","GLOBAL NAME")
"RTN","PXPXRMI2",147,0)
 S ENTRIES=$P(^AUPNVSK(0),U,4)
"RTN","PXPXRMI2",148,0)
 S TENP=ENTRIES/10
"RTN","PXPXRMI2",149,0)
 S TENP=+$P(TENP,".",1)
"RTN","PXPXRMI2",150,0)
 I TENP<1 S TENP=1
"RTN","PXPXRMI2",151,0)
 D BMES^XPDUTL("Building indexes for V SKIN TEST")
"RTN","PXPXRMI2",152,0)
 S TEXT="There are "_ENTRIES_" entries to process."
"RTN","PXPXRMI2",153,0)
 D MES^XPDUTL(TEXT)
"RTN","PXPXRMI2",154,0)
 S START=$H
"RTN","PXPXRMI2",155,0)
 S (DAS,DONE,IND,NE,NERROR)=0
"RTN","PXPXRMI2",156,0)
 F  S DAS=$O(^AUPNVSK(DAS)) Q:DONE  D
"RTN","PXPXRMI2",157,0)
 . I +DAS=0 S DONE=1 Q
"RTN","PXPXRMI2",158,0)
 . I +DAS'=DAS D  Q
"RTN","PXPXRMI2",159,0)
 .. S DONE=1
"RTN","PXPXRMI2",160,0)
 .. S ETEXT="Bad ien: "_DAS_", cannot continue."
"RTN","PXPXRMI2",161,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",162,0)
 . S IND=IND+1
"RTN","PXPXRMI2",163,0)
 . I IND#TENP=0 D
"RTN","PXPXRMI2",164,0)
 .. S TEXT="Processing entry "_IND
"RTN","PXPXRMI2",165,0)
 .. D MES^XPDUTL(TEXT)
"RTN","PXPXRMI2",166,0)
 . I IND#10000=0 W "."
"RTN","PXPXRMI2",167,0)
 . S TEMP=^AUPNVSK(DAS,0)
"RTN","PXPXRMI2",168,0)
 . S SK=$P(TEMP,U,1)
"RTN","PXPXRMI2",169,0)
 . I SK="" D  Q
"RTN","PXPXRMI2",170,0)
 .. S ETEXT=DAS_" missing skin test"
"RTN","PXPXRMI2",171,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",172,0)
 . I '$D(^AUTTSK(SK)) D  Q
"RTN","PXPXRMI2",173,0)
 .. S ETEXT=DAS_" invalid skin test"
"RTN","PXPXRMI2",174,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",175,0)
 . S DFN=$P(TEMP,U,2)
"RTN","PXPXRMI2",176,0)
 . I DFN="" D  Q
"RTN","PXPXRMI2",177,0)
 .. S ETEXT=DAS_" missing DFN"
"RTN","PXPXRMI2",178,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",179,0)
 . S VISIT=$P(TEMP,U,3)
"RTN","PXPXRMI2",180,0)
 . I VISIT="" D  Q
"RTN","PXPXRMI2",181,0)
 .. S ETEXT=DAS_" missing visit"
"RTN","PXPXRMI2",182,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",183,0)
 . I '$D(^AUPNVSIT(VISIT)) D  Q
"RTN","PXPXRMI2",184,0)
 .. S ETEXT=DAS_" invalid visit"
"RTN","PXPXRMI2",185,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",186,0)
 . S DATE=$P(^AUPNVSIT(VISIT,0),U,1)
"RTN","PXPXRMI2",187,0)
 . I DATE="" D  Q
"RTN","PXPXRMI2",188,0)
 .. S ETEXT=DAS_" missing visit date"
"RTN","PXPXRMI2",189,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",190,0)
 . S NE=NE+1
"RTN","PXPXRMI2",191,0)
 . S ^PXRMINDX(9000010.12,"IP",SK,DFN,DATE,DAS)=""
"RTN","PXPXRMI2",192,0)
 . S ^PXRMINDX(9000010.12,"PI",DFN,SK,DATE,DAS)=""
"RTN","PXPXRMI2",193,0)
 S END=$H
"RTN","PXPXRMI2",194,0)
 S TEXT=NE_" V SKIN TEST results indexed."
"RTN","PXPXRMI2",195,0)
 D MES^XPDUTL(TEXT)
"RTN","PXPXRMI2",196,0)
 D DETIME^PXRMSXRM(START,END)
"RTN","PXPXRMI2",197,0)
 ;If there were errors send a message.
"RTN","PXPXRMI2",198,0)
 I NERROR>0 D ERRMSG^PXRMSXRM(NERROR,GLOBAL)
"RTN","PXPXRMI2",199,0)
 ;Send a MailMan message with the results.
"RTN","PXPXRMI2",200,0)
 D COMMSG^PXRMSXRM(GLOBAL,START,END,NE,NERROR)
"RTN","PXPXRMI2",201,0)
 S ^PXRMINDX(9000010.12,"GLOBAL NAME")=GLOBAL
"RTN","PXPXRMI2",202,0)
 S ^PXRMINDX(9000010.12,"BUILT BY")=DUZ
"RTN","PXPXRMI2",203,0)
 S ^PXRMINDX(9000010.12,"DATE BUILT")=$$NOW^XLFDT
"RTN","PXPXRMI2",204,0)
 Q
"RTN","PXPXRMI2",205,0)
 ;
"RTN","PXPXRMI2",206,0)
 ;===============================================================
"RTN","PXPXRMI2",207,0)
VXAM ;Build the indexes for V EXAM.
"RTN","PXPXRMI2",208,0)
 N DAS,DATE,DFN,DIFF,DONE,END,ENTRIES,ETEXT,EXAM,GLOBAL,IND,NE,NERROR
"RTN","PXPXRMI2",209,0)
 N START,TEMP,TENP,TEXT,VISIT
"RTN","PXPXRMI2",210,0)
 ;Don't leave any old stuff around.
"RTN","PXPXRMI2",211,0)
 K ^PXRMINDX(9000010.13)
"RTN","PXPXRMI2",212,0)
 S GLOBAL=$$GET1^DID(9000010.13,"","","GLOBAL NAME")
"RTN","PXPXRMI2",213,0)
 S ENTRIES=$P(^AUPNVXAM(0),U,4)
"RTN","PXPXRMI2",214,0)
 S TENP=ENTRIES/10
"RTN","PXPXRMI2",215,0)
 S TENP=+$P(TENP,".",1)
"RTN","PXPXRMI2",216,0)
 I TENP<1 S TENP=1
"RTN","PXPXRMI2",217,0)
 D BMES^XPDUTL("Building indexes for V EXAM")
"RTN","PXPXRMI2",218,0)
 S TEXT="There are "_ENTRIES_" entries to process."
"RTN","PXPXRMI2",219,0)
 D MES^XPDUTL(TEXT)
"RTN","PXPXRMI2",220,0)
 S START=$H
"RTN","PXPXRMI2",221,0)
 S (DAS,DONE,IND,NE,NERROR)=0
"RTN","PXPXRMI2",222,0)
 F  S DAS=$O(^AUPNVXAM(DAS)) Q:DONE  D
"RTN","PXPXRMI2",223,0)
 . I +DAS=0 S DONE=1 Q
"RTN","PXPXRMI2",224,0)
 . I +DAS'=DAS D  Q
"RTN","PXPXRMI2",225,0)
 .. S DONE=1
"RTN","PXPXRMI2",226,0)
 .. S ETEXT="Bad ien: "_DAS_", cannot continue."
"RTN","PXPXRMI2",227,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",228,0)
 . S IND=IND+1
"RTN","PXPXRMI2",229,0)
 . I IND#TENP=0 D
"RTN","PXPXRMI2",230,0)
 .. S TEXT="Processing entry "_IND
"RTN","PXPXRMI2",231,0)
 .. D MES^XPDUTL(TEXT)
"RTN","PXPXRMI2",232,0)
 . I IND#10000=0 W "."
"RTN","PXPXRMI2",233,0)
 . S TEMP=^AUPNVXAM(DAS,0)
"RTN","PXPXRMI2",234,0)
 . S EXAM=$P(TEMP,U,1)
"RTN","PXPXRMI2",235,0)
 . I EXAM="" D  Q
"RTN","PXPXRMI2",236,0)
 .. S ETEXT=DAS_" missing exam"
"RTN","PXPXRMI2",237,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",238,0)
 . I '$D(^AUTTEXAM(EXAM)) D  Q
"RTN","PXPXRMI2",239,0)
 .. S ETEXT=DAS_" invalid exam"
"RTN","PXPXRMI2",240,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",241,0)
 . S DFN=$P(TEMP,U,2)
"RTN","PXPXRMI2",242,0)
 . I DFN="" D  Q
"RTN","PXPXRMI2",243,0)
 .. S ETEXT=DAS_" missing DFN"
"RTN","PXPXRMI2",244,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",245,0)
 . S VISIT=$P(TEMP,U,3)
"RTN","PXPXRMI2",246,0)
 . I VISIT="" D  Q
"RTN","PXPXRMI2",247,0)
 .. S ETEXT=DAS_" missing visit"
"RTN","PXPXRMI2",248,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",249,0)
 . I '$D(^AUPNVSIT(VISIT)) D  Q
"RTN","PXPXRMI2",250,0)
 .. S ETEXT=DAS_" invalid visit"
"RTN","PXPXRMI2",251,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",252,0)
 . S DATE=$P(^AUPNVSIT(VISIT,0),U,1)
"RTN","PXPXRMI2",253,0)
 . I DATE="" D  Q
"RTN","PXPXRMI2",254,0)
 .. S ETEXT=DAS_" missing visit date"
"RTN","PXPXRMI2",255,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","PXPXRMI2",256,0)
 . S NE=NE+1
"RTN","PXPXRMI2",257,0)
 . S ^PXRMINDX(9000010.13,"IP",EXAM,DFN,DATE,DAS)=""
"RTN","PXPXRMI2",258,0)
 . S ^PXRMINDX(9000010.13,"PI",DFN,EXAM,DATE,DAS)=""
"RTN","PXPXRMI2",259,0)
 S END=$H
"RTN","PXPXRMI2",260,0)
 S TEXT=NE_" V EXAM results indexed."
"RTN","PXPXRMI2",261,0)
 D MES^XPDUTL(TEXT)
"RTN","PXPXRMI2",262,0)
 D DETIME^PXRMSXRM(START,END)
"RTN","PXPXRMI2",263,0)
 ;If there were errors send a message.
"RTN","PXPXRMI2",264,0)
 I NERROR>0 D ERRMSG^PXRMSXRM(NERROR,GLOBAL)
"RTN","PXPXRMI2",265,0)
 ;Send a MailMan message with the results.
"RTN","PXPXRMI2",266,0)
 D COMMSG^PXRMSXRM(GLOBAL,START,END,NE,NERROR)
"RTN","PXPXRMI2",267,0)
 S ^PXRMINDX(9000010.13,"GLOBAL NAME")=GLOBAL
"RTN","PXPXRMI2",268,0)
 S ^PXRMINDX(9000010.13,"BUILT BY")=DUZ
"RTN","PXPXRMI2",269,0)
 S ^PXRMINDX(9000010.13,"DATE BUILT")=$$NOW^XLFDT
"RTN","PXPXRMI2",270,0)
 Q
"RTN","PXPXRMI2",271,0)
 ;
"RTN","PXSCH2")
0^9^B7363078^B7477510
"RTN","PXSCH2",1,0)
PXSCH2 ;ISL/JVS,SCK - SCHEDULING REDESIGN PROCEDURES-CPT #2 ;7/25/96  09:12
"RTN","PXSCH2",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**73,194**;Aug 12, 1996;Build 2
"RTN","PXSCH2",3,0)
 ;  Variable List
"RTN","PXSCH2",4,0)
 ;
"RTN","PXSCH2",5,0)
 ; CPTNOD0   The data for the ^TMP("PXK",$J,  globals
"RTN","PXSCH2",6,0)
 ; CPTNOD12  The data for the ^TMP("PXK",$J,  globals
"RTN","PXSCH2",7,0)
 ; CPTNOD8   The data for the ^TMP("PXK",$J,  globals
"RTN","PXSCH2",8,0)
 ; PXSCPT    Pointer to the precedure being processed
"RTN","PXSCH2",9,0)
 ; PXSCPTQ   Quantity of the above procedure
"RTN","PXSCH2",10,0)
 ; PXSDX     The main Diagnosis
"RTN","PXSCH2",11,0)
 ; PXSINDX   Index for the "PXK" global
"RTN","PXSCH2",12,0)
 ; PXSPNN    resolved provider narrative
"RTN","PXSCH2",13,0)
 ; PXSPNN(1)    ""       ""      ""
"RTN","PXSCH2",14,0)
 ; PXSPR     The main Provider
"RTN","PXSCH2",15,0)
 ; XP,XPFG   Scratch Variables
"RTN","PXSCH2",16,0)
 ;
"RTN","PXSCH2",17,0)
SET ;Set the TMP("PXK",$J, GLOBAL
"RTN","PXSCH2",18,0)
CPT ;Create nodes for Procedures
"RTN","PXSCH2",19,0)
 S PXSCPT=0 F  S PXSCPT=$O(PXS("PROC",PXSCPT)) Q:PXSCPT=""  D
"RTN","PXSCH2",20,0)
 .S PXSINDX=PXSINDX+1
"RTN","PXSCH2",21,0)
 .S PXSCPTQ=$G(PXS("PROC",PXSCPT))
"RTN","PXSCH2",22,0)
 .D CPTNOD
"RTN","PXSCH2",23,0)
 Q
"RTN","PXSCH2",24,0)
CPTNOD ;
"RTN","PXSCH2",25,0)
 S CPTNOD0="",$P(CPTNOD0,"^")=$G(PXSCPT)
"RTN","PXSCH2",26,0)
 S $P(CPTNOD0,"^",2)=$G(PXS("PATIENT")) ;PATIENT
"RTN","PXSCH2",27,0)
 S $P(CPTNOD0,"^",3)=$G(PXS("VISIT")) ;VISIT
"RTN","PXSCH2",28,0)
 S PXSFILE=9000010.18
"RTN","PXSCH2",29,0)
 ;K ^UTILITY("DIQ1",$J)
"RTN","PXSCH2",30,0)
 ;S DIC=81,DA=PXSCPT,DR=2 D EN^DIQ1
"RTN","PXSCH2",31,0)
 ;S PXSZPN=$G(^UTILITY("DIQ1",$J,81,DA,2))
"RTN","PXSCH2",32,0)
 ;K ^UTILITY("DIQ1",$J),DIC,DA,DR
"RTN","PXSCH2",33,0)
 S PXSZPN=$P($$CPT^ICPTCOD(PXSCPT),U,3) ; px*2.0*194
"RTN","PXSCH2",34,0)
 S $P(CPTNOD0,"^",4)=+$$PROVNARR^PXAPI(PXSZPN,PXSFILE) ;PROVIDER NARR
"RTN","PXSCH2",35,0)
 Q:$P(CPTNOD0,"^",4)=-1
"RTN","PXSCH2",36,0)
 ;S $P(CPTNOD0,"^",5)=$G(PXSDX) ;DIAGNOSIS
"RTN","PXSCH2",37,0)
 S $P(CPTNOD0,"^",16)=$G(PXSCPTQ) ;QUANTITY
"RTN","PXSCH2",38,0)
 S CPTNOD12=""
"RTN","PXSCH2",39,0)
 ;S $P(CPTNOD12,"^")=$G(PXS("DATE")) ;DATE AND TIME
"RTN","PXSCH2",40,0)
 ;S $P(CPTNOD12,"^",3)=$G(PXS("STOP CODE ORIG")) ;CLINIC STOP
"RTN","PXSCH2",41,0)
 ;S $P(CPTNOD12,"^",4)=$G(PXSPR) ;PROVIDER
"RTN","PXSCH2",42,0)
 ;S $P(CPTNOD12,"^",5)=$G(PXS("CLINIC")) ;HOSPITAL LOCATION
"RTN","PXSCH2",43,0)
 ;S $P(CPTNOD12,"^",7)=$P(CPTNOD0,"^",3) ;SECONDARY VISIT
"RTN","PXSCH2",44,0)
 ;--DECIDED TO REMOVE THE CATEGORY
"RTN","PXSCH2",45,0)
 ;S CPTNOD8=""
"RTN","PXSCH2",46,0)
 ;K ^UTILITY("DIQ1",$J) S DIC=81,DA=PXSCPT,DR=3,DIQ(0)="EIN" D EN^DIQ1
"RTN","PXSCH2",47,0)
 ;I $G(^UTILITY("DIQ1",$J,81,DA,3,"I")) D
"RTN","PXSCH2",48,0)
 ;.S PXSZPN=$G(^UTILITY("DIQ1",$J,81,DA,3,"E"))
"RTN","PXSCH2",49,0)
 ;.S CPTNOD8=+$$PROVNARR^PXAPI(PXSZPN,PXSFILE)
"RTN","PXSCH2",50,0)
 ;.I CPTNOD8'>0 S CPTNOD8=""
"RTN","PXSCH2",51,0)
 ;K ^UTILITY("DIQ1",$J),DIC,DA,DR,DIQ
"RTN","PXSCH2",52,0)
 S ^TMP("PXK",$J,"CPT",PXSINDX+1,0,"AFTER")=$G(CPTNOD0)
"RTN","PXSCH2",53,0)
 S ^TMP("PXK",$J,"CPT",PXSINDX+1,0,"BEFORE")=""
"RTN","PXSCH2",54,0)
 S ^TMP("PXK",$J,"CPT",PXSINDX+1,1,1,"BEFORE")=""
"RTN","PXSCH2",55,0)
 S ^TMP("PXK",$J,"CPT",PXSINDX+1,12,"AFTER")=$G(CPTNOD12)
"RTN","PXSCH2",56,0)
 S ^TMP("PXK",$J,"CPT",PXSINDX+1,12,"BEFORE")=""
"RTN","PXSCH2",57,0)
 S ^TMP("PXK",$J,"CPT",PXSINDX+1,802,"AFTER")=""
"RTN","PXSCH2",58,0)
 S ^TMP("PXK",$J,"CPT",PXSINDX+1,802,"BEFORE")=""
"RTN","PXSCH2",59,0)
 S ^TMP("PXK",$J,"CPT",PXSINDX+1,"IEN")=""
"RTN","PXSCH2",60,0)
 S ^TMP("PXK",$J,"SOR")=8
"RTN","PXSCH2",61,0)
 S ^TMP("PXK",$J,"VST",1,"IEN")=$G(PXS("VISIT"))
"RTN","PXSCH2",62,0)
CPTDUP ;Look for duplicates on the same visit
"RTN","PXSCH2",63,0)
 N XPFG,XP,PXKSEQ,PXKMOD
"RTN","PXSCH2",64,0)
 S (XPFG,XP)=0
"RTN","PXSCH2",65,0)
 F  Q:XPFG  S XP=$O(^AUPNVCPT("AD",PXS("VISIT"),XP)) Q:XP=""  D
"RTN","PXSCH2",66,0)
 .I $P(^AUPNVCPT(XP,0),"^",1)=PXSCPT D
"RTN","PXSCH2",67,0)
 ..S ^TMP("PXK",$J,"CPT",PXSINDX+1,0,"BEFORE")=$G(^AUPNVCPT(XP,0))
"RTN","PXSCH2",68,0)
 ..S PXKSEQ=0
"RTN","PXSCH2",69,0)
 ..F  S PXKSEQ=$O(^AUPNVCPT(XP,1,PXKSEQ)) Q:'PXKSEQ  D
"RTN","PXSCH2",70,0)
 ...S PXKMOD=^AUPNVCPT(XP,1,PXKSEQ,0)
"RTN","PXSCH2",71,0)
 ...S ^TMP("PXK",$J,"CPT",PXSINDX+1,1,PXKSEQ,"BEFORE")=PXKMOD
"RTN","PXSCH2",72,0)
 ..S ^TMP("PXK",$J,"CPT",PXSINDX+1,12,"BEFORE")=$G(^AUPNVCPT(XP,12))
"RTN","PXSCH2",73,0)
 ..S ^TMP("PXK",$J,"CPT",PXSINDX+1,802,"BEFORE")=+$G(^AUPNVCPT(XP,802))
"RTN","PXSCH2",74,0)
 ..S ^TMP("PXK",$J,"CPT",PXSINDX+1,"IEN")=XP
"RTN","PXSCH2",75,0)
 ..S XPFG=1
"RTN","PXSCH2",76,0)
 Q
"RTN","PXSCH4")
0^10^B8097371^B7905307
"RTN","PXSCH4",1,0)
PXSCH4 ;ISL/JVS,SCK - SCHEDULING REDESIGN PROCEDURES-DIAG #4 ;6/11/96
"RTN","PXSCH4",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**194**;Aug 12, 1996;Build 2
"RTN","PXSCH4",3,0)
 ;  Variable List
"RTN","PXSCH4",4,0)
 ;
"RTN","PXSCH4",5,0)
 ; DXN800  "PXK" global data for various nodes
"RTN","PXSCH4",6,0)
 ; DXN802       ""
"RTN","PXSCH4",7,0)
 ; DXNOD0       ""
"RTN","PXSCH4",8,0)
 ; DXNOD12      ""
"RTN","PXSCH4",9,0)
 ; PXSDX     The Main Diagnosis
"RTN","PXSCH4",10,0)
 ; PXSINDX   Index for "PXK" global
"RTN","PXSCH4",11,0)
 ; PXSPR   The main provider
"RTN","PXSCH4",12,0)
 ;
"RTN","PXSCH4",13,0)
DIAG ;Create nodes for diagnosis
"RTN","PXSCH4",14,0)
 Q:'$D(PXS("DIAGNOSIS"))
"RTN","PXSCH4",15,0)
 S PXSDX=0 F  S PXSDX=$O(PXS("DIAGNOSIS",PXSDX)) Q:PXSDX=""  D
"RTN","PXSCH4",16,0)
 .S PXSINDX=PXSINDX+1
"RTN","PXSCH4",17,0)
 .D DXNOD
"RTN","PXSCH4",18,0)
 Q
"RTN","PXSCH4",19,0)
DXNOD ;
"RTN","PXSCH4",20,0)
 S DXNOD0="",$P(DXNOD0,"^")=+$G(PXS("DIAGNOSIS",PXSDX))
"RTN","PXSCH4",21,0)
 S $P(DXNOD0,"^",2)=$G(PXS("PATIENT")) ;PROVIDER
"RTN","PXSCH4",22,0)
 S $P(DXNOD0,"^",3)=$G(PXS("VISIT")) ;VISIT
"RTN","PXSCH4",23,0)
 S PXSFILE=9000010.07
"RTN","PXSCH4",24,0)
 ;K ^UTILITY("DIQ1",$J)
"RTN","PXSCH4",25,0)
 ;S DIC=80,DA=PXSDX,DR=3 D EN^DIQ1
"RTN","PXSCH4",26,0)
 S PXSZPN=$P($$ICDDX^ICDCODE(PXSDX),U,4) ; Modified for 194
"RTN","PXSCH4",27,0)
 ;S PXSZPN=$G(^UTILITY("DIQ1",$J,80,DA,3))
"RTN","PXSCH4",28,0)
 ;K ^UTILITY("DIQ1",$J),DIC,DA,DR
"RTN","PXSCH4",29,0)
 S $P(DXNOD0,"^",4)=+$$PROVNARR^PXAPI(PXSZPN,PXSFILE)
"RTN","PXSCH4",30,0)
 Q:$P(DXNOD0,"^",4)=-1
"RTN","PXSCH4",31,0)
 S DXNOD12=""
"RTN","PXSCH4",32,0)
 ;S $P(DXNOD12,"^")=$G(PXS("DATE")) ;DATE AND TIME
"RTN","PXSCH4",33,0)
 ;S $P(DXNOD12,"^",3)=$G(PXS("STOP CODE ORIG")) ;CLINIC STOP
"RTN","PXSCH4",34,0)
 ;S $P(DXNOD12,"^",4)=$G(PXSPR) ;PROVIDER
"RTN","PXSCH4",35,0)
 ;S $P(DXNOD12,"^",5)=$G(PXS("CLINIC")) ;HOSPITAL LOCATION
"RTN","PXSCH4",36,0)
 ;S $P(DXNOD12,"^",7)=$P(DXNOD0,"^",3) ;SECONDARY VISIT
"RTN","PXSCH4",37,0)
 S DXN800=""
"RTN","PXSCH4",38,0)
 I $D(PXS("CLASSIFICATION",1)) S $P(DXN800,"^",2)=1
"RTN","PXSCH4",39,0)
 I $D(PXS("CLASSIFICATION",2)) S $P(DXN800,"^",3)=1
"RTN","PXSCH4",40,0)
 I $D(PXS("CLASSIFICATION",3)) S $P(DXN800,"^",1)=1
"RTN","PXSCH4",41,0)
 I $D(PXS("CLASSIFICATION",4)) S $P(DXN800,"^",4)=1
"RTN","PXSCH4",42,0)
 ;K ^UTILITY("DIQ1",$J)
"RTN","PXSCH4",43,0)
 ;S DIC=80,DA=PXSDX,DR=5,DIQ(0)="E" D EN^DIQ1
"RTN","PXSCH4",44,0)
 N PXS1
"RTN","PXSCH4",45,0)
 S PXS1=$P($$ICDDX^ICDCODE(PXSDX),U,6) ; Modified for 194
"RTN","PXSCH4",46,0)
 S PXSZPN=$$GET1^DIQ(80.3,PXS1,.01)
"RTN","PXSCH4",47,0)
 ;S PXSZPN=$G(^UTILITY("DIQ1",$J,80,DA,5,"E"))
"RTN","PXSCH4",48,0)
 ;--DECIDED TO REMOVE CATEGORY
"RTN","PXSCH4",49,0)
 ;K ^UTILITY("DIQ1",$J)
"RTN","PXSCH4",50,0)
 ;S $P(DXN802,"^",1)=+$$PROVNARR^PXAPI(PXSZPN,PXSFILE)
"RTN","PXSCH4",51,0)
 ;I $P(DXN802,"^",1)'>0 S $P(DXN802,"^",1)=""
"RTN","PXSCH4",52,0)
 S ^TMP("PXK",$J,"POV",PXSINDX+1,0,"AFTER")=$G(DXNOD0)
"RTN","PXSCH4",53,0)
 S ^TMP("PXK",$J,"POV",PXSINDX+1,0,"BEFORE")=""
"RTN","PXSCH4",54,0)
 S ^TMP("PXK",$J,"POV",PXSINDX+1,12,"AFTER")=$G(DXNOD12)
"RTN","PXSCH4",55,0)
 S ^TMP("PXK",$J,"POV",PXSINDX+1,12,"BEFORE")=""
"RTN","PXSCH4",56,0)
 S ^TMP("PXK",$J,"POV",PXSINDX+1,800,"AFTER")=$G(DXN800)
"RTN","PXSCH4",57,0)
 S ^TMP("PXK",$J,"POV",PXSINDX+1,800,"BEFORE")=""
"RTN","PXSCH4",58,0)
 S ^TMP("PXK",$J,"POV",PXSINDX+1,802,"AFTER")=""
"RTN","PXSCH4",59,0)
 S ^TMP("PXK",$J,"POV",PXSINDX+1,802,"BEFORE")=""
"RTN","PXSCH4",60,0)
 S ^TMP("PXK",$J,"POV",PXSINDX+1,"IEN")=""
"RTN","PXSCH4",61,0)
 S ^TMP("PXK",$J,"SOR")=8
"RTN","PXSCH4",62,0)
 S ^TMP("PXK",$J,"VST",1,"IEN")=$G(PXS("VISIT"))
"RTN","PXSCH4",63,0)
DXDUP ;Look for duplicates on the same visit
"RTN","PXSCH4",64,0)
 N XPFG,XP
"RTN","PXSCH4",65,0)
 S (XPFG,XP)=0 F  Q:XPFG  S XP=$O(^AUPNVPOV("AD",PXS("VISIT"),XP)) Q:XP=""  D
"RTN","PXSCH4",66,0)
 .I $P(^AUPNVPOV(XP,0),"^",1)=+$G(PXS("DIAGNOSIS",PXSDX)) D
"RTN","PXSCH4",67,0)
 ..S ^TMP("PXK",$J,"POV",PXSINDX+1,0,"BEFORE")=$G(^AUPNVPOV(XP,0))
"RTN","PXSCH4",68,0)
 ..S ^TMP("PXK",$J,"POV",PXSINDX+1,12,"BEFORE")=$G(^AUPNVPOV(XP,12))
"RTN","PXSCH4",69,0)
 ..S ^TMP("PXK",$J,"POV",PXSINDX+1,800,"BEFORE")=$G(^AUPNVPOV(XP,800))
"RTN","PXSCH4",70,0)
 ..S ^TMP("PXK",$J,"POV",PXSINDX+1,802,"BEFORE")=+$G(^AUPNVPOV(XP,802))
"RTN","PXSCH4",71,0)
 ..S ^TMP("PXK",$J,"POV",PXSINDX+1,"IEN")=XP
"RTN","PXSCH4",72,0)
 ..S XPFG=1
"RTN","PXSCH4",73,0)
 Q
"VER")
8.0^22.0
"BLD",7482,6)
^150
**END**
**END**
