Released PSJ*5*191 SEQ #178
Extracted from mail message
**KIDS**:PSJ*5.0*191^

**INSTALL NAME**
PSJ*5.0*191
"BLD",6390,0)
PSJ*5.0*191^INPATIENT MEDICATIONS^0^3070920^y
"BLD",6390,1,0)
^^3^3^3070920^^^
"BLD",6390,1,1,0)
 
"BLD",6390,1,2,0)
This patch will correct 2 problems and remove 1 obsolete menu option 
"BLD",6390,1,3,0)
within the Inpatient Medications package.
"BLD",6390,4,0)
^9.64PA^^
"BLD",6390,6)
2^
"BLD",6390,6.3)
9
"BLD",6390,"ABPKG")
n
"BLD",6390,"INID")
n^n^n
"BLD",6390,"KRN",0)
^9.67PA^8989.52^19
"BLD",6390,"KRN",.4,0)
.4
"BLD",6390,"KRN",.4,"NM",0)
^9.68A^^
"BLD",6390,"KRN",.401,0)
.401
"BLD",6390,"KRN",.401,"NM",0)
^9.68A^^
"BLD",6390,"KRN",.402,0)
.402
"BLD",6390,"KRN",.402,"NM",0)
^9.68A^^
"BLD",6390,"KRN",.403,0)
.403
"BLD",6390,"KRN",.403,"NM",0)
^9.68A^^
"BLD",6390,"KRN",.5,0)
.5
"BLD",6390,"KRN",.84,0)
.84
"BLD",6390,"KRN",3.6,0)
3.6
"BLD",6390,"KRN",3.8,0)
3.8
"BLD",6390,"KRN",9.2,0)
9.2
"BLD",6390,"KRN",9.8,0)
9.8
"BLD",6390,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6390,"KRN",9.8,"NM",1,0)
PSGPLR^^0^B39066813
"BLD",6390,"KRN",9.8,"NM",2,0)
PSJMPEND^^0^B11638774
"BLD",6390,"KRN",9.8,"NM","B","PSGPLR",1)

"BLD",6390,"KRN",9.8,"NM","B","PSJMPEND",2)

"BLD",6390,"KRN",19,0)
19
"BLD",6390,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",6390,"KRN",19,"NM",1,0)
PSJI COMPLETE^^1^
"BLD",6390,"KRN",19,"NM","B","PSJI COMPLETE",1)

"BLD",6390,"KRN",19.1,0)
19.1
"BLD",6390,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",6390,"KRN",101,0)
101
"BLD",6390,"KRN",101,"NM",0)
^9.68A^^
"BLD",6390,"KRN",409.61,0)
409.61
"BLD",6390,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",6390,"KRN",771,0)
771
"BLD",6390,"KRN",771,"NM",0)
^9.68A^^
"BLD",6390,"KRN",870,0)
870
"BLD",6390,"KRN",870,"NM",0)
^9.68A^^
"BLD",6390,"KRN",8989.51,0)
8989.51
"BLD",6390,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",6390,"KRN",8989.52,0)
8989.52
"BLD",6390,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",6390,"KRN",8994,0)
8994
"BLD",6390,"KRN",8994,"NM",0)
^9.68A^^
"BLD",6390,"KRN","B",.4,.4)

"BLD",6390,"KRN","B",.401,.401)

"BLD",6390,"KRN","B",.402,.402)

"BLD",6390,"KRN","B",.403,.403)

"BLD",6390,"KRN","B",.5,.5)

"BLD",6390,"KRN","B",.84,.84)

"BLD",6390,"KRN","B",3.6,3.6)

"BLD",6390,"KRN","B",3.8,3.8)

"BLD",6390,"KRN","B",9.2,9.2)

"BLD",6390,"KRN","B",9.8,9.8)

"BLD",6390,"KRN","B",19,19)

"BLD",6390,"KRN","B",19.1,19.1)

"BLD",6390,"KRN","B",101,101)

"BLD",6390,"KRN","B",409.61,409.61)

"BLD",6390,"KRN","B",771,771)

"BLD",6390,"KRN","B",870,870)

"BLD",6390,"KRN","B",8989.51,8989.51)

"BLD",6390,"KRN","B",8989.52,8989.52)

"BLD",6390,"KRN","B",8994,8994)

"BLD",6390,"QUES",0)
^9.62^^
"BLD",6390,"REQB",0)
^9.611^1^1
"BLD",6390,"REQB",1,0)
PSJ*5.0*129^1
"BLD",6390,"REQB","B","PSJ*5.0*129",1)

"KRN",19,13229,-1)
1^1
"KRN",19,13229,0)
PSJI COMPLETE
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
191^3070920^10000000074
"PKG",197,22,1,"PAH",1,1,0)
^^3^3^3070920
"PKG",197,22,1,"PAH",1,1,1,0)
 
"PKG",197,22,1,"PAH",1,1,2,0)
This patch will correct 2 problems and remove 1 obsolete menu option 
"PKG",197,22,1,"PAH",1,1,3,0)
within the Inpatient Medications package.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSGPLR")
0^1^B39066813^B38211452
"RTN","PSGPLR",1,0)
PSGPLR ;BIR/CML3-PRINTS PICK LIST REPORT ; 6/15/07 1:12pm
"RTN","PSGPLR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**10,50,67,119,129,191**;16 DEC 97;Build 9
"RTN","PSGPLR",3,0)
 ;
"RTN","PSGPLR",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGPLR",5,0)
 ; Reference to ^PS(59.7 is supported by DBIA# 2181.
"RTN","PSGPLR",6,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192.
"RTN","PSGPLR",7,0)
 ; Reference to ^%DTC is supported by DBIA# 10000.
"RTN","PSGPLR",8,0)
 ; Reference to ^VADPT is supported by DBIA# 10061.
"RTN","PSGPLR",9,0)
 ;
"RTN","PSGPLR",10,0)
 N PSGY,OLDWARD,STPDT D NOW^%DTC S PSGDT=+$E(%,1,12),PPLD=$$ENDTC^PSGMI(PSGDT),$P(OLINE,"-",75)="",PSGPLXR=$S($G(PSGPLUPF)=1:"AU",1:"AC")
"RTN","PSGPLR",11,0)
 S PGN=0,(FACL,LINE)="",$P(LINE,"-",81)="",$P(FACL,"_",31)="",TND=$G(^PS(53.5,PSGPLG,0)),PSD=$P(TND,"^",3),PFD=$P(TND,"^",4),WSF=$P(TND,"^",7),WGPN=$S('$D(^PS(57.5,PSGPLWG,0)):"N/F",$P(^(0),"^")]"":$P(^(0),"^"),1:"N/F")
"RTN","PSGPLR",12,0)
 S FFF=$S($P(PSGPLWGP,"^",4):2,$P(PSGPLWGP,"^",5):1,1:0),CML=IO'=IO(0)!($E(IOST,1,2)'="C-")
"RTN","PSGPLR",13,0)
 F X="PSD","PFD" S @X=$$ENDTC^PSGMI(@X)
"RTN","PSGPLR",14,0)
 U IO
"RTN","PSGPLR",15,0)
 I '$D(^PS(53.5,$S($D(PSGPLUPF):"AU",1:"AC"),PSGPLG)) S NPLF=0 D HEADER W !!?25,"*** No orders to fill ***" W:(IO'=IO(0)!(IOST'["C-"))&($Y) @IOF G DONE
"RTN","PSGPLR",16,0)
 ;
"RTN","PSGPLR",17,0)
BEGIN ;
"RTN","PSGPLR",18,0)
 I '$$LOCK^PSGPLUTL(PSGPLG,"PSGPLR") H 60 G BEGIN
"RTN","PSGPLR",19,0)
 S NPLF=1,TM=0 F  S TM=$O(^PS(53.5,PSGPLXR,PSGPLG,TM)) Q:TM=""!(TM["~")  S (DDRG,PDRG,PN,PST,RM,WDN)="" D HEADER:'FFF,^PSGPLR0 I CML,'FFF D PAGECK W !!?25,"FILLED BY: ",FACL,!!?25,"CHECKED BY: ",FACL
"RTN","PSGPLR",20,0)
 I CML,FFF D PAGECK W !!?25,"FILLED BY: ",FACL,!!?25,"CHECKED BY: ",FACL W:$Y @IOF
"RTN","PSGPLR",21,0)
 ;
"RTN","PSGPLR",22,0)
DONE ;
"RTN","PSGPLR",23,0)
 D UNLOCK^PSGPLUTL(PSGPLG,"PSGPLR")
"RTN","PSGPLR",24,0)
 K AT,ATC,CML,DDRG,DIS,DND,DO,DR,DRN,DRG,FACL,FD,FFF,FQC,LINE,ND,ND0,ND1,ND2,ND6,NEED,NPLF,OLINE,PSGPLDC,PSGPLXR,PSGPLXRX
"RTN","PSGPLR",25,0)
 K PSJJORD,PSJORDN,PFD,PGN,PN,POP,PPLD,PPN,PRM,PSD,PSGID,PSGOD,PSGP,PST,PW,RM,RTE,SCH,SD,SM,PSSN,TD,TM,TND,WDN,WL,WG,WSF,WGPN,X
"RTN","PSGPLR",26,0)
 Q
"RTN","PSGPLR",27,0)
 ;
"RTN","PSGPLR",28,0)
DD ;
"RTN","PSGPLR",29,0)
 N PSJRNW,CNT
"RTN","PSGPLR",30,0)
 I $D(PSGPLREN("B",$G(PSGP),$G(PSJJORD))),$G(PSGPLUP) D
"RTN","PSGPLR",31,0)
 .N OSTOP,DRGND S (DDRG,OLDWARD)="" S DRGND=$O(PSGPLREN("B",PSGP,PSJJORD,0)) Q:'DRGND  S OSTOP=PSGPLREN("B",PSGP,PSJJORD,DRGND) Q:'OSTOP
"RTN","PSGPLR",32,0)
 .N ST,TMPDRG S CNT=0,ST=$P(ND0,"^",7) S TMPDRG=0 S TMPDRG=$O(PSGPLREN("B",PSGP,PSJJORD,TMPDRG)) S TMPDRG=$P(DRG,"^")_"^"_TMPDRG
"RTN","PSGPLR",33,0)
 .F PSGPLXRX="AU","AC" Q:CNT  F I=0:1 S DDRG=$O(PSGPLREN(53.5,PSGPLXRX,PSGPLG,TM,WDN,RM,PN,PST,TMPDRG,DDRG)) Q:(DDRG="")!(DDRG="NO DISPENSE DRUG")  D
"RTN","PSGPLR",34,0)
 ..S X=$G(PSGPLREN(53.5,PSGPLG,1,PSGP,1,+DRGND,1,$P(DDRG,"^",2),0)) S DR=+X,DND=$P(X,U,2,4) Q:'X
"RTN","PSGPLR",35,0)
 ..S DRN=$G(^PS(55,PSGP,5,PSJJORD,1,DR,0)),DR=$$ENDDN^PSGMI($P(DRN,"^")) I DND?7N1"DI" S DND=$E($$ENDTC^PSGMI(+DND),1,8)
"RTN","PSGPLR",36,0)
 ..S DIS=$P(DND,"^",2),NEED=$S($P(DND,"^")]"":$P(DND,"^"),1:0)
"RTN","PSGPLR",37,0)
 ..;GMZ;PSJ*5*191;Allow for Multiple Dispensed Drug units needed
"RTN","PSGPLR",38,0)
 ..S PSJRNW(I)=1_"^"_+NEED
"RTN","PSGPLR",39,0)
 ..Q
"RTN","PSGPLR",40,0)
 .K PSGPLREN("B",PSGP,PSJJORD),PSGPLREN(53.5,PSGPLG,1,PSGP,1,+DRGND) W !!
"RTN","PSGPLR",41,0)
 ;
"RTN","PSGPLR",42,0)
 S CNT=0
"RTN","PSGPLR",43,0)
 S (DDRG,OLDWARD)="" N ST S ST=$P(ND0,"^",7) F  S DDRG=$O(^PS(53.5,PSGPLXR,PSGPLG,TM,WDN,RM,PN,PST,DRG,DDRG)) Q:(DDRG="")!(DDRG="NO DISPENSE DRUG")  S X=$G(^PS(53.5,PSGPLG,1,+$P(PN,U,2),1,+$P(DRG,U,2),1,+$P(DDRG,U,2),0)),DR=+X,DND=$P(X,U,2,4) D
"RTN","PSGPLR",44,0)
 .S DRN=$G(^PS(55,PSGP,5,PSJJORD,1,DR,0)),DR=$$ENDDN^PSGMI($P(DRN,"^")) I DND?7N1"DI" S DND=$E($$ENDTC^PSGMI(+DND),1,8) W !?6,DR,?48,ST,?51,"(DI "_DND_")",?66,"Returns: ____" Q
"RTN","PSGPLR",45,0)
 .S UD=$P(DRN,"^",2),ATC=$P($G(^PSDRUG(+DRN,8.5)),"^",2)]"" S:ATC ATC=$D(^(212,"AC",PSGPLWG))
"RTN","PSGPLR",46,0)
 .S DIS=$P(DND,"^",2),NEED=$S($P(DND,"^")]"":$P(DND,"^"),1:0) I ATC S ATCFF=+$P($G(^PS(59.7,1,26)),"^",7),ATC=$S(ATCFF:NEED,UD#1:0,DIS]"":+DIS,1:NEED) I ATC,$S(ATC<1:1,ATC'?1.3N:1,1:ATC#1) S ATC=0
"RTN","PSGPLR",47,0)
 .I ATC S X=0,X=$O(^PS(59.7,X)) I $P($G(^(X,26)),U,2)=1,PST="OC" S ATC=0
"RTN","PSGPLR",48,0)
 .S UD=$S('UD:1,UD=.5:"1/2",UD=.25:"1/4",UD<1:"0"_UD,1:UD)
"RTN","PSGPLR",49,0)
 .I $D(PSJRNW) D
"RTN","PSGPLR",50,0)
 ..I 'CNT W !?35,"**** RENEWAL ****"
"RTN","PSGPLR",51,0)
 ..S NEED=NEED-$P(PSJRNW(CNT),"^",2) S:NEED<0 NEED=0 S CNT=CNT+1
"RTN","PSGPLR",52,0)
 .W !?6,DR,?48,ST W:(ATC)&(NEED>0) ?57,"ATC" W ?61,$J(UD,4),?68,$J(NEED,4),?75,$S(DIS]"":$J(DIS,4),1:"____")
"RTN","PSGPLR",53,0)
 .S:ST="DISCONTINUED" OLDWARD=1 S ST=""
"RTN","PSGPLR",54,0)
 I DDRG="NO DISPENSE DRUG" W !?6,PDRG,?48,ST,?57,"OI" S:ST="DISCONTINUED" OLDWARD=1 S ST=""
"RTN","PSGPLR",55,0)
 N GIVSTR S GIVSTR=$S(DO]"":DO_" ",1:"")_RTE_" "_SCH D
"RTN","PSGPLR",56,0)
 .N MARX,I,Y,X D TXT^PSGMUTL(GIVSTR,60)
"RTN","PSGPLR",57,0)
 .F I=1:1:MARX W:I=1 !?10,"Give: ",MARX(1) W:I>1 !?16,MARX(I)
"RTN","PSGPLR",58,0)
 D:OLDWARD WARDCHK W:AT]"" !,?65-$L(AT),AT W !?7,"Start: ",SD,?37,"Stop: ",FD
"RTN","PSGPLR",59,0)
 I Y]"" W !?10 F Q=1:1:$L(Y," ") S X=$P(Y," ",Q) W:$X+$L(X)>65 !?10 W X_" "
"RTN","PSGPLR",60,0)
 K ST
"RTN","PSGPLR",61,0)
 Q
"RTN","PSGPLR",62,0)
 ;
"RTN","PSGPLR",63,0)
EXDD ;
"RTN","PSGPLR",64,0)
 W ! S (DDRG,OLDWARD)="" F  S DDRG=$O(^PS(53.5,PSGPLXR,PSGPLG,TM,WDN,RM,PN,PST,DRG,DDRG)) Q:(DDRG="")!(DDRG="NO DISPENSE DRUG")  S DND=^(DDRG) D
"RTN","PSGPLR",65,0)
 .S DR=$P(DDRG,"^",2),DRN=$G(^PS(55,PSGP,5,PSJJORD,1,DR,0)),ID=$P(DRN,"^",3),DR=$$ENDDN^PSGMI($P(DRN,"^")) W !?6,DR,?48,DIS,?66,"Returns: ____" S:DIS="DISCONTINUED" OLDWARD=1 S DIS=""
"RTN","PSGPLR",66,0)
 I DDRG="NO DISPENSE DRUG" S ND1=$G(^PS(55,PSGP,5,PSJJORD,.2)),PDRG=$$ENPDN^PSGMI($P(ND1,"^")) W !?6,PDRG,?48,DIS,?66,"Returns: ____" S:DIS="DISCONTINUED" OLDWARD=1 S DIS=""
"RTN","PSGPLR",67,0)
 W !?10,"Give: ",$S(DO]"":DO_" ",1:""),RTE," ",SCH D:OLDWARD WARDCHK W !?7,"Start: ",SD,?37,"Stop: ",FD
"RTN","PSGPLR",68,0)
 Q
"RTN","PSGPLR",69,0)
 ;
"RTN","PSGPLR",70,0)
FCL ;
"RTN","PSGPLR",71,0)
 I PGN,CML,$P(PSGPLWGP,"^",6) W !!?25,"FILLED BY: ",FACL,!!?25,"CHECKED BY: "_FACL
"RTN","PSGPLR",72,0)
 ;
"RTN","PSGPLR",73,0)
HEADER ;
"RTN","PSGPLR",74,0)
 S PGN=PGN+1 W:$Y @IOF
"RTN","PSGPLR",75,0)
 W ?1,"(",PSGPLG,")",?$S($D(PSGPLUPF):27,1:32),"PICK LIST REPORT" W:$D(PSGPLUPF) " (UPDATE)" W ?64,PPLD,!,"Ward group: ",WGPN,?73-$L(PGN),"Page: ",PGN,!?18,"For ",PSD," through ",PFD W:NPLF !,"Team: ",$S(TM'["zz":TM,1:"** N/F **")
"RTN","PSGPLR",76,0)
 W !!,$S($P(TND,"^",6)&'$P(TND,"^",8):"Bed-Room",1:"Room-Bed"),?15,"Patient",?67,"Units",?74,"Units",!?9,"Medication",?48,"ST",?62,"U/D",?66,"Needed",?74,"Disp'd",!,LINE Q
"RTN","PSGPLR",77,0)
 ;
"RTN","PSGPLR",78,0)
PAGECK ;
"RTN","PSGPLR",79,0)
 S PSGPY=$Y,PSGPY=$Y+4 I PSGPY+4>IOSL W @IOF
"RTN","PSGPLR",80,0)
 Q
"RTN","PSGPLR",81,0)
 ;
"RTN","PSGPLR",82,0)
WARDCHK ;  if patient has discontinued orders from a different ward, print the ward and room/bed that the orders were discontinued from.
"RTN","PSGPLR",83,0)
 Q:'$G(STPDT)
"RTN","PSGPLR",84,0)
 S VAINDT=$$MINUTES(STPDT,5)
"RTN","PSGPLR",85,0)
 S DFN=PSGP D INP^VADPT I PW'=$P(VAIN(4),"^",2) W ?48,$E("(from "_$P(VAIN(4),"^",2)_" "_VAIN(5)_")",1,31)
"RTN","PSGPLR",86,0)
 S OLDWARD="" Q
"RTN","PSGPLR",87,0)
 ;
"RTN","PSGPLR",88,0)
MINUTES(STPDT,LESS)     ; pass in a FM date/time and the number of minutes (9 or less) to subtract from it
"RTN","PSGPLR",89,0)
 S VAINDT=$S($E(STPDT,9,12)<LESS:($E(STPDT,1,7)-1)_"."_(($E(STPDT,9,12)+2360)-LESS),$E(STPDT,11,12)<5:$E(STPDT,1,8)_$S($E(STPDT,9,10)="10":"09",$E(STPDT,9,10)="20":"19",1:$E(STPDT,9)_($E(STPDT,10)-1))_(60+$E(STPDT,12)-LESS),1:STPDT-(LESS*.0001))
"RTN","PSGPLR",90,0)
 Q VAINDT
"RTN","PSJMPEND")
0^2^B11638774^B11324180
"RTN","PSJMPEND",1,0)
PSJMPEND ;BIR/CML3-MD MARS - GATHER ACK ORDERS INFO (MDWS) ; 6/18/07 12:11pm
"RTN","PSJMPEND",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**191**;16 DEC 97;Build 9
"RTN","PSJMPEND",3,0)
 ;
"RTN","PSJMPEND",4,0)
PEND ;*** Only select orders that were acknowledged by nurses and are
"RTN","PSJMPEND",5,0)
 ;*** still having pending status.
"RTN","PSJMPEND",6,0)
 NEW X S X=$O(^PS(59.6,"B",+PSJPWD,0)) Q:'+$P($G(^PS(59.6,+X,0)),U,6)
"RTN","PSJMPEND",7,0)
 NEW ND,ON,TYPE,QST
"RTN","PSJMPEND",8,0)
 F ON=0:0 S ON=$O(^PS(53.1,"AV",PSGP,ON)) Q:'ON  D
"RTN","PSJMPEND",9,0)
 . S ND=$G(^PS(53.1,ON,0)),TYPE=$P(ND,U,4)
"RTN","PSJMPEND",10,0)
 . S ND2=$G(^PS(53.1,ON,2)),PSGLSD=$P(ND2,U,2),PSGLFD=$P(ND2,U,4)
"RTN","PSJMPEND",11,0)
 . I $P(ND,U,7)="P"!($P($G(^PS(53.1,ON,2)),U)["PRN") S QST="PZ"_$S($P(ND,U,4)="F":"V",1:"A")
"RTN","PSJMPEND",12,0)
 . E  S QST="CZ"_$S($P(ND,U,4)="F":"V",1:"A")
"RTN","PSJMPEND",13,0)
 . I PSGMTYPE[1 D:TYPE'="F" SETTMP D:TYPE="F" IV
"RTN","PSJMPEND",14,0)
 . I PSGMTYPE'[1 D
"RTN","PSJMPEND",15,0)
 .. I PSGMTYPE[2,(TYPE="U") D SETTMP Q
"RTN","PSJMPEND",16,0)
 .. I PSGMTYPE'[2,(TYPE="I") D SETTMP Q
"RTN","PSJMPEND",17,0)
 .. I PSGMTYPE[4,(TYPE="F") D IV
"RTN","PSJMPEND",18,0)
 Q
"RTN","PSJMPEND",19,0)
 ;
"RTN","PSJMPEND",20,0)
SETTMP ;*** Setup ^tmp for pending U/D and Inpatient med IVs.
"RTN","PSJMPEND",21,0)
 ;*** PZ_(V/A) = PRN/One time orders (V=IV).
"RTN","PSJMPEND",22,0)
 ;*** CZ_(V/A) = Continuous orders (A=U/D).
"RTN","PSJMPEND",23,0)
 I 'PSJMPRN,(QST["PZ") Q
"RTN","PSJMPEND",24,0)
 NEW MARX
"RTN","PSJMPEND",25,0)
 D DRGDISP^PSJLMUT1(PSGP,+ON_"P",20,0,.MARX,1) S DRG=MARX(1)_U_ON
"RTN","PSJMPEND",26,0)
 ;*** Set up ^TMP for sort by patients
"RTN","PSJMPEND",27,0)
 S PSJDOS=$P(^PS(53.1,ON,.2),U,2),PSJMR=$E($S($P(ND,U,3)]"":$P(ND,U,3),1:$P(ND,U)),1,5),PSJSCHE=$P($G(^PS(53.1,ON,2)),U)
"RTN","PSJMPEND",28,0)
 S PSJHOLD=$S($P(ND,U,9)["H":1,1:0),PSGLOD=$P(ND,U,14),PSJATME=9999,PSJADT=$S(QST["C":"8999999",1:"9999999")
"RTN","PSJMPEND",29,0)
 D SI
"RTN","PSJMPEND",30,0)
 I PSGSS="P" D  Q
"RTN","PSJMPEND",31,0)
 . S ^TMP($J,PSJADT,PPN_U_PSGP,PSJATME,QST,DRG)=PSGP_U_ON_U_PSJPPID_U_PSJPWDN_U_PSJPRB
"RTN","PSJMPEND",32,0)
 . S ^TMP($J,QST,PSGP,ON)=PSJDOS_U_PSJMR_U_PSJSCHE_U_PSJHOLD_U_PSGLOD
"RTN","PSJMPEND",33,0)
 . S ^TMP($J,QST,PSGP,ON,1)=PSJSI
"RTN","PSJMPEND",34,0)
 ;*** Set up ^TMP when listing by ward
"RTN","PSJMPEND",35,0)
 S:PSGRBADM="A" ^TMP($J,PSJADT,TM,PSJATME,PSJPRB,PPN,QST,DRG)=PSGP_U_ON_U_PSJPPID_U_PSGWN_U_PSJPRB
"RTN","PSJMPEND",36,0)
 S:PSGRBADM="R" ^TMP($J,PSJADT,TM,PSJPRB,PPN,PSJATME,QST,DRG)=PSGP_U_ON_U_PSJPPID_U_PSGWN_U_PSJPRB
"RTN","PSJMPEND",37,0)
 S:PSGRBADM="P" ^TMP($J,PSJADT,TM,PPN_U_PSGP,PSJATME,QST,DRG)=PSGP_U_ON_U_PSJPPID_U_PSGWN_U_PSJPRB
"RTN","PSJMPEND",38,0)
 S ^TMP($J,QST,PSGP,ON)=PSJDOS_U_PSJMR_U_PSJSCHE_U_PSJHOLD_U_PSGLOD_U_PSGLSD_U_PSGLFD
"RTN","PSJMPEND",39,0)
 S ^TMP($J,QST,PSGP,ON,1)=PSJSI
"RTN","PSJMPEND",40,0)
 Q
"RTN","PSJMPEND",41,0)
SI ;*** Find the Special instructions.
"RTN","PSJMPEND",42,0)
 S X=0,PSJSI="" F  S X=$O(^PS(53.1,ON,12,X)) Q:'X  S Z=$G(^(X,0)),Y=$L(PSJSI) S:Y+$L(Z)'>179 PSJSI=PSJSI_Z_" " I Y+$L(Z)>179 S PSJSI="SEE PROVIDER COMMENTS" Q
"RTN","PSJMPEND",43,0)
 Q
"RTN","PSJMPEND",44,0)
 ;
"RTN","PSJMPEND",45,0)
IV ;*** Sort IV pending orders for 24 Hrs, 7/14 Day MAR.
"RTN","PSJMPEND",46,0)
 K DRG,P NEW X,ON55,P,PSJLABEL
"RTN","PSJMPEND",47,0)
 S DFN=PSGP,PSJLABEL=1 D GT531^PSIVORFA(DFN,ON)
"RTN","PSJMPEND",48,0)
 S X=$P(P("MR"),U,2)
"RTN","PSJMPEND",49,0)
 S QST=QST_4
"RTN","PSJMPEND",50,0)
 S PSJADT=$S(QST["C":"8999999",1:"9999999")
"RTN","PSJMPEND",51,0)
 I DRG S X=$S($G(DRG("AD",1)):DRG("AD",1),1:$G(DRG("SOL",1))),X=$E($P(X,U,2),1,20)_U_ON D
"RTN","PSJMPEND",52,0)
 . I PSGSS="P" S ^TMP($J,PSJADT,PPN_U_PSGP,"9999",QST,X)=PSGP_U_ON_U_PSJPPID_U_PSJPWDN_U_PSJPRB Q
"RTN","PSJMPEND",53,0)
 . S:PSGRBADM="A" ^TMP($J,PSJADT,TM,"9999",PSJPRB,PPN,QST,DRG)=PSGP_U_ON_U_PSJPPID_U_PSGWN_U_PSJPRB
"RTN","PSJMPEND",54,0)
 . S:PSGRBADM="R" ^TMP($J,PSJADT,TM,PSJPRB,PPN,"9999",QST,DRG)=PSGP_U_ON_U_PSJPPID_U_PSGWN_U_PSJPRB
"RTN","PSJMPEND",55,0)
 . S:PSGRBADM="P" ^TMP($J,PSJADT,TM,PPN_U_PSGP,"9999",QST,DRG)=PSGP_U_ON_U_PSJPPID_U_PSGWN_U_PSJPRB
"RTN","PSJMPEND",56,0)
 Q
"VER")
8.0^22.0
"BLD",6390,6)
^178
**END**
**END**
