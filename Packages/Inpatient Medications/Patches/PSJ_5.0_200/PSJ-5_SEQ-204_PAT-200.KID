Released PSJ*5*200 SEQ #204
Extracted from mail message
**KIDS**:PSJ*5.0*200^

**INSTALL NAME**
PSJ*5.0*200
"BLD",7907,0)
PSJ*5.0*200^INPATIENT MEDICATIONS^0^3100304^y
"BLD",7907,1,0)
^^7^7^3100304^
"BLD",7907,1,1,0)
This patch will fix the following issues:
"BLD",7907,1,2,0)
1.  Return and Destroy (IV) (PSJI RETURN BY BARCODE ID) does not update
"BLD",7907,1,3,0)
    cumulative doses after destroying a label.
"BLD",7907,1,4,0)
 
"BLD",7907,1,5,0)
 
"BLD",7907,1,6,0)
2. Complex order was not verified by a pharmacist and appeared on the 
"BLD",7907,1,7,0)
   picklist with the unit needed displayed on the picklist.
"BLD",7907,4,0)
^9.64PA^^
"BLD",7907,6)
8^
"BLD",7907,6.3)
14
"BLD",7907,"ABPKG")
n
"BLD",7907,"INIT")

"BLD",7907,"KRN",0)
^9.67PA^779.2^20
"BLD",7907,"KRN",.4,0)
.4
"BLD",7907,"KRN",.4,"NM",0)
^9.68A^^
"BLD",7907,"KRN",.401,0)
.401
"BLD",7907,"KRN",.401,"NM",0)
^9.68A^^
"BLD",7907,"KRN",.402,0)
.402
"BLD",7907,"KRN",.402,"NM",0)
^9.68A^^
"BLD",7907,"KRN",.403,0)
.403
"BLD",7907,"KRN",.403,"NM",0)
^9.68A^^
"BLD",7907,"KRN",.5,0)
.5
"BLD",7907,"KRN",.5,"NM",0)
^9.68A^^
"BLD",7907,"KRN",.84,0)
.84
"BLD",7907,"KRN",.84,"NM",0)
^9.68A^^
"BLD",7907,"KRN",3.6,0)
3.6
"BLD",7907,"KRN",3.6,"NM",0)
^9.68A^^
"BLD",7907,"KRN",3.8,0)
3.8
"BLD",7907,"KRN",3.8,"NM",0)
^9.68A^^
"BLD",7907,"KRN",9.2,0)
9.2
"BLD",7907,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",7907,"KRN",9.8,0)
9.8
"BLD",7907,"KRN",9.8,"NM",0)
^9.68A^4^2
"BLD",7907,"KRN",9.8,"NM",3,0)
PSIVRDC^^0^B10145252
"BLD",7907,"KRN",9.8,"NM",4,0)
PSJOEA2^^0^B28381449
"BLD",7907,"KRN",9.8,"NM","B","PSIVRDC",3)

"BLD",7907,"KRN",9.8,"NM","B","PSJOEA2",4)

"BLD",7907,"KRN",19,0)
19
"BLD",7907,"KRN",19,"NM",0)
^9.68A^^
"BLD",7907,"KRN",19.1,0)
19.1
"BLD",7907,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",7907,"KRN",101,0)
101
"BLD",7907,"KRN",101,"NM",0)
^9.68A^^
"BLD",7907,"KRN",409.61,0)
409.61
"BLD",7907,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",7907,"KRN",771,0)
771
"BLD",7907,"KRN",771,"NM",0)
^9.68A^^
"BLD",7907,"KRN",779.2,0)
779.2
"BLD",7907,"KRN",779.2,"NM",0)
^9.68A^^
"BLD",7907,"KRN",870,0)
870
"BLD",7907,"KRN",870,"NM",0)
^9.68A^^
"BLD",7907,"KRN",8989.51,0)
8989.51
"BLD",7907,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",7907,"KRN",8989.52,0)
8989.52
"BLD",7907,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",7907,"KRN",8994,0)
8994
"BLD",7907,"KRN",8994,"NM",0)
^9.68A^^
"BLD",7907,"KRN","B",.4,.4)

"BLD",7907,"KRN","B",.401,.401)

"BLD",7907,"KRN","B",.402,.402)

"BLD",7907,"KRN","B",.403,.403)

"BLD",7907,"KRN","B",.5,.5)

"BLD",7907,"KRN","B",.84,.84)

"BLD",7907,"KRN","B",3.6,3.6)

"BLD",7907,"KRN","B",3.8,3.8)

"BLD",7907,"KRN","B",9.2,9.2)

"BLD",7907,"KRN","B",9.8,9.8)

"BLD",7907,"KRN","B",19,19)

"BLD",7907,"KRN","B",19.1,19.1)

"BLD",7907,"KRN","B",101,101)

"BLD",7907,"KRN","B",409.61,409.61)

"BLD",7907,"KRN","B",771,771)

"BLD",7907,"KRN","B",779.2,779.2)

"BLD",7907,"KRN","B",870,870)

"BLD",7907,"KRN","B",8989.51,8989.51)

"BLD",7907,"KRN","B",8989.52,8989.52)

"BLD",7907,"KRN","B",8994,8994)

"BLD",7907,"QUES",0)
^9.62^^
"BLD",7907,"REQB",0)
^9.611^3^2
"BLD",7907,"REQB",1,0)
PSJ*5.0*85^2
"BLD",7907,"REQB",3,0)
PSJ*5.0*133^2
"BLD",7907,"REQB","B","PSJ*5.0*133",3)

"BLD",7907,"REQB","B","PSJ*5.0*85",1)

"MBREQ")
0
"PKG",203,-1)
1^1
"PKG",203,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",203,20,0)
^9.402P^^
"PKG",203,22,0)
^9.49I^1^1
"PKG",203,22,1,0)
5.0^2971215^2980417^1271
"PKG",203,22,1,"PAH",1,0)
200^3100304^33288
"PKG",203,22,1,"PAH",1,1,0)
^^7^7^3100304
"PKG",203,22,1,"PAH",1,1,1,0)
This patch will fix the following issues:
"PKG",203,22,1,"PAH",1,1,2,0)
1.  Return and Destroy (IV) (PSJI RETURN BY BARCODE ID) does not update
"PKG",203,22,1,"PAH",1,1,3,0)
    cumulative doses after destroying a label.
"PKG",203,22,1,"PAH",1,1,4,0)
 
"PKG",203,22,1,"PAH",1,1,5,0)
 
"PKG",203,22,1,"PAH",1,1,6,0)
2. Complex order was not verified by a pharmacist and appeared on the 
"PKG",203,22,1,"PAH",1,1,7,0)
   picklist with the unit needed displayed on the picklist.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSIVRDC")
0^3^B10145252^B9233435
"RTN","PSIVRDC",1,0)
PSIVRDC ;BIR/MV - RECYCLE, CANCEL, DESTROY ACTIONS ;30 Aug 2001  4:21 PM
"RTN","PSIVRDC",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**85,200**;16 DEC 97;Build 14
"RTN","PSIVRDC",3,0)
 ;
"RTN","PSIVRDC",4,0)
 ;;Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIVRDC",5,0)
 ;
"RTN","PSIVRDC",6,0)
EN ;
"RTN","PSIVRDC",7,0)
 NEW CHK,PSGDT,PSIVPL,PSIVPR,PSIVSITE,PSIVSN,PSJSYSL,PSJSYSP,PSJSYSP0,PSJSYSU
"RTN","PSIVRDC",8,0)
 D ^PSIVXU Q:$D(XQUIT)
"RTN","PSIVRDC",9,0)
 NEW DA,DIC,DIR,X,X,Y
"RTN","PSIVRDC",10,0)
 W !
"RTN","PSIVRDC",11,0)
 F  K DIR S DIR(0)="SOA^R:RECYCLE;C:CANCEL;D:DESTROY",DIR("A")="Enter action to take (Recycle/Cancel/Destroy): " D ^DIR Q:$S(Y="R":0,Y="C":0,Y="D":0,1:1)  D GTID(Y)
"RTN","PSIVRDC",12,0)
 Q
"RTN","PSIVRDC",13,0)
GTID(PSJRDC) ;
"RTN","PSIVRDC",14,0)
 F  K DIR S DIR(0)="FO^1:50",DIR("A")="Scan Barcode to "_$$TXT(PSJRDC) D  Q:X=""!$D(DTOUT)!$D(DUOUT)!$D(DIROUT)  D UPDID($$UP^XLFSTR(X),PSJRDC)
"RTN","PSIVRDC",15,0)
 . S DIR("?")="Please enter the barcode ID" D ^DIR
"RTN","PSIVRDC",16,0)
 Q
"RTN","PSIVRDC",17,0)
UPDID(PSJID,PSJRDC)        ;
"RTN","PSIVRDC",18,0)
 NEW ACTION,DA,DIC,DFN,ON,LABELS,PSIVNOL,PSJLB,X,Y
"RTN","PSIVRDC",19,0)
 I '$D(^PS(55,+$P(PSJID,"V"),"BCMA",PSJID)) W !,"...Invalid ID number.  Please try again.",!! Q
"RTN","PSIVRDC",20,0)
 S DA(1)=$P(PSJID,"V"),DIC="^PS(55,"_DA(1)_",""IVBCMA"",",X=$P(PSJID,"V",2),DIC(0)="ZQ" D ^DIC
"RTN","PSIVRDC",21,0)
 I Y=-1 W !!,"...Invalid ID number.  Please try again.",!! Q
"RTN","PSIVRDC",22,0)
 W !
"RTN","PSIVRDC",23,0)
 F X=1:1:8 S PSJLB(X)=$P(Y(0),U,X)
"RTN","PSIVRDC",24,0)
 I $S(PSJLB(4)]""&("CGIS"[PSJLB(4)):1,PSJLB(7)="RP":0,PSJLB(7)]"":1,1:0) D  Q
"RTN","PSIVRDC",25,0)
 . W !,"...The ID entered was marked as "
"RTN","PSIVRDC",26,0)
 . W $S(PSJLB(4)="C":"Completed.",PSJLB(4)="G":"Given.",PSJLB(4)="I":"Infusing.",PSJLB(4)="S":"Stop.",PSJLB(7)="CA":"Cancel.",PSJLB(7)="DT":"Destroy.",PSJLB(7)="RC":"Recycle.",1:""),!
"RTN","PSIVRDC",27,0)
 S ON=PSJLB(2),DFN=$P(PSJID,"V")
"RTN","PSIVRDC",28,0)
 D DSPLY
"RTN","PSIVRDC",29,0)
 K DIR S DIR(0)="FO^1:50",DIR("A")=$$TXT(PSJRDC),DIR("B")=PSJID D ^DIR
"RTN","PSIVRDC",30,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIROUT) Q
"RTN","PSIVRDC",31,0)
 I X'=PSJID W !,"...Barcode ID did not match.  No action was taken." W ! Q
"RTN","PSIVRDC",32,0)
 K DA,DR,DIE,DIC,DIR
"RTN","PSIVRDC",33,0)
 D NOW^%DTC
"RTN","PSIVRDC",34,0)
 S DA=$P(PSJID,"V",2),DA(1)=DFN,DIE="^PS(55,"_DA(1)_",""IVBCMA"","
"RTN","PSIVRDC",35,0)
 S DR="4////"_%_";5////"_$S(PSJRDC="R":"RC",PSJRDC="D":"DT",1:"CA") D ^DIE
"RTN","PSIVRDC",36,0)
 K DA,DR,DIE,DIC,DTOUT,DUOUT,DIROUT
"RTN","PSIVRDC",37,0)
 ;BHW;PSJ*5*200;Add RDFLAG and RDWARD so PSIVSTAT will update the Cumulative doses.
"RTN","PSIVRDC",38,0)
 N RDFLAG,RDWARD
"RTN","PSIVRDC",39,0)
 S RDFLAG="ON"
"RTN","PSIVRDC",40,0)
 S RDWARD=$P(^PS(55,DFN,"IV",+ON,0),U,22) I 'RDWARD S RDWARD=$S($D(^DPT(DFN,.1)):$O(^DIC(42,"B",^DPT(DFN,.1),0)),1:.5)
"RTN","PSIVRDC",41,0)
 ;BHW;PSJ*5*200;End Changes
"RTN","PSIVRDC",42,0)
 S PSIVNOL=1,LABELS=1,ACTION=$S(PSJRDC="R":2,PSJRDC="D":3,1:4) D ^PSIVLTR,^PSIVSTAT
"RTN","PSIVRDC",43,0)
 W !,"...Done!",!!
"RTN","PSIVRDC",44,0)
 Q
"RTN","PSIVRDC",45,0)
DSPLY ;Display the patient name, additives/solutions.
"RTN","PSIVRDC",46,0)
 NEW PSJAS,PSJADSOL,PSJL,PSJLBN,PSJLEN,PSJLN,VA,VADM,X
"RTN","PSIVRDC",47,0)
 K ^TMP("PSIVLB",$J)
"RTN","PSIVRDC",48,0)
 D DEM^VADPT
"RTN","PSIVRDC",49,0)
 S PSJL="",(PSJLEN,PSJLN)=1,PSJLBN=$P(PSJID,"V",2)
"RTN","PSIVRDC",50,0)
 F PSJAS="AD","SOL" D ADSOL^PSIVLB(PSJAS)
"RTN","PSIVRDC",51,0)
 W !,VADM(1),!
"RTN","PSIVRDC",52,0)
 F X=0:0 S X=$O(^TMP("PSIVLB",$J,X)) Q:'X  W !,^(X,0)
"RTN","PSIVRDC",53,0)
 W !
"RTN","PSIVRDC",54,0)
 K ^TMP("PSIVLB",$J)
"RTN","PSIVRDC",55,0)
 Q
"RTN","PSIVRDC",56,0)
TXT(X) ;Expand the set of code to text.
"RTN","PSIVRDC",57,0)
 Q $S(X="R":"Recycle",X="C":"Cancel",X="D":"Destroy",1:"")
"RTN","PSJOEA2")
0^4^B28381449^B27419272
"RTN","PSJOEA2",1,0)
PSJOEA2 ;BIR/MLM-INPATIENT ORDER ENTRY ; 5/11/09 7:50am
"RTN","PSJOEA2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**127,133,200**;16 DEC 97;Build 14
"RTN","PSJOEA2",3,0)
 ;
"RTN","PSJOEA2",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJOEA2",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789.
"RTN","PSJOEA2",6,0)
 ;
"RTN","PSJOEA2",7,0)
CHK ;Check to be sure all the orders in the complex order series are completed, continued.
"RTN","PSJOEA2",8,0)
 I 'PSJCOMV,'$G(COMQUIT) N PSJO S PSJO=0 F  S PSJO=$O(^TMP("PSJCOM",$J,PSJO)) Q:'PSJO  S PSGORD=+PSJO_"P",PSGND=$G(^PS(53.1,+PSJO,0)) D
"RTN","PSJOEA2",9,0)
 .S PSGP=$P(PSGND,"^",15)
"RTN","PSJOEA2",10,0)
 .I $P(PSGND,U,4)="U",$P(PSGND,U,9)="A",($P(PSGND,U,24)'="R") D ^PSGOT D  Q
"RTN","PSJOEA2",11,0)
 ..M ^PS(55,PSGP,5,+PSGORD,4)=^PS(53.1,PSJO,4)
"RTN","PSJOEA2",12,0)
 ..N PSGND2P5 S PSGND2P5=$G(^PS(53.1,+PSJO,2.5)),DUR=$P(PSGND2P5,"^",2) I $G(DUR)]"" N DA,DR,DIE S DIE="^PS(55,"_PSGP_",5,",DA(1)=PSGP,DA=+PSGORD,DR="126////"_$G(DUR) D ^DIE
"RTN","PSJOEA2",13,0)
 ..D ACTLOG^PSJOEA(PSJO,PSGP,PSGORD)
"RTN","PSJOEA2",14,0)
 ..S VND4=$G(^PS(55,PSGP,5,+PSGORD,4))
"RTN","PSJOEA2",15,0)
 ..I PSJSYSL>1 S $P(^PS(55,PSGP,5,+PSGORD,7),U)=PSGDT S:$P(^(7),U,2)="" $P(^(7),U,2)="N"_$S($P(^PS(55,PSGP,5,+PSGORD,0),"^",24)="E":"E",1:"") S PSGTOL=2,PSGUOW=DUZ,PSGTOO=1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSJOEA2",16,0)
 ..S:$P(VND4,"^",15)&'$P(VND4,"^",16) $P(VND4,"^",15)="" S:$P(VND4,"^",18)&'$P(VND4,"^",19) $P(VND4,"^",18)="" S:$P(VND4,"^",22)&'$P(VND4,"^",23) $P(VND4,"^",22)="" S $P(VND4,"^",PSJSYSU,PSJSYSU+1)=DUZ_"^"_PSGDT
"RTN","PSJOEA2",17,0)
 ..; Set PV and NV flag according to PSJSYSU  (PSJ*5*200)
"RTN","PSJOEA2",18,0)
 ..S $P(VND4,"^",+PSJSYSU=1+9)=1 S:'$P(VND4,U,+PSJSYSU=3+9) $P(VND4,U,+PSJSYSU=3+9)=+$P(VND4,U,+PSJSYSU=3+9) S ^PS(55,PSGP,5,+PSGORD,4)=VND4
"RTN","PSJOEA2",19,0)
 ..I '$P(VND4,U,10) S ^PS(55,"ANV",PSGP,+PSGORD)=""
"RTN","PSJOEA2",20,0)
 ..I $P(VND4,U,9) K ^PS(55,"APV",PSGP,+PSGORD)
"RTN","PSJOEA2",21,0)
 ..I $P(VND4,U,10) K ^PS(55,"ANV",PSGP,+PSGORD)
"RTN","PSJOEA2",22,0)
 ..S:+PSJSYSU=3 ^PS(55,"AUE",PSGP,+PSGORD)=""
"RTN","PSJOEA2",23,0)
 ..S PSJCOM=$P($G(^PS(55,PSGP,5,+PSGORD,.2)),"^",8) I PSJCOM]"" K ^PS(53.1,"ACX",PSJCOM,PSJO) ;S $P(^PS(55,PSGP,5,+PSGORD,4),"^",9)=1
"RTN","PSJOEA2",24,0)
 ..D EN1^PSJHL2(PSGP,$S(+PSJSYSU=3:"SC",+PSJSYSU=1:"SC",1:"XX"),+PSGORD_"U")     ; allow status change to be sent for pharmacists & nurses
"RTN","PSJOEA2",25,0)
 ..D:+PSJSYSU=1 EN1^PSJHL2(PSGP,"ZV",+PSGORD_"U") L -^PS(55,PSGP,5,+PSGORD)
"RTN","PSJOEA2",26,0)
 ..S PSJPREX=1 D CMPLX2^PSJCOM1(PSGP,PSJORD,PSGORD) K PSJPREX
"RTN","PSJOEA2",27,0)
 .I $P(PSGND,U,4)'="U",$P(PSGND,U,9)="A" D GT531^PSIVORFA(PSGP,PSJO_"P") D  Q
"RTN","PSJOEA2",28,0)
 ..S ON55="" I $P(PSGND,"^",24)="R" S ON55=$P(PSGND,"^",25) D
"RTN","PSJOEA2",29,0)
 ...N PND0,PSGORDR S PND0=^PS(53.1,+PSJO,0),PSGORDR=$P(PND0,U,25)
"RTN","PSJOEA2",30,0)
 ...Q:'$$LS^PSSLOCK(PSGP,PSGORDR)
"RTN","PSJOEA2",31,0)
 ...N OEORD,OOEORD,FILE55,FILE55N0,PNDP2 S PNDP2=^PS(53.1,+PSJO,.2),FILE55="^PS(55,"_DFN_",""IV"",",FILE55N0=FILE55_+PSGORDR_",0)"
"RTN","PSJOEA2",32,0)
 ...S OEORD=$P(PND0,U,21) I PSGORDR S OOEORD=$P(@FILE55N0,"^",21) I OEORD'=OOEORD D EXPOE^PSGOER(DFN,+PSJO_"P",+$$LASTREN^PSJLMPRI(DFN,+PSJO_"P"))
"RTN","PSJOEA2",33,0)
 ...S PSGORDP=PSJO,DIE="^PS(53.1,",DA=+PSJO,DR="28////A;104////@" W "." D ^DIE
"RTN","PSJOEA2",34,0)
 ...Q:'$G(OEORD)  K DA,DR,DIE S DA(1)=DFN,DA=+PSGORDR,DIE=FILE55,DR=110_"////"_+OEORD
"RTN","PSJOEA2",35,0)
 ...S:$P(PNDP2,U,8) DR=DR_";150////"_$P(PNDP2,U,8) D ^DIE S DIE=FILE55_+PSGORDR_",0)",$P(@DIE,U,21)=OEORD
"RTN","PSJOEA2",36,0)
 ...D EN1^PSJHL2(DFN,"SC",PSGORDR),UNL^PSSLOCK(PSGP,PSGORDR)
"RTN","PSJOEA2",37,0)
 ..I 'ON55 D SETNEW^PSIVORFB
"RTN","PSJOEA2",38,0)
 ..S (P("NEWON"),ON)=ON55,PSGP=$P(PSGND,U,15)
"RTN","PSJOEA2",39,0)
 ..S VND4=$G(^TMP("PSJCOM",$J,+PSJO,4)) D
"RTN","PSJOEA2",40,0)
 ...N PSJRN,PSJRNDT,PSJRPH,PSJRPHD,PSJPVFL,PSJNVFL,DR,DIE,DA
"RTN","PSJOEA2",41,0)
 ...S (PSJPVFL,PSJNVFL)=""
"RTN","PSJOEA2",42,0)
 ...S PSJRN=$P(VND4,U,1),PSJRNDT=$P(VND4,U,2),PSJRPH=$P(VND4,U,3),PSJRPHD=$P(VND4,U,4),PSJPVFL=$P(VND4,U,16) S:PSJRN]"" PSJNVFL=1
"RTN","PSJOEA2",43,0)
 ...S DR="16////"_PSJRN_";17////"_PSJRNDT_";140////"_PSJRPH_";141////"_PSJRPHD_";142////"_PSJPVFL_";143////"_PSJNVFL
"RTN","PSJOEA2",44,0)
 ...S DA(1)=PSGP,DA=+ON55,DIE="^PS(55,"_PSGP_",""IV""," D ^DIE
"RTN","PSJOEA2",45,0)
 ..D:P("RES")="R" RUPDATE^PSIVOREN(PSGP,ON,P(2))
"RTN","PSJOEA2",46,0)
 ..I +PSJSYSU=3 K OD D ^PSIVORE1 ;LABEL STUFF
"RTN","PSJOEA2",47,0)
 ..I $G(P("PACT"))]"",+$P(P("PACT"),U,2),+$P(P("PACT"),U,3) D  Q
"RTN","PSJOEA2",48,0)
 ...NEW DIC,DA,X,Y,XX D NAME^PSJBCMA1($P(P("PACT"),U,2),.XX)
"RTN","PSJOEA2",49,0)
 ...S DIC(0)="L",DA(1)=DFN,DA(2)=+ON55,X=1
"RTN","PSJOEA2",50,0)
 ...S DIC="^PS(55,"_DA(1)_",""IV"","_DA(2)_",""A"","
"RTN","PSJOEA2",51,0)
 ...S DIC("DR")=".02////F;.03////"_XX_";.04////"_$P($G(^PS(53.3,+$P(P("PACT"),U,3),0)),U)_";.05////"_$P(P("PACT"),U)_";.06////"_$P(P("PACT"),U,2)
"RTN","PSJOEA2",52,0)
 ...K DO D FILE^DICN K DO
"RTN","PSJOEA2",53,0)
 ...N DIK,DA,PSIVACT S DIK="^PS(55,"_DFN_",""IV"",",DA=+ON,PSIVACT="" S:$G(DFN) DA(1)=DFN D IX^DIK K DIK,DA
"RTN","PSJOEA2",54,0)
 ...S PSJCOM=$P($G(^PS(55,DFN,"IV",+ON,.2)),"^",8) I PSJCOM]"" K ^PS(53.1,"ACX",PSJCOM,PSJO)
"RTN","PSJOEA2",55,0)
 ...D EN1^PSJHL2(DFN,"SC",ON)
"RTN","PSJOEA2",56,0)
 ...D:+PSJSYSU=1 EN1^PSJHL2(DFN,"ZV",ON) L -^PS(55,DFN,"IV",+ON) I $G(ON55) L -^PS(55,DFN,"IV",+ON55)
"RTN","PSJOEA2",57,0)
 ..L -^PS(55,DFN,"IV",+ON) I $G(ON55) L -^PS(55,DFN,"IV",+ON55)
"RTN","PSJOEA2",58,0)
 .I $P(PSGND,U,4)="U",$P(PSGND,U,9)="DE",$D(^TMP("PSJCOM2",$J,PSJO,0)),$P(^TMP("PSJCOM2",$J,PSJO,0),"^",9)="A",$P(^TMP("PSJCOM2",$J,PSJO,0),"^",4)="U" S PSGP=$P(PSGND,U,15) D UD^PSJOEA
"RTN","PSJOEA2",59,0)
 .I $P(PSGND,U,4)'="U",$P(PSGND,U,9)="DE",$D(^TMP("PSJCOM2",$J,PSJO,0)),$P(^TMP("PSJCOM2",$J,PSJO,0),"^",9)="A",$P(^TMP("PSJCOM2",$J,PSJO,0),"^",4)="U" S PSGP=$P(PSGND,U,15) D UD^PSJOEA
"RTN","PSJOEA2",60,0)
 .I $P(PSGND,U,4)'="U",$P(PSGND,U,9)="DE",$D(^TMP("PSJCOM2",$J,PSJO,0)),$P(^TMP("PSJCOM2",$J,PSJO,0),"^",4)'="U",$P(^TMP("PSJCOM2",$J,PSJO,0),"^",17)="A" S DFN=$S($G(PSGP)]"":PSGP,1:$P(PSGND,U,15)) D IV^PSJOEA
"RTN","PSJOEA2",61,0)
 .I $P(PSGND,U,4)="U",$P(PSGND,U,9)="DE",$D(^TMP("PSJCOM2",$J,PSJO,0)),$P(^TMP("PSJCOM2",$J,PSJO,0),"^",4)'="U",$P(^TMP("PSJCOM2",$J,PSJO,0),"^",17)="A" S DFN=$S($G(PSGP)]"":PSGP,1:$P(PSGND,U,15)) D IV^PSJOEA
"RTN","PSJOEA2",62,0)
 K ^TMP("PSJCOM",$J),^TMP("PSJCOM2",$J),PSJOWALL
"RTN","PSJOEA2",63,0)
 Q
"VER")
8.0^22.0
"BLD",7907,6)
^204
**END**
**END**
