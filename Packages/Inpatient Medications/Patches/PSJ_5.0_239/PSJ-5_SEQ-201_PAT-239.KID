Released PSJ*5*239 SEQ #201
Extracted from mail message
**KIDS**:PSJ*5.0*239^

**INSTALL NAME**
PSJ*5.0*239
"BLD",7011,0)
PSJ*5.0*239^INPATIENT MEDICATIONS^0^3100304^y
"BLD",7011,1,0)
^^27^27^3100304^
"BLD",7011,1,1,0)
Patch PSJ*5*214 introduced an enhancement to the Patients on Specific 
"BLD",7011,1,2,0)
Drug(s) [PSJ PDV] option in which a user could select a parent (or major) 
"BLD",7011,1,3,0)
VA DRUG CLASS and the system would respond as if the user had entered 
"BLD",7011,1,4,0)
each of the corresponding child (or minor) drug class.
"BLD",7011,1,5,0)
 
"BLD",7011,1,6,0)
The enhancement broke the ability for the option to display data for 
"BLD",7011,1,7,0)
parent classes that have drugs directly assigned to them, such as IN000 
"BLD",7011,1,8,0)
(Investigational Agents) or HA000 (Herbs/Alternative Therapy).
"BLD",7011,1,9,0)
 
"BLD",7011,1,10,0)
This patch PSJ*5*239 will restore the ability for the report to identify 
"BLD",7011,1,11,0)
the drugs that are directly assigned to a parent VA class.
"BLD",7011,1,12,0)
 
"BLD",7011,1,13,0)
1. Selection of VA Drug Class IN000 (Investigational Agents) in the 
"BLD",7011,1,14,0)
Patients on Specific Drug(s) option no longer returns any data.
"BLD",7011,1,15,0)
 
"BLD",7011,1,16,0)
Problem:
"BLD",7011,1,17,0)
--------
"BLD",7011,1,18,0)
The enhancements written to allow user selection of a parent drug class, 
"BLD",7011,1,19,0)
and the intended system response to return all items associated with its
"BLD",7011,1,20,0)
child drug classes, did not correctly search for drug items directly 
"BLD",7011,1,21,0)
assigned to the parent class itself.
"BLD",7011,1,22,0)
 
"BLD",7011,1,23,0)
Resolution:
"BLD",7011,1,24,0)
-----------
"BLD",7011,1,25,0)
Revise search algorithm to select drugs assigned to the parent class 
"BLD",7011,1,26,0)
first, then resume the process to traverse the drug class hierarchy of 
"BLD",7011,1,27,0)
child classes.
"BLD",7011,4,0)
^9.64PA^^
"BLD",7011,6.3)
1
"BLD",7011,"KRN",0)
^9.67PA^779.2^20
"BLD",7011,"KRN",.4,0)
.4
"BLD",7011,"KRN",.401,0)
.401
"BLD",7011,"KRN",.402,0)
.402
"BLD",7011,"KRN",.403,0)
.403
"BLD",7011,"KRN",.5,0)
.5
"BLD",7011,"KRN",.84,0)
.84
"BLD",7011,"KRN",3.6,0)
3.6
"BLD",7011,"KRN",3.8,0)
3.8
"BLD",7011,"KRN",9.2,0)
9.2
"BLD",7011,"KRN",9.8,0)
9.8
"BLD",7011,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",7011,"KRN",9.8,"NM",1,0)
PSJPDV^^0^B53728238
"BLD",7011,"KRN",9.8,"NM","B","PSJPDV",1)

"BLD",7011,"KRN",19,0)
19
"BLD",7011,"KRN",19.1,0)
19.1
"BLD",7011,"KRN",101,0)
101
"BLD",7011,"KRN",409.61,0)
409.61
"BLD",7011,"KRN",771,0)
771
"BLD",7011,"KRN",779.2,0)
779.2
"BLD",7011,"KRN",870,0)
870
"BLD",7011,"KRN",8989.51,0)
8989.51
"BLD",7011,"KRN",8989.52,0)
8989.52
"BLD",7011,"KRN",8994,0)
8994
"BLD",7011,"KRN","B",.4,.4)

"BLD",7011,"KRN","B",.401,.401)

"BLD",7011,"KRN","B",.402,.402)

"BLD",7011,"KRN","B",.403,.403)

"BLD",7011,"KRN","B",.5,.5)

"BLD",7011,"KRN","B",.84,.84)

"BLD",7011,"KRN","B",3.6,3.6)

"BLD",7011,"KRN","B",3.8,3.8)

"BLD",7011,"KRN","B",9.2,9.2)

"BLD",7011,"KRN","B",9.8,9.8)

"BLD",7011,"KRN","B",19,19)

"BLD",7011,"KRN","B",19.1,19.1)

"BLD",7011,"KRN","B",101,101)

"BLD",7011,"KRN","B",409.61,409.61)

"BLD",7011,"KRN","B",771,771)

"BLD",7011,"KRN","B",779.2,779.2)

"BLD",7011,"KRN","B",870,870)

"BLD",7011,"KRN","B",8989.51,8989.51)

"BLD",7011,"KRN","B",8989.52,8989.52)

"BLD",7011,"KRN","B",8994,8994)

"BLD",7011,"QUES",0)
^9.62^^
"BLD",7011,"REQB",0)
^9.611^1^1
"BLD",7011,"REQB",1,0)
PSJ*5.0*214^2
"BLD",7011,"REQB","B","PSJ*5.0*214",1)

"MBREQ")
0
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
239^3100304
"PKG",197,22,1,"PAH",1,1,0)
^^27^27^3100304
"PKG",197,22,1,"PAH",1,1,1,0)
Patch PSJ*5*214 introduced an enhancement to the Patients on Specific 
"PKG",197,22,1,"PAH",1,1,2,0)
Drug(s) [PSJ PDV] option in which a user could select a parent (or major) 
"PKG",197,22,1,"PAH",1,1,3,0)
VA DRUG CLASS and the system would respond as if the user had entered 
"PKG",197,22,1,"PAH",1,1,4,0)
each of the corresponding child (or minor) drug class.
"PKG",197,22,1,"PAH",1,1,5,0)
 
"PKG",197,22,1,"PAH",1,1,6,0)
The enhancement broke the ability for the option to display data for 
"PKG",197,22,1,"PAH",1,1,7,0)
parent classes that have drugs directly assigned to them, such as IN000 
"PKG",197,22,1,"PAH",1,1,8,0)
(Investigational Agents) or HA000 (Herbs/Alternative Therapy).
"PKG",197,22,1,"PAH",1,1,9,0)
 
"PKG",197,22,1,"PAH",1,1,10,0)
This patch PSJ*5*239 will restore the ability for the report to identify 
"PKG",197,22,1,"PAH",1,1,11,0)
the drugs that are directly assigned to a parent VA class.
"PKG",197,22,1,"PAH",1,1,12,0)
 
"PKG",197,22,1,"PAH",1,1,13,0)
1. Selection of VA Drug Class IN000 (Investigational Agents) in the 
"PKG",197,22,1,"PAH",1,1,14,0)
Patients on Specific Drug(s) option no longer returns any data.
"PKG",197,22,1,"PAH",1,1,15,0)
 
"PKG",197,22,1,"PAH",1,1,16,0)
Problem:
"PKG",197,22,1,"PAH",1,1,17,0)
--------
"PKG",197,22,1,"PAH",1,1,18,0)
The enhancements written to allow user selection of a parent drug class, 
"PKG",197,22,1,"PAH",1,1,19,0)
and the intended system response to return all items associated with its
"PKG",197,22,1,"PAH",1,1,20,0)
child drug classes, did not correctly search for drug items directly 
"PKG",197,22,1,"PAH",1,1,21,0)
assigned to the parent class itself.
"PKG",197,22,1,"PAH",1,1,22,0)
 
"PKG",197,22,1,"PAH",1,1,23,0)
Resolution:
"PKG",197,22,1,"PAH",1,1,24,0)
-----------
"PKG",197,22,1,"PAH",1,1,25,0)
Revise search algorithm to select drugs assigned to the parent class 
"PKG",197,22,1,"PAH",1,1,26,0)
first, then resume the process to traverse the drug class hierarchy of 
"PKG",197,22,1,"PAH",1,1,27,0)
child classes.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSJPDV")
0^1^B53728238^B53702138
"RTN","PSJPDV",1,0)
PSJPDV ;BIR/KKA-LIST PATIENTS ON SPECIFIC DRUGS ; 3/4/10 9:38am
"RTN","PSJPDV",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**9,22,30,50,67,214,239**;16 DEC 97;Build 1
"RTN","PSJPDV",3,0)
 ;
"RTN","PSJPDV",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJPDV",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJPDV",6,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJPDV",7,0)
 ; Reference to ^PS(59.7 is supported by DBIA# 2181.
"RTN","PSJPDV",8,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192.
"RTN","PSJPDV",9,0)
 ; Reference to ^PS(50.606 is supported by DBIA# 2174.
"RTN","PSJPDV",10,0)
 ; Reference to ^PS(50.605 is supported by DBIA# 696.
"RTN","PSJPDV",11,0)
 ; Reference to ^%DT is supported by DBIA# 10003.
"RTN","PSJPDV",12,0)
 ; Reference to ^%ZISC is supported by DBIA# 10089.
"RTN","PSJPDV",13,0)
 ; Reference to ^DIC is supported by DBIA# 10006.
"RTN","PSJPDV",14,0)
 ; Reference to ^DIR is supported by DBIA# 10026.
"RTN","PSJPDV",15,0)
 ; Reference to ^VAUTOMA is supported by DBIA# 664.
"RTN","PSJPDV",16,0)
 ;
"RTN","PSJPDV",17,0)
DATES ;prompt user for the range of dates
"RTN","PSJPDV",18,0)
 N QFLG,OUT
"RTN","PSJPDV",19,0)
 W ! S %DT="ETX",D="start" D DT G:Y'>0 DONE S (%DT(0),PSJREPS)=+Y,D="stop" D DT K %DT G:Y'>0 DONE S:'$P(PSJREPS,".",2) PSJREPS=PSJREPS+.0001 S PSJREPF=Y+$S($P(Y,".",2):0,1:.24)
"RTN","PSJPDV",20,0)
 ;
"RTN","PSJPDV",21,0)
ORDERS D LIST^PSJEXP0 G:$D(OUT) DONE W !
"RTN","PSJPDV",22,0)
 ;
"RTN","PSJPDV",23,0)
SORT S DIR(0)="SAOM^P:Patient;S:Start Date",DIR("A")="Do you wish to sort by (P)atient or (S)tart Date: ",DIR("B")="Patient"
"RTN","PSJPDV",24,0)
 S DIR("?",1)="Enter a ""P"" if you wish to sort by patient name or enter ""S"" if you",DIR("?")="wish to sort by order start date." D ^DIR K DIR S PSJSRT=Y G:$D(DTOUT)!($D(DUOUT)) DONE
"RTN","PSJPDV",25,0)
 ;
"RTN","PSJPDV",26,0)
SELECT W ! S DIR(0)="SAM^O:Orderable Item;D:Dispense Drug;V:VA Class of Drugs",DIR("A")="List by (O)rderable Item, (D)ispense Drug, or (V)A Class of Drugs: "
"RTN","PSJPDV",27,0)
 S DIR("?",1)="Enter a ""O"" if you wish to list all patients on a specific orderable item",DIR("?",2)="Enter a ""D"" if you wish to list all patients on a specific dispense drug,"
"RTN","PSJPDV",28,0)
 S DIR("?")="or enter a ""V"" if you wish to list all patients on a VA class of drugs." D ^DIR K DIR S PSJSL=Y G:$D(DTOUT)!($D(DUOUT)) DONE
"RTN","PSJPDV",29,0)
 ;
"RTN","PSJPDV",30,0)
DRGS S COUNT=1,BCNT=0 W !
"RTN","PSJPDV",31,0)
 ;/IV Identifier is no longer used after POE
"RTN","PSJPDV",32,0)
 ;/S PSJIDD=$P($G(^PS(59.7,1,31)),"^",2)
"RTN","PSJPDV",33,0)
 F  K DIC S DIC=$S(PSJSL="O":50.7,PSJSL="D":50,PSJSL="V":50.605),DIC(0)="QEAMZ" Q:$D(OUT)  D
"RTN","PSJPDV",34,0)
 .I PSJSL="O" D
"RTN","PSJPDV",35,0)
 ..;/S DIC("W")="W ""  ""_$P(^PS(50.606,$P(^PS(50.7,+Y,0),""^"",2),0),""^"")_$S($P(^PS(50.7,+Y,0),""^"",3):"" ""_$G(PSJIDD),1:"""")_"
"RTN","PSJPDV",36,0)
 ..S DIC("W")="W ""  ""_$P(^PS(50.606,$P(^PS(50.7,+Y,0),""^"",2),0),""^"")_"
"RTN","PSJPDV",37,0)
 ..S DIC("W")=DIC("W")_""" ""_$S($P(^PS(50.7,+Y,0),""^"",4):$E($P(^(0),""^"",4),4,5)_""-""_$E($P(^(0),""^"",4),6,7)_""-""_$E($P(^(0),""^"",4),2,3),1:"""")"
"RTN","PSJPDV",38,0)
 .D ^DIC K DIC S:$D(DTOUT)!($D(DUOUT)) QFLG=1 S:(+Y'>0) OUT=1 Q:+Y'>0  S IEN=+Y,NAME=$P(Y,U,2) D @PSJSL
"RTN","PSJPDV",39,0)
 ;***PSJCNT is set to the number of drugs or classes the user chooses
"RTN","PSJPDV",40,0)
 S PSJCNT=COUNT-1
"RTN","PSJPDV",41,0)
 ;G:$D(QFLG)!(PSJCNT=0) DONE
"RTN","PSJPDV",42,0)
 G:$D(QFLG)!(BCNT=0) DONE
"RTN","PSJPDV",43,0)
 ;
"RTN","PSJPDV",44,0)
MATCH ;**prompt user for the number of matches, default to 1 RMS/PBM PSJ*5*214
"RTN","PSJPDV",45,0)
 W ! S DIR(0)="NAO^1:"_PSJCNT_":0",DIR("A")="Select number of matches: ",DIR("B")=1
"RTN","PSJPDV",46,0)
 S DIR("?",1)="Enter the number of drugs that a user must be receiving to appear",DIR("?",2)="on the report.",DIR("?",3)="",DIR("?")="The number must be between 1 and "_PSJCNT
"RTN","PSJPDV",47,0)
 D ^DIR K DIR S PSJMAT=Y G:$D(DTOUT)!($D(DUOUT)) DONE
"RTN","PSJPDV",48,0)
 ;
"RTN","PSJPDV",49,0)
DIVWARD ;PSJ*5*214 ADDS MULTIDIVISIONAL SUPPORT
"RTN","PSJPDV",50,0)
 W !
"RTN","PSJPDV",51,0)
 I $$CNTDIV^PSJQUTIL=1 S VAUTD=1 G UNIDIV
"RTN","PSJPDV",52,0)
 D DIVISION^VAUTOMA
"RTN","PSJPDV",53,0)
 G:$D(DTOUT)!($D(DUOUT))!(Y=-1) DONE
"RTN","PSJPDV",54,0)
UNIDIV I '$G(VAUTNI) S VAUTNI=2
"RTN","PSJPDV",55,0)
 D WARD^VAUTOMA
"RTN","PSJPDV",56,0)
 G:$D(DTOUT)!(Y=-1) DONE
"RTN","PSJPDV",57,0)
 I VAUTD I VAUTW D  ;WARD GROUPS
"RTN","PSJPDV",58,0)
 . N PSJSTOP,PSJWARD,PSJSEL
"RTN","PSJPDV",59,0)
 . W !!,"You may optionally select a ward group..." D G^PSJPDIR
"RTN","PSJPDV",60,0)
 . Q:+PSJSTOP
"RTN","PSJPDV",61,0)
 . S PSJWARD=0 F  S PSJWARD=$O(^PS(57.5,+PSJSEL("WG"),1,PSJWARD)) Q:'+PSJWARD  D
"RTN","PSJPDV",62,0)
 .. S VAUTW=0,VAUTW($G(^PS(57.5,+PSJSEL("WG"),1,PSJWARD,0)))=""
"RTN","PSJPDV",63,0)
 ;
"RTN","PSJPDV",64,0)
DEV ; ask print device and queue if asked to
"RTN","PSJPDV",65,0)
 K ZTSAVE S PSGTIR="ENQ^PSJPDV0",ZTDESC="List Patients on Specific Drugs" F X="CHOICE","PSJISP(","PSJSNM(","PSJREPS","PSJREPF","PSJSL","PSJSRT","PSJCNT","PSJMAT","VAUTD","VAUTW","VAUTD(","VAUTW(" S ZTSAVE(X)=""
"RTN","PSJPDV",66,0)
 D ENDEV^PSGTI I POP!$D(ZTSK) W:POP !!?3,"No device selected for report run." W:$D(ZTSK) !?3,"Report Queued!" K ZTSK G DONE
"RTN","PSJPDV",67,0)
 U IO
"RTN","PSJPDV",68,0)
 W:$E(IOST)="C" !,"...this may take a few minutes...",!?25,"...you really should QUEUE this report, if possible..."
"RTN","PSJPDV",69,0)
 D ^PSJPDV0
"RTN","PSJPDV",70,0)
 I '$D(QFLG)&($E(IOST)="C") W !!,"Press RETURN to continue: " R CONT:DTIME
"RTN","PSJPDV",71,0)
 ;
"RTN","PSJPDV",72,0)
DONE W:$E(IOST)="P" @IOF D ^%ZISC K %DT,CHOICE,CNT,CONT,COUNT,D,DIC,DTOUT,DUOUT,IEN,NAME,OUT,POP,PRIM,PSGP,PSGTIR,PSJCNT,PSJISP,PSJMAT,PSJREPF,PSJREPS,PSJSL,PSJSNM,PSJSRT,QFLG,SPDRG,X,Y
"RTN","PSJPDV",73,0)
 ;/K GG,GGG,MATCHES,ON,OUT,PSIVUP,PSJACNWP,PSJIDD,PSJORIFN,PSJPAD,PSJPAGE,PSJPBID,PSJPCAF,PSJPDD,PSJDOB,PSJPDX,PSJPHT,PSJPHTD,PSJPPID,PSJPRB,PSJPSEX,PSJPSSN,PSJPTD,PSJPTS,PSJPTSD,PSJPWD,PSJPWDN,PSJPWT,PSJPWTD,PSJPDOB,PSJPTSP
"RTN","PSJPDV",74,0)
 K GG,GGG,MATCHES,ON,OUT,PSIVUP,PSJACNWP,PSJORIFN,PSJPAD,PSJPAGE,PSJPBID,PSJPCAF,PSJPDD,PSJDOB,PSJPDX,PSJPHT,PSJPHTD,PSJPPID,PSJPRB,PSJPSEX,PSJPSSN,PSJPTD,PSJPTS,PSJPTSD,PSJPWD,PSJPWDN,PSJPWT,PSJPWTD,PSJPDOB,PSJPTSP
"RTN","PSJPDV",75,0)
 K PSJQ,VAUTD,VAUTW,VAUTNI
"RTN","PSJPDV",76,0)
 Q
"RTN","PSJPDV",77,0)
 ;
"RTN","PSJPDV",78,0)
P ;get primary drug from user
"RTN","PSJPDV",79,0)
 W !!,"Dispense Drugs for ",NAME," are:"
"RTN","PSJPDV",80,0)
 S SPDRG=0 F  S SPDRG=$O(^PSDRUG("AP",IEN,SPDRG)) Q:'SPDRG  W !,$P(^PSDRUG(SPDRG,0),"^") S PSJISP(SPDRG_"D")=COUNT_NAME,PSJSNM(NAME)=""
"RTN","PSJPDV",81,0)
 I $D(PSJSNM(NAME)) S (COUNT,BCNT)=COUNT+1
"RTN","PSJPDV",82,0)
 E  W !,"   NONE FOUND"
"RTN","PSJPDV",83,0)
 W ! Q
"RTN","PSJPDV",84,0)
 ;
"RTN","PSJPDV",85,0)
O ;get orderable item from user
"RTN","PSJPDV",86,0)
 ;/I $P($G(^PS(50.7,IEN,0)),"^",3) S PSJIDD=$P($G(^PS(59.7,1,31)),"^",2) D O1 Q
"RTN","PSJPDV",87,0)
 NEW FIL F FIL=52.6,52.7 I $O(^PS(FIL,"AOI",IEN,0)) D O1 Q
"RTN","PSJPDV",88,0)
 W !!,"Dispense Drugs for ",NAME," are:"
"RTN","PSJPDV",89,0)
 S SPDRG=0 F  S SPDRG=$O(^PSDRUG("ASP",IEN,SPDRG)) Q:'SPDRG  W !,$P(^PSDRUG(SPDRG,0),"^") S PSJISP(SPDRG_"D")=COUNT_NAME,PSJSNM(NAME)=""
"RTN","PSJPDV",90,0)
 I $D(PSJSNM(NAME)) S (COUNT,BCNT)=COUNT+1
"RTN","PSJPDV",91,0)
 E  W !,"   NONE FOUND"
"RTN","PSJPDV",92,0)
 W ! Q
"RTN","PSJPDV",93,0)
O1 ; here if the orderable item is marked for IV use
"RTN","PSJPDV",94,0)
 W !!,"Additives for ",NAME," are:"
"RTN","PSJPDV",95,0)
 ;/S SPDRG=0 F  S SPDRG=$O(^PS(52.6,"AOI",IEN,SPDRG)) Q:'SPDRG  W !,$P(^PS(52.6,SPDRG,0),"^") S PSJISP(IEN_"O")=COUNT_NAME,PSJSNM(NAME_"  "_PSJIDD)=""
"RTN","PSJPDV",96,0)
 S SPDRG=0 F  S SPDRG=$O(^PS(52.6,"AOI",IEN,SPDRG)) Q:'SPDRG  W !,$P(^PS(52.6,SPDRG,0),"^") S PSJISP(IEN_"O")=COUNT_NAME,PSJSNM(NAME)=""
"RTN","PSJPDV",97,0)
 ;/I $D(PSJSNM(NAME_"  "_PSJIDD)) S (COUNT,BCNT)=COUNT+1
"RTN","PSJPDV",98,0)
 I $D(PSJSNM(NAME)) S (COUNT,BCNT)=COUNT+1
"RTN","PSJPDV",99,0)
 E  W !,"   NONE FOUND" D
"RTN","PSJPDV",100,0)
 .W !!,"Solutions for ",NAME," are:"
"RTN","PSJPDV",101,0)
 .;/S SPDRG=0 F  S SPDRG=$O(^PS(52.7,"AOI",IEN,SPDRG)) Q:'SPDRG  W !,$P(^PS(52.7,SPDRG,0),"^") S PSJISP(IEN_"O")=COUNT_NAME,PSJSNM(NAME_"  "_PSJIDD)=""
"RTN","PSJPDV",102,0)
 .S SPDRG=0 F  S SPDRG=$O(^PS(52.7,"AOI",IEN,SPDRG)) Q:'SPDRG  W !,$P(^PS(52.7,SPDRG,0),"^") S PSJISP(IEN_"O")=COUNT_NAME,PSJSNM(NAME)=""
"RTN","PSJPDV",103,0)
 .;/I $D(PSJSNM(NAME_"  "_PSJIDD)) S (COUNT,BCNT)=COUNT+1
"RTN","PSJPDV",104,0)
 .I $D(PSJSNM(NAME)) S (COUNT,BCNT)=COUNT+1
"RTN","PSJPDV",105,0)
 .E  W !,"   NONE FOUND"
"RTN","PSJPDV",106,0)
 W ! Q
"RTN","PSJPDV",107,0)
 ;
"RTN","PSJPDV",108,0)
D ;get dispense drug from user
"RTN","PSJPDV",109,0)
 S PSJISP(IEN_"D")=COUNT,(BCNT,COUNT)=COUNT+1,PSJSNM(NAME)=""
"RTN","PSJPDV",110,0)
 Q
"RTN","PSJPDV",111,0)
 ;
"RTN","PSJPDV",112,0)
V ;get VA Class of Drug from user
"RTN","PSJPDV",113,0)
 D V2,VSPLIT Q:$G(PSJQ("STOP"))
"RTN","PSJPDV",114,0)
V2 W !!,"Dispense Drugs for VA Class ",NAME," are: "
"RTN","PSJPDV",115,0)
 S PRIM=0 F  S PRIM=$O(^PSDRUG("AOC",PRIM)) Q:'PRIM  S SPDRG=0 F  S SPDRG=$O(^PSDRUG("AOC",PRIM,NAME,SPDRG)) Q:'SPDRG  W !,$P(^PSDRUG(SPDRG,0),"^") S PSJISP(SPDRG_"D")=COUNT_NAME,PSJSNM(NAME)=""
"RTN","PSJPDV",116,0)
 I $D(PSJSNM(NAME)) S (BCNT,COUNT)=COUNT+1
"RTN","PSJPDV",117,0)
 W ! Q
"RTN","PSJPDV",118,0)
 ;
"RTN","PSJPDV",119,0)
VSPLIT I $D(^PS(50.605,"AC",IEN)) D
"RTN","PSJPDV",120,0)
 . S PSJQ("CLASS")=0 F  S PSJQ("CLASS")=$O(^PS(50.605,"AC",IEN,PSJQ("CLASS"))) D:$D(^PS(50.605,"AC",+PSJQ("CLASS"))) VSPLIT2 Q:PSJQ("CLASS")'=+PSJQ("CLASS")  D
"RTN","PSJPDV",121,0)
 .. S NAME=$P(^PS(50.605,PSJQ("CLASS"),0),"^") D V2 S PSJQ("STOP")=1
"RTN","PSJPDV",122,0)
 Q
"RTN","PSJPDV",123,0)
VSPLIT2 S PSJQ("CLASS2")=0 F  S PSJQ("CLASS2")=$O(^PS(50.605,"AC",PSJQ("CLASS"),PSJQ("CLASS2"))) Q:'+PSJQ("CLASS2")  S NAME=$P(^PS(50.605,PSJQ("CLASS2"),0),"^") D V2
"RTN","PSJPDV",124,0)
 Q
"RTN","PSJPDV",125,0)
DT S Y=-1 F  W !!,"Enter ",D," date: " R X:DTIME W:'$T $C(7) S:'$T X="^" D DTM:X?1."?",^%DT:"^"'[X I Y>0!("^"[X) W:Y<0 !,"No ",D," date chosen for notices run." Q
"RTN","PSJPDV",126,0)
 Q
"RTN","PSJPDV",127,0)
DTM W !!,"Enter the ",D," date of the range of dates where you wish to see patients ",!,"on specific drugs. The start date and stop date may be the same." W:D="stop" " The stop",!,"date may not come before the start date." W ! Q
"VER")
8.0^22.0
"BLD",7011,6)
^201
**END**
**END**
