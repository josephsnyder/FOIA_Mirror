Released PSJ*5*184 SEQ #196
Extracted from mail message
**KIDS**:PSJ*5.0*184^

**INSTALL NAME**
PSJ*5.0*184
"BLD",6971,0)
PSJ*5.0*184^INPATIENT MEDICATIONS^0^3090820^y
"BLD",6971,1,0)
^^32^32^3090820^
"BLD",6971,1,1,0)
 HD0000000139263 involves multiple additives with values in the MESSAGE 
"BLD",6971,1,2,0)
 field (#14) of the IV ADDITIVES file (#52.6).  When an IV label 
"BLD",6971,1,3,0)
 prints, and the IV order contains multiple additives, if more than one 
"BLD",6971,1,4,0)
 additive has a MESSAGE field value, only the message of the first 
"BLD",6971,1,5,0)
 additive in the IV order will display on the label.  
"BLD",6971,1,6,0)
  
"BLD",6971,1,7,0)
 HD0000000139800 The CPRS Unit Dose report shows the status of the unit 
"BLD",6971,1,8,0)
 dose orders for a given patient.  If an order has the status 
"BLD",6971,1,9,0)
 "Discontinued due to Edit", nothing is displaying in the CPRS Unit 
"BLD",6971,1,10,0)
 Dose report's status field.  The problem is due to Inpatient Meds not 
"BLD",6971,1,11,0)
 sending CPRS the complete information for the status if the order was 
"BLD",6971,1,12,0)
 discontinued due to edit.
"BLD",6971,1,13,0)
  
"BLD",6971,1,14,0)
 HD0000000159948 Within Parameters Edit Menu [PSJ PARAM EDIT MENU], the 
"BLD",6971,1,15,0)
 option Clinic Definition [PSJ CD] asks the user for a CLINIC GROUP 
"BLD",6971,1,16,0)
 NAME.  This prompt is in error and the option should end if no new 
"BLD",6971,1,17,0)
 clinic is chosen for edit.   This issue has no negative impact on the 
"BLD",6971,1,18,0)
 patient but is an inconvenience to the user of the option.
"BLD",6971,1,19,0)
  
"BLD",6971,1,20,0)
 HD0000000168525 When exiting the option by typing an "^" up-arrow at the 
"BLD",6971,1,21,0)
 Report/Label device prompt in Site Parameters (IV) [PSJI SITE PARAMETERS]
"BLD",6971,1,22,0)
 option, the system will default "TELNET" into the field even though a 
"BLD",6971,1,23,0)
 value already exists. The software should retain the existing 
"BLD",6971,1,24,0)
 report/label device at this prompt and not change the default device.  
"BLD",6971,1,25,0)
 This issue has caused the user to print reports and labels to 
"BLD",6971,1,26,0)
 unintended devices.
"BLD",6971,1,27,0)
  
"BLD",6971,1,28,0)
 HD0000000175185 concerns the Pick List Warning Message.  A user created 
"BLD",6971,1,29,0)
 a pick list with a stop date which was far into the future.  This made 
"BLD",6971,1,30,0)
 the pick list inaccessible, and the list could not be deleted.  A 
"BLD",6971,1,31,0)
 warning message will be displayed to the pharmacist if the pick list 
"BLD",6971,1,32,0)
 stop date is more than 7 days into the future.
"BLD",6971,4,0)
^9.64PA^^
"BLD",6971,6)
5^
"BLD",6971,6.3)
12
"BLD",6971,"KRN",0)
^9.67PA^8989.52^19
"BLD",6971,"KRN",.4,0)
.4
"BLD",6971,"KRN",.401,0)
.401
"BLD",6971,"KRN",.402,0)
.402
"BLD",6971,"KRN",.403,0)
.403
"BLD",6971,"KRN",.5,0)
.5
"BLD",6971,"KRN",.84,0)
.84
"BLD",6971,"KRN",3.6,0)
3.6
"BLD",6971,"KRN",3.8,0)
3.8
"BLD",6971,"KRN",9.2,0)
9.2
"BLD",6971,"KRN",9.8,0)
9.8
"BLD",6971,"KRN",9.8,"NM",0)
^9.68A^13^9
"BLD",6971,"KRN",9.8,"NM",1,0)
PSIVHYPL^^0^B42608112
"BLD",6971,"KRN",9.8,"NM",2,0)
PSIVHYPR^^0^B39800593
"BLD",6971,"KRN",9.8,"NM",4,0)
PSIVLABR^^0^B34113753
"BLD",6971,"KRN",9.8,"NM",6,0)
PSJEEU0^^0^B18332264
"BLD",6971,"KRN",9.8,"NM",7,0)
PSGFILED^^0^B24389200
"BLD",6971,"KRN",9.8,"NM",10,0)
PSJDDUT2^^0^B32882229
"BLD",6971,"KRN",9.8,"NM",11,0)
PSGPL^^0^B22020514
"BLD",6971,"KRN",9.8,"NM",12,0)
PSIVORLB^^0^B13180848
"BLD",6971,"KRN",9.8,"NM",13,0)
PSIVLABL^^0^B37326681
"BLD",6971,"KRN",9.8,"NM","B","PSGFILED",7)

"BLD",6971,"KRN",9.8,"NM","B","PSGPL",11)

"BLD",6971,"KRN",9.8,"NM","B","PSIVHYPL",1)

"BLD",6971,"KRN",9.8,"NM","B","PSIVHYPR",2)

"BLD",6971,"KRN",9.8,"NM","B","PSIVLABL",13)

"BLD",6971,"KRN",9.8,"NM","B","PSIVLABR",4)

"BLD",6971,"KRN",9.8,"NM","B","PSIVORLB",12)

"BLD",6971,"KRN",9.8,"NM","B","PSJDDUT2",10)

"BLD",6971,"KRN",9.8,"NM","B","PSJEEU0",6)

"BLD",6971,"KRN",19,0)
19
"BLD",6971,"KRN",19,"NM",0)
^9.68A^^0
"BLD",6971,"KRN",19.1,0)
19.1
"BLD",6971,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",6971,"KRN",101,0)
101
"BLD",6971,"KRN",409.61,0)
409.61
"BLD",6971,"KRN",771,0)
771
"BLD",6971,"KRN",870,0)
870
"BLD",6971,"KRN",8989.51,0)
8989.51
"BLD",6971,"KRN",8989.52,0)
8989.52
"BLD",6971,"KRN",8994,0)
8994
"BLD",6971,"KRN","B",.4,.4)

"BLD",6971,"KRN","B",.401,.401)

"BLD",6971,"KRN","B",.402,.402)

"BLD",6971,"KRN","B",.403,.403)

"BLD",6971,"KRN","B",.5,.5)

"BLD",6971,"KRN","B",.84,.84)

"BLD",6971,"KRN","B",3.6,3.6)

"BLD",6971,"KRN","B",3.8,3.8)

"BLD",6971,"KRN","B",9.2,9.2)

"BLD",6971,"KRN","B",9.8,9.8)

"BLD",6971,"KRN","B",19,19)

"BLD",6971,"KRN","B",19.1,19.1)

"BLD",6971,"KRN","B",101,101)

"BLD",6971,"KRN","B",409.61,409.61)

"BLD",6971,"KRN","B",771,771)

"BLD",6971,"KRN","B",870,870)

"BLD",6971,"KRN","B",8989.51,8989.51)

"BLD",6971,"KRN","B",8989.52,8989.52)

"BLD",6971,"KRN","B",8994,8994)

"BLD",6971,"QUES",0)
^9.62^^
"BLD",6971,"REQB",0)
^9.611^5^2
"BLD",6971,"REQB",3,0)
PSJ*5.0*154^1
"BLD",6971,"REQB",5,0)
PSJ*5.0*178^1
"BLD",6971,"REQB","B","PSJ*5.0*154",3)

"BLD",6971,"REQB","B","PSJ*5.0*178",5)

"MBREQ")
0
"PKG",203,-1)
1^1
"PKG",203,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",203,20,0)
^9.402P^^
"PKG",203,22,0)
^9.49I^1^1
"PKG",203,22,1,0)
5.0^2971215^2980417^1271
"PKG",203,22,1,"PAH",1,0)
184^3090820^33288
"PKG",203,22,1,"PAH",1,1,0)
^^32^32^3090820
"PKG",203,22,1,"PAH",1,1,1,0)
 HD0000000139263 involves multiple additives with values in the MESSAGE 
"PKG",203,22,1,"PAH",1,1,2,0)
 field (#14) of the IV ADDITIVES file (#52.6).  When an IV label 
"PKG",203,22,1,"PAH",1,1,3,0)
 prints, and the IV order contains multiple additives, if more than one 
"PKG",203,22,1,"PAH",1,1,4,0)
 additive has a MESSAGE field value, only the message of the first 
"PKG",203,22,1,"PAH",1,1,5,0)
 additive in the IV order will display on the label.  
"PKG",203,22,1,"PAH",1,1,6,0)
  
"PKG",203,22,1,"PAH",1,1,7,0)
 HD0000000139800 The CPRS Unit Dose report shows the status of the unit 
"PKG",203,22,1,"PAH",1,1,8,0)
 dose orders for a given patient.  If an order has the status 
"PKG",203,22,1,"PAH",1,1,9,0)
 "Discontinued due to Edit", nothing is displaying in the CPRS Unit 
"PKG",203,22,1,"PAH",1,1,10,0)
 Dose report's status field.  The problem is due to Inpatient Meds not 
"PKG",203,22,1,"PAH",1,1,11,0)
 sending CPRS the complete information for the status if the order was 
"PKG",203,22,1,"PAH",1,1,12,0)
 discontinued due to edit.
"PKG",203,22,1,"PAH",1,1,13,0)
  
"PKG",203,22,1,"PAH",1,1,14,0)
 HD0000000159948 Within Parameters Edit Menu [PSJ PARAM EDIT MENU], the 
"PKG",203,22,1,"PAH",1,1,15,0)
 option Clinic Definition [PSJ CD] asks the user for a CLINIC GROUP 
"PKG",203,22,1,"PAH",1,1,16,0)
 NAME.  This prompt is in error and the option should end if no new 
"PKG",203,22,1,"PAH",1,1,17,0)
 clinic is chosen for edit.   This issue has no negative impact on the 
"PKG",203,22,1,"PAH",1,1,18,0)
 patient but is an inconvenience to the user of the option.
"PKG",203,22,1,"PAH",1,1,19,0)
  
"PKG",203,22,1,"PAH",1,1,20,0)
 HD0000000168525 When exiting the option by typing an "^" up-arrow at the 
"PKG",203,22,1,"PAH",1,1,21,0)
 Report/Label device prompt in Site Parameters (IV) [PSJI SITE PARAMETERS]
"PKG",203,22,1,"PAH",1,1,22,0)
 option, the system will default "TELNET" into the field even though a 
"PKG",203,22,1,"PAH",1,1,23,0)
 value already exists. The software should retain the existing 
"PKG",203,22,1,"PAH",1,1,24,0)
 report/label device at this prompt and not change the default device.  
"PKG",203,22,1,"PAH",1,1,25,0)
 This issue has caused the user to print reports and labels to 
"PKG",203,22,1,"PAH",1,1,26,0)
 unintended devices.
"PKG",203,22,1,"PAH",1,1,27,0)
  
"PKG",203,22,1,"PAH",1,1,28,0)
 HD0000000175185 concerns the Pick List Warning Message.  A user created 
"PKG",203,22,1,"PAH",1,1,29,0)
 a pick list with a stop date which was far into the future.  This made 
"PKG",203,22,1,"PAH",1,1,30,0)
 the pick list inaccessible, and the list could not be deleted.  A 
"PKG",203,22,1,"PAH",1,1,31,0)
 warning message will be displayed to the pharmacist if the pick list 
"PKG",203,22,1,"PAH",1,1,32,0)
 stop date is more than 7 days into the future.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
9
"RTN","PSGFILED")
0^7^B24389200^B24370324
"RTN","PSGFILED",1,0)
PSGFILED ;BIR/CML3-VARIOUS FILES' UPKEEP ;16 Mar 99 / 10:22 AM
"RTN","PSGFILED",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**20,50,63,119,110,111,112,154,184**;16 DEC 97;Build 12
"RTN","PSGFILED",3,0)
 ;
"RTN","PSGFILED",4,0)
 ; Reference to ^PS(50.606 supported by DBIA# 2174.
"RTN","PSGFILED",5,0)
 ; Reference to ^PSDRUG supported by DBIA# 2192.
"RTN","PSGFILED",6,0)
 ; Reference to ^PS(59.7 is supported by DBIA# 2181.
"RTN","PSGFILED",7,0)
 ; Reference to ^PS(51 is supported by DBIA# 2176.
"RTN","PSGFILED",8,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSGFILED",9,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGFILED",10,0)
 ;
"RTN","PSGFILED",11,0)
DONE D ENKV^PSGSETU K D0,D1,D2,PSGRBS Q
"RTN","PSGFILED",12,0)
 ;
"RTN","PSGFILED",13,0)
GED ; generic edit
"RTN","PSGFILED",14,0)
 S DA=+Y,DR=".01;1" W ! D ^DIE Q
"RTN","PSGFILED",15,0)
 ;
"RTN","PSGFILED",16,0)
ENAT ; team file
"RTN","PSGFILED",17,0)
 F  S DIC="^PS(57.7,",DIC(0)="QEAMIL",DLAYGO=57.7,DIC("A")="Select WARD: " W ! D ^DIC K DIC,DLAYGO Q:Y'>0  S DA=+Y,DIE="^PS(57.7,",DR="[PSJUMATE]" D ^DIE
"RTN","PSGFILED",18,0)
 G DONE
"RTN","PSGFILED",19,0)
 ;
"RTN","PSGFILED",20,0)
ENAS ; schedules file - no longer used
"RTN","PSGFILED",21,0)
 ;
"RTN","PSGFILED",22,0)
ENMR ; med route file
"RTN","PSGFILED",23,0)
 NEW MRNO,MR K DIE,DIC,DR,Y
"RTN","PSGFILED",24,0)
 F  S DIC="^PS(51.2,",DIC(0)="QEAMIL",DLAYGO=51.2 W ! D ^DIC K DIC,DLAYGO Q:+Y'>0  S MRNO=+Y,MR=$P(Y,U,2),DA=+Y,DIE="^PS(51.2,",DR=".01;1;3;4" D ^DIE D DF
"RTN","PSGFILED",25,0)
 G DONE
"RTN","PSGFILED",26,0)
 ;
"RTN","PSGFILED",27,0)
ENWG ; ward group file
"RTN","PSGFILED",28,0)
 F  S DIC="^PS(57.5,",DIC(0)="QEAMIL",DLAYGO=57.5 W ! D ^DIC K DA,DIC,DR Q:+Y'>0  S DA=+Y,DIE="^PS(57.5,",DR="[PSJU WG]" D ^DIE
"RTN","PSGFILED",29,0)
 G DONE
"RTN","PSGFILED",30,0)
 ;
"RTN","PSGFILED",31,0)
ENMI ; medication instruction file
"RTN","PSGFILED",32,0)
 F  S DIC="^PS(51,",DIC(0)="QEAMIL",DLAYGO=51 W ! D ^DIC K DIC Q:+Y'>0  S DIE="^PS(51,",DA=+Y,DR=".01;1;30" D ^DIE
"RTN","PSGFILED",33,0)
 G DONE
"RTN","PSGFILED",34,0)
 ;
"RTN","PSGFILED",35,0)
ENDRG ; standard drug fields
"RTN","PSGFILED",36,0)
 D NOW^%DTC S PSGDT=% F  S DIC="^PSDRUG(",DIC(0)="AEIMOQ",DIC("A")="Select DISPENSE DRUG: " W ! D ^DIC K DIC Q:+Y'>0  D DE
"RTN","PSGFILED",37,0)
 K PSIUA,PSIUDA,PSIUX G DONE
"RTN","PSGFILED",38,0)
 ;
"RTN","PSGFILED",39,0)
DE ;
"RTN","PSGFILED",40,0)
 I $D(^PSDRUG(+Y,"I")),^("I"),^("I")<PSGDT W $C(7),$C(7),!!?3,"*** WARNING, THIS DRUG IS INACTIVE. ***",!
"RTN","PSGFILED",41,0)
 W ! S DIE="^PSDRUG(",(DA,PSIUDA)=+Y,DR="[PSJ FILED]"
"RTN","PSGFILED",42,0)
 S PSIUX="U^UNIT DOSE PHARMACY^1" D ^PSGIU,^DIE:PSIUA'["^" K DA,DIE,DR Q
"RTN","PSGFILED",43,0)
 ;
"RTN","PSGFILED",44,0)
ENOSE ; order set enter/edit
"RTN","PSGFILED",45,0)
 K DIC F  S DLAYGO=53.2,DIC="^PS(53.2,",DIC(0)="QEAML",DIC("A")="Select ORDER SET: " W ! D ^DIC K DIC Q:Y'>0  S DA=+Y S DIE="^PS(53.2,",DR="[PSJUOSE]" D ^DIE K D0,D1,DA,DIE,DR,PSGNEDFD,PSGS0XT,PSGS0Y
"RTN","PSGFILED",46,0)
 G DONE
"RTN","PSGFILED",47,0)
 ;
"RTN","PSGFILED",48,0)
RBCHK ; used to validate room-bed
"RTN","PSGFILED",49,0)
 ;No longer used.
"RTN","PSGFILED",50,0)
 ;F Z0=0:0 S Z0=$O(^PS(57.7,DA(2),1,Z0)) Q:'Z0  I Z0'=DA(1),$D(^(Z0,1,"B",X)) W !?19,X," is already under ",$S('$D(^PS(57.7,DA(2),1,Z0,0)):"another team ("_Z0_")!",$P(^(0),"^")]"":$P(^(0),"^")_"!",1:"another team ("_Z0_")!") Q
"RTN","PSGFILED",51,0)
 ;I 'Z0,$D(^DIC(42,DA(2),2,+$O(^DIC(42,DA(2),2,"B",$P(X,"-"),0)),1,"B",$P(X,"-",2))) K Z0 Q
"RTN","PSGFILED",52,0)
 ;K X,Z0 Q
"RTN","PSGFILED",53,0)
 ;
"RTN","PSGFILED",54,0)
RBQ ; show room-beds for a ward
"RTN","PSGFILED",55,0)
 ;No longer used.
"RTN","PSGFILED",56,0)
 Q
"RTN","PSGFILED",57,0)
 ;
"RTN","PSGFILED",58,0)
RBNP W """^"" TO STOP: " R Z3:DTIME W:'$T $C(7) S:'$T Z3="^" W $C(13),"            ",$C(13) Q
"RTN","PSGFILED",59,0)
 ;
"RTN","PSGFILED",60,0)
ENPPD ; edit pharmacy patient data
"RTN","PSGFILED",61,0)
 ; W !!?3,"...This option is still under development...",! Q
"RTN","PSGFILED",62,0)
 ;
"RTN","PSGFILED",63,0)
ENCPDD ; edit patient's default stop date (wall)
"RTN","PSGFILED",64,0)
 D ENCV^PSGSETU I $D(XQUIT) Q
"RTN","PSGFILED",65,0)
 F  D ENAO^PSGGAO Q:PSGP'>0  D
"RTN","PSGFILED",66,0)
 .S WDN=$P($G(^DPT(PSGP,.1)),"^") W:WDN="" !!?2,"The patient is not currently on a ward."
"RTN","PSGFILED",67,0)
 .I WDN]"" S WD=$O(^DIC(42,"B",WDN,0)),WD=$O(^PS(59.6,"B",+WD,0)) I $S('WD:1,1:'$P($G(^PS(59.6,WD,0)),"^",4)) S X="PLEASE NOTE: The 'SAME STOP DATE' parameter for the ward ("_WDN_") is not turned on.  Any date entered here will be ignored "
"RTN","PSGFILED",68,0)
 .I  S X=X_"until the parameter is turned on for this ward." W $C(7),!!?2 F Y=1:1:$L(X," ") S X(1)=$P(X," ",Y) W:$L(X(1))+$X>78 ! W X(1)," "
"RTN","PSGFILED",69,0)
 .S DA=PSGP,DR="62.01T",DIE="^PS(55," W !! D ^DIE
"RTN","PSGFILED",70,0)
 K WD,WDN G DONE
"RTN","PSGFILED",71,0)
 ;
"RTN","PSGFILED",72,0)
ENSYS ; edit system file
"RTN","PSGFILED",73,0)
 ;/S DIE="^PS(59.7,",DA=1,DR="21;26;26.3;26.4;26.2;20.412ALLOW THE CHANGE OF ORDER TYPES ON ORDERS FROM OERR;32"
"RTN","PSGFILED",74,0)
 S DIE="^PS(59.7,",DA=1,DR="21;26;26.3;26.4;26.2;26.5;26.6;26.7;34;27;27.1"
"RTN","PSGFILED",75,0)
 W ! D ^DIE K DIE,DA,DR Q
"RTN","PSGFILED",76,0)
 ;
"RTN","PSGFILED",77,0)
ENPLSP ; edit pick list site parameters
"RTN","PSGFILED",78,0)
 ;
"RTN","PSGFILED",79,0)
ENCS ; change current site & parameters
"RTN","PSGFILED",80,0)
 I $D(PSJSYSW0)#2 W !!,"Current site: ",$P(PSJSYSW0,"^")
"RTN","PSGFILED",81,0)
 S PSGCSF=1 D ^PSGSET,ENKV^PSGSETU W:$D(XQUIT) !!?5,"(The Inpatient site you are currently working under has not changed.)" K PSGCSF,PSGORSET,XQUIT Q
"RTN","PSGFILED",82,0)
 ;
"RTN","PSGFILED",83,0)
DF ; Add/edit Med route, instruction... to the Dosage form file.
"RTN","PSGFILED",84,0)
 S DIR("A")="Would you like to update the Dosage Form file"
"RTN","PSGFILED",85,0)
 S DIR("?")="If your answer is Yes, you will be able to Add/edit the Med routes, Instructions, Verb, Noun and Preposition that associate with this Dosage form."
"RTN","PSGFILED",86,0)
 S DIR(0)="Y",DIR("B")="Y" D ^DIR Q:Y'=1
"RTN","PSGFILED",87,0)
 NEW Y,DFNO K DIE,DIC,DA,DR
"RTN","PSGFILED",88,0)
 F  S DIC="^PS(50.606,",DIC(0)="QEAMI" D ^DIC Q:+Y'>0  S DFNO=+Y D
"RTN","PSGFILED",89,0)
 . I $G(MR)]"",'$D(^PS(50.606,DFNO,"MR","B",MRNO)) S DIE="^PS(50.606,",DR="1///"_MR,DA=DFNO D ^DIE
"RTN","PSGFILED",90,0)
 . K DIE,DIC,DR,MR S DIE="^PS(50.606,",DR="1;3;4;5",DA=DFNO D ^DIE
"RTN","PSGFILED",91,0)
 ;. K DIE,DIC,DR,MR S DIE="^PS(50.606,",DR="1;2;3;4;5",DA=DFNO D ^DIE
"RTN","PSGFILED",92,0)
 Q
"RTN","PSGFILED",93,0)
ENCD ;edit Clinic Definitions file
"RTN","PSGFILED",94,0)
 F  K DIC S DIC="^PS(53.46,",DIC(0)="AELMQ",DIC("A")="Select CLINIC: ",DLAYGO=53.46 D ^DIC K DIC Q:Y<0  D
"RTN","PSGFILED",95,0)
 . S DIE="^PS(53.46,",DA=+Y,DR="1;2;3" D ^DIE K DIE,DA,DR Q
"RTN","PSGFILED",96,0)
 Q
"RTN","PSGFILED",97,0)
ENCG ; ward group file0
"RTN","PSGFILED",98,0)
 F  S DIC="^PS(57.8,",DIC(0)="QEAMIL",DLAYGO=57.8 W ! D ^DIC K DA,DIC,DR Q:+Y'>0  S DA=+Y,DIE="^PS(57.8,",DR=".01;1" D ^DIE
"RTN","PSGFILED",99,0)
 G DONE
"RTN","PSGFILED",100,0)
 ;
"RTN","PSGPL")
0^11^B22020514^B20559253
"RTN","PSGPL",1,0)
PSGPL ;BIR/CML3-PICK LIST ;12 DEC 97 / 10:01 AM
"RTN","PSGPL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**50,184**;16 DEC 97;Build 12
"RTN","PSGPL",3,0)
 ;
"RTN","PSGPL",4,0)
 ; Reference to ^PS(59.7 is supported by DBIA #2181.
"RTN","PSGPL",5,0)
 ;
"RTN","PSGPL",6,0)
BEGIN ; get ward group, last pick list # for group, see if it's a rerun.
"RTN","PSGPL",7,0)
 ;    ND2 - 2 node of WARD GROUP file or WARD GROUP^^start date^stop date from pick list ) node
"RTN","PSGPL",8,0)
 ;    PSGPLG - pick list number      PSGPLWG - ward group number
"RTN","PSGPL",9,0)
 ;    PSGPLF - start date            PSGPLWGP - 5 node from WARD GROUP
"RTN","PSGPL",10,0)
 ;
"RTN","PSGPL",11,0)
 D ENCV^PSGSETU,NOW^%DTC S PSGDT=%,RERUN=0
"RTN","PSGPL",12,0)
 N PSJSITE,PSJPRN S PSJSITE=0,PSJSITE=$O(^PS(59.7,PSJSITE)) I $P($G(^(PSJSITE,26)),U,5)=1 S PSJPRN=1
"RTN","PSGPL",13,0)
 S DIC("S")="I $P(^(0),""^"",2)=""P""",DIC(0)="QEAMI",DIC="^PS(57.5," W ! D ^DIC K DIC G:Y'>0 DONE S PSGPLWG=+Y,ND2=$G(^PS(57.5,+Y,2)),PSGPLWGP=$G(^(5)),PSGPLG=+ND2
"RTN","PSGPL",14,0)
 I 'ND2,$D(^PS(53.5,"A",PSGPLWG)) F Q=0:0 S Q=$O(^PS(53.5,"A",PSGPLWG,Q)) Q:'Q  I '$O(^(Q)),$D(^PS(53.5,Q,0)) S ND2=$P(^(0),"^",2)_"^^"_$P(^(0),"^",3,4),PSGPLG=Q Q
"RTN","PSGPL",15,0)
 I PSGDT<$P(ND2,"^",3) D RERUN G UL:%<0,BEGIN:%=2
"RTN","PSGPL",16,0)
 I ND2]"" D DTEXST S PSGOD=$$ENDTC^PSGMI(PSGPLS) W !,"Start date/time for this pick list: ",PSGOD S MES="STOP" D GETSF G:Y<0 DONE S PSGPLF=Y G BOTH
"RTN","PSGPL",17,0)
 F MES="START","STOP" D GETSF G:Y<0 DONE
"RTN","PSGPL",18,0)
 ;
"RTN","PSGPL",19,0)
BOTH ;
"RTN","PSGPL",20,0)
 W ! F  L +^PS(53.5,0):1 I  S ND=$G(^PS(53.5,0)) S:ND="" ND="PICK LIST^53.5" Q
"RTN","PSGPL",21,0)
 F PSGPLG=$P(ND,"^",3)+1:1 I '$D(^PS(53.5,PSGPLG)) I $$LOCK^PSGPLUTL(PSGPLG,"PSGPL")  S $P(ND,"^",3)=PSGPLG,$P(ND,"^",4)=$P(ND,"^",4)+1,^PS(53.5,0)=ND Q
"RTN","PSGPL",22,0)
 L -^PS(53.5,0)
"RTN","PSGPL",23,0)
 D ENPL^PSGTI I $D(IO("Q")) G:'$D(ZTSK) UL W !!,"Pick list queued!" D SET G UL
"RTN","PSGPL",24,0)
 I POP W !!,"No device chosen for Pick List ",$E("re",1,RERUN),"run." G UL
"RTN","PSGPL",25,0)
 W !,"...this may take a while...(you really should QUEUE the pick list)..." D SET,EN^PSGPL1
"RTN","PSGPL",26,0)
 ;
"RTN","PSGPL",27,0)
UL ;
"RTN","PSGPL",28,0)
 D UNLOCK^PSGPLUTL(PSGPLG,"PSGPL")
"RTN","PSGPL",29,0)
 ;
"RTN","PSGPL",30,0)
DONE ;
"RTN","PSGPL",31,0)
 D ^%ZISC,ENKV^PSGSETU K AM,DIC,FD,FFF,MES,ND,ND2,OG,OS,POP,PSGION,PSGID,PSGOD,PSGPLF,PSGPLG,PSGPLS,PSGPLWG,PSGPLWGP,Q,RERUN,ST,XX,ZTOUT,PSGDT,EST Q
"RTN","PSGPL",32,0)
 ;
"RTN","PSGPL",33,0)
SET ;
"RTN","PSGPL",34,0)
 I RERUN S DIK="^PS(53.5,",DA=OG D ^DIK K DIK I $D(^PS(57.5,PSGPLWG,2)),+^(2)=OG S ^(2)=$P(^(2),"^",6,20)
"RTN","PSGPL",35,0)
 S ^PS(53.5,PSGPLG,0)=PSGPLG_"^"_PSGPLWG_"^"_PSGPLS_"^"_PSGPLF_"^^"_$P(PSGPLWGP,"^",1,3)_"^^^"_PSGDT_"^^"_$P(PSGPLWGP,"^",7),^PS(57.5,PSGPLWG,2)=PSGPLG_"^"_PSGDT_"^"_PSGPLS_"^"_PSGPLF_"^"_DUZ_"^"_$P(ND2,"^",1,15),^PS(53.5,"A",PSGPLWG,PSGPLG)=""
"RTN","PSGPL",36,0)
 S DIK="^PS(53.5,",DA=PSGPLG D IX^DIK K DIK Q
"RTN","PSGPL",37,0)
 ;
"RTN","PSGPL",38,0)
DTEXST ;
"RTN","PSGPL",39,0)
 S PSGPLS=$$EN^PSGCT($P(ND2,"^",4),1),X=$$ENDTC^PSGMI($P(ND2,"^",4)),Y=$$ENDTC^PSGMI($P(ND2,"^",3)),XX=$$ENDTC^PSGMI($P(ND2,"^",2))
"RTN","PSGPL",40,0)
 W !!,"The PICK LIST for this WARD GROUP was last run",$S(XX:" on "_XX,1:""),!,"   for ",Y," through ",X,!
"RTN","PSGPL",41,0)
 I $D(^PS(53.5,PSGPLG,0)),$P(^(0),"^",11),'$P(^(0),"^",9) W $C(7),$C(7),!,"*** THIS PICK LIST HAS NOT RUN TO COMPLETION. ***",!
"RTN","PSGPL",42,0)
 Q
"RTN","PSGPL",43,0)
 ;
"RTN","PSGPL",44,0)
GETSF ;
"RTN","PSGPL",45,0)
 K %DT S %DT="AERTX",%DT("A")="Enter "_MES_" date/time for this pick list: "
"RTN","PSGPL",46,0)
 I MES["O",$D(^PS(57.5,PSGPLWG,0)),$P(^(0),"^",3) S X=$$EN^PSGCT(PSGPLS,$P(^(0),"^",3)*60-1),Y=$$ENDD^PSGMI(X),%DT("B")=Y
"RTN","PSGPL",47,0)
GETSF1 D ^%DT I Y<0 W $C(7),!!,"This PICK LIST cannot be ",$E("re",1,RERUN),"run without a ",MES," date." Q
"RTN","PSGPL",48,0)
 S @($S(MES["O":"PSGPLF",1:"PSGPLS"))=Y
"RTN","PSGPL",49,0)
 I MES["O",(Y'>PSGPLS) W $C(7),!!,"*** Stop date must be greater than start date !! ***",! G GETSF1
"RTN","PSGPL",50,0)
 ;PSJ*5*184;Add warning message and prompt if stop date greater than 7 days in the future.
"RTN","PSGPL",51,0)
 N X,PSGPLSF S X1=PSGPLS,X2="7" D C^%DTC S PSGPLSF=X
"RTN","PSGPL",52,0)
 I MES["O",(Y>PSGPLSF) D  I %'=1 G GETSF1
"RTN","PSGPL",53,0)
 . W $C(7),!!,"*** WARNING: You're Attempting to run the Pick List for greater than 7 days ***",!
"RTN","PSGPL",54,0)
 . W !,"Are you Sure (Y/N):" S %=2 D YN^DICN
"RTN","PSGPL",55,0)
 . Q
"RTN","PSGPL",56,0)
 Q
"RTN","PSGPL",57,0)
 ;
"RTN","PSGPL",58,0)
RERUN ;
"RTN","PSGPL",59,0)
 I '$$LOCK^PSGPLUTL(PSGPLG,"PSGPL")  W $C(7),!!,"** THE NEXT PICK LIST FOR THIS WARD GROUP IS CURRENTLY RUNNING. **" S %=2 Q
"RTN","PSGPL",60,0)
 D DTEXST F  W !,"Do you want to rerun this pick list" S %=0 D YN^DICN Q:%  D:%Y]"" DTQ W:%Y="" $C(7),"  (Answer required.)"
"RTN","PSGPL",61,0)
 I %=1 S OG=PSGPLG,OS=$P(^PS(53.5,OG,0),"^",3),RERUN=2 S:+ND2=OG ND2=$P(ND2,"^",6,20) D UNLOCK^PSGPLUTL(PSGPLG,"PSGPL") Q
"RTN","PSGPL",62,0)
 D UNLOCK^PSGPLUTL(PSGPLG,"PSGPL") Q
"RTN","PSGPL",63,0)
 ;
"RTN","PSGPL",64,0)
DTQ ;
"RTN","PSGPL",65,0)
 W !!?2,"Enter a 'Y' to rerun this pick list.  Enter an 'N' (or '^') to NOT rerun this pick list.  NOTE: Rerunning a pick list deletes all of its old data.",! Q
"RTN","PSIVHYPL")
0^1^B42608112^B41785116
"RTN","PSIVHYPL",1,0)
PSIVHYPL ;BIR/PR-PRINT OUT LABELS ;26 FEB 97 / 3:20 PM
"RTN","PSIVHYPL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**58,96,128,178,184**;16 DEC 97;Build 12
"RTN","PSIVHYPL",3,0)
 ;
"RTN","PSIVHYPL",4,0)
 ; Reference to ^%ZIS(2 is supported by DBIA 3435.
"RTN","PSIVHYPL",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSIVHYPL",6,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVHYPL",7,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVHYPL",8,0)
 ; Reference to ^PS(50.4 is supported by DBIA 2175.
"RTN","PSIVHYPL",9,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSIVHYPL",10,0)
 ;
"RTN","PSIVHYPL",11,0)
 ;NEEDS DFN, ON AND PSIVNOL (Total number of labels to print) and
"RTN","PSIVHYPL",12,0)
 ;PSIVCT - $D(PSIVCT) NO COUNT LABEL
"RTN","PSIVHYPL",13,0)
SSWARD ;Get patient SS# and ward location
"RTN","PSIVHYPL",14,0)
 N X0,PSJIO,I
"RTN","PSIVHYPL",15,0)
 S I=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=^(I,0),PSJIO($P(X0,"^"))=^(1)
"RTN","PSIVHYPL",16,0)
 S PSJIO=$S('$D(PSJIO):0,1:1)
"RTN","PSIVHYPL",17,0)
 D ENIV^PSJAC S VADM(2)=$E(VADM(2),6,9),PSIVWD=$S(+VAIN(4):$P(VAIN(4),U,2),1:"Opt. IV")
"RTN","PSIVHYPL",18,0)
 G:PSIVNOL<1 Q D SETP,^PSIVHYP S PSIVRM=$P(PSIVSITE,U,13),P16=$P($G(^PS(55,DFN,"IV",+ON,9)),U,3) S:PSIVRM<1 PSIVRM=30 I $D(PSIVCT),PSIVCT'=1 K PSIVCT
"RTN","PSIVHYPL",19,0)
 I PSJIO,$G(PSJIO("FI"))]"" X PSJIO("FI")
"RTN","PSIVHYPL",20,0)
 I $P(PSIVSITE,U,7) D
"RTN","PSIVHYPL",21,0)
 . S PSIVFLAG=1,(LINE,PSIV1)=0,PSIV2=PSIVNOL,PSIVNOL=0 D RE
"RTN","PSIVHYPL",22,0)
 . S PSIVRP="",PSIVRT=""
"RTN","PSIVHYPL",23,0)
 . I $D(^PS(55,DFN,"IV",+ON,.2)) S PSIVRP=$P(^PS(55,DFN,"IV",+ON,.2),U,3) D
"RTN","PSIVHYPL",24,0)
 .. I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) Q   ;QUIT IF "DOSE DUE AT" LINE IS SET TO NOT PRINT
"RTN","PSIVHYPL",25,0)
 .. S PSIVRT=$P(^PS(51.2,PSIVRP,0),U,1)
"RTN","PSIVHYPL",26,0)
 .. S X="ROUTE: "_PSIVRT D:X]"" PMR
"RTN","PSIVHYPL",27,0)
 . S X="Solution: _______________" D PRNTL S X="Additive: _______________" D PRNTL
"RTN","PSIVHYPL",28,0)
 . S PSIVNOL=PSIV2
"RTN","PSIVHYPL",29,0)
 . I 'PSJIO F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVHYPL",30,0)
 . I PSJIO,$G(PSJIO("EL"))]"" X PSJIO("EL")
"RTN","PSIVHYPL",31,0)
 I '$D(PSIVCT) D NOW^%DTC S Y=%,$P(^PS(55,DFN,"IV",+ON,9),U,1,2)=Y_"^"_PSIVNOL,$P(^(9),U,3)=$P(^(9),U,3)+PSIVNOL
"RTN","PSIVHYPL",32,0)
 K PSIVFLAG,PSIVSH
"RTN","PSIVHYPL",33,0)
START F PSIV1=1:1:PSIVNOL D
"RTN","PSIVHYPL",34,0)
 . S LINE=0 D RE
"RTN","PSIVHYPL",35,0)
 . Q:$D(PSIVFLAG) 
"RTN","PSIVHYPL",36,0)
 . I 'PSJIO F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVHYPL",37,0)
 . I PSJIO,$G(PSJIO("EL"))]"" X PSJIO("EL")
"RTN","PSIVHYPL",38,0)
 I PSJIO,$G(PSJIO("FE"))]"" X PSJIO("FE")
"RTN","PSIVHYPL",39,0)
 D:'$D(PSIVCT) ^PSIVSTAT
"RTN","PSIVHYPL",40,0)
Q K HYPL,LINE,MESS,P16,PDATE,PDOSE,PSIV,PSIVA,PSIV1,PSIV2,PSIVCT,PSIVDOSE,PSIVFLAG,PSIVRM,PSIVWD,TVOL,HYPLPRT,PSIMESS Q
"RTN","PSIVHYPL",41,0)
RE I PSIV1 S:P(15)>2880!('P(15)) P(15)=2880 S P(16)=P16+PSIV1#(1440/P(15)+.5\1) S:'P(16) P(16)=1440/P(15)+.5\1
"RTN","PSIVHYPL",42,0)
 K DO
"RTN","PSIVHYPL",43,0)
 I PSJIO,$G(PSJIO("SL"))]"" X PSJIO("SL")
"RTN","PSIVHYPL",44,0)
 I PSIV1 S PSJBCID=$$BCMA^PSIVBCID(DFN,ON,$D(PSIVCT),$G(PSIV1),$G(PSIV2),$G(PSIVNOL)) D BARCODE
"RTN","PSIVHYPL",45,0)
 S X="["_$P(^PS(55,DFN,"IV",+ON,0),U)_"]"_" "_VADM(2)_"  "_PSIVWD_"  "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3) D PRNTL
"RTN","PSIVHYPL",46,0)
 S X=VADM(1) S:$P(PSIVSITE,U,9) X=X_"  "_$S(VAIN(5)]"":VAIN(5),1:"NF") D PRNTL S X=" " D PRNTL
"RTN","PSIVHYPL",47,0)
 D:$P(PSIVSITE,U,12) TVOL
"RTN","PSIVHYPL",48,0)
 S X="",$P(X,"=",PSIVRM-1)="" D PRNTL
"RTN","PSIVHYPL",49,0)
 I $D(PSIVFLAG) F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"AD",PSIV)) Q:'PSIV  S Y=^(PSIV,0),X=$S($D(^PS(52.6,+Y,0)):$P(^(0),U),1:"*********")_"  "_$P(Y,U,2)_" " S:$P(Y,U,3)]"" X=X_" ("_$P(Y,U,3)_")" D
"RTN","PSIVHYPL",50,0)
 . D PRNTL
"RTN","PSIVHYPL",51,0)
 . D MESS
"RTN","PSIVHYPL",52,0)
 I $D(PSIVFLAG) F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"SOL",PSIV)) Q:'PSIV  S PSIV=PSIV_"^"_+^(PSIV,0),YY=^(0) D
"RTN","PSIVHYPL",53,0)
 . D SOL1,PRNTL
"RTN","PSIVHYPL",54,0)
 . S X=$P(^PS(52.7,$P(PSIV,U,2),0),U,4) I X]"" S X="   "_X D PRNTL
"RTN","PSIVHYPL",55,0)
 G:$D(PSIVFLAG) SOL
"RTN","PSIVHYPL",56,0)
 F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"SOL",PSIV)) Q:'PSIV  S PSIV=PSIV_"^"_+^(PSIV,0),YY=^(0) D
"RTN","PSIVHYPL",57,0)
 . D SOL1,PRNTL I PSIV1 D UP3^PSIVBCID(DFN,PSJBLN,PSIV,YY)
"RTN","PSIVHYPL",58,0)
 . S X=$P(^PS(52.7,$P(PSIV,U,2),0),U,4) I X]"" S X="   "_X D PRNTL
"RTN","PSIVHYPL",59,0)
 F I=0:0 S I=$O(HYPL(I)) Q:'I  S PSIV="" D
"RTN","PSIVHYPL",60,0)
 . F I=I:0 S PSIV=$O(HYPL(I,PSIV)) Q:PSIV=""  S Y="",X=0 D
"RTN","PSIVHYPL",61,0)
 .. X "F ZZ=0:0 S Y=$O(HYPL(I,PSIV,Y)) Q:Y=""""  I Y=""ALL""!(Y=""***"")!(Y[P(16)) S X=X+$P(HYPL(I,PSIV,Y),U),PSIVP=HYPL(I,PSIV,Y) D UPD"
"RTN","PSIVHYPL",62,0)
 .. I X D HYP
"RTN","PSIVHYPL",63,0)
 K HYPAD
"RTN","PSIVHYPL",64,0)
SOL S X="",$P(X,"=",PSIVRM-1)="" D PRNTL
"RTN","PSIVHYPL",65,0)
 S X=" " D PRNTL I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) G MEDRT
"RTN","PSIVHYPL",66,0)
 S:'$D(PSIVDOSE) PSIVDOSE="" S X=$P(PSIVDOSE," ",PSIV1) D:$E(X)="." CONVER^PSIVLABL S X="Dose due at: "_$S(X="":"________",1:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)_" "_$E(X#1_"000",2,5)) D PRNTL
"RTN","PSIVHYPL",67,0)
 ;
"RTN","PSIVHYPL",68,0)
MEDRT ;Find Medication Route   
"RTN","PSIVHYPL",69,0)
 S PSIVRP="",PSIVRT=""
"RTN","PSIVHYPL",70,0)
 I $D(^PS(55,DFN,"IV",+ON,.2)) S PSIVRP=$P(^PS(55,DFN,"IV",+ON,.2),U,3) D
"RTN","PSIVHYPL",71,0)
 .S PSIVRT=$P(^PS(51.2,PSIVRP,0),U,1)
"RTN","PSIVHYPL",72,0)
 .S X="ROUTE: "_PSIVRT D:X]"" PMR
"RTN","PSIVHYPL",73,0)
 ;
"RTN","PSIVHYPL",74,0)
INF S X=$P(P(8),"@") D:X]"" PRNTL
"RTN","PSIVHYPL",75,0)
 I $D(^PS(55,DFN,"IV",+ON,3)) S X=$P(^(3),U) D:X]"" PRNTL
"RTN","PSIVHYPL",76,0)
 S X=P(9) D:X]"" PRNTL
"RTN","PSIVHYPL",77,0)
 S X=P(11) D:X]"" PRNTL
"RTN","PSIVHYPL",78,0)
 ;PSJ*5*184 - Display all messages if more than one additive has a message.
"RTN","PSIVHYPL",79,0)
 I $D(MESS) S PSIMESS="" F  S PSIMESS=$O(MESS(PSIMESS)) Q:PSIMESS=""  S X=PSIMESS D PRNTL
"RTN","PSIVHYPL",80,0)
 I $D(^PS(59.5,PSIVSN,4)) S Y=^(4) F PSIV=1:1 S X=$P(Y,U,PSIV) Q:X=""  D PRNTL
"RTN","PSIVHYPL",81,0)
 S X=PSIV1_"["_PSIVNOL_"]" D PRNTL
"RTN","PSIVHYPL",82,0)
 Q
"RTN","PSIVHYPL",83,0)
PRNTL N I F LINE=LINE+1:1 D  Q:$L(X)<1
"RTN","PSIVHYPL",84,0)
 . I LINE>PSIVSITE D
"RTN","PSIVHYPL",85,0)
 .. S LINE=1
"RTN","PSIVHYPL",86,0)
 .. I 'PSJIO D  Q
"RTN","PSIVHYPL",87,0)
 ... F ZZ=1:1 Q:ZZ>$P(PSIVSITE,"^",16)  W !
"RTN","PSIVHYPL",88,0)
 .. F I="EL","SL" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPL",89,0)
 . K ZZ
"RTN","PSIVHYPL",90,0)
 . F I="ST","STF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPL",91,0)
 . W $E(X,1,PSIVRM)
"RTN","PSIVHYPL",92,0)
 . F I="ETF","ET" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPL",93,0)
 . I 'PSJIO W !
"RTN","PSIVHYPL",94,0)
 . S X=$E(X,PSIVRM+1,999)
"RTN","PSIVHYPL",95,0)
 Q
"RTN","PSIVHYPL",96,0)
PMR ; Print Med Route on label
"RTN","PSIVHYPL",97,0)
 ;  
"RTN","PSIVHYPL",98,0)
 F LINE=LINE+1:1 D  Q:$L(X)<1
"RTN","PSIVHYPL",99,0)
 . I LINE>PSIVSITE D
"RTN","PSIVHYPL",100,0)
 .. S LINE=1
"RTN","PSIVHYPL",101,0)
 .. I 'PSJIO D  Q
"RTN","PSIVHYPL",102,0)
 ... F ZZ=1:1 Q:ZZ>$P(PSIVSITE,"^",16)  W !
"RTN","PSIVHYPL",103,0)
 .. F I="EL","SL" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPL",104,0)
 . K ZZ
"RTN","PSIVHYPL",105,0)
 . ;
"RTN","PSIVHYPL",106,0)
 . F I="ST","STF","SM","SMF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPL",107,0)
 . W $E(X,1,PSIVRM)
"RTN","PSIVHYPL",108,0)
 . F I="ETF","ET","EMF","EM" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPL",109,0)
 . I 'PSJIO W !
"RTN","PSIVHYPL",110,0)
 . S X=$E(X,PSIVRM+1,999)
"RTN","PSIVHYPL",111,0)
 Q
"RTN","PSIVHYPL",112,0)
TVOL ;
"RTN","PSIVHYPL",113,0)
 S PSIV=TVOL F X=0:0 S X=$O(^PS(55,DFN,"IV",+ON,"AD",X)) Q:'X  S X=X_"^"_^(X,0) S:$P(X,U,4)[P(16)!($P(X,U,4)="")!'PSIV1 PSIV=PSIV+$S($P(^PS(52.6,$P(X,U,2),0),U,10):$P(X,U,3)/$P(^(0),U,10),1:0)
"RTN","PSIVHYPL",114,0)
 S X="Total Volume: "_(PSIV+.5\1) D PRNTL
"RTN","PSIVHYPL",115,0)
 Q
"RTN","PSIVHYPL",116,0)
SOL1 S X=$S($D(^PS(52.7,$P(PSIV,U,2),0)):$P(^(0),U)_" "_$P(^PS(55,DFN,"IV",+ON,"SOL",+PSIV,0),U,2),1:"**********") Q
"RTN","PSIVHYPL",117,0)
HYP ;
"RTN","PSIVHYPL",118,0)
 I PSIV="*" S X="*** Error in "_$S(I=50.4:"electrolyte",I=52.7:"solution",1:"additive") D PRNTL Q
"RTN","PSIVHYPL",119,0)
 S PSIVA=$S(I=50.4:PSIV,I=52.7:+$G(^PS(55,DFN,"IV",+ON,"SOL",PSIV,0)),1:+$G(^PS(55,DFN,"IV",+ON,"AD",PSIV,0)))
"RTN","PSIVHYPL",120,0)
 S X=$S($D(^PS(I,PSIVA,0)):$P(^(0),U),1:"Undefined "_$S(I=50.4:"electrolyte",I=52.7:"solution",1:"additive"))_" "_$S(X<1:"0"_(X+.005\.01/100),1:(X+.005\.01/100))_" "_$P($P(HYPL(I,PSIV,$O(HYPL(I,PSIV,""))),U)," ",2)
"RTN","PSIVHYPL",121,0)
 D PRNTL
"RTN","PSIVHYPL",122,0)
 Q
"RTN","PSIVHYPL",123,0)
SETP S Y=^PS(55,DFN,"IV",+ON,0) F X=1:1:23 S P(X)=$P(Y,U,X)
"RTN","PSIVHYPL",124,0)
 Q
"RTN","PSIVHYPL",125,0)
MESS ;PSJ*5*184 -make MESS a local array so all messages display for all additives.
"RTN","PSIVHYPL",126,0)
 I $P(^PS(52.6,+Y,0),U,9)]"" S MESS($P(^PS(52.6,+Y,0),U,9))=""
"RTN","PSIVHYPL",127,0)
 Q
"RTN","PSIVHYPL",128,0)
UPD N X,Y,PSIVEL,PSIVAD
"RTN","PSIVHYPL",129,0)
 S PSIVEL=$P(PSIVP,"^",2)
"RTN","PSIVHYPL",130,0)
 I I=50.4 F PSIVAD=0:0 S PSIVAD=$O(HYPLRPT(PSIVEL,"AD",PSIVAD)) Q:'PSIVAD  D
"RTN","PSIVHYPL",131,0)
 .I $D(HYPAD(+PSIVAD)) Q
"RTN","PSIVHYPL",132,0)
 .S YY=$G(^PS(55,DFN,"IV",+ON,"AD",+PSIVAD,0))
"RTN","PSIVHYPL",133,0)
 .S HYPAD(+PSIVAD)=""
"RTN","PSIVHYPL",134,0)
 .I +$P(YY,U,3),(+$P(YY,U,3)'=P(16)) Q
"RTN","PSIVHYPL",135,0)
 .D UP2^PSIVBCID(DFN,PSJBLN,PSIV,YY)
"RTN","PSIVHYPL",136,0)
 I I'=50.4 S YY=$G(^PS(55,DFN,"IV",+ON,"AD",+PSIV,0)) D UP2^PSIVBCID(DFN,PSJBLN,PSIV,YY)
"RTN","PSIVHYPL",137,0)
 Q
"RTN","PSIVHYPL",138,0)
BARCODE D PSET^%ZISP
"RTN","PSIVHYPL",139,0)
 I 'PSJIO D
"RTN","PSIVHYPL",140,0)
 . I IOBARON]"" W @IOBARON
"RTN","PSIVHYPL",141,0)
 . W PSJBCID
"RTN","PSIVHYPL",142,0)
 . I IOBAROFF]"" W @IOBAROFF
"RTN","PSIVHYPL",143,0)
 . W !
"RTN","PSIVHYPL",144,0)
 I PSJIO D
"RTN","PSIVHYPL",145,0)
 . F I="SB","SBF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPL",146,0)
 . W PSJBCID
"RTN","PSIVHYPL",147,0)
 . F I="EBF","EB" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPL",148,0)
 Q
"RTN","PSIVHYPR")
0^2^B39800593^B39015292
"RTN","PSIVHYPR",1,0)
PSIVHYPR ;BIR/PR-REPRINT LABELS ;26 FEB 97 / 3:20 PM
"RTN","PSIVHYPR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**58,88,96,178,184**;16 DEC 97;Build 12
"RTN","PSIVHYPR",3,0)
 ;
"RTN","PSIVHYPR",4,0)
 ; Reference to ^%ZIS(2 is supported by DBIA 3435.
"RTN","PSIVHYPR",5,0)
 ; Reference to ^PS(50.4 is supported by DBIA 2175.
"RTN","PSIVHYPR",6,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSIVHYPR",7,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVHYPR",8,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVHYPR",9,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSIVHYPR",10,0)
 ;
"RTN","PSIVHYPR",11,0)
 ;NEEDS DFN, ON AND PSIVNOL (Total number of labels to print) and
"RTN","PSIVHYPR",12,0)
 ;PSIVCT - $D(PSIVCT) NO COUNT LABEL
"RTN","PSIVHYPR",13,0)
SSWARD ;Get patient SS# and ward location
"RTN","PSIVHYPR",14,0)
 N X0,PSJIO,I
"RTN","PSIVHYPR",15,0)
 S I=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=^(I,0),PSJIO($P(X0,"^"))=^(1)
"RTN","PSIVHYPR",16,0)
 S PSJIO=$S('$D(PSJIO):0,1:1)
"RTN","PSIVHYPR",17,0)
 D ENIV^PSJAC S VADM(2)=$E(VADM(2),6,9),PSIVWD=$S(+VAIN(4):$P(VAIN(4),U,2),1:"Opt. IV")
"RTN","PSIVHYPR",18,0)
 ;;NEW PSIVNOL,PSIV1 S (PSIVNOL,PSIV1)=1
"RTN","PSIVHYPR",19,0)
 NEW PSIV1 S PSIV1=1
"RTN","PSIVHYPR",20,0)
 G:PSIVNOL<1 Q D SETP,PSIVHYP S PSIVRM=$P(PSIVSITE,U,13),P16=$P($G(^PS(55,DFN,"IV",+ON,9)),U,3) S:PSIVRM<1 PSIVRM=30 I $D(PSIVCT),PSIVCT'=1 K PSIVCT
"RTN","PSIVHYPR",21,0)
 I PSJIO,$G(PSJIO("FI"))]"" X PSJIO("FI")
"RTN","PSIVHYPR",22,0)
 ;PSJRPHD is defined in REPRT^PSIVLBRP
"RTN","PSIVHYPR",23,0)
 I $P(PSIVSITE,U,7),'$D(PSJRPHD) D
"RTN","PSIVHYPR",24,0)
 . S PSIVFLAG=1,(LINE,PSIV1)=0,PSIV2=PSIVNOL,PSIVNOL=0 D RE
"RTN","PSIVHYPR",25,0)
 . S PSIVRP="",PSIVRT=""
"RTN","PSIVHYPR",26,0)
 . I $D(^PS(55,DFN,"IV",+ON,.2)) S PSIVRP=$P(^PS(55,DFN,"IV",+ON,.2),U,3) D
"RTN","PSIVHYPR",27,0)
 .. I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) Q   ;QUIT IF "DOSE DUE AT" IS SET TO NOT PRINT
"RTN","PSIVHYPR",28,0)
 .. S PSIVRT=$P(^PS(51.2,PSIVRP,0),U,1)
"RTN","PSIVHYPR",29,0)
 .. S X="ROUTE: "_PSIVRT D:X]"" PMR
"RTN","PSIVHYPR",30,0)
 . S X="Solution: _______________" D PRNTL S X="Additive: _______________" D PRNTL
"RTN","PSIVHYPR",31,0)
 . S PSIVNOL=PSIV2
"RTN","PSIVHYPR",32,0)
 . I 'PSJIO F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVHYPR",33,0)
 . I PSJIO F I="EL","FE" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",34,0)
 I '$D(PSIVCT) D NOW^%DTC S Y=%,$P(^PS(55,DFN,"IV",+ON,9),U,1,2)=Y_"^"_PSIVNOL,$P(^(9),U,3)=$P(^(9),U,3)+1
"RTN","PSIVHYPR",35,0)
 K PSIVFLAG,PSIVSH
"RTN","PSIVHYPR",36,0)
START S PSIV1=1,LINE=0 D RE D
"RTN","PSIVHYPR",37,0)
 . Q:$D(PSIVFLAG) 
"RTN","PSIVHYPR",38,0)
 . I 'PSJIO F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVHYPR",39,0)
 . I PSJIO,$G(PSJIO("EL"))]"" X PSJIO("EL")
"RTN","PSIVHYPR",40,0)
 I PSJIO,$G(PSJIO("FE"))]"" X PSJIO("FE")
"RTN","PSIVHYPR",41,0)
 ;;D:'$D(PSIVCT) ^PSIVSTAT
"RTN","PSIVHYPR",42,0)
 I '$D(PSIVCT) D ^PSIVSTAT S P(16)=P(16)+PSIVNOL
"RTN","PSIVHYPR",43,0)
Q K HYPL,LINE,MESS,P16,PDATE,PDOSE,PSIV,PSIVA,PSIV1,PSIV2,PSIVCT,PSIVDOSE,PSIVFLAG,PSIVRM,PSIVWD,TVOL,PSIMESS Q
"RTN","PSIVHYPR",44,0)
RE ;I PSIV1 S:P(15)>2880!('P(15)) P(15)=2880 S P(16)=P16+PSIV1#(1440/P(15)+.5\1) S:'P(16) P(16)=1440/P(15)+.5\1
"RTN","PSIVHYPR",45,0)
 I PSJIO,$G(PSJIO("SL"))]"" X PSJIO("SL")
"RTN","PSIVHYPR",46,0)
 I PSIV1 D BARCODE
"RTN","PSIVHYPR",47,0)
 S X="["_$P(^PS(55,DFN,"IV",+ON,0),U)_"]"_" "_VADM(2)_"  "_PSIVWD_"  "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3) D PRNTL
"RTN","PSIVHYPR",48,0)
 S X=VADM(1) S:$P(PSIVSITE,U,9) X=X_"  "_$S(VAIN(5)]"":VAIN(5),1:"NF") D PRNTL S X=" " D PRNTL
"RTN","PSIVHYPR",49,0)
 D:$P(PSIVSITE,U,12) TVOL
"RTN","PSIVHYPR",50,0)
 S X="",$P(X,"=",PSIVRM-1)="" D PRNTL
"RTN","PSIVHYPR",51,0)
 I $D(PSIVFLAG) F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"AD",PSIV)) Q:'PSIV  S Y=^(PSIV,0),X=$S($D(^PS(52.6,+Y,0)):$P(^(0),U),1:"*********")_" "_$P(Y,U,2)_" " S:$P(Y,U,3)]"" X=X_" ("_$P(Y,U,3)_")" D
"RTN","PSIVHYPR",52,0)
 . D PRNTL,MESS
"RTN","PSIVHYPR",53,0)
 I $D(PSIVFLAG) F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"SOL",PSIV)) Q:'PSIV  S PSIV=PSIV_"^"_+^(PSIV,0),YY=^(0) D
"RTN","PSIVHYPR",54,0)
 . D SOL1,PRNTL
"RTN","PSIVHYPR",55,0)
 . S X=$P(^PS(52.7,$P(PSIV,U,2),0),U,4) I X]"" S X="   "_X D PRNTL
"RTN","PSIVHYPR",56,0)
 G:$D(PSIVFLAG) SOL
"RTN","PSIVHYPR",57,0)
 F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IVBCMA",PSJIDNO,"SOL",PSIV)) Q:'PSIV  S PSIV=PSIV_"^"_+^(PSIV,0),YY=^(0) D
"RTN","PSIVHYPR",58,0)
 . D SOL1,PRNTL
"RTN","PSIVHYPR",59,0)
 . S X=$P(^PS(52.7,$P(PSIV,U,2),0),U,4) I X]"" S X="   "_X D PRNTL
"RTN","PSIVHYPR",60,0)
 F I=0:0 S I=$O(HYPL(I)) Q:'I  S PSIV="" F I=I:0 S PSIV=$O(HYPL(I,PSIV)) Q:PSIV=""  D
"RTN","PSIVHYPR",61,0)
 . F Z="" S Z=$O(HYPL(I,PSIV,Z)) Q:Z=""  S PSIVA=$S(I=50.4:PSIV,I=52.7:+^PS(55,DFN,"IVBCMA",PSJIDNO,"SOL",+$P(HYPL(I,PSIV,Z),U,2),0),1:+^PS(55,DFN,"IVBCMA",PSJIDNO,"AD",+$P(HYPL(I,PSIV,Z),U,2),0)) D HYP
"RTN","PSIVHYPR",62,0)
SOL S X="",$P(X,"=",PSIVRM-1)="" D PRNTL
"RTN","PSIVHYPR",63,0)
 S X=" " D PRNTL I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) G MEDRT
"RTN","PSIVHYPR",64,0)
 S:'$D(PSIVDOSE) PSIVDOSE="" S X=$P(PSIVDOSE," ",PSIV1) D:$E(X)="." CONVER^PSIVLABL S X="Dose due at: "_$S(X="":"________",1:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)_" "_$E(X#1_"000",2,5)) D PRNTL
"RTN","PSIVHYPR",65,0)
 ;
"RTN","PSIVHYPR",66,0)
MEDRT ;Find Medication Route   
"RTN","PSIVHYPR",67,0)
 S PSIVRP="",PSIVRT=""
"RTN","PSIVHYPR",68,0)
 I $D(^PS(55,DFN,"IV",+ON,.2)) S PSIVRP=$P(^PS(55,DFN,"IV",+ON,.2),U,3) D
"RTN","PSIVHYPR",69,0)
 .S PSIVRT=$P(^PS(51.2,PSIVRP,0),U,1)
"RTN","PSIVHYPR",70,0)
 .S X="ROUTE: "_PSIVRT D:X]"" PMR
"RTN","PSIVHYPR",71,0)
 ;
"RTN","PSIVHYPR",72,0)
INF S X=$P(P(8),"@") D:X]"" PRNTL
"RTN","PSIVHYPR",73,0)
 I $D(^PS(55,DFN,"IV",+ON,3)) S X=$P(^(3),U) D:X]"" PRNTL
"RTN","PSIVHYPR",74,0)
 S X=P(9) D:X]"" PRNTL
"RTN","PSIVHYPR",75,0)
 S X=P(11) D:X]"" PRNTL
"RTN","PSIVHYPR",76,0)
 ;PSJ*5*184 - Display all messages if more than one additive has a message.
"RTN","PSIVHYPR",77,0)
 I $D(MESS) S PSIMESS="" F  S PSIMESS=$O(MESS(PSIMESS)) Q:PSIMESS=""  S X=PSIMESS D PRNTL
"RTN","PSIVHYPR",78,0)
 I $D(^PS(59.5,PSIVSN,4)) S Y=^(4) F PSIV=1:1 S X=$P(Y,U,PSIV) Q:X=""  D PRNTL
"RTN","PSIVHYPR",79,0)
 S X=$S('+$G(PSIV1):"0[0]",1:PSIVBAG) D PRNTL
"RTN","PSIVHYPR",80,0)
 Q
"RTN","PSIVHYPR",81,0)
PRNTL N I F LINE=LINE+1:1 D  Q:$L(X)<1
"RTN","PSIVHYPR",82,0)
 . I LINE>PSIVSITE D
"RTN","PSIVHYPR",83,0)
 .. S LINE=1
"RTN","PSIVHYPR",84,0)
 .. I 'PSJIO D  Q
"RTN","PSIVHYPR",85,0)
 ... F ZZ=1:1 Q:ZZ>$P(PSIVSITE,"^",16)  W !
"RTN","PSIVHYPR",86,0)
 .. F I="EL","SL" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",87,0)
 . K ZZ
"RTN","PSIVHYPR",88,0)
 . F I="ST","STF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",89,0)
 . W $E(X,1,PSIVRM)
"RTN","PSIVHYPR",90,0)
 . F I="ETF","ET" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",91,0)
 . I 'PSJIO W !
"RTN","PSIVHYPR",92,0)
 . S X=$E(X,PSIVRM+1,999)
"RTN","PSIVHYPR",93,0)
 Q
"RTN","PSIVHYPR",94,0)
PMR ; Print Med Route on label
"RTN","PSIVHYPR",95,0)
 F LINE=LINE+1:1 D  Q:$L(X)<1
"RTN","PSIVHYPR",96,0)
 . I LINE>PSIVSITE D
"RTN","PSIVHYPR",97,0)
 .. S LINE=1
"RTN","PSIVHYPR",98,0)
 .. I 'PSJIO D  Q
"RTN","PSIVHYPR",99,0)
 ... F ZZ=1:1 Q:ZZ>$P(PSIVSITE,"^",16)  W !
"RTN","PSIVHYPR",100,0)
 .. F I="EL","SL" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",101,0)
 . K ZZ
"RTN","PSIVHYPR",102,0)
 . ;
"RTN","PSIVHYPR",103,0)
 . F I="ST","STF","SM","SMF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",104,0)
 . W $E(X,1,PSIVRM)
"RTN","PSIVHYPR",105,0)
 . F I="ETF","ET","EMF","EM" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",106,0)
 . I 'PSJIO W !
"RTN","PSIVHYPR",107,0)
 . S X=$E(X,PSIVRM+1,999)
"RTN","PSIVHYPR",108,0)
 Q 
"RTN","PSIVHYPR",109,0)
 ;
"RTN","PSIVHYPR",110,0)
TVOL ;
"RTN","PSIVHYPR",111,0)
 S PSIV=TVOL F X=0:0 S X=$O(^PS(55,DFN,"IVBCMA",PSJIDNO,"AD",X)) Q:'X  S X=X_"^"_^(X,0) S:$P(X,U,4)[P(16)!($P(X,U,4)="")!'PSIV1 PSIV=PSIV+$S($P(^PS(52.6,$P(X,U,2),0),U,10):$P(X,U,3)/$P(^(0),U,10),1:0)
"RTN","PSIVHYPR",112,0)
 S X="Total Volume: "_(PSIV+.5\1) D PRNTL
"RTN","PSIVHYPR",113,0)
 Q
"RTN","PSIVHYPR",114,0)
SOL1 S X=$S($D(^PS(52.7,$P(PSIV,U,2),0)):$P(^(0),U)_" "_$P(^PS(55,DFN,"IVBCMA",PSJIDNO,"SOL",+PSIV,0),U,2),1:"**********") Q
"RTN","PSIVHYPR",115,0)
HYP ;
"RTN","PSIVHYPR",116,0)
 I PSIV="*" S X="*** Error in "_$S(I=50.4:"electrolyte",I=52.7:"solution",1:"additive") D PRNTL Q
"RTN","PSIVHYPR",117,0)
 S X=+HYPL(I,PSIV,Z)
"RTN","PSIVHYPR",118,0)
 S X=$S($D(^PS(I,PSIVA,0)):$P(^(0),U),1:"Undefined "_$S(I=50.4:"electrolyte",I=52.7:"solution",1:"additive"))_" "_(X+.005\.01/100)_" "_$P($P(HYPL(I,PSIV,Z),U)," ",2)
"RTN","PSIVHYPR",119,0)
 D PRNTL
"RTN","PSIVHYPR",120,0)
 Q
"RTN","PSIVHYPR",121,0)
SETP S Y=^PS(55,DFN,"IV",+ON,0) F X=1:1:23 S P(X)=$P(Y,U,X)
"RTN","PSIVHYPR",122,0)
 Q
"RTN","PSIVHYPR",123,0)
MESS ;PSJ*5*184 -make MESS a local array so all messages display for all additives.
"RTN","PSIVHYPR",124,0)
 I $P(^PS(52.6,+Y,0),U,9)]"" S MESS($P(^PS(52.6,+Y,0),U,9))=""
"RTN","PSIVHYPR",125,0)
 Q
"RTN","PSIVHYPR",126,0)
BARCODE D PSET^%ZISP
"RTN","PSIVHYPR",127,0)
 I 'PSJIO D
"RTN","PSIVHYPR",128,0)
 . I IOBARON]"" W @IOBARON
"RTN","PSIVHYPR",129,0)
 . W PSJBCID
"RTN","PSIVHYPR",130,0)
 . I IOBAROFF]"" W @IOBAROFF
"RTN","PSIVHYPR",131,0)
 . W !
"RTN","PSIVHYPR",132,0)
 I PSJIO D
"RTN","PSIVHYPR",133,0)
 . F I="SB","SBF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",134,0)
 . W PSJBCID
"RTN","PSIVHYPR",135,0)
 . F I="EBF","EB" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",136,0)
 Q
"RTN","PSIVHYPR",137,0)
PSIVHYP ;
"RTN","PSIVHYPR",138,0)
 K HYPL S TVOL=0 F Z=52.6,52.7 F DRG=0:0 S DRG=$O(^PS(55,DFN,"IVBCMA",PSJIDNO,$S(Z=52.6:"AD",1:"SOL"),DRG)) Q:'DRG  S DRG=DRG_"^"_^(DRG,0) S $P(DRG,"^",4)="ALL" D DRG^PSIVHYP
"RTN","PSIVHYPR",139,0)
 S TVOL=TVOL+.5\1 K EL,DRG,NAD,Z
"RTN","PSIVHYPR",140,0)
 Q
"RTN","PSIVLABL")
0^13^B37326681^B36555447
"RTN","PSIVLABL",1,0)
PSIVLABL ;BIR/PR-PRINT OUT LABELS ; 8/19/09 3:00pm
"RTN","PSIVLABL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**58,82,104,127,178,184**;16 DEC 97;Build 12
"RTN","PSIVLABL",3,0)
 ;
"RTN","PSIVLABL",4,0)
 ; Reference to ^%ZIS(2 is supported by DBIA 3435.
"RTN","PSIVLABL",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSIVLABL",6,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVLABL",7,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVLABL",8,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSIVLABL",9,0)
 ;
"RTN","PSIVLABL",10,0)
 ;Needs DFN,ON, and PSIVNOL NOTE: If PSIVCT is defined then we do
"RTN","PSIVLABL",11,0)
 ;not count labels in the STATs file or increment cummulative doses or
"RTN","PSIVLABL",12,0)
 ;the last fill field.
"RTN","PSIVLABL",13,0)
 ;PSIVCT will be defined if reprinting scheduled labels, the suspense
"RTN","PSIVLABL",14,0)
 ;list, or if printing individual labels and they do not count.
"RTN","PSIVLABL",15,0)
 ;
"RTN","PSIVLABL",16,0)
DEM ;Get demographics and see if label is example only
"RTN","PSIVLABL",17,0)
 N X0,PSJIO,I
"RTN","PSIVLABL",18,0)
 S I=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSJIO($P(X0,"^"))=^(1)
"RTN","PSIVLABL",19,0)
 S PSJIO=$S('$D(PSJIO):0,1:1)
"RTN","PSIVLABL",20,0)
 D ENIV^PSJAC,NOW^%DTC S PSIVNOW=$$ENDTC^PSGMI(%),VADM(2)=$E(VADM(2),6,9),PSIVWD=$S(+VAIN(4):$P(VAIN(4),U,2),1:"Opt. IV") I $D(PSIVEXAM) G ENX
"RTN","PSIVLABL",21,0)
 ;
"RTN","PSIVLABL",22,0)
 G:PSIVNOL<1 Q D SETP S PSIVRM=$P(PSIVSITE,U,13),P16=$P($G(^PS(55,DFN,"IV",+ON,9)),U,3) S:PSIVRM<1 PSIVRM=30 I $D(PSIVCT),PSIVCT'=1 K PSIVCT
"RTN","PSIVLABL",23,0)
 I PSJIO,$G(PSJIO("FI"))]"" X PSJIO("FI")
"RTN","PSIVLABL",24,0)
 I $P(PSIVSITE,U,7) D
"RTN","PSIVLABL",25,0)
 . S PSIVFLAG=1,(LINE,PSIV1)=0,PSIV2=PSIVNOL,PSIVNOL=0 D RE
"RTN","PSIVLABL",26,0)
 . S PSIVRP="",PSIVRT=""
"RTN","PSIVLABL",27,0)
 . I $D(^PS(55,DFN,"IV",+ON,.2)) S PSIVRP=$P(^PS(55,DFN,"IV",+ON,.2),U,3) D
"RTN","PSIVLABL",28,0)
 .. I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) Q   ;DO NOT PRINT ROUTE IF "DOSE DUE AT" IS SET TO NOT PRINT.
"RTN","PSIVLABL",29,0)
 .. S PSIVRT=$P(^PS(51.2,PSIVRP,0),U,1)
"RTN","PSIVLABL",30,0)
 .. S X="ROUTE: "_PSIVRT D:X]"" PMR
"RTN","PSIVLABL",31,0)
 . S X="Solution: _______________" D P S X="Additive: _______________" D P
"RTN","PSIVLABL",32,0)
 . S PSIVNOL=PSIV2
"RTN","PSIVLABL",33,0)
 . I 'PSJIO F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVLABL",34,0)
 . I PSJIO,$G(PSJIO("EL"))]"" X PSJIO("EL")
"RTN","PSIVLABL",35,0)
 I '$D(PSIVCT) D NOW^%DTC S Y=%,$P(^PS(55,DFN,"IV",+ON,9),U,1,2)=Y_"^"_PSIVNOL,$P(^(9),U,3)=$P(^(9),U,3)+PSIVNOL
"RTN","PSIVLABL",36,0)
 K PSIVFLAG,PSIVSH G START
"RTN","PSIVLABL",37,0)
SETP S Y=^PS(55,DFN,"IV",+ON,0) F X=1:1:23 S P(X)=$P(Y,U,X)
"RTN","PSIVLABL",38,0)
 Q
"RTN","PSIVLABL",39,0)
ENX ;Print example label
"RTN","PSIVLABL",40,0)
 D SETP S PSIVFLAG=1,PSIVRM=$P(PSIVSITE,U,13) S:PSIVRM<1 PSIVRM=30
"RTN","PSIVLABL",41,0)
START F PSIV1=1:1:PSIVNOL D
"RTN","PSIVLABL",42,0)
 . S LINE=0 D RE
"RTN","PSIVLABL",43,0)
 . Q:$D(PSIVFLAG)
"RTN","PSIVLABL",44,0)
 . I 'PSJIO F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVLABL",45,0)
 . I PSJIO,$G(PSJIO("EL"))]"" X PSJIO("EL")
"RTN","PSIVLABL",46,0)
 I PSJIO,$G(PSJIO("FE"))]"" X PSJIO("FE")
"RTN","PSIVLABL",47,0)
 D:'$D(PSIVCT) ^PSIVSTAT
"RTN","PSIVLABL",48,0)
Q K PSIV,PSIVDOSE,PSIVWD,P16,LINE,MESS,PSIVCT,PSIV2,PSIVFLAG,PSIVRM,PSIV1,PDOSE,PDATE,XX1,XX2,BAG,CX,PSIMESS Q
"RTN","PSIVLABL",49,0)
RE ;
"RTN","PSIVLABL",50,0)
 K DO
"RTN","PSIVLABL",51,0)
 I PSIV1,P(4)="A"!(P(5)=0) S P(16)=PSIV1 I $G(PSIVT)]"" D
"RTN","PSIVLABL",52,0)
 . S:P(15)>2880!('P(15)) P(15)=2880 S P(16)=P16+PSIV1#(1440/P(15)+.5\1) S:'P(16) P(16)=PSIV1
"RTN","PSIVLABL",53,0)
 I PSIV1 S PSJBCID=$$BCMA^PSIVBCID(DFN,ON,$D(PSIVCT),$G(PSIV1),$G(PSIV2),$G(PSIVNOL))
"RTN","PSIVLABL",54,0)
 ;* Only if prt from ward or man list then store BCMA ID to set xref for
"RTN","PSIVLABL",55,0)
 ;* reprint later
"RTN","PSIVLABL",56,0)
 I PSIV1,$G(PSIVWMFL) S PSIVID($P(PSJBCID,"V",2))=""
"RTN","PSIVLABL",57,0)
 I PSJIO,$G(PSJIO("SL"))]"" X PSJIO("SL")
"RTN","PSIVLABL",58,0)
 I PSIV1 D BARCODE
"RTN","PSIVLABL",59,0)
 S X="["_$P(^PS(55,DFN,"IV",+ON,0),U)_"]"_" "_VADM(2)_"  "_PSIVWD_"  "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3) D P
"RTN","PSIVLABL",60,0)
 S X=VADM(1) S:$P(PSIVSITE,U,9) X=X_"  "_$S(VAIN(5)]"":VAIN(5),1:"NF") D P S X=" " D P
"RTN","PSIVLABL",61,0)
 I $D(PSIVFLAG) F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"AD",PSIV)) Q:'PSIV  S Y=^(PSIV,0),X=$S($D(^PS(52.6,+Y,0)):$P(^(0),"^"),1:"*********")_" "_$P(Y,U,2)_" " S:$P(Y,U,3)]"" X=X_" ("_$P(Y,U,3)_")" D
"RTN","PSIVLABL",62,0)
 . D P
"RTN","PSIVLABL",63,0)
 . ;I PSIV1 S YY=Y D UP2^PSIVBCID(DFN,PSJBLN,PSIV,YY) S Y=YY
"RTN","PSIVLABL",64,0)
 . D MESS
"RTN","PSIVLABL",65,0)
 G:$D(PSIVFLAG) SOL
"RTN","PSIVLABL",66,0)
 ; IV BOTTLE functionality, 3rd piece of PS(55,DFN,"IV",+ON,"AD",PSIV,0) dictates labels per LABEL RUN on which the additive will print
"RTN","PSIVLABL",67,0)
 F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"AD",PSIV)) Q:'PSIV  S Y=^(PSIV,0),X=$S($D(^PS(52.6,+Y,0)):$P(^(0),U),1:"********")_" "_$P(Y,U,2) I ","_$P(Y,U,3)_","[(","_P(16)_",")!('$P(Y,U,3)) D
"RTN","PSIVLABL",68,0)
 . D P
"RTN","PSIVLABL",69,0)
 . I PSIV1 S YY=Y D UP2^PSIVBCID(DFN,PSJBLN,PSIV,YY) S Y=YY
"RTN","PSIVLABL",70,0)
 . D MESS
"RTN","PSIVLABL",71,0)
 ;
"RTN","PSIVLABL",72,0)
SOL F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"SOL",PSIV)) Q:'PSIV  S PSIV=PSIV_"^"_+^(PSIV,0),YY=^(0) D
"RTN","PSIVLABL",73,0)
 . D SOL1,P I PSIV1 D UP3^PSIVBCID(DFN,PSJBLN,PSIV,YY)
"RTN","PSIVLABL",74,0)
 . S X=$P(^PS(52.7,$P(PSIV,U,2),0),U,4) I X]"" S X="   "_X D P
"RTN","PSIVLABL",75,0)
 I P(23)'=""!(P(4)="S") S X="In Syringe: "_$E($P(^PS(55,DFN,"IV",+ON,2),U,4),1,25) D:P(4)="S"!(P(23)="S") P S X="*CAUTION* - CHEMOTHERAPY" D:P(23)'="" P
"RTN","PSIVLABL",76,0)
 S X=" " D P I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) G MEDRT
"RTN","PSIVLABL",77,0)
 S:'$D(PSIVDOSE) PSIVDOSE="" S X=$P(PSIVDOSE," ",PSIV1) D:$E(X)="." CONVER S X="Dose due at: "_$S(X="":"________",1:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)_" "_$E(X#1_"000",2,5)) D P
"RTN","PSIVLABL",78,0)
 ;
"RTN","PSIVLABL",79,0)
MEDRT ;Find Medication Route   
"RTN","PSIVLABL",80,0)
 S PSIVRP="",PSIVRT=""
"RTN","PSIVLABL",81,0)
 I $D(^PS(55,DFN,"IV",+ON,.2)) S PSIVRP=$P(^PS(55,DFN,"IV",+ON,.2),U,3) D
"RTN","PSIVLABL",82,0)
 .S PSIVRT=$P(^PS(51.2,PSIVRP,0),U,1)
"RTN","PSIVLABL",83,0)
 .S X="ROUTE: "_PSIVRT D:X]"" PMR
"RTN","PSIVLABL",84,0)
 ;
"RTN","PSIVLABL",85,0)
INF S X=$P(P(8),"@") D:X]"" P
"RTN","PSIVLABL",86,0)
 I $D(^PS(55,DFN,"IV",+ON,3)) S X=$P(^(3),"^") D:X]"" P
"RTN","PSIVLABL",87,0)
 S X=P(9) D:X]"" P
"RTN","PSIVLABL",88,0)
 S X=P(11) D:X]"" P
"RTN","PSIVLABL",89,0)
 ;PSJ*5*184 - Display all messages if more than one additive has a message.
"RTN","PSIVLABL",90,0)
 I $D(MESS) S PSIMESS="" F  S PSIMESS=$O(MESS(PSIMESS)) Q:PSIMESS=""  S X=PSIMESS D P
"RTN","PSIVLABL",91,0)
 I $D(^PS(59.5,PSIVSN,4)) S Y=^(4) F PSIV=1:1 S X=$P(Y,U,PSIV) Q:X=""  D P
"RTN","PSIVLABL",92,0)
 S X=PSIV1_"["_$S(PSIV1:PSIVNOL,1:PSIV2)_"]"_"  "_$S('PSIV1:PSIVNOW,1:"") D P
"RTN","PSIVLABL",93,0)
 Q
"RTN","PSIVLABL",94,0)
 ;
"RTN","PSIVLABL",95,0)
P F LINE=LINE+1:1 D  Q:$L(X)<1
"RTN","PSIVLABL",96,0)
 . I LINE>PSIVSITE D
"RTN","PSIVLABL",97,0)
 .. S LINE=1
"RTN","PSIVLABL",98,0)
 .. I 'PSJIO D  Q
"RTN","PSIVLABL",99,0)
 ... F ZZ=1:1 Q:ZZ>$P(PSIVSITE,"^",16)  W !
"RTN","PSIVLABL",100,0)
 .. F I="EL","SL" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",101,0)
 . K ZZ
"RTN","PSIVLABL",102,0)
 . F I="ST","STF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",103,0)
 . W $E(X,1,PSIVRM)
"RTN","PSIVLABL",104,0)
 . F I="ETF","ET" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",105,0)
 . I 'PSJIO W !
"RTN","PSIVLABL",106,0)
 . S X=$E(X,PSIVRM+1,999)
"RTN","PSIVLABL",107,0)
 Q
"RTN","PSIVLABL",108,0)
PMR ; Print Med Route on label
"RTN","PSIVLABL",109,0)
 ;  
"RTN","PSIVLABL",110,0)
 F LINE=LINE+1:1 D  Q:$L(X)<1
"RTN","PSIVLABL",111,0)
 . I LINE>PSIVSITE D
"RTN","PSIVLABL",112,0)
 .. S LINE=1
"RTN","PSIVLABL",113,0)
 .. I 'PSJIO D  Q
"RTN","PSIVLABL",114,0)
 ... F ZZ=1:1 Q:ZZ>$P(PSIVSITE,"^",16)  W !
"RTN","PSIVLABL",115,0)
 .. F I="EL","SL" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",116,0)
 . K ZZ
"RTN","PSIVLABL",117,0)
 . ;
"RTN","PSIVLABL",118,0)
 . F I="ST","STF","SM","SMF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",119,0)
 . W $E(X,1,PSIVRM)
"RTN","PSIVLABL",120,0)
 . F I="ETF","ET","EMF","EM" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",121,0)
 . I 'PSJIO W !
"RTN","PSIVLABL",122,0)
 . S X=$E(X,PSIVRM+1,999)
"RTN","PSIVLABL",123,0)
 Q
"RTN","PSIVLABL",124,0)
 ;               
"RTN","PSIVLABL",125,0)
SOL1 S X=$S($D(^PS(52.7,$P(PSIV,U,2),0)):$P(^(0),"^")_" "_$P(^PS(55,DFN,"IV",+ON,"SOL",+PSIV,0),U,2),1:"**********") Q
"RTN","PSIVLABL",126,0)
MESS ;PSJ*5*184 -make MESS a local array so all messages display for all additives.
"RTN","PSIVLABL",127,0)
 I $P(^PS(52.6,+Y,0),U,9)]"" S MESS($P(^PS(52.6,+Y,0),U,9))=""
"RTN","PSIVLABL",128,0)
 Q
"RTN","PSIVLABL",129,0)
CONVER ;Expand dose to date.dose and set in X
"RTN","PSIVLABL",130,0)
 I P(15)>1440 S X=$$CONVER1^PSIVORE2($P(PSIVDOSE," "),P(15),(PSIV1-1)) Q
"RTN","PSIVLABL",131,0)
 S PDOSE=X S:PSIV1=2 PDATE=$E($P(PSIVDOSE," "),1,7)
"RTN","PSIVLABL",132,0)
 I $P(PSIVDOSE," ",PSIV1-1)#1'<PDOSE!(P(15)>1440) S:$D(X1) XX1=X1 S:$D(X2) XX2=X2 S X1=PDATE,X2=1 D C^%DTC S PDATE=X,X=X_PDOSE S:$D(XX1) X1=XX1 S:$D(XX2) X2=XX2 Q
"RTN","PSIVLABL",133,0)
 S X=PDATE_PDOSE
"RTN","PSIVLABL",134,0)
 Q
"RTN","PSIVLABL",135,0)
BARCODE D PSET^%ZISP
"RTN","PSIVLABL",136,0)
 I 'PSJIO D
"RTN","PSIVLABL",137,0)
 . I IOBARON]"" W @IOBARON
"RTN","PSIVLABL",138,0)
 . W PSJBCID
"RTN","PSIVLABL",139,0)
 . I IOBAROFF]"" W @IOBAROFF
"RTN","PSIVLABL",140,0)
 . W !
"RTN","PSIVLABL",141,0)
 I PSJIO D
"RTN","PSIVLABL",142,0)
 . F I="SB","SBF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",143,0)
 . W PSJBCID
"RTN","PSIVLABL",144,0)
 . F I="EBF","EB" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",145,0)
 Q
"RTN","PSIVLABR")
0^4^B34113753^B33354776
"RTN","PSIVLABR",1,0)
PSIVLABR ;BIR/PR-REPRINT LABELS ;30 May 2001  12:36 PM
"RTN","PSIVLABR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**58,82,178,184**;16 DEC 97;Build 12
"RTN","PSIVLABR",3,0)
 ;
"RTN","PSIVLABR",4,0)
 ; Reference to ^%ZIS(2 is supported by DBIA 3435.
"RTN","PSIVLABR",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSIVLABR",6,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVLABR",7,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVLABR",8,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178. 
"RTN","PSIVLABR",9,0)
 ;
"RTN","PSIVLABR",10,0)
 ;Needs DFN,ON, and PSIVNOL NOTE: If PSIVCT is defined then we do
"RTN","PSIVLABR",11,0)
 ;not count labels in the STATs file or increment cummulative doses or
"RTN","PSIVLABR",12,0)
 ;the last fill field.
"RTN","PSIVLABR",13,0)
 ;PSIVCT will be defined if reprinting scheduled labels, the suspense
"RTN","PSIVLABR",14,0)
 ;list, or if printing individual labels and they do not count.
"RTN","PSIVLABR",15,0)
 ;
"RTN","PSIVLABR",16,0)
DEM ;Get demographics and see if label is example only
"RTN","PSIVLABR",17,0)
 N X0,PSJIO,I
"RTN","PSIVLABR",18,0)
 S I=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSJIO($P(X0,"^"))=^(1)
"RTN","PSIVLABR",19,0)
 S PSJIO=$S('$D(PSJIO):0,1:1)
"RTN","PSIVLABR",20,0)
 D ENIV^PSJAC,NOW^%DTC S PSIVNOW=$$ENDTC^PSGMI(%),VADM(2)=$E(VADM(2),6,9),PSIVWD=$S(+VAIN(4):$P(VAIN(4),U,2),1:"Opt. IV") I $D(PSIVEXAM) G ENX
"RTN","PSIVLABR",21,0)
 ;
"RTN","PSIVLABR",22,0)
 ;;NEW PSIVNOL,PSIV1 S (PSIVNOL,PSIV1)=1
"RTN","PSIVLABR",23,0)
 NEW PSIV1 S PSIV1=1
"RTN","PSIVLABR",24,0)
 G:PSIVNOL<1 Q D SETP S PSIVRM=$P(PSIVSITE,U,13),P16=$P($G(^PS(55,DFN,"IV",+ON,9)),U,3) S:PSIVRM<1 PSIVRM=30 I $D(PSIVCT),PSIVCT'=1 K PSIVCT
"RTN","PSIVLABR",25,0)
 I PSJIO,$G(PSJIO("FI"))]"" X PSJIO("FI")
"RTN","PSIVLABR",26,0)
 ;PSJRPHD is defined in REPRT^PSIVLBRP so header only print once.
"RTN","PSIVLABR",27,0)
 I $P(PSIVSITE,U,7),'$D(PSJRPHD) D
"RTN","PSIVLABR",28,0)
 . S PSIVFLAG=1,(LINE,PSIV1)=0,PSIV2=PSIVNOL,PSIVNOL=0 D RE
"RTN","PSIVLABR",29,0)
 . S PSIVRP="",PSIVRT=""
"RTN","PSIVLABR",30,0)
 . I $D(^PS(55,DFN,"IV",+ON,.2)) S PSIVRP=$P(^PS(55,DFN,"IV",+ON,.2),U,3) D
"RTN","PSIVLABR",31,0)
 .. I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) Q   ;QUIT IF "DOSE DUE AT" IS SET TO NOT PRINT
"RTN","PSIVLABR",32,0)
 .. S PSIVRT=$P(^PS(51.2,PSIVRP,0),U,1)
"RTN","PSIVLABR",33,0)
 .. S X="ROUTE: "_PSIVRT D:X]"" PMR
"RTN","PSIVLABR",34,0)
 . S X="Solution: _______________" D P S X="Additive: _______________" D P
"RTN","PSIVLABR",35,0)
 . S PSIVNOL=PSIV2
"RTN","PSIVLABR",36,0)
 . I 'PSJIO F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVLABR",37,0)
 . I PSJIO,$G(PSJIO("EL"))]"" X PSJIO("EL")
"RTN","PSIVLABR",38,0)
 ;;I '$D(PSIVCT) D NOW^%DTC S Y=%,$P(^PS(55,DFN,"IV",+ON,9),U,1,2)=Y_"^"_PSIVNOL,$P(^(9),U,3)=$P(^(9),U,3)+PSIVNOL
"RTN","PSIVLABR",39,0)
 I '$D(PSIVCT) D NOW^%DTC S Y=%,$P(^PS(55,DFN,"IV",+ON,9),U,1,2)=Y_"^"_PSIVNOL,$P(^(9),U,3)=$P(^(9),U,3)+1
"RTN","PSIVLABR",40,0)
 K PSIVFLAG,PSIVSH G START
"RTN","PSIVLABR",41,0)
SETP S Y=^PS(55,DFN,"IV",+ON,0) F X=1:1:23 S P(X)=$P(Y,U,X)
"RTN","PSIVLABR",42,0)
 Q
"RTN","PSIVLABR",43,0)
ENX ;Print example label
"RTN","PSIVLABR",44,0)
 D SETP S PSIVFLAG=1,PSIVRM=$P(PSIVSITE,U,13) S:PSIVRM<1 PSIVRM=30
"RTN","PSIVLABR",45,0)
START S PSIV1=1,LINE=0 D RE D
"RTN","PSIVLABR",46,0)
 . Q:$D(PSIVFLAG) 
"RTN","PSIVLABR",47,0)
 . I 'PSJIO F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVLABR",48,0)
 . I PSJIO,$G(PSJIO("EL"))]"" X PSJIO("EL")
"RTN","PSIVLABR",49,0)
 I PSJIO,$G(PSJIO("FE"))]"" X PSJIO("FE")
"RTN","PSIVLABR",50,0)
 D:'$D(PSIVCT) ^PSIVSTAT
"RTN","PSIVLABR",51,0)
Q K PSIV,PSIVDOSE,PSIVCT,PSIVWD,P16,LINE,MESS,PSIV2,PSIVFLAG,PSIVRM,PSIV1,PDOSE,PDATE,XX1,XX2,BAG,CX,PSIMESS Q
"RTN","PSIVLABR",52,0)
RE ;
"RTN","PSIVLABR",53,0)
 ;NEED THE CODE BELOW?
"RTN","PSIVLABR",54,0)
 ;;I PSIV1,P(4)="A"!(P(5)=0) S:P(15)>2880!('P(15)) P(15)=2880 S P(16)=P16+PSIV1#(1440/P(15)+.5\1) S:'P(16) P(16)=PSIV1
"RTN","PSIVLABR",55,0)
 I PSJIO,$G(PSJIO("SL"))]"" X PSJIO("SL")
"RTN","PSIVLABR",56,0)
 I PSIV1 D BARCODE
"RTN","PSIVLABR",57,0)
 S X="["_$P(^PS(55,DFN,"IV",+ON,0),U)_"]"_" "_VADM(2)_"  "_PSIVWD_"  "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3) D P
"RTN","PSIVLABR",58,0)
 S X=VADM(1) S:$P(PSIVSITE,U,9) X=X_"  "_$S(VAIN(5)]"":VAIN(5),1:"NF") D P S X=" " D P
"RTN","PSIVLABR",59,0)
 I $D(PSIVFLAG) F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"AD",PSIV)) Q:'PSIV  S Y=^(PSIV,0),X=$S($D(^PS(52.6,+Y,0)):$P(^(0),"^"),1:"*********")_" "_$P(Y,U,2)_" " S:$P(Y,U,3)]"" X=X_" ("_$P(Y,U,3)_")" D
"RTN","PSIVLABR",60,0)
 . D P,MESS
"RTN","PSIVLABR",61,0)
 G:$D(PSIVFLAG) SOL
"RTN","PSIVLABR",62,0)
 F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IVBCMA",PSJIDNO,"AD",PSIV)) Q:'PSIV  S Y=^(PSIV,0),X=$S($D(^PS(52.6,+Y,0)):$P(^(0),U),1:"********")_" "_$P(Y,U,2) D
"RTN","PSIVLABR",63,0)
 . D P,MESS
"RTN","PSIVLABR",64,0)
SOL F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IVBCMA",PSJIDNO,"SOL",PSIV)) Q:'PSIV  S PSIV=PSIV_"^"_+^(PSIV,0),YY=^(0) D
"RTN","PSIVLABR",65,0)
 . D SOL1,P
"RTN","PSIVLABR",66,0)
 . S X=$P(^PS(52.7,$P(PSIV,U,2),0),U,4) I X]"" S X="   "_X D P
"RTN","PSIVLABR",67,0)
 I P(23)'=""!(P(4)="S") S X="In Syringe: "_$E($P(^PS(55,DFN,"IV",+ON,2),U,4),1,25) D:P(4)="S"!(P(23)="S") P S X="*CAUTION* - CHEMOTHERAPY" D:P(23)'="" P
"RTN","PSIVLABR",68,0)
 S X=" " D P I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) G MEDRT
"RTN","PSIVLABR",69,0)
 S:'$D(PSIVDOSE) PSIVDOSE="" S X=$P(PSIVDOSE," ",PSIV1) D:$E(X)="." CONVER S X="Dose due at: "_$S(X="":"________",1:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)_" "_$E(X#1_"000",2,5)) D P
"RTN","PSIVLABR",70,0)
 ;
"RTN","PSIVLABR",71,0)
MEDRT ;Find Medication Route   
"RTN","PSIVLABR",72,0)
 S PSIVRP="",PSIVRT=""
"RTN","PSIVLABR",73,0)
 I $D(^PS(55,DFN,"IV",+ON,.2)) S PSIVRP=$P(^PS(55,DFN,"IV",+ON,.2),U,3) D
"RTN","PSIVLABR",74,0)
 .S PSIVRT=$P(^PS(51.2,PSIVRP,0),U,1)
"RTN","PSIVLABR",75,0)
 .S X="ROUTE: "_PSIVRT D:X]"" PMR
"RTN","PSIVLABR",76,0)
 ;
"RTN","PSIVLABR",77,0)
INF S X=$P(P(8),"@") D:X]"" P
"RTN","PSIVLABR",78,0)
 I $D(^PS(55,DFN,"IV",+ON,3)) S X=$P(^(3),"^") D:X]"" P
"RTN","PSIVLABR",79,0)
 S X=P(9) D:X]"" P
"RTN","PSIVLABR",80,0)
 S X=P(11) D:X]"" P
"RTN","PSIVLABR",81,0)
 ;PSJ*5*184 - Display all messages if more than one additive has a message.
"RTN","PSIVLABR",82,0)
 I $D(MESS) S PSIMESS="" F  S PSIMESS=$O(MESS(PSIMESS)) Q:PSIMESS=""  S X=PSIMESS D P
"RTN","PSIVLABR",83,0)
 I $D(^PS(59.5,PSIVSN,4)) S Y=^(4) F PSIV=1:1 S X=$P(Y,U,PSIV) Q:X=""  D P
"RTN","PSIVLABR",84,0)
 ;S X=PSIV1_"["_$S(PSIV1:PSIVNOL,1:PSIV2)_"]"_"  "_$S('PSIV1:PSIVNOW,1:"") D P
"RTN","PSIVLABR",85,0)
 S X=PSIVBAG D P
"RTN","PSIVLABR",86,0)
 Q
"RTN","PSIVLABR",87,0)
P F LINE=LINE+1:1 D  Q:$L(X)<1
"RTN","PSIVLABR",88,0)
 . I LINE>PSIVSITE D
"RTN","PSIVLABR",89,0)
 .. S LINE=1
"RTN","PSIVLABR",90,0)
 .. I 'PSJIO D  Q
"RTN","PSIVLABR",91,0)
 ... F ZZ=1:1 Q:ZZ>$P(PSIVSITE,"^",16)  W !
"RTN","PSIVLABR",92,0)
 .. F I="EL","SL" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABR",93,0)
 . K ZZ
"RTN","PSIVLABR",94,0)
 . F I="ST","STF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABR",95,0)
 . W $E(X,1,PSIVRM)
"RTN","PSIVLABR",96,0)
 . F I="ETF","ET" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABR",97,0)
 . I 'PSJIO W !
"RTN","PSIVLABR",98,0)
 . S X=$E(X,PSIVRM+1,999)
"RTN","PSIVLABR",99,0)
 Q
"RTN","PSIVLABR",100,0)
PMR ; Print Med Route on label
"RTN","PSIVLABR",101,0)
 ;
"RTN","PSIVLABR",102,0)
 F LINE=LINE+1:1 D  Q:$L(X)<1
"RTN","PSIVLABR",103,0)
 . I LINE>PSIVSITE D
"RTN","PSIVLABR",104,0)
 .. S LINE=1
"RTN","PSIVLABR",105,0)
 .. I 'PSJIO D  Q
"RTN","PSIVLABR",106,0)
 ... F ZZ=1:1 Q:ZZ>$P(PSIVSITE,"^",16)  W !
"RTN","PSIVLABR",107,0)
 .. F I="EL","SL" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABR",108,0)
 . K ZZ
"RTN","PSIVLABR",109,0)
 . ;
"RTN","PSIVLABR",110,0)
 . F I="ST","STF","SM","SMF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABR",111,0)
 . W $E(X,1,PSIVRM)
"RTN","PSIVLABR",112,0)
 . F I="ETF","ET","EMF","EM" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABR",113,0)
 . I 'PSJIO W !
"RTN","PSIVLABR",114,0)
 . S X=$E(X,PSIVRM+1,999)
"RTN","PSIVLABR",115,0)
 Q
"RTN","PSIVLABR",116,0)
SOL1 S X=$S($D(^PS(52.7,$P(PSIV,U,2),0)):$P(^(0),"^")_" "_$P(^PS(55,DFN,"IVBCMA",PSJIDNO,"SOL",+PSIV,0),U,2),1:"**********") Q
"RTN","PSIVLABR",117,0)
MESS ;PSJ*5*184 -make MESS a local array so all messages display for all additives.
"RTN","PSIVLABR",118,0)
 I $P(^PS(52.6,+Y,0),U,9)]"" S MESS($P(^PS(52.6,+Y,0),U,9))=""
"RTN","PSIVLABR",119,0)
 Q
"RTN","PSIVLABR",120,0)
CONVER ;Expand dose to date.dose and set in X
"RTN","PSIVLABR",121,0)
 I P(15)>1440 S X=$$CONVER1^PSIVORE2($P(PSIVDOSE," "),P(15),(PSIV1-1)) Q
"RTN","PSIVLABR",122,0)
 S PDOSE=X S:PSIV1=2 PDATE=$E($P(PSIVDOSE," "),1,7)
"RTN","PSIVLABR",123,0)
 I $P(PSIVDOSE," ",PSIV1-1)#1'<PDOSE!(P(15)>1440) S:$D(X1) XX1=X1 S:$D(X2) XX2=X2 S X1=PDATE,X2=1 D C^%DTC S PDATE=X,X=X_PDOSE S:$D(XX1) X1=XX1 S:$D(XX2) X2=XX2 Q
"RTN","PSIVLABR",124,0)
 S X=PDATE_PDOSE
"RTN","PSIVLABR",125,0)
 Q
"RTN","PSIVLABR",126,0)
BARCODE D PSET^%ZISP
"RTN","PSIVLABR",127,0)
 I 'PSJIO D
"RTN","PSIVLABR",128,0)
 . I IOBARON]"" W @IOBARON
"RTN","PSIVLABR",129,0)
 . W PSJBCID
"RTN","PSIVLABR",130,0)
 . I IOBAROFF]"" W @IOBAROFF
"RTN","PSIVLABR",131,0)
 . W !
"RTN","PSIVLABR",132,0)
 I PSJIO D
"RTN","PSIVLABR",133,0)
 . F I="SB","SBF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABR",134,0)
 . W PSJBCID
"RTN","PSIVLABR",135,0)
 . F I="EBF","EB" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABR",136,0)
 Q
"RTN","PSIVORLB")
0^12^B13180848^B12692692
"RTN","PSIVORLB",1,0)
PSIVORLB ;BIR/MLM-PRINT OUT LABELS ; 8/5/08 9:22am
"RTN","PSIVORLB",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**58,184**;16 DEC 97;Build 12
"RTN","PSIVORLB",3,0)
 ;
"RTN","PSIVORLB",4,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSIVORLB",5,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVORLB",6,0)
 ;
"RTN","PSIVORLB",7,0)
ENX ;Print example label
"RTN","PSIVORLB",8,0)
 D FULL^VALM1
"RTN","PSIVORLB",9,0)
 S PSIVFLAG=1,PSIVRM=$P(PSIVSITE,U,13) S:PSIVRM<1 PSIVRM=30 D:$E(P("OT"))="I" ORFLDS^PSIVEDT1 W:$E(P("OT"))'="I" !,"Med Route: ",$P(P("MR"),U,2),!
"RTN","PSIVORLB",10,0)
START F PSIV1=1:1:PSIVNOL S LINE=0 D RE I '$D(PSIVFLAG) F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVORLB",11,0)
Q K PSIVDOSE,P16,LINE,MESS,PSIVCT,PSIV2,PSIVFLAG,PSIVRM,PSIV1,PDOSE,PDATE,XX1,XX2,BAG,CX,PSIMESS Q
"RTN","PSIVORLB",12,0)
RE ;
"RTN","PSIVORLB",13,0)
 D:'$D(VADM(2)) DEM^VADPT
"RTN","PSIVORLB",14,0)
 I PSIV1,P(4)="A"!(P(5)=0) S:P(15)>2880!('P(15)) P(15)=2880 S P(16)=P16+PSIV1#(1440/P(15)+.5\1) S:'P(16) P(16)=1440/P(15)+.5\1
"RTN","PSIVORLB",15,0)
 W DFN,!
"RTN","PSIVORLB",16,0)
 S X=$S(P("PON")["V":"["_+P("PON")_"]",1:"")_$P($P(VADM(2),U,2),"-",3)_"  "_$S(+VAIN(4):$P(VAIN(4),U,2),1:"Opt IV")_"  "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3) D P
"RTN","PSIVORLB",17,0)
 S X=VADM(1) S:$P(PSIVSITE,U,9) X=X_"  "_$S(VAIN(5)]"":VAIN(5),1:"NF") D P S X=" " D P
"RTN","PSIVORLB",18,0)
 I $D(PSIVFLAG) F PSIV=0:0 S PSIV=$O(DRG("AD",PSIV)) Q:'PSIV  S Y=DRG("AD",PSIV),X=$S($P(Y,U,2)]"":$P(Y,U,2),1:"*********")_" "_$P(Y,U,3)_" " S:$P(Y,U,4)]"" X=X_" ("_$P(Y,U,4)_")" D P,MESS
"RTN","PSIVORLB",19,0)
 G:$D(PSIVFLAG) SOL
"RTN","PSIVORLB",20,0)
 F PSIV=0:0 S PSIV=$O(DRG("AD",PSIV)) Q:'PSIV  S Y=DRG("AD",PSIV),X=$S($P(Y,U,2)]"":$P(Y,U,2),1:"********")_" "_$P(Y,U,3) I ","_$P(Y,U,4)_","[(","_P(16)_",")!('$P(Y,U,4)) D P,MESS
"RTN","PSIVORLB",21,0)
SOL F PSIV=0:0 S PSIV=$O(DRG("SOL",PSIV)) Q:'PSIV  S Y=DRG("SOL",PSIV) D SOL1,P S X=$P(^PS(52.7,+$P(Y,U),0),U,4) I X]"" S X="   "_X D P
"RTN","PSIVORLB",22,0)
 I P(23)'=""!(P(4)="S") S X="In Syringe: "_$E(P("SYRS"),1,25) D:P(4)="S"!(P(23)="S") P S X="*CAUTION* - CHEMOTHERAPY" D:P(23)'="" P
"RTN","PSIVORLB",23,0)
 S X=" " D P I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) G INF
"RTN","PSIVORLB",24,0)
 S:'$D(PSIVDOSE) PSIVDOSE="" S X=$P(PSIVDOSE," ",PSIV1) D:$E(X)="." CONVER S X="Dose due at: "_$S(X="":"________",1:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)_" "_$E(X#1_"000",2,5)) D P
"RTN","PSIVORLB",25,0)
INF S X=$P(P(8),"@") D:X]"" P I P("OPI")]"" S X=$P(P("OPI"),"^") D P
"RTN","PSIVORLB",26,0)
 S X=P(9) D:X]"" P
"RTN","PSIVORLB",27,0)
 S X=P(11) D:X]"" P
"RTN","PSIVORLB",28,0)
 ; PSJ*5*184 - Display all messages if more than one additive has a message.
"RTN","PSIVORLB",29,0)
 I $D(MESS) S PSIMESS="" F  S PSIMESS=$O(MESS(PSIMESS)) Q:PSIMESS=""  S X=PSIMESS D P
"RTN","PSIVORLB",30,0)
 I $D(^PS(59.5,PSIVSN,4)) S Y=^(4) F PSIV=1:1 S X=$P(Y,U,PSIV) Q:X=""  D P
"RTN","PSIVORLB",31,0)
 S X=PSIV1_"["_PSIVNOL_"]" D P
"RTN","PSIVORLB",32,0)
 Q
"RTN","PSIVORLB",33,0)
P F LINE=LINE+1:1 X:LINE>+PSIVSITE "S LINE=1 F ZZ=1:1 Q:ZZ>$P(PSIVSITE,""^"",16)  W !" K ZZ W $E(X,1,PSIVRM),! S X=$E(X,PSIVRM+1,999) Q:$L(X)<1
"RTN","PSIVORLB",34,0)
 Q
"RTN","PSIVORLB",35,0)
SOL1 S X=$S($P(Y,U,2)]"":$P(Y,U,2)_" "_$P(Y,U,3),1:"**********") Q
"RTN","PSIVORLB",36,0)
MESS ; PSJ*5*184 - make MESS a local array so all messages display for all additives.
"RTN","PSIVORLB",37,0)
 I $P(^PS(52.6,+$P(Y,U),0),U,9)]"" S MESS($P(^PS(52.6,+$P(Y,U),0),U,9))=""
"RTN","PSIVORLB",38,0)
 Q
"RTN","PSIVORLB",39,0)
CONVER ;Expand dose to date.dose and set in X
"RTN","PSIVORLB",40,0)
 I P(15)>1440 S X=$$CONVER1^PSIVORE2($P(PSIVDOSE," "),P(15),(PSIV1-1)) Q
"RTN","PSIVORLB",41,0)
 S PDOSE=X S:PSIV1=2 PDATE=$E($P(PSIVDOSE," "),1,7)
"RTN","PSIVORLB",42,0)
 I $P(PSIVDOSE," ",PSIV1-1)#1'<PDOSE!(P(15)>1440) S:$D(X1) XX1=X1 S:$D(X2) XX2=X2 S X1=PDATE,X2=1 D C^%DTC S PDATE=X,X=X_PDOSE S:$D(XX1) X1=XX1 S:$D(XX2) X2=XX2 Q
"RTN","PSIVORLB",43,0)
 S X=PDATE_PDOSE
"RTN","PSIVORLB",44,0)
 Q
"RTN","PSJDDUT2")
0^10^B32882229^B30960993
"RTN","PSJDDUT2",1,0)
PSJDDUT2 ;BIR/LDT-INPATIENT MEDICATIONS DD UTILITY ; 7/28/09 6:48am
"RTN","PSJDDUT2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**184**;16 DEC 97;Build 12
"RTN","PSJDDUT2",3,0)
 ;
"RTN","PSJDDUT2",4,0)
ENDLP ;Called from Inpatient User Parameters file (53.45), Label Printer
"RTN","PSJDDUT2",5,0)
 ;field .07 (Replaces ENDLP^PSGSET)
"RTN","PSJDDUT2",6,0)
 ;BHW - HD168525 - Don't default when user exits (POP) if LABEL DEVICE or REPORT DEVICE already defined.
"RTN","PSJDDUT2",7,0)
 I POP,(DIFLD=13)&($L($P($G(^PS(59.5,DA(1),0)),U,2))) S X=$P($G(^PS(59.5,DA(1),0)),U,2) Q  ;HD168525 - Check LABEL DEVICE
"RTN","PSJDDUT2",8,0)
 I POP,(DIFLD=14)&($L($P($G(^PS(59.5,DA(1),0)),U,3))) S X=$P($G(^PS(59.5,DA(1),0)),U,3) Q  ;HD168525 - Check REPORT DEVICE
"RTN","PSJDDUT2",9,0)
 S PSGION=$S($D(ION):ION,1:"HOME") K %ZIS S %ZIS="QN",IOP=X D ^%ZIS I POP S IOP=PSGION D ^%ZIS K %ZIS,IOP,PSGION S X="" Q
"RTN","PSJDDUT2",10,0)
 D EN^DDIOL($S(X=$E(ION,1,$L(X)):$E(ION,$L(X)+1,$L(ION)),1:"  "_ION),"","?0") S X=ION D ^%ZISC K %ZIS,PSGION,IOP Q
"RTN","PSJDDUT2",11,0)
 ;
"RTN","PSJDDUT2",12,0)
ADTM ;Called from Unit Dose Multiple of the Pharmacy Patient file (55.06),
"RTN","PSJDDUT2",13,0)
 ;Admin Times field 41
"RTN","PSJDDUT2",14,0)
 S PSJHLP(1)="THE TIMES MUST BE TWO (2) OR FOUR (4) DIGITS, SEPARATED WITH DASHES"
"RTN","PSJDDUT2",15,0)
 S PSJHLP(2)="(-), AND BE IN ASCENDING ORDER. (IE. 01-05-13)"
"RTN","PSJDDUT2",16,0)
 D WRITE
"RTN","PSJDDUT2",17,0)
 Q
"RTN","PSJDDUT2",18,0)
 ;
"RTN","PSJDDUT2",19,0)
 ;
"RTN","PSJDDUT2",20,0)
SITE ;Called from Inpatient Site file (59.4), field .01 (Replaces ^PSGRPNT)
"RTN","PSJDDUT2",21,0)
 S Q=0 F QQ=-1:1 S Q=$O(^PS(59.4,Q)) Q:'Q
"RTN","PSJDDUT2",22,0)
 I 'QQ S PSJHLP(1)="THIS IS YOUR ONLY SITE!",PSJHLP(1,"F")="$C(7),!!",PSJHLP(2)="(You must create another site before you can delete this one.)",PSJHLP(2,"F")="!" D WRITE Q
"RTN","PSJDDUT2",23,0)
 ;
"RTN","PSJDDUT2",24,0)
ENMARD() ; validate MAR SELECTION DEFAULT string in WARD PARMS file (59.6).
"RTN","PSJDDUT2",25,0)
 ;(Replaces ENMARD^PSJUTL())
"RTN","PSJDDUT2",26,0)
 N PSJANS,PSJX1,PSJX2,RANGE,Q
"RTN","PSJDDUT2",27,0)
 S RANGE="1:6" F PSJX1=1:1:6 S RANGE(PSJX1)=""
"RTN","PSJDDUT2",28,0)
 S:$E(X)="-" X=+RANGE_X S:$E($L(X))="-" X=X_$P(RANGE,":",2)
"RTN","PSJDDUT2",29,0)
 S PSJANS="" F Q=1:1:$L(X,",") S PSJX1=$P(X,",",Q) D FS Q:'$D(PSJANS)
"RTN","PSJDDUT2",30,0)
 Q:'$G(PSJANS) 0
"RTN","PSJDDUT2",31,0)
 S PSJANS=$E(PSJANS,1,$L(PSJANS)-1) F Q=1:1:$L(PSJANS,",") D  Q:'$D(PSJANS)
"RTN","PSJDDUT2",32,0)
 .I $P(PSJANS,",",Q)=1,$L(PSJANS,",")>1 D EN^DDIOL("All Medications (1) may not be selected in combination with other types.","","!!") K PSJANS Q
"RTN","PSJDDUT2",33,0)
 .D EN^DDIOL($P(PSJANS,",",Q)_" - "_$P($T(@$P(PSJANS,",",Q)),";;",2),"","!?47")
"RTN","PSJDDUT2",34,0)
 S:$G(PSJANS) X=PSJANS Q $G(PSJANS)
"RTN","PSJDDUT2",35,0)
 ;
"RTN","PSJDDUT2",36,0)
FS ;
"RTN","PSJDDUT2",37,0)
 I $S(PSJX1?1.N1"-"1.N:0,PSJX1'?1.N:1,'$D(RANGE(PSJX1)):1,1:","_PSJANS[PSJX1) K PSJANS Q
"RTN","PSJDDUT2",38,0)
 I PSJX1'["-" S PSJANS=PSJANS_PSJX1_"," Q
"RTN","PSJDDUT2",39,0)
 S PSJX2=+PSJX1,PSJANS=PSJANS_PSJX2_","
"RTN","PSJDDUT2",40,0)
 F  S PSJX2=$O(RANGE(PSJX2)) K:$S(X="":1,","_PSJANS[PSJX2:1,1:PSJX2>$P(PSJX1,"-",2)) PSJANS Q:'$D(PSJANS)  S PSJANS=PSJANS_PSJX2_"," Q:PSJX2=$P(PSJX1,"-",2)
"RTN","PSJDDUT2",41,0)
 Q
"RTN","PSJDDUT2",42,0)
 ;
"RTN","PSJDDUT2",43,0)
ENMARDH ;Help text for MAR default answer. (Replaces ENMARDH^PSJUTL)
"RTN","PSJDDUT2",44,0)
 S PSJHLP(1)="Enter the number corresponding to the type of orders to be included on"
"RTN","PSJDDUT2",45,0)
 S PSJHLP(1,"F")="!!?2"
"RTN","PSJDDUT2",46,0)
 S PSJHLP(2)="MARs printed for this ward. Multiple types (except 1) may be selected"
"RTN","PSJDDUT2",47,0)
 S PSJHLP(3)="using ""-"" or "","" as delimiters."
"RTN","PSJDDUT2",48,0)
 S PSJHLP(4)="Choose from: "
"RTN","PSJDDUT2",49,0)
 S PSJHLP(4,"F")="!!"
"RTN","PSJDDUT2",50,0)
 S PSJHLP(5)="1 - All Medications"
"RTN","PSJDDUT2",51,0)
 S PSJHLP(5,"F")="!?13"
"RTN","PSJDDUT2",52,0)
 S PSJHLP(6)="2 - Non-IV Medications only"
"RTN","PSJDDUT2",53,0)
 S PSJHLP(6,"F")="!?13"
"RTN","PSJDDUT2",54,0)
 S PSJHLP(7)="3 - IV Piggybacks"
"RTN","PSJDDUT2",55,0)
 S PSJHLP(7,"F")="!?13"
"RTN","PSJDDUT2",56,0)
 S PSJHLP(8)="4 - LVPs"
"RTN","PSJDDUT2",57,0)
 S PSJHLP(8,"F")="!?13"
"RTN","PSJDDUT2",58,0)
 S PSJHLP(9)="5 - TPNs"
"RTN","PSJDDUT2",59,0)
 S PSJHLP(9,"F")="!?13"
"RTN","PSJDDUT2",60,0)
 S PSJHLP(10)="6 - Chemotherapy Medications (IV)"
"RTN","PSJDDUT2",61,0)
 S PSJHLP(10,"F")="!?13"
"RTN","PSJDDUT2",62,0)
 D WRITE
"RTN","PSJDDUT2",63,0)
 Q
"RTN","PSJDDUT2",64,0)
 ;
"RTN","PSJDDUT2",65,0)
ENSTH ;Executable help for type of schedule. (Replaces ENSTH^PSJSV0)
"RTN","PSJDDUT2",66,0)
 N PSJX S PSJX=1
"RTN","PSJDDUT2",67,0)
 S PSJHLP(PSJX)="The TYPE OF SCHEDULE determines how the schedule will be processed."
"RTN","PSJDDUT2",68,0)
 S PSJHLP(PSJX,"F")="!!?2",PSJX=PSJX+1
"RTN","PSJDDUT2",69,0)
 S PSJHLP(PSJX)="A CONTINUOUS schedule is one in which an action is to take place on a"
"RTN","PSJDDUT2",70,0)
 S PSJHLP(PSJX,"F")="!!?2",PSJX=PSJX+1
"RTN","PSJDDUT2",71,0)
 S PSJHLP(PSJX)="regular basis, such as 'three times a day' or 'once every two days'."
"RTN","PSJDDUT2",72,0)
 S PSJHLP(PSJX,"F")="!",PSJX=PSJX+1
"RTN","PSJDDUT2",73,0)
 S PSJHLP(PSJX)="A DAY OF THE WEEK schedule is one in which the action is to take"
"RTN","PSJDDUT2",74,0)
 S PSJHLP(PSJX,"F")="!?2",PSJX=PSJX+1
"RTN","PSJDDUT2",75,0)
 S PSJHLP(PSJX)="place only on specific days of the week.  This type of schedule"
"RTN","PSJDDUT2",76,0)
 S PSJHLP(PSJX,"F")="!",PSJX=PSJX+1
"RTN","PSJDDUT2",77,0)
 S PSJHLP(PSJX)="should have admin times entered with it.  If not, the start time of"
"RTN","PSJDDUT2",78,0)
 S PSJHLP(PSJX,"F")="!",PSJX=PSJX+1
"RTN","PSJDDUT2",79,0)
 S PSJHLP(PSJX)="the order is used as the admin time.  Whenever this type is chosen,"
"RTN","PSJDDUT2",80,0)
 S PSJHLP(PSJX,"F")="!",PSJX=PSJX+1
"RTN","PSJDDUT2",81,0)
 S PSJHLP(PSJX)="the name of the schedule must be in the form of 'MO-WE-FR'."
"RTN","PSJDDUT2",82,0)
 S PSJHLP(PSJX,"F")="!",PSJX=PSJX+1
"RTN","PSJDDUT2",83,0)
 G:$S('$D(PSJPP):1,PSJPP="":1,1:PSJPP="PSJ") HOT
"RTN","PSJDDUT2",84,0)
 S PSJHLP(PSJX)="A DAY OF THE WEEK-RANGE schedule is one in which the action to take"
"RTN","PSJDDUT2",85,0)
 S PSJHLP(PSJX,"F")="!?2",PSJX=PSJX+1
"RTN","PSJDDUT2",86,0)
 S PSJHLP(PSJX)="place only on specific days of the week, but at no specific time of"
"RTN","PSJDDUT2",87,0)
 S PSJHLP(PSJX,"F")="!",PSJX=PSJX+1
"RTN","PSJDDUT2",88,0)
 S PSJHLP(PSJX)="day (no admin times).  Whenever this type is chosen, the name of the"
"RTN","PSJDDUT2",89,0)
 S PSJHLP(PSJX,"F")="!",PSJX=PSJX+1
"RTN","PSJDDUT2",90,0)
 S PSJHLP(PSJX)="schedule must be in the form of 'MO-WE-FR'."
"RTN","PSJDDUT2",91,0)
 S PSJHLP(PSJX,"F")="!",PSJX=PSJX+1
"RTN","PSJDDUT2",92,0)
HOT S PSJHLP(PSJX)="A ONE-TIME schedule is one in which the action is to take place once"
"RTN","PSJDDUT2",93,0)
 S PSJHLP(PSJX,"F")="!?2",PSJX=PSJX+1
"RTN","PSJDDUT2",94,0)
 S PSJHLP(PSJX)="only at a specific date and time."
"RTN","PSJDDUT2",95,0)
 S PSJHLP(PSJX,"F")="!",PSJX=PSJX+1
"RTN","PSJDDUT2",96,0)
 I $S('$D(PSJPP):1,PSJPP="":1,1:PSJPP="PSJ") D WRITE Q
"RTN","PSJDDUT2",97,0)
 S PSJHLP(PSJX)="A RANGE schedule is one in which the action will take place within a"
"RTN","PSJDDUT2",98,0)
 S PSJHLP(PSJX,"F")="!?2",PSJX=PSJX+1
"RTN","PSJDDUT2",99,0)
 S PSJHLP(PSJX)="given date range."
"RTN","PSJDDUT2",100,0)
 S PSJHLP(PSJX,"F")="!",PSJX=PSJX+1
"RTN","PSJDDUT2",101,0)
 S PSJHLP(PSJX)="A SHIFT schedule is one in which the action will take place within a"
"RTN","PSJDDUT2",102,0)
 S PSJHLP(PSJX,"F")="!?2",PSJX=PSJX+1
"RTN","PSJDDUT2",103,0)
 S PSJHLP(PSJX)="given range of times of day."
"RTN","PSJDDUT2",104,0)
 S PSJHLP(PSJX,"F")="!",PSJX=PSJX+1
"RTN","PSJDDUT2",105,0)
 D WRITE
"RTN","PSJDDUT2",106,0)
 Q
"RTN","PSJDDUT2",107,0)
WRITE ;Calls EN^DDIOL to write text
"RTN","PSJDDUT2",108,0)
 D EN^DDIOL(.PSJHLP) K PSJHLP
"RTN","PSJDDUT2",109,0)
 Q
"RTN","PSJDDUT2",110,0)
1 ;;All Medications
"RTN","PSJDDUT2",111,0)
2 ;;Non-IV Medications only
"RTN","PSJDDUT2",112,0)
3 ;;IV Piggybacks
"RTN","PSJDDUT2",113,0)
4 ;;LVPs
"RTN","PSJDDUT2",114,0)
5 ;;TPNs
"RTN","PSJDDUT2",115,0)
6 ;;Chemotherapy Medications (IV)
"RTN","PSJEEU0")
0^6^B18332264^B17690359
"RTN","PSJEEU0",1,0)
PSJEEU0 ;BIR/CML3,PR-MORE EXTERNAL ENTRIES ;22 OCT 97 / 10:22 AM
"RTN","PSJEEU0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**184**;16 DEC 97;Build 12
"RTN","PSJEEU0",3,0)
 ;
"RTN","PSJEEU0",4,0)
ENHS ;
"RTN","PSJEEU0",5,0)
 S PSGP=DFN,PSJACNWP=1 D ENIV^PSJAC,NOW^%DTC K ^UTILITY("PSG",$J),^UTILITY("PSIV",$J) S X=$S('$G(PSJEDT):%,$P(PSJEDT,".",2):PSJEDT-.0001,1:PSJEDT)
"RTN","PSJEEU0",6,0)
 F X=X:0 S X=$O(^PS(55,PSGP,5,"AUS",X)) Q:'X  F Y=0:0 S Y=$O(^PS(55,PSGP,5,"AUS",X,Y)) Q:'Y  S X(0)=$G(^PS(55,PSGP,5,Y,0)) S PSJROOT="^PS(55,"_PSGP_",5,"_Y_"," D UDSET
"RTN","PSJEEU0",7,0)
 F Y=0:0 S Y=$O(^PS(53.1,"AC",PSGP,Y)) Q:'Y  S X(0)=$G(^PS(53.1,Y,0)) I "PU"'[$P(X(0),"^",9) S PSJROOT="^PS(53.1,"_Y_"," D UDSET
"RTN","PSJEEU0",8,0)
 ;
"RTN","PSJEEU0",9,0)
ENHSI ;Build all IV Active/Non-verified orders
"RTN","PSJEEU0",10,0)
 D ENNA^PSIVACT F ON=0:0 S ON=$O(^PS(55,DFN,"IV",ON)) Q:'ON  I $D(^(ON,0)) S Y=^(0) I $S("ANROH"[$P(Y,U,17):1,'$G(PSJEDT):0,1:$P(Y,U,3)'<$G(PSJEDT)) F I=1:1:23 S P(I)=$P(Y,U,I) I I=23 D 0
"RTN","PSJEEU0",11,0)
 ;
"RTN","PSJEEU0",12,0)
DONE ;
"RTN","PSJEEU0",13,0)
 N DFN D ENKV^PSGSETU K V,X,Y,Z,P,S,A,NUM,PS,PSJACNWP,ON,PSIVREA
"RTN","PSJEEU0",14,0)
 K PSJROOT,PSJTEXT,PSJFNM,PSJUD Q
"RTN","PSJEEU0",15,0)
 ;
"RTN","PSJEEU0",16,0)
0 ;Build 0 node
"RTN","PSJEEU0",17,0)
 S P(17)=$S("AROH"[P(17):"A;ACTIVE",P(17)="D":"D;DISCONTINUED",P(17)="E":"E;EXPIRED",1:"N;NON VERIFIED")
"RTN","PSJEEU0",18,0)
 S X=$P($G(^VA(200,+P(6),0)),U),P(6)=P(6)_":VA(200,;"_X
"RTN","PSJEEU0",19,0)
 S P(10)=P(2) F Z=P(2):-.000001 I '$D(^UTILITY("PSIV",$J,-Z)) S P(2)=Z Q
"RTN","PSJEEU0",20,0)
 S ^UTILITY("PSIV",$J,-P(2),0)=P(10)_U_P(3)_U_P(6)_U_P(17)_U_P(8)_U_P(9)
"RTN","PSJEEU0",21,0)
 S NUM=0 F A=0:0 S A=$O(^PS(55,DFN,"IV",ON,"AD",A)) Q:'A  I $D(^(A,0)) S P=^(0),NUM=NUM+1,^UTILITY("PSIV",$J,-P(2),"A",NUM)=$P(P,U)_";"_$P($G(^PS(52.6,$P(P,U),0)),U)_U_$P(P,U,2)
"RTN","PSJEEU0",22,0)
 S NUM=0 F S=0:0 S S=$O(^PS(55,DFN,"IV",ON,"SOL",S)) Q:'S  I $D(^(S,0)) S P=^(0),NUM=NUM+1,^UTILITY("PSIV",$J,-P(2),"S",NUM)=$P(P,U)_";"_$P($G(^PS(52.7,$P(P,U),0)),U)_U_$P(P,U,2)
"RTN","PSJEEU0",23,0)
 Q
"RTN","PSJEEU0",24,0)
 ;
"RTN","PSJEEU0",25,0)
UDSET ;
"RTN","PSJEEU0",26,0)
 ; changed line below to look at .2 node for Orderable Item.
"RTN","PSJEEU0",27,0)
 K PSJUD,PSJFNM
"RTN","PSJEEU0",28,0)
 ;S X(2)=$G(^(2)),X(1)=$G(^(.2)),V=$P(X(2),"^",2)_"^"_$P(X(2),"^",4)_"^"_$P(X(1),"^")_":PS(50.3,;"_$$ENPDN^PSGMI($P(X(1),"^"))_"^"_+$P(X(0),"^",2)_":VA(200,;"_$$ENNPN^PSGMI(+$P(X(0),"^",2))_"^"
"RTN","PSJEEU0",29,0)
 S X(2)=$G(^(2)),X(1)=$G(^(.2)),V=$P(X(2),"^",2)_"^"_$P(X(2),"^",4)_"^"_$$GETDRUG_"^"_+$P(X(0),"^",2)_":VA(200,;"_$$ENNPN^PSGMI(+$P(X(0),"^",2))_"^"
"RTN","PSJEEU0",30,0)
 ; PSJ*5*184 Add Discontinued/Edit
"RTN","PSJEEU0",31,0)
 S V=V_$P(X(0),"^",9)_";"_$S($P(X(0),"^",9)="DE":"DISCONTINUED/EDIT",1:$P("ACTIVE^NON-VERIFIED^DISCONTINUED^INCOMPLETE^EXPIRED^HOLD^RENEWAL","^",$F("ANDIEHR",$P(X(0),"^",9))-1))
"RTN","PSJEEU0",32,0)
 ;S Z=$G(^PS(51.2,+$P(X(0),"^",3),0)),V=V_"^"_$P(X(1),"^",2)_"^"_$P(X(0),"^",3)_":PS(51.2,;"_$P(Z,"^",3)_";"_$P(Z,"^")
"RTN","PSJEEU0",33,0)
 S Z=$G(^PS(51.2,+$P(X(0),"^",3),0)),V=V_"^"_$$GETAMT_"^"_$P(X(0),"^",3)_":PS(51.2,;"_$P(Z,"^",3)_";"_$P(Z,"^")
"RTN","PSJEEU0",34,0)
 S Z=$P(X(0),"^",7),V=V_"^"_$P(X(2),"^")_"^"_Z_";"_$S(Z="C":"CONTINUOUS",Z="O":"ONE TIME",Z="OC":"ON CALL",Z="P":"PRN",Z="R":"FILL ON REQUEST",1:"") F Z=-$P(X(2),"^",2):-.00001 I '$D(^UTILITY("PSG",$J,Z)) S ^(Z)=V Q
"RTN","PSJEEU0",35,0)
 Q
"RTN","PSJEEU0",36,0)
 ;
"RTN","PSJEEU0",37,0)
ENIVSE ; IV schedule edit
"RTN","PSJEEU0",38,0)
 S PSJPP="PSJ" F FQ=0:0 K DA,DIC,DR S DIC="^PS(51.1,",DIC(0)="AELSQ",DIC("DR")="4////PSJ;5////C",DIC("S")="I ""C""[$P(^(0),""^"",5)",D="APPSJ" W ! D IX^DIC Q:Y'>0  S DA=+Y,DIE=DIC,DR="[PSJI SCHEDULE EDIT]" K DIC D ^DIE
"RTN","PSJEEU0",39,0)
 K C,D0,D1,FQ,PSJIVSEF,PSJPP,Z D ENIVKV^PSGSETU
"RTN","PSJEEU0",40,0)
 Q
"RTN","PSJEEU0",41,0)
GETDRUG() ; get orderable item or dispense drug
"RTN","PSJEEU0",42,0)
 I '$$DISPCNT&'$D(@(PSJROOT_".2)")) Q $$PRIMARY
"RTN","PSJEEU0",43,0)
 I $$DISPCNT&'$P($G(@(PSJROOT_".2)")),"^",2) Q $$DISPDISP
"RTN","PSJEEU0",44,0)
 E  S PSJFNM=$P($G(@(PSJROOT_".2)")),"^")
"RTN","PSJEEU0",45,0)
 Q PSJFNM_":PS(50.7,;"_$$ENPDN^PSGMI($P(X(1),"^"))_" "_$P($G(^PS(50.606,$P($G(^PS(50.7,PSJFNM,0)),"^",2),0)),"^")
"RTN","PSJEEU0",46,0)
DISPCNT() ;  returns 1 if only only one dispense drug, 0 if more than one
"RTN","PSJEEU0",47,0)
 N CNT,LOOP S (CNT,LOOP)=0 F  S LOOP=$O(@(PSJROOT_"1,"_LOOP_")")) Q:'LOOP  D
"RTN","PSJEEU0",48,0)
 .S CNT=CNT+1
"RTN","PSJEEU0",49,0)
 I CNT>1 S CNT=0
"RTN","PSJEEU0",50,0)
 Q CNT
"RTN","PSJEEU0",51,0)
DISPDISP() ; return Dispense drug name
"RTN","PSJEEU0",52,0)
 N LOOP
"RTN","PSJEEU0",53,0)
 S LOOP=0 F  S LOOP=$O(@(PSJROOT_"1,"_LOOP_")")) Q:'LOOP  D
"RTN","PSJEEU0",54,0)
 .S PSJTEXT=$P($G(^PSDRUG($P($G(@(PSJROOT_"1,LOOP,0)")),"^"),0)),"^")
"RTN","PSJEEU0",55,0)
 .S PSJFNM=$P($G(@(PSJROOT_"1,LOOP,0)")),"^")
"RTN","PSJEEU0",56,0)
 .S PSJUD=$P($G(@(PSJROOT_"1,LOOP,0)")),"^",2)
"RTN","PSJEEU0",57,0)
 .I PSJUD="" S PSJUD=1
"RTN","PSJEEU0",58,0)
 Q PSJFNM_":PSDRUG(;"_PSJTEXT
"RTN","PSJEEU0",59,0)
GETAMT() ; get dosage ordered or units per dose
"RTN","PSJEEU0",60,0)
 Q $S($D(PSJUD):PSJUD,1:$P(X(1),"^",2))
"RTN","PSJEEU0",61,0)
PRIMARY() ; return Primary drug, order has no Orderable Item node
"RTN","PSJEEU0",62,0)
 S PSJTEXT=$P($G(^PS(50.3,+$P($G(@(PSJROOT_".1)")),"^"),0)),"^")
"RTN","PSJEEU0",63,0)
 S PSJFNM=$P($G(@(PSJROOT_".1)")),"^")
"RTN","PSJEEU0",64,0)
 S PSJUD=$P($G(@(PSJROOT_".1)")),"^",2)
"RTN","PSJEEU0",65,0)
 Q PSJFNM_":PS(50.3;"_$S($L(PSJTEXT):PSJTEXT,1:"DRUG NOT FOUND")
"VER")
8.0^22.0
"BLD",6971,6)
^196
**END**
**END**
