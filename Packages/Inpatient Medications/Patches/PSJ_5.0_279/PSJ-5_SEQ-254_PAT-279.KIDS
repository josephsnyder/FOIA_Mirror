Released PSJ*5*279 SEQ #254
Extracted from mail message
**KIDS**:PSJ*5.0*279^

**INSTALL NAME**
PSJ*5.0*279
"BLD",8406,0)
PSJ*5.0*279^INPATIENT MEDICATIONS^0^3131001^y
"BLD",8406,1,0)
^^11^11^3130123^^
"BLD",8406,1,1,0)
IMR6 - CLINIC ORDER & DRUG HIGH RISK/ALERT
"BLD",8406,1,2,0)
 
"BLD",8406,1,3,0)
IV Bag Logic
"BLD",8406,1,4,0)
------------
"BLD",8406,1,5,0)
This patch modifies Inpatient Order Entry so that when Inpatient orders
"BLD",8406,1,6,0)
are edited, BCMA IV parameters are now checked to determine if IV labels
"BLD",8406,1,7,0)
were invalidated as a results of the edit. If labels were invalidated, the
"BLD",8406,1,8,0)
clinician making the edit is informed and a list of the invalidated IV
"BLD",8406,1,9,0)
labels are displayed. The clinician is given an opportunity to print 
"BLD",8406,1,10,0)
replacement labels, including when no new order is created as a result of 
"BLD",8406,1,11,0)
the edit.
"BLD",8406,4,0)
^9.64PA^53.1^2
"BLD",8406,4,53.1,0)
53.1
"BLD",8406,4,53.1,2,0)
^9.641^53.1^1
"BLD",8406,4,53.1,2,53.1,0)
NON-VERIFIED ORDERS  (File-top level)
"BLD",8406,4,53.1,2,53.1,1,0)
^9.6411^59^2
"BLD",8406,4,53.1,2,53.1,1,59,0)
INFUSION RATE
"BLD",8406,4,53.1,2,53.1,1,131,0)
LABELS PER DAY
"BLD",8406,4,53.1,222)
y^y^p^^^^n^^n
"BLD",8406,4,53.1,224)

"BLD",8406,4,53.46,0)
53.46
"BLD",8406,4,53.46,2,0)
^9.641^53.46^1
"BLD",8406,4,53.46,2,53.46,0)
CLINIC DEFINITION  (File-top level)
"BLD",8406,4,53.46,2,53.46,1,0)
^9.6411^5^2
"BLD",8406,4,53.46,2,53.46,1,4,0)
MISSING DOSE PRINTER
"BLD",8406,4,53.46,2,53.46,1,5,0)
PRE-EXCHANGE REPORT DEVICE
"BLD",8406,4,53.46,222)
y^y^p^^^^n^^n
"BLD",8406,4,53.46,224)

"BLD",8406,4,"APDD",53.1,53.1)

"BLD",8406,4,"APDD",53.1,53.1,59)

"BLD",8406,4,"APDD",53.1,53.1,131)

"BLD",8406,4,"APDD",53.46,53.46)

"BLD",8406,4,"APDD",53.46,53.46,4)

"BLD",8406,4,"APDD",53.46,53.46,5)

"BLD",8406,4,"B",53.1,53.1)

"BLD",8406,4,"B",53.46,53.46)

"BLD",8406,6)
20^
"BLD",8406,6.3)
150
"BLD",8406,"ABPKG")
n
"BLD",8406,"KRN",0)
^9.67PA^779.2^20
"BLD",8406,"KRN",.4,0)
.4
"BLD",8406,"KRN",.401,0)
.401
"BLD",8406,"KRN",.402,0)
.402
"BLD",8406,"KRN",.403,0)
.403
"BLD",8406,"KRN",.5,0)
.5
"BLD",8406,"KRN",.84,0)
.84
"BLD",8406,"KRN",3.6,0)
3.6
"BLD",8406,"KRN",3.8,0)
3.8
"BLD",8406,"KRN",3.8,"NM",0)
^9.68A^1^1
"BLD",8406,"KRN",3.8,"NM",1,0)
PSJ CLINIC DEFINITION^^0
"BLD",8406,"KRN",3.8,"NM","B","PSJ CLINIC DEFINITION",1)

"BLD",8406,"KRN",9.2,0)
9.2
"BLD",8406,"KRN",9.8,0)
9.8
"BLD",8406,"KRN",9.8,"NM",0)
^9.68A^50^38
"BLD",8406,"KRN",9.8,"NM",1,0)
PSJBCMA^^0^B104152395
"BLD",8406,"KRN",9.8,"NM",2,0)
PSJBCMA1^^0^B120598961
"BLD",8406,"KRN",9.8,"NM",3,0)
PSGP^^0^B11793961
"BLD",8406,"KRN",9.8,"NM",4,0)
PSIVCAL^^0^B76248321
"BLD",8406,"KRN",9.8,"NM",7,0)
PSIVOPT1^^0^B46129724
"BLD",8406,"KRN",9.8,"NM",8,0)
PSIVORLB^^0^B16554015
"BLD",8406,"KRN",9.8,"NM",10,0)
PSIVHYPL^^0^B49378868
"BLD",8406,"KRN",9.8,"NM",11,0)
PSIVHYPR^^0^B46405814
"BLD",8406,"KRN",9.8,"NM",12,0)
PSIVLABL^^0^B43882246
"BLD",8406,"KRN",9.8,"NM",13,0)
PSIVLABR^^0^B39932964
"BLD",8406,"KRN",9.8,"NM",14,0)
PSIVLB^^0^B7955740
"BLD",8406,"KRN",9.8,"NM",15,0)
PSIVLBL1^^0^B42809676
"BLD",8406,"KRN",9.8,"NM",17,0)
PSIVORC1^^0^B79901460
"BLD",8406,"KRN",9.8,"NM",19,0)
PSIVLTR1^^0^B40668959
"BLD",8406,"KRN",9.8,"NM",20,0)
PSJCLOR2^^0^B116286849
"BLD",8406,"KRN",9.8,"NM",21,0)
PSJLIVFD^^0^B63427206
"BLD",8406,"KRN",9.8,"NM",22,0)
PSIVEDT1^^0^B111693180
"BLD",8406,"KRN",9.8,"NM",23,0)
PSIVORFA^^0^B30883518
"BLD",8406,"KRN",9.8,"NM",24,0)
PSJHL2^^0^B42288788
"BLD",8406,"KRN",9.8,"NM",27,0)
PSJHL7^^0^B54843805
"BLD",8406,"KRN",9.8,"NM",28,0)
PSJHL9^^0^B61985581
"BLD",8406,"KRN",9.8,"NM",29,0)
PSIVRD^^0^B24864338
"BLD",8406,"KRN",9.8,"NM",31,0)
PSIVSP^^0^B42203793
"BLD",8406,"KRN",9.8,"NM",32,0)
PSJLIVMD^^0^B100202267
"BLD",8406,"KRN",9.8,"NM",35,0)
PSJIBAG^^0^B43933390
"BLD",8406,"KRN",9.8,"NM",36,0)
PSGPER^^0^B18332674
"BLD",8406,"KRN",9.8,"NM",37,0)
PSGPER1^^0^B18498632
"BLD",8406,"KRN",9.8,"NM",38,0)
PSGPER0^^0^B34370854
"BLD",8406,"KRN",9.8,"NM",39,0)
PSGPER2^^0^B31489798
"BLD",8406,"KRN",9.8,"NM",41,0)
PSJAC^^0^B18623217
"BLD",8406,"KRN",9.8,"NM",43,0)
PSIVORE1^^0^B25786480
"BLD",8406,"KRN",9.8,"NM",44,0)
PSJBCMA6^^0^B9827080
"BLD",8406,"KRN",9.8,"NM",45,0)
PSJHL4^^0^B76440545
"BLD",8406,"KRN",9.8,"NM",46,0)
PSIVORAL^^0^B19483553
"BLD",8406,"KRN",9.8,"NM",47,0)
PSIVUTL^^0^B35163625
"BLD",8406,"KRN",9.8,"NM",48,0)
PSGFILD3^^0^B24920479
"BLD",8406,"KRN",9.8,"NM",49,0)
PSIVOREN^^0^B28253385
"BLD",8406,"KRN",9.8,"NM",50,0)
PSJP^^0^B28361612
"BLD",8406,"KRN",9.8,"NM","B","PSGFILD3",48)

"BLD",8406,"KRN",9.8,"NM","B","PSGP",3)

"BLD",8406,"KRN",9.8,"NM","B","PSGPER",36)

"BLD",8406,"KRN",9.8,"NM","B","PSGPER0",38)

"BLD",8406,"KRN",9.8,"NM","B","PSGPER1",37)

"BLD",8406,"KRN",9.8,"NM","B","PSGPER2",39)

"BLD",8406,"KRN",9.8,"NM","B","PSIVCAL",4)

"BLD",8406,"KRN",9.8,"NM","B","PSIVEDT1",22)

"BLD",8406,"KRN",9.8,"NM","B","PSIVHYPL",10)

"BLD",8406,"KRN",9.8,"NM","B","PSIVHYPR",11)

"BLD",8406,"KRN",9.8,"NM","B","PSIVLABL",12)

"BLD",8406,"KRN",9.8,"NM","B","PSIVLABR",13)

"BLD",8406,"KRN",9.8,"NM","B","PSIVLB",14)

"BLD",8406,"KRN",9.8,"NM","B","PSIVLBL1",15)

"BLD",8406,"KRN",9.8,"NM","B","PSIVLTR1",19)

"BLD",8406,"KRN",9.8,"NM","B","PSIVOPT1",7)

"BLD",8406,"KRN",9.8,"NM","B","PSIVORAL",46)

"BLD",8406,"KRN",9.8,"NM","B","PSIVORC1",17)

"BLD",8406,"KRN",9.8,"NM","B","PSIVORE1",43)

"BLD",8406,"KRN",9.8,"NM","B","PSIVOREN",49)

"BLD",8406,"KRN",9.8,"NM","B","PSIVORFA",23)

"BLD",8406,"KRN",9.8,"NM","B","PSIVORLB",8)

"BLD",8406,"KRN",9.8,"NM","B","PSIVRD",29)

"BLD",8406,"KRN",9.8,"NM","B","PSIVSP",31)

"BLD",8406,"KRN",9.8,"NM","B","PSIVUTL",47)

"BLD",8406,"KRN",9.8,"NM","B","PSJAC",41)

"BLD",8406,"KRN",9.8,"NM","B","PSJBCMA",1)

"BLD",8406,"KRN",9.8,"NM","B","PSJBCMA1",2)

"BLD",8406,"KRN",9.8,"NM","B","PSJBCMA6",44)

"BLD",8406,"KRN",9.8,"NM","B","PSJCLOR2",20)

"BLD",8406,"KRN",9.8,"NM","B","PSJHL2",24)

"BLD",8406,"KRN",9.8,"NM","B","PSJHL4",45)

"BLD",8406,"KRN",9.8,"NM","B","PSJHL7",27)

"BLD",8406,"KRN",9.8,"NM","B","PSJHL9",28)

"BLD",8406,"KRN",9.8,"NM","B","PSJIBAG",35)

"BLD",8406,"KRN",9.8,"NM","B","PSJLIVFD",21)

"BLD",8406,"KRN",9.8,"NM","B","PSJLIVMD",32)

"BLD",8406,"KRN",9.8,"NM","B","PSJP",50)

"BLD",8406,"KRN",19,0)
19
"BLD",8406,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",8406,"KRN",19,"NM",1,0)
PSJ CD^^0
"BLD",8406,"KRN",19,"NM","B","PSJ CD",1)

"BLD",8406,"KRN",19.1,0)
19.1
"BLD",8406,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",8406,"KRN",101,0)
101
"BLD",8406,"KRN",101,"NM",0)
^9.68A^3^3
"BLD",8406,"KRN",101,"NM",1,0)
PSJU LM COPY^^0
"BLD",8406,"KRN",101,"NM",2,0)
PSJ LM FINISH^^0
"BLD",8406,"KRN",101,"NM",3,0)
PSJI LM VERIFY^^0
"BLD",8406,"KRN",101,"NM","B","PSJ LM FINISH",2)

"BLD",8406,"KRN",101,"NM","B","PSJI LM VERIFY",3)

"BLD",8406,"KRN",101,"NM","B","PSJU LM COPY",1)

"BLD",8406,"KRN",409.61,0)
409.61
"BLD",8406,"KRN",771,0)
771
"BLD",8406,"KRN",779.2,0)
779.2
"BLD",8406,"KRN",870,0)
870
"BLD",8406,"KRN",8989.51,0)
8989.51
"BLD",8406,"KRN",8989.52,0)
8989.52
"BLD",8406,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",8406,"KRN",8994,0)
8994
"BLD",8406,"KRN","B",.4,.4)

"BLD",8406,"KRN","B",.401,.401)

"BLD",8406,"KRN","B",.402,.402)

"BLD",8406,"KRN","B",.403,.403)

"BLD",8406,"KRN","B",.5,.5)

"BLD",8406,"KRN","B",.84,.84)

"BLD",8406,"KRN","B",3.6,3.6)

"BLD",8406,"KRN","B",3.8,3.8)

"BLD",8406,"KRN","B",9.2,9.2)

"BLD",8406,"KRN","B",9.8,9.8)

"BLD",8406,"KRN","B",19,19)

"BLD",8406,"KRN","B",19.1,19.1)

"BLD",8406,"KRN","B",101,101)

"BLD",8406,"KRN","B",409.61,409.61)

"BLD",8406,"KRN","B",771,771)

"BLD",8406,"KRN","B",779.2,779.2)

"BLD",8406,"KRN","B",870,870)

"BLD",8406,"KRN","B",8989.51,8989.51)

"BLD",8406,"KRN","B",8989.52,8989.52)

"BLD",8406,"KRN","B",8994,8994)

"BLD",8406,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",8406,"QUES",0)
^9.62^^
"BLD",8406,"REQB",0)
^9.611^11^9
"BLD",8406,"REQB",2,0)
PSJ*5.0*229^2
"BLD",8406,"REQB",3,0)
PSJ*5.0*258^2
"BLD",8406,"REQB",4,0)
PSJ*5.0*275^2
"BLD",8406,"REQB",5,0)
PSJ*5.0*247^2
"BLD",8406,"REQB",6,0)
PSJ*5.0*285^2
"BLD",8406,"REQB",7,0)
PSJ*5.0*228^2
"BLD",8406,"REQB",8,0)
PSS*1.0*172^2
"BLD",8406,"REQB",10,0)
OR*3.0*266^2
"BLD",8406,"REQB",11,0)
PSJ*5.0*292^2
"BLD",8406,"REQB","B","OR*3.0*266",10)

"BLD",8406,"REQB","B","PSJ*5.0*228",7)

"BLD",8406,"REQB","B","PSJ*5.0*229",2)

"BLD",8406,"REQB","B","PSJ*5.0*247",5)

"BLD",8406,"REQB","B","PSJ*5.0*258",3)

"BLD",8406,"REQB","B","PSJ*5.0*275",4)

"BLD",8406,"REQB","B","PSJ*5.0*285",6)

"BLD",8406,"REQB","B","PSJ*5.0*292",11)

"BLD",8406,"REQB","B","PSS*1.0*172",8)

"FIA",53.1)
NON-VERIFIED ORDERS
"FIA",53.1,0)
^PS(53.1,
"FIA",53.1,0,0)
53.1I
"FIA",53.1,0,1)
y^y^p^^^^n^^n
"FIA",53.1,0,10)

"FIA",53.1,0,11)

"FIA",53.1,0,"RLRO")

"FIA",53.1,0,"VR")
5.0^PSJ
"FIA",53.1,53.1)
1
"FIA",53.1,53.1,59)

"FIA",53.1,53.1,131)

"FIA",53.46)
CLINIC DEFINITION
"FIA",53.46,0)
^PS(53.46,
"FIA",53.46,0,0)
53.46P
"FIA",53.46,0,1)
y^y^p^^^^n^^n
"FIA",53.46,0,10)

"FIA",53.46,0,11)

"FIA",53.46,0,"RLRO")

"FIA",53.46,0,"VR")
5.0^PSJ
"FIA",53.46,53.46)
1
"FIA",53.46,53.46,4)

"FIA",53.46,53.46,5)

"KRN",3.8,403,-1)
0^1
"KRN",3.8,403,0)
PSJ CLINIC DEFINITION^PU^y^^^^
"KRN",3.8,403,2,0)
^3.801^3^3^3130812^^^^
"KRN",3.8,403,2,1,0)
Alerts are sent to this mail group when a valid Clinic Order filed in the
"KRN",3.8,403,2,2,0)
NON-VERIFIED ORDERS (#53.1) file is associated with a location that is 
"KRN",3.8,403,2,3,0)
not defined in the CLINIC DEFINITION (#53.46) file.
"KRN",3.8,403,3)

"KRN",3.8,403,5,0)
^3.811P
"KRN",19,12862,-1)
0^1
"KRN",19,12862,0)
PSJ CD^Clinic Definition^^R^^^^^^^^INPATIENT MEDICATIONS
"KRN",19,12862,1,0)
^19.06^2^2^3130717^^
"KRN",19,12862,1,1,0)
This option allows the site to define how Inpatient Orders for 
"KRN",19,12862,1,2,0)
Outpatients will behave and be handled on a clinic-by-clinic basis.
"KRN",19,12862,25)
ENCD^PSGFILD3
"KRN",19,12862,"U")
CLINIC DEFINITION
"KRN",101,3854,-1)
0^2
"KRN",101,3854,0)
PSJ LM FINISH^Finish^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3854,1,0)
^101.06^1^1^3120412^^^^
"KRN",101,3854,1,1,0)
Allows a user to finish IV, UD, or pending orders for a patient.
"KRN",101,3854,4)
36^4^^FN
"KRN",101,3854,15)
K PSJINFIN,^TMP("PSJINTER",$J) D KILL^PSJBCMA5(+$G(PSJSYSP))
"KRN",101,3854,20)
S PSJINFIN=1 K ^TMP("PSJINTER",$J) D CWARN^PSJBCMA6($G(DFN),$G(PSGORD)),OVRDISF^PSGSICH2($G(DFN),$G(PSGORD),3) D FINISH^PSGOEF
"KRN",101,3854,99)
63035,44348
"KRN",101,3865,-1)
0^1
"KRN",101,3865,0)
PSJU LM COPY^Copy^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3865,15)
S VALMBCK="R"
"KRN",101,3865,20)
Q:$$ACTCLIN^PSJAC(DFN,PSJORD)  D COPY^PSJOE(DFN,PSJORD)
"KRN",101,3865,99)
63035,44348
"KRN",101,4891,-1)
0^3
"KRN",101,4891,0)
PSJI LM VERIFY^Verify^^A^^^^^^^^
"KRN",101,4891,1,0)
^101.06^1^1^3130717^^^^
"KRN",101,4891,1,1,0)
This action allows the user to verify an IV order.
"KRN",101,4891,4)
25^4^^VF
"KRN",101,4891,15)
D SETIVINT^PSGSICH1 K ^TMP("PSJINTER",$J) D KILL^PSJBCMA5(+$G(PSJSYSP))
"KRN",101,4891,20)
N PSJIOPIV S PSJIOPIV=1 D PSBPOIV^PSIVORC1,VF^PSJLIACT,SETNML55^PSIVORC1 D SETIVINT^PSGSICH1 K PSJIOPIV
"KRN",101,4891,99)
63035,44348
"MBREQ")
0
"ORD",11,3.8)
3.8;11;;;MAILG^XPDTA1;MAILGF1^XPDIA1;MAILGE1^XPDIA1;MAILGF2^XPDIA1;;MAILGDEL^XPDIA1(%)
"ORD",11,3.8,0)
MAIL GROUP
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
279^3131001^10000000009
"PKG",197,22,1,"PAH",1,1,0)
^^11^11^3131001
"PKG",197,22,1,"PAH",1,1,1,0)
IMR6 - CLINIC ORDER & DRUG HIGH RISK/ALERT
"PKG",197,22,1,"PAH",1,1,2,0)
 
"PKG",197,22,1,"PAH",1,1,3,0)
IV Bag Logic
"PKG",197,22,1,"PAH",1,1,4,0)
------------
"PKG",197,22,1,"PAH",1,1,5,0)
This patch modifies Inpatient Order Entry so that when Inpatient orders
"PKG",197,22,1,"PAH",1,1,6,0)
are edited, BCMA IV parameters are now checked to determine if IV labels
"PKG",197,22,1,"PAH",1,1,7,0)
were invalidated as a results of the edit. If labels were invalidated, the
"PKG",197,22,1,"PAH",1,1,8,0)
clinician making the edit is informed and a list of the invalidated IV
"PKG",197,22,1,"PAH",1,1,9,0)
labels are displayed. The clinician is given an opportunity to print 
"PKG",197,22,1,"PAH",1,1,10,0)
replacement labels, including when no new order is created as a result of 
"PKG",197,22,1,"PAH",1,1,11,0)
the edit.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
38
"RTN","PSGFILD3")
0^48^B24920479^B23057587
"RTN","PSGFILD3",1,0)
PSGFILD3 ;BIR/CML3-RETURN OF VARIOUS FILES' UPKEEP ;12 DEC 97 / 10:53 AM
"RTN","PSGFILD3",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**279**;16 DEC 97;Build 150
"RTN","PSGFILD3",3,0)
 ; ;
"RTN","PSGFILD3",4,0)
 ;*279 - add fields #4, #5 to Clinic Def file maint (missing dose device and pre-exchange device)
"RTN","PSGFILD3",5,0)
 ;
"RTN","PSGFILD3",6,0)
ENRBLU ;
"RTN","PSGFILD3",7,0)
 S Y=DA(2) N DA,DIC,DIE,DIX,DO,DR
"RTN","PSGFILD3",8,0)
 S DIC="^DG(405.4,",DIC(0)="EIMZ",DIC("S")="I $D(^(""W"",""B"","_Y_"))" D DO^DIC1,^DIC I Y'>0 K X Q
"RTN","PSGFILD3",9,0)
 I $D(^PS(57.7,"AWRT",D0,X)) D EN^DDIOL("THIS ROOM-BED ALREADY ASSIGNED TO TEAM FOR THIS WARD!") K X Q
"RTN","PSGFILD3",10,0)
 S X=Y(0,0) Q
"RTN","PSGFILD3",11,0)
 ;
"RTN","PSGFILD3",12,0)
ENRBQ ;
"RTN","PSGFILD3",13,0)
 S X=DZ,Y=DA(1) N D,DA,DIC,DIE,DO,DR,DZ,XQH
"RTN","PSGFILD3",14,0)
 S DIC="^DG(405.4,",DIC(0)="EIMQ",DIC("S")="I $D(^(""W"",""B"","_Y_"))" D DO^DIC1,^DIC Q
"RTN","PSGFILD3",15,0)
 ;
"RTN","PSGFILD3",16,0)
ENATC ;
"RTN","PSGFILD3",17,0)
 K DIR S DIR(0)="SAO^O:ONE ATC;M:MULTIPLE ATCS",DIR("A",1)="Do you want to set up your drugs for",DIR("A")="(O)ne ATC or (M)ultiple ATCs? ",DIR("B")="ONE ATC",DIR("?")="^D ATCH^PSGFILD3" D ^DIR
"RTN","PSGFILD3",18,0)
 S ATC=$S($D(DIROUT):1,$D(DIRUT):1,$D(DTOUT):1,$D(DTOUT):1,Y="":1,1:Y) I ATC="O" K PSGW S PSGW=0 F Q=0:0 S Q=$O(^PS(57.5,Q)) Q:'Q  I $D(^(Q,0)),$P(^(0),"^",2)="P" S PSGW=PSGW+1,PSGW(Q)=""
"RTN","PSGFILD3",19,0)
 I 'ATC,$S(ATC="O":'PSGW,1:'$D(^PS(57.5,"AP"))) W $C(7),!!?3,"NOTE: No PHARMACY ward groups are found.  You will not be able to enter",!?9,"canister numbers for selected drugs.",!
"RTN","PSGFILD3",20,0)
 I 'ATC F FQ=0:0 W ! S DIC="^PSDRUG(",DIC(0)="QEAM",DIC("S")="I $D(^(2)),$P(^(2),""^"",3)[""U""" D ^DIC K DIC Q:Y'>0  D ATCED
"RTN","PSGFILD3",21,0)
 K ATC,ATCN,DA,DIC,DIE,DIR,DIROUT,DIRUT,DTOUT,DUOUT,DLAYGO,DR,FQ,PSGW,X,Y Q
"RTN","PSGFILD3",22,0)
 ;
"RTN","PSGFILD3",23,0)
ATCED ;
"RTN","PSGFILD3",24,0)
 K DA,DR S DIE="^PSDRUG(",DA=+Y,DR=212.2 I ATC="M",$D(^PS(57.5,"AP")) S DR=DR_";212",DR(2,50.0212)="1"
"RTN","PSGFILD3",25,0)
 D ^DIE Q:$S($D(Y):1,ATC="M":1,1:'PSGW)  K DIR S DIR(0)="50.0212,1" D ^DIR Q:'Y  S ATCN=+Y,DA(1)=DA W !,"...working..." S:'$D(^PSDRUG(DA,212,0)) ^(0)="^50.0212P" F FQ=0:0 S FQ=$O(PSGW(FQ)) Q:'FQ  D ATCCNS
"RTN","PSGFILD3",26,0)
 Q
"RTN","PSGFILD3",27,0)
 ;
"RTN","PSGFILD3",28,0)
ATCCNS ;
"RTN","PSGFILD3",29,0)
 W "." S DA=$O(^PSDRUG(DA(1),212,"B",FQ,0)) I DA,$D(^PSDRUG(DA(1),212,DA,0)) Q:$P(^(0),"^",2)=ATCN  S DIE="^PSDRUG("_DA(1)_",212,",DR="1////"_ATCN D ^DIE Q
"RTN","PSGFILD3",30,0)
 K DD,DO S DIC="^PSDRUG("_DA(1)_",212,",DIC(0)="L",DIC("DR")="1////"_ATCN,DLAYGO=50.0212,X=FQ D FILE^DICN Q
"RTN","PSGFILD3",31,0)
 ;
"RTN","PSGFILD3",32,0)
ATCH ;
"RTN","PSGFILD3",33,0)
 W !!?2,"Enter 'M' to set up your drugs for use with multiple ATC Dispensing machines,",!,"for which you will have to enter a canister number for each ward group.  Enter",!,"'O' to set up your drugs for use with one ATC Dispensing machine"
"RTN","PSGFILD3",34,0)
 W ", for which",!,"the ward groups will be automatically set up for each canister number.",!,"CHOOSE FROM:",!?5,"O - ONE ATC",!?5,"M - MULTIPLE ATCS" Q
"RTN","PSGFILD3",35,0)
 ;
"RTN","PSGFILD3",36,0)
ENIU ; mark/unmark drugs for Unit Dose use
"RTN","PSGFILD3",37,0)
 K DIR S DIR(0)="SAO^M:MARK FOR UNIT DOSE;U:UNMARK FOR UNIT DOSE",DIR("A")="Do you want to (M)ARK or (U)NMARK items for Unit Dose? ",DIR("B")="UNMARK",DIR("?")="^D ENIUH^PSGFILD3"
"RTN","PSGFILD3",38,0)
 W ! D ^DIR K DIR,DIROUT,DIRUT,DTOUT,DUOUT I Y'="U",Y'="M" K X,Y Q
"RTN","PSGFILD3",39,0)
 S PSGY=Y,PSGS="I $P($G(^(2)),""^"",3)"_$E("'",PSGY="M")_"[""U""",PSIUX="U" K DIC
"RTN","PSGFILD3",40,0)
 F  S DIC="^PSDRUG(",DIC(0)="QEAM",DIC("A")="Select DRUG: ",DIC("S")=PSGS W ! D ^DIC K DIC Q:Y'>0  S PSIUDA=+Y D:PSGY="U" END^PSGIU D:PSGY="M" ENS^PSGIU W "..." W:PSGY="U" "UN" W "MARKED..."
"RTN","PSGFILD3",41,0)
 K FQ,PSIUDA,PSIUX,PSGS,PSGY Q
"RTN","PSGFILD3",42,0)
 ;
"RTN","PSGFILD3",43,0)
ENIUH ;
"RTN","PSGFILD3",44,0)
 W !!?2,"Enter 'M' to mark items for use by the Unit Dose Medications package.  (You",!,"will only be shown items that have not been marked for Unit Dose.)",!?2,"Enter 'U' to unmark items that have previously been marked for use with Unit"
"RTN","PSGFILD3",45,0)
 W !,"Dose.  (You will be shown only items that have already been marked for Unit",!,"Dose.)",!!,"Choose from:",!?3,"M  MARK ITEMS FOR UNIT DOSE",!?3,"U  UNMARK ITEMS FOR UNIT DOSE" Q
"RTN","PSGFILD3",46,0)
 ;
"RTN","PSGFILD3",47,0)
ENCD ;edit Clinic Definitions file
"RTN","PSGFILD3",48,0)
 N CLINICS,CLINFLG S CLINICS=""
"RTN","PSGFILD3",49,0)
 F  K DIC S DIC="^PS(53.46,",DIC(0)="AELMQ",DIC("A")="Select CLINIC: ",DLAYGO=53.46 D ^DIC K DIC Q:Y<0  D
"RTN","PSGFILD3",50,0)
 . S DIE="^PS(53.46,",DA=+Y,CLINICS(DA)="",DR="1;2;3;4;5;6" D ^DIE K DIE,DA,DR Q
"RTN","PSGFILD3",51,0)
 I ($T(IMO^PSJIMO1)]"") D IMO^PSJIMO1(.CLINICS)
"RTN","PSGFILD3",52,0)
 Q
"RTN","PSGP")
0^3^B11793961^B11695903
"RTN","PSGP",1,0)
PSGP ;BIR/CML3-PATIENT LOOK-UP ;15 Apr 98 / 9:05 AM
"RTN","PSGP",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**10,53,111,181,267,275,279**;16 DEC 97;Build 150
"RTN","PSGP",3,0)
 ;
"RTN","PSGP",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGP",5,0)
 ; Reference to ^SDAMA203 is supported by DBIA 4133.
"RTN","PSGP",6,0)
 ;
"RTN","PSGP",7,0)
ENDPT ; get any patient
"RTN","PSGP",8,0)
 N HIT
"RTN","PSGP",9,0)
 K DIC,PSGP,Y W !!,"Select "_$S($D(PSGDICA):PSGDICA_" ",1:"")_"PATIENT: " R X:DTIME S:X["^" PSJSTOP=1 I "^"[X S (Y,PSGP)=-1 G DONE
"RTN","PSGP",10,0)
 D EN^PSJDPT
"RTN","PSGP",11,0)
 I Y'>0 G ENDPT
"RTN","PSGP",12,0)
 K DIC
"RTN","PSGP",13,0)
 ;
"RTN","PSGP",14,0)
CHK ;
"RTN","PSGP",15,0)
 ;Clean up arrays use in order checks
"RTN","PSGP",16,0)
 K PSJEXCPT,PSJOCER
"RTN","PSGP",17,0)
 S (DFN,PSGP)=+Y,VA200=1 D INP^VADPT
"RTN","PSGP",18,0)
 I VAIN(4) S PSJPCAF=1_"^"_VAIN(1),PSJPWD=+VAIN(4),PSJPWDN=$P(VAIN(4),"^",2),PSJPTS=+VAIN(3),PSJPTSP=+VAIN(2),PSJPRB=VAIN(5),PSJPAD=+VAIN(7),PSJPDX=VAIN(9),PSJPTD=$P($G(^PS(55,PSGP,5.1)),"^",4),PSJPDD="" G CNV
"RTN","PSGP",19,0)
 S PSJPCAF="",VAIP("D")="L" D IN5^VADPT I 'VAIP(13,1) W $C(7),!!?3,"PATIENT HAS NEVER BEEN ADMITTED." D ENCONT^PSJP I '(%=1) G ENDPT
"RTN","PSGP",20,0)
 S PSJPAD=VAIP(13,1),PSGID=+VAIP(3),X=+VAIP(4)=12!(+VAIP(4)=38),PSGOD=$$ENDTC^PSGMI(PSGID)
"RTN","PSGP",21,0)
 I $G(PSGOD) W $C(7),!!?3,"PATIENT IS FOUND TO BE D",$P("ISCHARG^ECEAS","^",X+1),"ED AS OF ",PSGOD,"." D ENCONT^PSJP I '(%=1) G ENDPT
"RTN","PSGP",22,0)
 S PSJPAD=VAIP(13,1),PSJPWD=+VAIP(5),PSJPWDN=$P(VAIP(5),"^",2),PSJPRB=$P(VAIP(6),"^",2),PSJPTSP=+VAIP(7),PSJPTS=+VAIP(8),PSJPDX=VAIP(9),PSJPTD="",PSJPDD=PSGID_"^"_PSGOD S:X PSJPDD=PSJPDD_"^1"
"RTN","PSGP",23,0)
 ;
"RTN","PSGP",24,0)
CNV ;
"RTN","PSGP",25,0)
 I $G(DFN) I '$$AA^PSJDPT(DFN) S Y=-1 G ENDPT
"RTN","PSGP",26,0)
 D DEM^VADPT,PID^VADPT,HTWT^PSJAC(DFN)
"RTN","PSGP",27,0)
 S PSGP(0)=VADM(1),PSJPSSN=VADM(2),PSJPDOB=+VADM(3),PSJPAGE=VADM(4),PSJPSEX=$S(VADM(5)]"":VADM(5),1:"?^____"),PSJPPID=VA("PID"),PSJPBID=VA("BID")
"RTN","PSGP",28,0)
 F X="PSJPAD","PSJPDOB","PSJPTD" I +@X S $P(@X,"^",2)=$$ENDTC^PSGMI(+@X)
"RTN","PSGP",29,0)
 ;
"RTN","PSGP",30,0)
WP ; ward parameters
"RTN","PSGP",31,0)
 S PSJSYSW0="",PSJSYSW=0 I PSJPWD S PSJSYSW=+$O(^PS(59.6,"B",PSJPWD,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSGP",32,0)
 S PSJSYSL="",X=$P(PSJSYSU,";",3)>1,PSJSYSL=$S(X=0:$P(PSJSYSW0,"^",12),1:$P(PSJSYSW0,"^",16))
"RTN","PSGP",33,0)
 S PSJDCEXP=$$RECDCEXP^PSJP()
"RTN","PSGP",34,0)
 I PSJSYSL D
"RTN","PSGP",35,0)
 .S:X X='$P(PSJSYSP0,"^",10) S IOP=$S($P(PSJSYSP0,"^",13)]"":$P(PSJSYSP0,"^",13),$P(PSJSYSW0,"^",19+X)]"":$P(PSJSYSW0,"^",19+X),1:"") I IOP]"" D
"RTN","PSGP",36,0)
 ..S IOP="`"_IOP K %ZIS S %ZIS="NQ" D ^%ZIS S:'POP $P(PSJSYSL,"^",2,3)=ION_"^"_IO D ^%ZISC
"RTN","PSGP",37,0)
 ;
"RTN","PSGP",38,0)
 D CLINIC^PSJAC
"RTN","PSGP",39,0)
DONE ;
"RTN","PSGP",40,0)
 K DA,DIC,NB,ND,NS,PSGID,PSGOD,VA200,VADM,VAIN,VAIP,VAMT,X,Y(0),Y(0,0) Q
"RTN","PSGP",41,0)
 ;
"RTN","PSGP",42,0)
COP ;check for appointments in clinics that allowed inpatient orders
"RTN","PSGP",43,0)
 S HIT=0 Q:'$$PATCH^XPDUTL("SD*5.3*285")
"RTN","PSGP",44,0)
 N SQ,A,VAIP,X,PSJF
"RTN","PSGP",45,0)
 D IN5^VADPT
"RTN","PSGP",46,0)
 D NOW^%DTC S (PSJF,VASD("F"))=$P(%,".")-1
"RTN","PSGP",47,0)
 D SDA^VADPT
"RTN","PSGP",48,0)
 S SQ=0 F  S SQ=$O(^UTILITY("VASD",$J,SQ)) Q:'SQ  S A=^(SQ,"I") I $$SDIMO^SDAMA203($P(A,"^",2),DFN)>0 S HIT=1 Q
"RTN","PSGP",49,0)
 I $O(^PS(55,DFN,5,"AUN",PSJF))!($O(^PS(55,DFN,"IV","AIN",PSJF))) S HIT=1
"RTN","PSGP",50,0)
 I HIT D ENCONT^PSJP
"RTN","PSGP",51,0)
 Q
"RTN","PSGPER")
0^36^B18332674^B11838843
"RTN","PSGPER",1,0)
PSGPER ;BIR/CML3-PRINTS PRE-EXCHANGE NEEDS REPORT ;04 JAN 95 / 5:08 PM
"RTN","PSGPER",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**95,115,127,133,279**;16 DEC 97;Build 150
"RTN","PSGPER",3,0)
 ;
"RTN","PSGPER",4,0)
EN ; Entry point
"RTN","PSGPER",5,0)
 S PSGPERRF=0,POP=0 N PSGPRCLD,PSGCURCL S PSGPRCLD="" D DEFCL^PSGPER1(PSGPXN,.PSGPRCLD)
"RTN","PSGPER",6,0)
 N PSGPRTYP,PSGPRCL
"RTN","PSGPER",7,0)
 I $G(PSGPRCLD("WARD")) S PSGPRTYP="PSGPERP" D DEV K PSGPRCLD("WARD")
"RTN","PSGPER",8,0)
 I POP D POP G:%=1 EN D OUT Q
"RTN","PSGPER",9,0)
 I $D(PSGPRCLD)>1 S PSGPRTYP="PSGPERPC" S PSGCURCL="" F  S PSGCURCL=$O(PSGPRCLD("DEV",PSGCURCL)) Q:PSGCURCL=""  D DEV
"RTN","PSGPER",10,0)
 D OUT
"RTN","PSGPER",11,0)
 Q
"RTN","PSGPER",12,0)
DEV ; Select Device
"RTN","PSGPER",13,0)
 S PSGION=ION
"RTN","PSGPER",14,0)
 D DEV1
"RTN","PSGPER",15,0)
 Q
"RTN","PSGPER",16,0)
DEV1 ; Get default device, select and validate device
"RTN","PSGPER",17,0)
 Q:'$$DEFON^PSGPER1
"RTN","PSGPER",18,0)
 W !!,"PRE-EXCHANGE UNITS REPORT"
"RTN","PSGPER",19,0)
 I ($G(PSGCURCL)="") S D=$S($G(PSGPXDEV):PSGPXDEV,1:$P(PSJSYSW0,U,29))
"RTN","PSGPER",20,0)
 I $L($G(PSGCURCL)) S D=$G(PSGPRCLD("DEV",PSGCURCL))
"RTN","PSGPER",21,0)
 S:D="" D="HOME" S IOP=$S(D:"`"_D,1:D) K %ZIS S %ZIS="NQ" D ^%ZIS S D=$G(ION)
"RTN","PSGPER",22,0)
 K IOP,%ZIS,IO("Q") S %ZIS="Q",%ZIS("A")="Select DEVICE for "_$S($G(PSGPRCLD("WARD")):"Ward "_$G(^DPT(DFN,.1)),$G(PSGCURCL)]"":"Clinic "_PSGCURCL,1:"")_": ",%ZIS("B")=$S(($G(PSGCURCL)]""):$G(PSGPRCLD("DEV",PSGCURCL)),1:D)
"RTN","PSGPER",23,0)
 D ^%ZIS K %ZIS I POP D POP G:%=1 DEV1
"RTN","PSGPER",24,0)
 I D'=$G(ION) D CURDEF
"RTN","PSGPER",25,0)
 I $D(IO("Q")) K ZTSAVE S PSGTIR="^PSGPER0",ZTDESC="PRE-EXCHANGE UNITS REPORT",ZTDTH=$H,ZTSAVE("PSGPXN")="",ZTSAVE("PSGPRTYP")="",ZTSAVE("PSGCURCL")="",ZTSAVE("DFN")="" D ENTSK^PSGTI G:'$D(ZTSK) DEV1 K ZTSK Q
"RTN","PSGPER",26,0)
 D ENP^PSGPER0:'$G(PSGPXPT),ENPAT^PSGPER0:$G(PSGPXPT),AG
"RTN","PSGPER",27,0)
 I %=1 S PSGPERRF=1 G DEV1
"RTN","PSGPER",28,0)
 Q
"RTN","PSGPER",29,0)
 ;
"RTN","PSGPER",30,0)
OUT ; Clean up on the way out
"RTN","PSGPER",31,0)
 D TASKPRGE^PSGPER1(PSGPXN)
"RTN","PSGPER",32,0)
 K PSGPERRF,PSGPXN
"RTN","PSGPER",33,0)
 Q:$G(PSJCOM)!$G(PSJPREX)
"RTN","PSGPER",34,0)
 N PSJSYSW0,PSGVBW,PSJPWD,PSJSYSL D  Q
"RTN","PSGPER",35,0)
 . D:'$G(PSGPXPT) ENIVKV^PSGSETU
"RTN","PSGPER",36,0)
 Q
"RTN","PSGPER",37,0)
 ;
"RTN","PSGPER",38,0)
POP ; Abort?
"RTN","PSGPER",39,0)
 S %=2 W:'PSGPERRF !!,"IF A DEVICE IS NOT CHOSEN, NO REPORT WILL BE RUN AND THE DATA WILL NO LONGER BE RETRIEVABLE THROUGH THIS REPORT."
"RTN","PSGPER",40,0)
 I 'PSGPERRF F  W !,"Do you want another chance to choose a device" S %=1 D YN^DICN Q:%  W !?3,"Enter 'YES' to choose a device to print.  Enter 'NO' to quit now."
"RTN","PSGPER",41,0)
 I %'=1 S IOP=PSGION D ^%ZIS S %=2
"RTN","PSGPER",42,0)
 Q
"RTN","PSGPER",43,0)
 ;
"RTN","PSGPER",44,0)
AG ;
"RTN","PSGPER",45,0)
 F  W !!,"DO YOU NEED TO PRINT THIS REPORT AGAIN" S %=2 D YN^DICN Q:%  D AGMSG
"RTN","PSGPER",46,0)
 Q
"RTN","PSGPER",47,0)
 ;
"RTN","PSGPER",48,0)
AGMSG ;
"RTN","PSGPER",49,0)
 I %Y'?1."?" W $C(7),"  ANSWER 'YES' OR 'NO' (Entry required)" Q
"RTN","PSGPER",50,0)
 W !,"  Enter 'YES' to print this report again.  Enter 'NO' (or an '^') to quit",!,"now.  PLEASE NOTE that you will NOT be able to retrieve this data at a later",!,"date.  You should print this information now." Q
"RTN","PSGPER",51,0)
CURDEF ;
"RTN","PSGPER",52,0)
 Q:$G(PSGPXDEV)=0
"RTN","PSGPER",53,0)
 K DIC,DR,DA,X,Y,DIE S DIC="^%ZIS(1,",DIC(0)="SOX",X=ION D ^DIC Q:'($G(Y)>0)
"RTN","PSGPER",54,0)
 N D,DN S D=+$G(Y),DN=$P($G(Y),"^",2)
"RTN","PSGPER",55,0)
 F  W !!,"Keep ",ION," as the PRE-EXCHANGE REPORT DEVICE for this session" S %=0 D YN^DICN S PSGPXDEV=$S(%=1:D,1:0) Q:%  D DEFMSG
"RTN","PSGPER",56,0)
 I $G(Y) S:($G(PSGCURCL)="") $P(PSJSYSW0,"^",29)=+Y I ($G(PSGCURCL)]"") N CLIEN S CLIEN=$O(^SC("B",PSGCURCL,"")) I CLIEN S $P(PSJSYSW0("CLINIC",CLIEN,1),"^")=D,PSGPRCLD("DEV",PSGCURCL)=DN
"RTN","PSGPER",57,0)
 K DIC,DR,DA,X,Y,DIE
"RTN","PSGPER",58,0)
 Q
"RTN","PSGPER",59,0)
 ;
"RTN","PSGPER",60,0)
DEFMSG ;
"RTN","PSGPER",61,0)
 I %Y'?1."?" W !,$C(7),"     ANSWER 'YES' OR 'NO' (Entry required)" Q
"RTN","PSGPER",62,0)
 W !!,"  Enter 'YES' to make ",ION," the PRE-EXCHANGE REPORT default DEVICE"
"RTN","PSGPER",63,0)
 W !,"  for the current session. PLEASE NOTE that this will override the ward"
"RTN","PSGPER",64,0)
 W !,"  default PRE-EXCHANGE REPORT DEVICE for this session only."
"RTN","PSGPER",65,0)
 Q
"RTN","PSGPER0")
0^38^B34370854^B26511977
"RTN","PSGPER0",1,0)
PSGPER0 ;BIR/CML3-PRINTS PRE-EXCHANGE NEEDS REPORT ;24 JAN 94 / 11:14 AM
"RTN","PSGPER0",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**58,82,95,115,279**;16 DEC 97;Build 150
"RTN","PSGPER0",3,0)
 ;
"RTN","PSGPER0",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGPER0",5,0)
 ;
"RTN","PSGPER0",6,0)
ENQ ;
"RTN","PSGPER0",7,0)
 D ENP:'$G(PSGPXPT),ENPAT:$G(PSGPXPT)
"RTN","PSGPER0",8,0)
 D TASKPRGE^PSGPER1(PSGPXN)
"RTN","PSGPER0",9,0)
 K DA,DIK,PSGPXN
"RTN","PSGPER0",10,0)
 Q
"RTN","PSGPER0",11,0)
 ;
"RTN","PSGPER0",12,0)
ENPAT ;
"RTN","PSGPER0",13,0)
 Q:'$G(DFN)
"RTN","PSGPER0",14,0)
 N PSGPRSUB S PSGPRSUB=$S($G(PSGPRTYP)="PSGPERPC":"PSGPERPC",1:"PSGPER")
"RTN","PSGPER0",15,0)
 K ^TMP("PSGPER",$J),^TMP("PSGPERPC",$J) U IO D PAT,DONE
"RTN","PSGPER0",16,0)
 Q
"RTN","PSGPER0",17,0)
 ;
"RTN","PSGPER0",18,0)
ENP ;
"RTN","PSGPER0",19,0)
 K ^TMP("PSGPER",$J) U IO
"RTN","PSGPER0",20,0)
 N PSGPRSUB S PSGPRSUB=$S($G(PSGPRTYP)="PSGPERPC":"PSGPERPC",1:"PSGPER")
"RTN","PSGPER0",21,0)
 F DFN=0:0 S DFN=$O(^PS(53.4,PSGPXN,1,DFN)) Q:'DFN  U IO D PAT,DONE
"RTN","PSGPER0",22,0)
 Q
"RTN","PSGPER0",23,0)
 ;
"RTN","PSGPER0",24,0)
PAT ;
"RTN","PSGPER0",25,0)
 D PID^VADPT,GWR F ON=0:0 S ON=$O(^PS(53.4,PSGPXN,1,DFN,1,ON)) Q:ON=""  D ONI F DD=0:0 S DD=$O(^PS(53.4,PSGPXN,1,DFN,1,ON,1,DD)) Q:'DD  I $D(^(DD,0)) S ND=^(0) D DDS
"RTN","PSGPER0",26,0)
 D NOW^%DTC S %=$$ENDTC^PSGMI(%),(BORD,F,L)="",$P(L,"-",81)="",$P(BORD,"#",25)="",T=IO'=IO(0)!($E(IOST)'="C"),RF=$S(T:0,1:0) D:'RF HEADER S (DN,DDN,NP,WD)=""
"RTN","PSGPER0",27,0)
 F  S WD=$O(^TMP(PSGPRSUB,$J,WD)) Q:WD=""  S PI="" F  S F=0,PI=$O(^TMP(PSGPRSUB,$J,WD,PI)) Q:PI=""  S RB=^(PI) D
"RTN","PSGPER0",28,0)
 .Q:'$$NSYNC^PSGPER2(PSGPRSUB,WD,$G(PSGCURCL))
"RTN","PSGPER0",29,0)
 .D PPI F  S F=1,DN=$O(^TMP(PSGPRSUB,$J,WD,PI,DN)) Q:DN=""  S PX=^(DN) D OP F  S DDN=$O(^TMP(PSGPRSUB,$J,WD,PI,DN,DDN)) Q:DDN=""  S PX=^(DDN) D PRT
"RTN","PSGPER0",30,0)
 .I $O(^TMP(PSGPRSUB,$J,WD,PI))]"" S F="" D NP
"RTN","PSGPER0",31,0)
 W:T&($Y) @IOF,@IOF D ^%ZISC
"RTN","PSGPER0",32,0)
 Q
"RTN","PSGPER0",33,0)
 ;
"RTN","PSGPER0",34,0)
DONE ;
"RTN","PSGPER0",35,0)
 K ^TMP(PSGPRSUB,$J),BORD,DN,DD,DO,DRG,DRGS,F,L,MR,ND,ND0,ND2,ND4,NP,ON,PI,PDN,PN,PX,RB,RF,SCH,SDN,SN,SND1,SPN,STOP,STRT,T,UD,VD,VU,W,WD,X,XL,Y,DDN,I2,ND1,PSG25,PSG26,PSGEB,PSGEBN,PSGNODE,PSGOAT,PSGSTAT
"RTN","PSGPER0",36,0)
 K DONE,FIL,NF,PDM,PDRG,PSGACTO,PSGDA,PSGNEFDO,PSGNESDO,PSGPEN,PSGPENWS,PSGY,PSIVAC,PSIVCT,PSIVE,PSIVEXAM,PSIVUP,PSIVWAT,PSJH,PSJNOO,PSJNOON
"RTN","PSGPER0",37,0)
 Q
"RTN","PSGPER0",38,0)
 ;
"RTN","PSGPER0",39,0)
NP ;
"RTN","PSGPER0",40,0)
 I 'T K DIR S DIR(0)="E" W ! D ^DIR S:'Y WD="zzz" W:Y $C(13),# Q
"RTN","PSGPER0",41,0)
 ;
"RTN","PSGPER0",42,0)
HEADER ;
"RTN","PSGPER0",43,0)
 W:$Y @IOF W !?20,"PRE-EXCHANGE UNITS REPORT - ",%
"RTN","PSGPER0",44,0)
 W !!,$S(($G(PSGCURCL)]""):"Clinic",1:"Ward"),?32,"Room-bed",!,"Patient",!?5,"Order",!?20,"Dispense Drug",?64,"U/D",?72,"Needs",!,L
"RTN","PSGPER0",45,0)
 W:F !!,$S(WD'="zz":WD,1:"NOT FOUND"),?32,RB,!,PN_"  ("_SN_")"
"RTN","PSGPER0",46,0)
 Q
"RTN","PSGPER0",47,0)
 ;
"RTN","PSGPER0",48,0)
GWR ;
"RTN","PSGPER0",49,0)
 D PID^VADPT
"RTN","PSGPER0",50,0)
 S WD=$G(^DPT(DFN,.1)),RB=$G(^(.101)),PN=$P($G(^(0)),"^") S:WD="" WD="zz" S:RB="" RB="NOT FOUND" S:PN="" PN=DFN_";DPT("
"RTN","PSGPER0",51,0)
 S SPN=$E(PN,1,20)_"^"_DFN,^TMP(PSGPRSUB,$J,WD,SPN)=PN_"^"_RB_"^"_VA("BID") Q
"RTN","PSGPER0",52,0)
 ;
"RTN","PSGPER0",53,0)
ONI ;
"RTN","PSGPER0",54,0)
 S ND=$G(^PS(55,DFN,5,ON,0)),DN=$G(^(.2)),SCH=$P($G(^(2)),"^"),MR=$P(ND,"^",3),ND=$$ENNPN^PSGMI($P(ND,"^",2)),DO=$P(DN,"^",2),DN=$P(DN,"^") I DN="" S DN="zz"
"RTN","PSGPER0",55,0)
 E  S DN=$$ENPDN^PSGMI(DN)
"RTN","PSGPER0",56,0)
 I ($$CLINIC^PSJO1(DFN,+ON_"U")]"") Q:(PSGPRSUB'="PSGPERPC")  N CLINIC S CLINIC=+$G(^PS(55,DFN,5,+ON,8)) I CLINIC S CLINIC=$P($G(^SC(+CLINIC,0)),"^") I (CLINIC]"") S WD=CLINIC,^TMP("PSGPERPC",$J,WD,SPN)=PN_"^^"_VA("BID") D
"RTN","PSGPER0",57,0)
 .I $D(^TMP(PSGPRSUB,$J,"zz",SPN)),($O(^TMP(PSGPRSUB,$J,"zz",SPN,""))="") K ^TMP(PSGPRSUB,$J,"zz",SPN)
"RTN","PSGPER0",58,0)
 S:MR]"" MR=$$ENMRN^PSGMI(MR) S SDN=$E(DN,1,20)_"^"_ON,^TMP(PSGPRSUB,$J,WD,SPN,SDN)=DN_"^"_DO_"^"_MR_"^"_SCH_"^"_$P(ND,"^",2)
"RTN","PSGPER0",59,0)
 S ^TMP($J,"PSGPRKILL",PSGPXN,DFN,ON)=""
"RTN","PSGPER0",60,0)
 Q
"RTN","PSGPER0",61,0)
 ;
"RTN","PSGPER0",62,0)
DDS ;
"RTN","PSGPER0",63,0)
 Q:'$$NSYNC^PSGPER2(PSGPRSUB,WD,$G(PSGCURCL))
"RTN","PSGPER0",64,0)
 I ($$CLINIC^PSJO1(DFN,+ON_"U")]"") Q:(PSGPRSUB'="PSGPERPC")
"RTN","PSGPER0",65,0)
 S ND1=$G(^PS(55,DFN,5,ON,1,+ND,0)),UD=$P(ND1,"^",2),ND1=$$ENDDN^PSGMI(+ND1),SND1=$E(ND1,1,20)_"^"_+ND,ND=$P(ND,"^",2)
"RTN","PSGPER0",66,0)
 I ND#1 S ND=(ND\1)+1
"RTN","PSGPER0",67,0)
 S ^TMP(PSGPRSUB,$J,WD,SPN,SDN,SND1)=ND1_"^"_UD_"^"_ND
"RTN","PSGPER0",68,0)
 Q
"RTN","PSGPER0",69,0)
 ;
"RTN","PSGPER0",70,0)
PPI ;
"RTN","PSGPER0",71,0)
 S DFN=$P(PI,"^",2),PN=$P(RB,"^"),SN=$P(RB,"^",3),RB=$P(RB,"^",2) I 'RF,$Y+6>IOSL D NP Q:NP["^"
"RTN","PSGPER0",72,0)
 W !!,$S(WD'="zz":WD,1:"NOT FOUND"),?32,RB,!,PN,"  ("_SN_")" Q
"RTN","PSGPER0",73,0)
 ;
"RTN","PSGPER0",74,0)
OP ;
"RTN","PSGPER0",75,0)
 S PDN=$P(PX,"^"),DO=$P(PX,"^",2),MR=$P(PX,"^",3),SCH=$P(PX,"^",4)
"RTN","PSGPER0",76,0)
 W !?5,PDN," ",DO," ",MR,$S(MR]"":" ",1:""),SCH
"RTN","PSGPER0",77,0)
 Q
"RTN","PSGPER0",78,0)
PRT ; find order info and print same
"RTN","PSGPER0",79,0)
 I 'RF,$Y+4>IOSL D NP Q:NP="^"
"RTN","PSGPER0",80,0)
 I 1 S PDN=$P(PX,"^"),UD=$P(PX,"^",2),PX=$P(PX,"^",3) W !?20,PDN,?62,$J($S('UD:1,$E(UD)=".":0_UD,1:UD),5),?72,$J(PX,5) Q
"RTN","PSGPER0",81,0)
 S ON=$P(DN,"^",2),ND=$G(^PS(55,DFN,5,ON,0)),ND2=$G(^(2)),ND4=$G(^(4)),Y=$P($G(^(6)),"^"),ND0=$G(^(.1)),DO=$P(ND0,"^",2)
"RTN","PSGPER0",82,0)
 S DRG=$$ENDDN^PSGMI($P(ND0,"^")),MR=$$ENMRN^PSGMI(MR) ; ,DRGS=$P($G(^(+$O(^PS(55,DFN,5,ON,1,0)),0)),"^")
"RTN","PSGPER0",83,0)
 I 'RF W !?5,DRG,?47,DO,?65,$J($S('UD:1,UD=.5:"1/2",UD=.25:"1/4",UD?1".".N:0_UD,1:UD),5),?75,$J(+PX,5) Q
"RTN","PSGPER0",84,0)
 ;
"RTN","PSGPER0",85,0)
 S SCH=$P(ND2,"^"),STRT=$P(ND2,"^",2),STOP=$P(ND2,"^",4),VU=$P(ND4,"^",3),VD=$P(ND4,"^",4),VU=$P($G(^VA(200,+VU,0)),"^",2) S:VU="" VU=$P(ND4,"^",3)
"RTN","PSGPER0",86,0)
 F Q="STRT","STOP","VD" S @Q=$$ENDTC^PSGMI(@Q)
"RTN","PSGPER0",87,0)
 W:$Y @IOF W !!?6,BORD_"  PRE-EXCHANGE MED  "_BORD,!?6,"#",?73,"#",!?6,"#  ",PN,?50,$S(($G(PSGCURCL)]""):"Clinic: ",1:"Ward: "),WD,?73,"#",!?6,"#  ("_SN_")",?52,"RB: "_RB,?73,"#",!?6,"#",?73,"#"
"RTN","PSGPER0",88,0)
 W !?6,"#  "_DRG,?46,"START: "_STRT,?73,"#",!?6,"#  "_$S(DRGS]"":"("_DRGS_")",1:""),?47,"STOP: "_STOP,?73,"#",!?6,"#  GIVE: "_$S(DO]"":" "_DO,1:"")_$S(MR]"":" "_MR,1:"")_$S(SCH]"":" "_SCH,1:""),?73,"#"
"RTN","PSGPER0",89,0)
 S XL=0 I Y="" W !?6,"#",?73,"#",!?6,"#  (NO SPECIAL INSTRUCTIONS)"
"RTN","PSGPER0",90,0)
 E  W !?6,"#",?73,"#",!?6,"#    " S Y=$$ENSET^PSGSICHK(Y) F Q=1:1:$L(Y," ") S X=$P(Y," ",Q) S:$X+$L(X)>72 XL=XL+1 W:$X+$L(X)>72 ?73,"#",!?6,"#  " W X_" "
"RTN","PSGPER0",91,0)
 W ?73,"#",!?6,"#",?73,"#",!,?6,"#",?43,"VERIFIED: "_VD,?73,"#",!?6,"#",?49,"BY: "_VU,?73,"#",!?6,"#",?38,"SEND TO FLOOR: "_PX,?73,"#"
"RTN","PSGPER0",92,0)
 S XL=2-XL I XL>0 F Q=1:1:XL W !?6,"#",?73,"#"
"RTN","PSGPER0",93,0)
 W !?6,"#",?73,"#",!?6,"#",?36,"_______________     _______________  #",!?6,"#",?36,"FILLED BY",?56,"CHECKED BY",?73,"#",!?6,BORD_BORD_$E(BORD,1,20) Q
"RTN","PSGPER1")
0^37^B18498632^B7625269
"RTN","PSGPER1",1,0)
PSGPER1 ;BIR/CML3-PRINTS PRE-EXCHANGE NEEDS REPORT ;18 MAR 03 / 5:08 PM
"RTN","PSGPER1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**80,127,279**;16 DEC 97;Build 150
"RTN","PSGPER1",3,0)
 ;
"RTN","PSGPER1",4,0)
EN ; Entry point
"RTN","PSGPER1",5,0)
 S PSGPERRF=0,POP=0 N PSGPRCLD,PSGCURCL S PSGPRCLD="" D DEFCL(PSGPXN,.PSGPRCLD)
"RTN","PSGPER1",6,0)
 N PSGPRTYP,PSGPRCL
"RTN","PSGPER1",7,0)
 I $G(PSGPRCLD("WARD")) S PSGPRTYP="PSGPERP" D DEV K PSGPRCLD("WARD")
"RTN","PSGPER1",8,0)
 I POP D POP G:%=1 EN G DONE
"RTN","PSGPER1",9,0)
 I $D(PSGPRCLD)>1 S PSGPRTYP="PSGPERPC" S PSGCURCL="" F  S PSGCURCL=$O(PSGPRCLD("DEV",PSGCURCL)) Q:PSGCURCL=""  D DEV
"RTN","PSGPER1",10,0)
 D DONE
"RTN","PSGPER1",11,0)
 Q
"RTN","PSGPER1",12,0)
DEV ; Select Device
"RTN","PSGPER1",13,0)
 S PSGION=ION
"RTN","PSGPER1",14,0)
 D DEV1
"RTN","PSGPER1",15,0)
 Q
"RTN","PSGPER1",16,0)
DEV0 ; Validate Device
"RTN","PSGPER1",17,0)
 S PSGION=ION
"RTN","PSGPER1",18,0)
DEV1 ; Device validation loop
"RTN","PSGPER1",19,0)
 W !!,"PRE-EXCHANGE UNITS REPORT"
"RTN","PSGPER1",20,0)
 K IOP,%ZIS,IO("Q") S %ZIS="Q",%ZIS("A")="Select DEVICE for "_$S($G(PSGPRCLD("WARD")):"Ward "_$G(^DPT(DFN,.1)),$G(PSGCURCL)]"":"Clinic "_PSGCURCL,1:"")_": ",%ZIS("B")=$S(($G(PSGCURCL)]""):$G(PSGPRCLD("DEV",PSGCURCL)),1:"")
"RTN","PSGPER1",21,0)
 D ^%ZIS K %ZIS
"RTN","PSGPER1",22,0)
 I POP D POP G:%=1 DEV1
"RTN","PSGPER1",23,0)
 I $D(IO("Q")) K ZTSAVE S PSGTIR="^PSGPER2",ZTDESC="PRE-EXCHANGE UNITS REPORT",ZTDTH=$H,ZTSAVE("PSGPXN")="",ZTSAVE("DFN")="",ZTSAVE("PSGPRTYP")="",ZTSAVE("PSGCURCL")="" D ENTSK^PSGTI G:'$D(ZTSK) DEV0 K ZTSK
"RTN","PSGPER1",24,0)
 D ENP^PSGPER2,AG I %=1 S PSGPERRF=1 G DEV0
"RTN","PSGPER1",25,0)
 Q
"RTN","PSGPER1",26,0)
 ;
"RTN","PSGPER1",27,0)
DONE ;
"RTN","PSGPER1",28,0)
OUT ;
"RTN","PSGPER1",29,0)
 D TASKPRGE^PSGPER1(PSGPXN) ;
"RTN","PSGPER1",30,0)
 K PSGPERRF,PSGPXN
"RTN","PSGPER1",31,0)
 Q:$G(PSJCOM)!$G(PSJPREX)
"RTN","PSGPER1",32,0)
 D ENIVKV^PSGSETU,ENCV^PSGSETU
"RTN","PSGPER1",33,0)
 Q
"RTN","PSGPER1",34,0)
 ;
"RTN","PSGPER1",35,0)
POP ;
"RTN","PSGPER1",36,0)
 S %=2 W:'PSGPERRF !!,"IF A DEVICE IS NOT CHOSEN, NO REPORT WILL BE RUN AND THE DATA WILL NO LONGER BE RETRIEVABLE THROUGH THIS REPORT."
"RTN","PSGPER1",37,0)
 I 'PSGPERRF F  W !,"Do you want another chance to choose a device" S %=1 D YN^DICN Q:%  W !?3,"Enter 'YES' to choose a device to print.  Enter 'NO' to quit now."
"RTN","PSGPER1",38,0)
 I %'=1 S IOP=PSGION D ^%ZIS S %=2
"RTN","PSGPER1",39,0)
 Q
"RTN","PSGPER1",40,0)
 ;
"RTN","PSGPER1",41,0)
AG ;
"RTN","PSGPER1",42,0)
 F  W !!,"DO YOU NEED TO PRINT THIS REPORT AGAIN" S %=0 D YN^DICN Q:%  D AGMSG
"RTN","PSGPER1",43,0)
 Q
"RTN","PSGPER1",44,0)
 ;
"RTN","PSGPER1",45,0)
AGMSG ;
"RTN","PSGPER1",46,0)
 I %Y'?1."?" W $C(7),"  ANSWER 'YES' OR 'NO' (Entry required)" Q
"RTN","PSGPER1",47,0)
 W !,"  Enter 'YES' to print this report again.  Enter 'NO' (or an '^') to quit",!,"now.  PLEASE NOTE that you will NOT be able to retrieve this data at a later",!,"date.  You should print this information now." Q
"RTN","PSGPER1",48,0)
 ;
"RTN","PSGPER1",49,0)
DEFON() ; All Pre-Exchange Devices have been removed from Ward Parameters - restore previous functionality
"RTN","PSGPER1",50,0)
 N ON,W S ON=0,W=0 F  S W=$O(^PS(59.6,W)) Q:'W!ON  I $P(^(W,0),U,29)]"" S ON=1
"RTN","PSGPER1",51,0)
 I $G(PSJPXDOF) S ON=0 K PSJPXDOF
"RTN","PSGPER1",52,0)
 Q ON
"RTN","PSGPER1",53,0)
 ;
"RTN","PSGPER1",54,0)
DEFCL(PSGPXN,CLINICS) ; Default devices for Clinics
"RTN","PSGPER1",55,0)
 K CLINICS N CLINIC,CLINM,CLINX,CLINDEV
"RTN","PSGPER1",56,0)
 N CLINAM,DFN S DFN=0 F  S DFN=$O(^PS(53.4,PSGPXN,1,DFN)) Q:'DFN  S ON=0 F  S ON=$O(^PS(53.4,PSGPXN,1,DFN,1,ON)) Q:'ON  D
"RTN","PSGPER1",57,0)
 .S CLINIC=$$CLINIC^PSJO1(DFN,+ON_"U")
"RTN","PSGPER1",58,0)
 .I CLINIC]"" N CLINUM,DIC,X,Y S DIC="^SC(",DIC(0)="NSUXZ",X=CLINIC D ^DIC I $G(Y)>0 S CLINUM=+Y D
"RTN","PSGPER1",59,0)
 ..S CLINAM=CLINIC N LCLCL S LCLCL=$P($G(PSJSYSW0("CLINIC",+CLINUM,1)),"^")
"RTN","PSGPER1",60,0)
 ..I $G(PSJSYSW0("CLINIC",+CLINUM,0)) S CLINICS("DEV",CLINAM)=$$GET1^DIQ(3.5,+LCLCL,".01"),CLINICS("DEVX",+CLINIC)=CLINAM
"RTN","PSGPER1",61,0)
 .I CLINIC="" S CLINICS("WARD")=1
"RTN","PSGPER1",62,0)
 Q
"RTN","PSGPER1",63,0)
TASKPRGE(PXN) ; Task purge of entry from file 53.4
"RTN","PSGPER1",64,0)
 K ZTIO,ZTDTH,ZTSK S ZTIO="",ZTRTN="PURGE^PSGPER1",ZTDESC="PURGE PRE-EXCHANGE NEEDS" S ZTSAVE("PXN")="" S ZTDTH=$$HADD^XLFDT($H,1,0,0,0)
"RTN","PSGPER1",65,0)
 D ^%ZTLOAD
"RTN","PSGPER1",66,0)
 K %ZIS,IOP,PSGTID,PSGTIR,ZTDESC,ZTDTH,ZTRTN,ZTDESC,ZTSAVE
"RTN","PSGPER1",67,0)
 Q
"RTN","PSGPER1",68,0)
PURGE ; Purge entry from file 53.4
"RTN","PSGPER1",69,0)
 Q:'$G(PXN)
"RTN","PSGPER1",70,0)
 N PSGPXINF,PSGNOWFM S PSGPXINF=$G(^PS(53.4,+$G(PXN),0)),PSGPXINF=$P($P(PSGPXINF,"^",2),".") Q:'$G(PSGPXINF)
"RTN","PSGPER1",71,0)
 S PSGNOWFM=$P($$NOW^XLFDT,".") Q:'(PSGNOWFM>PSGPXINF)
"RTN","PSGPER1",72,0)
 S DIK="^PS(53.4,",DA=PXN D ^DIK
"RTN","PSGPER1",73,0)
 Q
"RTN","PSGPER2")
0^39^B31489798^B24518370
"RTN","PSGPER2",1,0)
PSGPER2 ;BIR/CML3-PRINTS PRE-EXCHANGE NEEDS REPORT ;18 MAR 03 / 5:14 PM
"RTN","PSGPER2",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**80,115,279**;16 DEC 97;Build 150
"RTN","PSGPER2",3,0)
 ;
"RTN","PSGPER2",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGPER2",5,0)
 ;
"RTN","PSGPER2",6,0)
ENQ ; Tasked entry point
"RTN","PSGPER2",7,0)
 D ENP
"RTN","PSGPER2",8,0)
 D TASKPRGE^PSGPER1(PSGPXN)
"RTN","PSGPER2",9,0)
 K DA,DIK,PSGPXN
"RTN","PSGPER2",10,0)
 Q
"RTN","PSGPER2",11,0)
 ;
"RTN","PSGPER2",12,0)
ENP ;
"RTN","PSGPER2",13,0)
 N PSGPRSUB S PSGPRSUB=$S($G(PSGPRTYP)="PSGPERPC":"PSGPERPC",1:"PSGPERP")
"RTN","PSGPER2",14,0)
 K ^TMP("PSGPERP",$J),^TMP("PSGPERPC",$J) U IO
"RTN","PSGPER2",15,0)
 F DFN=0:0 S DFN=$O(^PS(53.4,PSGPXN,1,DFN)) Q:'DFN  D PID^VADPT,GWR F ON=0:0 S ON=$O(^PS(53.4,PSGPXN,1,DFN,1,ON)) Q:'ON  D ONI F DD=0:0 S DD=$O(^PS(53.4,PSGPXN,1,DFN,1,ON,1,DD)) Q:'DD  I $D(^(DD,0)) S ND=^(0) D DDS
"RTN","PSGPER2",16,0)
 D NOW^%DTC S %=$$ENDTC^PSGMI(%),(BORD,F,L)="",$P(L,"-",81)="",$P(BORD,"#",25)="",T=IO'=IO(0)!($E(IOST)'="C"),RF=$S(T:0,1:0) D:'RF HEADER S (DN,DDN,NP,WD)=""
"RTN","PSGPER2",17,0)
 F  S WD=$O(^TMP(PSGPRSUB,$J,WD)) Q:WD=""  S PI="" F  S F=0,PI=$O(^TMP(PSGPRSUB,$J,WD,PI)) Q:PI=""  S RB=$G(^(PI)) D
"RTN","PSGPER2",18,0)
 .Q:'$$NSYNC(PSGPRSUB,WD,$G(PSGCURCL))
"RTN","PSGPER2",19,0)
 .D PPI F  S F=1,DN=$O(^TMP(PSGPRSUB,$J,WD,PI,DN)) Q:DN=""  S PX=^(DN) D OP F  S DDN=$O(^TMP(PSGPRSUB,$J,WD,PI,DN,DDN)) Q:DDN=""  S PX=^(DDN) D PRT
"RTN","PSGPER2",20,0)
 .I $O(^TMP(PSGPRSUB,$J,WD,PI))]"" S F="" D NP
"RTN","PSGPER2",21,0)
 W:T&($Y) @IOF,@IOF D ^%ZISC
"RTN","PSGPER2",22,0)
 ;
"RTN","PSGPER2",23,0)
DONE ;
"RTN","PSGPER2",24,0)
 K ^TMP(PSGPRSUB,$J),BORD,DN,DD,DO,DRG,DRGS,F,L,MR,ND,ND0,ND2,ND4,NP,ON,PI,PDN,PN,PX,RB,RF,SCH,SDN,SN,SND1,SPN,STOP,STRT,T,UD,VD,VU,W,WD,X,XL,Y,DDN,I2,ND1,PSG25,PSG26,PSGEB,PSGEBN,PSGNODE,PSGOAT,PSGSTAT
"RTN","PSGPER2",25,0)
 K DONE,FIL,NF,PDM,PDRG,PSGACTO,PSGDA,PSGNEFDO,PSGNESDO,PSGPEN,PSGPENWS,PSGY,PSIVAC,PSIVCT,PSIVE,PSIVEXAM,PSIVUP,PSIVWAT,PSJH,PSJNOO,PSJNOON
"RTN","PSGPER2",26,0)
 Q
"RTN","PSGPER2",27,0)
 ;
"RTN","PSGPER2",28,0)
NP ;
"RTN","PSGPER2",29,0)
 I 'T K DIR S DIR(0)="E" W ! D ^DIR S:'Y WD="zzz" W:Y $C(13),# Q
"RTN","PSGPER2",30,0)
 ;
"RTN","PSGPER2",31,0)
HEADER ;
"RTN","PSGPER2",32,0)
 W:$Y @IOF W !?20,"PRE-EXCHANGE UNITS REPORT - ",%
"RTN","PSGPER2",33,0)
 W !!,$S(($G(PSGCURCL)]""):"Clinic",1:"Ward"),?32,"Room-bed",!,"Patient",!?5,"Order",!?20,"Dispense Drug",?64,"U/D",?72,"Needs",!,L
"RTN","PSGPER2",34,0)
 W:F !!,$S(WD'="zz":WD,1:"NOT FOUND"),?32,RB,!,PN_"  ("_SN_")" Q
"RTN","PSGPER2",35,0)
 ;
"RTN","PSGPER2",36,0)
GWR ;
"RTN","PSGPER2",37,0)
 D PID^VADPT
"RTN","PSGPER2",38,0)
 S WD=$G(^DPT(DFN,.1)),RB=$G(^(.101)),PN=$P($G(^(0)),"^") S:WD="" WD="zz" S:RB="" RB="NOT FOUND" S:PN="" PN=DFN_";DPT("
"RTN","PSGPER2",39,0)
 S SPN=$E(PN,1,20)_"^"_DFN,^TMP(PSGPRSUB,$J,WD,SPN)=PN_"^"_RB_"^"_VA("BID") Q
"RTN","PSGPER2",40,0)
 ;
"RTN","PSGPER2",41,0)
ONI ;
"RTN","PSGPER2",42,0)
 S ND=$G(^PS(55,DFN,5,ON,0)),DN=$G(^(.2)),SCH=$P($G(^(2)),"^"),MR=$P(ND,"^",3),ND=$$ENNPN^PSGMI($P(ND,"^",2)),DO=$P(DN,"^",2),DN=$P(DN,"^") I DN="" S DN="zz"
"RTN","PSGPER2",43,0)
 E  S DN=$$ENPDN^PSGMI(DN)
"RTN","PSGPER2",44,0)
 I $G(^PS(55,DFN,5,+ON,8)) Q:(PSGPRSUB'="PSGPERPC")  N CLINIC S CLINIC=+^(8) I CLINIC S CLINIC=$P($G(^SC(+CLINIC,0)),"^") I (CLINIC]"") S WD=CLINIC,^TMP("PSGPERPC",$J,WD,SPN)=PN_"^^"_VA("BID") D
"RTN","PSGPER2",45,0)
 .I $D(^TMP(PSGPRSUB,$J,"zz",SPN)),($O(^TMP(PSGPRSUB,$J,"zz",SPN,""))="") K ^TMP(PSGPRSUB,$J,"zz",SPN)
"RTN","PSGPER2",46,0)
 S:MR]"" MR=$$ENMRN^PSGMI(MR) S SDN=$E(DN,1,20)_"^"_ON,^TMP(PSGPRSUB,$J,WD,SPN,SDN)=DN_"^"_DO_"^"_MR_"^"_SCH_"^"_$P(ND,"^",2)
"RTN","PSGPER2",47,0)
 S ^TMP($J,"PSGPRKILL",PSGPXN,DFN,ON)=""
"RTN","PSGPER2",48,0)
 Q
"RTN","PSGPER2",49,0)
 ;
"RTN","PSGPER2",50,0)
DDS ;
"RTN","PSGPER2",51,0)
 Q:'$$NSYNC(PSGPRSUB,WD,$G(PSGCURCL))
"RTN","PSGPER2",52,0)
 I $G(^PS(55,DFN,5,+ON,8)) Q:(PSGPRSUB'="PSGPERPC")
"RTN","PSGPER2",53,0)
 S ND1=$G(^PS(55,DFN,5,ON,1,+ND,0)),UD=$P(ND1,"^",2),ND1=$$ENDDN^PSGMI(+ND1),SND1=$E(ND1,1,20)_"^"_+ND,ND=$P(ND,"^",2)
"RTN","PSGPER2",54,0)
 I ND#1 S ND=(ND\1)+1
"RTN","PSGPER2",55,0)
 S ^TMP(PSGPRSUB,$J,WD,SPN,SDN,SND1)=ND1_"^"_UD_"^"_ND
"RTN","PSGPER2",56,0)
 Q
"RTN","PSGPER2",57,0)
 ;
"RTN","PSGPER2",58,0)
PPI ;
"RTN","PSGPER2",59,0)
 S DFN=$P(PI,"^",2),PN=$P(RB,"^"),SN=$P(RB,"^",3),RB=$P(RB,"^",2) I 'RF,$Y+6>IOSL D NP Q:NP["^"
"RTN","PSGPER2",60,0)
 W !!,$S(WD'="zz":WD,1:"NOT FOUND"),?32,RB,!,PN,"  ("_SN_")" Q
"RTN","PSGPER2",61,0)
 ;
"RTN","PSGPER2",62,0)
OP ;
"RTN","PSGPER2",63,0)
 S PDN=$P(PX,"^"),DO=$P(PX,"^",2),MR=$P(PX,"^",3),SCH=$P(PX,"^",4)
"RTN","PSGPER2",64,0)
 W !?5,PDN," ",DO," ",MR,$S(MR]"":" ",1:""),SCH
"RTN","PSGPER2",65,0)
 Q
"RTN","PSGPER2",66,0)
PRT ; find order info and print same
"RTN","PSGPER2",67,0)
 I 'RF,$Y+4>IOSL D NP Q:NP="^"
"RTN","PSGPER2",68,0)
 I 1 S PDN=$P(PX,"^"),UD=$P(PX,"^",2),PX=$P(PX,"^",3) W !?20,PDN,?62,$J($S('UD:1,$E(UD)=".":0_UD,1:UD),5),?72,$J(PX,5) Q
"RTN","PSGPER2",69,0)
 S ON=$P(DN,"^",2),ND=$G(^PS(55,DFN,5,ON,0)),ND2=$G(^(2)),ND4=$G(^(4)),Y=$P($G(^(6)),"^"),ND0=$G(^(.1)),DO=$P(ND0,"^",2)
"RTN","PSGPER2",70,0)
 S DRG=$$ENDDN^PSGMI($P(ND0,"^")),MR=$$ENMRN^PSGMI(MR) ; ,DRGS=$P($G(^(+$O(^PS(55,DFN,5,ON,1,0)),0)),"^")
"RTN","PSGPER2",71,0)
 I 'RF W !?5,DRG,?47,DO,?65,$J($S('UD:1,UD=.5:"1/2",UD=.25:"1/4",UD?1".".N:0_UD,1:UD),5),?75,$J(+PX,5) Q
"RTN","PSGPER2",72,0)
 ;
"RTN","PSGPER2",73,0)
 S SCH=$P(ND2,"^"),STRT=$P(ND2,"^",2),STOP=$P(ND2,"^",4),VU=$P(ND4,"^",3),VD=$P(ND4,"^",4),VU=$P($G(^VA(200,+VU,0)),"^",2) S:VU="" VU=$P(ND4,"^",3)
"RTN","PSGPER2",74,0)
 F Q="STRT","STOP","VD" S @Q=$$ENDTC^PSGMI(@Q)
"RTN","PSGPER2",75,0)
 W:$Y @IOF W !!?6,BORD_"  PRE-EXCHANGE MED  "_BORD,!?6,"#",?73,"#",!?6,"#  ",PN,?50,$S(($G(PSGCURCL)]""):"Clinic: ",1:"Ward: "),WD,?73,"#",!?6,"#  ("_SN_")",?52,"RB: "_RB,?73,"#",!?6,"#",?73,"#"
"RTN","PSGPER2",76,0)
 W !?6,"#  "_DRG,?46,"START: "_STRT,?73,"#",!?6,"#  "_$S(DRGS]"":"("_DRGS_")",1:""),?47,"STOP: "_STOP,?73,"#",!?6,"#  GIVE: "_$S(DO]"":" "_DO,1:"")_$S(MR]"":" "_MR,1:"")_$S(SCH]"":" "_SCH,1:""),?73,"#"
"RTN","PSGPER2",77,0)
 S XL=0 I Y="" W !?6,"#",?73,"#",!?6,"#  (NO SPECIAL INSTRUCTIONS)"
"RTN","PSGPER2",78,0)
 E  W !?6,"#",?73,"#",!?6,"#    " S Y=$$ENSET^PSGSICHK(Y) F Q=1:1:$L(Y," ") S X=$P(Y," ",Q) S:$X+$L(X)>72 XL=XL+1 W:$X+$L(X)>72 ?73,"#",!?6,"#  " W X_" "
"RTN","PSGPER2",79,0)
 W ?73,"#",!?6,"#",?73,"#",!,?6,"#",?43,"VERIFIED: "_VD,?73,"#",!?6,"#",?49,"BY: "_VU,?73,"#",!?6,"#",?38,"SEND TO FLOOR: "_PX,?73,"#"
"RTN","PSGPER2",80,0)
 S XL=2-XL I XL>0 F Q=1:1:XL W !?6,"#",?73,"#"
"RTN","PSGPER2",81,0)
 W !?6,"#",?73,"#",!?6,"#",?36,"_______________     _______________  #",!?6,"#",?36,"FILLED BY",?56,"CHECKED BY",?73,"#",!?6,BORD_BORD_$E(BORD,1,20) Q
"RTN","PSGPER2",82,0)
 ;
"RTN","PSGPER2",83,0)
NSYNC(PSGPRSUB,WD,PSGCURCL) ; Don't print ward orders and clinic orders together
"RTN","PSGPER2",84,0)
 Q:((PSGPRSUB="PSGPERPC")&(WD'=$G(PSGCURCL))) 0
"RTN","PSGPER2",85,0)
 Q:((PSGPRSUB'="PSGPERPC")&($G(PSGCURCL)]"")) 0
"RTN","PSGPER2",86,0)
 Q 1
"RTN","PSIVCAL")
0^4^B76248321^B75101309
"RTN","PSIVCAL",1,0)
PSIVCAL ;BIR/RGY,PR-CALCULATES START AND STOP DATES ; 4/26/12 2:36pm
"RTN","PSIVCAL",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**4,26,41,47,63,67,69,58,94,80,110,111,177,120,134,229,279**;16 DEC 97;Build 150
"RTN","PSIVCAL",3,0)
 ;
"RTN","PSIVCAL",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA #2180.
"RTN","PSIVCAL",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA #1231.
"RTN","PSIVCAL",6,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSIVCAL",7,0)
 ;
"RTN","PSIVCAL",8,0)
ENT ;NEEDS PSIVTYPE (P(4))
"RTN","PSIVCAL",9,0)
 I $G(PSJREN) D  Q:P(2)
"RTN","PSIVCAL",10,0)
 . I $G(P("OLDON")) N P2 S P2=$G(@("^PS(55,"_DFN_",""IV"","_+P("OLDON")_",0)")),P2=$P(P2,"^",2) I P2 S P(2)=P2
"RTN","PSIVCAL",11,0)
 I $G(PSJORD)["P",$G(P("APPT"))?7N1"."1.N S START=$$DATE2^PSJUTL2(P("APPT")) S:($$FMDIFF^XLFDT(START,PSGDT,2)<0) START=+$E(PSGDT,1,12) G Q
"RTN","PSIVCAL",12,0)
 I $G(PSJSYSW0)=""!($P(PSJSYSW0,U,5)=2) S START=+$E(P("LOG"),1,12) G Q
"RTN","PSIVCAL",13,0)
 S PSIVSN=+P("IVRM"),START="",PSIVTYPE=$G(P(4)) Q:PSIVTYPE=""
"RTN","PSIVCAL",14,0)
 N PSIV X $S($E(PSIVAC)="C":"S X=+$E(P(""LOG""),1,12) D H^%DTC S PSIV=%T",1:"S PSIV=$P($H,"","",2)") G T2:PSIVTYPE'["P"&('P(5))
"RTN","PSIVCAL",15,0)
 I P(11)']"" X $S($E(PSIVAC)="C":"S Y=+$E(P(""LOG""),1,12)",1:"D NOW^%DTC S Y=%") S Y=Y+.007\.01/100 S:'$P(Y,".",2) Y=$$MDNGHT(Y) X ^DD("DD") S START=Y G Q
"RTN","PSIVCAL",16,0)
 S X=P(11) D CHK S PX=Y,X1=PSIV\3600,X2=PSIV#3600\60,X=$E(".0",1,$L(X1)#2+1)_X1_$E("0",X2<10)_X2,START=$S($E(PSIVAC)="C":$P(P("LOG"),"."),1:"T")
"RTN","PSIVCAL",17,0)
 S X1=$P(PX,"-"),X1=$E(".0",1,$L(X1)#2+1)_X1,X2=$P(PX,"-",PSGCNT),X2=$E(".0",1,$L(X2)#2+1)_X2
"RTN","PSIVCAL",18,0)
 S NAT=+$P($G(^PS(59.6,+$O(^PS(59.6,"B",+VAIN(4),0)),0)),U,5)
"RTN","PSIVCAL",19,0)
 I '$D(PSGDT) S PSGDT=$$DATE^PSJUTL2()
"RTN","PSIVCAL",20,0)
 I X<X1,'NAT S START=$$ENSD^PSGNE3(P(9),P(11),+$E(P("LOG"),1,12),PSGDT) G Q
"RTN","PSIVCAL",21,0)
 I X>X2 S START=$$ENSD^PSGNE3(P(9),P(11),+$E(P("LOG"),1,12),PSGDT) G Q
"RTN","PSIVCAL",22,0)
T6 F I=2:1:PSGCNT S X1="."_$P(PX,"-",I-1),X2="."_$P(PX,"-",I) Q:+X1<X&(+X2>X)
"RTN","PSIVCAL",23,0)
 S X1=X-X1,X2=$S(NAT:0,1:X2-X),START=$S(X1<X2:$P(PX,"-",I-1),1:$P(PX,"-",I)) S:START="" START=$P(PX,"-") X $S($E(PSIVAC)="C":"S Y=$P(P(""LOG""),""."") X ^DD(""DD"") S PSIV=Y",1:"S PSIV=""TODAY""") S START=PSIV_"@"_$E("0",$L(START)=3)_START G Q
"RTN","PSIVCAL",24,0)
T2 S X=+("."_$E(10000+(PSIV\3600*100)+(PSIV#3600\60),2,5)),START=$O(^PS(59.5,PSIVSN,3,"AT",X)) S:'START START=$O(^(0)),PSIVTOM=1 I 'START S START=X K PSIVTOM
"RTN","PSIVCAL",25,0)
 S START=$S($E(PSIVAC)="C":$P(P("LOG"),"."),1:DT)_START I $D(PSIVTOM) S X1=$S($E(PSIVAC)="C":$P(P("LOG"),"."),1:DT),X2=1 D C^%DTC S Y=$P(X,".")_START K PSIVTOM
"RTN","PSIVCAL",26,0)
 S X=START,%DT="XRTX" D ^%DT
"RTN","PSIVCAL",27,0)
Q ;
"RTN","PSIVCAL",28,0)
 I START["@" S X=START,%DT="RTX" D ^%DT S START=+Y
"RTN","PSIVCAL",29,0)
 S P(2)=START
"RTN","PSIVCAL",30,0)
 I $G(PSJORD)["P" D:'$G(PSGRDTX(+PSJORD,"PSGSD")) REQDT^PSJLIVMD(PSJORD) S START=$G(PSGRDTX(+PSJORD,"PSGSD")) S P(2)=$S(START:START,1:P(2))
"RTN","PSIVCAL",31,0)
 K NAT,START,PSIVTYPE,PSIVSTRT,PSGCNT,X1,X2,PX
"RTN","PSIVCAL",32,0)
 Q
"RTN","PSIVCAL",33,0)
CHK F Y=1:1 Q:$L(X)>240!($P(X,"-",Y)="")  S $P(X,"-",Y)=$P(X,"-",Y)_$E("0000",1,4-$L($P(X,"-",Y)))
"RTN","PSIVCAL",34,0)
 S Y=X,PSGCNT=$L(X,"-") S:X]""&(PSGCNT<1) PSGCNT=1 Q
"RTN","PSIVCAL",35,0)
 ;
"RTN","PSIVCAL",36,0)
ENSTOP ; WILL CALCULATE STOP DATE FOR ORDER
"RTN","PSIVCAL",37,0)
 ;NEEDS (DFN) & ON
"RTN","PSIVCAL",38,0)
 N WALL,P3,ADX,DDLX,OIX,DRGT,PSIDAY,PSIMIN,LIMDAY S (WALL,P3,PSIDAY,PSIMIN)=0
"RTN","PSIVCAL",39,0)
 D:'$G(PSIVSITE) ^PSIVSET  Q:'P(2)
"RTN","PSIVCAL",40,0)
 I P(23)'="" S PSIVTYPE="C"
"RTN","PSIVCAL",41,0)
 S STOP="",X="",PSIVSTRT=P(2),PSIVTYPE=$G(P(4)) I $G(PSJREN) D
"RTN","PSIVCAL",42,0)
 . N RDT I $G(ON)["P" S RDT=+$$LASTREN^PSJLMPRI(DFN,ON)
"RTN","PSIVCAL",43,0)
 . S PSIVSTRT=$$DATE2^PSJUTL2($S($G(RDT):RDT,1:$G(PSGDT)))
"RTN","PSIVCAL",44,0)
 ;BHW - PSJ*5*177 - Begin Modifications - Reset Start date to Last Renewed date for active orders that have been renewed
"RTN","PSIVCAL",45,0)
 I ('$G(PSJREN))&($G(P(4))="A")&($G(ON)["V") D
"RTN","PSIVCAL",46,0)
 . N RDT S RDT=+$$LASTREN^PSJLMPRI(DFN,ON)
"RTN","PSIVCAL",47,0)
 . I +RDT S PSIVSTRT=RDT
"RTN","PSIVCAL",48,0)
 . Q
"RTN","PSIVCAL",49,0)
 ;BHW - PSJ*5*177 - End Modifications - Resetting PSIVSTRT will recalculate the stop date based on the Last renewed date.
"RTN","PSIVCAL",50,0)
 ;
"RTN","PSIVCAL",51,0)
 I $S("^NOW^STAT^ONCE^ONE-TIME^ONE TIME^ONETIME^1TIME^1-TIME^1 TIME^"[(U_P(9)_U):1,1:0),PSIVTYPE="P"!P(5)!(P(23)="P") S X=$$ENOSD^PSJDCU(PSJSYSW0,PSIVSTRT,DFN) I X]"" S:P(11)=""&($G(ON)["P") PSIVCAL=1 G END
"RTN","PSIVCAL",52,0)
 I '$G(P("OVRIDE")),$G(ON) N DUR,DURMIN,PSJPROV,PSJDNM,A,PSJDAY I $G(ON)["V"!(($G(ON)["P")&($P($G(^PS(53.1,+ON,0)),"^",4)="F")) D
"RTN","PSIVCAL",53,0)
 . S DUR=$$GETDUR^PSJLIVMD(DFN,+ON,"IV",1) I DUR]"" S DURMIN=$$DURMIN^PSJLIVMD(DUR) I DURMIN S PSIMIN=DURMIN
"RTN","PSIVCAL",54,0)
 I $P(PSIVSITE,"^",5) D
"RTN","PSIVCAL",55,0)
 . N Z S Y=0
"RTN","PSIVCAL",56,0)
 . F  S Y=$O(^PS(55,DFN,"IV",Y)) Q:'Y  S Z=^(Y,0) D  Q:X]""
"RTN","PSIVCAL",57,0)
 .. I $P(Z,"^",17)="A",$$ONE^PSJBCMA(DFN,Y_"V",$P(Z,"^",9))'="O" S X=$P(Z,"^",3) Q
"RTN","PSIVCAL",58,0)
 S:$G(X) WALL=X
"RTN","PSIVCAL",59,0)
 S PSIDAY=$S(PSIVTYPE="A":$P(PSIVSITE,"^",4),PSIVTYPE="H":$P(PSIVSITE,"^",17),PSIVTYPE="P":$P(PSIVSITE,"^",18),PSIVTYPE="S":$P(PSIVSITE,"^",20),1:$P(PSIVSITE,"^",21))
"RTN","PSIVCAL",60,0)
 ;*229 Add Dose Limit for IOE
"RTN","PSIVCAL",61,0)
 I '$G(ON),$G(PSIVLIMT)]"" S PSIVLIM=PSIVLIMT
"RTN","PSIVCAL",62,0)
 I $G(ON)["P"!($G(ON)["V") I '$G(P("OVRIDE")) N MINS,LIM S PSIVLIM=$S($G(PSIVLIMT)]"":PSIVLIMT,1:$$GETLIM(DFN,ON)) I $G(PSIVLIM)]"" S MINS=$$GETMIN(PSIVLIM,DFN,ON,.LIMDAY) D
"RTN","PSIVCAL",63,0)
 .I (MINS&(MINS<PSIMIN))!'PSIMIN S PSIMIN=MINS
"RTN","PSIVCAL",64,0)
 S PSJDAY="" D  I PSJDAY]"",PSJDAY<PSIDAY S PSIDAY=PSJDAY
"RTN","PSIVCAL",65,0)
 . N A,B,PSJCLIN
"RTN","PSIVCAL",66,0)
 . Q:'$D(PSJORD)  S A=""
"RTN","PSIVCAL",67,0)
 . I PSJORD["P" S A=$G(^PS(53.1,+PSJORD,"DSS"))
"RTN","PSIVCAL",68,0)
 . I PSJORD["U" S A=$G(^PS(55,PSGP,5,+PSJORD,8))
"RTN","PSIVCAL",69,0)
 . I PSJORD["V" S A=$G(^PS(55,PSGP,"IV",+PSJORD,"DSS"))
"RTN","PSIVCAL",70,0)
 . S:(+$G(A)<0) A=""
"RTN","PSIVCAL",71,0)
 . S (PSJCLIN,A)=$P(A,"^") Q:A=""  S PSJCLIN=$P($G(^SC(+$G(PSJCLIN),0)),"^") Q:PSJCLIN=""  I $D(^PS(53.46,"B",A)) S B=$O(^PS(53.46,"B",A,"")),PSJDAY=$P(^PS(53.46,B,0),"^",2)
"RTN","PSIVCAL",72,0)
 F X=0:0 S X=$O(DRG("AD",X)) Q:'X  I $P(^PS(52.6,+$P(DRG("AD",+X),U),0),"^",4),($P(^(0),"^",4))<+PSIDAY S PSIDAY=$P(^(0),"^",4)
"RTN","PSIVCAL",73,0)
 I WALL,($$FMADD^XLFDT(PSIVSTRT,PSIDAY,"D"))>WALL S PSIDAY=$$FMDIFF^XLFDT(WALL,PSIVSTRT,1) S:PSIDAY<1 PSIDAY=""
"RTN","PSIVCAL",74,0)
 S DRGT=$S($D(DRG("AD")):"AD",1:"SOL") F ADX=0:0 S ADX=$O(DRG(DRGT,ADX)) Q:'ADX!($G(DRGTMP)&($G(DRGTN)["AD")&(DRGT="SOL"))  D
"RTN","PSIVCAL",75,0)
 . S OIX=+$P(DRG(DRGT,ADX),"^",6),DDLX=$P(^PS(50.7,OIX,0),"^",5) Q:'DDLX  D DDLIM(.PSIDAY,.P3)
"RTN","PSIVCAL",76,0)
 I '$G(DRG("AD",0)),$G(DRGTMP),($G(DRGTN)["SOL") S OIX=$P($G(DRGTMP),"^",6) I OIX S DDLX=$P(^PS(50.7,OIX,0),"^",5) I DDLX  D DDLIM(.PSIDAY,.P3)
"RTN","PSIVCAL",77,0)
 I $G(PSIVLIM)["a",'$G(P("OVRIDE")) S DDLX=$P(PSIVLIM,"a",2)_"L" I $G(DDLX) D DDLIM(.PSIDAY,.P3)
"RTN","PSIVCAL",78,0)
 I $G(P(2)) I P3>P(2) S X=P3 Q  ;*229 Quit so we use dose limit.
"RTN","PSIVCAL",79,0)
 S:('PSIDAY&'PSIMIN) PSIDAY=1
"RTN","PSIVCAL",80,0)
TIME S X2=PSIDAY,X1=PSIVSTRT D C^%DTC S X=$P(X,"."),X=X_$S($P(PSIVSITE,"^",14)="":.2359,1:"."_$P(PSIVSITE,"^",14))
"RTN","PSIVCAL",81,0)
 I PSIMIN D
"RTN","PSIVCAL",82,0)
 . I $G(PSIDAY),((PSIDAY*1440)<PSIMIN) K PSIVLIM,P("LIMIT") S P("OVRIDE")=1 Q
"RTN","PSIVCAL",83,0)
 . ;*229 if PSIMIN=(PSIDAY*1440) then dose lim, if day lim use site param.
"RTN","PSIVCAL",84,0)
 . I (PSIMIN<=(PSIDAY*1440)!'$G(PSIDAY)) S X=$$FMADD^XLFDT(PSIVSTRT,,,PSIMIN) D
"RTN","PSIVCAL",85,0)
 . . I $G(P("LIMIT"))["d" S X=$P(X,"."),X=X_$S($P(PSIVSITE,"^",14)="":.2359,1:"."_$P(PSIVSITE,"^",14))
"RTN","PSIVCAL",86,0)
 ;
"RTN","PSIVCAL",87,0)
END ;
"RTN","PSIVCAL",88,0)
 S P(3)=+X
"RTN","PSIVCAL",89,0)
 I $G(PSJORD)["P" D:'$G(PSGRDTX(+PSJORD,"PSGFD")) REQDT^PSJLIVMD(PSJORD) S P(3)=$S($G(PSGRDTX(+PSJORD,"PSGFD")):PSGRDTX(+PSJORD,"PSGFD"),1:P(3))
"RTN","PSIVCAL",90,0)
 S P(3)=$$DATE2^PSJUTL2(P(3)),P(2)=$$DATE2^PSJUTL2(P(2))
"RTN","PSIVCAL",91,0)
 Q
"RTN","PSIVCAL",92,0)
 ;
"RTN","PSIVCAL",93,0)
ENAD ;Will get last admin. time for order (needs dfn and on)
"RTN","PSIVCAL",94,0)
 N P4,PSIVX,PSIVY
"RTN","PSIVCAL",95,0)
 I $P(PSJSYSW0,U,5)=2 S PSIVADM=$$DATE^PSJUTL2() Q
"RTN","PSIVCAL",96,0)
 I $S($G(PSIVAC)["R":1,P(9)="QOD":1,1:P(9)?1"Q".N1"D") S PSIVADM=$$ENSD^PSGNE3(P(9),P(11),+$E(P("LOG"),1,12),+$P($G(^PS(55,DFN,"IV",+P("OLDON"),0)),U,2)) Q:PSIVADM
"RTN","PSIVCAL",97,0)
 S PSIVX=X,PSIVY=Y,P4=P(4) S:P(4)="C" P4=P(23) S:P4="S" P4=$S(P(5):"P",1:"A") D NOW^%DTC S Y=%,PSIVNOW=Y I (P4="P"&(P(11)="")&'P(15))!("HA"[P4&'P(15)) S Y=Y+.007\.01/100 G QAD
"RTN","PSIVCAL",98,0)
 D P:P4="P"&('P(15)),AH:P(15)
"RTN","PSIVCAL",99,0)
QAD ;
"RTN","PSIVCAL",100,0)
 S:'$D(PSGSA) PSGSA=""
"RTN","PSIVCAL",101,0)
 S PSIVSD=Y I Y S OD=$L(PSGSA," ") I OD>2 S X=+PSGSA\1 F OD1=2:1:OD-1 I $P(PSGSA," ",OD1)'>$S(OD1>2:$P(PSGSA," ",OD1-1),1:PSGSA#1) S X1=X,X2=1 D C^%DTC
"RTN","PSIVCAL",102,0)
 I PSIVSD,OD>2 S Y=X_PSIVSD
"RTN","PSIVCAL",103,0)
 S PSIVADM=+Y,X=PSIVX,Y=PSIVY K PSGSA,PSIVSD,OD,OD1,PSIVMI,PSIVNOW S:PSIVADM<P(2) PSIVADM=P(2) Q
"RTN","PSIVCAL",104,0)
 ;
"RTN","PSIVCAL",105,0)
P S CD=PSIVNOW,PSGSA="",(PSIVSD,OD)=DT_.0001,X=P(11) D CHK S P(11)=X D ENP4^PSIVWL
"RTN","PSIVCAL",106,0)
 I PSGSA="" S PSIVSD=DT_.0001,PSIVMIN=-1440 D ENT^PSIVWL S $P(Y,".",2)=$P(P(11),"-",$L(P(11),"-")) Q
"RTN","PSIVCAL",107,0)
 S Y=$P(PSGSA," ",$L(PSGSA," ")-1) Q
"RTN","PSIVCAL",108,0)
AH F PSIVADM=0:-1 S CD=PSIVNOW,(X,X1)=DT,X2=PSIVADM D:X2 C^%DTC S X=$P(X,".") S (OD1,PSIVSD,OD)=X_.0001,PSIVMIN=P(15) D ENP3^PSIVWL Q:PSIVADM<-4!(PSGSA]"")
"RTN","PSIVCAL",109,0)
 S Y=$P(PSGSA," ",$L(PSGSA," ")-1) Q
"RTN","PSIVCAL",110,0)
MDNGHT(Y)          ;Sets Start Date/Time on orders placed between midnight and 12:30
"RTN","PSIVCAL",111,0)
 S Y=$$FMADD^XLFDT(Y,-1,0,0,0),Y=$P(Y,".")_".24" Q Y
"RTN","PSIVCAL",112,0)
 ;
"RTN","PSIVCAL",113,0)
DDLIM(PSIVDUR,STPDT) ;  Day Dose Limit
"RTN","PSIVCAL",114,0)
 N P3,NEWDAYS,NEWDUR,LASTD
"RTN","PSIVCAL",115,0)
 I DDLX["D" D  Q:(STPDT=0)
"RTN","PSIVCAL",116,0)
 .I +DDLX'<+PSIVDUR S STPDT=0 Q
"RTN","PSIVCAL",117,0)
 .S PSIVDUR=+DDLX,X2=PSIVDUR,X1=PSIVSTRT D C^%DTC S X=$P(X,"."),X=X_$S($P(PSIVSITE,"^",14)="":.2359,1:"."_$P(PSIVSITE,"^",14)) I X>P(2) S P(3)=X
"RTN","PSIVCAL",118,0)
 I DDLX["L",($G(P(9))]""),("AH"'[$G(PSIVTYPE)) S LASTD=$$DOSES(DDLX,.P) I LASTD D
"RTN","PSIVCAL",119,0)
 .S NEWDUR=$$FMDIFF^XLFDT(LASTD,P(2),2) I NEWDUR>0 S NEWDAYS=(NEWDUR/86400)
"RTN","PSIVCAL",120,0)
 .I $G(NEWDAYS) I NEWDAYS<PSIVDUR S PSIVDUR=NEWDAYS S P(3)=$$DATE2^PSJUTL2(LASTD)
"RTN","PSIVCAL",121,0)
 ;*229 Should be using LASTD if exists
"RTN","PSIVCAL",122,0)
 S P(3)=$$DATE2^PSJUTL2($S($G(LASTD):LASTD,1:P(3))),P(2)=$$DATE2^PSJUTL2(P(2)) S STPDT=P(3)
"RTN","PSIVCAL",123,0)
 Q
"RTN","PSIVCAL",124,0)
 ;
"RTN","PSIVCAL",125,0)
GETLIM(DFN,PSJORD) ; Convert IV Limits to minutes (only if in 'time' form).
"RTN","PSIVCAL",126,0)
 N ND2P5,F
"RTN","PSIVCAL",127,0)
 S F=$S(PSJORD["P":"^PS(53.1,+PSJORD,",PSJORD["V":"^PS(55,DFN,""IV"",+PSJORD,",1:"")
"RTN","PSIVCAL",128,0)
 S ND2P5=$G(@(F_"2.5)")) S LIM=$P(ND2P5,"^",4) Q:LIM="" 0
"RTN","PSIVCAL",129,0)
 S ND0=$G(@(F_"0)")) I PSJORD["P",$P(ND0,"^",4)="U" Q 0
"RTN","PSIVCAL",130,0)
 N MULT S MULT=$S($E(LIM)="h":60,$E(LIM)="d":1440,$E(LIM)="m":LIM,$E(LIM)="l":LIM,$E(LIM)="a":LIM,1:0) I MULT S LIM=MULT*$E(LIM,2,99)
"RTN","PSIVCAL",131,0)
 Q LIM
"RTN","PSIVCAL",132,0)
 ;
"RTN","PSIVCAL",133,0)
GETMIN(LIM,DFN,PSJORD,DAYS) ; Return the duration of the IV Limit in minutes (includes IV Limits in volume and doses format) 
"RTN","PSIVCAL",134,0)
 S LIM=$$GETMIN^PSIVUTL1(LIM,DFN,PSJORD,.DAYS)
"RTN","PSIVCAL",135,0)
 Q LIM
"RTN","PSIVCAL",136,0)
DOSES(DDLX,PRAY) ; Find stop date when 'doses' are sent as an IV Limit
"RTN","PSIVCAL",137,0)
 Q:$G(DDLX)'["L" ""
"RTN","PSIVCAL",138,0)
 I $P(DDLX,"L")["." S DDLX=($P(DDLX,".")+1)_"L"
"RTN","PSIVCAL",139,0)
 I '$G(PRAY(15)),$G(PRAY(11)) S PRAY(15)=1440/$L(PRAY(11),"-")
"RTN","PSIVCAL",140,0)
 Q:'$G(PRAY(2))!'$G(OIX) ""
"RTN","PSIVCAL",141,0)
 N FIRST,DOSAR,LAST,TMP9 S LAST="",TMP9=PRAY(9)
"RTN","PSIVCAL",142,0)
 S STRING=PRAY(2)_"^"_$S($G(STPDT):STPDT,1:$$FMADD^XLFDT(PSGDT,30))_"^"_PRAY(9)_"^C^"_OIX_"^"_PRAY(11) S FIRST=$$ENQ^PSJORP2(DFN,STRING)
"RTN","PSIVCAL",143,0)
 S P(9)=TMP9
"RTN","PSIVCAL",144,0)
 S FIRST=$S($G(FIRST):FIRST,1:PRAY(2)) Q:'FIRST  S DSTMP=FIRST,DOSAR(1)=DSTMP D
"RTN","PSIVCAL",145,0)
 .;*229 Add Dose Limit Calc
"RTN","PSIVCAL",146,0)
 .I $G(DDLX)["L",$G(PRAY(15)),($G(PRAY(11))']"")!($G(PRAY(15))>1440) N PSIVSD,PSIVMIN,X S PSIVMIN=(+DDLX*PRAY(15)),PSIVSD=+PRAY(2) D ENT^PSIVWL S DOSAR(1)=Y Q
"RTN","PSIVCAL",147,0)
 .I '$G(PRAY(11)) F I=2:1:DDLX+1 S DOSAR(I)=$$FMADD^XLFDT(DSTMP,,,PRAY(15)),DSTMP=DOSAR(I) Q
"RTN","PSIVCAL",148,0)
 .I $G(PRAY(11)) N ADMS,NXT,LAST,DAY S LAST=$P(DSTMP,".",2),DAY=$P(DSTMP,".") D
"RTN","PSIVCAL",149,0)
 ..F II=1:1:$L(PRAY(11),"-") S ADMS(+$P(PRAY(11),"-",II))=$P(PRAY(11),"-",II)
"RTN","PSIVCAL",150,0)
 ..;*229 Include DOW Calc, Need to Q if DAY<0 if we go past max dt
"RTN","PSIVCAL",151,0)
 ..F IJ=2:1:DDLX+1 S NXT=$O(ADMS(+LAST)),LAST=NXT D  Q:DAY<0
"RTN","PSIVCAL",152,0)
 ...I NXT="" S NXT=$O(ADMS(NXT)),LAST=NXT,DAY=$$FMADD^XLFDT(DAY,$$MWFD(PRAY(9),DAY)) Q:DAY<0
"RTN","PSIVCAL",153,0)
 ...S DOSAR(IJ)=DAY_"."_ADMS(NXT),DSTMP=DOSAR(IJ)
"RTN","PSIVCAL",154,0)
 ..I +DDLX=1 S NXT=$O(ADMS(LAST)),LAST=NXT D
"RTN","PSIVCAL",155,0)
 ...I NXT="" S NXT=$O(ADMS(NXT)),LAST=NXT
"RTN","PSIVCAL",156,0)
 I $D(DOSAR) S LAST=$O(DOSAR(""),-1) I LAST S LAST=DOSAR(LAST)
"RTN","PSIVCAL",157,0)
 Q LAST
"RTN","PSIVCAL",158,0)
 ;
"RTN","PSIVCAL",159,0)
MWFD(SCH,LAST) ;*229 Add to calc which days in DOW
"RTN","PSIVCAL",160,0)
 ;Calculate Days to add for DOW sched
"RTN","PSIVCAL",161,0)
 N X,Y
"RTN","PSIVCAL",162,0)
 I '$$DOW^PSIVUTL(SCH) Q 1 ;return 1 if not DOW
"RTN","PSIVCAL",163,0)
 F I=1:1:7 S X=$$FMADD^XLFDT(LAST,I) D DW^%DTC I SCH[$E(X,1,2) S Y=I Q
"RTN","PSIVCAL",164,0)
 Q Y
"RTN","PSIVCAL",165,0)
 ;
"RTN","PSIVEDT1")
0^22^B111693180^B63913566
"RTN","PSIVEDT1",1,0)
PSIVEDT1 ;BIR/MLM-EDIT IV ORDER (CONT) ; 2/14/12 7:20am
"RTN","PSIVEDT1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**3,7,41,47,50,64,58,116,110,111,113,267,279**;16 DEC 97;Build 150
"RTN","PSIVEDT1",3,0)
 ;
"RTN","PSIVEDT1",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSIVEDT1",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA# 2177.
"RTN","PSIVEDT1",6,0)
 ;
"RTN","PSIVEDT1",7,0)
10 ; Start Date
"RTN","PSIVEDT1",8,0)
 D:'P(2)&P("IVRM")!($G(PSJREN)) ENT^PSIVCAL
"RTN","PSIVEDT1",9,0)
A10 I $G(P("RES"))="R" I $G(ON)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT1",10,0)
 . Q:'$G(PSIVRENW)  W !!?5,"This is a Renewal Order. Start Date may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",11,0)
 I $G(ON)["V"!($G(ON)["U") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT1",12,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Start Date may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",13,0)
 S Y=P(2) X ^DD("DD") W !,"START DATE/TIME: "_$S(Y]"":Y_"// ",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $E(X)=U!(P(2)&X="") Q
"RTN","PSIVEDT1",14,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS G 10
"RTN","PSIVEDT1",15,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S F1=53.1,F2=10 S:X="@" X="?" D ENHLP^PSIVORC1 G A10
"RTN","PSIVEDT1",16,0)
 K %DT S:X="" X=P(2) S %DT="ERTX" D ^%DT K %DT G:Y'>0 A10
"RTN","PSIVEDT1",17,0)
 I $G(P("RES"))="R",(+Y<+$P($G(^PS(55,DFN,"IV",+$G(P("OLDON")),0)),U,2)) D  G 10
"RTN","PSIVEDT1",18,0)
 .; naked ref below refers to line above
"RTN","PSIVEDT1",19,0)
 .S Y=$P(^(0),U,2) X ^DD("DD") W $C(7),!!,"Start date of order being renewed is ",Y,".",!,"Start date of renewal order must be AFTER start date of order being renewed.",!
"RTN","PSIVEDT1",20,0)
 S X1=$G(P("LOG")),X2=-7 D C^%DTC I +Y<X W !!,"Start date/time may not be entered prior to 7 days from the order's LOGIN DATE.",! D A10
"RTN","PSIVEDT1",21,0)
 S P(2)=+Y,PSGSDX=1
"RTN","PSIVEDT1",22,0)
 Q
"RTN","PSIVEDT1",23,0)
 ;
"RTN","PSIVEDT1",24,0)
25 ; Stop Date
"RTN","PSIVEDT1",25,0)
 G:$D(PSGFDX) A25
"RTN","PSIVEDT1",26,0)
 I P("IVRM")]"",$S(P(3)<P(2):1,$G(PSIVAC)["E":0,1:1) S PSIVSITE=$G(^PS(59.5,+P("IVRM"),1)),$P(PSIVSITE,"^",20,21)=$G(^PS(59.5,+P("IVRM"),5)) D ENSTOP^PSIVCAL
"RTN","PSIVEDT1",27,0)
A25 I $G(ON)["V"!($G(ON)["U") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT1",28,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Stop Date may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",29,0)
 S Y=P(3) X ^DD("DD") W !,"STOP DATE/TIME: "_$S(Y]"":Y_"// ",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 Q:X=""&P(2)  I $E(X)=U!(X=""&P(2)) Q
"RTN","PSIVEDT1",30,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS G 25
"RTN","PSIVEDT1",31,0)
 I X="@"!(X["?") W $C(7),"  (Required)" S F1=53.1,F2=25,X="?" D ENHLP^PSIVORC1 G A25
"RTN","PSIVEDT1",32,0)
 K %DT S:X="" X=$G(Y) S:X="" X=P(3) S %DT="ERTX" D:X'=+X ^%DT
"RTN","PSIVEDT1",33,0)
 I X=+X,X>0,X'>2000000 G A25:'$$ENDL^PSGDL(P(9),X) D ENDL^PSIVSP
"RTN","PSIVEDT1",34,0)
 D DOSE
"RTN","PSIVEDT1",35,0)
 I $G(X)="" S X=Y
"RTN","PSIVEDT1",36,0)
 I $G(X)="" S X=P(3)
"RTN","PSIVEDT1",37,0)
 I $G(Z)]"",Z>X D  G A25
"RTN","PSIVEDT1",38,0)
 . W !,"There is no administration time that falls between the Start Date/Time"
"RTN","PSIVEDT1",39,0)
 . W !,"and Stop Date/Time.",!
"RTN","PSIVEDT1",40,0)
 S X=Y S:Y<1!Y'["." X="" G:Y'>0 A25 S P(3)=+Y,PSGFDX=1
"RTN","PSIVEDT1",41,0)
 Q
"RTN","PSIVEDT1",42,0)
 ;
"RTN","PSIVEDT1",43,0)
26 ; Schedule
"RTN","PSIVEDT1",44,0)
 I $G(P("RES"))="R" I $G(ON)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT1",45,0)
 . Q:'$G(PSIVRENW)  W !!?5,"This is a Renewal Order. Schedule may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",46,0)
 I $G(ON)["V"!($G(ON)["U") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT1",47,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Schedule may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",48,0)
 W !,"SCHEDULE: ",$S(P(9)]"":P(9)_"// ",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $E(X)=U!(X="") Q
"RTN","PSIVEDT1",49,0)
 I X="@" D DEL^PSIVEDRG S:%=1 P(9)="" G 26
"RTN","PSIVEDT1",50,0)
 I '$$SCHREQ^PSJLIVFD(.P) S P(7)="" I $P(X,"@",2)=0 D  G 26
"RTN","PSIVEDT1",51,0)
 .W $C(7),!!?2,"'@0' is not permitted for Continuous IV's",!
"RTN","PSIVEDT1",52,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS G 26
"RTN","PSIVEDT1",53,0)
 I X?1."?"!($L(X)>22)!($L(X," ")>3) S F1=55.01,F2=.09 D ENHLP^PSIVORC1 G 26
"RTN","PSIVEDT1",54,0)
 S CHG=0 I P(9)]"",X'=P(9) S CHG=1
"RTN","PSIVEDT1",55,0)
 S P(7)="" K PSGOES D EN^PSIVSP S:XT<0 X="" I $G(X)="" W $C(7),"??" G 26
"RTN","PSIVEDT1",56,0)
 I CHG D
"RTN","PSIVEDT1",57,0)
 . S P(9)=X,P(11)=Y,P(15)=XT
"RTN","PSIVEDT1",58,0)
 . I $$ODD^PSGS0(P(15)) S P(11)=""
"RTN","PSIVEDT1",59,0)
 . W !!?5,"This change in schedule also changes the Administration Times and Schedule Type of this order."
"RTN","PSIVEDT1",60,0)
 . S DIR("A")="Enter RETURN to continue or '^' to exit:"
"RTN","PSIVEDT1",61,0)
 . D PAUSE^VALM1
"RTN","PSIVEDT1",62,0)
 K CHG
"RTN","PSIVEDT1",63,0)
 Q
"RTN","PSIVEDT1",64,0)
 ;
"RTN","PSIVEDT1",65,0)
39 ; Admin Times
"RTN","PSIVEDT1",66,0)
 S ORIG=$G(P(11))
"RTN","PSIVEDT1",67,0)
A39 I $G(P("RES"))="R" I $G(ON)["P",($P($G(^PS(53.1,+ON,0)),"^",24)="R") D  Q
"RTN","PSIVEDT1",68,0)
 . Q:'$G(PSIVRENW)  W !!?5,"This is a Renewal Order. Administration times may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",69,0)
 I $G(ON)["V"!($G(ON)["U") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT1",70,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Admin Times may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",71,0)
 I $G(P(9))=""!($G(P(9))[" PRN")!($G(P(9))="PRN") Q  ;No schedule or PRN schedule
"RTN","PSIVEDT1",72,0)
 I $$ODD^PSGS0(P(15)) S P(11)="" Q
"RTN","PSIVEDT1",73,0)
 W !,"ADMINISTRATION TIMES: ",$S(P(11)]"":P(11)_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I '($G(P(15))="D"&'DONE) I $E(X)=U S (X,P(11))=ORIG Q
"RTN","PSIVEDT1",74,0)
 I X="",P(11)]"" S X=P(11)
"RTN","PSIVEDT1",75,0)
 I ($G(P(15))="D"!($G(P(9))["@"))&('$G(X)!(X["@")) W $C(7),"  ??" S X="?" W:(P(15)="D"!(X["@")) !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." G A39
"RTN","PSIVEDT1",76,0)
 I X="@" D DEL^PSIVEDRG S:%=1 P(11)="" G A39
"RTN","PSIVEDT1",77,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,39) G A39
"RTN","PSIVEDT1",78,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS G A39
"RTN","PSIVEDT1",79,0)
 I $G(P(15))'="D",$G(P(15))'="P",'$$ONCALL(P(9)) D TIMES I '$D(X) G A39
"RTN","PSIVEDT1",80,0)
 K:X[""""!($A(X)=45) X W:$G(X)="^"!('$D(X)) $C(7),"  ??" G:$G(X)="^"!('$D(X)) A39 S P(11)=X D:$G(PSIVCAL) ENT^PSIVCAL,ENSTOP^PSIVCAL K PSIVCAL
"RTN","PSIVEDT1",81,0)
 Q
"RTN","PSIVEDT1",82,0)
 ;
"RTN","PSIVEDT1",83,0)
59 ; Infusion Rate
"RTN","PSIVEDT1",84,0)
 N P8BADDEF S P8BADDEF=0
"RTN","PSIVEDT1",85,0)
 I $G(P("RES"))="R" I $G(ON)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT1",86,0)
 . Q:'$G(PSIVRENW)  W !!?5,"This is a Renewal Order. Infusion Rate may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",87,0)
 W !,"INFUSION RATE: ",$S(P(8)]"":$P(P(8),"@")_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $S($E(X)=U:1,X]"":0,1:P(8)]"") D:'$G(DONE) EXPINF(.X) D:'$G(DONE) NUMLAB(.P) G:$G(P8BADDEF) 59 Q
"RTN","PSIVEDT1",88,0)
 S X=$TR(X,$C(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,127)) ; Strip out control characters
"RTN","PSIVEDT1",89,0)
 I (("C^P"[P(4))!(("C^S"[P(4))&(P(5)=1)))&(X["@") D  G 59
"RTN","PSIVEDT1",90,0)
 .W $C(7),!!?2,"'@' is not permitted for Intermittent IV's",!
"RTN","PSIVEDT1",91,0)
 I (X["^") D  G 59
"RTN","PSIVEDT1",92,0)
 .W $C(7),!!?2,"'^' is not permitted",!
"RTN","PSIVEDT1",93,0)
 I X=""&(("C^P"[P(4))!(("C^S"[P(4))&(P(5)=1))) Q
"RTN","PSIVEDT1",94,0)
 I X="@" D DEL^PSIVEDRG S:%=1 P(8)="" G 59
"RTN","PSIVEDT1",95,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS G 59
"RTN","PSIVEDT1",96,0)
 I X["?" S F1=53.1,F2=59 D ENHLP^PSIVORC1 G 59
"RTN","PSIVEDT1",97,0)
 D EXPINF(.X)
"RTN","PSIVEDT1",98,0)
 I ($L(X)>30!($L(X)=1)),(X'?1N) D  G 59
"RTN","PSIVEDT1",99,0)
 .W $C(7),!!?3,"Free text entries must contain a minimum of 2 characters",!?3,"and a maximum of 30 characters",!
"RTN","PSIVEDT1",100,0)
 I X]"" D ENI^PSIVSP W:'$D(X) $C(7)," ??" G:'$D(X) 59 S P(8)=X
"RTN","PSIVEDT1",101,0)
 I P(8)="" W $C(7),!!,"An infusion rate must be entered!" G 59
"RTN","PSIVEDT1",102,0)
 D NUMLAB(.P)
"RTN","PSIVEDT1",103,0)
 Q
"RTN","PSIVEDT1",104,0)
 ;
"RTN","PSIVEDT1",105,0)
NUMLAB(P) ; Prompt for Number of Labels
"RTN","PSIVEDT1",106,0)
 N PSJILBS
"RTN","PSIVEDT1",107,0)
NUMLAB2 ; Loop
"RTN","PSIVEDT1",108,0)
 ; Quit if no Infusion Rate
"RTN","PSIVEDT1",109,0)
 Q:($G(P(8))="")
"RTN","PSIVEDT1",110,0)
 I (("C^P"[P(4))!(("C^S"[P(4))&(P(5)=1))) D  Q
"RTN","PSIVEDT1",111,0)
 .I $G(X)="",$G(P(8))["@" S P(8)=$P(P(8),"@")
"RTN","PSIVEDT1",112,0)
 K DIR S PSJILBS=$P($G(P(8)),"@",2) S:'(PSJILBS?1.N) PSJILBS=$G(P("NUMLBL")) I $G(PSJILBS)?1.N S DIR("B")=PSJILBS
"RTN","PSIVEDT1",113,0)
 D NLBHLP(1)
"RTN","PSIVEDT1",114,0)
 S DIR(0)="FAO",DIR("A")="NUMBER OF LABELS PER DAY: " D ^DIR Q:X="^"
"RTN","PSIVEDT1",115,0)
 I X="@" D DEL^PSIVEDRG S:%=1 P("NUMLBL")="",P(8)=$P(P(8),"@") G NUMLAB2
"RTN","PSIVEDT1",116,0)
 I X?1."?" D NLBHLP G NUMLAB2
"RTN","PSIVEDT1",117,0)
 I X?1.2N S P("NUMLBL")=+X,P(8)=$P(P(8),"@")_"@"_P("NUMLBL") Q
"RTN","PSIVEDT1",118,0)
 I X="",(P(8)'?1N.N.1".".1N1" ml/hr") D  G NUMLAB2
"RTN","PSIVEDT1",119,0)
 .W $C(7),!!,"Number of Labels is required for continuous IV's with free text Infusion Rate.",!
"RTN","PSIVEDT1",120,0)
 Q:X=""
"RTN","PSIVEDT1",121,0)
 I X'?1.2N D  G NUMLAB2
"RTN","PSIVEDT1",122,0)
 .W $C(7),!!,"Type a number between 0 and 99, 0 decimal digits",!
"RTN","PSIVEDT1",123,0)
 Q
"RTN","PSIVEDT1",124,0)
 ;
"RTN","PSIVEDT1",125,0)
63 ; Remarks
"RTN","PSIVEDT1",126,0)
 N DIR S X="",DIR(0)="53.1,63" S:P("REM")]"" DIR("B")=P("REM") D ^DIR I X="^"!$D(DTOUT) S DONE=1 Q
"RTN","PSIVEDT1",127,0)
 I X="@" D DEL^PSIVEDRG S:%=1 P("REM")="" G 63
"RTN","PSIVEDT1",128,0)
 I X]"",$E(X)'="^" S P("REM")=X
"RTN","PSIVEDT1",129,0)
 Q
"RTN","PSIVEDT1",130,0)
 ;
"RTN","PSIVEDT1",131,0)
64 ; Other Print Info
"RTN","PSIVEDT1",132,0)
 N OPIMSG,PSJOPILN,PSJOPIT,PSJTMPTX,TMPLIN,PSJOVRMX
"RTN","PSIVEDT1",133,0)
 S PSJOPILN=$$EDITOPI^PSJBCMA5(DFN) S OPIMSG="Instructions too long. See Order View or BCMA for full text."
"RTN","PSIVEDT1",134,0)
 S PSJTMPTX="",PSJOVRMX=0
"RTN","PSIVEDT1",135,0)
 S TMPLIN=0 F  S TMPLIN=$O(^PS(53.45,$G(PSJSYSP),6,TMPLIN)) Q:'TMPLIN!PSJOVRMX  D
"RTN","PSIVEDT1",136,0)
 .S:($L(PSJTMPTX)+$L($G(^PS(53.45,$G(DUZ),6,TMPLIN,0))))>60 PSJOVRMX=1 Q:$G(PSJOVRMX)  D
"RTN","PSIVEDT1",137,0)
 ..S PSJTMPTX=$G(PSJTMPTX)_$S($L($G(PSJTMPTX)):" ",1:"")_$G(^PS(53.45,$G(DUZ),6,TMPLIN,0))
"RTN","PSIVEDT1",138,0)
 S PSJTMPTX=$S($G(PSJOVRMX):OPIMSG,1:$G(PSJTMPTX))
"RTN","PSIVEDT1",139,0)
 S P("OPI")=PSJTMPTX I (PSJOPILN>0) S P("OPI")=$$ENBCMA^PSJUTL("V")
"RTN","PSIVEDT1",140,0)
 Q
"RTN","PSIVEDT1",141,0)
 ;
"RTN","PSIVEDT1",142,0)
ORFLDS ; Display OE/RR fields during edit.
"RTN","PSIVEDT1",143,0)
 D FULL^VALM1
"RTN","PSIVEDT1",144,0)
 W !!,"Orderable Item: ",$P(P("PD"),U,2),!,"Give: ",$P(P("MR"),U,2)," ",P(9),!!
"RTN","PSIVEDT1",145,0)
 Q
"RTN","PSIVEDT1",146,0)
 ;
"RTN","PSIVEDT1",147,0)
TIMES ;At least one admin time, not more than interval allows.
"RTN","PSIVEDT1",148,0)
 I $G(P(15)) Q:$$ODD^PSGS0(P(15))
"RTN","PSIVEDT1",149,0)
 I $G(P(15))="C"!$$CONTIN($G(P(9))) I '$$ONCALL($G(P(9))),X="" W !,"This order requires at least one administration time." K X Q  ;No times
"RTN","PSIVEDT1",150,0)
 N H,I,MAX
"RTN","PSIVEDT1",151,0)
 I $G(P(15))="O"!$$ONETIME($G(P(9))) I $L(X,"-")>1 W !," This is a One Time Order - only one administration time is permitted." K X Q
"RTN","PSIVEDT1",152,0)
 I $G(P(15))="O"!$$ONETIME($G(P(9))) Q  ;Done validating One Time
"RTN","PSIVEDT1",153,0)
 I $G(P(9))]"" S H=+$O(^PS(51.1,"B",P(9),0)) S I=$P($G(^PS(51.1,H,0)),"^",3)
"RTN","PSIVEDT1",154,0)
 I +I=0 Q  ;No frequency - can not check frequency related items
"RTN","PSIVEDT1",155,0)
 S MAX=1440/I
"RTN","PSIVEDT1",156,0)
 I MAX<1,$L(X,"-")>1 W !,"This order requires one administration time." K X Q
"RTN","PSIVEDT1",157,0)
 I MAX'<1,$L(X,"-")>MAX W !,"The number of admin times entered is greater than indicated by the schedule." K X Q  ;Too many times
"RTN","PSIVEDT1",158,0)
 I MAX'<1,$L(X,"-")<MAX D  ;Too few times
"RTN","PSIVEDT1",159,0)
 . W !,"The number of admin times entered is fewer than indicated by the schedule."
"RTN","PSIVEDT1",160,0)
 . N X,DIR
"RTN","PSIVEDT1",161,0)
 . D PAUSE^VALM1
"RTN","PSIVEDT1",162,0)
 Q
"RTN","PSIVEDT1",163,0)
 ;
"RTN","PSIVEDT1",164,0)
DOSE ;Make certain at least one dose is given.
"RTN","PSIVEDT1",165,0)
 N INFO,Y,PNINE
"RTN","PSIVEDT1",166,0)
 S PNINE=P(9)
"RTN","PSIVEDT1",167,0)
 S INFO=$G(P(2))_U_$G(P(3))_U_$G(P(9))_U_$P($G(PSGZZND),"^",5)_U_$P($G(P("PD")),"^")_U_$G(P(11))
"RTN","PSIVEDT1",168,0)
 I '$L($G(PSGP)) N PSGP S PSGP=""
"RTN","PSIVEDT1",169,0)
 S Z=$$ENQ^PSJORP2(PSGP,INFO)  ;Expected first dose.
"RTN","PSIVEDT1",170,0)
 S P(9)=PNINE
"RTN","PSIVEDT1",171,0)
 Q
"RTN","PSIVEDT1",172,0)
 ;
"RTN","PSIVEDT1",173,0)
ONCALL(SCHD) ; Check if a schedule is type On Call (all schedules with a given name must have the same schedule type)
"RTN","PSIVEDT1",174,0)
 N NXT,SCHARR
"RTN","PSIVEDT1",175,0)
 S OCCHK=0
"RTN","PSIVEDT1",176,0)
 Q:$G(SCHD)="" OCCHK
"RTN","PSIVEDT1",177,0)
 Q:'$D(^PS(51.1,"APPSJ",SCHD)) OCCHK
"RTN","PSIVEDT1",178,0)
 S NXT=0 F  S NXT=$O(^PS(51.1,"APPSJ",SCHD,NXT)) Q:'NXT  S TYP=$P($G(^PS(51.1,+NXT,0)),"^",5) S:TYP]"" SCHARR(TYP)=""
"RTN","PSIVEDT1",179,0)
 I '$D(SCHARR("OC")) S OCCHK=0 Q OCCHK
"RTN","PSIVEDT1",180,0)
 I $O(SCHARR("OC"))]""!($O(SCHARR("OC"),-1)]"") S OCCHK=0 Q OCCHK
"RTN","PSIVEDT1",181,0)
 I $D(SCHARR("OC")) S OCCHK=1
"RTN","PSIVEDT1",182,0)
 Q OCCHK
"RTN","PSIVEDT1",183,0)
 ;
"RTN","PSIVEDT1",184,0)
ONETIME(SCHD) ; Check if a schedule is type On Call (all schedules with a given name must have the same schedule type)
"RTN","PSIVEDT1",185,0)
 N NXT,SCHARR
"RTN","PSIVEDT1",186,0)
 S OCCHK=0
"RTN","PSIVEDT1",187,0)
 Q:$G(SCHD)="" OCCHK
"RTN","PSIVEDT1",188,0)
 Q:'$D(^PS(51.1,"APPSJ",SCHD)) OCCHK
"RTN","PSIVEDT1",189,0)
 S NXT=0 F  S NXT=$O(^PS(51.1,"APPSJ",SCHD,NXT)) Q:'NXT  S TYP=$P($G(^PS(51.1,+NXT,0)),"^",5) S:TYP]"" SCHARR(TYP)=""
"RTN","PSIVEDT1",190,0)
 I '$D(SCHARR("O")) S OCCHK=0 Q OCCHK
"RTN","PSIVEDT1",191,0)
 I $O(SCHARR("O"))]""!($O(SCHARR("O"),-1)]"") S OCCHK=0 Q OCCHK
"RTN","PSIVEDT1",192,0)
 I $D(SCHARR("O")) S OCCHK=1
"RTN","PSIVEDT1",193,0)
 Q OCCHK
"RTN","PSIVEDT1",194,0)
 ;
"RTN","PSIVEDT1",195,0)
CONTIN(SCHD) ; Check if a schedule is type On Call (all schedules with a given name must have the same schedule type)
"RTN","PSIVEDT1",196,0)
 N NXT,SCHARR
"RTN","PSIVEDT1",197,0)
 S OCCHK=0
"RTN","PSIVEDT1",198,0)
 Q:$G(SCHD)="" OCCHK
"RTN","PSIVEDT1",199,0)
 Q:'$D(^PS(51.1,"APPSJ",SCHD)) OCCHK
"RTN","PSIVEDT1",200,0)
 S NXT=0 F  S NXT=$O(^PS(51.1,"APPSJ",SCHD,NXT)) Q:'NXT  S TYP=$P($G(^PS(51.1,+NXT,0)),"^",5) S:TYP]"" SCHARR(TYP)=""
"RTN","PSIVEDT1",201,0)
 I '$D(SCHARR("C")) S OCCHK=0 Q OCCHK
"RTN","PSIVEDT1",202,0)
 I $O(SCHARR("C"))]""!($O(SCHARR("C"),-1)]"") S OCCHK=0 Q OCCHK
"RTN","PSIVEDT1",203,0)
 I $D(SCHARR("C")) S OCCHK=1
"RTN","PSIVEDT1",204,0)
 Q OCCHK
"RTN","PSIVEDT1",205,0)
 ;
"RTN","PSIVEDT1",206,0)
NLBHLP(OUT) ; Help text for Number of Labels per day
"RTN","PSIVEDT1",207,0)
 I OUT=1 D  Q
"RTN","PSIVEDT1",208,0)
 .S DIR("?",1)="Enter the # of labels per day that will be needed."
"RTN","PSIVEDT1",209,0)
 .S DIR("?",2)=""
"RTN","PSIVEDT1",210,0)
 .S DIR("?",3)="Example:   0 = 0 labels per day."
"RTN","PSIVEDT1",211,0)
 .S DIR("?",4)="           2 = 2 labels per day."
"RTN","PSIVEDT1",212,0)
 .S DIR("?",5)="Note:  Number of Labels per day is required for continuous IV orders"
"RTN","PSIVEDT1",213,0)
 .S DIR("?",6)="       with free text Infusion Rate. Number of labels per day is not"
"RTN","PSIVEDT1",214,0)
 .S DIR("?",7)="       permitted for Intermittent (IVPB) type orders; for Intermittent"
"RTN","PSIVEDT1",215,0)
 .S DIR("?",8)="       orders, the schedule and administration time(s) will be used to"
"RTN","PSIVEDT1",216,0)
 .S DIR("?")="       determine the number of labels needed."
"RTN","PSIVEDT1",217,0)
 ;
"RTN","PSIVEDT1",218,0)
 W !,"Enter the # of labels per day that will be needed."
"RTN","PSIVEDT1",219,0)
 W !,"Example:   0 = 0 labels per day."
"RTN","PSIVEDT1",220,0)
 W !,"           2 = 2 labels per day."
"RTN","PSIVEDT1",221,0)
 W !!,"Note: Number of Labels per day is required for continuous IV orders"
"RTN","PSIVEDT1",222,0)
 W !,"       with free text Infusion Rate. Number of labels per day is not"
"RTN","PSIVEDT1",223,0)
 W !,"       permitted for Intermittent (IVPB) type orders; for Intermittent"
"RTN","PSIVEDT1",224,0)
 W !,"       orders, the schedule and administration time(s) will be used to"
"RTN","PSIVEDT1",225,0)
 W !,"       determine the number of labels needed."
"RTN","PSIVEDT1",226,0)
 Q
"RTN","PSIVEDT1",227,0)
 ;
"RTN","PSIVEDT1",228,0)
EXPINF(P8,SILENT) ; Expand Infusion Rate
"RTN","PSIVEDT1",229,0)
 Q:$G(P8)  N P8TMP S P8TMP=$$UP^XLFSTR($P(P8,"@"))
"RTN","PSIVEDT1",230,0)
 N EXPANDED S EXPANDED="" D INFCHK^PSJLIVFD(P8TMP,.EXPANDED)
"RTN","PSIVEDT1",231,0)
 N EXMSG S EXMSG=""
"RTN","PSIVEDT1",232,0)
 I (EXPANDED=$P(P8,"@"))!(EXPANDED=P8TMP) Q
"RTN","PSIVEDT1",233,0)
 S EXMSG=1 I '$G(SILENT) W "     Now expanding text"
"RTN","PSIVEDT1",234,0)
 I P8["@" S $P(P8,"@")=EXPANDED
"RTN","PSIVEDT1",235,0)
 I P8'["@" S P8=EXPANDED
"RTN","PSIVEDT1",236,0)
 I '$G(SILENT) W:$G(EXMSG) !," Input expanded to ",EXPANDED
"RTN","PSIVEDT1",237,0)
 Q
"RTN","PSIVHYPL")
0^10^B49378868^B42608112
"RTN","PSIVHYPL",1,0)
PSIVHYPL ;BIR/PR-PRINT OUT LABELS ;26 FEB 97 / 3:20 PM
"RTN","PSIVHYPL",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**58,96,128,178,184,279**;16 DEC 97;Build 150
"RTN","PSIVHYPL",3,0)
 ;
"RTN","PSIVHYPL",4,0)
 ; Reference to ^%ZIS(2 is supported by DBIA 3435.
"RTN","PSIVHYPL",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSIVHYPL",6,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVHYPL",7,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVHYPL",8,0)
 ; Reference to ^PS(50.4 is supported by DBIA 2175.
"RTN","PSIVHYPL",9,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSIVHYPL",10,0)
 ;
"RTN","PSIVHYPL",11,0)
 ;NEEDS DFN, ON AND PSIVNOL (Total number of labels to print) and
"RTN","PSIVHYPL",12,0)
 ;PSIVCT - $D(PSIVCT) NO COUNT LABEL
"RTN","PSIVHYPL",13,0)
SSWARD ;Get patient SS# and ward location
"RTN","PSIVHYPL",14,0)
 N X0,PSJIO,I,PSIVCLAB
"RTN","PSIVHYPL",15,0)
 S I=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=^(I,0),PSJIO($P(X0,"^"))=^(1)
"RTN","PSIVHYPL",16,0)
 S PSJIO=$S('$D(PSJIO):0,1:1)
"RTN","PSIVHYPL",17,0)
 N PSIVCLIN,PSIVCLDT S PSIVCLIN=+$G(^PS(55,DFN,"IV",+ON,"DSS")) S:'(PSIVCLIN>0) PSIVCLIN="" I PSIVCLIN D
"RTN","PSIVHYPL",18,0)
 .S PSIVCLDT=$P(PSIVCLIN,"^",2) S $P(PSIVCLIN,"^",2)=$P($G(^SC(+PSIVCLIN,0)),"^")
"RTN","PSIVHYPL",19,0)
 I $G(PSIVCLIN) S PSIVCLAB=$P($G(^SC(+PSIVCLIN,0)),"^",2)
"RTN","PSIVHYPL",20,0)
 D ENIV^PSJAC S VADM(2)=$E(VADM(2),6,9),PSIVWD=$S(+VAIN(4):$P(VAIN(4),U,2),$G(PSIVCLIN)&($G(PSIVCLAB)]""):PSIVCLAB,$G(PSIVCLIN)&($P($G(PSIVCLIN),"^",2)]""):$P(PSIVCLIN,"^",2),1:"Opt. IV")
"RTN","PSIVHYPL",21,0)
 ;D ENIV^PSJAC S VADM(2)=$E(VADM(2),6,9),PSIVWD=$S((+VAIN(4)&'$G(PSIVCLDT)):$P(VAIN(4),U,2),$G(PSIVCLIN)>0:$P(PSIVCLIN,"^",2),1:"Opt. IV")
"RTN","PSIVHYPL",22,0)
 I PSIVWD="",$P($G(^PS(55,DFN,"IV",+ON,0)),"^",22) S PSIVWD=$P($G(^DIC(42,+$P($G(^PS(55,DFN,"IV",+ON,0)),"^",22),0)),"^")
"RTN","PSIVHYPL",23,0)
 G:PSIVNOL<1 Q D SETP,^PSIVHYP S PSIVRM=$P(PSIVSITE,U,13),P16=$P($G(^PS(55,DFN,"IV",+ON,9)),U,3) S:PSIVRM<1 PSIVRM=30 I $D(PSIVCT),PSIVCT'=1 K PSIVCT
"RTN","PSIVHYPL",24,0)
 I PSJIO,$G(PSJIO("FI"))]"" X PSJIO("FI")
"RTN","PSIVHYPL",25,0)
 I $P(PSIVSITE,U,7) D
"RTN","PSIVHYPL",26,0)
 . S PSIVFLAG=1,(LINE,PSIV1)=0,PSIV2=PSIVNOL,PSIVNOL=0 D RE
"RTN","PSIVHYPL",27,0)
 . S PSIVRP="",PSIVRT=""
"RTN","PSIVHYPL",28,0)
 . I $D(^PS(55,DFN,"IV",+ON,.2)) S PSIVRP=$P(^PS(55,DFN,"IV",+ON,.2),U,3) D
"RTN","PSIVHYPL",29,0)
 .. I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) Q   ;QUIT IF "DOSE DUE AT" LINE IS SET TO NOT PRINT
"RTN","PSIVHYPL",30,0)
 .. S PSIVRT=$P(^PS(51.2,PSIVRP,0),U,1)
"RTN","PSIVHYPL",31,0)
 .. S X="ROUTE: "_PSIVRT D:X]"" PMR
"RTN","PSIVHYPL",32,0)
 . S X="Solution: _______________" D PRNTL S X="Additive: _______________" D PRNTL
"RTN","PSIVHYPL",33,0)
 . S PSIVNOL=PSIV2
"RTN","PSIVHYPL",34,0)
 . I 'PSJIO F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVHYPL",35,0)
 . I PSJIO,$G(PSJIO("EL"))]"" X PSJIO("EL")
"RTN","PSIVHYPL",36,0)
 I '$D(PSIVCT) D NOW^%DTC S Y=%,$P(^PS(55,DFN,"IV",+ON,9),U,1,2)=Y_"^"_PSIVNOL,$P(^(9),U,3)=$P(^(9),U,3)+PSIVNOL
"RTN","PSIVHYPL",37,0)
 K PSIVFLAG,PSIVSH
"RTN","PSIVHYPL",38,0)
START F PSIV1=1:1:PSIVNOL D
"RTN","PSIVHYPL",39,0)
 . S LINE=0 D RE
"RTN","PSIVHYPL",40,0)
 . Q:$D(PSIVFLAG) 
"RTN","PSIVHYPL",41,0)
 . I 'PSJIO F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVHYPL",42,0)
 . I PSJIO,$G(PSJIO("EL"))]"" X PSJIO("EL")
"RTN","PSIVHYPL",43,0)
 I PSJIO,$G(PSJIO("FE"))]"" X PSJIO("FE")
"RTN","PSIVHYPL",44,0)
 D:'$D(PSIVCT) ^PSIVSTAT
"RTN","PSIVHYPL",45,0)
Q K HYPL,LINE,MESS,P16,PDATE,PDOSE,PSIV,PSIVA,PSIV1,PSIV2,PSIVCT,PSIVDOSE,PSIVFLAG,PSIVRM,PSIVWD,TVOL,HYPLPRT,PSIMESS Q
"RTN","PSIVHYPL",46,0)
RE I PSIV1 S:P(15)>2880!('P(15)) P(15)=2880 S P(16)=P16+PSIV1#(1440/P(15)+.5\1) S:'P(16) P(16)=1440/P(15)+.5\1
"RTN","PSIVHYPL",47,0)
 K DO
"RTN","PSIVHYPL",48,0)
 I PSJIO,$G(PSJIO("SL"))]"" X PSJIO("SL")
"RTN","PSIVHYPL",49,0)
 I PSIV1 S PSJBCID=$$BCMA^PSIVBCID(DFN,ON,$D(PSIVCT),$G(PSIV1),$G(PSIV2),$G(PSIVNOL)) D BARCODE
"RTN","PSIVHYPL",50,0)
 S X="["_$P(^PS(55,DFN,"IV",+ON,0),U)_"]"_" "_VADM(2)_"  "_PSIVWD_"  "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3)
"RTN","PSIVHYPL",51,0)
 I ($G(PSIVCLIN)>0),$L($G(PSIVRM)),'$G(VAIN(4)) N PSJTRNC S PSJTRNC=$L(X)-+$G(PSIVRM) I PSJTRNC>0,($L(PSIVWD)>PSJTRNC) D
"RTN","PSIVHYPL",52,0)
 . S X="["_$P(^PS(55,DFN,"IV",+ON,0),U)_"]"_" "_VADM(2)_"  "_$E(PSIVWD,1,$L(PSIVWD)-PSJTRNC)_"  "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3)
"RTN","PSIVHYPL",53,0)
 D PRNTL
"RTN","PSIVHYPL",54,0)
 S X=VADM(1) S:$P(PSIVSITE,U,9) X=X_"  "_$S(VAIN(5)]"":VAIN(5),1:"NF") D PRNTL S X=" " D PRNTL
"RTN","PSIVHYPL",55,0)
 D:$P(PSIVSITE,U,12) TVOL
"RTN","PSIVHYPL",56,0)
 S X="",$P(X,"=",PSIVRM-1)="" D PRNTL
"RTN","PSIVHYPL",57,0)
 I $D(PSIVFLAG) F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"AD",PSIV)) Q:'PSIV  S Y=^(PSIV,0),X=$S($D(^PS(52.6,+Y,0)):$P(^(0),U),1:"*********")_"  "_$P(Y,U,2)_" " S:$P(Y,U,3)]"" X=X_" ("_$P(Y,U,3)_")" D
"RTN","PSIVHYPL",58,0)
 . D PRNTL
"RTN","PSIVHYPL",59,0)
 . D MESS
"RTN","PSIVHYPL",60,0)
 I $D(PSIVFLAG) F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"SOL",PSIV)) Q:'PSIV  S PSIV=PSIV_"^"_+^(PSIV,0),YY=^(0) D
"RTN","PSIVHYPL",61,0)
 . D SOL1,PRNTL
"RTN","PSIVHYPL",62,0)
 . S X=$P(^PS(52.7,$P(PSIV,U,2),0),U,4) I X]"" S X="   "_X D PRNTL
"RTN","PSIVHYPL",63,0)
 G:$D(PSIVFLAG) SOL
"RTN","PSIVHYPL",64,0)
 F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"SOL",PSIV)) Q:'PSIV  S PSIV=PSIV_"^"_+^(PSIV,0),YY=^(0) D
"RTN","PSIVHYPL",65,0)
 . D SOL1,PRNTL I PSIV1 D UP3^PSIVBCID(DFN,PSJBLN,PSIV,YY)
"RTN","PSIVHYPL",66,0)
 . S X=$P(^PS(52.7,$P(PSIV,U,2),0),U,4) I X]"" S X="   "_X D PRNTL
"RTN","PSIVHYPL",67,0)
 F I=0:0 S I=$O(HYPL(I)) Q:'I  S PSIV="" D
"RTN","PSIVHYPL",68,0)
 . F I=I:0 S PSIV=$O(HYPL(I,PSIV)) Q:PSIV=""  S Y="",X=0 D
"RTN","PSIVHYPL",69,0)
 .. X "F ZZ=0:0 S Y=$O(HYPL(I,PSIV,Y)) Q:Y=""""  I Y=""ALL""!(Y=""***"")!(Y[P(16)) S X=X+$P(HYPL(I,PSIV,Y),U),PSIVP=HYPL(I,PSIV,Y) D UPD"
"RTN","PSIVHYPL",70,0)
 .. I X D HYP
"RTN","PSIVHYPL",71,0)
 K HYPAD
"RTN","PSIVHYPL",72,0)
SOL S X="",$P(X,"=",PSIVRM-1)="" D PRNTL
"RTN","PSIVHYPL",73,0)
 S X=" " D PRNTL I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) G MEDRT
"RTN","PSIVHYPL",74,0)
 S:'$D(PSIVDOSE) PSIVDOSE="" S X=$P(PSIVDOSE," ",PSIV1) D:$E(X)="." CONVER^PSIVLABL S X="Dose due at: "_$S(X="":"________",1:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)_" "_$E(X#1_"000",2,5)) D PRNTL
"RTN","PSIVHYPL",75,0)
 ;
"RTN","PSIVHYPL",76,0)
MEDRT ;Find Medication Route   
"RTN","PSIVHYPL",77,0)
 S PSIVRP="",PSIVRT=""
"RTN","PSIVHYPL",78,0)
 I $D(^PS(55,DFN,"IV",+ON,.2)) S PSIVRP=$P(^PS(55,DFN,"IV",+ON,.2),U,3) D
"RTN","PSIVHYPL",79,0)
 .S PSIVRT=$P(^PS(51.2,PSIVRP,0),U,1)
"RTN","PSIVHYPL",80,0)
 .S X="ROUTE: "_PSIVRT D:X]"" PMR
"RTN","PSIVHYPL",81,0)
 ;
"RTN","PSIVHYPL",82,0)
INF S X=$P(P(8),"@") D:X]"" PRNTL
"RTN","PSIVHYPL",83,0)
 I $D(^PS(55,DFN,"IV",+ON,3)) S X=$P(^(3),U) D:X]"" PRNTL
"RTN","PSIVHYPL",84,0)
 S X=P(9) D:X]"" PRNTL
"RTN","PSIVHYPL",85,0)
 S X=P(11) D:X]"" PRNTL
"RTN","PSIVHYPL",86,0)
 ;PSJ*5*184 - Display all messages if more than one additive has a message.
"RTN","PSIVHYPL",87,0)
 I $D(MESS) S PSIMESS="" F  S PSIMESS=$O(MESS(PSIMESS)) Q:PSIMESS=""  S X=PSIMESS D PRNTL
"RTN","PSIVHYPL",88,0)
 I $D(^PS(59.5,PSIVSN,4)) S Y=^(4) F PSIV=1:1 S X=$P(Y,U,PSIV) Q:X=""  D PRNTL
"RTN","PSIVHYPL",89,0)
 S X=PSIV1_"["_PSIVNOL_"]" D PRNTL
"RTN","PSIVHYPL",90,0)
 Q
"RTN","PSIVHYPL",91,0)
PRNTL N I F LINE=LINE+1:1 D  Q:$L(X)<1
"RTN","PSIVHYPL",92,0)
 . I LINE>PSIVSITE D
"RTN","PSIVHYPL",93,0)
 .. S LINE=1
"RTN","PSIVHYPL",94,0)
 .. I 'PSJIO D  Q
"RTN","PSIVHYPL",95,0)
 ... F ZZ=1:1 Q:ZZ>$P(PSIVSITE,"^",16)  W !
"RTN","PSIVHYPL",96,0)
 .. F I="EL","SL" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPL",97,0)
 . K ZZ
"RTN","PSIVHYPL",98,0)
 . F I="ST","STF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPL",99,0)
 . W $E(X,1,PSIVRM)
"RTN","PSIVHYPL",100,0)
 . F I="ETF","ET" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPL",101,0)
 . I 'PSJIO W !
"RTN","PSIVHYPL",102,0)
 . S X=$E(X,PSIVRM+1,999)
"RTN","PSIVHYPL",103,0)
 Q
"RTN","PSIVHYPL",104,0)
PMR ; Print Med Route on label
"RTN","PSIVHYPL",105,0)
 ;  
"RTN","PSIVHYPL",106,0)
 F LINE=LINE+1:1 D  Q:$L(X)<1
"RTN","PSIVHYPL",107,0)
 . I LINE>PSIVSITE D
"RTN","PSIVHYPL",108,0)
 .. S LINE=1
"RTN","PSIVHYPL",109,0)
 .. I 'PSJIO D  Q
"RTN","PSIVHYPL",110,0)
 ... F ZZ=1:1 Q:ZZ>$P(PSIVSITE,"^",16)  W !
"RTN","PSIVHYPL",111,0)
 .. F I="EL","SL" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPL",112,0)
 . K ZZ
"RTN","PSIVHYPL",113,0)
 . ;
"RTN","PSIVHYPL",114,0)
 . F I="ST","STF","SM","SMF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPL",115,0)
 . W $E(X,1,PSIVRM)
"RTN","PSIVHYPL",116,0)
 . F I="ETF","ET","EMF","EM" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPL",117,0)
 . I 'PSJIO W !
"RTN","PSIVHYPL",118,0)
 . S X=$E(X,PSIVRM+1,999)
"RTN","PSIVHYPL",119,0)
 Q
"RTN","PSIVHYPL",120,0)
TVOL ;
"RTN","PSIVHYPL",121,0)
 S PSIV=TVOL F X=0:0 S X=$O(^PS(55,DFN,"IV",+ON,"AD",X)) Q:'X  S X=X_"^"_^(X,0) S:$P(X,U,4)[P(16)!($P(X,U,4)="")!'PSIV1 PSIV=PSIV+$S($P(^PS(52.6,$P(X,U,2),0),U,10):$P(X,U,3)/$P(^(0),U,10),1:0)
"RTN","PSIVHYPL",122,0)
 S X="Total Volume: "_(PSIV+.5\1) D PRNTL
"RTN","PSIVHYPL",123,0)
 Q
"RTN","PSIVHYPL",124,0)
SOL1 S X=$S($D(^PS(52.7,$P(PSIV,U,2),0)):$P(^(0),U)_" "_$P(^PS(55,DFN,"IV",+ON,"SOL",+PSIV,0),U,2),1:"**********") Q
"RTN","PSIVHYPL",125,0)
HYP ;
"RTN","PSIVHYPL",126,0)
 I PSIV="*" S X="*** Error in "_$S(I=50.4:"electrolyte",I=52.7:"solution",1:"additive") D PRNTL Q
"RTN","PSIVHYPL",127,0)
 S PSIVA=$S(I=50.4:PSIV,I=52.7:+$G(^PS(55,DFN,"IV",+ON,"SOL",PSIV,0)),1:+$G(^PS(55,DFN,"IV",+ON,"AD",PSIV,0)))
"RTN","PSIVHYPL",128,0)
 S X=$S($D(^PS(I,PSIVA,0)):$P(^(0),U),1:"Undefined "_$S(I=50.4:"electrolyte",I=52.7:"solution",1:"additive"))_" "_$S(X<1:"0"_(X+.005\.01/100),1:(X+.005\.01/100))_" "_$P($P(HYPL(I,PSIV,$O(HYPL(I,PSIV,""))),U)," ",2)
"RTN","PSIVHYPL",129,0)
 D PRNTL
"RTN","PSIVHYPL",130,0)
 Q
"RTN","PSIVHYPL",131,0)
SETP S Y=^PS(55,DFN,"IV",+ON,0) F X=1:1:23 S P(X)=$P(Y,U,X)
"RTN","PSIVHYPL",132,0)
 Q
"RTN","PSIVHYPL",133,0)
MESS ;PSJ*5*184 -make MESS a local array so all messages display for all additives.
"RTN","PSIVHYPL",134,0)
 I $P(^PS(52.6,+Y,0),U,9)]"" S MESS($P(^PS(52.6,+Y,0),U,9))=""
"RTN","PSIVHYPL",135,0)
 Q
"RTN","PSIVHYPL",136,0)
UPD N X,Y,PSIVEL,PSIVAD
"RTN","PSIVHYPL",137,0)
 S PSIVEL=$P(PSIVP,"^",2)
"RTN","PSIVHYPL",138,0)
 I I=50.4 F PSIVAD=0:0 S PSIVAD=$O(HYPLRPT(PSIVEL,"AD",PSIVAD)) Q:'PSIVAD  D
"RTN","PSIVHYPL",139,0)
 .I $D(HYPAD(+PSIVAD)) Q
"RTN","PSIVHYPL",140,0)
 .S YY=$G(^PS(55,DFN,"IV",+ON,"AD",+PSIVAD,0))
"RTN","PSIVHYPL",141,0)
 .S HYPAD(+PSIVAD)=""
"RTN","PSIVHYPL",142,0)
 .I +$P(YY,U,3),(+$P(YY,U,3)'=P(16)) Q
"RTN","PSIVHYPL",143,0)
 .D UP2^PSIVBCID(DFN,PSJBLN,PSIV,YY)
"RTN","PSIVHYPL",144,0)
 I I'=50.4 S YY=$G(^PS(55,DFN,"IV",+ON,"AD",+PSIV,0)) D UP2^PSIVBCID(DFN,PSJBLN,PSIV,YY)
"RTN","PSIVHYPL",145,0)
 Q
"RTN","PSIVHYPL",146,0)
BARCODE D PSET^%ZISP
"RTN","PSIVHYPL",147,0)
 I 'PSJIO D
"RTN","PSIVHYPL",148,0)
 . I IOBARON]"" W @IOBARON
"RTN","PSIVHYPL",149,0)
 . W PSJBCID
"RTN","PSIVHYPL",150,0)
 . I IOBAROFF]"" W @IOBAROFF
"RTN","PSIVHYPL",151,0)
 . W !
"RTN","PSIVHYPL",152,0)
 I PSJIO D
"RTN","PSIVHYPL",153,0)
 . F I="SB","SBF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPL",154,0)
 . W PSJBCID
"RTN","PSIVHYPL",155,0)
 . F I="EBF","EB" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPL",156,0)
 Q
"RTN","PSIVHYPR")
0^11^B46405814^B39800593
"RTN","PSIVHYPR",1,0)
PSIVHYPR ;BIR/PR-REPRINT LABELS ;26 FEB 97 / 3:20 PM
"RTN","PSIVHYPR",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**58,88,96,178,184,279**;16 DEC 97;Build 150
"RTN","PSIVHYPR",3,0)
 ;
"RTN","PSIVHYPR",4,0)
 ; Reference to ^%ZIS(2 is supported by DBIA 3435.
"RTN","PSIVHYPR",5,0)
 ; Reference to ^PS(50.4 is supported by DBIA 2175.
"RTN","PSIVHYPR",6,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSIVHYPR",7,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVHYPR",8,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVHYPR",9,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSIVHYPR",10,0)
 ;
"RTN","PSIVHYPR",11,0)
 ;NEEDS DFN, ON AND PSIVNOL (Total number of labels to print) and
"RTN","PSIVHYPR",12,0)
 ;PSIVCT - $D(PSIVCT) NO COUNT LABEL
"RTN","PSIVHYPR",13,0)
SSWARD ;Get patient SS# and ward location
"RTN","PSIVHYPR",14,0)
 N X0,PSJIO,I,PSIVCLAB
"RTN","PSIVHYPR",15,0)
 S I=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=^(I,0),PSJIO($P(X0,"^"))=^(1)
"RTN","PSIVHYPR",16,0)
 S PSJIO=$S('$D(PSJIO):0,1:1)
"RTN","PSIVHYPR",17,0)
 N PSIVCLIN S PSIVCLIN=+$G(^PS(55,DFN,"IV",+ON,"DSS")) I PSIVCLIN S $P(PSIVCLIN,"^",2)=$P($G(^SC(+PSIVCLIN,0)),"^")
"RTN","PSIVHYPR",18,0)
 I $G(PSIVCLIN) S PSIVCLAB=$P($G(^SC(+PSIVCLIN,0)),"^",2)
"RTN","PSIVHYPR",19,0)
 D ENIV^PSJAC S VADM(2)=$E(VADM(2),6,9),PSIVWD=$S(+VAIN(4):$P(VAIN(4),U,2),$G(PSIVCLIN)&($G(PSIVCLAB)]""):PSIVCLAB,$G(PSIVCLIN)&($P($G(PSIVCLIN),"^",2)]""):$P(PSIVCLIN,"^",2),1:"Opt. IV")
"RTN","PSIVHYPR",20,0)
 I PSIVWD="",$P($G(^PS(55,DFN,"IV",+ON,0)),"^",22) S PSIVWD=$P($G(^DIC(42,+$P($G(^PS(55,DFN,"IV",+ON,0)),"^",22),0)),"^")
"RTN","PSIVHYPR",21,0)
 ;;NEW PSIVNOL,PSIV1 S (PSIVNOL,PSIV1)=1
"RTN","PSIVHYPR",22,0)
 NEW PSIV1 S PSIV1=1
"RTN","PSIVHYPR",23,0)
 G:PSIVNOL<1 Q D SETP,PSIVHYP S PSIVRM=$P(PSIVSITE,U,13),P16=$P($G(^PS(55,DFN,"IV",+ON,9)),U,3) S:PSIVRM<1 PSIVRM=30 I $D(PSIVCT),PSIVCT'=1 K PSIVCT
"RTN","PSIVHYPR",24,0)
 I PSJIO,$G(PSJIO("FI"))]"" X PSJIO("FI")
"RTN","PSIVHYPR",25,0)
 ;PSJRPHD is defined in REPRT^PSIVLBRP
"RTN","PSIVHYPR",26,0)
 I $P(PSIVSITE,U,7),'$D(PSJRPHD) D
"RTN","PSIVHYPR",27,0)
 . S PSIVFLAG=1,(LINE,PSIV1)=0,PSIV2=PSIVNOL,PSIVNOL=0 D RE
"RTN","PSIVHYPR",28,0)
 . S PSIVRP="",PSIVRT=""
"RTN","PSIVHYPR",29,0)
 . I $D(^PS(55,DFN,"IV",+ON,.2)) S PSIVRP=$P(^PS(55,DFN,"IV",+ON,.2),U,3) D
"RTN","PSIVHYPR",30,0)
 .. I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) Q   ;QUIT IF "DOSE DUE AT" IS SET TO NOT PRINT
"RTN","PSIVHYPR",31,0)
 .. S PSIVRT=$P(^PS(51.2,PSIVRP,0),U,1)
"RTN","PSIVHYPR",32,0)
 .. S X="ROUTE: "_PSIVRT D:X]"" PMR
"RTN","PSIVHYPR",33,0)
 . S X="Solution: _______________" D PRNTL S X="Additive: _______________" D PRNTL
"RTN","PSIVHYPR",34,0)
 . S PSIVNOL=PSIV2
"RTN","PSIVHYPR",35,0)
 . I 'PSJIO F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVHYPR",36,0)
 . I PSJIO F I="EL","FE" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",37,0)
 I '$D(PSIVCT) D NOW^%DTC S Y=%,$P(^PS(55,DFN,"IV",+ON,9),U,1,2)=Y_"^"_PSIVNOL,$P(^(9),U,3)=$P(^(9),U,3)+1
"RTN","PSIVHYPR",38,0)
 K PSIVFLAG,PSIVSH
"RTN","PSIVHYPR",39,0)
START S PSIV1=1,LINE=0 D RE D
"RTN","PSIVHYPR",40,0)
 . Q:$D(PSIVFLAG) 
"RTN","PSIVHYPR",41,0)
 . I 'PSJIO F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVHYPR",42,0)
 . I PSJIO,$G(PSJIO("EL"))]"" X PSJIO("EL")
"RTN","PSIVHYPR",43,0)
 I PSJIO,$G(PSJIO("FE"))]"" X PSJIO("FE")
"RTN","PSIVHYPR",44,0)
 ;;D:'$D(PSIVCT) ^PSIVSTAT
"RTN","PSIVHYPR",45,0)
 I '$D(PSIVCT) D ^PSIVSTAT S P(16)=P(16)+PSIVNOL
"RTN","PSIVHYPR",46,0)
Q K HYPL,LINE,MESS,P16,PDATE,PDOSE,PSIV,PSIVA,PSIV1,PSIV2,PSIVCT,PSIVDOSE,PSIVFLAG,PSIVRM,PSIVWD,TVOL,PSIMESS Q
"RTN","PSIVHYPR",47,0)
RE ;I PSIV1 S:P(15)>2880!('P(15)) P(15)=2880 S P(16)=P16+PSIV1#(1440/P(15)+.5\1) S:'P(16) P(16)=1440/P(15)+.5\1
"RTN","PSIVHYPR",48,0)
 I PSJIO,$G(PSJIO("SL"))]"" X PSJIO("SL")
"RTN","PSIVHYPR",49,0)
 I PSIV1 D BARCODE
"RTN","PSIVHYPR",50,0)
 S X="["_$P(^PS(55,DFN,"IV",+ON,0),U)_"]"_" "_VADM(2)_"  "_PSIVWD_"  "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3)
"RTN","PSIVHYPR",51,0)
 D
"RTN","PSIVHYPR",52,0)
 .N PSJICW,TMPX,TMPX1,TMPX2 S TMPX=X,TMPX1="" I $L(TMPX)>(PSIVRM-1) F PSJICW=1:1:$L(TMPX," ") S TMPX1=TMPX1_$S(PSJICW=1:"",1:" ")_$P(TMPX," ",PSJICW) I $L(TMPX1)+$L($P(TMPX," ",PSJICW+1))>(PSIVRM-1) S X=TMPX1 D PRNTL S TMPX1="",X=""
"RTN","PSIVHYPR",53,0)
 .I TMPX1]"" S X=TMPX1
"RTN","PSIVHYPR",54,0)
 .D PRNTL
"RTN","PSIVHYPR",55,0)
 S X=VADM(1) S:$P(PSIVSITE,U,9) X=X_"  "_$S(VAIN(5)]"":VAIN(5),1:"NF") D PRNTL S X=" " D PRNTL
"RTN","PSIVHYPR",56,0)
 D:$P(PSIVSITE,U,12) TVOL
"RTN","PSIVHYPR",57,0)
 S X="",$P(X,"=",PSIVRM-1)="" D PRNTL
"RTN","PSIVHYPR",58,0)
 I $D(PSIVFLAG) F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"AD",PSIV)) Q:'PSIV  S Y=^(PSIV,0),X=$S($D(^PS(52.6,+Y,0)):$P(^(0),U),1:"*********")_" "_$P(Y,U,2)_" " S:$P(Y,U,3)]"" X=X_" ("_$P(Y,U,3)_")" D
"RTN","PSIVHYPR",59,0)
 . D PRNTL,MESS
"RTN","PSIVHYPR",60,0)
 I $D(PSIVFLAG) F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"SOL",PSIV)) Q:'PSIV  S PSIV=PSIV_"^"_+^(PSIV,0),YY=^(0) D
"RTN","PSIVHYPR",61,0)
 . D SOL1,PRNTL
"RTN","PSIVHYPR",62,0)
 . S X=$P(^PS(52.7,$P(PSIV,U,2),0),U,4) I X]"" S X="   "_X D PRNTL
"RTN","PSIVHYPR",63,0)
 G:$D(PSIVFLAG) SOL
"RTN","PSIVHYPR",64,0)
 F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IVBCMA",PSJIDNO,"SOL",PSIV)) Q:'PSIV  S PSIV=PSIV_"^"_+^(PSIV,0),YY=^(0) D
"RTN","PSIVHYPR",65,0)
 . D SOL1,PRNTL
"RTN","PSIVHYPR",66,0)
 . S X=$P(^PS(52.7,$P(PSIV,U,2),0),U,4) I X]"" S X="   "_X D PRNTL
"RTN","PSIVHYPR",67,0)
 F I=0:0 S I=$O(HYPL(I)) Q:'I  S PSIV="" F I=I:0 S PSIV=$O(HYPL(I,PSIV)) Q:PSIV=""  D
"RTN","PSIVHYPR",68,0)
 . F Z="" S Z=$O(HYPL(I,PSIV,Z)) Q:Z=""  S PSIVA=$S(I=50.4:PSIV,I=52.7:+^PS(55,DFN,"IVBCMA",PSJIDNO,"SOL",+$P(HYPL(I,PSIV,Z),U,2),0),1:+^PS(55,DFN,"IVBCMA",PSJIDNO,"AD",+$P(HYPL(I,PSIV,Z),U,2),0)) D HYP
"RTN","PSIVHYPR",69,0)
SOL S X="",$P(X,"=",PSIVRM-1)="" D PRNTL
"RTN","PSIVHYPR",70,0)
 S X=" " D PRNTL I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) G MEDRT
"RTN","PSIVHYPR",71,0)
 S:'$D(PSIVDOSE) PSIVDOSE="" S X=$P(PSIVDOSE," ",PSIV1) D:$E(X)="." CONVER^PSIVLABL S X="Dose due at: "_$S(X="":"________",1:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)_" "_$E(X#1_"000",2,5)) D PRNTL
"RTN","PSIVHYPR",72,0)
 ;
"RTN","PSIVHYPR",73,0)
MEDRT ;Find Medication Route   
"RTN","PSIVHYPR",74,0)
 S PSIVRP="",PSIVRT=""
"RTN","PSIVHYPR",75,0)
 I $D(^PS(55,DFN,"IV",+ON,.2)) S PSIVRP=$P(^PS(55,DFN,"IV",+ON,.2),U,3) D
"RTN","PSIVHYPR",76,0)
 .S PSIVRT=$P(^PS(51.2,PSIVRP,0),U,1)
"RTN","PSIVHYPR",77,0)
 .S X="ROUTE: "_PSIVRT D:X]"" PMR
"RTN","PSIVHYPR",78,0)
 ;
"RTN","PSIVHYPR",79,0)
INF S X=$P(P(8),"@") D:X]"" PRNTL
"RTN","PSIVHYPR",80,0)
 I $D(^PS(55,DFN,"IV",+ON,3)) S X=$P(^(3),U) D:X]"" PRNTL
"RTN","PSIVHYPR",81,0)
 S X=P(9) D:X]"" PRNTL
"RTN","PSIVHYPR",82,0)
 S X=P(11) D:X]"" PRNTL
"RTN","PSIVHYPR",83,0)
 ;PSJ*5*184 - Display all messages if more than one additive has a message.
"RTN","PSIVHYPR",84,0)
 I $D(MESS) S PSIMESS="" F  S PSIMESS=$O(MESS(PSIMESS)) Q:PSIMESS=""  S X=PSIMESS D PRNTL
"RTN","PSIVHYPR",85,0)
 I $D(^PS(59.5,PSIVSN,4)) S Y=^(4) F PSIV=1:1 S X=$P(Y,U,PSIV) Q:X=""  D PRNTL
"RTN","PSIVHYPR",86,0)
 S X=$S('+$G(PSIV1):"0[0]",1:PSIVBAG) D PRNTL
"RTN","PSIVHYPR",87,0)
 Q
"RTN","PSIVHYPR",88,0)
PRNTL N I F LINE=LINE+1:1 D  Q:$L(X)<1
"RTN","PSIVHYPR",89,0)
 . I LINE>PSIVSITE D
"RTN","PSIVHYPR",90,0)
 .. S LINE=1
"RTN","PSIVHYPR",91,0)
 .. I 'PSJIO D  Q
"RTN","PSIVHYPR",92,0)
 ... F ZZ=1:1 Q:ZZ>$P(PSIVSITE,"^",16)  W !
"RTN","PSIVHYPR",93,0)
 .. F I="EL","SL" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",94,0)
 . K ZZ
"RTN","PSIVHYPR",95,0)
 . F I="ST","STF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",96,0)
 . W $E(X,1,PSIVRM)
"RTN","PSIVHYPR",97,0)
 . F I="ETF","ET" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",98,0)
 . I 'PSJIO W !
"RTN","PSIVHYPR",99,0)
 . S X=$E(X,PSIVRM+1,999)
"RTN","PSIVHYPR",100,0)
 Q
"RTN","PSIVHYPR",101,0)
PMR ; Print Med Route on label
"RTN","PSIVHYPR",102,0)
 F LINE=LINE+1:1 D  Q:$L(X)<1
"RTN","PSIVHYPR",103,0)
 . I LINE>PSIVSITE D
"RTN","PSIVHYPR",104,0)
 .. S LINE=1
"RTN","PSIVHYPR",105,0)
 .. I 'PSJIO D  Q
"RTN","PSIVHYPR",106,0)
 ... F ZZ=1:1 Q:ZZ>$P(PSIVSITE,"^",16)  W !
"RTN","PSIVHYPR",107,0)
 .. F I="EL","SL" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",108,0)
 . K ZZ
"RTN","PSIVHYPR",109,0)
 . ;
"RTN","PSIVHYPR",110,0)
 . F I="ST","STF","SM","SMF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",111,0)
 . W $E(X,1,PSIVRM)
"RTN","PSIVHYPR",112,0)
 . F I="ETF","ET","EMF","EM" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",113,0)
 . I 'PSJIO W !
"RTN","PSIVHYPR",114,0)
 . S X=$E(X,PSIVRM+1,999)
"RTN","PSIVHYPR",115,0)
 Q 
"RTN","PSIVHYPR",116,0)
 ;
"RTN","PSIVHYPR",117,0)
TVOL ;
"RTN","PSIVHYPR",118,0)
 S PSIV=TVOL F X=0:0 S X=$O(^PS(55,DFN,"IVBCMA",PSJIDNO,"AD",X)) Q:'X  S X=X_"^"_^(X,0) S:$P(X,U,4)[P(16)!($P(X,U,4)="")!'PSIV1 PSIV=PSIV+$S($P(^PS(52.6,$P(X,U,2),0),U,10):$P(X,U,3)/$P(^(0),U,10),1:0)
"RTN","PSIVHYPR",119,0)
 S X="Total Volume: "_(PSIV+.5\1) D PRNTL
"RTN","PSIVHYPR",120,0)
 Q
"RTN","PSIVHYPR",121,0)
SOL1 S X=$S($D(^PS(52.7,$P(PSIV,U,2),0)):$P(^(0),U)_" "_$P(^PS(55,DFN,"IVBCMA",PSJIDNO,"SOL",+PSIV,0),U,2),1:"**********") Q
"RTN","PSIVHYPR",122,0)
HYP ;
"RTN","PSIVHYPR",123,0)
 I PSIV="*" S X="*** Error in "_$S(I=50.4:"electrolyte",I=52.7:"solution",1:"additive") D PRNTL Q
"RTN","PSIVHYPR",124,0)
 S X=+HYPL(I,PSIV,Z)
"RTN","PSIVHYPR",125,0)
 S X=$S($D(^PS(I,PSIVA,0)):$P(^(0),U),1:"Undefined "_$S(I=50.4:"electrolyte",I=52.7:"solution",1:"additive"))_" "_(X+.005\.01/100)_" "_$P($P(HYPL(I,PSIV,Z),U)," ",2)
"RTN","PSIVHYPR",126,0)
 D PRNTL
"RTN","PSIVHYPR",127,0)
 Q
"RTN","PSIVHYPR",128,0)
SETP S Y=^PS(55,DFN,"IV",+ON,0) F X=1:1:23 S P(X)=$P(Y,U,X)
"RTN","PSIVHYPR",129,0)
 Q
"RTN","PSIVHYPR",130,0)
MESS ;PSJ*5*184 -make MESS a local array so all messages display for all additives.
"RTN","PSIVHYPR",131,0)
 I $P(^PS(52.6,+Y,0),U,9)]"" S MESS($P(^PS(52.6,+Y,0),U,9))=""
"RTN","PSIVHYPR",132,0)
 Q
"RTN","PSIVHYPR",133,0)
BARCODE D PSET^%ZISP
"RTN","PSIVHYPR",134,0)
 I 'PSJIO D
"RTN","PSIVHYPR",135,0)
 . I IOBARON]"" W @IOBARON
"RTN","PSIVHYPR",136,0)
 . W PSJBCID
"RTN","PSIVHYPR",137,0)
 . I IOBAROFF]"" W @IOBAROFF
"RTN","PSIVHYPR",138,0)
 . W !
"RTN","PSIVHYPR",139,0)
 I PSJIO D
"RTN","PSIVHYPR",140,0)
 . F I="SB","SBF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",141,0)
 . W PSJBCID
"RTN","PSIVHYPR",142,0)
 . F I="EBF","EB" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",143,0)
 Q
"RTN","PSIVHYPR",144,0)
PSIVHYP ;
"RTN","PSIVHYPR",145,0)
 K HYPL S TVOL=0 F Z=52.6,52.7 F DRG=0:0 S DRG=$O(^PS(55,DFN,"IVBCMA",PSJIDNO,$S(Z=52.6:"AD",1:"SOL"),DRG)) Q:'DRG  S DRG=DRG_"^"_^(DRG,0) S $P(DRG,"^",4)="ALL" D DRG^PSIVHYP
"RTN","PSIVHYPR",146,0)
 S TVOL=TVOL+.5\1 K EL,DRG,NAD,Z
"RTN","PSIVHYPR",147,0)
 Q
"RTN","PSIVLABL")
0^12^B43882246^B38277482
"RTN","PSIVLABL",1,0)
PSIVLABL ;BIR/PR-PRINT OUT LABELS ; 8/19/09 3:00pm
"RTN","PSIVLABL",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**58,82,104,127,178,184,273,279**;16 DEC 97;Build 150
"RTN","PSIVLABL",3,0)
 ;
"RTN","PSIVLABL",4,0)
 ; Reference to ^%ZIS(2 is supported by DBIA 3435.
"RTN","PSIVLABL",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSIVLABL",6,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVLABL",7,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVLABL",8,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSIVLABL",9,0)
 ;
"RTN","PSIVLABL",10,0)
 ;Needs DFN,ON, and PSIVNOL NOTE: If PSIVCT is defined then we do
"RTN","PSIVLABL",11,0)
 ;not count labels in the STATs file or increment cummulative doses or
"RTN","PSIVLABL",12,0)
 ;the last fill field.
"RTN","PSIVLABL",13,0)
 ;PSIVCT will be defined if reprinting scheduled labels, the suspense
"RTN","PSIVLABL",14,0)
 ;list, or if printing individual labels and they do not count.
"RTN","PSIVLABL",15,0)
 ;
"RTN","PSIVLABL",16,0)
DEM ;Get demographics and see if label is example only
"RTN","PSIVLABL",17,0)
 N X0,PSJIO,I,PSIVCLIN,PSIVCLDT,PSIVCLAB
"RTN","PSIVLABL",18,0)
 S I=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSJIO($P(X0,"^"))=^(1)
"RTN","PSIVLABL",19,0)
 S PSJIO=$S('$D(PSJIO):0,1:1)
"RTN","PSIVLABL",20,0)
 S PSIVCLIN=+$G(^PS(55,DFN,"IV",+ON,"DSS")) S:'(PSIVCLIN>0) PSIVCLIN="" I PSIVCLIN D
"RTN","PSIVLABL",21,0)
 .S PSIVCLDT=$P(PSIVCLIN,"^",2) S $P(PSIVCLIN,"^",2)=$P($G(^SC(+PSIVCLIN,0)),"^")
"RTN","PSIVLABL",22,0)
 I $G(PSIVCLIN) S PSIVCLAB=$P($G(^SC(+PSIVCLIN,0)),"^",2)
"RTN","PSIVLABL",23,0)
 D ENIV^PSJAC,NOW^%DTC S PSIVNOW=$$ENDTC^PSGMI(%),VADM(2)=$E(VADM(2),6,9)
"RTN","PSIVLABL",24,0)
 S PSIVWD=$S((+VAIN(4)&'$G(PSIVCLDT)):$P(VAIN(4),U,2),$G(PSIVCLIN)&($G(PSIVCLAB)]""):PSIVCLAB,$G(PSIVCLIN)&($P($G(PSIVCLIN),"^",2)]""):$P(PSIVCLIN,"^",2),1:"Opt. IV") I $D(PSIVEXAM) G ENX
"RTN","PSIVLABL",25,0)
 ;
"RTN","PSIVLABL",26,0)
 G:PSIVNOL<1 Q D SETP S PSIVRM=$P(PSIVSITE,U,13),P16=$P($G(^PS(55,DFN,"IV",+ON,9)),U,3) S:PSIVRM<1 PSIVRM=30 I $D(PSIVCT),PSIVCT'=1 K PSIVCT
"RTN","PSIVLABL",27,0)
 I PSJIO,$G(PSJIO("FI"))]"" X PSJIO("FI")
"RTN","PSIVLABL",28,0)
 I $P(PSIVSITE,U,7) D
"RTN","PSIVLABL",29,0)
 . S PSIVFLAG=1,(LINE,PSIV1)=0,PSIV2=PSIVNOL,PSIVNOL=0 D RE
"RTN","PSIVLABL",30,0)
 . S PSIVRP="",PSIVRT=""
"RTN","PSIVLABL",31,0)
 . I $D(^PS(55,DFN,"IV",+ON,.2)) S PSIVRP=$P(^PS(55,DFN,"IV",+ON,.2),U,3) D
"RTN","PSIVLABL",32,0)
 .. I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) Q   ;DO NOT PRINT ROUTE IF "DOSE DUE AT" IS SET TO NOT PRINT.
"RTN","PSIVLABL",33,0)
 .. S PSIVRT=$P(^PS(51.2,PSIVRP,0),U,1)
"RTN","PSIVLABL",34,0)
 .. S X="ROUTE: "_PSIVRT D:X]"" PMR
"RTN","PSIVLABL",35,0)
 . S X="Solution: _______________" D P S X="Additive: _______________" D P
"RTN","PSIVLABL",36,0)
 . S PSIVNOL=PSIV2
"RTN","PSIVLABL",37,0)
 . I 'PSJIO F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVLABL",38,0)
 . I PSJIO,$G(PSJIO("EL"))]"" X PSJIO("EL")
"RTN","PSIVLABL",39,0)
 I '$D(PSIVCT) D NOW^%DTC S Y=%,$P(^PS(55,DFN,"IV",+ON,9),U,1,2)=Y_"^"_PSIVNOL,$P(^(9),U,3)=$P(^(9),U,3)+PSIVNOL
"RTN","PSIVLABL",40,0)
 K PSIVFLAG,PSIVSH G START
"RTN","PSIVLABL",41,0)
SETP S Y=^PS(55,DFN,"IV",+ON,0) F X=1:1:23 S P(X)=$P(Y,U,X)
"RTN","PSIVLABL",42,0)
 Q
"RTN","PSIVLABL",43,0)
ENX ;Print example label
"RTN","PSIVLABL",44,0)
 D SETP S PSIVFLAG=1,PSIVRM=$P(PSIVSITE,U,13) S:PSIVRM<1 PSIVRM=30
"RTN","PSIVLABL",45,0)
START F PSIV1=1:1:PSIVNOL D
"RTN","PSIVLABL",46,0)
 . S LINE=0 D RE
"RTN","PSIVLABL",47,0)
 . Q:$D(PSIVFLAG)
"RTN","PSIVLABL",48,0)
 . I 'PSJIO F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVLABL",49,0)
 . I PSJIO,$G(PSJIO("EL"))]"" X PSJIO("EL")
"RTN","PSIVLABL",50,0)
 I PSJIO,$G(PSJIO("FE"))]"" X PSJIO("FE")
"RTN","PSIVLABL",51,0)
 D:'$D(PSIVCT) ^PSIVSTAT
"RTN","PSIVLABL",52,0)
Q K PSIV,PSIVDOSE,PSIVWD,P16,LINE,MESS,PSIVCT,PSIV2,PSIVFLAG,PSIVRM,PSIV1,PDOSE,PDATE,XX1,XX2,BAG,CX,PSIMESS Q
"RTN","PSIVLABL",53,0)
RE ;
"RTN","PSIVLABL",54,0)
 K DO
"RTN","PSIVLABL",55,0)
 ;*273 - Bottle values for chemo admixture IVs
"RTN","PSIVLABL",56,0)
 N PSIVADTYPE I (P(4)="A")!($P($G(^PS(55,DFN,"IV",+ON,0)),U,23)="A") S PSIVADTYPE=1
"RTN","PSIVLABL",57,0)
 I PSIV1,$G(PSIVADTYPE)!(P(5)=0) S P(16)=PSIV1 I $G(PSIVT)]"" D
"RTN","PSIVLABL",58,0)
 . S:P(15)>2880!('P(15)) P(15)=2880 S P(16)=P16+PSIV1#(1440/P(15)+.5\1) S:'P(16) P(16)=PSIV1
"RTN","PSIVLABL",59,0)
 I PSIV1 S PSJBCID=$$BCMA^PSIVBCID(DFN,ON,$D(PSIVCT),$G(PSIV1),$G(PSIV2),$G(PSIVNOL))
"RTN","PSIVLABL",60,0)
 ;* Only if prt from ward or man list then store BCMA ID to set xref for
"RTN","PSIVLABL",61,0)
 ;* reprint later
"RTN","PSIVLABL",62,0)
 I PSIV1,$G(PSIVWMFL) S PSIVID($P(PSJBCID,"V",2))=""
"RTN","PSIVLABL",63,0)
 I PSJIO,$G(PSJIO("SL"))]"" X PSJIO("SL")
"RTN","PSIVLABL",64,0)
 I PSIV1 D BARCODE
"RTN","PSIVLABL",65,0)
 S X="["_$P(^PS(55,DFN,"IV",+ON,0),U)_"]"_" "_VADM(2)_"  "_PSIVWD_"  "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3)
"RTN","PSIVLABL",66,0)
 I ($G(PSIVCLIN)>0),$L($G(PSIVRM)),'$G(VAIN(4)) N PSJTRNC S PSJTRNC=$L(X)-+$G(PSIVRM) I PSJTRNC>0,($L(PSIVWD)>PSJTRNC) D
"RTN","PSIVLABL",67,0)
 . S X="["_$P(^PS(55,DFN,"IV",+ON,0),U)_"]"_" "_VADM(2)_"  "_$E(PSIVWD,1,$L(PSIVWD)-PSJTRNC)_"  "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3)
"RTN","PSIVLABL",68,0)
 D P
"RTN","PSIVLABL",69,0)
 S X=VADM(1) S:$P(PSIVSITE,U,9) X=X_"  "_$S(VAIN(5)]"":VAIN(5),1:"NF") D P S X=" " D P
"RTN","PSIVLABL",70,0)
 I $D(PSIVFLAG) F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"AD",PSIV)) Q:'PSIV  S Y=^(PSIV,0),X=$S($D(^PS(52.6,+Y,0)):$P(^(0),"^"),1:"*********")_" "_$P(Y,U,2)_" " S:$P(Y,U,3)]"" X=X_" ("_$P(Y,U,3)_")" D
"RTN","PSIVLABL",71,0)
 . D P
"RTN","PSIVLABL",72,0)
 . ;I PSIV1 S YY=Y D UP2^PSIVBCID(DFN,PSJBLN,PSIV,YY) S Y=YY
"RTN","PSIVLABL",73,0)
 . D MESS
"RTN","PSIVLABL",74,0)
 G:$D(PSIVFLAG) SOL
"RTN","PSIVLABL",75,0)
 ; IV BOTTLE functionality, 3rd piece of PS(55,DFN,"IV",+ON,"AD",PSIV,0) dictates labels per LABEL RUN on which the additive will print
"RTN","PSIVLABL",76,0)
 F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"AD",PSIV)) Q:'PSIV  S Y=^(PSIV,0),X=$S($D(^PS(52.6,+Y,0)):$P(^(0),U),1:"********")_" "_$P(Y,U,2) I ","_$P(Y,U,3)_","[(","_P(16)_",")!('$P(Y,U,3)) D
"RTN","PSIVLABL",77,0)
 . D P
"RTN","PSIVLABL",78,0)
 . I PSIV1 S YY=Y D UP2^PSIVBCID(DFN,PSJBLN,PSIV,YY) S Y=YY
"RTN","PSIVLABL",79,0)
 . D MESS
"RTN","PSIVLABL",80,0)
 ;
"RTN","PSIVLABL",81,0)
SOL F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"SOL",PSIV)) Q:'PSIV  S PSIV=PSIV_"^"_+^(PSIV,0),YY=^(0) D
"RTN","PSIVLABL",82,0)
 . D SOL1,P I PSIV1 D UP3^PSIVBCID(DFN,PSJBLN,PSIV,YY)
"RTN","PSIVLABL",83,0)
 . S X=$P(^PS(52.7,$P(PSIV,U,2),0),U,4) I X]"" S X="   "_X D P
"RTN","PSIVLABL",84,0)
 I P(23)'=""!(P(4)="S") S X="In Syringe: "_$E($P(^PS(55,DFN,"IV",+ON,2),U,4),1,25) D:P(4)="S"!(P(23)="S") P S X="*CAUTION* - CHEMOTHERAPY" D:P(23)'="" P
"RTN","PSIVLABL",85,0)
 S X=" " D P I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) G MEDRT
"RTN","PSIVLABL",86,0)
 S:'$D(PSIVDOSE) PSIVDOSE="" S X=$P(PSIVDOSE," ",PSIV1) D:$E(X)="." CONVER S X="Dose due at: "_$S(X="":"________",1:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)_" "_$E(X#1_"000",2,5)) D P
"RTN","PSIVLABL",87,0)
 ;
"RTN","PSIVLABL",88,0)
MEDRT ;Find Medication Route   
"RTN","PSIVLABL",89,0)
 S PSIVRP="",PSIVRT=""
"RTN","PSIVLABL",90,0)
 I $D(^PS(55,DFN,"IV",+ON,.2)) S PSIVRP=$P(^PS(55,DFN,"IV",+ON,.2),U,3) D
"RTN","PSIVLABL",91,0)
 .S PSIVRT=$P(^PS(51.2,PSIVRP,0),U,1)
"RTN","PSIVLABL",92,0)
 .S X="ROUTE: "_PSIVRT D:X]"" PMR
"RTN","PSIVLABL",93,0)
 ;
"RTN","PSIVLABL",94,0)
INF S X=$P(P(8),"@") D:X]"" P
"RTN","PSIVLABL",95,0)
 I $D(^PS(55,DFN,"IV",+ON,3)) S X=$P(^(3),"^") D:X]"" P
"RTN","PSIVLABL",96,0)
 S X=P(9) D:X]"" P
"RTN","PSIVLABL",97,0)
 S X=P(11) D:X]"" P
"RTN","PSIVLABL",98,0)
 ;PSJ*5*184 - Display all messages if more than one additive has a message.
"RTN","PSIVLABL",99,0)
 I $D(MESS) S PSIMESS="" F  S PSIMESS=$O(MESS(PSIMESS)) Q:PSIMESS=""  S X=PSIMESS D P
"RTN","PSIVLABL",100,0)
 I $D(^PS(59.5,PSIVSN,4)) S Y=^(4) F PSIV=1:1 S X=$P(Y,U,PSIV) Q:X=""  D P
"RTN","PSIVLABL",101,0)
 S X=PSIV1_"["_$S(PSIV1:PSIVNOL,1:PSIV2)_"]"_"  "_$S('PSIV1:PSIVNOW,1:"") D P
"RTN","PSIVLABL",102,0)
 Q
"RTN","PSIVLABL",103,0)
 ;
"RTN","PSIVLABL",104,0)
P F LINE=LINE+1:1 D  Q:$L(X)<1
"RTN","PSIVLABL",105,0)
 . I LINE>PSIVSITE D
"RTN","PSIVLABL",106,0)
 .. S LINE=1
"RTN","PSIVLABL",107,0)
 .. I 'PSJIO D  Q
"RTN","PSIVLABL",108,0)
 ... F ZZ=1:1 Q:ZZ>$P(PSIVSITE,"^",16)  W !
"RTN","PSIVLABL",109,0)
 .. F I="EL","SL" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",110,0)
 . K ZZ
"RTN","PSIVLABL",111,0)
 . F I="ST","STF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",112,0)
 . W $E(X,1,PSIVRM)
"RTN","PSIVLABL",113,0)
 . F I="ETF","ET" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",114,0)
 . I 'PSJIO W !
"RTN","PSIVLABL",115,0)
 . S X=$E(X,PSIVRM+1,999)
"RTN","PSIVLABL",116,0)
 Q
"RTN","PSIVLABL",117,0)
PMR ; Print Med Route on label
"RTN","PSIVLABL",118,0)
 ;  
"RTN","PSIVLABL",119,0)
 F LINE=LINE+1:1 D  Q:$L(X)<1
"RTN","PSIVLABL",120,0)
 . I LINE>PSIVSITE D
"RTN","PSIVLABL",121,0)
 .. S LINE=1
"RTN","PSIVLABL",122,0)
 .. I 'PSJIO D  Q
"RTN","PSIVLABL",123,0)
 ... F ZZ=1:1 Q:ZZ>$P(PSIVSITE,"^",16)  W !
"RTN","PSIVLABL",124,0)
 .. F I="EL","SL" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",125,0)
 . K ZZ
"RTN","PSIVLABL",126,0)
 . ;
"RTN","PSIVLABL",127,0)
 . F I="ST","STF","SM","SMF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",128,0)
 . W $E(X,1,PSIVRM)
"RTN","PSIVLABL",129,0)
 . F I="ETF","ET","EMF","EM" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",130,0)
 . I 'PSJIO W !
"RTN","PSIVLABL",131,0)
 . S X=$E(X,PSIVRM+1,999)
"RTN","PSIVLABL",132,0)
 Q
"RTN","PSIVLABL",133,0)
 ;               
"RTN","PSIVLABL",134,0)
SOL1 S X=$S($D(^PS(52.7,$P(PSIV,U,2),0)):$P(^(0),"^")_" "_$P(^PS(55,DFN,"IV",+ON,"SOL",+PSIV,0),U,2),1:"**********") Q
"RTN","PSIVLABL",135,0)
MESS ;PSJ*5*184 -make MESS a local array so all messages display for all additives.
"RTN","PSIVLABL",136,0)
 I $P(^PS(52.6,+Y,0),U,9)]"" S MESS($P(^PS(52.6,+Y,0),U,9))=""
"RTN","PSIVLABL",137,0)
 Q
"RTN","PSIVLABL",138,0)
CONVER ;Expand dose to date.dose and set in X
"RTN","PSIVLABL",139,0)
 I P(15)>1440 S X=$$CONVER1^PSIVORE2($P(PSIVDOSE," "),P(15),(PSIV1-1)) Q
"RTN","PSIVLABL",140,0)
 S PDOSE=X S:PSIV1=2 PDATE=$E($P(PSIVDOSE," "),1,7)
"RTN","PSIVLABL",141,0)
 I $P(PSIVDOSE," ",PSIV1-1)#1'<PDOSE!(P(15)>1440) S:$D(X1) XX1=X1 S:$D(X2) XX2=X2 S X1=PDATE,X2=1 D C^%DTC S PDATE=X,X=X_PDOSE S:$D(XX1) X1=XX1 S:$D(XX2) X2=XX2 Q
"RTN","PSIVLABL",142,0)
 S X=PDATE_PDOSE
"RTN","PSIVLABL",143,0)
 Q
"RTN","PSIVLABL",144,0)
BARCODE D PSET^%ZISP
"RTN","PSIVLABL",145,0)
 I 'PSJIO D
"RTN","PSIVLABL",146,0)
 . I IOBARON]"" W @IOBARON
"RTN","PSIVLABL",147,0)
 . W PSJBCID
"RTN","PSIVLABL",148,0)
 . I IOBAROFF]"" W @IOBAROFF
"RTN","PSIVLABL",149,0)
 . W !
"RTN","PSIVLABL",150,0)
 I PSJIO D
"RTN","PSIVLABL",151,0)
 . F I="SB","SBF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",152,0)
 . W PSJBCID
"RTN","PSIVLABL",153,0)
 . F I="EBF","EB" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",154,0)
 Q
"RTN","PSIVLABR")
0^13^B39932964^B34113753
"RTN","PSIVLABR",1,0)
PSIVLABR ;BIR/PR-REPRINT LABELS ;30 May 2001  12:36 PM
"RTN","PSIVLABR",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**58,82,178,184,279**;16 DEC 97;Build 150
"RTN","PSIVLABR",3,0)
 ;
"RTN","PSIVLABR",4,0)
 ; Reference to ^%ZIS(2 is supported by DBIA 3435.
"RTN","PSIVLABR",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSIVLABR",6,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVLABR",7,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVLABR",8,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178. 
"RTN","PSIVLABR",9,0)
 ;
"RTN","PSIVLABR",10,0)
 ;Needs DFN,ON, and PSIVNOL NOTE: If PSIVCT is defined then we do
"RTN","PSIVLABR",11,0)
 ;not count labels in the STATs file or increment cummulative doses or
"RTN","PSIVLABR",12,0)
 ;the last fill field.
"RTN","PSIVLABR",13,0)
 ;PSIVCT will be defined if reprinting scheduled labels, the suspense
"RTN","PSIVLABR",14,0)
 ;list, or if printing individual labels and they do not count.
"RTN","PSIVLABR",15,0)
 ;
"RTN","PSIVLABR",16,0)
DEM ;Get demographics and see if label is example only
"RTN","PSIVLABR",17,0)
 N X0,PSJIO,I,PSIVCLAB
"RTN","PSIVLABR",18,0)
 S I=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSJIO($P(X0,"^"))=^(1)
"RTN","PSIVLABR",19,0)
 S PSJIO=$S('$D(PSJIO):0,1:1)
"RTN","PSIVLABR",20,0)
 N PSIVCLIN,PSIVCLDT S PSIVCLIN=+$G(^PS(55,DFN,"IV",+ON,"DSS")) S:'(PSIVCLIN>0) PSIVCLIN="" I PSIVCLIN D
"RTN","PSIVLABR",21,0)
 .S PSIVCLDT=$P(PSIVCLIN,"^",2) S $P(PSIVCLIN,"^",2)=$P($G(^SC(+PSIVCLIN,0)),"^")
"RTN","PSIVLABR",22,0)
 I $G(PSIVCLIN) S PSIVCLAB=$P($G(^SC(+PSIVCLIN,0)),"^",2)
"RTN","PSIVLABR",23,0)
 D ENIV^PSJAC,NOW^%DTC S PSIVNOW=$$ENDTC^PSGMI(%),VADM(2)=$E(VADM(2),6,9)
"RTN","PSIVLABR",24,0)
 S PSIVWD=$S(+VAIN(4):$P(VAIN(4),U,2),$G(PSIVCLIN)&($G(PSIVCLAB)]""):PSIVCLAB,$G(PSIVCLIN)&($P($G(PSIVCLIN),"^",2)]""):$P(PSIVCLIN,"^",2),1:"Opt. IV") I $D(PSIVEXAM) G ENX
"RTN","PSIVLABR",25,0)
 ;
"RTN","PSIVLABR",26,0)
 ;;NEW PSIVNOL,PSIV1 S (PSIVNOL,PSIV1)=1
"RTN","PSIVLABR",27,0)
 NEW PSIV1 S PSIV1=1
"RTN","PSIVLABR",28,0)
 G:PSIVNOL<1 Q D SETP S PSIVRM=$P(PSIVSITE,U,13),P16=$P($G(^PS(55,DFN,"IV",+ON,9)),U,3) S:PSIVRM<1 PSIVRM=30 I $D(PSIVCT),PSIVCT'=1 K PSIVCT
"RTN","PSIVLABR",29,0)
 I PSJIO,$G(PSJIO("FI"))]"" X PSJIO("FI")
"RTN","PSIVLABR",30,0)
 ;PSJRPHD is defined in REPRT^PSIVLBRP so header only print once.
"RTN","PSIVLABR",31,0)
 I $P(PSIVSITE,U,7),'$D(PSJRPHD) D
"RTN","PSIVLABR",32,0)
 . S PSIVFLAG=1,(LINE,PSIV1)=0,PSIV2=PSIVNOL,PSIVNOL=0 D RE
"RTN","PSIVLABR",33,0)
 . S PSIVRP="",PSIVRT=""
"RTN","PSIVLABR",34,0)
 . I $D(^PS(55,DFN,"IV",+ON,.2)) S PSIVRP=$P(^PS(55,DFN,"IV",+ON,.2),U,3) D
"RTN","PSIVLABR",35,0)
 .. I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) Q   ;QUIT IF "DOSE DUE AT" IS SET TO NOT PRINT
"RTN","PSIVLABR",36,0)
 .. S PSIVRT=$P(^PS(51.2,PSIVRP,0),U,1)
"RTN","PSIVLABR",37,0)
 .. S X="ROUTE: "_PSIVRT D:X]"" PMR
"RTN","PSIVLABR",38,0)
 . S X="Solution: _______________" D P S X="Additive: _______________" D P
"RTN","PSIVLABR",39,0)
 . S PSIVNOL=PSIV2
"RTN","PSIVLABR",40,0)
 . I 'PSJIO F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVLABR",41,0)
 . I PSJIO,$G(PSJIO("EL"))]"" X PSJIO("EL")
"RTN","PSIVLABR",42,0)
 ;;I '$D(PSIVCT) D NOW^%DTC S Y=%,$P(^PS(55,DFN,"IV",+ON,9),U,1,2)=Y_"^"_PSIVNOL,$P(^(9),U,3)=$P(^(9),U,3)+PSIVNOL
"RTN","PSIVLABR",43,0)
 I '$D(PSIVCT) D NOW^%DTC S Y=%,$P(^PS(55,DFN,"IV",+ON,9),U,1,2)=Y_"^"_PSIVNOL,$P(^(9),U,3)=$P(^(9),U,3)+1
"RTN","PSIVLABR",44,0)
 K PSIVFLAG,PSIVSH G START
"RTN","PSIVLABR",45,0)
SETP S Y=^PS(55,DFN,"IV",+ON,0) F X=1:1:23 S P(X)=$P(Y,U,X)
"RTN","PSIVLABR",46,0)
 Q
"RTN","PSIVLABR",47,0)
ENX ;Print example label
"RTN","PSIVLABR",48,0)
 D SETP S PSIVFLAG=1,PSIVRM=$P(PSIVSITE,U,13) S:PSIVRM<1 PSIVRM=30
"RTN","PSIVLABR",49,0)
START S PSIV1=1,LINE=0 D RE D
"RTN","PSIVLABR",50,0)
 . Q:$D(PSIVFLAG) 
"RTN","PSIVLABR",51,0)
 . I 'PSJIO F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVLABR",52,0)
 . I PSJIO,$G(PSJIO("EL"))]"" X PSJIO("EL")
"RTN","PSIVLABR",53,0)
 I PSJIO,$G(PSJIO("FE"))]"" X PSJIO("FE")
"RTN","PSIVLABR",54,0)
 D:'$D(PSIVCT) ^PSIVSTAT
"RTN","PSIVLABR",55,0)
Q K PSIV,PSIVDOSE,PSIVCT,PSIVWD,P16,LINE,MESS,PSIV2,PSIVFLAG,PSIVRM,PSIV1,PDOSE,PDATE,XX1,XX2,BAG,CX,PSIMESS Q
"RTN","PSIVLABR",56,0)
RE ;
"RTN","PSIVLABR",57,0)
 ;NEED THE CODE BELOW?
"RTN","PSIVLABR",58,0)
 ;;I PSIV1,P(4)="A"!(P(5)=0) S:P(15)>2880!('P(15)) P(15)=2880 S P(16)=P16+PSIV1#(1440/P(15)+.5\1) S:'P(16) P(16)=PSIV1
"RTN","PSIVLABR",59,0)
 I PSJIO,$G(PSJIO("SL"))]"" X PSJIO("SL")
"RTN","PSIVLABR",60,0)
 I PSIV1 D BARCODE
"RTN","PSIVLABR",61,0)
 S X="["_$P(^PS(55,DFN,"IV",+ON,0),U)_"]"_" "_VADM(2)_"  "_PSIVWD_"  "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3)
"RTN","PSIVLABR",62,0)
 I ($G(PSIVCLIN)>0),$L($G(PSIVRM)),'$G(VAIN(4)) N PSJTRNC S PSJTRNC=$L(X)-+$G(PSIVRM) I PSJTRNC>0,($L(PSIVWD)>PSJTRNC) D
"RTN","PSIVLABR",63,0)
 . S X="["_$P(^PS(55,DFN,"IV",+ON,0),U)_"]"_" "_VADM(2)_"  "_$E(PSIVWD,1,$L(PSIVWD)-PSJTRNC)_"  "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3)
"RTN","PSIVLABR",64,0)
 D P
"RTN","PSIVLABR",65,0)
 ;D
"RTN","PSIVLABR",66,0)
 ;.N PSJICW,TMPX,TMPX1,TMPX2 S TMPX=X,TMPX1="" I $L(TMPX)>(PSIVRM-1) F PSJICW=1:1:$L(TMPX," ") S TMPX1=TMPX1_$S(PSJICW=1:"",1:" ")_$P(TMPX," ",PSJICW) I $L(TMPX1)+$L($P(TMPX," ",PSJICW+1))>(PSIVRM-1) S X=TMPX1 D P S TMPX1="",X=""
"RTN","PSIVLABR",67,0)
 ;.I TMPX1]"" S X=TMPX1 D P
"RTN","PSIVLABR",68,0)
 S X=VADM(1) S:$P(PSIVSITE,U,9) X=X_"  "_$S(VAIN(5)]"":VAIN(5),1:"NF") D P S X=" " D P
"RTN","PSIVLABR",69,0)
 I $D(PSIVFLAG) F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"AD",PSIV)) Q:'PSIV  S Y=^(PSIV,0),X=$S($D(^PS(52.6,+Y,0)):$P(^(0),"^"),1:"*********")_" "_$P(Y,U,2)_" " S:$P(Y,U,3)]"" X=X_" ("_$P(Y,U,3)_")" D
"RTN","PSIVLABR",70,0)
 . D P,MESS
"RTN","PSIVLABR",71,0)
 G:$D(PSIVFLAG) SOL
"RTN","PSIVLABR",72,0)
 F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IVBCMA",PSJIDNO,"AD",PSIV)) Q:'PSIV  S Y=^(PSIV,0),X=$S($D(^PS(52.6,+Y,0)):$P(^(0),U),1:"********")_" "_$P(Y,U,2) D
"RTN","PSIVLABR",73,0)
 . D P,MESS
"RTN","PSIVLABR",74,0)
SOL F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IVBCMA",PSJIDNO,"SOL",PSIV)) Q:'PSIV  S PSIV=PSIV_"^"_+^(PSIV,0),YY=^(0) D
"RTN","PSIVLABR",75,0)
 . D SOL1,P
"RTN","PSIVLABR",76,0)
 . S X=$P(^PS(52.7,$P(PSIV,U,2),0),U,4) I X]"" S X="   "_X D P
"RTN","PSIVLABR",77,0)
 I P(23)'=""!(P(4)="S") S X="In Syringe: "_$E($P(^PS(55,DFN,"IV",+ON,2),U,4),1,25) D:P(4)="S"!(P(23)="S") P S X="*CAUTION* - CHEMOTHERAPY" D:P(23)'="" P
"RTN","PSIVLABR",78,0)
 S X=" " D P I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) G MEDRT
"RTN","PSIVLABR",79,0)
 S:'$D(PSIVDOSE) PSIVDOSE="" S X=$P(PSIVDOSE," ",PSIV1) D:$E(X)="." CONVER S X="Dose due at: "_$S(X="":"________",1:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)_" "_$E(X#1_"000",2,5)) D P
"RTN","PSIVLABR",80,0)
 ;
"RTN","PSIVLABR",81,0)
MEDRT ;Find Medication Route   
"RTN","PSIVLABR",82,0)
 S PSIVRP="",PSIVRT=""
"RTN","PSIVLABR",83,0)
 I $D(^PS(55,DFN,"IV",+ON,.2)) S PSIVRP=$P(^PS(55,DFN,"IV",+ON,.2),U,3) D
"RTN","PSIVLABR",84,0)
 .S PSIVRT=$P(^PS(51.2,PSIVRP,0),U,1)
"RTN","PSIVLABR",85,0)
 .S X="ROUTE: "_PSIVRT D:X]"" PMR
"RTN","PSIVLABR",86,0)
 ;
"RTN","PSIVLABR",87,0)
INF S X=$P(P(8),"@") D:X]"" P
"RTN","PSIVLABR",88,0)
 I $D(^PS(55,DFN,"IV",+ON,3)) S X=$P(^(3),"^") D:X]"" P
"RTN","PSIVLABR",89,0)
 S X=P(9) D:X]"" P
"RTN","PSIVLABR",90,0)
 S X=P(11) D:X]"" P
"RTN","PSIVLABR",91,0)
 ;PSJ*5*184 - Display all messages if more than one additive has a message.
"RTN","PSIVLABR",92,0)
 I $D(MESS) S PSIMESS="" F  S PSIMESS=$O(MESS(PSIMESS)) Q:PSIMESS=""  S X=PSIMESS D P
"RTN","PSIVLABR",93,0)
 I $D(^PS(59.5,PSIVSN,4)) S Y=^(4) F PSIV=1:1 S X=$P(Y,U,PSIV) Q:X=""  D P
"RTN","PSIVLABR",94,0)
 ;S X=PSIV1_"["_$S(PSIV1:PSIVNOL,1:PSIV2)_"]"_"  "_$S('PSIV1:PSIVNOW,1:"") D P
"RTN","PSIVLABR",95,0)
 S X=PSIVBAG D P
"RTN","PSIVLABR",96,0)
 Q
"RTN","PSIVLABR",97,0)
P F LINE=LINE+1:1 D  Q:$L(X)<1
"RTN","PSIVLABR",98,0)
 . I LINE>PSIVSITE D
"RTN","PSIVLABR",99,0)
 .. S LINE=1
"RTN","PSIVLABR",100,0)
 .. I 'PSJIO D  Q
"RTN","PSIVLABR",101,0)
 ... F ZZ=1:1 Q:ZZ>$P(PSIVSITE,"^",16)  W !
"RTN","PSIVLABR",102,0)
 .. F I="EL","SL" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABR",103,0)
 . K ZZ
"RTN","PSIVLABR",104,0)
 . F I="ST","STF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABR",105,0)
 . W $E(X,1,PSIVRM)
"RTN","PSIVLABR",106,0)
 . F I="ETF","ET" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABR",107,0)
 . I 'PSJIO W !
"RTN","PSIVLABR",108,0)
 . S X=$E(X,PSIVRM+1,999)
"RTN","PSIVLABR",109,0)
 Q
"RTN","PSIVLABR",110,0)
PMR ; Print Med Route on label
"RTN","PSIVLABR",111,0)
 ;
"RTN","PSIVLABR",112,0)
 F LINE=LINE+1:1 D  Q:$L(X)<1
"RTN","PSIVLABR",113,0)
 . I LINE>PSIVSITE D
"RTN","PSIVLABR",114,0)
 .. S LINE=1
"RTN","PSIVLABR",115,0)
 .. I 'PSJIO D  Q
"RTN","PSIVLABR",116,0)
 ... F ZZ=1:1 Q:ZZ>$P(PSIVSITE,"^",16)  W !
"RTN","PSIVLABR",117,0)
 .. F I="EL","SL" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABR",118,0)
 . K ZZ
"RTN","PSIVLABR",119,0)
 . ;
"RTN","PSIVLABR",120,0)
 . F I="ST","STF","SM","SMF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABR",121,0)
 . W $E(X,1,PSIVRM)
"RTN","PSIVLABR",122,0)
 . F I="ETF","ET","EMF","EM" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABR",123,0)
 . I 'PSJIO W !
"RTN","PSIVLABR",124,0)
 . S X=$E(X,PSIVRM+1,999)
"RTN","PSIVLABR",125,0)
 Q
"RTN","PSIVLABR",126,0)
SOL1 S X=$S($D(^PS(52.7,$P(PSIV,U,2),0)):$P(^(0),"^")_" "_$P(^PS(55,DFN,"IVBCMA",PSJIDNO,"SOL",+PSIV,0),U,2),1:"**********") Q
"RTN","PSIVLABR",127,0)
MESS ;PSJ*5*184 -make MESS a local array so all messages display for all additives.
"RTN","PSIVLABR",128,0)
 I $P(^PS(52.6,+Y,0),U,9)]"" S MESS($P(^PS(52.6,+Y,0),U,9))=""
"RTN","PSIVLABR",129,0)
 Q
"RTN","PSIVLABR",130,0)
CONVER ;Expand dose to date.dose and set in X
"RTN","PSIVLABR",131,0)
 I P(15)>1440 S X=$$CONVER1^PSIVORE2($P(PSIVDOSE," "),P(15),(PSIV1-1)) Q
"RTN","PSIVLABR",132,0)
 S PDOSE=X S:PSIV1=2 PDATE=$E($P(PSIVDOSE," "),1,7)
"RTN","PSIVLABR",133,0)
 I $P(PSIVDOSE," ",PSIV1-1)#1'<PDOSE!(P(15)>1440) S:$D(X1) XX1=X1 S:$D(X2) XX2=X2 S X1=PDATE,X2=1 D C^%DTC S PDATE=X,X=X_PDOSE S:$D(XX1) X1=XX1 S:$D(XX2) X2=XX2 Q
"RTN","PSIVLABR",134,0)
 S X=PDATE_PDOSE
"RTN","PSIVLABR",135,0)
 Q
"RTN","PSIVLABR",136,0)
BARCODE D PSET^%ZISP
"RTN","PSIVLABR",137,0)
 I 'PSJIO D
"RTN","PSIVLABR",138,0)
 . I IOBARON]"" W @IOBARON
"RTN","PSIVLABR",139,0)
 . W PSJBCID
"RTN","PSIVLABR",140,0)
 . I IOBAROFF]"" W @IOBAROFF
"RTN","PSIVLABR",141,0)
 . W !
"RTN","PSIVLABR",142,0)
 I PSJIO D
"RTN","PSIVLABR",143,0)
 . F I="SB","SBF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABR",144,0)
 . W PSJBCID
"RTN","PSIVLABR",145,0)
 . F I="EBF","EB" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABR",146,0)
 Q
"RTN","PSIVLB")
0^14^B7955740^B7797321
"RTN","PSIVLB",1,0)
PSIVLB ;BIR/MV - DISPLAY PRINTED LABELS FOR AN ORDER ;30 Aug 2001  4:21 PM
"RTN","PSIVLB",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**58,81,279**;16 DEC 97;Build 150
"RTN","PSIVLB",3,0)
 ;
"RTN","PSIVLB",4,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSIVLB",5,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVLB",6,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVLB",7,0)
 ;
"RTN","PSIVLB",8,0)
EN(DFN,ON,PSJALB,MORE) ;
"RTN","PSIVLB",9,0)
 ;DFN   : Patient IEN
"RTN","PSIVLB",10,0)
 ;ON    : IV ien#_"V" 
"RTN","PSIVLB",11,0)
 ;PSJALB: 0 = including all labels 
"RTN","PSIVLB",12,0)
 ;        1 = Consider active if: 
"RTN","PSIVLB",13,0)
 ;            NOT Reprinted/Recycled/Cancelled/Destroyed
"RTN","PSIVLB",14,0)
 ;            NOT Given/Completed in BCMA
"RTN","PSIVLB",15,0)
 ;        2 = All condition in 1 but include Reprinted as active
"RTN","PSIVLB",16,0)
 ;            (use for return/destroy)
"RTN","PSIVLB",17,0)
 ;MORE  : 1 = Display extra info for the label
"RTN","PSIVLB",18,0)
 ;
"RTN","PSIVLB",19,0)
 ;This entry point is being from Protocal: PSJ PC IV LABELS ACTION
"RTN","PSIVLB",20,0)
 ;
"RTN","PSIVLB",21,0)
 ;* Quit if only display active labels and order is not active
"RTN","PSIVLB",22,0)
 ;I PSJALB,$S(P(17)="D":1,P(17)="E":1,P(17)="N":1,1:0) Q
"RTN","PSIVLB",23,0)
 ;
"RTN","PSIVLB",24,0)
 K ^TMP("PSIVLB",$J),PSJIDLST
"RTN","PSIVLB",25,0)
 S PSJLN=1 ;PSJLN is incrementting in SETTMP^PSJLMPRU
"RTN","PSIVLB",26,0)
 S PSJL=""
"RTN","PSIVLB",27,0)
 S PSIVLBNM="PSIVLB" D PIV^PSJLMPRI(DFN,ON,"","") K PSIVLBNM
"RTN","PSIVLB",28,0)
 D SETTMP^PSJLMPRU("PSIVLB"," ") S PSJL=""
"RTN","PSIVLB",29,0)
 S PSJL="------------------------ Labels available for "_$S(PSJALB=2:"return",1:"reprint")_" -------------------------"
"RTN","PSIVLB",30,0)
 D SETTMP^PSJLMPRU("PSIVLB",PSJL) S PSJL=""
"RTN","PSIVLB",31,0)
 F PSJLBN=0:0 S PSJLBN=$O(^PS(55,DFN,"IV",+ON,"BCMA",PSJLBN)) Q:'PSJLBN  D
"RTN","PSIVLB",32,0)
 . NEW X,XX S XX=$G(^PS(55,DFN,"IVBCMA",PSJLBN,0)) Q:XX=""
"RTN","PSIVLB",33,0)
 . I $P(XX,U,9),(PSJALB'=2) Q
"RTN","PSIVLB",34,0)
 . F X=1:1:8 S PSJLB(X)=$P(XX,U,X)
"RTN","PSIVLB",35,0)
 . I PSJALB=1,$S(PSJLB(7)]"":1,PSJLB(4)]""&("CG"[PSJLB(4)):1,1:0) Q
"RTN","PSIVLB",36,0)
 . I PSJALB=2,$S(PSJLB(4)]""&("CGIS"[PSJLB(4)):1,PSJLB(7)="RP":0,PSJLB(7)]"":1,1:0) Q
"RTN","PSIVLB",37,0)
 . S (PSJCNT,PSJIDLST)=$G(PSJCNT)+1
"RTN","PSIVLB",38,0)
 . S PSJL=$J(PSJCNT,3)_". "_PSJLB(1),PSJLEN=$L(PSJL)+5
"RTN","PSIVLB",39,0)
 . S PSJIDLST(PSJCNT)=PSJLB(1)
"RTN","PSIVLB",40,0)
 . S PSJIDLST(PSJLB(1))=PSJLB(1)
"RTN","PSIVLB",41,0)
 . F PSJAS="AD","SOL" D ADSOL(PSJAS)
"RTN","PSIVLB",42,0)
 . S X=$S(P(8)]"":P(8),1:P(9)),PSJL=$$SETSTR^VALM1(X,PSJL,PSJLEN,$L(X))
"RTN","PSIVLB",43,0)
 . D SETTMP^PSJLMPRU("PSIVLB",PSJL) S PSJL=""
"RTN","PSIVLB",44,0)
 . S X=PSJLB(4) I X]"" D
"RTN","PSIVLB",45,0)
 .. S X="   BCMA Status: "_$$CODES^PSIVUTL(X,55.0105,2)
"RTN","PSIVLB",46,0)
 .. S X=X_" "_$$ENDTC^PSGMI(PSJLB(3))
"RTN","PSIVLB",47,0)
 . S X=PSJLB(8)_X
"RTN","PSIVLB",48,0)
 . S PSJL=$$SETSTR^VALM1(X,PSJL,PSJLEN,$L(X))
"RTN","PSIVLB",49,0)
 . D SETTMP^PSJLMPRU("PSIVLB",PSJL) S PSJL=""
"RTN","PSIVLB",50,0)
 . D:+$G(MORE) MORE
"RTN","PSIVLB",51,0)
 S VALMCNT=PSJLN-1
"RTN","PSIVLB",52,0)
 K PSJCNT,PSJLB,PSJLBN,PSJLEN
"RTN","PSIVLB",53,0)
 Q
"RTN","PSIVLB",54,0)
ADSOL(PSJAS) ;         
"RTN","PSIVLB",55,0)
 F PSJADSOL=0:0 S PSJADSOL=$O(^PS(55,DFN,"IVBCMA",PSJLBN,PSJAS,PSJADSOL)) Q:'PSJADSOL  D
"RTN","PSIVLB",56,0)
 . NEW X,XX,PSJLB S XX=^PS(55,DFN,"IVBCMA",PSJLBN,PSJAS,PSJADSOL,0)
"RTN","PSIVLB",57,0)
 . F X=1:1:3 S PSJLB(X)=$P(XX,U,X)
"RTN","PSIVLB",58,0)
 . S X=$S(PSJAS="AD":52.6,1:52.7)
"RTN","PSIVLB",59,0)
 . S X=$P($G(^PS(X,+PSJLB(1),0)),U)
"RTN","PSIVLB",60,0)
 . S X=X_" "_PSJLB(2)_$S(PSJLB(3)]"":" ("_PSJLB(3)_")",1:"")
"RTN","PSIVLB",61,0)
 . S PSJL=$$SETSTR^VALM1(X,PSJL,PSJLEN,$L(X))
"RTN","PSIVLB",62,0)
 . D SETTMP^PSJLMPRU("PSIVLB",PSJL)
"RTN","PSIVLB",63,0)
 . S PSJL=""
"RTN","PSIVLB",64,0)
 Q
"RTN","PSIVLB",65,0)
MORE ;Display extra data for the label
"RTN","PSIVLB",66,0)
 D SETTMP^PSJLMPRU("PSIVLB","HELLO") S PSJL=""
"RTN","PSIVLB",67,0)
 Q
"RTN","PSIVLBL1")
0^15^B42809676^B42715799
"RTN","PSIVLBL1",1,0)
PSIVLBL1 ;BIR/RGY-PRINT LABEL FROM WARD LIST ;24 Aug 2001  3:59 PM
"RTN","PSIVLBL1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**69,58,81,97,104,279**;16 DEC 97;Build 150
"RTN","PSIVLBL1",3,0)
 ;
"RTN","PSIVLBL1",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVLBL1",5,0)
 ; Reference to ^%DT is supported by DBIA 10003.
"RTN","PSIVLBL1",6,0)
 ; Reference to ^%ZIS is supported by DBIA 10086.
"RTN","PSIVLBL1",7,0)
 ; Reference to ^%ZTLOAD is supported by DBIA 10063.
"RTN","PSIVLBL1",8,0)
 ; Reference to ^DICN is supported by DBIA 10009.
"RTN","PSIVLBL1",9,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSIVLBL1",10,0)
 ; Reference to ^VALM1 is supported by DBIA 10116.
"RTN","PSIVLBL1",11,0)
 ;
"RTN","PSIVLBL1",12,0)
START S Y=1 W !!,"Schedule labels for DATE: TODAY//" R X:DTIME S:'$T X="^" S:X="" X="T" Q:X["^"  I X'["?" S %DT="EX" D ^%DT
"RTN","PSIVLBL1",13,0)
 G:Y<1 START
"RTN","PSIVLBL1",14,0)
 I X["?" S HELP="LBL1" D ^PSIVHLP S X="?" D ^%DT G START
"RTN","PSIVLBL1",15,0)
ASK S PSIVDT=Y\1 D ^PSIVWL1 G QUIT:'$D(PSIVOD)!('$D(PSIVCD))
"RTN","PSIVLBL1",16,0)
 I PSIVPL'=ION D QUE G QUIT
"RTN","PSIVLBL1",17,0)
DEQ ;
"RTN","PSIVLBL1",18,0)
 L +^PS(55,"PSIVWL",PSIVSN):1 E  W:$Y @IOF W !!,"**** WARNING --- LABELS NOT",!,"   RUN, WARD LIST IN PROGRESS" G QUIT
"RTN","PSIVLBL1",19,0)
 S PSIVT="" F PSIVLBL1=0:0 S PSIVT=$O(PSIVOD(PSIVT)) Q:PSIVT=""  S WRD="" D @("LBL"_$S($D(^PS(55,"PSIVWLM",PSIVSN,PSIVT_PSIVOD(PSIVT))):"M",1:"W"))
"RTN","PSIVLBL1",20,0)
 I $G(PSJRPFLG) D
"RTN","PSIVLBL1",21,0)
 . W !!,"*** NOTE ***"
"RTN","PSIVLBL1",22,0)
 . W !!,"Schedule labels had already printed for the selected manufacturing time."
"RTN","PSIVLBL1",23,0)
 . W !,"Please use the Reprint Scheduled Labels option instead.",!
"RTN","PSIVLBL1",24,0)
 . K PSJRPFLG
"RTN","PSIVLBL1",25,0)
QUIT L -^PS(55,"PSIVWL",PSIVSN) S:$D(ZTQUEUED) ZTREQ="@" K %,%DT,%T,D,DFN,I,JJ,NOFLG,ON,P,PSCT,PSIV,PSIVCD,PSIVDT,PSIVDOSE,PSIVMT,PSIVOD,PSIVNOL,PSIVT,VAERR,WRD,X,X1,X2,Y,Z,ZTSK,OIX1,OIX2
"RTN","PSIVLBL1",26,0)
 Q
"RTN","PSIVLBL1",27,0)
LBLM ;
"RTN","PSIVLBL1",28,0)
 N OIX1,OIX2 I '$D(^PS(55,"PSIVWLM",PSIVSN,PSIVT_PSIVOD(PSIVT),PSIVT)) D DESC(PSIVT) Q
"RTN","PSIVLBL1",29,0)
 S OIX1=0 F  S OIX1=$O(^PS(55,"PSIVWLM",PSIVSN,PSIVT_PSIVOD(PSIVT),PSIVT,OIX1)) Q:OIX1=""  S OIX2=0 F  S OIX2=$O(^PS(55,"PSIVWLM",PSIVSN,PSIVT_PSIVOD(PSIVT),PSIVT,OIX1,OIX2)) Q:OIX2=""  D LBLM1
"RTN","PSIVLBL1",30,0)
 K JX Q
"RTN","PSIVLBL1",31,0)
LBLM1 ;
"RTN","PSIVLBL1",32,0)
 S NOFLG=1 N DFNX,ONX
"RTN","PSIVLBL1",33,0)
 S DFNX=0 F  S DFNX=$O(^PS(55,"PSIVWLM",PSIVSN,PSIVT_PSIVOD(PSIVT),PSIVT,OIX1,OIX2,DFNX)) Q:'DFNX  D
"RTN","PSIVLBL1",34,0)
 . S DFN=+DFNX D ENIV^PSJAC S DFN=DFNX,ONX=0 F  S ONX=$O(^PS(55,"PSIVWLM",PSIVSN,PSIVT_PSIVOD(PSIVT),PSIVT,OIX1,OIX2,DFN,ONX)) Q:'ONX  D
"RTN","PSIVLBL1",35,0)
 .. S ON=+ONX,WRD=$P(^(+ON),"^",2),X1=OIX1,X2=OIX2 D MEOW
"RTN","PSIVLBL1",36,0)
 ; naked reference on line above refers to the ^PS(55,"PSIVWLM" reference on the line preceding the naked reference
"RTN","PSIVLBL1",37,0)
 D:NOFLG DESC(PSIVT)
"RTN","PSIVLBL1",38,0)
 Q
"RTN","PSIVLBL1",39,0)
LBLW ; loop through ward lists
"RTN","PSIVLBL1",40,0)
 N DFNX,ONX,WRDX
"RTN","PSIVLBL1",41,0)
 S NOFLG=1 S WRDX=0 F  S WRDX=$O(^PS(55,"PSIVWL",PSIVSN,WRDX)) Q:WRDX=""  D
"RTN","PSIVLBL1",42,0)
 . S WRD=WRDX S DFNX=0 F  S DFNX=$O(^PS(55,"PSIVWL",PSIVSN,WRD,PSIVT_PSIVOD(PSIVT),DFNX)) Q:'DFNX  D
"RTN","PSIVLBL1",43,0)
 .. S DFN=+DFNX D ENIV^PSJAC S DFN=DFNX S ONX=0 F  S ONX=$O(^PS(55,"PSIVWL",PSIVSN,WRD,PSIVT_PSIVOD(PSIVT),DFN,ONX)) Q:'ONX  S ON=+ONX D MEOW
"RTN","PSIVLBL1",44,0)
 D:NOFLG DESC(PSIVT)
"RTN","PSIVLBL1",45,0)
 Q
"RTN","PSIVLBL1",46,0)
MEOWRPT ;Reprint from man/ward list
"RTN","PSIVLBL1",47,0)
 I '$O(^PS(55,"PSIVWL",PSIVSN,WRD,PSIVT_PSIVOD(PSIVT),DFN,+ON,0)) D MEOW Q
"RTN","PSIVLBL1",48,0)
 S PSIVWMFL=1 ;this flag indicate prt/reprt from war/man list
"RTN","PSIVLBL1",49,0)
 NEW PSJID,PSIVOID,PSIVID,X,XX
"RTN","PSIVLBL1",50,0)
 F PSJID=0:0 S PSJID=$O(^PS(55,"PSIVWL",PSIVSN,WRD,PSIVT_PSIVOD(PSIVT),DFN,+ON,PSJID)) Q:'PSJID  D REPRT
"RTN","PSIVLBL1",51,0)
 ;
"RTN","PSIVLBL1",52,0)
 ; Kill old ID and set newly reprinted ID.
"RTN","PSIVLBL1",53,0)
 ;
"RTN","PSIVLBL1",54,0)
 F X=0:0 S X=$O(PSIVOID(X)) Q:'X  D
"RTN","PSIVLBL1",55,0)
 . K ^PS(55,"PSIVWL",PSIVSN,WRD,PSIVT_PSIVOD(PSIVT),DFN,+ON,X)
"RTN","PSIVLBL1",56,0)
 F X=0:0 S X=$O(PSIVID(X)) Q:'X  D
"RTN","PSIVLBL1",57,0)
 . S ^PS(55,"PSIVWL",PSIVSN,WRD,PSIVT_PSIVOD(PSIVT),DFN,+ON,X)=""
"RTN","PSIVLBL1",58,0)
 K PSIVWMFL,PSIVOID,PSIVID
"RTN","PSIVLBL1",59,0)
 Q
"RTN","PSIVLBL1",60,0)
REPRT ; Reprint labels using existing bcma ID
"RTN","PSIVLBL1",61,0)
 S PSIVOID(PSJID)=""
"RTN","PSIVLBL1",62,0)
 NEW PSJLB S XX=$G(^PS(55,DFN,"IVBCMA",PSJID,0)) Q:XX=""
"RTN","PSIVLBL1",63,0)
 F X=1:1:9 S PSJLB(X)=$P(XX,U,X)
"RTN","PSIVLBL1",64,0)
 I $S(PSJLB(4)="C":1,PSJLB(4)="G":1,PSJLB(4)="I":1,PSJLB(7)'="":1,PSJLB(9):1,1:0) Q
"RTN","PSIVLBL1",65,0)
 S PSIVCTD=0,PSIVCT=1,PSIVNOL=1,P(4)=$P(^PS(55,DFN,"IV",+ON,0),"^",4)
"RTN","PSIVLBL1",66,0)
 D REPRT^PSIVLBRP(DFN_"V"_PSJID)
"RTN","PSIVLBL1",67,0)
 Q
"RTN","PSIVLBL1",68,0)
MEOW ; Print labels
"RTN","PSIVLBL1",69,0)
 S PSIVCT=1,PSIVNOL=+^PS(55,"PSIVWL",PSIVSN,WRD,PSIVT_PSIVOD(PSIVT),DFN,+ON),P16=$P(^(+ON),"^",3),PSIVDOSE=$P(^(+ON),"^",2) I '$P(^(+ON),"^",4) S $P(^(+ON),"^",4)=1 K PSIVCT
"RTN","PSIVLBL1",70,0)
 I PSIVNOL=0 K PSIVDOSE,PSIVCT,PSIVWMFL,PSIVID Q
"RTN","PSIVLBL1",71,0)
 N PSJSCH,PSJST,A,PSJOK
"RTN","PSIVLBL1",72,0)
 S PSJSCH=$P(^PS(55,DFN,"IV",+ON,0),"^",9),PSJST=$$ONE^PSJBCMA(DFN,ON,PSJSCH)
"RTN","PSIVLBL1",73,0)
 S PSJOK=1 I PSJST="O" S A=0 F  S A=$O(^PS(55,DFN,"IV",+ON,"LAB",A)) Q:A=""  I $P($G(^(A,0)),"^",3)=1 S PSJOK=0 Q
"RTN","PSIVLBL1",74,0)
 Q:'PSJOK
"RTN","PSIVLBL1",75,0)
 Q:"HOD"[$P(^PS(55,DFN,"IV",+ON,0),"^",17)
"RTN","PSIVLBL1",76,0)
 I $O(^PS(55,"PSIVWL",PSIVSN,WRD,PSIVT_PSIVOD(PSIVT),DFN,ON,0)) D  Q
"RTN","PSIVLBL1",77,0)
 . S NOFLG=0,PSJRPFLG=1
"RTN","PSIVLBL1",78,0)
 S PSIVWMFL=1
"RTN","PSIVLBL1",79,0)
 S IONOFF="",P(4)=$P(^PS(55,DFN,"IV",+ON,0),"^",4),ACTION=1,TRACK=2 D ^PSIVLTR D ^PSIVHYPL:P(4)="H",^PSIVLABL:"APSC"[P(4)
"RTN","PSIVLBL1",80,0)
 I $D(PSIVID) S X=0 F  S X=$O(PSIVID(X)) Q:'X  D
"RTN","PSIVLBL1",81,0)
 . S ^PS(55,"PSIVWL",PSIVSN,WRD,PSIVT_PSIVOD(PSIVT),DFN,ON,X)=""
"RTN","PSIVLBL1",82,0)
 S NOFLG=0
"RTN","PSIVLBL1",83,0)
 K PSIVDOSE,PSIVCT,PSIVWMFL,PSIVID Q
"RTN","PSIVLBL1",84,0)
 ;
"RTN","PSIVLBL1",85,0)
QUE S ZTIO=PSIVPL,ZTDESC="PRINT SCHEDULED IV LABELS",ZTRTN="DEQ^PSIVLBL1",PSIVT="",ZTSAVE("PSJSYSP0")=""
"RTN","PSIVLBL1",86,0)
 F I=0:0 S PSIVT=$O(PSIVMT(PSIVT)) Q:PSIVT=""  S (ZTSAVE("PSIVCD("""_PSIVT_""")"),ZTSAVE("PSIVMT("""_PSIVT_""")"),ZTSAVE("PSIVOD("""_PSIVT_""")"))=""
"RTN","PSIVLBL1",87,0)
 F X="PSIVSN","PSIVSITE","PSJSYSW0","PSJSYSU","IONOFF" S ZTSAVE(X)=""
"RTN","PSIVLBL1",88,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"Queued." Q
"RTN","PSIVLBL1",89,0)
 ;
"RTN","PSIVLBL1",90,0)
ENLBLI ;Print individual labels.
"RTN","PSIVLBL1",91,0)
 D FULL^VALM1
"RTN","PSIVLBL1",92,0)
 S PSJORD=ON D ENNH^PSIVORV2(ON)
"RTN","PSIVLBL1",93,0)
 I ON'["V" W !!,$C(7),$C(7),"You may not print labels for a pending order." W ! K DIR S DIR(0)="E" D ^DIR K DIR G Q
"RTN","PSIVLBL1",94,0)
A1 ;
"RTN","PSIVLBL1",95,0)
 I "EDP"[$P(^PS(55,DFN,"IV",+ON,0),U,17) W !,$C(7),$C(7),"WARNING, this order is not active.",!,"Continue" S %=2 D YN^DICN G:%=2!(%=-1) Q G:%=0 A1
"RTN","PSIVLBL1",96,0)
 D PAUSE^VALM1
"RTN","PSIVLBL1",97,0)
 S PSIVLBTP=1,PSJMORE=0 D EN^VALM("PSJ LM IV LABELS") G Q
"RTN","PSIVLBL1",98,0)
LBLBEG R !!,"Number of labels to print: ",X:DTIME Q:'$T!("^"[X)  S:X["?" HELP="NOL" D:X["?" ^PSIVHLP1 G:X["?" LBLBEG K:X'=+X!(X>10)!(X<1)!(X?.E1"."1N.N) X W:'$D(X) $C(7),$C(7),"??" G:'$D(X) LBLBEG S PSIVNOL=+X,PSIVCT=1
"RTN","PSIVLBL1",99,0)
 ;
"RTN","PSIVLBL1",100,0)
USAGE ;
"RTN","PSIVLBL1",101,0)
 W !,"Count as daily usage" S %=1 D YN^DICN G:%=-1 Q K:%=1 PSIVCT I %=0 S HELP="NCILBL" D ^PSIVHLP1 G USAGE
"RTN","PSIVLBL1",102,0)
 S P16=$S('$D(PSIVCT):$P(^PS(55,DFN,"IV",+ON,0),"^",16),1:0) S:'$D(PSIVCT) $P(^(0),"^",16)=P16+X
"RTN","PSIVLBL1",103,0)
 S IONOFF="",IOP=PSIVPL,%ZIS="NQ" D ^%ZIS G:POP Q I IO=IO(0),($E(IOST)="C") W !!! D DEQIA,Q D HOME^%ZIS Q
"RTN","PSIVLBL1",104,0)
 D HOME^%ZIS
"RTN","PSIVLBL1",105,0)
 W ! S ZTDTH=$H,ZTIO=PSIVPL,ZTDESC="PRINT INDIVIDUAL IV LABELS",ZTRTN="DEQIA^PSIVLBL1" F X="IONOFF","P16","PSIVAC","PSIVNOL","PSIVSN","PSIVSITE","DFN","ON","PSJSYSW0","PSJSYSU","PSJSYSP0" S ZTSAVE(X)=""
"RTN","PSIVLBL1",106,0)
 S:$D(PSIVCT) ZTSAVE("PSIVCT")="" D ^%ZTLOAD W:$D(ZTSK) !,"Queued."
"RTN","PSIVLBL1",107,0)
Q ;K %,IONOFF,ON,ORNS,ORPV,ORSTOP,ORSTRT,ORSTS,ORVP,P,PSIVC,PSIVREA,J,N,N2,ORIFN,P17,SCHED,PSIVDOSE,PSIVNOL,PSIVNOW,VAERR
"RTN","PSIVLBL1",108,0)
 K %,IONOFF,ORNS,ORPV,ORSTOP,ORSTRT,ORSTS,ORVP,PSIVC,PSIVREA,J,N,N2,ORIFN,P17,SCHED,PSIVDOSE,PSIVNOL,PSIVNOW,VAERR
"RTN","PSIVLBL1",109,0)
 Q
"RTN","PSIVLBL1",110,0)
DEQIA ;
"RTN","PSIVLBL1",111,0)
 K PSIVDOSE S P(4)=$P(^PS(55,DFN,"IV",+ON,0),"^",4)
"RTN","PSIVLBL1",112,0)
 S ACTION=1,TRACK=1 D ^PSIVLTR
"RTN","PSIVLBL1",113,0)
 ;
"RTN","PSIVLBL1",114,0)
 D ^PSIVHYPL:P(4)="H",^PSIVLABL:"APSC"[P(4) S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSIVLBL1",115,0)
 Q
"RTN","PSIVLBL1",116,0)
DESC(X) ;Expand the IV type.
"RTN","PSIVLBL1",117,0)
 NEW XX,Y,DESC,X1,X2 S Y=$$CODES^PSIVUTL(X,55.01,.04)
"RTN","PSIVLBL1",118,0)
 S XX="***NO "_Y_" DATA***"
"RTN","PSIVLBL1",119,0)
 NEW MARX D TXT^PSGMUTL(XX,$P(PSIVSITE,U,13))
"RTN","PSIVLBL1",120,0)
 F XX=1:1:(+PSIVSITE+$P(PSIVSITE,U,16))  W:XX>2 $G(MARX(XX-2)) W !
"RTN","PSIVLBL1",121,0)
 Q
"RTN","PSIVLTR1")
0^19^B40668959^B9987089
"RTN","PSIVLTR1",1,0)
PSIVLTR1 ;BIR/PR-PRINT LABEL TRACKER BY PATIENT ;2 NOV 92 / 9:34 AM
"RTN","PSIVLTR1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**58,279**;16 DEC 97;Build 150
"RTN","PSIVLTR1",3,0)
 ;
"RTN","PSIVLTR1",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVLTR1",5,0)
 ;
"RTN","PSIVLTR1",6,0)
 ;The following parameters are needed
"RTN","PSIVLTR1",7,0)
 ;DFN - Patient
"RTN","PSIVLTR1",8,0)
 ;ON  -Order number
"RTN","PSIVLTR1",9,0)
 ;
"RTN","PSIVLTR1",10,0)
DATA(DFN,ON) ;Get the information
"RTN","PSIVLTR1",11,0)
 N PSJBCIV,PSJISTAT,PSJIFOLL,PSJDCEX S PSJBCIV="",PSJDCEX=0 K ^TMP("PSJINBAG",$J,DFN)
"RTN","PSIVLTR1",12,0)
 D PSBPOIV^PSJIBAG(DFN,ON_"V",1) I $D(^TMP("PSJINBAG",$J,DFN,+ON_"V")) S PSJBCIV=$S(($G(^(ON_"V"))["AVAILABLE"):1,1:-1)
"RTN","PSIVLTR1",13,0)
 S PSJDCEX=$$NONACT(DFN,ON_"V")
"RTN","PSIVLTR1",14,0)
 D NEWDATA(DFN,ON,PSJDCEX)
"RTN","PSIVLTR1",15,0)
 D BLDORAR(DFN,ON_"V")
"RTN","PSIVLTR1",16,0)
 D OLDDATA(DFN,ON,PSJDCEX)
"RTN","PSIVLTR1",17,0)
 D K
"RTN","PSIVLTR1",18,0)
 Q
"RTN","PSIVLTR1",19,0)
 ;
"RTN","PSIVLTR1",20,0)
NEWDATA(DFN,ON,ALLINV) ;Get the information
"RTN","PSIVLTR1",21,0)
 N PSJBLN,PSJD1,X,DA,DR,DIQ,DIC,PSJD2
"RTN","PSIVLTR1",22,0)
 K PSJDNE S PSIVSCR=$E(IOST)="C",COU=0 D H I '$D(^PS(55,DFN,"IV",ON,"LAB")) W !,"No label log to report.",!
"RTN","PSIVLTR1",23,0)
 F L=0:0 S L=$O(^PS(55,DFN,"IV",ON,"LAB",L)) Q:'L!$D(PSJDNE)  S COU=COU+1 I $D(^(L,0)) D 1
"RTN","PSIVLTR1",24,0)
 Q:'$D(^PS(55,DFN,"IV",ON,"BCMA"))
"RTN","PSIVLTR1",25,0)
 D PAUSE,H2 S PSJBLN=0
"RTN","PSIVLTR1",26,0)
 F  Q:$G(PSJDNE)  S PSJBLN=$O(^PS(55,DFN,"IVBCMA",PSJBLN)) Q:PSJBLN=""  D
"RTN","PSIVLTR1",27,0)
 . K DA,DR,DIQ,DIC,PSJD2 N LSTAT,AVAIL,BSTAT S AVAIL=""
"RTN","PSIVLTR1",28,0)
 . S DIC="^PS(55,"_DFN_",""IVBCMA"",",DA=PSJBLN,DR=".01;.02;1;2;3;4;5",DIQ="PSJD2",DIQ(0)="IE" D EN^DIQ1
"RTN","PSIVLTR1",29,0)
 . Q:$G(PSJD2(55.0105,PSJBLN,.02,"I"))'=ON
"RTN","PSIVLTR1",30,0)
 . I PSIVSCR,($Y#IOSL)>23 D PAUSE,H2 Q:$G(PSJDNE)
"RTN","PSIVLTR1",31,0)
 . W $$ENDTC1^PSGMI($G(PSJD2(55.0105,PSJBLN,4,"I"))),?16,$G(PSJD2(55.0105,PSJBLN,.01,"I")) I $X>39 W !
"RTN","PSIVLTR1",32,0)
 . S LSTAT=$G(PSJD2(55.0105,PSJBLN,5,"E")) S LSTAT=$S(LSTAT="RECYCLED":"RECYCLED",LSTAT="DESTROYED":"DESTROYED",LSTAT="CANCELLED":"CANCELLED",LSTAT="REPRINTED":"REPRINTED",1:LSTAT)
"RTN","PSIVLTR1",33,0)
 . S BSTAT=$E($G(PSJD2(55.0105,PSJBLN,2,"E")))
"RTN","PSIVLTR1",34,0)
 . S AVAIL=$S($G(ALLINV):"NO",$P($G(^PS(55,DFN,"IVBCMA",PSJBLN,0)),"^",9):"NO",(LSTAT]""):"NO",(",C,G,I,S,")[(","_BSTAT_","):"NO",$G(PSJBCIV)<0:"NO",($G(PSJBCIV)>0)&'$D(^TMP("PSJINBAG",$J,DFN,ON_"V",DFN_"V"_PSJBLN)):"NO",1:"YES")
"RTN","PSIVLTR1",35,0)
 . W ?37,AVAIL
"RTN","PSIVLTR1",36,0)
 . W ?43,LSTAT
"RTN","PSIVLTR1",37,0)
 . S X=$G(PSJD2(55.0105,PSJBLN,3,"I")) W ?53,$S(X:"YES",1:"NO"),?57,$E($G(PSJD2(55.0105,PSJBLN,2,"E")),1,8)
"RTN","PSIVLTR1",38,0)
 . I $G(PSJD2(55.0105,PSJBLN,1,"I"))]"" W ?66,$$ENDTC1^PSGMI($G(PSJD2(55.0105,PSJBLN,1,"I")))
"RTN","PSIVLTR1",39,0)
 . W !
"RTN","PSIVLTR1",40,0)
 ;
"RTN","PSIVLTR1",41,0)
OLDDATA(DFN,ON,ALLINV) ; Get labels for current order
"RTN","PSIVLTR1",42,0)
 N PSJBLN,PSJD1,X,DA,DR,DIQ,DIC,PSJD2,TMPON,PSJIMORE,PSIVOLDD,OCNT S PSJIMORE=0,PSIVOLDD=1
"RTN","PSIVLTR1",43,0)
 S TMPON=0 F  Q:$G(PSJIMORE)  S TMPON=$O(^TMP("PSJIBAG0",$J,DFN,TMPON)) Q:((+TMPON=+ON))!'TMPON  I $D(^PS(55,DFN,"IV",+TMPON,"LAB")) S PSJIMORE=1
"RTN","PSIVLTR1",44,0)
 Q:'$G(PSJIMORE)
"RTN","PSIVLTR1",45,0)
 K DIR S DIR(0)="Y",DIR("B")="Y",DIR("A")="Do you wish to see labels from linked (edited) orders" D ^DIR Q:'Y
"RTN","PSIVLTR1",46,0)
 K PSJDNE S PSIVSCR=$E(IOST)="C",COU=0
"RTN","PSIVLTR1",47,0)
 S PSJBLN=0 D H2
"RTN","PSIVLTR1",48,0)
 S TMPON=999999999999999 F OCNT=1:1  Q:$G(PSJDNE)  S TMPON=$O(^TMP("PSJIBAG0",$J,DFN,+TMPON),-1) Q:'TMPON  S PSJBLN=9999999 F  Q:$G(PSJDNE)  S PSJBLN=$O(^PS(55,DFN,"IV",+TMPON,"BCMA",PSJBLN),-1) Q:'PSJBLN  D
"RTN","PSIVLTR1",49,0)
 . Q:(TMPON=ON)
"RTN","PSIVLTR1",50,0)
 . K DA,DR,DIQ,DIC,PSJD2 N LSTAT,AVAIL,BSTAT
"RTN","PSIVLTR1",51,0)
 . S DIC="^PS(55,"_DFN_",""IVBCMA"",",DA=PSJBLN,DR=".01;.02;1;2;3;4;5",DIQ="PSJD2",DIQ(0)="IE" D EN^DIQ1
"RTN","PSIVLTR1",52,0)
 . Q:'$D(^TMP("PSJIBAG0",$J,DFN,+$G(PSJD2(55.0105,PSJBLN,.02,"I"))))
"RTN","PSIVLTR1",53,0)
 . I PSIVSCR&(($Y#IOSL)>21) D PAUSE Q:$G(PSJDNE)  D H2
"RTN","PSIVLTR1",54,0)
 . W $$ENDTC1^PSGMI($G(PSJD2(55.0105,PSJBLN,4,"I"))),?16,$G(PSJD2(55.0105,PSJBLN,.01,"I")) I $X>39 W !
"RTN","PSIVLTR1",55,0)
 . S LSTAT=$G(PSJD2(55.0105,PSJBLN,5,"E")) S LSTAT=$S(LSTAT="RECYCLED":"RECYCLED",LSTAT="DESTROYED":"DESTROYED",LSTAT="CANCELLED":"CANCELLED",LSTAT="REPRINTED":"REPRINTED",1:LSTAT)
"RTN","PSIVLTR1",56,0)
 . S BSTAT=$E($G(PSJD2(55.0105,PSJBLN,2,"E")))
"RTN","PSIVLTR1",57,0)
 . S AVAIL=$S($G(ALLINV):"NO",$P($G(^PS(55,DFN,"IVBCMA",PSJBLN,0)),"^",9):"NO",(LSTAT]""):"NO",(",C,G,I,S,")[(","_BSTAT_","):"NO",$G(PSJBCIV)<0:"NO",($G(PSJBCIV)>0)&'$D(^TMP("PSJINBAG",$J,DFN,ON_"V",DFN_"V"_PSJBLN)):"NO",1:"YES")
"RTN","PSIVLTR1",58,0)
 . W ?37,AVAIL
"RTN","PSIVLTR1",59,0)
 . W ?43,LSTAT
"RTN","PSIVLTR1",60,0)
 . S X=$G(PSJD2(55.0105,PSJBLN,3,"I")) W ?53,$S(X:"YES",1:"NO"),?57,$E($G(PSJD2(55.0105,PSJBLN,2,"E")),1,8)
"RTN","PSIVLTR1",61,0)
 . I $G(PSJD2(55.0105,PSJBLN,1,"I"))]"" W ?66,$$ENDTC1^PSGMI($G(PSJD2(55.0105,PSJBLN,1,"I")))
"RTN","PSIVLTR1",62,0)
 . W !
"RTN","PSIVLTR1",63,0)
 ;
"RTN","PSIVLTR1",64,0)
K ;
"RTN","PSIVLTR1",65,0)
 K NUMLAB,TRA,CD,DATE
"RTN","PSIVLTR1",66,0)
 K ^TMP("PSJINBAG",$J),^TMP("PSJIBAG0",$J)
"RTN","PSIVLTR1",67,0)
 Q
"RTN","PSIVLTR1",68,0)
 ;
"RTN","PSIVLTR1",69,0)
 Q
"RTN","PSIVLTR1",70,0)
1 ;Get num labels, track, daily usage
"RTN","PSIVLTR1",71,0)
 ;naked reference refers to ^PS(55,DFN,"IV",ON,"LAB",L,0)
"RTN","PSIVLTR1",72,0)
 S N=^(0),Y=$P(N,U,2) X ^DD("DD") S DATE=Y,USER=$P(N,U,4),OG=$P(N,U,3),OG=$S(OG=1:"DISPENSED",OG=2:"RECYCLED",OG=3:"DESTROYED",OG=4:"CANCELLED",1:"SUSPENDED")
"RTN","PSIVLTR1",73,0)
 S NUMLAB=$P(N,U,5) S:$P(N,U,3)=1!($P(N,U,3)=5) TRA=$P(N,U,6),TRA=$S(TRA=1:"INDIVIDUAL",TRA=2:"SCHEDULED",TRA=3:"SUSPENSE",1:"ORDER ACTION") S CD=$S($P(N,U,7):"YES",1:"NO") D P
"RTN","PSIVLTR1",74,0)
 Q
"RTN","PSIVLTR1",75,0)
P ;Print out info
"RTN","PSIVLTR1",76,0)
 W !,COU,?3,DATE,!,?18,OG,?32,$E($P(^VA(200,USER,0),U),1,15),?50,NUMLAB W:$P(N,U,3)=1!($P(N,U,3)=5) ?60,TRA W:$P(N,U,3)=1 ?77,CD D:$P(N,U,3)'=1&($P(N,U,8)'="") ERROR W ! I ($Y#IOSL)>23,PSIVSCR D PAUSE
"RTN","PSIVLTR1",77,0)
 K NUMLAB,TRA,CD,DATE,USEROG
"RTN","PSIVLTR1",78,0)
 Q
"RTN","PSIVLTR1",79,0)
 ;
"RTN","PSIVLTR1",80,0)
PAUSE ;
"RTN","PSIVLTR1",81,0)
 N DIR S DIR(0)="E" D ^DIR S:$D(DTOUT)!($D(DUOUT)) PSJDNE=1
"RTN","PSIVLTR1",82,0)
 Q
"RTN","PSIVLTR1",83,0)
H ;Header
"RTN","PSIVLTR1",84,0)
 W !!,"LABEL LOG:",!!,"#",?3,"DATE/TIME",?18,"ACTION",?32,"USER",?47,"#LABELS",?60,"TRACK",?75,"COUNT",! F I=1:1:80 W "=" W:I=80 !
"RTN","PSIVLTR1",85,0)
 Q
"RTN","PSIVLTR1",86,0)
H2 ;Header for Unique ID #s
"RTN","PSIVLTR1",87,0)
 D CLEAR^VALM1
"RTN","PSIVLTR1",88,0)
 I $G(PSIVOLDD) W !!,"Unique IDs for linked (edited) orders:",!!
"RTN","PSIVLTR1",89,0)
 I '$G(PSIVOLDD) W !!,"Unique IDs for this order:",!!
"RTN","PSIVLTR1",90,0)
 W ?33,"Available",!
"RTN","PSIVLTR1",91,0)
 W "Label Date/Time",?16,"Unique ID",?34,"in BCMA",?43,"Status",?51,"Count",?57,"BCMA Action-Date/Time",!!
"RTN","PSIVLTR1",92,0)
 Q
"RTN","PSIVLTR1",93,0)
ERROR ;
"RTN","PSIVLTR1",94,0)
 W !!?40,"Bag(s) DISPENSED in IV Room: ",$P(^PS(59.5,$P($P(N,U,8)," "),0),U)
"RTN","PSIVLTR1",95,0)
 W !?40,"Bag(s) ",OG_" in IV Room: ",$P(^PS(59.5,$P($P(N,U,8)," ",2),0),U)
"RTN","PSIVLTR1",96,0)
 Q
"RTN","PSIVLTR1",97,0)
 ;
"RTN","PSIVLTR1",98,0)
BLDORAR(DFN,ON) ; Build global index of all previous orders in ^TMP("PSJIBAG0",$J,DFN,ON)
"RTN","PSIVLTR1",99,0)
 N PRVDONE S PRVDONE=0
"RTN","PSIVLTR1",100,0)
 F  Q:$G(PRVDONE)  D
"RTN","PSIVLTR1",101,0)
 .I ON["V" S ^TMP("PSJIBAG0",$J,DFN,+ON)=""
"RTN","PSIVLTR1",102,0)
 .I ON["P" S ON=$P($G(^PS(53.1,+ON,0)),"^",25)
"RTN","PSIVLTR1",103,0)
 .S ON=$S(($G(ON)["V"):$P($G(^PS(55,DFN,"IV",+ON,2)),"^",5),($G(ON)["P"):$P($G(^PS(53.1,+ON,0)),"^",25),1:"")
"RTN","PSIVLTR1",104,0)
 .I '$G(ON) S PRVDONE=1
"RTN","PSIVLTR1",105,0)
 Q
"RTN","PSIVLTR1",106,0)
 ;
"RTN","PSIVLTR1",107,0)
NONACT(DFN,ON) ; Check to see if the final order in this chain in Discontinued or Expired
"RTN","PSIVLTR1",108,0)
 N NXTON,DONE,STATUS,FOLLOW S DONE=0,FOLLOW=0,STATUS=""
"RTN","PSIVLTR1",109,0)
 S NXTON=ON
"RTN","PSIVLTR1",110,0)
 F  Q:$G(DONE)!$G(PSJDCEX)  D
"RTN","PSIVLTR1",111,0)
 .I NXTON["V" S STATUS=$P($G(^PS(55,DFN,"IV",+NXTON,0)),"^",17),FOLLOW=$P($G(^PS(55,DFN,"IV",+NXTON,2)),"^",6) I ",E,D,"[(","_STATUS_",")&'FOLLOW S PSJDCEX=1
"RTN","PSIVLTR1",112,0)
 .I NXTON["P" S STATUS=$P($G(^PS(53.1,+NXTON,0)),"^",9),FOLLOW=$P($G(^PS(53.1,+NXTON,0)),"^",26) I ",E,D,"[(","_STATUS_",")&'FOLLOW S PSJDCEX=1
"RTN","PSIVLTR1",113,0)
 .I NXTON["U" S STATUS=$P($G(^PS(55,DFN,5,+NXTON,0)),"^",9),FOLLOW=$P($G(^PS(55,DFN,5,+NXTON,0)),"^",26) I ",E,D,"[(","_STATUS_",")&'FOLLOW S PSJDCEX=1
"RTN","PSIVLTR1",114,0)
 .I '$G(FOLLOW) S DONE=1 Q
"RTN","PSIVLTR1",115,0)
 .S NXTON=FOLLOW
"RTN","PSIVLTR1",116,0)
 I $G(PSJDCEX) Q 1
"RTN","PSIVLTR1",117,0)
 Q 0
"RTN","PSIVOPT1")
0^7^B46129724^B43461784
"RTN","PSIVOPT1",1,0)
PSIVOPT1 ;BIR/MLM-EDIT/DC ORDER (BACKDOOR) ;22 OCT 97 / 3:14 PM
"RTN","PSIVOPT1",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**29,58,101,110,127,181,258,279**;16 DEC 97;Build 150
"RTN","PSIVOPT1",3,0)
 ;
"RTN","PSIVOPT1",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIVOPT1",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSIVOPT1",6,0)
 ;
"RTN","PSIVOPT1",7,0)
E ; Edit order through Pharmacy.
"RTN","PSIVOPT1",8,0)
 D GSTRING^PSIVORE1,GTFLDS^PSIVORFE
"RTN","PSIVOPT1",9,0)
 I '$G(PSIVENO) S PSIVENO=1 D EN^VALM("PSJ LM IV AC/EDIT") S VALMBCK="Q"
"RTN","PSIVOPT1",10,0)
 Q
"RTN","PSIVOPT1",11,0)
ACCEPT ; To be called by ACCEPT^PSJLIACT
"RTN","PSIVOPT1",12,0)
 NEW PSIVDSFG
"RTN","PSIVOPT1",13,0)
 D CKNEW
"RTN","PSIVOPT1",14,0)
 D:'$G(PSGORQF) DOSING
"RTN","PSIVOPT1",15,0)
 Q:$G(PSGORQF)
"RTN","PSIVOPT1",16,0)
 ;Don't create new order if Inf rate changed not supposed too set PSIVCHG=1
"RTN","PSIVOPT1",17,0)
 I PSIVCHG,'$G(PSJEDIT1) D
"RTN","PSIVOPT1",18,0)
 .S P("OLDON")=ON55,Y=$G(^PS(55,DFN,"IV",+ON55,0)) D NOW^%DTC S P("LOG")=$E(%,1,12)
"RTN","PSIVOPT1",19,0)
 .S P("CLRK")=DUZ_U_$P($G(^VA(200,DUZ,0)),U)
"RTN","PSIVOPT1",20,0)
 .I $G(PSGSDX)!$G(PSGFDX) Q
"RTN","PSIVOPT1",21,0)
 .I $P(Y,U,2)=P(2),$P(Y,U,3)=P(3) D ENT^PSIVCAL S X=P(2),%DT="T" D ^%DT S P(2)=$E(Y,1,12),PSJEDIT1=1 D ENSTOP^PSIVCAL
"RTN","PSIVOPT1",22,0)
 I $G(PSGORQF) S VALMBCK="Q" W !,"Order unchanged." D PAUSE^PSJMISC(1,) Q
"RTN","PSIVOPT1",23,0)
 D OK^PSIVOPT2
"RTN","PSIVOPT1",24,0)
 I X["N" S VALMBCK="R" Q
"RTN","PSIVOPT1",25,0)
 I X["^" D GT55^PSIVORFB W !,"Order unchanged." Q
"RTN","PSIVOPT1",26,0)
 I $G(P("21FLG"))]"" D CKNEW,@$S(PSIVCHG:"NEWORD",1:"UPDATE") Q:$D(X)
"RTN","PSIVOPT1",27,0)
 S PSJORL=$$ENORL^PSJUTL($G(VAIN(4))) S ON=ON55,OD=P(2)
"RTN","PSIVOPT1",28,0)
 D:ON["V" EN^PSIVORE
"RTN","PSIVOPT1",29,0)
 I $G(PSJIVORF),PSIVCHG D EN1^PSJHL2(DFN,"SN",ON55,"NEW ORDER") NEW PSIVXX S PSIVXX=$$LS^PSSLOCK(DFN,ON55)
"RTN","PSIVOPT1",30,0)
 S PSIVACEP=1
"RTN","PSIVOPT1",31,0)
 Q
"RTN","PSIVOPT1",32,0)
 ;
"RTN","PSIVOPT1",33,0)
DOSING ;
"RTN","PSIVOPT1",34,0)
 NEW TMPDRG
"RTN","PSIVOPT1",35,0)
 ;PSIVDSFG is set when changes to fields (except Schedule for continuous IV type) that caused a new order to create.
"RTN","PSIVOPT1",36,0)
 D TMPDRG^PSJMISC(DFN,$G(ON55),.TMPDRG)
"RTN","PSIVOPT1",37,0)
 I $S($G(PSIVDSFG):0,$G(PSIVCHG):1,1:0)!$$COMPARE^PSJMISC(.DRG,.TMPDRG,$S(P("DTYP")=1:0,1:1))!$$INFRATE^PSJMISC(DFN,ON55,P(8),P("DTYP")) D
"RTN","PSIVOPT1",38,0)
 . D IN^PSJOCDS($G(ON),"IV","")
"RTN","PSIVOPT1",39,0)
 I $G(PSGORQF) S VALMBCK="Q"
"RTN","PSIVOPT1",40,0)
 Q
"RTN","PSIVOPT1",41,0)
CKNEW ; Check if new order is to be created.
"RTN","PSIVOPT1",42,0)
 N DNE,ND,TDRG,PSJCHG,TMPDRG S (DNE,PSIVCHG,PSIVDSFG)=0
"RTN","PSIVOPT1",43,0)
 Q:PSIVCHG
"RTN","PSIVOPT1",44,0)
 D TMPDRG^PSJMISC(DFN,$G(ON55),.TMPDRG)
"RTN","PSIVOPT1",45,0)
 I $$COMPARE^PSJMISC(.DRG,.TMPDRG,$S(P("DTYP")=1:0,1:1)) S PSIVCHG=1
"RTN","PSIVOPT1",46,0)
 K TMPDRG
"RTN","PSIVOPT1",47,0)
 Q:PSIVCHG
"RTN","PSIVOPT1",48,0)
 F DRGT="AD","SOL" F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI  I $P(P("OT"),U)="F",'$P(DRG(DRGT,DRGI),U,5) S P("OT")="I"
"RTN","PSIVOPT1",49,0)
 ;I $G(DRG("AD",0))+$S(P("DTYP")=1:0,1:+$G(DRG("SOL",0)))'=DRG("DRGC") S PSIVCHG=1 Q
"RTN","PSIVOPT1",50,0)
 S ND(0)=$G(^PS(55,DFN,"IV",+ON55,0)),ND("PD")=$G(^PS(55,DFN,"IV",+ON55,.2))
"RTN","PSIVOPT1",51,0)
 N X S X=$S($P(ND(0),U,8)["@":$P($P(ND(0),U,8),"@"),1:$P(ND(0),U,8))
"RTN","PSIVOPT1",52,0)
 S ND=$S($E(P("OT"))="I":$P(ND("PD"),U,1,2)_U,1:"")_$P(ND("PD"),U,3)_U_$S($E(P("OT"))'="I":X_U,1:"")_+$P(ND(0),U,6)_U_$P(ND(0),U,2)_U_$P(ND(0),U,3)
"RTN","PSIVOPT1",53,0)
 S:ND'=($S($E(P("OT"))="I":+P("PD")_U_$G(P("DO"))_U,1:"")_+P("MR")_U_$S($E(P("OT"))'="I":$S(P(8)["@":$P(P(8),"@"),1:P(8))_U,1:"")_+P(6)_U_P(2)_U_P(3)) PSIVCHG=1
"RTN","PSIVOPT1",54,0)
 I 'PSIVCHG I $P(ND(0),U,9)'=P(9) S:(P("DTYP")'=1) PSIVDSFG=1 S PSIVCHG=1
"RTN","PSIVOPT1",55,0)
 ;S ND=$S($E(P("OT"))="I":$P(ND("PD"),U,1,2)_U,1:"")_$P(ND("PD"),U,3)_U_$S($E(P("OT"))'="I":X_U,1:"")_+$P(ND(0),U,6)_U_$P(ND(0),U,2)_U_$P(ND(0),U,3)_U_$P(ND(0),U,9)
"RTN","PSIVOPT1",56,0)
 ;S:ND'=($S($E(P("OT"))="I":+P("PD")_U_$G(P("DO"))_U,1:"")_+P("MR")_U_$S($E(P("OT"))'="I":$S(P(8)["@":$P(P(8),"@"),1:P(8))_U,1:"")_+P(6)_U_P(2)_U_P(3)_U_P(9)) PSIVCHG=1
"RTN","PSIVOPT1",57,0)
 ;* S ND=$S($E(P("OT"))="I":$P(ND("PD"),U,1,2)_U,1:"")_$P(ND("PD"),U,3)_U_$S($E(P("OT"))'="I":$P(ND(0),U,8)_U,1:"")_+$P(ND(0),U,6)_U_$P(ND(0),U,2)_U_$P(ND(0),U,3)_U_$P(ND(0),U,9)
"RTN","PSIVOPT1",58,0)
 ;* S:ND'=($S($E(P("OT"))="I":+P("PD")_U_$G(P("DO"))_U,1:"")_+P("MR")_U_$S($E(P("OT"))'="I":P(8)_U,1:"")_+P(6)_U_P(2)_U_P(3)_U_P(9)) PSIVCHG=1
"RTN","PSIVOPT1",59,0)
 Q
"RTN","PSIVOPT1",60,0)
 ;
"RTN","PSIVOPT1",61,0)
UPDATE ; Update original order.
"RTN","PSIVOPT1",62,0)
 I '$G(PSJSYSP) N PSJSYSP S PSJSYSP=$S($G(DUZ):DUZ,1:$J)
"RTN","PSIVOPT1",63,0)
 N PSJIBDT,PSJINIV S PSJINIV=0
"RTN","PSIVOPT1",64,0)
 S PSIVALT=1,PSIVALCK="EN",PSIVREA="E",ON=ON55 K P("OLDON") D LOG^PSIVORAL
"RTN","PSIVOPT1",65,0)
 D SET55^PSIVORFB I $G(P("NUMLBL")) S $P(^PS(55,DFN,"IV",+ON55,11),"^")=$G(P("NUMLBL")) K P("NUMLBL")
"RTN","PSIVOPT1",66,0)
 D PSBPOIV^PSJIBAG(DFN,ON55,,.PSJINIV)
"RTN","PSIVOPT1",67,0)
 D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,"E")
"RTN","PSIVOPT1",68,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN K X Q:'PSJIVORF
"RTN","PSIVOPT1",69,0)
 S PSJORIFN=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,21) Q:'PSJORIFN
"RTN","PSIVOPT1",70,0)
 S P("NAT")=""
"RTN","PSIVOPT1",71,0)
 D EN1^PSJHL2(DFN,"XX",+ON55_"V","UPDATED ORDER")
"RTN","PSIVOPT1",72,0)
 I $G(PSJINIV),'$G(PSIVCHG) W ! D
"RTN","PSIVOPT1",73,0)
 .N DIR,X,Y,PSJIRPLB S DIR(0)="Y",DIR("B")="NO",DIR("A")="Print new replacement labels",DIR("?")="Enter YES to print new IV labels to replace inactivated IV labels" D ^DIR
"RTN","PSIVOPT1",74,0)
 .I ($G(Y)>0) K DIR S PSJIRPLB=1 D ^PSIVORE1
"RTN","PSIVOPT1",75,0)
 K X
"RTN","PSIVOPT1",76,0)
 Q
"RTN","PSIVOPT1",77,0)
 ;
"RTN","PSIVOPT1",78,0)
NEWORD ; DC orig. order, get new order no.
"RTN","PSIVOPT1",79,0)
 N PSJIBDT S PSJIBDT=1
"RTN","PSIVOPT1",80,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN I PSJIVORF D NATURE^PSIVOREN I '$D(P("NAT")) S X=1 W !,"Order unchanged." Q
"RTN","PSIVOPT1",81,0)
 S P("RES")="E",P("OLDON")=$S($G(PSIVCOPY)=2:"",1:ON55),P(16)="" ; INC000000801240 / MWA (VMP)
"RTN","PSIVOPT1",82,0)
 Q:$$NONVF()
"RTN","PSIVOPT1",83,0)
 I '($G(PSIVCOPY)=2) K ON55 D NEW55^PSIVORFB
"RTN","PSIVOPT1",84,0)
 S (P("PON"),P("NEWON"),ON)=ON55,ON55=P("OLDON") S:($G(PSIVCOPY)=2) P("OLDON")=""
"RTN","PSIVOPT1",85,0)
 I $P($G(^PS(55,DFN,"IV",+P("OLDON"),0)),U,17)="A" D D1^PSIVOPT2 D
"RTN","PSIVOPT1",86,0)
 . I PSJIVORF,$P($G(^PS(55,DFN,"IV",+ON55,0)),U,21) D EN1^PSJHL2(DFN,"OD",+ON55_"V","ORDER DISCONTINUED")
"RTN","PSIVOPT1",87,0)
 . S P("21FLG")="" W !!,"Original order discontinued...",!!
"RTN","PSIVOPT1",88,0)
 . D UNL^PSSLOCK(DFN,+ON55_"V")
"RTN","PSIVOPT1",89,0)
 F ON55=P("NEWON"),P("OLDON") K DA,DIE,DR D
"RTN","PSIVOPT1",90,0)
 .S DA(1)=DFN,DA=+ON55,DIE="^PS(55,"_DFN_",""IV"",",DR=$S((ON55=P("NEWON")&(+ON55'=+P("OLDON"))):"113////"_P("OLDON")_";122////E",1:"114////"_P("NEWON")_";123////E") D ^DIE
"RTN","PSIVOPT1",91,0)
 .I ON55=P("NEWON") N CLINAPPT S CLINAPPT=$G(^PS(55,DFN,"IV",+P("OLDON"),"DSS")) D
"RTN","PSIVOPT1",92,0)
 ..S:CLINAPPT DR=DR_";136////"_+CLINAPPT S:$P(CLINAPPT,"^",2) DR=DR_";139////"_$P(CLINAPPT,"^",2)
"RTN","PSIVOPT1",93,0)
 .D ^DIE
"RTN","PSIVOPT1",94,0)
 .Q:ON55=P("OLDON")&($P($G(^PS(55,DFN,"IV",+P("OLDON"),0)),U,17)'="D")
"RTN","PSIVOPT1",95,0)
 .D:ON55=P("NEWON") SET55^PSIVORFB
"RTN","PSIVOPT1",96,0)
 .D:ON55=P("NEWON") VF1^PSJLIACT("","",0)
"RTN","PSIVOPT1",97,0)
 .D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,$S(ON55=P("NEWON"):"N",1:"DE"))
"RTN","PSIVOPT1",98,0)
 .S PSIVREA="E",PSIVAL="Order "_$S(ON55=P("OLDON"):"discontinued",1:"created")_" due to edit" S:ON55=P("OLDON") PSIVALCK="STOP" D LOG^PSIVORAL
"RTN","PSIVOPT1",99,0)
 L -^PS(55,DFN,"IV",+P("OLDON")) ;D NEWENT^PSIVORFE
"RTN","PSIVOPT1",100,0)
 K X S ON55=P("NEWON"),P(17)="A" Q:'PSJIVORF  D SET^PSIVORFE
"RTN","PSIVOPT1",101,0)
 Q
"RTN","PSIVOPT1",102,0)
 ;
"RTN","PSIVOPT1",103,0)
NEWSTOP ; Set stop date for DC and renewals.
"RTN","PSIVOPT1",104,0)
 S ND=$G(^PS(55,DFN,"IV",+ON55,0)),Y=+$P(ND,U,3),$P(^PS(55,DFN,"IV",+P("OLDON"),2),U,7)=Y,NSTOP=$S(NSTOP>Y:Y,1:NSTOP),$P(^PS(55,DFN,"IV",+ON55,0),U,3)=NSTOP
"RTN","PSIVOPT1",105,0)
 K DA,DIK S DIK="^PS(55,"_DFN_",""IV"",",DA(1)=DFN,DA=+P("OLDON") D IX^DIK K DA,DIK
"RTN","PSIVOPT1",106,0)
 Q
"RTN","PSIVOPT1",107,0)
NONVF()   ;
"RTN","PSIVOPT1",108,0)
 NEW PSGOEAV S PSGOEAV=+$P(PSJSYSP0,U,9)
"RTN","PSIVOPT1",109,0)
 I +PSJSYSU=3,PSGOEAV Q 0
"RTN","PSIVOPT1",110,0)
 I +PSJSYSU=1,PSGOEAV Q 0
"RTN","PSIVOPT1",111,0)
 K DA D ENGNN^PSGOETO S (ON,P("NEWON"))=DA_"P",P(17)="N"
"RTN","PSIVOPT1",112,0)
 S (P("DO"),P("PD"))=""
"RTN","PSIVOPT1",113,0)
 D GTPD^PSIVORE2,PUT531^PSIVORFA
"RTN","PSIVOPT1",114,0)
 I $P($G(^PS(55,DFN,"IV",+P("OLDON"),0)),U,17)="A" D D1^PSIVOPT2 D
"RTN","PSIVOPT1",115,0)
 . I PSJIVORF,$P($G(^PS(55,DFN,"IV",+P("OLDON"),0)),U,21) D EN1^PSJHL2(DFN,"OD",+ON55_"V","ORDER DISCONTINUED")
"RTN","PSIVOPT1",116,0)
 . S P("21FLG")="" W !!,"Original order discontinued...",!!
"RTN","PSIVOPT1",117,0)
 . D UNL^PSSLOCK(DFN,+P("OLDON")_"V")
"RTN","PSIVOPT1",118,0)
 F ON55=P("NEWON"),P("OLDON") K DA,DIE,DR D
"RTN","PSIVOPT1",119,0)
 . S DA=+ON55
"RTN","PSIVOPT1",120,0)
 . S:ON55=P("NEWON") DIE="^PS(53.1,",DR="104////"_P("OLDON")_";103////E"
"RTN","PSIVOPT1",121,0)
 . S:ON55=P("OLDON") DA(1)=DFN,DIE="^PS(55,"_DFN_",""IV"",",DR="114////"_P("NEWON")_";123////E"
"RTN","PSIVOPT1",122,0)
 . D ^DIE
"RTN","PSIVOPT1",123,0)
 . Q:ON55=P("OLDON")&($P($G(^PS(55,DFN,"IV",+P("OLDON"),0)),U,17)'="D")
"RTN","PSIVOPT1",124,0)
 . I ON55=P("OLDON") D
"RTN","PSIVOPT1",125,0)
 .. D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,$S(ON55=P("NEWON"):"N",1:"DE"))
"RTN","PSIVOPT1",126,0)
 .. S PSIVALT="",PSIVREA="E",PSIVAL="Order discontinued due to edit" S PSIVALCK="STOP" D LOG^PSIVORAL
"RTN","PSIVOPT1",127,0)
 . I ON55=P("NEWON") D NEWNVAL^PSGAL5(ON55,4100,"","") I $G(PSJIBDT)?7N1"."1.N D NEWNVAL^PSGAL5(ON55,6000,"LABEL INVALID DATE",PSJIBDT)
"RTN","PSIVOPT1",128,0)
 L -^PS(55,DFN,"IV",+P("OLDON"))
"RTN","PSIVOPT1",129,0)
 K X S (ON,ON55)=P("NEWON")
"RTN","PSIVOPT1",130,0)
 D EN1^PSJHL2(DFN,"SN",ON,"ORDER CREATED")
"RTN","PSIVOPT1",131,0)
 S X=$$LS^PSSLOCK(DFN,ON)
"RTN","PSIVOPT1",132,0)
 D GT531^PSIVORFA(DFN,ON)
"RTN","PSIVOPT1",133,0)
 I ON["P" N CLINAPPT S CLINAPPT=$G(^PS(55,DFN,"IV",+ON,"DSS")) I CLINAPPT D  K DIE,DA,DR
"RTN","PSIVOPT1",134,0)
 . S:CLINAPPT DR="136////"_+CLINAPPT_";" S:$P(CLINAPPT,"^",2) DR=DR_"139////"_$P(CLINAPPT,"^",2)_";" D ^DIE
"RTN","PSIVOPT1",135,0)
 S VALMBCK="Q"
"RTN","PSIVOPT1",136,0)
 S PSGACT="EL"
"RTN","PSIVOPT1",137,0)
 I P(17)="N",(P("OLDON")=""),(P("CLRK")=DUZ) S PSGACT="ELD"
"RTN","PSIVOPT1",138,0)
 I +PSJSYSU=3!(+PSJSYSU=1) S PSGACT="DELV"
"RTN","PSIVOPT1",139,0)
 Q 1
"RTN","PSIVORAL")
0^46^B19483553^B19351743
"RTN","PSIVORAL",1,0)
PSIVORAL ;BIR/MLM-ACTIVITY LOGGER FOR PHARMACY EDITS ;16 DEC 97 / 1:40 PM 
"RTN","PSIVORAL",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**58,135,267,279**;16 DEC 97;Build 150
"RTN","PSIVORAL",3,0)
 ;
"RTN","PSIVORAL",4,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVORAL",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVORAL",6,0)
 ;
"RTN","PSIVORAL",7,0)
EN ; Entry point for updating activity log from Pharmacy.
"RTN","PSIVORAL",8,0)
 ;
"RTN","PSIVORAL",9,0)
 D OPI
"RTN","PSIVORAL",10,0)
 ;
"RTN","PSIVORAL",11,0)
REMARKS ; Record changes to remarks.
"RTN","PSIVORAL",12,0)
 I $G(^PS(55,DFN,"IV",+ON55,1))'=P("REM") S P("FC")="REMARKS^"_$G(^(1))_U_P("REM") D GTFC
"RTN","PSIVORAL",13,0)
 ;
"RTN","PSIVORAL",14,0)
ADMIN ; Record changes to admin. times.
"RTN","PSIVORAL",15,0)
 I $P($G(^PS(55,DFN,"IV",+ON55,0)),U,11)'=P(11) S P("FC")="ADMINISTRATION TIMES^"_$P($G(^(0)),U,11)_U_P(11) D GTFC
"RTN","PSIVORAL",16,0)
 ;
"RTN","PSIVORAL",17,0)
INFUS ; Record changes to infusion rate.
"RTN","PSIVORAL",18,0)
 I $P($G(^PS(55,DFN,"IV",+ON55,0)),U,8)'=P(8) S P("FC")="INFUSION RATE^"_$P($G(^(0)),U,8)_U_P(8) D GTFC
"RTN","PSIVORAL",19,0)
 D:P("DTYP")=1 SOL
"RTN","PSIVORAL",20,0)
 ;
"RTN","PSIVORAL",21,0)
STOP ; Record changes to stop date.
"RTN","PSIVORAL",22,0)
 I $P(^PS(55,DFN,"IV",+ON55,0),U,3)'=P(3) S P("FC")="STOP DATE/TIME^",Y=$P(^(0),U,3) X ^DD("DD") S $P(P("FC"),U,3)=$P(Y,"@")_" "_$P(Y,"@",2),Y=P(3) X ^DD("DD") S $P(P("FC"),U,2)=$P(Y,"@")_" "_$P(Y,"@",2) D GTFC
"RTN","PSIVORAL",23,0)
 K DRGI,DRGN,TDRG,P("AGE"),P("FC")
"RTN","PSIVORAL",24,0)
 Q
"RTN","PSIVORAL",25,0)
 ;
"RTN","PSIVORAL",26,0)
SOL ; Record changes to Solutions.
"RTN","PSIVORAL",27,0)
 K TDRG F DRGI=0:0 S DRGI=$O(DRG("SOL",DRGI)) Q:'DRGI  S TDRG("NEW",$P(DRG("SOL",DRGI),U))=$P(DRG("SOL",DRGI),U,2,3)
"RTN","PSIVORAL",28,0)
 S P("AGE")="NEW"
"RTN","PSIVORAL",29,0)
 F DRGI=0:0 S DRGI=$O(^PS(55,DFN,"IV",+ON55,"SOL",DRGI)) Q:'DRGI  S X=$G(^PS(55,DFN,"IV",+ON55,"SOL",DRGI,0)),DRG=+$P(X,U),TDRG("OLD",+DRG)=$P($G(^PS(52.7,DRG,0)),U)_U_$P(X,U,2) D:$G(TDRG("NEW",DRG))'=$G(TDRG("OLD",DRG)) SOL1
"RTN","PSIVORAL",30,0)
 S P("AGE")="OLD" F DRGI=0:0 S DRG=$O(TDRG("NEW",DRG)) Q:'DRG  D:$G(TDRG("NEW",DRG))'=$G(TDRG("OLD",DRG)) SOL1
"RTN","PSIVORAL",31,0)
 Q
"RTN","PSIVORAL",32,0)
 ;
"RTN","PSIVORAL",33,0)
SOL1 ;
"RTN","PSIVORAL",34,0)
 I '$D(TDRG(P("AGE"),DRG)) S P("FC")="SOLUTION^"_$P($G(TDRG("OLD",DRG)),U)_U_$P($G(TDRG("NEW",DRG)),U) D GTFC
"RTN","PSIVORAL",35,0)
 Q:$G(TDRG("NEW",DRG))=$G(TDRG("OLD",DRG))
"RTN","PSIVORAL",36,0)
 S P("FC")="VOLUME^"_$P($G(TDRG("OLD",DRG)),U,2)_$S($G(TDRG("OLD",DRG))]"":" ("_$P($G(^PS(52.7,DRG,0)),U)_")",1:"")_U_$P($G(TDRG("NEW",DRG)),U,2)_$S($G(TDRG("NEW",DRG))]"":" ("_$P($G(^PS(52.7,DRG,0)),U)_")",1:"") D GTFC
"RTN","PSIVORAL",37,0)
 Q
"RTN","PSIVORAL",38,0)
 ;
"RTN","PSIVORAL",39,0)
GTFC ; Create field change entry in activity log.
"RTN","PSIVORAL",40,0)
 N TXTCNT,TXTLN
"RTN","PSIVORAL",41,0)
 S ND=$G(^PS(55,DFN,"IV",+ON55,"A",PSIVLN,1,0)) S:ND="" ND="^55.151^^" S $P(ND,U,3)=$P(ND,U,3)+1,$P(ND,U,4)=$P(ND,U,4)+1,^PS(55,DFN,"IV",+ON55,"A",PSIVLN,1,0)=ND,^PS(55,DFN,"IV",+ON55,"A",PSIVLN,1,$P(ND,U,3),0)=P("FC") K ND
"RTN","PSIVORAL",42,0)
 I $P(P("FC"),U)="OTHER PRINT INFO" D
"RTN","PSIVORAL",43,0)
 .S TXTLN=0 F TXTCNT=0:1 S TXTLN=$O(^PS(55,DFN,"IV",+ON55,10,TXTLN)) Q:'TXTLN  S ^PS(55,DFN,"IV",+ON55,"A",PSIVLN,2,TXTLN,0)=$G(^PS(55,DFN,"IV",+ON55,10,TXTLN,0))
"RTN","PSIVORAL",44,0)
 .I TXTCNT S ^PS(55,DFN,"IV",+ON55,"A",PSIVLN,2,0)="^"_+TXTCNT_"^"_+TXTCNT
"RTN","PSIVORAL",45,0)
 .S TXTLN=0 F TXTCNT=0:1 S TXTLN=$O(^PS(53.45,+$G(PSJSYSP),6,TXTLN)) Q:'TXTLN  S ^PS(55,DFN,"IV",+ON55,"A",PSIVLN,3,TXTLN,0)=$G(^PS(53.45,+$G(PSJSYSP),6,TXTLN,0))
"RTN","PSIVORAL",46,0)
 .I TXTCNT S ^PS(55,DFN,"IV",+ON55,"A",PSIVLN,3,0)="^"_+TXTCNT_"^"_+TXTCNT S ^PS(53.45,+$G(PSJSYSP),6)=PSIVLN
"RTN","PSIVORAL",47,0)
 .N ACNT,AND S ACNT=+$O(^PS(55,DFN,"IV",+ON55,"A",""),-1) I ACNT S AND="^55.04^"_+ACNT_"^"_+ACNT,^PS(55,DFN,"IV",+ON55,"A",0)=AND
"RTN","PSIVORAL",48,0)
 K ND
"RTN","PSIVORAL",49,0)
 Q
"RTN","PSIVORAL",50,0)
LOG ; Update activity log (ask for comment.)
"RTN","PSIVORAL",51,0)
 D SETNML55^PSIVORC1
"RTN","PSIVORAL",52,0)
 I $G(P("FC"))["OTHER PRINT INFO" Q:$G(^PS(53.45,+$G(PSJSYSP),6))
"RTN","PSIVORAL",53,0)
 N ON S ON=ON55
"RTN","PSIVORAL",54,0)
 ;PSJPINIT is defined in PSJUTL3.
"RTN","PSIVORAL",55,0)
 S:+$G(PSJPINIT)'>0 PSJPINIT=DUZ
"RTN","PSIVORAL",56,0)
 I $G(PSIVALT)=1,'$G(PSJUNDC) K DA,DIR S DIR(0)="55.04,.04" D ^DIR K DA,DIR S PSIVAL=$S($D(DIRUT):"",1:Y)
"RTN","PSIVORAL",57,0)
 S:$G(PSIVALT)=2 PSIVAL="Action taken using OE/RR options." D ENTACT^PSIVAL
"RTN","PSIVORAL",58,0)
 K TMP
"RTN","PSIVORAL",59,0)
 S TMP(55.04,""_PSIVLN_","_+ON55_","_DFN_","_"",.02)=PSIVREA
"RTN","PSIVORAL",60,0)
 S TMP(55.04,""_PSIVLN_","_+ON55_","_DFN_","_"",.03)=$P(^VA(200,PSJPINIT,0),U)
"RTN","PSIVORAL",61,0)
 S TMP(55.04,""_PSIVLN_","_+ON55_","_DFN_","_"",.04)=$G(PSIVAL)
"RTN","PSIVORAL",62,0)
 S TMP(55.04,""_PSIVLN_","_+ON55_","_DFN_","_"",.06)=PSJPINIT
"RTN","PSIVORAL",63,0)
 D FILE^DIE("","TMP")
"RTN","PSIVORAL",64,0)
 K TMP
"RTN","PSIVORAL",65,0)
 D:$D(PSIVALCK) @PSIVALCK K PSIVALT,PSIVALCK,PSIVAL
"RTN","PSIVORAL",66,0)
 Q
"RTN","PSIVORAL",67,0)
 ;
"RTN","PSIVORAL",68,0)
OPI ; Record changes to Other print info.
"RTN","PSIVORAL",69,0)
 I $$DIFFOPI^PSJBCMA5(DFN,ON55) S P("FC")="OTHER PRINT INFO^^" D GTFC
"RTN","PSIVORAL",70,0)
 Q
"RTN","PSIVORC1")
0^17^B79901460^B54564779
"RTN","PSIVORC1",1,0)
PSIVORC1 ;BIR/MLM-PROCESS INCOMPLETE IV ORDER - CONT ;13 Jan 98 / 11:36 AM
"RTN","PSIVORC1",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**1,37,69,110,157,134,181,263,270,279**;16 DEC 97;Build 150
"RTN","PSIVORC1",3,0)
 ;
"RTN","PSIVORC1",4,0)
 ; Reference to ^DD("DD" is supported by DBIA 10017.
"RTN","PSIVORC1",5,0)
 ; Reference to ^DD( is supported by DBIA 2255.
"RTN","PSIVORC1",6,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSIVORC1",7,0)
 ; Reference to ^%DT is supported by DBIA 10003.
"RTN","PSIVORC1",8,0)
 ; Reference to ^%DTC is supported by DBIA 10000.
"RTN","PSIVORC1",9,0)
 ; Reference to ^DID is supported by DBIA 2052.
"RTN","PSIVORC1",10,0)
 ; Reference to ^VALM is supported by DBIA 10118.
"RTN","PSIVORC1",11,0)
 ; Reference to ^PS(51.1 supported by DBIA #2177.
"RTN","PSIVORC1",12,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSIVORC1",13,0)
 ;
"RTN","PSIVORC1",14,0)
53 ; IV Type
"RTN","PSIVORC1",15,0)
 I $G(PSGORD)["P",$G(PSGAT),($G(P(9))]"") D
"RTN","PSIVORC1",16,0)
 .N X,PSGS0Y,ZZ,LYN,ZZND,ZZNDW S X=P(9) S PSGS0Y="",ZZ=0 D FIND^DIC(51.1,,,,X,,"APPSJ",,,"LYN")
"RTN","PSIVORC1",17,0)
 .S ZZ=$O(LYN("DILIST",2,ZZ)) I ZZ S ZZ=+LYN("DILIST",2,ZZ) I ZZ S ZZND=$G(^PS(51.1,ZZ,0)) S PSGST=$P(ZZND,U,5),PSGS0XT=$P(ZZND,U,3) I $G(PSJPWD) D
"RTN","PSIVORC1",18,0)
 ..N ZZNDW S ZZNDW=$G(^PS(51.1,ZZ,1,PSJPWD,0)) I $P(ZZNDW,"^",2)]"" S PSGS0Y=$P(ZZNDW,"^",2),$P(ZZND,"^",2)=PSGS0Y
"RTN","PSIVORC1",19,0)
 .S ZZ=0 F  S ZZ=$O(LYN("DILIST",1,ZZ)) Q:'ZZ  I $G(LYN("DILIST",1,ZZ))'=X K LYN("DILIST",1,ZZ),LYN("DILIST",2,ZZ),LYN("DILIST","ID",ZZ,1)
"RTN","PSIVORC1",20,0)
 .I $D(PSJPWD) S ZZ=0 F  S ZZ=$O(LYN("DILIST",2,ZZ)) Q:'ZZ  I $P($G(^PS(51.1,+LYN("DILIST",2,ZZ),1,+PSJPWD,0)),U,2)]"" S PSGS0Y=$P($G(^(0)),U,2)
"RTN","PSIVORC1",21,0)
 .I '$G(PSGS0Y) S ZZ=0 F  S ZZ=$O(LYN("DILIST",2,ZZ)) Q:'ZZ  Q:PSGS0Y]""  I $G(LYN("DILIST","ID",ZZ,1))]"" S PSGS0Y=$G(LYN("DILIST","ID",ZZ,1))
"RTN","PSIVORC1",22,0)
 .Q:(PSGS0Y=PSGAT)!'$G(PSGS0Y)!($G(IVCAT)="C")
"RTN","PSIVORC1",23,0)
 .S PSGNSTAT=1 W $C(7),!!,"PLEASE NOTE:  This order's admin times (",PSGAT,")"
"RTN","PSIVORC1",24,0)
 .W !?13," do not match the ward times (",PSGS0Y,")"
"RTN","PSIVORC1",25,0)
 .W !?13," for this administration schedule (",P(9),")",!
"RTN","PSIVORC1",26,0)
 .S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR K DIR  W !
"RTN","PSIVORC1",27,0)
 S DONE=0 N DIR S DIR(0)="SNA^A:ADMIXTURE;C:CHEMOTHERAPY;H:HYPERAL;P:PIGGYBACK;S:SYRINGE",DIR("A")="IV TYPE: "
"RTN","PSIVORC1",28,0)
 I $G(P("RES"))'="R",$G(PSGORD)["P" N IVCAT,IVTYPTMP S IVCAT=$P($G(^PS(53.1,+PSGORD,2.5)),"^",5) S IVTYPTMP=$S((P(9)]""):"P",$G(P(5)):"P",$G(P(23))="P":"P",1:"")
"RTN","PSIVORC1",29,0)
 S DIR("B")=$S($G(IVCAT)="C"!($G(IVTYPTMP)="A"):"ADMIXTURE",$G(IVCAT)="I"!($G(IVTYPTMP)="P"):"PIGGYBACK",1:"ADMIXTURE")
"RTN","PSIVORC1",30,0)
 D DIRQ,^DIR S:$D(DTOUT)!(X="^") DONE=1 Q:DONE  G:$E(X)="^" 53 S P(4)=Y D:"CS"[P(4) @P(4)
"RTN","PSIVORC1",31,0)
 ;*PSJ*5*270 - Remove bottle from IVPB
"RTN","PSIVORC1",32,0)
 N PSG53 I Y="P" D
"RTN","PSIVORC1",33,0)
 .N ADCNT,PSGBTL F ADCNT=0:0 S ADCNT=$O(^PS(53.1,+PSGORD,"AD",ADCNT)) Q:('ADCNT)!$G(PSGBTL)  D
"RTN","PSIVORC1",34,0)
 ..I $P(^PS(53.1,+PSGORD,"AD",ADCNT,0),U,3)]"" S PSGBTL=1
"RTN","PSIVORC1",35,0)
 .I '$G(PSGBTL) Q
"RTN","PSIVORC1",36,0)
 .W !!,"A bottle value is not allowed with a Piggyback IV order.  Do you wish to delete the bottle value(s)"
"RTN","PSIVORC1",37,0)
 .S %=1 D YN^DICN I %'=1 S PSG53=1 Q
"RTN","PSIVORC1",38,0)
 .N DIE,DA,DR
"RTN","PSIVORC1",39,0)
 .F ADCNT=0:0 S ADCNT=$O(^PS(53.1,+PSGORD,"AD",ADCNT)) Q:'ADCNT  D
"RTN","PSIVORC1",40,0)
 ..S $P(DRG("AD",ADCNT),U,4)=""
"RTN","PSIVORC1",41,0)
 I $G(PSG53) G 53
"RTN","PSIVORC1",42,0)
 ;*End PSJ*5*270
"RTN","PSIVORC1",43,0)
 N PSGINFAT S PSGINFAT=0 I ((P(4)="P")!$G(P(5))!($G(P(23))="P")) I P(8)["@" D
"RTN","PSIVORC1",44,0)
 .W !!,"Infusion Rate contains ""@"" (not allowed with an Intermittent IV order)",!
"RTN","PSIVORC1",45,0)
 .D 59 S:'(P(8)["@") P("NUMLBL")="" I P(8)["@" S PSGINFAT=1
"RTN","PSIVORC1",46,0)
 I $G(PSGINFAT) G 53
"RTN","PSIVORC1",47,0)
 I PSIVAC'="PN" D ENT^PSIVCAL K %DT S X=P(2),%DT="RTX" D ^%DT S P(2)=+Y D ENSTOP^PSIVCAL K %DT S X=P(3),%DT="RTX" D ^%DT S P(3)=+Y
"RTN","PSIVORC1",48,0)
OTYP ; Get order type, display type.
"RTN","PSIVORC1",49,0)
 S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3) S:PSIVAC'="CF" P("OT")=$S(P(4)="A":"F",P(4)="H":"H",1:"I")
"RTN","PSIVORC1",50,0)
 Q
"RTN","PSIVORC1",51,0)
 ;
"RTN","PSIVORC1",52,0)
C ; Edit Chemo order
"RTN","PSIVORC1",53,0)
 N DIR S DIR(0)="SA^A:ADMIXTURE;P:PIGGYBACK;S:SYRINGE",DIR("A")="CHEMOTHERAPY TYPE: " D DIRQ,^DIR S:$D(DTOUT)!(X=U) DONE=1 Q:$E(X)="^"!(DONE)  S P(23)=Y D:P(23)["S" S
"RTN","PSIVORC1",54,0)
 Q
"RTN","PSIVORC1",55,0)
 ;
"RTN","PSIVORC1",56,0)
S ; Edit Syringe order
"RTN","PSIVORC1",57,0)
56 ; Intermittent Syringe
"RTN","PSIVORC1",58,0)
 N DIR S DIR(0)="Y",DIR("??")="^S F1=53.1,F2=56 D ENHLP^PSIVORC1",DIR("A")="INTERMITTENT SYRINGE" D ^DIR Q:$D(DIRUT)  S P(5)=Y
"RTN","PSIVORC1",59,0)
 ;
"RTN","PSIVORC1",60,0)
55 ; Syringe Size
"RTN","PSIVORC1",61,0)
 N DA,DIR S DIR(0)="53.1,55" D ^DIR I $D(DTOUT)!$D(DUOUT) S DONE=1 Q
"RTN","PSIVORC1",62,0)
 S P("SYRS")=Y
"RTN","PSIVORC1",63,0)
 Q
"RTN","PSIVORC1",64,0)
 ;
"RTN","PSIVORC1",65,0)
DIRQ ; Set DIR("?") for IV Type prompt.
"RTN","PSIVORC1",66,0)
 S DIR("?")="Enter a code from the list above.",DIR("??")="^S F1=55.01,F2="_$S(DIR("A")["CHEMO":106,1:.04)_" D ENHLP^PSIVORC1"
"RTN","PSIVORC1",67,0)
 S DIR("?",1)="CHOOSE FROM:",Y=$P(DIR(0),U,2) F X=1:1:5 S DIR("?",X+1)="              "_$P($P(Y,";",X),":")_"    "_$P($P(Y,";",X),":",2)
"RTN","PSIVORC1",68,0)
 Q
"RTN","PSIVORC1",69,0)
 ;
"RTN","PSIVORC1",70,0)
CKFLDS ; Find required fields missing data.
"RTN","PSIVORC1",71,0)
 NEW PSIVASX,PSIVASY,FIL,DRGTMP
"RTN","PSIVORC1",72,0)
 S EDIT="" F PSIVASX="AD","SOL" D
"RTN","PSIVORC1",73,0)
 .I '$D(DRG(PSIVASX)) S EDIT=EDIT_U_$S(PSIVASX="AD":57,1:58) Q
"RTN","PSIVORC1",74,0)
 .S DNE=0 F PSIVASY=0:0 S PSIVASY=$O(DRG(PSIVASX,PSIVASY)) Q:'PSIVASY!DNE  D
"RTN","PSIVORC1",75,0)
 .. I $P(DRG(PSIVASX,PSIVASY),U,3)="" S EDIT=EDIT_U_$S(PSIVASX="AD":57,1:58),DNE=1
"RTN","PSIVORC1",76,0)
 .. I $P(DRG(PSIVASX,PSIVASY),U,4)="See Comments",(EDIT'["57") S EDIT=EDIT_U_$S(PSIVASX="AD":57,1:58),DNE=1
"RTN","PSIVORC1",77,0)
 S:'P("MR") EDIT=EDIT_U_3 F X=8,6,2,3 I P(X)="" S EDIT=EDIT_U_$S(X=8:59,X=6:1,X=2:10,X=3:25,1:"")
"RTN","PSIVORC1",78,0)
 I P("DTYP")=1 S:P(9)="" EDIT=EDIT_U_26 S:P(11)="" EDIT=EDIT_U_39
"RTN","PSIVORC1",79,0)
 S:$E(EDIT,1)=U EDIT=$E(EDIT,2,999)
"RTN","PSIVORC1",80,0)
 Q
"RTN","PSIVORC1",81,0)
 ;
"RTN","PSIVORC1",82,0)
DONE ; Kill variables and exit
"RTN","PSIVORC1",83,0)
 K ACTION,AD,DFN,DNE,DONE,DONE1,DRG,DRGI,DRGN,DRGT,DRGTN,EDIT,ERR,F1,F2,FIL,HDT,J,LN,LN2,ND,ON,ON1,ON55,ORIFN,P,P16,PC,PDM,PG,PN,PNME,PNOW,PSGLMT,PSGODDD
"RTN","PSIVORC1",84,0)
 K PSGSS,PSGSSH,PSIV,PSIVAC,PSIVAT,PSIVCV,PSIVE,PSIVHD,PSIVLN,PSIVOK,PSIVOLD,PSIVORUT,PSIVREA,PSIVSC1,PSIVSTR,PSIVSTRT,PSIVTYPE,PSIVUP,PSIVX,PSIVX1
"RTN","PSIVORC1",85,0)
 K PSJIVORF,PSJORF,PSJORIFN,PSJORL,PSJORNP,PSJORPF,PSJORSTS,PSJIVOF,PSJNKF,PSJORD,RB,RF,SOL,STOP,TYP,UL80,WD,WDN,WG,^TMP("PSIV",$J) D ENIVKV^PSGSETU
"RTN","PSIVORC1",86,0)
 Q
"RTN","PSIVORC1",87,0)
ENHLP ; order entry fields' help
"RTN","PSIVORC1",88,0)
 N PSJHP,PSJX,PSJD
"RTN","PSIVORC1",89,0)
 ;From within this routine, F1 and F2 will refer to file 53.1,field 56, file 55.01,field 106, or file 55.01,field .04
"RTN","PSIVORC1",90,0)
 D FIELD^DID(F1,F2,"","HELP-PROMPT","PSJHP")
"RTN","PSIVORC1",91,0)
 I X="?",$D(PSJHP("HELP-PROMPT")) S F=$G(PSJHP("HELP-PROMPT")) W !?5 F F0=1:1:$L(F," ") S F3=$P(F," ",F0) W:$L(F3)+$X>78 !?5 W F3_" "
"RTN","PSIVORC1",92,0)
 ;
"RTN","PSIVORC1",93,0)
 W:$D(^DD(F1,F2,12)) !,"("_^(12)_")" D FIELD^DID(F1,F2,"","XECUTABLE HELP","PSJX") I $D(PSJX("XECUTABLE HELP")) X PSJX("XECUTABLE HELP")
"RTN","PSIVORC1",94,0)
 ;
"RTN","PSIVORC1",95,0)
 ; new code
"RTN","PSIVORC1",96,0)
 D FIELD^DID(F1,F2,"","DESCRIPTION","PSJD")
"RTN","PSIVORC1",97,0)
 G:$S($G(X)="?":1,1:'$O(PSJD("DESCRIPTION",0))) SC F F=0:0 S F=$O(PSJD("DESCRIPTION",F)) Q:'F  I $D(PSJD("DESCRIPTION",F)) W !?2,PSJD("DESCRIPTION",F)
"RTN","PSIVORC1",98,0)
SC ;
"RTN","PSIVORC1",99,0)
 I F2=5!(F2=6) W !,"CHOOSE FROM:",!?8,0,?16,"NO",!?8,1,?16,"YES" Q
"RTN","PSIVORC1",100,0)
 Q
"RTN","PSIVORC1",101,0)
COMPLTE ;
"RTN","PSIVORC1",102,0)
 NEW PSIVDSFG S PSIVDSFG=0
"RTN","PSIVORC1",103,0)
 S P16=0,PSIVEXAM=1,(PSIVNOL,PSIVCT)=1 D GTOT^PSIVUTL(P(4)) D ^PSIVCHK I $D(DUOUT) W $C(7),!,"Order Unchanged.",! Q
"RTN","PSIVORC1",104,0)
 G:'$D(PSIVFN1) EDIT1
"RTN","PSIVORC1",105,0)
 I ERR=1 S Y=0 G EDIT1
"RTN","PSIVORC1",106,0)
 D CKORD^PSIVORC2 I $G(PSJFNDS)!$S($G(PSIVDSFG):0,PSIVCHG:1,1:0)!$$INFRATE^PSJMISC(DFN,ON,P(8),P("DTYP")) D
"RTN","PSIVORC1",107,0)
 . K PSJFNDS
"RTN","PSIVORC1",108,0)
 . I $$SEECMENT^PSIVEDRG() S PSGORQF=1 W !!,"*** One or more Additives has an invalid value for the bottle number(s).",! D PAUSE^PSJMISC() Q
"RTN","PSIVORC1",109,0)
 . D IN^PSJOCDS($G(ON),"IV","")
"RTN","PSIVORC1",110,0)
 . Q:$G(PSGORQF)
"RTN","PSIVORC1",111,0)
 . Q:'PSIVCHG
"RTN","PSIVORC1",112,0)
 D NOW^%DTC S P("LOG")=$E(%,1,12),P("CLRK")=DUZ_U_$P($G(^VA(200,DUZ,0)),U),P("INS")=""
"RTN","PSIVORC1",113,0)
 Q:$G(PSGORQF)
"RTN","PSIVORC1",114,0)
 W ! D ^PSIVORLB K PSIVEXAM S Y=P(2)
"RTN","PSIVORC1",115,0)
 W !,"Start date: " X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),?30," Stop date: " S Y=P(3) X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),!
"RTN","PSIVORC1",116,0)
EDIT ;
"RTN","PSIVORC1",117,0)
 I ERR=1 W !,"Please re-edit this order" K DIR S DIR(0)="E" D ^DIR K DIR W:'Y $C(7),"order unchanged." Q:'Y  S Y=0 G EDIT1
"RTN","PSIVORC1",118,0)
 ;PSJ*5*157 EFD FOR IV
"RTN","PSIVORC1",119,0)
 D EFDIV^PSJUTL($G(ZZND))
"RTN","PSIVORC1",120,0)
 W:$G(PSIVCHG) !,"*** This change will cause a new order to be created. ***"
"RTN","PSIVORC1",121,0)
 K DIR S DIR(0)="Y",DIR("A")="Is this O.K.",DIR("B")=$S(ERR:"NO",1:"YES"),DIR("?",1)="Enter ""Y"" to make this an active order (only allowed if no errors were"
"RTN","PSIVORC1",122,0)
 S DIR("?")="found in order), ""N"" to edit the order, or ""^"" to leave order unchanged.",DIR("??")="^S HELP=""EDIT"" D ^PSIVHLP"
"RTN","PSIVORC1",123,0)
 D ^DIR K DIR I $D(DIRUT) K DIRUT W $C(7),"Order unchanged." Q
"RTN","PSIVORC1",124,0)
 ;*  Kill Unit dose variables when calling from ^PSJLIFNI.
"RTN","PSIVORC1",125,0)
 I +Y,$G(PSJLIFNI) D
"RTN","PSIVORC1",126,0)
 . K ND,ND4,ND6,NDP2
"RTN","PSIVORC1",127,0)
 . K PSGAT,PSGCANFL,PSGDI,PSGDO,PSGDT,PSGEB,PSGEBN,PSGEFN,PSGFD,PSGFDN
"RTN","PSIVORC1",128,0)
 . K PSGHSM,PSGLI,PSGLIN,PSGLMT,PSGMR,PSGMRN,PSGNEDFD,PSGNEF,PSGNEFD
"RTN","PSIVORC1",129,0)
 . K PSGNESD,PSGOAT,PSGODO,PSGODT,PSGEA,PSGOEAV,PSGOEEF
"RTN","PSIVORC1",130,0)
 . K PSGOEEWF,PSGOEEG,PSGOEF,PSGOENG,PSGOES,PSGOFD,PSGOFDN,PSGOHSM
"RTN","PSIVORC1",131,0)
 . K PSGOINST,PSGOMR,PSGOMRN,PSGONC
"RTN","PSIVORC1",132,0)
 . K PSGOPD,PSOPDN,PSGOPR,PSGOPRN,PSGOSD,PSGOSDN,PSGOSI,PSGOSM
"RTN","PSIVORC1",133,0)
 . K PSGOST,PSGOSTN
"RTN","PSIVORC1",134,0)
 . K PSGPD,PSGPDN,PSGPDRG,PSGDRGN,PSGPFLG,PSGPI,PSGPR,PSGPRIO,PSGPRN
"RTN","PSIVORC1",135,0)
 . K PSGPTMP,PSGRRF,PSG0XT,PSGS0Y,PSGSCH,PSGSD,PSGSDN,PSGSI,PSGSM
"RTN","PSIVORC1",136,0)
 . K PSGST,PSGSTAT,PSGSTN,PSJACNWP,PSJACOK,PSJCOI
"RTN","PSIVORC1",137,0)
EDIT1 ;
"RTN","PSIVORC1",138,0)
 NEW XFLG,PSIVY S PSIVY=$G(Y)
"RTN","PSIVORC1",139,0)
 NEW X S X=$G(^TMP("PSJI",$J,0)),VALMBG=$S((X<17):1,1:(X-(X#16)))
"RTN","PSIVORC1",140,0)
 N PSINVON S PSINVON=ON I PSINVON["P" N PRVON S PRVON=$P($G(^PS(53.1,+ON,0)),"^",25) I PRVON["V" S PSINVON=PRVON
"RTN","PSIVORC1",141,0)
 I PSIVY=0!'$G(PSIVFN1) S PSIVFN1=1 D EN^VALM("PSJ LM IV AC/EDIT") Q
"RTN","PSIVORC1",142,0)
 S PSIVCHG=0 D EDCHK^PSIVORC2 K PSIVCHG I $G(PSJCOM) S ^TMP("PSJCOM",$J,+ON,17)=$G(P("NUMLBL")) K P("NUMLBL")
"RTN","PSIVORC1",143,0)
 S VALMBCK="Q",PSIVACEP=1
"RTN","PSIVORC1",144,0)
 Q
"RTN","PSIVORC1",145,0)
59 ; Infusion Rate
"RTN","PSIVORC1",146,0)
 N P8BADDEF S P8BADDEF=0
"RTN","PSIVORC1",147,0)
 I $G(P("RES"))="R" I $G(ON)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVORC1",148,0)
 . Q:'$G(PSIVRENW)  W !!?5,"This is a Renewal Order. Infusion Rate may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVORC1",149,0)
 W !,"INFUSION RATE: ",$G(P(8))_"//" R X:DTIME S:'$T X=U S:X=U DONE=1 I $S($E(X)=U:1,X]"":0,1:'(P(8)["@")) D:'$G(DONE) EXPINF^PSIVEDT1(.X) G:$G(P8BADDEF) 59 Q
"RTN","PSIVORC1",150,0)
 I (("C^P"[P(4))!(("C^S"[P(4))&(P(5)=1)))&((X["@")!((X="")&(P(8)["@"))) D  G 59
"RTN","PSIVORC1",151,0)
 .W $C(7),!!?2,"'@' is not permitted for Intermittent IV's",!
"RTN","PSIVORC1",152,0)
 I (X["^") D  G 59
"RTN","PSIVORC1",153,0)
 .W $C(7),!!?2,"'^' is not permitted",!
"RTN","PSIVORC1",154,0)
 I X=""&(("C^P"[P(4))!(("C^S"[P(4))&(P(5)=1))) Q
"RTN","PSIVORC1",155,0)
 I X="@" D DEL^PSIVEDRG S:%=1 P(8)="" G 59
"RTN","PSIVORC1",156,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS^PSIVEDT1 G 59
"RTN","PSIVORC1",157,0)
 I X["?" S F1=53.1,F2=59 D ENHLP^PSIVORC1 G 59
"RTN","PSIVORC1",158,0)
 D EXPINF^PSIVEDT1(.X)
"RTN","PSIVORC1",159,0)
 I ($L(X)>30!($L(X)=1)),(X'?1N) D  G 59
"RTN","PSIVORC1",160,0)
 .W $C(7),!!?3,"Free text entries must contain a minimum of 2 characters",!?3,"and a maximum of 30 characters",!
"RTN","PSIVORC1",161,0)
 I X]"" D ENI^PSIVSP W:'$D(X) $C(7)," ??" G:'$D(X) 59 S P(8)=X
"RTN","PSIVORC1",162,0)
 I P(8)="" W $C(7),!!,"An infusion rate must be entered!" G 59
"RTN","PSIVORC1",163,0)
 Q
"RTN","PSIVORC1",164,0)
PSBPOIV ; Invalid IV bags based on BCMA IV parameters
"RTN","PSIVORC1",165,0)
 Q:'$G(DFN)  Q:'$G(ON55)  Q:'($G(ON55)["V")  Q:'$D(^PS(55,DFN,"IV",+ON55,0))
"RTN","PSIVORC1",166,0)
 I $P($G(^PS(55,DFN,"IV",+ON55,2)),"^",5)!($G(P("RES"))="R")!($G(P("FRES"))="R") D PSBPOIV^PSJIBAG(DFN,ON55)
"RTN","PSIVORC1",167,0)
 Q
"RTN","PSIVORC1",168,0)
 ;
"RTN","PSIVORC1",169,0)
SETNML55 ; Set NUMBER OF LABELS into ^PS(55,DFN,"IV",+ON55,0
"RTN","PSIVORC1",170,0)
 ;          Added to PROTOCOL PSJI LM VERIFY after call to VF^PSJLIACT
"RTN","PSIVORC1",171,0)
 ;          Made necessary by 11th hour code conflicts caused by MOCHA 2.0
"RTN","PSIVORC1",172,0)
 Q:'$D(P("NUMLBL"))  Q:'$G(DFN)  Q:'($G(ON55)["V")  Q:'$G(^PS(55,DFN,"IV",+ON55,0))
"RTN","PSIVORC1",173,0)
 S $P(^PS(55,DFN,"IV",+ON55,11),"^",1)=$G(P("NUMLBL"))
"RTN","PSIVORC1",174,0)
 Q
"RTN","PSIVORC1",175,0)
SETNL531 ;  Set NUMBER OF LABELS into ^PS(53.1,+PSGORD,8
"RTN","PSIVORC1",176,0)
 ;          Added to PROTOCOL PSJI LM VERIFY after call to VF^PSJLIACT
"RTN","PSIVORC1",177,0)
 ;          Made necessary by 11th hour code conflicts caused by MOCHA 2.0
"RTN","PSIVORC1",178,0)
 Q:'$D(P("NUMLBL"))  Q:'$G(DFN)  Q:'$G(PSGORD)  Q:'$G(PS(53.1,+PSGORD,0))  ; $D is intentional - may edit from something to nothing
"RTN","PSIVORC1",179,0)
 S $P(^PS(53.1,+PSGORD,17),"^",1)=$G(P("NUMLBL"))
"RTN","PSIVORC1",180,0)
 Q
"RTN","PSIVORE1")
0^43^B25786480^B25223179
"RTN","PSIVORE1",1,0)
PSIVORE1 ;BIR/RGY,PR,MLM-ACT,NEW ORDER ;07 AUG 97 / 2:45 PM
"RTN","PSIVORE1",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**58,110,127,133,279**;16 DEC 97;Build 150
"RTN","PSIVORE1",3,0)
 ;
"RTN","PSIVORE1",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVORE1",5,0)
 ;
"RTN","PSIVORE1",6,0)
S ;
"RTN","PSIVORE1",7,0)
 Q:+PSJSYSU'=3
"RTN","PSIVORE1",8,0)
 D PSBPOIV^PSIVORC1
"RTN","PSIVORE1",9,0)
 I $G(PSJCOM) D SETNML55^PSIVORC1
"RTN","PSIVORE1",10,0)
 I $G(ON),$G(DFN) N RNDT,OP2 S RNDT=+$$LASTREN^PSJLMPRI(DFN,ON) I RNDT D
"RTN","PSIVORE1",11,0)
 .N PSGSA,CD S OD=P(2),CD=P(3) D ENP3^PSIVWL
"RTN","PSIVORE1",12,0)
 .N NEXTX,DL,NXTLBL,DAY,LBLPC,BEG,OLDX S NXTLBL=0 S DAY=0,BEG=$P(+PSGSA,".") F LBLPC=1:1:$L(PSGSA," ") S OLDX=$G(NEXTX) S NEXTX=$P(PSGSA," ",LBLPC) D
"RTN","PSIVORE1",13,0)
 ..S:LBLPC=1 OLDX=NEXTX S:$E($P(NEXTX,".",2),1,2)<$E($P($G(OLDX),".",2),1,2) DAY=DAY+1 S DAY($$FMADD^XLFDT(BEG,DAY)_"."_$P(NEXTX,".",2))=LBLPC
"RTN","PSIVORE1",14,0)
 .S D=0 F  S D=$O(DAY(D)) Q:'D!$G(NXTLBL)  D
"RTN","PSIVORE1",15,0)
 ..I D>RNDT S NXTLBL=D
"RTN","PSIVORE1",16,0)
 .I $G(NXTLBL) S OP2=P(2) S (OD,P(2))=NXTLBL Q
"RTN","PSIVORE1",17,0)
 .S (OD,P(2))=RNDT
"RTN","PSIVORE1",18,0)
 ;
"RTN","PSIVORE1",19,0)
 D NOW^%DTC S Y=% Q:P(4)=""!(P(2)="")  S:'$D(OD) OD=$S(P(2)>Y:P(2),1:Y) S PSGCNT=0,PNOW=DT K PSGSA
"RTN","PSIVORE1",20,0)
STR ;
"RTN","PSIVORE1",21,0)
 ;
"RTN","PSIVORE1",22,0)
 K PSI F I=0:0 S I=$O(^PS(59.5,PSIVSN,2,"AC",P(4),I)) Q:'I  S PSI("E",+(PNOW_"."_$P(^PS(59.5,+PSIVSN,2,I,0),U,4)))=+(PNOW_"."_$P(^(0),U))_U_I,PSI("S",+(PNOW_"."_$P(^(0),U)))=I
"RTN","PSIVORE1",23,0)
 ;
"RTN","PSIVORE1",24,0)
EC ;
"RTN","PSIVORE1",25,0)
 S PSIVEC=$O(PSI("E",Y)) I PSIVEC="" S X1=PNOW,X2=1 D C^%DTC S PNOW=X G STR
"RTN","PSIVORE1",26,0)
 I $O(PSI("S",PSIVEC))="" S X1=$O(PSI("S",0)),X2=1 D C^%DTC S X=$P(X,".") S PSI("S",+(X_"."_$P($O(PSI("S",0)),".",2)))=PSI("S",$O(PSI("S",0)))
"RTN","PSIVORE1",27,0)
 I $P(^PS(59.5,+PSIVSN,2,PSI("S",$O(PSI("S",PSIVEC))),0),U,6)=$O(PSI("S",PSIVEC)) S Y=PSIVEC G EC
"RTN","PSIVORE1",28,0)
 I PSIVEC'<P(2) S CD=$S(P(3)>PSIVEC:PSIVEC,1:P(3)) S:OD=CD CD=CD+.0001 D ENP3^PSIVWL
"RTN","PSIVORE1",29,0)
P ;
"RTN","PSIVORE1",30,0)
 S:'$D(PSGSA) PSGSA=""
"RTN","PSIVORE1",31,0)
 D FULL^VALM1
"RTN","PSIVORE1",32,0)
 W:PSGCNT !!,PSGCNT," Label",$E("s",PSGCNT>1)," needed for dose",$E("s",PSGCNT>1)," due at ...",!!
"RTN","PSIVORE1",33,0)
 F Y=1:1 S X=$P(PSGSA," ",Y) S:$E(X)="." X=$$CONVER^PSIVORE2(X,Y) Q:X=""  W $E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)_" "_$E(X#1_"000",2,5)_" : "
"RTN","PSIVORE1",34,0)
 W ! D:$P(PSIVSITE,U,8) TL^PSIVORE2 D NOW^%DTC S Y=% S PNOW=Y I $D(^PS(59.5,PSIVSN,3,"AT")) W !!,"Next delivery time is " S X=$O(^PS(59.5,PSIVSN,3,"AT",PNOW#1)) S:X="" X=$O(^(X)) S X=$P(X,".",2)_$E("000",1,5-$L(X)) W X," ***" G B1
"RTN","PSIVORE1",35,0)
ACT ; Prompt and process label action.
"RTN","PSIVORE1",36,0)
B I PSGCNT<1 S:($G(RNDT)&$G(OP2)) P(2)=OP2 G K^PSIVORE2
"RTN","PSIVORE1",37,0)
B1 ;
"RTN","PSIVORE1",38,0)
 W ! S X="Action (PB"_$S($P(PSIVSITE,U,2):"S",1:"")_")^"_$S(PSGCNT<1:"B",$G(PSJPRI)="D":"B",$P(PSIVSITE,U,2)&$D(X):"S",1:"P")_"^^PRINT LABELS,BYPASS"_$S($P(PSIVSITE,U,2):",SUSPEND LABELS",1:"")
"RTN","PSIVORE1",39,0)
 D ENQ^PSIV S X=$E(X) S:X["?" HELP="ANSWER" D:X["?" ^PSIVHLP G:X["?" B1 I "B^"[X G K^PSIVORE2
"RTN","PSIVORE1",40,0)
 I "S"[X,$D(^PS(55,"PSIVSUS",PSIVSN,DFN,ON)) D C^PSIVORE2 W !!,"There ",$S(SNM>1:"are",1:"is")," already ",SNM," LABEL",$E("S",SNM>1)," suspended for this order." K SNM,DAT
"RTN","PSIVORE1",41,0)
SS ;
"RTN","PSIVORE1",42,0)
 S PSIVA=X,X="# of labels^"_PSGCNT_"^^^QUX=+QUX&(QUX?1N.N)" D ENQ^PSIV W !!
"RTN","PSIVORE1",43,0)
 S PSIVLABN=X I X["?"!(X>99) S X=PSIVA W !,"Enter # labels, less than 100, to act on." G SS
"RTN","PSIVORE1",44,0)
 I 'X W " No action taken ***" G B1
"RTN","PSIVORE1",45,0)
 I PSIVA="S",$D(^PS(55,"PSIVSUS",PSIVSN,DFN,+ON,PNOW)) W $C(7),"NO Labels suspended, Wait 8 seconds and try again." D NOW^%DTC S Y=% S PNOW=Y G B1
"RTN","PSIVORE1",46,0)
 S $P(^(0),U,16)=$P(^PS(55,DFN,"IV",+ON,0),U,16)+X,PSIVNOL=+X,PSGCNT=PSGCNT-X,PSIVDOSE=$P(PSGSA," ",1,X),PLAST=$P(PSGSA," "),PLAST="."_$P(PLAST,".",2),PSGSA=$P(PSGSA," ",X+1,999) I PLAST>$P(PSGSA," ") S UP1=1
"RTN","PSIVORE1",47,0)
 S P(16)=$P(^PS(55,DFN,"IV",+ON,0),U,16)
"RTN","PSIVORE1",48,0)
 I $D(UP1) S:$D(X1)#2 XX1=X1 S:$D(X2)#2 XX2=X2 S X1=$E(PSIVDOSE,1,7),X2=1 D C^%DTC S PSGSA=X_PSGSA S:$D(XX1) X1=XX1 S:$D(XX2) X2=XX2 K XX2,XX1
"RTN","PSIVORE1",49,0)
 I '$D(UP1) S PSGSA=$E(PSIVDOSE,1,7)_PSGSA
"RTN","PSIVORE1",50,0)
 K UP1 I PSIVA="S" S ^PS(55,"PSIVSUS",PSIVSN,DFN,+ON,PNOW)=PSIVLABN_U_PSIVDOSE_U_P(16),Y=0,P(16)=P(16)+X W " ... ",PSIVLABN," Label",$E("s",PSIVLABN>1)," suspended !" S ACTION=5,PSIVNOL=PSIVLABN,TRACK=4 D ^PSIVLTR,NOW^%DTC S Y=% S PNOW=Y K X G B
"RTN","PSIVORE1",51,0)
 S IONOFF="" I PSIVPL=ION S P16=P(16),ACTION=1,TRACK=4 D ^PSIVLTR D ^PSIVHYPL:P(4)="H",^PSIVLABL:"APSC"[P(4) S P(16)=$P(^PS(55,DFN,"IV",+ON,0),U,16) G B
"RTN","PSIVORE1",52,0)
 W ! S P16=P(16),P(16)=P(16)+X,ZTDTH=$H,ZTIO=PSIVPL F Y="IONOFF","P16","PSIVDOSE","PSIVSITE","PSIVSN","PSIVNOL","DFN","ON","PSJSYSL","PSJSYSW0","PSJSYSW","PSJSYSP","PSJSYSP0","PSJSYSU" S ZTSAVE(Y)=""
"RTN","PSIVORE1",53,0)
 S ZTDESC="PRINT IV LABELS",ZTRTN="DEQ^PSIVORE2" D ^%ZTLOAD G B
"RTN","PSIVORE1",54,0)
GSTRING ; Setup edit "^" string.
"RTN","PSIVORE1",55,0)
 S PSIVOK="57^58^59^10^3^25^26^39^1^64^63"_$S($E(P("OT"))="I":"^101",1:"")
"RTN","PSIVORE1",56,0)
 S EDIT="57^58^59^10^3^25^26^39^1^"_$S(P("OT")="I":"101^",1:"")_"64^63"
"RTN","PSIVORE1",57,0)
 ;* S EDIT="57^58^59^10^3^25^26^39^1^"_$S(P("DTYP")=1:"101^",1:"")_"64^63"
"RTN","PSIVORE1",58,0)
 Q
"RTN","PSIVOREN")
0^49^B28253385^B27499279
"RTN","PSIVOREN",1,0)
PSIVOREN ;BIR/MLM-UTILITIES FOR IV FLUIDS - OE/RR INTERFACE ; 8/10/09 7:12am
"RTN","PSIVOREN",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**3,18,69,110,127,133,140,134,207,279**;16 DEC 97;Build 150
"RTN","PSIVOREN",3,0)
 ;
"RTN","PSIVOREN",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVOREN",5,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSIVOREN",6,0)
 ; Reference to ^DIE is supported by DBIA 10018.
"RTN","PSIVOREN",7,0)
 ;
"RTN","PSIVOREN",8,0)
ENCPP ; Check Package Parameter
"RTN","PSIVOREN",9,0)
 D ORPARM I 'PSJORF W !!,"Inpatient Medications is not turned on for OE/RR.",!,"You will not be able to enter or edit IV or Unit Dose orders."
"RTN","PSIVOREN",10,0)
 I 'PSJIVORF W !!,"IV Medications is not turned on for OE/RR.",!,"You will not be able to enter or edit IV orders."
"RTN","PSIVOREN",11,0)
 I 'PSJORF!'PSJIVORF S PSJIVORF="" D DONE^PSIVORA1 Q
"RTN","PSIVOREN",12,0)
 S PSJORL=$G(VAIN(4)) I 'PSJORL,$G(DFN) D INP^VADPT S PSJORL=$G(VAIN(4))
"RTN","PSIVOREN",13,0)
 S PSJORPF=0,P("OT")="F^",PSJORNP=$S($G(PSJORNP):PSJORNP,1:+$G(DUZ))
"RTN","PSIVOREN",14,0)
 Q
"RTN","PSIVOREN",15,0)
 ;
"RTN","PSIVOREN",16,0)
PS ; Check if MD is authorized to write med. orders.
"RTN","PSIVOREN",17,0)
 S PSJORPF=0 S:PSJORNP X=$G(^VA(200,+PSJORNP,"PS")) Q:$S('PSJORNP:0,'X:0,'$P(X,U,4):1,$P(X,U,4)>DT:1,1:0)  D
"RTN","PSIVOREN",18,0)
 .W !?2,"(The selected PROVIDER is NOT qualified to write MEDICATION orders.  You must",!,"select a valid provider to be able to continue with Inpatient Medications.)"
"RTN","PSIVOREN",19,0)
 .K DIC S DIC="^VA(200,",DIC(0)="AEMQZ",DIC("A")="Select PHARMACY PROVIDER: ",DIC("S")="S PSIV=$G(^(""PS"")) I PSIV,$S($P(PSIV,""^"",4)="""":1,DT<$P(PSIV,""^"",4):1,1:0)" F  W ! D ^DIC Q:$D(DUOUT)!$D(DTOUT)!(Y>0)  W $C(7),"  (Required.)"
"RTN","PSIVOREN",20,0)
 .K DIC S:Y'>0 PSJORPF=11 S:Y>0 PSJORNP=+Y Q
"RTN","PSIVOREN",21,0)
 K DTOUT
"RTN","PSIVOREN",22,0)
 Q
"RTN","PSIVOREN",23,0)
 ;
"RTN","PSIVOREN",24,0)
RUPDATE(DFN,ON,NSTRT) ;
"RTN","PSIVOREN",25,0)
 ; Update renewal orders (called from Pharmacy options).
"RTN","PSIVOREN",26,0)
 N DA,DIE,DR,ND,NSTOP,OSTOP,NOO,ORETURN,PSIVACT,PSIVAL,PSIVALCK,PSJOSTRT,PSGOLDOE S DIE="^PS(55,"_DFN_","
"RTN","PSIVOREN",27,0)
 I ON["P" S OLDON=$P($G(^PS(53.1,+ON,0)),"^",25),NOO=$P($G(^PS(53.1,+ON,.2)),"^",3)
"RTN","PSIVOREN",28,0)
 I ON["V" S OLDON=ON,NOO=$P($G(^PS(55,DFN,"IV",+ON,.2)),"^",5)
"RTN","PSIVOREN",29,0)
 I ON["U" S OLDON=$P($G(^PS(55,DFN,5,+ON,0)),U,25)
"RTN","PSIVOREN",30,0)
 I OLDON["P" S OLDON=$P($G(^PS(53.1,+OLDON,0)),U,25)
"RTN","PSIVOREN",31,0)
 I OLDON["V" S ON55=OLDON,X=$G(^PS(55,DFN,"IV",+OLDON,2)),PSJOSTRT=$P(X,U,7),OSTOP=$S(($G(PSJOSTOP)>PSJOSTRT):PSJOSTOP,1:$P($G(^(0)),U,3)),DIE=DIE_"""IV"",",DR="100////A",PSIVACT=1
"RTN","PSIVOREN",32,0)
 I OLDON["U" S X=$G(^PS(55,DFN,5,+OLDON,2)),PSJOSTRT=$P(X,U,7),OSTOP=$P(X,U,4),DIE=DIE_"5,"
"RTN","PSIVOREN",33,0)
 S NSTOP=+$S($G(P(3)):P(3),1:0),DA=+OLDON,DA(1)=DFN I 'NSTOP W !,"CAN'T RENEW THIS ORDER!" D PAUSE^VALM1 Q
"RTN","PSIVOREN",34,0)
 ;
"RTN","PSIVOREN",35,0)
 I ON["V"!(ON["P") D EXPOE^PSGOER(DFN,ON)
"RTN","PSIVOREN",36,0)
 ;
"RTN","PSIVOREN",37,0)
 S DR=DR_";"_$S(OLDON["V":.03,OLDON["U":34,1:25)_"////"_NSTOP_";"_$S(OLDON["V":"114////@;123////@",1:"105////@;107////@") S:+$G(P(6))?1.30N DR=DR_";.06////"_+P(6) D ^DIE
"RTN","PSIVOREN",38,0)
 I $G(P("OPI"))'="" S ^PS(55,DFN,"IV",+OLDON,3)=P("OPI")
"RTN","PSIVOREN",39,0)
 I ON["P" S DIE="^PS(53.1,",DR="28////A;105////@;",DA=+ON D ^DIE D
"RTN","PSIVOREN",40,0)
 .I $G(OLDON)["V" S PSGOLDOE=$P($G(^PS(55,DFN,"IV",+OLDON,0)),"^",21)
"RTN","PSIVOREN",41,0)
 .N NOEORD,VN,VNDT S NOEORD=$P(^PS(53.1,+ON,0),U,21) S VN=$P($G(^PS(53.1,+ON,4)),"^") I VN S VNDT=$P($G(^PS(53.1,+ON,4)),"^",2)
"RTN","PSIVOREN",42,0)
 .I NOEORD K DA,DR,DIE S DIE="^PS(55,"_DFN_",""IV"",",DA(1)=DFN,DA=+ON55,DR="110////"_+NOEORD D
"RTN","PSIVOREN",43,0)
 ..S DR=DR_";16////"_$S($G(VN):VN,1:"@")_";17////"_$S($G(VNDT):VNDT,1:"@")_";" D ^DIE I NOEORD[";" S $P(^PS(53.1,+ON,0),U,21)=NOEORD
"RTN","PSIVOREN",44,0)
 ..I $G(VN) D EN1^PSJHL2(DFN,"ZV",ON55)
"RTN","PSIVOREN",45,0)
 I ON["V" S DIE="^PS(55,DFN,""IV"",",DR="100////A;114////@;16////@;17////@" S DA=+ON55 D ^DIE
"RTN","PSIVOREN",46,0)
 N RDT S RDT=$P($G(@("^PS(53.1,"_+ON_",14,0)")),U,3) S:RDT RDT=+(^(RDT,0)) S RDT=$S(RDT:RDT,1:$$DATE^PSJUTL2) I RDT D UPDREN^PSIVOPT2(DFN,OLDON,RDT,+P(6),+$G(OSTOP),$G(NOO))
"RTN","PSIVOREN",47,0)
 ;
"RTN","PSIVOREN",48,0)
 I ON["V" D EN1^PSJHL2(DFN,"SN",ON,"NEW ORDER CREATED")
"RTN","PSIVOREN",49,0)
 I OLDON["V" S (ON,ON55)=OLDON,PSIVAL="",PSIVALCK="STOP",(P("FRES"),PSIVREA)="R" D LOG^PSIVORAL D
"RTN","PSIVOREN",50,0)
 .I $G(ON55),$G(OSTOP),$G(DFN) D STIX(OSTOP,OLDON,DFN)
"RTN","PSIVOREN",51,0)
 .;Add check to If statement below. If New Stop date ='s the old Stop Don't delete AIV x-ref (NSTOP'=PSJOSTOP)
"RTN","PSIVOREN",52,0)
 .I $G(PSJOSTOP),$G(NSTOP) I NSTOP=$P($G(^PS(55,DFN,"IV",+ON55,0)),"^",3),$D(^PS(55,"AIV",NSTOP,DFN,+ON55)),NSTOP'=PSJOSTOP K ^PS(55,"AIV",PSJOSTOP,DFN,+ON55)
"RTN","PSIVOREN",53,0)
 D:'$D(PSJIVORF) ORPARM Q:'PSJIVORF
"RTN","PSIVOREN",54,0)
 Q
"RTN","PSIVOREN",55,0)
 ;
"RTN","PSIVOREN",56,0)
RUPTXT(DFN,OLDON) ;
"RTN","PSIVOREN",57,0)
 ;Update ORTX( in OE/RR
"RTN","PSIVOREN",58,0)
 I OLDON'["V" ;; D ENUDTX^PSJOREN(DFN,OLDON,"OR") S ORIFN=$P($G(^PS(55,DFN,"IV",+OLDON,0)),U,21)
"RTN","PSIVOREN",59,0)
 I OLDON["V" S P("FRES")="R" D GTPC^PSIVORFB(OLDON),SORTX^PSIVORFE S ORIFN=$P($G(^PS(55,DFN,"IV",+OLDON,0)),U,21)
"RTN","PSIVOREN",60,0)
 Q
"RTN","PSIVOREN",61,0)
 ;
"RTN","PSIVOREN",62,0)
ORPARM ;Check if inpatient pkges are on.
"RTN","PSIVOREN",63,0)
 S (PSJORF,PSJIVORF)=1
"RTN","PSIVOREN",64,0)
 Q
"RTN","PSIVOREN",65,0)
 ;
"RTN","PSIVOREN",66,0)
NATURE ; Ask nature of order.
"RTN","PSIVOREN",67,0)
 Q:$G(PSJDCTYP)=2
"RTN","PSIVOREN",68,0)
 I '+$G(PSJSYSU) S P("NAT")="W" Q
"RTN","PSIVOREN",69,0)
 K P("NAT") NEW X
"RTN","PSIVOREN",70,0)
 I $D(XQORNOD(0)) S X=$E($P(XQORNOD(0),U,3),1,1) S:X="" X="E"
"RTN","PSIVOREN",71,0)
 S:'$D(X) X="N" S:"AF"[X X="E"
"RTN","PSIVOREN",72,0)
 I $G(PSIVCOPY) S X="N"
"RTN","PSIVOREN",73,0)
 S P("NAT")=$$ENNOO^PSJUTL5(X)
"RTN","PSIVOREN",74,0)
 K:P("NAT")=-1 P("NAT")
"RTN","PSIVOREN",75,0)
 Q
"RTN","PSIVOREN",76,0)
CLINIC ;Ask clinic where outpt is being seen for DSS
"RTN","PSIVOREN",77,0)
 Q:($G(P("CLIN"))]"")
"RTN","PSIVOREN",78,0)
 K P("CLIN") NEW X1,X2,X,PSJDT,DIC,Y
"RTN","PSIVOREN",79,0)
 S X1=DT,X2=-7 D C^%DTC S PSJDT=X
"RTN","PSIVOREN",80,0)
 S DIC("S")="I $P($G(^SC(Y,0)),U,3)=""C"",$S('$P($G(^(""I"")),U):1,($P($G(^(""I"")),U)>PSJDT):1,(($P($G(^(""I"")),U)<PSJDT)&($P($G(^(""I"")),U,2)]"""")&(DT>$P($G(^(""I"")),U,2))):1,1:0)"
"RTN","PSIVOREN",81,0)
 S DIC=44,DIC(0)="QEAZ",DIC("A")="Select CLINIC LOCATION: " D ^DIC
"RTN","PSIVOREN",82,0)
 I $S($D(DTOUT):1,$D(DUOUT):1,1:0) Q
"RTN","PSIVOREN",83,0)
 S:+Y>0 P("CLIN")=+Y I ($G(ON55)["V"),$P($G(^PS(55,DFN,"IV",+ON55,0)),"^",2),(Y>0) S $P(^PS(55,DFN,"IV",+ON55,"DSS"),"^")=+Y
"RTN","PSIVOREN",84,0)
 Q
"RTN","PSIVOREN",85,0)
 ;
"RTN","PSIVOREN",86,0)
STIX(OST,OON,DFN) ; Check start index, cleanup old start
"RTN","PSIVOREN",87,0)
 I $G(OST),$G(OON) S OS="" F  S OS=$O(^PS(55,DFN,"IV","AIS",OS)) Q:'OS  D
"RTN","PSIVOREN",88,0)
 . Q:'$D(^PS(55,DFN,"IV","AIS",OS,+OON))
"RTN","PSIVOREN",89,0)
 . I $P($G(^PS(55,DFN,"IV",+OON,0)),"^",3)'=OS K ^PS(55,DFN,"IV","AIS",OS,+OON)
"RTN","PSIVOREN",90,0)
 Q
"RTN","PSIVORFA")
0^23^B30883518^B28198833
"RTN","PSIVORFA",1,0)
PSIVORFA ;BIR/MLM-FILE/RETRIEVE ORDERS IN 53.1 ; 8/17/09 9:23am
"RTN","PSIVORFA",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**4,7,18,28,50,71,58,91,80,110,111,134,225,267,275,279**;16 DEC 97;Build 150
"RTN","PSIVORFA",3,0)
 ;
"RTN","PSIVORFA",4,0)
 ; Reference to ^PS(51.1 supported by DBIA 2177.
"RTN","PSIVORFA",5,0)
 ; Reference to ^PS(51.2 supported by DBIA 2178.
"RTN","PSIVORFA",6,0)
 ; Reference to ^PS(52.7 supported by DBIA 2173.
"RTN","PSIVORFA",7,0)
 ; Reference to ^PS(52.6 supported by DBIA 1231.
"RTN","PSIVORFA",8,0)
 ;
"RTN","PSIVORFA",9,0)
GT531(DFN,ON,PSJAPI) ; Retrieve order data from 53.1 and place into local array
"RTN","PSIVORFA",10,0)
 ;
"RTN","PSIVORFA",11,0)
 ; PSJAPI - If being called from background job, PSJAPI=1.
"RTN","PSIVORFA",12,0)
 NEW PSGOES S PSGOES=1
"RTN","PSIVORFA",13,0)
 F X="CUM","LF","LFA","LF","PRNTON" S P(X)=""
"RTN","PSIVORFA",14,0)
 S Y=$G(^PS(53.1,+ON,0)),P(17)=$P(Y,U,9),P("LOG")=$P(Y,U,16),(P(21),P("21FLG"),PSJORIFN)=$P(Y,U,21)
"RTN","PSIVORFA",15,0)
 S P("RES")=$P(Y,U,24),P("OLDON")=$P(Y,U,25),P("NEWON")=$P(Y,U,26),P("FRES")=$P(Y,U,27)
"RTN","PSIVORFA",16,0)
 S P("MR")=$P(Y,U,3),P(6)=+$P(Y,U,2),Y=$G(^VA(200,+P(6),0)),$P(P(6),U,2)=$P(Y,U),Y=$G(^PS(51.2,+P("MR"),0)),$P(P("MR"),U,2)=$S($P(Y,U,3)]"":$P(Y,U,3),1:$P(Y,U))
"RTN","PSIVORFA",17,0)
 S Y=$G(^PS(53.1,+ON,.2)),P("PD")=$S(+Y:$P(Y,U)_U_$$OIDF^PSJLMUT1(+Y),1:""),P("DO")=$P(Y,U,2),P("NAT")=$P(Y,U,3),P("PRY")=$P(Y,U,4),(PSJCOM,P("PRNTON"))=$P(Y,U,8)
"RTN","PSIVORFA",18,0)
 S P("INS")=$G(^PS(53.1,+ON,.3))
"RTN","PSIVORFA",19,0)
 I $G(^PS(53.1,+ON,4))]"" S P("NINIT")=$P(^(4),U),P("NINITDT")=$P(^(4),U,2)
"RTN","PSIVORFA",20,0)
 NEW NAME S NAME=""
"RTN","PSIVORFA",21,0)
 I $D(^PS(53.1,+ON,1,1)) D DD^PSJLMUT1("^PS(53.1,+ON,",.NAME)
"RTN","PSIVORFA",22,0)
 S P("INS")=P("INS")_$S(P("INS")]"":" of ",1:"")_NAME
"RTN","PSIVORFA",23,0)
 S P("APPT")=$G(^PS(53.1,+ON,"DSS")),P("CLIN")=$P(P("APPT"),"^"),P("APPT")=$P(P("APPT"),"^",2)
"RTN","PSIVORFA",24,0)
 S Y=$G(^PS(53.1,+ON,2)),P(9)=$P(Y,U),P(11)=$P(Y,U,5),P(15)=$S($P(Y,U,6)'="":$P(Y,U,6),$G(PSGS0XT)'="":PSGS0XT,$P($G(ZZND),"^",3)'="":$P(ZZND,"^",3),1:""),P(2)=$P(Y,U,2),P(3)=$P(Y,U,4)
"RTN","PSIVORFA",25,0)
 S Y=$G(^PS(53.1,+ON,4)),P("CLRK")=$P(Y,U,7)_U_$P($G(^VA(200,+$P(Y,U,7),0)),U),P("REN")=$P(Y,U,9),X=P(9)
"RTN","PSIVORFA",26,0)
 I $P($G(^PS(53.1,+ON,0)),U,7)="P",(P(9)'["PRN") S P(9)=P(9)_" PRN"
"RTN","PSIVORFA",27,0)
 K PSGST,XT
"RTN","PSIVORFA",28,0)
 ;PSJ*5*225 remove 1440 default
"RTN","PSIVORFA",29,0)
 I P(9)]"",P(9)'["PRN",(P(11)="") D  S P(15)=$S($G(XT)]""&'+$G(XT):XT,+$G(XT)>0:XT,$G(PSGS0XT):PSGS0XT,1:1440),P(11)=Y
"RTN","PSIVORFA",30,0)
 . I $O(^PS(51.1,"APPSJ",P(9),0)) D DIC^PSGORS0 Q
"RTN","PSIVORFA",31,0)
 . I '$O(^PS(51.1,"APPSJ",P(9),0)) N NOECH,PSGSCH S NOECH=1 D EN^PSIVSP
"RTN","PSIVORFA",32,0)
 S Y=$G(^PS(53.1,+ON,8)),P(4)=$P(Y,U),P(23)=$P(Y,U,2),P("SYRS")=$P(Y,U,3),P(5)=$P(Y,U,4),P(8)=$P(Y,U,5),P(7)=$P(Y,U,7),P("IVRM")=$P(Y,U,8)
"RTN","PSIVORFA",33,0)
 I ($G(^PS(53.1,+ON,17))?1.N) S P("NUMLBL")=$G(^(17))
"RTN","PSIVORFA",34,0)
 I '$G(P("NUMLBL")) S P("NUMLBL")=$P($G(P(8)),"@",2)
"RTN","PSIVORFA",35,0)
 N PSJABBIN S PSJABBIN=$P(P(8),"@") I PSJABBIN]"" D
"RTN","PSIVORFA",36,0)
 .Q:(P(8)?1"INFUSE OVER "1.N1" MINUTES")
"RTN","PSIVORFA",37,0)
 .D EXPINF^PSIVEDT1(.PSJABBIN,1) S P(8)=PSJABBIN_$S($G(P("NUMLBL"))?1.N:"@"_P("NUMLBL"),1:"")
"RTN","PSIVORFA",38,0)
 S P(4)=$S(P(4)'="":P(4),$G(PSIVTYPE):PSIVTYPE,1:"")
"RTN","PSIVORFA",39,0)
 S:'P("IVRM")&($D(PSIVSN)) P("IVRM")=+PSIVSN S Y=$G(^PS(59.5,+P("IVRM"),0)),$P(P("IVRM"),U,2)=$P(Y,U),Y=$G(^PS(53.1,+ON,9)),P("REM")=$P(Y,U),P("OPI")=$P(Y,U,2,3)
"RTN","PSIVORFA",40,0)
 S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSIVORFA",41,0)
 S P("PACT")=$G(^PS(53.1,+ON,"A",1,0))
"RTN","PSIVORFA",42,0)
 D GTDRG,GTOT^PSIVUTL(P(4)) D:'$D(PSJLABEL) GTPC(ON)
"RTN","PSIVORFA",43,0)
 N ND2P5 S ND2P5=$G(^PS(53.1,+ON,2.5)) D
"RTN","PSIVORFA",44,0)
 .S P("DUR")=$P(ND2P5,"^",2)
"RTN","PSIVORFA",45,0)
 .S P("LIMIT")=$P(ND2P5,"^",4)
"RTN","PSIVORFA",46,0)
 .S P("IVCAT")=$P(ND2P5,"^",5)
"RTN","PSIVORFA",47,0)
 N LONGOPI S LONGOPI=$$GETOPI^PSJBCMA5(DFN,ON,$S($G(PSJAPI):1,1:""))
"RTN","PSIVORFA",48,0)
 Q
"RTN","PSIVORFA",49,0)
GTDRG ;
"RTN","PSIVORFA",50,0)
 K DRG F X="AD","SOL" S FIL=$S(X="AD":52.6,1:52.7) F Y=0:0 S Y=$O(^PS(53.1,+ON,X,Y)) Q:'Y  D
"RTN","PSIVORFA",51,0)
 .S (DRGI,DRG(X,0))=$G(DRG(X,0))+1,DRG=$G(^PS(53.1,+ON,X,Y,0)),ND=$G(^PS(FIL,+DRG,0)),DRGN=$P(ND,U),DRG(X,+DRGI)=+DRG_U_$P(ND,U)_U_$P(DRG,U,2)_U_$P(DRG,U,3)_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSIVORFA",52,0)
 Q
"RTN","PSIVORFA",53,0)
 ;
"RTN","PSIVORFA",54,0)
GTPC(ON) ; Retrieve Provider Comments and create "scratch" fields to edit
"RTN","PSIVORFA",55,0)
 Q
"RTN","PSIVORFA",56,0)
 ;
"RTN","PSIVORFA",57,0)
PUT531 ; Move data in local variables to 53.1
"RTN","PSIVORFA",58,0)
 S:'$D(P(9)) P(9)=$G(PSGSCH)
"RTN","PSIVORFA",59,0)
 S ND(0)=+ON_U_+P(6)_U_$S(+P("MR"):+P("MR"),1:"")_U_$P(P("OT"),U)_U_U_U_"C",$P(ND(0),U,9)=P(17),$P(ND(0),U,21)=$G(P(21))
"RTN","PSIVORFA",60,0)
 S $P(ND(0),U,14,16)=P("LOG")_U_DFN_U_P("LOG"),$P(ND(0),U,24,26)=$G(P("RES"))_U_$G(P("OLDON"))_U_$G(P("NEWON"))
"RTN","PSIVORFA",61,0)
 S ND(2)=P(9)_U_P(2)_U_U_P(3)_U_P(11)_U_$S($G(P(15))'="":P(15),$G(PSGS0XT)'="":PSGS0XT,$P($G(ZZND),"^",3)'="":$P(ZZND,"^",3),1:""),$P(ND(4),U,7,9)=+P("CLRK")_U_U_P("REN")
"RTN","PSIVORFA",62,0)
 S ND(8)=P(4)_U_P(23)_U_P("SYRS")_U_P(5)_U_P(8)_"^^"_P(7)_"^"_+P("IVRM"),ND(9)=$S($L(P("REM")_P("OPI")):P("REM")_U_P("OPI"),1:"") S $P(ND(4),U,1,2)=$G(P("NINIT"))_U_$G(P("NINITDT"))
"RTN","PSIVORFA",63,0)
 S:+$G(P("CLIN")) $P(^PS(53.1,+ON,"DSS"),"^")=P("CLIN")
"RTN","PSIVORFA",64,0)
 S:+$G(P("APPT")) $P(^PS(53.1,+ON,"DSS"),"^",2)=P("APPT")
"RTN","PSIVORFA",65,0)
 S:$G(P("LIMIT"))]"" $P(^PS(53.1,+ON,2.5),"^",4)=P("LIMIT")
"RTN","PSIVORFA",66,0)
 I $G(PSJORD)["V"!($G(PSJORD)["P") I $G(^PS(53.1,+ON,2.5))="" N DUR S DUR=$$GETDUR^PSJLIVMD(DFN,+PSJORD,$S((PSJORD["P"):"P",1:"IV"),1) I DUR]"" D
"RTN","PSIVORFA",67,0)
 .I $G(IVLIMIT) S $P(^PS(53.1,+ON,2.5),"^",4)=DUR K IVLIMIT Q
"RTN","PSIVORFA",68,0)
 .S $P(^PS(53.1,+ON,2.5),"^",2)=DUR
"RTN","PSIVORFA",69,0)
 F X=0,2,4,8,9 S ^PS(53.1,+ON,X)=ND(X)
"RTN","PSIVORFA",70,0)
 I $G(P("NUMLBL"))?1.N!($G(P("NUMLBL"))="") S $P(^PS(53.1,+ON,17),"^")=$G(P("NUMLBL"))
"RTN","PSIVORFA",71,0)
 S PSIVCAT=$$IVCAT^PSJHLU(DFN,ON,.P) S:PSIVCAT]"" $P(^PS(53.1,+ON,2.5),"^",5)=PSIVCAT K PSIVCAT
"RTN","PSIVORFA",72,0)
 S:'+$G(^PS(53.1,+ON,.2)) $P(^(.2),U,1,3)=+P("PD")_U_P("DO")_U_$G(P("NAT"))
"RTN","PSIVORFA",73,0)
 F DRGT="AD","SOL" D:$D(DRG(DRGT)) PTD531
"RTN","PSIVORFA",74,0)
 K DA,DIK S PSGS0Y=P(11),PSGS0XT=P(15),DA=+ON,DIK="^PS(53.1," D IX^DIK K DA,DIK,PSGS0Y,PSGS0XT,ND,^PS(53.1,"AS","P",DFN,+ON)
"RTN","PSIVORFA",75,0)
 K:P(17)="A" ^PS(53.1,"AS","N",DFN,+ON)
"RTN","PSIVORFA",76,0)
 S:P(15)="D" $P(^PS(53.1,+ON,2),U,6)="D"
"RTN","PSIVORFA",77,0)
 I $G(PSJINFIN) K PSJINFIN I $D(^PS(53.45,+$G(PSJSYSP),6)),'$D(^PS(53.1,+ON,"A")),'$D(^PS(53.1,+ON,16)) S PSJINFIN=2
"RTN","PSIVORFA",78,0)
 I $G(PSJSYSP) D
"RTN","PSIVORFA",79,0)
 .I '$D(^PS(53.45,+PSJSYSP,6)) I $G(PSJORD)["V"!($G(PSJORD)["P") I '$D(^PS(53.1,+ON,16)) N I S I=$$GETOPI^PSJBCMA5(DFN,PSJORD)
"RTN","PSIVORFA",80,0)
 .I $D(^PS(53.45,+PSJSYSP,6)) D FILEOPI^PSJBCMA5(DFN,ON)
"RTN","PSIVORFA",81,0)
 Q
"RTN","PSIVORFA",82,0)
 ;
"RTN","PSIVORFA",83,0)
UPD100 ; Update order data in file 100
"RTN","PSIVORFA",84,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN Q:'PSJIVORF
"RTN","PSIVORFA",85,0)
 S PSJORL=$$ENORL^PSJUTL($G(VAIN(4))) D SET^PSIVORFE
"RTN","PSIVORFA",86,0)
 Q
"RTN","PSIVORFA",87,0)
 ;
"RTN","PSIVORFA",88,0)
PTD531 ; Move drug data from local array into 53.1
"RTN","PSIVORFA",89,0)
 K ^PS(53.1,+ON,DRGT) S ^PS(53.1,+ON,DRGT,0)=$S(DRGT="AD":"^53.157^0^0",1:"^53.158^0^0")
"RTN","PSIVORFA",90,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSIVORFA",91,0)
 .S X1=$P(DRG(DRGT,X),U),Y=^PS(53.1,+ON,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSIVORFA",92,0)
 .S ^PS(53.1,+ON,DRGT,0)=Y,Y=+X1_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^PS(53.1,+ON,DRGT,+DRG,0)=Y
"RTN","PSIVORFA",93,0)
 Q
"RTN","PSIVORLB")
0^8^B16554015^B13180848
"RTN","PSIVORLB",1,0)
PSIVORLB ;BIR/MLM-PRINT OUT LABELS ; 8/5/08 9:22am
"RTN","PSIVORLB",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**58,184,279**;16 DEC 97;Build 150
"RTN","PSIVORLB",3,0)
 ;
"RTN","PSIVORLB",4,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSIVORLB",5,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVORLB",6,0)
 ;
"RTN","PSIVORLB",7,0)
ENX ;Print example label
"RTN","PSIVORLB",8,0)
 I ($G(VAIN(4))="") D CLINIC^PSIVOREN
"RTN","PSIVORLB",9,0)
 D FULL^VALM1
"RTN","PSIVORLB",10,0)
 S PSIVFLAG=1,PSIVRM=$P(PSIVSITE,U,13) S:PSIVRM<1 PSIVRM=30 D:$E(P("OT"))="I" ORFLDS^PSIVEDT1 W:$E(P("OT"))'="I" !,"Med Route: ",$P(P("MR"),U,2),!
"RTN","PSIVORLB",11,0)
START F PSIV1=1:1:PSIVNOL S LINE=0 D RE I '$D(PSIVFLAG) F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVORLB",12,0)
Q K PSIVDOSE,P16,LINE,MESS,PSIVCT,PSIV2,PSIVFLAG,PSIVRM,PSIV1,PDOSE,PDATE,XX1,XX2,BAG,CX,PSIMESS,PSIVCLAB Q
"RTN","PSIVORLB",13,0)
RE ;
"RTN","PSIVORLB",14,0)
 D:'$D(VADM(2)) DEM^VADPT
"RTN","PSIVORLB",15,0)
 I PSIV1,P(4)="A"!(P(5)=0) S:P(15)>2880!('P(15)) P(15)=2880 S P(16)=P16+PSIV1#(1440/P(15)+.5\1) S:'P(16) P(16)=1440/P(15)+.5\1
"RTN","PSIVORLB",16,0)
 W DFN,!
"RTN","PSIVORLB",17,0)
 N PSIVCLIN,PSIVCLDT S PSIVCLIN=$S($G(P("CLIN")):P("CLIN"),($G(ON55)["V"):+$G(^PS(55,DFN,"IV",+ON55,"DSS")),($G(ON55)["P"):+$G(^PS(53.1,+ON55,"DSS")),1:"") S:'(PSIVCLIN>0) PSIVCLIN="" I PSIVCLIN D
"RTN","PSIVORLB",18,0)
 .S PSIVCLDT=$P(PSIVCLIN,"^",2) S $P(PSIVCLIN,"^",2)=$P($G(^SC(+PSIVCLIN,0)),"^")
"RTN","PSIVORLB",19,0)
 I $G(PSIVCLIN) N PSIVCLAB S PSIVCLAB=$P($G(^SC(+PSIVCLIN,0)),"^",2)
"RTN","PSIVORLB",20,0)
 S X=$S(P("PON")["V":"["_+P("PON")_"]",1:"")_$P($P(VADM(2),U,2),"-",3) D
"RTN","PSIVORLB",21,0)
 .S X=X_"  "_$S($G(PSIVCLIN)&($G(PSIVCLAB)]""):PSIVCLAB,$G(PSIVCLIN)&($P(PSIVCLIN,"^",2)'=""):$P(PSIVCLIN,"^",2),+VAIN(4):$P(VAIN(4),U,2),1:"Opt IV")_"  "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3)
"RTN","PSIVORLB",22,0)
 D P
"RTN","PSIVORLB",23,0)
 S X=VADM(1) S:$P(PSIVSITE,U,9) X=X_"  "_$S(VAIN(5)]"":VAIN(5),1:"NF") D P S X=" " D P
"RTN","PSIVORLB",24,0)
 I $D(PSIVFLAG) F PSIV=0:0 S PSIV=$O(DRG("AD",PSIV)) Q:'PSIV  S Y=DRG("AD",PSIV),X=$S($P(Y,U,2)]"":$P(Y,U,2),1:"*********")_" "_$P(Y,U,3)_" " S:$P(Y,U,4)]"" X=X_" ("_$P(Y,U,4)_")" D P,MESS
"RTN","PSIVORLB",25,0)
 G:$D(PSIVFLAG) SOL
"RTN","PSIVORLB",26,0)
 F PSIV=0:0 S PSIV=$O(DRG("AD",PSIV)) Q:'PSIV  S Y=DRG("AD",PSIV),X=$S($P(Y,U,2)]"":$P(Y,U,2),1:"********")_" "_$P(Y,U,3) I ","_$P(Y,U,4)_","[(","_P(16)_",")!('$P(Y,U,4)) D P,MESS
"RTN","PSIVORLB",27,0)
SOL F PSIV=0:0 S PSIV=$O(DRG("SOL",PSIV)) Q:'PSIV  S Y=DRG("SOL",PSIV) D SOL1,P S X=$P(^PS(52.7,+$P(Y,U),0),U,4) I X]"" S X="   "_X D P
"RTN","PSIVORLB",28,0)
 I P(23)'=""!(P(4)="S") S X="In Syringe: "_$E(P("SYRS"),1,25) D:P(4)="S"!(P(23)="S") P S X="*CAUTION* - CHEMOTHERAPY" D:P(23)'="" P
"RTN","PSIVORLB",29,0)
 S X=" " D P I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) G INF
"RTN","PSIVORLB",30,0)
 S:'$D(PSIVDOSE) PSIVDOSE="" S X=$P(PSIVDOSE," ",PSIV1) D:$E(X)="." CONVER S X="Dose due at: "_$S(X="":"________",1:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)_" "_$E(X#1_"000",2,5)) D P
"RTN","PSIVORLB",31,0)
INF S X=$P(P(8),"@") D:X]"" P I P("OPI")]"" S X=$P(P("OPI"),"^") D P
"RTN","PSIVORLB",32,0)
 S X=P(9) D:X]"" P
"RTN","PSIVORLB",33,0)
 S X=P(11) D:X]"" P
"RTN","PSIVORLB",34,0)
 ; PSJ*5*184 - Display all messages if more than one additive has a message.
"RTN","PSIVORLB",35,0)
 I $D(MESS) S PSIMESS="" F  S PSIMESS=$O(MESS(PSIMESS)) Q:PSIMESS=""  S X=PSIMESS D P
"RTN","PSIVORLB",36,0)
 I $D(^PS(59.5,PSIVSN,4)) S Y=^(4) F PSIV=1:1 S X=$P(Y,U,PSIV) Q:X=""  D P
"RTN","PSIVORLB",37,0)
 S X=PSIV1_"["_PSIVNOL_"]" D P
"RTN","PSIVORLB",38,0)
 Q
"RTN","PSIVORLB",39,0)
P F LINE=LINE+1:1 X:LINE>+PSIVSITE "S LINE=1 F ZZ=1:1 Q:ZZ>$P(PSIVSITE,""^"",16)  W !" K ZZ W $E(X,1,PSIVRM),! S X=$E(X,PSIVRM+1,999) Q:$L(X)<1
"RTN","PSIVORLB",40,0)
 Q
"RTN","PSIVORLB",41,0)
SOL1 S X=$S($P(Y,U,2)]"":$P(Y,U,2)_" "_$P(Y,U,3),1:"**********") Q
"RTN","PSIVORLB",42,0)
MESS ; PSJ*5*184 - make MESS a local array so all messages display for all additives.
"RTN","PSIVORLB",43,0)
 I $P(^PS(52.6,+$P(Y,U),0),U,9)]"" S MESS($P(^PS(52.6,+$P(Y,U),0),U,9))=""
"RTN","PSIVORLB",44,0)
 Q
"RTN","PSIVORLB",45,0)
CONVER ;Expand dose to date.dose and set in X
"RTN","PSIVORLB",46,0)
 I P(15)>1440 S X=$$CONVER1^PSIVORE2($P(PSIVDOSE," "),P(15),(PSIV1-1)) Q
"RTN","PSIVORLB",47,0)
 S PDOSE=X S:PSIV1=2 PDATE=$E($P(PSIVDOSE," "),1,7)
"RTN","PSIVORLB",48,0)
 I $P(PSIVDOSE," ",PSIV1-1)#1'<PDOSE!(P(15)>1440) S:$D(X1) XX1=X1 S:$D(X2) XX2=X2 S X1=PDATE,X2=1 D C^%DTC S PDATE=X,X=X_PDOSE S:$D(XX1) X1=XX1 S:$D(XX2) X2=XX2 Q
"RTN","PSIVORLB",49,0)
 S X=PDATE_PDOSE
"RTN","PSIVORLB",50,0)
 Q
"RTN","PSIVRD")
0^29^B24864338^B24771031
"RTN","PSIVRD",1,0)
PSIVRD ;BIR/PR,MLM-HANDLE QUICK RET/DES ENTRY ;29 SEP 97 / 11:17 AM
"RTN","PSIVRD",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**38,58,88,279**;16 DEC 97;Build 150
"RTN","PSIVRD",3,0)
 ;        ;
"RTN","PSIVRD",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIVRD",5,0)
 ;
"RTN","PSIVRD",6,0)
EN ; Entry point to enter returns/destroyed items.
"RTN","PSIVRD",7,0)
 D ^PSIVXU Q:$D(XQUIT)  F  D ENGETP^PSIV Q:DFN<0  D EN1
"RTN","PSIVRD",8,0)
Q K ACTION,D,DFN,DIC,DIR,DRG,DRGI,DRGN,E,E1,HELP,I,I1,JJ,LABELS,MXMN,ON,ON55,ONCNT,P,PS,PSGDT,PSGID,PSGP,PSGLMT,PSGODDD,PSIVAC,PSIVC,PSIVNOL,PSIVNOW,PSIVON
"RTN","PSIVRD",9,0)
 K PSIVPL,PSIVPR,PSIVSITE,PSIVUP,PSIVX,PSJORIFN,PSJORL,PSJHT,PSJPWT,PSJSYSL,PSJSYSU,PSJSYSW,PSJSYSW0,Q,UL80,VA,VADM,VAIN,VAERR,PSIVNU,PSIVOV1,PSIVOV2,PSIVSN,RDFLAG,RDWARD,X,XQUIT,Y
"RTN","PSIVRD",10,0)
 Q
"RTN","PSIVRD",11,0)
 ;
"RTN","PSIVRD",12,0)
EN1 ;
"RTN","PSIVRD",13,0)
 S PSIVBR="D PROCESS^PSIVRD" D ENCHS1^PSIV
"RTN","PSIVRD",14,0)
 Q
"RTN","PSIVRD",15,0)
EN1OLD ;
"RTN","PSIVRD",16,0)
 ;S PSIVAC="RD" D ENNB^PSIVACT I P("PT")'="N" D GTORDRS Q
"RTN","PSIVRD",17,0)
ORDNO ;
"RTN","PSIVRD",18,0)
 F  R !!,"Enter the order number(s) to be processed: ",PSIVNU:DTIME Q:"^"[PSIVNU  D READ
"RTN","PSIVRD",19,0)
 Q
"RTN","PSIVRD",20,0)
 ;
"RTN","PSIVRD",21,0)
READ ; Read order no.s, no profile.
"RTN","PSIVRD",22,0)
 N DONE I '$T!(PSIVNU="^")!(PSIVNU="") S PSIVNU="" Q
"RTN","PSIVRD",23,0)
 I PSIVNU["?" W !!,"Enter order number(s) separated by a comma e.g. 2,4,5,6.",! Q
"RTN","PSIVRD",24,0)
 I PSIVNU[" " W $C(7),$C(7),"??",!! Q
"RTN","PSIVRD",25,0)
 F I=1:1:$L(PSIVNU,",") S ON=$P(PSIVNU,",",I) D
"RTN","PSIVRD",26,0)
 .I $L(ON)'>0 W $C(7),$C(7),"??",!! S DONE=1
"RTN","PSIVRD",27,0)
 .F JJ=1:1:$L(ON) Q:$G(DONE)  I $A($E(ON,JJ))<48!($A($E(ON,JJ))>57) W !!,$C(7),$C(7),"Order ",ON," is invalid.",!! S DONE=1
"RTN","PSIVRD",28,0)
 I '$G(DONE) F I=1:1:$L(PSIVNU,",") S ON=$P(PSIVNU,",",I) I '$D(^PS(55,DFN,"IV",+ON,0)) W !!,$C(7),$C(7),"Order number ",+ON," does not exist for this patient.",! S DONE=1
"RTN","PSIVRD",29,0)
 I '$G(DONE) D NOW^%DTC S PSIVNOW=% F ONCNT=1:1:$L(PSIVNU,",") D  S ON=9999999999-$P(PSIVNU,",",ONCNT) D OV1
"RTN","PSIVRD",30,0)
 .S X=$G(^PS(55,DFN,"IV",+ON,0)) I $P(X,U,3)<PSIVNOW,("AR"[$P(X,U,17)) S $P(^PS(55,DFN,"IV",+ON,0),U,17)="E" D EXPIR^PSIVOE
"RTN","PSIVRD",31,0)
 Q
"RTN","PSIVRD",32,0)
 ;**********************************************************
"RTN","PSIVRD",33,0)
 ;* GTORDRS, ASK, OV subroutines are no longer use in 5.0. *
"RTN","PSIVRD",34,0)
 ;**********************************************************
"RTN","PSIVRD",35,0)
GTORDRS ;Needs PSIVBR (Branch point)
"RTN","PSIVRD",36,0)
 S IOP="HOME" D ^%ZIS K %ZIS,IOP Q:P("PT")="N"
"RTN","PSIVRD",37,0)
 D ^PSIVPRO Q:X="^"  I X]"" G OV
"RTN","PSIVRD",38,0)
ASK Q:PS<1  W !!,"Choose 1-",PS,": " R X:DTIME S:'$T X="^" Q:"^"[X
"RTN","PSIVRD",39,0)
 I X?1."?" S HELP="CHSE" D ^PSIVHLP D:X?2."?" H2^PSGON G ASK
"RTN","PSIVRD",40,0)
 S PSGLMT=PS D ^PSGON G:'$D(X) ASK
"RTN","PSIVRD",41,0)
OV ;
"RTN","PSIVRD",42,0)
 W ! F PSIVOV1=1:1:PSGODDD F PSIVOV2=1:1:$L(PSGODDD(PSIVOV1),",")-1 S ON=+$P(PSGODDD(PSIVOV1),",",PSIVOV2),ON=$S($D(^TMP("PSIV",$J,"AB",ON)):^(ON),$D(^TMP("PSIV",$J,"NB",ON)):^(ON),$D(^TMP("PSIV",$J,"XB",ON)):^(ON),1:"") Q:'ON  D OV1
"RTN","PSIVRD",43,0)
 Q
"RTN","PSIVRD",44,0)
OV1 ;
"RTN","PSIVRD",45,0)
 S (ON,ON55,P("PON"))=9999999999-ON_"V" K PSIVNUM D GT55^PSIVORFB,ENNONUM^PSIVORV2(DFN,ON)
"RTN","PSIVRD",46,0)
 D PROCESS1
"RTN","PSIVRD",47,0)
 Q
"RTN","PSIVRD",48,0)
 ;
"RTN","PSIVRD",49,0)
PROCESS ;
"RTN","PSIVRD",50,0)
 D FULL^VALM1
"RTN","PSIVRD",51,0)
 S PSJORD=ON D ENNH^PSIVORV2(ON)
"RTN","PSIVRD",52,0)
PROCESS1 ;
"RTN","PSIVRD",53,0)
 I '$D(^PS(55,DFN,"IV",+ON,9)) W !!,$C(7),$C(7),"No labels have been dispensed for this order." N DIR S DIR(0)="E" D ^DIR Q
"RTN","PSIVRD",54,0)
 I $P(^PS(55,DFN,"IV",+ON,2),U,2)'=PSIVSN W !!,"WARNING ",$C(7),$C(7),$C(7),"This order is in a different IV room",!," from the one in which you are entering returned/destroyed!" S E1=$P(^(2),U,2),E=PSIVSN
"RTN","PSIVRD",55,0)
 D PAUSE^VALM1
"RTN","PSIVRD",56,0)
 S PSIVLBTP=2,PSJMORE=0,RDFLAG="ON" D EN^VALM("PSJ LM IV RETURN LABELS")
"RTN","PSIVRD",57,0)
 Q
"RTN","PSIVRD",58,0)
 ;
"RTN","PSIVRD",59,0)
 ;S RDFLAG="ON",X="Was this bottle RECYCLED or DESTROYED or CANCELLED ?^R^^RECYCLED,DESTROYED,CANCELLED" D ENQ^PSIV Q:X=U  I X["?" S HELP="RTDS" D ^PSIVHLP1 G PROCESS1
"RTN","PSIVRD",60,0)
 ;W ! S Y=$E(X),PSIVC=$S(Y="R":2,Y="D":3,1:4)
"RTN","PSIVRD",61,0)
 ;
"RTN","PSIVRD",62,0)
WARD ;Get the ward to associate returns or destroyed with.
"RTN","PSIVRD",63,0)
 I '$D(PSJIDLST) W !,"No labels are available" D PAUSE^VALM1 Q
"RTN","PSIVRD",64,0)
 K DIC I $D(^DPT(DFN,.1)) S DIC("B")=^DPT(DFN,.1)
"RTN","PSIVRD",65,0)
 S DIC("A")="Enter ward or ^OUTPATIENT: ",DIC(0)="AEQ",DIC=42,D="B" D IX^DIC G:X="^"!(X="") KILL I $P("^OUTPATIENT",X)="" W $P("^OUTPATIENT",X,2) S RDWARD=.5 G WARD1
"RTN","PSIVRD",66,0)
 S:Y>0 RDWARD=+Y I Y<0 G WARD
"RTN","PSIVRD",67,0)
 ;
"RTN","PSIVRD",68,0)
WARD1 ;
"RTN","PSIVRD",69,0)
 NEW PSIVCTD S PSIVCTD=""
"RTN","PSIVRD",70,0)
 S PSJY=$$PROMPT^PSIVLBRP()
"RTN","PSIVRD",71,0)
 Q:PSJY=""
"RTN","PSIVRD",72,0)
 S PSIVNOL=0
"RTN","PSIVRD",73,0)
 F PSJSEL=1:1 S PSJSEL1=$P(PSJY,",",PSJSEL) Q:PSJSEL1=""  S PSIVNOL=PSIVNOL+1
"RTN","PSIVRD",74,0)
 F PSJSEL=1:1 S PSJSEL1=$P(PSJY,",",PSJSEL) Q:PSJSEL1=""  D
"RTN","PSIVRD",75,0)
 . S PSJID=$G(PSJIDLST(PSJSEL1)) Q:PSJID=""
"RTN","PSIVRD",76,0)
 . S PSJIDNO=$P(PSJID,"V",2) D NOW^%DTC
"RTN","PSIVRD",77,0)
 . K DA,DR,DIE,DIC
"RTN","PSIVRD",78,0)
 . S DA=PSJIDNO,DA(1)=DFN,DIE="^PS(55,"_DA(1)_",""IVBCMA"","
"RTN","PSIVRD",79,0)
 . S DR="4////"_%_";5////"_$S(PSIVC=2:"RC",PSIVC=3:"DT",1:"CA")_";9////"_% D ^DIE
"RTN","PSIVRD",80,0)
 . K DA,DR,DIE,DIC
"RTN","PSIVRD",81,0)
 S LABELS=PSIVNOL,ACTION=$S(PSIVC=2:2,PSIVC=3:3,1:4) D ^PSIVLTR,^PSIVSTAT W "...Done."
"RTN","PSIVRD",82,0)
 Q
"RTN","PSIVRD",83,0)
NRD ;Ask number of bottles/bags
"RTN","PSIVRD",84,0)
 Q
"RTN","PSIVRD",85,0)
 ;NO LONGER USE
"RTN","PSIVRD",86,0)
 S MXMN=$P(^PS(55,DFN,"IV",+ON,9),U,3)
"RTN","PSIVRD",87,0)
NRD1 ;
"RTN","PSIVRD",88,0)
 Q
"RTN","PSIVRD",89,0)
 ;NO LONGER USE
"RTN","PSIVRD",90,0)
 R !,"Number of bottles: ",X:DTIME W:'$T $C(7) S:'$T X="^" G:"^"[X KILL I X?1."?" S HELP="REDT" D ^PSIVHLP G NRD1
"RTN","PSIVRD",91,0)
 I $S($E(X,$E(X)="-"+1,$L(X))'?1.N:1,X<-50:1,X>MXMN:1,1:'X) W $C(7),"  ??" G NRD1
"RTN","PSIVRD",92,0)
 ;
"RTN","PSIVRD",93,0)
 S PSIVNOL=+X,LABELS=PSIVNOL,ACTION=$S(PSIVC=2:2,PSIVC=3:3,1:4) D ^PSIVLTR,^PSIVSTAT W "...Done."
"RTN","PSIVRD",94,0)
 ;
"RTN","PSIVRD",95,0)
KILL ;
"RTN","PSIVRD",96,0)
 Q
"RTN","PSIVRD",97,0)
 ;NO LONGER USE
"RTN","PSIVRD",98,0)
 W:"^"[X $C(7),"NO ACTION TAKEN" K D,LABELS,MXMN,X,Y,PSIVNOL,HELP,DIC,RDFLAG,PSIVC
"RTN","PSIVRD",99,0)
 S VALMBCK="R"
"RTN","PSIVRD",100,0)
 Q
"RTN","PSIVSP")
0^31^B42203793^B41011288
"RTN","PSIVSP",1,0)
PSIVSP ;BIR/RGY,PR,CML3-DOSE PROCESSOR ; 1/3/12 3:36pm
"RTN","PSIVSP",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**30,37,41,50,56,74,83,111,133,138,134,213,229,279**;16 DEC 97;Build 150
"RTN","PSIVSP",3,0)
 ;
"RTN","PSIVSP",4,0)
 ; Reference to ^PS(51.1 is supported by DBIA #2177
"RTN","PSIVSP",5,0)
 ;
"RTN","PSIVSP",6,0)
EN ;
"RTN","PSIVSP",7,0)
 Q:'$D(X)
"RTN","PSIVSP",8,0)
 S ATZERO=0 I X["@",$P(X,"@",2)=0 S ATZERO=1,X=$P(X,"@")
"RTN","PSIVSP",9,0)
 D EN^PSGS0 S (P(9),PSIVSC1)=$S($G(X)]"":X,1:$G(P(9))),P(11)=$S($G(PSGS0Y):PSGS0Y,1:$G(P(11))),(XT,P(15))=$S(($G(PSGS0XT)!($G(PSGS0XT)="O")!($G(PSGS0XT)="D")):$G(PSGS0XT),1:$G(P(15)))
"RTN","PSIVSP",10,0)
 I $G(ATZERO) S P(7)=1
"RTN","PSIVSP",11,0)
 K ATZERO Q
"RTN","PSIVSP",12,0)
EN1 ;
"RTN","PSIVSP",13,0)
 S (PSIVAT,PSIVWAT,Y)="",XT=-1,X0=X,X=$S(X="ON CALL":X,X="ONCALL":X,X="ON-CALL":X,X="ONETIME":X,X="ONE-TIME":X,X="ONE TIME":X,X="1TIME":X,X="1 TIME":X,X="1-TIME":X,$L(X," ")<3:$P(X," "),1:$P(X," ",1,2))
"RTN","PSIVSP",14,0)
 S:$E(X)="^" X=$E(X,2,999) G:X="" Q S:(X["@0")&($$SCHREQ^PSJLIVFD(.P)) ATZERO=1 S X=$S(X["@0":$P(X,"@"),1:X),P(7)=$S($G(ATZERO):1,1:"") K ATZERO
"RTN","PSIVSP",15,0)
 I $S($D(^PS(51.1,"AC","PSJ",X)):1,1:$E($O(^(X)),1,$L(X))=X) D DIC I Y'<0 G SH
"RTN","PSIVSP",16,0)
NS0 S Y=""
"RTN","PSIVSP",17,0)
 I $E(X,1,2)="AD" S XT=-1 Q
"RTN","PSIVSP",18,0)
 I $E(X,1,3)="BID"!($E(X,1,3)="TID")!($E(X,1,3)="QID") S XT=1440\$F("BTQ",$E(X))
"RTN","PSIVSP",19,0)
 E  S:$E(X)="Q" X=$E(X,2,99) S:'X X=$E(X)["O"+1_X S I=+X,X=$P(X,I,2),XT=I*$S(X["'":1,(X["D"&(X'["AD"))!(X["AM")!(X["PM")!(X["HS"&(X'["THS")):1440,X["H"&(X'["TH"):60,X["AC"!(X["PC"):480,X["W":10080,X["M":40320,1:0),X=X0 D 
"RTN","PSIVSP",20,0)
 . I 'XT,X'="NOW",X'="STAT",X'="ONCE",X'="ONE-TIME",X'="ONE TIME",X'="ONETIME",X'="1-TIME",X'="1 TIME",X'="1TIME",Y="" S XT=-1
"RTN","PSIVSP",21,0)
SH ;
"RTN","PSIVSP",22,0)
 I +Y<1,$E(X0)'="^" W:$G(ON)'["P" "  ",$S(XT=0&($S("^NOW^STAT^ONCE^ONE-TIME^ONETIME^1TIME^1-TIME^"[(U_$P(X," ")_U):1,X["1 TIME":1,1:X["ONE TIME")):"(ONCE ONLY)",XT>0:"Nonstandard schedule",XT<0:"",1:"(??)") W:XT>0 " (",XT," MINUTES)"
"RTN","PSIVSP",23,0)
Q Q:X="ONE TIME"
"RTN","PSIVSP",24,0)
 N I S X0=$P(X," ")_$S($L(X0," ")-1:" ",1:"")_$P(X0," ",2,99) K:XT<0!($L(X0)>22) X S:$D(X) X=X0 K X0 S:$G(P(7)) XT="" Q
"RTN","PSIVSP",25,0)
NEWQ ;N I S X0=$P(X," ")_$S($L(X0," ")-1:" ",1:"")_$P(X0," ",2,99) K:XT<0!($L(X0)>22) X S:$D(X) X=X0 S:P(7) X=X0 K X0 K:XT>0&('P(7)) X Q
"RTN","PSIVSP",26,0)
 Q
"RTN","PSIVSP",27,0)
 ;
"RTN","PSIVSP",28,0)
 ;*229 Add Temp val for dose limit in IOE
"RTN","PSIVSP",29,0)
ENDL N PSIVLIMT W "   Dose limit ....  " S PSIVLIMT="a"_X,PSIVMIN=P(15)*X,PSIVSD=+P(2)
"RTN","PSIVSP",30,0)
 I PSIVMIN<0 W !!," --- There is something wrong with this order !!",!,"     Call inpatient supervisor ....." S Y=-1 K PSIVMIN Q
"RTN","PSIVSP",31,0)
 I P(15)'["D",P(4)="P"!(P(5))!(P(23)="P"),PSIVMIN=0,"^NOW^STAT^ONCE^ONE-TIME^ONE TIME^ON CALL^ONETIME^1TIME^1 TIME^1-TIME^"'[(U_P(9)_U) D DLP G QDL
"RTN","PSIVSP",32,0)
 ;*229 DOW Calc and dose lim should match CPRS, if it's vol limit, we leave old functionality
"RTN","PSIVSP",33,0)
 I $G(P(9))]"",$G(P(11))]"" D ENSTOP^PSIVCAL S Y=X I 1 ;*229 ENSTOP^PSIVCAL returns X, we wanted Y.
"RTN","PSIVSP",34,0)
 E  D ENT^PSIVWL
"RTN","PSIVSP",35,0)
QDL I $D(X) S X=Y X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2) S Y=X
"RTN","PSIVSP",36,0)
 Q
"RTN","PSIVSP",37,0)
DLP ;
"RTN","PSIVSP",38,0)
 S X=X+1,$P(PSIVSD,".",2)=$P(PSIVSD,".",2)_$E("0000",1,4-$L($P(PSIVSD,".",2))) D CHK S X2=0,Y=1 I X<2 S Y=+PSIVSD G QDLP
"RTN","PSIVSP",39,0)
 I $P(PSIVSD,".",2)>$P(P(11),"-",$L(P(11),"-")) S X2=1 G OV
"RTN","PSIVSP",40,0)
 G:$P(P(11),"-")>$P(PSIVSD,".",2) OV
"RTN","PSIVSP",41,0)
 F Y=1:1 S X1=$P(P(11),"-",Y) I X1=$P(PSIVSD,".",2)!($P(PSIVSD,".",2)<X1) Q
"RTN","PSIVSP",42,0)
OV I P(11)="" W $C(7)," ???",!?15,"*** You have not defined any administration times !!" K X Q
"RTN","PSIVSP",43,0)
 F Y=Y:1 S:$P(P(11),"-",Y)="" X2=X2+1,Y=0,X=X+1 S X=X-1 Q:X<1
"RTN","PSIVSP",44,0)
 S X=PSIVSD\1 I X2>0 S X1=PSIVSD D C^%DTC S X=$P(X,".") ; install with version 17.3 of fileman
"RTN","PSIVSP",45,0)
 S Y=+(X_"."_$P(P(11),"-",Y))
"RTN","PSIVSP",46,0)
QDLP K X1,X2 Q
"RTN","PSIVSP",47,0)
 ;
"RTN","PSIVSP",48,0)
ENI ;
"RTN","PSIVSP",49,0)
 K:$L(X)<1!($L(X)>30)!(X["""")!($A(X)=45) X I '$D(X)!'$D(P(4)) Q
"RTN","PSIVSP",50,0)
 ;*229 Reset ATZERO flag.
"RTN","PSIVSP",51,0)
 I $P(X,"@",2)'=0!'$$SCHREQ^PSJLIVFD(.P) S P(7)=""
"RTN","PSIVSP",52,0)
 I P(4)="P"!(P(5))!(P(23)="P") Q:'X  S X="INFUSE OVER "_X_" MINUTE"_$S(X>1:"S",1:"") W "   ",X Q
"RTN","PSIVSP",53,0)
 I $E(X)="." K X Q  ;Enforce leading zero.
"RTN","PSIVSP",54,0)
 I X'=+X!(X'=0_+X),X["@",($P(X,"@",2,999)'=+$P(X,"@",2,999)!(+$P(X,"@",2,999)<0)) K X Q
"RTN","PSIVSP",55,0)
 S SPSOL=$O(DRG("SOL",0)) I 'SPSOL K SPSOL,X W "  You must define at least one solution !!" Q
"RTN","PSIVSP",56,0)
 I X=+X!(X=0_+X),X'["@" S X=X_" ml/hr" W " ml/hr" D SPSOL S P(15)=$S('X:0,1:SPSOL\X*60+(SPSOL#X/X*60+.5)\1) K SPSOL Q
"RTN","PSIVSP",57,0)
 S SPSOL=$S(($P(X,"@",2)?1.N):$P(X,"@",2),1:$G(P("NUMLBL"))) I SPSOL S P("NUMLBL")=+SPSOL
"RTN","PSIVSP",58,0)
 S:$P(X,"@")=+X!($P(X,"@")=0_+X) $P(X,"@")=$P(X,"@")_" ml/hr" W "   ",+SPSOL," Label",$S(SPSOL'=1:"s",1:"")," per day",!?15,"at an infusion rate of: ",$P(X,"@") S P(15)=$S('SPSOL:0,1:1440/SPSOL\1) K SPSOL
"RTN","PSIVSP",59,0)
 I X["@",$P(X,"@",2)=0,$$SCHREQ^PSJLIVFD(.P) S P(7)=1  ; Set ATZERO flag
"RTN","PSIVSP",60,0)
 D EXPINF^PSIVEDT1(.X)
"RTN","PSIVSP",61,0)
 Q
"RTN","PSIVSP",62,0)
SPSOL S SPSOL=0 F XXX=0:0 S XXX=$O(DRG("SOL",XXX)) Q:'XXX  S SPSOL=SPSOL+$P(DRG("SOL",XXX),U,3)
"RTN","PSIVSP",63,0)
 K XXX Q
"RTN","PSIVSP",64,0)
CHK F Y=1:1 Q:$L(P(11))>240!($P(P(11),"-",Y)="")  S $P(P(11),"-",Y)=$P(P(11),"-",Y)_$E("0000",1,4-$L($P(P(11),"-",Y)))
"RTN","PSIVSP",65,0)
 Q
"RTN","PSIVSP",66,0)
 ;
"RTN","PSIVSP",67,0)
DIC ; 51.1 look-up
"RTN","PSIVSP",68,0)
 N PSJSCH S PSJSCH=X I '$D(WSCHADM) N VAIP D IN5^VADPT S WSCHADM=VAIP(5),X=PSJSCH
"RTN","PSIVSP",69,0)
 K DIC S DIC="^PS(51.1,",DIC(0)=$E("E",'$D(NOECH))_"ISZ"
"RTN","PSIVSP",70,0)
 S DIC("W")="W ""  "","_$S('$D(WSCHADM):"$P(^(0),""^"",2)",'+WSCHADM:"$P(^(0),""^"",2)",1:"$S($D(^PS(51.1,+Y,1,+WSCHADM,0)):$P(^(0),""^"",2),1:$P(^PS(51.1,+Y,0),""^"",2))"),D="APPSJ" S:$D(PSIVSPQF) DIC(0)=DIC(0)_"O"
"RTN","PSIVSP",71,0)
 D IX^DIC K DIC
"RTN","PSIVSP",72,0)
 S:$D(DIE)#2 DIC=DIE Q:Y<0
"RTN","PSIVSP",73,0)
 S X=Y(0,0),ZZY=Y,(XT,Y)="" I $D(WSCHADM),$D(^PS(51.1,+ZZY,1,+WSCHADM,0)),$P(^(0),"^",2)]"" S (PSIVWAT,Y)=$P(^(0),"^",2)
"RTN","PSIVSP",74,0)
 K ZZY,WSCHADM S:Y="" (X,PSIVSC1)=$P(Y(0),U),(PSIVAT,Y)=$P(Y(0),"^",2) S XT=$P(Y(0),"^",3) Q
"RTN","PSIVSP",75,0)
 ;
"RTN","PSIVSP",76,0)
ORINF ;  OERR input transform for Infusion Rate
"RTN","PSIVSP",77,0)
 ;  X=data
"RTN","PSIVSP",78,0)
 N INFUSE
"RTN","PSIVSP",79,0)
 K:$L(X)<1!($L(X)>30)!(X["""")!($A(X)=45) X I '$D(X) Q
"RTN","PSIVSP",80,0)
 I X?.E1L.E S INFUSE=$$ENLU^PSGMI(X) Q:(INFUSE="TITRATE")!(INFUSE="BOLUS")!($P(INFUSE," ")="INFUSE")!($P(INFUSE," ")="Infuse")
"RTN","PSIVSP",81,0)
 Q:(X="TITRATE")!(X="BOLUS")!($P(X," ")="INFUSE")!($P(X," ")="Infuse")
"RTN","PSIVSP",82,0)
 I X["=" D  Q   ; NOIS LOU-0501-42191
"RTN","PSIVSP",83,0)
 .N X2,X1 S X1=$P(X,"="),X2=$P(X,"=",2)
"RTN","PSIVSP",84,0)
 .I X1["ML/HR",(+X1=$P(X1,"ML/HR"))!(+X1=$P(X1," ML/HR")) D
"RTN","PSIVSP",85,0)
 ..S X1=$TR(X1,"ML/HR","ml/hr")
"RTN","PSIVSP",86,0)
 .I X2["ML/HR",(+X2=$P(X2,"ML/HR"))!(+X2=$P(X2," ML/HR")) D
"RTN","PSIVSP",87,0)
 ..S X2=$TR(X2,"ML/HR","ml/hr")
"RTN","PSIVSP",88,0)
 .I X1[" ml/hr",(+X1=$P(X1," ml/hr")) D
"RTN","PSIVSP",89,0)
 ..S X1=$P(X1," ml/hr")_$P(X1," ml/hr",2,9999)
"RTN","PSIVSP",90,0)
 .I X2[" ml/hr",(+X2=$P(X2," ml/hr")) D
"RTN","PSIVSP",91,0)
 ..S X2=$P(X2," ml/hr")_$P(X2," ml/hr",2,9999)
"RTN","PSIVSP",92,0)
 .I X1["ml/hr",(+X1=$P(X1,"ml/hr")) D
"RTN","PSIVSP",93,0)
 ..S X1=$P(X1,"ml/hr")_$P(X1,"ml/hr",2,9999)
"RTN","PSIVSP",94,0)
 .I X2["ml/hr",(+X2=$P(X2,"ml/hr")) D
"RTN","PSIVSP",95,0)
 ..S X2=$P(X2,"ml/hr")_$P(X2,"ml/hr",2,9999)
"RTN","PSIVSP",96,0)
 .I X2'=+X2 D
"RTN","PSIVSP",97,0)
 ..I X2>0&(X2<1) Q
"RTN","PSIVSP",98,0)
 ..I ($P(X2,"@",2,999)'=+$P(X2,"@",2,999)!(+$P(X2,"@",2,999)<0)) K X Q
"RTN","PSIVSP",99,0)
 .I X1>0&(X1<1) I +X1="."_$P(X1,".",2) S X1=X1_" ml/hr"
"RTN","PSIVSP",100,0)
 .I X2>0&(X2<1) I +X2="."_$P(X2,".",2) S X2=X2_" ml/hr"
"RTN","PSIVSP",101,0)
 .I X1=+X1 S X1=X1_" ml/hr"
"RTN","PSIVSP",102,0)
 .I X2=+X2 S X2=X2_" ml/hr"
"RTN","PSIVSP",103,0)
 .S:$P(X2,"@")=+X2 $P(X2,"@")=$P(X2,"@")_" ml/hr"
"RTN","PSIVSP",104,0)
 .S X=X1_"="_X2
"RTN","PSIVSP",105,0)
 I X["ML/HR",(+X=$P(X,"ML/HR"))!(+X=$P(X," ML/HR")) S X=$TR(X,"ML/HR","ml/hr")
"RTN","PSIVSP",106,0)
 I X[" ml/hr",+X=$P(X," ml/hr") S X=$P(X," ml/hr")_$P(X," ml/hr",2,9999)
"RTN","PSIVSP",107,0)
 I X["ml/hr",+X=$P(X,"ml/hr") S X=$P(X,"ml/hr")_$P(X,"ml/hr",2,9999)
"RTN","PSIVSP",108,0)
 I X>0,X<1 D  Q
"RTN","PSIVSP",109,0)
 .I X["ML/HR",(+X=$P($P(X,"ML/HR"),".",2))!(+X=$P($P(X," ML/HR"),".",2)) S X=$TR(X,"ML/HR","ml/hr")
"RTN","PSIVSP",110,0)
 .I X[" ml/hr",(+X=$P($P(X," ml/hr"),".",2)) S X=$P(X," ml/hr")_$P(X," ml/hr",2,9999)
"RTN","PSIVSP",111,0)
 .I X["ml/hr",+X=$P(X,"ml/hr") S X=$P(X,"ml/hr")_$P(X,"ml/hr",2,9999)
"RTN","PSIVSP",112,0)
 .I +X=X S X=X_" ml/hr"
"RTN","PSIVSP",113,0)
 .I $P(X,0,2)=+X S X=X_" ml/hr"
"RTN","PSIVSP",114,0)
 .S X=0_+X_$P(X,+X,2)
"RTN","PSIVSP",115,0)
 I '(X>0&X<1) I X'=+X,($P(X,"@",2,999)'=+$P(X,"@",2,999)!(+$P(X,"@",2,999)<0)) K X Q
"RTN","PSIVSP",116,0)
 I X=+X S X=X_" ml/hr" Q
"RTN","PSIVSP",117,0)
 S:$P(X,"@")=+X $P(X,"@")=$P(X,"@")_" ml/hr"
"RTN","PSIVSP",118,0)
 Q
"RTN","PSIVUTL")
0^47^B35163625^B30828184
"RTN","PSIVUTL",1,0)
PSIVUTL ;BIR/MLM-IV UTILITIES ;07 SEP 97 / 2:17 PM 
"RTN","PSIVUTL",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**69,58,81,85,110,133,181,263,275,279**;16 DEC 97;Build 150
"RTN","PSIVUTL",3,0)
 ;
"RTN","PSIVUTL",4,0)
 ; Reference to ^DD("DD" is supported by DBIA 10017.
"RTN","PSIVUTL",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSIVUTL",6,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSIVUTL",7,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVUTL",8,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVUTL",9,0)
 ; Reference to ^DIC is supported by DBIA 10006.
"RTN","PSIVUTL",10,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177.
"RTN","PSIVUTL",11,0)
 ;
"RTN","PSIVUTL",12,0)
DRGSC(Y,PSJSCT) ; Called to set DIC("S") when selecting  Orderable Items.
"RTN","PSIVUTL",13,0)
 N OK,ND,NDU,NDI S OK=0
"RTN","PSIVUTL",14,0)
 S ND=$G(^PS(50.7,+Y,0))
"RTN","PSIVUTL",15,0)
 ;I $P(ND,U,3) S OK=$S('$P(ND,U,4):1,$P(ND,U,4)>DT:1,1:0)
"RTN","PSIVUTL",16,0)
 S OK=$S('$P(ND,U,4):1,$P(ND,U,4)>DT:1,1:0)
"RTN","PSIVUTL",17,0)
 Q OK
"RTN","PSIVUTL",18,0)
 ;
"RTN","PSIVUTL",19,0)
IVDRGSC(Y) ; Set DIC("S") for IV additive/solution selection.
"RTN","PSIVUTL",20,0)
 ; Naked reference below refers to full reference in Y, which is either ^PS(52.6, or ^PS(52.7
"RTN","PSIVUTL",21,0)
 N Y S Y="S X(1)=$G(^(0)),X(2)=$G(^(""I"")) I $S('X(2):1,X(2)>DT:1,1:0),$D(^PSDRUG(+$P(X(1),U,2),0)) S X(2)=$G(^(""I"")) I $S('+$P(X(1),U,11):0,'X(2):1,X(2)>DT:1,1:0)"
"RTN","PSIVUTL",22,0)
 Q Y
"RTN","PSIVUTL",23,0)
 ;
"RTN","PSIVUTL",24,0)
ENU(Y) ;Get IV additive strength.
"RTN","PSIVUTL",25,0)
 N X S X=$P(^PS(52.6,+Y,0),U,3),Y=$$CODES^PSIVUTL(X,52.6,2)
"RTN","PSIVUTL",26,0)
 Q Y
"RTN","PSIVUTL",27,0)
 ;
"RTN","PSIVUTL",28,0)
CODES(PSJCD,PSJF,PSJFLD) ; Get name from code. 
"RTN","PSIVUTL",29,0)
 ; PSJF = one of following files: ^PS(55, ^PS(53.1, ^PS(52.6
"RTN","PSIVUTL",30,0)
 D FIELD^DID(PSJF,PSJFLD,"","POINTER","PSJDD")
"RTN","PSIVUTL",31,0)
 S Y=$G(PSJDD("POINTER")) K PSJDD
"RTN","PSIVUTL",32,0)
 S Y=$P($P(";"_Y,";"_PSJCD_":",2),";")
"RTN","PSIVUTL",33,0)
 Q Y
"RTN","PSIVUTL",34,0)
 ;
"RTN","PSIVUTL",35,0)
CODES1(PSJCD,PSJF,PSJFLD)       ;Check to see if code is valid.
"RTN","PSIVUTL",36,0)
 ; PSJF = one of following files: ^PS(55, ^PS(53.1, ^PS(52.6
"RTN","PSIVUTL",37,0)
 D FIELD^DID(PSJF,PSJFLD,"","POINTER","PSJDD")
"RTN","PSIVUTL",38,0)
 I PSJDD("POINTER")'[PSJCD_":"  K PSJDD Q 0
"RTN","PSIVUTL",39,0)
 K PSJDD Q 1
"RTN","PSIVUTL",40,0)
 ;
"RTN","PSIVUTL",41,0)
CODES2(PSJF,PSJFLD)     ;Get field name
"RTN","PSIVUTL",42,0)
 ; PSJF = one of following files: ^PS(55, ^PS(53.1, ^PS(52.6
"RTN","PSIVUTL",43,0)
 D FIELD^DID(PSJF,PSJFLD,"","LABEL","PSJDD")
"RTN","PSIVUTL",44,0)
 Q PSJDD("LABEL")
"RTN","PSIVUTL",45,0)
 ;
"RTN","PSIVUTL",46,0)
GTPCI(Y) ; Set up "work" area for provider comments.
"RTN","PSIVUTL",47,0)
 N DIC,DINUM,DLAYGO,X S DIC="^PS(53.45,",DIC(0)="LNZ",DLAYGO=53.45,(DINUM,X)=+DUZ D ^DIC
"RTN","PSIVUTL",48,0)
 Q Y
"RTN","PSIVUTL",49,0)
 ;
"RTN","PSIVUTL",50,0)
WDTE(Y) ; Format and print date.
"RTN","PSIVUTL",51,0)
 I 'Y S Y="******"
"RTN","PSIVUTL",52,0)
 E  X ^DD("DD") S Y=$P(Y,"@")_" "_$P($P(Y,"@",2),":",1,2)
"RTN","PSIVUTL",53,0)
 Q Y
"RTN","PSIVUTL",54,0)
GTOT(Y) ; Get order type & protocol
"RTN","PSIVUTL",55,0)
 I ($G(ON55)["V"),$G(DFN) D GTNUMLBL(DFN,ON55)
"RTN","PSIVUTL",56,0)
 N DRGI,DRGT
"RTN","PSIVUTL",57,0)
 S P("OT")=$S(Y="A":"F",Y="H":"H",1:"I")
"RTN","PSIVUTL",58,0)
 I P("OT")="F" F DRGT="AD","SOL" F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI  I '$P(DRG(DRGT,DRGI),U,5) S P("OT")="I" Q
"RTN","PSIVUTL",59,0)
 Q
"RTN","PSIVUTL",60,0)
 ;
"RTN","PSIVUTL",61,0)
PIV(ON) ; Display IV orders.
"RTN","PSIVUTL",62,0)
 N DRG,ON55,P,PSJORIFN,TYP,X,Y S TYP="?" I ON["V" D
"RTN","PSIVUTL",63,0)
 .S Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,4,5,8,9,17,23,25 S P(X)=$P(Y,U,X)
"RTN","PSIVUTL",64,0)
 .S TYP=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I TYP'="O" S TYP="C"
"RTN","PSIVUTL",65,0)
 .S ON55=ON,P("OT")=$S(P(4)="A":"F",P(4)="H":"H",1:"I") D GTDRG^PSIVORFB,GTOT^PSIVUTL(P(4))
"RTN","PSIVUTL",66,0)
 .W $S($P($G(^PS(55,DFN,"IV",+ON,.2)),U,4)="D":" d",1:"  ")
"RTN","PSIVUTL",67,0)
 .S X=$G(^PS(55,DFN,"IV",+ON,4)) I +PSJSYSU,'+$P(X,U,$S(+PSJSYSU=3:4,1:++PSJSYSU)) W "->"
"RTN","PSIVUTL",68,0)
 I ON=+ON N O S O="" F  S O=$O(^PS(53.1,"ACX",ON,O)) Q:O=""  D
"RTN","PSIVUTL",69,0)
 . S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+O,0)),U,9),Y=$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U) D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4)) D PIV(O_"P") W !
"RTN","PSIVUTL",70,0)
 I ON["P" D GETP(ON) D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4)) I $E(P("OT"))="I" D  Q
"RTN","PSIVUTL",71,0)
 . I $G(PSJCLOR) N ND2 S ND2=$G(^PS(53.1,+ON,2)) S P(2)=$P(ND2,"^",2),P(3)=$P(ND2,"^",4)
"RTN","PSIVUTL",72,0)
 . NEW MARX,PSIVX D DRGDISP^PSJLMUT1(PSGP,+ON_"P",40,54,.MARX,0)
"RTN","PSIVUTL",73,0)
 . F PSIVX=0:0 S PSIVX=$O(MARX(PSIVX)) Q:'PSIVX  W @($S(PSIVX=1:"?9",1:"!?11")),MARX(PSIVX) D:PSIVX=1 PIV1
"RTN","PSIVUTL",74,0)
 NEW DRGX S DRGX=0 F  S DRGX=$O(DRG("AD",DRGX)) Q:'DRGX  D PIVAD
"RTN","PSIVUTL",75,0)
SOL ;
"RTN","PSIVUTL",76,0)
 NEW NAME
"RTN","PSIVUTL",77,0)
 S DRGX=0 F  S DRGX=$O(DRG("SOL",DRGX)) Q:'DRGX  D
"RTN","PSIVUTL",78,0)
 . D NAME(DRG("SOL",DRGX),39,.NAME,0)
"RTN","PSIVUTL",79,0)
 . W:($D(DRG("AD",1))!(DRGX>1)) ! W:DRGX=1 ?9,"in "
"RTN","PSIVUTL",80,0)
 . F X=0:0 S X=$O(NAME(X)) Q:'X  W ?12 W NAME(X) I X=1,DRGX=1,'$D(DRG("AD",1)) D PIV1
"RTN","PSIVUTL",81,0)
 Q
"RTN","PSIVUTL",82,0)
PIVAD ; Print IV Additives.
"RTN","PSIVUTL",83,0)
 NEW NAME,PSGX
"RTN","PSIVUTL",84,0)
 D NAME(DRG("AD",DRGX),39,.NAME,1)
"RTN","PSIVUTL",85,0)
 F PSGX=0:0 S PSGX=$O(NAME(PSGX)) Q:'PSGX  W:(DRGX'=1!(PSGX'=1)) ! W ?9,NAME(PSGX) I PSGX=1,DRGX=1 D PIV1
"RTN","PSIVUTL",86,0)
 Q
"RTN","PSIVUTL",87,0)
 ;
"RTN","PSIVUTL",88,0)
PIV1 ; Print Sched type, start/stop dates, and status.
"RTN","PSIVUTL",89,0)
 F X=2,3 S P(X)=$E($$ENDTC^PSGMI(P(X)),1,$S($D(PSJEXTP):8,1:5))
"RTN","PSIVUTL",90,0)
 I '$D(PSJEXTP) W ?50,TYP,?53,P(2),?60,P(3),?67,$S($G(P(25))]"":P(25),1:P(17)) Q
"RTN","PSIVUTL",91,0)
 W ?50,TYP,?53,P(2),?63,P(3),?73,$S($G(P(25))]"":P(25),1:P(17))
"RTN","PSIVUTL",92,0)
 Q
"RTN","PSIVUTL",93,0)
59 ; Validate the Infusion rate entered using IV Quick order code.
"RTN","PSIVUTL",94,0)
 N I F I=2,3,5,7,8,9,11,15,23 S P(I)=""
"RTN","PSIVUTL",95,0)
 S P(4)="A",P(8)=$P($G(^PS(57.1,PSJQO,1)),U,5)
"RTN","PSIVUTL",96,0)
 I $G(^PS(57.1,PSJQO,4,1,0)) S DRG("SOL",1)=^(0),DRG("SOL",0)=1
"RTN","PSIVUTL",97,0)
 I X["?" S F1=53.1,F2=59 D ENHLP^PSIVORC1 G 59
"RTN","PSIVUTL",98,0)
 I X]"" D ENI^PSIVSP S:$D(X) P(8)=X
"RTN","PSIVUTL",99,0)
 K F1,F2
"RTN","PSIVUTL",100,0)
 Q
"RTN","PSIVUTL",101,0)
WRTDRG(X,L)       ; Format and print drug name, strength and bottle no.
"RTN","PSIVUTL",102,0)
 N Y S Y=" "_$P(X,U,3) S:$P(X,U,4) Y=Y_" ("_$P(X,U,4)_")"
"RTN","PSIVUTL",103,0)
 Q $E($P(X,U,2),1,(L-$L(Y)))_Y
"RTN","PSIVUTL",104,0)
 ;
"RTN","PSIVUTL",105,0)
NAME(X,L,MARX,AD)        ; Format Additive display.
"RTN","PSIVUTL",106,0)
 ;INPUT : X=DRG("AD",DRG)  L=Display length   AD=for Additive(1/0)
"RTN","PSIVUTL",107,0)
 ;OUTPUT: AD(X)  if X=2 that means there is a second line to display
"RTN","PSIVUTL",108,0)
 N Y K MARX S Y=$P(X,U,3) S:(AD&($P(X,U,4)]"")) Y=Y_" ("_$P(X,U,4)_")"
"RTN","PSIVUTL",109,0)
 ;* S:'AD Y=Y_" "_$S(P(4)="P"!($G(P(23))="P")!$G(P(5)):P(9),1:$P(P(8),"@"))
"RTN","PSIVUTL",110,0)
 I 'AD!('$O(DRG("SOL",0))) D
"RTN","PSIVUTL",111,0)
 .I $G(PSJL)["  in" S Y=Y_" "_$S(P(4)="P"!($G(P(23))="P")!$G(P(5)):P(9),1:$P(P(8),"@")) Q
"RTN","PSIVUTL",112,0)
 .I $G(DRGX)]"",DRGX'>1 S Y=Y_"  "_$S(P(4)="P"!($G(P(23))="P")!$G(P(5)):P(9),1:$P(P(8),"@")) Q
"RTN","PSIVUTL",113,0)
 ;I ($L($P(X,U,2))+$L(Y)+1)>L S NAME(1)=$P(X,U,2),NAME(2)="   "_Y Q
"RTN","PSIVUTL",114,0)
 I ($L($P(X,U,2))+$L(Y)+1)>L D TXT^PSGMUTL($P(X,U,2)_" "_Y,L) S:AD MARX(2)="   "_MARX(2) Q
"RTN","PSIVUTL",115,0)
 S MARX(1)=$P(X,U,2)_" "_Y
"RTN","PSIVUTL",116,0)
 Q
"RTN","PSIVUTL",117,0)
 ;
"RTN","PSIVUTL",118,0)
INTERVAL(IVAR) ;
"RTN","PSIVUTL",119,0)
 N P,X,PSGOES M P=IVAR S X=$G(P(9)),PSGOES=1
"RTN","PSIVUTL",120,0)
 D EN^PSIVSP S IVAR(15)=$S($G(P(15)):P(15),1:1440)
"RTN","PSIVUTL",121,0)
 Q IVAR(15)
"RTN","PSIVUTL",122,0)
 ;
"RTN","PSIVUTL",123,0)
DOW(SCHED) ;
"RTN","PSIVUTL",124,0)
 Q:SCHED="" 0
"RTN","PSIVUTL",125,0)
 N P9,PSIVX,X S PSIVX=0 S P9=SCHED
"RTN","PSIVUTL",126,0)
 ; Use schedule validator
"RTN","PSIVUTL",127,0)
 S X=SCHED D DW^PSGS0 I $G(X)="" Q 0
"RTN","PSIVUTL",128,0)
 I +$O(^PS(51.1,"APPSJ",SCHED,0)) S PSIVX=1 S P9=$P(SCHED,"@") F X=1:1:$L(P9,"-") D  Q:'$G(PSIVX)
"RTN","PSIVUTL",129,0)
 . I '("MON,TUE,WED,THU,FRI,SAT,SUN"[$P(P9,"-",X)) S PSIVX=0 Q
"RTN","PSIVUTL",130,0)
 Q:PSIVX +PSIVX
"RTN","PSIVUTL",131,0)
 I '$D(^PS(51.1,"APPSJ",SCHED)) S PSIVX=1,P9=$P(SCHED,"@") F X=1:1:$L(P9,"-") D  Q:'$G(PSIVX)
"RTN","PSIVUTL",132,0)
 . I '(",MO,TU,WE,TH,FR,SA,SU,"[(","_$P(P9,"-",X)_",")) S PSIVX=0 Q
"RTN","PSIVUTL",133,0)
 Q +PSIVX
"RTN","PSIVUTL",134,0)
 ;
"RTN","PSIVUTL",135,0)
GETP(ON) ; Populate P array with data from order ON
"RTN","PSIVUTL",136,0)
 I ON["P" S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+ON,0)),U,9),Y=$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U) D
"RTN","PSIVUTL",137,0)
 .I $G(PSJCLOR) N ND2 S ND2=$G(^PS(53.1,+ON,2)) S P(2)=$P(ND2,"^",2),P(3)=$P(ND2,"^",4) S TYP=$P(^PS(53.1,+ON,0),"^",7)
"RTN","PSIVUTL",138,0)
 Q
"RTN","PSIVUTL",139,0)
GTNUMLBL(DFN,ON) ; Get Number of Labels Per Day
"RTN","PSIVUTL",140,0)
 Q:'$G(DFN)  Q:'$G(ON)
"RTN","PSIVUTL",141,0)
 S:'$D(P("NUMLBL")) P("NUMLBL")=$S(($G(^PS(55,DFN,"IV",+ON55,11))?1.N):+$G(^(11)),($G(P(8))]""):$P($G(P(8)),"@",2),1:"")
"RTN","PSIVUTL",142,0)
 S:(P("NUMLBL")'?1.N) P("NUMLBL")=""
"RTN","PSIVUTL",143,0)
 N PSJABBIN S PSJABBIN=$P($G(P(8)),"@") D
"RTN","PSIVUTL",144,0)
 .Q:(PSJABBIN?1"INFUSE OVER "1.N1" MINUTES")
"RTN","PSIVUTL",145,0)
 .D EXPINF^PSIVEDT1(.PSJABBIN,1) S P(8)=PSJABBIN_$S($G(P("NUMLBL"))?1.N:"@"_P("NUMLBL"),1:"")
"RTN","PSIVUTL",146,0)
 Q
"RTN","PSJAC")
0^41^B18623217^B14549203
"RTN","PSJAC",1,0)
PSJAC ;BIR/CML3-INPATIENT INFORMATION ;28 Apr 98 / 9:02 AM
"RTN","PSJAC",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**8,10,50,127,181,275,279**;16 DEC 97;Build 150
"RTN","PSJAC",3,0)
 ;
"RTN","PSJAC",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJAC",5,0)
 ;
"RTN","PSJAC",6,0)
 S DFN=PSGP,PSJACPF=1 G CHK
"RTN","PSJAC",7,0)
 ;
"RTN","PSJAC",8,0)
ENBOTH ;
"RTN","PSJAC",9,0)
 S PSJACPF=11 G CHK
"RTN","PSJAC",10,0)
 ;
"RTN","PSJAC",11,0)
ENIV ;
"RTN","PSJAC",12,0)
 N I,J,JJ,ON,PSJRBXX,X,X1,X2,X,Y S PSJACPF=10,PSGP=DFN
"RTN","PSJAC",13,0)
 ;
"RTN","PSJAC",14,0)
CHK ;
"RTN","PSJAC",15,0)
 ;Check if 5.0 order conversion should be run for the selected patient.
"RTN","PSJAC",16,0)
 ;I '$P($G(^PS(55,DFN,5.1)),U,11) D CONVERT^PSJUTL1(DFN,$S($E(IOST,1)="C":1,1:0))
"RTN","PSJAC",17,0)
 ;/Commented out in PSJ*5*50.  No longer needed
"RTN","PSJAC",18,0)
 ;/F  S PSJRBXX=$$OTF^OR3CONV(DFN,$S($E(IOST,1)="C":0,1:1)) Q:+PSJRBXX'<0  D
"RTN","PSJAC",19,0)
 ;/.I +PSJRBXX=-1 W:$E(IOST,1)="C" !,$P(PSJRBXX,"^",2) H 4
"RTN","PSJAC",20,0)
 ;Converting IV order to new OI with POE if not done so when installed PSJ*5*50
"RTN","PSJAC",21,0)
 D CNIV^PSJUTL1(DFN)
"RTN","PSJAC",22,0)
 ;I $D(^PS(55,DFN,0)),'$P($G(^PS(55,DFN,0)),U,6) D EN^PSOHLUP(DFN)
"RTN","PSJAC",23,0)
 S VA200=1 D INP^VADPT
"RTN","PSJAC",24,0)
 I VAIN(4) S:PSJACPF#2 PSJPCAF=1_"^"_VAIN(1),PSJPWD=+VAIN(4),PSJPWDN=$P(VAIN(4),"^",2),PSJPTS=+VAIN(3),PSJPTSP=+VAIN(2),PSJPRB=VAIN(5),PSJPAD=+VAIN(7),PSJPDX=VAIN(9),PSJPTD=$S($D(^PS(55,PSGP,5.1)):$P(^(5.1),"^",4),1:""),PSJPDD="" G CNV
"RTN","PSJAC",25,0)
 S VAIP("D")="L" D IN5^VADPT G:PSJACPF[0 CNV
"RTN","PSJAC",26,0)
 S PSJPCAF="",PSJPAD=+VAIP(13,1)
"RTN","PSJAC",27,0)
 S PSGID=+VAIP(3),X=+VAIP(4)=12!(+VAIP(4)=38)!($G(VADM(6))),PSJPWD=+VAIP(5),PSJPWDN=$P(VAIP(5),"^",2),PSJPRB=$P(VAIP(6),"^",2),PSJPTSP=+VAIP(7),PSJPTS=+VAIP(8),PSJPDX=VAIP(9),PSJPTD="",PSJPDD=PSGID_"^"_$$ENDTC^PSGMI(PSGID) S:X PSJPDD=PSJPDD_"^1"
"RTN","PSJAC",28,0)
 ;
"RTN","PSJAC",29,0)
CNV ;
"RTN","PSJAC",30,0)
 D DEM^VADPT,HTWT(PSGP)
"RTN","PSJAC",31,0)
 I PSJACPF#2 S PSGP(0)=VADM(1),PSJPSSN=VADM(2),PSJPDOB=+VADM(3),PSJPAGE=VADM(4),PSJPSEX=$S(VADM(5)]"":VADM(5),1:"?^____"),PSJPPID=VA("PID"),PSJPBID=VA("BID")
"RTN","PSJAC",32,0)
 I PSJACPF#2 D
"RTN","PSJAC",33,0)
 .I $D(PSJY2K) D  Q
"RTN","PSJAC",34,0)
 ..F X="PSJPAD","PSJPDOB","PSJPTD" I @X S $P(@X,"^",2)=$$ENDTC2^PSGMI(+@X)
"RTN","PSJAC",35,0)
 .F X="PSJPAD","PSJPDOB","PSJPTD" I @X S $P(@X,"^",2)=$$ENDTC^PSGMI(+@X)
"RTN","PSJAC",36,0)
 ;
"RTN","PSJAC",37,0)
WP ; ward parameters
"RTN","PSJAC",38,0)
 G:$D(PSJACNWP) DONE S PSJSYSW0="",PSJSYSW=0 I $G(PSJPWD) S PSJSYSW=+$O(^PS(59.6,"B",PSJPWD,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJAC",39,0)
 S PSJSYSL="",X=$P(PSJSYSU,";",3)>1 S PSJSYSL=$S(X=0:$P(PSJSYSW0,"^",12),1:$P(PSJSYSW0,"^",16)) G:$D(PSJACND) DONE
"RTN","PSJAC",40,0)
 I PSJSYSL D
"RTN","PSJAC",41,0)
 .S:X X='$P($G(PSJSYSP0),"^",10) S IOP=$S($P($G(PSJSYSP0),"^",13)]"":$P($G(PSJSYSP0),"^",13),$P(PSJSYSW0,"^",19+X)]"":$P(PSJSYSW0,"^",19+X),1:"") I IOP]"" D
"RTN","PSJAC",42,0)
 ..S IOP="`"_IOP K %ZIS S %ZIS="NQ" D ^%ZIS S:'POP $P(PSJSYSL,"^",2,3)=ION_"^"_IO D HOME^%ZIS
"RTN","PSJAC",43,0)
 ;
"RTN","PSJAC",44,0)
 D CLINIC
"RTN","PSJAC",45,0)
 ;
"RTN","PSJAC",46,0)
DONE ;
"RTN","PSJAC",47,0)
 I PSJACPF<10 K VADM,VAIN,VAIP
"RTN","PSJAC",48,0)
 K PSJACPF,PSGID,PSGOD,VA200,X
"RTN","PSJAC",49,0)
 Q
"RTN","PSJAC",50,0)
HTWT(DFN) ; Get patient's height and weight from Vitals.
"RTN","PSJAC",51,0)
 S (PSJPWTD,PSJPHTD)=""
"RTN","PSJAC",52,0)
 S X="GMRVUTL" X ^%ZOSF("TEST") I  S GMRVSTR="HT" D
"RTN","PSJAC",53,0)
 . D EN6^GMRVUTL S PSJPHT=$P(X,U,8) S:PSJPHT PSJPHT=$J(2.54*PSJPHT,0,2),PSJPHTD="("_$S($D(PSJY2K):$E($$ENDTC2^PSGMI($P(X,U)),1,10),1:$E($$ENDTC^PSGMI($P(X,U)),1,8))_")"
"RTN","PSJAC",54,0)
 . S GMRVSTR="WT" D EN6^GMRVUTL S PSJPWT=$P(X,U,8) S:PSJPWT PSJPWT=$J(PSJPWT/2.2,0,2),PSJPWTD="("_$S($D(PSJY2K):$E($$ENDTC2^PSGMI($P(X,U)),1,10),1:$E($$ENDTC^PSGMI($P(X,U)),1,8))_")"
"RTN","PSJAC",55,0)
 F X="PSJPWT","PSJPHT" S:'$G(@X) @X="______"
"RTN","PSJAC",56,0)
 F X="PSJPWTD","PSJPHTD" S:$G(@X)="" @X="(________)"
"RTN","PSJAC",57,0)
 Q
"RTN","PSJAC",58,0)
PSJAC2(PSJY2K)     ;
"RTN","PSJAC",59,0)
 D PSJAC Q
"RTN","PSJAC",60,0)
 Q
"RTN","PSJAC",61,0)
ACTCLIN(PSGP,PSGORD) ; Don't allow active clinic orders to be copied. If Pending order, allow CLINIC^PSJOE to reject based on order status.
"RTN","PSJAC",62,0)
 N CLIN,CLNODE S CLIN=0
"RTN","PSJAC",63,0)
 I $G(PSGORD)["P"!($G(PSGORD)=+$G(PSGORD)) S CLIN=0
"RTN","PSJAC",64,0)
 I $G(PSGORD)["U" S CLNODE=$G(^PS(55,PSGP,5,+PSGORD,8)) I CLNODE&($P(CLNODE,"^",2)) S CLIN=1
"RTN","PSJAC",65,0)
 I $G(PSGORD)["V" S CLNODE=$G(^PS(55,PSGP,"IV",+PSGORD,"DSS")) I CLNODE&($P(CLNODE,"^",2)) S CLIN=1
"RTN","PSJAC",66,0)
 I $G(CLIN) W !!,"You cannot copy this CLINIC Order." D PAUSE^VALM1 Q 1
"RTN","PSJAC",67,0)
 Q 0
"RTN","PSJAC",68,0)
 ;
"RTN","PSJAC",69,0)
CLINIC ; clinic parameters
"RTN","PSJAC",70,0)
 N CL,CLIEN,CLNAM S CL=0 F  S CL=$O(^PS(53.46,CL)) Q:'CL  S CLIEN=$G(^(CL,0)) I CLIEN S PSJSYSW0("CLINIC",+CLIEN,0)=CLIEN I $D(^PS(53.46,CL,1)) S PSJSYSW0("CLINIC",+CLIEN,1)=^(1)
"RTN","PSJAC",71,0)
 Q
"RTN","PSJBCMA")
0^1^B104152395^B81219931
"RTN","PSJBCMA",1,0)
PSJBCMA ;BIR/MV-RETURN INPATIENT ACTIVE MEDS (CONDENSED) ;1/23/13 1:23pm
"RTN","PSJBCMA",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**32,41,46,57,63,66,56,69,58,81,91,104,111,112,186,159,173,190,113,225,253,267,279**;16 DEC 97;Build 150
"RTN","PSJBCMA",3,0)
 ;
"RTN","PSJBCMA",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSJBCMA",5,0)
 ; Reference to ^PS(51 is supported by DBIA 2176.
"RTN","PSJBCMA",6,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177.
"RTN","PSJBCMA",7,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJBCMA",8,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJBCMA",9,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJBCMA",10,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJBCMA",11,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJBCMA",12,0)
 ; Usage of this routine by BCMA is supported by DBIA 2828.
"RTN","PSJBCMA",13,0)
 ;
"RTN","PSJBCMA",14,0)
 ;*267 - add new piece of info to return TMP global. Need the Med 
"RTN","PSJBCMA",15,0)
 ;       route IEN per each order.
"RTN","PSJBCMA",16,0)
 ;*279 - add Clinic name, IEN to pieces 11, 12 of TMP("PSJ",$J,0)
"RTN","PSJBCMA",17,0)
 ;     - add High Risk drug Witness indicator to Results 7th piece
"RTN","PSJBCMA",18,0)
 ;
"RTN","PSJBCMA",19,0)
EN(DFN,BDT,OTDATE)         ; return condensed list of inpatient meds
"RTN","PSJBCMA",20,0)
 NEW CNT,DN,F,FON,ON,PST,WBDT,X,X1,X2,Y,%
"RTN","PSJBCMA",21,0)
 D:+$G(DFN) ORDER
"RTN","PSJBCMA",22,0)
 I '$D(^TMP("PSJ",$J,1,0)) S ^(0)=-1
"RTN","PSJBCMA",23,0)
 K PSJINX
"RTN","PSJBCMA",24,0)
 Q
"RTN","PSJBCMA",25,0)
ORDER ;Loop thru orders.
"RTN","PSJBCMA",26,0)
 I '+$G(BDT) D NOW^%DTC S BDT=%
"RTN","PSJBCMA",27,0)
 I BDT'["." S BDT=BDT_".0001"
"RTN","PSJBCMA",28,0)
 S PSJINX=0
"RTN","PSJBCMA",29,0)
 ;U/D orders
"RTN","PSJBCMA",30,0)
 S F="^PS(55,DFN,5,",WBDT=BDT
"RTN","PSJBCMA",31,0)
 F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",32,0)
 . F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  S FON=ON_"U",PSJON(FON)="" D UDVAR
"RTN","PSJBCMA",33,0)
 ;IV orders
"RTN","PSJBCMA",34,0)
 S F="^PS(55,DFN,""IV"",",WBDT=BDT
"RTN","PSJBCMA",35,0)
 F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",36,0)
 . F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  S FON=ON_"V",PSJON(FON)="" D IVVAR
"RTN","PSJBCMA",37,0)
 ;Pending orders
"RTN","PSJBCMA",38,0)
 S F="^PS(53.1,"
"RTN","PSJBCMA",39,0)
 F PST="P","N" F ON=0:0 S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  D
"RTN","PSJBCMA",40,0)
 . S FON=ON_"P"
"RTN","PSJBCMA",41,0)
 . S X=$P($G(^PS(53.1,+ON,0)),U,4) D @$S(X="F":"IVVAR",1:"UDVAR")
"RTN","PSJBCMA",42,0)
 ;When a one-time order is found, check against PSJON(FON) array to
"RTN","PSJBCMA",43,0)
 ;make sure no duplicates return on ^TMP.
"RTN","PSJBCMA",44,0)
 I '+$G(OTDATE) D NOW^%DTC S X1=$E(%,1,12),X2=-30 D C^%DTC S OTDATE=X
"RTN","PSJBCMA",45,0)
 I OTDATE'["." S OTDATE=OTDATE_".0001"
"RTN","PSJBCMA",46,0)
 Q:BDT'>OTDATE
"RTN","PSJBCMA",47,0)
 S F="^PS(55,DFN,5,",WBDT=OTDATE
"RTN","PSJBCMA",48,0)
 F  S WBDT=$O(^PS(55,DFN,5,"AU","O",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",49,0)
 .  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AU","O",WBDT,ON)) Q:'ON  D
"RTN","PSJBCMA",50,0)
 .. S FON=ON_"U" D:'$D(PSJON(FON)) UDVAR
"RTN","PSJBCMA",51,0)
 S F="^PS(55,DFN,""IV"",",WBDT=OTDATE
"RTN","PSJBCMA",52,0)
 F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",53,0)
 . F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  D
"RTN","PSJBCMA",54,0)
 .. S X=$P($G(^PS(55,DFN,"IV",ON,0)),U,9)
"RTN","PSJBCMA",55,0)
 .. I X]"",$$ONE(DFN,ON_"V",X,$P(X,"^",2),$P(X,"^",3))="O" D
"RTN","PSJBCMA",56,0)
 ... S FON=ON_"V" D:'$D(PSJON(FON)) IVVAR
"RTN","PSJBCMA",57,0)
 K PSJON,PSJBCID
"RTN","PSJBCMA",58,0)
 Q
"RTN","PSJBCMA",59,0)
UDVAR ;Set ^TMP for Unit dose & Pending orders
"RTN","PSJBCMA",60,0)
 N CLINIC
"RTN","PSJBCMA",61,0)
 D UDPEND I '$$CLINICS($G(CLINIC)) Q
"RTN","PSJBCMA",62,0)
 D TMP
"RTN","PSJBCMA",63,0)
 ;Setup Dispense drug for ^TMP
"RTN","PSJBCMA",64,0)
 S CNT=0 D NOW^%DTC
"RTN","PSJBCMA",65,0)
 F X=0:0 S X=$O(@(F_ON_",1,"_X_")")) Q:'X  D
"RTN","PSJBCMA",66,0)
 . S PSJDD=@(F_ON_",1,"_X_",0)") I $P(PSJDD,"^",3)]"",$P(PSJDD,"^",3)'>% Q
"RTN","PSJBCMA",67,0)
 .;*225 Don't allow 0
"RTN","PSJBCMA",68,0)
 . I +$P(PSJDD,"^",2)=0 S $P(PSJDD,"^",2)=1
"RTN","PSJBCMA",69,0)
 . S CNT=CNT+1
"RTN","PSJBCMA",70,0)
 . S ^TMP("PSJ",$J,PSJINX,700,CNT,0)=+PSJDD_U_$P($G(^PSDRUG(+PSJDD,0)),U)_U_$S((FON["U")&($P(PSJDD,U,2)=""):1,(FON["U")&($E($P(PSJDD,U,2))="."):"0"_$P(PSJDD,U,2),1:$P(PSJDD,U,2))_U_$P(PSJDD,U,3)
"RTN","PSJBCMA",71,0)
 . ;add High Risk field to 6th piece of 700 (disp drug)          ;*279
"RTN","PSJBCMA",72,0)
 . S $P(^TMP("PSJ",$J,PSJINX,700,CNT,0),U,6)=$$GET1^DIQ(50.7,PSJ("OI"),1,"I")
"RTN","PSJBCMA",73,0)
 S:CNT ^TMP("PSJ",$J,PSJINX,700,0)=CNT
"RTN","PSJBCMA",74,0)
 K PSJ,PSJDD
"RTN","PSJBCMA",75,0)
 Q
"RTN","PSJBCMA",76,0)
IVVAR ;Set variables for IV and pending orders
"RTN","PSJBCMA",77,0)
 NEW ND,X,Y,CLINIC
"RTN","PSJBCMA",78,0)
 I FON["P" D UDPEND Q:'$$CLINICS(CLINIC)  S PSJ("INFRATE")=$P($P($G(^PS(53.1,ON,8)),U,5),"@")
"RTN","PSJBCMA",79,0)
 I FON["V" D  Q:'$$CLINICS(CLINIC)
"RTN","PSJBCMA",80,0)
 . S X=$G(^PS(55,DFN,"IV",ON,0)),CLINIC=$G(^("DSS")) Q:'$$CLINICS(CLINIC)
"RTN","PSJBCMA",81,0)
 . S PSJ("STARTDT")=$P(X,U,2),PSJ("STOPDT")=$P(X,U,3)
"RTN","PSJBCMA",82,0)
 . S PSJ("INFRATE")=$P($P(X,U,8),"@"),PSJ("SCHD")=$P(X,U,9)
"RTN","PSJBCMA",83,0)
 . S PSJ("ADM")=$P(X,U,11),PSJ("AUTO")=$P(X,U,12),PSJ("STATUS")=$P(X,U,17)
"RTN","PSJBCMA",84,0)
 . S PSJ("IVTYPE")=$P(X,U,4),PSJ("INSYR")=$P(X,U,5)
"RTN","PSJBCMA",85,0)
 . S PSJ("CPRS")=$P(X,U,21),PSJ("CHEMO")=$P(X,U,23)
"RTN","PSJBCMA",86,0)
 . S X=$G(^PS(55,DFN,"IV",ON,.2))
"RTN","PSJBCMA",87,0)
 . S PSJ("DO")="",PSJ("MR")=$P(X,U,3),PSJ("PRI")=$P(X,U,4),PSJ("FLG")=$P(X,U,7),PSJ("COM")="",PSJ("SRC")=""
"RTN","PSJBCMA",88,0)
 . I PSJ("FLG") D
"RTN","PSJBCMA",89,0)
 .. N S1,A,B,C
"RTN","PSJBCMA",90,0)
 .. S S1="" F  S S1=$O(^PS(55,DFN,"IV",ON,"A",S1),-1) Q:'S1  S C=$G(^(S1,0)) S A=$P(C,U,2),B=$P(C,U,4) Q:A="UG"  D  I PSJ("SRC")]"" Q
"RTN","PSJBCMA",91,0)
 ... Q:A'="G"
"RTN","PSJBCMA",92,0)
 ... S PSJ("SRC")=$S(B["FLAGGED BY PHARM":"PHARMACIST",B["FLAGGED BY CPRS":"CPRS",1:"")
"RTN","PSJBCMA",93,0)
 ... S PSJ("COM")=$P(B," ",4,99)
"RTN","PSJBCMA",94,0)
 . S PSJ("OI")=+X
"RTN","PSJBCMA",95,0)
 . S X=$G(^PS(55,DFN,"IV",ON,2))
"RTN","PSJBCMA",96,0)
 . S PSJ("PREV")=$P(X,U,5) I PSJ("PREV")["V",(+PSJ("PREV")=+ON) S PSJ("PREV")=""
"RTN","PSJBCMA",97,0)
 . S PSJ("FOLLOW")=$P(X,U,6),PSJ("RFO")=$P(X,U,9) I PSJ("FOLLOW")["V",(+PSJ("FOLLOW")=+ON) S (PSJ("FOLLOW"),PSJ("RFO"))=""
"RTN","PSJBCMA",98,0)
 . S PSJ("SIOPI")=$S($P($G(^PS(55,DFN,"IV",+ON,3)),"^",2)&($P($G(^PS(55,DFN,"IV",+ON,3)),"^")'=""):"!",1:"")_$P($G(^(3)),"^")
"RTN","PSJBCMA",99,0)
 . N SCHD S SCHD=PSJ("SCHD")
"RTN","PSJBCMA",100,0)
 . S PSJ("STC")=$$ONE(DFN,ON_"V",SCHD,PSJ("STARTDT"),PSJ("STOPDT"))
"RTN","PSJBCMA",101,0)
 . I PSJ("STC")=""!(PSJ("STC")="C") S PSJ("STC")=$S(SCHD["PRN":"P",1:"C")
"RTN","PSJBCMA",102,0)
 . I PSJ("STC")="C" S PSJ("STC")=$S($$ONCALL(SCHD):"OC",1:"C")
"RTN","PSJBCMA",103,0)
 D TMP
"RTN","PSJBCMA",104,0)
 S CNT=0
"RTN","PSJBCMA",105,0)
 F X=0:0 S X=$O(@(F_ON_",""AD"","_X_")")) Q:'X  D
"RTN","PSJBCMA",106,0)
 . S ND=$G(@(F_ON_",""AD"","_X_",0)")),DN=$G(^PS(52.6,+ND,0))
"RTN","PSJBCMA",107,0)
 . S CNT=CNT+1,^TMP("PSJ",$J,PSJINX,850,CNT,0)=+ND_U_$P(DN,U)_U_$P(ND,U,2)_U_$P(ND,U,3)
"RTN","PSJBCMA",108,0)
 . ;add High Risk field to 6th piece of 850 (additv)             ;*279
"RTN","PSJBCMA",109,0)
 . S $P(^TMP("PSJ",$J,PSJINX,850,CNT,0),U,6)=$$HRFLG(+ND,"A")
"RTN","PSJBCMA",110,0)
 S:CNT ^TMP("PSJ",$J,PSJINX,850,0)=CNT,CNT=0
"RTN","PSJBCMA",111,0)
 F X=0:0 S X=$O(@(F_ON_",""SOL"","_X_")")) Q:'X  D
"RTN","PSJBCMA",112,0)
 . S ND=$G(@(F_ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0))
"RTN","PSJBCMA",113,0)
 . S CNT=CNT+1,^TMP("PSJ",$J,PSJINX,950,CNT,0)=+ND_U_$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)
"RTN","PSJBCMA",114,0)
 . ;add High Risk field to 6th piece of 950 (sol)                ;*279
"RTN","PSJBCMA",115,0)
 . S $P(^TMP("PSJ",$J,PSJINX,950,CNT,0),U,6)=$$HRFLG(+ND,"S")
"RTN","PSJBCMA",116,0)
 S:CNT ^TMP("PSJ",$J,PSJINX,950,0)=CNT
"RTN","PSJBCMA",117,0)
 K PSJ
"RTN","PSJBCMA",118,0)
 S X1=0
"RTN","PSJBCMA",119,0)
 F  S X1=$O(^PS(55,DFN,"IVBCMA",X1)) Q:'X1  D
"RTN","PSJBCMA",120,0)
 . S XX=$G(^PS(55,DFN,"IVBCMA",X1,0)) Q:ON'=$P(XX,"^",2)  S PSJBCID=$P(XX,"^"),X2=0
"RTN","PSJBCMA",121,0)
 . F I=1:1 S X2=$O(^PS(55,DFN,"IVBCMA",X1,"AD",X2)) Q:'X2  D
"RTN","PSJBCMA",122,0)
 .. S X=^(X2,0),^TMP("PSJ",$J,PSJINX,800,PSJBCID,I)=+X_"^"_$S($D(^PS(52.6,+X,0)):$P(^(0),"^"),1:"*****")_"^"_$P(X,"^",2,99)
"RTN","PSJBCMA",123,0)
 .. ;add High Risk field to 6th piece of 800 (additv)            ;*279
"RTN","PSJBCMA",124,0)
 .. S $P(^TMP("PSJ",$J,PSJINX,800,PSJBCID,I),U,6)=$$HRFLG(+ND,"A")
"RTN","PSJBCMA",125,0)
 . I I>1 S ^TMP("PSJ",$J,PSJINX,800,PSJBCID,0)=I-1
"RTN","PSJBCMA",126,0)
 . S X2=0
"RTN","PSJBCMA",127,0)
 . F I=1:1 S X2=$O(^PS(55,DFN,"IVBCMA",X1,"SOL",X2)) Q:'X2  D
"RTN","PSJBCMA",128,0)
 .. S X=^(X2,0),^TMP("PSJ",$J,PSJINX,900,PSJBCID,I)=$P(X,"^")_"^"_$S($D(^PS(52.7,$P(X,"^"),0)):$P(^(0),"^"),1:"*****")_"^"_$P(X,"^",2,99)
"RTN","PSJBCMA",129,0)
 .. ;add High Risk field to 6th piece of 900 (sol)               ;*279
"RTN","PSJBCMA",130,0)
 .. S $P(^TMP("PSJ",$J,PSJINX,900,PSJBCID,I),U,6)=$$HRFLG(+X,"S")
"RTN","PSJBCMA",131,0)
 . I I>1 S ^TMP("PSJ",$J,PSJINX,900,PSJBCID,0)=I-1
"RTN","PSJBCMA",132,0)
 Q
"RTN","PSJBCMA",133,0)
UDPEND ;
"RTN","PSJBCMA",134,0)
 S X=$G(@(F_ON_",0)")) I $P(F,",")[53.1 S CLINIC=$G(@(F_ON_",""DSS"")")) Q:'$$CLINICS(CLINIC)
"RTN","PSJBCMA",135,0)
 I $P(F,",")[55 S CLINIC=$G(@(F_ON_",8)")) Q:'$$CLINICS(CLINIC)
"RTN","PSJBCMA",136,0)
 S PSJ("MR")=$P(X,U,3),PSJ("SM")=$P(X,U,5),PSJ("HSM")=$P(X,U,6)
"RTN","PSJBCMA",137,0)
 S PSJ("ST")=$P(X,U,7),PSJ("STATUS")=$P(X,U,9)
"RTN","PSJBCMA",138,0)
 S PSJ("CPRS")=$P(X,U,21),PSJ("PREV")=$P(X,U,25),PSJ("FOLLOW")=$P(X,U,26),PSJ("RFO")=$P(X,U,27)
"RTN","PSJBCMA",139,0)
 S:FON["U" PSJ("NGIVEN")=$P(X,U,22)
"RTN","PSJBCMA",140,0)
 S X=$G(@(F_ON_",.2)"))
"RTN","PSJBCMA",141,0)
 S PSJ("DO")=$P(X,U,2),PSJ("PRI")=$P(X,U,4),PSJ("FLG")=$P(X,U,7),PSJ("COM")="",PSJ("SRC")=""
"RTN","PSJBCMA",142,0)
 I PSJ("FLG") D
"RTN","PSJBCMA",143,0)
 . N S1,A,B,C
"RTN","PSJBCMA",144,0)
 . S S1="" F  S S1=$O(^PS(55,DFN,5,ON,9,S1),-1) Q:'S1  S C=$G(^(S1,0)) S A=$P(C,U,3),B=$P(C,U,4) Q:A=7010!(A=7030)  D  I PSJ("SRC")]"" Q
"RTN","PSJBCMA",145,0)
 .. Q:A'=7000&(A'=7020)
"RTN","PSJBCMA",146,0)
 .. S PSJ("SRC")=$S(A=7000:"PHARMACIST",A=7020:"CPRS",1:"")
"RTN","PSJBCMA",147,0)
 .. S PSJ("COM")=$G(@(F_ON_",13)"))
"RTN","PSJBCMA",148,0)
 S PSJ("OI")=+X
"RTN","PSJBCMA",149,0)
 S X=$G(@(F_ON_",2)"))
"RTN","PSJBCMA",150,0)
 S PSJ("SCHD")=$P(X,U),PSJ("STARTDT")=$P(X,U,2)
"RTN","PSJBCMA",151,0)
 S PSJ("STOPDT")=$P(X,U,4),PSJ("ADM")=$P(X,U,5)
"RTN","PSJBCMA",152,0)
 S X=$G(@(F_ON_",4)"))
"RTN","PSJBCMA",153,0)
 S PSJ("AUTO")=$P(X,U,11)
"RTN","PSJBCMA",154,0)
 ;naked reference on line below refers to  full reference created by indirect reference to F_ON, where F may refer to ^PS(53.1 or the IV or UD multiple ^PS(55
"RTN","PSJBCMA",155,0)
 S PSJ("SIOPI")=$S($P($G(@(F_ON_",6)")),"^",2)&($P($G(@(F_ON_",6)")),"^")'=""):"!",1:"")_$$ENSET($P($G(^(6)),"^"))
"RTN","PSJBCMA",156,0)
 D SIOPI
"RTN","PSJBCMA",157,0)
 S PSJ("STC")=PSJ("ST")
"RTN","PSJBCMA",158,0)
 I PSJ("ST")="R"!(PSJ("ST")="C") S PSJ("STC")=$S(PSJ("SCHD")["PRN":"P",$$ONCALL(PSJ("SCHD")):"OC",$$ONE(DFN,FON,PSJ("SCHD"))="O":"O",1:"C")
"RTN","PSJBCMA",159,0)
 Q
"RTN","PSJBCMA",160,0)
TMP ;Setup ^TMP that have common fields between IV and U/D
"RTN","PSJBCMA",161,0)
 N A,CLNAME,CLNAMPTR                                             ;*279
"RTN","PSJBCMA",162,0)
 S PSJINX=PSJINX+1
"RTN","PSJBCMA",163,0)
 S PSJ("OINAME")=$$OIDF^PSJLMUT1(+PSJ("OI")) I PSJ("OINAME")["NOT FOUND" S PSJ("OINAME")=""
"RTN","PSJBCMA",164,0)
 S PSJ("OIDF")=$$GET1^DIQ(50.7,+PSJ("OI"),.02)
"RTN","PSJBCMA",165,0)
 I PSJ("OINAME")="" S PSJ("OIDF")=""
"RTN","PSJBCMA",166,0)
 S A=$G(^PS(51.2,+PSJ("MR"),0)),PSJ("MRABB")=$P(A,U,3),PSJ("MRNM")=$P(A,U)
"RTN","PSJBCMA",167,0)
 S ^TMP("PSJ",$J,PSJINX,0)=DFN_U_+ON_U_FON_U_PSJ("PREV")_U_PSJ("FOLLOW")_U_$G(PSJ("IVTYPE"))_U_$G(PSJ("INSYR"))_U_$G(PSJ("CHEMO"))_U_PSJ("CPRS")_U_$G(PSJ("RFO"))
"RTN","PSJBCMA",168,0)
 ;add Clinic name & IEN ptr to TMP 0 node (pieces 11,12)          *279
"RTN","PSJBCMA",169,0)
 ;piece 11 determines if order is a CO or IM for BCMA VDL's       *279
"RTN","PSJBCMA",170,0)
 I +CLINIC,$$CLINIC(CLINIC) D           ;CL IEN & valid appt date *279
"RTN","PSJBCMA",171,0)
 . S CLNAMPTR=$O(^PS(53.46,"B",+CLINIC,""))
"RTN","PSJBCMA",172,0)
 . S CLNAME=$$GET1^DIQ(53.46,CLNAMPTR_",",.01)
"RTN","PSJBCMA",173,0)
 . S $P(^TMP("PSJ",$J,PSJINX,0),U,11)=CLNAME      ;CO ind, CO NAME
"RTN","PSJBCMA",174,0)
 . S $P(^TMP("PSJ",$J,PSJINX,0),U,12)=+CLINIC     ;IEN ptr to file 44
"RTN","PSJBCMA",175,0)
 ;
"RTN","PSJBCMA",176,0)
 S ^TMP("PSJ",$J,PSJINX,1)=PSJ("MRABB")_U_PSJ("STC")_U_$G(PSJ("SCHD"))_U_PSJ("STARTDT")_U_PSJ("STOPDT")_U_PSJ("ADM")_U_PSJ("STATUS")_U_$G(PSJ("NGIVEN"))_U_$G(PSJ("ST"))_U_$G(PSJ("AUTO"))
"RTN","PSJBCMA",177,0)
 S ^TMP("PSJ",$J,PSJINX,1,0)=$P(A,U,8)_U_PSJ("MRNM")_U_$P(A,U,9)_U_+PSJ("MR")   ;*267 append file 51.2 ien 
"RTN","PSJBCMA",178,0)
 S ^TMP("PSJ",$J,PSJINX,2)=PSJ("DO")_U_$P($G(PSJ("INFRATE")),"@")_U_$G(PSJ("SM"))_U_$G(PSJ("HSM"))
"RTN","PSJBCMA",179,0)
 S ^TMP("PSJ",$J,PSJINX,3)=PSJ("OI")_U_PSJ("OINAME")_U_PSJ("OIDF")
"RTN","PSJBCMA",180,0)
 S ^TMP("PSJ",$J,PSJINX,4)=PSJ("SIOPI")
"RTN","PSJBCMA",181,0)
 S A=$$SNDTSTA^PSJHL4A(PSJ("PRI"),PSJ("SCHD"))
"RTN","PSJBCMA",182,0)
 S ^TMP("PSJ",$J,PSJINX,5)=$S(A=1:0,1:1)_U_PSJ("FLG")_U_PSJ("SRC")_U_PSJ("COM")
"RTN","PSJBCMA",183,0)
 Q
"RTN","PSJBCMA",184,0)
SIOPI ; Use provider comments if order is pending and there is no SI
"RTN","PSJBCMA",185,0)
 NEW X,Y,Z
"RTN","PSJBCMA",186,0)
 I FON["P",(PSJ("SIOPI")=""),$O(^PS(53.1,+ON,12,0)) D
"RTN","PSJBCMA",187,0)
 . F X=0:0 S X=$O(^PS(53.1,+ON,12,X)) Q:'X  S Z=$G(^(X,0)) D
"RTN","PSJBCMA",188,0)
 .. S Y=$L(PSJ("SIOPI"))
"RTN","PSJBCMA",189,0)
 .. S:Y+$L(Z)'>179 PSJ("SIOPI")=PSJ("SIOPI")_Z_""
"RTN","PSJBCMA",190,0)
 . I Y+$L(Z)>179 S PSJ("SIOPI")="SEE PROVIDER COMMENTS"
"RTN","PSJBCMA",191,0)
 Q
"RTN","PSJBCMA",192,0)
ENSET(X) ; expands SPECIAL INSTRUCTIONS field contained in X into Y
"RTN","PSJBCMA",193,0)
 N X1,X2,Y S Y=""
"RTN","PSJBCMA",194,0)
 F X1=1:1:$L(X," ") S X2=$P(X," ",X1) I X2]"" S Y=Y_$S($L(X2)>30:X2,'$D(^PS(51,+$O(^PS(51,"B",X2,0)),0)):X2,$P(^(0),"^",2)]""&$P(^(0),"^",4):$P(^(0),"^",2),1:X2)_" "
"RTN","PSJBCMA",195,0)
 S Y=$E(Y,1,$L(Y)-1)
"RTN","PSJBCMA",196,0)
 Q Y
"RTN","PSJBCMA",197,0)
ONE(DFN,ORD,SCH,START,STOP) ;Determine if order is one-time, and return schedule type
"RTN","PSJBCMA",198,0)
 ; Input:  DFN - patient's IEN
"RTN","PSJBCMA",199,0)
 ;         ORD - order number
"RTN","PSJBCMA",200,0)
 ;         SCH - schedule text (required)
"RTN","PSJBCMA",201,0)
 ;         START - order start date (optional)
"RTN","PSJBCMA",202,0)
 ;         STOP - order stop date (optional)
"RTN","PSJBCMA",203,0)
 N X,ONEFRQ,TYP,T
"RTN","PSJBCMA",204,0)
 I $G(PSJ("PREV")),$G(PSJ("FOLLOW")) I +PSJ("PREV")=+PSJ("FOLLOW") S (PSJ("PREV"),PSJ("FOLLOW"))=""
"RTN","PSJBCMA",205,0)
 ; PSJ*5*190 One-Time PRN
"RTN","PSJBCMA",206,0)
 I $G(SCH)="",$G(DFN),$G(ORD) D
"RTN","PSJBCMA",207,0)
 .I ORD["U" S SCH=$P($G(^PS(55,DFN,5,+ORD,2)),"^")
"RTN","PSJBCMA",208,0)
 .I ORD["V" S SCH=$P($G(^PS(55,DFN,"IV",+ORD,0)),"^",9)
"RTN","PSJBCMA",209,0)
 I $G(SCH)]"",$$OTPRN^PSJBCMA3(SCH)="O" Q "O"
"RTN","PSJBCMA",210,0)
 I $G(DFN)]"",$G(ORD)]"",ORD["U",$P(^PS(55,DFN,5,+ORD,0),"^",7)'="R" Q $P(^PS(55,DFN,5,+ORD,0),"^",7)
"RTN","PSJBCMA",211,0)
 I $G(SCH)="" Q ""
"RTN","PSJBCMA",212,0)
 ; PSJ*5*113 Determine schedule type from ^PS(51.1, not from schedule name.
"RTN","PSJBCMA",213,0)
 I $D(^PS(51.1,"AC","PSJ",SCH)) S X=$O(^(SCH,"")) S X=$P(^PS(51.1,X,0),"^",5) Q $S(X="D":"C",1:X)
"RTN","PSJBCMA",214,0)
 I $G(START)]"",$G(STOP)]"",START=STOP Q "O"
"RTN","PSJBCMA",215,0)
 I $$DAY(SCH) Q "C"
"RTN","PSJBCMA",216,0)
 Q ""
"RTN","PSJBCMA",217,0)
 ;
"RTN","PSJBCMA",218,0)
CLINIC(CL) ; is a valid appointment date present?  1=yes 0 =no
"RTN","PSJBCMA",219,0)
 I $P(CL,"^",2)?7N!($P(CL,"^",2)?7N1".".N) Q 1
"RTN","PSJBCMA",220,0)
 Q 0
"RTN","PSJBCMA",221,0)
 ;
"RTN","PSJBCMA",222,0)
CLINICS(CL,IGNOSND) ;IM & CO order tests                                          *70
"RTN","PSJBCMA",223,0)
 ; Send IM orders always.  Send Clinic orders as CO order, if it
"RTN","PSJBCMA",224,0)
 ; meets below conditions, else send the order over as a IM order.
"RTN","PSJBCMA",225,0)
 ;
"RTN","PSJBCMA",226,0)
 ;   If CPRS sends the Clinic IEN and the appointment date when the
"RTN","PSJBCMA",227,0)
 ;   order is signed in CPRS, then this is a Cllinc order and can be
"RTN","PSJBCMA",228,0)
 ;   sent to BCMA as a CO order, if it passes the 53.46 test as well.
"RTN","PSJBCMA",229,0)
 ;
"RTN","PSJBCMA",230,0)
 ; IGNOSND = Flag indicating the SEND TO BCMA parameter should be ignored.
"RTN","PSJBCMA",231,0)
 ; PSJHYBR = Hybrid order - contains reference to CLINIC, but no appointment date time
"RTN","PSJBCMA",232,0)
 ;
"RTN","PSJBCMA",233,0)
 ; Function Return values:   1 = Send order to BCMA
"RTN","PSJBCMA",234,0)
 ;                           0 = Do Not send order to BCMA
"RTN","PSJBCMA",235,0)
 ;
"RTN","PSJBCMA",236,0)
 ; * Orders with Clinic but no Appt should only be sent if patient is admitted or SEND TO BCMA flag set
"RTN","PSJBCMA",237,0)
 I '$G(CL)!$G(IGNOSND) Q 1
"RTN","PSJBCMA",238,0)
 N PSJVAIN4,X S PSJVAIN4=1 I $G(DFN) D
"RTN","PSJBCMA",239,0)
 .N VAIN,PSGP S PSGP=DFN D INP^VADPT I '$G(VAIN(4)) S PSJVAIN4=0
"RTN","PSJBCMA",240,0)
 I $G(PSJVAIN4) Q:'$$CLINIC(CL) 1                          ;no valid appt date
"RTN","PSJBCMA",241,0)
 N A
"RTN","PSJBCMA",242,0)
 S A=$O(^PS(53.46,"B",+CL,"")) Q:'A 0
"RTN","PSJBCMA",243,0)
 Q:'$D(^PS(53.46,"B",+CL)) 0
"RTN","PSJBCMA",244,0)
 Q $P(^PS(53.46,A,0),"^",4)                 ;send to bcma? flag
"RTN","PSJBCMA",245,0)
 ;
"RTN","PSJBCMA",246,0)
DAY(SCH) ;determine if this is a 'day of the week' schedule
"RTN","PSJBCMA",247,0)
 I $G(SCH)="" Q 0
"RTN","PSJBCMA",248,0)
 N D,DAY,DAYS,I,X
"RTN","PSJBCMA",249,0)
 S DAYS="SUNDAY,MONDAY,TUESDAY,WEDNESDAY,THURSDAY,FRIDAY,SATURDAY"
"RTN","PSJBCMA",250,0)
 F I=1:1 S D=$P(SCH,"-",I) Q:D=""  D  Q:X=0
"RTN","PSJBCMA",251,0)
 . S X=0 F J=1:1:7 S DAY=$P(DAYS,",",J) D  Q:X=1
"RTN","PSJBCMA",252,0)
 .. I D=$E(DAY,1,$L(D)) S X=1
"RTN","PSJBCMA",253,0)
 Q X
"RTN","PSJBCMA",254,0)
 ;
"RTN","PSJBCMA",255,0)
ONCALL(SCHD) ; Check if a schedule is type On Call (all "APPSJ" schedules with a given name must have the same schedule type)
"RTN","PSJBCMA",256,0)
 N NXT,SCHARR,OCCHK
"RTN","PSJBCMA",257,0)
 S OCCHK=0
"RTN","PSJBCMA",258,0)
 Q:$G(SCHD)="" OCCHK
"RTN","PSJBCMA",259,0)
 Q:'$D(^PS(51.1,"APPSJ",SCHD)) OCCHK
"RTN","PSJBCMA",260,0)
 S NXT=0 F  S NXT=$O(^PS(51.1,"APPSJ",SCHD,NXT)) Q:'NXT  S TYP=$P($G(^PS(51.1,+NXT,0)),"^",5) S:TYP]"" SCHARR(TYP)=""
"RTN","PSJBCMA",261,0)
 I '$D(SCHARR("OC")) S OCCHK=0 Q OCCHK
"RTN","PSJBCMA",262,0)
 I $O(SCHARR("OC"))]""!($O(SCHARR("OC"),-1)]"") S OCCHK=0 Q OCCHK
"RTN","PSJBCMA",263,0)
 I $D(SCHARR("OC")) S OCCHK=1
"RTN","PSJBCMA",264,0)
 Q OCCHK
"RTN","PSJBCMA",265,0)
 ;
"RTN","PSJBCMA",266,0)
HRFLG(IEN,ADDSOL) ;Get High Risk flag for this Orderable Item
"RTN","PSJBCMA",267,0)
 N OIIEN
"RTN","PSJBCMA",268,0)
 S:ADDSOL="A" OIIEN=+$$GET1^DIQ(52.6,IEN,15,"I")
"RTN","PSJBCMA",269,0)
 S:ADDSOL="S" OIIEN=+$$GET1^DIQ(52.7,IEN,9,"I")
"RTN","PSJBCMA",270,0)
 Q +$$GET1^DIQ(50.7,OIIEN,1,"I")
"RTN","PSJBCMA1")
0^2^B120598961^B94159665
"RTN","PSJBCMA1",1,0)
PSJBCMA1 ;BIR/MV-RETURN INFORMATION FOR AN ORDER ;1/23/13 1:23pm
"RTN","PSJBCMA1",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**32,41,46,57,63,66,56,58,81,91,104,186,159,173,253,267,279**;16 DEC 97;Build 150
"RTN","PSJBCMA1",3,0)
 ;
"RTN","PSJBCMA1",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSJBCMA1",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJBCMA1",6,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJBCMA1",7,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJBCMA1",8,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJBCMA1",9,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJBCMA1",10,0)
 ; Reference to ^DIC is supported by DBIA 10006.
"RTN","PSJBCMA1",11,0)
 ; Reference to ^DIQ is supported by DBIA 2056.
"RTN","PSJBCMA1",12,0)
 ; Usage of this routine by BCMA is supported by DBIA 2829.
"RTN","PSJBCMA1",13,0)
 ;
"RTN","PSJBCMA1",14,0)
 ;*267 add Standard Rtoue Name from file 51.2 field 10
"RTN","PSJBCMA1",15,0)
 ;*279 - return High Risk field form file #50 for Unit dose and IV's
"RTN","PSJBCMA1",16,0)
 ;        for the dispensed drug/additive/solution
"RTN","PSJBCMA1",17,0)
 ;     - add Clinic name, IEN to pieces 11, 12 of TMP("PSJ1",$J,0)
"RTN","PSJBCMA1",18,0)
 ;
"RTN","PSJBCMA1",19,0)
EN(DFN,ON,PSJTMP,PSJIGS2B,PSJEXIST)         ; return detail data for Inpatient Meds.
"RTN","PSJBCMA1",20,0)
 NEW F,A
"RTN","PSJBCMA1",21,0)
 S PSJTMP=$S($G(PSJTMP)=1:"PSJ1",1:"PSJ")
"RTN","PSJBCMA1",22,0)
 I $G(ON)["U" S F="^PS(55,+$G(DFN),5,+ON" D:$D(@(F_")")) UDVAR
"RTN","PSJBCMA1",23,0)
 I $G(ON)["V" S F="^PS(55,+$G(DFN),""IV"",+ON" D:$D(@(F_")")) IVVAR
"RTN","PSJBCMA1",24,0)
 I $G(ON)["P" S F="^PS(53.1,+ON",X=$P($G(^PS(53.1,+ON,0)),U,4) D:$D(@(F_")")) @$S(X="F":"IVVAR",1:"UDVAR")
"RTN","PSJBCMA1",25,0)
 I '$D(^TMP(PSJTMP,$J,0)) S ^(0)=-1
"RTN","PSJBCMA1",26,0)
 Q
"RTN","PSJBCMA1",27,0)
 ;
"RTN","PSJBCMA1",28,0)
UDVAR ;* Set ^TMP for Unit dose & Pending orders
"RTN","PSJBCMA1",29,0)
 N CNT,CLINIC
"RTN","PSJBCMA1",30,0)
 D UDPEND I '$$CLINICS^PSJBCMA($G(CLINIC),$G(PSJIGS2B)) Q              ;*279
"RTN","PSJBCMA1",31,0)
 D TMP
"RTN","PSJBCMA1",32,0)
 ;* Setup Dispense drug for ^TMP
"RTN","PSJBCMA1",33,0)
 S CNT=0 D NOW^%DTC
"RTN","PSJBCMA1",34,0)
 F X=0:0 S X=$O(@(F_",1,"_X_")")) Q:'X  D
"RTN","PSJBCMA1",35,0)
 . S PSJDD=@(F_",1,"_X_",0)") I $P(PSJDD,"^",3)]"",$P(PSJDD,"^",3)'>% Q
"RTN","PSJBCMA1",36,0)
 . S CNT=CNT+1
"RTN","PSJBCMA1",37,0)
 . S ^TMP(PSJTMP,$J,700,CNT,0)=+PSJDD_U_$P($G(^PSDRUG(+PSJDD,0)),U)_U_$S((ON["U")&($P(PSJDD,U,2)=""):1,(ON["U")&($E($P(PSJDD,U,2))="."):"0"_$P(PSJDD,U,2),1:$P(PSJDD,U,2))_U_$P(PSJDD,U,3)
"RTN","PSJBCMA1",38,0)
 . ;add High Risk field to 6th piece of 700 (disp drug)          ;*279
"RTN","PSJBCMA1",39,0)
 . S $P(^TMP(PSJTMP,$J,700,CNT,0),U,6)=+$$GET1^DIQ(50.7,PSJ("OI"),1,"I")
"RTN","PSJBCMA1",40,0)
 S:CNT ^TMP(PSJTMP,$J,700,0)=CNT
"RTN","PSJBCMA1",41,0)
 K PSJ,PSJDD,PSJDN
"RTN","PSJBCMA1",42,0)
 Q
"RTN","PSJBCMA1",43,0)
IVVAR ;* Set variables for IV and pending orders
"RTN","PSJBCMA1",44,0)
 N CNT,DN,ND,X,Y,CLINIC,OIIEN
"RTN","PSJBCMA1",45,0)
 ;don't send orders to BCMA that fail the Clinic test            ;*279
"RTN","PSJBCMA1",46,0)
 ;     Pending's
"RTN","PSJBCMA1",47,0)
 I ON["P" D  I '$$CLINICS^PSJBCMA($G(CLINIC),$G(PSJIGS2B)) Q           ;*279
"RTN","PSJBCMA1",48,0)
 . D UDPEND                                                      ;*279
"RTN","PSJBCMA1",49,0)
 . S PSJ("INFRATE")=$P($P($G(^PS(53.1,ON,8)),U,5),"@")           ;*279
"RTN","PSJBCMA1",50,0)
 ;     IV's
"RTN","PSJBCMA1",51,0)
 I ON["V" D  I '$$CLINICS^PSJBCMA($G(CLINIC),$G(PSJIGS2B)) Q           ;*279
"RTN","PSJBCMA1",52,0)
 . S X=$G(^PS(55,DFN,"IV",+ON,0))
"RTN","PSJBCMA1",53,0)
 . S PSJ("STARTDT")=$P(X,U,2),PSJ("STOPDT")=$P(X,U,3)
"RTN","PSJBCMA1",54,0)
 . S PSJ("PROVIDER")=$P(X,U,6)
"RTN","PSJBCMA1",55,0)
 . S PSJEXIST=$S((PSJ("PROVIDER")'=""):1,1:0)
"RTN","PSJBCMA1",56,0)
 . S PSJ("INFRATE")=$P($P(X,U,8),"@"),PSJ("SCHD")=$P(X,U,9)
"RTN","PSJBCMA1",57,0)
 . S PSJ("ADM")=$P(X,U,11),PSJ("AUTO")=$P(X,U,12),PSJ("STATUS")=$P(X,U,17)
"RTN","PSJBCMA1",58,0)
 . S PSJ("FREQ")=$P(X,U,15),PSJ("IVTYPE")=$P(X,U,4)
"RTN","PSJBCMA1",59,0)
 . S PSJ("INSYR")=$P(X,U,5),PSJ("CPRS")=$P(X,U,21),PSJ("CHEMO")=$P(X,U,23)
"RTN","PSJBCMA1",60,0)
 . S X=$G(^PS(55,DFN,"IV",+ON,.2))
"RTN","PSJBCMA1",61,0)
 . S PSJ("OI")=$P(X,U),PSJ("DO")="",PSJ("PRI")=$P(X,U,4),PSJ("FLG")=$P(X,U,7),PSJ("COM")="",PSJ("SRC")=""
"RTN","PSJBCMA1",62,0)
 . I PSJ("FLG") D
"RTN","PSJBCMA1",63,0)
 .. N S1,A,B,C
"RTN","PSJBCMA1",64,0)
 .. S S1="" F  S S1=$O(^PS(55,DFN,"IV",+ON,"A",S1),-1) Q:'S1  S C=$G(^(S1,0)) S A=$P(C,U,2),B=$P(C,U,4) Q:A="UG"  D  I PSJ("SRC")]"" Q
"RTN","PSJBCMA1",65,0)
 ... Q:A'="G"
"RTN","PSJBCMA1",66,0)
 ... S PSJ("SRC")=$S(B["FLAGGED BY PHARM":"PHARMACIST",B["FLAGGED BY CPRS":"CPRS",1:"")
"RTN","PSJBCMA1",67,0)
 ... S PSJ("COM")=$P(B," ",4,99)
"RTN","PSJBCMA1",68,0)
 . S PSJ("MR")=$P(X,U,3)
"RTN","PSJBCMA1",69,0)
 . S X=$G(^PS(55,DFN,"IV",+ON,4))
"RTN","PSJBCMA1",70,0)
 . S PSJ("NURSE")=$P(X,U)
"RTN","PSJBCMA1",71,0)
 . S PSJ("PHARM")=$P(X,U,4)
"RTN","PSJBCMA1",72,0)
 . S X=$G(^PS(55,DFN,"IV",+ON,2))
"RTN","PSJBCMA1",73,0)
 . S PSJ("LDT")=$P(X,U)
"RTN","PSJBCMA1",74,0)
 . S PSJ("PREV")=$P(X,U,5),PSJ("FOLLOW")=$P(X,U,6)
"RTN","PSJBCMA1",75,0)
 . S PSJ("SIOPI")=$S($P($G(^PS(55,DFN,"IV",+ON,3)),"^",2)&($P($G(^PS(55,DFN,"IV",+ON,3)),"^")'=""):"!",1:"")_$P($G(^(3)),"^")
"RTN","PSJBCMA1",76,0)
 . N SCHD S SCHD=PSJ("SCHD")  ; SCHD var required to shorten $Select
"RTN","PSJBCMA1",77,0)
 . S PSJ("STC")=$$ONE^PSJBCMA(DFN,ON,SCHD,PSJ("STARTDT"),PSJ("STOPDT"))
"RTN","PSJBCMA1",78,0)
 . I PSJ("STC")=""!(PSJ("STC")="C") S PSJ("STC")=$S(SCHD["PRN":"P",1:"C")
"RTN","PSJBCMA1",79,0)
 . I PSJ("STC")="C" S PSJ("STC")=$S($$ONCALL^PSJBCMA(PSJ("SCHD")):"OC",1:"C")
"RTN","PSJBCMA1",80,0)
 . S PSJ("NURSE")=$P($G(^PS(55,DFN,"IV",+ON,4)),U)
"RTN","PSJBCMA1",81,0)
 . S CLINIC=$G(^PS(55,DFN,"IV",+ON,"DSS"))                       ;*279
"RTN","PSJBCMA1",82,0)
 ;
"RTN","PSJBCMA1",83,0)
 D TMP
"RTN","PSJBCMA1",84,0)
 S X=$P($G(^PS(55,DFN,"IV",+ON,1)),U) S:X]"" ^TMP(PSJTMP,$J,6)=X
"RTN","PSJBCMA1",85,0)
 S CNT=0
"RTN","PSJBCMA1",86,0)
 F X=0:0 S X=$O(@(F_",""AD"","_X_")")) Q:'X  D
"RTN","PSJBCMA1",87,0)
 . S ND=$G(@(F_",""AD"","_X_",0)")),DN=$G(^PS(52.6,+ND,0)) ;,AOINAME=$$OIDF^PSJLMUT1(+$P(DN,U,11)) I AOINAME["NOTFOUND" S AOINAME=""
"RTN","PSJBCMA1",88,0)
 . S CNT=CNT+1,^TMP(PSJTMP,$J,850,CNT,0)=+ND_U_$P(DN,U)_U_$P(ND,U,2)_U_$P(ND,U,3)        ;_U_U_$P(DN,U,11)_U_AOINAME_U_AOIDF
"RTN","PSJBCMA1",89,0)
 . ;add High Risk field to 6th piece of 800 (additv)             ;*279
"RTN","PSJBCMA1",90,0)
 . S $P(^TMP(PSJTMP,$J,850,CNT,0),U,6)=$$HRFLG^PSJBCMA(+ND,"A")
"RTN","PSJBCMA1",91,0)
 ;
"RTN","PSJBCMA1",92,0)
 S:CNT ^TMP(PSJTMP,$J,850,0)=CNT,CNT=0
"RTN","PSJBCMA1",93,0)
 F X=0:0 S X=$O(@(F_",""SOL"","_X_")")) Q:'X  D
"RTN","PSJBCMA1",94,0)
 . S ND=$G(@(F_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0)) ;,SOINAME=$$OIDF^PSJLMUT1(+$P(DN,U,11)) I SOINAME["NOTFOUND" S SOINAME=""
"RTN","PSJBCMA1",95,0)
 . S CNT=CNT+1,^TMP(PSJTMP,$J,950,CNT,0)=+ND_U_$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)        ;_U_U_$P(DN,U,11)_U_SOINAME_U_SOIDF
"RTN","PSJBCMA1",96,0)
 . ;add High Risk field to 6th piece of 800 (additv)             ;*279
"RTN","PSJBCMA1",97,0)
 . S $P(^TMP(PSJTMP,$J,950,CNT,0),U,6)=$$HRFLG^PSJBCMA(+ND,"S")
"RTN","PSJBCMA1",98,0)
 S:CNT ^TMP(PSJTMP,$J,950,0)=CNT
"RTN","PSJBCMA1",99,0)
 K PSJ
"RTN","PSJBCMA1",100,0)
 S X1=0
"RTN","PSJBCMA1",101,0)
 F  S X1=$O(^PS(55,DFN,"IVBCMA",X1)) Q:'X1  D
"RTN","PSJBCMA1",102,0)
 . S XX=$G(^PS(55,DFN,"IVBCMA",X1,0)) Q:$P(XX,"^",2)'=+ON  S PSJBCID=$P(XX,"^"),X2=0
"RTN","PSJBCMA1",103,0)
 . F I=1:1 S X2=$O(^PS(55,DFN,"IVBCMA",X1,"AD",X2)) Q:'X2  D
"RTN","PSJBCMA1",104,0)
 .. S X=^(X2,0),^TMP(PSJTMP,$J,800,PSJBCID,I)=+X_"^"_$S($D(^PS(52.6,+X,0)):$P(^(0),"^"),1:"*****")_"^"_$P(X,"^",2,99)
"RTN","PSJBCMA1",105,0)
 .. ;add High Risk field to 6th piece of 800 (additv)            ;*279
"RTN","PSJBCMA1",106,0)
 .. S $P(^TMP(PSJTMP,$J,800,PSJBCID,I),U,6)=$$HRFLG^PSJBCMA(+X,"A")
"RTN","PSJBCMA1",107,0)
 . I I>1 S ^TMP(PSJTMP,$J,800,PSJBCID,0)=I-1
"RTN","PSJBCMA1",108,0)
 . S X2=0
"RTN","PSJBCMA1",109,0)
 . F I=1:1 S X2=$O(^PS(55,DFN,"IVBCMA",X1,"SOL",X2)) Q:'X2  D
"RTN","PSJBCMA1",110,0)
 .. S X=^(X2,0),^TMP(PSJTMP,$J,900,PSJBCID,I)=$P(X,"^")_"^"_$S($D(^PS(52.7,$P(X,"^"),0)):$P(^(0),"^"),1:"*****")_"^"_$P(X,"^",2,99)
"RTN","PSJBCMA1",111,0)
 .. ;add High Risk field to 6th piece of 900  (sol)              ;*279
"RTN","PSJBCMA1",112,0)
 .. S $P(^TMP(PSJTMP,$J,900,PSJBCID,I),U,6)=$$HRFLG^PSJBCMA(+X,"S")
"RTN","PSJBCMA1",113,0)
 . I I>1 S ^TMP(PSJTMP,$J,900,PSJBCID,0)=I-1
"RTN","PSJBCMA1",114,0)
 . S ^TMP(PSJTMP,$J,1000,PSJBCID)=$P(XX,"^",6)_"^"_$P(XX,"^",8)_"^"_$P(XX,"^",7)
"RTN","PSJBCMA1",115,0)
 Q
"RTN","PSJBCMA1",116,0)
UDPEND ;
"RTN","PSJBCMA1",117,0)
 S X=$G(@(F_",0)"))
"RTN","PSJBCMA1",118,0)
 ;get clinic node per F = global file                            ;*279
"RTN","PSJBCMA1",119,0)
 I $P(F,",")[53.1 S CLINIC=$G(@(F_",""DSS"")"))
"RTN","PSJBCMA1",120,0)
 I $P(F,",")[55 S CLINIC=$G(@(F_",8)"))
"RTN","PSJBCMA1",121,0)
 ;
"RTN","PSJBCMA1",122,0)
 S PSJ("PROVIDER")=$P(X,U,2)
"RTN","PSJBCMA1",123,0)
 S PSJEXIST=$S((PSJ("PROVIDER")'=""):1,1:0)
"RTN","PSJBCMA1",124,0)
 S PSJ("MR")=$P(X,U,3),PSJ("SM")=$P(X,U,5),PSJ("HSM")=$P(X,U,6)
"RTN","PSJBCMA1",125,0)
 S PSJ("ST")=$P(X,U,7),PSJ("STATUS")=$P(X,U,9)
"RTN","PSJBCMA1",126,0)
 S PSJ("LDT")=$P(X,U,16)
"RTN","PSJBCMA1",127,0)
 S:ON["U" PSJ("NGIVEN")=$P(X,U,22)
"RTN","PSJBCMA1",128,0)
 S PSJ("SMYN")=$S(+PSJ("SM"):"YES",1:"NO")
"RTN","PSJBCMA1",129,0)
 S PSJ("HSMYN")=$S(+PSJ("HSM"):"YES",1:"NO")
"RTN","PSJBCMA1",130,0)
 S PSJ("CPRS")=$P(X,U,21),PSJ("PREV")=$P(X,U,25),PSJ("FOLLOW")=$P(X,U,26)
"RTN","PSJBCMA1",131,0)
 S X=$G(@(F_",.2)"))
"RTN","PSJBCMA1",132,0)
 S PSJ("OI")=$P(X,U),PSJ("DO")=$P(X,U,2),PSJ("PRI")=$P(X,U,4),PSJ("FLG")=$P(X,U,7),PSJ("COM")="",PSJ("SRC")=""
"RTN","PSJBCMA1",133,0)
 I PSJ("FLG") D
"RTN","PSJBCMA1",134,0)
 . N S1,A,B,C
"RTN","PSJBCMA1",135,0)
 . S S1="" F  S S1=$O(^PS(55,DFN,5,+ON,9,S1),-1) Q:'S1  S C=$G(^(S1,0)) S A=$P(C,U,3),B=$P(C,U,4) Q:A=7010!(A=7030)  D  I PSJ("SRC")]"" Q
"RTN","PSJBCMA1",136,0)
 .. Q:A'=7000&(A'=7020)
"RTN","PSJBCMA1",137,0)
 .. S PSJ("SRC")=$S(A=7000:"PHARMACIST",A=7020:"CPRS",1:"")
"RTN","PSJBCMA1",138,0)
 .. S PSJ("COM")=$G(@(F_",13)"))
"RTN","PSJBCMA1",139,0)
 S X=$G(@(F_",2)"))
"RTN","PSJBCMA1",140,0)
 S PSJ("SCHD")=$P(X,U),PSJ("STARTDT")=$P(X,U,2)
"RTN","PSJBCMA1",141,0)
 S PSJ("STC")=PSJ("ST")
"RTN","PSJBCMA1",142,0)
 I PSJ("ST")="R"!(PSJ("ST")="C") S PSJ("STC")=$S(PSJ("SCHD")["PRN":"P",$$ONCALL^PSJBCMA(PSJ("SCHD")):"OC",$$ONE^PSJBCMA(DFN,ON,PSJ("SCHD"))="O":"O",1:"C")
"RTN","PSJBCMA1",143,0)
 I PSJ("STC")="O" S PSJ("ST")="O"
"RTN","PSJBCMA1",144,0)
 S PSJ("STOPDT")=$P(X,U,4),PSJ("ADM")=$P(X,U,5)
"RTN","PSJBCMA1",145,0)
 S PSJ("FREQ")=$P(X,U,6)
"RTN","PSJBCMA1",146,0)
 S X=$G(@(F_",4)"))
"RTN","PSJBCMA1",147,0)
 S PSJ("NURSE")=$P(X,U),PSJ("AUTO")=$P(X,U,11)
"RTN","PSJBCMA1",148,0)
 S:ON["U" PSJ("PHARM")=+$P(X,U,3)
"RTN","PSJBCMA1",149,0)
 ; the naked reference on the line below refers to the full reference created by indirect reference to F, where F may refer to ^PS(53.1 or the IV or UD multiple ^PS(55
"RTN","PSJBCMA1",150,0)
 S PSJ("SIOPI")=$S($P($G(@(F_",6)")),"^",2)&($P($G(@(F_",6)")),"^")'=""):"!",1:"")_$$ENSET^PSJBCMA($P($G(^(6)),"^"))
"RTN","PSJBCMA1",151,0)
 NEW FON S FON=ON D SIOPI^PSJBCMA
"RTN","PSJBCMA1",152,0)
 Q 
"RTN","PSJBCMA1",153,0)
 ;
"RTN","PSJBCMA1",154,0)
TMP ;* Setup ^TMP that have common fields between IV and U/D
"RTN","PSJBCMA1",155,0)
 N CLNAME,CLNAMPTR
"RTN","PSJBCMA1",156,0)
 D NAME(PSJ("PROVIDER"),.PSJNAME,"","")
"RTN","PSJBCMA1",157,0)
 S PSJ("PRONAME")=PSJNAME K PSJNAME
"RTN","PSJBCMA1",158,0)
 I $D(PSJ("PHARM")) D
"RTN","PSJBCMA1",159,0)
 . D NAME(PSJ("PHARM"),.PSJNAME,.PSJINIT,.PSJPIEN)
"RTN","PSJBCMA1",160,0)
 . S PSJ("PHARM")=PSJPIEN,PSJ("PNAME")=PSJNAME,PSJ("PINIT")=PSJINIT K PSJNAME,PSJINIT,PSJPIEN
"RTN","PSJBCMA1",161,0)
 I +PSJ("NURSE") D
"RTN","PSJBCMA1",162,0)
 . D NAME(PSJ("NURSE"),.PSJNAME,.PSJINIT,"")
"RTN","PSJBCMA1",163,0)
 . S PSJ("NNAME")=PSJNAME,PSJ("NINIT")=PSJINIT K PSJNAME,PSJINIT
"RTN","PSJBCMA1",164,0)
 S A=$G(^PS(51.2,+PSJ("MR"),0)),PSJ("MRNM")=$P(A,U),PSJ("MRABB")=$P(A,U,3),PSJ("MRPIJ")=$P(A,U,8),PSJ("MRIVP")=$P(A,U,9)
"RTN","PSJBCMA1",165,0)
 S PSJ("MRSTDRNM")=$$GET1^DIQ(51.2,+PSJ("MR"),10)  ;*267 Std Rte name
"RTN","PSJBCMA1",166,0)
 S PSJ("OINAME")=$$OIDF^PSJLMUT1(+PSJ("OI")) I PSJ("OINAME")["NOT FOUND" S PSJ("OINAME")=""
"RTN","PSJBCMA1",167,0)
 S PSJ("OIDF")=$$GET1^DIQ(50.7,+PSJ("OI"),.02)
"RTN","PSJBCMA1",168,0)
 I PSJ("OINAME")="" S PSJ("OIDF")=""
"RTN","PSJBCMA1",169,0)
 S PSJ("LDTN")=$$DATE(PSJ("LDT"))
"RTN","PSJBCMA1",170,0)
 S PSJ("STARTDTN")=$$DATE(PSJ("STARTDT"))
"RTN","PSJBCMA1",171,0)
 S PSJ("STOPDTN")=$$DATE(PSJ("STOPDT"))
"RTN","PSJBCMA1",172,0)
 S X=$S(ON["V":PSJ("STC"),1:PSJ("ST"))
"RTN","PSJBCMA1",173,0)
 S PSJ("STNAME")=$S(X="C":"CONTINUOUS",X="O":"ONE TIME",X="P":"PRN",X="R":"FILL ON REQUEST",X="OC":"ON CALL",1:"NOT FOUND")
"RTN","PSJBCMA1",174,0)
 ;
"RTN","PSJBCMA1",175,0)
 S ^TMP(PSJTMP,$J,0)=DFN_U_+ON_U_ON_U_PSJ("PREV")_U_PSJ("FOLLOW")_U_$G(PSJ("IVTYPE"))_U_$G(PSJ("INSYR"))_U_$G(PSJ("CHEMO"))_U_PSJ("CPRS")
"RTN","PSJBCMA1",176,0)
 ;add Clinic name & IEN ptr to TMP 0 node (pieces 11,12)          *279
"RTN","PSJBCMA1",177,0)
 ;piece 11 determines if order is a CO or IM for BCMA VDL's       *279
"RTN","PSJBCMA1",178,0)
 I +CLINIC,$$CLINIC^PSJBCMA(CLINIC) D   ;CL IEN & valid appt date *279
"RTN","PSJBCMA1",179,0)
 . S CLNAMPTR=$O(^PS(53.46,"B",+CLINIC,""))
"RTN","PSJBCMA1",180,0)
 . S CLNAME=$$GET1^DIQ(53.46,CLNAMPTR_",",.01)
"RTN","PSJBCMA1",181,0)
 . S $P(^TMP(PSJTMP,$J,0),U,11)=CLNAME      ;CO ind, CO NAME
"RTN","PSJBCMA1",182,0)
 . S $P(^TMP(PSJTMP,$J,0),U,12)=+CLINIC     ;IEN ptr to file 44
"RTN","PSJBCMA1",183,0)
 ;
"RTN","PSJBCMA1",184,0)
 S ^TMP(PSJTMP,$J,1)=PSJ("PROVIDER")_U_PSJ("PRONAME")_U_PSJ("MR")_U_PSJ("MRABB")_U_$G(PSJ("SM"))_U_$G(PSJ("SMYN"))_U_$G(PSJ("HSM"))_U_$G(PSJ("HSMYN"))_U_$G(PSJ("NGIVEN"))_U_PSJ("STATUS")
"RTN","PSJBCMA1",185,0)
 S ^TMP(PSJTMP,$J,1)=^TMP(PSJTMP,$J,1)_U_$$STATUS(ON,PSJ("STATUS"))_U_$G(PSJ("AUTO"))_U_$G(PSJ("MRNM"))_U_PSJ("MRSTDRNM") ;*267 Std Rte nam
"RTN","PSJBCMA1",186,0)
 S ^TMP(PSJTMP,$J,1,0)=PSJ("MRPIJ")_U_$G(PSJ("MRIVP"))
"RTN","PSJBCMA1",187,0)
 S ^TMP(PSJTMP,$J,2)=PSJ("OI")_U_PSJ("OINAME")_U_PSJ("DO")_U_$P($G(PSJ("INFRATE")),"@")_U_$G(PSJ("SCHD"))_U_PSJ("OIDF")
"RTN","PSJBCMA1",188,0)
 S ^TMP(PSJTMP,$J,3)=PSJ("SIOPI")
"RTN","PSJBCMA1",189,0)
 S ^TMP(PSJTMP,$J,4)=PSJ("STC")_U_$G(PSJ("STNAME"))_U_PSJ("LDT")_U_PSJ("LDTN")_U_PSJ("STARTDT")_U_PSJ("STARTDTN")_U_PSJ("STOPDT")_U_PSJ("STOPDTN")_U_$$ADMIN(PSJ("ADM"))_U_$G(PSJ("ST"))_U_$G(PSJ("FREQ"))
"RTN","PSJBCMA1",190,0)
 S ^TMP(PSJTMP,$J,5)=$G(PSJ("NURSE"))_U_$G(PSJ("NNAME"))_U_$G(PSJ("NINIT"))_U_$G(PSJ("PHARM"))_U_$G(PSJ("PNAME"))_U_$G(PSJ("PINIT"))
"RTN","PSJBCMA1",191,0)
 S A=$$SNDTSTA^PSJHL4A(PSJ("PRI"),PSJ("SCHD"))
"RTN","PSJBCMA1",192,0)
 S ^TMP(PSJTMP,$J,7)=$S(A=1:0,1:1)_U_PSJ("FLG")_U_PSJ("SRC")_U_PSJ("COM")
"RTN","PSJBCMA1",193,0)
 Q
"RTN","PSJBCMA1",194,0)
 ;
"RTN","PSJBCMA1",195,0)
NAME(X,NAME,INIT,IEN)  ;Lookup in ^VA(200.
"RTN","PSJBCMA1",196,0)
 ;X = IEN or Name in ^VA(200
"RTN","PSJBCMA1",197,0)
 ;IEN = Return IEN in ^VA(200
"RTN","PSJBCMA1",198,0)
 ;NAME = Return the name in 200
"RTN","PSJBCMA1",199,0)
 ;INIT = Return the initial
"RTN","PSJBCMA1",200,0)
 NEW DIC,Y
"RTN","PSJBCMA1",201,0)
 S DIC="^VA(200,",DIC(0)="NZ" D ^DIC
"RTN","PSJBCMA1",202,0)
 S IEN=+Y
"RTN","PSJBCMA1",203,0)
 S NAME=$G(Y(0,0))
"RTN","PSJBCMA1",204,0)
 S INIT=$P($G(Y(0)),U,2)
"RTN","PSJBCMA1",205,0)
 Q
"RTN","PSJBCMA1",206,0)
 ;
"RTN","PSJBCMA1",207,0)
DATE(Y) ; FM internal date/time to user readable, 4 digit year
"RTN","PSJBCMA1",208,0)
 ; Y - date in FileMan internal format
"RTN","PSJBCMA1",209,0)
 I $G(Y) S Y=Y_$E(".",Y'[".")_"0000" Q $E(Y,4,5)_"/"_$E(Y,6,7)_"/"_($E(Y,1,3)+1700)_"  "_$E(Y,9,10)_":"_$E(Y,11,12)
"RTN","PSJBCMA1",210,0)
 Q "********"
"RTN","PSJBCMA1",211,0)
 ;
"RTN","PSJBCMA1",212,0)
STATUS(ON,X)          ;
"RTN","PSJBCMA1",213,0)
 ; ON = IEN_"I/U/P"
"RTN","PSJBCMA1",214,0)
 ; X  = STATUS
"RTN","PSJBCMA1",215,0)
 I X="P" Q $S(ON["P":"PENDING",ON["V":"PURGE",1:"NOT FOUND")
"RTN","PSJBCMA1",216,0)
 Q $S(X="A":"ACTIVE",X="D":"DISCONTINUED",X="E":"EXPIRED",X="H":"HOLD",X="R":"RENEWED",X="RE":"REINSTATED",X="N":"NON-VERFIED",X="DE":"DISCONTINUED (EDIT)",X="O":"ON CALL",1:"NOT FOUND")
"RTN","PSJBCMA1",217,0)
 ;
"RTN","PSJBCMA1",218,0)
ADMIN(X) ;
"RTN","PSJBCMA1",219,0)
 NEW Y,PSJADM,PSJX S PSJADM=""
"RTN","PSJBCMA1",220,0)
 I X="" Q ""
"RTN","PSJBCMA1",221,0)
 F Y=1:1:$L(X,"-") S PSJX=$E($P(X,"-",Y)_"0000",1,4) D
"RTN","PSJBCMA1",222,0)
 . S PSJADM=PSJADM_$S(PSJADM]"":"-",1:"")_PSJX
"RTN","PSJBCMA1",223,0)
 Q PSJADM
"RTN","PSJBCMA1",224,0)
 ;
"RTN","PSJBCMA1",225,0)
MVOPIAL(DFN,PSJI1,PSJI2) ; Move Other Print Info Activity log entries from NV order to Active order, during Verification
"RTN","PSJBCMA1",226,0)
 Q:'$G(DFN)!'$G(PSJI1)!'$G(PSJI2)  Q:'$D(^PS(55,DFN,"IV",+PSJI2,0))
"RTN","PSJBCMA1",227,0)
 I PSJI1["P",PSJI2["V" N AL,ALND,PNDND0,TXTLN,TXTCNT S AL=0,ALND=0 F  S AL=$O(^PS(53.1,+PSJI1,"A",AL)) Q:'AL  I ^(AL,0)["OTHER PRINT INFO" D
"RTN","PSJBCMA1",228,0)
 .Q:'$D(^PS(53.1,+PSJI1,"A",AL,1,0))  ; Don't retain activity log entry if no text
"RTN","PSJBCMA1",229,0)
 .S PNDND0=$G(^PS(53.1,+PSJI1,"A",AL,0)) N USER,NAME S USER=$P(PNDND0,"^",2) D NAME^PSGSICH(USER,.NAME)
"RTN","PSJBCMA1",230,0)
 .N AL2 S AL2=$O(^PS(55,DFN,"IV",+PSJI2,"A"," "),-1)+1 N OPILIN S OPILIN=+$O(^PS(53.1,+PSJI1,"A",AL,1,""),-1)
"RTN","PSJBCMA1",231,0)
 .S ^PS(55,DFN,"IV",+PSJI2,"A",AL2,0)=AL_"^E^"_NAME_"^^"_$P(PNDND0,"^")_"^"_USER,^PS(55,DFN,"IV",+PSJI2,"A",AL2,1,0)="^55.151^1^1"
"RTN","PSJBCMA1",232,0)
 .S ^PS(55,DFN,"IV",+PSJI2,"A",AL2,1,1,0)="OTHER PRINT INFO"
"RTN","PSJBCMA1",233,0)
 .S TXTLN=0 F TXTCNT=0:1 S TXTLN=$O(^PS(53.1,+PSJI1,"A",AL,1,TXTLN)) Q:'TXTLN  D
"RTN","PSJBCMA1",234,0)
 ..S ^PS(55,DFN,"IV",+PSJI2,"A",AL2,2,TXTLN,0)=^PS(53.1,+PSJI1,"A",AL,1,TXTLN,0)
"RTN","PSJBCMA1",235,0)
 .I $G(TXTCNT) S ^PS(55,DFN,"IV",+PSJI2,"A",AL2,2,0)="^^"_+$G(TXTCNT)_"^"_$G(TXTCNT)_"^"_+$G(^PS(53.1,+PSJI1,"A",AL,0)) D
"RTN","PSJBCMA1",236,0)
 ..S ^PS(55,DFN,"IV",+PSJI2,"A",AL2,1,1,0)="OTHER PRINT INFO"
"RTN","PSJBCMA1",237,0)
 Q
"RTN","PSJBCMA1",238,0)
 ;
"RTN","PSJBCMA1",239,0)
OPIWARN(AFTER) ; Warn user about OPI not printing on IV labels
"RTN","PSJBCMA1",240,0)
 N DIR S DIR=""
"RTN","PSJBCMA1",241,0)
 N PSJSTARZ S $P(PSJSTARZ,"*",69)="*" W !!?5,$E(PSJSTARZ,1,29)," WARNING ",$E(PSJSTARZ,1,31)
"RTN","PSJBCMA1",242,0)
 W !?5,"**",$S(AFTER:"             ",1:"            If "),"OTHER PRINT INFO exceeds 60 characters"_$S(AFTER:"!             **",1:",           **")
"RTN","PSJBCMA1",243,0)
 W !?5,"**  'Instructions too long. See Order View or BCMA for full text.' **"
"RTN","PSJBCMA1",244,0)
 W !?5,"**      will print on the IV label instead of the full text.       **",!?5,PSJSTARZ
"RTN","PSJBCMA1",245,0)
 W !! D PAUSE^VALM1
"RTN","PSJBCMA1",246,0)
 Q
"RTN","PSJBCMA6")
0^44^B9827080^n/a
"RTN","PSJBCMA6",1,0)
PSJBCMA6  ;B'ham/JCH - Send Message when Clinic Order Setup incomplete ; 18 Aug 98 / 2:48 PM
"RTN","PSJBCMA6",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**279**;16 DEC 97;Build 150
"RTN","PSJBCMA6",3,0)
 ;
"RTN","PSJBCMA6",4,0)
 Q
"RTN","PSJBCMA6",5,0)
NOCLDEF(DFN,ORDER) ; If clinic not defined in Clinic Definition file for Pending order, send message
"RTN","PSJBCMA6",6,0)
 Q:'$G(DFN)!'$G(ORDER)  Q:'(ORDER["P")
"RTN","PSJBCMA6",7,0)
 N I,CL,CLNM,PSJMARR,DIC,X,Y,NDP2,ND0,MSG2
"RTN","PSJBCMA6",8,0)
 S CL=$G(^PS(53.1,+ORDER,"DSS")) Q:'CL!'$P(CL,"^",2)
"RTN","PSJBCMA6",9,0)
 S DIC="^PS(53.46,",DIC(0)="NSUZX",X=+CL D ^DIC Q:(Y>0)
"RTN","PSJBCMA6",10,0)
 ;
"RTN","PSJBCMA6",11,0)
 S DIC="^SC(",DIC(0)="NSUXZ",X=+CL D ^DIC Q:'$G(Y)
"RTN","PSJBCMA6",12,0)
 S CLNM=$P(Y,"^",2)
"RTN","PSJBCMA6",13,0)
 S PSJMARR(1,0)=" The following location is not defined in the CLINIC DEFINITION (#53.46) file:"
"RTN","PSJBCMA6",14,0)
 S PSJMARR(3,0)="   Location.......: "_CLNM
"RTN","PSJBCMA6",15,0)
 S PSJMARR(4,0)=" As a result, the following Clinic Order will not display in BCMA:"
"RTN","PSJBCMA6",16,0)
 S PSJMARR(5,0)="   Patient DFN....: "_DFN
"RTN","PSJBCMA6",17,0)
 S PSJMARR(6,0)="   Order Number...: "_ORDER,PSJMARR(7,0)=""
"RTN","PSJBCMA6",18,0)
 S MSG2=" Clinic Orders associated with "_CLNM_" will not display in BCMA unless the clinic is defined in the CLINIC DEFINITION (#53.46) file, and the SEND TO BCMA (#3) field is set to YES."
"RTN","PSJBCMA6",19,0)
 D TXT^PSGMUTL(MSG2,74)
"RTN","PSJBCMA6",20,0)
 S I="" F  S I=$O(MARX(I)) Q:I=""  S PSJMARR(7+I,0)=" "_MARX(I)
"RTN","PSJBCMA6",21,0)
 D MSGEN(.PSJMARR)
"RTN","PSJBCMA6",22,0)
 K %
"RTN","PSJBCMA6",23,0)
 Q
"RTN","PSJBCMA6",24,0)
MSGEN(PSJCLMSG) ; Begin
"RTN","PSJBCMA6",25,0)
 D SENDMSG
"RTN","PSJBCMA6",26,0)
 Q
"RTN","PSJBCMA6",27,0)
SENDMSG ;Send mail message
"RTN","PSJBCMA6",28,0)
 K PSG,XMY S XMDUZ="MEDICATIONS,INPATIENT",XMSUB="INCOMPLETE CLINIC DEFINITION SETUP",XMTEXT="PSGCL(",XMY("G.PSJ CLINIC DEFINITION")="" D NOW^%DTC S Y=% X ^DD("DD")
"RTN","PSJBCMA6",29,0)
 N I S I="" F  S I=$O(PSJCLMSG(I)) Q:I=""  S PSGCL(I,0)=$G(PSJCLMSG(I,0))
"RTN","PSJBCMA6",30,0)
 D ^XMD
"RTN","PSJBCMA6",31,0)
 ;
"RTN","PSJBCMA6",32,0)
DONE ;
"RTN","PSJBCMA6",33,0)
 K DA,DIK,X,XMDUZ,XMSUB,XMTEXT,XMY,Y,PSGCL,MARX,XMDUN,XMMG,XMZ
"RTN","PSJBCMA6",34,0)
 Q
"RTN","PSJBCMA6",35,0)
 ;
"RTN","PSJBCMA6",36,0)
GETDT ; check date/time for job to run
"RTN","PSJBCMA6",37,0)
 N %DT,Y S %DT="NRS"
"RTN","PSJBCMA6",38,0)
 D ^%DT I Y=-1 K X
"RTN","PSJBCMA6",39,0)
 E  S X=Y
"RTN","PSJBCMA6",40,0)
 Q
"RTN","PSJBCMA6",41,0)
CON() ;
"RTN","PSJBCMA6",42,0)
 N %DT S %DT="NRS" D ^%DT
"RTN","PSJBCMA6",43,0)
 Q Y
"RTN","PSJBCMA6",44,0)
 ;
"RTN","PSJBCMA6",45,0)
CWARN(DFN,ORDER) ; Display warning about undefined CLINIC DEFINITION
"RTN","PSJBCMA6",46,0)
 Q:'$G(DFN)!'$G(ORDER)  Q:'(ORDER["P")
"RTN","PSJBCMA6",47,0)
 N I,MARX,MSG1,I,CL,CLNM,DIC,X,Y
"RTN","PSJBCMA6",48,0)
 S CL=$G(^PS(53.1,+ORDER,"DSS")) Q:'CL!'$P(CL,"^",2)
"RTN","PSJBCMA6",49,0)
 S DIC="^PS(53.46,",DIC(0)="NSUZX",X=+CL D ^DIC Q:(Y>0)
"RTN","PSJBCMA6",50,0)
 S DIC="^SC(",DIC(0)="NSUXZ",X=+CL D ^DIC Q:'$G(Y)
"RTN","PSJBCMA6",51,0)
 S CLNM=$P(Y,"^",2)
"RTN","PSJBCMA6",52,0)
 D CLEAR^VALM1,FULL^VALM1
"RTN","PSJBCMA6",53,0)
 S MSG1="Clinic "_CLNM_" is not defined in the CLINIC DEFINITION (#53.46) file."
"RTN","PSJBCMA6",54,0)
 D TXT^PSGMUTL(MSG1,70)
"RTN","PSJBCMA6",55,0)
 W ! S I="" F  S I=$O(MARX(I)) Q:I=""  W !,MARX(I)
"RTN","PSJBCMA6",56,0)
 W !!,"This order will NOT display in BCMA, unless the clinic is defined in the"
"RTN","PSJBCMA6",57,0)
 W !,"CLINIC DEFINITION (#53.46) file, and the SEND TO BCMA (#3) field is set to YES."
"RTN","PSJBCMA6",58,0)
 W !!,"Please contact your Pharmacy ADPAC.",!
"RTN","PSJBCMA6",59,0)
 D CONT^PSJOE0
"RTN","PSJBCMA6",60,0)
 Q
"RTN","PSJCLOR2")
0^20^B116286849^B116137522
"RTN","PSJCLOR2",1,0)
PSJCLOR2 ;BIR/JCH - BUILD CLINIC ORDER LM HEADERS ; 2/28/12 9:11am
"RTN","PSJCLOR2",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**275,279**;16 DEC 97;Build 150
"RTN","PSJCLOR2",3,0)
 ;
"RTN","PSJCLOR2",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJCLOR2",5,0)
 ; Reference to CWAD^ORQPT2 is supported by DBIA 2831.
"RTN","PSJCLOR2",6,0)
 ; Reference to ^SC is supported by DBIA 10040.
"RTN","PSJCLOR2",7,0)
 ;
"RTN","PSJCLOR2",8,0)
HDR(DFN) ; -- list screen header
"RTN","PSJCLOR2",9,0)
 ;   input:       DFN := ifn of pat
"RTN","PSJCLOR2",10,0)
 ;  output:  VALMHDR() := hdr array
"RTN","PSJCLOR2",11,0)
 ;
"RTN","PSJCLOR2",12,0)
 K VAIN,VADM,GMRA,PSJACNWP,PSJ,VAERR,VA,X
"RTN","PSJCLOR2",13,0)
 S PSJACNWP=1 D ENBOTH^PSJAC
"RTN","PSJCLOR2",14,0)
 D HDRO(DFN)
"RTN","PSJCLOR2",15,0)
 S PSJ="   Sex: "_$P(PSJPSEX,U,2),VALMHDR(4)=$$SETSTR^VALM1($S(PSJPDD:"Last ",1:"     ")_"Admitted: "_$P($G(PSJPAD),U,2),PSJ,45,23)
"RTN","PSJCLOR2",16,0)
 S PSJ="    Dx: "_$G(PSJPDX)
"RTN","PSJCLOR2",17,0)
 S:PSJPDD VALMHDR(5)=$$SETSTR^VALM1("Discharged: "_$E($P(PSJPDD,U,2),1,8),PSJ,48,26)
"RTN","PSJCLOR2",18,0)
 S:'PSJPDD VALMHDR(5)=$$SETSTR^VALM1("Last transferred: "_$$ENDTC^PSGMI(PSJPTD),PSJ,42,26)
"RTN","PSJCLOR2",19,0)
 Q
"RTN","PSJCLOR2",20,0)
 ;
"RTN","PSJCLOR2",21,0)
HDRO(DFN) ; Standardized part of profile header.
"RTN","PSJCLOR2",22,0)
 N PSJCLIN,PSJAPPT,PSJCLINN,RMORDT S (PSJCLIN,PSJAPPT)=0,(RMORDT,PSJCLINN)="" I $G(PSJORD) D
"RTN","PSJCLOR2",23,0)
 . S PSJCLIN=$S($G(PSJORD)["V":$G(^PS(55,DFN,"IV",+PSJORD,"DSS")),$G(PSJORD)["U":$G(^PS(55,DFN,5,+PSJORD,8)),$G(PSJORD)["P":$G(^PS(53.1,+PSJORD,"DSS")),1:"")
"RTN","PSJCLOR2",24,0)
 . S:PSJCLIN PSJAPPT=$P($G(PSJCLIN),U,2) I PSJCLIN,PSJAPPT S PSJCLINN=$P($G(^SC(+PSJCLIN,0)),U)
"RTN","PSJCLOR2",25,0)
 K VALMHDR I PSJCLINN]"" S PSJ=VADM(1),PSJ=$$SETSTR^VALM1("   Clinic: "_PSJCLINN,PSJ,28,26)
"RTN","PSJCLOR2",26,0)
 I PSJCLINN="" S PSJ=VADM(1),PSJ=$$SETSTR^VALM1($S('PSJPDD:"     ",1:"Last ")_"Ward: "_PSJPWDN,PSJ,30,18)
"RTN","PSJCLOR2",27,0)
 S X=$$CWAD^ORQPT2(DFN)
"RTN","PSJCLOR2",28,0)
 S:X]"" X=$G(IORVON)_X_$G(IORVOFF),PSJ=$$SETSTR^VALM1(X,PSJ,80-$L(X),80) S VALMHDR(1)=PSJ
"RTN","PSJCLOR2",29,0)
 S PSJ="   PID: "_$P(PSJPSSN,U,2)
"RTN","PSJCLOR2",30,0)
 S RMORDT=$S($G(PSJPDD):"Last ",1:"     ")_"Room-Bed: "_$G(PSJPRB)
"RTN","PSJCLOR2",31,0)
 I PSJCLINN]"",PSJAPPT S RMORDT="Clinic Date: "_$$ENDTC^PSGMI(PSJAPPT),RMORDT=$P(RMORDT,"  ")_" "_$P(RMORDT,"  ",2)
"RTN","PSJCLOR2",32,0)
 S PSJ=$$SETSTR^VALM1(RMORDT,PSJ,26,28),VALMHDR(2)=$$SETSTR^VALM1("Ht(cm): "_PSJPHT_" "_PSJPHTD,PSJ,55,25)
"RTN","PSJCLOR2",33,0)
 S PSJ="   DOB: "_$P($P(PSJPDOB,U,2)," ")_" ("_PSJPAGE_")",VALMHDR(3)=$$SETSTR^VALM1("Wt(kg): "_PSJPWT_" "_PSJPWTD,PSJ,55,25)
"RTN","PSJCLOR2",34,0)
 Q
"RTN","PSJCLOR2",35,0)
 ;
"RTN","PSJCLOR2",36,0)
INIT(PSJPROT) ; -- init bld vars
"RTN","PSJCLOR2",37,0)
 ; PSJPROT=1:UD ONLY; 2:IV ONLY; 3:BOTH
"RTN","PSJCLOR2",38,0)
 K PSJUDPRF,^TMP("PSJ",$J),^TMP("PSJON",$J),^TMP("PSJPRO",$J),^TMP("PSJCLOR",$J) D FULL^VALM1
"RTN","PSJCLOR2",39,0)
 N TMPCLIN,DFN,UDU S PSJVALQ=0,TMPCLIN="",DFN=PSGP,PSGSSAV=PSGSS,UDU=$S($P(PSJSYSU,";",3)>1:3,1:1)
"RTN","PSJCLOR2",40,0)
 S:PSJPROT=1 PSJUDPRF=1
"RTN","PSJCLOR2",41,0)
 D KILL^VALM10(),EN^PSJCLOR3(PSJPROT)
"RTN","PSJCLOR2",42,0)
 I '$D(^TMP("PSJ",$J)) W !!,?22,"NO CLINIC ORDERS FOUND." S VALMQUIT=1,PSJVALQ=1 D PAUSE^PSJLMUTL Q
"RTN","PSJCLOR2",43,0)
 S PSJLN=1,PSJEN=1 S PSJCLIN="" F  S PSJCLIN=$O(^TMP("PSJ",$J,PSJCLIN)) Q:PSJCLIN=""  S PSJTF=0,PSJC="" F  S PSJC=$O(^TMP("PSJ",$J,PSJCLIN,PSJC)) Q:PSJC=""  D
"RTN","PSJCLOR2",44,0)
 .N PSJF S PSJF="^PS("_$S("AO"[PSJC:"55,"_PSGP_",5,",PSJC="DF":"55,"_PSGP_",5,",1:"53.1,")
"RTN","PSJCLOR2",45,0)
 .I TMPCLIN'=PSJCLIN D TF S PSJTF=$E(PSJC,1),TMPCLIN=PSJCLIN    ;DAM 8-29-07 Added Q:PSJC="CB"  Q:PSJC="O"
"RTN","PSJCLOR2",46,0)
 .S PSJST="" F  S PSJST=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST)) Q:PSJST=""  D
"RTN","PSJCLOR2",47,0)
 ..S PSJS="" F  S PSJS=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST,PSJS)) Q:PSJS=""  Q:PSJC="CB"  Q:PSJC="O"  Q:PSJC="DF"  D ON      ;DAM 8-29-07  Added Q:PSJC="CB"  Q:PSJC="O"
"RTN","PSJCLOR2",48,0)
 .;
"RTN","PSJCLOR2",49,0)
 .;DAM 8-29-07   New code to place Pending Orders after Pending Renewal Orders on the roll and scroll display.  Non-Active Orders appear last.
"RTN","PSJCLOR2",50,0)
 S PSJCLIN="" F  S PSJCLIN=$O(^TMP("PSJ",$J,PSJCLIN)) Q:PSJCLIN=""  S PSJTF=0,PSJC="" F  S PSJC=$O(^TMP("PSJ",$J,PSJCLIN,PSJC)) Q:PSJC=""  D
"RTN","PSJCLOR2",51,0)
 . N PSJF S PSJF="^PS("_$S("AO"[PSJC:"55,"_PSGP_",5,",PSJC="DF":"55,"_PSGP_",5,",1:"53.1,")
"RTN","PSJCLOR2",52,0)
 . I PSJC="CB" I TMPCLIN'=PSJCLIN D TF S PSJTF=$E(PSJC,1),TMPCLIN=PSJCLIN                            ;These are Pending Orders
"RTN","PSJCLOR2",53,0)
 . I PSJC="CB" S PSJST="" F  S PSJST=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST)) Q:PSJST=""  D
"RTN","PSJCLOR2",54,0)
 . . S PSJS="" F  S PSJS=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST,PSJS)) Q:PSJS=""   D ON
"RTN","PSJCLOR2",55,0)
 . I PSJC="DF" I TMPCLIN'=PSJCLIN D TF S PSJTF=$E(PSJC,1),TMPCLIN=PSJCLIN                              ;These are recently DC Orders (mv)
"RTN","PSJCLOR2",56,0)
 . I PSJC="DF" S PSJST="" F  S PSJST=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST)) Q:PSJST=""  D
"RTN","PSJCLOR2",57,0)
 . . S PSJS="" F  S PSJS=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST,PSJS)) Q:PSJS=""   D ON
"RTN","PSJCLOR2",58,0)
 . I PSJC="O" I TMPCLIN'=PSJCLIN D TF S PSJTF=$E(PSJC,1),TMPCLIN=PSJCLIN                              ;These are Non-Active Orders
"RTN","PSJCLOR2",59,0)
 . I PSJC="O" S PSJST="" F  S PSJST=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST)) Q:PSJST=""  D
"RTN","PSJCLOR2",60,0)
 . . S PSJS="" F  S PSJS=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST,PSJS)) Q:PSJS=""   D ON
"RTN","PSJCLOR2",61,0)
 .; END DAM changes
"RTN","PSJCLOR2",62,0)
 .;
"RTN","PSJCLOR2",63,0)
 S VALMCNT=PSJLN-1
"RTN","PSJCLOR2",64,0)
DONE ;
"RTN","PSJCLOR2",65,0)
 K ^TMP("PSJCLOR",$J) M ^TMP("PSJCLOR",$J)=^TMP("PSJON",$J)
"RTN","PSJCLOR2",66,0)
 K PSJC,PSJEN,PSJLN,PSJST,PSJS,CNT,PSJPRI,^TMP("PSJ",$J),PSGSSAV,PSJDCEXP,PSJL,PSJON,PSJOS,PSJTF
"RTN","PSJCLOR2",67,0)
 Q
"RTN","PSJCLOR2",68,0)
ON ; Set order number into ^TMP
"RTN","PSJCLOR2",69,0)
 N PSJCLORD S PSJCLORD=1
"RTN","PSJCLOR2",70,0)
 S PSJSCHT=$S(PSJOS:PSJS,1:PSJST)
"RTN","PSJCLOR2",71,0)
 S PSJO="" F FQ=0:0 S PSJO=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST,PSJS,PSJO)) Q:PSJO=""  S DN=^(PSJO) D
"RTN","PSJCLOR2",72,0)
 .N PRJPRI S PSJPRI=$S(PSJO["V":$P($G(^PS(55,PSGP,"IV",+PSJO,.2)),"^",4),PSJO["U":$P($G(^PS(55,PSGP,5,+PSJO,.2)),"^",4),1:$P($G(^PS(53.1,+PSJO,.2)),"^",4))
"RTN","PSJCLOR2",73,0)
 .S ^TMP("PSJON",$J,PSJEN)=PSJO,PSJL=$J(PSJEN,4) D @$S(PSJO["V":"PIV^PSJLMPRI(PSGP,PSJO,PSJF,DN)",PSJO["U":"PUD^PSJLMPRU(PSGP,PSJO,PSJF,DN)",1:"PIV^PSJLMPRI(PSGP,PSJO,PSJF,DN)") S ^TMP("PSJPRO",$J,0)=PSJEN,PSJEN=PSJEN+1
"RTN","PSJCLOR2",74,0)
 .S ^TMP("PSJON",$J)=+$O(^TMP("PSJON",$J,""),-1)
"RTN","PSJCLOR2",75,0)
 K DN,FQ,PSJSCHT
"RTN","PSJCLOR2",76,0)
 Q
"RTN","PSJCLOR2",77,0)
TF ; Set up order type header
"RTN","PSJCLOR2",78,0)
 NEW PSJDFHDR
"RTN","PSJCLOR2",79,0)
 I $D(^TMP("PSJ",$J,PSJCLIN)) D
"RTN","PSJCLOR2",80,0)
 .S PSJDCEXP=$$RECDCEXP^PSJP()
"RTN","PSJCLOR2",81,0)
 .S PSJDFHDR="RECENTLY DISCONTINUED/EXPIRED (LAST "_+$G(PSJDCEXP)_" HOURS)"
"RTN","PSJCLOR2",82,0)
 .N C,X,Y S C=PSJC,Y="",$P(Y," -",40)=""
"RTN","PSJCLOR2",83,0)
 .S X=PSJCLIN
"RTN","PSJCLOR2",84,0)
 .I $G(PSJCLIN)]"" S X=PSJCLIN
"RTN","PSJCLOR2",85,0)
 .S ^TMP("PSJPRO",$J,PSJLN,0)=$E($E(Y,1,(80-$L(X))/2)_" "_X_$E(Y,1,(80-$L(X))/2),1,80),PSJLN=PSJLN+1
"RTN","PSJCLOR2",86,0)
 Q
"RTN","PSJCLOR2",87,0)
TEST ; Headers
"RTN","PSJCLOR2",88,0)
 N X,Y S Y="",$P(Y," -",40)=""
"RTN","PSJCLOR2",89,0)
 F X="A C T I V E","P E N D I N G   R E N E W A L S","P E N D I N G ","N O N - V E R I F I E D","N O N - A C T I V E" W !,$E($E(Y,1,(80-$L(X))/2)_" "_X_$E(Y,1,(80-$L(X))/2),1,80)
"RTN","PSJCLOR2",90,0)
 Q
"RTN","PSJCLOR2",91,0)
VWDETAIL(PSGP) ;
"RTN","PSJCLOR2",92,0)
 N VAIN,VADM,PSJLM,PSGPRF,PSJPRP,PSJSYSL,DFN D ENCV^PSGSETU
"RTN","PSJCLOR2",93,0)
 S DFN=PSGP D ^PSJAC D INIT^PSJCLOR2(3)
"RTN","PSJCLOR2",94,0)
 S PSGPRF="",PSJPRP="P",PSJPR=0,PSJON=+$G(^TMP("PSJON",$J)) D FULL^VALM1,ENVW
"RTN","PSJCLOR2",95,0)
 D DONEVD
"RTN","PSJCLOR2",96,0)
 Q
"RTN","PSJCLOR2",97,0)
ENVW ; ask user to select or view any of the orders shown
"RTN","PSJCLOR2",98,0)
 S (PSGONC,PSGONR,PSGONV)=0,PSGLMT=PSJON S:$D(PSJPRF) PSGPRF=1
"RTN","PSJCLOR2",99,0)
 N PSJXDIR S PSJXDIR=$P($G(XQORNOD(0)),"=",2) I PSJXDIR S X=$E(PSJXDIR,1,$L(PSJXDIR)-1) D ENCHK^PSGON
"RTN","PSJCLOR2",100,0)
 I '$G(PSJXDIR) D ENASR^PSGON
"RTN","PSJCLOR2",101,0)
 K PSGPRF
"RTN","PSJCLOR2",102,0)
 G:X["^" DONEVD I X]"" S PSGOEA=""
"RTN","PSJCLOR2",103,0)
 K PSJDLW
"RTN","PSJCLOR2",104,0)
 I  F PSJOE=1:1:PSGODDD S PSGOE=PSJOE F PSJOE1=1:1:$L(PSGODDD(PSJOE),",")-1 S PSJOE2=$P(PSGODDD(PSJOE),",",PSJOE1),(PSGORD,PSJORD)=^TMP("PSJON",$J,PSJOE2) G:$D(PSJDLW) DONEVD D
"RTN","PSJCLOR2",105,0)
 .I PSJORD=+PSJORD N PSJO,PSJO1 S PSJO=PSJORD,PSJO1=0 F  S PSJO1=$O(^PS(53.1,"ACX",PSJO,PSJO1)) Q:'PSJO1  Q:$D(PSJDLW)  S PSJORD=PSJO1_"P",PSGOEA="" D GODO(PSJORD) S PSJORD=""
"RTN","PSJCLOR2",106,0)
 .Q:PSJORD=""  S PSGOEA="" D GODO(PSJORD)
"RTN","PSJCLOR2",107,0)
 Q
"RTN","PSJCLOR2",108,0)
 ;
"RTN","PSJCLOR2",109,0)
GODO(PSJORD) ; 
"RTN","PSJCLOR2",110,0)
 D GODO^PSJOE0
"RTN","PSJCLOR2",111,0)
 Q
"RTN","PSJCLOR2",112,0)
DONEVD ; Kill variables
"RTN","PSJCLOR2",113,0)
 K DTOUT,PSGONC,PSGONR,PSGONV,PSGODDD,PSGOE,PSGOEA,PSJL,PSJOE,PSJOE1,PSJOE2,PSJON,PSJPR,PSJPRF
"RTN","PSJCLOR2",114,0)
 Q
"RTN","PSJCLOR2",115,0)
 ;
"RTN","PSJCLOR2",116,0)
NEWORDER(PSGP,PSGORD,PSGNWSD,PSGOEAV) ;
"RTN","PSJCLOR2",117,0)
 N PSGSD,PSGOEEF,PSGOFD,PSGNEFD,PSGOSD,PSGFD,PSGAT,PSGFDN S PSGOEEF(10)=1,PSJNOLOK=0
"RTN","PSJCLOR2",118,0)
 K DIR I '$$LS^PSSLOCK(DFN,PSGORD) W !,"NO ACTION TAKEN ON ORDER",! D CONT^PSJOE0 S PSJNOLOK=1 Q
"RTN","PSJCLOR2",119,0)
 I $D(^PS(53.45,+$G(PSJSYSP),5)) N PSJFSI S PSJFSI=1 D FILESI^PSJBCMA5(DFN,PSGORD) N SIARRAY S SIARRAY="" D
"RTN","PSJCLOR2",120,0)
 .I PSGORD["P" M SIARRAY=^PS(53.1,+PSGORD,15) D NEWNVAL^PSGAL5(PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSJCLOR2",121,0)
 .I PSGORD["U" M SIARRAY=^PS(55,DFN,5,+PSGORD,15) D NEWUDAL^PSGAL5(DFN,PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSJCLOR2",122,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D NEW^PSJCOM1 Q
"RTN","PSJCLOR2",123,0)
 ;
"RTN","PSJCLOR2",124,0)
 I PSGORD["P"!(PSGORD["U") D
"RTN","PSJCLOR2",125,0)
 .N PSGST,PSGSCH,PSGNESD,ND,ND2,PSJEDFLD,I
"RTN","PSJCLOR2",126,0)
 .F I=0,2 S ND(I)=$S($G(PSGORD)["P":$G(^PS(53.1,+PSGORD,I)),$G(PSGORD)["U":$G(^PS(55,+$G(PSGP),5,+PSGORD,I)),$G(PSJTMPON)["V":$G(^PS(55,+$G(PSGP),"IV",+PSGORD,I)),1:"")
"RTN","PSJCLOR2",127,0)
 .S PSGNESD=PSGNWSD,PSGSCH=$S(PSGORD["P"!(PSGORD["U"):$P(ND(2),"^"),PSGORD["V":$P(ND(0),"^",9),1:"")
"RTN","PSJCLOR2",128,0)
 .S PSGST=$S(PSGORD["P"!(PSGORD["U"):$P(ND(0),"^",7),1:""),(PSGFD,PSGOFD)=$S(PSGORD["V":$P(ND(0),"^",3),1:$P(ND(2),"^",4)),(PSGSD,PSGOSD)=$S(PSGORD["V":$P(ND(0),"^",2),1:$P(ND(2),"^",2))
"RTN","PSJCLOR2",129,0)
 .S PSGNEFD="" D ENFD^PSGNE3(PSGNWSD) S PSGFD=$S($G(PSGRDTX(+PSGORD,"PSGFD")):PSGRDTX(+PSGORD,"PSGFD"),1:PSGNEFD)
"RTN","PSJCLOR2",130,0)
 .I $G(PSGNEFD),(PSGNEFD<PSGNWSD) W $C(7),!?5,"*** THE START DATE CANNOT BE AFTER THE STOP DATE! ***" S PSJQMSG=1 Q
"RTN","PSJCLOR2",131,0)
 .S PSJEDFLD=$S(PSGORD["P":25,1:34) S PSGOEEF(PSJEDFLD)=1
"RTN","PSJCLOR2",132,0)
 ;
"RTN","PSJCLOR2",133,0)
 I PSGORD["U" D  Q
"RTN","PSJCLOR2",134,0)
 .N TMPNEFD S TMPNEFD=$G(PSGNEFD) S PSGOEEWF="^PS(55,"_PSGP_",5,"_+PSGORD_"," S (ND,ND0)=$G(@(PSGOEEWF_"0)")),ND2=$G(^(2))
"RTN","PSJCLOR2",135,0)
 .D EN2^PSGOEEW
"RTN","PSJCLOR2",136,0)
 .S PSGOORD=PSGORD S (PSGNESD,SD,PSGSD)=PSGNWSD I ($G(TMPNEFD)'="") S (PSGNEFD,PSGFD)=TMPNEFD,PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC^PSGMI(PSGNEFD)
"RTN","PSJCLOR2",137,0)
 .S PSGOFD=$P(^PS(55,PSGP,5,+PSGORD,2),"^",4),PSGOEENO=1,PSJOCL=+$G(^PS(55,PSGP,5,+PSGORD,8))
"RTN","PSJCLOR2",138,0)
 .W !,"START DATE/TIME: ",$$ENDD^PSGMI(PSGSD) D A34^PSJCLOR4
"RTN","PSJCLOR2",139,0)
 .S PSJNOO=$$ENNOO^PSJUTL5("E") I PSJNOO<0 W "    No changes made to this order!" D CONT^PSJOE0 Q
"RTN","PSJCLOR2",140,0)
 .N PSJOCL,PSGOEENO S PSGOEENO=1,PSJOCL=+$G(^PS(55,PSGP,5,+PSGORD,8))
"RTN","PSJCLOR2",141,0)
 .D NEW^PSGOEE
"RTN","PSJCLOR2",142,0)
 .Q
"RTN","PSJCLOR2",143,0)
 ;
"RTN","PSJCLOR2",144,0)
 I PSGORD["P"  D
"RTN","PSJCLOR2",145,0)
 .N DR,PSJTMPFD,P S DR="10////^S X=PSGSD;" S:$G(PSGOEEF(25)) DR=DR_"25////^S X=PSGFD;" S DR=DR_"W ""."";"
"RTN","PSJCLOR2",146,0)
 .S PSJTMPFD=PSGFD
"RTN","PSJCLOR2",147,0)
 .D GETUD^PSJLMGUD(PSGP,PSGORD) N PSGNESD,PSGPDRG,PSJOCL S PSGPDRG=PSGPD,PSJOCL=+$G(^PS(53.1,+PSGORD,"DSS")) S:$G(PSGOEEF(25)) (PSGNEFD,PSGFD)=PSJTMPFD,PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC^PSGMI(PSGNEFD)
"RTN","PSJCLOR2",148,0)
 .Q:'$G(PSJOCL)  S PSGS0Y=PSGAT,(PSGNESD,PSGSD)=PSGNWSD,PSGPDRG=PSGPD,PSGPDRGN=PSGPDN,PSGOEE="E"
"RTN","PSJCLOR2",149,0)
 .W !,"START DATE/TIME: ",$$ENDD^PSGMI(PSGSD) D A25NV^PSJCLOR4
"RTN","PSJCLOR2",150,0)
 .N PSGOEENO S PSGOEENO=0 D UPD^PSGOEE
"RTN","PSJCLOR2",151,0)
 .D EN1^PSJHL2(PSGP,"XX",PSGORD)
"RTN","PSJCLOR2",152,0)
 ;
"RTN","PSJCLOR2",153,0)
 I PSGORD["V" D
"RTN","PSJCLOR2",154,0)
 .N ON55,ND,ND2,ND0,PSIVCHG,PSIVSYSP,P,PSJSTRDF,PSJSTPDF,PSJINIV S PSGOEEWF="^PS(55,"_PSGP_",""IV"","_+PSGORD_",",PSIVCHG=1
"RTN","PSJCLOR2",155,0)
 .I '$G(XQORNOD),$G(PSJTMPXQ) N XQORNOD S XQORNOD=PSJTMPXQ
"RTN","PSJCLOR2",156,0)
 .S XQORNOD(0)="^^E"
"RTN","PSJCLOR2",157,0)
 .S PSJSYSW0=$G(PSJSYSW0) ; Initialize/restore PSJSYSW0 ward parameters. Killed at exit in ENKV^PSGSETU.
"RTN","PSJCLOR2",158,0)
 .I $G(PSGOEAV),'$P(PSJSYSP0,U,9) S PSIVSYSP=PSJSYSP0 N PSJSYSP0 S PSJSYSP0=PSIVSYSP,$P(PSJSYSP0,"^",9)=1
"RTN","PSJCLOR2",159,0)
 .S (ND,ND0)=$G(@(PSGOEEWF_"0)")),ND2=$G(^(2)),ON55=PSGORD
"RTN","PSJCLOR2",160,0)
 .D GT55^PSIVORFB S P(2)=PSGNWSD D ENSTOP^PSIVCAL
"RTN","PSJCLOR2",161,0)
 .W !,"START DATE/TIME: ",$$ENDD^PSGMI(P(2))
"RTN","PSJCLOR2",162,0)
 .D A25V^PSJCLOR4(PSGP,PSGORD)
"RTN","PSJCLOR2",163,0)
 .D NEWORD^PSIVOPT1
"RTN","PSJCLOR2",164,0)
 .S PSJORL=$$ENORL^PSJUTL($G(VAIN(4))) S ON=ON55,OD=P(2) D:ON["V" EN^PSIVORE D EN1^PSJHL2(DFN,"SN",ON55,"NEW ORDER")
"RTN","PSJCLOR2",165,0)
 .N TMPOLD S TMPOLD=$S(ON55["P":$P($G(^PS(53.1,+ON55,0)),"^",25),ON55["V":$P($G(^PS(55,PSGP,"IV",+ON55,2)),"^",5),1:"") I TMPOLD D
"RTN","PSJCLOR2",166,0)
 ..I TMPOLD["V",$D(^PS(55,PSGP,"IV",+TMPOLD,10,1)) N LN S LN=+$O(^PS(55,PSGP,"IV",+TMPOLD,10,""),-1) D
"RTN","PSJCLOR2",167,0)
 ...S:ON55["P" ^PS(53.1,+ON55,16,0)="^53.1136^"_LN_"^"_LN S:ON55["V" ^PS(55,PSGP,"IV",+ON55,10,0)="^55.1154^"_LN_"^"_LN
"RTN","PSJCLOR2",168,0)
 ...S LN=0 F  S LN=$O(^PS(55,PSGP,"IV",+TMPOLD,10,LN)) Q:'LN  S:ON55["P" ^PS(53.1,+ON55,16,LN,0)=^PS(55,PSGP,"IV",+TMPOLD,10,LN,0) S:ON55["V" ^PS(55,PSGP,"IV",+ON55,10,LN,0)=^PS(55,PSGP,"IV",+TMPOLD,10,LN,0)
"RTN","PSJCLOR2",169,0)
 .;
"RTN","PSJCLOR2",170,0)
 I $G(PSJFSI)=1 I $$GETSI^PSJBCMA5(DFN,PSGORD) D FILESI^PSJBCMA5(DFN,$S($G(PSGOORD):PSGOORD,1:PSGORD))
"RTN","PSJCLOR2",171,0)
 I 'PSGOEAV,($G(PSGORD)["P"),'$G(^PS(53.1,+PSGORD,2.5)),$G(^PS(53.1,+PSGORD,0)) D
"RTN","PSJCLOR2",172,0)
 . N DUR S DUR=$$GETDUR^PSJLIVMD(PSGP,PSGORD,$S(PSGORD["P":"P",1:5),1) I DUR]"" K DA,DR,DIE S DIE="^PS(53.1,",DA=+PSGORD,DR="116////"_DUR D ^DIE
"RTN","PSJCLOR2",173,0)
 D NEWCLN^PSJCLOR5
"RTN","PSJCLOR2",174,0)
 D UNL^PSSLOCK(PSGP,PSGORD) I $G(PSGOORD) D UNL^PSSLOCK(PSGP,PSGOORD)
"RTN","PSJCLOR2",175,0)
 Q
"RTN","PSJCLOR2",176,0)
 ;
"RTN","PSJCLOR2",177,0)
DSPORD(PSGP,TMPORDER,PSJORDAR) ; Display order summary
"RTN","PSJCLOR2",178,0)
 D DSPORD^PSJCLOR5(PSGP,TMPORDER,.PSJORDAR)
"RTN","PSJCLOR2",179,0)
 Q
"RTN","PSJCLOR2",180,0)
 ;
"RTN","PSJCLOR2",181,0)
HDRDT ; Header Date Range
"RTN","PSJCLOR2",182,0)
 Q:'$G(PSJBEG)!'($G(PSJEND))  I $G(PSJTMPED),$P(PSJTMPED,"^",2) S PSJEND=$S($P(PSJTMPED,"^",2)'=$G(PSGP):+PSJTMPED,1:+PSJEND)
"RTN","PSJCLOR2",183,0)
 S VALMHDR(6)="          CLINIC ORDERS: "_$$FMTE^XLFDT(+$G(PSJBEG))_" to "_$$FMTE^XLFDT(+$G(PSJEND))
"RTN","PSJCLOR2",184,0)
 Q
"RTN","PSJCLOR2",185,0)
 ;
"RTN","PSJCLOR2",186,0)
CHGDT ; Change date range
"RTN","PSJCLOR2",187,0)
 N TMPBEG,TMPEND S TMPBEG=+PSJBEG,TMPEND=+PSJEND
"RTN","PSJCLOR2",188,0)
 D BEGDT I '$G(PSJBEG) S PSJBEG=+TMPBEG
"RTN","PSJCLOR2",189,0)
 D ENDDT(PSJBEG) I '$G(PSJEND) S PSJEND=+TMPEND
"RTN","PSJCLOR2",190,0)
 D INIT^PSJCLOR2(3) S VALMBCK="R" D HDR^PSJLMHED($S($G(DFN):DFN,1:$G(PSGP))) D HDRDT^PSJCLOR2
"RTN","PSJCLOR2",191,0)
 Q
"RTN","PSJCLOR2",192,0)
BEGDT ; begin date
"RTN","PSJCLOR2",193,0)
 I '$G(PSJTMPBG) S PSJTMPBG=+PSJBEG_"^"_PSGP
"RTN","PSJCLOR2",194,0)
 W !!?5,"Search for CLINIC Medication Orders with a Start Date/Time"
"RTN","PSJCLOR2",195,0)
 W !?5,"within the date range selected below: "
"RTN","PSJCLOR2",196,0)
 W ! K %DT S %DT("A")="Begin Search Date: ",%DT="TAE",%DT("B")=$P($$FMTE^XLFDT(PSJBEG,1),"@")
"RTN","PSJCLOR2",197,0)
 D ^%DT Q:Y<0!($D(DTOUT))  S (%DT(0),PSJBEG)=Y
"RTN","PSJCLOR2",198,0)
 Q
"RTN","PSJCLOR2",199,0)
ENDDT(BEG) ; end date
"RTN","PSJCLOR2",200,0)
 I $G(BEG) S $P(BEG,".",2)=24
"RTN","PSJCLOR2",201,0)
 I '$G(PSJTMPED) S PSJTMPED=+PSJEND_"^"_PSGP
"RTN","PSJCLOR2",202,0)
 W ! K DIR S DIR(0)="DA^"_BEG_"::TAE",DIR("A")="End Search Date: ",DIR("B")=$$FMTE^XLFDT(BEG) D ^DIR
"RTN","PSJCLOR2",203,0)
 S PSJEND=$S($G(Y):Y,1:BEG) I '$P(PSJEND,".",2) S PSJEND=Y_".24"
"RTN","PSJCLOR2",204,0)
 Q
"RTN","PSJHL2")
0^24^B42288788^B36875797
"RTN","PSJHL2",1,0)
PSJHL2 ;BIR/RLW-PATIENT ID AND VISIT SEGMENTS ; 9/24/12 3:17pm
"RTN","PSJHL2",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**1,18,16,23,28,42,50,70,58,100,102,110,111,112,144,141,134,279**;16 DEC 97;Build 150
"RTN","PSJHL2",3,0)
 ;
"RTN","PSJHL2",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL2",5,0)
 ; Reference to ^ORERR is supported by DBIA# 2187.
"RTN","PSJHL2",6,0)
 ; Reference to ^ORHLESC IS supported by DBIA# 4922.
"RTN","PSJHL2",7,0)
 ;
"RTN","PSJHL2",8,0)
 ;*279 Add Clinic name to ORC.21 (Ordering institution) used to send
"RTN","PSJHL2",9,0)
 ;     to the BCBU contingent system.
"RTN","PSJHL2",10,0)
 ;
"RTN","PSJHL2",11,0)
EN1(PSJHLDFN,PSOC,PSJORDER,PSREASON) ; start here
"RTN","PSJHL2",12,0)
 ; passed in are PSJHLDFN (patient ien)
"RTN","PSJHL2",13,0)
 ;               PSJORDER* (order_file (N,P,V, etc))
"RTN","PSJHL2",14,0)
 ;               PSOC* (order control code - NW for new order, OK to return filler number to OE/RR, OC for order canceled, SC for status change)
"RTN","PSJHL2",15,0)
 ;               PSREASON* (text reason)
"RTN","PSJHL2",16,0)
 ; *=optional, only required if an order segment is also to be generated
"RTN","PSJHL2",17,0)
START ;
"RTN","PSJHL2",18,0)
 K ^TMP("PSJHLS",$J,"PS")
"RTN","PSJHL2",19,0)
 N CLERK,J,LIMIT,NAME,NEXT,NODE1,NODE2,NODE4,NOO,PSJCLEAR,PSJHINST,PSJHLSDT,PROVIDER,PSJI,ROOMBED,RXORDER,STATUS,UNDO,VERIFY,WARD,PSGST,DUR
"RTN","PSJHL2",20,0)
 N NODE8,NODEDSS     ;*279
"RTN","PSJHL2",21,0)
 S RXORDER=PSJORDER,PSJORDER=$S((PSJORDER["N")!(PSJORDER["P"):"^PS(53.1,"_+PSJORDER,PSJORDER["V":"^PS(55,"_PSJHLDFN_",""IV"","_+PSJORDER,1:"^PS(55,"_PSJHLDFN_",5,"_+PSJORDER)_","
"RTN","PSJHL2",22,0)
 I RXORDER["P",$P($G(@(PSJORDER_"0)")),U,15)'=PSJHLDFN S ORDCON="Patient does not match/PSJHL2" S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(ORDCON) Q
"RTN","PSJHL2",23,0)
 S UNDO=$S("OC^CR"[PSOC:1,1:0)
"RTN","PSJHL2",24,0)
 D INIT,PID,PV1,ORC
"RTN","PSJHL2",25,0)
 D @$S("SN^SC^OC^OD^DR^CR^OH^OR^XX^ZC^XR"[PSOC:"EN1^PSJHL3(PSJHLDFN,PSOC,PSJORDER)",1:"CALL^PSJHLU(PSJI)")
"RTN","PSJHL2",26,0)
 I UNDO D UNDO
"RTN","PSJHL2",27,0)
 K ^TMP("PSJHLS",$J,"PS"),FIELD
"RTN","PSJHL2",28,0)
 Q
"RTN","PSJHL2",29,0)
 ;
"RTN","PSJHL2",30,0)
INIT ; initialize HL7 variables, set master file identification segment
"RTN","PSJHL2",31,0)
 ; PSJHLMTN = message type - ORR for messages sent as a response to an OE/RR event; ORM for "unsolicited" messages.
"RTN","PSJHL2",32,0)
 S PSJI=0,PSJHLMTN=$S($G(PSJHLMTN)]"":PSJHLMTN,1:"ORM")
"RTN","PSJHL2",33,0)
 D INIT^PSJHLU
"RTN","PSJHL2",34,0)
 S LIMIT=17 X PSJCLEAR
"RTN","PSJHL2",35,0)
 S FIELD(0)="MSH",FIELD(1)="^~\&",FIELD(2)="PHARMACY",FIELD(3)=$G(PSJHINST),FIELD(8)=PSJHLMTN
"RTN","PSJHL2",36,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY
"RTN","PSJHL2",37,0)
 Q
"RTN","PSJHL2",38,0)
 ;
"RTN","PSJHL2",39,0)
PID ; get patient data, format PID SEGMENT
"RTN","PSJHL2",40,0)
 S LIMIT=22 X PSJCLEAR
"RTN","PSJHL2",41,0)
 S FIELD(0)="PID"
"RTN","PSJHL2",42,0)
 S FIELD(3)=PSJHLDFN
"RTN","PSJHL2",43,0)
 N DFN S DFN=PSJHLDFN D DEM^VADPT S FIELD(5)=VADM(1)
"RTN","PSJHL2",44,0)
 I '$G(PSJBCBU) S FIELD(5)=$$ESC^ORHLESC(FIELD(5))
"RTN","PSJHL2",45,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY
"RTN","PSJHL2",46,0)
 Q
"RTN","PSJHL2",47,0)
 ;
"RTN","PSJHL2",48,0)
PV1 ; get patient visit information, format PV1 segment
"RTN","PSJHL2",49,0)
 N PSJAPPT
"RTN","PSJHL2",50,0)
 S LIMIT=50 X PSJCLEAR
"RTN","PSJHL2",51,0)
 S FIELD(0)="PV1"
"RTN","PSJHL2",52,0)
 I PSJHLMTN="ORR" S FIELD(3)=LOC
"RTN","PSJHL2",53,0)
 I PSJHLMTN="ORM" D
"RTN","PSJHL2",54,0)
 .S LOC="",WARD=$G(^DPT(PSJHLDFN,.1)),LOC=$S($G(WARD)]"":$O(^SC("B",WARD,LOC)),1:LOC)
"RTN","PSJHL2",55,0)
 .;I $G(LOC)="" D
"RTN","PSJHL2",56,0)
 .N A
"RTN","PSJHL2",57,0)
 .I RXORDER["P",($G(^PS(53.1,+RXORDER,"DSS"))) S A=^("DSS") I (LOC="")!($P(A,"^",2)) S LOC=$P(A,"^"),PSJAPPT=$P(A,"^",2)
"RTN","PSJHL2",58,0)
 .I RXORDER["V",($G(^PS(55,PSJHLDFN,"IV",+RXORDER,"DSS"))) S A=^("DSS") I (LOC="")!($P(A,"^",2)) S LOC=$P(A,"^"),PSJAPPT=$P(A,"^",2)
"RTN","PSJHL2",59,0)
 .I RXORDER["U",$G(^PS(55,PSJHLDFN,5,+RXORDER,8)) S A=^(8) I (LOC="")!($P(A,"^",2)) S LOC=$P(A,"^"),PSJAPPT=$P(A,"^",2)
"RTN","PSJHL2",60,0)
 .I $G(LOC)]"" S ROOMBED=$G(^DPT(PSJHLDFN,.101)) S LOC=LOC_"^"_$S($G(PSJBCBU):ROOMBED,1:$$ESC^ORHLESC(ROOMBED))
"RTN","PSJHL2",61,0)
 .S FIELD(3)=LOC I $G(PSJAPPT)]"" S FIELD(44)=$$FMTHL7^XLFDT(PSJAPPT)
"RTN","PSJHL2",62,0)
 S FIELD(2)=$S($G(CLASS)="O":CLASS,1:"I")
"RTN","PSJHL2",63,0)
 I FIELD(2)="I" N DFN S DFN=PSJHLDFN D INP^VADPT S FIELD(19)=VAIN(1)
"RTN","PSJHL2",64,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY
"RTN","PSJHL2",65,0)
 Q
"RTN","PSJHL2",66,0)
 ;
"RTN","PSJHL2",67,0)
ORC ; order control segment
"RTN","PSJHL2",68,0)
 S LIMIT=21 X PSJCLEAR            ;*279 mod from 18 to 21
"RTN","PSJHL2",69,0)
 Q:'$D(PSJORDER)!'$D(PSOC)
"RTN","PSJHL2",70,0)
 S NODE1=$G(@(PSJORDER_"0)")),NODE2=$G(@(PSJORDER_"2)"))
"RTN","PSJHL2",71,0)
 S NODE4=$G(@(PSJORDER_"4)"))
"RTN","PSJHL2",72,0)
 ;*270 add clinic appt node
"RTN","PSJHL2",73,0)
 I RXORDER["U" S NODE8=$G(@(PSJORDER_"8)"))
"RTN","PSJHL2",74,0)
 I (RXORDER["V")!(RXORDER["P") S NODEDSS=$G(@(PSJORDER_"""DSS"")"))
"RTN","PSJHL2",75,0)
 ;
"RTN","PSJHL2",76,0)
 I $G(PSGST)="" N PSGST D
"RTN","PSJHL2",77,0)
 .S PSGST=$P($G(NODE1),"^",7)
"RTN","PSJHL2",78,0)
 S FIELD(0)="ORC"
"RTN","PSJHL2",79,0)
 S FIELD(1)=PSOC
"RTN","PSJHL2",80,0)
 S FIELD(2)=$S(PSOC="SN":"",1:$P(NODE1,"^",21))_"^OR" I $P(FIELD(2),"^")=0 S $P(FIELD(2),"^")="" ; IV orders are created with a zero in the oerr order number, for some reason
"RTN","PSJHL2",81,0)
 S FIELD(3)=RXORDER_"^PS"
"RTN","PSJHL2",82,0)
 ; translate Pharmacy status code to HL7 status code, set in FIELD(5)
"RTN","PSJHL2",83,0)
 S STATUS=$S($G(PSJEXPOE):"E",(($P(NODE1,"^",17)]"")&(RXORDER["V")):($P(NODE1,"^",17)),($P(NODE1,"^",9)]""):$P(NODE1,"^",9),$G(PSIVCOPY):"DE",1:"")
"RTN","PSJHL2",84,0)
 ;BHW;Remedy HD0000000086717;If the order has a pending number, send pending status even if current status is Active.
"RTN","PSJHL2",85,0)
 I STATUS="A",RXORDER["P" S STATUS="N" D @STATUS S STATUS="A"
"RTN","PSJHL2",86,0)
 E  D @STATUS
"RTN","PSJHL2",87,0)
 I STATUS="U",RXORDER["P" S FIELD(3)="^PS"
"RTN","PSJHL2",88,0)
 S FIELD(7)="^"_$S(RXORDER["V":$P(NODE1,"^",9)_"&"_$P(NODE1,"^",11),1:$P(NODE2,"^")_"&"_$P(NODE2,"^",5))_"^^^^^"_$G(PSGST)
"RTN","PSJHL2",89,0)
 S FIELD(9)=$S(RXORDER["V":$$FMTHL7^XLFDT($P(NODE2,"^")),1:$$FMTHL7^XLFDT($P(NODE1,"^",16)))
"RTN","PSJHL2",90,0)
 S CLERK=$S(RXORDER["V":$P(NODE2,"^",11),1:$P(NODE4,"^",7))
"RTN","PSJHL2",91,0)
 S NAME=$P($G(^VA(200,+CLERK,0)),"^")
"RTN","PSJHL2",92,0)
 S FIELD(10)=CLERK_"^"_$S($G(PSJBCBU):NAME,1:$$ESC^ORHLESC(NAME))
"RTN","PSJHL2",93,0)
 I PSOC="ZV"!($G(PSJBCBU)) S VERIFY=$P($G(NODE4),"^"),FIELD(11)=VERIFY_"^"_$S($G(PSJBCBU):$P($G(^VA(200,+VERIFY,0)),"^"),1:$$ESC^ORHLESC($P($G(^VA(200,+VERIFY,0)),"^"))),FIELD(9)=$$FMTHL7^XLFDT($P(NODE4,"^",2))
"RTN","PSJHL2",94,0)
 S PROVIDER=$S($G(PSJDCPRV)]"":$G(PSJDCPRV),RXORDER["V":$P(NODE1,"^",6),1:$P(NODE1,"^",2)) K PSJDCPRV
"RTN","PSJHL2",95,0)
 S NAME=$P($G(^VA(200,+PROVIDER,0)),"^")
"RTN","PSJHL2",96,0)
 S FIELD(12)=PROVIDER_"^"_NAME
"RTN","PSJHL2",97,0)
 S FIELD(15)=$S(RXORDER["V":$$FMTHL7^XLFDT($P(NODE1,"^",2)),1:$$FMTHL7^XLFDT($P(NODE2,"^",2)))
"RTN","PSJHL2",98,0)
 I $S(RXORDER["V":$P(NODE2,"^",8)="R",1:$P(NODE1,"^",24)="R")
"RTN","PSJHL2",99,0)
 ; PSJ*5*141 - If this is a renewal order, update FIELD(10) with the person who entered the renewal order.
"RTN","PSJHL2",100,0)
 N FIELD9 S FIELD9=$$FMTHL7^XLFDT($$LASTREN^PSJLMPRI(PSJHLDFN,RXORDER)) I FIELD9>FIELD(9) S FIELD(9)=FIELD9,FIELD(15)=FIELD9,FIELD(10)=$$LASTRNBY^PSJLMPRI(PSJHLDFN,RXORDER)
"RTN","PSJHL2",101,0)
 S NOO=$S(PSJORDER["IV":$G(P("NAT")),(($G(PSJNOO)="")&($G(P("NAT"))]"")):$G(P("NAT")),1:$G(PSJNOO)),PSREASON=$S(NOO="D":"",1:$G(PSREASON))
"RTN","PSJHL2",102,0)
 S FIELD(16)=NOO_U_$S(NOO="P":"Telephoned",NOO="D":"Duplicate",NOO="X":"Rejected",NOO="A":"Auto",NOO="S":"Service Correction",NOO="W":"Written",NOO="V":"Verbal",NOO="E":"Physician Entered",NOO="I":"Policy",1:"")_U_"99ORN"_U_U_$G(PSREASON)_U
"RTN","PSJHL2",103,0)
 ;*279 is clinic order?  if so save clinic name
"RTN","PSJHL2",104,0)
 I $D(NODE8),$P(NODE8,U)]"",$P(NODE8,U,2) D
"RTN","PSJHL2",105,0)
 .S FIELD(21)=$S($D(^SC($P(NODE8,U),0)):$P(^(0),"^"),1:"")
"RTN","PSJHL2",106,0)
 I $D(NODEDSS),$P(NODEDSS,U)]"",$P(NODEDSS,U,2) D
"RTN","PSJHL2",107,0)
 .S FIELD(21)=$S($D(^SC($P(NODEDSS,U),0)):$P(^(0),"^"),1:"")
"RTN","PSJHL2",108,0)
 ;
"RTN","PSJHL2",109,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY
"RTN","PSJHL2",110,0)
 Q
"RTN","PSJHL2",111,0)
 ;
"RTN","PSJHL2",112,0)
DISPLAY ; just for testing
"RTN","PSJHL2",113,0)
 I $G(MSGTEST) W ! F NEXT=0:1:LIMIT W FIELD(NEXT)_"|"
"RTN","PSJHL2",114,0)
 Q
"RTN","PSJHL2",115,0)
UNDO ;Undo Renew if Pending Renewal is dc'd
"RTN","PSJHL2",116,0)
 I RXORDER["P",(STATUS="D"),($G(PSJNOO)'="A"),($P(NODE1,U,24)="R") D ENBKOUT^PSJOREN(PSJHLDFN,RXORDER)
"RTN","PSJHL2",117,0)
 Q
"RTN","PSJHL2",118,0)
 ;
"RTN","PSJHL2",119,0)
A S FIELD(5)="CM" Q  ; active
"RTN","PSJHL2",120,0)
D S FIELD(5)="DC" Q  ; discontinued
"RTN","PSJHL2",121,0)
I S FIELD(5)="IP" Q  ; incomplete
"RTN","PSJHL2",122,0)
N S FIELD(5)="IP" Q  ; non-verified
"RTN","PSJHL2",123,0)
U S FIELD(5)="ZX" Q  ; unreleased
"RTN","PSJHL2",124,0)
P S FIELD(5)="IP" Q  ; pending
"RTN","PSJHL2",125,0)
DE S FIELD(5)="RP" Q  ; discontinued (edit)
"RTN","PSJHL2",126,0)
E S FIELD(5)="ZE" Q  ; expired
"RTN","PSJHL2",127,0)
H S FIELD(5)="HD" Q  ; hold
"RTN","PSJHL2",128,0)
R S FIELD(5)="ZZ" Q  ; renewed
"RTN","PSJHL2",129,0)
RE S FIELD(5)="CM" Q  ; reinstated
"RTN","PSJHL2",130,0)
DR S FIELD(5)="DC" Q  ; discontinued (renewal)
"RTN","PSJHL2",131,0)
O S FIELD(5)="HD" Q  ; on call (is this kind of like HOLD?)
"RTN","PSJHL4")
0^45^B76440545^B75570898
"RTN","PSJHL4",1,0)
PSJHL4 ;BIR/RLW-DECODE HL7 /MESSSAGE FROM OE/RR ;16 Mar 99 / 4:55 PM
"RTN","PSJHL4",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**1,12,27,34,40,42,55,47,50,56,58,98,85,105,107,110,111,154,134,197,226,279**;16 DEC 97;Build 150
"RTN","PSJHL4",3,0)
 ; Reference to $$EN^PSOHLNEW is supported by DBIA# 2188.
"RTN","PSJHL4",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSJHL4",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJHL4",6,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJHL4",7,0)
 ; Reference to ^PS(59.7 supported by DBIA 2181.
"RTN","PSJHL4",8,0)
 ; Reference to ^ORHLESC is supported by DBIA 4922.
"RTN","PSJHL4",9,0)
 ; 
"RTN","PSJHL4",10,0)
EN(PSJMSG) ; Start
"RTN","PSJHL4",11,0)
 K ^TMP("PSJNVO",$J)
"RTN","PSJHL4",12,0)
 N ADCNT,SOLCNT,OCCNT
"RTN","PSJHL4",13,0)
 N ACKDATE,ADDITIVE,ADMINSTR,APPL,COMMENT,PSJHLDFN,DISPENSE,DOSE,DURATION,II,INSTR,J,JJ,JJJ,K,LOGIN,NEWORDER,NURSEACK,OBXFL,OCNARR,OCPROV,OCRSN,ORDER,PRIORITY,PSITEM,ORDCON,PROCOM,PSJORDER,PSREASON
"RTN","PSJHL4",14,0)
 N LOC,PROVIDER,PSPR,PSOC,PTR,QQ,REQST,ROUTE,RXON,RXORDER,SCHEDULE,SEGMENT,SOLUTION,STPDT,STRENGTH,TEXT,CLERK,INFRT,IVTYP,SCHTYP,PREON,NOO,ROC,FREQ,CLASS,PSJHLMTN,UNIT,UNITS,QFLG,VOLUME,TVOLUME,PSGP
"RTN","PSJHL4",15,0)
 N PSJASTP,FLDATE,FLCMNT,PSJFLAG,PSJYN,PRNTON,APPT,IVLIMIT,IVCAT,INTRMT
"RTN","PSJHL4",16,0)
 S (ADCNT,SOLCNT,OCCNT,II,TVOLUME)="",(OBXFL,QFLG)=0,PSJHLMTN="ORR" F  S II=$O(PSJMSG(II)) Q:'II  D DECODE Q:QFLG  D @FIELD(0) Q:$G(CLASS)="O"  Q:QFLG
"RTN","PSJHL4",17,0)
 I ($G(CLASS)'="I")!(QFLG) G END
"RTN","PSJHL4",18,0)
 I ($G(PSOC)="NW")!($G(PSOC)="XO") N DIK,DA S DIK="^PS(53.1,",DA=NEWORDER D EN1^DIK L -^PS(53.1,NEWORDER)
"RTN","PSJHL4",19,0)
 I ($G(PSOC)="NW")!($G(PSOC)="XO") D EN1^PSJHL2(PSJHLDFN,$S(PSOC="NW":"OK",1:"XR"),NEWORDER_"P")
"RTN","PSJHL4",20,0)
END ;
"RTN","PSJHL4",21,0)
 K ^TMP("PSJNVO",$J)
"RTN","PSJHL4",22,0)
 I (",S,A,")[(","_$G(PRIORITY)_",")!($G(SCHEDULE)="NOW")!($G(SCHEDULE)["STAT") D
"RTN","PSJHL4",23,0)
 . I $G(PRIORITY)="ZD",$G(PSGORD) D NOTIFY(PSGORD_$S(PSGORD["V":"V",PSGORD["U":"U",1:""),PSJHLDFN,$G(PRIORITY),$G(SCHEDULE))
"RTN","PSJHL4",24,0)
 . I $G(NEWORDER) D NOTIFY(NEWORDER_"P",PSJHLDFN,$G(PRIORITY),$G(SCHEDULE))
"RTN","PSJHL4",25,0)
 I $G(NEWORDER),$G(^PS(53.1,+NEWORDER,"DSS")) D NOCLDEF^PSJBCMA6(PSJHLDFN,+NEWORDER_"P")
"RTN","PSJHL4",26,0)
 Q
"RTN","PSJHL4",27,0)
DECODE ; Parse into fields 
"RTN","PSJHL4",28,0)
 K FIELD
"RTN","PSJHL4",29,0)
 N PSJCTR1 S PSJCTR1=""
"RTN","PSJHL4",30,0)
 S SEGMENT=$G(PSJMSG(II))
"RTN","PSJHL4",31,0)
 I $D(PSJMSG(II,1)),$P(SEGMENT,"|",1)="ORC" F  S PSJCTR1=$O(PSJMSG(II,PSJCTR1)) Q:PSJCTR1=""  D
"RTN","PSJHL4",32,0)
 . S SEGMENT=SEGMENT_PSJMSG(II,PSJCTR1)  ;Handle CPRS "overflow" ORC nodes
"RTN","PSJHL4",33,0)
 I $D(PSJMSG(II,1)),$P(SEGMENT,"|",1)="OBX" S PSJCTR1="" F  S PSJCTR1=$O(PSJMSG(II,PSJCTR1)) Q:PSJCTR1=""  D
"RTN","PSJHL4",34,0)
 . S SEGMENT=SEGMENT_PSJMSG(II,PSJCTR1)  ;Handle CPRS "overflow" OBX nodes
"RTN","PSJHL4",35,0)
 S J=0
"RTN","PSJHL4",36,0)
 F  Q:$G(SEGMENT)=""  D
"RTN","PSJHL4",37,0)
 .I SEGMENT["|" S FIELD(J)=$P(SEGMENT,"|"),SEGMENT=$E(SEGMENT,$L(FIELD(J))+2,$L(SEGMENT)),J=J+1 Q
"RTN","PSJHL4",38,0)
 .I SEGMENT'["|" S FIELD(J)=SEGMENT,SEGMENT="" Q
"RTN","PSJHL4",39,0)
 K PSJCTR1
"RTN","PSJHL4",40,0)
 Q
"RTN","PSJHL4",41,0)
NOTIFY(ORDER,PSJHLDFN,PRIO,PSJSCHED) ; Send msg
"RTN","PSJHL4",42,0)
 N NTFYREAS,WARD,MGROUP,NTFSTAT,DRUG,DRIEN,PNAME,ORDATE,DO,PSG,XMY,VADPT,LASTFOUR,PSJSOK,CLINIC
"RTN","PSJHL4",43,0)
 Q:($G(PRIO)=""&($G(PSJSCHED)=""))
"RTN","PSJHL4",44,0)
 S DFN=PSJHLDFN D DEM^VADPT S LASTFOUR=$P($P(VADM(2),"^",2),"-",3)
"RTN","PSJHL4",45,0)
 S NTFYREAS=$S((",S,A,")[(","_PRIO_","):1,($G(PSJSCHED)="NOW"):2,($G(PSJSCHED)="STAT"):3,1:0) Q:'NTFYREAS
"RTN","PSJHL4",46,0)
 S PSJSOK=1
"RTN","PSJHL4",47,0)
 I ORDER["P" D PND
"RTN","PSJHL4",48,0)
 I ORDER["U" D UD
"RTN","PSJHL4",49,0)
 I ORDER["V" D IV
"RTN","PSJHL4",50,0)
 Q:PSJSOK=1
"RTN","PSJHL4",51,0)
 D XMD^PSJHL4A
"RTN","PSJHL4",52,0)
 Q
"RTN","PSJHL4",53,0)
PND ; Pending
"RTN","PSJHL4",54,0)
 N WARD,WDPARM,MGRP
"RTN","PSJHL4",55,0)
 Q:'$D(^PS(53.1,+ORDER,0))
"RTN","PSJHL4",56,0)
 S CLINIC=$P($G(^PS(53.1,+ORDER,"DSS")),"^",1)
"RTN","PSJHL4",57,0)
 S WARD=$G(^DPT(PSJHLDFN,.1)) I WARD]"" D
"RTN","PSJHL4",58,0)
 .N DIC,X,Y S DIC="^DIC(42,",DIC(0)="BOXZ",X=WARD D ^DIC S WARD=+Y Q:WARD=0
"RTN","PSJHL4",59,0)
 .S WARD=$O(^PS(59.6,"B",WARD,0)) Q:+WARD=0
"RTN","PSJHL4",60,0)
 .Q:$$SNDTSTW^PSJHL4A(PRIO,PSJSCHED,WARD)
"RTN","PSJHL4",61,0)
 .S WDPARM=$G(^PS(59.6,+WARD,0)),MGRP=$P(WDPARM,"^",30) Q:+MGRP=0
"RTN","PSJHL4",62,0)
 .S MGRP=$$GET1^DIQ(3.8,MGRP,.01) I MGRP]"" S XMY("G."_MGRP_"@"_$G(^XMB("NETNAME")))="",PSJSOK=0
"RTN","PSJHL4",63,0)
 S:'$$SNDTSTP^PSJHL4A(PRIO,PSJSCHED) MGROUP="G.PSJ STAT NOW PENDING ORDER@"_$G(^XMB("NETNAME")),XMY(MGROUP)="",PSJSOK=0
"RTN","PSJHL4",64,0)
 S NTFSTAT="PENDING"
"RTN","PSJHL4",65,0)
 N NDP2,ND0 S NDP2=$G(^PS(53.1,+ORDER,.2)),ND0=$G(^PS(53.1,+ORDER,0))
"RTN","PSJHL4",66,0)
 S DRIEN=+$P(NDP2,"^"),DO=$P(NDP2,"^",2),RTE=$P(ND0,"^",3),ORDATE=$P(ND0,"^",14)
"RTN","PSJHL4",67,0)
 S SCHED=$P($G(^PS(53.1,+ORDER,2)),"^")
"RTN","PSJHL4",68,0)
 Q
"RTN","PSJHL4",69,0)
UD ; UD
"RTN","PSJHL4",70,0)
 N WARD,WDPARM,MGRP
"RTN","PSJHL4",71,0)
 Q:'$D(^PS(55,PSJHLDFN,5,+ORDER,0))
"RTN","PSJHL4",72,0)
 S CLINIC=$P($G(^PS(55,PSJHLDFN,5,+ORDER,8)),"^",1)
"RTN","PSJHL4",73,0)
 S WARD=$P($G(^PS(55,PSJHLDFN,5,+ORDER,0)),"^",23) I +WARD D
"RTN","PSJHL4",74,0)
 .S WARD=$O(^PS(59.6,"B",WARD,0)) Q:+WARD=0
"RTN","PSJHL4",75,0)
 .Q:$$SNDTSTW^PSJHL4A(PRIO,PSJSCHED,WARD)
"RTN","PSJHL4",76,0)
 .S WDPARM=$G(^PS(59.6,+WARD,0)),MGRP=$P(WDPARM,"^",30) Q:+MGRP=0
"RTN","PSJHL4",77,0)
 .S MGRP=$$GET1^DIQ(3.8,MGRP,.01) I MGRP]"" S XMY("G."_MGRP_"@"_$G(^XMB("NETNAME")))="",PSJSOK=0
"RTN","PSJHL4",78,0)
 S:'$$SNDTSTA^PSJHL4A(PRIO,PSJSCHED) MGROUP="G.PSJ STAT NOW ACTIVE ORDER@"_$G(^XMB("NETNAME")),XMY(MGROUP)="",PSJSOK=0
"RTN","PSJHL4",79,0)
 S NTFSTAT="ACTIVE"
"RTN","PSJHL4",80,0)
 N ND2,ND0 S ND0=$G(^PS(55,PSJHLDFN,5,+ORDER,0)),ND2=$G(^PS(55,PSJHLDFN,5,+ORDER,2)),NDP2=$G(^PS(55,PSJHLDFN,5,+ORDER,.2))
"RTN","PSJHL4",81,0)
 S DRIEN=+$P(NDP2,"^"),DO=$P(NDP2,"^",2),RTE=$P(ND0,"^",3),ORDATE=$P(ND0,"^",14)
"RTN","PSJHL4",82,0)
 S SCHED=$P(ND2,"^")
"RTN","PSJHL4",83,0)
 Q
"RTN","PSJHL4",84,0)
IV ; IV
"RTN","PSJHL4",85,0)
 N WARD,WDPARM,MGRP
"RTN","PSJHL4",86,0)
 Q:'$D(^PS(55,PSJHLDFN,"IV",+ORDER,0))
"RTN","PSJHL4",87,0)
 S CLINIC=$P($G(^PS(55,PSJHLDFN,"IV",+ORDER,"DSS")),"^",1)
"RTN","PSJHL4",88,0)
 S WARD=$P($G(^PS(55,PSJHLDFN,"IV",+ORDER,0)),"^",22) I +WARD D
"RTN","PSJHL4",89,0)
 .S WARD=$O(^PS(59.6,"B",WARD,0)) Q:+WARD=0
"RTN","PSJHL4",90,0)
 .Q:$$SNDTSTW^PSJHL4A(PRIO,PSJSCHED,WARD)
"RTN","PSJHL4",91,0)
 .S WDPARM=$G(^PS(59.6,+WARD,0)),MGRP=$P(WDPARM,"^",30) Q:+MGRP=0
"RTN","PSJHL4",92,0)
 .S MGRP=$$GET1^DIQ(3.8,MGRP,.01) I MGRP]"" S XMY("G."_MGRP_"@"_$G(^XMB("NETNAME")))="",PSJSOK=0
"RTN","PSJHL4",93,0)
 S:'$$SNDTSTA^PSJHL4A(PRIO,PSJSCHED) MGROUP="G.PSJ STAT NOW ACTIVE ORDER@"_$G(^XMB("NETNAME")),XMY(MGROUP)="",PSJSOK=0
"RTN","PSJHL4",94,0)
 S NTFSTAT="ACTIVE"
"RTN","PSJHL4",95,0)
 N ND2,NDP2,ND0 S ND0=$G(^PS(55,PSJHLDFN,"IV",+ORDER,0)),ND2=$G(^PS(55,PSJHLDFN,"IV",+ORDER,2))
"RTN","PSJHL4",96,0)
 S NDP2=$G(^PS(55,PSJHLDFN,"IV",+ORDER,.2))
"RTN","PSJHL4",97,0)
 S DRIEN=$P(NDP2,"^"),DO=$P(NDP2,"^",2),RTE=$P(NDP2,"^",3)
"RTN","PSJHL4",98,0)
 S ORDATE=$P(ND2,"^"),SCHED=$P(ND0,"^",9)
"RTN","PSJHL4",99,0)
 Q
"RTN","PSJHL4",100,0)
MSH ; Header
"RTN","PSJHL4",101,0)
 S PSOC=FIELD(8)
"RTN","PSJHL4",102,0)
 Q
"RTN","PSJHL4",103,0)
PID ; ID
"RTN","PSJHL4",104,0)
 S PSJHLDFN=$$UNESC^ORHLESC(FIELD(3))
"RTN","PSJHL4",105,0)
 Q
"RTN","PSJHL4",106,0)
PV1 ; Visit
"RTN","PSJHL4",107,0)
 N A
"RTN","PSJHL4",108,0)
 S CLASS=FIELD(2),LOC=$P(FIELD(3),"^"),APPT="" I $G(FIELD(44))]"" S APPT=+$$HL7TFM^XLFDT(FIELD(44))
"RTN","PSJHL4",109,0)
 I "IO"'[CLASS S PSREASON="Invalid patient class" Q
"RTN","PSJHL4",110,0)
 N QQ K PSJNVA S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  D  Q:$G(PSJNVA)
"RTN","PSJHL4",111,0)
 .S X=$G(PSJMSG(QQ))
"RTN","PSJHL4",112,0)
 .I $P(X,"|")="ZRN" S PSJNVA=1,CLASS="O" D EN^PSOHLNEW(.PSJMSG)
"RTN","PSJHL4",113,0)
 I $G(PSJNVA) K PSJNVA Q
"RTN","PSJHL4",114,0)
 I CLASS="O" N QQ S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  I $P(PSJMSG(QQ),"|")="OBR" D  Q:$P(PSJMSG(QQ),"|")="OBR"
"RTN","PSJHL4",115,0)
 .S RXON=$P(PSJMSG(QQ),"|",4) I RXON]"" S RXON=$P(RXON,"^") I "ABNPUV"[$E(RXON,$L(RXON)) S CLASS="I"
"RTN","PSJHL4",116,0)
 I CLASS="O" N QQ S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  I $P(PSJMSG(QQ),"|")="ORC" D  Q:$P(PSJMSG(QQ),"|")="ORC"
"RTN","PSJHL4",117,0)
 .S RXON=$P(PSJMSG(QQ),"|",4) I RXON]"" S RXON=$P(RXON,"^") I "ABNPUV"[$E(RXON,$L(RXON)) S CLASS="I"
"RTN","PSJHL4",118,0)
 I CLASS="O" N CHK,QQ S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  I $P(PSJMSG(QQ),"|")="RXO" D  Q:$P(PSJMSG(QQ),"|")="RXO"
"RTN","PSJHL4",119,0)
 .S CHK=$P(PSJMSG(QQ),"|",2),CHK=$S($P(CHK,"^",5)="IV":"IV",1:$P(CHK,"^",4))
"RTN","PSJHL4",120,0)
 .I CHK="IV" S CLASS="I" Q
"RTN","PSJHL4",121,0)
 .I 'CHK S PSREASON="Missing or Invalid Orderable Item",CLASS="I" Q
"RTN","PSJHL4",122,0)
 .I $P($G(^PS(50.7,CHK,0)),"^",3)=1 S CLASS="I" Q
"RTN","PSJHL4",123,0)
 D:CLASS="O" EN^PSOHLNEW(.PSJMSG)
"RTN","PSJHL4",124,0)
 Q
"RTN","PSJHL4",125,0)
ORC ; Order
"RTN","PSJHL4",126,0)
 S TMPAT=""
"RTN","PSJHL4",127,0)
 S PSOC=FIELD(1)
"RTN","PSJHL4",128,0)
 S ORDER=FIELD(2)
"RTN","PSJHL4",129,0)
 I $G(PSREASON)]"" D ERROR^PSJHL9 Q
"RTN","PSJHL4",130,0)
 S PSJORDER=$P(FIELD(2),"^"),RXON=$P(FIELD(3),"^"),RXORDER=$S((RXON["N")!(RXON["P"):"^PS(53.1,"_+RXON_",",RXON["V":"^PS(55,"_PSJHLDFN_",""IV"","_+RXON_",",1:"^PS(55,"_PSJHLDFN_",5,"_+RXON_",")
"RTN","PSJHL4",131,0)
 I PSOC="NA" D ASSIGN^PSJHL5 Q
"RTN","PSJHL4",132,0)
 S CLERK=+$G(FIELD(10))
"RTN","PSJHL4",133,0)
 S PROVIDER=+$G(FIELD(12)) D:PSOC="NW"
"RTN","PSJHL4",134,0)
 .I PROVIDER=0 S PSREASON="Invalid Provider" D ERROR^PSJHL9 Q 
"RTN","PSJHL4",135,0)
 .I PROVIDER>0 S PSPR=$G(^VA(200,+PROVIDER,"PS")) I '$D(PSPR)!'(PSPR)!$S($P(PSPR,"^",4)="":0,1:$P(PSPR,"^",4)'>DT) S PSREASON="Invalid Provider" D ERROR^PSJHL9 Q
"RTN","PSJHL4",136,0)
 S UNITS=$P(FIELD(7),"^"),INSTR=$$UNESC^ORHLESC($P(FIELD(7),"^",8))
"RTN","PSJHL4",137,0)
 S:UNITS["&" DOSE=$P(UNITS,"&"),UNIT=$P(UNITS,"&",2),UNITS=$P(UNITS,"&",3) S:UNITS]"" UNITS=$$UNESC^ORHLESC(UNITS) S:$G(DOSE)]"" DOSE=$$UNESC^ORHLESC(DOSE)
"RTN","PSJHL4",138,0)
 S SCHEDULE=$P(FIELD(7),"^",2),PRIORITY=$P(FIELD(7),"^",6) S:SCHEDULE["PRN" SCHTYP="P"
"RTN","PSJHL4",139,0)
 I SCHEDULE["&" S ADMINS=$P(SCHEDULE,"&",2),SCHEDULE=$P(SCHEDULE,"&") S ADMINS=$TR(ADMINS," ","") S ADMINS=$S(ADMINS:ADMINS,1:"")
"RTN","PSJHL4",140,0)
 S SCHEDULE=$$UNESC^ORHLESC(SCHEDULE)
"RTN","PSJHL4",141,0)
 I SCHEDULE["@" S TMPAT=$$TMPAT^PSJHL4A(SCHEDULE)
"RTN","PSJHL4",142,0)
 I $G(TMPAT) S $P(SCHEDULE,"@",2)=TMPAT,ADMINS=TMPAT
"RTN","PSJHL4",143,0)
 S DURATION=$P(FIELD(7),"^",3),REQST=$P(FIELD(7),"^",4) S:REQST'="" REQST=+$E(+$$HL7TFM^XLFDT(REQST),1,12) S REQST=$$DATE2^PSJUTL2(REQST)
"RTN","PSJHL4",144,0)
 S PRIORITY=$S($G(PRIORITY)]"":PRIORITY,1:"R")
"RTN","PSJHL4",145,0)
 I $E(SCHEDULE,1)=" " S:$TR(SCHEDULE," ")="PRN" SCHEDULE="PRN" I '(SCHEDULE="PRN")  S PSREASON="Invalid Schedule" D ERROR^PSJHL9 Q
"RTN","PSJHL4",146,0)
 S SCHTYP=$P(FIELD(7),"^",7)
"RTN","PSJHL4",147,0)
 I $G(SCHTYP)="D" S SCHTYP="C"  ;Makes CPRS Day of Week consistent in behavior with backdoor order of Day of Week
"RTN","PSJHL4",148,0)
 S PRNTON=$P(FIELD(8),"^")
"RTN","PSJHL4",149,0)
 S NURSEACK=$G(FIELD(11))
"RTN","PSJHL4",150,0)
 S LOGIN=$G(FIELD(15)) S:LOGIN'="" LOGIN=+$E(+$$HL7TFM^XLFDT(FIELD(15)),1,12) S LOGIN=$$DATE2^PSJUTL2(LOGIN)
"RTN","PSJHL4",151,0)
 S:$G(NURSEACK)]"" ACKDATE=LOGIN
"RTN","PSJHL4",152,0)
 S ORDCON=$P($G(FIELD(16)),U) I ORDCON="A" S PSJASTP=$G(FIELD(9)) S:$G(PSJASTP)'="" PSJASTP=+$E(+$$HL7TFM^XLFDT(PSJASTP),1,12) S PSJASTP=$$DATE2^PSJUTL2(PSJASTP)
"RTN","PSJHL4",153,0)
 I (PSOC="CA")!(PSOC="DC") D CANCEL^PSJHL6 Q
"RTN","PSJHL4",154,0)
 I PSOC="HD" D HOLD^PSJHL6 Q
"RTN","PSJHL4",155,0)
 I PSOC="RL" D UNHOLD^PSJHL6 Q
"RTN","PSJHL4",156,0)
 I PSOC="ZV" D NURSEACK^PSJHL5 Q
"RTN","PSJHL4",157,0)
 I PSOC="SS" D STATUS^PSJHL5 Q
"RTN","PSJHL4",158,0)
 ;Commented line below since ^PSJHL8 doesn't exist.
"RTN","PSJHL4",159,0)
 ;I PSOC="Z@" N X S X="PSJHL8" X ^%ZOSF("TEST") I  D PURGE^PSJHL8 Q
"RTN","PSJHL4",160,0)
 I PSOC="DE" S QFLG=1 Q
"RTN","PSJHL4",161,0)
 Q
"RTN","PSJHL4",162,0)
OBR ; Flagging from CPRS.
"RTN","PSJHL4",163,0)
 S ORDER=FIELD(2)
"RTN","PSJHL4",164,0)
 S PSJORDER=$P(FIELD(2),"^"),RXON=$P(FIELD(3),"^"),RXORDER=$S((RXON["N")!(RXON["P"):"^PS(53.1,"_+RXON_",",RXON["V":"^PS(55,"_PSJHLDFN_",""IV"","_+RXON_",",1:"^PS(55,"_PSJHLDFN_",5,"_+RXON_",")
"RTN","PSJHL4",165,0)
 S PSJFLAG=FIELD(4)
"RTN","PSJHL4",166,0)
 S FLDATE=$G(FIELD(7)) S:FLDATE'="" FLDATE=+$E(+$$HL7TFM^XLFDT(FIELD(7)),1,12) S FLDATE=$$DATE2^PSJUTL2(FLDATE)
"RTN","PSJHL4",167,0)
 S CLERK=+$G(FIELD(16))
"RTN","PSJHL4",168,0)
 S PSJYN=$G(FIELD(24))
"RTN","PSJHL4",169,0)
 S FLCMNT=$$UNESC^ORHLESC($G(FIELD(13)))
"RTN","PSJHL4",170,0)
 I PSOC="ORU" D FLAG^PSJHL5
"RTN","PSJHL4",171,0)
 Q
"RTN","PSJHL4",172,0)
RXC ; IV 
"RTN","PSJHL4",173,0)
 D RXC^PSJHL4A
"RTN","PSJHL4",174,0)
 Q
"RTN","PSJHL4",175,0)
RXO ; OP
"RTN","PSJHL4",176,0)
 D RXO^PSJHL4A
"RTN","PSJHL4",177,0)
 Q
"RTN","PSJHL4",178,0)
RXR ; Route
"RTN","PSJHL4",179,0)
 S ROUTE=$P(FIELD(1),"^",4)
"RTN","PSJHL4",180,0)
 Q
"RTN","PSJHL4",181,0)
OBX ; Obs.
"RTN","PSJHL4",182,0)
 D OBX^PSJHL4A
"RTN","PSJHL4",183,0)
 Q
"RTN","PSJHL4",184,0)
NTE ; Note
"RTN","PSJHL4",185,0)
 D NTE^PSJHL4A
"RTN","PSJHL4",186,0)
 Q
"RTN","PSJHL4",187,0)
ZRX ; Custom
"RTN","PSJHL4",188,0)
 D ZRX^PSJHL4A
"RTN","PSJHL4",189,0)
 Q
"RTN","PSJHL4",190,0)
ZSC ;Service Connected - Not Used
"RTN","PSJHL4",191,0)
 Q
"RTN","PSJHL4",192,0)
ZRN ;Non-VA Med (Herbal/OTC)
"RTN","PSJHL4",193,0)
 S CLASS="O" D EN^PSOHLNEW(.PSJMSG)
"RTN","PSJHL4",194,0)
 Q
"RTN","PSJHL4",195,0)
DG1 ;Billing Awareness - Not used
"RTN","PSJHL4",196,0)
 Q
"RTN","PSJHL7")
0^27^B54843805^B54233730
"RTN","PSJHL7",1,0)
PSJHL7 ;BIR/LDT-ACTIONS ON HL7 MESSAGES FROM OE/RR (CONT) ;29 AUG 96 / 11:18 AM
"RTN","PSJHL7",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**42,47,50,70,82,110,127,133,275,279**;16 DEC 97;Build 150
"RTN","PSJHL7",3,0)
 ;
"RTN","PSJHL7",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJHL7",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA# 2177.
"RTN","PSJHL7",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJHL7",7,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJHL7",8,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJHL7",9,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL7",10,0)
 ; Reference to ^SC( is supported by DBIA# 10040.
"RTN","PSJHL7",11,0)
 ; Reference to ^TMP("PSB" is supported by DBIA# 3564.
"RTN","PSJHL7",12,0)
 ; 
"RTN","PSJHL7",13,0)
RENEW ;Renew orders from OE/RR
"RTN","PSJHL7",14,0)
 N PSJSYSW0,PSJSYSW,WRDPTR,PSJOSTOP,Q1,Q2
"RTN","PSJHL7",15,0)
 S PSJSYSW0="",PSJSYSW=0 I $G(LOC) S WRDPTR=$G(^SC(+LOC,42)) S:WRDPTR]"" PSJSYSW=+$O(^PS(59.6,"B",WRDPTR,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJHL7",16,0)
 I PREON["V" D IVSET G DONE
"RTN","PSJHL7",17,0)
 N ND,ND1,ND2,PSGSI,PSGMR,PSGSM,PSGHSM,PSGST,OIDRG,PSGDO,PSGSCH,PSGSOY,PSGOXT,PSGNEDFD,DRUGS,WAT
"RTN","PSJHL7",18,0)
 S ND=$G(^PS(55,PSJHLDFN,5,+PREON,0)),ND1=$G(^(.2)),ND2=$G(^(2)),PSGSI=$G(^(6)),PSGWLL=$S($P(PSJSYSW0,"^",4):+$G(^PS(55,PSJHLDFN,5.1)),1:0)
"RTN","PSJHL7",19,0)
 I +PSITEM>0,PSITEM'=+$P(ND1,"^") S $P(ND1,"^")=PSITEM
"RTN","PSJHL7",20,0)
 S PSGMR=$P(ND,"^",3),PSGSM=$P(ND,"^",5),PSGHSM=$P(ND,"^",6),PSGST=$P(ND,"^",7),OIDRG=$P(ND1,"^"),PSGDO=$P(ND1,"^",2),DOSE=$P(ND1,"^",5),UNIT=$P(ND1,"^",6),PSGSCH=$P(ND2,"^")
"RTN","PSJHL7",21,0)
 S PSGSOY=$P(ND2,"^",5),PSGOXT=$P(ND2,"^",6),PSGNEDFD=$P($$GTNEDFD^PSGOE7("UI",OIDRG),"^")
"RTN","PSJHL7",22,0)
 S:$P(LOC,"^")'=$P(ND2,"^",10) PSGSOY=$$ENRNAT^PSJHL7($P(ND2,"^",10),+LOC,PSGSCH,PSGSOY)
"RTN","PSJHL7",23,0)
 S X=$O(^PS(55,PSJHLDFN,5,+PREON,1,0)) I X S (Q,Q1)=0 F  S Q=$O(^PS(55,PSJHLDFN,5,+PREON,1,Q)) Q:'Q  S ND=$G(^(Q,0)) I ND,$S('$P(ND,"^",3):1,1:$P(ND,"^",3)>DT) S Q1=Q1+1,DRUGS(Q1)=$P(ND,"^",1,3)
"RTN","PSJHL7",24,0)
 S (PSGNESD,PSGNEFD)="" D ENWALL^PSGNE3(PSGNESD,PSGNEFD,PSJHLDFN)
"RTN","PSJHL7",25,0)
 I PSGOXT="D",'PSGSOY S PSGSOY=+$E(PSGNESD_"00011",9,12)
"RTN","PSJHL7",26,0)
 S ND=NEWORDER_U_PROVIDER_U_PSGMR_U_"U"_U_PSGSM_U_PSGHSM_U_PSGST_"^^P^^^^^"_LOGIN_U_PSJHLDFN_U_LOGIN S:PSGNEDFD $P(ND,U,$P(PSGNEDFD,U)["L"+10)=+PSGNEDFD
"RTN","PSJHL7",27,0)
 S $P(ND,U,21)=$P(ORDER,U),$P(ND,U,24,25)=ROC_U_PREON
"RTN","PSJHL7",28,0)
 F X="PSGNESD","PSGNEFD" S:@X]"" @X=+@X
"RTN","PSJHL7",29,0)
 S ND2=PSGSCH_U_PSGNESD_"^^"_PSGNEFD_U_PSGSOY_U_PSGOXT
"RTN","PSJHL7",30,0)
 S F="^PS(53.1,"_NEWORDER_",",@(F_"0)")=ND,^(.2)=OIDRG_U_PSGDO_U_ORDCON_U_PRIORITY_U_DOSE_U_UNIT_U_U_$G(PRNTON),^(2)=ND2 S:$G(PSGSI)]"" ^(6)=PSGSI
"RTN","PSJHL7",31,0)
 I $D(DRUGS) D
"RTN","PSJHL7",32,0)
 .I $D(@(F_"1,0)")) K @(F_"1)")
"RTN","PSJHL7",33,0)
 .; Naked reference below refers to full reference to ^PS(53.1,+NEWORDER in variable F created using indirection.
"RTN","PSJHL7",34,0)
 .I '$D(@(F_"1,0)")) S ^(0)="^53.11P^0^0"
"RTN","PSJHL7",35,0)
 .S JJ=0 F  S JJ=$O(DRUGS(JJ)) Q:'JJ  I $S('$P(DRUGS(JJ),U,3):1,1:$P(DRUGS(JJ),U,3)>DT) S $P(@(F_"1,0)"),"^",3,4)=JJ_"^"_JJ,@(F_"1,"_JJ_",0)")=$P(DRUGS(JJ),U,1,2),@(F_"1,""B"","_+DRUGS(JJ)_","_JJ_")")=""
"RTN","PSJHL7",36,0)
 S PSJOSTOP=$G(@("^PS(55,"_PSJHLDFN_",5,"_+$G(PREON)_",2)")),PSJOSTOP=$P(PSJOSTOP,"^",4)
"RTN","PSJHL7",37,0)
 D REN531(NEWORDER,$P(ND,"^",14),$S($G(PREON)["U":$P(ND,"^",2),1:$P(ND,"^",6)),PSJOSTOP,PSJHLDFN)
"RTN","PSJHL7",38,0)
 ;
"RTN","PSJHL7",39,0)
DONE ;
"RTN","PSJHL7",40,0)
 N DA,DR,DIE,PSIVACT,PSIVALT,ON55,PSIVREA
"RTN","PSJHL7",41,0)
 S DIE=$S(PREON["V":"^PS(55,"_PSJHLDFN_",""IV"",",1:"^PS(55,"_PSJHLDFN_",5,"),DA=+PREON,DA(1)=PSJHLDFN,DR=$S(PREON["V":"100////R;123////R;114////"_PSJORDER,1:"28////R;107////R;105////"_PSJORDER)
"RTN","PSJHL7",42,0)
 I PREON["A"!(PREON["U") S PSGAL("C")=18000 D ^PSGAL5
"RTN","PSJHL7",43,0)
 I PREON["V" S PSIVACT=1,PSIVALT=2,ON55=PREON,PSIVREA="R"
"RTN","PSJHL7",44,0)
 D ^DIE
"RTN","PSJHL7",45,0)
 I PREON["V" N DFN S DFN=PSJHLDFN D LOG^PSIVORAL
"RTN","PSJHL7",46,0)
 S PSJHLMTN="ORM" D EN1^PSJHL2(PSJHLDFN,"SC",PREON) S PSJHLMTN="ORR",PSOC="NW"
"RTN","PSJHL7",47,0)
 Q
"RTN","PSJHL7",48,0)
IVSET ;
"RTN","PSJHL7",49,0)
 N DRG,DRGN,P
"RTN","PSJHL7",50,0)
 S P("RES")="R",P("REN")="",Y=$G(^PS(55,PSJHLDFN,"IV",+PREON,0)) F X=1:1:23 S P(X)=$P(Y,U,X)
"RTN","PSJHL7",51,0)
 S P("PON")=PREON,P(21)=$P(ORDER,U),P(6)=PROVIDER_U_$P($G(^VA(200,+PROVIDER,0)),U),(DRG,DRGN)="",P("REM")=$G(^PS(55,PSJHLDFN,"IV",+PREON,1))
"RTN","PSJHL7",52,0)
 S Y=$G(^PS(55,PSJHLDFN,"IV",+PREON,2)),P("LOG")=LOGIN
"RTN","PSJHL7",53,0)
 S P("CLRK")=CLERK_U_$P($G(^VA(200,+CLERK,0)),U),P("RES")=ROC,P("FRES")=$P(Y,U,9),P("SYRS")=$P(Y,U,4),P("OPI")=$G(^PS(55,PSJHLDFN,"IV",+PREON,3))
"RTN","PSJHL7",54,0)
 S ND=$G(^PS(55,PSJHLDFN,"IV",+PREON,.2)),P("PD")=$S($P(ND,U):$P(ND,U)_U_$P($G(^PS(50.7,+ND,0)),U),1:""),P("DO")=$P(ND,U,2)
"RTN","PSJHL7",55,0)
 S P("MR")=$P(ND,U,3),ND=$G(^PS(51.2,+P("MR"),0)),P("MR")=P("MR")_U_$S($P(ND,U,3)]"":$P(ND,U,3),1:$P(ND,U))
"RTN","PSJHL7",56,0)
 D GTDRG
"RTN","PSJHL7",57,0)
 S P("OT")=$S(P(4)="A":"F",P(4)="H":"I",1:"I")
"RTN","PSJHL7",58,0)
 I P("OT")="F" F DRGT="AD","SOL" F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI  I '$P(DRG(DRGT,DRGI),U,5) S P("OT")="I"
"RTN","PSJHL7",59,0)
PUT531 ; Move data in local variables to 53.1
"RTN","PSJHL7",60,0)
 N IVLIM,IVLIMIT S IVLIM=$$GETDUR^PSJLIVMD(PSJHLDFN,+PREON,$E(PREON,$L(PREON)),1) I IVLIM]"",$G(IVLIMIT) S $P(^PS(53.1,+NEWORDER,2.5),U,4)=IVLIM
"RTN","PSJHL7",61,0)
 S ND(0)=+NEWORDER_U_+P(6)_U_$S(+P("MR"):+P("MR"),1:"")_U_P("OT")_U_U_U_"C",$P(ND(0),U,9)="P"
"RTN","PSJHL7",62,0)
 S $P(ND(0),U,14,16)=P("LOG")_U_PSJHLDFN_U_P("LOG"),$P(ND(0),U,21)=P(21),$P(ND(0),U,24,26)=$G(P("RES"))_U_P("PON")
"RTN","PSJHL7",63,0)
 S ND(2)=P(9)_U_U_U_U_P(11)_U_P(15),$P(ND(4),U,7,9)=+P("CLRK")_U_U_P("REN")
"RTN","PSJHL7",64,0)
 S ND(8)=P(4)_U_P(23)_U_P("SYRS")_U_P(5)_U_P(8)_"^^"_P(7),ND(9)=$S($L(P("REM")_P("OPI")):P("REM")_U_P("OPI"),1:"")
"RTN","PSJHL7",65,0)
 S ND(17)="" I $G(P(8))["@",($P($G(P(8)),"@",2)?1.N) S ND(17)=$P(P(8),"@",2)
"RTN","PSJHL7",66,0)
 F X=0,2,4,8,9,17 S ^PS(53.1,+NEWORDER,X)=ND(X)
"RTN","PSJHL7",67,0)
 S:+P("PD") ^PS(53.1,+NEWORDER,.2)=+P("PD")_U_P("DO")
"RTN","PSJHL7",68,0)
 S $P(^PS(53.1,+NEWORDER,.2),"^",3,4)=ORDCON_U_PRIORITY
"RTN","PSJHL7",69,0)
 ;I $G(PRNTON) I $$UP^XLFSTR($G(PSGSCH))="NOW" S PRNTON=""
"RTN","PSJHL7",70,0)
 I $G(PRNTON) S $P(^PS(53.1,+NEWORDER,.2),"^",8)=PRNTON
"RTN","PSJHL7",71,0)
 F DRGT="AD","SOL" D:$D(DRG(DRGT)) PTD531
"RTN","PSJHL7",72,0)
 S PSJOSTOP=$G(@("^PS(55,"_PSJHLDFN_",""IV"","_+PREON_",0)")),PSJOSTOP=$P(PSJOSTOP,"^",3) D
"RTN","PSJHL7",73,0)
 .N IVND S IVND=$G(^PS(53.1,+NEWORDER,0)) D REN531(NEWORDER,$P(IVND,"^",14),$P(ND,"^",2),PSJOSTOP,PSJHLDFN)
"RTN","PSJHL7",74,0)
 Q
"RTN","PSJHL7",75,0)
PTD531 ; Move drug data from local array into 53.1
"RTN","PSJHL7",76,0)
 K ^PS(53.1,+NEWORDER,DRGT) S ^PS(53.1,+NEWORDER,DRGT,0)=$S(DRGT="AD":"^53.157PA^0^0",1:"^53.158PA^0^0")
"RTN","PSJHL7",77,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSJHL7",78,0)
 .S X1=$P(DRG(DRGT,X),U),Y=^PS(53.1,+NEWORDER,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSJHL7",79,0)
 .S ^PS(53.1,+NEWORDER,DRGT,0)=Y,Y=+X1_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^PS(53.1,+NEWORDER,DRGT,+DRG,0)=Y,^PS(53.1,+NEWORDER,DRGT,"B",+X1,+DRG)=""
"RTN","PSJHL7",80,0)
 I $G(P("RES"))="R",($G(ND(0))]"") D REN531(+NEWORDER,$P(ND(0),"^",14),$P(ND(0),"^",2),$G(P(3)),$G(DFN))
"RTN","PSJHL7",81,0)
 Q
"RTN","PSJHL7",82,0)
 ;
"RTN","PSJHL7",83,0)
ENRNAT(OWD,NWD,SC,OAT) ;Determine admin times for renewal orders.
"RTN","PSJHL7",84,0)
 ;OWD=ORIGINAL W,NWD=NEW WD LOCATION, SC=SCHEDULE, OAT=ORDER ADMIN TIMES
"RTN","PSJHL7",85,0)
 N OWAT,SCP,X,Y,OOAT
"RTN","PSJHL7",86,0)
 S OOAT=OAT,SCP=+$O(^PS(51.1,"APPSJ",+SC,0)),WAT=$P($G(^PS(51.1,SCP,1,+$G(OWD),0)),U,2)
"RTN","PSJHL7",87,0)
 F X="WAT","OAT" F Y=1:1 Q:$L(@X)>240!($P(@X,"-",Y)="")  S $P(@X,"-",Y)=$P(@X,"-",Y)_$E("0000",1,4-$L($P(@X,"-",Y)))
"RTN","PSJHL7",88,0)
 I OAT'=WAT Q OOAT
"RTN","PSJHL7",89,0)
 S X=$P($G(^PS(51.1,+SCP,1,NWD,0)),U,2) I X Q X
"RTN","PSJHL7",90,0)
 Q OOAT
"RTN","PSJHL7",91,0)
 ;
"RTN","PSJHL7",92,0)
GTDRG ; Get drug info and place in DRG(. 
"RTN","PSJHL7",93,0)
 F DRGT="AD","SOL" S FIL=$S(DRGT="AD":52.6,1:52.7) F Y=0:0 S Y=$O(^PS(55,PSJHLDFN,"IV",+PREON,DRGT,Y)) Q:'Y  D
"RTN","PSJHL7",94,0)
 .;Naked reference ^(Y,0) below refers to full global reference ^PS(55,PSJHLDFN,"IV",+PREON,DRGT,Y)) above at GTDRG+1
"RTN","PSJHL7",95,0)
 .S DRG=$G(^(Y,0)),ND=$G(^PS(FIL,+DRG,0)),(DRGI,DRG(DRGT,0))=$G(DRG(DRGT,0))+1,DRG(DRGT,+DRGI)=+DRG_U_$P(ND,U)_U_$P(DRG,U,2)_U_$P(DRG,U,3)_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSJHL7",96,0)
 Q
"RTN","PSJHL7",97,0)
 ;
"RTN","PSJHL7",98,0)
REN531(PSGORD,PSGDT,PSGOEPR,PSGOFD,PSGP) ;
"RTN","PSJHL7",99,0)
 Q:'PSGORD!'PSGDT!'PSGOEPR!'PSGOFD!'PSGP
"RTN","PSJHL7",100,0)
 N DUP,PSGOLDPR I $G(PREON) D  Q:$G(DUP)
"RTN","PSJHL7",101,0)
 .S:$D(^PS(53.1,+PSGORD,14,"B",+PSGDT)) DUP=1 Q
"RTN","PSJHL7",102,0)
 S:$G(PREON)["U" PSGOLDPR=$P($G(^PS(55,PSGP,5,+PREON,0)),"^",2)
"RTN","PSJHL7",103,0)
 S:$G(PREON)["V" PSGOLDPR=$P($G(^PS(55,PSGP,"IV",+PREON,0)),"^",6)
"RTN","PSJHL7",104,0)
 K DR,DA,DIC,DIE,DD,DO S DIC="^PS(53.1,"_+PSGORD_",14,",DIC(0)="L",DIC("P")="53.1114DA",ND14=$G(@(DIC_"0)")),DINUM=$P(ND14,"^",3)+1,DA(2)=PSGP,DA(1)=+PSGORD D
"RTN","PSJHL7",105,0)
 . S DIC("DR")=".01////"_$G(PSGDT)_";1////"_$G(DUZ)_";2////"_$S($G(PSGOLDPR):$G(PSGOLDPR),1:$G(PSGOEPR))_";3////"_$G(PSGOFD),X=$G(PSGDT) D FILE^DICN
"RTN","PSJHL7",106,0)
 K DO,DINUM
"RTN","PSJHL7",107,0)
 I $G(PREON)["U",$D(^PS(55,PSGP,5,+PREON,15,1)) D
"RTN","PSJHL7",108,0)
 .N PSJSYSP S PSJSYSP=$J D GETSI^PSJBCMA5(PSGP,PREON) I $D(^PS(53.45,$J,5)) D FILESI^PSJBCMA5(PSGP,$S(PSGORD=+PSGORD:+PSGORD_"P",1:PSGORD))
"RTN","PSJHL7",109,0)
 I $G(PREON)["V",$D(^PS(55,PSGP,"IV",+PREON,10,1)) D
"RTN","PSJHL7",110,0)
 .N PSJSYSP S PSJSYSP=$J D GETOPI^PSJBCMA5(PSGP,PREON) I $D(^PS(53.45,$J,6)) D FILEOPI^PSJBCMA5(PSGP,$S(PSGORD=+PSGORD:+PSGORD_"P",1:PSGORD))
"RTN","PSJHL7",111,0)
 Q
"RTN","PSJHL7",112,0)
 ;
"RTN","PSJHL7",113,0)
CHK(X,Y,Z) ;Check for required fields
"RTN","PSJHL7",114,0)
 ; Input: X="^^"_MED ROUTE_"^^^^"_SCH TYPE
"RTN","PSJHL7",115,0)
 ;        Y=ORDERABLE ITEM_"^"_DOSAGE ORDERED
"RTN","PSJHL7",116,0)
 ;        Z=SCHEDULE_"^"_START DATE/TIME_"^^"_STOP DATE/TIME
"RTN","PSJHL7",117,0)
 S:'$D(^PS(50.7,+Y,0)) CHK=1
"RTN","PSJHL7",118,0)
 I ND="" S CHK=CHK_23
"RTN","PSJHL7",119,0)
 E  S CHK=CHK_$S($P(X,"^",3):"",1:2)_$S($P(X,"^",7)]"":"",1:3)
"RTN","PSJHL7",120,0)
 K PSGDFLG,PSGPFLG S PSGDI=0
"RTN","PSJHL7",121,0)
 S:'$$DDOK^PSJHL10("^TMP(""PSB"","_$J_",700,",+Y) CHK=CHK_7
"RTN","PSJHL7",122,0)
 ;
"RTN","PSJHL7",123,0)
CHKM ;
"RTN","PSJHL7",124,0)
 Q:'CHK
"RTN","PSJHL7",125,0)
 N MSG2
"RTN","PSJHL7",126,0)
 S MSG="THE FOLLOWING "_$S($L(CHK)>1:"ARE",1:"IS")_" EITHER INVALID OR MISSING FROM THIS ORDER:" F X=1:1:7 S:CHK[X MSG2=$P("ORDERABLE ITEM^MED ROUTE^SCHEDULE TYPE^SCHEDULE^START DATE/TIME^STOP DATE/TIME^DISPENSE DRUG","^",X)
"RTN","PSJHL7",127,0)
 S PSREASON=MSG_MSG2
"RTN","PSJHL7",128,0)
 Q
"RTN","PSJHL9")
0^28^B61985581^B61245429
"RTN","PSJHL9",1,0)
PSJHL9 ;BIR/LDT-VALIDATE INCOMING HL7 DATA/CREATE NEW ORDER ; 2/14/12 7:14am
"RTN","PSJHL9",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**1,18,31,42,47,50,63,72,75,58,80,110,111,134,267,279**;16 DEC 97;Build 150
"RTN","PSJHL9",3,0)
 ;
"RTN","PSJHL9",4,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192.
"RTN","PSJHL9",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJHL9",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJHL9",7,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL9",8,0)
 ; Reference to ^ORERR is supported by DBIA# 2187.
"RTN","PSJHL9",9,0)
 ; Reference to ^ORHLESC is supported by DBIA# 4922.
"RTN","PSJHL9",10,0)
 ;
"RTN","PSJHL9",11,0)
VALID ;
"RTN","PSJHL9",12,0)
 I APPL="",PSITEM="" S PSREASON="Missing or invalid Orderable Item" D ERROR Q
"RTN","PSJHL9",13,0)
 I PSITEM]"",'$D(^PS(50.7,+PSITEM,0)) S PSREASON="Missing or invalid Orderable Item" D ERROR Q
"RTN","PSJHL9",14,0)
 I $G(APPL)'["B",$G(APPL)'["A",+$G(ROUTE)'>0 S PSREASON="Missing or invalid Med Route" D ERROR Q
"RTN","PSJHL9",15,0)
 S APPL=$S($G(APPL)["B":"F",$G(APPL)["A":"F",$G(DISPENSE)]"":$$ORTYP(ROUTE,DISPENSE),1:$$TRYAGAIN(ROUTE,PSITEM))
"RTN","PSJHL9",16,0)
 S:APPL="" APPL="IP"
"RTN","PSJHL9",17,0)
 I APPL'="F" D
"RTN","PSJHL9",18,0)
 .I $G(SCHEDULE)]"" N X S X=SCHEDULE D  S SCHEDULE=X
"RTN","PSJHL9",19,0)
 ..I X[""""!($A(X)=45)!(X?.E1C.E)!($L(X," ")>3)!($L($P(X,"@"))>70)!($L($P(X,"@",2))>119)!($L(X)<1)!(X["P RN")!(X["PR N") S X="" Q
"RTN","PSJHL9",20,0)
 ..I X?.E1L.E S X=$$ENLU^PSGMI(X)
"RTN","PSJHL9",21,0)
 ..S X=$$TRIM^XLFSTR(X,"R"," ")
"RTN","PSJHL9",22,0)
 ..I X["Q0" S X="" Q
"RTN","PSJHL9",23,0)
 .I APPL["U",$G(SCHEDULE)="" S PSREASON="Missing or invalid schedule" D ERROR Q
"RTN","PSJHL9",24,0)
 .N DFN S DFN=PSJHLDFN D IN5^VADPT I 'VAIP(5) D:APPT=""  I APPL="UN",APPT="" S PSREASON="Cannot place Unit Dose orders for an Outpatient" D ERROR Q
"RTN","PSJHL9",25,0)
 .. I APPL="UP" S APPL="IN" Q
"RTN","PSJHL9",26,0)
 .. I APPL="IP" S APPL="IN" Q
"RTN","PSJHL9",27,0)
 .I $G(ROC)'="R",$G(ROUTE)'>0 S PSREASON="Missing or invalid Med Route" D ERROR Q
"RTN","PSJHL9",28,0)
 I APPL="F" D
"RTN","PSJHL9",29,0)
 .I '$O(^TMP("PSJNVO",$J,"SOL",0))&('$O(^TMP("PSJNVO",$J,"AD",0))) S PSREASON="IV Fluid orders must have at least one additive or solution" D ERROR Q
"RTN","PSJHL9",30,0)
 .I $G(IVCAT)="I",$G(INFRT)="" Q  ;Allow intermittent IV orders to have a null infusion rate.
"RTN","PSJHL9",31,0)
 .I $G(INFRT)="" S PSREASON="Invalid Infusion Rate" D ERROR Q
"RTN","PSJHL9",32,0)
 Q
"RTN","PSJHL9",33,0)
 ;
"RTN","PSJHL9",34,0)
ERROR ;Sends error msg to CPRS, logs error in OE/RR Errors file
"RTN","PSJHL9",35,0)
 S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(PSREASON,.PSJMSG)
"RTN","PSJHL9",36,0)
 D EN1^PSJHLERR(PSJHLDFN,$S(PSOC="XO":"UX",1:"OC"),$P(ORDER,U),PSREASON) S QFLG=1 K ^TMP("PSJNVO",$J)
"RTN","PSJHL9",37,0)
 Q
"RTN","PSJHL9",38,0)
 ;
"RTN","PSJHL9",39,0)
NVO ; put new orders in non-verified orders file
"RTN","PSJHL9",40,0)
 I '$D(ROUTE) S ROUTE=""
"RTN","PSJHL9",41,0)
 I $G(ROUTE)="" S:APPL="F" ROUTE=$O(^PS(51.2,"B","INTRAVENOUS",0))
"RTN","PSJHL9",42,0)
 N DA,DR,DIE D ENGNN^PSGOETO S DIE="^PS(53.1,"
"RTN","PSJHL9",43,0)
 S DR="1////"_PROVIDER_";3////"_$$ESC^ORHLESC(ROUTE)_";4////"_$E(APPL)_";28////P"_";108////"_PSITEM_";27.1////"_LOGIN_";27////"_LOGIN_";.5////"_PSJHLDFN_";.24////"_PRIORITY_";125////"_$G(PRNTON)
"RTN","PSJHL9",44,0)
 I $G(LOC)]"" S:$P($G(^SC(+LOC,0)),U,3)="C" DR=DR_";113////"_LOC_";126////"_$G(APPT)
"RTN","PSJHL9",45,0)
 I $G(IVCAT)]"" S DR=DR_";128////"_IVCAT S ADMINS=""
"RTN","PSJHL9",46,0)
 S:$G(SCHTYP)]"" DR=DR_";7////"_SCHTYP
"RTN","PSJHL9",47,0)
 D ^DIE K PSJHLSKP S NEWORDER=DA,PSJORDER=DA_"P"
"RTN","PSJHL9",48,0)
 S $P(^PS(55,PSJHLDFN,5.1),"^",2)=PROVIDER
"RTN","PSJHL9",49,0)
 S:$G(ORDER)]"" $P(^PS(53.1,DA,0),"^",21)=$P(ORDER,"^")
"RTN","PSJHL9",50,0)
 S:$G(APPL)["P" $P(^PS(53.1,DA,0),"^",13)=1
"RTN","PSJHL9",51,0)
 S $P(^PS(53.1,DA,0),"^",18)=DA
"RTN","PSJHL9",52,0)
 S:$G(ROC)]"" $P(^PS(53.1,DA,0),"^",24)=ROC
"RTN","PSJHL9",53,0)
 S:$G(PREON)]"" $P(^PS(53.1,DA,0),"^",25)=PREON
"RTN","PSJHL9",54,0)
 S:$G(ADMINS) $P(^PS(53.1,DA,2),"^",5)=ADMINS
"RTN","PSJHL9",55,0)
 S:$G(REQST)]"" $P(^PS(53.1,DA,2.5),"^")=REQST
"RTN","PSJHL9",56,0)
 ; Transform duration units of doses to a for administrations
"RTN","PSJHL9",57,0)
 S:$E(DURATION,1,5)="doses" DURATION=$TR(DURATION,"doses","a")
"RTN","PSJHL9",58,0)
 S:$G(DURATION)]"" $P(^PS(53.1,DA,2.5),"^",2)=DURATION
"RTN","PSJHL9",59,0)
 S:$G(IVLIMIT)]"" $P(^PS(53.1,DA,2.5),"^",4)=IVLIMIT
"RTN","PSJHL9",60,0)
 I $G(REQST)]"",$G(DURATION)]"" S $P(^PS(53.1,DA,2.5),"^",3)=$$STOP(REQST,DURATION)
"RTN","PSJHL9",61,0)
 S:$G(INSTR)]"" $P(^PS(53.1,DA,.3),"^")=INSTR
"RTN","PSJHL9",62,0)
 I $G(INFRT)]"" D
"RTN","PSJHL9",63,0)
 .I INFRT S:(INFRT["Minutes"!(INFRT["Hours")) INFRT="INFUSE OVER "_INFRT
"RTN","PSJHL9",64,0)
 .S ^PS(53.1,DA,8)=IVTYP_"^^^^"_INFRT
"RTN","PSJHL9",65,0)
 .I INFRT["@",($P(INFRT,"@",2)?1.N) S $P(^PS(53.1,DA,17),"^")=$P(INFRT,"@",2)
"RTN","PSJHL9",66,0)
 S:$G(FREQ)]"" $P(^PS(53.1,DA,2),"^",6)=FREQ
"RTN","PSJHL9",67,0)
 S:$G(SCHTYP)]"" $P(^PS(53.1,DA,0),"^",7)=SCHTYP
"RTN","PSJHL9",68,0)
 I $G(APPL)'="I" I $G(INSTR)]"" N X S X=INSTR D STRIP I $S(X?.E1C.E:0,$L(X)>60:0,X="":0,X["^":0,X?1.P:1,1:1) S $P(^PS(53.1,DA,.2),"^",2)=X,$P(^PS(53.1,DA,.2),"^",5,6)=$G(DOSE)_"^"_$$UNESC^ORHLESC($G(UNIT))
"RTN","PSJHL9",69,0)
 S $P(^PS(53.1,DA,.2),"^",3)=ORDCON
"RTN","PSJHL9",70,0)
 I $G(SCHEDULE)]"" S $P(^PS(53.1,DA,2),"^")=$$UNESC^ORHLESC(SCHEDULE)
"RTN","PSJHL9",71,0)
 I $G(APPL)="I" I $G(UNITS)]"" S $P(^PS(53.1,DA,.3),"^")=$$UNESC^ORHLESC(UNITS)
"RTN","PSJHL9",72,0)
 S ^PS(53.1,DA,4)="^^^^^^"_CLERK
"RTN","PSJHL9",73,0)
 I $G(DISPENSE) S ^PS(53.1,DA,1,0)="^53.11P^1^1",^PS(53.1,DA,1,1,0)=DISPENSE_"^"_$$UNESC^ORHLESC(UNITS),^PS(53.1,DA,1,"B",$E(DISPENSE,1,30),1)=""
"RTN","PSJHL9",74,0)
 I $D(PROCOM) D
"RTN","PSJHL9",75,0)
 .I '$D(^PS(53.1,DA,12,0)) S ^(0)="^53.1012^0^0"
"RTN","PSJHL9",76,0)
 .S JJ=0 F  S JJ=$O(PROCOM(JJ)) Q:'JJ  S $P(^PS(53.1,DA,12,0),"^",3,4)=JJ_"^"_JJ,^PS(53.1,DA,12,JJ,0)=$$UNESC^ORHLESC(PROCOM(JJ))
"RTN","PSJHL9",77,0)
 I $D(ADMINSTR) D
"RTN","PSJHL9",78,0)
 .I '$D(^PS(53.1,DA,3,0)) S ^(0)="^53.12^0^0"
"RTN","PSJHL9",79,0)
 .S JJ=0 F  S JJ=$O(ADMINSTR(JJ)) Q:'JJ  S $P(^PS(53.1,DA,3,0),"^",3,4)=JJ_"^"_JJ,^PS(53.1,DA,3,JJ,0)=ADMINSTR(JJ)
"RTN","PSJHL9",80,0)
 I $D(^TMP("PSJNVO",$J,"AD")) D
"RTN","PSJHL9",81,0)
 .S ^PS(53.1,DA,"AD",0)="^53.157PA^0^0"
"RTN","PSJHL9",82,0)
 .S JJ=0 F  S JJ=$O(^TMP("PSJNVO",$J,"AD",JJ)) Q:'JJ  S $P(^PS(53.1,DA,"AD",0),"^",3,4)=JJ_"^"_JJ,^PS(53.1,DA,"AD",JJ,0)=^TMP("PSJNVO",$J,"AD",JJ,0),^PS(53.1,DA,"AD","B",$$UNESC^ORHLESC($P(^TMP("PSJNVO",$J,"AD",JJ,0),"^")),JJ)=""
"RTN","PSJHL9",83,0)
 I $D(^TMP("PSJNVO",$J,"SOL")) D
"RTN","PSJHL9",84,0)
 .S ^PS(53.1,DA,"SOL",0)="^53.158PA^0^0"
"RTN","PSJHL9",85,0)
 .S JJ=0 F  S JJ=$O(^TMP("PSJNVO",$J,"SOL",JJ)) Q:'JJ  S $P(^PS(53.1,DA,"SOL",0),"^",3,4)=JJ_"^"_JJ,^PS(53.1,DA,"SOL",JJ,0)=^TMP("PSJNVO",$J,"SOL",JJ,0),^PS(53.1,DA,"SOL","B",$P(^TMP("PSJNVO",$J,"SOL",JJ,0),"^"),JJ)=""
"RTN","PSJHL9",86,0)
 I $O(^TMP("PSJNVO",$J,10,0)) D
"RTN","PSJHL9",87,0)
 .S ^PS(53.1,DA,10,0)="^53.1112A^0^0"
"RTN","PSJHL9",88,0)
 .S JJ=0 F  S JJ=$O(^TMP("PSJNVO",$J,10,JJ)) Q:'JJ  S $P(^PS(53.1,DA,10,0),"^",3,4)=JJ_"^"_JJ,^PS(53.1,DA,10,JJ,0)=$$UNESC^ORHLESC(^TMP("PSJNVO",$J,10,JJ,0)),^PS(53.1,DA,10,"B",$$UNESC^ORHLESC($E(^TMP("PSJNVO",$J,10,JJ,0),1,30)),JJ)="" D
"RTN","PSJHL9",89,0)
 ..S ^PS(53.1,DA,10,JJ,1)=$P($G(^VA(200,+CLERK,0)),"^")
"RTN","PSJHL9",90,0)
 ..I $O(^TMP("PSJNVO",$J,10,JJ,2,0)) S ^PS(53.1,DA,10,JJ,2,0)="^53.11122^0^0" D
"RTN","PSJHL9",91,0)
 ...S QQ=0 F  S QQ=$O(^TMP("PSJNVO",$J,10,JJ,2,QQ)) Q:'QQ  S $P(^PS(53.1,DA,10,JJ,2,0),"^",3,4)=QQ_"^"_QQ,^PS(53.1,DA,10,JJ,2,QQ,0)=$$UNESC^ORHLESC(^TMP("PSJNVO",$J,10,JJ,2,QQ,0))
"RTN","PSJHL9",92,0)
 Q
"RTN","PSJHL9",93,0)
STRIP ;Strips spaces off the end of instructions.
"RTN","PSJHL9",94,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSJHL9",95,0)
 Q
"RTN","PSJHL9",96,0)
 ;
"RTN","PSJHL9",97,0)
ORTYP(MDRT,DDRG)        ;Entry point to determine order type for 53.1
"RTN","PSJHL9",98,0)
 ;MDRT=Med Route from 51.2, DDRG=Dispense Drug
"RTN","PSJHL9",99,0)
 I '$G(DDRG) S ORTYP="" Q ORTYP
"RTN","PSJHL9",100,0)
 I '$D(^PSDRUG(+DDRG,2)) S ORTYP="" Q ORTYP
"RTN","PSJHL9",101,0)
 I $P(^PSDRUG(DDRG,2),"^",3)'["I",$P(^PSDRUG(DDRG,2),"^",3)'["U" S ORTYP="" Q ORTYP
"RTN","PSJHL9",102,0)
 I '$G(MDRT) S ORTYP="" Q ORTYP
"RTN","PSJHL9",103,0)
 I '$D(^PS(51.2,+MDRT,0)) S ORTYP="" Q ORTYP
"RTN","PSJHL9",104,0)
 I $P(^PSDRUG(DDRG,2),"^",3)["I",$P(^PSDRUG(DDRG,2),"^",3)'["U",$P(^PS(51.2,MDRT,0),"^",6)=1 S ORTYP="IN" Q ORTYP
"RTN","PSJHL9",105,0)
 I $P(^PSDRUG(DDRG,2),"^",3)'["I",$P(^PS(51.2,MDRT,0),"^",6)=1 S ORTYP="UP" Q ORTYP
"RTN","PSJHL9",106,0)
 I $P(^PSDRUG(DDRG,2),"^",3)["I",$P(^PS(51.2,MDRT,0),"^",6)=1 S ORTYP="IP" Q ORTYP
"RTN","PSJHL9",107,0)
 I $P(^PSDRUG(DDRG,2),"^",3)["I",$P(^PSDRUG(DDRG,2),"^",3)'["U",$P(^PS(51.2,MDRT,0),"^",6)'=1 S ORTYP="IP" Q ORTYP
"RTN","PSJHL9",108,0)
 I $P(^PSDRUG(DDRG,2),"^",3)["U",$P(^PSDRUG(DDRG,2),"^",3)'["I",$P(^PS(51.2,MDRT,0),"^",6)'=1 S ORTYP="UN" Q ORTYP
"RTN","PSJHL9",109,0)
 I $P(^PSDRUG(DDRG,2),"^",3)["U",$P(^PS(51.2,MDRT,0),"^",6)'=1 S ORTYP="UP" Q ORTYP
"RTN","PSJHL9",110,0)
 S ORTYP="" Q ORTYP
"RTN","PSJHL9",111,0)
 ;
"RTN","PSJHL9",112,0)
TRYAGAIN(MDRT,OI)       ;
"RTN","PSJHL9",113,0)
 ;MDRT=Med Route from 51.2, OI=Orderable Item
"RTN","PSJHL9",114,0)
 N ORTYPI,ORTYPU,ORTYPP
"RTN","PSJHL9",115,0)
 S ORTYP="",ORTYPI=0,ORTYPU=0,ORTYPP=0
"RTN","PSJHL9",116,0)
 N DDRG S DDRG=0 F  S DDRG=$O(^PSDRUG("ASP",OI,DDRG)) Q:'DDRG  D 
"RTN","PSJHL9",117,0)
 .I $G(^PSDRUG(DDRG,"I"))]"" Q:^PSDRUG(DDRG,"I")'>DT
"RTN","PSJHL9",118,0)
 .S ORTYP=$$ORTYP(MDRT,DDRG)  D
"RTN","PSJHL9",119,0)
 ..I ORTYP["I" S ORTYPI=ORTYPI+1
"RTN","PSJHL9",120,0)
 ..I ORTYP["U" S ORTYPU=ORTYPU+1
"RTN","PSJHL9",121,0)
 ..I ORTYP["P" S ORTYPP=ORTYPP+1
"RTN","PSJHL9",122,0)
 S ORTYP=$S(ORTYPU>ORTYPI:"U",1:"I") S ORTYP=ORTYP_$S(ORTYPP>0:"P",1:"N")
"RTN","PSJHL9",123,0)
 Q ORTYP
"RTN","PSJHL9",124,0)
 ;
"RTN","PSJHL9",125,0)
STOP(REQST,DURA)   ;
"RTN","PSJHL9",126,0)
 ;REQST=Requested start date, DURA=Duration from CPRS
"RTN","PSJHL9",127,0)
 I DURA["L",DURA?1A1".".N S DAYS=$$DAY($E(REQST,1,5)),DURA="H"_((DAYS*$P(DURA,"L",2))*24)
"RTN","PSJHL9",128,0)
 I DURA["L",DURA?1A.1N.N1"."1N.N D  Q STOP
"RTN","PSJHL9",129,0)
 .S NUM=$E(REQST,4,5)+$P($P(DURA,"."),"L",2),NUM=$S(NUM<10:"0"_NUM,NUM<13:NUM,1:$S((NUM-12)<10:"0"_(NUM-12),1:(NUM-12))),DATE=$E(REQST,1,3)_NUM
"RTN","PSJHL9",130,0)
 .S DAYS=$$DAY(DATE),STOP=$$SCH^XLFDT($P($P(DURA,"."),"L",2)_"M",$P(REQST,"."))_"."_$P(REQST,".",2),DEL=$P($P(DURA,"L",2),"."),STOP=$$FMADD^XLFDT(STOP,"",((DAYS*$P(DURA,DEL,2))*24))
"RTN","PSJHL9",131,0)
 I DURA["L" S STOP=$P($$SCH^XLFDT($P(DURA,"L",2)_"M",$P(REQST,".")),".")_"."_$P(REQST,".",2) Q STOP
"RTN","PSJHL9",132,0)
 I DURA["W",DURA["." S DURA="H"_(($P(DURA,"W",2)*7)*24)
"RTN","PSJHL9",133,0)
 I DURA["D",DURA["." S DURA="H"_($P(DURA,"D",2)*24)
"RTN","PSJHL9",134,0)
 I +DURA=DURA,DURA["." S DURA="H"_(DURA*24)
"RTN","PSJHL9",135,0)
 S STOP=$$FMADD^XLFDT(REQST,$S(DURA["W":$P(DURA,"W",2)*7,DURA["D":$P(DURA,"D",2),+DURA=DURA:+DURA,1:""),$S(DURA["H":$P(DURA,"H",2),1:""),$S(DURA["M":$P(DURA,"M",2),1:""),$S(DURA["S":$P(DURA,"S",2),1:""))
"RTN","PSJHL9",136,0)
 Q STOP
"RTN","PSJHL9",137,0)
ZQDATE(DATE,MONTHS)  ;BUMP DATE BY A MONTH (OR SO)
"RTN","PSJHL9",138,0)
 ;;
"RTN","PSJHL9",139,0)
 S X=$E($P(DATE,"."),1,5)+($E($P(DATE,"."),4,5)>(12-MONTHS)*88+MONTHS)_$E($P(DATE,"."),6,7) F  D ^%DT Q:Y>0  S X=X-1
"RTN","PSJHL9",140,0)
 S NEWDATE=X_"."_$P(DATE,".",2)
"RTN","PSJHL9",141,0)
 Q NEWDATE
"RTN","PSJHL9",142,0)
DAY(DATE) ;DATE=FIRST FIVE DIGITS OF FM DATE
"RTN","PSJHL9",143,0)
 N X
"RTN","PSJHL9",144,0)
 I DATE'?5N Q -1
"RTN","PSJHL9",145,0)
 S X=$E(DATE,4,5) I X<1!(X>12) Q -1
"RTN","PSJHL9",146,0)
 S X=DATE+1+(X=12*88)_"01"
"RTN","PSJHL9",147,0)
 Q $E($$FMADD^XLFDT(X,-1),6,7)
"RTN","PSJIBAG")
0^35^B43933390^n/a
"RTN","PSJIBAG",1,0)
PSJIBAG ;BIR/JCH-IV PARAMETER VALIDATION ; 08/10/12 12:26pm
"RTN","PSJIBAG",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**279**;16 DEC 97;Build 150
"RTN","PSJIBAG",3,0)
 ;;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSJIBAG",4,0)
 ;
"RTN","PSJIBAG",5,0)
 ; Reference to ^PSBPOIV is supported by DBIA #5434
"RTN","PSJIBAG",6,0)
 ;
"RTN","PSJIBAG",7,0)
PSBPOIV(DFN,ORDER,PSJQT,PSJINIV) ; Check BCMA IV Parameters, invalidate labels
"RTN","PSJIBAG",8,0)
 ; DFN - Patient IEN
"RTN","PSJIBAG",9,0)
 ; ORDER - Inpatient IV order
"RTN","PSJIBAG",10,0)
 ; PSJQT - Quiet (no display) 
"RTN","PSJIBAG",11,0)
 ;       - 100 = called from Label Log
"RTN","PSJIBAG",12,0)
 ; PSJINIV - Were any labels invalidated? 
"RTN","PSJIBAG",13,0)
 ;           0=NO, 1=YES
"RTN","PSJIBAG",14,0)
 ;
"RTN","PSJIBAG",15,0)
 Q:'$G(DFN)!'$G(ORDER)!'($G(ORDER)["V")
"RTN","PSJIBAG",16,0)
 K ^TMP("PSBAR",$J),^TMP("PSJINBAG",$J,DFN,+ORDER)
"RTN","PSJIBAG",17,0)
 I '$G(PSJQT) W !,"Checking IV Labels..."
"RTN","PSJIBAG",18,0)
 D EN^PSBPOIV(DFN,ORDER)
"RTN","PSJIBAG",19,0)
 N INVDT,PSJAVAIL,Y,COU,PSJDOLJ D NOW^%DTC S INVDT=%,PSJAVAIL=0,PSJDOLJ=$J
"RTN","PSJIBAG",20,0)
 N LBLID S LBLID=0 F  S LBLID=$O(^TMP("PSBAR",$J,LBLID)) Q:'LBLID  D
"RTN","PSJIBAG",21,0)
 .N LBLNUM,INVBCMA S INVBCMA=$P($G(^TMP("PSBAR",$J,LBLID)),"^")
"RTN","PSJIBAG",22,0)
 .I (INVBCMA'="I"),'$G(PSJAVAIL) K ^TMP("PSJINBAG",$J),^TMP("PSBAR",$J,"I") S PSJAVAIL=1,INVDT=""
"RTN","PSJIBAG",23,0)
 .S LBLNUM=$P(LBLID,"V",2) Q:'LBLNUM
"RTN","PSJIBAG",24,0)
 .N INVIPM S INVIPM=$P($G(^PS(55,DFN,"IVBCMA",LBLNUM,0)),"^",9) Q:INVIPM
"RTN","PSJIBAG",25,0)
 .S ^TMP("PSJINBAG",$J,DFN,ORDER,LBLID)=INVDT
"RTN","PSJIBAG",26,0)
 I $D(^TMP("PSJINBAG",$J,DFN,ORDER)) D
"RTN","PSJIBAG",27,0)
 .I ($G(PSJQT)) D DATA(DFN,+ORDER,,,$G(PSJAVAIL),,1),EXIT Q
"RTN","PSJIBAG",28,0)
 .D VFY(DFN,ORDER,INVDT,$G(PSJAVAIL)),EXIT
"RTN","PSJIBAG",29,0)
 Q
"RTN","PSJIBAG",30,0)
 ;
"RTN","PSJIBAG",31,0)
VFY(DFN,PSIVON55,INVDT,PSJAVAIL) ; If AUTO-VERIFY turned off, veryifying pharmacist needs to be reminded about invalidated labels before being prompted to print labels
"RTN","PSJIBAG",32,0)
 N PSJIAL,PSJIACT,PSJBLN,PSJDNE,PSIVTMP,Y S PSJBLN=0,PSJDNE=0,PSJINIV="",PSJDOLJ=$J
"RTN","PSJIBAG",33,0)
 N BCINVF S BCINVF=$G(^TMP("PSBAR",$J,"I")) I BCINVF]"" D
"RTN","PSJIBAG",34,0)
 .N TMPINFLD S TMPINFLD=$P(BCINVF,"invalid",2) S TMPINFLD=$TR(TMPINFLD,".") I $E(TMPINFLD)=" " S TMPINFLD=$E(TMPINFLD,2,99)
"RTN","PSJIBAG",35,0)
 .S BCINVF=TMPINFLD
"RTN","PSJIBAG",36,0)
 I '$G(PSJAVAIL)&(BCINVF="") Q
"RTN","PSJIBAG",37,0)
 D FULL^VALM1
"RTN","PSJIBAG",38,0)
 I '$G(PSJAVAIL),($G(BCINVF)]"") W !!!?6,"**  Edit to ",BCINVF," has invalidated the following IV labels  **" D
"RTN","PSJIBAG",39,0)
 .W !?4,"(Invalid IV labels cannot be reprinted or marked as Infusing in BCMA)"
"RTN","PSJIBAG",40,0)
 I $G(PSJAVAIL) W !!!?12,"**  The following labels are available  **"
"RTN","PSJIBAG",41,0)
 D DATA(DFN,+PSIVON55,,$S($G(PSJAVAIL):"",1:INVDT),$S($G(PSJAVAIL):PSJAVAIL,1:""),.PSJINIV)
"RTN","PSJIBAG",42,0)
 I '$G(PSJAVAIL) D
"RTN","PSJIBAG",43,0)
 .N DIR,DA S DIR(0)="SAO^P:PRINT",DIR("A")="Enter 'P' to print list of Invalidated Labels or RETURN to continue: " D ^DIR
"RTN","PSJIBAG",44,0)
 .I '($G(Y)="P") K ^TMP("PSJINBAG",$J) Q
"RTN","PSJIBAG",45,0)
 .D DEV(DFN,PSIVON55,INVDT)
"RTN","PSJIBAG",46,0)
 I $G(PSJAVAIL) D CONT^PSJOE0 K ^TMP("PSJINBAG",$J)
"RTN","PSJIBAG",47,0)
 Q
"RTN","PSJIBAG",48,0)
 ;
"RTN","PSJIBAG",49,0)
DATA(DFN,ON,PSJIPRNT,PSJIINV,PSJAVAIL,PSJINIV,PSJQT) ;Get the Information
"RTN","PSJIBAG",50,0)
 N PSJINVDT
"RTN","PSJIBAG",51,0)
EN2 ; Queued entry point
"RTN","PSJIBAG",52,0)
 N TMPON55,PSJBLN,PSJD1,X,DA,DR,DIQ,DIC,PSJD2,LLCNT,PSJBLNL,TMPON,PSIVSCR,PSGP
"RTN","PSJIBAG",53,0)
 K PSJDNE S PSIVSCR=$E(IOST)="C",COU=0,LLCNT=0
"RTN","PSJIBAG",54,0)
 I ($G(ON)["P") S TMPON=ON N HDR531 S HDR531=$G(^PS(53.1,+ON,0)) S HDR531=$P(HDR531,"^",25) I HDR531["V" S ON=HDR531
"RTN","PSJIBAG",55,0)
 S ON=+ON
"RTN","PSJIBAG",56,0)
 S ^TMP("PSJINBAG",PSJDOLJ,DFN,ON_"V")=$S($G(PSJAVAIL):"AVAILABLE",1:"INVALID")
"RTN","PSJIBAG",57,0)
 I $G(PSJIPRNT) D ENIV^PSJAC D
"RTN","PSJIBAG",58,0)
 .N LOC,PN,AI,ADCNT,SOLCNT S LOC=$P($G(VAIN(4)),"^",2) I LOC="" S LOC=+$G(^PS(55,DFN,"IV",+ON,"DSS")) D
"RTN","PSJIBAG",59,0)
 ..S LOC=$S($G(LOC):$P($G(^SC(+LOC,0)),"^"),1:"NOT FOUND")
"RTN","PSJIBAG",60,0)
 .S PN=$S(($G(PSGP(0))]""):PSGP(0),1:$P($G(^DPT(DFN,0)),"^"))
"RTN","PSJIBAG",61,0)
 .U IO W !!?23,"* Invalidated IV Labels *",!!?5,"Patient: ",PN,?50,"Location: ",LOC
"RTN","PSJIBAG",62,0)
 .S ADCNT=0 F AI=1:1 S ADCNT=$O(^PS(55,DFN,"IV",+ON,"AD",ADCNT)) Q:'ADCNT  D
"RTN","PSJIBAG",63,0)
 ..N IVND0,IVSTR S IVND0=$G(^PS(55,DFN,"IV",+ON,"AD",ADCNT,0)),IVSTR=$P(IVND0,"^",2)
"RTN","PSJIBAG",64,0)
 ..I AI=1 W !?1,"Additive(s) (current order): ",?14,$P($G(^PS(52.6,+IVND0,0)),"^") Q
"RTN","PSJIBAG",65,0)
 ..W !?14,$P($G(^PS(52.6,+IVND0,0)),"^")
"RTN","PSJIBAG",66,0)
 .S SOLCNT=0 F AI=1:1 S SOLCNT=$O(^PS(55,DFN,"IV",+ON,"SOL",SOLCNT)) Q:'SOLCNT  D
"RTN","PSJIBAG",67,0)
 ..N IVND0,IVOL S IVND0=$G(^PS(55,DFN,"IV",+ON,"SOL",SOLCNT,0)),IVOL=$P(IVND0,"^",2)
"RTN","PSJIBAG",68,0)
 ..I AI=1 W !?1,"Solution(s) (current order): ",?14,$P($G(^PS(52.7,+IVND0,0)),"^") Q
"RTN","PSJIBAG",69,0)
 ..W !?14,$P($G(^PS(52.6,+$G(^PS(55,DFN,"IV",+ON,"SOL",SOLCNT,0)),0)),"^")
"RTN","PSJIBAG",70,0)
 I '$G(PSJQT) U IO W ! D H2 S PSJBLN=0,LLCNT=1
"RTN","PSJIBAG",71,0)
 I $G(PSJIINV) D NOW^%DTC S (PSJIINV,PSJINVDT)=$S($G(PSJIINV)>200000:PSJIINV,1:%) D UPD(DFN,ON,PSJINVDT,.PSJINIV)
"RTN","PSJIBAG",72,0)
 I '$G(PSJQT) S ON=ON_"V" S PSJBLNL=0 F  S PSJBLNL=$O(^TMP("PSJINBAG",PSJDOLJ,DFN,ON,PSJBLNL)) Q:'PSJBLNL  D DISPLAY
"RTN","PSJIBAG",73,0)
 ;
"RTN","PSJIBAG",74,0)
K ;
"RTN","PSJIBAG",75,0)
 K NUMLAB,TRA,CD,DATE,DIR,DIC,%
"RTN","PSJIBAG",76,0)
 Q
"RTN","PSJIBAG",77,0)
 ;
"RTN","PSJIBAG",78,0)
DISPLAY ; Display or Print labels 
"RTN","PSJIBAG",79,0)
 K DA,DR,DIQ,DIC,PSJD2 N IVALID,LBST,BCST,LSTAT,PSJBLN
"RTN","PSJIBAG",80,0)
 S PSJBLN=$P(PSJBLNL,"V",2)
"RTN","PSJIBAG",81,0)
 S DIC="^PS(55,"_DFN_",""IVBCMA"",",DA=PSJBLN,DR=".01;.02;1;2;3;4;5;9",DIQ="PSJD2",DIQ(0)="IE" D EN^DIQ1
"RTN","PSJIBAG",82,0)
 S BCST=$G(PSJD2(55.0105,PSJBLN,2,"E")) Q:(BCST="COMPLETED")!(BCST="GIVEN")
"RTN","PSJIBAG",83,0)
 Q:($G(PSJD2(55.0105,PSJBLN,5,"E"))]"")
"RTN","PSJIBAG",84,0)
 S IVALID=$P($G(^PS(55,DFN,"IVBCMA",+PSJBLN,0)),"^",9)
"RTN","PSJIBAG",85,0)
 I IVALID Q:($G(PSJIINV))&(IVALID'=$G(PSJIINV))
"RTN","PSJIBAG",86,0)
 I PSIVSCR,($Y#IOSL)>23 D PAUSE,H2 S LLCNT=$G(LLCNT)+3
"RTN","PSJIBAG",87,0)
 W $$ENDTC1^PSGMI($G(PSJD2(55.0105,PSJBLN,4,"I"))),?17,$G(PSJD2(55.0105,PSJBLN,.01,"I")) S LLCNT=$G(LLCNT)+1 I $X>39 W ! S LLCNT=$G(LLCNT)+1
"RTN","PSJIBAG",88,0)
 S LBST=$G(PSJD2(55.0105,PSJBLN,5,"E"))
"RTN","PSJIBAG",89,0)
 W ?39,LBST S LLCNT=$G(LLCNT)+1
"RTN","PSJIBAG",90,0)
 S X=$G(PSJD2(55.0105,PSJBLN,3,"I")) W ?51,$S(X:"YES",1:"NO")
"RTN","PSJIBAG",91,0)
 W ?57,$G(PSJD2(55.0105,PSJBLN,2,"E")) S LLCNT=$G(LLCNT)+1
"RTN","PSJIBAG",92,0)
 I $G(PSJD2(55.0105,PSJBLN,1,"I"))]"" W ?66,$$ENDTC1^PSGMI($G(PSJD2(55.0105,PSJBLN,1,"I"))) S LLCNT=$G(LLCNT)+1
"RTN","PSJIBAG",93,0)
 W ! S LLCNT=$G(LLCNT)
"RTN","PSJIBAG",94,0)
 I $G(LLCNT)>40 D PAUSE W !! S LLCNT=2
"RTN","PSJIBAG",95,0)
 Q
"RTN","PSJIBAG",96,0)
PAUSE ;
"RTN","PSJIBAG",97,0)
 Q:'($E(IOST)="C")
"RTN","PSJIBAG",98,0)
 N DIR S DIR(0)="E" D ^DIR S:$D(DTOUT)!($D(DUOUT)) PSJDNE=1
"RTN","PSJIBAG",99,0)
 Q
"RTN","PSJIBAG",100,0)
H ;Header
"RTN","PSJIBAG",101,0)
 N I
"RTN","PSJIBAG",102,0)
 W !!,"LABEL LOG:",!!,"#",?3,"DATE/TIME",?18,"ACTION",?32,"USER",?47,"#LABELS",?60,"TRACK",?75,"COUNT",! F I=1:1:80 W "=" W:I=80 !
"RTN","PSJIBAG",103,0)
 Q
"RTN","PSJIBAG",104,0)
H2 ;Header for Unique ID #s
"RTN","PSJIBAG",105,0)
 W !,"Label Date/Time",?17,"Unique ID",?39,"Status",?51,"Count",?57,"BCMA Action-Date/Time"
"RTN","PSJIBAG",106,0)
 W !,"---------------",?17,"--------",?39,"---------",?51,"-----",?57,"-----------------------",!
"RTN","PSJIBAG",107,0)
 Q
"RTN","PSJIBAG",108,0)
DEV(DFN,ON55,INVDT) ;Device
"RTN","PSJIBAG",109,0)
 K %ZIS,IOP,POP,ZTSK,IO("Q") S PSJION=$I,%ZIS="QM"
"RTN","PSJIBAG",110,0)
 N ZTDESC,ZTRTN,ZTSAVE,G
"RTN","PSJIBAG",111,0)
 D ^%ZIS K %ZIS S PSJIPRNT=1,PSJIINV=""
"RTN","PSJIBAG",112,0)
 I POP S IOP=PSJION S %ZIS("A")="Select DEVICE:" D ^%ZIS K IOP,PSJION W !,"Please try later!" G EXIT
"RTN","PSJIBAG",113,0)
 K PSJION I $D(IO("Q")) D  G EXIT
"RTN","PSJIBAG",114,0)
 .S ZTDESC="Invalidated IV Labels Report",ZTRTN="EN2^PSJIBAG"
"RTN","PSJIBAG",115,0)
 .F G="DFN","ON55","PSJIPRNT","INVDT","PSJDOLJ" S:$D(@G) ZTSAVE(G)=""
"RTN","PSJIBAG",116,0)
 .K IO("Q") D ^%ZTLOAD W:$D(ZTSK) !,"Report is Queued to print!" K ZTSK
"RTN","PSJIBAG",117,0)
 D EN2 W ! D PAUSE^PSJLMUT1
"RTN","PSJIBAG",118,0)
EXIT ;
"RTN","PSJIBAG",119,0)
 W ! D ^%ZISC K DIR,DTOUT,DUOUT,DIROUT,DIRUT
"RTN","PSJIBAG",120,0)
 K ^TMP("PSBAR",$J)
"RTN","PSJIBAG",121,0)
 Q
"RTN","PSJIBAG",122,0)
UPD(DFN,ON,PSJINVDT,PSJINIV) ; Go through labels, invalidate each
"RTN","PSJIBAG",123,0)
 S ON=ON_"V"
"RTN","PSJIBAG",124,0)
 N PSJBLN S PSJBLN=0 F  S PSJBLN=$O(^TMP("PSJINBAG",$J,DFN,ON,PSJBLN)) Q:'PSJBLN  D
"RTN","PSJIBAG",125,0)
 .K DA,DR,DIQ,DIC,PSJD2 N IVALID,LBST,BCST
"RTN","PSJIBAG",126,0)
 .S DIC="^PS(55,"_DFN_",""IVBCMA"",",DA=PSJBLN,DR=".01;.02;1;2;3;4;5",DIQ="PSJD2",DIQ(0)="IE" D EN^DIQ1
"RTN","PSJIBAG",127,0)
 .Q:$P($G(^PS(55,DFN,"IVBCMA",+PSJBLN,0)),"^",9)
"RTN","PSJIBAG",128,0)
 .S BCST=$G(PSJD2(55.0105,PSJBLN,2,"E")) Q:(BCST="COMPLETED")!(BCST="GIVEN")
"RTN","PSJIBAG",129,0)
 .D UP1(DFN,ON,$P(PSJBLN,"V",2),PSJINVDT,.PSJINIV)
"RTN","PSJIBAG",130,0)
 S ^TMP("PSJINBAG",$J,DFN,ON)=PSJINVDT
"RTN","PSJIBAG",131,0)
 Q
"RTN","PSJIBAG",132,0)
UP1(DFN,ON,PSJBLN,PSJINVDT,PSJINIV) ; invalidate one label
"RTN","PSJIBAG",133,0)
 ;Input:  DFN     - patient's IEN
"RTN","PSJIBAG",134,0)
 ;        ON      - Order number for this bar code ID
"RTN","PSJIBAG",135,0)
 ;        PSJBLN  - Label index number from PS(55,DFN,"IVBCMA".
"RTN","PSJIBAG",136,0)
 ;        PSJINVDT- Invalidation Date
"RTN","PSJIBAG",137,0)
 ;
"RTN","PSJIBAG",138,0)
 Q:'$G(PSJBLN)!'$G(DFN)!'$G(ON)
"RTN","PSJIBAG",139,0)
 Q:'$G(^PS(55,DFN,"IVBCMA",+PSJBLN,0))
"RTN","PSJIBAG",140,0)
 N PSJBCID,NOW S PSJBCID=DFN_"V"_PSJBLN
"RTN","PSJIBAG",141,0)
 S DA(1)=DFN,X=PSJBCID,DIC="^PS(55,"_DA(1)_",""IVBCMA"","
"RTN","PSJIBAG",142,0)
 K DA,DR,DIE S DIE=DIC,DA=PSJBLN,DA(1)=DFN D NOW^%DTC S NOW=$S($G(PSJINVDT):PSJINVDT,1:%)
"RTN","PSJIBAG",143,0)
 S DR="9////"_+PSJINVDT D ^DIE
"RTN","PSJIBAG",144,0)
 K DIC,DIE,D0,DA,DR
"RTN","PSJIBAG",145,0)
 I '$G(PSJINIV) S PSJINIV=1
"RTN","PSJIBAG",146,0)
 Q
"RTN","PSJLIVFD")
0^21^B63427206^B54218075
"RTN","PSJLIVFD",1,0)
PSJLIVFD ;BIR/MV-SETUP LM TEMPLATE FOR IV FLUID ;4 Aug 00 / 2:37 PM
"RTN","PSJLIVFD",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**7,50,63,64,58,81,91,80,116,110,111,180,134,181,254,267,228,279**;16 DEC 97;Build 150
"RTN","PSJLIVFD",3,0)
 ;
"RTN","PSJLIVFD",4,0)
 ; Reference to ^VALM0 is supported by DBIA # 2615.
"RTN","PSJLIVFD",5,0)
 ; Referece to ^PS(53.47 is supported by DBIA # 5884
"RTN","PSJLIVFD",6,0)
 ;
"RTN","PSJLIVFD",7,0)
 ;NFI changes for FR# 3@AD+4
"RTN","PSJLIVFD",8,0)
 ;
"RTN","PSJLIVFD",9,0)
EN ; Build LM template to display IV order.
"RTN","PSJLIVFD",10,0)
 K ^TMP("PSJI",$J) N SCHMSG
"RTN","PSJLIVFD",11,0)
 S UL80="",$P(UL80,"=",80)=""
"RTN","PSJLIVFD",12,0)
 S PSJLN=1
"RTN","PSJLIVFD",13,0)
AD ;
"RTN","PSJLIVFD",14,0)
 NEW VALMEVL S VALMEVL=1
"RTN","PSJLIVFD",15,0)
 S PSJL="" D FLDNO^PSJLIUTL("(1)",1)
"RTN","PSJLIVFD",16,0)
 S PSJL=PSJL_"Additives:"
"RTN","PSJLIVFD",17,0)
 S:$G(P("PON"))["V"&(P(17)'="N") PSJL=$$SETSTR^VALM1("Order number:",PSJL,30,14)_+P("PON")
"RTN","PSJLIVFD",18,0)
 S PSJL=$$SETSTR^VALM1("Type:",PSJL,54,6)_$$TYPE^PSJLIUTL
"RTN","PSJLIVFD",19,0)
 NEW PSJVD S PSJVD=$$DINFLIV^PSJDIN(.DRG) S PSJVD=$TR(PSJVD," ")
"RTN","PSJLIVFD",20,0)
 I $D(^TMP("PSJINTER",$J))!$$OVRCHK^PSGSICH1(PSGP,$G(PSJORD)) S PSJVD=$S($G(PSJVD)["DIN":"<OCI><DIN>",1:"<OCI>")
"RTN","PSJLIVFD",21,0)
 S PSJL=$$SETSTR^VALM1(PSJVD,PSJL,(80-$L(PSJVD)),$L(PSJVD))
"RTN","PSJLIVFD",22,0)
 I $D(IORVON),($G(PSJVD)]"") D CNTRL^VALM10(1,(80-$L(PSJVD)),$L(PSJVD),IORVON,IORVOFF,0) K PSJVD
"RTN","PSJLIVFD",23,0)
 I '$D(IORVON),$D(IOST(0)) D ENS^%ZISS,TERM^VALM0
"RTN","PSJLIVFD",24,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",25,0)
 D:+$G(PSJLMX) CLRDSPL^PSJLIVMD
"RTN","PSJLIVFD",26,0)
 ;PSJLMX count number of lines needed to display the add/sol
"RTN","PSJLIVFD",27,0)
 S PSJLMX=0 D WRTDRG^PSJLIUTL("AD")
"RTN","PSJLIVFD",28,0)
SOL ;
"RTN","PSJLIVFD",29,0)
 S PSJL="" D FLDNO^PSJLIUTL("(2)",1)
"RTN","PSJLIVFD",30,0)
 S PSJL=PSJL_"Solutions:"
"RTN","PSJLIVFD",31,0)
 I P("SYRS")]"" D
"RTN","PSJLIVFD",32,0)
 . S PSJL=$$SETSTR^VALM1("Syr. Size:",PSJL,52,10)_$E(P("SYRS"),1,13)
"RTN","PSJLIVFD",33,0)
 . S:$L(P("SYRS"))>13 PSJL=PSJL_"..."
"RTN","PSJLIVFD",34,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",35,0)
 D WRTDRG^PSJLIUTL("SOL")
"RTN","PSJLIVFD",36,0)
DUR ;
"RTN","PSJLIVFD",37,0)
 S PSJL=""
"RTN","PSJLIVFD",38,0)
 N DUROUT,IVLIMIT S DUROUT=$$GETDUR^PSJLIVMD(PSGP,+PSJORD,$S(PSJORD["P":"P",1:"IV"))
"RTN","PSJLIVFD",39,0)
 I $G(PSJORD)["P" N ND25 S ND25=$G(^PS(53.1,+PSJORD,2.5)),IVLIMIT=$P(ND25,"^",4) D
"RTN","PSJLIVFD",40,0)
 .S IVLIMIT=$S(IVLIMIT]"":$$FMTDUR^PSJLIVMD(IVLIMIT),1:"") S:IVLIMIT]"" DUROUT=IVLIMIT
"RTN","PSJLIVFD",41,0)
 S LABEL=$S($G(IVLIMIT):"IV Limit: ",1:"Duration: ") K IVLIMIT
"RTN","PSJLIVFD",42,0)
 S PSJL=$$SETSTR^VALM1(LABEL,PSJL,12,10)
"RTN","PSJLIVFD",43,0)
 S PSJL=PSJL_DUROUT
"RTN","PSJLIVFD",44,0)
START ;
"RTN","PSJLIVFD",45,0)
 D FLDNO^PSJLIUTL("(4)",47)
"RTN","PSJLIVFD",46,0)
 S PSJL=$$SETSTR^VALM1("Start:",PSJL,56,7)_$$STARTDT^PSJLIUTL
"RTN","PSJLIVFD",47,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",48,0)
 NEW PSGRSD,PSGRSDN,PSGRFD,PSGRFDN
"RTN","PSJLIVFD",49,0)
 S PSJL="" I $G(PSJORD)["P",$G(PSGRDTX) D
"RTN","PSJLIVFD",50,0)
 . N RSDLABL,PSJRQB,PSJRQL,PSGRSD,PSGSRSDN
"RTN","PSJLIVFD",51,0)
 . S RSDLABL="     REQUESTED START: ",PSJRQB=41,PSJRQL=39,PSGRSD="",PSGRSDN=""
"RTN","PSJLIVFD",52,0)
 . I $G(PSGRDTX(+$G(PSJORD),"PSGRSD")),$G(P(2)) S PSJRQB=51,PSJRQL=29 D
"RTN","PSJLIVFD",53,0)
 .. S PSGRSD=PSGRDTX(+$G(PSJORD),"PSGRSD"),PSGRSDN=$$ENDTC^PSGMI(+PSGRSD),RSDLABL="Calc Start: "
"RTN","PSJLIVFD",54,0)
 . I '$G(P(2)),'$P(PSGRDTX,U,3) S PSGRSD=+PSGRDTX,PSGRSDN=$$ENDTC^PSGMI(PSGRSD)
"RTN","PSJLIVFD",55,0)
 . I $G(PSGRSD),($G(PSGRSDN)]"") D DSPLYDT^PSJLIVMD(PSJLMX+5,.PSGRSD,.PSGRSDN,RSDLABL,1,PSJRQB,PSJRQL),SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",56,0)
INFRATE ;
"RTN","PSJLIVFD",57,0)
 N INFLBL,INFLBL1,INFLBL2 S INFLBL="",INFLBL1="",$P(INFLBL2," ",20)=""
"RTN","PSJLIVFD",58,0)
 S PSJL="" D FLDNO^PSJLIUTL("(3)",1)
"RTN","PSJLIVFD",59,0)
 S PSJL=$$SETSTR^VALM1("Infusion Rate:",PSJL,7,15)
"RTN","PSJLIVFD",60,0)
 I ($G(P("NUMLBL"))?1.N) S INFLBL1=" ("_P("NUMLBL")_" label"_$S(P("NUMLBL")=1:"",1:"s")_" per day)" I $L(P(8))>13 S INFLBL1=$E(INFLBL2,1,(24-$L(P(8))))_INFLBL1
"RTN","PSJLIVFD",61,0)
 S INFLBL=$S('($G(P("NUMLBL"))?1.N):$P(P(8),"@"),1:$P(P(8),"@")_INFLBL1)
"RTN","PSJLIVFD",62,0)
 D LONG^PSJLIUTL(INFLBL,22,24)
"RTN","PSJLIVFD",63,0)
LASTREN ;
"RTN","PSJLIVFD",64,0)
 N PSGRNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,$S($G(PSJORD):PSJORD,1:$G(ON))) I PSGRNDT D
"RTN","PSJLIVFD",65,0)
 . S PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,54,32)
"RTN","PSJLIVFD",66,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",67,0)
MR ;
"RTN","PSJLIVFD",68,0)
 S PSJL="" D FLDNO^PSJLIUTL("(5)",1)
"RTN","PSJLIVFD",69,0)
 S PSJL=$$SETSTR^VALM1("Med Route:",PSJL,11,11)
"RTN","PSJLIVFD",70,0)
 S PSJL=PSJL_$P(P("MR"),U,2)
"RTN","PSJLIVFD",71,0)
STOP ;
"RTN","PSJLIVFD",72,0)
 D FLDNO^PSJLIUTL("(6)",47)
"RTN","PSJLIVFD",73,0)
 ;PSJ*5*180 - If Invalid Duration/Limit - Cannot Calculate Stop Date
"RTN","PSJLIVFD",74,0)
 S PSJL=$$SETSTR^VALM1("Stop:",PSJL,57,6)_$S($G(PSJBADD)=1:"CANNOT CALCULATE",1:$$STOPDT^PSJLIUTL)
"RTN","PSJLIVFD",75,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",76,0)
 S PSJL=""
"RTN","PSJLIVFD",77,0)
 N PSJBCMA S PSJBCMA=$$BCMALG^PSJUTL2(DFN,PSJORD)
"RTN","PSJLIVFD",78,0)
 I $G(PSJBCMA)]"" S PSJL=$$SETSTR^VALM1(PSJBCMA,PSJL,1,52)
"RTN","PSJLIVFD",79,0)
 I $G(PSGRDTX(+PSJORD,"PSGRFD")) S PSGRFD=PSGRDTX(+PSJORD,"PSGRFD"),PSGRFDN=$$ENDTC^PSGMI(PSGRFD) D
"RTN","PSJLIVFD",80,0)
 . D DSPLYDT^PSJLIVMD(PSJLMX+7,.PSGRFD,.PSGRFDN," Calc Stop: ",0,51,29)
"RTN","PSJLIVFD",81,0)
 D:($G(PSJBCMA)]"")!($G(PSGRFD)]"") SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",82,0)
SCH ;
"RTN","PSJLIVFD",83,0)
 S PSJL="" D FLDNO^PSJLIUTL("(7)",1)
"RTN","PSJLIVFD",84,0)
 S PSJL=$$SETSTR^VALM1("Schedule:",PSJL,12,11)
"RTN","PSJLIVFD",85,0)
 D LONG^PSJLIUTL(P(9)_$S(P(7):"@0 labels a day",1:"")_$G(SCHMSG),22,35)
"RTN","PSJLIVFD",86,0)
LASTFL ;
"RTN","PSJLIVFD",87,0)
 S PSJL=$$SETSTR^VALM1("Last Fill:",PSJL,52,11)
"RTN","PSJLIVFD",88,0)
 S PSJL=PSJL_$$ENDTC^PSGMI(P("LF"))
"RTN","PSJLIVFD",89,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",90,0)
ADM ;
"RTN","PSJLIVFD",91,0)
 S PSJL="" D FLDNO^PSJLIUTL("(8)",1)
"RTN","PSJLIVFD",92,0)
 S PSJL=$$SETSTR^VALM1("Admin Times:",PSJL,9,14)
"RTN","PSJLIVFD",93,0)
 D LONG^PSJLIUTL(P(11),22,30)
"RTN","PSJLIVFD",94,0)
QTY ;
"RTN","PSJLIVFD",95,0)
 S PSJL=$$SETSTR^VALM1("Quantity:",PSJL,53,10)_+P("LFA")
"RTN","PSJLIVFD",96,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",97,0)
PROVIDER ;
"RTN","PSJLIVFD",98,0)
 S PSJL="" D FLDNO^PSJLIUTL("(9)",1)
"RTN","PSJLIVFD",99,0)
 S PSJL=$$SETSTR^VALM1("Provider:",PSJL,12,10)_$$PROVIDER^PSJLIUTL
"RTN","PSJLIVFD",100,0)
CUMDOSES ;
"RTN","PSJLIVFD",101,0)
 S PSJL=$$SETSTR^VALM1("Cum. Doses:",PSJL,51,12)_P("CUM")
"RTN","PSJLIVFD",102,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",103,0)
OPI ;
"RTN","PSJLIVFD",104,0)
 N PSJOPILN,PSJOPCNT
"RTN","PSJLIVFD",105,0)
 S PSJL="" D FLDNO^PSJLIUTL("(10)",1)
"RTN","PSJLIVFD",106,0)
 I $G(PSIVBR)["PSIVVW" D
"RTN","PSJLIVFD",107,0)
 .S PSJOPILN=$$GETSIOPI^PSJBCMA5(DFN,PSJORD,1)
"RTN","PSJLIVFD",108,0)
 .I PSJOPILN=1,($TR($G(^TMP("PSJBCMA5",$J,DFN,PSJORD,1))," ")="") K ^TMP("PSJBCMA5",$J,DFN,PSJORD) S PSJOPILN=""
"RTN","PSJLIVFD",109,0)
 .S PSJL=$$SETSTR^VALM1("Other Print"_$S($P(P("OPI"),"^",2)=1:"!: ",1:": "),PSJL,9,13)
"RTN","PSJLIVFD",110,0)
 .S PSJL=PSJL_" "_$S(($G(PSJOPILN)>0):"(see below)",1:"")
"RTN","PSJLIVFD",111,0)
 .D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",112,0)
 .I (PSJOPILN>0) N PSJOPCNT S PSJOPCNT=0 F PSJOPCNT=1:1:PSJOPILN S PSJL="     "_$G(^TMP("PSJBCMA5",$J,DFN,PSJORD,PSJOPCNT)) D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",113,0)
 I $G(PSIVBR)'["PSIVVW" D
"RTN","PSJLIVFD",114,0)
 .I $G(ON55)["P",$G(PSJORD)["V",$P($G(^PS(53.1,+ON55,0)),"^",25)=PSJORD S PSJOPILN=$$GETSIOPI^PSJBCMA5(DFN,ON55)
"RTN","PSJLIVFD",115,0)
 .S PSJOPILN=$P($G(^PS(53.45,PSJSYSP,6,0)),"^",3) I 'PSJOPILN S PSJOPILN=$$GETSIOPI^PSJBCMA5(DFN,PSJORD)
"RTN","PSJLIVFD",116,0)
 .I PSJOPILN=1,($TR($G(^PS(53.45,PSJSYSP,6,1,0))," ")="") I '($G(^PS(53.45,PSJSYSP,6,0))<0) K ^PS(53.45,PSJSYSP,6) S PSJOPILN=""
"RTN","PSJLIVFD",117,0)
 .S PSJL=$$SETSTR^VALM1("Other Print"_$S($P(P("OPI"),"^",2)=1:"!: ",1:": "),PSJL,9,13)
"RTN","PSJLIVFD",118,0)
 .S PSJL=PSJL_$S((PSJOPILN>0)&'($G(^PS(53.45,PSJSYSP,6,0))<0):"(see below)",1:"")
"RTN","PSJLIVFD",119,0)
 .D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",120,0)
 .I PSJOPILN>0 N PSJOPCNT S PSJOPCNT=0 F PSJOPCNT=1:1:PSJOPILN S PSJL="     "_$G(^PS(53.45,PSJSYSP,6,PSJOPCNT,0)) D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",121,0)
 K PSJOPILN,PSJOPCNT K PSJOPILN,PSJOPCNT
"RTN","PSJLIVFD",122,0)
PC ;
"RTN","PSJLIVFD",123,0)
 S PSJL=""
"RTN","PSJLIVFD",124,0)
 S PSJL=$$SETSTR^VALM1("Provider Comments:",PSJL,3,18) D WTPC^PSJLIUTL
"RTN","PSJLIVFD",125,0)
REMARK ;
"RTN","PSJLIVFD",126,0)
 D SETTMP^PSJLMPRU("PSJI","")
"RTN","PSJLIVFD",127,0)
 S PSJL="" D FLDNO^PSJLIUTL("(11)",1)
"RTN","PSJLIVFD",128,0)
 S PSJL=$$SETSTR^VALM1("Remarks :",PSJL,8,10)
"RTN","PSJLIVFD",129,0)
 D LONG^PSJLIUTL(P("REM"),18,62)
"RTN","PSJLIVFD",130,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",131,0)
IVROOM ;
"RTN","PSJLIVFD",132,0)
 S PSJL=""
"RTN","PSJLIVFD",133,0)
 S PSJL=$$SETSTR^VALM1("IV Room:",PSJL,9,9)_$P(P("IVRM"),U,2)
"RTN","PSJLIVFD",134,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",135,0)
ENTRY ;
"RTN","PSJLIVFD",136,0)
 S PSJL="",PSJL=$$SETSTR^VALM1("Entry By:",PSJL,8,10)
"RTN","PSJLIVFD",137,0)
 S PSJL=PSJL_$S($P(P("CLRK"),U,2)]"":$E($P(P("CLRK"),U,2),1,18),1:"*** Undefined")
"RTN","PSJLIVFD",138,0)
 S PSJL=$$SETSTR^VALM1("Entry Date:",PSJL,51,12)_$$ENDTC^PSGMI(P("LOG"))
"RTN","PSJLIVFD",139,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",140,0)
 S PSJL="" S PSGLRN=$$LASTRNBY^PSJLMPRI(DFN,$S($G(PSJORD):PSJORD,1:$G(ON))) I PSGLRN D
"RTN","PSJLIVFD",141,0)
 . S PSJL=$$SETSTR^VALM1("Renewed By: ",PSJL,6,12)_$$ENNPN^PSGMI(PSGLRN) D SETTMP^PSJLMPRU("PSJI",PSJL) K PSGLRN
"RTN","PSJLIVFD",142,0)
 S VALM("TITLE")=$$CODES^PSIVUTL(P(17),$S($G(ON)["P":53.1,1:55.01),$S(ON["P":28,1:100))_" IV "
"RTN","PSJLIVFD",143,0)
 I $G(P("PRY"))="D"!($G(P("PON"))["P") S VALM("TITLE")=VALM("TITLE")_$S($G(P("PRY"))="":"",1:"("_$$CODES^PSIVUTL(P("PRY"),53.1,.24)_")")
"RTN","PSJLIVFD",144,0)
 I $G(P("PON"))["P" D ORDCHK
"RTN","PSJLIVFD",145,0)
 S VALMCNT=PSJLN-1,^TMP("PSJI",$J,0)=VALMCNT
"RTN","PSJLIVFD",146,0)
 Q
"RTN","PSJLIVFD",147,0)
 ;
"RTN","PSJLIVFD",148,0)
ORDCHK ;Display order check for pending order
"RTN","PSJLIVFD",149,0)
 Q:'$O(^PS(53.1,+ON,10,0))
"RTN","PSJLIVFD",150,0)
 NEW PSJIVX,PSJIVXX
"RTN","PSJLIVFD",151,0)
 F PSJIVX=0:0 S PSJIVX=$O(^PS(53.1,+ON,10,PSJIVX)) Q:'PSJIVX  D
"RTN","PSJLIVFD",152,0)
 . D SETTMP^PSJLMPRU("PSJI","")
"RTN","PSJLIVFD",153,0)
 . S PSJL="CPRS Order Checks  :" D LONG^PSJLIUTL($G(^PS(53.1,+ON,10,PSJIVX,0)),22,60)
"RTN","PSJLIVFD",154,0)
 . D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",155,0)
 . S PSJL="Overriding Provider: "_$P($G(^PS(53.1,+ON,10,PSJIVX,1)),U)
"RTN","PSJLIVFD",156,0)
 . D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",157,0)
 . S PSJL="Overriding Reason  : "
"RTN","PSJLIVFD",158,0)
 . F PSJIVXX=0:0 S PSJIVXX=$O(^PS(53.1,+ON,10,PSJIVX,2,PSJIVXX)) Q:'PSJIVXX  D
"RTN","PSJLIVFD",159,0)
 .. D LONG^PSJLIUTL($G(^PS(53.1,+ON,10,PSJIVX,2,PSJIVXX,0)),22,60)
"RTN","PSJLIVFD",160,0)
 .. D SETTMP^PSJLMPRU("PSJI",PSJL) S PSJL=""
"RTN","PSJLIVFD",161,0)
 Q
"RTN","PSJLIVFD",162,0)
 ;
"RTN","PSJLIVFD",163,0)
SCHREQ(IVAR) ; Intermittent IV's require a schedule
"RTN","PSJLIVFD",164,0)
 I $G(IVAR(4))="P"!($G(IVAR(23))="P")!($G(IVAR(5))) Q 1
"RTN","PSJLIVFD",165,0)
 Q 0
"RTN","PSJLIVFD",166,0)
 ;
"RTN","PSJLIVFD",167,0)
INFCHK(INFFULL,INFEXP) ; Parse and expand infusion rate
"RTN","PSJLIVFD",168,0)
 N WORD,I K INFEXP S INFEXP=""
"RTN","PSJLIVFD",169,0)
 F I=1:1:$L(INFFULL," ") S WORD=$P(INFFULL," ",I) D
"RTN","PSJLIVFD",170,0)
 .I I=1 S INFEXP=$$INFEXP(WORD) Q
"RTN","PSJLIVFD",171,0)
 .S INFEXP=INFEXP_" "_$$INFEXP(WORD)
"RTN","PSJLIVFD",172,0)
 Q
"RTN","PSJLIVFD",173,0)
INFEXP(INF) ; Expand Infusion Rate 
"RTN","PSJLIVFD",174,0)
 I $L(INF)<1!($L(INF)>30) Q INF
"RTN","PSJLIVFD",175,0)
 N INFIEN,ARRAY
"RTN","PSJLIVFD",176,0)
 S (INFIEN,ARRAY)=""
"RTN","PSJLIVFD",177,0)
 N X,Y,DIC,DR,DA,DIQ
"RTN","PSJLIVFD",178,0)
 S X=INF,DIC(0)="XO",DIC="^PS(53.47," D ^DIC I '($G(Y)>0) Q INF
"RTN","PSJLIVFD",179,0)
 S INFIEN=+$G(Y)
"RTN","PSJLIVFD",180,0)
 D GETS^DIQ(53.47,INFIEN_",",".01;1","E","ARRAY")
"RTN","PSJLIVFD",181,0)
 I $G(ARRAY("53.47",INFIEN_",","1","E"))]"" Q ARRAY("53.47",INFIEN_",","1","E")
"RTN","PSJLIVFD",182,0)
 Q INF
"RTN","PSJLIVMD")
0^32^B100202267^B96668523
"RTN","PSJLIVMD",1,0)
PSJLIVMD ;BIR/MV-SETUP LM TEMPLATE FOR INPT MED. IV ; 4/28/08 3:11pm
"RTN","PSJLIVMD",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**37,50,63,58,81,91,80,116,110,111,180,134,209,254,267,275,279**;16 DEC 97;Build 150
"RTN","PSJLIVMD",3,0)
 ;
"RTN","PSJLIVMD",4,0)
 ;Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJLIVMD",5,0)
 ;
"RTN","PSJLIVMD",6,0)
EN ; Build LM template to display IV order.
"RTN","PSJLIVMD",7,0)
 I $G(ON55),($G(P(1))=+$G(ON55)) S PSJORD=ON55
"RTN","PSJLIVMD",8,0)
 D GTOT^PSIVUTL(P(4))
"RTN","PSJLIVMD",9,0)
 S:'$D(PSJSTAR) PSJSTAR="" S:'$D(PSGP) PSGP=DFN
"RTN","PSJLIVMD",10,0)
 I $E(P("OT"))'="I" D EN^PSJLIVFD Q
"RTN","PSJLIVMD",11,0)
 K ^TMP("PSJI",$J)
"RTN","PSJLIVMD",12,0)
 S UL80="",$P(UL80,"=",80)=""
"RTN","PSJLIVMD",13,0)
 S PSJLN=1
"RTN","PSJLIVMD",14,0)
 I $G(PSIV531),P("PON")["P" S (P(2),P(3),P(4))=""
"RTN","PSJLIVMD",15,0)
AD ;
"RTN","PSJLIVMD",16,0)
 NEW VALMEVL S VALMEVL=1
"RTN","PSJLIVMD",17,0)
 S PSJL="" D FLDNO^PSJLIUTL("(1)",1)
"RTN","PSJLIVMD",18,0)
 S PSJL=PSJL_" Additives:"
"RTN","PSJLIVMD",19,0)
 S:$G(P("PON"))["V"&(P(17)'="N") PSJL=$$SETSTR^VALM1("Order number:",PSJL,28,14)_+P("PON")
"RTN","PSJLIVMD",20,0)
 S PSJL=$$SETSTR^VALM1("Type:",PSJL,54,6)_$$TYPE^PSJLIUTL
"RTN","PSJLIVMD",21,0)
 NEW PSJVD S PSJVD=$$DINFLIV^PSJDIN(.DRG) S PSJVD=$TR(PSJVD," ")
"RTN","PSJLIVMD",22,0)
 I $D(^TMP("PSJINTER",$J))!$$OVRCHK^PSGSICH1(PSGP,$G(PSJORD)) S PSJVD=$S($G(PSJVD)["DIN":"<OCI><DIN>",1:"<OCI>")
"RTN","PSJLIVMD",23,0)
 S PSJL=$$SETSTR^VALM1(PSJVD,PSJL,(80-$L(PSJVD)),$L(PSJVD))
"RTN","PSJLIVMD",24,0)
 I $D(IORVON),($G(PSJVD)]"") D CNTRL^VALM10(1,(80-$L(PSJVD)),$L(PSJVD),IORVON,IORVOFF,0) K PSJVD
"RTN","PSJLIVMD",25,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",26,0)
 D:+$G(PSJLMX) CLRDSPL
"RTN","PSJLIVMD",27,0)
 ;PSJLMX count number of lines needed to display the add/sol
"RTN","PSJLIVMD",28,0)
 S PSJLMX=0 D WRTDRG^PSJLIUTL("AD")
"RTN","PSJLIVMD",29,0)
SOL ;
"RTN","PSJLIVMD",30,0)
 S PSJL="" D FLDNO^PSJLIUTL("(2)",1)
"RTN","PSJLIVMD",31,0)
 S PSJL=PSJL_" Solutions:"
"RTN","PSJLIVMD",32,0)
 I P("SYRS")]"" D
"RTN","PSJLIVMD",33,0)
 . S PSJL=$$SETSTR^VALM1("Syr. Size:",PSJL,52,11)_$E(P("SYRS"),1,13)
"RTN","PSJLIVMD",34,0)
 . S:$L(P("SYRS"))>13 PSJL=PSJL_"..."
"RTN","PSJLIVMD",35,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",36,0)
 D WRTDRG^PSJLIUTL("SOL")
"RTN","PSJLIVMD",37,0)
 D DUR
"RTN","PSJLIVMD",38,0)
START ;
"RTN","PSJLIVMD",39,0)
 NEW PSGRSD,PSGRSDN,PSGRFD,PSGRFDN
"RTN","PSJLIVMD",40,0)
 I $G(P("OT"))="I",$G(P(4))]"" D
"RTN","PSJLIVMD",41,0)
 .I '$D(PSJSYSW0)!($$CLINIC^PSJO1($G(DFN),$G(ON))]"") N PSJSYSW0 S PSJSYSW0=$G(PSJSYSW0)
"RTN","PSJLIVMD",42,0)
 .Q:$G(ON)["V"  I $G(PSIVAC)="" N PSIVAC S PSIVAC="CF"
"RTN","PSJLIVMD",43,0)
 .Q:$G(P(3))
"RTN","PSJLIVMD",44,0)
 .D ENT^PSIVCAL,ENSTOP^PSIVCAL
"RTN","PSJLIVMD",45,0)
 D REQDT(ON)
"RTN","PSJLIVMD",46,0)
 D FLDNO^PSJLIUTL("(4)",47)
"RTN","PSJLIVMD",47,0)
 S PSJL=$$SETSTR^VALM1("Start:",PSJL,56,7)_$$STARTDT^PSJLIUTL
"RTN","PSJLIVMD",48,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",49,0)
INFRATE ;
"RTN","PSJLIVMD",50,0)
 N INFLBL,INFLBL1,INFLBL2 S INFLBL="",INFLBL1="",$P(INFLBL2," ",20)=""
"RTN","PSJLIVMD",51,0)
 S PSJL="" D FLDNO^PSJLIUTL("(3)",1)
"RTN","PSJLIVMD",52,0)
 S PSJL=$$SETSTR^VALM1("Infusion Rate:",PSJL,7,15)
"RTN","PSJLIVMD",53,0)
 I ($G(P("NUMLBL"))?1.N) S INFLBL1=" ("_P("NUMLBL")_" label"_$S(P("NUMLBL")=1:"",1:"s")_" per day)" I $L(P(8))>13 S INFLBL1=$E(INFLBL2,1,(24-$L(P(8))))_INFLBL1
"RTN","PSJLIVMD",54,0)
 S INFLBL=$S('($G(P("NUMLBL"))?1.N):$P(P(8),"@"),1:$P(P(8),"@")_INFLBL1)
"RTN","PSJLIVMD",55,0)
 D LONG^PSJLIUTL(INFLBL,22,23)
"RTN","PSJLIVMD",56,0)
RSTART ;
"RTN","PSJLIVMD",57,0)
 I $G(ON)["P" N PSGNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,ON) D
"RTN","PSJLIVMD",58,0)
 . I PSGRNDT S PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,54,32) Q
"RTN","PSJLIVMD",59,0)
 . Q:'$G(PSGRDTX)  N PSJRQB,PSJRQL,RSDLABL,PSGRSD,PSGRSDN
"RTN","PSJLIVMD",60,0)
 . S RSDLABL="     REQUESTED START: ",PSJRQB=41,PSJRQL=39,PSGRSD="",PSGRSDN=""
"RTN","PSJLIVMD",61,0)
 . I $G(PSGRDTX(+$G(PSJORD),"PSGRSD")),$G(P(2)) S PSJRQB=51,PSJRQL=29 D
"RTN","PSJLIVMD",62,0)
 .. S PSGRSD=PSGRDTX(+$G(PSJORD),"PSGRSD"),PSGRSDN=$$ENDTC^PSGMI(+PSGRSD),RSDLABL="Calc Start: "
"RTN","PSJLIVMD",63,0)
 . I '$G(P(2)),'$P(PSGRDTX,U,3) S PSGRSD=+PSGRDTX,PSGRSDN=$$ENDTC^PSGMI(PSGRSD)
"RTN","PSJLIVMD",64,0)
 . I $G(PSGRSD),($G(PSGRSDN)]"") D DSPLYDT(PSJLMX+5,.PSGRSD,.PSGRSDN,RSDLABL,1,PSJRQB,PSJRQL)  ;,SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",65,0)
 I $G(ON)["V" N PSGRNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,ON) I PSGRNDT S PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,54,32)
"RTN","PSJLIVMD",66,0)
 I PSJL]"" D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",67,0)
 ;
"RTN","PSJLIVMD",68,0)
MR ;
"RTN","PSJLIVMD",69,0)
 S PSJL="" D FLDNO^PSJLIUTL("(5)",1)
"RTN","PSJLIVMD",70,0)
 S PSJL=$$SETSTR^VALM1("Med Route:",PSJL,11,11)
"RTN","PSJLIVMD",71,0)
 S PSJL=PSJL_$P(P("MR"),U,2)
"RTN","PSJLIVMD",72,0)
STOP ;
"RTN","PSJLIVMD",73,0)
 S:'$D(PSGP) PSGP=DFN
"RTN","PSJLIVMD",74,0)
 D FLDNO^PSJLIUTL("(6)",47)
"RTN","PSJLIVMD",75,0)
 ;PSJ*5*180 - If CPRS sends invalid duration/limit - Cannot Calculate Stop Date.
"RTN","PSJLIVMD",76,0)
 S PSJL=$$SETSTR^VALM1("Stop:",PSJL,57,6)_$S($G(PSJBADD)=1:"CANNOT CALCULATE",1:$$STOPDT^PSJLIUTL)
"RTN","PSJLIVMD",77,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",78,0)
 S PSJL=""
"RTN","PSJLIVMD",79,0)
 N PSJBCMA S PSJBCMA=$$BCMALG^PSJUTL2(PSGP,PSJORD)
"RTN","PSJLIVMD",80,0)
 I $G(PSJBCMA)]"",$G(DFN) S PSJL=$$SETSTR^VALM1(PSJBCMA,PSJL,1,52)
"RTN","PSJLIVMD",81,0)
 I $G(PSJORD)["P",$G(PSGRDTX(+$G(PSJORD),"PSGRFD")),$G(P(3)) S PSGRFDN=$$ENDTC^PSGMI(PSGRDTX(+PSJORD,"PSGRFD")) D
"RTN","PSJLIVMD",82,0)
 . D DSPLYDT(PSJLMX+7,.PSGRFD,.PSGRFDN," Calc Stop: ",1,51,29)
"RTN","PSJLIVMD",83,0)
 I ($G(PSJBCMA)]"")!($G(PSGRDTX(+$G(PSJORD),"PSGRFD"))&$G(P(3))) D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",84,0)
SCH ;
"RTN","PSJLIVMD",85,0)
 S PSJL="" D FLDNO^PSJLIUTL("(7)",1)
"RTN","PSJLIVMD",86,0)
 S PSJL=$$SETSTR^VALM1("Schedule:",PSJL,12,11)
"RTN","PSJLIVMD",87,0)
 D LONG^PSJLIUTL(P(9)_$S(P(7):"@0 labels a day",1:"")_$G(SCHMSG),22,31)
"RTN","PSJLIVMD",88,0)
LASTFL ;
"RTN","PSJLIVMD",89,0)
 S PSJL=$$SETSTR^VALM1("Last Fill:",PSJL,52,11)
"RTN","PSJLIVMD",90,0)
 S PSJL=PSJL_$$ENDTC^PSGMI(P("LF"))
"RTN","PSJLIVMD",91,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",92,0)
ADM ;
"RTN","PSJLIVMD",93,0)
 S PSJL="" D FLDNO^PSJLIUTL("(8)",1)
"RTN","PSJLIVMD",94,0)
 S PSJL=$$SETSTR^VALM1("Admin Times:",PSJL,9,14)
"RTN","PSJLIVMD",95,0)
 NEW NOECH
"RTN","PSJLIVMD",96,0)
 D LONG^PSJLIUTL(P(11),22,29)
"RTN","PSJLIVMD",97,0)
QTY ;
"RTN","PSJLIVMD",98,0)
 S PSJL=$$SETSTR^VALM1("Quantity:",PSJL,53,10)_+P("LFA")
"RTN","PSJLIVMD",99,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",100,0)
PROVIDER ;
"RTN","PSJLIVMD",101,0)
 S PSJL="" D FLDNO^PSJLIUTL("(9)",1)
"RTN","PSJLIVMD",102,0)
 S PSJL=$$SETSTR^VALM1("Provider:",PSJL,12,10)_$$PROVIDER^PSJLIUTL
"RTN","PSJLIVMD",103,0)
CUMDOSES ;
"RTN","PSJLIVMD",104,0)
 S PSJL=$$SETSTR^VALM1("Cum. Doses:",PSJL,51,12)_P("CUM")
"RTN","PSJLIVMD",105,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",106,0)
OI ;
"RTN","PSJLIVMD",107,0)
 S PSJL="" D FLDNO^PSJLIUTL("(10)",1)
"RTN","PSJLIVMD",108,0)
 S PSJL=$$SETSTR^VALM1("Orderable Item:",PSJL,6,16)_$P(P("PD"),U,2)_$$OINF^PSJDIN(+P("PD"))
"RTN","PSJLIVMD",109,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",110,0)
INS ;
"RTN","PSJLIVMD",111,0)
 S PSJL=""
"RTN","PSJLIVMD",112,0)
 S PSJL=$$SETSTR^VALM1("Instructions:",PSJL,8,14)
"RTN","PSJLIVMD",113,0)
 D LONG^PSJLIUTL(P("INS"),22,58)
"RTN","PSJLIVMD",114,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",115,0)
OPI ;
"RTN","PSJLIVMD",116,0)
 S PSJL="" D FLDNO^PSJLIUTL("(11)",1)
"RTN","PSJLIVMD",117,0)
 I $G(PSIVBR)["PSIVVW" D
"RTN","PSJLIVMD",118,0)
 .S PSJOPILN=$$GETSIOPI^PSJBCMA5(DFN,PSJORD,1)
"RTN","PSJLIVMD",119,0)
 .I PSJOPILN=1,($TR($G(^TMP("PSJBCMA5",$J,DFN,PSJORD,1))," ")="") K ^TMP("PSJBCMA5",$J,DFN,PSJORD) S PSJOPILN="" Q
"RTN","PSJLIVMD",120,0)
 .S PSJL=$$SETSTR^VALM1("Other Print"_$S($P(P("OPI"),"^",2)=1:"!: ",1:": "),PSJL,9,13)
"RTN","PSJLIVMD",121,0)
 .S PSJL=PSJL_" "_$S(($G(PSJOPILN)>0):"(see below)",1:"")
"RTN","PSJLIVMD",122,0)
 .D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",123,0)
 .I (PSJOPILN>0) N PSJOPCNT S PSJOPCNT=0 F PSJOPCNT=1:1:PSJOPILN S PSJL="     "_$G(^TMP("PSJBCMA5",$J,DFN,PSJORD,PSJOPCNT)) D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",124,0)
 I $G(PSIVBR)'["PSIVVW" D
"RTN","PSJLIVMD",125,0)
 .I $G(ON55)["P",$G(PSJORD)["V",$P($G(^PS(53.1,+ON55,0)),"^",25)=PSJORD S PSJOPILN=$$GETSIOPI^PSJBCMA5(DFN,ON55)
"RTN","PSJLIVMD",126,0)
 .S PSJOPILN=$O(^PS(53.45,$G(PSJSYSP),6,""),-1) I 'PSJOPILN S PSJOPILN=$$GETSIOPI^PSJBCMA5(DFN,PSJORD)
"RTN","PSJLIVMD",127,0)
 .I PSJOPILN=1,($TR($G(^PS(53.45,PSJSYSP,6,1,0))," ")="") I '($G(^PS(53.45,PSJSYSP,6,0))<0)  K ^PS(53.45,PSJSYSP,6) S PSJOPILN="" Q
"RTN","PSJLIVMD",128,0)
 .I PSJOPILN=1,$G(^PS(53.45,PSJSYSP,6,1,0))["Instructions too long. See Order View or BCMA for full text." K ^PS(53.45,PSJSYSP,6) S PSJOPILN="" Q
"RTN","PSJLIVMD",129,0)
 .S PSJL=$$SETSTR^VALM1("Other Print"_$S($P(P("OPI"),"^",2)=1:"!: ",1:": "),PSJL,9,13)
"RTN","PSJLIVMD",130,0)
 .S PSJL=PSJL_" "_$S(($G(PSJOPILN)>0)&'($G(^PS(53.45,PSJSYSP,6,0))<0):"(see below)",1:"")
"RTN","PSJLIVMD",131,0)
 .D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",132,0)
 .I (PSJOPILN>0) N PSJOPCNT S PSJOPCNT=0 F PSJOPCNT=1:1:PSJOPILN S PSJL="     "_$G(^PS(53.45,DUZ,6,PSJOPCNT,0)) D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",133,0)
 K PSJOPILN,PSJOPCNT
"RTN","PSJLIVMD",134,0)
PC ;
"RTN","PSJLIVMD",135,0)
 S PSJL=""
"RTN","PSJLIVMD",136,0)
 S PSJL=$$SETSTR^VALM1("Provider Comments:",PSJL,3,18) D WTPC^PSJLIUTL
"RTN","PSJLIVMD",137,0)
REMARK ;
"RTN","PSJLIVMD",138,0)
 D SETTMP^PSJLMPRU("PSJI","")
"RTN","PSJLIVMD",139,0)
 S PSJL="" D FLDNO^PSJLIUTL("(12)",1)
"RTN","PSJLIVMD",140,0)
 S PSJL=$$SETSTR^VALM1("Remarks :",PSJL,8,10)
"RTN","PSJLIVMD",141,0)
 D LONG^PSJLIUTL(P("REM"),18,62)
"RTN","PSJLIVMD",142,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",143,0)
IVROOM ;
"RTN","PSJLIVMD",144,0)
 S PSJL=""
"RTN","PSJLIVMD",145,0)
 S PSJL=$$SETSTR^VALM1("IV Room:",PSJL,9,9)_$P(P("IVRM"),U,2)
"RTN","PSJLIVMD",146,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",147,0)
ENTRY ;
"RTN","PSJLIVMD",148,0)
 S PSJL="",PSJL=$$SETSTR^VALM1("Entry By:",PSJL,8,10)
"RTN","PSJLIVMD",149,0)
 S PSJL=PSJL_$S($P(P("CLRK"),U,2)]"":$E($P(P("CLRK"),U,2),1,24),1:"*** Undefined")
"RTN","PSJLIVMD",150,0)
 S PSJL=$$SETSTR^VALM1("Entry Date:",PSJL,51,12)_$$ENDTC^PSGMI(P("LOG"))
"RTN","PSJLIVMD",151,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",152,0)
 S PSJL="" S PSGLRN=$$LASTRNBY^PSJLMPRI(DFN,$S($G(PSJORD):PSJORD,1:$G(ON))) I PSGLRN D
"RTN","PSJLIVMD",153,0)
 . S PSJL=$$SETSTR^VALM1("Renewed By: ",PSJL,6,12)_$$ENNPN^PSGMI(PSGLRN) D SETTMP^PSJLMPRU("PSJI",PSJL) K PSGLRN
"RTN","PSJLIVMD",154,0)
 S VALM("TITLE")=$$CODES^PSIVUTL(P(17),$S($G(ON)["P":53.1,1:55.01),$S($G(ON)["P":28,1:100))_" IV "
"RTN","PSJLIVMD",155,0)
 I $G(P("PRY"))="D"!($G(P("PON"))["P") S VALM("TITLE")=VALM("TITLE")_$S($G(P("PRY"))="":"",1:"("_$$CODES^PSIVUTL(P("PRY"),53.1,.24)_")")
"RTN","PSJLIVMD",156,0)
 I $G(P("PON"))["P" D ORDCHK^PSJLIVFD
"RTN","PSJLIVMD",157,0)
 S VALMCNT=PSJLN-1,^TMP("PSJI",$J,0)=VALMCNT
"RTN","PSJLIVMD",158,0)
 Q
"RTN","PSJLIVMD",159,0)
DSPLYDT(PSJLN,PSGRDT,PSGRDTN,TXT,PSJFSH,PSJRDBEG,PSJRDLEN)  ;
"RTN","PSJLIVMD",160,0)
 ;LINE   : Line number the Requested Start and Stop dates are display in
"RTN","PSJLIVMD",161,0)
 ;PSGRDT : Either it is the requested start or stop date in FM format
"RTN","PSJLIVMD",162,0)
 ;PSGRDTN: Either it is the requested start or stop date in IPM format
"RTN","PSJLIVMD",163,0)
 ;TXT    : The display text
"RTN","PSJLIVMD",164,0)
 ;PSJFSH     : if it is 1 then flash
"RTN","PSJLIVMD",165,0)
 ;
"RTN","PSJLIVMD",166,0)
 S:'$G(PSJRDBEG) PSJRDBEG=41,PSJRDLEN=39
"RTN","PSJLIVMD",167,0)
 S PSJL=$$SETSTR^VALM1(TXT_PSGRDTN,PSJL,PSJRDBEG,PSJRDLEN)
"RTN","PSJLIVMD",168,0)
 Q
"RTN","PSJLIVMD",169,0)
CLRDSPL ;
"RTN","PSJLIVMD",170,0)
 ;Clear the blinking after edit the pending order.
"RTN","PSJLIVMD",171,0)
 ;Without it more than the requested start and stop dates are blinking at the ac/edit screen
"RTN","PSJLIVMD",172,0)
 ;PSJLMX: # ad/sol counted in WRTDRG^PSJLIUTL
"RTN","PSJLIVMD",173,0)
 Q:'$D(IOBOFF)
"RTN","PSJLIVMD",174,0)
 NEW PSJX
"RTN","PSJLIVMD",175,0)
 F PSJX=5:1:PSJLMX+7 D CNTRL^VALM10(PSJX,36,80,IOBOFF,IOINORM)
"RTN","PSJLIVMD",176,0)
 Q
"RTN","PSJLIVMD",177,0)
REQDT(ORDER)       ;Get requested date if it is a pending order
"RTN","PSJLIVMD",178,0)
 ;ORDER  : Pending Order Number (PSJORD or PSGORD)
"RTN","PSJLIVMD",179,0)
 Q:ORDER'["P"  D REQDT^PSJLIUTL(ORDER)
"RTN","PSJLIVMD",180,0)
 Q
"RTN","PSJLIVMD",181,0)
 ;
"RTN","PSJLIVMD",182,0)
GETDUR(PAT,ORD,PKG,RAW) ;
"RTN","PSJLIVMD",183,0)
 ; PAT= Patient DFN
"RTN","PSJLIVMD",184,0)
 ; ORD= Order #
"RTN","PSJLIVMD",185,0)
 ; PKG= 5(UD), "IV"(IV), "P"(Pending)
"RTN","PSJLIVMD",186,0)
 N ACT,DUR,ND,ND25,F25,ND0,ND2,OLDORD S DUR="",ORD=+ORD K IVLIMIT
"RTN","PSJLIVMD",187,0)
 S:PKG="V" PKG="IV"
"RTN","PSJLIVMD",188,0)
 I PKG="P" S ND=$G(^PS(53.1,+ORD,0)) D  I '$G(OLDORD) Q DUR
"RTN","PSJLIVMD",189,0)
 . I $G(P("OVRIDE")) S DUR="" Q
"RTN","PSJLIVMD",190,0)
 . D PENDING(ORD) Q:DUR]""
"RTN","PSJLIVMD",191,0)
 . S ND0=$G(^PS(53.1,ORD,0)) I $P(ND0,U,24)="E" S OLDORD=$P(ND0,U,25) I OLDORD S PKG=$S(OLDORD["V":"IV",OLDORD["U":5,OLDORD["P":"P",1:"")
"RTN","PSJLIVMD",192,0)
 . Q:($G(OLDORD)'["P")
"RTN","PSJLIVMD",193,0)
 . D PENDING(OLDORD) S OLDORD=""
"RTN","PSJLIVMD",194,0)
 I PKG="IV" S ND2=$G(^PS(55,PAT,PKG,ORD,2)) I $P(ND2,U,8)="E" S OLDORD=$P(ND2,U,5) S:OLDORD'["V" OLDORD="" I OLDORD D
"RTN","PSJLIVMD",195,0)
 .N ACTND S ACTND=0 F  S ACTND=$O(^PS(55,PAT,"IV",ORD,"A",ACTND)) Q:'ACTND  D
"RTN","PSJLIVMD",196,0)
 ..I $G(^PS(55,PAT,"IV",ORD,"A",ACTND,0))["IV LIMIT OVERRIDDEN" S OLDORD=""
"RTN","PSJLIVMD",197,0)
 I $G(P("LIMIT"))]"" S DUR=P("LIMIT"),IVLIMIT=1 I '$G(RAW) S DUR=$$FMTDUR(DUR) Q DUR
"RTN","PSJLIVMD",198,0)
 I PKG=5 S ND0=$G(^PS(55,PAT,PKG,ORD,0)) I $P(ND0,U,24)="E" S OLDORD=$P(ND0,U,25) S:OLDORD'["U" OLDORD=""
"RTN","PSJLIVMD",199,0)
 S F25="^PS(55,PAT,PKG,ORD,2.5)" I '$G(OLDORD) Q:'$D(@(F25)) DUR
"RTN","PSJLIVMD",200,0)
 S ND25=$G(@(F25)) S DUR=$P(ND25,U,2) I DUR="" S DUR=$P(ND25,U,4) I DUR]"" S IVLIMIT=1
"RTN","PSJLIVMD",201,0)
 ;PSJ*5*209 stop forcing null duration to previous.
"RTN","PSJLIVMD",202,0)
 ;I DUR="",$G(OLDORD) S ORD=+OLDORD Q:'$D(@(F25)) DUR  D
"RTN","PSJLIVMD",203,0)
 ;. S ND25=$G(@(F25)) S DUR=$P(ND25,U,2) I DUR="" S DUR=$P(ND25,U,4) I DUR]"" S IVLIMIT=1
"RTN","PSJLIVMD",204,0)
 I '$G(RAW),DUR]"" S DUR=$$FMTDUR(DUR)
"RTN","PSJLIVMD",205,0)
 Q DUR
"RTN","PSJLIVMD",206,0)
 ;
"RTN","PSJLIVMD",207,0)
PENDING(PNDON) ;
"RTN","PSJLIVMD",208,0)
 S ND=$G(^PS(53.1,+ORD,0))
"RTN","PSJLIVMD",209,0)
 I ND S ND25=$S(($P(ND,U,15)=PAT):$G(^PS(53.1,+ORD,2.5)),1:"")
"RTN","PSJLIVMD",210,0)
 S DUR=$P(ND25,U,4) I DUR]"" D  Q
"RTN","PSJLIVMD",211,0)
 .S:($E(DUR)="s")!($E(DUR)="m")!($E(DUR)="l")!($E(DUR)="d")!($E(DUR)="h")!($E(DUR)="a") IVLIMIT=1 S DUR=$S($G(RAW):DUR,1:$$FMTDUR(DUR))
"RTN","PSJLIVMD",212,0)
 S DUR=$P(ND25,U,2) I DUR]"" S DUR=$S($G(RAW):DUR,1:$$FMTDUR(DUR))
"RTN","PSJLIVMD",213,0)
 Q
"RTN","PSJLIVMD",214,0)
 ;
"RTN","PSJLIVMD",215,0)
FMTDUR(DURCODE) ;
"RTN","PSJLIVMD",216,0)
 N DUNIT,DNUM,BAD S BAD=0
"RTN","PSJLIVMD",217,0)
 ;PSJ*5*180 - Add PSJBADD variable
"RTN","PSJLIVMD",218,0)
 K PSJBADD S PSJBADD=0
"RTN","PSJLIVMD",219,0)
 S DUNIT=$E(DURCODE),DNUM=$P(DURCODE,DUNIT,2) I 'DNUM S BAD=1
"RTN","PSJLIVMD",220,0)
 I DUNIT'="",DUNIT'?1(1U,1L) S PSJBADD=1
"RTN","PSJLIVMD",221,0)
 S DUNIT=$S(DUNIT="D"!(DUNIT="d"):" day",DUNIT="H"!(DUNIT="h"):" hour",DUNIT="W":" week",DUNIT="L":" month",DUNIT="M":" minute",DUNIT="S":" second",DUNIT="m":" ml",DUNIT="l":" liter",DUNIT="a":" dose",1:"")
"RTN","PSJLIVMD",222,0)
 S:DUNIT="" BAD=1 I (DNUM'=1),(DUNIT'["ml") S DUNIT=DUNIT_"s"
"RTN","PSJLIVMD",223,0)
 I PSJBADD=1 S PSGACT=$TR($G(PSGACT),"F")
"RTN","PSJLIVMD",224,0)
 Q $S(PSJBADD=1:"*INVALID DURATION/LIMIT*",BAD:"",1:DNUM_DUNIT)
"RTN","PSJLIVMD",225,0)
 ;
"RTN","PSJLIVMD",226,0)
DURMIN(DCOD) ;
"RTN","PSJLIVMD",227,0)
 N DUR,DMIN,CHR S DUR="" F I=1:1:$L(DCOD) S CHR=$E(DCOD,I) I CHR?1N S DUR=DUR_CHR
"RTN","PSJLIVMD",228,0)
 S DMIN=DUR*$S(DCOD["L":43200,DCOD["W":10080,DCOD["M":1,DCOD["S":(1/60),DCOD["D":1440,1:0) S DMIN=+$FN(DMIN,"",1)
"RTN","PSJLIVMD",229,0)
 Q DMIN
"RTN","PSJLIVMD",230,0)
 ;
"RTN","PSJLIVMD",231,0)
DUR ;
"RTN","PSJLIVMD",232,0)
 N DUROUT,LABEL,IVLIMIT
"RTN","PSJLIVMD",233,0)
 Q:'$G(PSJORD)  S PSJL=""
"RTN","PSJLIVMD",234,0)
 S DUROUT=$$GETDUR^PSJLIVMD(PSGP,+PSJORD,$S(PSJORD["P":"P",1:"IV"))
"RTN","PSJLIVMD",235,0)
 S LABEL=$S($G(IVLIMIT):"IV Limit: ",1:"Duration: ") K IVLIMIT
"RTN","PSJLIVMD",236,0)
 S PSJL=$$SETSTR^VALM1(LABEL,PSJL,12,10)
"RTN","PSJLIVMD",237,0)
 S PSJL=PSJL_DUROUT
"RTN","PSJLIVMD",238,0)
 Q
"RTN","PSJP")
0^50^B28361612^B26835871
"RTN","PSJP",1,0)
PSJP ;BIR/CML3-INPATIENT LOOK-UP ; 15 Apr 98 / 9:05 AM
"RTN","PSJP",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**10,53,60,181,273,267,275,279**;16 DEC 97;Build 150
"RTN","PSJP",3,0)
 ;
"RTN","PSJP",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSJP",5,0)
 ; Reference to ^PS(59.7 is supported by DBIA 2181
"RTN","PSJP",6,0)
 ; Reference to ^%ZIS is supported by DBIA 10086
"RTN","PSJP",7,0)
 ; Reference to ^DICN is supported by DBIA 10009
"RTN","PSJP",8,0)
 ; Reference to ^DIR is supported by DBIA 10026
"RTN","PSJP",9,0)
 ; Reference to ^VADPT is supported by DBIA 10061
"RTN","PSJP",10,0)
 ;
"RTN","PSJP",11,0)
ENDPT ; get any patient
"RTN","PSJP",12,0)
 K DIC,PSGP,Y W !!,"Select "_$S($D(PSGDICA):PSGDICA_" ",1:"")_"PATIENT: " R X:DTIME S:'$T X="^" W:'$T $C(7) I "^"[X S (Y,PSGP)=-1 S QFLG=1 G DONE
"RTN","PSJP",13,0)
 D EN^PSJDPT
"RTN","PSJP",14,0)
 I Y'>0 G ENDPT
"RTN","PSJP",15,0)
 K DIC
"RTN","PSJP",16,0)
 ;
"RTN","PSJP",17,0)
CHK ;
"RTN","PSJP",18,0)
 ;Clean out arrays use in order checks
"RTN","PSJP",19,0)
 K PSJEXCPT,PSJOCER
"RTN","PSJP",20,0)
 S (DFN,PSGP)=+Y,VA200=1 D INP^VADPT
"RTN","PSJP",21,0)
 I 'VAIN(4) D DEM^VADPT S PSGP(0)=VADM(1),PSJPWD="",PSJPWDN=""
"RTN","PSJP",22,0)
 I VAIN(4),$G(PSJCLOR) W $C(7),!!?3,"PATIENT IS CURRENTLY ADMITTED TO ",$P(VAIN(4),"^",2) S PSJPDD=""
"RTN","PSJP",23,0)
 I VAIN(4) S PSJPCAF=1_"^"_VAIN(1),PSJPWD=+VAIN(4),PSJPWDN=$P(VAIN(4),"^",2),PSJPTS=+VAIN(3),PSJPTSP=+VAIN(2),PSJPRB=VAIN(5),PSJPAD=+VAIN(7),PSJPDX=VAIN(9),PSJPTD=$S($D(^PS(55,PSGP,5.1)):$P(^(5.1),"^",4),1:""),PSJPDD="" G CNV
"RTN","PSJP",24,0)
 S PSJPCAF="",VAIP("D")="L" D IN5^VADPT
"RTN","PSJP",25,0)
 I 'VAIP(13,1),'$G(PSJCLOR) W $C(7),!!?3,"PATIENT HAS NEVER BEEN ADMITTED." D ENCONT G:%'=1 ENDPT S PSJPDD=""
"RTN","PSJP",26,0)
 ;*273 - Recognize patient death not from discharge
"RTN","PSJP",27,0)
 D DEM^VADPT
"RTN","PSJP",28,0)
 S PSGID=$S($G(VADM(6))]"":+VADM(6),1:+VAIP(3)),X=+VAIP(4)=12!(+VAIP(4)=38)!($G(VADM(6))),PSGOD=$$ENDTC^PSGMI(PSGID)
"RTN","PSJP",29,0)
 I $S(X:1,1:VAIP(13,1))  Q:($G(PSJCLOR)&'(X))  W $C(7),!!?3,"PATIENT IS FOUND TO BE ",$P("DISCHARGED^DECEASED","^",X+1)," AS OF ",PSGOD,"." S PSJH=$S(X:2,1:3),PSJPDD=PSGID_"^"_PSGOD S:X PSJPDD=PSJPDD_"^1" D ENCONT G:%'=1 ENDPT
"RTN","PSJP",30,0)
 S PSJPAD=VAIP(13,1),PSJPWD=+VAIP(5),PSJPWDN=$P(VAIP(5),"^",2),PSJPRB=$P(VAIP(6),"^",2),PSJPTSP=+VAIP(7),PSJPTS=+VAIP(8),PSJPDX=VAIP(9),PSJPTD=""
"RTN","PSJP",31,0)
 ;
"RTN","PSJP",32,0)
CNV ;
"RTN","PSJP",33,0)
 I $G(DFN) I '$$AA^PSJDPT(DFN) S Y=-1 G ENDPT
"RTN","PSJP",34,0)
 I $D(PSJEXTP) W ! K DIR S DIR(0)="DO",DIR("A")="Date to start searching from (optional)",DIR("?")="Enter a date to start searching from, or <RETURN> for all orders" D ^DIR S PSJHDATE=Y K DIR
"RTN","PSJP",35,0)
 D DEM^VADPT,PID^VADPT,HTWT^PSJAC(DFN)
"RTN","PSJP",36,0)
 S PSGP(0)=VADM(1),PSJPSSN=VADM(2),PSJPDOB=+VADM(3),PSJPAGE=VADM(4),PSJPSEX=$S(VADM(5)]"":VADM(5),1:"?^____"),PSJPPID=VA("PID"),PSJPBID=VA("BID")
"RTN","PSJP",37,0)
 F X="PSJPAD","PSJPDOB","PSJPTD" I @X S $P(@X,"^",2)=$$ENDTC^PSGMI(+@X)
"RTN","PSJP",38,0)
 ;
"RTN","PSJP",39,0)
WP ; ward parameters
"RTN","PSJP",40,0)
 S PSJSYSW0="",PSJSYSW=0 I $G(PSJPWD) S PSJSYSW=+$O(^PS(59.6,"B",PSJPWD,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJP",41,0)
 ; *OLD CODE* S PSJSYSL="",X=$P(PSJSYSU,";",3)>1,PSJSYSL=$P(PSJSYSW0,"^",X*4+12)
"RTN","PSJP",42,0)
 S PSJSYSL="",X=$P(PSJSYSU,";",3)>1,PSJSYSL=$S(X=0:$P(PSJSYSW0,"^",12),1:$P(PSJSYSW0,"^",16))
"RTN","PSJP",43,0)
 S PSJDCEXP=$$RECDCEXP()
"RTN","PSJP",44,0)
 I PSJSYSL D
"RTN","PSJP",45,0)
 .S:X X='$P(PSJSYSP0,"^",10) S IOP=$S($P(PSJSYSP0,"^",13)]"":$P(PSJSYSP0,"^",13),$P(PSJSYSW0,"^",19+X)]"":$P(PSJSYSW0,"^",19+X),1:"") I IOP]"" D
"RTN","PSJP",46,0)
 ..S IOP="`"_IOP K %ZIS S %ZIS="NQ" D ^%ZIS S:'POP $P(PSJSYSL,"^",2,3)=ION_"^"_IO D HOME^%ZIS
"RTN","PSJP",47,0)
 ;
"RTN","PSJP",48,0)
DONE ;
"RTN","PSJP",49,0)
 K DA,DIC,NB,ND,NS,PSGID,PSGOD,VA200,VAIP,VAMT,X,Y(0),Y(0,0),QFLG Q
"RTN","PSJP",50,0)
 ;
"RTN","PSJP",51,0)
ENCONT ;
"RTN","PSJP",52,0)
 I $D(PSGH) S %=1 Q
"RTN","PSJP",53,0)
 F FQ=0:0 W !!,"Do you wish to continue with this patient" S %=0 D YN^DICN Q:%  W:%Y'?1."?" $C(7) W "  (A 'YES' or 'NO' response is required.)" D:%Y?1."?" @("CH"_PSJH)
"RTN","PSJP",54,0)
 S:%'=1 Y=-1 Q
"RTN","PSJP",55,0)
 ;
"RTN","PSJP",56,0)
CH1 ;
"RTN","PSJP",57,0)
 W !!?2,"The patient selected has never been admitted to this medical facility.  You",!,"will be able to enter IV orders for this patient but NOT Unit Dose orders." Q
"RTN","PSJP",58,0)
CH2 ;
"RTN","PSJP",59,0)
 W !!?2,"This patient is shown as deceased.  You will not be able to enter orders for",!,"this patient." Q
"RTN","PSJP",60,0)
CH3 ;
"RTN","PSJP",61,0)
 W !!?2,"This patient is shown to be currently discharged.  You will be able to enter",!,"IV orders for this patient but NOT Unit Dose orders." Q
"RTN","PSJP",62,0)
 Q
"RTN","PSJP",63,0)
RECDCEXP() ;
"RTN","PSJP",64,0)
 ;Determent the Hours to display Recently DC/Expired orders on the short profile
"RTN","PSJP",65,0)
 ;Returning P1^P2
"RTN","PSJP",66,0)
 ;P1 = Number of hours defined in 59.6 or 59.7.  Set to 24 if no value set in either file.
"RTN","PSJP",67,0)
 ;P2 = Date.time from Now - P1 hours
"RTN","PSJP",68,0)
 ;
"RTN","PSJP",69,0)
 NEW PSJDCEXP,PSJWD,PSJWD1,PSJSYS,X,%,PSJLPDAY
"RTN","PSJP",70,0)
 S PSJWD1=$S(+$G(PSJPWD):PSJPWD,+$G(VAIN(4)):+VAIN(4),1:0)
"RTN","PSJP",71,0)
 S:PSJWD1 X=$O(^PS(59.6,"B",PSJWD1,0))
"RTN","PSJP",72,0)
 S:+$G(X) PSJWD=$P($G(^PS(59.6,X,0)),U,33)
"RTN","PSJP",73,0)
 S PSJSYS=+$P($G(^PS(59.7,1,26)),U,8)
"RTN","PSJP",74,0)
 S PSJDCEXP=$S($G(PSJWD):PSJWD,PSJSYS:PSJSYS,1:24)
"RTN","PSJP",75,0)
 D NOW^%DTC
"RTN","PSJP",76,0)
 S X=$$FMADD^XLFDT(%,0,-PSJDCEXP,0,0)
"RTN","PSJP",77,0)
 ; If Long Profile, use last admission date if it's older than recently dc'd/expired parameter
"RTN","PSJP",78,0)
 I $G(PSJOL)="L"&($G(PSJPAD)) S PSJLPDAY=$$FMDIFF^XLFDT(%,+$G(PSJPAD),1)*24 I PSJLPDAY>0&(PSJLPDAY>PSJDCEXP) S PSJDCEXP=+$G(PSJPAD),X=PSJLPDAY
"RTN","PSJP",79,0)
 Q PSJDCEXP_U_X
"RTN","PSJP",80,0)
 ;
"RTN","PSJP",81,0)
CLORCHK(PSJPTIEN) ; Return patient does (1) or does not (0) have any clinic orders.
"RTN","PSJP",82,0)
 N PSGP,ND,C,DN,PSGSS,Y,X,PSJPAD,TMPCLIN,DFN,PSJBEG,PSJEND,PSJDCEXP,PSJOL,PSJOS,VAIN,VADM,VAIP S TMPCLIN=""
"RTN","PSJP",83,0)
 S (DFN,PSGP,Y)=+PSJPTIEN,PSGSS="P",VA200=1 D INP^VADPT,IN5^VADPT
"RTN","PSJP",84,0)
 D NOW^%DTC S PSJBEG=$$FMADD^XLFDT(+$G(X),-3650),PSJEND=$$FMADD^XLFDT(+$G(X),3650)
"RTN","PSJP",85,0)
 D DEM^VADPT S PSJPAD=VAIP(13,1),PSJPBID=VA("BID"),PSGP(0)=VADM(1)
"RTN","PSJP",86,0)
 K ^TMP("PSJ",$J),^TMP("PSJON",$J),^TMP("PSJPRO",$J),^TMP("PSJCLOR",$J)
"RTN","PSJP",87,0)
 D EN^PSJCLOR3(3) I $D(^TMP("PSJ",$J)) K ^TMP("PSJ",$J) Q 1
"RTN","PSJP",88,0)
 I '$D(^TMP("PSJ",$J)) Q 0
"RTN","PSJP",89,0)
 Q 0
"VER")
8.0^22.0
"^DD",53.1,53.1,59,0)
INFUSION RATE^FX^^8;5^D ENI^PSJDDUT3
"^DD",53.1,53.1,59,3)
Answer must be 1-30 characters in length.
"^DD",53.1,53.1,59,4)

"^DD",53.1,53.1,59,20,0)
^.3LA^1^1
"^DD",53.1,53.1,59,20,1,0)
PSJI
"^DD",53.1,53.1,59,21,0)
^.001^18^18^3121105^^^^
"^DD",53.1,53.1,59,21,1,0)
  The rate at which the IV is to be administered.  This value, together
"^DD",53.1,53.1,59,21,2,0)
with the total volume of the hyperal or the admixture type, is used to
"^DD",53.1,53.1,59,21,3,0)
determine the time covered by one bag; hence the system can predict the
"^DD",53.1,53.1,59,21,4,0)
bags needed during a specified time of coverage.  This field is free text
"^DD",53.1,53.1,59,21,5,0)
for IVPB's.  For LVP's you must enter a number representing the infusion
"^DD",53.1,53.1,59,21,6,0)
rate.  You may also specify the # of bags per day needed, which will
"^DD",53.1,53.1,59,21,7,0)
become the default number of LABELS PER DAY.
"^DD",53.1,53.1,59,21,8,0)
 
"^DD",53.1,53.1,59,21,9,0)
  Example.  125 = 125 ml/hr (IV system will calculate bags needed per day)
"^DD",53.1,53.1,59,21,10,0)
          125@2 = 125 ml/hr with 2 labels per day
"^DD",53.1,53.1,59,21,11,0)
      TITRATE@1 = TITRATE with 1 label per day.
"^DD",53.1,53.1,59,21,12,0)
 The format of this field is either a number only or
"^DD",53.1,53.1,59,21,13,0)
 [FREE TEXT@NUMBER OF LABELS PER DAY].
"^DD",53.1,53.1,59,21,14,0)
 
"^DD",53.1,53.1,59,21,15,0)
Note: If an administration time(s) is defined, the number of labels will
"^DD",53.1,53.1,59,21,16,0)
reflect the administration time(s) for the IVPB type orders.
"^DD",53.1,53.1,59,21,17,0)
For example:  One administration time of 12:00 is specified.  The infusion
"^DD",53.1,53.1,59,21,18,0)
rate is entered as 125@3.  Only 1 label will print.
"^DD",53.1,53.1,59,23,0)
^.001^2^2^3121105^^^
"^DD",53.1,53.1,59,23,1,0)
The # of bags per day needed, if entered, populates P("NUMLBL") and 
"^DD",53.1,53.1,59,23,2,0)
displays as the default for the LABELS PER DAY (#131) field.
"^DD",53.1,53.1,59,"DT")
2970619
"^DD",53.1,53.1,131,0)
LABELS PER DAY^NJ2,0^^17;1^K:+X'=X!(X>99)!(X<0)!(X?.E1"."1N.N) X
"^DD",53.1,53.1,131,3)
Type a number between 0 and 99, 0 decimal digits.
"^DD",53.1,53.1,131,4)

"^DD",53.1,53.1,131,21,0)
^^2^2^3121105^
"^DD",53.1,53.1,131,21,1,0)
The number of IV labels needed each day. If populated, this value will 
"^DD",53.1,53.1,131,21,2,0)
override the system-calculated number of labels. 
"^DD",53.1,53.1,131,"DT")
3121025
"^DD",53.46,53.46,4,0)
MISSING DOSE PRINTER^P3.5'^%ZIS(1,^1;5^Q
"^DD",53.46,53.46,4,3)
Enter the print device this clinic should use for Missing Dose requests.
"^DD",53.46,53.46,4,21,0)
^^4^4^3120912^
"^DD",53.46,53.46,4,21,1,0)
This is the print device that this Clinic will use to print Missing Dose 
"^DD",53.46,53.46,4,21,2,0)
requests.  This device overrides the default "Clinic Missing Dose 
"^DD",53.46,53.46,4,21,3,0)
Request Printer:" device (stored as an XPAR Division parameter), set by 
"^DD",53.46,53.46,4,21,4,0)
the BCMA Site Parameters GUI Client, for Clinics.
"^DD",53.46,53.46,4,"DT")
3120912
"^DD",53.46,53.46,5,0)
PRE-EXCHANGE REPORT DEVICE^P3.5'^%ZIS(1,^1;1^Q
"^DD",53.46,53.46,5,3)
Select a device on which the Pre-Exchange Report may be printed.
"^DD",53.46,53.46,5,21,0)
^^4^4^3130221^
"^DD",53.46,53.46,5,21,1,0)
The device most frequently used to print the Pre-Exchange Report for this
"^DD",53.46,53.46,5,21,2,0)
CLINIC. This device will be shown as the default for the 'Select DEVICE
"^DD",53.46,53.46,5,21,3,0)
for PRE-EXCHANGE UNITS REPORT:' prompt when printing the Pre-Exchange 
"^DD",53.46,53.46,5,21,4,0)
Report.
"^DD",53.46,53.46,5,"DT")
3121203
"BLD",8406,6)
^254
**END**
**END**
