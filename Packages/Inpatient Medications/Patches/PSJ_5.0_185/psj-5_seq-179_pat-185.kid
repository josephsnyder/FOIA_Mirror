Released PSJ*5*185 SEQ #179
Extracted from mail message
**KIDS**:PSJ*5.0*185^

**INSTALL NAME**
PSJ*5.0*185
"BLD",6659,0)
PSJ*5.0*185^INPATIENT MEDICATIONS^0^3080108^y
"BLD",6659,1,0)
^^8^8^3070720^
"BLD",6659,1,1,0)
When an order from CPRS is processed in the Inpatient Medications
"BLD",6659,1,2,0)
application the Comments field is automatically checked to verify that it
"BLD",6659,1,3,0)
does not contain multiple spaces.  If it does, the software will remove
"BLD",6659,1,4,0)
these spaces.  When this happens, a Change Action is generated in CPRS.
"BLD",6659,1,5,0)
This Change Action will cause CPRS to recalculate the Instructions. In
"BLD",6659,1,6,0)
some cases, the recalculation of the Instructions will result in the
"BLD",6659,1,7,0)
strength being added to the instuctions. This may result in the patient
"BLD",6659,1,8,0)
receiving an incorrect dose.
"BLD",6659,4,0)
^9.64PA^^
"BLD",6659,6)
1^
"BLD",6659,6.3)
6
"BLD",6659,"ABPKG")
n
"BLD",6659,"KRN",0)
^9.67PA^8989.52^19
"BLD",6659,"KRN",.4,0)
.4
"BLD",6659,"KRN",.401,0)
.401
"BLD",6659,"KRN",.402,0)
.402
"BLD",6659,"KRN",.403,0)
.403
"BLD",6659,"KRN",.5,0)
.5
"BLD",6659,"KRN",.84,0)
.84
"BLD",6659,"KRN",3.6,0)
3.6
"BLD",6659,"KRN",3.8,0)
3.8
"BLD",6659,"KRN",9.2,0)
9.2
"BLD",6659,"KRN",9.8,0)
9.8
"BLD",6659,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6659,"KRN",9.8,"NM",1,0)
PSGSICHK^^0^B68358169
"BLD",6659,"KRN",9.8,"NM",2,0)
PSJLMPRU^^0^B13929235
"BLD",6659,"KRN",9.8,"NM","B","PSGSICHK",1)

"BLD",6659,"KRN",9.8,"NM","B","PSJLMPRU",2)

"BLD",6659,"KRN",19,0)
19
"BLD",6659,"KRN",19.1,0)
19.1
"BLD",6659,"KRN",101,0)
101
"BLD",6659,"KRN",409.61,0)
409.61
"BLD",6659,"KRN",771,0)
771
"BLD",6659,"KRN",870,0)
870
"BLD",6659,"KRN",8989.51,0)
8989.51
"BLD",6659,"KRN",8989.52,0)
8989.52
"BLD",6659,"KRN",8994,0)
8994
"BLD",6659,"KRN","B",.4,.4)

"BLD",6659,"KRN","B",.401,.401)

"BLD",6659,"KRN","B",.402,.402)

"BLD",6659,"KRN","B",.403,.403)

"BLD",6659,"KRN","B",.5,.5)

"BLD",6659,"KRN","B",.84,.84)

"BLD",6659,"KRN","B",3.6,3.6)

"BLD",6659,"KRN","B",3.8,3.8)

"BLD",6659,"KRN","B",9.2,9.2)

"BLD",6659,"KRN","B",9.8,9.8)

"BLD",6659,"KRN","B",19,19)

"BLD",6659,"KRN","B",19.1,19.1)

"BLD",6659,"KRN","B",101,101)

"BLD",6659,"KRN","B",409.61,409.61)

"BLD",6659,"KRN","B",771,771)

"BLD",6659,"KRN","B",870,870)

"BLD",6659,"KRN","B",8989.51,8989.51)

"BLD",6659,"KRN","B",8989.52,8989.52)

"BLD",6659,"KRN","B",8994,8994)

"BLD",6659,"QUES",0)
^9.62^^
"BLD",6659,"REQB",0)
^9.611^5^4
"BLD",6659,"REQB",2,0)
PSJ*5.0*110^2
"BLD",6659,"REQB",3,0)
PSJ*5.0*175^2
"BLD",6659,"REQB",4,0)
PSJ*5.0*160^2
"BLD",6659,"REQB",5,0)
PSJ*5.0*201^2
"BLD",6659,"REQB","B","PSJ*5.0*110",2)

"BLD",6659,"REQB","B","PSJ*5.0*160",4)

"BLD",6659,"REQB","B","PSJ*5.0*175",3)

"BLD",6659,"REQB","B","PSJ*5.0*201",5)

"MBREQ")
0
"PKG",221,-1)
1^1
"PKG",221,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",221,20,0)
^9.402P^^
"PKG",221,22,0)
^9.49I^1^1
"PKG",221,22,1,0)
5.0^2971215^2981113^1
"PKG",221,22,1,"PAH",1,0)
185^3080108^520645583
"PKG",221,22,1,"PAH",1,1,0)
^^8^8^3080108
"PKG",221,22,1,"PAH",1,1,1,0)
When an order from CPRS is processed in the Inpatient Medications
"PKG",221,22,1,"PAH",1,1,2,0)
application the Comments field is automatically checked to verify that it
"PKG",221,22,1,"PAH",1,1,3,0)
does not contain multiple spaces.  If it does, the software will remove
"PKG",221,22,1,"PAH",1,1,4,0)
these spaces.  When this happens, a Change Action is generated in CPRS.
"PKG",221,22,1,"PAH",1,1,5,0)
This Change Action will cause CPRS to recalculate the Instructions. In
"PKG",221,22,1,"PAH",1,1,6,0)
some cases, the recalculation of the Instructions will result in the
"PKG",221,22,1,"PAH",1,1,7,0)
strength being added to the instuctions. This may result in the patient
"PKG",221,22,1,"PAH",1,1,8,0)
receiving an incorrect dose.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSGSICHK")
0^1^B68358169^B64473968
"RTN","PSGSICHK",1,0)
PSGSICHK ;BIR/CML3-CHECKS SPECIAL INSTRUCTIONS ;17 Aug 98 / 8:33 AM
"RTN","PSGSICHK",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,9,26,29,44,49,59,110,139,146,160,175,201,185**;16 DEC 97;Build 6
"RTN","PSGSICHK",3,0)
 ;
"RTN","PSGSICHK",4,0)
 ; Reference to ^PS(50.605 is supported by DBIA 696.
"RTN","PSGSICHK",5,0)
 ; Reference to EN^PSOORDRG is supported by DBIA 2190.
"RTN","PSGSICHK",6,0)
 ; Reference to ^PSI(58.1 is supported by DBIA 2284.
"RTN","PSGSICHK",7,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSGSICHK",8,0)
 ; Reference to ^PSD(58.8 is supported by DBIA 2283.
"RTN","PSGSICHK",9,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGSICHK",10,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSGSICHK",11,0)
 ; Reference to ^PS(51 is supported by DBIA 2176.
"RTN","PSGSICHK",12,0)
 ; Reference to ^ORRDI1 is supported by DBIA 4659.
"RTN","PSGSICHK",13,0)
 ; Reference to ^XTMP("ORRDI" is supported by DBIA 4660.
"RTN","PSGSICHK",14,0)
 ; Reference to GETDATA^GMRAOR supported by DBIA 4847.
"RTN","PSGSICHK",15,0)
 ; Reference to ^TMP("GMRAOC" supported by DBIA 4848.
"RTN","PSGSICHK",16,0)
 ;
"RTN","PSGSICHK",17,0)
START ;
"RTN","PSGSICHK",18,0)
 I $S(X'?.ANP:1,X["^":1,1:$L(X)>180) K X Q
"RTN","PSGSICHK",19,0)
 S Y="" F Y(1)=1:1:$L(X," ") S Y(2)=$P(X," ",Y(1)) I Y(2)]"" D CHK Q:'$D(X)
"RTN","PSGSICHK",20,0)
 I $D(X),Y]"",X'=$E(Y,1,$L(Y)-1) D EN^DDIOL("EXPANDS TO: ") W Y F Y(1)=1:1 S Y(2)=$P(Y," ",Y(1)) Q:Y(2)=""  D:$L(Y(2))+$X>78 EN^DDIOL(Y(2)_" ")
"RTN","PSGSICHK",21,0)
 Q
"RTN","PSGSICHK",22,0)
 ;
"RTN","PSGSICHK",23,0)
CHK ;
"RTN","PSGSICHK",24,0)
 I $L(Y(2))<31,$D(^PS(51,+$O(^PS(51,"B",Y(2),0)),0)),$P(^(0),"^",2)]"",$P(^(0),"^",4) S Y(2)=$P(^(0),"^",2)
"RTN","PSGSICHK",25,0)
 I $L(Y)+$L(Y(2))>180 K X Q
"RTN","PSGSICHK",26,0)
 S Y=Y_Y(2)_" " Q
"RTN","PSGSICHK",27,0)
 ;
"RTN","PSGSICHK",28,0)
ENSET(X) ; expands the SPECIAL INSTRUCTIONS field contained in X into Y
"RTN","PSGSICHK",29,0)
 N X1,X2,Y S Y=""
"RTN","PSGSICHK",30,0)
 ;BHW;PSJ*5*185;Modified Logic below to NOT strip spaces and allow existing logic to flow.
"RTN","PSGSICHK",31,0)
 ;             ;Removed code I X2]"" Before Set of Y and created argumentless DO structure.
"RTN","PSGSICHK",32,0)
 F X1=1:1:$L(X," ") S X2=$P(X," ",X1) D
"RTN","PSGSICHK",33,0)
 . I X2']"" S Y=Y_" " Q  ;if multiple spaces in text and were $P'ing through text, X2 will="" so just add space and continue
"RTN","PSGSICHK",34,0)
 . S Y=Y_$S($L(X2)>30:X2,'$D(^PS(51,+$O(^PS(51,"B",X2,0)),0)):X2,$P(^(0),"^",2)]""&$P(^(0),"^",4):$P(^(0),"^",2),1:X2)_" "
"RTN","PSGSICHK",35,0)
 . Q
"RTN","PSGSICHK",36,0)
 ;BHW;Modified stripping of spaces at end of string
"RTN","PSGSICHK",37,0)
 F X1=$L(Y):-1:0 Q:$E(Y,X1,X1)'=" "  S Y=$E(Y,1,X1-1)
"RTN","PSGSICHK",38,0)
 Q Y
"RTN","PSGSICHK",39,0)
 ;
"RTN","PSGSICHK",40,0)
END ; used by DRUG (55.06,101 & 53.1,101) x-refs to warn user if patient is receiving or about to receive the drug just ordered
"RTN","PSGSICHK",41,0)
 Q:$D(PSJHLSKP)
"RTN","PSGSICHK",42,0)
 N Z,ZZ,STATUSNP I $G(PSJPWD)&($P($G(PSJSYSU),";")=3)&($G(PSGDRG)) I ($D(^PSI(58.1,"D",PSGDRG,PSJPWD)))!($D(^PSD(58.8,"D",PSGDRG,PSJPWD))) D EN^DDIOL("                         *** A WARD STOCK ITEM ***")
"RTN","PSGSICHK",43,0)
 D NOW^%DTC
"RTN","PSGSICHK",44,0)
 N PSJDCHK F Z=%:0 S Z=$O(^PS(55,+PSGP,5,"AUS",Z)) Q:'Z!$D(DUOUT)  F ZZ=0:0 S ZZ=$O(^PS(55,+PSGP,5,"AUS",Z,ZZ)) Q:'ZZ!$D(DUOUT)  I +$G(^PS(55,+PSGP,5,ZZ,.2))=PSGX D PDWCHK(+PSGP,ZZ_"U") S PSJDCHK=1
"RTN","PSGSICHK",45,0)
 F STATUSNP="N","P" F Z=0:0 S Z=$O(^PS(53.1,"AS",STATUSNP,+PSGP,Z)) Q:'Z!$D(DUOUT)  I +$G(^PS(53.1,+Z,.2))=PSGX D PDWCHK(+PSGP,Z_"P") S PSJDCHK=1
"RTN","PSGSICHK",46,0)
 I $D(PSJDCHK) N DIR D
"RTN","PSGSICHK",47,0)
 .S DIR(0)="Y",DIR("A")="Do you wish to continue entering this order",DIR("?",1)="Enter ""N"" if you wish to exit without creating a new order,"
"RTN","PSGSICHK",48,0)
 .S DIR("?")="or ""Y"" to continue with the order entry process." D ^DIR S:'Y Y=-1,X="^"
"RTN","PSGSICHK",49,0)
 K Z,ZZ
"RTN","PSGSICHK",50,0)
 Q
"RTN","PSGSICHK",51,0)
 ;
"RTN","PSGSICHK",52,0)
ENDDC(PSGP,PSJDD) ; Perform Duplicate Drug, Duplicate Class,
"RTN","PSGSICHK",53,0)
 ; Drug-Drug interaction check, Drug-Allergy interaction check.
"RTN","PSGSICHK",54,0)
 N PSJLINE,Z,ZZ,PSJFST
"RTN","PSGSICHK",55,0)
 S (PSJLINE,PSJFST)=0
"RTN","PSGSICHK",56,0)
 I $G(PSJPWD)&($P($G(PSJSYSU),";")=3)&($G(PSJDD)) I ($D(^PSI(58.1,"D",PSJDD,PSJPWD)))!($D(^PSD(58.8,"D",PSJDD,PSJPWD))) W !?25,"*** A WARD STOCK ITEM ***"
"RTN","PSGSICHK",57,0)
 D EN^PSOORDRG(PSGP,PSJDD) K PSJPDRG N INTERVEN,PSJIREQ,PSJRXREQ S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)="" S DFN=PSGP
"RTN","PSGSICHK",58,0)
 I $T(HAVEHDR^ORRDI1)]"",$$HAVEHDR^ORRDI1,'$D(^XTMP("ORRDI","OUTAGE INFO","DOWN")) D
"RTN","PSGSICHK",59,0)
 . I $P($G(^XTMP("ORRDI","PSOO",PSGP,0)),"^",3)<0 W !,"Remote data not available - Only local order checks processed." D PAUSE^PSJLMUT1
"RTN","PSGSICHK",60,0)
 I $D(^TMP($J,"DD")) D ORDCHK^PSJLMUT1(PSGP,"DD",4)
"RTN","PSGSICHK",61,0)
 I $D(^TMP($J,"DC")) D ORDCHK^PSJLMUT1(PSGP,"DC",6)
"RTN","PSGSICHK",62,0)
IVSOL ;*** Start order check for IV solution at this point.
"RTN","PSGSICHK",63,0)
 I '$D(PSJFST) N PSJFST S PSJFST=0
"RTN","PSGSICHK",64,0)
 I $D(^TMP($J,"DI")) S INTERVEN=1 D ORDCHK^PSJLMUT1(PSGP,"DI",8)
"RTN","PSGSICHK",65,0)
 ;*** Allergy/adverse reaction check.
"RTN","PSGSICHK",66,0)
 N PTR,X
"RTN","PSGSICHK",67,0)
 S PTR=$P($G(^PSDRUG(PSJDD,"ND")),U)_"."_$P($G(^PSDRUG(PSJDD,"ND")),U,3)
"RTN","PSGSICHK",68,0)
 K ^TMP("PSJDAI",$J) S PSJACK=$$ORCHK^GMRAOR(DFN,"DR",PTR) D:$G(PSJACK)=1
"RTN","PSGSICHK",69,0)
 .S ^TMP("PSJDAI",$J,0)=1
"RTN","PSGSICHK",70,0)
 .S I=0 F  S I=$O(GMRAING(I)) Q:'I  S ^TMP("PSJDAI",$J,I,0)=GMRAING(I)
"RTN","PSGSICHK",71,0)
 I $D(^TMP("PSJDAI",$J)) S PSJPDRG=1 D
"RTN","PSGSICHK",72,0)
 .W $C(7),!!,"A Drug-Allergy Reaction exists for this medication!",!!
"RTN","PSGSICHK",73,0)
 .W !?7,"Drug: "_$P($G(^PSDRUG(PSJDD,0)),"^") I $O(^TMP("PSJDAI",$J)) W !,"Ingredients: " D
"RTN","PSGSICHK",74,0)
 ..S I=0 F  S I=$O(^TMP("PSJDAI",$J,I)) Q:'I  W:$X+$L($G(^(I,0)))+2>IOM !?19 W:I=1 $G(^TMP("PSJDAI",$J,I,0)) W:I>1 ", ",$G(^TMP("PSJDAI",$J,I,0))
"RTN","PSGSICHK",75,0)
 .W !!
"RTN","PSGSICHK",76,0)
 K PSJACK,GMRAING,I,^TMP($J)
"RTN","PSGSICHK",77,0)
 D ALGCLASS
"RTN","PSGSICHK",78,0)
CONT ; Ask user if they wish to continue in spite of an order check.
"RTN","PSGSICHK",79,0)
 Q:'$D(PSJPDRG)  N DIR S DIR(0)="Y",DIR("A")="Do you wish to continue entering this order",DIR("?",1)="Enter ""N"" if you wish to exit without creating a new order,"
"RTN","PSGSICHK",80,0)
 S DIR("?")="or ""Y"" to continue with the order entry process.",DIR("B")="NO" D ^DIR I 'Y S PSGORQF=1,X="^",COMQUIT=1 Q
"RTN","PSGSICHK",81,0)
 I 'INTERVEN!($P(PSJSYSU,";")'=3) Q
"RTN","PSGSICHK",82,0)
 NEW PSJY
"RTN","PSGSICHK",83,0)
 W:PSJIREQ !!,"This is a CRITICAL interaction, you must enter an intervention log to continue"
"RTN","PSGSICHK",84,0)
 S DIR(0)="Y",DIR("A")="Do you wish to log an intervention",DIR("?",1)="Enter ""N"" if you do not wish to log an intervention,",DIR("?")="or ""Y"" to log an intervention." D ^DIR S PSJY=Y D:Y ^PSJRXI
"RTN","PSGSICHK",85,0)
 I 'PSJY,PSJIREQ S PSGORQF=1,COMQUIT=1
"RTN","PSGSICHK",86,0)
 Q
"RTN","PSGSICHK",87,0)
 ;
"RTN","PSGSICHK",88,0)
ENDL ; used by PSGTRAIN DRUG LOOK-UP option
"RTN","PSGSICHK",89,0)
 D ENCV^PSGSETU Q:$D(XQUIT)
"RTN","PSGSICHK",90,0)
 F  S DIC="^PSDRUG(",DIC(0)="AEIMOQZ",DIC("A")="Select DRUG: " W ! D ^DIC K DIC Q:+Y'>0  D SF
"RTN","PSGSICHK",91,0)
 D ENKV^PSGSETU K N5,ND,Q,Y Q
"RTN","PSGSICHK",92,0)
 ;
"RTN","PSGSICHK",93,0)
SF ;
"RTN","PSGSICHK",94,0)
 S Y=+Y,ND=$G(^PSDRUG(Y,0)),PSGID=+$G(^("I")) I PSGID W !!,"THIS DRUG IS INACTIVE AS OF ",$E($$ENDTC^PSGMI(PSGID),1,8)
"RTN","PSGSICHK",95,0)
 W !!,$S($P(ND,"^",9):"NON-",1:""),"FORMULARY ITEM" W:$P(ND,"^",10)]"" !,$P(ND,"^",10)
"RTN","PSGSICHK",96,0)
 S ND=$P($G(^PSDRUG(Y,2)),"^",3)["U" W !,$P("NOT^","^",ND+1)," A UNIT DOSE DRUG" W ! S ND=$G(^(8)),N5=$G(^(8.5)) W !?2,"DAY (nD) or DOSE (nL) LIMIT: " I ND W $P(ND,"^")
"RTN","PSGSICHK",97,0)
 W !?10,"UNIT DOSE MED ROUTE: " I $P(ND,"^",2) W $S($D(^PS(51.2,$P(ND,"^",2),0)):$P(^(0),"^"),1:$P(ND,"^",2))
"RTN","PSGSICHK",98,0)
 ; NAKED REF below refers to ^PS(51.2, on line above.
"RTN","PSGSICHK",99,0)
 W !?6,"UNIT DOSE SCHEDULE TYPE: " I $P(ND,"^",3)]"" W $P($P(";"_$P(^(0),"^",3),";"_$P(ND,"^",3)_":",2),";")
"RTN","PSGSICHK",100,0)
 W !?11,"UNIT DOSE SCHEDULE: " I $P(ND,"^",4)]"" W $P(ND,"^",4)
"RTN","PSGSICHK",101,0)
 W !,"CORRESPONDING OUTPATIENT DRUG: " I $P(ND,"^",5) W $S('$D(^PSDRUG(+$P(ND,"^",5),0)):$P(ND,"^",5),$P(^(0),"^")]"":$P(^(0),"^"),1:$P(ND,"^",5))
"RTN","PSGSICHK",102,0)
 W !?17,"ATC MNEMONIC: " I $P(N5,"^",2)]"" W $P(N5,"^",2)
"RTN","PSGSICHK",103,0)
 W !?17,"ATC CANISTER: " F Q=0:0 S Q=$O(^PSDRUG(Y,212,Q)) Q:'Q  S ND=$G(^(Q,0)) I ND,$P(ND,"^",2) W ?31,$S('$D(^PS(57.5,+ND,0)):+ND_";PS(57.5,",$P(^(0),"^")]"":$P(^(0),"^"),1:+ND_";PS(57.5,"),?56,$P(ND,"^",2),!
"RTN","PSGSICHK",104,0)
 Q
"RTN","PSGSICHK",105,0)
 ;
"RTN","PSGSICHK",106,0)
OCHK ; Add drugs in current order to ^TMP("ORDERS" and call order checker.
"RTN","PSGSICHK",107,0)
 ; Set PSJOCHK=1 so OP order check doesn't Kill array.
"RTN","PSGSICHK",108,0)
 ;
"RTN","PSGSICHK",109,0)
 K ^TMP($J,"ORDERS")
"RTN","PSGSICHK",110,0)
 N PSJOCHK S PSJOCHK=1
"RTN","PSGSICHK",111,0)
PDWCHK(DFN,ON) ; Print Dup Drug order.
"RTN","PSGSICHK",112,0)
 N ND,ND0,ND2,X
"RTN","PSGSICHK",113,0)
 W:'$D(PSJDCHK) $C(7),$C(7),!!,"WARNING! THIS PATIENT HAS THE FOLLOWING ORDER(S) FOR THIS MEDICATION:",!!
"RTN","PSGSICHK",114,0)
 S ND=$$DRUGNAME^PSJLMUTL(DFN,ON)
"RTN","PSGSICHK",115,0)
 S F=$S(ON["P":"^PS(53.1,",1:"^PS(55,"_DFN_",5,"),ND0=$G(@(F_+ON_",0)")),ND2=$G(^(2)),X=$P(ND,U,2),X=$S(X=.2:$P($G(^(.2)),U,2),1:$G(^(.3)))
"RTN","PSGSICHK",116,0)
 W ?10,$P(ND,U),!,?13,"Give: ",X," ",$$ENMRN^PSGMI(+$P(ND0,U,3))," ",$P(ND2,U),!!
"RTN","PSGSICHK",117,0)
 Q
"RTN","PSGSICHK",118,0)
ALGCLASS ; checks any Drug allergies or reactions to see if
"RTN","PSGSICHK",119,0)
 ;         the new drug is the same class
"RTN","PSGSICHK",120,0)
 ; this call can be removed by commenting out the call on IVSOL+16
"RTN","PSGSICHK",121,0)
 N PSJLIST,CT,CLS,CLCHK,CNT,PSJL,LIST,DCCNT,PSCLASS,LEN
"RTN","PSGSICHK",122,0)
 S PSCLASS=$P($G(^PSDRUG(PSJDD,0)),"^",2),LEN=4 I $E(PSCLASS,1,4)="CN10" S LEN=5 ;look at 5 chars if ANALGESICS
"RTN","PSGSICHK",123,0)
 I $T(GETDATA^GMRAOR)]"" G ALGC2
"RTN","PSGSICHK",124,0)
 S GMRA="0^0^111" D EN1^GMRADPT
"RTN","PSGSICHK",125,0)
 F PSJLIST=0:0 S PSJLIST=$O(GMRAL(PSJLIST)) Q:'PSJLIST  D
"RTN","PSGSICHK",126,0)
 .K PSJAGL D EN1^GMRAOR2(PSJLIST,"PSJAGL")
"RTN","PSGSICHK",127,0)
 .; is the allergy/reaction drug class first four digits the same as the
"RTN","PSGSICHK",128,0)
 .; the class for the drug being entered?
"RTN","PSGSICHK",129,0)
 .S (CT,CLS)="",DCCNT=0
"RTN","PSGSICHK",130,0)
 .I $D(PSJAGL("V")) D
"RTN","PSGSICHK",131,0)
 ..F  S DCCNT=$O(PSJAGL("V",DCCNT)) Q:'DCCNT  S:$E($P($G(PSJAGL("V",DCCNT)),"^"),1,LEN)=$E(PSCLASS,1,LEN) (PSJPDRG,CLCHK)=1,CNT=$S('$D(CNT):1,1:CNT+1),LIST(CNT)=$P($G(PSJAGL),"^")_"^"_$P($G(PSJAGL("V",DCCNT)),"^",2)
"RTN","PSGSICHK",132,0)
 D:$G(CLCHK)
"RTN","PSGSICHK",133,0)
 .W !!,$C(7),"A Drug-Allergy Reaction exists for this medication and/or class!"
"RTN","PSGSICHK",134,0)
 .F PSJL=0:0 S PSJL=$O(LIST(PSJL)) Q:'PSJL  D
"RTN","PSGSICHK",135,0)
 ..W !?6,"Drug: "_$P(LIST(PSJL),"^"),!,"Drug Class: "_$P(LIST(PSJL),"^",2),!
"RTN","PSGSICHK",136,0)
 Q
"RTN","PSGSICHK",137,0)
ALGC2 ;
"RTN","PSGSICHK",138,0)
 K GMRADRCL
"RTN","PSGSICHK",139,0)
 D GETDATA^GMRAOR(DFN) Q:'$D(^TMP("GMRAOC",$J,"APC"))
"RTN","PSGSICHK",140,0)
 N GMRACL,RET
"RTN","PSGSICHK",141,0)
 S RET=0,GMRACL="" F  S GMRACL=$O(^TMP("GMRAOC",$J,"APC",GMRACL)) Q:'$L(GMRACL)  D
"RTN","PSGSICHK",142,0)
 .N GMRANM,GMRALOC
"RTN","PSGSICHK",143,0)
 .S GMRALOC=^TMP("GMRAOC",$J,"APC",GMRACL)
"RTN","PSGSICHK",144,0)
 .S GMRANM=$P(^PS(50.605,+$O(^PS(50.605,"B",GMRACL,0)),0),U,2)
"RTN","PSGSICHK",145,0)
 .S GMRADRCL(GMRACL)=GMRACL_U_GMRANM_" ("_GMRALOC_")"
"RTN","PSGSICHK",146,0)
 .S RET=RET+1
"RTN","PSGSICHK",147,0)
 Q:'RET  K ^TMP("GMRAOC",$J)
"RTN","PSGSICHK",148,0)
 S CLCHK="",CT="" F  S CT=$O(GMRADRCL(CT)) Q:CT=""  D
"RTN","PSGSICHK",149,0)
 .I $E(PSCLASS,1,LEN)=$E(CT,1,LEN) S CLCHK=$G(CLCHK)+1,^TMP($J,"PSJDRCLS",CLCHK)=CT_" "_$P(GMRADRCL(CT),"^",2)
"RTN","PSGSICHK",150,0)
CLASSDSP ;
"RTN","PSGSICHK",151,0)
 I '$D(^TMP($J,"PSJDRCLS")) Q
"RTN","PSGSICHK",152,0)
 W $C(7),!,"A Drug-Allergy Reaction exists for this medication and/or class!",!
"RTN","PSGSICHK",153,0)
 W !,"Drug: "_$P($G(^PSDRUG(PSJDD,0)),"^")
"RTN","PSGSICHK",154,0)
 S CT="" F  S CT=$O(^TMP($J,"PSJDRCLS",CT)) Q:CT=""  W !,"Drug Class: "_^TMP($J,"PSJDRCLS",CT)
"RTN","PSGSICHK",155,0)
 K ^TMP($J,"PSJDRCLS")
"RTN","PSGSICHK",156,0)
 S DIR("?",1)="Answer 'YES' if you DO want to enter a reaction for this medication,"
"RTN","PSGSICHK",157,0)
 S DIR("?")="       'NO' if you DON'T want to enter a reaction for this medication,"
"RTN","PSGSICHK",158,0)
 S DIR(0)="SA^1:YES;0:NO",DIR("A")="Do you want to Intervene? ",DIR("B")="Y" W ! D ^DIR
"RTN","PSGSICHK",159,0)
 I Y D ^PSJRXI
"RTN","PSGSICHK",160,0)
 I '$G(Y) K DIR,DTOUT,DIRUT,DIROUT,DUOUT,Y Q
"RTN","PSGSICHK",161,0)
 Q
"RTN","PSJLMPRU")
0^2^B13929235^B13350416
"RTN","PSJLMPRU",1,0)
PSJLMPRU ;BIR/MLM-INPATIENT LISTMAN UD PROFILE UTILITIES ;27 Aug 98 / 8:45 AM
"RTN","PSJLMPRU",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**16,58,85,110,185**;16 DEC 97;Build 6
"RTN","PSJLMPRU",3,0)
 ;
"RTN","PSJLMPRU",4,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJLMPRU",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJLMPRU",6,0)
 ;
"RTN","PSJLMPRU",7,0)
PUD(DFN,ON,PSJF,DN) ; Setup LM profile view for UD
"RTN","PSJLMPRU",8,0)
 N PSJFLAG,PSJV
"RTN","PSJLMPRU",9,0)
 ; Naked references on the two lines below refer to full reference ^PS(55,DFN,5,+ON in PSJF using indirection.
"RTN","PSJLMPRU",10,0)
 S ND=$G(@(PSJF_+ON_",0)")),SCH=$G(^(2)),ND4=$G(^(4)),ND6=$G(^(6)),NDP2=$G(^(.2)),PSJFLAG=$P(NDP2,U,7),X=$P(DN,U,2),DO=$S('X:"",1:$G(^(+X))) S:X=.2 DO=$P(DO,U,2)
"RTN","PSJLMPRU",11,0)
 S ND14=$G(@(PSJF_+ON_",14,0)")),RNDT="" I $P(ND14,"^",3) S ND14=$G(^($P(ND14,"^",3),0)),RNDT=$P(ND14,"^")
"RTN","PSJLMPRU",12,0)
 I "AO"[PSJC D
"RTN","PSJLMPRU",13,0)
 .;S V='$P(ND4,"^",UDU),PSJL=$$SETSTR^VALM1($S(ND4="":" ",$P(ND4,"^",12):"D",$P(ND4,"^",18)&($P(ND4,"^",19)!V):"H",$P(ND4,"^",22)&($P(ND4,"^",23)!V):"H",$P(ND4,"^",15)&($P(ND4,"^",16)!V):"R",1:" "),PSJL,5,1)
"RTN","PSJLMPRU",14,0)
 .S V='$P(ND4,"^",UDU),PSJL=$$SETSTR^VALM1($S(ND4="":" ",$P(ND4,"^",12):"D",$P(ND4,"^",19)&$P(ND4,"^",18):"H",$P(ND4,"^",23)&$P(ND4,"^",22):"H",$P(ND4,"^",15)&($P(ND4,"^",16)!V):"R",1:" "),PSJL,5,1)
"RTN","PSJLMPRU",15,0)
 .;S X=$S(+PSJSYSU=1&V:1,+PSJSYSU=3&V:1,1:0)
"RTN","PSJLMPRU",16,0)
 .S PSJV=$S($P(NDP2,U,4)="D":"d",1:" ")_$S(+PSJSYSU=1&V:"->",+PSJSYSU=3&V:"->",1:"   ") I PSJFLAG D CNTRL^VALM10(PSJLN,1,4,IORVON,IORVOFF,0)
"RTN","PSJLMPRU",17,0)
 .S PSJL=$$SETSTR^VALM1(PSJV,PSJL,6,3)
"RTN","PSJLMPRU",18,0)
 ;I $S(PSJC["C":0,1:PSJC["B") S PSJL=$$SETSTR^VALM1($S($P(ND4,"^",12):"D",1:" ")_$S($P(ND,U,4)="I":"",PSJSYSU:"->",1:""),PSJL,6,3)
"RTN","PSJLMPRU",19,0)
 ;I $S(PSJC["C":0,1:PSJC["B") S PSJL=$$SETSTR^VALM1($S($P(ND4,"^",12):"D",1:" ")
"RTN","PSJLMPRU",20,0)
 S RTE=$P(ND,"^",3),SM=$S('$P(ND,"^",5):0,$P(ND,"^",6):1,1:2),STAT=$S($P(ND,"^",9)]"":$P(ND,"^",9),1:"NF"),PF=$E("*",$P(ND,"^",20)>0),PSGID=$P(SCH,"^",2),SD=$P(SCH,"^",4),SCH=$P(SCH,"^")
"RTN","PSJLMPRU",21,0)
 I STAT="A",$P(ND,U,27)="R" S STAT="R"
"RTN","PSJLMPRU",22,0)
 ;S NF=$P(DN,"^",3),WS=$S(PSJPWD:$$WS^PSJO(PSJPWD,PSGP,PSJF,+ON),1:0)
"RTN","PSJLMPRU",23,0)
 S NF="",WS=$S(PSJPWD:$$WS^PSJO(PSJPWD,PSGP,PSJF,+ON),1:0)
"RTN","PSJLMPRU",24,0)
 N PSJDISP F PSJDISP=0:0 S PSJDISP=$O(@(PSJF_+ON_",1,"_PSJDISP_")")) Q:'PSJDISP  D
"RTN","PSJLMPRU",25,0)
 .I $P($G(^PSDRUG(+$P($G(@(PSJF_+ON_",1,"_PSJDISP_",0)")),"^"),0)),"^",9)=1 S NF=1
"RTN","PSJLMPRU",26,0)
 NEW DRUGNAME,PSGID1,SD1,LEN,PSGID1,SD1 S LEN=$S($D(PSJEXPT):8,1:5)
"RTN","PSJLMPRU",27,0)
 F X="PSGID","SD" S @(X_1)=$S(PSJC["C":"*****",1:$E($$ENDTC^PSGMI(@X),1,LEN))
"RTN","PSJLMPRU",28,0)
 D DRGDISP^PSJLMUT1(PSGP,ON,39,54,.DRUGNAME,0)
"RTN","PSJLMPRU",29,0)
 F PSJX=0:0 S PSJX=$O(DRUGNAME(PSJX)) Q:'PSJX  D
"RTN","PSJLMPRU",30,0)
 . I PSJX=1 D
"RTN","PSJLMPRU",31,0)
 ..I PSJFLAG D CNTRL^VALM10(PSJLN,1,4,IORVON,IORVOFF,0)
"RTN","PSJLMPRU",32,0)
 ..S PSJL=$$SETSTR^VALM1($S($E(PSJS)="*":$P(PSJS,"^"),1:DRUGNAME(PSJX)),PSJL,9,39)
"RTN","PSJLMPRU",33,0)
 ..S PSJL=$$SETSTR^VALM1($S(PSJC["C":"?",PSJSCHT'="z":PSJSCHT,1:"?"),PSJL,50,3)
"RTN","PSJLMPRU",34,0)
 ..S PSJL=PSJL_PSGID1_"  "_SD1_"  "_$E(STAT,1)_"    "_$S($G(RNDT):$E($$ENDTC^PSGMI(RNDT),1,LEN),1:"")
"RTN","PSJLMPRU",35,0)
 ..I NF!WS!SM!PF S PSJL=$$SETSTR^VALM1($S(NF:"NF ",WS:"WS ",SM:$E("HSM",SM,3),1:""),PSJL,69,3) S:PF PSJL=$$SETSTR^VALM1("*",PSJL,79,1)
"RTN","PSJLMPRU",36,0)
 . I PSJX>1 S PSJL="",PSJL=$$SETSTR^VALM1(DRUGNAME(PSJX),PSJL,11,66)
"RTN","PSJLMPRU",37,0)
 . D SETTMP("PSJPRO",PSJL) I ($P(NDP2,U,4)="S"),STAT="P" D CNTRL^VALM10((PSJLN-1),9,9+$L(PSJL),IOINHI_IOBON,IOINORM,0)
"RTN","PSJLMPRU",38,0)
 D:$P(ND6,"^")]"" PTXT($P(ND6,"^"),"PSJPRO",10,66)
"RTN","PSJLMPRU",39,0)
 Q
"RTN","PSJLMPRU",40,0)
 ;
"RTN","PSJLMPRU",41,0)
PTXT(TXT,SUB,LM,RM) ; Display Instructions/dosage ordered.
"RTN","PSJLMPRU",42,0)
 ;* Input:       TXT = Text to display.
"RTN","PSJLMPRU",43,0)
 ;                       SUB = First subscript for ^TMP node, ** MUST be PSJ namespace **
"RTN","PSJLMPRU",44,0)
 ;                       LM  = Begin display of text after LM spaces.
"RTN","PSJLMPRU",45,0)
 ;                       RM  = Length of display text.
"RTN","PSJLMPRU",46,0)
 ;
"RTN","PSJLMPRU",47,0)
 ;BHW;PSJ*5*185;Extra spaces causes display to "skip" part of the field.                      
"RTN","PSJLMPRU",48,0)
 ;S PSJL="",$P(PSJL," ",LM)="" F X=1:1 S WRD=$P(TXT," ",X) Q:WRD=""  D
"RTN","PSJLMPRU",49,0)
 S PSJL="",$P(PSJL," ",LM)=""
"RTN","PSJLMPRU",50,0)
 F X=1:1:$L(TXT," ") S WRD=$P(TXT," ",X) D
"RTN","PSJLMPRU",51,0)
 .;BHW;PSJ*5*185;check if end of string or just extra space.
"RTN","PSJLMPRU",52,0)
 .I WRD="" S PSJL=PSJL_" " Q
"RTN","PSJLMPRU",53,0)
 .I $L(PSJL_" "_WRD)'<RM D SETTMP(SUB,PSJL) S PSJL="",$P(PSJL," ",10)=""
"RTN","PSJLMPRU",54,0)
 .I $L(PSJL_" "_WRD)'<RM S PSJL=PSJL_" "_$E(WRD,1,(RM-10)) D SETTMP(SUB,PSJL) S PSJL="",$P(PSJL," ",10)="",WRD=$E(WRD,(RM-9),$L(WRD))
"RTN","PSJLMPRU",55,0)
 .S PSJL=PSJL_" "_WRD
"RTN","PSJLMPRU",56,0)
 D SETTMP(SUB,PSJL)
"RTN","PSJLMPRU",57,0)
 Q
"RTN","PSJLMPRU",58,0)
SETTMP(SUB,PSJL) ;
"RTN","PSJLMPRU",59,0)
 S ^TMP(SUB,$J,PSJLN,0)=PSJL,PSJLN=PSJLN+1
"RTN","PSJLMPRU",60,0)
 Q
"VER")
8.0^22.0
"BLD",6659,6)
^179
**END**
**END**
